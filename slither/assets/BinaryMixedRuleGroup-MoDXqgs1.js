import{B as h,a as u,b as f}from"./BinaryRuleCollection-BwiA065R.js";import{_ as d}from"./createBoardDescriptor-DQiPBFka.js";class o{constructor(e,t){this.collection=e,this.mixedData=t}get size(){return this.collection.size}getRule(e){return this.collection.getRule(e,this.isRuleIndexHighlander(e))}isRuleIndexHighlander(e){return(this.mixedData[Math.floor(e/4)]&1<<2*(e%4))!==0}isRuleIndexFallback(e){return(this.mixedData[Math.floor(e/4)]&1<<2*(e%4)+1)!==0}withOnlyHighlander(){return this.filterIndex(e=>this.isRuleIndexHighlander(e))}withoutHighlander(){return this.filterIndex(e=>!this.isRuleIndexHighlander(e))}withoutFallback(){return this.filterIndex(e=>!this.isRuleIndexFallback(e))}withPatternBoardFilter(e){return this.filterIndex(t=>e(this.getRule(t).patternBoard))}withRuleIndices(e){const t=h.empty(),r=new Uint8Array(this.mixedData.length);let i=0;const n=(l,a,s,c)=>{t.addRuleSuffixBytes(l,a,s),r[Math.floor(i/4)]|=(s?1:0)<<2*(i%4),r[Math.floor(i/4)]|=(c?1:0)<<2*(i%4)+1,i++};for(let l=0;l<e.length;l++){const a=e[l],s=this.collection.getRulePatternBoard(a),c=this.collection.getRuleBytes(a,!1);n(s,c,this.isRuleIndexHighlander(a),this.isRuleIndexFallback(a))}return new o(t,r)}filterIndex(e){return this.withRuleIndices(d.range(0,this.size).filter(e))}sortedIndex(e){return this.withRuleIndices(d.sortBy(d.range(0,this.size),t=>e(t)))}sortedDefault(){return this.sortedIndex(e=>{let t=this.getRule(e).getInputDifficultyScoreB();return this.isRuleIndexFallback(e)&&(t+=1e3),t})}serialize(){return{collection:this.collection.serialize(),mixedData:u(this.mixedData)}}static deserialize(e){const t=f(e.mixedData);if(t)return new o(h.deserialize(e.collection),t);throw new Error("could not read mixedData")}static fromGroup(e){const t=h.empty(),r=new Uint8Array(Math.ceil(e.size/4));let i=0;const n=(l,a,s)=>{t.addRule(l),r[Math.floor(i/4)]|=(a?1:0)<<2*(i%4),r[Math.floor(i/4)]|=(s?1:0)<<2*(i%4)+1,i++};return e.mainCollection&&e.mainCollection.forEachRule(l=>n(l,!1,!1)),e.highlanderCollection&&e.highlanderCollection.forEachRule(l=>n(l,!0,!1)),e.fallbackCollection&&e.fallbackCollection.forEachRule(l=>n(l,!1,!0)),e.highlanderFallbackCollection&&e.highlanderFallbackCollection.forEachRule(l=>n(l,!0,!0)),new o(t,r)}}export{o as B};
