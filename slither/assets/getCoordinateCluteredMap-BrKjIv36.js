var T0=Object.defineProperty;var C0=(o,e,t)=>e in o?T0(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var ut=(o,e,t)=>(C0(o,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}function getAugmentedNamespace(o){if(o.__esModule)return o;var e=o.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(o).forEach(function(n){var r=Object.getOwnPropertyDescriptor(o,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return o[n]}})}),t}/*!
 * jQuery JavaScript Library v2.1.0
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright 2005, 2014 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2014-01-23T21:10Z
 */(function(o){(function(e,t){window.$=e.document?t(e,!0):function(n){if(!n.document)throw new Error("jQuery requires a window with a document");return t(n)}})(typeof window<"u"?window:commonjsGlobal,function(e,t){var n=[],r=n.slice,s=n.concat,a=n.push,l=n.indexOf,d={},c=d.toString,y=d.hasOwnProperty,m="".trim,O={},D=e.document,z="2.1.0",w=function(C,G){return new w.fn.init(C,G)},N=/^-ms-/,H=/-([\da-z])/gi,X=function(C,G){return G.toUpperCase()};w.fn=w.prototype={jquery:z,constructor:w,selector:"",length:0,toArray:function(){return r.call(this)},get:function(C){return C!=null?C<0?this[C+this.length]:this[C]:r.call(this)},pushStack:function(C){var G=w.merge(this.constructor(),C);return G.prevObject=this,G.context=this.context,G},each:function(C,G){return w.each(this,C,G)},map:function(C){return this.pushStack(w.map(this,function(G,Q){return C.call(G,Q,G)}))},slice:function(){return this.pushStack(r.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(C){var G=this.length,Q=+C+(C<0?G:0);return this.pushStack(Q>=0&&Q<G?[this[Q]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:a,sort:n.sort,splice:n.splice},w.extend=w.fn.extend=function(){var C,G,Q,se,ve,Ee,Be=arguments[0]||{},Qe=1,yt=arguments.length,wt=!1;for(typeof Be=="boolean"&&(wt=Be,Be=arguments[Qe]||{},Qe++),typeof Be!="object"&&!w.isFunction(Be)&&(Be={}),Qe===yt&&(Be=this,Qe--);Qe<yt;Qe++)if((C=arguments[Qe])!=null)for(G in C)Q=Be[G],se=C[G],Be!==se&&(wt&&se&&(w.isPlainObject(se)||(ve=w.isArray(se)))?(ve?(ve=!1,Ee=Q&&w.isArray(Q)?Q:[]):Ee=Q&&w.isPlainObject(Q)?Q:{},Be[G]=w.extend(wt,Ee,se)):se!==void 0&&(Be[G]=se));return Be},w.extend({expando:"jQuery"+(z+Math.random()).replace(/\D/g,""),isReady:!0,error:function(C){throw new Error(C)},noop:function(){},isFunction:function(C){return w.type(C)==="function"},isArray:Array.isArray,isWindow:function(C){return C!=null&&C===C.window},isNumeric:function(C){return C-parseFloat(C)>=0},isPlainObject:function(C){if(w.type(C)!=="object"||C.nodeType||w.isWindow(C))return!1;try{if(C.constructor&&!y.call(C.constructor.prototype,"isPrototypeOf"))return!1}catch{return!1}return!0},isEmptyObject:function(C){var G;for(G in C)return!1;return!0},type:function(C){return C==null?C+"":typeof C=="object"||typeof C=="function"?d[c.call(C)]||"object":typeof C},globalEval:function(C){var G,Q=eval;C=w.trim(C),C&&(C.indexOf("use strict")===1?(G=D.createElement("script"),G.text=C,D.head.appendChild(G).parentNode.removeChild(G)):Q(C))},camelCase:function(C){return C.replace(N,"ms-").replace(H,X)},nodeName:function(C,G){return C.nodeName&&C.nodeName.toLowerCase()===G.toLowerCase()},each:function(C,G,Q){var se,ve=0,Ee=C.length,Be=ae(C);if(Q){if(Be)for(;ve<Ee&&(se=G.apply(C[ve],Q),se!==!1);ve++);else for(ve in C)if(se=G.apply(C[ve],Q),se===!1)break}else if(Be)for(;ve<Ee&&(se=G.call(C[ve],ve,C[ve]),se!==!1);ve++);else for(ve in C)if(se=G.call(C[ve],ve,C[ve]),se===!1)break;return C},trim:function(C){return C==null?"":m.call(C)},makeArray:function(C,G){var Q=G||[];return C!=null&&(ae(Object(C))?w.merge(Q,typeof C=="string"?[C]:C):a.call(Q,C)),Q},inArray:function(C,G,Q){return G==null?-1:l.call(G,C,Q)},merge:function(C,G){for(var Q=+G.length,se=0,ve=C.length;se<Q;se++)C[ve++]=G[se];return C.length=ve,C},grep:function(C,G,Q){for(var se,ve=[],Ee=0,Be=C.length,Qe=!Q;Ee<Be;Ee++)se=!G(C[Ee],Ee),se!==Qe&&ve.push(C[Ee]);return ve},map:function(C,G,Q){var se,ve=0,Ee=C.length,Be=ae(C),Qe=[];if(Be)for(;ve<Ee;ve++)se=G(C[ve],ve,Q),se!=null&&Qe.push(se);else for(ve in C)se=G(C[ve],ve,Q),se!=null&&Qe.push(se);return s.apply([],Qe)},guid:1,proxy:function(C,G){var Q,se,ve;if(typeof G=="string"&&(Q=C[G],G=C,C=Q),!!w.isFunction(C))return se=r.call(arguments,2),ve=function(){return C.apply(G||this,se.concat(r.call(arguments)))},ve.guid=C.guid=C.guid||w.guid++,ve},now:Date.now,support:O}),w.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(C,G){d["[object "+G+"]"]=G.toLowerCase()});function ae(C){var G=C.length,Q=w.type(C);return Q==="function"||w.isWindow(C)?!1:C.nodeType===1&&G?!0:Q==="array"||G===0||typeof G=="number"&&G>0&&G-1 in C}var oe=function(C){var G,Q,se,ve,Ee,Be,Qe,yt,wt,mt,Kt,jt,hi,Ri,Gi,Cs,En,as="sizzle"+-new Date,ss=C.document,xi=0,Hs=0,$i=Yr(),Ps=Yr(),Ns=Yr(),br=function(Fe,tt){return Fe===tt&&(wt=!0),0},on="undefined",zn=1<<31,$n={}.hasOwnProperty,nn=[],rr=nn.pop,Gs=nn.push,or=nn.push,an=nn.slice,Sr=nn.indexOf||function(Fe){for(var tt=0,ft=this.length;tt<ft;tt++)if(this[tt]===Fe)return tt;return-1},rn="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",_s="[\\x20\\t\\r\\n\\f]",Ar="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",xn=Ar.replace("w","w#"),oo="\\["+_s+"*("+Ar+")"+_s+"*(?:([*^$|!~]?=)"+_s+`*(?:(['"])((?:\\\\.|[^\\\\])*?)\\3|(`+xn+")|)|)"+_s+"*\\]",Fr=":("+Ar+`)(?:\\(((['"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|`+oo.replace(3,8)+")*)|.*)\\)|)",Ss=new RegExp("^"+_s+"+|((?:^|[^\\\\])(?:\\\\.)*)"+_s+"+$","g"),wr=new RegExp("^"+_s+"*,"+_s+"*"),ao=new RegExp("^"+_s+"*([>+~]|"+_s+")"+_s+"*"),jo=new RegExp("="+_s+`*([^\\]'"]*?)`+_s+"*\\]","g"),Zo=new RegExp(Fr),rl=new RegExp("^"+xn+"$"),Eo={ID:new RegExp("^#("+Ar+")"),CLASS:new RegExp("^\\.("+Ar+")"),TAG:new RegExp("^("+Ar.replace("w","w*")+")"),ATTR:new RegExp("^"+oo),PSEUDO:new RegExp("^"+Fr),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+_s+"*(even|odd|(([+-]|)(\\d*)n|)"+_s+"*(?:([+-]|)"+_s+"*(\\d+)|))"+_s+"*\\)|)","i"),bool:new RegExp("^(?:"+rn+")$","i"),needsContext:new RegExp("^"+_s+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+_s+"*((?:-\\d)?\\d*)"+_s+"*\\)|)(?=[^-]|$)","i")},ol=/^(?:input|select|textarea|button)$/i,Ma=/^h\d$/i,Er=/^[^{]+\{\s*\[native \w/,qr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Qo=/[+~]/,Jo=/'|\\/g,ar=new RegExp("\\\\([\\da-f]{1,6}"+_s+"?|("+_s+")|.)","ig"),In=function(Fe,tt,ft){var Vt="0x"+tt-65536;return Vt!==Vt||ft?tt:Vt<0?String.fromCharCode(Vt+65536):String.fromCharCode(Vt>>10|55296,Vt&1023|56320)};try{or.apply(nn=an.call(ss.childNodes),ss.childNodes),nn[ss.childNodes.length].nodeType}catch{or={apply:nn.length?function(tt,ft){Gs.apply(tt,an.call(ft))}:function(tt,ft){for(var Vt=tt.length,Pt=0;tt[Vt++]=ft[Pt++];);tt.length=Vt-1}}}function vs(Fe,tt,ft,Vt){var Pt,qt,Ft,ri,Ai,Hi,Bi,Ii,us,ot;if((tt?tt.ownerDocument||tt:ss)!==Kt&&mt(tt),tt=tt||Kt,ft=ft||[],!Fe||typeof Fe!="string")return ft;if((ri=tt.nodeType)!==1&&ri!==9)return[];if(hi&&!Vt){if(Pt=qr.exec(Fe))if(Ft=Pt[1]){if(ri===9)if(qt=tt.getElementById(Ft),qt&&qt.parentNode){if(qt.id===Ft)return ft.push(qt),ft}else return ft;else if(tt.ownerDocument&&(qt=tt.ownerDocument.getElementById(Ft))&&En(tt,qt)&&qt.id===Ft)return ft.push(qt),ft}else{if(Pt[2])return or.apply(ft,tt.getElementsByTagName(Fe)),ft;if((Ft=Pt[3])&&Q.getElementsByClassName&&tt.getElementsByClassName)return or.apply(ft,tt.getElementsByClassName(Ft)),ft}if(Q.qsa&&(!Ri||!Ri.test(Fe))){if(Ii=Bi=as,us=tt,ot=ri===9&&Fe,ri===1&&tt.nodeName.toLowerCase()!=="object"){for(Hi=Lo(Fe),(Bi=tt.getAttribute("id"))?Ii=Bi.replace(Jo,"\\$&"):tt.setAttribute("id",Ii),Ii="[id='"+Ii+"'] ",Ai=Hi.length;Ai--;)Hi[Ai]=Ii+To(Hi[Ai]);us=Qo.test(Fe)&&Po(tt.parentNode)||tt,ot=Hi.join(",")}if(ot)try{return or.apply(ft,us.querySelectorAll(ot)),ft}catch{}finally{Bi||tt.removeAttribute("id")}}}return ra(Fe.replace(Ss,"$1"),tt,ft,Vt)}function Yr(){var Fe=[];function tt(ft,Vt){return Fe.push(ft+" ")>se.cacheLength&&delete tt[Fe.shift()],tt[ft+" "]=Vt}return tt}function Vn(Fe){return Fe[as]=!0,Fe}function hn(Fe){var tt=Kt.createElement("div");try{return!!Fe(tt)}catch{return!1}finally{tt.parentNode&&tt.parentNode.removeChild(tt),tt=null}}function lr(Fe,tt){for(var ft=Fe.split("|"),Vt=Fe.length;Vt--;)se.attrHandle[ft[Vt]]=tt}function On(Fe,tt){var ft=tt&&Fe,Vt=ft&&Fe.nodeType===1&&tt.nodeType===1&&(~tt.sourceIndex||zn)-(~Fe.sourceIndex||zn);if(Vt)return Vt;if(ft){for(;ft=ft.nextSibling;)if(ft===tt)return-1}return Fe?1:-1}function _n(Fe){return function(tt){var ft=tt.nodeName.toLowerCase();return ft==="input"&&tt.type===Fe}}function ea(Fe){return function(tt){var ft=tt.nodeName.toLowerCase();return(ft==="input"||ft==="button")&&tt.type===Fe}}function Mn(Fe){return Vn(function(tt){return tt=+tt,Vn(function(ft,Vt){for(var Pt,qt=Fe([],ft.length,tt),Ft=qt.length;Ft--;)ft[Pt=qt[Ft]]&&(ft[Pt]=!(Vt[Pt]=ft[Pt]))})})}function Po(Fe){return Fe&&typeof Fe.getElementsByTagName!==on&&Fe}Q=vs.support={},Ee=vs.isXML=function(Fe){var tt=Fe&&(Fe.ownerDocument||Fe).documentElement;return tt?tt.nodeName!=="HTML":!1},mt=vs.setDocument=function(Fe){var tt,ft=Fe?Fe.ownerDocument||Fe:ss,Vt=ft.defaultView;return ft===Kt||ft.nodeType!==9||!ft.documentElement?Kt:(Kt=ft,jt=ft.documentElement,hi=!Ee(ft),Vt&&Vt!==Vt.top&&(Vt.addEventListener?Vt.addEventListener("unload",function(){mt()},!1):Vt.attachEvent&&Vt.attachEvent("onunload",function(){mt()})),Q.attributes=hn(function(Pt){return Pt.className="i",!Pt.getAttribute("className")}),Q.getElementsByTagName=hn(function(Pt){return Pt.appendChild(ft.createComment("")),!Pt.getElementsByTagName("*").length}),Q.getElementsByClassName=Er.test(ft.getElementsByClassName)&&hn(function(Pt){return Pt.innerHTML="<div class='a'></div><div class='a i'></div>",Pt.firstChild.className="i",Pt.getElementsByClassName("i").length===2}),Q.getById=hn(function(Pt){return jt.appendChild(Pt).id=as,!ft.getElementsByName||!ft.getElementsByName(as).length}),Q.getById?(se.find.ID=function(Pt,qt){if(typeof qt.getElementById!==on&&hi){var Ft=qt.getElementById(Pt);return Ft&&Ft.parentNode?[Ft]:[]}},se.filter.ID=function(Pt){var qt=Pt.replace(ar,In);return function(Ft){return Ft.getAttribute("id")===qt}}):(delete se.find.ID,se.filter.ID=function(Pt){var qt=Pt.replace(ar,In);return function(Ft){var ri=typeof Ft.getAttributeNode!==on&&Ft.getAttributeNode("id");return ri&&ri.value===qt}}),se.find.TAG=Q.getElementsByTagName?function(Pt,qt){if(typeof qt.getElementsByTagName!==on)return qt.getElementsByTagName(Pt)}:function(Pt,qt){var Ft,ri=[],Ai=0,Hi=qt.getElementsByTagName(Pt);if(Pt==="*"){for(;Ft=Hi[Ai++];)Ft.nodeType===1&&ri.push(Ft);return ri}return Hi},se.find.CLASS=Q.getElementsByClassName&&function(Pt,qt){if(typeof qt.getElementsByClassName!==on&&hi)return qt.getElementsByClassName(Pt)},Gi=[],Ri=[],(Q.qsa=Er.test(ft.querySelectorAll))&&(hn(function(Pt){Pt.innerHTML="<select t=''><option selected=''></option></select>",Pt.querySelectorAll("[t^='']").length&&Ri.push("[*^$]="+_s+`*(?:''|"")`),Pt.querySelectorAll("[selected]").length||Ri.push("\\["+_s+"*(?:value|"+rn+")"),Pt.querySelectorAll(":checked").length||Ri.push(":checked")}),hn(function(Pt){var qt=ft.createElement("input");qt.setAttribute("type","hidden"),Pt.appendChild(qt).setAttribute("name","D"),Pt.querySelectorAll("[name=d]").length&&Ri.push("name"+_s+"*[*^$|!~]?="),Pt.querySelectorAll(":enabled").length||Ri.push(":enabled",":disabled"),Pt.querySelectorAll("*,:x"),Ri.push(",.*:")})),(Q.matchesSelector=Er.test(Cs=jt.webkitMatchesSelector||jt.mozMatchesSelector||jt.oMatchesSelector||jt.msMatchesSelector))&&hn(function(Pt){Q.disconnectedMatch=Cs.call(Pt,"div"),Cs.call(Pt,"[s!='']:x"),Gi.push("!=",Fr)}),Ri=Ri.length&&new RegExp(Ri.join("|")),Gi=Gi.length&&new RegExp(Gi.join("|")),tt=Er.test(jt.compareDocumentPosition),En=tt||Er.test(jt.contains)?function(Pt,qt){var Ft=Pt.nodeType===9?Pt.documentElement:Pt,ri=qt&&qt.parentNode;return Pt===ri||!!(ri&&ri.nodeType===1&&(Ft.contains?Ft.contains(ri):Pt.compareDocumentPosition&&Pt.compareDocumentPosition(ri)&16))}:function(Pt,qt){if(qt){for(;qt=qt.parentNode;)if(qt===Pt)return!0}return!1},br=tt?function(Pt,qt){if(Pt===qt)return wt=!0,0;var Ft=!Pt.compareDocumentPosition-!qt.compareDocumentPosition;return Ft||(Ft=(Pt.ownerDocument||Pt)===(qt.ownerDocument||qt)?Pt.compareDocumentPosition(qt):1,Ft&1||!Q.sortDetached&&qt.compareDocumentPosition(Pt)===Ft?Pt===ft||Pt.ownerDocument===ss&&En(ss,Pt)?-1:qt===ft||qt.ownerDocument===ss&&En(ss,qt)?1:yt?Sr.call(yt,Pt)-Sr.call(yt,qt):0:Ft&4?-1:1)}:function(Pt,qt){if(Pt===qt)return wt=!0,0;var Ft,ri=0,Ai=Pt.parentNode,Hi=qt.parentNode,Bi=[Pt],Ii=[qt];if(!Ai||!Hi)return Pt===ft?-1:qt===ft?1:Ai?-1:Hi?1:yt?Sr.call(yt,Pt)-Sr.call(yt,qt):0;if(Ai===Hi)return On(Pt,qt);for(Ft=Pt;Ft=Ft.parentNode;)Bi.unshift(Ft);for(Ft=qt;Ft=Ft.parentNode;)Ii.unshift(Ft);for(;Bi[ri]===Ii[ri];)ri++;return ri?On(Bi[ri],Ii[ri]):Bi[ri]===ss?-1:Ii[ri]===ss?1:0},ft)},vs.matches=function(Fe,tt){return vs(Fe,null,null,tt)},vs.matchesSelector=function(Fe,tt){if((Fe.ownerDocument||Fe)!==Kt&&mt(Fe),tt=tt.replace(jo,"='$1']"),Q.matchesSelector&&hi&&(!Gi||!Gi.test(tt))&&(!Ri||!Ri.test(tt)))try{var ft=Cs.call(Fe,tt);if(ft||Q.disconnectedMatch||Fe.document&&Fe.document.nodeType!==11)return ft}catch{}return vs(tt,Kt,null,[Fe]).length>0},vs.contains=function(Fe,tt){return(Fe.ownerDocument||Fe)!==Kt&&mt(Fe),En(Fe,tt)},vs.attr=function(Fe,tt){(Fe.ownerDocument||Fe)!==Kt&&mt(Fe);var ft=se.attrHandle[tt.toLowerCase()],Vt=ft&&$n.call(se.attrHandle,tt.toLowerCase())?ft(Fe,tt,!hi):void 0;return Vt!==void 0?Vt:Q.attributes||!hi?Fe.getAttribute(tt):(Vt=Fe.getAttributeNode(tt))&&Vt.specified?Vt.value:null},vs.error=function(Fe){throw new Error("Syntax error, unrecognized expression: "+Fe)},vs.uniqueSort=function(Fe){var tt,ft=[],Vt=0,Pt=0;if(wt=!Q.detectDuplicates,yt=!Q.sortStable&&Fe.slice(0),Fe.sort(br),wt){for(;tt=Fe[Pt++];)tt===Fe[Pt]&&(Vt=ft.push(Pt));for(;Vt--;)Fe.splice(ft[Vt],1)}return yt=null,Fe},ve=vs.getText=function(Fe){var tt,ft="",Vt=0,Pt=Fe.nodeType;if(Pt){if(Pt===1||Pt===9||Pt===11){if(typeof Fe.textContent=="string")return Fe.textContent;for(Fe=Fe.firstChild;Fe;Fe=Fe.nextSibling)ft+=ve(Fe)}else if(Pt===3||Pt===4)return Fe.nodeValue}else for(;tt=Fe[Vt++];)ft+=ve(tt);return ft},se=vs.selectors={cacheLength:50,createPseudo:Vn,match:Eo,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(Fe){return Fe[1]=Fe[1].replace(ar,In),Fe[3]=(Fe[4]||Fe[5]||"").replace(ar,In),Fe[2]==="~="&&(Fe[3]=" "+Fe[3]+" "),Fe.slice(0,4)},CHILD:function(Fe){return Fe[1]=Fe[1].toLowerCase(),Fe[1].slice(0,3)==="nth"?(Fe[3]||vs.error(Fe[0]),Fe[4]=+(Fe[4]?Fe[5]+(Fe[6]||1):2*(Fe[3]==="even"||Fe[3]==="odd")),Fe[5]=+(Fe[7]+Fe[8]||Fe[3]==="odd")):Fe[3]&&vs.error(Fe[0]),Fe},PSEUDO:function(Fe){var tt,ft=!Fe[5]&&Fe[2];return Eo.CHILD.test(Fe[0])?null:(Fe[3]&&Fe[4]!==void 0?Fe[2]=Fe[4]:ft&&Zo.test(ft)&&(tt=Lo(ft,!0))&&(tt=ft.indexOf(")",ft.length-tt)-ft.length)&&(Fe[0]=Fe[0].slice(0,tt),Fe[2]=ft.slice(0,tt)),Fe.slice(0,3))}},filter:{TAG:function(Fe){var tt=Fe.replace(ar,In).toLowerCase();return Fe==="*"?function(){return!0}:function(ft){return ft.nodeName&&ft.nodeName.toLowerCase()===tt}},CLASS:function(Fe){var tt=$i[Fe+" "];return tt||(tt=new RegExp("(^|"+_s+")"+Fe+"("+_s+"|$)"))&&$i(Fe,function(ft){return tt.test(typeof ft.className=="string"&&ft.className||typeof ft.getAttribute!==on&&ft.getAttribute("class")||"")})},ATTR:function(Fe,tt,ft){return function(Vt){var Pt=vs.attr(Vt,Fe);return Pt==null?tt==="!=":tt?(Pt+="",tt==="="?Pt===ft:tt==="!="?Pt!==ft:tt==="^="?ft&&Pt.indexOf(ft)===0:tt==="*="?ft&&Pt.indexOf(ft)>-1:tt==="$="?ft&&Pt.slice(-ft.length)===ft:tt==="~="?(" "+Pt+" ").indexOf(ft)>-1:tt==="|="?Pt===ft||Pt.slice(0,ft.length+1)===ft+"-":!1):!0}},CHILD:function(Fe,tt,ft,Vt,Pt){var qt=Fe.slice(0,3)!=="nth",Ft=Fe.slice(-4)!=="last",ri=tt==="of-type";return Vt===1&&Pt===0?function(Ai){return!!Ai.parentNode}:function(Ai,Hi,Bi){var Ii,us,ot,Ct,Lt,si,wi=qt!==Ft?"nextSibling":"previousSibling",Ei=Ai.parentNode,xs=ri&&Ai.nodeName.toLowerCase(),cs=!Bi&&!ri;if(Ei){if(qt){for(;wi;){for(ot=Ai;ot=ot[wi];)if(ri?ot.nodeName.toLowerCase()===xs:ot.nodeType===1)return!1;si=wi=Fe==="only"&&!si&&"nextSibling"}return!0}if(si=[Ft?Ei.firstChild:Ei.lastChild],Ft&&cs){for(us=Ei[as]||(Ei[as]={}),Ii=us[Fe]||[],Lt=Ii[0]===xi&&Ii[1],Ct=Ii[0]===xi&&Ii[2],ot=Lt&&Ei.childNodes[Lt];ot=++Lt&&ot&&ot[wi]||(Ct=Lt=0)||si.pop();)if(ot.nodeType===1&&++Ct&&ot===Ai){us[Fe]=[xi,Lt,Ct];break}}else if(cs&&(Ii=(Ai[as]||(Ai[as]={}))[Fe])&&Ii[0]===xi)Ct=Ii[1];else for(;(ot=++Lt&&ot&&ot[wi]||(Ct=Lt=0)||si.pop())&&!((ri?ot.nodeName.toLowerCase()===xs:ot.nodeType===1)&&++Ct&&(cs&&((ot[as]||(ot[as]={}))[Fe]=[xi,Ct]),ot===Ai)););return Ct-=Pt,Ct===Vt||Ct%Vt===0&&Ct/Vt>=0}}},PSEUDO:function(Fe,tt){var ft,Vt=se.pseudos[Fe]||se.setFilters[Fe.toLowerCase()]||vs.error("unsupported pseudo: "+Fe);return Vt[as]?Vt(tt):Vt.length>1?(ft=[Fe,Fe,"",tt],se.setFilters.hasOwnProperty(Fe.toLowerCase())?Vn(function(Pt,qt){for(var Ft,ri=Vt(Pt,tt),Ai=ri.length;Ai--;)Ft=Sr.call(Pt,ri[Ai]),Pt[Ft]=!(qt[Ft]=ri[Ai])}):function(Pt){return Vt(Pt,0,ft)}):Vt}},pseudos:{not:Vn(function(Fe){var tt=[],ft=[],Vt=Be(Fe.replace(Ss,"$1"));return Vt[as]?Vn(function(Pt,qt,Ft,ri){for(var Ai,Hi=Vt(Pt,null,ri,[]),Bi=Pt.length;Bi--;)(Ai=Hi[Bi])&&(Pt[Bi]=!(qt[Bi]=Ai))}):function(Pt,qt,Ft){return tt[0]=Pt,Vt(tt,null,Ft,ft),!ft.pop()}}),has:Vn(function(Fe){return function(tt){return vs(Fe,tt).length>0}}),contains:Vn(function(Fe){return function(tt){return(tt.textContent||tt.innerText||ve(tt)).indexOf(Fe)>-1}}),lang:Vn(function(Fe){return rl.test(Fe||"")||vs.error("unsupported lang: "+Fe),Fe=Fe.replace(ar,In).toLowerCase(),function(tt){var ft;do if(ft=hi?tt.lang:tt.getAttribute("xml:lang")||tt.getAttribute("lang"))return ft=ft.toLowerCase(),ft===Fe||ft.indexOf(Fe+"-")===0;while((tt=tt.parentNode)&&tt.nodeType===1);return!1}}),target:function(Fe){var tt=C.location&&C.location.hash;return tt&&tt.slice(1)===Fe.id},root:function(Fe){return Fe===jt},focus:function(Fe){return Fe===Kt.activeElement&&(!Kt.hasFocus||Kt.hasFocus())&&!!(Fe.type||Fe.href||~Fe.tabIndex)},enabled:function(Fe){return Fe.disabled===!1},disabled:function(Fe){return Fe.disabled===!0},checked:function(Fe){var tt=Fe.nodeName.toLowerCase();return tt==="input"&&!!Fe.checked||tt==="option"&&!!Fe.selected},selected:function(Fe){return Fe.parentNode&&Fe.parentNode.selectedIndex,Fe.selected===!0},empty:function(Fe){for(Fe=Fe.firstChild;Fe;Fe=Fe.nextSibling)if(Fe.nodeType<6)return!1;return!0},parent:function(Fe){return!se.pseudos.empty(Fe)},header:function(Fe){return Ma.test(Fe.nodeName)},input:function(Fe){return ol.test(Fe.nodeName)},button:function(Fe){var tt=Fe.nodeName.toLowerCase();return tt==="input"&&Fe.type==="button"||tt==="button"},text:function(Fe){var tt;return Fe.nodeName.toLowerCase()==="input"&&Fe.type==="text"&&((tt=Fe.getAttribute("type"))==null||tt.toLowerCase()==="text")},first:Mn(function(){return[0]}),last:Mn(function(Fe,tt){return[tt-1]}),eq:Mn(function(Fe,tt,ft){return[ft<0?ft+tt:ft]}),even:Mn(function(Fe,tt){for(var ft=0;ft<tt;ft+=2)Fe.push(ft);return Fe}),odd:Mn(function(Fe,tt){for(var ft=1;ft<tt;ft+=2)Fe.push(ft);return Fe}),lt:Mn(function(Fe,tt,ft){for(var Vt=ft<0?ft+tt:ft;--Vt>=0;)Fe.push(Vt);return Fe}),gt:Mn(function(Fe,tt,ft){for(var Vt=ft<0?ft+tt:ft;++Vt<tt;)Fe.push(Vt);return Fe})}},se.pseudos.nth=se.pseudos.eq;for(G in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})se.pseudos[G]=_n(G);for(G in{submit:!0,reset:!0})se.pseudos[G]=ea(G);function ta(){}ta.prototype=se.filters=se.pseudos,se.setFilters=new ta;function Lo(Fe,tt){var ft,Vt,Pt,qt,Ft,ri,Ai,Hi=Ps[Fe+" "];if(Hi)return tt?0:Hi.slice(0);for(Ft=Fe,ri=[],Ai=se.preFilter;Ft;){(!ft||(Vt=wr.exec(Ft)))&&(Vt&&(Ft=Ft.slice(Vt[0].length)||Ft),ri.push(Pt=[])),ft=!1,(Vt=ao.exec(Ft))&&(ft=Vt.shift(),Pt.push({value:ft,type:Vt[0].replace(Ss," ")}),Ft=Ft.slice(ft.length));for(qt in se.filter)(Vt=Eo[qt].exec(Ft))&&(!Ai[qt]||(Vt=Ai[qt](Vt)))&&(ft=Vt.shift(),Pt.push({value:ft,type:qt,matches:Vt}),Ft=Ft.slice(ft.length));if(!ft)break}return tt?Ft.length:Ft?vs.error(Fe):Ps(Fe,ri).slice(0)}function To(Fe){for(var tt=0,ft=Fe.length,Vt="";tt<ft;tt++)Vt+=Fe[tt].value;return Vt}function ia(Fe,tt,ft){var Vt=tt.dir,Pt=ft&&Vt==="parentNode",qt=Hs++;return tt.first?function(Ft,ri,Ai){for(;Ft=Ft[Vt];)if(Ft.nodeType===1||Pt)return Fe(Ft,ri,Ai)}:function(Ft,ri,Ai){var Hi,Bi,Ii=[xi,qt];if(Ai){for(;Ft=Ft[Vt];)if((Ft.nodeType===1||Pt)&&Fe(Ft,ri,Ai))return!0}else for(;Ft=Ft[Vt];)if(Ft.nodeType===1||Pt){if(Bi=Ft[as]||(Ft[as]={}),(Hi=Bi[Vt])&&Hi[0]===xi&&Hi[1]===qt)return Ii[2]=Hi[2];if(Bi[Vt]=Ii,Ii[2]=Fe(Ft,ri,Ai))return!0}}}function sa(Fe){return Fe.length>1?function(tt,ft,Vt){for(var Pt=Fe.length;Pt--;)if(!Fe[Pt](tt,ft,Vt))return!1;return!0}:Fe[0]}function Co(Fe,tt,ft,Vt,Pt){for(var qt,Ft=[],ri=0,Ai=Fe.length,Hi=tt!=null;ri<Ai;ri++)(qt=Fe[ri])&&(!ft||ft(qt,Vt,Pt))&&(Ft.push(qt),Hi&&tt.push(ri));return Ft}function Pr(Fe,tt,ft,Vt,Pt,qt){return Vt&&!Vt[as]&&(Vt=Pr(Vt)),Pt&&!Pt[as]&&(Pt=Pr(Pt,qt)),Vn(function(Ft,ri,Ai,Hi){var Bi,Ii,us,ot=[],Ct=[],Lt=ri.length,si=Ft||vn(tt||"*",Ai.nodeType?[Ai]:Ai,[]),wi=Fe&&(Ft||!tt)?Co(si,ot,Fe,Ai,Hi):si,Ei=ft?Pt||(Ft?Fe:Lt||Vt)?[]:ri:wi;if(ft&&ft(wi,Ei,Ai,Hi),Vt)for(Bi=Co(Ei,Ct),Vt(Bi,[],Ai,Hi),Ii=Bi.length;Ii--;)(us=Bi[Ii])&&(Ei[Ct[Ii]]=!(wi[Ct[Ii]]=us));if(Ft){if(Pt||Fe){if(Pt){for(Bi=[],Ii=Ei.length;Ii--;)(us=Ei[Ii])&&Bi.push(wi[Ii]=us);Pt(null,Ei=[],Bi,Hi)}for(Ii=Ei.length;Ii--;)(us=Ei[Ii])&&(Bi=Pt?Sr.call(Ft,us):ot[Ii])>-1&&(Ft[Bi]=!(ri[Bi]=us))}}else Ei=Co(Ei===ri?Ei.splice(Lt,Ei.length):Ei),Pt?Pt(null,ri,Ei,Hi):or.apply(ri,Ei)})}function na(Fe){for(var tt,ft,Vt,Pt=Fe.length,qt=se.relative[Fe[0].type],Ft=qt||se.relative[" "],ri=qt?1:0,Ai=ia(function(Ii){return Ii===tt},Ft,!0),Hi=ia(function(Ii){return Sr.call(tt,Ii)>-1},Ft,!0),Bi=[function(Ii,us,ot){return!qt&&(ot||us!==Qe)||((tt=us).nodeType?Ai(Ii,us,ot):Hi(Ii,us,ot))}];ri<Pt;ri++)if(ft=se.relative[Fe[ri].type])Bi=[ia(sa(Bi),ft)];else{if(ft=se.filter[Fe[ri].type].apply(null,Fe[ri].matches),ft[as]){for(Vt=++ri;Vt<Pt&&!se.relative[Fe[Vt].type];Vt++);return Pr(ri>1&&sa(Bi),ri>1&&To(Fe.slice(0,ri-1).concat({value:Fe[ri-2].type===" "?"*":""})).replace(Ss,"$1"),ft,ri<Vt&&na(Fe.slice(ri,Vt)),Vt<Pt&&na(Fe=Fe.slice(Vt)),Vt<Pt&&To(Fe))}Bi.push(ft)}return sa(Bi)}function ka(Fe,tt){var ft=tt.length>0,Vt=Fe.length>0,Pt=function(qt,Ft,ri,Ai,Hi){var Bi,Ii,us,ot=0,Ct="0",Lt=qt&&[],si=[],wi=Qe,Ei=qt||Vt&&se.find.TAG("*",Hi),xs=xi+=wi==null?1:Math.random()||.1,cs=Ei.length;for(Hi&&(Qe=Ft!==Kt&&Ft);Ct!==cs&&(Bi=Ei[Ct])!=null;Ct++){if(Vt&&Bi){for(Ii=0;us=Fe[Ii++];)if(us(Bi,Ft,ri)){Ai.push(Bi);break}Hi&&(xi=xs)}ft&&((Bi=!us&&Bi)&&ot--,qt&&Lt.push(Bi))}if(ot+=Ct,ft&&Ct!==ot){for(Ii=0;us=tt[Ii++];)us(Lt,si,Ft,ri);if(qt){if(ot>0)for(;Ct--;)Lt[Ct]||si[Ct]||(si[Ct]=rr.call(Ai));si=Co(si)}or.apply(Ai,si),Hi&&!qt&&si.length>0&&ot+tt.length>1&&vs.uniqueSort(Ai)}return Hi&&(xi=xs,Qe=wi),Lt};return ft?Vn(Pt):Pt}Be=vs.compile=function(Fe,tt){var ft,Vt=[],Pt=[],qt=Ns[Fe+" "];if(!qt){for(tt||(tt=Lo(Fe)),ft=tt.length;ft--;)qt=na(tt[ft]),qt[as]?Vt.push(qt):Pt.push(qt);qt=Ns(Fe,ka(Pt,Vt))}return qt};function vn(Fe,tt,ft){for(var Vt=0,Pt=tt.length;Vt<Pt;Vt++)vs(Fe,tt[Vt],ft);return ft}function ra(Fe,tt,ft,Vt){var Pt,qt,Ft,ri,Ai,Hi=Lo(Fe);if(!Vt&&Hi.length===1){if(qt=Hi[0]=Hi[0].slice(0),qt.length>2&&(Ft=qt[0]).type==="ID"&&Q.getById&&tt.nodeType===9&&hi&&se.relative[qt[1].type]){if(tt=(se.find.ID(Ft.matches[0].replace(ar,In),tt)||[])[0],!tt)return ft;Fe=Fe.slice(qt.shift().value.length)}for(Pt=Eo.needsContext.test(Fe)?0:qt.length;Pt--&&(Ft=qt[Pt],!se.relative[ri=Ft.type]);)if((Ai=se.find[ri])&&(Vt=Ai(Ft.matches[0].replace(ar,In),Qo.test(qt[0].type)&&Po(tt.parentNode)||tt))){if(qt.splice(Pt,1),Fe=Vt.length&&To(qt),!Fe)return or.apply(ft,Vt),ft;break}}return Be(Fe,Hi)(Vt,tt,!hi,ft,Qo.test(Fe)&&Po(tt.parentNode)||tt),ft}return Q.sortStable=as.split("").sort(br).join("")===as,Q.detectDuplicates=!!wt,mt(),Q.sortDetached=hn(function(Fe){return Fe.compareDocumentPosition(Kt.createElement("div"))&1}),hn(function(Fe){return Fe.innerHTML="<a href='#'></a>",Fe.firstChild.getAttribute("href")==="#"})||lr("type|href|height|width",function(Fe,tt,ft){if(!ft)return Fe.getAttribute(tt,tt.toLowerCase()==="type"?1:2)}),(!Q.attributes||!hn(function(Fe){return Fe.innerHTML="<input/>",Fe.firstChild.setAttribute("value",""),Fe.firstChild.getAttribute("value")===""}))&&lr("value",function(Fe,tt,ft){if(!ft&&Fe.nodeName.toLowerCase()==="input")return Fe.defaultValue}),hn(function(Fe){return Fe.getAttribute("disabled")==null})||lr(rn,function(Fe,tt,ft){var Vt;if(!ft)return Fe[tt]===!0?tt.toLowerCase():(Vt=Fe.getAttributeNode(tt))&&Vt.specified?Vt.value:null}),vs}(e);w.find=oe,w.expr=oe.selectors,w.expr[":"]=w.expr.pseudos,w.unique=oe.uniqueSort,w.text=oe.getText,w.isXMLDoc=oe.isXML,w.contains=oe.contains;var ue=w.expr.match.needsContext,fe=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,be=/^.[^:#\[\.,]*$/;function Ae(C,G,Q){if(w.isFunction(G))return w.grep(C,function(se,ve){return!!G.call(se,ve,se)!==Q});if(G.nodeType)return w.grep(C,function(se){return se===G!==Q});if(typeof G=="string"){if(be.test(G))return w.filter(G,C,Q);G=w.filter(G,C)}return w.grep(C,function(se){return l.call(G,se)>=0!==Q})}w.filter=function(C,G,Q){var se=G[0];return Q&&(C=":not("+C+")"),G.length===1&&se.nodeType===1?w.find.matchesSelector(se,C)?[se]:[]:w.find.matches(C,w.grep(G,function(ve){return ve.nodeType===1}))},w.fn.extend({find:function(C){var G,Q=this.length,se=[],ve=this;if(typeof C!="string")return this.pushStack(w(C).filter(function(){for(G=0;G<Q;G++)if(w.contains(ve[G],this))return!0}));for(G=0;G<Q;G++)w.find(C,ve[G],se);return se=this.pushStack(Q>1?w.unique(se):se),se.selector=this.selector?this.selector+" "+C:C,se},filter:function(C){return this.pushStack(Ae(this,C||[],!1))},not:function(C){return this.pushStack(Ae(this,C||[],!0))},is:function(C){return!!Ae(this,typeof C=="string"&&ue.test(C)?w(C):C||[],!1).length}});var W,J=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,Ue=w.fn.init=function(C,G){var Q,se;if(!C)return this;if(typeof C=="string")if(C[0]==="<"&&C[C.length-1]===">"&&C.length>=3?Q=[null,C,null]:Q=J.exec(C),Q&&(Q[1]||!G))if(Q[1]){if(G=G instanceof w?G[0]:G,w.merge(this,w.parseHTML(Q[1],G&&G.nodeType?G.ownerDocument||G:D,!0)),fe.test(Q[1])&&w.isPlainObject(G))for(Q in G)w.isFunction(this[Q])?this[Q](G[Q]):this.attr(Q,G[Q]);return this}else return se=D.getElementById(Q[2]),se&&se.parentNode&&(this.length=1,this[0]=se),this.context=D,this.selector=C,this;else return!G||G.jquery?(G||W).find(C):this.constructor(G).find(C);else{if(C.nodeType)return this.context=this[0]=C,this.length=1,this;if(w.isFunction(C))return typeof W.ready<"u"?W.ready(C):C(w)}return C.selector!==void 0&&(this.selector=C.selector,this.context=C.context),w.makeArray(C,this)};Ue.prototype=w.fn,W=w(D);var gt=/^(?:parents|prev(?:Until|All))/,Te={children:!0,contents:!0,next:!0,prev:!0};w.extend({dir:function(C,G,Q){for(var se=[],ve=Q!==void 0;(C=C[G])&&C.nodeType!==9;)if(C.nodeType===1){if(ve&&w(C).is(Q))break;se.push(C)}return se},sibling:function(C,G){for(var Q=[];C;C=C.nextSibling)C.nodeType===1&&C!==G&&Q.push(C);return Q}}),w.fn.extend({has:function(C){var G=w(C,this),Q=G.length;return this.filter(function(){for(var se=0;se<Q;se++)if(w.contains(this,G[se]))return!0})},closest:function(C,G){for(var Q,se=0,ve=this.length,Ee=[],Be=ue.test(C)||typeof C!="string"?w(C,G||this.context):0;se<ve;se++)for(Q=this[se];Q&&Q!==G;Q=Q.parentNode)if(Q.nodeType<11&&(Be?Be.index(Q)>-1:Q.nodeType===1&&w.find.matchesSelector(Q,C))){Ee.push(Q);break}return this.pushStack(Ee.length>1?w.unique(Ee):Ee)},index:function(C){return C?typeof C=="string"?l.call(w(C),this[0]):l.call(this,C.jquery?C[0]:C):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(C,G){return this.pushStack(w.unique(w.merge(this.get(),w(C,G))))},addBack:function(C){return this.add(C==null?this.prevObject:this.prevObject.filter(C))}});function Et(C,G){for(;(C=C[G])&&C.nodeType!==1;);return C}w.each({parent:function(C){var G=C.parentNode;return G&&G.nodeType!==11?G:null},parents:function(C){return w.dir(C,"parentNode")},parentsUntil:function(C,G,Q){return w.dir(C,"parentNode",Q)},next:function(C){return Et(C,"nextSibling")},prev:function(C){return Et(C,"previousSibling")},nextAll:function(C){return w.dir(C,"nextSibling")},prevAll:function(C){return w.dir(C,"previousSibling")},nextUntil:function(C,G,Q){return w.dir(C,"nextSibling",Q)},prevUntil:function(C,G,Q){return w.dir(C,"previousSibling",Q)},siblings:function(C){return w.sibling((C.parentNode||{}).firstChild,C)},children:function(C){return w.sibling(C.firstChild)},contents:function(C){return C.contentDocument||w.merge([],C.childNodes)}},function(C,G){w.fn[C]=function(Q,se){var ve=w.map(this,G,Q);return C.slice(-5)!=="Until"&&(se=Q),se&&typeof se=="string"&&(ve=w.filter(se,ve)),this.length>1&&(Te[C]||w.unique(ve),gt.test(C)&&ve.reverse()),this.pushStack(ve)}});var Bt=/\S+/g,Ke={};function At(C){var G=Ke[C]={};return w.each(C.match(Bt)||[],function(Q,se){G[se]=!0}),G}w.Callbacks=function(C){C=typeof C=="string"?Ke[C]||At(C):w.extend({},C);var G,Q,se,ve,Ee,Be,Qe=[],yt=!C.once&&[],wt=function(Kt){for(G=C.memory&&Kt,Q=!0,Be=ve||0,ve=0,Ee=Qe.length,se=!0;Qe&&Be<Ee;Be++)if(Qe[Be].apply(Kt[0],Kt[1])===!1&&C.stopOnFalse){G=!1;break}se=!1,Qe&&(yt?yt.length&&wt(yt.shift()):G?Qe=[]:mt.disable())},mt={add:function(){if(Qe){var Kt=Qe.length;(function jt(hi){w.each(hi,function(Ri,Gi){var Cs=w.type(Gi);Cs==="function"?(!C.unique||!mt.has(Gi))&&Qe.push(Gi):Gi&&Gi.length&&Cs!=="string"&&jt(Gi)})})(arguments),se?Ee=Qe.length:G&&(ve=Kt,wt(G))}return this},remove:function(){return Qe&&w.each(arguments,function(Kt,jt){for(var hi;(hi=w.inArray(jt,Qe,hi))>-1;)Qe.splice(hi,1),se&&(hi<=Ee&&Ee--,hi<=Be&&Be--)}),this},has:function(Kt){return Kt?w.inArray(Kt,Qe)>-1:!!(Qe&&Qe.length)},empty:function(){return Qe=[],Ee=0,this},disable:function(){return Qe=yt=G=void 0,this},disabled:function(){return!Qe},lock:function(){return yt=void 0,G||mt.disable(),this},locked:function(){return!yt},fireWith:function(Kt,jt){return Qe&&(!Q||yt)&&(jt=jt||[],jt=[Kt,jt.slice?jt.slice():jt],se?yt.push(jt):wt(jt)),this},fire:function(){return mt.fireWith(this,arguments),this},fired:function(){return!!Q}};return mt},w.extend({Deferred:function(C){var G=[["resolve","done",w.Callbacks("once memory"),"resolved"],["reject","fail",w.Callbacks("once memory"),"rejected"],["notify","progress",w.Callbacks("memory")]],Q="pending",se={state:function(){return Q},always:function(){return ve.done(arguments).fail(arguments),this},then:function(){var Ee=arguments;return w.Deferred(function(Be){w.each(G,function(Qe,yt){var wt=w.isFunction(Ee[Qe])&&Ee[Qe];ve[yt[1]](function(){var mt=wt&&wt.apply(this,arguments);mt&&w.isFunction(mt.promise)?mt.promise().done(Be.resolve).fail(Be.reject).progress(Be.notify):Be[yt[0]+"With"](this===se?Be.promise():this,wt?[mt]:arguments)})}),Ee=null}).promise()},promise:function(Ee){return Ee!=null?w.extend(Ee,se):se}},ve={};return se.pipe=se.then,w.each(G,function(Ee,Be){var Qe=Be[2],yt=Be[3];se[Be[1]]=Qe.add,yt&&Qe.add(function(){Q=yt},G[Ee^1][2].disable,G[2][2].lock),ve[Be[0]]=function(){return ve[Be[0]+"With"](this===ve?se:this,arguments),this},ve[Be[0]+"With"]=Qe.fireWith}),se.promise(ve),C&&C.call(ve,ve),ve},when:function(C){var G=0,Q=r.call(arguments),se=Q.length,ve=se!==1||C&&w.isFunction(C.promise)?se:0,Ee=ve===1?C:w.Deferred(),Be=function(mt,Kt,jt){return function(hi){Kt[mt]=this,jt[mt]=arguments.length>1?r.call(arguments):hi,jt===Qe?Ee.notifyWith(Kt,jt):--ve||Ee.resolveWith(Kt,jt)}},Qe,yt,wt;if(se>1)for(Qe=new Array(se),yt=new Array(se),wt=new Array(se);G<se;G++)Q[G]&&w.isFunction(Q[G].promise)?Q[G].promise().done(Be(G,wt,Q)).fail(Ee.reject).progress(Be(G,yt,Qe)):--ve;return ve||Ee.resolveWith(wt,Q),Ee.promise()}});var nt;w.fn.ready=function(C){return w.ready.promise().done(C),this},w.extend({isReady:!1,readyWait:1,holdReady:function(C){C?w.readyWait++:w.ready(!0)},ready:function(C){(C===!0?--w.readyWait:w.isReady)||(w.isReady=!0,!(C!==!0&&--w.readyWait>0)&&(nt.resolveWith(D,[w]),w.fn.trigger&&w(D).trigger("ready").off("ready")))}});function dt(){D.removeEventListener("DOMContentLoaded",dt,!1),e.removeEventListener("load",dt,!1),w.ready()}w.ready.promise=function(C){return nt||(nt=w.Deferred(),D.readyState==="complete"?setTimeout(w.ready):(D.addEventListener("DOMContentLoaded",dt,!1),e.addEventListener("load",dt,!1))),nt.promise(C)},w.ready.promise();var Mt=w.access=function(C,G,Q,se,ve,Ee,Be){var Qe=0,yt=C.length,wt=Q==null;if(w.type(Q)==="object"){ve=!0;for(Qe in Q)w.access(C,G,Qe,Q[Qe],!0,Ee,Be)}else if(se!==void 0&&(ve=!0,w.isFunction(se)||(Be=!0),wt&&(Be?(G.call(C,se),G=null):(wt=G,G=function(mt,Kt,jt){return wt.call(w(mt),jt)})),G))for(;Qe<yt;Qe++)G(C[Qe],Q,Be?se:se.call(C[Qe],Qe,G(C[Qe],Q)));return ve?C:wt?G.call(C):yt?G(C[0],Q):Ee};w.acceptData=function(C){return C.nodeType===1||C.nodeType===9||!+C.nodeType};function zt(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=w.expando+Math.random()}zt.uid=1,zt.accepts=w.acceptData,zt.prototype={key:function(C){if(!zt.accepts(C))return 0;var G={},Q=C[this.expando];if(!Q){Q=zt.uid++;try{G[this.expando]={value:Q},Object.defineProperties(C,G)}catch{G[this.expando]=Q,w.extend(C,G)}}return this.cache[Q]||(this.cache[Q]={}),Q},set:function(C,G,Q){var se,ve=this.key(C),Ee=this.cache[ve];if(typeof G=="string")Ee[G]=Q;else if(w.isEmptyObject(Ee))w.extend(this.cache[ve],G);else for(se in G)Ee[se]=G[se];return Ee},get:function(C,G){var Q=this.cache[this.key(C)];return G===void 0?Q:Q[G]},access:function(C,G,Q){var se;return G===void 0||G&&typeof G=="string"&&Q===void 0?(se=this.get(C,G),se!==void 0?se:this.get(C,w.camelCase(G))):(this.set(C,G,Q),Q!==void 0?Q:G)},remove:function(C,G){var Q,se,ve,Ee=this.key(C),Be=this.cache[Ee];if(G===void 0)this.cache[Ee]={};else for(w.isArray(G)?se=G.concat(G.map(w.camelCase)):(ve=w.camelCase(G),G in Be?se=[G,ve]:(se=ve,se=se in Be?[se]:se.match(Bt)||[])),Q=se.length;Q--;)delete Be[se[Q]]},hasData:function(C){return!w.isEmptyObject(this.cache[C[this.expando]]||{})},discard:function(C){C[this.expando]&&delete this.cache[C[this.expando]]}};var xt=new zt,Gt=new zt,yi=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,ti=/([A-Z])/g;function Mi(C,G,Q){var se;if(Q===void 0&&C.nodeType===1)if(se="data-"+G.replace(ti,"-$1").toLowerCase(),Q=C.getAttribute(se),typeof Q=="string"){try{Q=Q==="true"?!0:Q==="false"?!1:Q==="null"?null:+Q+""===Q?+Q:yi.test(Q)?w.parseJSON(Q):Q}catch{}Gt.set(C,G,Q)}else Q=void 0;return Q}w.extend({hasData:function(C){return Gt.hasData(C)||xt.hasData(C)},data:function(C,G,Q){return Gt.access(C,G,Q)},removeData:function(C,G){Gt.remove(C,G)},_data:function(C,G,Q){return xt.access(C,G,Q)},_removeData:function(C,G){xt.remove(C,G)}}),w.fn.extend({data:function(C,G){var Q,se,ve,Ee=this[0],Be=Ee&&Ee.attributes;if(C===void 0){if(this.length&&(ve=Gt.get(Ee),Ee.nodeType===1&&!xt.get(Ee,"hasDataAttrs"))){for(Q=Be.length;Q--;)se=Be[Q].name,se.indexOf("data-")===0&&(se=w.camelCase(se.slice(5)),Mi(Ee,se,ve[se]));xt.set(Ee,"hasDataAttrs",!0)}return ve}return typeof C=="object"?this.each(function(){Gt.set(this,C)}):Mt(this,function(Qe){var yt,wt=w.camelCase(C);if(Ee&&Qe===void 0)return yt=Gt.get(Ee,C),yt!==void 0||(yt=Gt.get(Ee,wt),yt!==void 0)||(yt=Mi(Ee,wt,void 0),yt!==void 0)?yt:void 0;this.each(function(){var mt=Gt.get(this,wt);Gt.set(this,wt,Qe),C.indexOf("-")!==-1&&mt!==void 0&&Gt.set(this,C,Qe)})},null,G,arguments.length>1,null,!0)},removeData:function(C){return this.each(function(){Gt.remove(this,C)})}}),w.extend({queue:function(C,G,Q){var se;if(C)return G=(G||"fx")+"queue",se=xt.get(C,G),Q&&(!se||w.isArray(Q)?se=xt.access(C,G,w.makeArray(Q)):se.push(Q)),se||[]},dequeue:function(C,G){G=G||"fx";var Q=w.queue(C,G),se=Q.length,ve=Q.shift(),Ee=w._queueHooks(C,G),Be=function(){w.dequeue(C,G)};ve==="inprogress"&&(ve=Q.shift(),se--),ve&&(G==="fx"&&Q.unshift("inprogress"),delete Ee.stop,ve.call(C,Be,Ee)),!se&&Ee&&Ee.empty.fire()},_queueHooks:function(C,G){var Q=G+"queueHooks";return xt.get(C,Q)||xt.access(C,Q,{empty:w.Callbacks("once memory").add(function(){xt.remove(C,[G+"queue",Q])})})}}),w.fn.extend({queue:function(C,G){var Q=2;return typeof C!="string"&&(G=C,C="fx",Q--),arguments.length<Q?w.queue(this[0],C):G===void 0?this:this.each(function(){var se=w.queue(this,C,G);w._queueHooks(this,C),C==="fx"&&se[0]!=="inprogress"&&w.dequeue(this,C)})},dequeue:function(C){return this.each(function(){w.dequeue(this,C)})},clearQueue:function(C){return this.queue(C||"fx",[])},promise:function(C,G){var Q,se=1,ve=w.Deferred(),Ee=this,Be=this.length,Qe=function(){--se||ve.resolveWith(Ee,[Ee])};for(typeof C!="string"&&(G=C,C=void 0),C=C||"fx";Be--;)Q=xt.get(Ee[Be],C+"queueHooks"),Q&&Q.empty&&(se++,Q.empty.add(Qe));return Qe(),ve.promise(G)}});var Li=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,qi=["Top","Right","Bottom","Left"],Pi=function(C,G){return C=G||C,w.css(C,"display")==="none"||!w.contains(C.ownerDocument,C)},Oi=/^(?:checkbox|radio)$/i;(function(){var C=D.createDocumentFragment(),G=C.appendChild(D.createElement("div"));G.innerHTML="<input type='radio' checked='checked' name='t'/>",O.checkClone=G.cloneNode(!0).cloneNode(!0).lastChild.checked,G.innerHTML="<textarea>x</textarea>",O.noCloneChecked=!!G.cloneNode(!0).lastChild.defaultValue})();var $t="undefined";O.focusinBubbles="onfocusin"in e;var Rs=/^key/,is=/^(?:mouse|contextmenu)|click/,hs=/^(?:focusinfocus|focusoutblur)$/,qs=/^([^.]*)(?:\.(.+)|)$/;function q(){return!0}function Re(){return!1}function He(){try{return D.activeElement}catch{}}w.event={global:{},add:function(C,G,Q,se,ve){var Ee,Be,Qe,yt,wt,mt,Kt,jt,hi,Ri,Gi,Cs=xt.get(C);if(Cs)for(Q.handler&&(Ee=Q,Q=Ee.handler,ve=Ee.selector),Q.guid||(Q.guid=w.guid++),(yt=Cs.events)||(yt=Cs.events={}),(Be=Cs.handle)||(Be=Cs.handle=function(En){return typeof w!==$t&&w.event.triggered!==En.type?w.event.dispatch.apply(C,arguments):void 0}),G=(G||"").match(Bt)||[""],wt=G.length;wt--;)Qe=qs.exec(G[wt])||[],hi=Gi=Qe[1],Ri=(Qe[2]||"").split(".").sort(),hi&&(Kt=w.event.special[hi]||{},hi=(ve?Kt.delegateType:Kt.bindType)||hi,Kt=w.event.special[hi]||{},mt=w.extend({type:hi,origType:Gi,data:se,handler:Q,guid:Q.guid,selector:ve,needsContext:ve&&w.expr.match.needsContext.test(ve),namespace:Ri.join(".")},Ee),(jt=yt[hi])||(jt=yt[hi]=[],jt.delegateCount=0,(!Kt.setup||Kt.setup.call(C,se,Ri,Be)===!1)&&C.addEventListener&&C.addEventListener(hi,Be,!1)),Kt.add&&(Kt.add.call(C,mt),mt.handler.guid||(mt.handler.guid=Q.guid)),ve?jt.splice(jt.delegateCount++,0,mt):jt.push(mt),w.event.global[hi]=!0)},remove:function(C,G,Q,se,ve){var Ee,Be,Qe,yt,wt,mt,Kt,jt,hi,Ri,Gi,Cs=xt.hasData(C)&&xt.get(C);if(!(!Cs||!(yt=Cs.events))){for(G=(G||"").match(Bt)||[""],wt=G.length;wt--;){if(Qe=qs.exec(G[wt])||[],hi=Gi=Qe[1],Ri=(Qe[2]||"").split(".").sort(),!hi){for(hi in yt)w.event.remove(C,hi+G[wt],Q,se,!0);continue}for(Kt=w.event.special[hi]||{},hi=(se?Kt.delegateType:Kt.bindType)||hi,jt=yt[hi]||[],Qe=Qe[2]&&new RegExp("(^|\\.)"+Ri.join("\\.(?:.*\\.|)")+"(\\.|$)"),Be=Ee=jt.length;Ee--;)mt=jt[Ee],(ve||Gi===mt.origType)&&(!Q||Q.guid===mt.guid)&&(!Qe||Qe.test(mt.namespace))&&(!se||se===mt.selector||se==="**"&&mt.selector)&&(jt.splice(Ee,1),mt.selector&&jt.delegateCount--,Kt.remove&&Kt.remove.call(C,mt));Be&&!jt.length&&((!Kt.teardown||Kt.teardown.call(C,Ri,Cs.handle)===!1)&&w.removeEvent(C,hi,Cs.handle),delete yt[hi])}w.isEmptyObject(yt)&&(delete Cs.handle,xt.remove(C,"events"))}},trigger:function(C,G,Q,se){var ve,Ee,Be,Qe,yt,wt,mt,Kt=[Q||D],jt=y.call(C,"type")?C.type:C,hi=y.call(C,"namespace")?C.namespace.split("."):[];if(Ee=Be=Q=Q||D,!(Q.nodeType===3||Q.nodeType===8)&&!hs.test(jt+w.event.triggered)&&(jt.indexOf(".")>=0&&(hi=jt.split("."),jt=hi.shift(),hi.sort()),yt=jt.indexOf(":")<0&&"on"+jt,C=C[w.expando]?C:new w.Event(jt,typeof C=="object"&&C),C.isTrigger=se?2:3,C.namespace=hi.join("."),C.namespace_re=C.namespace?new RegExp("(^|\\.)"+hi.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,C.result=void 0,C.target||(C.target=Q),G=G==null?[C]:w.makeArray(G,[C]),mt=w.event.special[jt]||{},!(!se&&mt.trigger&&mt.trigger.apply(Q,G)===!1))){if(!se&&!mt.noBubble&&!w.isWindow(Q)){for(Qe=mt.delegateType||jt,hs.test(Qe+jt)||(Ee=Ee.parentNode);Ee;Ee=Ee.parentNode)Kt.push(Ee),Be=Ee;Be===(Q.ownerDocument||D)&&Kt.push(Be.defaultView||Be.parentWindow||e)}for(ve=0;(Ee=Kt[ve++])&&!C.isPropagationStopped();)C.type=ve>1?Qe:mt.bindType||jt,wt=(xt.get(Ee,"events")||{})[C.type]&&xt.get(Ee,"handle"),wt&&wt.apply(Ee,G),wt=yt&&Ee[yt],wt&&wt.apply&&w.acceptData(Ee)&&(C.result=wt.apply(Ee,G),C.result===!1&&C.preventDefault());return C.type=jt,!se&&!C.isDefaultPrevented()&&(!mt._default||mt._default.apply(Kt.pop(),G)===!1)&&w.acceptData(Q)&&yt&&w.isFunction(Q[jt])&&!w.isWindow(Q)&&(Be=Q[yt],Be&&(Q[yt]=null),w.event.triggered=jt,Q[jt](),w.event.triggered=void 0,Be&&(Q[yt]=Be)),C.result}},dispatch:function(C){C=w.event.fix(C);var G,Q,se,ve,Ee,Be=[],Qe=r.call(arguments),yt=(xt.get(this,"events")||{})[C.type]||[],wt=w.event.special[C.type]||{};if(Qe[0]=C,C.delegateTarget=this,!(wt.preDispatch&&wt.preDispatch.call(this,C)===!1)){for(Be=w.event.handlers.call(this,C,yt),G=0;(ve=Be[G++])&&!C.isPropagationStopped();)for(C.currentTarget=ve.elem,Q=0;(Ee=ve.handlers[Q++])&&!C.isImmediatePropagationStopped();)(!C.namespace_re||C.namespace_re.test(Ee.namespace))&&(C.handleObj=Ee,C.data=Ee.data,se=((w.event.special[Ee.origType]||{}).handle||Ee.handler).apply(ve.elem,Qe),se!==void 0&&(C.result=se)===!1&&(C.preventDefault(),C.stopPropagation()));return wt.postDispatch&&wt.postDispatch.call(this,C),C.result}},handlers:function(C,G){var Q,se,ve,Ee,Be=[],Qe=G.delegateCount,yt=C.target;if(Qe&&yt.nodeType&&(!C.button||C.type!=="click")){for(;yt!==this;yt=yt.parentNode||this)if(yt.disabled!==!0||C.type!=="click"){for(se=[],Q=0;Q<Qe;Q++)Ee=G[Q],ve=Ee.selector+" ",se[ve]===void 0&&(se[ve]=Ee.needsContext?w(ve,this).index(yt)>=0:w.find(ve,this,null,[yt]).length),se[ve]&&se.push(Ee);se.length&&Be.push({elem:yt,handlers:se})}}return Qe<G.length&&Be.push({elem:this,handlers:G.slice(Qe)}),Be},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(C,G){return C.which==null&&(C.which=G.charCode!=null?G.charCode:G.keyCode),C}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(C,G){var Q,se,ve,Ee=G.button;return C.pageX==null&&G.clientX!=null&&(Q=C.target.ownerDocument||D,se=Q.documentElement,ve=Q.body,C.pageX=G.clientX+(se&&se.scrollLeft||ve&&ve.scrollLeft||0)-(se&&se.clientLeft||ve&&ve.clientLeft||0),C.pageY=G.clientY+(se&&se.scrollTop||ve&&ve.scrollTop||0)-(se&&se.clientTop||ve&&ve.clientTop||0)),!C.which&&Ee!==void 0&&(C.which=Ee&1?1:Ee&2?3:Ee&4?2:0),C}},fix:function(C){if(C[w.expando])return C;var G,Q,se,ve=C.type,Ee=C,Be=this.fixHooks[ve];for(Be||(this.fixHooks[ve]=Be=is.test(ve)?this.mouseHooks:Rs.test(ve)?this.keyHooks:{}),se=Be.props?this.props.concat(Be.props):this.props,C=new w.Event(Ee),G=se.length;G--;)Q=se[G],C[Q]=Ee[Q];return C.target||(C.target=D),C.target.nodeType===3&&(C.target=C.target.parentNode),Be.filter?Be.filter(C,Ee):C},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==He()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===He()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if(this.type==="checkbox"&&this.click&&w.nodeName(this,"input"))return this.click(),!1},_default:function(C){return w.nodeName(C.target,"a")}},beforeunload:{postDispatch:function(C){C.result!==void 0&&(C.originalEvent.returnValue=C.result)}}},simulate:function(C,G,Q,se){var ve=w.extend(new w.Event,Q,{type:C,isSimulated:!0,originalEvent:{}});se?w.event.trigger(ve,null,G):w.event.dispatch.call(G,ve),ve.isDefaultPrevented()&&Q.preventDefault()}},w.removeEvent=function(C,G,Q){C.removeEventListener&&C.removeEventListener(G,Q,!1)},w.Event=function(C,G){if(!(this instanceof w.Event))return new w.Event(C,G);C&&C.type?(this.originalEvent=C,this.type=C.type,this.isDefaultPrevented=C.defaultPrevented||C.defaultPrevented===void 0&&C.getPreventDefault&&C.getPreventDefault()?q:Re):this.type=C,G&&w.extend(this,G),this.timeStamp=C&&C.timeStamp||w.now(),this[w.expando]=!0},w.Event.prototype={isDefaultPrevented:Re,isPropagationStopped:Re,isImmediatePropagationStopped:Re,preventDefault:function(){var C=this.originalEvent;this.isDefaultPrevented=q,C&&C.preventDefault&&C.preventDefault()},stopPropagation:function(){var C=this.originalEvent;this.isPropagationStopped=q,C&&C.stopPropagation&&C.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=q,this.stopPropagation()}},w.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(C,G){w.event.special[C]={delegateType:G,bindType:G,handle:function(Q){var se,ve=this,Ee=Q.relatedTarget,Be=Q.handleObj;return(!Ee||Ee!==ve&&!w.contains(ve,Ee))&&(Q.type=Be.origType,se=Be.handler.apply(this,arguments),Q.type=G),se}}}),O.focusinBubbles||w.each({focus:"focusin",blur:"focusout"},function(C,G){var Q=function(se){w.event.simulate(G,se.target,w.event.fix(se),!0)};w.event.special[G]={setup:function(){var se=this.ownerDocument||this,ve=xt.access(se,G);ve||se.addEventListener(C,Q,!0),xt.access(se,G,(ve||0)+1)},teardown:function(){var se=this.ownerDocument||this,ve=xt.access(se,G)-1;ve?xt.access(se,G,ve):(se.removeEventListener(C,Q,!0),xt.remove(se,G))}}}),w.fn.extend({on:function(C,G,Q,se,ve){var Ee,Be;if(typeof C=="object"){typeof G!="string"&&(Q=Q||G,G=void 0);for(Be in C)this.on(Be,G,Q,C[Be],ve);return this}if(Q==null&&se==null?(se=G,Q=G=void 0):se==null&&(typeof G=="string"?(se=Q,Q=void 0):(se=Q,Q=G,G=void 0)),se===!1)se=Re;else if(!se)return this;return ve===1&&(Ee=se,se=function(Qe){return w().off(Qe),Ee.apply(this,arguments)},se.guid=Ee.guid||(Ee.guid=w.guid++)),this.each(function(){w.event.add(this,C,se,Q,G)})},one:function(C,G,Q,se){return this.on(C,G,Q,se,1)},off:function(C,G,Q){var se,ve;if(C&&C.preventDefault&&C.handleObj)return se=C.handleObj,w(C.delegateTarget).off(se.namespace?se.origType+"."+se.namespace:se.origType,se.selector,se.handler),this;if(typeof C=="object"){for(ve in C)this.off(ve,G,C[ve]);return this}return(G===!1||typeof G=="function")&&(Q=G,G=void 0),Q===!1&&(Q=Re),this.each(function(){w.event.remove(this,C,Q,G)})},trigger:function(C,G){return this.each(function(){w.event.trigger(C,G,this)})},triggerHandler:function(C,G){var Q=this[0];if(Q)return w.event.trigger(C,G,Q,!0)}});var Ze=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Xe=/<([\w:]+)/,Pe=/<|&#?\w+;/,Le=/<(?:script|style|link)/i,De=/checked\s*(?:[^=]|=\s*.checked.)/i,ct=/^$|\/(?:java|ecma)script/i,h=/^true\/(.*)/,f=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,b={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};b.optgroup=b.option,b.tbody=b.tfoot=b.colgroup=b.caption=b.thead,b.th=b.td;function L(C,G){return w.nodeName(C,"table")&&w.nodeName(G.nodeType!==11?G:G.firstChild,"tr")?C.getElementsByTagName("tbody")[0]||C.appendChild(C.ownerDocument.createElement("tbody")):C}function I(C){return C.type=(C.getAttribute("type")!==null)+"/"+C.type,C}function B(C){var G=h.exec(C.type);return G?C.type=G[1]:C.removeAttribute("type"),C}function j(C,G){for(var Q=0,se=C.length;Q<se;Q++)xt.set(C[Q],"globalEval",!G||xt.get(G[Q],"globalEval"))}function Y(C,G){var Q,se,ve,Ee,Be,Qe,yt,wt;if(G.nodeType===1){if(xt.hasData(C)&&(Ee=xt.access(C),Be=xt.set(G,Ee),wt=Ee.events,wt)){delete Be.handle,Be.events={};for(ve in wt)for(Q=0,se=wt[ve].length;Q<se;Q++)w.event.add(G,ve,wt[ve][Q])}Gt.hasData(C)&&(Qe=Gt.access(C),yt=w.extend({},Qe),Gt.set(G,yt))}}function Z(C,G){var Q=C.getElementsByTagName?C.getElementsByTagName(G||"*"):C.querySelectorAll?C.querySelectorAll(G||"*"):[];return G===void 0||G&&w.nodeName(C,G)?w.merge([C],Q):Q}function ie(C,G){var Q=G.nodeName.toLowerCase();Q==="input"&&Oi.test(C.type)?G.checked=C.checked:(Q==="input"||Q==="textarea")&&(G.defaultValue=C.defaultValue)}w.extend({clone:function(C,G,Q){var se,ve,Ee,Be,Qe=C.cloneNode(!0),yt=w.contains(C.ownerDocument,C);if(!O.noCloneChecked&&(C.nodeType===1||C.nodeType===11)&&!w.isXMLDoc(C))for(Be=Z(Qe),Ee=Z(C),se=0,ve=Ee.length;se<ve;se++)ie(Ee[se],Be[se]);if(G)if(Q)for(Ee=Ee||Z(C),Be=Be||Z(Qe),se=0,ve=Ee.length;se<ve;se++)Y(Ee[se],Be[se]);else Y(C,Qe);return Be=Z(Qe,"script"),Be.length>0&&j(Be,!yt&&Z(C,"script")),Qe},buildFragment:function(C,G,Q,se){for(var ve,Ee,Be,Qe,yt,wt,mt=G.createDocumentFragment(),Kt=[],jt=0,hi=C.length;jt<hi;jt++)if(ve=C[jt],ve||ve===0)if(w.type(ve)==="object")w.merge(Kt,ve.nodeType?[ve]:ve);else if(!Pe.test(ve))Kt.push(G.createTextNode(ve));else{for(Ee=Ee||mt.appendChild(G.createElement("div")),Be=(Xe.exec(ve)||["",""])[1].toLowerCase(),Qe=b[Be]||b._default,Ee.innerHTML=Qe[1]+ve.replace(Ze,"<$1></$2>")+Qe[2],wt=Qe[0];wt--;)Ee=Ee.lastChild;w.merge(Kt,Ee.childNodes),Ee=mt.firstChild,Ee.textContent=""}for(mt.textContent="",jt=0;ve=Kt[jt++];)if(!(se&&w.inArray(ve,se)!==-1)&&(yt=w.contains(ve.ownerDocument,ve),Ee=Z(mt.appendChild(ve),"script"),yt&&j(Ee),Q))for(wt=0;ve=Ee[wt++];)ct.test(ve.type||"")&&Q.push(ve);return mt},cleanData:function(C){for(var G,Q,se,ve,Ee,Be,Qe=w.event.special,yt=0;(Q=C[yt])!==void 0;yt++){if(w.acceptData(Q)&&(Ee=Q[xt.expando],Ee&&(G=xt.cache[Ee]))){if(se=Object.keys(G.events||{}),se.length)for(Be=0;(ve=se[Be])!==void 0;Be++)Qe[ve]?w.event.remove(Q,ve):w.removeEvent(Q,ve,G.handle);xt.cache[Ee]&&delete xt.cache[Ee]}delete Gt.cache[Q[Gt.expando]]}}}),w.fn.extend({text:function(C){return Mt(this,function(G){return G===void 0?w.text(this):this.empty().each(function(){(this.nodeType===1||this.nodeType===11||this.nodeType===9)&&(this.textContent=G)})},null,C,arguments.length)},append:function(){return this.domManip(arguments,function(C){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var G=L(this,C);G.appendChild(C)}})},prepend:function(){return this.domManip(arguments,function(C){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var G=L(this,C);G.insertBefore(C,G.firstChild)}})},before:function(){return this.domManip(arguments,function(C){this.parentNode&&this.parentNode.insertBefore(C,this)})},after:function(){return this.domManip(arguments,function(C){this.parentNode&&this.parentNode.insertBefore(C,this.nextSibling)})},remove:function(C,G){for(var Q,se=C?w.filter(C,this):this,ve=0;(Q=se[ve])!=null;ve++)!G&&Q.nodeType===1&&w.cleanData(Z(Q)),Q.parentNode&&(G&&w.contains(Q.ownerDocument,Q)&&j(Z(Q,"script")),Q.parentNode.removeChild(Q));return this},empty:function(){for(var C,G=0;(C=this[G])!=null;G++)C.nodeType===1&&(w.cleanData(Z(C,!1)),C.textContent="");return this},clone:function(C,G){return C=C??!1,G=G??C,this.map(function(){return w.clone(this,C,G)})},html:function(C){return Mt(this,function(G){var Q=this[0]||{},se=0,ve=this.length;if(G===void 0&&Q.nodeType===1)return Q.innerHTML;if(typeof G=="string"&&!Le.test(G)&&!b[(Xe.exec(G)||["",""])[1].toLowerCase()]){G=G.replace(Ze,"<$1></$2>");try{for(;se<ve;se++)Q=this[se]||{},Q.nodeType===1&&(w.cleanData(Z(Q,!1)),Q.innerHTML=G);Q=0}catch{}}Q&&this.empty().append(G)},null,C,arguments.length)},replaceWith:function(){var C=arguments[0];return this.domManip(arguments,function(G){C=this.parentNode,w.cleanData(Z(this)),C&&C.replaceChild(G,this)}),C&&(C.length||C.nodeType)?this:this.remove()},detach:function(C){return this.remove(C,!0)},domManip:function(C,G){C=s.apply([],C);var Q,se,ve,Ee,Be,Qe,yt=0,wt=this.length,mt=this,Kt=wt-1,jt=C[0],hi=w.isFunction(jt);if(hi||wt>1&&typeof jt=="string"&&!O.checkClone&&De.test(jt))return this.each(function(Ri){var Gi=mt.eq(Ri);hi&&(C[0]=jt.call(this,Ri,Gi.html())),Gi.domManip(C,G)});if(wt&&(Q=w.buildFragment(C,this[0].ownerDocument,!1,this),se=Q.firstChild,Q.childNodes.length===1&&(Q=se),se)){for(ve=w.map(Z(Q,"script"),I),Ee=ve.length;yt<wt;yt++)Be=Q,yt!==Kt&&(Be=w.clone(Be,!0,!0),Ee&&w.merge(ve,Z(Be,"script"))),G.call(this[yt],Be,yt);if(Ee)for(Qe=ve[ve.length-1].ownerDocument,w.map(ve,B),yt=0;yt<Ee;yt++)Be=ve[yt],ct.test(Be.type||"")&&!xt.access(Be,"globalEval")&&w.contains(Qe,Be)&&(Be.src?w._evalUrl&&w._evalUrl(Be.src):w.globalEval(Be.textContent.replace(f,"")))}return this}}),w.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(C,G){w.fn[C]=function(Q){for(var se,ve=[],Ee=w(Q),Be=Ee.length-1,Qe=0;Qe<=Be;Qe++)se=Qe===Be?this:this.clone(!0),w(Ee[Qe])[G](se),a.apply(ve,se.get());return this.pushStack(ve)}});var pe,me={};function de(C,G){var Q=w(G.createElement(C)).appendTo(G.body),se=e.getDefaultComputedStyle?e.getDefaultComputedStyle(Q[0]).display:w.css(Q[0],"display");return Q.detach(),se}function le(C){var G=D,Q=me[C];return Q||(Q=de(C,G),(Q==="none"||!Q)&&(pe=(pe||w("<iframe frameborder='0' width='0' height='0'/>")).appendTo(G.documentElement),G=pe[0].contentDocument,G.write(),G.close(),Q=de(C,G),pe.detach()),me[C]=Q),Q}var we=/^margin/,Ve=new RegExp("^("+Li+")(?!px)[a-z%]+$","i"),ke=function(C){return C.ownerDocument.defaultView.getComputedStyle(C,null)};function ye(C,G,Q){var se,ve,Ee,Be,Qe=C.style;return Q=Q||ke(C),Q&&(Be=Q.getPropertyValue(G)||Q[G]),Q&&(Be===""&&!w.contains(C.ownerDocument,C)&&(Be=w.style(C,G)),Ve.test(Be)&&we.test(G)&&(se=Qe.width,ve=Qe.minWidth,Ee=Qe.maxWidth,Qe.minWidth=Qe.maxWidth=Qe.width=Be,Be=Q.width,Qe.width=se,Qe.minWidth=ve,Qe.maxWidth=Ee)),Be!==void 0?Be+"":Be}function xe(C,G){return{get:function(){if(C()){delete this.get;return}return(this.get=G).apply(this,arguments)}}}(function(){var C,G,Q="padding:0;margin:0;border:0;display:block;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box",se=D.documentElement,ve=D.createElement("div"),Ee=D.createElement("div");Ee.style.backgroundClip="content-box",Ee.cloneNode(!0).style.backgroundClip="",O.clearCloneStyle=Ee.style.backgroundClip==="content-box",ve.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",ve.appendChild(Ee);function Be(){Ee.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%",se.appendChild(ve);var Qe=e.getComputedStyle(Ee,null);C=Qe.top!=="1%",G=Qe.width==="4px",se.removeChild(ve)}e.getComputedStyle&&w.extend(O,{pixelPosition:function(){return Be(),C},boxSizingReliable:function(){return G==null&&Be(),G},reliableMarginRight:function(){var Qe,yt=Ee.appendChild(D.createElement("div"));return yt.style.cssText=Ee.style.cssText=Q,yt.style.marginRight=yt.style.width="0",Ee.style.width="1px",se.appendChild(ve),Qe=!parseFloat(e.getComputedStyle(yt,null).marginRight),se.removeChild(ve),Ee.innerHTML="",Qe}})})(),w.swap=function(C,G,Q,se){var ve,Ee,Be={};for(Ee in G)Be[Ee]=C.style[Ee],C.style[Ee]=G[Ee];ve=Q.apply(C,se||[]);for(Ee in G)C.style[Ee]=Be[Ee];return ve};var ce=/^(none|table(?!-c[ea]).+)/,Se=new RegExp("^("+Li+")(.*)$","i"),Ie=new RegExp("^([+-])=("+Li+")","i"),Me={position:"absolute",visibility:"hidden",display:"block"},ze={letterSpacing:0,fontWeight:400},Ge=["Webkit","O","Moz","ms"];function We(C,G){if(G in C)return G;for(var Q=G[0].toUpperCase()+G.slice(1),se=G,ve=Ge.length;ve--;)if(G=Ge[ve]+Q,G in C)return G;return se}function je(C,G,Q){var se=Se.exec(G);return se?Math.max(0,se[1]-(Q||0))+(se[2]||"px"):G}function rt(C,G,Q,se,ve){for(var Ee=Q===(se?"border":"content")?4:G==="width"?1:0,Be=0;Ee<4;Ee+=2)Q==="margin"&&(Be+=w.css(C,Q+qi[Ee],!0,ve)),se?(Q==="content"&&(Be-=w.css(C,"padding"+qi[Ee],!0,ve)),Q!=="margin"&&(Be-=w.css(C,"border"+qi[Ee]+"Width",!0,ve))):(Be+=w.css(C,"padding"+qi[Ee],!0,ve),Q!=="padding"&&(Be+=w.css(C,"border"+qi[Ee]+"Width",!0,ve)));return Be}function Je(C,G,Q){var se=!0,ve=G==="width"?C.offsetWidth:C.offsetHeight,Ee=ke(C),Be=w.css(C,"boxSizing",!1,Ee)==="border-box";if(ve<=0||ve==null){if(ve=ye(C,G,Ee),(ve<0||ve==null)&&(ve=C.style[G]),Ve.test(ve))return ve;se=Be&&(O.boxSizingReliable()||ve===C.style[G]),ve=parseFloat(ve)||0}return ve+rt(C,G,Q||(Be?"border":"content"),se,Ee)+"px"}function lt(C,G){for(var Q,se,ve,Ee=[],Be=0,Qe=C.length;Be<Qe;Be++)se=C[Be],se.style&&(Ee[Be]=xt.get(se,"olddisplay"),Q=se.style.display,G?(!Ee[Be]&&Q==="none"&&(se.style.display=""),se.style.display===""&&Pi(se)&&(Ee[Be]=xt.access(se,"olddisplay",le(se.nodeName)))):Ee[Be]||(ve=Pi(se),(Q&&Q!=="none"||!ve)&&xt.set(se,"olddisplay",ve?Q:w.css(se,"display"))));for(Be=0;Be<Qe;Be++)se=C[Be],se.style&&(!G||se.style.display==="none"||se.style.display==="")&&(se.style.display=G?Ee[Be]||"":"none");return C}w.extend({cssHooks:{opacity:{get:function(C,G){if(G){var Q=ye(C,"opacity");return Q===""?"1":Q}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(C,G,Q,se){if(!(!C||C.nodeType===3||C.nodeType===8||!C.style)){var ve,Ee,Be,Qe=w.camelCase(G),yt=C.style;if(G=w.cssProps[Qe]||(w.cssProps[Qe]=We(yt,Qe)),Be=w.cssHooks[G]||w.cssHooks[Qe],Q!==void 0){if(Ee=typeof Q,Ee==="string"&&(ve=Ie.exec(Q))&&(Q=(ve[1]+1)*ve[2]+parseFloat(w.css(C,G)),Ee="number"),Q==null||Q!==Q)return;Ee==="number"&&!w.cssNumber[Qe]&&(Q+="px"),!O.clearCloneStyle&&Q===""&&G.indexOf("background")===0&&(yt[G]="inherit"),(!Be||!("set"in Be)||(Q=Be.set(C,Q,se))!==void 0)&&(yt[G]="",yt[G]=Q)}else return Be&&"get"in Be&&(ve=Be.get(C,!1,se))!==void 0?ve:yt[G]}},css:function(C,G,Q,se){var ve,Ee,Be,Qe=w.camelCase(G);return G=w.cssProps[Qe]||(w.cssProps[Qe]=We(C.style,Qe)),Be=w.cssHooks[G]||w.cssHooks[Qe],Be&&"get"in Be&&(ve=Be.get(C,!0,Q)),ve===void 0&&(ve=ye(C,G,se)),ve==="normal"&&G in ze&&(ve=ze[G]),Q===""||Q?(Ee=parseFloat(ve),Q===!0||w.isNumeric(Ee)?Ee||0:ve):ve}}),w.each(["height","width"],function(C,G){w.cssHooks[G]={get:function(Q,se,ve){if(se)return Q.offsetWidth===0&&ce.test(w.css(Q,"display"))?w.swap(Q,Me,function(){return Je(Q,G,ve)}):Je(Q,G,ve)},set:function(Q,se,ve){var Ee=ve&&ke(Q);return je(Q,se,ve?rt(Q,G,ve,w.css(Q,"boxSizing",!1,Ee)==="border-box",Ee):0)}}}),w.cssHooks.marginRight=xe(O.reliableMarginRight,function(C,G){if(G)return w.swap(C,{display:"inline-block"},ye,[C,"marginRight"])}),w.each({margin:"",padding:"",border:"Width"},function(C,G){w.cssHooks[C+G]={expand:function(Q){for(var se=0,ve={},Ee=typeof Q=="string"?Q.split(" "):[Q];se<4;se++)ve[C+qi[se]+G]=Ee[se]||Ee[se-2]||Ee[0];return ve}},we.test(C)||(w.cssHooks[C+G].set=je)}),w.fn.extend({css:function(C,G){return Mt(this,function(Q,se,ve){var Ee,Be,Qe={},yt=0;if(w.isArray(se)){for(Ee=ke(Q),Be=se.length;yt<Be;yt++)Qe[se[yt]]=w.css(Q,se[yt],!1,Ee);return Qe}return ve!==void 0?w.style(Q,se,ve):w.css(Q,se)},C,G,arguments.length>1)},show:function(){return lt(this,!0)},hide:function(){return lt(this)},toggle:function(C){return typeof C=="boolean"?C?this.show():this.hide():this.each(function(){Pi(this)?w(this).show():w(this).hide()})}});function ht(C,G,Q,se,ve){return new ht.prototype.init(C,G,Q,se,ve)}w.Tween=ht,ht.prototype={constructor:ht,init:function(C,G,Q,se,ve,Ee){this.elem=C,this.prop=Q,this.easing=ve||"swing",this.options=G,this.start=this.now=this.cur(),this.end=se,this.unit=Ee||(w.cssNumber[Q]?"":"px")},cur:function(){var C=ht.propHooks[this.prop];return C&&C.get?C.get(this):ht.propHooks._default.get(this)},run:function(C){var G,Q=ht.propHooks[this.prop];return this.options.duration?this.pos=G=w.easing[this.easing](C,this.options.duration*C,0,1,this.options.duration):this.pos=G=C,this.now=(this.end-this.start)*G+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),Q&&Q.set?Q.set(this):ht.propHooks._default.set(this),this}},ht.prototype.init.prototype=ht.prototype,ht.propHooks={_default:{get:function(C){var G;return C.elem[C.prop]!=null&&(!C.elem.style||C.elem.style[C.prop]==null)?C.elem[C.prop]:(G=w.css(C.elem,C.prop,""),!G||G==="auto"?0:G)},set:function(C){w.fx.step[C.prop]?w.fx.step[C.prop](C):C.elem.style&&(C.elem.style[w.cssProps[C.prop]]!=null||w.cssHooks[C.prop])?w.style(C.elem,C.prop,C.now+C.unit):C.elem[C.prop]=C.now}}},ht.propHooks.scrollTop=ht.propHooks.scrollLeft={set:function(C){C.elem.nodeType&&C.elem.parentNode&&(C.elem[C.prop]=C.now)}},w.easing={linear:function(C){return C},swing:function(C){return .5-Math.cos(C*Math.PI)/2}},w.fx=ht.prototype.init,w.fx.step={};var _t,bt,Tt=/^(?:toggle|show|hide)$/,Jt=new RegExp("^(?:([+-])=|)("+Li+")([a-z%]*)$","i"),ii=/queueHooks$/,Rt=[Yt],Si={"*":[function(C,G){var Q=this.createTween(C,G),se=Q.cur(),ve=Jt.exec(G),Ee=ve&&ve[3]||(w.cssNumber[C]?"":"px"),Be=(w.cssNumber[C]||Ee!=="px"&&+se)&&Jt.exec(w.css(Q.elem,C)),Qe=1,yt=20;if(Be&&Be[3]!==Ee){Ee=Ee||Be[3],ve=ve||[],Be=+se||1;do Qe=Qe||".5",Be=Be/Qe,w.style(Q.elem,C,Be+Ee);while(Qe!==(Qe=Q.cur()/se)&&Qe!==1&&--yt)}return ve&&(Be=Q.start=+Be||+se||0,Q.unit=Ee,Q.end=ve[1]?Be+(ve[1]+1)*ve[2]:+ve[2]),Q}]};function bi(){return setTimeout(function(){_t=void 0}),_t=w.now()}function _i(C,G){var Q,se=0,ve={height:C};for(G=G?1:0;se<4;se+=2-G)Q=qi[se],ve["margin"+Q]=ve["padding"+Q]=C;return G&&(ve.opacity=ve.width=C),ve}function mi(C,G,Q){for(var se,ve=(Si[G]||[]).concat(Si["*"]),Ee=0,Be=ve.length;Ee<Be;Ee++)if(se=ve[Ee].call(Q,G,C))return se}function Yt(C,G,Q){var se,ve,Ee,Be,Qe,yt,wt,mt=this,Kt={},jt=C.style,hi=C.nodeType&&Pi(C),Ri=xt.get(C,"fxshow");Q.queue||(Qe=w._queueHooks(C,"fx"),Qe.unqueued==null&&(Qe.unqueued=0,yt=Qe.empty.fire,Qe.empty.fire=function(){Qe.unqueued||yt()}),Qe.unqueued++,mt.always(function(){mt.always(function(){Qe.unqueued--,w.queue(C,"fx").length||Qe.empty.fire()})})),C.nodeType===1&&("height"in G||"width"in G)&&(Q.overflow=[jt.overflow,jt.overflowX,jt.overflowY],wt=w.css(C,"display"),wt==="none"&&(wt=le(C.nodeName)),wt==="inline"&&w.css(C,"float")==="none"&&(jt.display="inline-block")),Q.overflow&&(jt.overflow="hidden",mt.always(function(){jt.overflow=Q.overflow[0],jt.overflowX=Q.overflow[1],jt.overflowY=Q.overflow[2]}));for(se in G)if(ve=G[se],Tt.exec(ve)){if(delete G[se],Ee=Ee||ve==="toggle",ve===(hi?"hide":"show"))if(ve==="show"&&Ri&&Ri[se]!==void 0)hi=!0;else continue;Kt[se]=Ri&&Ri[se]||w.style(C,se)}if(!w.isEmptyObject(Kt)){Ri?"hidden"in Ri&&(hi=Ri.hidden):Ri=xt.access(C,"fxshow",{}),Ee&&(Ri.hidden=!hi),hi?w(C).show():mt.done(function(){w(C).hide()}),mt.done(function(){var Gi;xt.remove(C,"fxshow");for(Gi in Kt)w.style(C,Gi,Kt[Gi])});for(se in Kt)Be=mi(hi?Ri[se]:0,se,mt),se in Ri||(Ri[se]=Be.start,hi&&(Be.end=Be.start,Be.start=se==="width"||se==="height"?1:0))}}function Ti(C,G){var Q,se,ve,Ee,Be;for(Q in C)if(se=w.camelCase(Q),ve=G[se],Ee=C[Q],w.isArray(Ee)&&(ve=Ee[1],Ee=C[Q]=Ee[0]),Q!==se&&(C[se]=Ee,delete C[Q]),Be=w.cssHooks[se],Be&&"expand"in Be){Ee=Be.expand(Ee),delete C[se];for(Q in Ee)Q in C||(C[Q]=Ee[Q],G[Q]=ve)}else G[se]=ve}function os(C,G,Q){var se,ve,Ee=0,Be=Rt.length,Qe=w.Deferred().always(function(){delete yt.elem}),yt=function(){if(ve)return!1;for(var Kt=_t||bi(),jt=Math.max(0,wt.startTime+wt.duration-Kt),hi=jt/wt.duration||0,Ri=1-hi,Gi=0,Cs=wt.tweens.length;Gi<Cs;Gi++)wt.tweens[Gi].run(Ri);return Qe.notifyWith(C,[wt,Ri,jt]),Ri<1&&Cs?jt:(Qe.resolveWith(C,[wt]),!1)},wt=Qe.promise({elem:C,props:w.extend({},G),opts:w.extend(!0,{specialEasing:{}},Q),originalProperties:G,originalOptions:Q,startTime:_t||bi(),duration:Q.duration,tweens:[],createTween:function(Kt,jt){var hi=w.Tween(C,wt.opts,Kt,jt,wt.opts.specialEasing[Kt]||wt.opts.easing);return wt.tweens.push(hi),hi},stop:function(Kt){var jt=0,hi=Kt?wt.tweens.length:0;if(ve)return this;for(ve=!0;jt<hi;jt++)wt.tweens[jt].run(1);return Kt?Qe.resolveWith(C,[wt,Kt]):Qe.rejectWith(C,[wt,Kt]),this}}),mt=wt.props;for(Ti(mt,wt.opts.specialEasing);Ee<Be;Ee++)if(se=Rt[Ee].call(wt,C,mt,wt.opts),se)return se;return w.map(mt,mi,wt),w.isFunction(wt.opts.start)&&wt.opts.start.call(C,wt),w.fx.timer(w.extend(yt,{elem:C,anim:wt,queue:wt.opts.queue})),wt.progress(wt.opts.progress).done(wt.opts.done,wt.opts.complete).fail(wt.opts.fail).always(wt.opts.always)}w.Animation=w.extend(os,{tweener:function(C,G){w.isFunction(C)?(G=C,C=["*"]):C=C.split(" ");for(var Q,se=0,ve=C.length;se<ve;se++)Q=C[se],Si[Q]=Si[Q]||[],Si[Q].unshift(G)},prefilter:function(C,G){G?Rt.unshift(C):Rt.push(C)}}),w.speed=function(C,G,Q){var se=C&&typeof C=="object"?w.extend({},C):{complete:Q||!Q&&G||w.isFunction(C)&&C,duration:C,easing:Q&&G||G&&!w.isFunction(G)&&G};return se.duration=w.fx.off?0:typeof se.duration=="number"?se.duration:se.duration in w.fx.speeds?w.fx.speeds[se.duration]:w.fx.speeds._default,(se.queue==null||se.queue===!0)&&(se.queue="fx"),se.old=se.complete,se.complete=function(){w.isFunction(se.old)&&se.old.call(this),se.queue&&w.dequeue(this,se.queue)},se},w.fn.extend({fadeTo:function(C,G,Q,se){return this.filter(Pi).css("opacity",0).show().end().animate({opacity:G},C,Q,se)},animate:function(C,G,Q,se){var ve=w.isEmptyObject(C),Ee=w.speed(G,Q,se),Be=function(){var Qe=os(this,w.extend({},C),Ee);(ve||xt.get(this,"finish"))&&Qe.stop(!0)};return Be.finish=Be,ve||Ee.queue===!1?this.each(Be):this.queue(Ee.queue,Be)},stop:function(C,G,Q){var se=function(ve){var Ee=ve.stop;delete ve.stop,Ee(Q)};return typeof C!="string"&&(Q=G,G=C,C=void 0),G&&C!==!1&&this.queue(C||"fx",[]),this.each(function(){var ve=!0,Ee=C!=null&&C+"queueHooks",Be=w.timers,Qe=xt.get(this);if(Ee)Qe[Ee]&&Qe[Ee].stop&&se(Qe[Ee]);else for(Ee in Qe)Qe[Ee]&&Qe[Ee].stop&&ii.test(Ee)&&se(Qe[Ee]);for(Ee=Be.length;Ee--;)Be[Ee].elem===this&&(C==null||Be[Ee].queue===C)&&(Be[Ee].anim.stop(Q),ve=!1,Be.splice(Ee,1));(ve||!Q)&&w.dequeue(this,C)})},finish:function(C){return C!==!1&&(C=C||"fx"),this.each(function(){var G,Q=xt.get(this),se=Q[C+"queue"],ve=Q[C+"queueHooks"],Ee=w.timers,Be=se?se.length:0;for(Q.finish=!0,w.queue(this,C,[]),ve&&ve.stop&&ve.stop.call(this,!0),G=Ee.length;G--;)Ee[G].elem===this&&Ee[G].queue===C&&(Ee[G].anim.stop(!0),Ee.splice(G,1));for(G=0;G<Be;G++)se[G]&&se[G].finish&&se[G].finish.call(this);delete Q.finish})}}),w.each(["toggle","show","hide"],function(C,G){var Q=w.fn[G];w.fn[G]=function(se,ve,Ee){return se==null||typeof se=="boolean"?Q.apply(this,arguments):this.animate(_i(G,!0),se,ve,Ee)}}),w.each({slideDown:_i("show"),slideUp:_i("hide"),slideToggle:_i("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(C,G){w.fn[C]=function(Q,se,ve){return this.animate(G,Q,se,ve)}}),w.timers=[],w.fx.tick=function(){var C,G=0,Q=w.timers;for(_t=w.now();G<Q.length;G++)C=Q[G],!C()&&Q[G]===C&&Q.splice(G--,1);Q.length||w.fx.stop(),_t=void 0},w.fx.timer=function(C){w.timers.push(C),C()?w.fx.start():w.timers.pop()},w.fx.interval=13,w.fx.start=function(){bt||(bt=setInterval(w.fx.tick,w.fx.interval))},w.fx.stop=function(){clearInterval(bt),bt=null},w.fx.speeds={slow:600,fast:200,_default:400},w.fn.delay=function(C,G){return C=w.fx&&w.fx.speeds[C]||C,G=G||"fx",this.queue(G,function(Q,se){var ve=setTimeout(Q,C);se.stop=function(){clearTimeout(ve)}})},function(){var C=D.createElement("input"),G=D.createElement("select"),Q=G.appendChild(D.createElement("option"));C.type="checkbox",O.checkOn=C.value!=="",O.optSelected=Q.selected,G.disabled=!0,O.optDisabled=!Q.disabled,C=D.createElement("input"),C.value="t",C.type="radio",O.radioValue=C.value==="t"}();var St,Wi,zi=w.expr.attrHandle;w.fn.extend({attr:function(C,G){return Mt(this,w.attr,C,G,arguments.length>1)},removeAttr:function(C){return this.each(function(){w.removeAttr(this,C)})}}),w.extend({attr:function(C,G,Q){var se,ve,Ee=C.nodeType;if(!(!C||Ee===3||Ee===8||Ee===2)){if(typeof C.getAttribute===$t)return w.prop(C,G,Q);if((Ee!==1||!w.isXMLDoc(C))&&(G=G.toLowerCase(),se=w.attrHooks[G]||(w.expr.match.bool.test(G)?Wi:St)),Q!==void 0)if(Q===null)w.removeAttr(C,G);else return se&&"set"in se&&(ve=se.set(C,Q,G))!==void 0?ve:(C.setAttribute(G,Q+""),Q);else return se&&"get"in se&&(ve=se.get(C,G))!==null?ve:(ve=w.find.attr(C,G),ve??void 0)}},removeAttr:function(C,G){var Q,se,ve=0,Ee=G&&G.match(Bt);if(Ee&&C.nodeType===1)for(;Q=Ee[ve++];)se=w.propFix[Q]||Q,w.expr.match.bool.test(Q)&&(C[se]=!1),C.removeAttribute(Q)},attrHooks:{type:{set:function(C,G){if(!O.radioValue&&G==="radio"&&w.nodeName(C,"input")){var Q=C.value;return C.setAttribute("type",G),Q&&(C.value=Q),G}}}}}),Wi={set:function(C,G,Q){return G===!1?w.removeAttr(C,Q):C.setAttribute(Q,Q),Q}},w.each(w.expr.match.bool.source.match(/\w+/g),function(C,G){var Q=zi[G]||w.find.attr;zi[G]=function(se,ve,Ee){var Be,Qe;return Ee||(Qe=zi[ve],zi[ve]=Be,Be=Q(se,ve,Ee)!=null?ve.toLowerCase():null,zi[ve]=Qe),Be}});var Di=/^(?:input|select|textarea|button)$/i;w.fn.extend({prop:function(C,G){return Mt(this,w.prop,C,G,arguments.length>1)},removeProp:function(C){return this.each(function(){delete this[w.propFix[C]||C]})}}),w.extend({propFix:{for:"htmlFor",class:"className"},prop:function(C,G,Q){var se,ve,Ee,Be=C.nodeType;if(!(!C||Be===3||Be===8||Be===2))return Ee=Be!==1||!w.isXMLDoc(C),Ee&&(G=w.propFix[G]||G,ve=w.propHooks[G]),Q!==void 0?ve&&"set"in ve&&(se=ve.set(C,Q,G))!==void 0?se:C[G]=Q:ve&&"get"in ve&&(se=ve.get(C,G))!==null?se:C[G]},propHooks:{tabIndex:{get:function(C){return C.hasAttribute("tabindex")||Di.test(C.nodeName)||C.href?C.tabIndex:-1}}}}),O.optSelected||(w.propHooks.selected={get:function(C){var G=C.parentNode;return G&&G.parentNode&&G.parentNode.selectedIndex,null}}),w.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){w.propFix[this.toLowerCase()]=this});var $s=/[\t\r\n\f]/g;w.fn.extend({addClass:function(C){var G,Q,se,ve,Ee,Be,Qe=typeof C=="string"&&C,yt=0,wt=this.length;if(w.isFunction(C))return this.each(function(mt){w(this).addClass(C.call(this,mt,this.className))});if(Qe){for(G=(C||"").match(Bt)||[];yt<wt;yt++)if(Q=this[yt],se=Q.nodeType===1&&(Q.className?(" "+Q.className+" ").replace($s," "):" "),se){for(Ee=0;ve=G[Ee++];)se.indexOf(" "+ve+" ")<0&&(se+=ve+" ");Be=w.trim(se),Q.className!==Be&&(Q.className=Be)}}return this},removeClass:function(C){var G,Q,se,ve,Ee,Be,Qe=arguments.length===0||typeof C=="string"&&C,yt=0,wt=this.length;if(w.isFunction(C))return this.each(function(mt){w(this).removeClass(C.call(this,mt,this.className))});if(Qe){for(G=(C||"").match(Bt)||[];yt<wt;yt++)if(Q=this[yt],se=Q.nodeType===1&&(Q.className?(" "+Q.className+" ").replace($s," "):""),se){for(Ee=0;ve=G[Ee++];)for(;se.indexOf(" "+ve+" ")>=0;)se=se.replace(" "+ve+" "," ");Be=C?w.trim(se):"",Q.className!==Be&&(Q.className=Be)}}return this},toggleClass:function(C,G){var Q=typeof C;return typeof G=="boolean"&&Q==="string"?G?this.addClass(C):this.removeClass(C):w.isFunction(C)?this.each(function(se){w(this).toggleClass(C.call(this,se,this.className,G),G)}):this.each(function(){if(Q==="string")for(var se,ve=0,Ee=w(this),Be=C.match(Bt)||[];se=Be[ve++];)Ee.hasClass(se)?Ee.removeClass(se):Ee.addClass(se);else(Q===$t||Q==="boolean")&&(this.className&&xt.set(this,"__className__",this.className),this.className=this.className||C===!1?"":xt.get(this,"__className__")||"")})},hasClass:function(C){for(var G=" "+C+" ",Q=0,se=this.length;Q<se;Q++)if(this[Q].nodeType===1&&(" "+this[Q].className+" ").replace($s," ").indexOf(G)>=0)return!0;return!1}});var Js=/\r/g;w.fn.extend({val:function(C){var G,Q,se,ve=this[0];return arguments.length?(se=w.isFunction(C),this.each(function(Ee){var Be;this.nodeType===1&&(se?Be=C.call(this,Ee,w(this).val()):Be=C,Be==null?Be="":typeof Be=="number"?Be+="":w.isArray(Be)&&(Be=w.map(Be,function(Qe){return Qe==null?"":Qe+""})),G=w.valHooks[this.type]||w.valHooks[this.nodeName.toLowerCase()],(!G||!("set"in G)||G.set(this,Be,"value")===void 0)&&(this.value=Be))})):ve?(G=w.valHooks[ve.type]||w.valHooks[ve.nodeName.toLowerCase()],G&&"get"in G&&(Q=G.get(ve,"value"))!==void 0?Q:(Q=ve.value,typeof Q=="string"?Q.replace(Js,""):Q??"")):void 0}}),w.extend({valHooks:{select:{get:function(C){for(var G,Q,se=C.options,ve=C.selectedIndex,Ee=C.type==="select-one"||ve<0,Be=Ee?null:[],Qe=Ee?ve+1:se.length,yt=ve<0?Qe:Ee?ve:0;yt<Qe;yt++)if(Q=se[yt],(Q.selected||yt===ve)&&(O.optDisabled?!Q.disabled:Q.getAttribute("disabled")===null)&&(!Q.parentNode.disabled||!w.nodeName(Q.parentNode,"optgroup"))){if(G=w(Q).val(),Ee)return G;Be.push(G)}return Be},set:function(C,G){for(var Q,se,ve=C.options,Ee=w.makeArray(G),Be=ve.length;Be--;)se=ve[Be],(se.selected=w.inArray(w(se).val(),Ee)>=0)&&(Q=!0);return Q||(C.selectedIndex=-1),Ee}}}}),w.each(["radio","checkbox"],function(){w.valHooks[this]={set:function(C,G){if(w.isArray(G))return C.checked=w.inArray(w(C).val(),G)>=0}},O.checkOn||(w.valHooks[this].get=function(C){return C.getAttribute("value")===null?"on":C.value})}),w.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(C,G){w.fn[G]=function(Q,se){return arguments.length>0?this.on(G,null,Q,se):this.trigger(G)}}),w.fn.extend({hover:function(C,G){return this.mouseenter(C).mouseleave(G||C)},bind:function(C,G,Q){return this.on(C,null,G,Q)},unbind:function(C,G){return this.off(C,null,G)},delegate:function(C,G,Q,se){return this.on(G,C,Q,se)},undelegate:function(C,G,Q){return arguments.length===1?this.off(C,"**"):this.off(G,C||"**",Q)}});var ks=w.now(),Vs=/\?/;w.parseJSON=function(C){return JSON.parse(C+"")},w.parseXML=function(C){var G,Q;if(!C||typeof C!="string")return null;try{Q=new DOMParser,G=Q.parseFromString(C,"text/xml")}catch{G=void 0}return(!G||G.getElementsByTagName("parsererror").length)&&w.error("Invalid XML: "+C),G};var Ji,Es,gn=/#.*$/,Us=/([?&])_=[^&]*/,qn=/^(.*?):[ \t]*([^\r\n]*)$/mg,mr=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Hn=/^(?:GET|HEAD)$/,nr=/^\/\//,sn=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,mn={},yr={},yn="*/".concat("*");try{Es=location.href}catch{Es=D.createElement("a"),Es.href="",Es=Es.href}Ji=sn.exec(Es.toLowerCase())||[];function Os(C){return function(G,Q){typeof G!="string"&&(Q=G,G="*");var se,ve=0,Ee=G.toLowerCase().match(Bt)||[];if(w.isFunction(Q))for(;se=Ee[ve++];)se[0]==="+"?(se=se.slice(1)||"*",(C[se]=C[se]||[]).unshift(Q)):(C[se]=C[se]||[]).push(Q)}}function Da(C,G,Q,se){var ve={},Ee=C===yr;function Be(Qe){var yt;return ve[Qe]=!0,w.each(C[Qe]||[],function(wt,mt){var Kt=mt(G,Q,se);if(typeof Kt=="string"&&!Ee&&!ve[Kt])return G.dataTypes.unshift(Kt),Be(Kt),!1;if(Ee)return!(yt=Kt)}),yt}return Be(G.dataTypes[0])||!ve["*"]&&Be("*")}function bo(C,G){var Q,se,ve=w.ajaxSettings.flatOptions||{};for(Q in G)G[Q]!==void 0&&((ve[Q]?C:se||(se={}))[Q]=G[Q]);return se&&w.extend(!0,C,se),C}function xa(C,G,Q){for(var se,ve,Ee,Be,Qe=C.contents,yt=C.dataTypes;yt[0]==="*";)yt.shift(),se===void 0&&(se=C.mimeType||G.getResponseHeader("Content-Type"));if(se){for(ve in Qe)if(Qe[ve]&&Qe[ve].test(se)){yt.unshift(ve);break}}if(yt[0]in Q)Ee=yt[0];else{for(ve in Q){if(!yt[0]||C.converters[ve+" "+yt[0]]){Ee=ve;break}Be||(Be=ve)}Ee=Ee||Be}if(Ee)return Ee!==yt[0]&&yt.unshift(Ee),Q[Ee]}function Yo(C,G,Q,se){var ve,Ee,Be,Qe,yt,wt={},mt=C.dataTypes.slice();if(mt[1])for(Be in C.converters)wt[Be.toLowerCase()]=C.converters[Be];for(Ee=mt.shift();Ee;)if(C.responseFields[Ee]&&(Q[C.responseFields[Ee]]=G),!yt&&se&&C.dataFilter&&(G=C.dataFilter(G,C.dataType)),yt=Ee,Ee=mt.shift(),Ee){if(Ee==="*")Ee=yt;else if(yt!=="*"&&yt!==Ee){if(Be=wt[yt+" "+Ee]||wt["* "+Ee],!Be){for(ve in wt)if(Qe=ve.split(" "),Qe[1]===Ee&&(Be=wt[yt+" "+Qe[0]]||wt["* "+Qe[0]],Be)){Be===!0?Be=wt[ve]:wt[ve]!==!0&&(Ee=Qe[0],mt.unshift(Qe[1]));break}}if(Be!==!0)if(Be&&C.throws)G=Be(G);else try{G=Be(G)}catch(Kt){return{state:"parsererror",error:Be?Kt:"No conversion from "+yt+" to "+Ee}}}}return{state:"success",data:G}}w.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Es,type:"GET",isLocal:mr.test(Ji[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":yn,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":w.parseJSON,"text xml":w.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(C,G){return G?bo(bo(C,w.ajaxSettings),G):bo(w.ajaxSettings,C)},ajaxPrefilter:Os(mn),ajaxTransport:Os(yr),ajax:function(C,G){typeof C=="object"&&(G=C,C=void 0),G=G||{};var Q,se,ve,Ee,Be,Qe,yt,wt,mt=w.ajaxSetup({},G),Kt=mt.context||mt,jt=mt.context&&(Kt.nodeType||Kt.jquery)?w(Kt):w.event,hi=w.Deferred(),Ri=w.Callbacks("once memory"),Gi=mt.statusCode||{},Cs={},En={},as=0,ss="canceled",xi={readyState:0,getResponseHeader:function($i){var Ps;if(as===2){if(!Ee)for(Ee={};Ps=qn.exec(ve);)Ee[Ps[1].toLowerCase()]=Ps[2];Ps=Ee[$i.toLowerCase()]}return Ps??null},getAllResponseHeaders:function(){return as===2?ve:null},setRequestHeader:function($i,Ps){var Ns=$i.toLowerCase();return as||($i=En[Ns]=En[Ns]||$i,Cs[$i]=Ps),this},overrideMimeType:function($i){return as||(mt.mimeType=$i),this},statusCode:function($i){var Ps;if($i)if(as<2)for(Ps in $i)Gi[Ps]=[Gi[Ps],$i[Ps]];else xi.always($i[xi.status]);return this},abort:function($i){var Ps=$i||ss;return Q&&Q.abort(Ps),Hs(0,Ps),this}};if(hi.promise(xi).complete=Ri.add,xi.success=xi.done,xi.error=xi.fail,mt.url=((C||mt.url||Es)+"").replace(gn,"").replace(nr,Ji[1]+"//"),mt.type=G.method||G.type||mt.method||mt.type,mt.dataTypes=w.trim(mt.dataType||"*").toLowerCase().match(Bt)||[""],mt.crossDomain==null&&(Qe=sn.exec(mt.url.toLowerCase()),mt.crossDomain=!!(Qe&&(Qe[1]!==Ji[1]||Qe[2]!==Ji[2]||(Qe[3]||(Qe[1]==="http:"?"80":"443"))!==(Ji[3]||(Ji[1]==="http:"?"80":"443"))))),mt.data&&mt.processData&&typeof mt.data!="string"&&(mt.data=w.param(mt.data,mt.traditional)),Da(mn,mt,G,xi),as===2)return xi;yt=mt.global,yt&&w.active++===0&&w.event.trigger("ajaxStart"),mt.type=mt.type.toUpperCase(),mt.hasContent=!Hn.test(mt.type),se=mt.url,mt.hasContent||(mt.data&&(se=mt.url+=(Vs.test(se)?"&":"?")+mt.data,delete mt.data),mt.cache===!1&&(mt.url=Us.test(se)?se.replace(Us,"$1_="+ks++):se+(Vs.test(se)?"&":"?")+"_="+ks++)),mt.ifModified&&(w.lastModified[se]&&xi.setRequestHeader("If-Modified-Since",w.lastModified[se]),w.etag[se]&&xi.setRequestHeader("If-None-Match",w.etag[se])),(mt.data&&mt.hasContent&&mt.contentType!==!1||G.contentType)&&xi.setRequestHeader("Content-Type",mt.contentType),xi.setRequestHeader("Accept",mt.dataTypes[0]&&mt.accepts[mt.dataTypes[0]]?mt.accepts[mt.dataTypes[0]]+(mt.dataTypes[0]!=="*"?", "+yn+"; q=0.01":""):mt.accepts["*"]);for(wt in mt.headers)xi.setRequestHeader(wt,mt.headers[wt]);if(mt.beforeSend&&(mt.beforeSend.call(Kt,xi,mt)===!1||as===2))return xi.abort();ss="abort";for(wt in{success:1,error:1,complete:1})xi[wt](mt[wt]);if(Q=Da(yr,mt,G,xi),!Q)Hs(-1,"No Transport");else{xi.readyState=1,yt&&jt.trigger("ajaxSend",[xi,mt]),mt.async&&mt.timeout>0&&(Be=setTimeout(function(){xi.abort("timeout")},mt.timeout));try{as=1,Q.send(Cs,Hs)}catch($i){if(as<2)Hs(-1,$i);else throw $i}}function Hs($i,Ps,Ns,br){var on,zn,$n,nn,rr,Gs=Ps;as!==2&&(as=2,Be&&clearTimeout(Be),Q=void 0,ve=br||"",xi.readyState=$i>0?4:0,on=$i>=200&&$i<300||$i===304,Ns&&(nn=xa(mt,xi,Ns)),nn=Yo(mt,nn,xi,on),on?(mt.ifModified&&(rr=xi.getResponseHeader("Last-Modified"),rr&&(w.lastModified[se]=rr),rr=xi.getResponseHeader("etag"),rr&&(w.etag[se]=rr)),$i===204||mt.type==="HEAD"?Gs="nocontent":$i===304?Gs="notmodified":(Gs=nn.state,zn=nn.data,$n=nn.error,on=!$n)):($n=Gs,($i||!Gs)&&(Gs="error",$i<0&&($i=0))),xi.status=$i,xi.statusText=(Ps||Gs)+"",on?hi.resolveWith(Kt,[zn,Gs,xi]):hi.rejectWith(Kt,[xi,Gs,$n]),xi.statusCode(Gi),Gi=void 0,yt&&jt.trigger(on?"ajaxSuccess":"ajaxError",[xi,mt,on?zn:$n]),Ri.fireWith(Kt,[xi,Gs]),yt&&(jt.trigger("ajaxComplete",[xi,mt]),--w.active||w.event.trigger("ajaxStop")))}return xi},getJSON:function(C,G,Q){return w.get(C,G,Q,"json")},getScript:function(C,G){return w.get(C,void 0,G,"script")}}),w.each(["get","post"],function(C,G){w[G]=function(Q,se,ve,Ee){return w.isFunction(se)&&(Ee=Ee||ve,ve=se,se=void 0),w.ajax({url:Q,type:G,dataType:Ee,data:se,success:ve})}}),w.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(C,G){w.fn[G]=function(Q){return this.on(G,Q)}}),w._evalUrl=function(C){return w.ajax({url:C,type:"GET",dataType:"script",async:!1,global:!1,throws:!0})},w.fn.extend({wrapAll:function(C){var G;return w.isFunction(C)?this.each(function(Q){w(this).wrapAll(C.call(this,Q))}):(this[0]&&(G=w(C,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&G.insertBefore(this[0]),G.map(function(){for(var Q=this;Q.firstElementChild;)Q=Q.firstElementChild;return Q}).append(this)),this)},wrapInner:function(C){return w.isFunction(C)?this.each(function(G){w(this).wrapInner(C.call(this,G))}):this.each(function(){var G=w(this),Q=G.contents();Q.length?Q.wrapAll(C):G.append(C)})},wrap:function(C){var G=w.isFunction(C);return this.each(function(Q){w(this).wrapAll(G?C.call(this,Q):C)})},unwrap:function(){return this.parent().each(function(){w.nodeName(this,"body")||w(this).replaceWith(this.childNodes)}).end()}}),w.expr.filters.hidden=function(C){return C.offsetWidth<=0&&C.offsetHeight<=0},w.expr.filters.visible=function(C){return!w.expr.filters.hidden(C)};var sl=/%20/g,Ia=/\[\]$/,So=/\r?\n/g,Ko=/^(?:submit|button|image|reset|file)$/i,Ur=/^(?:input|select|textarea|keygen)/i;function Ao(C,G,Q,se){var ve;if(w.isArray(G))w.each(G,function(Ee,Be){Q||Ia.test(C)?se(C,Be):Ao(C+"["+(typeof Be=="object"?Ee:"")+"]",Be,Q,se)});else if(!Q&&w.type(G)==="object")for(ve in G)Ao(C+"["+ve+"]",G[ve],Q,se);else se(C,G)}w.param=function(C,G){var Q,se=[],ve=function(Ee,Be){Be=w.isFunction(Be)?Be():Be??"",se[se.length]=encodeURIComponent(Ee)+"="+encodeURIComponent(Be)};if(G===void 0&&(G=w.ajaxSettings&&w.ajaxSettings.traditional),w.isArray(C)||C.jquery&&!w.isPlainObject(C))w.each(C,function(){ve(this.name,this.value)});else for(Q in C)Ao(Q,C[Q],G,ve);return se.join("&").replace(sl,"+")},w.fn.extend({serialize:function(){return w.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var C=w.prop(this,"elements");return C?w.makeArray(C):this}).filter(function(){var C=this.type;return this.name&&!w(this).is(":disabled")&&Ur.test(this.nodeName)&&!Ko.test(C)&&(this.checked||!Oi.test(C))}).map(function(C,G){var Q=w(this).val();return Q==null?null:w.isArray(Q)?w.map(Q,function(se){return{name:G.name,value:se.replace(So,`\r
`)}}):{name:G.name,value:Q.replace(So,`\r
`)}}).get()}}),w.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch{}};var ro=0,wo={},Va={0:200,1223:204},_r=w.ajaxSettings.xhr();e.ActiveXObject&&w(e).on("unload",function(){for(var C in wo)wo[C]()}),O.cors=!!_r&&"withCredentials"in _r,O.ajax=_r=!!_r,w.ajaxTransport(function(C){var G;if(O.cors||_r&&!C.crossDomain)return{send:function(Q,se){var ve,Ee=C.xhr(),Be=++ro;if(Ee.open(C.type,C.url,C.async,C.username,C.password),C.xhrFields)for(ve in C.xhrFields)Ee[ve]=C.xhrFields[ve];C.mimeType&&Ee.overrideMimeType&&Ee.overrideMimeType(C.mimeType),!C.crossDomain&&!Q["X-Requested-With"]&&(Q["X-Requested-With"]="XMLHttpRequest");for(ve in Q)Ee.setRequestHeader(ve,Q[ve]);G=function(Qe){return function(){G&&(delete wo[Be],G=Ee.onload=Ee.onerror=null,Qe==="abort"?Ee.abort():Qe==="error"?se(Ee.status,Ee.statusText):se(Va[Ee.status]||Ee.status,Ee.statusText,typeof Ee.responseText=="string"?{text:Ee.responseText}:void 0,Ee.getAllResponseHeaders()))}},Ee.onload=G(),Ee.onerror=G("error"),G=wo[Be]=G("abort"),Ee.send(C.hasContent&&C.data||null)},abort:function(){G&&G()}}}),w.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(C){return w.globalEval(C),C}}}),w.ajaxPrefilter("script",function(C){C.cache===void 0&&(C.cache=!1),C.crossDomain&&(C.type="GET")}),w.ajaxTransport("script",function(C){if(C.crossDomain){var G,Q;return{send:function(se,ve){G=w("<script>").prop({async:!0,charset:C.scriptCharset,src:C.url}).on("load error",Q=function(Ee){G.remove(),Q=null,Ee&&ve(Ee.type==="error"?404:200,Ee.type)}),D.head.appendChild(G[0])},abort:function(){Q&&Q()}}}});var vr=[],Gr=/(=)\?(?=&|$)|\?\?/;w.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var C=vr.pop()||w.expando+"_"+ks++;return this[C]=!0,C}}),w.ajaxPrefilter("json jsonp",function(C,G,Q){var se,ve,Ee,Be=C.jsonp!==!1&&(Gr.test(C.url)?"url":typeof C.data=="string"&&!(C.contentType||"").indexOf("application/x-www-form-urlencoded")&&Gr.test(C.data)&&"data");if(Be||C.dataTypes[0]==="jsonp")return se=C.jsonpCallback=w.isFunction(C.jsonpCallback)?C.jsonpCallback():C.jsonpCallback,Be?C[Be]=C[Be].replace(Gr,"$1"+se):C.jsonp!==!1&&(C.url+=(Vs.test(C.url)?"&":"?")+C.jsonp+"="+se),C.converters["script json"]=function(){return Ee||w.error(se+" was not called"),Ee[0]},C.dataTypes[0]="json",ve=e[se],e[se]=function(){Ee=arguments},Q.always(function(){e[se]=ve,C[se]&&(C.jsonpCallback=G.jsonpCallback,vr.push(se)),Ee&&w.isFunction(ve)&&ve(Ee[0]),Ee=ve=void 0}),"script"}),w.parseHTML=function(C,G,Q){if(!C||typeof C!="string")return null;typeof G=="boolean"&&(Q=G,G=!1),G=G||D;var se=fe.exec(C),ve=!Q&&[];return se?[G.createElement(se[1])]:(se=w.buildFragment([C],G,ve),ve&&ve.length&&w(ve).remove(),w.merge([],se.childNodes))};var Xo=w.fn.load;w.fn.load=function(C,G,Q){if(typeof C!="string"&&Xo)return Xo.apply(this,arguments);var se,ve,Ee,Be=this,Qe=C.indexOf(" ");return Qe>=0&&(se=C.slice(Qe),C=C.slice(0,Qe)),w.isFunction(G)?(Q=G,G=void 0):G&&typeof G=="object"&&(ve="POST"),Be.length>0&&w.ajax({url:C,type:ve,dataType:"html",data:G}).done(function(yt){Ee=arguments,Be.html(se?w("<div>").append(w.parseHTML(yt)).find(se):yt)}).complete(Q&&function(yt,wt){Be.each(Q,Ee||[yt.responseText,wt,yt])}),this},w.expr.filters.animated=function(C){return w.grep(w.timers,function(G){return C===G.elem}).length};var Wr=e.document.documentElement;function Oa(C){return w.isWindow(C)?C:C.nodeType===9&&C.defaultView}w.offset={setOffset:function(C,G,Q){var se,ve,Ee,Be,Qe,yt,wt,mt=w.css(C,"position"),Kt=w(C),jt={};mt==="static"&&(C.style.position="relative"),Qe=Kt.offset(),Ee=w.css(C,"top"),yt=w.css(C,"left"),wt=(mt==="absolute"||mt==="fixed")&&(Ee+yt).indexOf("auto")>-1,wt?(se=Kt.position(),Be=se.top,ve=se.left):(Be=parseFloat(Ee)||0,ve=parseFloat(yt)||0),w.isFunction(G)&&(G=G.call(C,Q,Qe)),G.top!=null&&(jt.top=G.top-Qe.top+Be),G.left!=null&&(jt.left=G.left-Qe.left+ve),"using"in G?G.using.call(C,jt):Kt.css(jt)}},w.fn.extend({offset:function(C){if(arguments.length)return C===void 0?this:this.each(function(Be){w.offset.setOffset(this,C,Be)});var G,Q,se=this[0],ve={top:0,left:0},Ee=se&&se.ownerDocument;if(Ee)return G=Ee.documentElement,w.contains(G,se)?(typeof se.getBoundingClientRect!==$t&&(ve=se.getBoundingClientRect()),Q=Oa(Ee),{top:ve.top+Q.pageYOffset-G.clientTop,left:ve.left+Q.pageXOffset-G.clientLeft}):ve},position:function(){if(this[0]){var C,G,Q=this[0],se={top:0,left:0};return w.css(Q,"position")==="fixed"?G=Q.getBoundingClientRect():(C=this.offsetParent(),G=this.offset(),w.nodeName(C[0],"html")||(se=C.offset()),se.top+=w.css(C[0],"borderTopWidth",!0),se.left+=w.css(C[0],"borderLeftWidth",!0)),{top:G.top-se.top-w.css(Q,"marginTop",!0),left:G.left-se.left-w.css(Q,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var C=this.offsetParent||Wr;C&&!w.nodeName(C,"html")&&w.css(C,"position")==="static";)C=C.offsetParent;return C||Wr})}}),w.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(C,G){var Q=G==="pageYOffset";w.fn[C]=function(se){return Mt(this,function(ve,Ee,Be){var Qe=Oa(ve);if(Be===void 0)return Qe?Qe[G]:ve[Ee];Qe?Qe.scrollTo(Q?e.pageXOffset:Be,Q?Be:e.pageYOffset):ve[Ee]=Be},C,se,arguments.length,null)}}),w.each(["top","left"],function(C,G){w.cssHooks[G]=xe(O.pixelPosition,function(Q,se){if(se)return se=ye(Q,G),Ve.test(se)?w(Q).position()[G]+"px":se})}),w.each({Height:"height",Width:"width"},function(C,G){w.each({padding:"inner"+C,content:G,"":"outer"+C},function(Q,se){w.fn[se]=function(ve,Ee){var Be=arguments.length&&(Q||typeof ve!="boolean"),Qe=Q||(ve===!0||Ee===!0?"margin":"border");return Mt(this,function(yt,wt,mt){var Kt;return w.isWindow(yt)?yt.document.documentElement["client"+C]:yt.nodeType===9?(Kt=yt.documentElement,Math.max(yt.body["scroll"+C],Kt["scroll"+C],yt.body["offset"+C],Kt["offset"+C],Kt["client"+C])):mt===void 0?w.css(yt,wt,Qe):w.style(yt,wt,mt,Qe)},G,Be?ve:void 0,Be,null)}})}),w.fn.size=function(){return this.length},w.fn.andSelf=w.fn.addBack;var Br=e.jQuery,nl=e.$;return w.noConflict=function(C){return e.$===w&&(e.$=nl),C&&e.jQuery===w&&(e.jQuery=Br),w},typeof t===$t&&(e.jQuery=e.$=w),w})})();var lodash4_17_4={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright JS Foundation and other contributors <https://js.foundation/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */lodash4_17_4.exports;(function(o,e){(function(){var t,n="4.17.4",r=200,s="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",a="Expected a function",l="__lodash_hash_undefined__",d=500,c="__lodash_placeholder__",y=1,m=2,O=4,D=1,z=2,w=1,N=2,H=4,X=8,ae=16,oe=32,ue=64,fe=128,be=256,Ae=512,W=30,J="...",Ue=800,gt=16,Te=1,Et=2,Bt=3,Ke=1/0,At=9007199254740991,nt=17976931348623157e292,dt=NaN,Mt=4294967295,zt=Mt-1,xt=Mt>>>1,Gt=[["ary",fe],["bind",w],["bindKey",N],["curry",X],["curryRight",ae],["flip",Ae],["partial",oe],["partialRight",ue],["rearg",be]],yi="[object Arguments]",ti="[object Array]",Mi="[object AsyncFunction]",Li="[object Boolean]",qi="[object Date]",Pi="[object DOMException]",Oi="[object Error]",$t="[object Function]",Rs="[object GeneratorFunction]",is="[object Map]",hs="[object Number]",qs="[object Null]",q="[object Object]",Re="[object Promise]",He="[object Proxy]",Ze="[object RegExp]",Xe="[object Set]",Pe="[object String]",Le="[object Symbol]",De="[object Undefined]",ct="[object WeakMap]",h="[object WeakSet]",f="[object ArrayBuffer]",b="[object DataView]",L="[object Float32Array]",I="[object Float64Array]",B="[object Int8Array]",j="[object Int16Array]",Y="[object Int32Array]",Z="[object Uint8Array]",ie="[object Uint8ClampedArray]",pe="[object Uint16Array]",me="[object Uint32Array]",de=/\b__p \+= '';/g,le=/\b(__p \+=) '' \+/g,we=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Ve=/&(?:amp|lt|gt|quot|#39);/g,ke=/[&<>"']/g,ye=RegExp(Ve.source),xe=RegExp(ke.source),ce=/<%-([\s\S]+?)%>/g,Se=/<%([\s\S]+?)%>/g,Ie=/<%=([\s\S]+?)%>/g,Me=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ze=/^\w*$/,Ge=/^\./,We=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,je=/[\\^$.*+?()[\]{}|]/g,rt=RegExp(je.source),Je=/^\s+|\s+$/g,lt=/^\s+/,ht=/\s+$/,_t=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,bt=/\{\n\/\* \[wrapped with (.+)\] \*/,Tt=/,? & /,Jt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ii=/\\(\\)?/g,Rt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Si=/\w*$/,bi=/^[-+]0x[0-9a-f]+$/i,_i=/^0b[01]+$/i,mi=/^\[object .+?Constructor\]$/,Yt=/^0o[0-7]+$/i,Ti=/^(?:0|[1-9]\d*)$/,os=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,St=/($^)/,Wi=/['\n\r\u2028\u2029\\]/g,zi="\\ud800-\\udfff",Di="\\u0300-\\u036f",$s="\\ufe20-\\ufe2f",Js="\\u20d0-\\u20ff",ks=Di+$s+Js,Vs="\\u2700-\\u27bf",Ji="a-z\\xdf-\\xf6\\xf8-\\xff",Es="\\xac\\xb1\\xd7\\xf7",gn="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Us="\\u2000-\\u206f",qn=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",mr="A-Z\\xc0-\\xd6\\xd8-\\xde",Hn="\\ufe0e\\ufe0f",nr=Es+gn+Us+qn,sn="['’]",mn="["+zi+"]",yr="["+nr+"]",yn="["+ks+"]",Os="\\d+",Da="["+Vs+"]",bo="["+Ji+"]",xa="[^"+zi+nr+Os+Vs+Ji+mr+"]",Yo="\\ud83c[\\udffb-\\udfff]",sl="(?:"+yn+"|"+Yo+")",Ia="[^"+zi+"]",So="(?:\\ud83c[\\udde6-\\uddff]){2}",Ko="[\\ud800-\\udbff][\\udc00-\\udfff]",Ur="["+mr+"]",Ao="\\u200d",ro="(?:"+bo+"|"+xa+")",wo="(?:"+Ur+"|"+xa+")",Va="(?:"+sn+"(?:d|ll|m|re|s|t|ve))?",_r="(?:"+sn+"(?:D|LL|M|RE|S|T|VE))?",vr=sl+"?",Gr="["+Hn+"]?",Xo="(?:"+Ao+"(?:"+[Ia,So,Ko].join("|")+")"+Gr+vr+")*",Wr="\\d*(?:(?:1st|2nd|3rd|(?![123])\\dth)\\b)",Oa="\\d*(?:(?:1ST|2ND|3RD|(?![123])\\dTH)\\b)",Br=Gr+vr+Xo,nl="(?:"+[Da,So,Ko].join("|")+")"+Br,C="(?:"+[Ia+yn+"?",yn,So,Ko,mn].join("|")+")",G=RegExp(sn,"g"),Q=RegExp(yn,"g"),se=RegExp(Yo+"(?="+Yo+")|"+C+Br,"g"),ve=RegExp([Ur+"?"+bo+"+"+Va+"(?="+[yr,Ur,"$"].join("|")+")",wo+"+"+_r+"(?="+[yr,Ur+ro,"$"].join("|")+")",Ur+"?"+ro+"+"+Va,Ur+"+"+_r,Oa,Wr,Os,nl].join("|"),"g"),Ee=RegExp("["+Ao+zi+ks+Hn+"]"),Be=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Qe=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],yt=-1,wt={};wt[L]=wt[I]=wt[B]=wt[j]=wt[Y]=wt[Z]=wt[ie]=wt[pe]=wt[me]=!0,wt[yi]=wt[ti]=wt[f]=wt[Li]=wt[b]=wt[qi]=wt[Oi]=wt[$t]=wt[is]=wt[hs]=wt[q]=wt[Ze]=wt[Xe]=wt[Pe]=wt[ct]=!1;var mt={};mt[yi]=mt[ti]=mt[f]=mt[b]=mt[Li]=mt[qi]=mt[L]=mt[I]=mt[B]=mt[j]=mt[Y]=mt[is]=mt[hs]=mt[q]=mt[Ze]=mt[Xe]=mt[Pe]=mt[Le]=mt[Z]=mt[ie]=mt[pe]=mt[me]=!0,mt[Oi]=mt[$t]=mt[ct]=!1;var Kt={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},jt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},hi={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Ri={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Gi=parseFloat,Cs=parseInt,En=typeof commonjsGlobal=="object"&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,as=typeof self=="object"&&self&&self.Object===Object&&self,ss=En||as||Function("return this")(),xi=e&&!e.nodeType&&e,Hs=xi&&!0&&o&&!o.nodeType&&o,$i=Hs&&Hs.exports===xi,Ps=$i&&En.process,Ns=function(){try{return Ps&&Ps.binding&&Ps.binding("util")}catch{}}(),br=Ns&&Ns.isArrayBuffer,on=Ns&&Ns.isDate,zn=Ns&&Ns.isMap,$n=Ns&&Ns.isRegExp,nn=Ns&&Ns.isSet,rr=Ns&&Ns.isTypedArray;function Gs(ot,Ct){return ot.set(Ct[0],Ct[1]),ot}function or(ot,Ct){return ot.add(Ct),ot}function an(ot,Ct,Lt){switch(Lt.length){case 0:return ot.call(Ct);case 1:return ot.call(Ct,Lt[0]);case 2:return ot.call(Ct,Lt[0],Lt[1]);case 3:return ot.call(Ct,Lt[0],Lt[1],Lt[2])}return ot.apply(Ct,Lt)}function Sr(ot,Ct,Lt,si){for(var wi=-1,Ei=ot==null?0:ot.length;++wi<Ei;){var xs=ot[wi];Ct(si,xs,Lt(xs),ot)}return si}function rn(ot,Ct){for(var Lt=-1,si=ot==null?0:ot.length;++Lt<si&&Ct(ot[Lt],Lt,ot)!==!1;);return ot}function _s(ot,Ct){for(var Lt=ot==null?0:ot.length;Lt--&&Ct(ot[Lt],Lt,ot)!==!1;);return ot}function Ar(ot,Ct){for(var Lt=-1,si=ot==null?0:ot.length;++Lt<si;)if(!Ct(ot[Lt],Lt,ot))return!1;return!0}function xn(ot,Ct){for(var Lt=-1,si=ot==null?0:ot.length,wi=0,Ei=[];++Lt<si;){var xs=ot[Lt];Ct(xs,Lt,ot)&&(Ei[wi++]=xs)}return Ei}function oo(ot,Ct){var Lt=ot==null?0:ot.length;return!!Lt&&qr(ot,Ct,0)>-1}function Fr(ot,Ct,Lt){for(var si=-1,wi=ot==null?0:ot.length;++si<wi;)if(Lt(Ct,ot[si]))return!0;return!1}function Ss(ot,Ct){for(var Lt=-1,si=ot==null?0:ot.length,wi=Array(si);++Lt<si;)wi[Lt]=Ct(ot[Lt],Lt,ot);return wi}function wr(ot,Ct){for(var Lt=-1,si=Ct.length,wi=ot.length;++Lt<si;)ot[wi+Lt]=Ct[Lt];return ot}function ao(ot,Ct,Lt,si){var wi=-1,Ei=ot==null?0:ot.length;for(si&&Ei&&(Lt=ot[++wi]);++wi<Ei;)Lt=Ct(Lt,ot[wi],wi,ot);return Lt}function jo(ot,Ct,Lt,si){var wi=ot==null?0:ot.length;for(si&&wi&&(Lt=ot[--wi]);wi--;)Lt=Ct(Lt,ot[wi],wi,ot);return Lt}function Zo(ot,Ct){for(var Lt=-1,si=ot==null?0:ot.length;++Lt<si;)if(Ct(ot[Lt],Lt,ot))return!0;return!1}var rl=In("length");function Eo(ot){return ot.split("")}function ol(ot){return ot.match(Jt)||[]}function Ma(ot,Ct,Lt){var si;return Lt(ot,function(wi,Ei,xs){if(Ct(wi,Ei,xs))return si=Ei,!1}),si}function Er(ot,Ct,Lt,si){for(var wi=ot.length,Ei=Lt+(si?1:-1);si?Ei--:++Ei<wi;)if(Ct(ot[Ei],Ei,ot))return Ei;return-1}function qr(ot,Ct,Lt){return Ct===Ct?Vt(ot,Ct,Lt):Er(ot,Jo,Lt)}function Qo(ot,Ct,Lt,si){for(var wi=Lt-1,Ei=ot.length;++wi<Ei;)if(si(ot[wi],Ct))return wi;return-1}function Jo(ot){return ot!==ot}function ar(ot,Ct){var Lt=ot==null?0:ot.length;return Lt?hn(ot,Ct)/Lt:dt}function In(ot){return function(Ct){return Ct==null?t:Ct[ot]}}function vs(ot){return function(Ct){return ot==null?t:ot[Ct]}}function Yr(ot,Ct,Lt,si,wi){return wi(ot,function(Ei,xs,cs){Lt=si?(si=!1,Ei):Ct(Lt,Ei,xs,cs)}),Lt}function Vn(ot,Ct){var Lt=ot.length;for(ot.sort(Ct);Lt--;)ot[Lt]=ot[Lt].value;return ot}function hn(ot,Ct){for(var Lt,si=-1,wi=ot.length;++si<wi;){var Ei=Ct(ot[si]);Ei!==t&&(Lt=Lt===t?Ei:Lt+Ei)}return Lt}function lr(ot,Ct){for(var Lt=-1,si=Array(ot);++Lt<ot;)si[Lt]=Ct(Lt);return si}function On(ot,Ct){return Ss(Ct,function(Lt){return[Lt,ot[Lt]]})}function _n(ot){return function(Ct){return ot(Ct)}}function ea(ot,Ct){return Ss(Ct,function(Lt){return ot[Lt]})}function Mn(ot,Ct){return ot.has(Ct)}function Po(ot,Ct){for(var Lt=-1,si=ot.length;++Lt<si&&qr(Ct,ot[Lt],0)>-1;);return Lt}function ta(ot,Ct){for(var Lt=ot.length;Lt--&&qr(Ct,ot[Lt],0)>-1;);return Lt}function Lo(ot,Ct){for(var Lt=ot.length,si=0;Lt--;)ot[Lt]===Ct&&++si;return si}var To=vs(Kt),ia=vs(jt);function sa(ot){return"\\"+Ri[ot]}function Co(ot,Ct){return ot==null?t:ot[Ct]}function Pr(ot){return Ee.test(ot)}function na(ot){return Be.test(ot)}function ka(ot){for(var Ct,Lt=[];!(Ct=ot.next()).done;)Lt.push(Ct.value);return Lt}function vn(ot){var Ct=-1,Lt=Array(ot.size);return ot.forEach(function(si,wi){Lt[++Ct]=[wi,si]}),Lt}function ra(ot,Ct){return function(Lt){return ot(Ct(Lt))}}function Fe(ot,Ct){for(var Lt=-1,si=ot.length,wi=0,Ei=[];++Lt<si;){var xs=ot[Lt];(xs===Ct||xs===c)&&(ot[Lt]=c,Ei[wi++]=Lt)}return Ei}function tt(ot){var Ct=-1,Lt=Array(ot.size);return ot.forEach(function(si){Lt[++Ct]=si}),Lt}function ft(ot){var Ct=-1,Lt=Array(ot.size);return ot.forEach(function(si){Lt[++Ct]=[si,si]}),Lt}function Vt(ot,Ct,Lt){for(var si=Lt-1,wi=ot.length;++si<wi;)if(ot[si]===Ct)return si;return-1}function Pt(ot,Ct,Lt){for(var si=Lt+1;si--;)if(ot[si]===Ct)return si;return si}function qt(ot){return Pr(ot)?Ai(ot):rl(ot)}function Ft(ot){return Pr(ot)?Hi(ot):Eo(ot)}var ri=vs(hi);function Ai(ot){for(var Ct=se.lastIndex=0;se.test(ot);)++Ct;return Ct}function Hi(ot){return ot.match(se)||[]}function Bi(ot){return ot.match(ve)||[]}var Ii=function ot(Ct){Ct=Ct==null?ss:us.defaults(ss.Object(),Ct,us.pick(ss,Qe));var Lt=Ct.Array,si=Ct.Date,wi=Ct.Error,Ei=Ct.Function,xs=Ct.Math,cs=Ct.Object,al=Ct.RegExp,Nh=Ct.String,Un=Ct.TypeError,Ra=Lt.prototype,Bh=Ei.prototype,oa=cs.prototype,Na=Ct["__core-js_shared__"],Ba=Bh.toString,Ms=oa.hasOwnProperty,aa=0,di=function(){var g=/[^.]+$/.exec(Na&&Na.keys&&Na.keys.IE_PROTO||"");return g?"Symbol(src)_1."+g:""}(),ps=oa.toString,Zl=Ba.call(cs),Fh=ss._,qh=al("^"+Ba.call(Ms).replace(je,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),kn=$i?Ct.Buffer:t,Zi=Ct.Symbol,lo=Ct.Uint8Array,ll=kn?kn.allocUnsafe:t,Fa=ra(cs.getPrototypeOf,cs),Ql=cs.create,Jl=oa.propertyIsEnumerable,qa=Ra.splice,eh=Zi?Zi.isConcatSpreadable:t,la=Zi?Zi.iterator:t,Kr=Zi?Zi.toStringTag:t,ha=function(){try{var g=ba(cs,"defineProperty");return g({},"",{}),g}catch{}}(),Hh=Ct.clearTimeout!==ss.clearTimeout&&Ct.clearTimeout,un=si&&si.now!==ss.Date.now&&si.now,Ha=Ct.setTimeout!==ss.setTimeout&&Ct.setTimeout,Hr=xs.ceil,ca=xs.floor,Xi=cs.getOwnPropertySymbols,th=kn?kn.isBuffer:t,ih=Ct.isFinite,Nu=Ra.join,Do=ra(cs.keys,cs),Ys=xs.max,cn=xs.min,Bu=si.now,Fu=Ct.parseInt,Gn=xs.random,hl=Ra.reverse,za=ba(Ct,"DataView"),Xr=ba(Ct,"Map"),ul=ba(Ct,"Promise"),xo=ba(Ct,"Set"),da=ba(Ct,"WeakMap"),pa=ba(cs,"create"),$a=da&&new da,fa={},zh=Sa(za),$h=Sa(Xr),Uh=Sa(ul),Gh=Sa(xo),sh=Sa(da),bn=Zi?Zi.prototype:t,ga=bn?bn.valueOf:t,nh=bn?bn.toString:t;function Ne(g){if(Zs(g)&&!ji(g)&&!(g instanceof ns)){if(g instanceof Wn)return g;if(Ms.call(g,"__wrapped__"))return Cc(g)}return new Wn(g)}var Io=function(){function g(){}return function(S){if(!Ws(S))return{};if(Ql)return Ql(S);g.prototype=S;var k=new g;return g.prototype=t,k}}();function ma(){}function Wn(g,S){this.__wrapped__=g,this.__actions__=[],this.__chain__=!!S,this.__index__=0,this.__values__=t}Ne.templateSettings={escape:ce,evaluate:Se,interpolate:Ie,variable:"",imports:{_:Ne}},Ne.prototype=ma.prototype,Ne.prototype.constructor=Ne,Wn.prototype=Io(ma.prototype),Wn.prototype.constructor=Wn;function ns(g){this.__wrapped__=g,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Mt,this.__views__=[]}function ya(){var g=new ns(this.__wrapped__);return g.__actions__=Kn(this.__actions__),g.__dir__=this.__dir__,g.__filtered__=this.__filtered__,g.__iteratees__=Kn(this.__iteratees__),g.__takeCount__=this.__takeCount__,g.__views__=Kn(this.__views__),g}function cl(){if(this.__filtered__){var g=new ns(this);g.__dir__=-1,g.__filtered__=!0}else g=this.clone(),g.__dir__*=-1;return g}function ho(){var g=this.__wrapped__.value(),S=this.__dir__,k=ji(g),re=S<0,Ce=k?g.length:0,qe=Zd(0,Ce,this.__views__),et=qe.start,pt=qe.end,vt=pt-et,Wt=re?pt:et-1,Ut=this.__iteratees__,Qt=Ut.length,ci=0,vi=cn(vt,this.__takeCount__);if(!k||!re&&Ce==vt&&vi==vt)return Ju(g,this.__actions__);var Fi=[];e:for(;vt--&&ci<vi;){Wt+=S;for(var ls=-1,Ui=g[Wt];++ls<Qt;){var gs=Ut[ls],Ts=gs.iteratee,Nn=gs.type,Bn=Ts(Ui);if(Nn==Et)Ui=Bn;else if(!Bn){if(Nn==Te)continue e;break e}}Fi[ci++]=Ui}return Fi}ns.prototype=Io(ma.prototype),ns.prototype.constructor=ns;function uo(g){var S=-1,k=g==null?0:g.length;for(this.clear();++S<k;){var re=g[S];this.set(re[0],re[1])}}function rh(){this.__data__=pa?pa(null):{},this.size=0}function dl(g){var S=this.has(g)&&delete this.__data__[g];return this.size-=S?1:0,S}function Ua(g){var S=this.__data__;if(pa){var k=S[g];return k===l?t:k}return Ms.call(S,g)?S[g]:t}function Wh(g){var S=this.__data__;return pa?S[g]!==t:Ms.call(S,g)}function pl(g,S){var k=this.__data__;return this.size+=this.has(g)?0:1,k[g]=pa&&S===t?l:S,this}uo.prototype.clear=rh,uo.prototype.delete=dl,uo.prototype.get=Ua,uo.prototype.has=Wh,uo.prototype.set=pl;function u(g){var S=-1,k=g==null?0:g.length;for(this.clear();++S<k;){var re=g[S];this.set(re[0],re[1])}}function A(){this.__data__=[],this.size=0}function T(g){var S=this.__data__,k=Xt(S,g);if(k<0)return!1;var re=S.length-1;return k==re?S.pop():qa.call(S,k,1),--this.size,!0}function E(g){var S=this.__data__,k=Xt(S,g);return k<0?t:S[k][1]}function V(g){return Xt(this.__data__,g)>-1}function M(g,S){var k=this.__data__,re=Xt(k,g);return re<0?(++this.size,k.push([g,S])):k[re][1]=S,this}u.prototype.clear=A,u.prototype.delete=T,u.prototype.get=E,u.prototype.has=V,u.prototype.set=M;function x(g){var S=-1,k=g==null?0:g.length;for(this.clear();++S<k;){var re=g[S];this.set(re[0],re[1])}}function F(){this.size=0,this.__data__={hash:new uo,map:new(Xr||u),string:new uo}}function K(g){var S=mh(this,g).delete(g);return this.size-=S?1:0,S}function R(g){return mh(this,g).get(g)}function U(g){return mh(this,g).has(g)}function te(g,S){var k=mh(this,g),re=k.size;return k.set(g,S),this.size+=k.size==re?0:1,this}x.prototype.clear=F,x.prototype.delete=K,x.prototype.get=R,x.prototype.has=U,x.prototype.set=te;function ne(g){var S=-1,k=g==null?0:g.length;for(this.__data__=new x;++S<k;)this.add(g[S])}function ee(g){return this.__data__.set(g,l),this}function _e(g){return this.__data__.has(g)}ne.prototype.add=ne.prototype.push=ee,ne.prototype.has=_e;function ge(g){var S=this.__data__=new u(g);this.size=S.size}function Oe(){this.__data__=new u,this.size=0}function $e(g){var S=this.__data__,k=S.delete(g);return this.size=S.size,k}function Ye(g){return this.__data__.get(g)}function it(g){return this.__data__.has(g)}function Dt(g,S){var k=this.__data__;if(k instanceof u){var re=k.__data__;if(!Xr||re.length<r-1)return re.push([g,S]),this.size=++k.size,this;k=this.__data__=new x(re)}return k.set(g,S),this.size=k.size,this}ge.prototype.clear=Oe,ge.prototype.delete=$e,ge.prototype.get=Ye,ge.prototype.has=it,ge.prototype.set=Dt;function ni(g,S){var k=ji(g),re=!k&&Aa(g),Ce=!k&&!re&&Ro(g),qe=!k&&!re&&!Ce&&Xa(g),et=k||re||Ce||qe,pt=et?lr(g.length,Nh):[],vt=pt.length;for(var Wt in g)(S||Ms.call(g,Wt))&&!(et&&(Wt=="length"||Ce&&(Wt=="offset"||Wt=="parent")||qe&&(Wt=="buffer"||Wt=="byteLength"||Wt=="byteOffset")||go(Wt,vt)))&&pt.push(Wt);return pt}function ei(g){var S=g.length;return S?g[Zh(0,S-1)]:t}function at(g,S){return yh(Kn(g),fi(S,0,g.length))}function Ht(g){return yh(Kn(g))}function Zt(g,S,k){(k!==t&&!Jr(g[S],k)||k===t&&!(S in g))&&st(g,S,k)}function kt(g,S,k){var re=g[S];(!(Ms.call(g,S)&&Jr(re,k))||k===t&&!(S in g))&&st(g,S,k)}function Xt(g,S){for(var k=g.length;k--;)if(Jr(g[k][0],S))return k;return-1}function It(g,S,k,re){return Bs(g,function(Ce,qe,et){S(re,Ce,k(Ce),et)}),re}function Nt(g,S){return g&&Zr(S,dn(S),g)}function Ot(g,S){return g&&Zr(S,dr(S),g)}function st(g,S,k){S=="__proto__"&&ha?ha(g,S,{configurable:!0,enumerable:!0,value:k,writable:!0}):g[S]=k}function ai(g,S){for(var k=-1,re=S.length,Ce=Lt(re),qe=g==null;++k<re;)Ce[k]=qe?t:Au(g,S[k]);return Ce}function fi(g,S,k){return g===g&&(k!==t&&(g=g<=k?g:k),S!==t&&(g=g>=S?g:S)),g}function ui(g,S,k,re,Ce,qe){var et,pt=S&y,vt=S&m,Wt=S&O;if(k&&(et=Ce?k(g,re,Ce,qe):k(g)),et!==t)return et;if(!Ws(g))return g;var Ut=ji(g);if(Ut){if(et=Jd(g),!pt)return Kn(g,et)}else{var Qt=Pn(g),ci=Qt==$t||Qt==Rs;if(Ro(g))return tc(g,pt);if(Qt==q||Qt==yi||ci&&!Ce){if(et=vt||ci?{}:vc(g),!pt)return vt?zd(g,Ot(et,g)):Hd(g,Nt(et,g))}else{if(!mt[Qt])return Ce?g:{};et=ep(g,Qt,ui,pt)}}qe||(qe=new ge);var vi=qe.get(g);if(vi)return vi;qe.set(g,et);var Fi=Wt?vt?hu:lu:vt?dr:dn,ls=Ut?t:Fi(g);return rn(ls||g,function(Ui,gs){ls&&(gs=Ui,Ui=g[gs]),kt(et,gs,ui(Ui,S,k,gs,g,qe))}),et}function gi(g){var S=dn(g);return function(k){return Vi(k,g,S)}}function Vi(g,S,k){var re=k.length;if(g==null)return!re;for(g=cs(g);re--;){var Ce=k[re],qe=S[Ce],et=g[Ce];if(et===t&&!(Ce in g)||!qe(et))return!1}return!0}function bs(g,S,k){if(typeof g!="function")throw new Un(a);return _l(function(){g.apply(t,k)},S)}function li(g,S,k,re){var Ce=-1,qe=oo,et=!0,pt=g.length,vt=[],Wt=S.length;if(!pt)return vt;k&&(S=Ss(S,_n(k))),re?(qe=Fr,et=!1):S.length>=r&&(qe=Mn,et=!1,S=new ne(S));e:for(;++Ce<pt;){var Ut=g[Ce],Qt=k==null?Ut:k(Ut);if(Ut=re||Ut!==0?Ut:0,et&&Qt===Qt){for(var ci=Wt;ci--;)if(S[ci]===Qt)continue e;vt.push(Ut)}else qe(S,Qt,re)||vt.push(Ut)}return vt}var Bs=oc(Rn),es=oc(hr,!0);function Vo(g,S){var k=!0;return Bs(g,function(re,Ce,qe){return k=!!S(re,Ce,qe),k}),k}function ln(g,S,k){for(var re=-1,Ce=g.length;++re<Ce;){var qe=g[re],et=S(qe);if(et!=null&&(pt===t?et===et&&!cr(et):k(et,pt)))var pt=et,vt=qe}return vt}function Ks(g,S,k,re){var Ce=g.length;for(k=Qi(k),k<0&&(k=-k>Ce?0:Ce+k),re=re===t||re>Ce?Ce:Qi(re),re<0&&(re+=Ce),re=k>re?0:Kc(re);k<re;)g[k++]=S;return g}function zr(g,S){var k=[];return Bs(g,function(re,Ce,qe){S(re,Ce,qe)&&k.push(re)}),k}function ys(g,S,k,re,Ce){var qe=-1,et=g.length;for(k||(k=ip),Ce||(Ce=[]);++qe<et;){var pt=g[qe];S>0&&k(pt)?S>1?ys(pt,S-1,k,re,Ce):wr(Ce,pt):re||(Ce[Ce.length]=pt)}return Ce}var Xs=ac(),Yi=ac(!0);function Rn(g,S){return g&&Xs(g,S,dn)}function hr(g,S){return g&&Yi(g,S,dn)}function Sn(g,S){return xn(S,function(k){return mo(g[k])})}function Ci(g,S){S=Mo(S,g);for(var k=0,re=S.length;g!=null&&k<re;)g=g[Qr(S[k++])];return k&&k==re?g:t}function Is(g,S,k){var re=S(g);return ji(g)?re:wr(re,k(g))}function zs(g){return g==null?g===t?De:qs:Kr&&Kr in cs(g)?jd(g):hp(g)}function co(g,S){return g>S}function Fs(g,S){return g!=null&&Ms.call(g,S)}function fl(g,S){return g!=null&&S in cs(g)}function oh(g,S,k){return g>=cn(S,k)&&g<Ys(S,k)}function Ga(g,S,k){for(var re=k?Fr:oo,Ce=g[0].length,qe=g.length,et=qe,pt=Lt(qe),vt=1/0,Wt=[];et--;){var Ut=g[et];et&&S&&(Ut=Ss(Ut,_n(S))),vt=cn(Ut.length,vt),pt[et]=!k&&(S||Ce>=120&&Ut.length>=120)?new ne(et&&Ut):t}Ut=g[0];var Qt=-1,ci=pt[0];e:for(;++Qt<Ce&&Wt.length<vt;){var vi=Ut[Qt],Fi=S?S(vi):vi;if(vi=k||vi!==0?vi:0,!(ci?Mn(ci,Fi):re(Wt,Fi,k))){for(et=qe;--et;){var ls=pt[et];if(!(ls?Mn(ls,Fi):re(g[et],Fi,k)))continue e}ci&&ci.push(Fi),Wt.push(vi)}}return Wt}function va(g,S,k,re){return Rn(g,function(Ce,qe,et){S(re,k(Ce),qe,et)}),re}function js(g,S,k){S=Mo(S,g),g=wc(g,S);var re=g==null?g:g[Qr(Tr(S))];return re==null?t:an(re,g,k)}function jr(g){return Zs(g)&&zs(g)==yi}function fs(g){return Zs(g)&&zs(g)==f}function oi(g){return Zs(g)&&zs(g)==qi}function Yn(g,S,k,re,Ce){return g===S?!0:g==null||S==null||!Zs(g)&&!Zs(S)?g!==g&&S!==S:_d(g,S,k,re,Yn,Ce)}function _d(g,S,k,re,Ce,qe){var et=ji(g),pt=ji(S),vt=et?ti:Pn(g),Wt=pt?ti:Pn(S);vt=vt==yi?q:vt,Wt=Wt==yi?q:Wt;var Ut=vt==q,Qt=Wt==q,ci=vt==Wt;if(ci&&Ro(g)){if(!Ro(S))return!1;et=!0,Ut=!1}if(ci&&!Ut)return qe||(qe=new ge),et||Xa(g)?mc(g,S,k,re,Ce,qe):Kd(g,S,vt,k,re,Ce,qe);if(!(k&D)){var vi=Ut&&Ms.call(g,"__wrapped__"),Fi=Qt&&Ms.call(S,"__wrapped__");if(vi||Fi){var ls=vi?g.value():g,Ui=Fi?S.value():S;return qe||(qe=new ge),Ce(ls,Ui,k,re,qe)}}return ci?(qe||(qe=new ge),Xd(g,S,k,re,Ce,qe)):!1}function vd(g){return Zs(g)&&Pn(g)==is}function Yh(g,S,k,re){var Ce=k.length,qe=Ce,et=!re;if(g==null)return!qe;for(g=cs(g);Ce--;){var pt=k[Ce];if(et&&pt[2]?pt[1]!==g[pt[0]]:!(pt[0]in g))return!1}for(;++Ce<qe;){pt=k[Ce];var vt=pt[0],Wt=g[vt],Ut=pt[1];if(et&&pt[2]){if(Wt===t&&!(vt in g))return!1}else{var Qt=new ge;if(re)var ci=re(Wt,Ut,vt,g,S,Qt);if(!(ci===t?Yn(Ut,Wt,D|z,re,Qt):ci))return!1}}return!0}function qu(g){if(!Ws(g)||np(g))return!1;var S=mo(g)?qh:mi;return S.test(Sa(g))}function bd(g){return Zs(g)&&zs(g)==Ze}function Sd(g){return Zs(g)&&Pn(g)==Xe}function Ad(g){return Zs(g)&&wh(g.length)&&!!wt[zs(g)]}function Hu(g){return typeof g=="function"?g:g==null?Zn:typeof g=="object"?ji(g)?Uu(g[0],g[1]):$u(g):rd(g)}function Kh(g){if(!yl(g))return Do(g);var S=[];for(var k in cs(g))Ms.call(g,k)&&k!="constructor"&&S.push(k);return S}function wd(g){if(!Ws(g))return lp(g);var S=yl(g),k=[];for(var re in g)re=="constructor"&&(S||!Ms.call(g,re))||k.push(re);return k}function Xh(g,S){return g<S}function zu(g,S){var k=-1,re=jn(g)?Lt(g.length):[];return Bs(g,function(Ce,qe,et){re[++k]=S(Ce,qe,et)}),re}function $u(g){var S=cu(g);return S.length==1&&S[0][2]?Sc(S[0][0],S[0][1]):function(k){return k===g||Yh(k,g,S)}}function Uu(g,S){return pu(g)&&bc(S)?Sc(Qr(g),S):function(k){var re=Au(k,g);return re===t&&re===S?wu(k,g):Yn(S,re,D|z)}}function ah(g,S,k,re,Ce){g!==S&&Xs(S,function(qe,et){if(Ws(qe))Ce||(Ce=new ge),Ed(g,S,et,k,ah,re,Ce);else{var pt=re?re(g[et],qe,et+"",g,S,Ce):t;pt===t&&(pt=qe),Zt(g,et,pt)}},dr)}function Ed(g,S,k,re,Ce,qe,et){var pt=g[k],vt=S[k],Wt=et.get(vt);if(Wt){Zt(g,k,Wt);return}var Ut=qe?qe(pt,vt,k+"",g,S,et):t,Qt=Ut===t;if(Qt){var ci=ji(vt),vi=!ci&&Ro(vt),Fi=!ci&&!vi&&Xa(vt);Ut=vt,ci||vi||Fi?ji(pt)?Ut=pt:en(pt)?Ut=Kn(pt):vi?(Qt=!1,Ut=tc(vt,!0)):Fi?(Qt=!1,Ut=ic(vt,!0)):Ut=[]:vl(vt)||Aa(vt)?(Ut=pt,Aa(pt)?Ut=Xc(pt):(!Ws(pt)||re&&mo(pt))&&(Ut=vc(vt))):Qt=!1}Qt&&(et.set(vt,Ut),Ce(Ut,vt,re,qe,et),et.delete(vt)),Zt(g,k,Ut)}function Gu(g,S){var k=g.length;if(k)return S+=S<0?k:0,go(S,k)?g[S]:t}function Wu(g,S,k){var re=-1;S=Ss(S.length?S:[Zn],_n(ki()));var Ce=zu(g,function(qe,et,pt){var vt=Ss(S,function(Wt){return Wt(qe)});return{criteria:vt,index:++re,value:qe}});return Vn(Ce,function(qe,et){return qd(qe,et,k)})}function Pd(g,S){return Yu(g,S,function(k,re){return wu(g,re)})}function Yu(g,S,k){for(var re=-1,Ce=S.length,qe={};++re<Ce;){var et=S[re],pt=Ci(g,et);k(pt,et)&&gl(qe,Mo(et,g),pt)}return qe}function Ld(g){return function(S){return Ci(S,g)}}function jh(g,S,k,re){var Ce=re?Qo:qr,qe=-1,et=S.length,pt=g;for(g===S&&(S=Kn(S)),k&&(pt=Ss(g,_n(k)));++qe<et;)for(var vt=0,Wt=S[qe],Ut=k?k(Wt):Wt;(vt=Ce(pt,Ut,vt,re))>-1;)pt!==g&&qa.call(pt,vt,1),qa.call(g,vt,1);return g}function Ku(g,S){for(var k=g?S.length:0,re=k-1;k--;){var Ce=S[k];if(k==re||Ce!==qe){var qe=Ce;go(Ce)?qa.call(g,Ce,1):eu(g,Ce)}}return g}function Zh(g,S){return g+ca(Gn()*(S-g+1))}function Td(g,S,k,re){for(var Ce=-1,qe=Ys(Hr((S-g)/(k||1)),0),et=Lt(qe);qe--;)et[re?qe:++Ce]=g,g+=k;return et}function Qh(g,S){var k="";if(!g||S<1||S>At)return k;do S%2&&(k+=g),S=ca(S/2),S&&(g+=g);while(S);return k}function rs(g,S){return gu(Ac(g,S,Zn),g+"")}function Cd(g){return ei(ja(g))}function Dd(g,S){var k=ja(g);return yh(k,fi(S,0,k.length))}function gl(g,S,k,re){if(!Ws(g))return g;S=Mo(S,g);for(var Ce=-1,qe=S.length,et=qe-1,pt=g;pt!=null&&++Ce<qe;){var vt=Qr(S[Ce]),Wt=k;if(Ce!=et){var Ut=pt[vt];Wt=re?re(Ut,vt,pt):t,Wt===t&&(Wt=Ws(Ut)?Ut:go(S[Ce+1])?[]:{})}kt(pt,vt,Wt),pt=pt[vt]}return g}var Xu=$a?function(g,S){return $a.set(g,S),g}:Zn,xd=ha?function(g,S){return ha(g,"toString",{configurable:!0,enumerable:!1,value:Pu(S),writable:!0})}:Zn;function Id(g){return yh(ja(g))}function Lr(g,S,k){var re=-1,Ce=g.length;S<0&&(S=-S>Ce?0:Ce+S),k=k>Ce?Ce:k,k<0&&(k+=Ce),Ce=S>k?0:k-S>>>0,S>>>=0;for(var qe=Lt(Ce);++re<Ce;)qe[re]=g[re+S];return qe}function Vd(g,S){var k;return Bs(g,function(re,Ce,qe){return k=S(re,Ce,qe),!k}),!!k}function lh(g,S,k){var re=0,Ce=g==null?re:g.length;if(typeof S=="number"&&S===S&&Ce<=xt){for(;re<Ce;){var qe=re+Ce>>>1,et=g[qe];et!==null&&!cr(et)&&(k?et<=S:et<S)?re=qe+1:Ce=qe}return Ce}return Jh(g,S,Zn,k)}function Jh(g,S,k,re){S=k(S);for(var Ce=0,qe=g==null?0:g.length,et=S!==S,pt=S===null,vt=cr(S),Wt=S===t;Ce<qe;){var Ut=ca((Ce+qe)/2),Qt=k(g[Ut]),ci=Qt!==t,vi=Qt===null,Fi=Qt===Qt,ls=cr(Qt);if(et)var Ui=re||Fi;else Wt?Ui=Fi&&(re||ci):pt?Ui=Fi&&ci&&(re||!vi):vt?Ui=Fi&&ci&&!vi&&(re||!ls):vi||ls?Ui=!1:Ui=re?Qt<=S:Qt<S;Ui?Ce=Ut+1:qe=Ut}return cn(qe,zt)}function ju(g,S){for(var k=-1,re=g.length,Ce=0,qe=[];++k<re;){var et=g[k],pt=S?S(et):et;if(!k||!Jr(pt,vt)){var vt=pt;qe[Ce++]=et===0?0:et}}return qe}function Zu(g){return typeof g=="number"?g:cr(g)?dt:+g}function ur(g){if(typeof g=="string")return g;if(ji(g))return Ss(g,ur)+"";if(cr(g))return nh?nh.call(g):"";var S=g+"";return S=="0"&&1/g==-Ke?"-0":S}function Oo(g,S,k){var re=-1,Ce=oo,qe=g.length,et=!0,pt=[],vt=pt;if(k)et=!1,Ce=Fr;else if(qe>=r){var Wt=S?null:Wd(g);if(Wt)return tt(Wt);et=!1,Ce=Mn,vt=new ne}else vt=S?[]:pt;e:for(;++re<qe;){var Ut=g[re],Qt=S?S(Ut):Ut;if(Ut=k||Ut!==0?Ut:0,et&&Qt===Qt){for(var ci=vt.length;ci--;)if(vt[ci]===Qt)continue e;S&&vt.push(Qt),pt.push(Ut)}else Ce(vt,Qt,k)||(vt!==pt&&vt.push(Qt),pt.push(Ut))}return pt}function eu(g,S){return S=Mo(S,g),g=wc(g,S),g==null||delete g[Qr(Tr(S))]}function Qu(g,S,k,re){return gl(g,S,k(Ci(g,S)),re)}function hh(g,S,k,re){for(var Ce=g.length,qe=re?Ce:-1;(re?qe--:++qe<Ce)&&S(g[qe],qe,g););return k?Lr(g,re?0:qe,re?qe+1:Ce):Lr(g,re?qe+1:0,re?Ce:qe)}function Ju(g,S){var k=g;return k instanceof ns&&(k=k.value()),ao(S,function(re,Ce){return Ce.func.apply(Ce.thisArg,wr([re],Ce.args))},k)}function tu(g,S,k){var re=g.length;if(re<2)return re?Oo(g[0]):[];for(var Ce=-1,qe=Lt(re);++Ce<re;)for(var et=g[Ce],pt=-1;++pt<re;)pt!=Ce&&(qe[Ce]=li(qe[Ce]||et,g[pt],S,k));return Oo(ys(qe,1),S,k)}function ec(g,S,k){for(var re=-1,Ce=g.length,qe=S.length,et={};++re<Ce;){var pt=re<qe?S[re]:t;k(et,g[re],pt)}return et}function iu(g){return en(g)?g:[]}function su(g){return typeof g=="function"?g:Zn}function Mo(g,S){return ji(g)?g:pu(g,S)?[g]:Tc(Ls(g))}var Od=rs;function ko(g,S,k){var re=g.length;return k=k===t?re:k,!S&&k>=re?g:Lr(g,S,k)}var Md=Hh||function(g){return ss.clearTimeout(g)};function tc(g,S){if(S)return g.slice();var k=g.length,re=ll?ll(k):new g.constructor(k);return g.copy(re),re}function nu(g){var S=new g.constructor(g.byteLength);return new lo(S).set(new lo(g)),S}function kd(g,S){var k=S?nu(g.buffer):g.buffer;return new g.constructor(k,g.byteOffset,g.byteLength)}function Rd(g,S,k){var re=S?k(vn(g),y):vn(g);return ao(re,Gs,new g.constructor)}function Nd(g){var S=new g.constructor(g.source,Si.exec(g));return S.lastIndex=g.lastIndex,S}function Bd(g,S,k){var re=S?k(tt(g),y):tt(g);return ao(re,or,new g.constructor)}function Fd(g){return ga?cs(ga.call(g)):{}}function ic(g,S){var k=S?nu(g.buffer):g.buffer;return new g.constructor(k,g.byteOffset,g.length)}function sc(g,S){if(g!==S){var k=g!==t,re=g===null,Ce=g===g,qe=cr(g),et=S!==t,pt=S===null,vt=S===S,Wt=cr(S);if(!pt&&!Wt&&!qe&&g>S||qe&&et&&vt&&!pt&&!Wt||re&&et&&vt||!k&&vt||!Ce)return 1;if(!re&&!qe&&!Wt&&g<S||Wt&&k&&Ce&&!re&&!qe||pt&&k&&Ce||!et&&Ce||!vt)return-1}return 0}function qd(g,S,k){for(var re=-1,Ce=g.criteria,qe=S.criteria,et=Ce.length,pt=k.length;++re<et;){var vt=sc(Ce[re],qe[re]);if(vt){if(re>=pt)return vt;var Wt=k[re];return vt*(Wt=="desc"?-1:1)}}return g.index-S.index}function nc(g,S,k,re){for(var Ce=-1,qe=g.length,et=k.length,pt=-1,vt=S.length,Wt=Ys(qe-et,0),Ut=Lt(vt+Wt),Qt=!re;++pt<vt;)Ut[pt]=S[pt];for(;++Ce<et;)(Qt||Ce<qe)&&(Ut[k[Ce]]=g[Ce]);for(;Wt--;)Ut[pt++]=g[Ce++];return Ut}function rc(g,S,k,re){for(var Ce=-1,qe=g.length,et=-1,pt=k.length,vt=-1,Wt=S.length,Ut=Ys(qe-pt,0),Qt=Lt(Ut+Wt),ci=!re;++Ce<Ut;)Qt[Ce]=g[Ce];for(var vi=Ce;++vt<Wt;)Qt[vi+vt]=S[vt];for(;++et<pt;)(ci||Ce<qe)&&(Qt[vi+k[et]]=g[Ce++]);return Qt}function Kn(g,S){var k=-1,re=g.length;for(S||(S=Lt(re));++k<re;)S[k]=g[k];return S}function Zr(g,S,k,re){var Ce=!k;k||(k={});for(var qe=-1,et=S.length;++qe<et;){var pt=S[qe],vt=re?re(k[pt],g[pt],pt,k,g):t;vt===t&&(vt=g[pt]),Ce?st(k,pt,vt):kt(k,pt,vt)}return k}function Hd(g,S){return Zr(g,du(g),S)}function zd(g,S){return Zr(g,yc(g),S)}function uh(g,S){return function(k,re){var Ce=ji(k)?Sr:It,qe=S?S():{};return Ce(k,g,ki(re,2),qe)}}function Wa(g){return rs(function(S,k){var re=-1,Ce=k.length,qe=Ce>1?k[Ce-1]:t,et=Ce>2?k[2]:t;for(qe=g.length>3&&typeof qe=="function"?(Ce--,qe):t,et&&Xn(k[0],k[1],et)&&(qe=Ce<3?t:qe,Ce=1),S=cs(S);++re<Ce;){var pt=k[re];pt&&g(S,pt,re,qe)}return S})}function oc(g,S){return function(k,re){if(k==null)return k;if(!jn(k))return g(k,re);for(var Ce=k.length,qe=S?Ce:-1,et=cs(k);(S?qe--:++qe<Ce)&&re(et[qe],qe,et)!==!1;);return k}}function ac(g){return function(S,k,re){for(var Ce=-1,qe=cs(S),et=re(S),pt=et.length;pt--;){var vt=et[g?pt:++Ce];if(k(qe[vt],vt,qe)===!1)break}return S}}function $d(g,S,k){var re=S&w,Ce=ml(g);function qe(){var et=this&&this!==ss&&this instanceof qe?Ce:g;return et.apply(re?k:this,arguments)}return qe}function lc(g){return function(S){S=Ls(S);var k=Pr(S)?Ft(S):t,re=k?k[0]:S.charAt(0),Ce=k?ko(k,1).join(""):S.slice(1);return re[g]()+Ce}}function Ya(g){return function(S){return ao(sd(id(S).replace(G,"")),g,"")}}function ml(g){return function(){var S=arguments;switch(S.length){case 0:return new g;case 1:return new g(S[0]);case 2:return new g(S[0],S[1]);case 3:return new g(S[0],S[1],S[2]);case 4:return new g(S[0],S[1],S[2],S[3]);case 5:return new g(S[0],S[1],S[2],S[3],S[4]);case 6:return new g(S[0],S[1],S[2],S[3],S[4],S[5]);case 7:return new g(S[0],S[1],S[2],S[3],S[4],S[5],S[6])}var k=Io(g.prototype),re=g.apply(k,S);return Ws(re)?re:k}}function Ud(g,S,k){var re=ml(g);function Ce(){for(var qe=arguments.length,et=Lt(qe),pt=qe,vt=Ka(Ce);pt--;)et[pt]=arguments[pt];var Wt=qe<3&&et[0]!==vt&&et[qe-1]!==vt?[]:Fe(et,vt);if(qe-=Wt.length,qe<k)return pc(g,S,ch,Ce.placeholder,t,et,Wt,t,t,k-qe);var Ut=this&&this!==ss&&this instanceof Ce?re:g;return an(Ut,this,et)}return Ce}function hc(g){return function(S,k,re){var Ce=cs(S);if(!jn(S)){var qe=ki(k,3);S=dn(S),k=function(pt){return qe(Ce[pt],pt,Ce)}}var et=g(S,k,re);return et>-1?Ce[qe?S[et]:et]:t}}function uc(g){return fo(function(S){var k=S.length,re=k,Ce=Wn.prototype.thru;for(g&&S.reverse();re--;){var qe=S[re];if(typeof qe!="function")throw new Un(a);if(Ce&&!et&&gh(qe)=="wrapper")var et=new Wn([],!0)}for(re=et?re:k;++re<k;){qe=S[re];var pt=gh(qe),vt=pt=="wrapper"?uu(qe):t;vt&&fu(vt[0])&&vt[1]==(fe|X|oe|be)&&!vt[4].length&&vt[9]==1?et=et[gh(vt[0])].apply(et,vt[3]):et=qe.length==1&&fu(qe)?et[pt]():et.thru(qe)}return function(){var Wt=arguments,Ut=Wt[0];if(et&&Wt.length==1&&ji(Ut))return et.plant(Ut).value();for(var Qt=0,ci=k?S[Qt].apply(this,Wt):Ut;++Qt<k;)ci=S[Qt].call(this,ci);return ci}})}function ch(g,S,k,re,Ce,qe,et,pt,vt,Wt){var Ut=S&fe,Qt=S&w,ci=S&N,vi=S&(X|ae),Fi=S&Ae,ls=ci?t:ml(g);function Ui(){for(var gs=arguments.length,Ts=Lt(gs),Nn=gs;Nn--;)Ts[Nn]=arguments[Nn];if(vi)var Bn=Ka(Ui),No=Lo(Ts,Bn);if(re&&(Ts=nc(Ts,re,Ce,vi)),qe&&(Ts=rc(Ts,qe,et,vi)),gs-=No,vi&&gs<Wt){var tn=Fe(Ts,Bn);return pc(g,S,ch,Ui.placeholder,k,Ts,tn,pt,vt,Wt-gs)}var $r=Qt?k:this,_o=ci?$r[g]:g;return gs=Ts.length,pt?Ts=up(Ts,pt):Fi&&gs>1&&Ts.reverse(),Ut&&vt<gs&&(Ts.length=vt),this&&this!==ss&&this instanceof Ui&&(_o=ls||ml(_o)),_o.apply($r,Ts)}return Ui}function cc(g,S){return function(k,re){return va(k,g,S(re),{})}}function dh(g,S){return function(k,re){var Ce;if(k===t&&re===t)return S;if(k!==t&&(Ce=k),re!==t){if(Ce===t)return re;typeof k=="string"||typeof re=="string"?(k=ur(k),re=ur(re)):(k=Zu(k),re=Zu(re)),Ce=g(k,re)}return Ce}}function ru(g){return fo(function(S){return S=Ss(S,_n(ki())),rs(function(k){var re=this;return g(S,function(Ce){return an(Ce,re,k)})})})}function ph(g,S){S=S===t?" ":ur(S);var k=S.length;if(k<2)return k?Qh(S,g):S;var re=Qh(S,Hr(g/qt(S)));return Pr(S)?ko(Ft(re),0,g).join(""):re.slice(0,g)}function Gd(g,S,k,re){var Ce=S&w,qe=ml(g);function et(){for(var pt=-1,vt=arguments.length,Wt=-1,Ut=re.length,Qt=Lt(Ut+vt),ci=this&&this!==ss&&this instanceof et?qe:g;++Wt<Ut;)Qt[Wt]=re[Wt];for(;vt--;)Qt[Wt++]=arguments[++pt];return an(ci,Ce?k:this,Qt)}return et}function dc(g){return function(S,k,re){return re&&typeof re!="number"&&Xn(S,k,re)&&(k=re=t),S=yo(S),k===t?(k=S,S=0):k=yo(k),re=re===t?S<k?1:-1:yo(re),Td(S,k,re,g)}}function fh(g){return function(S,k){return typeof S=="string"&&typeof k=="string"||(S=Cr(S),k=Cr(k)),g(S,k)}}function pc(g,S,k,re,Ce,qe,et,pt,vt,Wt){var Ut=S&X,Qt=Ut?et:t,ci=Ut?t:et,vi=Ut?qe:t,Fi=Ut?t:qe;S|=Ut?oe:ue,S&=~(Ut?ue:oe),S&H||(S&=~(w|N));var ls=[g,S,Ce,vi,Qt,Fi,ci,pt,vt,Wt],Ui=k.apply(t,ls);return fu(g)&&Ec(Ui,ls),Ui.placeholder=re,Pc(Ui,g,S)}function ou(g){var S=xs[g];return function(k,re){if(k=Cr(k),re=re==null?0:cn(Qi(re),292),re){var Ce=(Ls(k)+"e").split("e"),qe=S(Ce[0]+"e"+(+Ce[1]+re));return Ce=(Ls(qe)+"e").split("e"),+(Ce[0]+"e"+(+Ce[1]-re))}return S(k)}}var Wd=xo&&1/tt(new xo([,-0]))[1]==Ke?function(g){return new xo(g)}:Cu;function fc(g){return function(S){var k=Pn(S);return k==is?vn(S):k==Xe?ft(S):On(S,g(S))}}function po(g,S,k,re,Ce,qe,et,pt){var vt=S&N;if(!vt&&typeof g!="function")throw new Un(a);var Wt=re?re.length:0;if(Wt||(S&=~(oe|ue),re=Ce=t),et=et===t?et:Ys(Qi(et),0),pt=pt===t?pt:Qi(pt),Wt-=Ce?Ce.length:0,S&ue){var Ut=re,Qt=Ce;re=Ce=t}var ci=vt?t:uu(g),vi=[g,S,k,re,Ce,Ut,Qt,qe,et,pt];if(ci&&ap(vi,ci),g=vi[0],S=vi[1],k=vi[2],re=vi[3],Ce=vi[4],pt=vi[9]=vi[9]===t?vt?0:g.length:Ys(vi[9]-Wt,0),!pt&&S&(X|ae)&&(S&=~(X|ae)),!S||S==w)var Fi=$d(g,S,k);else S==X||S==ae?Fi=Ud(g,S,pt):(S==oe||S==(w|oe))&&!Ce.length?Fi=Gd(g,S,k,re):Fi=ch.apply(t,vi);var ls=ci?Xu:Ec;return Pc(ls(Fi,vi),g,S)}function au(g,S,k,re){return g===t||Jr(g,oa[k])&&!Ms.call(re,k)?S:g}function gc(g,S,k,re,Ce,qe){return Ws(g)&&Ws(S)&&(qe.set(S,g),ah(g,S,t,gc,qe),qe.delete(S)),g}function Yd(g){return vl(g)?t:g}function mc(g,S,k,re,Ce,qe){var et=k&D,pt=g.length,vt=S.length;if(pt!=vt&&!(et&&vt>pt))return!1;var Wt=qe.get(g);if(Wt&&qe.get(S))return Wt==S;var Ut=-1,Qt=!0,ci=k&z?new ne:t;for(qe.set(g,S),qe.set(S,g);++Ut<pt;){var vi=g[Ut],Fi=S[Ut];if(re)var ls=et?re(Fi,vi,Ut,S,g,qe):re(vi,Fi,Ut,g,S,qe);if(ls!==t){if(ls)continue;Qt=!1;break}if(ci){if(!Zo(S,function(Ui,gs){if(!Mn(ci,gs)&&(vi===Ui||Ce(vi,Ui,k,re,qe)))return ci.push(gs)})){Qt=!1;break}}else if(!(vi===Fi||Ce(vi,Fi,k,re,qe))){Qt=!1;break}}return qe.delete(g),qe.delete(S),Qt}function Kd(g,S,k,re,Ce,qe,et){switch(k){case b:if(g.byteLength!=S.byteLength||g.byteOffset!=S.byteOffset)return!1;g=g.buffer,S=S.buffer;case f:return!(g.byteLength!=S.byteLength||!qe(new lo(g),new lo(S)));case Li:case qi:case hs:return Jr(+g,+S);case Oi:return g.name==S.name&&g.message==S.message;case Ze:case Pe:return g==S+"";case is:var pt=vn;case Xe:var vt=re&D;if(pt||(pt=tt),g.size!=S.size&&!vt)return!1;var Wt=et.get(g);if(Wt)return Wt==S;re|=z,et.set(g,S);var Ut=mc(pt(g),pt(S),re,Ce,qe,et);return et.delete(g),Ut;case Le:if(ga)return ga.call(g)==ga.call(S)}return!1}function Xd(g,S,k,re,Ce,qe){var et=k&D,pt=lu(g),vt=pt.length,Wt=lu(S),Ut=Wt.length;if(vt!=Ut&&!et)return!1;for(var Qt=vt;Qt--;){var ci=pt[Qt];if(!(et?ci in S:Ms.call(S,ci)))return!1}var vi=qe.get(g);if(vi&&qe.get(S))return vi==S;var Fi=!0;qe.set(g,S),qe.set(S,g);for(var ls=et;++Qt<vt;){ci=pt[Qt];var Ui=g[ci],gs=S[ci];if(re)var Ts=et?re(gs,Ui,ci,S,g,qe):re(Ui,gs,ci,g,S,qe);if(!(Ts===t?Ui===gs||Ce(Ui,gs,k,re,qe):Ts)){Fi=!1;break}ls||(ls=ci=="constructor")}if(Fi&&!ls){var Nn=g.constructor,Bn=S.constructor;Nn!=Bn&&"constructor"in g&&"constructor"in S&&!(typeof Nn=="function"&&Nn instanceof Nn&&typeof Bn=="function"&&Bn instanceof Bn)&&(Fi=!1)}return qe.delete(g),qe.delete(S),Fi}function fo(g){return gu(Ac(g,t,Ic),g+"")}function lu(g){return Is(g,dn,du)}function hu(g){return Is(g,dr,yc)}var uu=$a?function(g){return $a.get(g)}:Cu;function gh(g){for(var S=g.name+"",k=fa[S],re=Ms.call(fa,S)?k.length:0;re--;){var Ce=k[re],qe=Ce.func;if(qe==null||qe==g)return Ce.name}return S}function Ka(g){var S=Ms.call(Ne,"placeholder")?Ne:g;return S.placeholder}function ki(){var g=Ne.iteratee||Lu;return g=g===Lu?Hu:g,arguments.length?g(arguments[0],arguments[1]):g}function mh(g,S){var k=g.__data__;return sp(S)?k[typeof S=="string"?"string":"hash"]:k.map}function cu(g){for(var S=dn(g),k=S.length;k--;){var re=S[k],Ce=g[re];S[k]=[re,Ce,bc(Ce)]}return S}function ba(g,S){var k=Co(g,S);return qu(k)?k:t}function jd(g){var S=Ms.call(g,Kr),k=g[Kr];try{g[Kr]=t;var re=!0}catch{}var Ce=ps.call(g);return re&&(S?g[Kr]=k:delete g[Kr]),Ce}var du=Xi?function(g){return g==null?[]:(g=cs(g),xn(Xi(g),function(S){return Jl.call(g,S)}))}:Du,yc=Xi?function(g){for(var S=[];g;)wr(S,du(g)),g=Fa(g);return S}:Du,Pn=zs;(za&&Pn(new za(new ArrayBuffer(1)))!=b||Xr&&Pn(new Xr)!=is||ul&&Pn(ul.resolve())!=Re||xo&&Pn(new xo)!=Xe||da&&Pn(new da)!=ct)&&(Pn=function(g){var S=zs(g),k=S==q?g.constructor:t,re=k?Sa(k):"";if(re)switch(re){case zh:return b;case $h:return is;case Uh:return Re;case Gh:return Xe;case sh:return ct}return S});function Zd(g,S,k){for(var re=-1,Ce=k.length;++re<Ce;){var qe=k[re],et=qe.size;switch(qe.type){case"drop":g+=et;break;case"dropRight":S-=et;break;case"take":S=cn(S,g+et);break;case"takeRight":g=Ys(g,S-et);break}}return{start:g,end:S}}function Qd(g){var S=g.match(bt);return S?S[1].split(Tt):[]}function _c(g,S,k){S=Mo(S,g);for(var re=-1,Ce=S.length,qe=!1;++re<Ce;){var et=Qr(S[re]);if(!(qe=g!=null&&k(g,et)))break;g=g[et]}return qe||++re!=Ce?qe:(Ce=g==null?0:g.length,!!Ce&&wh(Ce)&&go(et,Ce)&&(ji(g)||Aa(g)))}function Jd(g){var S=g.length,k=g.constructor(S);return S&&typeof g[0]=="string"&&Ms.call(g,"index")&&(k.index=g.index,k.input=g.input),k}function vc(g){return typeof g.constructor=="function"&&!yl(g)?Io(Fa(g)):{}}function ep(g,S,k,re){var Ce=g.constructor;switch(S){case f:return nu(g);case Li:case qi:return new Ce(+g);case b:return kd(g,re);case L:case I:case B:case j:case Y:case Z:case ie:case pe:case me:return ic(g,re);case is:return Rd(g,re,k);case hs:case Pe:return new Ce(g);case Ze:return Nd(g);case Xe:return Bd(g,re,k);case Le:return Fd(g)}}function tp(g,S){var k=S.length;if(!k)return g;var re=k-1;return S[re]=(k>1?"& ":"")+S[re],S=S.join(k>2?", ":" "),g.replace(_t,`{
/* [wrapped with `+S+`] */
`)}function ip(g){return ji(g)||Aa(g)||!!(eh&&g&&g[eh])}function go(g,S){return S=S??At,!!S&&(typeof g=="number"||Ti.test(g))&&g>-1&&g%1==0&&g<S}function Xn(g,S,k){if(!Ws(k))return!1;var re=typeof S;return(re=="number"?jn(k)&&go(S,k.length):re=="string"&&S in k)?Jr(k[S],g):!1}function pu(g,S){if(ji(g))return!1;var k=typeof g;return k=="number"||k=="symbol"||k=="boolean"||g==null||cr(g)?!0:ze.test(g)||!Me.test(g)||S!=null&&g in cs(S)}function sp(g){var S=typeof g;return S=="string"||S=="number"||S=="symbol"||S=="boolean"?g!=="__proto__":g===null}function fu(g){var S=gh(g),k=Ne[S];if(typeof k!="function"||!(S in ns.prototype))return!1;if(g===k)return!0;var re=uu(k);return!!re&&g===re[0]}function np(g){return!!di&&di in g}var rp=Na?mo:xu;function yl(g){var S=g&&g.constructor,k=typeof S=="function"&&S.prototype||oa;return g===k}function bc(g){return g===g&&!Ws(g)}function Sc(g,S){return function(k){return k==null?!1:k[g]===S&&(S!==t||g in cs(k))}}function op(g){var S=Sh(g,function(re){return k.size===d&&k.clear(),re}),k=S.cache;return S}function ap(g,S){var k=g[1],re=S[1],Ce=k|re,qe=Ce<(w|N|fe),et=re==fe&&k==X||re==fe&&k==be&&g[7].length<=S[8]||re==(fe|be)&&S[7].length<=S[8]&&k==X;if(!(qe||et))return g;re&w&&(g[2]=S[2],Ce|=k&w?0:H);var pt=S[3];if(pt){var vt=g[3];g[3]=vt?nc(vt,pt,S[4]):pt,g[4]=vt?Fe(g[3],c):S[4]}return pt=S[5],pt&&(vt=g[5],g[5]=vt?rc(vt,pt,S[6]):pt,g[6]=vt?Fe(g[5],c):S[6]),pt=S[7],pt&&(g[7]=pt),re&fe&&(g[8]=g[8]==null?S[8]:cn(g[8],S[8])),g[9]==null&&(g[9]=S[9]),g[0]=S[0],g[1]=Ce,g}function lp(g){var S=[];if(g!=null)for(var k in cs(g))S.push(k);return S}function hp(g){return ps.call(g)}function Ac(g,S,k){return S=Ys(S===t?g.length-1:S,0),function(){for(var re=arguments,Ce=-1,qe=Ys(re.length-S,0),et=Lt(qe);++Ce<qe;)et[Ce]=re[S+Ce];Ce=-1;for(var pt=Lt(S+1);++Ce<S;)pt[Ce]=re[Ce];return pt[S]=k(et),an(g,this,pt)}}function wc(g,S){return S.length<2?g:Ci(g,Lr(S,0,-1))}function up(g,S){for(var k=g.length,re=cn(S.length,k),Ce=Kn(g);re--;){var qe=S[re];g[re]=go(qe,k)?Ce[qe]:t}return g}var Ec=Lc(Xu),_l=Ha||function(g,S){return ss.setTimeout(g,S)},gu=Lc(xd);function Pc(g,S,k){var re=S+"";return gu(g,tp(re,cp(Qd(re),k)))}function Lc(g){var S=0,k=0;return function(){var re=Bu(),Ce=gt-(re-k);if(k=re,Ce>0){if(++S>=Ue)return arguments[0]}else S=0;return g.apply(t,arguments)}}function yh(g,S){var k=-1,re=g.length,Ce=re-1;for(S=S===t?re:S;++k<S;){var qe=Zh(k,Ce),et=g[qe];g[qe]=g[k],g[k]=et}return g.length=S,g}var Tc=op(function(g){var S=[];return Ge.test(g)&&S.push(""),g.replace(We,function(k,re,Ce,qe){S.push(Ce?qe.replace(ii,"$1"):re||k)}),S});function Qr(g){if(typeof g=="string"||cr(g))return g;var S=g+"";return S=="0"&&1/g==-Ke?"-0":S}function Sa(g){if(g!=null){try{return Ba.call(g)}catch{}try{return g+""}catch{}}return""}function cp(g,S){return rn(Gt,function(k){var re="_."+k[0];S&k[1]&&!oo(g,re)&&g.push(re)}),g.sort()}function Cc(g){if(g instanceof ns)return g.clone();var S=new Wn(g.__wrapped__,g.__chain__);return S.__actions__=Kn(g.__actions__),S.__index__=g.__index__,S.__values__=g.__values__,S}function dp(g,S,k){(k?Xn(g,S,k):S===t)?S=1:S=Ys(Qi(S),0);var re=g==null?0:g.length;if(!re||S<1)return[];for(var Ce=0,qe=0,et=Lt(Hr(re/S));Ce<re;)et[qe++]=Lr(g,Ce,Ce+=S);return et}function pp(g){for(var S=-1,k=g==null?0:g.length,re=0,Ce=[];++S<k;){var qe=g[S];qe&&(Ce[re++]=qe)}return Ce}function fp(){var g=arguments.length;if(!g)return[];for(var S=Lt(g-1),k=arguments[0],re=g;re--;)S[re-1]=arguments[re];return wr(ji(k)?Kn(k):[k],ys(S,1))}var gp=rs(function(g,S){return en(g)?li(g,ys(S,1,en,!0)):[]}),mp=rs(function(g,S){var k=Tr(S);return en(k)&&(k=t),en(g)?li(g,ys(S,1,en,!0),ki(k,2)):[]}),yp=rs(function(g,S){var k=Tr(S);return en(k)&&(k=t),en(g)?li(g,ys(S,1,en,!0),t,k):[]});function _p(g,S,k){var re=g==null?0:g.length;return re?(S=k||S===t?1:Qi(S),Lr(g,S<0?0:S,re)):[]}function vp(g,S,k){var re=g==null?0:g.length;return re?(S=k||S===t?1:Qi(S),S=re-S,Lr(g,0,S<0?0:S)):[]}function bp(g,S){return g&&g.length?hh(g,ki(S,3),!0,!0):[]}function Sp(g,S){return g&&g.length?hh(g,ki(S,3),!0):[]}function Ap(g,S,k,re){var Ce=g==null?0:g.length;return Ce?(k&&typeof k!="number"&&Xn(g,S,k)&&(k=0,re=Ce),Ks(g,S,k,re)):[]}function Dc(g,S,k){var re=g==null?0:g.length;if(!re)return-1;var Ce=k==null?0:Qi(k);return Ce<0&&(Ce=Ys(re+Ce,0)),Er(g,ki(S,3),Ce)}function xc(g,S,k){var re=g==null?0:g.length;if(!re)return-1;var Ce=re-1;return k!==t&&(Ce=Qi(k),Ce=k<0?Ys(re+Ce,0):cn(Ce,re-1)),Er(g,ki(S,3),Ce,!0)}function Ic(g){var S=g==null?0:g.length;return S?ys(g,1):[]}function wp(g){var S=g==null?0:g.length;return S?ys(g,Ke):[]}function Ep(g,S){var k=g==null?0:g.length;return k?(S=S===t?1:Qi(S),ys(g,S)):[]}function Pp(g){for(var S=-1,k=g==null?0:g.length,re={};++S<k;){var Ce=g[S];re[Ce[0]]=Ce[1]}return re}function Vc(g){return g&&g.length?g[0]:t}function Lp(g,S,k){var re=g==null?0:g.length;if(!re)return-1;var Ce=k==null?0:Qi(k);return Ce<0&&(Ce=Ys(re+Ce,0)),qr(g,S,Ce)}function Tp(g){var S=g==null?0:g.length;return S?Lr(g,0,-1):[]}var Cp=rs(function(g){var S=Ss(g,iu);return S.length&&S[0]===g[0]?Ga(S):[]}),Dp=rs(function(g){var S=Tr(g),k=Ss(g,iu);return S===Tr(k)?S=t:k.pop(),k.length&&k[0]===g[0]?Ga(k,ki(S,2)):[]}),xp=rs(function(g){var S=Tr(g),k=Ss(g,iu);return S=typeof S=="function"?S:t,S&&k.pop(),k.length&&k[0]===g[0]?Ga(k,t,S):[]});function Ip(g,S){return g==null?"":Nu.call(g,S)}function Tr(g){var S=g==null?0:g.length;return S?g[S-1]:t}function Vp(g,S,k){var re=g==null?0:g.length;if(!re)return-1;var Ce=re;return k!==t&&(Ce=Qi(k),Ce=Ce<0?Ys(re+Ce,0):cn(Ce,re-1)),S===S?Pt(g,S,Ce):Er(g,Jo,Ce,!0)}function Op(g,S){return g&&g.length?Gu(g,Qi(S)):t}var Mp=rs(Oc);function Oc(g,S){return g&&g.length&&S&&S.length?jh(g,S):g}function kp(g,S,k){return g&&g.length&&S&&S.length?jh(g,S,ki(k,2)):g}function Rp(g,S,k){return g&&g.length&&S&&S.length?jh(g,S,t,k):g}var Np=fo(function(g,S){var k=g==null?0:g.length,re=ai(g,S);return Ku(g,Ss(S,function(Ce){return go(Ce,k)?+Ce:Ce}).sort(sc)),re});function Bp(g,S){var k=[];if(!(g&&g.length))return k;var re=-1,Ce=[],qe=g.length;for(S=ki(S,3);++re<qe;){var et=g[re];S(et,re,g)&&(k.push(et),Ce.push(re))}return Ku(g,Ce),k}function mu(g){return g==null?g:hl.call(g)}function Fp(g,S,k){var re=g==null?0:g.length;return re?(k&&typeof k!="number"&&Xn(g,S,k)?(S=0,k=re):(S=S==null?0:Qi(S),k=k===t?re:Qi(k)),Lr(g,S,k)):[]}function qp(g,S){return lh(g,S)}function Hp(g,S,k){return Jh(g,S,ki(k,2))}function zp(g,S){var k=g==null?0:g.length;if(k){var re=lh(g,S);if(re<k&&Jr(g[re],S))return re}return-1}function $p(g,S){return lh(g,S,!0)}function Up(g,S,k){return Jh(g,S,ki(k,2),!0)}function Gp(g,S){var k=g==null?0:g.length;if(k){var re=lh(g,S,!0)-1;if(Jr(g[re],S))return re}return-1}function Wp(g){return g&&g.length?ju(g):[]}function Yp(g,S){return g&&g.length?ju(g,ki(S,2)):[]}function Kp(g){var S=g==null?0:g.length;return S?Lr(g,1,S):[]}function Xp(g,S,k){return g&&g.length?(S=k||S===t?1:Qi(S),Lr(g,0,S<0?0:S)):[]}function jp(g,S,k){var re=g==null?0:g.length;return re?(S=k||S===t?1:Qi(S),S=re-S,Lr(g,S<0?0:S,re)):[]}function Zp(g,S){return g&&g.length?hh(g,ki(S,3),!1,!0):[]}function Qp(g,S){return g&&g.length?hh(g,ki(S,3)):[]}var Jp=rs(function(g){return Oo(ys(g,1,en,!0))}),ef=rs(function(g){var S=Tr(g);return en(S)&&(S=t),Oo(ys(g,1,en,!0),ki(S,2))}),tf=rs(function(g){var S=Tr(g);return S=typeof S=="function"?S:t,Oo(ys(g,1,en,!0),t,S)});function sf(g){return g&&g.length?Oo(g):[]}function nf(g,S){return g&&g.length?Oo(g,ki(S,2)):[]}function rf(g,S){return S=typeof S=="function"?S:t,g&&g.length?Oo(g,t,S):[]}function yu(g){if(!(g&&g.length))return[];var S=0;return g=xn(g,function(k){if(en(k))return S=Ys(k.length,S),!0}),lr(S,function(k){return Ss(g,In(k))})}function Mc(g,S){if(!(g&&g.length))return[];var k=yu(g);return S==null?k:Ss(k,function(re){return an(S,t,re)})}var of=rs(function(g,S){return en(g)?li(g,S):[]}),af=rs(function(g){return tu(xn(g,en))}),lf=rs(function(g){var S=Tr(g);return en(S)&&(S=t),tu(xn(g,en),ki(S,2))}),hf=rs(function(g){var S=Tr(g);return S=typeof S=="function"?S:t,tu(xn(g,en),t,S)}),uf=rs(yu);function cf(g,S){return ec(g||[],S||[],kt)}function df(g,S){return ec(g||[],S||[],gl)}var pf=rs(function(g){var S=g.length,k=S>1?g[S-1]:t;return k=typeof k=="function"?(g.pop(),k):t,Mc(g,k)});function kc(g){var S=Ne(g);return S.__chain__=!0,S}function ff(g,S){return S(g),g}function _h(g,S){return S(g)}var gf=fo(function(g){var S=g.length,k=S?g[0]:0,re=this.__wrapped__,Ce=function(qe){return ai(qe,g)};return S>1||this.__actions__.length||!(re instanceof ns)||!go(k)?this.thru(Ce):(re=re.slice(k,+k+(S?1:0)),re.__actions__.push({func:_h,args:[Ce],thisArg:t}),new Wn(re,this.__chain__).thru(function(qe){return S&&!qe.length&&qe.push(t),qe}))});function mf(){return kc(this)}function yf(){return new Wn(this.value(),this.__chain__)}function _f(){this.__values__===t&&(this.__values__=Yc(this.value()));var g=this.__index__>=this.__values__.length,S=g?t:this.__values__[this.__index__++];return{done:g,value:S}}function vf(){return this}function bf(g){for(var S,k=this;k instanceof ma;){var re=Cc(k);re.__index__=0,re.__values__=t,S?Ce.__wrapped__=re:S=re;var Ce=re;k=k.__wrapped__}return Ce.__wrapped__=g,S}function Sf(){var g=this.__wrapped__;if(g instanceof ns){var S=g;return this.__actions__.length&&(S=new ns(this)),S=S.reverse(),S.__actions__.push({func:_h,args:[mu],thisArg:t}),new Wn(S,this.__chain__)}return this.thru(mu)}function Af(){return Ju(this.__wrapped__,this.__actions__)}var wf=uh(function(g,S,k){Ms.call(g,k)?++g[k]:st(g,k,1)});function Ef(g,S,k){var re=ji(g)?Ar:Vo;return k&&Xn(g,S,k)&&(S=t),re(g,ki(S,3))}function Pf(g,S){var k=ji(g)?xn:zr;return k(g,ki(S,3))}var Lf=hc(Dc),Tf=hc(xc);function Cf(g,S){return ys(vh(g,S),1)}function Df(g,S){return ys(vh(g,S),Ke)}function xf(g,S,k){return k=k===t?1:Qi(k),ys(vh(g,S),k)}function Rc(g,S){var k=ji(g)?rn:Bs;return k(g,ki(S,3))}function Nc(g,S){var k=ji(g)?_s:es;return k(g,ki(S,3))}var If=uh(function(g,S,k){Ms.call(g,k)?g[k].push(S):st(g,k,[S])});function Vf(g,S,k,re){g=jn(g)?g:ja(g),k=k&&!re?Qi(k):0;var Ce=g.length;return k<0&&(k=Ys(Ce+k,0)),Eh(g)?k<=Ce&&g.indexOf(S,k)>-1:!!Ce&&qr(g,S,k)>-1}var Of=rs(function(g,S,k){var re=-1,Ce=typeof S=="function",qe=jn(g)?Lt(g.length):[];return Bs(g,function(et){qe[++re]=Ce?an(S,et,k):js(et,S,k)}),qe}),Mf=uh(function(g,S,k){st(g,k,S)});function vh(g,S){var k=ji(g)?Ss:zu;return k(g,ki(S,3))}function kf(g,S,k,re){return g==null?[]:(ji(S)||(S=S==null?[]:[S]),k=re?t:k,ji(k)||(k=k==null?[]:[k]),Wu(g,S,k))}var Rf=uh(function(g,S,k){g[k?0:1].push(S)},function(){return[[],[]]});function Nf(g,S,k){var re=ji(g)?ao:Yr,Ce=arguments.length<3;return re(g,ki(S,4),k,Ce,Bs)}function Bf(g,S,k){var re=ji(g)?jo:Yr,Ce=arguments.length<3;return re(g,ki(S,4),k,Ce,es)}function Ff(g,S){var k=ji(g)?xn:zr;return k(g,Ah(ki(S,3)))}function qf(g){var S=ji(g)?ei:Cd;return S(g)}function Hf(g,S,k){(k?Xn(g,S,k):S===t)?S=1:S=Qi(S);var re=ji(g)?at:Dd;return re(g,S)}function zf(g){var S=ji(g)?Ht:Id;return S(g)}function $f(g){if(g==null)return 0;if(jn(g))return Eh(g)?qt(g):g.length;var S=Pn(g);return S==is||S==Xe?g.size:Kh(g).length}function Uf(g,S,k){var re=ji(g)?Zo:Vd;return k&&Xn(g,S,k)&&(S=t),re(g,ki(S,3))}var Gf=rs(function(g,S){if(g==null)return[];var k=S.length;return k>1&&Xn(g,S[0],S[1])?S=[]:k>2&&Xn(S[0],S[1],S[2])&&(S=[S[0]]),Wu(g,ys(S,1),[])}),bh=un||function(){return ss.Date.now()};function Wf(g,S){if(typeof S!="function")throw new Un(a);return g=Qi(g),function(){if(--g<1)return S.apply(this,arguments)}}function Bc(g,S,k){return S=k?t:S,S=g&&S==null?g.length:S,po(g,fe,t,t,t,t,S)}function Fc(g,S){var k;if(typeof S!="function")throw new Un(a);return g=Qi(g),function(){return--g>0&&(k=S.apply(this,arguments)),g<=1&&(S=t),k}}var _u=rs(function(g,S,k){var re=w;if(k.length){var Ce=Fe(k,Ka(_u));re|=oe}return po(g,re,S,k,Ce)}),qc=rs(function(g,S,k){var re=w|N;if(k.length){var Ce=Fe(k,Ka(qc));re|=oe}return po(S,re,g,k,Ce)});function Hc(g,S,k){S=k?t:S;var re=po(g,X,t,t,t,t,t,S);return re.placeholder=Hc.placeholder,re}function zc(g,S,k){S=k?t:S;var re=po(g,ae,t,t,t,t,t,S);return re.placeholder=zc.placeholder,re}function $c(g,S,k){var re,Ce,qe,et,pt,vt,Wt=0,Ut=!1,Qt=!1,ci=!0;if(typeof g!="function")throw new Un(a);S=Cr(S)||0,Ws(k)&&(Ut=!!k.leading,Qt="maxWait"in k,qe=Qt?Ys(Cr(k.maxWait)||0,S):qe,ci="trailing"in k?!!k.trailing:ci);function vi(tn){var $r=re,_o=Ce;return re=Ce=t,Wt=tn,et=g.apply(_o,$r),et}function Fi(tn){return Wt=tn,pt=_l(gs,S),Ut?vi(tn):et}function ls(tn){var $r=tn-vt,_o=tn-Wt,od=S-$r;return Qt?cn(od,qe-_o):od}function Ui(tn){var $r=tn-vt,_o=tn-Wt;return vt===t||$r>=S||$r<0||Qt&&_o>=qe}function gs(){var tn=bh();if(Ui(tn))return Ts(tn);pt=_l(gs,ls(tn))}function Ts(tn){return pt=t,ci&&re?vi(tn):(re=Ce=t,et)}function Nn(){pt!==t&&Md(pt),Wt=0,re=vt=Ce=pt=t}function Bn(){return pt===t?et:Ts(bh())}function No(){var tn=bh(),$r=Ui(tn);if(re=arguments,Ce=this,vt=tn,$r){if(pt===t)return Fi(vt);if(Qt)return pt=_l(gs,S),vi(vt)}return pt===t&&(pt=_l(gs,S)),et}return No.cancel=Nn,No.flush=Bn,No}var Yf=rs(function(g,S){return bs(g,1,S)}),Kf=rs(function(g,S,k){return bs(g,Cr(S)||0,k)});function Xf(g){return po(g,Ae)}function Sh(g,S){if(typeof g!="function"||S!=null&&typeof S!="function")throw new Un(a);var k=function(){var re=arguments,Ce=S?S.apply(this,re):re[0],qe=k.cache;if(qe.has(Ce))return qe.get(Ce);var et=g.apply(this,re);return k.cache=qe.set(Ce,et)||qe,et};return k.cache=new(Sh.Cache||x),k}Sh.Cache=x;function Ah(g){if(typeof g!="function")throw new Un(a);return function(){var S=arguments;switch(S.length){case 0:return!g.call(this);case 1:return!g.call(this,S[0]);case 2:return!g.call(this,S[0],S[1]);case 3:return!g.call(this,S[0],S[1],S[2])}return!g.apply(this,S)}}function jf(g){return Fc(2,g)}var Zf=Od(function(g,S){S=S.length==1&&ji(S[0])?Ss(S[0],_n(ki())):Ss(ys(S,1),_n(ki()));var k=S.length;return rs(function(re){for(var Ce=-1,qe=cn(re.length,k);++Ce<qe;)re[Ce]=S[Ce].call(this,re[Ce]);return an(g,this,re)})}),vu=rs(function(g,S){var k=Fe(S,Ka(vu));return po(g,oe,t,S,k)}),Uc=rs(function(g,S){var k=Fe(S,Ka(Uc));return po(g,ue,t,S,k)}),Qf=fo(function(g,S){return po(g,be,t,t,t,S)});function Jf(g,S){if(typeof g!="function")throw new Un(a);return S=S===t?S:Qi(S),rs(g,S)}function eg(g,S){if(typeof g!="function")throw new Un(a);return S=S==null?0:Ys(Qi(S),0),rs(function(k){var re=k[S],Ce=ko(k,0,S);return re&&wr(Ce,re),an(g,this,Ce)})}function tg(g,S,k){var re=!0,Ce=!0;if(typeof g!="function")throw new Un(a);return Ws(k)&&(re="leading"in k?!!k.leading:re,Ce="trailing"in k?!!k.trailing:Ce),$c(g,S,{leading:re,maxWait:S,trailing:Ce})}function ig(g){return Bc(g,1)}function sg(g,S){return vu(su(S),g)}function ng(){if(!arguments.length)return[];var g=arguments[0];return ji(g)?g:[g]}function rg(g){return ui(g,O)}function og(g,S){return S=typeof S=="function"?S:t,ui(g,O,S)}function ag(g){return ui(g,y|O)}function lg(g,S){return S=typeof S=="function"?S:t,ui(g,y|O,S)}function hg(g,S){return S==null||Vi(g,S,dn(S))}function Jr(g,S){return g===S||g!==g&&S!==S}var ug=fh(co),cg=fh(function(g,S){return g>=S}),Aa=jr(function(){return arguments}())?jr:function(g){return Zs(g)&&Ms.call(g,"callee")&&!Jl.call(g,"callee")},ji=Lt.isArray,dg=br?_n(br):fs;function jn(g){return g!=null&&wh(g.length)&&!mo(g)}function en(g){return Zs(g)&&jn(g)}function pg(g){return g===!0||g===!1||Zs(g)&&zs(g)==Li}var Ro=th||xu,fg=on?_n(on):oi;function gg(g){return Zs(g)&&g.nodeType===1&&!vl(g)}function mg(g){if(g==null)return!0;if(jn(g)&&(ji(g)||typeof g=="string"||typeof g.splice=="function"||Ro(g)||Xa(g)||Aa(g)))return!g.length;var S=Pn(g);if(S==is||S==Xe)return!g.size;if(yl(g))return!Kh(g).length;for(var k in g)if(Ms.call(g,k))return!1;return!0}function yg(g,S){return Yn(g,S)}function _g(g,S,k){k=typeof k=="function"?k:t;var re=k?k(g,S):t;return re===t?Yn(g,S,t,k):!!re}function bu(g){if(!Zs(g))return!1;var S=zs(g);return S==Oi||S==Pi||typeof g.message=="string"&&typeof g.name=="string"&&!vl(g)}function vg(g){return typeof g=="number"&&ih(g)}function mo(g){if(!Ws(g))return!1;var S=zs(g);return S==$t||S==Rs||S==Mi||S==He}function Gc(g){return typeof g=="number"&&g==Qi(g)}function wh(g){return typeof g=="number"&&g>-1&&g%1==0&&g<=At}function Ws(g){var S=typeof g;return g!=null&&(S=="object"||S=="function")}function Zs(g){return g!=null&&typeof g=="object"}var bg=zn?_n(zn):vd;function Sg(g,S){return g===S||Yh(g,S,cu(S))}function Ag(g,S,k){return k=typeof k=="function"?k:t,Yh(g,S,cu(S),k)}function wg(g){return Wc(g)&&g!=+g}function Eg(g){if(rp(g))throw new wi(s);return qu(g)}function Pg(g){return g===null}function Lg(g){return g==null}function Wc(g){return typeof g=="number"||Zs(g)&&zs(g)==hs}function vl(g){if(!Zs(g)||zs(g)!=q)return!1;var S=Fa(g);if(S===null)return!0;var k=Ms.call(S,"constructor")&&S.constructor;return typeof k=="function"&&k instanceof k&&Ba.call(k)==Zl}var Su=$n?_n($n):bd;function Tg(g){return Gc(g)&&g>=-At&&g<=At}var Cg=nn?_n(nn):Sd;function Eh(g){return typeof g=="string"||!ji(g)&&Zs(g)&&zs(g)==Pe}function cr(g){return typeof g=="symbol"||Zs(g)&&zs(g)==Le}var Xa=rr?_n(rr):Ad;function Dg(g){return g===t}function xg(g){return Zs(g)&&Pn(g)==ct}function Ig(g){return Zs(g)&&zs(g)==h}var Vg=fh(Xh),Og=fh(function(g,S){return g<=S});function Yc(g){if(!g)return[];if(jn(g))return Eh(g)?Ft(g):Kn(g);if(la&&g[la])return ka(g[la]());var S=Pn(g),k=S==is?vn:S==Xe?tt:ja;return k(g)}function yo(g){if(!g)return g===0?g:0;if(g=Cr(g),g===Ke||g===-Ke){var S=g<0?-1:1;return S*nt}return g===g?g:0}function Qi(g){var S=yo(g),k=S%1;return S===S?k?S-k:S:0}function Kc(g){return g?fi(Qi(g),0,Mt):0}function Cr(g){if(typeof g=="number")return g;if(cr(g))return dt;if(Ws(g)){var S=typeof g.valueOf=="function"?g.valueOf():g;g=Ws(S)?S+"":S}if(typeof g!="string")return g===0?g:+g;g=g.replace(Je,"");var k=_i.test(g);return k||Yt.test(g)?Cs(g.slice(2),k?2:8):bi.test(g)?dt:+g}function Xc(g){return Zr(g,dr(g))}function Mg(g){return g?fi(Qi(g),-At,At):g===0?g:0}function Ls(g){return g==null?"":ur(g)}var kg=Wa(function(g,S){if(yl(S)||jn(S)){Zr(S,dn(S),g);return}for(var k in S)Ms.call(S,k)&&kt(g,k,S[k])}),jc=Wa(function(g,S){Zr(S,dr(S),g)}),bl=Wa(function(g,S,k,re){Zr(S,dr(S),g,re)}),Rg=Wa(function(g,S,k,re){Zr(S,dn(S),g,re)}),Ng=fo(ai);function Bg(g,S){var k=Io(g);return S==null?k:Nt(k,S)}var Fg=rs(function(g){return g.push(t,au),an(bl,t,g)}),qg=rs(function(g){return g.push(t,gc),an(Zc,t,g)});function Hg(g,S){return Ma(g,ki(S,3),Rn)}function zg(g,S){return Ma(g,ki(S,3),hr)}function $g(g,S){return g==null?g:Xs(g,ki(S,3),dr)}function Ug(g,S){return g==null?g:Yi(g,ki(S,3),dr)}function Gg(g,S){return g&&Rn(g,ki(S,3))}function Wg(g,S){return g&&hr(g,ki(S,3))}function Yg(g){return g==null?[]:Sn(g,dn(g))}function Kg(g){return g==null?[]:Sn(g,dr(g))}function Au(g,S,k){var re=g==null?t:Ci(g,S);return re===t?k:re}function Xg(g,S){return g!=null&&_c(g,S,Fs)}function wu(g,S){return g!=null&&_c(g,S,fl)}var jg=cc(function(g,S,k){g[S]=k},Pu(Zn)),Zg=cc(function(g,S,k){Ms.call(g,S)?g[S].push(k):g[S]=[k]},ki),Qg=rs(js);function dn(g){return jn(g)?ni(g):Kh(g)}function dr(g){return jn(g)?ni(g,!0):wd(g)}function Jg(g,S){var k={};return S=ki(S,3),Rn(g,function(re,Ce,qe){st(k,S(re,Ce,qe),re)}),k}function em(g,S){var k={};return S=ki(S,3),Rn(g,function(re,Ce,qe){st(k,Ce,S(re,Ce,qe))}),k}var tm=Wa(function(g,S,k){ah(g,S,k)}),Zc=Wa(function(g,S,k,re){ah(g,S,k,re)}),im=fo(function(g,S){var k={};if(g==null)return k;var re=!1;S=Ss(S,function(qe){return qe=Mo(qe,g),re||(re=qe.length>1),qe}),Zr(g,hu(g),k),re&&(k=ui(k,y|m|O,Yd));for(var Ce=S.length;Ce--;)eu(k,S[Ce]);return k});function sm(g,S){return Qc(g,Ah(ki(S)))}var nm=fo(function(g,S){return g==null?{}:Pd(g,S)});function Qc(g,S){if(g==null)return{};var k=Ss(hu(g),function(re){return[re]});return S=ki(S),Yu(g,k,function(re,Ce){return S(re,Ce[0])})}function rm(g,S,k){S=Mo(S,g);var re=-1,Ce=S.length;for(Ce||(Ce=1,g=t);++re<Ce;){var qe=g==null?t:g[Qr(S[re])];qe===t&&(re=Ce,qe=k),g=mo(qe)?qe.call(g):qe}return g}function om(g,S,k){return g==null?g:gl(g,S,k)}function am(g,S,k,re){return re=typeof re=="function"?re:t,g==null?g:gl(g,S,k,re)}var Jc=fc(dn),ed=fc(dr);function lm(g,S,k){var re=ji(g),Ce=re||Ro(g)||Xa(g);if(S=ki(S,4),k==null){var qe=g&&g.constructor;Ce?k=re?new qe:[]:Ws(g)?k=mo(qe)?Io(Fa(g)):{}:k={}}return(Ce?rn:Rn)(g,function(et,pt,vt){return S(k,et,pt,vt)}),k}function hm(g,S){return g==null?!0:eu(g,S)}function um(g,S,k){return g==null?g:Qu(g,S,su(k))}function cm(g,S,k,re){return re=typeof re=="function"?re:t,g==null?g:Qu(g,S,su(k),re)}function ja(g){return g==null?[]:ea(g,dn(g))}function dm(g){return g==null?[]:ea(g,dr(g))}function pm(g,S,k){return k===t&&(k=S,S=t),k!==t&&(k=Cr(k),k=k===k?k:0),S!==t&&(S=Cr(S),S=S===S?S:0),fi(Cr(g),S,k)}function fm(g,S,k){return S=yo(S),k===t?(k=S,S=0):k=yo(k),g=Cr(g),oh(g,S,k)}function gm(g,S,k){if(k&&typeof k!="boolean"&&Xn(g,S,k)&&(S=k=t),k===t&&(typeof S=="boolean"?(k=S,S=t):typeof g=="boolean"&&(k=g,g=t)),g===t&&S===t?(g=0,S=1):(g=yo(g),S===t?(S=g,g=0):S=yo(S)),g>S){var re=g;g=S,S=re}if(k||g%1||S%1){var Ce=Gn();return cn(g+Ce*(S-g+Gi("1e-"+((Ce+"").length-1))),S)}return Zh(g,S)}var mm=Ya(function(g,S,k){return S=S.toLowerCase(),g+(k?td(S):S)});function td(g){return Eu(Ls(g).toLowerCase())}function id(g){return g=Ls(g),g&&g.replace(os,To).replace(Q,"")}function ym(g,S,k){g=Ls(g),S=ur(S);var re=g.length;k=k===t?re:fi(Qi(k),0,re);var Ce=k;return k-=S.length,k>=0&&g.slice(k,Ce)==S}function _m(g){return g=Ls(g),g&&xe.test(g)?g.replace(ke,ia):g}function vm(g){return g=Ls(g),g&&rt.test(g)?g.replace(je,"\\$&"):g}var bm=Ya(function(g,S,k){return g+(k?"-":"")+S.toLowerCase()}),Sm=Ya(function(g,S,k){return g+(k?" ":"")+S.toLowerCase()}),Am=lc("toLowerCase");function wm(g,S,k){g=Ls(g),S=Qi(S);var re=S?qt(g):0;if(!S||re>=S)return g;var Ce=(S-re)/2;return ph(ca(Ce),k)+g+ph(Hr(Ce),k)}function Em(g,S,k){g=Ls(g),S=Qi(S);var re=S?qt(g):0;return S&&re<S?g+ph(S-re,k):g}function Pm(g,S,k){g=Ls(g),S=Qi(S);var re=S?qt(g):0;return S&&re<S?ph(S-re,k)+g:g}function Lm(g,S,k){return k||S==null?S=0:S&&(S=+S),Fu(Ls(g).replace(lt,""),S||0)}function Tm(g,S,k){return(k?Xn(g,S,k):S===t)?S=1:S=Qi(S),Qh(Ls(g),S)}function Cm(){var g=arguments,S=Ls(g[0]);return g.length<3?S:S.replace(g[1],g[2])}var Dm=Ya(function(g,S,k){return g+(k?"_":"")+S.toLowerCase()});function xm(g,S,k){return k&&typeof k!="number"&&Xn(g,S,k)&&(S=k=t),k=k===t?Mt:k>>>0,k?(g=Ls(g),g&&(typeof S=="string"||S!=null&&!Su(S))&&(S=ur(S),!S&&Pr(g))?ko(Ft(g),0,k):g.split(S,k)):[]}var Im=Ya(function(g,S,k){return g+(k?" ":"")+Eu(S)});function Vm(g,S,k){return g=Ls(g),k=k==null?0:fi(Qi(k),0,g.length),S=ur(S),g.slice(k,k+S.length)==S}function Om(g,S,k){var re=Ne.templateSettings;k&&Xn(g,S,k)&&(S=t),g=Ls(g),S=bl({},S,re,au);var Ce=bl({},S.imports,re.imports,au),qe=dn(Ce),et=ea(Ce,qe),pt,vt,Wt=0,Ut=S.interpolate||St,Qt="__p += '",ci=al((S.escape||St).source+"|"+Ut.source+"|"+(Ut===Ie?Rt:St).source+"|"+(S.evaluate||St).source+"|$","g"),vi="//# sourceURL="+("sourceURL"in S?S.sourceURL:"lodash.templateSources["+ ++yt+"]")+`
`;g.replace(ci,function(Ui,gs,Ts,Nn,Bn,No){return Ts||(Ts=Nn),Qt+=g.slice(Wt,No).replace(Wi,sa),gs&&(pt=!0,Qt+=`' +
__e(`+gs+`) +
'`),Bn&&(vt=!0,Qt+=`';
`+Bn+`;
__p += '`),Ts&&(Qt+=`' +
((__t = (`+Ts+`)) == null ? '' : __t) +
'`),Wt=No+Ui.length,Ui}),Qt+=`';
`;var Fi=S.variable;Fi||(Qt=`with (obj) {
`+Qt+`
}
`),Qt=(vt?Qt.replace(de,""):Qt).replace(le,"$1").replace(we,"$1;"),Qt="function("+(Fi||"obj")+`) {
`+(Fi?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(pt?", __e = _.escape":"")+(vt?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+Qt+`return __p
}`;var ls=nd(function(){return Ei(qe,vi+"return "+Qt).apply(t,et)});if(ls.source=Qt,bu(ls))throw ls;return ls}function Mm(g){return Ls(g).toLowerCase()}function km(g){return Ls(g).toUpperCase()}function Rm(g,S,k){if(g=Ls(g),g&&(k||S===t))return g.replace(Je,"");if(!g||!(S=ur(S)))return g;var re=Ft(g),Ce=Ft(S),qe=Po(re,Ce),et=ta(re,Ce)+1;return ko(re,qe,et).join("")}function Nm(g,S,k){if(g=Ls(g),g&&(k||S===t))return g.replace(ht,"");if(!g||!(S=ur(S)))return g;var re=Ft(g),Ce=ta(re,Ft(S))+1;return ko(re,0,Ce).join("")}function Bm(g,S,k){if(g=Ls(g),g&&(k||S===t))return g.replace(lt,"");if(!g||!(S=ur(S)))return g;var re=Ft(g),Ce=Po(re,Ft(S));return ko(re,Ce).join("")}function Fm(g,S){var k=W,re=J;if(Ws(S)){var Ce="separator"in S?S.separator:Ce;k="length"in S?Qi(S.length):k,re="omission"in S?ur(S.omission):re}g=Ls(g);var qe=g.length;if(Pr(g)){var et=Ft(g);qe=et.length}if(k>=qe)return g;var pt=k-qt(re);if(pt<1)return re;var vt=et?ko(et,0,pt).join(""):g.slice(0,pt);if(Ce===t)return vt+re;if(et&&(pt+=vt.length-pt),Su(Ce)){if(g.slice(pt).search(Ce)){var Wt,Ut=vt;for(Ce.global||(Ce=al(Ce.source,Ls(Si.exec(Ce))+"g")),Ce.lastIndex=0;Wt=Ce.exec(Ut);)var Qt=Wt.index;vt=vt.slice(0,Qt===t?pt:Qt)}}else if(g.indexOf(ur(Ce),pt)!=pt){var ci=vt.lastIndexOf(Ce);ci>-1&&(vt=vt.slice(0,ci))}return vt+re}function qm(g){return g=Ls(g),g&&ye.test(g)?g.replace(Ve,ri):g}var Hm=Ya(function(g,S,k){return g+(k?" ":"")+S.toUpperCase()}),Eu=lc("toUpperCase");function sd(g,S,k){return g=Ls(g),S=k?t:S,S===t?na(g)?Bi(g):ol(g):g.match(S)||[]}var nd=rs(function(g,S){try{return an(g,t,S)}catch(k){return bu(k)?k:new wi(k)}}),zm=fo(function(g,S){return rn(S,function(k){k=Qr(k),st(g,k,_u(g[k],g))}),g});function $m(g){var S=g==null?0:g.length,k=ki();return g=S?Ss(g,function(re){if(typeof re[1]!="function")throw new Un(a);return[k(re[0]),re[1]]}):[],rs(function(re){for(var Ce=-1;++Ce<S;){var qe=g[Ce];if(an(qe[0],this,re))return an(qe[1],this,re)}})}function Um(g){return gi(ui(g,y))}function Pu(g){return function(){return g}}function Gm(g,S){return g==null||g!==g?S:g}var Wm=uc(),Ym=uc(!0);function Zn(g){return g}function Lu(g){return Hu(typeof g=="function"?g:ui(g,y))}function Km(g){return $u(ui(g,y))}function Xm(g,S){return Uu(g,ui(S,y))}var jm=rs(function(g,S){return function(k){return js(k,g,S)}}),Zm=rs(function(g,S){return function(k){return js(g,k,S)}});function Tu(g,S,k){var re=dn(S),Ce=Sn(S,re);k==null&&!(Ws(S)&&(Ce.length||!re.length))&&(k=S,S=g,g=this,Ce=Sn(S,dn(S)));var qe=!(Ws(k)&&"chain"in k)||!!k.chain,et=mo(g);return rn(Ce,function(pt){var vt=S[pt];g[pt]=vt,et&&(g.prototype[pt]=function(){var Wt=this.__chain__;if(qe||Wt){var Ut=g(this.__wrapped__),Qt=Ut.__actions__=Kn(this.__actions__);return Qt.push({func:vt,args:arguments,thisArg:g}),Ut.__chain__=Wt,Ut}return vt.apply(g,wr([this.value()],arguments))})}),g}function Qm(){return ss._===this&&(ss._=Fh),this}function Cu(){}function Jm(g){return g=Qi(g),rs(function(S){return Gu(S,g)})}var e0=ru(Ss),t0=ru(Ar),i0=ru(Zo);function rd(g){return pu(g)?In(Qr(g)):Ld(g)}function s0(g){return function(S){return g==null?t:Ci(g,S)}}var n0=dc(),r0=dc(!0);function Du(){return[]}function xu(){return!1}function o0(){return{}}function a0(){return""}function l0(){return!0}function h0(g,S){if(g=Qi(g),g<1||g>At)return[];var k=Mt,re=cn(g,Mt);S=ki(S),g-=Mt;for(var Ce=lr(re,S);++k<g;)S(k);return Ce}function u0(g){return ji(g)?Ss(g,Qr):cr(g)?[g]:Kn(Tc(Ls(g)))}function c0(g){var S=++aa;return Ls(g)+S}var d0=dh(function(g,S){return g+S},0),p0=ou("ceil"),f0=dh(function(g,S){return g/S},1),g0=ou("floor");function m0(g){return g&&g.length?ln(g,Zn,co):t}function y0(g,S){return g&&g.length?ln(g,ki(S,2),co):t}function _0(g){return ar(g,Zn)}function v0(g,S){return ar(g,ki(S,2))}function b0(g){return g&&g.length?ln(g,Zn,Xh):t}function S0(g,S){return g&&g.length?ln(g,ki(S,2),Xh):t}var A0=dh(function(g,S){return g*S},1),w0=ou("round"),E0=dh(function(g,S){return g-S},0);function P0(g){return g&&g.length?hn(g,Zn):0}function L0(g,S){return g&&g.length?hn(g,ki(S,2)):0}return Ne.after=Wf,Ne.ary=Bc,Ne.assign=kg,Ne.assignIn=jc,Ne.assignInWith=bl,Ne.assignWith=Rg,Ne.at=Ng,Ne.before=Fc,Ne.bind=_u,Ne.bindAll=zm,Ne.bindKey=qc,Ne.castArray=ng,Ne.chain=kc,Ne.chunk=dp,Ne.compact=pp,Ne.concat=fp,Ne.cond=$m,Ne.conforms=Um,Ne.constant=Pu,Ne.countBy=wf,Ne.create=Bg,Ne.curry=Hc,Ne.curryRight=zc,Ne.debounce=$c,Ne.defaults=Fg,Ne.defaultsDeep=qg,Ne.defer=Yf,Ne.delay=Kf,Ne.difference=gp,Ne.differenceBy=mp,Ne.differenceWith=yp,Ne.drop=_p,Ne.dropRight=vp,Ne.dropRightWhile=bp,Ne.dropWhile=Sp,Ne.fill=Ap,Ne.filter=Pf,Ne.flatMap=Cf,Ne.flatMapDeep=Df,Ne.flatMapDepth=xf,Ne.flatten=Ic,Ne.flattenDeep=wp,Ne.flattenDepth=Ep,Ne.flip=Xf,Ne.flow=Wm,Ne.flowRight=Ym,Ne.fromPairs=Pp,Ne.functions=Yg,Ne.functionsIn=Kg,Ne.groupBy=If,Ne.initial=Tp,Ne.intersection=Cp,Ne.intersectionBy=Dp,Ne.intersectionWith=xp,Ne.invert=jg,Ne.invertBy=Zg,Ne.invokeMap=Of,Ne.iteratee=Lu,Ne.keyBy=Mf,Ne.keys=dn,Ne.keysIn=dr,Ne.map=vh,Ne.mapKeys=Jg,Ne.mapValues=em,Ne.matches=Km,Ne.matchesProperty=Xm,Ne.memoize=Sh,Ne.merge=tm,Ne.mergeWith=Zc,Ne.method=jm,Ne.methodOf=Zm,Ne.mixin=Tu,Ne.negate=Ah,Ne.nthArg=Jm,Ne.omit=im,Ne.omitBy=sm,Ne.once=jf,Ne.orderBy=kf,Ne.over=e0,Ne.overArgs=Zf,Ne.overEvery=t0,Ne.overSome=i0,Ne.partial=vu,Ne.partialRight=Uc,Ne.partition=Rf,Ne.pick=nm,Ne.pickBy=Qc,Ne.property=rd,Ne.propertyOf=s0,Ne.pull=Mp,Ne.pullAll=Oc,Ne.pullAllBy=kp,Ne.pullAllWith=Rp,Ne.pullAt=Np,Ne.range=n0,Ne.rangeRight=r0,Ne.rearg=Qf,Ne.reject=Ff,Ne.remove=Bp,Ne.rest=Jf,Ne.reverse=mu,Ne.sampleSize=Hf,Ne.set=om,Ne.setWith=am,Ne.shuffle=zf,Ne.slice=Fp,Ne.sortBy=Gf,Ne.sortedUniq=Wp,Ne.sortedUniqBy=Yp,Ne.split=xm,Ne.spread=eg,Ne.tail=Kp,Ne.take=Xp,Ne.takeRight=jp,Ne.takeRightWhile=Zp,Ne.takeWhile=Qp,Ne.tap=ff,Ne.throttle=tg,Ne.thru=_h,Ne.toArray=Yc,Ne.toPairs=Jc,Ne.toPairsIn=ed,Ne.toPath=u0,Ne.toPlainObject=Xc,Ne.transform=lm,Ne.unary=ig,Ne.union=Jp,Ne.unionBy=ef,Ne.unionWith=tf,Ne.uniq=sf,Ne.uniqBy=nf,Ne.uniqWith=rf,Ne.unset=hm,Ne.unzip=yu,Ne.unzipWith=Mc,Ne.update=um,Ne.updateWith=cm,Ne.values=ja,Ne.valuesIn=dm,Ne.without=of,Ne.words=sd,Ne.wrap=sg,Ne.xor=af,Ne.xorBy=lf,Ne.xorWith=hf,Ne.zip=uf,Ne.zipObject=cf,Ne.zipObjectDeep=df,Ne.zipWith=pf,Ne.entries=Jc,Ne.entriesIn=ed,Ne.extend=jc,Ne.extendWith=bl,Tu(Ne,Ne),Ne.add=d0,Ne.attempt=nd,Ne.camelCase=mm,Ne.capitalize=td,Ne.ceil=p0,Ne.clamp=pm,Ne.clone=rg,Ne.cloneDeep=ag,Ne.cloneDeepWith=lg,Ne.cloneWith=og,Ne.conformsTo=hg,Ne.deburr=id,Ne.defaultTo=Gm,Ne.divide=f0,Ne.endsWith=ym,Ne.eq=Jr,Ne.escape=_m,Ne.escapeRegExp=vm,Ne.every=Ef,Ne.find=Lf,Ne.findIndex=Dc,Ne.findKey=Hg,Ne.findLast=Tf,Ne.findLastIndex=xc,Ne.findLastKey=zg,Ne.floor=g0,Ne.forEach=Rc,Ne.forEachRight=Nc,Ne.forIn=$g,Ne.forInRight=Ug,Ne.forOwn=Gg,Ne.forOwnRight=Wg,Ne.get=Au,Ne.gt=ug,Ne.gte=cg,Ne.has=Xg,Ne.hasIn=wu,Ne.head=Vc,Ne.identity=Zn,Ne.includes=Vf,Ne.indexOf=Lp,Ne.inRange=fm,Ne.invoke=Qg,Ne.isArguments=Aa,Ne.isArray=ji,Ne.isArrayBuffer=dg,Ne.isArrayLike=jn,Ne.isArrayLikeObject=en,Ne.isBoolean=pg,Ne.isBuffer=Ro,Ne.isDate=fg,Ne.isElement=gg,Ne.isEmpty=mg,Ne.isEqual=yg,Ne.isEqualWith=_g,Ne.isError=bu,Ne.isFinite=vg,Ne.isFunction=mo,Ne.isInteger=Gc,Ne.isLength=wh,Ne.isMap=bg,Ne.isMatch=Sg,Ne.isMatchWith=Ag,Ne.isNaN=wg,Ne.isNative=Eg,Ne.isNil=Lg,Ne.isNull=Pg,Ne.isNumber=Wc,Ne.isObject=Ws,Ne.isObjectLike=Zs,Ne.isPlainObject=vl,Ne.isRegExp=Su,Ne.isSafeInteger=Tg,Ne.isSet=Cg,Ne.isString=Eh,Ne.isSymbol=cr,Ne.isTypedArray=Xa,Ne.isUndefined=Dg,Ne.isWeakMap=xg,Ne.isWeakSet=Ig,Ne.join=Ip,Ne.kebabCase=bm,Ne.last=Tr,Ne.lastIndexOf=Vp,Ne.lowerCase=Sm,Ne.lowerFirst=Am,Ne.lt=Vg,Ne.lte=Og,Ne.max=m0,Ne.maxBy=y0,Ne.mean=_0,Ne.meanBy=v0,Ne.min=b0,Ne.minBy=S0,Ne.stubArray=Du,Ne.stubFalse=xu,Ne.stubObject=o0,Ne.stubString=a0,Ne.stubTrue=l0,Ne.multiply=A0,Ne.nth=Op,Ne.noConflict=Qm,Ne.noop=Cu,Ne.now=bh,Ne.pad=wm,Ne.padEnd=Em,Ne.padStart=Pm,Ne.parseInt=Lm,Ne.random=gm,Ne.reduce=Nf,Ne.reduceRight=Bf,Ne.repeat=Tm,Ne.replace=Cm,Ne.result=rm,Ne.round=w0,Ne.runInContext=ot,Ne.sample=qf,Ne.size=$f,Ne.snakeCase=Dm,Ne.some=Uf,Ne.sortedIndex=qp,Ne.sortedIndexBy=Hp,Ne.sortedIndexOf=zp,Ne.sortedLastIndex=$p,Ne.sortedLastIndexBy=Up,Ne.sortedLastIndexOf=Gp,Ne.startCase=Im,Ne.startsWith=Vm,Ne.subtract=E0,Ne.sum=P0,Ne.sumBy=L0,Ne.template=Om,Ne.times=h0,Ne.toFinite=yo,Ne.toInteger=Qi,Ne.toLength=Kc,Ne.toLower=Mm,Ne.toNumber=Cr,Ne.toSafeInteger=Mg,Ne.toString=Ls,Ne.toUpper=km,Ne.trim=Rm,Ne.trimEnd=Nm,Ne.trimStart=Bm,Ne.truncate=Fm,Ne.unescape=qm,Ne.uniqueId=c0,Ne.upperCase=Hm,Ne.upperFirst=Eu,Ne.each=Rc,Ne.eachRight=Nc,Ne.first=Vc,Tu(Ne,function(){var g={};return Rn(Ne,function(S,k){Ms.call(Ne.prototype,k)||(g[k]=S)}),g}(),{chain:!1}),Ne.VERSION=n,rn(["bind","bindKey","curry","curryRight","partial","partialRight"],function(g){Ne[g].placeholder=Ne}),rn(["drop","take"],function(g,S){ns.prototype[g]=function(k){k=k===t?1:Ys(Qi(k),0);var re=this.__filtered__&&!S?new ns(this):this.clone();return re.__filtered__?re.__takeCount__=cn(k,re.__takeCount__):re.__views__.push({size:cn(k,Mt),type:g+(re.__dir__<0?"Right":"")}),re},ns.prototype[g+"Right"]=function(k){return this.reverse()[g](k).reverse()}}),rn(["filter","map","takeWhile"],function(g,S){var k=S+1,re=k==Te||k==Bt;ns.prototype[g]=function(Ce){var qe=this.clone();return qe.__iteratees__.push({iteratee:ki(Ce,3),type:k}),qe.__filtered__=qe.__filtered__||re,qe}}),rn(["head","last"],function(g,S){var k="take"+(S?"Right":"");ns.prototype[g]=function(){return this[k](1).value()[0]}}),rn(["initial","tail"],function(g,S){var k="drop"+(S?"":"Right");ns.prototype[g]=function(){return this.__filtered__?new ns(this):this[k](1)}}),ns.prototype.compact=function(){return this.filter(Zn)},ns.prototype.find=function(g){return this.filter(g).head()},ns.prototype.findLast=function(g){return this.reverse().find(g)},ns.prototype.invokeMap=rs(function(g,S){return typeof g=="function"?new ns(this):this.map(function(k){return js(k,g,S)})}),ns.prototype.reject=function(g){return this.filter(Ah(ki(g)))},ns.prototype.slice=function(g,S){g=Qi(g);var k=this;return k.__filtered__&&(g>0||S<0)?new ns(k):(g<0?k=k.takeRight(-g):g&&(k=k.drop(g)),S!==t&&(S=Qi(S),k=S<0?k.dropRight(-S):k.take(S-g)),k)},ns.prototype.takeRightWhile=function(g){return this.reverse().takeWhile(g).reverse()},ns.prototype.toArray=function(){return this.take(Mt)},Rn(ns.prototype,function(g,S){var k=/^(?:filter|find|map|reject)|While$/.test(S),re=/^(?:head|last)$/.test(S),Ce=Ne[re?"take"+(S=="last"?"Right":""):S],qe=re||/^find/.test(S);Ce&&(Ne.prototype[S]=function(){var et=this.__wrapped__,pt=re?[1]:arguments,vt=et instanceof ns,Wt=pt[0],Ut=vt||ji(et),Qt=function(gs){var Ts=Ce.apply(Ne,wr([gs],pt));return re&&ci?Ts[0]:Ts};Ut&&k&&typeof Wt=="function"&&Wt.length!=1&&(vt=Ut=!1);var ci=this.__chain__,vi=!!this.__actions__.length,Fi=qe&&!ci,ls=vt&&!vi;if(!qe&&Ut){et=ls?et:new ns(this);var Ui=g.apply(et,pt);return Ui.__actions__.push({func:_h,args:[Qt],thisArg:t}),new Wn(Ui,ci)}return Fi&&ls?g.apply(this,pt):(Ui=this.thru(Qt),Fi?re?Ui.value()[0]:Ui.value():Ui)})}),rn(["pop","push","shift","sort","splice","unshift"],function(g){var S=Ra[g],k=/^(?:push|sort|unshift)$/.test(g)?"tap":"thru",re=/^(?:pop|shift)$/.test(g);Ne.prototype[g]=function(){var Ce=arguments;if(re&&!this.__chain__){var qe=this.value();return S.apply(ji(qe)?qe:[],Ce)}return this[k](function(et){return S.apply(ji(et)?et:[],Ce)})}}),Rn(ns.prototype,function(g,S){var k=Ne[S];if(k){var re=k.name+"",Ce=fa[re]||(fa[re]=[]);Ce.push({name:S,func:k})}}),fa[ch(t,N).name]=[{name:"wrapper",func:t}],ns.prototype.clone=ya,ns.prototype.reverse=cl,ns.prototype.value=ho,Ne.prototype.at=gf,Ne.prototype.chain=mf,Ne.prototype.commit=yf,Ne.prototype.next=_f,Ne.prototype.plant=bf,Ne.prototype.reverse=Sf,Ne.prototype.toJSON=Ne.prototype.valueOf=Ne.prototype.value=Af,Ne.prototype.first=Ne.prototype.head,la&&(Ne.prototype[la]=vf),Ne},us=Ii();Hs?((Hs.exports=us)._=us,xi._=us):ss._=us,ss._=us}).call(window)})(lodash4_17_4,lodash4_17_4.exports);lodash4_17_4.exports;(function(){window.phetio=window.phetio||{};const o=".",e="_",t="-",n="general",r="global",s="homeScreen",a="model",l="view",d="colors",c="strings",y="controller",m="Screen",O="archetype",D="Capsule";window.phetio.PhetioIDUtils={append:function(z,...w){return w.forEach(N=>{if(assert&&assert(N.indexOf(o)===-1,`separator appears in componentName: ${N}`),N==="")return;z+=(z===""?"":o)+N}),z},getComponentName:function(z){assert&&assert(z.length>0);const w=z.lastIndexOf(o);return w===-1?z:z.substring(w+1,z.length)},getParentID:function(z){const w=z.lastIndexOf(o);return w===-1?null:z.substring(0,w)},getDOMElementID:function(z){return`phetioID:${z}`},getScreenID:function(z){const w=[],N=z.split(o);for(let H=0;H<N.length;H++){const X=N[H];w.push(X);const ae=X.indexOf(m);if(ae>0&&ae+m.length===X.length)return w.join(o)}return null},getGroupElementIndex:function(z){return assert&&assert(z.indexOf(window.phetio.PhetioIDUtils.GROUP_SEPARATOR)>=0,"component name for phetioID should have group element syntax"),Number(z.split(window.phetio.PhetioIDUtils.GROUP_SEPARATOR)[1])},isAncestor:function(z,w){const N=z.split(o),H=w.split(o);for(let X=0;X<N.length;X++)if(N[X]!==H[X])return!1;return w!==z},getArchetypalPhetioID:function(z){const w=z.split(o);for(let N=0;N<w.length;N++){const H=w[N];if(H.endsWith(D)&&N<w.length-1)w[N+1]=O,N++;else{const X=H.split(t).map(ae=>ae.includes(e)?O:ae);w[N]=X.join(t)}}return w.join(o)},SEPARATOR:o,GROUP_SEPARATOR:e,INTER_TERM_SEPARATOR:t,GENERAL_COMPONENT_NAME:n,GLOBAL_COMPONENT_NAME:r,HOME_SCREEN_COMPONENT_NAME:s,MODEL_COMPONENT_NAME:a,VIEW_COMPONENT_NAME:l,CONTROLLER_COMPONENT_NAME:y,COLORS_COMPONENT_NAME:d,STRINGS_COMPONENT_NAME:c,ARCHETYPE:O,CAPSULE_SUFFIX:D}})();window.LineBreaker=(()=>{const o=(()=>{var dt=0,Mt=-3;function zt(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}function xt(De,ct){this.source=De,this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=ct,this.destLen=0,this.ltree=new zt,this.dtree=new zt}var Gt=new zt,yi=new zt,ti=new Uint8Array(30),Mi=new Uint16Array(30),Li=new Uint8Array(30),qi=new Uint16Array(30),Pi=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Oi=new zt,$t=new Uint8Array(320);function Rs(De,ct,h,f){var b,L;for(b=0;b<h;++b)De[b]=0;for(b=0;b<30-h;++b)De[b+h]=b/h|0;for(L=f,b=0;b<30;++b)ct[b]=L,L+=1<<De[b]}function is(De,ct){var h;for(h=0;h<7;++h)De.table[h]=0;for(De.table[7]=24,De.table[8]=152,De.table[9]=112,h=0;h<24;++h)De.trans[h]=256+h;for(h=0;h<144;++h)De.trans[24+h]=h;for(h=0;h<8;++h)De.trans[168+h]=280+h;for(h=0;h<112;++h)De.trans[176+h]=144+h;for(h=0;h<5;++h)ct.table[h]=0;for(ct.table[5]=32,h=0;h<32;++h)ct.trans[h]=h}var hs=new Uint16Array(16);function qs(De,ct,h,f){var b,L;for(b=0;b<16;++b)De.table[b]=0;for(b=0;b<f;++b)De.table[ct[h+b]]++;for(De.table[0]=0,L=0,b=0;b<16;++b)hs[b]=L,L+=De.table[b];for(b=0;b<f;++b)ct[h+b]&&(De.trans[hs[ct[h+b]]++]=b)}function q(De){De.bitcount--||(De.tag=De.source[De.sourceIndex++],De.bitcount=7);var ct=De.tag&1;return De.tag>>>=1,ct}function Re(De,ct,h){if(!ct)return h;for(;De.bitcount<24;)De.tag|=De.source[De.sourceIndex++]<<De.bitcount,De.bitcount+=8;var f=De.tag&65535>>>16-ct;return De.tag>>>=ct,De.bitcount-=ct,f+h}function He(De,ct){for(;De.bitcount<24;)De.tag|=De.source[De.sourceIndex++]<<De.bitcount,De.bitcount+=8;var h=0,f=0,b=0,L=De.tag;do f=2*f+(L&1),L>>>=1,++b,h+=ct.table[b],f-=ct.table[b];while(f>=0);return De.tag=L,De.bitcount-=b,ct.trans[h+f]}function Ze(De,ct,h){var f,b,L,I,B,j;for(f=Re(De,5,257),b=Re(De,5,1),L=Re(De,4,4),I=0;I<19;++I)$t[I]=0;for(I=0;I<L;++I){var Y=Re(De,3,0);$t[Pi[I]]=Y}for(qs(Oi,$t,0,19),B=0;B<f+b;){var Z=He(De,Oi);switch(Z){case 16:var ie=$t[B-1];for(j=Re(De,2,3);j;--j)$t[B++]=ie;break;case 17:for(j=Re(De,3,3);j;--j)$t[B++]=0;break;case 18:for(j=Re(De,7,11);j;--j)$t[B++]=0;break;default:$t[B++]=Z;break}}qs(ct,$t,0,f),qs(h,$t,f,b)}function Xe(De,ct,h){for(;;){var f=He(De,ct);if(f===256)return dt;if(f<256)De.dest[De.destLen++]=f;else{var b,L,I,B;for(f-=257,b=Re(De,ti[f],Mi[f]),L=He(De,h),I=De.destLen-Re(De,Li[L],qi[L]),B=I;B<I+b;++B)De.dest[De.destLen++]=De.dest[B]}}}function Pe(De){for(var ct,h,f;De.bitcount>8;)De.sourceIndex--,De.bitcount-=8;if(ct=De.source[De.sourceIndex+1],ct=256*ct+De.source[De.sourceIndex],h=De.source[De.sourceIndex+3],h=256*h+De.source[De.sourceIndex+2],ct!==(~h&65535))return Mt;for(De.sourceIndex+=4,f=ct;f;--f)De.dest[De.destLen++]=De.source[De.sourceIndex++];return De.bitcount=0,dt}function Le(De,ct){var h=new xt(De,ct),f,b,L;do{switch(f=q(h),b=Re(h,2,0),b){case 0:L=Pe(h);break;case 1:L=Xe(h,Gt,yi);break;case 2:Ze(h,h.ltree,h.dtree),L=Xe(h,h.ltree,h.dtree);break;default:L=Mt}if(L!==dt)throw new Error("Data error")}while(!f);return h.destLen<h.dest.length?typeof h.dest.slice=="function"?h.dest.slice(0,h.destLen):h.dest.subarray(0,h.destLen):h.dest}return is(Gt,yi),Rs(ti,Mi,4,3),Rs(Li,qi,2,1),ti[28]=0,Mi[28]=258,Le})(),e=(()=>{const dt=new Uint8Array(new Uint32Array([305419896]).buffer)[0]===18,Mt=(Gt,yi,ti)=>{let Mi=Gt[yi];Gt[yi]=Gt[ti],Gt[ti]=Mi},zt=Gt=>{const yi=Gt.length;for(let ti=0;ti<yi;ti+=4)Mt(Gt,ti,ti+3),Mt(Gt,ti+1,ti+2)};return Gt=>{dt&&zt(Gt)}})(),t=(()=>{class qs{constructor(Re){const He=typeof Re.readUInt32BE=="function"&&typeof Re.slice=="function";if(He||Re instanceof Uint8Array){let Ze;if(He)this.highStart=Re.readUInt32LE(0),this.errorValue=Re.readUInt32LE(4),Ze=Re.readUInt32LE(8),Re=Re.slice(12);else{const Xe=new DataView(Re.buffer);this.highStart=Xe.getUint32(0,!0),this.errorValue=Xe.getUint32(4,!0),Ze=Xe.getUint32(8,!0),Re=Re.subarray(12)}Re=o(Re,new Uint8Array(Ze)),Re=o(Re,new Uint8Array(Ze)),e(Re),this.data=new Uint32Array(Re.buffer)}else({data:this.data,highStart:this.highStart,errorValue:this.errorValue}=Re)}get(Re){let He;return Re<0||Re>1114111?this.errorValue:Re<55296||Re>56319&&Re<=65535?(He=(this.data[Re>>5]<<2)+(Re&31),this.data[He]):Re<=65535?(He=(this.data[2048+(Re-55296>>5)]<<2)+(Re&31),this.data[He]):Re<this.highStart?(He=this.data[2080+(Re>>11)],He=this.data[He+(Re>>5&63)],He=(He<<2)+(Re&31),this.data[He]):this.data[this.data.length-4]}}return qs})(),s=(dt=>{const Mt=window.atob(dt),zt=new Uint8Array(Mt.length);for(var xt=0;xt<Mt.length;xt++)zt[xt]=Mt.charCodeAt(xt);return zt})("AAgOAAAAAAAQ4QAAAQ0P8vDtnQuMXUUZx+eyu7d7797d9m5bHoWltKVUlsjLWE0VJNigQoMVqkStEoNQQUl5GIo1KKmogEgqkKbBRki72lYabZMGKoGAjQRtJJDaCCIRiiigREBQS3z+xzOTnZ3O+3HOhd5NfpkzZx7fN9988zivu2M9hGwB28F94DnwEngd/Asc1EtIs9c/bIPDwCxwLDgezHcodyo4w5C+CCwBS8FnwSXgCnA1uFbI93XwbXAbWAfWgx+CzWAb+An4KfgFeAzsYWWfYuFz4CXwGvgb+Dfo6yNkEEwGh4CZYB44FpwI3g1OY+kfBItZOo2fB84Hy8DF4HJwNbiWpV8PVoO1LH4n2NRXyN+KcAd4kNVP9XsY4aPgcfAbsBfs6SniL4K/sPjfEf6HlanXCRkCw2BGvUh/keWfXS/CY+pFXs7x9XHmM94LTmWIeU2cgbxnS/k/B3kf86jDhU8L9V2E40vAFWAlWFUfb++NOL4F3C7JX4/4GiE+hvgWsF0oS7mXldspnN+F493gyXrh9xTav0cg3EvzgVfBG6wsmVSEkxBOBgdPGpd7JI6PnqRvJ68/xlbHof53gPeA94OzwLngk+ACsAwsByvASrAK3MB0Ws3CtQjvBJvAVrADPMDSHkb4CNijaccTwvnf4fiPEs8Lxy+D18A/QU8/xjgYBjPAbDAKTgYLwOngTHAO+EQ/8wuEF4EvsPiVCFf2+9tsFStzA8LVHuXXBsi6QyqzUYiPMR/7Mc7dAx7oL8bzw/3u/Bw8Bp4Az4AXwCtgHzsmDXP5fiF9iiVvly5d0sHngar16NKlS5cuXbp06fLmYlqHXrcd3ph4P0THUY3iXh49novju4S0tzfs5d+JPKewfAsRntZb3K9ZhOMlrO6lCC8An28U9+OuovcPcPxlVu5rCL/VmHh/iHIrzn3fIPu7SN8Axmg+8AOwEWwCm7tp3bRuWjetm5Y8bSu4B9zbKO6ZVsnORrVU3f4uXTqZ2H3sLoyx3eDXjfDndE9qyj6L838CfwVvgFpzYnof4oNgOhgBc8Fos9DrZIQLmtXPP1MmF6wGj4H+KXoWguvADkXaPil+YpuQy8Am8Ey7ODdtmJDF4HowBp4De6HDTNjhfHAHeBr0DBBy0kDxfPbcgSIusgrcWhtnJ8vL+TPix7UIOQtcBq4C28Cr4KRBnANbwSuDE+s50JgyNNFuXbp06XIgsXjIvPafjvXozKY+fVFz/z0LT1uCtKVSWbrOLWPnztG8e0Xfy7ol8XtZJi7WtG+5od2UFXQ/A12vUeS7jp27yVKHjdsU9lXB869TyNvAzt0lpP2oWbwLdjiO78bx/Sz+EMJHwK9Y/LcIfw+eZ3F67/Hl5vh9xX80J+rwX8SvRDhpgL17iPAQMHNArfPrqHPewLheI+AERV6efwV418B4nOZ/H+IfYHV8GOF5LJ3eAz0fx8sM9S0fUNud39O9CulfGZhY5huI3wzWgNvBelbHZoTbNPVpfYjKQpkHwUNgl0LWblbnk0LbbDxr0OMFpL3iqWdu9nWYPlVAWkXY39LnGdCkDbeqv1YNbfcMQ3t9oe8lzm6NH9N1ZB6Ln4BwfkJZJk7RyFnYKt6b/JDQXx9p5X+eFdqOjzM9P9MB/lUlFzr20aXIdzlY4dmn9F3YqtvoO76/2hp/D/xA5Zue88nNyL8GbFbs075X0tyUig3Qd2MCnf//HjnzpbsR3g9+1kHzzVjdnE71/qVBX9rGPUh/ysNWe1neFzvIDi5zAufV1sT0N0poR22wkFUfTOPfA4N2mbZ5fSrqOHSw+IbkSBbOGSzSRgf91/GTUWYBOB2cIZQ/G8cfBZ8CFwrnL8XxF8FKcA24jqXdiPA7Qr61OF7H4mMItwzuv2/YLth1ISt3Hzu3k4W7EH5JqPdRHD/O4k+z8A8IX5Lq3y7Z4nXE9xn6kX6vQ4bKfy+ok+hH+xf3hq9dnTTHhjKd2GmDuWA242iHMq4cC7A8kJ7i8o1+skSa7Jieo38HCWnoNjKFhdSFBxzpZ7QE6lI8N4S14aASZcryaV/WWHw66f6NHuCoxuQxmvM56GX9QMd8Q4D65ywGP+ZzRJuM+zQvx/MOS2VFeqQ4IXnH26zM9Xe6/E6D+4foAzzuajPZp8Qyw5ayZVDWuH0z0BtYRkeIDqH9KO9VbH1btd/lhNqCzvl8zeLnG0S/hnU6baHfpiuO6yy0rd+DHURo/zYF5H26j03rQsip2ndzz82u1z9N4VjWKWeb68Tedpt95HRVXp7H1R6p+/Wt4FPy/PpWwscOLRJ+PVWF/+W0iVyGzs18TIvXkOJ1Wxm66vSXz+vylenrZcj1ub439W+K8RNCGTJi2p/TJ1K23VaXr35tRpnzmjxequgfcfyk6B/TGBVlyedsNgpdd/h+W1U3P99QyFPNo1X3TwpM/WLTIWYfoBqXrv6iskHZ/RFr79R6hIyHBrH3f1nrUVnjP8SnZZ+rYtzr9Exld5MNbPNErusAPg+77u/eDOPftU9yj39TH7rezxd1LvsZQJlzkWlOirG/79zjMj/mtHUKu7vKy+3/LnXr9okyKedjX5/0He9iP/j63LwOQdarEVlfy8OO/Lqw023j6xcqmwxLiOd6heM2i9cV9LJy8jMJ23yQ+rpbfu7EQ/pXE8KYvUSqvVnb4XzZa6LrHMXHR+zcLvqWbm/Bn0/HzIs6fWPHoat8XfnDKmZGxRxeMbn2UqZ5Q94nmcZRbqqUXbZ8+lcjE+cPX11t814orvvAXNcG8vqj2vvk1MGn3anlj0bIT72v47bvE+Lc98T9b6r7AKn6j+8Duf7D0nnZx/j7Zjn0j9nbpSTndaLr9WNLivP+iN23xF7L+fqv6ZouFyb78jxVXvv5jJ9YUs9/sddO8h7KNg5jrhfaJGztT6G7KF+1d6yCmD5Kdb2fan60rSc552fZr3zeQ9DpnPp+Si5cx5Ktv2QfSzF/mMbWdOm46rFI4XstnU9xeqX4NKb7TKEdcr6pZOK3ID1k/LvFHkVczEuZLEDr499YqvqBym1aEHWgcvoYOtv0M91qQl5TfpO/in6rWx8OVpT1Wedkv3f5xom3T/xeR/6Gx6V86PWAOB4bBpqWdN+yTcVxjIyGRz/FrDGu6w/3d7kPm8StX8RyPu+uuvpNju/vTLJV37GpvoM0oZPnW87VLnL/5pDno1NoW1R6yedU6TyUv3u19a3KFnIbTLYz+ZCLP4T0tU1uivFgso0pnsJ/UtXvarNY28Xq5cvkBDrQP/E5ZaiuQwwfmTlsOiQRU1fMuqrDd/3ISSuwjOwXOfTyGUMpZIXq4GpLn3pUcdfzch2x7XO1u2uZHOPb1G6b3Xg9PH1IIWeEpJlPQtqos2EKW8b0u8rnuP1UeVLoXJb9be0uG9nnbchjU+XTszT5VeNBThPHnc5OKj1U9aj0GTHIVaGy1YhEWT4ixns00DT+XEzWn/7VAsIc63Cov3OdyhwjrnaqQqZvWKXdypRdlq+k8msZ031U+Rm4fA+3TtyeR9hwfW9G9yxDN0fZMN33F+9TE6md4hwoxumfaUzI9fN3PFT3xVV2msrQ3UsnChm6Nulk8TndpS28D3zX9tTIPsF/z7Am5OkTjm1tI1JZW74+4VgsZ0N3L1yXV3WeP5uR7TGHHdvC3JQlxybfpd22tDlk/2eofRK8TzrN/qnar/K/OUTth6I/+jAnEptNbPvFHP2gs40N3+dfMWtwqvVct7/wfd8gtQ7imifial9ZJ9/3IHLYU6eDj3+4PhsNhX+vwvcWLnu6kGfEMe8DuciPfUfGZB8X/7HJy/Gefe5n+VRGFd/wyP2ta7/LO4yh/sbLV/k9lev6kfO9Dt/5U67b1/6u/epqB1U9Me23jfHY9sscAg4tkbLl+e4/U36rJ9ddxfd6sg5vq5ice42Wpk/pb9FOJ36/W9tpv4kbC79nUbZceX8Zu6/qJ+P3WvhvA8v3reh7Jbn2d6rrNC7XNZTLma4Ba0JI9efX2uLzF5scG/w9UNU1ZxW+ymUfzELeTllXlQ1rUuhzjS5fp9c964iFBOqeSz63bU065nZKdU+mDEz3qHIjjifquw0pnb/raRtvrnsYcb46ihT3taoYz6brdNW9l6rWRnE/navdPn1XlR1km7hcz1WlH/elKuSOSvLLuE8U6m8uzwRdfcGl73VyTHuyMvzJ1Sa2cWDTP/Z63Kc94n2B1PYr24dz1JlyHLlcP+S4B6vD1c9EW4q2LWstCvUjeVy63k/LMYdUNd5D1xQfvVTzX1VjkMsUv88N8VH5fReVn/Fjn++/h6X6Q8a6b1/q3g/i/ewi0/Scs8zxXeV6mWIOUPlPzBgdFerW+bZrm2P18dnjuK6HunEp+rHvPMXbr+sHVb/lnL+pTP57jPw9Cvk3PW178JD9qChfzuvTf7Htl38L1QUf/VKu9SFjwWbTWPvFEvu7Uq76y7+31g6QlYPc669pbsm9Xur2LWI9Pu8ypfDXqm3A2z8s1FWGn4ntL9NfQu2oSlftX9uetvTtv7J8Ql4zxfXGZ3zk8PeQ9w59x2uMfqI8/q5eKh/l9cb2rwsu9rSNl06ZP2Pmxtz+rNMx93yno0n2/82rVH7rQ+y9P15H6FyRun9ViH81ATmffI7nJ5r8uXXW6enbP6b/B8/l5OifVHYLnb9S39s2zcc+Ph+rh8+eQgVPS72elzGWY/tUtbbabBpDiI7yN1q6/4th2y+ErAc5+9BVvu/7KamJbWNZeuqI/R4tRf+YyD1HmOZM1bMV3/14Sn10c0Xu+Sj1nOXb5jL73ncdy02uvlXZNde65dOHYl7Vs4KYuS6FzWLn2zJlpZqPXPVPOa5yzKOyn1VhT9lmMfdbfH7D11Wf2PXN5h9y+dD287+qxgSnaYmnIrRtIb8pJe6/Uv9OVer6Whn0zfGO/BEloZI9ojmfAlUflClDd178bTmVHVTpZXOkAlk/lb42UujmI89HH5V+cl7XtowY6vTxLVWok6UrGzoGTHN+bB+6ri05687VNpvfuvRfaP2uMlNQth1D5JjGelm/8yn+9p3p/7qk9gnfeddXZmq/Sm333PJT659Kv1zjNbZ9uv2Oi//67CV8/N1nj1DmviyXDNVeJkaeaX8UsyesYg8cu2+NvdaPfb+lLDu5tvt/"),a=new t(s),l=5,d=12,c=13,y=16,m=17,O=22,D=28,z=31,w=33,N=34,H=35,X=36,ae=37,oe=38,ue=39,fe=40,be=41,Ae=42,W=0,J=1,Ue=2,gt=3,Te=4,Et=[[Te,Te,Te,Te,Te,Te,Te,Te,Te,Te,Te,Te,Te,Te,Te,Te,Te,Te,Te,Te,Te,gt,Te,Te,Te,Te,Te,Te,Te,Te,Te,Te,Te],[W,Te,Te,J,J,Te,Te,Te,Te,J,J,W,W,W,W,J,J,J,W,W,Te,Ue,Te,W,W,W,W,W,W,W,W,J,W],[W,Te,Te,J,J,Te,Te,Te,Te,J,J,J,J,J,W,J,J,J,W,W,Te,Ue,Te,W,W,W,W,W,W,W,W,J,W],[Te,Te,Te,J,J,J,Te,Te,Te,J,J,J,J,J,J,J,J,J,J,J,Te,Ue,Te,J,J,J,J,J,J,J,J,J,J],[J,Te,Te,J,J,J,Te,Te,Te,J,J,J,J,J,J,J,J,J,J,J,Te,Ue,Te,J,J,J,J,J,J,J,J,J,J],[W,Te,Te,J,J,J,Te,Te,Te,W,W,W,W,W,W,J,J,J,W,W,Te,Ue,Te,W,W,W,W,W,W,W,W,J,W],[W,Te,Te,J,J,J,Te,Te,Te,W,W,W,W,W,W,J,J,J,W,W,Te,Ue,Te,W,W,W,W,W,W,W,W,J,W],[W,Te,Te,J,J,J,Te,Te,Te,W,W,J,W,J,W,J,J,J,W,W,Te,Ue,Te,W,W,W,W,W,W,W,W,J,W],[W,Te,Te,J,J,J,Te,Te,Te,W,W,J,J,J,W,J,J,J,W,W,Te,Ue,Te,W,W,W,W,W,W,W,W,J,W],[J,Te,Te,J,J,J,Te,Te,Te,W,W,J,J,J,J,J,J,J,W,W,Te,Ue,Te,J,J,J,J,J,W,J,J,J,W],[J,Te,Te,J,J,J,Te,Te,Te,W,W,J,J,J,W,J,J,J,W,W,Te,Ue,Te,W,W,W,W,W,W,W,W,J,W],[J,Te,Te,J,J,J,Te,Te,Te,J,J,J,J,J,W,J,J,J,W,W,Te,Ue,Te,W,W,W,W,W,W,W,W,J,W],[J,Te,Te,J,J,J,Te,Te,Te,J,J,J,J,J,W,J,J,J,W,W,Te,Ue,Te,W,W,W,W,W,W,W,W,J,W],[J,Te,Te,J,J,J,Te,Te,Te,J,J,J,J,J,W,J,J,J,W,W,Te,Ue,Te,W,W,W,W,W,W,W,W,J,W],[W,Te,Te,J,J,J,Te,Te,Te,W,J,W,W,W,W,J,J,J,W,W,Te,Ue,Te,W,W,W,W,W,W,W,W,J,W],[W,Te,Te,J,J,J,Te,Te,Te,W,W,W,W,W,W,J,J,J,W,W,Te,Ue,Te,W,W,W,W,W,W,W,W,J,W],[W,Te,Te,J,W,J,Te,Te,Te,W,W,J,W,W,W,J,J,J,W,W,Te,Ue,Te,W,W,W,W,W,W,W,W,J,W],[W,Te,Te,J,W,J,Te,Te,Te,W,W,W,W,W,W,J,J,J,W,W,Te,Ue,Te,W,W,W,W,W,W,W,W,J,W],[J,Te,Te,J,J,J,Te,Te,Te,J,J,J,J,J,J,J,J,J,J,J,Te,Ue,Te,J,J,J,J,J,J,J,J,J,W],[W,Te,Te,J,J,J,Te,Te,Te,W,W,W,W,W,W,J,J,J,W,Te,Te,Ue,Te,W,W,W,W,W,W,W,W,J,W],[W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,W,Te,W,W,W,W,W,W,W,W,W,W,W,W],[J,Te,Te,J,J,J,Te,Te,Te,J,J,J,J,J,W,J,J,J,W,W,Te,Ue,Te,W,W,W,W,W,W,W,W,J,W],[J,Te,Te,J,J,J,Te,Te,Te,J,J,J,J,J,J,J,J,J,J,J,Te,Ue,Te,J,J,J,J,J,J,J,J,J,J],[W,Te,Te,J,J,J,Te,Te,Te,W,J,W,W,W,W,J,J,J,W,W,Te,Ue,Te,W,W,W,J,J,W,W,W,J,W],[W,Te,Te,J,J,J,Te,Te,Te,W,J,W,W,W,W,J,J,J,W,W,Te,Ue,Te,W,W,W,W,J,W,W,W,J,W],[W,Te,Te,J,J,J,Te,Te,Te,W,J,W,W,W,W,J,J,J,W,W,Te,Ue,Te,J,J,J,J,W,W,W,W,J,W],[W,Te,Te,J,J,J,Te,Te,Te,W,J,W,W,W,W,J,J,J,W,W,Te,Ue,Te,W,W,W,J,J,W,W,W,J,W],[W,Te,Te,J,J,J,Te,Te,Te,W,J,W,W,W,W,J,J,J,W,W,Te,Ue,Te,W,W,W,W,J,W,W,W,J,W],[W,Te,Te,J,J,J,Te,Te,Te,W,W,W,W,W,W,J,J,J,W,W,Te,Ue,Te,W,W,W,W,W,J,W,W,J,W],[W,Te,Te,J,J,J,Te,Te,Te,W,J,W,W,W,W,J,J,J,W,W,Te,Ue,Te,W,W,W,W,W,W,W,J,J,W],[W,Te,Te,J,J,J,Te,Te,Te,W,J,W,W,W,W,J,J,J,W,W,Te,Ue,Te,W,W,W,W,W,W,W,W,J,W],[J,Te,Te,J,J,J,Te,Te,Te,J,J,J,J,J,W,J,J,J,W,W,Te,Ue,Te,W,W,W,W,W,W,W,W,J,W],[W,Te,Te,J,J,W,Te,Te,Te,W,W,W,W,W,W,W,W,W,W,W,Te,Ue,Te,W,W,W,W,W,W,W,W,J,W]],Bt=function(dt){switch(dt){case w:return d;case ue:case fe:case Ae:return d;case H:return l;default:return dt}},Ke=function(dt){switch(dt){case ae:case oe:return N;case be:return O;default:return dt}};class At{constructor(Mt,zt=!1){this.position=Mt,this.required=zt}}class nt{constructor(Mt){this.string=Mt,this.pos=0,this.lastPos=0,this.curClass=null,this.nextClass=null,this.LB8a=!1,this.LB21a=!1,this.LB30a=0}nextCodePoint(){const Mt=this.string.charCodeAt(this.pos++),zt=this.string.charCodeAt(this.pos);return 55296<=Mt&&Mt<=56319&&56320<=zt&&zt<=57343?(this.pos++,(Mt-55296)*1024+(zt-56320)+65536):Mt}nextCharClass(){return Bt(a.get(this.nextCodePoint()))}getSimpleBreak(){switch(this.nextClass){case be:return!1;case N:case ae:case oe:return this.curClass=N,!1;case X:return this.curClass=X,!1}return null}getPairTableBreak(Mt){let zt=!1;switch(Et[this.curClass][this.nextClass]){case W:zt=!0;break;case J:zt=Mt===be;break;case Ue:if(zt=Mt===be,!zt)return zt=!1,zt;break;case gt:if(Mt!==be)return zt;break}return this.LB8a&&(zt=!1),this.LB21a&&(this.curClass===y||this.curClass===m)?(zt=!1,this.LB21a=!1):this.LB21a=this.curClass===c,this.curClass===D?(this.LB30a++,this.LB30a==2&&this.nextClass===D&&(zt=!0,this.LB30a=0)):this.LB30a=0,this.curClass=this.nextClass,zt}nextBreak(){if(this.curClass==null){let Mt=this.nextCharClass();this.curClass=Ke(Mt),this.nextClass=Mt,this.LB8a=Mt===z,this.LB30a=0}for(;this.pos<this.string.length;){this.lastPos=this.pos;const Mt=this.nextClass;if(this.nextClass=this.nextCharClass(),this.curClass===N||this.curClass===X&&this.nextClass!==ae)return this.curClass=Ke(Bt(this.nextClass)),new At(this.lastPos,!0);let zt=this.getSimpleBreak();if(zt===null&&(zt=this.getPairTableBreak(Mt)),this.LB8a=this.nextClass===z,zt)return new At(this.lastPos)}return this.lastPos<this.string.length?(this.lastPos=this.string.length,new At(this.string.length)):null}}return nt})();class FlatQueue{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(e,t){let n=this.length++;for(this.ids[n]=e,this.values[n]=t;n>0;){const r=n-1>>1,s=this.values[r];if(t>=s)break;this.ids[n]=this.ids[r],this.values[n]=s,n=r}this.ids[n]=e,this.values[n]=t}pop(){if(this.length===0)return;const e=this.ids[0];if(this.length--,this.length>0){const t=this.ids[0]=this.ids[this.length],n=this.values[0]=this.values[this.length],r=this.length>>1;let s=0;for(;s<r;){let a=(s<<1)+1;const l=a+1;let d=this.ids[a],c=this.values[a];const y=this.values[l];if(l<this.length&&y<c&&(a=l,d=this.ids[l],c=y),c>=n)break;this.ids[s]=d,this.values[s]=c,s=a}this.ids[s]=t,this.values[s]=n}return e}peek(){if(this.length!==0)return this.ids[0]}peekValue(){if(this.length!==0)return this.values[0]}}window.FlatQueue=FlatQueue;var paperJs0_12_17={exports:{}};/*!
 * Paper.js v0.12.17 - The Swiss Army Knife of Vector Graphics Scripting.
 * http://paperjs.org/
 *
 * Copyright (c) 2011 - 2020, Jürg Lehni & Jonathan Puckey
 * http://juerglehni.com/ & https://puckey.studio/
 *
 * Distributed under the MIT license. See LICENSE file for details.
 *
 * All rights reserved.
 *
 * Date: Thu Nov 3 21:15:36 2022 +0100
 *
 ***
 *
 * Straps.js - Class inheritance library with support for bean-style accessors
 *
 * Copyright (c) 2006 - 2020 Jürg Lehni
 * http://juerglehni.com/
 *
 * Distributed under the MIT license.
 *
 ***
 *
 * Acorn.js
 * https://marijnhaverbeke.nl/acorn/
 *
 * Acorn is a tiny, fast JavaScript parser written in JavaScript,
 * created by Marijn Haverbeke and released under an MIT license.
 *
 */(function(o){(function(e,t){e=e||n.self;var n=e.window,r=e.document,s=new function(){var h=/^(statics|enumerable|beans|preserve)$/,f=[],b=f.slice,L=Object.create,I=Object.getOwnPropertyDescriptor,B=Object.defineProperty,j=f.forEach||function(de,le){for(var we=0,Ve=this.length;we<Ve;we++)de.call(le,this[we],we,this)},Y=function(de,le){for(var we in this)this.hasOwnProperty(we)&&de.call(le,this[we],we,this)},Z=Object.assign||function(de){for(var le=1,we=arguments.length;le<we;le++){var Ve=arguments[le];for(var ke in Ve)Ve.hasOwnProperty(ke)&&(de[ke]=Ve[ke])}return de},ie=function(de,le,we){if(de){var Ve=I(de,"length");(Ve&&typeof Ve.value=="number"?j:Y).call(de,le,we=we||de)}return we};function pe(de,le,we,Ve,ke){var ye={};function xe(ze,Ge){Ge=Ge||(Ge=I(le,ze))&&(Ge.get?Ge:Ge.value),typeof Ge=="string"&&Ge[0]==="#"&&(Ge=de[Ge.substring(1)]||Ge);var We=typeof Ge=="function",je=Ge,rt=ke||We&&!Ge.base?Ge&&Ge.get?ze in de:de[ze]:null,Je;(!ke||!rt)&&(We&&rt&&(Ge.base=rt),We&&Ve!==!1&&(Je=ze.match(/^([gs]et|is)(([A-Z])(.*))$/))&&(ye[Je[3].toLowerCase()+Je[4]]=Je[2]),(!je||We||!je.get||typeof je.get!="function"||!me.isPlainObject(je))&&(je={value:je,writable:!0}),(I(de,ze)||{configurable:!0}).configurable&&(je.configurable=!0,je.enumerable=we??!Je),B(de,ze,je))}if(le){for(var ce in le)le.hasOwnProperty(ce)&&!h.test(ce)&&xe(ce);for(var ce in ye){var Se=ye[ce],Ie=de["set"+Se],Me=de["get"+Se]||Ie&&de["is"+Se];Me&&(Ve===!0||Me.length===0)&&xe(ce,{get:Me,set:Ie})}}return de}function me(){for(var de=0,le=arguments.length;de<le;de++){var we=arguments[de];we&&Z(this,we)}return this}return pe(me,{inject:function(de){if(de){var le=de.statics===!0?de:de.statics,we=de.beans,Ve=de.preserve;le!==de&&pe(this.prototype,de,de.enumerable,we,Ve),pe(this,le,null,we,Ve)}for(var ke=1,ye=arguments.length;ke<ye;ke++)this.inject(arguments[ke]);return this},extend:function(){for(var de=this,le,we,Ve=0,ke,ye=arguments.length;Ve<ye&&!(le&&we);Ve++)ke=arguments[Ve],le=le||ke.initialize,we=we||ke.prototype;return le=le||function(){de.apply(this,arguments)},we=le.prototype=we||L(this.prototype),B(we,"constructor",{value:le,writable:!0,configurable:!0}),pe(le,this),arguments.length&&this.inject.apply(le,arguments),le.base=de,le}}).inject({enumerable:!1,initialize:me,set:me,inject:function(){for(var de=0,le=arguments.length;de<le;de++){var we=arguments[de];we&&pe(this,we,we.enumerable,we.beans,we.preserve)}return this},extend:function(){var de=L(this);return de.inject.apply(de,arguments)},each:function(de,le){return ie(this,de,le)},clone:function(){return new this.constructor(this)},statics:{set:Z,each:ie,create:L,define:B,describe:I,clone:function(de){return Z(new de.constructor,de)},isPlainObject:function(de){var le=de!=null&&de.constructor;return le&&(le===Object||le===me||le.name==="Object")},pick:function(de,le){return de!==t?de:le},slice:function(de,le,we){return b.call(de,le,we)}}})};n.paper=s,s.inject({enumerable:!1,toString:function(){return this._id!=null?(this._class||"Object")+(this._name?" '"+this._name+"'":" @"+this._id):"{ "+s.each(this,function(h,f){if(!/^_/.test(f)){var b=typeof h;this.push(f+": "+(b==="number"?y.instance.number(h):b==="string"?"'"+h+"'":h))}},[]).join(", ")+" }"},getClassName:function(){return this._class||""},importJSON:function(h){return s.importJSON(h,this)},exportJSON:function(h){return s.exportJSON(this,h)},toJSON:function(){return s.serialize(this)},set:function(h,f){return h&&s.filter(this,h,f,this._prioritize),this}},{beans:!1,statics:{exports:{},extend:function h(){var f=h.base.apply(this,arguments),b=f.prototype._class;return b&&!s.exports[b]&&(s.exports[b]=f),f},equals:function(h,f){if(h===f)return!0;if(h&&h.equals)return h.equals(f);if(f&&f.equals)return f.equals(h);if(h&&f&&typeof h=="object"&&typeof f=="object"){if(Array.isArray(h)&&Array.isArray(f)){var b=h.length;if(b!==f.length)return!1;for(;b--;)if(!s.equals(h[b],f[b]))return!1}else{var L=Object.keys(h),b=L.length;if(b!==Object.keys(f).length)return!1;for(;b--;){var I=L[b];if(!(f.hasOwnProperty(I)&&s.equals(h[I],f[I])))return!1}}return!0}return!1},read:function(h,f,b,L){if(this===s){var I=this.peek(h,f);return h.__index++,I}var B=this.prototype,j=B._readIndex,Y=f||j&&h.__index||0,Z=h.length,ie=h[Y];if(L=L||Z-Y,ie instanceof this||b&&b.readNull&&ie==null&&L<=1)return j&&(h.__index=Y+1),ie&&b&&b.clone?ie.clone():ie;if(ie=s.create(B),j&&(ie.__read=!0),ie=ie.initialize.apply(ie,Y>0||Y+L<Z?s.slice(h,Y,Y+L):h)||ie,j){h.__index=Y+ie.__read;var pe=ie.__filtered;pe&&(h.__filtered=pe,ie.__filtered=t),ie.__read=t}return ie},peek:function(h,f){return h[h.__index=f||h.__index||0]},remain:function(h){return h.length-(h.__index||0)},readList:function(h,f,b,L){for(var I=[],B,j=f||0,Y=L?j+L:h.length,Z=j;Z<Y;Z++)I.push(Array.isArray(B=h[Z])?this.read(B,0,b):this.read(h,Z,b,1));return I},readNamed:function(h,f,b,L,I){var B=this.getNamed(h,f),j=B!==t;if(j){var Y=h.__filtered;if(!Y){var Z=this.getSource(h);Y=h.__filtered=s.create(Z),Y.__unfiltered=Z}Y[f]=t}return this.read(j?[B]:h,b,L,I)},readSupported:function(h,f){var b=this.getSource(h),L=this,I=!1;return b&&Object.keys(b).forEach(function(B){if(B in f){var j=L.readNamed(h,B);j!==t&&(f[B]=j),I=!0}}),I},getSource:function(h){var f=h.__source;if(f===t){var b=h.length===1&&h[0];f=h.__source=b&&s.isPlainObject(b)?b:null}return f},getNamed:function(h,f){var b=this.getSource(h);if(b)return f?b[f]:h.__filtered||b},hasNamed:function(h,f){return!!this.getNamed(h,f)},filter:function(h,f,b,L){var I;function B(pe){if(!(b&&pe in b)&&!(I&&pe in I)){var me=f[pe];me!==t&&(h[pe]=me)}}if(L){for(var j={},Y=0,Z,ie=L.length;Y<ie;Y++)(Z=L[Y])in f&&(B(Z),j[Z]=!0);I=j}return Object.keys(f.__unfiltered||f).forEach(B),h},isPlainValue:function(h,f){return s.isPlainObject(h)||Array.isArray(h)||f&&typeof h=="string"},serialize:function(h,f,b,L){f=f||{};var I=!L,B;if(I&&(f.formatter=new y(f.precision),L={length:0,definitions:{},references:{},add:function(me,de){var le="#"+me._id,we=this.references[le];if(!we){this.length++;var Ve=de.call(me),ke=me._class;ke&&Ve[0]!==ke&&Ve.unshift(ke),this.definitions[le]=Ve,we=this.references[le]=[le]}return we}}),h&&h._serialize){B=h._serialize(f,L);var j=h._class;j&&!h._compactSerialize&&(I||!b)&&B[0]!==j&&B.unshift(j)}else if(Array.isArray(h)){B=[];for(var Y=0,Z=h.length;Y<Z;Y++)B[Y]=s.serialize(h[Y],f,b,L)}else if(s.isPlainObject(h)){B={};for(var ie=Object.keys(h),Y=0,Z=ie.length;Y<Z;Y++){var pe=ie[Y];B[pe]=s.serialize(h[pe],f,b,L)}}else typeof h=="number"?B=f.formatter.number(h,f.precision):B=h;return I&&L.length>0?[["dictionary",L.definitions],B]:B},deserialize:function(h,f,b,L,I){var B=h,j=!b,Y=j&&h&&h.length&&h[0][0]==="dictionary";if(b=b||{},Array.isArray(h)){var Z=h[0],ie=Z==="dictionary";if(h.length==1&&/^#/.test(Z))return b.dictionary[Z];Z=s.exports[Z],B=[];for(var pe=Z?1:0,me=h.length;pe<me;pe++)B.push(s.deserialize(h[pe],f,b,ie,Y));if(Z){var de=B;f?B=f(Z,de,j||I):B=new Z(de)}}else if(s.isPlainObject(h)){B={},L&&(b.dictionary=B);for(var le in h)B[le]=s.deserialize(h[le],f,b)}return Y?B[1]:B},exportJSON:function(h,f){var b=s.serialize(h,f);return f&&f.asString==!1?b:JSON.stringify(b)},importJSON:function(h,f){return s.deserialize(typeof h=="string"?JSON.parse(h):h,function(b,L,I){var B=I&&f&&f.constructor===b,j=B?f:s.create(b.prototype);if(L.length===1&&j instanceof fe&&(B||!(j instanceof Ae))){var Y=L[0];s.isPlainObject(Y)&&(Y.insert=!1,B&&(L=L.concat([fe.INSERT])))}return(B?j.set:b).apply(j,L),B&&(f=null),j})},push:function(h,f){var b=f.length;if(b<4096)h.push.apply(h,f);else{var L=h.length;h.length+=b;for(var I=0;I<b;I++)h[L+I]=f[I]}return h},splice:function(h,f,b,L){var I=f&&f.length,B=b===t;b=B?h.length:b,b>h.length&&(b=h.length);for(var j=0;j<I;j++)f[j]._index=b+j;if(B)return s.push(h,f),[];var Y=[b,L];f&&s.push(Y,f);for(var Z=h.splice.apply(h,Y),j=0,ie=Z.length;j<ie;j++)Z[j]._index=t;for(var j=b+I,ie=h.length;j<ie;j++)h[j]._index=j;return Z},capitalize:function(h){return h.replace(/\b[a-z]/g,function(f){return f.toUpperCase()})},camelize:function(h){return h.replace(/-(.)/g,function(f,b){return b.toUpperCase()})},hyphenate:function(h){return h.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var a={on:function(h,f){if(typeof h!="string")s.each(h,function(B,j){this.on(j,B)},this);else{var b=this._eventTypes,L=b&&b[h],I=this._callbacks=this._callbacks||{};I=I[h]=I[h]||[],I.indexOf(f)===-1&&(I.push(f),L&&L.install&&I.length===1&&L.install.call(this,h))}return this},off:function(h,f){if(typeof h!="string"){s.each(h,function(j,Y){this.off(Y,j)},this);return}var b=this._eventTypes,L=b&&b[h],I=this._callbacks&&this._callbacks[h],B;return I&&(!f||(B=I.indexOf(f))!==-1&&I.length===1?(L&&L.uninstall&&L.uninstall.call(this,h),delete this._callbacks[h]):B!==-1&&I.splice(B,1)),this},once:function(h,f){return this.on(h,function b(){f.apply(this,arguments),this.off(h,b)})},emit:function(h,f){var b=this._callbacks&&this._callbacks[h];if(!b)return!1;var L=s.slice(arguments,1),I=f&&f.target&&!f.currentTarget;b=b.slice(),I&&(f.currentTarget=this);for(var B=0,j=b.length;B<j;B++)if(b[B].apply(this,L)==!1){f&&f.stop&&f.stop();break}return I&&delete f.currentTarget,!0},responds:function(h){return!!(this._callbacks&&this._callbacks[h])},attach:"#on",detach:"#off",fire:"#emit",_installEvents:function(h){var f=this._eventTypes,b=this._callbacks,L=h?"install":"uninstall";if(f){for(var I in b)if(b[I].length>0){var B=f[I],j=B&&B[L];j&&j.call(this,I)}}},statics:{inject:function h(f){var b=f._events;if(b){var L={};s.each(b,function(I,B){var j=typeof I=="string",Y=j?I:B,Z=s.capitalize(Y),ie=Y.substring(2).toLowerCase();L[ie]=j?{}:I,Y="_"+Y,f["get"+Z]=function(){return this[Y]},f["set"+Z]=function(pe){var me=this[Y];me&&this.off(ie,me),pe&&this.on(ie,pe),this[Y]=pe}}),f._eventTypes=L}return h.base.apply(this,arguments)}}},l=s.extend({_class:"PaperScope",initialize:function h(){ct=this,this.settings=new s({applyMatrix:!0,insertItems:!0,handleSize:4,hitTolerance:0}),this.project=null,this.projects=[],this.tools=[],this._id=h._id++,h._scopes[this._id]=this;var f=h.prototype;if(!this.support){var b=Xe.getContext(1,1)||{};f.support={nativeDash:"setLineDash"in b||"mozDash"in b,nativeBlendModes:Pe.nativeModes},Xe.release(b)}if(!this.agent){var L=e.navigator.userAgent.toLowerCase(),I=(/(darwin|win|mac|linux|freebsd|sunos)/.exec(L)||[])[0],B=I==="darwin"?"mac":I,j=f.agent=f.browser={platform:B};B&&(j[B]=!0),L.replace(/(opera|chrome|safari|webkit|firefox|msie|trident|atom|node|jsdom)\/?\s*([.\d]+)(?:.*version\/([.\d]+))?(?:.*rv\:v?([.\d]+))?/g,function(Y,Z,ie,pe,me){if(!j.chrome){var de=Z==="opera"?pe:/^(node|trident)$/.test(Z)?me:ie;j.version=de,j.versionNumber=parseFloat(de),Z={trident:"msie",jsdom:"node"}[Z]||Z,j.name=Z,j[Z]=!0}}),j.chrome&&delete j.webkit,j.atom&&delete j.chrome}},version:"0.12.17",getView:function(){var h=this.project;return h&&h._view},getPaper:function(){return this},execute:function(h,f){},install:function(h){var f=this;s.each(["project","view","tool"],function(L){s.define(h,L,{configurable:!0,get:function(){return f[L]}})});for(var b in this)!/^_/.test(b)&&this[b]&&(h[b]=this[b])},setup:function(h){return ct=this,this.project=new ue(h),this},createCanvas:function(h,f){return Xe.getCanvas(h,f)},activate:function(){ct=this},clear:function(){for(var h=this.projects,f=this.tools,b=h.length-1;b>=0;b--)h[b].remove();for(var b=f.length-1;b>=0;b--)f[b].remove()},remove:function(){this.clear(),delete l._scopes[this._id]},statics:new function(){function h(f){return f+="Attribute",function(b,L){return b[f](L)||b[f]("data-paper-"+L)}}return{_scopes:{},_id:0,get:function(f){return this._scopes[f]||null},getAttribute:h("get"),hasAttribute:h("has")}}}),d=s.extend(a,{initialize:function(h){this._scope=ct,this._index=this._scope[this._list].push(this)-1,(h||!this._scope[this._reference])&&this.activate()},activate:function(){if(!this._scope)return!1;var h=this._scope[this._reference];return h&&h!==this&&h.emit("deactivate"),this._scope[this._reference]=this,this.emit("activate",h),!0},isActive:function(){return this._scope[this._reference]===this},remove:function(){return this._index==null?!1:(s.splice(this._scope[this._list],null,this._index,1),this._scope[this._reference]==this&&(this._scope[this._reference]=null),this._scope=null,!0)},getView:function(){return this._scope.getView()}}),c={findItemBoundsCollisions:function(h,f,b){function L(j){for(var Y=new Array(j.length),Z=0;Z<j.length;Z++){var ie=j[Z].getBounds();Y[Z]=[ie.left,ie.top,ie.right,ie.bottom]}return Y}var I=L(h),B=!f||f===h?I:L(f);return this.findBoundsCollisions(I,B,b||0)},findCurveBoundsCollisions:function(h,f,b,L){function I(de){for(var le=Math.min,we=Math.max,Ve=new Array(de.length),ke=0;ke<de.length;ke++){var ye=de[ke];Ve[ke]=[le(ye[0],ye[2],ye[4],ye[6]),le(ye[1],ye[3],ye[5],ye[7]),we(ye[0],ye[2],ye[4],ye[6]),we(ye[1],ye[3],ye[5],ye[7])]}return Ve}var B=I(h),j=!f||f===h?B:I(f);if(L){for(var Y=this.findBoundsCollisions(B,j,b||0,!1,!0),Z=this.findBoundsCollisions(B,j,b||0,!0,!0),ie=[],pe=0,me=Y.length;pe<me;pe++)ie[pe]={hor:Y[pe],ver:Z[pe]};return ie}return this.findBoundsCollisions(B,j,b||0)},findBoundsCollisions:function(h,f,b,L,I){var B=!f||h===f,j=B?h:h.concat(f),Y=h.length,Z=j.length;function ie(ii,Rt,Si){for(var bi=0,_i=ii.length;bi<_i;){var mi=_i+bi>>>1;j[ii[mi]][Rt]<Si?bi=mi+1:_i=mi}return bi-1}for(var pe=L?1:0,me=pe+2,de=L?0:1,le=de+2,we=new Array(Z),Ve=0;Ve<Z;Ve++)we[Ve]=Ve;we.sort(function(ii,Rt){return j[ii][pe]-j[Rt][pe]});for(var ke=[],ye=new Array(Y),Ve=0;Ve<Z;Ve++){var xe=we[Ve],ce=j[xe],Se=B?xe:xe-Y,Ie=xe<Y,Me=B||!Ie,ze=Ie?[]:null;if(ke.length){var Ge=ie(ke,me,ce[pe]-b)+1;if(ke.splice(0,Ge),B&&I){ze=ze.concat(ke);for(var We=0;We<ke.length;We++){var je=ke[We];ye[je].push(Se)}}else for(var rt=ce[le],Je=ce[de],We=0;We<ke.length;We++){var je=ke[We],lt=j[je],ht=je<Y,_t=B||je>=Y;(I||(Ie&&_t||Me&&ht)&&rt>=lt[de]-b&&Je<=lt[le]+b)&&(Ie&&_t&&ze.push(B?je:je-Y),Me&&ht&&ye[je].push(Se))}}if(Ie&&(h===f&&ze.push(xe),ye[xe]=ze),ke.length){var bt=ce[me],Tt=ie(ke,me,bt);ke.splice(Tt+1,0,xe)}else ke.push(xe)}for(var Ve=0;Ve<ye.length;Ve++){var Jt=ye[Ve];Jt&&Jt.sort(function(Rt,Si){return Rt-Si})}return ye}},y=s.extend({initialize:function(h){this.precision=s.pick(h,5),this.multiplier=Math.pow(10,this.precision)},number:function(h){return this.precision<16?Math.round(h*this.multiplier)/this.multiplier:h},pair:function(h,f,b){return this.number(h)+(b||",")+this.number(f)},point:function(h,f){return this.number(h.x)+(f||",")+this.number(h.y)},size:function(h,f){return this.number(h.width)+(f||",")+this.number(h.height)},rectangle:function(h,f){return this.point(h,f)+(f||",")+this.size(h,f)}});y.instance=new y;var m=new function(){var h=[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],f=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]],b=Math.abs,L=Math.sqrt,I=Math.pow,B=Math.log2||function(me){return Math.log(me)*Math.LOG2E},j=1e-12,Y=112e-18;function Z(me,de,le){return me<de?de:me>le?le:me}function ie(me,de,le){function we(Ge){var We=Ge*134217729,je=Ge-We,rt=je+We,Je=Ge-rt;return[rt,Je]}var Ve=de*de-me*le,ke=de*de+me*le;if(b(Ve)*3<ke){var ye=we(me),xe=we(de),ce=we(le),Se=de*de,Ie=xe[0]*xe[0]-Se+2*xe[0]*xe[1]+xe[1]*xe[1],Me=me*le,ze=ye[0]*ce[0]-Me+ye[0]*ce[1]+ye[1]*ce[0]+ye[1]*ce[1];Ve=Se-Me+(Ie-ze)}return Ve}function pe(){var me=Math.max.apply(Math,arguments);return me&&(me<1e-8||me>1e8)?I(2,-Math.round(B(me))):0}return{EPSILON:j,MACHINE_EPSILON:Y,CURVETIME_EPSILON:1e-8,GEOMETRIC_EPSILON:1e-7,TRIGONOMETRIC_EPSILON:1e-8,ANGULAR_EPSILON:1e-5,KAPPA:4*(L(2)-1)/3,isZero:function(me){return me>=-j&&me<=j},isMachineZero:function(me){return me>=-Y&&me<=Y},clamp:Z,integrate:function(me,de,le,we){for(var Ve=h[we-2],ke=f[we-2],ye=(le-de)*.5,xe=ye+de,ce=0,Se=we+1>>1,Ie=we&1?ke[ce++]*me(xe):0;ce<Se;){var Me=ye*Ve[ce];Ie+=ke[ce++]*(me(xe+Me)+me(xe-Me))}return ye*Ie},findRoot:function(me,de,le,we,Ve,ke,ye){for(var xe=0;xe<ke;xe++){var ce=me(le),Se=ce/de(le),Ie=le-Se;if(b(Se)<ye){le=Ie;break}ce>0?(Ve=le,le=Ie<=we?(we+Ve)*.5:Ie):(we=le,le=Ie>=Ve?(we+Ve)*.5:Ie)}return Z(le,we,Ve)},solveQuadratic:function(me,de,le,we,Ve,ke){var ye,xe=1/0;if(b(me)<j){if(b(de)<j)return b(le)<j?-1:0;ye=-le/de}else{de*=-.5;var ce=ie(me,de,le);if(ce&&b(ce)<Y){var Se=pe(b(me),b(de),b(le));Se&&(me*=Se,de*=Se,le*=Se,ce=ie(me,de,le))}if(ce>=-Y){var Ie=ce<0?0:L(ce),Me=de+(de<0?-Ie:Ie);Me===0?(ye=le/me,xe=-ye):(ye=Me/me,xe=le/Me)}}var ze=0,Ge=Ve==null,We=Ve-j,je=ke+j;return isFinite(ye)&&(Ge||ye>We&&ye<je)&&(we[ze++]=Ge?ye:Z(ye,Ve,ke)),xe!==ye&&isFinite(xe)&&(Ge||xe>We&&xe<je)&&(we[ze++]=Ge?xe:Z(xe,Ve,ke)),ze},solveCubic:function(me,de,le,we,Ve,ke,ye){var xe=pe(b(me),b(de),b(le),b(we)),ce,Se,Ie,Me,ze;xe&&(me*=xe,de*=xe,le*=xe,we*=xe);function Ge(Tt){ce=Tt;var Jt=me*ce;Se=Jt+de,Ie=Se*ce+le,Me=(Jt+Se)*ce+Ie,ze=Ie*ce+we}if(b(me)<j)me=de,Se=le,Ie=we,ce=1/0;else if(b(we)<j)Se=de,Ie=le,ce=0;else{Ge(-(de/me)/3);var We=ze/me,je=I(b(We),1/3),rt=We<0?-1:1,Je=-Me/me,lt=Je>0?1.324717957244746*Math.max(je,L(Je)):je,ht=ce-rt*lt;if(ht!==ce){do Ge(ht),ht=Me===0?ce:ce-ze/Me/(1+Y);while(rt*ht>rt*ce);b(me)*ce*ce>b(we/ce)&&(Ie=-we/ce,Se=(Ie-le)/ce)}}var _t=m.solveQuadratic(me,Se,Ie,Ve,ke,ye),bt=ke==null;return isFinite(ce)&&(_t===0||_t>0&&ce!==Ve[0]&&ce!==Ve[1])&&(bt||ce>ke-j&&ce<ye+j)&&(Ve[_t++]=bt?ce:Z(ce,ke,ye)),_t}}},O={_id:1,_pools:{},get:function(h){if(h){var f=this._pools[h];return f||(f=this._pools[h]={_id:1}),f._id++}else return this._id++}},D=s.extend({_class:"Point",_readIndex:!0,initialize:function(f,b){var L=typeof f,I=this.__read,B=0;if(L==="number"){var j=typeof b=="number";this._set(f,j?b:f),I&&(B=j?2:1)}else if(L==="undefined"||f===null)this._set(0,0),I&&(B=f===null?1:0);else{var Y=L==="string"?f.split(/[\s,]+/)||[]:f;B=1,Array.isArray(Y)?this._set(+Y[0],+(Y.length>1?Y[1]:Y[0])):"x"in Y?this._set(Y.x||0,Y.y||0):"width"in Y?this._set(Y.width||0,Y.height||0):"angle"in Y?(this._set(Y.length||0,0),this.setAngle(Y.angle||0)):(this._set(0,0),B=0)}return I&&(this.__read=B),this},set:"#initialize",_set:function(h,f){return this.x=h,this.y=f,this},equals:function(h){return this===h||h&&(this.x===h.x&&this.y===h.y||Array.isArray(h)&&this.x===h[0]&&this.y===h[1])||!1},clone:function(){return new D(this.x,this.y)},toString:function(){var h=y.instance;return"{ x: "+h.number(this.x)+", y: "+h.number(this.y)+" }"},_serialize:function(h){var f=h.formatter;return[f.number(this.x),f.number(this.y)]},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},setLength:function(h){if(this.isZero()){var f=this._angle||0;this._set(Math.cos(f)*h,Math.sin(f)*h)}else{var b=h/this.getLength();m.isZero(b)&&this.getAngle(),this._set(this.x*b,this.y*b)}},getAngle:function(){return this.getAngleInRadians.apply(this,arguments)*180/Math.PI},setAngle:function(h){this.setAngleInRadians.call(this,h*Math.PI/180)},getAngleInDegrees:"#getAngle",setAngleInDegrees:"#setAngle",getAngleInRadians:function(){if(arguments.length){var h=D.read(arguments),f=this.getLength()*h.getLength();if(m.isZero(f))return NaN;var b=this.dot(h)/f;return Math.acos(b<-1?-1:b>1?1:b)}else return this.isZero()?this._angle||0:this._angle=Math.atan2(this.y,this.x)},setAngleInRadians:function(h){if(this._angle=h,!this.isZero()){var f=this.getLength();this._set(Math.cos(h)*f,Math.sin(h)*f)}},getQuadrant:function(){return this.x>=0?this.y>=0?1:4:this.y>=0?2:3}},{beans:!1,getDirectedAngle:function(){var h=D.read(arguments);return Math.atan2(this.cross(h),this.dot(h))*180/Math.PI},getDistance:function(){var h=arguments,f=D.read(h),b=f.x-this.x,L=f.y-this.y,I=b*b+L*L,B=s.read(h);return B?I:Math.sqrt(I)},normalize:function(h){h===t&&(h=1);var f=this.getLength(),b=f!==0?h/f:0,L=new D(this.x*b,this.y*b);return b>=0&&(L._angle=this._angle),L},rotate:function(h,f){if(h===0)return this.clone();h=h*Math.PI/180;var b=f?this.subtract(f):this,L=Math.sin(h),I=Math.cos(h);return b=new D(b.x*I-b.y*L,b.x*L+b.y*I),f?b.add(f):b},transform:function(h){return h?h._transformPoint(this):this},add:function(){var h=D.read(arguments);return new D(this.x+h.x,this.y+h.y)},subtract:function(){var h=D.read(arguments);return new D(this.x-h.x,this.y-h.y)},multiply:function(){var h=D.read(arguments);return new D(this.x*h.x,this.y*h.y)},divide:function(){var h=D.read(arguments);return new D(this.x/h.x,this.y/h.y)},modulo:function(){var h=D.read(arguments);return new D(this.x%h.x,this.y%h.y)},negate:function(){return new D(-this.x,-this.y)},isInside:function(){return H.read(arguments).contains(this)},isClose:function(){var h=arguments,f=D.read(h),b=s.read(h);return this.getDistance(f)<=b},isCollinear:function(){var h=D.read(arguments);return D.isCollinear(this.x,this.y,h.x,h.y)},isColinear:"#isCollinear",isOrthogonal:function(){var h=D.read(arguments);return D.isOrthogonal(this.x,this.y,h.x,h.y)},isZero:function(){var h=m.isZero;return h(this.x)&&h(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},isInQuadrant:function(h){return this.x*(h>1&&h<4?-1:1)>=0&&this.y*(h>2?-1:1)>=0},dot:function(){var h=D.read(arguments);return this.x*h.x+this.y*h.y},cross:function(){var h=D.read(arguments);return this.x*h.y-this.y*h.x},project:function(){var h=D.read(arguments),f=h.isZero()?0:this.dot(h)/h.dot(h);return new D(h.x*f,h.y*f)},statics:{min:function(){var h=arguments,f=D.read(h),b=D.read(h);return new D(Math.min(f.x,b.x),Math.min(f.y,b.y))},max:function(){var h=arguments,f=D.read(h),b=D.read(h);return new D(Math.max(f.x,b.x),Math.max(f.y,b.y))},random:function(){return new D(Math.random(),Math.random())},isCollinear:function(h,f,b,L){return Math.abs(h*L-f*b)<=Math.sqrt((h*h+f*f)*(b*b+L*L))*1e-8},isOrthogonal:function(h,f,b,L){return Math.abs(h*b+f*L)<=Math.sqrt((h*h+f*f)*(b*b+L*L))*1e-8}}},s.each(["round","ceil","floor","abs"],function(h){var f=Math[h];this[h]=function(){return new D(f(this.x),f(this.y))}},{})),z=D.extend({initialize:function(f,b,L,I){this._x=f,this._y=b,this._owner=L,this._setter=I},_set:function(h,f,b){return this._x=h,this._y=f,b||this._owner[this._setter](this),this},getX:function(){return this._x},setX:function(h){this._x=h,this._owner[this._setter](this)},getY:function(){return this._y},setY:function(h){this._y=h,this._owner[this._setter](this)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(h){this._owner._changeSelection(this._getSelection(),h)},_getSelection:function(){return this._setter==="setPosition"?4:0}}),w=s.extend({_class:"Size",_readIndex:!0,initialize:function(f,b){var L=typeof f,I=this.__read,B=0;if(L==="number"){var j=typeof b=="number";this._set(f,j?b:f),I&&(B=j?2:1)}else if(L==="undefined"||f===null)this._set(0,0),I&&(B=f===null?1:0);else{var Y=L==="string"?f.split(/[\s,]+/)||[]:f;B=1,Array.isArray(Y)?this._set(+Y[0],+(Y.length>1?Y[1]:Y[0])):"width"in Y?this._set(Y.width||0,Y.height||0):"x"in Y?this._set(Y.x||0,Y.y||0):(this._set(0,0),B=0)}return I&&(this.__read=B),this},set:"#initialize",_set:function(h,f){return this.width=h,this.height=f,this},equals:function(h){return h===this||h&&(this.width===h.width&&this.height===h.height||Array.isArray(h)&&this.width===h[0]&&this.height===h[1])||!1},clone:function(){return new w(this.width,this.height)},toString:function(){var h=y.instance;return"{ width: "+h.number(this.width)+", height: "+h.number(this.height)+" }"},_serialize:function(h){var f=h.formatter;return[f.number(this.width),f.number(this.height)]},add:function(){var h=w.read(arguments);return new w(this.width+h.width,this.height+h.height)},subtract:function(){var h=w.read(arguments);return new w(this.width-h.width,this.height-h.height)},multiply:function(){var h=w.read(arguments);return new w(this.width*h.width,this.height*h.height)},divide:function(){var h=w.read(arguments);return new w(this.width/h.width,this.height/h.height)},modulo:function(){var h=w.read(arguments);return new w(this.width%h.width,this.height%h.height)},negate:function(){return new w(-this.width,-this.height)},isZero:function(){var h=m.isZero;return h(this.width)&&h(this.height)},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{min:function(h,f){return new w(Math.min(h.width,f.width),Math.min(h.height,f.height))},max:function(h,f){return new w(Math.max(h.width,f.width),Math.max(h.height,f.height))},random:function(){return new w(Math.random(),Math.random())}}},s.each(["round","ceil","floor","abs"],function(h){var f=Math[h];this[h]=function(){return new w(f(this.width),f(this.height))}},{})),N=w.extend({initialize:function(f,b,L,I){this._width=f,this._height=b,this._owner=L,this._setter=I},_set:function(h,f,b){return this._width=h,this._height=f,b||this._owner[this._setter](this),this},getWidth:function(){return this._width},setWidth:function(h){this._width=h,this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(h){this._height=h,this._owner[this._setter](this)}}),H=s.extend({_class:"Rectangle",_readIndex:!0,beans:!0,initialize:function(f,b,L,I){var B=arguments,j=typeof f,Y;if(j==="number"?(this._set(f,b,L,I),Y=4):j==="undefined"||f===null?(this._set(0,0,0,0),Y=f===null?1:0):B.length===1&&(Array.isArray(f)?(this._set.apply(this,f),Y=1):f.x!==t||f.width!==t?(this._set(f.x||0,f.y||0,f.width||0,f.height||0),Y=1):f.from===t&&f.to===t&&(this._set(0,0,0,0),s.readSupported(B,this)&&(Y=1))),Y===t){var Z=D.readNamed(B,"from"),ie=s.peek(B),pe=Z.x,me=Z.y,de,le;if(ie&&ie.x!==t||s.hasNamed(B,"to")){var we=D.readNamed(B,"to");de=we.x-pe,le=we.y-me,de<0&&(pe=we.x,de=-de),le<0&&(me=we.y,le=-le)}else{var Ve=w.read(B);de=Ve.width,le=Ve.height}this._set(pe,me,de,le),Y=B.__index}var ke=B.__filtered;return ke&&(this.__filtered=ke),this.__read&&(this.__read=Y),this},set:"#initialize",_set:function(h,f,b,L){return this.x=h,this.y=f,this.width=b,this.height=L,this},clone:function(){return new H(this.x,this.y,this.width,this.height)},equals:function(h){var f=s.isPlainValue(h)?H.read(arguments):h;return f===this||f&&this.x===f.x&&this.y===f.y&&this.width===f.width&&this.height===f.height||!1},toString:function(){var h=y.instance;return"{ x: "+h.number(this.x)+", y: "+h.number(this.y)+", width: "+h.number(this.width)+", height: "+h.number(this.height)+" }"},_serialize:function(h){var f=h.formatter;return[f.number(this.x),f.number(this.y),f.number(this.width),f.number(this.height)]},getPoint:function(h){var f=h?D:z;return new f(this.x,this.y,this,"setPoint")},setPoint:function(){var h=D.read(arguments);this.x=h.x,this.y=h.y},getSize:function(h){var f=h?w:N;return new f(this.width,this.height,this,"setSize")},_fw:1,_fh:1,setSize:function(){var h=w.read(arguments),f=this._sx,b=this._sy,L=h.width,I=h.height;f&&(this.x+=(this.width-L)*f),b&&(this.y+=(this.height-I)*b),this.width=L,this.height=I,this._fw=this._fh=1},getLeft:function(){return this.x},setLeft:function(h){if(!this._fw){var f=h-this.x;this.width-=this._sx===.5?f*2:f}this.x=h,this._sx=this._fw=0},getTop:function(){return this.y},setTop:function(h){if(!this._fh){var f=h-this.y;this.height-=this._sy===.5?f*2:f}this.y=h,this._sy=this._fh=0},getRight:function(){return this.x+this.width},setRight:function(h){if(!this._fw){var f=h-this.x;this.width=this._sx===.5?f*2:f}this.x=h-this.width,this._sx=1,this._fw=0},getBottom:function(){return this.y+this.height},setBottom:function(h){if(!this._fh){var f=h-this.y;this.height=this._sy===.5?f*2:f}this.y=h-this.height,this._sy=1,this._fh=0},getCenterX:function(){return this.x+this.width/2},setCenterX:function(h){this._fw||this._sx===.5?this.x=h-this.width/2:(this._sx&&(this.x+=(h-this.x)*2*this._sx),this.width=(h-this.x)*2),this._sx=.5,this._fw=0},getCenterY:function(){return this.y+this.height/2},setCenterY:function(h){this._fh||this._sy===.5?this.y=h-this.height/2:(this._sy&&(this.y+=(h-this.y)*2*this._sy),this.height=(h-this.y)*2),this._sy=.5,this._fh=0},getCenter:function(h){var f=h?D:z;return new f(this.getCenterX(),this.getCenterY(),this,"setCenter")},setCenter:function(){var h=D.read(arguments);return this.setCenterX(h.x),this.setCenterY(h.y),this},getArea:function(){return this.width*this.height},isEmpty:function(){return this.width===0||this.height===0},contains:function(h){return h&&h.width!==t||(Array.isArray(h)?h:arguments).length===4?this._containsRectangle(H.read(arguments)):this._containsPoint(D.read(arguments))},_containsPoint:function(h){var f=h.x,b=h.y;return f>=this.x&&b>=this.y&&f<=this.x+this.width&&b<=this.y+this.height},_containsRectangle:function(h){var f=h.x,b=h.y;return f>=this.x&&b>=this.y&&f+h.width<=this.x+this.width&&b+h.height<=this.y+this.height},intersects:function(){var h=H.read(arguments),f=s.read(arguments)||0;return h.x+h.width>this.x-f&&h.y+h.height>this.y-f&&h.x<this.x+this.width+f&&h.y<this.y+this.height+f},intersect:function(){var h=H.read(arguments),f=Math.max(this.x,h.x),b=Math.max(this.y,h.y),L=Math.min(this.x+this.width,h.x+h.width),I=Math.min(this.y+this.height,h.y+h.height);return new H(f,b,L-f,I-b)},unite:function(){var h=H.read(arguments),f=Math.min(this.x,h.x),b=Math.min(this.y,h.y),L=Math.max(this.x+this.width,h.x+h.width),I=Math.max(this.y+this.height,h.y+h.height);return new H(f,b,L-f,I-b)},include:function(){var h=D.read(arguments),f=Math.min(this.x,h.x),b=Math.min(this.y,h.y),L=Math.max(this.x+this.width,h.x),I=Math.max(this.y+this.height,h.y);return new H(f,b,L-f,I-b)},expand:function(){var h=w.read(arguments),f=h.width,b=h.height;return new H(this.x-f/2,this.y-b/2,this.width+f,this.height+b)},scale:function(h,f){return this.expand(this.width*h-this.width,this.height*(f===t?h:f)-this.height)}},s.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],function(h,f){var b=h.join(""),L=/^[RL]/.test(b);f>=4&&(h[1]+=L?"Y":"X");var I=h[L?0:1],B=h[L?1:0],j="get"+I,Y="get"+B,Z="set"+I,ie="set"+B,pe="get"+b,me="set"+b;this[pe]=function(de){var le=de?D:z;return new le(this[j](),this[Y](),this,me)},this[me]=function(){var de=D.read(arguments);this[Z](de.x),this[ie](de.y)}},{beans:!0})),X=H.extend({initialize:function(f,b,L,I,B,j){this._set(f,b,L,I,!0),this._owner=B,this._setter=j},_set:function(h,f,b,L,I){return this._x=h,this._y=f,this._width=b,this._height=L,I||this._owner[this._setter](this),this}},new function(){var h=H.prototype;return s.each(["x","y","width","height"],function(f){var b=s.capitalize(f),L="_"+f;this["get"+b]=function(){return this[L]},this["set"+b]=function(I){this[L]=I,this._dontNotify||this._owner[this._setter](this)}},s.each(["Point","Size","Center","Left","Top","Right","Bottom","CenterX","CenterY","TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],function(f){var b="set"+f;this[b]=function(){this._dontNotify=!0,h[b].apply(this,arguments),this._dontNotify=!1,this._owner[this._setter](this)}},{isSelected:function(){return!!(this._owner._selection&2)},setSelected:function(f){var b=this._owner;b._changeSelection&&b._changeSelection(2,f)}}))}),ae=s.extend({_class:"Matrix",initialize:function h(f,b){var L=arguments,I=L.length,B=!0;if(I>=6?this._set.apply(this,L):I===1||I===2?f instanceof h?this._set(f._a,f._b,f._c,f._d,f._tx,f._ty,b):Array.isArray(f)?this._set.apply(this,b?f.concat([b]):f):B=!1:I?B=!1:this.reset(),!B)throw new Error("Unsupported matrix parameters");return this},set:"#initialize",_set:function(h,f,b,L,I,B,j){return this._a=h,this._b=f,this._c=b,this._d=L,this._tx=I,this._ty=B,j||this._changed(),this},_serialize:function(h,f){return s.serialize(this.getValues(),h,!0,f)},_changed:function(){var h=this._owner;h&&(h._applyMatrix?h.transform(null,!0):h._changed(25))},clone:function(){return new ae(this._a,this._b,this._c,this._d,this._tx,this._ty)},equals:function(h){return h===this||h&&this._a===h._a&&this._b===h._b&&this._c===h._c&&this._d===h._d&&this._tx===h._tx&&this._ty===h._ty},toString:function(){var h=y.instance;return"[["+[h.number(this._a),h.number(this._c),h.number(this._tx)].join(", ")+"], ["+[h.number(this._b),h.number(this._d),h.number(this._ty)].join(", ")+"]]"},reset:function(h){return this._a=this._d=1,this._b=this._c=this._tx=this._ty=0,h||this._changed(),this},apply:function(h,f){var b=this._owner;return b?(b.transform(null,s.pick(h,!0),f),this.isIdentity()):!1},translate:function(){var h=D.read(arguments),f=h.x,b=h.y;return this._tx+=f*this._a+b*this._c,this._ty+=f*this._b+b*this._d,this._changed(),this},scale:function(){var h=arguments,f=D.read(h),b=D.read(h,0,{readNull:!0});return b&&this.translate(b),this._a*=f.x,this._b*=f.x,this._c*=f.y,this._d*=f.y,b&&this.translate(b.negate()),this._changed(),this},rotate:function(h){h*=Math.PI/180;var f=D.read(arguments,1),b=f.x,L=f.y,I=Math.cos(h),B=Math.sin(h),j=b-b*I+L*B,Y=L-b*B-L*I,Z=this._a,ie=this._b,pe=this._c,me=this._d;return this._a=I*Z+B*pe,this._b=I*ie+B*me,this._c=-B*Z+I*pe,this._d=-B*ie+I*me,this._tx+=j*Z+Y*pe,this._ty+=j*ie+Y*me,this._changed(),this},shear:function(){var h=arguments,f=D.read(h),b=D.read(h,0,{readNull:!0});b&&this.translate(b);var L=this._a,I=this._b;return this._a+=f.y*this._c,this._b+=f.y*this._d,this._c+=f.x*L,this._d+=f.x*I,b&&this.translate(b.negate()),this._changed(),this},skew:function(){var h=arguments,f=D.read(h),b=D.read(h,0,{readNull:!0}),L=Math.PI/180,I=new D(Math.tan(f.x*L),Math.tan(f.y*L));return this.shear(I,b)},append:function(h,f){if(h){var b=this._a,L=this._b,I=this._c,B=this._d,j=h._a,Y=h._c,Z=h._b,ie=h._d,pe=h._tx,me=h._ty;this._a=j*b+Z*I,this._c=Y*b+ie*I,this._b=j*L+Z*B,this._d=Y*L+ie*B,this._tx+=pe*b+me*I,this._ty+=pe*L+me*B,f||this._changed()}return this},prepend:function(h,f){if(h){var b=this._a,L=this._b,I=this._c,B=this._d,j=this._tx,Y=this._ty,Z=h._a,ie=h._c,pe=h._b,me=h._d,de=h._tx,le=h._ty;this._a=Z*b+ie*L,this._c=Z*I+ie*B,this._b=pe*b+me*L,this._d=pe*I+me*B,this._tx=Z*j+ie*Y+de,this._ty=pe*j+me*Y+le,f||this._changed()}return this},appended:function(h){return this.clone().append(h)},prepended:function(h){return this.clone().prepend(h)},invert:function(){var h=this._a,f=this._b,b=this._c,L=this._d,I=this._tx,B=this._ty,j=h*L-f*b,Y=null;return j&&!isNaN(j)&&isFinite(I)&&isFinite(B)&&(this._a=L/j,this._b=-f/j,this._c=-b/j,this._d=h/j,this._tx=(b*B-L*I)/j,this._ty=(f*I-h*B)/j,Y=this),Y},inverted:function(){return this.clone().invert()},concatenate:"#append",preConcatenate:"#prepend",chain:"#appended",_shiftless:function(){return new ae(this._a,this._b,this._c,this._d,0,0)},_orNullIfIdentity:function(){return this.isIdentity()?null:this},isIdentity:function(){return this._a===1&&this._b===0&&this._c===0&&this._d===1&&this._tx===0&&this._ty===0},isInvertible:function(){var h=this._a*this._d-this._c*this._b;return h&&!isNaN(h)&&isFinite(this._tx)&&isFinite(this._ty)},isSingular:function(){return!this.isInvertible()},transform:function(h,f,b){return arguments.length<3?this._transformPoint(D.read(arguments)):this._transformCoordinates(h,f,b)},_transformPoint:function(h,f,b){var L=h.x,I=h.y;return f||(f=new D),f._set(L*this._a+I*this._c+this._tx,L*this._b+I*this._d+this._ty,b)},_transformCoordinates:function(h,f,b){for(var L=0,I=2*b;L<I;L+=2){var B=h[L],j=h[L+1];f[L]=B*this._a+j*this._c+this._tx,f[L+1]=B*this._b+j*this._d+this._ty}return f},_transformCorners:function(h){var f=h.x,b=h.y,L=f+h.width,I=b+h.height,B=[f,b,L,b,L,I,f,I];return this._transformCoordinates(B,B,4)},_transformBounds:function(h,f,b){for(var L=this._transformCorners(h),I=L.slice(0,2),B=I.slice(),j=2;j<8;j++){var Y=L[j],Z=j&1;Y<I[Z]?I[Z]=Y:Y>B[Z]&&(B[Z]=Y)}return f||(f=new H),f._set(I[0],I[1],B[0]-I[0],B[1]-I[1],b)},inverseTransform:function(){return this._inverseTransform(D.read(arguments))},_inverseTransform:function(h,f,b){var L=this._a,I=this._b,B=this._c,j=this._d,Y=this._tx,Z=this._ty,ie=L*j-I*B,pe=null;if(ie&&!isNaN(ie)&&isFinite(Y)&&isFinite(Z)){var me=h.x-this._tx,de=h.y-this._ty;f||(f=new D),pe=f._set((me*j-de*B)/ie,(de*L-me*I)/ie,b)}return pe},decompose:function(){var h=this._a,f=this._b,b=this._c,L=this._d,I=h*L-f*b,B=Math.sqrt,j=Math.atan2,Y=180/Math.PI,Z,ie,pe;if(h!==0||f!==0){var me=B(h*h+f*f);Z=Math.acos(h/me)*(f>0?1:-1),ie=[me,I/me],pe=[j(h*b+f*L,me*me),0]}else if(b!==0||L!==0){var de=B(b*b+L*L);Z=Math.asin(b/de)*(L>0?1:-1),ie=[I/de,de],pe=[0,j(h*b+f*L,de*de)]}else Z=0,pe=ie=[0,0];return{translation:this.getTranslation(),rotation:Z*Y,scaling:new D(ie),skewing:new D(pe[0]*Y,pe[1]*Y)}},getValues:function(){return[this._a,this._b,this._c,this._d,this._tx,this._ty]},getTranslation:function(){return new D(this._tx,this._ty)},getScaling:function(){return this.decompose().scaling},getRotation:function(){return this.decompose().rotation},applyToContext:function(h){this.isIdentity()||h.transform(this._a,this._b,this._c,this._d,this._tx,this._ty)}},s.each(["a","b","c","d","tx","ty"],function(h){var f=s.capitalize(h),b="_"+h;this["get"+f]=function(){return this[b]},this["set"+f]=function(L){this[b]=L,this._changed()}},{})),oe=s.extend({_class:"Line",initialize:function(f,b,L,I,B){var j=!1;arguments.length>=4?(this._px=f,this._py=b,this._vx=L,this._vy=I,j=B):(this._px=f.x,this._py=f.y,this._vx=b.x,this._vy=b.y,j=L),j||(this._vx-=this._px,this._vy-=this._py)},getPoint:function(){return new D(this._px,this._py)},getVector:function(){return new D(this._vx,this._vy)},getLength:function(){return this.getVector().getLength()},intersect:function(h,f){return oe.intersect(this._px,this._py,this._vx,this._vy,h._px,h._py,h._vx,h._vy,!0,f)},getSide:function(h,f){return oe.getSide(this._px,this._py,this._vx,this._vy,h.x,h.y,!0,f)},getDistance:function(h){return Math.abs(this.getSignedDistance(h))},getSignedDistance:function(h){return oe.getSignedDistance(this._px,this._py,this._vx,this._vy,h.x,h.y,!0)},isCollinear:function(h){return D.isCollinear(this._vx,this._vy,h._vx,h._vy)},isOrthogonal:function(h){return D.isOrthogonal(this._vx,this._vy,h._vx,h._vy)},statics:{intersect:function(h,f,b,L,I,B,j,Y,Z,ie){Z||(b-=h,L-=f,j-=I,Y-=B);var pe=b*Y-L*j;if(!m.isMachineZero(pe)){var me=h-I,de=f-B,le=(j*de-Y*me)/pe,we=(b*de-L*me)/pe,Ve=1e-12,ke=-Ve,ye=1+Ve;if(ie||ke<le&&le<ye&&ke<we&&we<ye)return ie||(le=le<=0?0:le>=1?1:le),new D(h+le*b,f+le*L)}},getSide:function(h,f,b,L,I,B,j,Y){j||(b-=h,L-=f);var Z=I-h,ie=B-f,pe=Z*L-ie*b;return!Y&&m.isMachineZero(pe)&&(pe=(Z*b+Z*b)/(b*b+L*L),pe>=0&&pe<=1&&(pe=0)),pe<0?-1:pe>0?1:0},getSignedDistance:function(h,f,b,L,I,B,j){return j||(b-=h,L-=f),b===0?L>0?I-h:h-I:L===0?b<0?B-f:f-B:((I-h)*L-(B-f)*b)/(L>b?L*Math.sqrt(1+b*b/(L*L)):b*Math.sqrt(1+L*L/(b*b)))},getDistance:function(h,f,b,L,I,B,j){return Math.abs(oe.getSignedDistance(h,f,b,L,I,B,j))}}}),ue=d.extend({_class:"Project",_list:"projects",_reference:"project",_compactSerialize:!0,initialize:function(f){d.call(this,!0),this._children=[],this._namedChildren={},this._activeLayer=null,this._currentStyle=new qi(null,null,this),this._view=$t.create(this,f||Xe.getCanvas(1,1)),this._selectionItems={},this._selectionCount=0,this._updateVersion=0},_serialize:function(h,f){return s.serialize(this._children,h,!0,f)},_changed:function(h,f){if(h&1){var b=this._view;b&&(b._needsUpdate=!0,!b._requested&&b._autoUpdate&&b.requestUpdate())}var L=this._changes;if(L&&f){var I=this._changesById,B=f._id,j=I[B];j?j.flags|=h:L.push(I[B]={item:f,flags:h})}},clear:function(){for(var h=this._children,f=h.length-1;f>=0;f--)h[f].remove()},isEmpty:function(){return!this._children.length},remove:function h(){return h.base.call(this)?(this._view&&this._view.remove(),!0):!1},getView:function(){return this._view},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(h){this._currentStyle.set(h)},getIndex:function(){return this._index},getOptions:function(){return this._scope.settings},getLayers:function(){return this._children},getActiveLayer:function(){return this._activeLayer||new Ae({project:this,insert:!0})},getSymbolDefinitions:function(){var h=[],f={};return this.getItems({class:Ue,match:function(b){var L=b._definition,I=L._id;return f[I]||(f[I]=!0,h.push(L)),!1}}),h},getSymbols:"getSymbolDefinitions",getSelectedItems:function(){var h=this._selectionItems,f=[];for(var b in h){var L=h[b],I=L._selection;I&1&&L.isInserted()?f.push(L):I||this._updateSelection(L)}return f},_updateSelection:function(h){var f=h._id,b=this._selectionItems;h._selection?b[f]!==h&&(this._selectionCount++,b[f]=h):b[f]===h&&(this._selectionCount--,delete b[f])},selectAll:function(){for(var h=this._children,f=0,b=h.length;f<b;f++)h[f].setFullySelected(!0)},deselectAll:function(){var h=this._selectionItems;for(var f in h)h[f].setFullySelected(!1)},addLayer:function(h){return this.insertLayer(t,h)},insertLayer:function(h,f){if(f instanceof Ae){f._remove(!1,!0),s.splice(this._children,[f],h,0),f._setProject(this,!0);var b=f._name;b&&f.setName(b),this._changes&&f._changed(5),this._activeLayer||(this._activeLayer=f)}else f=null;return f},_insertItem:function(h,f,b){return f=this.insertLayer(h,f)||(this._activeLayer||this._insertItem(t,new Ae(fe.NO_INSERT),!0)).insertChild(h,f),b&&f.activate&&f.activate(),f},getItems:function(h){return fe._getItems(this,h)},getItem:function(h){return fe._getItems(this,h,null,null,!0)[0]||null},importJSON:function(h){this.activate();var f=this._activeLayer;return s.importJSON(h,f&&f.isEmpty()&&f)},removeOn:function(h){var f=this._removeSets;if(f){h==="mouseup"&&(f.mousedrag=null);var b=f[h];if(b){for(var L in b){var I=b[L];for(var B in f){var j=f[B];j&&j!=b&&delete j[I._id]}I.remove()}f[h]=null}}},draw:function(h,f,b){this._updateVersion++,h.save(),f.applyToContext(h);for(var L=this._children,I=new s({offset:new D(0,0),pixelRatio:b,viewMatrix:f.isIdentity()?null:f,matrices:[new ae],updateMatrix:!0}),B=0,j=L.length;B<j;B++)L[B].draw(h,I);if(h.restore(),this._selectionCount>0){h.save(),h.strokeWidth=1;var Y=this._selectionItems,Z=this._scope.settings.handleSize,ie=this._updateVersion;for(var pe in Y)Y[pe]._drawSelection(h,f,Z,Y,ie);h.restore()}}}),fe=s.extend(a,{statics:{extend:function h(f){return f._serializeFields&&(f._serializeFields=s.set({},this.prototype._serializeFields,f._serializeFields)),h.base.apply(this,arguments)},INSERT:{insert:!0},NO_INSERT:{insert:!1}},_class:"Item",_name:null,_applyMatrix:!0,_canApplyMatrix:!0,_canScaleStroke:!1,_pivot:null,_visible:!0,_blendMode:"normal",_opacity:1,_locked:!1,_guide:!1,_clipMask:!1,_selection:0,_selectBounds:!0,_selectChildren:!1,_serializeFields:{name:null,applyMatrix:null,matrix:new ae,pivot:null,visible:!0,blendMode:"normal",opacity:1,locked:!1,guide:!1,clipMask:!1,selected:!1,data:{}},_prioritize:["applyMatrix"]},new function(){var h=["onMouseDown","onMouseUp","onMouseDrag","onClick","onDoubleClick","onMouseMove","onMouseEnter","onMouseLeave"];return s.each(h,function(f){this._events[f]={install:function(b){this.getView()._countItemEvent(b,1)},uninstall:function(b){this.getView()._countItemEvent(b,-1)}}},{_events:{onFrame:{install:function(){this.getView()._animateItem(this,!0)},uninstall:function(){this.getView()._animateItem(this,!1)}},onLoad:{},onError:{}},statics:{_itemHandlers:h}})},{initialize:function(){},_initialize:function(h,f){var b=h&&s.isPlainObject(h),L=b&&h.internal===!0,I=this._matrix=new ae,B=b&&h.project||ct.project,j=ct.settings;return this._id=L?null:O.get(),this._parent=this._index=null,this._applyMatrix=this._canApplyMatrix&&j.applyMatrix,f&&I.translate(f),I._owner=this,this._style=new qi(B._currentStyle,this,B),L||b&&h.insert==!1||!j.insertItems&&!(b&&h.insert==!0)?this._setProject(B):(b&&h.parent||B)._insertItem(t,this,!0),b&&h!==fe.NO_INSERT&&h!==fe.INSERT&&this.set(h,{internal:!0,insert:!0,project:!0,parent:!0}),b},_serialize:function(h,f){var b={},L=this;function I(B){for(var j in B){var Y=L[j];s.equals(Y,j==="leading"?B.fontSize*1.2:B[j])||(b[j]=s.serialize(Y,h,j!=="data",f))}}return I(this._serializeFields),this instanceof be||I(this._style._defaults),[this._class,b]},_changed:function(h){var f=this._symbol,b=this._parent||f,L=this._project;h&8&&(this._bounds=this._position=this._decomposed=t),h&16&&(this._globalMatrix=t),b&&h&72&&fe._clearBoundsCache(b),h&2&&fe._clearBoundsCache(this),L&&L._changed(h,this),f&&f._changed(h)},getId:function(){return this._id},getName:function(){return this._name},setName:function(h){if(this._name&&this._removeNamed(),h===+h+"")throw new Error("Names consisting only of numbers are not supported.");var f=this._getOwner();if(h&&f){var b=f._children,L=f._namedChildren;(L[h]=L[h]||[]).push(this),h in b||(b[h]=this)}this._name=h||t,this._changed(256)},getStyle:function(){return this._style},setStyle:function(h){this.getStyle().set(h)}},s.each(["locked","visible","blendMode","opacity","guide"],function(h){var f=s.capitalize(h),b="_"+h,L={locked:256,visible:265};this["get"+f]=function(){return this[b]},this["set"+f]=function(I){I!=this[b]&&(this[b]=I,this._changed(L[h]||257))}},{}),{beans:!0,getSelection:function(){return this._selection},setSelection:function(h){if(h!==this._selection){this._selection=h;var f=this._project;f&&(f._updateSelection(this),this._changed(257))}},_changeSelection:function(h,f){var b=this._selection;this.setSelection(f?b|h:b&~h)},isSelected:function(){if(this._selectChildren){for(var h=this._children,f=0,b=h.length;f<b;f++)if(h[f].isSelected())return!0}return!!(this._selection&1)},setSelected:function(h){if(this._selectChildren)for(var f=this._children,b=0,L=f.length;b<L;b++)f[b].setSelected(h);this._changeSelection(1,h)},isFullySelected:function(){var h=this._children,f=!!(this._selection&1);if(h&&f){for(var b=0,L=h.length;b<L;b++)if(!h[b].isFullySelected())return!1;return!0}return f},setFullySelected:function(h){var f=this._children;if(f)for(var b=0,L=f.length;b<L;b++)f[b].setFullySelected(h);this._changeSelection(1,h)},isClipMask:function(){return this._clipMask},setClipMask:function(h){this._clipMask!=(h=!!h)&&(this._clipMask=h,h&&(this.setFillColor(null),this.setStrokeColor(null)),this._changed(257),this._parent&&this._parent._changed(2048))},getData:function(){return this._data||(this._data={}),this._data},setData:function(h){this._data=h},getPosition:function(h){var f=h?D:z,b=this._position||(this._position=this._getPositionFromBounds());return new f(b.x,b.y,this,"setPosition")},setPosition:function(){this.translate(D.read(arguments).subtract(this.getPosition(!0)))},_getPositionFromBounds:function(h){return this._pivot?this._matrix._transformPoint(this._pivot):(h||this.getBounds()).getCenter(!0)},getPivot:function(){var h=this._pivot;return h?new z(h.x,h.y,this,"setPivot"):null},setPivot:function(){this._pivot=D.read(arguments,0,{clone:!0,readNull:!0}),this._position=t}},s.each({getStrokeBounds:{stroke:!0},getHandleBounds:{handle:!0},getInternalBounds:{internal:!0}},function(h,f){this[f]=function(b){return this.getBounds(b,h)}},{beans:!0,getBounds:function(h,f){var b=f||h instanceof ae,L=s.set({},b?f:h,this._boundsOptions);(!L.stroke||this.getStrokeScaling())&&(L.cacheItem=this);var I=this._getCachedBounds(b&&h,L).rect;return arguments.length?I:new X(I.x,I.y,I.width,I.height,this,"setBounds")},setBounds:function(){var h=H.read(arguments),f=this.getBounds(),b=this._matrix,L=new ae,I=h.getCenter();L.translate(I),(h.width!=f.width||h.height!=f.height)&&(b.isInvertible()||(b.set(b._backup||new ae().translate(b.getTranslation())),f=this.getBounds()),L.scale(f.width!==0?h.width/f.width:0,f.height!==0?h.height/f.height:0)),I=f.getCenter(),L.translate(-I.x,-I.y),this.transform(L)},_getBounds:function(h,f){var b=this._children;return!b||!b.length?new H:(fe._updateBoundsCache(this,f.cacheItem),fe._getBounds(b,h,f))},_getBoundsCacheKey:function(h,f){return[h.stroke?1:0,h.handle?1:0,f?1:0].join("")},_getCachedBounds:function(h,f,b){h=h&&h._orNullIfIdentity();var L=f.internal&&!b,I=f.cacheItem,B=L?null:this._matrix._orNullIfIdentity(),j=I&&(!h||h.equals(B))&&this._getBoundsCacheKey(f,L),Y=this._bounds;if(fe._updateBoundsCache(this._parent||this._symbol,I),j&&Y&&j in Y){var Z=Y[j];return{rect:Z.rect.clone(),nonscaling:Z.nonscaling}}var ie=this._getBounds(h||B,f),pe=ie.rect||ie,me=this._style,de=ie.nonscaling||me.hasStroke()&&!me.getStrokeScaling();if(j){Y||(this._bounds=Y={});var Z=Y[j]={rect:pe.clone(),nonscaling:de,internal:L}}return{rect:pe,nonscaling:de}},_getStrokeMatrix:function(h,f){var b=this.getStrokeScaling()?null:f&&f.internal?this:this._parent||this._symbol&&this._symbol._item,L=b?b.getViewMatrix().invert():h;return L&&L._shiftless()},statics:{_updateBoundsCache:function(h,f){if(h&&f){var b=f._id,L=h._boundsCache=h._boundsCache||{ids:{},list:[]};L.ids[b]||(L.list.push(f),L.ids[b]=f)}},_clearBoundsCache:function(h){var f=h._boundsCache;if(f){h._bounds=h._position=h._boundsCache=t;for(var b=0,L=f.list,I=L.length;b<I;b++){var B=L[b];B!==h&&(B._bounds=B._position=t,B._boundsCache&&fe._clearBoundsCache(B))}}},_getBounds:function(h,f,b){var L=1/0,I=-L,B=L,j=I,Y=!1;b=b||{};for(var Z=0,ie=h.length;Z<ie;Z++){var pe=h[Z];if(pe._visible&&!pe.isEmpty(!0)){var me=pe._getCachedBounds(f&&f.appended(pe._matrix),b,!0),de=me.rect;L=Math.min(de.x,L),B=Math.min(de.y,B),I=Math.max(de.x+de.width,I),j=Math.max(de.y+de.height,j),me.nonscaling&&(Y=!0)}}return{rect:isFinite(L)?new H(L,B,I-L,j-B):new H,nonscaling:Y}}}}),{beans:!0,_decompose:function(){return this._applyMatrix?null:this._decomposed||(this._decomposed=this._matrix.decompose())},getRotation:function(){var h=this._decompose();return h?h.rotation:0},setRotation:function(h){var f=this.getRotation();if(f!=null&&h!=null){var b=this._decomposed;this.rotate(h-f),b&&(b.rotation=h,this._decomposed=b)}},getScaling:function(){var h=this._decompose(),f=h&&h.scaling;return new z(f?f.x:1,f?f.y:1,this,"setScaling")},setScaling:function(){var h=this.getScaling(),f=D.read(arguments,0,{clone:!0,readNull:!0});if(h&&f&&!h.equals(f)){var b=this.getRotation(),L=this._decomposed,I=new ae,B=m.isZero;if(B(h.x)||B(h.y))I.translate(L.translation),b&&I.rotate(b),I.scale(f.x,f.y),this._matrix.set(I);else{var j=this.getPosition(!0);I.translate(j),b&&I.rotate(b),I.scale(f.x/h.x,f.y/h.y),b&&I.rotate(-b),I.translate(j.negate()),this.transform(I)}L&&(L.scaling=f,this._decomposed=L)}},getMatrix:function(){return this._matrix},setMatrix:function(){var h=this._matrix;h.set.apply(h,arguments)},getGlobalMatrix:function(h){var f=this._globalMatrix;if(f)for(var b=this._parent,L=[];b;){if(!b._globalMatrix){f=null;for(var I=0,B=L.length;I<B;I++)L[I]._globalMatrix=null;break}L.push(b),b=b._parent}if(!f){f=this._globalMatrix=this._matrix.clone();var b=this._parent;b&&f.prepend(b.getGlobalMatrix(!0))}return h?f:f.clone()},getViewMatrix:function(){return this.getGlobalMatrix().prepend(this.getView()._matrix)},getApplyMatrix:function(){return this._applyMatrix},setApplyMatrix:function(h){(this._applyMatrix=this._canApplyMatrix&&!!h)&&this.transform(null,!0)},getTransformContent:"#getApplyMatrix",setTransformContent:"#setApplyMatrix"},{getProject:function(){return this._project},_setProject:function(h,f){if(this._project!==h){this._project&&this._installEvents(!1),this._project=h;for(var b=this._children,L=0,I=b&&b.length;L<I;L++)b[L]._setProject(h);f=!0}f&&this._installEvents(!0)},getView:function(){return this._project._view},_installEvents:function h(f){h.base.call(this,f);for(var b=this._children,L=0,I=b&&b.length;L<I;L++)b[L]._installEvents(f)},getLayer:function(){for(var h=this;h=h._parent;)if(h instanceof Ae)return h;return null},getParent:function(){return this._parent},setParent:function(h){return h.addChild(this)},_getOwner:"#getParent",getChildren:function(){return this._children},setChildren:function(h){this.removeChildren(),this.addChildren(h)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){var h=this._getOwner();return h&&h._children[this._index+1]||null},getPreviousSibling:function(){var h=this._getOwner();return h&&h._children[this._index-1]||null},getIndex:function(){return this._index},equals:function(h){return h===this||h&&this._class===h._class&&this._style.equals(h._style)&&this._matrix.equals(h._matrix)&&this._locked===h._locked&&this._visible===h._visible&&this._blendMode===h._blendMode&&this._opacity===h._opacity&&this._clipMask===h._clipMask&&this._guide===h._guide&&this._equals(h)||!1},_equals:function(h){return s.equals(this._children,h._children)},clone:function(h){var f=new this.constructor(fe.NO_INSERT),b=this._children,L=s.pick(h?h.insert:t,h===t||h===!0),I=s.pick(h?h.deep:t,!0);b&&f.copyAttributes(this),(!b||I)&&f.copyContent(this),b||f.copyAttributes(this),L&&f.insertAbove(this);var B=this._name,j=this._parent;if(B&&j){for(var b=j._children,Y=B,Z=1;b[B];)B=Y+" "+Z++;B!==Y&&f.setName(B)}return f},copyContent:function(h){for(var f=h._children,b=0,L=f&&f.length;b<L;b++)this.addChild(f[b].clone(!1),!0)},copyAttributes:function(h,f){this.setStyle(h._style);for(var b=["_locked","_visible","_blendMode","_opacity","_clipMask","_guide"],L=0,I=b.length;L<I;L++){var B=b[L];h.hasOwnProperty(B)&&(this[B]=h[B])}f||this._matrix.set(h._matrix,!0),this.setApplyMatrix(h._applyMatrix),this.setPivot(h._pivot),this.setSelection(h._selection);var j=h._data,Y=h._name;this._data=j?s.clone(j):null,Y&&this.setName(Y)},rasterize:function(h,f){var b,L,I;s.isPlainObject(h)?(b=h.resolution,L=h.insert,I=h.raster):(b=h,L=f),I||(I=new J(fe.NO_INSERT));var B=this.getStrokeBounds(),j=(b||this.getView().getResolution())/72,Y=B.getTopLeft().floor(),Z=B.getBottomRight().ceil(),ie=new w(Z.subtract(Y)),pe=ie.multiply(j);if(I.setSize(pe,!0),!pe.isZero()){var me=I.getContext(!0),de=new ae().scale(j).translate(Y.negate());me.save(),de.applyToContext(me),this.draw(me,new s({matrices:[de]})),me.restore()}return I._matrix.set(new ae().translate(Y.add(ie.divide(2))).scale(1/j)),(L===t||L)&&I.insertAbove(this),I},contains:function(){var h=this._matrix;return h.isInvertible()&&!!this._contains(h._inverseTransform(D.read(arguments)))},_contains:function(h){var f=this._children;if(f){for(var b=f.length-1;b>=0;b--)if(f[b].contains(h))return!0;return!1}return h.isInside(this.getInternalBounds())},isInside:function(){return H.read(arguments).contains(this.getBounds())},_asPathItem:function(){return new dt.Rectangle({rectangle:this.getInternalBounds(),matrix:this._matrix,insert:!1})},intersects:function(h,f){return h instanceof fe?this._asPathItem().getIntersections(h._asPathItem(),null,f,!0).length>0:!1}},new function(){function h(){var L=arguments;return this._hitTest(D.read(L),Te.getOptions(L))}function f(){var L=arguments,I=D.read(L),B=Te.getOptions(L),j=[];return this._hitTest(I,new s({all:j},B)),j}function b(L,I,B,j){var Y=this._children;if(Y)for(var Z=Y.length-1;Z>=0;Z--){var ie=Y[Z],pe=ie!==j&&ie._hitTest(L,I,B);if(pe&&!I.all)return pe}return null}return ue.inject({hitTest:h,hitTestAll:f,_hitTest:b}),{hitTest:h,hitTestAll:f,_hitTestChildren:b}},{_hitTest:function(h,f,b){if(this._locked||!this._visible||this._guide&&!f.guides||this.isEmpty())return null;var L=this._matrix,I=b?b.appended(L):this.getGlobalMatrix().prepend(this.getView()._matrix),B=Math.max(f.tolerance,1e-12),j=f._tolerancePadding=new w(dt._getStrokePadding(B,L._shiftless().invert()));if(h=L._inverseTransform(h),!h||!this._children&&!this.getBounds({internal:!0,stroke:!0,handle:!0}).expand(j.multiply(2))._containsPoint(h))return null;var Y=!(f.guides&&!this._guide||f.selected&&!this.isSelected()||f.type&&f.type!==s.hyphenate(this._class)||f.class&&!(this instanceof f.class)),Z=f.match,ie=this,pe,me;function de(ce){return ce&&Z&&!Z(ce)&&(ce=null),ce&&f.all&&f.all.push(ce),ce}function le(ce,Se){var Ie=Se?pe["get"+Se]():ie.getPosition();if(h.subtract(Ie).divide(j).length<=1)return new Te(ce,ie,{name:Se?s.hyphenate(Se):ce,point:Ie})}var we=f.position,Ve=f.center,ke=f.bounds;if(Y&&this._parent&&(we||Ve||ke)){if((Ve||ke)&&(pe=this.getInternalBounds()),me=we&&le("position")||Ve&&le("center","Center"),!me&&ke)for(var ye=["TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],xe=0;xe<8&&!me;xe++)me=le("bounds",ye[xe]);me=de(me)}return me||(me=this._hitTestChildren(h,f,I)||Y&&de(this._hitTestSelf(h,f,I,this.getStrokeScaling()?null:I._shiftless().invert()))||null),me&&me.point&&(me.point=L.transform(me.point)),me},_hitTestSelf:function(h,f){if(f.fill&&this.hasFill()&&this._contains(h))return new Te("fill",this)},matches:function(h,f){function b(j,Y){for(var Z in j)if(j.hasOwnProperty(Z)){var ie=j[Z],pe=Y[Z];if(s.isPlainObject(ie)&&s.isPlainObject(pe)){if(!b(ie,pe))return!1}else if(!s.equals(ie,pe))return!1}return!0}var L=typeof h;if(L==="object"){for(var I in h)if(h.hasOwnProperty(I)&&!this.matches(I,h[I]))return!1;return!0}else{if(L==="function")return h(this);if(h==="match")return f(this);var B=/^(empty|editable)$/.test(h)?this["is"+s.capitalize(h)]():h==="type"?s.hyphenate(this._class):this[h];if(h==="class"){if(typeof f=="function")return this instanceof f;B=this._class}if(typeof f=="function")return!!f(B);if(f){if(f.test)return f.test(B);if(s.isPlainObject(f))return b(f,B)}return s.equals(B,f)}},getItems:function(h){return fe._getItems(this,h,this._matrix)},getItem:function(h){return fe._getItems(this,h,this._matrix,null,!0)[0]||null},statics:{_getItems:function h(f,b,L,I,B){if(!I){var j=typeof b=="object"&&b,Y=j&&j.overlapping,Z=j&&j.inside,ie=Y||Z,de=ie&&H.read([ie]);I={items:[],recursive:j&&j.recursive!==!1,inside:!!Z,overlapping:!!Y,rect:de,path:Y&&new dt.Rectangle({rectangle:de,insert:!1})},j&&(b=s.filter({},b,{recursive:!0,inside:!0,overlapping:!0}))}var pe=f._children,me=I.items,de=I.rect;L=de&&(L||new ae);for(var le=0,we=pe&&pe.length;le<we;le++){var Ve=pe[le],ke=L&&L.appended(Ve._matrix),ye=!0;if(de){var ie=Ve.getBounds(ke);if(!de.intersects(ie))continue;de.contains(ie)||I.overlapping&&(ie.contains(de)||I.path.intersects(Ve,ke))||(ye=!1)}if(ye&&Ve.matches(b)&&(me.push(Ve),B)||(I.recursive!==!1&&h(Ve,b,ke,I,B),B&&me.length>0))break}return me}}},{importJSON:function(h){var f=s.importJSON(h,this);return f!==this?this.addChild(f):f},addChild:function(h){return this.insertChild(t,h)},insertChild:function(h,f){var b=f?this.insertChildren(h,[f]):null;return b&&b[0]},addChildren:function(h){return this.insertChildren(this._children.length,h)},insertChildren:function(h,f){var b=this._children;if(b&&f&&f.length>0){f=s.slice(f);for(var L={},I=f.length-1;I>=0;I--){var B=f[I],j=B&&B._id;!B||L[j]?f.splice(I,1):(B._remove(!1,!0),L[j]=!0)}s.splice(b,f,h,0);for(var Y=this._project,Z=Y._changes,I=0,ie=f.length;I<ie;I++){var B=f[I],pe=B._name;B._parent=this,B._setProject(Y,!0),pe&&B.setName(pe),Z&&B._changed(5)}this._changed(11)}else f=null;return f},_insertItem:"#insertChild",_insertAt:function(h,f){var b=h&&h._getOwner(),L=h!==this&&b?this:null;return L&&(L._remove(!1,!0),b._insertItem(h._index+f,L)),L},insertAbove:function(h){return this._insertAt(h,1)},insertBelow:function(h){return this._insertAt(h,0)},sendToBack:function(){var h=this._getOwner();return h?h._insertItem(0,this):null},bringToFront:function(){var h=this._getOwner();return h?h._insertItem(t,this):null},appendTop:"#addChild",appendBottom:function(h){return this.insertChild(0,h)},moveAbove:"#insertAbove",moveBelow:"#insertBelow",addTo:function(h){return h._insertItem(t,this)},copyTo:function(h){return this.clone(!1).addTo(h)},reduce:function(h){var f=this._children;if(f&&f.length===1){var b=f[0].reduce(h);return this._parent?(b.insertAbove(this),this.remove()):b.remove(),b}return this},_removeNamed:function(){var h=this._getOwner();if(h){var f=h._children,b=h._namedChildren,L=this._name,I=b[L],B=I?I.indexOf(this):-1;B!==-1&&(f[L]==this&&delete f[L],I.splice(B,1),I.length?f[L]=I[0]:delete b[L])}},_remove:function(h,f){var b=this._getOwner(),L=this._project,I=this._index;return this._style&&this._style._dispose(),b?(this._name&&this._removeNamed(),I!=null&&(L._activeLayer===this&&(L._activeLayer=this.getNextSibling()||this.getPreviousSibling()),s.splice(b._children,null,I,1)),this._installEvents(!1),h&&L._changes&&this._changed(5),f&&b._changed(11,this),this._parent=null,!0):!1},remove:function(){return this._remove(!0,!0)},replaceWith:function(h){var f=h&&h.insertBelow(this);return f&&this.remove(),f},removeChildren:function(h,f){if(!this._children)return null;h=h||0,f=s.pick(f,this._children.length);for(var b=s.splice(this._children,null,h,f-h),L=b.length-1;L>=0;L--)b[L]._remove(!0,!1);return b.length>0&&this._changed(11),b},clear:"#removeChildren",reverseChildren:function(){if(this._children){this._children.reverse();for(var h=0,f=this._children.length;h<f;h++)this._children[h]._index=h;this._changed(11)}},isEmpty:function(h){var f=this._children,b=f?f.length:0;if(h){for(var L=0;L<b;L++)if(!f[L].isEmpty(h))return!1;return!0}return!b},isEditable:function(){for(var h=this;h;){if(!h._visible||h._locked)return!1;h=h._parent}return!0},hasFill:function(){return this.getStyle().hasFill()},hasStroke:function(){return this.getStyle().hasStroke()},hasShadow:function(){return this.getStyle().hasShadow()},_getOrder:function(h){function f(j){var Y=[];do Y.unshift(j);while(j=j._parent);return Y}for(var b=f(this),L=f(h),I=0,B=Math.min(b.length,L.length);I<B;I++)if(b[I]!=L[I])return b[I]._index<L[I]._index?1:-1;return 0},hasChildren:function(){return this._children&&this._children.length>0},isInserted:function(){return this._parent?this._parent.isInserted():!1},isAbove:function(h){return this._getOrder(h)===-1},isBelow:function(h){return this._getOrder(h)===1},isParent:function(h){return this._parent===h},isChild:function(h){return h&&h._parent===this},isDescendant:function(h){for(var f=this;f=f._parent;)if(f===h)return!0;return!1},isAncestor:function(h){return h?h.isDescendant(this):!1},isSibling:function(h){return this._parent===h._parent},isGroupedWith:function(h){for(var f=this._parent;f;){if(f._parent&&/^(Group|Layer|CompoundPath)$/.test(f._class)&&h.isDescendant(f))return!0;f=f._parent}return!1}},s.each(["rotate","scale","shear","skew"],function(h){var f=h==="rotate";this[h]=function(){var b=arguments,L=(f?s:D).read(b),I=D.read(b,0,{readNull:!0});return this.transform(new ae()[h](L,I||this.getPosition(!0)))}},{translate:function(){var h=new ae;return this.transform(h.translate.apply(h,arguments))},transform:function(h,f,b){var L=this._matrix,I=h&&!h.isIdentity(),B=b&&this._canApplyMatrix||this._applyMatrix&&(I||!L.isIdentity()||f&&this._children);if(!I&&!B)return this;if(I){!h.isInvertible()&&L.isInvertible()&&(L._backup=L.getValues()),L.prepend(h,!0);var j=this._style,Y=j.getFillColor(!0),Z=j.getStrokeColor(!0);Y&&Y.transform(h),Z&&Z.transform(h)}if(B&&(B=this._transformContent(L,f,b))){var ie=this._pivot;ie&&L._transformPoint(ie,ie,!0),L.reset(!0),b&&this._canApplyMatrix&&(this._applyMatrix=!0)}var pe=this._bounds,me=this._position;(I||B)&&this._changed(25);var de=I&&pe&&h.decompose();if(de&&de.skewing.isZero()&&de.rotation%90===0){for(var le in pe){var we=pe[le];if(we.nonscaling)delete pe[le];else if(B||!we.internal){var Ve=we.rect;h._transformBounds(Ve,Ve)}}this._bounds=pe;var ke=pe[this._getBoundsCacheKey(this._boundsOptions||{})];ke&&(this._position=this._getPositionFromBounds(ke.rect))}else I&&me&&this._pivot&&(this._position=h._transformPoint(me,me));return this},_transformContent:function(h,f,b){var L=this._children;if(L){for(var I=0,B=L.length;I<B;I++)L[I].transform(h,f,b);return!0}},globalToLocal:function(){return this.getGlobalMatrix(!0)._inverseTransform(D.read(arguments))},localToGlobal:function(){return this.getGlobalMatrix(!0)._transformPoint(D.read(arguments))},parentToLocal:function(){return this._matrix._inverseTransform(D.read(arguments))},localToParent:function(){return this._matrix._transformPoint(D.read(arguments))},fitBounds:function(h,f){h=H.read(arguments);var b=this.getBounds(),L=b.height/b.width,I=h.height/h.width,B=(f?L>I:L<I)?h.width/b.width:h.height/b.height,j=new H(new D,new w(b.width*B,b.height*B));j.setCenter(h.getCenter()),this.setBounds(j)}}),{_setStyles:function(h,f,b){var L=this._style,I=this._matrix;if(L.hasFill()&&(h.fillStyle=L.getFillColor().toCanvasStyle(h,I)),L.hasStroke()){h.strokeStyle=L.getStrokeColor().toCanvasStyle(h,I),h.lineWidth=L.getStrokeWidth();var B=L.getStrokeJoin(),j=L.getStrokeCap(),Y=L.getMiterLimit();if(B&&(h.lineJoin=B),j&&(h.lineCap=j),Y&&(h.miterLimit=Y),ct.support.nativeDash){var Z=L.getDashArray(),ie=L.getDashOffset();Z&&Z.length&&("setLineDash"in h?(h.setLineDash(Z),h.lineDashOffset=ie):(h.mozDash=Z,h.mozDashOffset=ie))}}if(L.hasShadow()){var pe=f.pixelRatio||1,me=b._shiftless().prepend(new ae().scale(pe,pe)),de=me.transform(new D(L.getShadowBlur(),0)),le=me.transform(this.getShadowOffset());h.shadowColor=L.getShadowColor().toCanvasStyle(h),h.shadowBlur=de.getLength(),h.shadowOffsetX=le.x,h.shadowOffsetY=le.y}},draw:function(h,f,b){if(this._updateVersion=this._project._updateVersion,!(!this._visible||this._opacity===0)){var L=f.matrices,I=f.viewMatrix,B=this._matrix,j=L[L.length-1].appended(B);if(j.isInvertible()){I=I?I.appended(j):j,L.push(j),f.updateMatrix&&(this._globalMatrix=j);var Y=this._blendMode,Z=m.clamp(this._opacity,0,1),ie=Y==="normal",pe=Pe.nativeModes[Y],me=ie&&Z===1||f.dontStart||f.clip||(pe||ie&&Z<1)&&this._canComposite(),de=f.pixelRatio||1,le,we,Ve;if(!me){var ke=this.getStrokeBounds(I);if(!ke.width||!ke.height){L.pop();return}Ve=f.offset,we=f.offset=ke.getTopLeft().floor(),le=h,h=Xe.getContext(ke.getSize().ceil().add(1).multiply(de)),de!==1&&h.scale(de,de)}h.save();var ye=b?b.appended(B):this._canScaleStroke&&!this.getStrokeScaling(!0)&&I,xe=!me&&f.clipItem,ce=!ye||xe;if(me?(h.globalAlpha=Z,pe&&(h.globalCompositeOperation=Y)):ce&&h.translate(-we.x,-we.y),ce&&(me?B:I).applyToContext(h),xe&&f.clipItem.draw(h,f.extend({clip:!0})),ye){h.setTransform(de,0,0,de,0,0);var Se=f.offset;Se&&h.translate(-Se.x,-Se.y)}this._draw(h,f,I,ye),h.restore(),L.pop(),f.clip&&!f.dontFinish&&h.clip(this.getFillRule()),me||(Pe.process(Y,h,le,Z,we.subtract(Ve).multiply(de)),Xe.release(h),f.offset=Ve)}}},_isUpdated:function(h){var f=this._parent;if(f instanceof Mt)return f._isUpdated(h);var b=this._updateVersion===h;return!b&&f&&f._visible&&f._isUpdated(h)&&(this._updateVersion=h,b=!0),b},_drawSelection:function(h,f,b,L,I){var B=this._selection,j=B&1,Y=B&2||j&&this._selectBounds,Z=B&4;if(this._drawSelected||(j=!1),(j||Y||Z)&&this._isUpdated(I)){var ie,pe=this.getSelectedColor(!0)||(ie=this.getLayer())&&ie.getSelectedColor(!0),me=f.appended(this.getGlobalMatrix(!0)),de=b/2;if(h.strokeStyle=h.fillStyle=pe?pe.toCanvasStyle(h):"#009dec",j&&this._drawSelected(h,me,L),Z){var le=this.getPosition(!0),we=this._parent,Ve=we?we.localToGlobal(le):le,ke=Ve.x,ye=Ve.y;h.beginPath(),h.arc(ke,ye,de,0,Math.PI*2,!0),h.stroke();for(var xe=[[0,-1],[1,0],[0,1],[-1,0]],ce=de,Se=b+1,Ie=0;Ie<4;Ie++){var Me=xe[Ie],ze=Me[0],Ge=Me[1];h.moveTo(ke+ze*ce,ye+Ge*ce),h.lineTo(ke+ze*Se,ye+Ge*Se),h.stroke()}}if(Y){var We=me._transformCorners(this.getInternalBounds());h.beginPath();for(var Ie=0;Ie<8;Ie++)h[Ie?"lineTo":"moveTo"](We[Ie],We[++Ie]);h.closePath(),h.stroke();for(var Ie=0;Ie<8;Ie++)h.fillRect(We[Ie]-de,We[++Ie]-de,b,b)}}},_canComposite:function(){return!1}},s.each(["down","drag","up","move"],function(h){this["removeOn"+s.capitalize(h)]=function(){var f={};return f[h]=!0,this.removeOn(f)}},{removeOn:function(h){for(var f in h)if(h[f]){var b="mouse"+f,L=this._project,I=L._removeSets=L._removeSets||{};I[b]=I[b]||{},I[b][this._id]=this}return this}}),{tween:function(h,f,b){b||(b=f,f=h,h=null,b||(b=f,f=null));var L=b&&b.easing,I=b&&b.start,B=b!=null&&(typeof b=="number"?b:b.duration),j=new He(this,h,f,B,L,I);function Y(Z){j._handleFrame(Z.time*1e3),j.running||this.off("frame",Y)}return B&&this.on("frame",Y),j},tweenTo:function(h,f){return this.tween(null,h,f)},tweenFrom:function(h,f){return this.tween(h,null,f)}}),be=fe.extend({_class:"Group",_selectBounds:!1,_selectChildren:!0,_serializeFields:{children:[]},initialize:function(f){this._children=[],this._namedChildren={},this._initialize(f)||this.addChildren(Array.isArray(f)?f:arguments)},_changed:function h(f){h.base.call(this,f),f&2050&&(this._clipItem=t)},_getClipItem:function(){var h=this._clipItem;if(h===t){h=null;for(var f=this._children,b=0,L=f.length;b<L;b++)if(f[b]._clipMask){h=f[b];break}this._clipItem=h}return h},isClipped:function(){return!!this._getClipItem()},setClipped:function(h){var f=this.getFirstChild();f&&f.setClipMask(h)},_getBounds:function h(f,b){var L=this._getClipItem();return L?L._getCachedBounds(L._matrix.prepended(f),s.set({},b,{stroke:!1})):h.base.call(this,f,b)},_hitTestChildren:function h(f,b,L){var I=this._getClipItem();return(!I||I.contains(f))&&h.base.call(this,f,b,L,I)},_draw:function(h,f){var b=f.clip,L=!b&&this._getClipItem();f=f.extend({clipItem:L,clip:!1}),b?(h.beginPath(),f.dontStart=f.dontFinish=!0):L&&L.draw(h,f.extend({clip:!0}));for(var I=this._children,B=0,j=I.length;B<j;B++){var Y=I[B];Y!==L&&Y.draw(h,f)}}}),Ae=be.extend({_class:"Layer",initialize:function(){be.apply(this,arguments)},_getOwner:function(){return this._parent||this._index!=null&&this._project},isInserted:function h(){return this._parent?h.base.call(this):this._index!=null},activate:function(){this._project._activeLayer=this},_hitTestSelf:function(){}}),W=fe.extend({_class:"Shape",_applyMatrix:!1,_canApplyMatrix:!1,_canScaleStroke:!0,_serializeFields:{type:null,size:null,radius:null},initialize:function(f,b){this._initialize(f,b)},_equals:function(h){return this._type===h._type&&this._size.equals(h._size)&&s.equals(this._radius,h._radius)},copyContent:function(h){this.setType(h._type),this.setSize(h._size),this.setRadius(h._radius)},getType:function(){return this._type},setType:function(h){this._type=h},getShape:"#getType",setShape:"#setType",getSize:function(){var h=this._size;return new N(h.width,h.height,this,"setSize")},setSize:function(){var h=w.read(arguments);if(!this._size)this._size=h.clone();else if(!this._size.equals(h)){var f=this._type,b=h.width,L=h.height;f==="rectangle"?this._radius.set(w.min(this._radius,h.divide(2).abs())):f==="circle"?(b=L=(b+L)/2,this._radius=b/2):f==="ellipse"&&this._radius._set(b/2,L/2),this._size._set(b,L),this._changed(9)}},getRadius:function(){var h=this._radius;return this._type==="circle"?h:new N(h.width,h.height,this,"setRadius")},setRadius:function(h){var f=this._type;if(f==="circle"){if(h===this._radius)return;var b=h*2;this._radius=h,this._size._set(b,b)}else if(h=w.read(arguments),!this._radius)this._radius=h.clone();else{if(this._radius.equals(h))return;if(this._radius.set(h),f==="rectangle"){var b=w.max(this._size,h.multiply(2));this._size.set(b)}else f==="ellipse"&&this._size._set(h.width*2,h.height*2)}this._changed(9)},isEmpty:function(){return!1},toPath:function(h){var f=new dt[s.capitalize(this._type)]({center:new D,size:this._size,radius:this._radius,insert:!1});return f.copyAttributes(this),ct.settings.applyMatrix&&f.setApplyMatrix(!0),(h===t||h)&&f.insertAbove(this),f},toShape:"#clone",_asPathItem:function(){return this.toPath(!1)},_draw:function(h,f,b,L){var I=this._style,B=I.hasFill(),j=I.hasStroke(),Y=f.dontFinish||f.clip,Z=!L;if(B||j||Y){var ie=this._type,pe=this._radius,me=ie==="circle";if(f.dontStart||h.beginPath(),Z&&me)h.arc(0,0,pe,0,Math.PI*2,!0);else{var de=me?pe:pe.width,le=me?pe:pe.height,we=this._size,Ve=we.width,ke=we.height;if(Z&&ie==="rectangle"&&de===0&&le===0)h.rect(-Ve/2,-ke/2,Ve,ke);else{var ye=Ve/2,xe=ke/2,ce=1-.5522847498307936,Se=de*ce,Ie=le*ce,Me=[-ye,-xe+le,-ye,-xe+Ie,-ye+Se,-xe,-ye+de,-xe,ye-de,-xe,ye-Se,-xe,ye,-xe+Ie,ye,-xe+le,ye,xe-le,ye,xe-Ie,ye-Se,xe,ye-de,xe,-ye+de,xe,-ye+Se,xe,-ye,xe-Ie,-ye,xe-le];L&&L.transform(Me,Me,32),h.moveTo(Me[0],Me[1]),h.bezierCurveTo(Me[2],Me[3],Me[4],Me[5],Me[6],Me[7]),ye!==de&&h.lineTo(Me[8],Me[9]),h.bezierCurveTo(Me[10],Me[11],Me[12],Me[13],Me[14],Me[15]),xe!==le&&h.lineTo(Me[16],Me[17]),h.bezierCurveTo(Me[18],Me[19],Me[20],Me[21],Me[22],Me[23]),ye!==de&&h.lineTo(Me[24],Me[25]),h.bezierCurveTo(Me[26],Me[27],Me[28],Me[29],Me[30],Me[31])}}h.closePath()}!Y&&(B||j)&&(this._setStyles(h,f,b),B&&(h.fill(I.getFillRule()),h.shadowColor="rgba(0,0,0,0)"),j&&h.stroke())},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_getBounds:function(h,f){var b=new H(this._size).setCenter(0,0),L=this._style,I=f.stroke&&L.hasStroke()&&L.getStrokeWidth();return h&&(b=h._transformBounds(b)),I?b.expand(dt._getStrokePadding(I,this._getStrokeMatrix(h,f))):b}},new function(){function h(b,L,I){var B=b._radius;if(!B.isZero())for(var j=b._size.divide(2),Y=1;Y<=4;Y++){var Z=new D(Y>1&&Y<4?-1:1,Y>2?-1:1),ie=Z.multiply(j),pe=ie.subtract(Z.multiply(B)),me=new H(I?ie.add(Z.multiply(I)):ie,pe);if(me.contains(L))return{point:pe,quadrant:Y}}}function f(b,L,I,B){var j=b.divide(L);return(!B||j.isInQuadrant(B))&&j.subtract(j.normalize()).multiply(L).divide(I).length<=1}return{_contains:function b(L){if(this._type==="rectangle"){var I=h(this,L);return I?L.subtract(I.point).divide(this._radius).getLength()<=1:b.base.call(this,L)}else return L.divide(this.size).getLength()<=.5},_hitTestSelf:function b(L,I,B,j){var Y=!1,Z=this._style,ie=I.stroke&&Z.hasStroke(),pe=I.fill&&Z.hasFill();if(ie||pe){var me=this._type,de=this._radius,le=ie?Z.getStrokeWidth()/2:0,we=I._tolerancePadding.add(dt._getStrokePadding(le,!Z.getStrokeScaling()&&j));if(me==="rectangle"){var Ve=we.multiply(2),ke=h(this,L,Ve);if(ke)Y=f(L.subtract(ke.point),de,we,ke.quadrant);else{var ye=new H(this._size).setCenter(0,0),xe=ye.expand(Ve),ce=ye.expand(Ve.negate());Y=xe._containsPoint(L)&&!ce._containsPoint(L)}}else Y=f(L,de,we)}return Y?new Te(ie?"stroke":"fill",this):b.base.apply(this,arguments)}}},{statics:new function(){function h(f,b,L,I,B){var j=s.create(W.prototype);return j._type=f,j._size=L,j._radius=I,j._initialize(s.getNamed(B),b),j}return{Circle:function(){var f=arguments,b=D.readNamed(f,"center"),L=s.readNamed(f,"radius");return h("circle",b,new w(L*2),L,f)},Rectangle:function(){var f=arguments,b=H.readNamed(f,"rectangle"),L=w.min(w.readNamed(f,"radius"),b.getSize(!0).divide(2));return h("rectangle",b.getCenter(!0),b.getSize(!0),L,f)},Ellipse:function(){var f=arguments,b=W._readEllipse(f),L=b.radius;return h("ellipse",b.center,L.multiply(2),L,f)},_readEllipse:function(f){var b,L;if(s.hasNamed(f,"radius"))b=D.readNamed(f,"center"),L=w.readNamed(f,"radius");else{var I=H.readNamed(f,"rectangle");b=I.getCenter(!0),L=I.getSize(!0).divide(2)}return{center:b,radius:L}}}}}),J=fe.extend({_class:"Raster",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!1,handle:!1},_serializeFields:{crossOrigin:null,source:null},_prioritize:["crossOrigin"],_smoothing:"low",beans:!0,initialize:function(f,b){if(!this._initialize(f,b!==t&&D.read(arguments))){var L,I=typeof f,B=I==="string"?r.getElementById(f):I==="object"?f:null;if(B&&B!==fe.NO_INSERT){if(B.getContext||B.naturalHeight!=null)L=B;else if(B){var j=w.read(arguments);j.isZero()||(L=Xe.getCanvas(j))}}L?this.setImage(L):this.setSource(f)}this._size||(this._size=new w,this._loaded=!1)},_equals:function(h){return this.getSource()===h.getSource()},copyContent:function(h){var f=h._image,b=h._canvas;if(f)this._setImage(f);else if(b){var L=Xe.getCanvas(h._size);L.getContext("2d").drawImage(b,0,0),this._setImage(L)}this._crossOrigin=h._crossOrigin},getSize:function(){var h=this._size;return new N(h?h.width:0,h?h.height:0,this,"setSize")},setSize:function(h,f){var b=w.read(arguments);if(b.equals(this._size))f&&this.clear();else if(b.width>0&&b.height>0){var L=!f&&this.getElement();this._setImage(Xe.getCanvas(b)),L&&this.getContext(!0).drawImage(L,0,0,b.width,b.height)}else this._canvas&&Xe.release(this._canvas),this._size=b.clone()},getWidth:function(){return this._size?this._size.width:0},setWidth:function(h){this.setSize(h,this.getHeight())},getHeight:function(){return this._size?this._size.height:0},setHeight:function(h){this.setSize(this.getWidth(),h)},getLoaded:function(){return this._loaded},isEmpty:function(){var h=this._size;return!h||h.width===0&&h.height===0},getResolution:function(){var h=this._matrix,f=new D(0,0).transform(h),b=new D(1,0).transform(h).subtract(f),L=new D(0,1).transform(h).subtract(f);return new w(72/b.getLength(),72/L.getLength())},getPpi:"#getResolution",getImage:function(){return this._image},setImage:function(h){var f=this;function b(L){var I=f.getView(),B=L&&L.type||"load";I&&f.responds(B)&&(ct=I._scope,f.emit(B,new is(L)))}this._setImage(h),this._loaded?setTimeout(b,0):h&&Oi.add(h,{load:function(L){f._setImage(h),b(L)},error:b})},_setImage:function(h){this._canvas&&Xe.release(this._canvas),h&&h.getContext?(this._image=null,this._canvas=h,this._loaded=!0):(this._image=h,this._canvas=null,this._loaded=!!(h&&h.src&&h.complete)),this._size=new w(h?h.naturalWidth||h.width:0,h?h.naturalHeight||h.height:0),this._context=null,this._changed(1033)},getCanvas:function(){if(!this._canvas){var h=Xe.getContext(this._size);try{this._image&&h.drawImage(this._image,0,0),this._canvas=h.canvas}catch{Xe.release(h)}}return this._canvas},setCanvas:"#setImage",getContext:function(h){return this._context||(this._context=this.getCanvas().getContext("2d")),h&&(this._image=null,this._changed(1025)),this._context},setContext:function(h){this._context=h},getSource:function(){var h=this._image;return h&&h.src||this.toDataURL()},setSource:function(h){var f=new e.Image,b=this._crossOrigin;b&&(f.crossOrigin=b),h&&(f.src=h),this.setImage(f)},getCrossOrigin:function(){var h=this._image;return h&&h.crossOrigin||this._crossOrigin||""},setCrossOrigin:function(h){this._crossOrigin=h;var f=this._image;f&&(f.crossOrigin=h)},getSmoothing:function(){return this._smoothing},setSmoothing:function(h){this._smoothing=typeof h=="string"?h:h?"low":"off",this._changed(257)},getElement:function(){return this._canvas||this._loaded&&this._image}},{beans:!1,getSubCanvas:function(){var h=H.read(arguments),f=Xe.getContext(h.getSize());return f.drawImage(this.getCanvas(),h.x,h.y,h.width,h.height,0,0,h.width,h.height),f.canvas},getSubRaster:function(){var h=H.read(arguments),f=new J(fe.NO_INSERT);return f._setImage(this.getSubCanvas(h)),f.translate(h.getCenter().subtract(this.getSize().divide(2))),f._matrix.prepend(this._matrix),f.insertAbove(this),f},toDataURL:function(){var h=this._image,f=h&&h.src;if(/^data:/.test(f))return f;var b=this.getCanvas();return b?b.toDataURL.apply(b,arguments):null},drawImage:function(h){var f=D.read(arguments,1);this.getContext(!0).drawImage(h,f.x,f.y)},getAverageColor:function(h){var f,b;if(h?h instanceof nt?(b=h,f=h.getBounds()):typeof h=="object"&&("width"in h?f=new H(h):"x"in h&&(f=new H(h.x-.5,h.y-.5,1,1))):f=this.getBounds(),!f)return null;var L=32,I=Math.min(f.width,L),B=Math.min(f.height,L),j=J._sampleContext;j?j.clearRect(0,0,L+1,L+1):j=J._sampleContext=Xe.getContext(new w(L)),j.save();var Y=new ae().scale(I/f.width,B/f.height).translate(-f.x,-f.y);Y.applyToContext(j),b&&b.draw(j,new s({clip:!0,matrices:[Y]})),this._matrix.applyToContext(j);var Z=this.getElement(),ie=this._size;Z&&j.drawImage(Z,-ie.width/2,-ie.height/2),j.restore();for(var pe=j.getImageData(.5,.5,Math.ceil(I),Math.ceil(B)).data,me=[0,0,0],de=0,le=0,we=pe.length;le<we;le+=4){var Ve=pe[le+3];de+=Ve,Ve/=255,me[0]+=pe[le]*Ve,me[1]+=pe[le+1]*Ve,me[2]+=pe[le+2]*Ve}for(var le=0;le<3;le++)me[le]/=de;return de?ti.read(me):null},getPixel:function(){var h=D.read(arguments),f=this.getContext().getImageData(h.x,h.y,1,1).data;return new ti("rgb",[f[0]/255,f[1]/255,f[2]/255],f[3]/255)},setPixel:function(){var h=arguments,f=D.read(h),b=ti.read(h),L=b._convert("rgb"),I=b._alpha,B=this.getContext(!0),j=B.createImageData(1,1),Y=j.data;Y[0]=L[0]*255,Y[1]=L[1]*255,Y[2]=L[2]*255,Y[3]=I!=null?I*255:255,B.putImageData(j,f.x,f.y)},clear:function(){var h=this._size;this.getContext(!0).clearRect(0,0,h.width+1,h.height+1)},createImageData:function(){var h=w.read(arguments);return this.getContext().createImageData(h.width,h.height)},getImageData:function(){var h=H.read(arguments);return h.isEmpty()&&(h=new H(this._size)),this.getContext().getImageData(h.x,h.y,h.width,h.height)},putImageData:function(h){var f=D.read(arguments,1);this.getContext(!0).putImageData(h,f.x,f.y)},setImageData:function(h){this.setSize(h),this.getContext(!0).putImageData(h,0,0)},_getBounds:function(h,f){var b=new H(this._size).setCenter(0,0);return h?h._transformBounds(b):b},_hitTestSelf:function(h){if(this._contains(h)){var f=this;return new Te("pixel",f,{offset:h.add(f._size.divide(2)).round(),color:{get:function(){return f.getPixel(this.offset)}}})}},_draw:function(h,f,b){var L=this.getElement();if(L&&L.width>0&&L.height>0){h.globalAlpha=m.clamp(this._opacity,0,1),this._setStyles(h,f,b);var I=this._smoothing,B=I==="off";Pi.setPrefixed(h,B?"imageSmoothingEnabled":"imageSmoothingQuality",B?!1:I),h.drawImage(L,-this._size.width/2,-this._size.height/2)}},_canComposite:function(){return!0}}),Ue=fe.extend({_class:"SymbolItem",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!0},_serializeFields:{symbol:null},initialize:function(f,b){this._initialize(f,b!==t&&D.read(arguments,1))||this.setDefinition(f instanceof gt?f:new gt(f))},_equals:function(h){return this._definition===h._definition},copyContent:function(h){this.setDefinition(h._definition)},getDefinition:function(){return this._definition},setDefinition:function(h){this._definition=h,this._changed(9)},getSymbol:"#getDefinition",setSymbol:"#setDefinition",isEmpty:function(){return this._definition._item.isEmpty()},_getBounds:function(h,f){var b=this._definition._item;return b._getCachedBounds(b._matrix.prepended(h),f)},_hitTestSelf:function(h,f,b){var L=f.extend({all:!1}),I=this._definition._item._hitTest(h,L,b);return I&&(I.item=this),I},_draw:function(h,f){this._definition._item.draw(h,f)}}),gt=s.extend({_class:"SymbolDefinition",initialize:function(f,b){this._id=O.get(),this.project=ct.project,f&&this.setItem(f,b)},_serialize:function(h,f){return f.add(this,function(){return s.serialize([this._class,this._item],h,!1,f)})},_changed:function(h){h&8&&fe._clearBoundsCache(this),h&1&&this.project._changed(h)},getItem:function(){return this._item},setItem:function(h,f){h._symbol&&(h=h.clone()),this._item&&(this._item._symbol=null),this._item=h,h.remove(),h.setSelected(!1),f||h.setPosition(new D),h._symbol=this,this._changed(9)},getDefinition:"#getItem",setDefinition:"#setItem",place:function(h){return new Ue(this,h)},clone:function(){return new gt(this._item.clone(!1))},equals:function(h){return h===this||h&&this._item.equals(h._item)||!1}}),Te=s.extend({_class:"HitResult",initialize:function(f,b,L){this.type=f,this.item=b,L&&this.inject(L)},statics:{getOptions:function(h){var f=h&&s.read(h);return new s({type:null,tolerance:ct.settings.hitTolerance,fill:!f,stroke:!f,segments:!f,handles:!1,ends:!1,position:!1,center:!1,bounds:!1,guides:!1,selected:!1},f)}}}),Et=s.extend({_class:"Segment",beans:!0,_selection:0,initialize:function(f,b,L,I,B,j){var Y=arguments.length,Z,ie,pe,me;Y>0&&(f==null||typeof f=="object"?Y===1&&f&&"point"in f?(Z=f.point,ie=f.handleIn,pe=f.handleOut,me=f.selection):(Z=f,ie=b,pe=L,me=I):(Z=[f,b],ie=L!==t?[L,I]:null,pe=B!==t?[B,j]:null)),new Bt(Z,this,"_point"),new Bt(ie,this,"_handleIn"),new Bt(pe,this,"_handleOut"),me&&this.setSelection(me)},_serialize:function(h,f){var b=this._point,L=this._selection,I=L||this.hasHandles()?[b,this._handleIn,this._handleOut]:b;return L&&I.push(L),s.serialize(I,h,!0,f)},_changed:function(h){var f=this._path;if(f){var b=f._curves,L=this._index,I;b&&((!h||h===this._point||h===this._handleIn)&&(I=L>0?b[L-1]:f._closed?b[b.length-1]:null)&&I._changed(),(!h||h===this._point||h===this._handleOut)&&(I=b[L])&&I._changed()),f._changed(41)}},getPoint:function(){return this._point},setPoint:function(){this._point.set(D.read(arguments))},getHandleIn:function(){return this._handleIn},setHandleIn:function(){this._handleIn.set(D.read(arguments))},getHandleOut:function(){return this._handleOut},setHandleOut:function(){this._handleOut.set(D.read(arguments))},hasHandles:function(){return!this._handleIn.isZero()||!this._handleOut.isZero()},isSmooth:function(){var h=this._handleIn,f=this._handleOut;return!h.isZero()&&!f.isZero()&&h.isCollinear(f)},clearHandles:function(){this._handleIn._set(0,0),this._handleOut._set(0,0)},getSelection:function(){return this._selection},setSelection:function(h){var f=this._selection,b=this._path;this._selection=h=h||0,b&&h!==f&&(b._updateSelection(this,f,h),b._changed(257))},_changeSelection:function(h,f){var b=this._selection;this.setSelection(f?b|h:b&~h)},isSelected:function(){return!!(this._selection&7)},setSelected:function(h){this._changeSelection(7,h)},getIndex:function(){return this._index!==t?this._index:null},getPath:function(){return this._path||null},getCurve:function(){var h=this._path,f=this._index;return h?(f>0&&!h._closed&&f===h._segments.length-1&&f--,h.getCurves()[f]||null):null},getLocation:function(){var h=this.getCurve();return h?new At(h,this===h._segment1?0:1):null},getNext:function(){var h=this._path&&this._path._segments;return h&&(h[this._index+1]||this._path._closed&&h[0])||null},smooth:function(h,f,b){var L=h||{},I=L.type,B=L.factor,j=this.getPrevious(),Y=this.getNext(),Z=(j||this)._point,ie=this._point,pe=(Y||this)._point,me=Z.getDistance(ie),de=ie.getDistance(pe);if(!I||I==="catmull-rom"){var le=B===t?.5:B,we=Math.pow(me,le),Ve=we*we,ke=Math.pow(de,le),ye=ke*ke;if(!f&&j){var xe=2*ye+3*ke*we+Ve,ce=3*ke*(ke+we);this.setHandleIn(ce!==0?new D((ye*Z._x+xe*ie._x-Ve*pe._x)/ce-ie._x,(ye*Z._y+xe*ie._y-Ve*pe._y)/ce-ie._y):new D)}if(!b&&Y){var xe=2*Ve+3*we*ke+ye,ce=3*we*(we+ke);this.setHandleOut(ce!==0?new D((Ve*pe._x+xe*ie._x-ye*Z._x)/ce-ie._x,(Ve*pe._y+xe*ie._y-ye*Z._y)/ce-ie._y):new D)}}else if(I==="geometric"){if(j&&Y){var Se=Z.subtract(pe),Ie=B===t?.4:B,Me=Ie*me/(me+de);f||this.setHandleIn(Se.multiply(Me)),b||this.setHandleOut(Se.multiply(Me-Ie))}}else throw new Error("Smoothing method '"+I+"' not supported.")},getPrevious:function(){var h=this._path&&this._path._segments;return h&&(h[this._index-1]||this._path._closed&&h[h.length-1])||null},isFirst:function(){return!this._index},isLast:function(){var h=this._path;return h&&this._index===h._segments.length-1||!1},reverse:function(){var h=this._handleIn,f=this._handleOut,b=h.clone();h.set(f),f.set(b)},reversed:function(){return new Et(this._point,this._handleOut,this._handleIn)},remove:function(){return this._path?!!this._path.removeSegment(this._index):!1},clone:function(){return new Et(this._point,this._handleIn,this._handleOut)},equals:function(h){return h===this||h&&this._class===h._class&&this._point.equals(h._point)&&this._handleIn.equals(h._handleIn)&&this._handleOut.equals(h._handleOut)||!1},toString:function(){var h=["point: "+this._point];return this._handleIn.isZero()||h.push("handleIn: "+this._handleIn),this._handleOut.isZero()||h.push("handleOut: "+this._handleOut),"{ "+h.join(", ")+" }"},transform:function(h){this._transformCoordinates(h,new Array(6),!0),this._changed()},interpolate:function(h,f,b){var L=1-b,I=b,B=h._point,j=f._point,Y=h._handleIn,Z=f._handleIn,ie=f._handleOut,pe=h._handleOut;this._point._set(L*B._x+I*j._x,L*B._y+I*j._y,!0),this._handleIn._set(L*Y._x+I*Z._x,L*Y._y+I*Z._y,!0),this._handleOut._set(L*pe._x+I*ie._x,L*pe._y+I*ie._y,!0),this._changed()},_transformCoordinates:function(h,f,b){var L=this._point,I=!b||!this._handleIn.isZero()?this._handleIn:null,B=!b||!this._handleOut.isZero()?this._handleOut:null,j=L._x,Y=L._y,Z=2;return f[0]=j,f[1]=Y,I&&(f[Z++]=I._x+j,f[Z++]=I._y+Y),B&&(f[Z++]=B._x+j,f[Z++]=B._y+Y),h&&(h._transformCoordinates(f,f,Z/2),j=f[0],Y=f[1],b?(L._x=j,L._y=Y,Z=2,I&&(I._x=f[Z++]-j,I._y=f[Z++]-Y),B&&(B._x=f[Z++]-j,B._y=f[Z++]-Y)):(I||(f[Z++]=j,f[Z++]=Y),B||(f[Z++]=j,f[Z++]=Y))),f}}),Bt=D.extend({initialize:function(f,b,L){var I,B,j;if(!f)I=B=0;else if((I=f[0])!==t)B=f[1];else{var Y=f;(I=Y.x)===t&&(Y=D.read(arguments),I=Y.x),B=Y.y,j=Y.selected}this._x=I,this._y=B,this._owner=b,b[L]=this,j&&this.setSelected(!0)},_set:function(h,f){return this._x=h,this._y=f,this._owner._changed(this),this},getX:function(){return this._x},setX:function(h){this._x=h,this._owner._changed(this)},getY:function(){return this._y},setY:function(h){this._y=h,this._owner._changed(this)},isZero:function(){var h=m.isZero;return h(this._x)&&h(this._y)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(h){this._owner._changeSelection(this._getSelection(),h)},_getSelection:function(){var h=this._owner;return this===h._point?1:this===h._handleIn?2:this===h._handleOut?4:0}}),Ke=s.extend({_class:"Curve",beans:!0,initialize:function(f,b,L,I,B,j,Y,Z){var ie=arguments.length,pe,me,de,le,we,Ve;ie===3?(this._path=f,pe=b,me=L):ie?ie===1?"segment1"in f?(pe=new Et(f.segment1),me=new Et(f.segment2)):"point1"in f?(de=f.point1,we=f.handle1,Ve=f.handle2,le=f.point2):Array.isArray(f)&&(de=[f[0],f[1]],le=[f[6],f[7]],we=[f[2]-f[0],f[3]-f[1]],Ve=[f[4]-f[6],f[5]-f[7]]):ie===2?(pe=new Et(f),me=new Et(b)):ie===4?(de=f,we=b,Ve=L,le=I):ie===8&&(de=[f,b],le=[Y,Z],we=[L-f,I-b],Ve=[B-Y,j-Z]):(pe=new Et,me=new Et),this._segment1=pe||new Et(de,null,we),this._segment2=me||new Et(le,Ve,null)},_serialize:function(h,f){return s.serialize(this.hasHandles()?[this.getPoint1(),this.getHandle1(),this.getHandle2(),this.getPoint2()]:[this.getPoint1(),this.getPoint2()],h,!0,f)},_changed:function(){this._length=this._bounds=t},clone:function(){return new Ke(this._segment1,this._segment2)},toString:function(){var h=["point1: "+this._segment1._point];return this._segment1._handleOut.isZero()||h.push("handle1: "+this._segment1._handleOut),this._segment2._handleIn.isZero()||h.push("handle2: "+this._segment2._handleIn),h.push("point2: "+this._segment2._point),"{ "+h.join(", ")+" }"},classify:function(){return Ke.classify(this.getValues())},remove:function(){var h=!1;if(this._path){var f=this._segment2,b=f._handleOut;h=f.remove(),h&&this._segment1._handleOut.set(b)}return h},getPoint1:function(){return this._segment1._point},setPoint1:function(){this._segment1._point.set(D.read(arguments))},getPoint2:function(){return this._segment2._point},setPoint2:function(){this._segment2._point.set(D.read(arguments))},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(){this._segment1._handleOut.set(D.read(arguments))},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(){this._segment2._handleIn.set(D.read(arguments))},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var h=this._path&&this._path._curves;return h&&(h[this._segment1._index+1]||this._path._closed&&h[0])||null},getPrevious:function(){var h=this._path&&this._path._curves;return h&&(h[this._segment1._index-1]||this._path._closed&&h[h.length-1])||null},isFirst:function(){return!this._segment1._index},isLast:function(){var h=this._path;return h&&this._segment1._index===h._curves.length-1||!1},isSelected:function(){return this.getPoint1().isSelected()&&this.getHandle1().isSelected()&&this.getHandle2().isSelected()&&this.getPoint2().isSelected()},setSelected:function(h){this.getPoint1().setSelected(h),this.getHandle1().setSelected(h),this.getHandle2().setSelected(h),this.getPoint2().setSelected(h)},getValues:function(h){return Ke.getValues(this._segment1,this._segment2,h)},getPoints:function(){for(var h=this.getValues(),f=[],b=0;b<8;b+=2)f.push(new D(h[b],h[b+1]));return f}},{getLength:function(){return this._length==null&&(this._length=Ke.getLength(this.getValues(),0,1)),this._length},getArea:function(){return Ke.getArea(this.getValues())},getLine:function(){return new oe(this._segment1._point,this._segment2._point)},getPart:function(h,f){return new Ke(Ke.getPart(this.getValues(),h,f))},getPartLength:function(h,f){return Ke.getLength(this.getValues(),h,f)},divideAt:function(h){return this.divideAtTime(h&&h.curve===this?h.time:this.getTimeAt(h))},divideAtTime:function(h,f){var b=1e-8,L=1-b,I=null;if(h>=b&&h<=L){var B=Ke.subdivide(this.getValues(),h),j=B[0],Y=B[1],Z=f||this.hasHandles(),ie=this._segment1,pe=this._segment2,me=this._path;Z&&(ie._handleOut._set(j[2]-j[0],j[3]-j[1]),pe._handleIn._set(Y[4]-Y[6],Y[5]-Y[7]));var de=j[6],le=j[7],we=new Et(new D(de,le),Z&&new D(j[4]-de,j[5]-le),Z&&new D(Y[2]-de,Y[3]-le));me?(me.insert(ie._index+1,we),I=this.getNext()):(this._segment2=we,this._changed(),I=new Ke(we,pe))}return I},splitAt:function(h){var f=this._path;return f?f.splitAt(h):null},splitAtTime:function(h){return this.splitAt(this.getLocationAtTime(h))},divide:function(h,f){return this.divideAtTime(h===t?.5:f?h:this.getTimeAt(h))},split:function(h,f){return this.splitAtTime(h===t?.5:f?h:this.getTimeAt(h))},reversed:function(){return new Ke(this._segment2.reversed(),this._segment1.reversed())},clearHandles:function(){this._segment1._handleOut._set(0,0),this._segment2._handleIn._set(0,0)},statics:{getValues:function(h,f,b,L){var I=h._point,B=h._handleOut,j=f._handleIn,Y=f._point,Z=I.x,ie=I.y,pe=Y.x,me=Y.y,de=L?[Z,ie,Z,ie,pe,me,pe,me]:[Z,ie,Z+B._x,ie+B._y,pe+j._x,me+j._y,pe,me];return b&&b._transformCoordinates(de,de,4),de},subdivide:function(h,f){var b=h[0],L=h[1],I=h[2],B=h[3],j=h[4],Y=h[5],Z=h[6],ie=h[7];f===t&&(f=.5);var pe=1-f,me=pe*b+f*I,de=pe*L+f*B,le=pe*I+f*j,we=pe*B+f*Y,Ve=pe*j+f*Z,ke=pe*Y+f*ie,ye=pe*me+f*le,xe=pe*de+f*we,ce=pe*le+f*Ve,Se=pe*we+f*ke,Ie=pe*ye+f*ce,Me=pe*xe+f*Se;return[[b,L,me,de,ye,xe,Ie,Me],[Ie,Me,ce,Se,Ve,ke,Z,ie]]},getMonoCurves:function(h,f){var b=[],L=f?0:1,I=h[L+0],B=h[L+2],j=h[L+4],Y=h[L+6];if(I>=B==B>=j&&B>=j==j>=Y||Ke.isStraight(h))b.push(h);else{var Z=3*(B-j)-I+Y,ie=2*(I+j)-4*B,pe=B-I,me=1e-8,de=1-me,le=[],we=m.solveQuadratic(Z,ie,pe,le,me,de);if(!we)b.push(h);else{le.sort();var Ve=le[0],ke=Ke.subdivide(h,Ve);b.push(ke[0]),we>1&&(Ve=(le[1]-Ve)/(1-Ve),ke=Ke.subdivide(ke[1],Ve),b.push(ke[0])),b.push(ke[1])}}return b},solveCubic:function(h,f,b,L,I,B){var j=h[f],Y=h[f+2],Z=h[f+4],ie=h[f+6],pe=0;if(!(j<b&&ie<b&&Y<b&&Z<b||j>b&&ie>b&&Y>b&&Z>b)){var me=3*(Y-j),de=3*(Z-Y)-me,le=ie-j-me-de;pe=m.solveCubic(le,de,me,j-b,L,I,B)}return pe},getTimeOf:function(h,f){var b=new D(h[0],h[1]),L=new D(h[6],h[7]),I=1e-12,B=1e-7,j=f.isClose(b,I)?0:f.isClose(L,I)?1:null;if(j===null)for(var Y=[f.x,f.y],Z=[],ie=0;ie<2;ie++)for(var pe=Ke.solveCubic(h,ie,Y[ie],Z,0,1),me=0;me<pe;me++){var de=Z[me];if(f.isClose(Ke.getPoint(h,de),B))return de}return f.isClose(b,B)?0:f.isClose(L,B)?1:null},getNearestTime:function(h,f){if(Ke.isStraight(h)){var b=h[0],L=h[1],I=h[6],B=h[7],j=I-b,Y=B-L,Z=j*j+Y*Y;if(Z===0)return 0;var ie=((f.x-b)*j+(f.y-L)*Y)/Z;return ie<1e-12?0:ie>.999999999999?1:Ke.getTimeOf(h,new D(b+ie*j,L+ie*Y))}var pe=100,me=1/0,de=0;function le(ke){if(ke>=0&&ke<=1){var ye=f.getDistance(Ke.getPoint(h,ke),!0);if(ye<me)return me=ye,de=ke,!0}}for(var we=0;we<=pe;we++)le(we/pe);for(var Ve=1/(pe*2);Ve>1e-8;)!le(de-Ve)&&!le(de+Ve)&&(Ve/=2);return de},getPart:function(h,f,b){var L=f>b;if(L){var I=f;f=b,b=I}return f>0&&(h=Ke.subdivide(h,f)[1]),b<1&&(h=Ke.subdivide(h,(b-f)/(1-f))[0]),L?[h[6],h[7],h[4],h[5],h[2],h[3],h[0],h[1]]:h},isFlatEnough:function(h,f){var b=h[0],L=h[1],I=h[2],B=h[3],j=h[4],Y=h[5],Z=h[6],ie=h[7],pe=3*I-2*b-Z,me=3*B-2*L-ie,de=3*j-2*Z-b,le=3*Y-2*ie-L;return Math.max(pe*pe,de*de)+Math.max(me*me,le*le)<=16*f*f},getArea:function(h){var f=h[0],b=h[1],L=h[2],I=h[3],B=h[4],j=h[5],Y=h[6],Z=h[7];return 3*((Z-b)*(L+B)-(Y-f)*(I+j)+I*(f-B)-L*(b-j)+Z*(B+f/3)-Y*(j+b/3))/20},getBounds:function(h){for(var f=h.slice(0,2),b=f.slice(),L=[0,0],I=0;I<2;I++)Ke._addBounds(h[I],h[I+2],h[I+4],h[I+6],I,0,f,b,L);return new H(f[0],f[1],b[0]-f[0],b[1]-f[1])},_addBounds:function(h,f,b,L,I,B,j,Y,Z){function ie(Ie,Me){var ze=Ie-Me,Ge=Ie+Me;ze<j[I]&&(j[I]=ze),Ge>Y[I]&&(Y[I]=Ge)}B/=2;var pe=j[I]+B,me=Y[I]-B;if(h<pe||f<pe||b<pe||L<pe||h>me||f>me||b>me||L>me)if(f<h!=f<L&&b<h!=b<L)ie(h,0),ie(L,0);else{var de=3*(f-b)-h+L,le=2*(h+b)-4*f,we=f-h,Ve=m.solveQuadratic(de,le,we,Z),ke=1e-8,ye=1-ke;ie(L,0);for(var xe=0;xe<Ve;xe++){var ce=Z[xe],Se=1-ce;ke<=ce&&ce<=ye&&ie(Se*Se*Se*h+3*Se*Se*ce*f+3*Se*ce*ce*b+ce*ce*ce*L,B)}}}}},s.each(["getBounds","getStrokeBounds","getHandleBounds"],function(h){this[h]=function(){this._bounds||(this._bounds={});var f=this._bounds[h];return f||(f=this._bounds[h]=dt[h]([this._segment1,this._segment2],!1,this._path)),f.clone()}},{}),s.each({isStraight:function(h,f,b,L){if(f.isZero()&&b.isZero())return!0;var I=L.subtract(h);if(I.isZero())return!1;if(I.isCollinear(f)&&I.isCollinear(b)){var B=new oe(h,L),j=1e-7;if(B.getDistance(h.add(f))<j&&B.getDistance(L.add(b))<j){var Y=I.dot(I),Z=I.dot(f)/Y,ie=I.dot(b)/Y;return Z>=0&&Z<=1&&ie<=0&&ie>=-1}}return!1},isLinear:function(h,f,b,L){var I=L.subtract(h).divide(3);return f.equals(I)&&b.negate().equals(I)}},function(h,f){this[f]=function(b){var L=this._segment1,I=this._segment2;return h(L._point,L._handleOut,I._handleIn,I._point,b)},this.statics[f]=function(b,L){var I=b[0],B=b[1],j=b[6],Y=b[7];return h(new D(I,B),new D(b[2]-I,b[3]-B),new D(b[4]-j,b[5]-Y),new D(j,Y),L)}},{statics:{},hasHandles:function(){return!this._segment1._handleOut.isZero()||!this._segment2._handleIn.isZero()},hasLength:function(h){return(!this.getPoint1().equals(this.getPoint2())||this.hasHandles())&&this.getLength()>(h||0)},isCollinear:function(h){return h&&this.isStraight()&&h.isStraight()&&this.getLine().isCollinear(h.getLine())},isHorizontal:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).y)<1e-8},isVertical:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).x)<1e-8}}),{beans:!1,getLocationAt:function(h,f){return this.getLocationAtTime(f?h:this.getTimeAt(h))},getLocationAtTime:function(h){return h!=null&&h>=0&&h<=1?new At(this,h):null},getTimeAt:function(h,f){return Ke.getTimeAt(this.getValues(),h,f)},getParameterAt:"#getTimeAt",getTimesWithTangent:function(){var h=D.read(arguments);return h.isZero()?[]:Ke.getTimesWithTangent(this.getValues(),h)},getOffsetAtTime:function(h){return this.getPartLength(0,h)},getLocationOf:function(){return this.getLocationAtTime(this.getTimeOf(D.read(arguments)))},getOffsetOf:function(){var h=this.getLocationOf.apply(this,arguments);return h?h.getOffset():null},getTimeOf:function(){return Ke.getTimeOf(this.getValues(),D.read(arguments))},getParameterOf:"#getTimeOf",getNearestLocation:function(){var h=D.read(arguments),f=this.getValues(),b=Ke.getNearestTime(f,h),L=Ke.getPoint(f,b);return new At(this,b,L,null,h.getDistance(L))},getNearestPoint:function(){var h=this.getNearestLocation.apply(this,arguments);return h&&h.getPoint()}},new function(){var h=["getPoint","getTangent","getNormal","getWeightedTangent","getWeightedNormal","getCurvature"];return s.each(h,function(f){this[f+"At"]=function(b,L){var I=this.getValues();return Ke[f](I,L?b:Ke.getTimeAt(I,b))},this[f+"AtTime"]=function(b){return Ke[f](this.getValues(),b)}},{statics:{_evaluateMethods:h}})},new function(){function h(L){var I=L[0],B=L[1],j=L[2],Y=L[3],Z=L[4],ie=L[5],pe=L[6],me=L[7],de=9*(j-Z)+3*(pe-I),le=6*(I+Z)-12*j,we=3*(j-I),Ve=9*(Y-ie)+3*(me-B),ke=6*(B+ie)-12*Y,ye=3*(Y-B);return function(xe){var ce=(de*xe+le)*xe+we,Se=(Ve*xe+ke)*xe+ye;return Math.sqrt(ce*ce+Se*Se)}}function f(L,I){return Math.max(2,Math.min(16,Math.ceil(Math.abs(I-L)*32)))}function b(L,I,B,j){if(I==null||I<0||I>1)return null;var Y=L[0],Z=L[1],ie=L[2],pe=L[3],me=L[4],de=L[5],le=L[6],we=L[7],Ve=m.isZero;Ve(ie-Y)&&Ve(pe-Z)&&(ie=Y,pe=Z),Ve(me-le)&&Ve(de-we)&&(me=le,de=we);var ke=3*(ie-Y),ye=3*(me-ie)-ke,xe=le-Y-ke-ye,ce=3*(pe-Z),Se=3*(de-pe)-ce,Ie=we-Z-ce-Se,Me,ze;if(B===0)Me=I===0?Y:I===1?le:((xe*I+ye)*I+ke)*I+Y,ze=I===0?Z:I===1?we:((Ie*I+Se)*I+ce)*I+Z;else{var Ge=1e-8,We=1-Ge;if(I<Ge?(Me=ke,ze=ce):I>We?(Me=3*(le-me),ze=3*(we-de)):(Me=(3*xe*I+2*ye)*I+ke,ze=(3*Ie*I+2*Se)*I+ce),j){Me===0&&ze===0&&(I<Ge||I>We)&&(Me=me-ie,ze=de-pe);var je=Math.sqrt(Me*Me+ze*ze);je&&(Me/=je,ze/=je)}if(B===3){var me=6*xe*I+2*ye,de=6*Ie*I+2*Se,rt=Math.pow(Me*Me+ze*ze,3/2);Me=rt!==0?(Me*de-ze*me)/rt:0,ze=0}}return B===2?new D(ze,-Me):new D(Me,ze)}return{statics:{classify:function(L){var I=L[0],B=L[1],j=L[2],Y=L[3],Z=L[4],ie=L[5],pe=L[6],me=L[7],de=I*(me-ie)+B*(Z-pe)+pe*ie-me*Z,le=j*(B-me)+Y*(pe-I)+I*me-B*pe,we=Z*(Y-B)+ie*(I-j)+j*B-Y*I,Ve=3*we,ke=Ve-le,ye=ke-le+de,xe=Math.sqrt(ye*ye+ke*ke+Ve*Ve),ce=xe!==0?1/xe:0,Se=m.isZero,Ie="serpentine";ye*=ce,ke*=ce,Ve*=ce;function Me(je,rt,Je){var lt=rt!==t,ht=lt&&rt>0&&rt<1,_t=lt&&Je>0&&Je<1;return lt&&(!(ht||_t)||je==="loop"&&!(ht&&_t))&&(je="arch",ht=_t=!1),{type:je,roots:ht||_t?ht&&_t?rt<Je?[rt,Je]:[Je,rt]:[ht?rt:Je]:null}}if(Se(ye))return Se(ke)?Me(Se(Ve)?"line":"quadratic"):Me(Ie,Ve/(3*ke));var ze=3*ke*ke-4*ye*Ve;if(Se(ze))return Me("cusp",ke/(2*ye));var Ge=ze>0?Math.sqrt(ze/3):Math.sqrt(-ze),We=2*ye;return Me(ze>0?Ie:"loop",(ke+Ge)/We,(ke-Ge)/We)},getLength:function(L,I,B,j){if(I===t&&(I=0),B===t&&(B=1),Ke.isStraight(L)){var Y=L;B<1&&(Y=Ke.subdivide(Y,B)[0],I/=B),I>0&&(Y=Ke.subdivide(Y,I)[1]);var Z=Y[6]-Y[0],ie=Y[7]-Y[1];return Math.sqrt(Z*Z+ie*ie)}return m.integrate(j||h(L),I,B,f(I,B))},getTimeAt:function(L,I,B){if(B===t&&(B=I<0?1:0),I===0)return B;var j=Math.abs,Y=1e-12,Z=I>0,ie=Z?B:0,pe=Z?1:B,me=h(L),de=Ke.getLength(L,ie,pe,me),le=j(I)-de;if(j(le)<Y)return Z?pe:ie;if(le>Y)return null;var we=I/de,Ve=0;function ke(ye){return Ve+=m.integrate(me,B,ye,f(B,ye)),B=ye,Ve-I}return m.findRoot(ke,me,B+we,ie,pe,32,1e-12)},getPoint:function(L,I){return b(L,I,0,!1)},getTangent:function(L,I){return b(L,I,1,!0)},getWeightedTangent:function(L,I){return b(L,I,1,!1)},getNormal:function(L,I){return b(L,I,2,!0)},getWeightedNormal:function(L,I){return b(L,I,2,!1)},getCurvature:function(L,I){return b(L,I,3,!1).x},getPeaks:function(L){var I=L[0],B=L[1],j=L[2],Y=L[3],Z=L[4],ie=L[5],pe=L[6],me=L[7],de=-I+3*j-3*Z+pe,le=3*I-6*j+3*Z,we=-3*I+3*j,Ve=-B+3*Y-3*ie+me,ke=3*B-6*Y+3*ie,ye=-3*B+3*Y,xe=1e-8,ce=1-xe,Se=[];return m.solveCubic(9*(de*de+Ve*Ve),9*(de*le+ke*Ve),2*(le*le+ke*ke)+3*(we*de+ye*Ve),we*le+ke*ye,Se,xe,ce),Se.sort()}}}},new function(){function h(le,we,Ve,ke,ye,xe,ce){var Se=!ce&&Ve.getPrevious()===ye,Ie=!ce&&Ve!==ye&&Ve.getNext()===ye,Me=1e-8,ze=1-Me;if(ke!==null&&ke>=(Se?Me:0)&&ke<=(Ie?ze:1)&&xe!==null&&xe>=(Ie?Me:0)&&xe<=(Se?ze:1)){var Ge=new At(Ve,ke,null,ce),We=new At(ye,xe,null,ce);Ge._intersection=We,We._intersection=Ge,(!we||we(Ge))&&At.insert(le,Ge,!0)}}function f(le,we,Ve,ke,ye,xe,ce,Se,Ie,Me,ze,Ge,We){if(++Ie>=4096||++Se>=40)return Ie;var je=1e-9,rt=we[0],Je=we[1],lt=we[6],ht=we[7],_t=oe.getSignedDistance,bt=_t(rt,Je,lt,ht,we[2],we[3]),Tt=_t(rt,Je,lt,ht,we[4],we[5]),Jt=bt*Tt>0?3/4:4/9,ii=Jt*Math.min(0,bt,Tt),Rt=Jt*Math.max(0,bt,Tt),Si=_t(rt,Je,lt,ht,le[0],le[1]),bi=_t(rt,Je,lt,ht,le[2],le[3]),_i=_t(rt,Je,lt,ht,le[4],le[5]),mi=_t(rt,Je,lt,ht,le[6],le[7]),Yt=b(Si,bi,_i,mi),Ti=Yt[0],os=Yt[1],St,Wi;if(bt===0&&Tt===0&&Si===0&&bi===0&&_i===0&&mi===0||(St=L(Ti,os,ii,Rt))==null||(Wi=L(Ti.reverse(),os.reverse(),ii,Rt))==null)return Ie;var zi=Me+(ze-Me)*St,Di=Me+(ze-Me)*Wi;if(Math.max(We-Ge,Di-zi)<je){var $s=(zi+Di)/2,Js=(Ge+We)/2;h(ye,xe,ce?ke:Ve,ce?Js:$s,ce?Ve:ke,ce?$s:Js)}else{le=Ke.getPart(le,St,Wi);var ks=We-Ge;if(Wi-St>.8)if(Di-zi>ks){var Vs=Ke.subdivide(le,.5),$s=(zi+Di)/2;Ie=f(we,Vs[0],ke,Ve,ye,xe,!ce,Se,Ie,Ge,We,zi,$s),Ie=f(we,Vs[1],ke,Ve,ye,xe,!ce,Se,Ie,Ge,We,$s,Di)}else{var Vs=Ke.subdivide(we,.5),Js=(Ge+We)/2;Ie=f(Vs[0],le,ke,Ve,ye,xe,!ce,Se,Ie,Ge,Js,zi,Di),Ie=f(Vs[1],le,ke,Ve,ye,xe,!ce,Se,Ie,Js,We,zi,Di)}else ks===0||ks>=je?Ie=f(we,le,ke,Ve,ye,xe,!ce,Se,Ie,Ge,We,zi,Di):Ie=f(le,we,Ve,ke,ye,xe,ce,Se,Ie,zi,Di,Ge,We)}return Ie}function b(le,we,Ve,ke){var ye=[0,le],xe=[1/3,we],ce=[2/3,Ve],Se=[1,ke],Ie=we-(2*le+ke)/3,Me=Ve-(le+2*ke)/3,ze;if(Ie*Me<0)ze=[[ye,xe,Se],[ye,ce,Se]];else{var Ge=Ie/Me;ze=[Ge>=2?[ye,xe,Se]:Ge<=.5?[ye,ce,Se]:[ye,xe,ce,Se],[ye,Se]]}return(Ie||Me)<0?ze.reverse():ze}function L(le,we,Ve,ke){return le[0][1]<Ve?I(le,!0,Ve):we[0][1]>ke?I(we,!1,ke):le[0][0]}function I(le,we,Ve){for(var ke=le[0][0],ye=le[0][1],xe=1,ce=le.length;xe<ce;xe++){var Se=le[xe][0],Ie=le[xe][1];if(we?Ie>=Ve:Ie<=Ve)return Ie===Ve?Se:ke+(Ve-ye)*(Se-ke)/(Ie-ye);ke=Se,ye=Ie}return null}function B(le,we,Ve,ke,ye){var xe=m.isZero;if(xe(ke)&&xe(ye)){var ce=Ke.getTimeOf(le,new D(we,Ve));return ce===null?[]:[ce]}for(var Se=Math.atan2(-ye,ke),Ie=Math.sin(Se),Me=Math.cos(Se),ze=[],Ge=[],We=0;We<8;We+=2){var je=le[We]-we,rt=le[We+1]-Ve;ze.push(je*Me-rt*Ie,je*Ie+rt*Me)}return Ke.solveCubic(ze,1,0,Ge,0,1),Ge}function j(le,we,Ve,ke,ye,xe,ce){for(var Se=we[0],Ie=we[1],Me=we[6],ze=we[7],Ge=B(le,Se,Ie,Me-Se,ze-Ie),We=0,je=Ge.length;We<je;We++){var rt=Ge[We],Je=Ke.getPoint(le,rt),lt=Ke.getTimeOf(we,Je);lt!==null&&h(ye,xe,ce?ke:Ve,ce?lt:rt,ce?Ve:ke,ce?rt:lt)}}function Y(le,we,Ve,ke,ye,xe){var ce=oe.intersect(le[0],le[1],le[6],le[7],we[0],we[1],we[6],we[7]);ce&&h(ye,xe,Ve,Ke.getTimeOf(le,ce),ke,Ke.getTimeOf(we,ce))}function Z(le,we,Ve,ke,ye,xe){var ce=1e-12,Se=Math.min,Ie=Math.max;if(Ie(le[0],le[2],le[4],le[6])+ce>Se(we[0],we[2],we[4],we[6])&&Se(le[0],le[2],le[4],le[6])-ce<Ie(we[0],we[2],we[4],we[6])&&Ie(le[1],le[3],le[5],le[7])+ce>Se(we[1],we[3],we[5],we[7])&&Se(le[1],le[3],le[5],le[7])-ce<Ie(we[1],we[3],we[5],we[7])){var Me=me(le,we);if(Me)for(var ze=0;ze<2;ze++){var Ge=Me[ze];h(ye,xe,Ve,Ge[0],ke,Ge[1],!0)}else{var We=Ke.isStraight(le),je=Ke.isStraight(we),rt=We&&je,Je=We&&!je,lt=ye.length;if((rt?Y:We||je?j:f)(Je?we:le,Je?le:we,Je?ke:Ve,Je?Ve:ke,ye,xe,Je,0,0,0,1,0,1),!rt||ye.length===lt)for(var ze=0;ze<4;ze++){var ht=ze>>1,_t=ze&1,bt=ht*6,Tt=_t*6,Jt=new D(le[bt],le[bt+1]),ii=new D(we[Tt],we[Tt+1]);Jt.isClose(ii,ce)&&h(ye,xe,Ve,ht,ke,_t)}}}return ye}function ie(le,we,Ve,ke){var ye=Ke.classify(le);if(ye.type==="loop"){var xe=ye.roots;h(Ve,ke,we,xe[0],we,xe[1])}return Ve}function pe(le,we,Ve,ke,ye,xe){var ce=1e-7,Se=!we;Se&&(we=le);for(var Ie=le.length,Me=we.length,ze=new Array(Ie),Ge=Se?ze:new Array(Me),We=[],je=0;je<Ie;je++)ze[je]=le[je].getValues(ke);if(!Se)for(var je=0;je<Me;je++)Ge[je]=we[je].getValues(ye);for(var rt=c.findCurveBoundsCollisions(ze,Ge,ce),Je=0;Je<Ie;Je++){var lt=le[Je],ht=ze[Je];Se&&ie(ht,lt,We,Ve);var _t=rt[Je];if(_t)for(var bt=0;bt<_t.length;bt++){if(xe&&We.length)return We;var Tt=_t[bt];if(!Se||Tt>Je){var Jt=we[Tt],ii=Ge[Tt];Z(ht,ii,lt,Jt,We,Ve)}}}return We}function me(le,we){function Ve(mi){var Yt=mi[6]-mi[0],Ti=mi[7]-mi[1];return Yt*Yt+Ti*Ti}var ke=Math.abs,ye=oe.getDistance,xe=1e-8,ce=1e-7,Se=Ke.isStraight(le),Ie=Ke.isStraight(we),Me=Se&&Ie,ze=Ve(le)<Ve(we),Ge=ze?we:le,We=ze?le:we,je=Ge[0],rt=Ge[1],Je=Ge[6]-je,lt=Ge[7]-rt;if(ye(je,rt,Je,lt,We[0],We[1],!0)<ce&&ye(je,rt,Je,lt,We[6],We[7],!0)<ce)!Me&&ye(je,rt,Je,lt,Ge[2],Ge[3],!0)<ce&&ye(je,rt,Je,lt,Ge[4],Ge[5],!0)<ce&&ye(je,rt,Je,lt,We[2],We[3],!0)<ce&&ye(je,rt,Je,lt,We[4],We[5],!0)<ce&&(Se=Ie=Me=!0);else if(Me)return null;if(Se^Ie)return null;for(var ht=[le,we],_t=[],bt=0;bt<4&&_t.length<2;bt++){var Tt=bt&1,Jt=Tt^1,ii=bt>>1,Rt=Ke.getTimeOf(ht[Tt],new D(ht[Jt][ii?6:0],ht[Jt][ii?7:1]));if(Rt!=null){var Si=Tt?[ii,Rt]:[Rt,ii];(!_t.length||ke(Si[0]-_t[0][0])>xe&&ke(Si[1]-_t[0][1])>xe)&&_t.push(Si)}if(bt>2&&!_t.length)break}if(_t.length!==2)_t=null;else if(!Me){var bi=Ke.getPart(le,_t[0][0],_t[1][0]),_i=Ke.getPart(we,_t[0][1],_t[1][1]);(ke(_i[2]-bi[2])>ce||ke(_i[3]-bi[3])>ce||ke(_i[4]-bi[4])>ce||ke(_i[5]-bi[5])>ce)&&(_t=null)}return _t}function de(le,we){var Ve=le[0],ke=le[1],ye=le[2],xe=le[3],ce=le[4],Se=le[5],Ie=le[6],Me=le[7],ze=we.normalize(),Ge=ze.x,We=ze.y,je=3*Ie-9*ce+9*ye-3*Ve,rt=3*Me-9*Se+9*xe-3*ke,Je=6*ce-12*ye+6*Ve,lt=6*Se-12*xe+6*ke,ht=3*ye-3*Ve,_t=3*xe-3*ke,bt=2*je*We-2*rt*Ge,Tt=[];if(Math.abs(bt)<m.CURVETIME_EPSILON){var Jt=je*_t-rt*ht,bt=je*lt-rt*Je;if(bt!=0){var ii=-Jt/bt;ii>=0&&ii<=1&&Tt.push(ii)}}else{var Rt=(Je*Je-4*je*ht)*We*We+(-2*Je*lt+4*rt*ht+4*je*_t)*Ge*We+(lt*lt-4*rt*_t)*Ge*Ge,Si=Je*We-lt*Ge;if(Rt>=0&&bt!=0){var bi=Math.sqrt(Rt),_i=-(Si+bi)/bt,mi=(-Si+bi)/bt;_i>=0&&_i<=1&&Tt.push(_i),mi>=0&&mi<=1&&Tt.push(mi)}}return Tt}return{getIntersections:function(le){var we=this.getValues(),Ve=le&&le!==this&&le.getValues();return Ve?Z(we,Ve,this,le,[]):ie(we,this,[])},statics:{getOverlaps:me,getIntersections:pe,getCurveLineIntersections:B,getTimesWithTangent:de}}}),At=s.extend({_class:"CurveLocation",initialize:function(f,b,L,I,B){if(b>=.99999999){var j=f.getNext();j&&(b=0,f=j)}this._setCurve(f),this._time=b,this._point=L||f.getPointAtTime(b),this._overlap=I,this._distance=B,this._intersection=this._next=this._previous=null},_setPath:function(h){this._path=h,this._version=h?h._version:0},_setCurve:function(h){this._setPath(h._path),this._curve=h,this._segment=null,this._segment1=h._segment1,this._segment2=h._segment2},_setSegment:function(h){var f=h.getCurve();f?this._setCurve(f):(this._setPath(h._path),this._segment1=h,this._segment2=null),this._segment=h,this._time=h===this._segment1?0:1,this._point=h._point.clone()},getSegment:function(){var h=this._segment;if(!h){var f=this.getCurve(),b=this.getTime();b===0?h=f._segment1:b===1?h=f._segment2:b!=null&&(h=f.getPartLength(0,b)<f.getPartLength(b,1)?f._segment1:f._segment2),this._segment=h}return h},getCurve:function(){var h=this._path,f=this;h&&h._version!==this._version&&(this._time=this._offset=this._curveOffset=this._curve=null);function b(L){var I=L&&L.getCurve();if(I&&(f._time=I.getTimeOf(f._point))!=null)return f._setCurve(I),I}return this._curve||b(this._segment)||b(this._segment1)||b(this._segment2.getPrevious())},getPath:function(){var h=this.getCurve();return h&&h._path},getIndex:function(){var h=this.getCurve();return h&&h.getIndex()},getTime:function(){var h=this.getCurve(),f=this._time;return h&&f==null?this._time=h.getTimeOf(this._point):f},getParameter:"#getTime",getPoint:function(){return this._point},getOffset:function(){var h=this._offset;if(h==null){h=0;var f=this.getPath(),b=this.getIndex();if(f&&b!=null)for(var L=f.getCurves(),I=0;I<b;I++)h+=L[I].getLength();this._offset=h+=this.getCurveOffset()}return h},getCurveOffset:function(){var h=this._curveOffset;if(h==null){var f=this.getCurve(),b=this.getTime();this._curveOffset=h=b!=null&&f&&f.getPartLength(0,b)}return h},getIntersection:function(){return this._intersection},getDistance:function(){return this._distance},divide:function(){var h=this.getCurve(),f=h&&h.divideAtTime(this.getTime());return f&&this._setSegment(f._segment1),f},split:function(){var h=this.getCurve(),f=h._path,b=h&&h.splitAtTime(this.getTime());return b&&this._setSegment(f.getLastSegment()),b},equals:function(h,f){var b=this===h;if(!b&&h instanceof At){var L=this.getCurve(),I=h.getCurve(),B=L._path,j=I._path;if(B===j){var Y=Math.abs,Z=1e-7,ie=Y(this.getOffset()-h.getOffset()),pe=!f&&this._intersection,me=!f&&h._intersection;b=(ie<Z||B&&Y(B.getLength()-ie)<Z)&&(!pe&&!me||pe&&me&&pe.equals(me,!0))}}return b},toString:function(){var h=[],f=this.getPoint(),b=y.instance;f&&h.push("point: "+f);var L=this.getIndex();L!=null&&h.push("index: "+L);var I=this.getTime();return I!=null&&h.push("time: "+b.number(I)),this._distance!=null&&h.push("distance: "+b.number(this._distance)),"{ "+h.join(", ")+" }"},isTouching:function(){var h=this._intersection;if(h&&this.getTangent().isCollinear(h.getTangent())){var f=this.getCurve(),b=h.getCurve();return!(f.isStraight()&&b.isStraight()&&f.getLine().intersect(b.getLine()))}return!1},isCrossing:function(){var h=this._intersection;if(!h)return!1;var f=this.getTime(),b=h.getTime(),L=1e-8,I=1-L,B=f>=L&&f<=I,j=b>=L&&b<=I;if(B&&j)return!this.isTouching();var Y=this.getCurve(),Z=Y&&f<L?Y.getPrevious():Y,ie=h.getCurve(),pe=ie&&b<L?ie.getPrevious():ie;if(f>I&&(Y=Y.getNext()),b>I&&(ie=ie.getNext()),!Z||!Y||!pe||!ie)return!1;var me=[];function de(Ge,We){var je=Ge.getValues(),rt=Ke.classify(je).roots||Ke.getPeaks(je),Je=rt.length,lt=Ke.getLength(je,We&&Je?rt[Je-1]:0,!We&&Je?rt[0]:1);me.push(Je?lt:lt/32)}function le(Ge,We,je){return We<je?Ge>We&&Ge<je:Ge>We||Ge<je}B||(de(Z,!0),de(Y,!1)),j||(de(pe,!0),de(ie,!1));var we=this.getPoint(),Ve=Math.min.apply(Math,me),ke=B?Y.getTangentAtTime(f):Y.getPointAt(Ve).subtract(we),ye=B?ke.negate():Z.getPointAt(-Ve).subtract(we),xe=j?ie.getTangentAtTime(b):ie.getPointAt(Ve).subtract(we),ce=j?xe.negate():pe.getPointAt(-Ve).subtract(we),Se=ye.getAngle(),Ie=ke.getAngle(),Me=ce.getAngle(),ze=xe.getAngle();return!!(B?le(Se,Me,ze)^le(Ie,Me,ze)&&le(Se,ze,Me)^le(Ie,ze,Me):le(Me,Se,Ie)^le(ze,Se,Ie)&&le(Me,Ie,Se)^le(ze,Ie,Se))},hasOverlap:function(){return!!this._overlap}},s.each(Ke._evaluateMethods,function(h){var f=h+"At";this[h]=function(){var b=this.getCurve(),L=this.getTime();return L!=null&&b&&b[f](L,!0)}},{preserve:!0}),new function(){function h(f,b,L){var I=f.length,B=0,j=I-1;function Y(we,Ve){for(var ke=we+Ve;ke>=-1&&ke<=I;ke+=Ve){var ye=f[(ke%I+I)%I];if(!b.getPoint().isClose(ye.getPoint(),1e-7))break;if(b.equals(ye))return ye}return null}for(;B<=j;){var Z=B+j>>>1,ie=f[Z],pe;if(L&&(pe=b.equals(ie)?ie:Y(Z,-1)||Y(Z,1)))return b._overlap&&(pe._overlap=pe._intersection._overlap=!0),pe;var me=b.getPath(),de=ie.getPath(),le=me!==de?me._id-de._id:b.getIndex()+b.getTime()-(ie.getIndex()+ie.getTime());le<0?j=Z-1:B=Z+1}return f.splice(B,0,b),b}return{statics:{insert:h,expand:function(f){for(var b=f.slice(),L=f.length-1;L>=0;L--)h(b,f[L]._intersection,!1);return b}}}}),nt=fe.extend({_class:"PathItem",_selectBounds:!1,_canScaleStroke:!0,beans:!0,initialize:function(){},statics:{create:function(h){var f,b,L;if(s.isPlainObject(h)?(b=h.segments,f=h.pathData):Array.isArray(h)?b=h:typeof h=="string"&&(f=h),b){var I=b[0];L=I&&Array.isArray(I[0])}else f&&(L=(f.match(/m/gi)||[]).length>1||/z\s*\S+/i.test(f));var B=L?Mt:dt;return new B(h)}},_asPathItem:function(){return this},isClockwise:function(){return this.getArea()>=0},setClockwise:function(h){this.isClockwise()!=(h=!!h)&&this.reverse()},setPathData:function(h){var f=h&&h.match(/[mlhvcsqtaz][^mlhvcsqtaz]*/ig),b,L=!1,I,B,j=new D,Y=new D;function Z(ce,Se){var Ie=+b[ce];return L&&(Ie+=j[Se]),Ie}function ie(ce){return new D(Z(ce,"x"),Z(ce+1,"y"))}this.clear();for(var pe=0,me=f&&f.length;pe<me;pe++){var de=f[pe],le=de[0],we=le.toLowerCase();b=de.match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g);var Ve=b&&b.length;switch(L=le===we,I==="z"&&!/[mz]/.test(we)&&this.moveTo(j),we){case"m":case"l":for(var ke=we==="m",ye=0;ye<Ve;ye+=2)this[ke?"moveTo":"lineTo"](j=ie(ye)),ke&&(Y=j,ke=!1);B=j;break;case"h":case"v":var xe=we==="h"?"x":"y";j=j.clone();for(var ye=0;ye<Ve;ye++)j[xe]=Z(ye,xe),this.lineTo(j);B=j;break;case"c":for(var ye=0;ye<Ve;ye+=6)this.cubicCurveTo(ie(ye),B=ie(ye+2),j=ie(ye+4));break;case"s":for(var ye=0;ye<Ve;ye+=4)this.cubicCurveTo(/[cs]/.test(I)?j.multiply(2).subtract(B):j,B=ie(ye),j=ie(ye+2)),I=we;break;case"q":for(var ye=0;ye<Ve;ye+=4)this.quadraticCurveTo(B=ie(ye),j=ie(ye+2));break;case"t":for(var ye=0;ye<Ve;ye+=2)this.quadraticCurveTo(B=/[qt]/.test(I)?j.multiply(2).subtract(B):j,j=ie(ye)),I=we;break;case"a":for(var ye=0;ye<Ve;ye+=7)this.arcTo(j=ie(ye+5),new w(+b[ye],+b[ye+1]),+b[ye+2],+b[ye+4],+b[ye+3]);break;case"z":this.closePath(1e-12),j=Y;break}I=we}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_contains:function(h){var f=h.isInside(this.getBounds({internal:!0,handle:!0}))?this._getWinding(h):{};return f.onPath||!!(this.getFillRule()==="evenodd"?f.windingL&1||f.windingR&1:f.winding)},getIntersections:function(h,f,b,L){var I=this===h||!h,B=this._matrix._orNullIfIdentity(),j=I?B:(b||h._matrix)._orNullIfIdentity();return I||this.getBounds(B).intersects(h.getBounds(j),1e-12)?Ke.getIntersections(this.getCurves(),!I&&h.getCurves(),f,B,j,L):[]},getCrossings:function(h){return this.getIntersections(h,function(f){return f.isCrossing()})},getNearestLocation:function(){for(var h=D.read(arguments),f=this.getCurves(),b=1/0,L=null,I=0,B=f.length;I<B;I++){var j=f[I].getNearestLocation(h);j._distance<b&&(b=j._distance,L=j)}return L},getNearestPoint:function(){var h=this.getNearestLocation.apply(this,arguments);return h&&h.getPoint()},interpolate:function(h,f,b){var L=!this._children,I=L?"_segments":"_children",B=h[I],j=f[I],Y=this[I];if(!B||!j||B.length!==j.length)throw new Error("Invalid operands in interpolate() call: "+h+", "+f);var Z=Y.length,ie=j.length;if(Z<ie)for(var pe=L?Et:dt,me=Z;me<ie;me++)this.add(new pe);else Z>ie&&this[L?"removeSegments":"removeChildren"](ie,Z);for(var me=0;me<ie;me++)Y[me].interpolate(B[me],j[me],b);L&&(this.setClosed(h._closed),this._changed(9))},compare:function(h){var f=!1;if(h){var b=this._children||[this],L=h._children?h._children.slice():[h],I=b.length,B=L.length,j=[],Y=0;f=!0;for(var Z=c.findItemBoundsCollisions(b,L,m.GEOMETRIC_EPSILON),ie=I-1;ie>=0&&f;ie--){var pe=b[ie];f=!1;var me=Z[ie];if(me)for(var de=me.length-1;de>=0&&!f;de--)pe.compare(L[me[de]])&&(j[me[de]]||(j[me[de]]=!0,Y++),f=!0)}f=f&&Y===B}return f}}),dt=nt.extend({_class:"Path",_serializeFields:{segments:[],closed:!1},initialize:function(f){this._closed=!1,this._segments=[],this._version=0;var b=arguments,L=Array.isArray(f)?typeof f[0]=="object"?f:b:f&&f.size===t&&(f.x!==t||f.point!==t)?b:null;L&&L.length>0?this.setSegments(L):(this._curves=t,this._segmentSelection=0,!L&&typeof f=="string"&&(this.setPathData(f),f=null)),this._initialize(!L&&f)},_equals:function(h){return this._closed===h._closed&&s.equals(this._segments,h._segments)},copyContent:function(h){this.setSegments(h._segments),this._closed=h._closed},_changed:function h(f){if(h.base.call(this,f),f&8){if(this._length=this._area=t,f&32)this._version++;else if(this._curves)for(var b=0,L=this._curves.length;b<L;b++)this._curves[b]._changed()}else f&64&&(this._bounds=t)},getStyle:function(){var h=this._parent;return(h instanceof Mt?h:this)._style},getSegments:function(){return this._segments},setSegments:function(h){var f=this.isFullySelected(),b=h&&h.length;if(this._segments.length=0,this._segmentSelection=0,this._curves=t,b){var L=h[b-1];typeof L=="boolean"&&(this.setClosed(L),b--),this._add(Et.readList(h,0,{},b))}f&&this.setFullySelected(!0)},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var h=this._curves,f=this._segments;if(!h){var b=this._countCurves();h=this._curves=new Array(b);for(var L=0;L<b;L++)h[L]=new Ke(this,f[L],f[L+1]||f[0])}return h},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var h=this.getCurves();return h[h.length-1]},isClosed:function(){return this._closed},setClosed:function(h){if(this._closed!=(h=!!h)){if(this._closed=h,this._curves){var f=this._curves.length=this._countCurves();h&&(this._curves[f-1]=new Ke(this,this._segments[f-1],this._segments[0]))}this._changed(41)}}},{beans:!0,getPathData:function(h,f){var b=this._segments,L=b.length,I=new y(f),B=new Array(6),j=!0,Y,Z,ie,pe,me,de,le,we,Ve=[];function ke(xe,ce){if(xe._transformCoordinates(h,B),Y=B[0],Z=B[1],j)Ve.push("M"+I.pair(Y,Z)),j=!1;else if(me=B[2],de=B[3],me===Y&&de===Z&&le===ie&&we===pe){if(!ce){var Se=Y-ie,Ie=Z-pe;Ve.push(Se===0?"v"+I.number(Ie):Ie===0?"h"+I.number(Se):"l"+I.pair(Se,Ie))}}else Ve.push("c"+I.pair(le-ie,we-pe)+" "+I.pair(me-ie,de-pe)+" "+I.pair(Y-ie,Z-pe));ie=Y,pe=Z,le=B[4],we=B[5]}if(!L)return"";for(var ye=0;ye<L;ye++)ke(b[ye]);return this._closed&&L>0&&(ke(b[0],!0),Ve.push("z")),Ve.join("")},isEmpty:function(){return!this._segments.length},_transformContent:function(h){for(var f=this._segments,b=new Array(6),L=0,I=f.length;L<I;L++)f[L]._transformCoordinates(h,b,!0);return!0},_add:function(h,j){for(var b=this._segments,L=this._curves,I=h.length,B=j==null,j=B?b.length:j,Y=0;Y<I;Y++){var Z=h[Y];Z._path&&(Z=h[Y]=Z.clone()),Z._path=this,Z._index=j+Y,Z._selection&&this._updateSelection(Z,0,Z._selection)}if(B)s.push(b,h);else{b.splice.apply(b,[j,0].concat(h));for(var Y=j+I,ie=b.length;Y<ie;Y++)b[Y]._index=Y}if(L){var pe=this._countCurves(),me=j>0&&j+I-1===pe?j-1:j,de=me,le=Math.min(me+I,pe);h._curves&&(L.splice.apply(L,[me,0].concat(h._curves)),de+=h._curves.length);for(var Y=de;Y<le;Y++)L.splice(Y,0,new Ke(this,null,null));this._adjustCurves(me,le)}return this._changed(41),h},_adjustCurves:function(h,f){for(var b=this._segments,L=this._curves,I,B=h;B<f;B++)I=L[B],I._path=this,I._segment1=b[B],I._segment2=b[B+1]||b[0],I._changed();(I=L[this._closed&&!h?b.length-1:h-1])&&(I._segment2=b[h]||b[0],I._changed()),(I=L[f])&&(I._segment1=b[f],I._changed())},_countCurves:function(){var h=this._segments.length;return!this._closed&&h>0?h-1:h},add:function(h){var f=arguments;return f.length>1&&typeof h!="number"?this._add(Et.readList(f)):this._add([Et.read(f)])[0]},insert:function(h,f){var b=arguments;return b.length>2&&typeof f!="number"?this._add(Et.readList(b,1),h):this._add([Et.read(b,1)],h)[0]},addSegment:function(){return this._add([Et.read(arguments)])[0]},insertSegment:function(h){return this._add([Et.read(arguments,1)],h)[0]},addSegments:function(h){return this._add(Et.readList(h))},insertSegments:function(h,f){return this._add(Et.readList(f),h)},removeSegment:function(h){return this.removeSegments(h,h+1)[0]||null},removeSegments:function(h,f,b){h=h||0,f=s.pick(f,this._segments.length);var L=this._segments,I=this._curves,B=L.length,j=L.splice(h,f-h),Y=j.length;if(!Y)return j;for(var Z=0;Z<Y;Z++){var ie=j[Z];ie._selection&&this._updateSelection(ie,ie._selection,0),ie._index=ie._path=null}for(var Z=h,pe=L.length;Z<pe;Z++)L[Z]._index=Z;if(I){for(var me=h>0&&f===B+(this._closed?1:0)?h-1:h,I=I.splice(me,Y),Z=I.length-1;Z>=0;Z--)I[Z]._path=null;b&&(j._curves=I.slice(1)),this._adjustCurves(me,me)}return this._changed(41),j},clear:"#removeSegments",hasHandles:function(){for(var h=this._segments,f=0,b=h.length;f<b;f++)if(h[f].hasHandles())return!0;return!1},clearHandles:function(){for(var h=this._segments,f=0,b=h.length;f<b;f++)h[f].clearHandles()},getLength:function(){if(this._length==null){for(var h=this.getCurves(),f=0,b=0,L=h.length;b<L;b++)f+=h[b].getLength();this._length=f}return this._length},getArea:function(){var h=this._area;if(h==null){var f=this._segments,b=this._closed;h=0;for(var L=0,I=f.length;L<I;L++){var B=L+1===I;h+=Ke.getArea(Ke.getValues(f[L],f[B?0:L+1],null,B&&!b))}this._area=h}return h},isFullySelected:function(){var h=this._segments.length;return this.isSelected()&&h>0&&this._segmentSelection===h*7},setFullySelected:function(h){h&&this._selectSegments(!0),this.setSelected(h)},setSelection:function h(f){f&1||this._selectSegments(!1),h.base.call(this,f)},_selectSegments:function(h){var f=this._segments,b=f.length,L=h?7:0;this._segmentSelection=L*b;for(var I=0;I<b;I++)f[I]._selection=L},_updateSelection:function(h,f,b){h._selection=b;var L=this._segmentSelection+=b-f;L>0&&this.setSelected(!0)},divideAt:function(h){var f=this.getLocationAt(h),b;return f&&(b=f.getCurve().divideAt(f.getCurveOffset()))?b._segment1:null},splitAt:function(h){var f=this.getLocationAt(h),b=f&&f.index,L=f&&f.time,I=1e-8,B=1-I;L>B&&(b++,L=0);var j=this.getCurves();if(b>=0&&b<j.length){L>=I&&j[b++].divideAtTime(L);var Y=this.removeSegments(b,this._segments.length,!0),Z;return this._closed?(this.setClosed(!1),Z=this):(Z=new dt(fe.NO_INSERT),Z.insertAbove(this),Z.copyAttributes(this)),Z._add(Y,0),this.addSegment(Y[0]),Z}return null},split:function(h,f){var b,L=f===t?h:(b=this.getCurves()[h])&&b.getLocationAtTime(f);return L!=null?this.splitAt(L):null},join:function(h,f){var b=f||0;if(h&&h!==this){var L=h._segments,I=this.getLastSegment(),B=h.getLastSegment();if(!B)return this;I&&I._point.isClose(B._point,b)&&h.reverse();var j=h.getFirstSegment();if(I&&I._point.isClose(j._point,b))I.setHandleOut(j._handleOut),this._add(L.slice(1));else{var Y=this.getFirstSegment();Y&&Y._point.isClose(j._point,b)&&h.reverse(),B=h.getLastSegment(),Y&&Y._point.isClose(B._point,b)?(Y.setHandleIn(B._handleIn),this._add(L.slice(0,L.length-1),0)):this._add(L.slice())}h._closed&&this._add([L[0]]),h.remove()}var Z=this.getFirstSegment(),ie=this.getLastSegment();return Z!==ie&&Z._point.isClose(ie._point,b)&&(Z.setHandleIn(ie._handleIn),ie.remove(),this.setClosed(!0)),this},reduce:function(h){for(var f=this.getCurves(),b=h&&h.simplify,L=b?1e-7:0,I=f.length-1;I>=0;I--){var B=f[I];!B.hasHandles()&&(!B.hasLength(L)||b&&B.isCollinear(B.getNext()))&&B.remove()}return this},reverse:function(){this._segments.reverse();for(var h=0,f=this._segments.length;h<f;h++){var b=this._segments[h],L=b._handleIn;b._handleIn=b._handleOut,b._handleOut=L,b._index=h}this._curves=null,this._changed(9)},flatten:function(h){for(var f=new zt(this,h||.25,256,!0),b=f.parts,L=b.length,I=[],B=0;B<L;B++)I.push(new Et(b[B].curve.slice(0,2)));!this._closed&&L>0&&I.push(new Et(b[L-1].curve.slice(6))),this.setSegments(I)},simplify:function(h){var f=new xt(this).fit(h||2.5);return f&&this.setSegments(f),!!f},smooth:function(h){var f=this,b=h||{},L=b.type||"asymmetric",I=this._segments,B=I.length,j=this._closed;function Y(Ti,os){var St=Ti&&Ti.index;if(St!=null){var Wi=Ti.path;if(Wi&&Wi!==f)throw new Error(Ti._class+" "+St+" of "+Wi+" is not part of "+f);os&&Ti instanceof Ke&&St++}else St=typeof Ti=="number"?Ti:os;return Math.min(St<0&&j?St%B:St<0?St+B:St,B-1)}var Z=j&&b.from===t&&b.to===t,ie=Y(b.from,0),pe=Y(b.to,B-1);if(ie>pe)if(j)ie-=B;else{var me=ie;ie=pe,pe=me}if(/^(?:asymmetric|continuous)$/.test(L)){var de=L==="asymmetric",le=Math.min,we=pe-ie+1,Ve=we-1,ke=Z?le(we,4):1,ye=ke,xe=ke,ce=[];if(j||(ye=le(1,ie),xe=le(1,B-pe-1)),Ve+=ye+xe,Ve<=1)return;for(var Se=0,Ie=ie-ye;Se<=Ve;Se++,Ie++)ce[Se]=I[(Ie<0?Ie+B:Ie)%B]._point;for(var Me=ce[0]._x+2*ce[1]._x,ze=ce[0]._y+2*ce[1]._y,Ge=2,We=Ve-1,je=[Me],rt=[ze],Je=[Ge],lt=[],ht=[],Se=1;Se<Ve;Se++){var _t=Se<We,bt=_t||de?1:2,Tt=_t?4:de?2:7,Jt=_t?4:de?3:8,ii=_t?2:de?0:1,Rt=bt/Ge;Ge=Je[Se]=Tt-Rt,Me=je[Se]=Jt*ce[Se]._x+ii*ce[Se+1]._x-Rt*Me,ze=rt[Se]=Jt*ce[Se]._y+ii*ce[Se+1]._y-Rt*ze}lt[We]=je[We]/Je[We],ht[We]=rt[We]/Je[We];for(var Se=Ve-2;Se>=0;Se--)lt[Se]=(je[Se]-lt[Se+1])/Je[Se],ht[Se]=(rt[Se]-ht[Se+1])/Je[Se];lt[Ve]=(3*ce[Ve]._x-lt[We])/2,ht[Ve]=(3*ce[Ve]._y-ht[We])/2;for(var Se=ye,Si=Ve-xe,Ie=ie;Se<=Si;Se++,Ie++){var bi=I[Ie<0?Ie+B:Ie],_i=bi._point,mi=lt[Se]-_i._x,Yt=ht[Se]-_i._y;(Z||Se<Si)&&bi.setHandleOut(mi,Yt),(Z||Se>ye)&&bi.setHandleIn(-mi,-Yt)}}else for(var Se=ie;Se<=pe;Se++)I[Se<0?Se+B:Se].smooth(b,!Z&&Se===ie,!Z&&Se===pe)},toShape:function(h){if(!this._closed)return null;var f=this._segments,b,L,I,B;function j(de,le){var we=f[de],Ve=we.getNext(),ke=f[le],ye=ke.getNext();return we._handleOut.isZero()&&Ve._handleIn.isZero()&&ke._handleOut.isZero()&&ye._handleIn.isZero()&&Ve._point.subtract(we._point).isCollinear(ye._point.subtract(ke._point))}function Y(de){var le=f[de],we=le.getPrevious(),Ve=le.getNext();return we._handleOut.isZero()&&le._handleIn.isZero()&&le._handleOut.isZero()&&Ve._handleIn.isZero()&&le._point.subtract(we._point).isOrthogonal(Ve._point.subtract(le._point))}function Z(de){var le=f[de],we=le.getNext(),Ve=le._handleOut,ke=we._handleIn,ye=.5522847498307936;if(Ve.isOrthogonal(ke)){var xe=le._point,ce=we._point,Se=new oe(xe,Ve,!0).intersect(new oe(ce,ke,!0),!0);return Se&&m.isZero(Ve.getLength()/Se.subtract(xe).getLength()-ye)&&m.isZero(ke.getLength()/Se.subtract(ce).getLength()-ye)}return!1}function ie(de,le){return f[de]._point.getDistance(f[le]._point)}if(!this.hasHandles()&&f.length===4&&j(0,2)&&j(1,3)&&Y(1)?(b=W.Rectangle,L=new w(ie(0,3),ie(0,1)),B=f[1]._point.add(f[2]._point).divide(2)):f.length===8&&Z(0)&&Z(2)&&Z(4)&&Z(6)&&j(1,5)&&j(3,7)?(b=W.Rectangle,L=new w(ie(1,6),ie(0,3)),I=L.subtract(new w(ie(0,7),ie(1,2))).divide(2),B=f[3]._point.add(f[4]._point).divide(2)):f.length===4&&Z(0)&&Z(1)&&Z(2)&&Z(3)&&(m.isZero(ie(0,2)-ie(1,3))?(b=W.Circle,I=ie(0,2)/2):(b=W.Ellipse,I=new w(ie(2,0)/2,ie(3,1)/2)),B=f[1]._point),b){var pe=this.getPosition(!0),me=new b({center:pe,size:L,radius:I,insert:!1});return me.copyAttributes(this,!0),me._matrix.prepend(this._matrix),me.rotate(B.subtract(pe).getAngle()+90),(h===t||h)&&me.insertAbove(this),me}return null},toPath:"#clone",compare:function h(f){if(!f||f instanceof Mt)return h.base.call(this,f);var b=this.getCurves(),L=f.getCurves(),I=b.length,B=L.length;if(!I||!B)return I==B;for(var j=b[0].getValues(),Y=[],Z=0,ie,pe=0,me,de=0;de<B;de++){var ke=L[de].getValues();Y.push(ke);var le=Ke.getOverlaps(j,ke);if(le){ie=!de&&le[0][0]>0?B-1:de,me=le[0][1];break}}for(var we=Math.abs,Ve=1e-8,ke=Y[ie],ye;j&&ke;){var le=Ke.getOverlaps(j,ke);if(le){var xe=le[0][0];if(we(xe-pe)<Ve){pe=le[1][0],pe===1&&(j=++Z<I?b[Z].getValues():null,pe=0);var ce=le[0][1];if(we(ce-me)<Ve){if(ye||(ye=[ie,ce]),me=le[1][1],me===1&&(++ie>=B&&(ie=0),ke=Y[ie]||L[ie].getValues(),me=0),!j)return ye[0]===ie&&ye[1]===me;continue}}}break}return!1},_hitTestSelf:function(h,f,b,L){var I=this,B=this.getStyle(),j=this._segments,Y=j.length,Z=this._closed,ie=f._tolerancePadding,pe=ie,me,de,le,we,Ve,ke,ye=f.stroke&&B.hasStroke(),xe=f.fill&&B.hasFill(),ce=f.curves,Se=ye?B.getStrokeWidth()/2:xe&&f.tolerance>0||ce?0:null;Se!==null&&(Se>0?(me=B.getStrokeJoin(),de=B.getStrokeCap(),le=B.getMiterLimit(),pe=pe.add(dt._getStrokePadding(Se,L))):me=de="round");function Ie(lt,ht){return h.subtract(lt).divide(ht).length<=1}function Me(lt,ht,_t){if(!f.selected||ht.isSelected()){var bt=lt._point;if(ht!==bt&&(ht=ht.add(bt)),Ie(ht,pe))return new Te(_t,I,{segment:lt,point:ht})}}function ze(lt,ht){return(ht||f.segments)&&Me(lt,lt._point,"segment")||!ht&&f.handles&&(Me(lt,lt._handleIn,"handle-in")||Me(lt,lt._handleOut,"handle-out"))}function Ge(lt){we.add(lt)}function We(lt){var ht=Z||lt._index>0&&lt._index<Y-1;if((ht?me:de)==="round")return Ie(lt._point,pe);if(we=new dt({internal:!0,closed:!0}),ht?lt.isSmooth()||dt._addBevelJoin(lt,me,Se,le,null,L,Ge,!0):de==="square"&&dt._addSquareCap(lt,de,Se,null,L,Ge,!0),!we.isEmpty()){var _t;return we.contains(h)||(_t=we.getNearestLocation(h))&&Ie(_t.getPoint(),ie)}}if(f.ends&&!f.segments&&!Z){if(ke=ze(j[0],!0)||ze(j[Y-1],!0))return ke}else if(f.segments||f.handles){for(var je=0;je<Y;je++)if(ke=ze(j[je]))return ke}if(Se!==null){if(Ve=this.getNearestLocation(h),Ve){var rt=Ve.getTime();rt===0||rt===1&&Y>1?We(Ve.getSegment())||(Ve=null):Ie(Ve.getPoint(),pe)||(Ve=null)}if(!Ve&&me==="miter"&&Y>1)for(var je=0;je<Y;je++){var Je=j[je];if(h.getDistance(Je._point)<=le*Se&&We(Je)){Ve=Je.getLocation();break}}}return!Ve&&xe&&this._contains(h)||Ve&&!ye&&!ce?new Te("fill",this):Ve?new Te(ye?"stroke":"curve",this,{location:Ve,point:Ve.getPoint()}):null}},s.each(Ke._evaluateMethods,function(h){this[h+"At"]=function(f){var b=this.getLocationAt(f);return b&&b[h]()}},{beans:!1,getLocationOf:function(){for(var h=D.read(arguments),f=this.getCurves(),b=0,L=f.length;b<L;b++){var I=f[b].getLocationOf(h);if(I)return I}return null},getOffsetOf:function(){var h=this.getLocationOf.apply(this,arguments);return h?h.getOffset():null},getLocationAt:function(h){if(typeof h=="number"){for(var f=this.getCurves(),b=0,L=0,I=f.length;L<I;L++){var B=b,j=f[L];if(b+=j.getLength(),b>h)return j.getLocationAt(h-B)}if(f.length>0&&h<=this.getLength())return new At(f[f.length-1],1)}else if(h&&h.getPath&&h.getPath()===this)return h;return null},getOffsetsWithTangent:function(){var h=D.read(arguments);if(h.isZero())return[];for(var f=[],b=0,L=this.getCurves(),I=0,B=L.length;I<B;I++){for(var j=L[I],Y=j.getTimesWithTangent(h),Z=0,ie=Y.length;Z<ie;Z++){var pe=b+j.getOffsetAtTime(Y[Z]);f.indexOf(pe)<0&&f.push(pe)}b+=j.length}return f}}),new function(){function h(b,L,I,B){if(B<=0)return;var j=B/2,Y=B-2,Z=j-1,ie=new Array(6),pe,me;function de(xe){var ce=ie[xe],Se=ie[xe+1];(pe!=ce||me!=Se)&&(b.beginPath(),b.moveTo(pe,me),b.lineTo(ce,Se),b.stroke(),b.beginPath(),b.arc(ce,Se,j,0,Math.PI*2,!0),b.fill())}for(var le=0,we=L.length;le<we;le++){var Ve=L[le],ke=Ve._selection;if(Ve._transformCoordinates(I,ie),pe=ie[0],me=ie[1],ke&2&&de(2),ke&4&&de(4),b.fillRect(pe-j,me-j,B,B),Y>0&&!(ke&1)){var ye=b.fillStyle;b.fillStyle="#ffffff",b.fillRect(pe-Z,me-Z,Y,Y),b.fillStyle=ye}}}function f(b,L,I){var B=L._segments,j=B.length,Y=new Array(6),Z=!0,ie,pe,me,de,le,we,Ve,ke;function ye(ce){if(I)ce._transformCoordinates(I,Y),ie=Y[0],pe=Y[1];else{var Se=ce._point;ie=Se._x,pe=Se._y}if(Z)b.moveTo(ie,pe),Z=!1;else{if(I)le=Y[2],we=Y[3];else{var Ie=ce._handleIn;le=ie+Ie._x,we=pe+Ie._y}le===ie&&we===pe&&Ve===me&&ke===de?b.lineTo(ie,pe):b.bezierCurveTo(Ve,ke,le,we,ie,pe)}if(me=ie,de=pe,I)Ve=Y[4],ke=Y[5];else{var Ie=ce._handleOut;Ve=me+Ie._x,ke=de+Ie._y}}for(var xe=0;xe<j;xe++)ye(B[xe]);L._closed&&j>0&&ye(B[0])}return{_draw:function(b,L,I,B){var j=L.dontStart,Y=L.dontFinish||L.clip,Z=this.getStyle(),ie=Z.hasFill(),pe=Z.hasStroke(),me=Z.getDashArray(),de=!ct.support.nativeDash&&pe&&me&&me.length;j||b.beginPath(),(ie||pe&&!de||Y)&&(f(b,this,B),this._closed&&b.closePath());function le(ce){return me[(ce%de+de)%de]}if(!Y&&(ie||pe)&&(this._setStyles(b,L,I),ie&&(b.fill(Z.getFillRule()),b.shadowColor="rgba(0,0,0,0)"),pe)){if(de){j||b.beginPath();for(var we=new zt(this,.25,32,!1,B),Ve=we.length,ke=-Z.getDashOffset(),ye,xe=0;ke>0;)ke-=le(xe--)+le(xe--);for(;ke<Ve;)ye=ke+le(xe++),(ke>0||ye>0)&&we.drawPart(b,Math.max(ke,0),Math.max(ye,0)),ke=ye+le(xe++)}b.stroke()}},_drawSelected:function(b,L){b.beginPath(),f(b,this,L),b.stroke(),h(b,this._segments,L,ct.settings.handleSize)}}},new function(){function h(f){var b=f._segments;if(!b.length)throw new Error("Use a moveTo() command first");return b[b.length-1]}return{moveTo:function(){var f=this._segments;f.length===1&&this.removeSegment(0),f.length||this._add([new Et(D.read(arguments))])},moveBy:function(){throw new Error("moveBy() is unsupported on Path items.")},lineTo:function(){this._add([new Et(D.read(arguments))])},cubicCurveTo:function(){var f=arguments,b=D.read(f),L=D.read(f),I=D.read(f),B=h(this);B.setHandleOut(b.subtract(B._point)),this._add([new Et(I,L.subtract(I))])},quadraticCurveTo:function(){var f=arguments,b=D.read(f),L=D.read(f),I=h(this)._point;this.cubicCurveTo(b.add(I.subtract(b).multiply(1/3)),b.add(L.subtract(b).multiply(1/3)),L)},curveTo:function(){var f=arguments,b=D.read(f),L=D.read(f),I=s.pick(s.read(f),.5),B=1-I,j=h(this)._point,Y=b.subtract(j.multiply(B*B)).subtract(L.multiply(I*I)).divide(2*I*B);if(Y.isNaN())throw new Error("Cannot put a curve through points with parameter = "+I);this.quadraticCurveTo(Y,L)},arcTo:function(){var f=arguments,b=Math.abs,L=Math.sqrt,I=h(this),B=I._point,j=D.read(f),Y,Z=s.peek(f),ie=s.pick(Z,!0),pe,me,de,le;if(typeof ie=="boolean")var we=B.add(j).divide(2),Y=we.add(we.subtract(B).rotate(ie?-90:90));else if(s.remain(f)<=2)Y=j,j=D.read(f);else if(!B.equals(j)){var Ve=w.read(f),ke=m.isZero;if(ke(Ve.width)||ke(Ve.height))return this.lineTo(j);var ye=s.read(f),ie=!!s.read(f),xe=!!s.read(f),we=B.add(j).divide(2),ce=B.subtract(we).rotate(-ye),Se=ce.x,Ie=ce.y,Me=b(Ve.width),ze=b(Ve.height),Ge=Me*Me,We=ze*ze,je=Se*Se,rt=Ie*Ie,Je=L(je/Ge+rt/We);if(Je>1&&(Me*=Je,ze*=Je,Ge=Me*Me,We=ze*ze),Je=(Ge*We-Ge*rt-We*je)/(Ge*rt+We*je),b(Je)<1e-12&&(Je=0),Je<0)throw new Error("Cannot create an arc with the given arguments");pe=new D(Me*Ie/ze,-ze*Se/Me).multiply((xe===ie?-1:1)*L(Je)).rotate(ye).add(we),le=new ae().translate(pe).rotate(ye).scale(Me,ze),de=le._inverseTransform(B),me=de.getDirectedAngle(le._inverseTransform(j)),!ie&&me>0?me-=360:ie&&me<0&&(me+=360)}if(Y){var lt=new oe(B.add(Y).divide(2),Y.subtract(B).rotate(90),!0),ht=new oe(Y.add(j).divide(2),j.subtract(Y).rotate(90),!0),_t=new oe(B,j),bt=_t.getSide(Y);if(pe=lt.intersect(ht,!0),!pe){if(!bt)return this.lineTo(j);throw new Error("Cannot create an arc with the given arguments")}de=B.subtract(pe),me=de.getDirectedAngle(j.subtract(pe));var Tt=_t.getSide(pe,!0);Tt===0?me=bt*b(me):bt===Tt&&(me+=me<0?360:-360)}if(me){for(var Jt=1e-5,ii=b(me),Rt=ii>=360?4:Math.ceil((ii-Jt)/90),Si=me/Rt,bi=Si*Math.PI/360,_i=4/3*Math.sin(bi)/(1+Math.cos(bi)),mi=[],Yt=0;Yt<=Rt;Yt++){var ce=j,Ti=null;if(Yt<Rt&&(Ti=de.rotate(90).multiply(_i),le?(ce=le._transformPoint(de),Ti=le._transformPoint(de.add(Ti)).subtract(ce)):ce=pe.add(de)),!Yt)I.setHandleOut(Ti);else{var os=de.rotate(-90).multiply(_i);le&&(os=le._transformPoint(de.add(os)).subtract(ce)),mi.push(new Et(ce,os,Ti))}de=de.rotate(Si)}this._add(mi)}},lineBy:function(){var f=D.read(arguments),b=h(this)._point;this.lineTo(b.add(f))},curveBy:function(){var f=arguments,b=D.read(f),L=D.read(f),I=s.read(f),B=h(this)._point;this.curveTo(B.add(b),B.add(L),I)},cubicCurveBy:function(){var f=arguments,b=D.read(f),L=D.read(f),I=D.read(f),B=h(this)._point;this.cubicCurveTo(B.add(b),B.add(L),B.add(I))},quadraticCurveBy:function(){var f=arguments,b=D.read(f),L=D.read(f),I=h(this)._point;this.quadraticCurveTo(I.add(b),I.add(L))},arcBy:function(){var f=arguments,b=h(this)._point,L=b.add(D.read(f)),I=s.pick(s.peek(f),!0);typeof I=="boolean"?this.arcTo(L,I):this.arcTo(L,b.add(D.read(f)))},closePath:function(f){this.setClosed(!0),this.join(this,f)}}},{_getBounds:function(h,f){var b=f.handle?"getHandleBounds":f.stroke?"getStrokeBounds":"getBounds";return dt[b](this._segments,this._closed,this,h,f)},statics:{getBounds:function(h,f,b,L,I,B){var j=h[0];if(!j)return new H;var Y=new Array(6),Z=j._transformCoordinates(L,new Array(6)),ie=Z.slice(0,2),pe=ie.slice(),me=new Array(2);function de(Ve){Ve._transformCoordinates(L,Y);for(var ke=0;ke<2;ke++)Ke._addBounds(Z[ke],Z[ke+4],Y[ke+2],Y[ke],ke,B?B[ke]:0,ie,pe,me);var ye=Z;Z=Y,Y=ye}for(var le=1,we=h.length;le<we;le++)de(h[le]);return f&&de(j),new H(ie[0],ie[1],pe[0]-ie[0],pe[1]-ie[1])},getStrokeBounds:function(h,f,b,L,I){var B=b.getStyle(),j=B.hasStroke(),Y=B.getStrokeWidth(),Z=j&&b._getStrokeMatrix(L,I),ie=j&&dt._getStrokePadding(Y,Z),pe=dt.getBounds(h,f,b,L,I,ie);if(!j)return pe;var me=Y/2,de=B.getStrokeJoin(),le=B.getStrokeCap(),we=B.getMiterLimit(),Ve=new H(new w(ie));function ke(Me){pe=pe.include(Me)}function ye(Me){pe=pe.unite(Ve.setCenter(Me._point.transform(L)))}function xe(Me,ze){ze==="round"||Me.isSmooth()?ye(Me):dt._addBevelJoin(Me,ze,me,we,L,Z,ke)}function ce(Me,ze){ze==="round"?ye(Me):dt._addSquareCap(Me,ze,me,L,Z,ke)}var Se=h.length-(f?0:1);if(Se>0){for(var Ie=1;Ie<Se;Ie++)xe(h[Ie],de);f?xe(h[0],de):(ce(h[0],le),ce(h[h.length-1],le))}return pe},_getStrokePadding:function(h,f){if(!f)return[h,h];var b=new D(h,0).transform(f),L=new D(0,h).transform(f),I=b.getAngleInRadians(),B=b.getLength(),j=L.getLength(),Y=Math.sin(I),Z=Math.cos(I),ie=Math.tan(I),pe=Math.atan2(j*ie,B),me=Math.atan2(j,ie*B);return[Math.abs(B*Math.cos(pe)*Z+j*Math.sin(pe)*Y),Math.abs(j*Math.sin(me)*Z+B*Math.cos(me)*Y)]},_addBevelJoin:function(h,f,b,L,I,B,j,Y){var Z=h.getCurve(),ie=Z.getPrevious(),pe=Z.getPoint1().transform(I),me=ie.getNormalAtTime(1).multiply(b).transform(B),de=Z.getNormalAtTime(0).multiply(b).transform(B),le=me.getDirectedAngle(de);if((le<0||le>=180)&&(me=me.negate(),de=de.negate()),Y&&j(pe),j(pe.add(me)),f==="miter"){var we=new oe(pe.add(me),new D(-me.y,me.x),!0).intersect(new oe(pe.add(de),new D(-de.y,de.x),!0),!0);we&&pe.getDistance(we)<=L*b&&j(we)}j(pe.add(de))},_addSquareCap:function(h,f,b,L,I,B,j){var Y=h._point.transform(L),Z=h.getLocation(),ie=Z.getNormal().multiply(Z.getTime()===0?b:-b).transform(I);f==="square"&&(j&&(B(Y.subtract(ie)),B(Y.add(ie))),Y=Y.add(ie.rotate(-90))),B(Y.add(ie)),B(Y.subtract(ie))},getHandleBounds:function(h,f,b,L,I){var B=b.getStyle(),j=I.stroke&&B.hasStroke(),Y,Z;if(j){var ie=b._getStrokeMatrix(L,I),pe=B.getStrokeWidth()/2,me=pe;B.getStrokeJoin()==="miter"&&(me=pe*B.getMiterLimit()),B.getStrokeCap()==="square"&&(me=Math.max(me,pe*Math.SQRT2)),Y=dt._getStrokePadding(pe,ie),Z=dt._getStrokePadding(me,ie)}for(var de=new Array(6),le=1/0,we=-le,Ve=le,ke=we,ye=0,xe=h.length;ye<xe;ye++){var ce=h[ye];ce._transformCoordinates(L,de);for(var Se=0;Se<6;Se+=2){var Ie=Se?Y:Z,Me=Ie?Ie[0]:0,ze=Ie?Ie[1]:0,Ge=de[Se],We=de[Se+1],je=Ge-Me,rt=Ge+Me,Je=We-ze,lt=We+ze;je<le&&(le=je),rt>we&&(we=rt),Je<Ve&&(Ve=Je),lt>ke&&(ke=lt)}}return new H(le,Ve,we-le,ke-Ve)}}});dt.inject({statics:new function(){var h=.5522847498307936,f=[new Et([-1,0],[0,h],[0,-h]),new Et([0,-1],[-h,0],[h,0]),new Et([1,0],[0,-h],[0,h]),new Et([0,1],[h,0],[-h,0])];function b(I,B,j){var Y=s.getNamed(j),Z=new dt(Y&&(Y.insert==!0?fe.INSERT:Y.insert==!1?fe.NO_INSERT:null));return Z._add(I),Z._closed=B,Z.set(Y,fe.INSERT)}function L(I,B,j){for(var Y=new Array(4),Z=0;Z<4;Z++){var ie=f[Z];Y[Z]=new Et(ie._point.multiply(B).add(I),ie._handleIn.multiply(B),ie._handleOut.multiply(B))}return b(Y,!0,j)}return{Line:function(){var I=arguments;return b([new Et(D.readNamed(I,"from")),new Et(D.readNamed(I,"to"))],!1,I)},Circle:function(){var I=arguments,B=D.readNamed(I,"center"),j=s.readNamed(I,"radius");return L(B,new w(j),I)},Rectangle:function(){var I=arguments,B=H.readNamed(I,"rectangle"),j=w.readNamed(I,"radius",0,{readNull:!0}),Y=B.getBottomLeft(!0),Z=B.getTopLeft(!0),ie=B.getTopRight(!0),pe=B.getBottomRight(!0),me;if(!j||j.isZero())me=[new Et(Y),new Et(Z),new Et(ie),new Et(pe)];else{j=w.min(j,B.getSize(!0).divide(2));var de=j.width,le=j.height,we=de*h,Ve=le*h;me=[new Et(Y.add(de,0),null,[-we,0]),new Et(Y.subtract(0,le),[0,Ve]),new Et(Z.add(0,le),null,[0,-Ve]),new Et(Z.add(de,0),[-we,0],null),new Et(ie.subtract(de,0),null,[we,0]),new Et(ie.add(0,le),[0,-Ve],null),new Et(pe.subtract(0,le),null,[0,Ve]),new Et(pe.subtract(de,0),[we,0])]}return b(me,!0,I)},RoundRectangle:"#Rectangle",Ellipse:function(){var I=arguments,B=W._readEllipse(I);return L(B.center,B.radius,I)},Oval:"#Ellipse",Arc:function(){var I=arguments,B=D.readNamed(I,"from"),j=D.readNamed(I,"through"),Y=D.readNamed(I,"to"),Z=s.getNamed(I),ie=new dt(Z&&Z.insert==!1&&fe.NO_INSERT);return ie.moveTo(B),ie.arcTo(j,Y),ie.set(Z)},RegularPolygon:function(){for(var I=arguments,B=D.readNamed(I,"center"),j=s.readNamed(I,"sides"),Y=s.readNamed(I,"radius"),Z=360/j,ie=j%3===0,pe=new D(0,ie?-Y:Y),me=ie?-1:.5,de=new Array(j),le=0;le<j;le++)de[le]=new Et(B.add(pe.rotate((le+me)*Z)));return b(de,!0,I)},Star:function(){for(var I=arguments,B=D.readNamed(I,"center"),j=s.readNamed(I,"points")*2,Y=s.readNamed(I,"radius1"),Z=s.readNamed(I,"radius2"),ie=360/j,pe=new D(0,-1),me=new Array(j),de=0;de<j;de++)me[de]=new Et(B.add(pe.rotate(ie*de).multiply(de%2?Z:Y)));return b(me,!0,I)}}}});var Mt=nt.extend({_class:"CompoundPath",_serializeFields:{children:[]},beans:!0,initialize:function(f){this._children=[],this._namedChildren={},this._initialize(f)||(typeof f=="string"?this.setPathData(f):this.addChildren(Array.isArray(f)?f:arguments))},insertChildren:function h(f,b){var L=b,I=L[0];I&&typeof I[0]=="number"&&(L=[L]);for(var B=b.length-1;B>=0;B--){var j=L[B];L===b&&!(j instanceof dt)&&(L=s.slice(L)),Array.isArray(j)?L[B]=new dt({segments:j,insert:!1}):j instanceof Mt&&(L.splice.apply(L,[B,1].concat(j.removeChildren())),j.remove())}return h.base.call(this,f,L)},reduce:function h(f){for(var b=this._children,L=b.length-1;L>=0;L--){var I=b[L].reduce(f);I.isEmpty()&&I.remove()}if(!b.length){var I=new dt(fe.NO_INSERT);return I.copyAttributes(this),I.insertAbove(this),this.remove(),I}return h.base.call(this)},isClosed:function(){for(var h=this._children,f=0,b=h.length;f<b;f++)if(!h[f]._closed)return!1;return!0},setClosed:function(h){for(var f=this._children,b=0,L=f.length;b<L;b++)f[b].setClosed(h)},getFirstSegment:function(){var h=this.getFirstChild();return h&&h.getFirstSegment()},getLastSegment:function(){var h=this.getLastChild();return h&&h.getLastSegment()},getCurves:function(){for(var h=this._children,f=[],b=0,L=h.length;b<L;b++)s.push(f,h[b].getCurves());return f},getFirstCurve:function(){var h=this.getFirstChild();return h&&h.getFirstCurve()},getLastCurve:function(){var h=this.getLastChild();return h&&h.getLastCurve()},getArea:function(){for(var h=this._children,f=0,b=0,L=h.length;b<L;b++)f+=h[b].getArea();return f},getLength:function(){for(var h=this._children,f=0,b=0,L=h.length;b<L;b++)f+=h[b].getLength();return f},getPathData:function(h,f){for(var b=this._children,L=[],I=0,B=b.length;I<B;I++){var j=b[I],Y=j._matrix;L.push(j.getPathData(h&&!Y.isIdentity()?h.appended(Y):h,f))}return L.join("")},_hitTestChildren:function h(f,b,L){return h.base.call(this,f,b.class===dt||b.type==="path"?b:s.set({},b,{fill:!1}),L)},_draw:function(h,f,b,L){var I=this._children;if(I.length){f=f.extend({dontStart:!0,dontFinish:!0}),h.beginPath();for(var B=0,j=I.length;B<j;B++)I[B].draw(h,f,L);if(!f.clip){this._setStyles(h,f,b);var Y=this._style;Y.hasFill()&&(h.fill(Y.getFillRule()),h.shadowColor="rgba(0,0,0,0)"),Y.hasStroke()&&h.stroke()}}},_drawSelected:function(h,f,b){for(var L=this._children,I=0,B=L.length;I<B;I++){var j=L[I],Y=j._matrix;b[j._id]||j._drawSelected(h,Y.isIdentity()?f:f.appended(Y))}}},new function(){function h(f,b){var L=f._children;if(b&&!L.length)throw new Error("Use a moveTo() command first");return L[L.length-1]}return s.each(["lineTo","cubicCurveTo","quadraticCurveTo","curveTo","arcTo","lineBy","cubicCurveBy","quadraticCurveBy","curveBy","arcBy"],function(f){this[f]=function(){var b=h(this,!0);b[f].apply(b,arguments)}},{moveTo:function(){var f=h(this),b=f&&f.isEmpty()?f:new dt(fe.NO_INSERT);b!==f&&this.addChild(b),b.moveTo.apply(b,arguments)},moveBy:function(){var f=h(this,!0),b=f&&f.getLastSegment(),L=D.read(arguments);this.moveTo(b?L.add(b._point):L)},closePath:function(f){h(this,!0).closePath(f)}})},s.each(["reverse","flatten","simplify","smooth"],function(h){this[h]=function(f){for(var b=this._children,L,I=0,B=b.length;I<B;I++)L=b[I][h](f)||L;return L}},{}));nt.inject(new function(){var h=Math.min,f=Math.max,b=Math.abs,L={unite:{1:!0,2:!0},intersect:{2:!0},subtract:{1:!0},exclude:{1:!0,"-1":!0}};function I(ye){return ye._children||[ye]}function B(ye,xe){var ce=ye.clone(!1).reduce({simplify:!0}).transform(null,!0,!0);if(xe){for(var Se=I(ce),Ie=0,Me=Se.length;Ie<Me;Ie++){var ye=Se[Ie];!ye._closed&&!ye.isEmpty()&&(ye.closePath(1e-12),ye.getFirstSegment().setHandleIn(0,0),ye.getLastSegment().setHandleOut(0,0))}ce=ce.resolveCrossings().reorient(ce.getFillRule()==="nonzero",!0)}return ce}function j(ye,xe,ce,Se,Ie){var Me=new Mt(fe.NO_INSERT);return Me.addChildren(ye,!0),Me=Me.reduce({simplify:xe}),Ie&&Ie.insert==!1||Me.insertAbove(Se&&ce.isSibling(Se)&&ce.getIndex()<Se.getIndex()?Se:ce),Me.copyAttributes(ce,!0),Me}function Y(ye){return ye.hasOverlap()||ye.isCrossing()}function Z(ye,xe,ce,Se){if(Se&&(Se.trace==!1||Se.stroke)&&/^(subtract|intersect)$/.test(ce))return ie(ye,xe,ce);var Ie=B(ye,!0),Me=xe&&ye!==xe&&B(xe,!0),ze=L[ce];ze[ce]=!0,Me&&(ze.subtract||ze.exclude)^(Me.isClockwise()^Ie.isClockwise())&&Me.reverse();var Ge=le(At.expand(Ie.getIntersections(Me,Y))),We=I(Ie),je=Me&&I(Me),rt=[],Je=[],lt;function ht(Ti){for(var os=0,St=Ti.length;os<St;os++){var Wi=Ti[os];s.push(rt,Wi._segments),s.push(Je,Wi.getCurves()),Wi._overlapsOnly=!0}}function _t(Ti){for(var os=[],St=0,Wi=Ti&&Ti.length;St<Wi;St++)os.push(Je[Ti[St]]);return os}if(Ge.length){ht(We),je&&ht(je);for(var bt=new Array(Je.length),Tt=0,Jt=Je.length;Tt<Jt;Tt++)bt[Tt]=Je[Tt].getValues();for(var ii=c.findCurveBoundsCollisions(bt,bt,0,!0),Rt={},Tt=0;Tt<Je.length;Tt++){var Si=Je[Tt],bi=Si._path._id,_i=Rt[bi]=Rt[bi]||{};_i[Si.getIndex()]={hor:_t(ii[Tt].hor),ver:_t(ii[Tt].ver)}}for(var Tt=0,Jt=Ge.length;Tt<Jt;Tt++)Ve(Ge[Tt]._segment,Ie,Me,Rt,ze);for(var Tt=0,Jt=rt.length;Tt<Jt;Tt++){var mi=rt[Tt],Yt=mi._intersection;mi._winding||Ve(mi,Ie,Me,Rt,ze),Yt&&Yt._overlap||(mi._path._overlapsOnly=!1)}lt=ke(rt,ze)}else lt=de(je?We.concat(je):We.slice(),function(Ti){return!!ze[Ti]});return j(lt,!0,ye,xe,Se)}function ie(ye,xe,ce){var Se=B(ye),Ie=B(xe),Me=Se.getIntersections(Ie,Y),ze=ce==="subtract",Ge=ce==="divide",We={},je=[];function rt(ht){if(!We[ht._id]&&(Ge||Ie.contains(ht.getPointAt(ht.getLength()/2))^ze))return je.unshift(ht),We[ht._id]=!0}for(var Je=Me.length-1;Je>=0;Je--){var lt=Me[Je].split();lt&&(rt(lt)&&lt.getFirstSegment().setHandleIn(0,0),Se.getLastSegment().setHandleOut(0,0))}return rt(Se),j(je,!1,ye,xe)}function pe(ye,xe){for(var ce=ye;ce;){if(ce===xe)return;ce=ce._previous}for(;ye._next&&ye._next!==xe;)ye=ye._next;if(!ye._next){for(;xe._previous;)xe=xe._previous;ye._next=xe,xe._previous=ye}}function me(ye){for(var xe=ye.length-1;xe>=0;xe--)ye[xe].clearHandles()}function de(ye,xe,ce){var Se=ye&&ye.length;if(Se){var Ie=s.each(ye,function(ii,Rt){this[ii._id]={container:null,winding:ii.isClockwise()?1:-1,index:Rt}},{}),Me=ye.slice().sort(function(ii,Rt){return b(Rt.getArea())-b(ii.getArea())}),ze=Me[0],Ge=c.findItemBoundsCollisions(Me,null,m.GEOMETRIC_EPSILON);ce==null&&(ce=ze.isClockwise());for(var We=0;We<Se;We++){var je=Me[We],rt=Ie[je._id],Je=0,lt=Ge[We];if(lt){for(var ht=null,_t=lt.length-1;_t>=0;_t--)if(lt[_t]<We){ht=ht||je.getInteriorPoint();var bt=Me[lt[_t]];if(bt.contains(ht)){var Tt=Ie[bt._id];Je=Tt.winding,rt.winding+=Je,rt.container=Tt.exclude?Tt.container:bt;break}}}if(xe(rt.winding)===xe(Je))rt.exclude=!0,ye[rt.index]=null;else{var Jt=rt.container;je.setClockwise(Jt?!Jt.isClockwise():ce)}}}return ye}function le(ye,xe,ce){var Se=xe&&[],Ie=1e-8,Me=1-Ie,ze=!1,Ge=ce||[],We=ce&&{},je,rt,Je;function lt(os){return os._path._id+"."+os._segment1._index}for(var ht=(ce&&ce.length)-1;ht>=0;ht--){var _t=ce[ht];_t._path&&(We[lt(_t)]=!0)}for(var ht=ye.length-1;ht>=0;ht--){var bt=ye[ht],Tt=bt._time,Jt=Tt,ii=xe&&!xe(bt),_t=bt._curve,Rt;if(_t&&(_t!==rt?(ze=!_t.hasHandles()||We&&We[lt(_t)],je=[],Je=null,rt=_t):Je>=Ie&&(Tt/=Je)),ii){je&&je.push(bt);continue}else xe&&Se.unshift(bt);if(Je=Jt,Tt<Ie)Rt=_t._segment1;else if(Tt>Me)Rt=_t._segment2;else{var Si=_t.divideAtTime(Tt,!0);ze&&Ge.push(_t,Si),Rt=Si._segment1;for(var bi=je.length-1;bi>=0;bi--){var _i=je[bi];_i._time=(_i._time-Tt)/(1-Tt)}}bt._setSegment(Rt);var mi=Rt._intersection,Yt=bt._intersection;if(mi){pe(mi,Yt);for(var Ti=mi;Ti;)pe(Ti._intersection,mi),Ti=Ti._next}else Rt._intersection=Yt}return ce||me(Ge),Se||ye}function we(ye,xe,ce,Se,Ie){var Me=Array.isArray(xe)?xe:xe[ce?"hor":"ver"],ze=ce?1:0,Ge=ze^1,We=[ye.x,ye.y],je=We[ze],rt=We[Ge],Je=1e-9,lt=1e-6,ht=je-Je,_t=je+Je,bt=0,Tt=0,Jt=0,ii=0,Rt=!1,Si=!1,bi=1,_i=[],mi,Yt;function Ti(Ji){var Es=Ji[Ge+0],gn=Ji[Ge+6];if(!(rt<h(Es,gn)||rt>f(Es,gn))){var Us=Ji[ze+0],qn=Ji[ze+2],mr=Ji[ze+4],Hn=Ji[ze+6];if(Es===gn){(Us<_t&&Hn>ht||Hn<_t&&Us>ht)&&(Rt=!0);return}var nr=rt===Es?0:rt===gn||ht>f(Us,qn,mr,Hn)||_t<h(Us,qn,mr,Hn)?1:Ke.solveCubic(Ji,Ge,rt,_i,0,1)>0?_i[0]:1,sn=nr===0?Us:nr===1?Hn:Ke.getPoint(Ji,nr)[ce?"y":"x"],mn=Es>gn?1:-1,yr=mi[Ge]>mi[Ge+6]?1:-1,yn=mi[ze+6];return rt!==Es?(sn<ht?Jt+=mn:sn>_t?ii+=mn:Rt=!0,sn>je-lt&&sn<je+lt&&(bi/=2)):(mn!==yr?Us<ht?Jt+=mn:Us>_t&&(ii+=mn):Us!=yn&&(yn<_t&&sn>_t?(ii+=mn,Rt=!0):yn>ht&&sn<ht&&(Jt+=mn,Rt=!0)),bi/=4),mi=Ji,!Ie&&sn>ht&&sn<_t&&Ke.getTangent(Ji,nr)[ce?"x":"y"]===0&&we(ye,xe,!ce,Se,!0)}}function os(Ji){var Es=Ji[Ge+0],gn=Ji[Ge+2],Us=Ji[Ge+4],qn=Ji[Ge+6];if(rt<=f(Es,gn,Us,qn)&&rt>=h(Es,gn,Us,qn)){for(var mr=Ji[ze+0],Hn=Ji[ze+2],nr=Ji[ze+4],sn=Ji[ze+6],mn=ht>f(mr,Hn,nr,sn)||_t<h(mr,Hn,nr,sn)?[Ji]:Ke.getMonoCurves(Ji,ce),yr,yn=0,Os=mn.length;yn<Os;yn++)if(yr=Ti(mn[yn]))return yr}}for(var St=0,Wi=Me.length;St<Wi;St++){var zi=Me[St],Di=zi._path,$s=zi.getValues(),Js;if((!St||Me[St-1]._path!==Di)&&(mi=null,Di._closed||(Yt=Ke.getValues(Di.getLastCurve().getSegment2(),zi.getSegment1(),null,!Se),Yt[Ge]!==Yt[Ge+6]&&(mi=Yt)),!mi)){mi=$s;for(var ks=Di.getLastCurve();ks&&ks!==zi;){var Vs=ks.getValues();if(Vs[Ge]!==Vs[Ge+6]){mi=Vs;break}ks=ks.getPrevious()}}if(Js=os($s))return Js;if(St+1===Wi||Me[St+1]._path!==Di){if(Yt&&(Js=os(Yt)))return Js;Rt&&!Jt&&!ii&&(Jt=ii=Di.isClockwise(Se)^ce?1:-1),bt+=Jt,Tt+=ii,Jt=ii=0,Rt&&(Si=!0,Rt=!1),Yt=null}}return bt=b(bt),Tt=b(Tt),{winding:f(bt,Tt),windingL:bt,windingR:Tt,quality:bi,onPath:Si}}function Ve(ye,xe,ce,Se,Ie){var Me=[],ze=ye,Ge=0,Je;do{var We=ye.getCurve();if(We){var je=We.getLength();Me.push({segment:ye,curve:We,length:je}),Ge+=je}ye=ye.getNext()}while(ye&&!ye._intersection&&ye!==ze);for(var rt=[.5,.25,.75],Je={winding:0,quality:-1},lt=.001,ht=1-lt,_t=0;_t<rt.length&&Je.quality<.5;_t++)for(var je=Ge*rt[_t],bt=0,Tt=Me.length;bt<Tt;bt++){var Jt=Me[bt],ii=Jt.length;if(je<=ii){var We=Jt.curve,Rt=We._path,Si=Rt._parent,bi=Si instanceof Mt?Si:Rt,_i=m.clamp(We.getTimeAt(je),lt,ht),mi=We.getPointAtTime(_i),Yt=b(We.getTangentAtTime(_i).y)<Math.SQRT1_2,Ti=null;if(Ie.subtract&&ce){var os=bi===xe?ce:xe,St=os._getWinding(mi,Yt,!0);if(bi===xe&&St.winding||bi===ce&&!St.winding){if(St.quality<1)continue;Ti={winding:0,quality:1}}}Ti=Ti||we(mi,Se[Rt._id][We.getIndex()],Yt,!0),Ti.quality>Je.quality&&(Je=Ti);break}je-=ii}for(var bt=Me.length-1;bt>=0;bt--)Me[bt].segment._winding=Je}function ke(ye,xe){var ce=[],Se;function Ie(Wi){var zi;return!!(Wi&&!Wi._visited&&(!xe||xe[(zi=Wi._winding||{}).winding]&&!(xe.unite&&zi.winding===2&&zi.windingL&&zi.windingR)))}function Me(Wi){if(Wi){for(var zi=0,Di=Se.length;zi<Di;zi++)if(Wi===Se[zi])return!0}return!1}function ze(Wi){for(var zi=Wi._segments,Di=0,$s=zi.length;Di<$s;Di++)zi[Di]._visited=!0}function Ge(Wi,zi){var Di=Wi._intersection,$s=Di,Js=[];zi&&(Se=[Wi]);function ks(Vs,Ji){for(;Vs&&Vs!==Ji;){var Es=Vs._segment,gn=Es&&Es._path;if(gn){var Us=Es.getNext()||gn.getFirstSegment(),qn=Us._intersection;Es!==Wi&&(Me(Es)||Me(Us)||Us&&Ie(Es)&&(Ie(Us)||qn&&Ie(qn._segment)))&&Js.push(Es),zi&&Se.push(Es)}Vs=Vs._next}}if(Di){for(ks(Di);Di&&Di._previous;)Di=Di._previous;ks(Di,$s)}return Js}ye.sort(function(Wi,zi){var Di=Wi._intersection,$s=zi._intersection,Js=!!(Di&&Di._overlap),ks=!!($s&&$s._overlap),Vs=Wi._path,Ji=zi._path;return Js^ks?Js?1:-1:!Di^!$s?Di?1:-1:Vs!==Ji?Vs._id-Ji._id:Wi._index-zi._index});for(var We=0,je=ye.length;We<je;We++){var rt=ye[We],Je=Ie(rt),lt=null,ht=!1,_t=!0,bt=[],Tt,Jt,ii;if(Je&&rt._path._overlapsOnly){var Rt=rt._path,Si=rt._intersection._segment._path;Rt.compare(Si)&&(Rt.getArea()&&ce.push(Rt.clone(!1)),ze(Rt),ze(Si),Je=!1)}for(;Je;){var bi=!lt,_i=Ge(rt,bi),mi=_i.shift(),ht=!bi&&(Me(rt)||Me(mi)),Yt=!ht&&mi;if(bi&&(lt=new dt(fe.NO_INSERT),Tt=null),ht){(rt.isFirst()||rt.isLast())&&(_t=rt._path._closed),rt._visited=!0;break}if(Yt&&Tt&&(bt.push(Tt),Tt=null),Tt||(Yt&&_i.push(rt),Tt={start:lt._segments.length,crossings:_i,visited:Jt=[],handleIn:ii}),Yt&&(rt=mi),!Ie(rt)){lt.removeSegments(Tt.start);for(var Ti=0,os=Jt.length;Ti<os;Ti++)Jt[Ti]._visited=!1;Jt.length=0;do rt=Tt&&Tt.crossings.shift(),(!rt||!rt._path)&&(rt=null,Tt=bt.pop(),Tt&&(Jt=Tt.visited,ii=Tt.handleIn));while(Tt&&!Ie(rt));if(!rt)break}var St=rt.getNext();lt.add(new Et(rt._point,ii,St&&rt._handleOut)),rt._visited=!0,Jt.push(rt),rt=St||rt._path.getFirstSegment(),ii=St&&St._handleIn}ht&&(_t&&(lt.getFirstSegment().setHandleIn(ii),lt.setClosed(_t)),lt.getArea()!==0&&ce.push(lt))}return ce}return{_getWinding:function(ye,xe,ce){return we(ye,this.getCurves(),xe,ce)},unite:function(ye,xe){return Z(this,ye,"unite",xe)},intersect:function(ye,xe){return Z(this,ye,"intersect",xe)},subtract:function(ye,xe){return Z(this,ye,"subtract",xe)},exclude:function(ye,xe){return Z(this,ye,"exclude",xe)},divide:function(ye,xe){return xe&&(xe.trace==!1||xe.stroke)?ie(this,ye,"divide"):j([this.subtract(ye,xe),this.intersect(ye,xe)],!0,this,ye,xe)},resolveCrossings:function(){var ye=this._children,xe=ye||[this];function ce(Tt,Jt){var ii=Tt&&Tt._intersection;return ii&&ii._overlap&&ii._path===Jt}var Se=!1,Ie=!1,Me=this.getIntersections(null,function(Tt){return Tt.hasOverlap()&&(Se=!0)||Tt.isCrossing()&&(Ie=!0)}),ze=Se&&Ie&&[];if(Me=At.expand(Me),Se)for(var Ge=le(Me,function(Tt){return Tt.hasOverlap()},ze),We=Ge.length-1;We>=0;We--){var je=Ge[We],rt=je._path,Je=je._segment,lt=Je.getPrevious(),ht=Je.getNext();ce(lt,rt)&&ce(ht,rt)&&(Je.remove(),lt._handleOut._set(0,0),ht._handleIn._set(0,0),lt!==Je&&!lt.getCurve().hasLength()&&(ht._handleIn.set(lt._handleIn),lt.remove()))}Ie&&(le(Me,Se&&function(Tt){var Jt=Tt.getCurve(),ii=Tt.getSegment(),Rt=Tt._intersection,Si=Rt._curve,bi=Rt._segment;if(Jt&&Si&&Jt._path&&Si._path)return!0;ii&&(ii._intersection=null),bi&&(bi._intersection=null)},ze),ze&&me(ze),xe=ke(s.each(xe,function(Tt){s.push(this,Tt._segments)},[])));var _t=xe.length,bt;return _t>1&&ye?(xe!==ye&&this.setChildren(xe),bt=this):_t===1&&!ye&&(xe[0]!==this&&this.setSegments(xe[0].removeSegments()),bt=this),bt||(bt=new Mt(fe.NO_INSERT),bt.addChildren(xe),bt=bt.reduce(),bt.copyAttributes(this),this.replaceWith(bt)),bt},reorient:function(ye,xe){var ce=this._children;return ce&&ce.length?this.setChildren(de(this.removeChildren(),function(Se){return!!(ye?Se:Se&1)},xe)):xe!==t&&this.setClockwise(xe),this},getInteriorPoint:function(){var ye=this.getBounds(),xe=ye.getCenter(!0);if(!this.contains(xe)){for(var ce=this.getCurves(),Se=xe.y,Ie=[],Me=[],ze=0,Ge=ce.length;ze<Ge;ze++){var We=ce[ze].getValues(),je=We[1],rt=We[3],Je=We[5],lt=We[7];if(Se>=h(je,rt,Je,lt)&&Se<=f(je,rt,Je,lt))for(var ht=Ke.getMonoCurves(We),_t=0,bt=ht.length;_t<bt;_t++){var Tt=ht[_t],Jt=Tt[1],ii=Tt[7];if(Jt!==ii&&(Se>=Jt&&Se<=ii||Se>=ii&&Se<=Jt)){var Rt=Se===Jt?Tt[0]:Se===ii?Tt[6]:Ke.solveCubic(Tt,1,Se,Me,0,1)===1?Ke.getPoint(Tt,Me[0]).x:(Tt[0]+Tt[6])/2;Ie.push(Rt)}}}Ie.length>1&&(Ie.sort(function(Si,bi){return Si-bi}),xe.x=(Ie[0]+Ie[1])/2)}return xe}}});var zt=s.extend({_class:"PathFlattener",initialize:function(h,f,b,L,I){var B=[],j=[],Y=0,Z=1/(b||32),ie=h._segments,pe=ie[0],me;function de(ke,ye){var xe=Ke.getValues(ke,ye,I);B.push(xe),le(xe,ke._index,0,1)}function le(ke,ye,xe,ce){if(ce-xe>Z&&!(L&&Ke.isStraight(ke))&&!Ke.isFlatEnough(ke,f||.25)){var Se=Ke.subdivide(ke,.5),Ie=(xe+ce)/2;le(Se[0],ye,xe,Ie),le(Se[1],ye,Ie,ce)}else{var Me=ke[6]-ke[0],ze=ke[7]-ke[1],Ge=Math.sqrt(Me*Me+ze*ze);Ge>0&&(Y+=Ge,j.push({offset:Y,curve:ke,index:ye,time:ce}))}}for(var we=1,Ve=ie.length;we<Ve;we++)me=ie[we],de(pe,me),pe=me;h._closed&&de(me||pe,ie[0]),this.curves=B,this.parts=j,this.length=Y,this.index=0},_get:function(h){for(var f=this.parts,b=f.length,L,I=this.index;L=I,!(!I||f[--I].offset<h););for(;L<b;L++){var B=f[L];if(B.offset>=h){this.index=L;var j=f[L-1],Y=j&&j.index===B.index?j.time:0,Z=j?j.offset:0;return{index:B.index,time:Y+(B.time-Y)*(h-Z)/(B.offset-Z)}}}return{index:f[b-1].index,time:1}},drawPart:function(h,f,b){for(var L=this._get(f),I=this._get(b),B=L.index,j=I.index;B<=j;B++){var Y=Ke.getPart(this.curves[B],B===L.index?L.time:0,B===I.index?I.time:1);B===L.index&&h.moveTo(Y[0],Y[1]),h.bezierCurveTo.apply(h,Y.slice(2))}}},s.each(Ke._evaluateMethods,function(h){this[h+"At"]=function(f){var b=this._get(f);return Ke[h](this.curves[b.index],b.time)}},{})),xt=s.extend({initialize:function(h){for(var f=this.points=[],b=h._segments,L=h._closed,I=0,B,j=b.length;I<j;I++){var Y=b[I].point;(!B||!B.equals(Y))&&f.push(B=Y.clone())}L&&(f.unshift(f[f.length-1]),f.push(f[1])),this.closed=L},fit:function(h){var f=this.points,b=f.length,L=null;return b>0&&(L=[new Et(f[0])],b>1&&(this.fitCubic(L,h,0,b-1,f[1].subtract(f[0]),f[b-2].subtract(f[b-1])),this.closed&&(L.shift(),L.pop()))),L},fitCubic:function(h,f,b,L,I,B){var j=this.points;if(L-b===1){var Y=j[b],Z=j[L],ie=Y.getDistance(Z)/3;this.addCurve(h,[Y,Y.add(I.normalize(ie)),Z.add(B.normalize(ie)),Z]);return}for(var pe=this.chordLengthParameterize(b,L),me=Math.max(f,f*f),de,le=!0,we=0;we<=4;we++){var Ve=this.generateBezier(b,L,pe,I,B),ke=this.findMaxError(b,L,Ve,pe);if(ke.error<f&&le){this.addCurve(h,Ve);return}if(de=ke.index,ke.error>=me)break;le=this.reparameterize(b,L,pe,Ve),me=ke.error}var ye=j[de-1].subtract(j[de+1]);this.fitCubic(h,f,b,de,I,ye),this.fitCubic(h,f,de,L,ye.negate(),B)},addCurve:function(h,f){var b=h[h.length-1];b.setHandleOut(f[1].subtract(f[0])),h.push(new Et(f[3],f[2].subtract(f[3])))},generateBezier:function(h,f,b,L,I){for(var B=1e-12,j=Math.abs,Y=this.points,Z=Y[h],ie=Y[f],pe=[[0,0],[0,0]],me=[0,0],de=0,le=f-h+1;de<le;de++){var we=b[de],Ve=1-we,ke=3*we*Ve,ye=Ve*Ve*Ve,xe=ke*Ve,ce=ke*we,Se=we*we*we,Ie=L.normalize(xe),Me=I.normalize(ce),ze=Y[h+de].subtract(Z.multiply(ye+xe)).subtract(ie.multiply(ce+Se));pe[0][0]+=Ie.dot(Ie),pe[0][1]+=Ie.dot(Me),pe[1][0]=pe[0][1],pe[1][1]+=Me.dot(Me),me[0]+=Ie.dot(ze),me[1]+=Me.dot(ze)}var Ge=pe[0][0]*pe[1][1]-pe[1][0]*pe[0][1],We,je;if(j(Ge)>B){var rt=pe[0][0]*me[1]-pe[1][0]*me[0],Je=me[0]*pe[1][1]-me[1]*pe[0][1];We=Je/Ge,je=rt/Ge}else{var lt=pe[0][0]+pe[0][1],ht=pe[1][0]+pe[1][1];We=je=j(lt)>B?me[0]/lt:j(ht)>B?me[1]/ht:0}var _t=ie.getDistance(Z),bt=B*_t,Tt,Jt;if(We<bt||je<bt)We=je=_t/3;else{var ii=ie.subtract(Z);Tt=L.normalize(We),Jt=I.normalize(je),Tt.dot(ii)-Jt.dot(ii)>_t*_t&&(We=je=_t/3,Tt=Jt=null)}return[Z,Z.add(Tt||L.normalize(We)),ie.add(Jt||I.normalize(je)),ie]},reparameterize:function(h,f,b,L){for(var I=h;I<=f;I++)b[I-h]=this.findRoot(L,this.points[I],b[I-h]);for(var I=1,B=b.length;I<B;I++)if(b[I]<=b[I-1])return!1;return!0},findRoot:function(h,f,b){for(var L=[],I=[],B=0;B<=2;B++)L[B]=h[B+1].subtract(h[B]).multiply(3);for(var B=0;B<=1;B++)I[B]=L[B+1].subtract(L[B]).multiply(2);var j=this.evaluate(3,h,b),Y=this.evaluate(2,L,b),Z=this.evaluate(1,I,b),ie=j.subtract(f),pe=Y.dot(Y)+ie.dot(Z);return m.isMachineZero(pe)?b:b-ie.dot(Y)/pe},evaluate:function(h,f,b){for(var L=f.slice(),I=1;I<=h;I++)for(var B=0;B<=h-I;B++)L[B]=L[B].multiply(1-b).add(L[B+1].multiply(b));return L[0]},chordLengthParameterize:function(h,f){for(var b=[0],L=h+1;L<=f;L++)b[L-h]=b[L-h-1]+this.points[L].getDistance(this.points[L-1]);for(var L=1,I=f-h;L<=I;L++)b[L]/=b[I];return b},findMaxError:function(h,f,b,L){for(var I=Math.floor((f-h+1)/2),B=0,j=h+1;j<f;j++){var Y=this.evaluate(3,b,L[j-h]),Z=Y.subtract(this.points[j]),ie=Z.x*Z.x+Z.y*Z.y;ie>=B&&(B=ie,I=j)}return{error:B,index:I}}}),Gt=fe.extend({_class:"TextItem",_applyMatrix:!1,_canApplyMatrix:!1,_serializeFields:{content:null},_boundsOptions:{stroke:!1,handle:!1},initialize:function(f){this._content="",this._lines=[];var b=f&&s.isPlainObject(f)&&f.x===t&&f.y===t;this._initialize(b&&f,!b&&D.read(arguments))},_equals:function(h){return this._content===h._content},copyContent:function(h){this.setContent(h._content)},getContent:function(){return this._content},setContent:function(h){this._content=""+h,this._lines=this._content.split(/\r\n|\n|\r/mg),this._changed(521)},isEmpty:function(){return!this._content},getCharacterStyle:"#getStyle",setCharacterStyle:"#setStyle",getParagraphStyle:"#getStyle",setParagraphStyle:"#setStyle"}),yi=Gt.extend({_class:"PointText",initialize:function(){Gt.apply(this,arguments)},getPoint:function(){var h=this._matrix.getTranslation();return new z(h.x,h.y,this,"setPoint")},setPoint:function(){var h=D.read(arguments);this.translate(h.subtract(this._matrix.getTranslation()))},_draw:function(h,f,b){if(this._content){this._setStyles(h,f,b);var L=this._lines,I=this._style,B=I.hasFill(),j=I.hasStroke(),Y=I.getLeading(),Z=h.shadowColor;h.font=I.getFontStyle(),h.textAlign=I.getJustification();for(var ie=0,pe=L.length;ie<pe;ie++){h.shadowColor=Z;var me=L[ie];B&&(h.fillText(me,0,0),h.shadowColor="rgba(0,0,0,0)"),j&&h.strokeText(me,0,0),h.translate(0,Y)}}},_getBounds:function(h,f){var b=this._style,L=this._lines,I=L.length,B=b.getJustification(),j=b.getLeading(),Y=this.getView().getTextWidth(b.getFontStyle(),L),Z=0;B!=="left"&&(Z-=Y/(B==="center"?2:1));var ie=new H(Z,I?-.75*j:0,Y,I*j);return h?h._transformBounds(ie,ie):ie}}),ti=s.extend(new function(){var h={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"],gradient:["gradient","origin","destination","highlight"]},f={},b={transparent:[0,0,0,0]},L;function I(Y){var Z=Y.match(/^#([\da-f]{2})([\da-f]{2})([\da-f]{2})([\da-f]{2})?$/i)||Y.match(/^#([\da-f])([\da-f])([\da-f])([\da-f])?$/i),ie="rgb",pe;if(Z){var me=Z[4]?4:3;pe=new Array(me);for(var de=0;de<me;de++){var le=Z[de+1];pe[de]=parseInt(le.length==1?le+le:le,16)/255}}else if(Z=Y.match(/^(rgb|hsl)a?\((.*)\)$/)){ie=Z[1],pe=Z[2].trim().split(/[,\s]+/g);for(var we=ie==="hsl",de=0,Ve=Math.min(pe.length,4);de<Ve;de++){var ke=pe[de],le=parseFloat(ke);if(we)if(de===0){var ye=ke.match(/([a-z]*)$/)[1];le*={turn:360,rad:180/Math.PI,grad:.9}[ye]||1}else de<3&&(le/=100);else de<3&&(le/=/%$/.test(ke)?100:255);pe[de]=le}}else{var xe=b[Y];if(!xe)if(n){L||(L=Xe.getContext(1,1,{willReadFrequently:!0}),L.globalCompositeOperation="copy"),L.fillStyle="rgba(0,0,0,0)",L.fillStyle=Y,L.fillRect(0,0,1,1);var ce=L.getImageData(0,0,1,1).data;xe=b[Y]=[ce[0]/255,ce[1]/255,ce[2]/255]}else xe=[0,0,0];pe=xe.slice()}return[ie,pe]}var B=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],j={"rgb-hsb":function(Y,Z,ie){var pe=Math.max(Y,Z,ie),me=Math.min(Y,Z,ie),de=pe-me,le=de===0?0:(pe==Y?(Z-ie)/de+(Z<ie?6:0):pe==Z?(ie-Y)/de+2:(Y-Z)/de+4)*60;return[le,pe===0?0:de/pe,pe]},"hsb-rgb":function(Y,Z,ie){Y=(Y/60%6+6)%6;var me=Math.floor(Y),pe=Y-me,me=B[me],de=[ie,ie*(1-Z),ie*(1-Z*pe),ie*(1-Z*(1-pe))];return[de[me[0]],de[me[1]],de[me[2]]]},"rgb-hsl":function(Y,Z,ie){var pe=Math.max(Y,Z,ie),me=Math.min(Y,Z,ie),de=pe-me,le=de===0,we=le?0:(pe==Y?(Z-ie)/de+(Z<ie?6:0):pe==Z?(ie-Y)/de+2:(Y-Z)/de+4)*60,Ve=(pe+me)/2,ke=le?0:Ve<.5?de/(pe+me):de/(2-pe-me);return[we,ke,Ve]},"hsl-rgb":function(Y,Z,ie){if(Y=(Y/360%1+1)%1,Z===0)return[ie,ie,ie];for(var pe=[Y+1/3,Y,Y-1/3],me=ie<.5?ie*(1+Z):ie+Z-ie*Z,de=2*ie-me,le=[],we=0;we<3;we++){var Ve=pe[we];Ve<0&&(Ve+=1),Ve>1&&(Ve-=1),le[we]=6*Ve<1?de+(me-de)*6*Ve:2*Ve<1?me:3*Ve<2?de+(me-de)*(2/3-Ve)*6:de}return le},"rgb-gray":function(Y,Z,ie){return[Y*.2989+Z*.587+ie*.114]},"gray-rgb":function(Y){return[Y,Y,Y]},"gray-hsb":function(Y){return[0,0,Y]},"gray-hsl":function(Y){return[0,0,Y]},"gradient-rgb":function(){return[]},"rgb-gradient":function(){return[]}};return s.each(h,function(Y,Z){f[Z]=[],s.each(Y,function(ie,pe){var me=s.capitalize(ie),de=/^(hue|saturation)$/.test(ie),le=f[Z][pe]=Z==="gradient"?ie==="gradient"?function(we){var Ve=this._components[0];return we=Mi.read(Array.isArray(we)?we:arguments,0,{readNull:!0}),Ve!==we&&(Ve&&Ve._removeOwner(this),we&&we._addOwner(this)),we}:function(){return D.read(arguments,0,{readNull:ie==="highlight",clone:!0})}:function(we){return we==null||isNaN(we)?0:+we};this["get"+me]=function(){return this._type===Z||de&&/^hs[bl]$/.test(this._type)?this._components[pe]:this._convert(Z)[pe]},this["set"+me]=function(we){this._type!==Z&&!(de&&/^hs[bl]$/.test(this._type))&&(this._components=this._convert(Z),this._properties=h[Z],this._type=Z),this._components[pe]=le.call(this,we),this._changed()}},this)},{_class:"Color",_readIndex:!0,initialize:function Y(Z){var ie=arguments,pe=this.__read,me=0,de,le,we,Ve;Array.isArray(Z)&&(ie=Z,Z=ie[0]);var ke=Z!=null&&typeof Z;if(ke==="string"&&Z in h&&(de=Z,Z=ie[1],Array.isArray(Z)?(le=Z,we=ie[2]):(pe&&(me=1),ie=s.slice(ie,1),ke=typeof Z)),!le){if(Ve=ke==="number"?ie:ke==="object"&&Z.length!=null?Z:null,Ve){de||(de=Ve.length>=3?"rgb":"gray");var ye=h[de].length;we=Ve[ye],pe&&(me+=Ve===arguments?ye+(we!=null?1:0):1),Ve.length>ye&&(Ve=s.slice(Ve,0,ye))}else if(ke==="string"){var xe=I(Z);de=xe[0],le=xe[1],le.length===4&&(we=le[3],le.length--)}else if(ke==="object")if(Z.constructor===Y){if(de=Z._type,le=Z._components.slice(),we=Z._alpha,de==="gradient")for(var ce=1,Se=le.length;ce<Se;ce++){var Ie=le[ce];Ie&&(le[ce]=Ie.clone())}}else if(Z.constructor===Mi)de="gradient",Ve=ie;else{de="hue"in Z?"lightness"in Z?"hsl":"hsb":"gradient"in Z||"stops"in Z||"radial"in Z?"gradient":"gray"in Z?"gray":"rgb";var Me=h[de],ze=f[de];this._components=le=[];for(var ce=0,Se=Me.length;ce<Se;ce++){var Ge=Z[Me[ce]];Ge==null&&!ce&&de==="gradient"&&"stops"in Z&&(Ge={stops:Z.stops,radial:Z.radial}),Ge=ze[ce].call(this,Ge),Ge!=null&&(le[ce]=Ge)}we=Z.alpha}pe&&de&&(me=1)}if(this._type=de||"rgb",!le){this._components=le=[];for(var ze=f[this._type],ce=0,Se=ze.length;ce<Se;ce++){var Ge=ze[ce].call(this,Ve&&Ve[ce]);Ge!=null&&(le[ce]=Ge)}}return this._components=le,this._properties=h[this._type],this._alpha=we,pe&&(this.__read=me),this},set:"#initialize",_serialize:function(Y,Z){var ie=this.getComponents();return s.serialize(/^(gray|rgb)$/.test(this._type)?ie:[this._type].concat(ie),Y,!0,Z)},_changed:function(){this._canvasStyle=null,this._owner&&(this._setter?this._owner[this._setter](this):this._owner._changed(129))},_convert:function(Y){var Z;return this._type===Y?this._components.slice():(Z=j[this._type+"-"+Y])?Z.apply(this,this._components):j["rgb-"+Y].apply(this,j[this._type+"-rgb"].apply(this,this._components))},convert:function(Y){return new ti(Y,this._convert(Y),this._alpha)},getType:function(){return this._type},setType:function(Y){this._components=this._convert(Y),this._properties=h[Y],this._type=Y},getComponents:function(){var Y=this._components.slice();return this._alpha!=null&&Y.push(this._alpha),Y},getAlpha:function(){return this._alpha!=null?this._alpha:1},setAlpha:function(Y){this._alpha=Y==null?null:Math.min(Math.max(Y,0),1),this._changed()},hasAlpha:function(){return this._alpha!=null},equals:function(Y){var Z=s.isPlainValue(Y,!0)?ti.read(arguments):Y;return Z===this||Z&&this._class===Z._class&&this._type===Z._type&&this.getAlpha()===Z.getAlpha()&&s.equals(this._components,Z._components)||!1},toString:function(){for(var Y=this._properties,Z=[],ie=this._type==="gradient",pe=y.instance,me=0,de=Y.length;me<de;me++){var le=this._components[me];le!=null&&Z.push(Y[me]+": "+(ie?le:pe.number(le)))}return this._alpha!=null&&Z.push("alpha: "+pe.number(this._alpha)),"{ "+Z.join(", ")+" }"},toCSS:function(Y){var Z=this._convert("rgb"),ie=Y||this._alpha==null?1:this._alpha;function pe(me){return Math.round((me<0?0:me>1?1:me)*255)}return Z=[pe(Z[0]),pe(Z[1]),pe(Z[2])],ie<1&&Z.push(ie<0?0:ie),Y?"#"+((1<<24)+(Z[0]<<16)+(Z[1]<<8)+Z[2]).toString(16).slice(1):(Z.length==4?"rgba(":"rgb(")+Z.join(",")+")"},toCanvasStyle:function(Y,Z){if(this._canvasStyle)return this._canvasStyle;if(this._type!=="gradient")return this._canvasStyle=this.toCSS();var ie=this._components,pe=ie[0],me=pe._stops,de=ie[1],le=ie[2],we=ie[3],Ve=Z&&Z.inverted(),ke;if(Ve&&(de=Ve._transformPoint(de),le=Ve._transformPoint(le),we&&(we=Ve._transformPoint(we))),pe._radial){var ye=le.getDistance(de);if(we){var xe=we.subtract(de);xe.getLength()>ye&&(we=de.add(xe.normalize(ye-.1)))}var ce=we||de;ke=Y.createRadialGradient(ce.x,ce.y,0,de.x,de.y,ye)}else ke=Y.createLinearGradient(de.x,de.y,le.x,le.y);for(var Se=0,Ie=me.length;Se<Ie;Se++){var Me=me[Se],ze=Me._offset;ke.addColorStop(ze??Se/(Ie-1),Me._color.toCanvasStyle())}return this._canvasStyle=ke},transform:function(Y){if(this._type==="gradient"){for(var Z=this._components,ie=1,pe=Z.length;ie<pe;ie++){var me=Z[ie];Y._transformPoint(me,me,!0)}this._changed()}},statics:{_types:h,random:function(){var Y=Math.random;return new ti(Y(),Y(),Y())},_setOwner:function(Y,Z,ie){return Y&&(Y._owner&&Z&&Y._owner!==Z&&(Y=Y.clone()),!Y._owner^!Z&&(Y._owner=Z||null,Y._setter=ie||null)),Y}}})},new function(){var h={add:function(f,b){return f+b},subtract:function(f,b){return f-b},multiply:function(f,b){return f*b},divide:function(f,b){return f/b}};return s.each(h,function(f,b){this[b]=function(L){L=ti.read(arguments);for(var I=this._type,B=this._components,j=L._convert(I),Y=0,Z=B.length;Y<Z;Y++)j[Y]=f(B[Y],j[Y]);return new ti(I,j,this._alpha!=null?f(this._alpha,L.getAlpha()):null)}},{})}),Mi=s.extend({_class:"Gradient",initialize:function(f,b){this._id=O.get(),f&&s.isPlainObject(f)&&(this.set(f),f=b=null),this._stops==null&&this.setStops(f||["white","black"]),this._radial==null&&this.setRadial(typeof b=="string"&&b==="radial"||b||!1)},_serialize:function(h,f){return f.add(this,function(){return s.serialize([this._stops,this._radial],h,!0,f)})},_changed:function(){for(var h=0,f=this._owners&&this._owners.length;h<f;h++)this._owners[h]._changed()},_addOwner:function(h){this._owners||(this._owners=[]),this._owners.push(h)},_removeOwner:function(h){var f=this._owners?this._owners.indexOf(h):-1;f!=-1&&(this._owners.splice(f,1),this._owners.length||(this._owners=t))},clone:function(){for(var h=[],f=0,b=this._stops.length;f<b;f++)h[f]=this._stops[f].clone();return new Mi(h,this._radial)},getStops:function(){return this._stops},setStops:function(h){if(h.length<2)throw new Error("Gradient stop list needs to contain at least two stops.");var f=this._stops;if(f)for(var b=0,L=f.length;b<L;b++)f[b]._owner=t;f=this._stops=Li.readList(h,0,{clone:!0});for(var b=0,L=f.length;b<L;b++)f[b]._owner=this;this._changed()},getRadial:function(){return this._radial},setRadial:function(h){this._radial=h,this._changed()},equals:function(h){if(h===this)return!0;if(h&&this._class===h._class){var f=this._stops,b=h._stops,L=f.length;if(L===b.length){for(var I=0;I<L;I++)if(!f[I].equals(b[I]))return!1;return!0}}return!1}}),Li=s.extend({_class:"GradientStop",initialize:function(f,b){var L=f,I=b;typeof f=="object"&&b===t&&(Array.isArray(f)&&typeof f[0]!="number"?(L=f[0],I=f[1]):("color"in f||"offset"in f||"rampPoint"in f)&&(L=f.color,I=f.offset||f.rampPoint||0)),this.setColor(L),this.setOffset(I)},clone:function(){return new Li(this._color.clone(),this._offset)},_serialize:function(h,f){var b=this._color,L=this._offset;return s.serialize(L==null?[b]:[b,L],h,!0,f)},_changed:function(){this._owner&&this._owner._changed(129)},getOffset:function(){return this._offset},setOffset:function(h){this._offset=h,this._changed()},getRampPoint:"#getOffset",setRampPoint:"#setOffset",getColor:function(){return this._color},setColor:function(){ti._setOwner(this._color,null),this._color=ti._setOwner(ti.read(arguments,0),this,"setColor"),this._changed()},equals:function(h){return h===this||h&&this._class===h._class&&this._color.equals(h._color)&&this._offset==h._offset||!1}}),qi=s.extend(new function(){var h={fillColor:null,fillRule:"nonzero",strokeColor:null,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",strokeScaling:!0,miterLimit:10,dashOffset:0,dashArray:[],shadowColor:null,shadowBlur:0,shadowOffset:new D,selectedColor:null},f=s.set({},h,{fontFamily:"sans-serif",fontWeight:"normal",fontSize:12,leading:null,justification:"left"}),b=s.set({},f,{fillColor:new ti}),L={strokeWidth:193,strokeCap:193,strokeJoin:193,strokeScaling:201,miterLimit:193,fontFamily:9,fontWeight:9,fontSize:9,font:9,leading:9,justification:9},I={beans:!0},B={_class:"Style",beans:!0,initialize:function(Y,Z,ie){this._values={},this._owner=Z,this._project=Z&&Z._project||ie||ct.project,this._defaults=!Z||Z instanceof be?f:Z instanceof Gt?b:h,Y&&this.set(Y)}};return s.each(f,function(j,Y){var Z=/Color$/.test(Y),ie=Y==="shadowOffset",pe=s.capitalize(Y),me=L[Y],de="set"+pe,le="get"+pe;B[de]=function(we){var Ve=this._owner,ke=Ve&&Ve._children,ye=ke&&ke.length>0&&!(Ve instanceof Mt);if(ye)for(var xe=0,ce=ke.length;xe<ce;xe++)ke[xe]._style[de](we);if((Y==="selectedColor"||!ye)&&Y in this._defaults){var Se=this._values[Y];Se!==we&&(Z&&(Se&&(ti._setOwner(Se,null),Se._canvasStyle=null),we&&we.constructor===ti&&(we=ti._setOwner(we,Ve,ye&&de))),this._values[Y]=we,Ve&&Ve._changed(me||129))}},B[le]=function(we){var Ve=this._owner,ke=Ve&&Ve._children,ye=ke&&ke.length>0&&!(Ve instanceof Mt),xe;if(ye&&!we)for(var ce=0,Se=ke.length;ce<Se;ce++){var Ie=ke[ce]._style[le]();if(!ce)xe=Ie;else if(!s.equals(xe,Ie))return t}else if(Y in this._defaults){var xe=this._values[Y];if(xe===t)xe=this._defaults[Y],xe&&xe.clone&&(xe=xe.clone());else{var Me=Z?ti:ie?D:null;Me&&!(xe&&xe.constructor===Me)&&(this._values[Y]=xe=Me.read([xe],0,{readNull:!0,clone:!0}))}}return xe&&Z&&(xe=ti._setOwner(xe,Ve,ye&&de)),xe},I[le]=function(we){return this._style[le](we)},I[de]=function(we){this._style[de](we)}}),s.each({Font:"FontFamily",WindingRule:"FillRule"},function(j,Y){var Z="get"+Y,ie="set"+Y;B[Z]=I[Z]="#get"+j,B[ie]=I[ie]="#set"+j}),fe.inject(I),B},{set:function(h){var f=h instanceof qi,b=f?h._values:h;if(b){for(var L in b)if(L in this._defaults){var I=b[L];this[L]=I&&f&&I.clone?I.clone():I}}},equals:function(h){function f(b,L,I){var B=b._values,j=L._values,Y=L._defaults;for(var Z in B){var ie=B[Z],pe=j[Z];if(!(I&&Z in j)&&!s.equals(ie,pe===t?Y[Z]:pe))return!1}return!0}return h===this||h&&this._class===h._class&&f(this,h)&&f(h,this,!0)||!1},_dispose:function(){var h;h=this.getFillColor(),h&&(h._canvasStyle=null),h=this.getStrokeColor(),h&&(h._canvasStyle=null),h=this.getShadowColor(),h&&(h._canvasStyle=null)},hasFill:function(){var h=this.getFillColor();return!!h&&h.alpha>0},hasStroke:function(){var h=this.getStrokeColor();return!!h&&h.alpha>0&&this.getStrokeWidth()>0},hasShadow:function(){var h=this.getShadowColor();return!!h&&h.alpha>0&&(this.getShadowBlur()>0||!this.getShadowOffset().isZero())},getView:function(){return this._project._view},getFontStyle:function(){var h=this.getFontSize();return this.getFontWeight()+" "+h+(/[a-z]/i.test(h+"")?" ":"px ")+this.getFontFamily()},getFont:"#getFontFamily",setFont:"#setFontFamily",getLeading:function h(){var f=h.base.call(this),b=this.getFontSize();return/pt|em|%|px/.test(b)&&(b=this.getView().getPixelSize(b)),f??b*1.2}}),Pi=new function(){function h(f,b,L,I){for(var B=["","webkit","moz","Moz","ms","o"],j=b[0].toUpperCase()+b.substring(1),Y=0;Y<6;Y++){var Z=B[Y],ie=Z?Z+j:b;if(ie in f){if(L)f[ie]=I;else return f[ie];break}}}return{getStyles:function(f){var b=f&&f.nodeType!==9?f.ownerDocument:f,L=b&&b.defaultView;return L&&L.getComputedStyle(f,"")},getBounds:function(f,b){var L=f.ownerDocument,I=L.body,B=L.documentElement,j;try{j=f.getBoundingClientRect()}catch{j={left:0,top:0,width:0,height:0}}var Y=j.left-(B.clientLeft||I.clientLeft||0),Z=j.top-(B.clientTop||I.clientTop||0);if(!b){var ie=L.defaultView;Y+=ie.pageXOffset||B.scrollLeft||I.scrollLeft,Z+=ie.pageYOffset||B.scrollTop||I.scrollTop}return new H(Y,Z,j.width,j.height)},getViewportBounds:function(f){var b=f.ownerDocument,L=b.defaultView,I=b.documentElement;return new H(0,0,L.innerWidth||I.clientWidth,L.innerHeight||I.clientHeight)},getOffset:function(f,b){return Pi.getBounds(f,b).getPoint()},getSize:function(f){return Pi.getBounds(f,!0).getSize()},isInvisible:function(f){return Pi.getSize(f).equals(new w(0,0))},isInView:function(f){return!Pi.isInvisible(f)&&Pi.getViewportBounds(f).intersects(Pi.getBounds(f,!0))},isInserted:function(f){return r.body.contains(f)},getPrefixed:function(f,b){return f&&h(f,b)},setPrefixed:function(f,b,L){if(typeof b=="object")for(var I in b)h(f,I,!0,b[I]);else h(f,b,!0,L)}}},Oi={add:function(h,f){if(h)for(var b in f)for(var L=f[b],I=b.split(/[\s,]+/g),B=0,j=I.length;B<j;B++){var Y=I[B],Z=h===r&&(Y==="touchstart"||Y==="touchmove")?{passive:!1}:!1;h.addEventListener(Y,L,Z)}},remove:function(h,f){if(h)for(var b in f)for(var L=f[b],I=b.split(/[\s,]+/g),B=0,j=I.length;B<j;B++)h.removeEventListener(I[B],L,!1)},getPoint:function(h){var f=h.targetTouches?h.targetTouches.length?h.targetTouches[0]:h.changedTouches[0]:h;return new D(f.pageX||f.clientX+r.documentElement.scrollLeft,f.pageY||f.clientY+r.documentElement.scrollTop)},getTarget:function(h){return h.target||h.srcElement},getRelatedTarget:function(h){return h.relatedTarget||h.toElement},getOffset:function(h,f){return Oi.getPoint(h).subtract(Pi.getOffset(f||Oi.getTarget(h)))}};Oi.requestAnimationFrame=new function(){var h=Pi.getPrefixed(n,"requestAnimationFrame"),f=!1,b=[],L;function I(){var B=b;b=[];for(var j=0,Y=B.length;j<Y;j++)B[j]();f=h&&b.length,f&&h(I)}return function(B){b.push(B),h?f||(h(I),f=!0):L||(L=setInterval(I,1e3/60))}};var $t=s.extend(a,{_class:"View",initialize:function h(f,b){function L(me){return b[me]||parseInt(b.getAttribute(me),10)}function I(){var me=Pi.getSize(b);return me.isNaN()||me.isZero()?new w(L("width"),L("height")):me}var B;if(n&&b){this._id=b.getAttribute("id"),this._id==null&&b.setAttribute("id",this._id="paper-view-"+h._id++),Oi.add(b,this._viewEvents);var j="none";if(Pi.setPrefixed(b.style,{userDrag:j,userSelect:j,touchCallout:j,contentZooming:j,tapHighlightColor:"rgba(0,0,0,0)"}),l.hasAttribute(b,"resize")){var Y=this;Oi.add(n,this._windowEvents={resize:function(){Y.setViewSize(I())}})}if(B=I(),l.hasAttribute(b,"stats")&&typeof Stats<"u"){this._stats=new Stats;var Z=this._stats.domElement,ie=Z.style,pe=Pi.getOffset(b);ie.position="absolute",ie.left=pe.x+"px",ie.top=pe.y+"px",r.body.appendChild(Z)}}else B=new w(b),b=null;this._project=f,this._scope=f._scope,this._element=b,this._pixelRatio||(this._pixelRatio=n&&n.devicePixelRatio||1),this._setElementSize(B.width,B.height),this._viewSize=B,h._views.push(this),h._viewsById[this._id]=this,(this._matrix=new ae)._owner=this,h._focused||(h._focused=this),this._frameItems={},this._frameItemCount=0,this._itemEvents={native:{},virtual:{}},this._autoUpdate=!ct.agent.node,this._needsUpdate=!1},remove:function(){if(!this._project)return!1;$t._focused===this&&($t._focused=null),$t._views.splice($t._views.indexOf(this),1),delete $t._viewsById[this._id];var h=this._project;return h._view===this&&(h._view=null),Oi.remove(this._element,this._viewEvents),Oi.remove(n,this._windowEvents),this._element=this._project=null,this.off("frame"),this._animate=!1,this._frameItems={},!0},_events:s.each(fe._itemHandlers.concat(["onResize","onKeyDown","onKeyUp"]),function(h){this[h]={}},{onFrame:{install:function(){this.play()},uninstall:function(){this.pause()}}}),_animate:!1,_time:0,_count:0,getAutoUpdate:function(){return this._autoUpdate},setAutoUpdate:function(h){this._autoUpdate=h,h&&this.requestUpdate()},update:function(){},draw:function(){this.update()},requestUpdate:function(){if(!this._requested){var h=this;Oi.requestAnimationFrame(function(){if(h._requested=!1,h._animate){h.requestUpdate();var f=h._element;(!Pi.getPrefixed(r,"hidden")||l.getAttribute(f,"keepalive")==="true")&&Pi.isInView(f)&&h._handleFrame()}h._autoUpdate&&h.update()}),this._requested=!0}},play:function(){this._animate=!0,this.requestUpdate()},pause:function(){this._animate=!1},_handleFrame:function(){ct=this._scope;var h=Date.now()/1e3,f=this._last?h-this._last:0;this._last=h,this.emit("frame",new s({delta:f,time:this._time+=f,count:this._count++})),this._stats&&this._stats.update()},_animateItem:function(h,f){var b=this._frameItems;f?(b[h._id]={item:h,time:0,count:0},++this._frameItemCount===1&&this.on("frame",this._handleFrameItems)):(delete b[h._id],--this._frameItemCount===0&&this.off("frame",this._handleFrameItems))},_handleFrameItems:function(h){for(var f in this._frameItems){var b=this._frameItems[f];b.item.emit("frame",new s(h,{time:b.time+=h.delta,count:b.count++}))}},_changed:function(){this._project._changed(4097),this._bounds=this._decomposed=t},getElement:function(){return this._element},getPixelRatio:function(){return this._pixelRatio},getResolution:function(){return this._pixelRatio*72},getViewSize:function(){var h=this._viewSize;return new N(h.width,h.height,this,"setViewSize")},setViewSize:function(){var h=w.read(arguments),f=h.subtract(this._viewSize);f.isZero()||(this._setElementSize(h.width,h.height),this._viewSize.set(h),this._changed(),this.emit("resize",{size:h,delta:f}),this._autoUpdate&&this.update())},_setElementSize:function(h,f){var b=this._element;b&&(b.width!==h&&(b.width=h),b.height!==f&&(b.height=f))},getBounds:function(){return this._bounds||(this._bounds=this._matrix.inverted()._transformBounds(new H(new D,this._viewSize))),this._bounds},getSize:function(){return this.getBounds().getSize()},isVisible:function(){return Pi.isInView(this._element)},isInserted:function(){return Pi.isInserted(this._element)},getPixelSize:function(h){var f=this._element,b;if(f){var L=f.parentNode,I=r.createElement("div");I.style.fontSize=h,L.appendChild(I),b=parseFloat(Pi.getStyles(I).fontSize),L.removeChild(I)}else b=parseFloat(b);return b},getTextWidth:function(h,f){return 0}},s.each(["rotate","scale","shear","skew"],function(h){var f=h==="rotate";this[h]=function(){var b=arguments,L=(f?s:D).read(b),I=D.read(b,0,{readNull:!0});return this.transform(new ae()[h](L,I||this.getCenter(!0)))}},{_decompose:function(){return this._decomposed||(this._decomposed=this._matrix.decompose())},translate:function(){var h=new ae;return this.transform(h.translate.apply(h,arguments))},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(){var h=D.read(arguments);this.translate(this.getCenter().subtract(h))},getZoom:function(){var h=this._decompose().scaling;return(h.x+h.y)/2},setZoom:function(h){this.transform(new ae().scale(h/this.getZoom(),this.getCenter()))},getRotation:function(){return this._decompose().rotation},setRotation:function(h){var f=this.getRotation();f!=null&&h!=null&&this.rotate(h-f)},getScaling:function(){var h=this._decompose().scaling;return new z(h.x,h.y,this,"setScaling")},setScaling:function(){var h=this.getScaling(),f=D.read(arguments,0,{clone:!0,readNull:!0});h&&f&&this.scale(f.x/h.x,f.y/h.y)},getMatrix:function(){return this._matrix},setMatrix:function(){var h=this._matrix;h.set.apply(h,arguments)},transform:function(h){this._matrix.append(h)},scrollBy:function(){this.translate(D.read(arguments).negate())}}),{projectToView:function(){return this._matrix._transformPoint(D.read(arguments))},viewToProject:function(){return this._matrix._inverseTransform(D.read(arguments))},getEventPoint:function(h){return this.viewToProject(Oi.getOffset(h,this._element))}},{statics:{_views:[],_viewsById:{},_id:0,create:function(h,f){r&&typeof f=="string"&&(f=r.getElementById(f));var b=n?Rs:$t;return new b(h,f)}}},new function(){if(!n)return;var h,f,b=!1,L=!1;function I(Je){var lt=Oi.getTarget(Je);return lt.getAttribute&&$t._viewsById[lt.getAttribute("id")]}function B(){var Je=$t._focused;if(!Je||!Je.isVisible()){for(var lt=0,ht=$t._views.length;lt<ht;lt++)if((Je=$t._views[lt]).isVisible()){$t._focused=f=Je;break}}}function j(Je,lt,ht){Je._handleMouseEvent("mousemove",lt,ht)}var Y=n.navigator,Z,ie,pe;Y.pointerEnabled||Y.msPointerEnabled?(Z="pointerdown MSPointerDown",ie="pointermove MSPointerMove",pe="pointerup pointercancel MSPointerUp MSPointerCancel"):(Z="touchstart",ie="touchmove",pe="touchend touchcancel","ontouchstart"in n&&Y.userAgent.match(/mobile|tablet|ip(ad|hone|od)|android|silk/i)||(Z+=" mousedown",ie+=" mousemove",pe+=" mouseup"));var me={},de={mouseout:function(Je){var lt=$t._focused,ht=Oi.getRelatedTarget(Je);if(lt&&(!ht||ht.nodeName==="HTML")){var _t=Oi.getOffset(Je,lt._element),bt=_t.x,Tt=Math.abs,Jt=Tt(bt),ii=1<<25,Rt=Jt-ii;_t.x=Tt(Rt)<Jt?Rt*(bt<0?-1:1):bt,j(lt,Je,lt.viewToProject(_t))}},scroll:B};me[Z]=function(Je){var lt=$t._focused=I(Je);b||(b=!0,lt._handleMouseEvent("mousedown",Je))},de[ie]=function(Je){var lt=$t._focused;if(!L){var ht=I(Je);ht?lt!==ht&&(lt&&j(lt,Je),h||(h=lt),lt=$t._focused=f=ht):f&&f===lt&&(h&&!h.isInserted()&&(h=null),lt=$t._focused=h,h=null,B())}lt&&j(lt,Je)},de[Z]=function(){L=!0},de[pe]=function(Je){var lt=$t._focused;lt&&b&&lt._handleMouseEvent("mouseup",Je),L=b=!1},Oi.add(r,de),Oi.add(n,{load:B});var le=!1,we=!1,Ve={doubleclick:"click",mousedrag:"mousemove"},ke=!1,ye,xe,ce,Se,Ie,Me,ze,Ge;function We(Je,lt,ht,_t,bt,Tt,Jt){var ii=!1,Rt;function Si(bi,_i){if(bi.responds(_i)){if(Rt||(Rt=new q(_i,_t,bt,lt||bi,Tt?bt.subtract(Tt):null)),bi.emit(_i,Rt)&&(le=!0,Rt.prevented&&(we=!0),Rt.stopped))return ii=!0}else{var mi=Ve[_i];if(mi)return Si(bi,mi)}}for(;Je&&Je!==Jt&&!Si(Je,ht);)Je=Je._parent;return ii}function je(Je,lt,ht,_t,bt,Tt){return Je._project.removeOn(ht),we=le=!1,Ie&&We(Ie,null,ht,_t,bt,Tt)||lt&&lt!==Ie&&!lt.isDescendant(Ie)&&We(lt,null,ht==="mousedrag"?"mousemove":ht,_t,bt,Tt,Ie)||We(Je,Ie||lt||Je,ht,_t,bt,Tt)}var rt={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}};return{_viewEvents:me,_handleMouseEvent:function(Je,lt,ht){var _t=this._itemEvents,bt=_t.native[Je],Tt=Je==="mousemove",Jt=this._scope.tool,ii=this;function Rt(os){return _t.virtual[os]||ii.responds(os)||Jt&&Jt.responds(os)}Tt&&b&&Rt("mousedrag")&&(Je="mousedrag"),ht||(ht=this.getEventPoint(lt));var Si=this.getBounds().contains(ht),bi=bt&&Si&&ii._project.hitTest(ht,{tolerance:0,fill:!0,stroke:!0}),_i=bi&&bi.item||null,mi=!1,Yt={};if(Yt[Je.substr(5)]=!0,bt&&_i!==Se&&(Se&&We(Se,null,"mouseleave",lt,ht),_i&&We(_i,null,"mouseenter",lt,ht),Se=_i),ke^Si&&(We(this,null,Si?"mouseenter":"mouseleave",lt,ht),mi=!0),(Si||Yt.drag)&&!ht.equals(xe)&&(je(this,_i,Tt?Je:"mousemove",lt,ht,xe),mi=!0),ke=Si,Yt.down&&Si||Yt.up&&ye){if(je(this,_i,Je,lt,ht,ye),Yt.down){if(Ge=_i===Me&&Date.now()-ze<300,ce=Me=_i,!we&&_i){for(var Ti=_i;Ti&&!Ti.responds("mousedrag");)Ti=Ti._parent;Ti&&(Ie=_i)}ye=ht}else Yt.up&&(!we&&_i===ce&&(ze=Date.now(),je(this,_i,Ge?"doubleclick":"click",lt,ht,ye),Ge=!1),ce=Ie=null);ke=!1,mi=!0}xe=ht,mi&&Jt&&(le=Jt._handleMouseEvent(Je,lt,ht,Yt)||le),lt.cancelable!==!1&&(le&&!Yt.move||Yt.down&&Rt("mouseup"))&&lt.preventDefault()},_handleKeyEvent:function(Je,lt,ht,_t){var bt=this._scope,Tt=bt.tool,Jt;function ii(Rt){Rt.responds(Je)&&(ct=bt,Rt.emit(Je,Jt=Jt||new hs(Je,lt,ht,_t)))}this.isVisible()&&(ii(this),Tt&&Tt.responds(Je)&&ii(Tt))},_countItemEvent:function(Je,lt){var ht=this._itemEvents,_t=ht.native,bt=ht.virtual;for(var Tt in rt)_t[Tt]=(_t[Tt]||0)+(rt[Tt][Je]||0)*lt;bt[Je]=(bt[Je]||0)+lt},statics:{updateFocus:B,_resetState:function(){b=L=le=ke=!1,h=f=ye=xe=ce=Se=Ie=Me=ze=Ge=null}}}}),Rs=$t.extend({_class:"CanvasView",initialize:function(f,b){if(!(b instanceof n.HTMLCanvasElement)){var L=w.read(arguments,1);if(L.isZero())throw new Error("Cannot create CanvasView with the provided argument: "+s.slice(arguments,1));b=Xe.getCanvas(L)}var I=this._context=b.getContext("2d");if(I.save(),this._pixelRatio=1,!/^off|false$/.test(l.getAttribute(b,"hidpi"))){var B=n.devicePixelRatio||1,j=Pi.getPrefixed(I,"backingStorePixelRatio")||1;this._pixelRatio=B/j}$t.call(this,f,b),this._needsUpdate=!0},remove:function h(){return this._context.restore(),h.base.call(this)},_setElementSize:function h(f,b){var L=this._pixelRatio;if(h.base.call(this,f*L,b*L),L!==1){var I=this._element,B=this._context;if(!l.hasAttribute(I,"resize")){var j=I.style;j.width=f+"px",j.height=b+"px"}B.restore(),B.save(),B.scale(L,L)}},getContext:function(){return this._context},getPixelSize:function h(f){var b=ct.agent,L;if(b&&b.firefox)L=h.base.call(this,f);else{var I=this._context,B=I.font;I.font=f+" serif",L=parseFloat(I.font),I.font=B}return L},getTextWidth:function(h,f){var b=this._context,L=b.font,I=0;b.font=h;for(var B=0,j=f.length;B<j;B++)I=Math.max(I,b.measureText(f[B]).width);return b.font=L,I},update:function(){if(!this._needsUpdate)return!1;var h=this._project,f=this._context,b=this._viewSize;return f.clearRect(0,0,b.width+1,b.height+1),h&&h.draw(f,this._matrix,this._pixelRatio),this._needsUpdate=!1,!0}}),is=s.extend({_class:"Event",initialize:function(f){this.event=f,this.type=f&&f.type},prevented:!1,stopped:!1,preventDefault:function(){this.prevented=!0,this.event.preventDefault()},stopPropagation:function(){this.stopped=!0,this.event.stopPropagation()},stop:function(){this.stopPropagation(),this.preventDefault()},getTimeStamp:function(){return this.event.timeStamp},getModifiers:function(){return qs.modifiers}}),hs=is.extend({_class:"KeyEvent",initialize:function(f,b,L,I){this.type=f,this.event=b,this.key=L,this.character=I},toString:function(){return"{ type: '"+this.type+"', key: '"+this.key+"', character: '"+this.character+"', modifiers: "+this.getModifiers()+" }"}}),qs=new function(){var h={"	":"tab"," ":"space","\b":"backspace","":"delete",Spacebar:"space",Del:"delete",Win:"meta",Esc:"escape"},f={tab:"	",space:" ",enter:"\r"},b={},L={},I,B,j=new s({shift:!1,control:!1,alt:!1,meta:!1,capsLock:!1,space:!1}).inject({option:{get:function(){return this.alt}},command:{get:function(){var ie=ct&&ct.agent;return ie&&ie.mac?this.meta:this.control}}});function Y(ie){var pe=ie.key||ie.keyIdentifier;return pe=/^U\+/.test(pe)?String.fromCharCode(parseInt(pe.substr(2),16)):/^Arrow[A-Z]/.test(pe)?pe.substr(5):pe==="Unidentified"||pe===t?String.fromCharCode(ie.keyCode):pe,h[pe]||(pe.length>1?s.hyphenate(pe):pe.toLowerCase())}function Z(ie,pe,me,de){var le=$t._focused,we;if(b[pe]=ie,ie?L[pe]=me:delete L[pe],pe.length>1&&(we=s.camelize(pe))in j){j[we]=ie;var Ve=ct&&ct.agent;if(we==="meta"&&Ve&&Ve.mac)if(ie)I={};else{for(var ke in I)ke in L&&Z(!1,ke,I[ke],de);I=null}}else ie&&I&&(I[pe]=me);le&&le._handleKeyEvent(ie?"keydown":"keyup",de,pe,me)}return Oi.add(r,{keydown:function(ie){var pe=Y(ie),me=ct&&ct.agent;pe.length>1||me&&me.chrome&&(ie.altKey||me.mac&&ie.metaKey||!me.mac&&ie.ctrlKey)?Z(!0,pe,f[pe]||(pe.length>1?"":pe),ie):B=pe},keypress:function(ie){if(B){var pe=Y(ie),me=ie.charCode,de=me>=32?String.fromCharCode(me):pe.length>1?"":pe;pe!==B&&(pe=de.toLowerCase()),Z(!0,pe,de,ie),B=null}},keyup:function(ie){var pe=Y(ie);pe in L&&Z(!1,pe,L[pe],ie)}}),Oi.add(n,{blur:function(ie){for(var pe in L)Z(!1,pe,L[pe],ie)}}),{modifiers:j,isDown:function(ie){return!!b[ie]}}},q=is.extend({_class:"MouseEvent",initialize:function(f,b,L,I,B){this.type=f,this.event=b,this.point=L,this.target=I,this.delta=B},toString:function(){return"{ type: '"+this.type+"', point: "+this.point+", target: "+this.target+(this.delta?", delta: "+this.delta:"")+", modifiers: "+this.getModifiers()+" }"}}),Re=is.extend({_class:"ToolEvent",_item:null,initialize:function(f,b,L){this.tool=f,this.type=b,this.event=L},_choosePoint:function(h,f){return h||(f?f.clone():null)},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(h){this._point=h},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(h){this._lastPoint=h},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(h){this._downPoint=h},getMiddlePoint:function(){return!this._middlePoint&&this.tool._lastPoint?this.tool._point.add(this.tool._lastPoint).divide(2):this._middlePoint},setMiddlePoint:function(h){this._middlePoint=h},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(h){this._delta=h},getCount:function(){return this.tool[/^mouse(down|up)$/.test(this.type)?"_downCount":"_moveCount"]},setCount:function(h){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=h},getItem:function(){if(!this._item){var h=this.tool._scope.project.hitTest(this.getPoint());if(h){for(var f=h.item,b=f._parent;/^(Group|CompoundPath)$/.test(b._class);)f=b,b=b._parent;this._item=f}}return this._item},setItem:function(h){this._item=h},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}});d.extend({_class:"Tool",_list:"tools",_reference:"tool",_events:["onMouseDown","onMouseUp","onMouseDrag","onMouseMove","onActivate","onDeactivate","onEditOptions","onKeyDown","onKeyUp"],initialize:function(f){d.call(this),this._moveCount=-1,this._downCount=-1,this.set(f)},getMinDistance:function(){return this._minDistance},setMinDistance:function(h){this._minDistance=h,h!=null&&this._maxDistance!=null&&h>this._maxDistance&&(this._maxDistance=h)},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(h){this._maxDistance=h,this._minDistance!=null&&h!=null&&h<this._minDistance&&(this._minDistance=h)},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(h){this._minDistance=this._maxDistance=h},_handleMouseEvent:function(h,f,b,L){ct=this._scope,L.drag&&!this.responds(h)&&(h="mousemove");var I=L.move||L.drag,B=this.responds(h),j=this.minDistance,Y=this.maxDistance,Z=!1,ie=this;function pe(de,le){var we=b,Ve=I?ie._point:ie._downPoint||we;if(I){if(ie._moveCount>=0&&we.equals(Ve))return!1;if(Ve&&(de!=null||le!=null)){var ke=we.subtract(Ve),ye=ke.getLength();if(ye<(de||0))return!1;le&&(we=Ve.add(ke.normalize(Math.min(ye,le))))}ie._moveCount++}return ie._point=we,ie._lastPoint=Ve||we,L.down&&(ie._moveCount=-1,ie._downPoint=we,ie._downCount++),!0}function me(){B&&(Z=ie.emit(h,new Re(ie,h,f))||Z)}if(L.down)pe(),me();else if(L.up)pe(null,Y),me();else if(B)for(;pe(j,Y);)me();return Z}});var He=s.extend(a,{_class:"Tween",statics:{easings:new s({linear:function(h){return h},easeInQuad:function(h){return h*h},easeOutQuad:function(h){return h*(2-h)},easeInOutQuad:function(h){return h<.5?2*h*h:-1+2*(2-h)*h},easeInCubic:function(h){return h*h*h},easeOutCubic:function(h){return--h*h*h+1},easeInOutCubic:function(h){return h<.5?4*h*h*h:(h-1)*(2*h-2)*(2*h-2)+1},easeInQuart:function(h){return h*h*h*h},easeOutQuart:function(h){return 1- --h*h*h*h},easeInOutQuart:function(h){return h<.5?8*h*h*h*h:1-8*--h*h*h*h},easeInQuint:function(h){return h*h*h*h*h},easeOutQuint:function(h){return 1+--h*h*h*h*h},easeInOutQuint:function(h){return h<.5?16*h*h*h*h*h:1+16*--h*h*h*h*h}})},initialize:function h(f,b,L,I,B,j){this.object=f;var Y=typeof B,Z=Y==="function";this.type=Z?Y:Y==="string"?B:"linear",this.easing=Z?B:h.easings[this.type],this.duration=I,this.running=!1,this._then=null,this._startTime=null;var ie=b||L;this._keys=ie?Object.keys(ie):[],this._parsedKeys=this._parseKeys(this._keys),this._from=ie&&this._getState(b),this._to=ie&&this._getState(L),j!==!1&&this.start()},then:function(h){return this._then=h,this},start:function(){return this._startTime=null,this.running=!0,this},stop:function(){return this.running=!1,this},update:function(h){if(this.running){h>=1&&(h=1,this.running=!1);for(var f=this.easing(h),b=this._keys,L=function(pe){return typeof pe=="function"?pe(f,h):pe},I=0,B=b&&b.length;I<B;I++){var j=b[I],Y=L(this._from[j]),Z=L(this._to[j]),ie=Y&&Z&&Y.__add&&Z.__add?Z.__subtract(Y).__multiply(f).__add(Y):(Z-Y)*f+Y;this._setProperty(this._parsedKeys[j],ie)}this.responds("update")&&this.emit("update",new s({progress:h,factor:f})),!this.running&&this._then&&this._then(this.object)}return this},_events:{onUpdate:{}},_handleFrame:function(h){var f=this._startTime,b=f?(h-f)/this.duration:0;f||(this._startTime=h),this.update(b)},_getState:function(h){for(var f=this._keys,b={},L=0,I=f.length;L<I;L++){var B=f[L],j=this._parsedKeys[B],Y=this._getProperty(j),Z;if(h){var ie=this._resolveValue(Y,h[B]);this._setProperty(j,ie),Z=this._getProperty(j),Z=Z&&Z.clone?Z.clone():Z,this._setProperty(j,Y)}else Z=Y&&Y.clone?Y.clone():Y;b[B]=Z}return b},_resolveValue:function(h,f){if(f){if(Array.isArray(f)&&f.length===2){var b=f[0];return b&&b.match&&b.match(/^[+\-\*\/]=/)?this._calculate(h,b[0],f[1]):f}else if(typeof f=="string"){var L=f.match(/^[+\-*/]=(.*)/);if(L){var I=JSON.parse(L[1].replace(/(['"])?([a-zA-Z0-9_]+)(['"])?:/g,'"$2": '));return this._calculate(h,f[0],I)}}}return f},_calculate:function(h,f,b){return ct.PaperScript.calculateBinary(h,f,b)},_parseKeys:function(h){for(var f={},b=0,L=h.length;b<L;b++){var I=h[b],B=I.replace(/\.([^.]*)/g,"/$1").replace(/\[['"]?([^'"\]]*)['"]?\]/g,"/$1");f[I]=B.split("/")}return f},_getProperty:function(h,f){for(var b=this.object,L=0,I=h.length-(f||0);L<I&&b;L++)b=b[h[L]];return b},_setProperty:function(h,f){var b=this._getProperty(h,1);b&&(b[h[h.length-1]]=f)}}),Ze={request:function(h){var f=new e.XMLHttpRequest;return f.open((h.method||"get").toUpperCase(),h.url,s.pick(h.async,!0)),h.mimeType&&f.overrideMimeType(h.mimeType),f.onload=function(){var b=f.status;b===0||b===200?h.onLoad&&h.onLoad.call(f,f.responseText):f.onerror()},f.onerror=function(){var b=f.status,L='Could not load "'+h.url+'" (Status: '+b+")";if(h.onError)h.onError(L,b);else throw new Error(L)},f.send(null)}},Xe=s.exports.CanvasProvider={canvases:[],getCanvas:function(h,f,b){if(!n)return null;var L,I=!0;typeof h=="object"&&(f=h.height,h=h.width),this.canvases.length?L=this.canvases.pop():(L=r.createElement("canvas"),I=!1);var B=L.getContext("2d",b||{});if(!B)throw new Error("Canvas "+L+" is unable to provide a 2D context.");return L.width===h&&L.height===f?I&&B.clearRect(0,0,h+1,f+1):(L.width=h,L.height=f),B.save(),L},getContext:function(h,f,b){var L=this.getCanvas(h,f,b);return L?L.getContext("2d",b||{}):null},release:function(h){var f=h&&h.canvas?h.canvas:h;f&&f.getContext&&(f.getContext("2d").restore(),this.canvases.push(f))}},Pe=new function(){var h=Math.min,f=Math.max,b=Math.abs,L,I,B,j,Y,Z,ie,pe,me,de,le;function we(Ie,Me,ze){return .2989*Ie+.587*Me+.114*ze}function Ve(Ie,Me,ze,je){var We=je-we(Ie,Me,ze);me=Ie+We,de=Me+We,le=ze+We;var je=we(me,de,le),rt=h(me,de,le),Je=f(me,de,le);if(rt<0){var lt=je-rt;me=je+(me-je)*je/lt,de=je+(de-je)*je/lt,le=je+(le-je)*je/lt}if(Je>255){var ht=255-je,_t=Je-je;me=je+(me-je)*ht/_t,de=je+(de-je)*ht/_t,le=je+(le-je)*ht/_t}}function ke(Ie,Me,ze){return f(Ie,Me,ze)-h(Ie,Me,ze)}function ye(Ie,Me,ze,Ge){var We=[Ie,Me,ze],je=f(Ie,Me,ze),rt=h(Ie,Me,ze),Je;rt=rt===Ie?0:rt===Me?1:2,je=je===Ie?0:je===Me?1:2,Je=h(rt,je)===0?f(rt,je)===1?2:1:0,We[je]>We[rt]?(We[Je]=(We[Je]-We[rt])*Ge/(We[je]-We[rt]),We[je]=Ge):We[Je]=We[je]=0,We[rt]=0,me=We[0],de=We[1],le=We[2]}var xe={multiply:function(){me=Y*L/255,de=Z*I/255,le=ie*B/255},screen:function(){me=Y+L-Y*L/255,de=Z+I-Z*I/255,le=ie+B-ie*B/255},overlay:function(){me=Y<128?2*Y*L/255:255-2*(255-Y)*(255-L)/255,de=Z<128?2*Z*I/255:255-2*(255-Z)*(255-I)/255,le=ie<128?2*ie*B/255:255-2*(255-ie)*(255-B)/255},"soft-light":function(){var Ie=L*Y/255;me=Ie+Y*(255-(255-Y)*(255-L)/255-Ie)/255,Ie=I*Z/255,de=Ie+Z*(255-(255-Z)*(255-I)/255-Ie)/255,Ie=B*ie/255,le=Ie+ie*(255-(255-ie)*(255-B)/255-Ie)/255},"hard-light":function(){me=L<128?2*L*Y/255:255-2*(255-L)*(255-Y)/255,de=I<128?2*I*Z/255:255-2*(255-I)*(255-Z)/255,le=B<128?2*B*ie/255:255-2*(255-B)*(255-ie)/255},"color-dodge":function(){me=Y===0?0:L===255?255:h(255,255*Y/(255-L)),de=Z===0?0:I===255?255:h(255,255*Z/(255-I)),le=ie===0?0:B===255?255:h(255,255*ie/(255-B))},"color-burn":function(){me=Y===255?255:L===0?0:f(0,255-(255-Y)*255/L),de=Z===255?255:I===0?0:f(0,255-(255-Z)*255/I),le=ie===255?255:B===0?0:f(0,255-(255-ie)*255/B)},darken:function(){me=Y<L?Y:L,de=Z<I?Z:I,le=ie<B?ie:B},lighten:function(){me=Y>L?Y:L,de=Z>I?Z:I,le=ie>B?ie:B},difference:function(){me=Y-L,me<0&&(me=-me),de=Z-I,de<0&&(de=-de),le=ie-B,le<0&&(le=-le)},exclusion:function(){me=Y+L*(255-Y-Y)/255,de=Z+I*(255-Z-Z)/255,le=ie+B*(255-ie-ie)/255},hue:function(){ye(L,I,B,ke(Y,Z,ie)),Ve(me,de,le,we(Y,Z,ie))},saturation:function(){ye(Y,Z,ie,ke(L,I,B)),Ve(me,de,le,we(Y,Z,ie))},luminosity:function(){Ve(Y,Z,ie,we(L,I,B))},color:function(){Ve(L,I,B,we(Y,Z,ie))},add:function(){me=h(Y+L,255),de=h(Z+I,255),le=h(ie+B,255)},subtract:function(){me=f(Y-L,0),de=f(Z-I,0),le=f(ie-B,0)},average:function(){me=(Y+L)/2,de=(Z+I)/2,le=(ie+B)/2},negation:function(){me=255-b(255-L-Y),de=255-b(255-I-Z),le=255-b(255-B-ie)}},ce=this.nativeModes=s.each(["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","lighter","darker","copy","xor"],function(Ie){this[Ie]=!0},{}),Se=Xe.getContext(1,1,{willReadFrequently:!0});Se&&(s.each(xe,function(Ie,Me){var ze=Me==="darken",Ge=!1;Se.save();try{Se.fillStyle=ze?"#300":"#a00",Se.fillRect(0,0,1,1),Se.globalCompositeOperation=Me,Se.globalCompositeOperation===Me&&(Se.fillStyle=ze?"#a00":"#300",Se.fillRect(0,0,1,1),Ge=Se.getImageData(0,0,1,1).data[0]!==ze?170:51)}catch{}Se.restore(),ce[Me]=Ge}),Xe.release(Se)),this.process=function(Ie,Me,ze,Ge,We){var je=Me.canvas,rt=Ie==="normal";if(rt||ce[Ie])ze.save(),ze.setTransform(1,0,0,1,0,0),ze.globalAlpha=Ge,rt||(ze.globalCompositeOperation=Ie),ze.drawImage(je,We.x,We.y),ze.restore();else{var Je=xe[Ie];if(!Je)return;for(var lt=ze.getImageData(We.x,We.y,je.width,je.height),ht=lt.data,_t=Me.getImageData(0,0,je.width,je.height).data,bt=0,Tt=ht.length;bt<Tt;bt+=4){L=_t[bt],Y=ht[bt],I=_t[bt+1],Z=ht[bt+1],B=_t[bt+2],ie=ht[bt+2],j=_t[bt+3],pe=ht[bt+3],Je();var Jt=j*Ge/255,ii=1-Jt;ht[bt]=Jt*me+ii*Y,ht[bt+1]=Jt*de+ii*Z,ht[bt+2]=Jt*le+ii*ie,ht[bt+3]=j*Ge+ii*pe}ze.putImageData(lt,We.x,We.y)}}},Le=new function(){var h="http://www.w3.org/2000/svg",f="http://www.w3.org/2000/xmlns",b="http://www.w3.org/1999/xlink",L={href:b,xlink:f,xmlns:f+"/","xmlns:xlink":f+"/"};function I(Y,Z,ie){return j(r.createElementNS(h,Y),Z,ie)}function B(Y,Z){var ie=L[Z],pe=ie?Y.getAttributeNS(ie,Z):Y.getAttribute(Z);return pe==="null"?null:pe}function j(Y,Z,ie){for(var pe in Z){var me=Z[pe],de=L[pe];typeof me=="number"&&ie&&(me=ie.number(me)),de?Y.setAttributeNS(de,pe,me):Y.setAttribute(pe,me)}return Y}return{svg:h,xmlns:f,xlink:b,create:I,get:B,set:j}},De=s.each({fillColor:["fill","color"],fillRule:["fill-rule","string"],strokeColor:["stroke","color"],strokeWidth:["stroke-width","number"],strokeCap:["stroke-linecap","string"],strokeJoin:["stroke-linejoin","string"],strokeScaling:["vector-effect","lookup",{true:"none",false:"non-scaling-stroke"},function(h,f){return!f&&(h instanceof nt||h instanceof W||h instanceof Gt)}],miterLimit:["stroke-miterlimit","number"],dashArray:["stroke-dasharray","array"],dashOffset:["stroke-dashoffset","number"],fontFamily:["font-family","string"],fontWeight:["font-weight","string"],fontSize:["font-size","number"],justification:["text-anchor","lookup",{left:"start",center:"middle",right:"end"}],opacity:["opacity","number"],blendMode:["mix-blend-mode","style"]},function(h,f){var b=s.capitalize(f),L=h[2];this[f]={type:h[1],property:f,attribute:h[0],toSVG:L,fromSVG:L&&s.each(L,function(I,B){this[I]=B},{}),exportFilter:h[3],get:"get"+b,set:"set"+b}},{});new function(){var h;function f(xe,ce,Se){var Ie=new s,Me=xe.getTranslation();if(ce){var ze;xe.isInvertible()?(xe=xe._shiftless(),ze=xe._inverseTransform(Me),Me=null):ze=new D,Ie[Se?"cx":"x"]=ze.x,Ie[Se?"cy":"y"]=ze.y}if(!xe.isIdentity()){var Ge=xe.decompose();if(Ge){var We=[],je=Ge.rotation,rt=Ge.scaling,Je=Ge.skewing;Me&&!Me.isZero()&&We.push("translate("+h.point(Me)+")"),je&&We.push("rotate("+h.number(je)+")"),(!m.isZero(rt.x-1)||!m.isZero(rt.y-1))&&We.push("scale("+h.point(rt)+")"),Je.x&&We.push("skewX("+h.number(Je.x)+")"),Je.y&&We.push("skewY("+h.number(Je.y)+")"),Ie.transform=We.join(" ")}else Ie.transform="matrix("+xe.getValues().join(",")+")"}return Ie}function b(xe,ce){for(var Se=f(xe._matrix),Ie=xe._children,Me=Le.create("g",Se,h),ze=0,Ge=Ie.length;ze<Ge;ze++){var We=Ie[ze],je=ke(We,ce);if(je)if(We.isClipMask()){var rt=Le.create("clipPath");rt.appendChild(je),we(We,rt,"clip"),Le.set(Me,{"clip-path":"url(#"+rt.id+")"})}else Me.appendChild(je)}return Me}function L(xe,ce){var Se=f(xe._matrix,!0),Ie=xe.getSize(),Me=xe.getImage();return Se.x-=Ie.width/2,Se.y-=Ie.height/2,Se.width=Ie.width,Se.height=Ie.height,Se.href=ce.embedImages==!1&&Me&&Me.src||xe.toDataURL(),Le.create("image",Se,h)}function I(xe,ce){var Se=ce.matchShapes;if(Se){var Ie=xe.toShape(!1);if(Ie)return B(Ie)}var Me=xe._segments,ze=Me.length,Ge,We=f(xe._matrix);if(Se&&ze>=2&&!xe.hasHandles())if(ze>2){Ge=xe._closed?"polygon":"polyline";for(var je=[],rt=0;rt<ze;rt++)je.push(h.point(Me[rt]._point));We.points=je.join(" ")}else{Ge="line";var Je=Me[0]._point,lt=Me[1]._point;We.set({x1:Je.x,y1:Je.y,x2:lt.x,y2:lt.y})}else Ge="path",We.d=xe.getPathData(null,ce.precision);return Le.create(Ge,We,h)}function B(xe){var ce=xe._type,Se=xe._radius,Ie=f(xe._matrix,!0,ce!=="rectangle");if(ce==="rectangle"){ce="rect";var Me=xe._size,ze=Me.width,Ge=Me.height;Ie.x-=ze/2,Ie.y-=Ge/2,Ie.width=ze,Ie.height=Ge,Se.isZero()&&(Se=null)}return Se&&(ce==="circle"?Ie.r=Se:(Ie.rx=Se.width,Ie.ry=Se.height)),Le.create(ce,Ie,h)}function j(xe,ce){var Se=f(xe._matrix),Ie=xe.getPathData(null,ce.precision);return Ie&&(Se.d=Ie),Le.create("path",Se,h)}function Y(xe,ce){var Se=f(xe._matrix,!0),Ie=xe._definition,Me=le(Ie,"symbol"),ze=Ie._item,Ge=ze.getStrokeBounds();return Me||(Me=Le.create("symbol",{viewBox:h.rectangle(Ge)}),Me.appendChild(ke(ze,ce)),we(Ie,Me,"symbol")),Se.href="#"+Me.id,Se.x+=Ge.x,Se.y+=Ge.y,Se.width=Ge.width,Se.height=Ge.height,Se.overflow="visible",Le.create("use",Se,h)}function Z(xe){var ce=le(xe,"color");if(!ce){var Se=xe.getGradient(),Ie=Se._radial,Me=xe.getOrigin(),ze=xe.getDestination(),Ge;if(Ie){Ge={cx:Me.x,cy:Me.y,r:Me.getDistance(ze)};var We=xe.getHighlight();We&&(Ge.fx=We.x,Ge.fy=We.y)}else Ge={x1:Me.x,y1:Me.y,x2:ze.x,y2:ze.y};Ge.gradientUnits="userSpaceOnUse",ce=Le.create((Ie?"radial":"linear")+"Gradient",Ge,h);for(var je=Se._stops,rt=0,Je=je.length;rt<Je;rt++){var lt=je[rt],ht=lt._color,_t=ht.getAlpha(),bt=lt._offset;Ge={offset:bt??rt/(Je-1)},ht&&(Ge["stop-color"]=ht.toCSS(!0)),_t<1&&(Ge["stop-opacity"]=_t),ce.appendChild(Le.create("stop",Ge,h))}we(xe,ce,"color")}return"url(#"+ce.id+")"}function ie(xe){var ce=Le.create("text",f(xe._matrix,!0),h);return ce.textContent=xe._content,ce}var pe={Group:b,Layer:b,Raster:L,Path:I,Shape:B,CompoundPath:j,SymbolItem:Y,PointText:ie};function me(xe,ce,Se){var Ie={},Me=!Se&&xe.getParent(),ze=[];return xe._name!=null&&(Ie.id=xe._name),s.each(De,function(Ge){var We=Ge.get,je=Ge.type,rt=xe[We]();if(Ge.exportFilter?Ge.exportFilter(xe,rt):!Me||!s.equals(Me[We](),rt)){if(je==="color"&&rt!=null){var Je=rt.getAlpha();Je<1&&(Ie[Ge.attribute+"-opacity"]=Je)}je==="style"?ze.push(Ge.attribute+": "+rt):Ie[Ge.attribute]=rt==null?"none":je==="color"?rt.gradient?Z(rt):rt.toCSS(!0):je==="array"?rt.join(","):je==="lookup"?Ge.toSVG[rt]:rt}}),ze.length&&(Ie.style=ze.join(";")),Ie.opacity===1&&delete Ie.opacity,xe._visible||(Ie.visibility="hidden"),Le.set(ce,Ie,h)}var de;function le(xe,ce){return de||(de={ids:{},svgs:{}}),xe&&de.svgs[ce+"-"+(xe._id||xe.__id||(xe.__id=O.get("svg")))]}function we(xe,ce,Se){de||le();var Ie=de.ids[Se]=(de.ids[Se]||0)+1;ce.id=Se+"-"+Ie,de.svgs[Se+"-"+(xe._id||xe.__id)]=ce}function Ve(xe,ce){var Se=xe,Ie=null;if(de){Se=xe.nodeName.toLowerCase()==="svg"&&xe;for(var Me in de.svgs)Ie||(Se||(Se=Le.create("svg"),Se.appendChild(xe)),Ie=Se.insertBefore(Le.create("defs"),Se.firstChild)),Ie.appendChild(de.svgs[Me]);de=null}return ce.asString?new e.XMLSerializer().serializeToString(Se):Se}function ke(xe,ce,Se){var Ie=pe[xe._class],Me=Ie&&Ie(xe,ce);if(Me){var ze=ce.onExport;ze&&(Me=ze(xe,Me,ce)||Me);var Ge=JSON.stringify(xe._data);Ge&&Ge!=="{}"&&Ge!=="null"&&Me.setAttribute("data-paper-data",Ge)}return Me&&me(xe,Me,Se)}function ye(xe){return xe||(xe={}),h=new y(xe.precision),xe}fe.inject({exportSVG:function(xe){return xe=ye(xe),Ve(ke(this,xe,!0),xe)}}),ue.inject({exportSVG:function(xe){xe=ye(xe);var ce=this._children,Se=this.getView(),Ie=s.pick(xe.bounds,"view"),Me=xe.matrix||Ie==="view"&&Se._matrix,ze=Me&&ae.read([Me]),Ge=Ie==="view"?new H([0,0],Se.getViewSize()):Ie==="content"?fe._getBounds(ce,ze,{stroke:!0}).rect:H.read([Ie],0,{readNull:!0}),We={version:"1.1",xmlns:Le.svg,"xmlns:xlink":Le.xlink};Ge&&(We.width=Ge.width,We.height=Ge.height,(Ge.x||Ge.x===0||Ge.y||Ge.y===0)&&(We.viewBox=h.rectangle(Ge)));var je=Le.create("svg",We,h),rt=je;ze&&!ze.isIdentity()&&(rt=je.appendChild(Le.create("g",f(ze),h)));for(var Je=0,lt=ce.length;Je<lt;Je++)rt.appendChild(ke(ce[Je],xe,!0));return Ve(je,xe)}})},new function(){var h={},f;function b(ce,Se,Ie,Me,ze,Ge){var We=Le.get(ce,Se)||Ge,je=We==null?Me?null:Ie?"":0:Ie?We:parseFloat(We);return/%\s*$/.test(We)?je/100*(ze?1:f[/x|^width/.test(Se)?"width":"height"]):je}function L(ce,Se,Ie,Me,ze,Ge,We){return Se=b(ce,Se||"x",!1,Me,ze,Ge),Ie=b(ce,Ie||"y",!1,Me,ze,We),Me&&(Se==null||Ie==null)?null:new D(Se,Ie)}function I(ce,Se,Ie,Me,ze){return Se=b(ce,Se||"width",!1,Me,ze),Ie=b(ce,Ie||"height",!1,Me,ze),Me&&(Se==null||Ie==null)?null:new w(Se,Ie)}function B(ce,Se,Ie){return ce==="none"?null:Se==="number"?parseFloat(ce):Se==="array"?ce?ce.split(/[\s,]+/g).map(parseFloat):[]:Se==="color"?ke(ce)||ce:Se==="lookup"?Ie[ce]:ce}function j(ce,Se,Ie,Me){var ze=ce.childNodes,Ge=Se==="clippath",We=Se==="defs",je=new be,rt=je._project,Je=rt._currentStyle,lt=[];if(!Ge&&!We&&(je=Ve(je,ce,Me),rt._currentStyle=je._style.clone()),Me)for(var ht=ce.querySelectorAll("defs"),_t=0,bt=ht.length;_t<bt;_t++)ye(ht[_t],Ie,!1);for(var _t=0,bt=ze.length;_t<bt;_t++){var Tt=ze[_t],Jt;Tt.nodeType===1&&!/^defs$/i.test(Tt.nodeName)&&(Jt=ye(Tt,Ie,!1))&&!(Jt instanceof gt)&&lt.push(Jt)}return je.addChildren(lt),Ge&&(je=Ve(je.reduce(),ce,Me)),rt._currentStyle=Je,(Ge||We)&&(je.remove(),je=null),je}function Y(ce,Se){for(var Ie=ce.getAttribute("points").match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g),Me=[],ze=0,Ge=Ie.length;ze<Ge;ze+=2)Me.push(new D(parseFloat(Ie[ze]),parseFloat(Ie[ze+1])));var We=new dt(Me);return Se==="polygon"&&We.closePath(),We}function Z(ce){return nt.create(ce.getAttribute("d"))}function ie(ce,Se){var Ie=(b(ce,"href",!0)||"").substring(1),Me=Se==="radialgradient",ze;if(Ie)ze=h[Ie].getGradient(),ze._radial^Me&&(ze=ze.clone(),ze._radial=Me);else{for(var Ge=ce.childNodes,We=[],je=0,rt=Ge.length;je<rt;je++){var Je=Ge[je];Je.nodeType===1&&We.push(Ve(new Li,Je))}ze=new Mi(We,Me)}var lt,ht,_t,bt=b(ce,"gradientUnits",!0)!=="userSpaceOnUse";Me?(lt=L(ce,"cx","cy",!1,bt,"50%","50%"),ht=lt.add(b(ce,"r",!1,!1,bt,"50%"),0),_t=L(ce,"fx","fy",!0,bt)):(lt=L(ce,"x1","y1",!1,bt,"0%","0%"),ht=L(ce,"x2","y2",!1,bt,"100%","0%"));var Tt=Ve(new ti(ze,lt,ht,_t),ce);return Tt._scaleToBounds=bt,null}var pe={"#document":function(ce,Se,Ie,Me){for(var ze=ce.childNodes,Ge=0,We=ze.length;Ge<We;Ge++){var je=ze[Ge];if(je.nodeType===1)return ye(je,Ie,Me)}},g:j,svg:j,clippath:j,polygon:Y,polyline:Y,path:Z,lineargradient:ie,radialgradient:ie,image:function(ce){var Se=new J(b(ce,"href",!0));return Se.on("load",function(){var Ie=I(ce);this.setSize(Ie);var Me=L(ce).add(Ie.divide(2));this._matrix.append(new ae().translate(Me))}),Se},symbol:function(ce,Se,Ie,Me){return new gt(j(ce,Se,Ie,Me),!0)},defs:j,use:function(ce){var Se=(b(ce,"href",!0)||"").substring(1),Ie=h[Se],Me=L(ce);return Ie?Ie instanceof gt?Ie.place(Me):Ie.clone().translate(Me):null},circle:function(ce){return new W.Circle(L(ce,"cx","cy"),b(ce,"r"))},ellipse:function(ce){return new W.Ellipse({center:L(ce,"cx","cy"),radius:I(ce,"rx","ry")})},rect:function(ce){return new W.Rectangle(new H(L(ce),I(ce)),I(ce,"rx","ry"))},line:function(ce){return new dt.Line(L(ce,"x1","y1"),L(ce,"x2","y2"))},text:function(ce){var Se=new yi(L(ce).add(L(ce,"dx","dy")));return Se.setContent(ce.textContent.trim()||""),Se},switch:j};function me(ce,Se,Ie,Me){if(ce.transform){for(var ze=(Me.getAttribute(Ie)||"").split(/\)\s*/g),Ge=new ae,We=0,je=ze.length;We<je;We++){var rt=ze[We];if(!rt)break;for(var Je=rt.split(/\(\s*/),lt=Je[0],ht=Je[1].split(/[\s,]+/g),_t=0,bt=ht.length;_t<bt;_t++)ht[_t]=parseFloat(ht[_t]);switch(lt){case"matrix":Ge.append(new ae(ht[0],ht[1],ht[2],ht[3],ht[4],ht[5]));break;case"rotate":Ge.rotate(ht[0],ht[1]||0,ht[2]||0);break;case"translate":Ge.translate(ht[0],ht[1]||0);break;case"scale":Ge.scale(ht);break;case"skewX":Ge.skew(ht[0],0);break;case"skewY":Ge.skew(0,ht[0]);break}}ce.transform(Ge)}}function de(ce,Se,Ie){var Me=Ie==="fill-opacity"?"getFillColor":"getStrokeColor",ze=ce[Me]&&ce[Me]();ze&&ze.setAlpha(parseFloat(Se))}var le=s.set(s.each(De,function(ce){this[ce.attribute]=function(Se,Ie){if(Se[ce.set]&&(Se[ce.set](B(Ie,ce.type,ce.fromSVG)),ce.type==="color")){var Me=Se[ce.get]();if(Me&&Me._scaleToBounds){var ze=Se.getBounds();Me.transform(new ae().translate(ze.getPoint()).scale(ze.getSize()))}}}},{}),{id:function(ce,Se){h[Se]=ce,ce.setName&&ce.setName(Se)},"clip-path":function(ce,Se){var Ie=ke(Se);if(Ie)if(Ie=Ie.clone(),Ie.setClipMask(!0),ce instanceof be)ce.insertChild(0,Ie);else return new be(Ie,ce)},gradientTransform:me,transform:me,"fill-opacity":de,"stroke-opacity":de,visibility:function(ce,Se){ce.setVisible&&ce.setVisible(Se==="visible")},display:function(ce,Se){ce.setVisible&&ce.setVisible(Se!==null)},"stop-color":function(ce,Se){ce.setColor&&ce.setColor(Se)},"stop-opacity":function(ce,Se){ce._color&&ce._color.setAlpha(parseFloat(Se))},offset:function(ce,Se){if(ce.setOffset){var Ie=Se.match(/(.*)%$/);ce.setOffset(Ie?Ie[1]/100:parseFloat(Se))}},viewBox:function(ce,Se,Ie,Me,ze){var Ge=new H(B(Se,"array")),We=I(Me,null,null,!0),je,rt;if(ce instanceof be){var Je=We?We.divide(Ge.getSize()):1,rt=new ae().scale(Je).translate(Ge.getPoint().negate());je=ce}else ce instanceof gt&&(We&&Ge.setSize(We),je=ce._item);if(je){if(we(Me,"overflow",ze)!=="visible"){var lt=new W.Rectangle(Ge);lt.setClipMask(!0),je.addChild(lt)}rt&&je.transform(rt)}}});function we(ce,Se,Ie){var Me=ce.attributes[Se],ze=Me&&Me.value;if(!ze&&ce.style){var Ge=s.camelize(Se);ze=ce.style[Ge],!ze&&Ie.node[Ge]!==Ie.parent[Ge]&&(ze=Ie.node[Ge])}return ze?ze==="none"?null:ze:t}function Ve(ce,Se,Ie){var Me=Se.parentNode,ze={node:Pi.getStyles(Se)||{},parent:!Ie&&!/^defs$/i.test(Me.tagName)&&Pi.getStyles(Me)||{}};return s.each(le,function(Ge,We){var je=we(Se,We,ze);ce=je!==t&&Ge(ce,je,We,Se,ze)||ce}),ce}function ke(ce){var Se=ce&&ce.match(/\((?:["'#]*)([^"')]+)/),Ie=Se&&Se[1],Me=Ie&&h[n?Ie.replace(n.location.href.split("#")[0]+"#",""):Ie];return Me&&Me._scaleToBounds&&(Me=Me.clone(),Me._scaleToBounds=!0),Me}function ye(ce,Se,Ie){var Me=ce.nodeName.toLowerCase(),ze=Me!=="#document",Ge=r.body,We,je,rt;Ie&&ze&&(f=ct.getView().getSize(),f=I(ce,null,null,!0)||f,We=Le.create("svg",{style:"stroke-width: 1px; stroke-miterlimit: 10"}),je=ce.parentNode,rt=ce.nextSibling,We.appendChild(ce),Ge.appendChild(We));var Je=ct.settings,lt=Je.applyMatrix,ht=Je.insertItems;Je.applyMatrix=!1,Je.insertItems=!1;var _t=pe[Me],bt=_t&&_t(ce,Me,Se,Ie)||null;if(Je.insertItems=ht,Je.applyMatrix=lt,bt){ze&&!(bt instanceof be)&&(bt=Ve(bt,ce,Ie));var Tt=Se.onImport,Jt=ze&&ce.getAttribute("data-paper-data");Tt&&(bt=Tt(ce,bt,Se)||bt),Se.expandShapes&&bt instanceof W&&(bt.remove(),bt=bt.toPath()),Jt&&(bt._data=JSON.parse(Jt))}return We&&(Ge.removeChild(We),je&&(rt?je.insertBefore(ce,rt):je.appendChild(ce))),Ie&&(h={},bt&&s.pick(Se.applyMatrix,lt)&&bt.matrix.apply(!0,!0)),bt}function xe(ce,Se,Ie){if(!ce)return null;Se=typeof Se=="function"?{onLoad:Se}:Se||{};var Me=ct,ze=null;function Ge(Je){try{var lt=typeof Je=="object"?Je:new e.DOMParser().parseFromString(Je.trim(),"image/svg+xml");if(!lt.nodeName)throw lt=null,new Error("Unsupported SVG source: "+ce);ct=Me,ze=ye(lt,Se,!0),(!Se||Se.insert!==!1)&&Ie._insertItem(t,ze);var ht=Se.onLoad;ht&&ht(ze,Je)}catch(_t){We(_t)}}function We(Je,lt){var ht=Se.onError;if(ht)ht(Je,lt);else throw new Error(Je)}if(typeof ce=="string"&&!/^[\s\S]*</.test(ce)){var je=r.getElementById(ce);je?Ge(je):Ze.request({url:ce,async:!0,onLoad:Ge,onError:We})}else if(typeof File<"u"&&ce instanceof File){var rt=new FileReader;return rt.onload=function(){Ge(rt.result)},rt.onerror=function(){We(rt.error)},rt.readAsText(ce)}else Ge(ce);return ze}fe.inject({importSVG:function(ce,Se){return xe(ce,Se,this)}}),ue.inject({importSVG:function(ce,Se){return this.activate(),xe(ce,Se,this)}})};var ct=new(l.inject(s.exports,{Base:s,Numerical:m,Key:qs,DomEvent:Oi,DomElement:Pi,document:r,window:n,Symbol:gt,PlacedSymbol:Ue}));return ct.agent.node,typeof t=="function"&&t.amd?t("paper",ct):o&&(o.exports=ct),ct}).call(window,typeof self=="object"?self:null)})(paperJs0_12_17);var he1_1_1={exports:{}};/*! https://mths.be/he v1.1.1 by @mathias | MIT license */he1_1_1.exports;(function(o,e){(function(t){var n=e,r=o&&o.exports==n&&o,s=typeof commonjsGlobal=="object"&&commonjsGlobal;(s.global===s||s.window===s)&&(t=s);var a=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,l=/[\x01-\x7F]/g,d=/[\x01-\t\x0B\f\x0E-\x1F\x7F\x81\x8D\x8F\x90\x9D\xA0-\uFFFF]/g,c=/<\u20D2|=\u20E5|>\u20D2|\u205F\u200A|\u219D\u0338|\u2202\u0338|\u2220\u20D2|\u2229\uFE00|\u222A\uFE00|\u223C\u20D2|\u223D\u0331|\u223E\u0333|\u2242\u0338|\u224B\u0338|\u224D\u20D2|\u224E\u0338|\u224F\u0338|\u2250\u0338|\u2261\u20E5|\u2264\u20D2|\u2265\u20D2|\u2266\u0338|\u2267\u0338|\u2268\uFE00|\u2269\uFE00|\u226A\u0338|\u226A\u20D2|\u226B\u0338|\u226B\u20D2|\u227F\u0338|\u2282\u20D2|\u2283\u20D2|\u228A\uFE00|\u228B\uFE00|\u228F\u0338|\u2290\u0338|\u2293\uFE00|\u2294\uFE00|\u22B4\u20D2|\u22B5\u20D2|\u22D8\u0338|\u22D9\u0338|\u22DA\uFE00|\u22DB\uFE00|\u22F5\u0338|\u22F9\u0338|\u2933\u0338|\u29CF\u0338|\u29D0\u0338|\u2A6D\u0338|\u2A70\u0338|\u2A7D\u0338|\u2A7E\u0338|\u2AA1\u0338|\u2AA2\u0338|\u2AAC\uFE00|\u2AAD\uFE00|\u2AAF\u0338|\u2AB0\u0338|\u2AC5\u0338|\u2AC6\u0338|\u2ACB\uFE00|\u2ACC\uFE00|\u2AFD\u20E5|[\xA0-\u0113\u0116-\u0122\u0124-\u012B\u012E-\u014D\u0150-\u017E\u0192\u01B5\u01F5\u0237\u02C6\u02C7\u02D8-\u02DD\u0311\u0391-\u03A1\u03A3-\u03A9\u03B1-\u03C9\u03D1\u03D2\u03D5\u03D6\u03DC\u03DD\u03F0\u03F1\u03F5\u03F6\u0401-\u040C\u040E-\u044F\u0451-\u045C\u045E\u045F\u2002-\u2005\u2007-\u2010\u2013-\u2016\u2018-\u201A\u201C-\u201E\u2020-\u2022\u2025\u2026\u2030-\u2035\u2039\u203A\u203E\u2041\u2043\u2044\u204F\u2057\u205F-\u2063\u20AC\u20DB\u20DC\u2102\u2105\u210A-\u2113\u2115-\u211E\u2122\u2124\u2127-\u2129\u212C\u212D\u212F-\u2131\u2133-\u2138\u2145-\u2148\u2153-\u215E\u2190-\u219B\u219D-\u21A7\u21A9-\u21AE\u21B0-\u21B3\u21B5-\u21B7\u21BA-\u21DB\u21DD\u21E4\u21E5\u21F5\u21FD-\u2205\u2207-\u2209\u220B\u220C\u220F-\u2214\u2216-\u2218\u221A\u221D-\u2238\u223A-\u2257\u2259\u225A\u225C\u225F-\u2262\u2264-\u228B\u228D-\u229B\u229D-\u22A5\u22A7-\u22B0\u22B2-\u22BB\u22BD-\u22DB\u22DE-\u22E3\u22E6-\u22F7\u22F9-\u22FE\u2305\u2306\u2308-\u2310\u2312\u2313\u2315\u2316\u231C-\u231F\u2322\u2323\u232D\u232E\u2336\u233D\u233F\u237C\u23B0\u23B1\u23B4-\u23B6\u23DC-\u23DF\u23E2\u23E7\u2423\u24C8\u2500\u2502\u250C\u2510\u2514\u2518\u251C\u2524\u252C\u2534\u253C\u2550-\u256C\u2580\u2584\u2588\u2591-\u2593\u25A1\u25AA\u25AB\u25AD\u25AE\u25B1\u25B3-\u25B5\u25B8\u25B9\u25BD-\u25BF\u25C2\u25C3\u25CA\u25CB\u25EC\u25EF\u25F8-\u25FC\u2605\u2606\u260E\u2640\u2642\u2660\u2663\u2665\u2666\u266A\u266D-\u266F\u2713\u2717\u2720\u2736\u2758\u2772\u2773\u27C8\u27C9\u27E6-\u27ED\u27F5-\u27FA\u27FC\u27FF\u2902-\u2905\u290C-\u2913\u2916\u2919-\u2920\u2923-\u292A\u2933\u2935-\u2939\u293C\u293D\u2945\u2948-\u294B\u294E-\u2976\u2978\u2979\u297B-\u297F\u2985\u2986\u298B-\u2996\u299A\u299C\u299D\u29A4-\u29B7\u29B9\u29BB\u29BC\u29BE-\u29C5\u29C9\u29CD-\u29D0\u29DC-\u29DE\u29E3-\u29E5\u29EB\u29F4\u29F6\u2A00-\u2A02\u2A04\u2A06\u2A0C\u2A0D\u2A10-\u2A17\u2A22-\u2A27\u2A29\u2A2A\u2A2D-\u2A31\u2A33-\u2A3C\u2A3F\u2A40\u2A42-\u2A4D\u2A50\u2A53-\u2A58\u2A5A-\u2A5D\u2A5F\u2A66\u2A6A\u2A6D-\u2A75\u2A77-\u2A9A\u2A9D-\u2AA2\u2AA4-\u2AB0\u2AB3-\u2AC8\u2ACB\u2ACC\u2ACF-\u2ADB\u2AE4\u2AE6-\u2AE9\u2AEB-\u2AF3\u2AFD\uFB00-\uFB04]|\uD835[\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDCCF\uDD04\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDD6B]/g,y={"­":"shy","‌":"zwnj","‍":"zwj","‎":"lrm","⁣":"ic","⁢":"it","⁡":"af","‏":"rlm","​":"ZeroWidthSpace","⁠":"NoBreak","̑":"DownBreve","⃛":"tdot","⃜":"DotDot","	":"Tab","\n":"NewLine"," ":"puncsp"," ":"MediumSpace"," ":"thinsp"," ":"hairsp"," ":"emsp13"," ":"ensp"," ":"emsp14"," ":"emsp"," ":"numsp"," ":"nbsp","  ":"ThickSpace","‾":"oline",_:"lowbar","‐":"dash","–":"ndash","—":"mdash","―":"horbar",",":"comma",";":"semi","⁏":"bsemi",":":"colon","⩴":"Colone","!":"excl","¡":"iexcl","?":"quest","¿":"iquest",".":"period","‥":"nldr","…":"mldr","·":"middot","'":"apos","‘":"lsquo","’":"rsquo","‚":"sbquo","‹":"lsaquo","›":"rsaquo",'"':"quot","“":"ldquo","”":"rdquo","„":"bdquo","«":"laquo","»":"raquo","(":"lpar",")":"rpar","[":"lsqb","]":"rsqb","{":"lcub","}":"rcub","⌈":"lceil","⌉":"rceil","⌊":"lfloor","⌋":"rfloor","⦅":"lopar","⦆":"ropar","⦋":"lbrke","⦌":"rbrke","⦍":"lbrkslu","⦎":"rbrksld","⦏":"lbrksld","⦐":"rbrkslu","⦑":"langd","⦒":"rangd","⦓":"lparlt","⦔":"rpargt","⦕":"gtlPar","⦖":"ltrPar","⟦":"lobrk","⟧":"robrk","⟨":"lang","⟩":"rang","⟪":"Lang","⟫":"Rang","⟬":"loang","⟭":"roang","❲":"lbbrk","❳":"rbbrk","‖":"Vert","§":"sect","¶":"para","@":"commat","*":"ast","/":"sol",undefined:null,"&":"amp","#":"num","%":"percnt","‰":"permil","‱":"pertenk","†":"dagger","‡":"Dagger","•":"bull","⁃":"hybull","′":"prime","″":"Prime","‴":"tprime","⁗":"qprime","‵":"bprime","⁁":"caret","`":"grave","´":"acute","˜":"tilde","^":"Hat","¯":"macr","˘":"breve","˙":"dot","¨":"die","˚":"ring","˝":"dblac","¸":"cedil","˛":"ogon","ˆ":"circ","ˇ":"caron","°":"deg","©":"copy","®":"reg","℗":"copysr","℘":"wp","℞":"rx","℧":"mho","℩":"iiota","←":"larr","↚":"nlarr","→":"rarr","↛":"nrarr","↑":"uarr","↓":"darr","↔":"harr","↮":"nharr","↕":"varr","↖":"nwarr","↗":"nearr","↘":"searr","↙":"swarr","↝":"rarrw","↝̸":"nrarrw","↞":"Larr","↟":"Uarr","↠":"Rarr","↡":"Darr","↢":"larrtl","↣":"rarrtl","↤":"mapstoleft","↥":"mapstoup","↦":"map","↧":"mapstodown","↩":"larrhk","↪":"rarrhk","↫":"larrlp","↬":"rarrlp","↭":"harrw","↰":"lsh","↱":"rsh","↲":"ldsh","↳":"rdsh","↵":"crarr","↶":"cularr","↷":"curarr","↺":"olarr","↻":"orarr","↼":"lharu","↽":"lhard","↾":"uharr","↿":"uharl","⇀":"rharu","⇁":"rhard","⇂":"dharr","⇃":"dharl","⇄":"rlarr","⇅":"udarr","⇆":"lrarr","⇇":"llarr","⇈":"uuarr","⇉":"rrarr","⇊":"ddarr","⇋":"lrhar","⇌":"rlhar","⇐":"lArr","⇍":"nlArr","⇑":"uArr","⇒":"rArr","⇏":"nrArr","⇓":"dArr","⇔":"iff","⇎":"nhArr","⇕":"vArr","⇖":"nwArr","⇗":"neArr","⇘":"seArr","⇙":"swArr","⇚":"lAarr","⇛":"rAarr","⇝":"zigrarr","⇤":"larrb","⇥":"rarrb","⇵":"duarr","⇽":"loarr","⇾":"roarr","⇿":"hoarr","∀":"forall","∁":"comp","∂":"part","∂̸":"npart","∃":"exist","∄":"nexist","∅":"empty","∇":"Del","∈":"in","∉":"notin","∋":"ni","∌":"notni","϶":"bepsi","∏":"prod","∐":"coprod","∑":"sum","+":"plus","±":"pm","÷":"div","×":"times","<":"lt","≮":"nlt","<⃒":"nvlt","=":"equals","≠":"ne","=⃥":"bne","⩵":"Equal",">":"gt","≯":"ngt",">⃒":"nvgt","¬":"not","|":"vert","¦":"brvbar","−":"minus","∓":"mp","∔":"plusdo","⁄":"frasl","∖":"setmn","∗":"lowast","∘":"compfn","√":"Sqrt","∝":"prop","∞":"infin","∟":"angrt","∠":"ang","∠⃒":"nang","∡":"angmsd","∢":"angsph","∣":"mid","∤":"nmid","∥":"par","∦":"npar","∧":"and","∨":"or","∩":"cap","∩︀":"caps","∪":"cup","∪︀":"cups","∫":"int","∬":"Int","∭":"tint","⨌":"qint","∮":"oint","∯":"Conint","∰":"Cconint","∱":"cwint","∲":"cwconint","∳":"awconint","∴":"there4","∵":"becaus","∶":"ratio","∷":"Colon","∸":"minusd","∺":"mDDot","∻":"homtht","∼":"sim","≁":"nsim","∼⃒":"nvsim","∽":"bsim","∽̱":"race","∾":"ac","∾̳":"acE","∿":"acd","≀":"wr","≂":"esim","≂̸":"nesim","≃":"sime","≄":"nsime","≅":"cong","≇":"ncong","≆":"simne","≈":"ap","≉":"nap","≊":"ape","≋":"apid","≋̸":"napid","≌":"bcong","≍":"CupCap","≭":"NotCupCap","≍⃒":"nvap","≎":"bump","≎̸":"nbump","≏":"bumpe","≏̸":"nbumpe","≐":"doteq","≐̸":"nedot","≑":"eDot","≒":"efDot","≓":"erDot","≔":"colone","≕":"ecolon","≖":"ecir","≗":"cire","≙":"wedgeq","≚":"veeeq","≜":"trie","≟":"equest","≡":"equiv","≢":"nequiv","≡⃥":"bnequiv","≤":"le","≰":"nle","≤⃒":"nvle","≥":"ge","≱":"nge","≥⃒":"nvge","≦":"lE","≦̸":"nlE","≧":"gE","≧̸":"ngE","≨︀":"lvnE","≨":"lnE","≩":"gnE","≩︀":"gvnE","≪":"ll","≪̸":"nLtv","≪⃒":"nLt","≫":"gg","≫̸":"nGtv","≫⃒":"nGt","≬":"twixt","≲":"lsim","≴":"nlsim","≳":"gsim","≵":"ngsim","≶":"lg","≸":"ntlg","≷":"gl","≹":"ntgl","≺":"pr","⊀":"npr","≻":"sc","⊁":"nsc","≼":"prcue","⋠":"nprcue","≽":"sccue","⋡":"nsccue","≾":"prsim","≿":"scsim","≿̸":"NotSucceedsTilde","⊂":"sub","⊄":"nsub","⊂⃒":"vnsub","⊃":"sup","⊅":"nsup","⊃⃒":"vnsup","⊆":"sube","⊈":"nsube","⊇":"supe","⊉":"nsupe","⊊︀":"vsubne","⊊":"subne","⊋︀":"vsupne","⊋":"supne","⊍":"cupdot","⊎":"uplus","⊏":"sqsub","⊏̸":"NotSquareSubset","⊐":"sqsup","⊐̸":"NotSquareSuperset","⊑":"sqsube","⋢":"nsqsube","⊒":"sqsupe","⋣":"nsqsupe","⊓":"sqcap","⊓︀":"sqcaps","⊔":"sqcup","⊔︀":"sqcups","⊕":"oplus","⊖":"ominus","⊗":"otimes","⊘":"osol","⊙":"odot","⊚":"ocir","⊛":"oast","⊝":"odash","⊞":"plusb","⊟":"minusb","⊠":"timesb","⊡":"sdotb","⊢":"vdash","⊬":"nvdash","⊣":"dashv","⊤":"top","⊥":"bot","⊧":"models","⊨":"vDash","⊭":"nvDash","⊩":"Vdash","⊮":"nVdash","⊪":"Vvdash","⊫":"VDash","⊯":"nVDash","⊰":"prurel","⊲":"vltri","⋪":"nltri","⊳":"vrtri","⋫":"nrtri","⊴":"ltrie","⋬":"nltrie","⊴⃒":"nvltrie","⊵":"rtrie","⋭":"nrtrie","⊵⃒":"nvrtrie","⊶":"origof","⊷":"imof","⊸":"mumap","⊹":"hercon","⊺":"intcal","⊻":"veebar","⊽":"barvee","⊾":"angrtvb","⊿":"lrtri","⋀":"Wedge","⋁":"Vee","⋂":"xcap","⋃":"xcup","⋄":"diam","⋅":"sdot","⋆":"Star","⋇":"divonx","⋈":"bowtie","⋉":"ltimes","⋊":"rtimes","⋋":"lthree","⋌":"rthree","⋍":"bsime","⋎":"cuvee","⋏":"cuwed","⋐":"Sub","⋑":"Sup","⋒":"Cap","⋓":"Cup","⋔":"fork","⋕":"epar","⋖":"ltdot","⋗":"gtdot","⋘":"Ll","⋘̸":"nLl","⋙":"Gg","⋙̸":"nGg","⋚︀":"lesg","⋚":"leg","⋛":"gel","⋛︀":"gesl","⋞":"cuepr","⋟":"cuesc","⋦":"lnsim","⋧":"gnsim","⋨":"prnsim","⋩":"scnsim","⋮":"vellip","⋯":"ctdot","⋰":"utdot","⋱":"dtdot","⋲":"disin","⋳":"isinsv","⋴":"isins","⋵":"isindot","⋵̸":"notindot","⋶":"notinvc","⋷":"notinvb","⋹":"isinE","⋹̸":"notinE","⋺":"nisd","⋻":"xnis","⋼":"nis","⋽":"notnivc","⋾":"notnivb","⌅":"barwed","⌆":"Barwed","⌌":"drcrop","⌍":"dlcrop","⌎":"urcrop","⌏":"ulcrop","⌐":"bnot","⌒":"profline","⌓":"profsurf","⌕":"telrec","⌖":"target","⌜":"ulcorn","⌝":"urcorn","⌞":"dlcorn","⌟":"drcorn","⌢":"frown","⌣":"smile","⌭":"cylcty","⌮":"profalar","⌶":"topbot","⌽":"ovbar","⌿":"solbar","⍼":"angzarr","⎰":"lmoust","⎱":"rmoust","⎴":"tbrk","⎵":"bbrk","⎶":"bbrktbrk","⏜":"OverParenthesis","⏝":"UnderParenthesis","⏞":"OverBrace","⏟":"UnderBrace","⏢":"trpezium","⏧":"elinters","␣":"blank","─":"boxh","│":"boxv","┌":"boxdr","┐":"boxdl","└":"boxur","┘":"boxul","├":"boxvr","┤":"boxvl","┬":"boxhd","┴":"boxhu","┼":"boxvh","═":"boxH","║":"boxV","╒":"boxdR","╓":"boxDr","╔":"boxDR","╕":"boxdL","╖":"boxDl","╗":"boxDL","╘":"boxuR","╙":"boxUr","╚":"boxUR","╛":"boxuL","╜":"boxUl","╝":"boxUL","╞":"boxvR","╟":"boxVr","╠":"boxVR","╡":"boxvL","╢":"boxVl","╣":"boxVL","╤":"boxHd","╥":"boxhD","╦":"boxHD","╧":"boxHu","╨":"boxhU","╩":"boxHU","╪":"boxvH","╫":"boxVh","╬":"boxVH","▀":"uhblk","▄":"lhblk","█":"block","░":"blk14","▒":"blk12","▓":"blk34","□":"squ","▪":"squf","▫":"EmptyVerySmallSquare","▭":"rect","▮":"marker","▱":"fltns","△":"xutri","▴":"utrif","▵":"utri","▸":"rtrif","▹":"rtri","▽":"xdtri","▾":"dtrif","▿":"dtri","◂":"ltrif","◃":"ltri","◊":"loz","○":"cir","◬":"tridot","◯":"xcirc","◸":"ultri","◹":"urtri","◺":"lltri","◻":"EmptySmallSquare","◼":"FilledSmallSquare","★":"starf","☆":"star","☎":"phone","♀":"female","♂":"male","♠":"spades","♣":"clubs","♥":"hearts","♦":"diams","♪":"sung","✓":"check","✗":"cross","✠":"malt","✶":"sext","❘":"VerticalSeparator","⟈":"bsolhsub","⟉":"suphsol","⟵":"xlarr","⟶":"xrarr","⟷":"xharr","⟸":"xlArr","⟹":"xrArr","⟺":"xhArr","⟼":"xmap","⟿":"dzigrarr","⤂":"nvlArr","⤃":"nvrArr","⤄":"nvHarr","⤅":"Map","⤌":"lbarr","⤍":"rbarr","⤎":"lBarr","⤏":"rBarr","⤐":"RBarr","⤑":"DDotrahd","⤒":"UpArrowBar","⤓":"DownArrowBar","⤖":"Rarrtl","⤙":"latail","⤚":"ratail","⤛":"lAtail","⤜":"rAtail","⤝":"larrfs","⤞":"rarrfs","⤟":"larrbfs","⤠":"rarrbfs","⤣":"nwarhk","⤤":"nearhk","⤥":"searhk","⤦":"swarhk","⤧":"nwnear","⤨":"toea","⤩":"tosa","⤪":"swnwar","⤳":"rarrc","⤳̸":"nrarrc","⤵":"cudarrr","⤶":"ldca","⤷":"rdca","⤸":"cudarrl","⤹":"larrpl","⤼":"curarrm","⤽":"cularrp","⥅":"rarrpl","⥈":"harrcir","⥉":"Uarrocir","⥊":"lurdshar","⥋":"ldrushar","⥎":"LeftRightVector","⥏":"RightUpDownVector","⥐":"DownLeftRightVector","⥑":"LeftUpDownVector","⥒":"LeftVectorBar","⥓":"RightVectorBar","⥔":"RightUpVectorBar","⥕":"RightDownVectorBar","⥖":"DownLeftVectorBar","⥗":"DownRightVectorBar","⥘":"LeftUpVectorBar","⥙":"LeftDownVectorBar","⥚":"LeftTeeVector","⥛":"RightTeeVector","⥜":"RightUpTeeVector","⥝":"RightDownTeeVector","⥞":"DownLeftTeeVector","⥟":"DownRightTeeVector","⥠":"LeftUpTeeVector","⥡":"LeftDownTeeVector","⥢":"lHar","⥣":"uHar","⥤":"rHar","⥥":"dHar","⥦":"luruhar","⥧":"ldrdhar","⥨":"ruluhar","⥩":"rdldhar","⥪":"lharul","⥫":"llhard","⥬":"rharul","⥭":"lrhard","⥮":"udhar","⥯":"duhar","⥰":"RoundImplies","⥱":"erarr","⥲":"simrarr","⥳":"larrsim","⥴":"rarrsim","⥵":"rarrap","⥶":"ltlarr","⥸":"gtrarr","⥹":"subrarr","⥻":"suplarr","⥼":"lfisht","⥽":"rfisht","⥾":"ufisht","⥿":"dfisht","⦚":"vzigzag","⦜":"vangrt","⦝":"angrtvbd","⦤":"ange","⦥":"range","⦦":"dwangle","⦧":"uwangle","⦨":"angmsdaa","⦩":"angmsdab","⦪":"angmsdac","⦫":"angmsdad","⦬":"angmsdae","⦭":"angmsdaf","⦮":"angmsdag","⦯":"angmsdah","⦰":"bemptyv","⦱":"demptyv","⦲":"cemptyv","⦳":"raemptyv","⦴":"laemptyv","⦵":"ohbar","⦶":"omid","⦷":"opar","⦹":"operp","⦻":"olcross","⦼":"odsold","⦾":"olcir","⦿":"ofcir","⧀":"olt","⧁":"ogt","⧂":"cirscir","⧃":"cirE","⧄":"solb","⧅":"bsolb","⧉":"boxbox","⧍":"trisb","⧎":"rtriltri","⧏":"LeftTriangleBar","⧏̸":"NotLeftTriangleBar","⧐":"RightTriangleBar","⧐̸":"NotRightTriangleBar","⧜":"iinfin","⧝":"infintie","⧞":"nvinfin","⧣":"eparsl","⧤":"smeparsl","⧥":"eqvparsl","⧫":"lozf","⧴":"RuleDelayed","⧶":"dsol","⨀":"xodot","⨁":"xoplus","⨂":"xotime","⨄":"xuplus","⨆":"xsqcup","⨍":"fpartint","⨐":"cirfnint","⨑":"awint","⨒":"rppolint","⨓":"scpolint","⨔":"npolint","⨕":"pointint","⨖":"quatint","⨗":"intlarhk","⨢":"pluscir","⨣":"plusacir","⨤":"simplus","⨥":"plusdu","⨦":"plussim","⨧":"plustwo","⨩":"mcomma","⨪":"minusdu","⨭":"loplus","⨮":"roplus","⨯":"Cross","⨰":"timesd","⨱":"timesbar","⨳":"smashp","⨴":"lotimes","⨵":"rotimes","⨶":"otimesas","⨷":"Otimes","⨸":"odiv","⨹":"triplus","⨺":"triminus","⨻":"tritime","⨼":"iprod","⨿":"amalg","⩀":"capdot","⩂":"ncup","⩃":"ncap","⩄":"capand","⩅":"cupor","⩆":"cupcap","⩇":"capcup","⩈":"cupbrcap","⩉":"capbrcup","⩊":"cupcup","⩋":"capcap","⩌":"ccups","⩍":"ccaps","⩐":"ccupssm","⩓":"And","⩔":"Or","⩕":"andand","⩖":"oror","⩗":"orslope","⩘":"andslope","⩚":"andv","⩛":"orv","⩜":"andd","⩝":"ord","⩟":"wedbar","⩦":"sdote","⩪":"simdot","⩭":"congdot","⩭̸":"ncongdot","⩮":"easter","⩯":"apacir","⩰":"apE","⩰̸":"napE","⩱":"eplus","⩲":"pluse","⩳":"Esim","⩷":"eDDot","⩸":"equivDD","⩹":"ltcir","⩺":"gtcir","⩻":"ltquest","⩼":"gtquest","⩽":"les","⩽̸":"nles","⩾":"ges","⩾̸":"nges","⩿":"lesdot","⪀":"gesdot","⪁":"lesdoto","⪂":"gesdoto","⪃":"lesdotor","⪄":"gesdotol","⪅":"lap","⪆":"gap","⪇":"lne","⪈":"gne","⪉":"lnap","⪊":"gnap","⪋":"lEg","⪌":"gEl","⪍":"lsime","⪎":"gsime","⪏":"lsimg","⪐":"gsiml","⪑":"lgE","⪒":"glE","⪓":"lesges","⪔":"gesles","⪕":"els","⪖":"egs","⪗":"elsdot","⪘":"egsdot","⪙":"el","⪚":"eg","⪝":"siml","⪞":"simg","⪟":"simlE","⪠":"simgE","⪡":"LessLess","⪡̸":"NotNestedLessLess","⪢":"GreaterGreater","⪢̸":"NotNestedGreaterGreater","⪤":"glj","⪥":"gla","⪦":"ltcc","⪧":"gtcc","⪨":"lescc","⪩":"gescc","⪪":"smt","⪫":"lat","⪬":"smte","⪬︀":"smtes","⪭":"late","⪭︀":"lates","⪮":"bumpE","⪯":"pre","⪯̸":"npre","⪰":"sce","⪰̸":"nsce","⪳":"prE","⪴":"scE","⪵":"prnE","⪶":"scnE","⪷":"prap","⪸":"scap","⪹":"prnap","⪺":"scnap","⪻":"Pr","⪼":"Sc","⪽":"subdot","⪾":"supdot","⪿":"subplus","⫀":"supplus","⫁":"submult","⫂":"supmult","⫃":"subedot","⫄":"supedot","⫅":"subE","⫅̸":"nsubE","⫆":"supE","⫆̸":"nsupE","⫇":"subsim","⫈":"supsim","⫋︀":"vsubnE","⫋":"subnE","⫌︀":"vsupnE","⫌":"supnE","⫏":"csub","⫐":"csup","⫑":"csube","⫒":"csupe","⫓":"subsup","⫔":"supsub","⫕":"subsub","⫖":"supsup","⫗":"suphsub","⫘":"supdsub","⫙":"forkv","⫚":"topfork","⫛":"mlcp","⫤":"Dashv","⫦":"Vdashl","⫧":"Barv","⫨":"vBar","⫩":"vBarv","⫫":"Vbar","⫬":"Not","⫭":"bNot","⫮":"rnmid","⫯":"cirmid","⫰":"midcir","⫱":"topcir","⫲":"nhpar","⫳":"parsim","⫽":"parsl","⫽⃥":"nparsl","♭":"flat","♮":"natur","♯":"sharp","¤":"curren","¢":"cent",$:"dollar","£":"pound","¥":"yen","€":"euro","¹":"sup1","½":"half","⅓":"frac13","¼":"frac14","⅕":"frac15","⅙":"frac16","⅛":"frac18","²":"sup2","⅔":"frac23","⅖":"frac25","³":"sup3","¾":"frac34","⅗":"frac35","⅜":"frac38","⅘":"frac45","⅚":"frac56","⅝":"frac58","⅞":"frac78","𝒶":"ascr","𝕒":"aopf","𝔞":"afr","𝔸":"Aopf","𝔄":"Afr","𝒜":"Ascr",ª:"ordf",á:"aacute",Á:"Aacute",à:"agrave",À:"Agrave",ă:"abreve",Ă:"Abreve",â:"acirc",Â:"Acirc",å:"aring",Å:"angst",ä:"auml",Ä:"Auml",ã:"atilde",Ã:"Atilde",ą:"aogon",Ą:"Aogon",ā:"amacr",Ā:"Amacr",æ:"aelig",Æ:"AElig","𝒷":"bscr","𝕓":"bopf","𝔟":"bfr","𝔹":"Bopf",ℬ:"Bscr","𝔅":"Bfr","𝔠":"cfr","𝒸":"cscr","𝕔":"copf",ℭ:"Cfr","𝒞":"Cscr",ℂ:"Copf",ć:"cacute",Ć:"Cacute",ĉ:"ccirc",Ĉ:"Ccirc",č:"ccaron",Č:"Ccaron",ċ:"cdot",Ċ:"Cdot",ç:"ccedil",Ç:"Ccedil","℅":"incare","𝔡":"dfr","ⅆ":"dd","𝕕":"dopf","𝒹":"dscr","𝒟":"Dscr","𝔇":"Dfr","ⅅ":"DD","𝔻":"Dopf",ď:"dcaron",Ď:"Dcaron",đ:"dstrok",Đ:"Dstrok",ð:"eth",Ð:"ETH","ⅇ":"ee",ℯ:"escr","𝔢":"efr","𝕖":"eopf",ℰ:"Escr","𝔈":"Efr","𝔼":"Eopf",é:"eacute",É:"Eacute",è:"egrave",È:"Egrave",ê:"ecirc",Ê:"Ecirc",ě:"ecaron",Ě:"Ecaron",ë:"euml",Ë:"Euml",ė:"edot",Ė:"Edot",ę:"eogon",Ę:"Eogon",ē:"emacr",Ē:"Emacr","𝔣":"ffr","𝕗":"fopf","𝒻":"fscr","𝔉":"Ffr","𝔽":"Fopf",ℱ:"Fscr",ﬀ:"fflig",ﬃ:"ffilig",ﬄ:"ffllig",ﬁ:"filig",fj:"fjlig",ﬂ:"fllig",ƒ:"fnof",ℊ:"gscr","𝕘":"gopf","𝔤":"gfr","𝒢":"Gscr","𝔾":"Gopf","𝔊":"Gfr",ǵ:"gacute",ğ:"gbreve",Ğ:"Gbreve",ĝ:"gcirc",Ĝ:"Gcirc",ġ:"gdot",Ġ:"Gdot",Ģ:"Gcedil","𝔥":"hfr",ℎ:"planckh","𝒽":"hscr","𝕙":"hopf",ℋ:"Hscr",ℌ:"Hfr",ℍ:"Hopf",ĥ:"hcirc",Ĥ:"Hcirc",ℏ:"hbar",ħ:"hstrok",Ħ:"Hstrok","𝕚":"iopf","𝔦":"ifr","𝒾":"iscr","ⅈ":"ii","𝕀":"Iopf",ℐ:"Iscr",ℑ:"Im",í:"iacute",Í:"Iacute",ì:"igrave",Ì:"Igrave",î:"icirc",Î:"Icirc",ï:"iuml",Ï:"Iuml",ĩ:"itilde",Ĩ:"Itilde",İ:"Idot",į:"iogon",Į:"Iogon",ī:"imacr",Ī:"Imacr",ĳ:"ijlig",Ĳ:"IJlig",ı:"imath","𝒿":"jscr","𝕛":"jopf","𝔧":"jfr","𝒥":"Jscr","𝔍":"Jfr","𝕁":"Jopf",ĵ:"jcirc",Ĵ:"Jcirc","ȷ":"jmath","𝕜":"kopf","𝓀":"kscr","𝔨":"kfr","𝒦":"Kscr","𝕂":"Kopf","𝔎":"Kfr",ķ:"kcedil",Ķ:"Kcedil","𝔩":"lfr","𝓁":"lscr",ℓ:"ell","𝕝":"lopf",ℒ:"Lscr","𝔏":"Lfr","𝕃":"Lopf",ĺ:"lacute",Ĺ:"Lacute",ľ:"lcaron",Ľ:"Lcaron",ļ:"lcedil",Ļ:"Lcedil",ł:"lstrok",Ł:"Lstrok",ŀ:"lmidot",Ŀ:"Lmidot","𝔪":"mfr","𝕞":"mopf","𝓂":"mscr","𝔐":"Mfr","𝕄":"Mopf",ℳ:"Mscr","𝔫":"nfr","𝕟":"nopf","𝓃":"nscr",ℕ:"Nopf","𝒩":"Nscr","𝔑":"Nfr",ń:"nacute",Ń:"Nacute",ň:"ncaron",Ň:"Ncaron",ñ:"ntilde",Ñ:"Ntilde",ņ:"ncedil",Ņ:"Ncedil","№":"numero",ŋ:"eng",Ŋ:"ENG","𝕠":"oopf","𝔬":"ofr",ℴ:"oscr","𝒪":"Oscr","𝔒":"Ofr","𝕆":"Oopf",º:"ordm",ó:"oacute",Ó:"Oacute",ò:"ograve",Ò:"Ograve",ô:"ocirc",Ô:"Ocirc",ö:"ouml",Ö:"Ouml",ő:"odblac",Ő:"Odblac",õ:"otilde",Õ:"Otilde",ø:"oslash",Ø:"Oslash",ō:"omacr",Ō:"Omacr",œ:"oelig",Œ:"OElig","𝔭":"pfr","𝓅":"pscr","𝕡":"popf",ℙ:"Popf","𝔓":"Pfr","𝒫":"Pscr","𝕢":"qopf","𝔮":"qfr","𝓆":"qscr","𝒬":"Qscr","𝔔":"Qfr",ℚ:"Qopf",ĸ:"kgreen","𝔯":"rfr","𝕣":"ropf","𝓇":"rscr",ℛ:"Rscr",ℜ:"Re",ℝ:"Ropf",ŕ:"racute",Ŕ:"Racute",ř:"rcaron",Ř:"Rcaron",ŗ:"rcedil",Ŗ:"Rcedil","𝕤":"sopf","𝓈":"sscr","𝔰":"sfr","𝕊":"Sopf","𝔖":"Sfr","𝒮":"Sscr","Ⓢ":"oS",ś:"sacute",Ś:"Sacute",ŝ:"scirc",Ŝ:"Scirc",š:"scaron",Š:"Scaron",ş:"scedil",Ş:"Scedil",ß:"szlig","𝔱":"tfr","𝓉":"tscr","𝕥":"topf","𝒯":"Tscr","𝔗":"Tfr","𝕋":"Topf",ť:"tcaron",Ť:"Tcaron",ţ:"tcedil",Ţ:"Tcedil","™":"trade",ŧ:"tstrok",Ŧ:"Tstrok","𝓊":"uscr","𝕦":"uopf","𝔲":"ufr","𝕌":"Uopf","𝔘":"Ufr","𝒰":"Uscr",ú:"uacute",Ú:"Uacute",ù:"ugrave",Ù:"Ugrave",ŭ:"ubreve",Ŭ:"Ubreve",û:"ucirc",Û:"Ucirc",ů:"uring",Ů:"Uring",ü:"uuml",Ü:"Uuml",ű:"udblac",Ű:"Udblac",ũ:"utilde",Ũ:"Utilde",ų:"uogon",Ų:"Uogon",ū:"umacr",Ū:"Umacr","𝔳":"vfr","𝕧":"vopf","𝓋":"vscr","𝔙":"Vfr","𝕍":"Vopf","𝒱":"Vscr","𝕨":"wopf","𝓌":"wscr","𝔴":"wfr","𝒲":"Wscr","𝕎":"Wopf","𝔚":"Wfr",ŵ:"wcirc",Ŵ:"Wcirc","𝔵":"xfr","𝓍":"xscr","𝕩":"xopf","𝕏":"Xopf","𝔛":"Xfr","𝒳":"Xscr","𝔶":"yfr","𝓎":"yscr","𝕪":"yopf","𝒴":"Yscr","𝔜":"Yfr","𝕐":"Yopf",ý:"yacute",Ý:"Yacute",ŷ:"ycirc",Ŷ:"Ycirc",ÿ:"yuml",Ÿ:"Yuml","𝓏":"zscr","𝔷":"zfr","𝕫":"zopf",ℨ:"Zfr",ℤ:"Zopf","𝒵":"Zscr",ź:"zacute",Ź:"Zacute",ž:"zcaron",Ž:"Zcaron",ż:"zdot",Ż:"Zdot",Ƶ:"imped",þ:"thorn",Þ:"THORN",ŉ:"napos",α:"alpha",Α:"Alpha",β:"beta",Β:"Beta",γ:"gamma",Γ:"Gamma",δ:"delta",Δ:"Delta",ε:"epsi","ϵ":"epsiv",Ε:"Epsilon",ϝ:"gammad",Ϝ:"Gammad",ζ:"zeta",Ζ:"Zeta",η:"eta",Η:"Eta",θ:"theta",ϑ:"thetav",Θ:"Theta",ι:"iota",Ι:"Iota",κ:"kappa",ϰ:"kappav",Κ:"Kappa",λ:"lambda",Λ:"Lambda",μ:"mu",µ:"micro",Μ:"Mu",ν:"nu",Ν:"Nu",ξ:"xi",Ξ:"Xi",ο:"omicron",Ο:"Omicron",π:"pi",ϖ:"piv",Π:"Pi",ρ:"rho",ϱ:"rhov",Ρ:"Rho",σ:"sigma",Σ:"Sigma",ς:"sigmaf",τ:"tau",Τ:"Tau",υ:"upsi",Υ:"Upsilon",ϒ:"Upsi",φ:"phi",ϕ:"phiv",Φ:"Phi",χ:"chi",Χ:"Chi",ψ:"psi",Ψ:"Psi",ω:"omega",Ω:"ohm",а:"acy",А:"Acy",б:"bcy",Б:"Bcy",в:"vcy",В:"Vcy",г:"gcy",Г:"Gcy",ѓ:"gjcy",Ѓ:"GJcy",д:"dcy",Д:"Dcy",ђ:"djcy",Ђ:"DJcy",е:"iecy",Е:"IEcy",ё:"iocy",Ё:"IOcy",є:"jukcy",Є:"Jukcy",ж:"zhcy",Ж:"ZHcy",з:"zcy",З:"Zcy",ѕ:"dscy",Ѕ:"DScy",и:"icy",И:"Icy",і:"iukcy",І:"Iukcy",ї:"yicy",Ї:"YIcy",й:"jcy",Й:"Jcy",ј:"jsercy",Ј:"Jsercy",к:"kcy",К:"Kcy",ќ:"kjcy",Ќ:"KJcy",л:"lcy",Л:"Lcy",љ:"ljcy",Љ:"LJcy",м:"mcy",М:"Mcy",н:"ncy",Н:"Ncy",њ:"njcy",Њ:"NJcy",о:"ocy",О:"Ocy",п:"pcy",П:"Pcy",р:"rcy",Р:"Rcy",с:"scy",С:"Scy",т:"tcy",Т:"Tcy",ћ:"tshcy",Ћ:"TSHcy",у:"ucy",У:"Ucy",ў:"ubrcy",Ў:"Ubrcy",ф:"fcy",Ф:"Fcy",х:"khcy",Х:"KHcy",ц:"tscy",Ц:"TScy",ч:"chcy",Ч:"CHcy",џ:"dzcy",Џ:"DZcy",ш:"shcy",Ш:"SHcy",щ:"shchcy",Щ:"SHCHcy",ъ:"hardcy",Ъ:"HARDcy",ы:"ycy",Ы:"Ycy",ь:"softcy",Ь:"SOFTcy",э:"ecy",Э:"Ecy",ю:"yucy",Ю:"YUcy",я:"yacy",Я:"YAcy",ℵ:"aleph",ℶ:"beth",ℷ:"gimel",ℸ:"daleth"},m=/["&'<>`]/g,O={'"':"&quot;","&":"&amp;","'":"&#x27;","<":"&lt;",">":"&gt;","`":"&#x60;"},D=/&#(?:[xX][^a-fA-F0-9]|[^0-9xX])/,z=/[\0-\x08\x0B\x0E-\x1F\x7F-\x9F\uFDD0-\uFDEF\uFFFE\uFFFF]|[\uD83F\uD87F\uD8BF\uD8FF\uD93F\uD97F\uD9BF\uD9FF\uDA3F\uDA7F\uDABF\uDAFF\uDB3F\uDB7F\uDBBF\uDBFF][\uDFFE\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,w=/&#([0-9]+)(;?)|&#[xX]([a-fA-F0-9]+)(;?)|&([0-9a-zA-Z]+);|&(Aacute|Agrave|Atilde|Ccedil|Eacute|Egrave|Iacute|Igrave|Ntilde|Oacute|Ograve|Oslash|Otilde|Uacute|Ugrave|Yacute|aacute|agrave|atilde|brvbar|ccedil|curren|divide|eacute|egrave|frac12|frac14|frac34|iacute|igrave|iquest|middot|ntilde|oacute|ograve|oslash|otilde|plusmn|uacute|ugrave|yacute|AElig|Acirc|Aring|Ecirc|Icirc|Ocirc|THORN|Ucirc|acirc|acute|aelig|aring|cedil|ecirc|icirc|iexcl|laquo|micro|ocirc|pound|raquo|szlig|thorn|times|ucirc|Auml|COPY|Euml|Iuml|Ouml|QUOT|Uuml|auml|cent|copy|euml|iuml|macr|nbsp|ordf|ordm|ouml|para|quot|sect|sup1|sup2|sup3|uuml|yuml|AMP|ETH|REG|amp|deg|eth|not|reg|shy|uml|yen|GT|LT|gt|lt)([=a-zA-Z0-9])?/g,N={aacute:"á",Aacute:"Á",abreve:"ă",Abreve:"Ă",ac:"∾",acd:"∿",acE:"∾̳",acirc:"â",Acirc:"Â",acute:"´",acy:"а",Acy:"А",aelig:"æ",AElig:"Æ",af:"⁡",afr:"𝔞",Afr:"𝔄",agrave:"à",Agrave:"À",alefsym:"ℵ",aleph:"ℵ",alpha:"α",Alpha:"Α",amacr:"ā",Amacr:"Ā",amalg:"⨿",amp:"&",AMP:"&",and:"∧",And:"⩓",andand:"⩕",andd:"⩜",andslope:"⩘",andv:"⩚",ang:"∠",ange:"⦤",angle:"∠",angmsd:"∡",angmsdaa:"⦨",angmsdab:"⦩",angmsdac:"⦪",angmsdad:"⦫",angmsdae:"⦬",angmsdaf:"⦭",angmsdag:"⦮",angmsdah:"⦯",angrt:"∟",angrtvb:"⊾",angrtvbd:"⦝",angsph:"∢",angst:"Å",angzarr:"⍼",aogon:"ą",Aogon:"Ą",aopf:"𝕒",Aopf:"𝔸",ap:"≈",apacir:"⩯",ape:"≊",apE:"⩰",apid:"≋",apos:"'",ApplyFunction:"⁡",approx:"≈",approxeq:"≊",aring:"å",Aring:"Å",ascr:"𝒶",Ascr:"𝒜",Assign:"≔",ast:"*",asymp:"≈",asympeq:"≍",atilde:"ã",Atilde:"Ã",auml:"ä",Auml:"Ä",awconint:"∳",awint:"⨑",backcong:"≌",backepsilon:"϶",backprime:"‵",backsim:"∽",backsimeq:"⋍",Backslash:"∖",Barv:"⫧",barvee:"⊽",barwed:"⌅",Barwed:"⌆",barwedge:"⌅",bbrk:"⎵",bbrktbrk:"⎶",bcong:"≌",bcy:"б",Bcy:"Б",bdquo:"„",becaus:"∵",because:"∵",Because:"∵",bemptyv:"⦰",bepsi:"϶",bernou:"ℬ",Bernoullis:"ℬ",beta:"β",Beta:"Β",beth:"ℶ",between:"≬",bfr:"𝔟",Bfr:"𝔅",bigcap:"⋂",bigcirc:"◯",bigcup:"⋃",bigodot:"⨀",bigoplus:"⨁",bigotimes:"⨂",bigsqcup:"⨆",bigstar:"★",bigtriangledown:"▽",bigtriangleup:"△",biguplus:"⨄",bigvee:"⋁",bigwedge:"⋀",bkarow:"⤍",blacklozenge:"⧫",blacksquare:"▪",blacktriangle:"▴",blacktriangledown:"▾",blacktriangleleft:"◂",blacktriangleright:"▸",blank:"␣",blk12:"▒",blk14:"░",blk34:"▓",block:"█",bne:"=⃥",bnequiv:"≡⃥",bnot:"⌐",bNot:"⫭",bopf:"𝕓",Bopf:"𝔹",bot:"⊥",bottom:"⊥",bowtie:"⋈",boxbox:"⧉",boxdl:"┐",boxdL:"╕",boxDl:"╖",boxDL:"╗",boxdr:"┌",boxdR:"╒",boxDr:"╓",boxDR:"╔",boxh:"─",boxH:"═",boxhd:"┬",boxhD:"╥",boxHd:"╤",boxHD:"╦",boxhu:"┴",boxhU:"╨",boxHu:"╧",boxHU:"╩",boxminus:"⊟",boxplus:"⊞",boxtimes:"⊠",boxul:"┘",boxuL:"╛",boxUl:"╜",boxUL:"╝",boxur:"└",boxuR:"╘",boxUr:"╙",boxUR:"╚",boxv:"│",boxV:"║",boxvh:"┼",boxvH:"╪",boxVh:"╫",boxVH:"╬",boxvl:"┤",boxvL:"╡",boxVl:"╢",boxVL:"╣",boxvr:"├",boxvR:"╞",boxVr:"╟",boxVR:"╠",bprime:"‵",breve:"˘",Breve:"˘",brvbar:"¦",bscr:"𝒷",Bscr:"ℬ",bsemi:"⁏",bsim:"∽",bsime:"⋍",bsol:"\\",bsolb:"⧅",bsolhsub:"⟈",bull:"•",bullet:"•",bump:"≎",bumpe:"≏",bumpE:"⪮",bumpeq:"≏",Bumpeq:"≎",cacute:"ć",Cacute:"Ć",cap:"∩",Cap:"⋒",capand:"⩄",capbrcup:"⩉",capcap:"⩋",capcup:"⩇",capdot:"⩀",CapitalDifferentialD:"ⅅ",caps:"∩︀",caret:"⁁",caron:"ˇ",Cayleys:"ℭ",ccaps:"⩍",ccaron:"č",Ccaron:"Č",ccedil:"ç",Ccedil:"Ç",ccirc:"ĉ",Ccirc:"Ĉ",Cconint:"∰",ccups:"⩌",ccupssm:"⩐",cdot:"ċ",Cdot:"Ċ",cedil:"¸",Cedilla:"¸",cemptyv:"⦲",cent:"¢",centerdot:"·",CenterDot:"·",cfr:"𝔠",Cfr:"ℭ",chcy:"ч",CHcy:"Ч",check:"✓",checkmark:"✓",chi:"χ",Chi:"Χ",cir:"○",circ:"ˆ",circeq:"≗",circlearrowleft:"↺",circlearrowright:"↻",circledast:"⊛",circledcirc:"⊚",circleddash:"⊝",CircleDot:"⊙",circledR:"®",circledS:"Ⓢ",CircleMinus:"⊖",CirclePlus:"⊕",CircleTimes:"⊗",cire:"≗",cirE:"⧃",cirfnint:"⨐",cirmid:"⫯",cirscir:"⧂",ClockwiseContourIntegral:"∲",CloseCurlyDoubleQuote:"”",CloseCurlyQuote:"’",clubs:"♣",clubsuit:"♣",colon:":",Colon:"∷",colone:"≔",Colone:"⩴",coloneq:"≔",comma:",",commat:"@",comp:"∁",compfn:"∘",complement:"∁",complexes:"ℂ",cong:"≅",congdot:"⩭",Congruent:"≡",conint:"∮",Conint:"∯",ContourIntegral:"∮",copf:"𝕔",Copf:"ℂ",coprod:"∐",Coproduct:"∐",copy:"©",COPY:"©",copysr:"℗",CounterClockwiseContourIntegral:"∳",crarr:"↵",cross:"✗",Cross:"⨯",cscr:"𝒸",Cscr:"𝒞",csub:"⫏",csube:"⫑",csup:"⫐",csupe:"⫒",ctdot:"⋯",cudarrl:"⤸",cudarrr:"⤵",cuepr:"⋞",cuesc:"⋟",cularr:"↶",cularrp:"⤽",cup:"∪",Cup:"⋓",cupbrcap:"⩈",cupcap:"⩆",CupCap:"≍",cupcup:"⩊",cupdot:"⊍",cupor:"⩅",cups:"∪︀",curarr:"↷",curarrm:"⤼",curlyeqprec:"⋞",curlyeqsucc:"⋟",curlyvee:"⋎",curlywedge:"⋏",curren:"¤",curvearrowleft:"↶",curvearrowright:"↷",cuvee:"⋎",cuwed:"⋏",cwconint:"∲",cwint:"∱",cylcty:"⌭",dagger:"†",Dagger:"‡",daleth:"ℸ",darr:"↓",dArr:"⇓",Darr:"↡",dash:"‐",dashv:"⊣",Dashv:"⫤",dbkarow:"⤏",dblac:"˝",dcaron:"ď",Dcaron:"Ď",dcy:"д",Dcy:"Д",dd:"ⅆ",DD:"ⅅ",ddagger:"‡",ddarr:"⇊",DDotrahd:"⤑",ddotseq:"⩷",deg:"°",Del:"∇",delta:"δ",Delta:"Δ",demptyv:"⦱",dfisht:"⥿",dfr:"𝔡",Dfr:"𝔇",dHar:"⥥",dharl:"⇃",dharr:"⇂",DiacriticalAcute:"´",DiacriticalDot:"˙",DiacriticalDoubleAcute:"˝",DiacriticalGrave:"`",DiacriticalTilde:"˜",diam:"⋄",diamond:"⋄",Diamond:"⋄",diamondsuit:"♦",diams:"♦",die:"¨",DifferentialD:"ⅆ",digamma:"ϝ",disin:"⋲",div:"÷",divide:"÷",divideontimes:"⋇",divonx:"⋇",djcy:"ђ",DJcy:"Ђ",dlcorn:"⌞",dlcrop:"⌍",dollar:"$",dopf:"𝕕",Dopf:"𝔻",dot:"˙",Dot:"¨",DotDot:"⃜",doteq:"≐",doteqdot:"≑",DotEqual:"≐",dotminus:"∸",dotplus:"∔",dotsquare:"⊡",doublebarwedge:"⌆",DoubleContourIntegral:"∯",DoubleDot:"¨",DoubleDownArrow:"⇓",DoubleLeftArrow:"⇐",DoubleLeftRightArrow:"⇔",DoubleLeftTee:"⫤",DoubleLongLeftArrow:"⟸",DoubleLongLeftRightArrow:"⟺",DoubleLongRightArrow:"⟹",DoubleRightArrow:"⇒",DoubleRightTee:"⊨",DoubleUpArrow:"⇑",DoubleUpDownArrow:"⇕",DoubleVerticalBar:"∥",downarrow:"↓",Downarrow:"⇓",DownArrow:"↓",DownArrowBar:"⤓",DownArrowUpArrow:"⇵",DownBreve:"̑",downdownarrows:"⇊",downharpoonleft:"⇃",downharpoonright:"⇂",DownLeftRightVector:"⥐",DownLeftTeeVector:"⥞",DownLeftVector:"↽",DownLeftVectorBar:"⥖",DownRightTeeVector:"⥟",DownRightVector:"⇁",DownRightVectorBar:"⥗",DownTee:"⊤",DownTeeArrow:"↧",drbkarow:"⤐",drcorn:"⌟",drcrop:"⌌",dscr:"𝒹",Dscr:"𝒟",dscy:"ѕ",DScy:"Ѕ",dsol:"⧶",dstrok:"đ",Dstrok:"Đ",dtdot:"⋱",dtri:"▿",dtrif:"▾",duarr:"⇵",duhar:"⥯",dwangle:"⦦",dzcy:"џ",DZcy:"Џ",dzigrarr:"⟿",eacute:"é",Eacute:"É",easter:"⩮",ecaron:"ě",Ecaron:"Ě",ecir:"≖",ecirc:"ê",Ecirc:"Ê",ecolon:"≕",ecy:"э",Ecy:"Э",eDDot:"⩷",edot:"ė",eDot:"≑",Edot:"Ė",ee:"ⅇ",efDot:"≒",efr:"𝔢",Efr:"𝔈",eg:"⪚",egrave:"è",Egrave:"È",egs:"⪖",egsdot:"⪘",el:"⪙",Element:"∈",elinters:"⏧",ell:"ℓ",els:"⪕",elsdot:"⪗",emacr:"ē",Emacr:"Ē",empty:"∅",emptyset:"∅",EmptySmallSquare:"◻",emptyv:"∅",EmptyVerySmallSquare:"▫",emsp:" ",emsp13:" ",emsp14:" ",eng:"ŋ",ENG:"Ŋ",ensp:" ",eogon:"ę",Eogon:"Ę",eopf:"𝕖",Eopf:"𝔼",epar:"⋕",eparsl:"⧣",eplus:"⩱",epsi:"ε",epsilon:"ε",Epsilon:"Ε",epsiv:"ϵ",eqcirc:"≖",eqcolon:"≕",eqsim:"≂",eqslantgtr:"⪖",eqslantless:"⪕",Equal:"⩵",equals:"=",EqualTilde:"≂",equest:"≟",Equilibrium:"⇌",equiv:"≡",equivDD:"⩸",eqvparsl:"⧥",erarr:"⥱",erDot:"≓",escr:"ℯ",Escr:"ℰ",esdot:"≐",esim:"≂",Esim:"⩳",eta:"η",Eta:"Η",eth:"ð",ETH:"Ð",euml:"ë",Euml:"Ë",euro:"€",excl:"!",exist:"∃",Exists:"∃",expectation:"ℰ",exponentiale:"ⅇ",ExponentialE:"ⅇ",fallingdotseq:"≒",fcy:"ф",Fcy:"Ф",female:"♀",ffilig:"ﬃ",fflig:"ﬀ",ffllig:"ﬄ",ffr:"𝔣",Ffr:"𝔉",filig:"ﬁ",FilledSmallSquare:"◼",FilledVerySmallSquare:"▪",fjlig:"fj",flat:"♭",fllig:"ﬂ",fltns:"▱",fnof:"ƒ",fopf:"𝕗",Fopf:"𝔽",forall:"∀",ForAll:"∀",fork:"⋔",forkv:"⫙",Fouriertrf:"ℱ",fpartint:"⨍",frac12:"½",frac13:"⅓",frac14:"¼",frac15:"⅕",frac16:"⅙",frac18:"⅛",frac23:"⅔",frac25:"⅖",frac34:"¾",frac35:"⅗",frac38:"⅜",frac45:"⅘",frac56:"⅚",frac58:"⅝",frac78:"⅞",frasl:"⁄",frown:"⌢",fscr:"𝒻",Fscr:"ℱ",gacute:"ǵ",gamma:"γ",Gamma:"Γ",gammad:"ϝ",Gammad:"Ϝ",gap:"⪆",gbreve:"ğ",Gbreve:"Ğ",Gcedil:"Ģ",gcirc:"ĝ",Gcirc:"Ĝ",gcy:"г",Gcy:"Г",gdot:"ġ",Gdot:"Ġ",ge:"≥",gE:"≧",gel:"⋛",gEl:"⪌",geq:"≥",geqq:"≧",geqslant:"⩾",ges:"⩾",gescc:"⪩",gesdot:"⪀",gesdoto:"⪂",gesdotol:"⪄",gesl:"⋛︀",gesles:"⪔",gfr:"𝔤",Gfr:"𝔊",gg:"≫",Gg:"⋙",ggg:"⋙",gimel:"ℷ",gjcy:"ѓ",GJcy:"Ѓ",gl:"≷",gla:"⪥",glE:"⪒",glj:"⪤",gnap:"⪊",gnapprox:"⪊",gne:"⪈",gnE:"≩",gneq:"⪈",gneqq:"≩",gnsim:"⋧",gopf:"𝕘",Gopf:"𝔾",grave:"`",GreaterEqual:"≥",GreaterEqualLess:"⋛",GreaterFullEqual:"≧",GreaterGreater:"⪢",GreaterLess:"≷",GreaterSlantEqual:"⩾",GreaterTilde:"≳",gscr:"ℊ",Gscr:"𝒢",gsim:"≳",gsime:"⪎",gsiml:"⪐",gt:">",Gt:"≫",GT:">",gtcc:"⪧",gtcir:"⩺",gtdot:"⋗",gtlPar:"⦕",gtquest:"⩼",gtrapprox:"⪆",gtrarr:"⥸",gtrdot:"⋗",gtreqless:"⋛",gtreqqless:"⪌",gtrless:"≷",gtrsim:"≳",gvertneqq:"≩︀",gvnE:"≩︀",Hacek:"ˇ",hairsp:" ",half:"½",hamilt:"ℋ",hardcy:"ъ",HARDcy:"Ъ",harr:"↔",hArr:"⇔",harrcir:"⥈",harrw:"↭",Hat:"^",hbar:"ℏ",hcirc:"ĥ",Hcirc:"Ĥ",hearts:"♥",heartsuit:"♥",hellip:"…",hercon:"⊹",hfr:"𝔥",Hfr:"ℌ",HilbertSpace:"ℋ",hksearow:"⤥",hkswarow:"⤦",hoarr:"⇿",homtht:"∻",hookleftarrow:"↩",hookrightarrow:"↪",hopf:"𝕙",Hopf:"ℍ",horbar:"―",HorizontalLine:"─",hscr:"𝒽",Hscr:"ℋ",hslash:"ℏ",hstrok:"ħ",Hstrok:"Ħ",HumpDownHump:"≎",HumpEqual:"≏",hybull:"⁃",hyphen:"‐",iacute:"í",Iacute:"Í",ic:"⁣",icirc:"î",Icirc:"Î",icy:"и",Icy:"И",Idot:"İ",iecy:"е",IEcy:"Е",iexcl:"¡",iff:"⇔",ifr:"𝔦",Ifr:"ℑ",igrave:"ì",Igrave:"Ì",ii:"ⅈ",iiiint:"⨌",iiint:"∭",iinfin:"⧜",iiota:"℩",ijlig:"ĳ",IJlig:"Ĳ",Im:"ℑ",imacr:"ī",Imacr:"Ī",image:"ℑ",ImaginaryI:"ⅈ",imagline:"ℐ",imagpart:"ℑ",imath:"ı",imof:"⊷",imped:"Ƶ",Implies:"⇒",in:"∈",incare:"℅",infin:"∞",infintie:"⧝",inodot:"ı",int:"∫",Int:"∬",intcal:"⊺",integers:"ℤ",Integral:"∫",intercal:"⊺",Intersection:"⋂",intlarhk:"⨗",intprod:"⨼",InvisibleComma:"⁣",InvisibleTimes:"⁢",iocy:"ё",IOcy:"Ё",iogon:"į",Iogon:"Į",iopf:"𝕚",Iopf:"𝕀",iota:"ι",Iota:"Ι",iprod:"⨼",iquest:"¿",iscr:"𝒾",Iscr:"ℐ",isin:"∈",isindot:"⋵",isinE:"⋹",isins:"⋴",isinsv:"⋳",isinv:"∈",it:"⁢",itilde:"ĩ",Itilde:"Ĩ",iukcy:"і",Iukcy:"І",iuml:"ï",Iuml:"Ï",jcirc:"ĵ",Jcirc:"Ĵ",jcy:"й",Jcy:"Й",jfr:"𝔧",Jfr:"𝔍",jmath:"ȷ",jopf:"𝕛",Jopf:"𝕁",jscr:"𝒿",Jscr:"𝒥",jsercy:"ј",Jsercy:"Ј",jukcy:"є",Jukcy:"Є",kappa:"κ",Kappa:"Κ",kappav:"ϰ",kcedil:"ķ",Kcedil:"Ķ",kcy:"к",Kcy:"К",kfr:"𝔨",Kfr:"𝔎",kgreen:"ĸ",khcy:"х",KHcy:"Х",kjcy:"ќ",KJcy:"Ќ",kopf:"𝕜",Kopf:"𝕂",kscr:"𝓀",Kscr:"𝒦",lAarr:"⇚",lacute:"ĺ",Lacute:"Ĺ",laemptyv:"⦴",lagran:"ℒ",lambda:"λ",Lambda:"Λ",lang:"⟨",Lang:"⟪",langd:"⦑",langle:"⟨",lap:"⪅",Laplacetrf:"ℒ",laquo:"«",larr:"←",lArr:"⇐",Larr:"↞",larrb:"⇤",larrbfs:"⤟",larrfs:"⤝",larrhk:"↩",larrlp:"↫",larrpl:"⤹",larrsim:"⥳",larrtl:"↢",lat:"⪫",latail:"⤙",lAtail:"⤛",late:"⪭",lates:"⪭︀",lbarr:"⤌",lBarr:"⤎",lbbrk:"❲",lbrace:"{",lbrack:"[",lbrke:"⦋",lbrksld:"⦏",lbrkslu:"⦍",lcaron:"ľ",Lcaron:"Ľ",lcedil:"ļ",Lcedil:"Ļ",lceil:"⌈",lcub:"{",lcy:"л",Lcy:"Л",ldca:"⤶",ldquo:"“",ldquor:"„",ldrdhar:"⥧",ldrushar:"⥋",ldsh:"↲",le:"≤",lE:"≦",LeftAngleBracket:"⟨",leftarrow:"←",Leftarrow:"⇐",LeftArrow:"←",LeftArrowBar:"⇤",LeftArrowRightArrow:"⇆",leftarrowtail:"↢",LeftCeiling:"⌈",LeftDoubleBracket:"⟦",LeftDownTeeVector:"⥡",LeftDownVector:"⇃",LeftDownVectorBar:"⥙",LeftFloor:"⌊",leftharpoondown:"↽",leftharpoonup:"↼",leftleftarrows:"⇇",leftrightarrow:"↔",Leftrightarrow:"⇔",LeftRightArrow:"↔",leftrightarrows:"⇆",leftrightharpoons:"⇋",leftrightsquigarrow:"↭",LeftRightVector:"⥎",LeftTee:"⊣",LeftTeeArrow:"↤",LeftTeeVector:"⥚",leftthreetimes:"⋋",LeftTriangle:"⊲",LeftTriangleBar:"⧏",LeftTriangleEqual:"⊴",LeftUpDownVector:"⥑",LeftUpTeeVector:"⥠",LeftUpVector:"↿",LeftUpVectorBar:"⥘",LeftVector:"↼",LeftVectorBar:"⥒",leg:"⋚",lEg:"⪋",leq:"≤",leqq:"≦",leqslant:"⩽",les:"⩽",lescc:"⪨",lesdot:"⩿",lesdoto:"⪁",lesdotor:"⪃",lesg:"⋚︀",lesges:"⪓",lessapprox:"⪅",lessdot:"⋖",lesseqgtr:"⋚",lesseqqgtr:"⪋",LessEqualGreater:"⋚",LessFullEqual:"≦",LessGreater:"≶",lessgtr:"≶",LessLess:"⪡",lesssim:"≲",LessSlantEqual:"⩽",LessTilde:"≲",lfisht:"⥼",lfloor:"⌊",lfr:"𝔩",Lfr:"𝔏",lg:"≶",lgE:"⪑",lHar:"⥢",lhard:"↽",lharu:"↼",lharul:"⥪",lhblk:"▄",ljcy:"љ",LJcy:"Љ",ll:"≪",Ll:"⋘",llarr:"⇇",llcorner:"⌞",Lleftarrow:"⇚",llhard:"⥫",lltri:"◺",lmidot:"ŀ",Lmidot:"Ŀ",lmoust:"⎰",lmoustache:"⎰",lnap:"⪉",lnapprox:"⪉",lne:"⪇",lnE:"≨",lneq:"⪇",lneqq:"≨",lnsim:"⋦",loang:"⟬",loarr:"⇽",lobrk:"⟦",longleftarrow:"⟵",Longleftarrow:"⟸",LongLeftArrow:"⟵",longleftrightarrow:"⟷",Longleftrightarrow:"⟺",LongLeftRightArrow:"⟷",longmapsto:"⟼",longrightarrow:"⟶",Longrightarrow:"⟹",LongRightArrow:"⟶",looparrowleft:"↫",looparrowright:"↬",lopar:"⦅",lopf:"𝕝",Lopf:"𝕃",loplus:"⨭",lotimes:"⨴",lowast:"∗",lowbar:"_",LowerLeftArrow:"↙",LowerRightArrow:"↘",loz:"◊",lozenge:"◊",lozf:"⧫",lpar:"(",lparlt:"⦓",lrarr:"⇆",lrcorner:"⌟",lrhar:"⇋",lrhard:"⥭",lrm:"‎",lrtri:"⊿",lsaquo:"‹",lscr:"𝓁",Lscr:"ℒ",lsh:"↰",Lsh:"↰",lsim:"≲",lsime:"⪍",lsimg:"⪏",lsqb:"[",lsquo:"‘",lsquor:"‚",lstrok:"ł",Lstrok:"Ł",lt:"<",Lt:"≪",LT:"<",ltcc:"⪦",ltcir:"⩹",ltdot:"⋖",lthree:"⋋",ltimes:"⋉",ltlarr:"⥶",ltquest:"⩻",ltri:"◃",ltrie:"⊴",ltrif:"◂",ltrPar:"⦖",lurdshar:"⥊",luruhar:"⥦",lvertneqq:"≨︀",lvnE:"≨︀",macr:"¯",male:"♂",malt:"✠",maltese:"✠",map:"↦",Map:"⤅",mapsto:"↦",mapstodown:"↧",mapstoleft:"↤",mapstoup:"↥",marker:"▮",mcomma:"⨩",mcy:"м",Mcy:"М",mdash:"—",mDDot:"∺",measuredangle:"∡",MediumSpace:" ",Mellintrf:"ℳ",mfr:"𝔪",Mfr:"𝔐",mho:"℧",micro:"µ",mid:"∣",midast:"*",midcir:"⫰",middot:"·",minus:"−",minusb:"⊟",minusd:"∸",minusdu:"⨪",MinusPlus:"∓",mlcp:"⫛",mldr:"…",mnplus:"∓",models:"⊧",mopf:"𝕞",Mopf:"𝕄",mp:"∓",mscr:"𝓂",Mscr:"ℳ",mstpos:"∾",mu:"μ",Mu:"Μ",multimap:"⊸",mumap:"⊸",nabla:"∇",nacute:"ń",Nacute:"Ń",nang:"∠⃒",nap:"≉",napE:"⩰̸",napid:"≋̸",napos:"ŉ",napprox:"≉",natur:"♮",natural:"♮",naturals:"ℕ",nbsp:" ",nbump:"≎̸",nbumpe:"≏̸",ncap:"⩃",ncaron:"ň",Ncaron:"Ň",ncedil:"ņ",Ncedil:"Ņ",ncong:"≇",ncongdot:"⩭̸",ncup:"⩂",ncy:"н",Ncy:"Н",ndash:"–",ne:"≠",nearhk:"⤤",nearr:"↗",neArr:"⇗",nearrow:"↗",nedot:"≐̸",NegativeMediumSpace:"​",NegativeThickSpace:"​",NegativeThinSpace:"​",NegativeVeryThinSpace:"​",nequiv:"≢",nesear:"⤨",nesim:"≂̸",NestedGreaterGreater:"≫",NestedLessLess:"≪",NewLine:`
`,nexist:"∄",nexists:"∄",nfr:"𝔫",Nfr:"𝔑",nge:"≱",ngE:"≧̸",ngeq:"≱",ngeqq:"≧̸",ngeqslant:"⩾̸",nges:"⩾̸",nGg:"⋙̸",ngsim:"≵",ngt:"≯",nGt:"≫⃒",ngtr:"≯",nGtv:"≫̸",nharr:"↮",nhArr:"⇎",nhpar:"⫲",ni:"∋",nis:"⋼",nisd:"⋺",niv:"∋",njcy:"њ",NJcy:"Њ",nlarr:"↚",nlArr:"⇍",nldr:"‥",nle:"≰",nlE:"≦̸",nleftarrow:"↚",nLeftarrow:"⇍",nleftrightarrow:"↮",nLeftrightarrow:"⇎",nleq:"≰",nleqq:"≦̸",nleqslant:"⩽̸",nles:"⩽̸",nless:"≮",nLl:"⋘̸",nlsim:"≴",nlt:"≮",nLt:"≪⃒",nltri:"⋪",nltrie:"⋬",nLtv:"≪̸",nmid:"∤",NoBreak:"⁠",NonBreakingSpace:" ",nopf:"𝕟",Nopf:"ℕ",not:"¬",Not:"⫬",NotCongruent:"≢",NotCupCap:"≭",NotDoubleVerticalBar:"∦",NotElement:"∉",NotEqual:"≠",NotEqualTilde:"≂̸",NotExists:"∄",NotGreater:"≯",NotGreaterEqual:"≱",NotGreaterFullEqual:"≧̸",NotGreaterGreater:"≫̸",NotGreaterLess:"≹",NotGreaterSlantEqual:"⩾̸",NotGreaterTilde:"≵",NotHumpDownHump:"≎̸",NotHumpEqual:"≏̸",notin:"∉",notindot:"⋵̸",notinE:"⋹̸",notinva:"∉",notinvb:"⋷",notinvc:"⋶",NotLeftTriangle:"⋪",NotLeftTriangleBar:"⧏̸",NotLeftTriangleEqual:"⋬",NotLess:"≮",NotLessEqual:"≰",NotLessGreater:"≸",NotLessLess:"≪̸",NotLessSlantEqual:"⩽̸",NotLessTilde:"≴",NotNestedGreaterGreater:"⪢̸",NotNestedLessLess:"⪡̸",notni:"∌",notniva:"∌",notnivb:"⋾",notnivc:"⋽",NotPrecedes:"⊀",NotPrecedesEqual:"⪯̸",NotPrecedesSlantEqual:"⋠",NotReverseElement:"∌",NotRightTriangle:"⋫",NotRightTriangleBar:"⧐̸",NotRightTriangleEqual:"⋭",NotSquareSubset:"⊏̸",NotSquareSubsetEqual:"⋢",NotSquareSuperset:"⊐̸",NotSquareSupersetEqual:"⋣",NotSubset:"⊂⃒",NotSubsetEqual:"⊈",NotSucceeds:"⊁",NotSucceedsEqual:"⪰̸",NotSucceedsSlantEqual:"⋡",NotSucceedsTilde:"≿̸",NotSuperset:"⊃⃒",NotSupersetEqual:"⊉",NotTilde:"≁",NotTildeEqual:"≄",NotTildeFullEqual:"≇",NotTildeTilde:"≉",NotVerticalBar:"∤",npar:"∦",nparallel:"∦",nparsl:"⫽⃥",npart:"∂̸",npolint:"⨔",npr:"⊀",nprcue:"⋠",npre:"⪯̸",nprec:"⊀",npreceq:"⪯̸",nrarr:"↛",nrArr:"⇏",nrarrc:"⤳̸",nrarrw:"↝̸",nrightarrow:"↛",nRightarrow:"⇏",nrtri:"⋫",nrtrie:"⋭",nsc:"⊁",nsccue:"⋡",nsce:"⪰̸",nscr:"𝓃",Nscr:"𝒩",nshortmid:"∤",nshortparallel:"∦",nsim:"≁",nsime:"≄",nsimeq:"≄",nsmid:"∤",nspar:"∦",nsqsube:"⋢",nsqsupe:"⋣",nsub:"⊄",nsube:"⊈",nsubE:"⫅̸",nsubset:"⊂⃒",nsubseteq:"⊈",nsubseteqq:"⫅̸",nsucc:"⊁",nsucceq:"⪰̸",nsup:"⊅",nsupe:"⊉",nsupE:"⫆̸",nsupset:"⊃⃒",nsupseteq:"⊉",nsupseteqq:"⫆̸",ntgl:"≹",ntilde:"ñ",Ntilde:"Ñ",ntlg:"≸",ntriangleleft:"⋪",ntrianglelefteq:"⋬",ntriangleright:"⋫",ntrianglerighteq:"⋭",nu:"ν",Nu:"Ν",num:"#",numero:"№",numsp:" ",nvap:"≍⃒",nvdash:"⊬",nvDash:"⊭",nVdash:"⊮",nVDash:"⊯",nvge:"≥⃒",nvgt:">⃒",nvHarr:"⤄",nvinfin:"⧞",nvlArr:"⤂",nvle:"≤⃒",nvlt:"<⃒",nvltrie:"⊴⃒",nvrArr:"⤃",nvrtrie:"⊵⃒",nvsim:"∼⃒",nwarhk:"⤣",nwarr:"↖",nwArr:"⇖",nwarrow:"↖",nwnear:"⤧",oacute:"ó",Oacute:"Ó",oast:"⊛",ocir:"⊚",ocirc:"ô",Ocirc:"Ô",ocy:"о",Ocy:"О",odash:"⊝",odblac:"ő",Odblac:"Ő",odiv:"⨸",odot:"⊙",odsold:"⦼",oelig:"œ",OElig:"Œ",ofcir:"⦿",ofr:"𝔬",Ofr:"𝔒",ogon:"˛",ograve:"ò",Ograve:"Ò",ogt:"⧁",ohbar:"⦵",ohm:"Ω",oint:"∮",olarr:"↺",olcir:"⦾",olcross:"⦻",oline:"‾",olt:"⧀",omacr:"ō",Omacr:"Ō",omega:"ω",Omega:"Ω",omicron:"ο",Omicron:"Ο",omid:"⦶",ominus:"⊖",oopf:"𝕠",Oopf:"𝕆",opar:"⦷",OpenCurlyDoubleQuote:"“",OpenCurlyQuote:"‘",operp:"⦹",oplus:"⊕",or:"∨",Or:"⩔",orarr:"↻",ord:"⩝",order:"ℴ",orderof:"ℴ",ordf:"ª",ordm:"º",origof:"⊶",oror:"⩖",orslope:"⩗",orv:"⩛",oS:"Ⓢ",oscr:"ℴ",Oscr:"𝒪",oslash:"ø",Oslash:"Ø",osol:"⊘",otilde:"õ",Otilde:"Õ",otimes:"⊗",Otimes:"⨷",otimesas:"⨶",ouml:"ö",Ouml:"Ö",ovbar:"⌽",OverBar:"‾",OverBrace:"⏞",OverBracket:"⎴",OverParenthesis:"⏜",par:"∥",para:"¶",parallel:"∥",parsim:"⫳",parsl:"⫽",part:"∂",PartialD:"∂",pcy:"п",Pcy:"П",percnt:"%",period:".",permil:"‰",perp:"⊥",pertenk:"‱",pfr:"𝔭",Pfr:"𝔓",phi:"φ",Phi:"Φ",phiv:"ϕ",phmmat:"ℳ",phone:"☎",pi:"π",Pi:"Π",pitchfork:"⋔",piv:"ϖ",planck:"ℏ",planckh:"ℎ",plankv:"ℏ",plus:"+",plusacir:"⨣",plusb:"⊞",pluscir:"⨢",plusdo:"∔",plusdu:"⨥",pluse:"⩲",PlusMinus:"±",plusmn:"±",plussim:"⨦",plustwo:"⨧",pm:"±",Poincareplane:"ℌ",pointint:"⨕",popf:"𝕡",Popf:"ℙ",pound:"£",pr:"≺",Pr:"⪻",prap:"⪷",prcue:"≼",pre:"⪯",prE:"⪳",prec:"≺",precapprox:"⪷",preccurlyeq:"≼",Precedes:"≺",PrecedesEqual:"⪯",PrecedesSlantEqual:"≼",PrecedesTilde:"≾",preceq:"⪯",precnapprox:"⪹",precneqq:"⪵",precnsim:"⋨",precsim:"≾",prime:"′",Prime:"″",primes:"ℙ",prnap:"⪹",prnE:"⪵",prnsim:"⋨",prod:"∏",Product:"∏",profalar:"⌮",profline:"⌒",profsurf:"⌓",prop:"∝",Proportion:"∷",Proportional:"∝",propto:"∝",prsim:"≾",prurel:"⊰",pscr:"𝓅",Pscr:"𝒫",psi:"ψ",Psi:"Ψ",puncsp:" ",qfr:"𝔮",Qfr:"𝔔",qint:"⨌",qopf:"𝕢",Qopf:"ℚ",qprime:"⁗",qscr:"𝓆",Qscr:"𝒬",quaternions:"ℍ",quatint:"⨖",quest:"?",questeq:"≟",quot:'"',QUOT:'"',rAarr:"⇛",race:"∽̱",racute:"ŕ",Racute:"Ŕ",radic:"√",raemptyv:"⦳",rang:"⟩",Rang:"⟫",rangd:"⦒",range:"⦥",rangle:"⟩",raquo:"»",rarr:"→",rArr:"⇒",Rarr:"↠",rarrap:"⥵",rarrb:"⇥",rarrbfs:"⤠",rarrc:"⤳",rarrfs:"⤞",rarrhk:"↪",rarrlp:"↬",rarrpl:"⥅",rarrsim:"⥴",rarrtl:"↣",Rarrtl:"⤖",rarrw:"↝",ratail:"⤚",rAtail:"⤜",ratio:"∶",rationals:"ℚ",rbarr:"⤍",rBarr:"⤏",RBarr:"⤐",rbbrk:"❳",rbrace:"}",rbrack:"]",rbrke:"⦌",rbrksld:"⦎",rbrkslu:"⦐",rcaron:"ř",Rcaron:"Ř",rcedil:"ŗ",Rcedil:"Ŗ",rceil:"⌉",rcub:"}",rcy:"р",Rcy:"Р",rdca:"⤷",rdldhar:"⥩",rdquo:"”",rdquor:"”",rdsh:"↳",Re:"ℜ",real:"ℜ",realine:"ℛ",realpart:"ℜ",reals:"ℝ",rect:"▭",reg:"®",REG:"®",ReverseElement:"∋",ReverseEquilibrium:"⇋",ReverseUpEquilibrium:"⥯",rfisht:"⥽",rfloor:"⌋",rfr:"𝔯",Rfr:"ℜ",rHar:"⥤",rhard:"⇁",rharu:"⇀",rharul:"⥬",rho:"ρ",Rho:"Ρ",rhov:"ϱ",RightAngleBracket:"⟩",rightarrow:"→",Rightarrow:"⇒",RightArrow:"→",RightArrowBar:"⇥",RightArrowLeftArrow:"⇄",rightarrowtail:"↣",RightCeiling:"⌉",RightDoubleBracket:"⟧",RightDownTeeVector:"⥝",RightDownVector:"⇂",RightDownVectorBar:"⥕",RightFloor:"⌋",rightharpoondown:"⇁",rightharpoonup:"⇀",rightleftarrows:"⇄",rightleftharpoons:"⇌",rightrightarrows:"⇉",rightsquigarrow:"↝",RightTee:"⊢",RightTeeArrow:"↦",RightTeeVector:"⥛",rightthreetimes:"⋌",RightTriangle:"⊳",RightTriangleBar:"⧐",RightTriangleEqual:"⊵",RightUpDownVector:"⥏",RightUpTeeVector:"⥜",RightUpVector:"↾",RightUpVectorBar:"⥔",RightVector:"⇀",RightVectorBar:"⥓",ring:"˚",risingdotseq:"≓",rlarr:"⇄",rlhar:"⇌",rlm:"‏",rmoust:"⎱",rmoustache:"⎱",rnmid:"⫮",roang:"⟭",roarr:"⇾",robrk:"⟧",ropar:"⦆",ropf:"𝕣",Ropf:"ℝ",roplus:"⨮",rotimes:"⨵",RoundImplies:"⥰",rpar:")",rpargt:"⦔",rppolint:"⨒",rrarr:"⇉",Rrightarrow:"⇛",rsaquo:"›",rscr:"𝓇",Rscr:"ℛ",rsh:"↱",Rsh:"↱",rsqb:"]",rsquo:"’",rsquor:"’",rthree:"⋌",rtimes:"⋊",rtri:"▹",rtrie:"⊵",rtrif:"▸",rtriltri:"⧎",RuleDelayed:"⧴",ruluhar:"⥨",rx:"℞",sacute:"ś",Sacute:"Ś",sbquo:"‚",sc:"≻",Sc:"⪼",scap:"⪸",scaron:"š",Scaron:"Š",sccue:"≽",sce:"⪰",scE:"⪴",scedil:"ş",Scedil:"Ş",scirc:"ŝ",Scirc:"Ŝ",scnap:"⪺",scnE:"⪶",scnsim:"⋩",scpolint:"⨓",scsim:"≿",scy:"с",Scy:"С",sdot:"⋅",sdotb:"⊡",sdote:"⩦",searhk:"⤥",searr:"↘",seArr:"⇘",searrow:"↘",sect:"§",semi:";",seswar:"⤩",setminus:"∖",setmn:"∖",sext:"✶",sfr:"𝔰",Sfr:"𝔖",sfrown:"⌢",sharp:"♯",shchcy:"щ",SHCHcy:"Щ",shcy:"ш",SHcy:"Ш",ShortDownArrow:"↓",ShortLeftArrow:"←",shortmid:"∣",shortparallel:"∥",ShortRightArrow:"→",ShortUpArrow:"↑",shy:"­",sigma:"σ",Sigma:"Σ",sigmaf:"ς",sigmav:"ς",sim:"∼",simdot:"⩪",sime:"≃",simeq:"≃",simg:"⪞",simgE:"⪠",siml:"⪝",simlE:"⪟",simne:"≆",simplus:"⨤",simrarr:"⥲",slarr:"←",SmallCircle:"∘",smallsetminus:"∖",smashp:"⨳",smeparsl:"⧤",smid:"∣",smile:"⌣",smt:"⪪",smte:"⪬",smtes:"⪬︀",softcy:"ь",SOFTcy:"Ь",sol:"/",solb:"⧄",solbar:"⌿",sopf:"𝕤",Sopf:"𝕊",spades:"♠",spadesuit:"♠",spar:"∥",sqcap:"⊓",sqcaps:"⊓︀",sqcup:"⊔",sqcups:"⊔︀",Sqrt:"√",sqsub:"⊏",sqsube:"⊑",sqsubset:"⊏",sqsubseteq:"⊑",sqsup:"⊐",sqsupe:"⊒",sqsupset:"⊐",sqsupseteq:"⊒",squ:"□",square:"□",Square:"□",SquareIntersection:"⊓",SquareSubset:"⊏",SquareSubsetEqual:"⊑",SquareSuperset:"⊐",SquareSupersetEqual:"⊒",SquareUnion:"⊔",squarf:"▪",squf:"▪",srarr:"→",sscr:"𝓈",Sscr:"𝒮",ssetmn:"∖",ssmile:"⌣",sstarf:"⋆",star:"☆",Star:"⋆",starf:"★",straightepsilon:"ϵ",straightphi:"ϕ",strns:"¯",sub:"⊂",Sub:"⋐",subdot:"⪽",sube:"⊆",subE:"⫅",subedot:"⫃",submult:"⫁",subne:"⊊",subnE:"⫋",subplus:"⪿",subrarr:"⥹",subset:"⊂",Subset:"⋐",subseteq:"⊆",subseteqq:"⫅",SubsetEqual:"⊆",subsetneq:"⊊",subsetneqq:"⫋",subsim:"⫇",subsub:"⫕",subsup:"⫓",succ:"≻",succapprox:"⪸",succcurlyeq:"≽",Succeeds:"≻",SucceedsEqual:"⪰",SucceedsSlantEqual:"≽",SucceedsTilde:"≿",succeq:"⪰",succnapprox:"⪺",succneqq:"⪶",succnsim:"⋩",succsim:"≿",SuchThat:"∋",sum:"∑",Sum:"∑",sung:"♪",sup:"⊃",Sup:"⋑",sup1:"¹",sup2:"²",sup3:"³",supdot:"⪾",supdsub:"⫘",supe:"⊇",supE:"⫆",supedot:"⫄",Superset:"⊃",SupersetEqual:"⊇",suphsol:"⟉",suphsub:"⫗",suplarr:"⥻",supmult:"⫂",supne:"⊋",supnE:"⫌",supplus:"⫀",supset:"⊃",Supset:"⋑",supseteq:"⊇",supseteqq:"⫆",supsetneq:"⊋",supsetneqq:"⫌",supsim:"⫈",supsub:"⫔",supsup:"⫖",swarhk:"⤦",swarr:"↙",swArr:"⇙",swarrow:"↙",swnwar:"⤪",szlig:"ß",Tab:"	",target:"⌖",tau:"τ",Tau:"Τ",tbrk:"⎴",tcaron:"ť",Tcaron:"Ť",tcedil:"ţ",Tcedil:"Ţ",tcy:"т",Tcy:"Т",tdot:"⃛",telrec:"⌕",tfr:"𝔱",Tfr:"𝔗",there4:"∴",therefore:"∴",Therefore:"∴",theta:"θ",Theta:"Θ",thetasym:"ϑ",thetav:"ϑ",thickapprox:"≈",thicksim:"∼",ThickSpace:"  ",thinsp:" ",ThinSpace:" ",thkap:"≈",thksim:"∼",thorn:"þ",THORN:"Þ",tilde:"˜",Tilde:"∼",TildeEqual:"≃",TildeFullEqual:"≅",TildeTilde:"≈",times:"×",timesb:"⊠",timesbar:"⨱",timesd:"⨰",tint:"∭",toea:"⤨",top:"⊤",topbot:"⌶",topcir:"⫱",topf:"𝕥",Topf:"𝕋",topfork:"⫚",tosa:"⤩",tprime:"‴",trade:"™",TRADE:"™",triangle:"▵",triangledown:"▿",triangleleft:"◃",trianglelefteq:"⊴",triangleq:"≜",triangleright:"▹",trianglerighteq:"⊵",tridot:"◬",trie:"≜",triminus:"⨺",TripleDot:"⃛",triplus:"⨹",trisb:"⧍",tritime:"⨻",trpezium:"⏢",tscr:"𝓉",Tscr:"𝒯",tscy:"ц",TScy:"Ц",tshcy:"ћ",TSHcy:"Ћ",tstrok:"ŧ",Tstrok:"Ŧ",twixt:"≬",twoheadleftarrow:"↞",twoheadrightarrow:"↠",uacute:"ú",Uacute:"Ú",uarr:"↑",uArr:"⇑",Uarr:"↟",Uarrocir:"⥉",ubrcy:"ў",Ubrcy:"Ў",ubreve:"ŭ",Ubreve:"Ŭ",ucirc:"û",Ucirc:"Û",ucy:"у",Ucy:"У",udarr:"⇅",udblac:"ű",Udblac:"Ű",udhar:"⥮",ufisht:"⥾",ufr:"𝔲",Ufr:"𝔘",ugrave:"ù",Ugrave:"Ù",uHar:"⥣",uharl:"↿",uharr:"↾",uhblk:"▀",ulcorn:"⌜",ulcorner:"⌜",ulcrop:"⌏",ultri:"◸",umacr:"ū",Umacr:"Ū",uml:"¨",UnderBar:"_",UnderBrace:"⏟",UnderBracket:"⎵",UnderParenthesis:"⏝",Union:"⋃",UnionPlus:"⊎",uogon:"ų",Uogon:"Ų",uopf:"𝕦",Uopf:"𝕌",uparrow:"↑",Uparrow:"⇑",UpArrow:"↑",UpArrowBar:"⤒",UpArrowDownArrow:"⇅",updownarrow:"↕",Updownarrow:"⇕",UpDownArrow:"↕",UpEquilibrium:"⥮",upharpoonleft:"↿",upharpoonright:"↾",uplus:"⊎",UpperLeftArrow:"↖",UpperRightArrow:"↗",upsi:"υ",Upsi:"ϒ",upsih:"ϒ",upsilon:"υ",Upsilon:"Υ",UpTee:"⊥",UpTeeArrow:"↥",upuparrows:"⇈",urcorn:"⌝",urcorner:"⌝",urcrop:"⌎",uring:"ů",Uring:"Ů",urtri:"◹",uscr:"𝓊",Uscr:"𝒰",utdot:"⋰",utilde:"ũ",Utilde:"Ũ",utri:"▵",utrif:"▴",uuarr:"⇈",uuml:"ü",Uuml:"Ü",uwangle:"⦧",vangrt:"⦜",varepsilon:"ϵ",varkappa:"ϰ",varnothing:"∅",varphi:"ϕ",varpi:"ϖ",varpropto:"∝",varr:"↕",vArr:"⇕",varrho:"ϱ",varsigma:"ς",varsubsetneq:"⊊︀",varsubsetneqq:"⫋︀",varsupsetneq:"⊋︀",varsupsetneqq:"⫌︀",vartheta:"ϑ",vartriangleleft:"⊲",vartriangleright:"⊳",vBar:"⫨",Vbar:"⫫",vBarv:"⫩",vcy:"в",Vcy:"В",vdash:"⊢",vDash:"⊨",Vdash:"⊩",VDash:"⊫",Vdashl:"⫦",vee:"∨",Vee:"⋁",veebar:"⊻",veeeq:"≚",vellip:"⋮",verbar:"|",Verbar:"‖",vert:"|",Vert:"‖",VerticalBar:"∣",VerticalLine:"|",VerticalSeparator:"❘",VerticalTilde:"≀",VeryThinSpace:" ",vfr:"𝔳",Vfr:"𝔙",vltri:"⊲",vnsub:"⊂⃒",vnsup:"⊃⃒",vopf:"𝕧",Vopf:"𝕍",vprop:"∝",vrtri:"⊳",vscr:"𝓋",Vscr:"𝒱",vsubne:"⊊︀",vsubnE:"⫋︀",vsupne:"⊋︀",vsupnE:"⫌︀",Vvdash:"⊪",vzigzag:"⦚",wcirc:"ŵ",Wcirc:"Ŵ",wedbar:"⩟",wedge:"∧",Wedge:"⋀",wedgeq:"≙",weierp:"℘",wfr:"𝔴",Wfr:"𝔚",wopf:"𝕨",Wopf:"𝕎",wp:"℘",wr:"≀",wreath:"≀",wscr:"𝓌",Wscr:"𝒲",xcap:"⋂",xcirc:"◯",xcup:"⋃",xdtri:"▽",xfr:"𝔵",Xfr:"𝔛",xharr:"⟷",xhArr:"⟺",xi:"ξ",Xi:"Ξ",xlarr:"⟵",xlArr:"⟸",xmap:"⟼",xnis:"⋻",xodot:"⨀",xopf:"𝕩",Xopf:"𝕏",xoplus:"⨁",xotime:"⨂",xrarr:"⟶",xrArr:"⟹",xscr:"𝓍",Xscr:"𝒳",xsqcup:"⨆",xuplus:"⨄",xutri:"△",xvee:"⋁",xwedge:"⋀",yacute:"ý",Yacute:"Ý",yacy:"я",YAcy:"Я",ycirc:"ŷ",Ycirc:"Ŷ",ycy:"ы",Ycy:"Ы",yen:"¥",yfr:"𝔶",Yfr:"𝔜",yicy:"ї",YIcy:"Ї",yopf:"𝕪",Yopf:"𝕐",yscr:"𝓎",Yscr:"𝒴",yucy:"ю",YUcy:"Ю",yuml:"ÿ",Yuml:"Ÿ",zacute:"ź",Zacute:"Ź",zcaron:"ž",Zcaron:"Ž",zcy:"з",Zcy:"З",zdot:"ż",Zdot:"Ż",zeetrf:"ℨ",ZeroWidthSpace:"​",zeta:"ζ",Zeta:"Ζ",zfr:"𝔷",Zfr:"ℨ",zhcy:"ж",ZHcy:"Ж",zigrarr:"⇝",zopf:"𝕫",Zopf:"ℤ",zscr:"𝓏",Zscr:"𝒵",zwj:"‍",zwnj:"‌"},H={aacute:"á",Aacute:"Á",acirc:"â",Acirc:"Â",acute:"´",aelig:"æ",AElig:"Æ",agrave:"à",Agrave:"À",amp:"&",AMP:"&",aring:"å",Aring:"Å",atilde:"ã",Atilde:"Ã",auml:"ä",Auml:"Ä",brvbar:"¦",ccedil:"ç",Ccedil:"Ç",cedil:"¸",cent:"¢",copy:"©",COPY:"©",curren:"¤",deg:"°",divide:"÷",eacute:"é",Eacute:"É",ecirc:"ê",Ecirc:"Ê",egrave:"è",Egrave:"È",eth:"ð",ETH:"Ð",euml:"ë",Euml:"Ë",frac12:"½",frac14:"¼",frac34:"¾",gt:">",GT:">",iacute:"í",Iacute:"Í",icirc:"î",Icirc:"Î",iexcl:"¡",igrave:"ì",Igrave:"Ì",iquest:"¿",iuml:"ï",Iuml:"Ï",laquo:"«",lt:"<",LT:"<",macr:"¯",micro:"µ",middot:"·",nbsp:" ",not:"¬",ntilde:"ñ",Ntilde:"Ñ",oacute:"ó",Oacute:"Ó",ocirc:"ô",Ocirc:"Ô",ograve:"ò",Ograve:"Ò",ordf:"ª",ordm:"º",oslash:"ø",Oslash:"Ø",otilde:"õ",Otilde:"Õ",ouml:"ö",Ouml:"Ö",para:"¶",plusmn:"±",pound:"£",quot:'"',QUOT:'"',raquo:"»",reg:"®",REG:"®",sect:"§",shy:"­",sup1:"¹",sup2:"²",sup3:"³",szlig:"ß",thorn:"þ",THORN:"Þ",times:"×",uacute:"ú",Uacute:"Ú",ucirc:"û",Ucirc:"Û",ugrave:"ù",Ugrave:"Ù",uml:"¨",uuml:"ü",Uuml:"Ü",yacute:"ý",Yacute:"Ý",yen:"¥",yuml:"ÿ"},X={0:"�",128:"€",130:"‚",131:"ƒ",132:"„",133:"…",134:"†",135:"‡",136:"ˆ",137:"‰",138:"Š",139:"‹",140:"Œ",142:"Ž",145:"‘",146:"’",147:"“",148:"”",149:"•",150:"–",151:"—",152:"˜",153:"™",154:"š",155:"›",156:"œ",158:"ž",159:"Ÿ"},ae=[1,2,3,4,5,6,7,8,11,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,64976,64977,64978,64979,64980,64981,64982,64983,64984,64985,64986,64987,64988,64989,64990,64991,64992,64993,64994,64995,64996,64997,64998,64999,65e3,65001,65002,65003,65004,65005,65006,65007,65534,65535,131070,131071,196606,196607,262142,262143,327678,327679,393214,393215,458750,458751,524286,524287,589822,589823,655358,655359,720894,720895,786430,786431,851966,851967,917502,917503,983038,983039,1048574,1048575,1114110,1114111],oe=String.fromCharCode,ue={},fe=ue.hasOwnProperty,be=function(dt,Mt){return fe.call(dt,Mt)},Ae=function(dt,Mt){for(var zt=-1,xt=dt.length;++zt<xt;)if(dt[zt]==Mt)return!0;return!1},W=function(dt,Mt){if(!dt)return Mt;var zt={},xt;for(xt in Mt)zt[xt]=be(dt,xt)?dt[xt]:Mt[xt];return zt},J=function(dt,Mt){var zt="";return dt>=55296&&dt<=57343||dt>1114111?(Mt&&Te("character reference outside the permissible Unicode range"),"�"):be(X,dt)?(Mt&&Te("disallowed character reference"),X[dt]):(Mt&&Ae(ae,dt)&&Te("disallowed character reference"),dt>65535&&(dt-=65536,zt+=oe(dt>>>10&1023|55296),dt=56320|dt&1023),zt+=oe(dt),zt)},Ue=function(dt){return"&#x"+dt.toString(16).toUpperCase()+";"},gt=function(dt){return"&#"+dt+";"},Te=function(dt){throw Error("Parse error: "+dt)},Et=function(dt,Mt){Mt=W(Mt,Et.options);var zt=Mt.strict;zt&&z.test(dt)&&Te("forbidden code point");var xt=Mt.encodeEverything,Gt=Mt.useNamedReferences,yi=Mt.allowUnsafeSymbols,ti=Mt.decimal?gt:Ue,Mi=function(Li){return ti(Li.charCodeAt(0))};return xt?(dt=dt.replace(l,function(Li){return Gt&&be(y,Li)?"&"+y[Li]+";":Mi(Li)}),Gt&&(dt=dt.replace(/&gt;\u20D2/g,"&nvgt;").replace(/&lt;\u20D2/g,"&nvlt;").replace(/&#x66;&#x6A;/g,"&fjlig;")),Gt&&(dt=dt.replace(c,function(Li){return"&"+y[Li]+";"}))):Gt?(yi||(dt=dt.replace(m,function(Li){return"&"+y[Li]+";"})),dt=dt.replace(/&gt;\u20D2/g,"&nvgt;").replace(/&lt;\u20D2/g,"&nvlt;"),dt=dt.replace(c,function(Li){return"&"+y[Li]+";"})):yi||(dt=dt.replace(m,Mi)),dt.replace(a,function(Li){var qi=Li.charCodeAt(0),Pi=Li.charCodeAt(1),Oi=(qi-55296)*1024+Pi-56320+65536;return ti(Oi)}).replace(d,Mi)};Et.options={allowUnsafeSymbols:!1,encodeEverything:!1,strict:!1,useNamedReferences:!1,decimal:!1};var Bt=function(dt,Mt){Mt=W(Mt,Bt.options);var zt=Mt.strict;return zt&&D.test(dt)&&Te("malformed character reference"),dt.replace(w,function(xt,Gt,yi,ti,Mi,Li,qi,Pi){var Oi,$t,Rs,is,hs,qs;return Gt?(Rs=Gt,$t=yi,zt&&!$t&&Te("character reference was not terminated by a semicolon"),Oi=parseInt(Rs,10),J(Oi,zt)):ti?(is=ti,$t=Mi,zt&&!$t&&Te("character reference was not terminated by a semicolon"),Oi=parseInt(is,16),J(Oi,zt)):Li?(hs=Li,be(N,hs)?N[hs]:(zt&&Te("named character reference was not terminated by a semicolon"),xt)):(hs=qi,qs=Pi,qs&&Mt.isAttributeValue?(zt&&qs=="="&&Te("`&` did not start a character reference"),xt):(zt&&Te("named character reference was not terminated by a semicolon"),H[hs]+(qs||"")))})};Bt.options={isAttributeValue:!1,strict:!1};var Ke=function(dt){return dt.replace(m,function(Mt){return O[Mt]})},At={version:"1.1.1",encode:Et,decode:Bt,escape:Ke,unescape:Bt};if(n&&!n.nodeType)if(r)r.exports=At;else for(var nt in At)be(At,nt)&&(n[nt]=At[nt]);else t.he=At})(window)})(he1_1_1,he1_1_1.exports);he1_1_1.exports;(function(){window.byteLength=l,window.toByteArray=d,window.fromByteArray=m;for(var o=[],e=[],t=typeof Uint8Array<"u"?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=0,s=n.length;r<s;++r)o[r]=n[r],e[n.charCodeAt(r)]=r;e[45]=62,e[95]=63;function a(O){var D=O.length;if(D%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return O[D-2]==="="?2:O[D-1]==="="?1:0}function l(O){return O.length*3/4-a(O)}function d(O){var D,z,w,N,H,X,ae=O.length;H=a(O),X=new t(ae*3/4-H),w=H>0?ae-4:ae;var oe=0;for(D=0,z=0;D<w;D+=4,z+=3)N=e[O.charCodeAt(D)]<<18|e[O.charCodeAt(D+1)]<<12|e[O.charCodeAt(D+2)]<<6|e[O.charCodeAt(D+3)],X[oe++]=N>>16&255,X[oe++]=N>>8&255,X[oe++]=N&255;return H===2?(N=e[O.charCodeAt(D)]<<2|e[O.charCodeAt(D+1)]>>4,X[oe++]=N&255):H===1&&(N=e[O.charCodeAt(D)]<<10|e[O.charCodeAt(D+1)]<<4|e[O.charCodeAt(D+2)]>>2,X[oe++]=N>>8&255,X[oe++]=N&255),X}function c(O){return o[O>>18&63]+o[O>>12&63]+o[O>>6&63]+o[O&63]}function y(O,D,z){for(var w,N=[],H=D;H<z;H+=3)w=(O[H]<<16)+(O[H+1]<<8)+O[H+2],N.push(c(w));return N.join("")}function m(O){for(var D,z=O.length,w=z%3,N="",H=[],X=16383,ae=0,oe=z-w;ae<oe;ae+=X)H.push(y(O,ae,ae+X>oe?oe:ae+X));return w===1?(D=O[z-1],N+=o[D>>2],N+=o[D<<4&63],N+="=="):w===2&&(D=(O[z-2]<<8)+O[z-1],N+=o[D>>10],N+=o[D>>4&63],N+=o[D<<2&63],N+="="),H.push(N),H.join("")}})();var QueryStringMachine$1={exports:{}};(function(o){(function(e,t){typeof window.define=="function"&&window.define.amd?window.define([],t):o.exports?window.QueryStringMachine=t():e.QueryStringMachine=t()})(window,()=>{const e=",",t=()=>{try{return localStorage.getItem("phetTeamMember")==="true"}catch{return!1}},n=r=>r.length===0||r.indexOf("?")===0;return function(){const r=(oe,ue,fe,be,Ae)=>{if(!oe)if(be.public)if(s.addWarning(ue,fe,Ae),be.hasOwnProperty("defaultValue"))fe=be.defaultValue;else{const W=ae[be.type];X(W.hasOwnProperty("defaultValue"),"Type must have a default value if the provided schema does not have one."),fe=W.defaultValue}else X(oe,Ae);return fe},s={warnings:[],get:function(oe,ue){return this.getForString(oe,ue,window.location.search)},getAll:function(oe){return this.getAllForString(oe,window.location.search)},getForString:function(oe,ue,fe){if(!n(fe))throw new Error(`Query strings should be either the empty string or start with a "?": ${fe}`);const be=ue.private&&!t()?[]:a(oe,fe);l(oe,ue);let Ae=y(oe,ue,be);ue.hasOwnProperty("validValues")?Ae=r(H(Ae,ue.validValues),oe,Ae,ue,`Invalid value supplied for key "${oe}": ${Ae} is not a member of valid values: ${ue.validValues.join(", ")}`):ue.hasOwnProperty("isValidValue")&&(Ae=r(ue.isValidValue(Ae),oe,Ae,ue,`Invalid value supplied for key "${oe}": ${Ae}`));let W=ae[ue.type].isValidValue(Ae);if(ue.type==="array"&&Array.isArray(Ae)){let J=!0;for(let Ue=0;Ue<Ae.length;Ue++){const gt=Ae[Ue];if(!ae[ue.elementSchema.type].isValidValue(gt)){J=!1;break}if(ue.elementSchema.hasOwnProperty("isValidValue")&&!ue.elementSchema.isValidValue(gt)){J=!1;break}if(ue.elementSchema.hasOwnProperty("validValues")&&!H(gt,ue.elementSchema.validValues)){J=!1;break}}W=W&&J}return Ae=r(W,oe,Ae,ue,`Invalid value for type, key: ${oe}`),Ae},getAllForString:function(oe,ue){const fe={};for(const be in oe)oe.hasOwnProperty(be)&&(fe[be]=this.getForString(be,oe[be],ue));return fe},containsKey:function(oe){return this.containsKeyForString(oe,window.location.search)},containsKeyForString:function(oe,ue){if(!n(ue))throw new Error(`Query strings should be either the empty string or start with a "?": ${ue}`);return a(oe,ue).length>0},deepEquals:function(oe,ue){if(typeof oe!=typeof ue)return!1;if(typeof oe=="string"||typeof oe=="number"||typeof oe=="boolean")return oe===ue;if(oe===null&&ue===null||oe===void 0&&ue===void 0)return!0;if(oe===null&&ue===void 0||oe===void 0&&ue===null)return!1;const fe=Object.keys(oe),be=Object.keys(ue);if(fe.length!==be.length)return!1;if(fe.length===0)return oe===ue;for(let Ae=0;Ae<fe.length;Ae++){if(fe[Ae]!==be[Ae])return!1;const W=oe[fe[Ae]],J=ue[fe[Ae]];if(!s.deepEquals(W,J))return!1}return!0},removeKeyValuePair:function(oe,ue){if(assert&&assert(typeof oe=="string",`url should be string, but it was: ${typeof oe}`),assert&&assert(typeof ue=="string",`url should be string, but it was: ${typeof ue}`),assert&&assert(n(oe),"queryString should be length 0 or begin with ?"),assert&&assert(ue.length>0,"url should be a string with length > 0"),oe.indexOf("?")===0){const fe=[],Ae=oe.substring(1).split("&");for(let W=0;W<Ae.length;W++){const J=Ae[W],Ue=J.split("=");decodeURIComponent(Ue[0])!==ue&&fe.push(J)}return fe.length>0?`?${fe.join("&")}`:""}else return oe},removeKeyValuePairs:function(oe,ue){for(let fe=0;fe<ue.length;fe++)oe=this.removeKeyValuePair(oe,ue[fe]);return oe},appendQueryString:function(oe,ue){if((ue.indexOf("?")===0||ue.indexOf("&")===0)&&(ue=ue.substring(1)),ue.length===0)return oe;const fe=oe.indexOf("?")>=0?"&":"?";return oe+fe+ue},appendQueryStringArray:function(oe,ue){for(let fe=0;fe<ue.length;fe++)oe=this.appendQueryString(oe,ue[fe]);return oe},getQueryString:function(oe){const ue=oe.indexOf("?");return ue>=0?oe.substring(ue):"?"},addWarning:function(oe,ue,fe){console.warn(fe),this.warnings.push({key:oe,value:ue,message:fe})},hasWarning:function(oe){let ue=!1;for(let fe=0;fe<this.warnings.length&&!ue;fe++)ue=this.warnings[fe].key===oe;return ue},getQueryParametersFromString:function(oe){return oe.indexOf("?")===0?oe.substring(1).split("&"):[]},getSingleQueryParameterString:function(oe,ue){const fe=this.getQueryString(ue),be=this.getQueryParametersFromString(fe);for(let Ae=0;Ae<be.length;Ae++){const W=be[Ae],J=W.split("=");if(decodeURIComponent(J[0])===oe)return W}return null}},a=function(oe,ue){const fe=[],be=ue.slice(1).split("&");for(let Ae=0;Ae<be.length;Ae++){const W=be[Ae].split("="),J=W[0],Ue=W.slice(1).join("=");J===oe&&(Ue?fe.push(decodeURIComponent(Ue)):fe.push(null))}return fe},l=function(oe,ue){X(ue.hasOwnProperty("type"),`type field is required for key: ${oe}`),X(ae.hasOwnProperty(ue.type),`invalid type: ${ue.type} for key: ${oe}`),ue.hasOwnProperty("parse")&&X(typeof ue.parse=="function",`parse must be a function for key: ${oe}`),X(!(ue.hasOwnProperty("validValues")&&ue.hasOwnProperty("isValidValue")),ue),ue.hasOwnProperty("validValues")&&X(Array.isArray(ue.validValues),`isValidValue must be an array for key: ${oe}`),ue.hasOwnProperty("isValidValue")&&X(typeof ue.isValidValue=="function",`isValidValue must be a function for key: ${oe}`),ue.hasOwnProperty("defaultValue")&&X(ae[ue.type].isValidValue(ue.defaultValue),`defaultValue incorrect type: ${oe}`),ue.hasOwnProperty("validValues")&&ue.validValues.forEach(fe=>X(ae[ue.type].isValidValue(fe),`validValue incorrect type for key: ${oe}`)),ue.hasOwnProperty("defaultValue")&&ue.hasOwnProperty("validValues")&&X(H(ue.defaultValue,ue.validValues),ue),ue.hasOwnProperty("public")&&ue.public&&ue.type!=="flag"&&X(ue.hasOwnProperty("defaultValue"),`defaultValue is required when public: true for key: ${oe}`),c(oe,ue,ae[ue.type].required,ae[ue.type].optional),ae[ue.type].validateSchema&&ae[ue.type].validateSchema(oe,ue)},d=function(oe,ue){ue.hasOwnProperty("separator")&&X(typeof ue.separator=="string"&&ue.separator.length===1,`invalid separator: ${ue.separator}, for key: ${oe}`),X(!ue.elementSchema.hasOwnProperty("public"),"Array elements should not declare public; it comes from the array schema itself."),l(`${oe}.element`,ue.elementSchema)},c=function(oe,ue,fe,be){const Ae=Object.getOwnPropertyNames(ue);fe.forEach(J=>{X(Ae.indexOf(J)!==-1,`missing required property: ${J} for key: ${oe}`)});const W=fe.concat(be);Ae.forEach(J=>{X(J==="type"||W.indexOf(J)!==-1,`unsupported property: ${J} for key: ${oe}`)})},y=function(oe,ue,fe){let be;return X(fe.length<=1,`query parameter cannot occur multiple times: ${oe}`),ue.type==="flag"?be=ae[ue.type].parse(oe,ue,fe[0]):(X(fe[0]!==void 0||ue.hasOwnProperty("defaultValue"),`missing required query parameter: ${oe}`),fe[0]===void 0?be=ue.defaultValue:be=ae[ue.type].parse(oe,ue,fe[0])),be},m=function(oe,ue,fe){return fe===null?!0:fe===void 0?!1:fe},O=function(oe,ue,fe){return fe==="true"?!0:fe==="false"?!1:fe},D=function(oe,ue,fe){const be=Number(fe);return fe===null||isNaN(be)?fe:be},z=function(oe,ue,fe){return fe},w=function(oe,ue,fe){let be;return fe===null?be=[]:be=fe.split(ue.separator||e).map(Ae=>y(oe,ue.elementSchema,[Ae])),be},N=function(oe,ue,fe){return ue.parse(fe)},H=function(oe,ue){let fe=!1;for(let be=0;be<ue.length&&!fe;be++)fe=s.deepEquals(ue[be],oe);return fe},X=function(oe,ue){if(!oe)throw console&&console.log&&console.log(ue),new Error(`Query String Machine Assertion failed: ${ue}`)},ae={flag:{required:[],optional:["private","public"],validateSchema:null,parse:m,isValidValue:oe=>oe===!0||oe===!1,defaultValue:!0},boolean:{required:[],optional:["defaultValue","private","public"],validateSchema:null,parse:O,isValidValue:oe=>oe===!0||oe===!1},number:{required:[],optional:["defaultValue","validValues","isValidValue","private","public"],validateSchema:null,parse:D,isValidValue:oe=>typeof oe=="number"&&!isNaN(oe)},string:{required:[],optional:["defaultValue","validValues","isValidValue","private","public"],validateSchema:null,parse:z,isValidValue:oe=>oe===null||typeof oe=="string"},array:{required:["elementSchema"],optional:["defaultValue","validValues","isValidValue","separator","validValues","private","public"],validateSchema:d,parse:w,isValidValue:oe=>Array.isArray(oe)||oe===null},custom:{required:["parse"],optional:["defaultValue","validValues","isValidValue","private","public"],validateSchema:null,parse:N,isValidValue:oe=>!0}};return s}()})})(QueryStringMachine$1);function commonjsRequire(o){throw new Error('Could not dynamically require "'+o+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}(function(o,e){(function(t){window.himalaya=t()})(function(){return function(){function t(n,r,s){function a(c,y){if(!r[c]){if(!n[c]){var m=typeof commonjsRequire=="function"&&commonjsRequire;if(!y&&m)return m(c,!0);if(l)return l(c,!0);var O=new Error("Cannot find module '"+c+"'");throw O.code="MODULE_NOT_FOUND",O}var D=r[c]={exports:{}};n[c][0].call(D.exports,function(z){var w=n[c][1][z];return a(w||z)},D,D.exports,t,n,r,s)}return r[c].exports}for(var l=typeof commonjsRequire=="function"&&commonjsRequire,d=0;d<s.length;d++)a(s[d]);return a}return t}()({1:[function(t,n,r){var s=function(){var m="/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/compat.js",O="cde94accf38c67a096269c512dfb0f1bca69a38a",D=(function(){}).constructor,z=new D("return this")(),w="__coverage__",N={path:"/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/compat.js",statementMap:{0:{start:{line:10,column:2},end:{line:10,column:72}},1:{start:{line:14,column:16},end:{line:14,column:62}},2:{start:{line:15,column:20},end:{line:15,column:56}},3:{start:{line:16,column:2},end:{line:16,column:48}},4:{start:{line:20,column:2},end:{line:20,column:56}},5:{start:{line:24,column:2},end:{line:24,column:42}},6:{start:{line:28,column:14},end:{line:28,column:26}},7:{start:{line:29,column:2},end:{line:29,column:29}},8:{start:{line:29,column:17},end:{line:29,column:29}},9:{start:{line:31,column:22},end:{line:31,column:34}},10:{start:{line:32,column:23},end:{line:32,column:47}},11:{start:{line:33,column:20},end:{line:33,column:70}},12:{start:{line:34,column:2},end:{line:38,column:3}},13:{start:{line:35,column:20},end:{line:35,column:40}},14:{start:{line:36,column:4},end:{line:36,column:46}},15:{start:{line:36,column:35},end:{line:36,column:46}},16:{start:{line:37,column:4},end:{line:37,column:55}},17:{start:{line:37,column:44},end:{line:37,column:55}},18:{start:{line:40,column:2},end:{line:40,column:14}}},fnMap:{0:{name:"startsWith",decl:{start:{line:9,column:16},end:{line:9,column:26}},loc:{start:{line:9,column:57},end:{line:11,column:1}},line:9},1:{name:"endsWith",decl:{start:{line:13,column:16},end:{line:13,column:24}},loc:{start:{line:13,column:55},end:{line:17,column:1}},line:13},2:{name:"stringIncludes",decl:{start:{line:19,column:16},end:{line:19,column:30}},loc:{start:{line:19,column:61},end:{line:21,column:1}},line:19},3:{name:"isRealNaN",decl:{start:{line:23,column:16},end:{line:23,column:25}},loc:{start:{line:23,column:30},end:{line:25,column:1}},line:23},4:{name:"arrayIncludes",decl:{start:{line:27,column:16},end:{line:27,column:29}},loc:{start:{line:27,column:63},end:{line:41,column:1}},line:27}},branchMap:{0:{loc:{start:{line:10,column:20},end:{line:10,column:33}},type:"binary-expr",locations:[{start:{line:10,column:20},end:{line:10,column:28}},{start:{line:10,column:32},end:{line:10,column:33}}],line:10},1:{loc:{start:{line:14,column:17},end:{line:14,column:39}},type:"binary-expr",locations:[{start:{line:14,column:17},end:{line:14,column:25}},{start:{line:14,column:29},end:{line:14,column:39}}],line:14},2:{loc:{start:{line:16,column:9},end:{line:16,column:48}},type:"binary-expr",locations:[{start:{line:16,column:9},end:{line:16,column:25}},{start:{line:16,column:29},end:{line:16,column:48}}],line:16},3:{loc:{start:{line:20,column:35},end:{line:20,column:48}},type:"binary-expr",locations:[{start:{line:20,column:35},end:{line:20,column:43}},{start:{line:20,column:47},end:{line:20,column:48}}],line:20},4:{loc:{start:{line:24,column:9},end:{line:24,column:42}},type:"binary-expr",locations:[{start:{line:24,column:9},end:{line:24,column:30}},{start:{line:24,column:34},end:{line:24,column:42}}],line:24},5:{loc:{start:{line:29,column:2},end:{line:29,column:29}},type:"if",locations:[{start:{line:29,column:2},end:{line:29,column:29}},{start:{line:29,column:2},end:{line:29,column:29}}],line:29},6:{loc:{start:{line:33,column:20},end:{line:33,column:70}},type:"cond-expr",locations:[{start:{line:33,column:39},end:{line:33,column:50}},{start:{line:33,column:53},end:{line:33,column:70}}],line:33},7:{loc:{start:{line:36,column:4},end:{line:36,column:46}},type:"if",locations:[{start:{line:36,column:4},end:{line:36,column:46}},{start:{line:36,column:4},end:{line:36,column:46}}],line:36},8:{loc:{start:{line:37,column:4},end:{line:37,column:55}},type:"if",locations:[{start:{line:37,column:4},end:{line:37,column:55}},{start:{line:37,column:4},end:{line:37,column:55}}],line:37},9:{loc:{start:{line:37,column:8},end:{line:37,column:42}},type:"binary-expr",locations:[{start:{line:37,column:8},end:{line:37,column:20}},{start:{line:37,column:24},end:{line:37,column:42}}],line:37}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0},f:{0:0,1:0,2:0,3:0,4:0},b:{0:[0,0],1:[0,0],2:[0,0],3:[0,0],4:[0,0],5:[0,0],6:[0,0],7:[0,0],8:[0,0],9:[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},H=z[w]||(z[w]={});return H[m]&&H[m].hash===O?H[m]:(N.hash=O,H[m]=N)}();Object.defineProperty(r,"__esModule",{value:!0}),r.startsWith=a,r.endsWith=l,r.stringIncludes=d,r.isRealNaN=c,r.arrayIncludes=y;function a(m,O,D){return s.f[0]++,s.s[0]++,m.substr((s.b[0][0]++,D||(s.b[0][1]++,0)),O.length)===O}function l(m,O,D){s.f[1]++;var z=(s.s[1]++,s.b[1][0]++,(D||(s.b[1][1]++,m.length))-O.length),w=(s.s[2]++,m.lastIndexOf(O,z));return s.s[3]++,s.b[2][0]++,w!==-1&&(s.b[2][1]++,w===z)}function d(m,O,D){return s.f[2]++,s.s[4]++,m.indexOf(O,(s.b[3][0]++,D||(s.b[3][1]++,0)))!==-1}function c(m){return s.f[3]++,s.s[5]++,s.b[4][0]++,typeof m=="number"&&(s.b[4][1]++,isNaN(m))}function y(m,O,D){s.f[4]++;var z=(s.s[6]++,m.length);if(s.s[7]++,z===0)return s.b[5][0]++,s.s[8]++,!1;s.b[5][1]++;var w=(s.s[9]++,D|0),N=(s.s[10]++,c(O)),H=(s.s[11]++,w>=0?(s.b[6][0]++,w):(s.b[6][1]++,z+w));for(s.s[12]++;H<z;){var X=(s.s[13]++,m[H++]);if(s.s[14]++,X===O)return s.b[7][0]++,s.s[15]++,!0;if(s.b[7][1]++,s.s[16]++,s.b[9][0]++,N&&(s.b[9][1]++,c(X)))return s.b[8][0]++,s.s[17]++,!0;s.b[8][1]++}return s.s[18]++,!1}},{}],2:[function(t,n,r){var s=function(){var y="/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/format.js",m="ef8c4d14fa58c2bce23a58bf5d7c370846a07329",O=(function(){}).constructor,D=new O("return this")(),z="__coverage__",w={path:"/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/format.js",statementMap:{0:{start:{line:2,column:14},end:{line:2,column:30}},1:{start:{line:3,column:2},end:{line:3,column:30}},2:{start:{line:3,column:18},end:{line:3,column:30}},3:{start:{line:4,column:2},end:{line:4,column:57}},4:{start:{line:8,column:14},end:{line:8,column:27}},5:{start:{line:9,column:14},end:{line:9,column:28}},6:{start:{line:10,column:23},end:{line:10,column:49}},7:{start:{line:11,column:2},end:{line:13,column:3}},8:{start:{line:12,column:4},end:{line:12,column:28}},9:{start:{line:14,column:2},end:{line:14,column:12}},10:{start:{line:18,column:2},end:{line:32,column:4}},11:{start:{line:19,column:17},end:{line:19,column:26}},12:{start:{line:20,column:23},end:{line:27,column:39}},13:{start:{line:28,column:4},end:{line:30,column:5}},14:{start:{line:29,column:6},end:{line:29,column:41}},15:{start:{line:31,column:4},end:{line:31,column:21}},16:{start:{line:36,column:2},end:{line:43,column:4}},17:{start:{line:37,column:18},end:{line:37,column:50}},18:{start:{line:38,column:16},end:{line:38,column:24}},19:{start:{line:39,column:18},end:{line:41,column:12}},20:{start:{line:42,column:4},end:{line:42,column:23}}},fnMap:{0:{name:"splitHead",decl:{start:{line:1,column:16},end:{line:1,column:25}},loc:{start:{line:1,column:37},end:{line:5,column:1}},line:1},1:{name:"unquote",decl:{start:{line:7,column:16},end:{line:7,column:23}},loc:{start:{line:7,column:30},end:{line:15,column:1}},line:7},2:{name:"format",decl:{start:{line:17,column:16},end:{line:17,column:22}},loc:{start:{line:17,column:40},end:{line:33,column:1}},line:17},3:{name:"(anonymous_3)",decl:{start:{line:18,column:19},end:{line:18,column:20}},loc:{start:{line:18,column:27},end:{line:32,column:3}},line:18},4:{name:"formatAttributes",decl:{start:{line:35,column:16},end:{line:35,column:32}},loc:{start:{line:35,column:46},end:{line:44,column:1}},line:35},5:{name:"(anonymous_5)",decl:{start:{line:36,column:24},end:{line:36,column:25}},loc:{start:{line:36,column:37},end:{line:43,column:3}},line:36}},branchMap:{0:{loc:{start:{line:3,column:2},end:{line:3,column:30}},type:"if",locations:[{start:{line:3,column:2},end:{line:3,column:30}},{start:{line:3,column:2},end:{line:3,column:30}}],line:3},1:{loc:{start:{line:10,column:23},end:{line:10,column:49}},type:"binary-expr",locations:[{start:{line:10,column:23},end:{line:10,column:34}},{start:{line:10,column:38},end:{line:10,column:49}}],line:10},2:{loc:{start:{line:11,column:2},end:{line:13,column:3}},type:"if",locations:[{start:{line:11,column:2},end:{line:13,column:3}},{start:{line:11,column:2},end:{line:13,column:3}}],line:11},3:{loc:{start:{line:11,column:6},end:{line:11,column:45}},type:"binary-expr",locations:[{start:{line:11,column:6},end:{line:11,column:18}},{start:{line:11,column:22},end:{line:11,column:45}}],line:11},4:{loc:{start:{line:20,column:23},end:{line:27,column:39}},type:"cond-expr",locations:[{start:{line:21,column:8},end:{line:26,column:7}},{start:{line:27,column:8},end:{line:27,column:39}}],line:20},5:{loc:{start:{line:28,column:4},end:{line:30,column:5}},type:"if",locations:[{start:{line:28,column:4},end:{line:30,column:5}},{start:{line:28,column:4},end:{line:30,column:5}}],line:28},6:{loc:{start:{line:39,column:18},end:{line:41,column:12}},type:"cond-expr",locations:[{start:{line:40,column:8},end:{line:40,column:25}},{start:{line:41,column:8},end:{line:41,column:12}}],line:39}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0},f:{0:0,1:0,2:0,3:0,4:0,5:0},b:{0:[0,0],1:[0,0],2:[0,0],3:[0,0],4:[0,0],5:[0,0],6:[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},N=D[z]||(D[z]={});return N[y]&&N[y].hash===m?N[y]:(w.hash=m,N[y]=w)}();Object.defineProperty(r,"__esModule",{value:!0}),r.splitHead=a,r.unquote=l,r.format=d,r.formatAttributes=c;function a(y,m){s.f[0]++;var O=(s.s[0]++,y.indexOf(m));return s.s[1]++,O===-1?(s.b[0][0]++,s.s[2]++,[y]):(s.b[0][1]++,s.s[3]++,[y.slice(0,O),y.slice(O+m.length)])}function l(y){s.f[1]++;var m=(s.s[4]++,y.charAt(0)),O=(s.s[5]++,y.length-1),D=(s.s[6]++,s.b[1][0]++,m==='"'||(s.b[1][1]++,m==="'"));return s.s[7]++,s.b[3][0]++,D&&(s.b[3][1]++,m===y.charAt(O))?(s.b[2][0]++,s.s[8]++,y.slice(1,O)):(s.b[2][1]++,s.s[9]++,y)}function d(y,m){return s.f[2]++,s.s[10]++,y.map(function(O){s.f[3]++;var D=(s.s[11]++,O.type),z=(s.s[12]++,D==="element"?(s.b[4][0]++,{type:D,tagName:O.tagName.toLowerCase(),attributes:c(O.attributes),children:d(O.children,m)}):(s.b[4][1]++,{type:D,content:O.content}));return s.s[13]++,m.includePositions?(s.b[5][0]++,s.s[14]++,z.position=O.position):s.b[5][1]++,s.s[15]++,z})}function c(y){return s.f[4]++,s.s[16]++,y.map(function(m){s.f[5]++;var O=(s.s[17]++,a(m.trim(),"=")),D=(s.s[18]++,O[0]),z=(s.s[19]++,typeof O[1]=="string"?(s.b[6][0]++,l(O[1])):(s.b[6][1]++,null));return s.s[20]++,{key:D,value:z}})}},{}],3:[function(t,n,r){var s=function(){var H="/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/index.js",X="a91ca68b6320b199fa63e4cbd37dce6857e0c43d",ae=(function(){}).constructor,oe=new ae("return this")(),ue="__coverage__",fe={path:"/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/index.js",statementMap:{0:{start:{line:12,column:29},end:{line:18,column:1}},1:{start:{line:21,column:17},end:{line:21,column:36}},2:{start:{line:22,column:16},end:{line:22,column:39}},3:{start:{line:23,column:2},end:{line:23,column:31}},4:{start:{line:27,column:2},end:{line:27,column:29}}},fnMap:{0:{name:"parse",decl:{start:{line:20,column:16},end:{line:20,column:21}},loc:{start:{line:20,column:53},end:{line:24,column:1}},line:20},1:{name:"stringify",decl:{start:{line:26,column:16},end:{line:26,column:25}},loc:{start:{line:26,column:57},end:{line:28,column:1}},line:26}},branchMap:{0:{loc:{start:{line:20,column:28},end:{line:20,column:51}},type:"default-arg",locations:[{start:{line:20,column:38},end:{line:20,column:51}}],line:20},1:{loc:{start:{line:26,column:32},end:{line:26,column:55}},type:"default-arg",locations:[{start:{line:26,column:42},end:{line:26,column:55}}],line:26}},s:{0:0,1:0,2:0,3:0,4:0},f:{0:0,1:0},b:{0:[0],1:[0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},be=oe[ue]||(oe[ue]={});return be[H]&&be[H].hash===X?be[H]:(fe.hash=X,be[H]=fe)}();Object.defineProperty(r,"__esModule",{value:!0}),r.parseDefaults=void 0,r.parse=w,r.stringify=N;var a=t("./lexer"),l=D(a),d=t("./parser"),c=D(d),y=t("./format"),m=t("./stringify"),O=t("./tags");function D(H){return H&&H.__esModule?H:{default:H}}var z=r.parseDefaults=(s.s[0]++,{voidTags:O.voidTags,closingTags:O.closingTags,childlessTags:O.childlessTags,closingTagAncestorBreakers:O.closingTagAncestorBreakers,includePositions:!1});function w(H){var X=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(s.b[0][0]++,z);s.f[0]++;var ae=(s.s[1]++,(0,l.default)(H,X)),oe=(s.s[2]++,(0,c.default)(ae,X));return s.s[3]++,(0,y.format)(oe,X)}function N(H){var X=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(s.b[1][0]++,z);return s.f[1]++,s.s[4]++,(0,m.toHTML)(H,X)}},{"./format":2,"./lexer":4,"./parser":5,"./stringify":6,"./tags":7}],4:[function(t,n,r){var s=function(){var Ae="/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/lexer.js",W="99f1269b85a36e02e6fcfa2eb5c9423a8a428848",J=(function(){}).constructor,Ue=new J("return this")(),gt="__coverage__",Te={path:"/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/lexer.js",statementMap:{0:{start:{line:9,column:16},end:{line:9,column:30}},1:{start:{line:10,column:14},end:{line:10,column:42}},2:{start:{line:11,column:2},end:{line:19,column:3}},3:{start:{line:12,column:17},end:{line:12,column:30}},4:{start:{line:13,column:4},end:{line:18,column:5}},5:{start:{line:14,column:6},end:{line:14,column:21}},6:{start:{line:15,column:6},end:{line:15,column:25}},7:{start:{line:17,column:6},end:{line:17,column:23}},8:{start:{line:23,column:14},end:{line:23,column:34}},9:{start:{line:24,column:2},end:{line:24,column:41}},10:{start:{line:28,column:2},end:{line:32,column:3}},11:{start:{line:36,column:2},end:{line:40,column:3}},12:{start:{line:44,column:16},end:{line:49,column:3}},13:{start:{line:50,column:2},end:{line:50,column:12}},14:{start:{line:51,column:2},end:{line:51,column:21}},15:{start:{line:55,column:42},end:{line:55,column:47}},16:{start:{line:56,column:14},end:{line:56,column:24}},17:{start:{line:57,column:2},end:{line:72,column:3}},18:{start:{line:58,column:18},end:{line:58,column:38}},19:{start:{line:59,column:4},end:{line:59,column:18}},20:{start:{line:60,column:4},end:{line:71,column:5}},21:{start:{line:61,column:24},end:{line:61,column:57}},22:{start:{line:62,column:6},end:{line:70,column:7}},23:{start:{line:63,column:8},end:{line:63,column:25}},24:{start:{line:65,column:24},end:{line:65,column:37}},25:{start:{line:66,column:24},end:{line:66,column:45}},26:{start:{line:67,column:8},end:{line:69,column:9}},27:{start:{line:68,column:10},end:{line:68,column:36}},28:{start:{line:75,column:21},end:{line:75,column:34}},29:{start:{line:77,column:2},end:{line:87,column:3}},30:{start:{line:78,column:20},end:{line:78,column:43}},31:{start:{line:79,column:4},end:{line:81,column:5}},32:{start:{line:80,column:6},end:{line:80,column:20}},33:{start:{line:82,column:17},end:{line:82,column:40}},34:{start:{line:83,column:4},end:{line:85,column:5}},35:{start:{line:84,column:6},end:{line:84,column:20}},36:{start:{line:86,column:4},end:{line:86,column:23}},37:{start:{line:91,column:15},end:{line:91,column:21}},38:{start:{line:92,column:26},end:{line:92,column:31}},39:{start:{line:93,column:16},end:{line:93,column:48}},40:{start:{line:94,column:2},end:{line:94,column:40}},41:{start:{line:94,column:34},end:{line:94,column:40}},42:{start:{line:95,column:2},end:{line:97,column:3}},43:{start:{line:96,column:4},end:{line:96,column:24}},44:{start:{line:99,column:16},end:{line:99,column:38}},45:{start:{line:100,column:18},end:{line:100,column:52}},46:{start:{line:101,column:2},end:{line:101,column:38}},47:{start:{line:102,column:14},end:{line:102,column:36}},48:{start:{line:103,column:2},end:{line:103,column:60}},49:{start:{line:107,column:26},end:{line:107,column:31}},50:{start:{line:108,column:16},end:{line:108,column:38}},51:{start:{line:109,column:2},end:{line:109,column:32}},52:{start:{line:110,column:19},end:{line:110,column:53}},53:{start:{line:111,column:19},end:{line:111,column:33}},54:{start:{line:112,column:2},end:{line:114,column:3}},55:{start:{line:113,column:4},end:{line:113,column:40}},56:{start:{line:116,column:18},end:{line:116,column:55}},57:{start:{line:117,column:2},end:{line:117,column:41}},58:{start:{line:118,column:2},end:{line:125,column:4}},59:{start:{line:129,column:26},end:{line:129,column:31}},60:{start:{line:131,column:23},end:{line:131,column:53}},61:{start:{line:132,column:18},end:{line:132,column:36}},62:{start:{line:133,column:18},end:{line:133,column:40}},63:{start:{line:134,column:4},end:{line:134,column:46}},64:{start:{line:135,column:4},end:{line:135,column:68}},65:{start:{line:137,column:18},end:{line:137,column:35}},66:{start:{line:138,column:2},end:{line:138,column:25}},67:{start:{line:140,column:22},end:{line:140,column:48}},68:{start:{line:141,column:18},end:{line:141,column:35}},69:{start:{line:142,column:4},end:{line:142,column:46}},70:{start:{line:143,column:16},end:{line:143,column:38}},71:{start:{line:144,column:4},end:{line:144,column:64}},72:{start:{line:146,column:2},end:{line:146,column:16}},73:{start:{line:150,column:19},end:{line:150,column:23}},74:{start:{line:152,column:2},end:{line:152,column:30}},75:{start:{line:156,column:26},end:{line:156,column:31}},76:{start:{line:157,column:14},end:{line:157,column:24}},77:{start:{line:158,column:14},end:{line:158,column:28}},78:{start:{line:159,column:2},end:{line:164,column:3}},79:{start:{line:160,column:17},end:{line:160,column:34}},80:{start:{line:161,column:22},end:{line:161,column:79}},81:{start:{line:162,column:4},end:{line:162,column:24}},82:{start:{line:162,column:19},end:{line:162,column:24}},83:{start:{line:163,column:4},end:{line:163,column:11}},84:{start:{line:166,column:12},end:{line:166,column:21}},85:{start:{line:167,column:2},end:{line:172,column:3}},86:{start:{line:168,column:17},end:{line:168,column:32}},87:{start:{line:169,column:22},end:{line:169,column:79}},88:{start:{line:170,column:4},end:{line:170,column:25}},89:{start:{line:170,column:20},end:{line:170,column:25}},90:{start:{line:171,column:4},end:{line:171,column:9}},91:{start:{line:174,column:2},end:{line:174,column:34}},92:{start:{line:175,column:18},end:{line:175,column:39}},93:{start:{line:176,column:2},end:{line:179,column:4}},94:{start:{line:180,column:2},end:{line:180,column:16}},95:{start:{line:184,column:34},end:{line:184,column:39}},96:{start:{line:185,column:15},end:{line:185,column:29}},97:{start:{line:186,column:14},end:{line:186,column:18}},98:{start:{line:187,column:18},end:{line:187,column:24}},99:{start:{line:188,column:16},end:{line:188,column:18}},100:{start:{line:189,column:14},end:{line:189,column:24}},101:{start:{line:190,column:2},end:{line:227,column:3}},102:{start:{line:191,column:17},end:{line:191,column:35}},103:{start:{line:192,column:4},end:{line:199,column:5}},104:{start:{line:193,column:25},end:{line:193,column:39}},105:{start:{line:194,column:6},end:{line:196,column:7}},106:{start:{line:195,column:8},end:{line:195,column:20}},107:{start:{line:197,column:6},end:{line:197,column:14}},108:{start:{line:198,column:6},end:{line:198,column:14}},109:{start:{line:201,column:21},end:{line:201,column:49}},110:{start:{line:202,column:4},end:{line:207,column:5}},111:{start:{line:203,column:6},end:{line:205,column:7}},112:{start:{line:204,column:8},end:{line:204,column:48}},113:{start:{line:206,column:6},end:{line:206,column:11}},114:{start:{line:209,column:22},end:{line:209,column:44}},115:{start:{line:210,column:4},end:{line:217,column:5}},116:{start:{line:211,column:6},end:{line:213,column:7}},117:{start:{line:212,column:8},end:{line:212,column:48}},118:{start:{line:214,column:6},end:{line:214,column:28}},119:{start:{line:215,column:6},end:{line:215,column:14}},120:{start:{line:216,column:6},end:{line:216,column:14}},121:{start:{line:219,column:25},end:{line:219,column:54}},122:{start:{line:220,column:4},end:{line:224,column:5}},123:{start:{line:221,column:6},end:{line:221,column:18}},124:{start:{line:222,column:6},end:{line:222,column:14}},125:{start:{line:223,column:6},end:{line:223,column:14}},126:{start:{line:226,column:4},end:{line:226,column:12}},127:{start:{line:228,column:2},end:{line:228,column:37}},128:{start:{line:230,column:15},end:{line:230,column:27}},129:{start:{line:231,column:15},end:{line:231,column:26}},130:{start:{line:232,column:2},end:{line:269,column:3}},131:{start:{line:233,column:17},end:{line:233,column:25}},132:{start:{line:234,column:22},end:{line:234,column:46}},133:{start:{line:235,column:4},end:{line:253,column:5}},134:{start:{line:236,column:25},end:{line:236,column:37}},135:{start:{line:237,column:6},end:{line:252,column:7}},136:{start:{line:238,column:8},end:{line:243,column:9}},137:{start:{line:239,column:26},end:{line:239,column:43}},138:{start:{line:240,column:10},end:{line:240,column:47}},139:{start:{line:241,column:10},end:{line:241,column:16}},140:{start:{line:242,column:10},end:{line:242,column:18}},141:{start:{line:244,column:26},end:{line:244,column:38}},142:{start:{line:245,column:8},end:{line:245,column:14}},143:{start:{line:246,column:8},end:{line:251,column:9}},144:{start:{line:247,column:26},end:{line:247,column:48}},145:{start:{line:248,column:10},end:{line:248,column:47}},146:{start:{line:249,column:10},end:{line:249,column:16}},147:{start:{line:250,column:10},end:{line:250,column:18}},148:{start:{line:254,column:4},end:{line:266,column:5}},149:{start:{line:255,column:25},end:{line:255,column:37}},150:{start:{line:256,column:6},end:{line:261,column:7}},151:{start:{line:257,column:24},end:{line:257,column:41}},152:{start:{line:258,column:8},end:{line:258,column:45}},153:{start:{line:259,column:8},end:{line:259,column:14}},154:{start:{line:260,column:8},end:{line:260,column:16}},155:{start:{line:263,column:22},end:{line:263,column:39}},156:{start:{line:264,column:6},end:{line:264,column:43}},157:{start:{line:265,column:6},end:{line:265,column:14}},158:{start:{line:268,column:4},end:{line:268,column:38}},159:{start:{line:272,column:13},end:{line:272,column:20}},160:{start:{line:275,column:34},end:{line:275,column:39}},161:{start:{line:276,column:22},end:{line:276,column:43}},162:{start:{line:277,column:14},end:{line:277,column:24}},163:{start:{line:278,column:14},end:{line:278,column:28}},164:{start:{line:279,column:2},end:{line:311,column:3}},165:{start:{line:280,column:20},end:{line:280,column:44}},166:{start:{line:281,column:4},end:{line:284,column:5}},167:{start:{line:282,column:6},end:{line:282,column:20}},168:{start:{line:283,column:6},end:{line:283,column:11}},169:{start:{line:286,column:29},end:{line:286,column:51}},170:{start:{line:287,column:4},end:{line:287,column:48}},171:{start:{line:288,column:21},end:{line:288,column:66}},172:{start:{line:289,column:17},end:{line:289,column:33}},173:{start:{line:290,column:4},end:{line:293,column:5}},174:{start:{line:291,column:6},end:{line:291,column:37}},175:{start:{line:292,column:6},end:{line:292,column:14}},176:{start:{line:295,column:4},end:{line:306,column:5}},177:{start:{line:296,column:24},end:{line:296,column:46}},178:{start:{line:297,column:6},end:{line:297,column:42}},179:{start:{line:298,column:6},end:{line:305,column:8}},180:{start:{line:308,column:4},end:{line:308,column:39}},181:{start:{line:309,column:4},end:{line:309,column:56}},182:{start:{line:310,column:4},end:{line:310,column:9}}},fnMap:{0:{name:"feedPosition",decl:{start:{line:8,column:16},end:{line:8,column:28}},loc:{start:{line:8,column:50},end:{line:20,column:1}},line:8},1:{name:"jumpPosition",decl:{start:{line:22,column:16},end:{line:22,column:28}},loc:{start:{line:22,column:50},end:{line:25,column:1}},line:22},2:{name:"makeInitialPosition",decl:{start:{line:27,column:16},end:{line:27,column:35}},loc:{start:{line:27,column:39},end:{line:33,column:1}},line:27},3:{name:"copyPosition",decl:{start:{line:35,column:16},end:{line:35,column:28}},loc:{start:{line:35,column:40},end:{line:41,column:1}},line:35},4:{name:"lexer",decl:{start:{line:43,column:24},end:{line:43,column:29}},loc:{start:{line:43,column:45},end:{line:52,column:1}},line:43},5:{name:"lex",decl:{start:{line:54,column:16},end:{line:54,column:19}},loc:{start:{line:54,column:28},end:{line:73,column:1}},line:54},6:{name:"findTextEnd",decl:{start:{line:76,column:16},end:{line:76,column:27}},loc:{start:{line:76,column:41},end:{line:88,column:1}},line:76},7:{name:"lexText",decl:{start:{line:90,column:16},end:{line:90,column:23}},loc:{start:{line:90,column:32},end:{line:104,column:1}},line:90},8:{name:"lexComment",decl:{start:{line:106,column:16},end:{line:106,column:26}},loc:{start:{line:106,column:35},end:{line:126,column:1}},line:106},9:{name:"lexTag",decl:{start:{line:128,column:16},end:{line:128,column:22}},loc:{start:{line:128,column:31},end:{line:147,column:1}},line:128},10:{name:"isWhitespaceChar",decl:{start:{line:151,column:16},end:{line:151,column:32}},loc:{start:{line:151,column:40},end:{line:153,column:1}},line:151},11:{name:"lexTagName",decl:{start:{line:155,column:16},end:{line:155,column:26}},loc:{start:{line:155,column:35},end:{line:181,column:1}},line:155},12:{name:"lexTagAttributes",decl:{start:{line:183,column:16},end:{line:183,column:32}},loc:{start:{line:183,column:41},end:{line:270,column:1}},line:183},13:{name:"lexSkipTag",decl:{start:{line:274,column:16},end:{line:274,column:26}},loc:{start:{line:274,column:44},end:{line:312,column:1}},line:274}},branchMap:{0:{loc:{start:{line:13,column:4},end:{line:18,column:5}},type:"if",locations:[{start:{line:13,column:4},end:{line:18,column:5}},{start:{line:13,column:4},end:{line:18,column:5}}],line:13},1:{loc:{start:{line:60,column:4},end:{line:71,column:5}},type:"if",locations:[{start:{line:60,column:4},end:{line:71,column:5}},{start:{line:60,column:4},end:{line:71,column:5}}],line:60},2:{loc:{start:{line:62,column:6},end:{line:70,column:7}},type:"if",locations:[{start:{line:62,column:6},end:{line:70,column:7}},{start:{line:62,column:6},end:{line:70,column:7}}],line:62},3:{loc:{start:{line:67,column:8},end:{line:69,column:9}},type:"if",locations:[{start:{line:67,column:8},end:{line:69,column:9}},{start:{line:67,column:8},end:{line:69,column:9}}],line:67},4:{loc:{start:{line:79,column:4},end:{line:81,column:5}},type:"if",locations:[{start:{line:79,column:4},end:{line:81,column:5}},{start:{line:79,column:4},end:{line:81,column:5}}],line:79},5:{loc:{start:{line:83,column:4},end:{line:85,column:5}},type:"if",locations:[{start:{line:83,column:4},end:{line:85,column:5}},{start:{line:83,column:4},end:{line:85,column:5}}],line:83},6:{loc:{start:{line:83,column:8},end:{line:83,column:63}},type:"binary-expr",locations:[{start:{line:83,column:8},end:{line:83,column:20}},{start:{line:83,column:24},end:{line:83,column:36}},{start:{line:83,column:40},end:{line:83,column:63}}],line:83},7:{loc:{start:{line:94,column:2},end:{line:94,column:40}},type:"if",locations:[{start:{line:94,column:2},end:{line:94,column:40}},{start:{line:94,column:2},end:{line:94,column:40}}],line:94},8:{loc:{start:{line:95,column:2},end:{line:97,column:3}},type:"if",locations:[{start:{line:95,column:2},end:{line:97,column:3}},{start:{line:95,column:2},end:{line:97,column:3}}],line:95},9:{loc:{start:{line:112,column:2},end:{line:114,column:3}},type:"if",locations:[{start:{line:112,column:2},end:{line:114,column:3}},{start:{line:112,column:2},end:{line:114,column:3}}],line:112},10:{loc:{start:{line:134,column:32},end:{line:134,column:45}},type:"cond-expr",locations:[{start:{line:134,column:40},end:{line:134,column:41}},{start:{line:134,column:44},end:{line:134,column:45}}],line:134},11:{loc:{start:{line:142,column:32},end:{line:142,column:45}},type:"cond-expr",locations:[{start:{line:142,column:40},end:{line:142,column:41}},{start:{line:142,column:44},end:{line:142,column:45}}],line:142},12:{loc:{start:{line:161,column:24},end:{line:161,column:78}},type:"binary-expr",locations:[{start:{line:161,column:24},end:{line:161,column:46}},{start:{line:161,column:50},end:{line:161,column:62}},{start:{line:161,column:66},end:{line:161,column:78}}],line:161},13:{loc:{start:{line:162,column:4},end:{line:162,column:24}},type:"if",locations:[{start:{line:162,column:4},end:{line:162,column:24}},{start:{line:162,column:4},end:{line:162,column:24}}],line:162},14:{loc:{start:{line:169,column:24},end:{line:169,column:78}},type:"binary-expr",locations:[{start:{line:169,column:24},end:{line:169,column:46}},{start:{line:169,column:50},end:{line:169,column:62}},{start:{line:169,column:66},end:{line:169,column:78}}],line:169},15:{loc:{start:{line:170,column:4},end:{line:170,column:25}},type:"if",locations:[{start:{line:170,column:4},end:{line:170,column:25}},{start:{line:170,column:4},end:{line:170,column:25}}],line:170},16:{loc:{start:{line:192,column:4},end:{line:199,column:5}},type:"if",locations:[{start:{line:192,column:4},end:{line:199,column:5}},{start:{line:192,column:4},end:{line:199,column:5}}],line:192},17:{loc:{start:{line:194,column:6},end:{line:196,column:7}},type:"if",locations:[{start:{line:194,column:6},end:{line:196,column:7}},{start:{line:194,column:6},end:{line:196,column:7}}],line:194},18:{loc:{start:{line:201,column:21},end:{line:201,column:49}},type:"binary-expr",locations:[{start:{line:201,column:21},end:{line:201,column:33}},{start:{line:201,column:37},end:{line:201,column:49}}],line:201},19:{loc:{start:{line:202,column:4},end:{line:207,column:5}},type:"if",locations:[{start:{line:202,column:4},end:{line:207,column:5}},{start:{line:202,column:4},end:{line:207,column:5}}],line:202},20:{loc:{start:{line:203,column:6},end:{line:205,column:7}},type:"if",locations:[{start:{line:203,column:6},end:{line:205,column:7}},{start:{line:203,column:6},end:{line:205,column:7}}],line:203},21:{loc:{start:{line:210,column:4},end:{line:217,column:5}},type:"if",locations:[{start:{line:210,column:4},end:{line:217,column:5}},{start:{line:210,column:4},end:{line:217,column:5}}],line:210},22:{loc:{start:{line:211,column:6},end:{line:213,column:7}},type:"if",locations:[{start:{line:211,column:6},end:{line:213,column:7}},{start:{line:211,column:6},end:{line:213,column:7}}],line:211},23:{loc:{start:{line:219,column:25},end:{line:219,column:54}},type:"binary-expr",locations:[{start:{line:219,column:25},end:{line:219,column:38}},{start:{line:219,column:42},end:{line:219,column:54}}],line:219},24:{loc:{start:{line:220,column:4},end:{line:224,column:5}},type:"if",locations:[{start:{line:220,column:4},end:{line:224,column:5}},{start:{line:220,column:4},end:{line:224,column:5}}],line:220},25:{loc:{start:{line:235,column:4},end:{line:253,column:5}},type:"if",locations:[{start:{line:235,column:4},end:{line:253,column:5}},{start:{line:235,column:4},end:{line:253,column:5}}],line:235},26:{loc:{start:{line:237,column:6},end:{line:252,column:7}},type:"if",locations:[{start:{line:237,column:6},end:{line:252,column:7}},{start:{line:237,column:6},end:{line:252,column:7}}],line:237},27:{loc:{start:{line:237,column:10},end:{line:237,column:51}},type:"binary-expr",locations:[{start:{line:237,column:10},end:{line:237,column:20}},{start:{line:237,column:24},end:{line:237,column:51}}],line:237},28:{loc:{start:{line:238,column:8},end:{line:243,column:9}},type:"if",locations:[{start:{line:238,column:8},end:{line:243,column:9}},{start:{line:238,column:8},end:{line:243,column:9}}],line:238},29:{loc:{start:{line:246,column:8},end:{line:251,column:9}},type:"if",locations:[{start:{line:246,column:8},end:{line:251,column:9}},{start:{line:246,column:8},end:{line:251,column:9}}],line:246},30:{loc:{start:{line:254,column:4},end:{line:266,column:5}},type:"if",locations:[{start:{line:254,column:4},end:{line:266,column:5}},{start:{line:254,column:4},end:{line:266,column:5}}],line:254},31:{loc:{start:{line:256,column:6},end:{line:261,column:7}},type:"if",locations:[{start:{line:256,column:6},end:{line:261,column:7}},{start:{line:256,column:6},end:{line:261,column:7}}],line:256},32:{loc:{start:{line:256,column:10},end:{line:256,column:56}},type:"binary-expr",locations:[{start:{line:256,column:10},end:{line:256,column:20}},{start:{line:256,column:24},end:{line:256,column:56}}],line:256},33:{loc:{start:{line:281,column:4},end:{line:284,column:5}},type:"if",locations:[{start:{line:281,column:4},end:{line:284,column:5}},{start:{line:281,column:4},end:{line:284,column:5}}],line:281},34:{loc:{start:{line:290,column:4},end:{line:293,column:5}},type:"if",locations:[{start:{line:290,column:4},end:{line:293,column:5}},{start:{line:290,column:4},end:{line:293,column:5}}],line:290},35:{loc:{start:{line:295,column:4},end:{line:306,column:5}},type:"if",locations:[{start:{line:295,column:4},end:{line:306,column:5}},{start:{line:295,column:4},end:{line:306,column:5}}],line:295}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0,25:0,26:0,27:0,28:0,29:0,30:0,31:0,32:0,33:0,34:0,35:0,36:0,37:0,38:0,39:0,40:0,41:0,42:0,43:0,44:0,45:0,46:0,47:0,48:0,49:0,50:0,51:0,52:0,53:0,54:0,55:0,56:0,57:0,58:0,59:0,60:0,61:0,62:0,63:0,64:0,65:0,66:0,67:0,68:0,69:0,70:0,71:0,72:0,73:0,74:0,75:0,76:0,77:0,78:0,79:0,80:0,81:0,82:0,83:0,84:0,85:0,86:0,87:0,88:0,89:0,90:0,91:0,92:0,93:0,94:0,95:0,96:0,97:0,98:0,99:0,100:0,101:0,102:0,103:0,104:0,105:0,106:0,107:0,108:0,109:0,110:0,111:0,112:0,113:0,114:0,115:0,116:0,117:0,118:0,119:0,120:0,121:0,122:0,123:0,124:0,125:0,126:0,127:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:0,136:0,137:0,138:0,139:0,140:0,141:0,142:0,143:0,144:0,145:0,146:0,147:0,148:0,149:0,150:0,151:0,152:0,153:0,154:0,155:0,156:0,157:0,158:0,159:0,160:0,161:0,162:0,163:0,164:0,165:0,166:0,167:0,168:0,169:0,170:0,171:0,172:0,173:0,174:0,175:0,176:0,177:0,178:0,179:0,180:0,181:0,182:0},f:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0},b:{0:[0,0],1:[0,0],2:[0,0],3:[0,0],4:[0,0],5:[0,0],6:[0,0,0],7:[0,0],8:[0,0],9:[0,0],10:[0,0],11:[0,0],12:[0,0,0],13:[0,0],14:[0,0,0],15:[0,0],16:[0,0],17:[0,0],18:[0,0],19:[0,0],20:[0,0],21:[0,0],22:[0,0],23:[0,0],24:[0,0],25:[0,0],26:[0,0],27:[0,0],28:[0,0],29:[0,0],30:[0,0],31:[0,0],32:[0,0],33:[0,0],34:[0,0],35:[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},Et=Ue[gt]||(Ue[gt]={});return Et[Ae]&&Et[Ae].hash===W?Et[Ae]:(Te.hash=W,Et[Ae]=Te)}();Object.defineProperty(r,"__esModule",{value:!0}),r.feedPosition=l,r.jumpPosition=d,r.makeInitialPosition=c,r.copyPosition=y,r.default=m,r.lex=O,r.findTextEnd=z,r.lexText=w,r.lexComment=N,r.lexTag=H,r.isWhitespaceChar=ae,r.lexTagName=oe,r.lexTagAttributes=ue,r.lexSkipTag=be;var a=t("./compat");function l(Ae,W,J){s.f[0]++;var Ue=(s.s[0]++,Ae.index),gt=(s.s[1]++,Ae.index=Ue+J);s.s[2]++;for(var Te=Ue;Te<gt;Te++){var Et=(s.s[3]++,W.charAt(Te));s.s[4]++,Et===`
`?(s.b[0][0]++,s.s[5]++,Ae.line++,s.s[6]++,Ae.column=0):(s.b[0][1]++,s.s[7]++,Ae.column++)}}function d(Ae,W,J){s.f[1]++;var Ue=(s.s[8]++,J-Ae.index);return s.s[9]++,l(Ae,W,Ue)}function c(){return s.f[2]++,s.s[10]++,{index:0,column:0,line:0}}function y(Ae){return s.f[3]++,s.s[11]++,{index:Ae.index,line:Ae.line,column:Ae.column}}function m(Ae,W){s.f[4]++;var J=(s.s[12]++,{str:Ae,options:W,position:c(),tokens:[]});return s.s[13]++,O(J),s.s[14]++,J.tokens}function O(Ae){s.f[5]++;var W=(s.s[15]++,Ae),J=W.str,Ue=W.options.childlessTags,gt=(s.s[16]++,J.length);for(s.s[17]++;Ae.position.index<gt;){var Te=(s.s[18]++,Ae.position.index);if(s.s[19]++,w(Ae),s.s[20]++,Ae.position.index===Te){s.b[1][0]++;var Et=(s.s[21]++,(0,a.startsWith)(J,"!--",Te+1));if(s.s[22]++,Et)s.b[2][0]++,s.s[23]++,N(Ae);else{s.b[2][1]++;var Bt=(s.s[24]++,H(Ae)),Ke=(s.s[25]++,Bt.toLowerCase());s.s[26]++,(0,a.arrayIncludes)(Ue,Ke)?(s.b[3][0]++,s.s[27]++,be(Bt,Ae)):s.b[3][1]++}}else s.b[1][1]++}}var D=(s.s[28]++,/[A-Za-z0-9]/);function z(Ae,W){for(s.f[6]++,s.s[29]++;;){var J=(s.s[30]++,Ae.indexOf("<",W));if(s.s[31]++,J===-1)return s.b[4][0]++,s.s[32]++,J;s.b[4][1]++;var Ue=(s.s[33]++,Ae.charAt(J+1));if(s.s[34]++,s.b[6][0]++,Ue==="/"||(s.b[6][1]++,Ue==="!")||(s.b[6][2]++,D.test(Ue)))return s.b[5][0]++,s.s[35]++,J;s.b[5][1]++,s.s[36]++,W=J+1}}function w(Ae){s.f[7]++;var W=(s.s[37]++,"text"),J=(s.s[38]++,Ae),Ue=J.str,gt=J.position,Te=(s.s[39]++,z(Ue,gt.index));if(s.s[40]++,Te===gt.index){s.b[7][0]++,s.s[41]++;return}else s.b[7][1]++;s.s[42]++,Te===-1?(s.b[8][0]++,s.s[43]++,Te=Ue.length):s.b[8][1]++;var Et=(s.s[44]++,y(gt)),Bt=(s.s[45]++,Ue.slice(gt.index,Te));s.s[46]++,d(gt,Ue,Te);var Ke=(s.s[47]++,y(gt));s.s[48]++,Ae.tokens.push({type:W,content:Bt,position:{start:Et,end:Ke}})}function N(Ae){s.f[8]++;var W=(s.s[49]++,Ae),J=W.str,Ue=W.position,gt=(s.s[50]++,y(Ue));s.s[51]++,l(Ue,J,4);var Te=(s.s[52]++,J.indexOf("-->",Ue.index)),Et=(s.s[53]++,Te+3);s.s[54]++,Te===-1?(s.b[9][0]++,s.s[55]++,Te=Et=J.length):s.b[9][1]++;var Bt=(s.s[56]++,J.slice(Ue.index,Te));s.s[57]++,d(Ue,J,Et),s.s[58]++,Ae.tokens.push({type:"comment",content:Bt,position:{start:gt,end:y(Ue)}})}function H(Ae){s.f[9]++;var W=(s.s[59]++,Ae),J=W.str,Ue=W.position;{var gt=(s.s[60]++,J.charAt(Ue.index+1)),Te=(s.s[61]++,gt==="/"),Et=(s.s[62]++,y(Ue));s.s[63]++,l(Ue,J,Te?(s.b[10][0]++,2):(s.b[10][1]++,1)),s.s[64]++,Ae.tokens.push({type:"tag-start",close:Te,position:{start:Et}})}var Bt=(s.s[65]++,oe(Ae));s.s[66]++,ue(Ae);{var Ke=(s.s[67]++,J.charAt(Ue.index)),At=(s.s[68]++,Ke==="/");s.s[69]++,l(Ue,J,At?(s.b[11][0]++,2):(s.b[11][1]++,1));var nt=(s.s[70]++,y(Ue));s.s[71]++,Ae.tokens.push({type:"tag-end",close:At,position:{end:nt}})}return s.s[72]++,Bt}var X=(s.s[73]++,/\s/);function ae(Ae){return s.f[10]++,s.s[74]++,X.test(Ae)}function oe(Ae){s.f[11]++;var W=(s.s[75]++,Ae),J=W.str,Ue=W.position,gt=(s.s[76]++,J.length),Te=(s.s[77]++,Ue.index);for(s.s[78]++;Te<gt;){var Et=(s.s[79]++,J.charAt(Te)),Bt=(s.s[80]++,s.b[12][0]++,!(ae(Et)||(s.b[12][1]++,Et==="/")||(s.b[12][2]++,Et===">")));if(s.s[81]++,Bt){s.b[13][0]++,s.s[82]++;break}else s.b[13][1]++;s.s[83]++,Te++}var Ke=(s.s[84]++,Te+1);for(s.s[85]++;Ke<gt;){var At=(s.s[86]++,J.charAt(Ke)),nt=(s.s[87]++,s.b[14][0]++,!(ae(At)||(s.b[14][1]++,At==="/")||(s.b[14][2]++,At===">")));if(s.s[88]++,nt)s.b[15][1]++;else{s.b[15][0]++,s.s[89]++;break}s.s[90]++,Ke++}s.s[91]++,d(Ue,J,Ke);var dt=(s.s[92]++,J.slice(Te,Ke));return s.s[93]++,Ae.tokens.push({type:"tag",content:dt}),s.s[94]++,dt}function ue(Ae){s.f[12]++;var W=(s.s[95]++,Ae),J=W.str,Ue=W.position,gt=W.tokens,Te=(s.s[96]++,Ue.index),Et=(s.s[97]++,null),Bt=(s.s[98]++,Te),Ke=(s.s[99]++,[]),At=(s.s[100]++,J.length);for(s.s[101]++;Te<At;){var nt=(s.s[102]++,J.charAt(Te));if(s.s[103]++,Et){s.b[16][0]++;var dt=(s.s[104]++,nt===Et);s.s[105]++,dt?(s.b[17][0]++,s.s[106]++,Et=null):s.b[17][1]++,s.s[107]++,Te++,s.s[108]++;continue}else s.b[16][1]++;var Mt=(s.s[109]++,s.b[18][0]++,nt==="/"||(s.b[18][1]++,nt===">"));if(s.s[110]++,Mt){s.b[19][0]++,s.s[111]++,Te!==Bt?(s.b[20][0]++,s.s[112]++,Ke.push(J.slice(Bt,Te))):s.b[20][1]++,s.s[113]++;break}else s.b[19][1]++;var zt=(s.s[114]++,ae(nt));if(s.s[115]++,zt){s.b[21][0]++,s.s[116]++,Te!==Bt?(s.b[22][0]++,s.s[117]++,Ke.push(J.slice(Bt,Te))):s.b[22][1]++,s.s[118]++,Bt=Te+1,s.s[119]++,Te++,s.s[120]++;continue}else s.b[21][1]++;var xt=(s.s[121]++,s.b[23][0]++,nt==="'"||(s.b[23][1]++,nt==='"'));if(s.s[122]++,xt){s.b[24][0]++,s.s[123]++,Et=nt,s.s[124]++,Te++,s.s[125]++;continue}else s.b[24][1]++;s.s[126]++,Te++}s.s[127]++,d(Ue,J,Te);var Gt=(s.s[128]++,Ke.length),yi=(s.s[129]++,"attribute");s.s[130]++;for(var ti=0;ti<Gt;ti++){var Mi=(s.s[131]++,Ke[ti]),Li=(s.s[132]++,Mi.indexOf("=")===-1);if(s.s[133]++,Li){s.b[25][0]++;var qi=(s.s[134]++,Ke[ti+1]);if(s.s[135]++,s.b[27][0]++,qi&&(s.b[27][1]++,(0,a.startsWith)(qi,"="))){if(s.b[26][0]++,s.s[136]++,qi.length>1){s.b[28][0]++;var Pi=(s.s[137]++,Mi+qi);s.s[138]++,gt.push({type:yi,content:Pi}),s.s[139]++,ti+=1,s.s[140]++;continue}else s.b[28][1]++;var Oi=(s.s[141]++,Ke[ti+2]);if(s.s[142]++,ti+=1,s.s[143]++,Oi){s.b[29][0]++;var $t=(s.s[144]++,Mi+"="+Oi);s.s[145]++,gt.push({type:yi,content:$t}),s.s[146]++,ti+=1,s.s[147]++;continue}else s.b[29][1]++}else s.b[26][1]++}else s.b[25][1]++;if(s.s[148]++,(0,a.endsWith)(Mi,"=")){s.b[30][0]++;var Rs=(s.s[149]++,Ke[ti+1]);if(s.s[150]++,s.b[32][0]++,Rs&&(s.b[32][1]++,!(0,a.stringIncludes)(Rs,"="))){s.b[31][0]++;var is=(s.s[151]++,Mi+Rs);s.s[152]++,gt.push({type:yi,content:is}),s.s[153]++,ti+=1,s.s[154]++;continue}else s.b[31][1]++;var hs=(s.s[155]++,Mi.slice(0,-1));s.s[156]++,gt.push({type:yi,content:hs}),s.s[157]++;continue}else s.b[30][1]++;s.s[158]++,gt.push({type:yi,content:Mi})}}var fe=(s.s[159]++,[].push);function be(Ae,W){s.f[13]++;var J=(s.s[160]++,W),Ue=J.str,gt=J.position,Te=J.tokens,Et=(s.s[161]++,Ae.toLowerCase()),Bt=(s.s[162]++,Ue.length),Ke=(s.s[163]++,gt.index);for(s.s[164]++;Ke<Bt;){var At=(s.s[165]++,Ue.indexOf("</",Ke));if(s.s[166]++,At===-1){s.b[33][0]++,s.s[167]++,w(W),s.s[168]++;break}else s.b[33][1]++;var nt=(s.s[169]++,y(gt));s.s[170]++,d(nt,Ue,At);var dt=(s.s[171]++,{str:Ue,position:nt,tokens:[]}),Mt=(s.s[172]++,H(dt));if(s.s[173]++,Et!==Mt.toLowerCase()){s.b[34][0]++,s.s[174]++,Ke=dt.position.index,s.s[175]++;continue}else s.b[34][1]++;if(s.s[176]++,At!==gt.index){s.b[35][0]++;var zt=(s.s[177]++,y(gt));s.s[178]++,d(gt,Ue,At),s.s[179]++,Te.push({type:"text",content:Ue.slice(zt.index,At),position:{start:zt,end:y(gt)}})}else s.b[35][1]++;s.s[180]++,fe.apply(Te,dt.tokens),s.s[181]++,d(gt,Ue,dt.position.index),s.s[182]++;break}}},{"./compat":1}],5:[function(t,n,r){var s=function(){var m="/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/parser.js",O="10fb0478bb046c7059c47c8225586b7e30f48474",D=(function(){}).constructor,z=new D("return this")(),w="__coverage__",N={path:"/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/parser.js",statementMap:{0:{start:{line:4,column:15},end:{line:4,column:44}},1:{start:{line:5,column:16},end:{line:5,column:59}},2:{start:{line:6,column:2},end:{line:6,column:14}},3:{start:{line:7,column:2},end:{line:7,column:22}},4:{start:{line:11,column:21},end:{line:11,column:39}},5:{start:{line:12,column:2},end:{line:24,column:3}},6:{start:{line:13,column:23},end:{line:13,column:39}},7:{start:{line:14,column:4},end:{line:23,column:5}},8:{start:{line:15,column:28},end:{line:15,column:55}},9:{start:{line:16,column:6},end:{line:18,column:7}},10:{start:{line:17,column:8},end:{line:17,column:13}},11:{start:{line:19,column:6},end:{line:21,column:7}},12:{start:{line:20,column:8},end:{line:20,column:19}},13:{start:{line:22,column:6},end:{line:22,column:20}},14:{start:{line:25,column:2},end:{line:25,column:14}},15:{start:{line:29,column:2},end:{line:29,column:45}},16:{start:{line:30,column:2},end:{line:32,column:3}},17:{start:{line:31,column:4},end:{line:31,column:47}},18:{start:{line:33,column:2},end:{line:33,column:25}},19:{start:{line:37,column:28},end:{line:37,column:33}},20:{start:{line:38,column:16},end:{line:38,column:21}},21:{start:{line:39,column:14},end:{line:39,column:46}},22:{start:{line:40,column:14},end:{line:40,column:27}},23:{start:{line:41,column:17},end:{line:41,column:22}},24:{start:{line:42,column:2},end:{line:132,column:3}},25:{start:{line:43,column:18},end:{line:43,column:32}},26:{start:{line:44,column:4},end:{line:48,column:5}},27:{start:{line:45,column:6},end:{line:45,column:23}},28:{start:{line:46,column:6},end:{line:46,column:14}},29:{start:{line:47,column:6},end:{line:47,column:14}},30:{start:{line:50,column:21},end:{line:50,column:37}},31:{start:{line:51,column:4},end:{line:51,column:12}},32:{start:{line:52,column:20},end:{line:52,column:50}},33:{start:{line:53,column:4},end:{line:73,column:5}},34:{start:{line:54,column:18},end:{line:54,column:30}},35:{start:{line:55,column:25},end:{line:55,column:30}},36:{start:{line:56,column:6},end:{line:61,column:7}},37:{start:{line:57,column:8},end:{line:60,column:9}},38:{start:{line:58,column:10},end:{line:58,column:29}},39:{start:{line:59,column:10},end:{line:59,column:15}},40:{start:{line:62,column:6},end:{line:66,column:7}},41:{start:{line:63,column:25},end:{line:63,column:39}},42:{start:{line:64,column:8},end:{line:64,column:46}},43:{start:{line:64,column:41},end:{line:64,column:46}},44:{start:{line:65,column:8},end:{line:65,column:16}},45:{start:{line:67,column:6},end:{line:72,column:7}},46:{start:{line:68,column:8},end:{line:68,column:88}},47:{start:{line:69,column:8},end:{line:69,column:13}},48:{start:{line:71,column:8},end:{line:71,column:16}},49:{start:{line:75,column:25},end:{line:75,column:68}},50:{start:{line:76,column:34},end:{line:76,column:46}},51:{start:{line:77,column:4},end:{line:80,column:5}},52:{start:{line:78,column:56},end:{line:78,column:63}},53:{start:{line:79,column:6},end:{line:79,column:77}},54:{start:{line:82,column:4},end:{line:95,column:5}},55:{start:{line:85,column:25},end:{line:85,column:41}},56:{start:{line:86,column:6},end:{line:94,column:7}},57:{start:{line:87,column:8},end:{line:92,column:9}},58:{start:{line:88,column:10},end:{line:88,column:86}},59:{start:{line:89,column:32},end:{line:89,column:48}},60:{start:{line:90,column:10},end:{line:90,column:47}},61:{start:{line:91,column:10},end:{line:91,column:15}},62:{start:{line:93,column:8},end:{line:93,column:39}},63:{start:{line:97,column:21},end:{line:97,column:23}},64:{start:{line:99,column:4},end:{line:104,column:5}},65:{start:{line:100,column:6},end:{line:100,column:32}},66:{start:{line:101,column:6},end:{line:101,column:45}},67:{start:{line:101,column:40},end:{line:101,column:45}},68:{start:{line:102,column:6},end:{line:102,column:40}},69:{start:{line:103,column:6},end:{line:103,column:14}},70:{start:{line:106,column:4},end:{line:106,column:12}},71:{start:{line:107,column:21},end:{line:107,column:23}},72:{start:{line:108,column:21},end:{line:111,column:5}},73:{start:{line:112,column:24},end:{line:118,column:5}},74:{start:{line:119,column:4},end:{line:119,column:27}},75:{start:{line:121,column:24},end:{line:121,column:86}},76:{start:{line:122,column:4},end:{line:131,column:5}},77:{start:{line:123,column:19},end:{line:123,column:60}},78:{start:{line:124,column:25},end:{line:124,column:57}},79:{start:{line:125,column:6},end:{line:125,column:23}},80:{start:{line:126,column:6},end:{line:126,column:32}},81:{start:{line:127,column:31},end:{line:127,column:52}},82:{start:{line:128,column:6},end:{line:130,column:7}},83:{start:{line:129,column:8},end:{line:129,column:66}},84:{start:{line:133,column:2},end:{line:133,column:23}}},fnMap:{0:{name:"parser",decl:{start:{line:3,column:24},end:{line:3,column:30}},loc:{start:{line:3,column:49},end:{line:8,column:1}},line:3},1:{name:"hasTerminalParent",decl:{start:{line:10,column:16},end:{line:10,column:33}},loc:{start:{line:10,column:62},end:{line:26,column:1}},line:10},2:{name:"rewindStack",decl:{start:{line:28,column:16},end:{line:28,column:27}},loc:{start:{line:28,column:81},end:{line:34,column:1}},line:28},3:{name:"parse",decl:{start:{line:36,column:16},end:{line:36,column:21}},loc:{start:{line:36,column:30},end:{line:134,column:1}},line:36}},branchMap:{0:{loc:{start:{line:12,column:2},end:{line:24,column:3}},type:"if",locations:[{start:{line:12,column:2},end:{line:24,column:3}},{start:{line:12,column:2},end:{line:24,column:3}}],line:12},1:{loc:{start:{line:16,column:6},end:{line:18,column:7}},type:"if",locations:[{start:{line:16,column:6},end:{line:18,column:7}},{start:{line:16,column:6},end:{line:18,column:7}}],line:16},2:{loc:{start:{line:19,column:6},end:{line:21,column:7}},type:"if",locations:[{start:{line:19,column:6},end:{line:21,column:7}},{start:{line:19,column:6},end:{line:21,column:7}}],line:19},3:{loc:{start:{line:44,column:4},end:{line:48,column:5}},type:"if",locations:[{start:{line:44,column:4},end:{line:48,column:5}},{start:{line:44,column:4},end:{line:48,column:5}}],line:44},4:{loc:{start:{line:53,column:4},end:{line:73,column:5}},type:"if",locations:[{start:{line:53,column:4},end:{line:73,column:5}},{start:{line:53,column:4},end:{line:73,column:5}}],line:53},5:{loc:{start:{line:57,column:8},end:{line:60,column:9}},type:"if",locations:[{start:{line:57,column:8},end:{line:60,column:9}},{start:{line:57,column:8},end:{line:60,column:9}}],line:57},6:{loc:{start:{line:64,column:8},end:{line:64,column:46}},type:"if",locations:[{start:{line:64,column:8},end:{line:64,column:46}},{start:{line:64,column:8},end:{line:64,column:46}}],line:64},7:{loc:{start:{line:67,column:6},end:{line:72,column:7}},type:"if",locations:[{start:{line:67,column:6},end:{line:72,column:7}},{start:{line:67,column:6},end:{line:72,column:7}}],line:67},8:{loc:{start:{line:77,column:4},end:{line:80,column:5}},type:"if",locations:[{start:{line:77,column:4},end:{line:80,column:5}},{start:{line:77,column:4},end:{line:80,column:5}}],line:77},9:{loc:{start:{line:82,column:4},end:{line:95,column:5}},type:"if",locations:[{start:{line:82,column:4},end:{line:95,column:5}},{start:{line:82,column:4},end:{line:95,column:5}}],line:82},10:{loc:{start:{line:87,column:8},end:{line:92,column:9}},type:"if",locations:[{start:{line:87,column:8},end:{line:92,column:9}},{start:{line:87,column:8},end:{line:92,column:9}}],line:87},11:{loc:{start:{line:101,column:6},end:{line:101,column:45}},type:"if",locations:[{start:{line:101,column:6},end:{line:101,column:45}},{start:{line:101,column:6},end:{line:101,column:45}}],line:101},12:{loc:{start:{line:121,column:26},end:{line:121,column:85}},type:"binary-expr",locations:[{start:{line:121,column:26},end:{line:121,column:41}},{start:{line:121,column:45},end:{line:121,column:85}}],line:121},13:{loc:{start:{line:122,column:4},end:{line:131,column:5}},type:"if",locations:[{start:{line:122,column:4},end:{line:131,column:5}},{start:{line:122,column:4},end:{line:131,column:5}}],line:122},14:{loc:{start:{line:128,column:6},end:{line:130,column:7}},type:"if",locations:[{start:{line:128,column:6},end:{line:130,column:7}},{start:{line:128,column:6},end:{line:130,column:7}}],line:128}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0,25:0,26:0,27:0,28:0,29:0,30:0,31:0,32:0,33:0,34:0,35:0,36:0,37:0,38:0,39:0,40:0,41:0,42:0,43:0,44:0,45:0,46:0,47:0,48:0,49:0,50:0,51:0,52:0,53:0,54:0,55:0,56:0,57:0,58:0,59:0,60:0,61:0,62:0,63:0,64:0,65:0,66:0,67:0,68:0,69:0,70:0,71:0,72:0,73:0,74:0,75:0,76:0,77:0,78:0,79:0,80:0,81:0,82:0,83:0,84:0},f:{0:0,1:0,2:0,3:0},b:{0:[0,0],1:[0,0],2:[0,0],3:[0,0],4:[0,0],5:[0,0],6:[0,0],7:[0,0],8:[0,0],9:[0,0],10:[0,0],11:[0,0],12:[0,0],13:[0,0],14:[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},H=z[w]||(z[w]={});return H[m]&&H[m].hash===O?H[m]:(N.hash=O,H[m]=N)}();Object.defineProperty(r,"__esModule",{value:!0}),r.default=l,r.hasTerminalParent=d,r.rewindStack=c,r.parse=y;var a=t("./compat");function l(m,O){s.f[0]++;var D=(s.s[0]++,{tagName:null,children:[]}),z=(s.s[1]++,{tokens:m,options:O,cursor:0,stack:[D]});return s.s[2]++,y(z),s.s[3]++,D.children}function d(m,O,D){s.f[1]++;var z=(s.s[4]++,D[m]);if(s.s[5]++,z){s.b[0][0]++;var w=(s.s[6]++,O.length-1);for(s.s[7]++;w>=0;){var N=(s.s[8]++,O[w].tagName);if(s.s[9]++,N===m){s.b[1][0]++,s.s[10]++;break}else s.b[1][1]++;if(s.s[11]++,(0,a.arrayIncludes)(z,N))return s.b[2][0]++,s.s[12]++,!0;s.b[2][1]++,s.s[13]++,w--}}else s.b[0][1]++;return s.s[14]++,!1}function c(m,O,D,z){s.f[2]++,s.s[15]++,m[O].position.end=z,s.s[16]++;for(var w=O+1,N=m.length;w<N;w++)s.s[17]++,m[w].position.end=D;s.s[18]++,m.splice(O)}function y(m){s.f[3]++;var O=(s.s[19]++,m),D=O.tokens,z=O.options,w=(s.s[20]++,m),N=w.stack,H=(s.s[21]++,N[N.length-1].children),X=(s.s[22]++,D.length),ae=(s.s[23]++,m),oe=ae.cursor;for(s.s[24]++;oe<X;){var ue=(s.s[25]++,D[oe]);if(s.s[26]++,ue.type!=="tag-start"){s.b[3][0]++,s.s[27]++,H.push(ue),s.s[28]++,oe++,s.s[29]++;continue}else s.b[3][1]++;var fe=(s.s[30]++,D[++oe]);s.s[31]++,oe++;var be=(s.s[32]++,fe.content.toLowerCase());if(s.s[33]++,ue.close){s.b[4][0]++;var Ae=(s.s[34]++,N.length),W=(s.s[35]++,!1);for(s.s[36]++;--Ae>-1;)if(s.s[37]++,N[Ae].tagName===be){s.b[5][0]++,s.s[38]++,W=!0,s.s[39]++;break}else s.b[5][1]++;for(s.s[40]++;oe<X;){var J=(s.s[41]++,D[oe]);if(s.s[42]++,J.type!=="tag-end"){s.b[6][0]++,s.s[43]++;break}else s.b[6][1]++;s.s[44]++,oe++}if(s.s[45]++,W){s.b[7][0]++,s.s[46]++,c(N,Ae,ue.position.start,D[oe-1].position.end),s.s[47]++;break}else{s.b[7][1]++,s.s[48]++;continue}}else s.b[4][1]++;var Ue=(s.s[49]++,(0,a.arrayIncludes)(z.closingTags,be)),gt=(s.s[50]++,Ue);if(s.s[51]++,gt){s.b[8][0]++;var Te=(s.s[52]++,z),Et=Te.closingTagAncestorBreakers;s.s[53]++,gt=!d(be,N,Et)}else s.b[8][1]++;if(s.s[54]++,gt){s.b[9][0]++;var Bt=(s.s[55]++,N.length-1);for(s.s[56]++;Bt>0;){if(s.s[57]++,be===N[Bt].tagName){s.b[10][0]++,s.s[58]++,c(N,Bt,ue.position.start,ue.position.start);var Ke=(s.s[59]++,Bt-1);s.s[60]++,H=N[Ke].children,s.s[61]++;break}else s.b[10][1]++;s.s[62]++,Bt=Bt-1}}else s.b[9][1]++;var At=(s.s[63]++,[]),nt=void 0;for(s.s[64]++;oe<X;){if(s.s[65]++,nt=D[oe],s.s[66]++,nt.type==="tag-end"){s.b[11][0]++,s.s[67]++;break}else s.b[11][1]++;s.s[68]++,At.push(nt.content),s.s[69]++,oe++}s.s[70]++,oe++;var dt=(s.s[71]++,[]),Mt=(s.s[72]++,{start:ue.position.start,end:nt.position.end}),zt=(s.s[73]++,{type:"element",tagName:fe.content,attributes:At,children:dt,position:Mt});s.s[74]++,H.push(zt);var xt=(s.s[75]++,s.b[12][0]++,!(nt.close||(s.b[12][1]++,(0,a.arrayIncludes)(z.voidTags,be))));if(s.s[76]++,xt){s.b[13][0]++;var Gt=(s.s[77]++,N.push({tagName:be,children:dt,position:Mt})),yi=(s.s[78]++,{tokens:D,options:z,cursor:oe,stack:N});s.s[79]++,y(yi),s.s[80]++,oe=yi.cursor;var ti=(s.s[81]++,N.length===Gt);s.s[82]++,ti?(s.b[14][0]++,s.s[83]++,zt.position.end=D[oe-1].position.end):s.b[14][1]++}else s.b[13][1]++}s.s[84]++,m.cursor=oe}},{"./compat":1}],6:[function(t,n,r){var s=function(){var c="/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/stringify.js",y="4a6a4628f3d12bd91f868fee07f716c74df89307",m=(function(){}).constructor,O=new m("return this")(),D="__coverage__",z={path:"/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/stringify.js",statementMap:{0:{start:{line:4,column:2},end:{line:12,column:8}},1:{start:{line:5,column:25},end:{line:5,column:34}},2:{start:{line:6,column:4},end:{line:8,column:5}},3:{start:{line:7,column:6},end:{line:7,column:30}},4:{start:{line:9,column:24},end:{line:9,column:50}},5:{start:{line:10,column:18},end:{line:10,column:42}},6:{start:{line:11,column:4},end:{line:11,column:53}},7:{start:{line:16,column:2},end:{line:28,column:13}},8:{start:{line:17,column:4},end:{line:19,column:5}},9:{start:{line:18,column:6},end:{line:18,column:25}},10:{start:{line:20,column:4},end:{line:22,column:5}},11:{start:{line:21,column:6},end:{line:21,column:37}},12:{start:{line:23,column:44},end:{line:23,column:48}},13:{start:{line:24,column:26},end:{line:24,column:80}},14:{start:{line:25,column:4},end:{line:27,column:94}}},fnMap:{0:{name:"formatAttributes",decl:{start:{line:3,column:16},end:{line:3,column:32}},loc:{start:{line:3,column:46},end:{line:13,column:1}},line:3},1:{name:"(anonymous_1)",decl:{start:{line:4,column:27},end:{line:4,column:28}},loc:{start:{line:4,column:49},end:{line:12,column:3}},line:4},2:{name:"toHTML",decl:{start:{line:15,column:16},end:{line:15,column:22}},loc:{start:{line:15,column:39},end:{line:29,column:1}},line:15},3:{name:"(anonymous_3)",decl:{start:{line:16,column:18},end:{line:16,column:19}},loc:{start:{line:16,column:26},end:{line:28,column:3}},line:16}},branchMap:{0:{loc:{start:{line:6,column:4},end:{line:8,column:5}},type:"if",locations:[{start:{line:6,column:4},end:{line:8,column:5}},{start:{line:6,column:4},end:{line:8,column:5}}],line:6},1:{loc:{start:{line:10,column:18},end:{line:10,column:42}},type:"cond-expr",locations:[{start:{line:10,column:32},end:{line:10,column:35}},{start:{line:10,column:38},end:{line:10,column:42}}],line:10},2:{loc:{start:{line:17,column:4},end:{line:19,column:5}},type:"if",locations:[{start:{line:17,column:4},end:{line:19,column:5}},{start:{line:17,column:4},end:{line:19,column:5}}],line:17},3:{loc:{start:{line:20,column:4},end:{line:22,column:5}},type:"if",locations:[{start:{line:20,column:4},end:{line:22,column:5}},{start:{line:20,column:4},end:{line:22,column:5}}],line:20},4:{loc:{start:{line:25,column:11},end:{line:27,column:94}},type:"cond-expr",locations:[{start:{line:26,column:8},end:{line:26,column:53}},{start:{line:27,column:8},end:{line:27,column:94}}],line:25}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0},f:{0:0,1:0,2:0,3:0},b:{0:[0,0],1:[0,0],2:[0,0],3:[0,0],4:[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},w=O[D]||(O[D]={});return w[c]&&w[c].hash===y?w[c]:(z.hash=y,w[c]=z)}();Object.defineProperty(r,"__esModule",{value:!0}),r.formatAttributes=l,r.toHTML=d;var a=t("./compat");function l(c){return s.f[0]++,s.s[0]++,c.reduce(function(y,m){s.f[1]++;var O=(s.s[1]++,m),D=O.key,z=O.value;if(s.s[2]++,z===null)return s.b[0][0]++,s.s[3]++,y+" "+D;s.b[0][1]++;var w=(s.s[4]++,z.indexOf("'")!==-1),N=(s.s[5]++,w?(s.b[1][0]++,'"'):(s.b[1][1]++,"'"));return s.s[6]++,y+" "+D+"="+N+z+N},"")}function d(c,y){return s.f[2]++,s.s[7]++,c.map(function(m){if(s.f[3]++,s.s[8]++,m.type==="text")return s.b[2][0]++,s.s[9]++,m.content;if(s.b[2][1]++,s.s[10]++,m.type==="comment")return s.b[3][0]++,s.s[11]++,"<!--"+m.content+"-->";s.b[3][1]++;var O=(s.s[12]++,m),D=O.tagName,z=O.attributes,w=O.children,N=(s.s[13]++,(0,a.arrayIncludes)(y.voidTags,D.toLowerCase()));return s.s[14]++,N?(s.b[4][0]++,"<"+D+l(z)+">"):(s.b[4][1]++,"<"+D+l(z)+">"+d(w,y)+"</"+D+">")}).join("")}r.default={toHTML:d}},{"./compat":1}],7:[function(t,n,r){var s=function(){var a="/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/tags.js",l="6039b9f65d15797c952509955976acf6930e65a4",d=(function(){}).constructor,c=new d("return this")(),y="__coverage__",m={path:"/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/tags.js",statementMap:{0:{start:{line:5,column:29},end:{line:5,column:60}},1:{start:{line:11,column:27},end:{line:14,column:1}},2:{start:{line:23,column:42},end:{line:32,column:1}},3:{start:{line:38,column:24},end:{line:42,column:1}}},fnMap:{},branchMap:{},s:{0:0,1:0,2:0,3:0},f:{},b:{},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},O=c[y]||(c[y]={});return O[a]&&O[a].hash===l?O[a]:(m.hash=l,O[a]=m)}();Object.defineProperty(r,"__esModule",{value:!0}),r.childlessTags=(s.s[0]++,["style","script","template"]),r.closingTags=(s.s[1]++,["html","head","body","p","dt","dd","li","option","thead","th","tbody","tr","td","tfoot","colgroup"]),r.closingTagAncestorBreakers=(s.s[2]++,{li:["ul","ol","menu"],dt:["dl"],dd:["dl"],tbody:["table"],thead:["table"],tfoot:["table"],tr:["table"],td:["table"]}),r.voidTags=(s.s[3]++,["!doctype","area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"])},{}]},{},[3])(3)})})();(function(){window.assertions=window.assertions||{},window.assertions.assertFunction=window.assertions.assertFunction||function(o,...e){if(!o){e=e.filter(n=>!!e),window.navigator&&window.navigator.appName==="Microsoft Internet Explorer"&&e.push(`stack=
${new Error().stack}`);const t=e.length>0?"Assertion failed: ":"Assertion failed";if(console&&console.error&&console.error(t,...e),window.QueryStringMachine&&QueryStringMachine.containsKey("debugger"))debugger;throw new Error(t+e.join(`
 `))}},window.assert=window.assert||null,window.assertSlow=window.assertSlow||null,window.assertions.enableAssert=function(){window.assert=window.assertions.assertFunction,window.console&&window.console.log&&window.console.log("enabling assert")},window.assertions.disableAssert=function(){window.assert=null,window.console&&window.console.log&&window.console.log("disabling assert")},window.assertions.enableAssertSlow=function(){window.assertSlow=window.assertions.assertFunction,window.console&&window.console.log&&window.console.log("enabling assertSlow")},window.assertions.disableAssertSlow=function(){window.assertSlow=null,window.console&&window.console.log&&window.console.log("disabling assertSlow")}})();window.phet=window.phet||{};window.phet.chipper=window.phet.chipper||{};window.phet.chipper.packageObject={name:"scenery-lab-demo"};window.phet.chipper.stringRepos=[{repo:"joist",requirejsNamespace:"JOIST"},{repo:"scenery-phet",requirejsNamespace:"SCENERY_PHET"},{repo:"sun",requirejsNamespace:"SUN"},{repo:"tambo",requirejsNamespace:"TAMBO"},{repo:"vegas",requirejsNamespace:"VEGAS"}];window.phet.chipper.strings={en:{a11y:{numberSpinnerRoleDescription:{value:"number spinner"},close:{value:"Close"},closed:{value:"Closed"},titleClosePattern:{value:"{{title}}, Close."}}}};let isHMR;try{isHMR=module&&module.hot}catch{isHMR=!1}const isHMR$1=isHMR;class Namespace{constructor(e){if(this.name=e,window.phet){if(e==="chipper")return window.phet.chipper.name="chipper",window.phet.chipper.register=this.register.bind(window.phet.chipper),window.phet.chipper;{const t=!_.hasIn(window,"phet.chipper.brand");assert&&!t&&assert(!window.phet[e],`namespace ${e} already exists`),window.phet[e]=this}}}register(e,t){if(e.includes("."))isHMR$1||assert&&assert(!this[e],`${e} is already registered for namespace ${this.name}`),this[e]=t;else{const n=e.split(".");let r=this;for(let a=0;a<n.length-1;a++)isHMR$1||assert&&assert(!!r[n[a]],`${[this.name].concat(n.slice(0,a+1)).join(".")} needs to be defined to register ${e}`),r=r[n[a]];const s=n[n.length-1];isHMR$1||assert&&assert(!r[s],`${e} is already registered for namespace ${this.name}`),r[s]=t}return t}}const phetCore=new Namespace("phetCore");phetCore.register("Namespace",Namespace);function arrayDifference(o,e,t,n,r){assert&&assert(Array.isArray(o)&&_.uniq(o).length===o.length,"a is not an array of unique items"),assert&&assert(Array.isArray(e)&&_.uniq(e).length===e.length,"b is not an array of unique items"),t=t||[],n=n||[],r=r||[],assert&&assert(Array.isArray(t)&&t.length===0),assert&&assert(Array.isArray(n)&&n.length===0),assert&&assert(Array.isArray(r)&&r.length===0),Array.prototype.push.apply(t,o),Array.prototype.push.apply(n,e);e:for(let s=0;s<t.length;s++){const a=t[s];for(let l=0;l<n.length;l++){const d=n[l];if(a===d){if(r.push(a),t.splice(s,1),n.splice(l,1),l=0,s===t.length)break e;s-=1}}}return t}phetCore.register("arrayDifference",arrayDifference);function arrayRemove(o,e){assert&&assert(Array.isArray(o),"arrayRemove takes an Array");const t=_.indexOf(o,e);assert&&assert(t>=0,"item not found in Array"),o.splice(t,1)}phetCore.register("arrayRemove",arrayRemove);function inheritance(o){const e=[o];let t=o.prototype;for(;t&&(t=Object.getPrototypeOf(t));)t.constructor&&e.push(t.constructor);return e}phetCore.register("inheritance",inheritance);const assertHasProperties=(o,e)=>{assert&&o&&e.forEach(t=>{assert&&assert(Object.getOwnPropertyDescriptor(o,t)||_.some(inheritance(o.constructor).map(n=>Object.getOwnPropertyDescriptor(n.prototype,t))),`property not defined: ${t}`)})};phetCore.register("assertHasProperties",assertHasProperties);const assertMutuallyExclusiveOptions=function(o,...e){if(assert&&o){const t=e.map(n=>Object.keys(_.pick(o,...n)));t.filter(n=>n.length>0).length>1&&assert&&assert(!1,`Cannot simultaneously specify ${t.join(" and ")}`)}};phetCore.register("assertMutuallyExclusiveOptions",assertMutuallyExclusiveOptions);class AsyncLoader{constructor(){this.pendingLocks=[],this.loadComplete=!1,this.listeners=[]}reset(){this.loadComplete=!1}addListener(e){this.listeners.push(e)}proceedIfReady(){this.pendingLocks.length===0&&(assert&&assert(!this.loadComplete,"cannot complete load twice"),this.loadComplete=!0,this.listeners.forEach(e=>e()))}createLock(e){return assert&&assert(!this.loadComplete,"Cannot create more locks after load-step has completed"),this.pendingLocks.push(e),()=>{assert&&assert(this.pendingLocks.includes(e),"invalid lock"),arrayRemove(this.pendingLocks,e),this.proceedIfReady()}}}const asyncLoader=new AsyncLoader;phetCore.register("asyncLoader",asyncLoader);function cleanArray(o){if(assert&&assert(!o||Array.isArray(o),"cleanArray either takes an Array"),o){for(;o.length;)o.pop();return o}else return[]}phetCore.register("cleanArray",cleanArray);function collect(o){const e=[];return o(t=>{e.push(t)}),e}phetCore.register("collect",collect);function copyWithSortedKeys(o){if(Array.isArray(o))return o.map(copyWithSortedKeys);if(typeof o!="object"||o===null)return o;const e={};return Object.keys(o).sort().forEach(t=>{const n=o[t];e[t]=copyWithSortedKeys(n)}),e}phetCore.register("copyWithSortedKeys",copyWithSortedKeys);const deprecatedMessages={},deprecationWarning=(o,e=window.phet&&window.phet.chipper&&window.phet.chipper.queryParameters&&phet.chipper.queryParameters.deprecationWarnings)=>{e&&!deprecatedMessages.hasOwnProperty(o)&&(deprecatedMessages[o]=!0,console.warn(`Deprecation warning: ${o}`))};phetCore.register("deprecationWarning",deprecationWarning);function detectPrefix(o,e){if(o[e]!==void 0)return e;if(e=e.charAt(0).toUpperCase()+e.slice(1),o[`moz${e}`]!==void 0)return`moz${e}`;if(o[`Moz${e}`]!==void 0)return`Moz${e}`;if(o[`webkit${e}`]!==void 0)return`webkit${e}`;if(o[`ms${e}`]!==void 0)return`ms${e}`;if(o[`o${e}`]!==void 0)return`o${e}`}phetCore.register("detectPrefix",detectPrefix);function detectPrefixEvent(o,e){if(o[`on${e}`]!==void 0)return e;if(o[`onmoz${e}`]!==void 0)return`moz${e}`;if(o[`onMoz${e}`]!==void 0)return`Moz${e}`;if(o[`onwebkit${e}`]!==void 0)return`webkit${e}`;if(o[`onms${e}`]!==void 0)return`ms${e}`;if(o[`ono${e}`]!==void 0)return`o${e}`}phetCore.register("detectPrefixEvent",detectPrefixEvent);function dimensionForEach(o,e,t){const n=[];function r(s,a){return a.forEach((l,d)=>{n.push(d),s===1?t(l,...n):r(s-1,l),n.pop()})}return r(o,e)}phetCore.register("dimensionForEach",dimensionForEach);function dimensionMap(o,e,t){const n=[];function r(s,a){return a.map((l,d)=>{n.push(d);const c=s===1?t(l,...n):r(s-1,l);return n.pop(),c})}return r(o,e)}phetCore.register("dimensionMap",dimensionMap);const Lh=class Lh{toString(){return this.name}isEnumerationValue(){return!0}constructor(){const e=this.constructor;assert&&assert(!Lh.sealedCache.has(e),"cannot create instanceof of a sealed constructor"),this._name=null,this._enumeration=null}set name(e){assert&&assert(!this._name,"name cannot be changed once defined."),this._name=e}get name(){return assert&&assert(this._name,"name cannot be retrieved until it has been filled in by Enumeration."),this._name}set enumeration(e){assert&&assert(!this._enumeration,"enumeration cannot be changed once defined."),this._enumeration=e}get enumeration(){return assert&&assert(this._enumeration,"enumeration cannot be retrieved until it has been filled in by Enumeration."),this._enumeration}};Lh.sealedCache=new Set;let EnumerationValue=Lh;phetCore.register("EnumerationValue",EnumerationValue);const OPTIONS_SUFFIX="Options";function merge(o,...e){return assert&&assertIsMergeable(o),assert&&assert(o!==null,"target should not be null"),assert&&assert(e.length>0,"at least one source expected"),_.each(e,t=>{if(t){assert&&assertIsMergeable(t);for(const n in t)if(t.hasOwnProperty(n)&&t[n]!==void 0){const r=t[n];_.endsWith(n,OPTIONS_SUFFIX)&&n!==OPTIONS_SUFFIX?(assert&&assert(r!==void 0,"nested *Options should not be undefined"),o[n]=merge(o[n]||{},r)):o[n]=r}}}),o}function assertIsMergeable(o){assert&&assert(o===null||o&&typeof o=="object"&&Object.getPrototypeOf(o)===Object.prototype,"object is not compatible with merge"),o!==null&&Object.keys(o).forEach(e=>{const t=Object.getOwnPropertyDescriptor(o,e);assert&&assert(!t.hasOwnProperty("set"),"cannot use merge with an object that has a setter"),assert&&assert(!t.hasOwnProperty("get"),"cannot use merge with an object that has a getter")})}phetCore.register("merge",merge);const merge4=(o,e,t,n)=>merge(o,e,t,n);function optionize(){return merge4}function optionize3(){return merge4}function combineOptions(o,...e){return merge4(o,...e)}phetCore.register("optionize",optionize);class Enumeration{constructor(e,t){const n=optionize()({phetioDocumentation:"",instanceType:e},t);this.phetioDocumentation=n.phetioDocumentation;const r=n.instanceType,s=_.reverse(inheritance(e));assert&&assert(s.includes(r),"the specified type should be in its own hierarchy"),this.keys=[],this.values=[],s.forEach(a=>{Object.keys(a).forEach(l=>{const d=a[l];d instanceof r&&(assert&&assert(l===l.toUpperCase(),"keys should be upper case by convention"),this.keys.push(l),this.values.push(d),d instanceof e&&(d.name=l,d.enumeration=this))})}),assert&&assert(this.keys.length>0,"no keys found"),assert&&assert(this.values.length>0,"no values found"),this.Enumeration=e,EnumerationValue.sealedCache.add(e)}getKey(e){return e.name}getValue(e){return this.Enumeration[e]}includes(e){return this.values.includes(e)}}phetCore.register("Enumeration",Enumeration);class EnumerationDeprecated{constructor(e){deprecationWarning("EnumerationDeprecated should be exchanged for classes that extend EnumerationValue, see WilderEnumerationPatterns for examples."),assert&&assert(e,"config must be provided");const t=!!e.keys,n=!!e.map;assert&&assert(t!==n,"must provide one or the other but not both of keys/map");const r=e.keys||Object.keys(e.map),s=e.map||{};e=merge({phetioDocumentation:null,beforeFreeze:null},e),assert&&assert(Array.isArray(r),"Values should be an array"),assert&&assert(_.uniq(r).length===r.length,"There should be no duplicated values provided"),assert&&r.forEach(a=>assert(typeof a=="string","Each value should be a string")),assert&&r.forEach(a=>assert(/^[A-Z][A-Z0-9_]*$/g.test(a),"EnumerationDeprecated values should be uppercase alphanumeric with underscores and begin with a letter")),assert&&assert(!_.includes(r,"VALUES"),"This is the name of a built-in provided value, so it cannot be included as an enumeration value"),assert&&assert(!_.includes(r,"KEYS"),"This is the name of a built-in provided value, so it cannot be included as an enumeration value"),assert&&assert(!_.includes(r,"includes"),"This is the name of a built-in provided value, so it cannot be included as an enumeration value"),this.phetioDocumentation=e.phetioDocumentation,this.KEYS=r,this.VALUES=[],r.forEach(a=>{const l=s[a]||{};assert&&assert(l.name===void 0,'"rich" enumeration values cannot provide their own name attribute'),assert&&assert(l.toString===Object.prototype.toString,'"rich" enumeration values cannot provide their own toString'),l.name=a,l.toString=()=>a,this[a]=l,this.VALUES.push(l)}),e.beforeFreeze&&e.beforeFreeze(this),assert&&Object.freeze(this),assert&&Object.freeze(this.VALUES),assert&&Object.freeze(this.KEYS),assert&&r.forEach(a=>assert&&Object.freeze(s[a]))}toString(){return this.KEYS.join(", ")}includes(e){return _.includes(this.VALUES,e)}getValue(e){return this[e]}getKey(e){return e.name}get values(){return this.VALUES}get keys(){return this.KEYS}get enumeration(){return this}static byKeys(e,t){return assert&&assert(Array.isArray(e),"keys must be an array"),assert&&assert(!t||t.keys===void 0),new EnumerationDeprecated(merge({keys:e},t))}static byMap(e,t){if(assert&&assert(!t||t.map===void 0),assert){const n=_.values(e);assert&&assert(n.length>=1,"must have at least 2 entries in an enumeration"),assert&&assert(_.every(n,r=>r.constructor===n[0].constructor),"Values must have same constructor")}return new EnumerationDeprecated(merge({map:e},t))}}phetCore.register("EnumerationDeprecated",EnumerationDeprecated);class EnumerationMap{constructor(e,t){this._map=new Map,this._enumeration=e,this._values=e.enumeration.values,this._values.forEach(n=>{assert&&assert(!this._map.has(n),"Enumeration key override problem"),this._map.set(n,t(n))})}get(e){return assert&&assert(this._values.includes(e)),assert&&assert(this._map.has(e)),this._map.get(e)}set(e,t){assert&&assert(this._values.includes(e)),this._map.set(e,t)}map(e){return new EnumerationMap(this._enumeration,t=>e(this.get(t),t))}forEach(e){this._values.forEach(t=>e(this.get(t),t))}values(){return this._values.map(e=>this.get(e))}}phetCore.register("EnumerationMap",EnumerationMap);function escapeHTML(o){return o.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")}phetCore.register("escapeHTML",escapeHTML);const Sl=class Sl{constructor(e,t){this.eventModel=e,this.eventCallback=t,this.period=this.eventModel.getPeriodBeforeNextEvent(),this.timeBeforeNextEvent=this.period}step(e){for(;e>=this.timeBeforeNextEvent;)e-=this.timeBeforeNextEvent,this.period=this.eventModel.getPeriodBeforeNextEvent(),this.timeBeforeNextEvent=this.period,this.eventCallback(e);this.timeBeforeNextEvent-=e}getRatio(){return(this.period-this.timeBeforeNextEvent)/this.period}};Sl.ConstantEventModel=class{constructor(t){this.rate=t,assert&&assert(t>0,"We need to have a strictly positive rate in order to prevent infinite loops.")}getPeriodBeforeNextEvent(){return 1/this.rate}},Sl.UniformEventModel=class{constructor(t,n){this.rate=t,this.pseudoRandomNumberSource=n,assert&&assert(t>0,"We need to have a strictly positive rate in order to prevent infinite loops.")}getPeriodBeforeNextEvent(){const t=this.pseudoRandomNumberSource();return assert&&assert(t>=0&&t<1,`Our uniform random number is outside of its expected range with a value of ${t}`),t*2/this.rate}},Sl.PoissonEventModel=class{constructor(t,n){this.rate=t,this.pseudoRandomNumberSource=n,assert&&assert(t>0,"We need to have a strictly positive poisson rate in order to prevent infinite loops.")}getPeriodBeforeNextEvent(){const t=this.pseudoRandomNumberSource();return assert&&assert(t>=0&&t<1,`Our uniform random number is outside of its expected range with a value of ${t}`),-Math.log(t)/this.rate}};let EventTimer=Sl;phetCore.register("EventTimer",EventTimer);function extend(o,...e){return _.each(e,t=>{if(t)for(const n in t)Object.defineProperty(o,n,Object.getOwnPropertyDescriptor(t,n))}),o}phetCore.register("extend",extend);function extendDefined(o,...e){return _.each(e,t=>{if(t)for(const n in t){const r=Object.getOwnPropertyDescriptor(t,n);r&&(typeof r.get=="function"||t[n]!==void 0)&&Object.defineProperty(o,n,r)}}),o}phetCore.register("extendDefined",extendDefined);const getGlobal=o=>{assert&&assert(o.trim()===o,"path must be trimmed");const e=_.get(window,o);return e!==void 0?e:null};phetCore.register("getGlobal",getGlobal);const gracefulBind=o=>{assert&&assert(o.split(".").length>1,"path must have multiple parts"),assert&&assert(o.trim()===o,"path must be trimmed");const e=o.split("."),t=e.pop(),n=_.get(window,e);return n?n[t].bind(n):null};phetCore.register("gracefulBind",gracefulBind);function identity(o){return o}phetCore.register("identity",identity);function interleave(o,e){assert&&assert(Array.isArray(o));const t=[],n=o.length*2-1;for(let r=0;r<n;r++)r%2===0?t.push(o[r/2]):t.push(e((r-1)/2));return t}phetCore.register("interleave",interleave);function isArray(o){return Object.prototype.toString.call(o)==="[object Array]"}phetCore.register("isArray",isArray);function loadScript(o){const e=typeof o=="string"?{src:o}:o,t=e.src,n=e.callback,r=e.async===void 0?!0:e.async,s=e.cacheBust===void 0?!1:e.cacheBust;let a=!1;const l=document.createElement("script");l.type="text/javascript",l.async=r,l.onload=l.onreadystatechange=function(){const c=this.readyState;c&&c!=="complete"&&c!=="loaded"||a||(a=!0,n&&n())},l.src=t+(s?`?random=${Math.random().toFixed(10)}`:"");const d=document.getElementsByTagName("script")[0];d.parentNode.insertBefore(l,d)}phetCore.register("loadScript",loadScript);function logGlobal(o){phet.log&&phet.log(`${o}: ${JSON.stringify(getGlobal(o),null,2)}`)}phetCore.register("logGlobal",logGlobal);function memoize(o){const e=new Map;return t=>{if(e.has(t))return e.get(t);{const n=o(t);return e.set(t,n),n}}}phetCore.register("memoize",memoize);class MipmapElement{constructor(e,t,n){this.width=e,this.height=t,this.url=n,this.img=new Image;const r=asyncLoader.createLock(this.img);this.img.onload=r,this.img.src=this.url,this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height;const s=this.canvas.getContext("2d");this.updateCanvas=()=>{this.img.complete&&(typeof this.img.naturalWidth>"u"||this.img.naturalWidth>0)&&(s.drawImage(this.img,0,0),delete this.updateCanvas)}}}phetCore.register("MipmapElement",MipmapElement);function mutate(o,e,t){assert&&assert(o),assert&&assert(Array.isArray(e)),t&&(assert&&assert(Object.getPrototypeOf(t)===Object.prototype,"Extra prototype on options object is a code smell"),_.each(e,n=>{assert&&assert(!t.hasOwnProperty(n)||t[n]!==void 0,`Undefined not allowed for key: ${n}`),t[n]!==void 0&&(o[n]=t[n])}))}phetCore.register("mutate",mutate);const eo=class eo extends EnumerationValue{static fromLayoutOrientation(e){return e==="horizontal"?eo.HORIZONTAL:eo.VERTICAL}constructor(e,t,n,r,s,a,l,d,c,y,m,O,D,z,w,N,H,X,ae){super(),this.coordinate=e,this.centerCoordinate=t,this.minCoordinate=n,this.maxCoordinate=r,this.minSide=s,this.maxSide=a,this.minSize=l,this.maxSize=d,this.rectCoordinate=c,this.rectSize=y,this.flowBoxOrientation=m,this.size=O,this.line=D,this.preferredSize=z,this.localPreferredSize=w,this.sizable=N,this.ariaOrientation=m,this.modelToView=H,this.viewToModel=X,this.toVector=ae}};eo.HORIZONTAL=new eo("x","centerX","minX","maxX","left","right","minWidth","maxWidth","rectX","rectWidth","horizontal","width","column","preferredWidth","localPreferredWidth","widthSizable",(e,t)=>e.modelToViewX(t),(e,t)=>e.viewToModelX(t),(e,t,n)=>new n(e,t,0,0)),eo.VERTICAL=new eo("y","centerY","minY","maxY","top","bottom","minHeight","maxHeight","rectY","rectHeight","vertical","height","row","preferredHeight","localPreferredHeight","heightSizable",(e,t)=>e.modelToViewY(t),(e,t)=>e.viewToModelY(t),(e,t,n)=>new n(t,e,0,0)),eo.enumeration=new Enumeration(eo,{phetioDocumentation:"Horizontal or vertical orientation"});let Orientation=eo;Orientation.HORIZONTAL.opposite=Orientation.VERTICAL;Orientation.VERTICAL.opposite=Orientation.HORIZONTAL;phetCore.register("Orientation",Orientation);class OrientationPair extends EnumerationMap{constructor(e,t){super(Orientation,n=>n===Orientation.HORIZONTAL?e:t)}get horizontal(){return this.get(Orientation.HORIZONTAL)}set horizontal(e){this.set(Orientation.HORIZONTAL,e)}get vertical(){return this.get(Orientation.VERTICAL)}set vertical(e){this.set(Orientation.VERTICAL,e)}with(e,t){return new OrientationPair(e===Orientation.HORIZONTAL?t:this.horizontal,e===Orientation.VERTICAL?t:this.vertical)}static create(e){return new OrientationPair(e(Orientation.HORIZONTAL),e(Orientation.VERTICAL))}map(e){return new OrientationPair(e(this.horizontal,Orientation.HORIZONTAL),e(this.vertical,Orientation.VERTICAL))}}phetCore.register("OrientationPair",OrientationPair);function pairs(o){const e=[],t=o.length;if(t>1)for(let n=0;n<t-1;n++){const r=o[n];for(let s=n+1;s<t;s++)e.push([r,o[s]])}return e}phetCore.register("pairs",pairs);function partition(o,e){assert&&assert(Array.isArray(o));const t=[],n=[],r=o.length;for(let s=0;s<r;s++)e(o[s])?t.push(o[s]):n.push(o[s]);return[t,n]}phetCore.register("partition",partition);const PhysicalConstants={GRAVITATIONAL_CONSTANT:66743e-15,GRAVITY_ON_EARTH:9.81};phetCore.register("PhysicalConstants",PhysicalConstants);const ua=navigator.userAgent;function isIE(o){return getInternetExplorerVersion()===o}function isMobileSafari(){return!!(window.phet&&phet.chipper&&phet.chipper.queryParameters&&phet.chipper.queryParameters["phet-app"]||(ua.match(/(iPod|iPhone|iPad)/)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>=2)&&ua.match(/AppleWebKit/))}function getInternetExplorerVersion(){let o=-1,e=null;return navigator.appName==="Microsoft Internet Explorer"?(e=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"),e.exec(ua)!==null&&(o=parseFloat(RegExp.$1))):navigator.appName==="Netscape"&&(e=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),e.exec(ua)!==null&&(o=parseFloat(RegExp.$1))),o}const platform={firefox:ua.toLowerCase().includes("firefox"),mobileSafari:isMobileSafari(),safari5:!!(ua.match(/Version\/5\./)&&ua.match(/Safari\//)&&ua.match(/AppleWebKit/)),safari6:!!(ua.match(/Version\/6\./)&&ua.match(/Safari\//)&&ua.match(/AppleWebKit/)),safari7:!!(ua.match(/Version\/7\./)&&ua.match(/Safari\//)&&ua.match(/AppleWebKit/)),safari10:!!(ua.match(/Version\/10\./)&&ua.match(/Safari\//)&&ua.match(/AppleWebKit/)),safari11:!!(ua.match(/Version\/11\./)&&ua.match(/Safari\//)&&ua.match(/AppleWebKit/)),safari9:!!(ua.match(/Version\/9\./)&&ua.match(/Safari\//)&&ua.match(/AppleWebKit/)),safari:isMobileSafari()||!!(ua.match(/Version\//)&&ua.match(/Safari\//)&&ua.match(/AppleWebKit/)),ie:getInternetExplorerVersion()!==-1,ie9:isIE(9),ie10:isIE(10),ie11:isIE(11),android:ua.indexOf("Android")>0,edge:!!ua.match(/Edge\//),chromium:/chrom(e|ium)/.test(ua.toLowerCase())&&!ua.match(/Edge\//),chromeOS:ua.indexOf("CrOS")>0,mac:navigator.platform.includes("Mac")};phetCore.register("platform",platform);class Pool{constructor(e,...t){this.objects=[];const n=optionize()({defaultArguments:[],initialize:e.prototype.initialize,maxSize:100,initialSize:0,useDefaultConstruction:!1},t[0]);for(assert&&assert(n.maxSize>=0),assert&&assert(n.initialSize>=0),this._maxPoolSize=n.maxSize,this.partialConstructor=Function.prototype.bind.bind(e,e),this.DefaultConstructor=this.partialConstructor(...n.defaultArguments),this.initialize=n.initialize,assert&&assert(this.initialize,"Either pass in an initialize option, or provide a method named initialize on the type with the proper signature"),this.useDefaultConstruction=n.useDefaultConstruction;this.objects.length<n.initialSize;)this.objects.push(this.createDefaultObject())}createDefaultObject(){return new this.DefaultConstructor}fetch(){return this.objects.length?this.objects.pop():this.createDefaultObject()}create(...e){let t;return this.objects.length?(t=this.objects.pop(),this.initialize.apply(t,e)):this.useDefaultConstruction?(t=this.createDefaultObject(),this.initialize.apply(t,e)):t=new(this.partialConstructor(...e)),t}get poolSize(){return this.objects.length}set maxPoolSize(e){assert&&assert(e===Number.POSITIVE_INFINITY||Number.isInteger(e)&&e>=0,"maxPoolSize should be a non-negative integer or infinity"),this._maxPoolSize=e}get maxPoolSize(){return this._maxPoolSize}freeToPool(e){this.objects.length<this.maxPoolSize&&this.objects.push(e)}forEach(e){this.objects.forEach(e)}}phetCore.register("Pool",Pool);const Poolable={mixInto(o,e){const t=optionize()({defaultArguments:[],initialize:o.prototype.initialize,maxSize:100,initialSize:0,useDefaultConstruction:!1},e);assert&&assert(t.maxSize>=0),assert&&assert(t.initialSize>=0);const n=[];let r=t.maxSize;const s=Function.prototype.bind.bind(o,o),a=s(...t.defaultArguments),l=t.initialize,d=t.useDefaultConstruction,c=o.prototype;for(extend(o,{pool:n,dirtyFromPool(){return n.length?n.pop():new a},createFromPool(...y){let m;return n.length?(m=n.pop(),l.apply(m,y)):d?(m=new a,l.apply(m,y)):m=new(s(...y)),m},get poolSize(){return n.length},set maxPoolSize(y){assert&&assert(y===Number.POSITIVE_INFINITY||Number.isInteger(y)&&y>=0,"maxPoolSize should be a non-negative integer or infinity"),r=y},get maxPoolSize(){return r}}),extend(c,{freeToPool(){n.length<r&&n.push(this)}});n.length<t.initialSize;)n.push(new a);return o}};phetCore.register("Poolable",Poolable);function required(o){return assert&&assert(o!==void 0,"Required field is undefined."),o}phetCore.register("required",required);function stripEmbeddingMarks(o){return o.replace(/\u202a|\u202b|\u202c/g,"")}phetCore.register("stripEmbeddingMarks",stripEmbeddingMarks);const placeholderObject={};function swapObjectKeys(o,e,t){const n=placeholderObject;let r=n,s=n;return o.hasOwnProperty(e)&&(r=o[e]),o.hasOwnProperty(t)&&(s=o[t]),r!==placeholderObject?o[t]=r:delete o[t],s!==placeholderObject?o[e]=s:delete o[e],o}phetCore.register("swapObjectKeys",swapObjectKeys);const axon=new Namespace("axon"),TYPEOF_STRINGS=["string","number","boolean","function"],VALIDATOR_KEYS=["valueType","validValues","valueComparisonStrategy","isValidValue","phetioType","validators"],An=class An{static getValidatorValidationError(e){if(!(e instanceof Object))return"validator must be an Object";if(!(e.hasOwnProperty("isValidValue")||e.hasOwnProperty("valueType")||e.hasOwnProperty("validValues")||e.hasOwnProperty("valueComparisonStrategy")||e.hasOwnProperty("phetioType")||e.hasOwnProperty("validators")))return this.combineErrorMessages(`validator must have at least one of: ${VALIDATOR_KEYS.join(",")}`,e.validationMessage);if(e.hasOwnProperty("valueType")){const t=An.getValueOrElementTypeValidationError(e.valueType);if(t)return this.combineErrorMessages(`Invalid valueType: ${e.valueType}, error: ${t}`,e.validationMessage)}if(e.hasOwnProperty("isValidValue")&&!(typeof e.isValidValue=="function"||e.isValidValue===null||e.isValidValue===void 0))return this.combineErrorMessages(`isValidValue must be a function: ${e.isValidValue}`,e.validationMessage);if(e.hasOwnProperty("valueComparisonStrategy")&&!(e.valueComparisonStrategy==="reference"||e.valueComparisonStrategy==="lodashDeep"||e.valueComparisonStrategy==="equalsFunction"||typeof e.isValidValue=="function"))return this.combineErrorMessages(`valueComparisonStrategy must be "reference", "lodashDeep", 
        "equalsFunction", or a comparison function: ${e.valueComparisonStrategy}`,e.validationMessage);if(e.validValues!==void 0&&e.validValues!==null){if(!Array.isArray(e.validValues))return this.combineErrorMessages(`validValues must be an array: ${e.validValues}`,e.validationMessage);const t=_.omit(e,"validValues");if(An.containsValidatorKey(t))for(let n=0;n<e.validValues.length;n++){const r=e.validValues[n],s=An.getValidationError(r,t);if(s)return this.combineErrorMessages(`Item not valid in validValues: ${r}, error: ${s}`,e.validationMessage)}}if(e.hasOwnProperty("phetioType")){if(!e.phetioType)return this.combineErrorMessages("falsey phetioType provided",e.validationMessage);if(!e.phetioType.validator)return this.combineErrorMessages(`validator needed for phetioType: ${e.phetioType.typeName}`,e.validationMessage);const t=An.getValidatorValidationError(e.phetioType.validator);if(t)return this.combineErrorMessages(t,e.validationMessage)}if(e.hasOwnProperty("validators")){const t=e.validators;for(let n=0;n<t.length;n++){const r=t[n],s=An.getValidatorValidationError(r);if(s)return this.combineErrorMessages(`validators[${n}] invalid: ${s}`,e.validationMessage)}}return null}static getValueTypeValidatorValidationError(e){return typeof e=="function"||typeof e=="string"||e instanceof EnumerationDeprecated||e===null||e===void 0?typeof e=="string"&&!_.includes(TYPEOF_STRINGS,e)?`valueType not a supported primitive types: ${e}`:null:`valueType must be {function|string|EnumerationDeprecated|null|undefined}, valueType=${e}`}static validateValidator(e){if(assert){const t=An.getValidatorValidationError(e);t&&assert(!1,t)}}static containsValidatorKey(e){if(!(e instanceof Object))return!1;for(let t=0;t<VALIDATOR_KEYS.length;t++)if(e.hasOwnProperty(VALIDATOR_KEYS[t]))return!0;return!1}static combineErrorMessages(e,t){return t&&(e=`${typeof t=="function"?t():t}: ${e}`),e}static isValueValid(e,t,n){return this.getValidationError(e,t,n)===null}static getValidationError(e,t,n){const r=optionize()({validateValidator:!0},n);if(r.validateValidator){const s=An.getValidatorValidationError(t);if(s)return s}if(t.hasOwnProperty("valueType")){const s=t.valueType;if(Array.isArray(s)){if(!_.some(s.map(a=>!An.getValueTypeValidationError(e,a,t.validationMessage))))return this.combineErrorMessages(`value not valid for any valueType in ${s.toString().substring(0,100)}, value: ${e}`,t.validationMessage)}else if(s){const a=An.getValueTypeValidationError(e,s,t.validationMessage);if(a)return a}}if(t.validValues){const s=t.valueComparisonStrategy||"reference";if(!t.validValues.some(l=>{if(s==="reference")return l===e;if(s==="equalsFunction"){const d=l;return assert&&assert(!!d.equals,"no equals function for 1st arg"),assert&&assert(!!e.equals,"no equals function for 2nd arg"),assert&&assert(d.equals(e)===e.equals(d),"incompatible equality checks"),d.equals(e)}return s==="lodashDeep"?_.isEqual(l,e):s(l,e)}))return this.combineErrorMessages(`value not in validValues: ${e}`,t.validationMessage)}if(t.hasOwnProperty("isValidValue")&&!t.isValidValue(e))return this.combineErrorMessages(`value failed isValidValue: ${e}`,t.validationMessage);if(t.hasOwnProperty("phetioType")){const s=An.getValidationError(e,t.phetioType.validator,r);if(s)return this.combineErrorMessages(`value failed phetioType validator: ${e}, error: ${s}`,t.validationMessage)}if(t.hasOwnProperty("validators")){const s=t.validators;for(let a=0;a<s.length;a++){const l=s[a],d=An.getValidationError(e,l,r);if(d)return this.combineErrorMessages(`Failed validation for validators[${a}]: ${d}`,t.validationMessage)}}return null}static getValueTypeValidationError(e,t,n){return typeof t=="string"&&typeof e!==t?this.combineErrorMessages(`value should have typeof ${t}, value=${e}`,n):t===Array&&!Array.isArray(e)?this.combineErrorMessages(`value should have been an array, value=${e}`,n):t instanceof EnumerationDeprecated&&!t.includes(e)?this.combineErrorMessages(`value is not a member of EnumerationDeprecated ${t}`,n):typeof t=="function"&&!(e instanceof t)?this.combineErrorMessages(`value should be instanceof ${t.name}, value=${e}`,n):t===null&&e!==null?this.combineErrorMessages(`value should be null, value=${e}`,n):null}static getValueOrElementTypeValidationError(e){if(Array.isArray(e))for(let t=0;t<e.length;t++){const n=e[t],r=An.getValueTypeValidatorValidationError(n);if(r)return`Array value invalid: ${r}`}else if(e){const t=An.getValueTypeValidatorValidationError(e);if(t)return`Value type invalid: ${t}`}return null}};An.VALIDATOR_KEYS=VALIDATOR_KEYS,An.STRING_WITHOUT_TEMPLATE_VARS_VALIDATOR={valueType:"string",isValidValue:e=>!/\{\{\w*\}\}/.test(e)};let Validation=An;axon.register("Validation",Validation);const validate=(o,e,t)=>{if(assert){const n=Validation.getValidationError(o,e,t);if(n){const r=_.pick(e,Validation.VALIDATOR_KEYS);r.phetioType&&(r.phetioType=_.pick(e.phetioType,["validator","typeName"]));const s=JSON.stringify(r,null,2);assert&&assert(!1,"validation failed for value:",o,n,"prunedValidator:",s)}}};axon.register("validate",validate);const tandemNamespace=new Namespace("tandem"),PhetioConstants={IO_TYPE_SUFFIX:"IO"};tandemNamespace.register("PhetioConstants",PhetioConstants);const OBJECT_IO_TYPE_NAME="ObjectIO",EVENT_TYPE_MODEL="MODEL",metadataDefaults={phetioTypeName:OBJECT_IO_TYPE_NAME,phetioDocumentation:"",phetioState:!0,phetioReadOnly:!1,phetioEventType:EVENT_TYPE_MODEL,phetioHighFrequency:!1,phetioPlayback:!1,phetioDynamicElement:!1,phetioIsArchetype:!1,phetioFeatured:!1,phetioDesigned:!1,phetioArchetypePhetioID:null},BASE_TANDEM_CHARACTER_CLASS="a-zA-Z0-9[\\],",BASE_DYNAMIC_TANDEM_CHARACTER_CLASS=`${BASE_TANDEM_CHARACTER_CLASS}_`,BASE_DERIVED_TANDEM_CHARACTER_CLASS=`${BASE_DYNAMIC_TANDEM_CHARACTER_CLASS}\\-`,TandemConstants={OBJECT_IO_TYPE_NAME,EVENT_TYPE_MODEL,PHET_IO_OBJECT_METADATA_DEFAULTS:metadataDefaults,METADATA_KEY_NAME:"_metadata",DATA_KEY_NAME:"_data",BASE_TANDEM_CHARACTER_CLASS,BASE_DYNAMIC_TANDEM_CHARACTER_CLASS,BASE_DERIVED_TANDEM_CHARACTER_CLASS};tandemNamespace.register("TandemConstants",TandemConstants);class StateSchema{constructor(e){assert&&assertMutuallyExclusiveOptions(e,["compositeSchema"],["displayString","validator"]);const t=optionize()({displayString:"",validator:null,compositeSchema:null},e);this.displayString=t.displayString,this.validator=t.validator,this.compositeSchema=t.compositeSchema}defaultApplyState(e,t){assert&&assert(this.isComposite(),"defaultApplyState from stateSchema only applies to composite stateSchemas");for(const n in this.compositeSchema)if(this.compositeSchema.hasOwnProperty(n)){assert&&assert(t.hasOwnProperty(n),`stateObject does not have expected schema key: ${n}`);const r=this.compositeSchema[n],s=this.getCoreObjectAccessorName(n,e);r.defaultDeserializationMethod==="fromStateObject"?e[s]=this.compositeSchema[n].fromStateObject(t[n]):(assert&&assert(r.defaultDeserializationMethod==="applyState","unexpected deserialization method"),this.compositeSchema[n].applyState(e[s],t[n]))}}defaultToStateObject(e){assert&&assert(this.isComposite(),"defaultToStateObject from stateSchema only applies to composite stateSchemas");const t={};for(const n in this.compositeSchema)if(this.compositeSchema.hasOwnProperty(n)){const r=this.getCoreObjectAccessorName(n,e);if(assert){const s=Object.getOwnPropertyDescriptor(e,r);let a=!1;if(e.constructor.prototype){const d=Object.getOwnPropertyDescriptor(e.constructor.prototype,r);a=!!d&&!!d.get}const l=!!s&&s.hasOwnProperty("value")&&s.writable;assert&&assert(l||a,`cannot get state because coreObject does not have expected schema key: ${r}`)}t[n]=this.compositeSchema[n].toStateObject(e[r])}return t}getCoreObjectAccessorName(e,t){assert&&assert(!e.startsWith("__"),"State keys should not start with too many underscores: "+e+". When serializing ",t);const n=e.startsWith("_")?e.substring(1):e,r=`_${n}`;let s;return t.hasOwnProperty(r)?s=r:s=n,s}isComposite(){return!!this.compositeSchema}checkStateObjectValid(e,t,n){if(this.isComposite()){const r=e,s=this.compositeSchema;let a=null;return r?(Object.keys(s).forEach(d=>{typeof d=="string"?(r.hasOwnProperty(d)?s[d].isStateObjectValid(r[d],!1)||(assert&&t&&assert(!1,`stateObject is not valid for ${d}. stateObject=`,r[d],"schema=",s[d]),a=!1):(assert&&t&&assert(!1,`${d} in state schema but not in the state object`),a=!1),n.push(d)):(console.error("key should be a string",d),assert&&assert(!1,"key should be a string"))}),a):(assert&&t&&assert(!1,"There was no stateObject, but there was a state schema saying there should be",s),a=!1,a)}else{assert&&assert(this.validator,"validator must be present if not composite");const r=e;if(assert&&t){const s=Validation.getValidationError(r,this.validator);assert(s===null,"valueStateObject failed validation",r,s)}return Validation.isValueValid(r,this.validator)}}getRelatedTypes(){const e=[];return this.compositeSchema&&Object.keys(this.compositeSchema).forEach(n=>{this.compositeSchema[n]instanceof IOType&&e.push(this.compositeSchema[n])}),e}getStateSchemaAPI(){return this.isComposite()?_.mapValues(this.compositeSchema,e=>e.typeName):this.displayString}static asValue(e,t){return assert&&assert(t,"validator required"),new StateSchema({validator:t,displayString:e})}}tandemNamespace.register("StateSchema",StateSchema);const VALIDATE_OPTIONS_FALSE$3={validateValidator:!1},getCoreTypeName=o=>{const e=o.indexOf(PhetioConstants.IO_TYPE_SUFFIX);return assert&&assert(e>=0,"IO should be in the type name"),o.substring(0,e)};class IOType{constructor(e,t){this.typeName=e;const n=t.supertype||IOType.ObjectIO,r=!!t.toStateObject,s=!!t.applyState,a=!!t.stateSchema,l=optionize()({supertype:IOType.ObjectIO,methods:{},events:[],metadataDefaults:{},dataDefaults:{},methodOrder:[],parameterTypes:[],documentation:`PhET-iO Type for ${getCoreTypeName(e)}`,isFunctionType:!1,toStateObject:n&&n.toStateObject,fromStateObject:n&&n.fromStateObject,stateObjectToCreateElementArguments:n&&n.stateObjectToCreateElementArguments,applyState:n&&n.applyState,stateSchema:null,defaultDeserializationMethod:"fromStateObject",addChildElement:n&&n.addChildElement},t);if(assert&&n&&Object.keys(l.metadataDefaults).forEach(d=>{assert&&n.getAllMetadataDefaults().hasOwnProperty(d)&&assert(n.getAllMetadataDefaults()[d]!==l.metadataDefaults[d],`${d} should not have the same default value as the ancestor metadata default.`)}),this.supertype=n,this.documentation=l.documentation,this.methods=l.methods,this.events=l.events,this.metadataDefaults=l.metadataDefaults,this.dataDefaults=l.dataDefaults,this.methodOrder=l.methodOrder,this.parameterTypes=l.parameterTypes,this.validator=_.pick(l,Validation.VALIDATOR_KEYS),this.validator.validationMessage=this.validator.validationMessage||`Validation failed IOType Validator: ${this.typeName}`,this.defaultDeserializationMethod=l.defaultDeserializationMethod,l.stateSchema===null||l.stateSchema instanceof StateSchema)this.stateSchema=l.stateSchema;else{const d=typeof l.stateSchema=="function"?l.stateSchema(this):l.stateSchema;this.stateSchema=new StateSchema({compositeSchema:d})}if(assert&&assert(!this.stateSchema||r||this.stateSchema.isComposite(),"toStateObject method must be provided for value StateSchemas"),this.toStateObject=d=>{validate(d,this.validator,VALIDATE_OPTIONS_FALSE$3);let c;return!r&&a&&this.stateSchema&&this.stateSchema.isComposite()?c=this.defaultToStateObject(d):c=l.toStateObject(d),(r||a)&&assert&&this.validateStateObject(c),c},this.fromStateObject=l.fromStateObject,this.stateObjectToCreateElementArguments=l.stateObjectToCreateElementArguments,this.applyState=(d,c)=>{validate(d,this.validator,VALIDATE_OPTIONS_FALSE$3),(s||a)&&assert&&d.phetioType&&d.phetioType.validateStateObject(c),!s&&a&&this.stateSchema&&this.stateSchema.isComposite()?this.defaultApplyState(d,c):l.applyState(d,c)},this.isFunctionType=l.isFunctionType,this.addChildElement=l.addChildElement,assert)if(assert&&assert(n||this.typeName==="ObjectIO","supertype is required"),assert&&assert(!this.typeName.includes("."),"Dots should not appear in type names"),assert&&assert(this.typeName.split(/[<(]/)[0].endsWith(PhetioConstants.IO_TYPE_SUFFIX),`IOType name must end with ${PhetioConstants.IO_TYPE_SUFFIX}`),assert&&assert(this.hasOwnProperty("typeName"),"this.typeName is required"),this.methods&&Object.values(this.methods).forEach(d=>{typeof d=="object"&&assert&&d.invocableForReadOnlyElements&&assert(typeof d.invocableForReadOnlyElements=="boolean",`invocableForReadOnlyElements must be of type boolean: ${d.invocableForReadOnlyElements}`)}),assert&&assert(this.documentation.length>0,"documentation must be provided"),this.methods&&this.hasOwnProperty("methodOrder")&&this.methodOrder.forEach(d=>{assert&&assert(this.methods[d],`methodName not in public methods: ${d}`)}),n){const d=n.getTypeHierarchy();assert&&this.events&&this.events.forEach(c=>{assert&&assert(!_.some(d,y=>y.events.includes(c)),`IOType should not declare event that parent also has: ${c}`)})}else assert&&assert(typeof l.toStateObject=="function","toStateObject must be defined"),assert&&assert(typeof l.fromStateObject=="function","fromStateObject must be defined"),assert&&assert(typeof l.stateObjectToCreateElementArguments=="function","stateObjectToCreateElementArguments must be defined"),assert&&assert(typeof l.applyState=="function","applyState must be defined")}defaultToStateObject(e){let t={};return this.supertype&&(t=this.supertype.defaultToStateObject(e)),this.stateSchema&&this.stateSchema.isComposite()?_.merge(t,this.stateSchema.defaultToStateObject(e)):t}defaultApplyState(e,t){this.supertype&&this.supertype.defaultApplyState(e,t),this.stateSchema&&this.stateSchema.isComposite()&&this.stateSchema.defaultApplyState(e,t)}getTypeHierarchy(){const e=[];let t=this;for(;t;)e.push(t),t=t.supertype;return e}extends(e){return this.getTypeHierarchy().includes(e)}getAllMetadataDefaults(){return _.merge({},this.supertype?this.supertype.getAllMetadataDefaults():{},this.metadataDefaults)}getAllDataDefaults(){return _.merge({},this.supertype?this.supertype.getAllDataDefaults():{},this.dataDefaults)}isStateObjectValid(e,t=!1,n=[]){let r=!0;if(this.stateSchema){const s=this.stateSchema.checkStateObjectValid(e,t,n);if(s!==null)return s}return this.supertype?r&&this.supertype.isStateObjectValid(e,t,n):!this.supertype&&e&&typeof e!="string"&&!Array.isArray(e)?(Object.keys(e).forEach(s=>{const a=n.includes(s);a||(r=!1),assert&&t&&assert(a,`stateObject provided a key that is not in the schema: ${s}`)}),r):!0}validateStateObject(e){this.isStateObjectValid(e,!0)}toString(){return this.typeName}}const DEFAULT_STATE=null;IOType.ObjectIO=new IOType(TandemConstants.OBJECT_IO_TYPE_NAME,{isValidValue:()=>!0,supertype:null,documentation:"The root of the PhET-iO Type hierarchy",toStateObject:o=>(phet&&phet.tandem&&phet.tandem.Tandem.VALIDATION&&(assert&&assert(o.tandem,"coreObject must be PhET-iO object"),assert&&assert(!o.phetioState,`fell back to root serialization state for ${o.tandem.phetioID}. Potential solutions:
         * mark the type as phetioState: false
         * create a custom toStateObject method in your IOType
         * perhaps you have everything right, but forgot to pass in the IOType via phetioType in the constructor`)),DEFAULT_STATE),fromStateObject:()=>{throw new Error("ObjectIO.fromStateObject should not be called")},stateObjectToCreateElementArguments:()=>[],applyState:_.noop,metadataDefaults:TandemConstants.PHET_IO_OBJECT_METADATA_DEFAULTS,dataDefaults:{initialState:DEFAULT_STATE},stateSchema:null});tandemNamespace.register("IOType",IOType);const InfiniteNumberIO=new IOType("InfiniteNumberIO",{valueType:"number",documentation:"PhET-iO Type for Javascript's number primitive type",toStateObject:o=>o===Number.POSITIVE_INFINITY?"POSITIVE_INFINITY":o===Number.NEGATIVE_INFINITY?"NEGATIVE_INFINITY":o,fromStateObject:o=>o==="POSITIVE_INFINITY"?Number.POSITIVE_INFINITY:o==="NEGATIVE_INFINITY"?Number.NEGATIVE_INFINITY:o,stateSchema:StateSchema.asValue("'POSITIVE_INFINITY'|'NEGATIVE_INFINITY'|number",{isValidValue:o=>o==="POSITIVE_INFINITY"||o==="NEGATIVE_INFINITY"||typeof o=="number"&&!isNaN(o)})});tandemNamespace.register("InfiniteNumberIO",InfiniteNumberIO);const NumberIO=new IOType("NumberIO",{valueType:"number",documentation:"PhET-iO Type for Javascript's number primitive type",toStateObject:_.identity,fromStateObject:o=>o,stateSchema:StateSchema.asValue("number",{isValidValue:o=>typeof o=="number"&&!isNaN(o)&&o!==Number.POSITIVE_INFINITY&&o!==Number.NEGATIVE_INFINITY})});tandemNamespace.register("NumberIO",NumberIO);const dot=new Namespace("dot");dot.register("FastArray",window.Float64Array?window.Float64Array:window.Array);var DP=20,RM=1,MAX_DP=1e6,MAX_POWER=1e6,NE=-7,PE=21,STRICT=!1,NAME$1="[big.js] ",INVALID=NAME$1+"Invalid ",INVALID_DP=INVALID+"decimal places",INVALID_RM=INVALID+"rounding mode",DIV_BY_ZERO=NAME$1+"Division by zero",P={},UNDEFINED=void 0,NUMERIC=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;function _Big_(){function o(e){var t=this;if(!(t instanceof o))return e===UNDEFINED?_Big_():new o(e);if(e instanceof o)t.s=e.s,t.e=e.e,t.c=e.c.slice();else{if(typeof e!="string"){if(o.strict===!0&&typeof e!="bigint")throw TypeError(INVALID+"value");e=e===0&&1/e<0?"-0":String(e)}parse(t,e)}t.constructor=o}return o.prototype=P,o.DP=DP,o.RM=RM,o.NE=NE,o.PE=PE,o.strict=STRICT,o.roundDown=0,o.roundHalfUp=1,o.roundHalfEven=2,o.roundUp=3,o}function parse(o,e){var t,n,r;if(!NUMERIC.test(e))throw Error(INVALID+"number");for(o.s=e.charAt(0)=="-"?(e=e.slice(1),-1):1,(t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),r=e.length,n=0;n<r&&e.charAt(n)=="0";)++n;if(n==r)o.c=[o.e=0];else{for(;r>0&&e.charAt(--r)=="0";);for(o.e=t-n-1,o.c=[],t=0;n<=r;)o.c[t++]=+e.charAt(n++)}return o}function round(o,e,t,n){var r=o.c;if(t===UNDEFINED&&(t=o.constructor.RM),t!==0&&t!==1&&t!==2&&t!==3)throw Error(INVALID_RM);if(e<1)n=t===3&&(n||!!r[0])||e===0&&(t===1&&r[0]>=5||t===2&&(r[0]>5||r[0]===5&&(n||r[1]!==UNDEFINED))),r.length=1,n?(o.e=o.e-e+1,r[0]=1):r[0]=o.e=0;else if(e<r.length){if(n=t===1&&r[e]>=5||t===2&&(r[e]>5||r[e]===5&&(n||r[e+1]!==UNDEFINED||r[e-1]&1))||t===3&&(n||!!r[0]),r.length=e,n){for(;++r[--e]>9;)if(r[e]=0,e===0){++o.e,r.unshift(1);break}}for(e=r.length;!r[--e];)r.pop()}return o}function stringify$1(o,e,t){var n=o.e,r=o.c.join(""),s=r.length;if(e)r=r.charAt(0)+(s>1?"."+r.slice(1):"")+(n<0?"e":"e+")+n;else if(n<0){for(;++n;)r="0"+r;r="0."+r}else if(n>0)if(++n>s)for(n-=s;n--;)r+="0";else n<s&&(r=r.slice(0,n)+"."+r.slice(n));else s>1&&(r=r.charAt(0)+"."+r.slice(1));return o.s<0&&t?"-"+r:r}P.abs=function(){var o=new this.constructor(this);return o.s=1,o};P.cmp=function(o){var e,t=this,n=t.c,r=(o=new t.constructor(o)).c,s=t.s,a=o.s,l=t.e,d=o.e;if(!n[0]||!r[0])return n[0]?s:r[0]?-a:0;if(s!=a)return s;if(e=s<0,l!=d)return l>d^e?1:-1;for(a=(l=n.length)<(d=r.length)?l:d,s=-1;++s<a;)if(n[s]!=r[s])return n[s]>r[s]^e?1:-1;return l==d?0:l>d^e?1:-1};P.div=function(o){var e=this,t=e.constructor,n=e.c,r=(o=new t(o)).c,s=e.s==o.s?1:-1,a=t.DP;if(a!==~~a||a<0||a>MAX_DP)throw Error(INVALID_DP);if(!r[0])throw Error(DIV_BY_ZERO);if(!n[0])return o.s=s,o.c=[o.e=0],o;var l,d,c,y,m,O=r.slice(),D=l=r.length,z=n.length,w=n.slice(0,l),N=w.length,H=o,X=H.c=[],ae=0,oe=a+(H.e=e.e-o.e)+1;for(H.s=s,s=oe<0?0:oe,O.unshift(0);N++<l;)w.push(0);do{for(c=0;c<10;c++){if(l!=(N=w.length))y=l>N?1:-1;else for(m=-1,y=0;++m<l;)if(r[m]!=w[m]){y=r[m]>w[m]?1:-1;break}if(y<0){for(d=N==l?r:O;N;){if(w[--N]<d[N]){for(m=N;m&&!w[--m];)w[m]=9;--w[m],w[N]+=10}w[N]-=d[N]}for(;!w[0];)w.shift()}else break}X[ae++]=y?c:++c,w[0]&&y?w[N]=n[D]||0:w=[n[D]]}while((D++<z||w[0]!==UNDEFINED)&&s--);return!X[0]&&ae!=1&&(X.shift(),H.e--,oe--),ae>oe&&round(H,oe,t.RM,w[0]!==UNDEFINED),H};P.eq=function(o){return this.cmp(o)===0};P.gt=function(o){return this.cmp(o)>0};P.gte=function(o){return this.cmp(o)>-1};P.lt=function(o){return this.cmp(o)<0};P.lte=function(o){return this.cmp(o)<1};P.minus=P.sub=function(o){var e,t,n,r,s=this,a=s.constructor,l=s.s,d=(o=new a(o)).s;if(l!=d)return o.s=-d,s.plus(o);var c=s.c.slice(),y=s.e,m=o.c,O=o.e;if(!c[0]||!m[0])return m[0]?o.s=-d:c[0]?o=new a(s):o.s=1,o;if(l=y-O){for((r=l<0)?(l=-l,n=c):(O=y,n=m),n.reverse(),d=l;d--;)n.push(0);n.reverse()}else for(t=((r=c.length<m.length)?c:m).length,l=d=0;d<t;d++)if(c[d]!=m[d]){r=c[d]<m[d];break}if(r&&(n=c,c=m,m=n,o.s=-o.s),(d=(t=m.length)-(e=c.length))>0)for(;d--;)c[e++]=0;for(d=e;t>l;){if(c[--t]<m[t]){for(e=t;e&&!c[--e];)c[e]=9;--c[e],c[t]+=10}c[t]-=m[t]}for(;c[--d]===0;)c.pop();for(;c[0]===0;)c.shift(),--O;return c[0]||(o.s=1,c=[O=0]),o.c=c,o.e=O,o};P.mod=function(o){var e,t=this,n=t.constructor,r=t.s,s=(o=new n(o)).s;if(!o.c[0])throw Error(DIV_BY_ZERO);return t.s=o.s=1,e=o.cmp(t)==1,t.s=r,o.s=s,e?new n(t):(r=n.DP,s=n.RM,n.DP=n.RM=0,t=t.div(o),n.DP=r,n.RM=s,this.minus(t.times(o)))};P.neg=function(){var o=new this.constructor(this);return o.s=-o.s,o};P.plus=P.add=function(o){var e,t,n,r=this,s=r.constructor;if(o=new s(o),r.s!=o.s)return o.s=-o.s,r.minus(o);var a=r.e,l=r.c,d=o.e,c=o.c;if(!l[0]||!c[0])return c[0]||(l[0]?o=new s(r):o.s=r.s),o;if(l=l.slice(),e=a-d){for(e>0?(d=a,n=c):(e=-e,n=l),n.reverse();e--;)n.push(0);n.reverse()}for(l.length-c.length<0&&(n=c,c=l,l=n),e=c.length,t=0;e;l[e]%=10)t=(l[--e]=l[e]+c[e]+t)/10|0;for(t&&(l.unshift(t),++d),e=l.length;l[--e]===0;)l.pop();return o.c=l,o.e=d,o};P.pow=function(o){var e=this,t=new e.constructor("1"),n=t,r=o<0;if(o!==~~o||o<-MAX_POWER||o>MAX_POWER)throw Error(INVALID+"exponent");for(r&&(o=-o);o&1&&(n=n.times(e)),o>>=1,!!o;)e=e.times(e);return r?t.div(n):n};P.prec=function(o,e){if(o!==~~o||o<1||o>MAX_DP)throw Error(INVALID+"precision");return round(new this.constructor(this),o,e)};P.round=function(o,e){if(o===UNDEFINED)o=0;else if(o!==~~o||o<-MAX_DP||o>MAX_DP)throw Error(INVALID_DP);return round(new this.constructor(this),o+this.e+1,e)};P.sqrt=function(){var o,e,t,n=this,r=n.constructor,s=n.s,a=n.e,l=new r("0.5");if(!n.c[0])return new r(n);if(s<0)throw Error(NAME$1+"No square root");s=Math.sqrt(n+""),s===0||s===1/0?(e=n.c.join(""),e.length+a&1||(e+="0"),s=Math.sqrt(e),a=((a+1)/2|0)-(a<0||a&1),o=new r((s==1/0?"5e":(s=s.toExponential()).slice(0,s.indexOf("e")+1))+a)):o=new r(s+""),a=o.e+(r.DP+=4);do t=o,o=l.times(t.plus(n.div(t)));while(t.c.slice(0,a).join("")!==o.c.slice(0,a).join(""));return round(o,(r.DP-=4)+o.e+1,r.RM)};P.times=P.mul=function(o){var e,t=this,n=t.constructor,r=t.c,s=(o=new n(o)).c,a=r.length,l=s.length,d=t.e,c=o.e;if(o.s=t.s==o.s?1:-1,!r[0]||!s[0])return o.c=[o.e=0],o;for(o.e=d+c,a<l&&(e=r,r=s,s=e,c=a,a=l,l=c),e=new Array(c=a+l);c--;)e[c]=0;for(d=l;d--;){for(l=0,c=a+d;c>d;)l=e[c]+s[d]*r[c-d-1]+l,e[c--]=l%10,l=l/10|0;e[c]=l}for(l?++o.e:e.shift(),d=e.length;!e[--d];)e.pop();return o.c=e,o};P.toExponential=function(o,e){var t=this,n=t.c[0];if(o!==UNDEFINED){if(o!==~~o||o<0||o>MAX_DP)throw Error(INVALID_DP);for(t=round(new t.constructor(t),++o,e);t.c.length<o;)t.c.push(0)}return stringify$1(t,!0,!!n)};P.toFixed=function(o,e){var t=this,n=t.c[0];if(o!==UNDEFINED){if(o!==~~o||o<0||o>MAX_DP)throw Error(INVALID_DP);for(t=round(new t.constructor(t),o+t.e+1,e),o=o+t.e+1;t.c.length<o;)t.c.push(0)}return stringify$1(t,!1,!!n)};P[Symbol.for("nodejs.util.inspect.custom")]=P.toJSON=P.toString=function(){var o=this,e=o.constructor;return stringify$1(o,o.e<=e.NE||o.e>=e.PE,!!o.c[0])};P.toNumber=function(){var o=Number(stringify$1(this,!0,!0));if(this.constructor.strict===!0&&!this.eq(o.toString()))throw Error(NAME$1+"Imprecise conversion");return o};P.toPrecision=function(o,e){var t=this,n=t.constructor,r=t.c[0];if(o!==UNDEFINED){if(o!==~~o||o<1||o>MAX_DP)throw Error(INVALID+"precision");for(t=round(new n(t),o,e);t.c.length<o;)t.c.push(0)}return stringify$1(t,o<=t.e||t.e<=n.NE||t.e>=n.PE,!!r)};P.valueOf=function(){var o=this,e=o.constructor;if(e.strict===!0)throw Error(NAME$1+"valueOf disallowed");return stringify$1(o,o.e<=e.NE||o.e>=e.PE,!0)};var Big=_Big_();const Za=class Za{constructor(e,t,n,r){this.x=e,this.y=t,this.z=n,this.w=r}getMagnitude(){return Math.sqrt(this.magnitudeSquared)}get magnitude(){return this.getMagnitude()}getMagnitudeSquared(){return this.dot(this)}get magnitudeSquared(){return this.getMagnitudeSquared()}distance(e){return this.minus(e).magnitude}distanceXYZW(e,t,n,r){const s=this.x-e,a=this.y-t,l=this.z-n,d=this.w-r;return Math.sqrt(s*s+a*a+l*l+d*d)}distanceSquared(e){return this.minus(e).magnitudeSquared}distanceSquaredXYZW(e,t,n,r){const s=this.x-e,a=this.y-t,l=this.z-n,d=this.w-r;return s*s+a*a+l*l+d*d}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}dotXYZW(e,t,n,r){return this.x*e+this.y*t+this.z*n+this.w*r}angleBetween(e){return Math.acos(dot.clamp(this.normalized().dot(e.normalized()),-1,1))}equals(e){return this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w}equalsEpsilon(e,t){return t||(t=0),Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)+Math.abs(this.w-e.w)<=t}isFinite(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.z)&&isFinite(this.w)}copy(e){return e?e.set(this):v4(this.x,this.y,this.z,this.w)}normalized(){const e=this.magnitude;return assert&&assert(e!==0,"Cannot normalize a zero-magnitude vector"),this.dividedScalar(e)}roundedSymmetric(){return this.copy().roundSymmetric()}withMagnitude(e){return this.copy().setMagnitude(e)}timesScalar(e){return v4(this.x*e,this.y*e,this.z*e,this.w*e)}times(e){return this.timesScalar(e)}componentTimes(e){return v4(this.x*e.x,this.y*e.y,this.z*e.z,this.w*e.w)}plus(e){return v4(this.x+e.x,this.y+e.y,this.z+e.z,this.w+e.w)}plusXYZW(e,t,n,r){return v4(this.x+e,this.y+t,this.z+n,this.w+r)}plusScalar(e){return v4(this.x+e,this.y+e,this.z+e,this.w+e)}minus(e){return v4(this.x-e.x,this.y-e.y,this.z-e.z,this.w-e.w)}minusXYZW(e,t,n,r){return v4(this.x-e,this.y-t,this.z-n,this.w-r)}minusScalar(e){return v4(this.x-e,this.y-e,this.z-e,this.w-e)}dividedScalar(e){return v4(this.x/e,this.y/e,this.z/e,this.w/e)}negated(){return v4(-this.x,-this.y,-this.z,-this.w)}blend(e,t){return this.plus(e.minus(this).times(t))}average(e){return this.blend(e,.5)}toString(){return`Vector4(${this.x}, ${this.y}, ${this.z}, ${this.w})`}toVector3(){return new Vector3(this.x,this.y,this.z)}setXYZW(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}set(e){return this.setXYZW(e.x,e.y,e.z,e.w)}setMagnitude(e){const t=e/this.magnitude;return this.multiplyScalar(t)}add(e){return this.setXYZW(this.x+e.x,this.y+e.y,this.z+e.z,this.w+e.w)}addXYZW(e,t,n,r){return this.setXYZW(this.x+e,this.y+t,this.z+n,this.w+r)}addScalar(e){return this.setXYZW(this.x+e,this.y+e,this.z+e,this.w+e)}subtract(e){return this.setXYZW(this.x-e.x,this.y-e.y,this.z-e.z,this.w-e.w)}subtractXYZW(e,t,n,r){return this.setXYZW(this.x-e,this.y-t,this.z-n,this.w-r)}subtractScalar(e){return this.setXYZW(this.x-e,this.y-e,this.z-e,this.w-e)}multiplyScalar(e){return this.setXYZW(this.x*e,this.y*e,this.z*e,this.w*e)}multiply(e){return this.multiplyScalar(e)}componentMultiply(e){return this.setXYZW(this.x*e.x,this.y*e.y,this.z*e.z,this.w*e.w)}divideScalar(e){return this.setXYZW(this.x/e,this.y/e,this.z/e,this.w/e)}negate(){return this.setXYZW(-this.x,-this.y,-this.z,-this.w)}normalize(){const e=this.magnitude;if(e===0)throw new Error("Cannot normalize a zero-magnitude vector");return this.divideScalar(e)}roundSymmetric(){return this.setXYZW(DotUtils.roundSymmetric(this.x),DotUtils.roundSymmetric(this.y),DotUtils.roundSymmetric(this.z),DotUtils.roundSymmetric(this.w))}freeToPool(){Za.pool.freeToPool(this)}};Za.pool=new Pool(Za,{maxSize:1e3,initialize:Za.prototype.setXYZW,defaultArguments:[0,0,0,0]});let Vector4=Za;Vector4.prototype.isVector4=!0;Vector4.prototype.dimension=4;dot.register("Vector4",Vector4);const v4=Vector4.pool.create.bind(Vector4.pool);dot.register("v4",v4);class ImmutableVector4 extends Vector4{static mutableOverrideHelper(e){ImmutableVector4.prototype[e]=()=>{throw new Error(`Cannot call mutable method '${e}' on immutable Vector3`)}}}ImmutableVector4.mutableOverrideHelper("setXYZW");ImmutableVector4.mutableOverrideHelper("setX");ImmutableVector4.mutableOverrideHelper("setY");ImmutableVector4.mutableOverrideHelper("setZ");ImmutableVector4.mutableOverrideHelper("setW");Vector4.ZERO=assert?new ImmutableVector4(0,0,0,0):new Vector4(0,0,0,0);Vector4.X_UNIT=assert?new ImmutableVector4(1,0,0,0):new Vector4(1,0,0,0);Vector4.Y_UNIT=assert?new ImmutableVector4(0,1,0,0):new Vector4(0,1,0,0);Vector4.Z_UNIT=assert?new ImmutableVector4(0,0,1,0):new Vector4(0,0,1,0);Vector4.W_UNIT=assert?new ImmutableVector4(0,0,0,1):new Vector4(0,0,0,1);const ADDING_ACCUMULATOR$1=(o,e)=>o.add(e),wa=class wa{constructor(e,t,n){this.x=e,this.y=t,this.z=n}getMagnitude(){return Math.sqrt(this.magnitudeSquared)}get magnitude(){return this.getMagnitude()}getMagnitudeSquared(){return this.dot(this)}get magnitudeSquared(){return this.getMagnitudeSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceXYZ(e,t,n){const r=this.x-e,s=this.y-t,a=this.z-n;return Math.sqrt(r*r+s*s+a*a)}distanceSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}distanceSquaredXYZ(e,t,n){const r=this.x-e,s=this.y-t,a=this.z-n;return r*r+s*s+a*a}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}dotXYZ(e,t,n){return this.x*e+this.y*t+this.z*n}angleBetween(e){return Math.acos(DotUtils.clamp(this.normalized().dot(e.normalized()),-1,1))}equals(e){return this.x===e.x&&this.y===e.y&&this.z===e.z}equalsEpsilon(e,t){return t||(t=0),Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)<=t}isFinite(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.z)}copy(e){return e?e.set(this):v3(this.x,this.y,this.z)}cross(e){return v3(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)}normalized(){const e=this.magnitude;if(e===0)throw new Error("Cannot normalize a zero-magnitude vector");return v3(this.x/e,this.y/e,this.z/e)}roundedSymmetric(){return this.copy().roundSymmetric()}withMagnitude(e){return this.copy().setMagnitude(e)}timesScalar(e){return v3(this.x*e,this.y*e,this.z*e)}times(e){return this.timesScalar(e)}componentTimes(e){return v3(this.x*e.x,this.y*e.y,this.z*e.z)}plus(e){return v3(this.x+e.x,this.y+e.y,this.z+e.z)}plusXYZ(e,t,n){return v3(this.x+e,this.y+t,this.z+n)}plusScalar(e){return v3(this.x+e,this.y+e,this.z+e)}minus(e){return v3(this.x-e.x,this.y-e.y,this.z-e.z)}minusXYZ(e,t,n){return v3(this.x-e,this.y-t,this.z-n)}minusScalar(e){return v3(this.x-e,this.y-e,this.z-e)}dividedScalar(e){return v3(this.x/e,this.y/e,this.z/e)}negated(){return v3(-this.x,-this.y,-this.z)}blend(e,t){return this.plus(e.minus(this).times(t))}average(e){return this.blend(e,.5)}static average(e){return _.reduce(e,ADDING_ACCUMULATOR$1,new wa(0,0,0)).divideScalar(e.length)}toString(){return`Vector3(${this.x}, ${this.y}, ${this.z})`}toVector2(){return v2(this.x,this.y)}toVector4(){return v4(this.x,this.y,this.z,1)}toVector4Zero(){return v4(this.x,this.y,this.z,0)}setXYZ(e,t,n){return this.x=e,this.y=t,this.z=n,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}set(e){return this.setXYZ(e.x,e.y,e.z)}setMagnitude(e){const t=e/this.magnitude;return this.multiplyScalar(t)}add(e){return this.setXYZ(this.x+e.x,this.y+e.y,this.z+e.z)}addXYZ(e,t,n){return this.setXYZ(this.x+e,this.y+t,this.z+n)}addScalar(e){return this.setXYZ(this.x+e,this.y+e,this.z+e)}subtract(e){return this.setXYZ(this.x-e.x,this.y-e.y,this.z-e.z)}subtractXYZ(e,t,n){return this.setXYZ(this.x-e,this.y-t,this.z-n)}subtractScalar(e){return this.setXYZ(this.x-e,this.y-e,this.z-e)}multiplyScalar(e){return this.setXYZ(this.x*e,this.y*e,this.z*e)}multiply(e){return this.multiplyScalar(e)}componentMultiply(e){return this.setXYZ(this.x*e.x,this.y*e.y,this.z*e.z)}divideScalar(e){return this.setXYZ(this.x/e,this.y/e,this.z/e)}negate(){return this.setXYZ(-this.x,-this.y,-this.z)}setCross(e){return this.setXYZ(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)}normalize(){const e=this.magnitude;if(e===0)throw new Error("Cannot normalize a zero-magnitude vector");return this.divideScalar(e)}roundSymmetric(){return this.setXYZ(DotUtils.roundSymmetric(this.x),DotUtils.roundSymmetric(this.y),DotUtils.roundSymmetric(this.z))}toStateObject(){return{x:this.x,y:this.y,z:this.z}}freeToPool(){wa.pool.freeToPool(this)}static slerp(e,t,n){return dot.Quaternion.slerp(new dot.Quaternion,dot.Quaternion.getRotationQuaternion(e,t),n).timesVector3(e)}static fromStateObject(e){return v3(e.x,e.y,e.z)}};wa.pool=new Pool(wa,{maxSize:1e3,initialize:wa.prototype.setXYZ,defaultArguments:[0,0,0]});let Vector3=wa;Vector3.prototype.isVector3=!0;Vector3.prototype.dimension=3;dot.register("Vector3",Vector3);const v3=Vector3.pool.create.bind(Vector3.pool);dot.register("v3",v3);class ImmutableVector3 extends Vector3{static mutableOverrideHelper(e){ImmutableVector3.prototype[e]=()=>{throw new Error(`Cannot call mutable method '${e}' on immutable Vector3`)}}}ImmutableVector3.mutableOverrideHelper("setXYZ");ImmutableVector3.mutableOverrideHelper("setX");ImmutableVector3.mutableOverrideHelper("setY");ImmutableVector3.mutableOverrideHelper("setZ");Vector3.ZERO=assert?new ImmutableVector3(0,0,0):new Vector3(0,0,0);Vector3.X_UNIT=assert?new ImmutableVector3(1,0,0):new Vector3(1,0,0);Vector3.Y_UNIT=assert?new ImmutableVector3(0,1,0):new Vector3(0,1,0);Vector3.Z_UNIT=assert?new ImmutableVector3(0,0,1):new Vector3(0,0,1);Vector3.Vector3IO=new IOType("Vector3IO",{valueType:Vector3,documentation:"Basic 3-dimensional vector, represented as (x,y,z)",toStateObject:o=>o.toStateObject(),fromStateObject:Vector3.fromStateObject,stateSchema:{x:NumberIO,y:NumberIO,z:NumberIO}});const EPSILON=Number.MIN_VALUE,TWO_PI$1=2*Math.PI;let generate,z0,z1;const Utils$1={clamp(o,e,t){return o<e?e:o>t?t:o},moduloBetweenDown(o,e,t){assert&&assert(t>e,"max > min required for moduloBetween");const n=t-e;let r=(o-e)%n;return r<0&&(r+=n),r+e},moduloBetweenUp(o,e,t){return-Utils$1.moduloBetweenDown(-o,-t,-e)},rangeInclusive(o,e){if(e<o)return[];const t=new Array(e-o+1);for(let n=o;n<=e;n++)t[n-o]=n;return t},rangeExclusive(o,e){return Utils$1.rangeInclusive(o+1,e-1)},toRadians(o){return Math.PI*o/180},toDegrees(o){return 180*o/Math.PI},mod(o,e){return o/e%1===0?0:o%e},gcd(o,e){return Math.abs(e===0?o:this.gcd(e,Utils$1.mod(o,e)))},lcm(o,e){return Utils$1.roundSymmetric(Math.abs(o*e)/Utils$1.gcd(o,e))},lineLineIntersection(o,e,t,n){if(o.equals(e)||t.equals(n))return null;const s=o.x-e.x,a=t.x-n.x,l=o.y-e.y,d=t.y-n.y,c=s*d-l*a;if(Math.abs(c)<1e-10)return null;const y=o.x*e.y-o.y*e.x,m=t.x*n.y-t.y*n.x;return new Vector2((y*a-s*m)/c,(y*d-l*m)/c)},circleCenterFromPoints(o,e,t){const n=new Vector2((o.x+e.x)/2,(o.y+e.y)/2),r=new Vector2((e.x+t.x)/2,(e.y+t.y)/2),s=new Vector2(n.x+(e.y-o.y),n.y-(e.x-o.x)),a=new Vector2(r.x+(t.y-e.y),r.y-(t.x-e.x));return Utils$1.lineLineIntersection(n,s,r,a)},pointInCircleFromPoints(o,e,t,n){assert&&assert(Utils$1.triangleAreaSigned(o,e,t)>0,"Defined points should be in a counterclockwise order");const r=o.x-n.x,s=o.y-n.y,a=(o.x-n.x)*(o.x-n.x)+(o.y-n.y)*(o.y-n.y),l=e.x-n.x,d=e.y-n.y,c=(e.x-n.x)*(e.x-n.x)+(e.y-n.y)*(e.y-n.y),y=t.x-n.x,m=t.y-n.y,O=(t.x-n.x)*(t.x-n.x)+(t.y-n.y)*(t.y-n.y);return r*d*O+s*c*y+a*l*m-a*d*y-s*l*O-r*c*m>0},sphereRayIntersection(o,e,t){t=t===void 0?1e-5:t;const n=new Vector3(0,0,0),r=e.direction,s=e.position,a=s.minus(n),l=r.dot(a),d=a.magnitudeSquared,c=4*l*l-4*(d-o*o);if(c<t)return null;const y=r.dot(n)-r.dot(s),m=Math.sqrt(c)/2,O=y-m,D=y+m;if(D<t)return null;const z=e.pointAtDistance(D),w=z.minus(n).normalized();if(O<t)return{distance:D,hitPoint:z,normal:w.negated(),fromOutside:!1};{const N=e.pointAtDistance(O),H=N.minus(n).normalized();return{distance:O,hitPoint:N,normal:H,fromOutside:!0}}},solveLinearRootsReal(o,e){return o===0?e===0?null:[]:[-e/o]},solveQuadraticRootsReal(o,e,t){if(o===0||Math.abs(e/o)>1e7||Math.abs(t/o)>1e7)return Utils$1.solveLinearRootsReal(e,t);const r=e*e-4*o*t;if(r<0)return[];const s=Math.sqrt(r);return[(-e-s)/(2*o),(-e+s)/(2*o)]},solveCubicRootsReal(o,e,t,n,r=1e-7){let s;if(o===0)s=Utils$1.solveQuadraticRootsReal(e,t,n);else if(o===0||Math.abs(e/o)>1e7||Math.abs(t/o)>1e7||Math.abs(n/o)>1e7)s=Utils$1.solveQuadraticRootsReal(e,t,n);else if(n===0||Math.abs(o/n)>1e7||Math.abs(e/n)>1e7||Math.abs(t/n)>1e7)s=[0].concat(Utils$1.solveQuadraticRootsReal(o,e,t));else{e/=o,t/=o,n/=o;const l=(3*t-e*e)/9,d=(-(27*n)+e*(9*t-2*(e*e)))/54,c=l*l*l+d*d,y=e/3;if(c>r){const m=Math.sqrt(c);s=[Utils$1.cubeRoot(d+m)+Utils$1.cubeRoot(d-m)-y]}else if(c>-r){const m=Utils$1.cubeRoot(d),O=-y-m;s=[-y+2*m,O,O]}else{let m=-l*l*l;m=Math.acos(d/Math.sqrt(m));const O=2*Math.sqrt(-l);s=[-y+O*Math.cos(m/3),-y+O*Math.cos((m+2*Math.PI)/3),-y+O*Math.cos((m+4*Math.PI)/3)]}}return assert&&s&&s.forEach(a=>assert(isFinite(a),"All returned solveCubicRootsReal roots should be finite")),s},cubeRoot(o){return o>=0?Math.pow(o,1/3):-Math.pow(-o,1/3)},linear(o,e,t,n,r){return assert&&assert(typeof r=="number","linear requires a number to evaluate"),(n-t)/(e-o)*(r-o)+t},roundSymmetric(o){return(o<0?-1:1)*Math.round(Math.abs(o))},toFixed(o,e){if(assert&&assert(typeof o=="number"),assert&&assert(Number.isInteger(e),`decimal places must be an integer: ${e}`),isNaN(o))return"NaN";if(o===Number.POSITIVE_INFINITY)return"Infinity";if(o===Number.NEGATIVE_INFINITY)return"-Infinity";const t=new Big(o).toFixed(e);return t.startsWith("-0.")&&Number.parseFloat(t)===0?"0"+t.slice(2):t},toFixedNumber(o,e){return parseFloat(Utils$1.toFixed(o,e))},equalsEpsilon(o,e,t){return Math.abs(o-e)<=t},lineSegmentIntersection(o,e,t,n,r,s,a,l){const d=(O,D,z,w,N,H)=>(H-D)*(z-O)-(w-D)*(N-O);if(d(o,e,r,s,a,l)*d(t,n,r,s,a,l)>0||d(r,s,o,e,t,n)*d(a,l,o,e,t,n)>0)return null;const c=(o-t)*(s-l)-(e-n)*(r-a);if(Math.abs(c)<1e-10)return null;if(o===r&&e===s||o===a&&e===l)return new Vector2(o,e);if(t===r&&n===s||t===a&&n===l)return new Vector2(t,n);const y=((o*n-e*t)*(r-a)-(o-t)*(r*l-s*a))/c,m=((o*n-e*t)*(s-l)-(e-n)*(r*l-s*a))/c;return new Vector2(y,m)},distToSegmentSquared(o,e,t){const n=e.distanceSquared(t);if(n===0)return o.distanceSquared(e);const r=((o.x-e.x)*(t.x-e.x)+(o.y-e.y)*(t.y-e.y))/n;let s;return r<0?s=o.distanceSquared(e):r>1?s=o.distanceSquared(t):s=o.distanceSquared(new Vector2(e.x+r*(t.x-e.x),e.y+r*(t.y-e.y))),s},distToSegment(o,e,t){return Math.sqrt(this.distToSegmentSquared(o,e,t))},arePointsCollinear(o,e,t,n){return n===void 0&&(n=0),Utils$1.triangleArea(o,e,t)<=n},triangleArea(o,e,t){return Math.abs(Utils$1.triangleAreaSigned(o,e,t))},triangleAreaSigned(o,e,t){return o.x*(e.y-t.y)+e.x*(t.y-o.y)+t.x*(o.y-e.y)},centroidOfPolygon(o){const e=new Vector2(0,0);let t=0;return o.forEach((n,r)=>{const s=o[(r+1)%o.length],a=n.x*s.y-s.x*n.y;t+=a/2,e.addXY((n.x+s.x)*a,(n.y+s.y)*a)}),e.divideScalar(6*t),e},cosh(o){return(Math.exp(o)+Math.exp(-o))/2},sinh(o){return(Math.exp(o)-Math.exp(-o))/2},log10(o){return Math.log(o)/Math.LN10},boxMullerTransform(o,e,t){if(generate=!generate,!generate)return z1*e+o;let n,r;do n=t.nextDouble(),r=t.nextDouble();while(n<=EPSILON);return z0=Math.sqrt(-2*Math.log(n))*Math.cos(TWO_PI$1*r),z1=Math.sqrt(-2*Math.log(n))*Math.sin(TWO_PI$1*r),z0*e+o},numberOfDecimalPlaces(o){if(assert&&assert(typeof o=="number"&&isFinite(o),`value must be a finite number ${o}`),Math.floor(o)===o)return 0;{const e=o.toString();if(e.includes("e")){const t=e.split("e"),n=t[0],r=Number(t[1]),s=n.includes(".")?n.split(".")[1].length:0;return Math.max(s-r,0)}else return e.split(".")[1].length}},roundToInterval(o,e){return Utils$1.toFixedNumber(Utils$1.roundSymmetric(o/e)*e,Utils$1.numberOfDecimalPlaces(e))}};dot.register("Utils",Utils$1);dot.clamp=Utils$1.clamp;dot.moduloBetweenDown=Utils$1.moduloBetweenDown;dot.moduloBetweenUp=Utils$1.moduloBetweenUp;dot.rangeInclusive=Utils$1.rangeInclusive;dot.rangeExclusive=Utils$1.rangeExclusive;dot.toRadians=Utils$1.toRadians;dot.toDegrees=Utils$1.toDegrees;dot.lineLineIntersection=Utils$1.lineLineIntersection;dot.lineSegmentIntersection=Utils$1.lineSegmentIntersection;dot.sphereRayIntersection=Utils$1.sphereRayIntersection;dot.solveQuadraticRootsReal=Utils$1.solveQuadraticRootsReal;dot.solveCubicRootsReal=Utils$1.solveCubicRootsReal;dot.cubeRoot=Utils$1.cubeRoot;dot.linear=Utils$1.linear;dot.boxMullerTransform=Utils$1.boxMullerTransform;const DotUtils=Utils$1,ADDING_ACCUMULATOR=(o,e)=>o.add(e),Bo=class Bo{constructor(e,t){this.x=e,this.y=t}getMagnitude(){return Math.sqrt(this.magnitudeSquared)}get magnitude(){return this.getMagnitude()}getMagnitudeSquared(){return this.x*this.x+this.y*this.y}get magnitudeSquared(){return this.getMagnitudeSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceXY(e,t){const n=this.x-e,r=this.y-t;return Math.sqrt(n*n+r*r)}distanceSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}distanceSquaredXY(e,t){const n=this.x-e,r=this.y-t;return n*n+r*r}dot(e){return this.x*e.x+this.y*e.y}dotXY(e,t){return this.x*e+this.y*t}getAngle(){return Math.atan2(this.y,this.x)}get angle(){return this.getAngle()}angleBetween(e){const t=this.magnitude,n=e.magnitude;return Math.acos(dot.clamp((this.x*e.x+this.y*e.y)/(t*n),-1,1))}equals(e){return this.x===e.x&&this.y===e.y}equalsEpsilon(e,t){return t||(t=0),Math.max(Math.abs(this.x-e.x),Math.abs(this.y-e.y))<=t}isFinite(){return isFinite(this.x)&&isFinite(this.y)}copy(e){return e?e.set(this):v2(this.x,this.y)}crossScalar(e){return this.x*e.y-this.y*e.x}normalized(){const e=this.magnitude;if(e===0)throw new Error("Cannot normalize a zero-magnitude vector");return v2(this.x/e,this.y/e)}roundedSymmetric(){return this.copy().roundSymmetric()}withMagnitude(e){return this.copy().setMagnitude(e)}timesScalar(e){return v2(this.x*e,this.y*e)}times(e){return this.timesScalar(e)}componentTimes(e){return v2(this.x*e.x,this.y*e.y)}plus(e){return v2(this.x+e.x,this.y+e.y)}plusXY(e,t){return v2(this.x+e,this.y+t)}plusScalar(e){return v2(this.x+e,this.y+e)}minus(e){return v2(this.x-e.x,this.y-e.y)}minusXY(e,t){return v2(this.x-e,this.y-t)}minusScalar(e){return v2(this.x-e,this.y-e)}dividedScalar(e){return v2(this.x/e,this.y/e)}negated(){return v2(-this.x,-this.y)}getPerpendicular(){return v2(this.y,-this.x)}get perpendicular(){return this.getPerpendicular()}rotated(e){const t=this.angle+e,n=this.magnitude;return v2(n*Math.cos(t),n*Math.sin(t))}rotateAboutXY(e,t,n){const r=this.x-e,s=this.y-t,a=Math.cos(n),l=Math.sin(n);return this.x=e+r*a-s*l,this.y=t+r*l+s*a,this}rotateAboutPoint(e,t){return this.rotateAboutXY(e.x,e.y,t)}rotatedAboutXY(e,t,n){return v2(this.x,this.y).rotateAboutXY(e,t,n)}rotatedAboutPoint(e,t){return this.rotatedAboutXY(e.x,e.y,t)}blend(e,t){return v2(this.x+(e.x-this.x)*t,this.y+(e.y-this.y)*t)}average(e){return this.blend(e,.5)}static average(e){return _.reduce(e,ADDING_ACCUMULATOR,new Bo(0,0)).divideScalar(e.length)}toString(){return`Vector2(${this.x}, ${this.y})`}toVector3(){return new Vector3(this.x,this.y,0)}setXY(e,t){return this.x=e,this.y=t,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}set(e){return this.setXY(e.x,e.y)}setMagnitude(e){const t=e/this.magnitude;return this.multiplyScalar(t)}add(e){return this.setXY(this.x+e.x,this.y+e.y)}addXY(e,t){return this.setXY(this.x+e,this.y+t)}addScalar(e){return this.setXY(this.x+e,this.y+e)}subtract(e){return this.setXY(this.x-e.x,this.y-e.y)}subtractXY(e,t){return this.setXY(this.x-e,this.y-t)}subtractScalar(e){return this.setXY(this.x-e,this.y-e)}multiplyScalar(e){return this.setXY(this.x*e,this.y*e)}multiply(e){return this.multiplyScalar(e)}componentMultiply(e){return this.setXY(this.x*e.x,this.y*e.y)}divideScalar(e){return this.setXY(this.x/e,this.y/e)}negate(){return this.setXY(-this.x,-this.y)}normalize(){const e=this.magnitude;if(e===0)throw new Error("Cannot normalize a zero-magnitude vector");return this.divideScalar(e)}roundSymmetric(){return this.setXY(DotUtils.roundSymmetric(this.x),DotUtils.roundSymmetric(this.y))}rotate(e){const t=this.angle+e,n=this.magnitude;return this.setXY(n*Math.cos(t),n*Math.sin(t))}setPolar(e,t){return this.setXY(e*Math.cos(t),e*Math.sin(t))}toStateObject(){return{x:this.x,y:this.y}}freeToPool(){Bo.pool.freeToPool(this)}static createPolar(e,t){return new Bo(0,0).setPolar(e,t)}static fromStateObject(e){return v2(e.x,e.y)}static getAngleBetweenVectors(e,t){const n=t.x-e.x,r=t.y-e.y;return Math.atan2(r,n)}static getDistanceBetweenVectors(e,t){const n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)}};Bo.pool=new Pool(Bo,{maxSize:1e3,initialize:Bo.prototype.setXY,defaultArguments:[0,0]});let Vector2=Bo;Vector2.prototype.isVector2=!0;Vector2.prototype.dimension=2;dot.register("Vector2",Vector2);const v2=Vector2.pool.create.bind(Vector2.pool);dot.register("v2",v2);class ImmutableVector2 extends Vector2{static mutableOverrideHelper(e){ImmutableVector2.prototype[e]=()=>{throw new Error(`Cannot call mutable method '${e}' on immutable Vector2`)}}}ImmutableVector2.mutableOverrideHelper("setXY");ImmutableVector2.mutableOverrideHelper("setX");ImmutableVector2.mutableOverrideHelper("setY");Vector2.ZERO=assert?new ImmutableVector2(0,0):new Vector2(0,0);Vector2.X_UNIT=assert?new ImmutableVector2(1,0):new Vector2(1,0);Vector2.Y_UNIT=assert?new ImmutableVector2(0,1):new Vector2(0,1);const STATE_SCHEMA$2={x:NumberIO,y:NumberIO};Vector2.Vector2IO=new IOType("Vector2IO",{valueType:Vector2,stateSchema:STATE_SCHEMA$2,toStateObject:o=>o.toStateObject(),fromStateObject:o=>Vector2.fromStateObject(o),documentation:"A numerical object with x and y properties, like {x:3,y:4}"});const STATE_SCHEMA$1={min:InfiniteNumberIO,max:InfiniteNumberIO},Fn=class Fn{constructor(e,t){this._min=e,this._max=t}getMin(){return this._min}get min(){return this.getMin()}set min(e){this.setMin(e)}setMin(e){assert&&assert(e<=this._max,`min must be <= max: ${e}`),this._min=e}getMax(){return this._max}get max(){return this.getMax()}set max(e){this.setMax(e)}setMax(e){assert&&assert(this._min<=e,`max must be >= to min: ${e}`),this._max=e}setMinMax(e,t){return assert&&assert(e<=t,`max must be >= to min. min: ${e}, max: ${t}`),this._min=e,this._max=t,this}set(e){return this.setMinMax(e.min,e.max),this}addValue(e){this._min=Math.min(this._min,e),this._max=Math.max(this._max,e)}withValue(e){return new Fn(Math.min(this._min,e),Math.max(this._max,e))}copy(){return new Fn(this._min,this._max)}getLength(){return this._max-this._min}getCenter(){return(this._max+this._min)/2}contains(e){return e>=this._min&&e<=this._max}containsRange(e){return this._min<=e.min&&this._max>=e.max}intersects(e){return this._max>=e.min&&e.max>=this._min}intersectsExclusive(e){return this._max>e.min&&e.max>this._min}union(e){return new Fn(Math.min(this.min,e.min),Math.max(this.max,e.max))}intersection(e){return new Fn(Math.max(this.min,e.min),Math.min(this.max,e.max))}includeRange(e){return this.setMinMax(Math.min(this.min,e.min),Math.max(this.max,e.max))}constrainRange(e){return this.setMinMax(Math.max(this.min,e.min),Math.min(this.max,e.max))}shifted(e){return new Fn(this.min+e,this.max+e)}toString(){return`[Range (min:${this._min} max:${this._max})]`}constrainValue(e){return Math.min(Math.max(e,this._min),this._max)}equals(e){return this.constructor===e.constructor&&this._min===e.min&&this._max===e.max}equalsEpsilon(e,t){return this.constructor===e.constructor&&Math.abs(this._min-e.min)<=t&&Math.abs(this._max-e.max)<=t}getNormalizedValue(e){return assert&&assert(this.getLength()!==0,"cannot get normalized value without a range length"),(e-this.min)/this.getLength()}expandNormalizedValue(e){return assert&&assert(this.getLength()!==0,"cannot get expand normalized value without a range length"),e*this.getLength()+this.min}get defaultValue(){throw new Error("defaultValue is undefined, did you mean to use RangeWithValue?")}toStateObject(){return{min:InfiniteNumberIO.toStateObject(this.min),max:InfiniteNumberIO.toStateObject(this.max)}}clampDelta(e,t){return assert&&assert(this.contains(e)),e+t<this.min?this.min-e:e+t>this.max?this.max-e:t}static fromStateObject(e){return new Fn(InfiniteNumberIO.fromStateObject(e.min),InfiniteNumberIO.fromStateObject(e.max))}};Fn.RangeIO=new IOType("RangeIO",{valueType:Fn,documentation:'A range with "min" and "max" members.',stateSchema:STATE_SCHEMA$1,toStateObject:e=>e.toStateObject(),fromStateObject:e=>Fn.fromStateObject(e)}),Fn.EVERYTHING=new Fn(Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY),Fn.NOTHING=new Fn(Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY);let Range=Fn;dot.register("Range",Range);const scratchVector2$2=new Vector2(0,0),Ln=class Ln{constructor(e,t,n,r){assert&&assert(r!==void 0,"Bounds2 requires 4 parameters"),this.minX=e,this.minY=t,this.maxX=n,this.maxY=r}getWidth(){return this.maxX-this.minX}get width(){return this.getWidth()}getHeight(){return this.maxY-this.minY}get height(){return this.getHeight()}getX(){return this.minX}get x(){return this.getX()}getY(){return this.minY}get y(){return this.getY()}getMinX(){return this.minX}getMinY(){return this.minY}getMaxX(){return this.maxX}getMaxY(){return this.maxY}getLeft(){return this.minX}get left(){return this.minX}getTop(){return this.minY}get top(){return this.minY}getRight(){return this.maxX}get right(){return this.maxX}getBottom(){return this.maxY}get bottom(){return this.maxY}getCenterX(){return(this.maxX+this.minX)/2}get centerX(){return this.getCenterX()}getCenterY(){return(this.maxY+this.minY)/2}get centerY(){return this.getCenterY()}getLeftTop(){return new Vector2(this.minX,this.minY)}get leftTop(){return this.getLeftTop()}getCenterTop(){return new Vector2(this.getCenterX(),this.minY)}get centerTop(){return this.getCenterTop()}getRightTop(){return new Vector2(this.maxX,this.minY)}get rightTop(){return this.getRightTop()}getLeftCenter(){return new Vector2(this.minX,this.getCenterY())}get leftCenter(){return this.getLeftCenter()}getCenter(){return new Vector2(this.getCenterX(),this.getCenterY())}get center(){return this.getCenter()}getRightCenter(){return new Vector2(this.maxX,this.getCenterY())}get rightCenter(){return this.getRightCenter()}getLeftBottom(){return new Vector2(this.minX,this.maxY)}get leftBottom(){return this.getLeftBottom()}getCenterBottom(){return new Vector2(this.getCenterX(),this.maxY)}get centerBottom(){return this.getCenterBottom()}getRightBottom(){return new Vector2(this.maxX,this.maxY)}get rightBottom(){return this.getRightBottom()}isEmpty(){return this.getWidth()<0||this.getHeight()<0}isFinite(){return isFinite(this.minX)&&isFinite(this.minY)&&isFinite(this.maxX)&&isFinite(this.maxY)}hasNonzeroArea(){return this.getWidth()>0&&this.getHeight()>0}isValid(){return!this.isEmpty()&&this.isFinite()}closestPointTo(e){return this.containsCoordinates(e.x,e.y)?e:this.getConstrainedPoint(e)}closestBoundaryPointTo(e){if(this.containsCoordinates(e.x,e.y)){const t=e.x<this.centerX?this.minX:this.maxX,n=e.y<this.centerY?this.minY:this.maxY;return Math.abs(t-e.x)<Math.abs(n-e.y)?new Vector2(t,e.y):new Vector2(e.x,n)}else return this.getConstrainedPoint(e)}getConstrainedPoint(e){const t=Math.max(Math.min(e.x,this.maxX),this.x),n=Math.max(Math.min(e.y,this.maxY),this.y);return new Vector2(t,n)}containsCoordinates(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY}containsPoint(e){return this.containsCoordinates(e.x,e.y)}containsBounds(e){return this.minX<=e.minX&&this.maxX>=e.maxX&&this.minY<=e.minY&&this.maxY>=e.maxY}intersectsBounds(e){const t=Math.max(this.minX,e.minX),n=Math.max(this.minY,e.minY),r=Math.min(this.maxX,e.maxX),s=Math.min(this.maxY,e.maxY);return r-t>=0&&s-n>=0}minimumDistanceToPointSquared(e){const t=e.x<this.minX?this.minX:e.x>this.maxX?this.maxX:null,n=e.y<this.minY?this.minY:e.y>this.maxY?this.maxY:null;let r;if(t===null&&n===null)return 0;if(t===null)return r=n-e.y,r*r;if(n===null)return r=t-e.x,r*r;{const s=t-e.x,a=n-e.y;return s*s+a*a}}maximumDistanceToPointSquared(e){let t=e.x>this.getCenterX()?this.minX:this.maxX,n=e.y>this.getCenterY()?this.minY:this.maxY;return t-=e.x,n-=e.y,t*t+n*n}toString(){return`[x:(${this.minX},${this.maxX}),y:(${this.minY},${this.maxY})]`}equals(e){return this.minX===e.minX&&this.minY===e.minY&&this.maxX===e.maxX&&this.maxY===e.maxY}equalsEpsilon(e,t){t=t!==void 0?t:0;const n=this.isFinite(),r=e.isFinite();return n&&r?Math.abs(this.minX-e.minX)<t&&Math.abs(this.minY-e.minY)<t&&Math.abs(this.maxX-e.maxX)<t&&Math.abs(this.maxY-e.maxY)<t:n!==r?!1:this===e?!0:(isFinite(this.minX+e.minX)?Math.abs(this.minX-e.minX)<t:this.minX===e.minX)&&(isFinite(this.minY+e.minY)?Math.abs(this.minY-e.minY)<t:this.minY===e.minY)&&(isFinite(this.maxX+e.maxX)?Math.abs(this.maxX-e.maxX)<t:this.maxX===e.maxX)&&(isFinite(this.maxY+e.maxY)?Math.abs(this.maxY-e.maxY)<t:this.maxY===e.maxY)}copy(e){return e?e.set(this):b2(this.minX,this.minY,this.maxX,this.maxY)}static create(e){return b2(e.minX,e.minY,e.maxX,e.maxY)}union(e){return b2(Math.min(this.minX,e.minX),Math.min(this.minY,e.minY),Math.max(this.maxX,e.maxX),Math.max(this.maxY,e.maxY))}intersection(e){return b2(Math.max(this.minX,e.minX),Math.max(this.minY,e.minY),Math.min(this.maxX,e.maxX),Math.min(this.maxY,e.maxY))}withCoordinates(e,t){return b2(Math.min(this.minX,e),Math.min(this.minY,t),Math.max(this.maxX,e),Math.max(this.maxY,t))}withPoint(e){return this.withCoordinates(e.x,e.y)}withX(e){return this.copy().addX(e)}withY(e){return this.copy().addY(e)}withMinX(e){return b2(e,this.minY,this.maxX,this.maxY)}withMinY(e){return b2(this.minX,e,this.maxX,this.maxY)}withMaxX(e){return b2(this.minX,this.minY,e,this.maxY)}withMaxY(e){return b2(this.minX,this.minY,this.maxX,e)}roundedOut(){return b2(Math.floor(this.minX),Math.floor(this.minY),Math.ceil(this.maxX),Math.ceil(this.maxY))}roundedIn(){return b2(Math.ceil(this.minX),Math.ceil(this.minY),Math.floor(this.maxX),Math.floor(this.maxY))}transformed(e){return this.copy().transform(e)}dilated(e){return this.dilatedXY(e,e)}dilatedX(e){return b2(this.minX-e,this.minY,this.maxX+e,this.maxY)}dilatedY(e){return b2(this.minX,this.minY-e,this.maxX,this.maxY+e)}dilatedXY(e,t){return b2(this.minX-e,this.minY-t,this.maxX+e,this.maxY+t)}eroded(e){return this.dilated(-e)}erodedX(e){return this.dilatedX(-e)}erodedY(e){return this.dilatedY(-e)}erodedXY(e,t){return this.dilatedXY(-e,-t)}withOffsets(e,t,n,r){return b2(this.minX-e,this.minY-t,this.maxX+n,this.maxY+r)}shiftedX(e){return b2(this.minX+e,this.minY,this.maxX+e,this.maxY)}shiftedY(e){return b2(this.minX,this.minY+e,this.maxX,this.maxY+e)}shiftedXY(e,t){return b2(this.minX+e,this.minY+t,this.maxX+e,this.maxY+t)}shifted(e){return this.shiftedXY(e.x,e.y)}blend(e,t){const n=1-t;return b2(n*this.minX+t*e.minX,n*this.minY+t*e.minY,n*this.maxX+t*e.maxX,n*this.maxY+t*e.maxY)}setMinMax(e,t,n,r){return this.minX=e,this.minY=t,this.maxX=n,this.maxY=r,this}setMinX(e){return this.minX=e,this}setMinY(e){return this.minY=e,this}setMaxX(e){return this.maxX=e,this}setMaxY(e){return this.maxY=e,this}set(e){return this.setMinMax(e.minX,e.minY,e.maxX,e.maxY)}includeBounds(e){return this.setMinMax(Math.min(this.minX,e.minX),Math.min(this.minY,e.minY),Math.max(this.maxX,e.maxX),Math.max(this.maxY,e.maxY))}constrainBounds(e){return this.setMinMax(Math.max(this.minX,e.minX),Math.max(this.minY,e.minY),Math.min(this.maxX,e.maxX),Math.min(this.maxY,e.maxY))}addCoordinates(e,t){return this.setMinMax(Math.min(this.minX,e),Math.min(this.minY,t),Math.max(this.maxX,e),Math.max(this.maxY,t))}addPoint(e){return this.addCoordinates(e.x,e.y)}addX(e){return this.minX=Math.min(e,this.minX),this.maxX=Math.max(e,this.maxX),this}addY(e){return this.minY=Math.min(e,this.minY),this.maxY=Math.max(e,this.maxY),this}roundOut(){return this.setMinMax(Math.floor(this.minX),Math.floor(this.minY),Math.ceil(this.maxX),Math.ceil(this.maxY))}roundIn(){return this.setMinMax(Math.ceil(this.minX),Math.ceil(this.minY),Math.floor(this.maxX),Math.floor(this.maxY))}transform(e){if(this.isEmpty())return this;if(e.isIdentity())return this;const t=this.minX,n=this.minY,r=this.maxX,s=this.maxY;return this.set(Ln.NOTHING),this.addPoint(e.multiplyVector2(scratchVector2$2.setXY(t,n))),this.addPoint(e.multiplyVector2(scratchVector2$2.setXY(t,s))),this.addPoint(e.multiplyVector2(scratchVector2$2.setXY(r,n))),this.addPoint(e.multiplyVector2(scratchVector2$2.setXY(r,s))),this}dilate(e){return this.dilateXY(e,e)}dilateX(e){return this.setMinMax(this.minX-e,this.minY,this.maxX+e,this.maxY)}dilateY(e){return this.setMinMax(this.minX,this.minY-e,this.maxX,this.maxY+e)}dilateXY(e,t){return this.setMinMax(this.minX-e,this.minY-t,this.maxX+e,this.maxY+t)}erode(e){return this.dilate(-e)}erodeX(e){return this.dilateX(-e)}erodeY(e){return this.dilateY(-e)}erodeXY(e,t){return this.dilateXY(-e,-t)}offset(e,t,n,r){return b2(this.minX-e,this.minY-t,this.maxX+n,this.maxY+r)}shiftX(e){return this.setMinMax(this.minX+e,this.minY,this.maxX+e,this.maxY)}shiftY(e){return this.setMinMax(this.minX,this.minY+e,this.maxX,this.maxY+e)}shiftXY(e,t){return this.setMinMax(this.minX+e,this.minY+t,this.maxX+e,this.maxY+t)}shift(e){return this.shiftXY(e.x,e.y)}getXRange(){return new Range(this.minX,this.maxX)}setXRange(e){return this.setMinMax(e.min,this.minY,e.max,this.maxY)}get xRange(){return this.getXRange()}set xRange(e){this.setXRange(e)}getYRange(){return new Range(this.minY,this.maxY)}setYRange(e){return this.setMinMax(this.minX,e.min,this.maxX,e.max)}get yRange(){return this.getYRange()}set yRange(e){this.setYRange(e)}getClosestPoint(e,t,n){return n?n.setXY(e,t):n=new Vector2(e,t),n.x<this.minX&&(n.x=this.minX),n.x>this.maxX&&(n.x=this.maxX),n.y<this.minY&&(n.y=this.minY),n.y>this.maxY&&(n.y=this.maxY),n}freeToPool(){Ln.pool.freeToPool(this)}static rect(e,t,n,r){return b2(e,t,e+n,t+r)}static oriented(e,t,n,r,s){return e===Orientation.HORIZONTAL?new Ln(t,n,r,s):new Ln(n,t,s,r)}static point(e,t){if(e instanceof Vector2){const n=e;return b2(n.x,n.y,n.x,n.y)}else return b2(e,t,e,t)}};Ln.pool=new Pool(Ln,{maxSize:1e3,initialize:Ln.prototype.setMinMax,defaultArguments:[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY]}),Ln.NOTHING=new Ln(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),Ln.EVERYTHING=new Ln(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),Ln.Bounds2IO=new IOType("Bounds2IO",{valueType:Ln,documentation:"a 2-dimensional bounds rectangle",toStateObject:e=>({minX:e.minX,minY:e.minY,maxX:e.maxX,maxY:e.maxY}),fromStateObject:e=>new Ln(InfiniteNumberIO.fromStateObject(e.minX),InfiniteNumberIO.fromStateObject(e.minY),InfiniteNumberIO.fromStateObject(e.maxX),InfiniteNumberIO.fromStateObject(e.maxY)),stateSchema:{minX:InfiniteNumberIO,maxX:InfiniteNumberIO,minY:InfiniteNumberIO,maxY:InfiniteNumberIO}});let Bounds2=Ln;dot.register("Bounds2",Bounds2);const b2=Bounds2.pool.create.bind(Bounds2.pool);dot.register("b2",b2);Bounds2.prototype.isBounds=!0;Bounds2.prototype.dimension=2;function catchImmutableSetterLowHangingFruit(o){o.setMinMax=()=>{throw new Error('Attempt to set "setMinMax" of an immutable Bounds2 object')},o.set=()=>{throw new Error('Attempt to set "set" of an immutable Bounds2 object')},o.includeBounds=()=>{throw new Error('Attempt to set "includeBounds" of an immutable Bounds2 object')},o.constrainBounds=()=>{throw new Error('Attempt to set "constrainBounds" of an immutable Bounds2 object')},o.addCoordinates=()=>{throw new Error('Attempt to set "addCoordinates" of an immutable Bounds2 object')},o.transform=()=>{throw new Error('Attempt to set "transform" of an immutable Bounds2 object')}}assert&&(catchImmutableSetterLowHangingFruit(Bounds2.EVERYTHING),catchImmutableSetterLowHangingFruit(Bounds2.NOTHING));class BinPacker{constructor(e){this.rootBin=new Bin(e,null)}allocate(e,t){const n=this.rootBin.findAvailableBin(e,t);if(n){const r=n.split(e,t);return r.use(),r}else return null}deallocate(e){e.unuse()}toString(){let e="",t="";function n(r){e+=`${t+r.toString()}
`,t=`${t}  `,_.each(r.children,n),t=t.substring(2)}return n(this.rootBin),e}}dot.register("BinPacker",BinPacker);class Bin{constructor(e,t){this.bounds=e,this.parent=t,this.isSplit=!1,this.isUsed=!1,this.children=[]}findAvailableBin(e,t){if(assert&&assert(e>0&&t>0,"Empty bin requested?"),this.isUsed)return null;if(this.bounds.width<e||this.bounds.height<t)return null;if(this.isSplit){for(let n=0;n<this.children.length;n++){const r=this.children[n].findAvailableBin(e,t);if(r)return r}return null}else return this}split(e,t){if(assert&&assert(this.bounds.width>=e&&this.bounds.height>=t,"Bin does not have space"),assert&&assert(!this.isSplit,"Bin should not be re-split"),assert&&assert(!this.isUsed,"Bin should not be split when used"),assert&&assert(e>0&&t>0,"Empty bin requested?"),e===this.bounds.width&&t===this.bounds.height)return this;this.isSplit=!0;const n=this.bounds.minX+e,r=this.bounds.minY+t,s=new Bounds2(this.bounds.minX,this.bounds.minY,n,r),a=new Bounds2(n,this.bounds.minY,this.bounds.maxX,r),l=new Bounds2(this.bounds.minX,r,this.bounds.maxX,this.bounds.maxY),d=new Bin(s,this);return this.children.push(d),a.hasNonzeroArea()&&this.children.push(new Bin(a,this)),l.hasNonzeroArea()&&this.children.push(new Bin(l,this)),d}use(){assert&&assert(!this.isSplit,"Should not mark a split bin as used"),assert&&assert(!this.isUsed,"Should not mark a used bin as used"),this.isUsed=!0}unuse(){assert&&assert(this.isUsed,"Can only unuse a used instance"),this.isUsed=!1,this.parent&&this.parent.attemptToCollapse()}attemptToCollapse(){assert&&assert(this.isSplit,"Should only attempt to collapse split bins");for(let e=0;e<this.children.length;e++){const t=this.children[e];if(t.isSplit||t.isUsed)return}this.children=[],this.isSplit=!1,this.parent&&this.parent.attemptToCollapse()}toString(){return this.bounds.toString()+(this.isUsed?" used":"")}}BinPacker.Bin=Bin;const As=class As{constructor(e,t,n,r,s,a){this.minX=e,this.minY=t,this.minZ=n,this.maxX=r,this.maxY=s,this.maxZ=a,this.isBounds=!0,this.dimension=3,assert&&assert(s!==void 0,"Bounds3 requires 4 parameters")}getWidth(){return this.maxX-this.minX}get width(){return this.getWidth()}getHeight(){return this.maxY-this.minY}get height(){return this.getHeight()}getDepth(){return this.maxZ-this.minZ}get depth(){return this.getDepth()}getX(){return this.minX}get x(){return this.getX()}getY(){return this.minY}get y(){return this.getY()}getZ(){return this.minZ}get z(){return this.getZ()}getMinX(){return this.minX}getMinY(){return this.minY}getMinZ(){return this.minZ}getMaxX(){return this.maxX}getMaxY(){return this.maxY}getMaxZ(){return this.maxZ}getLeft(){return this.minX}get left(){return this.minX}getTop(){return this.minY}get top(){return this.minY}getBack(){return this.minZ}get back(){return this.minZ}getRight(){return this.maxX}get right(){return this.maxX}getBottom(){return this.maxY}get bottom(){return this.maxY}getFront(){return this.maxZ}get front(){return this.maxZ}getCenterX(){return(this.maxX+this.minX)/2}get centerX(){return this.getCenterX()}getCenterY(){return(this.maxY+this.minY)/2}get centerY(){return this.getCenterY()}getCenterZ(){return(this.maxZ+this.minZ)/2}get centerZ(){return this.getCenterZ()}getCenter(){return new Vector3(this.getCenterX(),this.getCenterY(),this.getCenterZ())}get center(){return this.getCenter()}isEmpty(){return this.getWidth()<0||this.getHeight()<0||this.getDepth()<0}isFinite(){return isFinite(this.minX)&&isFinite(this.minY)&&isFinite(this.minZ)&&isFinite(this.maxX)&&isFinite(this.maxY)&&isFinite(this.maxZ)}hasNonzeroArea(){return this.getWidth()>0&&this.getHeight()>0&&this.getDepth()>0}isValid(){return!this.isEmpty()&&this.isFinite()}containsCoordinates(e,t,n){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY&&this.minZ<=n&&n<=this.maxZ}containsPoint(e){return this.containsCoordinates(e.x,e.y,e.z)}containsBounds(e){return this.minX<=e.minX&&this.maxX>=e.maxX&&this.minY<=e.minY&&this.maxY>=e.maxY&&this.minZ<=e.minZ&&this.maxZ>=e.maxZ}intersectsBounds(e){return!this.intersection(e).isEmpty()}toString(){return`[x:(${this.minX},${this.maxX}),y:(${this.minY},${this.maxY}),z:(${this.minZ},${this.maxZ})]`}equals(e){return this.minX===e.minX&&this.minY===e.minY&&this.minZ===e.minZ&&this.maxX===e.maxX&&this.maxY===e.maxY&&this.maxZ===e.maxZ}equalsEpsilon(e,t){t=t!==void 0?t:0;const n=this.isFinite(),r=e.isFinite();return n&&r?Math.abs(this.minX-e.minX)<t&&Math.abs(this.minY-e.minY)<t&&Math.abs(this.minZ-e.minZ)<t&&Math.abs(this.maxX-e.maxX)<t&&Math.abs(this.maxY-e.maxY)<t&&Math.abs(this.maxZ-e.maxZ)<t:n!==r?!1:this===e?!0:(isFinite(this.minX+e.minX)?Math.abs(this.minX-e.minX)<t:this.minX===e.minX)&&(isFinite(this.minY+e.minY)?Math.abs(this.minY-e.minY)<t:this.minY===e.minY)&&(isFinite(this.minZ+e.minZ)?Math.abs(this.minZ-e.minZ)<t:this.minZ===e.minZ)&&(isFinite(this.maxX+e.maxX)?Math.abs(this.maxX-e.maxX)<t:this.maxX===e.maxX)&&(isFinite(this.maxY+e.maxY)?Math.abs(this.maxY-e.maxY)<t:this.maxY===e.maxY)&&(isFinite(this.maxZ+e.maxZ)?Math.abs(this.maxZ-e.maxZ)<t:this.maxZ===e.maxZ)}copy(e){return e?e.set(this):new As(this.minX,this.minY,this.minZ,this.maxX,this.maxY,this.maxZ)}union(e){return new As(Math.min(this.minX,e.minX),Math.min(this.minY,e.minY),Math.min(this.minZ,e.minZ),Math.max(this.maxX,e.maxX),Math.max(this.maxY,e.maxY),Math.max(this.maxZ,e.maxZ))}intersection(e){return new As(Math.max(this.minX,e.minX),Math.max(this.minY,e.minY),Math.max(this.minZ,e.minZ),Math.min(this.maxX,e.maxX),Math.min(this.maxY,e.maxY),Math.min(this.maxZ,e.maxZ))}withCoordinates(e,t,n){return new As(Math.min(this.minX,e),Math.min(this.minY,t),Math.min(this.minZ,n),Math.max(this.maxX,e),Math.max(this.maxY,t),Math.max(this.maxZ,n))}withPoint(e){return this.withCoordinates(e.x,e.y,e.z)}withMinX(e){return new As(e,this.minY,this.minZ,this.maxX,this.maxY,this.maxZ)}withMinY(e){return new As(this.minX,e,this.minZ,this.maxX,this.maxY,this.maxZ)}withMinZ(e){return new As(this.minX,this.minY,e,this.maxX,this.maxY,this.maxZ)}withMaxX(e){return new As(this.minX,this.minY,this.minZ,e,this.maxY,this.maxZ)}withMaxY(e){return new As(this.minX,this.minY,this.minZ,this.maxX,e,this.maxZ)}withMaxZ(e){return new As(this.minX,this.minY,this.minZ,this.maxX,this.maxY,e)}roundedOut(){return new As(Math.floor(this.minX),Math.floor(this.minY),Math.floor(this.minZ),Math.ceil(this.maxX),Math.ceil(this.maxY),Math.ceil(this.maxZ))}roundedIn(){return new As(Math.ceil(this.minX),Math.ceil(this.minY),Math.ceil(this.minZ),Math.floor(this.maxX),Math.floor(this.maxY),Math.floor(this.maxZ))}transformed(e){return this.copy().transform(e)}dilated(e){return this.dilatedXYZ(e,e,e)}dilatedX(e){return new As(this.minX-e,this.minY,this.minZ,this.maxX+e,this.maxY,this.maxZ)}dilatedY(e){return new As(this.minX,this.minY-e,this.minZ,this.maxX,this.maxY+e,this.maxZ)}dilatedZ(e){return new As(this.minX,this.minY,this.minZ-e,this.maxX,this.maxY,this.maxZ+e)}dilatedXYZ(e,t,n){return new As(this.minX-e,this.minY-t,this.minZ-n,this.maxX+e,this.maxY+t,this.maxZ+n)}eroded(e){return this.dilated(-e)}erodedX(e){return this.dilatedX(-e)}erodedY(e){return this.dilatedY(-e)}erodedZ(e){return this.dilatedZ(-e)}erodedXYZ(e,t,n){return this.dilatedXYZ(-e,-t,-n)}shiftedX(e){return new As(this.minX+e,this.minY,this.minZ,this.maxX+e,this.maxY,this.maxZ)}shiftedY(e){return new As(this.minX,this.minY+e,this.minZ,this.maxX,this.maxY+e,this.maxZ)}shiftedZ(e){return new As(this.minX,this.minY,this.minZ+e,this.maxX,this.maxY,this.maxZ+e)}shiftedXYZ(e,t,n){return new As(this.minX+e,this.minY+t,this.minZ+n,this.maxX+e,this.maxY+t,this.maxZ+n)}shifted(e){return this.shiftedXYZ(e.x,e.y,e.z)}setMinMax(e,t,n,r,s,a){return this.minX=e,this.minY=t,this.minZ=n,this.maxX=r,this.maxY=s,this.maxZ=a,this}setMinX(e){return this.minX=e,this}setMinY(e){return this.minY=e,this}setMinZ(e){return this.minZ=e,this}setMaxX(e){return this.maxX=e,this}setMaxY(e){return this.maxY=e,this}setMaxZ(e){return this.maxZ=e,this}set(e){return this.setMinMax(e.minX,e.minY,e.minZ,e.maxX,e.maxY,e.maxZ)}includeBounds(e){return this.setMinMax(Math.min(this.minX,e.minX),Math.min(this.minY,e.minY),Math.min(this.minZ,e.minZ),Math.max(this.maxX,e.maxX),Math.max(this.maxY,e.maxY),Math.max(this.maxZ,e.maxZ))}constrainBounds(e){return this.setMinMax(Math.max(this.minX,e.minX),Math.max(this.minY,e.minY),Math.max(this.minZ,e.minZ),Math.min(this.maxX,e.maxX),Math.min(this.maxY,e.maxY),Math.min(this.maxZ,e.maxZ))}addCoordinates(e,t,n){return this.setMinMax(Math.min(this.minX,e),Math.min(this.minY,t),Math.min(this.minZ,n),Math.max(this.maxX,e),Math.max(this.maxY,t),Math.max(this.maxZ,n))}addPoint(e){return this.addCoordinates(e.x,e.y,e.z)}roundOut(){return this.setMinMax(Math.floor(this.minX),Math.floor(this.minY),Math.floor(this.minZ),Math.ceil(this.maxX),Math.ceil(this.maxY),Math.ceil(this.maxZ))}roundIn(){return this.setMinMax(Math.ceil(this.minX),Math.ceil(this.minY),Math.ceil(this.minZ),Math.floor(this.maxX),Math.floor(this.maxY),Math.floor(this.maxZ))}transform(e){if(this.isEmpty())return this;if(e.isIdentity())return this;let t=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;const d=new Vector3(0,0,0);function c(y){t=Math.min(t,y.x),n=Math.min(n,y.y),r=Math.min(r,y.z),s=Math.max(s,y.x),a=Math.max(a,y.y),l=Math.max(l,y.z)}return c(e.multiplyVector3(d.setXYZ(this.minX,this.minY,this.minZ))),c(e.multiplyVector3(d.setXYZ(this.minX,this.maxY,this.minZ))),c(e.multiplyVector3(d.setXYZ(this.maxX,this.minY,this.minZ))),c(e.multiplyVector3(d.setXYZ(this.maxX,this.maxY,this.minZ))),c(e.multiplyVector3(d.setXYZ(this.minX,this.minY,this.maxZ))),c(e.multiplyVector3(d.setXYZ(this.minX,this.maxY,this.maxZ))),c(e.multiplyVector3(d.setXYZ(this.maxX,this.minY,this.maxZ))),c(e.multiplyVector3(d.setXYZ(this.maxX,this.maxY,this.maxZ))),this.setMinMax(t,n,r,s,a,l)}dilate(e){return this.dilateXYZ(e,e,e)}dilateX(e){return this.setMinMax(this.minX-e,this.minY,this.minZ,this.maxX+e,this.maxY,this.maxZ)}dilateY(e){return this.setMinMax(this.minX,this.minY-e,this.minZ,this.maxX,this.maxY+e,this.maxZ)}dilateZ(e){return this.setMinMax(this.minX,this.minY,this.minZ-e,this.maxX,this.maxY,this.maxZ+e)}dilateXYZ(e,t,n){return this.setMinMax(this.minX-e,this.minY-t,this.minZ-n,this.maxX+e,this.maxY+t,this.maxZ+n)}erode(e){return this.dilate(-e)}erodeX(e){return this.dilateX(-e)}erodeY(e){return this.dilateY(-e)}erodeZ(e){return this.dilateZ(-e)}erodeXYZ(e,t,n){return this.dilateXYZ(-e,-t,-n)}shiftX(e){return this.setMinMax(this.minX+e,this.minY,this.minZ,this.maxX+e,this.maxY,this.maxZ)}shiftY(e){return this.setMinMax(this.minX,this.minY+e,this.minZ,this.maxX,this.maxY+e,this.maxZ)}shiftZ(e){return this.setMinMax(this.minX,this.minY,this.minZ+e,this.maxX,this.maxY,this.maxZ+e)}shiftXYZ(e,t,n){return this.setMinMax(this.minX+e,this.minY+t,this.minZ+n,this.maxX+e,this.maxY+t,this.maxZ+n)}shift(e){return this.shiftXYZ(e.x,e.y,e.z)}static cuboid(e,t,n,r,s,a){return new As(e,t,n,e+r,t+s,n+a)}static point(e,t,n){return new As(e,t,n,e,t,n)}};As.NOTHING=new As(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),As.EVERYTHING=new As(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),As.Bounds3IO=new IOType("Bounds3IO",{valueType:As,documentation:"a 3-dimensional bounds (bounding box)",stateSchema:{minX:NumberIO,minY:NumberIO,minZ:NumberIO,maxX:NumberIO,maxY:NumberIO,maxZ:NumberIO},toStateObject:e=>({minX:e.minX,minY:e.minY,minZ:e.minZ,maxX:e.maxX,maxY:e.maxY,maxZ:e.maxZ}),fromStateObject:e=>new As(e.minX,e.minY,e.minZ,e.maxX,e.maxY,e.maxZ)});let Bounds3=As;dot.register("Bounds3",Bounds3);Poolable.mixInto(Bounds3,{initialize:Bounds3.prototype.setMinMax});class Combination{constructor(e){this.inclusions=e}size(){return this.inclusions.length}includes(e){return this.inclusions[e]}apply(e){return e.filter((t,n)=>this.inclusions[n])}inverted(){return new Combination(this.inclusions.map(e=>!e))}getIncludedIndices(){return _.range(0,this.size()).filter(e=>this.inclusions[e])}toString(){return`C[${this.inclusions.map(e=>e?"1":"0").join("")}]`}equals(e){return this.inclusions.length===e.inclusions.length&&_.isEqual(this.inclusions,e.inclusions)}static empty(e){return new Combination(_.range(0,e).map(()=>!1))}static full(e){return new Combination(_.range(0,e).map(()=>!0))}static combinations(e){const t=[],n=[];return function r(s){s===e?t.push(new Combination(n.slice())):(n.push(!1),r(s+1),n.pop(),n.push(!0),r(s+1),n.pop())}(0),t}static forEachCombination(e,t){const n=[];(function r(s){s===e.length?t(n):(r(s+1),n.push(e[s]),r(s+1),n.pop())})(0)}static combinationsOf(e){const t=[];return Combination.forEachCombination(e,n=>{t.push(n.slice())}),t}}dot.register("Combination",Combination);class CompletePiecewiseLinearFunction{constructor(e){assert&&assert(e.length>0),assert&&e.forEach((t,n)=>{n<e.length-1&&assert&&assert(t.x<e[n+1].x,"Points should be strictly increasing in x value (ordered by their x value)")}),this.points=e.slice();for(let t=0;t<this.points.length-2;t++){const n=this.points[t],r=this.points[t+1],s=this.points[t+2];DotUtils.arePointsCollinear(n,r,s)&&(this.points.splice(t+1,1),t--)}}findMatchingPair(e){assert&&assert(this.points.length>1);let t=0;for(;t<this.points.length-2&&this.points[t+1].x<e;)t++;return[this.points[t],this.points[t+1]]}evaluate(e){if(this.points.length===1)return this.points[0].y;{const[t,n]=this.findMatchingPair(e);return t.x===e?t.y:n.x===e?n.y:DotUtils.linear(t.x,n.x,t.y,n.y,e)}}getCombinedXValues(e){return CompletePiecewiseLinearFunction.sortedUniqueEpsilon(this.points.map(t=>t.x).concat(e.points.map(t=>t.x)))}getIntersectedXValues(e){const t=this.getCombinedXValues(e),n=[];for(let s=0;s<t.length-1;s++){const a=t[s],l=t[s+1],d=DotUtils.lineLineIntersection(new Vector2(a,this.evaluate(a)),new Vector2(l,this.evaluate(l)),new Vector2(a,e.evaluate(a)),new Vector2(l,e.evaluate(l)));d&&(s===0||d.x>a)&&(s===t.length-2||d.x<l)&&n.push(d.x)}const r=CompletePiecewiseLinearFunction.sortedUniqueEpsilon([...t,...n]);return[r[0]-1,...r,r[r.length-1]+1]}binaryXOperation(e,t,n){return new CompletePiecewiseLinearFunction(n.map(r=>new Vector2(r,t(this.evaluate(r),e.evaluate(r)))))}binaryPointwiseOperation(e,t){return this.binaryXOperation(e,t,this.getCombinedXValues(e))}binaryIntersectingOperation(e,t){return this.binaryXOperation(e,t,this.getIntersectedXValues(e))}plus(e){return this.binaryPointwiseOperation(e,(t,n)=>t+n)}minus(e){return this.binaryPointwiseOperation(e,(t,n)=>t-n)}min(e){return this.binaryIntersectingOperation(e,Math.min)}max(e){return this.binaryIntersectingOperation(e,Math.max)}withXValues(e){return new CompletePiecewiseLinearFunction(e.map(t=>new Vector2(t,this.evaluate(t))))}inverted(){const e=this.points.map(t=>new Vector2(t.y,t.x));return e.length>1&&e[0].x>e[1].x&&e.reverse(),new CompletePiecewiseLinearFunction(e)}static sum(...e){return e.reduce((t,n)=>t.plus(n))}static min(...e){return e.reduce((t,n)=>t.min(n))}static max(...e){return e.reduce((t,n)=>t.max(n))}static constant(e){return new CompletePiecewiseLinearFunction([new Vector2(0,e)])}static linear(e,t){return new CompletePiecewiseLinearFunction([new Vector2(0,t),new Vector2(1,e+t)])}static sortedUniqueEpsilon(e,t=1e-10){e=_.sortBy(e);for(let n=0;n<e.length-1;n++)Math.abs(e[n]-e[n+1])<t&&(e.splice(n,1),n--);return e}}dot.register("CompletePiecewiseLinearFunction",CompletePiecewiseLinearFunction);const Ni=class Ni{constructor(e,t){this.real=e,this.imaginary=t}copy(e){return e?e.set(this):new Ni(this.real,this.imaginary)}phase(){return Math.atan2(this.imaginary,this.real)}getMagnitude(){return Math.sqrt(this.magnitudeSquared)}get magnitude(){return this.getMagnitude()}getMagnitudeSquared(){return this.real*this.real+this.imaginary*this.imaginary}get magnitudeSquared(){return this.getMagnitudeSquared()}getArgument(){return Math.atan2(this.imaginary,this.real)}get argument(){return this.getArgument()}equals(e){return this.real===e.real&&this.imaginary===e.imaginary}equalsEpsilon(e,t=0){return Math.max(Math.abs(this.real-e.real),Math.abs(this.imaginary-e.imaginary))<=t}plus(e){return new Ni(this.real+e.real,this.imaginary+e.imaginary)}minus(e){return new Ni(this.real-e.real,this.imaginary-e.imaginary)}times(e){return new Ni(this.real*e.real-this.imaginary*e.imaginary,this.real*e.imaginary+this.imaginary*e.real)}dividedBy(e){const t=e.magnitudeSquared;return new Ni((this.real*e.real+this.imaginary*e.imaginary)/t,(this.imaginary*e.real-this.real*e.imaginary)/t)}negated(){return new Ni(-this.real,-this.imaginary)}sqrtOf(){const e=this.magnitude;return new Ni(Math.sqrt((e+this.real)/2),(this.imaginary>=0?1:-1)*Math.sqrt((e-this.real)/2))}powerByReal(e){const t=Math.pow(this.magnitude,e),n=e*this.phase();return new Ni(t*Math.cos(n),t*Math.sin(n))}sinOf(){return new Ni(Math.sin(this.real)*DotUtils.cosh(this.imaginary),Math.cos(this.real)*DotUtils.sinh(this.imaginary))}cosOf(){return new Ni(Math.cos(this.real)*DotUtils.cosh(this.imaginary),-Math.sin(this.real)*DotUtils.sinh(this.imaginary))}squared(){return this.times(this)}conjugated(){return new Ni(this.real,-this.imaginary)}exponentiated(){return Ni.createPolar(Math.exp(this.real),this.imaginary)}setRealImaginary(e,t){return this.real=e,this.imaginary=t,this}setReal(e){return this.real=e,this}setImaginary(e){return this.imaginary=e,this}set(e){return this.setRealImaginary(e.real,e.imaginary)}setPolar(e,t){return this.setRealImaginary(e*Math.cos(t),e*Math.sin(t))}add(e){return this.setRealImaginary(this.real+e.real,this.imaginary+e.imaginary)}subtract(e){return this.setRealImaginary(this.real-e.real,this.imaginary-e.imaginary)}multiply(e){return this.setRealImaginary(this.real*e.real-this.imaginary*e.imaginary,this.real*e.imaginary+this.imaginary*e.real)}divide(e){const t=e.magnitudeSquared;return this.setRealImaginary((this.real*e.real+this.imaginary*e.imaginary)/t,(this.imaginary*e.real-this.real*e.imaginary)/t)}negate(){return this.setRealImaginary(-this.real,-this.imaginary)}exponentiate(){return this.setPolar(Math.exp(this.real),this.imaginary)}square(){return this.multiply(this)}sqrt(){const e=this.magnitude;return this.setRealImaginary(Math.sqrt((e+this.real)/2),(this.imaginary>=0?1:-1)*Math.sqrt((e-this.real)/2))}sin(){return this.setRealImaginary(Math.sin(this.real)*DotUtils.cosh(this.imaginary),Math.cos(this.real)*DotUtils.sinh(this.imaginary))}cos(){return this.setRealImaginary(Math.cos(this.real)*DotUtils.cosh(this.imaginary),-Math.sin(this.real)*DotUtils.sinh(this.imaginary))}conjugate(){return this.setRealImaginary(this.real,-this.imaginary)}getCubeRoots(){const e=this.argument/3,t=this.magnitude,n=Ni.real(Math.cbrt(t));return[n.times(Ni.imaginary(e).exponentiate()),n.times(Ni.imaginary(e+Math.PI*2/3).exponentiate()),n.times(Ni.imaginary(e-Math.PI*2/3).exponentiate())]}toString(){return`Complex(${this.real}, ${this.imaginary})`}static real(e){return new Ni(e,0)}static imaginary(e){return new Ni(0,e)}static createPolar(e,t){return new Ni(e*Math.cos(t),e*Math.sin(t))}static solveLinearRoots(e,t){return e.equals(Ni.ZERO)?t.equals(Ni.ZERO)?null:[]:[t.dividedBy(e).negate()]}static solveQuadraticRoots(e,t,n){if(e.equals(Ni.ZERO))return Ni.solveLinearRoots(t,n);const r=Ni.real(2).multiply(e),s=t.times(t),a=Ni.real(4).multiply(e).multiply(n),l=s.subtract(a).sqrt();return[l.minus(t).divide(r),l.negated().subtract(t).divide(r)]}static solveCubicRoots(e,t,n,r){if(e.equals(Ni.ZERO))return Ni.solveQuadraticRoots(t,n,r);const s=e.times(Ni.real(3)).negate(),a=e.times(e),l=t.times(t),d=l.times(t),c=n.times(n),y=c.times(n),m=e.times(t).times(n),O=l,D=e.times(n).times(Ni.real(3)),z=d.times(Ni.real(2)).add(a.times(r).multiply(Ni.real(27))),w=m.times(Ni.real(9));if(O.equals(D)&&z.equals(w)){const ue=t.divide(s);return[ue,ue,ue]}const N=O.minus(D),H=z.minus(w),X=m.times(r).multiply(Ni.real(18)).add(l.times(c)),ae=d.times(r).multiply(Ni.real(4)).add(y.times(e).multiply(Ni.real(4))).add(a.times(r).multiply(r).multiply(Ni.real(27)));if(X.equals(ae)){const ue=m.times(Ni.real(4)).subtract(d.plus(a.times(r).multiply(Ni.real(9)))).divide(e.times(N)),fe=e.times(r).multiply(Ni.real(9)).subtract(t.times(n)).divide(N.times(Ni.real(2)));return[ue,fe,fe]}let oe;return O.equals(D)?oe=H:oe=H.plus(H.times(H).subtract(N.times(N).multiply(N).multiply(Ni.real(4))).sqrt()).divide(Ni.real(2)),oe.getCubeRoots().map(ue=>t.plus(ue).add(N.dividedBy(ue)).divide(s))}};Ni.ZERO=new Ni(0,0),Ni.ONE=new Ni(1,0),Ni.I=new Ni(0,1);let Complex=Ni;dot.register("Complex",Complex);function ccw(o,e,t){return e.minus(o).crossScalar(t.minus(o))}const ConvexHull2={grahamScan:(o,e)=>{if(o.length<=2)return o;let t=Number.POSITIVE_INFINITY,n=null;_.each(o,s=>{s.y<=t&&(s.y===t&&n?s.x<n.x&&(n=s):(t=s.y,n=s))}),o=_.sortBy(o,s=>s.minus(n).angle),o.splice(_.indexOf(o,n),1);const r=[n];return _.each(o,s=>{if(n.x===s.x&&n.y===s.y)return;function a(){if(r.length<2)return!1;const l=ccw(r[r.length-2],r[r.length-1],s);return e?l<0:l<=0}for(;a();)r.pop();r.push(s)}),r}};dot.register("ConvexHull2",ConvexHull2);const xr=class xr extends EnumerationValue{};xr.OVER_DAMPED=new xr,xr.UNDER_DAMPED=new xr,xr.CRITICALLY_DAMPED=new xr,xr.UNKNOWN=new xr,xr.enumeration=new Enumeration(xr);let SolutionType=xr;class DampedHarmonic{constructor(e,t,n,r,s){assert&&assert(isFinite(e)&&e!==0),assert&&assert(isFinite(t)),assert&&assert(isFinite(n)&&n!==0),assert&&assert(isFinite(r)),assert&&assert(isFinite(s)),this.dampingConstant=t/e,this.angularFrequencySquared=n/e,assert&&assert(this.dampingConstant>=0,"a and b should share the same sign"),assert&&assert(this.angularFrequencySquared>0,"a and c should share the same sign"),this.discriminant=this.dampingConstant*this.dampingConstant-4*this.angularFrequencySquared,this.solutionType=SolutionType.UNKNOWN,this.c1=0,this.c2=0,Math.abs(this.discriminant)<1e-5?(this.solutionType=SolutionType.CRITICALLY_DAMPED,this.angularFrequency=Math.sqrt(this.angularFrequencySquared),this.c1=r,this.c2=s+this.angularFrequency*r):this.discriminant<0?(this.solutionType=SolutionType.UNDER_DAMPED,this.frequency=.5*Math.sqrt(-this.discriminant),this.c1=r,this.c2=this.dampingConstant*r/(2*this.frequency)+s/this.frequency):(this.solutionType=SolutionType.OVER_DAMPED,this.positiveRoot=.5*(-this.dampingConstant+Math.sqrt(this.discriminant)),this.negativeRoot=.5*(-this.dampingConstant-Math.sqrt(this.discriminant)),this.c2=(this.negativeRoot*r-s)/(this.negativeRoot-this.positiveRoot),this.c1=r-this.c2)}getValue(e){if(this.solutionType===SolutionType.CRITICALLY_DAMPED)return assert&&assert(this.angularFrequency!==void 0),(this.c1+this.c2*e)*Math.exp(-this.angularFrequency*e);if(this.solutionType===SolutionType.UNDER_DAMPED){assert&&assert(this.frequency!==void 0);const t=this.frequency*e;return Math.exp(-(this.dampingConstant/2)*e)*(this.c1*Math.cos(t)+this.c2*Math.sin(t))}else{if(this.solutionType===SolutionType.OVER_DAMPED)return assert&&assert(this.positiveRoot!==void 0),assert&&assert(this.negativeRoot!==void 0),this.c1*Math.exp(this.negativeRoot*e)+this.c2*Math.exp(this.positiveRoot*e);throw new Error("Unknown solution type?")}}getDerivative(e){if(this.solutionType===SolutionType.CRITICALLY_DAMPED)return assert&&assert(this.angularFrequency!==void 0),Math.exp(-this.angularFrequency*e)*(this.c2-this.angularFrequency*(this.c1+this.c2*e));if(this.solutionType===SolutionType.UNDER_DAMPED){assert&&assert(this.frequency!==void 0);const t=this.frequency*e,n=Math.cos(t),r=Math.sin(t),s=this.frequency*(this.c2*n-this.c1*r),a=.5*this.dampingConstant*(this.c1*n+this.c2*r);return Math.exp(-.5*this.dampingConstant*e)*(s-a)}else{if(this.solutionType===SolutionType.OVER_DAMPED)return assert&&assert(this.positiveRoot!==void 0),assert&&assert(this.negativeRoot!==void 0),this.c1*this.negativeRoot*Math.exp(this.negativeRoot*e)+this.c2*this.positiveRoot*Math.exp(this.positiveRoot*e);throw new Error("Unknown solution type?")}}}dot.register("DampedHarmonic",DampedHarmonic);class DelaunayTriangulation{constructor(e,t,n){n=merge({},n);let r;if(this.points=e,this.constraints=t,this.triangles=[],this.edges=[],this.convexHull=[],e.length===0)return;for(this.vertices=e.map((l,d)=>(assert&&assert(l instanceof Vector2&&l.isFinite()),new Vertex$1(l,d))),r=0;r<this.constraints.length;r++){const l=this.constraints[r],d=l[0],c=l[1];assert&&assert(typeof d=="number"&&isFinite(d)&&d%1===0&&d>=0&&d<e.length),assert&&assert(typeof c=="number"&&isFinite(c)&&c%1===0&&c>=0&&c<e.length),assert&&assert(d!==c),this.vertices[d].constrainedVertices.push(this.vertices[c])}for(this.vertices.sort(DelaunayTriangulation.vertexComparison),r=0;r<this.vertices.length;r++){const l=this.vertices[r];l.sortedIndex=r;for(let d=l.constrainedVertices.length-1;d>=0;d--){const c=l.constrainedVertices[d];c.sortedIndex===-1&&(c.constrainedVertices.push(l),l.constrainedVertices.splice(d,1))}}this.bottomVertex=this.vertices[0],this.remainingVertices=this.vertices.slice(1);const s=Bounds2.NOTHING.copy();for(r=e.length-1;r>=0;r--)s.addPoint(e[r]);const a=.4;this.artificialMinVertex=new Vertex$1(new Vector2(s.minX-s.width*a,s.minY-s.height*a),-1),this.artificialMaxVertex=new Vertex$1(new Vector2(s.maxX+s.width*a,s.minY-s.height*a),-2),this.edges.push(new Edge$1(this.artificialMinVertex,this.artificialMaxVertex)),this.edges.push(new Edge$1(this.artificialMaxVertex,this.bottomVertex)),this.edges.push(new Edge$1(this.bottomVertex,this.artificialMinVertex)),this.triangles.push(new Triangle(this.artificialMinVertex,this.artificialMaxVertex,this.bottomVertex,this.edges[1],this.edges[2],this.edges[0])),this.firstFrontEdge=this.edges[1],this.edges[1].connectAfter(this.edges[2]),this.firstHullEdge=this.edges[0]}step(){const e=this.remainingVertices.shift(),t=e.point.x;let n=this.firstFrontEdge;for(;n;){if(t>n.endVertex.point.x){const r=new Edge$1(n.startVertex,e),s=new Edge$1(e,n.endVertex);r.connectAfter(s),this.edges.push(r),this.edges.push(s),this.triangles.push(new Triangle(n.endVertex,n.startVertex,e,r,s,n)),this.reconnectFrontEdges(n,n,r,s),this.legalizeEdge(n),this.addHalfPiHeuristic(r,s),this.constrainEdges(e,r,s);break}else if(t===n.endVertex.point.x){const r=n.nextEdge,s=n;assert&&assert(r!==null);const a=n.endVertex,l=r.endVertex,d=s.startVertex,c=new Edge$1(e,l),y=new Edge$1(d,e),m=new Edge$1(a,e);y.connectAfter(c),this.edges.push(c),this.edges.push(y),this.edges.push(m),this.triangles.push(new Triangle(l,a,e,m,c,r)),this.triangles.push(new Triangle(a,d,e,y,m,s)),this.reconnectFrontEdges(s,r,y,c),this.legalizeEdge(r),this.legalizeEdge(s),this.legalizeEdge(m),this.addHalfPiHeuristic(y,c),this.constrainEdges(e,y,c);break}n=n.nextEdge}}fillBorderTriangle(e,t,n,r,s){assert&&assert(e instanceof Edge$1),assert&&assert(t instanceof Edge$1),assert&&assert(n instanceof Vertex$1),assert&&assert(r instanceof Vertex$1),assert&&assert(s instanceof Vertex$1),assert&&assert(r===e.startVertex||r===e.endVertex,"middleVertex should be in firstEdge"),assert&&assert(r===t.startVertex||r===t.endVertex,"middleVertex should be in secondEdge"),assert&&assert(n===e.startVertex||n===e.endVertex,"firstSideVertex should be in firstEdge"),assert&&assert(s===t.startVertex||s===t.endVertex,"secondSideVertex should be in secondEdge");const a=new Edge$1(n,s);return this.edges.push(a),this.triangles.push(new Triangle(s,r,n,e,a,t)),this.legalizeEdge(e),this.legalizeEdge(t),a}reconnectFrontEdges(e,t,n,r){const s=e.previousEdge,a=t.nextEdge;s?(s.disconnectAfter(),s.connectAfter(n)):this.firstFrontEdge=n,a&&(t.disconnectAfter(),r.connectAfter(a))}addHalfPiHeuristic(e,t){assert&&assert(e.endVertex===t.startVertex);const n=e.endVertex;for(;e.previousEdge&&DotUtils.triangleAreaSigned(n.point,e.startVertex.point,e.previousEdge.startVertex.point)>0&&n.point.minus(e.startVertex.point).angleBetween(e.previousEdge.startVertex.point.minus(e.startVertex.point))<Math.PI/2;){const r=e.previousEdge,s=new Edge$1(r.startVertex,n);this.edges.push(s),this.triangles.push(new Triangle(n,e.startVertex,r.startVertex,r,s,e)),this.reconnectFrontEdges(r,e,s,s),this.legalizeEdge(r),this.legalizeEdge(e),e=s}for(;t.nextEdge&&DotUtils.triangleAreaSigned(n.point,t.nextEdge.endVertex.point,t.endVertex.point)>0&&n.point.minus(t.endVertex.point).angleBetween(t.nextEdge.endVertex.point.minus(t.endVertex.point))<Math.PI/2;){const r=t.nextEdge,s=new Edge$1(n,r.endVertex);this.edges.push(s),this.triangles.push(new Triangle(n,t.nextEdge.endVertex,t.endVertex,r,t,s)),this.reconnectFrontEdges(t,r,s,s),this.legalizeEdge(r),this.legalizeEdge(t),t=s}}constrainEdges(e,t,n){assert&&assert(e instanceof Vertex$1),assert&&assert(t instanceof Edge$1),assert&&assert(n instanceof Edge$1),assert&&assert(e===t.endVertex),assert&&assert(e===n.startVertex);for(let r=0;r<e.constrainedVertices.length;r++){const s=e.constrainedVertices[r];if(s===t.startVertex||s===n.endVertex)break;const a=[],l=[];let d=null,c=null;const y=[],m=[];let O=DelaunayTriangulation.vertexProduct(e,t.startVertex,s)>0,D=DelaunayTriangulation.vertexProduct(e,n.endVertex,s)<0;if(!O&&!D){assert&&assert(t.triangles.length===1),assert&&assert(n.triangles.length===1);let w=t.startVertex,N;for(d=t.triangles[0];DelaunayTriangulation.vertexProduct(e,N=d.getEdgeOppositeFromVertex(e).getOtherVertex(w),s)<0;)d=d.getEdgeOppositeFromVertex(w).getOtherTriangle(d),w=N;if(d.hasVertex(s))break;y.push(d),c=d.getEdgeOppositeFromVertex(e),m.push(c),a.push(d.getEdgeOppositeFromVertex(w)),l.push(d.getEdgeOppositeFromVertex(c.getOtherVertex(w))),assert&&assert(a[0].getOtherVertex(e).point.x<l[0].getOtherVertex(e).point.x)}for(;!O;){if(D)break;if(c.triangles.length>1){const w=c.getOtherTriangle(d);if(w.hasVertex(s)){y.push(w),a.push(w.getNextEdge(c)),l.push(w.getPreviousEdge(c));break}else{let N;w.aEdge!==c&&w.aEdge.intersectsConstrainedEdge(e,s)?N=w.aEdge:w.bEdge!==c&&w.bEdge.intersectsConstrainedEdge(e,s)?N=w.bEdge:w.cEdge!==c&&w.cEdge.intersectsConstrainedEdge(e,s)&&(N=w.cEdge),assert&&assert(N),w.getNextEdge(N)===c?a.push(w.getPreviousEdge(N)):l.push(w.getNextEdge(N)),c=N,m.push(c),d=w,y.push(d)}}else s.point.x<e.point.x?D=!0:O=!0}for(let w=0;w<y.length;w++){const N=y[w];arrayRemove(this.triangles,N),N.remove()}for(let w=0;w<m.length;w++)arrayRemove(this.edges,m[w]);const z=new Edge$1(s,e);z.isConstrained=!0,this.edges.push(z),a.push(z),l.push(z),l.reverse(),window.triDebug&&window.triDebug(this),this.triangulatePolygon(a),this.triangulatePolygon(l)}}triangulatePolygon(e){for(;e.length>3;){for(let t=0;t<e.length;t++){const n=t<e.length-1?t+1:0;assert&&assert(e[t].getSharedVertex(e[n]))}for(let t=0;t<e.length;t++){const n=t<e.length-1?t+1:0,r=e[t],s=e[n],a=r.getSharedVertex(s),l=r.getOtherVertex(a),d=s.getOtherVertex(a);if(DotUtils.triangleAreaSigned(l.point,a.point,d.point)<=0)continue;const c=d.point.minus(a.point),y=l.point.minus(a.point),m=c.dot(c),O=c.dot(y),D=y.dot(y),z=m*D-O*O;let w=e[0].getSharedVertex(e[e.length-1]),N=!1;for(let H=0;H<e.length;H++){const X=e[H].getOtherVertex(w);if(X!==a&&X!==l&&X!==d){const ae=X.point.minus(a.point),oe=c.dot(ae),ue=y.dot(ae),fe=(D*oe-O*ue)/z,be=(m*ue-O*oe)/z;if(fe>=-1e-10&&be>=-1e-10&&fe+be<1+1e-10){N=!0;break}}w=X}if(!N){const H=new Edge$1(l,d);this.edges.push(H),this.triangles.push(new Triangle(l,a,d,s,H,r)),n>t?e.splice(t,2,H):(e.splice(t,1,H),e.splice(n,1)),window.triDebug&&window.triDebug(this)}}}e.length===3&&(this.triangles.push(new Triangle(e[0].getSharedVertex(e[1]),e[1].getSharedVertex(e[2]),e[0].getSharedVertex(e[2]),e[2],e[0],e[1])),window.triDebug&&window.triDebug(this))}finalize(){const e=[];let t=this.firstFrontEdge.nextEdge;for(;t&&t.nextEdge;)e.push(t),t=t.nextEdge;const n=this.firstFrontEdge,r=t;assert&&assert(this.firstFrontEdge.triangles.length===1),assert&&assert(r.triangles.length===1);for(let d=0;d<e.length-1;d++){const c=e[d],y=e[d+1];if(DotUtils.triangleAreaSigned(y.endVertex.point,c.endVertex.point,c.startVertex.point)>1e-10){const m=this.fillBorderTriangle(c,y,c.startVertex,c.endVertex,y.endVertex);e.splice(d,2,m),d=Math.max(d-2,-1),window.triDebug&&window.triDebug(this)}}this.firstFrontEdge=null;const s=[],a=[n];let l=n;for(;l!==r;){const d=l.triangles[0];d.remove(),arrayRemove(this.triangles,d);const c=d.getNonArtificialEdge();if(c){s.push(c);const y=c.getSharedVertex(l);l=d.getEdgeOppositeFromVertex(y)}else assert&&assert(l.startVertex===this.artificialMaxVertex),a.push(d.getEdgeOppositeFromVertex(l.endVertex)),l=d.getEdgeOppositeFromVertex(l.startVertex);a.push(l)}for(let d=0;d<a.length;d++)arrayRemove(this.edges,a[d]);window.triDebug&&window.triDebug(this);for(let d=0;d<s.length-1;d++){const c=s[d+1],y=s[d],m=c.getSharedVertex(y),O=c.getOtherVertex(m),D=y.getOtherVertex(m);if(DotUtils.triangleAreaSigned(D.point,m.point,O.point)>1e-10){const z=this.fillBorderTriangle(c,y,O,m,D);s.splice(d,2,z),d=Math.max(d-2,-1),window.triDebug&&window.triDebug(this)}}for(let d=0;d<e.length;d++)this.convexHull.push(e[d].startVertex);this.convexHull.push(e[e.length-1].endVertex);for(let d=s.length-1;d>=1;d--)this.convexHull.push(s[d].getSharedVertex(s[d-1]))}legalizeEdge(e){if(!_.includes(this.edges,e)||e.triangles.length!==2||e.isConstrained)return;const t=e.triangles[0],n=e.triangles[1],r=t.getVertexOppositeFromEdge(e),s=n.getVertexOppositeFromEdge(e);if(DotUtils.pointInCircleFromPoints(t.aVertex.point,t.bVertex.point,t.cVertex.point,s.point)||DotUtils.pointInCircleFromPoints(n.aVertex.point,n.bVertex.point,n.cVertex.point,r.point)){t.remove(),n.remove(),arrayRemove(this.triangles,t),arrayRemove(this.triangles,n),arrayRemove(this.edges,e);const a=new Edge$1(r,s);this.edges.push(a);const l=n.getEdgeOppositeFromVertex(n.getVertexBefore(s)),d=t.getEdgeOppositeFromVertex(t.getVertexAfter(r)),c=t.getEdgeOppositeFromVertex(t.getVertexBefore(r)),y=n.getEdgeOppositeFromVertex(n.getVertexAfter(s));this.triangles.push(new Triangle(r,s,t.getVertexBefore(r),l,d,a)),this.triangles.push(new Triangle(s,r,n.getVertexBefore(s),c,y,a)),this.legalizeEdge(l),this.legalizeEdge(d),this.legalizeEdge(c),this.legalizeEdge(y)}}static vertexComparison(e,t){return assert&&assert(e instanceof Vertex$1),assert&&assert(t instanceof Vertex$1),e=e.point,t=t.point,e.y<t.y?-1:e.y>t.y?1:e.x<t.x?-1:e.x>t.x?1:0}static vertexProduct(e,t,n){const r=t.point.minus(e.point),s=n.point.minus(e.point);return r.crossScalar(s)}}dot.register("DelaunayTriangulation",DelaunayTriangulation);let Vertex$1=class{constructor(e,t){assert&&assert(e instanceof Vector2),assert&&assert(e.isFinite()),assert&&assert(typeof t=="number"),this.point=e,this.index=t,this.sortedIndex=-1,this.constrainedVertices=[]}isArtificial(){return this.index<0}},Edge$1=class Ph{constructor(e,t){assert&&assert(e instanceof Vertex$1),assert&&assert(t instanceof Vertex$1),assert&&assert(e!==t,"Should be different vertices"),this.startVertex=e,this.endVertex=t,this.triangles=[],this.nextEdge=null,this.previousEdge=null,this.isConstrained=!1}isArtificial(){return this.startVertex.isArtificial()||this.endVertex.isArtificial()}connectAfter(e){assert&&assert(e instanceof Ph),assert&&assert(this.endVertex===e.startVertex),this.nextEdge=e,e.previousEdge=this}disconnectAfter(){this.nextEdge.previousEdge=null,this.nextEdge=null}addTriangle(e){assert&&assert(e instanceof Triangle),assert&&assert(this.triangles.length<=1),this.triangles.push(e)}removeTriangle(e){assert&&assert(e instanceof Triangle),assert&&assert(_.includes(this.triangles,e)),arrayRemove(this.triangles,e)}getSharedTriangle(e){assert&&assert(e instanceof Ph);for(let t=0;t<this.triangles.length;t++){const n=this.triangles[t];for(let r=0;r<e.triangles.length;r++)if(e.triangles[r]===n)return n}throw new Error("No common triangle")}getSharedVertex(e){return assert&&assert(e instanceof Ph),this.startVertex===e.startVertex||this.startVertex===e.endVertex?this.startVertex:(assert&&assert(this.endVertex===e.startVertex||this.endVertex===e.endVertex),this.endVertex)}getOtherVertex(e){return assert&&assert(e instanceof Vertex$1),assert&&assert(e===this.startVertex||e===this.endVertex),e===this.startVertex?this.endVertex:this.startVertex}getOtherTriangle(e){return assert&&assert(e instanceof Triangle),assert&&assert(this.triangles.length===2),this.triangles[0]===e?this.triangles[1]:this.triangles[0]}intersectsConstrainedEdge(e,t){return DotUtils.lineSegmentIntersection(e.point.x,e.point.y,t.point.x,t.point.y,this.startVertex.point.x,this.startVertex.point.y,this.endVertex.point.x,this.endVertex.point.y)}};class Triangle{constructor(e,t,n,r,s,a){assert&&assert(e instanceof Vertex$1),assert&&assert(t instanceof Vertex$1),assert&&assert(n instanceof Vertex$1),assert&&assert(r instanceof Edge$1),assert&&assert(s instanceof Edge$1),assert&&assert(a instanceof Edge$1),assert&&assert(e!==r.startVertex&&e!==r.endVertex,"Should be an opposite edge"),assert&&assert(t!==s.startVertex&&t!==s.endVertex,"Should be an opposite edge"),assert&&assert(n!==a.startVertex&&n!==a.endVertex,"Should be an opposite edge"),assert&&assert(e===s.startVertex||e===s.endVertex,"aVertex should be in bEdge"),assert&&assert(e===a.startVertex||e===a.endVertex,"aVertex should be in cEdge"),assert&&assert(t===r.startVertex||t===r.endVertex,"bVertex should be in aEdge"),assert&&assert(t===a.startVertex||t===a.endVertex,"bVertex should be in cEdge"),assert&&assert(n===r.startVertex||n===r.endVertex,"cVertex should be in aEdge"),assert&&assert(n===s.startVertex||n===s.endVertex,"cVertex should be in bEdge"),assert&&assert(DotUtils.triangleAreaSigned(e.point,t.point,n.point)>0,"Should be counterclockwise"),this.aVertex=e,this.bVertex=t,this.cVertex=n,this.aEdge=r,this.bEdge=s,this.cEdge=a,this.aEdge.addTriangle(this),this.bEdge.addTriangle(this),this.cEdge.addTriangle(this)}hasVertex(e){return this.aVertex===e||this.bVertex===e||this.cVertex===e}getVertexOppositeFromEdge(e){return assert&&assert(e instanceof Edge$1),assert&&assert(e===this.aEdge||e===this.bEdge||e===this.cEdge,"Should be an edge that is part of this triangle"),e===this.aEdge?this.aVertex:e===this.bEdge?this.bVertex:this.cVertex}getEdgeOppositeFromVertex(e){return assert&&assert(e instanceof Vertex$1),assert&&assert(e===this.aVertex||e===this.bVertex||e===this.cVertex,"Should be a vertex that is part of this triangle"),e===this.aVertex?this.aEdge:e===this.bVertex?this.bEdge:this.cEdge}getVertexBefore(e){return assert&&assert(e instanceof Vertex$1),assert&&assert(e===this.aVertex||e===this.bVertex||e===this.cVertex),e===this.aVertex?this.cVertex:e===this.bVertex?this.aVertex:this.bVertex}getVertexAfter(e){return assert&&assert(e instanceof Vertex$1),assert&&assert(e===this.aVertex||e===this.bVertex||e===this.cVertex),e===this.aVertex?this.bVertex:e===this.bVertex?this.cVertex:this.aVertex}getNonArtificialEdge(){return assert&&assert(this.aEdge.isArtificial()&&this.bEdge.isArtificial()&&!this.cEdge.isArtificial()||this.aEdge.isArtificial()&&!this.bEdge.isArtificial()&&this.cEdge.isArtificial()||!this.aEdge.isArtificial()&&this.bEdge.isArtificial()&&this.cEdge.isArtificial()||this.aEdge.isArtificial()&&this.bEdge.isArtificial()&&this.cEdge.isArtificial(),"At most one edge should be non-artificial"),this.aEdge.isArtificial()?this.bEdge.isArtificial()?this.cEdge.isArtificial()?null:this.cEdge:this.bEdge:this.aEdge}getNextEdge(e){if(assert&&assert(e===this.aEdge||e===this.bEdge||e===this.cEdge),this.aEdge===e)return this.bEdge;if(this.bEdge===e)return this.cEdge;if(this.cEdge===e)return this.aEdge;throw new Error("illegal edge")}getPreviousEdge(e){if(assert&&assert(e===this.aEdge||e===this.bEdge||e===this.cEdge),this.aEdge===e)return this.cEdge;if(this.bEdge===e)return this.aEdge;if(this.cEdge===e)return this.bEdge;throw new Error("illegal edge")}isArtificial(){return this.aVertex.isArtificial()||this.bVertex.isArtificial()||this.cVertex.isArtificial()}remove(){this.aEdge.removeTriangle(this),this.bEdge.removeTriangle(this),this.cEdge.removeTriangle(this)}}const STATE_SCHEMA={width:InfiniteNumberIO,height:InfiniteNumberIO},Fo=class Fo{constructor(e,t){this.width=e,this.height=t}toString(){return`[${this.width}w, ${this.height}h]`}set(e){return this.width=e.width,this.height=e.height,this}setWidth(e){return this.width=e,this}setHeight(e){return this.height=e,this}copy(e){return e?e.set(this):new Fo(this.width,this.height)}swapped(){return new Fo(this.height,this.width)}toBounds(e,t){return e=e!==void 0?e:0,t=t!==void 0?t:0,new Bounds2(e,t,this.width+e,this.height+t)}equals(e){return this.width===e.width&&this.height===e.height}toStateObject(){return{width:InfiniteNumberIO.toStateObject(this.width),height:InfiniteNumberIO.toStateObject(this.height)}}static fromStateObject(e){return new Fo(InfiniteNumberIO.fromStateObject(e.width),InfiniteNumberIO.fromStateObject(e.height))}};Fo.Dimension2IO=new IOType("Dimension2IO",{valueType:Fo,documentation:'A dimension with "width" and "height" members.',stateSchema:STATE_SCHEMA,toStateObject:e=>e.toStateObject(),fromStateObject:e=>Fo.fromStateObject(e)});let Dimension2=Fo;dot.register("Dimension2",Dimension2);const Al=class Al{constructor(e){this.seed=null,this.seedrandom=null,this.numberOfCalls=0;const t=optionize()({seed:null},e);this.setSeed(t.seed),Al.allRandomInstances.add(this)}dispose(){Al.allRandomInstances.delete(this)}getSeed(){return this.seed}nextBoolean(){return this.nextDouble()>=.5}nextInt(e){const t=this.nextDouble()*e;return Math.floor(t)}nextIntBetween(e,t){assert&&assert(Number.isInteger(e),`min must be an integer: ${e}`),assert&&assert(Number.isInteger(t),`max must be an integer: ${t}`);const n=t-e;return this.nextInt(n+1)+e}sample(e){assert&&assert(e.length>0,"Array should have at least 1 item.");const t=this.nextIntBetween(0,e.length-1);return e[t]}shuffle(e){let t=-1;const n=new Array(e.length);return _.forEach(e,r=>{const s=this.nextIntBetween(0,++t);n[t]=n[s],n[s]=r}),n}nextDouble(){return this.numberOfCalls++,this.seedrandom()}nextDoubleBetween(e,t){assert&&assert(e<t,"min must be < max");const n=e+this.nextDouble()*(t-e);return assert&&assert(n>=e&&n<t,`value out of range: ${n}`),n}nextGaussian(){return DotUtils.boxMullerTransform(0,1,this)}nextDoubleInRange(e){return e.min<e.max?this.nextDoubleBetween(e.min,e.max):e.min}nextPointInBounds(e){return new Vector2(this.nextDoubleBetween(e.minX,e.maxX),this.nextDoubleBetween(e.minY,e.maxY))}setSeed(e){typeof e=="number"?assert&&assert(Math.seedrandom,"If a seed is specified, then we must also have Math.seedrandom to use the seed."):e=Math.random(),this.seed=e,this.seedrandom=Math.seedrandom?new Math.seedrandom(`${e}`):()=>Math.random()}sampleProbabilities(e){const n=_.sum(e)*this.nextDouble();let r=0;for(let s=0;s<e.length;s++)if(r+=e[s],r>=n)return s;return assert&&assert(e[e.length-1]!==0,"if last weight is zero, should have selected something beforehand"),e.length-1}};Al.allRandomInstances=new Set;let Random=Al;dot.register("Random",Random);const dotRandom=new Random({seed:_.hasIn(window,"phet.chipper.queryParameters.randomSeed")?window.phet.chipper.queryParameters.randomSeed:null});dot.register("dotRandom",dotRandom);const ArrayType$4=window.Float64Array||Array;class LUDecomposition{constructor(e){let t,n,r;this.matrix=e,this.LU=e.getArrayCopy();const s=this.LU;this.m=e.getRowDimension();const a=this.m;this.n=e.getColumnDimension();const l=this.n;for(this.piv=new Uint32Array(a),t=0;t<a;t++)this.piv[t]=t;this.pivsign=1;const d=new ArrayType$4(a);for(n=0;n<l;n++){for(t=0;t<a;t++)d[t]=s[e.index(t,n)];for(t=0;t<a;t++){const y=Math.min(t,n);let m=0;for(r=0;r<y;r++){const O=e.index(t,r);m+=s[O]*d[r]}d[t]-=m,s[e.index(t,n)]=d[t]}let c=n;for(t=n+1;t<a;t++)Math.abs(d[t])>Math.abs(d[c])&&(c=t);if(c!==n){for(r=0;r<l;r++){const y=e.index(c,r),m=e.index(n,r),O=s[y];s[y]=s[m],s[m]=O}r=this.piv[c],this.piv[c]=this.piv[n],this.piv[n]=r,this.pivsign=-this.pivsign}if(n<a&&s[this.matrix.index(n,n)]!==0)for(t=n+1;t<a;t++)s[e.index(t,n)]/=s[e.index(n,n)]}}isNonsingular(){for(let e=0;e<this.n;e++){const t=this.matrix.index(e,e);if(this.LU[t]===0)return!1}return!0}getL(){const e=new Matrix$1(this.m,this.n);for(let t=0;t<this.m;t++)for(let n=0;n<this.n;n++)t>n?e.entries[e.index(t,n)]=this.LU[this.matrix.index(t,n)]:t===n?e.entries[e.index(t,n)]=1:e.entries[e.index(t,n)]=0;return e}getU(){const e=new Matrix$1(this.n,this.n);for(let t=0;t<this.n;t++)for(let n=0;n<this.n;n++)t<=n?e.entries[e.index(t,n)]=this.LU[this.matrix.index(t,n)]:e.entries[e.index(t,n)]=0;return e}getPivot(){const e=new Uint32Array(this.m);for(let t=0;t<this.m;t++)e[t]=this.piv[t];return e}getDoublePivot(){const e=new ArrayType$4(this.m);for(let t=0;t<this.m;t++)e[t]=this.piv[t];return e}det(){if(this.m!==this.n)throw new Error("Matrix must be square.");let e=this.pivsign;for(let t=0;t<this.n;t++)e*=this.LU[this.matrix.index(t,t)];return e}solve(e){let t,n,r;if(e.getRowDimension()!==this.m)throw new Error("Matrix row dimensions must agree.");if(!this.isNonsingular())throw new Error("Matrix is singular.");const s=e.getColumnDimension(),a=e.getArrayRowMatrix(this.piv,0,s-1);for(r=0;r<this.n;r++)for(t=r+1;t<this.n;t++)for(n=0;n<s;n++)a.entries[a.index(t,n)]-=a.entries[a.index(r,n)]*this.LU[this.matrix.index(t,r)];for(r=this.n-1;r>=0;r--){for(n=0;n<s;n++)a.entries[a.index(r,n)]/=this.LU[this.matrix.index(r,r)];for(t=0;t<r;t++)for(n=0;n<s;n++)a.entries[a.index(t,n)]-=a.entries[a.index(r,n)]*this.LU[this.matrix.index(t,r)]}return a}}dot.register("LUDecomposition",LUDecomposition);const ArrayType$3=window.Float64Array||Array;class QRDecomposition{constructor(e){this.matrix=e,this.QR=e.getArrayCopy();const t=this.QR;this.m=e.getRowDimension();const n=this.m;this.n=e.getColumnDimension();const r=this.n;this.Rdiag=new ArrayType$3(r);let s,a,l;for(l=0;l<r;l++){let d=0;for(s=l;s<n;s++)d=Matrix$1.hypot(d,t[this.matrix.index(s,l)]);if(d!==0){for(t[this.matrix.index(l,l)]<0&&(d=-d),s=l;s<n;s++)t[this.matrix.index(s,l)]/=d;for(t[this.matrix.index(l,l)]+=1,a=l+1;a<r;a++){let c=0;for(s=l;s<n;s++)c+=t[this.matrix.index(s,l)]*t[this.matrix.index(s,a)];for(c=-c/t[this.matrix.index(l,l)],s=l;s<n;s++)t[this.matrix.index(s,a)]+=c*t[this.matrix.index(s,l)]}}this.Rdiag[l]=-d}}isFullRank(){for(let e=0;e<this.n;e++)if(this.Rdiag[e]===0)return!1;return!0}getH(){const e=new Matrix$1(this.m,this.n);for(let t=0;t<this.m;t++)for(let n=0;n<this.n;n++)t>=n?e.entries[e.index(t,n)]=this.QR[this.matrix.index(t,n)]:e.entries[e.index(t,n)]=0;return e}getR(){const e=new Matrix$1(this.n,this.n);for(let t=0;t<this.n;t++)for(let n=0;n<this.n;n++)t<n?e.entries[e.index(t,n)]=this.QR[this.matrix.index(t,n)]:t===n?e.entries[e.index(t,n)]=this.Rdiag[t]:e.entries[e.index(t,n)]=0;return e}getQ(){let e,t,n;const r=new Matrix$1(this.m,this.n);for(n=this.n-1;n>=0;n--){for(e=0;e<this.m;e++)r.entries[r.index(e,n)]=0;for(r.entries[r.index(n,n)]=1,t=n;t<this.n;t++)if(this.QR[this.matrix.index(n,n)]!==0){let s=0;for(e=n;e<this.m;e++)s+=this.QR[this.matrix.index(e,n)]*r.entries[r.index(e,t)];for(s=-s/this.QR[this.matrix.index(n,n)],e=n;e<this.m;e++)r.entries[r.index(e,t)]+=s*this.QR[this.matrix.index(e,n)]}}return r}solve(e){if(e.getRowDimension()!==this.m)throw new Error("Matrix row dimensions must agree.");if(!this.isFullRank())throw new Error("Matrix is rank deficient.");let t,n,r;const s=e.getColumnDimension(),a=e.getArrayCopy();for(r=0;r<this.n;r++)for(n=0;n<s;n++){let l=0;for(t=r;t<this.m;t++)l+=this.QR[this.matrix.index(t,r)]*a[e.index(t,n)];for(l=-l/this.QR[this.matrix.index(r,r)],t=r;t<this.m;t++)a[e.index(t,n)]+=l*this.QR[this.matrix.index(t,r)]}for(r=this.n-1;r>=0;r--){for(n=0;n<s;n++)a[e.index(r,n)]/=this.Rdiag[r];for(t=0;t<r;t++)for(n=0;n<s;n++)a[e.index(t,n)]-=a[e.index(r,n)]*this.QR[this.matrix.index(t,r)]}return new Matrix$1(this.n,s,a,!0).getMatrix(0,this.n-1,0,s-1)}}dot.register("QRDecomposition",QRDecomposition);const ArrayType$2=window.Float64Array||Array;class SingularValueDecomposition{constructor(e){this.matrix=e;const t=e,n=t.getArrayCopy();this.m=t.getRowDimension(),this.n=t.getColumnDimension();const r=this.m,s=this.n,a=Math.min,l=Math.max,d=Math.pow,c=Math.abs,y=a(r,s);this.s=new ArrayType$2(a(r+1,s));const m=this.s;this.U=new ArrayType$2(r*y);const O=this.U;this.V=new ArrayType$2(s*s);const D=this.V,z=new ArrayType$2(s),w=new ArrayType$2(r);let N,H,X,ae,oe,ue,fe;const be=Matrix$1.hypot,Ae=a(r-1,s),W=l(0,a(s-2,r));for(X=0;X<l(Ae,W);X++){if(X<Ae){for(m[X]=0,N=X;N<r;N++)m[X]=be(m[X],n[N*s+X]);if(m[X]!==0){for(n[X*s+X]<0&&(m[X]=-m[X]),N=X;N<r;N++)n[N*s+X]/=m[X];n[X*s+X]+=1}m[X]=-m[X]}for(H=X+1;H<s;H++){if(X<Ae&&m[X]!==0){for(ae=0,N=X;N<r;N++)ae+=n[N*s+X]*n[N*s+H];for(ae=-ae/n[X*s+X],N=X;N<r;N++)n[N*s+H]+=ae*n[N*s+X]}z[H]=n[X*s+H]}if(X<Ae)for(N=X;N<r;N++)O[N*y+X]=n[N*s+X];if(X<W){for(z[X]=0,N=X+1;N<s;N++)z[X]=be(z[X],z[N]);if(z[X]!==0){for(z[X+1]<0&&(z[X]=-z[X]),N=X+1;N<s;N++)z[N]/=z[X];z[X+1]+=1}if(z[X]=-z[X],X+1<r&&z[X]!==0){for(N=X+1;N<r;N++)w[N]=0;for(H=X+1;H<s;H++)for(N=X+1;N<r;N++)w[N]+=z[H]*n[N*s+H];for(H=X+1;H<s;H++)for(ae=-z[H]/z[X+1],N=X+1;N<r;N++)n[N*s+H]+=ae*w[N]}for(N=X+1;N<s;N++)D[N*s+X]=z[N]}}let J=a(s,r+1);Ae<s&&(m[Ae]=n[Ae*s+Ae]),r<J&&(m[J-1]=0),W+1<J&&(z[W]=n[W*s+J-1]),z[J-1]=0;{for(H=Ae;H<y;H++){for(N=0;N<r;N++)O[N*y+H]=0;O[H*y+H]=1}for(X=Ae-1;X>=0;X--)if(m[X]!==0){for(H=X+1;H<y;H++){for(ae=0,N=X;N<r;N++)ae+=O[N*y+X]*O[N*y+H];for(ae=-ae/O[X*y+X],N=X;N<r;N++)O[N*y+H]+=ae*O[N*y+X]}for(N=X;N<r;N++)O[N*y+X]=-O[N*y+X];for(O[X*y+X]=1+O[X*y+X],N=0;N<X-1;N++)O[N*y+X]=0}else{for(N=0;N<r;N++)O[N*y+X]=0;O[X*y+X]=1}}for(X=s-1;X>=0;X--){if(X<W&&z[X]!==0)for(H=X+1;H<y;H++){for(ae=0,N=X+1;N<s;N++)ae+=D[N*s+X]*D[N*s+H];for(ae=-ae/D[(X+1)*s+X],N=X+1;N<s;N++)D[N*s+H]+=ae*D[N*s+X]}for(N=0;N<s;N++)D[N*s+X]=0;D[X*s+X]=1}const Ue=J-1;let gt=0;const Te=d(2,-52),Et=d(2,-966);for(;J>0;){let Bt;if(gt>500)break;for(X=J-2;X>=-1&&X!==-1;X--)if(c(z[X])<=Et+Te*(c(m[X])+c(m[X+1]))){z[X]=0;break}if(X===J-2)Bt=4;else{let Ke;for(Ke=J-1;Ke>=X&&Ke!==X;Ke--)if(ae=(Ke!==J?c(z[Ke]):0)+(Ke!==X+1?c(z[Ke-1]):0),c(m[Ke])<=Et+Te*ae){m[Ke]=0;break}Ke===X?Bt=3:Ke===J-1?Bt=1:(Bt=2,X=Ke)}switch(X++,Bt){case 1:for(oe=z[J-2],z[J-2]=0,H=J-2;H>=X;H--)for(ae=be(m[H],oe),ue=m[H]/ae,fe=oe/ae,m[H]=ae,H!==X&&(oe=-fe*z[H-1],z[H-1]=ue*z[H-1]),N=0;N<s;N++)ae=ue*D[N*s+H]+fe*D[N*s+J-1],D[N*s+J-1]=-fe*D[N*s+H]+ue*D[N*s+J-1],D[N*s+H]=ae;break;case 2:for(oe=z[X-1],z[X-1]=0,H=X;H<J;H++)for(ae=be(m[H],oe),ue=m[H]/ae,fe=oe/ae,m[H]=ae,oe=-fe*z[H],z[H]=ue*z[H],N=0;N<r;N++)ae=ue*O[N*y+H]+fe*O[N*y+X-1],O[N*y+X-1]=-fe*O[N*y+H]+ue*O[N*y+X-1],O[N*y+H]=ae;break;case 3:{const Ke=l(l(l(l(c(m[J-1]),c(m[J-2])),c(z[J-2])),c(m[X])),c(z[X])),At=m[J-1]/Ke,nt=m[J-2]/Ke,dt=z[J-2]/Ke,Mt=m[X]/Ke,zt=z[X]/Ke,xt=((nt+At)*(nt-At)+dt*dt)/2,Gt=At*dt*(At*dt);let yi=0;(xt!==0||Gt!==0)&&(yi=Math.sqrt(xt*xt+Gt),xt<0&&(yi=-yi),yi=Gt/(xt+yi)),oe=(Mt+At)*(Mt-At)+yi;let ti=Mt*zt;for(H=X;H<J-1;H++){for(ae=be(oe,ti),ue=oe/ae,fe=ti/ae,H!==X&&(z[H-1]=ae),oe=ue*m[H]+fe*z[H],z[H]=ue*z[H]-fe*m[H],ti=fe*m[H+1],m[H+1]=ue*m[H+1],N=0;N<s;N++)ae=ue*D[N*s+H]+fe*D[N*s+H+1],D[N*s+H+1]=-fe*D[N*s+H]+ue*D[N*s+H+1],D[N*s+H]=ae;if(ae=be(oe,ti),ue=oe/ae,fe=ti/ae,m[H]=ae,oe=ue*z[H]+fe*m[H+1],m[H+1]=-fe*z[H]+ue*m[H+1],ti=fe*z[H+1],z[H+1]=ue*z[H+1],H<r-1)for(N=0;N<r;N++)ae=ue*O[N*y+H]+fe*O[N*y+H+1],O[N*y+H+1]=-fe*O[N*y+H]+ue*O[N*y+H+1],O[N*y+H]=ae}z[J-2]=oe,gt=gt+1}break;case 4:{if(m[X]<=0)for(m[X]=m[X]<0?-m[X]:0,N=0;N<=Ue;N++)D[N*s+X]=-D[N*s+X];for(;X<Ue&&!(m[X]>=m[X+1]);){if(ae=m[X],m[X]=m[X+1],m[X+1]=ae,X<s-1)for(N=0;N<s;N++)ae=D[N*s+X+1],D[N*s+X+1]=D[N*s+X],D[N*s+X]=ae;if(X<r-1)for(N=0;N<r;N++)ae=O[N*y+X+1],O[N*y+X+1]=O[N*y+X],O[N*y+X]=ae;X++}gt=0,J--}break;default:throw new Error(`invalid kase: ${Bt}`)}}}getU(){return new Matrix$1(this.m,Math.min(this.m+1,this.n),this.U,!0)}getV(){return new Matrix$1(this.n,this.n,this.V,!0)}getSingularValues(){return this.s}getS(){const e=new Matrix$1(this.n,this.n);for(let t=0;t<this.n;t++){for(let n=0;n<this.n;n++)e.entries[e.index(t,n)]=0;e.entries[e.index(t,t)]=this.s[t]}return e}norm2(){return this.s[0]}cond(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}rank(){const e=Math.pow(2,-23),t=Math.max(this.m,this.n)*this.s[0]*e;let n=0;for(let r=0;r<this.s.length;r++)this.s[r]>t&&n++;return n}static pseudoinverse(e){const t=new SingularValueDecomposition(e),n=Matrix$1.diagonalMatrix(t.getSingularValues().map(r=>Math.abs(r)<1e-300?0:1/r));return t.getV().times(n).times(t.getU().transpose())}}dot.register("SingularValueDecomposition",SingularValueDecomposition);const ArrayType$1=window.Float64Array||Array;class Matrix{constructor(e,t,n,r){this.m=e,this.n=t;const s=e*t;this.size=s;let a;if(r)this.entries=n;else if(n||(n=0),this.entries=new ArrayType$1(s),isArray(n))for(assert&&assert(n.length===s),a=0;a<s;a++)this.entries[a]=n[a];else for(a=0;a<s;a++)this.entries[a]=n}copy(){const e=new Matrix(this.m,this.n);for(let t=0;t<this.size;t++)e.entries[t]=this.entries[t];return e}getArray(){return this.entries}getArrayCopy(){return new ArrayType$1(this.entries)}getRowDimension(){return this.m}getColumnDimension(){return this.n}index(e,t){return e*this.n+t}get(e,t){return this.entries[this.index(e,t)]}set(e,t,n){this.entries[this.index(e,t)]=n}getMatrix(e,t,n,r){const s=new Matrix(t-e+1,r-n+1);for(let a=e;a<=t;a++)for(let l=n;l<=r;l++)s.entries[s.index(a-e,l-n)]=this.entries[this.index(a,l)];return s}getArrayRowMatrix(e,t,n){const r=new Matrix(e.length,n-t+1);for(let s=0;s<e.length;s++)for(let a=t;a<=n;a++)r.entries[r.index(s,a-t)]=this.entries[this.index(e[s],a)];return r}transpose(e){e=e||new Matrix(this.n,this.m),assert&&assert(e.m===this.n),assert&&assert(e.n===this.m);for(let t=0;t<this.m;t++)for(let n=0;n<this.n;n++)e.entries[e.index(n,t)]=this.entries[this.index(t,n)];return e}norm1(){let e=0;for(let t=0;t<this.n;t++){let n=0;for(let r=0;r<this.m;r++)n+=Math.abs(this.entries[this.index(r,t)]);e=Math.max(e,n)}return e}norm2(){return new SingularValueDecomposition(this).norm2()}normInf(){let e=0;for(let t=0;t<this.m;t++){let n=0;for(let r=0;r<this.n;r++)n+=Math.abs(this.entries[this.index(t,r)]);e=Math.max(e,n)}return e}normF(){let e=0;for(let t=0;t<this.m;t++)for(let n=0;n<this.n;n++)e=Matrix.hypot(e,this.entries[this.index(t,n)]);return e}uminus(){const e=new Matrix(this.m,this.n);for(let t=0;t<this.m;t++)for(let n=0;n<this.n;n++)e.entries[e.index(t,n)]=-this.entries[this.index(t,n)];return e}plus(e){this.checkMatrixDimensions(e);const t=new Matrix(this.m,this.n);for(let n=0;n<this.m;n++)for(let r=0;r<this.n;r++){const s=t.index(n,r);t.entries[s]=this.entries[s]+e.entries[s]}return t}plusEquals(e){this.checkMatrixDimensions(e);for(let t=0;t<this.m;t++)for(let n=0;n<this.n;n++){const r=this.index(t,n);this.entries[r]=this.entries[r]+e.entries[r]}return this}blendEquals(e,t){this.checkMatrixDimensions(e);for(let n=0;n<this.m;n++)for(let r=0;r<this.n;r++){const s=this.index(n,r),a=this.entries[s],l=e.entries[s];this.entries[s]=a+(l-a)*t}return this}minus(e){this.checkMatrixDimensions(e);const t=new Matrix(this.m,this.n);for(let n=0;n<this.m;n++)for(let r=0;r<this.n;r++){const s=this.index(n,r);t.entries[s]=this.entries[s]-e.entries[s]}return t}minusEquals(e){this.checkMatrixDimensions(e);for(let t=0;t<this.m;t++)for(let n=0;n<this.n;n++){const r=this.index(t,n);this.entries[r]=this.entries[r]-e.entries[r]}return this}arrayTimes(e){this.checkMatrixDimensions(e);const t=new Matrix(this.m,this.n);for(let n=0;n<this.m;n++)for(let r=0;r<this.n;r++){const s=t.index(n,r);t.entries[s]=this.entries[s]*e.entries[s]}return t}arrayTimesEquals(e){this.checkMatrixDimensions(e);for(let t=0;t<this.m;t++)for(let n=0;n<this.n;n++){const r=this.index(t,n);this.entries[r]=this.entries[r]*e.entries[r]}return this}arrayRightDivide(e){this.checkMatrixDimensions(e);const t=new Matrix(this.m,this.n);for(let n=0;n<this.m;n++)for(let r=0;r<this.n;r++){const s=this.index(n,r);t.entries[s]=this.entries[s]/e.entries[s]}return t}arrayRightDivideEquals(e){this.checkMatrixDimensions(e);for(let t=0;t<this.m;t++)for(let n=0;n<this.n;n++){const r=this.index(t,n);this.entries[r]=this.entries[r]/e.entries[r]}return this}arrayLeftDivide(e){this.checkMatrixDimensions(e);const t=new Matrix(this.m,this.n);for(let n=0;n<this.m;n++)for(let r=0;r<this.n;r++){const s=this.index(n,r);t.entries[s]=e.entries[s]/this.entries[s]}return t}arrayLeftDivideEquals(e){this.checkMatrixDimensions(e);for(let t=0;t<this.m;t++)for(let n=0;n<this.n;n++){const r=this.index(t,n);this.entries[r]=e.entries[r]/this.entries[r]}return this}times(e){let t,n,r,s,a,l;if(e.isMatrix){if(l=e,l.m!==this.n)throw new Error("Matrix inner dimensions must agree.");t=new Matrix(this.m,l.n);const d=new ArrayType$1(this.n);for(r=0;r<l.n;r++){for(s=0;s<this.n;s++)d[s]=l.entries[l.index(s,r)];for(n=0;n<this.m;n++){for(a=0,s=0;s<this.n;s++)a+=this.entries[this.index(n,s)]*d[s];t.entries[t.index(n,r)]=a}}return t}else{for(a=e,t=new Matrix(this.m,this.n),n=0;n<this.m;n++)for(r=0;r<this.n;r++)t.entries[t.index(n,r)]=a*this.entries[this.index(n,r)];return t}}timesEquals(e){for(let t=0;t<this.m;t++)for(let n=0;n<this.n;n++){const r=this.index(t,n);this.entries[r]=e*this.entries[r]}return this}solve(e){return this.m===this.n?new LUDecomposition(this).solve(e):new QRDecomposition(this).solve(e)}solveTranspose(e){return this.transpose().solve(e.transpose())}inverse(){return this.solve(Matrix.identity(this.m,this.m))}det(){return new LUDecomposition(this).det()}rank(){return new SingularValueDecomposition(this).rank()}cond(){return new SingularValueDecomposition(this).cond()}trace(){let e=0;for(let t=0;t<Math.min(this.m,this.n);t++)e+=this.entries[this.index(t,t)];return e}checkMatrixDimensions(e){if(e.m!==this.m||e.n!==this.n)throw new Error("Matrix dimensions must agree.")}toString(){let e="";e+=`dim: ${this.getRowDimension()}x${this.getColumnDimension()}
`;for(let t=0;t<this.getRowDimension();t++){for(let n=0;n<this.getColumnDimension();n++)e+=`${this.get(t,n)} `;e+=`
`}return e}extractVector2(e){return assert&&assert(this.m===2),new Vector2(this.get(0,e),this.get(1,e))}extractVector3(e){return assert&&assert(this.m===3),new Vector3(this.get(0,e),this.get(1,e),this.get(2,e))}extractVector4(e){return assert&&assert(this.m===4),new Vector4(this.get(0,e),this.get(1,e),this.get(2,e),this.get(3,e))}setVectors3(e){const n=e.length;assert&&assert(this.m===3),assert&&assert(this.n===n);for(let r=0;r<n;r++){const s=e[r];this.entries[r]=s.x,this.entries[r+n]=s.y,this.entries[r+2*n]=s.z}return this}static hypot(e,t){let n;return Math.abs(e)>Math.abs(t)?(n=t/e,n=Math.abs(e)*Math.sqrt(1+n*n)):t!==0?(n=e/t,n=Math.abs(t)*Math.sqrt(1+n*n)):n=0,n}static identity(e,t){const n=new Matrix(e,t);for(let r=0;r<e;r++)for(let s=0;s<t;s++)n.entries[n.index(r,s)]=r===s?1:0;return n}static diagonalMatrix(e){const t=e.length,n=new Matrix(t,t);for(let r=0;r<t;r++)n.entries[n.index(r,r)]=e[r];return n}static rowVector2(e){return new Matrix(1,2,[e.x,e.y])}static rowVector3(e){return new Matrix(1,3,[e.x,e.y,e.z])}static rowVector4(e){return new Matrix(1,4,[e.x,e.y,e.z,e.w])}static rowVector(e){if(e.isVector2)return Matrix.rowVector2(e);if(e.isVector3)return Matrix.rowVector3(e);if(e.isVector4)return Matrix.rowVector4(e);throw new Error(`undetected type of vector: ${e.toString()}`)}static columnVector2(e){return new Matrix(2,1,[e.x,e.y])}static columnVector3(e){return new Matrix(3,1,[e.x,e.y,e.z])}static columnVector4(e){return new Matrix(4,1,[e.x,e.y,e.z,e.w])}static columnVector(e){if(e.isVector2)return Matrix.columnVector2(e);if(e.isVector3)return Matrix.columnVector3(e);if(e.isVector4)return Matrix.columnVector4(e);throw new Error(`undetected type of vector: ${e.toString()}`)}static fromVectors2(e){const n=e.length,r=new ArrayType$1(2*n);for(let s=0;s<n;s++){const a=e[s];r[s]=a.x,r[s+n]=a.y}return new Matrix(2,n,r,!0)}static fromVectors3(e){const n=e.length,r=new ArrayType$1(3*n);for(let s=0;s<n;s++){const a=e[s];r[s]=a.x,r[s+n]=a.y,r[s+2*n]=a.z}return new Matrix(3,n,r,!0)}static fromVectors4(e){const n=e.length,r=new ArrayType$1(4*n);for(let s=0;s<n;s++){const a=e[s];r[s]=a.x,r[s+n]=a.y,r[s+2*n]=a.z,r[s+3*n]=a.w}return new Matrix(4,n,r,!0)}}Matrix.prototype.isMatrix=!0;dot.register("Matrix",Matrix);const Matrix$1=Matrix,ArrayType=window.Float64Array||Array;class EigenvalueDecomposition{constructor(e){let t,n;const r=e.entries;this.n=e.getColumnDimension();const s=this.n;for(this.V=new ArrayType(s*s),this.d=new ArrayType(s),this.e=new ArrayType(s),this.issymmetric=!0,n=0;n<s&&this.issymmetric;n++)for(t=0;t<s&&this.issymmetric;t++)this.issymmetric=r[t*this.n+n]===r[n*this.n+t];if(this.issymmetric){for(t=0;t<s;t++)for(n=0;n<s;n++)this.V[t*this.n+n]=r[t*this.n+n];this.tred2(),this.tql2()}else{for(this.H=new ArrayType(s*s),this.ort=new ArrayType(s),n=0;n<s;n++)for(t=0;t<s;t++)this.H[t*this.n+n]=r[t*this.n+n];this.orthes(),this.hqr2()}}getV(){return this.V.copy()}getRealEigenvalues(){return this.d}getImagEigenvalues(){return this.e}getD(){const e=this.n,t=this.d,n=this.e,r=new Matrix$1(e,e),s=r.entries;for(let a=0;a<e;a++){for(let l=0;l<e;l++)s[a*this.n+l]=0;s[a*this.n+a]=t[a],n[a]>0?s[a*this.n+a+1]=n[a]:n[a]<0&&(s[a*this.n+a-1]=n[a])}return r}tred2(){const e=this.n,t=this.V,n=this.d,r=this.e;let s,a,l,d,c,y;for(a=0;a<e;a++)n[a]=t[(e-1)*e+a];for(s=e-1;s>0;s--){let m=0;for(y=0,l=0;l<s;l++)m=m+Math.abs(n[l]);if(m===0)for(r[s]=n[s-1],a=0;a<s;a++)n[a]=t[(s-1)*e+a],t[s*this.n+a]=0,t[a*this.n+s]=0;else{for(l=0;l<s;l++)n[l]/=m,y+=n[l]*n[l];for(d=n[s-1],c=Math.sqrt(y),d>0&&(c=-c),r[s]=m*c,y=y-d*c,n[s-1]=d-c,a=0;a<s;a++)r[a]=0;for(a=0;a<s;a++){for(d=n[a],t[a*this.n+s]=d,c=r[a]+t[a*e+a]*d,l=a+1;l<=s-1;l++)c+=t[l*e+a]*n[l],r[l]+=t[l*e+a]*d;r[a]=c}for(d=0,a=0;a<s;a++)r[a]/=y,d+=r[a]*n[a];const O=d/(y+y);for(a=0;a<s;a++)r[a]-=O*n[a];for(a=0;a<s;a++){for(d=n[a],c=r[a],l=a;l<=s-1;l++)t[l*e+a]-=d*r[l]+c*n[l];n[a]=t[(s-1)*e+a],t[s*this.n+a]=0}}n[s]=y}for(s=0;s<e-1;s++){if(t[(e-1)*e+s]=t[s*e+s],t[s*e+s]=1,y=n[s+1],y!==0){for(l=0;l<=s;l++)n[l]=t[l*e+(s+1)]/y;for(a=0;a<=s;a++){for(c=0,l=0;l<=s;l++)c+=t[l*e+(s+1)]*t[l*e+a];for(l=0;l<=s;l++)t[l*e+a]-=c*n[l]}}for(l=0;l<=s;l++)t[l*e+(s+1)]=0}for(a=0;a<e;a++)n[a]=t[(e-1)*e+a],t[(e-1)*e+a]=0;t[(e-1)*e+(e-1)]=1,r[0]=0}tql2(){const e=this.n,t=this.V,n=this.d,r=this.e;let s,a,l,d,c,y;for(s=1;s<e;s++)r[s-1]=r[s];r[e-1]=0;let m=0,O=0;const D=Math.pow(2,-52);for(d=0;d<e;d++){O=Math.max(O,Math.abs(n[d])+Math.abs(r[d]));let z=d;for(;z<e&&!(Math.abs(r[z])<=D*O);)z++;if(z>d)do{c=n[d],y=(n[d+1]-c)/(2*r[d]);let w=Matrix$1.hypot(y,1);y<0&&(w=-w),n[d]=r[d]/(y+w),n[d+1]=r[d]*(y+w);const N=n[d+1];let H=c-n[d];for(s=d+2;s<e;s++)n[s]-=H;m=m+H,y=n[z];let X=1,ae=X,oe=X;const ue=r[d+1];let fe=0,be=0;for(s=z-1;s>=d;s--)for(oe=ae,ae=X,be=fe,c=X*r[s],H=X*y,w=Matrix$1.hypot(y,r[s]),r[s+1]=fe*w,fe=r[s]/w,X=y/w,y=X*n[s]-fe*c,n[s+1]=H+fe*(X*c+fe*n[s]),l=0;l<e;l++)H=t[l*e+(s+1)],t[l*e+(s+1)]=fe*t[l*e+s]+X*H,t[l*e+s]=X*t[l*e+s]-fe*H;y=-fe*be*oe*ue*r[d]/N,r[d]=fe*y,n[d]=X*y}while(Math.abs(r[d])>D*O);n[d]=n[d]+m,r[d]=0}for(s=0;s<e-1;s++){for(l=s,y=n[s],a=s+1;a<e;a++)n[a]<y&&(l=a,y=n[a]);if(l!==s)for(n[l]=n[s],n[s]=y,a=0;a<e;a++)y=t[a*this.n+s],t[a*this.n+s]=t[a*e+l],t[a*e+l]=y}}orthes(){const e=this.n,t=this.V,n=this.H,r=this.ort;let s,a,l,d,c;const y=0,m=e-1;for(l=y+1;l<=m-1;l++){let O=0;for(s=l;s<=m;s++)O=O+Math.abs(n[s*e+(l-1)]);if(O!==0){let D=0;for(s=m;s>=l;s--)r[s]=n[s*e+(l-1)]/O,D+=r[s]*r[s];for(c=Math.sqrt(D),r[l]>0&&(c=-c),D=D-r[l]*c,r[l]=r[l]-c,a=l;a<e;a++){for(d=0,s=m;s>=l;s--)d+=r[s]*n[s*this.n+a];for(d=d/D,s=l;s<=m;s++)n[s*this.n+a]-=d*r[s]}for(s=0;s<=m;s++){for(d=0,a=m;a>=l;a--)d+=r[a]*n[s*this.n+a];for(d=d/D,a=l;a<=m;a++)n[s*this.n+a]-=d*r[a]}r[l]=O*r[l],n[l*e+(l-1)]=O*c}}for(s=0;s<e;s++)for(a=0;a<e;a++)t[s*this.n+a]=s===a?1:0;for(l=m-1;l>=y+1;l--)if(n[l*e+(l-1)]!==0){for(s=l+1;s<=m;s++)r[s]=n[s*e+(l-1)];for(a=l;a<=m;a++){for(c=0,s=l;s<=m;s++)c+=r[s]*t[s*this.n+a];for(c=c/r[l]/n[l*e+(l-1)],s=l;s<=m;s++)t[s*this.n+a]+=c*r[s]}}}cdiv(e,t,n,r){let s,a;Math.abs(n)>Math.abs(r)?(s=r/n,a=n+s*r,this.cdivr=(e+s*t)/a,this.cdivi=(t-s*e)/a):(s=n/r,a=r+s*n,this.cdivr=(s*e+t)/a,this.cdivi=(s*t-e)/a)}hqr2(){let e;const t=this.V,n=this.d,r=this.e,s=this.H;let a,l,d,c,y,m;const O=this.n;e=O-1;const D=0,z=O-1,w=Math.pow(2,-52);let N=0,H=0,X=0,ae=0,oe=0,ue=0,fe,be,Ae,W,J=0;for(a=0;a<O;a++)for((a<D||a>z)&&(n[a]=s[a*e+a],r[a]=0),l=Math.max(a-1,0);l<O;l++)J=J+Math.abs(s[a*this.n+l]);for(m=0;e>=D;){for(c=e;c>D&&(oe=Math.abs(s[(c-1)*e+(c-1)])+Math.abs(s[c*e+c]),oe===0&&(oe=J),!(Math.abs(s[c*e+(c-1)])<w*oe));)c--;if(c===e)s[e*e+e]=s[e*e+e]+N,n[e]=s[e*e+e],r[e]=0,e--,m=0;else if(c===e-1){if(be=s[e*e+e-1]*s[(e-1)*e+e],H=(s[(e-1)*e+(e-1)]-s[e*e+e])/2,X=H*H+be,ue=Math.sqrt(Math.abs(X)),s[e*e+e]=s[e*e+e]+N,s[(e-1)*e+(e-1)]=s[(e-1)*e+(e-1)]+N,Ae=s[e*e+e],X>=0){for(H>=0?ue=H+ue:ue=H-ue,n[e-1]=Ae+ue,n[e]=n[e-1],ue!==0&&(n[e]=Ae-be/ue),r[e-1]=0,r[e]=0,Ae=s[e*e+e-1],oe=Math.abs(Ae)+Math.abs(ue),H=Ae/oe,X=ue/oe,ae=Math.sqrt(H*H+X*X),H=H/ae,X=X/ae,l=e-1;l<O;l++)ue=s[(e-1)*e+l],s[(e-1)*e+l]=X*ue+H*s[e*e+l],s[e*e+l]=X*s[e*e+l]-H*ue;for(a=0;a<=e;a++)ue=s[a*e+e-1],s[a*e+e-1]=X*ue+H*s[a*e+e],s[a*e+e]=X*s[a*e+e]-H*ue;for(a=D;a<=z;a++)ue=t[a*e+e-1],t[a*e+e-1]=X*ue+H*t[a*e+e],t[a*e+e]=X*t[a*e+e]-H*ue}else n[e-1]=Ae+H,n[e]=Ae+H,r[e-1]=ue,r[e]=-ue;e=e-2,m=0}else{if(Ae=s[e*e+e],W=0,be=0,c<e&&(W=s[(e-1)*e+(e-1)],be=s[e*e+e-1]*s[(e-1)*e+e]),m===10){for(N+=Ae,a=D;a<=e;a++)s[a*e+a]-=Ae;oe=Math.abs(s[e*e+e-1])+Math.abs(s[(e-1)*e+e-2]),Ae=W=.75*oe,be=-.4375*oe*oe}if(m===30&&(oe=(W-Ae)/2,oe=oe*oe+be,oe>0)){for(oe=Math.sqrt(oe),W<Ae&&(oe=-oe),oe=Ae-be/((W-Ae)/2+oe),a=D;a<=e;a++)s[a*e+a]-=oe;N+=oe,Ae=W=be=.964}for(m=m+1,y=e-2;y>=c&&(ue=s[y*e+y],ae=Ae-ue,oe=W-ue,H=(ae*oe-be)/s[(y+1)*e+y]+s[y*e+y+1],X=s[(y+1)*e+y+1]-ue-ae-oe,ae=s[(y+2)*e+y+1],oe=Math.abs(H)+Math.abs(X)+Math.abs(ae),H=H/oe,X=X/oe,ae=ae/oe,!(y===c||Math.abs(s[y*e+(y-1)])*(Math.abs(X)+Math.abs(ae))<w*(Math.abs(H)*(Math.abs(s[(y-1)*e+y-1])+Math.abs(ue)+Math.abs(s[(y+1)*e+y+1])))));)y--;for(a=y+2;a<=e;a++)s[a*e+a-2]=0,a>y+2&&(s[a*e+a-3]=0);for(d=y;d<=e-1;d++){const Ue=d!==e-1;if(d!==y&&(H=s[d*e+d-1],X=s[(d+1)*e+d-1],ae=Ue?s[(d+2)*e+d-1]:0,Ae=Math.abs(H)+Math.abs(X)+Math.abs(ae),Ae!==0&&(H=H/Ae,X=X/Ae,ae=ae/Ae)),Ae===0)break;if(oe=Math.sqrt(H*H+X*X+ae*ae),H<0&&(oe=-oe),oe!==0){for(d!==y?s[d*e+d-1]=-oe*Ae:c!==y&&(s[d*e+d-1]=-s[d*e+d-1]),H=H+oe,Ae=H/oe,W=X/oe,ue=ae/oe,X=X/H,ae=ae/H,l=d;l<O;l++)H=s[d*e+l]+X*s[(d+1)*e+l],Ue&&(H=H+ae*s[(d+2)*e+l],s[(d+2)*e+l]=s[(d+2)*e+l]-H*ue),s[d*e+l]=s[d*e+l]-H*Ae,s[(d+1)*e+l]=s[(d+1)*e+l]-H*W;for(a=0;a<=Math.min(e,d+3);a++)H=Ae*s[a*e+d]+W*s[a*e+d+1],Ue&&(H=H+ue*s[a*e+d+2],s[a*e+d+2]=s[a*e+d+2]-H*ae),s[a*e+d]=s[a*e+d]-H,s[a*e+d+1]=s[a*e+d+1]-H*X;for(a=D;a<=z;a++)H=Ae*t[a*e+d]+W*t[a*e+d+1],Ue&&(H=H+ue*t[a*e+d+2],t[a*e+d+2]=t[a*e+d+2]-H*ae),t[a*e+d]=t[a*e+d]-H,t[a*e+d+1]=t[a*e+d+1]-H*X}}}}if(J!==0){for(e=O-1;e>=0;e--)if(H=n[e],X=r[e],X===0)for(c=e,s[e*e+e]=1,a=e-1;a>=0;a--){for(be=s[a*e+a]-H,ae=0,l=c;l<=e;l++)ae=ae+s[a*this.n+l]*s[l*e+e];if(r[a]<0)ue=be,oe=ae;else if(c=a,r[a]===0?be!==0?s[a*e+e]=-ae/be:s[a*e+e]=-ae/(w*J):(Ae=s[a*e+a+1],W=s[(a+1)*e+a],X=(n[a]-H)*(n[a]-H)+r[a]*r[a],fe=(Ae*oe-ue*ae)/X,s[a*e+e]=fe,Math.abs(Ae)>Math.abs(ue)?s[(a+1)*e+e]=(-ae-be*fe)/Ae:s[(a+1)*e+e]=(-oe-W*fe)/ue),fe=Math.abs(s[a*e+e]),w*fe*fe>1)for(l=a;l<=e;l++)s[l*e+e]=s[l*e+e]/fe}else if(X<0)for(c=e-1,Math.abs(s[e*e+e-1])>Math.abs(s[(e-1)*e+e])?(s[(e-1)*e+(e-1)]=X/s[e*e+e-1],s[(e-1)*e+e]=-(s[e*e+e]-H)/s[e*e+e-1]):(this.cdiv(0,-s[(e-1)*e+e],s[(e-1)*e+(e-1)]-H,X),s[(e-1)*e+(e-1)]=this.cdivr,s[(e-1)*e+e]=this.cdivi),s[e*e+e-1]=0,s[e*e+e]=1,a=e-2;a>=0;a--){let Ue,gt,Te,Et;for(Ue=0,gt=0,l=c;l<=e;l++)Ue=Ue+s[a*this.n+l]*s[l*e+e-1],gt=gt+s[a*this.n+l]*s[l*e+e];if(be=s[a*e+a]-H,r[a]<0)ue=be,ae=Ue,oe=gt;else if(c=a,r[a]===0?(this.cdiv(-Ue,-gt,be,X),s[a*e+e-1]=this.cdivr,s[a*e+e]=this.cdivi):(Ae=s[a*e+a+1],W=s[(a+1)*e+a],Te=(n[a]-H)*(n[a]-H)+r[a]*r[a]-X*X,Et=(n[a]-H)*2*X,Te===0&&Et===0&&(Te=w*J*(Math.abs(be)+Math.abs(X)+Math.abs(Ae)+Math.abs(W)+Math.abs(ue))),this.cdiv(Ae*ae-ue*Ue+X*gt,Ae*oe-ue*gt-X*Ue,Te,Et),s[a*e+e-1]=this.cdivr,s[a*e+e]=this.cdivi,Math.abs(Ae)>Math.abs(ue)+Math.abs(X)?(s[(a+1)*e+e-1]=(-Ue-be*s[a*e+e-1]+X*s[a*e+e])/Ae,s[(a+1)*e+e]=(-gt-be*s[a*e+e]-X*s[a*e+e-1])/Ae):(this.cdiv(-ae-W*s[a*e+e-1],-oe-W*s[a*e+e],ue,X),s[(a+1)*e+e-1]=this.cdivr,s[(a+1)*e+e]=this.cdivi)),fe=Math.max(Math.abs(s[a*e+e-1]),Math.abs(s[a*e+e])),w*fe*fe>1)for(l=a;l<=e;l++)s[l*e+e-1]=s[l*e+e-1]/fe,s[l*e+e]=s[l*e+e]/fe}for(a=0;a<O;a++)if(a<D||a>z)for(l=a;l<O;l++)t[a*this.n+l]=s[a*this.n+l];for(l=O-1;l>=D;l--)for(a=D;a<=z;a++){for(ue=0,d=D;d<=Math.min(l,z);d++)ue=ue+t[a*e+d]*s[d*e+l];t[a*this.n+l]=ue}}}}dot.register("EigenvalueDecomposition",EigenvalueDecomposition);class LinearFunction{constructor(e,t,n,r,s=!1){this.a1=e,this.a2=t,this.b1=n,this.b2=r,this.clamp=s}evaluate(e){return map$1(this.a1,this.a2,this.b1,this.b2,e,this.clamp)}inverse(e){return map$1(this.b1,this.b2,this.a1,this.a2,e,this.clamp)}}const map$1=(o,e,t,n,r,s)=>{let a=DotUtils.linear(o,e,t,n,r);if(s){const l=Math.max(t,n),d=Math.min(t,n);a=DotUtils.clamp(a,d,l)}return a};dot.register("LinearFunction",LinearFunction);class LUDecompositionDecimal{constructor(e,t){let n,r,s;this.matrix=e,this.LU=[],e.entries.forEach(y=>{this.LU.push(new t(y))});const a=this.LU;this.m=e.getRowDimension();const l=this.m;this.n=e.getColumnDimension();const d=this.n;for(this.piv=new Uint32Array(l),n=0;n<l;n++)this.piv[n]=n;this.pivsign=1;const c=new Array(l);for(r=0;r<d;r++){for(n=0;n<l;n++)c[n]=new t(a[e.index(n,r)]);for(n=0;n<l;n++){const m=Math.min(n,r);let O=new t(0);for(s=0;s<m;s++){const D=e.index(n,s),z=new t(a[D]),w=c[s];O=O.plus(z.times(w))}c[n]=c[n].minus(O),a[e.index(n,r)]=c[n]}let y=r;for(n=r+1;n<l;n++)c[n].abs()>c[y].abs()&&(y=n);if(y!==r){for(s=0;s<d;s++){const m=e.index(y,s),O=e.index(r,s),D=a[m];a[m]=a[O],a[O]=D}s=this.piv[y],this.piv[y]=this.piv[r],this.piv[r]=s,this.pivsign=-this.pivsign}if(r<l&&!a[this.matrix.index(r,r)].isZero())for(n=r+1;n<l;n++)a[e.index(n,r)]=a[e.index(n,r)].dividedBy(a[e.index(r,r)])}}isNonsingular(){for(let e=0;e<this.n;e++){const t=this.matrix.index(e,e);if(this.LU[t].isZero())return!1}return!0}solve(e,t){let n,r,s;if(e.getRowDimension()!==this.m)throw new Error("Matrix row dimensions must agree.");if(!this.isNonsingular())throw new Error("Matrix is singular.");const a=e.getColumnDimension(),l=e.getArrayRowMatrix(this.piv,0,a-1),d=[];for(l.entries.forEach(c=>d.push(new t(c))),s=0;s<this.n;s++)for(n=s+1;n<this.n;n++)for(r=0;r<a;r++)d[l.index(n,r)]=d[l.index(n,r)].minus(d[l.index(s,r)].times(this.LU[this.matrix.index(n,s)]));for(s=this.n-1;s>=0;s--){for(r=0;r<a;r++)d[l.index(s,r)]=d[l.index(s,r)].dividedBy(this.LU[this.matrix.index(s,s)]);for(n=0;n<s;n++)for(r=0;r<a;r++)d[l.index(n,r)]=d[l.index(n,r)].minus(d[l.index(s,r)].times(this.LU[this.matrix.index(n,s)]))}return l.entries=d.map(c=>c.toNumber()),l}}dot.register("LUDecompositionDecimal",LUDecompositionDecimal);const wl=class wl extends Map{constructor(e){super(e),wl.caches.push(this)}static clearAll(){wl.caches.forEach(e=>e.clear())}};wl.caches=[];let IOTypeCache=wl;tandemNamespace.register("IOTypeCache",IOTypeCache);const cache$b=new IOTypeCache,joinKeys=o=>o.join("|"),EnumerationIO=o=>{const e=o.enumeration;if(!cache$b.has(e)){const t=e.phetioDocumentation?` ${e.phetioDocumentation}`:"",n=e.keys,r=e.values,s=`EnumerationIO(${joinKeys(n)})`;assert&&assert(!Array.from(cache$b.values()).find(a=>a.typeName===s),"There was already another IOType with the same name: "+s),cache$b.set(e,new IOType(s,{validValues:r,documentation:`Possible values: ${n.join(", ")}.${t}`,toStateObject:a=>e.getKey(a),fromStateObject:a=>(assert&&assert(typeof a=="string","unsupported EnumerationIO value type, expected string"),assert&&assert(n.includes(a),`Unrecognized value: ${a}`),e.getValue(a)),stateSchema:StateSchema.asValue(`${joinKeys(n)}`,{isValidValue:a=>n.includes(a)})}))}return cache$b.get(e)};tandemNamespace.register("EnumerationIO",EnumerationIO);const cache$a=new IOTypeCache,ArrayIO=o=>(assert&&assert(!!o,"parameterType should be defined"),cache$a.has(o)||cache$a.set(o,new IOType(`ArrayIO<${o.typeName}>`,{valueType:Array,isValidValue:e=>_.every(e,t=>Validation.isValueValid(t,o.validator)),parameterTypes:[o],toStateObject:e=>e.map(o.toStateObject),fromStateObject:e=>e.map(o.fromStateObject),documentation:"PhET-iO Type for the built-in JS array type, with the element type specified.",stateSchema:StateSchema.asValue(`Array<${o.typeName}>`,{isValidValue:e=>_.every(e,t=>o.isStateObjectValid(t))})})),cache$a.get(o));tandemNamespace.register("ArrayIO",ArrayIO);const Float32Array$1=window.Float32Array||Array;class Matrix4{constructor(e,t,n,r,s,a,l,d,c,y,m,O,D,z,w,N,H){this.entries=new Float32Array$1(16),this.type=Types.OTHER,this.rowMajor(e!==void 0?e:1,t!==void 0?t:0,n!==void 0?n:0,r!==void 0?r:0,s!==void 0?s:0,a!==void 0?a:1,l!==void 0?l:0,d!==void 0?d:0,c!==void 0?c:0,y!==void 0?y:0,m!==void 0?m:1,O!==void 0?O:0,D!==void 0?D:0,z!==void 0?z:0,w!==void 0?w:0,N!==void 0?N:1,H)}rowMajor(e,t,n,r,s,a,l,d,c,y,m,O,D,z,w,N,H){return this.entries[0]=e,this.entries[1]=s,this.entries[2]=c,this.entries[3]=D,this.entries[4]=t,this.entries[5]=a,this.entries[6]=y,this.entries[7]=z,this.entries[8]=n,this.entries[9]=l,this.entries[10]=m,this.entries[11]=w,this.entries[12]=r,this.entries[13]=d,this.entries[14]=O,this.entries[15]=N,this.type=H===void 0?D===0&&z===0&&w===0&&N===1?Types.AFFINE:Types.OTHER:H,this}columnMajor(e,t,n,r,s,a,l,d,c,y,m,O,D,z,w,N,H){return this.rowMajor(e,s,c,D,t,a,y,z,n,l,m,w,r,d,O,N,H)}set(e){return this.rowMajor(e.m00(),e.m01(),e.m02(),e.m03(),e.m10(),e.m11(),e.m12(),e.m13(),e.m20(),e.m21(),e.m22(),e.m23(),e.m30(),e.m31(),e.m32(),e.m33(),e.type)}m00(){return this.entries[0]}m01(){return this.entries[4]}m02(){return this.entries[8]}m03(){return this.entries[12]}m10(){return this.entries[1]}m11(){return this.entries[5]}m12(){return this.entries[9]}m13(){return this.entries[13]}m20(){return this.entries[2]}m21(){return this.entries[6]}m22(){return this.entries[10]}m23(){return this.entries[14]}m30(){return this.entries[3]}m31(){return this.entries[7]}m32(){return this.entries[11]}m33(){return this.entries[15]}isFinite(){return isFinite(this.m00())&&isFinite(this.m01())&&isFinite(this.m02())&&isFinite(this.m03())&&isFinite(this.m10())&&isFinite(this.m11())&&isFinite(this.m12())&&isFinite(this.m13())&&isFinite(this.m20())&&isFinite(this.m21())&&isFinite(this.m22())&&isFinite(this.m23())&&isFinite(this.m30())&&isFinite(this.m31())&&isFinite(this.m32())&&isFinite(this.m33())}getTranslation(){return new Vector3(this.m03(),this.m13(),this.m23())}get translation(){return this.getTranslation()}getScaleVector(){const e=this.m00()+this.m03(),t=this.m10()+this.m13(),n=this.m20()+this.m23(),r=this.m30()+this.m33(),s=this.m01()+this.m03(),a=this.m11()+this.m13(),l=this.m21()+this.m23(),d=this.m31()+this.m33(),c=this.m02()+this.m03(),y=this.m12()+this.m13(),m=this.m22()+this.m23(),O=this.m32()+this.m33();return new Vector3(Math.sqrt(e*e+t*t+n*n+r*r),Math.sqrt(s*s+a*a+l*l+d*d),Math.sqrt(c*c+y*y+m*m+O*O))}get scaleVector(){return this.getScaleVector()}getCSSTransform(){return`matrix3d(${this.entries[0].toFixed(20)},${this.entries[1].toFixed(20)},${this.entries[2].toFixed(20)},${this.entries[3].toFixed(20)},${this.entries[4].toFixed(20)},${this.entries[5].toFixed(20)},${this.entries[6].toFixed(20)},${this.entries[7].toFixed(20)},${this.entries[8].toFixed(20)},${this.entries[9].toFixed(20)},${this.entries[10].toFixed(20)},${this.entries[11].toFixed(20)},${this.entries[12].toFixed(20)},${this.entries[13].toFixed(20)},${this.entries[14].toFixed(20)},${this.entries[15].toFixed(20)})`}get cssTransform(){return this.getCSSTransform()}equals(e){return this.m00()===e.m00()&&this.m01()===e.m01()&&this.m02()===e.m02()&&this.m03()===e.m03()&&this.m10()===e.m10()&&this.m11()===e.m11()&&this.m12()===e.m12()&&this.m13()===e.m13()&&this.m20()===e.m20()&&this.m21()===e.m21()&&this.m22()===e.m22()&&this.m23()===e.m23()&&this.m30()===e.m30()&&this.m31()===e.m31()&&this.m32()===e.m32()&&this.m33()===e.m33()}equalsEpsilon(e,t){return Math.abs(this.m00()-e.m00())<t&&Math.abs(this.m01()-e.m01())<t&&Math.abs(this.m02()-e.m02())<t&&Math.abs(this.m03()-e.m03())<t&&Math.abs(this.m10()-e.m10())<t&&Math.abs(this.m11()-e.m11())<t&&Math.abs(this.m12()-e.m12())<t&&Math.abs(this.m13()-e.m13())<t&&Math.abs(this.m20()-e.m20())<t&&Math.abs(this.m21()-e.m21())<t&&Math.abs(this.m22()-e.m22())<t&&Math.abs(this.m23()-e.m23())<t&&Math.abs(this.m30()-e.m30())<t&&Math.abs(this.m31()-e.m31())<t&&Math.abs(this.m32()-e.m32())<t&&Math.abs(this.m33()-e.m33())<t}copy(){return new Matrix4(this.m00(),this.m01(),this.m02(),this.m03(),this.m10(),this.m11(),this.m12(),this.m13(),this.m20(),this.m21(),this.m22(),this.m23(),this.m30(),this.m31(),this.m32(),this.m33(),this.type)}plus(e){return new Matrix4(this.m00()+e.m00(),this.m01()+e.m01(),this.m02()+e.m02(),this.m03()+e.m03(),this.m10()+e.m10(),this.m11()+e.m11(),this.m12()+e.m12(),this.m13()+e.m13(),this.m20()+e.m20(),this.m21()+e.m21(),this.m22()+e.m22(),this.m23()+e.m23(),this.m30()+e.m30(),this.m31()+e.m31(),this.m32()+e.m32(),this.m33()+e.m33())}minus(e){return new Matrix4(this.m00()-e.m00(),this.m01()-e.m01(),this.m02()-e.m02(),this.m03()-e.m03(),this.m10()-e.m10(),this.m11()-e.m11(),this.m12()-e.m12(),this.m13()-e.m13(),this.m20()-e.m20(),this.m21()-e.m21(),this.m22()-e.m22(),this.m23()-e.m23(),this.m30()-e.m30(),this.m31()-e.m31(),this.m32()-e.m32(),this.m33()-e.m33())}transposed(){return new Matrix4(this.m00(),this.m10(),this.m20(),this.m30(),this.m01(),this.m11(),this.m21(),this.m31(),this.m02(),this.m12(),this.m22(),this.m32(),this.m03(),this.m13(),this.m23(),this.m33())}negated(){return new Matrix4(-this.m00(),-this.m01(),-this.m02(),-this.m03(),-this.m10(),-this.m11(),-this.m12(),-this.m13(),-this.m20(),-this.m21(),-this.m22(),-this.m23(),-this.m30(),-this.m31(),-this.m32(),-this.m33())}inverted(){let e;switch(this.type){case Types.IDENTITY:return this;case Types.TRANSLATION_3D:return new Matrix4(1,0,0,-this.m03(),0,1,0,-this.m13(),0,0,1,-this.m23(),0,0,0,1,Types.TRANSLATION_3D);case Types.SCALING:return new Matrix4(1/this.m00(),0,0,0,0,1/this.m11(),0,0,0,0,1/this.m22(),0,0,0,0,1/this.m33(),Types.SCALING);case Types.AFFINE:case Types.OTHER:if(e=this.getDeterminant(),e!==0)return new Matrix4((-this.m31()*this.m22()*this.m13()+this.m21()*this.m32()*this.m13()+this.m31()*this.m12()*this.m23()-this.m11()*this.m32()*this.m23()-this.m21()*this.m12()*this.m33()+this.m11()*this.m22()*this.m33())/e,(this.m31()*this.m22()*this.m03()-this.m21()*this.m32()*this.m03()-this.m31()*this.m02()*this.m23()+this.m01()*this.m32()*this.m23()+this.m21()*this.m02()*this.m33()-this.m01()*this.m22()*this.m33())/e,(-this.m31()*this.m12()*this.m03()+this.m11()*this.m32()*this.m03()+this.m31()*this.m02()*this.m13()-this.m01()*this.m32()*this.m13()-this.m11()*this.m02()*this.m33()+this.m01()*this.m12()*this.m33())/e,(this.m21()*this.m12()*this.m03()-this.m11()*this.m22()*this.m03()-this.m21()*this.m02()*this.m13()+this.m01()*this.m22()*this.m13()+this.m11()*this.m02()*this.m23()-this.m01()*this.m12()*this.m23())/e,(this.m30()*this.m22()*this.m13()-this.m20()*this.m32()*this.m13()-this.m30()*this.m12()*this.m23()+this.m10()*this.m32()*this.m23()+this.m20()*this.m12()*this.m33()-this.m10()*this.m22()*this.m33())/e,(-this.m30()*this.m22()*this.m03()+this.m20()*this.m32()*this.m03()+this.m30()*this.m02()*this.m23()-this.m00()*this.m32()*this.m23()-this.m20()*this.m02()*this.m33()+this.m00()*this.m22()*this.m33())/e,(this.m30()*this.m12()*this.m03()-this.m10()*this.m32()*this.m03()-this.m30()*this.m02()*this.m13()+this.m00()*this.m32()*this.m13()+this.m10()*this.m02()*this.m33()-this.m00()*this.m12()*this.m33())/e,(-this.m20()*this.m12()*this.m03()+this.m10()*this.m22()*this.m03()+this.m20()*this.m02()*this.m13()-this.m00()*this.m22()*this.m13()-this.m10()*this.m02()*this.m23()+this.m00()*this.m12()*this.m23())/e,(-this.m30()*this.m21()*this.m13()+this.m20()*this.m31()*this.m13()+this.m30()*this.m11()*this.m23()-this.m10()*this.m31()*this.m23()-this.m20()*this.m11()*this.m33()+this.m10()*this.m21()*this.m33())/e,(this.m30()*this.m21()*this.m03()-this.m20()*this.m31()*this.m03()-this.m30()*this.m01()*this.m23()+this.m00()*this.m31()*this.m23()+this.m20()*this.m01()*this.m33()-this.m00()*this.m21()*this.m33())/e,(-this.m30()*this.m11()*this.m03()+this.m10()*this.m31()*this.m03()+this.m30()*this.m01()*this.m13()-this.m00()*this.m31()*this.m13()-this.m10()*this.m01()*this.m33()+this.m00()*this.m11()*this.m33())/e,(this.m20()*this.m11()*this.m03()-this.m10()*this.m21()*this.m03()-this.m20()*this.m01()*this.m13()+this.m00()*this.m21()*this.m13()+this.m10()*this.m01()*this.m23()-this.m00()*this.m11()*this.m23())/e,(this.m30()*this.m21()*this.m12()-this.m20()*this.m31()*this.m12()-this.m30()*this.m11()*this.m22()+this.m10()*this.m31()*this.m22()+this.m20()*this.m11()*this.m32()-this.m10()*this.m21()*this.m32())/e,(-this.m30()*this.m21()*this.m02()+this.m20()*this.m31()*this.m02()+this.m30()*this.m01()*this.m22()-this.m00()*this.m31()*this.m22()-this.m20()*this.m01()*this.m32()+this.m00()*this.m21()*this.m32())/e,(this.m30()*this.m11()*this.m02()-this.m10()*this.m31()*this.m02()-this.m30()*this.m01()*this.m12()+this.m00()*this.m31()*this.m12()+this.m10()*this.m01()*this.m32()-this.m00()*this.m11()*this.m32())/e,(-this.m20()*this.m11()*this.m02()+this.m10()*this.m21()*this.m02()+this.m20()*this.m01()*this.m12()-this.m00()*this.m21()*this.m12()-this.m10()*this.m01()*this.m22()+this.m00()*this.m11()*this.m22())/e);throw new Error("Matrix could not be inverted, determinant === 0");default:throw new Error(`Matrix4.inverted with unknown type: ${this.type}`)}}timesMatrix(e){if(this.type===Types.IDENTITY||e.type===Types.IDENTITY)return this.type===Types.IDENTITY?e:this;if(this.type===e.type){if(this.type===Types.TRANSLATION_3D)return new Matrix4(1,0,0,this.m03()+e.m02(),0,1,0,this.m13()+e.m12(),0,0,1,this.m23()+e.m23(),0,0,0,1,Types.TRANSLATION_3D);if(this.type===Types.SCALING)return new Matrix4(this.m00()*e.m00(),0,0,0,0,this.m11()*e.m11(),0,0,0,0,this.m22()*e.m22(),0,0,0,0,1,Types.SCALING)}return this.type!==Types.OTHER&&e.type!==Types.OTHER?new Matrix4(this.m00()*e.m00()+this.m01()*e.m10()+this.m02()*e.m20(),this.m00()*e.m01()+this.m01()*e.m11()+this.m02()*e.m21(),this.m00()*e.m02()+this.m01()*e.m12()+this.m02()*e.m22(),this.m00()*e.m03()+this.m01()*e.m13()+this.m02()*e.m23()+this.m03(),this.m10()*e.m00()+this.m11()*e.m10()+this.m12()*e.m20(),this.m10()*e.m01()+this.m11()*e.m11()+this.m12()*e.m21(),this.m10()*e.m02()+this.m11()*e.m12()+this.m12()*e.m22(),this.m10()*e.m03()+this.m11()*e.m13()+this.m12()*e.m23()+this.m13(),this.m20()*e.m00()+this.m21()*e.m10()+this.m22()*e.m20(),this.m20()*e.m01()+this.m21()*e.m11()+this.m22()*e.m21(),this.m20()*e.m02()+this.m21()*e.m12()+this.m22()*e.m22(),this.m20()*e.m03()+this.m21()*e.m13()+this.m22()*e.m23()+this.m23(),0,0,0,1,Types.AFFINE):new Matrix4(this.m00()*e.m00()+this.m01()*e.m10()+this.m02()*e.m20()+this.m03()*e.m30(),this.m00()*e.m01()+this.m01()*e.m11()+this.m02()*e.m21()+this.m03()*e.m31(),this.m00()*e.m02()+this.m01()*e.m12()+this.m02()*e.m22()+this.m03()*e.m32(),this.m00()*e.m03()+this.m01()*e.m13()+this.m02()*e.m23()+this.m03()*e.m33(),this.m10()*e.m00()+this.m11()*e.m10()+this.m12()*e.m20()+this.m13()*e.m30(),this.m10()*e.m01()+this.m11()*e.m11()+this.m12()*e.m21()+this.m13()*e.m31(),this.m10()*e.m02()+this.m11()*e.m12()+this.m12()*e.m22()+this.m13()*e.m32(),this.m10()*e.m03()+this.m11()*e.m13()+this.m12()*e.m23()+this.m13()*e.m33(),this.m20()*e.m00()+this.m21()*e.m10()+this.m22()*e.m20()+this.m23()*e.m30(),this.m20()*e.m01()+this.m21()*e.m11()+this.m22()*e.m21()+this.m23()*e.m31(),this.m20()*e.m02()+this.m21()*e.m12()+this.m22()*e.m22()+this.m23()*e.m32(),this.m20()*e.m03()+this.m21()*e.m13()+this.m22()*e.m23()+this.m23()*e.m33(),this.m30()*e.m00()+this.m31()*e.m10()+this.m32()*e.m20()+this.m33()*e.m30(),this.m30()*e.m01()+this.m31()*e.m11()+this.m32()*e.m21()+this.m33()*e.m31(),this.m30()*e.m02()+this.m31()*e.m12()+this.m32()*e.m22()+this.m33()*e.m32(),this.m30()*e.m03()+this.m31()*e.m13()+this.m32()*e.m23()+this.m33()*e.m33())}timesVector4(e){const t=this.m00()*e.x+this.m01()*e.y+this.m02()*e.z+this.m03()*e.w,n=this.m10()*e.x+this.m11()*e.y+this.m12()*e.z+this.m13()*e.w,r=this.m20()*e.x+this.m21()*e.y+this.m22()*e.z+this.m23()*e.w,s=this.m30()*e.x+this.m31()*e.y+this.m32()*e.z+this.m33()*e.w;return new Vector4(t,n,r,s)}timesVector3(e){return this.timesVector4(e.toVector4()).toVector3()}timesTransposeVector4(e){const t=this.m00()*e.x+this.m10()*e.y+this.m20()*e.z+this.m30()*e.w,n=this.m01()*e.x+this.m11()*e.y+this.m21()*e.z+this.m31()*e.w,r=this.m02()*e.x+this.m12()*e.y+this.m22()*e.z+this.m32()*e.w,s=this.m03()*e.x+this.m13()*e.y+this.m23()*e.z+this.m33()*e.w;return new Vector4(t,n,r,s)}timesTransposeVector3(e){return this.timesTransposeVector4(e.toVector4()).toVector3()}timesRelativeVector3(e){const t=this.m00()*e.x+this.m10()*e.y+this.m20()*e.z,n=this.m01()*e.y+this.m11()*e.y+this.m21()*e.z,r=this.m02()*e.z+this.m12()*e.y+this.m22()*e.z;return new Vector3(t,n,r)}getDeterminant(){return this.m03()*this.m12()*this.m21()*this.m30()-this.m02()*this.m13()*this.m21()*this.m30()-this.m03()*this.m11()*this.m22()*this.m30()+this.m01()*this.m13()*this.m22()*this.m30()+this.m02()*this.m11()*this.m23()*this.m30()-this.m01()*this.m12()*this.m23()*this.m30()-this.m03()*this.m12()*this.m20()*this.m31()+this.m02()*this.m13()*this.m20()*this.m31()+this.m03()*this.m10()*this.m22()*this.m31()-this.m00()*this.m13()*this.m22()*this.m31()-this.m02()*this.m10()*this.m23()*this.m31()+this.m00()*this.m12()*this.m23()*this.m31()+this.m03()*this.m11()*this.m20()*this.m32()-this.m01()*this.m13()*this.m20()*this.m32()-this.m03()*this.m10()*this.m21()*this.m32()+this.m00()*this.m13()*this.m21()*this.m32()+this.m01()*this.m10()*this.m23()*this.m32()-this.m00()*this.m11()*this.m23()*this.m32()-this.m02()*this.m11()*this.m20()*this.m33()+this.m01()*this.m12()*this.m20()*this.m33()+this.m02()*this.m10()*this.m21()*this.m33()-this.m00()*this.m12()*this.m21()*this.m33()-this.m01()*this.m10()*this.m22()*this.m33()+this.m00()*this.m11()*this.m22()*this.m33()}get determinant(){return this.getDeterminant()}toString(){return`${this.m00()} ${this.m01()} ${this.m02()} ${this.m03()}
${this.m10()} ${this.m11()} ${this.m12()} ${this.m13()}
${this.m20()} ${this.m21()} ${this.m22()} ${this.m23()}
${this.m30()} ${this.m31()} ${this.m32()} ${this.m33()}`}makeImmutable(){return assert&&(this.rowMajor=()=>{throw new Error("Cannot modify immutable matrix")}),this}copyToArray(e){return e[0]=this.m00(),e[1]=this.m10(),e[2]=this.m20(),e[3]=this.m30(),e[4]=this.m01(),e[5]=this.m11(),e[6]=this.m21(),e[7]=this.m31(),e[8]=this.m02(),e[9]=this.m12(),e[10]=this.m22(),e[11]=this.m32(),e[12]=this.m03(),e[13]=this.m13(),e[14]=this.m23(),e[15]=this.m33(),e}static identity(){return new Matrix4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,Types.IDENTITY)}static translation(e,t,n){return new Matrix4(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1,Types.TRANSLATION_3D)}static translationFromVector(e){return Matrix4.translation(e.x,e.y,e.z)}static scaling(e,t,n){return t=t===void 0?e:t,n=n===void 0?e:n,new Matrix4(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1,Types.SCALING)}static rotationAxisAngle(e,t){const n=Math.cos(t),r=Math.sin(t),s=1-n;return new Matrix4(e.x*e.x*s+n,e.x*e.y*s-e.z*r,e.x*e.z*s+e.y*r,0,e.y*e.x*s+e.z*r,e.y*e.y*s+n,e.y*e.z*s-e.x*r,0,e.z*e.x*s-e.y*r,e.z*e.y*s+e.x*r,e.z*e.z*s+n,0,0,0,0,1,Types.AFFINE)}static rotationX(e){const t=Math.cos(e),n=Math.sin(e);return new Matrix4(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1,Types.AFFINE)}static rotationY(e){const t=Math.cos(e),n=Math.sin(e);return new Matrix4(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1,Types.AFFINE)}static rotationZ(e){const t=Math.cos(e),n=Math.sin(e);return new Matrix4(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1,Types.AFFINE)}static gluPerspective(e,t,n,r){const s=Math.cos(e)/Math.sin(e);return new Matrix4(s/t,0,0,0,0,s,0,0,0,0,(r+n)/(n-r),2*r*n/(n-r),0,0,-1,0)}}dot.register("Matrix4",Matrix4);const Qn=class Qn extends EnumerationValue{};ut(Qn,"OTHER",new Qn),ut(Qn,"IDENTITY",new Qn),ut(Qn,"TRANSLATION_3D",new Qn),ut(Qn,"SCALING",new Qn),ut(Qn,"AFFINE",new Qn),ut(Qn,"enumeration",new Enumeration(Qn));let Types=Qn;Matrix4.Types=Types;Matrix4.IDENTITY=new Matrix4().makeImmutable();function toSVGNumber(o){return o.toFixed(20)}dot.register("toSVGNumber",toSVGNumber);const Jn=class Jn extends EnumerationValue{};Jn.OTHER=new Jn,Jn.IDENTITY=new Jn,Jn.TRANSLATION_2D=new Jn,Jn.SCALING=new Jn,Jn.AFFINE=new Jn,Jn.enumeration=new Enumeration(Jn);let Matrix3Type=Jn;const er=class er{constructor(){assert&&assert(arguments.length===0,"Matrix3 constructor should not be called with any arguments.  Use m3()/Matrix3.identity()/etc."),this.entries=[1,0,0,0,1,0,0,0,1],this.type=Matrix3Type.IDENTITY}initialize(){return this}m00(){return this.entries[0]}m01(){return this.entries[3]}m02(){return this.entries[6]}m10(){return this.entries[1]}m11(){return this.entries[4]}m12(){return this.entries[7]}m20(){return this.entries[2]}m21(){return this.entries[5]}m22(){return this.entries[8]}isIdentity(){return this.type===Matrix3Type.IDENTITY||this.equals(er.IDENTITY)}isFastIdentity(){return this.type===Matrix3Type.IDENTITY}isTranslation(){return this.type===Matrix3Type.TRANSLATION_2D||this.m00()===1&&this.m11()===1&&this.m22()===1&&this.m01()===0&&this.m10()===0&&this.m20()===0&&this.m21()===0}isAffine(){return this.type===Matrix3Type.AFFINE||this.m20()===0&&this.m21()===0&&this.m22()===1}isAligned(){return this.isAffine()&&this.m01()===0&&this.m10()===0}isAxisAligned(){return this.isAffine()&&(this.m01()===0&&this.m10()===0||this.m00()===0&&this.m11()===0)}isFinite(){return isFinite(this.m00())&&isFinite(this.m01())&&isFinite(this.m02())&&isFinite(this.m10())&&isFinite(this.m11())&&isFinite(this.m12())&&isFinite(this.m20())&&isFinite(this.m21())&&isFinite(this.m22())}getDeterminant(){return this.m00()*this.m11()*this.m22()+this.m01()*this.m12()*this.m20()+this.m02()*this.m10()*this.m21()-this.m02()*this.m11()*this.m20()-this.m01()*this.m10()*this.m22()-this.m00()*this.m12()*this.m21()}get determinant(){return this.getDeterminant()}getTranslation(){return new Vector2(this.m02(),this.m12())}get translation(){return this.getTranslation()}getScaleVector(){return new Vector2(Math.sqrt(this.m00()*this.m00()+this.m10()*this.m10()),Math.sqrt(this.m01()*this.m01()+this.m11()*this.m11()))}get scaleVector(){return this.getScaleVector()}getSignedScale(){return this.m00()*this.m11()-this.m10()*this.m01()}getRotation(){return Math.atan2(this.m10(),this.m00())}get rotation(){return this.getRotation()}toMatrix4(){return new Matrix4(this.m00(),this.m01(),this.m02(),0,this.m10(),this.m11(),this.m12(),0,this.m20(),this.m21(),this.m22(),0,0,0,0,1)}toAffineMatrix4(){return new Matrix4(this.m00(),this.m01(),0,this.m02(),this.m10(),this.m11(),0,this.m12(),0,0,1,0,0,0,0,1)}toString(){return`${this.m00()} ${this.m01()} ${this.m02()}
${this.m10()} ${this.m11()} ${this.m12()}
${this.m20()} ${this.m21()} ${this.m22()}`}toSVGMatrix(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix();return e.a=this.m00(),e.b=this.m10(),e.c=this.m01(),e.d=this.m11(),e.e=this.m02(),e.f=this.m12(),e}getCSSTransform(){return`matrix(${this.entries[0].toFixed(20)},${this.entries[1].toFixed(20)},${this.entries[3].toFixed(20)},${this.entries[4].toFixed(20)},${this.entries[6].toFixed(20)},${this.entries[7].toFixed(20)})`}get cssTransform(){return this.getCSSTransform()}getSVGTransform(){switch(this.type){case Matrix3Type.IDENTITY:return"";case Matrix3Type.TRANSLATION_2D:return`translate(${toSVGNumber(this.entries[6])},${toSVGNumber(this.entries[7])})`;case Matrix3Type.SCALING:return`scale(${toSVGNumber(this.entries[0])}${this.entries[0]===this.entries[4]?"":`,${toSVGNumber(this.entries[4])}`})`;default:return`matrix(${toSVGNumber(this.entries[0])},${toSVGNumber(this.entries[1])},${toSVGNumber(this.entries[3])},${toSVGNumber(this.entries[4])},${toSVGNumber(this.entries[6])},${toSVGNumber(this.entries[7])})`}}get svgTransform(){return this.getSVGTransform()}getCSSTransformStyles(){const e=this.getCSSTransform();return{"-webkit-perspective":"1000","-webkit-backface-visibility":"hidden","-webkit-transform":`${e} translateZ(0)`,"-moz-transform":`${e} translateZ(0)`,"-ms-transform":e,"-o-transform":e,transform:e,"transform-origin":"top left","-ms-transform-origin":"top left"}}get cssTransformStyles(){return this.getCSSTransformStyles()}equals(e){return this.m00()===e.m00()&&this.m01()===e.m01()&&this.m02()===e.m02()&&this.m10()===e.m10()&&this.m11()===e.m11()&&this.m12()===e.m12()&&this.m20()===e.m20()&&this.m21()===e.m21()&&this.m22()===e.m22()}equalsEpsilon(e,t){return Math.abs(this.m00()-e.m00())<t&&Math.abs(this.m01()-e.m01())<t&&Math.abs(this.m02()-e.m02())<t&&Math.abs(this.m10()-e.m10())<t&&Math.abs(this.m11()-e.m11())<t&&Math.abs(this.m12()-e.m12())<t&&Math.abs(this.m20()-e.m20())<t&&Math.abs(this.m21()-e.m21())<t&&Math.abs(this.m22()-e.m22())<t}copy(){return m3(this.m00(),this.m01(),this.m02(),this.m10(),this.m11(),this.m12(),this.m20(),this.m21(),this.m22(),this.type)}plus(e){return m3(this.m00()+e.m00(),this.m01()+e.m01(),this.m02()+e.m02(),this.m10()+e.m10(),this.m11()+e.m11(),this.m12()+e.m12(),this.m20()+e.m20(),this.m21()+e.m21(),this.m22()+e.m22())}minus(e){return m3(this.m00()-e.m00(),this.m01()-e.m01(),this.m02()-e.m02(),this.m10()-e.m10(),this.m11()-e.m11(),this.m12()-e.m12(),this.m20()-e.m20(),this.m21()-e.m21(),this.m22()-e.m22())}transposed(){return m3(this.m00(),this.m10(),this.m20(),this.m01(),this.m11(),this.m21(),this.m02(),this.m12(),this.m22(),this.type===Matrix3Type.IDENTITY||this.type===Matrix3Type.SCALING?this.type:void 0)}negated(){return m3(-this.m00(),-this.m01(),-this.m02(),-this.m10(),-this.m11(),-this.m12(),-this.m20(),-this.m21(),-this.m22())}inverted(){let e;switch(this.type){case Matrix3Type.IDENTITY:return this;case Matrix3Type.TRANSLATION_2D:return m3(1,0,-this.m02(),0,1,-this.m12(),0,0,1,Matrix3Type.TRANSLATION_2D);case Matrix3Type.SCALING:return m3(1/this.m00(),0,0,0,1/this.m11(),0,0,0,1/this.m22(),Matrix3Type.SCALING);case Matrix3Type.AFFINE:if(e=this.getDeterminant(),e!==0)return m3((-this.m12()*this.m21()+this.m11()*this.m22())/e,(this.m02()*this.m21()-this.m01()*this.m22())/e,(-this.m02()*this.m11()+this.m01()*this.m12())/e,(this.m12()*this.m20()-this.m10()*this.m22())/e,(-this.m02()*this.m20()+this.m00()*this.m22())/e,(this.m02()*this.m10()-this.m00()*this.m12())/e,0,0,1,Matrix3Type.AFFINE);throw new Error("Matrix could not be inverted, determinant === 0");case Matrix3Type.OTHER:if(e=this.getDeterminant(),e!==0)return m3((-this.m12()*this.m21()+this.m11()*this.m22())/e,(this.m02()*this.m21()-this.m01()*this.m22())/e,(-this.m02()*this.m11()+this.m01()*this.m12())/e,(this.m12()*this.m20()-this.m10()*this.m22())/e,(-this.m02()*this.m20()+this.m00()*this.m22())/e,(this.m02()*this.m10()-this.m00()*this.m12())/e,(-this.m11()*this.m20()+this.m10()*this.m21())/e,(this.m01()*this.m20()-this.m00()*this.m21())/e,(-this.m01()*this.m10()+this.m00()*this.m11())/e,Matrix3Type.OTHER);throw new Error("Matrix could not be inverted, determinant === 0");default:throw new Error(`Matrix3.inverted with unknown type: ${this.type}`)}}timesMatrix(e){if(this.type===Matrix3Type.IDENTITY||e.type===Matrix3Type.IDENTITY)return this.type===Matrix3Type.IDENTITY?e:this;if(this.type===e.type){if(this.type===Matrix3Type.TRANSLATION_2D)return m3(1,0,this.m02()+e.m02(),0,1,this.m12()+e.m12(),0,0,1,Matrix3Type.TRANSLATION_2D);if(this.type===Matrix3Type.SCALING)return m3(this.m00()*e.m00(),0,0,0,this.m11()*e.m11(),0,0,0,1,Matrix3Type.SCALING)}return this.type!==Matrix3Type.OTHER&&e.type!==Matrix3Type.OTHER?m3(this.m00()*e.m00()+this.m01()*e.m10(),this.m00()*e.m01()+this.m01()*e.m11(),this.m00()*e.m02()+this.m01()*e.m12()+this.m02(),this.m10()*e.m00()+this.m11()*e.m10(),this.m10()*e.m01()+this.m11()*e.m11(),this.m10()*e.m02()+this.m11()*e.m12()+this.m12(),0,0,1,Matrix3Type.AFFINE):m3(this.m00()*e.m00()+this.m01()*e.m10()+this.m02()*e.m20(),this.m00()*e.m01()+this.m01()*e.m11()+this.m02()*e.m21(),this.m00()*e.m02()+this.m01()*e.m12()+this.m02()*e.m22(),this.m10()*e.m00()+this.m11()*e.m10()+this.m12()*e.m20(),this.m10()*e.m01()+this.m11()*e.m11()+this.m12()*e.m21(),this.m10()*e.m02()+this.m11()*e.m12()+this.m12()*e.m22(),this.m20()*e.m00()+this.m21()*e.m10()+this.m22()*e.m20(),this.m20()*e.m01()+this.m21()*e.m11()+this.m22()*e.m21(),this.m20()*e.m02()+this.m21()*e.m12()+this.m22()*e.m22())}timesVector2(e){const t=this.m00()*e.x+this.m01()*e.y+this.m02(),n=this.m10()*e.x+this.m11()*e.y+this.m12();return new Vector2(t,n)}timesVector3(e){const t=this.m00()*e.x+this.m01()*e.y+this.m02()*e.z,n=this.m10()*e.x+this.m11()*e.y+this.m12()*e.z,r=this.m20()*e.x+this.m21()*e.y+this.m22()*e.z;return new Vector3(t,n,r)}timesTransposeVector2(e){const t=this.m00()*e.x+this.m10()*e.y,n=this.m01()*e.x+this.m11()*e.y;return new Vector2(t,n)}timesRelativeVector2(e){const t=this.m00()*e.x+this.m01()*e.y,n=this.m10()*e.y+this.m11()*e.y;return new Vector2(t,n)}rowMajor(e,t,n,r,s,a,l,d,c,y){return this.entries[0]=e,this.entries[1]=r,this.entries[2]=l,this.entries[3]=t,this.entries[4]=s,this.entries[5]=d,this.entries[6]=n,this.entries[7]=a,this.entries[8]=c,this.type=y===void 0?l===0&&d===0&&c===1?Matrix3Type.AFFINE:Matrix3Type.OTHER:y,this}set(e){return this.rowMajor(e.m00(),e.m01(),e.m02(),e.m10(),e.m11(),e.m12(),e.m20(),e.m21(),e.m22(),e.type)}setArray(e){return this.rowMajor(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])}set00(e){return this.entries[0]=e,this}set01(e){return this.entries[3]=e,this}set02(e){return this.entries[6]=e,this}set10(e){return this.entries[1]=e,this}set11(e){return this.entries[4]=e,this}set12(e){return this.entries[7]=e,this}set20(e){return this.entries[2]=e,this}set21(e){return this.entries[5]=e,this}set22(e){return this.entries[8]=e,this}makeImmutable(){return assert&&(this.rowMajor=()=>{throw new Error("Cannot modify immutable matrix")}),this}columnMajor(e,t,n,r,s,a,l,d,c,y){return this.rowMajor(e,r,l,t,s,d,n,a,c,y)}add(e){return this.rowMajor(this.m00()+e.m00(),this.m01()+e.m01(),this.m02()+e.m02(),this.m10()+e.m10(),this.m11()+e.m11(),this.m12()+e.m12(),this.m20()+e.m20(),this.m21()+e.m21(),this.m22()+e.m22())}subtract(e){return this.rowMajor(this.m00()-e.m00(),this.m01()-e.m01(),this.m02()-e.m02(),this.m10()-e.m10(),this.m11()-e.m11(),this.m12()-e.m12(),this.m20()-e.m20(),this.m21()-e.m21(),this.m22()-e.m22())}transpose(){return this.rowMajor(this.m00(),this.m10(),this.m20(),this.m01(),this.m11(),this.m21(),this.m02(),this.m12(),this.m22(),this.type===Matrix3Type.IDENTITY||this.type===Matrix3Type.SCALING?this.type:void 0)}negate(){return this.rowMajor(-this.m00(),-this.m01(),-this.m02(),-this.m10(),-this.m11(),-this.m12(),-this.m20(),-this.m21(),-this.m22())}invert(){let e;switch(this.type){case Matrix3Type.IDENTITY:return this;case Matrix3Type.TRANSLATION_2D:return this.rowMajor(1,0,-this.m02(),0,1,-this.m12(),0,0,1,Matrix3Type.TRANSLATION_2D);case Matrix3Type.SCALING:return this.rowMajor(1/this.m00(),0,0,0,1/this.m11(),0,0,0,1/this.m22(),Matrix3Type.SCALING);case Matrix3Type.AFFINE:if(e=this.getDeterminant(),e!==0)return this.rowMajor((-this.m12()*this.m21()+this.m11()*this.m22())/e,(this.m02()*this.m21()-this.m01()*this.m22())/e,(-this.m02()*this.m11()+this.m01()*this.m12())/e,(this.m12()*this.m20()-this.m10()*this.m22())/e,(-this.m02()*this.m20()+this.m00()*this.m22())/e,(this.m02()*this.m10()-this.m00()*this.m12())/e,0,0,1,Matrix3Type.AFFINE);throw new Error("Matrix could not be inverted, determinant === 0");case Matrix3Type.OTHER:if(e=this.getDeterminant(),e!==0)return this.rowMajor((-this.m12()*this.m21()+this.m11()*this.m22())/e,(this.m02()*this.m21()-this.m01()*this.m22())/e,(-this.m02()*this.m11()+this.m01()*this.m12())/e,(this.m12()*this.m20()-this.m10()*this.m22())/e,(-this.m02()*this.m20()+this.m00()*this.m22())/e,(this.m02()*this.m10()-this.m00()*this.m12())/e,(-this.m11()*this.m20()+this.m10()*this.m21())/e,(this.m01()*this.m20()-this.m00()*this.m21())/e,(-this.m01()*this.m10()+this.m00()*this.m11())/e,Matrix3Type.OTHER);throw new Error("Matrix could not be inverted, determinant === 0");default:throw new Error(`Matrix3.inverted with unknown type: ${this.type}`)}}multiplyMatrix(e){if(e.type===Matrix3Type.IDENTITY)return this;if(this.type===Matrix3Type.IDENTITY)return this.set(e);if(this.type===e.type){if(this.type===Matrix3Type.TRANSLATION_2D)return this.rowMajor(1,0,this.m02()+e.m02(),0,1,this.m12()+e.m12(),0,0,1,Matrix3Type.TRANSLATION_2D);if(this.type===Matrix3Type.SCALING)return this.rowMajor(this.m00()*e.m00(),0,0,0,this.m11()*e.m11(),0,0,0,1,Matrix3Type.SCALING)}return this.type!==Matrix3Type.OTHER&&e.type!==Matrix3Type.OTHER?this.rowMajor(this.m00()*e.m00()+this.m01()*e.m10(),this.m00()*e.m01()+this.m01()*e.m11(),this.m00()*e.m02()+this.m01()*e.m12()+this.m02(),this.m10()*e.m00()+this.m11()*e.m10(),this.m10()*e.m01()+this.m11()*e.m11(),this.m10()*e.m02()+this.m11()*e.m12()+this.m12(),0,0,1,Matrix3Type.AFFINE):this.rowMajor(this.m00()*e.m00()+this.m01()*e.m10()+this.m02()*e.m20(),this.m00()*e.m01()+this.m01()*e.m11()+this.m02()*e.m21(),this.m00()*e.m02()+this.m01()*e.m12()+this.m02()*e.m22(),this.m10()*e.m00()+this.m11()*e.m10()+this.m12()*e.m20(),this.m10()*e.m01()+this.m11()*e.m11()+this.m12()*e.m21(),this.m10()*e.m02()+this.m11()*e.m12()+this.m12()*e.m22(),this.m20()*e.m00()+this.m21()*e.m10()+this.m22()*e.m20(),this.m20()*e.m01()+this.m21()*e.m11()+this.m22()*e.m21(),this.m20()*e.m02()+this.m21()*e.m12()+this.m22()*e.m22())}prependTranslation(e,t){return this.set02(this.m02()+e),this.set12(this.m12()+t),this.type===Matrix3Type.IDENTITY||this.type===Matrix3Type.TRANSLATION_2D?this.type=Matrix3Type.TRANSLATION_2D:this.type===Matrix3Type.OTHER?this.type=Matrix3Type.OTHER:this.type=Matrix3Type.AFFINE,this}setToIdentity(){return this.rowMajor(1,0,0,0,1,0,0,0,1,Matrix3Type.IDENTITY)}setToTranslation(e,t){return this.rowMajor(1,0,e,0,1,t,0,0,1,Matrix3Type.TRANSLATION_2D)}setToScale(e,t){return t=t===void 0?e:t,this.rowMajor(e,0,0,0,t,0,0,0,1,Matrix3Type.SCALING)}setToAffine(e,t,n,r,s,a){return this.rowMajor(e,t,n,r,s,a,0,0,1,Matrix3Type.AFFINE)}setToRotationAxisAngle(e,t){let n=Math.cos(t),r=Math.sin(t);Math.abs(n)<1e-15&&(n=0),Math.abs(r)<1e-15&&(r=0);const s=1-n;return this.rowMajor(e.x*e.x*s+n,e.x*e.y*s-e.z*r,e.x*e.z*s+e.y*r,e.y*e.x*s+e.z*r,e.y*e.y*s+n,e.y*e.z*s-e.x*r,e.z*e.x*s-e.y*r,e.z*e.y*s+e.x*r,e.z*e.z*s+n,Matrix3Type.OTHER)}setToRotationX(e){let t=Math.cos(e),n=Math.sin(e);return Math.abs(t)<1e-15&&(t=0),Math.abs(n)<1e-15&&(n=0),this.rowMajor(1,0,0,0,t,-n,0,n,t,Matrix3Type.OTHER)}setToRotationY(e){let t=Math.cos(e),n=Math.sin(e);return Math.abs(t)<1e-15&&(t=0),Math.abs(n)<1e-15&&(n=0),this.rowMajor(t,0,n,0,1,0,-n,0,t,Matrix3Type.OTHER)}setToRotationZ(e){let t=Math.cos(e),n=Math.sin(e);return Math.abs(t)<1e-15&&(t=0),Math.abs(n)<1e-15&&(n=0),this.rowMajor(t,-n,0,n,t,0,0,0,1,Matrix3Type.AFFINE)}setToTranslationRotation(e,t,n){let r=Math.cos(n),s=Math.sin(n);return Math.abs(r)<1e-15&&(r=0),Math.abs(s)<1e-15&&(s=0),this.rowMajor(r,-s,e,s,r,t,0,0,1,Matrix3Type.AFFINE)}setToTranslationRotationPoint(e,t){return this.setToTranslationRotation(e.x,e.y,t)}setToSVGMatrix(e){return this.rowMajor(e.a,e.c,e.e,e.b,e.d,e.f,0,0,1,Matrix3Type.AFFINE)}setRotationAToB(e,t){const n=e,r=t,s=1e-4;let a=n.cross(r);const l=n.dot(r);if((l<0?-l:l)>1-s){let c=new Vector3(n.x>0?n.x:-n.x,n.y>0?n.y:-n.y,n.z>0?n.z:-n.z);c.x<c.y?c.x<c.z?c=Vector3.X_UNIT:c=Vector3.Z_UNIT:c.y<c.z?c=Vector3.Y_UNIT:c=Vector3.Z_UNIT;const y=c.minus(n);a=c.minus(r);const m=2/y.dot(y),O=2/a.dot(a),D=m*O*y.dot(a);return this.rowMajor(-m*y.x*y.x-O*a.x*a.x+D*a.x*y.x+1,-m*y.x*y.y-O*a.x*a.y+D*a.x*y.y,-m*y.x*y.z-O*a.x*a.z+D*a.x*y.z,-m*y.y*y.x-O*a.y*a.x+D*a.y*y.x,-m*y.y*y.y-O*a.y*a.y+D*a.y*y.y+1,-m*y.y*y.z-O*a.y*a.z+D*a.y*y.z,-m*y.z*y.x-O*a.z*a.x+D*a.z*y.x,-m*y.z*y.y-O*a.z*a.y+D*a.z*y.y,-m*y.z*y.z-O*a.z*a.z+D*a.z*y.z+1)}else{const c=1/(1+l),y=c*a.x,m=c*a.z,O=y*a.y,D=y*a.z,z=m*a.y;return this.rowMajor(l+y*a.x,O-a.z,D+a.y,O+a.z,l+c*a.y*a.y,z-a.x,D-a.y,z+a.x,l+m*a.z)}}multiplyVector2(e){return e.setXY(this.m00()*e.x+this.m01()*e.y+this.m02(),this.m10()*e.x+this.m11()*e.y+this.m12())}multiplyVector3(e){return e.setXYZ(this.m00()*e.x+this.m01()*e.y+this.m02()*e.z,this.m10()*e.x+this.m11()*e.y+this.m12()*e.z,this.m20()*e.x+this.m21()*e.y+this.m22()*e.z)}multiplyTransposeVector2(e){return e.setXY(this.m00()*e.x+this.m10()*e.y,this.m01()*e.x+this.m11()*e.y)}multiplyRelativeVector2(e){return e.setXY(this.m00()*e.x+this.m01()*e.y,this.m10()*e.y+this.m11()*e.y)}canvasSetTransform(e){e.setTransform(this.entries[0],this.entries[1],this.entries[3],this.entries[4],this.entries[6],this.entries[7])}canvasAppendTransform(e){this.type!==Matrix3Type.IDENTITY&&e.transform(this.entries[0],this.entries[1],this.entries[3],this.entries[4],this.entries[6],this.entries[7])}copyToArray(e){return e[0]=this.m00(),e[1]=this.m10(),e[2]=this.m20(),e[3]=this.m01(),e[4]=this.m11(),e[5]=this.m21(),e[6]=this.m02(),e[7]=this.m12(),e[8]=this.m22(),e}freeToPool(){er.pool.freeToPool(this)}static identity(){return fromPool().setToIdentity()}static translation(e,t){return fromPool().setToTranslation(e,t)}static translationFromVector(e){return er.translation(e.x,e.y)}static scaling(e,t){return fromPool().setToScale(e,t)}static scale(e,t){return er.scaling(e,t)}static affine(e,t,n,r,s,a){return fromPool().setToAffine(e,t,n,r,s,a)}static rowMajor(e,t,n,r,s,a,l,d,c,y){return fromPool().rowMajor(e,t,n,r,s,a,l,d,c,y)}static rotationAxisAngle(e,t){return fromPool().setToRotationAxisAngle(e,t)}static rotationX(e){return fromPool().setToRotationX(e)}static rotationY(e){return fromPool().setToRotationY(e)}static rotationZ(e){return fromPool().setToRotationZ(e)}static translationRotation(e,t,n){return fromPool().setToTranslationRotation(e,t,n)}static rotation2(e){return fromPool().setToRotationZ(e)}static rotationAround(e,t,n){return er.translation(t,n).timesMatrix(er.rotation2(e)).timesMatrix(er.translation(-t,-n))}static rotationAroundPoint(e,t){return er.rotationAround(e,t.x,t.y)}static fromSVGMatrix(e){return fromPool().setToSVGMatrix(e)}static rotateAToB(e,t){return fromPool().setRotationAToB(e,t)}static translationTimesMatrix(e,t,n){let r;return n.type===Matrix3Type.IDENTITY||n.type===Matrix3Type.TRANSLATION_2D?m3(1,0,n.m02()+e,0,1,n.m12()+t,0,0,1,Matrix3Type.TRANSLATION_2D):(n.type===Matrix3Type.OTHER?r=Matrix3Type.OTHER:r=Matrix3Type.AFFINE,m3(n.m00(),n.m01(),n.m02()+e,n.m10(),n.m11(),n.m12()+t,n.m20(),n.m21(),n.m22(),r))}static toStateObject(e){return{entries:e.entries,type:e.type.name}}static fromStateObject(e){const t=er.identity();return t.entries=e.entries,t.type=Matrix3Type.enumeration.getValue(e.type),t}};er.pool=new Pool(er,{initialize:er.prototype.initialize,useDefaultConstruction:!0,maxSize:300});let Matrix3=er;dot.register("Matrix3",Matrix3);const fromPool=Matrix3.pool.fetch.bind(Matrix3.pool),m3=(o,e,t,n,r,s,a,l,d,c)=>fromPool().rowMajor(o,e,t,n,r,s,a,l,d,c);dot.register("m3",m3);Matrix3.IDENTITY=Matrix3.identity().makeImmutable();Matrix3.X_REFLECTION=m3(-1,0,0,0,1,0,0,0,1,Matrix3Type.AFFINE).makeImmutable();Matrix3.Y_REFLECTION=m3(1,0,0,0,-1,0,0,0,1,Matrix3Type.AFFINE).makeImmutable();Matrix3.Matrix3IO=new IOType("Matrix3IO",{valueType:Matrix3,documentation:"A 3x3 matrix often used for holding transform data.",toStateObject:o=>Matrix3.toStateObject(o),fromStateObject:Matrix3.fromStateObject,stateSchema:{entries:ArrayIO(NumberIO),type:EnumerationIO(Matrix3Type)}});class OpenRange extends Range{constructor(e,t,n){n=merge({openMin:!0,openMax:!0},n),super(e,t),this.openMin=n.openMin,this.openMax=n.openMax,assert&&assert(this.openMin||this.openMax,"use Range type if min and max are inclusive"),assert&&assert(e<t,"must instantiate OpenRange with min strictly less than max")}setMin(e){assert&&assert(e<this._max,"min must be strictly less than max for OpenRange"),super.setMin(e)}setMax(e){assert&&assert(e>this._min,"max must be strictly greater than min for OpenRange"),super.setMax(e)}setMinMax(e,t){assert&&assert(e<t,"min must be strictly less than max in OpenRange"),super.setMinMax(e,t)}contains(e){return(this.openMin?e>this.min:e>=this.min)&&(this.openMax?e<this.max:e<=this.max)}containsRange(e){return(this.openMin?this.min<e.min:this.min<=e.min)&&(this.openMax?this.max>e.max:this.max>=e.max)}intersects(e){return(this.openMax?this.max>e.min:this.max>=e.min)&&(this.openMin?e.max>this.min:e.max>=this.min)}toString(){const e=this.openMin?"(":"[",t=this.openMax?")":"]";return`[Range ${e}min:${this.min} max:${this.max}${t}]`}constrainValue(e){return Math.min(Math.max(e,this.min),this.max)}equals(e){return e instanceof Range&&this.min===e.min&&this.max===e.max&&this.openMin===e.openMin&&this.openMax===e.openMax}}dot.register("OpenRange",OpenRange);class Permutation{constructor(e){this.indices=e}size(){return this.indices.length}apply(e){if(typeof e=="number")return this.indices[e];{if(e.length!==this.size())throw new Error(`Permutation length ${this.size()} not equal to list length ${e.length}`);const t=new Array(e.length);for(let n=0;n<e.length;n++)t[n]=e[this.indices[n]];return t}}inverted(){const e=new Array(this.size());for(let t=0;t<this.size();t++)e[this.indices[t]]=t;return new Permutation(e)}withIndicesPermuted(e){const t=[];return Permutation.forEachPermutation(e,n=>{const r=this.indices,s=r.slice(0);for(let a=0;a<e.length;a++)s[e[a]]=r[n[a]];t.push(new Permutation(s))}),t}toString(){return`P[${this.indices.join(", ")}]`}equals(e){return this.indices.length===e.indices.length&&_.isEqual(this.indices,e.indices)}static identity(e){assert&&assert(e>=0);const t=new Array(e);for(let n=0;n<e;n++)t[n]=n;return new Permutation(t)}static permutations(e){const t=[];return Permutation.forEachPermutation(DotUtils.rangeInclusive(0,e-1),n=>{t.push(new Permutation(n.slice()))}),t}static forEachPermutation(e,t){recursiveForEachPermutation(e,[],t)}static permutationsOf(e){const t=[];return Permutation.forEachPermutation(e,n=>{t.push(n.slice())}),t}}dot.register("Permutation",Permutation);function recursiveForEachPermutation(o,e,t){if(o.length===0)t(e);else for(let n=0;n<o.length;n++){const r=o[n],s=o.slice(0);s.splice(n,1);const a=e.slice(0);a.push(r),recursiveForEachPermutation(s,a,t)}}class PiecewiseLinearFunction{constructor(e){assert&&assert(e.length%2===0,"array length should be even"),assert&&assert(e.length>0,"array must have elements"),assert&&assert(Array.isArray(e),"array should be an array"),this.array=e}evaluate(e){return PiecewiseLinearFunction.evaluate(this.array,e)}static evaluate(e,t){let n=-1,r=Number.POSITIVE_INFINITY,s=-1,a=Number.POSITIVE_INFINITY;for(let m=0;m<e.length;m+=2){const O=e[m],D=t-O,z=Math.abs(D);if(O===t)return e[m+1];O<=t&&z<r&&(n=m,r=z),O>=t&&z<a&&(s=m,a=z)}assert&&assert(n>=0,"lower bound not found"),assert&&assert(s>=0,"upper bound not found");const l=e[n],d=e[n+1],c=e[s],y=e[s+1];return DotUtils.linear(l,c,d,y,t)}}dot.register("PiecewiseLinearFunction",PiecewiseLinearFunction);class Ray3{constructor(e,t){this.position=e,this.direction=t,assert&&assert(Math.abs(t.magnitude-1)<.01,"the direction must be a unit vector")}shifted(e){return new Ray3(this.pointAtDistance(e),this.direction)}pointAtDistance(e){return this.position.plus(this.direction.timesScalar(e))}distanceToPlane(e){return(e.distance-this.position.dot(e.normal))/this.direction.dot(e.normal)}toString(){return`${this.position.toString()} => ${this.direction.toString()}`}}dot.register("Ray3",Ray3);const vo=class vo{constructor(e,t){this.normal=e,this.distance=t,assert&&assert(Math.abs(e.magnitude-1)<.01,"the normal vector must be a unit vector")}intersectWithRay(e){return e.pointAtDistance(e.distanceToPlane(this))}static fromTriangle(e,t,n){const r=n.minus(e).cross(t.minus(e));return r.magnitude===0?null:(r.normalize(),new vo(r,r.dot(e)))}getIntersection(e){const t=this.normal.dot(e.normal),n=1-t*t;if(n===0)return null;const r=(this.distance-e.distance*t)/n,s=(e.distance-this.distance*t)/n;return new Ray3(this.normal.timesScalar(r).plus(e.normal.timesScalar(s)),this.normal.cross(e.normal).normalized())}};vo.XY=new vo(new Vector3(0,0,1),0),vo.XZ=new vo(new Vector3(0,1,0),0),vo.YZ=new vo(new Vector3(1,0,0),0);let Plane3=vo;dot.register("Plane3",Plane3);class Quaternion{constructor(e,t,n,r){this.setXYZW(e,t,n,r)}setXYZW(e,t,n,r){this.x=e!==void 0?e:0,this.y=t!==void 0?t:0,this.z=n!==void 0?n:0,this.w=r!==void 0?r:1}plus(e){return new Quaternion(this.x+e.x,this.y+e.y,this.z+e.z,this.w+e.w)}timesScalar(e){return new Quaternion(this.x*e,this.y*e,this.z*e,this.w*e)}timesQuaternion(e){return new Quaternion(this.x*e.w-this.z*e.y+this.y*e.z+this.w*e.x,-this.x*e.z+this.y*e.w+this.z*e.x+this.w*e.y,this.x*e.y-this.y*e.x+this.z*e.w+this.w*e.z,-this.x*e.x-this.y*e.y-this.z*e.z+this.w*e.w)}timesVector3(e){return e.magnitude===0?new Vector3(0,0,0):new Vector3(this.w*this.w*e.x+2*this.y*this.w*e.z-2*this.z*this.w*e.y+this.x*this.x*e.x+2*this.y*this.x*e.y+2*this.z*this.x*e.z-this.z*this.z*e.x-this.y*this.y*e.x,2*this.x*this.y*e.x+this.y*this.y*e.y+2*this.z*this.y*e.z+2*this.w*this.z*e.x-this.z*this.z*e.y+this.w*this.w*e.y-2*this.x*this.w*e.z-this.x*this.x*e.y,2*this.x*this.z*e.x+2*this.y*this.z*e.y+this.z*this.z*e.z-2*this.w*this.y*e.x-this.y*this.y*e.z+2*this.w*this.x*e.y-this.x*this.x*e.z+this.w*this.w*e.z)}getMagnitude(){return Math.sqrt(this.magnitudeSquared)}get magnitude(){return this.getMagnitude()}getMagnitudeSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}get magnitudeSquared(){return this.getMagnitudeSquared()}normalized(){const e=this.magnitude;return assert&&assert(e!==0,"Cannot normalize a zero-magnitude quaternion"),this.timesScalar(1/e)}negated(){return new Quaternion(-this.x,-this.y,-this.z,-this.w)}toRotationMatrix(){const e=this.magnitudeSquared,t=e===1?2:e>0?2/e:0,n=this.x*this.x*t,r=this.x*this.y*t,s=this.x*this.z*t,a=this.w*this.x*t,l=this.y*this.y*t,d=this.y*this.z*t,c=this.w*this.y*t,y=this.z*this.z*t,m=this.w*this.z*t;return Matrix3.pool.fetch().columnMajor(1-(l+y),r+m,s-c,r-m,1-(n+y),d+a,s+c,d-a,1-(n+l))}static fromEulerAngles(e,t,n){const r=Math.sin(n*.5),s=Math.cos(n*.5),a=Math.sin(t*.5),l=Math.cos(t*.5),d=Math.sin(e*.5),c=Math.cos(e*.5),y=l*s,m=a*r,O=l*r,D=a*s;return new Quaternion(y*d+m*c,D*c+O*d,O*c-D*d,y*c-m*d)}static fromRotationMatrix(e){const t=e.m00(),n=e.m01(),r=e.m02(),s=e.m10(),a=e.m11(),l=e.m12(),d=e.m20(),c=e.m21(),y=e.m22(),m=t+a+y;let O;return m>=0?(O=Math.sqrt(m+1),new Quaternion((c-l)*.5/O,(r-d)*.5/O,(s-n)*.5/O,.5*O)):t>a&&t>y?(O=Math.sqrt(1+t-a-y),new Quaternion(O*.5,(s+n)*.5/O,(r+d)*.5/O,(c-l)*.5/O)):a>y?(O=Math.sqrt(1+a-t-y),new Quaternion((s+n)*.5/O,O*.5,(c+l)*.5/O,(r-d)*.5/O)):(O=Math.sqrt(1+y-t-a),new Quaternion((r+d)*.5/O,(c+l)*.5/O,O*.5,(s-n)*.5/O))}static getRotationQuaternion(e,t){return Quaternion.fromRotationMatrix(Matrix3.rotateAToB(e,t))}static slerp(e,t,n){if(e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w)return e;let r=e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w;r<0&&(t=t.negated(),r=-r);let s=1-n,a=n;if(1-r>.1){const l=Math.acos(r),d=1/Math.sin(l);s=Math.sin((1-n)*l)*d,a=Math.sin(n*l)*d}return new Quaternion(s*e.x+a*t.x,s*e.y+a*t.y,s*e.z+a*t.z,s*e.w+a*t.w)}}Quaternion.prototype.isQuaternion=!0;dot.register("Quaternion",Quaternion);Poolable.mixInto(Quaternion,{initialize:Quaternion.prototype.setXYZW});class RangeWithValue extends Range{constructor(e,t,n){super(e,t),assert&&assert(n!==void 0,"default value is required"),assert&&assert(n>=e&&n<=t,`defaultValue is out of range: ${n}`),this._defaultValue=n}getDefaultValue(){return this._defaultValue}get defaultValue(){return this.getDefaultValue()}setMin(e){assert&&assert(this._defaultValue>=e,`min must be <= defaultValue: ${e}`),super.setMin(e)}setMax(e){assert&&assert(this._defaultValue<=e,`max must be >= defaultValue: ${e}`),super.setMax(e)}setMinMax(e,t){return assert&&assert(this._defaultValue>=e,`min must be <= defaultValue: ${e}`),assert&&assert(this._defaultValue<=t,`max must be >= defaultValue: ${t}`),super.setMinMax(e,t)}toString(){return`[RangeWithValue (min:${this.min} max:${this.max} defaultValue:${this._defaultValue})]`}equals(e){return this.constructor===e.constructor&&this._defaultValue===e.defaultValue&&super.equals(e)}}dot.register("RangeWithValue",RangeWithValue);class Ray2{constructor(e,t){this.position=e,this.direction=t,assert&&assert(Math.abs(t.magnitude-1)<.01,"the direction must be a unit vector")}shifted(e){return new Ray2(this.pointAtDistance(e),this.direction)}pointAtDistance(e){return this.position.plus(this.direction.timesScalar(e))}toString(){return`${this.position.toString()} => ${this.direction.toString()}`}}dot.register("Ray2",Ray2);let Rectangle$1=class extends Bounds2{constructor(e,t,n,r){assert&&assert(r!==void 0,"Rectangle requires 4 parameters"),super(e,t,e+n,t+r)}};dot.register("Rectangle",Rectangle$1);class RunningAverage{constructor(e){assert&&assert(e>0,"window size must be positive"),this.windowSize=e,this.samples=new Array(e),this.sampleIndex=0,this.total=0,this.numSamples=0,this.clear()}clear(){this.total=0,this.numSamples=0;for(let e=0;e<this.windowSize;e++)this.samples[e]=0}getRunningAverage(){return this.total/this.numSamples}isSaturated(){return this.numSamples>=this.windowSize}updateRunningAverage(e){return assert&&assert(typeof e=="number"&&isFinite(e)),this.numSamples=Math.min(this.windowSize,this.numSamples+1),this.total-=this.samples[this.sampleIndex],assert&&assert(isFinite(this.total)),this.total+=e,assert&&assert(isFinite(this.total)),this.samples[this.sampleIndex]=e,this.sampleIndex=(this.sampleIndex+1)%this.windowSize,this.getRunningAverage()}}dot.register("RunningAverage",RunningAverage);class Sphere3{constructor(e,t){this.center=e,this.radius=t,assert&&assert(t>=0,"the radius of a sphere should be positive")}intersect(e,t){const n=e.direction,r=e.position,s=r.minus(this.center),a=n.dot(s),l=s.magnitudeSquared,d=4*a*a-4*(l-this.radius*this.radius);if(d<t)return null;const c=n.dot(this.center)-n.dot(r),y=Math.sqrt(d)/2,m=c-y,O=c+y;if(O<t)return null;const D=e.pointAtDistance(O),z=D.minus(this.center).normalized();if(m<t)return{distance:O,hitPoint:D,normal:z.negated(),fromOutside:!1};{const w=e.pointAtDistance(m),N=w.minus(this.center).normalized();return{distance:m,hitPoint:w,normal:N,fromOutside:!0}}}intersections(e,t){const n=e.direction,r=e.position,s=r.minus(this.center),a=n.dot(s),l=s.magnitudeSquared,d=4*a*a-4*(l-this.radius*this.radius);if(d<t)return[];const c=n.dot(this.center)-n.dot(r),y=Math.sqrt(d)/2,m=c-y,O=c+y;if(O<t)return[];const D=e.pointAtDistance(O),z=D.minus(this.center).normalized(),w=e.pointAtDistance(m),N=w.minus(this.center).normalized(),H={distance:O,hitPoint:D,normal:z.negated(),fromOutside:!1},X={distance:m,hitPoint:w,normal:N,fromOutside:!0};return m<t?[H,X]:[X,H]}}dot.register("Sphere3",Sphere3);const Stats$1={getPercentile(o,e){if(assert&&assert(Array.isArray(o)),assert&&o.forEach(r=>assert&&assert(typeof r=="number")),o.length===0)return null;o.sort((r,s)=>r-s);const t=e/100*o.length;let n=null;return Math.floor(t)===t?n=(o[t-1]+o[t])/2:n=o[Math.floor(t)],n},median(o){return Stats$1.getPercentile(o,50)},getBoxPlotValues(o){return assert&&assert(o.length>=4,"need at least 4 values to calculate quartiles"),{q1:Stats$1.getPercentile(o,25),median:Stats$1.getPercentile(o,50),q3:Stats$1.getPercentile(o,75)}},getBoxPlotLimits(o){assert&&assert(Array.isArray(o)),assert&&assert(o.length>=4,"need at least 4 values to calculate data limits"),assert&&o.forEach(s=>assert&&assert(typeof s=="number"));const e=Stats$1.getBoxPlotValues(o),t=e.q3-e.q1,n=e.q1-1.5*t,r=e.q3+1.5*t;return{lowerLimit:n,upperLimit:r}}};dot.register("Stats",Stats$1);const TOLERANCE=1e-6,approxEquals=(o,e)=>Math.abs(o-e)<=TOLERANCE;class Transform1{constructor(e,t,n){n=merge({domain:new Range(Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY),range:new Range(Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY)},n),this.evaluationFunction=e,this.inverseFunction=t,this.domain=n.domain,this.range=n.range}evaluate(e){assert&&assert(this.domain.contains(e),"Value out of domain");const t=this.evaluationFunction(e);return assert&&assert(approxEquals(this.inverseFunction(t),e)),t}inverse(e){assert&&assert(this.range.contains(e),"Value out of range");const t=this.inverseFunction(e);return assert&&assert(approxEquals(this.evaluationFunction(t),e)),t}}dot.register("Transform1",Transform1);const listenerOrder=_.hasIn(window,"phet.chipper.queryParameters")&&phet.chipper.queryParameters.listenerOrder,listenerLimit=_.hasIn(window,"phet.chipper.queryParameters")&&phet.chipper.queryParameters.listenerLimit;let random=null;if(listenerOrder&&listenerOrder.startsWith("random")){const o=listenerOrder.match(/random(?:%28|\()(\d+)(?:%29|\))/),e=o?Number(o[1]):dotRandom.nextInt(1e6);random=new Random({seed:e}),console.log("listenerOrder random seed: "+e)}let maxListenerCount=0;class TinyEmitter{constructor(e,t){e&&(this.onBeforeNotify=e),t&&(this.hasListenerOrderDependencies=t),this.listeners=new Set,this.emitContexts=[],assert&&(this.isDisposed=!1)}dispose(){this.removeAllListeners(),assert&&(this.isDisposed=!0)}emit(...e){if(assert&&assert(!this.isDisposed,"TinyEmitter.emit() should not be called if disposed."),this.onBeforeNotify&&this.onBeforeNotify.apply(null,e),assert&&listenerOrder&&listenerOrder!=="default"&&!this.hasListenerOrderDependencies){const t=Array.from(this.listeners),n=listenerOrder.startsWith("random")?random.shuffle(t):t.reverse();this.listeners=new Set(n)}if(this.listeners.size>0){const t={index:0};this.emitContexts.push(t);for(const n of this.listeners)if(n(...e),t.index++,t.listenerArray)break;if(t.listenerArray)for(let n=t.index;n<t.listenerArray.length;n++)t.listenerArray[n](...e);this.emitContexts.pop()}}addListener(e){assert&&assert(!this.isDisposed,"Cannot add a listener to a disposed TinyEmitter"),assert&&assert(!this.hasListener(e),"Cannot add the same listener twice"),this.guardListeners(),this.listeners.add(e),this.changeCount&&this.changeCount(1),assert&&listenerLimit&&isFinite(listenerLimit)&&maxListenerCount<this.listeners.size&&(maxListenerCount=this.listeners.size,console.log(`Max TinyEmitter listeners: ${maxListenerCount}`),assert(maxListenerCount<=listenerLimit,`listener count of ${maxListenerCount} above ?listenerLimit=${listenerLimit}`))}removeListener(e){assert&&!this.isDisposed&&assert(this.listeners.has(e),"tried to removeListener on something that wasn't a listener"),this.guardListeners(),this.listeners.delete(e),this.changeCount&&this.changeCount(-1)}removeAllListeners(){const e=this.listeners.size;this.guardListeners(),this.listeners.clear(),this.changeCount&&this.changeCount(-e)}guardListeners(){for(let e=this.emitContexts.length-1;e>=0&&!this.emitContexts[e].listenerArray;e--)this.emitContexts[e].listenerArray=Array.from(this.listeners)}hasListener(e){return assert&&assert(arguments.length===1,"Emitter.hasListener should be called with 1 argument"),this.listeners.has(e)}hasListeners(){return assert&&assert(arguments.length===0,"Emitter.hasListeners should be called without arguments"),this.listeners.size>0}getListenerCount(){return this.listeners.size}forEachListener(e){this.listeners.forEach(e)}}axon.register("TinyEmitter",TinyEmitter);const scratchMatrix$5=new Matrix3;class Transform3{constructor(e){this.matrix=Matrix3.IDENTITY.copy(),this.inverse=Matrix3.IDENTITY.copy(),this.matrixTransposed=Matrix3.IDENTITY.copy(),this.inverseTransposed=Matrix3.IDENTITY.copy(),this.inverseValid=!0,this.transposeValid=!0,this.inverseTransposeValid=!0,this.changeEmitter=new TinyEmitter,e&&this.setMatrix(e)}setMatrix(e){this.matrix.set(e),this.invalidate()}validateMatrix(e){assert&&assert(e instanceof Matrix3,"matrix was incorrect type"),assert&&assert(e.isFinite(),"matrix must be finite")}invalidate(){assert&&this.validateMatrix(this.matrix),this.inverseValid=!1,this.transposeValid=!1,this.inverseTransposeValid=!1,this.changeEmitter.emit()}prepend(e){assert&&this.validateMatrix(e),scratchMatrix$5.set(this.matrix),this.matrix.set(e),this.matrix.multiplyMatrix(scratchMatrix$5),this.invalidate()}prependTranslation(e,t){assert&&assert(typeof e=="number"&&typeof t=="number"&&isFinite(e)&&isFinite(t),"Attempted to prepend non-finite or non-number (x,y) to the transform"),this.matrix.prependTranslation(e,t),this.invalidate()}append(e){assert&&this.validateMatrix(e),this.matrix.multiplyMatrix(e),this.invalidate()}prependTransform(e){this.prepend(e.matrix)}appendTransform(e){this.append(e.matrix)}applyToCanvasContext(e){e.setTransform(this.matrix.m00(),this.matrix.m10(),this.matrix.m01(),this.matrix.m11(),this.matrix.m02(),this.matrix.m12())}copy(){const e=new Transform3(this.matrix);e.inverse=this.inverse,e.matrixTransposed=this.matrixTransposed,e.inverseTransposed=this.inverseTransposed,e.inverseValid=this.inverseValid,e.transposeValid=this.transposeValid,e.inverseTransposeValid=this.inverseTransposeValid}getMatrix(){return this.matrix}getInverse(){return this.inverseValid||(this.inverseValid=!0,this.inverse.set(this.matrix),this.inverse.invert()),this.inverse}getMatrixTransposed(){return this.transposeValid||(this.transposeValid=!0,this.matrixTransposed.set(this.matrix),this.matrixTransposed.transpose()),this.matrixTransposed}getInverseTransposed(){return this.inverseTransposeValid||(this.inverseTransposeValid=!0,this.inverseTransposed.set(this.getInverse()),this.inverseTransposed.transpose()),this.inverseTransposed}isIdentity(){return this.matrix.isFastIdentity()}isFinite(){return this.matrix.isFinite()}transformPosition2(e){return this.matrix.timesVector2(e)}transformDelta2(e){const t=this.getMatrix();return new Vector2(t.m00()*e.x+t.m01()*e.y,t.m10()*e.x+t.m11()*e.y)}transformNormal2(e){return this.getInverse().timesTransposeVector2(e).normalize()}transformX(e){const t=this.getMatrix();return assert&&assert(!t.m01(),"Transforming an X value with a rotation/shear is ill-defined"),t.m00()*e+t.m02()}transformY(e){const t=this.getMatrix();return assert&&assert(!t.m10(),"Transforming a Y value with a rotation/shear is ill-defined"),t.m11()*e+t.m12()}transformDeltaX(e){return this.getMatrix().m00()*e}transformDeltaY(e){return this.getMatrix().m11()*e}transformBounds2(e){return e.transformed(this.matrix)}transformShape(e){return e.transformed(this.matrix)}transformRay2(e){return new Ray2(this.transformPosition2(e.position),this.transformDelta2(e.direction).normalized())}inversePosition2(e){return this.getInverse().timesVector2(e)}inverseDelta2(e){const t=this.getInverse();return new Vector2(t.m00()*e.x+t.m01()*e.y,t.m10()*e.x+t.m11()*e.y)}inverseNormal2(e){return this.matrix.timesTransposeVector2(e).normalize()}inverseX(e){const t=this.getInverse();return assert&&assert(!t.m01(),"Inverting an X value with a rotation/shear is ill-defined"),t.m00()*e+t.m02()}inverseY(e){const t=this.getInverse();return assert&&assert(!t.m10(),"Inverting a Y value with a rotation/shear is ill-defined"),t.m11()*e+t.m12()}inverseDeltaX(e){const t=this.getInverse();return assert&&assert(!t.m01(),"Inverting an X value with a rotation/shear is ill-defined"),t.m00()*e}inverseDeltaY(e){const t=this.getInverse();return assert&&assert(!t.m10(),"Inverting a Y value with a rotation/shear is ill-defined"),t.m11()*e}inverseBounds2(e){return e.transformed(this.getInverse())}inverseShape(e){return e.transformed(this.getInverse())}inverseRay2(e){return new Ray2(this.inversePosition2(e.position),this.inverseDelta2(e.direction).normalized())}}dot.register("Transform3",Transform3);const scratchMatrix$4=new Matrix4;function checkMatrix(o){return o instanceof Matrix4&&o.isFinite()}class Transform4{constructor(e){this.matrix=Matrix4.IDENTITY.copy(),this.inverse=Matrix4.IDENTITY.copy(),this.matrixTransposed=Matrix4.IDENTITY.copy(),this.inverseTransposed=Matrix4.IDENTITY.copy(),this.inverseValid=!0,this.transposeValid=!0,this.inverseTransposeValid=!0,this.changeEmitter=new TinyEmitter,e&&this.setMatrix(e)}setMatrix(e){assert&&assert(checkMatrix(e),"Matrix has NaNs, non-finite values, or isn't a matrix!"),this.matrix.set(e),this.invalidate()}invalidate(){assert&&assert(this.matrix.isFinite()),this.inverseValid=!1,this.transposeValid=!1,this.inverseTransposeValid=!1,this.changeEmitter.emit()}prepend(e){assert&&assert(checkMatrix(e),"Matrix has NaNs, non-finite values, or isn't a matrix!"),scratchMatrix$4.set(this.matrix),this.matrix.set(e),this.matrix.multiplyMatrix(scratchMatrix$4),this.invalidate()}append(e){assert&&assert(checkMatrix(e),"Matrix has NaNs, non-finite values, or isn't a matrix!"),this.matrix.multiplyMatrix(e),this.invalidate()}prependTransform(e){this.prepend(e.matrix)}appendTransform(e){this.append(e.matrix)}applyToCanvasContext(e){e.setTransform(this.matrix.m00(),this.matrix.m10(),this.matrix.m01(),this.matrix.m11(),this.matrix.m03(),this.matrix.m13())}copy(){const e=new Transform4(this.matrix);e.inverse=this.inverse,e.matrixTransposed=this.matrixTransposed,e.inverseTransposed=this.inverseTransposed,e.inverseValid=this.inverseValid,e.transposeValid=this.transposeValid,e.inverseTransposeValid=this.inverseTransposeValid}getMatrix(){return this.matrix}getInverse(){return this.inverseValid||(this.inverseValid=!0,this.inverse.set(this.matrix),this.inverse.invert()),this.inverse}getMatrixTransposed(){return this.transposeValid||(this.transposeValid=!0,this.matrixTransposed.set(this.matrix),this.matrixTransposed.transpose()),this.matrixTransposed}getInverseTransposed(){return this.inverseTransposeValid||(this.inverseTransposeValid=!0,this.inverseTransposed.set(this.getInverse()),this.inverseTransposed.transpose()),this.inverseTransposed}isIdentity(){return this.matrix.type===Matrix4.Types.IDENTITY}isFinite(){return this.matrix.isFinite()}transformPosition3(e){return this.matrix.timesVector3(e)}transformDelta3(e){return this.matrix.timesRelativeVector3(e)}transformNormal3(e){return this.getInverse().timesTransposeVector3(e)}transformDeltaX(e){return this.transformDelta3(new Vector3(e,0,0)).x}transformDeltaY(e){return this.transformDelta3(new Vector3(0,e,0)).y}transformDeltaZ(e){return this.transformDelta3(new Vector3(0,0,e)).z}transformRay(e){return new Ray3(this.transformPosition3(e.position),this.transformPosition3(e.position.plus(e.direction)).minus(this.transformPosition3(e.position)))}inversePosition3(e){return this.getInverse().timesVector3(e)}inverseDelta3(e){return this.inversePosition3(e).minus(this.inversePosition3(Vector3.ZERO))}inverseNormal3(e){return this.matrix.timesTransposeVector3(e)}inverseDeltaX(e){return this.inverseDelta3(new Vector3(e,0,0)).x}inverseDeltaY(e){return this.inverseDelta3(new Vector3(0,e,0)).y}inverseDeltaZ(e){return this.inverseDelta3(new Vector3(0,0,e)).z}inverseRay(e){return new Ray3(this.inversePosition3(e.position),this.inversePosition3(e.position.plus(e.direction)).minus(this.inversePosition3(e.position)))}}dot.register("Transform4",Transform4);const Ir=class Ir{constructor(e){const t=e.slice();for(;t.length&&t[t.length-1]===0;)t.pop();this.coefficients=t}plus(e){const t=[];for(let n=0;n<Math.max(this.coefficients.length,e.coefficients.length);n++)t.push(this.getCoefficient(n)+e.getCoefficient(n));return new Ir(t)}minus(e){const t=[];for(let n=0;n<Math.max(this.coefficients.length,e.coefficients.length);n++)t.push(this.getCoefficient(n)-e.getCoefficient(n));return new Ir(t)}times(e){const t=[];for(;t.length<this.coefficients.length+e.coefficients.length-1;)t.push(0);for(let n=0;n<this.coefficients.length;n++)for(let r=0;r<e.coefficients.length;r++)t[n+r]+=this.getCoefficient(n)*e.getCoefficient(r);return new Ir(t)}dividedBy(e){let t=new Ir([]),n=this;const r=e.degree,s=e.coefficients[e.coefficients.length-1];for(;n.degree>=r;){const a=Ir.singleCoefficient(n.getCoefficient(n.degree)/s,n.degree-r);t=t.plus(a),n=n.minus(a.times(e))}return{quotient:t,remainder:n}}gcd(e){let t=this,n=e;for(;!n.isZero();){const r=n;n=t.dividedBy(n).remainder,t=r}return t}equals(e){return this.coefficients.length===e.coefficients.length&&this.coefficients.every((t,n)=>t===e.coefficients[n])}getCoefficient(e){return e<this.coefficients.length?this.coefficients[e]:0}get degree(){return this.coefficients.length-1}isZero(){return this.coefficients.length===0}getMonicPolynomial(){if(this.isZero())return this;{const e=this.coefficients[this.coefficients.length-1];return new Ir(this.coefficients.map(t=>t/e))}}evaluate(e){let t=this.coefficients[this.coefficients.length-1];for(let n=this.coefficients.length-2;n>=0;n--)t=t*e+this.coefficients[n];return t}evaluateComplex(e){let t=Complex.real(this.coefficients[this.coefficients.length-1]);for(let n=this.coefficients.length-2;n>=0;n--)t=t.times(e).plus(Complex.real(this.coefficients[n]));return t}getRoots(){if(this.isZero()||this.degree===0)return[];if(this.degree===1)return[Complex.real(-this.coefficients[0]/this.coefficients[1])];if(this.coefficients[0]===0){const e=new Ir(this.coefficients.slice(1)).getRoots();return e.some(t=>t.equalsEpsilon(Complex.real(0),1e-10))||e.push(Complex.real(0)),e}else{if(this.degree===2)return Complex.solveQuadraticRoots(Complex.real(this.coefficients[2]),Complex.real(this.coefficients[1]),Complex.real(this.coefficients[0]));if(this.degree===3)return Complex.solveCubicRoots(Complex.real(this.coefficients[3]),Complex.real(this.coefficients[2]),Complex.real(this.coefficients[1]),Complex.real(this.coefficients[0]));{const e=new Matrix$1(this.degree,this.degree);for(let c=0;c<this.degree;c++)c<this.degree-1&&e.set(c+1,c,1),e.set(c,this.degree-1,-this.coefficients[c]/this.coefficients[this.degree]);console.log(e.toString());let t=e;const n=1e-13;for(let c=0;c<500;c++){const y=new QRDecomposition(t);if(t=y.getR().times(y.getQ()),c%10===0){let m=0;for(let O=0;O<this.degree;O++)for(let D=0;D<O;D++)m=Math.max(m,Math.abs(t.get(O,D)));if(m<n||c>1e3)break}}const r=_.range(0,this.degree).map(c=>Complex.real(t.get(c,c))),s=new EigenvalueDecomposition(e),a=s.getRealEigenvalues(),l=s.getImagEigenvalues(),d=_.range(0,this.degree).map(c=>new Complex(a[c],l[c]));return r||d}}}static singleCoefficient(e,t){const n=[];for(;n.length<t;)n.push(0);return n.push(e),new Ir(n)}};Ir.ZERO=new Ir([]);let UnivariatePolynomial=Ir;dot.register("UnivariatePolynomial",UnivariatePolynomial);class Timer extends TinyEmitter{setTimeout(e,t){let n=0;const r=s=>{n+=s,n*1e3>=t&&this.hasListener(r)&&(e(),this.removeListener(r))};return this.addListener(r),r}clearTimeout(e){this.hasListener(e)&&this.removeListener(e)}setInterval(e,t){let n=0;const r=s=>{for(n+=s;n*1e3>=t&&this.hasListener(r);)e(),n=n-t/1e3};return this.addListener(r),r}clearInterval(e){this.hasListener(e)&&this.removeListener(e)}runOnNextTick(e){this.setTimeout(e,0)}}axon.register("Timer",Timer);const animationFrameTimer=new Timer;axon.register("animationFrameTimer",animationFrameTimer);var _a;const tr=class tr extends EnumerationValue{};_a=TandemConstants.EVENT_TYPE_MODEL,tr.USER=new tr,tr[_a]=new tr,tr.WRAPPER=new tr,tr.OPT_OUT=new tr,tr.enumeration=new Enumeration(tr),tr.phetioType=EnumerationIO(tr);let EventType=tr;tandemNamespace.register("EventType",EventType);const packageJSON=_.hasIn(window,"phet.chipper.packageObject")?phet.chipper.packageObject:{name:"placeholder"},PHET_IO_ENABLED$1=_.hasIn(window,"phet.preloads.phetio"),PRINT_MISSING_TANDEMS=PHET_IO_ENABLED$1&&phet.preloads.phetio.queryParameters.phetioPrintMissingTandems,IS_VALIDATION_DEFAULT=_.hasIn(packageJSON,"phet.phet-io.validation")?!!packageJSON.phet["phet-io"].validation:!0,IS_VALIDATION_QUERY_PARAMETER_SPECIFIED=window.QueryStringMachine&&QueryStringMachine.containsKey("phetioValidation"),IS_VALIDATION_SPECIFIED=PHET_IO_ENABLED$1&&IS_VALIDATION_QUERY_PARAMETER_SPECIFIED?!!phet.preloads.phetio.queryParameters.phetioValidation:PHET_IO_ENABLED$1&&IS_VALIDATION_DEFAULT,VALIDATION=PHET_IO_ENABLED$1&&IS_VALIDATION_SPECIFIED&&!PRINT_MISSING_TANDEMS,UNALLOWED_TANDEM_NAMES=["pickableProperty","inputListener","dragHandler"],REQUIRED_TANDEM_NAME="requiredTandem",OPTIONAL_TANDEM_NAME="optionalTandem",FORBIDDEN_SUPPLIED_TANDEM_NAMES=[REQUIRED_TANDEM_NAME,OPTIONAL_TANDEM_NAME],TEST_TANDEM_NAME="test",INTER_TERM_SEPARATOR=phetio.PhetioIDUtils.INTER_TERM_SEPARATOR,DYNAMIC_ARCHETYPE_NAME=phetio.PhetioIDUtils.ARCHETYPE,missingTandems={required:[],optional:[]},phetioObjectListeners=[],launchListeners=[],pi=class pi{constructor(e,t,n){this.children={},this.isDisposed=!1,assert&&assert(e===null||e instanceof pi,"parentTandem should be null or Tandem"),assert&&assert(t!==pi.METADATA_KEY,"name cannot match Tandem.METADATA_KEY"),this.parentTandem=e,this.name=t,this.phetioID=this.parentTandem?window.phetio.PhetioIDUtils.append(this.parentTandem.phetioID,this.name):this.name;const r=optionize()({required:!0,supplied:!0,isValidTandemName:s=>pi.getRegexFromCharacterClass().test(s)},n);assert&&assert(r.isValidTandemName(t),`invalid tandem name: ${t}`),assert&&assert(!r.supplied||FORBIDDEN_SUPPLIED_TANDEM_NAMES.every(s=>!t.includes(s)),`forbidden supplied tandem name: ${t}. If a tandem is not supplied, its name should not be used to create a supplied tandem.`),this.children={},this.parentTandem&&(assert&&assert(!this.parentTandem.hasChild(t),`parent should not have child: ${t}`),this.parentTandem.addChild(t,this)),this.required=r.required,this.supplied=r.supplied}static getRegexFromCharacterClass(e=TandemConstants.BASE_TANDEM_CHARACTER_CLASS){return new RegExp(`^[${e}]+$`)}static onMissingTandem(e){if(PRINT_MISSING_TANDEMS&&!e.supplied){const t=pi.captureStackTrace();e.required?missingTandems.required.push({phetioID:e.phetioID,stack:t}):t.includes("Font")||missingTandems.optional.push({phetioID:e.phetioID,stack:t})}}static captureStackTrace(e=1/0){const t=Object.getOwnPropertyDescriptor(Error,"stackTraceLimit");if(t&&(t.writable||t.set&&typeof t.set=="function")){const r=Error.stackTraceLimit;Error.stackTraceLimit=e;const s=new Error().stack;return Error.stackTraceLimit=r,s}else return new Error().stack}addPhetioObject(e){if(PHET_IO_ENABLED$1){if(assert&&pi.VALIDATION&&assert(!(this.required&&!this.supplied),"Tandem was required but not supplied"),!this.required&&!this.supplied)return;if(!pi.launched)pi.bufferedPhetioObjects.push(e);else for(let t=0;t<phetioObjectListeners.length;t++)phetioObjectListeners[t].addPhetioObject(e)}}hasAncestor(e){return this.parentTandem===e||!!(this.parentTandem&&this.parentTandem.hasAncestor(e))}removePhetioObject(e){if(this.supplied){if(PHET_IO_ENABLED$1)if(!pi.launched)assert&&assert(pi.bufferedPhetioObjects.includes(e),"should contain item"),arrayRemove(pi.bufferedPhetioObjects,e);else for(let t=0;t<phetioObjectListeners.length;t++)phetioObjectListeners[t].removePhetioObject(e);e.tandem.dispose()}}getExtendedOptions(e){return merge({supplied:this.supplied,required:this.required},e)}createTandem(e,t){if(assert&&pi.VALIDATION&&assert(!UNALLOWED_TANDEM_NAMES.includes(e),"tandem name is not allowed: "+e),t=this.getExtendedOptions(t),this.hasChild(e)){const n=this.children[e];return assert&&assert(n.required===t.required),assert&&assert(n.supplied===t.supplied),n}else return new pi(this,e,t)}createTandem1Indexed(e,t,n){return this.createTandem(`${e}${t+1}`,n)}hasChild(e){return this.children.hasOwnProperty(e)}addChild(e,t){assert&&assert(!this.hasChild(e)),this.children[e]=t}iterateDescendants(e){for(const t in this.children)this.children.hasOwnProperty(t)&&(e(this.children[t]),this.children[t].iterateDescendants(e))}removeChild(e){assert&&assert(this.hasChild(e)),delete this.children[e]}dispose(){assert&&assert(!this.isDisposed,"already disposed"),this.parentTandem.removeChild(this.name),this.parentTandem=null,this.isDisposed=!0}getArchetypalPhetioID(){return window.phetio.PhetioIDUtils.getArchetypalPhetioID(this.phetioID)}createGroupTandem(e){return this.children[e]?this.children[e]:new GroupTandem(this,e)}equals(e){return this.phetioID===e.phetioID}static addPhetioObjectListener(e){phetioObjectListeners.push(e)}static launch(){for(assert&&assert(!pi.launched,"Tandem cannot be launched twice"),pi.launched=!0;launchListeners.length>0;)launchListeners.shift()();assert&&assert(launchListeners.length===0)}static unlaunch(){pi.launched=!1,pi.bufferedPhetioObjects.length=0,launchListeners.length=0}static addLaunchListener(e){assert&&assert(!pi.launched,"tandem has already been launched, cannot add listener for that hook."),launchListeners.push(e)}createTandemFromPhetioID(e){return this.createTandem(e.split(window.phetio.PhetioIDUtils.SEPARATOR).join(INTER_TERM_SEPARATOR),{isValidTandemName:t=>pi.getRegexFromCharacterClass(TandemConstants.BASE_DERIVED_TANDEM_CHARACTER_CLASS).test(t)})}static getStringsTandem(e=pi.ROOT.name){return pi.STRINGS.createTandem(e)}static getDerivedStringsTandem(e=pi.ROOT.name){return pi.getStringsTandem(e).createTandem("derivedStrings")}};pi.SCREEN_TANDEM_NAME_SUFFIX="Screen",pi.missingTandems=missingTandems,pi.PHET_IO_ENABLED=PHET_IO_ENABLED$1,pi.API_GENERATION=pi.PHET_IO_ENABLED&&(phet.preloads.phetio.queryParameters.phetioPrintAPI||phet.preloads.phetio.queryParameters.phetioCompareAPI),pi.VALIDATION=VALIDATION,pi.METADATA_KEY="_metadata",pi.DATA_KEY="_data",pi.launched=!1,pi.bufferedPhetioObjects=[],pi.RootTandem=class extends pi{createTandem(t,n){if(pi.VALIDATION){const r=t===window.phetio.PhetioIDUtils.GLOBAL_COMPONENT_NAME||t===REQUIRED_TANDEM_NAME||t===OPTIONAL_TANDEM_NAME||t===TEST_TANDEM_NAME||t===window.phetio.PhetioIDUtils.GENERAL_COMPONENT_NAME||_.endsWith(t,pi.SCREEN_TANDEM_NAME_SUFFIX);assert&&assert(r,`tandem name not allowed on root: "${t}"; perhaps try putting it under general or global`)}return super.createTandem(t,n)}},pi.ROOT=new pi.RootTandem(null,_.camelCase(packageJSON.name)),pi.GENERAL=pi.ROOT.createTandem(window.phetio.PhetioIDUtils.GENERAL_COMPONENT_NAME),pi.ROOT_TEST=pi.ROOT.createTandem(TEST_TANDEM_NAME),pi.GENERAL_MODEL=pi.GENERAL.createTandem(window.phetio.PhetioIDUtils.MODEL_COMPONENT_NAME),pi.GENERAL_VIEW=pi.GENERAL.createTandem(window.phetio.PhetioIDUtils.VIEW_COMPONENT_NAME),pi.GENERAL_CONTROLLER=pi.GENERAL.createTandem(window.phetio.PhetioIDUtils.CONTROLLER_COMPONENT_NAME),pi.GLOBAL=pi.ROOT.createTandem(window.phetio.PhetioIDUtils.GLOBAL_COMPONENT_NAME),pi.GLOBAL_MODEL=pi.GLOBAL.createTandem(window.phetio.PhetioIDUtils.MODEL_COMPONENT_NAME),pi.GLOBAL_VIEW=pi.GLOBAL.createTandem(window.phetio.PhetioIDUtils.VIEW_COMPONENT_NAME),pi.COLORS=pi.GLOBAL_VIEW.createTandem(window.phetio.PhetioIDUtils.COLORS_COMPONENT_NAME),pi.STRINGS=pi.GENERAL_MODEL.createTandem(window.phetio.PhetioIDUtils.STRINGS_COMPONENT_NAME),pi.OPTIONAL=pi.ROOT.createTandem(OPTIONAL_TANDEM_NAME,{required:!1,supplied:!1}),pi.OPT_OUT=pi.OPTIONAL,pi.REQUIRED=pi.ROOT.createTandem(REQUIRED_TANDEM_NAME,{required:VALIDATION||PRINT_MISSING_TANDEMS,supplied:!1}),pi.PREFERENCES=pi.GLOBAL_MODEL.createTandem("preferences"),pi.REGION_CULTURE_PORTRAYALS=pi.PREFERENCES.createTandem("regionAndCulturePortrayals");let Tandem=pi;Tandem.addLaunchListener(()=>{for(;Tandem.bufferedPhetioObjects.length>0;){const o=Tandem.bufferedPhetioObjects.shift();o.tandem.addPhetioObject(o)}assert&&assert(Tandem.bufferedPhetioObjects.length===0,"bufferedPhetioObjects should be empty")});class GroupTandem extends Tandem{constructor(e,t){super(e,t),this.groupName=t,this.groupMemberIndex=0}createNextTandem(){const e=this.parentTandem.createTandem(`${this.groupName}${this.groupMemberIndex}`);return this.groupMemberIndex++,e}}tandemNamespace.register("Tandem",Tandem);const ValueIO=new IOType("ValueIO",{isValidValue:_.stubTrue,supertype:IOType.ObjectIO,toStateObject:o=>o,fromStateObject:o=>o,stateSchema:StateSchema.asValue("*",{isValidValue:_.stubTrue})});tandemNamespace.register("ValueIO",ValueIO);const StringIO=new IOType("StringIO",{supertype:ValueIO,valueType:"string",documentation:"PhET-iO Type for Javascript's string primitive type",stateSchema:StateSchema.asValue("string",{valueType:"string"}),toStateObject:_.identity});tandemNamespace.register("StringIO",StringIO);const LinkedElementIO=new IOType("LinkedElementIO",{isValidValue:()=>!0,documentation:"A LinkedElement",toStateObject:o=>(assert&&Tandem.VALIDATION&&assert(o.element.isPhetioInstrumented(),"Linked elements must be instrumented"),{elementID:o.element.tandem.phetioID}),applyState:_.noop,stateSchema:{elementID:StringIO}});tandemNamespace.register("LinkedElementIO",LinkedElementIO);const KEYS_TO_CHECK=["phetioDynamicElement","phetioEventType","phetioIsArchetype","phetioPlayback","phetioReadOnly","phetioState","phetioTypeName"];class PhetioAPIValidation{constructor(){this.apiMismatches=[],this.simHasStarted=!1,this.enabled=!!assert&&Tandem.VALIDATION,this.everyPhetioType={}}onSimStarted(){this.enabled&&phet.joist.sim.allScreensCreated&&(this.validateOverridesFile(),this.validatePreferencesModel()),phet.preloads.phetio.queryParameters.phetioPrintAPIProblems&&this.apiMismatches&&console.log("PhET-iO API problems detected: ",this.apiMismatches),this.simHasStarted=!0}validatePreferencesModel(){Object.keys(phet.phetio.phetioEngine.phetioElementMap).filter(e=>e.includes(".preferencesModel.")).forEach(e=>{let t=phet.phetio.phetioEngine.phetioElementMap[e];for(;t instanceof LinkedElement;)t=t.element;assert&&assert(!t.phetioReadOnly,"preferences model and its descendants should be phetioReadOnly: false, key="+e),assert&&assert(t.phetioState===(t.phetioID.endsWith(".colorProfileProperty")||t.phetioID.endsWith(".audioEnabledProperty")||t.phetioID.endsWith(".localeProperty")||e.includes(".simulationModel.")),"most preferences should be phetioState: false, key="+e)})}onPhetioObjectRemoved(e){if(!this.enabled)return;const t=e.tandem.phetioID;e.phetioDynamicElement||this.assertAPIError({phetioID:t,ruleInViolation:"2. Any static, registered PhetioObject can never be deregistered."})}onPhetioObjectAdded(e){if(!this.enabled)return;const t=e.phetioType;this.everyPhetioType[t.typeName]||(this.everyPhetioType[t.typeName]=t),this.simHasStarted&&phet.axon.animationFrameTimer.runOnNextTick(()=>{if(!e.phetioDynamicElement)this.assertAPIError({phetioID:e.tandem.phetioID,ruleInViolation:"1. After startup, only dynamic instances prescribed by the baseline file can be registered."});else if(phet.preloads.phetio.createArchetypes&&!e.isDisposed){const r=e.tandem.getArchetypalPhetioID(),s=phet.phetio.phetioEngine.getPhetioElement(r).getMetadata();this.checkDynamicInstanceAgainstArchetype(e,s,"simulation archetype")}})}validateOverridesFile(){const e=phet.phetio.phetioEngine.getPhetioElementsBaseline();for(const t in window.phet.preloads.phetio.phetioElementsOverrides){const n=t.includes(DYNAMIC_ARCHETYPE_NAME);if(!phet.preloads.phetio.createArchetypes&&!e.hasOwnProperty(t))assert&&assert(n,`phetioID missing from the baseline that was not an archetype: ${t}`);else if(!e.hasOwnProperty(t))this.assertAPIError({phetioID:t,ruleInViolation:"3. Any schema entries in the overrides file must exist in the baseline file.",message:"phetioID expected in the baseline file but does not exist"});else{const r=window.phet.preloads.phetio.phetioElementsOverrides[t],s=e[t];Object.keys(r).length===0&&this.assertAPIError({phetioID:t,ruleInViolation:"4. Any schema entries in the overrides file must be different from its baseline counterpart.",message:"no metadata keys found for this override."});for(const a in r)s.hasOwnProperty(a)||this.assertAPIError({phetioID:t,ruleInViolation:"8. Any schema entries in the overrides file must be different from its baseline counterpart.",message:`phetioID metadata key not found in the baseline: ${a}`}),r[a]===s[a]&&this.assertAPIError({phetioID:t,ruleInViolation:"8. Any schema entries in the overrides file must be different from its baseline counterpart.",message:"phetioID metadata override value is the same as the corresponding metadata value in the baseline."})}}}assertAPIError(e){const t=e.phetioID?`${e.phetioID}:  ${e.ruleInViolation}`:`${e.ruleInViolation}`;this.apiMismatches.push(e),(this.simHasStarted||!phet.preloads.phetio.queryParameters.phetioPrintAPIProblems)&&assert&&assert(!1,`PhET-iO API error:
${t}`)}checkDynamicInstanceAgainstArchetype(e,t,n){const r=e.getMetadata();KEYS_TO_CHECK.forEach(s=>{s!=="phetioDynamicElement"&&s!=="phetioArchetypePhetioID"&&s!=="phetioIsArchetype"&&t[s]!==r[s]&&e.tandem&&this.assertAPIError({phetioID:e.tandem.phetioID,ruleInViolation:"5. Dynamic element metadata should match the archetype in the API.",source:n,message:`mismatched metadata: ${s}`})})}}const phetioAPIValidation=new PhetioAPIValidation;tandemNamespace.register("phetioAPIValidation",phetioAPIValidation);class Disposable{constructor(e){if(this._disposeEmitter=new TinyEmitter,this._isDisposable=!0,this._isDisposed=!1,e&&this.initializeDisposable(e),assert){const t=this.dispose;this.dispose=()=>{assert&&assert(!this._isDisposed,"This Disposable has already been disposed, and cannot be disposed again"),t.call(this),assert&&assert(this._isDisposed,"Disposable.dispose() call is missing from an overridden dispose method")}}}getDisposeEmitter(){return this._disposeEmitter}get disposeEmitter(){return this.getDisposeEmitter()}get isDisposed(){return this._isDisposed}get isDisposable(){return this._isDisposable}set isDisposable(e){this._isDisposable=e}initializeDisposable(e){e&&e.hasOwnProperty("isDisposable")&&(this._isDisposable=e.isDisposable)}dispose(){assert&&!this._isDisposable&&Disposable.assertNotDisposable(),assert&&assert(!this._isDisposed,"Disposable can only be disposed once"),this._disposeEmitter.emit(),this._disposeEmitter.dispose(),this._isDisposed=!0}static assertNotDisposable(){assert&&assert(!1,"dispose is not supported, exists for the lifetime of the sim")}}axon.register("Disposable",Disposable);const ir=class ir{static add(e,t){assert&&assert(!ir.map.has(e.phetioID),"TandemID already exists in the DescriptionRegistry"),ir.map.set(e.phetioID,t);const n=e.phetioID.split(".");let r=ir.root;for(let s=0;s<n.length;s++){const a=n[s];r[a]||(r[a]={}),r=r[a]}r._value=t,ir.addedEmitter.emit(e.phetioID,t)}static remove(e){const t=e.phetioID;if(ir.map.has(t)){ir.removedEmitter.emit(t,e),ir.map.delete(t);const n=t.split("."),r=[];let s=ir.root;for(let a=0;a<n.length;a++){const l=n[a];s&&(s=s[l],s&&r.push(s))}r.length===n.length&&delete s._value;for(let a=r.length-1;a>=0;a--){const l=r[a];l&&Object.keys(l).length===0&&delete r[a]}}else assert&&assert(!1,"PhetioObject not found in DescriptionRegistry")}};ir.root={},ir.map=new Map,ir.addedEmitter=new TinyEmitter,ir.removedEmitter=new TinyEmitter;let DescriptionRegistry=ir;tandemNamespace.register("DescriptionRegistry",DescriptionRegistry);const PHET_IO_ENABLED=Tandem.PHET_IO_ENABLED,IO_TYPE_VALIDATOR={valueType:IOType,validationMessage:"phetioType must be an IOType"},BOOLEAN_VALIDATOR$1={valueType:"boolean"},PHET_IO_DOCUMENTATION_VALIDATOR={valueType:"string",isValidValue:o=>!o.includes(`
`),validationMessage:"phetioDocumentation must be provided in the right format"},PHET_IO_EVENT_TYPE_VALIDATOR={valueType:EventType,validationMessage:"invalid phetioEventType"},OBJECT_VALIDATOR={valueType:[Object,null]},objectToPhetioID=o=>o.tandem.phetioID,SKIPPING_MESSAGE=-1;var ad,ld,hd;const ENABLE_DESCRIPTION_REGISTRY=!!((hd=(ld=(ad=window.phet)==null?void 0:ad.chipper)==null?void 0:ld.queryParameters)!=null&&hd.supportsDescriptionPlugin),DEFAULTS={tandem:Tandem.OPTIONAL,descriptionTandem:Tandem.OPTIONAL,phetioType:IOType.ObjectIO,phetioDocumentation:TandemConstants.PHET_IO_OBJECT_METADATA_DEFAULTS.phetioDocumentation,phetioState:TandemConstants.PHET_IO_OBJECT_METADATA_DEFAULTS.phetioState,phetioReadOnly:TandemConstants.PHET_IO_OBJECT_METADATA_DEFAULTS.phetioReadOnly,phetioEventType:EventType.MODEL,phetioHighFrequency:TandemConstants.PHET_IO_OBJECT_METADATA_DEFAULTS.phetioHighFrequency,phetioPlayback:TandemConstants.PHET_IO_OBJECT_METADATA_DEFAULTS.phetioPlayback,phetioFeatured:TandemConstants.PHET_IO_OBJECT_METADATA_DEFAULTS.phetioFeatured,phetioDynamicElement:TandemConstants.PHET_IO_OBJECT_METADATA_DEFAULTS.phetioDynamicElement,phetioDesigned:TandemConstants.PHET_IO_OBJECT_METADATA_DEFAULTS.phetioDesigned,phetioEventMetadata:null,tandemNameSuffix:null};assert&&assert(EventType.phetioType.toStateObject(DEFAULTS.phetioEventType)===TandemConstants.PHET_IO_OBJECT_METADATA_DEFAULTS.phetioEventType,"phetioEventType must have the same default as the default metadata values.");const Qa=class Qa extends Disposable{constructor(e){super(),this.tandem=DEFAULTS.tandem,this.phetioID=this.tandem.phetioID,this.phetioObjectInitialized=!1,e&&this.initializePhetioObject({},e)}initializePhetioObject(e,t){if(assert&&assert(!e.hasOwnProperty("isDisposable"),"baseOptions should not contain isDisposable"),this.initializeDisposable(t),assert&&assert(t,"initializePhetioObject must be called with providedOptions"),t.tandem&&Tandem.onMissingTandem(t.tandem),assert&&Tandem.VALIDATION&&t.tandem&&t.tandem.required&&assert(t.tandem.supplied,"required tandems must be supplied"),ENABLE_DESCRIPTION_REGISTRY&&t.tandem&&t.tandem.supplied&&DescriptionRegistry.add(t.tandem,this),!(PHET_IO_ENABLED&&t.tandem&&t.tandem.supplied)){t.tandem&&(this.tandem=t.tandem,this.phetioID=this.tandem.phetioID);return}assert&&assert(!this.phetioObjectInitialized,"cannot initialize twice"),assert&&validate(t.tandem,{valueType:Tandem});const n=combineOptions({},DEFAULTS,e);let r=optionize()(n,t);assert&&validate(r.phetioType,IO_TYPE_VALIDATOR),assert&&validate(r.phetioState,merge({},BOOLEAN_VALIDATOR$1,{validationMessage:"phetioState must be a boolean"})),assert&&validate(r.phetioReadOnly,merge({},BOOLEAN_VALIDATOR$1,{validationMessage:"phetioReadOnly must be a boolean"})),assert&&validate(r.phetioEventType,PHET_IO_EVENT_TYPE_VALIDATOR),assert&&validate(r.phetioDocumentation,PHET_IO_DOCUMENTATION_VALIDATOR),assert&&validate(r.phetioHighFrequency,merge({},BOOLEAN_VALIDATOR$1,{validationMessage:"phetioHighFrequency must be a boolean"})),assert&&validate(r.phetioPlayback,merge({},BOOLEAN_VALIDATOR$1,{validationMessage:"phetioPlayback must be a boolean"})),assert&&validate(r.phetioFeatured,merge({},BOOLEAN_VALIDATOR$1,{validationMessage:"phetioFeatured must be a boolean"})),assert&&validate(r.phetioEventMetadata,merge({},OBJECT_VALIDATOR,{validationMessage:"object literal expected"})),assert&&validate(r.phetioDynamicElement,merge({},BOOLEAN_VALIDATOR$1,{validationMessage:"phetioDynamicElement must be a boolean"})),assert&&validate(r.phetioDesigned,merge({},BOOLEAN_VALIDATOR$1,{validationMessage:"phetioDesigned must be a boolean"})),assert&&assert(this.linkedElements!==null,"this means addLinkedElement was called before instrumentation of this PhetioObject"),this.phetioIsArchetype=!1,this.phetioBaselineMetadata=phetioAPIValidation.enabled||phet.preloads.phetio.queryParameters.phetioEmitAPIBaseline?this.getMetadata(merge({phetioIsArchetype:this.phetioIsArchetype,phetioArchetypePhetioID:this.phetioArchetypePhetioID},r)):null;const s=r.tandem.getArchetypalPhetioID();if(window.phet.preloads.phetio.phetioElementsOverrides){const a=window.phet.preloads.phetio.phetioElementsOverrides[s];a&&(r=optionize()(r,a))}if(this.tandem=r.tandem,this.phetioID=this.tandem.phetioID,this._phetioType=r.phetioType,this._phetioState=r.phetioState,this._phetioReadOnly=r.phetioReadOnly,this._phetioDocumentation=r.phetioDocumentation,this._phetioEventType=r.phetioEventType,this._phetioHighFrequency=r.phetioHighFrequency,this._phetioPlayback=r.phetioPlayback,this._phetioDynamicElement=r.phetioDynamicElement,this._phetioFeatured=r.phetioFeatured,this._phetioEventMetadata=r.phetioEventMetadata,this._phetioDesigned=r.phetioDesigned,this.phetioArchetypePhetioID=null,this.linkedElements=[],this.phetioNotifiedObjectCreated=!1,this.phetioMessageStack=[],this._phetioPlayback&&(this._phetioEventMetadata=this._phetioEventMetadata||{},assert&&assert(!this._phetioEventMetadata.hasOwnProperty("playback"),"phetioEventMetadata.playback should not already exist"),this._phetioEventMetadata.playback=!0),this.tandem.addPhetioObject(this),this.phetioObjectInitialized=!0,assert&&Tandem.VALIDATION&&this.isPhetioInstrumented()&&r.tandemNameSuffix){const a=Array.isArray(r.tandemNameSuffix)?r.tandemNameSuffix:[r.tandemNameSuffix],l=a.filter(d=>this.tandem.name.endsWith(d)||this.tandem.name.endsWith(Qa.swapCaseOfFirstCharacter(d)));assert&&assert(l.length>0,"Incorrect Tandem suffix, expected = "+a.join(", ")+". actual = "+this.tandem.phetioID)}}static swapCaseOfFirstCharacter(e){const t=e[0];return(t===t.toLowerCase()?t.toUpperCase():t.toLowerCase())+e.substring(1)}get phetioType(){return assert&&assert(PHET_IO_ENABLED&&this.isPhetioInstrumented(),"phetioType only accessible for instrumented objects in PhET-iO brand."),this._phetioType}get phetioState(){return assert&&assert(PHET_IO_ENABLED&&this.isPhetioInstrumented(),"phetioState only accessible for instrumented objects in PhET-iO brand."),this._phetioState}get phetioReadOnly(){return assert&&assert(PHET_IO_ENABLED&&this.isPhetioInstrumented(),"phetioReadOnly only accessible for instrumented objects in PhET-iO brand."),this._phetioReadOnly}get phetioDocumentation(){return assert&&assert(PHET_IO_ENABLED&&this.isPhetioInstrumented(),"phetioDocumentation only accessible for instrumented objects in PhET-iO brand."),this._phetioDocumentation}get phetioEventType(){return assert&&assert(PHET_IO_ENABLED&&this.isPhetioInstrumented(),"phetioEventType only accessible for instrumented objects in PhET-iO brand."),this._phetioEventType}get phetioHighFrequency(){return assert&&assert(PHET_IO_ENABLED&&this.isPhetioInstrumented(),"phetioHighFrequency only accessible for instrumented objects in PhET-iO brand."),this._phetioHighFrequency}get phetioPlayback(){return assert&&assert(PHET_IO_ENABLED&&this.isPhetioInstrumented(),"phetioPlayback only accessible for instrumented objects in PhET-iO brand."),this._phetioPlayback}get phetioDynamicElement(){return assert&&assert(PHET_IO_ENABLED&&this.isPhetioInstrumented(),"phetioDynamicElement only accessible for instrumented objects in PhET-iO brand."),this._phetioDynamicElement}get phetioFeatured(){return assert&&assert(PHET_IO_ENABLED&&this.isPhetioInstrumented(),"phetioFeatured only accessible for instrumented objects in PhET-iO brand."),this._phetioFeatured}get phetioEventMetadata(){return assert&&assert(PHET_IO_ENABLED&&this.isPhetioInstrumented(),"phetioEventMetadata only accessible for instrumented objects in PhET-iO brand."),this._phetioEventMetadata}get phetioDesigned(){return assert&&assert(PHET_IO_ENABLED&&this.isPhetioInstrumented(),"phetioDesigned only accessible for instrumented objects in PhET-iO brand."),this._phetioDesigned}phetioStartEvent(e,t){if(PHET_IO_ENABLED&&this.isPhetioInstrumented()){assert&&assertMutuallyExclusiveOptions(t,["data"],["getData"]);const n=optionize()({data:null,getData:null},t);if(assert&&assert(this.phetioObjectInitialized,"phetioObject should be initialized"),assert&&n.data&&assert(typeof n.data=="object"),assert&&n.getData&&assert(typeof n.getData=="function"),assert&&assert(arguments.length===1||arguments.length===2,"Prevent usage of incorrect signature"),!_.hasIn(window,"phet.phetio.dataStream")){this.phetioMessageStack.push(SKIPPING_MESSAGE);return}const r=this.phetioHighFrequency&&_.hasIn(window,"phet.preloads.phetio.queryParameters")&&!window.phet.preloads.phetio.queryParameters.phetioEmitHighFrequencyEvents&&!phet.phetio.dataStream.isEmittingLowFrequencyEvent(),s=!assert&&!_.hasIn(window,"phet.phetio.dataStream");if(r||this.phetioEventType===EventType.OPT_OUT||s){this.phetioMessageStack.push(SKIPPING_MESSAGE);return}const a=n.getData?n.getData():n.data;this.phetioMessageStack.push(phet.phetio.dataStream.start(this.phetioEventType,this.tandem.phetioID,this.phetioType,e,a,this.phetioEventMetadata,this.phetioHighFrequency)),this.phetioPlayback&&phet.phetio.dataStream.pushNonPlaybackable()}}phetioEndEvent(){if(PHET_IO_ENABLED&&this.isPhetioInstrumented()){assert&&assert(this.phetioMessageStack.length>0,"Must have messages to pop");const e=this.phetioMessageStack.pop();if(e===SKIPPING_MESSAGE)return;this.phetioPlayback&&phet.phetio.dataStream.popNonPlaybackable(),phet.phetio.dataStream.end(e)}}propagateDynamicFlagsToDescendants(){assert&&assert(Tandem.PHET_IO_ENABLED,"phet-io should be enabled"),assert&&assert(phet.phetio&&phet.phetio.phetioEngine,"Dynamic elements cannot be created statically before phetioEngine exists.");const e=phet.phetio.phetioEngine,t=Tandem.launched?[]:Tandem.bufferedPhetioObjects.map(objectToPhetioID);this.tandem.iterateDescendants(n=>{const r=n.phetioID;if(e.hasPhetioObject(r)||!Tandem.launched&&t.includes(r)){assert&&assert(this.isPhetioInstrumented());const s=e.hasPhetioObject(r)?e.getPhetioElement(r):Tandem.bufferedPhetioObjects[t.indexOf(r)];assert&&assert(s,"should have a phetioObject here"),s.phetioIsArchetype=this.phetioIsArchetype,s.setPhetioDynamicElement(this.phetioDynamicElement),s.phetioBaselineMetadata&&(s.phetioBaselineMetadata.phetioIsArchetype=this.phetioIsArchetype)}})}setPhetioDynamicElement(e){assert&&assert(!this.phetioNotifiedObjectCreated,"should not change dynamic element flags after notifying this PhetioObject's creation."),assert&&assert(this.isPhetioInstrumented()),this._phetioDynamicElement=this.phetioIsArchetype?!1:e,this.phetioArchetypePhetioID=e?this.tandem.getArchetypalPhetioID():null,this.phetioBaselineMetadata&&(this.phetioBaselineMetadata.phetioDynamicElement=this.phetioDynamicElement)}markDynamicElementArchetype(){assert&&assert(!this.phetioNotifiedObjectCreated,"should not change dynamic element flags after notifying this PhetioObject's creation."),this.phetioIsArchetype=!0,this.setPhetioDynamicElement(!1),this.phetioBaselineMetadata&&(this.phetioBaselineMetadata.phetioIsArchetype=this.phetioIsArchetype),Tandem.PHET_IO_ENABLED&&this.propagateDynamicFlagsToDescendants()}isPhetioInstrumented(){return this.tandem&&this.tandem.supplied}addLinkedElement(e,t){if(!this.isPhetioInstrumented()){this.linkedElements=null;return}if(PHET_IO_ENABLED&&e.isPhetioInstrumented()){const n=optionize()({phetioFeatured:this.phetioFeatured&&e.phetioFeatured},t);assert&&assert(Array.isArray(this.linkedElements),"linkedElements should be an array");let r=null;t&&t.tandem?r=t.tandem:t&&t.tandemName?r=this.tandem.createTandem(t.tandemName):!t&&e.tandem&&(r=this.tandem.createTandem(e.tandem.name)),r&&(n.tandem=r),this.linkedElements.push(new LinkedElement(e,n))}}removeLinkedElements(e){this.isPhetioInstrumented()&&this.linkedElements&&(assert&&assert(e.isPhetioInstrumented()),this.linkedElements.filter(n=>n.element===e).forEach(n=>{n.dispose(),arrayRemove(this.linkedElements,n)}))}onSimulationConstructionCompleted(){this.phetioBaselineMetadata=null}getPhetioMouseHitTarget(e=!1){if(assert&&assert(phet.tandem.phetioElementSelectionProperty.value!=="none","getPhetioMouseHitTarget should not be called when phetioElementSelectionProperty is none"),!e&&phet.tandem.phetioElementSelectionProperty.value==="linked"){const t=this.getCorrespondingLinkedElement();if(t!=="noCorrespondingLinkedElement")return t.getPhetioMouseHitTarget(!0);if(this.tandem.parentTandem){const n=phet.phetio.phetioEngine.phetioElementMap[this.tandem.parentTandem.phetioID];if(n){const r=n.getCorrespondingLinkedElement();if(r!=="noCorrespondingLinkedElement")return r.getPhetioMouseHitTarget(!0)}}}return phet.tandem.phetioElementSelectionProperty.value==="string"?"phetioNotSelectable":this.getPhetioMouseHitTargetSelf()}getPhetioMouseHitTargetSelf(){return this.isPhetioMouseHitSelectable()?this:"phetioNotSelectable"}isPhetioMouseHitSelectable(){const e=phet.tandem.phetioElementsDisplayProperty.value!=="featured"||this.isDisplayedInFeaturedTree();return this.isPhetioInstrumented()&&e}isDisplayedInFeaturedTree(){if(this.isPhetioInstrumented()&&this.phetioFeatured)return!0;let e=!1;return this.tandem.iterateDescendants(t=>{const n=phet.phetio.phetioEngine.phetioElementMap[t.phetioID];n&&n.isPhetioInstrumented()&&n.phetioFeatured&&(e=!0)}),e}getCorrespondingLinkedElement(){const e=Object.keys(this.tandem.children),t=[];e.forEach(s=>{const a=phetio.PhetioIDUtils.append(this.tandem.phetioID,s),l=phet.phetio.phetioEngine.phetioElementMap[a];l instanceof LinkedElement&&t.push(l)});const n=t.map(s=>phetio.PhetioIDUtils.getComponentName(s.phetioID));let r=null;if(t.length===1)r=t[0];else if(n.includes("property"))r=t[n.indexOf("property")];else if(n.includes("valueProperty"))r=t[n.indexOf("valueProperty")];else return"noCorrespondingLinkedElement";return assert&&assert(r,"phetioElement is needed"),r.element}dispose(){if(assert&&Tandem.PHET_IO_ENABLED&&this.tandem.supplied){const e=[];this.tandem.iterateDescendants(t=>{phet.phetio.phetioEngine.hasPhetioObject(t.phetioID)&&e.push(phet.phetio.phetioEngine.getPhetioElement(t.phetioID))}),animationFrameTimer.runOnNextTick(()=>{assert&&assert(!this.hasOwnProperty("phetioMessageStack")||this.phetioMessageStack.length===0,"phetioMessageStack should be clear"),e.forEach(t=>{assert&&assert(t.isDisposed,`All descendants must be disposed by the next frame: ${t.tandem.phetioID}`)})})}ENABLE_DESCRIPTION_REGISTRY&&this.tandem&&this.tandem.supplied&&DescriptionRegistry.remove(this),this.tandem.removePhetioObject(this),this.linkedElements&&(this.linkedElements.forEach(e=>e.dispose()),this.linkedElements.length=0),super.dispose()}getMetadata(e){e=e||this;const t={phetioTypeName:e.phetioType.typeName,phetioDocumentation:e.phetioDocumentation,phetioState:e.phetioState,phetioReadOnly:e.phetioReadOnly,phetioEventType:EventType.phetioType.toStateObject(e.phetioEventType),phetioHighFrequency:e.phetioHighFrequency,phetioPlayback:e.phetioPlayback,phetioDynamicElement:e.phetioDynamicElement,phetioIsArchetype:e.phetioIsArchetype,phetioFeatured:e.phetioFeatured,phetioDesigned:e.phetioDesigned};return e.phetioArchetypePhetioID&&(t.phetioArchetypePhetioID=e.phetioArchetypePhetioID),t}static create(e){return new Qa(e)}};Qa.DEFAULT_OPTIONS=DEFAULTS,Qa.METADATA_DOCUMENTATION=`Get metadata about the PhET-iO Element. This includes the following keys:<ul><li><strong>phetioTypeName:</strong> The name of the PhET-iO Type
</li><li><strong>phetioDocumentation:</strong> default - null. Useful notes about a PhET-iO Element, shown in the PhET-iO Studio Wrapper</li><li><strong>phetioState:</strong> default - true. When true, includes the PhET-iO Element in the PhET-iO state
</li><li><strong>phetioReadOnly:</strong> default - false. When true, you can only get values from the PhET-iO Element; no setting allowed.
</li><li><strong>phetioEventType:</strong> default - MODEL. The category of event that this element emits to the PhET-iO Data Stream.
</li><li><strong>phetioDynamicElement:</strong> default - false. If this element is a "dynamic element" that can be created and destroyed throughout the lifetime of the sim (as opposed to existing forever).
</li><li><strong>phetioIsArchetype:</strong> default - false. If this element is an archetype for a dynamic element.
</li><li><strong>phetioFeatured:</strong> default - false. If this is a featured PhET-iO Element.
</li><li><strong>phetioArchetypePhetioID:</strong> default - ''. If an applicable dynamic element, this is the phetioID of its archetype.
</li></ul>`;let PhetioObject=Qa;class LinkedElement extends PhetioObject{constructor(e,t){assert&&assert(!!e,"coreElement should be defined");const n=optionize()({phetioType:LinkedElementIO,phetioState:!0,phetioFeatured:e.phetioFeatured},t);assert&&assert(!n.hasOwnProperty("phetioReadOnly"),"phetioReadOnly set by LinkedElement"),n.phetioReadOnly=!0,super(n),this.element=e}}tandemNamespace.register("PhetioObject",PhetioObject);const cache$9=new IOTypeCache,FunctionIO=(o,e)=>{for(let n=0;n<e.length;n++)assert&&assert(e[n],"parameter type was not truthy");assert&&assert(o,"return type was not truthy");const t=`${o.typeName}.${e.map(n=>n.typeName).join(",")}`;if(!cache$9.has(t)){let n=e.map(s=>s.typeName).join(", ");n===""&&(n="none");const r=e.map(s=>s.typeName).join(",");cache$9.set(t,new IOType(`FunctionIO(${r})=>${o.typeName}`,{valueType:"function",isFunctionType:!0,parameterTypes:e.concat([o]),documentation:`Wrapper for the built-in JS function type.<br><strong>Arguments:</strong> ${n}<br><strong>Return Type:</strong> ${o.typeName}`}))}return cache$9.get(t)};tandemNamespace.register("FunctionIO",FunctionIO);const cache$8=new IOTypeCache,NullableIO=o=>(assert&&assert(o,"NullableIO needs parameterType"),cache$8.has(o)||cache$8.set(o,new IOType(`NullableIO<${o.typeName}>`,{documentation:"A PhET-iO Type adding support for null in addition to the behavior of its parameter.",isValidValue:e=>e===null||Validation.isValueValid(e,o.validator),parameterTypes:[o],toStateObject:e=>e===null?null:o.toStateObject(e),fromStateObject:e=>e===null?null:o.fromStateObject(e),stateSchema:StateSchema.asValue(`null|<${o.typeName}>`,{isValidValue:e=>e===null||o.isStateObjectValid(e)})})),cache$8.get(o));tandemNamespace.register("NullableIO",NullableIO);const VoidIO=new IOType("VoidIO",{isValidValue:()=>!0,documentation:"Type for which there is no instance, usually to mark functions without a return value",toStateObject:()=>{}});tandemNamespace.register("VoidIO",VoidIO);const qo=class qo extends EnumerationValue{};qo.UNDEFER=new qo,qo.NOTIFY=new qo,qo.enumeration=new Enumeration(qo);let PropertyStatePhase=qo;axon.register("PropertyStatePhase",PropertyStatePhase);class PropertyStateHandler{constructor(){this.initialized=!1,this.phaseCallbackSets=new PhaseCallbackSets,this.undeferBeforeUndeferMapPair=new OrderDependencyMapPair(PropertyStatePhase.UNDEFER,PropertyStatePhase.UNDEFER),this.undeferBeforeNotifyMapPair=new OrderDependencyMapPair(PropertyStatePhase.UNDEFER,PropertyStatePhase.NOTIFY),this.notifyBeforeUndeferMapPair=new OrderDependencyMapPair(PropertyStatePhase.NOTIFY,PropertyStatePhase.UNDEFER),this.notifyBeforeNotifyMapPair=new OrderDependencyMapPair(PropertyStatePhase.NOTIFY,PropertyStatePhase.NOTIFY),this.mapPairs=[this.undeferBeforeUndeferMapPair,this.undeferBeforeNotifyMapPair,this.notifyBeforeUndeferMapPair,this.notifyBeforeNotifyMapPair]}initialize(e){assert&&assert(!this.initialized,"cannot initialize twice"),e.onBeforeApplyStateEmitter.addListener(t=>{if(t instanceof ReadOnlyProperty&&!t.isDeferred){t.setDeferred(!0);const n=t.tandem.phetioID,r=()=>{const s=t.setDeferred(!1);this.phaseCallbackSets.addNotifyPhaseCallback(new PhaseCallback(n,PropertyStatePhase.NOTIFY,s||_.noop))};this.phaseCallbackSets.addUndeferPhaseCallback(new PhaseCallback(n,PropertyStatePhase.UNDEFER,r))}}),e.undeferEmitter.addListener(t=>{this.undeferAndNotifyProperties(new Set(Object.keys(t)))}),e.isSettingStateProperty.lazyLink(t=>{assert&&!t&&assert(this.phaseCallbackSets.size===0,"PhaseCallbacks should have all been applied")}),this.initialized=!0}static validateInstrumentedProperty(e){assert&&Tandem.VALIDATION&&assert(e instanceof ReadOnlyProperty&&e.isPhetioInstrumented(),`must be an instrumented Property: ${e}`)}validatePropertyPhasePair(e,t){PropertyStateHandler.validateInstrumentedProperty(e)}getMapPairFromPhases(e,t){const n=this.mapPairs.filter(r=>e===r.beforePhase&&t===r.afterPhase);return assert&&assert(n.length===1,"one and only one map should match the provided phases"),n[0]}registerPhetioOrderDependency(e,t,n,r){Tandem.PHET_IO_ENABLED&&(this.validatePropertyPhasePair(e,t),this.validatePropertyPhasePair(n,r),assert&&e===n&&assert(t!==r,"cannot set same Property to same phase"),this.getMapPairFromPhases(t,r).addOrderDependency(e.tandem.phetioID,n.tandem.phetioID))}propertyInAnOrderDependency(e){return PropertyStateHandler.validateInstrumentedProperty(e),_.some(this.mapPairs,t=>t.usesPhetioID(e.tandem.phetioID))}unregisterOrderDependenciesForProperty(e){Tandem.PHET_IO_ENABLED&&(PropertyStateHandler.validateInstrumentedProperty(e),this.propertyInAnOrderDependency(e)&&(assert&&assert(this.propertyInAnOrderDependency(e),"Property must be registered in an order dependency to be unregistered"),this.mapPairs.forEach(t=>t.unregisterOrderDependenciesForProperty(e))))}undeferAndNotifyProperties(e){assert&&assert(this.initialized,"must be initialized before getting called");const t={};let n=0;for(;this.phaseCallbackSets.size>0;)n++,n>5e3&&this.errorInUndeferAndNotifyStep(t),this.attemptToApplyPhases(PropertyStatePhase.UNDEFER,t,e),this.attemptToApplyPhases(PropertyStatePhase.NOTIFY,t,e)}errorInUndeferAndNotifyStep(e){const t=[];this.phaseCallbackSets.forEach(a=>t.push(a.getTerm()));const n=[];this.mapPairs.forEach(a=>{const l=a.beforeMap;for(const[d,c]of l)c.forEach(y=>{const m=d+l.beforePhase,O=y+l.afterPhase;(t.includes(m)||t.includes(O))&&n.push({beforeTerm:m,afterTerm:O})})});let r="";console.log("still to be undeferred",this.phaseCallbackSets.undeferSet),console.log("still to be notified",this.phaseCallbackSets.notifySet),console.log("order dependencies that apply to the still todos",n),n.forEach(a=>{r+=`${a.beforeTerm}	${a.afterTerm}
`}),console.log(`

in graphable form:

`,r);const s="Impossible set state: from undeferAndNotifyProperties; ordering constraints cannot be satisfied";if(assert&&assert(!1,s),!assert)throw new Error(s)}getNumberOfOrderDependencies(){let e=0;return this.mapPairs.forEach(t=>{t.afterMap.forEach(n=>{e+=n.size})}),e}attemptToApplyPhases(e,t,n){const r=this.phaseCallbackSets.getSetFromPhase(e);for(const s of r)assert&&assert(s.phase===e,"phaseCallbackSet should only include callbacks for provided phase"),this.phetioIDCanApplyPhase(s.phetioID,e,t,n)&&(s.listener(),r.delete(s),t[s.getTerm()]=!0)}phetioIDCanApplyPhase(e,t,n,r){if(t===PropertyStatePhase.NOTIFY&&!n[e+PropertyStatePhase.UNDEFER])return!1;const s=[];this.mapPairs.forEach(a=>{a.afterPhase===t&&s.push(a.afterMap)});for(let a=0;a<s.length;a++){const l=s[a];if(!l.has(e))return!0;const d=l.get(e);assert&&assert(d,"must have this set");for(const c of d)if(!n[c+l.beforePhase]&&r.has(c)&&r.has(e))return!1}return!0}}class PhaseCallback{constructor(e,t,n=_.noop){this.phetioID=e,this.phase=t,this.listener=n}getTerm(){return this.phetioID+this.phase}}class OrderDependencyMapPair{constructor(e,t){this.beforeMap=new Map,this.beforeMap.beforePhase=e,this.beforeMap.afterPhase=t,this.afterMap=new Map,this.afterMap.beforePhase=e,this.afterMap.afterPhase=t,this.beforeMap.otherMap=this.afterMap,this.afterMap.otherMap=this.beforeMap,this.beforePhase=e,this.afterPhase=t}addOrderDependency(e,t){this.beforeMap.has(e)||this.beforeMap.set(e,new Set),this.beforeMap.get(e).add(t),this.afterMap.has(t)||this.afterMap.set(t,new Set),this.afterMap.get(t).add(e)}unregisterOrderDependenciesForProperty(e){const t=e.tandem.phetioID;[this.beforeMap,this.afterMap].forEach(n=>{n.has(t)&&n.get(t).forEach(r=>{const s=n.otherMap.get(r);s&&s.delete(t),s.size===0&&n.otherMap.delete(r)}),n.delete(t)}),assertSlow&&[this.beforeMap,this.afterMap].forEach(n=>{n.forEach((r,s)=>{assertSlow&&assertSlow(s!==t,"should not be a key"),assertSlow&&assertSlow(!r.has(t),"should not be in a value list")})})}usesPhetioID(e){return this.beforeMap.has(e)||this.afterMap.has(e)}}class PhaseCallbackSets{constructor(){this.undeferSet=new Set,this.notifySet=new Set}get size(){return this.undeferSet.size+this.notifySet.size}forEach(e){this.undeferSet.forEach(e),this.notifySet.forEach(e)}addUndeferPhaseCallback(e){this.undeferSet.add(e)}addNotifyPhaseCallback(e){this.notifySet.add(e)}getSetFromPhase(e){return e===PropertyStatePhase.NOTIFY?this.notifySet:this.undeferSet}}axon.register("PropertyStateHandler",PropertyStateHandler);const propertyStateHandlerSingleton=new PropertyStateHandler;axon.register("propertyStateHandlerSingleton",propertyStateHandlerSingleton);class TinyProperty extends TinyEmitter{constructor(e,t,n){super(t,n),this._value=e}get(){return this._value}get value(){return this.get()}set value(e){this.set(e)}set(e){if(!this.equalsValue(e)){const t=this._value;this.setPropertyValue(e),this.notifyListeners(t)}}setPropertyValue(e){this._value=e}equalsValue(e){return this.areValuesEqual(e,this._value)}areValuesEqual(e,t){if(this.useDeepEquality){const n=e,r=t;if(n&&r&&n.constructor===r.constructor)return assert&&assert(!!n.equals,"no equals function for 1st arg"),assert&&assert(!!r.equals,"no equals function for 2nd arg"),assert&&assert(n.equals(r)===r.equals(n),"incompatible equality checks"),n.equals(r)}return e===t}notifyListeners(e){this.emit(this._value,e,this)}link(e){this.addListener(e),e(this._value,null,this)}lazyLink(e){this.addListener(e)}unlink(e){this.removeListener(e)}unlinkAll(){this.removeAllListeners()}linkAttribute(e,t){const n=r=>{e[t]=r};return this.link(n),n}isSettable(){return!0}dispose(){this.unlinkAll(),super.dispose()}}axon.register("TinyProperty",TinyProperty);const units={values:["1/(cm*M)","%","A","AMU","atm","AU","AU^2","cm","cm^2","C","°","°C","F","°F","g","G","Hz","J","K","kg","kg/m^3","kg·m/s","km/s","kPa","L","L/s","m","m^3","m/s","m/s/s","m/s^2","mA","mm","mol","mol/L","mol/s","M","N","N/m","nm","nm/ps","N·s/m","Ω","Ω·cm","Pa·s","particles/ps","pm","pm/ps","pm/s","pm/s^2","pm^3","ps","radians","radians/s","radians/s^2","rpm","s","V","view-coordinates/s","W","Wb","years"],isValidUnits:function(o){return _.includes(units.values,o)}};axon.register("units",units);const isClearingPhetioDynamicElementsProperty=new TinyProperty(!1);tandemNamespace.register("isClearingPhetioDynamicElementsProperty",isClearingPhetioDynamicElementsProperty);const isPhetioStateEngineManagingPropertyValuesProperty=new TinyProperty(!1);tandemNamespace.register("isPhetioStateEngineManagingPropertyValuesProperty",isPhetioStateEngineManagingPropertyValuesProperty);const VALIDATE_OPTIONS_FALSE$2={validateValidator:!1};let globalId$9=0;const cache$7=new IOTypeCache,strictAxonDependencies=_.hasIn(window,"phet.chipper.queryParameters")&&phet.chipper.queryParameters.strictAxonDependencies&&phet.chipper.queryParameters.listenerOrder==="default",derivationStack=[],pr=class pr extends PhetioObject{constructor(e,t){const n=optionize()({units:null,reentrant:!1,hasListenerOrderDependencies:!1,tandemNameSuffix:["Property",DYNAMIC_ARCHETYPE_NAME],phetioOuterType:pr.PropertyIO,phetioValueType:IOType.ObjectIO},t);assert&&n.units&&assert(units.isValidUnits(n.units),`invalid units: ${n.units}`),n.units&&(n.phetioEventMetadata=n.phetioEventMetadata||{},assert&&assert(!n.phetioEventMetadata.hasOwnProperty("units"),"units should be supplied by Property, not elsewhere"),n.phetioEventMetadata.units=n.units),assert&&t&&assert&&assert(!t.phetioType,"Set phetioType via phetioValueType"),n.phetioOuterType&&n.phetioValueType&&(n.phetioType=n.phetioOuterType(n.phetioValueType)),Validation.containsValidatorKey(n)||(n.isValidValue=()=>!0),super(n),this.id=globalId$9++,this.units=n.units,this.isPhetioInstrumented()&&(assert&&Tandem.VALIDATION&&assert(this.phetioType,`phetioType passed to Property must be specified. Tandem.phetioID: ${this.tandem.phetioID}`),assert&&Tandem.VALIDATION&&assert(n.phetioType.parameterTypes[0],`phetioType parameter type must be specified (only one). Tandem.phetioID: ${this.tandem.phetioID}`),assert&&assert(n.phetioValueType!==IOType.ObjectIO,"PhET-iO Properties must specify a phetioValueType: "+this.phetioID)),this.validValues=n.validValues,this.tinyProperty=new TinyProperty(e,null,n.hasListenerOrderDependencies),this.tinyProperty.useDeepEquality=n.valueComparisonStrategy&&n.valueComparisonStrategy==="equalsFunction",this.notifying=!1,this.reentrant=n.reentrant,this.isDeferred=!1,this.deferredValue=null,this.hasDeferredValue=!1,this.valueValidator=_.pick(n,Validation.VALIDATOR_KEYS),this.valueValidator.validationMessage=this.valueValidator.validationMessage||"Property value not valid",this.valueValidator.phetioType&&(assert&&assert(!!this.valueValidator.phetioType.parameterTypes[0],"unexpected number of parameters for Property"),this.valueValidator.phetioType=this.valueValidator.phetioType.parameterTypes[0]),assert&&(Validation.validateValidator(this.valueValidator),validate(e,this.valueValidator,VALIDATE_OPTIONS_FALSE$2))}isSettable(){return!1}get(){return assert&&strictAxonDependencies&&derivationStack.length>0&&(derivationStack[derivationStack.length-1].includes(this)||assert&&assert(!1,"accessed value outside of dependency tracking")),this.tinyProperty.get()}set(e){isPhetioStateEngineManagingPropertyValuesProperty.value&&!isClearingPhetioDynamicElementsProperty.value&&this.isPhetioInstrumented()&&this.phetioState&&this.isSettable()||this.unguardedSet(e)}unguardedSet(e){if(!this.isDisposed){if(this.isDeferred)this.deferredValue=e,this.hasDeferredValue=!0;else if(!this.equalsValue(e)){const t=this.get();this.setPropertyValue(e),this._notifyListeners(t)}}}setPropertyValue(e){this.tinyProperty.setPropertyValue(e)}equalsValue(e){return this.areValuesEqual(e,this.get())}areValuesEqual(e,t){return this.tinyProperty.areValuesEqual(e,t)}_notifyListeners(e){const t=this.get();assert&&validate(t,this.valueValidator,VALIDATE_OPTIONS_FALSE$2),Tandem.PHET_IO_ENABLED&&this.isPhetioInstrumented()&&this.phetioStartEvent(pr.CHANGED_EVENT_NAME,{getData:()=>{const n=this.phetioType.parameterTypes[0];return{oldValue:NullableIO(n).toStateObject(e),newValue:n.toStateObject(t)}}}),assert&&assert(!this.notifying||this.reentrant,`reentry detected, value=${t}, oldValue=${e}`),this.notifying=!0,this.tinyProperty.emit(t,e,this),this.notifying=!1,Tandem.PHET_IO_ENABLED&&this.isPhetioInstrumented()&&this.phetioEndEvent()}notifyListenersStatic(){this._notifyListeners(null)}setDeferred(e){if(assert&&assert(!this.isDisposed,"cannot defer Property if already disposed."),e)assert&&assert(!this.isDeferred,"Property already deferred"),this.isDeferred=!0;else{assert&&assert(this.isDeferred,"Property wasn't deferred"),this.isDeferred=!1;const t=this.get();if(this.hasDeferredValue&&(this.setPropertyValue(this.deferredValue),this.hasDeferredValue=!1,this.deferredValue=null),!this.equalsValue(t))return()=>!this.isDisposed&&this._notifyListeners(t)}return null}get value(){return this.get()}set value(e){this.set(e)}addPhetioStateDependencies(e){assert&&assert(Array.isArray(e),"Array expected");for(let t=0;t<e.length;t++){const n=e[t];n instanceof pr&&n.isPhetioInstrumented()&&this.isPhetioInstrumented()&&propertyStateHandlerSingleton.registerPhetioOrderDependency(n,PropertyStatePhase.UNDEFER,this,PropertyStatePhase.NOTIFY)}}link(e,t){t&&t.phetioDependencies&&this.addPhetioStateDependencies(t.phetioDependencies),this.tinyProperty.addListener(e),e(this.get(),null,this)}lazyLink(e,t){t&&t.phetioDependencies&&this.addPhetioStateDependencies(t.phetioDependencies),this.tinyProperty.lazyLink(e)}unlink(e){this.tinyProperty.unlink(e)}unlinkAll(){this.tinyProperty.unlinkAll()}linkAttribute(e,t){const n=r=>{e[t]=r};return this.link(n),n}toString(){return`Property#${this.id}{${this.get()}}`}debug(e){const t=n=>console.log(e,n);return this.link(t),t}isValueValid(e){return this.getValidationError(e)===null}getValidationError(e){return Validation.getValidationError(e,this.valueValidator,VALIDATE_OPTIONS_FALSE$2)}dispose(){this.isPhetioInstrumented()&&propertyStateHandlerSingleton.unregisterOrderDependenciesForProperty(this),super.dispose(),this.tinyProperty.dispose()}hasListener(e){return this.tinyProperty.hasListener(e)}getListenerCount(){return this.tinyProperty.getListenerCount()}forEachListener(e){this.tinyProperty.forEachListener(e)}hasListeners(){return assert&&assert(arguments.length===0,"Property.hasListeners should be called without arguments"),this.tinyProperty.hasListeners()}static PropertyIO(e){return assert&&assert(e,"PropertyIO needs parameterType"),cache$7.has(e)||cache$7.set(e,new IOType(`PropertyIO<${e.typeName}>`,{valueType:pr,documentation:"Observable values that send out notifications when the value changes. This differs from the traditional listener pattern in that added listeners also receive a callback with the current value when the listeners are registered. This is a widely-used pattern in PhET-iO simulations.",methodOrder:["link","lazyLink"],events:[pr.CHANGED_EVENT_NAME],parameterTypes:[e],toStateObject:t=>(assert&&assert(e.toStateObject,`toStateObject doesn't exist for ${e.typeName}`),{value:e.toStateObject(t.value),validValues:NullableIO(ArrayIO(e)).toStateObject(t.validValues===void 0?null:t.validValues),units:NullableIO(StringIO).toStateObject(t.units)}),applyState:(t,n)=>{const r=NullableIO(StringIO).fromStateObject(n.units);assert&&assert(t.units===r,"Property units do not match"),assert&&assert(t.isSettable(),"Property should be settable"),t.unguardedSet(e.fromStateObject(n.value)),n.validValues&&(t.validValues=n.validValues.map(s=>e.fromStateObject(s)))},stateSchema:{value:e,validValues:NullableIO(ArrayIO(e)),units:NullableIO(StringIO)},methods:{getValue:{returnType:e,parameterTypes:[],implementation:pr.prototype.get,documentation:"Gets the current value."},getValidationError:{returnType:NullableIO(StringIO),parameterTypes:[e],implementation:pr.prototype.getValidationError,documentation:"Checks to see if a proposed value is valid. Returns the first validation error, or null if the value is valid."},setValue:{returnType:VoidIO,parameterTypes:[e],implementation:function(t){this.set(t)},documentation:"Sets the value of the Property. If the value differs from the previous value, listeners are notified with the new value.",invocableForReadOnlyElements:!1},link:{returnType:VoidIO,parameterTypes:[FunctionIO(VoidIO,[e,NullableIO(e)])],implementation:pr.prototype.link,documentation:"Adds a listener which will be called when the value changes. On registration, the listener is also called with the current value. The listener takes two arguments, the new value and the previous value."},lazyLink:{returnType:VoidIO,parameterTypes:[FunctionIO(VoidIO,[e,NullableIO(e)])],implementation:pr.prototype.lazyLink,documentation:'Adds a listener which will be called when the value changes. This method is like "link", but without the current-value callback on registration. The listener takes two arguments, the new value and the previous value.'},unlink:{returnType:VoidIO,parameterTypes:[FunctionIO(VoidIO,[e])],implementation:pr.prototype.unlink,documentation:"Removes a listener."}}})),cache$7.get(e)}getPhetioMouseHitTarget(e=!1){return phet.tandem.phetioElementSelectionProperty.value==="string"?this.getPhetioMouseHitTargetSelf():super.getPhetioMouseHitTarget(e)}};pr.CHANGED_EVENT_NAME="changed";let ReadOnlyProperty=pr;axon.register("ReadOnlyProperty",ReadOnlyProperty);class Property extends ReadOnlyProperty{constructor(e,t){super(e,t),this._initialValue=e}getInitialValue(){return this._initialValue}get initialValue(){return this.getInitialValue()}setInitialValue(e){this._initialValue=e}get value(){return super.value}set value(e){super.set(e)}reset(){this.set(this._initialValue)}set(e){super.set(e)}isSettable(){return!0}}axon.register("Property",Property);const VALID_NON_NAN$1={isValidValue:o=>!isNaN(o.x)&&!isNaN(o.y),validationMessage:"Vector2 x/y should not be NaN"};class Vector2Property extends Property{constructor(e,t){const n=optionize()({valueType:Vector2,validBounds:null,validators:[],phetioValueType:Vector2.Vector2IO},t);n.validators.push(VALID_NON_NAN$1),n.validBounds&&n.validators.push({validationMessage:"Vector2 is not within validBounds",isValidValue:r=>n.validBounds.containsPoint(r)}),super(e,n),this.validBounds=n.validBounds}}dot.register("Vector2Property",Vector2Property);const BooleanIO=new IOType("BooleanIO",{supertype:ValueIO,valueType:"boolean",documentation:"PhET-iO Type for Javascript's boolean primitive type",stateSchema:StateSchema.asValue("boolean",{valueType:"boolean"}),toStateObject:_.identity});tandemNamespace.register("BooleanIO",BooleanIO);class BooleanProperty extends Property{constructor(e,t){const n=optionize()({valueType:"boolean",phetioValueType:BooleanIO},t);super(e,n)}toggle(){this.value=!this.value}}axon.register("BooleanProperty",BooleanProperty);const stepTimer=new Timer;axon.register("stepTimer",stepTimer);class CallbackTimer{constructor(e){this.callbacks=[],this._delay=400,this._interval=100,this.delayID=null,this.intervalID=null,this.fired=!1,(e==null?void 0:e.delay)!==void 0&&(this.delay=e.delay),(e==null?void 0:e.interval)!==void 0&&(this.interval=e.interval),e!=null&&e.callback&&this.callbacks.push(e.callback)}isRunning(){return this.delayID!==null||this.intervalID!==null}start(){this.isRunning()||(this.fired=!1,this.delayID=stepTimer.setTimeout(()=>{this.delayID=null,this.intervalID=stepTimer.setInterval(()=>this.fire(),this.interval),this.fire()},this.delay))}stop(e){this.isRunning()&&(this.delayID&&(stepTimer.clearTimeout(this.delayID),this.delayID=null),this.intervalID&&(stepTimer.clearInterval(this.intervalID),this.intervalID=null),e&&!this.fired&&this.fire())}addCallback(e){this.callbacks.includes(e)||this.callbacks.push(e)}removeCallback(e){const t=this.callbacks.indexOf(e);t!==-1&&this.callbacks.splice(t,1)}fire(){const e=this.callbacks.slice(0);for(let t=0;t<e.length;t++)e[t]();this.fired=!0}set delay(e){assert&&assert(e>=0,`bad value for delay: ${e}`),this._delay=e}get delay(){return this._delay}set interval(e){assert&&assert(e>0,`bad value for interval: ${e}`),this._interval=e}get interval(){return this._interval}dispose(){this.stop(!1),this.callbacks.length=0}}axon.register("CallbackTimer",CallbackTimer);const VALIDATE_OPTIONS_FALSE$1={validateValidator:!1},EMPTY_ARRAY$1=[];assert&&Object.freeze(EMPTY_ARRAY$1);const PARAMETER_KEYS=["name","phetioType","phetioDocumentation","phetioPrivate"].concat(Validation.VALIDATOR_KEYS),paramToPhetioType=o=>o.phetioType,paramToName=o=>o.name;class PhetioDataHandler extends PhetioObject{constructor(e){var r;const t=optionize()({parameters:EMPTY_ARRAY$1,hasListenerOrderDependencies:!1,phetioPlayback:PhetioObject.DEFAULT_OPTIONS.phetioPlayback,phetioEventMetadata:PhetioObject.DEFAULT_OPTIONS.phetioEventMetadata,phetioDocumentation:""},e);assert&&PhetioDataHandler.validateParameters(t.parameters,!!((r=t.tandem)!=null&&r.supplied)),assert&&assert(t.phetioType===void 0,"PhetioDataHandler sets its own phetioType. Instead provide parameter phetioTypes through `options.parameters` with a phetioOuterType");const n=t.parameters.filter(paramToPhetioType);t.phetioType=t.phetioOuterType(n.map(paramToPhetioType)),t.phetioPlayback&&(t.phetioEventMetadata=t.phetioEventMetadata||{},assert&&assert(!t.phetioEventMetadata.hasOwnProperty("dataKeys"),"dataKeys should be supplied by PhetioDataHandler, not elsewhere"),t.phetioEventMetadata.dataKeys=t.parameters.map(paramToName)),t.phetioDocumentation=PhetioDataHandler.getPhetioDocumentation(t.phetioDocumentation,n),super(t),this.parameters=t.parameters}static validateParameters(e,t){validate(e,{valueType:Array});let n=!1;for(let r=0;r<e.length;r++){const s=e[r];assert&&assert(Object.getPrototypeOf(s)===Object.prototype,"Extra prototype on parameter object is a code smell"),n=n||s.phetioPrivate,assert&&n&&assert(s.phetioPrivate,"after first phetioPrivate parameter, all subsequent parameters must be phetioPrivate"),assert&&t&&Tandem.VALIDATION&&assert(s.phetioType||s.phetioPrivate,"instrumented Emitters must include phetioType for each parameter or be marked as `phetioPrivate`."),assert&&s.phetioType&&assert(s.name,"`name` is a required parameter for phet-io instrumented parameters."),assert&&assertMutuallyExclusiveOptions(s,["phetioPrivate"],["name","phetioType","phetioDocumentation"]),assert&&assert(_.intersection(Object.keys(s),Validation.VALIDATOR_KEYS).length>0,`validator must be specified for parameter ${r}`);for(const a in s)assert&&assert(PARAMETER_KEYS.includes(a),`unrecognized parameter key: ${a}`);assert&&Object.freeze(e[r]),Validation.validateValidator(s)}assert&&Object.freeze(e)}validateArguments(...e){assert&&assert(e.length===this.parameters.length,`Emitted unexpected number of args. Expected: ${this.parameters.length} and received ${e.length}`);for(let t=0;t<this.parameters.length;t++){const n=this.parameters[t];assert&&validate(e[t],n,VALIDATE_OPTIONS_FALSE$1),n.phetioType&&!n.valueType&&assert&&validate(e[t],n.phetioType.validator,VALIDATE_OPTIONS_FALSE$1)}}getValidationErrors(...e){return assert&&assert(e.length===this.parameters.length,`Emitted unexpected number of args. Expected: ${this.parameters.length} and received ${e.length}`),this.parameters.map((t,n)=>Validation.getValidationError(e[n],t,VALIDATE_OPTIONS_FALSE$1))}getPhetioData(...e){assert&&assert(Tandem.PHET_IO_ENABLED,"should only get phet-io data in phet-io brand");let t=null;if(this.parameters.length>0){t={};for(let n=0;n<this.parameters.length;n++){const r=this.parameters[n];r.phetioPrivate||(assert&&assert(r.name,"name required"),t[r.name]=r.phetioType.toStateObject(e[n]))}}return t}static getPhetioDocumentation(e,t){const n=r=>{const s=r.phetioDocumentation?` - ${r.phetioDocumentation}`:"";return`<li>${r.name}: ${r.phetioType.typeName}${s}</li>`};return e+(t.length===0?"<br>No parameters.":`<br>The parameters are:<br/><ol>${t.map(n).join("<br/>")}</ol>`)}}axon.register("PhetioDataHandler",PhetioDataHandler);const PHET_IO_STATE_DEFAULT$2=!1,Ea=class Ea extends PhetioDataHandler{constructor(e){const t=optionize()({phetioOuterType:Ea.EmitterIO,phetioState:PHET_IO_STATE_DEFAULT$2},e);super(t),this.tinyEmitter=new TinyEmitter(null,t.hasListenerOrderDependencies)}emit(...e){assert&&assert(this.tinyEmitter instanceof TinyEmitter,"Emitter should not emit until constructor complete"),assert&&this.validateArguments(...e),Tandem.PHET_IO_ENABLED&&this.isPhetioInstrumented()&&this.phetioStartEvent("emitted",{data:this.getPhetioData(...e)}),this.tinyEmitter.emit(...e),Tandem.PHET_IO_ENABLED&&this.isPhetioInstrumented()&&this.phetioEndEvent()}dispose(){this.tinyEmitter.dispose(),super.dispose()}addListener(e){this.tinyEmitter.addListener(e)}removeListener(e){this.tinyEmitter.removeListener(e)}removeAllListeners(){this.tinyEmitter.removeAllListeners()}hasListener(e){return this.tinyEmitter.hasListener(e)}hasListeners(){return this.tinyEmitter.hasListeners()}getListenerCount(){return this.tinyEmitter.getListenerCount()}debug(e){const t=(...n)=>console.log(e,...n);return this.addListener(t),t}};Ea.EmitterIO=e=>{const t=e.map(getTypeName$1).join(",");return cache$6.has(t)||cache$6.set(t,new IOType(`EmitterIO<${e.map(getTypeName$1).join(", ")}>`,{valueType:Ea,documentation:"Emits when an event occurs and calls added listeners.",parameterTypes:e,events:["emitted"],metadataDefaults:{phetioState:PHET_IO_STATE_DEFAULT$2},methods:{addListener:{returnType:VoidIO,parameterTypes:[FunctionIO(VoidIO,e)],implementation:Ea.prototype.addListener,documentation:"Adds a listener which will be called when the emitter emits."},removeListener:{returnType:VoidIO,parameterTypes:[FunctionIO(VoidIO,e)],implementation:Ea.prototype.removeListener,documentation:"Remove a listener."},emit:{returnType:VoidIO,parameterTypes:e,implementation:function(...n){this.emit(...n)},documentation:"Emits a single event to all listeners.",invocableForReadOnlyElements:!1},getValidationErrors:{returnType:ArrayIO(NullableIO(StringIO)),parameterTypes:e,implementation:function(...n){return this.getValidationErrors(...n)},documentation:"Checks to see if the proposed values are valid. Returns an array of length N where each element is an error (string) or null if the value is valid."}}})),cache$6.get(t)};let Emitter=Ea;const getTypeName$1=o=>o.typeName,cache$6=new IOTypeCache;axon.register("Emitter",Emitter);const VALID_INTEGER={valueType:"number",isValidValue:o=>o%1===0,validationMessage:"Should be a valid integer"},VALID_NON_NAN={isValidValue:o=>!isNaN(o),validationMessage:"Should not be NaN"},VALIDATE_OPTIONS_FALSE={validateValidator:!1},VALID_NUMBER_TYPES=["FloatingPoint","Integer"],RANGE_PROPERTY_TANDEM_NAME="rangeProperty",DEFAULT_RANGE=Range.EVERYTHING,PropertyIOImpl=Property.PropertyIO(NumberIO),El=class El extends Property{constructor(e,t){var c;assert&&t&&assertMutuallyExclusiveOptions(["range"],["validValues"]);const n=optionize()({numberType:"FloatingPoint",range:DEFAULT_RANGE,validators:[],phetioOuterType:()=>El.NumberPropertyIO},t);n.rangePropertyOptions=optionize()({phetioDocumentation:"Provides the range of possible values for the parent NumberPropertyIO",phetioValueType:Range.RangeIO,phetioReadOnly:!0,tandem:n.range!==DEFAULT_RANGE?(c=n.tandem)==null?void 0:c.createTandem(RANGE_PROPERTY_TANDEM_NAME):Tandem.OPT_OUT},n.rangePropertyOptions),assert&&Tandem.VALIDATION&&n.rangePropertyOptions.tandem&&n.rangePropertyOptions.tandem.supplied&&assert&&assert(n.rangePropertyOptions.tandem.name===RANGE_PROPERTY_TANDEM_NAME,`rangePropertyOptions.tandem.name must be ${RANGE_PROPERTY_TANDEM_NAME}: ${n.rangePropertyOptions.tandem.name}`),n.valueType="number",n.phetioValueType=NumberIO;const s=!(n.range&&n.range instanceof ReadOnlyProperty),a=n.range instanceof ReadOnlyProperty?n.range:new Property(n.range,n.rangePropertyOptions);n.validators.push(VALID_NON_NAN),n.numberType==="Integer"&&n.validators.push(VALID_INTEGER);let l=!1;n.validators.push({isValidValue:y=>a.value.contains(y),validationMessage:()=>`Number value ${l?this.value:e} must be within rangeProperty value: ${a.value}`}),super(e,n),l=!0,this.numberType=n.numberType,this.rangeProperty=a,assert&&Tandem.VALIDATION&&this.rangeProperty.isPhetioInstrumented()&&assert&&assert(this.isPhetioInstrumented(),"NumberProperty must be phet-io instrumented if the range is");const d=()=>{validate(this.value,this.valueValidator,VALIDATE_OPTIONS_FALSE)};if(assert&&this.rangeProperty.link(d),this.rangeProperty.addPhetioStateDependencies([this]),this.addPhetioStateDependencies([this.rangeProperty]),n.validValues&&this.validateNumberAndRangeProperty)for(let y=0;y<n.validValues.length;y++){const m=n.validValues[y];this.validateNumberAndRangeProperty(m)}this.disposeNumberProperty=()=>{s?this.rangeProperty.dispose():assert&&this.rangeProperty.unlink(d)},this.resetNumberProperty=()=>{s&&this.rangeProperty.reset()}}get range(){return this.rangeProperty.value}set range(e){this.rangeProperty.value=e}reset(){this.resetValueAndRange(),super.reset()}dispose(){this.disposeNumberProperty(),super.dispose()}setValueAndRange(e,t){assert&&assert(t.contains(e),`value ${e} is not in range [${t.min},${t.max}]`),this.setDeferred(!0),this.rangeProperty.setDeferred(!0),this.set(e),this.rangeProperty.set(t);const n=this.setDeferred(!1),r=this.rangeProperty.setDeferred(!1);n&&n(),r&&r()}resetValueAndRange(){this.setValueAndRange(this.initialValue,this.rangeProperty.initialValue)}toStateObject(){const e=PropertyIOImpl.toStateObject(this);e.numberType=this.numberType,e.range=Range.RangeIO.toStateObject(this.rangeProperty.value);const t=this.rangeProperty&&this.rangeProperty.isPhetioInstrumented();return e.rangePhetioID=t?this.rangeProperty.tandem.phetioID:null,e}};El.NumberPropertyIO=new IOType("NumberPropertyIO",{valueType:El,supertype:PropertyIOImpl,parameterTypes:[NumberIO],documentation:`Extends PropertyIO to add values for the numeric range ( min, max ) and numberType ( '${VALID_NUMBER_TYPES.join("' | '")}' )`,toStateObject:e=>e.toStateObject(),applyState:(e,t)=>{PropertyIOImpl.applyState(e,t)},stateSchema:{numberType:StringIO,range:Range.RangeIO,rangePhetioID:NullableIO(StringIO)}});let NumberProperty=El;axon.register("NumberProperty",NumberProperty);const isSettingPhetioStateProperty=new TinyProperty(!1);tandemNamespace.register("isSettingPhetioStateProperty",isSettingPhetioStateProperty);const createObservableArray=o=>{var c,y,m,O;assertMutuallyExclusiveOptions(o,["length"],["elements"]);const e=optionize()({hasListenerOrderDependencies:!1,length:0,elements:[],elementAddedEmitterOptions:{},elementRemovedEmitterOptions:{},lengthPropertyOptions:{}},o);let t=null;if(e.phetioType)assert&&assert(e.phetioType.typeName.startsWith("ObservableArrayIO")),t={name:"value",phetioType:e.phetioType.parameterTypes[0]};else if(Validation.getValidatorValidationError(e))t=merge({name:"value"},{isValidValue:_.stubTrue});else{const D=_.pick(e,Validation.VALIDATOR_KEYS);t=merge({name:"value"},D)}const n=new Emitter(combineOptions({tandem:(c=e.tandem)==null?void 0:c.createTandem("elementAddedEmitter"),parameters:[t],phetioReadOnly:!0,hasListenerOrderDependencies:e.hasListenerOrderDependencies},e.elementAddedEmitterOptions)),r=new Emitter(combineOptions({tandem:(y=e.tandem)==null?void 0:y.createTandem("elementRemovedEmitter"),parameters:[t],phetioReadOnly:!0,hasListenerOrderDependencies:e.hasListenerOrderDependencies},e.elementRemovedEmitterOptions)),s=new NumberProperty(0,combineOptions({numberType:"Integer",tandem:(m=e.tandem)==null?void 0:m.createTandem("lengthProperty"),phetioReadOnly:!0,hasListenerOrderDependencies:e.hasListenerOrderDependencies},e.lengthPropertyOptions)),a=[];assert&&n.addListener(()=>{isSettingPhetioStateProperty.value||assert&&assert(s.value===a.length,"lengthProperty out of sync while adding element")}),assert&&r.addListener(()=>{isSettingPhetioStateProperty.value||assert&&assert(s.value===a.length,"lengthProperty out of sync while removing element")});const l=new Proxy(a,{get:function(D,z,w){return assert&&assert(D===a,"array should match the targetArray"),methods.hasOwnProperty(z)?methods[z]:Reflect.get(D,z,w)},set:function(D,z,w){assert&&assert(D===a,"array should match the targetArray");const N=D[z];let H=null;z==="length"&&(H=D.slice(w));const X=Reflect.set(D,z,w),ae=Number(z);return Number.isInteger(ae)&&ae>=0&&N!==w?(s.value=D.length,N!==void 0&&r.emit(D[z]),w!==void 0&&n.emit(w)):z==="length"&&(s.value=w,assert&&assert(H,"removedElements should be defined for key===length"),H&&H.forEach(oe=>r.emit(oe))),X},deleteProperty:function(D,z){assert&&assert(D===a,"array should match the targetArray");const w=Number(z);let N;Number.isInteger(w)&&w>=0&&(N=D[z]);const H=Reflect.deleteProperty(D,z);return N!==void 0&&r.emit(N),H}});l.targetArray=a,l.elementAddedEmitter=n,l.elementRemovedEmitter=r,l.lengthProperty=s;const d=()=>{e.length>=0&&(l.length=e.length),e.elements.length>0&&Array.prototype.push.apply(l,e.elements)};return d(),l.reset=()=>{l.length=0,d()},(O=e.tandem)!=null&&O.supplied&&(assert&&assert(e.phetioType),l.phetioElementType=e.phetioType.parameterTypes[0],l._observableArrayPhetioObject=new ObservableArrayPhetioObject(l,e)),l};class ObservableArrayPhetioObject extends PhetioObject{constructor(e,t){super(t),this.observableArray=e}}const methods={pop(...o){const e=this,t=e.targetArray.length,n=Array.prototype.pop.apply(e.targetArray,o);return e.lengthProperty.value=e.length,t>0&&e.elementRemovedEmitter.emit(n),n},shift(...o){const e=this,t=e.targetArray.length,n=Array.prototype.shift.apply(e.targetArray,o);return e.lengthProperty.value=e.length,t>0&&e.elementRemovedEmitter.emit(n),n},push(...o){const e=this,t=Array.prototype.push.apply(e.targetArray,o);e.lengthProperty.value=e.length;for(let n=0;n<arguments.length;n++)e.elementAddedEmitter.emit(o[n]);return t},unshift(...o){const e=this,t=Array.prototype.unshift.apply(e.targetArray,o);e.lengthProperty.value=e.length;for(let n=0;n<o.length;n++)e.elementAddedEmitter.emit(o[n]);return t},splice(...o){const e=this,t=Array.prototype.splice.apply(e.targetArray,o);e.lengthProperty.value=e.length;const n=t;for(let r=2;r<o.length;r++)e.elementAddedEmitter.emit(o[r]);return n.forEach(r=>e.elementRemovedEmitter.emit(r)),t},copyWithin(...o){const e=this,t=e.targetArray.slice(),n=Array.prototype.copyWithin.apply(e.targetArray,o);return reportDifference(t,e),n},fill(...o){const e=this,t=e.targetArray.slice(),n=Array.prototype.fill.apply(e.targetArray,o);return reportDifference(t,e),n},get:function(o){return this[o]},addItemAddedListener:function(o){this.elementAddedEmitter.addListener(o)},removeItemAddedListener:function(o){this.elementAddedEmitter.removeListener(o)},addItemRemovedListener:function(o){this.elementRemovedEmitter.addListener(o)},removeItemRemovedListener:function(o){this.elementRemovedEmitter.removeListener(o)},add:function(o){this.push(o)},addAll:function(o){this.push(...o)},remove:function(o){arrayRemove(this,o)},removeAll:function(o){o.forEach(e=>arrayRemove(this,e))},clear:function(){for(;this.length>0;)this.pop()},count:function(o){let e=0;for(let t=0;t<this.length;t++)o(this[t])&&e++;return e},find:function(o,e){return assert&&e!==void 0&&assert(typeof e=="number","fromIndex must be numeric, if provided"),assert&&typeof e=="number"&&assert(e>=0&&e<this.length,`fromIndex out of bounds: ${e}`),_.find(this,o,e)},shuffle:function(o){assert&&assert(o,"random must be supplied");const e=o.shuffle(this);this.targetArray.length=0,Array.prototype.push.apply(this.targetArray,e)},getArrayCopy:function(){return this.slice()},dispose:function(){const o=this;o.elementAddedEmitter.dispose(),o.elementRemovedEmitter.dispose(),o.lengthProperty.dispose(),o._observableArrayPhetioObject&&o._observableArrayPhetioObject.dispose()},toStateObject:function(){return{array:this.map(o=>this.phetioElementType.toStateObject(o))}},applyState:function(o){this.length=0;const e=o.array.map(t=>this.phetioElementType.fromStateObject(t));this.push(...e)}},reportDifference=(o,e)=>{const t=o,n=e.targetArray.slice();for(let r=0;r<t.length;r++){const s=t[r],a=n.indexOf(s);a>=0&&(t.splice(r,1),n.splice(a,1),r--)}t.forEach(r=>e.elementRemovedEmitter.emit(r)),n.forEach(r=>e.elementAddedEmitter.emit(r))},cache$5=new IOTypeCache,ObservableArrayIO=o=>(cache$5.has(o)||cache$5.set(o,new IOType(`ObservableArrayIO<${o.typeName}>`,{valueType:ObservableArrayPhetioObject,parameterTypes:[o],toStateObject:e=>e.observableArray.toStateObject(),applyState:(e,t)=>e.observableArray.applyState(t),stateSchema:{array:ArrayIO(o)}})),cache$5.get(o));createObservableArray.ObservableArrayIO=ObservableArrayIO;axon.register("createObservableArray",createObservableArray);const DERIVED_PROPERTY_IO_PREFIX="DerivedPropertyIO",strictAxonDependenciesGlobal=_.hasIn(window,"phet.chipper.queryParameters")&&phet.chipper.queryParameters.strictAxonDependencies;function getDerivedValue(o,e,t){assert&&strictAxonDependenciesGlobal&&o&&derivationStack.push(t);try{return e(...t.map(n=>n.get()))}finally{assert&&strictAxonDependenciesGlobal&&o&&derivationStack.pop()}}class DerivedProperty extends ReadOnlyProperty{constructor(e,t,n){const r=optionize()({phetioReadOnly:!0,phetioOuterType:DerivedProperty.DerivedPropertyIO,phetioLinkDependencies:!0,strictAxonDependencies:!0},n);assert&&assert(e.every(_.identity),"dependencies should all be truthy"),assert&&assert(e.length===_.uniq(e).length,"duplicate dependencies");const s=getDerivedValue(r.strictAxonDependencies,t,e);super(s,r),Tandem.VALIDATION&&this.isPhetioInstrumented()&&assert&&assert(this.phetioType.typeName.startsWith("DerivedPropertyIO"),"phetioType should be DerivedPropertyIO"),this.dependencies=e,this.derivation=t,this.strictAxonDependencies=r.strictAxonDependencies,this.derivedPropertyListener=this.getDerivedPropertyListener.bind(this),e.forEach(a=>{if(a.lazyLink(this.derivedPropertyListener),Tandem.PHET_IO_ENABLED&&this.isPhetioInstrumented()&&a instanceof PhetioObject&&a.isPhetioInstrumented()&&(a instanceof ReadOnlyProperty&&propertyStateHandlerSingleton.registerPhetioOrderDependency(a,PropertyStatePhase.UNDEFER,this,PropertyStatePhase.UNDEFER),r.tandem&&r.phetioLinkDependencies)){const l=r.tandem.createTandem("dependencies");this.addLinkedElement(a,{tandem:l.createTandemFromPhetioID(a.tandem.phetioID)})}})}hasDependency(e){return this.definedDependencies.includes(e)}get definedDependencies(){return assert&&assert(this.dependencies!==null,"Dependencies should be defined, has this Property been disposed?"),this.dependencies}getDerivedPropertyListener(){this.isDisposed||(this.isDeferred?this.hasDeferredValue=!0:super.set(getDerivedValue(this.strictAxonDependencies,this.derivation,this.definedDependencies)))}recomputeDerivation(){this.getDerivedPropertyListener()}dispose(){const e=this.definedDependencies;for(let t=0;t<e.length;t++){const n=e[t];n.hasListener(this.derivedPropertyListener)&&n.unlink(this.derivedPropertyListener)}this.dependencies=null,super.dispose()}setDeferred(e){return this.isDeferred&&!e&&(this.deferredValue=getDerivedValue(this.strictAxonDependencies,this.derivation,this.definedDependencies)),super.setDeferred(e)}static valueEquals(e,t,n){return new DerivedProperty([e,t],(r,s)=>r===s,n)}static valueEqualsConstant(e,t,n){return new DerivedProperty([e],r=>r===t,n)}static and(e,t){return assert&&assert(e.length>0,"must provide a dependency"),DerivedProperty.deriveAny(e,()=>_.reduce(e,andFunction,!0),t)}static or(e,t){return assert&&assert(e.length>0,"must provide a dependency"),DerivedProperty.deriveAny(e,()=>_.reduce(e,orFunction,!1),t)}static not(e,t){return new DerivedProperty([e],n=>!n,t)}static deriveAny(e,t,n){return new DerivedProperty(e,t,n)}}const andFunction=(o,e)=>o&&e.value,orFunction=(o,e)=>(assert&&assert(typeof e.value=="boolean","boolean value required"),o||e.value),cache$4=new IOTypeCache;DerivedProperty.DerivedPropertyIO=o=>(assert&&assert(o,"DerivedPropertyIO needs parameterType"),cache$4.has(o)||cache$4.set(o,new IOType(`${DERIVED_PROPERTY_IO_PREFIX}<${o.typeName}>`,{valueType:DerivedProperty,parameterTypes:[o],supertype:Property.PropertyIO(o),documentation:"Like PropertyIO, but not settable.  Instead it is derived from other DerivedPropertyIO or PropertyIO instances",applyState:_.noop,methods:{setValue:{returnType:VoidIO,parameterTypes:[o],implementation:DerivedProperty.prototype.set,documentation:"Errors out when you try to set a derived property.",invocableForReadOnlyElements:!1}}})),cache$4.get(o));class DerivedProperty1 extends DerivedProperty{}class DerivedProperty2 extends DerivedProperty{}class DerivedProperty4 extends DerivedProperty{}class DerivedProperty5 extends DerivedProperty{}axon.register("DerivedProperty",DerivedProperty);class DerivedStringProperty extends DerivedProperty{constructor(e,t,n){const r=optionize()({phetioFeatured:!0,phetioValueType:StringIO,tandemNameSuffix:"StringProperty"},n);super(e,t,r)}}axon.register("DerivedStringProperty",DerivedStringProperty);class DynamicProperty extends ReadOnlyProperty{constructor(e,t){const n=optionize()({bidirectional:!1,defaultValue:null,derive:_.identity,map:_.identity,inverseMap:_.identity},t),r=n.derive,s=n.map,a=n.inverseMap,l=typeof r=="function"?r:m=>m[r],d=typeof s=="function"?s:m=>m[s],c=typeof a=="function"?a:m=>m[a],y=e.value===null?d(n.defaultValue):d(l(e.value).value);super(y,n),this.lastPropertyPropertyValue=null,this.defaultValue=n.defaultValue,this.derive=l,this.map=d,this.inverseMap=c,this.bidirectional=n.bidirectional,this.valuePropertyProperty=e,this.isExternallyChanging=!1,this.propertyPropertyListener=this.onPropertyPropertyChange.bind(this),this.propertyListener=this.onPropertyChange.bind(this),e.link(this.propertyListener),n.bidirectional&&this.lazyLink(this.onSelfChange.bind(this))}onPropertyPropertyChange(e,t,n){this.bidirectional&&this.valuePropertyProperty.value!==null&&n&&this.derive(this.valuePropertyProperty.value)===n&&n.areValuesEqual(this.inverseMap(this.value),n.get())||super.set(this.map(e))}onPropertyChange(e,t){this.lastPropertyPropertyValue&&(this.derive(this.lastPropertyPropertyValue).unlink(this.propertyPropertyListener),this.lastPropertyPropertyValue=null),e?(this.derive(e).link(this.propertyPropertyListener),this.lastPropertyPropertyValue=e):this.onPropertyPropertyChange(this.defaultValue,null,null)}onSelfChange(e){if(assert&&assert(this.bidirectional),this.valuePropertyProperty.value!==null){const t=this.derive(this.valuePropertyProperty.value);this.areValuesEqual(e,this.map(t.value))||(t.value=this.inverseMap(e))}}dispose(){this.valuePropertyProperty.unlink(this.propertyListener),this.lastPropertyPropertyValue&&(this.derive(this.lastPropertyPropertyValue).unlink(this.propertyPropertyListener),this.lastPropertyPropertyValue=null),super.dispose()}reset(){assert&&assert(this.bidirectional,"Cannot reset a non-bidirectional DynamicProperty"),this.valuePropertyProperty.value!==null&&this.derive(this.valuePropertyProperty.value).reset()}set(e){assert&&assert(this.bidirectional,`Cannot set values directly to a non-bidirectional DynamicProperty, tried to set: ${e}`),this.isExternallyChanging=!0,super.set(e),this.isExternallyChanging=!1}get value(){return super.value}set value(e){this.set(e)}isSettable(){return super.isSettable()||this.bidirectional}}axon.register("DynamicProperty",DynamicProperty);const TANDEM_NAME="enabledProperty";class EnabledProperty extends BooleanProperty{constructor(e,t){const n=optionize()({phetioDocumentation:"Determines whether the element is enabled (true) or disabled (false).",phetioFeatured:!0,checkTandemName:!0},t);assert&&n&&n.tandem&&n.tandem.supplied&&n.checkTandemName&&assert&&assert(n.tandem.name===TANDEM_NAME,`EnabledProperty tandems should be named ${TANDEM_NAME}`),super(e,n)}static get TANDEM_NAME(){return TANDEM_NAME}}axon.register("EnabledProperty",EnabledProperty);const DEFAULT_OPTIONS$9={enabledProperty:null,enabled:!0,enabledPropertyOptions:null,phetioEnabledPropertyInstrumented:!0,tandem:PhetioObject.DEFAULT_OPTIONS.tandem};class EnabledComponent extends Disposable{constructor(e){const t=optionize3()({},DEFAULT_OPTIONS$9,e),n=!t.enabledProperty;assert&&t.enabledPropertyOptions&&assert(!(!t.phetioEnabledPropertyInstrumented&&t.enabledPropertyOptions.tandem),"incompatible options. Cannot specify phetioEnabledPropertyInstrumented opt out and a Tandem via enabledPropertyOptions."),super(t),this.enabledProperty=t.enabledProperty||new EnabledProperty(t.enabled,merge({tandem:t.phetioEnabledPropertyInstrumented?t.tandem.createTandem(EnabledProperty.TANDEM_NAME):Tandem.OPT_OUT},t.enabledPropertyOptions)),this.disposeEnabledComponent=()=>{n&&this.enabledProperty.dispose()}}setEnabled(e){assert&&assert(this.enabledProperty.isSettable(),"cannot set enabledProperty"),this.enabledProperty.value=e}set enabled(e){this.setEnabled(e)}get enabled(){return this.isEnabled()}isEnabled(){return this.enabledProperty.value}dispose(){this.disposeEnabledComponent(),super.dispose()}}axon.register("EnabledComponent",EnabledComponent);class EnumerationDeprecatedProperty extends Property{constructor(e,t,n){deprecationWarning("Use EnumerationProperty. EnumerationDeprecated should be exchanged for classes that extend EnumerationValue, see WilderEnumerationPatterns for examples."),assert&&assert(e instanceof EnumerationDeprecated,"likely you are using the new and improved Enumeration, better use EnumerationProperty too."),assert&&assert(e.VALUES.includes(t),`invalid initialValue: ${t}`),n&&(assert&&assert(!n.hasOwnProperty("isValidValue"),"EnumerationDeprecatedProperty does not support isValidValue"),assert&&assert(!n.hasOwnProperty("valueType"),"EnumerationDeprecatedProperty sets valueType"),assert&&assert(!n.hasOwnProperty("phetioType"),"EnumerationDeprecatedProperty sets phetioType")),n=merge({valueType:e,phetioValueType:EnumerationIO(e),validValues:e.VALUES},n),super(t,n),this.enumeration=e}}axon.register("EnumerationDeprecatedProperty",EnumerationDeprecatedProperty);class EnumerationProperty extends Property{constructor(e,t){const n=optionize()({enumeration:e.enumeration},t),r=optionize()({validValues:n.enumeration.values,phetioValueType:EnumerationIO({enumeration:n.enumeration})},n);super(e,r)}}axon.register("EnumerationProperty",EnumerationProperty);class MappedProperty extends DynamicProperty{constructor(e,t){super(new TinyProperty(e),t)}}axon.register("MappedProperty",MappedProperty);class Multilink{constructor(e,t,n){if(this.dependencies=e,assert&&assert(e.every(_.identity),"dependencies should all be truthy"),assert&&assert(e.length===_.uniq(e).length,"duplicate dependencies"),this.dependencyListeners=new Map,e.forEach(r=>{const s=()=>{if(!this.isDisposed){const a=e.map(l=>l.get());t(...a)}};this.dependencyListeners.set(r,s),r.lazyLink(s,{phetioDependencies:_.without(e,r)})}),!n){const r=e.map(s=>s.get());t(...r)}this.isDisposed=!1}get definedDependencies(){return assert&&assert(this.dependencies!==null,"Dependencies should be defined, has this Property been disposed?"),this.dependencies}dispose(){assert&&assert(this.dependencies,"A Multilink cannot be disposed twice.");const e=this.definedDependencies;for(let t=0;t<e.length;t++){const n=e[t],r=this.dependencyListeners.get(n);assert&&assert(r,"The listener should exist"),n.hasListener(r)&&n.unlink(r)}this.dependencies=null,this.dependencyListeners.clear(),this.isDisposed=!0}static multilink(e,t){return new Multilink(e,t,!1)}static multilinkAny(e,t){return new Multilink(e,t)}static lazyMultilink(e,t){return new Multilink(e,t,!0)}static lazyMultilinkAny(e,t){return new Multilink(e,t,!0)}static unmultilink(e){e.dispose()}}axon.register("Multilink",Multilink);const ObservableArrayDef={isObservableArray(o){return!!(Array.isArray(o)&&o.elementAddedEmitter&&o.elementRemovedEmitter&&o.lengthProperty)}};axon.register("ObservableArrayDef",ObservableArrayDef);function isTReadOnlyProperty(o){return o instanceof ReadOnlyProperty||o instanceof TinyProperty}const stringify=o=>`${o}`;class PatternStringProperty extends DerivedStringProperty{constructor(e,t,n){assert&&assert(!(t.tandem instanceof Tandem),"Did you intend to put tandem in providedOptions?");const r=optionize()({formatNames:[],decimalPlaces:null,phetioFeatured:!0,tandemNameSuffix:"StringProperty"},n),s=[e],a={},l=Object.keys(t);l.forEach(d=>{const c=t[d];isTReadOnlyProperty(c)&&s.push(c);let y=stringify;if(r.decimalPlaces!==null&&(typeof r.decimalPlaces=="number"||r.decimalPlaces[d]!==null)){const m=typeof r.decimalPlaces=="number"||r.decimalPlaces===null?r.decimalPlaces:r.decimalPlaces[d];assert&&assert(m!==null),y=O=>stringify(typeof O=="number"?DotUtils.toFixed(O,m):O)}r.maps&&r.maps.hasOwnProperty(d)?a[d]=m=>y(r.maps[d](m)):a[d]=y}),super(s,(...d)=>{const c=O=>{const D=s.indexOf(O);return D>=0?d[D]:O};let y=`${c(e)}`;r.formatNames.forEach((O,D)=>{y=y.replace(new RegExp(`\\{${D}\\}`,"g"),`{{${O}}}`)});const m=y.match(/\{\{[^{}]+\}\}/g)||[];for(let O=0;O<m.length;O++){const D=m[O],z=D.replace("{{","").replace("}}","");if(l.includes(z)){let w=c(t[z]);a[z]&&(w=a[z](w)),y=y.replace(D,`${w}`)}}return y},r)}}axon.register("PatternStringProperty",PatternStringProperty);class StringProperty extends Property{constructor(e,t){t&&(assert&&assert(!t.hasOwnProperty("valueType"),"StringProperty sets valueType"),assert&&assert(!t.hasOwnProperty("phetioType"),"StringProperty sets phetioType"));const n=optionize()({valueType:"string",phetioValueType:StringIO},t);super(e,n)}}axon.register("StringProperty",StringProperty);const cache$3=new IOTypeCache,StringUnionIO=o=>{if(assert&&assert(o,"StringUnionIO needs unionValues"),!cache$3.has(o)){const e=o.join(",");cache$3.set(o,new IOType(`StringUnionIO<${e}>`,{documentation:"A PhET-iO Type validating on specific string values.",isValidValue:t=>o.includes(t),toStateObject:_.identity,fromStateObject:_.identity,stateSchema:StateSchema.asValue(`StringUnionIO<${e}>`,{isValidValue:t=>o.includes(t)})}))}return cache$3.get(o)};tandemNamespace.register("StringUnionIO",StringUnionIO);class StringUnionProperty extends Property{constructor(e,t){const n=optionize()({phetioValueType:StringUnionIO(t.validValues)},t);super(e,n)}}axon.register("StringUnionProperty",StringUnionProperty);class TinyForwardingProperty extends TinyProperty{constructor(e,t,n){super(e,n),t&&(this.targetPropertyInstrumented=t),assert&&(this.phetioInitialized=!1)}setValueOrTargetProperty(e,t,n){if(isTReadOnlyProperty(n))this.setTargetProperty(n,e,t);else{const r=this.get();this.clearTargetProperty(),assert&&assert(!this.targetProperty,"just cleared"),this.setPropertyValue(n),this.areValuesEqual(r,n)||this.notifyListeners(r)}}setTargetProperty(e,t=null,n=null){if(assert&&t&&n===null&&this.targetPropertyInstrumented&&assert(!t.isPhetioInstrumented(),"tandemName must be provided for instrumented Nodes"),this.targetProperty===e)return t;const r=this.targetProperty&&this.targetProperty instanceof ReadOnlyProperty&&this.targetProperty.isPhetioInstrumented();assert&&r&&assert(e&&e instanceof ReadOnlyProperty&&e.isPhetioInstrumented(),"Cannot set swap out a PhET-iO instrumented targetProperty for an uninstrumented one");const s=this.targetProperty;this.ownedPhetioProperty&&e!==this.ownedPhetioProperty&&this.disposeOwnedPhetioProperty(),t&&n!==null&&t.updateLinkedElementForProperty(n,s,e);const a=this.get();return this.clearTargetProperty(),this.targetProperty=e,this.targetProperty?(assert&&assert(this.forwardingListener,"forwardingListener is not set yet"),this.targetProperty.lazyLink(this.forwardingListener),this.setPropertyValue(this.targetProperty.value)):this.setPropertyValue(a),this.areValuesEqual(a,this.get())||this.notifyListeners(a),t}clearTargetProperty(){this.forwardingListener=this.forwardingListener||this.onTargetPropertyChange.bind(this),this.targetProperty&&this.targetProperty.unlink(this.forwardingListener),this.targetProperty=null}onTargetPropertyChange(e){super.set(e)}set(e){return this.targetProperty?(assert&&assert(this.targetProperty.isSettable(),"targetProperty must be settable"),this.targetProperty.set(e)):super.set(e),this}setTargetPropertyInstrumented(e,t){return assert&&assert(!t.isPhetioInstrumented(),"this option only works if it is passed in before this Node is instrumented"),this.targetPropertyInstrumented=e,t}getTargetPropertyInstrumented(){return this.targetPropertyInstrumented||!1}initializePhetio(e,t,n){assert&&assert(!this.phetioInitialized,"already initialized"),assert&&assert(!this.ownedPhetioProperty,"Already created the ownedPhetioProperty"),!this.targetProperty&&this.targetPropertyInstrumented?(this.ownedPhetioProperty=n(),assert&&assert(this.ownedPhetioProperty instanceof Property,"The owned property should be an AXON/Property"),assert&&assert(this.ownedPhetioProperty instanceof ReadOnlyProperty&&this.ownedPhetioProperty.isPhetioInstrumented(),"The owned property should be PhET-iO instrumented"),this.setTargetProperty(this.ownedPhetioProperty,e,t)):this.targetProperty&&this.targetProperty instanceof ReadOnlyProperty&&this.targetProperty.isPhetioInstrumented()&&e.updateLinkedElementForProperty(t,null,this.targetProperty),assert&&(this.phetioInitialized=!0)}getTargetProperty(){return this.targetProperty||null}disposeOwnedPhetioProperty(){this.ownedPhetioProperty&&(this.ownedPhetioProperty.dispose(),delete this.ownedPhetioProperty)}dispose(){this.clearTargetProperty(),this.disposeOwnedPhetioProperty(),super.dispose()}}axon.register("TinyForwardingProperty",TinyForwardingProperty);class TinyOverrideProperty extends TinyProperty{constructor(e){super(e.value),this.isOverridden=!1,this._targetProperty=e,assert&&assert(!this.isOverridden,"Should not be overridden on startup"),this._targetListener=this.onTargetPropertyChange.bind(this),this._targetProperty.lazyLink(this._targetListener)}set targetProperty(e){this.setTargetProperty(e)}setTargetProperty(e){if(this.targetProperty===e)return;const t=this.value;this.isOverridden||this._targetProperty.unlink(this._targetListener),this._targetProperty=e,this.isOverridden||(this._targetProperty.lazyLink(this._targetListener),this.equalsValue(t)||this.notifyListeners(t))}clearOverride(){if(this.isOverridden){const e=this.value;this.isOverridden=!1,this._targetProperty.lazyLink(this._targetListener),this.equalsValue(e)||this.notifyListeners(e)}}get(){return this.isOverridden?this._value:this._targetProperty.value}set(e){this.isOverridden||(this._value=this._targetProperty.value),super.set(e)}setPropertyValue(e){this.isOverridden||(this.isOverridden=!0,this._targetProperty.unlink(this._targetListener)),super.setPropertyValue(e)}equalsValue(e){return this.areValuesEqual(e,this.value)}onTargetPropertyChange(e,t){this.isOverridden||this.notifyListeners(t)}notifyListeners(e){this.emit(this.value,e,this)}dispose(){this.isOverridden||this._targetProperty.unlink(this._targetListener),super.dispose()}}axon.register("TinyOverrideProperty",TinyOverrideProperty);class TinyStaticProperty extends TinyProperty{constructor(e,t){super(e),this.onAccessAttempt=t}get(){return this.onAccessAttempt(),super.get()}set(e){throw new Error("Cannot set a TinyStaticProperty value")}isSettable(){return!1}notifyListeners(e){this.emit(this.get(),e,this)}link(e){this.addListener(e),e(this.get(),null,this)}equalsValue(e){return this.areValuesEqual(e,this.get())}}axon.register("TinyStaticProperty",TinyStaticProperty);function isTRangedProperty(o){return(o instanceof ReadOnlyProperty||o instanceof TinyProperty)&&o.isSettable()&&!!o.range&&!!o.rangeProperty}class UnitConversionProperty extends MappedProperty{constructor(e,t){const n=a=>a*t.factor,r=a=>a/t.factor,s=optionize()({bidirectional:!0,map:n,inverseMap:r},t);super(e,s),this._property=e,this.rangeProperty=new Property(DEFAULT_RANGE),isTRangedProperty(e)&&(this._rangeListener=a=>{const l=n(a.min),d=n(a.max);this.rangeProperty.value=new Range(Math.min(l,d),Math.max(l,d))},e.rangeProperty.link(this._rangeListener))}get range(){return this.rangeProperty.value}set range(e){this.rangeProperty.value=e}dispose(){isTRangedProperty(this._property)&&this._property.rangeProperty.unlink(this._rangeListener),this.rangeProperty.dispose()}}axon.register("UnitConversionProperty",UnitConversionProperty);class VarianceNumberProperty extends NumberProperty{constructor(e,t,n){super(e,n),this.computeVariance=t}getRandomizedValue(){return this.computeVariance?this.computeVariance(super.get()):this.get()}}axon.register("VarianceNumberProperty",VarianceNumberProperty);window.sceneryLog=null;const scratchCanvas$1=document.createElement("canvas"),scratchContext$1=scratchCanvas$1.getContext("2d");let logPadding="";const scenery=new Namespace("scenery");scenery.register("scratchCanvas",scratchCanvas$1);scenery.register("scratchContext",scratchContext$1);function stringLogFunction(o){scenery.logString+=`${o.replace(/%c/g,"")}
`}function consoleLogFunction(...o){window.console&&window.console.log&&window.console.log(...Array.prototype.slice.call(o,0))}const logProperties={dirty:{name:"dirty",style:"color: #888;"},bounds:{name:"bounds",style:"color: #888;"},hitTest:{name:"hitTest",style:"color: #888;"},hitTestInternal:{name:"hitTestInternal",style:"color: #888;"},PerfCritical:{name:"Perf",style:"color: #f00;"},PerfMajor:{name:"Perf",style:"color: #aa0;"},PerfMinor:{name:"Perf",style:"color: #088;"},PerfVerbose:{name:"Perf",style:"color: #888;"},Cursor:{name:"Cursor",style:""},Stitch:{name:"Stitch",style:""},StitchDrawables:{name:"Stitch",style:""},GreedyStitcher:{name:"Greedy",style:"color: #088;"},GreedyVerbose:{name:"Greedy",style:"color: #888;"},RelativeTransform:{name:"RelativeTransform",style:"color: #606;"},BackboneDrawable:{name:"Backbone",style:"color: #a00;"},CanvasBlock:{name:"Canvas",style:""},WebGLBlock:{name:"WebGL",style:""},Display:{name:"Display",style:""},DOMBlock:{name:"DOM",style:""},Drawable:{name:"",style:""},FittedBlock:{name:"FittedBlock",style:""},Instance:{name:"Instance",style:""},InstanceTree:{name:"InstanceTree",style:""},ChangeInterval:{name:"ChangeInterval",style:"color: #0a0;"},SVGBlock:{name:"SVG",style:""},SVGGroup:{name:"SVGGroup",style:""},ImageSVGDrawable:{name:"ImageSVGDrawable",style:""},Paints:{name:"Paints",style:""},Filters:{name:"Filters",style:""},AlignBox:{name:"AlignBox",style:""},AlignGroup:{name:"AlignGroup",style:""},RichText:{name:"RichText",style:""},Sim:{name:"Sim",style:""},ParallelDOM:{name:"ParallelDOM",style:""},PDOMInstance:{name:"PDOMInstance",style:""},PDOMTree:{name:"PDOMTree",style:""},PDOMDisplaysInfo:{name:"PDOMDisplaysInfo",style:""},KeyboardFuzzer:{name:"KeyboardFuzzer",style:""},InputListener:{name:"InputListener",style:""},InputEvent:{name:"InputEvent",style:""},OnInput:{name:"OnInput",style:""},Pointer:{name:"Pointer",style:""},Input:{name:"Input",style:""},EventDispatch:{name:"EventDispatch",style:""},EventPath:{name:"EventPath",style:""}};extend(scenery,{logString:"",logFunction:function(...o){window.console&&window.console.log&&window.console.log(...Array.prototype.slice.call(o,0))},switchLogToConsole:function(){scenery.logFunction=consoleLogFunction},switchLogToString:function(){window.console&&window.console.log("switching to string log"),scenery.logFunction=stringLogFunction},enableIndividualLog:function(o){if(o==="stitch"){this.enableIndividualLog("Stitch"),this.enableIndividualLog("StitchDrawables"),this.enableIndividualLog("GreedyStitcher"),this.enableIndividualLog("GreedyVerbose");return}if(o==="perf"){this.enableIndividualLog("PerfCritical"),this.enableIndividualLog("PerfMajor"),this.enableIndividualLog("PerfMinor"),this.enableIndividualLog("PerfVerbose");return}if(o==="input"){this.enableIndividualLog("InputListener"),this.enableIndividualLog("InputEvent"),this.enableIndividualLog("OnInput"),this.enableIndividualLog("Pointer"),this.enableIndividualLog("Input"),this.enableIndividualLog("EventDispatch"),this.enableIndividualLog("EventPath");return}if(o==="a11y"||o==="pdom"){this.enableIndividualLog("ParallelDOM"),this.enableIndividualLog("PDOMInstance"),this.enableIndividualLog("PDOMTree"),this.enableIndividualLog("PDOMDisplaysInfo");return}o&&(assert&&assert(logProperties[o],`Unknown logger: ${o}, please use periods (.) to separate different log names`),window.sceneryLog[o]=window.sceneryLog[o]||function(e,t){const n=logProperties[o],r=n.name?`[${n.name}] `:"";scenery.logFunction(`%c${logPadding}%c${r}${e}`,"color: #ddd;",t||n.style)})},disableIndividualLog:function(o){o&&delete window.sceneryLog[o]},enableLogging:function(o){window.sceneryLog=function(e){scenery.logFunction(e)},window.sceneryLog.push=function(){logPadding+="| "},window.sceneryLog.pop=function(){logPadding=logPadding.slice(0,-2)},window.sceneryLog.getDepth=function(){return logPadding.length/2};for(let e=0;e<o.length;e++)this.enableIndividualLog(o[e])},disableLogging:function(){window.sceneryLog=null},isLoggingPerformance:function(){return window.sceneryLog.PerfCritical||window.sceneryLog.PerfMajor||window.sceneryLog.PerfMinor||window.sceneryLog.PerfVerbose}});const SceneryConstants={DISABLED_OPACITY:.45,DEFAULT_COLOR_PROFILE:"default",PROJECTOR_COLOR_PROFILE:"projector"};scenery.register("SceneryConstants",SceneryConstants);const clamp=DotUtils.clamp,linear=DotUtils.linear,rgbNumber="(-?\\d{1,3}%?)",aNumber="(\\d+|\\d*\\.\\d+)",rawNumber="(\\d{1,3})";function parseRGBNumber(o){let e=1;return o.endsWith("%")&&(e=2.55,o=o.slice(0,o.length-1)),DotUtils.roundSymmetric(Number(o)*e)}const ts=class ts{constructor(e,t,n,r){this.changeEmitter=new TinyEmitter,this.set(e,t,n,r)}copy(){return new ts(this.r,this.g,this.b,this.a)}set(e,t,n,r){if(assert&&assert(e!==void 0,"Can't call Color.set( undefined )"),e===null)this.setRGBA(0,0,0,0);else if(typeof e=="string")this.setCSS(e);else if(e instanceof ts)this.setRGBA(e.r,e.g,e.b,e.a);else if(n===void 0){assert&&assert(t===void 0||typeof t=="number");const s=e>>16&255,a=e>>8&255,l=e>>0&255,d=t===void 0?1:t;this.setRGBA(s,a,l,d)}else assert&&assert(r===void 0||typeof r=="number"),this.setRGBA(e,t,n,r===void 0?1:r);return this}getRed(){return this.r}get red(){return this.getRed()}set red(e){this.setRed(e)}setRed(e){return this.setRGBA(e,this.g,this.b,this.a)}getGreen(){return this.g}get green(){return this.getGreen()}set green(e){this.setGreen(e)}setGreen(e){return this.setRGBA(this.r,e,this.b,this.a)}getBlue(){return this.b}get blue(){return this.getBlue()}set blue(e){this.setBlue(e)}setBlue(e){return this.setRGBA(this.r,this.g,e,this.a)}getAlpha(){return this.a}get alpha(){return this.getAlpha()}set alpha(e){this.setAlpha(e)}setAlpha(e){return this.setRGBA(this.r,this.g,this.b,e)}setRGBA(e,t,n,r){return this.r=DotUtils.roundSymmetric(clamp(e,0,255)),this.g=DotUtils.roundSymmetric(clamp(t,0,255)),this.b=DotUtils.roundSymmetric(clamp(n,0,255)),this.a=clamp(r,0,1),this.updateColor(),this}blend(e,t){const r=Math.pow(this.r,2.4),s=Math.pow(e.r,2.4),a=Math.pow(this.g,2.4),l=Math.pow(e.g,2.4),d=Math.pow(this.b,2.4),c=Math.pow(e.b,2.4),y=Math.pow(r+(s-r)*t,1/2.4),m=Math.pow(a+(l-a)*t,1/2.4),O=Math.pow(d+(c-d)*t,1/2.4),D=this.a+(e.a-this.a)*t;return new ts(y,m,O,D)}computeCSS(){if(this.a===1)return`rgb(${this.r},${this.g},${this.b})`;{let e=this.a.toFixed(20);for(;e.length>=2&&e.endsWith("0")&&e[e.length-2]!==".";)e=e.slice(0,e.length-1);const t=this.a===0||this.a===1?this.a:e;return`rgba(${this.r},${this.g},${this.b},${t})`}}toCSS(){return assert&&assert(this._css===this.computeCSS(),`CSS cached value is ${this._css}, but the computed value appears to be ${this.computeCSS()}`),this._css}setCSS(e){let t=!1;const n=ts.preprocessCSS(e);for(let r=0;r<ts.formatParsers.length;r++){const s=ts.formatParsers[r],a=s.regexp.exec(n);if(a){s.apply(this,a),t=!0;break}}if(!t)throw new Error(`Color unable to parse color string: ${e}`);return this.updateColor(),this}toNumber(){return(this.r<<16)+(this.g<<8)+this.b}updateColor(){assert&&assert(!this.immutable,"Cannot modify an immutable color. Likely caused by trying to mutate a color after it was used for a node fill/stroke"),assert&&assert(typeof this.red=="number"&&typeof this.green=="number"&&typeof this.blue=="number"&&typeof this.alpha=="number",`Ensure color components are numeric: ${this.toString()}`),assert&&assert(isFinite(this.red)&&isFinite(this.green)&&isFinite(this.blue)&&isFinite(this.alpha),"Ensure color components are finite and not NaN"),assert&&assert(this.red>=0&&this.red<=255&&this.green>=0&&this.green<=255&&this.red>=0&&this.red<=255&&this.alpha>=0&&this.alpha<=1,`Ensure color components are in the proper ranges: ${this.toString()}`);const e=this._css;this._css=this.computeCSS(),e!==this._css&&this.changeEmitter.emit()}setImmutable(){return assert&&(this.immutable=!0),this}getCanvasStyle(){return this.toCSS()}setHSLA(e,t,n,r){e=e%360/360,t=clamp(t/100,0,1),n=clamp(n/100,0,1);let s;n<.5?s=n*(t+1):s=n+t-n*t;const a=n*2-s;return this.r=DotUtils.roundSymmetric(ts.hueToRGB(a,s,e+1/3)*255),this.g=DotUtils.roundSymmetric(ts.hueToRGB(a,s,e)*255),this.b=DotUtils.roundSymmetric(ts.hueToRGB(a,s,e-1/3)*255),this.a=clamp(r,0,1),this.updateColor(),this}equals(e){return this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a}withAlpha(e){return new ts(this.r,this.g,this.b,e)}checkFactor(e){return assert&&assert(e===void 0||e>=0&&e<=1,`factor must be between 0 and 1: ${e}`),e===void 0?.7:e}brighterColor(e){e=this.checkFactor(e);const t=Math.min(255,Math.floor(this.r/e)),n=Math.min(255,Math.floor(this.g/e)),r=Math.min(255,Math.floor(this.b/e));return new ts(t,n,r,this.a)}colorUtilsBrighter(e){e=this.checkFactor(e);const t=Math.min(255,this.getRed()+Math.floor(e*(255-this.getRed()))),n=Math.min(255,this.getGreen()+Math.floor(e*(255-this.getGreen()))),r=Math.min(255,this.getBlue()+Math.floor(e*(255-this.getBlue())));return new ts(t,n,r,this.getAlpha())}darkerColor(e){e=this.checkFactor(e);const t=Math.max(0,Math.floor(e*this.r)),n=Math.max(0,Math.floor(e*this.g)),r=Math.max(0,Math.floor(e*this.b));return new ts(t,n,r,this.a)}colorUtilsDarker(e){e=this.checkFactor(e);const t=Math.max(0,this.getRed()-Math.floor(e*this.getRed())),n=Math.max(0,this.getGreen()-Math.floor(e*this.getGreen())),r=Math.max(0,this.getBlue()-Math.floor(e*this.getBlue()));return new ts(t,n,r,this.getAlpha())}colorUtilsBrightness(e){return e===0?this:e>0?this.colorUtilsBrighter(e):this.colorUtilsDarker(-e)}toString(){return`${this.constructor.name}[r:${this.r} g:${this.g} b:${this.b} a:${this.a}]`}toHexString(){let e=this.toNumber().toString(16);for(;e.length<6;)e=`0${e}`;return`#${e}`}toStateObject(){return{r:this.r,g:this.g,b:this.b,a:this.a}}static hueToRGB(e,t,n){return n<0&&(n=n+1),n>1&&(n=n-1),n*6<1?e+(t-e)*n*6:n*2<1?t:n*3<2?e+(t-e)*(2/3-n)*6:e}static toColor(e){return e===null?ts.TRANSPARENT:e instanceof ts?e:typeof e=="string"?new ts(e):ts.toColor(e.value)}static interpolateRGBA(e,t,n){if(n<0||n>1)throw new Error(`distance must be between 0 and 1: ${n}`);const r=Math.floor(linear(0,1,e.r,t.r,n)),s=Math.floor(linear(0,1,e.g,t.g,n)),a=Math.floor(linear(0,1,e.b,t.b,n)),l=linear(0,1,e.a,t.a,n);return new ts(r,s,a,l)}static supersampleBlend(e){const n=e.map(O=>Math.pow(O.r/255,2.2)),r=e.map(O=>Math.pow(O.g/255,2.2)),s=e.map(O=>Math.pow(O.b/255,2.2)),a=e.map(O=>Math.pow(O.a,2.2)),l=_.sum(a);if(l===0)return new ts(0,0,0,0);const d=_.sum(_.range(0,e.length).map(O=>n[O]*a[O]))/l,c=_.sum(_.range(0,e.length).map(O=>r[O]*a[O]))/l,y=_.sum(_.range(0,e.length).map(O=>s[O]*a[O]))/l,m=l/e.length;return new ts(Math.floor(Math.pow(d,1/2.2)*255),Math.floor(Math.pow(c,1/2.2)*255),Math.floor(Math.pow(y,1/2.2)*255),Math.pow(m,1/2.2))}static fromStateObject(e){return new ts(e.r,e.g,e.b,e.a)}static hsla(e,t,n,r){return new ts(0,0,0,1).setHSLA(e,t,n,r)}static checkPaintString(e){if(assert)try{scratchColor$2.setCSS(e)}catch{assert(!1,`The CSS string is an invalid color: ${e}`)}}static checkPaint(e){typeof e=="string"?ts.checkPaintString(e):isTReadOnlyProperty(e)&&typeof e.value=="string"&&ts.checkPaintString(e.value)}static getLuminance(e){const t=ts.toColor(e),n=t.red*.2126+t.green*.7152+t.blue*.0722;return assert&&assert(n>=0&&n<=255,`unexpected luminance: ${n}`),n}static toGrayscale(e){const t=ts.getLuminance(e);return new ts(t,t,t)}static isDarkColor(e,t=186){return assert&&assert(t>=0&&t<=255,"invalid luminanceThreshold"),ts.getLuminance(e)<t}static isLightColor(e,t){return!ts.isDarkColor(e,t)}static grayColor(e,t){return new ts(e,e,e,t)}static preprocessCSS(e){let t=e.replace(/ /g,"").toLowerCase();const n=ts.colorKeywords[t];return n&&(t=`#${n}`),t}static isCSSColorString(e){const t=ts.preprocessCSS(e);for(let n=0;n<ts.formatParsers.length;n++)if(ts.formatParsers[n].regexp.exec(t))return!0;return!1}};ts.formatParsers=[{regexp:/^transparent$/,apply:(e,t)=>{e.setRGBA(0,0,0,0)}},{regexp:/^#(\w{1})(\w{1})(\w{1})$/,apply:(e,t)=>{e.setRGBA(parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),1)}},{regexp:/^#(\w{2})(\w{2})(\w{2})$/,apply:(e,t)=>{e.setRGBA(parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),1)}},{regexp:new RegExp(`^rgb\\(${rgbNumber},${rgbNumber},${rgbNumber}\\)$`),apply:(e,t)=>{e.setRGBA(parseRGBNumber(t[1]),parseRGBNumber(t[2]),parseRGBNumber(t[3]),1)}},{regexp:new RegExp(`^rgba\\(${rgbNumber},${rgbNumber},${rgbNumber},${aNumber}\\)$`),apply:(e,t)=>{e.setRGBA(parseRGBNumber(t[1]),parseRGBNumber(t[2]),parseRGBNumber(t[3]),Number(t[4]))}},{regexp:new RegExp(`^hsl\\(${rawNumber},${rawNumber}%,${rawNumber}%\\)$`),apply:(e,t)=>{e.setHSLA(Number(t[1]),Number(t[2]),Number(t[3]),1)}},{regexp:new RegExp(`^hsla\\(${rawNumber},${rawNumber}%,${rawNumber}%,${aNumber}\\)$`),apply:(e,t)=>{e.setHSLA(Number(t[1]),Number(t[2]),Number(t[3]),Number(t[4]))}}],ts.basicColorKeywords={aqua:"00ffff",black:"000000",blue:"0000ff",fuchsia:"ff00ff",gray:"808080",green:"008000",lime:"00ff00",maroon:"800000",navy:"000080",olive:"808000",purple:"800080",red:"ff0000",silver:"c0c0c0",teal:"008080",white:"ffffff",yellow:"ffff00"},ts.colorKeywords={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"778899",lightslategrey:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};let Color=ts;scenery.register("Color",Color);Color.BLACK=Color.black=new Color(0,0,0).setImmutable();Color.BLUE=Color.blue=new Color(0,0,255).setImmutable();Color.CYAN=Color.cyan=new Color(0,255,255).setImmutable();Color.DARK_GRAY=Color.darkGray=new Color(64,64,64).setImmutable();Color.GRAY=Color.gray=new Color(128,128,128).setImmutable();Color.GREEN=Color.green=new Color(0,255,0).setImmutable();Color.LIGHT_GRAY=Color.lightGray=new Color(192,192,192).setImmutable();Color.MAGENTA=Color.magenta=new Color(255,0,255).setImmutable();Color.ORANGE=Color.orange=new Color(255,200,0).setImmutable();Color.PINK=Color.pink=new Color(255,175,175).setImmutable();Color.RED=Color.red=new Color(255,0,0).setImmutable();Color.WHITE=Color.white=new Color(255,255,255).setImmutable();Color.YELLOW=Color.yellow=new Color(255,255,0).setImmutable();Color.TRANSPARENT=Color.transparent=new Color(0,0,0,0).setImmutable();const scratchColor$2=new Color("blue");Color.ColorIO=new IOType("ColorIO",{valueType:Color,documentation:"A color, with rgba",toStateObject:o=>o.toStateObject(),fromStateObject:o=>new Color(o.r,o.g,o.b,o.a),stateSchema:{r:NumberIO,g:NumberIO,b:NumberIO,a:NumberIO}});const Features={};scenery.register("Features",Features);function supportsDataURLFormatOutput(o){try{const e=document.createElement("canvas");e.width=1,e.height=1;const t=e.getContext("2d");t.fillStyle="black",t.fillRect(0,0,1,1);const n=e.toDataURL([o]),r=`data:${o}`;return n.slice(0,r.length)===r}catch{return!1}}function supportsDataURLFormatOrigin(o,e){const t=document.createElement("canvas");t.width=1,t.height=1;const n=t.getContext("2d"),r=document.createElement("img");r.crossOrigin="Anonymous";const s=()=>{try{n.drawImage(r,0,0),t.toDataURL(),Features[o]=!0}catch{Features[o]=!1}};r.onload=s;try{r.src=e,r.complete&&s()}catch{Features[o]=!1}}Features.canvasPNGOutput=supportsDataURLFormatOutput("image/png");Features.canvasJPEGOutput=supportsDataURLFormatOutput("image/jpeg");Features.canvasGIFOutput=supportsDataURLFormatOutput("image/gif");Features.canvasICONOutput=supportsDataURLFormatOutput("image/x-icon");supportsDataURLFormatOrigin("canvasPNGInput","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQIW2NkYGD4DwABCQEBtxmN7wAAAABJRU5ErkJggg==");supportsDataURLFormatOrigin("canvasJPEGInput","data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAMCAgICAgMCAgIDAwMDBAYEBAQEBAgGBgUGCQgKCgkICQkKDA8MCgsOCwkJDRENDg8QEBEQCgwSExIQEw8QEBD/2wBDAQMDAwQDBAgEBAgQCwkLEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBD/wAARCAABAAEDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD8qqKKKAP/2Q==");supportsDataURLFormatOrigin("canvasSVGInput","data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIj8+DQo8c3ZnIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2aWV3cG9ydD0iMCAwIDEgMSIgd2lkdGg9IjEiIGhlaWdodD0iMSIgPg0KICA8cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMSIgaGVpZ2h0PSIxIiByeD0iMCIgcnk9IjAiIHN0eWxlPSJmaWxsOiBibGFjazsgc3Ryb2tlOiBub25lOyI+PC9yZWN0Pg0KPC9zdmc+DQo=");supportsDataURLFormatOrigin("canvasGIFInput","data:image/gif;base64,R0lGODlhAQABAJEAAAAAAP///////wAAACH5BAEAAAIALAAAAAABAAEAAAICRAEAOw==");const canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");Features.toDataURLHD=detectPrefix(canvas,"toDataURLHD");Features.createImageDataHD=detectPrefix(ctx,"createImageDataHD");Features.getImageDataHD=detectPrefix(ctx,"getImageDataHD");Features.putImageDataHD=detectPrefix(ctx,"putImageDataHD");Features.currentTransform=detectPrefix(ctx,"currentTransform");Features.canvasFilter=detectPrefix(ctx,"filter");const span=document.createElement("span"),div=document.createElement("div");Features.textStroke=detectPrefix(span.style,"textStroke");Features.textStrokeColor=detectPrefix(span.style,"textStrokeColor");Features.textStrokeWidth=detectPrefix(span.style,"textStrokeWidth");Features.transform=detectPrefix(div.style,"transform");Features.transformOrigin=detectPrefix(div.style,"transformOrigin");Features.backfaceVisibility=detectPrefix(div.style,"backfaceVisibility");Features.borderRadius=detectPrefix(div.style,"borderRadius");Features.userSelect=detectPrefix(div.style,"userSelect");Features.touchAction=detectPrefix(div.style,"touchAction");Features.touchCallout=detectPrefix(div.style,"touchCallout");Features.userDrag=detectPrefix(div.style,"userDrag");Features.tapHighlightColor=detectPrefix(div.style,"tapHighlightColor");Features.fontSmoothing=detectPrefix(div.style,"fontSmoothing");Features.requestAnimationFrame=detectPrefix(window,"requestAnimationFrame");Features.cancelAnimationFrame=detectPrefix(window,"cancelAnimationFrame");Features.setStyle=(o,e,t)=>{e!==void 0&&(o.style[e]=t)};Features.passive=!1;window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>{Features.passive=!0}}));const VALID_STYLES=["normal","italic","oblique"],VALID_VARIANTS=["normal","small-caps"],VALID_WEIGHTS=["normal","bold","bolder","lighter","100","200","300","400","500","600","700","800","900"],VALID_STRETCHES=["normal","ultra-condensed","extra-condensed","condensed","semi-condensed","semi-expanded","expanded","extra-expanded","ultra-expanded"],Vr=class Vr extends PhetioObject{constructor(e){assert&&assert(e===void 0||typeof e=="object"&&Object.getPrototypeOf(e)===Object.prototype,"options, if provided, should be a raw object");const t=optionize()({style:"normal",variant:"normal",weight:"normal",stretch:"normal",size:"10px",lineHeight:"normal",family:"sans-serif",phetioType:Vr.FontIO},e);assert&&assert(typeof t.weight=="string"||typeof t.weight=="number","Font weight should be specified as a string or number"),assert&&assert(typeof t.size=="string"||typeof t.size=="number","Font size should be specified as a string or number"),super(t),this._style=t.style,this._variant=t.variant,this._weight=`${t.weight}`,this._stretch=t.stretch,this._size=Vr.castSize(t.size),this._lineHeight=t.lineHeight,this._family=t.family,assert&&assert(typeof this._style=="string"&&_.includes(VALID_STYLES,this._style),'Font style must be one of "normal", "italic", or "oblique"'),assert&&assert(typeof this._variant=="string"&&_.includes(VALID_VARIANTS,this._variant),'Font variant must be "normal" or "small-caps"'),assert&&assert(typeof this._weight=="string"&&_.includes(VALID_WEIGHTS,this._weight),'Font weight must be one of "normal", "bold", "bolder", "lighter", "100", "200", "300", "400", "500", "600", "700", "800", or "900"'),assert&&assert(typeof this._stretch=="string"&&_.includes(VALID_STRETCHES,this._stretch),'Font stretch must be one of "normal", "ultra-condensed", "extra-condensed", "condensed", "semi-condensed", "semi-expanded", "expanded", "extra-expanded", or "ultra-expanded"'),assert&&assert(typeof this._size=="string"&&!_.includes(["0","1","2","3","4","5","6","7","8","9"],this._size[this._size.length-1]),"Font size must be either passed as a number (not a string, interpreted as px), or must contain a suffix for percentage, absolute or relative units, or an explicit size constant"),assert&&assert(typeof this._lineHeight=="string"),assert&&assert(typeof this._family=="string"),this._font=this.computeShorthand()}getFont(){return this._font}get font(){return this.getFont()}getStyle(){return this._style}get style(){return this.getStyle()}getVariant(){return this._variant}get variant(){return this.getVariant()}getWeight(){return this._weight}get weight(){return this.getWeight()}getStretch(){return this._stretch}get stretch(){return this.getStretch()}getSize(){return this._size}get size(){return this.getSize()}getNumericSize(){const e=this._size.match(/^(\d+)px$/);if(e)return Number(e[1]);const t=this._size.match(/^(\d+)pt$/);if(t)return .75*Number(t[1]);const n=this._size.match(/^(\d+)em$/);return n?Number(n[1])/16:12}get numericSize(){return this.getNumericSize()}getLineHeight(){return this._lineHeight}get lineHeight(){return this.getLineHeight()}getFamily(){return this._family}get family(){return this.getFamily()}copy(e){return new Vr(combineOptions({style:this._style,variant:this._variant,weight:this._weight,stretch:this._stretch,size:this._size,lineHeight:this._lineHeight,family:this._family},e))}computeShorthand(){let e="";return this._style!=="normal"&&(e+=`${this._style} `),this._variant!=="normal"&&(e+=`${this._variant} `),this._weight!=="normal"&&(e+=`${this._weight} `),this._stretch!=="normal"&&(e+=`${this._stretch} `),e+=this._size,this._lineHeight!=="normal"&&(e+=`/${this._lineHeight}`),e+=` ${this._family}`,e}toCSS(){return this.getFont()}static castSize(e){return typeof e=="number"?`${e}px`:e}static isFontStyle(e){return VALID_STYLES.includes(e)}static isFontVariant(e){return VALID_VARIANTS.includes(e)}static isFontWeight(e){return VALID_WEIGHTS.includes(e)}static isFontStretch(e){return VALID_STRETCHES.includes(e)}static fromCSS(e){const t={},n=_.filter(e.split(/[\x09\x0A\x0C\x0D\x20]/),r=>r.length>0);for(let r=0;r<n.length;r++){const s=n[r];if(s!=="normal")if(Vr.isFontStyle(s))assert&&assert(t.style===void 0,`Style cannot be applied twice. Already set to "${t.style}", attempt to replace with "${s}"`),t.style=s;else if(Vr.isFontVariant(s))assert&&assert(t.variant===void 0,`Variant cannot be applied twice. Already set to "${t.variant}", attempt to replace with "${s}"`),t.variant=s;else if(Vr.isFontWeight(s))assert&&assert(t.weight===void 0,`Weight cannot be applied twice. Already set to "${t.weight}", attempt to replace with "${s}"`),t.weight=s;else if(Vr.isFontStretch(s))assert&&assert(t.stretch===void 0,`Stretch cannot be applied twice. Already set to "${t.stretch}", attempt to replace with "${s}"`),t.stretch=s;else{const a=s.split(/\//);t.size=a[0],a[1]&&(t.lineHeight=a[1]),t.family=n.slice(r+1).join(" ");break}}return new Vr(t)}};Vr.DEFAULT=new Vr;let Font=Vr;scenery.register("Font",Font);Font.FontIO=new IOType("FontIO",{valueType:Font,documentation:"Font handling for text drawing. Options:<ul><li><strong>style:</strong> normal      &mdash; normal | italic | oblique </li><li><strong>variant:</strong> normal    &mdash; normal | small-caps </li><li><strong>weight:</strong> normal     &mdash; normal | bold | bolder | lighter | 100 | 200 | 300 | 400 | 500 | 600 | 700 | 800 | 900 </li><li><strong>stretch:</strong> normal    &mdash; normal | ultra-condensed | extra-condensed | condensed | semi-condensed | semi-expanded | expanded | extra-expanded | ultra-expanded </li><li><strong>size:</strong> 10px         &mdash; absolute-size | relative-size | length | percentage -- unitless number interpreted as px. absolute suffixes: cm, mm, in, pt, pc, px. relative suffixes: em, ex, ch, rem, vw, vh, vmin, vmax. </li><li><strong>lineHeight:</strong> normal &mdash; normal | number | length | percentage -- NOTE: Canvas spec forces line-height to normal </li><li><strong>family:</strong> sans-serif &mdash; comma-separated list of families, including generic families (serif, sans-serif, cursive, fantasy, monospace). ideally escape with double-quotes</li></ul>",toStateObject:o=>({style:o.getStyle(),variant:o.getVariant(),weight:o.getWeight(),stretch:o.getStretch(),size:o.getSize(),lineHeight:o.getLineHeight(),family:o.getFamily()}),fromStateObject(o){return new Font(o)},stateSchema:{style:StringIO,variant:StringIO,weight:StringIO,stretch:StringIO,size:StringIO,lineHeight:StringIO,family:StringIO}});const Renderer={};scenery.register("Renderer",Renderer);Renderer.numActiveRenderers=4;Renderer.bitsPerRenderer=5;Renderer.bitmaskRendererArea=255;Renderer.bitmaskCurrentRendererArea=15;Renderer.bitmaskLacksOffset=65536;Renderer.bitmaskLacksShift=16;Renderer.bitmaskNodeDefault=Renderer.bitmaskRendererArea;Renderer.bitmaskCanvas=1;Renderer.bitmaskSVG=2;Renderer.bitmaskDOM=4;Renderer.bitmaskWebGL=8;Renderer.bitmaskSingleCanvas=256;Renderer.bitmaskSingleSVG=512;Renderer.bitmaskNotPainted=4096;Renderer.bitmaskBoundsValid=8192;Renderer.bitmaskNoPDOM=16384;Renderer.bitmaskLacksCanvas=Renderer.bitmaskCanvas<<Renderer.bitmaskLacksShift;Renderer.bitmaskLacksSVG=Renderer.bitmaskSVG<<Renderer.bitmaskLacksShift;Renderer.bitmaskLacksDOM=Renderer.bitmaskDOM<<Renderer.bitmaskLacksShift;Renderer.bitmaskLacksWebGL=Renderer.bitmaskWebGL<<Renderer.bitmaskLacksShift;Renderer.isCanvas=function(o){return(o&Renderer.bitmaskCanvas)!==0};Renderer.isSVG=function(o){return(o&Renderer.bitmaskSVG)!==0};Renderer.isDOM=function(o){return(o&Renderer.bitmaskDOM)!==0};Renderer.isWebGL=function(o){return(o&Renderer.bitmaskWebGL)!==0};const rendererMap={canvas:Renderer.bitmaskCanvas,svg:Renderer.bitmaskSVG,dom:Renderer.bitmaskDOM,webgl:Renderer.bitmaskWebGL};Renderer.fromName=function(o){return rendererMap[o]};Renderer.stripBitmask=function(o){return o&Renderer.bitmaskRendererArea};Renderer.createOrderBitmask=function(o,e,t,n){return o=o||0,e=e||0,t=t||0,n=n||0,o|e<<5|t<<10|n<<15};Renderer.bitmaskOrder=function(o,e){return e>0&&(o=o>>5*e),o&Renderer.bitmaskCurrentRendererArea};Renderer.bitmaskOrderFirst=function(o){return o&Renderer.bitmaskCurrentRendererArea};Renderer.bitmaskOrderSecond=function(o){return o>>5&Renderer.bitmaskCurrentRendererArea};Renderer.bitmaskOrderThird=function(o){return o>>10&Renderer.bitmaskCurrentRendererArea};Renderer.bitmaskOrderFourth=function(o){return o>>15&Renderer.bitmaskCurrentRendererArea};Renderer.pushOrderBitmask=function(o,e){assert&&assert(typeof o=="number"),assert&&assert(typeof e=="number");let t=e;const n=Renderer.bitsPerRenderer*Renderer.numActiveRenderers;for(let r=0;r<=n;r+=Renderer.bitsPerRenderer){const s=o>>r&Renderer.bitmaskCurrentRendererArea;if(s===t)return o;if(s===0)return o=o|t<<r,o;if(o=o&~(Renderer.bitmaskCurrentRendererArea<<r),o=o|t<<r,t=s,t===e)return o}throw new Error("pushOrderBitmask overflow")};Renderer.createSelfDrawable=function(o,e,t,n){let r;if(Renderer.isCanvas(t))r=e.createCanvasDrawable(t,o);else if(Renderer.isSVG(t))r=e.createSVGDrawable(t,o);else if(Renderer.isDOM(t))r=e.createDOMDrawable(t,o);else if(Renderer.isWebGL(t))r=e.createWebGLDrawable(t,o);else throw new Error(`Unrecognized renderer: ${t}`);return assert&&_.each(e.drawableMarkFlags,s=>{const a=`markDirty${s[0].toUpperCase()}${s.slice(1)}`;assert(typeof r[a]=="function",`Did not find ${a}`)}),r.setFittable(n),r};Renderer.webglCustom=1;Renderer.webglTexturedTriangles=2;Renderer.webglVertexColorPolygons=3;const svgns="http://www.w3.org/2000/svg";scenery.register("svgns",svgns);const xlinkns="http://www.w3.org/1999/xlink";scenery.register("xlinkns",xlinkns);function p(o,e){return new Vector2(o,e)}const transformProperty=Features.transform,transformOriginProperty=Features.transformOrigin||"transformOrigin";let webglEnabled=!0,_extensionlessWebGLSupport;const Utils={prepareForTransform(o){o.style[transformOriginProperty]="top left"},applyPreparedTransform(o,e){e.style[transformProperty]=o.getCSSTransform()},setTransform(o,e){e.style[transformProperty]=o},unsetTransform(o){o.style[transformProperty]=""},polyfillRequestAnimationFrame(){(!window.requestAnimationFrame||!window.cancelAnimationFrame)&&(!Features.requestAnimationFrame||!Features.cancelAnimationFrame?(window.requestAnimationFrame=o=>{const e=Date.now();return window.setTimeout(()=>{o(Date.now()-e)},16)},window.cancelAnimationFrame=clearTimeout):(window.requestAnimationFrame=window[Features.requestAnimationFrame],window.cancelAnimationFrame=window[Features.cancelAnimationFrame]))},backingStorePixelRatio(o){return o.webkitBackingStorePixelRatio||o.mozBackingStorePixelRatio||o.msBackingStorePixelRatio||o.oBackingStorePixelRatio||o.backingStorePixelRatio||1},backingScale(o){if("devicePixelRatio"in window){const e=Utils.backingStorePixelRatio(o);return window.devicePixelRatio/e}return 1},supportsNativeCanvasFilter(){return!!Features.canvasFilter},supportsImageDataCanvasFilter(){return Utils.backingStorePixelRatio(scenery.scratchContext)===1},scanBounds(o,e,t){const n=_.map(_.range(e),()=>!1),r=_.map(_.range(e),()=>!1);for(let y=0;y<e;y++)for(let m=0;m<e;m++){const O=4*(m*e+y);(o.data[O]!==0||o.data[O+1]!==0||o.data[O+2]!==0||o.data[O+3]!==0)&&(n[y]=!0,r[m]=!0)}const s=_.indexOf(n,!0),a=_.lastIndexOf(n,!0),l=_.indexOf(r,!0),d=_.lastIndexOf(r,!0),c=e/16;return{minBounds:new Bounds2(s<1||s>=e-1?Number.POSITIVE_INFINITY:t.inversePosition2(p(s+1+c,0)).x,l<1||l>=e-1?Number.POSITIVE_INFINITY:t.inversePosition2(p(0,l+1+c)).y,a<1||a>=e-1?Number.NEGATIVE_INFINITY:t.inversePosition2(p(a-c,0)).x,d<1||d>=e-1?Number.NEGATIVE_INFINITY:t.inversePosition2(p(0,d-c)).y),maxBounds:new Bounds2(s<1||s>=e-1?Number.NEGATIVE_INFINITY:t.inversePosition2(p(s-1-c,0)).x,l<1||l>=e-1?Number.NEGATIVE_INFINITY:t.inversePosition2(p(0,l-1-c)).y,a<1||a>=e-1?Number.POSITIVE_INFINITY:t.inversePosition2(p(a+2+c,0)).x,d<1||d>=e-1?Number.POSITIVE_INFINITY:t.inversePosition2(p(0,d+2+c)).y)}},canvasAccurateBounds(o,e){const t=e&&e.precision?e.precision:.001,n=e&&e.resolution?e.resolution:128,r=e&&e.initialScale?e.initialScale:1/16;let s=Bounds2.NOTHING,a=Bounds2.EVERYTHING;const l=document.createElement("canvas");l.width=n,l.height=n;const d=l.getContext("2d");function c(H){d.save(),H.matrix.canvasSetTransform(d),o(d),d.restore();const X=d.getImageData(0,0,n,n),ae=Utils.scanBounds(X,n,H);return d.clearRect(0,0,n,n),ae}function y(H){const ae=(n-4)/(H.maxX-H.minX),oe=(n-2*2)/(H.maxY-H.minY),ue=-ae*H.minX+2,fe=-oe*H.minY+2;return new Transform3(Matrix3.translation(ue,fe).timesMatrix(Matrix3.scaling(ae,oe)))}const m=new Transform3;m.append(Matrix3.translation(n/2,n/2)),m.append(Matrix3.scaling(r));const O=c(m);s=s.union(O.minBounds),a=a.intersection(O.maxBounds);let D,z,w;for(D=a.minY,z=a.maxY;isFinite(s.minX)&&isFinite(a.minX)&&Math.abs(s.minX-a.minX)>t&&(w=c(y(new Bounds2(a.minX,D,s.minX,z))),!(s.minX<=w.minBounds.minX&&a.minX>=w.maxBounds.minX));)s=s.withMinX(Math.min(s.minX,w.minBounds.minX)),a=a.withMinX(Math.max(a.minX,w.maxBounds.minX)),D=Math.max(D,w.maxBounds.minY),z=Math.min(z,w.maxBounds.maxY);for(D=a.minY,z=a.maxY;isFinite(s.maxX)&&isFinite(a.maxX)&&Math.abs(s.maxX-a.maxX)>t&&(w=c(y(new Bounds2(s.maxX,D,a.maxX,z))),!(s.maxX>=w.minBounds.maxX&&a.maxX<=w.maxBounds.maxX));)s=s.withMaxX(Math.max(s.maxX,w.minBounds.maxX)),a=a.withMaxX(Math.min(a.maxX,w.maxBounds.maxX)),D=Math.max(D,w.maxBounds.minY),z=Math.min(z,w.maxBounds.maxY);for(D=a.minX,z=a.maxX;isFinite(s.minY)&&isFinite(a.minY)&&Math.abs(s.minY-a.minY)>t&&(w=c(y(new Bounds2(D,a.minY,z,s.minY))),!(s.minY<=w.minBounds.minY&&a.minY>=w.maxBounds.minY));)s=s.withMinY(Math.min(s.minY,w.minBounds.minY)),a=a.withMinY(Math.max(a.minY,w.maxBounds.minY)),D=Math.max(D,w.maxBounds.minX),z=Math.min(z,w.maxBounds.maxX);for(D=a.minX,z=a.maxX;isFinite(s.maxY)&&isFinite(a.maxY)&&Math.abs(s.maxY-a.maxY)>t&&(w=c(y(new Bounds2(D,s.maxY,z,a.maxY))),!(s.maxY>=w.minBounds.maxY&&a.maxY<=w.maxBounds.maxY));)s=s.withMaxY(Math.max(s.maxY,w.minBounds.maxY)),a=a.withMaxY(Math.min(a.maxY,w.maxBounds.maxY)),D=Math.max(D,w.maxBounds.minX),z=Math.min(z,w.maxBounds.maxX);const N=new Bounds2(isFinite(s.minX)&&isFinite(a.minX)?(s.minX+a.minX)/2:Number.POSITIVE_INFINITY,isFinite(s.minY)&&isFinite(a.minY)?(s.minY+a.minY)/2:Number.POSITIVE_INFINITY,isFinite(s.maxX)&&isFinite(a.maxX)?(s.maxX+a.maxX)/2:Number.NEGATIVE_INFINITY,isFinite(s.maxY)&&isFinite(a.maxY)?(s.maxY+a.maxY)/2:Number.NEGATIVE_INFINITY);return N.minBounds=s,N.maxBounds=a,N.isConsistent=a.containsBounds(s),N.precision=Math.max(Math.abs(s.minX-a.minX),Math.abs(s.minY-a.minY),Math.abs(s.maxX-a.maxX),Math.abs(s.maxY-a.maxY)),N},toPowerOf2(o){let e=1;for(;e<o;)e*=2;return e},createShader(o,e,t){const n=o.createShader(t);return o.shaderSource(n,e),o.compileShader(n),o.getShaderParameter(n,o.COMPILE_STATUS)||(console.log("GLSL compile error:"),console.log(o.getShaderInfoLog(n)),console.log(e)),n},applyWebGLContextDefaults(o){o.clearColor(0,0,0,0),o.enable(o.BLEND),o.blendFunc(o.ONE,o.ONE_MINUS_SRC_ALPHA)},setWebGLEnabled(o){webglEnabled=o},checkWebGLSupport(o){if(!webglEnabled)return!1;const e=document.createElement("canvas"),t={failIfMajorPerformanceCaveat:!0};try{const n=!!window.WebGLRenderingContext&&(e.getContext("webgl",t)||e.getContext("experimental-webgl",t));if(!n)return!1;if(o){for(let r=0;r<o.length;r++)if(n.getExtension(o[r])===null)return!1}return!0}catch{return!1}},checkIE11StencilSupport(){const o=document.createElement("canvas");try{const e=!!window.WebGLRenderingContext&&(o.getContext("webgl")||o.getContext("experimental-webgl"));return e?(e.clearStencil(0),e.getError()===0):!1}catch{return!1}},get isWebGLSupported(){return _extensionlessWebGLSupport===void 0&&(_extensionlessWebGLSupport=Utils.checkWebGLSupport()),_extensionlessWebGLSupport},loseContext(o){const e=o.getExtension("WEBGL_lose_context");e&&(e.loseContext(),setTimeout(()=>{e.restoreContext()},1e3))},safariEmbeddingMarkWorkaround(o){if(platform.safari){const e=o.split("");let t="",n=!1;for(let r=0;r<e.length;r++){const s=e[r],a=s==="‪"||s==="‫"||s==="‬";n&&a&&(t+="​"),t+=s,n=a}return t}else return o}};scenery.register("Utils",Utils);const Th=class Th{constructor(e,t){this.display=e,this.trail=t}};Th.FocusIO=new IOType("FocusIO",{valueType:Th,documentation:"A PhET-iO Type for the instance in the simulation which currently has keyboard focus. FocusIO is serialized into and Object with key `focusedPhetioElement` that is a list of PhET-iO Elements, from parent-most to child-most corresponding to the PhET-iO Element that was instrumented.",toStateObject:e=>{const t=[];return e.trail.nodes.forEach((n,r)=>{n.isPhetioInstrumented()&&t.push(n.tandem.phetioID)}),{focusedPhetioElement:t}},stateSchema:{focusedPhetioElement:ArrayIO(StringIO)}});let Focus=Th;scenery.register("Focus",Focus);const KEY_RIGHT_ARROW="ArrowRight",KEY_LEFT_ARROW="ArrowLeft",KEY_UP_ARROW="ArrowUp",KEY_DOWN_ARROW="ArrowDown",KEY_SHIFT_RIGHT="ShiftRight",KEY_SHIFT_LEFT="ShiftLeft",KEY_CONTROL_LEFT="ControlLeft",KEY_CONTROL_RIGHT="ControlRight",KEY_ALT_LEFT="AltLeft",KEY_ALT_RIGHT="AltRight",KEY_META_LEFT="MetaLeft",KEY_META_RIGHT="MetaRight",KEY_META_LEFT_FIREFOX="OSLeft",KEY_META_RIGHT_FIREFOX="OSRight",KEY_W="KeyW",KEY_A="KeyA",KEY_S="KeyS",KEY_D="KeyD",KEY_0="Digit0",KEY_1="Digit1",KEY_2="Digit2",KEY_3="Digit3",KEY_4="Digit4",KEY_5="Digit5",KEY_6="Digit6",KEY_7="Digit7",KEY_8="Digit8",KEY_9="Digit9",KEY_ALT="Alt",KEY_SHIFT="Shift",KEY_CONTROL="Control",ARROW_KEYS=[KEY_RIGHT_ARROW,KEY_LEFT_ARROW,KEY_UP_ARROW,KEY_DOWN_ARROW],WASD_KEYS=[KEY_W,KEY_S,KEY_A,KEY_D],NUMBER_KEYS=[KEY_0,KEY_1,KEY_2,KEY_3,KEY_4,KEY_5,KEY_6,KEY_7,KEY_8,KEY_9],SHIFT_KEYS=[KEY_SHIFT_LEFT,KEY_SHIFT_RIGHT],CONTROL_KEYS=[KEY_CONTROL_LEFT,KEY_CONTROL_RIGHT],ALT_KEYS=[KEY_ALT_LEFT,KEY_ALT_RIGHT],META_KEYS=[KEY_META_LEFT,KEY_META_RIGHT,KEY_META_LEFT_FIREFOX,KEY_META_RIGHT_FIREFOX],MODIFIER_KEYS=[KEY_ALT,KEY_CONTROL,KEY_SHIFT],MODIFIER_KEY_CODES=[KEY_ALT_LEFT,KEY_ALT_RIGHT,KEY_CONTROL_LEFT,KEY_CONTROL_RIGHT,KEY_SHIFT_LEFT,KEY_SHIFT_RIGHT,KEY_META_LEFT,KEY_META_RIGHT,KEY_META_LEFT_FIREFOX,KEY_META_RIGHT_FIREFOX],DOM_EVENT_VALIDATOR={valueType:Event},ALL_KEY_CODES=[],KeyboardUtils={KEY_SPACE:"Space",KEY_ENTER:"Enter",KEY_TAB:"Tab",KEY_RIGHT_ARROW,KEY_LEFT_ARROW,KEY_UP_ARROW,KEY_DOWN_ARROW,KEY_SHIFT_LEFT,KEY_SHIFT_RIGHT,KEY_ALT_LEFT,KEY_ALT_RIGHT,KEY_CONTROL_LEFT,KEY_CONTROL_RIGHT,KEY_META_LEFT,KEY_META_RIGHT,KEY_META_LEFT_FIREFOX,KEY_META_RIGHT_FIREFOX,KEY_SHIFT,KEY_ALT,KEY_CONTROL,KEY_ESCAPE:"Escape",KEY_DELETE:"Delete",KEY_BACKSPACE:"Backspace",KEY_PAGE_UP:"PageUp",KEY_PAGE_DOWN:"PageDown",KEY_END:"End",KEY_HOME:"Home",KEY_0,KEY_1,KEY_2,KEY_3,KEY_4,KEY_5,KEY_6,KEY_7,KEY_8,KEY_9,KEY_NUMPAD_0:"Numpad0",KEY_NUMPAD_1:"Numpad1",KEY_NUMPAD_2:"Numpad2",KEY_NUMPAD_3:"Numpad3",KEY_NUMPAD_4:"Numpad4",KEY_NUMPAD_5:"Numpad5",KEY_NUMPAD_6:"Numpad6",KEY_NUMPAD_7:"Numpad7",KEY_NUMPAD_8:"Numpad8",KEY_NUMPAD_9:"Numpad9",KEY_NUMPAD_DECIMAL:"NumpadDecimal",KEY_NUMPAD_PLUS:"NumpadAdd",KEY_NUMPAD_MINUS:"NumpadSubtract",KEY_A:"KeyA",KEY_B:"KeyB",KEY_C:"KeyC",KEY_D:"KeyD",KEY_E:"KeyE",KEY_F:"KeyF",KEY_G:"KeyG",KEY_H:"KeyH",KEY_I:"KeyI",KEY_J:"KeyJ",KEY_K:"KeyK",KEY_L:"KeyL",KEY_M:"KeyM",KEY_N:"KeyN",KEY_O:"KeyO",KEY_P:"KeyP",KEY_Q:"KeyQ",KEY_R:"KeyR",KEY_S:"KeyS",KEY_T:"KeyT",KEY_U:"KeyU",KEY_V:"KeyV",KEY_W:"KeyW",KEY_X:"KeyX",KEY_Y:"KeyY",KEY_Z:"KeyZ",KEY_EQUALS:"Equal",KEY_PLUS:"Equal",KEY_MINUS:"Minus",KEY_PERIOD:"Period",ARROW_KEYS,WASD_KEYS,MOVEMENT_KEYS:ARROW_KEYS.concat(WASD_KEYS),SHIFT_KEYS,CONTROL_KEYS,ALT_KEYS,META_KEYS,MODIFIER_KEY_CODES,MODIFIER_KEY_TO_CODE_MAP:new Map([[KEY_ALT,ALT_KEYS],[KEY_SHIFT,SHIFT_KEYS],[KEY_CONTROL,CONTROL_KEYS]]),isArrowKey(o){return KeyboardUtils.isAnyKeyEvent(o,ARROW_KEYS)},isRangeKey(o){return KeyboardUtils.isArrowKey(o)||KeyboardUtils.isAnyKeyEvent(o,[KeyboardUtils.KEY_PAGE_UP,KeyboardUtils.KEY_PAGE_DOWN,KeyboardUtils.KEY_HOME,KeyboardUtils.KEY_END])},isNumberKey(o){return KeyboardUtils.isAnyKeyEvent(o,NUMBER_KEYS)},getNumberFromCode(o){return KeyboardUtils.isNumberKey(o)&&o instanceof KeyboardEvent?Number(o.code.replace("Digit","")):null},isShiftKey(o){return KeyboardUtils.isAnyKeyEvent(o,SHIFT_KEYS)},isAltKey(o){return KeyboardUtils.isAnyKeyEvent(o,ALT_KEYS)},isControlKey(o){return KeyboardUtils.isAnyKeyEvent(o,CONTROL_KEYS)},isMetaKey(o){return KeyboardUtils.isAnyKeyEvent(o,META_KEYS)},isWASDKey(o){return KeyboardUtils.isAnyKeyEvent(o,WASD_KEYS)},isMovementKey(o){return KeyboardUtils.isAnyKeyEvent(o,KeyboardUtils.MOVEMENT_KEYS)},isAnyKeyEvent(o,e){validate(o,DOM_EVENT_VALIDATOR);const t=KeyboardUtils.getEventCode(o);return t?e.includes(t):!1},isKeyEvent(o,e){return KeyboardUtils.getEventCode(o)===e},getEventCode(o){let e=null;return o instanceof KeyboardEvent&&o.code&&(e=o.code,e.startsWith("Numpad")&&ALL_KEY_CODES.includes(o.key)&&(e=o.key)),e},isModifierKey(o){return MODIFIER_KEYS.includes(o)},ALL_KEYS:ALL_KEY_CODES};for(const o in KeyboardUtils)KeyboardUtils.hasOwnProperty(o)&&typeof KeyboardUtils[o]=="string"&&ALL_KEY_CODES.push(KeyboardUtils[o]);scenery.register("KeyboardUtils",KeyboardUtils);const EnglishStringToCodeMap={q:[KeyboardUtils.KEY_Q],w:[KeyboardUtils.KEY_W],e:[KeyboardUtils.KEY_E],r:[KeyboardUtils.KEY_R],t:[KeyboardUtils.KEY_T],y:[KeyboardUtils.KEY_Y],u:[KeyboardUtils.KEY_U],i:[KeyboardUtils.KEY_I],o:[KeyboardUtils.KEY_O],p:[KeyboardUtils.KEY_P],a:[KeyboardUtils.KEY_A],s:[KeyboardUtils.KEY_S],d:[KeyboardUtils.KEY_D],f:[KeyboardUtils.KEY_F],g:[KeyboardUtils.KEY_G],h:[KeyboardUtils.KEY_H],j:[KeyboardUtils.KEY_J],k:[KeyboardUtils.KEY_K],l:[KeyboardUtils.KEY_L],z:[KeyboardUtils.KEY_Z],x:[KeyboardUtils.KEY_X],c:[KeyboardUtils.KEY_C],v:[KeyboardUtils.KEY_V],b:[KeyboardUtils.KEY_B],n:[KeyboardUtils.KEY_N],m:[KeyboardUtils.KEY_M],0:[KeyboardUtils.KEY_0,KeyboardUtils.KEY_NUMPAD_0],1:[KeyboardUtils.KEY_1,KeyboardUtils.KEY_NUMPAD_1],2:[KeyboardUtils.KEY_2,KeyboardUtils.KEY_NUMPAD_2],3:[KeyboardUtils.KEY_3,KeyboardUtils.KEY_NUMPAD_3],4:[KeyboardUtils.KEY_4,KeyboardUtils.KEY_NUMPAD_4],5:[KeyboardUtils.KEY_5,KeyboardUtils.KEY_NUMPAD_5],6:[KeyboardUtils.KEY_6,KeyboardUtils.KEY_NUMPAD_6],7:[KeyboardUtils.KEY_7,KeyboardUtils.KEY_NUMPAD_7],8:[KeyboardUtils.KEY_8,KeyboardUtils.KEY_NUMPAD_8],9:[KeyboardUtils.KEY_9,KeyboardUtils.KEY_NUMPAD_9],enter:[KeyboardUtils.KEY_ENTER],tab:[KeyboardUtils.KEY_TAB],equals:[KeyboardUtils.KEY_EQUALS],plus:[KeyboardUtils.KEY_PLUS,KeyboardUtils.KEY_NUMPAD_PLUS],minus:[KeyboardUtils.KEY_MINUS,KeyboardUtils.KEY_NUMPAD_MINUS],period:[KeyboardUtils.KEY_PERIOD,KeyboardUtils.KEY_NUMPAD_DECIMAL],escape:[KeyboardUtils.KEY_ESCAPE],delete:[KeyboardUtils.KEY_DELETE],backspace:[KeyboardUtils.KEY_BACKSPACE],pageUp:[KeyboardUtils.KEY_PAGE_UP],pageDown:[KeyboardUtils.KEY_PAGE_DOWN],end:[KeyboardUtils.KEY_END],home:[KeyboardUtils.KEY_HOME],space:[KeyboardUtils.KEY_SPACE],arrowLeft:[KeyboardUtils.KEY_LEFT_ARROW],arrowRight:[KeyboardUtils.KEY_RIGHT_ARROW],arrowUp:[KeyboardUtils.KEY_UP_ARROW],arrowDown:[KeyboardUtils.KEY_DOWN_ARROW],ctrl:[KeyboardUtils.KEY_CONTROL_LEFT,KeyboardUtils.KEY_CONTROL_RIGHT],alt:[KeyboardUtils.KEY_ALT_LEFT,KeyboardUtils.KEY_ALT_RIGHT],shift:[KeyboardUtils.KEY_SHIFT_LEFT,KeyboardUtils.KEY_SHIFT_RIGHT]};scenery.register("EnglishStringToCodeMap",EnglishStringToCodeMap);const noExtraPrototype=o=>Object.getPrototypeOf(o)===Object.prototype,ObjectLiteralIO=new IOType("ObjectLiteralIO",{documentation:"PhET-iO Type for object literals",isValidValue:noExtraPrototype,supertype:ValueIO,stateSchema:StateSchema.asValue("object",{valueType:Object,isValidValue:noExtraPrototype}),toStateObject:_.identity});tandemNamespace.register("ObjectLiteralIO",ObjectLiteralIO);const EventIO=new IOType("EventIO",{valueType:window.Event,documentation:"A DOM Event",toStateObject:o=>Input.serializeDomEvent(o),fromStateObject:o=>Input.deserializeDomEvent(o),stateSchema:()=>({constructorName:StringIO,altKey:NullableIO(BooleanIO),button:NullableIO(NumberIO),charCode:NullableIO(NumberIO),clientX:NullableIO(NumberIO),clientY:NullableIO(NumberIO),code:NullableIO(StringIO),ctrlKey:NullableIO(BooleanIO),deltaMode:NullableIO(NumberIO),deltaX:NullableIO(NumberIO),deltaY:NullableIO(NumberIO),deltaZ:NullableIO(NumberIO),key:NullableIO(StringIO),keyCode:NullableIO(NumberIO),metaKey:NullableIO(BooleanIO),pageX:NullableIO(NumberIO),pageY:NullableIO(NumberIO),pointerId:NullableIO(NumberIO),pointerType:NullableIO(StringIO),scale:NullableIO(NumberIO),shiftKey:NullableIO(BooleanIO),target:NullableIO(ObjectLiteralIO),type:NullableIO(StringIO),relatedTarget:NullableIO(ObjectLiteralIO),which:NullableIO(NumberIO)})});scenery.register("EventIO",EventIO);const styleElement=document.createElement("style");styleElement.type="text/css";document.head.appendChild(styleElement);const stylesheet=document.styleSheets[document.styleSheets.length-1];assert&&assert(stylesheet.disabled===!1);const SceneryStyle={stylesheet,styleElement,addRule(o){this.stylesheet.insertRule(o,0)}};scenery.register("SceneryStyle",SceneryStyle);class CanvasContextWrapper{constructor(e,t){this.canvas=e,this.context=t,this.resetStyles()}resetStyles(){this.fillStyle=void 0,this.strokeStyle=void 0,this.lineWidth=void 0,this.lineCap=void 0,this.lineJoin=void 0,this.lineDash=void 0,this.lineDashOffset=void 0,this.miterLimit=void 0,this.font=void 0,this.direction=void 0}setDimensions(e,t){this.canvas.width=e,this.canvas.height=t,this.resetStyles()}setFillStyle(e){e&&isTReadOnlyProperty(e)&&(e=e.value),e&&e.getCanvasStyle&&(e=e.getCanvasStyle()),this.fillStyle!==e&&(this.fillStyle=e,this.context.fillStyle=e)}setStrokeStyle(e){e&&isTReadOnlyProperty(e)&&(e=e.value),e&&e.getCanvasStyle&&(e=e.getCanvasStyle()),this.strokeStyle!==e&&(this.strokeStyle=e,this.context.strokeStyle=e)}setLineWidth(e){this.lineWidth!==e&&(this.lineWidth=e,this.context.lineWidth=e)}setLineCap(e){this.lineCap!==e&&(this.lineCap=e,this.context.lineCap=e)}setLineJoin(e){this.lineJoin!==e&&(this.lineJoin=e,this.context.lineJoin=e)}setMiterLimit(e){assert&&assert(typeof e=="number"),this.miterLimit!==e&&(this.miterLimit=e,this.context.miterLimit=e)}setLineDash(e){assert&&assert(e!==void 0,"undefined line dash would cause hard-to-trace errors"),this.lineDash!==e&&(this.lineDash=e,this.context.setLineDash?this.context.setLineDash(e===null?[]:e):this.context.mozDash!==void 0?this.context.mozDash=e:this.context.webkitLineDash!==void 0&&(this.context.webkitLineDash=e||[]))}setLineDashOffset(e){this.lineDashOffset!==e&&(this.lineDashOffset=e,this.context.lineDashOffset!==void 0?this.context.lineDashOffset=e:this.context.webkitLineDashOffset!==void 0&&(this.context.webkitLineDashOffset=e))}setFont(e){this.font!==e&&(this.font=e,this.context.font=e)}setDirection(e){this.direction!==e&&(this.direction=e,this.context.direction=e)}}scenery.register("CanvasContextWrapper",CanvasContextWrapper);const exitFullscreenPropertyName=detectPrefix(document,"exitFullscreen")||detectPrefix(document,"cancelFullScreen"),fullscreenElementPropertyName=detectPrefix(document,"fullscreenElement")||detectPrefix(document,"fullScreenElement"),fullscreenEnabledPropertyName=detectPrefix(document,"fullscreenEnabled")||detectPrefix(document,"fullScreenEnabled");let fullscreenChangeEvent=detectPrefixEvent(document,"fullscreenchange");fullscreenChangeEvent==="msfullscreenchange"&&(fullscreenChangeEvent="MSFullscreenChange");const FullScreen={isFullScreen(){return!!document[fullscreenElementPropertyName]},isFullScreenEnabled(){return document[fullscreenEnabledPropertyName]&&!platform.safari7},enterFullScreen(o){const e=detectPrefix(document.body,"requestFullscreen")||detectPrefix(document.body,"requestFullScreen");o.domElement[e]&&o.domElement[e]()},exitFullScreen(){document[exitFullscreenPropertyName]&&document[exitFullscreenPropertyName]()},toggleFullScreen(o){FullScreen.isFullScreen()?FullScreen.exitFullScreen():FullScreen.enterFullScreen(o)},isFullScreenProperty:new Property(!1)};document.addEventListener(fullscreenChangeEvent,o=>{FullScreen.isFullScreenProperty.set(FullScreen.isFullScreen())});scenery.register("FullScreen",FullScreen);const FullScreen$1=FullScreen;class CountMap{constructor(e,t){this.create=e,this.destroy=t,this.map=new Map}increment(e,t=1){if(assert&&assert(typeof t=="number"),assert&&assert(t>=1),this.map.has(e))this.map.get(e).count+=t;else{const n=this.create(e),r=CountMapEntry.createFromPool(t,e,n);this.map.set(e,r)}}decrement(e,t=1){assert&&assert(typeof t=="number"),assert&&assert(t>=1);const n=this.map.get(e);n&&(n.count-=t,n.count<1&&(this.destroy(e,n.value),this.map.delete(e),n.dispose()))}get(e){return this.map.get(e).value}clear(){this.map.clear()}}class CountMapEntry{constructor(e,t,n){this.initialize(e,t,n)}initialize(e,t,n){this.count=e,this.key=t,this.value=n}dispose(){this.key=null,this.value=null,this.freeToPool()}}Poolable.mixInto(CountMapEntry,{initialize:CountMapEntry.prototype.initialize});scenery.register("CountMap",CountMap);class DisplayedProperty extends BooleanProperty{constructor(e,t){t=merge({display:null},t),super(!1,t),this.node=e,this.display=t.display,this.updateListener=this.updateValue.bind(this),this.changedInstanceListener=this.changedInstance.bind(this),e.changedInstanceEmitter.addListener(this.changedInstanceListener);const n=e.instances;for(let r=0;r<n.length;r++)this.changedInstance(n[r],!0)}updateValue(){this.value=this.node.wasVisuallyDisplayed(this.display)}changedInstance(e,t){t?e.visibleEmitter.addListener(this.updateListener):e.visibleEmitter.removeListener(this.updateListener),this.updateValue()}dispose(){const e=this.node.instances;for(let t=0;t<e.length;t++)this.changedInstance(e[t],!1);this.node.changedInstanceEmitter.removeListener(this.changedInstanceListener),super.dispose()}}scenery.register("DisplayedProperty",DisplayedProperty);class SceneImage{constructor(e){this.scene=e,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.img=document.createElement("img"),this.update()}update(e){this.scene.updateScene(),this.canvas.width=this.scene.getSceneWidth(),this.canvas.height=this.scene.getSceneHeight(),this.scene.renderToCanvas(this.canvas,this.context,()=>{const t=this.toDataURL();this.img.onload=()=>{e(),delete this.img.onload},this.img.src=t})}}scenery.register("SceneImage",SceneImage);var ud,cd,dd,pd,fd;const allowLinksProperty=new BooleanProperty(!((cd=(ud=window==null?void 0:window.phet)==null?void 0:ud.chipper)!=null&&cd.queryParameters)||((fd=(pd=(dd=window==null?void 0:window.phet)==null?void 0:dd.chipper)==null?void 0:pd.queryParameters)==null?void 0:fd.allowLinks),{tandem:Tandem.GENERAL_MODEL.createTandem("allowLinksProperty")});scenery.register("allowLinksProperty",allowLinksProperty);function openPopup(o,e=allowLinksProperty.value){const t=phet&&phet.chipper&&phet.chipper.isFuzzEnabled();if(e&&!t){const n=window.open(o,"_blank");n&&n.focus()}}scenery.register("openPopup",openPopup);const getLineBreakRanges=(o,e)=>{const t=optionize()({requiredOnly:!1},e),n=[],r=new LineBreaker(o);r[Symbol.iterator]=()=>({next(){const a=r.nextBreak();return a!==null?{value:a,done:!1}:{done:!0}}});let s=0;for(const a of r){const l=a.position;t.requiredOnly&&!a.required||(s!==l&&n.push(new Range(s,l)),s=a.position)}return s<o.length&&n.push(new Range(s,o.length)),n};scenery.register("getLineBreakRanges",getLineBreakRanges);const kite=new Namespace("kite"),lineLineIntersection=DotUtils.lineLineIntersection,DEFAULT_OPTIONS$8={lineWidth:1,lineCap:"butt",lineJoin:"miter",lineDash:[],lineDashOffset:0,miterLimit:10};class LineStyles{constructor(e){const t=merge({},DEFAULT_OPTIONS$8,e);this.lineWidth=t.lineWidth,this.lineCap=t.lineCap,this.lineJoin=t.lineJoin,this.lineDash=t.lineDash,this.lineDashOffset=t.lineDashOffset,this.miterLimit=t.miterLimit,assert&&assert(typeof this.lineWidth=="number",`lineWidth should be a number: ${this.lineWidth}`),assert&&assert(isFinite(this.lineWidth),`lineWidth should be a finite number: ${this.lineWidth}`),assert&&assert(this.lineWidth>=0,`lineWidth should be non-negative: ${this.lineWidth}`),assert&&assert(this.lineCap==="butt"||this.lineCap==="round"||this.lineCap==="square",`Invalid lineCap: ${this.lineCap}`),assert&&assert(this.lineJoin==="miter"||this.lineJoin==="round"||this.lineJoin==="bevel",`Invalid lineJoin: ${this.lineJoin}`),assert&&assert(Array.isArray(this.lineDash),`lineDash should be an array: ${this.lineDash}`),assert&&assert(_.every(this.lineDash,n=>typeof n=="number"&&isFinite(n)&&n>=0),`Every lineDash should be a non-negative finite number: ${this.lineDash}`),assert&&assert(typeof this.lineDashOffset=="number",`lineDashOffset should be a number: ${this.lineDashOffset}`),assert&&assert(isFinite(this.lineDashOffset),`lineDashOffset should be a finite number: ${this.lineDashOffset}`),assert&&assert(typeof this.miterLimit=="number",`miterLimit should be a number: ${this.miterLimit}`),assert&&assert(isFinite(this.miterLimit),`miterLimit should be a finite number: ${this.miterLimit}`)}equals(e){if(!(this.lineWidth===e.lineWidth&&this.lineCap===e.lineCap&&this.lineJoin===e.lineJoin&&this.miterLimit===e.miterLimit&&this.lineDashOffset===e.lineDashOffset))return!1;if(this.lineDash.length===e.lineDash.length){for(let n=0;n<this.lineDash.length;n++)if(this.lineDash[n]!==e.lineDash[n])return!1}else return!1;return!0}copy(){return new LineStyles({lineWidth:this.lineWidth,lineCap:this.lineCap,lineJoin:this.lineJoin,lineDash:this.lineDash,lineDashOffset:this.lineDashOffset,miterLimit:this.miterLimit})}leftJoin(e,t,n){t=t.normalized(),n=n.normalized();const r=e.plus(t.perpendicular.negated().times(this.lineWidth/2)),s=e.plus(n.perpendicular.negated().times(this.lineWidth/2)),a=r.equals(s)?[]:[new Line$1(r,s)];let l,d,c;if(t.perpendicular.dot(n)>1e-12)switch(this.lineJoin){case"round":return l=t.angle+Math.PI/2,d=n.angle+Math.PI/2,[new Arc(e,this.lineWidth/2,l,d,!0)];case"miter":if(c=t.angleBetween(n.negated()),1/Math.sin(c/2)<=this.miterLimit&&c<Math.PI-1e-5){const y=lineLineIntersection(r,r.plus(t),s,s.plus(n));return y?[new Line$1(r,y),new Line$1(y,s)]:[new Line$1(r,s)]}else return a;case"bevel":return a;default:throw new Error(`invalid lineJoin: ${this.lineJoin}`)}else return a}rightJoin(e,t,n){return this.leftJoin(e,n.negated(),t.negated())}cap(e,t){t=t.normalized();const n=e.plus(t.perpendicular.times(-this.lineWidth/2)),r=e.plus(t.perpendicular.times(this.lineWidth/2));let s,a,l,d,c,y;switch(this.lineCap){case"butt":return[new Line$1(n,r)];case"round":return s=t.angle,[new Arc(e,this.lineWidth/2,s+Math.PI/2,s-Math.PI/2,!0)];case"square":return a=t.perpendicular.negated().times(this.lineWidth/2),l=t.perpendicular.times(this.lineWidth/2),d=t.times(this.lineWidth/2),c=e.plus(a).plus(d),y=e.plus(l).plus(d),[new Line$1(n,c),new Line$1(c,y),new Line$1(y,r)];default:throw new Error(`invalid lineCap: ${this.lineCap}`)}}}kite.register("LineStyles",LineStyles);class Overlap{constructor(e,t){assert&&assert(isFinite(e)&&e!==0,"a should be a finite non-zero number"),assert&&assert(isFinite(t),"b should be a finite number"),this.a=e,this.b=t;let n=0,r=1,s=this.apply(n),a=this.apply(r);s>1&&(s=1,n=this.applyInverse(s)),s<0&&(s=0,n=this.applyInverse(s)),a>1&&(a=1,r=this.applyInverse(a)),a<0&&(a=0,r=this.applyInverse(a)),this.t0=n,this.t1=r,e>0?(this.qt0=s,this.qt1=a):(this.qt0=a,this.qt1=s),this.t0<0&&this.t0>-1e-8&&(this.t0=0),this.t0>1&&this.t0<1+1e-8&&(this.t0=1),this.t1<0&&this.t1>-1e-8&&(this.t1=0),this.t1>1&&this.t1<1+1e-8&&(this.t1=1),this.qt0<0&&this.qt0>-1e-8&&(this.qt0=0),this.qt0>1&&this.qt0<1+1e-8&&(this.qt0=1),this.qt1<0&&this.qt1>-1e-8&&(this.qt1=0),this.qt1>1&&this.qt1<1+1e-8&&(this.qt1=1),assert&&assert(this.t0>=0&&this.t0<=1,`t0 out of range: ${this.t0}`),assert&&assert(this.t1>=0&&this.t1<=1,`t1 out of range: ${this.t1}`),assert&&assert(this.qt0>=0&&this.qt0<=1,`qt0 out of range: ${this.qt0}`),assert&&assert(this.qt1>=0&&this.qt1<=1,`qt1 out of range: ${this.qt1}`)}apply(e){return this.a*e+this.b}applyInverse(e){return(e-this.b)/this.a}static createLinear(e,t,n,r){const s=(r-t)/(n-e);return new Overlap(s,t-e*s)}}kite.register("Overlap",Overlap);class RayIntersection{constructor(e,t,n,r,s){assert&&assert(isFinite(e)&&e>=0,"invalid distance"),assert&&assert(Math.abs(n.magnitude-1)<1e-7,"invalid normal"),assert&&assert(s>=-1e-10&&s<=1+1e-10,`t out of range: ${s}`),this.point=t,this.normal=n,this.distance=e,this.wind=r,this.t=DotUtils.clamp(s,0,1)}}kite.register("RayIntersection",RayIntersection);class SegmentIntersection{constructor(e,t,n){assert&&assert(t>=-1e-10&&t<=1+1e-10,"aT out of range"),assert&&assert(n>=-1e-10&&n<=1+1e-10,"bT out of range"),this.point=e,this.aT=DotUtils.clamp(t,0,1),this.bT=DotUtils.clamp(n,0,1)}getSwapped(){return new SegmentIntersection(this.point,this.bT,this.aT)}}kite.register("SegmentIntersection",SegmentIntersection);const svgNumber=o=>o.toFixed(20);kite.register("svgNumber",svgNumber);const getDet2=(o,e,t,n)=>o.times(n).minus(e.times(t)),getDeterminant=o=>{const e=o[0],t=o[1],n=o[2],r=o[3],s=o[4],a=o[5],l=o[6],d=o[7],c=o[8];return e.times(s).times(c).plus(t.times(a).times(l)).plus(n.times(r).times(d)).minus(n.times(s).times(l)).minus(t.times(r).times(c)).minus(e.times(a).times(d))},getAdjugateMatrix=o=>{const e=o[0],t=o[1],n=o[2],r=o[3],s=o[4],a=o[5],l=o[6],d=o[7],c=o[8];return[getDet2(s,a,d,c),getDet2(t,n,d,c).negate(),getDet2(t,n,s,a),getDet2(r,a,l,c).negate(),getDet2(e,n,l,c),getDet2(e,n,r,a).negate(),getDet2(r,s,l,d),getDet2(e,t,l,d).negate(),getDet2(e,t,r,s)]},getTranspose=o=>[o[0],o[3],o[6],o[1],o[4],o[7],o[2],o[5],o[8]],getNonzeroRow=(o,e=!1)=>_.sortBy([o.slice(0,3),o.slice(3,6),o.slice(6,9)],t=>-(t[0].magnitude+t[1].magnitude+(e?t[2].magnitude:0)))[0],getNonzeroColumn=(o,e=!1)=>getNonzeroRow(getTranspose(o),e),getAntiSymmetricMatrix=o=>{const e=getAdjugateMatrix(o),t=getNonzeroRow(e);return[Complex.ZERO,t[2],t[1].negated(),t[2].negated(),Complex.ZERO,t[0],t[1],t[0].negated(),Complex.ZERO]},computeAlpha=(o,e)=>{const t=o[0],n=o[1],r=o[3],s=o[4],a=e[0],l=e[1],d=e[3],c=e[4],y=l.times(d).minus(a.times(c)),m=c.negated().times(t).plus(d.times(n)).plus(l.times(r)).minus(a.times(s)),O=n.times(r).minus(t.times(s)),D=Complex.solveQuadraticRoots(y,m,O);return D===null?null:D[0]},getRank1DegenerateConicMatrix=o=>{const e=getAntiSymmetricMatrix(o),t=computeAlpha(o,e);return t===null?o:[o[0].plus(t.times(e[0])),o[1].plus(t.times(e[1])),o[2].plus(t.times(e[2])),o[3].plus(t.times(e[3])),o[4].plus(t.times(e[4])),o[5].plus(t.times(e[5])),o[6].plus(t.times(e[6])),o[7].plus(t.times(e[7])),o[8].plus(t.times(e[8]))]},getRealIntersectionsForDegenerateConic=o=>{const e=[],t=o[0],n=o[1].times(Complex.real(2)),r=o[4],s=o[2].times(Complex.real(2)),a=o[5].times(Complex.real(2)),l=o[8];let d=[];const c=new Complex(-2.51653525696959,1.5292850284402),y=r,m=n.times(c).plus(a),O=t.times(c).times(c).plus(s.times(c)).plus(l),D=Complex.solveQuadraticRoots(y,m,O);if(D&&D.length>=2)d=[[c,D[0]],[c,D[1]]];else{const z=t,w=n.times(c).plus(s),N=r.times(c).times(c).plus(a.times(c)).plus(l),H=Complex.solveQuadraticRoots(z,w,N);if(H&&H.length>=2)d=[[H[0],c],[H[1],c]];else if(D&&D.length===1)d=[[c,D[0]]];else if(H&&H.length===1)d=[[H[0],c]];else throw new Error("Implement more advanced initialization to find two solutions")}return d.forEach(z=>{const w=z[0].real,N=z[1].real,H=z[0].imaginary,X=z[1].imaginary,ae=t.real,oe=n.real,ue=r.real,fe=s.real,be=a.real,Ae=t.imaginary,W=n.imaginary,J=r.imaginary,Ue=s.imaginary,gt=a.imaginary,Te=new Vector4(-2*Ae*H-W*X+fe+2*ae*w+oe*N,-W*H-2*J*X+be+oe*w+2*ue*N,-Ue-2*H*ae-X*oe-2*Ae*w-W*N,-gt-H*oe-2*X*ue-W*w-2*J*N),Et=new Vector4(Ue+2*H*ae+X*oe+2*Ae*w+W*N,gt+H*oe+2*X*ue+W*w+2*J*N,-2*Ae*H-W*X+fe+2*ae*w+oe*N,-W*H-2*J*X+be+oe*w+2*ue*N),Bt=new Vector4(6.1951068548253,-1.159268950386,.1602918829294,3.205818692048202),Ke=new Vector4(-5.420628549296924,-15.2069583028685,.159590602048868,5.10688288040682),At=(ti,Mi)=>Mi.timesScalar(ti.dot(Mi)/Mi.dot(Mi)),nt=Te,dt=Et.minus(At(Et,nt)),Mt=Bt.minus(At(Bt,nt)).minus(At(Bt,dt)),zt=Ke.minus(At(Ke,nt)).minus(At(Ke,dt)).minus(At(Ke,Mt)),xt=new Matrix$1(2,2,[Mt.z,zt.z,Mt.w,zt.w]),Gt=new SingularValueDecomposition(xt).getSingularValues();let yi=null;if(Math.abs(H)<1e-10&&Math.abs(X)<1e-10)yi=new Vector2(w,N);else{if(Math.abs(Gt[1])>1e-10){const ti=xt.solve(new Matrix$1(2,1,[-H,-X])).extractVector2(0);yi=new Vector2(w+ti.x*Mt.z+ti.y*zt.z,N+ti.x*Mt.w+ti.y*zt.w)}else if(Math.abs(Gt[0])>1e-10){const ti=Math.abs(Mt.z)+Math.abs(Mt.w)>Math.abs(zt.z)+Math.abs(zt.w)?Mt:zt,Mi=new Vector2(ti.z,ti.w),Li=new Vector2(H,X).dot(Mi)/Mi.dot(Mi),qi=new Vector4(w,N,H,X).minus(ti.timesScalar(Li));Math.abs(qi.z)<1e-8&&Math.abs(qi.w)<1e-8&&(yi=new Vector2(qi.x,qi.y))}else yi=null;if(yi){if(Math.abs(Gt[1])>1e-10)e.push(yi);else if(Math.abs(Gt[0])>1e-10){const ti=Math.abs(Mt.z)+Math.abs(Mt.w)>Math.abs(zt.z)+Math.abs(zt.w),Mi=ti?zt:Mt,Li=ti?Mt:zt,Pi=Math.abs(Li.z)>Math.abs(Li.w)?Mi.z/Li.z:Mi.w/Li.w,Oi=Li.timesScalar(Pi).minus(Mi);e.push(new Ray2(yi,new Vector2(Oi.x,Oi.y).normalized()))}}}}),e},getLinesForDegenerateConic=o=>{const e=getRank1DegenerateConicMatrix(o);return[getNonzeroRow(e),getNonzeroColumn(e)]},lineIntersect=(o,e)=>{const t=o[0],n=o[1],r=o[2],s=e[0],a=e[1],l=e[2],d=s.times(n).minus(t.times(a));if(d.equalsEpsilon(Complex.ZERO,1e-8))return null;{const c=a.times(r).minus(n.times(l)).dividedBy(d);let y;if(!n.equalsEpsilon(Complex.ZERO,1e-8))y=t.negated().times(c).minus(r).dividedBy(n);else if(!a.equalsEpsilon(Complex.ZERO,1e-8))y=s.negated().times(c).minus(l).dividedBy(a);else return null;return Math.abs(c.imaginary)<1e-8&&Math.abs(y.imaginary)<1e-8?new Vector2(c.real,y.real):null}},intersectConicMatrices=(o,e)=>{const t=o.m00(),n=o.m01(),r=o.m02(),s=o.m10(),a=o.m11(),l=o.m12(),d=o.m20(),c=o.m21(),y=o.m22(),m=e.m00(),O=e.m01(),D=e.m02(),z=e.m10(),w=e.m11(),N=e.m12(),H=e.m20(),X=e.m21(),ae=e.m22(),oe=-r*a*d+n*l*d+r*s*c-t*l*c-n*s*y+t*a*y,ue=-s*y*O+s*c*D+r*c*z-n*y*z-r*d*w+t*y*w+n*d*N-t*c*N+r*s*X+l*(-c*m+d*O+n*H-t*X)-n*s*ae+a*(y*m-d*D-r*H+t*ae),fe=-y*O*z+c*D*z+y*m*w-d*D*w-c*m*N+d*O*N+l*O*H-a*D*H-r*w*H+n*N*H-l*m*X+s*D*X+r*z*X-t*N*X+a*m*ae-s*O*ae-n*z*ae+t*w*ae,be=-D*w*H+O*N*H+D*z*X-m*N*X-O*z*ae+m*w*ae,Ae=Complex.solveCubicRoots(Complex.real(oe),Complex.real(ue),Complex.real(fe),Complex.real(be));if(!Ae||Ae.length===0)return{degenerateConicMatrices:[],intersectionCollections:[],points:[],lines:[]};const J=_.uniqWith(Ae,(Et,Bt)=>Et.equals(Bt)).map(Et=>[Complex.real(t).multiply(Et).add(Complex.real(m)),Complex.real(n).multiply(Et).add(Complex.real(O)),Complex.real(r).multiply(Et).add(Complex.real(D)),Complex.real(s).multiply(Et).add(Complex.real(z)),Complex.real(a).multiply(Et).add(Complex.real(w)),Complex.real(l).multiply(Et).add(Complex.real(N)),Complex.real(d).multiply(Et).add(Complex.real(H)),Complex.real(c).multiply(Et).add(Complex.real(X)),Complex.real(y).multiply(Et).add(Complex.real(ae))]);console.log("determinant magnitudes",J.map(Et=>getDeterminant(Et).magnitude));const Ue=[],gt=J.map(getLinesForDegenerateConic);console.log(gt);const Te=J.map(getRealIntersectionsForDegenerateConic);console.log(Te);for(let Et=0;Et<gt.length;Et++){const Bt=gt[Et],Ke=lineIntersect(Bt[0],Bt[1]);Ke&&Ue.push(Ke);for(let At=Et+1;At<gt.length;At++){const nt=gt[At],dt=[lineIntersect(Bt[0],nt[0]),lineIntersect(Bt[0],nt[1]),lineIntersect(Bt[1],nt[0]),lineIntersect(Bt[1],nt[1])];for(let Mt=0;Mt<4;Mt++){const zt=dt[Mt];zt&&Ue.push(zt)}}}return{points:Ue,degenerateConicMatrices:J,lines:_.flatten(gt),intersectionCollections:Te}};kite.register("intersectConicMatrices",intersectConicMatrices);function quote(o){return'"'+o.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}const result={parse:function(o,e){const t={svgPath:l,movetoDrawtoCommandGroups:d,movetoDrawtoCommandGroup:c,drawtoCommands:y,drawtoCommand:m,moveto:O,movetoArgumentSequence:D,closepath:z,lineto:w,linetoArgumentSequence:N,horizontalLineto:H,horizontalLinetoArgumentSequence:X,verticalLineto:ae,verticalLinetoArgumentSequence:oe,curveto:ue,curvetoArgumentSequence:fe,curvetoArgument:be,smoothCurveto:Ae,smoothCurvetoArgumentSequence:W,smoothCurvetoArgument:J,quadraticBezierCurveto:Ue,quadraticBezierCurvetoArgumentSequence:gt,quadraticBezierCurvetoArgument:Te,smoothQuadraticBezierCurveto:Et,smoothQuadraticBezierCurvetoArgumentSequence:Bt,ellipticalArc:Ke,ellipticalArcArgumentSequence:At,ellipticalArcArgument:nt,coordinatePair:dt,nonnegativeNumber:Mt,number:zt,flag:xt,commaWsp:Gt,comma:yi,floatingPointConstant:ti,fractionalConstant:Mi,exponent:Li,sign:qi,digitSequence:Pi,digit:Oi,wsp:$t};if(e!==void 0){if(t[e]===void 0)throw new Error("Invalid rule name: "+quote(e)+".")}else e="svgPath";let n=0,r=0,s=[];function a(q){n<r||(n>r&&(r=n,s=[]),s.push(q))}function l(){let q,Re,He,Ze,Xe,Pe;for(Xe=n,Pe=n,q=[],Re=$t();Re!==null;)q.push(Re),Re=$t();if(q!==null)if(Re=d(),Re=Re!==null?Re:"",Re!==null){for(He=[],Ze=$t();Ze!==null;)He.push(Ze),Ze=$t();He!==null?q=[q,Re,He]:(q=null,n=Pe)}else q=null,n=Pe;else q=null,n=Pe;return q!==null&&(q=function(Le,De){return De||[]}(Xe,q[1])),q===null&&(n=Xe),q}function d(){let q,Re,He,Ze,Xe;if(Ze=n,Xe=n,q=c(),q!==null){for(Re=[],He=$t();He!==null;)Re.push(He),He=$t();Re!==null?(He=d(),He!==null?q=[q,Re,He]:(q=null,n=Xe)):(q=null,n=Xe)}else q=null,n=Xe;return q!==null&&(q=function(Pe,Le,De){return Le.concat(De)}(Ze,q[0],q[2])),q===null&&(n=Ze),q===null&&(Ze=n,q=c(),q!==null&&(q=function(Pe,Le){return Le}(Ze,q)),q===null&&(n=Ze)),q}function c(){let q,Re,He,Ze,Xe;if(Ze=n,Xe=n,q=O(),q!==null){for(Re=[],He=$t();He!==null;)Re.push(He),He=$t();Re!==null?(He=y(),He=He!==null?He:"",He!==null?q=[q,Re,He]:(q=null,n=Xe)):(q=null,n=Xe)}else q=null,n=Xe;return q!==null&&(q=function(Pe,Le,De){return De.length?Le.concat(De):Le}(Ze,q[0],q[2])),q===null&&(n=Ze),q}function y(){let q,Re,He,Ze,Xe;if(Ze=n,Xe=n,q=m(),q!==null){for(Re=[],He=$t();He!==null;)Re.push(He),He=$t();Re!==null?(He=y(),He!==null?q=[q,Re,He]:(q=null,n=Xe)):(q=null,n=Xe)}else q=null,n=Xe;return q!==null&&(q=function(Pe,Le,De){return Le.concat(De)}(Ze,q[0],q[2])),q===null&&(n=Ze),q===null&&(Ze=n,q=m(),q!==null&&(q=function(Pe,Le){return Le}(Ze,q)),q===null&&(n=Ze)),q}function m(){let q;return q=z(),q===null&&(q=w(),q===null&&(q=H(),q===null&&(q=ae(),q===null&&(q=ue(),q===null&&(q=Ae(),q===null&&(q=Ue(),q===null&&(q=Et(),q===null&&(q=Ke())))))))),q}function O(){let q,Re,He,Ze,Xe;if(Ze=n,Xe=n,o.charCodeAt(n)===77?(q="M",n++):(q=null,a('"M"')),q!==null){for(Re=[],He=$t();He!==null;)Re.push(He),He=$t();Re!==null?(He=D(),He!==null?q=[q,Re,He]:(q=null,n=Xe)):(q=null,n=Xe)}else q=null,n=Xe;if(q!==null&&(q=function(Pe,Le){return hs(Le,!1)}(Ze,q[2])),q===null&&(n=Ze),q===null){if(Ze=n,Xe=n,o.charCodeAt(n)===109?(q="m",n++):(q=null,a('"m"')),q!==null){for(Re=[],He=$t();He!==null;)Re.push(He),He=$t();Re!==null?(He=D(),He!==null?q=[q,Re,He]:(q=null,n=Xe)):(q=null,n=Xe)}else q=null,n=Xe;q!==null&&(q=function(Pe,Le){return hs(Le,!0)}(Ze,q[2])),q===null&&(n=Ze)}return q}function D(){let q,Re,He,Ze,Xe;return Ze=n,Xe=n,q=dt(),q!==null?(Re=Gt(),Re=Re!==null?Re:"",Re!==null?(He=N(),He!==null?q=[q,Re,He]:(q=null,n=Xe)):(q=null,n=Xe)):(q=null,n=Xe),q!==null&&(q=function(Pe,Le,De){return[Le].concat(De)}(Ze,q[0],q[2])),q===null&&(n=Ze),q===null&&(Ze=n,q=dt(),q!==null&&(q=function(Pe,Le){return[Le]}(Ze,q)),q===null&&(n=Ze)),q}function z(){let q,Re;return Re=n,o.charCodeAt(n)===90?(q="Z",n++):(q=null,a('"Z"')),q===null&&(o.charCodeAt(n)===122?(q="z",n++):(q=null,a('"z"'))),q!==null&&(q=function(He,Ze){return{cmd:"close"}}()),q===null&&(n=Re),q}function w(){let q,Re,He,Ze,Xe;if(Ze=n,Xe=n,o.charCodeAt(n)===76?(q="L",n++):(q=null,a('"L"')),q!==null){for(Re=[],He=$t();He!==null;)Re.push(He),He=$t();Re!==null?(He=N(),He!==null?q=[q,Re,He]:(q=null,n=Xe)):(q=null,n=Xe)}else q=null,n=Xe;if(q!==null&&(q=function(Pe,Le){return Le.map(De=>({cmd:"lineTo",args:[De.x,De.y]}))}(Ze,q[2])),q===null&&(n=Ze),q===null){if(Ze=n,Xe=n,o.charCodeAt(n)===108?(q="l",n++):(q=null,a('"l"')),q!==null){for(Re=[],He=$t();He!==null;)Re.push(He),He=$t();Re!==null?(He=N(),He!==null?q=[q,Re,He]:(q=null,n=Xe)):(q=null,n=Xe)}else q=null,n=Xe;q!==null&&(q=function(Pe,Le){return Le.map(De=>({cmd:"lineToRelative",args:[De.x,De.y]}))}(Ze,q[2])),q===null&&(n=Ze)}return q}function N(){let q,Re,He,Ze,Xe;return Ze=n,Xe=n,q=dt(),q!==null?(Re=Gt(),Re=Re!==null?Re:"",Re!==null?(He=N(),He!==null?q=[q,Re,He]:(q=null,n=Xe)):(q=null,n=Xe)):(q=null,n=Xe),q!==null&&(q=function(Pe,Le,De){return[Le].concat(De)}(Ze,q[0],q[2])),q===null&&(n=Ze),q===null&&(Ze=n,q=dt(),q!==null&&(q=function(Pe,Le){return[Le]}(Ze,q)),q===null&&(n=Ze)),q}function H(){let q,Re,He,Ze,Xe;if(Ze=n,Xe=n,o.charCodeAt(n)===72?(q="H",n++):(q=null,a('"H"')),q!==null){for(Re=[],He=$t();He!==null;)Re.push(He),He=$t();Re!==null?(He=X(),He!==null?q=[q,Re,He]:(q=null,n=Xe)):(q=null,n=Xe)}else q=null,n=Xe;if(q!==null&&(q=function(Pe,Le){return Le.map(De=>({cmd:"horizontalLineTo",args:[De]}))}(Ze,q[2])),q===null&&(n=Ze),q===null){if(Ze=n,Xe=n,o.charCodeAt(n)===104?(q="h",n++):(q=null,a('"h"')),q!==null){for(Re=[],He=$t();He!==null;)Re.push(He),He=$t();Re!==null?(He=X(),He!==null?q=[q,Re,He]:(q=null,n=Xe)):(q=null,n=Xe)}else q=null,n=Xe;q!==null&&(q=function(Pe,Le){return Le.map(De=>({cmd:"horizontalLineToRelative",args:[De]}))}(Ze,q[2])),q===null&&(n=Ze)}return q}function X(){let q,Re,He,Ze,Xe;return Ze=n,Xe=n,q=zt(),q!==null?(Re=Gt(),Re=Re!==null?Re:"",Re!==null?(He=X(),He!==null?q=[q,Re,He]:(q=null,n=Xe)):(q=null,n=Xe)):(q=null,n=Xe),q!==null&&(q=function(Pe,Le,De){return[Le].concat(De)}(Ze,q[0],q[2])),q===null&&(n=Ze),q===null&&(Ze=n,q=zt(),q!==null&&(q=function(Pe,Le){return[Le]}(Ze,q)),q===null&&(n=Ze)),q}function ae(){let q,Re,He,Ze,Xe;if(Ze=n,Xe=n,o.charCodeAt(n)===86?(q="V",n++):(q=null,a('"V"')),q!==null){for(Re=[],He=$t();He!==null;)Re.push(He),He=$t();Re!==null?(He=oe(),He!==null?q=[q,Re,He]:(q=null,n=Xe)):(q=null,n=Xe)}else q=null,n=Xe;if(q!==null&&(q=function(Pe,Le){return Le.map(De=>({cmd:"verticalLineTo",args:[De]}))}(Ze,q[2])),q===null&&(n=Ze),q===null){if(Ze=n,Xe=n,o.charCodeAt(n)===118?(q="v",n++):(q=null,a('"v"')),q!==null){for(Re=[],He=$t();He!==null;)Re.push(He),He=$t();Re!==null?(He=oe(),He!==null?q=[q,Re,He]:(q=null,n=Xe)):(q=null,n=Xe)}else q=null,n=Xe;q!==null&&(q=function(Pe,Le){return Le.map(De=>({cmd:"verticalLineToRelative",args:[De]}))}(Ze,q[2])),q===null&&(n=Ze)}return q}function oe(){let q,Re,He,Ze,Xe;return Ze=n,Xe=n,q=zt(),q!==null?(Re=Gt(),Re=Re!==null?Re:"",Re!==null?(He=oe(),He!==null?q=[q,Re,He]:(q=null,n=Xe)):(q=null,n=Xe)):(q=null,n=Xe),q!==null&&(q=function(Pe,Le,De){return[Le].concat(De)}(Ze,q[0],q[2])),q===null&&(n=Ze),q===null&&(Ze=n,q=zt(),q!==null&&(q=function(Pe,Le){return[Le]}(Ze,q)),q===null&&(n=Ze)),q}function ue(){let q,Re,He,Ze,Xe;if(Ze=n,Xe=n,o.charCodeAt(n)===67?(q="C",n++):(q=null,a('"C"')),q!==null){for(Re=[],He=$t();He!==null;)Re.push(He),He=$t();Re!==null?(He=fe(),He!==null?q=[q,Re,He]:(q=null,n=Xe)):(q=null,n=Xe)}else q=null,n=Xe;if(q!==null&&(q=function(Pe,Le){return Le.map(De=>({cmd:"cubicCurveTo",args:De}))}(Ze,q[2])),q===null&&(n=Ze),q===null){if(Ze=n,Xe=n,o.charCodeAt(n)===99?(q="c",n++):(q=null,a('"c"')),q!==null){for(Re=[],He=$t();He!==null;)Re.push(He),He=$t();Re!==null?(He=fe(),He!==null?q=[q,Re,He]:(q=null,n=Xe)):(q=null,n=Xe)}else q=null,n=Xe;q!==null&&(q=function(Pe,Le){return Le.map(De=>({cmd:"cubicCurveToRelative",args:De}))}(Ze,q[2])),q===null&&(n=Ze)}return q}function fe(){let q,Re,He,Ze,Xe;return Ze=n,Xe=n,q=be(),q!==null?(Re=Gt(),Re=Re!==null?Re:"",Re!==null?(He=fe(),He!==null?q=[q,Re,He]:(q=null,n=Xe)):(q=null,n=Xe)):(q=null,n=Xe),q!==null&&(q=function(Pe,Le,De){return[Le].concat(De)}(Ze,q[0],q[2])),q===null&&(n=Ze),q===null&&(Ze=n,q=be(),q!==null&&(q=function(Pe,Le){return[Le]}(Ze,q)),q===null&&(n=Ze)),q}function be(){let q,Re,He,Ze,Xe,Pe,Le;return Pe=n,Le=n,q=dt(),q!==null?(Re=Gt(),Re=Re!==null?Re:"",Re!==null?(He=dt(),He!==null?(Ze=Gt(),Ze=Ze!==null?Ze:"",Ze!==null?(Xe=dt(),Xe!==null?q=[q,Re,He,Ze,Xe]:(q=null,n=Le)):(q=null,n=Le)):(q=null,n=Le)):(q=null,n=Le)):(q=null,n=Le),q!==null&&(q=function(De,ct,h,f){return[ct.x,ct.y,h.x,h.y,f.x,f.y]}(Pe,q[0],q[2],q[4])),q===null&&(n=Pe),q}function Ae(){let q,Re,He,Ze,Xe;if(Ze=n,Xe=n,o.charCodeAt(n)===83?(q="S",n++):(q=null,a('"S"')),q!==null){for(Re=[],He=$t();He!==null;)Re.push(He),He=$t();Re!==null?(He=W(),He!==null?q=[q,Re,He]:(q=null,n=Xe)):(q=null,n=Xe)}else q=null,n=Xe;if(q!==null&&(q=function(Pe,Le){return Le.map(De=>({cmd:"smoothCubicCurveTo",args:De}))}(Ze,q[2])),q===null&&(n=Ze),q===null){if(Ze=n,Xe=n,o.charCodeAt(n)===115?(q="s",n++):(q=null,a('"s"')),q!==null){for(Re=[],He=$t();He!==null;)Re.push(He),He=$t();Re!==null?(He=W(),He!==null?q=[q,Re,He]:(q=null,n=Xe)):(q=null,n=Xe)}else q=null,n=Xe;q!==null&&(q=function(Pe,Le){return Le.map(De=>({cmd:"smoothCubicCurveToRelative",args:De}))}(Ze,q[2])),q===null&&(n=Ze)}return q}function W(){let q,Re,He,Ze,Xe;return Ze=n,Xe=n,q=J(),q!==null?(Re=Gt(),Re=Re!==null?Re:"",Re!==null?(He=W(),He!==null?q=[q,Re,He]:(q=null,n=Xe)):(q=null,n=Xe)):(q=null,n=Xe),q!==null&&(q=function(Pe,Le,De){return[Le].concat(De)}(Ze,q[0],q[2])),q===null&&(n=Ze),q===null&&(Ze=n,q=J(),q!==null&&(q=function(Pe,Le){return[Le]}(Ze,q)),q===null&&(n=Ze)),q}function J(){let q,Re,He,Ze,Xe;return Ze=n,Xe=n,q=dt(),q!==null?(Re=Gt(),Re=Re!==null?Re:"",Re!==null?(He=dt(),He!==null?q=[q,Re,He]:(q=null,n=Xe)):(q=null,n=Xe)):(q=null,n=Xe),q!==null&&(q=function(Pe,Le,De){return[Le.x,Le.y,De.x,De.y]}(Ze,q[0],q[2])),q===null&&(n=Ze),q}function Ue(){let q,Re,He,Ze,Xe;if(Ze=n,Xe=n,o.charCodeAt(n)===81?(q="Q",n++):(q=null,a('"Q"')),q!==null){for(Re=[],He=$t();He!==null;)Re.push(He),He=$t();Re!==null?(He=gt(),He!==null?q=[q,Re,He]:(q=null,n=Xe)):(q=null,n=Xe)}else q=null,n=Xe;if(q!==null&&(q=function(Pe,Le){return Le.map(De=>({cmd:"quadraticCurveTo",args:De}))}(Ze,q[2])),q===null&&(n=Ze),q===null){if(Ze=n,Xe=n,o.charCodeAt(n)===113?(q="q",n++):(q=null,a('"q"')),q!==null){for(Re=[],He=$t();He!==null;)Re.push(He),He=$t();Re!==null?(He=gt(),He!==null?q=[q,Re,He]:(q=null,n=Xe)):(q=null,n=Xe)}else q=null,n=Xe;q!==null&&(q=function(Pe,Le){return Le.map(De=>({cmd:"quadraticCurveToRelative",args:De}))}(Ze,q[2])),q===null&&(n=Ze)}return q}function gt(){let q,Re,He,Ze,Xe;return Ze=n,Xe=n,q=Te(),q!==null?(Re=Gt(),Re=Re!==null?Re:"",Re!==null?(He=gt(),He!==null?q=[q,Re,He]:(q=null,n=Xe)):(q=null,n=Xe)):(q=null,n=Xe),q!==null&&(q=function(Pe,Le,De){return[Le].concat(De)}(Ze,q[0],q[2])),q===null&&(n=Ze),q===null&&(Ze=n,q=Te(),q!==null&&(q=function(Pe,Le){return[Le]}(Ze,q)),q===null&&(n=Ze)),q}function Te(){let q,Re,He,Ze,Xe;return Ze=n,Xe=n,q=dt(),q!==null?(Re=Gt(),Re=Re!==null?Re:"",Re!==null?(He=dt(),He!==null?q=[q,Re,He]:(q=null,n=Xe)):(q=null,n=Xe)):(q=null,n=Xe),q!==null&&(q=function(Pe,Le,De){return[Le.x,Le.y,De.x,De.y]}(Ze,q[0],q[2])),q===null&&(n=Ze),q}function Et(){let q,Re,He,Ze,Xe;if(Ze=n,Xe=n,o.charCodeAt(n)===84?(q="T",n++):(q=null,a('"T"')),q!==null){for(Re=[],He=$t();He!==null;)Re.push(He),He=$t();Re!==null?(He=Bt(),He!==null?q=[q,Re,He]:(q=null,n=Xe)):(q=null,n=Xe)}else q=null,n=Xe;if(q!==null&&(q=function(Pe,Le){return Le.map(De=>({cmd:"smoothQuadraticCurveTo",args:[De.x,De.y]}))}(Ze,q[2])),q===null&&(n=Ze),q===null){if(Ze=n,Xe=n,o.charCodeAt(n)===116?(q="t",n++):(q=null,a('"t"')),q!==null){for(Re=[],He=$t();He!==null;)Re.push(He),He=$t();Re!==null?(He=Bt(),He!==null?q=[q,Re,He]:(q=null,n=Xe)):(q=null,n=Xe)}else q=null,n=Xe;q!==null&&(q=function(Pe,Le){return Le.map(De=>({cmd:"smoothQuadraticCurveToRelative",args:[De.x,De.y]}))}(Ze,q[2])),q===null&&(n=Ze)}return q}function Bt(){let q,Re,He,Ze,Xe;return Ze=n,Xe=n,q=dt(),q!==null?(Re=Gt(),Re=Re!==null?Re:"",Re!==null?(He=Bt(),He!==null?q=[q,Re,He]:(q=null,n=Xe)):(q=null,n=Xe)):(q=null,n=Xe),q!==null&&(q=function(Pe,Le,De){return[Le].concat(De)}(Ze,q[0],q[2])),q===null&&(n=Ze),q===null&&(Ze=n,q=dt(),q!==null&&(q=function(Pe,Le){return[Le]}(Ze,q)),q===null&&(n=Ze)),q}function Ke(){let q,Re,He,Ze,Xe;if(Ze=n,Xe=n,o.charCodeAt(n)===65?(q="A",n++):(q=null,a('"A"')),q!==null){for(Re=[],He=$t();He!==null;)Re.push(He),He=$t();Re!==null?(He=At(),He!==null?q=[q,Re,He]:(q=null,n=Xe)):(q=null,n=Xe)}else q=null,n=Xe;if(q!==null&&(q=function(Pe,Le){return Le.map(De=>(De[2]*=Math.PI/180,{cmd:"ellipticalArcTo",args:De}))}(Ze,q[2])),q===null&&(n=Ze),q===null){if(Ze=n,Xe=n,o.charCodeAt(n)===97?(q="a",n++):(q=null,a('"a"')),q!==null){for(Re=[],He=$t();He!==null;)Re.push(He),He=$t();Re!==null?(He=At(),He!==null?q=[q,Re,He]:(q=null,n=Xe)):(q=null,n=Xe)}else q=null,n=Xe;q!==null&&(q=function(Pe,Le){return Le.map(De=>(De[2]*=Math.PI/180,{cmd:"ellipticalArcToRelative",args:De}))}(Ze,q[2])),q===null&&(n=Ze)}return q}function At(){let q,Re,He,Ze,Xe;return Ze=n,Xe=n,q=nt(),q!==null?(Re=Gt(),Re=Re!==null?Re:"",Re!==null?(He=At(),He!==null?q=[q,Re,He]:(q=null,n=Xe)):(q=null,n=Xe)):(q=null,n=Xe),q!==null&&(q=function(Pe,Le,De){return[Le].concat(De)}(Ze,q[0],q[2])),q===null&&(n=Ze),q===null&&(Ze=n,q=nt(),q!==null&&(q=function(Pe,Le){return[Le]}(Ze,q)),q===null&&(n=Ze)),q}function nt(){let q,Re,He,Ze,Xe,Pe,Le,De,ct,h,f,b,L;return b=n,L=n,q=Mt(),q!==null?(Re=Gt(),Re=Re!==null?Re:"",Re!==null?(He=Mt(),He!==null?(Ze=Gt(),Ze=Ze!==null?Ze:"",Ze!==null?(Xe=zt(),Xe!==null?(Pe=Gt(),Pe!==null?(Le=xt(),Le!==null?(De=Gt(),De=De!==null?De:"",De!==null?(ct=xt(),ct!==null?(h=Gt(),h=h!==null?h:"",h!==null?(f=dt(),f!==null?q=[q,Re,He,Ze,Xe,Pe,Le,De,ct,h,f]:(q=null,n=L)):(q=null,n=L)):(q=null,n=L)):(q=null,n=L)):(q=null,n=L)):(q=null,n=L)):(q=null,n=L)):(q=null,n=L)):(q=null,n=L)):(q=null,n=L)):(q=null,n=L),q!==null&&(q=function(I,B,j,Y,Z,ie,pe){return[B,j,Y,Z,ie,pe.x,pe.y]}(b,q[0],q[2],q[4],q[6],q[8],q[10])),q===null&&(n=b),q}function dt(){let q,Re,He,Ze,Xe;return Ze=n,Xe=n,q=zt(),q!==null?(Re=Gt(),Re=Re!==null?Re:"",Re!==null?(He=zt(),He!==null?q=[q,Re,He]:(q=null,n=Xe)):(q=null,n=Xe)):(q=null,n=Xe),q!==null&&(q=function(Pe,Le,De){return{x:Le,y:De}}(Ze,q[0],q[2])),q===null&&(n=Ze),q}function Mt(){let q,Re;return Re=n,q=ti(),q!==null&&(q=function(He,Ze){return parseFloat(Ze)}(Re,q)),q===null&&(n=Re),q===null&&(Re=n,q=Pi(),q!==null&&(q=function(He,Ze){return Number(Ze)}(Re,q)),q===null&&(n=Re)),q}function zt(){let q,Re,He,Ze;return He=n,Ze=n,q=qi(),q=q!==null?q:"",q!==null?(Re=ti(),Re!==null?q=[q,Re]:(q=null,n=Ze)):(q=null,n=Ze),q!==null&&(q=function(Xe,Pe,Le){return parseFloat(Pe+Le)}(He,q[0],q[1])),q===null&&(n=He),q===null&&(He=n,Ze=n,q=qi(),q=q!==null?q:"",q!==null?(Re=Pi(),Re!==null?q=[q,Re]:(q=null,n=Ze)):(q=null,n=Ze),q!==null&&(q=function(Xe,Pe,Le){return Number(Pe+Le)}(He,q[0],q[1])),q===null&&(n=He)),q}function xt(){let q,Re;return Re=n,o.charCodeAt(n)===48?(q="0",n++):(q=null,a('"0"')),q!==null&&(q=function(He){return!1}()),q===null&&(n=Re),q===null&&(Re=n,o.charCodeAt(n)===49?(q="1",n++):(q=null,a('"1"')),q!==null&&(q=function(He){return!0}()),q===null&&(n=Re)),q}function Gt(){let q,Re,He,Ze,Xe;if(Xe=n,Re=$t(),Re!==null)for(q=[];Re!==null;)q.push(Re),Re=$t();else q=null;if(q!==null)if(Re=yi(),Re=Re!==null?Re:"",Re!==null){for(He=[],Ze=$t();Ze!==null;)He.push(Ze),Ze=$t();He!==null?q=[q,Re,He]:(q=null,n=Xe)}else q=null,n=Xe;else q=null,n=Xe;if(q===null)if(Xe=n,q=yi(),q!==null){for(Re=[],He=$t();He!==null;)Re.push(He),He=$t();Re!==null?q=[q,Re]:(q=null,n=Xe)}else q=null,n=Xe;return q}function yi(){let q;return o.charCodeAt(n)===44?(q=",",n++):(q=null,a('","')),q}function ti(){let q,Re,He,Ze;return He=n,Ze=n,q=Mi(),q!==null?(Re=Li(),Re=Re!==null?Re:"",Re!==null?q=[q,Re]:(q=null,n=Ze)):(q=null,n=Ze),q!==null&&(q=function(Xe,Pe,Le){return Pe+Le}(He,q[0],q[1])),q===null&&(n=He),q===null&&(He=n,Ze=n,q=Pi(),q!==null?(Re=Li(),Re!==null?q=[q,Re]:(q=null,n=Ze)):(q=null,n=Ze),q!==null&&(q=function(Xe,Pe,Le){return Pe+Le}(He,q[0],q[1])),q===null&&(n=He)),q}function Mi(){let q,Re,He,Ze,Xe;return Ze=n,Xe=n,q=Pi(),q=q!==null?q:"",q!==null?(o.charCodeAt(n)===46?(Re=".",n++):(Re=null,a('"."')),Re!==null?(He=Pi(),He!==null?q=[q,Re,He]:(q=null,n=Xe)):(q=null,n=Xe)):(q=null,n=Xe),q!==null&&(q=function(Pe,Le,De){return Le+"."+De}(Ze,q[0],q[2])),q===null&&(n=Ze),q===null&&(Ze=n,Xe=n,q=Pi(),q!==null?(o.charCodeAt(n)===46?(Re=".",n++):(Re=null,a('"."')),Re!==null?q=[q,Re]:(q=null,n=Xe)):(q=null,n=Xe),q!==null&&(q=function(Pe,Le){return Le}(Ze,q[0])),q===null&&(n=Ze)),q}function Li(){let q,Re,He,Ze,Xe;return Ze=n,Xe=n,o.charCodeAt(n)===101?(q="e",n++):(q=null,a('"e"')),q===null&&(o.charCodeAt(n)===69?(q="E",n++):(q=null,a('"E"'))),q!==null?(Re=qi(),Re=Re!==null?Re:"",Re!==null?(He=Pi(),He!==null?q=[q,Re,He]:(q=null,n=Xe)):(q=null,n=Xe)):(q=null,n=Xe),q!==null&&(q=function(Pe,Le,De,ct){return Le+De+ct}(Ze,q[0],q[1],q[2])),q===null&&(n=Ze),q}function qi(){let q;return o.charCodeAt(n)===43?(q="+",n++):(q=null,a('"+"')),q===null&&(o.charCodeAt(n)===45?(q="-",n++):(q=null,a('"-"'))),q}function Pi(){let q,Re,He,Ze;return He=n,Ze=n,q=Oi(),q!==null?(Re=Pi(),Re!==null?q=[q,Re]:(q=null,n=Ze)):(q=null,n=Ze),q!==null&&(q=function(Xe,Pe,Le){return Pe+Le}(He,q[0],q[1])),q===null&&(n=He),q===null&&(q=Oi()),q}function Oi(){let q;return/^[0-9]/.test(o.charAt(n))?(q=o.charAt(n),n++):(q=null,a("[0-9]")),q}function $t(){let q;return o.charCodeAt(n)===32?(q=" ",n++):(q=null,a('" "')),q===null&&(o.charCodeAt(n)===9?(q="	",n++):(q=null,a('"\\t"')),q===null&&(o.charCodeAt(n)===13?(q="\r",n++):(q=null,a('"\\r"')),q===null&&(o.charCodeAt(n)===10?(q=`
`,n++):(q=null,a('"\\n"'))))),q}function Rs(q){q.sort();let Re=null;const He=[];for(let Ze=0;Ze<q.length;Ze++)q[Ze]!==Re&&(He.push(q[Ze]),Re=q[Ze]);return He}function is(){let q=1,Re=1,He=!1;for(let Ze=0;Ze<Math.max(n,r);Ze++){const Xe=o.charAt(Ze);Xe===`
`?(He||q++,Re=1,He=!1):Xe==="\r"||Xe==="\u2028"||Xe==="\u2029"?(q++,Re=1,He=!0):(Re++,He=!1)}return{line:q,column:Re}}function hs(q,Re){const He=[{cmd:Re?"moveToRelative":"moveTo",args:[q[0].x,q[0].y]}];if(q.length>1)for(let Ze=1;Ze<q.length;Ze++)He.push({cmd:Re?"lineToRelative":"lineTo",args:[q[Ze].x,q[Ze].y]});return He}const qs=t[e]();if(qs===null||n!==o.length){const q=Math.max(n,r),Re=q<o.length?o.charAt(q):null,He=is();throw new this.SyntaxError(Rs(s),Re,q,He.line,He.column)}return qs},toSource:function(){return this._source}};result.SyntaxError=function(o,e,t,n,r){function s(a,l){let d,c;switch(a.length){case 0:d="end of input";break;case 1:d=a[0];break;default:d=a.slice(0,a.length-1).join(", ")+" or "+a[a.length-1]}return c=l?quote(l):"end of input","Expected "+d+" but "+c+" found."}this.name="SyntaxError",this.expected=o,this.found=e,this.message=s(o,e),this.offset=t,this.line=n,this.column=r};result.SyntaxError.prototype=Error.prototype;kite.register("svgPath",result);const svgPath=kite.svgPath;class Segment{constructor(){this.invalidationEmitter=new TinyEmitter}areStrokedBoundsDilated(){return Math.abs(this.startTangent.x*this.startTangent.y)<1e-7&&Math.abs(this.endTangent.x*this.endTangent.y)<1e-7}getBoundsWithTransform(e){return this.transformed(e).getBounds()}slice(e,t){assert&&assert(e>=0&&e<=1&&t>=0&&t<=1,"Parametric value out of range"),assert&&assert(e<t);let n=this;return t<1&&(n=n.subdivided(t)[0]),e>0&&(n=n.subdivided(DotUtils.linear(0,t,0,1,e))[1]),n}subdivisions(e){let t=this;const n=[];for(let r=0;r<e.length;r++){const s=e[r],a=t.subdivided(s);assert&&assert(a.length===2),n.push(a[0]),t=a[1];for(let l=r+1;l<e.length;l++)e[l]=DotUtils.linear(s,1,0,1,e[l])}return n.push(t),n}subdividedIntoMonotone(){return this.subdivisions(this.getInteriorExtremaTs())}isSufficientlyFlat(e,t){const n=this.start,r=this.positionAt(.5),s=this.end;return Segment.isSufficientlyFlat(e,t,n,r,s)}getArcLength(e,t,n){if(e=e===void 0?1e-10:e,t=t===void 0?1e-8:t,n=n===void 0?15:n,n<=0||this.isSufficientlyFlat(e,t))return this.start.distance(this.end);{const r=this.subdivided(.5);return r[0].getArcLength(e,t,n-1)+r[1].getArcLength(e,t,n-1)}}getDashValues(e,t,n,r){assert&&assert(e.length>0,"Do not call with an empty dash array");const s=this,a=[];let l=0;const d=_.sum(e);t=t%d,t<0&&(t+=d);let c=0,y=0,m=!0;function O(){c=(c+1)%e.length,m=!m}for(;t>0;)t>=e[c]?(t-=e[c],O()):(y=t,t=0);const D=m;return function z(w,N,H,X,ae){const oe=(w+N)/2,ue=s.positionAt(oe);if(ae>14||Segment.isSufficientlyFlat(n,r,H,ue,X)){const fe=H.distance(ue)+ue.distance(X);l+=fe;let be=fe;for(;y+be>=e[c];){const Ae=DotUtils.linear(0,fe,w,N,fe-be+e[c]-y);a.push(Ae),be-=e[c]-y,y=0,O()}y=y+be}else z(w,oe,H,ue,ae+1),z(oe,N,ue,X,ae+1)}(0,1,this.start,this.end,0),{values:a,arcLength:l,initiallyInside:D}}toPiecewiseLinearSegments(e,t,n,r,s,a){t=t===void 0?e.minLevels:t,n=n===void 0?e.maxLevels:n,r=r||[];const l=e.pointMap||_.identity;s=s||l(this.start),a=a||l(this.end);const d=l(this.positionAt(.5));assert&&assert(t<=n),assert&&assert(e.distanceEpsilon===null||typeof e.distanceEpsilon=="number"),assert&&assert(e.curveEpsilon===null||typeof e.curveEpsilon=="number"),assert&&assert(!l||typeof l=="function");let c=n===0;if(!c&&t<=0&&(c=this.isSufficientlyFlat(e.distanceEpsilon===null||e.distanceEpsilon===void 0?Number.POSITIVE_INFINITY:e.distanceEpsilon,e.curveEpsilon===null||e.curveEpsilon===void 0?Number.POSITIVE_INFINITY:e.curveEpsilon)),c)r.push(new Line$1(s,a));else{const y=this.subdivided(.5);y[0].toPiecewiseLinearSegments(e,t-1,n-1,r,s,d),y[1].toPiecewiseLinearSegments(e,t-1,n-1,r,d,a)}return r}toPiecewiseLinearOrArcSegments(e){const t=optionize()({minLevels:2,maxLevels:7,curvatureThreshold:.02,errorThreshold:10,errorPoints:[.25,.75]},e),n=[];return this.toPiecewiseLinearOrArcRecursion(t,t.minLevels,t.maxLevels,n,0,1,this.positionAt(0),this.positionAt(1),this.curvatureAt(0),this.curvatureAt(1)),n}toPiecewiseLinearOrArcRecursion(e,t,n,r,s,a,l,d,c,y){const m=(s+a)/2,O=this.positionAt(m),D=this.curvatureAt(m);if(n<=0||t<=0&&Math.abs(c-D)+Math.abs(D-y)<e.curvatureThreshold*2){const z=Arc.createFromPoints(l,O,d);let w=!1;if(z instanceof Arc){const N=z.radius*z.radius;for(let H=0;H<e.errorPoints.length;H++){const X=e.errorPoints[H],ae=this.positionAt(s*(1-X)+a*X);if(Math.abs(ae.distanceSquared(z.center)-N)>e.errorThreshold){w=!0;break}}}if(!w){r.push(z);return}}this.toPiecewiseLinearOrArcRecursion(e,t-1,n-1,r,s,m,l,O,c,D),this.toPiecewiseLinearOrArcRecursion(e,t-1,n-1,r,m,a,O,d,D,y)}toShape(){return new Shape$1([new Subpath$1([this])])}getClosestPoints(e){return Segment.closestToPoint([this],e,1e-7)}static closestToPoint(e,t,n){const r=n*n;let s=[],a=[],l=Number.POSITIVE_INFINITY,d=!1;for(_.each(e,c=>{if(c instanceof Line$1){const y=c.explicitClosestToPoint(t);_.each(y,m=>{m.distanceSquared<l?(a=[m],l=m.distanceSquared):m.distanceSquared===l&&a.push(m)})}else{const y=[0].concat(c.getInteriorExtremaTs()).concat([1]);for(let m=0;m<y.length-1;m++){const O=y[m],D=y[m+1],z=c.positionAt(O),w=c.positionAt(D),N=Bounds2.point(z).addPoint(w),H=N.minimumDistanceToPointSquared(t);if(H<=l){const X=N.maximumDistanceToPointSquared(t);X<l&&(l=X,a=[]),s.push({ta:O,tb:D,pa:z,pb:w,segment:c,bounds:N,min:H,max:X})}}}});s.length&&!d;){const c=s;s=[],d=!0;for(const y of c){if(y.min>l)continue;d&&y.pa.distanceSquared(y.pb)>r&&(d=!1);const m=(y.ta+y.tb)/2,O=y.segment.positionAt(m),D=Bounds2.point(y.pa).addPoint(O),z=Bounds2.point(y.pb).addPoint(O),w=D.minimumDistanceToPointSquared(t),N=z.minimumDistanceToPointSquared(t);if(w<=l){const H=D.maximumDistanceToPointSquared(t);H<l&&(l=H,a=[]),s.push({ta:y.ta,tb:m,pa:y.pa,pb:O,segment:y.segment,bounds:D,min:w,max:H})}if(N<=l){const H=z.maximumDistanceToPointSquared(t);H<l&&(l=H,a=[]),s.push({ta:m,tb:y.tb,pa:O,pb:y.pb,segment:y.segment,bounds:z,min:N,max:H})}}}return _.each(s,c=>{const y=(c.ta+c.tb)/2,m=c.segment.positionAt(y);a.push({segment:c.segment,t:y,closestPoint:m,distanceSquared:t.distanceSquared(m)})}),a}static polynomialGetOverlapCubic(e,t,n,r,s,a,l,d){if(d===0)return Segment.polynomialGetOverlapQuadratic(e,t,n,s,a,l);const c=Math.sign(r/d)*Math.pow(Math.abs(r/d),1/3);if(c===0)return null;const y=(n-c*c*l)/(3*c*c*d);return{a:c,b:y}}static polynomialGetOverlapQuadratic(e,t,n,r,s,a){if(a===0)return Segment.polynomialGetOverlapLinear(e,t,r,s);if(n/a<0)return null;const d=Math.sqrt(n/a);if(d===0)return null;const c=(t-d*s)/(2*d*a);return{a:d,b:c}}static polynomialGetOverlapLinear(e,t,n,r){if(r===0)return e===n?!0:null;const s=t/r;if(s===0)return null;const a=(e-n)/r;return{a:s,b:a}}static intersect(e,t){if(Line$1&&e instanceof Line$1&&t instanceof Line$1)return Line$1.intersect(e,t);if(Line$1&&e instanceof Line$1)return Line$1.intersectOther(e,t);if(Line$1&&t instanceof Line$1)return Line$1.intersectOther(t,e).map(swapSegmentIntersection);if(Arc&&e instanceof Arc&&t instanceof Arc)return Arc.intersect(e,t);if(EllipticalArc&&e instanceof EllipticalArc&&t instanceof EllipticalArc)return EllipticalArc.intersect(e,t);if(Quadratic&&Cubic&&(e instanceof Quadratic||e instanceof Cubic)&&(t instanceof Quadratic||t instanceof Cubic)){const n=e instanceof Cubic?e:e.degreeElevated(),r=t instanceof Cubic?t:t.degreeElevated(),s=new paper.Curve(n.start.x,n.start.y,n.control1.x,n.control1.y,n.control2.x,n.control2.y,n.end.x,n.end.y),a=new paper.Curve(r.start.x,r.start.y,r.control1.x,r.control1.y,r.control2.x,r.control2.y,r.end.x,r.end.y);return s.getIntersections(a).map(d=>{const c=new Vector2(d.point.x,d.point.y);return new SegmentIntersection(c,d.time,d.intersection.time)})}else return BoundsIntersection.intersect(e,t)}static deserialize(e){return assert&&assert(e.type&&kite[e.type]&&kite[e.type].deserialize),kite[e.type].deserialize(e)}static isSufficientlyFlat(e,t,n,r,s){return!(DotUtils.distToSegmentSquared(r,n,s)/n.distanceSquared(s)>t||DotUtils.distToSegmentSquared(r,n,s)>e)}static filterClosestToPointResult(e){if(e.length===0)return[];const t=_.minBy(e,n=>n.distanceSquared).distanceSquared;return _.uniqWith(e.filter(n=>Math.abs(n.distanceSquared-t)<1e-11),(n,r)=>n.closestPoint.distanceSquared(r.closestPoint)<1e-11)}}kite.register("Segment",Segment);function swapSegmentIntersection(o){return o.getSwapped()}const scratchVector2$1=new Vector2(0,0);let Line$1=class Dr extends Segment{constructor(e,t){super(),this._start=e,this._end=t,this.invalidate()}setStart(e){return assert&&assert(e.isFinite(),`Line start should be finite: ${e.toString()}`),this._start.equals(e)||(this._start=e,this.invalidate()),this}set start(e){this.setStart(e)}get start(){return this.getStart()}getStart(){return this._start}setEnd(e){return assert&&assert(e.isFinite(),`Line end should be finite: ${e.toString()}`),this._end.equals(e)||(this._end=e,this.invalidate()),this}set end(e){this.setEnd(e)}get end(){return this.getEnd()}getEnd(){return this._end}positionAt(e){return assert&&assert(e>=0,"positionAt t should be non-negative"),assert&&assert(e<=1,"positionAt t should be no greater than 1"),this._start.plus(this._end.minus(this._start).times(e))}tangentAt(e){return assert&&assert(e>=0,"tangentAt t should be non-negative"),assert&&assert(e<=1,"tangentAt t should be no greater than 1"),this.getStartTangent()}curvatureAt(e){return assert&&assert(e>=0,"curvatureAt t should be non-negative"),assert&&assert(e<=1,"curvatureAt t should be no greater than 1"),0}subdivided(e){if(assert&&assert(e>=0,"subdivided t should be non-negative"),assert&&assert(e<=1,"subdivided t should be no greater than 1"),e===0||e===1)return[this];const t=this.positionAt(e);return[new Dr(this._start,t),new Dr(t,this._end)]}invalidate(){assert&&assert(this._start instanceof Vector2,`Line start should be a Vector2: ${this._start}`),assert&&assert(this._start.isFinite(),`Line start should be finite: ${this._start.toString()}`),assert&&assert(this._end instanceof Vector2,`Line end should be a Vector2: ${this._end}`),assert&&assert(this._end.isFinite(),`Line end should be finite: ${this._end.toString()}`),this._tangent=null,this._bounds=null,this._svgPathFragment=null,this.invalidationEmitter.emit()}getStartTangent(){return this._tangent===null&&(this._tangent=this._end.minus(this._start).normalized()),this._tangent}get startTangent(){return this.getStartTangent()}getEndTangent(){return this.getStartTangent()}get endTangent(){return this.getEndTangent()}getBounds(){return this._bounds===null&&(this._bounds=Bounds2.NOTHING.copy().addPoint(this._start).addPoint(this._end)),this._bounds}get bounds(){return this.getBounds()}getBoundsWithTransform(e){const t=Bounds2.NOTHING.copy();return t.addPoint(e.multiplyVector2(scratchVector2$1.set(this._start))),t.addPoint(e.multiplyVector2(scratchVector2$1.set(this._end))),t}getNondegenerateSegments(){return this._start.equals(this._end)?[]:[this]}getSVGPathFragment(){let e;return assert&&(e=this._svgPathFragment,this._svgPathFragment=null),this._svgPathFragment||(this._svgPathFragment=`L ${svgNumber(this._end.x)} ${svgNumber(this._end.y)}`),assert&&e&&assert(e===this._svgPathFragment,"Quadratic line segment changed without invalidate()"),this._svgPathFragment}strokeLeft(e){const t=this.getEndTangent().perpendicular.negated().times(e/2);return[new Dr(this._start.plus(t),this._end.plus(t))]}strokeRight(e){const t=this.getStartTangent().perpendicular.times(e/2);return[new Dr(this._end.plus(t),this._start.plus(t))]}getInteriorExtremaTs(){return[]}intersection(e){const t=[],n=this._start,s=this._end.minus(n);if(s.magnitudeSquared===0)return t;const a=e.direction.y*s.x-e.direction.x*s.y;if(a===0)return t;const l=(e.direction.x*(n.y-e.position.y)-e.direction.y*(n.x-e.position.x))/a;if(l<0||l>=1)return t;const d=(s.x*(n.y-e.position.y)-s.y*(n.x-e.position.x))/a;if(d<1e-8)return t;const c=s.perpendicular,y=n.plus(s.times(l)),m=(c.dot(e.direction)>0?c.negated():c).normalized(),O=e.direction.perpendicular.dot(s)<0?1:-1;return t.push(new RayIntersection(d,y,m,O,l)),t}windingIntersection(e){const t=this.intersection(e);return t.length?t[0].wind:0}writeToContext(e){e.lineTo(this._end.x,this._end.y)}transformed(e){return new Dr(e.timesVector2(this._start),e.timesVector2(this._end))}explicitClosestToPoint(e){const t=this._end.minus(this._start);let n=e.minus(this._start).dot(t)/t.magnitudeSquared;n=DotUtils.clamp(n,0,1);const r=this.positionAt(n);return[{segment:this,t:n,closestPoint:r,distanceSquared:e.distanceSquared(r)}]}getSignedAreaFragment(){return 1/2*(this._start.x*this._end.y-this._start.y*this._end.x)}reparameterized(e,t){return new Dr(this.positionAt(t),this.positionAt(e+t))}reversed(){return new Dr(this._end,this._start)}polarToCartesian(e){return this._start.x===this._end.x?[new Dr(Vector2.createPolar(this._start.y,this._start.x),Vector2.createPolar(this._end.y,this._end.x))]:this._start.y===this._end.y?[new Arc(Vector2.ZERO,this._start.y,this._start.x,this._end.x,this._start.x>this._end.x)]:this.toPiecewiseLinearSegments(e)}getArcLength(){return this.start.distance(this.end)}toPiecewiseLinearOrArcSegments(){return[this]}serialize(){return{type:"Line",startX:this._start.x,startY:this._start.y,endX:this._end.x,endY:this._end.y}}getOverlaps(e,t=1e-6){return e instanceof Dr?Dr.getOverlaps(this,e):null}getClosestPoints(e){const t=this._end.minus(this._start),n=t.normalized(),r=e.minus(this._start).dot(n),s=DotUtils.clamp(r/t.magnitude,0,1),a=this.positionAt(s);return[{segment:this,t:s,closestPoint:a,distanceSquared:a.distanceSquared(e)}]}static deserialize(e){return assert&&assert(e.type==="Line"),new Dr(new Vector2(e.startX,e.startY),new Vector2(e.endX,e.endY))}static getOverlaps(e,t,n=1e-6){const r=[],s=e._start.x,a=-1*e._start.x+e._end.x,l=e._start.y,d=-1*e._start.y+e._end.y,c=t._start.x,y=-1*t._start.x+t._end.x,m=t._start.y,O=-1*t._start.y+t._end.y,D=Math.abs(Math.max(e._start.x,e._end.x,t._start.x,t._end.x)-Math.min(e._start.x,e._end.x,t._start.x,t._end.x)),z=Math.abs(Math.max(e._start.y,e._end.y,t._start.y,t._end.y)-Math.min(e._start.y,e._end.y,t._start.y,t._end.y)),w=Segment.polynomialGetOverlapLinear(s,a,c,y),N=Segment.polynomialGetOverlapLinear(l,d,m,O);let H;if(D>z?H=w===null||w===!0?N:w:H=N===null||N===!0?w:N,H===null||H===!0)return r;const X=H.a,ae=H.b,oe=c+ae*y-s,ue=X*y-a,fe=m+ae*O-l,be=X*O-d;if(Math.abs(oe)>n||Math.abs(ue+oe)>n||Math.abs(fe)>n||Math.abs(be+fe)>n)return r;const Ae=ae,W=X+ae;return Ae>1&&W>1||Ae<0&&W<0?r:[new Overlap(X,ae)]}static intersect(e,t){const n=DotUtils.lineSegmentIntersection(e.start.x,e.start.y,e.end.x,e.end.y,t.start.x,t.start.y,t.end.x,t.end.y);if(n!==null){const r=e.explicitClosestToPoint(n)[0].t,s=t.explicitClosestToPoint(n)[0].t;return[new SegmentIntersection(n,r,s)]}else return[]}static intersectOther(e,t){const n=e.end.minus(e.start),r=n.magnitude,s=new Ray2(e.start,n.normalize()),a=t.intersection(s),l=[];for(let d=0;d<a.length;d++){const c=a[d],y=c.distance/r;y>1e-8&&y<1-1e-8&&l.push(new SegmentIntersection(c.point,y,c.t))}return l}};kite.register("Line",Line$1);const solveQuadraticRootsReal$1=DotUtils.solveQuadraticRootsReal,arePointsCollinear$1=DotUtils.arePointsCollinear;function isBetween0And1$1(o){return o>=0&&o<=1}class Quadratic extends Segment{constructor(e,t,n){super(),this._start=e,this._control=t,this._end=n,this.invalidate()}setStart(e){return assert&&assert(e.isFinite(),`Quadratic start should be finite: ${e.toString()}`),this._start.equals(e)||(this._start=e,this.invalidate()),this}set start(e){this.setStart(e)}get start(){return this.getStart()}getStart(){return this._start}setControl(e){return assert&&assert(e.isFinite(),`Quadratic control should be finite: ${e.toString()}`),this._control.equals(e)||(this._control=e,this.invalidate()),this}set control(e){this.setControl(e)}get control(){return this.getControl()}getControl(){return this._control}setEnd(e){return assert&&assert(e.isFinite(),`Quadratic end should be finite: ${e.toString()}`),this._end.equals(e)||(this._end=e,this.invalidate()),this}set end(e){this.setEnd(e)}get end(){return this.getEnd()}getEnd(){return this._end}positionAt(e){assert&&assert(e>=0,"positionAt t should be non-negative"),assert&&assert(e<=1,"positionAt t should be no greater than 1");const t=1-e;return this._start.times(t*t).plus(this._control.times(2*t*e)).plus(this._end.times(e*e))}tangentAt(e){return assert&&assert(e>=0,"tangentAt t should be non-negative"),assert&&assert(e<=1,"tangentAt t should be no greater than 1"),this._control.minus(this._start).times(2*(1-e)).plus(this._end.minus(this._control).times(2*e))}curvatureAt(e){if(assert&&assert(e>=0,"curvatureAt t should be non-negative"),assert&&assert(e<=1,"curvatureAt t should be no greater than 1"),Math.abs(e-.5)>.5-1e-7){const n=e<.5,r=n?this._start:this._end,s=this._control,a=n?this._end:this._start,l=s.minus(r),d=l.magnitude;return(n?-1:1)*l.perpendicular.normalized().dot(a.minus(s))*(this.degree-1)/(this.degree*d*d)}else return this.subdivided(e)[0].curvatureAt(1)}subdivided(e){if(assert&&assert(e>=0,"subdivided t should be non-negative"),assert&&assert(e<=1,"subdivided t should be no greater than 1"),e===0||e===1)return[this];const t=this._start.blend(this._control,e),n=this._control.blend(this._end,e),r=t.blend(n,e);return[new Quadratic(this._start,t,r),new Quadratic(r,n,this._end)]}invalidate(){assert&&assert(this._start instanceof Vector2,`Quadratic start should be a Vector2: ${this._start}`),assert&&assert(this._start.isFinite(),`Quadratic start should be finite: ${this._start.toString()}`),assert&&assert(this._control instanceof Vector2,`Quadratic control should be a Vector2: ${this._control}`),assert&&assert(this._control.isFinite(),`Quadratic control should be finite: ${this._control.toString()}`),assert&&assert(this._end instanceof Vector2,`Quadratic end should be a Vector2: ${this._end}`),assert&&assert(this._end.isFinite(),`Quadratic end should be finite: ${this._end.toString()}`),this._startTangent=null,this._endTangent=null,this._tCriticalX=null,this._tCriticalY=null,this._bounds=null,this._svgPathFragment=null,this.invalidationEmitter.emit()}getStartTangent(){if(this._startTangent===null){const e=this._start.equals(this._control);this._startTangent=e?this._end.minus(this._start).normalized():this._control.minus(this._start).normalized()}return this._startTangent}get startTangent(){return this.getStartTangent()}getEndTangent(){if(this._endTangent===null){const e=this._end.equals(this._control);this._endTangent=e?this._end.minus(this._start).normalized():this._end.minus(this._control).normalized()}return this._endTangent}get endTangent(){return this.getEndTangent()}getTCriticalX(){return this._tCriticalX===null&&(this._tCriticalX=Quadratic.extremaT(this._start.x,this._control.x,this._end.x)),this._tCriticalX}get tCriticalX(){return this.getTCriticalX()}getTCriticalY(){return this._tCriticalY===null&&(this._tCriticalY=Quadratic.extremaT(this._start.y,this._control.y,this._end.y)),this._tCriticalY}get tCriticalY(){return this.getTCriticalY()}getNondegenerateSegments(){const e=this._start,t=this._control,n=this._end,r=e.equals(n),s=e.equals(t),a=e.equals(t);if(r&&s)return[];if(r){const l=this.positionAt(.5);return[new Line$1(e,l),new Line$1(l,n)]}else if(arePointsCollinear$1(e,t,n)){if(s||a)return[new Line$1(e,n)];const l=n.minus(e),d=t.minus(e).dot(l.normalized())/l.magnitude,c=Quadratic.extremaT(0,d,1);if(!isNaN(c)&&c>0&&c<1){const y=this.positionAt(c);return _.flatten([new Line$1(e,y).getNondegenerateSegments(),new Line$1(y,n).getNondegenerateSegments()])}else return[new Line$1(e,n)]}else return[this]}getBounds(){if(this._bounds===null){this._bounds=new Bounds2(Math.min(this._start.x,this._end.x),Math.min(this._start.y,this._end.y),Math.max(this._start.x,this._end.x),Math.max(this._start.y,this._end.y));const e=this.getTCriticalX(),t=this.getTCriticalY();!isNaN(e)&&e>0&&e<1&&(this._bounds=this._bounds.withPoint(this.positionAt(e))),!isNaN(t)&&t>0&&t<1&&(this._bounds=this._bounds.withPoint(this.positionAt(t)))}return this._bounds}get bounds(){return this.getBounds()}offsetTo(e,t){let n=[this];const r=5;for(let a=0;a<r;a++)n=_.flatten(_.map(n,l=>l.subdivided(.5)));let s=_.map(n,a=>a.approximateOffset(e));return t&&(s.reverse(),s=_.map(s,a=>a.reversed())),s}degreeElevated(){return new Cubic(this._start,this._start.plus(this._control.timesScalar(2)).dividedScalar(3),this._end.plus(this._control.timesScalar(2)).dividedScalar(3),this._end)}approximateOffset(e){return new Quadratic(this._start.plus((this._start.equals(this._control)?this._end.minus(this._start):this._control.minus(this._start)).perpendicular.normalized().times(e)),this._control.plus(this._end.minus(this._start).perpendicular.normalized().times(e)),this._end.plus((this._end.equals(this._control)?this._end.minus(this._start):this._end.minus(this._control)).perpendicular.normalized().times(e)))}getSVGPathFragment(){let e;return assert&&(e=this._svgPathFragment,this._svgPathFragment=null),this._svgPathFragment||(this._svgPathFragment=`Q ${svgNumber(this._control.x)} ${svgNumber(this._control.y)} ${svgNumber(this._end.x)} ${svgNumber(this._end.y)}`),assert&&e&&assert(e===this._svgPathFragment,"Quadratic line segment changed without invalidate()"),this._svgPathFragment}strokeLeft(e){return this.offsetTo(-e/2,!1)}strokeRight(e){return this.offsetTo(e/2,!0)}getInteriorExtremaTs(){const e=[],n=this.getTCriticalX(),r=this.getTCriticalY();return!isNaN(n)&&n>1e-10&&n<1-1e-10&&e.push(this.tCriticalX),!isNaN(r)&&r>1e-10&&r<1-1e-10&&e.push(this.tCriticalY),e.sort()}intersection(e){const t=[],n=Matrix3.rotation2(-e.direction.angle).timesMatrix(Matrix3.translation(-e.position.x,-e.position.y)),r=n.timesVector2(this._start),s=n.timesVector2(this._control),a=n.timesVector2(this._end),l=r.y-2*s.y+a.y,d=-2*r.y+2*s.y,c=r.y,y=solveQuadraticRootsReal$1(l,d,c);return _.each(y,m=>{if(m>=0&&m<=1){const O=this.positionAt(m),D=this.tangentAt(m).normalized(),z=D.perpendicular,w=O.minus(e.position);if(w.dot(e.direction)>0){const N=z.dot(e.direction)>0?z.negated():z,H=e.direction.perpendicular.dot(D)<0?1:-1;t.push(new RayIntersection(w.magnitude,O,N,H,m))}}}),t}windingIntersection(e){let t=0;const n=this.intersection(e);return _.each(n,r=>{t+=r.wind}),t}writeToContext(e){e.quadraticCurveTo(this._control.x,this._control.y,this._end.x,this._end.y)}transformed(e){return new Quadratic(e.timesVector2(this._start),e.timesVector2(this._control),e.timesVector2(this._end))}getSignedAreaFragment(){return 1/6*(this._start.x*(2*this._control.y+this._end.y)+this._control.x*(-2*this._start.y+2*this._end.y)+this._end.x*(-this._start.y-2*this._control.y))}reparameterized(e,t){const n=this._start.plus(this._end.plus(this._control.timesScalar(-2))),r=this._control.minus(this._start).timesScalar(2),s=this._start,a=n.timesScalar(e*e),l=n.timesScalar(e*t).timesScalar(2).plus(r.timesScalar(e)),d=n.timesScalar(t*t).plus(r.timesScalar(t)).plus(s);return new Quadratic(d,l.timesScalar(.5).plus(d),a.plus(l).plus(d))}reversed(){return new Quadratic(this._end,this._control,this._start)}serialize(){return{type:"Quadratic",startX:this._start.x,startY:this._start.y,controlX:this._control.x,controlY:this._control.y,endX:this._end.x,endY:this._end.y}}getOverlaps(e,t=1e-6){return e instanceof Quadratic?Quadratic.getOverlaps(this,e):null}static deserialize(e){return assert&&assert(e.type==="Quadratic"),new Quadratic(new Vector2(e.startX,e.startY),new Vector2(e.controlX,e.controlY),new Vector2(e.endX,e.endY))}static extremaT(e,t,n){const r=2*(n-2*t+e);return r!==0?-2*(t-e)/r:NaN}static getOverlaps(e,t,n=1e-6){const r=[],s=e._start.x,a=-2*e._start.x+2*e._control.x,l=e._start.x-2*e._control.x+e._end.x,d=e._start.y,c=-2*e._start.y+2*e._control.y,y=e._start.y-2*e._control.y+e._end.y,m=t._start.x,O=-2*t._start.x+2*t._control.x,D=t._start.x-2*t._control.x+t._end.x,z=t._start.y,w=-2*t._start.y+2*t._control.y,N=t._start.y-2*t._control.y+t._end.y,H=Math.abs(Math.max(e._start.x,e._control.x,e._end.x,t._start.x,t._control.x,t._end.x)-Math.min(e._start.x,e._control.x,e._end.x,t._start.x,t._control.x,t._end.x)),X=Math.abs(Math.max(e._start.y,e._control.y,e._end.y,t._start.y,t._control.y,t._end.y)-Math.min(e._start.y,e._control.y,e._end.y,t._start.y,t._control.y,t._end.y)),ae=Segment.polynomialGetOverlapQuadratic(s,a,l,m,O,D),oe=Segment.polynomialGetOverlapQuadratic(d,c,y,z,w,N);let ue;if(H>X?ue=ae===null||ae===!0?oe:ae:ue=oe===null||oe===!0?ae:oe,ue===null||ue===!0)return r;const fe=ue.a,be=ue.b,Ae=fe*fe,W=be*be,J=2*fe*be,Ue=m+be*O+W*D-s,gt=fe*O+J*D-a,Te=Ae*D-l,Et=z+be*w+W*N-d,Bt=fe*w+J*N-c,Ke=Ae*N-y,At=DotUtils.solveLinearRootsReal(2*Te,gt),nt=DotUtils.solveLinearRootsReal(2*Ke,Bt),dt=_.uniq([0,1].concat(At?At.filter(isBetween0And1$1):[])),Mt=_.uniq([0,1].concat(nt?nt.filter(isBetween0And1$1):[]));for(let Gt=0;Gt<dt.length;Gt++){const yi=dt[Gt];if(Math.abs((Te*yi+gt)*yi+Ue)>n)return r}for(let Gt=0;Gt<Mt.length;Gt++){const yi=Mt[Gt];if(Math.abs((Ke*yi+Bt)*yi+Et)>n)return r}const zt=be,xt=fe+be;return zt>1&&xt>1||zt<0&&xt<0?r:[new Overlap(fe,be)]}}Quadratic.prototype.degree=2;kite.register("Quadratic",Quadratic);const solveQuadraticRootsReal=DotUtils.solveQuadraticRootsReal,solveCubicRootsReal=DotUtils.solveCubicRootsReal,arePointsCollinear=DotUtils.arePointsCollinear,scratchVector1=new Vector2(0,0),scratchVector2=new Vector2(0,0),scratchVector3=new Vector2(0,0);function isBetween0And1(o){return o>=0&&o<=1}class Cubic extends Segment{constructor(e,t,n,r){super(),this._start=e,this._control1=t,this._control2=n,this._end=r,this.invalidate()}setStart(e){return assert&&assert(e.isFinite(),`Cubic start should be finite: ${e.toString()}`),this._start.equals(e)||(this._start=e,this.invalidate()),this}set start(e){this.setStart(e)}get start(){return this.getStart()}getStart(){return this._start}setControl1(e){return assert&&assert(e.isFinite(),`Cubic control1 should be finite: ${e.toString()}`),this._control1.equals(e)||(this._control1=e,this.invalidate()),this}set control1(e){this.setControl1(e)}get control1(){return this.getControl1()}getControl1(){return this._control1}setControl2(e){return assert&&assert(e.isFinite(),`Cubic control2 should be finite: ${e.toString()}`),this._control2.equals(e)||(this._control2=e,this.invalidate()),this}set control2(e){this.setControl2(e)}get control2(){return this.getControl2()}getControl2(){return this._control2}setEnd(e){return assert&&assert(e.isFinite(),`Cubic end should be finite: ${e.toString()}`),this._end.equals(e)||(this._end=e,this.invalidate()),this}set end(e){this.setEnd(e)}get end(){return this.getEnd()}getEnd(){return this._end}positionAt(e){assert&&assert(e>=0,"positionAt t should be non-negative"),assert&&assert(e<=1,"positionAt t should be no greater than 1");const t=1-e,n=t*t*t,r=3*t*t*e,s=3*t*e*e,a=e*e*e;return new Vector2(this._start.x*n+this._control1.x*r+this._control2.x*s+this._end.x*a,this._start.y*n+this._control1.y*r+this._control2.y*s+this._end.y*a)}tangentAt(e){assert&&assert(e>=0,"tangentAt t should be non-negative"),assert&&assert(e<=1,"tangentAt t should be no greater than 1");const t=1-e;return new Vector2(0,0).set(this._start).multiplyScalar(-3*t*t).add(scratchVector1.set(this._control1).multiplyScalar(3*t*t-6*t*e)).add(scratchVector1.set(this._control2).multiplyScalar(6*t*e-3*e*e)).add(scratchVector1.set(this._end).multiplyScalar(3*e*e))}curvatureAt(e){if(assert&&assert(e>=0,"curvatureAt t should be non-negative"),assert&&assert(e<=1,"curvatureAt t should be no greater than 1"),Math.abs(e-.5)>.5-1e-7){const n=e<.5,r=n?this._start:this._end,s=n?this._control1:this._control2,a=n?this._control2:this._control1,l=s.minus(r),d=l.magnitude;return(n?-1:1)*l.perpendicular.normalized().dot(a.minus(s))*(this.degree-1)/(this.degree*d*d)}else return this.subdivided(e)[0].curvatureAt(1)}subdivided(e){if(assert&&assert(e>=0,"subdivided t should be non-negative"),assert&&assert(e<=1,"subdivided t should be no greater than 1"),e===0||e===1)return[this];const t=this._start.blend(this._control1,e),n=this._control2.blend(this._end,e),r=this._control1.blend(this._control2,e),s=t.blend(r,e),a=r.blend(n,e),l=s.blend(a,e);return[new Cubic(this._start,t,s,l),new Cubic(l,a,n,this._end)]}invalidate(){assert&&assert(this._start instanceof Vector2,`Cubic start should be a Vector2: ${this._start}`),assert&&assert(this._start.isFinite(),`Cubic start should be finite: ${this._start.toString()}`),assert&&assert(this._control1 instanceof Vector2,`Cubic control1 should be a Vector2: ${this._control1}`),assert&&assert(this._control1.isFinite(),`Cubic control1 should be finite: ${this._control1.toString()}`),assert&&assert(this._control2 instanceof Vector2,`Cubic control2 should be a Vector2: ${this._control2}`),assert&&assert(this._control2.isFinite(),`Cubic control2 should be finite: ${this._control2.toString()}`),assert&&assert(this._end instanceof Vector2,`Cubic end should be a Vector2: ${this._end}`),assert&&assert(this._end.isFinite(),`Cubic end should be finite: ${this._end.toString()}`),this._startTangent=null,this._endTangent=null,this._r=null,this._s=null,this._tCusp=null,this._tDeterminant=null,this._tInflection1=null,this._tInflection2=null,this._quadratics=null,this._xExtremaT=null,this._yExtremaT=null,this._bounds=null,this._svgPathFragment=null,this.invalidationEmitter.emit()}getStartTangent(){return this._startTangent===null&&(this._startTangent=this.tangentAt(0).normalized()),this._startTangent}get startTangent(){return this.getStartTangent()}getEndTangent(){return this._endTangent===null&&(this._endTangent=this.tangentAt(1).normalized()),this._endTangent}get endTangent(){return this.getEndTangent()}getR(){return this._r===null&&(this._r=this._control1.minus(this._start).normalized()),this._r}get r(){return this.getR()}getS(){return this._s===null&&(this._s=this.getR().perpendicular),this._s}get s(){return this.getS()}getTCusp(){return this._tCusp===null&&this.computeCuspInfo(),assert&&assert(this._tCusp!==null),this._tCusp}get tCusp(){return this.getTCusp()}getTDeterminant(){return this._tDeterminant===null&&this.computeCuspInfo(),assert&&assert(this._tDeterminant!==null),this._tDeterminant}get tDeterminant(){return this.getTDeterminant()}getTInflection1(){return this._tInflection1===null&&this.computeCuspInfo(),assert&&assert(this._tInflection1!==null),this._tInflection1}get tInflection1(){return this.getTInflection1()}getTInflection2(){return this._tInflection2===null&&this.computeCuspInfo(),assert&&assert(this._tInflection2!==null),this._tInflection2}get tInflection2(){return this.getTInflection2()}getQuadratics(){return this._quadratics===null&&this.computeCuspSegments(),assert&&assert(this._quadratics!==null),this._quadratics}getXExtremaT(){return this._xExtremaT===null&&(this._xExtremaT=Cubic.extremaT(this._start.x,this._control1.x,this._control2.x,this._end.x)),this._xExtremaT}get xExtremaT(){return this.getXExtremaT()}getYExtremaT(){return this._yExtremaT===null&&(this._yExtremaT=Cubic.extremaT(this._start.y,this._control1.y,this._control2.y,this._end.y)),this._yExtremaT}get yExtremaT(){return this.getYExtremaT()}getBounds(){return this._bounds===null&&(this._bounds=Bounds2.NOTHING,this._bounds=this._bounds.withPoint(this._start),this._bounds=this._bounds.withPoint(this._end),_.each(this.getXExtremaT(),e=>{e>=0&&e<=1&&(this._bounds=this._bounds.withPoint(this.positionAt(e)))}),_.each(this.getYExtremaT(),e=>{e>=0&&e<=1&&(this._bounds=this._bounds.withPoint(this.positionAt(e)))}),this.hasCusp()&&(this._bounds=this._bounds.withPoint(this.positionAt(this.getTCusp())))),this._bounds}get bounds(){return this.getBounds()}computeCuspInfo(){const e=this._start.times(-1).plus(this._control1.times(3)).plus(this._control2.times(-3)).plus(this._end),t=this._start.times(3).plus(this._control1.times(-6)).plus(this._control2.times(3)),n=this._start.times(-3).plus(this._control1.times(3)),r=e.perpendicular,s=t.perpendicular,a=r.dot(t);if(this._tCusp=-.5*(r.dot(n)/a),this._tDeterminant=this._tCusp*this._tCusp-1/3*(s.dot(n)/a),this._tDeterminant>=0){const l=Math.sqrt(this._tDeterminant);this._tInflection1=this._tCusp-l,this._tInflection2=this._tCusp+l}else this._tInflection1=NaN,this._tInflection2=NaN}computeCuspSegments(){if(this.hasCusp()){this._quadratics=[];const e=this.getTCusp();if(e===0)this._quadratics.push(new Quadratic(this.start,this.control2,this.end));else if(e===1)this._quadratics.push(new Quadratic(this.start,this.control1,this.end));else{const t=this.subdivided(e);this._quadratics.push(new Quadratic(t[0].start,t[0].control1,t[0].end)),this._quadratics.push(new Quadratic(t[1].start,t[1].control2,t[1].end))}}else this._quadratics=null}getNondegenerateSegments(){const e=this._start,t=this._control1,n=this._control2,r=this._end,s=this.degreeReduced(1e-9);if(e.equals(r)&&e.equals(t)&&e.equals(n))return[];if(this.hasCusp())return _.flatten(this.getQuadratics().map(a=>a.getNondegenerateSegments()));if(s)return s.getNondegenerateSegments();if(arePointsCollinear(e,t,r)&&arePointsCollinear(e,n,r)&&!e.equalsEpsilon(r,1e-7)){const a=this.getXExtremaT().concat(this.getYExtremaT()).sort().map(c=>this.positionAt(c)),l=[];let d=e;a.length&&(l.push(new Line$1(e,a[0])),d=a[0]);for(let c=1;c<a.length;c++)l.push(new Line$1(a[c-1],a[c])),d=a[c];return l.push(new Line$1(d,r)),_.flatten(l.map(c=>c.getNondegenerateSegments()))}else return[this]}hasCusp(){const e=this.getTCusp();return e>=0&&e<=1&&this.tangentAt(e).magnitude<1e-7}toRS(e){const t=e.minus(this._start);return new Vector2(t.dot(this.getR()),t.dot(this.getS()))}offsetTo(e,t){const r=[],s=[];for(let a=0;a<32;a++){let l=a/31;t&&(l=1-l),r.push(this.positionAt(l).plus(this.tangentAt(l).perpendicular.normalized().times(e))),a>0&&s.push(new Line$1(r[a-1],r[a]))}return s}getSVGPathFragment(){let e;return assert&&(e=this._svgPathFragment,this._svgPathFragment=null),this._svgPathFragment||(this._svgPathFragment=`C ${svgNumber(this._control1.x)} ${svgNumber(this._control1.y)} ${svgNumber(this._control2.x)} ${svgNumber(this._control2.y)} ${svgNumber(this._end.x)} ${svgNumber(this._end.y)}`),assert&&e&&assert(e===this._svgPathFragment,"Quadratic line segment changed without invalidate()"),this._svgPathFragment}strokeLeft(e){return this.offsetTo(-e/2,!1)}strokeRight(e){return this.offsetTo(e/2,!0)}getInteriorExtremaTs(){const e=this.getXExtremaT().concat(this.getYExtremaT()),t=[];return _.each(e,n=>{n>1e-10&&n<1-1e-10&&_.every(t,s=>Math.abs(n-s)>1e-10)&&t.push(n)}),t.sort()}intersection(e){const t=[],n=Matrix3.rotation2(-e.direction.angle).timesMatrix(Matrix3.translation(-e.position.x,-e.position.y)),r=n.timesVector2(this._start),s=n.timesVector2(this._control1),a=n.timesVector2(this._control2),l=n.timesVector2(this._end),d=-r.y+3*s.y-3*a.y+l.y,c=3*r.y-6*s.y+3*a.y,y=-3*r.y+3*s.y,m=r.y,O=solveCubicRootsReal(d,c,y,m);return _.each(O,D=>{if(D>=0&&D<=1){const z=this.positionAt(D),w=this.tangentAt(D).normalized(),N=w.perpendicular,H=z.minus(e.position);if(H.dot(e.direction)>0){const X=N.dot(e.direction)>0?N.negated():N,ae=e.direction.perpendicular.dot(w)<0?1:-1;t.push(new RayIntersection(H.magnitude,z,X,ae,D))}}}),t}windingIntersection(e){let t=0;const n=this.intersection(e);return _.each(n,r=>{t+=r.wind}),t}writeToContext(e){e.bezierCurveTo(this._control1.x,this._control1.y,this._control2.x,this._control2.y,this._end.x,this._end.y)}transformed(e){return new Cubic(e.timesVector2(this._start),e.timesVector2(this._control1),e.timesVector2(this._control2),e.timesVector2(this._end))}degreeReduced(e){e=e||0;const t=scratchVector1.set(this._control1).multiplyScalar(3).subtract(this._start).divideScalar(2),n=scratchVector2.set(this._control2).multiplyScalar(3).subtract(this._end).divideScalar(2);return scratchVector3.set(t).subtract(n).magnitude<=e?new Quadratic(this._start,t.average(n),this._end):null}getSignedAreaFragment(){return 1/20*(this._start.x*(6*this._control1.y+3*this._control2.y+this._end.y)+this._control1.x*(-6*this._start.y+3*this._control2.y+3*this._end.y)+this._control2.x*(-3*this._start.y-3*this._control1.y+6*this._end.y)+this._end.x*(-this._start.y-3*this._control1.y-6*this._control2.y))}reversed(){return new Cubic(this._end,this._control2,this._control1,this._start)}getSelfIntersection(){const e=this.getInteriorExtremaTs(),t=[0].concat(e).concat([1]),n=this.subdivisions(e);if(n.length<3)return null;for(let r=0;r<n.length;r++){const s=n[r];for(let a=r+1;a<n.length;a++){const l=n[a],d=BoundsIntersection.intersect(s,l);if(assert&&assert(d.length<2),d.length){const c=d[0];if(c.aT>1e-7&&c.aT<1-1e-7&&c.bT>1e-7&&c.bT<1-1e-7){const y=t[r]+c.aT*(t[r+1]-t[r]),m=t[a]+c.bT*(t[a+1]-t[a]);return new SegmentIntersection(c.point,y,m)}}}}return null}serialize(){return{type:"Cubic",startX:this._start.x,startY:this._start.y,control1X:this._control1.x,control1Y:this._control1.y,control2X:this._control2.x,control2Y:this._control2.y,endX:this._end.x,endY:this._end.y}}getOverlaps(e,t=1e-6){return e instanceof Cubic?Cubic.getOverlaps(this,e):null}static deserialize(e){return assert&&assert(e.type==="Cubic"),new Cubic(new Vector2(e.startX,e.startY),new Vector2(e.control1X,e.control1Y),new Vector2(e.control2X,e.control2Y),new Vector2(e.endX,e.endY))}static extremaT(e,t,n,r){if(e===t&&e===n&&e===r)return[];const s=-3*e+9*t-9*n+3*r,a=6*e-12*t+6*n,l=-3*e+3*t;return _.filter(solveQuadraticRootsReal(s,a,l),isBetween0And1)}static getOverlaps(e,t,n=1e-6){const r=[],s=e._start.x,a=-3*e._start.x+3*e._control1.x,l=3*e._start.x-6*e._control1.x+3*e._control2.x,d=-1*e._start.x+3*e._control1.x-3*e._control2.x+e._end.x,c=e._start.y,y=-3*e._start.y+3*e._control1.y,m=3*e._start.y-6*e._control1.y+3*e._control2.y,O=-1*e._start.y+3*e._control1.y-3*e._control2.y+e._end.y,D=t._start.x,z=-3*t._start.x+3*t._control1.x,w=3*t._start.x-6*t._control1.x+3*t._control2.x,N=-1*t._start.x+3*t._control1.x-3*t._control2.x+t._end.x,H=t._start.y,X=-3*t._start.y+3*t._control1.y,ae=3*t._start.y-6*t._control1.y+3*t._control2.y,oe=-1*t._start.y+3*t._control1.y-3*t._control2.y+t._end.y,ue=Math.abs(Math.max(e._start.x,e._control1.x,e._control2.x,e._end.x,e._start.x,e._control1.x,e._control2.x,e._end.x)-Math.min(e._start.x,e._control1.x,e._control2.x,e._end.x,e._start.x,e._control1.x,e._control2.x,e._end.x)),fe=Math.abs(Math.max(e._start.y,e._control1.y,e._control2.y,e._end.y,e._start.y,e._control1.y,e._control2.y,e._end.y)-Math.min(e._start.y,e._control1.y,e._control2.y,e._end.y,e._start.y,e._control1.y,e._control2.y,e._end.y)),be=Segment.polynomialGetOverlapCubic(s,a,l,d,D,z,w,N),Ae=Segment.polynomialGetOverlapCubic(c,y,m,O,H,X,ae,oe);let W;if(ue>fe?W=be===null||be===!0?Ae:be:W=Ae===null||Ae===!0?be:Ae,W===null||W===!0)return r;const J=W.a,Ue=W.b,gt=J*J,Te=J*J*J,Et=Ue*Ue,Bt=Ue*Ue*Ue,Ke=2*J*Ue,At=3*J*Et,nt=3*gt*Ue,dt=D+Ue*z+Et*w+Bt*N-s,Mt=J*z+Ke*w+At*N-a,zt=gt*w+nt*N-l,xt=Te*N-d,Gt=H+Ue*X+Et*ae+Bt*oe-c,yi=J*X+Ke*ae+At*oe-y,ti=gt*ae+nt*oe-m,Mi=Te*oe-O,Li=DotUtils.solveQuadraticRootsReal(3*xt,2*zt,Mt),qi=DotUtils.solveQuadraticRootsReal(3*Mi,2*ti,yi),Pi=_.uniq([0,1].concat(Li!==null?Li.filter(isBetween0And1):[])),Oi=_.uniq([0,1].concat(qi!==null?qi.filter(isBetween0And1):[]));for(let is=0;is<Pi.length;is++){const hs=Pi[is];if(Math.abs(((xt*hs+zt)*hs+Mt)*hs+dt)>n)return r}for(let is=0;is<Oi.length;is++){const hs=Oi[is];if(Math.abs(((Mi*hs+ti)*hs+yi)*hs+Gt)>n)return r}const $t=Ue,Rs=J+Ue;return $t>1&&Rs>1||$t<0&&Rs<0?r:[new Overlap(J,Ue)]}}Cubic.prototype.degree=3;kite.register("Cubic",Cubic);const TWO_PI=Math.PI*2;class Arc extends Segment{constructor(e,t,n,r,s){super(),this._center=e,this._radius=t,this._startAngle=n,this._endAngle=r,this._anticlockwise=s,this.invalidate()}setCenter(e){return assert&&assert(e.isFinite(),`Arc center should be finite: ${e.toString()}`),this._center.equals(e)||(this._center=e,this.invalidate()),this}set center(e){this.setCenter(e)}get center(){return this.getCenter()}getCenter(){return this._center}setRadius(e){return assert&&assert(isFinite(e),`Arc radius should be a finite number: ${e}`),this._radius!==e&&(this._radius=e,this.invalidate()),this}set radius(e){this.setRadius(e)}get radius(){return this.getRadius()}getRadius(){return this._radius}setStartAngle(e){return assert&&assert(isFinite(e),`Arc startAngle should be a finite number: ${e}`),this._startAngle!==e&&(this._startAngle=e,this.invalidate()),this}set startAngle(e){this.setStartAngle(e)}get startAngle(){return this.getStartAngle()}getStartAngle(){return this._startAngle}setEndAngle(e){return assert&&assert(isFinite(e),`Arc endAngle should be a finite number: ${e}`),this._endAngle!==e&&(this._endAngle=e,this.invalidate()),this}set endAngle(e){this.setEndAngle(e)}get endAngle(){return this.getEndAngle()}getEndAngle(){return this._endAngle}setAnticlockwise(e){return this._anticlockwise!==e&&(this._anticlockwise=e,this.invalidate()),this}set anticlockwise(e){this.setAnticlockwise(e)}get anticlockwise(){return this.getAnticlockwise()}getAnticlockwise(){return this._anticlockwise}positionAt(e){return assert&&assert(e>=0,"positionAt t should be non-negative"),assert&&assert(e<=1,"positionAt t should be no greater than 1"),this.positionAtAngle(this.angleAt(e))}tangentAt(e){return assert&&assert(e>=0,"tangentAt t should be non-negative"),assert&&assert(e<=1,"tangentAt t should be no greater than 1"),this.tangentAtAngle(this.angleAt(e))}curvatureAt(e){return assert&&assert(e>=0,"curvatureAt t should be non-negative"),assert&&assert(e<=1,"curvatureAt t should be no greater than 1"),(this._anticlockwise?-1:1)/this._radius}subdivided(e){if(assert&&assert(e>=0,"subdivided t should be non-negative"),assert&&assert(e<=1,"subdivided t should be no greater than 1"),e===0||e===1)return[this];const t=this.angleAt(0),n=this.angleAt(e),r=this.angleAt(1);return[new Arc(this._center,this._radius,t,n,this._anticlockwise),new Arc(this._center,this._radius,n,r,this._anticlockwise)]}invalidate(){this._start=null,this._end=null,this._startTangent=null,this._endTangent=null,this._actualEndAngle=null,this._isFullPerimeter=null,this._angleDifference=null,this._bounds=null,this._svgPathFragment=null,assert&&assert(this._center instanceof Vector2,"Arc center should be a Vector2"),assert&&assert(this._center.isFinite(),"Arc center should be finite (not NaN or infinite)"),assert&&assert(typeof this._radius=="number",`Arc radius should be a number: ${this._radius}`),assert&&assert(isFinite(this._radius),`Arc radius should be a finite number: ${this._radius}`),assert&&assert(typeof this._startAngle=="number",`Arc startAngle should be a number: ${this._startAngle}`),assert&&assert(isFinite(this._startAngle),`Arc startAngle should be a finite number: ${this._startAngle}`),assert&&assert(typeof this._endAngle=="number",`Arc endAngle should be a number: ${this._endAngle}`),assert&&assert(isFinite(this._endAngle),`Arc endAngle should be a finite number: ${this._endAngle}`),assert&&assert(typeof this._anticlockwise=="boolean",`Arc anticlockwise should be a boolean: ${this._anticlockwise}`),this._radius<0&&(this._radius=-this._radius,this._startAngle+=Math.PI,this._endAngle+=Math.PI),assert&&assert(!(!this.anticlockwise&&this._endAngle-this._startAngle<=-Math.PI*2||this.anticlockwise&&this._startAngle-this._endAngle<=-Math.PI*2),"Not handling arcs with start/end angles that show differences in-between browser handling"),assert&&assert(!(!this.anticlockwise&&this._endAngle-this._startAngle>Math.PI*2||this.anticlockwise&&this._startAngle-this._endAngle>Math.PI*2),"Not handling arcs with start/end angles that show differences in-between browser handling"),this.invalidationEmitter.emit()}getStart(){return this._start===null&&(this._start=this.positionAtAngle(this._startAngle)),this._start}get start(){return this.getStart()}getEnd(){return this._end===null&&(this._end=this.positionAtAngle(this._endAngle)),this._end}get end(){return this.getEnd()}getStartTangent(){return this._startTangent===null&&(this._startTangent=this.tangentAtAngle(this._startAngle)),this._startTangent}get startTangent(){return this.getStartTangent()}getEndTangent(){return this._endTangent===null&&(this._endTangent=this.tangentAtAngle(this._endAngle)),this._endTangent}get endTangent(){return this.getEndTangent()}getActualEndAngle(){return this._actualEndAngle===null&&(this._actualEndAngle=Arc.computeActualEndAngle(this._startAngle,this._endAngle,this._anticlockwise)),this._actualEndAngle}get actualEndAngle(){return this.getActualEndAngle()}getIsFullPerimeter(){return this._isFullPerimeter===null&&(this._isFullPerimeter=!this._anticlockwise&&this._endAngle-this._startAngle>=Math.PI*2||this._anticlockwise&&this._startAngle-this._endAngle>=Math.PI*2),this._isFullPerimeter}get isFullPerimeter(){return this.getIsFullPerimeter()}getAngleDifference(){return this._angleDifference===null&&(this._angleDifference=this._anticlockwise?this._startAngle-this._endAngle:this._endAngle-this._startAngle,this._angleDifference<0&&(this._angleDifference+=Math.PI*2),assert&&assert(this._angleDifference>=0)),this._angleDifference}get angleDifference(){return this.getAngleDifference()}getBounds(){return this._bounds===null&&(this._bounds=Bounds2.NOTHING.copy().withPoint(this.getStart()).withPoint(this.getEnd()),this._startAngle!==this._endAngle&&(this.includeBoundsAtAngle(0),this.includeBoundsAtAngle(Math.PI/2),this.includeBoundsAtAngle(Math.PI),this.includeBoundsAtAngle(3*Math.PI/2))),this._bounds}get bounds(){return this.getBounds()}getNondegenerateSegments(){return this._radius<=0||this._startAngle===this._endAngle?[]:[this]}includeBoundsAtAngle(e){this.containsAngle(e)&&(this._bounds=this._bounds.withPoint(this._center.plus(Vector2.createPolar(this._radius,e))))}mapAngle(e){return Math.abs(DotUtils.moduloBetweenDown(e-this._startAngle,-Math.PI,Math.PI))<1e-8?this._startAngle:Math.abs(DotUtils.moduloBetweenDown(e-this.getActualEndAngle(),-Math.PI,Math.PI))<1e-8?this.getActualEndAngle():this._startAngle>this.getActualEndAngle()?DotUtils.moduloBetweenUp(e,this._startAngle-2*Math.PI,this._startAngle):DotUtils.moduloBetweenDown(e,this._startAngle,this._startAngle+2*Math.PI)}tAtAngle(e){const t=(this.mapAngle(e)-this._startAngle)/(this.getActualEndAngle()-this._startAngle);return assert&&assert(t>=0&&t<=1,`tAtAngle out of range: ${t}`),t}angleAt(e){return this._startAngle+(this.getActualEndAngle()-this._startAngle)*e}positionAtAngle(e){return this._center.plus(Vector2.createPolar(this._radius,e))}tangentAtAngle(e){const t=Vector2.createPolar(1,e);return this._anticlockwise?t.perpendicular:t.perpendicular.negated()}containsAngle(e){const t=this._anticlockwise?e-this._endAngle:e-this._startAngle;return DotUtils.moduloBetweenDown(t,0,Math.PI*2)<=this.angleDifference}getSVGPathFragment(){let e;if(assert&&(e=this._svgPathFragment,this._svgPathFragment=null),!this._svgPathFragment){const n=this._anticlockwise?"0":"1";let r;if(this.angleDifference<Math.PI*2-.01)r=this.angleDifference<Math.PI?"0":"1",this._svgPathFragment=`A ${svgNumber(this._radius)} ${svgNumber(this._radius)} 0 ${r} ${n} ${svgNumber(this.end.x)} ${svgNumber(this.end.y)}`;else{const s=(this._startAngle+this._endAngle)/2,a=this._center.plus(Vector2.createPolar(this._radius,s));r="0";const l=`A ${svgNumber(this._radius)} ${svgNumber(this._radius)} 0 ${r} ${n} ${svgNumber(a.x)} ${svgNumber(a.y)}`,d=`A ${svgNumber(this._radius)} ${svgNumber(this._radius)} 0 ${r} ${n} ${svgNumber(this.end.x)} ${svgNumber(this.end.y)}`;this._svgPathFragment=`${l} ${d}`}}return assert&&e&&assert(e===this._svgPathFragment,"Quadratic line segment changed without invalidate()"),this._svgPathFragment}strokeLeft(e){return[new Arc(this._center,this._radius+(this._anticlockwise?1:-1)*e/2,this._startAngle,this._endAngle,this._anticlockwise)]}strokeRight(e){return[new Arc(this._center,this._radius+(this._anticlockwise?-1:1)*e/2,this._endAngle,this._startAngle,!this._anticlockwise)]}getInteriorExtremaTs(){const e=[];return _.each([0,Math.PI/2,Math.PI,3*Math.PI/2],t=>{if(this.containsAngle(t)){const n=this.tAtAngle(t),r=1e-10;n>r&&n<1-r&&e.push(n)}}),e.sort()}intersection(e){const t=[],r=e.position.minus(this._center),s=e.direction.dot(r),a=r.magnitudeSquared,l=4*s*s-4*(a-this._radius*this._radius);if(l<0)return t;const d=e.direction.dot(this._center)-e.direction.dot(e.position),c=Math.sqrt(l)/2,y=d-c,m=d+c;if(m<0)return t;const O=e.pointAtDistance(m),D=O.minus(this._center).normalized(),z=D.angle;if(y<0)this.containsAngle(z)&&t.push(new RayIntersection(m,O,D.negated(),this._anticlockwise?-1:1,this.tAtAngle(z)));else{const w=e.pointAtDistance(y),N=w.minus(this._center).normalized(),H=N.angle;this.containsAngle(H)&&t.push(new RayIntersection(y,w,N,this._anticlockwise?1:-1,this.tAtAngle(H))),this.containsAngle(z)&&t.push(new RayIntersection(m,O,D.negated(),this._anticlockwise?-1:1,this.tAtAngle(z)))}return t}windingIntersection(e){let t=0;const n=this.intersection(e);return _.each(n,r=>{t+=r.wind}),t}writeToContext(e){e.arc(this._center.x,this._center.y,this._radius,this._startAngle,this._endAngle,this._anticlockwise)}transformed(e){const t=e.timesVector2(Vector2.createPolar(1,this._startAngle)).minus(e.timesVector2(Vector2.ZERO)).angle;let n=e.timesVector2(Vector2.createPolar(1,this._endAngle)).minus(e.timesVector2(Vector2.ZERO)).angle;const r=e.getDeterminant()>=0?this._anticlockwise:!this._anticlockwise;Math.abs(this._endAngle-this._startAngle)===Math.PI*2&&(n=r?t-Math.PI*2:t+Math.PI*2);const s=e.getScaleVector();if(s.x!==s.y){const a=s.x*this._radius,l=s.y*this._radius;return new EllipticalArc(e.timesVector2(this._center),a,l,0,t,n,r)}else{const a=s.x*this._radius;return new Arc(e.timesVector2(this._center),a,t,n,r)}}getSignedAreaFragment(){const e=this._startAngle,t=this.getActualEndAngle();return .5*this._radius*(this._radius*(t-e)+this._center.x*(Math.sin(t)-Math.sin(e))-this._center.y*(Math.cos(t)-Math.cos(e)))}reversed(){return new Arc(this._center,this._radius,this._endAngle,this._startAngle,!this._anticlockwise)}getArcLength(){return this.getAngleDifference()*this._radius}toPiecewiseLinearOrArcSegments(){return[this]}serialize(){return{type:"Arc",centerX:this._center.x,centerY:this._center.y,radius:this._radius,startAngle:this._startAngle,endAngle:this._endAngle,anticlockwise:this._anticlockwise}}getOverlaps(e,t=1e-6){return e instanceof Arc?Arc.getOverlaps(this,e):null}getConicMatrix(){const e=this.center.x,t=this.center.y,n=1,r=0,s=1,a=-2*e,l=-2*t,d=e*e+t*t-this.radius*this.radius;return Matrix3.rowMajor(n,r/2,a/2,r/2,s,l/2,a/2,l/2,d)}static deserialize(e){return assert&&assert(e.type==="Arc"),new Arc(new Vector2(e.centerX,e.centerY),e.radius,e.startAngle,e.endAngle,e.anticlockwise)}static computeActualEndAngle(e,t,n){return n?e>t?t:e<t?t-2*Math.PI:e:e<t?t:e>t?t+Math.PI*2:e}static getPartialOverlap(e,t,n,r,s){assert&&assert(e>0&&e<=TWO_PI+1e-10),assert&&assert(t>=0&&t<TWO_PI+1e-10),assert&&assert(n>=0&&n<=TWO_PI+1e-10),assert&&assert(r>=0&&r<=1),assert&&assert(s>=0&&s<=1);const a=n<t,l=a?n:t,d=a?t:n,c=l,y=Math.min(e,d);return y<c+1e-8?[]:[Overlap.createLinear(DotUtils.clamp(DotUtils.linear(0,e,0,1,c),0,1),DotUtils.clamp(DotUtils.linear(t,n,r,s,c),0,1),DotUtils.clamp(DotUtils.linear(0,e,0,1,y),0,1),DotUtils.clamp(DotUtils.linear(t,n,r,s,y),0,1))]}static getAngularOverlaps(e,t,n,r){assert&&assert(isFinite(e)),assert&&assert(isFinite(t)),assert&&assert(isFinite(n)),assert&&assert(isFinite(r));let s=t-e;const a=s<0?-1:1;s*=a;const l=DotUtils.moduloBetweenDown(a*(n-e),0,TWO_PI),d=a*(r-n)+l;let c;return d<-1e-10?(c=-l/(d-l),Arc.getPartialOverlap(s,l,0,0,c).concat(Arc.getPartialOverlap(s,TWO_PI,d+TWO_PI,c,1))):d>TWO_PI+1e-10?(c=(TWO_PI-l)/(d-l),Arc.getPartialOverlap(s,l,TWO_PI,0,c).concat(Arc.getPartialOverlap(s,0,d-TWO_PI,c,1))):Arc.getPartialOverlap(s,l,d,0,1)}static getOverlaps(e,t){return e._center.distance(t._center)>1e-4||Math.abs(e._radius-t._radius)>1e-4?[]:Arc.getAngularOverlaps(e._startAngle,e.getActualEndAngle(),t._startAngle,t.getActualEndAngle())}static getCircleIntersectionPoint(e,t,n,r){assert&&assert(isFinite(t)&&t>=0),assert&&assert(isFinite(r)&&r>=0);const s=n.minus(e),a=s.magnitude;let l=[];if(!(a<1e-10||a>t+r+1e-10))if(a>t+r-1e-10)l=[e.blend(n,t/a)];else{const d=.5*(a*a-r*r+t*t)/a,c=a*a-r*r+t*t,y=4*a*a*t*t-c*c,m=e.blend(n,d/a);if(y>=1e-10){const O=Math.sqrt(y)/a/2,D=s.perpendicular.setMagnitude(O);l=[m.plus(D),m.minus(D)]}else y>-1e-10&&(l=[m])}return assert&&l.forEach(d=>{assert(Math.abs(d.distance(e)-t)<1e-8),assert(Math.abs(d.distance(n)-r)<1e-8)}),l}static intersect(e,t){const r=[];if(e._center.equalsEpsilon(t._center,1e-8)&&Math.abs(e._radius-t._radius)<1e-8){const s=e.positionAt(0),a=e.positionAt(1),l=t.positionAt(0),d=t.positionAt(1);s.equalsEpsilon(l,1e-8)&&r.push(new SegmentIntersection(s.average(l),0,0)),s.equalsEpsilon(d,1e-8)&&r.push(new SegmentIntersection(s.average(d),0,1)),a.equalsEpsilon(l,1e-8)&&r.push(new SegmentIntersection(a.average(l),1,0)),a.equalsEpsilon(d,1e-8)&&r.push(new SegmentIntersection(a.average(d),1,1))}else{const s=Arc.getCircleIntersectionPoint(e._center,e._radius,t._center,t._radius);for(let a=0;a<s.length;a++){const l=s[a],d=l.minus(e._center).angle,c=l.minus(t._center).angle;e.containsAngle(d)&&t.containsAngle(c)&&r.push(new SegmentIntersection(l,e.tAtAngle(d),t.tAtAngle(c)))}}return r}static createFromPoints(e,t,n){const r=DotUtils.circleCenterFromPoints(e,t,n);if(r===null)return new Line$1(e,n);{const s=e.minus(r),a=t.minus(r),l=n.minus(r),d=s.angle,c=a.angle,y=l.angle,m=(s.magnitude+a.magnitude+l.magnitude)/3,O=new Arc(r,m,d,y,!1);return O.containsAngle(c)?O:new Arc(r,m,d,y,!0)}}}kite.register("Arc",Arc);const toDegrees=DotUtils.toDegrees,unitCircleConicMatrix=Matrix3.rowMajor(1,0,0,0,1,0,0,0,-1);class EllipticalArc extends Segment{constructor(e,t,n,r,s,a,l){super(),this._center=e,this._radiusX=t,this._radiusY=n,this._rotation=r,this._startAngle=s,this._endAngle=a,this._anticlockwise=l,this.invalidate()}setCenter(e){return assert&&assert(e.isFinite(),`EllipticalArc center should be finite: ${e.toString()}`),this._center.equals(e)||(this._center=e,this.invalidate()),this}set center(e){this.setCenter(e)}get center(){return this.getCenter()}getCenter(){return this._center}setRadiusX(e){return assert&&assert(isFinite(e),`EllipticalArc radiusX should be a finite number: ${e}`),this._radiusX!==e&&(this._radiusX=e,this.invalidate()),this}set radiusX(e){this.setRadiusX(e)}get radiusX(){return this.getRadiusX()}getRadiusX(){return this._radiusX}setRadiusY(e){return assert&&assert(isFinite(e),`EllipticalArc radiusY should be a finite number: ${e}`),this._radiusY!==e&&(this._radiusY=e,this.invalidate()),this}set radiusY(e){this.setRadiusY(e)}get radiusY(){return this.getRadiusY()}getRadiusY(){return this._radiusY}setRotation(e){return assert&&assert(isFinite(e),`EllipticalArc rotation should be a finite number: ${e}`),this._rotation!==e&&(this._rotation=e,this.invalidate()),this}set rotation(e){this.setRotation(e)}get rotation(){return this.getRotation()}getRotation(){return this._rotation}setStartAngle(e){return assert&&assert(isFinite(e),`EllipticalArc startAngle should be a finite number: ${e}`),this._startAngle!==e&&(this._startAngle=e,this.invalidate()),this}set startAngle(e){this.setStartAngle(e)}get startAngle(){return this.getStartAngle()}getStartAngle(){return this._startAngle}setEndAngle(e){return assert&&assert(isFinite(e),`EllipticalArc endAngle should be a finite number: ${e}`),this._endAngle!==e&&(this._endAngle=e,this.invalidate()),this}set endAngle(e){this.setEndAngle(e)}get endAngle(){return this.getEndAngle()}getEndAngle(){return this._endAngle}setAnticlockwise(e){return this._anticlockwise!==e&&(this._anticlockwise=e,this.invalidate()),this}set anticlockwise(e){this.setAnticlockwise(e)}get anticlockwise(){return this.getAnticlockwise()}getAnticlockwise(){return this._anticlockwise}positionAt(e){return assert&&assert(e>=0,"positionAt t should be non-negative"),assert&&assert(e<=1,"positionAt t should be no greater than 1"),this.positionAtAngle(this.angleAt(e))}tangentAt(e){return assert&&assert(e>=0,"tangentAt t should be non-negative"),assert&&assert(e<=1,"tangentAt t should be no greater than 1"),this.tangentAtAngle(this.angleAt(e))}curvatureAt(e){assert&&assert(e>=0,"curvatureAt t should be non-negative"),assert&&assert(e<=1,"curvatureAt t should be no greater than 1");const t=this.angleAt(e),n=this._radiusX*Math.sin(t),r=this._radiusY*Math.cos(t),s=Math.pow(r*r+n*n,3/2);return(this._anticlockwise?-1:1)*this._radiusX*this._radiusY/s}subdivided(e){if(assert&&assert(e>=0,"subdivided t should be non-negative"),assert&&assert(e<=1,"subdivided t should be no greater than 1"),e===0||e===1)return[this];const t=this.angleAt(0),n=this.angleAt(e),r=this.angleAt(1);return[new EllipticalArc(this._center,this._radiusX,this._radiusY,this._rotation,t,n,this._anticlockwise),new EllipticalArc(this._center,this._radiusX,this._radiusY,this._rotation,n,r,this._anticlockwise)]}invalidate(){if(assert&&assert(this._center instanceof Vector2,"Arc center should be a Vector2"),assert&&assert(this._center.isFinite(),"Arc center should be finite (not NaN or infinite)"),assert&&assert(typeof this._radiusX=="number",`Arc radiusX should be a number: ${this._radiusX}`),assert&&assert(isFinite(this._radiusX),`Arc radiusX should be a finite number: ${this._radiusX}`),assert&&assert(typeof this._radiusY=="number",`Arc radiusY should be a number: ${this._radiusY}`),assert&&assert(isFinite(this._radiusY),`Arc radiusY should be a finite number: ${this._radiusY}`),assert&&assert(typeof this._rotation=="number",`Arc rotation should be a number: ${this._rotation}`),assert&&assert(isFinite(this._rotation),`Arc rotation should be a finite number: ${this._rotation}`),assert&&assert(typeof this._startAngle=="number",`Arc startAngle should be a number: ${this._startAngle}`),assert&&assert(isFinite(this._startAngle),`Arc startAngle should be a finite number: ${this._startAngle}`),assert&&assert(typeof this._endAngle=="number",`Arc endAngle should be a number: ${this._endAngle}`),assert&&assert(isFinite(this._endAngle),`Arc endAngle should be a finite number: ${this._endAngle}`),assert&&assert(typeof this._anticlockwise=="boolean",`Arc anticlockwise should be a boolean: ${this._anticlockwise}`),this._unitTransform=null,this._start=null,this._end=null,this._startTangent=null,this._endTangent=null,this._actualEndAngle=null,this._isFullPerimeter=null,this._angleDifference=null,this._unitArcSegment=null,this._bounds=null,this._svgPathFragment=null,this._radiusX<0&&(this._radiusX=-this._radiusX,this._startAngle=Math.PI-this._startAngle,this._endAngle=Math.PI-this._endAngle,this._anticlockwise=!this._anticlockwise),this._radiusY<0&&(this._radiusY=-this._radiusY,this._startAngle=-this._startAngle,this._endAngle=-this._endAngle,this._anticlockwise=!this._anticlockwise),this._radiusX<this._radiusY){this._rotation+=Math.PI/2,this._startAngle-=Math.PI/2,this._endAngle-=Math.PI/2;const e=this._radiusX;this._radiusX=this._radiusY,this._radiusY=e}if(this._radiusX<this._radiusY)throw new Error("Not verified to work if radiusX < radiusY");assert&&assert(!(!this._anticlockwise&&this._endAngle-this._startAngle<=-Math.PI*2||this._anticlockwise&&this._startAngle-this._endAngle<=-Math.PI*2),"Not handling elliptical arcs with start/end angles that show differences in-between browser handling"),assert&&assert(!(!this._anticlockwise&&this._endAngle-this._startAngle>Math.PI*2||this._anticlockwise&&this._startAngle-this._endAngle>Math.PI*2),"Not handling elliptical arcs with start/end angles that show differences in-between browser handling"),this.invalidationEmitter.emit()}getUnitTransform(){return this._unitTransform===null&&(this._unitTransform=EllipticalArc.computeUnitTransform(this._center,this._radiusX,this._radiusY,this._rotation)),this._unitTransform}get unitTransform(){return this.getUnitTransform()}getStart(){return this._start===null&&(this._start=this.positionAtAngle(this._startAngle)),this._start}get start(){return this.getStart()}getEnd(){return this._end===null&&(this._end=this.positionAtAngle(this._endAngle)),this._end}get end(){return this.getEnd()}getStartTangent(){return this._startTangent===null&&(this._startTangent=this.tangentAtAngle(this._startAngle)),this._startTangent}get startTangent(){return this.getStartTangent()}getEndTangent(){return this._endTangent===null&&(this._endTangent=this.tangentAtAngle(this._endAngle)),this._endTangent}get endTangent(){return this.getEndTangent()}getActualEndAngle(){return this._actualEndAngle===null&&(this._actualEndAngle=Arc.computeActualEndAngle(this._startAngle,this._endAngle,this._anticlockwise)),this._actualEndAngle}get actualEndAngle(){return this.getActualEndAngle()}getIsFullPerimeter(){return this._isFullPerimeter===null&&(this._isFullPerimeter=!this._anticlockwise&&this._endAngle-this._startAngle>=Math.PI*2||this._anticlockwise&&this._startAngle-this._endAngle>=Math.PI*2),this._isFullPerimeter}get isFullPerimeter(){return this.getIsFullPerimeter()}getAngleDifference(){return this._angleDifference===null&&(this._angleDifference=this._anticlockwise?this._startAngle-this._endAngle:this._endAngle-this._startAngle,this._angleDifference<0&&(this._angleDifference+=Math.PI*2),assert&&assert(this._angleDifference>=0)),this._angleDifference}get angleDifference(){return this.getAngleDifference()}getUnitArcSegment(){return this._unitArcSegment===null&&(this._unitArcSegment=new Arc(Vector2.ZERO,1,this._startAngle,this._endAngle,this._anticlockwise)),this._unitArcSegment}get unitArcSegment(){return this.getUnitArcSegment()}getBounds(){if(this._bounds===null&&(this._bounds=Bounds2.NOTHING.withPoint(this.getStart()).withPoint(this.getEnd()),this._startAngle!==this._endAngle)){const e=Math.atan(-(this._radiusY/this._radiusX)*Math.tan(this._rotation)),t=Math.atan(this._radiusY/this._radiusX/Math.tan(this._rotation));this.possibleExtremaAngles=[e,e+Math.PI,t,t+Math.PI],_.each(this.possibleExtremaAngles,this.includeBoundsAtAngle.bind(this))}return this._bounds}get bounds(){return this.getBounds()}getNondegenerateSegments(){if(this._radiusX<=0||this._radiusY<=0||this._startAngle===this._endAngle)return[];if(this._radiusX===this._radiusY){const e=this._startAngle+this._rotation;let t=this._endAngle+this._rotation;return Math.abs(this._endAngle-this._startAngle)===Math.PI*2&&(t=this._anticlockwise?e-Math.PI*2:e+Math.PI*2),[new Arc(this._center,this._radiusX,e,t,this._anticlockwise)]}else return[this]}includeBoundsAtAngle(e){this.unitArcSegment.containsAngle(e)&&(this._bounds=this._bounds.withPoint(this.positionAtAngle(e)))}mapAngle(e){return Math.abs(DotUtils.moduloBetweenDown(e-this._startAngle,-Math.PI,Math.PI))<1e-8?this._startAngle:Math.abs(DotUtils.moduloBetweenDown(e-this.getActualEndAngle(),-Math.PI,Math.PI))<1e-8?this.getActualEndAngle():this._startAngle>this.getActualEndAngle()?DotUtils.moduloBetweenUp(e,this._startAngle-2*Math.PI,this._startAngle):DotUtils.moduloBetweenDown(e,this._startAngle,this._startAngle+2*Math.PI)}tAtAngle(e){return(this.mapAngle(e)-this._startAngle)/(this.getActualEndAngle()-this._startAngle)}angleAt(e){return this._startAngle+(this.getActualEndAngle()-this._startAngle)*e}positionAtAngle(e){return this.getUnitTransform().transformPosition2(Vector2.createPolar(1,e))}tangentAtAngle(e){const t=this.getUnitTransform().transformNormal2(Vector2.createPolar(1,e));return this._anticlockwise?t.perpendicular:t.perpendicular.negated()}offsetTo(e,t){const r=[],s=[];for(let a=0;a<32;a++){let l=a/31;t&&(l=1-l);const d=this.angleAt(l);r.push(this.positionAtAngle(d).plus(this.tangentAtAngle(d).perpendicular.normalized().times(e))),a>0&&s.push(new Line$1(r[a-1],r[a]))}return s}getSVGPathFragment(){let e;if(assert&&(e=this._svgPathFragment,this._svgPathFragment=null),!this._svgPathFragment){const n=this._anticlockwise?"0":"1";let r;const s=toDegrees(this._rotation);if(this.getAngleDifference()<Math.PI*2-.01)r=this.getAngleDifference()<Math.PI?"0":"1",this._svgPathFragment=`A ${svgNumber(this._radiusX)} ${svgNumber(this._radiusY)} ${s} ${r} ${n} ${svgNumber(this.getEnd().x)} ${svgNumber(this.getEnd().y)}`;else{const a=(this._startAngle+this._endAngle)/2,l=this.positionAtAngle(a);r="0";const d=`A ${svgNumber(this._radiusX)} ${svgNumber(this._radiusY)} ${s} ${r} ${n} ${svgNumber(l.x)} ${svgNumber(l.y)}`,c=`A ${svgNumber(this._radiusX)} ${svgNumber(this._radiusY)} ${s} ${r} ${n} ${svgNumber(this.getEnd().x)} ${svgNumber(this.getEnd().y)}`;this._svgPathFragment=`${d} ${c}`}}return assert&&e&&assert(e===this._svgPathFragment,"Quadratic line segment changed without invalidate()"),this._svgPathFragment}strokeLeft(e){return this.offsetTo(-e/2,!1)}strokeRight(e){return this.offsetTo(e/2,!0)}getInteriorExtremaTs(){const e=[];return _.each(this.possibleExtremaAngles,t=>{if(this.unitArcSegment.containsAngle(t)){const n=this.tAtAngle(t),r=1e-10;n>r&&n<1-r&&e.push(n)}}),e.sort()}intersection(e){const t=this.getUnitTransform(),n=t.inverseRay2(e),r=this.getUnitArcSegment().intersection(n);return _.map(r,s=>{const a=t.transformPosition2(s.point),l=e.position.distance(a),d=t.inverseNormal2(s.normal);return new RayIntersection(l,a,d,s.wind,s.t)})}windingIntersection(e){const t=this.getUnitTransform().inverseRay2(e);return this.getUnitArcSegment().windingIntersection(t)}writeToContext(e){e.ellipse?e.ellipse(this._center.x,this._center.y,this._radiusX,this._radiusY,this._rotation,this._startAngle,this._endAngle,this._anticlockwise):(this.getUnitTransform().getMatrix().canvasAppendTransform(e),e.arc(0,0,1,this._startAngle,this._endAngle,this._anticlockwise),this.getUnitTransform().getInverse().canvasAppendTransform(e))}transformed(e){const t=e.timesVector2(Vector2.createPolar(this._radiusX,this._rotation)).minus(e.timesVector2(Vector2.ZERO)),n=e.timesVector2(Vector2.createPolar(this._radiusY,this._rotation+Math.PI/2)).minus(e.timesVector2(Vector2.ZERO)),r=t.angle,s=t.magnitude,a=n.magnitude,l=e.getDeterminant()<0,d=l?!this._anticlockwise:this._anticlockwise,c=l?-this._startAngle:this._startAngle;let y=l?-this._endAngle:this._endAngle;return Math.abs(this._endAngle-this._startAngle)===Math.PI*2&&(y=d?c-Math.PI*2:c+Math.PI*2),new EllipticalArc(e.timesVector2(this._center),s,a,r,c,y,d)}getSignedAreaFragment(){const e=this._startAngle,t=this.getActualEndAngle(),n=Math.sin(e),r=Math.sin(t),s=Math.cos(e),a=Math.cos(t);return .5*(this._radiusX*this._radiusY*(t-e)+Math.cos(this._rotation)*(this._radiusX*this._center.y*(s-a)+this._radiusY*this._center.x*(r-n))+Math.sin(this._rotation)*(this._radiusX*this._center.x*(a-s)+this._radiusY*this._center.y*(r-n)))}reversed(){return new EllipticalArc(this._center,this._radiusX,this._radiusY,this._rotation,this._endAngle,this._startAngle,!this._anticlockwise)}serialize(){return{type:"EllipticalArc",centerX:this._center.x,centerY:this._center.y,radiusX:this._radiusX,radiusY:this._radiusY,rotation:this._rotation,startAngle:this._startAngle,endAngle:this._endAngle,anticlockwise:this._anticlockwise}}getOverlaps(e,t=1e-6){return e instanceof EllipticalArc?EllipticalArc.getOverlaps(this,e):null}getConicMatrix(){const t=EllipticalArc.computeUnitMatrix(this._center,this._radiusX,this._radiusY,this._rotation).inverted();return t.transposed().multiplyMatrix(unitCircleConicMatrix).multiplyMatrix(t)}static deserialize(e){return assert&&assert(e.type==="EllipticalArc"),new EllipticalArc(new Vector2(e.centerX,e.centerY),e.radiusX,e.radiusY,e.rotation,e.startAngle,e.endAngle,e.anticlockwise)}static getOverlapType(e,t,n=1e-4){if(e._center.distance(t._center)<n){const r=Math.abs(e._radiusX-t._radiusX)<n&&Math.abs(e._radiusY-t._radiusY)<n,s=Math.abs(e._radiusX-t._radiusY)<n&&Math.abs(e._radiusY-t._radiusX)<n;if(r&&Math.abs(DotUtils.moduloBetweenDown(e._rotation-t._rotation+Math.PI/2,0,Math.PI)-Math.PI/2)<n)return EllipticalArcOverlapType.MATCHING_OVERLAP;if(s&&Math.abs(DotUtils.moduloBetweenDown(e._rotation-t._rotation,0,Math.PI)-Math.PI/2)<n)return EllipticalArcOverlapType.OPPOSITE_OVERLAP}return EllipticalArcOverlapType.NONE}static getOverlaps(e,t){return EllipticalArc.getOverlapType(e,t)===EllipticalArcOverlapType.NONE?[]:Arc.getAngularOverlaps(e._startAngle+e._rotation,e.getActualEndAngle()+e._rotation,t._startAngle+t._rotation,t.getActualEndAngle()+t._rotation)}static intersect(e,t,n=1e-10){if(EllipticalArc.getOverlapType(e,t,n)===EllipticalArcOverlapType.NONE)return BoundsIntersection.intersect(e,t);{const s=[],a=e.positionAt(0),l=e.positionAt(1),d=t.positionAt(0),c=t.positionAt(1);return a.equalsEpsilon(d,n)&&s.push(new SegmentIntersection(a.average(d),0,0)),a.equalsEpsilon(c,n)&&s.push(new SegmentIntersection(a.average(c),0,1)),l.equalsEpsilon(d,n)&&s.push(new SegmentIntersection(l.average(d),1,0)),l.equalsEpsilon(c,n)&&s.push(new SegmentIntersection(l.average(c),1,1)),s}}static computeUnitMatrix(e,t,n,r){return Matrix3.translationFromVector(e).timesMatrix(Matrix3.rotation2(r)).timesMatrix(Matrix3.scaling(t,n))}static computeUnitTransform(e,t,n,r){return new Transform3(EllipticalArc.computeUnitMatrix(e,t,n,r))}}const to=class to extends EnumerationValue{};to.MATCHING_OVERLAP=new to,to.OPPOSITE_OVERLAP=new to,to.NONE=new to,to.enumeration=new Enumeration(to);let EllipticalArcOverlapType=to;kite.register("EllipticalArc",EllipticalArc);class Subpath{constructor(e,t,n){if(this.segments=[],this.invalidatedEmitter=new TinyEmitter,this._bounds=null,this._strokedSubpaths=null,this._strokedSubpathsComputed=!1,this._strokedStyles=null,this._invalidatingPoints=!1,this.points=t||(e&&e.length?_.map(e,r=>r.start).concat(e[e.length-1].end):[]),this.closed=!!n,this._invalidateListener=this.invalidate.bind(this),e)for(let r=0;r<e.length;r++)_.each(e[r].getNondegenerateSegments(),s=>{this.addSegmentDirectly(s)})}getBounds(){if(this._bounds===null){const e=Bounds2.NOTHING.copy();_.each(this.segments,t=>{e.includeBounds(t.getBounds())}),this._bounds=e}return this._bounds}get bounds(){return this.getBounds()}getArcLength(e,t,n){let r=0;for(let s=0;s<this.segments.length;s++)r+=this.segments[s].getArcLength(e,t,n);return r}copy(){return new Subpath(this.segments.slice(0),this.points.slice(0),this.closed)}invalidatePoints(){this._invalidatingPoints=!0;const e=this.segments.length;for(let t=0;t<e;t++)this.segments[t].invalidate();this._invalidatingPoints=!1,this.invalidate()}invalidate(){this._invalidatingPoints||(this._bounds=null,this._strokedSubpathsComputed=!1,this.invalidatedEmitter.emit())}addPoint(e){return this.points.push(e),this}addSegmentDirectly(e){return assert&&assert(e.start.isFinite(),"Segment start is infinite"),assert&&assert(e.end.isFinite(),"Segment end is infinite"),assert&&assert(e.startTangent.isFinite(),"Segment startTangent is infinite"),assert&&assert(e.endTangent.isFinite(),"Segment endTangent is infinite"),assert&&assert(e.bounds.isEmpty()||e.bounds.isFinite(),"Segment bounds is infinite and non-empty"),this.segments.push(e),e.invalidationEmitter.addListener(this._invalidateListener),this}addSegment(e){const n=e.getNondegenerateSegments().length;for(let r=0;r<n;r++)this.addSegmentDirectly(e);return this.invalidate(),this}addClosingSegment(){if(this.hasClosingSegment()){const e=this.getClosingSegment();this.addSegmentDirectly(e),this.invalidate(),this.addPoint(this.getFirstPoint()),this.closed=!0}}close(){this.closed=!0,this.addClosingSegment()}getLength(){return this.points.length}getFirstPoint(){return assert&&assert(this.points.length),_.first(this.points)}getLastPoint(){return assert&&assert(this.points.length),_.last(this.points)}getFirstSegment(){return assert&&assert(this.segments.length),_.first(this.segments)}getLastSegment(){return assert&&assert(this.segments.length),_.last(this.segments)}getFillSegments(){const e=this.segments.slice();return this.hasClosingSegment()&&e.push(this.getClosingSegment()),e}isDrawable(){return this.segments.length>0}isClosed(){return this.closed}hasClosingSegment(){return!this.getFirstPoint().equalsEpsilon(this.getLastPoint(),1e-9)}getClosingSegment(){return assert&&assert(this.hasClosingSegment(),"Implicit closing segment unnecessary on a fully closed path"),new Line$1(this.getLastPoint(),this.getFirstPoint())}getClosestPoints(e){return Segment.filterClosestToPointResult(_.flatten(this.segments.map(t=>t.getClosestPoints(e))))}writeToContext(e){if(this.isDrawable()){const t=this.getFirstSegment().start;e.moveTo(t.x,t.y);let n=this.segments.length;this.closed&&n>=2&&this.segments[n-1]instanceof Line$1&&n--;for(let r=0;r<n;r++)this.segments[r].writeToContext(e);this.closed&&e.closePath()}}toPiecewiseLinear(e){return assert&&assert(!e.pointMap,"For use with pointMap, please use nonlinearTransformed"),new Subpath(_.flatten(_.map(this.segments,t=>t.toPiecewiseLinearSegments(e))),void 0,this.closed)}transformed(e){return new Subpath(_.map(this.segments,t=>t.transformed(e)),_.map(this.points,t=>e.timesVector2(t)),this.closed)}nonlinearTransformed(e){return new Subpath(_.flatten(_.map(this.segments,t=>e.methodName&&t[e.methodName]?t[e.methodName](e):t.toPiecewiseLinearSegments(e))),void 0,this.closed)}getBoundsWithTransform(e){const t=Bounds2.NOTHING.copy(),n=this.segments.length;for(let r=0;r<n;r++)t.includeBounds(this.segments[r].getBoundsWithTransform(e));return t}offset(e){if(!this.isDrawable())return new Subpath([],void 0,this.closed);if(e===0)return new Subpath(this.segments.slice(),void 0,this.closed);let t;const n=this.segments.slice(),r=[];for(t=0;t<n.length;t++)r.push(n[t].strokeLeft(2*e));let s=[];for(t=0;t<n.length;t++){if(this.closed||t>0){const a=(t>0?t:n.length)-1,l=n[t].start,d=n[a].endTangent,c=n[t].startTangent,y=d.perpendicular.negated().times(e).angle,m=c.perpendicular.negated().times(e).angle,O=d.perpendicular.dot(c)>0;s.push(new Arc(l,Math.abs(e),y,m,O))}s=s.concat(r[t])}return new Subpath(s,void 0,this.closed)}stroked(e){if(!this.isDrawable())return[];if(e===void 0&&(e=new LineStyles),assert&&assert(!this._strokedSubpathsComputed||this._strokedStyles&&this._strokedSubpaths),this._strokedSubpathsComputed&&this._strokedStyles.equals(e))return this._strokedSubpaths;const t=e.lineWidth;let n,r=[],s=[];const a=this.getFirstSegment(),l=this.getLastSegment(),d=D=>{r=r.concat(D)},c=D=>{s=s.concat(D)},y=l.end.equals(a.start),m=y?null:new Line$1(this.segments[this.segments.length-1].end,this.segments[0].start);for(n=0;n<this.segments.length;n++)n>0&&d(e.leftJoin(this.segments[n].start,this.segments[n-1].endTangent,this.segments[n].startTangent)),d(this.segments[n].strokeLeft(t));for(n=this.segments.length-1;n>=0;n--)n<this.segments.length-1&&c(e.rightJoin(this.segments[n].end,this.segments[n].endTangent,this.segments[n+1].startTangent)),c(this.segments[n].strokeRight(t));let O;return this.closed?(y?(d(e.leftJoin(l.end,l.endTangent,a.startTangent)),c(e.rightJoin(l.end,l.endTangent,a.startTangent))):(d(e.leftJoin(m.start,l.endTangent,m.startTangent)),d(m.strokeLeft(t)),d(e.leftJoin(m.end,m.endTangent,a.startTangent)),c(e.rightJoin(m.end,m.endTangent,a.startTangent)),c(m.strokeRight(t)),c(e.rightJoin(m.start,l.endTangent,m.startTangent))),O=[new Subpath(r,void 0,!0),new Subpath(s,void 0,!0)]):O=[new Subpath(r.concat(e.cap(l.end,l.endTangent)).concat(s).concat(e.cap(a.start,a.startTangent.negated())),void 0,!0)],this._strokedSubpaths=O,this._strokedSubpathsComputed=!0,this._strokedStyles=e.copy(),O}dashed(e,t,n,r){const s=(d,c)=>{const y=d[d.length-1].concat(c[0]),m=d.slice(0,d.length-1).concat([y]).concat(c.slice(1));return assert&&assert(m.length===d.length+c.length-1),m},a=(d,c)=>{if(!d.hasRightFilled||!c.hasLeftFilled)return!1;const y=_.last(_.last(d.segmentArrays)),m=c.segmentArrays[0][0];return y.end.distance(m.start)<1e-5},l=[];for(let d=0;d<this.segments.length;d++){const c=this.segments[d],y=c.getDashValues(e,t,n,r);l.push(y),t+=y.arcLength;const m=[0].concat(y.values).concat([1]),O=y.initiallyInside;y.hasLeftFilled=O,y.hasRightFilled=m.length%2===0?O:!O,y.segmentArrays=[];for(let D=O?0:1;D<m.length-1;D+=2)m[D]!==m[D+1]&&y.segmentArrays.push([c.slice(m[D],m[D+1])])}for(let d=l.length-1;d>=1;d--){const c=l[d-1],y=l[d];a(c,y)&&l.splice(d-1,2,{segmentArrays:s(c.segmentArrays,y.segmentArrays),hasLeftFilled:c.hasLeftFilled,hasRightFilled:y.hasRightFilled})}if(l.length>1&&a(l[l.length-1],l[0])){const d=l.pop(),c=l.shift();l.push({segmentArrays:s(d.segmentArrays,c.segmentArrays),hasLeftFilled:d.hasLeftFilled,hasRightFilled:c.hasRightFilled})}return this.closed&&l.length===1&&l[0].segmentArrays.length===1&&l[0].hasLeftFilled&&l[0].hasRightFilled?[new Subpath(l[0].segmentArrays[0],void 0,!0)]:_.flatten(l.map(d=>d.segmentArrays)).map(d=>new Subpath(d))}serialize(){return{type:"Subpath",segments:this.segments.map(e=>e.serialize()),points:this.points.map(e=>({x:e.x,y:e.y})),closed:this.closed}}static deserialize(e){return assert&&assert(e.type==="Subpath"),new Subpath(e.segments.map(Segment.deserialize),e.points.map(t=>new Vector2(t.x,t.y)),e.closed)}}kite.register("Subpath",Subpath);const Subpath$1=Subpath,randomSource=Math.random,v=(o,e)=>new Vector2(o,e),weightedSplineVector=(o,e,t,n)=>t.copy().subtract(o).multiplyScalar((1-n)/6).add(e),Ds=class Ds{constructor(e,t){if(this.subpaths=[],this._invalidatingPoints=!1,this._immutable=!1,this.invalidatedEmitter=new TinyEmitter,this.lastQuadraticControlPoint=null,this.lastCubicControlPoint=null,this._bounds=t?t.copy():null,this.resetControlPoints(),this._invalidateListener=this.invalidate.bind(this),typeof e=="object")for(let n=0;n<e.length;n++)this.addSubpath(e[n]);e&&typeof e!="object"&&_.each(svgPath.parse(e),n=>{assert&&assert(Ds.prototype[n.cmd]!==void 0,`method ${n.cmd} from parsed SVG does not exist`),this[n.cmd].apply(this,n.args)}),this.invalidate()}resetControlPoints(){this.lastQuadraticControlPoint=null,this.lastCubicControlPoint=null}setQuadraticControlPoint(e){this.lastQuadraticControlPoint=e,this.lastCubicControlPoint=null}setCubicControlPoint(e){this.lastQuadraticControlPoint=null,this.lastCubicControlPoint=e}moveTo(e,t){return assert&&assert(isFinite(e),`x must be a finite number: ${e}`),assert&&assert(isFinite(t),`y must be a finite number: ${t}`),this.moveToPoint(v(e,t))}moveToRelative(e,t){return assert&&assert(isFinite(e),`x must be a finite number: ${e}`),assert&&assert(isFinite(t),`y must be a finite number: ${t}`),this.moveToPointRelative(v(e,t))}moveToPointRelative(e){return this.moveToPoint(this.getRelativePoint().plus(e))}moveToPoint(e){return this.addSubpath(new Subpath$1().addPoint(e)),this.resetControlPoints(),this}lineTo(e,t){return assert&&assert(isFinite(e),`x must be a finite number: ${e}`),assert&&assert(isFinite(t),`y must be a finite number: ${t}`),this.lineToPoint(v(e,t))}lineToRelative(e,t){return assert&&assert(isFinite(e),`x must be a finite number: ${e}`),assert&&assert(isFinite(t),`y must be a finite number: ${t}`),this.lineToPointRelative(v(e,t))}lineToPointRelative(e){return this.lineToPoint(this.getRelativePoint().plus(e))}lineToPoint(e){if(this.hasSubpaths()){const t=this.getLastSubpath().getLastPoint(),n=e,r=new Line$1(t,n);this.getLastSubpath().addPoint(n),this.addSegmentAndBounds(r)}else this.ensure(e);return this.resetControlPoints(),this}horizontalLineTo(e){return this.lineTo(e,this.getRelativePoint().y)}horizontalLineToRelative(e){return this.lineToRelative(e,0)}verticalLineTo(e){return this.lineTo(this.getRelativePoint().x,e)}verticalLineToRelative(e){return this.lineToRelative(0,e)}zigZagTo(e,t,n,r,s){return this.zigZagToPoint(new Vector2(e,t),n,r,s)}zigZagToPoint(e,t,n,r){assert&&assert(Number.isInteger(n),`numberZigZags must be an integer: ${n}`),this.ensure(e);const s=this.getLastPoint(),a=e.minus(s),l=a.normalized(),d=l.perpendicular.times(t);let c;r?c=a.magnitude/(n+.5):c=a.magnitude/n;for(let y=0;y<n;y++){const m=l.times(y*c).plus(s),O=m.plus(l.times(c/4)).plus(d),D=m.plus(l.times(3*c/4)).minus(d);this.lineToPoint(O),this.lineToPoint(D)}if(r){const m=l.times(n*c).plus(s).plus(l.times(c/4)).plus(d);this.lineToPoint(m)}return this.lineToPoint(e)}quadraticCurveTo(e,t,n,r){return assert&&assert(isFinite(e),`cpx must be a finite number: ${e}`),assert&&assert(isFinite(t),`cpy must be a finite number: ${t}`),assert&&assert(isFinite(n),`x must be a finite number: ${n}`),assert&&assert(isFinite(r),`y must be a finite number: ${r}`),this.quadraticCurveToPoint(v(e,t),v(n,r))}quadraticCurveToRelative(e,t,n,r){return assert&&assert(isFinite(e),`cpx must be a finite number: ${e}`),assert&&assert(isFinite(t),`cpy must be a finite number: ${t}`),assert&&assert(isFinite(n),`x must be a finite number: ${n}`),assert&&assert(isFinite(r),`y must be a finite number: ${r}`),this.quadraticCurveToPointRelative(v(e,t),v(n,r))}quadraticCurveToPointRelative(e,t){const n=this.getRelativePoint();return this.quadraticCurveToPoint(n.plus(e),n.plus(t))}smoothQuadraticCurveTo(e,t){return assert&&assert(isFinite(e),`x must be a finite number: ${e}`),assert&&assert(isFinite(t),`y must be a finite number: ${t}`),this.quadraticCurveToPoint(this.getSmoothQuadraticControlPoint(),v(e,t))}smoothQuadraticCurveToRelative(e,t){return assert&&assert(isFinite(e),`x must be a finite number: ${e}`),assert&&assert(isFinite(t),`y must be a finite number: ${t}`),this.quadraticCurveToPoint(this.getSmoothQuadraticControlPoint(),v(e,t).plus(this.getRelativePoint()))}quadraticCurveToPoint(e,t){this.ensure(e);const n=this.getLastSubpath().getLastPoint(),r=new Quadratic(n,e,t);this.getLastSubpath().addPoint(t);const s=r.getNondegenerateSegments();return _.each(s,a=>{this.addSegmentAndBounds(a)}),this.setQuadraticControlPoint(e),this}cubicCurveTo(e,t,n,r,s,a){return assert&&assert(isFinite(e),`cp1x must be a finite number: ${e}`),assert&&assert(isFinite(t),`cp1y must be a finite number: ${t}`),assert&&assert(isFinite(n),`cp2x must be a finite number: ${n}`),assert&&assert(isFinite(r),`cp2y must be a finite number: ${r}`),assert&&assert(isFinite(s),`x must be a finite number: ${s}`),assert&&assert(isFinite(a),`y must be a finite number: ${a}`),this.cubicCurveToPoint(v(e,t),v(n,r),v(s,a))}cubicCurveToRelative(e,t,n,r,s,a){return assert&&assert(isFinite(e),`cp1x must be a finite number: ${e}`),assert&&assert(isFinite(t),`cp1y must be a finite number: ${t}`),assert&&assert(isFinite(n),`cp2x must be a finite number: ${n}`),assert&&assert(isFinite(r),`cp2y must be a finite number: ${r}`),assert&&assert(isFinite(s),`x must be a finite number: ${s}`),assert&&assert(isFinite(a),`y must be a finite number: ${a}`),this.cubicCurveToPointRelative(v(e,t),v(n,r),v(s,a))}cubicCurveToPointRelative(e,t,n){const r=this.getRelativePoint();return this.cubicCurveToPoint(r.plus(e),r.plus(t),r.plus(n))}smoothCubicCurveTo(e,t,n,r){return assert&&assert(isFinite(e),`cp2x must be a finite number: ${e}`),assert&&assert(isFinite(t),`cp2y must be a finite number: ${t}`),assert&&assert(isFinite(n),`x must be a finite number: ${n}`),assert&&assert(isFinite(r),`y must be a finite number: ${r}`),this.cubicCurveToPoint(this.getSmoothCubicControlPoint(),v(e,t),v(n,r))}smoothCubicCurveToRelative(e,t,n,r){return assert&&assert(isFinite(e),`cp2x must be a finite number: ${e}`),assert&&assert(isFinite(t),`cp2y must be a finite number: ${t}`),assert&&assert(isFinite(n),`x must be a finite number: ${n}`),assert&&assert(isFinite(r),`y must be a finite number: ${r}`),this.cubicCurveToPoint(this.getSmoothCubicControlPoint(),v(e,t).plus(this.getRelativePoint()),v(n,r).plus(this.getRelativePoint()))}cubicCurveToPoint(e,t,n){this.ensure(e);const r=this.getLastSubpath().getLastPoint(),a=new Cubic(r,e,t,n).getNondegenerateSegments();return _.each(a,l=>{this.addSegmentAndBounds(l)}),this.getLastSubpath().addPoint(n),this.setCubicControlPoint(t),this}arc(e,t,n,r,s,a){return assert&&assert(isFinite(e),`centerX must be a finite number: ${e}`),assert&&assert(isFinite(t),`centerY must be a finite number: ${t}`),this.arcPoint(v(e,t),n,r,s,a)}arcPoint(e,t,n,r,s){s===void 0&&(s=!1);const a=new Arc(e,t,n,r,s),l=a.getStart(),d=a.getEnd();return this.hasSubpaths()&&this.getLastSubpath().getLength()>0&&!l.equals(this.getLastSubpath().getLastPoint())&&this.addSegmentAndBounds(new Line$1(this.getLastSubpath().getLastPoint(),l)),this.hasSubpaths()||this.addSubpath(new Subpath$1),this.getLastSubpath().addPoint(l),this.getLastSubpath().addPoint(d),this.addSegmentAndBounds(a),this.resetControlPoints(),this}ellipticalArc(e,t,n,r,s,a,l,d){return assert&&assert(isFinite(e),`centerX must be a finite number: ${e}`),assert&&assert(isFinite(t),`centerY must be a finite number: ${t}`),this.ellipticalArcPoint(v(e,t),n,r,s,a,l,d)}ellipticalArcPoint(e,t,n,r,s,a,l){l===void 0&&(l=!1);const d=new EllipticalArc(e,t,n,r,s,a,l),c=d.start,y=d.end;return this.hasSubpaths()&&this.getLastSubpath().getLength()>0&&!c.equals(this.getLastSubpath().getLastPoint())&&this.addSegmentAndBounds(new Line$1(this.getLastSubpath().getLastPoint(),c)),this.hasSubpaths()||this.addSubpath(new Subpath$1),this.getLastSubpath().addPoint(c),this.getLastSubpath().addPoint(y),this.addSegmentAndBounds(d),this.resetControlPoints(),this}close(){if(this.hasSubpaths()){const e=this.getLastSubpath(),t=new Subpath$1;e.close(),this.addSubpath(t),t.addPoint(e.getFirstPoint())}return this.resetControlPoints(),this}newSubpath(){return this.addSubpath(new Subpath$1),this.resetControlPoints(),this}makeImmutable(){return this._immutable=!0,this.notifyInvalidationListeners(),this}isImmutable(){return this._immutable}ellipticalArcToRelative(e,t,n,r,s,a,l){const d=this.getRelativePoint();return this.ellipticalArcTo(e,t,n,r,s,a+d.x,l+d.y)}ellipticalArcTo(e,t,n,r,s,a,l){const d=new Vector2(a,l);this.ensure(d);const c=this.getLastSubpath().getLastPoint();this.getLastSubpath().addPoint(d),e<0&&(e*=-1),t<0&&(t*=-1);let y=e*e,m=t*t;const O=c.minus(d).dividedScalar(2).rotated(-n),D=O.x*O.x,z=O.y*O.y;let w=new Vector2(e*O.y/t,-t*O.x/e);const N=D/y+z/m;N>1&&(e*=Math.sqrt(N),t*=Math.sqrt(N),y=e*e,m=t*t,w=new Vector2(e*O.y/t,-t*O.x/e)),w.multiplyScalar(Math.sqrt(Math.max(0,(y*m-y*z-m*D)/(y*z+m*D)))),r===s&&w.multiplyScalar(-1);const H=c.blend(d,.5).plus(w.rotated(n)),X=(W,J)=>(W.x*J.y-W.y*J.x>0?1:-1)*W.angleBetween(J),ae=new Vector2((O.x-w.x)/e,(O.y-w.y)/t),oe=new Vector2((-O.x-w.x)/e,(-O.y-w.y)/t),ue=X(Vector2.X_UNIT,ae);let fe=X(ae,oe)%(Math.PI*2);!s&&fe>0&&(fe-=Math.PI*2),s&&fe<0&&(fe+=Math.PI*2);const Ae=new EllipticalArc(H,e,t,n,ue,ue+fe,!s).getNondegenerateSegments();return _.each(Ae,W=>{this.addSegmentAndBounds(W)}),this}circle(e,t,n){if(typeof e=="object"){const r=e;return n=t,this.arcPoint(r,n,0,Math.PI*2,!1).close()}else return assert&&assert(isFinite(e),`centerX must be a finite number: ${e}`),assert&&assert(isFinite(t),`centerY must be a finite number: ${t}`),this.arcPoint(v(e,t),n,0,Math.PI*2,!1).close()}ellipse(e,t,n,r,s){if(typeof e=="object"){const a=e;return s=r,r=n,n=t,this.ellipticalArcPoint(a,n,r,s||0,0,Math.PI*2,!1).close()}else return assert&&assert(isFinite(e),`centerX must be a finite number: ${e}`),assert&&assert(isFinite(t),`centerY must be a finite number: ${t}`),this.ellipticalArcPoint(v(e,t),n,r,s||0,0,Math.PI*2,!1).close()}rect(e,t,n,r){assert&&assert(isFinite(e),`x must be a finite number: ${e}`),assert&&assert(isFinite(t),`y must be a finite number: ${t}`),assert&&assert(isFinite(n),`width must be a finite number: ${n}`),assert&&assert(isFinite(r),`height must be a finite number: ${r}`);const s=new Subpath$1;return this.addSubpath(s),s.addPoint(v(e,t)),s.addPoint(v(e+n,t)),s.addPoint(v(e+n,t+r)),s.addPoint(v(e,t+r)),this.addSegmentAndBounds(new Line$1(s.points[0],s.points[1])),this.addSegmentAndBounds(new Line$1(s.points[1],s.points[2])),this.addSegmentAndBounds(new Line$1(s.points[2],s.points[3])),s.close(),this.addSubpath(new Subpath$1),this.getLastSubpath().addPoint(v(e,t)),assert&&assert(!isNaN(this.bounds.getX())),this.resetControlPoints(),this}roundRect(e,t,n,r,s,a){const l=e+s,d=e+n-s,c=t+a,y=t+r-a;return s===a?this.arc(d,c,s,-Math.PI/2,0,!1).arc(d,y,s,0,Math.PI/2,!1).arc(l,y,s,Math.PI/2,Math.PI,!1).arc(l,c,s,Math.PI,Math.PI*3/2,!1).close():this.ellipticalArc(d,c,s,a,0,-Math.PI/2,0,!1).ellipticalArc(d,y,s,a,0,0,Math.PI/2,!1).ellipticalArc(l,y,s,a,0,Math.PI/2,Math.PI,!1).ellipticalArc(l,c,s,a,0,Math.PI,Math.PI*3/2,!1).close(),this}polygon(e){const t=e.length;if(t>0){this.moveToPoint(e[0]);for(let n=1;n<t;n++)this.lineToPoint(e[n])}return this.close()}cardinalSpline(e,t){const n=optionize()({tension:0,isClosedLineSegments:!1},t);assert&&assert(n.tension<1&&n.tension>-1," the tension goes from -1 to 1 ");const r=e.length,s=n.isClosedLineSegments?r:r-1;for(let a=0;a<s;a++){let l;a===0&&!n.isClosedLineSegments?l=[e[0],e[0],e[1],e[2]]:a===s-1&&!n.isClosedLineSegments?l=[e[a-1],e[a],e[a+1],e[a+1]]:l=[e[(a-1+r)%r],e[a%r],e[(a+1)%r],e[(a+2)%r]];const d=[l[1],weightedSplineVector(l[0],l[1],l[2],n.tension),weightedSplineVector(l[3],l[2],l[1],n.tension),l[2]];a===0&&(this.ensure(d[0]),this.getLastSubpath().addPoint(d[0])),this.cubicCurveToPoint(d[1],d[2],d[3])}return this}copy(){return new Ds(_.map(this.subpaths,e=>e.copy()),this.bounds)}writeToContext(e){const t=this.subpaths.length;for(let n=0;n<t;n++)this.subpaths[n].writeToContext(e)}getSVGPath(){let e="";const t=this.subpaths.length;for(let n=0;n<t;n++){const r=this.subpaths[n];if(r.isDrawable()){const s=r.segments[0].start;e+=`M ${svgNumber(s.x)} ${svgNumber(s.y)} `;for(let a=0;a<r.segments.length;a++)e+=`${r.segments[a].getSVGPathFragment()} `;r.isClosed()&&(e+="Z ")}}return e}transformed(e){const t=_.map(this.subpaths,r=>r.transformed(e)),n=_.reduce(t,(r,s)=>r.union(s.bounds),Bounds2.NOTHING);return new Ds(t,n)}nonlinearTransformed(e){const t=combineOptions({minLevels:0,maxLevels:7,distanceEpsilon:.16,curveEpsilon:e&&e.includeCurvature?.002:null},e),n=_.map(this.subpaths,s=>s.nonlinearTransformed(t)),r=_.reduce(n,(s,a)=>s.union(a.bounds),Bounds2.NOTHING);return new Ds(n,r)}polarToCartesian(e){return this.nonlinearTransformed(combineOptions({pointMap:t=>Vector2.createPolar(t.y,t.x),methodName:"polarToCartesian"},e))}toPiecewiseLinear(e){return assert&&assert(!e||!e.pointMap,"No pointMap for toPiecewiseLinear allowed, since it could create non-linear segments"),assert&&assert(!e||!e.methodName,"No methodName for toPiecewiseLinear allowed, since it could create non-linear segments"),this.nonlinearTransformed(e)}containsPoint(e){const t=Vector2.X_UNIT.copy();let n=0;for(;n<5&&(n++,_.some(this.subpaths,s=>_.some(s.segments,a=>{const l=a.start.minus(e),d=l.magnitude;return d!==0?(l.divideScalar(d),l.subtract(t),l.magnitudeSquared<1e-9):!1})));)t.rotate(dotRandom.nextDouble());return this.windingIntersection(new Ray2(e,t))!==0}intersection(e){let t=[];const n=this.subpaths.length;for(let r=0;r<n;r++){const s=this.subpaths[r];if(s.isDrawable()){const a=s.segments.length;for(let l=0;l<a;l++){const d=s.segments[l];t=t.concat(d.intersection(e))}s.hasClosingSegment()&&(t=t.concat(s.getClosingSegment().intersection(e)))}}return _.sortBy(t,r=>r.distance)}interiorIntersectsLineSegment(e,t){const n=e.blend(t,.5);if(this.containsPoint(n))return!0;const r=t.minus(e),s=r.magnitude;if(s===0)return!1;r.normalize();const a=this.intersection(new Ray2(e,r));for(let l=0;l<a.length;l++)if(a[l].distance<=s)return!0;return!1}windingIntersection(e){let t=0;const n=this.subpaths.length;for(let r=0;r<n;r++){const s=this.subpaths[r];if(s.isDrawable()){const a=s.segments.length;for(let l=0;l<a;l++)t+=s.segments[l].windingIntersection(e);s.hasClosingSegment()&&(t+=s.getClosingSegment().windingIntersection(e))}}return t}intersectsBounds(e){if(this.bounds.intersection(e).equals(this.bounds))return!0;const t=new Ray2(new Vector2(e.minX,e.minY),new Vector2(1,0)),n=new Ray2(new Vector2(e.minX,e.minY),new Vector2(0,1)),r=new Ray2(new Vector2(e.maxX,e.maxY),new Vector2(-1,0)),s=new Ray2(new Vector2(e.maxX,e.maxY),new Vector2(0,-1));let a,l;const d=this.intersection(t).concat(this.intersection(r));for(l=0;l<d.length;l++)if(a=d[l].point,a.x>=e.minX&&a.x<=e.maxX)return!0;const c=this.intersection(n).concat(this.intersection(s));for(l=0;l<c.length;l++)if(a=c[l].point,a.y>=e.minY&&a.y<=e.maxY)return!0;return!1}getStrokedShape(e){let t=[];const n=Bounds2.NOTHING.copy();let r=this.subpaths.length;for(let s=0;s<r;s++){const l=this.subpaths[s].stroked(e);t=t.concat(l)}r=t.length;for(let s=0;s<r;s++)n.includeBounds(t[s].bounds);return new Ds(t,n)}getOffsetShape(e){const t=[],n=Bounds2.NOTHING.copy();let r=this.subpaths.length;for(let s=0;s<r;s++)t.push(this.subpaths[s].offset(e));r=t.length;for(let s=0;s<r;s++)n.includeBounds(t[s].bounds);return new Ds(t,n)}getDashedShape(e,t,n){const r=optionize()({distanceEpsilon:1e-10,curveEpsilon:1e-8},n);return new Ds(_.flatten(this.subpaths.map(s=>s.dashed(e,t,r.distanceEpsilon,r.curveEpsilon))))}getBounds(){if(this._bounds===null){const e=Bounds2.NOTHING.copy();_.each(this.subpaths,t=>{e.includeBounds(t.getBounds())}),this._bounds=e}return this._bounds}get bounds(){return this.getBounds()}getStrokedBounds(e){let t=!0;for(let n=0;n<this.subpaths.length;n++){const r=this.subpaths[n];if(r.isDrawable()&&!r.isClosed()){t=!1;break}for(let s=0;s<r.segments.length;s++)if(!r.segments[s].areStrokedBoundsDilated()){t=!1;break}}if(t)return this.bounds.dilated(e.lineWidth/2);{const n=this.bounds.copy();for(let r=0;r<this.subpaths.length;r++){const s=this.subpaths[r].stroked(e);for(let a=0;a<s.length;a++)n.includeBounds(s[a].bounds)}return n}}getSimplifiedAreaShape(){return Graph$1.simplifyNonZero(this)}getBoundsWithTransform(e,t){const n=Bounds2.NOTHING.copy(),r=this.subpaths.length;for(let s=0;s<r;s++){const a=this.subpaths[s];n.includeBounds(a.getBoundsWithTransform(e))}return t&&n.includeBounds(this.getStrokedShape(t).getBoundsWithTransform(e)),n}getApproximateArea(e){const t=this.bounds.minX,n=this.bounds.minY,r=this.bounds.width,s=this.bounds.height,a=r*s;let l=0;const d=new Vector2(0,0);for(let c=0;c<e;c++)d.x=t+randomSource()*r,d.y=n+randomSource()*s,this.containsPoint(d)&&l++;return a*l/e}getNonoverlappingArea(){return Math.abs(_.sum(this.subpaths.map(e=>_.sum(e.getFillSegments().map(t=>t.getSignedAreaFragment())))))}getArea(){return this.getSimplifiedAreaShape().getNonoverlappingArea()}getApproximateCentroid(e){const t=this.bounds.minX,n=this.bounds.minY,r=this.bounds.width,s=this.bounds.height;let a=0;const l=new Vector2(0,0),d=new Vector2(0,0);for(let c=0;c<e;c++)d.x=t+randomSource()*r,d.y=n+randomSource()*s,this.containsPoint(d)&&(l.add(d),a++);return l.dividedScalar(a)}getClosestPoints(e){return Segment.filterClosestToPointResult(_.flatten(this.subpaths.map(t=>t.getClosestPoints(e))))}getClosestPoint(e){return this.getClosestPoints(e)[0].closestPoint}invalidatePoints(){this._invalidatingPoints=!0;const e=this.subpaths.length;for(let t=0;t<e;t++)this.subpaths[t].invalidatePoints();this._invalidatingPoints=!1,this.invalidate()}toString(){return`new phet.kite.Shape( '${this.getSVGPath()}' )`}invalidate(){assert&&assert(!this._immutable,"Attempt to modify an immutable Shape"),this._invalidatingPoints||(this._bounds=null,this.notifyInvalidationListeners())}notifyInvalidationListeners(){this.invalidatedEmitter.emit()}addSegmentAndBounds(e){this.getLastSubpath().addSegment(e),this.invalidate()}ensure(e){this.hasSubpaths()||(this.addSubpath(new Subpath$1),this.getLastSubpath().addPoint(e))}addSubpath(e){return this.subpaths.push(e),e.invalidatedEmitter.addListener(this._invalidateListener),this.invalidate(),this}hasSubpaths(){return this.subpaths.length>0}getLastSubpath(){return assert&&assert(this.hasSubpaths(),"We should have a subpath if this is called"),_.last(this.subpaths)}getLastPoint(){return assert&&assert(this.hasSubpaths(),"We should have a subpath if this is called"),assert&&assert(this.getLastSubpath().getLastPoint(),"We should have a last point"),this.getLastSubpath().getLastPoint()}getLastSegment(){if(!this.hasSubpaths())return null;const e=this.getLastSubpath();return e.isDrawable()?e.getLastSegment():null}getSmoothQuadraticControlPoint(){const e=this.getLastPoint();return this.lastQuadraticControlPoint?e.plus(e.minus(this.lastQuadraticControlPoint)):e}getSmoothCubicControlPoint(){const e=this.getLastPoint();return this.lastCubicControlPoint?e.plus(e.minus(this.lastCubicControlPoint)):e}getRelativePoint(){let e=Vector2.ZERO;if(this.hasSubpaths()){const t=this.getLastSubpath();t.points.length&&(e=t.getLastPoint())}return e}shapeUnion(e){return Graph$1.binaryResult(this,e,Graph$1.BINARY_NONZERO_UNION)}shapeIntersection(e){return Graph$1.binaryResult(this,e,Graph$1.BINARY_NONZERO_INTERSECTION)}shapeDifference(e){return Graph$1.binaryResult(this,e,Graph$1.BINARY_NONZERO_DIFFERENCE)}shapeXor(e){return Graph$1.binaryResult(this,e,Graph$1.BINARY_NONZERO_XOR)}shapeClip(e,t){return Graph$1.clipShape(e,this,t)}getArcLength(e,t,n){let r=0;for(let s=0;s<this.subpaths.length;s++)r+=this.subpaths[s].getArcLength(e,t,n);return r}serialize(){return{type:"Shape",subpaths:this.subpaths.map(e=>e.serialize())}}static deserialize(e){return assert&&assert(e.type==="Shape"),new Ds(e.subpaths.map(Subpath$1.deserialize))}static rectangle(e,t,n,r){return new Ds().rect(e,t,n,r)}static roundRect(e,t,n,r,s,a){return new Ds().roundRect(e,t,n,r,s,a)}static roundedRectangleWithRadii(e,t,n,r,s){let a=s&&s.topLeft||0,l=s&&s.topRight||0,d=s&&s.bottomLeft||0,c=s&&s.bottomRight||0;assert&&assert(isFinite(e),"Non-finite x"),assert&&assert(isFinite(t),"Non-finite y"),assert&&assert(n>=0&&isFinite(n),"Negative or non-finite width"),assert&&assert(r>=0&&isFinite(r),"Negative or non-finite height"),assert&&assert(a>=0&&isFinite(a),"Invalid topLeft"),assert&&assert(l>=0&&isFinite(l),"Invalid topRight"),assert&&assert(d>=0&&isFinite(d),"Invalid bottomLeft"),assert&&assert(c>=0&&isFinite(c),"Invalid bottomRight");const y=a+l;y>n&&y>0&&(a=a/y*n,l=l/y*n);const m=d+c;m>n&&m>0&&(d=d/m*n,c=c/m*n);const O=a+d;O>r&&O>0&&(a=a/O*r,d=d/O*r);const D=l+c;D>r&&D>0&&(l=l/D*r,c=c/D*r),assert&&assert(a+l<=n,"Corner overlap on top edge"),assert&&assert(d+c<=n,"Corner overlap on bottom edge"),assert&&assert(a+d<=r,"Corner overlap on left edge"),assert&&assert(l+c<=r,"Corner overlap on right edge");const z=new Ds,w=e+n,N=t+r;return c>0?z.arc(w-c,N-c,c,0,Math.PI/2,!1):z.moveTo(w,N),d>0?z.arc(e+d,N-d,d,Math.PI/2,Math.PI,!1):z.lineTo(e,N),a>0?z.arc(e+a,t+a,a,Math.PI,3*Math.PI/2,!1):z.lineTo(e,t),l>0?z.arc(w-l,t+l,l,3*Math.PI/2,2*Math.PI,!1):z.lineTo(w,t),z.close(),z}static boundsOffsetWithRadii(e,t,n){const r=e.withOffsets(t.left,t.top,t.right,t.bottom);return Ds.roundedRectangleWithRadii(r.minX,r.minY,r.width,r.height,n)}static polygon(e){return new Ds().polygon(e)}static bounds(e){return new Ds().rect(e.minX,e.minY,e.maxX-e.minX,e.maxY-e.minY)}static lineSegment(e,t,n,r){return typeof e=="number"?new Ds().moveTo(e,t).lineTo(n,r):new Ds().moveToPoint(e).lineToPoint(t)}static regularPolygon(e,t){const n=new Ds;return _.each(_.range(e),r=>{const s=Vector2.createPolar(t,2*Math.PI*r/e);r===0?n.moveToPoint(s):n.lineToPoint(s)}),n.close()}static circle(e,t,n){return t===void 0?new Ds().circle(0,0,e):new Ds().circle(e,t,n)}static ellipse(e,t,n,r,s){return r===void 0?new Ds().ellipse(0,0,e,t,n):new Ds().ellipse(e,t,n,r,s)}static arc(e,t,n,r,s,a){return new Ds().arc(e,t,n,r,s,a)}static union(e){return Graph$1.unionNonZero(e)}static intersection(e){return Graph$1.intersectionNonZero(e)}static xor(e){return Graph$1.xorNonZero(e)}static segments(e,t){if(assert)for(let n=1;n<e.length;n++)assert(e[n-1].end.equalsEpsilon(e[n].start,1e-6),"Mismatched start/end");return new Ds([new Subpath$1(e,void 0,!!t)])}};Ds.rect=Ds.rectangle,Ds.roundRectangle=Ds.roundRect;let Shape=Ds;kite.register("Shape",Shape);const Shape$1=Shape;let globaId$5=0;const Pl=class Pl{constructor(e,t){this.id=++globaId$5,this.initialize(e,t)}initialize(e,t){return assert&&assert(e instanceof kite.Edge),assert&&assert(typeof t=="boolean"),this.edge=e,this.face=null,this.isReversed=t,this.signedAreaFragment=e.signedAreaFragment*(t?-1:1),this.startVertex=null,this.endVertex=null,this.sortVector=this.sortVector||new Vector2(0,0),this.data=null,this.updateReferences(),this}serialize(){return{type:"HalfEdge",id:this.id,edge:this.edge.id,face:this.face===null?null:this.face.id,isReversed:this.isReversed,signedAreaFragment:this.signedAreaFragment,startVertex:this.startVertex===null?null:this.startVertex.id,endVertex:this.endVertex===null?null:this.endVertex.id,sortVector:Vector2.Vector2IO.toStateObject(this.sortVector),data:this.data}}dispose(){this.edge=null,this.face=null,this.startVertex=null,this.endVertex=null,this.data=null,this.freeToPool()}getNext(e){for(let t=1;;t++){let n=this.endVertex.incidentHalfEdges.indexOf(this)-t;n<0&&(n+=this.endVertex.incidentHalfEdges.length);const r=this.endVertex.incidentHalfEdges[n].getReversed();if(!(e&&!e(r.edge)))return assert&&assert(this.endVertex===r.startVertex),r}}updateReferences(){this.startVertex=this.isReversed?this.edge.endVertex:this.edge.startVertex,this.endVertex=this.isReversed?this.edge.startVertex:this.edge.endVertex,assert&&assert(this.startVertex),assert&&assert(this.endVertex)}getEndTangent(){return this.isReversed?this.edge.segment.startTangent:this.edge.segment.endTangent.negated()}getEndCurvature(){return this.isReversed?-this.edge.segment.curvatureAt(0):this.edge.segment.curvatureAt(1)}getReversed(){return this.isReversed?this.edge.forwardHalf:this.edge.reversedHalf}getDirectionalSegment(){return this.isReversed?this.edge.segment.reversed():this.edge.segment}freeToPool(){Pl.pool.freeToPool(this)}};ut(Pl,"pool",new Pool(Pl));let HalfEdge=Pl;kite.register("HalfEdge",HalfEdge);let globaId$4=0;const Ja=class Ja{constructor(e){this.id=++globaId$4,this.initialize(e)}initialize(e){return assert&&assert(e instanceof Vector2),this.point=e,this.incidentHalfEdges=cleanArray(this.incidentHalfEdges),this.visited=!1,this.visitIndex=0,this.lowIndex=0,this.data=null,this.internalData={},this}serialize(){return{type:"Vertex",id:this.id,point:Vector2.Vector2IO.toStateObject(this.point),incidentHalfEdges:this.incidentHalfEdges.map(e=>e.id),visited:this.visited,visitIndex:this.visitIndex,lowIndex:this.lowIndex}}dispose(){this.point=Vector2.ZERO,cleanArray(this.incidentHalfEdges),this.freeToPool()}sortEdges(){const e=[];for(let r=0;r<this.incidentHalfEdges.length;r++){const s=this.incidentHalfEdges[r];e.push(s.sortVector.setXY(s.getEndTangent().angle,s.getEndCurvature()))}const t=-Math.PI+1e-4;let n=!1;for(;!n;){n=!0;for(let r=0;r<e.length;r++)e[r].x<t&&(n=!1);if(!n)for(let r=0;r<e.length;r++){const s=e[r];s.x-=1.62594024516,s.x<-Math.PI-1e-4&&(s.x+=Math.PI*2)}}this.incidentHalfEdges.sort(Ja.edgeComparison)}static edgeComparison(e,t){const n=e.sortVector.x,r=t.sortVector.x;if(Math.abs(n-r)>1e-5||n!==r&&e.edge.segment instanceof Line$1&&t.edge.segment instanceof Line$1)return n<r?-1:1;{const s=e.sortVector.y,a=t.sortVector.y;if(Math.abs(s-a)>1e-5)return s<a?1:-1;{const d=e.getDirectionalSegment().subdivided(.999)[1].curvatureAt(0),c=t.getDirectionalSegment().subdivided(.999)[1].curvatureAt(0);return d<c?1:-1}}}freeToPool(){Ja.pool.freeToPool(this)}};ut(Ja,"pool",new Pool(Ja));let Vertex=Ja;kite.register("Vertex",Vertex);let globaId$3=0;const Ll=class Ll{constructor(e,t,n){this.id=++globaId$3,this.initialize(e,t,n)}initialize(e,t,n){return assert&&assert(e instanceof Segment),assert&&assert(t instanceof Vertex),assert&&assert(n instanceof Vertex),assert&&assert(e.start.distance(t.point)<.001),assert&&assert(e.end.distance(n.point)<.001),this.segment=e,this.startVertex=t,this.endVertex=n,this.signedAreaFragment=e.getSignedAreaFragment(),this.forwardHalf=HalfEdge.pool.create(this,!1),this.reversedHalf=HalfEdge.pool.create(this,!0),this.visited=!1,this.data=null,this.internalData={},this}serialize(){return{type:"Edge",id:this.id,segment:this.segment.serialize(),startVertex:this.startVertex===null?null:this.startVertex.id,endVertex:this.endVertex===null?null:this.endVertex.id,signedAreaFragment:this.signedAreaFragment,forwardHalf:this.forwardHalf.serialize(),reversedHalf:this.reversedHalf.serialize(),visited:this.visited,data:this.data}}dispose(){this.segment=null,this.startVertex=null,this.endVertex=null,this.forwardHalf.dispose(),this.reversedHalf.dispose(),this.forwardHalf=null,this.reversedHalf=null,this.data=null,this.freeToPool()}getOtherVertex(e){return assert&&assert(e===this.startVertex||e===this.endVertex),this.startVertex===e?this.endVertex:this.startVertex}updateReferences(){this.forwardHalf.updateReferences(),this.reversedHalf.updateReferences(),assert&&assert(!(this.segment instanceof Line$1)||this.startVertex!==this.endVertex,"No line segments for same vertices")}freeToPool(){Ll.pool.freeToPool(this)}};ut(Ll,"pool",new Pool(Ll));let Edge=Ll;kite.register("Edge",Edge);let globaId$2=0;const Tl=class Tl{constructor(e){this.id=++globaId$2,this.initialize(e)}initialize(e){return assert&&assert(e===null||e.isInner()),this.boundary=e,this.holes=cleanArray(this.holes),this.windingMap=null,this.filled=null,e&&this.addBoundaryFaceReferences(e),this}serialize(){return{type:"Face",id:this.id,boundary:this.boundary===null?null:this.boundary.id,holes:this.holes.map(e=>e.id),windingMap:this.windingMap,filled:this.filled}}dispose(){this.boundary=null,cleanArray(this.holes),this.windingMap=null,this.filled=null,this.freeToPool()}addBoundaryFaceReferences(e){for(let t=0;t<e.halfEdges.length;t++)assert&&assert(e.halfEdges[t].face===null),e.halfEdges[t].face=this}recursivelyAddHoles(e){assert&&assert(!e.isInner()),this.holes.push(e),this.addBoundaryFaceReferences(e);for(let t=0;t<e.childBoundaries.length;t++)this.recursivelyAddHoles(e.childBoundaries[t])}freeToPool(){Tl.pool.freeToPool(this)}};ut(Tl,"pool",new Pool(Tl));let Face=Tl;kite.register("Face",Face);let globaId$1=0;const Cl=class Cl{constructor(e,t){this.id=++globaId$1,this.initialize(e,t)}initialize(e,t){return assert&&assert(typeof e=="number"),assert&&assert(typeof t=="boolean"),this.shapeId=e,this.closed=t,this.halfEdges=cleanArray(this.halfEdges),this}serialize(){return{type:"Loop",id:this.id,shapeId:this.shapeId,closed:this.closed,halfEdges:this.halfEdges.map(e=>e.id)}}toSubpath(){const e=[];for(let t=0;t<this.halfEdges.length;t++)e.push(this.halfEdges[t].getDirectionalSegment());return new Subpath$1(e,void 0,this.closed)}dispose(){cleanArray(this.halfEdges),this.freeToPool()}freeToPool(){Cl.pool.freeToPool(this)}};ut(Cl,"pool",new Pool(Cl));let Loop=Cl;kite.register("Loop",Loop);let globaId=0;const Dl=class Dl{constructor(e){this.id=++globaId,this.initialize(e)}initialize(e){return this.halfEdges=e,this.signedArea=this.computeSignedArea(),this.bounds=this.computeBounds(),this.childBoundaries=cleanArray(this.childBoundaries),this}serialize(){return{type:"Boundary",id:this.id,halfEdges:this.halfEdges.map(e=>e.id),signedArea:this.signedArea,bounds:Bounds2.Bounds2IO.toStateObject(this.bounds),childBoundaries:this.childBoundaries.map(e=>e.id)}}dispose(){this.halfEdges=[],cleanArray(this.childBoundaries),this.freeToPool()}isInner(){return this.signedArea>0}computeSignedArea(){let e=0;for(let t=0;t<this.halfEdges.length;t++)e+=this.halfEdges[t].signedAreaFragment;return e}computeBounds(){const e=Bounds2.NOTHING.copy();for(let t=0;t<this.halfEdges.length;t++)e.includeBounds(this.halfEdges[t].edge.segment.getBounds());return e}computeExtremePoint(e){assert&&assert(this.halfEdges.length>0,"There is no extreme point if we have no edges");const t=[];for(let r=0;r<this.halfEdges.length;r++)t.push(this.halfEdges[r].edge.segment.transformed(e.getMatrix()));const n=Bounds2.NOTHING.copy();for(let r=0;r<t.length;r++)n.includeBounds(t[r].getBounds());for(let r=0;r<t.length;r++){const s=t[r];if(s.getBounds().top===n.top){let a=new Vector2(0,Number.POSITIVE_INFINITY);const l=[0,1].concat(s.getInteriorExtremaTs());for(let d=0;d<l.length;d++){const c=s.positionAt(l[d]);c.y<a.y&&(a=c)}return e.inversePosition2(a)}}throw new Error("Should not reach here if we have segments")}computeExtremeRay(e){const t=this.computeExtremePoint(e),n=e.inverseDelta2(new Vector2(0,-1)).normalized();return new Ray2(t.plus(n.timesScalar(1e-4)),n)}hasHalfEdge(e){for(let t=0;t<this.halfEdges.length;t++)if(this.halfEdges[t]===e)return!0;return!1}toSubpath(){const e=[];for(let t=0;t<this.halfEdges.length;t++)e.push(this.halfEdges[t].getDirectionalSegment());return new Subpath$1(e,null,!0)}freeToPool(){Dl.pool.freeToPool(this)}};ut(Dl,"pool",new Pool(Dl));let Boundary=Dl;kite.register("Boundary",Boundary);const pn=class pn{constructor(e,t,n,r,s,a,l,d,c,y){this.initialize(e,t,n,r,s,a,l,d,c,y)}initialize(e,t,n,r,s,a,l,d,c,y){return this.a=e,this.b=t,this.atMin=n,this.atMax=r,this.btMin=s,this.btMax=a,this.aMin=l,this.aMax=d,this.bMin=c,this.bMax=y,this}pushSubdivisions(e){const t=this,n=(t.atMax+t.atMin)/2,r=(t.btMax+t.btMin)/2;if(n===this.atMin||n===this.atMax||r===this.btMin||r===this.btMax){e.push(this);return}const s=t.a.positionAt(n),a=t.b.positionAt(r);pn.boxIntersects(t.aMin,s,t.bMin,a)&&e.push(pn.pool.create(t.a,t.b,t.atMin,n,t.btMin,r,t.aMin,s,t.bMin,a)),pn.boxIntersects(s,t.aMax,t.bMin,a)&&e.push(pn.pool.create(t.a,t.b,n,t.atMax,t.btMin,r,s,t.aMax,t.bMin,a)),pn.boxIntersects(t.aMin,s,a,t.bMax)&&e.push(pn.pool.create(t.a,t.b,t.atMin,n,r,t.btMax,t.aMin,s,a,t.bMax)),pn.boxIntersects(s,t.aMax,a,t.bMax)&&e.push(pn.pool.create(t.a,t.b,n,t.atMax,r,t.btMax,s,t.aMax,a,t.bMax)),this.freeToPool()}distance(e){const t=this.atMin-e.atMin,n=this.atMax-e.atMax,r=this.btMin-e.btMin,s=this.btMax-e.btMax;return t*t+n*n+r*r+s*s}clean(){this.a=null,this.b=null,this.aMin=null,this.aMax=null,this.bMin=null,this.bMax=null}static intersect(e,t){if(!e.bounds.intersectsBounds(t.bounds))return[];const n=pn.getIntersectionRanges(e,t),r=[];for(let a=0;a<n.length;a++){const l=n[a];let d=!1;e:for(let c=0;c<r.length;c++){const y=r[c];for(let m=0;m<y.length;m++){const O=y[m];if(l.distance(O)<1e-13){y.push(l),d=!0;break e}}}d||r.push([l])}const s=[];for(let a=0;a<r.length;a++){const l=r[a];let d=0,c=0;for(let O=0;O<l.length;O++)d+=l[O].atMin+l[O].atMax,c+=l[O].btMin+l[O].btMax;d/=2*l.length,c/=2*l.length;const y=e.positionAt(d),m=t.positionAt(c);assert&&assert(y.distance(m)<1e-10),s.push(new SegmentIntersection(y.average(m),d,c))}for(let a=0;a<n.length;a++)n[a].freeToPool();return pn.cleanPool(),s}static getIntersectionRanges(e,t){const n=e.getInteriorExtremaTs(),r=t.getInteriorExtremaTs(),s=_.zip([0].concat(n),n.concat([1])),a=_.zip([0].concat(r),r.concat([1]));let l=[];for(let d=0;d<s.length;d++)for(let c=0;c<a.length;c++){const y=s[d][0],m=s[d][1],O=a[c][0],D=a[c][1],z=e.positionAt(y),w=e.positionAt(m),N=t.positionAt(O),H=t.positionAt(D);pn.boxIntersects(z,w,N,H)&&l.push(pn.pool.create(e,t,y,m,O,D,z,w,N,H))}for(let d=0;d<50;d++){const c=[];for(let y=l.length-1;y>=0;y--)l[y].pushSubdivisions(c);l=c}return l}static boxIntersects(e,t,n,r){const s=Math.max(Math.min(e.x,t.x),Math.min(n.x,r.x)),a=Math.max(Math.min(e.y,t.y),Math.min(n.y,r.y)),l=Math.min(Math.max(e.x,t.x),Math.max(n.x,r.x)),d=Math.min(Math.max(e.y,t.y),Math.max(n.y,r.y));return l-s>=0&&d-a>=0}static cleanPool(){pn.pool.forEach(e=>e.clean())}freeToPool(){pn.pool.freeToPool(this)}};pn.pool=new Pool(pn);let BoundsIntersection=pn;kite.register("BoundsIntersection",BoundsIntersection);let globalId$8=1;const scratchArray=[];class SegmentTree{constructor(e=1e-6){this.rootNode=SegmentNode.pool.create(this,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY),this.rootNode.isBlack=!0,this.epsilon=e,this.items=new Set}query(e,t){const n=globalId$8++;return this.rootNode?this.rootNode.query(e,this.getMinX(e,this.epsilon),this.getMaxX(e,this.epsilon),n,t):!1}addItem(e){const t=this.getMinX(e,this.epsilon),n=this.getMaxX(e,this.epsilon);this.rootNode.split(t,this),this.rootNode.split(n,this),this.rootNode.addItem(e,t,n),this.items.add(e)}removeItem(e){this.rootNode.removeItem(e,this.getMinX(e,this.epsilon),this.getMaxX(e,this.epsilon)),this.items.delete(e)}audit(){this.rootNode.audit(this.epsilon,this.items,[])}toString(){let e=0,t="";return function n(r){t+=`${_.repeat("  ",e)}${r.toString()}
`,e++,r.hasChildren()&&(n(r.left),n(r.right)),e--}(this.rootNode),t}}const Pa=class Pa{constructor(e,t,n){this.items=[],this.initialize(e,t,n)}initialize(e,t,n){return this.min=t,this.max=n,this.splitValue=null,this.left=null,this.right=null,this.parent=null,this.tree=e,this.isBlack=!1,cleanArray(this.items),this}contains(e){return e>=this.min&&e<=this.max}hasChildren(){return this.splitValue!==null}query(e,t,n,r,s){var l,d;let a=!1;if(this.min<=n&&this.max>=t){for(let c=0;c<this.items.length;c++){const y=this.items[c];if((!((l=y.internalData)!=null&&l.segmentId)||((d=y.internalData)==null?void 0:d.segmentId)<r)&&(y.internalData.segmentId=r,a=s(y),a))return!0}this.hasChildren()&&(a||(a=this.left.query(e,t,n,r,s)),a||(a=this.right.query(e,t,n,r,s)))}return a}swapChild(e,t){assert&&assert(this.left===e||this.right===e),this.left===e?this.left=t:this.right=t}hasChild(e){return this.left===e||this.right===e}otherChild(e){return assert&&assert(this.hasChild(e)),this.left===e?this.right:this.left}leftRotate(e){if(assert&&assert(this.hasChildren()&&this.right.hasChildren()),this.right.hasChildren()){const t=this.right,n=this.left,r=t.left,s=t.right;t.parent=this.parent,this.parent?this.parent.swapChild(this,t):e.rootNode=t,this.parent=t,r.parent=this,t.left=this,this.left=n,this.right=r,this.max=r.max,this.splitValue=n.max,t.min=this.min,t.splitValue=this.max;const a=cleanArray(scratchArray);a.push(...this.items),cleanArray(this.items);for(let l=n.items.length-1;l>=0;l--){const d=n.items[l],c=r.items.indexOf(d);c>=0&&(n.items.splice(l,1),r.items.splice(c,1),this.items.push(d))}r.items.push(...t.items),s.items.push(...t.items),cleanArray(t.items),t.items.push(...a)}}rightRotate(e){assert&&assert(this.hasChildren()&&this.left.hasChildren());const t=this.left,n=this.right,r=t.left,s=t.right;t.parent=this.parent,this.parent?this.parent.swapChild(this,t):e.rootNode=t,this.parent=t,s.parent=this,t.right=this,this.left=s,this.right=n,this.min=s.min,this.splitValue=n.min,t.max=this.max,t.splitValue=this.min;const a=cleanArray(scratchArray);a.push(...this.items),cleanArray(this.items);for(let l=n.items.length-1;l>=0;l--){const d=n.items[l],c=s.items.indexOf(d);c>=0&&(n.items.splice(l,1),s.items.splice(c,1),this.items.push(d))}r.items.push(...t.items),s.items.push(...t.items),cleanArray(t.items),t.items.push(...a)}fixRedBlack(e){if(assert&&assert(!this.isBlack),!this.parent)this.isBlack=!0;else{const t=this.parent;if(!t.isBlack){const n=t.parent,r=n.otherChild(t);r.isBlack?t===n.left?this===t.right?(t.leftRotate(e),t.parent.isBlack=!0,t.parent.parent.isBlack=!1,t.parent.parent.rightRotate(e)):(t.isBlack=!0,n.isBlack=!1,n.rightRotate(e)):this===t.left?(t.rightRotate(e),t.parent.isBlack=!0,t.parent.parent.isBlack=!1,t.parent.parent.leftRotate(e)):(t.isBlack=!0,n.isBlack=!1,n.leftRotate(e)):(t.isBlack=!0,r.isBlack=!0,n.isBlack=!1,n.fixRedBlack(e))}}}split(e,t){if(assert&&assert(this.contains(e)),!(e===this.min||e===this.max))if(this.hasChildren())this.splitValue!==e&&(e>this.splitValue?this.right:this.left).split(e,t);else{this.splitValue=e;const n=Pa.pool.create(this.tree,this.min,e);n.parent=this,this.left=n;const r=Pa.pool.create(this.tree,e,this.max);if(r.parent=this,this.right=r,!this.isBlack&&this.parent){const s=this.parent,a=s.otherChild(this);a.isBlack?(this===s.left?(s.rightRotate(t),n.isBlack=!0):(s.leftRotate(t),r.isBlack=!0),this.fixRedBlack(t)):(this.isBlack=!0,a.isBlack=!0,s.isBlack=!1,s.fixRedBlack(t))}}}addItem(e,t,n){this.min>n||this.max<t||(this.min>=t&&this.max<=n?this.items.push(e):this.hasChildren()&&(this.left.addItem(e,t,n),this.right.addItem(e,t,n)))}removeItem(e,t,n){this.min>n||this.max<t||(this.min>=t&&this.max<=n?(assert&&assert(this.items.includes(e)),arrayRemove(this.items,e)):this.hasChildren()&&(this.left.removeItem(e,t,n),this.right.removeItem(e,t,n)))}audit(e,t,n=[]){if(assert){for(const r of n)assert(!this.items.includes(r));for(const r of this.items)assert(this.tree.getMinX(r,e)<=this.min),assert(this.tree.getMaxX(r,e)>=this.max);for(const r of n)this.tree.getMinX(r,e)<=this.min&&this.tree.getMaxX(r,e)>=this.max&&assert(t.has(r)||this.items.includes(r));if(assert(this.hasChildren()===(this.left!==null)),assert(this.hasChildren()===(this.right!==null)),assert(this.hasChildren()===(this.splitValue!==null)),assert(this.min<this.max),this.parent&&(assert(this.parent.hasChild(this)),assert(this.isBlack||this.parent.isBlack)),this.hasChildren()){assert(this.left.parent===this),assert(this.right.parent===this),assert(this.min===this.left.min),assert(this.max===this.right.max),assert(this.splitValue===this.left.max),assert(this.splitValue===this.right.min);for(const s of this.left.items)assert(!this.right.items.includes(s),"We shouldn't have two children with the same item");const r=[...n,...this.items];this.left.audit(e,t,r),this.right.audit(e,t,r)}}}toString(){return`[${this.min} ${this.max}] split:${this.splitValue} ${this.isBlack?"black":"red"} ${this.items}`}freeToPool(){Pa.pool.freeToPool(this)}};Pa.pool=new Pool(Pa);let SegmentNode=Pa;kite.register("SegmentTree",SegmentTree);class EdgeSegmentTree extends SegmentTree{getMinX(e,t){return e.segment.bounds.left-t}getMaxX(e,t){return e.segment.bounds.right+t}}kite.register("EdgeSegmentTree",EdgeSegmentTree);class VertexSegmentTree extends SegmentTree{getMinX(e,t){return e.point.x-t}getMaxX(e,t){return e.point.x+t}}kite.register("VertexSegmentTree",VertexSegmentTree);let bridgeId=0,globalId$7=0;const VERTEX_COLLAPSE_THRESHOLD_DISTANCE=1e-5,INTERSECTION_ENDPOINT_THRESHOLD_DISTANCE=.1*VERTEX_COLLAPSE_THRESHOLD_DISTANCE,SPLIT_ENDPOINT_THRESHOLD_DISTANCE=.01*VERTEX_COLLAPSE_THRESHOLD_DISTANCE,T_THRESHOLD=1e-6;class Graph{constructor(){this.vertices=[],this.edges=[],this.innerBoundaries=[],this.outerBoundaries=[],this.boundaries=[],this.shapeIds=[],this.loops=[],this.unboundedFace=Face.pool.create(null),this.faces=[this.unboundedFace]}serialize(){return{type:"Graph",vertices:this.vertices.map(e=>e.serialize()),edges:this.edges.map(e=>e.serialize()),boundaries:this.boundaries.map(e=>e.serialize()),innerBoundaries:this.innerBoundaries.map(e=>e.id),outerBoundaries:this.outerBoundaries.map(e=>e.id),shapeIds:this.shapeIds,loops:this.loops.map(e=>e.serialize()),unboundedFace:this.unboundedFace.id,faces:this.faces.map(e=>e.serialize())}}static deserialize(e){const t=new Graph,n={},r={},s={},a={},l={},d={};return t.vertices=e.vertices.map(c=>{const y=new Vertex(Vector2.Vector2IO.fromStateObject(c.point));return n[c.id]=y,y.visited=c.visited,y.visitIndex=c.visitIndex,y.lowIndex=c.lowIndex,y}),t.edges=e.edges.map(c=>{const y=new Edge(Segment.deserialize(c.segment),n[c.startVertex],n[c.endVertex]);r[c.id]=y,y.signedAreaFragment=c.signedAreaFragment;const m=(O,D)=>{s[D.id]=O,O.isReversed=D.isReversed,O.signedAreaFragment=D.signedAreaFragment,O.startVertex=n[D.startVertex.id],O.endVertex=n[D.endVertex.id],O.sortVector=Vector2.Vector2IO.fromStateObject(D.sortVector),O.data=D.data};return m(y.forwardHalf,c.forwardHalf),m(y.reversedHalf,c.reversedHalf),y.visited=c.visited,y.data=c.data,y}),e.vertices.forEach((c,y)=>{const m=t.vertices[y];m.incidentHalfEdges=c.incidentHalfEdges.map(O=>s[O])}),t.boundaries=e.boundaries.map(c=>{const y=Boundary.pool.create(c.halfEdges.map(m=>s[m]));return a[c.id]=y,y.signedArea=c.signedArea,y.bounds=Bounds2.Bounds2IO.fromStateObject(c.bounds),y}),e.boundaries.forEach((c,y)=>{const m=t.boundaries[y];m.childBoundaries=c.childBoundaries.map(O=>a[O])}),t.innerBoundaries=e.innerBoundaries.map(c=>a[c]),t.outerBoundaries=e.outerBoundaries.map(c=>a[c]),t.shapeIds=e.shapeIds,t.loops=e.loops.map(c=>{const y=new Loop(c.shapeId,c.closed);return l[c.id]=y,y.halfEdges=c.halfEdges.map(m=>s[m]),y}),t.faces=e.faces.map((c,y)=>{const m=y===0?t.unboundedFace:new Face(a[c.boundary]);return d[c.id]=m,m.holes=c.holes.map(O=>a[O]),m.windingMap=c.windingMap,m.filled=c.filled,m}),e.edges.forEach((c,y)=>{const m=t.edges[y];m.forwardHalf.face=c.forwardHalf.face===null?null:d[c.forwardHalf.face],m.reversedHalf.face=c.reversedHalf.face===null?null:d[c.reversedHalf.face]}),t}addShape(e,t,n){for(let r=0;r<t.subpaths.length;r++)this.addSubpath(e,t.subpaths[r],n)}addSubpath(e,t,n){if(assert&&assert(typeof e=="number"),assert&&assert(t instanceof Subpath$1),n=merge({ensureClosed:!0},n),this.shapeIds.indexOf(e)<0&&this.shapeIds.push(e),t.segments.length===0)return;const r=t.closed||n.ensureClosed,s=n.ensureClosed?t.getFillSegments():t.segments;let a;const l=[];for(a=0;a<s.length;a++){let c=a-1;c<0&&(c=s.length-1);let y=s[c].end;const m=s[a].start;!r&&a===0&&(y=m),m.equals(y)?l.push(Vertex.pool.create(m)):(assert&&assert(m.distance(y)<1e-5,"Inaccurate start/end points"),l.push(Vertex.pool.create(m.average(y))))}r||l.push(Vertex.pool.create(s[s.length-1].end));const d=Loop.pool.create(e,r);for(a=0;a<s.length;a++){let c=a+1;r&&c===s.length&&(c=0);const y=Edge.pool.create(s[a],l[a],l[c]);d.halfEdges.push(y.forwardHalf),this.addEdge(y)}this.loops.push(d),this.vertices.push(...l)}computeSimplifiedFaces(){this.eliminateOverlap(),this.eliminateSelfIntersection(),this.eliminateIntersection(),this.collapseVertices(),this.removeBridges(),this.removeLowOrderVertices(),this.orderVertexEdges(),this.extractFaces(),this.computeBoundaryTree(),this.computeWindingMap()}computeFaceInclusion(e){for(let t=0;t<this.faces.length;t++){const n=this.faces[t];n.filled=e(n.windingMap)}}createFilledSubGraph(){const e=new Graph,t={};for(let n=0;n<this.edges.length;n++){const r=this.edges[n];if(r.forwardHalf.face.filled!==r.reversedHalf.face.filled){if(!t[r.startVertex.id]){const l=Vertex.pool.create(r.startVertex.point);e.vertices.push(l),t[r.startVertex.id]=l}if(!t[r.endVertex.id]){const l=Vertex.pool.create(r.endVertex.point);e.vertices.push(l),t[r.endVertex.id]=l}const s=t[r.startVertex.id],a=t[r.endVertex.id];e.addEdge(Edge.pool.create(r.segment,s,a))}}return e.collapseAdjacentEdges(),e.orderVertexEdges(),e.extractFaces(),e.computeBoundaryTree(),e.fillAlternatingFaces(),e}facesToShape(){const e=[];for(let t=0;t<this.faces.length;t++){const n=this.faces[t];if(n.filled){e.push(n.boundary.toSubpath());for(let r=0;r<n.holes.length;r++)e.push(n.holes[r].toSubpath())}}return new kite.Shape(e)}dispose(){for(;this.boundaries.length;)this.boundaries.pop().dispose();for(cleanArray(this.innerBoundaries),cleanArray(this.outerBoundaries);this.loops.length;)this.loops.pop().dispose();for(;this.faces.length;)this.faces.pop().dispose();for(;this.vertices.length;)this.vertices.pop().dispose();for(;this.edges.length;)this.edges.pop().dispose()}addEdge(e){assert&&assert(e instanceof Edge),assert&&assert(!_.includes(e.startVertex.incidentHalfEdges,e.reversedHalf),"Should not already be connected"),assert&&assert(!_.includes(e.endVertex.incidentHalfEdges,e.forwardHalf),"Should not already be connected"),this.edges.push(e),e.startVertex.incidentHalfEdges.push(e.reversedHalf),e.endVertex.incidentHalfEdges.push(e.forwardHalf)}removeEdge(e){assert&&assert(e instanceof Edge),arrayRemove(this.edges,e),arrayRemove(e.startVertex.incidentHalfEdges,e.reversedHalf),arrayRemove(e.endVertex.incidentHalfEdges,e.forwardHalf)}replaceEdgeInLoops(e,t){const n=[];for(let r=0;r<t.length;r++)n.push(t[t.length-1-r].getReversed());for(let r=0;r<this.loops.length;r++){const s=this.loops[r];for(let a=s.halfEdges.length-1;a>=0;a--){const l=s.halfEdges[a];if(l.edge===e){const d=l===e.forwardHalf?t:n;Array.prototype.splice.apply(s.halfEdges,[a,1].concat(d))}}}}collapseAdjacentEdges(){let e=!0;for(;e;){e=!1;for(let t=0;t<this.vertices.length;t++){const n=this.vertices[t];if(n.incidentHalfEdges.length===2){const r=n.incidentHalfEdges[0].edge,s=n.incidentHalfEdges[1].edge;let a=r.segment,l=s.segment;const d=r.getOtherVertex(n),c=s.getOtherVertex(n);if(assert&&assert(this.loops.length===0),r.startVertex===n&&(a=a.reversed()),s.endVertex===n&&(l=l.reversed()),a instanceof Line$1&&l instanceof Line$1&&a.tangentAt(0).normalized().distance(l.tangentAt(0).normalized())<1e-6){this.removeEdge(r),this.removeEdge(s),r.dispose(),s.dispose(),arrayRemove(this.vertices,n),n.dispose();const y=new Line$1(d.point,c.point);this.addEdge(new Edge(y,d,c)),e=!0;break}}}}}eliminateOverlap(){const t=new window.FlatQueue,n=new EdgeSegmentTree(1e-4),r=globalId$7++,s=d=>{const c=d.segment.bounds;t.push({start:!0,edge:d},c.minY-1e-4),t.push({start:!1,edge:d},c.maxY+1e-4)},a=d=>{d.internalData.removedId=r};for(let d=0;d<this.edges.length;d++)s(this.edges[d]);const l=[];for(;t.length;){const d=t.pop(),c=d.edge;if(c.internalData.removedId!==r)if(d.start){let y=!1,m,O;if(n.query(c,D=>{const z=c.segment.getOverlaps(D.segment);if(z!==null&&z.length)for(let w=0;w<z.length;w++){const N=z[w];if(Math.abs(N.t1-N.t0)>1e-5&&Math.abs(N.qt1-N.qt0)>1e-5)return O=this.splitOverlap(c,D,N),y=!0,m=D,!0}return!1}),y){n.removeItem(m),a(m),a(c);for(let D=0;D<O.length;D++)s(O[D]);l.push(c),l.push(m)}else n.addItem(c)}else n.removeItem(c)}for(let d=0;d<l.length;d++)l[d].dispose()}splitOverlap(e,t,n){const r=[],s=e.segment,a=t.segment;this.removeEdge(e),this.removeEdge(t);let l=n.t0,d=n.t1,c=n.qt0,y=n.qt1;l<1e-5&&(l=0),d>1-1e-5&&(d=1),c<1e-5&&(c=0),y>1-1e-5&&(y=1);const m=l>0?s.subdivided(l)[0]:null,O=c>0?a.subdivided(c)[0]:null,D=d<1?s.subdivided(d)[1]:null,z=y<1?a.subdivided(y)[1]:null;let w=s;l>0&&(w=w.subdivided(l)[1]),d<1&&(w=w.subdivided(DotUtils.linear(l,1,0,1,d))[0]);let N;m&&O?(N=Vertex.pool.create(w.start),this.vertices.push(N)):m?N=n.a>0?t.startVertex:t.endVertex:N=e.startVertex;let H;D&&z?(H=Vertex.pool.create(w.end),this.vertices.push(H)):D?H=n.a>0?t.endVertex:t.startVertex:H=e.endVertex;const X=Edge.pool.create(w,N,H);r.push(X);let ae,oe,ue,fe;m&&(ae=Edge.pool.create(m,e.startVertex,N),r.push(ae)),D&&(oe=Edge.pool.create(D,H,e.endVertex),r.push(oe)),O&&(ue=Edge.pool.create(O,t.startVertex,n.a>0?N:H),r.push(ue)),z&&(fe=Edge.pool.create(z,n.a>0?H:N,t.endVertex),r.push(fe));for(let Ue=0;Ue<r.length;Ue++)this.addEdge(r[Ue]);const be=(m?[ae]:[]).concat([X]).concat(D?[oe]:[]),Ae=(O?[ue]:[]).concat([X]).concat(z?[fe]:[]),W=[],J=[];for(let Ue=0;Ue<be.length;Ue++)W.push(be[Ue].forwardHalf);for(let Ue=0;Ue<Ae.length;Ue++){const gt=Ae[Ue]!==X||n.a>0;J.push(gt?Ae[Ue].forwardHalf:Ae[Ue].reversedHalf)}return this.replaceEdgeInLoops(e,W),this.replaceEdgeInLoops(t,J),r}eliminateSelfIntersection(){assert&&assert(this.boundaries.length===0,"Only handles simpler level primitive splitting right now");for(let e=this.edges.length-1;e>=0;e--){const t=this.edges[e],n=t.segment;if(n instanceof Cubic){const r=n.getSelfIntersection();if(r){assert&&assert(r.aT<r.bT);const s=n.subdivisions([r.aT,r.bT]),a=Vertex.pool.create(r.point);this.vertices.push(a);const l=Edge.pool.create(s[0],t.startVertex,a),d=Edge.pool.create(s[1],a,a),c=Edge.pool.create(s[2],a,t.endVertex);this.removeEdge(t),this.addEdge(l),this.addEdge(d),this.addEdge(c),this.replaceEdgeInLoops(t,[l.forwardHalf,d.forwardHalf,c.forwardHalf]),t.dispose()}}}}eliminateIntersection(){const t=new window.FlatQueue,n=new EdgeSegmentTree(1e-4),r=globalId$7++,s=d=>{const c=d.segment.bounds;t.push({start:!0,edge:d},c.minY-1e-4),t.push({start:!1,edge:d},c.maxY+1e-4)},a=d=>{d.internalData.removedId=r};for(let d=0;d<this.edges.length;d++)s(this.edges[d]);const l=[];for(;t.length;){const d=t.pop(),c=d.edge;if(c.internalData.removedId!==r)if(d.start){let y=!1,m,O,D;if(n.query(c,z=>{const w=c.segment,N=z.segment;let H=Segment.intersect(w,N);if(H=H.filter(X=>{const ae=X.point;return Graph.isInternal(ae,X.aT,w,INTERSECTION_ENDPOINT_THRESHOLD_DISTANCE,T_THRESHOLD)||Graph.isInternal(ae,X.bT,N,INTERSECTION_ENDPOINT_THRESHOLD_DISTANCE,T_THRESHOLD)}),H.length){const X=H[0],ae=this.simpleSplit(c,z,X.aT,X.bT,X.point);if(ae)return y=!0,m=z,O=ae.addedEdges,D=ae.removedEdges,!0}return!1}),y){D.includes(c)?(a(c),l.push(c)):n.addItem(c),D.includes(m)&&(n.removeItem(m),a(m),l.push(m));for(let z=0;z<O.length;z++)s(O[z])}else n.addItem(c)}else n.removeItem(c)}for(let d=0;d<l.length;d++)l[d].dispose()}simpleSplit(e,t,n,r,s){const a=Graph.isInternal(s,n,e.segment,SPLIT_ENDPOINT_THRESHOLD_DISTANCE,T_THRESHOLD),l=Graph.isInternal(s,r,t.segment,SPLIT_ENDPOINT_THRESHOLD_DISTANCE,T_THRESHOLD);let d=null;a?l?(d=Vertex.pool.create(s),this.vertices.push(d)):d=r<.5?t.startVertex:t.endVertex:d=n<.5?e.startVertex:e.endVertex;let c=!1;const y=[],m=[];return a&&d!==e.startVertex&&d!==e.endVertex&&(y.push(...this.splitEdge(e,n,d)),m.push(e),c=!0),l&&d!==t.startVertex&&d!==t.endVertex&&(y.push(...this.splitEdge(t,r,d)),m.push(t),c=!0),c?{addedEdges:y,removedEdges:m}:null}splitEdge(e,t,n){assert&&assert(this.boundaries.length===0,"Only handles simpler level primitive splitting right now"),assert&&assert(e.startVertex!==n),assert&&assert(e.endVertex!==n);const r=e.segment.subdivided(t);assert&&assert(r.length===2);const s=Edge.pool.create(r[0],e.startVertex,n),a=Edge.pool.create(r[1],n,e.endVertex);return this.removeEdge(e),this.addEdge(s),this.addEdge(a),this.replaceEdgeInLoops(e,[s.forwardHalf,a.forwardHalf]),[s,a]}collapseVertices(){assert&&assert(_.every(this.edges,d=>_.includes(this.vertices,d.startVertex))),assert&&assert(_.every(this.edges,d=>_.includes(this.vertices,d.endVertex)));const e=10*VERTEX_COLLAPSE_THRESHOLD_DISTANCE,t=new window.FlatQueue,n=new VertexSegmentTree(e),r=globalId$7++,s=d=>{t.push({start:!0,vertex:d},d.point.y-e),t.push({start:!1,vertex:d},d.point.y+e)},a=d=>{d.internalData.removedId=r};for(let d=0;d<this.vertices.length;d++)s(this.vertices[d]);const l=[];for(;t.length;){const d=t.pop(),c=d.vertex;if(c.internalData.removedId!==r)if(d.start){let y=!1,m,O;if(n.query(c,D=>{const z=c.point.distance(D.point);if(z<VERTEX_COLLAPSE_THRESHOLD_DISTANCE){const w=Vertex.pool.create(z===0?c.point:c.point.average(D.point));this.vertices.push(w),arrayRemove(this.vertices,c),arrayRemove(this.vertices,D);for(let N=this.edges.length-1;N>=0;N--){const H=this.edges[N],X=H.startVertex===c||H.startVertex===D,ae=H.endVertex===c||H.endVertex===D;if(X&&ae){if((H.segment.bounds.width>1e-5||H.segment.bounds.height>1e-5)&&(H.segment instanceof Cubic||H.segment instanceof Arc||H.segment instanceof EllipticalArc)){const oe=Edge.pool.create(H.segment,w,w);this.addEdge(oe),this.replaceEdgeInLoops(H,[oe.forwardHalf])}else this.replaceEdgeInLoops(H,[]);this.removeEdge(H),H.dispose()}else X?(H.startVertex=w,w.incidentHalfEdges.push(H.reversedHalf),H.updateReferences()):ae&&(H.endVertex=w,w.incidentHalfEdges.push(H.forwardHalf),H.updateReferences())}return O=[w],y=!0,m=D,!0}return!1}),y){n.removeItem(m),a(m),a(c);for(let D=0;D<O.length;D++)s(O[D]);l.push(c),l.push(m)}else n.addItem(c)}else n.removeItem(c)}for(let d=0;d<l.length;d++)l[d].dispose();assert&&assert(_.every(this.edges,d=>_.includes(this.vertices,d.startVertex))),assert&&assert(_.every(this.edges,d=>_.includes(this.vertices,d.endVertex)))}markBridges(e,t){t.visited=!0,t.visitIndex=t.lowIndex=bridgeId++;for(let n=0;n<t.incidentHalfEdges.length;n++){const r=t.incidentHalfEdges[n].edge,s=t.incidentHalfEdges[n].startVertex;s.visited?r.visited||(t.lowIndex=Math.min(t.lowIndex,s.visitIndex)):(r.visited=!0,s.parent=t,this.markBridges(e,s),t.lowIndex=Math.min(t.lowIndex,s.lowIndex),s.lowIndex>t.visitIndex&&e.push(r))}}removeBridges(){const e=[];for(let t=0;t<this.vertices.length;t++){const n=this.vertices[t];n.visited||this.markBridges(e,n)}for(let t=0;t<e.length;t++){const n=e[t];this.removeEdge(n),this.replaceEdgeInLoops(n,[]),n.dispose()}}removeLowOrderVertices(){assert&&assert(_.every(this.edges,t=>_.includes(this.vertices,t.startVertex))),assert&&assert(_.every(this.edges,t=>_.includes(this.vertices,t.endVertex)));let e=!0;for(;e;){e=!1;for(let t=this.vertices.length-1;t>=0;t--){const n=this.vertices[t];if(n.incidentHalfEdges.length<2){for(let r=0;r<n.incidentHalfEdges.length;r++){const s=n.incidentHalfEdges[r].edge;this.removeEdge(s),this.replaceEdgeInLoops(s,[]),s.dispose()}this.vertices.splice(t,1),n.dispose(),e=!0;break}}}assert&&assert(_.every(this.edges,t=>_.includes(this.vertices,t.startVertex))),assert&&assert(_.every(this.edges,t=>_.includes(this.vertices,t.endVertex)))}orderVertexEdges(){for(let e=0;e<this.vertices.length;e++)this.vertices[e].sortEdges()}extractFaces(){const e=[];for(let t=0;t<this.edges.length;t++)e.push(this.edges[t].forwardHalf),e.push(this.edges[t].reversedHalf);for(;e.length;){const t=[];let n=e[0];const r=n;for(;n&&(arrayRemove(e,n),t.push(n),n=n.getNext(),n!==r););const s=Boundary.pool.create(t);(s.signedArea>0?this.innerBoundaries:this.outerBoundaries).push(s),this.boundaries.push(s)}for(let t=0;t<this.innerBoundaries.length;t++)this.faces.push(Face.pool.create(this.innerBoundaries[t]))}computeBoundaryTree(){const e=[],t=new Transform3(Matrix3.rotation2(1.5729657));for(let n=0;n<this.outerBoundaries.length;n++){const r=this.outerBoundaries[n],s=r.computeExtremeRay(t);let a=null,l=Number.POSITIVE_INFINITY,d=!1;for(let c=0;c<this.edges.length;c++){const y=this.edges[c],m=y.segment.intersection(s);for(let O=0;O<m.length;O++){const D=m[O];D.distance<l&&(a=y,l=D.distance,d=D.wind)}}if(a===null)e.push(r);else{const y=d<0?a.reversedHalf:a.forwardHalf;this.getBoundaryOfHalfEdge(y).childBoundaries.push(r)}}e.forEach(this.unboundedFace.recursivelyAddHoles.bind(this.unboundedFace));for(let n=0;n<this.faces.length;n++){const r=this.faces[n];r.boundary!==null&&r.boundary.childBoundaries.forEach(r.recursivelyAddHoles.bind(r))}}computeWindingMap(){const e=this.edges.slice(),t={};for(let n=0;n<this.shapeIds.length;n++)t[this.shapeIds[n]]=0;for(this.unboundedFace.windingMap=t;e.length;)for(let n=e.length-1;n>=0;n--){const r=e[n],s=r.forwardHalf,a=r.reversedHalf,l=s.face,d=a.face;assert&&assert(l!==d);const c=l.windingMap!==null,y=d.windingMap!==null;if(c&&y){if(e.splice(n,1),assert)for(let m=0;m<this.shapeIds.length;m++){const O=this.shapeIds[m];assert(l.windingMap[O]-d.windingMap[O]===this.computeDifferential(r,O))}}else{if(!c&&!y)continue;{const m=c?l:d,O=c?d:l,D={};for(let z=0;z<this.shapeIds.length;z++){const w=this.shapeIds[z],N=this.computeDifferential(r,w);D[w]=m.windingMap[w]+N*(c?-1:1)}O.windingMap=D}}}}computeDifferential(e,t){let n=0;for(let r=0;r<this.loops.length;r++){const s=this.loops[r];if(assert&&assert(s.closed,"This is only defined to work for closed loops"),s.shapeId===t)for(let a=0;a<s.halfEdges.length;a++){const l=s.halfEdges[a];l===e.forwardHalf?n++:l===e.reversedHalf&&n--}}return n}fillAlternatingFaces(){let e=0;for(let t=0;t<this.faces.length;t++)this.faces[t].filled=null,e++;for(this.unboundedFace.filled=!1,e--;e;)for(let t=0;t<this.edges.length;t++){const n=this.edges[t],r=n.forwardHalf.face,s=n.reversedHalf.face,a=r.filled===null,l=s.filled===null;a&&!l?(r.filled=!s.filled,e--):!a&&l&&(s.filled=!r.filled,e--)}}getBoundaryOfHalfEdge(e){for(let t=0;t<this.boundaries.length;t++){const n=this.boundaries[t];if(n.hasHalfEdge(e))return n}throw new Error("Could not find boundary")}static isInternal(e,t,n,r,s){return t>s&&t<1-s&&e.distance(n.start)>r&&e.distance(n.end)>r}static BINARY_NONZERO_UNION(e){return e[0]!==0||e[1]!==0}static BINARY_NONZERO_INTERSECTION(e){return e[0]!==0&&e[1]!==0}static BINARY_NONZERO_DIFFERENCE(e){return e[0]!==0&&e[1]===0}static BINARY_NONZERO_XOR(e){return(e[0]!==0^e[1]!==0)===1}static binaryResult(e,t,n){const r=new Graph;r.addShape(0,e),r.addShape(1,t),r.computeSimplifiedFaces(),r.computeFaceInclusion(n);const s=r.createFilledSubGraph(),a=s.facesToShape();return r.dispose(),s.dispose(),a}static unionNonZero(e){const t=new Graph;for(let s=0;s<e.length;s++)t.addShape(s,e[s]);t.computeSimplifiedFaces(),t.computeFaceInclusion(s=>{for(let a=0;a<e.length;a++)if(s[a]!==0)return!0;return!1});const n=t.createFilledSubGraph(),r=n.facesToShape();return t.dispose(),n.dispose(),r}static intersectionNonZero(e){const t=new Graph;for(let s=0;s<e.length;s++)t.addShape(s,e[s]);t.computeSimplifiedFaces(),t.computeFaceInclusion(s=>{for(let a=0;a<e.length;a++)if(s[a]===0)return!1;return!0});const n=t.createFilledSubGraph(),r=n.facesToShape();return t.dispose(),n.dispose(),r}static xorNonZero(e){const t=new Graph;for(let s=0;s<e.length;s++)t.addShape(s,e[s]);t.computeSimplifiedFaces(),t.computeFaceInclusion(s=>{let a=!1;for(let l=0;l<e.length;l++)s[l]!==0&&(a=!a);return a});const n=t.createFilledSubGraph(),r=n.facesToShape();return t.dispose(),n.dispose(),r}static simplifyNonZero(e){const t=new Graph;t.addShape(0,e),t.computeSimplifiedFaces(),t.computeFaceInclusion(s=>s[0]!==0);const n=t.createFilledSubGraph(),r=n.facesToShape();return t.dispose(),n.dispose(),r}static clipShape(e,t,n){let r,s,a;n=merge({includeExterior:!1,includeBoundary:!0,includeInterior:!0},n);const c=Graph.simplifyNonZero(e),y=new Graph;for(y.addShape(0,t,{ensureClosed:!1}),y.addShape(1,c),y.eliminateOverlap(),y.eliminateSelfIntersection(),y.eliminateIntersection(),y.collapseVertices(),r=0;r<y.loops.length;r++)if(a=y.loops[r],a.shapeId===1)for(s=0;s<a.halfEdges.length;s++)a.halfEdges[s].edge.data=!0;const m=[];for(r=0;r<y.loops.length;r++)if(a=y.loops[r],a.shapeId===0){let O=[];for(s=0;s<a.halfEdges.length;s++){const D=a.halfEdges[s];(D.edge.data?n.includeBoundary:c.containsPoint(D.edge.segment.positionAt(.5))?n.includeInterior:n.includeExterior)?O.push(D.getDirectionalSegment()):O.length&&(m.push(new Subpath$1(O,void 0,a.closed)),O=[])}O.length&&m.push(new Subpath$1(O,void 0,a.closed))}return y.dispose(),new kite.Shape(m)}}kite.register("Graph",Graph);const Graph$1=Graph,scratchVector$1=new Vector2(0,0),scratchMatrix$3=Matrix3.IDENTITY.copy(),Or=class Or extends EnumerationValue{};Or.TRANSLATION=new Or,Or.TRANSLATION_AND_SCALE=new Or,Or.TRANSLATION_AND_ROTATION=new Or,Or.AFFINE=new Or,Or.enumeration=new Enumeration(Or,{phetioDocumentation:"Defines the available transform type for a SpriteInstance"});let SpriteInstanceTransformType=Or;const xl=class xl{constructor(){this.sprite=null,this.matrix=new Matrix3().setToAffine(1,0,0,0,1,0),this.transformType=SpriteInstanceTransformType.TRANSLATION,this.alpha=1}initialize(){return this}getShape(){return this.sprite?this.sprite.getShape().transformed(this.matrix):new Shape$1}containsPoint(e){if(!this.sprite)return!1;const t=scratchVector$1.set(e);return this.transformType===SpriteInstanceTransformType.AFFINE?scratchMatrix$3.set(this.matrix).invert().multiplyVector2(t):(t.x-=this.matrix.m02(),t.y-=this.matrix.m12(),this.transformType===SpriteInstanceTransformType.TRANSLATION_AND_SCALE?(t.x/=this.matrix.m00(),t.y/=this.matrix.m11()):this.transformType===SpriteInstanceTransformType.TRANSLATION_AND_ROTATION&&t.rotate(-this.matrix.rotation)),this.sprite.containsPoint(t)}freeToPool(){xl.pool.freeToPool(this)}};xl.pool=new Pool(xl,{maxSize:1e3});let SpriteInstance=xl;scenery.register("SpriteInstance",SpriteInstance);const MAX_DIMENSION=new Dimension2(1024,1024),GUTTER_SIZE=1,PADDING=1,Iu=class Iu{constructor(e){this.useMipmaps=e,this.gl=null,this.texture=null,this.bounds=new Bounds2(0,0,MAX_DIMENSION.width,MAX_DIMENSION.height),assert&&assert(this.bounds.minX===0&&this.bounds.minY===0,"Assumed constraint later on for transforms"),this.width=this.bounds.width,this.height=this.bounds.height,this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.context=this.canvas.getContext("2d"),this.binPacker=new BinPacker(this.bounds),this.dirty=!0,this.usedSprites=[],this.unusedSprites=[]}initializeContext(e){this.gl=e,this.createTexture()}createTexture(){const e=this.gl;assert&&assert(e),this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,this.useMipmaps?e.LINEAR_MIPMAP_LINEAR:e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.canvas),this.useMipmaps&&(e.hint(e.GENERATE_MIPMAP_HINT,e.NICEST),e.generateMipmap(e.TEXTURE_2D)),e.bindTexture(e.TEXTURE_2D,null),this.dirty=!1}updateTexture(){if(assert&&assert(this.gl,"SpriteSheet needs context to updateTexture()"),this.dirty){this.dirty=!1;const e=this.gl;assert&&assert(e),e.bindTexture(e.TEXTURE_2D,this.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.canvas),this.useMipmaps&&(e.hint(e.GENERATE_MIPMAP_HINT,e.NICEST),e.generateMipmap(e.TEXTURE_2D)),e.bindTexture(e.TEXTURE_2D,null)}}addImage(e,t,n){let r;for(r=0;r<this.usedSprites.length;r++){const a=this.usedSprites[r];if(a.image===e)return a.count++,a}for(r=0;r<this.unusedSprites.length;r++){const a=this.unusedSprites[r];if(a.image===e)return a.count++,assert&&assert(a.count===1,"Count should be exactly 1 after coming back from being unused"),this.unusedSprites.splice(r,1),this.usedSprites.push(a),a}let s;for(;!(s=this.binPacker.allocate(t+2*GUTTER_SIZE+PADDING,n+2*GUTTER_SIZE+PADDING))&&this.unusedSprites.length;){const a=this.unusedSprites.shift();this.dirty=!0;const l=a.bin.bounds;this.context.clearRect(l.x,l.y,l.width,l.height),this.binPacker.deallocate(a.bin)}if(s){const a=new Bounds2((s.bounds.minX+GUTTER_SIZE)/this.width,(s.bounds.minY+GUTTER_SIZE)/this.height,(s.bounds.maxX-GUTTER_SIZE-PADDING)/this.width,(s.bounds.maxY-GUTTER_SIZE-PADDING)/this.height),l=new Sprite$1(this,s,a,e,1);return this.copyImageWithGutter(e,t,n,s.bounds.x,s.bounds.y),this.dirty=!0,this.usedSprites.push(l),l}else return null}removeImage(e){let t,n;for(n=0;n<this.usedSprites.length;n++)if(this.usedSprites[n].image===e){t=this.usedSprites[n];break}assert&&assert(t,"Sprite not found for removeImage"),--t.count<=0&&(this.usedSprites.splice(n,1),this.unusedSprites.push(t))}containsImage(e){let t;for(t=0;t<this.usedSprites.length;t++)if(this.usedSprites[t].image===e)return!0;for(t=0;t<this.unusedSprites.length;t++)if(this.unusedSprites[t].image===e)return!0;return!1}copyImageWithGutter(e,t,n,r,s){assert&&assert(GUTTER_SIZE===1),this.copyImageRegion(e,1,1,0,0,r,s),this.copyImageRegion(e,1,1,t-1,0,r+1+t,s),this.copyImageRegion(e,1,1,t-1,n-1,r+1+t,s+1+n),this.copyImageRegion(e,1,1,0,n-1,r,s+1+n),this.copyImageRegion(e,t,1,0,0,r+1,s),this.copyImageRegion(e,t,1,0,n-1,r+1,s+1+n),this.copyImageRegion(e,1,n,0,0,r,s+1),this.copyImageRegion(e,1,n,t-1,0,r+1+t,s+1),this.context.drawImage(e,r+1,s+1)}copyImageRegion(e,t,n,r,s,a,l){this.context.drawImage(e,r,s,t,n,a,l,t,n)}};Iu.MAX_DIMENSION=MAX_DIMENSION;let SpriteSheet=Iu;scenery.register("SpriteSheet",SpriteSheet);let Sprite$1=class{constructor(e,t,n,r,s){this.spriteSheet=e,this.bin=t,this.uvBounds=n,this.image=r,this.count=s}};SpriteSheet.Sprite=Sprite$1;class ShaderProgram{constructor(e,t,n,r){const s=optionize()({attributes:[],uniforms:[]},r);this.vertexSource=t,this.fragmentSource=n,this.attributeNames=s.attributes,this.uniformNames=s.uniforms,this.initialize(e)}initialize(e){this.gl=e,this.used=!1,this.program=this.gl.createProgram(),this.vertexShader=Utils.createShader(this.gl,this.vertexSource,this.gl.VERTEX_SHADER),this.fragmentShader=Utils.createShader(this.gl,this.fragmentSource,this.gl.FRAGMENT_SHADER),this.gl.attachShader(this.program,this.vertexShader),this.gl.attachShader(this.program,this.fragmentShader),this.gl.linkProgram(this.program),this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS)||(console.log("GLSL link error:"),console.log(this.gl.getProgramInfoLog(this.program)),console.log("for vertex shader"),console.log(this.vertexSource),console.log("for fragment shader"),console.log(this.fragmentSource)),this.gl.deleteShader(this.vertexShader),this.gl.deleteShader(this.fragmentShader),this.uniformLocations={},this.attributeLocations={},this.activeAttributes={},_.each(this.attributeNames,t=>{this.attributeLocations[t]=this.gl.getAttribLocation(this.program,t),this.activeAttributes[t]=!0}),_.each(this.uniformNames,t=>{this.uniformLocations[t]=this.gl.getUniformLocation(this.program,t)}),this.isInitialized=!0}use(){this.used||(this.used=!0,this.gl.useProgram(this.program),_.each(this.attributeNames,e=>{this.activeAttributes[e]&&this.enableVertexAttribArray(e)}))}activateAttribute(e){this.activeAttributes[e]||(this.activeAttributes[e]=!0,this.used&&this.enableVertexAttribArray(e))}enableVertexAttribArray(e){this.gl.enableVertexAttribArray(this.attributeLocations[e])}unuse(){this.used&&(this.used=!1,_.each(this.attributeNames,e=>{this.activeAttributes[e]&&this.disableVertexAttribArray(e)}))}disableVertexAttribArray(e){this.gl.disableVertexAttribArray(this.attributeLocations[e])}deactivateAttribute(e){this.activeAttributes[e]&&(this.activeAttributes[e]=!1,this.used&&this.disableVertexAttribArray(e))}dispose(){this.gl.deleteProgram(this.program)}}scenery.register("ShaderProgram",ShaderProgram);class ColorProperty extends Property{constructor(e,t){t&&(assert&&assert(!t.hasOwnProperty("valueType"),"ColorProperty sets valueType"),assert&&assert(!t.hasOwnProperty("phetioType"),"ColorProperty sets phetioType"));const n=optionize()({valueType:Color,phetioValueType:Color.ColorIO},t);super(e,n)}}scenery.register("ColorProperty",ColorProperty);const TEXT_SIZE_CONTAINER_ID="sceneryTextSizeContainer",TEXT_SIZE_ELEMENT_ID="sceneryTextSizeElement";let svgTextSizeContainer,svgTextSizeElement;const hybridFontVerticalCache={};let deliveredWarning=!1;const TextBounds={approximateSVGBounds(o,e){if(assert&&assert(o instanceof Font,"Font required"),assert&&assert(typeof e=="string","renderedText required"),!svgTextSizeContainer.parentNode)if(document.body)document.body.appendChild(svgTextSizeContainer);else throw new Error("No document.body and trying to get approximate SVG bounds of a Text node");TextBounds.setSVGTextAttributes(svgTextSizeElement,o,e);const t=svgTextSizeElement.getBBox();return t.width===0&&t.height===0&&e.length>0?(deliveredWarning||(deliveredWarning=!0,console.log("WARNING: Guessing text bounds, is the simulation hidden? See https://github.com/phetsims/chipper/issues/768")),TextBounds.guessSVGBounds(o,e)):new Bounds2(t.x,t.y,t.x+t.width,t.y+t.height)},guessSVGBounds(o,e){const t=o.getNumericSize(),n=o.weight==="bold";return new Bounds2(0,-.9*t,(n?.435:.4)*t*e.length,.22*t)},accurateCanvasBounds(o){const e=scenery.scratchContext;e.font=o._font.toCSS(),e.direction="ltr";const t=e.measureText(o.renderedText);return new Bounds2(-t.actualBoundingBoxLeft,-t.actualBoundingBoxAscent,t.actualBoundingBoxRight,t.actualBoundingBoxDescent)},accurateCanvasBoundsFallback(o){const e=TextBounds.approximateSVGBounds(o._font,o.renderedText);if(!o.renderedText.length||e.width===0)return e;const t=Utils.canvasAccurateBounds(n=>{if(n.font=o._font.toCSS(),n.direction="ltr",n.fillText(o.renderedText,0,0),o.hasPaintableStroke()){const r=new CanvasContextWrapper(null,n);o.beforeCanvasStroke(r),n.strokeText(o.renderedText,0,0),o.afterCanvasStroke(r)}},{precision:.5,resolution:128,initialScale:32/Math.max(Math.abs(e.minX),Math.abs(e.minY),Math.abs(e.maxX),Math.abs(e.maxY))});return t.isFinite()?t:e},getVerticalBounds(o){assert&&assert(o instanceof Font,"Font required");const e=o.toCSS();let t=hybridFontVerticalCache[e];return t||(t=hybridFontVerticalCache[e]=TextBounds.approximateSVGBounds(o,"m")),t},approximateCanvasWidth(o,e){assert&&assert(o instanceof Font,"Font required"),assert&&assert(typeof e=="string","renderedText required");const t=scenery.scratchContext;return t.font=o.toCSS(),t.direction="ltr",t.measureText(e).width},approximateHybridBounds(o,e){assert&&assert(o instanceof Font,"Font required"),assert&&assert(typeof e=="string","renderedText required");const t=TextBounds.getVerticalBounds(o),n=TextBounds.approximateCanvasWidth(o,e);return new Bounds2(0,t.minY,n,t.maxY)},approximateDOMBounds(o,e){assert&&assert(o instanceof Font,"Font required");const t=1024,n=document.createElement("div");$(n).css({position:"absolute",left:0,top:0,padding:"0 !important",margin:"0 !important",display:"hidden"});const r=document.createElement("span");$(r).css("font",o.toCSS()),r.appendChild(e),r.setAttribute("direction","ltr");const s=document.createElement("div");$(s).css({"vertical-align":"baseline",display:"inline-block",width:0,height:`${t}px`,margin:"0 !important",padding:"0 !important"}),n.appendChild(r),n.appendChild(s),document.body.appendChild(n);const a=r.getBoundingClientRect(),l=n.getBoundingClientRect(),d=new Bounds2(a.left,a.top-t,a.right+1,a.bottom-t).shiftedXY(-l.left,-l.top);return document.body.removeChild(n),d},approximateImprovedDOMBounds(o,e){assert&&assert(o instanceof Font,"Font required");const t=document.createElement("div");t.style.display="inline-block",t.style.font=o.toCSS(),t.style.color="transparent",t.style.padding="0 !important",t.style.margin="0 !important",t.style.position="absolute",t.style.left="0",t.style.top="0",t.setAttribute("direction","ltr"),t.appendChild(e),document.body.appendChild(t);const n=new Bounds2(t.offsetLeft,t.offsetTop,t.offsetLeft+t.offsetWidth+1,t.offsetTop+t.offsetHeight+1);document.body.removeChild(t);const r=TextBounds.getVerticalBounds(o);return n.shiftedY(r.minY)},setSVGTextAttributes(o,e,t){assert&&assert(e instanceof Font,"Font required"),assert&&assert(typeof t=="string","renderedText required"),o.setAttribute("direction","ltr"),o.setAttribute("font-family",e.getFamily()),o.setAttribute("font-size",e.getSize()),o.setAttribute("font-style",e.getStyle()),o.setAttribute("font-weight",e.getWeight()),o.setAttribute("font-stretch",e.getStretch()),o.lastChild.nodeValue=t},initializeTextBounds(){svgTextSizeContainer=document.getElementById(TEXT_SIZE_CONTAINER_ID),svgTextSizeContainer||(svgTextSizeContainer=document.createElementNS(svgns,"svg"),svgTextSizeContainer.setAttribute("width","2"),svgTextSizeContainer.setAttribute("height","2"),svgTextSizeContainer.setAttribute("id",TEXT_SIZE_CONTAINER_ID),svgTextSizeContainer.setAttribute("style","visibility: hidden; pointer-events: none; position: absolute; left: -65535px; right: -65535px;")),svgTextSizeElement=document.getElementById(TEXT_SIZE_ELEMENT_ID),svgTextSizeElement||(svgTextSizeElement=document.createElementNS(svgns,"text"),svgTextSizeElement.appendChild(document.createTextNode("")),svgTextSizeElement.setAttribute("dominant-baseline","alphabetic"),svgTextSizeElement.setAttribute("text-rendering","geometricPrecision"),svgTextSizeElement.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),svgTextSizeElement.setAttribute("id",TEXT_SIZE_ELEMENT_ID),svgTextSizeContainer.appendChild(svgTextSizeElement))}};scenery.register("TextBounds",TextBounds);class PartialPDOMTrail{constructor(e,t,n){this.pdomInstance=e,this.trail=t,this.isRoot=n,this.isRoot=n,this.fullTrail=this.pdomInstance.trail.copy();for(let r=this.isRoot?0:1;r<this.trail.length;r++)this.fullTrail.addDescendant(this.trail.nodes[r])}}scenery.register("PartialPDOMTrail",PartialPDOMTrail);const SIBLING_CLASS_NAME="a11y-pdom-element",ROOT_CLASS_NAME="a11y-pdom-root",LIST_ITEM_CLASS_NAME="a11y-pdom-list-item";SceneryStyle.addRule(`.${SIBLING_CLASS_NAME}{position: fixed;pointer-events: none;top: 0px;left: 0px;transform-origin: left top 0px;border-width: 0px;border: 0px;padding: 1px 1px;margin: 0px;white-space: nowrap;outline: none;box-shadow:none;border-color:transparent;font-size: 1px;clip: rect(1px, 1px, 1px, 1px);}`);SceneryStyle.addRule(`.${ROOT_CLASS_NAME}{position: absolute;z-index: 1;opacity: 0.0001;}`);SceneryStyle.addRule(`.${LIST_ITEM_CLASS_NAME}{list-style: none;`);const PDOMSiblingStyle={SIBLING_CLASS_NAME,ROOT_CLASS_NAME,LIST_ITEM_CLASS_NAME};scenery.register("PDOMSiblingStyle",PDOMSiblingStyle);const PDOMSiblingStyle$1=PDOMSiblingStyle,NEXT$1="NEXT",PREVIOUS$1="PREVIOUS",INPUT_TAG$2="INPUT",LABEL_TAG$1="LABEL",BUTTON_TAG="BUTTON",TEXTAREA_TAG="TEXTAREA",SELECT_TAG="SELECT",OPTGROUP_TAG="OPTGROUP",DATALIST_TAG="DATALIST",OUTPUT_TAG="OUTPUT",DIV_TAG="DIV",A_TAG="A",AREA_TAG="AREA",P_TAG$1="P",IFRAME_TAG="IFRAME",BOLD_TAG="B",STRONG_TAG="STRONG",I_TAG="I",EM_TAG="EM",MARK_TAG="MARK",SMALL_TAG="SMALL",DEL_TAG="DEL",INS_TAG="INS",SUB_TAG="SUB",SUP_TAG="SUP",BR_TAG="BR",DEFAULT_FOCUSABLE_TAGS=[A_TAG,AREA_TAG,INPUT_TAG$2,SELECT_TAG,TEXTAREA_TAG,BUTTON_TAG,IFRAME_TAG],FORMATTING_TAGS=[BOLD_TAG,STRONG_TAG,I_TAG,EM_TAG,MARK_TAG,SMALL_TAG,DEL_TAG,INS_TAG,SUB_TAG,SUP_TAG,BR_TAG],ELEMENTS_WITHOUT_CLOSING_TAG=[INPUT_TAG$2],DOM_EVENTS=["focusin","focusout","input","change","click","keydown","keyup"],USER_GESTURE_EVENTS=["input","change","click","keydown","keyup"],BLOCKED_DOM_EVENTS=["touchstart","touchend","touchmove","touchcancel","mousedown","mouseup","mousemove","mouseover","mouseout","pointerdown","pointerup","pointermove","pointerover","pointerout","pointercancel","gotpointercapture","lostpointercapture"],ARIA_LABELLEDBY="aria-labelledby",ARIA_DESCRIBEDBY="aria-describedby",ARIA_ACTIVE_DESCENDANT="aria-activedescendant",DATA_FOCUSABLE="data-focusable",DATA_PDOM_UNIQUE_ID="data-unique-id",ASSOCIATION_ATTRIBUTES$1=[ARIA_LABELLEDBY,ARIA_DESCRIBEDBY,ARIA_ACTIVE_DESCENDANT];function getLinearDOMElements(o){const e=o.getElementsByTagName("*"),t=[];for(let n=0;n<e.length;n++)e[n].nodeType===Node.ELEMENT_NODE&&(t[n]=e[n]);return t}function isElementHidden(o){return o.hidden?!0:o===document.body?!1:isElementHidden(o.parentElement)}function getNextPreviousFocusable(o,e){const t=e||document.body,n=getLinearDOMElements(t),r=document.activeElement,s=n.indexOf(r),a=o===NEXT$1?1:-1;let l=s+a;for(;l<n.length&&l>=0;){const d=n[l];if(l+=a,PDOMUtils.isElementFocusable(d))return d}return r}function trimLeft(o){return o.replace(/^\s+/,"")}function tagNameSupportsContent(o){return!_.includes(ELEMENTS_WITHOUT_CLOSING_TAG,o.toUpperCase())}const PDOMUtils={unwrapStringProperty(o){const e=o===null?null:typeof o=="string"?o:o.value;return assert&&assert(e===null||typeof e=="string"),e},getNextFocusable(o){return getNextPreviousFocusable(NEXT$1,o)},getPreviousFocusable(o){return getNextPreviousFocusable(PREVIOUS$1,o)},getFirstFocusable(o){const e=o||document.body,t=getLinearDOMElements(e);let n=document.body,r=0;for(;r<t.length;){const s=t[r];if(r++,PDOMUtils.isElementFocusable(s)){n=s;break}}return n},getRandomFocusable(o){assert&&assert(o,"Random expected");const e=getLinearDOMElements(document.body),t=[];for(let n=0;n<e.length;n++)PDOMUtils.isElementFocusable(e[n])&&t.push(e[n]);return t[o.nextInt(t.length)]},unwrapProperty(o){return isTReadOnlyProperty(o)?o.value:o},containsFormattingTags(o){if(o===null)return!1;assert&&assert(typeof o=="string","unsupported type for textContent.");let e=0;const t=[],n=[];for(;e<o.length;){const a=o.indexOf("<",e),l=o.indexOf(">",e);a>-1&&(t.push(a),e=a+1),l>-1?(n.push(l),e=l+1):e++}if(t.length!==n.length||t.length===0)return!1;let r=!0;const s=o.toUpperCase();for(let a=0;a<t.length;a++){let l=s.substring(t[a]+1,n[a]);l=l.replace("/","");const d=trimLeft(l);l.length-d.length>0||_.includes(FORMATTING_TAGS,l)||(r=!1)}return r},setTextContent(o,e){if(assert&&assert(o instanceof Element),assert&&assert(e===null||typeof e=="string"),e===null)o.innerHTML="";else{const t=e.replaceAll("<br>","<br/>"),n=stripEmbeddingMarks(t);validate(n,Validation.STRING_WITHOUT_TEMPLATE_VARS_VALIDATOR),tagNameSupportsContent(o.tagName)&&(PDOMUtils.containsFormattingTags(n)?o.innerHTML=n:o.textContent=n)}},tagIsDefaultFocusable(o){return _.includes(DEFAULT_FOCUSABLE_TAGS,o.toUpperCase())},isElementFocusable(o){return!document.body.contains(o)||isElementHidden(o)||_.includes(FORMATTING_TAGS,o.tagName)?!1:o.getAttribute(DATA_FOCUSABLE)==="true"},tagNameSupportsContent(o){return tagNameSupportsContent(o)},removeElements(o,e){for(let t=0;t<e.length;t++){const n=e[t];assert&&assert(o.contains(n),"element does not contain child to be removed: ",n),o.removeChild(n)}},insertElements(o,e,t){assert&&assert(o instanceof window.Element),assert&&assert(Array.isArray(e));for(let n=0;n<e.length;n++){const r=e[n];o.insertBefore(r,t||null)}},createElement(o,e,t){t=merge({namespace:null,id:null},t);const n=t.namespace?document.createElementNS(t.namespace,o):document.createElement(o);return t.id&&(n.id=t.id),PDOMUtils.overrideFocusWithTabIndex(n,e),n.classList.add(PDOMSiblingStyle$1.SIBLING_CLASS_NAME),n},overrideFocusWithTabIndex(o,e){PDOMUtils.tagIsDefaultFocusable(o.tagName)!==e?o.tabIndex=e?0:-1:o.removeAttribute("tabindex"),o.setAttribute(DATA_FOCUSABLE,e)},TAGS:{INPUT:INPUT_TAG$2,LABEL:LABEL_TAG$1,BUTTON:BUTTON_TAG,TEXTAREA:TEXTAREA_TAG,SELECT:SELECT_TAG,OPTGROUP:OPTGROUP_TAG,DATALIST:DATALIST_TAG,OUTPUT:OUTPUT_TAG,DIV:DIV_TAG,A:A_TAG,P:P_TAG$1,B:BOLD_TAG,STRONG:STRONG_TAG,I:I_TAG,EM:EM_TAG,MARK:MARK_TAG,SMALL:SMALL_TAG,DEL:DEL_TAG,INS:INS_TAG,SUB:SUB_TAG,SUP:SUP_TAG},FORM_ELEMENTS:[INPUT_TAG$2,BUTTON_TAG,TEXTAREA_TAG,SELECT_TAG,OPTGROUP_TAG,DATALIST_TAG,OUTPUT_TAG,A_TAG],DEFAULT_CONTAINER_TAG_NAME:DIV_TAG,DEFAULT_DESCRIPTION_TAG_NAME:P_TAG$1,DEFAULT_LABEL_TAG_NAME:P_TAG$1,ASSOCIATION_ATTRIBUTES:ASSOCIATION_ATTRIBUTES$1,INPUT_TYPES_THAT_SUPPORT_CHECKED:["RADIO","CHECKBOX"],DOM_EVENTS,USER_GESTURE_EVENTS,BLOCKED_DOM_EVENTS,DATA_PDOM_UNIQUE_ID,PDOM_UNIQUE_ID_SEPARATOR:"-",DATA_EXCLUDE_FROM_INPUT:"data-exclude-from-input"};scenery.register("PDOMUtils",PDOMUtils);const PDOMUtils$1=PDOMUtils,initialProfileName=_.hasIn(window,"phet.chipper.queryParameters.colorProfile")?phet.chipper.queryParameters.colorProfile:SceneryConstants.DEFAULT_COLOR_PROFILE,colorProfiles=_.hasIn(window,"phet.chipper.colorProfiles")?phet.chipper.colorProfiles:[SceneryConstants.DEFAULT_COLOR_PROFILE],colorProfileProperty=new StringProperty(initialProfileName,{tandem:Tandem.GENERAL_VIEW.createTandem("colorProfileProperty"),phetioFeatured:!0,validValues:colorProfiles});scenery.register("colorProfileProperty",colorProfileProperty);const NAME_SEPARATOR=".",instances=[];class ProfileColorProperty extends ColorProperty{constructor(e,t,n,r){const s=optionize()({valueComparisonStrategy:"equalsFunction",tandemNameSuffix:["ColorProperty","FillProperty","StrokeProperty"]},r);if(n=_.mapValues(n,a=>Color.toColor(a).setImmutable()),assert&&assert(n.hasOwnProperty(SceneryConstants.DEFAULT_COLOR_PROFILE),"default color profile must be provided"),assert&&assert(!!n[SceneryConstants.DEFAULT_COLOR_PROFILE],"default color profile must be truthy"),super(Color.toColor(n[colorProfileProperty.value]||n[SceneryConstants.DEFAULT_COLOR_PROFILE]),s),this.colorProfileMap=n,colorProfileProperty.link(a=>{this.value=Color.toColor(this.colorProfileMap[a]||this.colorProfileMap[SceneryConstants.DEFAULT_COLOR_PROFILE])}),this.name=`${e.name}${NAME_SEPARATOR}${t}`,this.link(a=>{window.parent!==window&&window.parent.postMessage(JSON.stringify({type:"reportColor",name:this.name,value:a.toHexString(),alpha:a.getAlpha()}),"*")}),assert){const a=instances.filter(l=>l.name===this.name);assert&&assert(a.length===0,"cannot use the same name for two different ProfileColorProperty instances: "+name)}instances.push(this)}dispose(){arrayRemove(instances,this),super.dispose()}}window.addEventListener("message",o=>{let e;try{e=JSON.parse(o.data)}catch{}if(e&&e.type==="setColor")for(let t=0;t<instances.length;t++){const n=instances[t];n.name===e.name&&(n.colorProfileMap[colorProfileProperty.value]=new Color(e.value).withAlpha(e.alpha),n.value=Color.toColor(n.colorProfileMap[colorProfileProperty.value]))}});scenery.register("ProfileColorProperty",ProfileColorProperty);let globalId$6=1;class Paint{constructor(){this.id=`paint${globalId$6++}`,this.transformMatrix=null}setTransformMatrix(e){return this.transformMatrix!==e&&(this.transformMatrix=e),this}toString(){return this.id}}Paint.prototype.isPaint=!0;scenery.register("Paint",Paint);class Gradient extends Paint{constructor(){super(),assert&&assert(this.constructor.name!=="Gradient","Please create a LinearGradient or RadialGradient. Do not directly use the supertype Gradient."),this.stops=[],this.lastStopRatio=0,this.canvasGradient=null,this.colorStopsDirty=!1,this.lastColorStopValues=[]}addColorStop(e,t){if(assert&&assert(e>=0&&e<=1,"Ratio needs to be between 0,1 inclusively"),assert&&assert(t===null||typeof t=="string"||t instanceof Color||isTReadOnlyProperty(t)&&(t.value===null||typeof t.value=="string"||t.value instanceof Color),"Color should match the addColorStop type specification"),this.lastStopRatio>e)throw new Error("Color stops not specified in the order of increasing ratios");return this.lastStopRatio=e,this.stops.push({ratio:e,color:t}),this.lastColorStopValues.push(""),this}getSVGStops(){return this.stops}invalidateCanvasGradient(){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`Invalidated Canvas Gradient for #${this.id}`),this.colorStopsDirty=!0}haveCanvasColorStopsChanged(){if(this.lastColorStopValues===null)return!0;for(let e=0;e<this.stops.length;e++)if(Gradient.colorToString(this.stops[e].color)!==this.lastColorStopValues[e])return!0;return!1}getCanvasStyle(){if(!this.canvasGradient||this.colorStopsDirty&&this.haveCanvasColorStopsChanged()){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`Regenerating Canvas Gradient for #${this.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.colorStopsDirty=!1,cleanArray(this.lastColorStopValues),this.canvasGradient=this.createCanvasGradient();for(let e=0;e<this.stops.length;e++){const t=this.stops[e],n=Gradient.colorToString(t.color);this.canvasGradient.addColorStop(t.ratio,n),this.lastColorStopValues.push(n)}sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}return this.canvasGradient}static colorToString(e){return isTReadOnlyProperty(e)&&(e=e.value),e===null&&(e="transparent"),e instanceof Color&&(e=e.toCSS()),e}}Gradient.prototype.isGradient=!0;scenery.register("Gradient",Gradient);class LinearGradient extends Gradient{constructor(e,t,n,r){assert&&assert(isFinite(e)&&isFinite(t)&&isFinite(n)&&isFinite(r)),super(),this.start=new Vector2(e,t),this.end=new Vector2(n,r)}createCanvasGradient(){return scenery.scratchContext.createLinearGradient(this.start.x,this.start.y,this.end.x,this.end.y)}createSVGPaint(e){return SVGLinearGradient.pool.create(e,this)}toString(){let e=`new phet.scenery.LinearGradient( ${this.start.x}, ${this.start.y}, ${this.end.x}, ${this.end.y} )`;return _.each(this.stops,t=>{e+=`.addColorStop( ${t.ratio}, ${ColorDef$1.scenerySerialize(t.color)} )`}),e}}LinearGradient.prototype.isLinearGradient=!0;scenery.register("LinearGradient",LinearGradient);class RadialGradient extends Gradient{constructor(e,t,n,r,s,a){if(super(),this.start=new Vector2(e,t),this.end=new Vector2(r,s),platform.safari){const l=(e+r)/2,d=(t+s)/2;this.start.x=l,this.start.y=d,this.end.x=l,this.end.y=d}this.startRadius=n,this.endRadius=a,this.focalPoint=this.start.plus(this.end.minus(this.start).times(this.startRadius/(this.startRadius-this.endRadius))),this.startIsLarger=this.startRadius>this.endRadius,this.largePoint=this.startIsLarger?this.start:this.end,this.maxRadius=Math.max(this.startRadius,this.endRadius),this.minRadius=Math.min(this.startRadius,this.endRadius),this.startRadius>=this.endRadius?assert&&assert(this.focalPoint.minus(this.start).magnitude<=this.startRadius):assert&&assert(this.focalPoint.minus(this.end).magnitude<=this.endRadius)}createCanvasGradient(){return scenery.scratchContext.createRadialGradient(this.start.x,this.start.y,this.startRadius,this.end.x,this.end.y,this.endRadius)}createSVGPaint(e){return SVGRadialGradient.pool.create(e,this)}getSVGStops(){const e=this.startIsLarger,t=this.maxRadius,n=this.minRadius;function r(l,d,c,y,m){return c+(m-l)*(y-c)/(d-l)}function s(l){let d=e?1-l.ratio:l.ratio;return n>0&&(d=r(0,1,n/t,1,d)),{ratio:d,color:l.color}}const a=this.stops.map(s);return e&&a.reverse(),a}toString(){let e=`new phet.scenery.RadialGradient( ${this.start.x}, ${this.start.y}, ${this.startRadius}, ${this.end.x}, ${this.end.y}, ${this.endRadius} )`;return _.each(this.stops,t=>{e+=`.addColorStop( ${t.ratio}, ${ColorDef$1.scenerySerialize(t.color)} )`}),e}}RadialGradient.prototype.isRadialGradient=!0;scenery.register("RadialGradient",RadialGradient);class Pattern extends Paint{constructor(e){super(),this.image=e,this.canvasPattern=scenery.scratchContext.createPattern(e,"repeat")}getCanvasStyle(){return this.canvasPattern}createSVGPaint(e){return SVGPattern.pool.create(this)}toString(){return`new phet.scenery.Pattern( $( '<img src="${this.image.src}"/>' )[0] )`}}Pattern.prototype.isPattern=!0;scenery.register("Pattern",Pattern);class NodePattern extends Pattern{constructor(e,t,n,r,s,a,l=Matrix3.IDENTITY){assert&&assert(t>0&&Number.isInteger(t),"Resolution should be a positive integer"),assert&&assert(Number.isInteger(s)),assert&&assert(Number.isInteger(a));const d=document.createElement("img");function c(m,O,D,z,w){d.src=m.toDataURL()}new Node$2({scale:t,children:[e]}).toCanvas(c,-n*t,-r*t,s*t,a*t),super(d),this.setTransformMatrix(l.timesMatrix(Matrix3.scaling(1/t)))}}scenery.register("NodePattern",NodePattern);let globalId$5=1;class Filter{constructor(){this.id=`filter${globalId$5++}`,this.filterRegionPercentageIncrease=0}isDOMCompatible(){return!1}isSVGCompatible(){return!1}isCanvasCompatible(){return Features.canvasFilter?this.isDOMCompatible():!1}isWebGLCompatible(){return!1}toString(){return this.id}static applyColorMatrix(e,t,n,r){const s=document.createElementNS(svgns,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values",e),s.setAttribute("in",n),s.setAttribute("color-interpolation-filters","sRGB"),r&&s.setAttribute("result",r),t.appendChild(s)}}scenery.register("Filter",Filter);const cache$2=new IOTypeCache,OrIO=o=>{assert&&assert(Array.isArray(o),"OrIO needs to be an array"),assert&&assert(o.length>1,"OrIO needs parameterTypes");const e=o.map(n=>n.typeName),t=e.join(",");if(!cache$2.has(t)){const n=r=>{for(let s=0;s<o.length;s++){const a=o[s];if(Validation.isValueValid(r,a.validator))return!0}return!1};cache$2.set(t,new IOType(`OrIO<${e.join(", ")}>`,{documentation:"A PhET-iO Type adding support for a composite type that can be any of its parameters.",parameterTypes:o,isValidValue:n,toStateObject:r=>{for(let s=0;s<o.length;s++){const a=o[s];if(Validation.isValueValid(r,a.validator))return{index:s,state:a.toStateObject(r)}}throw new Error("somehow the instance was not valid, we should not get here. Why was isValidValue not used before this step?")},fromStateObject:r=>(assert&&assert(r.hasOwnProperty("index"),"index required for deserialization"),assert&&assert(r.hasOwnProperty("state"),"state required for deserialization"),o[r.index].fromStateObject(r.state)),stateSchema:StateSchema.asValue(`${e.join("|")}`,{isValidValue:r=>typeof r.index=="number"?o[r.index].isStateObjectValid(r.state):!1})}))}return cache$2.get(t)};tandemNamespace.register("OrIO",OrIO);class CouldNotYetDeserializeError extends Error{constructor(){super("CouldNotYetDeserializeError")}}tandemNamespace.register("CouldNotYetDeserializeError",CouldNotYetDeserializeError);const cache$1=new IOTypeCache,ReferenceIO=o=>{assert&&assert(o,"ReferenceIO needs parameterType");const e=o;return cache$1.has(e)||(assert&&assert(typeof o.typeName=="string","type name should be a string"),cache$1.set(e,new IOType(`ReferenceIO<${o.typeName}>`,{isValidValue:t=>Validation.isValueValid(t,o.validator),documentation:"Uses reference identity for serializing and deserializing, and validates based on its parameter PhET-iO Type.",parameterTypes:[o],toStateObject(t){return{phetioID:t.tandem.phetioID}},stateSchema:{phetioID:StringIO},fromStateObject(t){if(assert&&assert(t&&typeof t.phetioID=="string","phetioID should be a string"),phet.phetio.phetioEngine.hasPhetioObject(t.phetioID))return phet.phetio.phetioEngine.getPhetioElement(t.phetioID);throw new CouldNotYetDeserializeError},applyState(t){assert&&assert(!1,`ReferenceIO is meant to be used as DataType serialization (see fromStateObject) for phetioID: ${t.tandem.phetioID}`)}}))),cache$1.get(e)};tandemNamespace.register("ReferenceIO",ReferenceIO);const ColorDef={isColorDef(o){return o===null||typeof o=="string"||o instanceof Color||isTReadOnlyProperty(o)&&(o.value===null||typeof o.value=="string"||o.value instanceof Color)},scenerySerialize(o){return o===null?"null":o instanceof Color?`'${o.toCSS()}'`:typeof o=="string"?`'${o}'`:ColorDef.scenerySerialize(o.value)},ColorDefIO:null};ColorDef.ColorDefIO=new IOType("ColorDefIO",{isValidValue:ColorDef.isColorDef,supertype:NullableIO(OrIO([StringIO,Color.ColorIO,ReferenceIO(Property.PropertyIO(NullableIO(OrIO([StringIO,Color.ColorIO]))))]))});scenery.register("ColorDef",ColorDef);const ColorDef$1=ColorDef,PaintDef={isPaintDef(o){return o===null||typeof o=="string"||o instanceof Color||o instanceof Paint||isTReadOnlyProperty(o)&&(o.value===null||typeof o.value=="string"||o.value instanceof Color)},toColor(o){if(typeof o=="string")return new Color(o);if(o instanceof Color)return o.copy();if(isTReadOnlyProperty(o))return PaintDef.toColor(o.value);if(o instanceof Gradient){let e=Color.TRANSPARENT;const t=0;return o.stops.forEach(n=>{e=e.blend(PaintDef.toColor(n.color),1/(t+1))}),e}return Color.TRANSPARENT}};scenery.register("PaintDef",PaintDef);const createGatedVisibleProperty=(o,e,t)=>DerivedProperty.and([o,new BooleanProperty(!0,combineOptions({tandem:e.createTandem("selfVisibleProperty"),phetioFeatured:!0},t))],{tandem:e.createTandem("visibleProperty"),phetioValueType:BooleanIO});scenery.register("createGatedVisibleProperty",createGatedVisibleProperty);const isImageDataSupported=Utils.supportsImageDataCanvasFilter(),useFakeGamma=platform.chromium;class ColorMatrixFilter extends Filter{constructor(e,t,n,r,s,a,l,d,c,y,m,O,D,z,w,N,H,X,ae,oe){assert&&assert(isFinite(e),"m00 should be a finite number"),assert&&assert(isFinite(t),"m01 should be a finite number"),assert&&assert(isFinite(n),"m02 should be a finite number"),assert&&assert(isFinite(r),"m03 should be a finite number"),assert&&assert(isFinite(s),"m04 should be a finite number"),assert&&assert(isFinite(a),"m10 should be a finite number"),assert&&assert(isFinite(l),"m11 should be a finite number"),assert&&assert(isFinite(d),"m12 should be a finite number"),assert&&assert(isFinite(c),"m13 should be a finite number"),assert&&assert(isFinite(y),"m14 should be a finite number"),assert&&assert(isFinite(m),"m20 should be a finite number"),assert&&assert(isFinite(O),"m21 should be a finite number"),assert&&assert(isFinite(D),"m22 should be a finite number"),assert&&assert(isFinite(z),"m23 should be a finite number"),assert&&assert(isFinite(w),"m24 should be a finite number"),assert&&assert(isFinite(N),"m30 should be a finite number"),assert&&assert(isFinite(H),"m31 should be a finite number"),assert&&assert(isFinite(X),"m32 should be a finite number"),assert&&assert(isFinite(ae),"m33 should be a finite number"),assert&&assert(isFinite(oe),"m34 should be a finite number"),super(),this.m00=e,this.m01=t,this.m02=n,this.m03=r,this.m04=s,this.m10=a,this.m11=l,this.m12=d,this.m13=c,this.m14=y,this.m20=m,this.m21=O,this.m22=D,this.m23=z,this.m24=w,this.m30=N,this.m31=H,this.m32=X,this.m33=ae,this.m34=oe}applySVGFilter(e,t,n){Filter.applyColorMatrix(`${toSVGNumber(this.m00)} ${toSVGNumber(this.m01)} ${toSVGNumber(this.m02)} ${toSVGNumber(this.m03)} ${toSVGNumber(this.m04)} ${toSVGNumber(this.m10)} ${toSVGNumber(this.m11)} ${toSVGNumber(this.m12)} ${toSVGNumber(this.m13)} ${toSVGNumber(this.m14)} ${toSVGNumber(this.m20)} ${toSVGNumber(this.m21)} ${toSVGNumber(this.m22)} ${toSVGNumber(this.m23)} ${toSVGNumber(this.m24)} ${toSVGNumber(this.m30)} ${toSVGNumber(this.m31)} ${toSVGNumber(this.m32)} ${toSVGNumber(this.m33)} ${toSVGNumber(this.m34)}`,e,t,n)}applyCanvasFilter(e){const t=e.canvas.width,n=e.canvas.height,r=e.context.getImageData(0,0,t,n),s=t*n;for(let a=0;a<s;a++){const l=a*4;if(useFakeGamma){const c=Math.pow(r.data[l+0]/255,1.45),y=Math.pow(r.data[l+1]/255,1.45),m=Math.pow(r.data[l+2]/255,1.45),O=Math.pow(r.data[l+3]/255,1.45);r.data[l+0]=255*Math.pow(c*this.m00+y*this.m01+m*this.m02+O*this.m03+this.m04,1/1.45),r.data[l+1]=255*Math.pow(c*this.m10+y*this.m11+m*this.m12+O*this.m13+this.m14,1/1.45),r.data[l+2]=255*Math.pow(c*this.m20+y*this.m21+m*this.m22+O*this.m23+this.m24,1/1.45),r.data[l+3]=255*Math.pow(c*this.m30+y*this.m31+m*this.m32+O*this.m33+this.m34,1/1.45)}else{const d=r.data[l+0],c=r.data[l+1],y=r.data[l+2],m=r.data[l+3];r.data[l+0]=d*this.m00+c*this.m01+y*this.m02+m*this.m03+this.m04,r.data[l+1]=d*this.m10+c*this.m11+y*this.m12+m*this.m13+this.m14,r.data[l+2]=d*this.m20+c*this.m21+y*this.m22+m*this.m23+this.m24,r.data[l+3]=d*this.m30+c*this.m31+y*this.m32+m*this.m33+this.m34}}e.context.putImageData(r,0,0)}isSVGCompatible(){return!0}isCanvasCompatible(){return super.isCanvasCompatible()||isImageDataSupported}getCSSFilterString(){throw new Error("unimplemented")}}scenery.register("ColorMatrixFilter",ColorMatrixFilter);const Ch=class Ch extends ColorMatrixFilter{constructor(e){assert&&assert(isFinite(e),"Brightness amount should be finite"),assert&&assert(e>=0,"Brightness amount should be non-negative"),super(e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0),this.amount=e}getCSSFilterString(){return`brightness(${toSVGNumber(this.amount)})`}isDOMCompatible(){return!0}};Ch.BLACKEN=new Ch(0);let Brightness=Ch;scenery.register("Brightness",Brightness);const Dh=class Dh extends ColorMatrixFilter{constructor(e){assert&&assert(isFinite(e),"Contrast amount should be finite"),assert&&assert(e>=0,"Contrast amount should be non-negative"),super(e,0,0,0,-(.5*e)+.5,0,e,0,0,-(.5*e)+.5,0,0,e,0,-(.5*e)+.5,0,0,0,1,0),this.amount=e}getCSSFilterString(){return`contrast(${toSVGNumber(this.amount)})`}isDOMCompatible(){return!0}};Dh.GRAY=new Dh(0);let Contrast=Dh;scenery.register("Contrast",Contrast);class DropShadow extends Filter{constructor(e,t,n,r=15){assert&&assert(e.isFinite(),"DropShadow offset should be finite"),assert&&assert(isFinite(t),"DropShadow blurRadius should be finite"),assert&&assert(t>=0,"DropShadow blurRadius should be non-negative"),assert&&assert(ColorDef$1.isColorDef(n),"DropShadow color should be a ColorDef"),super(),this.offset=e,this.blurRadius=t,this.color=n,this.colorCSS=PaintDef.toColor(n).toCSS(),this.filterRegionPercentageIncrease=r}getCSSFilterString(){return`drop-shadow(${toSVGNumber(this.offset.x)}px ${toSVGNumber(this.offset.y)}px ${toSVGNumber(this.blurRadius)}px ${this.colorCSS})`}isDOMCompatible(){return!0}applyCanvasFilter(){throw new Error("unimplemented")}applySVGFilter(e,t,n){throw new Error("unimplemented")}}scenery.register("DropShadow",DropShadow);class GaussianBlur extends Filter{constructor(e,t=15){assert&&assert(isFinite(e),"GaussianBlur standardDeviation should be finite"),assert&&assert(e>=0,"GaussianBlur standardDeviation should be non-negative"),super(),this.standardDeviation=e,this.filterRegionPercentageIncrease=t}getCSSFilterString(){return`blur(${toSVGNumber(this.standardDeviation)}px)`}applySVGFilter(e,t,n){const r=document.createElementNS(svgns,"feGaussianBlur");r.setAttribute("stdDeviation",toSVGNumber(this.standardDeviation)),r.setAttribute("edgeMode","none"),e.appendChild(r),r.setAttribute("in",t),n&&r.setAttribute("result",n),e.appendChild(r)}isDOMCompatible(){return!0}isSVGCompatible(){return!0}applyCanvasFilter(e){throw new Error("unimplemented")}}scenery.register("GaussianBlur",GaussianBlur);const xh=class xh extends ColorMatrixFilter{constructor(e=1){assert&&assert(isFinite(e),"Grayscale amount should be finite"),assert&&assert(e>=0,"Grayscale amount should be non-negative"),assert&&assert(e<=1,"Grayscale amount should be no greater than 1");const t=1-e;super(.2126+.7874*t,.7152-.7152*t,.0722-.0722*t,0,0,.2126-.2126*t,.7152+.2848*t,.0722-.0722*t,0,0,.2126-.2126*t,.7152-.7152*t,.0722+.9278*t,0,0,0,0,0,1,0),this.amount=e}getCSSFilterString(){return`grayscale(${toSVGNumber(this.amount)})`}isDOMCompatible(){return!0}};xh.FULL=new xh(1);let Grayscale=xh;scenery.register("Grayscale",Grayscale);class HueRotate extends ColorMatrixFilter{constructor(e){assert&&assert(isFinite(e),"HueRotate amount should be finite"),assert&&assert(e>=0,"HueRotate amount should be non-negative");const t=Math.cos(e),n=Math.sin(e);super(.213+.787*t-.213*n,.715-.715*t-.715*n,.072-.072*t+.928*n,0,0,.213-.213*t+.143*n,.715+.285*t+.14*n,.072-.072*t-.283*n,0,0,.213-.213*t-.787*n,.715-.715*t+.715*n,.072+.928*t+.072*n,0,0,0,0,0,1,0),this.amount=e}getCSSFilterString(){return`hue-rotate(${toSVGNumber(DotUtils.toDegrees(this.amount))}deg)`}isDOMCompatible(){return!0}}scenery.register("HueRotate",HueRotate);const Ih=class Ih extends Filter{constructor(e=1){assert&&assert(isFinite(e),"Invert amount should be finite"),assert&&assert(e>=0,"Invert amount should be non-negative"),assert&&assert(e<=1,"Invert amount should be no greater than 1"),super(),this.amount=e}getCSSFilterString(){return`invert(${toSVGNumber(this.amount)})`}isDOMCompatible(){return!0}applyCanvasFilter(e){throw new Error("unimplemented")}applySVGFilter(e,t,n){throw new Error("unimplemented")}};Ih.FULL=new Ih(1);let Invert=Ih;scenery.register("Invert",Invert);class Opacity extends Filter{constructor(e){assert&&assert(isFinite(e),"Opacity amount should be finite"),assert&&assert(e>=0,"Opacity amount should be non-negative"),assert&&assert(e<=1,"Opacity amount should be no greater than 1"),super(),this.amount=e}getCSSFilterString(){return`opacity(${toSVGNumber(this.amount)})`}isDOMCompatible(){return!0}applyCanvasFilter(e){throw new Error("unimplemented")}applySVGFilter(e,t,n){throw new Error("unimplemented")}}scenery.register("Opacity",Opacity);class Saturate extends ColorMatrixFilter{constructor(e){assert&&assert(isFinite(e),"Saturate amount should be finite"),assert&&assert(e>=0,"Saturate amount should be non-negative"),super(.213+.787*e,.715-.715*e,.072-.072*e,0,0,.213-.213*e,.715-.285*e,.072-.072*e,0,0,.213-.213*e,.715-.715*e,.072-.928*e,0,0,0,0,0,1,0),this.amount=e}getCSSFilterString(){return`saturate(${toSVGNumber(this.amount)})`}isDOMCompatible(){return!0}}scenery.register("Saturate",Saturate);const Vh=class Vh extends ColorMatrixFilter{constructor(e=1){assert&&assert(isFinite(e),"Sepia amount should be finite"),assert&&assert(e>=0,"Sepia amount should be non-negative"),assert&&assert(e<=1,"Sepia amount should be at most 1"),super(.393+.607*(1-e),.769-.769*(1-e),.189-.189*(1-e),0,0,.349-.349*(1-e),.686+.314*(1-e),.168-.168*(1-e),0,0,.272-.272*(1-e),.534-.534*(1-e),.131+.869*(1-e),0,0,0,0,0,1,0),this.amount=e}getCSSFilterString(){return`sepia(${toSVGNumber(this.amount)})`}isDOMCompatible(){return!0}};Vh.FULL=new Vh(1);let Sepia=Vh;scenery.register("Sepia",Sepia);const INPUT_TAG$1=PDOMUtils$1.TAGS.INPUT,P_TAG=PDOMUtils$1.TAGS.P,DEFAULT_DESCRIPTION_TAG_NAME=P_TAG,DEFAULT_LABEL_TAG_NAME=P_TAG,DEFAULT_PDOM_HEADING_BEHAVIOR=(o,e,t)=>(e.labelTagName=`h${o.headingLevel}`,e.labelContent=t,e),unwrapProperty=o=>{const e=o===null?null:typeof o=="string"?o:o.value;return assert&&assert(e===null||typeof e=="string"),e},FORM_ELEMENTS=PDOMUtils$1.FORM_ELEMENTS,INPUT_TYPES_THAT_SUPPORT_CHECKED=PDOMUtils$1.INPUT_TYPES_THAT_SUPPORT_CHECKED,ASSOCIATION_ATTRIBUTES=PDOMUtils$1.ASSOCIATION_ATTRIBUTES,ACCESSIBILITY_OPTION_KEYS=["focusable","tagName","accessibleName","accessibleNameBehavior","helpText","helpTextBehavior","pdomHeading","pdomHeadingBehavior","containerTagName","containerAriaRole","innerContent","inputType","inputValue","pdomChecked","pdomNamespace","ariaLabel","ariaRole","ariaValueText","labelTagName","labelContent","appendLabel","descriptionTagName","descriptionContent","appendDescription","focusHighlight","focusHighlightLayerable","groupFocusHighlight","pdomVisible","pdomOrder","ariaLabelledbyAssociations","ariaDescribedbyAssociations","activeDescendantAssociations","focusPanTargetBoundsProperty","limitPanDirection","positionInPDOM","pdomTransformSourceNode"];class ParallelDOM extends PhetioObject{constructor(e){super(e),this._inputValue=null,this._labelContent=null,this._innerContent=null,this._descriptionContent=null,this._ariaLabel=null,this._hasAppliedAriaLabel=!1,this._ariaValueText=null,this._hasAppliedAriaValueText=!1,this._accessibleName=null,this._helpText=null,this._pdomHeading=null,this._onPDOMContentChangeListener=this.onPDOMContentChange.bind(this),this._onInputValueChangeListener=this.invalidatePeerInputValue.bind(this),this._onAriaLabelChangeListener=this.onAriaLabelChange.bind(this),this._onAriaValueTextChangeListener=this.onAriaValueTextChange.bind(this),this._onLabelContentChangeListener=this.invalidatePeerLabelSiblingContent.bind(this),this._onDescriptionContentChangeListener=this.invalidatePeerDescriptionSiblingContent.bind(this),this._onInnerContentChangeListener=this.onInnerContentPropertyChange.bind(this),this._tagName=null,this._containerTagName=null,this._labelTagName=null,this._descriptionTagName=null,this._inputType=null,this._pdomChecked=!1,this._appendLabel=!1,this._appendDescription=!1,this._pdomAttributes=[],this._pdomClasses=[],this._pdomNamespace=null,this._ariaRole=null,this._containerAriaRole=null,this._ariaLabelledbyAssociations=[],this._nodesThatAreAriaLabelledbyThisNode=[],this._ariaDescribedbyAssociations=[],this._nodesThatAreAriaDescribedbyThisNode=[],this._activeDescendantAssociations=[],this._nodesThatAreActiveDescendantToThisNode=[],this._focusableOverride=null,this._focusHighlight=null,this._focusHighlightLayerable=!1,this._groupFocusHighlight=!1,this._pdomVisible=!0,this._pdomOrder=null,this._pdomParent=null,this._pdomTransformSourceNode=null,this._focusPanTargetBoundsProperty=null,this._limitPanDirection=null,this._pdomDisplaysInfo=new PDOMDisplaysInfo(this),this._pdomInstances=[],this._positionInPDOM=!1,this.excludeLabelSiblingFromInput=!1,this._accessibleNameBehavior=ParallelDOM.BASIC_ACCESSIBLE_NAME_BEHAVIOR,this._helpTextBehavior=ParallelDOM.HELP_TEXT_AFTER_CONTENT,this._headingLevel=null,this._pdomHeadingBehavior=DEFAULT_PDOM_HEADING_BEHAVIOR,this.focusHighlightChangedEmitter=new TinyEmitter,this.pdomDisplaysEmitter=new TinyEmitter,this.pdomBoundInputEnabledListener=this.pdomInputEnabledListener.bind(this)}disposeParallelDOM(){isTReadOnlyProperty(this._accessibleName)&&!this._accessibleName.isDisposed&&(this._accessibleName.unlink(this._onPDOMContentChangeListener),this._accessibleName=null),isTReadOnlyProperty(this._helpText)&&!this._helpText.isDisposed&&(this._helpText.unlink(this._onPDOMContentChangeListener),this._helpText=null),isTReadOnlyProperty(this._pdomHeading)&&!this._pdomHeading.isDisposed&&(this._pdomHeading.unlink(this._onPDOMContentChangeListener),this._pdomHeading=null),isTReadOnlyProperty(this._inputValue)&&!this._inputValue.isDisposed&&(this._inputValue.unlink(this._onPDOMContentChangeListener),this._inputValue=null),isTReadOnlyProperty(this._ariaLabel)&&!this._ariaLabel.isDisposed&&this._ariaLabel.unlink(this._onAriaLabelChangeListener),isTReadOnlyProperty(this._ariaValueText)&&!this._ariaValueText.isDisposed&&this._ariaValueText.unlink(this._onAriaValueTextChangeListener),isTReadOnlyProperty(this._innerContent)&&!this._innerContent.isDisposed&&this._innerContent.unlink(this._onInnerContentChangeListener),isTReadOnlyProperty(this._labelContent)&&!this._labelContent.isDisposed&&this._labelContent.unlink(this._onLabelContentChangeListener),isTReadOnlyProperty(this._descriptionContent)&&!this._descriptionContent.isDisposed&&this._descriptionContent.unlink(this._onDescriptionContentChangeListener),this.inputEnabledProperty.unlink(this.pdomBoundInputEnabledListener),this.pdomOrder=null,this.setPDOMTransformSourceNode(null),this.setAriaLabelledbyAssociations([]),this.setAriaDescribedbyAssociations([]),this.setActiveDescendantAssociations([]),this.removePDOMAttributes()}pdomInputEnabledListener(e){this.setPDOMAttribute("aria-disabled",!e),this.setPDOMAttribute("onclick",e?"":"return false")}isFocused(){for(let e=0;e<this._pdomInstances.length;e++)if(this._pdomInstances[e].peer.isFocused())return!0;return!1}get focused(){return this.isFocused()}focus(){if(this._pdomInstances.length>0){assert&&assert(this.focusable,"trying to set focus on a node that is not focusable"),assert&&assert(this._pdomVisible,"trying to set focus on a node with invisible pdom content"),assert&&assert(this._pdomInstances.length===1,"focus() unsupported for Nodes using DAG, pdom content is not unique");const e=this._pdomInstances[0].peer;assert&&assert(e,"must have a peer to focus"),e.focus()}}blur(){if(this._pdomInstances.length>0){assert&&assert(this._pdomInstances.length===1,"blur() unsupported for Nodes using DAG, pdom content is not unique");const e=this._pdomInstances[0].peer;assert&&assert(e,"must have a peer to blur"),e.blur()}}pdomAudit(){this.hasPDOMContent&&assert&&(this._inputType&&assert(this._tagName.toUpperCase()===INPUT_TAG$1,"tagName must be INPUT to support inputType"),this._pdomChecked&&assert(this._tagName.toUpperCase()===INPUT_TAG$1,"tagName must be INPUT to support pdomChecked."),this._inputValue&&assert(this._tagName.toUpperCase()===INPUT_TAG$1,"tagName must be INPUT to support inputValue"),this._pdomChecked&&assert(INPUT_TYPES_THAT_SUPPORT_CHECKED.includes(this._inputType.toUpperCase()),`inputType does not support checked attribute: ${this._inputType}`),this._focusHighlightLayerable&&assert(this.focusHighlight instanceof Node$2,"focusHighlight must be Node if highlight is layerable"),this._tagName.toUpperCase()===INPUT_TAG$1&&assert(typeof this._inputType=="string"," inputType expected for input"),this.ariaRole==="application"&&assert(this.innerContent||this.accessibleName,"must have some innerContent or element will never be focusable in VoiceOver"));for(let e=0;e<this.children.length;e++)this.children[e].pdomAudit()}setAccessibleName(e){e!==this._accessibleName&&(isTReadOnlyProperty(this._accessibleName)&&!this._accessibleName.isDisposed&&this._accessibleName.unlink(this._onPDOMContentChangeListener),this._accessibleName=e,isTReadOnlyProperty(e)&&e.lazyLink(this._onPDOMContentChangeListener),this.onPDOMContentChange())}set accessibleName(e){this.setAccessibleName(e)}get accessibleName(){return this.getAccessibleName()}getAccessibleName(){return isTReadOnlyProperty(this._accessibleName)?this._accessibleName.value:this._accessibleName}removeFromPDOM(){assert&&assert(this._tagName!==null,"There is no pdom content to clear from the PDOM"),this.tagName=null}setAccessibleNameBehavior(e){this._accessibleNameBehavior!==e&&(this._accessibleNameBehavior=e,this.onPDOMContentChange())}set accessibleNameBehavior(e){this.setAccessibleNameBehavior(e)}get accessibleNameBehavior(){return this.getAccessibleNameBehavior()}getAccessibleNameBehavior(){return this._accessibleNameBehavior}setPDOMHeading(e){e!==this._pdomHeading&&(isTReadOnlyProperty(this._pdomHeading)&&!this._pdomHeading.isDisposed&&this._pdomHeading.unlink(this._onPDOMContentChangeListener),this._pdomHeading=e,isTReadOnlyProperty(e)&&e.lazyLink(this._onPDOMContentChangeListener),this.onPDOMContentChange())}set pdomHeading(e){this.setPDOMHeading(e)}get pdomHeading(){return this.getPDOMHeading()}getPDOMHeading(){return isTReadOnlyProperty(this._pdomHeading)?this._pdomHeading.value:this._pdomHeading}setPDOMHeadingBehavior(e){this._pdomHeadingBehavior!==e&&(this._pdomHeadingBehavior=e,this.onPDOMContentChange())}set pdomHeadingBehavior(e){this.setPDOMHeadingBehavior(e)}get pdomHeadingBehavior(){return this.getPDOMHeadingBehavior()}getPDOMHeadingBehavior(){return this._pdomHeadingBehavior}getHeadingLevel(){return this._headingLevel}get headingLevel(){return this.getHeadingLevel()}computeHeadingLevel(){if(!this._pdomParent)return this.pdomHeading?(this._headingLevel=1,1):0;if(this.pdomHeading){const e=this._pdomParent.computeHeadingLevel()+1;return this._headingLevel=e,e}else return this._pdomParent.computeHeadingLevel()}setHelpText(e){e!==this._helpText&&(isTReadOnlyProperty(this._helpText)&&!this._helpText.isDisposed&&this._helpText.unlink(this._onPDOMContentChangeListener),this._helpText=e,isTReadOnlyProperty(e)&&e.lazyLink(this._onPDOMContentChangeListener),this.onPDOMContentChange())}set helpText(e){this.setHelpText(e)}get helpText(){return this.getHelpText()}getHelpText(){return isTReadOnlyProperty(this._helpText)?this._helpText.value:this._helpText}setHelpTextBehavior(e){this._helpTextBehavior!==e&&(this._helpTextBehavior=e,this.onPDOMContentChange())}set helpTextBehavior(e){this.setHelpTextBehavior(e)}get helpTextBehavior(){return this.getHelpTextBehavior()}getHelpTextBehavior(){return this._helpTextBehavior}setTagName(e){assert&&assert(e===null||typeof e=="string"),e!==this._tagName&&(this._tagName=e,this.onPDOMContentChange())}set tagName(e){this.setTagName(e)}get tagName(){return this.getTagName()}getTagName(){return this._tagName}setLabelTagName(e){assert&&assert(e===null||typeof e=="string"),e!==this._labelTagName&&(this._labelTagName=e,this.onPDOMContentChange())}set labelTagName(e){this.setLabelTagName(e)}get labelTagName(){return this.getLabelTagName()}getLabelTagName(){return this._labelTagName}setDescriptionTagName(e){assert&&assert(e===null||typeof e=="string"),e!==this._descriptionTagName&&(this._descriptionTagName=e,this.onPDOMContentChange())}set descriptionTagName(e){this.setDescriptionTagName(e)}get descriptionTagName(){return this.getDescriptionTagName()}getDescriptionTagName(){return this._descriptionTagName}setInputType(e){if(assert&&assert(e===null||typeof e=="string"),assert&&this.tagName&&assert(this._tagName.toUpperCase()===INPUT_TAG$1,"tag name must be INPUT to support inputType"),e!==this._inputType){this._inputType=e;for(let t=0;t<this._pdomInstances.length;t++){const n=this._pdomInstances[t].peer;e===null?n.removeAttributeFromElement("type"):n.setAttributeToElement("type",e)}}}set inputType(e){this.setInputType(e)}get inputType(){return this.getInputType()}getInputType(){return this._inputType}setAppendLabel(e){this._appendLabel!==e&&(this._appendLabel=e,this.onPDOMContentChange())}set appendLabel(e){this.setAppendLabel(e)}get appendLabel(){return this.getAppendLabel()}getAppendLabel(){return this._appendLabel}setAppendDescription(e){this._appendDescription!==e&&(this._appendDescription=e,this.onPDOMContentChange())}set appendDescription(e){this.setAppendDescription(e)}get appendDescription(){return this.getAppendDescription()}getAppendDescription(){return this._appendDescription}setContainerTagName(e){assert&&assert(e===null||typeof e=="string",`invalid tagName argument: ${e}`),this._containerTagName!==e&&(this._containerTagName=e,this.onPDOMContentChange())}set containerTagName(e){this.setContainerTagName(e)}get containerTagName(){return this.getContainerTagName()}getContainerTagName(){return this._containerTagName}invalidatePeerLabelSiblingContent(){const e=this.labelContent;this._labelTagName||this.setLabelTagName(DEFAULT_LABEL_TAG_NAME);for(let t=0;t<this._pdomInstances.length;t++)this._pdomInstances[t].peer.setLabelSiblingContent(e)}setLabelContent(e){e!==this._labelContent&&(isTReadOnlyProperty(this._labelContent)&&!this._labelContent.isDisposed&&this._labelContent.unlink(this._onLabelContentChangeListener),this._labelContent=e,isTReadOnlyProperty(e)&&e.lazyLink(this._onLabelContentChangeListener),this.invalidatePeerLabelSiblingContent())}set labelContent(e){this.setLabelContent(e)}get labelContent(){return this.getLabelContent()}getLabelContent(){return unwrapProperty(this._labelContent)}onInnerContentPropertyChange(){const e=this.innerContent;for(let t=0;t<this._pdomInstances.length;t++)this._pdomInstances[t].peer.setPrimarySiblingContent(e)}setInnerContent(e){e!==this._innerContent&&(isTReadOnlyProperty(this._innerContent)&&!this._innerContent.isDisposed&&this._innerContent.unlink(this._onInnerContentChangeListener),this._innerContent=e,isTReadOnlyProperty(e)&&e.lazyLink(this._onInnerContentChangeListener),this.onInnerContentPropertyChange())}set innerContent(e){this.setInnerContent(e)}get innerContent(){return this.getInnerContent()}getInnerContent(){return unwrapProperty(this._innerContent)}invalidatePeerDescriptionSiblingContent(){const e=this.descriptionContent;this._descriptionTagName||this.setDescriptionTagName(DEFAULT_DESCRIPTION_TAG_NAME);for(let t=0;t<this._pdomInstances.length;t++)this._pdomInstances[t].peer.setDescriptionSiblingContent(e)}setDescriptionContent(e){e!==this._descriptionContent&&(isTReadOnlyProperty(this._descriptionContent)&&!this._descriptionContent.isDisposed&&this._descriptionContent.unlink(this._onDescriptionContentChangeListener),this._descriptionContent=e,isTReadOnlyProperty(e)&&e.lazyLink(this._onDescriptionContentChangeListener),this.invalidatePeerDescriptionSiblingContent())}set descriptionContent(e){this.setDescriptionContent(e)}get descriptionContent(){return this.getDescriptionContent()}getDescriptionContent(){return unwrapProperty(this._descriptionContent)}setAriaRole(e){assert&&assert(e===null||typeof e=="string"),this._ariaRole!==e&&(this._ariaRole=e,e!==null?this.setPDOMAttribute("role",e):this.removePDOMAttribute("role"))}set ariaRole(e){this.setAriaRole(e)}get ariaRole(){return this.getAriaRole()}getAriaRole(){return this._ariaRole}setContainerAriaRole(e){assert&&assert(e===null||typeof e=="string"),this._containerAriaRole!==e&&(this._containerAriaRole=e,e===null?this.removePDOMAttribute("role",{elementName:PDOMPeer$1.CONTAINER_PARENT}):this.setPDOMAttribute("role",e,{elementName:PDOMPeer$1.CONTAINER_PARENT}))}set containerAriaRole(e){this.setContainerAriaRole(e)}get containerAriaRole(){return this.getContainerAriaRole()}getContainerAriaRole(){return this._containerAriaRole}onAriaValueTextChange(){const e=this.ariaValueText;e===null?this._hasAppliedAriaLabel&&(this.removePDOMAttribute("aria-valuetext"),this._hasAppliedAriaLabel=!1):(this.setPDOMAttribute("aria-valuetext",e),this._hasAppliedAriaLabel=!0)}setAriaValueText(e){this._ariaValueText!==e&&(isTReadOnlyProperty(this._ariaValueText)&&!this._ariaValueText.isDisposed&&this._ariaValueText.unlink(this._onAriaValueTextChangeListener),this._ariaValueText=e,isTReadOnlyProperty(e)&&e.lazyLink(this._onAriaValueTextChangeListener),this.onAriaValueTextChange())}set ariaValueText(e){this.setAriaValueText(e)}get ariaValueText(){return this.getAriaValueText()}getAriaValueText(){return unwrapProperty(this._ariaValueText)}setPDOMNamespace(e){return assert&&assert(e===null||typeof e=="string"),this._pdomNamespace!==e&&(this._pdomNamespace=e,this.onPDOMContentChange()),this}set pdomNamespace(e){this.setPDOMNamespace(e)}get pdomNamespace(){return this.getPDOMNamespace()}getPDOMNamespace(){return this._pdomNamespace}onAriaLabelChange(){const e=this.ariaLabel;e===null?this._hasAppliedAriaLabel&&(this.removePDOMAttribute("aria-label"),this._hasAppliedAriaLabel=!1):(this.setPDOMAttribute("aria-label",e),this._hasAppliedAriaLabel=!0)}setAriaLabel(e){this._ariaLabel!==e&&(isTReadOnlyProperty(this._ariaLabel)&&!this._ariaLabel.isDisposed&&this._ariaLabel.unlink(this._onAriaLabelChangeListener),this._ariaLabel=e,isTReadOnlyProperty(e)&&e.lazyLink(this._onAriaLabelChangeListener),this.onAriaLabelChange())}set ariaLabel(e){this.setAriaLabel(e)}get ariaLabel(){return this.getAriaLabel()}getAriaLabel(){return unwrapProperty(this._ariaLabel)}setFocusHighlight(e){this._focusHighlight!==e&&(this._focusHighlight=e,this._focusHighlightLayerable&&(assert&&assert(e instanceof Node$2),e.visible=!1),this.focusHighlightChangedEmitter.emit())}set focusHighlight(e){this.setFocusHighlight(e)}get focusHighlight(){return this.getFocusHighlight()}getFocusHighlight(){return this._focusHighlight}setFocusHighlightLayerable(e){this._focusHighlightLayerable!==e&&(this._focusHighlightLayerable=e,this._focusHighlight&&(assert&&assert(this._focusHighlight instanceof Node$2),this._focusHighlight.visible=!1,this.focusHighlightChangedEmitter.emit()))}set focusHighlightLayerable(e){this.setFocusHighlightLayerable(e)}get focusHighlightLayerable(){return this.getFocusHighlightLayerable()}getFocusHighlightLayerable(){return this._focusHighlightLayerable}setGroupFocusHighlight(e){this._groupFocusHighlight=e}set groupFocusHighlight(e){this.setGroupFocusHighlight(e)}get groupFocusHighlight(){return this.getGroupFocusHighlight()}getGroupFocusHighlight(){return this._groupFocusHighlight}setAriaLabelledbyAssociations(e){let t,n;if(assert)for(assert(Array.isArray(e)),n=0;n<e.length;n++)t=e[n];if(e.length===0&&this._ariaLabelledbyAssociations.length===0)return;const r=[],s=[],a=[];for(arrayDifference(e,this._ariaLabelledbyAssociations,s,r,a),n=0;n<r.length;n++)t=r[n],this.removeAriaLabelledbyAssociation(t);for(assert&&assert(this._ariaLabelledbyAssociations.length===a.length,"Removing associations should not have triggered other association changes"),n=0;n<s.length;n++){const l=e[n];this.addAriaLabelledbyAssociation(l)}}set ariaLabelledbyAssociations(e){this.setAriaLabelledbyAssociations(e)}get ariaLabelledbyAssociations(){return this.getAriaLabelledbyAssociations()}getAriaLabelledbyAssociations(){return this._ariaLabelledbyAssociations}addAriaLabelledbyAssociation(e){this._ariaLabelledbyAssociations.push(e),e.otherNode._nodesThatAreAriaLabelledbyThisNode.push(this),this.updateAriaLabelledbyAssociationsInPeers()}removeAriaLabelledbyAssociation(e){assert&&assert(_.includes(this._ariaLabelledbyAssociations,e)),this._ariaLabelledbyAssociations.splice(_.indexOf(this._ariaLabelledbyAssociations,e),1)[0].otherNode.removeNodeThatIsAriaLabelledByThisNode(this),this.updateAriaLabelledbyAssociationsInPeers()}removeNodeThatIsAriaLabelledByThisNode(e){const t=_.indexOf(this._nodesThatAreAriaLabelledbyThisNode,e);assert&&assert(t>=0),this._nodesThatAreAriaLabelledbyThisNode.splice(t,1)}updateAriaLabelledbyAssociationsInPeers(){for(let e=0;e<this.pdomInstances.length;e++)this.pdomInstances[e].peer.onAriaLabelledbyAssociationChange()}updateOtherNodesAriaLabelledby(){for(let e=0;e<this._nodesThatAreAriaLabelledbyThisNode.length;e++)this._nodesThatAreAriaLabelledbyThisNode[e].updateAriaLabelledbyAssociationsInPeers()}getNodesThatAreAriaLabelledbyThisNode(){return this._nodesThatAreAriaLabelledbyThisNode}get nodesThatAreAriaLabelledbyThisNode(){return this.getNodesThatAreAriaLabelledbyThisNode()}setAriaDescribedbyAssociations(e){let t;if(assert){assert(Array.isArray(e));for(let l=0;l<e.length;l++)t=e[l]}if(e.length===0&&this._ariaDescribedbyAssociations.length===0)return;const n=[],r=[],s=[];let a;for(arrayDifference(e,this._ariaDescribedbyAssociations,r,n,s),a=0;a<n.length;a++)t=n[a],this.removeAriaDescribedbyAssociation(t);for(assert&&assert(this._ariaDescribedbyAssociations.length===s.length,"Removing associations should not have triggered other association changes"),a=0;a<r.length;a++){const l=e[a];this.addAriaDescribedbyAssociation(l)}}set ariaDescribedbyAssociations(e){this.setAriaDescribedbyAssociations(e)}get ariaDescribedbyAssociations(){return this.getAriaDescribedbyAssociations()}getAriaDescribedbyAssociations(){return this._ariaDescribedbyAssociations}addAriaDescribedbyAssociation(e){assert&&assert(!_.includes(this._ariaDescribedbyAssociations,e),"describedby association already registed"),this._ariaDescribedbyAssociations.push(e),e.otherNode._nodesThatAreAriaDescribedbyThisNode.push(this),this.updateAriaDescribedbyAssociationsInPeers()}hasAriaDescribedbyAssociation(e){return _.includes(this._ariaDescribedbyAssociations,e)}removeAriaDescribedbyAssociation(e){assert&&assert(_.includes(this._ariaDescribedbyAssociations,e)),this._ariaDescribedbyAssociations.splice(_.indexOf(this._ariaDescribedbyAssociations,e),1)[0].otherNode.removeNodeThatIsAriaDescribedByThisNode(this),this.updateAriaDescribedbyAssociationsInPeers()}removeNodeThatIsAriaDescribedByThisNode(e){const t=_.indexOf(this._nodesThatAreAriaDescribedbyThisNode,e);assert&&assert(t>=0),this._nodesThatAreAriaDescribedbyThisNode.splice(t,1)}updateAriaDescribedbyAssociationsInPeers(){for(let e=0;e<this.pdomInstances.length;e++)this.pdomInstances[e].peer.onAriaDescribedbyAssociationChange()}updateOtherNodesAriaDescribedby(){for(let e=0;e<this._nodesThatAreAriaDescribedbyThisNode.length;e++)this._nodesThatAreAriaDescribedbyThisNode[e].updateAriaDescribedbyAssociationsInPeers()}getNodesThatAreAriaDescribedbyThisNode(){return this._nodesThatAreAriaDescribedbyThisNode}get nodesThatAreAriaDescribedbyThisNode(){return this.getNodesThatAreAriaDescribedbyThisNode()}setActiveDescendantAssociations(e){let t;if(assert){assert(Array.isArray(e));for(let l=0;l<e.length;l++)t=e[l]}if(e.length===0&&this._activeDescendantAssociations.length===0)return;const n=[],r=[],s=[];let a;for(arrayDifference(e,this._activeDescendantAssociations,r,n,s),a=0;a<n.length;a++)t=n[a],this.removeActiveDescendantAssociation(t);for(assert&&assert(this._activeDescendantAssociations.length===s.length,"Removing associations should not have triggered other association changes"),a=0;a<r.length;a++){const l=e[a];this.addActiveDescendantAssociation(l)}}set activeDescendantAssociations(e){this.setActiveDescendantAssociations(e)}get activeDescendantAssociations(){return this.getActiveDescendantAssociations()}getActiveDescendantAssociations(){return this._activeDescendantAssociations}addActiveDescendantAssociation(e){this._activeDescendantAssociations.push(e),e.otherNode._nodesThatAreActiveDescendantToThisNode.push(this),this.updateActiveDescendantAssociationsInPeers()}removeActiveDescendantAssociation(e){assert&&assert(_.includes(this._activeDescendantAssociations,e)),this._activeDescendantAssociations.splice(_.indexOf(this._activeDescendantAssociations,e),1)[0].otherNode.removeNodeThatIsActiveDescendantThisNode(this),this.updateActiveDescendantAssociationsInPeers()}removeNodeThatIsActiveDescendantThisNode(e){const t=_.indexOf(this._nodesThatAreActiveDescendantToThisNode,e);assert&&assert(t>=0),this._nodesThatAreActiveDescendantToThisNode.splice(t,1)}updateActiveDescendantAssociationsInPeers(){for(let e=0;e<this.pdomInstances.length;e++)this.pdomInstances[e].peer.onActiveDescendantAssociationChange()}updateOtherNodesActiveDescendant(){for(let e=0;e<this._nodesThatAreActiveDescendantToThisNode.length;e++)this._nodesThatAreActiveDescendantToThisNode[e].updateActiveDescendantAssociationsInPeers()}getNodesThatAreActiveDescendantToThisNode(){return this._nodesThatAreActiveDescendantToThisNode}get nodesThatAreActiveDescendantToThisNode(){return this.getNodesThatAreActiveDescendantToThisNode()}setPDOMOrder(e){if(assert&&assert(Array.isArray(e)||e===null,`Array or null expected, received: ${e}`),assert&&e&&e.forEach((t,n)=>{assert&&assert(t===null||t instanceof Node$2,`Elements of pdomOrder should be either a Node or null. Element at index ${n} is: ${t}`)}),assert&&e&&assert(this.getTrails(t=>_.includes(e,t)).length===0,"pdomOrder should not include any ancestors or the node itself"),this._pdomOrder!==e){const t=this._pdomOrder;this._pdomOrder=e===null?null:e.slice(),PDOMTree$1.pdomOrderChange(this,t,e),this.rendererSummaryRefreshEmitter.emit()}}set pdomOrder(e){this.setPDOMOrder(e)}get pdomOrder(){return this.getPDOMOrder()}getPDOMOrder(){return this._pdomOrder?this._pdomOrder.slice(0):this._pdomOrder}hasPDOMOrder(){return this._pdomOrder!==null&&this._pdomOrder.length!==0&&(this._pdomOrder.length>1||this._pdomOrder[0]!==null)}getPDOMParent(){return this._pdomParent}get pdomParent(){return this.getPDOMParent()}getEffectiveChildren(){const e=[];for(let t=0;t<this._children.length;t++){const n=this._children[t];n._pdomParent||e.push(n)}if(this.hasPDOMOrder()){const t=this.pdomOrder.slice(),n=t.indexOf(null);return n>=0?(e.unshift(n,1),Array.prototype.splice.apply(t,e)):Array.prototype.push.apply(t,e),t}else return e}setPDOMVisible(e){this._pdomVisible!==e&&(this._pdomVisible=e,this._pdomDisplaysInfo.onPDOMVisibilityChange(e))}set pdomVisible(e){this.setPDOMVisible(e)}get pdomVisible(){return this.isPDOMVisible()}isPDOMVisible(){return this._pdomVisible}isPDOMDisplayed(){for(let e=0;e<this._pdomInstances.length;e++)if(this._pdomInstances[e].isGloballyVisible())return!0;return!1}get pdomDisplayed(){return this.isPDOMDisplayed()}invalidatePeerInputValue(){for(let e=0;e<this.pdomInstances.length;e++)this.pdomInstances[e].peer.onInputValueChange()}setInputValue(e){assert&&this._tagName&&assert(_.includes(FORM_ELEMENTS,this._tagName.toUpperCase()),"dom element must be a form element to support value"),e!==this._inputValue&&(isTReadOnlyProperty(this._inputValue)&&!this._inputValue.isDisposed&&this._inputValue.unlink(this._onPDOMContentChangeListener),this._inputValue=e,isTReadOnlyProperty(e)&&e.lazyLink(this._onPDOMContentChangeListener),this.invalidatePeerInputValue())}set inputValue(e){this.setInputValue(e)}get inputValue(){return this.getInputValue()}getInputValue(){let e;return isTReadOnlyProperty(this._inputValue)?e=this._inputValue.value:e=this._inputValue,e===null?null:""+e}setPDOMChecked(e){this._tagName&&assert&&assert(this._tagName.toUpperCase()===INPUT_TAG$1,"Cannot set checked on a non input tag."),this._inputType&&assert&&assert(INPUT_TYPES_THAT_SUPPORT_CHECKED.includes(this._inputType.toUpperCase()),`inputType does not support checked: ${this._inputType}`),this._pdomChecked!==e&&(this._pdomChecked=e,this.setPDOMAttribute("checked",e,{asProperty:!0}))}set pdomChecked(e){this.setPDOMChecked(e)}get pdomChecked(){return this.getPDOMChecked()}getPDOMChecked(){return this._pdomChecked}getPDOMAttributes(){return this._pdomAttributes.slice(0)}get pdomAttributes(){return this.getPDOMAttributes()}setPDOMAttribute(e,t,n){assert&&n&&assert(Object.getPrototypeOf(n)===Object.prototype,"Extra prototype on pdomAttribute options object is a code smell");const r=optionize()({namespace:null,asProperty:!1,elementName:PDOMPeer$1.PRIMARY_SIBLING},n);assert&&assert(!ASSOCIATION_ATTRIBUTES.includes(e),"setPDOMAttribute does not support association attributes");for(let a=0;a<this._pdomAttributes.length;a++){const l=this._pdomAttributes[a];l.attribute===e&&l.options.namespace===r.namespace&&l.options.elementName===r.elementName&&(l.options.asProperty===r.asProperty?this._pdomAttributes.splice(a,1):this.removePDOMAttribute(l.attribute,l.options))}let s=a=>{assert&&typeof a=="string"&&validate(a,Validation.STRING_WITHOUT_TEMPLATE_VARS_VALIDATOR);for(let l=0;l<this._pdomInstances.length;l++)this._pdomInstances[l].peer.setAttributeToElement(e,a,r)};isTReadOnlyProperty(t)?t.link(s):(s(t),s=null),this._pdomAttributes.push({attribute:e,value:t,listener:s,options:r})}removePDOMAttribute(e,t){assert&&t&&assert(Object.getPrototypeOf(t)===Object.prototype,"Extra prototype on pdomAttribute options object is a code smell");const n=optionize()({namespace:null,elementName:PDOMPeer$1.PRIMARY_SIBLING},t);let r=!1;for(let s=0;s<this._pdomAttributes.length;s++)if(this._pdomAttributes[s].attribute===e&&this._pdomAttributes[s].options.namespace===n.namespace&&this._pdomAttributes[s].options.elementName===n.elementName){const a=this._pdomAttributes[s];a.listener&&isTReadOnlyProperty(a.value)&&!a.value.isDisposed&&a.value.unlink(a.listener),this._pdomAttributes.splice(s,1),r=!0}assert&&assert(r,`Node does not have pdom attribute ${e}`);for(let s=0;s<this._pdomInstances.length;s++)this._pdomInstances[s].peer.removeAttributeFromElement(e,n)}removePDOMAttributes(){const e=this.getPDOMAttributes();for(let t=0;t<e.length;t++){const n=e[t].attribute;this.removePDOMAttribute(n)}}hasPDOMAttribute(e,t){assert&&t&&assert(Object.getPrototypeOf(t)===Object.prototype,"Extra prototype on pdomAttribute options object is a code smell");const n=optionize()({namespace:null,elementName:PDOMPeer$1.PRIMARY_SIBLING},t);let r=!1;for(let s=0;s<this._pdomAttributes.length;s++)this._pdomAttributes[s].attribute===e&&this._pdomAttributes[s].options.namespace===n.namespace&&this._pdomAttributes[s].options.elementName===n.elementName&&(r=!0);return r}setPDOMClass(e,t){const n=optionize()({elementName:PDOMPeer$1.PRIMARY_SIBLING},t);for(let r=0;r<this._pdomClasses.length;r++){const s=this._pdomClasses[r];if(s.className===e&&s.options.elementName===n.elementName)return}this._pdomClasses.push({className:e,options:n});for(let r=0;r<this._pdomInstances.length;r++)this._pdomInstances[r].peer.setClassToElement(e,n)}removePDOMClass(e,t){const n=optionize()({elementName:PDOMPeer$1.PRIMARY_SIBLING},t);let r=!1;for(let s=0;s<this._pdomClasses.length;s++)this._pdomClasses[s].className===e&&this._pdomClasses[s].options.elementName===n.elementName&&(this._pdomClasses.splice(s,1),r=!0);assert&&assert(r,`Node does not have pdom attribute ${e}`);for(let s=0;s<this._pdomClasses.length;s++)this.pdomInstances[s].peer.removeClassFromElement(e,n)}getPDOMClasses(){return this._pdomClasses.slice(0)}get pdomClasses(){return this.getPDOMClasses()}setFocusable(e){if(assert&&assert(e===null||typeof e=="boolean"),this._focusableOverride!==e){this._focusableOverride=e;for(let t=0;t<this._pdomInstances.length;t++)assert&&assert(this._pdomInstances[t].peer,"Peer required to set focusable."),this._pdomInstances[t].peer.setFocusable(this.focusable)}}set focusable(e){this.setFocusable(e)}get focusable(){return this.isFocusable()}isFocusable(){return this._focusableOverride!==null?this._focusableOverride:this._tagName===null?!1:PDOMUtils$1.tagIsDefaultFocusable(this._tagName)}setPDOMTransformSourceNode(e){this._pdomTransformSourceNode=e;for(let t=0;t<this._pdomInstances.length;t++)this._pdomInstances[t].peer.setPDOMTransformSourceNode(this._pdomTransformSourceNode)}set pdomTransformSourceNode(e){this.setPDOMTransformSourceNode(e)}get pdomTransformSourceNode(){return this.getPDOMTransformSourceNode()}getPDOMTransformSourceNode(){return this._pdomTransformSourceNode}setFocusPanTargetBoundsProperty(e){e!==this._focusPanTargetBoundsProperty&&(assert&&assert(!this._focusPanTargetBoundsProperty,"Cannot change focusPanTargetBoundsProperty after it is set."),this._focusPanTargetBoundsProperty=e)}getFocusPanTargetBoundsProperty(){return this._focusPanTargetBoundsProperty}set focusPanTargetBoundsProperty(e){this.setFocusPanTargetBoundsProperty(e)}get focusPanTargetBoundsProperty(){return this.getFocusPanTargetBoundsProperty()}setLimitPanDirection(e){this._limitPanDirection=e}getLimitPanDirection(){return this._limitPanDirection}set limitPanDirection(e){this.setLimitPanDirection(e)}get limitPanDirection(){return this.getLimitPanDirection()}setPositionInPDOM(e){this._positionInPDOM=e;for(let t=0;t<this._pdomInstances.length;t++)this._pdomInstances[t].peer.setPositionInPDOM(e)}set positionInPDOM(e){this.setPositionInPDOM(e)}get positionInPDOM(){return this.getPositionInPDOM()}getPositionInPDOM(){return this._positionInPDOM}setExcludeLabelSiblingFromInput(){this.excludeLabelSiblingFromInput=!0,this.onPDOMContentChange()}isInsidePhetioArchetype(e=this){if(e.isPhetioInstrumented())return e.phetioIsArchetype;for(let t=0;t<e.parents.length;t++)if(this.isInsidePhetioArchetype(e.parents[t]))return!0;return!1}alertDescriptionUtterance(e){if(isSettingPhetioStateProperty.value||Tandem.PHET_IO_ENABLED&&this.isInsidePhetioArchetype())return;const t=this.getConnectedDisplays();for(let n=0;n<t.length;n++){const r=t[n];r.isAccessible()&&r.descriptionUtteranceQueue.addToBack(e)}}forEachUtteranceQueue(e){const t=this.getConnectedDisplays();assert&&assert(t.length>0,"must be connected to a display to use UtteranceQueue features");for(let n=0;n<t.length;n++){const r=t[n];r.isAccessible()&&e(r.descriptionUtteranceQueue)}}getBaseOptions(){const e={};for(let t=0;t<ACCESSIBILITY_OPTION_KEYS.length;t++){const n=ACCESSIBILITY_OPTION_KEYS[t];e[n]=this[n]}return e}getNestedPDOMOrder(){const e=new Trail(this);let t=[];const n=[],r=[n];function s(a,l){let d=0;if(_.each(t,m=>{a===m&&d++}),d>1||d===1&&!l)return;if(a.hasPDOMContent){const m={trail:e.copy(),children:[]};r[r.length-1].push(m),r.push(m.children)}const c=a._pdomOrder===null?[]:a._pdomOrder;t=t.concat(c),_.each(c,m=>{_.each(a.getLeafTrailsTo(m),O=>{O.removeAncestor(),e.addDescendantTrail(O),s(m,!0),e.removeDescendantTrail(O)})});const y=a._children.length;for(let m=0;m<y;m++){const O=a._children[m];e.addDescendant(O,m),s(O,!1),e.removeDescendant()}_.each(c,()=>{t.pop()}),a.hasPDOMContent&&r.pop()}return s(this,!1),n}onPDOMContentChange(){PDOMTree$1.pdomContentChange(this),this.pdomHeading&&this.computeHeadingLevel(),this.rendererSummaryRefreshEmitter.emit()}get hasPDOMContent(){return!!this._tagName}onPDOMAddChild(e){sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.ParallelDOM(`onPDOMAddChild n#${e.id} (parent:n#${this.id})`),sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.push(),assert&&function(n){n._rendererSummary.hasNoPDOM()||n.pdomOrder&&assert(n.getTrails(r=>_.includes(n.pdomOrder,r)).length===0,"pdomOrder should not include any ancestors or the node itself")}(e),assert&&PDOMTree$1.auditNodeForPDOMCycles(this),this._pdomDisplaysInfo.onAddChild(e),PDOMTree$1.addChild(this,e),sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.pop()}onPDOMRemoveChild(e){sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.ParallelDOM(`onPDOMRemoveChild n#${e.id} (parent:n#${this.id})`),sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.push(),this._pdomDisplaysInfo.onRemoveChild(e),PDOMTree$1.removeChild(this,e),e.updateOtherNodesAriaLabelledby(),e.updateOtherNodesAriaDescribedby(),e.updateOtherNodesActiveDescendant(),sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.pop()}onPDOMReorderedChildren(){sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.ParallelDOM(`onPDOMReorderedChildren (parent:n#${this.id})`),sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.push(),PDOMTree$1.childrenOrderChange(this),sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.pop()}updateLinkedElementForProperty(e,t,n){if(assert&&assert(t!==n,"should not be called on same values"),this.isPhetioInstrumented()){t&&t instanceof ReadOnlyProperty&&t.isPhetioInstrumented()&&t instanceof PhetioObject&&this.removeLinkedElements(t);const r=this.tandem.createTandem(e);n&&n instanceof ReadOnlyProperty&&n.isPhetioInstrumented()&&n instanceof PhetioObject&&r!==n.tandem&&this.addLinkedElement(n,{tandemName:e})}}getPDOMInstances(){return this._pdomInstances}get pdomInstances(){return this.getPDOMInstances()}addPDOMInstance(e){this._pdomInstances.push(e)}removePDOMInstance(e){const t=_.indexOf(this._pdomInstances,e);assert&&assert(t!==-1,"Cannot remove a PDOMInstance from a Node if it was not there"),this._pdomInstances.splice(t,1)}static BASIC_ACCESSIBLE_NAME_BEHAVIOR(e,t,n){return e.tagName==="input"?(t.labelTagName="label",t.labelContent=n):PDOMUtils$1.tagNameSupportsContent(e.tagName)?t.innerContent=n:t.ariaLabel=n,t}static HELP_TEXT_BEFORE_CONTENT(e,t,n){return t.descriptionTagName=PDOMUtils$1.DEFAULT_DESCRIPTION_TAG_NAME,t.descriptionContent=n,t.appendDescription=!1,t}static HELP_TEXT_AFTER_CONTENT(e,t,n){return t.descriptionTagName=PDOMUtils$1.DEFAULT_DESCRIPTION_TAG_NAME,t.descriptionContent=n,t.appendDescription=!0,t}}scenery.register("ParallelDOM",ParallelDOM);let globalIdCounter$4=1;const scratchBounds2$1=Bounds2.NOTHING.copy(),scratchBounds2Extra=Bounds2.NOTHING.copy(),scratchMatrix3=new Matrix3,ENABLED_PROPERTY_TANDEM_NAME=EnabledProperty.TANDEM_NAME,VISIBLE_PROPERTY_TANDEM_NAME="visibleProperty",INPUT_ENABLED_PROPERTY_TANDEM_NAME="inputEnabledProperty",PHET_IO_STATE_DEFAULT$1=!1;let maxParentCount=0,maxChildCount=0;const REQUIRES_BOUNDS_OPTION_KEYS=["leftTop","centerTop","rightTop","leftCenter","center","rightCenter","leftBottom","centerBottom","rightBottom","left","right","top","bottom","centerX","centerY"],NODE_OPTION_KEYS=["children","cursor","phetioVisiblePropertyInstrumented","visibleProperty","visible","pickableProperty","pickable","phetioEnabledPropertyInstrumented","enabledProperty","enabled","phetioInputEnabledPropertyInstrumented","inputEnabledProperty","inputEnabled","inputListeners","opacity","disabledOpacity","filters","matrix","translation","x","y","rotation","scale","excludeInvisibleChildrenFromBounds","layoutOptions","localBounds","maxWidth","maxHeight","renderer","layerSplit","usesOpacity","cssTransform","excludeInvisible","webglScale","preventFit","mouseArea","touchArea","clipArea","transformBounds",...REQUIRES_BOUNDS_OPTION_KEYS],DEFAULT_OPTIONS$7={phetioVisiblePropertyInstrumented:!0,visible:!0,opacity:1,disabledOpacity:1,pickable:null,enabled:!0,phetioEnabledPropertyInstrumented:!1,inputEnabled:!0,phetioInputEnabledPropertyInstrumented:!1,clipArea:null,mouseArea:null,touchArea:null,cursor:null,transformBounds:!1,maxWidth:null,maxHeight:null,renderer:null,usesOpacity:!1,layerSplit:!1,cssTransform:!1,excludeInvisible:!1,webglScale:null,preventFit:!1},DEFAULT_INTERNAL_RENDERER=DEFAULT_OPTIONS$7.renderer===null?0:Renderer.fromName(DEFAULT_OPTIONS$7.renderer);var wn;let Node$1=(wn=class extends ParallelDOM{constructor(e){super(),this.parentAddedEmitter=new TinyEmitter,this.parentRemovedEmitter=new TinyEmitter,this._activeParentLayoutConstraint=null,this._id=globalIdCounter$4++,this._instances=[],this._rootedDisplays=[],this._drawables=[],this._visibleProperty=new TinyForwardingProperty(DEFAULT_OPTIONS$7.visible,DEFAULT_OPTIONS$7.phetioVisiblePropertyInstrumented,this.onVisiblePropertyChange.bind(this)),this.opacityProperty=new TinyProperty(DEFAULT_OPTIONS$7.opacity,this.onOpacityPropertyChange.bind(this)),this.disabledOpacityProperty=new TinyProperty(DEFAULT_OPTIONS$7.disabledOpacity,this.onDisabledOpacityPropertyChange.bind(this)),this._pickableProperty=new TinyForwardingProperty(DEFAULT_OPTIONS$7.pickable,!1,this.onPickablePropertyChange.bind(this)),this._enabledProperty=new TinyForwardingProperty(DEFAULT_OPTIONS$7.enabled,DEFAULT_OPTIONS$7.phetioEnabledPropertyInstrumented,this.onEnabledPropertyChange.bind(this)),this._inputEnabledProperty=new TinyForwardingProperty(DEFAULT_OPTIONS$7.inputEnabled,DEFAULT_OPTIONS$7.phetioInputEnabledPropertyInstrumented),this.clipAreaProperty=new TinyProperty(DEFAULT_OPTIONS$7.clipArea),this.voicingVisibleProperty=new TinyProperty(!0),this._mouseArea=DEFAULT_OPTIONS$7.mouseArea,this._touchArea=DEFAULT_OPTIONS$7.touchArea,this._cursor=DEFAULT_OPTIONS$7.cursor,this._children=[],this._parents=[],this._transformBounds=DEFAULT_OPTIONS$7.transformBounds,this._transform=new Transform3,this._transformListener=this.onTransformChange.bind(this),this._transform.changeEmitter.addListener(this._transformListener),this._maxWidth=DEFAULT_OPTIONS$7.maxWidth,this._maxHeight=DEFAULT_OPTIONS$7.maxHeight,this._appliedScaleFactor=1,this._inputListeners=[],this._renderer=DEFAULT_INTERNAL_RENDERER,this._usesOpacity=DEFAULT_OPTIONS$7.usesOpacity,this._layerSplit=DEFAULT_OPTIONS$7.layerSplit,this._cssTransform=DEFAULT_OPTIONS$7.cssTransform,this._excludeInvisible=DEFAULT_OPTIONS$7.excludeInvisible,this._webglScale=DEFAULT_OPTIONS$7.webglScale,this._preventFit=DEFAULT_OPTIONS$7.preventFit,this.inputEnabledProperty.lazyLink(this.pdomBoundInputEnabledListener);const t=this.onBoundsListenersAddedOrRemoved.bind(this),n=this.validateBounds.bind(this),r=this.validateSelfBounds.bind(this);this.boundsProperty=new TinyStaticProperty(Bounds2.NOTHING.copy(),n),this.boundsProperty.changeCount=t,this.localBoundsProperty=new TinyStaticProperty(Bounds2.NOTHING.copy(),n),this.localBoundsProperty.changeCount=t,this.childBoundsProperty=new TinyStaticProperty(Bounds2.NOTHING.copy(),n),this.childBoundsProperty.changeCount=t,this.selfBoundsProperty=new TinyStaticProperty(Bounds2.NOTHING.copy(),r),this._localBoundsOverridden=!1,this._excludeInvisibleChildrenFromBounds=!1,this._layoutOptions=null,this._boundsDirty=!0,this._localBoundsDirty=!0,this._selfBoundsDirty=!0,this._childBoundsDirty=!0,assert&&(this._originalBounds=this.boundsProperty._value,this._originalLocalBounds=this.localBoundsProperty._value,this._originalSelfBounds=this.selfBoundsProperty._value,this._originalChildBounds=this.childBoundsProperty._value),this._filters=[],this.childrenChangedEmitter=new TinyEmitter,this.childInsertedEmitter=new TinyEmitter,this.childRemovedEmitter=new TinyEmitter,this.childrenReorderedEmitter=new TinyEmitter,this.transformEmitter=new TinyEmitter,this.instanceRefreshEmitter=new TinyEmitter,this.rendererSummaryRefreshEmitter=new TinyEmitter,this.filterChangeEmitter=new TinyEmitter,this.changedInstanceEmitter=new TinyEmitter,this.layoutOptionsChangedEmitter=new TinyEmitter,this._rendererBitmask=Renderer.bitmaskNodeDefault,this._rendererSummary=new RendererSummary$1(this),this._boundsEventCount=0,this._boundsEventSelfCount=0,this._picker=new Picker(this),this._isGettingRemovedFromParent=!1,e&&this.mutate(e)}insertChild(e,t,n){var r,s,a,l;if(assert&&assert(t!=null,"insertChild cannot insert a null/undefined child"),assert&&assert(!_.includes(this._children,t),"Parent already contains child"),assert&&assert(t!==this,"Cannot add self as a child"),assert&&assert(t._parents!==null,"Tried to insert a disposed child node?"),assert&&assert(!t.isDisposed,"Tried to insert a disposed Node"),this._picker.onInsertChild(t),this.changeBoundsEventCount(t._boundsEventCount>0?1:0),this._rendererSummary.summaryChange(RendererSummary$1.bitmaskAll,t._rendererSummary.bitmask),t._parents.push(this),assert&&((s=(r=window.phet)==null?void 0:r.chipper)!=null&&s.queryParameters)&&isFinite(phet.chipper.queryParameters.parentLimit)){const d=t._parents.length;maxParentCount<d&&(maxParentCount=d,console.log(`Max Node parents: ${maxParentCount}`),assert(maxParentCount<=phet.chipper.queryParameters.parentLimit,`parent count of ${maxParentCount} above ?parentLimit=${phet.chipper.queryParameters.parentLimit}`))}if(this._children.splice(e,0,t),assert&&((l=(a=window.phet)==null?void 0:a.chipper)!=null&&l.queryParameters)&&isFinite(phet.chipper.queryParameters.childLimit)){const d=this._children.length;maxChildCount<d&&(maxChildCount=d,console.log(`Max Node children: ${maxChildCount}`),assert(maxChildCount<=phet.chipper.queryParameters.childLimit,`child count of ${maxChildCount} above ?childLimit=${phet.chipper.queryParameters.childLimit}`))}return t._rendererSummary.hasNoPDOM()||this.onPDOMAddChild(t),t.invalidateBounds(),this._boundsDirty=!0,this.childInsertedEmitter.emit(t,e),t.parentAddedEmitter.emit(this),!n&&this.childrenChangedEmitter.emit(),assertSlow&&this._picker.audit(),this}addChild(e,t){return this.insertChild(this._children.length,e,t),this}removeChild(e,t){assert&&assert(e&&e instanceof wn,"Need to call node.removeChild() with a Node."),assert&&assert(this.hasChild(e),"Attempted to removeChild with a node that was not a child.");const n=_.indexOf(this._children,e);return this.removeChildWithIndex(e,n,t),this}removeChildAt(e,t){assert&&assert(e>=0),assert&&assert(e<this._children.length);const n=this._children[e];return this.removeChildWithIndex(n,e,t),this}removeChildWithIndex(e,t,n){assert&&assert(e&&e instanceof wn,"Need to call node.removeChildWithIndex() with a Node."),assert&&assert(this.hasChild(e),"Attempted to removeChild with a node that was not a child."),assert&&assert(this._children[t]===e,"Incorrect index for removeChildWithIndex"),assert&&assert(e._parents!==null,"Tried to remove a disposed child node?");const r=_.indexOf(e._parents,this);e._isGettingRemovedFromParent=!0,e._rendererSummary.hasNoPDOM()||this.onPDOMRemoveChild(e),this._picker.onRemoveChild(e),this.changeBoundsEventCount(e._boundsEventCount>0?-1:0),this._rendererSummary.summaryChange(e._rendererSummary.bitmask,RendererSummary$1.bitmaskAll),e._parents.splice(r,1),this._children.splice(t,1),e._isGettingRemovedFromParent=!1,this.invalidateBounds(),this._childBoundsDirty=!0,this.childRemovedEmitter.emit(e,t),e.parentRemovedEmitter.emit(this),!n&&this.childrenChangedEmitter.emit(),assertSlow&&this._picker.audit()}moveChildToIndex(e,t){assert&&assert(this.hasChild(e),"Attempted to moveChildToIndex with a node that was not a child."),assert&&assert(t%1===0&&t>=0&&t<this._children.length,`Invalid index: ${t}`);const n=this.indexOfChild(e);return this._children[t]!==e&&(this._children.splice(n,1),this._children.splice(t,0,e),this._rendererSummary.hasNoPDOM()||this.onPDOMReorderedChildren(),this.childrenReorderedEmitter.emit(Math.min(n,t),Math.max(n,t)),this.childrenChangedEmitter.emit()),this}removeAllChildren(){return this.setChildren([]),this}setChildren(e){const t=[],n=[],r=[];let s;for(arrayDifference(e,this._children,n,t,r),s=t.length-1;s>=0;s--)this.removeChild(t[s],!0);assert&&assert(this._children.length===r.length,"Removing children should not have triggered other children changes");let a=-1,l=-1;for(s=0;s<r.length;s++){const c=r[s];this._children[s]!==c&&(this._children[s]=c,a===-1&&(a=s),l=s)}const d=a!==-1;if(d&&(this._rendererSummary.hasNoPDOM()||this.onPDOMReorderedChildren(),this.childrenReorderedEmitter.emit(a,l)),n.length){let c=0,y=n[c];for(s=0;s<e.length;s++)e[s]===y&&(this.insertChild(s,y,!0),y=n[++c])}if((t.length!==0||n.length!==0||d)&&this.childrenChangedEmitter.emit(),assert)for(let c=0;c<this._children.length;c++)assert(e[c]===this._children[c],"Incorrect child after setChildren, possibly a reentrancy issue");return this}set children(e){this.setChildren(e)}get children(){return this.getChildren()}getChildren(){return this._children.slice(0)}getChildrenCount(){return this._children.length}getParents(){return this._parents.slice(0)}get parents(){return this.getParents()}getParent(){return assert&&assert(this._parents.length<=1,"Cannot call getParent on a node with multiple parents"),this._parents.length?this._parents[0]:null}get parent(){return this.getParent()}getChildAt(e){return this._children[e]}indexOfParent(e){return _.indexOf(this._parents,e)}indexOfChild(e){return _.indexOf(this._children,e)}moveToFront(){return _.each(this.parents,e=>e.moveChildToFront(this)),this}moveChildToFront(e){return this.moveChildToIndex(e,this._children.length-1)}moveForward(){return this.parents.forEach(e=>e.moveChildForward(this)),this}moveChildForward(e){const t=this.indexOfChild(e);return t<this.getChildrenCount()-1&&this.moveChildToIndex(e,t+1),this}moveBackward(){return this.parents.forEach(e=>e.moveChildBackward(this)),this}moveChildBackward(e){const t=this.indexOfChild(e);return t>0&&this.moveChildToIndex(e,t-1),this}moveToBack(){return _.each(this.parents,e=>e.moveChildToBack(this)),this}moveChildToBack(e){return this.moveChildToIndex(e,0)}replaceChild(e,t){assert&&assert(this.hasChild(e),"Attempted to replace a node that was not a child.");const n=this.indexOfChild(e),r=e.focused;return this.removeChild(e,!0),this.insertChild(n,t,!0),this.childrenChangedEmitter.emit(),r&&t.focusable&&t.focus(),this}detach(){return _.each(this._parents.slice(0),e=>e.removeChild(this)),this}changeBoundsEventCount(e){if(e!==0){const t=this._boundsEventCount===0;this._boundsEventCount+=e,assert&&assert(this._boundsEventCount>=0,"subtree bounds event count should be guaranteed to be >= 0");const n=this._boundsEventCount===0;if(t!==n){const r=t?1:-1,s=this._parents.length;for(let a=0;a<s;a++)this._parents[a].changeBoundsEventCount(r)}}}validateSelfBounds(){if(this._selfBoundsDirty){const e=scratchBounds2$1.set(this.selfBoundsProperty._value),t=this.updateSelfBounds();return this._selfBoundsDirty=!1,t&&this.selfBoundsProperty.notifyListeners(e),!0}return!1}validateBounds(){sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds(`validateBounds #${this._id}`),sceneryLog&&sceneryLog.bounds&&sceneryLog.push();let e;const t=1e-13;let n=this.validateSelfBounds();const r=this.childBoundsProperty._value,s=this.localBoundsProperty._value,a=this.selfBoundsProperty._value,l=this.boundsProperty._value;if(this._childBoundsDirty){for(n=!0,sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds("childBounds dirty"),e=this._children.length;e--;){const c=this._children[e];c&&c.validateBounds()}const d=scratchBounds2$1.set(r);for(r.set(Bounds2.NOTHING),e=this._children.length;e--;){const c=this._children[e];(c&&!this._excludeInvisibleChildrenFromBounds||c.isVisible())&&r.includeBounds(c.bounds)}this._childBoundsDirty=!1,sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds(`childBounds: ${r}`),r.equals(d)||r.equalsEpsilon(d,t)||this.childBoundsProperty.notifyListeners(d)}if(this._localBoundsDirty){n=!0,sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds("localBounds dirty"),this._localBoundsDirty=!1;const d=scratchBounds2$1.set(s);if(!this._localBoundsOverridden){s.set(a).includeBounds(r);const c=this.clipArea;c&&s.constrainBounds(c.bounds)}sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds(`localBounds: ${s}`),(this._maxWidth!==null||this._maxHeight!==null)&&this.updateMaxDimension(s),s.equals(d)||(this._boundsDirty=!0,s.equalsEpsilon(d,t)||this.localBoundsProperty.notifyListeners(d))}if(this._boundsDirty){n=!0,sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds("bounds dirty"),this._boundsDirty=!1;const d=scratchBounds2$1.set(l);if(this._transformBounds&&!this._transform.getMatrix().isAxisAligned()){const c=scratchMatrix3.set(this.getMatrix());l.set(Bounds2.NOTHING),this._includeTransformedSubtreeBounds(c,l);const y=this.clipArea;y&&l.constrainBounds(y.getBoundsWithTransform(c))}else l.set(s),this.transformBoundsFromLocalToParent(l);if(sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds(`bounds: ${l}`),!l.equals(d)){for(e=this._parents.length;e--;)this._parents[e].invalidateBounds();l.equalsEpsilon(d,t)||this.boundsProperty.notifyListeners(d)}}return(this._childBoundsDirty||this._boundsDirty)&&(sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds("revalidation"),this.validateBounds()),assert&&(assert(this._originalBounds===this.boundsProperty._value,"Reference for bounds changed!"),assert(this._originalLocalBounds===this.localBoundsProperty._value,"Reference for localBounds changed!"),assert(this._originalSelfBounds===this.selfBoundsProperty._value,"Reference for selfBounds changed!"),assert(this._originalChildBounds===this.childBoundsProperty._value,"Reference for childBounds changed!")),assertSlow&&(()=>{const c=Bounds2.NOTHING.copy();_.each(this._children,D=>{(!this._excludeInvisibleChildrenFromBounds||D.isVisible())&&c.includeBounds(D.boundsProperty._value)});let y=this.selfBoundsProperty._value.union(c);const m=this.clipArea;m&&(y=y.intersection(m.bounds));const O=this.localToParentBounds(y);assertSlow&&assertSlow(this.childBoundsProperty._value.equalsEpsilon(c,1e-6),`Child bounds mismatch after validateBounds: ${this.childBoundsProperty._value.toString()}, expected: ${c.toString()}`),assertSlow&&assertSlow(this._localBoundsOverridden||this._transformBounds||this.boundsProperty._value.equalsEpsilon(O,1e-6),`Bounds mismatch after validateBounds: ${this.boundsProperty._value.toString()}, expected: ${O.toString()}. This could have happened if a bounds instance owned by a Node was directly mutated (e.g. bounds.erode())`)})(),sceneryLog&&sceneryLog.bounds&&sceneryLog.pop(),n}_includeTransformedSubtreeBounds(e,t){this.selfBounds.isEmpty()||t.includeBounds(this.getTransformedSelfBounds(e));const n=this._children.length;for(let r=0;r<n;r++){const s=this._children[r];e.multiplyMatrix(s._transform.getMatrix()),s._includeTransformedSubtreeBounds(e,t),e.multiplyMatrix(s._transform.getInverse())}return t}validateWatchedBounds(){for(;this.watchedBoundsScan(););}watchedBoundsScan(){if(this._boundsEventSelfCount!==0)return this.validateBounds();if(this._boundsEventCount>0&&this._childBoundsDirty){let e=!1;const t=this._children.length;for(let n=0;n<t;n++)e=this._children[n].watchedBoundsScan()||e;return e}else return!1}invalidateBounds(){this._boundsDirty=!0,this._localBoundsDirty=!0;let e=this._parents.length;for(;e--;)this._parents[e].invalidateChildBounds()}invalidateChildBounds(){if(!this._childBoundsDirty){this._childBoundsDirty=!0,this._localBoundsDirty=!0;let e=this._parents.length;for(;e--;)this._parents[e].invalidateChildBounds()}}invalidateSelf(e){assert&&assert(e===void 0||e instanceof Bounds2,"invalidateSelf's newSelfBounds, if provided, needs to be Bounds2");const t=this.selfBoundsProperty._value;if(!e)this._selfBoundsDirty=!0,this.invalidateBounds(),this._picker.onSelfBoundsDirty();else if(assert&&assert(e.isEmpty()||e.isFinite(),"Bounds must be empty or finite in invalidateSelf"),this._selfBoundsDirty=!1,!t.equals(e)){const n=scratchBounds2$1.set(t);this.invalidateBounds(),this._picker.onSelfBoundsDirty(),t.set(e),this.selfBoundsProperty.notifyListeners(n)}assertSlow&&this._picker.audit()}updateSelfBounds(){return assert&&assert(this.selfBoundsProperty._value.equals(Bounds2.NOTHING)),!1}hasChild(e){assert&&assert(e&&e instanceof wn,"hasChild needs to be called with a Node");const t=_.includes(this._children,e);return assert&&assert(t===_.includes(e._parents,this),"child-parent reference should match parent-child reference"),t}getSelfShape(){return this.selfBounds.isEmpty()?new Shape$1:Shape$1.bounds(this.selfBounds)}getSelfBounds(){return this.selfBoundsProperty.value}get selfBounds(){return this.getSelfBounds()}getSafeSelfBounds(){return this.selfBoundsProperty.value}get safeSelfBounds(){return this.getSafeSelfBounds()}getChildBounds(){return this.childBoundsProperty.value}get childBounds(){return this.getChildBounds()}getLocalBounds(){return this.localBoundsProperty.value}get localBounds(){return this.getLocalBounds()}set localBounds(e){this.setLocalBounds(e)}get localBoundsOverridden(){return this._localBoundsOverridden}setLocalBounds(e){assert&&assert(e===null||e instanceof Bounds2,"localBounds override should be set to either null or a Bounds2"),assert&&assert(e===null||!isNaN(e.minX),"minX for localBounds should not be NaN"),assert&&assert(e===null||!isNaN(e.minY),"minY for localBounds should not be NaN"),assert&&assert(e===null||!isNaN(e.maxX),"maxX for localBounds should not be NaN"),assert&&assert(e===null||!isNaN(e.maxY),"maxY for localBounds should not be NaN");const t=this.localBoundsProperty._value,n=t.copy();if(e===null)this._localBoundsOverridden&&(this._localBoundsOverridden=!1,this.localBoundsProperty.notifyListeners(n),this.invalidateBounds());else{const r=!e.equals(t)||!this._localBoundsOverridden;r&&t.set(e),this._localBoundsOverridden||(this._localBoundsOverridden=!0),r&&(this.localBoundsProperty.notifyListeners(n),this.invalidateBounds())}return this}getTransformedSelfBounds(e){return this.selfBounds.transformed(e)}getTransformedSafeSelfBounds(e){return this.safeSelfBounds.transformed(e)}getSafeTransformedVisibleBounds(e){const t=(e||Matrix3.IDENTITY).timesMatrix(this.matrix),n=Bounds2.NOTHING.copy();if(this.visibleProperty.value&&(this.selfBounds.isEmpty()||n.includeBounds(this.getTransformedSafeSelfBounds(t)),this._children.length))for(let r=0;r<this._children.length;r++)n.includeBounds(this._children[r].getSafeTransformedVisibleBounds(t));return n}get safeTransformedVisibleBounds(){return this.getSafeTransformedVisibleBounds()}setTransformBounds(e){return this._transformBounds!==e&&(this._transformBounds=e,this.invalidateBounds()),this}set transformBounds(e){this.setTransformBounds(e)}get transformBounds(){return this.getTransformBounds()}getTransformBounds(){return this._transformBounds}getBounds(){return this.boundsProperty.value}get bounds(){return this.getBounds()}getVisibleLocalBounds(){const e=this.selfBounds.copy();let t=this._children.length;for(;t--;)e.includeBounds(this._children[t].getVisibleBounds());const n=this.clipArea;return n&&e.constrainBounds(n.bounds),assert&&assert(e.isFinite()||e.isEmpty(),"Visible bounds should not be infinite"),e}get visibleLocalBounds(){return this.getVisibleLocalBounds()}getVisibleBounds(){return this.isVisible()?this.getVisibleLocalBounds().transform(this.getMatrix()):Bounds2.NOTHING}get visibleBounds(){return this.getVisibleBounds()}hitTest(e,t,n){return assert&&assert(e.isFinite(),"The point should be a finite Vector2"),assert&&assert(t===void 0||typeof t=="boolean","If isMouse is provided, it should be a boolean"),assert&&assert(n===void 0||typeof n=="boolean","If isTouch is provided, it should be a boolean"),this._picker.hitTest(e,!!t,!!n)}trailUnderPointer(e){return e.point===null?null:this.hitTest(e.point,e instanceof Mouse,e.isTouchLike())}containsPoint(e){return this.hitTest(e)!==null}containsPointSelf(e){return this.selfBounds.containsPoint(e)}intersectsBoundsSelf(e){return this.selfBounds.intersectsBounds(e)}isPhetioMouseHittable(e){return this.pickable===!1&&!this.isAnyDescendantAPhetioMouseHitTarget()?!1:this.visible&&(this.clipArea===null||this.clipArea.containsPoint(this._transform.getInverse().timesVector2(e)))}isAnyDescendantAPhetioMouseHitTarget(){return this.getPhetioMouseHitTarget()!=="phetioNotSelectable"||_.some(this.children,e=>e.isAnyDescendantAPhetioMouseHitTarget())}getPhetioMouseHit(e){if(!this.isPhetioMouseHittable(e))return null;const t=this._transform.getInverse().timesVector2(e);let n=null;for(let r=this._children.length-1;r>=0;r--){const s=this._children[r].getPhetioMouseHit(t);if(s instanceof PhetioObject)return s;s==="phetioNotSelectable"&&(n=!0)}return n?this.getPhetioMouseHitTarget():this._mouseArea?this._mouseArea.containsPoint(t)?this.getPhetioMouseHitTarget():null:this.selfBounds.containsPoint(t)&&this.containsPointSelf(t)?this.getPhetioMouseHitTarget():null}isPainted(){return!1}areSelfBoundsValid(){return!0}hasParent(){return this._parents.length!==0}hasChildren(){return this._children.length>0}isChildIncludedInLayout(e){return e.bounds.isValid()&&(!this._excludeInvisibleChildrenFromBounds||e.visible)}walkDepthFirst(e){e(this);const t=this._children.length;for(let n=0;n<t;n++)this._children[n].walkDepthFirst(e)}addInputListener(e){return assert&&assert(!_.includes(this._inputListeners,e),"Input listener already registered on this Node"),assert&&assert(e!==null,"Input listener cannot be null"),assert&&assert(e!==void 0,"Input listener cannot be undefined"),_.includes(this._inputListeners,e)||(this._inputListeners.push(e),this._picker.onAddInputListener(),assertSlow&&this._picker.audit()),this}removeInputListener(e){const t=_.indexOf(this._inputListeners,e);return assert&&assert(this.isDisposed||t>=0,"Could not find input listener to remove"),t>=0&&(this._inputListeners.splice(t,1),this._picker.onRemoveInputListener(),assertSlow&&this._picker.audit()),this}hasInputListener(e){for(let t=0;t<this._inputListeners.length;t++)if(this._inputListeners[t]===e)return!0;return!1}interruptInput(){const e=this.inputListeners;for(let t=0;t<e.length;t++){const n=e[t];n.interrupt&&n.interrupt()}return this}interruptSubtreeInput(){this.interruptInput();const e=this._children.slice();for(let t=0;t<e.length;t++)e[t].interruptSubtreeInput();return this}translate(e,t,n){if(typeof e=="number"){if(assert&&assert(isFinite(e),"x should be a finite number"),assert&&assert(typeof t=="number"&&isFinite(t),"y should be a finite number"),Math.abs(e)<1e-12&&Math.abs(t)<1e-12)return;n?this.prependTranslation(e,t):this.appendMatrix(scratchMatrix3.setToTranslation(e,t))}else{const r=e;if(assert&&assert(r.isFinite(),"translation should be a finite Vector2 if not finite numbers"),!r.x&&!r.y)return;this.translate(r.x,r.y,t)}}scale(e,t,n){if(typeof e=="number")if(assert&&assert(isFinite(e),"scales should be finite"),t===void 0||typeof t=="boolean")this.scale(e,e,t);else{if(assert&&assert(isFinite(t),"scales should be finite numbers"),assert&&assert(n===void 0||typeof n=="boolean","If provided, prependInstead should be boolean"),e===1&&t===1)return;n?this.prependMatrix(Matrix3.scaling(e,t)):this.appendMatrix(Matrix3.scaling(e,t))}else{const r=e;assert&&assert(r.isFinite(),"scale should be a finite Vector2 if not a finite number"),this.scale(r.x,r.y,t)}}rotate(e,t){assert&&assert(isFinite(e),"angle should be a finite number"),assert&&assert(t===void 0||typeof t=="boolean"),e%(2*Math.PI)!==0&&(t?this.prependMatrix(Matrix3.rotation2(e)):this.appendMatrix(Matrix3.rotation2(e)))}rotateAround(e,t){assert&&assert(e.isFinite(),"point should be a finite Vector2"),assert&&assert(isFinite(t),"angle should be a finite number");let n=Matrix3.translation(-e.x,-e.y);return n=Matrix3.rotation2(t).timesMatrix(n),n=Matrix3.translation(e.x,e.y).timesMatrix(n),this.prependMatrix(n),this}setX(e){return assert&&assert(isFinite(e),"x should be a finite number"),this.translate(e-this.getX(),0,!0),this}set x(e){this.setX(e)}get x(){return this.getX()}getX(){return this._transform.getMatrix().m02()}setY(e){return assert&&assert(isFinite(e),"y should be a finite number"),this.translate(0,e-this.getY(),!0),this}set y(e){this.setY(e)}get y(){return this.getY()}getY(){return this._transform.getMatrix().m12()}setScaleMagnitude(e,t){const n=this.getScaleVector();return typeof e=="number"?(t===void 0&&(t=e),assert&&assert(isFinite(e),"setScaleMagnitude parameters should be finite numbers"),assert&&assert(isFinite(t),"setScaleMagnitude parameters should be finite numbers"),this.appendMatrix(Matrix3.scaling(e/n.x,t/n.y))):(assert&&assert(e.isFinite(),"first parameter should be a finite Vector2"),this.appendMatrix(Matrix3.scaling(e.x/n.x,e.y/n.y))),this}getScaleVector(){return this._transform.getMatrix().getScaleVector()}setRotation(e){return assert&&assert(isFinite(e),"rotation should be a finite number"),this.appendMatrix(scratchMatrix3.setToRotationZ(e-this.getRotation())),this}set rotation(e){this.setRotation(e)}get rotation(){return this.getRotation()}getRotation(){return this._transform.getMatrix().getRotation()}setTranslation(e,t){const n=this._transform.getMatrix(),r=n.m02(),s=n.m12();let a,l;return typeof e=="number"?(assert&&assert(isFinite(e),"Parameters to setTranslation should be finite numbers"),assert&&assert(t!==void 0&&isFinite(t),"Parameters to setTranslation should be finite numbers"),a=e-r,l=t-s):(assert&&assert(e.isFinite(),"Should be a finite Vector2"),a=e.x-r,l=e.y-s),this.translate(a,l,!0),this}set translation(e){this.setTranslation(e)}get translation(){return this.getTranslation()}getTranslation(){const e=this._transform.getMatrix();return new Vector2(e.m02(),e.m12())}appendMatrix(e){assert&&assert(e.isFinite(),"matrix should be a finite Matrix3"),assert&&assert(e.getDeterminant()!==0,"matrix should not map plane to a line or point"),this._transform.append(e)}prependMatrix(e){assert&&assert(e.isFinite(),"matrix should be a finite Matrix3"),assert&&assert(e.getDeterminant()!==0,"matrix should not map plane to a line or point"),this._transform.prepend(e)}prependTranslation(e,t){assert&&assert(isFinite(e),"x should be a finite number"),assert&&assert(isFinite(t),"y should be a finite number"),!(!e&&!t)&&this._transform.prependTranslation(e,t)}setMatrix(e){assert&&assert(e.isFinite(),"matrix should be a finite Matrix3"),assert&&assert(e.getDeterminant()!==0,"matrix should not map plane to a line or point"),this._transform.setMatrix(e)}set matrix(e){this.setMatrix(e)}get matrix(){return this.getMatrix()}getMatrix(){return this._transform.getMatrix()}getTransform(){return this._transform}get transform(){return this.getTransform()}resetTransform(){this.setMatrix(Matrix3.IDENTITY)}onTransformChange(){this.invalidateBounds(),this._picker.onTransformChange(),assertSlow&&this._picker.audit(),this.transformEmitter.emit()}onSummaryChange(e,t){this._pdomDisplaysInfo.onSummaryChange(e,t)}updateMaxDimension(e){assert&&this.auditMaxDimensions();const t=this._appliedScaleFactor;let n=1;if(this._maxWidth!==null){const s=e.width;s>this._maxWidth&&(n=Math.min(n,this._maxWidth/s))}if(this._maxHeight!==null){const s=e.height;s>this._maxHeight&&(n=Math.min(n,this._maxHeight/s))}const r=n/t;r!==1&&(this._appliedScaleFactor=n,this.scale(r))}auditMaxDimensions(){assert&&assert(this._maxWidth===null||!isWidthSizable(this)||this.preferredWidth===null||this._maxWidth>=this.preferredWidth-1e-7,"If maxWidth and preferredWidth are both non-null, maxWidth should NOT be smaller than the preferredWidth. If that happens, it would trigger an infinite loop"),assert&&assert(this._maxHeight===null||!isHeightSizable(this)||this.preferredHeight===null||this._maxHeight>=this.preferredHeight-1e-7,"If maxHeight and preferredHeight are both non-null, maxHeight should NOT be smaller than the preferredHeight. If that happens, it would trigger an infinite loop")}onMaxDimensionChange(e,t){e===null&&t!==null?(this.changeBoundsEventCount(1),this._boundsEventSelfCount++):e!==null&&t===null&&(this.changeBoundsEventCount(-1),this._boundsEventSelfCount--)}setMaxWidth(e){assert&&assert(e===null||typeof e=="number"&&e>0,"maxWidth should be null (no constraint) or a positive number"),this._maxWidth!==e&&(this.onMaxDimensionChange(this._maxWidth,e),this._maxWidth=e,this.updateMaxDimension(this.localBoundsProperty.value))}set maxWidth(e){this.setMaxWidth(e)}get maxWidth(){return this.getMaxWidth()}getMaxWidth(){return this._maxWidth}setMaxHeight(e){assert&&assert(e===null||typeof e=="number"&&e>0,"maxHeight should be null (no constraint) or a positive number"),this._maxHeight!==e&&(this.onMaxDimensionChange(this._maxHeight,e),this._maxHeight=e,this.updateMaxDimension(this.localBoundsProperty.value))}set maxHeight(e){this.setMaxHeight(e)}get maxHeight(){return this.getMaxHeight()}getMaxHeight(){return this._maxHeight}setLeft(e){const t=this.getLeft();return isFinite(t)&&this.translate(e-t,0,!0),this}set left(e){this.setLeft(e)}get left(){return this.getLeft()}getLeft(){return this.getBounds().minX}setRight(e){const t=this.getRight();return isFinite(t)&&this.translate(e-t,0,!0),this}set right(e){this.setRight(e)}get right(){return this.getRight()}getRight(){return this.getBounds().maxX}setCenterX(e){const t=this.getCenterX();return isFinite(t)&&this.translate(e-t,0,!0),this}set centerX(e){this.setCenterX(e)}get centerX(){return this.getCenterX()}getCenterX(){return this.getBounds().getCenterX()}setCenterY(e){const t=this.getCenterY();return isFinite(t)&&this.translate(0,e-t,!0),this}set centerY(e){this.setCenterY(e)}get centerY(){return this.getCenterY()}getCenterY(){return this.getBounds().getCenterY()}setTop(e){const t=this.getTop();return isFinite(t)&&this.translate(0,e-t,!0),this}set top(e){this.setTop(e)}get top(){return this.getTop()}getTop(){return this.getBounds().minY}setBottom(e){const t=this.getBottom();return isFinite(t)&&this.translate(0,e-t,!0),this}set bottom(e){this.setBottom(e)}get bottom(){return this.getBottom()}getBottom(){return this.getBounds().maxY}setLeftTop(e){assert&&assert(e.isFinite(),"leftTop should be a finite Vector2");const t=this.getLeftTop();return t.isFinite()&&this.translate(e.minus(t),!0),this}set leftTop(e){this.setLeftTop(e)}get leftTop(){return this.getLeftTop()}getLeftTop(){return this.getBounds().getLeftTop()}setCenterTop(e){assert&&assert(e.isFinite(),"centerTop should be a finite Vector2");const t=this.getCenterTop();return t.isFinite()&&this.translate(e.minus(t),!0),this}set centerTop(e){this.setCenterTop(e)}get centerTop(){return this.getCenterTop()}getCenterTop(){return this.getBounds().getCenterTop()}setRightTop(e){assert&&assert(e.isFinite(),"rightTop should be a finite Vector2");const t=this.getRightTop();return t.isFinite()&&this.translate(e.minus(t),!0),this}set rightTop(e){this.setRightTop(e)}get rightTop(){return this.getRightTop()}getRightTop(){return this.getBounds().getRightTop()}setLeftCenter(e){assert&&assert(e.isFinite(),"leftCenter should be a finite Vector2");const t=this.getLeftCenter();return t.isFinite()&&this.translate(e.minus(t),!0),this}set leftCenter(e){this.setLeftCenter(e)}get leftCenter(){return this.getLeftCenter()}getLeftCenter(){return this.getBounds().getLeftCenter()}setCenter(e){assert&&assert(e.isFinite(),"center should be a finite Vector2");const t=this.getCenter();return t.isFinite()&&this.translate(e.minus(t),!0),this}set center(e){this.setCenter(e)}get center(){return this.getCenter()}getCenter(){return this.getBounds().getCenter()}setRightCenter(e){assert&&assert(e.isFinite(),"rightCenter should be a finite Vector2");const t=this.getRightCenter();return t.isFinite()&&this.translate(e.minus(t),!0),this}set rightCenter(e){this.setRightCenter(e)}get rightCenter(){return this.getRightCenter()}getRightCenter(){return this.getBounds().getRightCenter()}setLeftBottom(e){assert&&assert(e.isFinite(),"leftBottom should be a finite Vector2");const t=this.getLeftBottom();return t.isFinite()&&this.translate(e.minus(t),!0),this}set leftBottom(e){this.setLeftBottom(e)}get leftBottom(){return this.getLeftBottom()}getLeftBottom(){return this.getBounds().getLeftBottom()}setCenterBottom(e){assert&&assert(e.isFinite(),"centerBottom should be a finite Vector2");const t=this.getCenterBottom();return t.isFinite()&&this.translate(e.minus(t),!0),this}set centerBottom(e){this.setCenterBottom(e)}get centerBottom(){return this.getCenterBottom()}getCenterBottom(){return this.getBounds().getCenterBottom()}setRightBottom(e){assert&&assert(e.isFinite(),"rightBottom should be a finite Vector2");const t=this.getRightBottom();return t.isFinite()&&this.translate(e.minus(t),!0),this}set rightBottom(e){this.setRightBottom(e)}get rightBottom(){return this.getRightBottom()}getRightBottom(){return this.getBounds().getRightBottom()}getWidth(){return this.getBounds().getWidth()}get width(){return this.getWidth()}getHeight(){return this.getBounds().getHeight()}get height(){return this.getHeight()}getLocalWidth(){return this.getLocalBounds().getWidth()}get localWidth(){return this.getLocalWidth()}getLocalHeight(){return this.getLocalBounds().getHeight()}get localHeight(){return this.getLocalHeight()}getLocalLeft(){return this.getLocalBounds().minX}get localLeft(){return this.getLocalLeft()}getLocalRight(){return this.getLocalBounds().maxX}get localRight(){return this.getLocalRight()}getLocalCenterX(){return this.getLocalBounds().getCenterX()}get localCenterX(){return this.getLocalCenterX()}getLocalCenterY(){return this.getLocalBounds().getCenterY()}get localCenterY(){return this.getLocalCenterY()}getLocalTop(){return this.getLocalBounds().minY}get localTop(){return this.getLocalTop()}getLocalBottom(){return this.getLocalBounds().maxY}get localBottom(){return this.getLocalBottom()}getLocalLeftTop(){return this.getLocalBounds().getLeftTop()}get localLeftTop(){return this.getLocalLeftTop()}getLocalCenterTop(){return this.getLocalBounds().getCenterTop()}get localCenterTop(){return this.getLocalCenterTop()}getLocalRightTop(){return this.getLocalBounds().getRightTop()}get localRightTop(){return this.getLocalRightTop()}getLocalLeftCenter(){return this.getLocalBounds().getLeftCenter()}get localLeftCenter(){return this.getLocalLeftCenter()}getLocalCenter(){return this.getLocalBounds().getCenter()}get localCenter(){return this.getLocalCenter()}getLocalRightCenter(){return this.getLocalBounds().getRightCenter()}get localRightCenter(){return this.getLocalRightCenter()}getLocalLeftBottom(){return this.getLocalBounds().getLeftBottom()}get localLeftBottom(){return this.getLocalLeftBottom()}getLocalCenterBottom(){return this.getLocalBounds().getCenterBottom()}get localCenterBottom(){return this.getLocalCenterBottom()}getLocalRightBottom(){return this.getLocalBounds().getRightBottom()}get localRightBottom(){return this.getLocalRightBottom()}getId(){return this._id}get id(){return this.getId()}onVisiblePropertyChange(e){this._picker.onVisibilityChange(),assertSlow&&this._picker.audit(),this._pdomDisplaysInfo.onVisibilityChange(e);for(let t=0;t<this._parents.length;t++){const n=this._parents[t];n._excludeInvisibleChildrenFromBounds&&n.invalidateChildBounds()}}setVisibleProperty(e){return this._visibleProperty.setTargetProperty(e,this,VISIBLE_PROPERTY_TANDEM_NAME)}set visibleProperty(e){this.setVisibleProperty(e)}get visibleProperty(){return this.getVisibleProperty()}getVisibleProperty(){return this._visibleProperty}setVisible(e){return this.visibleProperty.set(e),this}set visible(e){this.setVisible(e)}get visible(){return this.isVisible()}isVisible(){return this.visibleProperty.value}setPhetioVisiblePropertyInstrumented(e){return this._visibleProperty.setTargetPropertyInstrumented(e,this)}set phetioVisiblePropertyInstrumented(e){this.setPhetioVisiblePropertyInstrumented(e)}get phetioVisiblePropertyInstrumented(){return this.getPhetioVisiblePropertyInstrumented()}getPhetioVisiblePropertyInstrumented(){return this._visibleProperty.getTargetPropertyInstrumented()}swapVisibility(e){assert&&assert(this.visible!==e.visible);const t=this.visible?this:e,n=this.visible?e:this,r=t.focused;return t.visible=!1,n.visible=!0,r&&n.focusable&&n.focus(),this}setOpacity(e){if(assert&&assert(isFinite(e),"opacity should be a finite number"),e<0||e>1)throw new Error(`opacity out of range: ${e}`);this.opacityProperty.value=e}set opacity(e){this.setOpacity(e)}get opacity(){return this.getOpacity()}getOpacity(){return this.opacityProperty.value}setDisabledOpacity(e){if(assert&&assert(isFinite(e),"disabledOpacity should be a finite number"),e<0||e>1)throw new Error(`disabledOpacity out of range: ${e}`);return this.disabledOpacityProperty.value=e,this}set disabledOpacity(e){this.setDisabledOpacity(e)}get disabledOpacity(){return this.getDisabledOpacity()}getDisabledOpacity(){return this.disabledOpacityProperty.value}getEffectiveOpacity(){return this.opacityProperty.value*(this.enabledProperty.value?1:this.disabledOpacityProperty.value)}get effectiveOpacity(){return this.getEffectiveOpacity()}onOpacityPropertyChange(){this.filterChangeEmitter.emit()}onDisabledOpacityPropertyChange(){this._enabledProperty.value||this.filterChangeEmitter.emit()}setFilters(e){assert&&assert(Array.isArray(e),"filters should be an array"),assert&&assert(_.every(e,t=>t instanceof Filter),"filters should consist of Filter objects only"),this._filters.length=0,this._filters.push(...e),this.invalidateHint(),this.filterChangeEmitter.emit()}set filters(e){this.setFilters(e)}get filters(){return this.getFilters()}getFilters(){return this._filters.slice()}setPickableProperty(e){return this._pickableProperty.setTargetProperty(e,this,null)}set pickableProperty(e){this.setPickableProperty(e)}get pickableProperty(){return this.getPickableProperty()}getPickableProperty(){return this._pickableProperty}setPickable(e){return assert&&assert(e===null||typeof e=="boolean"),this._pickableProperty.set(e),this}set pickable(e){this.setPickable(e)}get pickable(){return this.isPickable()}isPickable(){return this._pickableProperty.value}onPickablePropertyChange(e,t){this._picker.onPickableChange(t,e),assertSlow&&this._picker.audit()}setEnabledProperty(e){return this._enabledProperty.setTargetProperty(e,this,ENABLED_PROPERTY_TANDEM_NAME)}set enabledProperty(e){this.setEnabledProperty(e)}get enabledProperty(){return this.getEnabledProperty()}getEnabledProperty(){return this._enabledProperty}setPhetioEnabledPropertyInstrumented(e){return this._enabledProperty.setTargetPropertyInstrumented(e,this)}set phetioEnabledPropertyInstrumented(e){this.setPhetioEnabledPropertyInstrumented(e)}get phetioEnabledPropertyInstrumented(){return this.getPhetioEnabledPropertyInstrumented()}getPhetioEnabledPropertyInstrumented(){return this._enabledProperty.getTargetPropertyInstrumented()}setEnabled(e){return assert&&assert(e===null||typeof e=="boolean"),this._enabledProperty.set(e),this}set enabled(e){this.setEnabled(e)}get enabled(){return this.isEnabled()}isEnabled(){return this._enabledProperty.value}onEnabledPropertyChange(e){!e&&this.interruptSubtreeInput(),this.inputEnabled=e,this.disabledOpacityProperty.value!==1&&this.filterChangeEmitter.emit()}setInputEnabledProperty(e){return this._inputEnabledProperty.setTargetProperty(e,this,INPUT_ENABLED_PROPERTY_TANDEM_NAME)}set inputEnabledProperty(e){this.setInputEnabledProperty(e)}get inputEnabledProperty(){return this.getInputEnabledProperty()}getInputEnabledProperty(){return this._inputEnabledProperty}setPhetioInputEnabledPropertyInstrumented(e){return this._inputEnabledProperty.setTargetPropertyInstrumented(e,this)}set phetioInputEnabledPropertyInstrumented(e){this.setPhetioInputEnabledPropertyInstrumented(e)}get phetioInputEnabledPropertyInstrumented(){return this.getPhetioInputEnabledPropertyInstrumented()}getPhetioInputEnabledPropertyInstrumented(){return this._inputEnabledProperty.getTargetPropertyInstrumented()}setInputEnabled(e){this.inputEnabledProperty.value=e}set inputEnabled(e){this.setInputEnabled(e)}get inputEnabled(){return this.isInputEnabled()}isInputEnabled(){return this.inputEnabledProperty.value}setInputListeners(e){for(assert&&assert(Array.isArray(e));this._inputListeners.length;)this.removeInputListener(this._inputListeners[0]);for(let t=0;t<e.length;t++)this.addInputListener(e[t]);return this}set inputListeners(e){this.setInputListeners(e)}get inputListeners(){return this.getInputListeners()}getInputListeners(){return this._inputListeners.slice(0)}setCursor(e){this._cursor=e==="auto"?null:e}set cursor(e){this.setCursor(e)}get cursor(){return this.getCursor()}getCursor(){return this._cursor}getEffectiveCursor(){if(this._cursor)return this._cursor;for(let e=0;e<this._inputListeners.length;e++){const t=this._inputListeners[e];if(t.cursor)return t.cursor}return null}setMouseArea(e){return assert&&assert(e===null||e instanceof Shape$1||e instanceof Bounds2,"mouseArea needs to be a phet.kite.Shape, phet.dot.Bounds2, or null"),this._mouseArea!==e&&(this._mouseArea=e,this._picker.onMouseAreaChange(),assertSlow&&this._picker.audit()),this}set mouseArea(e){this.setMouseArea(e)}get mouseArea(){return this.getMouseArea()}getMouseArea(){return this._mouseArea}setTouchArea(e){return assert&&assert(e===null||e instanceof Shape$1||e instanceof Bounds2,"touchArea needs to be a phet.kite.Shape, phet.dot.Bounds2, or null"),this._touchArea!==e&&(this._touchArea=e,this._picker.onTouchAreaChange(),assertSlow&&this._picker.audit()),this}set touchArea(e){this.setTouchArea(e)}get touchArea(){return this.getTouchArea()}getTouchArea(){return this._touchArea}setClipArea(e){assert&&assert(e===null||e instanceof Shape$1,"clipArea needs to be a phet.kite.Shape, or null"),this.clipArea!==e&&(this.clipAreaProperty.value=e,this.invalidateBounds(),this._picker.onClipAreaChange(),assertSlow&&this._picker.audit())}set clipArea(e){this.setClipArea(e)}get clipArea(){return this.getClipArea()}getClipArea(){return this.clipAreaProperty.value}hasClipArea(){return this.clipArea!==null}setRendererBitmask(e){assert&&assert(isFinite(e)),e!==this._rendererBitmask&&(this._rendererBitmask=e,this._rendererSummary.selfChange(),this.instanceRefreshEmitter.emit())}invalidateSupportedRenderers(){}invalidateHint(){this.rendererSummaryRefreshEmitter.emit(),this.instanceRefreshEmitter.emit()}setRenderer(e){assert&&assert(e===null||e==="canvas"||e==="svg"||e==="dom"||e==="webgl",'Renderer input should be null, or one of: "canvas", "svg", "dom" or "webgl".');let t=0;e==="canvas"?t=Renderer.bitmaskCanvas:e==="svg"?t=Renderer.bitmaskSVG:e==="dom"?t=Renderer.bitmaskDOM:e==="webgl"&&(t=Renderer.bitmaskWebGL),assert&&assert(e===null==(t===0),"We should only end up with no actual renderer if renderer is null"),this._renderer!==t&&(this._renderer=t,this.invalidateHint())}set renderer(e){this.setRenderer(e)}get renderer(){return this.getRenderer()}getRenderer(){return this._renderer===0?null:this._renderer===Renderer.bitmaskCanvas?"canvas":this._renderer===Renderer.bitmaskSVG?"svg":this._renderer===Renderer.bitmaskDOM?"dom":this._renderer===Renderer.bitmaskWebGL?"webgl":(assert&&assert(!1,"Seems to be an invalid renderer?"),null)}setLayerSplit(e){e!==this._layerSplit&&(this._layerSplit=e,this.invalidateHint())}set layerSplit(e){this.setLayerSplit(e)}get layerSplit(){return this.isLayerSplit()}isLayerSplit(){return this._layerSplit}setUsesOpacity(e){e!==this._usesOpacity&&(this._usesOpacity=e,this.invalidateHint())}set usesOpacity(e){this.setUsesOpacity(e)}get usesOpacity(){return this.getUsesOpacity()}getUsesOpacity(){return this._usesOpacity}setCSSTransform(e){e!==this._cssTransform&&(this._cssTransform=e,this.invalidateHint())}set cssTransform(e){this.setCSSTransform(e)}get cssTransform(){return this.isCSSTransformed()}isCSSTransformed(){return this._cssTransform}setExcludeInvisible(e){e!==this._excludeInvisible&&(this._excludeInvisible=e,this.invalidateHint())}set excludeInvisible(e){this.setExcludeInvisible(e)}get excludeInvisible(){return this.isExcludeInvisible()}isExcludeInvisible(){return this._excludeInvisible}setExcludeInvisibleChildrenFromBounds(e){e!==this._excludeInvisibleChildrenFromBounds&&(this._excludeInvisibleChildrenFromBounds=e,this.invalidateBounds())}set excludeInvisibleChildrenFromBounds(e){this.setExcludeInvisibleChildrenFromBounds(e)}get excludeInvisibleChildrenFromBounds(){return this.isExcludeInvisibleChildrenFromBounds()}isExcludeInvisibleChildrenFromBounds(){return this._excludeInvisibleChildrenFromBounds}setLayoutOptions(e){assert&&assert(e===null||typeof e=="object"&&Object.getPrototypeOf(e)===Object.prototype,"layoutOptions should be null or an plain options-style object"),e!==this._layoutOptions&&(this._layoutOptions=e,this.layoutOptionsChangedEmitter.emit())}set layoutOptions(e){this.setLayoutOptions(e)}get layoutOptions(){return this.getLayoutOptions()}getLayoutOptions(){return this._layoutOptions}mutateLayoutOptions(e){this.layoutOptions=optionize3()({},this.layoutOptions||{},e)}get widthSizable(){return!1}get heightSizable(){return!1}get extendsWidthSizable(){return!1}get extendsHeightSizable(){return!1}get extendsSizable(){return!1}setPreventFit(e){e!==this._preventFit&&(this._preventFit=e,this.invalidateHint())}set preventFit(e){this.setPreventFit(e)}get preventFit(){return this.isPreventFit()}isPreventFit(){return this._preventFit}setWebGLScale(e){assert&&assert(e===null||typeof e=="number"&&isFinite(e)),e!==this._webglScale&&(this._webglScale=e,this.invalidateHint())}set webglScale(e){this.setWebGLScale(e)}get webglScale(){return this.getWebGLScale()}getWebGLScale(){return this._webglScale}getUniqueTrail(e){if(e){const t=this.getTrails(e);return assert&&assert(t.length===1,`getUniqueTrail found ${t.length} matching trails for the predicate`),t[0]}else{const t=new Trail;let n=this;for(;n;)assert&&assert(n._parents.length<=1,`getUniqueTrail found a Node with ${n._parents.length} parents.`),t.addAncestor(n),n=n._parents[0];return t}}getUniqueTrailTo(e){return this.getUniqueTrail(t=>e===t)}getTrails(e){e=e||wn.defaultTrailPredicate;const t=[],n=new Trail(this);return Trail.appendAncestorTrailsWithPredicate(t,n,e),t}getTrailsTo(e){return this.getTrails(t=>t===e)}getLeafTrails(e){e=e||wn.defaultLeafTrailPredicate;const t=[],n=new Trail(this);return Trail.appendDescendantTrailsWithPredicate(t,n,e),t}getLeafTrailsTo(e){return this.getLeafTrails(t=>t===e)}getUniqueLeafTrail(e){const t=this.getLeafTrails(e);return assert&&assert(t.length===1,`getUniqueLeafTrail found ${t.length} matching trails for the predicate`),t[0]}getUniqueLeafTrailTo(e){return this.getUniqueLeafTrail(t=>t===e)}getConnectedNodes(){const e=[];let t=this._children.concat(this._parents).concat(this);for(;t.length;){const n=t.pop();_.includes(e,n)||(e.push(n),t=t.concat(n._children,n._parents))}return e}getSubtreeNodes(){const e=[];let t=this._children.concat(this);for(;t.length;){const n=t.pop();_.includes(e,n)||(e.push(n),t=t.concat(n._children))}return e}getTopologicallySortedNodes(){const e={},t=[],n=[];let r;_.each(this.getConnectedNodes(),a=>{e[a.id]={},_.each(a._children,l=>{e[a.id][l.id]=!0}),a.parents.length||t.push(a)});function s(a){delete e[r.id][a.id],_.every(e,l=>!l[a.id])&&t.push(a)}for(;t.length;)r=t.pop(),n.push(r),_.each(r._children,s);return assert&&assert(_.every(e,a=>_.every(a,l=>!1)),"circular reference check"),n}canAddChild(e){if(this===e||_.includes(this._children,e))return!1;const t={},n=[];let r;_.each(this.getConnectedNodes().concat(e.getConnectedNodes()),a=>{t[a.id]={},_.each(a._children,l=>{t[a.id][l.id]=!0}),!a.parents.length&&a!==e&&n.push(a)}),t[this.id][e.id]=!0;function s(a){delete t[r.id][a.id],_.every(t,l=>!l[a.id])&&n.push(a)}for(;n.length;)r=n.pop(),_.each(r._children,s),r===this&&s(e);return _.every(t,a=>_.every(a,l=>!1))}canvasPaintSelf(e,t){}renderToCanvasSelf(e,t){this.isPainted()&&this._rendererBitmask&Renderer.bitmaskCanvas&&this.canvasPaintSelf(e,t)}renderToCanvasSubtree(e,t){t=t||Matrix3.identity(),e.resetStyles(),this.renderToCanvasSelf(e,t);for(let n=0;n<this._children.length;n++){const r=this._children[n];if(r.isVisible()&&r.bounds.isValid()){const s=r.effectiveOpacity!==1||r.clipArea||r._filters.length;if(e.context.save(),t.multiplyMatrix(r._transform.getMatrix()),t.canvasSetTransform(e.context),s){const a=r.localBounds.transformed(t).dilate(4).roundOut().constrainBounds(scratchBounds2Extra.setMinMax(0,0,e.canvas.width,e.canvas.height));if(a.width>0&&a.height>0){const l=document.createElement("canvas");l.width=a.width,l.height=a.height;const d=l.getContext("2d"),c=new CanvasContextWrapper(l,d),y=t.copy().prependTranslation(-a.minX,-a.minY);y.canvasSetTransform(d),r.renderToCanvasSubtree(c,y),e.context.save(),r.clipArea&&(e.context.beginPath(),r.clipArea.writeToContext(e.context),e.context.clip()),e.context.setTransform(1,0,0,1,0,0),e.context.globalAlpha=r.effectiveOpacity;let m=!1;r._filters.length&&(Features.canvasFilter&&_.every(r._filters,O=>O.isDOMCompatible())?(e.context.filter=r._filters.map(O=>O.getCSSFilterString()).join(" "),m=!0):r._filters.forEach(O=>O.applyCanvasFilter(c))),e.context.drawImage(l,a.minX,a.minY),e.context.restore(),m&&(e.context.filter="none")}}else r.renderToCanvasSubtree(e,t);t.multiplyMatrix(r._transform.getInverse()),e.context.restore()}}}renderToCanvas(e,t,n,r){assert&&deprecationWarning("Node.renderToCanvas() is deprecated, please use Node.rasterized() instead"),e.width=e.width,r&&(t.fillStyle=r,t.fillRect(0,0,e.width,e.height));const s=new CanvasContextWrapper(e,t);this.renderToCanvasSubtree(s,Matrix3.identity()),n&&n()}toCanvas(e,t,n,r,s){assert&&assert(t===void 0||typeof t=="number","If provided, x should be a number"),assert&&assert(n===void 0||typeof n=="number","If provided, y should be a number"),assert&&assert(r===void 0||typeof r=="number"&&r>=0&&r%1===0,"If provided, width should be a non-negative integer"),assert&&assert(s===void 0||typeof s=="number"&&s>=0&&s%1===0,"If provided, height should be a non-negative integer");const a=2,l=this.getBounds().union(this.localToParentBounds(this.getSafeSelfBounds()));assert&&assert(!l.isEmpty()||t!==void 0&&n!==void 0&&r!==void 0&&s!==void 0,"Should not call toCanvas on a Node with empty bounds, unless all dimensions are provided"),t=t!==void 0?t:Math.ceil(a-l.minX),n=n!==void 0?n:Math.ceil(a-l.minY),r=r!==void 0?r:Math.ceil(l.getWidth()+2*a),s=s!==void 0?s:Math.ceil(l.getHeight()+2*a);const d=document.createElement("canvas");d.width=r,d.height=s;const c=d.getContext("2d");c.translate(t,n),this._transform.getMatrix().canvasAppendTransform(c);const y=new CanvasContextWrapper(d,c);this.renderToCanvasSubtree(y,Matrix3.translation(t,n).timesMatrix(this._transform.getMatrix())),e(d,t,n,r,s)}toDataURL(e,t,n,r,s){assert&&assert(t===void 0||typeof t=="number","If provided, x should be a number"),assert&&assert(n===void 0||typeof n=="number","If provided, y should be a number"),assert&&assert(r===void 0||typeof r=="number"&&r>=0&&r%1===0,"If provided, width should be a non-negative integer"),assert&&assert(s===void 0||typeof s=="number"&&s>=0&&s%1===0,"If provided, height should be a non-negative integer"),this.toCanvas((a,l,d,c,y)=>{e(a.toDataURL(),l,d,c,y)},t,n,r,s)}toImage(e,t,n,r,s){assert&&deprecationWarning("Node.toImage() is deprecated, please use Node.rasterized() instead"),assert&&assert(t===void 0||typeof t=="number","If provided, x should be a number"),assert&&assert(n===void 0||typeof n=="number","If provided, y should be a number"),assert&&assert(r===void 0||typeof r=="number"&&r>=0&&r%1===0,"If provided, width should be a non-negative integer"),assert&&assert(s===void 0||typeof s=="number"&&s>=0&&s%1===0,"If provided, height should be a non-negative integer"),this.toDataURL((a,l,d)=>{const c=document.createElement("img");c.onload=()=>{e(c,l,d);try{delete c.onload}catch{}},c.src=a},t,n,r,s)}toImageNodeAsynchronous(e,t,n,r,s){assert&&deprecationWarning("Node.toImageNodeAsyncrhonous() is deprecated, please use Node.rasterized() instead"),assert&&assert(t===void 0||typeof t=="number","If provided, x should be a number"),assert&&assert(n===void 0||typeof n=="number","If provided, y should be a number"),assert&&assert(r===void 0||typeof r=="number"&&r>=0&&r%1===0,"If provided, width should be a non-negative integer"),assert&&assert(s===void 0||typeof s=="number"&&s>=0&&s%1===0,"If provided, height should be a non-negative integer"),this.toImage((a,l,d)=>{e(new wn({children:[new Image$1(a,{x:-l,y:-d})]}))},t,n,r,s)}toCanvasNodeSynchronous(e,t,n,r){assert&&deprecationWarning("Node.toCanvasNodeSynchronous() is deprecated, please use Node.rasterized() instead"),assert&&assert(e===void 0||typeof e=="number","If provided, x should be a number"),assert&&assert(t===void 0||typeof t=="number","If provided, y should be a number"),assert&&assert(n===void 0||typeof n=="number"&&n>=0&&n%1===0,"If provided, width should be a non-negative integer"),assert&&assert(r===void 0||typeof r=="number"&&r>=0&&r%1===0,"If provided, height should be a non-negative integer");let s=null;return this.toCanvas((a,l,d)=>{s=new wn({children:[new Image$1(a,{x:-l,y:-d})]})},e,t,n,r),assert&&assert(s,"toCanvasNodeSynchronous requires that the node can be rendered only using Canvas"),s}toDataURLImageSynchronous(e,t,n,r){assert&&deprecationWarning("Node.toDataURLImageSychronous() is deprecated, please use Node.rasterized() instead"),assert&&assert(e===void 0||typeof e=="number","If provided, x should be a number"),assert&&assert(t===void 0||typeof t=="number","If provided, y should be a number"),assert&&assert(n===void 0||typeof n=="number"&&n>=0&&n%1===0,"If provided, width should be a non-negative integer"),assert&&assert(r===void 0||typeof r=="number"&&r>=0&&r%1===0,"If provided, height should be a non-negative integer");let s=null;return this.toDataURL((a,l,d,c,y)=>{s=new Image$1(a,{x:-l,y:-d,initialWidth:c,initialHeight:y})},e,t,n,r),assert&&assert(s,"toDataURL failed to return a result synchronously"),s}toDataURLNodeSynchronous(e,t,n,r){return assert&&deprecationWarning("Node.toDataURLNodeSynchronous() is deprecated, please use Node.rasterized() instead"),assert&&assert(e===void 0||typeof e=="number","If provided, x should be a number"),assert&&assert(t===void 0||typeof t=="number","If provided, y should be a number"),assert&&assert(n===void 0||typeof n=="number"&&n>=0&&n%1===0,"If provided, width should be a non-negative integer"),assert&&assert(r===void 0||typeof r=="number"&&r>=0&&r%1===0,"If provided, height should be a non-negative integer"),new wn({children:[this.toDataURLImageSynchronous(e,t,n,r)]})}rasterized(e){const t=optionize()({resolution:1,sourceBounds:null,useTargetBounds:!0,wrap:!0,useCanvas:!1,imageOptions:{}},e),n=t.resolution,r=t.sourceBounds;assert&&(assert(typeof n=="number"&&n>0,"resolution should be a positive number"),assert(r===null||r instanceof Bounds2,"sourceBounds should be null or a Bounds2"),r&&(assert(r.isValid(),"sourceBounds should be valid (finite non-negative)"),assert(Number.isInteger(r.width),"sourceBounds.width should be an integer"),assert(Number.isInteger(r.height),"sourceBounds.height should be an integer")));const s=new wn({scale:n,children:[this]});let a=r||this.getSafeTransformedVisibleBounds().dilated(2).roundedOut();n!==1&&(a=new Bounds2(n*a.minX,n*a.minY,n*a.maxX,n*a.maxY),a.width%1!==0&&(a.maxX+=1-a.width%1),a.height%1!==0&&(a.maxY+=1-a.height%1));let l=null;function d(y,m,O,D,z){const w=t.useCanvas?y:y.toDataURL();l=new Image$1(w,combineOptions({},t.imageOptions,{x:-m,y:-O,initialWidth:D,initialHeight:z})),l.scale(1/n,1/n,!0)}s.toCanvas(d,-a.minX,-a.minY,DotUtils.roundSymmetric(a.width),DotUtils.roundSymmetric(a.height)),assert&&assert(l,"The toCanvas should have executed synchronously"),s.dispose();let c=this.getVisibleBounds();if(r&&(c=r.intersection(c)),t.useTargetBounds&&(l.imageBounds=l.parentToLocalBounds(c)),t.wrap){const y=new wn({children:[l]});return t.useTargetBounds&&(y.localBounds=c),y}else return t.useTargetBounds&&(l.localBounds=l.parentToLocalBounds(c)),l}createDOMDrawable(e,t){throw new Error("createDOMDrawable is abstract. The subtype should either override this method, or not support the DOM renderer")}createSVGDrawable(e,t){throw new Error("createSVGDrawable is abstract. The subtype should either override this method, or not support the DOM renderer")}createCanvasDrawable(e,t){throw new Error("createCanvasDrawable is abstract. The subtype should either override this method, or not support the DOM renderer")}createWebGLDrawable(e,t){throw new Error("createWebGLDrawable is abstract. The subtype should either override this method, or not support the DOM renderer")}getInstances(){return this._instances}get instances(){return this.getInstances()}addInstance(e){this._instances.push(e),this.changedInstanceEmitter.emit(e,!0)}removeInstance(e){const t=_.indexOf(this._instances,e);assert&&assert(t!==-1,"Cannot remove a Instance from a Node if it was not there"),this._instances.splice(t,1),this.changedInstanceEmitter.emit(e,!1)}wasVisuallyDisplayed(e){for(let t=0;t<this._instances.length;t++){const n=this._instances[t];if(n.visible&&(!e||n.display===e))return!0}return!1}getRootedDisplays(){return this._rootedDisplays}get rootedDisplays(){return this.getRootedDisplays()}addRootedDisplay(e){this._rootedDisplays.push(e),this._pdomDisplaysInfo.onAddedRootedDisplay(e)}removeRootedDisplay(e){const t=_.indexOf(this._rootedDisplays,e);assert&&assert(t!==-1,"Cannot remove a Display from a Node if it was not there"),this._rootedDisplays.splice(t,1),this._pdomDisplaysInfo.onRemovedRootedDisplay(e)}getRecursiveConnectedDisplays(e){this.rootedDisplays.length&&e.push(...this.rootedDisplays);for(let t=0;t<this._parents.length;t++)e.push(...this._parents[t].getRecursiveConnectedDisplays(e));return _.uniq(e)}getConnectedDisplays(){return _.uniq(this.getRecursiveConnectedDisplays([]))}localToParentPoint(e){return this._transform.transformPosition2(e)}localToParentBounds(e){return this._transform.transformBounds2(e)}parentToLocalPoint(e){return this._transform.inversePosition2(e)}parentToLocalBounds(e){return this._transform.inverseBounds2(e)}transformBoundsFromLocalToParent(e){return e.transform(this._transform.getMatrix())}transformBoundsFromParentToLocal(e){return e.transform(this._transform.getInverse())}getLocalToGlobalMatrix(){let e=this;const t=[];for(;e;)t.push(e._transform.getMatrix()),assert&&assert(e._parents[1]===void 0,"getLocalToGlobalMatrix unable to work for DAG"),e=e._parents[0];const n=Matrix3.identity();for(let r=t.length-1;r>=0;r--)n.multiplyMatrix(t[r]);return n}getUniqueTransform(){return new Transform3(this.getLocalToGlobalMatrix())}getGlobalToLocalMatrix(){return this.getLocalToGlobalMatrix().invert()}localToGlobalPoint(e){let t=this;const n=e.copy();for(;t;)t._transform.getMatrix().multiplyVector2(n),assert&&assert(t._parents[1]===void 0,"localToGlobalPoint unable to work for DAG"),t=t._parents[0];return n}globalToLocalPoint(e){let t=this;const n=[];for(;t;)n.push(t._transform),assert&&assert(t._parents[1]===void 0,"globalToLocalPoint unable to work for DAG"),t=t._parents[0];const r=e.copy();for(let s=n.length-1;s>=0;s--)n[s].getInverse().multiplyVector2(r);return r}localToGlobalBounds(e){return e.transformed(this.getLocalToGlobalMatrix())}globalToLocalBounds(e){return e.transformed(this.getGlobalToLocalMatrix())}parentToGlobalPoint(e){return assert&&assert(this.parents.length<=1,"parentToGlobalPoint unable to work for DAG"),this.parents.length?this.parents[0].localToGlobalPoint(e):e}parentToGlobalBounds(e){return assert&&assert(this.parents.length<=1,"parentToGlobalBounds unable to work for DAG"),this.parents.length?this.parents[0].localToGlobalBounds(e):e}globalToParentPoint(e){return assert&&assert(this.parents.length<=1,"globalToParentPoint unable to work for DAG"),this.parents.length?this.parents[0].globalToLocalPoint(e):e}globalToParentBounds(e){return assert&&assert(this.parents.length<=1,"globalToParentBounds unable to work for DAG"),this.parents.length?this.parents[0].globalToLocalBounds(e):e}getGlobalBounds(){return assert&&assert(this.parents.length<=1,"globalBounds unable to work for DAG"),this.parentToGlobalBounds(this.getBounds())}get globalBounds(){return this.getGlobalBounds()}boundsOf(e){return this.globalToLocalBounds(e.getGlobalBounds())}boundsTo(e){return e.globalToLocalBounds(this.getGlobalBounds())}attachDrawable(e){return this._drawables.push(e),this}detachDrawable(e){const t=_.indexOf(this._drawables,e);return assert&&assert(t>=0,"Invalid operation: trying to detach a non-referenced drawable"),this._drawables.splice(t,1),this}mutate(e){if(!e)return this;assert&&assert(Object.getPrototypeOf(e)===Object.prototype,"Extra prototype on Node options object is a code smell"),assert&&assert(_.filter(["translation","x","left","right","centerX","centerTop","rightTop","leftCenter","center","rightCenter","leftBottom","centerBottom","rightBottom"],n=>e[n]!==void 0).length<=1,`More than one mutation on this Node set the x component, check ${Object.keys(e).join(",")}`),assert&&assert(_.filter(["translation","y","top","bottom","centerY","centerTop","rightTop","leftCenter","center","rightCenter","leftBottom","centerBottom","rightBottom"],n=>e[n]!==void 0).length<=1,`More than one mutation on this Node set the y component, check ${Object.keys(e).join(",")}`),assert&&e.hasOwnProperty("enabled")&&e.hasOwnProperty("enabledProperty")&&assert&&assert(e.enabledProperty.value===e.enabled,"If both enabled and enabledProperty are provided, then values should match"),assert&&e.hasOwnProperty("inputEnabled")&&e.hasOwnProperty("inputEnabledProperty")&&assert&&assert(e.inputEnabledProperty.value===e.inputEnabled,"If both inputEnabled and inputEnabledProperty are provided, then values should match"),assert&&e.hasOwnProperty("visible")&&e.hasOwnProperty("visibleProperty")&&assert&&assert(e.visibleProperty.value===e.visible,"If both visible and visibleProperty are provided, then values should match"),assert&&e.hasOwnProperty("pickable")&&e.hasOwnProperty("pickableProperty")&&assert&&assert(e.pickableProperty.value===e.pickable,"If both pickable and pickableProperty are provided, then values should match");const t=this._mutatorKeys;for(let n=0;n<t.length;n++){const r=t[n];if(assert&&assert(!e.hasOwnProperty(r)||e[r]!==void 0,`Undefined not allowed for Node key: ${r}`),e[r]!==void 0){const s=Object.getOwnPropertyDescriptor(wn.prototype,r);s&&typeof s.value=="function"?this[r](e[r]):this[r]=e[r]}}return this.initializePhetioObject(DEFAULT_PHET_IO_OBJECT_BASE_OPTIONS,e),this}initializePhetioObject(e,t){const n=this.isPhetioInstrumented();super.initializePhetioObject(e,t),Tandem.PHET_IO_ENABLED&&!n&&this.isPhetioInstrumented()&&(this._visibleProperty.initializePhetio(this,VISIBLE_PROPERTY_TANDEM_NAME,()=>new BooleanProperty(this.visible,combineOptions({phetioReadOnly:this.phetioReadOnly,tandem:this.tandem.createTandem(VISIBLE_PROPERTY_TANDEM_NAME),phetioDocumentation:"Controls whether the Node will be visible (and interactive)."},t.visiblePropertyOptions))),this._enabledProperty.initializePhetio(this,ENABLED_PROPERTY_TANDEM_NAME,()=>new EnabledProperty(this.enabled,combineOptions({phetioReadOnly:this.phetioReadOnly,phetioDocumentation:'Sets whether the node is enabled. This will set whether input is enabled for this Node and most often children as well. It will also control and toggle the "disabled look" of the node.',tandem:this.tandem.createTandem(ENABLED_PROPERTY_TANDEM_NAME)},t.enabledPropertyOptions))),this._inputEnabledProperty.initializePhetio(this,INPUT_ENABLED_PROPERTY_TANDEM_NAME,()=>new Property(this.inputEnabled,combineOptions({phetioReadOnly:this.phetioReadOnly,tandem:this.tandem.createTandem(INPUT_ENABLED_PROPERTY_TANDEM_NAME),phetioValueType:BooleanIO,phetioFeatured:!0,phetioDocumentation:"Sets whether the element will have input enabled, and hence be interactive."},t.inputEnabledPropertyOptions))))}setVoicingVisible(e){this.voicingVisibleProperty.value!==e&&(this.voicingVisibleProperty.value=e)}set voicingVisible(e){this.setVoicingVisible(e)}get voicingVisible(){return this.isVoicingVisible()}isVoicingVisible(){return this.voicingVisibleProperty.value}getDebugHTMLExtras(){return""}inspect(){localStorage.scenerySnapshot=JSON.stringify({type:"Subtree",rootNodeId:this.id,nodes:serializeConnectedNodes(this)})}toString(){return`${this.constructor.name}#${this.id}`}auditInstanceSubtreeForDisplay(e){if(assertSlow){const t=this._instances.length;for(let n=0;n<t;n++){const r=this._instances[n];r.display===e&&assertSlow(r.trail.isValid(),`Invalid trail on Instance: ${r.toString()} with trail ${r.trail.toString()}`)}this.children.forEach(n=>{n.auditInstanceSubtreeForDisplay(e)})}}onBoundsListenersAddedOrRemoved(e){this.changeBoundsEventCount(e),this._boundsEventSelfCount+=e}dispose(){this.disposeParallelDOM(),this.removeAllChildren(),this.detach(),this._inputEnabledProperty.dispose(),this._enabledProperty.dispose(),this._pickableProperty.dispose(),this._visibleProperty.dispose(),super.dispose()}disposeSubtree(){if(!this.isDisposed){const e=this.children;this.dispose();for(let t=0;t<e.length;t++)e[t].disposeSubtree()}}static defaultTrailPredicate(e){return e._parents.length===0}static defaultLeafTrailPredicate(e){return e._children.length===0}},wn.REQUIRES_BOUNDS_OPTION_KEYS=REQUIRES_BOUNDS_OPTION_KEYS,wn.DEFAULT_NODE_OPTIONS=DEFAULT_OPTIONS$7,wn);Node$1.prototype._mutatorKeys=ACCESSIBILITY_OPTION_KEYS.concat(NODE_OPTION_KEYS);Node$1.prototype.drawableMarkFlags=[];scenery.register("Node",Node$1);Node$1.NodeIO=new IOType("NodeIO",{valueType:Node$1,documentation:"The base type for graphical and potentially interactive objects.",metadataDefaults:{phetioState:PHET_IO_STATE_DEFAULT$1}});const DEFAULT_PHET_IO_OBJECT_BASE_OPTIONS={phetioType:Node$1.NodeIO,phetioState:PHET_IO_STATE_DEFAULT$1},Node$2=Node$1;class Picker{constructor(e){this.node=e,this.selfPruned=!1,this.selfInclusive=!1,this.subtreePrunable=!0,this.subtreePickableCount=0,this.mouseInclusiveBounds=Bounds2.NOTHING.copy(),this.mouseExclusiveBounds=Bounds2.NOTHING.copy(),this.touchInclusiveBounds=Bounds2.NOTHING.copy(),this.touchExclusiveBounds=Bounds2.NOTHING.copy(),this.mouseInclusiveDirty=!0,this.mouseExclusiveDirty=!0,this.touchInclusiveDirty=!0,this.touchExclusiveDirty=!0,this.scratchVector=new Vector2(0,0)}hitTest(e,t,n){assert&&assert(e,"trailUnderPointer requires a point"),sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`-------------- ${this.node.constructor.name}#${this.node.id}`);const r=this.selfInclusive;return t?r?this.validateMouseInclusive():this.validateMouseExclusive():n?r?this.validateTouchInclusive():this.validateTouchExclusive():this.node.validateBounds(),this.recursiveHitTest(e,t,n,!1)}recursiveHitTest(e,t,n,r){if(r=r||this.selfInclusive,this.selfPruned||!r&&this.subtreePrunable)return sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`${this.node.constructor.name}#${this.node.id} pruned ${this.selfPruned?"(self)":"(subtree)"}`),null;let s;if(t?(s=r?this.mouseInclusiveBounds:this.mouseExclusiveBounds,assert&&assert(r?!this.mouseInclusiveDirty:!this.mouseExclusiveDirty)):n?(s=r?this.touchInclusiveBounds:this.touchExclusiveBounds,assert&&assert(r?!this.touchInclusiveDirty:!this.touchExclusiveDirty)):(s=this.node.bounds,assert&&assert(!this.node._boundsDirty)),!s.containsPoint(e))return sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`${this.node.constructor.name}#${this.node.id} pruned: ${t?"mouse":n?"touch":"regular"}`),null;const a=this.node._transform.getInverse().multiplyVector2(this.scratchVector.set(e)),l=this.node.clipArea;if(l!==null&&!l.containsPoint(a))return sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`${this.node.constructor.name}#${this.node.id} out of clip area`),null;sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`${this.node.constructor.name}#${this.node.id}`);for(let d=this.node._children.length-1;d>=0;d--){const c=this.node._children[d];sceneryLog&&sceneryLog.hitTest&&sceneryLog.push();const y=c._picker.recursiveHitTest(a,t,n,r);if(sceneryLog&&sceneryLog.hitTest&&sceneryLog.pop(),y)return y.addAncestor(this.node,d)}return t&&this.node._mouseArea?(sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`${this.node.constructor.name}#${this.node.id} mouse area hit`),this.node._mouseArea.containsPoint(a)?new Trail(this.node):null):n&&this.node._touchArea?(sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`${this.node.constructor.name}#${this.node.id} touch area hit`),this.node._touchArea.containsPoint(a)?new Trail(this.node):null):this.node.selfBounds.containsPoint(a)&&this.node.containsPointSelf(a)?(sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`${this.node.constructor.name}#${this.node.id} self hit`),new Trail(this.node)):null}invalidate(e,t){let n=!!t||!this.mouseInclusiveDirty||!this.touchInclusiveDirty;if(this.mouseInclusiveDirty=!0,this.touchInclusiveDirty=!0,e&&(n=n||!this.mouseExclusiveDirty||!this.touchExclusiveDirty,this.mouseExclusiveDirty=!0,this.touchExclusiveDirty=!0),!this.selfPruned&&n){const r=this.node._parents;for(let s=0;s<r.length;s++)r[s]._picker.invalidate(e||this.selfInclusive,!1)}}validateMouseInclusive(){if(!this.mouseInclusiveDirty)return;this.mouseInclusiveBounds.set(this.node.selfBounds);const e=this.node._children;for(let t=0;t<e.length;t++){const n=e[t]._picker;n.selfPruned||(n.validateMouseInclusive(),this.mouseInclusiveBounds.includeBounds(n.mouseInclusiveBounds))}this.applyAreasAndTransform(this.mouseInclusiveBounds,this.node._mouseArea),this.mouseInclusiveDirty=!1}validateMouseExclusive(){if(!this.mouseExclusiveDirty)return;this.mouseExclusiveBounds.set(this.node.selfBounds);const e=this.node._children;for(let t=0;t<e.length;t++){const n=e[t]._picker;n.subtreePrunable||(n.selfInclusive?(n.validateMouseInclusive(),this.mouseExclusiveBounds.includeBounds(n.mouseInclusiveBounds)):(n.validateMouseExclusive(),this.mouseExclusiveBounds.includeBounds(n.mouseExclusiveBounds)))}this.applyAreasAndTransform(this.mouseExclusiveBounds,this.node._mouseArea),this.mouseExclusiveDirty=!1}validateTouchInclusive(){if(!this.touchInclusiveDirty)return;this.touchInclusiveBounds.set(this.node.selfBounds);const e=this.node._children;for(let t=0;t<e.length;t++){const n=e[t]._picker;n.selfPruned||(n.validateTouchInclusive(),this.touchInclusiveBounds.includeBounds(n.touchInclusiveBounds))}this.applyAreasAndTransform(this.touchInclusiveBounds,this.node._touchArea),this.touchInclusiveDirty=!1}validateTouchExclusive(){if(!this.touchExclusiveDirty)return;this.touchExclusiveBounds.set(this.node.selfBounds);const e=this.node._children;for(let t=0;t<e.length;t++){const n=e[t]._picker;n.subtreePrunable||(n.selfInclusive?(n.validateTouchInclusive(),this.touchExclusiveBounds.includeBounds(n.touchInclusiveBounds)):(n.validateTouchExclusive(),this.touchExclusiveBounds.includeBounds(n.touchExclusiveBounds)))}this.applyAreasAndTransform(this.touchExclusiveBounds,this.node._touchArea),this.touchExclusiveDirty=!1}applyAreasAndTransform(e,t){t&&e.includeBounds(t instanceof Bounds2?t:t.bounds);const n=this.node.clipArea;if(n){const r=n.bounds;e.minX=Math.max(e.minX,r.minX),e.minY=Math.max(e.minY,r.minY),e.maxX=Math.min(e.maxX,r.maxX),e.maxY=Math.min(e.maxY,r.maxY)}this.node.transformBoundsFromLocalToParent(e)}onInsertChild(e){if(!e._picker.selfPruned){const t=e._picker.subtreePickableCount>0;t&&this.changePickableCount(1),this.invalidate(t,!0)}}onRemoveChild(e){if(!e._picker.selfPruned){const t=e._picker.subtreePickableCount>0;t&&this.changePickableCount(-1),this.invalidate(t,!0)}}onAddInputListener(){this.checkSelfInclusive(),this.checkSubtreePrunable(),this.changePickableCount(1),assertSlow&&this.audit()}onRemoveInputListener(){this.checkSelfInclusive(),this.checkSubtreePrunable(),this.changePickableCount(-1),assertSlow&&this.audit()}onPickableChange(e,t){this.checkSelfPruned(),this.checkSelfInclusive(),this.checkSubtreePrunable();const n=(e===!0?-1:0)+(t===!0?1:0);n&&this.changePickableCount(n),assertSlow&&this.audit()}onVisibilityChange(){this.checkSelfPruned(),this.checkSubtreePrunable()}onMouseAreaChange(){this.invalidate(!0)}onTouchAreaChange(){this.invalidate(!0)}onTransformChange(){this.invalidate(!0)}onSelfBoundsDirty(){this.invalidate(!0)}onClipAreaChange(){this.invalidate(!0)}checkSelfPruned(){const e=this.node.pickableProperty.value===!1||!this.node.isVisible();if(this.selfPruned!==e){this.selfPruned=e;const t=this.node._parents;for(let n=0;n<t.length;n++){const r=t[n]._picker;this.subtreePickableCount>0?(r.invalidate(!0,!0),r.changePickableCount(this.selfPruned?-1:1)):r.invalidate(!1,!0)}}}checkSelfInclusive(){const e=this.node.pickableProperty.value===!0||this.node._inputListeners.length>0;this.selfInclusive!==e&&(this.selfInclusive=e,this.invalidate(!0,!0))}checkSubtreePrunable(){const e=this.node.pickableProperty.value===!1||!this.node.isVisible()||this.node.pickableProperty.value!==!0&&this.subtreePickableCount===0;this.subtreePrunable!==e&&(this.subtreePrunable=e,this.invalidate(!0,!0))}changePickableCount(e){if(e===0)return;const t=this.subtreePickableCount===0;this.subtreePickableCount+=e;const n=this.subtreePickableCount===0;if(this.checkSubtreePrunable(),assert&&assert(this.subtreePickableCount>=0,"subtree pickable count should be guaranteed to be >= 0"),!this.selfPruned&&t!==n){const r=this.node._parents.length;for(let s=0;s<r;s++)this.node._parents[s]._picker.changePickableCount(t?1:-1)}}audit(){if(assertSlow){this.node._children.forEach(a=>{a._picker.audit()});const e=assertSlow,t=this.node.pickable===!1||!this.node.isVisible(),n=this.node.pickable===!0||this.node._inputListeners.length>0,r=this.node.pickable===!1||!this.node.isVisible()||this.node.pickable!==!0&&this.subtreePickableCount===0,s=this.node._inputListeners.length+(this.node.pickableProperty.value===!0?1:0)+_.filter(this.node._children,a=>!a._picker.selfPruned&&a._picker.subtreePickableCount>0).length;assertSlow(this.selfPruned===t,"selfPruned mismatch"),assertSlow(this.selfInclusive===n,"selfInclusive mismatch"),assertSlow(this.subtreePrunable===r,"subtreePrunable mismatch"),assertSlow(this.subtreePickableCount===s,"subtreePickableCount mismatch"),this.node._parents.forEach(a=>{const l=a._picker,d=this;l.mouseInclusiveDirty||e(d.selfPruned||!d.mouseInclusiveDirty),l.mouseExclusiveDirty||(d.selfInclusive?e(d.selfPruned||!d.mouseInclusiveDirty):e(d.selfPruned||d.subtreePrunable||!d.mouseExclusiveDirty)),l.touchInclusiveDirty||e(d.selfPruned||!d.touchInclusiveDirty),l.touchExclusiveDirty||(d.selfInclusive?e(d.selfPruned||!d.touchInclusiveDirty):e(d.selfPruned||d.subtreePrunable||!d.touchExclusiveDirty))})}}}scenery.register("Picker",Picker);const summaryBits=[Renderer.bitmaskCanvas,Renderer.bitmaskSVG,Renderer.bitmaskDOM,Renderer.bitmaskWebGL,Renderer.bitmaskSingleCanvas,Renderer.bitmaskSingleSVG,Renderer.bitmaskNotPainted,Renderer.bitmaskBoundsValid,Renderer.bitmaskNoPDOM,Renderer.bitmaskLacksCanvas,Renderer.bitmaskLacksSVG,Renderer.bitmaskLacksDOM,Renderer.bitmaskLacksWebGL],summaryBitIndices={};summaryBits.forEach((o,e)=>{summaryBitIndices[o]=e});const numSummaryBits=summaryBits.length;let bitmaskAll=0;for(let o=0;o<numSummaryBits;o++)bitmaskAll|=summaryBits[o];class RendererSummary{constructor(e){assert&&assert(e instanceof Node$2),assert&&assert(e._rendererBitmask===Renderer.bitmaskNodeDefault,"Node must have a default bitmask when creating a RendererSummary"),assert&&assert(e._children.length===0,"Node cannot have children when creating a RendererSummary"),this.node=e,this._counts=new Int16Array(numSummaryBits),this.bitmask=bitmaskAll,this.selfBitmask=RendererSummary.summaryBitmaskForNodeSelf(e),this.summaryChange(this.bitmask,this.selfBitmask);const t=this.selfChange.bind(this);this.node.filterChangeEmitter.addListener(t),this.node.clipAreaProperty.lazyLink(t),this.node.rendererSummaryRefreshEmitter.addListener(t)}summaryChange(e,t){assert&&this.audit();const n=e^t;let r=0,s=0;for(let a=0;a<numSummaryBits;a++){const l=summaryBits[a],d=summaryBitIndices[l];l&n&&(l&t?(this._counts[d]--,this._counts[d]===0&&(s|=l)):(this._counts[d]++,this._counts[d]===1&&(r|=l)))}if(r||s){const a=this.bitmask;assert&&assert(a!==void 0);for(let d=0;d<numSummaryBits;d++){const c=summaryBits[d];s&c&&(this.bitmask|=c),r&c&&(this.bitmask^=c,assert&&assert(!(this.bitmask&c),"Should be cleared, doing cheaper XOR assuming it already was set"))}this.node.instanceRefreshEmitter.emit(),this.node.onSummaryChange(a,this.bitmask);const l=this.node._parents.length;for(let d=0;d<l;d++)this.node._parents[d]._rendererSummary.summaryChange(r,s);assert&&assert(this.bitmask===this.computeBitmask(),"Sanity check")}assert&&this.audit()}selfChange(){const e=this.selfBitmask,t=RendererSummary.summaryBitmaskForNodeSelf(this.node);e!==t&&(this.summaryChange(e,t),this.selfBitmask=t)}computeBitmask(){let e=0;for(let t=0;t<numSummaryBits;t++)this._counts[t]===0&&(e|=summaryBits[t]);return e}isSubtreeFullyCompatible(e){return!!(e&this.bitmask)}isSubtreeContainingCompatible(e){return!(e<<Renderer.bitmaskLacksShift&this.bitmask)}isSingleCanvasSupported(){return!!(Renderer.bitmaskSingleCanvas&this.bitmask)}isSingleSVGSupported(){return!!(Renderer.bitmaskSingleSVG&this.bitmask)}isNotPainted(){return!!(Renderer.bitmaskNotPainted&this.bitmask)}hasNoPDOM(){return!!(Renderer.bitmaskNoPDOM&this.bitmask)}areBoundsValid(){return!!(Renderer.bitmaskBoundsValid&this.bitmask)}isSubtreeRenderedExclusivelySVG(e){if(!this.isSingleSVGSupported())return!1;for(let t=0;t<Renderer.numActiveRenderers;t++){const n=Renderer.bitmaskOrder(e,t);if(Renderer.bitmaskSVG&n)return!0;if(this.isSubtreeContainingCompatible(n))return!1}return!1}isSubtreeRenderedExclusivelyCanvas(e){if(!this.isSingleCanvasSupported())return!1;for(let t=0;t<Renderer.numActiveRenderers;t++){const n=Renderer.bitmaskOrder(e,t);if(Renderer.bitmaskCanvas&n)return!0;if(this.isSubtreeContainingCompatible(n))return!1}return!1}audit(){if(assert)for(let e=0;e<numSummaryBits;e++){const t=summaryBits[e],n=this._counts[e]===0,r=!!(this.bitmask&t);assert(n===r,"Bits should be set if count is zero")}}toString(){let e=RendererSummary.bitmaskToString(this.bitmask);for(let t=0;t<numSummaryBits;t++){const n=summaryBits[t],r=this._counts[t];r!==0&&(e+=` ${RendererSummary.bitToString(n)}:${r}`)}return e}static summaryBitmaskForNodeSelf(e){let t=e._rendererBitmask;e.isPainted()?t|=(e._rendererBitmask&Renderer.bitmaskCurrentRendererArea^Renderer.bitmaskCurrentRendererArea)<<Renderer.bitmaskLacksShift:t|=Renderer.bitmaskCurrentRendererArea<<Renderer.bitmaskLacksShift;const n=e._cssTransform||e._layerSplit,r=e._renderer;return!n&&Renderer.isSVG(e._rendererBitmask)&&(!r||Renderer.isSVG(r))&&(t|=Renderer.bitmaskSingleSVG),!n&&Renderer.isCanvas(e._rendererBitmask)&&(!r||Renderer.isCanvas(r))&&(t|=Renderer.bitmaskSingleCanvas),e.isPainted()||(t|=Renderer.bitmaskNotPainted),e.areSelfBoundsValid()&&(t|=Renderer.bitmaskBoundsValid),!e.hasPDOMContent&&!e.hasPDOMOrder()&&(t|=Renderer.bitmaskNoPDOM),t}static bitToString(e){return e===Renderer.bitmaskCanvas?"Canvas":e===Renderer.bitmaskSVG?"SVG":e===Renderer.bitmaskDOM?"DOM":e===Renderer.bitmaskWebGL?"WebGL":e===Renderer.bitmaskLacksCanvas?"(-Canvas)":e===Renderer.bitmaskLacksSVG?"(-SVG)":e===Renderer.bitmaskLacksDOM?"(-DOM)":e===Renderer.bitmaskLacksWebGL?"(-WebGL)":e===Renderer.bitmaskSingleCanvas?"SingleCanvas":e===Renderer.bitmaskSingleSVG?"SingleSVG":e===Renderer.bitmaskNotPainted?"NotPainted":e===Renderer.bitmaskBoundsValid?"BoundsValid":e===Renderer.bitmaskNoPDOM?"NotAccessible":"?"}static bitmaskToString(e){let t="";for(let n=0;n<numSummaryBits;n++){const r=summaryBits[n];e&r&&(t+=`${RendererSummary.bitToString(r)} `)}return t}}RendererSummary.bitmaskAll=bitmaskAll;scenery.register("RendererSummary",RendererSummary);const RendererSummary$1=RendererSummary;class PDOMDisplaysInfo{constructor(e){this.node=e,this.pdomDisplays=[]}onAddChild(e){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`onAddChild n#${e.id} (parent:n#${this.node.id})`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),e._pdomDisplaysInfo.canHavePDOMDisplays()&&e._pdomDisplaysInfo.addPDOMDisplays(this.pdomDisplays),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}onRemoveChild(e){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`onRemoveChild n#${e.id} (parent:n#${this.node.id})`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),e._pdomDisplaysInfo.canHavePDOMDisplays()&&e._pdomDisplaysInfo.removePDOMDisplays(this.pdomDisplays),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}onSummaryChange(e,t){if(sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`onSummaryChange n#${this.node.id} wasPDOM:${!(Renderer.bitmaskNoPDOM&e)}, isPDOM:${!(Renderer.bitmaskNoPDOM&t)}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),this.node.visible&&this.node.pdomVisible){const n=!(Renderer.bitmaskNoPDOM&e),r=!(Renderer.bitmaskNoPDOM&t);r&&!n&&this.addAllPDOMDisplays(),!r&&n&&this.removeAllPDOMDisplays()}sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}onVisibilityChange(e){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`onVisibilityChange n#${this.node.id} visible:${e}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),this.node.pdomVisible&&!this.node._rendererSummary.hasNoPDOM()&&(e?this.addAllPDOMDisplays():this.removeAllPDOMDisplays()),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}onPDOMVisibilityChange(e){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`onPDOMVisibilityChange n#${this.node.id} pdomVisible:${e}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),this.node.visible&&!this.node._rendererSummary.hasNoPDOM()&&(e?this.addAllPDOMDisplays():this.removeAllPDOMDisplays()),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}onAddedRootedDisplay(e){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`onAddedRootedDisplay n#${this.node.id}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),e._accessible&&this.canHavePDOMDisplays()&&this.addPDOMDisplays([e]),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}onRemovedRootedDisplay(e){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`onRemovedRootedDisplay n#${this.node.id}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),e._accessible&&this.canHavePDOMDisplays()&&this.removePDOMDisplays([e]),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}canHavePDOMDisplays(){return this.node.visible&&this.node.pdomVisible&&!this.node._rendererSummary.hasNoPDOM()}addAllPDOMDisplays(){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`addAllPDOMDisplays n#${this.node.id}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),assert&&assert(this.pdomDisplays.length===0,"Should be empty before adding everything"),assert&&assert(this.canHavePDOMDisplays(),"Should happen when we can store pdomDisplays");let e;const t=[];for(e=0;e<this.node._parents.length;e++)Array.prototype.push.apply(t,this.node._parents[e]._pdomDisplaysInfo.pdomDisplays);for(e=0;e<this.node._rootedDisplays.length;e++){const n=this.node._rootedDisplays[e];n._accessible&&t.push(n)}this.addPDOMDisplays(t),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}removeAllPDOMDisplays(){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`removeAllPDOMDisplays n#${this.node.id}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),assert&&assert(!this.canHavePDOMDisplays(),"Should happen when we cannot store pdomDisplays"),this.removePDOMDisplays(this.pdomDisplays.slice()),assert&&assert(this.pdomDisplays.length===0,"Should be empty after removing everything"),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}addPDOMDisplays(e){if(sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`addPDOMDisplays n#${this.node.id} numDisplays:${e.length}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),assert&&assert(Array.isArray(e)),e.length!==0){Array.prototype.push.apply(this.pdomDisplays,e);for(let t=0;t<this.node._children.length;t++)this.node._children[t]._pdomDisplaysInfo.canHavePDOMDisplays()&&this.node._children[t]._pdomDisplaysInfo.addPDOMDisplays(e);this.node.pdomDisplaysEmitter.emit()}sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}removePDOMDisplays(e){if(sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`removePDOMDisplays n#${this.node.id} numDisplays:${e.length}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),assert&&assert(Array.isArray(e)),assert&&assert(this.pdomDisplays.length>=e.length,"there should be at least as many PDOMDisplays as Displays"),e.length!==0){let t;for(t=e.length-1;t>=0;t--){const n=this.pdomDisplays.lastIndexOf(e[t]);assert&&assert(n>=0),this.pdomDisplays.splice(t,1)}for(t=0;t<this.node._children.length;t++){const n=this.node._children[t];n._pdomDisplaysInfo.canHavePDOMDisplays()&&!n._isGettingRemovedFromParent&&n._pdomDisplaysInfo.removePDOMDisplays(e)}this.node.pdomDisplaysEmitter.emit()}sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}}scenery.register("PDOMDisplaysInfo",PDOMDisplaysInfo);const CHANGE_POSITION_THRESHOLD$2=1e-9,WIDTH_SIZABLE_OPTION_KEYS=["preferredWidth","minimumWidth","localPreferredWidth","localMinimumWidth","widthSizable"],WidthSizable=memoize(o=>{const e=DelayedMutate$1("WidthSizable",WIDTH_SIZABLE_OPTION_KEYS,class extends o{constructor(...n){super(...n),this.preferredWidthProperty=new TinyProperty(null),this.minimumWidthProperty=new TinyProperty(null),this.localPreferredWidthProperty=new TinyProperty(null),this.localMinimumWidthProperty=new TinyProperty(null),this.isWidthResizableProperty=new TinyProperty(!0),this._preferredSizeChanging=!1,this._minimumSizeChanging=!1,this._preferredSizeChangeAttemptDuringLock=!1,this._minimumSizeChangeAttemptDuringLock=!1,this._updatePreferredWidthListener=this._updatePreferredWidth.bind(this),this._updateLocalPreferredWidthListener=this._updateLocalPreferredWidth.bind(this),this._updateMinimumWidthListener=this._updateMinimumWidth.bind(this),this._updateLocalMinimumWidthListener=this._updateLocalMinimumWidth.bind(this),this.preferredWidthProperty.lazyLink(this._updateLocalPreferredWidthListener),this.localPreferredWidthProperty.lazyLink(this._updatePreferredWidthListener),this.minimumWidthProperty.lazyLink(this._updateLocalMinimumWidthListener),this.localMinimumWidthProperty.lazyLink(this._updateMinimumWidthListener),this.transformEmitter.addListener(this._updateLocalPreferredWidthListener),this.transformEmitter.addListener(this._updateMinimumWidthListener)}get preferredWidth(){return assert&&assert(this.preferredWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),this.preferredWidthProperty.value}set preferredWidth(n){assert&&assert(this.preferredWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(n===null||typeof n=="number"&&isFinite(n)&&n>=0,"preferredWidth should be null or a non-negative finite number"),this.preferredWidthProperty.value=n}get localPreferredWidth(){return assert&&assert(this.localPreferredWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),this.localPreferredWidthProperty.value}set localPreferredWidth(n){assert&&assert(this.localPreferredWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(n===null||typeof n=="number"&&isFinite(n)&&n>=0,"localPreferredWidth should be null or a non-negative finite number"),this.localPreferredWidthProperty.value=n}get minimumWidth(){return assert&&assert(this.minimumWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),this.minimumWidthProperty.value}set minimumWidth(n){assert&&assert(this.minimumWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(n===null||typeof n=="number"&&isFinite(n)),this.minimumWidthProperty.value=n}get localMinimumWidth(){return assert&&assert(this.localMinimumWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),this.localMinimumWidthProperty.value}set localMinimumWidth(n){assert&&assert(this.localMinimumWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(n===null||typeof n=="number"&&isFinite(n)),this.localMinimumWidthProperty.value=n}get widthSizable(){return assert&&assert(this.isWidthResizableProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),this.isWidthResizableProperty.value}set widthSizable(n){assert&&assert(this.isWidthResizableProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),this.isWidthResizableProperty.value=n}get extendsWidthSizable(){return!0}validateLocalPreferredWidth(){if(assert){const n=this.localWidth,r=this.localMinimumWidth===null?n:this.localMinimumWidth,s=this.localPreferredWidth===null?r:this.localPreferredWidth;assert(s===n||Math.abs(s-n)<1e-7)}}_calculateLocalPreferredWidth(){return this.matrix.isAligned()&&this.preferredWidth!==null?Math.abs(this.transform.inverseDeltaX(this.preferredWidth)):null}_onReentrantPreferredWidth(){this._updateLocalPreferredWidthListener()}_updateLocalPreferredWidth(){if(assert&&this.auditMaxDimensions(),this._preferredSizeChanging)this._preferredSizeChangeAttemptDuringLock=!0;else{this._preferredSizeChanging=!0;do{this._preferredSizeChangeAttemptDuringLock=!1;const n=this._calculateLocalPreferredWidth();(this.localPreferredWidthProperty.value===null||n===null||Math.abs(this.localPreferredWidthProperty.value-n)>CHANGE_POSITION_THRESHOLD$2)&&(this.localPreferredWidthProperty.value=n)}while(this._preferredSizeChangeAttemptDuringLock);this._preferredSizeChanging=!1}}_calculatePreferredWidth(){return this.matrix.isAligned()&&this.localPreferredWidth!==null?Math.abs(this.transform.transformDeltaX(this.localPreferredWidth)):null}_updatePreferredWidth(){if(this._preferredSizeChanging)this._preferredSizeChangeAttemptDuringLock=!0;else{this._preferredSizeChanging=!0,this._preferredSizeChangeAttemptDuringLock=!1;const n=this._calculatePreferredWidth();(this.preferredWidthProperty.value===null||n===null||Math.abs(this.preferredWidthProperty.value-n)>CHANGE_POSITION_THRESHOLD$2)&&(this.preferredWidthProperty.value=n),this._preferredSizeChanging=!1,this._preferredSizeChangeAttemptDuringLock&&this._onReentrantPreferredWidth()}}_calculateLocalMinimumWidth(){return this.matrix.isAligned()&&this.minimumWidth!==null?Math.abs(this.transform.inverseDeltaX(this.minimumWidth)):null}_onReentrantLocalMinimumWidth(){this._updateMinimumWidthListener()}_updateLocalMinimumWidth(){if(this._minimumSizeChanging)this._minimumSizeChangeAttemptDuringLock=!0;else{this._minimumSizeChanging=!0;const n=this._calculateLocalMinimumWidth();this._minimumSizeChangeAttemptDuringLock=!1,(this.localMinimumWidthProperty.value===null||n===null||Math.abs(this.localMinimumWidthProperty.value-n)>CHANGE_POSITION_THRESHOLD$2)&&(this.localMinimumWidthProperty.value=n),this._minimumSizeChanging=!1,this._minimumSizeChangeAttemptDuringLock&&this._onReentrantLocalMinimumWidth()}}_calculateMinimumWidth(){return this.matrix.isAligned()&&this.localMinimumWidth!==null?Math.abs(this.transform.transformDeltaX(this.localMinimumWidth)):null}_updateMinimumWidth(){if(this._minimumSizeChanging)this._minimumSizeChangeAttemptDuringLock=!0;else{this._minimumSizeChanging=!0;do{this._minimumSizeChangeAttemptDuringLock=!1;const n=this._calculateMinimumWidth();(this.minimumWidthProperty.value===null||n===null||Math.abs(this.minimumWidthProperty.value-n)>CHANGE_POSITION_THRESHOLD$2)&&(this.minimumWidthProperty.value=n)}while(this._minimumSizeChangeAttemptDuringLock);this._minimumSizeChanging=!1}}mutate(n){return super.mutate(n)}});if(e.prototype._mutatorKeys){const t=e.prototype._mutatorKeys,n=WIDTH_SIZABLE_OPTION_KEYS,r=t.indexOf(REQUIRES_BOUNDS_OPTION_KEYS[0]);e.prototype._mutatorKeys=[...t.slice(0,r),...n,...t.slice(r)]}return e}),isWidthSizable=o=>o.widthSizable,extendsWidthSizable=o=>o.extendsWidthSizable;scenery.register("WidthSizable",WidthSizable);const CHANGE_POSITION_THRESHOLD$1=1e-9,HEIGHT_SIZABLE_OPTION_KEYS=["preferredHeight","minimumHeight","localPreferredHeight","localMinimumHeight","heightSizable"],HeightSizable=memoize(o=>{const e=DelayedMutate$1("HeightSizable",HEIGHT_SIZABLE_OPTION_KEYS,class extends o{constructor(...n){super(...n),this.preferredHeightProperty=new TinyProperty(null),this.minimumHeightProperty=new TinyProperty(null),this.localPreferredHeightProperty=new TinyProperty(null),this.localMinimumHeightProperty=new TinyProperty(null),this.isHeightResizableProperty=new TinyProperty(!0),this._preferredSizeChanging=!1,this._minimumSizeChanging=!1,this._preferredSizeChangeAttemptDuringLock=!1,this._minimumSizeChangeAttemptDuringLock=!1,this._updatePreferredHeightListener=this._updatePreferredHeight.bind(this),this._updateLocalPreferredHeightListener=this._updateLocalPreferredHeight.bind(this),this._updateMinimumHeightListener=this._updateMinimumHeight.bind(this),this._updateLocalMinimumHeightListener=this._updateLocalMinimumHeight.bind(this),this.preferredHeightProperty.lazyLink(this._updateLocalPreferredHeightListener),this.localPreferredHeightProperty.lazyLink(this._updatePreferredHeightListener),this.minimumHeightProperty.lazyLink(this._updateLocalMinimumHeightListener),this.localMinimumHeightProperty.lazyLink(this._updateMinimumHeightListener),this.transformEmitter.addListener(this._updateLocalPreferredHeightListener),this.transformEmitter.addListener(this._updateMinimumHeightListener)}get preferredHeight(){return assert&&assert(this.preferredHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),this.preferredHeightProperty.value}set preferredHeight(n){assert&&assert(this.preferredHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(n===null||typeof n=="number"&&isFinite(n)&&n>=0,"preferredHeight should be null or a non-negative finite number"),this.preferredHeightProperty.value=n}get localPreferredHeight(){return assert&&assert(this.localPreferredHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),this.localPreferredHeightProperty.value}set localPreferredHeight(n){assert&&assert(this.localPreferredHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(n===null||typeof n=="number"&&isFinite(n)&&n>=0,"localPreferredHeight should be null or a non-negative finite number"),this.localPreferredHeightProperty.value=n}get minimumHeight(){return assert&&assert(this.minimumHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),this.minimumHeightProperty.value}set minimumHeight(n){assert&&assert(this.minimumHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(n===null||typeof n=="number"&&isFinite(n)),this.minimumHeightProperty.value=n}get localMinimumHeight(){return assert&&assert(this.localMinimumHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),this.localMinimumHeightProperty.value}set localMinimumHeight(n){assert&&assert(this.localMinimumHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(n===null||typeof n=="number"&&isFinite(n)),this.localMinimumHeightProperty.value=n}get heightSizable(){return assert&&assert(this.isHeightResizableProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),this.isHeightResizableProperty.value}set heightSizable(n){assert&&assert(this.isHeightResizableProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),this.isHeightResizableProperty.value=n}get extendsHeightSizable(){return!0}validateLocalPreferredHeight(){if(assert){const n=this.localHeight,r=this.localMinimumHeight===null?n:this.localMinimumHeight,s=this.localPreferredHeight===null?r:this.localPreferredHeight;assert(s===n||Math.abs(s-n)<1e-7)}}_calculateLocalPreferredHeight(){return this.matrix.isAligned()&&this.preferredHeight!==null?Math.abs(this.transform.inverseDeltaY(this.preferredHeight)):null}_onReentrantPreferredHeight(){this._updateLocalPreferredHeightListener()}_updateLocalPreferredHeight(){if(assert&&this.auditMaxDimensions(),this._preferredSizeChanging)this._preferredSizeChangeAttemptDuringLock=!0;else{this._preferredSizeChanging=!0;do{this._preferredSizeChangeAttemptDuringLock=!1;const n=this._calculateLocalPreferredHeight();(this.localPreferredHeightProperty.value===null||n===null||Math.abs(this.localPreferredHeightProperty.value-n)>CHANGE_POSITION_THRESHOLD$1)&&(this.localPreferredHeightProperty.value=n)}while(this._preferredSizeChangeAttemptDuringLock);this._preferredSizeChanging=!1}}_calculatePreferredHeight(){return this.matrix.isAligned()&&this.localPreferredHeight!==null?Math.abs(this.transform.transformDeltaY(this.localPreferredHeight)):null}_updatePreferredHeight(){if(this._preferredSizeChanging)this._preferredSizeChangeAttemptDuringLock=!0;else{this._preferredSizeChanging=!0,this._preferredSizeChangeAttemptDuringLock=!1;const n=this._calculatePreferredHeight();(this.preferredHeightProperty.value===null||n===null||Math.abs(this.preferredHeightProperty.value-n)>CHANGE_POSITION_THRESHOLD$1)&&(this.preferredHeightProperty.value=n),this._preferredSizeChanging=!1,this._preferredSizeChangeAttemptDuringLock&&this._onReentrantPreferredHeight()}}_calculateLocalMinimumHeight(){return this.matrix.isAligned()&&this.minimumHeight!==null?Math.abs(this.transform.inverseDeltaY(this.minimumHeight)):null}_onReentrantLocalMinimumHeight(){this._updateMinimumHeight()}_updateLocalMinimumHeight(){if(this._minimumSizeChanging)this._minimumSizeChangeAttemptDuringLock=!0;else{this._minimumSizeChanging=!0,this._minimumSizeChangeAttemptDuringLock=!1;const n=this._calculateLocalMinimumHeight();(this.localMinimumHeightProperty.value===null||n===null||Math.abs(this.localMinimumHeightProperty.value-n)>CHANGE_POSITION_THRESHOLD$1)&&(this.localMinimumHeightProperty.value=n),this._minimumSizeChanging=!1,this._minimumSizeChangeAttemptDuringLock&&this._onReentrantLocalMinimumHeight()}}_calculateMinimumHeight(){return this.matrix.isAligned()&&this.localMinimumHeight!==null?Math.abs(this.transform.transformDeltaY(this.localMinimumHeight)):null}_updateMinimumHeight(){if(!this._minimumSizeChanging){this._minimumSizeChanging=!0;do{this._minimumSizeChangeAttemptDuringLock=!1;const n=this._calculateMinimumHeight();(this.minimumHeightProperty.value===null||n===null||Math.abs(this.minimumHeightProperty.value-n)>CHANGE_POSITION_THRESHOLD$1)&&(this.minimumHeightProperty.value=n)}while(this._minimumSizeChangeAttemptDuringLock);this._minimumSizeChanging=!1}}mutate(n){return super.mutate(n)}});if(e.prototype._mutatorKeys){const t=e.prototype._mutatorKeys,n=HEIGHT_SIZABLE_OPTION_KEYS,r=t.indexOf(REQUIRES_BOUNDS_OPTION_KEYS[0]);e.prototype._mutatorKeys=[...t.slice(0,r),...n,...t.slice(r)]}return e}),isHeightSizable=o=>o.heightSizable,extendsHeightSizable=o=>o.extendsHeightSizable;scenery.register("HeightSizable",HeightSizable);const SIZABLE_SELF_OPTION_KEYS=["preferredSize","minimumSize","localPreferredSize","localMinimumSize","sizable"],SIZABLE_OPTION_KEYS=["preferredSize","minimumSize","localPreferredSize","localMinimumSize","sizable",...WIDTH_SIZABLE_OPTION_KEYS,...HEIGHT_SIZABLE_OPTION_KEYS],Sizable=memoize(o=>{const e=WidthSizable(HeightSizable(o)),t=DelayedMutate$1("Sizable",SIZABLE_SELF_OPTION_KEYS,class extends e{constructor(...r){super(...r),this.preferredWidthProperty.lazyLink(this._updateLocalPreferredHeightListener),this.preferredHeightProperty.lazyLink(this._updateLocalPreferredWidthListener),this.localPreferredWidthProperty.lazyLink(this._updatePreferredHeightListener),this.localPreferredHeightProperty.lazyLink(this._updatePreferredWidthListener),this.minimumWidthProperty.lazyLink(this._updateLocalMinimumHeightListener),this.minimumHeightProperty.lazyLink(this._updateLocalMinimumWidthListener),this.localMinimumWidthProperty.lazyLink(this._updateMinimumHeightListener),this.localMinimumHeightProperty.lazyLink(this._updateMinimumWidthListener)}get preferredSize(){return assert&&assert(this.preferredWidth===null==(this.preferredHeight===null),"Cannot get a preferredSize when one of preferredWidth/preferredHeight is null"),this.preferredWidth===null||this.preferredHeight===null?null:new Dimension2(this.preferredWidth,this.preferredHeight)}set preferredSize(r){this.preferredWidth=r===null?null:r.width,this.preferredHeight=r===null?null:r.height}get localPreferredSize(){return assert&&assert(this.localPreferredWidth===null==(this.localPreferredHeight===null),"Cannot get a preferredSize when one of preferredWidth/preferredHeight is null"),this.localPreferredWidth===null||this.localPreferredHeight===null?null:new Dimension2(this.localPreferredWidth,this.localPreferredHeight)}set localPreferredSize(r){this.localPreferredWidth=r===null?null:r.width,this.localPreferredHeight=r===null?null:r.height}get minimumSize(){return assert&&assert(this.minimumWidth===null==(this.minimumHeight===null),"Cannot get a minimumSize when one of minimumWidth/minimumHeight is null"),this.minimumWidth===null||this.minimumHeight===null?null:new Dimension2(this.minimumWidth,this.minimumHeight)}set minimumSize(r){this.minimumWidth=r===null?null:r.width,this.minimumHeight=r===null?null:r.height}get localMinimumSize(){return assert&&assert(this.localMinimumWidth===null==(this.localMinimumHeight===null),"Cannot get a minimumSize when one of minimumWidth/minimumHeight is null"),this.localMinimumWidth===null||this.localMinimumHeight===null?null:new Dimension2(this.localMinimumWidth,this.localMinimumHeight)}set localMinimumSize(r){this.localMinimumWidth=r===null?null:r.width,this.localMinimumHeight=r===null?null:r.height}get sizable(){return assert&&assert(this.widthSizable===this.heightSizable,"widthSizable and heightSizable not the same, which is required for the sizable getter"),this.widthSizable}set sizable(r){this.widthSizable=r,this.heightSizable=r}get extendsSizable(){return!0}validateLocalPreferredSize(){assert&&(this.validateLocalPreferredWidth(),this.validateLocalPreferredHeight())}mutate(r){return assertMutuallyExclusiveOptions(r,["preferredSize"],["preferredWidth","preferredHeight"]),assertMutuallyExclusiveOptions(r,["localPreferredSize"],["localPreferredWidth","localPreferredHeight"]),assertMutuallyExclusiveOptions(r,["minimumSize"],["minimumWidth","minimumHeight"]),assertMutuallyExclusiveOptions(r,["localMinimumSize"],["localMinimumWidth","localMinimumHeight"]),assertMutuallyExclusiveOptions(r,["sizable"],["widthSizable","heightSizable"]),super.mutate(r)}_calculateLocalPreferredWidth(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.preferredWidth!==null)return Math.abs(this.transform.inverseDeltaX(this.preferredWidth))}else if(this.preferredHeight!==null)return Math.abs(this.transform.getInverse().m01()*this.preferredHeight)}return null}_calculateLocalPreferredHeight(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.preferredHeight!==null)return Math.abs(this.transform.inverseDeltaY(this.preferredHeight))}else if(this.preferredWidth!==null)return Math.abs(this.transform.getInverse().m10()*this.preferredWidth)}return null}_calculatePreferredWidth(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.localPreferredWidth!==null)return Math.abs(this.transform.transformDeltaX(this.localPreferredWidth))}else if(this.localPreferredHeight!==null)return Math.abs(this.transform.matrix.m01()*this.localPreferredHeight)}return null}_calculatePreferredHeight(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.localPreferredHeight!==null)return Math.abs(this.transform.transformDeltaY(this.localPreferredHeight))}else if(this.localPreferredWidth!==null)return Math.abs(this.transform.matrix.m10()*this.localPreferredWidth)}return null}_onReentrantLocalMinimumWidth(){this._updateMinimumWidthListener(),this._updateMinimumHeightListener()}_onReentrantLocalMinimumHeight(){this._updateMinimumWidthListener(),this._updateMinimumHeightListener()}_onReentrantPreferredWidth(){this._updateLocalPreferredWidthListener(),this._updateLocalPreferredHeightListener()}_onReentrantPreferredHeight(){this._updateLocalPreferredWidthListener(),this._updateLocalPreferredHeightListener()}_calculateLocalMinimumWidth(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.minimumWidth!==null)return Math.abs(this.transform.inverseDeltaX(this.minimumWidth))}else if(this.minimumHeight!==null)return Math.abs(this.transform.getInverse().m01()*this.minimumHeight)}return null}_calculateLocalMinimumHeight(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.minimumHeight!==null)return Math.abs(this.transform.inverseDeltaY(this.minimumHeight))}else if(this.minimumWidth!==null)return Math.abs(this.transform.getInverse().m10()*this.minimumWidth)}return null}_calculateMinimumWidth(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.localMinimumWidth!==null)return Math.abs(this.transform.transformDeltaX(this.localMinimumWidth))}else if(this.localMinimumHeight!==null)return Math.abs(this.transform.matrix.m01()*this.localMinimumHeight)}return null}_calculateMinimumHeight(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.localMinimumHeight!==null)return Math.abs(this.transform.transformDeltaY(this.localMinimumHeight))}else if(this.localMinimumWidth!==null)return Math.abs(this.transform.matrix.m10()*this.localMinimumWidth)}return null}});if(t.prototype._mutatorKeys){const n=t.prototype._mutatorKeys,r=SIZABLE_SELF_OPTION_KEYS,s=n.indexOf(REQUIRES_BOUNDS_OPTION_KEYS[0]);t.prototype._mutatorKeys=[...n.slice(0,s),...r,...n.slice(s)]}return t});scenery.register("Sizable",Sizable);const ID_SEPARATOR=PDOMUtils$1.PDOM_UNIQUE_ID_SEPARATOR;class Trail{constructor(e){if(assert&&(this.immutable=void 0),e instanceof Trail){const t=e;this.nodes=t.nodes.slice(0),this.length=t.length,this.uniqueId=t.uniqueId,this.indices=t.indices.slice(0);return}if(this.nodes=[],this.length=0,this.uniqueId="",this.indices=[],e)if(e instanceof Node$2){const t=e;this.addDescendant(t)}else{const t=e.length;for(let n=0;n<t;n++)this.addDescendant(e[n])}}copy(){return new Trail(this)}isPainted(){return this.lastNode().isPainted()}isValid(){this.reindex();const e=this.indices.length;for(let t=0;t<e;t++)if(this.indices[t]<0)return!1;return!0}isVisible(){let e=this.nodes.length;for(;e--;)if(!this.nodes[e].isVisible())return!1;return!0}isPDOMVisible(){let e=this.nodes.length;for(;e--;)if(!this.nodes[e].isVisible()||!this.nodes[e].isPDOMVisible())return!1;return!0}getOpacity(){let e=1,t=this.nodes.length;for(;t--;)e*=this.nodes[t].getOpacity();return e}isPickable(){return _.some(this.nodes,e=>e.pickable===!1||!e.visible)?!1:!!_.some(this.nodes,e=>e._inputListeners.length>0||e.pickableProperty.value===!0)}get(e){return e>=0?this.nodes[e]:this.nodes[this.nodes.length+e]}slice(e,t){return new Trail(this.nodes.slice(e,t))}subtrailTo(e,t=!1){return this.slice(0,_.indexOf(this.nodes,e)+(t?0:1))}isEmpty(){return this.nodes.length===0}getMatrixConcatenation(e,t){const n=Matrix3.identity(),r=this.nodes;for(let s=e;s<t;s++)n.multiplyMatrix(r[s].getMatrix());return n}getMatrix(){return this.getMatrixConcatenation(0,this.nodes.length)}getAncestorMatrix(){return this.getMatrixConcatenation(1,this.nodes.length)}getParentMatrix(){return this.getMatrixConcatenation(0,this.nodes.length-1)}getAncestorParentMatrix(){return this.getMatrixConcatenation(1,this.nodes.length-1)}getTransform(){return new Transform3(this.getMatrix())}getParentTransform(){return new Transform3(this.getParentMatrix())}addAncestor(e,t){if(assert&&assert(!this.immutable,"cannot modify an immutable Trail with addAncestor"),assert&&assert(e,"cannot add falsy value to a Trail"),this.nodes.length){const n=this.nodes[0];this.indices.unshift(t===void 0?_.indexOf(e._children,n):t)}return this.nodes.unshift(e),this.length++,this.uniqueId=this.uniqueId?e.id+ID_SEPARATOR+this.uniqueId:`${e.id}`,this}removeAncestor(){return assert&&assert(!this.immutable,"cannot modify an immutable Trail with removeAncestor"),assert&&assert(this.length>0,"cannot remove a Node from an empty trail"),this.nodes.shift(),this.indices.length&&this.indices.shift(),this.length--,this.updateUniqueId(),this}addDescendant(e,t){if(assert&&assert(!this.immutable,"cannot modify an immutable Trail with addDescendant"),assert&&assert(e,"cannot add falsy value to a Trail"),this.nodes.length){const n=this.lastNode();this.indices.push(t===void 0?_.indexOf(n._children,e):t)}return this.nodes.push(e),this.length++,this.uniqueId=this.uniqueId?this.uniqueId+ID_SEPARATOR+e.id:`${e.id}`,this}removeDescendant(){return assert&&assert(!this.immutable,"cannot modify an immutable Trail with removeDescendant"),assert&&assert(this.length>0,"cannot remove a Node from an empty trail"),this.nodes.pop(),this.indices.length&&this.indices.pop(),this.length--,this.updateUniqueId(),this}addDescendantTrail(e){const t=e.length;t&&this.addDescendant(e.nodes[0]);for(let n=1;n<t;n++)this.addDescendant(e.nodes[n],this.indices[n-1])}removeDescendantTrail(e){const t=e.length;for(let n=t-1;n>=0;n--)assert&&assert(this.lastNode()===e.nodes[n]),this.removeDescendant()}reindex(){const e=this.length;for(let t=1;t<e;t++){const n=this.indices[t-1],r=this.nodes[t-1];r._children[n]!==this.nodes[t]&&(this.indices[t-1]=_.indexOf(r._children,this.nodes[t]))}}setImmutable(){return assert&&(assert(this.immutable!==!1,"A trail cannot be made immutable after being flagged as mutable"),this.immutable=!0),this}setMutable(){return assert&&(assert(this.immutable!==!0,"A trail cannot be made mutable after being flagged as immutable"),this.immutable=!1),this}areIndicesValid(){for(let e=1;e<this.length;e++){const t=this.indices[e-1];if(this.nodes[e-1]._children[t]!==this.nodes[e])return!1}return!0}equals(e){if(this.length!==e.length)return!1;for(let t=0;t<this.nodes.length;t++)if(this.nodes[t]!==e.nodes[t])return!1;return!0}upToNode(e){const t=_.indexOf(this.nodes,e);return assert&&assert(t>=0,"Trail does not contain the node"),this.slice(0,_.indexOf(this.nodes,e)+1)}isExtensionOf(e,t){if(this.length<=e.length-(t?1:0))return!1;for(let n=0;n<e.nodes.length;n++)if(this.nodes[n]!==e.nodes[n])return!1;return!0}containsNode(e){return _.includes(this.nodes,e)}getTransformTo(e){return new Transform3(this.getMatrixTo(e))}getMatrixTo(e){this.reindex(),e.reindex();const t=this.getBranchIndexTo(e);let n,r=Matrix3.IDENTITY;for(n=this.length-1;n>=t;n--)r=this.nodes[n].getMatrix().timesMatrix(r);for(n=t;n<e.length;n++)r=e.nodes[n].getTransform().getInverse().timesMatrix(r);return r}getBranchIndexTo(e){assert&&assert(this.nodes[0]===e.nodes[0],"To get a branch index, the trails must have the same root");let t;const n=Math.min(this.length,e.length);for(t=0;t<n&&this.nodes[t]===e.nodes[t];t++);return t}getLastInputEnabledIndex(){let e=-1;for(let t=0;t<this.length&&this.nodes[t].inputEnabled;t++)e=t;return e}getCursorCheckIndex(){return this.getLastInputEnabledIndex()}nodeFromTop(e){return this.nodes[this.length-1-e]}lastNode(){return this.nodeFromTop(0)}rootNode(){return this.nodes[0]}previous(){if(this.nodes.length<=1)return null;const e=this.nodeFromTop(0),t=this.nodeFromTop(1),n=_.indexOf(t._children,e);assert&&assert(n!==-1);const r=this.nodes.slice(0,this.nodes.length-1);if(n===0)return new Trail(r);for(r.push(t._children[n-1]);r[r.length-1]._children.length!==0;){const s=r[r.length-1];r.push(s._children[s._children.length-1])}return new Trail(r)}previousPainted(){let e=this.previous();for(;e&&!e.isPainted();)e=e.previous();return e}next(){const e=this.nodes.slice(0),t=this.nodeFromTop(0);if(t._children.length>0)return e.push(t._children[0]),new Trail(e);{let n=this.nodes.length-1;for(;n>0;){const r=this.nodes[n],s=this.nodes[n-1];e.pop();const a=_.indexOf(s._children,r);if(a!==s._children.length-1)return e.push(s._children[a+1]),new Trail(e);n--}return null}}nextPainted(){let e=this.next();for(;e&&!e.isPainted();)e=e.next();return e}eachTrailUnder(e){new TrailPointer(this,!0).eachTrailBetween(new TrailPointer(this,!1),e)}compare(e){assert&&assert(!this.isEmpty(),"cannot compare with an empty trail"),assert&&assert(!e.isEmpty(),"cannot compare with an empty trail"),assert&&assert(this.nodes[0]===e.nodes[0],"for Trail comparison, trails must have the same root node"),assertSlow&&assertSlow(this.areIndicesValid(),`Trail.compare this.areIndicesValid() failed on ${this.toString()}`),assertSlow&&assertSlow(e.areIndicesValid(),`Trail.compare other.areIndicesValid() failed on ${e.toString()}`);const t=Math.min(this.nodes.length,e.nodes.length);for(let n=0;n<t;n++)if(this.nodes[n]!==e.nodes[n])return this.nodes[n-1].children.indexOf(this.nodes[n])<e.nodes[n-1].children.indexOf(e.nodes[n])?-1:1;return this.nodes.length<e.nodes.length?-1:this.nodes.length>e.nodes.length?1:0}isBefore(e){return this.compare(e)===-1}isAfter(e){return this.compare(e)===1}localToGlobalPoint(e){return this.getMatrix().timesVector2(e)}localToGlobalBounds(e){return e.transformed(this.getMatrix())}globalToLocalPoint(e){return this.getTransform().inversePosition2(e)}globalToLocalBounds(e){return this.getTransform().inverseBounds2(e)}parentToGlobalPoint(e){return this.getParentMatrix().timesVector2(e)}parentToGlobalBounds(e){return e.transformed(this.getParentMatrix())}globalToParentPoint(e){return this.getParentTransform().inversePosition2(e)}globalToParentBounds(e){return this.getParentTransform().inverseBounds2(e)}updateUniqueId(){let e="";const t=this.nodes.length;t>0&&(e+=this.nodes[0]._id);for(let n=1;n<t;n++)e+=ID_SEPARATOR+this.nodes[n]._id;this.uniqueId=e}getUniqueId(){if(assert){const e=this.uniqueId;this.updateUniqueId(),assert(e===this.uniqueId)}return this.uniqueId}toString(){return this.reindex(),this.length?`[Trail ${this.indices.join(".")} ${this.getUniqueId()}]`:"Empty Trail"}toPathString(){return _.map(this.nodes,e=>{let t=e.constructor.name;return t==="Node"&&(t="."),t}).join("/")}toDebugString(){return`${this.toString()} ${this.toPathString()}`}static eachPaintedTrailBetween(e,t,n,r,s){Trail.eachTrailBetween(e,t,a=>a.isPainted()?n(a):!1,r,s)}static eachTrailBetween(e,t,n,r,s){const a=e?new TrailPointer(e.copy(),!0):new TrailPointer(new Trail(s),!0),l=t?new TrailPointer(t.copy(),!0):new TrailPointer(new Trail(s),!1);r&&(a.nestedForwards(),l.nestedBackwards(),a.compareNested(l)===1)||a.depthFirstUntil(l,d=>d.isBefore?n(d.trail):!1,!1)}static branchIndex(e,t){assert&&assert(e.nodes[0]===t.nodes[0],"Branch changes require roots to be the same");let n;const r=Math.min(e.length,t.length);for(n=0;n<r&&e.nodes[n]===t.nodes[n];n++);return n}static sharedTrail(e,t){return e.slice(0,Trail.branchIndex(e,t))}static appendAncestorTrailsWithPredicate(e,t,n){const r=t.rootNode();n(r)&&e.push(t.copy());const s=r._parents.length;for(let a=0;a<s;a++){const l=r._parents[a];t.addAncestor(l),Trail.appendAncestorTrailsWithPredicate(e,t,n),t.removeAncestor()}}static appendDescendantTrailsWithPredicate(e,t,n){const r=t.lastNode();n(r)&&e.push(t.copy());const s=r._children.length;for(let a=0;a<s;a++){const l=r._children[a];t.addDescendant(l,a),Trail.appendDescendantTrailsWithPredicate(e,t,n),t.removeDescendant()}}static spannedSubtrees(e,t){}static fromUniqueId(e,t){const r=t.split(ID_SEPARATOR).map(d=>Number(d));let s=e;const a=r.shift(),l=[s];for(assert&&assert(a===e.id);r.length>0;){const d=r.shift(),y=(s.pdomOrder||[]).concat(s.children);for(let m=0;m<y.length;m++){if(y[m]!==null&&y[m].id===d){const O=y[m];l.push(O),s=O;break}assert&&assert(m!==y.length-1,"unable to find node from unique Trail id")}}return new Trail(l)}}scenery.register("Trail",Trail);class TrailPointer{constructor(e,t){this.trail=e,this.setBefore(t)}isActive(){return!!this.trail}copy(){return assert&&assert(this.isActive()),new TrailPointer(this.trail.copy(),this.isBefore)}setBefore(e){this.isBefore=e,this.isAfter=!e}getRenderSwappedPointer(){assert&&assert(this.isActive());const e=this,t=this.isBefore?e.trail.previous():e.trail.next();return t===null?null:new TrailPointer(t,!this.isBefore)}getRenderBeforePointer(){return this.isBefore?this:this.getRenderSwappedPointer()}getRenderAfterPointer(){return this.isAfter?this:this.getRenderSwappedPointer()}compareRender(e){assert&&assert(e!==null);const t=this.getRenderBeforePointer(),n=e.getRenderBeforePointer();return t!==null&&n!==null?(assert&&assert(t.isActive()&&n.isActive()),t.trail.compare(n.trail)):t===n?0:t===null?1:-1}compareNested(e){assert&&assert(e),assert&&assert(this.isActive()&&e.isActive());const t=this,n=e,r=t.trail.compare(n.trail);return r===0?this.isBefore===e.isBefore?0:this.isBefore?-1:1:t.trail.isExtensionOf(n.trail)?e.isBefore?1:-1:n.trail.isExtensionOf(t.trail)?this.isBefore?-1:1:r}equalsRender(e){return this.compareRender(e)===0}equalsNested(e){return this.compareNested(e)===0}hasTrail(){return!!this.trail}nestedForwards(){assert&&assert(this.isActive());const e=this;if(this.isBefore){const t=e.trail.lastNode()._children;t.length>0?e.trail.addDescendant(t[0],0):this.setBefore(!1)}else{if(e.trail.indices.length===0)return this.trail=null,null;{const t=e.trail.indices[e.trail.indices.length-1];e.trail.removeDescendant();const n=e.trail.lastNode()._children;n.length>t+1&&(e.trail.addDescendant(n[t+1],t+1),this.setBefore(!0))}}return this}nestedBackwards(){assert&&assert(this.isActive());const e=this;if(this.isBefore){if(e.trail.indices.length===0)return this.trail=null,null;{const t=e.trail.indices[e.trail.indices.length-1];e.trail.removeDescendant(),t-1>=0&&(e.trail.addDescendant(e.trail.lastNode()._children[t-1],t-1),this.setBefore(!1))}}else if(e.trail.lastNode()._children.length>0){const t=e.trail.lastNode()._children;e.trail.addDescendant(t[t.length-1],t.length-1)}else this.setBefore(!0);return this}eachNodeBetween(e,t){this.eachTrailBetween(e,n=>t(n.lastNode()))}eachTrailBetween(e,t){this.isBefore&&(assert&&assert(this.isActive()),t(this.trail)),this.depthFirstUntil(e,n=>n.isBefore?t(n.trail):!1,!0)}depthFirstUntil(e,t,n){assert&&assert(this.isActive()&&e.isActive());const r=this,s=e;assert&&assert(this.compareNested(e)<=(n?-1:0),"TrailPointer.depthFirstUntil pointers out of order, possibly in both meanings of the phrase!"),assert&&assert(r.trail.rootNode()===s.trail.rootNode(),"TrailPointer.depthFirstUntil takes pointers with the same root"),r.trail.reindex(),s.trail.reindex();const a=this.copy();a.trail.setMutable();let l=!0;for(;!a.equalsNested(e);){assert&&assert(a.compareNested(e)!==1,"skipped in depthFirstUntil");let d=!1;if(l?(n||(d=t(a)),l=!1):d=t(a),d&&a.isBefore){if(a.setBefore(!1),a.compareNested(e)===1)break}else a.nestedForwards()}n||t(a)}toString(){return assert&&assert(this.isActive()),`[${this.isBefore?"before":"after"} ${this.trail.toString().slice(1)}`}static compareNested(e,t,n,r){const s=e.compare(n);return s===0?t===r?0:t?-1:1:e.isExtensionOf(n)?r?1:-1:n.isExtensionOf(e)?t?-1:1:s}}scenery.register("TrailPointer",TrailPointer);class AncestorNodesProperty extends TinyProperty{constructor(e){super(new Set),this.node=e,this.listenedNodeSet=new Set,this.updateEmitter=new TinyEmitter,this._nodeUpdateListener=this.update.bind(this),this.addNodeListener(e),this.update()}areValuesEqual(e,t){return e.size===t.size&&_.every([...e],n=>t.has(n))}update(){const e=new Set;(function t(n){n.parents.forEach(s=>{e.add(s),t(s)})})(this.node),e.forEach(t=>{this.listenedNodeSet.has(t)||this.addNodeListener(t)}),this.listenedNodeSet.forEach(t=>{!e.has(t)&&t!==this.node&&this.removeNodeListener(t)}),this.value=e,this.updateEmitter.emit()}addNodeListener(e){this.listenedNodeSet.add(e),e.parentAddedEmitter.addListener(this._nodeUpdateListener),e.parentRemovedEmitter.addListener(this._nodeUpdateListener)}removeNodeListener(e){this.listenedNodeSet.delete(e),e.parentAddedEmitter.removeListener(this._nodeUpdateListener),e.parentRemovedEmitter.removeListener(this._nodeUpdateListener)}dispose(){this.listenedNodeSet.forEach(e=>this.removeNodeListener(e)),super.dispose()}}scenery.register("AncestorNodesProperty",AncestorNodesProperty);class TrailsBetweenProperty extends TinyProperty{constructor(e,t){super([]),this.listenedNodeSet=new Set,this.rootNode=e,this.leafNode=t,this._trailUpdateListener=this.update.bind(this),this.update()}update(){const e=[],t=new Set,n=new Trail(this.leafNode),r=this.rootNode;(function l(){const d=n.rootNode();t.add(d),d===r&&e.push(n.copy()),d.parents.forEach(c=>{n.addAncestor(c),l(),n.removeAncestor()})})(),t.forEach(l=>{this.listenedNodeSet.has(l)||this.addNodeListener(l)}),this.listenedNodeSet.forEach(l=>{t.has(l)||this.removeNodeListener(l)});const s=this.value;let a=s.length===e.length;if(a){for(let l=0;l<e.length;l++)if(!s[l].equals(e[l])){a=!1;break}}a||(this.value=e)}addNodeListener(e){this.listenedNodeSet.add(e),e.parentAddedEmitter.addListener(this._trailUpdateListener),e.parentRemovedEmitter.addListener(this._trailUpdateListener)}removeNodeListener(e){this.listenedNodeSet.delete(e),e.parentAddedEmitter.removeListener(this._trailUpdateListener),e.parentRemovedEmitter.removeListener(this._trailUpdateListener)}dispose(){this.listenedNodeSet.forEach(e=>this.removeNodeListener(e)),super.dispose()}}scenery.register("TrailsBetweenProperty",TrailsBetweenProperty);class MatrixBetweenProperty extends TinyProperty{constructor(e,t,n){const r=optionize()({fromCoordinateFrame:"local",toCoordinateFrame:"local"},n);super(Matrix3.IDENTITY),this.from=e,this.to=t,this.rootNode=null,this.fromTrail=null,this.toTrail=null,this.listenedNodeSet=new Set,this.fromCoordinateFrame=r.fromCoordinateFrame,this.toCoordinateFrame=r.toCoordinateFrame,this.useDeepEquality=!0,this.fromAncestorsProperty=new AncestorNodesProperty(e),this.toAncestorsProperty=new AncestorNodesProperty(t);const s=this.update.bind(this);this._nodeTransformListener=this.updateMatrix.bind(this),this.fromAncestorsProperty.updateEmitter.addListener(s),this.toAncestorsProperty.updateEmitter.addListener(s),this.update()}update(){const e=[...this.fromAncestorsProperty.value,this.from],t=[...this.toAncestorsProperty.value,this.to],n=e.filter(l=>t.includes(l));let r=!1;const s=n.filter(l=>{const d=e.filter(H=>l.hasChild(H)),c=t.filter(H=>l.hasChild(H)),y=[],m=[];arrayDifference(d,c,y,m,[]);const D=d.length>1||c.length>1,z=y.length||m.length;D&&z&&(r=!0);const w=y.length>0||this.from===l,N=m.length>0||this.to===l;return w&&N});!r&&s.length===1?(this.rootNode=s[0],this.fromTrail=this.from.getUniqueTrailTo(this.rootNode),this.toTrail=this.to.getUniqueTrailTo(this.rootNode)):(this.rootNode=null,this.fromTrail=null,this.toTrail=null);const a=new Set;this.fromTrail&&this.fromTrail.nodes.forEach(l=>a.add(l)),this.toTrail&&this.toTrail.nodes.forEach(l=>a.add(l)),a.forEach(l=>{this.listenedNodeSet.has(l)||this.addNodeListener(l)}),this.listenedNodeSet.forEach(l=>{!a.has(l)&&l!==this.from&&l!==this.to&&this.removeNodeListener(l)}),this.updateMatrix()}updateMatrix(){if(this.rootNode&&this.fromTrail&&this.toTrail){const e=this.fromTrail.nodes.length===1,t=this.toTrail.nodes.length===1,n=e&&this.fromCoordinateFrame==="parent"||t&&this.toCoordinateFrame==="parent",r=this.fromTrail.getMatrixConcatenation(n?0:1,this.fromTrail.nodes.length-(this.fromCoordinateFrame==="parent"?1:0)),s=this.toTrail.getMatrixConcatenation(n?0:1,this.toTrail.nodes.length-(this.toCoordinateFrame==="parent"?1:0));this.value=s.inverted().timesMatrix(r)}else this.value=null}addNodeListener(e){this.listenedNodeSet.add(e),e.transformEmitter.addListener(this._nodeTransformListener)}removeNodeListener(e){this.listenedNodeSet.delete(e),e.transformEmitter.removeListener(this._nodeTransformListener)}dispose(){this.fromAncestorsProperty.dispose(),this.toAncestorsProperty.dispose(),super.dispose()}}scenery.register("MatrixBetweenProperty",MatrixBetweenProperty);const isSafari5=platform.safari5,PAINTABLE_OPTION_KEYS=["fill","fillPickable","stroke","strokePickable","lineWidth","lineCap","lineJoin","miterLimit","lineDash","lineDashOffset","cachedPaints"],DEFAULT_OPTIONS$6={fill:null,fillPickable:!0,stroke:null,strokePickable:!1,lineWidth:DEFAULT_OPTIONS$8.lineWidth,lineCap:DEFAULT_OPTIONS$8.lineCap,lineJoin:DEFAULT_OPTIONS$8.lineJoin,lineDashOffset:DEFAULT_OPTIONS$8.lineDashOffset,miterLimit:DEFAULT_OPTIONS$8.miterLimit},PAINTABLE_DRAWABLE_MARK_FLAGS=["fill","stroke","lineWidth","lineOptions","cachedPaints"],Paintable=memoize(o=>(assert&&assert(_.includes(inheritance(o),Node$2),"Only Node subtypes should mix Paintable"),class extends o{constructor(...t){super(...t),assertHasProperties(this,["_drawables"]),this._fill=DEFAULT_OPTIONS$6.fill,this._fillPickable=DEFAULT_OPTIONS$6.fillPickable,this._stroke=DEFAULT_OPTIONS$6.stroke,this._strokePickable=DEFAULT_OPTIONS$6.strokePickable,this._cachedPaints=[],this._lineDrawingStyles=new LineStyles}setFill(t){return assert&&assert(PaintDef.isPaintDef(t),"Invalid fill type"),assert&&typeof t=="string"&&Color.checkPaintString(t),this._fill!==t&&(this._fill=t,this.invalidateFill()),this}set fill(t){this.setFill(t)}get fill(){return this.getFill()}getFill(){return this._fill}hasFill(){return this.getFillValue()!==null}getFillValue(){const t=this.getFill();return isTReadOnlyProperty(t)?t.get():t}get fillValue(){return this.getFillValue()}setStroke(t){if(assert&&assert(PaintDef.isPaintDef(t),"Invalid stroke type"),assert&&typeof t=="string"&&Color.checkPaintString(t),this._stroke!==t){if(this._stroke=t,assert&&t instanceof Paint&&t.transformMatrix){const n=t.transformMatrix.getScaleVector();assert(Math.abs(n.x-n.y)<1e-7,"You cannot specify a pattern or gradient to a stroke that does not have a symmetric scale.")}this.invalidateStroke()}return this}set stroke(t){this.setStroke(t)}get stroke(){return this.getStroke()}getStroke(){return this._stroke}hasStroke(){return this.getStrokeValue()!==null}hasPaintableStroke(){return this.hasStroke()&&this.getLineWidth()>0}getStrokeValue(){const t=this.getStroke();return isTReadOnlyProperty(t)?t.get():t}get strokeValue(){return this.getStrokeValue()}setFillPickable(t){return this._fillPickable!==t&&(this._fillPickable=t,this.invalidateFill()),this}set fillPickable(t){this.setFillPickable(t)}get fillPickable(){return this.isFillPickable()}isFillPickable(){return this._fillPickable}setStrokePickable(t){return this._strokePickable!==t&&(this._strokePickable=t,this.invalidateStroke()),this}set strokePickable(t){this.setStrokePickable(t)}get strokePickable(){return this.isStrokePickable()}isStrokePickable(){return this._strokePickable}setLineWidth(t){if(assert&&assert(t>=0,`lineWidth should be non-negative instead of ${t}`),this.getLineWidth()!==t){this._lineDrawingStyles.lineWidth=t,this.invalidateStroke();const n=this._drawables.length;for(let r=0;r<n;r++)this._drawables[r].markDirtyLineWidth()}return this}set lineWidth(t){this.setLineWidth(t)}get lineWidth(){return this.getLineWidth()}getLineWidth(){return this._lineDrawingStyles.lineWidth}setLineCap(t){if(assert&&assert(t==="butt"||t==="round"||t==="square",`lineCap should be one of "butt", "round" or "square", not ${t}`),this._lineDrawingStyles.lineCap!==t){this._lineDrawingStyles.lineCap=t,this.invalidateStroke();const n=this._drawables.length;for(let r=0;r<n;r++)this._drawables[r].markDirtyLineOptions()}return this}set lineCap(t){this.setLineCap(t)}get lineCap(){return this.getLineCap()}getLineCap(){return this._lineDrawingStyles.lineCap}setLineJoin(t){if(assert&&assert(t==="miter"||t==="round"||t==="bevel",`lineJoin should be one of "miter", "round" or "bevel", not ${t}`),this._lineDrawingStyles.lineJoin!==t){this._lineDrawingStyles.lineJoin=t,this.invalidateStroke();const n=this._drawables.length;for(let r=0;r<n;r++)this._drawables[r].markDirtyLineOptions()}return this}set lineJoin(t){this.setLineJoin(t)}get lineJoin(){return this.getLineJoin()}getLineJoin(){return this._lineDrawingStyles.lineJoin}setMiterLimit(t){if(assert&&assert(isFinite(t),"miterLimit should be a finite number"),this._lineDrawingStyles.miterLimit!==t){this._lineDrawingStyles.miterLimit=t,this.invalidateStroke();const n=this._drawables.length;for(let r=0;r<n;r++)this._drawables[r].markDirtyLineOptions()}return this}set miterLimit(t){this.setMiterLimit(t)}get miterLimit(){return this.getMiterLimit()}getMiterLimit(){return this._lineDrawingStyles.miterLimit}setLineDash(t){if(assert&&assert(Array.isArray(t)&&t.every(n=>typeof n=="number"&&isFinite(n)&&n>=0),"lineDash should be an array of finite non-negative numbers"),this._lineDrawingStyles.lineDash!==t){this._lineDrawingStyles.lineDash=t||[],this.invalidateStroke();const n=this._drawables.length;for(let r=0;r<n;r++)this._drawables[r].markDirtyLineOptions()}return this}set lineDash(t){this.setLineDash(t)}get lineDash(){return this.getLineDash()}getLineDash(){return this._lineDrawingStyles.lineDash}hasLineDash(){return!!this._lineDrawingStyles.lineDash.length}setLineDashOffset(t){if(assert&&assert(isFinite(t),`lineDashOffset should be a number, not ${t}`),this._lineDrawingStyles.lineDashOffset!==t){this._lineDrawingStyles.lineDashOffset=t,this.invalidateStroke();const n=this._drawables.length;for(let r=0;r<n;r++)this._drawables[r].markDirtyLineOptions()}return this}set lineDashOffset(t){this.setLineDashOffset(t)}get lineDashOffset(){return this.getLineDashOffset()}getLineDashOffset(){return this._lineDrawingStyles.lineDashOffset}setLineStyles(t){return this._lineDrawingStyles=t,this.invalidateStroke(),this}set lineStyles(t){this.setLineStyles(t)}get lineStyles(){return this.getLineStyles()}getLineStyles(){return this._lineDrawingStyles}setCachedPaints(t){this._cachedPaints=t.filter(r=>r instanceof Paint);const n=this._drawables.length;for(let r=0;r<n;r++)this._drawables[r].markDirtyCachedPaints();return this}set cachedPaints(t){this.setCachedPaints(t)}get cachedPaints(){return this.getCachedPaints()}getCachedPaints(){return this._cachedPaints}addCachedPaint(t){if(t instanceof Paint){this._cachedPaints.push(t);const n=this._drawables.length;for(let r=0;r<n;r++)this._drawables[r].markDirtyCachedPaints()}}removeCachedPaint(t){if(t instanceof Paint){assert&&assert(_.includes(this._cachedPaints,t)),arrayRemove(this._cachedPaints,t);const n=this._drawables.length;for(let r=0;r<n;r++)this._drawables[r].markDirtyCachedPaints()}}beforeCanvasFill(t){assert&&assert(this.getFillValue()!==null);const n=this.getFillValue();t.setFillStyle(n),n.transformMatrix&&(t.context.save(),n.transformMatrix.canvasAppendTransform(t.context))}afterCanvasFill(t){this.getFillValue().transformMatrix&&t.context.restore()}beforeCanvasStroke(t){const n=this.getStrokeValue();if(t.setStrokeStyle(this._stroke),t.setLineCap(this.getLineCap()),t.setLineJoin(this.getLineJoin()),n.transformMatrix){const r=n.transformMatrix.getScaleVector();assert&&assert(Math.abs(r.x-r.y)<1e-7,"You cannot specify a pattern or gradient to a stroke that does not have a symmetric scale.");const s=1/r.x;t.context.save(),n.transformMatrix.canvasAppendTransform(t.context),t.setLineWidth(this.getLineWidth()*s),t.setMiterLimit(this.getMiterLimit()*s),t.setLineDash(this.getLineDash().map(a=>a*s)),t.setLineDashOffset(this.getLineDashOffset()*s)}else t.setLineWidth(this.getLineWidth()),t.setMiterLimit(this.getMiterLimit()),t.setLineDash(this.getLineDash()),t.setLineDashOffset(this.getLineDashOffset())}afterCanvasStroke(t){this.getStrokeValue().transformMatrix&&t.context.restore()}getCSSFill(){const t=this.getFillValue();return t?t.toCSS?t.toCSS():t:"transparent"}getSimpleCSSStroke(){const t=this.getStrokeValue();return t?t.toCSS?t.toCSS():t:"transparent"}appendFillablePropString(t,n){return this._fill&&(n&&(n+=`,
`),typeof this.getFillValue()=="string"?n+=`${t}fill: '${this.getFillValue()}'`:n+=`${t}fill: ${this.getFillValue()}`),n}appendStrokablePropString(t,n){function r(s,a,l){n&&(n+=`,
`),!l&&typeof a=="string"?n+=`${t+s}: '${a}'`:n+=`${t+s}: ${a}`}if(this._stroke){const s=new LineStyles,a=this.getStrokeValue();typeof a=="string"?r("stroke",a):r("stroke",a?a.toString():"null",!0),_.each(["lineWidth","lineCap","miterLimit","lineJoin","lineDashOffset"],l=>{this[l]!==s[l]&&r(l,this[l])}),this.lineDash.length&&r("lineDash",JSON.stringify(this.lineDash),!0)}return n}getFillRendererBitmask(){let t=0;return isSafari5&&this._fill instanceof Gradient||(t|=Renderer.bitmaskSVG),t|=Renderer.bitmaskCanvas,this.hasFill()&&(this._fill instanceof Pattern||this._fill instanceof Gradient)||(t|=Renderer.bitmaskDOM,t|=Renderer.bitmaskWebGL),t}getStrokeRendererBitmask(){let t=0;return t|=Renderer.bitmaskCanvas,t|=Renderer.bitmaskSVG,this.hasStroke()||(t|=Renderer.bitmaskDOM,t|=Renderer.bitmaskWebGL),t}invalidateFill(){this.invalidateSupportedRenderers();const t=this._drawables.length;for(let n=0;n<t;n++)this._drawables[n].markDirtyFill()}invalidateStroke(){this.invalidateSupportedRenderers();const t=this._drawables.length;for(let n=0;n<t;n++)this._drawables[n].markDirtyStroke()}}));scenery.register("Paintable",Paintable);Paintable.DEFAULT_OPTIONS=DEFAULT_OPTIONS$6;const log2=Math.log2||function(o){return Math.log(o)/Math.LN2},DEFAULT_OPTIONS$5={imageOpacity:1,initialWidth:0,initialHeight:0,mipmap:!1,mipmapBias:0,mipmapInitialLevel:4,mipmapMaxLevel:5,hitTestPixels:!1};let scratchCanvas=null,scratchContext=null;const getScratchCanvas=()=>(scratchCanvas||(scratchCanvas=document.createElement("canvas")),scratchCanvas),getScratchContext=()=>(scratchContext||(scratchContext=getScratchCanvas().getContext("2d",{willReadFrequently:!0})),scratchContext),Imageable=o=>class extends o{constructor(...t){super(...t),this._imageProperty=new TinyForwardingProperty(null,!1,this.onImagePropertyChange.bind(this)),this._image=null,this._initialWidth=DEFAULT_OPTIONS$5.initialWidth,this._initialHeight=DEFAULT_OPTIONS$5.initialHeight,this._imageOpacity=DEFAULT_OPTIONS$5.imageOpacity,this._mipmap=DEFAULT_OPTIONS$5.mipmap,this._mipmapBias=DEFAULT_OPTIONS$5.mipmapBias,this._mipmapInitialLevel=DEFAULT_OPTIONS$5.mipmapInitialLevel,this._mipmapMaxLevel=DEFAULT_OPTIONS$5.mipmapMaxLevel,this._hitTestPixels=DEFAULT_OPTIONS$5.hitTestPixels,this._mipmapCanvases=[],this._mipmapURLs=[],this._mipmapData=null,this._imageLoadListener=this._onImageLoad.bind(this),this._imageLoadListenerAttached=!1,this._hitTestImageData=null,this.mipmapEmitter=new TinyEmitter}setImage(t){return assert&&assert(t,"image should be available"),this._imageProperty.value=t,this}set image(t){this.setImage(t)}get image(){return this.getImage()}getImage(){return assert&&assert(this._image!==null),this._image}onImagePropertyChange(t){assert&&assert(t,"image should be available");let n=this._image!==t;if(n&&typeof t=="string"&&this._image&&this._image instanceof HTMLImageElement&&t===this._image.src&&(n=!1),n&&t===this._mipmapData&&(n=!1),n){if(this._initialWidth=0,this._initialHeight=0,this._image&&this._imageLoadListenerAttached&&this._detachImageLoadListener(),this._mipmapData=null,typeof t=="string"){const r=t;t=document.createElement("img"),t.src=r}else Array.isArray(t)&&(this._mipmapData=t,t=t[0].img,this._mipmapInitialLevel=this._mipmapMaxLevel=this._mipmapData.length,this._mipmap=!0);this._image=t,this._image instanceof HTMLImageElement&&(!this._image.width||!this._image.height)&&this._attachImageLoadListener(),this.invalidateImage()}}setImageProperty(t){return this._imageProperty.setTargetProperty(t)}set imageProperty(t){this.setImageProperty(t)}get imageProperty(){return this.getImageProperty()}getImageProperty(){return this._imageProperty}invalidateImage(){this.invalidateMipmaps(),this._invalidateHitTestData()}setImageWithSize(t,n,r){return this.setImage(t),this.setInitialWidth(n),this.setInitialHeight(r),this}setImageOpacity(t){assert&&assert(isFinite(t)&&t>=0&&t<=1,`imageOpacity out of range: ${t}`),this._imageOpacity!==t&&(this._imageOpacity=t)}set imageOpacity(t){this.setImageOpacity(t)}get imageOpacity(){return this.getImageOpacity()}getImageOpacity(){return this._imageOpacity}setInitialWidth(t){return assert&&assert(t>=0&&t%1===0,"initialWidth should be a non-negative integer"),t!==this._initialWidth&&(this._initialWidth=t,this.invalidateImage()),this}set initialWidth(t){this.setInitialWidth(t)}get initialWidth(){return this.getInitialWidth()}getInitialWidth(){return this._initialWidth}setInitialHeight(t){return assert&&assert(t>=0&&t%1===0,"initialHeight should be a non-negative integer"),t!==this._initialHeight&&(this._initialHeight=t,this.invalidateImage()),this}set initialHeight(t){this.setInitialHeight(t)}get initialHeight(){return this.getInitialHeight()}getInitialHeight(){return this._initialHeight}setMipmap(t){return this._mipmap!==t&&(this._mipmap=t,this.invalidateMipmaps()),this}set mipmap(t){this.setMipmap(t)}get mipmap(){return this.isMipmap()}isMipmap(){return this._mipmap}setMipmapBias(t){return this._mipmapBias!==t&&(this._mipmapBias=t,this.invalidateMipmaps()),this}set mipmapBias(t){this.setMipmapBias(t)}get mipmapBias(){return this.getMipmapBias()}getMipmapBias(){return this._mipmapBias}setMipmapInitialLevel(t){return assert&&assert(t%1===0&&t>=0,"mipmapInitialLevel should be a non-negative integer"),this._mipmapInitialLevel!==t&&(this._mipmapInitialLevel=t,this.invalidateMipmaps()),this}set mipmapInitialLevel(t){this.setMipmapInitialLevel(t)}get mipmapInitialLevel(){return this.getMipmapInitialLevel()}getMipmapInitialLevel(){return this._mipmapInitialLevel}setMipmapMaxLevel(t){return assert&&assert(t%1===0&&t>=0,"mipmapMaxLevel should be a non-negative integer"),this._mipmapMaxLevel!==t&&(this._mipmapMaxLevel=t,this.invalidateMipmaps()),this}set mipmapMaxLevel(t){this.setMipmapMaxLevel(t)}get mipmapMaxLevel(){return this.getMipmapMaxLevel()}getMipmapMaxLevel(){return this._mipmapMaxLevel}setHitTestPixels(t){return this._hitTestPixels!==t&&(this._hitTestPixels=t,this._invalidateHitTestData()),this}set hitTestPixels(t){this.setHitTestPixels(t)}get hitTestPixels(){return this.getHitTestPixels()}getHitTestPixels(){return this._hitTestPixels}_constructNextMipmap(){const t=this._mipmapCanvases.length,n=this._mipmapCanvases[t-1];if(n.width*n.height>2){const r=document.createElement("canvas");if(r.width=Math.ceil(n.width/2),r.height=Math.ceil(n.height/2),r.width>0&&r.height>0){const s=r.getContext("2d");s.scale(.5,.5),s.drawImage(n,0,0),this._mipmapCanvases.push(r),this._mipmapURLs.push(r.toDataURL())}}}invalidateMipmaps(){if(cleanArray(this._mipmapCanvases),cleanArray(this._mipmapURLs),this._image&&this._mipmap)if(this._mipmapData)for(let t=0;t<this._mipmapData.length;t++){const n=this._mipmapData[t].url;this._mipmapURLs.push(n);const r=this._mipmapData[t].updateCanvas;r&&r(),this._mipmapCanvases.push(this._mipmapData[t].canvas)}else{const t=document.createElement("canvas");if(t.width=this.getImageWidth(),t.height=this.getImageHeight(),t.width&&t.height){t.getContext("2d").drawImage(this._image,0,0),this._mipmapCanvases.push(t),this._mipmapURLs.push(t.toDataURL());let r=0;for(;++r<this._mipmapInitialLevel;)this._constructNextMipmap()}}this.mipmapEmitter.emit()}getMipmapLevel(t,n=0){assert&&assert(this._mipmap,"Assumes mipmaps can be used");const r=Imageable.getApproximateMatrixScale(t)*(window.devicePixelRatio||1);return this.getMipmapLevelFromScale(r,n)}getMipmapLevelFromScale(t,n=0){if(assert&&assert(t>0,"scale should be a positive number"),t>=1)return 0;let r=log2(1/t);if(r=DotUtils.roundSymmetric(r+this._mipmapBias+n-.7),r<0&&(r=0),r>this._mipmapMaxLevel&&(r=this._mipmapMaxLevel),this.mipmap&&!this._mipmapCanvases[r]){let s=this._mipmapCanvases.length-1;for(;++s<=r;)this._constructNextMipmap();return Math.min(r,this._mipmapCanvases.length-1)}else return r}getMipmapCanvas(t){if(assert&&assert(t>=0&&t<this._mipmapCanvases.length&&t%1===0),this._mipmapData){const n=this._mipmapData[t]&&this._mipmapData[t].updateCanvas;n&&n()}return this._mipmapCanvases[t]}getMipmapURL(t){return assert&&assert(t>=0&&t<this._mipmapCanvases.length&&t%1===0),this._mipmapURLs[t]}hasMipmaps(){return this._mipmapCanvases.length>0}_invalidateHitTestData(){this._hitTestPixels&&this._image!==null&&(this._hitTestImageData=Imageable.getHitTestData(this._image,this.imageWidth,this.imageHeight))}getImageWidth(){if(this._image===null)return 0;const t=this._mipmapData?this._mipmapData[0].width:("naturalWidth"in this._image?this._image.naturalWidth:0)||this._image.width;return t===0?this._initialWidth:(assert&&assert(this._initialWidth===0||this._initialWidth===t,"Bad Image.initialWidth"),t)}get imageWidth(){return this.getImageWidth()}getImageHeight(){if(this._image===null)return 0;const t=this._mipmapData?this._mipmapData[0].height:("naturalHeight"in this._image?this._image.naturalHeight:0)||this._image.height;return t===0?this._initialHeight:(assert&&assert(this._initialHeight===0||this._initialHeight===t,"Bad Image.initialHeight"),t)}get imageHeight(){return this.getImageHeight()}getImageURL(){return assert&&assert(this._image instanceof HTMLImageElement,"Only supported for HTML image elements"),this._image.src}_attachImageLoadListener(){assert&&assert(!this._imageLoadListenerAttached,"Should only be attached to one thing at a time"),this.isDisposed||(this._image.addEventListener("load",this._imageLoadListener),this._imageLoadListenerAttached=!0)}_detachImageLoadListener(){assert&&assert(this._imageLoadListenerAttached,"Needs to be attached first to be detached."),this._image.removeEventListener("load",this._imageLoadListener),this._imageLoadListenerAttached=!1}_onImageLoad(){assert&&assert(this._imageLoadListenerAttached,"If _onImageLoad is firing, it should be attached"),this.invalidateImage(),this._detachImageLoadListener()}dispose(){this._image&&this._imageLoadListenerAttached&&this._detachImageLoadListener(),this._imageProperty.dispose(),super.dispose&&super.dispose()}};Imageable.getHitTestData=(o,e,t)=>{if(!("naturalWidth"in o&&o.naturalWidth||o.width)||!("naturalHeight"in o&&o.naturalHeight||o.height))return null;const n=getScratchCanvas(),r=getScratchContext();return n.width=e,n.height=t,r.drawImage(o,0,0),r.getImageData(0,0,e,t)};Imageable.testHitTestData=(o,e,t,n)=>{const r=DotUtils.clamp(Math.floor(n.x/e*o.width),0,o.width-1),s=DotUtils.clamp(Math.floor(n.y/t*o.height),0,o.height-1),a=4*(r+s*o.width)+3;return o.data[a]!==0};Imageable.hitTestDataToShape=(o,e,t)=>{const n=e/o.width,r=t/o.height,s=new Shape$1;let a=!1,l=0;for(let d=0;d<o.height;d++){for(let c=0;c<o.width;c++){const y=4*(c+d*o.width)+3;o.data[y]!==0?a||(a=!0,l=c):a&&(a=!1,s.rect(l*n,d*n,n*(c-l),r))}a&&(a=!1,s.rect(l*n,d*n,n*(o.width-l),r))}return s.getSimplifiedAreaShape()};Imageable.createSVGImage=(o,e,t)=>{assert&&assert(isFinite(e)&&e>=0&&e%1===0,"width should be a non-negative finite integer"),assert&&assert(isFinite(t)&&t>=0&&t%1===0,"height should be a non-negative finite integer");const n=document.createElementNS(svgns,"image");return n.setAttribute("x","0"),n.setAttribute("y","0"),n.setAttribute("width",`${e}px`),n.setAttribute("height",`${t}px`),n.setAttributeNS(xlinkns,"xlink:href",o),n};Imageable.createFastMipmapFromCanvas=o=>{const e=[],t=o.toDataURL(),n=new window.Image;n.src=t,e.push({img:n,url:t,width:o.width,height:o.height,canvas:o});let r=o;for(;r.width>=2&&r.height>=2;){const s=document.createElement("canvas");s.width=Math.ceil(r.width/2),s.height=Math.ceil(r.height/2);const a=s.getContext("2d");a.setTransform(.5,0,0,.5,0,0),a.drawImage(r,0,0);const l={width:s.width,height:s.height,canvas:s,url:s.toDataURL(),img:new window.Image};l.img.src=l.url,r=s,e.push(l)}return e};Imageable.getApproximateMatrixScale=o=>(Math.sqrt(o.m00()*o.m00()+o.m10()*o.m10())+Math.sqrt(o.m01()*o.m01()+o.m11()*o.m11()))/2;Imageable.CANVAS_MIPMAP_BIAS_ADJUSTMENT=.5;Imageable.DEFAULT_OPTIONS=DEFAULT_OPTIONS$5;scenery.register("Imageable",Imageable);const Imageable$1=Imageable,DelayedMutate=(o,e,t)=>{const n=`_${o}PendingOptions`,r=`_${o}IsConstructed`;return class extends t{constructor(...a){super(...a),this[r]=!0,this.mutate(this[n]),this[n]=void 0}mutate(a){return a&&!this[r]&&(this[n]=combineOptions(this[n]||{},_.pick(a,e)),a=_.omit(a,e)),super.mutate(a)}}};scenery.register("DelayedMutate",DelayedMutate);const DelayedMutate$1=DelayedMutate,IMAGE_OPTION_KEYS=["image","imageProperty","imageOpacity","imageBounds","initialWidth","initialHeight","mipmap","mipmapBias","mipmapInitialLevel","mipmapMaxLevel","hitTestPixels"];var jl;let Image$1=(jl=class extends Imageable$1(Node$2){constructor(e,t){const n={};isTReadOnlyProperty(e)?n.imageProperty=e:n.image=e;const r=optionize()(n,t);super(),this._imageBounds=null,this.mutate(r),this.invalidateSupportedRenderers()}invalidateImage(){this._image?this.invalidateSelf(this._imageBounds||new Bounds2(0,0,this.getImageWidth(),this.getImageHeight())):this.invalidateSelf(Bounds2.NOTHING);const e=this._drawables.length;for(let t=0;t<e;t++)this._drawables[t].markDirtyImage();super.invalidateImage(),this.invalidateSupportedRenderers()}invalidateSupportedRenderers(){let e=Renderer.bitmaskCanvas;this.getImageWidth()<=SpriteSheet.MAX_DIMENSION.width&&this.getImageHeight()<=SpriteSheet.MAX_DIMENSION.height&&(e|=Renderer.bitmaskWebGL),this._image instanceof HTMLCanvasElement||(e|=Renderer.bitmaskSVG|Renderer.bitmaskDOM),this.setRendererBitmask(e)}setImageOpacity(e){const t=this._imageOpacity!==e;if(super.setImageOpacity(e),t){const n=this._drawables.length;for(let r=0;r<n;r++)this._drawables[r].markDirtyImageOpacity()}}setImageBounds(e){this._imageBounds!==e&&(this._imageBounds=e,this.invalidateImage())}set imageBounds(e){this.setImageBounds(e)}get imageBounds(){return this._imageBounds}getImageBounds(){return this._imageBounds}isPainted(){return!0}canvasPaintSelf(e,t){ImageCanvasDrawable$1.prototype.paintCanvas(e,this,t)}createDOMDrawable(e,t){return ImageDOMDrawable$1.createFromPool(e,t)}createSVGDrawable(e,t){return ImageSVGDrawable$1.createFromPool(e,t)}createCanvasDrawable(e,t){return ImageCanvasDrawable$1.createFromPool(e,t)}createWebGLDrawable(e,t){return ImageWebGLDrawable$1.createFromPool(e,t)}containsPointSelf(e){const t=Node$2.prototype.containsPointSelf.call(this,e);return!t||!this._hitTestPixels||!this._hitTestImageData?t:Imageable$1.testHitTestData(this._hitTestImageData,this.imageWidth,this.imageHeight,e)}getSelfShape(){return this._hitTestPixels&&this._hitTestImageData?Imageable$1.hitTestDataToShape(this._hitTestImageData,this.imageWidth,this.imageHeight):Node$2.prototype.getSelfShape.call(this)}invalidateMipmaps(){const e=this._image&&this._mipmap&&!this._mipmapData;if(super.invalidateMipmaps(),e){const t=this._drawables.length;for(let n=0;n<t;n++)this._drawables[n].markDirtyMipmap()}}mutate(e){return super.mutate(e)}},jl.DEFAULT_IMAGE_OPTIONS=combineOptions({},Node$2.DEFAULT_NODE_OPTIONS,Imageable$1.DEFAULT_OPTIONS),jl);Image$1.prototype._mutatorKeys=[...IMAGE_OPTION_KEYS,...Node$2.prototype._mutatorKeys];Image$1.prototype.drawableMarkFlags=[...Node$2.prototype.drawableMarkFlags,"image","imageOpacity","mipmap"];Image$1.ImageIO=new IOType("ImageIO",{valueType:Image$1,supertype:Node$2.NodeIO,events:["changed"],methods:{setImage:{returnType:VoidIO,parameterTypes:[StringIO],implementation:function(o){const e=new window.Image;e.src=o,this.image=e},documentation:"Set the image from a base64 string",invocableForReadOnlyElements:!1}}});scenery.register("Image",Image$1);const PATH_OPTION_KEYS=["boundsMethod","shape","shapeProperty"],DEFAULT_OPTIONS$4={shape:null,boundsMethod:"accurate"},Vu=class Vu extends Paintable(Node$2){constructor(e,t){assert&&assert(t===void 0||Object.getPrototypeOf(t)===Object.prototype,"Extra prototype on Node options object is a code smell"),(e||t!=null&&t.shape)&&assert&&assert(!e||!(t!=null&&t.shape),"Do not define shape twice. Check constructor and providedOptions.");const n={boundsMethod:DEFAULT_OPTIONS$4.boundsMethod};isTReadOnlyProperty(e)?n.shapeProperty=e:n.shape=e;const r=optionize()(n,t);super(),this._shapeProperty=new TinyForwardingProperty(null,!1,this.onShapePropertyChange.bind(this)),this._shape=DEFAULT_OPTIONS$4.shape,this._strokedShape=null,this._boundsMethod=DEFAULT_OPTIONS$4.boundsMethod,this._invalidShapeListener=this.invalidateShape.bind(this),this._invalidShapeListenerAttached=!1,this.invalidateSupportedRenderers(),this.mutate(r)}setShape(e){return assert&&assert(e===null||typeof e=="string"||e instanceof Shape$1,"A path's shape should either be null, a string, or a Shape"),this._shapeProperty.value=e,this}set shape(e){this.setShape(e)}get shape(){return this.getShape()}getShape(){return this._shape}onShapePropertyChange(e){assert&&assert(e===null||typeof e=="string"||e instanceof Shape$1,"A path's shape should either be null, a string, or a Shape"),this._shape!==e&&(this._invalidShapeListenerAttached&&this.detachShapeListener(),typeof e=="string"&&(e=new Shape$1(e)),this._shape=e,this.invalidateShape(),this._shape&&!this._shape.isImmutable()&&this.attachShapeListener())}setShapeProperty(e){return this._shapeProperty.setTargetProperty(e)}set shapeProperty(e){this.setShapeProperty(e)}get shapeProperty(){return this.getShapeProperty()}getShapeProperty(){return this._shapeProperty}getStrokedShape(){return assert&&assert(this.hasShape(),"We cannot stroke a non-existing shape"),this._strokedShape||(this._strokedShape=this.getShape().getStrokedShape(this._lineDrawingStyles)),this._strokedShape}getPathRendererBitmask(){return Renderer.bitmaskCanvas|Renderer.bitmaskSVG}invalidateSupportedRenderers(){this.setRendererBitmask(this.getFillRendererBitmask()&this.getStrokeRendererBitmask()&this.getPathRendererBitmask())}invalidateShape(){this.invalidatePath();const e=this._drawables.length;for(let t=0;t<e;t++)this._drawables[t].markDirtyShape();this._invalidShapeListenerAttached&&this._shape&&this._shape.isImmutable()&&this.detachShapeListener()}invalidatePath(){this._strokedShape=null,this.invalidateSelf()}attachShapeListener(){assert&&assert(!this._invalidShapeListenerAttached,"We do not want to have two listeners attached!"),this.isDisposed||(this._shape.invalidatedEmitter.addListener(this._invalidShapeListener),this._invalidShapeListenerAttached=!0)}detachShapeListener(){assert&&assert(this._invalidShapeListenerAttached,"We cannot detach an unattached listener"),this._shape.invalidatedEmitter.removeListener(this._invalidShapeListener),this._invalidShapeListenerAttached=!1}updateSelfBounds(){const e=this.hasShape()?this.computeShapeBounds():Bounds2.NOTHING,t=!e.equals(this.selfBoundsProperty._value);return t&&this.selfBoundsProperty._value.set(e),t}setBoundsMethod(e){return assert&&assert(e==="accurate"||e==="unstroked"||e==="tightPadding"||e==="safePadding"||e==="none"),this._boundsMethod!==e&&(this._boundsMethod=e,this.invalidatePath(),this.rendererSummaryRefreshEmitter.emit()),this}set boundsMethod(e){this.setBoundsMethod(e)}get boundsMethod(){return this.getBoundsMethod()}getBoundsMethod(){return this._boundsMethod}computeShapeBounds(){const e=this.getShape();if(this._boundsMethod==="none"||!e)return Bounds2.NOTHING;if(!this.hasPaintableStroke()||this._boundsMethod==="unstroked")return e.bounds;if(this._boundsMethod==="accurate")return e.getStrokedBounds(this.getLineStyles());{let t;return this._boundsMethod==="safePadding"&&this.getLineJoin()==="miter"?t=this.getMiterLimit():this.getLineCap()==="square"?t=Math.SQRT2:t=1,e.bounds.dilated(t*this.getLineWidth()/2)}}areSelfBoundsValid(){return this._boundsMethod==="accurate"||this._boundsMethod==="safePadding"?!0:this._boundsMethod==="none"?!1:!this.hasStroke()}getTransformedSelfBounds(e){return assert&&assert(this.hasShape()),(this._stroke?this.getStrokedShape():this.getShape()).getBoundsWithTransform(e)}getTransformedSafeSelfBounds(e){return this.getTransformedSelfBounds(e)}invalidateStroke(){this.invalidatePath(),this.rendererSummaryRefreshEmitter.emit(),super.invalidateStroke()}hasShape(){return!!this._shape}canvasPaintSelf(e,t){PathCanvasDrawable$1.prototype.paintCanvas(e,this,t)}createSVGDrawable(e,t){return PathSVGDrawable$1.createFromPool(e,t)}createCanvasDrawable(e,t){return PathCanvasDrawable$1.createFromPool(e,t)}isPainted(){return!0}containsPointSelf(e){let t=!1;return this.hasShape()&&(this._fillPickable&&(t=this.getShape().containsPoint(e)),!t&&this._strokePickable&&(t=this.getStrokedShape().containsPoint(e))),t}getSelfShape(){return Shape$1.union([...this.hasShape()&&this._fillPickable?[this.getShape()]:[],...this.hasShape()&&this._strokePickable?[this.getStrokedShape()]:[]])}intersectsBoundsSelf(e){return this._shape?this._shape.intersectsBounds(e):!1}requiresSVGBoundsWorkaround(){if(!this._stroke||!(this._stroke instanceof Paint)||!this.hasShape())return!1;const e=this.computeShapeBounds();return e.width*e.height===0}getDebugHTMLExtras(){return this._shape?` (<span style="color: #88f" onclick="window.open( 'data:text/plain;charset=utf-8,' + encodeURIComponent( '${this._shape.getSVGPath()}' ) );">path</span>)`:""}dispose(){this._invalidShapeListenerAttached&&this.detachShapeListener(),this._shapeProperty.dispose(),super.dispose()}mutate(e){return super.mutate(e)}};Vu.DEFAULT_PATH_OPTIONS=combineOptions({},Node$2.DEFAULT_NODE_OPTIONS,DEFAULT_OPTIONS$4);let Path=Vu;Path.prototype._mutatorKeys=[...PAINTABLE_OPTION_KEYS,...PATH_OPTION_KEYS,...Node$2.prototype._mutatorKeys];Path.prototype.drawableMarkFlags=[...Node$2.prototype.drawableMarkFlags,...PAINTABLE_DRAWABLE_MARK_FLAGS,"shape"];scenery.register("Path",Path);const PhetioElementSelectionValues=["view","linked","string","none"],phetioElementSelectionProperty=new Property("none",{tandem:Tandem.GENERAL_VIEW.createTandem("phetioElementSelectionProperty"),phetioValueType:StringIO,validValues:PhetioElementSelectionValues,phetioState:!1,phetioDocumentation:'Specifies how PhET-iO Elements are being selected. "view": the target view element, "linked": the corresponding linked element of the view element (if there is one), "string": select only string elements in the sim, "none": no active selection.'});tandemNamespace.register("phetioElementSelectionProperty",phetioElementSelectionProperty);const STRING_PROPERTY_NAME="stringProperty",TEXT_OPTION_KEYS=["boundsMethod",STRING_PROPERTY_NAME,"string","font","fontWeight","fontFamily","fontStretch","fontStyle","fontSize"],useDOMAsFastBounds=window.navigator.userAgent.includes("like Gecko) Version/5")&&window.navigator.userAgent.includes("Safari/"),Mr=class Mr extends Paintable(Node$2){constructor(e,t){assert&&assert(t===void 0||Object.getPrototypeOf(t)===Object.prototype,"Extra prototype on Node options object is a code smell"),super(),this._stringProperty=new TinyForwardingProperty("",!0,this.onStringPropertyChange.bind(this)),this._font=Font.DEFAULT,this._boundsMethod="hybrid",this._isHTML=!1,this._cachedRenderedText=null;const n=extendDefined({fill:"#000000",tandemNameSuffix:"Text",phetioType:Mr.TextIO,phetioVisiblePropertyInstrumented:!1},t);assert&&assert(!n.hasOwnProperty("string")&&!n.hasOwnProperty(Mr.STRING_PROPERTY_TANDEM_NAME),"provide string and stringProperty through constructor arg please"),typeof e=="string"||typeof e=="number"?n.string=e:n.stringProperty=e,this.mutate(n),this.invalidateSupportedRenderers()}mutate(e){return assert&&e&&e.hasOwnProperty("string")&&e.hasOwnProperty(STRING_PROPERTY_NAME)&&assert&&assert(e.stringProperty.value===e.string,"If both string and stringProperty are provided, then values should match"),super.mutate(e)}setString(e){return assert&&assert(e!=null,"String should be defined and non-null. Use the empty string if needed."),e=`${e}`,this._stringProperty.set(e),this}set string(e){this.setString(e)}get string(){return this.getString()}getString(){return this._stringProperty.value}getRenderedText(){return this._cachedRenderedText===null&&(this._cachedRenderedText=this.string.replace(" "," "),platform.edge&&(this._cachedRenderedText=Mr.simplifyEmbeddingMarks(this._cachedRenderedText))),this._cachedRenderedText}get renderedText(){return this.getRenderedText()}onStringPropertyChange(){this._cachedRenderedText=null;const e=this._drawables.length;for(let t=0;t<e;t++)this._drawables[t].markDirtyText();this.invalidateText()}setStringProperty(e){return this._stringProperty.setTargetProperty(e,this,Mr.STRING_PROPERTY_TANDEM_NAME)}set stringProperty(e){this.setStringProperty(e)}get stringProperty(){return this.getStringProperty()}getStringProperty(){return this._stringProperty}initializePhetioObject(e,t){const n=this.isPhetioInstrumented();super.initializePhetioObject(e,t),Tandem.PHET_IO_ENABLED&&!n&&this.isPhetioInstrumented()&&this._stringProperty.initializePhetio(this,Mr.STRING_PROPERTY_TANDEM_NAME,()=>new StringProperty(this.string,combineOptions({phetioReadOnly:!0,tandem:this.tandem.createTandem(Mr.STRING_PROPERTY_TANDEM_NAME),phetioDocumentation:"Property for the displayed text"},t.stringPropertyOptions)))}getPhetioMouseHitTarget(e=!1){return phetioElementSelectionProperty.value==="string"?this.getStringPropertyPhetioMouseHitTarget(e):super.getPhetioMouseHitTarget(e)}getStringPropertyPhetioMouseHitTarget(e=!1){const t=this._stringProperty.getTargetProperty();return t instanceof PhetioObject?t.getPhetioMouseHitTarget(e):"phetioNotSelectable"}setBoundsMethod(e){if(assert&&assert(e==="fast"||e==="fastCanvas"||e==="accurate"||e==="hybrid","Unknown Text boundsMethod"),e!==this._boundsMethod){this._boundsMethod=e,this.invalidateSupportedRenderers();const t=this._drawables.length;for(let n=0;n<t;n++)this._drawables[n].markDirtyBounds();this.invalidateText(),this.rendererSummaryRefreshEmitter.emit()}return this}set boundsMethod(e){this.setBoundsMethod(e)}get boundsMethod(){return this.getBoundsMethod()}getBoundsMethod(){return this._boundsMethod}getTextRendererBitmask(){let e=0;return this._boundsMethod!=="fast"&&!this._isHTML&&(e|=Renderer.bitmaskCanvas),this._isHTML||(e|=Renderer.bitmaskSVG),e|=Renderer.bitmaskDOM,e}invalidateSupportedRenderers(){this.setRendererBitmask(this.getFillRendererBitmask()&this.getStrokeRendererBitmask()&this.getTextRendererBitmask())}invalidateText(){this.invalidateSelf();const e=this._drawables.length;for(let t=0;t<e;t++)this._drawables[t].markDirtyBounds();this.invalidateSupportedRenderers()}updateSelfBounds(){let e;this._isHTML||useDOMAsFastBounds&&this._boundsMethod!=="accurate"?e=TextBounds.approximateDOMBounds(this._font,this.getDOMTextNode()):this._boundsMethod==="hybrid"?e=TextBounds.approximateHybridBounds(this._font,this.renderedText):this._boundsMethod==="accurate"?e=TextBounds.accurateCanvasBounds(this):(assert&&assert(this._boundsMethod==="fast"||this._boundsMethod==="fastCanvas"),e=TextBounds.approximateSVGBounds(this._font,this.renderedText)),this.hasStroke()&&e.dilate(this.getLineWidth()/2);const t=!e.equals(this.selfBoundsProperty._value);return t&&this.selfBoundsProperty._value.set(e),t}invalidateStroke(){this.invalidateText(),super.invalidateStroke()}invalidateFill(){this.invalidateText(),super.invalidateFill()}canvasPaintSelf(e,t){TextCanvasDrawable$1.prototype.paintCanvas(e,this,t)}createDOMDrawable(e,t){return TextDOMDrawable$1.createFromPool(e,t)}createSVGDrawable(e,t){return TextSVGDrawable$1.createFromPool(e,t)}createCanvasDrawable(e,t){return TextCanvasDrawable$1.createFromPool(e,t)}getDOMTextNode(){if(this._isHTML){const e=document.createElement("span");return e.innerHTML=this.string,e}else return document.createTextNode(this.renderedText)}getSafeSelfBounds(){const t=this.getSelfBounds();return t.dilatedXY(1*t.width,1*t.height)}setFont(e){if(e!==(typeof e=="string"?this._font.toCSS():this._font)){this._font=typeof e=="string"?Font.fromCSS(e):e;const n=this._drawables.length;for(let r=0;r<n;r++)this._drawables[r].markDirtyFont();this.invalidateText()}return this}set font(e){this.setFont(e)}get font(){return this.getFont()}getFont(){return this._font.getFont()}setFontWeight(e){return this.setFont(this._font.copy({weight:e}))}set fontWeight(e){this.setFontWeight(e)}get fontWeight(){return this.getFontWeight()}getFontWeight(){return this._font.getWeight()}setFontFamily(e){return this.setFont(this._font.copy({family:e}))}set fontFamily(e){this.setFontFamily(e)}get fontFamily(){return this.getFontFamily()}getFontFamily(){return this._font.getFamily()}setFontStretch(e){return this.setFont(this._font.copy({stretch:e}))}set fontStretch(e){this.setFontStretch(e)}get fontStretch(){return this.getFontStretch()}getFontStretch(){return this._font.getStretch()}setFontStyle(e){return this.setFont(this._font.copy({style:e}))}set fontStyle(e){this.setFontStyle(e)}get fontStyle(){return this.getFontStyle()}getFontStyle(){return this._font.getStyle()}setFontSize(e){return this.setFont(this._font.copy({size:e}))}set fontSize(e){this.setFontSize(e)}get fontSize(){return this.getFontSize()}getFontSize(){return this._font.getSize()}isPainted(){return!0}areSelfBoundsValid(){return this._boundsMethod==="accurate"}getDebugHTMLExtras(){return` "${escapeHTML(this.renderedText)}"${this._isHTML?" (html)":""}`}dispose(){super.dispose(),this._stringProperty.dispose()}static embeddedDebugString(e){return e.replace(/\u202a/g,"[LTR]").replace(/\u202b/g,"[RTL]").replace(/\u202c/g,"[POP]")}static simplifyEmbeddingMarks(e){const t={dir:null,children:[],parent:null};let n=t;for(let c=0;c<e.length;c++){const y=e.charAt(c);if(y===LTR$1||y===RTL$1){const m={dir:y,children:[],parent:n};n.children.push(m),n=m}else y===POP$1?(assert&&assert(n.parent,`Bad nesting of embedding marks: ${Mr.embeddedDebugString(e)}`),n=n.parent):n.children.push(y)}assert&&assert(n===t,`Bad nesting of embedding marks: ${Mr.embeddedDebugString(e)}`);function r(c){for(let y=c.children.length-1;y>=0;y--){const m=c.children[y];typeof m!="string"&&c.dir===m.dir&&c.children.splice(y,1,...m.children)}}function s(c){c.children.length===1&&typeof c.children[0]!="string"&&c.children[0].dir&&(c.dir=c.children[0].dir,c.children=c.children[0].children)}function a(c){for(let y=c.children.length-1;y>=1;y--){const m=c.children[y-1],O=c.children[y];typeof O!="string"&&typeof m!="string"&&O.dir&&m.dir===O.dir&&(m.children=m.children.concat(O.children),c.children.splice(y,1),a(m))}}function l(c){if(typeof c!="string"){for(let y=0;y<c.children.length;y++)l(c.children[y]);s(c),r(c),a(c)}return c}function d(c){if(typeof c=="string")return c;const y=c.children.map(d).join("");return c.dir?`${c.dir+y}‬`:y}return d(l(t))}};Mr.STRING_PROPERTY_NAME=STRING_PROPERTY_NAME,Mr.STRING_PROPERTY_TANDEM_NAME=STRING_PROPERTY_NAME;let Text=Mr;Text.prototype._mutatorKeys=[...PAINTABLE_OPTION_KEYS,...TEXT_OPTION_KEYS,...Node$2.prototype._mutatorKeys];Text.prototype.drawableMarkFlags=[...Node$2.prototype.drawableMarkFlags,...PAINTABLE_DRAWABLE_MARK_FLAGS,"text","font","bounds"];scenery.register("Text",Text);const LTR$1="‪",RTL$1="‫",POP$1="‬";TextBounds.initializeTextBounds();Text.TextIO=new IOType("TextIO",{valueType:Text,supertype:Node$2.NodeIO,documentation:"Text that is displayed in the simulation. TextIO has a nested PropertyIO.&lt;String&gt; for the current string value."});const CANVAS_NODE_OPTION_KEYS=["canvasBounds"];class CanvasNode extends Node$2{constructor(e){super(e),this.setRendererBitmask(Renderer.bitmaskCanvas)}setCanvasBounds(e){this.invalidateSelf(e)}set canvasBounds(e){this.setCanvasBounds(e)}get canvasBounds(){return this.getCanvasBounds()}getCanvasBounds(){return this.getSelfBounds()}isPainted(){return!0}invalidatePaint(){const e=this._drawables.length;for(let t=0;t<e;t++)this._drawables[t].markDirty()}canvasPaintSelf(e,t){this.paintCanvas(e.context)}containsPointSelf(e){return!1}getSelfShape(){return new Shape$1}createCanvasDrawable(e,t){return CanvasNodeDrawable$1.createFromPool(e,t)}mutate(e){return super.mutate(e)}}CanvasNode.prototype._mutatorKeys=CANVAS_NODE_OPTION_KEYS.concat(Node$2.prototype._mutatorKeys);scenery.register("CanvasNode",CanvasNode);const CIRCLE_OPTION_KEYS=["radius"];class Circle extends Path{constructor(e,t){super(null),this._radius=0,typeof e=="object"?(t=e,assert&&assert(t===void 0||Object.getPrototypeOf(t)===Object.prototype,"Extra prototype on Node options object is a code smell")):(assert&&assert(t===void 0||Object.getPrototypeOf(t)===Object.prototype,"Extra prototype on Node options object is a code smell"),t=extendDefined({radius:e},t)),this.mutate(t)}getStrokeRendererBitmask(){let e=super.getStrokeRendererBitmask();return this.hasStroke()&&!this.getStroke().isGradient&&!this.getStroke().isPattern&&this.getLineWidth()<=this.getRadius()&&(e|=Renderer.bitmaskDOM),e}getPathRendererBitmask(){return Renderer.bitmaskCanvas|Renderer.bitmaskSVG|(Features.borderRadius?Renderer.bitmaskDOM:0)}invalidateCircle(){assert&&assert(this._radius>=0,"A circle needs a non-negative radius"),this._shape=null,this.invalidatePath()}createCircleShape(){return Shape$1.circle(0,0,this._radius).makeImmutable()}intersectsBoundsSelf(e){let t=Math.abs(e.centerX),n=Math.abs(e.centerY);const r=e.maxX-t,s=e.maxY-n;return t>r+this._radius||n>s+this._radius?!1:t<=r||n<=s?!0:(t-=r,n-=s,t*t+n*n<=this._radius*this._radius)}canvasPaintSelf(e,t){CircleCanvasDrawable$1.prototype.paintCanvas(e,this,t)}createDOMDrawable(e,t){return CircleDOMDrawable$1.createFromPool(e,t)}createSVGDrawable(e,t){return CircleSVGDrawable$1.createFromPool(e,t)}createCanvasDrawable(e,t){return CircleCanvasDrawable$1.createFromPool(e,t)}setRadius(e){if(assert&&assert(e>=0,"A circle needs a non-negative radius"),assert&&assert(isFinite(e),"A circle needs a finite radius"),this._radius!==e){this._radius=e,this.invalidateCircle();const t=this._drawables.length;for(let n=0;n<t;n++)this._drawables[n].markDirtyRadius()}return this}set radius(e){this.setRadius(e)}get radius(){return this.getRadius()}getRadius(){return this._radius}computeShapeBounds(){let e=new Bounds2(-this._radius,-this._radius,this._radius,this._radius);return this._stroke&&(e=e.dilated(this.getLineWidth()/2)),e}containsPointSelf(e){const t=e.x*e.x+e.y*e.y;let n=!0,r;if(this._strokePickable){r=this.getLineWidth()/2;const s=this._radius+r;n=n&&t<=s*s}if(this._fillPickable)return this._strokePickable?n:t<=this._radius*this._radius;if(this._strokePickable){const s=this._radius-r;return n&&t>=s*s}else return!1}setShape(e){if(e!==null)throw new Error("Cannot set the shape of a Circle to something non-null");return this.invalidatePath(),this}getShape(){return this._shape||(this._shape=this.createCircleShape()),this._shape}hasShape(){return!0}setShapeProperty(e){if(e!==null)throw new Error("Cannot set the shapeProperty of a Circle to something non-null, it handles this itself");return this}mutate(e){return super.mutate(e)}}Circle.prototype._mutatorKeys=CIRCLE_OPTION_KEYS.concat(Path.prototype._mutatorKeys);Circle.prototype.drawableMarkFlags=Path.prototype.drawableMarkFlags.concat(["radius"]).filter(o=>o!=="shape");scenery.register("Circle",Circle);const DOM_OPTION_KEYS=["element","preventTransform"],isJQueryElement=o=>!!(o&&o.jquery);class DOM extends Node$2{constructor(e,t){assert&&assert(t===void 0||Object.getPrototypeOf(t)===Object.prototype,"Extra prototype on Node options object is a code smell"),assert&&assert(e instanceof window.Element||e.jquery,"DOM nodes need to be passed an HTML/DOM element or a jQuery selection like $( ... )"),isJQueryElement(e)&&(e=e[0],assert&&assert(e instanceof window.Element)),super(),this._container=document.createElement("div"),this._$container=$(this._container),this._$container.css("position","absolute"),this._$container.css("left",0),this._$container.css("top",0),this.invalidateDOMLock=!1,this._preventTransform=!1,t=extendDefined({element:e},t),this.mutate(t),this.setRendererBitmask(Renderer.bitmaskDOM)}calculateDOMBounds(){const e=$(this._element);return new Bounds2(0,0,e.width(),e.height())}invalidateDOM(){if(this.invalidateDOMLock)return;this.invalidateDOMLock=!0;const e=document.createElement("div");$(e).css({display:"hidden",padding:"0 !important",margin:"0 !important",position:"absolute",left:0,top:0,width:65535,height:65535}),this._container.removeChild(this._element),e.appendChild(this._element),document.body.appendChild(e);const t=this.calculateDOMBounds();this.invalidateSelf(t),this._$container.width(t.getWidth()),this._$container.height(t.getHeight()),document.body.removeChild(e),e.removeChild(this._element),this._container.appendChild(this._element),this.invalidateDOMLock=!1}createDOMDrawable(e,t){return DOMDrawable$1.createFromPool(e,t)}isPainted(){return!0}setElement(e){return assert&&assert(!this._element,"We should only ever attach one DOMElement to a DOM node"),this._element!==e&&(this._element&&this._container.removeChild(this._element),this._element=e,this._container.appendChild(this._element),this.invalidateDOM()),this}set element(e){this.setElement(e)}get element(){return this.getElement()}getElement(){return this._element}setPreventTransform(e){this._preventTransform!==e&&(this._preventTransform=e)}set preventTransform(e){this.setPreventTransform(e)}get preventTransform(){return this.isTransformPrevented()}isTransformPrevented(){return this._preventTransform}mutate(e){return super.mutate(e)}}DOM.prototype._mutatorKeys=DOM_OPTION_KEYS.concat(Node$2.prototype._mutatorKeys);scenery.register("DOM",DOM);const LINE_OPTION_KEYS=["p1","p2","x1","y1","x2","y2"];class Line extends Path{constructor(e,t,n,r,s){super(null),this._x1=0,this._y1=0,this._x2=0,this._y2=0,typeof e=="object"?e instanceof Vector2?(assert&&assert(n===void 0||typeof n=="object"),assert&&assert(n===void 0||Object.getPrototypeOf(n)===Object.prototype,"Extra prototype on Node options object is a code smell"),s=extendDefined({x1:e.x,y1:e.y,x2:t.x,y2:t.y,strokePickable:!0},n)):(assert&&assert(t===void 0),assert&&assert(e===void 0||Object.getPrototypeOf(e)===Object.prototype,"Extra prototype on Node options object is a code smell"),s=extendDefined({strokePickable:!0},e)):(assert&&assert(e!==void 0&&typeof t=="number"&&typeof n=="number"&&typeof r=="number"),assert&&assert(s===void 0||Object.getPrototypeOf(s)===Object.prototype,"Extra prototype on Node options object is a code smell"),s=extendDefined({x1:e,y1:t,x2:n,y2:r,strokePickable:!0},s)),this.mutate(s)}setLine(e,t,n,r){assert&&assert(e!==void 0&&t!==void 0&&n!==void 0&&r!==void 0,"parameters need to be defined"),this._x1=e,this._y1=t,this._x2=n,this._y2=r;const s=this._drawables.length;for(let a=0;a<s;a++)this._drawables[a].markDirtyLine();return this.invalidateLine(),this}setPoint1(e,t){typeof e=="number"?(assert&&assert(e!==void 0&&t!==void 0,"parameters need to be defined"),this._x1=e,this._y1=t):(assert&&assert(e.x!==void 0&&e.y!==void 0,"parameters need to be defined"),this._x1=e.x,this._y1=e.y);const n=this._drawables.length;for(let r=0;r<n;r++)this._drawables[r].markDirtyP1();return this.invalidateLine(),this}set p1(e){this.setPoint1(e)}get p1(){return new Vector2(this._x1,this._y1)}setPoint2(e,t){typeof e=="number"?(assert&&assert(e!==void 0&&t!==void 0,"parameters need to be defined"),this._x2=e,this._y2=t):(assert&&assert(e.x!==void 0&&e.y!==void 0,"parameters need to be defined"),this._x2=e.x,this._y2=e.y);const n=this._drawables.length;for(let r=0;r<n;r++)this._drawables[r].markDirtyP2();return this.invalidateLine(),this}set p2(e){this.setPoint2(e)}get p2(){return new Vector2(this._x2,this._y2)}setX1(e){if(this._x1!==e){this._x1=e;const t=this._drawables.length;for(let n=0;n<t;n++)this._drawables[n].markDirtyX1();this.invalidateLine()}return this}set x1(e){this.setX1(e)}get x1(){return this.getX1()}getX1(){return this._x1}setY1(e){if(this._y1!==e){this._y1=e;const t=this._drawables.length;for(let n=0;n<t;n++)this._drawables[n].markDirtyY1();this.invalidateLine()}return this}set y1(e){this.setY1(e)}get y1(){return this.getY1()}getY1(){return this._y1}setX2(e){if(this._x2!==e){this._x2=e;const t=this._drawables.length;for(let n=0;n<t;n++)this._drawables[n].markDirtyX2();this.invalidateLine()}return this}set x2(e){this.setX2(e)}get x2(){return this.getX2()}getX2(){return this._x2}setY2(e){if(this._y2!==e){this._y2=e;const t=this._drawables.length;for(let n=0;n<t;n++)this._drawables[n].markDirtyY2();this.invalidateLine()}return this}set y2(e){this.setY2(e)}get y2(){return this.getY2()}getY2(){return this._y2}createLineShape(){return Shape$1.lineSegment(this._x1,this._y1,this._x2,this._y2).makeImmutable()}invalidateLine(){assert&&assert(isFinite(this._x1),`A line needs to have a finite x1 (${this._x1})`),assert&&assert(isFinite(this._y1),`A line needs to have a finite y1 (${this._y1})`),assert&&assert(isFinite(this._x2),`A line needs to have a finite x2 (${this._x2})`),assert&&assert(isFinite(this._y2),`A line needs to have a finite y2 (${this._y2})`),this._shape=null,this.invalidatePath()}containsPointSelf(e){return this._strokePickable?super.containsPointSelf(e):!1}canvasPaintSelf(e,t){LineCanvasDrawable$1.prototype.paintCanvas(e,this,t)}computeShapeBounds(){if(this._stroke){const e=this.getLineCap(),t=this.getLineWidth()/2;if(e==="round")return new Bounds2(Math.min(this._x1,this._x2)-t,Math.min(this._y1,this._y2)-t,Math.max(this._x1,this._x2)+t,Math.max(this._y1,this._y2)+t);{const n=this._x2-this._x1,r=this._y2-this._y1,s=Math.sqrt(n*n+r*r);if(s===0)return new Bounds2(this._x1-t,this._y1-t,this._x2+t,this._y2+t);const a=t*n/s,l=t*r/s,d=Bounds2.NOTHING.copy();return e==="butt"?(d.addCoordinates(this._x1-l,this._y1+a),d.addCoordinates(this._x1+l,this._y1-a),d.addCoordinates(this._x2-l,this._y2+a),d.addCoordinates(this._x2+l,this._y2-a)):(assert&&assert(e==="square"),d.addCoordinates(this._x1-a-l,this._y1-l+a),d.addCoordinates(this._x1-a+l,this._y1-l-a),d.addCoordinates(this._x2+a-l,this._y2+l+a),d.addCoordinates(this._x2+a+l,this._y2+l-a)),d}}else{const e=Bounds2.NOTHING.copy();return e.addCoordinates(this._x1,this._y1),e.addCoordinates(this._x2,this._y2),e}}createSVGDrawable(e,t){return LineSVGDrawable$1.createFromPool(e,t)}createCanvasDrawable(e,t){return LineCanvasDrawable$1.createFromPool(e,t)}setShape(e){if(e!==null)throw new Error("Cannot set the shape of a Line to something non-null");return this.invalidatePath(),this}getShape(){return this._shape||(this._shape=this.createLineShape()),this._shape}hasShape(){return!0}setShapeProperty(e){if(e!==null)throw new Error("Cannot set the shapeProperty of a Line to something non-null, it handles this itself");return this}mutate(e){return super.mutate(e)}getFillRendererBitmask(){return Renderer.bitmaskCanvas|Renderer.bitmaskSVG|Renderer.bitmaskDOM|Renderer.bitmaskWebGL}}Line.prototype._mutatorKeys=LINE_OPTION_KEYS.concat(Path.prototype._mutatorKeys);Line.prototype.drawableMarkFlags=Path.prototype.drawableMarkFlags.concat(["line","p1","p2","x1","x2","y1","y2"]).filter(o=>o!=="shape");scenery.register("Line",Line);const RECTANGLE_OPTION_KEYS=["rectBounds","rectSize","rectX","rectY","rectWidth","rectHeight","cornerRadius","cornerXRadius","cornerYRadius"],SuperType$1=Sizable(Path);class Rectangle extends SuperType$1{constructor(e,t,n,r,s,a,l){const d={sizable:!1};super(null,d);let c={};this._rectX=0,this._rectY=0,this._rectWidth=0,this._rectHeight=0,this._cornerXRadius=0,this._cornerYRadius=0,typeof e=="object"?e instanceof Bounds2?typeof t!="number"?(assert&&assert(arguments.length===1||arguments.length===2,"new Rectangle( bounds, { ... } ) should only take one or two arguments"),assert&&assert(t===void 0||typeof t=="object","new Rectangle( bounds, { ... } ) second parameter should only ever be an options object"),assert&&assert(t===void 0||Object.getPrototypeOf(t)===Object.prototype,"Extra prototype on Node options object is a code smell"),assert&&t&&(assert(t.rectWidth===void 0,"Should not specify rectWidth in multiple ways"),assert(t.rectHeight===void 0,"Should not specify rectHeight in multiple ways"),assert(t.rectBounds===void 0,"Should not specify rectBounds in multiple ways")),c=combineOptions(c,{rectBounds:e},t)):(assert&&assert(arguments.length===3||arguments.length===4,"new Rectangle( bounds, cornerXRadius, cornerYRadius, { ... } ) should only take three or four arguments"),assert&&assert(r===void 0||typeof r=="object","new Rectangle( bounds, cornerXRadius, cornerYRadius, { ... } ) fourth parameter should only ever be an options object"),assert&&assert(r===void 0||Object.getPrototypeOf(r)===Object.prototype,"Extra prototype on Node options object is a code smell"),assert&&r&&(assert(r.rectWidth===void 0,"Should not specify rectWidth in multiple ways"),assert(r.rectHeight===void 0,"Should not specify rectHeight in multiple ways"),assert(r.rectBounds===void 0,"Should not specify rectBounds in multiple ways"),assert(r.cornerXRadius===void 0,"Should not specify cornerXRadius in multiple ways"),assert(r.cornerYRadius===void 0,"Should not specify cornerYRadius in multiple ways"),assert(r.cornerRadius===void 0,"Should not specify cornerRadius in multiple ways")),c=combineOptions(c,{rectBounds:e,cornerXRadius:t,cornerYRadius:n},r)):c=combineOptions(c,e):a===void 0?(assert&&assert(arguments.length===4||arguments.length===5,"new Rectangle( x, y, width, height, { ... } ) should only take four or five arguments"),assert&&assert(s===void 0||typeof s=="object","new Rectangle( x, y, width, height, { ... } ) fifth parameter should only ever be an options object"),assert&&assert(s===void 0||Object.getPrototypeOf(s)===Object.prototype,"Extra prototype on Node options object is a code smell"),assert&&s&&(assert(s.rectX===void 0,"Should not specify rectX in multiple ways"),assert(s.rectY===void 0,"Should not specify rectY in multiple ways"),assert(s.rectWidth===void 0,"Should not specify rectWidth in multiple ways"),assert(s.rectHeight===void 0,"Should not specify rectHeight in multiple ways"),assert(s.rectBounds===void 0,"Should not specify rectBounds in multiple ways")),c=combineOptions(c,{rectX:e,rectY:t,rectWidth:n,rectHeight:r},s)):(assert&&assert(arguments.length===6||arguments.length===7,"new Rectangle( x, y, width, height, cornerXRadius, cornerYRadius{ ... } ) should only take six or seven arguments"),assert&&assert(c===void 0||typeof c=="object","new Rectangle( x, y, width, height, cornerXRadius, cornerYRadius{ ... } ) seventh parameter should only ever be an options object"),assert&&assert(c===void 0||Object.getPrototypeOf(c)===Object.prototype,"Extra prototype on Node options object is a code smell"),assert&&l&&(assert(l.rectX===void 0,"Should not specify rectX in multiple ways"),assert(l.rectY===void 0,"Should not specify rectY in multiple ways"),assert(l.rectWidth===void 0,"Should not specify rectWidth in multiple ways"),assert(l.rectHeight===void 0,"Should not specify rectHeight in multiple ways"),assert(l.rectBounds===void 0,"Should not specify rectBounds in multiple ways"),assert(l.cornerXRadius===void 0,"Should not specify cornerXRadius in multiple ways"),assert(l.cornerYRadius===void 0,"Should not specify cornerYRadius in multiple ways"),assert(l.cornerRadius===void 0,"Should not specify cornerRadius in multiple ways")),c=combineOptions(c,{rectX:e,rectY:t,rectWidth:n,rectHeight:r,cornerXRadius:s,cornerYRadius:a},l)),this.localPreferredWidthProperty.lazyLink(this.updatePreferredSizes.bind(this)),this.localPreferredHeightProperty.lazyLink(this.updatePreferredSizes.bind(this)),this.localMinimumWidthProperty.lazyLink(this.updatePreferredSizes.bind(this)),this.localMinimumHeightProperty.lazyLink(this.updatePreferredSizes.bind(this)),this.mutate(c)}getMaximumArcSize(){return Math.min(this._rectWidth/2,this._rectHeight/2)}getStrokeRendererBitmask(){let e=super.getStrokeRendererBitmask();const t=this.getStroke();return t&&!(t instanceof Gradient)&&!(t instanceof Pattern)&&!this.hasLineDash()&&(this.getLineJoin()==="miter"||this.getLineJoin()==="round"&&Features.borderRadius)&&(e|=Renderer.bitmaskDOM),this.hasStroke()||(e|=Renderer.bitmaskWebGL),e}getPathRendererBitmask(){let e=Renderer.bitmaskCanvas|Renderer.bitmaskSVG;const t=this.getMaximumArcSize();return(!this.hasStroke()||this.getLineWidth()<=this._rectHeight&&this.getLineWidth()<=this._rectWidth)&&(!this.isRounded()||Features.borderRadius&&this._cornerXRadius===this._cornerYRadius)&&this._cornerYRadius<=t&&this._cornerXRadius<=t&&(e|=Renderer.bitmaskDOM),!this.hasStroke()&&!this.isRounded()&&(e|=Renderer.bitmaskWebGL),e}setRect(e,t,n,r,s,a){const l=s!==void 0,d=a!==void 0;if(assert&&assert(isFinite(e)&&isFinite(t)&&isFinite(n)&&isFinite(r),"x/y/width/height should be finite numbers"),assert&&assert(!l||isFinite(s)&&(!d||isFinite(a)),"Corner radii (if provided) should be finite numbers"),this._rectX===e&&this._rectY===t&&this._rectWidth===n&&this._rectHeight===r&&(!l||this._cornerXRadius===s)&&(!d||this._cornerYRadius===a))return this;this._rectX=e,this._rectY=t,this._rectWidth=n,this._rectHeight=r,this._cornerXRadius=l?s:this._cornerXRadius,this._cornerYRadius=d?a:this._cornerYRadius;const c=this._drawables.length;for(let y=0;y<c;y++)this._drawables[y].markDirtyRectangle();return this.invalidateRectangle(),this}setRectX(e){if(assert&&assert(isFinite(e),"rectX should be a finite number"),this._rectX!==e){this._rectX=e;const t=this._drawables.length;for(let n=0;n<t;n++)this._drawables[n].markDirtyX();this.invalidateRectangle()}return this}set rectX(e){this.setRectX(e)}get rectX(){return this.getRectX()}getRectX(){return this._rectX}setRectY(e){if(assert&&assert(isFinite(e),"rectY should be a finite number"),this._rectY!==e){this._rectY=e;const t=this._drawables.length;for(let n=0;n<t;n++)this._drawables[n].markDirtyY();this.invalidateRectangle()}return this}set rectY(e){this.setRectY(e)}get rectY(){return this.getRectY()}getRectY(){return this._rectY}setRectWidth(e){if(assert&&assert(isFinite(e),"rectWidth should be a finite number"),this._rectWidth!==e){this._rectWidth=e;const t=this._drawables.length;for(let n=0;n<t;n++)this._drawables[n].markDirtyWidth();this.invalidateRectangle()}return this}set rectWidth(e){this.setRectWidth(e)}get rectWidth(){return this.getRectWidth()}getRectWidth(){return this._rectWidth}setRectHeight(e){if(assert&&assert(isFinite(e),"rectHeight should be a finite number"),this._rectHeight!==e){this._rectHeight=e;const t=this._drawables.length;for(let n=0;n<t;n++)this._drawables[n].markDirtyHeight();this.invalidateRectangle()}return this}set rectHeight(e){this.setRectHeight(e)}get rectHeight(){return this.getRectHeight()}getRectHeight(){return this._rectHeight}setCornerXRadius(e){if(assert&&assert(isFinite(e),"cornerXRadius should be a finite number"),this._cornerXRadius!==e){this._cornerXRadius=e;const t=this._drawables.length;for(let n=0;n<t;n++)this._drawables[n].markDirtyCornerXRadius();this.invalidateRectangle()}return this}set cornerXRadius(e){this.setCornerXRadius(e)}get cornerXRadius(){return this.getCornerXRadius()}getCornerXRadius(){return this._cornerXRadius}setCornerYRadius(e){if(assert&&assert(isFinite(e),"cornerYRadius should be a finite number"),this._cornerYRadius!==e){this._cornerYRadius=e;const t=this._drawables.length;for(let n=0;n<t;n++)this._drawables[n].markDirtyCornerYRadius();this.invalidateRectangle()}return this}set cornerYRadius(e){this.setCornerYRadius(e)}get cornerYRadius(){return this.getCornerYRadius()}getCornerYRadius(){return this._cornerYRadius}setRectBounds(e){return this.setRect(e.x,e.y,e.width,e.height),this}set rectBounds(e){this.setRectBounds(e)}get rectBounds(){return this.getRectBounds()}getRectBounds(){return Bounds2.rect(this._rectX,this._rectY,this._rectWidth,this._rectHeight)}setRectSize(e){return this.setRectWidth(e.width),this.setRectHeight(e.height),this}set rectSize(e){this.setRectSize(e)}get rectSize(){return this.getRectSize()}getRectSize(){return new Dimension2(this._rectWidth,this._rectHeight)}setRectWidthFromRight(e){if(this._rectWidth!==e){const t=this._rectX+this._rectWidth;this.setRectWidth(e),this.setRectX(t-e)}return this}set rectWidthFromRight(e){this.setRectWidthFromRight(e)}get rectWidthFromRight(){return this.getRectWidth()}setRectHeightFromBottom(e){if(this._rectHeight!==e){const t=this._rectY+this._rectHeight;this.setRectHeight(e),this.setRectY(t-e)}return this}set rectHeightFromBottom(e){this.setRectHeightFromBottom(e)}get rectHeightFromBottom(){return this.getRectHeight()}isRounded(){return this._cornerXRadius!==0&&this._cornerYRadius!==0}computeShapeBounds(){let e=new Bounds2(this._rectX,this._rectY,this._rectX+this._rectWidth,this._rectY+this._rectHeight);return this._stroke&&(e=e.dilated(this.getLineWidth()/2)),e}createRectangleShape(){if(this.isRounded()){const e=Math.min(this._rectWidth/2,this._rectHeight/2);return Shape$1.roundRectangle(this._rectX,this._rectY,this._rectWidth,this._rectHeight,Math.min(e,this._cornerXRadius),Math.min(e,this._cornerYRadius)).makeImmutable()}else return Shape$1.rectangle(this._rectX,this._rectY,this._rectWidth,this._rectHeight).makeImmutable()}invalidateRectangle(){assert&&assert(isFinite(this._rectX),`A rectangle needs to have a finite x (${this._rectX})`),assert&&assert(isFinite(this._rectY),`A rectangle needs to have a finite y (${this._rectY})`),assert&&assert(this._rectWidth>=0&&isFinite(this._rectWidth),`A rectangle needs to have a non-negative finite width (${this._rectWidth})`),assert&&assert(this._rectHeight>=0&&isFinite(this._rectHeight),`A rectangle needs to have a non-negative finite height (${this._rectHeight})`),assert&&assert(this._cornerXRadius>=0&&isFinite(this._cornerXRadius),`A rectangle needs to have a non-negative finite arcWidth (${this._cornerXRadius})`),assert&&assert(this._cornerYRadius>=0&&isFinite(this._cornerYRadius),`A rectangle needs to have a non-negative finite arcHeight (${this._cornerYRadius})`),this._shape=null,this.invalidatePath(),this.invalidateSupportedRenderers()}updatePreferredSizes(){let e=this.localPreferredWidth,t=this.localPreferredHeight;e!==null&&(e=Math.max(e,this.localMinimumWidth||0)),t!==null&&(t=Math.max(t,this.localMinimumHeight||0)),e!==null&&(this.rectWidth=this.hasStroke()?e-this.lineWidth:e),t!==null&&(this.rectHeight=this.hasStroke()?t-this.lineWidth:t)}invalidateStroke(){super.invalidateStroke(),this.updatePreferredSizes()}containsPointSelf(e){const t=this._rectX,n=this._rectY,r=this._rectWidth,s=this._rectHeight,a=this._cornerXRadius,l=this._cornerYRadius,d=this.getLineWidth()/2;let c=!0;if(this._strokePickable){const y=this.isRounded();if(!y&&this.getLineJoin()==="bevel")return super.containsPointSelf(e);const m=this.getLineJoin()==="miter"&&!y;c=c&&Rectangle.intersects(t-d,n-d,r+2*d,s+2*d,m?0:a+d,m?0:l+d,e)}return this._fillPickable?this._strokePickable?c:Rectangle.intersects(t,n,r,s,a,l,e):this._strokePickable?c&&!Rectangle.intersects(t+d,n+d,r-2*d,s-2*d,a-d,l-d,e):!1}intersectsBoundsSelf(e){return!this.computeShapeBounds().intersection(e).isEmpty()}canvasPaintSelf(e,t){RectangleCanvasDrawable$1.prototype.paintCanvas(e,this,t)}createDOMDrawable(e,t){return RectangleDOMDrawable$1.createFromPool(e,t)}createSVGDrawable(e,t){return RectangleSVGDrawable$1.createFromPool(e,t)}createCanvasDrawable(e,t){return RectangleCanvasDrawable$1.createFromPool(e,t)}createWebGLDrawable(e,t){return RectangleWebGLDrawable$1.createFromPool(e,t)}setShape(e){if(e!==null)throw new Error("Cannot set the shape of a Rectangle to something non-null");return this.invalidatePath(),this}getShape(){return this._shape||(this._shape=this.createRectangleShape()),this._shape}hasShape(){return!0}setShapeProperty(e){if(e!==null)throw new Error("Cannot set the shapeProperty of a Rectangle to something non-null, it handles this itself");return this}setCornerRadius(e){return this.setCornerXRadius(e),this.setCornerYRadius(e),this}set cornerRadius(e){this.setCornerRadius(e)}get cornerRadius(){return this.getCornerRadius()}getCornerRadius(){return assert&&assert(this._cornerXRadius===this._cornerYRadius,"getCornerRadius() invalid if x/y radii are different"),this._cornerXRadius}mutate(e){return super.mutate(e)}static intersects(e,t,n,r,s,a,l){const d=l.x>=e&&l.x<=e+n&&l.y>=t&&l.y<=t+r;if(!d||s<=0||a<=0)return d;const c=Math.min(n/2,r/2);s=Math.min(c,s),a=Math.min(c,a);let y,m,O=!1;if(l.x<e+n/2?(y=e+s,O=O||l.x>=y):(y=e+n-s,O=O||l.x<=y),O||(l.y<t+r/2?(m=t+a,O=O||l.y>=m):(m=t+r-a,O=O||l.y<=m),O))return!0;let D=l.x-y,z=l.y-m;return D/=s,z/=a,D*=D,z*=z,D+z<=1}static rect(e,t,n,r,s){return new Rectangle(e,t,n,r,0,0,s)}static roundedRect(e,t,n,r,s,a,l){return new Rectangle(e,t,n,r,s,a,l)}static bounds(e,t){return new Rectangle(e.minX,e.minY,e.width,e.height,t)}static roundedBounds(e,t,n,r){return new Rectangle(e.minX,e.minY,e.width,e.height,t,n,r)}static dimension(e,t){return new Rectangle(0,0,e.width,e.height,0,0,t)}}Rectangle.prototype._mutatorKeys=[...RECTANGLE_OPTION_KEYS,...SuperType$1.prototype._mutatorKeys];Rectangle.prototype.drawableMarkFlags=Path.prototype.drawableMarkFlags.concat(["x","y","width","height","cornerXRadius","cornerYRadius"]).filter(o=>o!=="shape");scenery.register("Rectangle",Rectangle);class Sprites extends Node$2{constructor(e){const t=optionize()({sprites:[],spriteInstances:[],hitTestSprites:!1,renderer:"webgl"},e);super(),this._sprites=t.sprites,this._spriteInstances=t.spriteInstances,this._hitTestSprites=t.hitTestSprites,this.setRendererBitmask(Renderer.bitmaskCanvas|Renderer.bitmaskWebGL),this.mutate(t)}setCanvasBounds(e){this.invalidateSelf(e)}set canvasBounds(e){this.setCanvasBounds(e)}get canvasBounds(){return this.getCanvasBounds()}getCanvasBounds(){return this.getSelfBounds()}canvasPaintSelf(e,t){SpritesCanvasDrawable$1.prototype.paintCanvas(e,this,t)}createCanvasDrawable(e,t){return SpritesCanvasDrawable$1.createFromPool(e,t)}createWebGLDrawable(e,t){return SpritesWebGLDrawable$1.createFromPool(e,t)}containsPointSelf(e){return super.containsPointSelf(e)?this._hitTestSprites?!!this.getSpriteInstanceFromPoint(e):!0:!1}getSpriteInstanceFromPoint(e){for(let t=this._spriteInstances.length-1;t>=0;t--)if(this._spriteInstances[t].containsPoint(e))return this._spriteInstances[t];return null}getSelfShape(){return this._hitTestSprites?Shape$1.union(this._spriteInstances.map(e=>e.getShape())):Shape$1.bounds(this.selfBounds)}isPainted(){return!0}invalidatePaint(){const e=this._drawables.length;for(let t=0;t<e;t++)this._drawables[t].markDirty()}mutate(e){return super.mutate(e)}}Sprites.prototype._mutatorKeys=["canvasBounds"].concat(Node$2.prototype._mutatorKeys);scenery.register("Sprites",Sprites);const WEBGL_NODE_OPTION_KEYS=["canvasBounds"],Oh=class Oh extends Node$2{constructor(e,t){super(t),this.setRendererBitmask(Renderer.bitmaskWebGL),this.painterType=e}setCanvasBounds(e){return this.invalidateSelf(e),this}set canvasBounds(e){this.setCanvasBounds(e)}get canvasBounds(){return this.getCanvasBounds()}getCanvasBounds(){return this.getSelfBounds()}isPainted(){return!0}invalidatePaint(){const e=this._drawables.length;for(let t=0;t<e;t++)this._drawables[t].markDirty()}containsPointSelf(e){return!1}getSelfShape(){return new Shape$1}canvasPaintSelf(e,t){assert&&assert(!1,"unimplemented: canvasPaintSelf in WebGLNode")}renderToCanvasSelf(e,t){const n=e.canvas.width,r=e.canvas.height,s=document.createElement("canvas");s.width=n,s.height=r;const a={antialias:!0,preserveDrawingBuffer:!0},l=s.getContext("webgl",a)||s.getContext("experimental-webgl",a);Utils.applyWebGLContextDefaults(l);const d=new Matrix3().rowMajor(2/n,0,-1,0,-2/r,1,0,0,1);l.viewport(0,0,n,r);const c=this.painterType,y=new c(l,this);y.paint(t,d),y.dispose(),d.freeToPool(),l.flush(),e.context.setTransform(1,0,0,1,0,0),e.context.drawImage(s,0,0),e.context.restore()}createWebGLDrawable(e,t){return WebGLNodeDrawable$1.createFromPool(e,t)}mutate(e){return super.mutate(e)}};Oh.PAINTED_NOTHING=0,Oh.PAINTED_SOMETHING=1;let WebGLNode=Oh;WebGLNode.prototype._mutatorKeys=WEBGL_NODE_OPTION_KEYS.concat(Node$2.prototype._mutatorKeys);scenery.register("WebGLNode",WebGLNode);class Plane extends Rectangle{constructor(e){super(-2e3,-2e3,6e3,6e3,e)}}scenery.register("Plane",Plane);const Leaf=memoize(o=>class extends o{constructor(...t){super(...t)}insertChild(t,n){throw new Error("Attempt to insert child into Leaf")}removeChildWithIndex(t,n){throw new Error("Attempt to remove child from Leaf")}});scenery.register("Leaf",Leaf);class Spacer extends Leaf(Node$2){constructor(e,t,n){assert&&assert(isFinite(e),"width should be a finite number"),assert&&assert(isFinite(t),"height should be a finite number"),super(),this.localBounds=new Bounds2(0,0,e,t),this.mutate(n)}}scenery.register("Spacer",Spacer);class HStrut extends Spacer{constructor(e,t){super(e,0,t)}}scenery.register("HStrut",HStrut);class VStrut extends Spacer{constructor(e,t){super(0,e,t)}}scenery.register("VStrut",VStrut);let globalIdCounter$3=1;const scratchVector=new Vector2(0,0);class SpriteImage extends Imageable$1(Object){constructor(e,t,n){assert&&assert(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement);const r={hitTestPixels:!1,pickable:!0};isTReadOnlyProperty(e)?r.imageProperty=e:r.image=e;const s=optionize()(r,n);super(),this.id=globalIdCounter$3++,this.offset=t,this.pickable=s.pickable,this.shape=null,this.imageData=null,isTReadOnlyProperty(e)?this.imageProperty=e:this.image=e,mutate(this,Object.keys(Imageable$1.DEFAULT_OPTIONS),s)}get width(){return this.imageWidth}get height(){return this.imageHeight}getShape(){if(!this.pickable)return new Shape$1;if(!this.shape){if(this.hitTestPixels)if(this.ensureImageData(),this.imageData)this.shape=Imageable$1.hitTestDataToShape(this.imageData,this.width,this.height);else return new Shape$1;else if(this.width&&this.height)this.shape=Shape$1.rect(0,0,this.width,this.height);else return new Shape$1;this.shape=this.shape.transformed(Matrix3.translation(-this.offset.x,-this.offset.y))}return this.shape}ensureImageData(){!this.imageData&&this.width&&this.height&&(this.imageData=Imageable$1.getHitTestData(this.image,this.width,this.height))}containsPoint(e){if(!this.pickable)return!1;const t=this.width,n=this.height;if(!t&&!n)return!1;const r=scratchVector.set(e).add(this.offset);return r.x<0||r.y<0||r.x>t||r.y>n?!1:this.hitTestPixels?(this.ensureImageData(),this.imageData?Imageable$1.testHitTestData(this.imageData,t,n,r):!1):!0}}scenery.register("SpriteImage",SpriteImage);class Sprite{constructor(e){this.imageProperty=new Property(e)}getShape(){return this.imageProperty.value.getShape()}containsPoint(e){return this.imageProperty.value.containsPoint(e)}}scenery.register("Sprite",Sprite);class PaintObserver{constructor(e){this.primary=null,this.changeCallback=e,this.notifyChangeCallback=this.notifyChanged.bind(this),this.updateSecondaryListener=this.updateSecondary.bind(this),this.secondaryPropertyCountsMap={}}setPrimary(e){e!==this.primary&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] primary update"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.detachPrimary(this.primary),this.primary=e,this.attachPrimary(e),this.notifyChangeCallback(),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop())}clean(){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] clean"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.detachPrimary(this.primary),this.primary=null,sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}updateSecondary(e,t,n){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] secondary update"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();const r=this.secondaryPropertyCountsMap[n.id];assert&&assert(r>0,"We should always be removing at least one reference");for(let s=0;s<r;s++)this.attachSecondary(e);this.notifyChangeCallback(),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}attachPrimary(e){if(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] attachPrimary"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),isTReadOnlyProperty(e))sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] add Property listener"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.secondaryLazyLinkProperty(e),this.attachSecondary(e.get()),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop();else if(e instanceof Color)sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] Color changed to immutable"),e.setImmutable();else if(e instanceof Gradient){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] add Gradient listeners"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();for(let t=0;t<e.stops.length;t++)this.attachPrimary(e.stops[t].color);sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}detachPrimary(e){if(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] detachPrimary"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),isTReadOnlyProperty(e))sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] remove Property listener"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.secondaryUnlinkProperty(e),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop();else if(e instanceof Gradient){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] remove Gradient listeners"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();for(let t=0;t<e.stops.length;t++)this.detachPrimary(e.stops[t].color);sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}attachSecondary(e){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] attachSecondary"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),e instanceof Color&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] Color set to immutable"),e.setImmutable()),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}notifyChanged(){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] changed"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.primary instanceof Gradient&&this.primary.invalidateCanvasGradient(),this.changeCallback(),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}secondaryLazyLinkProperty(e){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[PaintObserver] secondaryLazyLinkProperty ${e._id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();const t=e.id;this.secondaryPropertyCountsMap[t]?this.secondaryPropertyCountsMap[t]++:(this.secondaryPropertyCountsMap[t]=1,e.lazyLink(this.updateSecondaryListener)),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}secondaryUnlinkProperty(e){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[PaintObserver] secondaryUnlinkProperty ${e._id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();const t=e.id,n=--this.secondaryPropertyCountsMap[t];assert&&assert(n>=0,"We should have had a reference before"),n===0&&(delete this.secondaryPropertyCountsMap[t],e.isDisposed||e.unlink(this.updateSecondaryListener)),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}}scenery.register("PaintObserver",PaintObserver);class PaintColorProperty extends Property{constructor(e,t){const n=PaintDef.toColor(e),r=optionize()({luminanceFactor:0,valueComparisonStrategy:"equalsFunction"},t);super(n,r),this._paint=null,this._luminanceFactor=r.luminanceFactor,this._changeListener=this.invalidatePaint.bind(this),this._paintObserver=new PaintObserver(this._changeListener),this.setPaint(e)}setPaint(e){assert&&assert(PaintDef.isPaintDef(e)),this._paint=e,this._paintObserver.setPrimary(e)}set paint(e){this.setPaint(e)}get paint(){return this.getPaint()}getPaint(){return this._paint}setLuminanceFactor(e){assert&&assert(e>=-1&&e<=1),this.luminanceFactor!==e&&(this._luminanceFactor=e,this.invalidatePaint())}set luminanceFactor(e){this.setLuminanceFactor(e)}get luminanceFactor(){return this.getLuminanceFactor()}getLuminanceFactor(){return this._luminanceFactor}invalidatePaint(){this.value=PaintDef.toColor(this._paint).colorUtilsBrightness(this._luminanceFactor)}dispose(){this.paint=null,super.dispose()}}scenery.register("PaintColorProperty",PaintColorProperty);class PaintSVGState{constructor(){this.initialize()}initialize(){this.svgBlock=null,this.fillStyle="none",this.strokeStyle="none",this.fillPaint=null,this.strokePaint=null,this.updateBaseStyle(),this.strokeDetailStyle=""}dispose(){this.releaseFillPaint(),this.releaseStrokePaint()}releaseFillPaint(){this.fillPaint&&(this.svgBlock.decrementPaint(this.fillPaint),this.fillPaint=null)}releaseStrokePaint(){this.strokePaint&&(this.svgBlock.decrementPaint(this.strokePaint),this.strokePaint=null)}updateFill(e,t){assert&&assert(this.svgBlock===e);const n=paintToSVGStyle(t,e);t!==this.fillPaint&&(this.releaseFillPaint(),t&&t.isPaint&&(this.fillPaint=t,e.incrementPaint(t))),n!==this.fillStyle&&(this.fillStyle=n,this.updateBaseStyle())}updateStroke(e,t){assert&&assert(this.svgBlock===e);const n=paintToSVGStyle(t,e);t!==this.strokePaint&&(this.releaseStrokePaint(),t&&t.isPaint&&(this.strokePaint=t,e.incrementPaint(t))),n!==this.strokeStyle&&(this.strokeStyle=n,this.updateBaseStyle())}updateBaseStyle(){this.baseStyle=`fill: ${this.fillStyle}; stroke: ${this.strokeStyle};`}updateStrokeDetailStyle(e){let t="";const n=e.getLineWidth();n!==1&&(t+=`stroke-width: ${n};`);const r=e.getLineCap();r!=="butt"&&(t+=`stroke-linecap: ${r};`);const s=e.getLineJoin();s!=="miter"&&(t+=`stroke-linejoin: ${s};`);const a=e.getMiterLimit();t+=`stroke-miterlimit: ${a};`,e.hasLineDash()&&(t+=`stroke-dasharray: ${e.getLineDash().join(",")};`,t+=`stroke-dashoffset: ${e.getLineDashOffset()};`),this.strokeDetailStyle=t}updateSVGBlock(e){const t=this.svgBlock;t&&(this.fillPaint&&t.decrementPaint(this.fillPaint),this.strokePaint&&t.decrementPaint(this.strokePaint)),this.svgBlock=e,this.fillPaint&&e.incrementPaint(this.fillPaint),this.strokePaint&&e.incrementPaint(this.strokePaint)}}function paintToSVGStyle(o,e){return o?o.toCSS?o.toCSS():o.isPaint?`url(#${o.id}-${e?e.id:"noblock"})`:o:"none"}scenery.register("PaintSVGState",PaintSVGState);const scratchColor$1=new Color("transparent"),Il=class Il{constructor(e,t,n){this.lastColor=null,this.initialize(e,t,n)}isActiveSVGGradientStop(){return!!this.svgGradient}initialize(e,t,n){return sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] initialize: ${e.gradient.id} : ${t}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.svgGradient=e,this.color=n,this.ratio=t,this.svgElement=this.svgElement||document.createElementNS(svgns,"stop"),this.svgElement.setAttribute("offset",""+t),this.dirty=!0,this.update(),this.propertyListener=this.propertyListener||this.onPropertyChange.bind(this),this.colorListener=this.colorListener||this.markDirty.bind(this),isTReadOnlyProperty(n)?(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] adding Property listener: ${this.svgGradient.gradient.id} : ${this.ratio}`),n.lazyLink(this.propertyListener),n.value instanceof Color&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] adding Color listener: ${this.svgGradient.gradient.id} : ${this.ratio}`),n.value.changeEmitter.addListener(this.colorListener),this.lastColor=n.value)):n instanceof Color&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] adding Color listener: ${this.svgGradient.gradient.id} : ${this.ratio}`),n.changeEmitter.addListener(this.colorListener)),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop(),this}onPropertyChange(e,t){assert&&assert(this.isActiveSVGGradientStop());const n=this;this.lastColor!==null&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] removing Color listener: ${n.svgGradient.gradient.id} : ${this.ratio}`),this.lastColor.changeEmitter.removeListener(this.colorListener),this.lastColor=null),e instanceof Color&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] adding Color listener: ${n.svgGradient.gradient.id} : ${this.ratio}`),e.changeEmitter.addListener(this.colorListener),this.lastColor=e),this.markDirty()}markDirty(){assert&&assert(this.isActiveSVGGradientStop()),this.dirty=!0,this.svgGradient.markDirty()}update(){if(!this.dirty)return;this.dirty=!1,assert&&assert(this.isActiveSVGGradientStop());const e=this;sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] update: ${e.svgGradient.gradient.id} : ${this.ratio}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();let t=this.color;isTReadOnlyProperty(t)&&(t=t.value),t===null&&(t="transparent"),typeof t=="string"?scratchColor$1.setCSS(t):scratchColor$1.set(t);const n=`stop-opacity: ${scratchColor$1.a.toFixed(20)};`;scratchColor$1.alpha=1;const r=`stop-color: ${scratchColor$1.toCSS()};`;this.svgElement.setAttribute("style",`${r} ${n}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}dispose(){assert&&assert(this.isActiveSVGGradientStop());const e=this;sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] dispose: ${e.svgGradient.gradient.id} : ${this.ratio}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();const t=this.color;this.lastColor&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] removing Color listener: ${e.svgGradient.gradient.id} : ${this.ratio}`),this.lastColor.changeEmitter.removeListener(this.colorListener),this.lastColor=null),isTReadOnlyProperty(t)?(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] removing Property listener: ${e.svgGradient.gradient.id} : ${this.ratio}`),t.hasListener(this.propertyListener)&&t.unlink(this.propertyListener)):t instanceof Color&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] removing Color listener: ${e.svgGradient.gradient.id} : ${this.ratio}`),t.changeEmitter.removeListener(this.colorListener)),this.color=null,this.svgGradient=null,this.freeToPool(),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}freeToPool(){Il.pool.freeToPool(this)}};Il.pool=new Pool(Il);let SVGGradientStop=Il;scenery.register("SVGGradientStop",SVGGradientStop);class SVGGradient{constructor(e,t){this.initialize(e,t)}isActiveSVGGradient(){return!!this.svgBlock}initialize(e,t){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradient] initialize ${t.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.svgBlock=e,this.gradient=t;const n=this.definition!==void 0;this.definition=this.definition||this.createDefinition(),n||this.definition.setAttribute("gradientUnits","userSpaceOnUse"),t.transformMatrix?this.definition.setAttribute("gradientTransform",t.transformMatrix.getSVGTransform()):this.definition.removeAttribute("gradientTransform");const r=t.getSVGStops();this.stops=cleanArray(this.stops);for(let s=0;s<r.length;s++){const a=new SVGGradientStop(this,r[s].ratio,r[s].color);this.stops.push(a),this.definition.appendChild(a.svgElement)}this.dirty=!1,sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}markDirty(){if(!this.dirty){assert&&assert(this.isActiveSVGGradient());const e=this;sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradient] switched to dirty: ${this.gradient.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.dirty=!0,e.svgBlock.markDirtyGradient(this),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}}update(){if(this.dirty){this.dirty=!1,sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradient] update: ${this.gradient.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();for(let e=0;e<this.stops.length;e++)this.stops[e].update();sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}}dispose(){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradient] dispose ${this.gradient.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();for(let e=0;e<this.stops.length;e++){const t=this.stops[e];this.definition.removeChild(t.svgElement),t.dispose()}cleanArray(this.stops),this.svgBlock=null,this.gradient=null,this.freeToPool(),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}}scenery.register("SVGGradient",SVGGradient);const Vl=class Vl extends SVGGradient{constructor(e,t){super(e,t)}initialize(e,t){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGLinearGradient] initialize ${t.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),super.initialize(e,t);const n=t;return this.definition.setAttribute("x1",""+n.start.x),this.definition.setAttribute("y1",""+n.start.y),this.definition.setAttribute("x2",""+n.end.x),this.definition.setAttribute("y2",""+n.end.y),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop(),this}createDefinition(){return document.createElementNS(svgns,"linearGradient")}freeToPool(){Vl.pool.freeToPool(this)}};Vl.pool=new Pool(Vl);let SVGLinearGradient=Vl;scenery.register("SVGLinearGradient",SVGLinearGradient);const Ol=class Ol extends SVGGradient{constructor(e,t){super(e,t)}initialize(e,t){return sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGRadialGradient] initialize ${t.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),super.initialize(e,t),this.definition.setAttribute("cx",""+t.largePoint.x),this.definition.setAttribute("cy",""+t.largePoint.y),this.definition.setAttribute("r",""+t.maxRadius),this.definition.setAttribute("fx",""+t.focalPoint.x),this.definition.setAttribute("fy",""+t.focalPoint.y),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop(),this}createDefinition(){return document.createElementNS(svgns,"radialGradient")}freeToPool(){Ol.pool.freeToPool(this)}};Ol.pool=new Pool(Ol);let SVGRadialGradient=Ol;scenery.register("SVGRadialGradient",SVGRadialGradient);const Ml=class Ml{constructor(e){this.initialize(e)}initialize(e){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGPattern] initialize: ${e.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();const t=this.definition!==void 0;return this.definition=this.definition||document.createElementNS(svgns,"pattern"),t||(this.definition.setAttribute("patternUnits","userSpaceOnUse"),this.definition.setAttribute("patternContentUnits","userSpaceOnUse")),e.transformMatrix?this.definition.setAttribute("patternTransform",e.transformMatrix.getSVGTransform()):this.definition.removeAttribute("patternTransform"),this.definition.setAttribute("x","0"),this.definition.setAttribute("y","0"),this.definition.setAttribute("width",""+e.image.width),this.definition.setAttribute("height",""+e.image.height),this.imageElement=this.imageElement||document.createElementNS(svgns,"image"),this.imageElement.setAttribute("x","0"),this.imageElement.setAttribute("y","0"),this.imageElement.setAttribute("width",`${e.image.width}px`),this.imageElement.setAttribute("height",`${e.image.height}px`),this.imageElement.setAttributeNS(xlinkns,"xlink:href",e.image.src),t||this.definition.appendChild(this.imageElement),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop(),this}update(){}dispose(){this.freeToPool()}freeToPool(){Ml.pool.freeToPool(this)}};Ml.pool=new Pool(Ml);let SVGPattern=Ml;scenery.register("SVGPattern",SVGPattern);class TransformTracker{constructor(e,t){this._matrices=null,this._dirtyIndex=0,this._listeners=[],this._nodeTransformListeners=[];const n=optionize()({isStatic:!1},t);this._isStatic=n.isStatic,this.trail=e,this._nodeTransformListeners=[];for(let r=1;r<this.trail.length;r++){const s=(a=>()=>{this.onTransformChange(a)})(r-1);this._nodeTransformListeners.push(s),e.nodes[r].transformEmitter.addListener(s)}}dispose(){for(let e=1;e<this.trail.length;e++){const t=this._nodeTransformListeners[e-1];this.trail.nodes[e].transformEmitter.hasListener(t)&&this.trail.nodes[e].transformEmitter.removeListener(t)}}addListener(e){this._listeners.push(e)}removeListener(e){const t=_.indexOf(this._listeners,e);assert&&assert(t>=0,"TransformTracker listener not found"),this._listeners.splice(t,1)}notifyListeners(){let e=this._listeners;this._isStatic||(e=e.slice());const t=e.length;for(let n=0;n<t;n++)e[n]()}onTransformChange(e){this._dirtyIndex=Math.min(this._dirtyIndex,e),this.notifyListeners()}getMatrix(){if(this._matrices===null){this._matrices=[];for(let t=1;t<this.trail.length;t++)this._matrices.push(new Matrix3)}if(this._matrices.length<=0)return Matrix3.IDENTITY;const e=this._matrices.length;for(let t=this._dirtyIndex;t<e;t++){const n=this.trail.nodes[t+1].matrix;t===0?this._matrices[t].set(n):(this._matrices[t].set(this._matrices[t-1]),this._matrices[t].multiplyMatrix(n))}return this._dirtyIndex=e,this._matrices[e-1]}get matrix(){return this.getMatrix()}}scenery.register("TransformTracker",TransformTracker);const TransformTracker$1=TransformTracker;class TrailVisibilityTracker{constructor(e,t){t=merge({isStatic:!1},t),this.isStatic=t.isStatic,this.trail=e,this._listeners=[],this.trailVisibleProperty=new TinyProperty(this.trail.isVisible()),this._nodeVisibilityListeners=[];for(let n=0;n<this.trail.length;n++){const r=()=>{this.trailVisibleProperty.set(e.isVisible())};this._nodeVisibilityListeners.push(r),e.nodes[n].visibleProperty.link(r)}this.boundTrailVisibilityChangedListener=this.onVisibilityChange.bind(this),this.trailVisibleProperty.link(this.boundTrailVisibilityChangedListener)}addListener(e){assert&&assert(typeof e=="function"),this._listeners.push(e)}removeListener(e){assert&&assert(typeof e=="function");const t=_.indexOf(this._listeners,e);assert&&assert(t>=0,"TrailVisibilityTracker listener not found"),this._listeners.splice(t,1)}dispose(){for(let e=0;e<this.trail.length;e++){const t=this._nodeVisibilityListeners[e];this.trail.nodes[e].visibleProperty.hasListener(t)&&this.trail.nodes[e].visibleProperty.removeListener(t)}this.trailVisibleProperty.unlink(this.boundTrailVisibilityChangedListener)}onVisibilityChange(){this.notifyListeners()}notifyListeners(){let e=this._listeners;this._isStatic||(e=e.slice());const t=e.length;for(let n=0;n<t;n++)e[n]()}}scenery.register("TrailVisibilityTracker",TrailVisibilityTracker);const AriaHasPopUpMutator={mutateNode(o,e){e?o.setPDOMAttribute("aria-haspopup",e):(assert&&assert(o.hasPDOMAttribute("aria-haspopup"),"Set aria-haspopup once before removing it."),o.removePDOMAttribute("aria-haspopup")),o.positionInPDOM=!!e}};scenery.register("AriaHasPopUpMutator",AriaHasPopUpMutator);class FocusableHeadingNode extends Node$2{constructor(e){const t=optionize()({headingLevel:1},e);super(t),this.tagName=`h${t.headingLevel}`,this.focusHighlight="invisible";const n={blur:()=>{this.focusable=!1}};this.addInputListener(n),this.disposeFocusableHeadingNode=()=>{this.removeInputListener(n)}}focus(){this.focusable=!0,super.focus()}dispose(){this.disposeFocusableHeadingNode(),super.dispose()}}scenery.register("FocusableHeadingNode",FocusableHeadingNode);const SPACE=" ",END_OF_DOCUMENT="End of Document",COMMA=",",LINE_WORD_LENGTH=15,NEXT="NEXT",PREVIOUS="PREVIOUS";class Cursor{constructor(e){const t=this;this.outputUtteranceProperty=new Property(new Utterance$1(document.title,"off")),this.linearDOM=this.getLinearDOMElements(e),this.activeElement=null,this.activeLine=null,this.letterPosition=0,this.positionInLine=0,this.wordPosition=0,this.observers=[],this.keyState={},document.addEventListener("keydown",n=>{this.keyState[n.keyCode]=!0;let r;const a=n.shiftKey?PREVIOUS:NEXT;if(this.linearDOM=this.getLinearDOMElements(e),this.updateLiveElementList(),!(this.activeElement&&this.activeElement.getAttribute("role")==="application")){if(this.keyState[40]&&!this.keyState[45])r=this.readNextPreviousLine(NEXT);else if(this.keyState[38]&&!this.keyState[45])r=this.readNextPreviousLine(PREVIOUS);else if(this.keyState[72]){const l=["H1","H2","H3","H4","H5","H6"];r=this.readNextPreviousHeading(l,a)}else this.keyState[9]||(this.keyState[39]&&!this.keyState[17]?r=this.readNextPreviousCharacter(NEXT):this.keyState[37]&&!this.keyState[17]?r=this.readNextPreviousCharacter(PREVIOUS):this.keyState[37]&&this.keyState[17]?r=this.readNextPreviousWord(PREVIOUS):this.keyState[39]&&this.keyState[17]?r=this.readNextPreviousWord(NEXT):this.keyState[45]&&this.keyState[38]?r=this.readActiveLine():this.keyState[49]?r=this.readNextPreviousHeading(["H1"],a):this.keyState[50]?r=this.readNextPreviousHeading(["H2"],a):this.keyState[51]?r=this.readNextPreviousHeading(["H3"],a):this.keyState[52]?r=this.readNextPreviousHeading(["H4"],a):this.keyState[53]?r=this.readNextPreviousHeading(["H5"],a):this.keyState[54]?r=this.readNextPreviousHeading(["H6"],a):this.keyState[70]?r=this.readNextPreviousFormElement(a):this.keyState[66]?r=this.readNextPreviousButton(a):this.keyState[76]?r=this.readNextPreviousList(a):this.keyState[73]?r=this.readNextPreviousListItem(a):this.keyState[45]&&this.keyState[40]&&this.readEntireDocument());this.activeElement&&this.isFocusable(this.activeElement)&&this.activeElement.focus(),r===SPACE&&(r="space"),r&&this.outputUtteranceProperty.set(new Utterance$1(r,"off"))}}),document.addEventListener("keyup",n=>{this.keyState[n.keyCode]=!1}),document.addEventListener("focusin",function(n){if(n.target!==t.activeElement){t.activeElement=n.target;const s=t.getAccessibleText(this.activeElement,!0);if(s){const a=t.activeElement.getAttribute("aria-live");t.outputUtteranceProperty.set(new Utterance$1(s,a))}}})}getLinearDOMElements(e){const t=e.getElementsByTagName("*"),n=[];for(let r=0;r<t.length;r++)t[r].nodeType===Node.ELEMENT_NODE&&(n[r]=t[r]);return n}getLiveRole(e){let t=null;return["log","status","alert","progressbar","marquee","timer","assertive","polite"].forEach(r=>{(e.getAttribute("aria-live")===r||e.getAttribute("role")===r)&&(t=r)}),t}getNextPreviousElement(e){this.activeElement||(this.activeElement=this.linearDOM[0]);const t=e==="NEXT"?1:-1,r=this.linearDOM.indexOf(this.activeElement)+t;return this.linearDOM[r]}getLabel(e){const t=document.getElementsByTagName("label");let n;return Array.prototype.forEach.call(t,r=>{r.getAttribute("for")&&(n=r)}),assert&&assert(n,"No label found for id"),n}getAccessibleText(e,t){let n="";if(!e)return END_OF_DOCUMENT;if(e.getAttribute("class")==="ScreenView"||e.tagName==="HEADER"||e.tagName==="SECTION"||e.tagName==="LABEL")return null;let r=e;for(;r.parentElement;){if(r.getAttribute("aria-hidden")||r.hidden)return null;r=r.parentElement}if(e.tagName==="P"&&(n+=e.textContent),e.tagName==="H1"&&(n+=`Heading Level 1, ${e.textContent}`),e.tagName==="H2"&&(n+=`Heading Level 2, ${e.textContent}`),e.tagName==="H3"&&(n+=`Heading Level 3, ${e.textContent}`),e.tagName==="UL"){const s=e.children.length;n+=`List with ${s} items`}if(e.tagName==="LI"&&(n+=`List Item: ${e.textContent}`),e.tagName==="BUTTON"){const s=" Button";if(e.getAttribute("aria-pressed")){let a=" toggle";const l=" pressed",d=" not";a+=s+COMMA,e.getAttribute("aria-pressed")==="true"?a+=l:a+=d+l,n+=e.textContent+COMMA+a}else n+=e.textContent+s}if(e.tagName==="INPUT"&&(e.type==="reset"&&(n+=`${e.getAttribute("value")} Button`),e.type==="checkbox")){const a=this.getLabel(e.id).textContent;if(e.getAttribute("role")==="switch"){const l=e.getAttribute("aria-checked");if(l){const d=l==="true"?"On":"Off";n+=`${a+COMMA+SPACE}switch${COMMA}${SPACE}${d}`}else assert&&assert(!1,"checkbox switch must have aria-checked attribute")}else{const l=e.checked?" Checked":" Not Checked";n+=`${e.textContent} Checkbox${l}`}}if(t){n.length>0&&(n+=COMMA);const s=e.getAttribute("aria-label");s&&(n+=SPACE+s+COMMA);const a=e.getAttribute("aria-labelledBy");if(a){const y=document.getElementById(a).textContent;n+=SPACE+y+COMMA}r=e;let l;for(;r.parentElement;)if(l=r.getAttribute("role"),l==="document"||l==="application"){n+=SPACE+l+COMMA;break}else r=r.parentElement;e.getAttribute("role")&&(l=e.getAttribute("role"),l==="button"&&(n+=`${SPACE}Button`)),e.draggable&&(n+=`${SPACE}draggable${COMMA}`),e.getAttribute("aria-grabbed")==="true"&&(n+=`${SPACE}grabbed${COMMA}`);const d=e.getAttribute("aria-describedby");if(d){const c=d.split(SPACE);let y,m;c.forEach(O=>{y=document.getElementById(O),m=y.textContent,n+=SPACE+m})}}return n[n.length-1]===","&&(n=n.slice(0,-1)),n}getNextPreviousElementWithPDOMContent(e){let t;for(;!t;)this.activeElement=this.getNextPreviousElement(e),t=this.getAccessibleText(this.activeElement,!1);return this.activeElement}getNextPreviousElementWithRole(e,t){let n=null;const r=t===NEXT?1:-1;this.activeElement||(this.activeElement=this.linearDOM[0]);let s=this.linearDOM.indexOf(this.activeElement)+r;for(;this.linearDOM[s];){for(let a=0;a<e.length;a++){const l=this.linearDOM[s].tagName,d=this.linearDOM[s].type,c=this.linearDOM[s].getAttribute("role"),y=e[a];if(l===y||c===y||d===y){n=this.linearDOM[s];break}}if(n)break;s+=r}return n}readNextPreviousLine(e){let t="";this.letterPosition=0,this.wordPosition=0,this.activeElement||(this.activeElement=this.getNextPreviousElementWithPDOMContent(e));let n=this.getAccessibleText(this.activeElement,!1).split(SPACE);if(e===PREVIOUS&&(this.positionInLine=this.positionInLine-2*LINE_WORD_LENGTH),!n[this.positionInLine]){this.positionInLine=0;const s=this.activeElement;this.activeElement=this.getNextPreviousElementWithPDOMContent(e),n=this.getAccessibleText(this.activeElement,!1).split(" "),this.activeElement||(this.activeElement=s)}const r=this.positionInLine+LINE_WORD_LENGTH;for(let s=this.positionInLine;s<r;s++)if(n[s])if(t+=n[s],this.positionInLine+=1,n[s+1])t+=SPACE;else{this.positionInLine+=LINE_WORD_LENGTH-this.positionInLine%LINE_WORD_LENGTH;break}return this.activeLine=t,t}readActiveLine(){let e="";this.activeLine||(this.activeLine=this.readNextPreviousLine(NEXT));const t=this.activeLine.split(SPACE);for(let n=0;n<LINE_WORD_LENGTH;n++)if(t[n])if(e+=t[n],t[n+1])e+=SPACE;else break;return e}readNextPreviousWord(e){this.activeLine||(this.activeLine=this.readNextPreviousLine(e));const t=this.activeLine.split(SPACE);let n,r;e===NEXT?(r=t.length,n=1):e===PREVIOUS&&(r=0,n=-2),this.wordPosition===r&&(this.activeLine=this.readNextPreviousLine(e));const s=t[this.wordPosition];return this.wordPosition+=n,s}readNextPreviousHeading(e,t){let n,r,s;for(;!n;)s=this.activeElement,r=this.getNextPreviousElementWithRole(e,t),this.activeElement=r,n=this.getAccessibleText(r);if(!r){this.activeElement=s;const a=t===NEXT?"more":"previous";if(e.length===1){const l=`No ${a} headings at `,d=e[0];return l+(d==="H1"?"Level 1":d==="H2"?"Level 2":d==="H3"?"Level 3":d==="H4"?"Level 4":d==="H5"?"Level 5":"Level 6")}return`No ${a} headings`}return this.activeElement=r,n}readNextPreviousButton(e){const t=["button","BUTTON","submit","reset"];let n,r,s;for(;!r;)s=this.activeElement,n=this.getNextPreviousElementWithRole(t,e),this.activeElement=n,r=this.getAccessibleText(n,!0);return n?(this.activeElement=n,r):(this.activeElement=s,`No ${e===NEXT?"more":"previous"} buttons`)}readNextPreviousFormElement(e){const t=["INPUT","BUTTON"],n=["button"],r=t.concat(n);let s,a,l;for(;!a;)l=this.activeElement,s=this.getNextPreviousElementWithRole(r,e),this.activeElement=s,a=this.getAccessibleText(s,!0);return a===END_OF_DOCUMENT?(this.activeElement=l,`No ${e===NEXT?"next":"previous"} form field`):(this.activeElement=s,a)}readNextPreviousListItem(e){this.activeElement||(this.activeElement=this.getNextPreviousElementWithPDOMContent(e));let t;const n=this.activeElement.parentElement;if(n.tagName==="UL"||n.tagName==="OL"){const r=e===NEXT?1:-1;let s=Array.prototype.indexOf.call(n.children,this.activeElement)+r;for(;n.children[s];){if(t=this.getAccessibleText(n.children[s]),t){this.activeElement=n.children[s];break}s+=r}t||(t=this.readNextPreviousList(e))}else t=this.readNextPreviousList(e);return t||`No ${e===NEXT?"more":"previous"} list items`}readNextPreviousList(e){this.activeElement||(this.activeElement=this.getNextPreviousElementWithPDOMContent(e));const t=this.activeElement.parentElement;let n;(t.tagName==="UL"||t.tagName==="OL")&&(n=this.activeElement,this.activeElement=t);const r=this.getNextPreviousElementWithRole(["UL","OL"],e);if(!r)return n&&(this.activeElement=n),`No ${e===NEXT?"more":"previous"} lists`;const s=this.getAccessibleText(r);let a="";const l=r.children[0];return l&&(a=this.getAccessibleText(l),this.activeElement=l),`${s}, ${a}`}readNextPreviousCharacter(e){this.activeLine||(this.activeLine=this.readNextPreviousLine(NEXT));let t,n,r;e===NEXT?(t=this.activeLine.length,n=1,r=0):e===PREVIOUS&&(t=2,n=-1,r=-2),this.letterPosition===t&&(this.activeLine=this.readNextPreviousLine(e),this.letterPosition=this.activeLine.length);const s=this.activeLine[this.letterPosition+r];return this.letterPosition+=n,s}updateLiveElementList(){for(let e=0;e<this.observers.length;e++)this.observers[e]&&this.observers[e].disconnect();this.observers=[];for(let e=0;e<this.linearDOM.length;e++){const t=this.linearDOM[e];if(this.getLiveRole(t)){const r=l=>{l.forEach(d=>{let c,y=d.target;for(;!c;)c=this.getLiveRole(y),y=y.parentElement;if(d.addedNodes[0]){const m=d.addedNodes[0].data;this.outputUtteranceProperty.set(new Utterance$1(m,c))}})},s=new MutationObserver(l=>{r(l)}),a={childList:!0,subtree:!0};s.observe(t,a),this.observers.push(s)}}}readEntireDocument(){const e="polite";let t=this.getAccessibleText(this.activeElement),n=this.activeElement;for(;t!==END_OF_DOCUMENT;)n=this.activeElement,t=this.readNextPreviousLine(NEXT),t===END_OF_DOCUMENT&&(this.activeElement=n),this.outputUtteranceProperty.set(new Utterance$1(t,e))}isFocusable(e){const t=["tabindex","BUTTON","INPUT"];let n=!1;return t.forEach(r=>{(e.getAttribute(r)||e.tagName===r)&&(n=!0)}),n}}scenery.register("Cursor",Cursor);let Utterance$1=class{constructor(e,t){this.text=e,this.liveRole=t}};class Reader{constructor(e){this.speakingStartedEmitter=new Emitter({parameters:[{valueType:Object}]}),this.speakingEndedEmitter=new Emitter({parameters:[{valueType:Object}]}),this.speaking=!1,this.politeUtterances=[];const t=navigator.userAgent,n=t.match(/Windows/),r=!!(t.match(/Version\/[5-9]\./)&&t.match(/Safari\//)&&t.match(/AppleWebKit/));window.speechSynthesis&&SpeechSynthesisUtterance&&window.speechSynthesis.speak?(this.synth=window.speechSynthesis,e.outputUtteranceProperty.link(s=>{const a=new SpeechSynthesisUtterance(s.text);a.addEventListener("start",d=>{this.speakingStartedEmitter.emit(s)}),a.addEventListener("end",d=>{this.speakingEndedEmitter.emit(s)});let l;if(this.synth.getVoices().forEach(d=>{d.default&&(l=d)}),a.voice=l,a.rate=1.2,s.liveRole==="assertive"||s.liveRole==="off"||!s.liveRole)this.politeUtterances=[],this.speaking=!0,n?(this.synth.pause(),this.synth.cancel(),this.synth.speak(a),this.synth.resume()):(this.synth.cancel(),this.synth.speak(a));else if(s.liveRole==="polite")if(r){this.politeUtterances.push(a);const d=()=>{this.speaking=!0;const c=this.politeUtterances.shift();c?this.synth.speak(c):this.speaking=!1};if(this.speaking)setTimeout(()=>{d()},2e3);else{this.synth.speak(a);const c=this.politeUtterances.indexOf(a);c>0&&this.politeUtterances.splice(c,1)}}else this.synth.speak(a)})):e.outputUtteranceProperty.link(()=>{this.speakingStartedEmitter.emit({text:"Sorry! Web Speech API not supported on this platform."})})}}scenery.register("Reader",Reader);const EMPTY_ARRAY=[],PHET_IO_STATE_DEFAULT=!1,kl=class kl extends PhetioDataHandler{constructor(e,t){var r;const n=optionize()({parameters:EMPTY_ARRAY,phetioOuterType:kl.PhetioActionIO,phetioState:PHET_IO_STATE_DEFAULT,phetioReadOnly:PhetioObject.DEFAULT_OPTIONS.phetioReadOnly,phetioHighFrequency:PhetioObject.DEFAULT_OPTIONS.phetioHighFrequency,phetioEventType:PhetioObject.DEFAULT_OPTIONS.phetioEventType,phetioDocumentation:"A class that wraps a function, adding API to execute that function and data stream capture."},t);super(n),this.action=e,this.isExecutingCount=0,this.disposeOnExecuteCompletion=!1,this.executedEmitter=new Emitter({parameters:n.parameters,tandem:(r=n.tandem)==null?void 0:r.createTandem("executedEmitter"),hasListenerOrderDependencies:n.hasListenerOrderDependencies,phetioState:n.phetioState,phetioReadOnly:n.phetioReadOnly,phetioHighFrequency:n.phetioHighFrequency,phetioEventType:n.phetioEventType,phetioDocumentation:"Emitter that emits when this actions work is complete"}),this.disposePhetioAction=()=>{this.executedEmitter.dispose()}}execute(...e){assert&&assert(!this.isDisposed,"should not be called if disposed"),assert&&assert(!this.executedEmitter.isDisposed,"self should not be disposed"),this.isExecutingCount++,assert&&super.validateArguments(...e),Tandem.PHET_IO_ENABLED&&this.isPhetioInstrumented()&&this.phetioStartEvent("executed",{data:this.getPhetioData(...e)}),this.action.apply(null,e),this.executedEmitter.emit(...e),Tandem.PHET_IO_ENABLED&&this.isPhetioInstrumented()&&this.phetioEndEvent(),this.isExecutingCount--,this.disposeOnExecuteCompletion&&this.isExecutingCount===0&&(this.disposePhetioAction(),this.disposeOnExecuteCompletion=!1)}dispose(){this.isExecutingCount>0?this.disposeOnExecuteCompletion=!0:this.disposePhetioAction(),super.dispose()}};kl.PhetioActionIO=e=>{const t=e.map(getTypeName).join(",");return cache.has(t)||cache.set(t,new IOType(`PhetioActionIO<${e.map(getTypeName).join(", ")}>`,{valueType:kl,documentation:"Executes when an event occurs",events:["executed"],parameterTypes:e,metadataDefaults:{phetioState:PHET_IO_STATE_DEFAULT},methods:{execute:{returnType:VoidIO,parameterTypes:e,implementation:function(...n){this.execute(...n)},documentation:"Executes the function the PhetioAction is wrapping.",invocableForReadOnlyElements:!1},getValidationErrors:{returnType:ArrayIO(NullableIO(StringIO)),parameterTypes:e,implementation:function(...n){return this.getValidationErrors(...n)},documentation:"Checks to see if the proposed values are valid. Returns an array of length N where each element is an error (string) or null if the value is valid."}}})),cache.get(t)};let PhetioAction=kl;const getTypeName=o=>o.typeName,cache=new IOTypeCache;tandemNamespace.register("PhetioAction",PhetioAction);const PhetioAction$1=PhetioAction;class KeyStateTracker{constructor(e){var n,r;this.keyState={},this._lastKeyDown=null,this.attachedToDocument=!1,this.documentKeyupListener=null,this.documentKeydownListener=null,this._enabled=!0,this.keydownEmitter=new Emitter({parameters:[{valueType:KeyboardEvent}]}),this.keyupEmitter=new Emitter({parameters:[{valueType:KeyboardEvent}]}),this.keydownUpdateAction=new PhetioAction$1(s=>{const a=KeyboardUtils.getEventCode(s);if(a){if(this.correctModifierKeys(s),assert&&!KeyboardUtils.isShiftKey(s)&&assert(s.shiftKey===this.shiftKeyDown,"shift key inconsistency between event and keyState."),assert&&!KeyboardUtils.isAltKey(s)&&assert(s.altKey===this.altKeyDown,"alt key inconsistency between event and keyState."),assert&&!KeyboardUtils.isControlKey(s)&&assert(s.ctrlKey===this.ctrlKeyDown,"ctrl key inconsistency between event and keyState."),!this.isKeyDown(a)){const l=KeyboardUtils.getEventCode(s);assert&&assert(l,"Could not find key from domEvent"),this.keyState[l]={keyDown:!0,key:l,timeDown:0}}this._lastKeyDown=a,this.keydownEmitter.emit(s)}},{phetioPlayback:!0,tandem:(n=e==null?void 0:e.tandem)==null?void 0:n.createTandem("keydownUpdateAction"),parameters:[{name:"event",phetioType:EventIO}],phetioEventType:EventType.USER,phetioDocumentation:"Action that executes whenever a keydown occurs from the input listeners this keyStateTracker adds (most likely to the document)."}),this.keyupUpdateAction=new PhetioAction$1(s=>{const a=KeyboardUtils.getEventCode(s);a&&(this.correctModifierKeys(s),this.isKeyDown(a)&&delete this.keyState[a],platform.mac&&KeyboardUtils.isMetaKey(s)&&this.clearState(),this.keyupEmitter.emit(s))},{phetioPlayback:!0,tandem:(r=e==null?void 0:e.tandem)==null?void 0:r.createTandem("keyupUpdateAction"),parameters:[{name:"event",phetioType:EventIO}],phetioEventType:EventType.USER,phetioDocumentation:"Action that executes whenever a keyup occurs from the input listeners this keyStateTracker adds (most likely to the document)."});const t=this.step.bind(this);stepTimer.addListener(t),this.disposeKeyStateTracker=()=>{stepTimer.removeListener(t),this.attachedToDocument&&this.detachFromDocument()}}keydownUpdate(e){this.enabled&&this.keydownUpdateAction.execute(e)}correctModifierKeys(e){const t=KeyboardUtils.getEventCode(e);assert&&assert(t,"key not found from domEvent"),e.shiftKey&&!KeyboardUtils.isShiftKey(e)&&!this.shiftKeyDown&&(this.keyState[KeyboardUtils.KEY_SHIFT_LEFT]={keyDown:!0,key:t,timeDown:0}),e.altKey&&!KeyboardUtils.isAltKey(e)&&!this.altKeyDown&&(this.keyState[KeyboardUtils.KEY_ALT_LEFT]={keyDown:!0,key:t,timeDown:0}),e.ctrlKey&&!KeyboardUtils.isControlKey(e)&&!this.ctrlKeyDown&&(this.keyState[KeyboardUtils.KEY_CONTROL_LEFT]={keyDown:!0,key:t,timeDown:0}),!e.shiftKey&&this.shiftKeyDown&&(delete this.keyState[KeyboardUtils.KEY_SHIFT_LEFT],delete this.keyState[KeyboardUtils.KEY_SHIFT_RIGHT]),!e.altKey&&this.altKeyDown&&(delete this.keyState[KeyboardUtils.KEY_ALT_LEFT],delete this.keyState[KeyboardUtils.KEY_ALT_RIGHT]),!e.ctrlKey&&this.ctrlKeyDown&&(delete this.keyState[KeyboardUtils.KEY_CONTROL_LEFT],delete this.keyState[KeyboardUtils.KEY_CONTROL_RIGHT])}keyupUpdate(e){this.enabled&&this.keyupUpdateAction.execute(e)}get movementKeysDown(){return this.isAnyKeyInListDown(KeyboardUtils.MOVEMENT_KEYS)}getLastKeyDown(){return this._lastKeyDown}isKeyDown(e){return this.keyState[e]?this.keyState[e].keyDown:!1}isAnyKeyInListDown(e){for(let t=0;t<e.length;t++)if(this.isKeyDown(e[t]))return!0;return!1}areKeysDown(e){for(let n=0;n<e.length;n++)if(!this.isKeyDown(e[n]))return!1;return!0}areKeysExclusivelyDown(e){const t=Object.keys(this.keyState);if(t.length!==e.length)return!1;let n=!0;for(let r=0;r<e.length;r++){const s=e[r];let a=[s];KeyboardUtils.isModifierKey(s)&&(a=KeyboardUtils.MODIFIER_KEY_TO_CODE_MAP.get(s)),_.intersection(t,a).length===0&&(n=!1)}return n}areKeysDownWithoutExtraModifiers(e){for(let t=0;t<KeyboardUtils.MODIFIER_KEY_CODES.length;t++){const n=KeyboardUtils.MODIFIER_KEY_CODES[t];if(this.isKeyDown(n)&&!e.includes(n))return!1}return this.areKeysDown(e)}keysAreDown(){return Object.keys(this.keyState).length>0}get enterKeyDown(){return this.isKeyDown(KeyboardUtils.KEY_ENTER)}get shiftKeyDown(){return this.isAnyKeyInListDown(KeyboardUtils.SHIFT_KEYS)}get altKeyDown(){return this.isAnyKeyInListDown(KeyboardUtils.ALT_KEYS)}get ctrlKeyDown(){return this.isAnyKeyInListDown(KeyboardUtils.CONTROL_KEYS)}timeDownForKey(e){return assert&&assert(this.isKeyDown(e),"cannot get timeDown on a key that is not pressed down"),this.keyState[e].timeDown}clearState(){this.keyState={}}step(e){if(this.keysAreDown()){const t=e*1e3;for(const n in this.keyState)this.keyState.hasOwnProperty(n)&&this.keyState[n].keyDown&&(this.keyState[n].timeDown+=t)}}attachToWindow(){assert&&assert(!this.attachedToDocument,"KeyStateTracker is already attached to document."),this.documentKeydownListener=t=>{this.keydownUpdate(t)},this.documentKeyupListener=t=>{this.keyupUpdate(t)};const e=()=>{window.addEventListener("keyup",this.documentKeyupListener,{capture:!0}),window.addEventListener("keydown",this.documentKeydownListener,{capture:!0}),this.attachedToDocument=!0};if(document)e();else{const t=()=>{e(),window.removeEventListener("load",t)};window.addEventListener("load",t)}}setEnabled(e){this._enabled!==e&&(this._enabled=e,!e&&this.clearState())}set enabled(e){this.setEnabled(e)}get enabled(){return this.isEnabled()}isEnabled(){return this._enabled}detachFromDocument(){assert&&assert(this.attachedToDocument,"KeyStateTracker is not attached to window."),assert&&assert(this.documentKeyupListener,"keyup listener was not created or attached to window"),assert&&assert(this.documentKeydownListener,"keydown listener was not created or attached to window."),window.removeEventListener("keyup",this.documentKeyupListener),window.removeEventListener("keydown",this.documentKeydownListener),this.documentKeyupListener=null,this.documentKeydownListener=null,this.attachedToDocument=!1}dispose(){this.disposeKeyStateTracker()}}scenery.register("KeyStateTracker",KeyStateTracker);class GlobalKeyStateTracker extends KeyStateTracker{constructor(e){super(e)}}const globalKeyStateTracker=new GlobalKeyStateTracker({tandem:Tandem.GENERAL_CONTROLLER.createTandem("keyStateTracker")});scenery.register("globalKeyStateTracker",globalKeyStateTracker);const globalKeyStateTracker$1=globalKeyStateTracker,INTERACTIVE_HIGHLIGHTING_OPTIONS=["interactiveHighlight","interactiveHighlightLayerable","interactiveHighlightEnabled"],InteractiveHighlighting=memoize(o=>{assert&&assert(!o._mixesInteractiveHighlighting,"InteractiveHighlighting is already added to this Type");const e=DelayedMutate$1("InteractiveHighlightingClass",INTERACTIVE_HIGHLIGHTING_OPTIONS,class extends o{constructor(...n){super(...n),this._pointer=null,this.displays={},this._interactiveHighlight=null,this._interactiveHighlightLayerable=!1,this._interactiveHighlightEnabled=!0,this.interactiveHighlightChangedEmitter=new TinyEmitter,this._isInteractiveHighlightActiveProperty=new TinyProperty(!1),this._activationListener={enter:this._onPointerEntered.bind(this),over:this._onPointerOver.bind(this),move:this._onPointerMove.bind(this),exit:this._onPointerExited.bind(this),down:this._onPointerDown.bind(this)},this._changedInstanceListener=this.onChangedInstance.bind(this),this.changedInstanceEmitter.addListener(this._changedInstanceListener),this._interactiveHighlightingEnabledListener=this._onInteractiveHighlightingEnabledChange.bind(this),this._boundPointerFocusClearedListener=this.handleLockedPointerFocusCleared.bind(this);const r=this._onPointerRelease.bind(this),s=this._onPointerCancel.bind(this);this._pointerListener={up:r,cancel:s,interrupt:s},this.isInteractiveHighlightActiveProperty=this._isInteractiveHighlightActiveProperty}get isInteractiveHighlighting(){return!0}static get _mixesInteractiveHighlighting(){return!0}setInteractiveHighlight(n){this._interactiveHighlight!==n&&(this._interactiveHighlight=n,this._interactiveHighlightLayerable&&(assert&&assert(n instanceof Node$2),n.visible=!1),this.interactiveHighlightChangedEmitter.emit())}set interactiveHighlight(n){this.setInteractiveHighlight(n)}get interactiveHighlight(){return this.getInteractiveHighlight()}getInteractiveHighlight(){return this._interactiveHighlight}setInteractiveHighlightLayerable(n){this._interactiveHighlightLayerable!==n&&(this._interactiveHighlightLayerable=n,this._interactiveHighlight&&(assert&&assert(this._interactiveHighlight instanceof Node$2),this._interactiveHighlight.visible=!1,this.interactiveHighlightChangedEmitter.emit()))}set interactiveHighlightLayerable(n){this.setInteractiveHighlightLayerable(n)}get interactiveHighlightLayerable(){return this.getInteractiveHighlightLayerable()}getInteractiveHighlightLayerable(){return this._interactiveHighlightLayerable}setInteractiveHighlightEnabled(n){this._interactiveHighlightEnabled=n;const r=Object.keys(this.displays);for(let s=0;s<r.length;s++){const a=this.displays[r[s]];this._interactiveHighlightingEnabledListener(a.focusManager.pointerHighlightsVisibleProperty.value)}}getInteractiveHighlightEnabled(){return this._interactiveHighlightEnabled}set interactiveHighlightEnabled(n){this.setInteractiveHighlightEnabled(n)}get interactiveHighlightEnabled(){return this.getInteractiveHighlightEnabled()}isInteractiveHighlightActivated(){let n=!1;const r=Object.keys(this.displays);for(let s=0;s<r.length;s++){const a=this.displays[r[s]];if(a.focusManager.pointerHighlightsVisibleProperty.value){const l=a.focusManager.pointerFocusProperty.value,d=a.focusManager.lockedPointerFocusProperty.value;if(d){if((d==null?void 0:d.trail.lastNode())===this){n=!0;break}}else if((l==null?void 0:l.trail.lastNode())===this){n=!0;break}}}return n}handleHighlightActiveChange(){this._isInteractiveHighlightActiveProperty.value=this.isInteractiveHighlightActivated()}dispose(){this.changedInstanceEmitter.removeListener(this._changedInstanceListener),this.hasInputListener(this._activationListener)&&this.removeInputListener(this._activationListener),this._pointer&&(this._pointer.removeInputListener(this._pointerListener),this._pointer=null);const n=Object.keys(this.displays);for(let r=0;r<n.length;r++){const s=this.displays[n[r]];this.onDisplayRemoved(s),delete this.displays[n[r]]}super.dispose&&super.dispose()}_onPointerOver(n){const r=n.trail.nodes.find(s=>s.groupFocusHighlight&&s.isInteractiveHighlighting);if(r){const s=n.trail.subtrailTo(r),a=Object.values(this.displays);for(let l=0;l<a.length;l++){const d=a[l];d.focusManager.pointerFocusProperty.value===null&&d.focusManager.pointerFocusProperty.set(new Focus(d,s))}}}_onPointerEntered(n){let r=!1;const s=Object.values(this.displays);for(let a=0;a<s.length;a++){const l=s[a];if(l.focusManager.pointerFocusProperty.value===null||!n.trail.equals(l.focusManager.pointerFocusProperty.value.trail)){const d=new Focus(l,n.trail);l.focusManager.pointerFocusProperty.set(d),l.focusManager.lockedPointerFocusProperty.value===null&&n.pointer.attachedListener&&(this.lockHighlight(d,l.focusManager),r=!0)}}r&&this.savePointer(n.pointer)}_onPointerMove(n){let r=!1;const s=Object.values(this.displays);for(let a=0;a<s.length;a++){const l=s[a],d=n.trail.subtrailTo(this);if((l.focusManager.pointerFocusProperty.value===null||!d.equals(l.focusManager.pointerFocusProperty.value.trail))&&!this.getDescendantsUseHighlighting(n.trail)){const c=new Focus(l,d);l.focusManager.pointerFocusProperty.set(c),l.focusManager.lockedPointerFocusProperty.value===null&&n.pointer.attachedListener&&(this.lockHighlight(c,l.focusManager),r=!0)}}r&&this.savePointer(n.pointer)}_onPointerExited(n){const r=Object.values(this.displays);for(let s=0;s<r.length;s++){const a=r[s];a.focusManager.pointerFocusProperty.set(null);const l=a.focusManager.lockedPointerFocusProperty.value;!n.trail.isPickable()&&(l===null||n.trail.containsNode(l.trail.lastNode()))&&this._onPointerRelease(n)}}_onPointerDown(n){if(this._pointer===null){let r=!1;const s=Object.values(this.displays);for(let a=0;a<s.length;a++){const l=s[a],d=l.focusManager.pointerFocusProperty.value,c=!!l.focusManager.lockedPointerFocusProperty.value;d&&!c&&(assert&&assert(!d.trail.lastNode().isDisposed,"Focus should not be set to a disposed Node"),this.lockHighlight(d,l.focusManager),r=!0)}r&&this.savePointer(n.pointer)}}onDisplayAdded(n){n.focusManager.pointerHighlightsVisibleProperty.hasListener(this._interactiveHighlightingEnabledListener)||n.focusManager.pointerHighlightsVisibleProperty.link(this._interactiveHighlightingEnabledListener)}onDisplayRemoved(n){n.focusManager.lockedPointerFocusProperty.hasListener(this._boundPointerFocusClearedListener)&&n.focusManager.lockedPointerFocusProperty.unlink(this._boundPointerFocusClearedListener),n.focusManager.pointerHighlightsVisibleProperty.unlink(this._interactiveHighlightingEnabledListener)}_onPointerRelease(n){const r=Object.values(this.displays);for(let s=0;s<r.length;s++){const a=r[s];a.focusManager.lockedPointerFocusProperty.value=null,a.focusManager.lockedPointerFocusProperty.hasListener(this._boundPointerFocusClearedListener)&&a.focusManager.lockedPointerFocusProperty.unlink(this._boundPointerFocusClearedListener)}this._pointer&&this._pointer.listeners.includes(this._pointerListener)&&(this._pointer.removeInputListener(this._pointerListener),this._pointer=null)}_onPointerCancel(n){const r=Object.values(this.displays);for(let s=0;s<r.length;s++)r[s].focusManager.pointerFocusProperty.set(null);this._onPointerRelease(n)}savePointer(n){assert&&assert(this._pointer===null,"It should be impossible to already have a Pointer before locking from touchSnag"),this._pointer=n,this._pointer.addInputListener(this._pointerListener)}lockHighlight(n,r){assert&&assert(this._pointer===null,"It should be impossible to already have a Pointer before locking from touchSnag"),r.lockedPointerFocusProperty.set(new Focus(n.display,n.trail.copy())),assert&&assert(!r.lockedPointerFocusProperty.hasListener(this._boundPointerFocusClearedListener),"this listener still on the lockedPointerFocusProperty indicates a memory leak"),r.lockedPointerFocusProperty.link(this._boundPointerFocusClearedListener)}handleLockedPointerFocusCleared(n){n===null&&this._onPointerRelease()}_onInteractiveHighlightingEnabledChange(n){const r=n&&this._interactiveHighlightEnabled,s=this.hasInputListener(this._activationListener);r&&!s?this.addInputListener(this._activationListener):!r&&s&&this.removeInputListener(this._activationListener),this.handleHighlightActiveChange()}onChangedInstance(n,r){assert&&assert(n.trail,"should have a trail"),assert&&assert(n.display,"should have a display");const s=n.trail.uniqueId;if(r){const a=n.display;this.displays[s]=a,this.onDisplayAdded(a)}else{assert&&assert(n.node,"should have a node");const a=this.displays[s];assert&&assert(a,`interactive highlighting does not have a Display for removed instance: ${s}`),n.node.instances.length===0&&this.onDisplayRemoved(a),delete this.displays[s]}}getDescendantsUseHighlighting(n){const r=n.nodes.indexOf(this),s=n.nodes.slice(r+1,n.nodes.length);let a=!1;for(let l=0;l<s.length;l++)if(s[l].isInteractiveHighlighting){a=!0;break}return a}mutate(n){return super.mutate(n)}});return e.prototype._mutatorKeys=INTERACTIVE_HIGHLIGHTING_OPTIONS.concat(e.prototype._mutatorKeys),assert&&assert(e.prototype._mutatorKeys.length===_.uniq(e.prototype._mutatorKeys).length,"duplicate mutator keys in InteractiveHighlighting"),e});scenery.register("InteractiveHighlighting",InteractiveHighlighting);class InteractiveHighlightingNode extends InteractiveHighlighting(Node$2){constructor(e){super(e)}}scenery.register("InteractiveHighlightingNode",InteractiveHighlightingNode);const localeInfoModule={aa:{name:"Afar",localizedName:"Afar",direction:"ltr"},ab:{name:"Abkhazian",localizedName:"Abkhazian",direction:"ltr"},ae:{name:"Avestan",localizedName:"Avestan",direction:"rtl"},af:{name:"Afrikaans",localizedName:"Afrikaans",direction:"ltr"},ak:{name:"Akan",localizedName:"Akan",direction:"ltr"},am:{name:"Amharic",localizedName:"Amharic",direction:"ltr"},an:{name:"Aragonese",localizedName:"Aragonese",direction:"ltr"},ar:{name:"Arabic",localizedName:"العربية",direction:"rtl"},ar_MA:{name:"Arabic, Morocco",localizedName:"العربية (المغرب)",direction:"rtl"},ar_SA:{name:"Arabic, Saudi Arabia",localizedName:"العربية (السعودية)",direction:"rtl"},as:{name:"Assamese",localizedName:"Assamese",direction:"ltr"},av:{name:"Avaric",localizedName:"Avaric",direction:"ltr"},ay:{name:"Aymara",localizedName:"Aymara",direction:"ltr"},az:{name:"Azerbaijani",localizedName:"Azerbaijani",direction:"ltr"},ba:{name:"Bashkir",localizedName:"Bashkir",direction:"ltr"},be:{name:"Belarusian",localizedName:"беларускі",direction:"ltr"},bg:{name:"Bulgarian",localizedName:"български",direction:"ltr"},bh:{name:"Bihari",localizedName:"Bihari",direction:"ltr"},bi:{name:"Bislama",localizedName:"Bislama",direction:"ltr"},bm:{name:"Bambara",localizedName:"Bambara",direction:"ltr"},bn:{name:"Bengali",localizedName:"Bengali",direction:"ltr"},bo:{name:"Tibetan",localizedName:"Tibetan",direction:"ltr"},br:{name:"Breton",localizedName:"Breton",direction:"ltr"},bs:{name:"Bosnian",localizedName:"Bosnian",direction:"ltr"},ca:{name:"Catalan",localizedName:"català",direction:"ltr"},ce:{name:"Chechen",localizedName:"Chechen",direction:"ltr"},ch:{name:"Chamorro",localizedName:"Chamorro",direction:"ltr"},co:{name:"Corsican",localizedName:"Corsican",direction:"ltr"},cr:{name:"Cree",localizedName:"Cree",direction:"ltr"},cs:{name:"Czech",localizedName:"čeština",direction:"ltr"},cu:{name:"Church Slavic",localizedName:"Church Slavic",direction:"ltr"},cv:{name:"Chuvash",localizedName:"Chuvash",direction:"ltr"},cy:{name:"Welsh",localizedName:"Welsh",direction:"ltr"},da:{name:"Danish",localizedName:"Dansk",direction:"ltr"},de:{name:"German",localizedName:"Deutsch",direction:"ltr"},dv:{name:"Divehi",localizedName:"Divehi",direction:"ltr"},dz:{name:"Dzongkha",localizedName:"Dzongkha",direction:"ltr"},ee:{name:"Ewe",localizedName:"Ewe",direction:"ltr"},el:{name:"Greek",localizedName:"Ελληνικά",direction:"ltr"},en:{name:"English",localizedName:"English",direction:"ltr"},en_CA:{name:"English, Canada",localizedName:"English (Canada)",direction:"ltr"},en_GB:{name:"English, United Kingdom",localizedName:"English (United Kingdom)",direction:"ltr"},eo:{name:"Esperanto",localizedName:"Esperanto",direction:"ltr"},es:{name:"Spanish",localizedName:"español",direction:"ltr"},es_CO:{name:"Spanish, Colombia",localizedName:"español (Colombia)",direction:"ltr"},es_CR:{name:"Spanish, Costa Rica",localizedName:"español (Costa Rica)",direction:"ltr"},es_ES:{name:"Spanish, Spain",localizedName:"español (España)",direction:"ltr"},es_MX:{name:"Spanish, Mexico",localizedName:"español (México)",direction:"ltr"},es_PE:{name:"Spanish, Peru",localizedName:"español (Perú)",direction:"ltr"},et:{name:"Estonian",localizedName:"Eesti",direction:"ltr"},eu:{name:"Basque",localizedName:"Basque",direction:"ltr"},fa:{name:"Persian",localizedName:"Persian",direction:"rtl"},ff:{name:"Fulah",localizedName:"Fulah",direction:"ltr"},fi:{name:"Finnish",localizedName:"suomi",direction:"ltr"},fj:{name:"Fijian",localizedName:"Fijian",direction:"ltr"},fo:{name:"Faroese",localizedName:"Faroese",direction:"ltr"},fr:{name:"French",localizedName:"français",direction:"ltr"},fu:{name:"Friulian",localizedName:"fu",direction:"ltr"},fy:{name:"Western Frisian",localizedName:"Frisian",direction:"ltr"},ga:{name:"Irish",localizedName:"Gaeilge",direction:"ltr"},gd:{name:"Scottish Gaelic",localizedName:"Scottish Gaelic",direction:"ltr"},gl:{name:"Galician",localizedName:"Gallegan",direction:"ltr"},gn:{name:"Guarani",localizedName:"Guarani",direction:"ltr"},gu:{name:"Gujarati",localizedName:"Gujarati",direction:"ltr"},gv:{name:"Manx",localizedName:"Manx",direction:"ltr"},ha:{name:"Hausa",localizedName:"Hausa",direction:"ltr"},hi:{name:"Hindi",localizedName:"हिंदी",direction:"ltr"},ho:{name:"Hiri Motu",localizedName:"Hiri Motu",direction:"ltr"},hr:{name:"Croatian",localizedName:"hrvatski",direction:"ltr"},ht:{name:"Haitian",localizedName:"Haitian",direction:"ltr"},hu:{name:"Hungarian",localizedName:"magyar",direction:"ltr"},hy:{name:"Armenian",localizedName:"Armenian",direction:"ltr"},hz:{name:"Herero",localizedName:"Herero",direction:"ltr"},ia:{name:"Interlingua",localizedName:"Interlingua",direction:"ltr"},ie:{name:"Interlingue",localizedName:"Interlingue",direction:"ltr"},ig:{name:"Igbo",localizedName:"Igbo",direction:"ltr"},ii:{name:"Sichuan Yi",localizedName:"Sichuan Yi",direction:"ltr"},ik:{name:"Inupiaq",localizedName:"Inupiaq",direction:"ltr"},in:{name:"Indonesian",localizedName:"Bahasa Indonesia",direction:"ltr"},io:{name:"Ido",localizedName:"Ido",direction:"ltr"},is:{name:"Icelandic",localizedName:"íslenska",direction:"ltr"},it:{name:"Italian",localizedName:"italiano",direction:"ltr"},iu:{name:"Inuktitut",localizedName:"Inuktitut",direction:"ltr"},iw:{name:"Hebrew",localizedName:"עברית",direction:"rtl"},ja:{name:"Japanese",localizedName:"日本語",direction:"ltr"},ji:{name:"Yiddish",localizedName:"Yiddish",direction:"ltr"},jv:{name:"Javanese",localizedName:"Javanese",direction:"ltr"},ka:{name:"Georgian",localizedName:"Georgian",direction:"ltr"},kg:{name:"Kongo",localizedName:"Kongo",direction:"ltr"},ki:{name:"Kikuyu",localizedName:"Kikuyu",direction:"ltr"},kj:{name:"Kwanyama",localizedName:"Kwanyama",direction:"ltr"},kk:{name:"Kazakh",localizedName:"Kazakh",direction:"ltr"},kl:{name:"Kalaallisut",localizedName:"Greenlandic",direction:"ltr"},km:{name:"Khmer",localizedName:"Khmer",direction:"ltr"},kn:{name:"Kannada",localizedName:"Kannada",direction:"ltr"},ko:{name:"Korean",localizedName:"한국어",direction:"ltr"},kr:{name:"Kanuri",localizedName:"Kanuri",direction:"ltr"},ks:{name:"Kashmiri",localizedName:"Kashmiri",direction:"ltr"},ku:{name:"Kurdish",localizedName:"Kurdish",direction:"ltr"},ku_TR:{name:"Kurdish, Turkey",localizedName:"Kurdish (Turkey)",direction:"ltr"},kv:{name:"Komi",localizedName:"Komi",direction:"ltr"},kw:{name:"Cornish",localizedName:"Cornish",direction:"ltr"},ky:{name:"Kirghiz",localizedName:"Kirghiz",direction:"ltr"},la:{name:"Latin",localizedName:"Latin",direction:"ltr"},lb:{name:"Luxembourgish",localizedName:"Luxembourgish",direction:"ltr"},lg:{name:"Ganda",localizedName:"Ganda",direction:"ltr"},li:{name:"Limburgish",localizedName:"Limburgish",direction:"ltr"},lk:{name:"Lakota",localizedName:"Lakota",direction:"ltr"},ln:{name:"Lingala",localizedName:"Lingala",direction:"ltr"},lo:{name:"Lao",localizedName:"Lao",direction:"ltr"},lt:{name:"Lithuanian",localizedName:"Lietuvių",direction:"ltr"},lu:{name:"Luba-Katanga",localizedName:"Luba-Katanga",direction:"ltr"},lv:{name:"Latvian",localizedName:"Latviešu",direction:"ltr"},mg:{name:"Malagasy",localizedName:"Malagasy",direction:"ltr"},mh:{name:"Marshallese",localizedName:"Marshallese",direction:"ltr"},mi:{name:"Maori",localizedName:"Maori",direction:"ltr"},mk:{name:"Macedonian",localizedName:"македонски",direction:"ltr"},ml:{name:"Malayalam",localizedName:"Malayalam",direction:"ltr"},mn:{name:"Mongolian",localizedName:"Mongolian",direction:"ltr"},mo:{name:"Moldavian",localizedName:"Moldavian",direction:"ltr"},mr:{name:"Marathi",localizedName:"Marathi",direction:"ltr"},ms:{name:"Malay",localizedName:"Bahasa Melayu",direction:"ltr"},mt:{name:"Maltese",localizedName:"Malti",direction:"ltr"},my:{name:"Burmese",localizedName:"Burmese",direction:"ltr"},na:{name:"Nauru",localizedName:"Nauru",direction:"ltr"},nb:{name:"Norwegian Bokmal",localizedName:"Norwegian Bokmål",direction:"ltr"},nd:{name:"North Ndebele",localizedName:"North Ndebele",direction:"ltr"},ne:{name:"Nepali",localizedName:"Nepali",direction:"ltr"},ng:{name:"Ndonga",localizedName:"Ndonga",direction:"ltr"},nl:{name:"Dutch",localizedName:"Nederlands",direction:"ltr"},nn:{name:"Norwegian Nynorsk",localizedName:"Norwegian Nynorsk",direction:"ltr"},nr:{name:"South Ndebele",localizedName:"South Ndebele",direction:"ltr"},nv:{name:"Navajo",localizedName:"Navajo",direction:"ltr"},ny:{name:"Chichewa",localizedName:"Nyanja",direction:"ltr"},oc:{name:"Occitan",localizedName:"Occitan",direction:"ltr"},oj:{name:"Ojibwa",localizedName:"Ojibwa",direction:"ltr"},om:{name:"Oromo",localizedName:"Oromo",direction:"ltr"},or:{name:"Oriya",localizedName:"Oriya",direction:"ltr"},os:{name:"Ossetian",localizedName:"Ossetian",direction:"ltr"},pa:{name:"Panjabi",localizedName:"Panjabi",direction:"ltr"},pi:{name:"Pali",localizedName:"Pali",direction:"ltr"},pl:{name:"Polish",localizedName:"polski",direction:"ltr"},ps:{name:"Pashto",localizedName:"Pushto",direction:"ltr"},pt:{name:"Portuguese",localizedName:"português",direction:"ltr"},pt_BR:{name:"Portuguese, Brazil",localizedName:"português (Brasil)",direction:"ltr"},qu:{name:"Quechua",localizedName:"Quechua",direction:"ltr"},rm:{name:"Raeto-Romance",localizedName:"Raeto-Romance",direction:"ltr"},rn:{name:"Kirundi",localizedName:"Rundi",direction:"ltr"},ro:{name:"Romanian",localizedName:"română",direction:"ltr"},ru:{name:"Russian",localizedName:"русский",direction:"ltr"},rw:{name:"Kinyarwanda",localizedName:"Kinyarwanda",direction:"ltr"},sa:{name:"Sanskrit",localizedName:"Sanskrit",direction:"ltr"},sc:{name:"Sardinian",localizedName:"Sardinian",direction:"ltr"},sd:{name:"Sindhi",localizedName:"Sindhi",direction:"ltr"},se:{name:"Northern Sami",localizedName:"Northern Sami",direction:"ltr"},sg:{name:"Sango",localizedName:"Sango",direction:"ltr"},sh:{name:"Serbo-Croatian",localizedName:"Serbo-Croatian",direction:"ltr"},si:{name:"Sinhalese",localizedName:"Sinhalese",direction:"ltr"},sk:{name:"Slovak",localizedName:"Slovenčina",direction:"ltr"},sl:{name:"Slovenian",localizedName:"Slovenščina",direction:"ltr"},sm:{name:"Samoan",localizedName:"Samoan",direction:"ltr"},sn:{name:"Shona",localizedName:"Shona",direction:"ltr"},so:{name:"Somali",localizedName:"Somali",direction:"ltr"},sq:{name:"Albanian",localizedName:"shqipe",direction:"ltr"},sr:{name:"Serbian",localizedName:"Српски",direction:"ltr"},ss:{name:"Swati",localizedName:"Swati",direction:"ltr"},st:{name:"Sotho",localizedName:"Southern Sotho",direction:"ltr"},su:{name:"Sundanese",localizedName:"Sundanese",direction:"ltr"},sv:{name:"Swedish",localizedName:"svenska",direction:"ltr"},sw:{name:"Swahili",localizedName:"Swahili",direction:"ltr"},ta:{name:"Tamil",localizedName:"Tamil",direction:"ltr"},te:{name:"Telugu",localizedName:"Telugu",direction:"ltr"},tg:{name:"Tajik",localizedName:"Tajik",direction:"ltr"},th:{name:"Thai",localizedName:"ไทย",direction:"ltr"},ti:{name:"Tigrinya",localizedName:"Tigrinya",direction:"ltr"},tk:{name:"Turkmen",localizedName:"Turkmen",direction:"ltr"},tl:{name:"Tagalog",localizedName:"Tagalog",direction:"ltr"},tn:{name:"Tswana",localizedName:"Tswana",direction:"ltr"},to:{name:"Tonga",localizedName:"Tonga",direction:"ltr"},tr:{name:"Turkish",localizedName:"Türkçe",direction:"ltr"},ts:{name:"Tsonga",localizedName:"Tsonga",direction:"ltr"},tt:{name:"Tatar",localizedName:"Tatar",direction:"ltr"},tw:{name:"Twi",localizedName:"Twi",direction:"ltr"},ty:{name:"Tahitian",localizedName:"Tahitian",direction:"ltr"},ug:{name:"Uighur",localizedName:"Uighur",direction:"ltr"},uk:{name:"Ukrainian",localizedName:"українська",direction:"ltr"},ur:{name:"Urdu",localizedName:"Urdu",direction:"rtl"},uz:{name:"Uzbek",localizedName:"Uzbek",direction:"ltr"},ve:{name:"Venda",localizedName:"Venda",direction:"ltr"},vi:{name:"Vietnamese",localizedName:"Tiếng Việt",direction:"ltr"},vo:{name:"Volapuk",localizedName:"Volapük",direction:"ltr"},wa:{name:"Walloon",localizedName:"Walloon",direction:"ltr"},wo:{name:"Wolof",localizedName:"Wolof",direction:"ltr"},xh:{name:"Xhosa",localizedName:"Xhosa",direction:"ltr"},yo:{name:"Yoruba",localizedName:"Yoruba",direction:"ltr"},za:{name:"Zhuang",localizedName:"Zhuang",direction:"ltr"},zh_CN:{name:"Chinese, Simplified",localizedName:"中文 (中国)",direction:"ltr"},zh_HK:{name:"Chinese, Hong Kong",localizedName:"中文 (香港)",direction:"ltr"},zh_TW:{name:"Chinese, Traditional",localizedName:"中文 (台灣)",direction:"ltr"},zu:{name:"Zulu",localizedName:"Zulu",direction:"ltr"}},phetcommon=new Namespace("phetcommon"),LTR="‪",RTL="‫",POP="‬",StringUtils={format:function(o){const e=arguments;return o.replace(/{(\d)}/g,(t,n)=>e[+n+1])},fillIn:function(o,e){o=o&&o.get?o.get():o,assert&&assert(typeof o=="string",`invalid template: ${o}`),assert&&assert(e&&typeof e=="object",`invalid values: ${e}`);let t=o;const n=o.match(/\{\{[^{}]+\}\}/g)||[];for(let r=0;r<n.length;r++){const s=n[r],a=s.replace("{{","").replace("}}","");if(e[a]!==void 0){const l=e[a]&&e[a].get?e[a].get():e[a];t=t.replace(s,l)}}return t},isEmbeddingMark:function(o){return o===LTR||o===RTL||o===POP},embeddedSlice:function(o,e,t){const n=[];let r;for(t===void 0&&(t=o.length),t<0&&(t+=o.length);e<o.length&&StringUtils.isEmbeddingMark(o.charAt(e));)e++;for(;t>=1&&StringUtils.isEmbeddingMark(o.charAt(t-1));)t--;if(e>=t||e>=o.length)return"";for(let O=0;O<e;O++)r=o.charAt(O),r===LTR||r===RTL?n.push(r):r===POP&&n.pop();let s=n.length,a=n.slice();const l=o.slice(e,t);for(let O=0;O<l.length;O++)r=l.charAt(O),r===LTR||r===RTL?n.push(r):r===POP&&(n.pop(),s=Math.min(n.length,s));let d=n;const c=Math.max(0,s-1);a=a.slice(c),d=d.slice(c);const y=a.join(""),m=d.join("").replace(/./g,POP);return y+l+m},embeddedSplit:function(o,e,t){if(e===void 0)return[o];let n=[],r,s=o;function a(){let d,c;if(e instanceof window.RegExp){const y=s.match(e);y?(d=y.index,c=y[0].length):d=-1}else assert&&assert(typeof e=="string"),d=s.indexOf(e),c=e.length;return{index:d,length:c}}let l=0;for(;(r=a()).index>=0;){n.push(StringUtils.embeddedSlice(o,l,l+r.index));const d=r.index+r.length;s=s.slice(d),l+=d}return n.push(StringUtils.embeddedSlice(o,l)),t!==void 0&&(assert&&assert(typeof t=="number"),n=_.first(n,t)),n},embeddedDebugString:function(o){return o.replace(/\u202a/g,"[LTR]").replace(/\u202b/g,"[RTL]").replace(/\u202c/g,"[POP]")},wrapLTR:function(o){return LTR+o+POP},wrapRTL:function(o){return RTL+o+POP},wrapDirection:function(o,e){return assert&&assert(e==="ltr"||e==="rtl"),e==="ltr"?StringUtils.wrapLTR(o):StringUtils.wrapRTL(o)},localeToLocalizedName:function(o){return assert&&assert(localeInfoModule[o],"locale needs to be a valid locale code defined in localeInfoModule"),StringUtils.wrapDirection(localeInfoModule[o].localizedName,localeInfoModule[o].direction)},capitalize(o){const e=o.search(/[A-Za-z0-9]/);if(e===-1)return o.slice(0);const t=e>0?o.slice(0,e):"",n=o.charAt(e).toUpperCase(),r=e+1<o.length?o.slice(e+1):"";return t+n+r}};phetcommon.register("StringUtils",StringUtils);const utteranceQueueNamespace=new Namespace("utteranceQueue"),NAME_KEY="NAME",OBJECT_KEY="OBJECT",CONTEXT_KEY="CONTEXT",HINT_KEY="HINT",DEFAULT_RESPONSE_PATTERNS={nameObjectContextHint:"{{NAME}}, {{OBJECT}}, {{CONTEXT}} {{HINT}}",nameObjectContext:"{{NAME}}, {{OBJECT}}, {{CONTEXT}}",nameObjectHint:"{{NAME}}, {{OBJECT}}, {{HINT}}",nameContextHint:"{{NAME}}, {{CONTEXT}} {{HINT}}",nameObject:"{{NAME}}, {{OBJECT}}",nameContext:"{{NAME}}, {{CONTEXT}}",nameHint:"{{NAME}}, {{HINT}}",name:"{{NAME}}",objectContextHint:"{{OBJECT}}, {{CONTEXT}} {{HINT}}",objectContext:"{{OBJECT}}, {{CONTEXT}}",objectHint:"{{OBJECT}}, {{HINT}}",contextHint:"{{CONTEXT}} {{HINT}}",object:"{{OBJECT}}",context:"{{CONTEXT}}",hint:"{{HINT}}"},Mh=class Mh{constructor(e){const t=optionize3()({},DEFAULT_RESPONSE_PATTERNS,e);this.nameObjectContextHint=t.nameObjectContextHint,this.nameObjectContext=t.nameObjectContext,this.nameObjectHint=t.nameObjectHint,this.nameContextHint=t.nameContextHint,this.nameObject=t.nameObject,this.nameContext=t.nameContext,this.nameHint=t.nameHint,this.name=t.name,this.objectContextHint=t.objectContextHint,this.objectContext=t.objectContext,this.objectHint=t.objectHint,this.contextHint=t.contextHint,this.object=t.object,this.context=t.context,this.hint=t.hint}getResponsePattern(e){const t=this[e];return assert&&assert(t,`no pattern string found for key ${e}`),t}static createPatternKey(e,t,n,r){let s="";return e&&(s=s.concat(NAME_KEY.concat("_"))),t&&(s=s.concat(OBJECT_KEY.concat("_"))),n&&(s=s.concat(CONTEXT_KEY.concat("_"))),r&&(s=s.concat(HINT_KEY.concat("_"))),_.camelCase(s)}};Mh.DEFAULT_RESPONSE_PATTERNS=new Mh;let ResponsePatternCollection=Mh;utteranceQueueNamespace.register("ResponsePatternCollection",ResponsePatternCollection);const DEFAULT_OPTIONS$3={nameResponse:null,objectResponse:null,contextResponse:null,hintResponse:null,ignoreProperties:!1,responsePatternCollection:ResponsePatternCollection.DEFAULT_RESPONSE_PATTERNS},Ho=class Ho{constructor(e){const t=optionize3()({},DEFAULT_OPTIONS$3,e);assert&&assert(t.responsePatternCollection instanceof ResponsePatternCollection),this._nameResponse=t.nameResponse,this._objectResponse=t.objectResponse,this._contextResponse=t.contextResponse,this._hintResponse=t.hintResponse,this.ignoreProperties=t.ignoreProperties,this.responsePatternCollection=t.responsePatternCollection}getNameResponse(){return Ho.getResponseText(this._nameResponse)}get nameResponse(){return this.getNameResponse()}set nameResponse(e){this.setNameResponse(e)}setNameResponse(e){this._nameResponse=e}getObjectResponse(){return Ho.getResponseText(this._objectResponse)}get objectResponse(){return this.getObjectResponse()}set objectResponse(e){this.setObjectResponse(e)}setObjectResponse(e){this._objectResponse=e}getContextResponse(){return Ho.getResponseText(this._contextResponse)}get contextResponse(){return this.getContextResponse()}set contextResponse(e){this.setContextResponse(e)}setContextResponse(e){this._contextResponse=e}getHintResponse(){return Ho.getResponseText(this._hintResponse)}get hintResponse(){return this.getHintResponse()}set hintResponse(e){this.setHintResponse(e)}setHintResponse(e){this._hintResponse=e}static getResponseText(e){return isTReadOnlyProperty(e)?e.value:typeof e=="function"?e():e}copy(){return new Ho(this.serialize())}serialize(){return{nameResponse:this.nameResponse,objectResponse:this.objectResponse,contextResponse:this.contextResponse,hintResponse:this.hintResponse,ignoreProperties:this.ignoreProperties,responsePatternCollection:this.responsePatternCollection}}};Ho.DEFAULT_OPTIONS=DEFAULT_OPTIONS$3;let ResponsePacket=Ho;utteranceQueueNamespace.register("ResponsePacket",ResponsePacket);class ResponseCollector extends PhetioObject{constructor(e){super(),this.nameResponsesEnabledProperty=new BooleanProperty(!0),this.objectResponsesEnabledProperty=new BooleanProperty(!1),this.contextResponsesEnabledProperty=new BooleanProperty(!1),this.hintResponsesEnabledProperty=new BooleanProperty(!1)}reset(){this.nameResponsesEnabledProperty.reset(),this.objectResponsesEnabledProperty.reset(),this.contextResponsesEnabledProperty.reset(),this.hintResponsesEnabledProperty.reset()}collectResponses(e){const t=optionize3()({},ResponsePacket.DEFAULT_OPTIONS,e);assert&&assert(t.responsePatternCollection instanceof ResponsePatternCollection);const n=!!(t.nameResponse&&(this.nameResponsesEnabledProperty.get()||t.ignoreProperties)),r=!!(t.objectResponse&&(this.objectResponsesEnabledProperty.get()||t.ignoreProperties)),s=!!(t.contextResponse&&(this.contextResponsesEnabledProperty.get()||t.ignoreProperties)),a=!!(t.hintResponse&&(this.hintResponsesEnabledProperty.get()||t.ignoreProperties)),l=ResponsePatternCollection.createPatternKey(n,r,s,a);let d="";if(l){const c=t.responsePatternCollection.getResponsePattern(l);d=StringUtils.fillIn(c,{NAME:t.nameResponse,OBJECT:t.objectResponse,CONTEXT:t.contextResponse,HINT:t.hintResponse})}return d}}const responseCollector=new ResponseCollector;utteranceQueueNamespace.register("responseCollector",responseCollector);const responseCollector$1=responseCollector,DEFAULT_PRIORITY=1;let globalIdCounter$2=1;const kr=class kr extends Disposable{constructor(e){const t=optionize()({alert:null,predicate:function(){return!0},canAnnounceProperties:[],descriptionCanAnnounceProperties:[],voicingCanAnnounceProperties:[],alertStableDelay:200,alertMaximumDelay:Number.MAX_VALUE,announcerOptions:{},priority:DEFAULT_PRIORITY},e);super(t),this.id=globalIdCounter$2++,this._alert=t.alert,this.predicate=t.predicate,this.canAnnounceProperty=new AnnouncingControlProperty({dependentProperties:t.canAnnounceProperties}),this.descriptionCanAnnounceProperty=new AnnouncingControlProperty({dependentProperties:t.descriptionCanAnnounceProperties}),this.voicingCanAnnounceProperty=new AnnouncingControlProperty({dependentProperties:t.voicingCanAnnounceProperties}),this.alertStableDelay=t.alertStableDelay,this.alertMaximumDelay=t.alertMaximumDelay,this.announcerOptions=t.announcerOptions,this.priorityProperty=new NumberProperty(t.priority),this.previousAlertText=null}static getAlertStringFromResponsePacket(e,t){const n=e.serialize();return t||(n.ignoreProperties=!0),responseCollector$1.collectResponses(n)}getAlertText(e=!1){const t=kr.alertableToText(this._alert,e);return this.previousAlertText=t,t}getAlert(){return this._alert}get alert(){return this.getAlert()}set alert(e){this.setAlert(e)}setAlert(e){this._alert=e}setAlertStableDelay(e){this.alertStableDelay=e}toString(){return`Utterance_${this.id}#${this.getAlertText()}`}toStateObject(){return{alert:NullableIO(OrIO([StringIO,NumberIO])).toStateObject(this.getAlertText())}}reset(){this.previousAlertText=null}setCanAnnounceProperties(e){this.canAnnounceProperty.setDependentProperties(e)}set canAnnounceProperties(e){this.setCanAnnounceProperties(e)}get canAnnounceProperties(){return this.getCanAnnounceProperties()}getCanAnnounceProperties(){return this.canAnnounceProperty.getDependentProperties()}setDescriptionCanAnnounceProperties(e){this.descriptionCanAnnounceProperty.setDependentProperties(e)}set descriptionCanAnnounceProperties(e){this.setDescriptionCanAnnounceProperties(e)}get descriptionCanAnnounceProperties(){return this.getDescriptionCanAnnounceProperties()}getDescriptionCanAnnounceProperties(){return this.descriptionCanAnnounceProperty.getDependentProperties()}setVoicingCanAnnounceProperties(e){this.voicingCanAnnounceProperty.setDependentProperties(e)}set voicingCanAnnounceProperties(e){this.setVoicingCanAnnounceProperties(e)}get voicingCanAnnounceProperties(){return this.getVoicingCanAnnounceProperties()}getVoicingCanAnnounceProperties(){return this.voicingCanAnnounceProperty.getDependentProperties()}dispose(){this.canAnnounceProperty.dispose(),this.descriptionCanAnnounceProperty.dispose(),this.voicingCanAnnounceProperty.dispose(),this.priorityProperty.dispose(),super.dispose()}static alertableToText(e,t=!1){let n;if(typeof e=="function")n=e();else if(e instanceof ResponsePacket)n=kr.getAlertStringFromResponsePacket(e,t);else{if(e instanceof kr)return e.getAlertText(t);isTReadOnlyProperty(e)?n=e.value:n=e}return n}};kr.TOP_PRIORITY=10,kr.HIGH_PRIORITY=5,kr.MEDIUM_PRIORITY=2,kr.DEFAULT_PRIORITY=DEFAULT_PRIORITY,kr.LOW_PRIORITY=0,kr.UtteranceIO=new IOType("UtteranceIO",{valueType:kr,documentation:"Announces text to a specific browser technology (like aria-live or web speech)",toStateObject:e=>e.toStateObject(),stateSchema:{alert:NullableIO(OrIO([StringIO,NumberIO]))}});let Utterance=kr;class AnnouncingControlProperty extends DynamicProperty{constructor(e){const t=optionize()({dependentProperties:[]},e),n=new Property(new TinyProperty(!1));super(n),this._dependentProperties=[],this.implementationProperty=n,this.setDependentProperties(t.dependentProperties)}setDependentProperties(e){this.implementationProperty.value&&this.implementationProperty.value.dispose();const t=e.length===0?[new TinyProperty(!0)]:e;this.implementationProperty.value=DerivedProperty.and(t),this._dependentProperties=e}set dependentProperties(e){this.setDependentProperties(e)}get dependentProperties(){return this.getDependentProperties()}getDependentProperties(){return this._dependentProperties.slice(0)}dispose(){this.implementationProperty.dispose(),this._dependentProperties=[],super.dispose()}}utteranceQueueNamespace.register("Utterance",Utterance);const Rl=class Rl extends PhetioObject{constructor(e){var n;const t=optionize()({respectResponseCollectorProperties:!0,phetioType:Rl.AnnouncerIO,phetioState:!1},e);super(t),this.readyToAnnounce=!0,this.hasSpoken=!1,this.respectResponseCollectorProperties=t.respectResponseCollectorProperties,this.announcementCompleteEmitter=new Emitter({parameters:[{name:"utterance",phetioType:Utterance.UtteranceIO},{name:"text",phetioType:NullableIO(OrIO([StringIO,NumberIO]))}],tandem:(n=t.tandem)==null?void 0:n.createTandem("announcementCompleteEmitter"),phetioReadOnly:!0,phetioDocumentation:"The announcement that has just completed. The Utterance text could potentially differ from the exact text that was announced, so both are emitted. Use `text` for an exact match of what was announced."})}shouldUtteranceCancelOther(e,t){return t.priorityProperty.value<e.priorityProperty.value}onUtterancePriorityChange(e){}};Rl.AnnouncerIO=new IOType("AnnouncerIO",{valueType:Rl,documentation:"Announces text to a specific browser technology (like aria-live or web speech)"});let Announcer=Rl;utteranceQueueNamespace.register("Announcer",Announcer);const SpeechSynthesisParentPolyfill={initialize(){if(window.speechSynthesis||window.SpeechSynthesis||window.SpeechSynthesisUtterance)throw new Error("SpeechSynthesis is supported here, the polyfill should not overwrite it");assert&&assert(window.parent,"This polyfill requires a parent frame implementation of SpeechSynthesis."),window.SpeechSynthesis=window.parent.SpeechSynthesis,window.speechSynthesis=new window.parent.SpeechSynthesis,window.SpeechSynthesisUtterance=window.parent.SpeechSynthesisUtterance}};utteranceQueueNamespace.register("SpeechSynthesisParentPolyfill",SpeechSynthesisParentPolyfill);window.phet&&phet.chipper&&phet.chipper.queryParameters&&phet.chipper.queryParameters.speechSynthesisFromParent&&SpeechSynthesisParentPolyfill.initialize();const ENGINE_WAKE_INTERVAL=5e3,PENDING_UTTERANCE_DELAY=5e3,PAUSE_RESUME_WORKAROUND_INTERVAL=1e4,VOICING_UTTERANCE_INTERVAL=125,NOVELTY_VOICES=["Albert","Bad News","Bahh","Bells","Boing","Bubbles","Cellos","Good News","Jester","Organ","Superstar","Trinoids","Whisper","Wobble","Zarvox","Flo","Grandma","Grandpa","Junior"];let initializeCount=0;const voiceLangToSupportedLocale={cmn:"zh_CN",yue:"zh_HK","yue-HK":"zh_HK",yue_HK:"zh_HK","fil-PH":"tl",fil_PH:"tl"},UTTERANCE_OPTION_DEFAULTS={cancelSelf:!0,cancelOther:!0,voice:null};class SpeechSynthesisAnnouncer extends Announcer{constructor(e){var n,r,s,a;const t=optionize()({respectResponseCollectorProperties:!1,debug:!1},e);super(t),this.debug=t.debug,this.voiceProperty=new Property(null,{tandem:(n=t.tandem)==null?void 0:n.createTandem("voiceProperty"),phetioValueType:NullableIO(SpeechSynthesisVoiceIO),phetioState:!1,phetioReadOnly:!0,phetioDocumentation:"the voice that is currently voicing responses"}),this.voiceRateProperty=new NumberProperty(1,{range:new Range(.75,2),tandem:(r=t.tandem)==null?void 0:r.createTandem("voiceRateProperty"),phetioState:!1,phetioDocumentation:"changes the rate of the voicing-feature voice"}),this.voicePitchProperty=new NumberProperty(1,{range:new Range(.5,2),tandem:(s=t.tandem)==null?void 0:s.createTandem("voicePitchProperty"),phetioState:!1,phetioDocumentation:"changes the pitch of the voicing-feature voice"}),this.voiceVolumeProperty=new NumberProperty(1,{range:new Range(0,1)}),this.hasSpoken=!1,this.timeSinceWakingEngine=0,this.timeSincePauseResume=0,this.timeSincePendingUtterance=0,this.timeSinceUtteranceEnd=VOICING_UTTERANCE_INTERVAL,this.startSpeakingEmitter=new Emitter({parameters:[{valueType:"string"},{valueType:Utterance}]}),this.endSpeakingEmitter=new Emitter({parameters:[{valueType:"string"},{valueType:Utterance}]}),this.enabledComponentImplementation=new EnabledComponent({enabled:!1,tandem:t.tandem,enabledPropertyOptions:{phetioDocumentation:"toggles this controller of SpeechSynthesis on and off",phetioState:!1,phetioFeatured:!1}}),assert&&assert(this.enabledComponentImplementation.enabledProperty.isSettable(),"enabledProperty must be settable"),this.enabledProperty=this.enabledComponentImplementation.enabledProperty,this.mainWindowVoicingEnabledProperty=new BooleanProperty(!0,{tandem:(a=t.tandem)==null?void 0:a.createTandem("mainWindowVoicingEnabledProperty"),phetioState:!1,phetioDocumentation:"toggles the voicing feature on and off for the simulation screen (not the voicing preferences and toolbar controls)"}),this.voicingFullyEnabledProperty=DerivedProperty.and([this.enabledProperty,this.mainWindowVoicingEnabledProperty]),this._speechAllowedAndFullyEnabledProperty=new BooleanProperty(!1),this.speechAllowedAndFullyEnabledProperty=this._speechAllowedAndFullyEnabledProperty,this.synth=null,this.voicesProperty=new Property([]),this.speakingSpeechSynthesisUtteranceWrapper=null,this.isInitializedProperty=new BooleanProperty(!1),this.canSpeakProperty=null,this.boundHandleCanSpeakChange=this.handleCanSpeakChange.bind(this),this.boundHandleCanAnnounceChange=this.handleCanAnnounceChange.bind(this),this.debug&&(this.announcementCompleteEmitter.addListener((l,d)=>{console.log("announcement complete",d)}),this.startSpeakingEmitter.addListener(l=>{this.debug&&console.log("startSpeakingListener",l)}),this.endSpeakingEmitter.addListener(l=>{this.debug&&console.log("endSpeakingListener",l)}))}get initialized(){return this.isInitializedProperty.value}initialize(e,t){assert&&assert(!this.initialized,"can only be initialized once"),assert&&assert(SpeechSynthesisAnnouncer.isSpeechSynthesisSupported(),"trying to initialize speech, but speech is not supported on this platform."),assert&&assert(initializeCount===0,"Only one instance of SpeechSynthesisAnnouncer can be initialized at a time."),initializeCount++;const n=optionize()({speechAllowedProperty:new BooleanProperty(!0)},t);this.synth=window.speechSynthesis,this.canSpeakProperty=DerivedProperty.and([n.speechAllowedProperty,this.enabledProperty]),this.canSpeakProperty.link(this.boundHandleCanSpeakChange),Multilink.multilink([n.speechAllowedProperty,this.voicingFullyEnabledProperty],(a,l)=>{this._speechAllowedAndFullyEnabledProperty.value=a&&l});const r=this.getSynth();r.addEventListener&&r.addEventListener("voiceschanged",()=>{this.populateVoices()}),this.populateVoices();const s=()=>{this.timeSinceWakingEngine=ENGINE_WAKE_INTERVAL,e.removeListener(s)};e.addListener(s),stepTimer.addListener(this.step.bind(this)),this.isInitializedProperty.value=!0}step(e){e*=1e3;const t=this.getSynth();this.initialized&&t&&(this.hasSpoken||(this.hasSpoken=t.speaking),this.timeSinceUtteranceEnd=t.speaking?0:this.timeSinceUtteranceEnd+e,this.timeSincePendingUtterance=this.speakingSpeechSynthesisUtteranceWrapper&&!this.speakingSpeechSynthesisUtteranceWrapper.started?this.timeSincePendingUtterance+e:0,this.timeSincePendingUtterance>PENDING_UTTERANCE_DELAY&&(assert&&assert(this.speakingSpeechSynthesisUtteranceWrapper,"should have this.speakingSpeechSynthesisUtteranceWrapper"),this.handleSpeechSynthesisEnd(this.speakingSpeechSynthesisUtteranceWrapper.announceText,this.speakingSpeechSynthesisUtteranceWrapper),this.speakingSpeechSynthesisUtteranceWrapper=null,this.cancelSynth()),this.timeSinceUtteranceEnd>VOICING_UTTERANCE_INTERVAL&&!this.speakingSpeechSynthesisUtteranceWrapper&&(this.readyToAnnounce=!0),platform.chromium&&!platform.android&&this.voiceProperty.value&&!this.voiceProperty.value.localService&&(this.timeSincePauseResume=t.speaking?this.timeSincePauseResume+e:0,this.timeSincePauseResume>PAUSE_RESUME_WORKAROUND_INTERVAL&&(this.timeSincePauseResume=0,t.pause(),t.resume())),platform.chromeOS&&(this.timeSinceWakingEngine+=e,!t.speaking&&this.timeSinceWakingEngine>ENGINE_WAKE_INTERVAL&&(this.timeSinceWakingEngine=0,t.speak(new SpeechSynthesisUtterance(" ")))))}handleCanSpeakChange(e){e||this.cancel()}populateVoices(){const e=this.getSynth();e&&(this.voicesProperty.value=_.uniqBy(e.getVoices(),t=>t.name))}getPrioritizedVoices(){assert&&assert(this.initialized,"No voices available until the SpeechSynthesisAnnouncer is initialized"),assert&&assert(this.voicesProperty.value.length>0,"No voices available to provided a prioritized list.");const e=this.voicesProperty.value.slice(),t=_.filter(e,r=>!_.some(NOVELTY_VOICES,s=>r.name.includes(s))),n=r=>r.name.includes("Google")?-1:r.name.includes("Fred")?t.length:t.indexOf(r);return t.sort((r,s)=>n(r)-n(s))}getEnglishPrioritizedVoices(){return _.filter(this.getPrioritizedVoices(),e=>e.lang==="en-US"||e.lang==="en_US")}getPrioritizedVoicesForLocale(e){const t=e,n=e.replace("_","-");return _.filter(this.getPrioritizedVoices(),r=>{const s=voiceLangToSupportedLocale.hasOwnProperty(r.lang)?voiceLangToSupportedLocale[r.lang]:r.lang;let a=!1;return(s.includes("_")||s.includes("-"))&&(a=t===s.slice(0,2)),a||t===s||n===s})}announce(e,t){this.initialized&&this.canSpeakProperty&&this.canSpeakProperty.value?this.requestSpeech(e,t):this.handleAnnouncementFailure(t,e)}handleAnnouncementFailure(e,t){this.debug&&console.log("announcement failure",t),this.announcementCompleteEmitter.emit(e,t)}speakIgnoringEnabled(e){this.initialized&&(this.cancel(),this.requestSpeech(e.getAlertText(this.respectResponseCollectorProperties),e))}requestSpeech(e,t){if(assert&&assert(SpeechSynthesisAnnouncer.isSpeechSynthesisSupported(),"trying to speak with speechSynthesis, but it is not supported on this platform"),this.debug&&console.log("requestSpeech",e),!e){this.handleAnnouncementFailure(t,e);return}const n=optionize3()({},UTTERANCE_OPTION_DEFAULTS,t.announcerOptions),r=removeBrTags(stripEmbeddingMarks(e+""));validate(r,Validation.STRING_WITHOUT_TEMPLATE_VARS_VALIDATOR);const s=new SpeechSynthesisUtterance(r);s.voice=n.voice||this.voiceProperty.value,s.pitch=this.voicePitchProperty.value,s.rate=this.voiceRateProperty.value,s.volume=this.voiceVolumeProperty.value;const a=()=>{this.startSpeakingEmitter.emit(r,t),assert&&assert(this.speakingSpeechSynthesisUtteranceWrapper,"should have been set in requestSpeech"),this.speakingSpeechSynthesisUtteranceWrapper.started=!0,s.removeEventListener("start",a)},l=()=>{this.handleSpeechSynthesisEnd(r,d)},d=new SpeechSynthesisUtteranceWrapper(t,e,s,!1,l,a);assert&&assert(this.speakingSpeechSynthesisUtteranceWrapper===null,"Wrapper should be null, we should have received an end event to clear it before the next one."),this.speakingSpeechSynthesisUtteranceWrapper=d,s.addEventListener("start",a),s.addEventListener("end",l),s.addEventListener("error",l),this.readyToAnnounce=!1,this.timeSinceUtteranceEnd=0,t.canAnnounceProperty.link(this.boundHandleCanAnnounceChange),t.voicingCanAnnounceProperty.link(this.boundHandleCanAnnounceChange),this.getSynth().speak(s)}handleCanAnnounceChange(){this.speakingSpeechSynthesisUtteranceWrapper&&this.cancelUtteranceIfCanAnnounceFalse(this.speakingSpeechSynthesisUtteranceWrapper.utterance)}cancelUtteranceIfCanAnnounceFalse(e){(!e.canAnnounceProperty.value||!e.voicingCanAnnounceProperty.value)&&this.cancelUtterance(e)}handleSpeechSynthesisEnd(e,t){this.endSpeakingEmitter.emit(e,t.utterance),this.announcementCompleteEmitter.emit(t.utterance,t.speechSynthesisUtterance.text),t.speechSynthesisUtterance.removeEventListener("error",t.endListener),t.speechSynthesisUtterance.removeEventListener("end",t.endListener),t.speechSynthesisUtterance.removeEventListener("start",t.startListener);const n=t.utterance.canAnnounceProperty;n.hasListener(this.boundHandleCanAnnounceChange)&&n.unlink(this.boundHandleCanAnnounceChange);const r=t.utterance.voicingCanAnnounceProperty;r.hasListener(this.boundHandleCanAnnounceChange)&&r.unlink(this.boundHandleCanAnnounceChange),this.speakingSpeechSynthesisUtteranceWrapper=null}getSynth(){return assert&&assert(SpeechSynthesisAnnouncer.isSpeechSynthesisSupported(),"Trying to use SpeechSynthesis, but it is not supported on this platform."),this.synth}cancel(){this.initialized&&this.speakingSpeechSynthesisUtteranceWrapper&&this.cancelUtterance(this.speakingSpeechSynthesisUtteranceWrapper.utterance)}cancelUtterance(e){const t=this.speakingSpeechSynthesisUtteranceWrapper;t&&e===t.utterance&&(this.handleSpeechSynthesisEnd(t.announceText,t),this.cancelSynth())}shouldUtteranceCancelOther(e,t){const n=optionize3()({},UTTERANCE_OPTION_DEFAULTS,e.announcerOptions);let r;return t.priorityProperty.value!==e.priorityProperty.value?r=t.priorityProperty.value<e.priorityProperty.value:(r=n.cancelOther,t&&t===e&&(r=n.cancelSelf)),r}onUtterancePriorityChange(e){const t=this.speakingSpeechSynthesisUtteranceWrapper;t&&this.shouldUtteranceCancelOther(e,t.utterance)&&this.cancelUtterance(t.utterance)}cancelSynth(){assert&&assert(this.initialized,"must be initialized to use synth");const e=this.getSynth();e&&e.cancel()}static isSpeechSynthesisSupported(){return!!window.speechSynthesis&&!!window.SpeechSynthesisUtterance}}class SpeechSynthesisUtteranceWrapper{constructor(e,t,n,r,s,a){this.utterance=e,this.announceText=t,this.speechSynthesisUtterance=n,this.started=r,this.endListener=s,this.startListener=a}}function removeBrTags(o){return o.split("<br/>").join(" ").split("<br>").join(" ")}const SpeechSynthesisVoiceIO=new IOType("SpeechSynthesisVoiceIO",{isValidValue:o=>!0,toStateObject:o=>o.name});utteranceQueueNamespace.register("SpeechSynthesisAnnouncer",SpeechSynthesisAnnouncer);class VoicingManager extends SpeechSynthesisAnnouncer{constructor(e){const t=optionize()({respectResponseCollectorProperties:!0,phetioDocumentation:"Announcer that manages the voicing feature, providing audio responses via WebAudio."},e);super(t)}initialize(e,t){super.initialize(e,t),globalKeyStateTracker$1.keyupEmitter.addListener(n=>{KeyboardUtils.isControlKey(n)&&this.cancel()})}voicingSupportedForLocale(e){return e.startsWith("en")}}const voicingManager=new VoicingManager;scenery.register("voicingManager",voicingManager);const voicingManager$1=voicingManager,NUMBER_OF_ARIA_LIVE_ELEMENTS=4;let ariaLiveAnnouncerIndex=1;const zo=class zo extends EnumerationValue{constructor(e){super(),this.attributeString=e}};zo.POLITE=new zo("polite"),zo.ASSERTIVE=new zo("assertive"),zo.enumeration=new Enumeration(zo);let AriaLive=zo;function createBatchOfPriorityLiveElements(o){const e=o.attributeString,t=document.createElement("div");for(let n=1;n<=NUMBER_OF_ARIA_LIVE_ELEMENTS;n++){const r=document.createElement("p");r.setAttribute("id",`elements-${ariaLiveAnnouncerIndex}-${e}-${n}`),r.setAttribute("aria-live",e),t.appendChild(r)}return t}const Nl=class Nl extends Announcer{constructor(e){const t=optionize()({respectResponseCollectorProperties:!1,lang:"en"},e);super(t),this.politeElementIndex=0,this.assertiveElementIndex=0,this.ariaLiveContainer=document.createElement("div"),this.ariaLiveContainer.setAttribute("lang",t.lang),this.ariaLiveContainer.setAttribute("id",`aria-live-elements-${ariaLiveAnnouncerIndex}`),this.ariaLiveContainer.setAttribute("style","position: absolute; left: 0px; top: 0px; width: 0px; height: 0px; clip: rect(0px 0px 0px 0px); pointer-events: none;");const n=createBatchOfPriorityLiveElements(AriaLive.POLITE),r=createBatchOfPriorityLiveElements(AriaLive.ASSERTIVE);this.ariaLiveContainer.appendChild(n),this.ariaLiveContainer.appendChild(r),this.politeElements=Array.from(n.children),this.assertiveElements=Array.from(r.children),ariaLiveAnnouncerIndex++}announce(e,t,n){const r=optionize()({ariaLivePriority:AriaLive.POLITE},n);if(this.hasSpoken=!0,e)if(r.ariaLivePriority===AriaLive.POLITE){const s=this.politeElements[this.politeElementIndex];this.updateLiveElement(s,e,t),this.politeElementIndex=(this.politeElementIndex+1)%this.politeElements.length}else if(r.ariaLivePriority===AriaLive.ASSERTIVE){const s=this.assertiveElements[this.assertiveElementIndex];this.updateLiveElement(s,e,t),this.assertiveElementIndex=(this.assertiveElementIndex+1)%this.assertiveElements.length}else assert&&assert(!1,"unsupported aria live prioirity");this.announcementCompleteEmitter.emit(t,e)}cancel(){}cancelUtterance(e){}updateLiveElement(e,t,n){e.textContent="",e.hidden=!1,this.readyToAnnounce=!1,stepTimer.setTimeout(()=>{n.predicate()?(PDOMUtils$1.setTextContent(e,t),stepTimer.setTimeout(()=>{platform.safari?e.hidden=!0:e.textContent="",this.readyToAnnounce=!0},Nl.ARIA_LIVE_DELAY)):this.readyToAnnounce=!0},0)}};Nl.ARIA_LIVE_DELAY=200,Nl.AriaLive=AriaLive;let AriaLiveAnnouncer=Nl;utteranceQueueNamespace.register("AriaLiveAnnouncer",AriaLiveAnnouncer);const AriaLiveAnnouncer$1=AriaLiveAnnouncer;class UtteranceWrapper{constructor(e){this.utterance=e,this.timeInQueue=0,this.stableTime=0,this.announcingUtterancePriorityListener=null}resetTimingVariables(){this.timeInQueue=0,this.stableTime=0}}utteranceQueueNamespace.register("UtteranceWrapper",UtteranceWrapper);class UtteranceQueue extends PhetioObject{constructor(e,t){const n=optionize()({debug:!1,initialize:!0,featureSpecificAnnouncingControlPropertyName:null},t);super(n),this.announcer=e,this._initialized=n.initialize,this.featureSpecificAnnouncingControlPropertyName=n.featureSpecificAnnouncingControlPropertyName,this.queue=[],this._muted=!1,this._enabled=!0,this.utteranceToPriorityListenerMap=new Map,this.announcingUtteranceWrapper=null,this.debug=n.debug,this.announcer.announcementCompleteEmitter.addListener(r=>{if(this.announcingUtteranceWrapper&&r===this.announcingUtteranceWrapper.utterance){assert&&assert(this.announcingUtteranceWrapper.announcingUtterancePriorityListener,"announcingUtterancePriorityListener should be set on this.announcingUtteranceWrapper");const s=this.announcingUtteranceWrapper.announcingUtterancePriorityListener;this.announcingUtteranceWrapper.utterance.priorityProperty.hasListener(s)&&(this.announcingUtteranceWrapper.utterance.priorityProperty.unlink(s),this.announcingUtteranceWrapper.announcingUtterancePriorityListener=null,this.announcingUtteranceWrapper=null)}}),this.stepQueueListener=null,this._initialized&&(this.stepQueueListener=this.stepQueue.bind(this),stepTimer.addListener(this.stepQueueListener))}get length(){return this.queue.length}addToBack(e){if(this.initializedAndEnabled)if(!this.announcer.hasSpoken)this.announceImmediately(e);else{const t=this.prepareUtterance(e);this.queue.push(t),this.debug&&console.log("addToBack"),this.addPriorityListenerAndPrioritizeQueue(t)}}addToFront(e){if(deprecationWarning("`addToFront()` has been deprecated because it is confusing, and most of the time doesn't do what is expected, because Utterances are announced based on time-in-queue first, and then position in the queue. It is recommended to use addToBack, and then timing variables on Utterances, or instead call queue.clear() before adding a more important alert to the queue."),!this.initializedAndEnabled)return;const t=this.prepareUtterance(e);this.queue.unshift(t)}addPriorityListenerAndPrioritizeQueue(e){assert&&assert(!this.utteranceToPriorityListenerMap.has(e.utterance),"About to add the priority listener twice and only one should exist on the Utterance. The listener should have been removed by removeOthersAndUpdateUtteranceWrapper.");const t=()=>{this.prioritizeUtterances(e)};e.utterance.priorityProperty.lazyLink(t),this.utteranceToPriorityListenerMap.set(e.utterance,t),this.prioritizeUtterances(e)}prepareUtterance(e){e instanceof Utterance||(e=new Utterance({alert:e}));const t=new UtteranceWrapper(e);return this.removeOthersAndUpdateUtteranceWrapper(t),t.stableTime=0,t}removeUtterance(e){const t=r=>r.utterance===e;assert&&assert(_.find(this.queue,t),"utterance to be removed not found in queue");const n=_.remove(this.queue,t);this.removePriorityListeners(n)}prioritizeUtterances(e){let t=this.queue.indexOf(e);const n=t>=0;let r;n?r=t-1:r=-1;for(let s=r;s>=0;s--){const a=this.queue[s];this.shouldUtteranceCancelOther(e.utterance,a.utterance)&&this.removeUtterance(a.utterance)}if(n){t=this.queue.indexOf(e),assert&&assert(t>-1,"utteranceWrapper is not in queue?");const s=this.queue[t+1];s&&this.shouldUtteranceCancelOther(s.utterance,e.utterance)&&this.removeUtterance(e.utterance)}this.queue.length>0&&this.announcer.onUtterancePriorityChange(this.queue[0].utterance)}shouldUtteranceCancelOther(e,t){return this.announcer.shouldUtteranceCancelOther(e,t)}removeOthersAndUpdateUtteranceWrapper(e){const t=[];for(let r=0;r<this.queue.length;r++){const s=this.queue[r];s.utterance===e.utterance&&t.push(s.timeInQueue)}t.length>=1&&(e.timeInQueue=Math.max(...t));const n=_.remove(this.queue,r=>r.utterance===e.utterance);this.removePriorityListeners(n)}get initializedAndEnabled(){return this._enabled&&this._initialized}getNextUtterance(){let e=null;for(let t=0;t<this.queue.length;t++){const n=this.queue[t];if(n.stableTime>n.utterance.alertStableDelay||n.timeInQueue>n.utterance.alertMaximumDelay){e=n;break}}return e}hasUtterance(e){for(let t=0;t<this.queue.length;t++){const n=this.queue[t];if(e===n.utterance)return!0}return!1}clear(){this.debug&&console.log("UttearnceQueue.clear()"),this.removePriorityListeners(this.queue),this.queue.length=0}cancelUtterance(e){this.announcer.cancelUtterance(e),this.hasUtterance(e)&&this.removeUtterance(e)}cancel(){this.debug&&console.log("UtteranceQueue.cancel()"),this.clear(),this.announcer.cancel()}removePriorityListeners(e){e.forEach(t=>this.removePriorityListener(t.utterance))}removePriorityListener(e){const t=this.utteranceToPriorityListenerMap.get(e);t&&(e.priorityProperty.unlink(t),this.utteranceToPriorityListenerMap.delete(e))}setMuted(e){this._muted=e}set muted(e){this.setMuted(e)}get muted(){return this.getMuted()}getMuted(){return this._muted}setEnabled(e){this._enabled=e}set enabled(e){this.setEnabled(e)}get enabled(){return this.isEnabled()}isEnabled(){return this._enabled}stepQueue(e){if(this._enabled&&(e*=1e3,this.queue.length>0)){for(let n=0;n<this.queue.length;n++){const r=this.queue[n];r.timeInQueue+=e,r.stableTime+=e}const t=this.getNextUtterance();t&&this.attemptToAnnounce(t)}}announceImmediately(e){if(this.initializedAndEnabled&&(this.debug&&console.log("announceImmediately"),e instanceof Utterance||(e=new Utterance({alert:e})),this.announcingUtteranceWrapper===null||this.announcer.shouldUtteranceCancelOther(e,this.announcingUtteranceWrapper.utterance))){const t=this.prepareUtterance(e);t.stableTime=Number.POSITIVE_INFINITY,t.timeInQueue=Number.POSITIVE_INFINITY,this.queue.unshift(t),this.addPriorityListenerAndPrioritizeQueue(t),this.queue.includes(t)&&this.attemptToAnnounce(t)}}attemptToAnnounce(e){const t=e.utterance;if(this.announcer.readyToAnnounce){const n=t.getAlertText(this.announcer.respectResponseCollectorProperties);this.debug&&console.log("ready to announce in attemptToAnnounce(): ",n);const r=!this.featureSpecificAnnouncingControlPropertyName||t[this.featureSpecificAnnouncingControlPropertyName].value,s=t.canAnnounceProperty.value&&t.predicate()&&r;!this._muted&&s&&n!==""?(assert&&assert(this.announcingUtteranceWrapper===null,"announcingUtteranceWrapper and its priorityProperty listener should have been disposed"),this.announcingUtteranceWrapper=e,this.announcingUtteranceWrapper.announcingUtterancePriorityListener=()=>{this.prioritizeUtterances(e)},e.utterance.priorityProperty.link(this.announcingUtteranceWrapper.announcingUtterancePriorityListener),this.debug&&console.log("announcing: ",n),this.announcer.announce(n,t,t.announcerOptions)):this.debug&&console.log("announcer readyToAnnounce but utterance cannot announce, will not be spoken: ",n),this.queue.includes(e)&&this.removeUtterance(e.utterance)}else this.debug&&console.log("announcer not readyToAnnounce")}dispose(){this._initialized&&(assert&&assert(this.stepQueueListener),stepTimer.removeListener(this.stepQueueListener)),super.dispose()}static fromFactory(){const e=new AriaLiveAnnouncer$1,t=new UtteranceQueue(e),n=e.ariaLiveContainer;document.body?document.body.appendChild(n):document.children[0].appendChild(n);let r=0;const s=a=>{const l=a-r;r=a,phet.axon.stepTimer.emit(l/1e3),window.requestAnimationFrame(s)};return window.requestAnimationFrame(s),t}}utteranceQueueNamespace.register("UtteranceQueue",UtteranceQueue);const UtteranceQueue$1=UtteranceQueue,voicingUtteranceQueue=new UtteranceQueue$1(voicingManager$1,{featureSpecificAnnouncingControlPropertyName:"voicingCanAnnounceProperty"});voicingUtteranceQueue.enabled=!1;scenery.register("voicingUtteranceQueue",voicingUtteranceQueue);function assertUtterance(o){if(!(o instanceof Utterance))throw new Error("utterance is not an Utterance")}class OwnedVoicingUtterance extends Utterance{constructor(e){super(e)}}const VOICING_OPTION_KEYS=["voicingNameResponse","voicingObjectResponse","voicingContextResponse","voicingHintResponse","voicingUtterance","voicingResponsePatternCollection","voicingIgnoreVoicingManagerProperties","voicingFocusListener"],Voicing=o=>{assert&&assert(_.includes(inheritance(o),Node$2),"Only Node subtypes should compose Voicing");const e=DelayedMutate$1("Voicing",VOICING_OPTION_KEYS,class yd extends InteractiveHighlighting(o){constructor(...n){super(...n),this._boundInstanceCanVoiceChangeListener=this.onInstanceCanVoiceChange.bind(this),this._voicingUtterance=null,yd.prototype.initialize.call(this)}initialize(...n){return super.initialize&&super.initialize(n),this._voicingCanSpeakProperty=new TinyProperty(!0),this._voicingResponsePacket=new ResponsePacket,this._voicingFocusListener=this.defaultFocusListener,this.setVoicingUtterance(new OwnedVoicingUtterance),this._voicingCanSpeakCount=0,this._boundInstancesChangedListener=this.addOrRemoveInstanceListeners.bind(this),this.changedInstanceEmitter.addListener(this._boundInstancesChangedListener),this._speakContentOnFocusListener={focus:r=>{this._voicingFocusListener&&this._voicingFocusListener(r)}},this.addInputListener(this._speakContentOnFocusListener),this}voicingSpeakFullResponse(n){const r=combineOptions({},n);r.hasOwnProperty("nameResponse")||(r.nameResponse=this._voicingResponsePacket.nameResponse),r.hasOwnProperty("objectResponse")||(r.objectResponse=this._voicingResponsePacket.objectResponse),r.hasOwnProperty("contextResponse")||(r.contextResponse=this._voicingResponsePacket.contextResponse),r.hasOwnProperty("hintResponse")||(r.hintResponse=this._voicingResponsePacket.hintResponse),this.collectAndSpeakResponse(r)}voicingSpeakResponse(n){const r=combineOptions({nameResponse:null,objectResponse:null,contextResponse:null,hintResponse:null},n);this.collectAndSpeakResponse(r)}voicingSpeakNameResponse(n){const r=combineOptions({},n);r.hasOwnProperty("nameResponse")||(r.nameResponse=this._voicingResponsePacket.nameResponse),this.collectAndSpeakResponse(r)}voicingSpeakObjectResponse(n){const r=combineOptions({},n);r.hasOwnProperty("objectResponse")||(r.objectResponse=this._voicingResponsePacket.objectResponse),this.collectAndSpeakResponse(r)}voicingSpeakContextResponse(n){const r=combineOptions({},n);r.hasOwnProperty("contextResponse")||(r.contextResponse=this._voicingResponsePacket.contextResponse),this.collectAndSpeakResponse(r)}voicingSpeakHintResponse(n){const r=combineOptions({},n);r.hasOwnProperty("hintResponse")||(r.hintResponse=this._voicingResponsePacket.hintResponse),this.collectAndSpeakResponse(r)}collectAndSpeakResponse(n){this.speakContent(this.collectResponse(n))}collectResponse(n){const r=combineOptions({ignoreProperties:this._voicingResponsePacket.ignoreProperties,responsePatternCollection:this._voicingResponsePacket.responsePatternCollection,utterance:this.voicingUtterance},n);let s=responseCollector$1.collectResponses(r);return r.utterance&&(r.utterance.alert=s,s=r.utterance),s}speakContent(n){const r=!Tandem.PHET_IO_ENABLED||!this.isInsidePhetioArchetype();n&&r&&voicingUtteranceQueue.addToBack(n)}setVoicingNameResponse(n){this._voicingResponsePacket.nameResponse=n}set voicingNameResponse(n){this.setVoicingNameResponse(n)}get voicingNameResponse(){return this.getVoicingNameResponse()}getVoicingNameResponse(){return this._voicingResponsePacket.nameResponse}setVoicingObjectResponse(n){this._voicingResponsePacket.objectResponse=n}set voicingObjectResponse(n){this.setVoicingObjectResponse(n)}get voicingObjectResponse(){return this.getVoicingObjectResponse()}getVoicingObjectResponse(){return this._voicingResponsePacket.objectResponse}setVoicingContextResponse(n){this._voicingResponsePacket.contextResponse=n}set voicingContextResponse(n){this.setVoicingContextResponse(n)}get voicingContextResponse(){return this.getVoicingContextResponse()}getVoicingContextResponse(){return this._voicingResponsePacket.contextResponse}setVoicingHintResponse(n){this._voicingResponsePacket.hintResponse=n}set voicingHintResponse(n){this.setVoicingHintResponse(n)}get voicingHintResponse(){return this.getVoicingHintResponse()}getVoicingHintResponse(){return this._voicingResponsePacket.hintResponse}setVoicingIgnoreVoicingManagerProperties(n){this._voicingResponsePacket.ignoreProperties=n}set voicingIgnoreVoicingManagerProperties(n){this.setVoicingIgnoreVoicingManagerProperties(n)}get voicingIgnoreVoicingManagerProperties(){return this.getVoicingIgnoreVoicingManagerProperties()}getVoicingIgnoreVoicingManagerProperties(){return this._voicingResponsePacket.ignoreProperties}setVoicingResponsePatternCollection(n){this._voicingResponsePacket.responsePatternCollection=n}set voicingResponsePatternCollection(n){this.setVoicingResponsePatternCollection(n)}get voicingResponsePatternCollection(){return this.getVoicingResponsePatternCollection()}getVoicingResponsePatternCollection(){return this._voicingResponsePacket.responsePatternCollection}setVoicingUtterance(n){this._voicingUtterance!==n&&(this._voicingUtterance&&this.cleanVoicingUtterance(),Voicing.registerUtteranceToVoicingNode(n,this),this._voicingUtterance=n)}set voicingUtterance(n){this.setVoicingUtterance(n)}get voicingUtterance(){return this.getVoicingUtterance()}getVoicingUtterance(){return assertUtterance(this._voicingUtterance),this._voicingUtterance}setVoicingFocusListener(n){this._voicingFocusListener=n}set voicingFocusListener(n){this.setVoicingFocusListener(n)}get voicingFocusListener(){return this.getVoicingFocusListener()}getVoicingFocusListener(){return this._voicingFocusListener}defaultFocusListener(){this.voicingSpeakFullResponse({contextResponse:null})}get isVoicing(){return!0}dispose(){this.removeInputListener(this._speakContentOnFocusListener),this.changedInstanceEmitter.removeListener(this._boundInstancesChangedListener),this._voicingUtterance&&(this.cleanVoicingUtterance(),this._voicingUtterance=null),super.dispose()}clean(){this.removeInputListener(this._speakContentOnFocusListener),this.changedInstanceEmitter.removeListener(this._boundInstancesChangedListener),this._voicingUtterance&&(this.cleanVoicingUtterance(),this._voicingUtterance=null),super.clean&&super.clean()}onInstanceCanVoiceChange(n){n?this._voicingCanSpeakCount++:this._voicingCanSpeakCount--,assert&&assert(this._voicingCanSpeakCount>=0,"the voicingCanSpeakCount should not go below zero"),assert&&assert(this._voicingCanSpeakCount<=this.instances.length,"The voicingCanSpeakCount cannot be greater than the number of Instances."),this._voicingCanSpeakProperty.value=this._voicingCanSpeakCount>0}handleInstancesChanged(n,r){n.visible&&n.voicingVisible&&(this._voicingCanSpeakCount=r?this._voicingCanSpeakCount+1:this._voicingCanSpeakCount-1),this._voicingCanSpeakProperty.value=this._voicingCanSpeakCount>0}addOrRemoveInstanceListeners(n,r){assert&&assert(n.canVoiceEmitter,"Instance must be initialized."),r?n.canVoiceEmitter.addListener(this._boundInstanceCanVoiceChangeListener):n.canVoiceEmitter.removeListener(this._boundInstanceCanVoiceChangeListener),this.handleInstancesChanged(n,r)}cleanVoicingUtterance(){assert&&assert(this._voicingUtterance,"A voicingUtterance must be available to clean."),this._voicingUtterance instanceof OwnedVoicingUtterance?this._voicingUtterance.dispose():this._voicingUtterance&&!this._voicingUtterance.isDisposed&&Voicing.unregisterUtteranceToVoicingNode(this._voicingUtterance,this)}mutate(n){return super.mutate(n)}});return e.prototype._mutatorKeys=VOICING_OPTION_KEYS.concat(e.prototype._mutatorKeys),assert&&assert(e.prototype._mutatorKeys.length===_.uniq(e.prototype._mutatorKeys).length,"duplicate mutator keys in Voicing"),e};Voicing.VOICING_OPTION_KEYS=VOICING_OPTION_KEYS;Voicing.alertUtterance=o=>{assert&&assert(o.voicingCanAnnounceProperties.length>0,"voicingCanAnnounceProperties required, this Utterance might not be connected to Node in the scene graph."),voicingUtteranceQueue.addToBack(o)};Voicing.registerUtteranceToVoicingNode=(o,e)=>{const t=o.voicingCanAnnounceProperties,n=e._voicingCanSpeakProperty;t.includes(n)||(o.voicingCanAnnounceProperties=t.concat([n]))};Voicing.unregisterUtteranceToVoicingNode=(o,e)=>{const t=o.voicingCanAnnounceProperties,n=e._voicingCanSpeakProperty,r=t.indexOf(n);assert&&assert(r>-1,"voicingNode.voicingCanSpeakProperty is not on the Utterance, was it not registered?"),o.voicingCanAnnounceProperties=t.splice(r,1)};Voicing.registerUtteranceToNode=(o,e)=>{const t=o.voicingCanAnnounceProperties;t.includes(e.visibleProperty)||(o.voicingCanAnnounceProperties=o.voicingCanAnnounceProperties.concat([e.visibleProperty])),t.includes(e.voicingVisibleProperty)||(o.voicingCanAnnounceProperties=o.voicingCanAnnounceProperties.concat([e.voicingVisibleProperty]))};Voicing.unregisterUtteranceToNode=(o,e)=>{const t=o.voicingCanAnnounceProperties;assert&&assert(t.includes(e.visibleProperty)&&t.includes(e.voicingVisibleProperty),"visibleProperty and voicingVisibleProperty were not on the Utterance, was it not registered to the node?");const n=t.indexOf(e.visibleProperty),s=t.splice(n,1).indexOf(e.voicingVisibleProperty),a=t.splice(s,1);o.voicingCanAnnounceProperties=a};scenery.register("Voicing",Voicing);class ReadingBlockUtterance extends Utterance{constructor(e,t){super(t),this.readingBlockFocus=e}}scenery.register("ReadingBlockUtterance",ReadingBlockUtterance);const ReadingBlockUtterance$1=ReadingBlockUtterance;class FocusDisplayedController{constructor(e){this.node=null,this.visibilityTracker=null,this.focusProperty=e,this.boundVisibilityListener=this.handleTrailVisibilityChange.bind(this),this.boundInstancesChangedListener=this.handleInstancesChange.bind(this),this.boundNodeDisposedListener=this.handleNodeDisposed.bind(this),this.boundFocusListener=this.handleFocusChange.bind(this),this.focusProperty.link(this.boundFocusListener)}handleFocusChange(e){this.removeDisplayedListeners(),e&&this.addDisplayedListeners(e)}handleTrailVisibilityChange(){this.visibilityTracker&&!this.visibilityTracker.trailVisibleProperty.value&&(this.focusProperty.value=null)}handleInstancesChange(e){e.node&&e.node.instances.length===0&&(this.focusProperty.value=null)}handleNodeDisposed(){this.focusProperty.value=null}addDisplayedListeners(e){assert&&assert(this.visibilityTracker===null,"creating a new TrailVisibilityTracker but the last one was not disposed"),assert&&assert(this.node===null,"Still a reference to the previously focused Node, possible memory leak"),this.visibilityTracker=new TrailVisibilityTracker(e.trail),this.visibilityTracker.addListener(this.boundVisibilityListener),this.node=e.trail.lastNode(),this.node.changedInstanceEmitter.addListener(this.boundInstancesChangedListener),this.node.disposeEmitter.addListener(this.boundNodeDisposedListener)}removeDisplayedListeners(){this.visibilityTracker&&(this.visibilityTracker.removeListener(this.boundVisibilityListener),this.visibilityTracker.dispose(),this.visibilityTracker=null),this.node&&(this.node.changedInstanceEmitter.removeListener(this.boundInstancesChangedListener),this.node.disposeEmitter.removeListener(this.boundNodeDisposedListener),this.node=null)}dispose(){this.removeDisplayedListeners(),this.focusProperty.unlink(this.boundFocusListener),this.node=null,this.visibilityTracker=null}}scenery.register("FocusDisplayedController",FocusDisplayedController);const FocusDisplayedController$1=FocusDisplayedController,ws=class ws{constructor(){this.pointerFocusProperty=new Property(null),this.readingBlockFocusProperty=new Property(null),this.lockedPointerFocusProperty=new Property(null),this.pdomFocusHighlightsVisibleProperty=new BooleanProperty(!0),this.interactiveHighlightsVisibleProperty=new BooleanProperty(!1),this.readingBlockHighlightsVisibleProperty=new BooleanProperty(!1),this.voicingFullyEnabledListener=e=>{this.readingBlockHighlightsVisibleProperty.value=e},voicingManager$1.voicingFullyEnabledProperty.link(this.voicingFullyEnabledListener),this.pointerHighlightsVisibleProperty=new DerivedProperty([this.interactiveHighlightsVisibleProperty,this.readingBlockHighlightsVisibleProperty],(e,t)=>e||t),this.readingBlockFocusController=new FocusDisplayedController$1(this.readingBlockFocusProperty),this.startSpeakingListener=(e,t)=>{this.readingBlockFocusProperty.value=t instanceof ReadingBlockUtterance$1?t.readingBlockFocus:null},voicingManager$1.startSpeakingEmitter.addListener(this.startSpeakingListener),this.endSpeakingListener=(e,t)=>{t instanceof ReadingBlockUtterance$1&&this.readingBlockFocusProperty.value&&(assert&&assert(t.readingBlockFocus,"should be non null focus"),t.readingBlockFocus.trail.equals(this.readingBlockFocusProperty.value.trail)&&(this.readingBlockFocusProperty.value=null))},voicingManager$1.endSpeakingEmitter.addListener(this.endSpeakingListener),this.pointerFocusDisplayedController=new FocusDisplayedController$1(this.pointerFocusProperty),this.lockedPointerFocusDisplayedController=new FocusDisplayedController$1(this.lockedPointerFocusProperty),[this.pointerFocusProperty,this.lockedPointerFocusProperty].forEach(e=>{e.link(this.onPointerFocusChange.bind(this))})}dispose(){this.pointerFocusProperty.dispose(),this.readingBlockFocusProperty.dispose(),this.lockedPointerFocusProperty.dispose(),this.pdomFocusHighlightsVisibleProperty.dispose(),this.interactiveHighlightsVisibleProperty.dispose(),this.readingBlockHighlightsVisibleProperty.dispose(),this.readingBlockFocusController.dispose(),this.pointerFocusDisplayedController.dispose(),this.pointerHighlightsVisibleProperty.dispose(),this.lockedPointerFocusDisplayedController.dispose(),voicingManager$1.startSpeakingEmitter.removeListener(this.startSpeakingListener),voicingManager$1.endSpeakingEmitter.removeListener(this.endSpeakingListener),voicingManager$1.voicingFullyEnabledProperty.unlink(this.voicingFullyEnabledListener)}static updatePDOMFocusFromEvent(e,t,n){if(assert&&assert(document.activeElement,"Must be called from focusin, therefore active elemetn expected"),n)for(let r=0;r<e.length;r++){const s=e[r],a=document.activeElement;if(s.isElementUnderPDOM(a)){const l=a.getAttribute(PDOMUtils$1.DATA_PDOM_UNIQUE_ID);assert&&assert(l,"Event target must have a unique ID on its data if it is in the PDOM.");const d=PDOMInstance$1.uniqueIdToTrail(s,l);assert&&assert(d,"We must have a trail since the target was under the PDOM.");const c=PDOMInstance$1.guessVisualTrail(d,s.rootNode);c.lastNode().focusable?ws.pdomFocus=new Focus(s,c):(t.target.blur(),t.stopImmediatePropagation());break}}else for(let r=0;r<e.length;r++){const s=e[r],a=s._input.getRelatedTargetTrail(t);a&&a.lastNode().focusable?ws.pdomFocus=new Focus(s,PDOMInstance$1.guessVisualTrail(a,s.rootNode)):ws.pdomFocus=null}}onPointerFocusChange(e,t){const n=e==null?void 0:e.trail.lastNode();n&&n.isInteractiveHighlighting&&n.handleHighlightActiveChange();const r=t==null?void 0:t.trail.lastNode();r&&r.isInteractiveHighlighting&&r.handleHighlightActiveChange()}static set pdomFocus(e){if(ws.pdomFocusProperty.value!==e){let t;ws.pdomFocusProperty.value&&(t=ws.pdomFocusedNode),ws.pdomFocusProperty.value=e,t&&!e&&t.blur()}}static get pdomFocus(){return ws.pdomFocusProperty.value}static getPDOMFocusedNode(){let e=null;const t=ws.pdomFocusProperty.get();return t&&(e=t.trail.lastNode()),e}static get pdomFocusedNode(){return this.getPDOMFocusedNode()}static attachToWindow(){assert&&assert(!ws.globallyAttached,"Can only be attached statically once."),ws.attachedWindowFocusListener=()=>{ws._windowHasFocusProperty.value=!0},ws.attachedWindowBlurListener=()=>{ws._windowHasFocusProperty.value=!1},window.addEventListener("focus",ws.attachedWindowFocusListener),window.addEventListener("blur",ws.attachedWindowBlurListener),ws._windowHasFocusProperty.value=document.hasFocus(),ws.globallyAttached=!0}static detachFromWindow(){window.removeEventListener("focus",ws.attachedWindowFocusListener),window.removeEventListener("blur",ws.attachedWindowBlurListener),ws._windowHasFocusProperty.value=!1,ws.globallyAttached=!1}};ws.attachedWindowFocusListener=null,ws.attachedWindowBlurListener=null,ws.globallyAttached=!1,ws.pdomFocusProperty=new Property(null,{tandem:Tandem.GENERAL_MODEL.createTandem("pdomFocusProperty"),phetioDocumentation:"Stores the current focus in the Parallel DOM, null if nothing has focus. This is not updated based on mouse or touch input, only keyboard and other alternative inputs. Note that this only applies to simulations that support alternative input.",phetioValueType:NullableIO(Focus.FocusIO),phetioState:!1,phetioFeatured:!0,phetioReadOnly:!0}),ws._windowHasFocusProperty=new BooleanProperty(!1),ws.windowHasFocusProperty=ws._windowHasFocusProperty;let FocusManager=ws;scenery.register("FocusManager",FocusManager);const OUTER_FOCUS_COLOR=new Color("rgba(212,19,106,0.5)"),INNER_FOCUS_COLOR=new Color("rgba(250,40,135,0.9)"),INNER_LIGHT_GROUP_FOCUS_COLOR=new Color("rgba(233,113,166,1.0)"),OUTER_LIGHT_GROUP_FOCUS_COLOR=new Color("rgba(233,113,166,1.0)"),INNER_DARK_GROUP_FOCUS_COLOR=new Color("rgba(159,15,80,1.0)"),OUTER_DARK_GROUP_FOCUS_COLOR=new Color("rgba(159,15,80,1.0)"),INNER_LINE_WIDTH_BASE=2.5,OUTER_LINE_WIDTH_BASE=4,GROUP_OUTER_LINE_WIDTH=2,GROUP_INNER_LINE_WIDTH=2,Tn=class Tn extends Path{constructor(e,t){const n=optionize()({outerStroke:OUTER_FOCUS_COLOR,innerStroke:INNER_FOCUS_COLOR,outerLineWidth:null,innerLineWidth:null,dashed:!1,transformSourceNode:null},t);super(e),this.highlightChangedEmitter=new Emitter,this._innerHighlightColor=n.innerStroke,this._outerHighlightColor=n.outerStroke;const r=_.pick(n,Object.keys(Path.DEFAULT_PATH_OPTIONS));this.innerLineWidth=n.innerLineWidth,this.outerLineWidth=n.outerLineWidth,this.transformSourceNode=n.transformSourceNode,n.stroke=n.outerStroke,this.mutate(n);const s=combineOptions({},r,{stroke:n.innerStroke});this.innerHighlightPath=new Path(e,s),this.addChild(this.innerHighlightPath),this.updateLineWidth(),n.dashed&&this.makeDashed(!0)}mutateWithInnerHighlight(e){super.mutate(e),this.innerHighlightPath&&this.innerHighlightPath.mutate(e),this.highlightChangedEmitter.emit()}makeDashed(e){const t=e?[7,7]:[];this.mutateWithInnerHighlight({lineDash:t})}setShape(e){return super.setShape(e),this.innerHighlightPath&&this.innerHighlightPath.setShape(e),this.highlightChangedEmitter&&this.highlightChangedEmitter.emit(),this}updateLineWidth(e){e=e||this,this.lineWidth=this.getOuterLineWidth(e),this.innerHighlightPath.lineWidth=this.getInnerLineWidth(e),this.highlightChangedEmitter.emit()}getOuterLineWidth(e){return this.outerLineWidth?this.outerLineWidth:Tn.getOuterLineWidthFromNode(e)}getInnerLineWidth(e){return this.innerLineWidth?this.innerLineWidth:Tn.getInnerLineWidthFromNode(e)}setInnerHighlightColor(e){this._innerHighlightColor=e,this.innerHighlightPath.setStroke(e),this.highlightChangedEmitter.emit()}set innerHighlightColor(e){this.setInnerHighlightColor(e)}get innerHighlightColor(){return this.getInnerHighlightColor()}getInnerHighlightColor(){return this._innerHighlightColor}setOuterHighlightColor(e){this._outerHighlightColor=e,this.setStroke(e),this.highlightChangedEmitter.emit()}set outerHighlightColor(e){this.setOuterHighlightColor(e)}get outerHighlightColor(){return this.getOuterHighlightColor()}getOuterHighlightColor(){return this._outerHighlightColor}getUniqueHighlightTrail(e){assert&&assert(this.transformSourceNode,"getUniqueHighlightTrail requires a transformSourceNode");const t=this.transformSourceNode;let n=null;if(t.instances.length<=1)n=t.getUniqueTrail();else{const r=t.getTrails().filter(s=>s.isExtensionOf(e,!0));assert&&assert(r.length===1,"No unique trail to highlight, either avoid DAG for transformSourceNode or don't use transformSourceNode with HighlightPath"),n=r[0]}return assert&&assert(n,"no unique Trail found for getUniqueHighlightTrail"),n}static getInnerLineWidthFromNode(e){return INNER_LINE_WIDTH_BASE/Tn.getWidthMagnitudeFromTransform(e)}static getOuterLineWidthFromNode(e){return OUTER_LINE_WIDTH_BASE/Tn.getWidthMagnitudeFromTransform(e)}static getWidthMagnitudeFromTransform(e){return e.transform.transformDelta2(Vector2.X_UNIT).magnitude}static getDilationCoefficient(e){return Tn.getOuterLineWidthFromNode(e)*(.5+.25)}static getGroupDilationCoefficient(e){return Tn.getOuterLineWidthFromNode(e)*(.5+1.4)}};Tn.OUTER_FOCUS_COLOR=OUTER_FOCUS_COLOR,Tn.INNER_FOCUS_COLOR=INNER_FOCUS_COLOR,Tn.INNER_LIGHT_GROUP_FOCUS_COLOR=INNER_LIGHT_GROUP_FOCUS_COLOR,Tn.OUTER_LIGHT_GROUP_FOCUS_COLOR=OUTER_LIGHT_GROUP_FOCUS_COLOR,Tn.INNER_DARK_GROUP_FOCUS_COLOR=INNER_DARK_GROUP_FOCUS_COLOR,Tn.OUTER_DARK_GROUP_FOCUS_COLOR=OUTER_DARK_GROUP_FOCUS_COLOR,Tn.GROUP_OUTER_LINE_WIDTH=GROUP_OUTER_LINE_WIDTH,Tn.GROUP_INNER_LINE_WIDTH=GROUP_INNER_LINE_WIDTH;let HighlightPath=Tn;scenery.register("HighlightPath",HighlightPath);const HighlightPath$1=HighlightPath;class GroupHighlightPath extends HighlightPath$1{constructor(e,t){const n=optionize()({outerStroke:HighlightPath$1.OUTER_LIGHT_GROUP_FOCUS_COLOR,innerStroke:HighlightPath$1.INNER_LIGHT_GROUP_FOCUS_COLOR,outerLineWidth:HighlightPath$1.GROUP_OUTER_LINE_WIDTH,innerLineWidth:HighlightPath$1.GROUP_INNER_LINE_WIDTH},t);super(e,n)}}scenery.register("GroupHighlightPath",GroupHighlightPath);class HighlightFromNode extends HighlightPath$1{constructor(e,t){const n=optionize()({useLocalBounds:!0,dilationCoefficient:null,useGroupDilation:!1},t);n.transformSourceNode=e,super(null,n),this.observedBoundsProperty=null,this.boundsListener=null,this.useLocalBounds=n.useLocalBounds,this.useGroupDilation=n.useGroupDilation,this.dilationCoefficient=n.dilationCoefficient,e&&this.setShapeFromNode(e)}setShapeFromNode(e){this.observedBoundsProperty&&(assert&&assert(this.boundsListener,"should be a listener if there is a previous focusHighlightNode"),this.observedBoundsProperty.unlink(this.boundsListener)),this.observedBoundsProperty=e.localBoundsProperty,this.boundsListener=t=>{if(!t.isFinite())return;let n=this.dilationCoefficient;this.dilationCoefficient===null&&(n=this.useGroupDilation?HighlightPath$1.getGroupDilationCoefficient(e):HighlightPath$1.getDilationCoefficient(e));const s=(this.useLocalBounds?e.getVisibleLocalBounds():e.getVisibleBounds()).dilated(n);this.updateLineWidthFromNode(e),this.setShape(Shape$1.bounds(s))},this.observedBoundsProperty.link(this.boundsListener)}updateLineWidthFromNode(e){this.lineWidth=this.getOuterLineWidth(e),this.innerHighlightPath.lineWidth=this.getInnerLineWidth(e)}}scenery.register("HighlightFromNode",HighlightFromNode);const HighlightFromNode$1=HighlightFromNode;class ReadingBlockHighlight extends HighlightFromNode$1{constructor(e,t){const n=optionize()({outerStroke:"grey",innerStroke:"black"},t);super(e,n)}}scenery.register("ReadingBlockHighlight",ReadingBlockHighlight);const READING_BLOCK_OPTION_KEYS=["readingBlockTagName","readingBlockNameResponse","readingBlockHintResponse","readingBlockResponsePatternCollection","readingBlockActiveHighlight"];function assertReadingBlockUtterance(o){o instanceof ReadingBlockUtterance$1||assert&&assert(!1,"utterance is not a ReadinBlockUtterance")}class OwnedReadingBlockUtterance extends ReadingBlockUtterance$1{constructor(e,t){super(e,t)}}const DEFAULT_CONTENT_HINT_PATTERN=new ResponsePatternCollection({nameHint:"{{NAME}}. {{HINT}}"}),ReadingBlock=memoize(o=>{const e=DelayedMutate$1("ReadingBlock",READING_BLOCK_OPTION_KEYS,class extends Voicing(o){constructor(...n){super(...n),this._readingBlockTagName="button",this._readingBlockDisabledTagName="p",this._readingBlockActiveHighlight=null,this.readingBlockActiveHighlightChangedEmitter=new TinyEmitter,this.readingBlockResponsePatternCollection=DEFAULT_CONTENT_HINT_PATTERN,this._localBoundsChangedListener=this._onLocalBoundsChanged.bind(this),this.localBoundsProperty.link(this._localBoundsChangedListener),this._readingBlockInputListener={focus:r=>this._speakReadingBlockContentListener(r),up:r=>this._speakReadingBlockContentListener(r),click:r=>this._speakReadingBlockContentListener(r)},this._readingBlockFocusableChangeListener=this._onReadingBlockFocusableChanged.bind(this),voicingManager$1.speechAllowedAndFullyEnabledProperty.link(this._readingBlockFocusableChangeListener),this.focusHighlight=new ReadingBlockHighlight(this),this.voicingUtterance=new OwnedReadingBlockUtterance(null)}get isReadingBlock(){return!0}setReadingBlockTagName(n){this._readingBlockTagName=n,this._onReadingBlockFocusableChanged(voicingManager$1.speechAllowedAndFullyEnabledProperty.value)}set readingBlockTagName(n){this.setReadingBlockTagName(n)}get readingBlockTagName(){return this.getReadingBlockTagName()}getReadingBlockTagName(){return this._readingBlockTagName}setReadingBlockNameResponse(n){this._voicingResponsePacket.nameResponse=n}set readingBlockNameResponse(n){this.setReadingBlockNameResponse(n)}get readingBlockNameResponse(){return this.getReadingBlockNameResponse()}getReadingBlockNameResponse(){return this._voicingResponsePacket.nameResponse}setReadingBlockHintResponse(n){this._voicingResponsePacket.hintResponse=n}set readingBlockHintResponse(n){this.setReadingBlockHintResponse(n)}get readingBlockHintResponse(){return this.getReadingBlockHintResponse()}getReadingBlockHintResponse(){return this._voicingResponsePacket.hintResponse}setReadingBlockResponsePatternCollection(n){this._voicingResponsePacket.responsePatternCollection=n}set readingBlockResponsePatternCollection(n){this.setReadingBlockResponsePatternCollection(n)}get readingBlockResponsePatternCollection(){return this.getReadingBlockResponsePatternCollection()}getReadingBlockResponsePatternCollection(){return this._voicingResponsePacket.responsePatternCollection}setVoicingUtterance(n){super.setVoicingUtterance(n)}set voicingUtterance(n){super.voicingUtterance=n}get voicingUtterance(){return this.getVoicingUtterance()}getVoicingUtterance(){const n=super.getVoicingUtterance();return assertReadingBlockUtterance(n),n}setVoicingNameResponse(){assert&&assert(!1,"ReadingBlocks only support setting the name response via readingBlockNameResponse")}getVoicingNameResponse(){assert&&assert(!1,"ReadingBlocks only support getting the name response via readingBlockNameResponse")}setVoicingObjectResponse(){assert&&assert(!1,"ReadingBlocks do not support setting object response")}getVoicingObjectResponse(){assert&&assert(!1,"ReadingBlocks do not support setting object response")}setVoicingContextResponse(){assert&&assert(!1,"ReadingBlocks do not support setting context response")}getVoicingContextResponse(){assert&&assert(!1,"ReadingBlocks do not support setting context response")}setVoicingHintResponse(){assert&&assert(!1,"ReadingBlocks only support setting the hint response via readingBlockHintResponse.")}getVoicingHintResponse(){assert&&assert(!1,"ReadingBlocks only support getting the hint response via readingBlockHintResponse.")}setVoicingResponsePatternCollection(){assert&&assert(!1,"ReadingBlocks only support setting the response patterns via readingBlockResponsePatternCollection.")}getVoicingResponsePatternCollection(){assert&&assert(!1,"ReadingBlocks only support getting the response patterns via readingBlockResponsePatternCollection.")}setReadingBlockActiveHighlight(n){this._readingBlockActiveHighlight!==n&&(this._readingBlockActiveHighlight=n,this.readingBlockActiveHighlightChangedEmitter.emit())}set readingBlockActiveHighlight(n){this.setReadingBlockActiveHighlight(n)}get readingBlockActiveHighlight(){return this._readingBlockActiveHighlight}getReadingBlockActiveHighlight(){return this._readingBlockActiveHighlight}isReadingBlockActivated(){let n=!1;const r=Object.keys(this.displays);for(let s=0;s<r.length;s++){const a=this.displays[r[s]].focusManager.readingBlockFocusProperty.value;if(a&&a.trail.lastNode()===this){n=!0;break}}return n}get readingBlockActivated(){return this.isReadingBlockActivated()}_onReadingBlockFocusableChanged(n){this.focusable=n,n?(this.tagName=this._readingBlockTagName,this.hasInputListener(this._readingBlockInputListener)||this.addInputListener(this._readingBlockInputListener)):(this.tagName=this._readingBlockDisabledTagName,this.hasInputListener(this._readingBlockInputListener)&&this.removeInputListener(this._readingBlockInputListener))}_onLocalBoundsChanged(n){this.mouseArea=n,this.touchArea=n}_speakReadingBlockContentListener(n){const r=this.getConnectedDisplays(),s=this.voicingUtterance,a=this.collectResponse({nameResponse:this.getReadingBlockNameResponse(),hintResponse:this.getReadingBlockHintResponse(),ignoreProperties:this.voicingIgnoreVoicingManagerProperties,responsePatternCollection:this._voicingResponsePacket.responsePatternCollection,utterance:s});if(a){for(let l=0;l<r.length;l++)if(!this.getDescendantsUseHighlighting(n.trail)){const d=n.trail.subtrailTo(this),c=PDOMInstance$1.guessVisualTrail(d,r[l].rootNode),y=new Focus(r[l],c);s.readingBlockFocus=y,this.speakContent(a)}}}cleanVoicingUtterance(){this._voicingUtterance instanceof OwnedReadingBlockUtterance&&this._voicingUtterance.dispose(),super.cleanVoicingUtterance()}dispose(){voicingManager$1.speechAllowedAndFullyEnabledProperty.unlink(this._readingBlockFocusableChangeListener),this.localBoundsProperty.unlink(this._localBoundsChangedListener),this.hasInputListener(this._readingBlockInputListener)&&this.removeInputListener(this._readingBlockInputListener),super.dispose()}mutate(n){return super.mutate(n)}});return e.prototype._mutatorKeys=READING_BLOCK_OPTION_KEYS.concat(e.prototype._mutatorKeys),assert&&assert(e.prototype._mutatorKeys.length===_.uniq(e.prototype._mutatorKeys).length,"x mutator keys in ReadingBlock"),e});scenery.register("ReadingBlock",ReadingBlock);const KeyboardZoomUtils={isPlatformMac:()=>_.includes(window.navigator.platform,"Mac"),getPlatformZoomMetaKey:()=>KeyboardZoomUtils.isPlatformMac()?"metaKey":"ctrlKey",isZoomCommand:(o,e)=>{const t=e?KeyboardUtils.KEY_EQUALS:KeyboardUtils.KEY_MINUS,n=KeyboardZoomUtils.getPlatformZoomMetaKey();return o[n]&&KeyboardUtils.isKeyEvent(o,t)},isZoomResetCommand:o=>{const e=KeyboardZoomUtils.getPlatformZoomMetaKey();return o[e]&&KeyboardUtils.isKeyEvent(o,KeyboardUtils.KEY_0)}};scenery.register("KeyboardZoomUtils",KeyboardZoomUtils);const keyboardTestingSchema={INPUT:[...KeyboardUtils.ARROW_KEYS,KeyboardUtils.KEY_PAGE_UP,KeyboardUtils.KEY_PAGE_DOWN,KeyboardUtils.KEY_HOME,KeyboardUtils.KEY_END,KeyboardUtils.KEY_ENTER,KeyboardUtils.KEY_SPACE],DIV:[...KeyboardUtils.ARROW_KEYS,...KeyboardUtils.WASD_KEYS],P:[KeyboardUtils.KEY_ESCAPE],BUTTON:[KeyboardUtils.KEY_ENTER,KeyboardUtils.KEY_SPACE]},ALL_KEYS=KeyboardUtils.ALL_KEYS,MAX_MS_KEY_HOLD_DOWN=100,NEXT_ELEMENT_THRESHOLD=.1,DO_KNOWN_KEYS_THRESHOLD=.6,CLICK_EVENT_THRESHOLD=DO_KNOWN_KEYS_THRESHOLD+.1,KEY_DOWN="keydown",KEY_UP="keyup";class KeyboardFuzzer{constructor(e,t){this.display=e,this.random=new Random({seed:t}),this.numberOfComponentsTested=10,this.keyupListeners=[],this.currentElement=null}chooseNextElement(){if(this.currentElement===null)this.currentElement=document.activeElement;else if(this.random.nextDouble()<NEXT_ELEMENT_THRESHOLD){sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.KeyboardFuzzer("choosing new element"),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.push(),this.clearListeners();const e=PDOMUtils$1.getRandomFocusable(this.random);e.focus(),this.currentElement=e,sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.pop()}}clearListeners(){this.keyupListeners.forEach(e=>{assert&&assert(typeof e.timeout=="function","should have an attached timeout"),stepTimer.clearTimeout(e.timeout),e(),assert&&assert(!this.keyupListeners.includes(e),"calling listener should remove itself from the keyupListeners.")})}triggerClickEvent(){sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.KeyboardFuzzer("triggering click"),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.push();const e=document.activeElement;e instanceof HTMLElement&&e.click(),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.pop()}triggerKeyDownUpEvents(e){sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.KeyboardFuzzer(`trigger keydown/up: ${e}`),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.push(),this.triggerDOMEvent(KEY_DOWN,e);const t=this.random.nextInt(MAX_MS_KEY_HOLD_DOWN),n=()=>{this.triggerDOMEvent(KEY_UP,e),this.keyupListeners.includes(n)&&this.keyupListeners.splice(this.keyupListeners.indexOf(n),1)};n.timeout=stepTimer.setTimeout(n,t===MAX_MS_KEY_HOLD_DOWN?2e3:t),this.keyupListeners.push(n),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.pop()}triggerRandomKeyDownUpEvents(e){const t=ALL_KEYS[Math.floor(this.random.nextDouble()*(ALL_KEYS.length-1))];sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.KeyboardFuzzer(`trigger random keydown/up: ${t}`),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.push(),this.triggerKeyDownUpEvents(t),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.pop()}fuzzBoardEvents(e){if(this.display&&this.display._input&&this.display._input.pdomPointer){const t=this.display._input.pdomPointer;t&&!t.blockTrustedEvents&&(t.blockTrustedEvents=!0)}for(let t=0;t<this.numberOfComponentsTested;t++){this.chooseNextElement();for(let n=0;n<e/this.numberOfComponentsTested;n++){sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.KeyboardFuzzer(`main loop, i=${n}`),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.push();const r=document.activeElement;if(r&&keyboardTestingSchema[r.tagName.toUpperCase()]){const s=this.random.nextDouble();if(s<DO_KNOWN_KEYS_THRESHOLD){const a=keyboardTestingSchema[r.tagName],l=this.random.sample(a);this.triggerKeyDownUpEvents(l)}else s<CLICK_EVENT_THRESHOLD?this.triggerClickEvent():this.triggerRandomKeyDownUpEvents(r)}else r&&this.triggerRandomKeyDownUpEvents(r);sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.pop()}}}triggerDOMEvent(e,t){if(document.activeElement){const n=new KeyboardEvent(e,{bubbles:!0,code:t,shiftKey:globalKeyStateTracker$1.shiftKeyDown,altKey:globalKeyStateTracker$1.altKeyDown,ctrlKey:globalKeyStateTracker$1.ctrlKeyDown});document.activeElement.dispatchEvent(n)}}}scenery.register("KeyboardFuzzer",KeyboardFuzzer);class GroupHighlightFromNode extends HighlightFromNode$1{constructor(e,t){const n=optionize()({outerStroke:HighlightPath$1.OUTER_LIGHT_GROUP_FOCUS_COLOR,innerStroke:HighlightPath$1.INNER_LIGHT_GROUP_FOCUS_COLOR,outerLineWidth:HighlightPath$1.GROUP_OUTER_LINE_WIDTH,innerLineWidth:HighlightPath$1.GROUP_INNER_LINE_WIDTH,useGroupDilation:!0},t);super(e,n)}}scenery.register("GroupHighlightFromNode",GroupHighlightFromNode);const ACTIVATED_HIGHLIGHT_COLOR="rgba(255,255,0,0.5)",Ou=class Ou extends HighlightFromNode$1{constructor(e,t){const n=optionize()({innerStroke:null,outerStroke:null,fill:ACTIVATED_HIGHLIGHT_COLOR},t);super(e,n)}};Ou.ACTIVATED_HIGHLIGHT_COLOR=ACTIVATED_HIGHLIGHT_COLOR;let ActivatedReadingBlockHighlight=Ou;scenery.register("ActivatedReadingBlockHighlight",ActivatedReadingBlockHighlight);const ActivatedReadingBlockHighlight$1=ActivatedReadingBlockHighlight,PRIMARY_SIBLING="PRIMARY_SIBLING",LABEL_SIBLING="LABEL_SIBLING",DESCRIPTION_SIBLING="DESCRIPTION_SIBLING",CONTAINER_PARENT="CONTAINER_PARENT",LABEL_TAG=PDOMUtils$1.TAGS.LABEL,INPUT_TAG=PDOMUtils$1.TAGS.INPUT,DISABLED_ATTRIBUTE_NAME="disabled",OBSERVER_CONFIG={attributes:!1,childList:!0,characterData:!0};let globalId$4=1;const scratchGlobalBounds=new Bounds2(0,0,0,0),scratchSiblingBounds=new Bounds2(0,0,0,0),globalNodeTranslationMatrix=new Matrix3,globalToClientScaleMatrix=new Matrix3,nodeScaleMagnitudeMatrix=new Matrix3;class PDOMPeer{constructor(e,t){this.initializePDOMPeer(e,t)}initializePDOMPeer(e,t){return t=merge({primarySibling:null},t),assert&&assert(!this.id||this.isDisposed,"If we previously existed, we need to have been disposed"),this.id=this.id||globalId$4++,this.pdomInstance=e,this.node=this.pdomInstance.node,this.display=e.display,this.trail=e.trail,this.visible=null,this.focusable=null,this._labelSibling=null,this._descriptionSibling=null,this._containerParent=null,this.topLevelElements=[],this.positionDirty=!1,this.forceReflowWorkaround=!1,this.childPositionDirty=!1,this.positionInPDOM=!1,this.mutationObserver=this.mutationObserver||new MutationObserver(this.invalidateCSSPositioning.bind(this,!1)),this.transformListener=this.transformListener||this.invalidateCSSPositioning.bind(this,!1),this.pdomInstance.transformTracker.addListener(this.transformListener),this._preservedDisabledValue=null,this.isDisposed=!1,this.pdomInstance.isRootInstance&&(this._primarySibling=t.primarySibling,this._primarySibling.classList.add(PDOMSiblingStyle$1.ROOT_CLASS_NAME),PDOMUtils$1.BLOCKED_DOM_EVENTS.forEach(n=>{this._primarySibling.addEventListener(n,r=>{r.stopPropagation()})})),this}update(e){let t=this.node.getBaseOptions();const n=[];this.node.accessibleName!==null&&(t=this.node.accessibleNameBehavior(this.node,t,this.node.accessibleName,n),assert&&assert(typeof t=="object","should return an object")),this.node.pdomHeading!==null&&(t=this.node.pdomHeadingBehavior(this.node,t,this.node.pdomHeading,n),assert&&assert(typeof t=="object","should return an object")),this.node.helpText!==null&&(t=this.node.helpTextBehavior(this.node,t,this.node.helpText,n),assert&&assert(typeof t=="object","should return an object")),this._primarySibling=createElement(t.tagName,this.node.focusable,{namespace:t.pdomNamespace}),t.containerTagName&&(this._containerParent=createElement(t.containerTagName,!1)),t.labelTagName&&(this._labelSibling=createElement(t.labelTagName,!1,{excludeFromInput:this.node.excludeLabelSiblingFromInput})),t.descriptionTagName&&(this._descriptionSibling=createElement(t.descriptionTagName,!1)),e&&this.updateIndicesStringAndElementIds(),this.orderElements(t),this.mutationObserver.disconnect(),this.mutationObserver.observe(this._primarySibling,OBSERVER_CONFIG),t.labelContent&&t.labelTagName!==null&&this.setLabelSiblingContent(t.labelContent),t.innerContent&&t.tagName!==null&&this.setPrimarySiblingContent(t.innerContent),t.descriptionContent&&t.descriptionTagName!==null&&this.setDescriptionSiblingContent(t.descriptionContent),t.tagName.toUpperCase()===INPUT_TAG&&t.inputType&&this.setAttributeToElement("type",t.inputType),t.labelTagName&&t.labelTagName.toUpperCase()===LABEL_TAG&&this.setAttributeToElement("for",this._primarySibling.id,{elementName:PDOMPeer.LABEL_SIBLING}),this.setFocusable(this.node.focusable),this.setPositionInPDOM(this.node.positionInPDOM),this.onAriaLabelledbyAssociationChange(),this.onAriaDescribedbyAssociationChange(),this.onActiveDescendantAssociationChange(),this.onAttributeChange(t),this.onClassChange(),this.onInputValueChange(),this.node.updateOtherNodesAriaLabelledby(),this.node.updateOtherNodesAriaDescribedby(),this.node.updateOtherNodesActiveDescendant(),n.forEach(r=>{assert&&assert(typeof r=="function"),r()})}orderElements(e){this._containerParent?(this._containerParent.insertBefore(this._primarySibling,this._containerParent.children[0]||null),this.topLevelElements=[this._containerParent]):this.topLevelElements=[this._labelSibling,this._descriptionSibling,this._primarySibling].filter(_.identity),this._labelSibling&&this.arrangeContentElement(this._labelSibling,e.appendLabel),this._descriptionSibling&&this.arrangeContentElement(this._descriptionSibling,e.appendDescription)}getPrimarySibling(){return this._primarySibling}get primarySibling(){return this.getPrimarySibling()}getLabelSibling(){return this._labelSibling}get labelSibling(){return this.getLabelSibling()}getDescriptionSibling(){return this._descriptionSibling}get descriptionSibling(){return this.getDescriptionSibling()}getContainerParent(){return this._containerParent}get containerParent(){return this.getContainerParent()}getTopLevelElementContainingPrimarySibling(){return this._containerParent||this._primarySibling}onAriaLabelledbyAssociationChange(){this.removeAttributeFromAllElements("aria-labelledby");for(let e=0;e<this.node.ariaLabelledbyAssociations.length;e++){const t=this.node.ariaLabelledbyAssociations[e];assert&&assert(t.otherNode.nodesThatAreAriaLabelledbyThisNode.indexOf(this.node)>=0,"unexpected otherNode"),this.setAssociationAttribute("aria-labelledby",t)}}onAriaDescribedbyAssociationChange(){this.removeAttributeFromAllElements("aria-describedby");for(let e=0;e<this.node.ariaDescribedbyAssociations.length;e++){const t=this.node.ariaDescribedbyAssociations[e];assert&&assert(t.otherNode.nodesThatAreAriaDescribedbyThisNode.indexOf(this.node)>=0,"unexpected otherNode"),this.setAssociationAttribute("aria-describedby",t)}}onActiveDescendantAssociationChange(){this.removeAttributeFromAllElements("aria-activedescendant");for(let e=0;e<this.node.activeDescendantAssociations.length;e++){const t=this.node.activeDescendantAssociations[e];assert&&assert(t.otherNode.nodesThatAreActiveDescendantToThisNode.indexOf(this.node)>=0,"unexpected otherNode"),this.setAssociationAttribute("aria-activedescendant",t)}}handleAttributeWithPDOMOption(e,t){typeof t=="string"?this.setAttributeToElement(e,t):this.removeAttributeFromElement(e)}onAttributeChange(e){for(let t=0;t<this.node.pdomAttributes.length;t++){const n=this.node.pdomAttributes[t];this.setAttributeToElement(n.attribute,n.value,n.options)}this.handleAttributeWithPDOMOption("aria-label",e.ariaLabel),this.handleAttributeWithPDOMOption("role",e.ariaRole)}onClassChange(){for(let e=0;e<this.node.pdomClasses.length;e++){const t=this.node.pdomClasses[e];this.setClassToElement(t.className,t.options)}}onInputValueChange(){if(assert&&assert(this.node.inputValue!==void 0,"use null to remove input value attribute"),this.node.inputValue===null)this.removeAttributeFromElement("value");else{const e=`${this.node.inputValue}`;this.setAttributeToElement("value",e,{asProperty:!0})}}getElementByName(e){if(e===PDOMPeer.PRIMARY_SIBLING)return this._primarySibling;if(e===PDOMPeer.LABEL_SIBLING)return this._labelSibling;if(e===PDOMPeer.DESCRIPTION_SIBLING)return this._descriptionSibling;if(e===PDOMPeer.CONTAINER_PARENT)return this._containerParent;throw new Error(`invalid elementName name: ${e}`)}setAttributeToElement(e,t,n){n=merge({namespace:null,asProperty:!1,elementName:PRIMARY_SIBLING,element:null},n);const r=n.element||this.getElementByName(n.elementName),s=PDOMUtils$1.unwrapProperty(t);let a=s;typeof s=="string"&&(a=stripEmbeddingMarks(s)),e===DISABLED_ATTRIBUTE_NAME&&!this.display.interactive&&(this._preservedDisabledValue=n.asProperty?a:!0),n.namespace?r.setAttributeNS(n.namespace,e,a):n.asProperty?r[e]=a:r.setAttribute(e,a)}removeAttributeFromElement(e,t){t=merge({namespace:null,elementName:PRIMARY_SIBLING,element:null},t);const n=t.element||this.getElementByName(t.elementName);t.namespace?n.removeAttributeNS(t.namespace,e):e===DISABLED_ATTRIBUTE_NAME&&!this.display.interactive?this._preservedDisabledValue=!1:n.removeAttribute(e)}removeAttributeFromAllElements(e){assert&&assert(e!==DISABLED_ATTRIBUTE_NAME,"this method does not currently support disabled, to make Display.interactive toggling easier to implement"),assert&&assert(typeof e=="string"),this._primarySibling&&this._primarySibling.removeAttribute(e),this._labelSibling&&this._labelSibling.removeAttribute(e),this._descriptionSibling&&this._descriptionSibling.removeAttribute(e),this._containerParent&&this._containerParent.removeAttribute(e)}setClassToElement(e,t){assert&&assert(typeof e=="string"),t=merge({elementName:PRIMARY_SIBLING},t),this.getElementByName(t.elementName).classList.add(e)}removeClassFromElement(e,t){assert&&assert(typeof e=="string"),t=merge({elementName:PRIMARY_SIBLING},t),this.getElementByName(t.elementName).classList.remove(e)}setAssociationAttribute(e,t){assert&&assert(PDOMUtils$1.ASSOCIATION_ATTRIBUTES.indexOf(e)>=0,`unsupported attribute for setting with association object: ${e}`);const n=t.otherNode.getPDOMInstances();if(n.length>0){const r=n[0];r===this.pdomInstance&&(r.peer=this),assert&&assert(r.peer,"peer should exist");const s=r.peer.getElementByName(t.otherElementName),a=this.getElementByName(t.thisElementName);if(a&&s){const l=a.getAttribute(e)||"";assert&&assert(typeof l=="string");const d=[l.trim(),s.id].join(" ").trim();this.setAttributeToElement(e,d,{elementName:t.thisElementName})}}}arrangeContentElement(e,t){if(this.topLevelElements[0]===this._containerParent)assert&&assert(this.topLevelElements.length===1),t?this._containerParent.appendChild(e):this._containerParent.insertBefore(e,this._primarySibling);else{arrayRemove(this.topLevelElements,e);const n=this.topLevelElements.indexOf(this._primarySibling),r=t?this.topLevelElements.length:n;this.topLevelElements.splice(r,0,e)}}isVisible(){if(assert){let e=0;this.topLevelElements.forEach(t=>{!t.hidden&&!t.hasAttribute("hidden")&&(e+=1)}),assert(this.visible?e===this.topLevelElements.length:e===0,"some of the peer's elements are visible and some are not")}return this.visible===null?!0:this.visible}setVisible(e){if(assert&&assert(typeof e=="boolean"),this.visible!==e){this.visible=e;for(let t=0;t<this.topLevelElements.length;t++){const n=this.topLevelElements[t];e?this.removeAttributeFromElement("hidden",{element:n}):this.setAttributeToElement("hidden","",{element:n})}this.invalidateCSSPositioning(platform.safari)}}isFocused(){const e=PDOMInstance$1.guessVisualTrail(this.trail,this.display.rootNode);return FocusManager.pdomFocusProperty.value&&FocusManager.pdomFocusProperty.value.trail.equals(e)}focus(){assert&&assert(this._primarySibling,"must have a primary sibling to focus"),FocusManager.windowHasFocusProperty.value&&this._primarySibling.focus()}blur(){assert&&assert(this._primarySibling,"must have a primary sibling to blur"),this._primarySibling.blur()}setFocusable(e){assert&&assert(typeof e=="boolean");const t=this.isFocused();this.focusable!==e&&(this.focusable=e,PDOMUtils$1.overrideFocusWithTabIndex(this.primarySibling,e),t&&!e&&this.blur(),this.invalidateCSSPositioning())}setLabelSiblingContent(e){assert&&assert(e===null||typeof e=="string","incorrect label content type"),this._labelSibling&&PDOMUtils$1.setTextContent(this._labelSibling,e)}setDescriptionSiblingContent(e){assert&&assert(e===null||typeof e=="string","incorrect description content type"),this._descriptionSibling&&PDOMUtils$1.setTextContent(this._descriptionSibling,e)}setPrimarySiblingContent(e){assert&&assert(e===null||typeof e=="string","incorrect inner content type"),assert&&assert(this.pdomInstance.children.length===0,"descendants exist with accessible content, innerContent cannot be used"),assert&&assert(PDOMUtils$1.tagNameSupportsContent(this._primarySibling.tagName),`tagName: ${this.node.tagName} does not support inner content`),this._primarySibling&&PDOMUtils$1.setTextContent(this._primarySibling,e)}setPDOMTransformSourceNode(e){this.pdomInstance.transformTracker.removeListener(this.transformListener),this.pdomInstance.updateTransformTracker(e),this.pdomInstance.transformTracker.addListener(this.transformListener),this.invalidateCSSPositioning()}setPositionInPDOM(e){this.positionInPDOM=e,this.invalidateCSSPositioning()}getElementId(e,t){return`display${this.display.id}-${e}-${t}`}updateIndicesStringAndElementIds(){const e=this.pdomInstance.getPDOMInstanceUniqueId();this._primarySibling&&(this._primarySibling.setAttribute(PDOMUtils$1.DATA_PDOM_UNIQUE_ID,e),this._primarySibling.id=this.getElementId("primary",e)),this._labelSibling&&(this._labelSibling.setAttribute(PDOMUtils$1.DATA_PDOM_UNIQUE_ID,e),this._labelSibling.id=this.getElementId("label",e)),this._descriptionSibling&&(this._descriptionSibling.setAttribute(PDOMUtils$1.DATA_PDOM_UNIQUE_ID,e),this._descriptionSibling.id=this.getElementId("description",e)),this._containerParent&&(this._containerParent.setAttribute(PDOMUtils$1.DATA_PDOM_UNIQUE_ID,e),this._containerParent.id=this.getElementId("container",e))}invalidateCSSPositioning(e=!1){if(!this.positionDirty){if(this.positionDirty=!0,e){this.forceReflowWorkaround=!0;for(let n=0;n<this.topLevelElements.length;n++)this.topLevelElements[n].style.display="none"}let t=this.pdomInstance.parent;for(;t;)t.peer.childPositionDirty=!0,t=t.parent}}positionElements(e){if(assert&&assert(this._primarySibling,"a primary sibling required to receive CSS positioning"),assert&&assert(this.positionDirty,"elements should only be repositioned if dirty"),e){const t=this.node.pdomTransformSourceNode||this.node;if(scratchGlobalBounds.set(t.localBounds),scratchGlobalBounds.isFinite()){scratchGlobalBounds.transform(this.pdomInstance.transformTracker.getMatrix());const n=this.display.bounds;if(n.intersectsBounds(scratchGlobalBounds)){scratchGlobalBounds.constrainBounds(n);let r=getClientDimensions(this._primarySibling),s=r.width,a=r.height;s>0&&a>0&&(scratchSiblingBounds.setMinMax(0,0,s,a),scratchSiblingBounds.transform(getCSSMatrix(s,a,scratchGlobalBounds)),setClientBounds(this._primarySibling,scratchSiblingBounds)),this.labelSibling&&(r=getClientDimensions(this._labelSibling),s=r.width,a=r.height,a>0&&s>0&&(scratchSiblingBounds.setMinMax(0,0,s,a),scratchSiblingBounds.transform(getCSSMatrix(s,a,scratchGlobalBounds)),setClientBounds(this._labelSibling,scratchSiblingBounds)))}}}else scratchSiblingBounds.set(PDOMPeer.OFFSCREEN_SIBLING_BOUNDS),setClientBounds(this._primarySibling,scratchSiblingBounds),this._labelSibling&&setClientBounds(this._labelSibling,scratchSiblingBounds);this.forceReflowWorkaround&&this.topLevelElements.forEach(t=>{t.style.display="",t.style.offsetHeight}),this.positionDirty=!1,this.forceReflowWorkaround=!1}updateSubtreePositioning(e=!1){this.childPositionDirty=!1;const t=this.positionInPDOM||e;this.positionDirty&&this.positionElements(t);for(let n=0;n<this.pdomInstance.children.length;n++){const r=this.pdomInstance.children[n].peer;(r.positionDirty||r.childPositionDirty)&&this.pdomInstance.children[n].peer.updateSubtreePositioning(t)}}recursiveDisable(e){e?(this._preservedDisabledValue=this._primarySibling.disabled,this._primarySibling.disabled=!0):this._primarySibling.disabled=this._preservedDisabledValue;for(let t=0;t<this.pdomInstance.children.length;t++)this.pdomInstance.children[t].peer.recursiveDisable(e)}dispose(){this.isDisposed=!0,this.blur(),this._primarySibling.removeEventListener("blur",this.blurEventListener),this._primarySibling.removeEventListener("focus",this.focusEventListener),this.pdomInstance.transformTracker.removeListener(this.transformListener),this.mutationObserver.disconnect(),this.pdomInstance=null,this.node=null,this.display=null,this.trail=null,this._primarySibling=null,this._labelSibling=null,this._descriptionSibling=null,this._containerParent=null,this.focusable=null,this.freeToPool()}}PDOMPeer.PRIMARY_SIBLING=PRIMARY_SIBLING;PDOMPeer.LABEL_SIBLING=LABEL_SIBLING;PDOMPeer.DESCRIPTION_SIBLING=DESCRIPTION_SIBLING;PDOMPeer.CONTAINER_PARENT=CONTAINER_PARENT;PDOMPeer.OFFSCREEN_SIBLING_BOUNDS=new Bounds2(0,0,1,1);scenery.register("PDOMPeer",PDOMPeer);Poolable.mixInto(PDOMPeer,{initialize:PDOMPeer.prototype.initializePDOMPeer});function createElement(o,e,t){t=merge({siblingName:null,excludeFromInput:!1},t);const n=PDOMUtils$1.createElement(o,e,t);return t.excludeFromInput&&n.setAttribute(PDOMUtils$1.DATA_EXCLUDE_FROM_INPUT,!0),n}function getCSSMatrix(o,e,t){return globalNodeTranslationMatrix.setToTranslation(t.minX,t.minY),globalToClientScaleMatrix.setToScale(t.width/o,t.height/e),globalNodeTranslationMatrix.multiplyMatrix(globalToClientScaleMatrix).multiplyMatrix(nodeScaleMagnitudeMatrix)}function getClientDimensions(o){let e=o.clientWidth,t=o.clientHeight;if(e===0&&t===0){const n=o.getBoundingClientRect();e=n.width,t=n.height}return{width:e,height:t}}function setClientBounds(o,e){o.style.top=`${e.top}px`,o.style.left=`${e.left}px`,o.style.width=`${e.width}px`,o.style.height=`${e.height}px`}const PDOMPeer$1=PDOMPeer,$o=class $o extends EnumerationValue{};$o.INDICES=new $o,$o.TRAIL_ID=new $o,$o.enumeration=new Enumeration($o);let PDOMUniqueIdStrategy=$o;const UNIQUE_ID_STRATEGY=PDOMUniqueIdStrategy.TRAIL_ID;let globalId$3=1;const Uo=class Uo{constructor(e,t,n){this.relativeNodes=[],this.relativeVisibilities=[],this.relativeListeners=[],this.transformTracker=null,this.initializePDOMInstance(e,t,n)}initializePDOMInstance(e,t,n){if(assert&&assert(!this.id||this.isDisposed,"If we previously existed, we need to have been disposed"),this.id=this.id||globalId$3++,this.parent=e,this.display=t,this.trail=n,this.isRootInstance=e===null,this.node=this.isRootInstance?null:n.lastNode(),this.children=cleanArray(this.children),this.node&&this.node.addPDOMInstance(this),this.invisibleCount=0,this.relativeNodes=[],this.relativeVisibilities=[],this.relativeListeners=[],this.transformTracker=null,this.updateTransformTracker(this.node?this.node.pdomTransformSourceNode:null),this.isDisposed=!1,this.isRootInstance){const r=document.createElement("div");this.peer=PDOMPeer$1.createFromPool(this,{primarySibling:r})}else{this.peer=PDOMPeer$1.createFromPool(this),this.peer.update(UNIQUE_ID_STRATEGY===PDOMUniqueIdStrategy.TRAIL_ID),assert&&assert(this.peer.primarySibling,"accessible peer must have a primarySibling upon completion of construction");const r=this.parent.trail;for(let s=r.length;s<n.length;s++){const a=n.nodes[s];this.relativeNodes.push(a);const l=a._pdomDisplaysInfo.pdomDisplays,d=_.includes(l,t);this.relativeVisibilities.push(d),d||this.invisibleCount++;const c=this.checkAccessibleDisplayVisibility.bind(this,s-r.length);a.pdomDisplaysEmitter.addListener(c),this.relativeListeners.push(c)}this.updateVisibility()}return sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`Initialized ${this.toString()}`),this}addConsecutiveInstances(e){sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`addConsecutiveInstances on ${this.toString()} with: ${e.map(n=>n.toString()).join(",")}`),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.push();const t=this.children.length>0;Array.prototype.push.apply(this.children,e);for(let n=0;n<e.length;n++)assert&&assert(!!this.peer.primarySibling,"Primary sibling must be defined to insert elements."),PDOMUtils$1.insertElements(this.peer.primarySibling,e[n].peer.topLevelElements);t&&this.sortChildren(),assert&&this.node&&(assert&&assert(this.node instanceof Node$2),this.children.length>0&&assert(!this.node.innerContent,`${this.children.length} child PDOMInstances present but this node has innerContent: ${this.node.innerContent}`)),UNIQUE_ID_STRATEGY===PDOMUniqueIdStrategy.INDICES&&this.updateDescendantPeerIds(e),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.pop()}removeInstancesForTrail(e){sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`removeInstancesForTrail on ${this.toString()} with trail ${e.toString()}`),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.push();for(let t=0;t<this.children.length;t++){const n=this.children[t],r=n.trail;let s=r.length<e.length;if(!s){for(let a=this.trail.length;a<e.length;a++)if(e.nodes[a]!==r.nodes[a]){s=!0;break}}s||(this.children.splice(t,1),n.dispose(),t-=1)}sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.pop()}removeAllChildren(){for(sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`removeAllChildren on ${this.toString()}`),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.push();this.children.length;)this.children.pop().dispose();sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.pop()}findChildWithTrail(e){for(let t=0;t<this.children.length;t++){const n=this.children[t];if(n.trail.equals(e))return n}return null}removeSubtree(e){sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`removeSubtree on ${this.toString()} with trail ${e.toString()}`),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.push();for(let t=this.children.length-1;t>=0;t--){const n=this.children[t];n.trail.isExtensionOf(e,!0)&&(sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`Remove parent: ${this.toString()}, child: ${n.toString()}`),this.children.splice(t,1),n.dispose())}sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.pop()}checkAccessibleDisplayVisibility(e){const t=_.includes(this.relativeNodes[e]._pdomDisplaysInfo.pdomDisplays,this.display),n=this.relativeVisibilities[e];if(t!==n){this.relativeVisibilities[e]=t;const r=this.invisibleCount===0;this.invisibleCount+=t?-1:1,assert&&assert(this.invisibleCount>=0&&this.invisibleCount<=this.relativeNodes.length),this.invisibleCount===0!==r&&this.updateVisibility()}}updateVisibility(){assert&&assert(!!this.peer,"Peer needs to be available on update visibility."),this.peer.setVisible(this.invisibleCount<=0),!this.peer.isVisible()&&FocusManager.pdomFocusedNode&&(assert&&assert(FocusManager.pdomFocusedNode.pdomInstances.length===1,"focusable Nodes do not support DAG, and should be connected with an instance if focused."),FocusManager.pdomFocusedNode.pdomInstances[0].trail.containsNode(this.node)&&(FocusManager.pdomFocus=null))}isGloballyVisible(){return assert&&assert(!!this.peer,"PDOMPeer needs to be available, has this PDOMInstance been disposed?"),this.peer.isVisible()?this.parent?this.parent.isGloballyVisible():!0:!1}getChildOrdering(e){const t=e.lastNode(),n=t.getEffectiveChildren();let r;const s=[];if(t.hasPDOMContent&&t!==this.node){const a=t.pdomInstances;e:for(r=0;r<a.length;r++){const l=a[r];if(l.parent===this){for(let d=0;d<e.length;d++)if(e.nodes[d]!==l.trail.nodes[d+l.trail.length-e.length])continue e;s.push(l)}}assert&&assert(s.length<=1,"If we select more than one this way, we have problems")}else for(r=0;r<n.length;r++)e.addDescendant(n[r],r),Array.prototype.push.apply(s,this.getChildOrdering(e)),e.removeDescendant();return s}sortChildren(){var l,d;assert&&assert(this.peer!==null,"peer required for sort");let e;this.isRootInstance?(assert&&assert(this.display!==null,"Display should be available for the root"),e=this.display.rootNode):(assert&&assert(this.node!==null,"Node should be defined, were we disposed?"),e=this.node);const t=this.getChildOrdering(new Trail(e));assert&&assert(t.length===this.children.length,"sorting should not change number of children"),this.children=t;const n=this.peer.primarySibling,r=((d=(l=FocusManager.pdomFocusedNode)==null?void 0:l.pdomInstances[0])==null?void 0:d.trail)||null;let s=n.childNodes.length-1;const a=r&&_.find(this.children,c=>r.containsNode(c.peer.node));if(a){const c=_.flatten(this.children.map(m=>m.peer.topLevelElements));if(!_.every(c,(m,O)=>n.children[O]===m)){const m=a.peer.getTopLevelElementContainingPrimarySibling(),O=c.indexOf(m);assert&&assert(O>=0);for(let D=0;D<O;D++)n.insertBefore(c[D],m);for(let D=O+1;D<c.length;D++)n.appendChild(c[D])}}else for(let c=this.children.length-1;c>=0;c--){const y=this.children[c].peer;for(let m=y.topLevelElements.length-1;m>=0;m--){const O=y.topLevelElements[m];n.childNodes[s]!==O&&n.insertBefore(O,n.childNodes[s+1]),s--}}if(assert){const c=_.flatten(this.children.map(y=>y.peer.topLevelElements));assert(_.every(c,(y,m)=>n.children[m]===y))}UNIQUE_ID_STRATEGY===PDOMUniqueIdStrategy.INDICES&&this.updateDescendantPeerIds(this.children)}updateTransformTracker(e){this.transformTracker&&this.transformTracker.dispose();let t=null;e?t=e.getUniqueTrail():t=Uo.guessVisualTrail(this.trail,this.display.rootNode),this.transformTracker=new TransformTracker$1(t)}getPDOMInstanceUniqueId(){if(UNIQUE_ID_STRATEGY===PDOMUniqueIdStrategy.INDICES){const e=[];let t=this;for(;t.parent;){const n=t.parent.children.indexOf(t);if(n===-1)return"STILL_BEING_CREATED"+dotRandom.nextDouble();e.unshift(n),t=t.parent}return e.join(PDOMUtils$1.PDOM_UNIQUE_ID_SEPARATOR)}else return assert&&assert(UNIQUE_ID_STRATEGY===PDOMUniqueIdStrategy.TRAIL_ID),this.trail.getUniqueId()}updateDescendantPeerIds(e){assert&&assert(UNIQUE_ID_STRATEGY===PDOMUniqueIdStrategy.INDICES,"method should not be used with uniqueId comes from TRAIL_ID");const t=Array.from(e);for(;t.length>0;){const n=t.shift();n.peer.updateIndicesStringAndElementIds(),t.push(...n.children)}}static uniqueIdToTrail(e,t){return UNIQUE_ID_STRATEGY===PDOMUniqueIdStrategy.INDICES?e.getTrailFromPDOMIndicesString(t):(assert&&assert(UNIQUE_ID_STRATEGY===PDOMUniqueIdStrategy.TRAIL_ID),Trail.fromUniqueId(e.rootNode,t))}dispose(){sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`Disposing ${this.toString()}`),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.push(),assert&&assert(!!this.peer,"PDOMPeer required, were we already disposed?");const e=this.peer;if(!this.isRootInstance){PDOMUtils$1.removeElements(this.parent.peer.primarySibling,e.topLevelElements);for(let t=0;t<this.relativeNodes.length;t++)this.relativeNodes[t].pdomDisplaysEmitter.removeListener(this.relativeListeners[t])}for(;this.children.length;)this.children.pop().dispose();e.dispose(),this.transformTracker.dispose(),this.transformTracker=null,this.node&&this.node.removePDOMInstance(this),this.relativeNodes=null,this.display=null,this.trail=null,this.node=null,this.peer=null,this.isDisposed=!0,this.freeToPool(),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.pop()}toString(){return`${this.id}#{${this.trail.toString()}}`}auditRoot(){if(!assert)return;const e=this.display.rootNode;assert(this.trail.length===0,"Should only call auditRoot() on the root PDOMInstance for a display");function t(n,r){assert&&assert(n.children.length===r.children.length,"Different number of children in accessible instance"),assert&&assert(n.node===r.node,"Node mismatch for PDOMInstance");for(let l=0;l<r.children.length;l++)t(n.children[l],r.children[l]);const s=r.isGloballyVisible();let a=!0;for(let l=0;l<r.trail.length;l++)if(r.trail.nodes[l].getTrailsTo(e).filter(y=>y.isPDOMVisible()).length===0){a=!1;break}assert&&assert(s===a,"Instance visibility mismatch")}t(Uo.createFakePDOMTree(e),this)}static guessVisualTrail(e,t){e.reindex();const n=e.indices.lastIndexOf(-1);if(n<0)return e;const r=n+1,a=e.nodes[r].getTrailsTo(t);if(a.length===0)return e;const l=a[0];for(let d=r+1;d<e.length;d++)l.addDescendant(e.nodes[d]);return assert&&assert(l.isValid(),`trail not valid: ${e.uniqueId}`),l}static createFakePDOMTree(e){function t(n){let r=_.flatten(n.getEffectiveChildren().map(t));return n.hasPDOMContent&&(r=[{node:n,children:r}]),r}return{node:null,children:t(e)}}freeToPool(){Uo.pool.freeToPool(this)}};Uo.pool=new Pool(Uo,{initialize:Uo.prototype.initializePDOMInstance});let PDOMInstance=Uo;scenery.register("PDOMInstance",PDOMInstance);const PDOMInstance$1=PDOMInstance,PDOMTree={addChild(o,e){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`addChild parent:n#${o._id}, child:n#${e._id}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),assert&&assert(o instanceof Node$2),assert&&assert(e instanceof Node$2),assert&&assert(!e._rendererSummary.hasNoPDOM());const t=PDOMTree.beforeOp();e._pdomParent||PDOMTree.addTree(o,e),PDOMTree.afterOp(t),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},removeChild(o,e){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`removeChild parent:n#${o._id}, child:n#${e._id}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),assert&&assert(o instanceof Node$2),assert&&assert(e instanceof Node$2),assert&&assert(!e._rendererSummary.hasNoPDOM());const t=PDOMTree.beforeOp();e._pdomParent||PDOMTree.removeTree(o,e),PDOMTree.afterOp(t),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},childrenOrderChange(o){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`childrenOrderChange node:n#${o._id}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),assert&&assert(o instanceof Node$2),assert&&assert(!o._rendererSummary.hasNoPDOM());const e=PDOMTree.beforeOp();PDOMTree.reorder(o),PDOMTree.afterOp(e),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},pdomOrderChange(o,e,t){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`pdomOrderChange n#${o._id}: ${PDOMTree.debugOrder(e)},${PDOMTree.debugOrder(t)}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),assert&&assert(o instanceof Node$2);const n=PDOMTree.beforeOp(),r=[],s=[];arrayDifference(e||[],t||[],r,s),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`removed: ${PDOMTree.debugOrder(r)}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`added: ${PDOMTree.debugOrder(s)}`);let a,l;if(assert){for(a=0;a<r;a++)assert(r[a]===null||r[a]._pdomParent===o,"Node should have had a pdomOrder");for(a=0;a<s;a++)assert(s[a]===null||s[a]._pdomParent===null,"Node is already specified in a pdomOrder")}const d=PDOMTree.findPDOMTrails(o);for(a=0;a<r.length;a++){const c=r[a];c&&(PDOMTree.removeTree(o,c,d),c._pdomParent=null)}for(a=0;a<s.length;a++){const c=s[a];if(c){const y=c._parents;for(l=0;l<y.length;l++)PDOMTree.removeTree(y[l],c);c._pdomParent=o}}for(a=0;a<r.length;a++){const c=r[a];if(c){const y=c._parents;for(l=0;l<y.length;l++)PDOMTree.addTree(y[l],c)}}for(a=0;a<s.length;a++){const c=s[a];c&&PDOMTree.addTree(o,c,d)}PDOMTree.reorder(o,d),PDOMTree.afterOp(n),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},pdomContentChange(o){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`pdomContentChange n#${o._id}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),assert&&assert(o instanceof Node$2);const e=PDOMTree.beforeOp();let t;const n=o._pdomParent?[o._pdomParent]:o._parents,r=[];for(t=0;t<n.length;t++){const s=n[t],a=PDOMTree.findPDOMTrails(s);r.push(a),PDOMTree.removeTree(s,o,a)}for(t=0;t<n.length;t++)PDOMTree.addTree(n[t],o,r[t]);for(t=0;t<o._rootedDisplays.length;t++){const s=o._rootedDisplays[t];s._accessible&&PDOMTree.rebuildInstanceTree(s._rootPDOMInstance)}PDOMTree.afterOp(e),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},rebuildInstanceTree(o){const e=o.display.rootNode;assert&&assert(e),o.removeAllChildren(),o.addConsecutiveInstances(PDOMTree.createTree(new Trail(e),o.display,o))},addTree(o,e,t){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`addTree parent:n#${o._id}, child:n#${e._id}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),assert&&PDOMTree.auditNodeForPDOMCycles(o),t=t||PDOMTree.findPDOMTrails(o);for(let n=0;n<t.length;n++){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`trail: ${t[n].trail.toString()} full:${t[n].fullTrail.toString()} for ${t[n].pdomInstance.toString()} root:${t[n].isRoot}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push();const r=t[n],s=r.pdomInstance;r.fullTrail.addDescendant(e);const a=PDOMTree.createTree(r.fullTrail,s.display,s);r.fullTrail.removeDescendant(e),s.addConsecutiveInstances(a),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()}sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},removeTree(o,e,t){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`removeTree parent:n#${o._id}, child:n#${e._id}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),t=t||PDOMTree.findPDOMTrails(o);for(let n=0;n<t.length;n++){const r=t[n];r.fullTrail.addDescendant(e),r.pdomInstance.removeInstancesForTrail(r.fullTrail),r.fullTrail.removeDescendant(e)}sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},reorder(o,e){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`reorder n#${o._id}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),e=e||PDOMTree.findPDOMTrails(o);for(let t=0;t<e.length;t++)e[t].pdomInstance.sortChildren();sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},createTree(o,e,t){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`createTree ${o.toString()} parent:${t?t.toString():"null"}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push();const n=o.lastNode(),r=n.getEffectiveChildren();sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`effectiveChildren: ${PDOMTree.debugOrder(r)}`);let s,a=!1;n.hasPDOMContent&&(s=t.findChildWithTrail(o),s?a=!0:s=PDOMInstance$1.pool.create(t,e,o.copy()),t=s);const l=[];for(let d=0;d<r.length;d++)o.addDescendant(r[d],d),Array.prototype.push.apply(l,PDOMTree.createTree(o,e,t)),o.removeDescendant();return s?(s.addConsecutiveInstances(l),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop(),a?[]:[s]):(sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop(),l)},beforeOp(){return BrowserEvents$1.blockFocusCallbacks=!0,FocusManager.pdomFocusedNode},afterOp(o){o&&o.focusable&&o.focus(),BrowserEvents$1.blockFocusCallbacks=!1},findPDOMTrails(o){const e=[];return PDOMTree.recursivePDOMTrailSearch(e,new Trail(o)),e},recursivePDOMTrailSearch(o,e){const t=e.rootNode();let n;if(t.hasPDOMContent){const a=t.pdomInstances;for(n=0;n<a.length;n++)o.push(new PartialPDOMTrail(a[n],e.copy(),!1));return}else{const a=t.rootedDisplays;for(n=0;n<a.length;n++){const l=a[n];l._accessible&&o.push(new PartialPDOMTrail(l._rootPDOMInstance,e.copy(),!0))}}const r=t._pdomParent?[t._pdomParent]:t._parents,s=r.length;for(n=0;n<s;n++){const a=r[n];e.addAncestor(a),PDOMTree.recursivePDOMTrailSearch(o,e),e.removeAncestor()}},auditPDOMDisplays(o){if(assertSlow)if(o._pdomDisplaysInfo.canHavePDOMDisplays()){let e;const t=[];for(e=0;e<o._parents.length;e++)Array.prototype.push.apply(t,o._parents[e]._pdomDisplaysInfo.pdomDisplays);for(e=0;e<o._rootedDisplays.length;e++){const s=o._rootedDisplays[e];s._accessible&&t.push(s)}const n=o._pdomDisplaysInfo.pdomDisplays.slice(),r=t.slice();for(assertSlow(n.length===r.length),e=0;e<r.length;e++)for(let s=0;s<n.length;s++)if(r[e]===n[s]){r.splice(e,1),n.splice(s,1),e--;break}assertSlow(n.length===0&&r.length===0,"Mismatch with accessible pdom displays")}else assertSlow(o._pdomDisplaysInfo.pdomDisplays.length===0,"Invisible/nonaccessible things should have no displays")},auditNodeForPDOMCycles(o){if(assert){const e=new Trail(o);(function t(){const n=e.rootNode();assert(e.length<=1||n!==o,`Accessible PDOM graph cycle detected. The combined scene-graph DAG with pdomOrder defining additional parent-child relationships should still be a DAG. Cycle detected with the trail: ${e.toString()} path: ${e.toPathString()}`);const r=n._parents.length;for(let s=0;s<r;s++){const a=n._parents[s];e.addAncestor(a),t(),e.removeAncestor()}n._pdomParent&&!n._pdomParent.hasChild(n)&&(e.addAncestor(n._pdomParent),t(),e.removeAncestor())})()}},debugOrder(o){return o===null?"null":`[${o.map(e=>e===null?"null":e._id).join(",")}]`}};scenery.register("PDOMTree",PDOMTree);const PDOMTree$1=PDOMTree;class PDOMFuzzer{constructor(e,t,n){assert&&assert(e>=2),n=n||null,this.nodeCount=e,this.logToConsole=t,this.nodes=_.range(0,e).map(()=>new Node$2),this.display=new Display(this.nodes[0]),this.random=new Random({seed:n}),this.actionsTaken=[]}step(){const e=this.random.sample(this.enumerateActions());if(this.logToConsole&&console.log(e.text),this.actionsTaken.push(e),e.execute(),this.display._rootPDOMInstance.auditRoot(),PDOMTree$1.auditPDOMDisplays(this.display.rootNode),this.logToConsole)for(let t=0;t<this.nodes.length;t++){const n=this.nodes[t];console.log(`${t}#${n.id} ${n.tagName} ch:${PDOMTree$1.debugOrder(n.children)} or:${PDOMTree$1.debugOrder(n.pdomOrder)} vis:${n.visible} avis:${n.pdomVisible}`)}}enumerateActions(){const e=[];return this.nodes.forEach(t=>{e.push({text:`#${t.id}.visible = ${!t.visible}`,execute:()=>{t.visible=!t.visible}}),e.push({text:`#${t.id}.pdomVisible = ${!t.pdomVisible}`,execute:()=>{t.pdomVisible=!t.pdomVisible}}),["span","div",null].forEach(n=>{t.tagName!==n&&e.push({text:`#${t.id}.tagName = ${n}`,execute:()=>{t.tagName=n}})}),this.powerSet(arrayDifference(this.nodes,[t]).concat([null])).forEach(n=>{Permutation.forEachPermutation(n,r=>{this.isPDOMOrderChangeLegal(t,r)&&e.push({text:`#${t.id}.pdomOrder = ${PDOMTree$1.debugOrder(r)}`,execute:()=>{t.pdomOrder=r}})})}),this.nodes.forEach(n=>{this.isAddChildLegal(t,n)&&_.range(0,t.children.length+1).forEach(r=>{e.push({text:`#${t.id}.insertChild(${r},#${n.id})`,execute:()=>{t.insertChild(r,n)}})}),t.hasChild(n)&&e.push({text:`#${t.id}.removeChild(#${n.id})`,execute:()=>{t.removeChild(n)}})})}),e}isAddChildLegal(e,t){return!e.hasChild(t)&&this.isAcyclic(e,t)}powerSet(e){if(e.length===0)return[[]];{const t=this.powerSet(e.slice(1));return t.concat(t.map(n=>[e[0]].concat(n)))}}isPDOMOrderChangeLegal(e,t){if(t===null&&(t=[]),t=t.filter(s=>s!==null),_.includes(t,e)||_.uniq(t).length<t.length)return!1;for(let s=0;s<t.length;s++)if(t[s]._pdomParent&&t[s]._pdomParent!==e)return!1;const n=(s,a)=>s===e?s.hasChild(a)||_.includes(t,a):s.hasChild(a)||!!s.pdomOrder&&_.includes(s.pdomOrder,a),r=e.children.concat(t);return _.every(r,s=>this.isAcyclic(e,s,n))}isAcyclic(e,t,n){if(e===t)return!1;const r=t.children.concat(t.pdomOrder).filter(s=>s!==null);for(;r.length;){const s=r.pop();if(s===e)return!1;n?this.nodes.forEach(a=>{n(s,a)&&r.push(a)}):(Array.prototype.push.apply(r,s.children),s.pdomOrder&&Array.prototype.push.apply(r,s.pdomOrder.filter(a=>a!==null)))}return!0}dispose(){this.display.dispose()}}scenery.register("PDOMFuzzer",PDOMFuzzer);const Go=class Go extends EnumerationValue{};Go.DRAG=new Go,Go.KEYBOARD_DRAG=new Go,Go.enumeration=new Enumeration(Go,{phetioDocumentation:"entries when signifying Intent of the pointer"});let Intent=Go;const Bl=class Bl{constructor(e,t){assert&&assert(e===null||e instanceof Vector2),assert&&assert(Object.getPrototypeOf(this)!==Bl.prototype,"Pointer is an abstract class"),this.point=e,this.type=t,this.trail=null,this.inputEnabledTrail=null,this.isDownProperty=new BooleanProperty(!1),this.attachedProperty=new BooleanProperty(!1),this._listeners=[],this._attachedListener=null,this._cursor=null,this.lastEventContext=null,this._intents=[],this._pointerCaptured=!1,this._listenerForDragReserve=null,this._listenerForKeyboardDragReserve=null}setCursor(e){return this._cursor=e,this}set cursor(e){this.setCursor(e)}get cursor(){return this.getCursor()}getCursor(){return this._cursor}getListeners(){return this._listeners.slice()}get listeners(){return this.getListeners()}addInputListener(e,t){sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`addInputListener to ${this.toString()} attach:${t}`),sceneryLog&&sceneryLog.Pointer&&sceneryLog.push(),assert&&assert(e,"A listener must be provided"),assert&&assert(t===void 0||typeof t=="boolean","If provided, the attach parameter should be a boolean value"),assert&&assert(!_.includes(this._listeners,e),"Attempted to add an input listener that was already added"),this._listeners.push(e),t&&(assert&&assert(e.interrupt,"Interrupt should exist on attached listeners"),this.attach(e)),sceneryLog&&sceneryLog.Pointer&&sceneryLog.pop()}removeInputListener(e){sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`removeInputListener to ${this.toString()}`),sceneryLog&&sceneryLog.Pointer&&sceneryLog.push(),assert&&assert(e,"A listener must be provided");const t=_.indexOf(this._listeners,e);assert&&assert(t!==-1,"Could not find the input listener to remove"),this.isAttached()&&e===this._attachedListener&&this.detach(e),this._listeners.splice(t,1),sceneryLog&&sceneryLog.Pointer&&sceneryLog.pop()}getAttachedListener(){return this._attachedListener}get attachedListener(){return this.getAttachedListener()}isAttached(){return this.attachedProperty.value}isTouchLike(){return!1}set isDown(e){this.isDownProperty.value=e}get isDown(){return this.isDownProperty.value}interruptAttached(){this.isAttached()&&this._attachedListener.interrupt()}interruptAll(){const e=this._listeners.slice();for(let t=0;t<e.length;t++){const n=e[t];n.interrupt&&n.interrupt()}}attach(e){sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`Attaching to ${this.toString()}`),assert&&assert(!this.isAttached(),"Attempted to attach to an already attached pointer"),this.attachedProperty.value=!0,this._attachedListener=e}updatePoint(e,t="event"){const n=this.hasPointChanged(e);return e&&sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`pointer ${t} at ${e.toString()}`),this.point=e,n}down(e){this.isDown=!0}up(e,t){return this.isDown=!1,this.updatePoint(e,"up")}cancel(e){return this.isDown=!1,this.updatePoint(e,"cancel")}detach(e){sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`Detaching from ${this.toString()}`),assert&&assert(this.isAttached(),"Cannot detach a listener if one is not attached"),assert&&assert(this._attachedListener===e,"Cannot detach a different listener"),this.attachedProperty.value=!1,this._attachedListener=null}hasPointChanged(e){return this.point!==e&&(!e||!this.point||!this.point.equals(e))}addIntent(e){assert&&assert(Intent.enumeration.includes(e),"trying to set unsupported intent for Pointer"),this._intents.includes(e)||this._intents.push(e),assert&&assert(this._intents.length<=Intent.enumeration.values.length,"to many Intents saved, memory leak likely")}removeIntent(e){if(assert&&assert(Intent.enumeration.includes(e),"trying to set unsupported intent for Pointer"),this._intents.includes(e)){const t=this._intents.indexOf(e);this._intents.splice(t,1)}}hasIntent(e){return this._intents.includes(e)}reserveForDrag(){if(!this._intents.includes(Intent.DRAG)){this.addIntent(Intent.DRAG);const e={up:t=>{this.removeIntent(Intent.DRAG),this.removeInputListener(this._listenerForDragReserve),this._listenerForDragReserve=null}};assert&&assert(this._listenerForDragReserve===null,"still a listener to reserve pointer, memory leak likely"),this._listenerForDragReserve=e,this.addInputListener(this._listenerForDragReserve)}}reserveForKeyboardDrag(){if(!this._intents.includes(Intent.KEYBOARD_DRAG)){this.addIntent(Intent.KEYBOARD_DRAG);const e={keyup:n=>t(),blur:n=>t()},t=()=>{this.removeIntent(Intent.KEYBOARD_DRAG),this.removeInputListener(this._listenerForKeyboardDragReserve),this._listenerForKeyboardDragReserve=null};assert&&assert(this._listenerForDragReserve===null,"still a listener on Pointer for reserve, memory leak likely"),this._listenerForKeyboardDragReserve=e,this.addInputListener(this._listenerForKeyboardDragReserve)}}onGotPointerCapture(){this._pointerCaptured=!0}onLostPointerCapture(){this._pointerCaptured&&this.interruptAll(),this._pointerCaptured=!1}dispose(){sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`Disposing ${this.toString()}`),this._listenerForDragReserve&&this._listeners.includes(this._listenerForDragReserve)&&this.removeInputListener(this._listenerForDragReserve),this._listenerForKeyboardDragReserve&&this._listeners.includes(this._listenerForKeyboardDragReserve)&&this.removeInputListener(this._listenerForKeyboardDragReserve),assert&&assert(this._attachedListener===null,"Attached listeners should be cleared before pointer disposal"),assert&&assert(this._listeners.length===0,"Should not have listeners when a pointer is disposed")}toString(){return`Pointer#${this.type}_at_${this.point}`}};Bl.PointerIO=new IOType("PointerIO",{valueType:Bl,toStateObject:e=>({point:e.point.toStateObject(),type:e.type}),stateSchema:{point:Vector2.Vector2IO,type:StringIO}});let Pointer=Bl;scenery.register("Pointer",Pointer);class Mouse extends Pointer{constructor(e){super(e,"mouse"),this.id=null,this.leftDown=!1,this.middleDown=!1,this.rightDown=!1,this.wheelDelta=new Vector3(0,0,0),this.wheelDeltaMode=0,sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`Created ${this.toString()}`)}down(e){switch(assert&&assert(e instanceof MouseEvent),e.button){case 0:this.leftDown=!0;break;case 1:this.middleDown=!0;break;case 2:this.rightDown=!0;break}return super.down(e)}up(e,t){switch(assert&&assert(t instanceof MouseEvent),t.button){case 0:this.leftDown=!1;break;case 1:this.middleDown=!1;break;case 2:this.rightDown=!1;break}return super.up(e,t)}move(e){const t=this.hasPointChanged(e);return e&&sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`mouse move at ${e.toString()}`),this.point=e,t}over(e){const t=this.hasPointChanged(e);return e&&sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`mouse over at ${e.toString()}`),this.point=e,t}out(e){const t=this.hasPointChanged(e);return e&&sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`mouse out at ${e.toString()}`),t}wheel(e){assert&&assert(e instanceof WheelEvent);const t=e;this.wheelDelta.setXYZ(t.deltaX,t.deltaY,t.deltaZ),this.wheelDeltaMode=t.deltaMode}toString(){return"Mouse"}}scenery.register("Mouse",Mouse);class Touch extends Pointer{constructor(e,t,n){super(t,"touch"),this.id=e,sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`Created ${this.toString()}`)}move(e){const t=this.hasPointChanged(e);return this.point=e,t}toString(){return`Touch#${this.id}`}isTouchLike(){return!0}}scenery.register("Touch",Touch);class Pen extends Pointer{constructor(e,t,n){super(t,"pen"),this.id=e,sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`Created ${this.toString()}`)}move(e){const t=this.hasPointChanged(e);return this.point=e,t}toString(){return`Pen#${this.id}`}isTouchLike(){return!0}}scenery.register("Pen",Pen);class PDOMPointer extends Pointer{constructor(e){super(Vector2.ZERO,"pdom"),this.display=e,this.initializeListeners(),this.blockTrustedEvents=!1,this.keydownTargetNode=null,sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`Created ${this.toString()}`)}initializeListeners(){this.addInputListener({focus:e=>{assert&&assert(this.trail,"trail should have been calculated for the focused node");const t=this.trail.lastNode();if(t.focusable){const n=PDOMInstance$1.guessVisualTrail(this.trail,this.display.rootNode);this.point=n.parentToGlobalPoint(t.center),isNaN(this.point.x)&&this.point.setXY(0,0)}},blur:e=>{this.trail=null,this.keydownTargetNode=null},keydown:e=>{this.blockTrustedEvents&&e.domEvent.isTrusted||(this.keydownTargetNode=e.target)},keyup:e=>{this.blockTrustedEvents&&e.domEvent.isTrusted||this.keydownTargetNode!==e.target&&e.abort()}})}updateTrail(e){return this.trail&&this.trail.equals(e)||(this.trail=e),this.trail}}scenery.register("PDOMPointer",PDOMPointer);class EventContext{constructor(e){this.domEvent=e,this.activeElement=document.activeElement}static createSynthetic(){return new EventContext(new window.Event("synthetic"))}}const EventContextIO=new IOType("EventContextIO",{valueType:EventContext,documentation:"A DOM event and its context",toStateObject:o=>({domEvent:Input.serializeDomEvent(o.domEvent)}),fromStateObject:o=>new EventContext(Input.deserializeDomEvent(o.domEvent)),stateSchema:()=>({domEvent:EventIO})});scenery.register("EventContext",EventContext);const kh=class kh{constructor(e,t,n,r){this.handled=!1,this.aborted=!1,this.trail=e,this.type=t,this.pointer=n,this.context=r,this.domEvent=r.domEvent,this.activeElement=r.activeElement,this.currentTarget=null,this.target=e.lastNode(),this.isPrimary=!(n instanceof Mouse)||!this.domEvent||this.domEvent.button===0,n.lastEventContext=r}handle(){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent("handled event"),this.handled=!0}abort(){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent("aborted event"),this.aborted=!0}isFromPDOM(){return this.pointer instanceof PDOMPointer}canStartPress(){return!this.pointer.isAttached()&&(!(this.pointer instanceof Mouse)||this.domEvent.button===0)}};kh.SceneryEventIO=new IOType("SceneryEventIO",{valueType:kh,documentation:'An event, with a "point" field',toStateObject:e=>({type:e.type,domEventType:NullableIO(EventIO).toStateObject(e.domEvent),point:e.pointer&&e.pointer.point?Vector2.Vector2IO.toStateObject(e.pointer.point):null}),stateSchema:{type:StringIO,domEventType:NullableIO(EventIO),point:NullableIO(Vector2.Vector2IO)}});let SceneryEvent=kh;scenery.register("SceneryEvent",SceneryEvent);const ArrayIOPointerIO=ArrayIO(Pointer.PointerIO),domEventPropertiesToSerialize=["altKey","button","charCode","clientX","clientY","code","ctrlKey","deltaMode","deltaX","deltaY","deltaZ","key","keyCode","metaKey","pageX","pageY","pointerId","pointerType","scale","shiftKey","target","type","relatedTarget","which"],domEventPropertiesSetInConstructor=["deltaMode","deltaX","deltaY","deltaZ","altKey","button","charCode","clientX","clientY","code","ctrlKey","key","keyCode","metaKey","pageX","pageY","pointerId","pointerType","shiftKey","type","relatedTarget","which"],EVENT_KEY_VALUES_AS_ELEMENTS=["target","relatedTarget"],PDOM_UNPICKABLE_EVENTS=["focus","blur","focusin","focusout"],TARGET_SUBSTITUTE_KEY="targetSubstitute",PDOM_CLICK_DELAY=80,ds=class ds extends PhetioObject{constructor(e,t,n,r,s,a){var d,c,y,m,O,D,z,w,N,H,X,ae,oe,ue,fe,be,Ae,W,J,Ue,gt,Te,Et,Bt;const l=optionize()({phetioType:ds.InputIO,phetioDocumentation:"Central point for user input events, such as mouse, touch"},a);super(l),this.currentSceneryEvent=null,this.display=e,this.rootNode=e.rootNode,this.attachToWindow=t,this.batchDOMEvents=n,this.assumeFullWindow=r,this.passiveEvents=s,this.batchedEvents=[],this.pdomPointer=null,this.mouse=null,this.pointers=[],this.pointerAddedEmitter=new TinyEmitter,this.currentlyFiringEvents=!1,this.upTimeStamp=0,this.validatePointersAction=new PhetioAction$1(()=>{let Ke=this.pointers.length;for(;Ke--;){const At=this.pointers[Ke];At.point&&At!==this.pdomPointer&&this.branchChangeEvents(At,At.lastEventContext||EventContext.createSynthetic(),!1)}},{phetioPlayback:!0,tandem:(d=l.tandem)==null?void 0:d.createTandem("validatePointersAction"),phetioHighFrequency:!0}),this.mouseUpAction=new PhetioAction$1((Ke,At)=>{const nt=this.ensureMouse(Ke);nt.id=null,this.upEvent(nt,At,Ke)},{phetioPlayback:!0,tandem:(c=l.tandem)==null?void 0:c.createTandem("mouseUpAction"),parameters:[{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when a mouse button is released."}),this.mouseDownAction=new PhetioAction$1((Ke,At,nt)=>{const dt=this.ensureMouse(At);dt.id=Ke,this.downEvent(dt,nt,At)},{phetioPlayback:!0,tandem:(y=l.tandem)==null?void 0:y.createTandem("mouseDownAction"),parameters:[{name:"id",phetioType:NullableIO(NumberIO)},{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when a mouse button is pressed."}),this.mouseMoveAction=new PhetioAction$1((Ke,At)=>{const nt=this.ensureMouse(Ke);nt.move(Ke),this.moveEvent(nt,At)},{phetioPlayback:!0,tandem:(m=l.tandem)==null?void 0:m.createTandem("mouseMoveAction"),parameters:[{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when the mouse is moved.",phetioHighFrequency:!0}),this.mouseOverAction=new PhetioAction$1((Ke,At)=>{this.ensureMouse(Ke).over(Ke)},{phetioPlayback:!0,tandem:(O=l.tandem)==null?void 0:O.createTandem("mouseOverAction"),parameters:[{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when the mouse is moved while on the sim."}),this.mouseOutAction=new PhetioAction$1((Ke,At)=>{this.ensureMouse(Ke).out(Ke)},{phetioPlayback:!0,tandem:(D=l.tandem)==null?void 0:D.createTandem("mouseOutAction"),parameters:[{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when the mouse moves out of the display."}),this.wheelScrollAction=new PhetioAction$1(Ke=>{const At=Ke.domEvent,nt=this.ensureMouse(this.pointFromEvent(At));if(nt.wheel(At),nt.point){const dt=this.rootNode.trailUnderPointer(nt)||new Trail(this.rootNode);this.dispatchEvent(dt,"wheel",nt,Ke,!0)}},{phetioPlayback:!0,tandem:(z=l.tandem)==null?void 0:z.createTandem("wheelScrollAction"),parameters:[{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when the mouse wheel scrolls.",phetioHighFrequency:!0}),this.touchStartAction=new PhetioAction$1((Ke,At,nt)=>{const dt=new Touch(Ke,At,nt.domEvent);this.addPointer(dt),this.downEvent(dt,nt,At)},{phetioPlayback:!0,tandem:(w=l.tandem)==null?void 0:w.createTandem("touchStartAction"),parameters:[{name:"id",phetioType:NumberIO},{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when a touch begins."}),this.touchEndAction=new PhetioAction$1((Ke,At,nt)=>{const dt=this.findPointerById(Ke);dt&&(assert&&assert(dt instanceof Touch),this.upEvent(dt,nt,At),this.removePointer(dt))},{phetioPlayback:!0,tandem:(N=l.tandem)==null?void 0:N.createTandem("touchEndAction"),parameters:[{name:"id",phetioType:NumberIO},{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when a touch ends."}),this.touchMoveAction=new PhetioAction$1((Ke,At,nt)=>{const dt=this.findPointerById(Ke);dt&&(assert&&assert(dt instanceof Touch),dt.move(At),this.moveEvent(dt,nt))},{phetioPlayback:!0,tandem:(H=l.tandem)==null?void 0:H.createTandem("touchMoveAction"),parameters:[{name:"id",phetioType:NumberIO},{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when a touch moves.",phetioHighFrequency:!0}),this.touchCancelAction=new PhetioAction$1((Ke,At,nt)=>{const dt=this.findPointerById(Ke);dt&&(assert&&assert(dt instanceof Touch),this.cancelEvent(dt,nt,At),this.removePointer(dt))},{phetioPlayback:!0,tandem:(X=l.tandem)==null?void 0:X.createTandem("touchCancelAction"),parameters:[{name:"id",phetioType:NumberIO},{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when a touch is canceled."}),this.penStartAction=new PhetioAction$1((Ke,At,nt)=>{const dt=new Pen(Ke,At,nt.domEvent);this.addPointer(dt),this.downEvent(dt,nt,At)},{phetioPlayback:!0,tandem:(ae=l.tandem)==null?void 0:ae.createTandem("penStartAction"),parameters:[{name:"id",phetioType:NumberIO},{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when a pen touches the screen."}),this.penEndAction=new PhetioAction$1((Ke,At,nt)=>{const dt=this.findPointerById(Ke);dt&&(this.upEvent(dt,nt,At),this.removePointer(dt))},{phetioPlayback:!0,tandem:(oe=l.tandem)==null?void 0:oe.createTandem("penEndAction"),parameters:[{name:"id",phetioType:NumberIO},{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when a pen is lifted."}),this.penMoveAction=new PhetioAction$1((Ke,At,nt)=>{const dt=this.findPointerById(Ke);dt&&(dt.move(At),this.moveEvent(dt,nt))},{phetioPlayback:!0,tandem:(ue=l.tandem)==null?void 0:ue.createTandem("penMoveAction"),parameters:[{name:"id",phetioType:NumberIO},{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when a pen is moved.",phetioHighFrequency:!0}),this.penCancelAction=new PhetioAction$1((Ke,At,nt)=>{const dt=this.findPointerById(Ke);dt&&(this.cancelEvent(dt,nt,At),this.removePointer(dt))},{phetioPlayback:!0,tandem:(fe=l.tandem)==null?void 0:fe.createTandem("penCancelAction"),parameters:[{name:"id",phetioType:NumberIO},{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when a pen is canceled."}),this.gotPointerCaptureAction=new PhetioAction$1((Ke,At)=>{const nt=this.findPointerById(Ke);nt&&nt.onGotPointerCapture()},{phetioPlayback:!0,tandem:(be=l.tandem)==null?void 0:be.createTandem("gotPointerCaptureAction"),parameters:[{name:"id",phetioType:NumberIO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when a pointer is captured (normally at the start of an interaction)",phetioHighFrequency:!0}),this.lostPointerCaptureAction=new PhetioAction$1((Ke,At)=>{const nt=this.findPointerById(Ke);nt&&nt.onLostPointerCapture()},{phetioPlayback:!0,tandem:(Ae=l.tandem)==null?void 0:Ae.createTandem("lostPointerCaptureAction"),parameters:[{name:"id",phetioType:NumberIO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when a pointer loses its capture (normally at the end of an interaction)",phetioHighFrequency:!0}),this.focusinAction=new PhetioAction$1(Ke=>{const At=this.getPDOMEventTrail(Ke.domEvent,"focusin");At&&(sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`focusin(${ds.debugText(null,Ke.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.dispatchPDOMEvent(At,"focus",Ke,!1),this.dispatchPDOMEvent(At,"focusin",Ke,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop())},{phetioPlayback:!0,tandem:(W=l.tandem)==null?void 0:W.createTandem("focusinAction"),parameters:[{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when the PDOM root gets the focusin DOM event."}),this.focusoutAction=new PhetioAction$1(Ke=>{const At=this.getPDOMEventTrail(Ke.domEvent,"focusout");At&&(sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`focusOut(${ds.debugText(null,Ke.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.dispatchPDOMEvent(At,"blur",Ke,!1),this.dispatchPDOMEvent(At,"focusout",Ke,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop())},{phetioPlayback:!0,tandem:(J=l.tandem)==null?void 0:J.createTandem("focusoutAction"),parameters:[{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when the PDOM root gets the focusout DOM event."}),this.clickAction=new PhetioAction$1(Ke=>{const At=this.getPDOMEventTrail(Ke.domEvent,"click");At&&(sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`click(${ds.debugText(null,Ke.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.dispatchPDOMEvent(At,"click",Ke,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop())},{phetioPlayback:!0,tandem:(Ue=l.tandem)==null?void 0:Ue.createTandem("clickAction"),parameters:[{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when the PDOM root gets the click DOM event."}),this.inputAction=new PhetioAction$1(Ke=>{const At=this.getPDOMEventTrail(Ke.domEvent,"input");At&&(sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`input(${ds.debugText(null,Ke.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.dispatchPDOMEvent(At,"input",Ke,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop())},{phetioPlayback:!0,tandem:(gt=l.tandem)==null?void 0:gt.createTandem("inputAction"),parameters:[{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when the PDOM root gets the input DOM event."}),this.changeAction=new PhetioAction$1(Ke=>{const At=this.getPDOMEventTrail(Ke.domEvent,"change");At&&(sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`change(${ds.debugText(null,Ke.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.dispatchPDOMEvent(At,"change",Ke,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop())},{phetioPlayback:!0,tandem:(Te=l.tandem)==null?void 0:Te.createTandem("changeAction"),parameters:[{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when the PDOM root gets the change DOM event."}),this.keydownAction=new PhetioAction$1(Ke=>{sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`keydown(${ds.debugText(null,Ke.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.dispatchGlobalEvent("globalkeydown",Ke,!0);const At=this.getPDOMEventTrail(Ke.domEvent,"keydown");At&&this.dispatchPDOMEvent(At,"keydown",Ke,!0),this.dispatchGlobalEvent("globalkeydown",Ke,!1),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()},{phetioPlayback:!0,tandem:(Et=l.tandem)==null?void 0:Et.createTandem("keydownAction"),parameters:[{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when the PDOM root gets the keydown DOM event."}),this.keyupAction=new PhetioAction$1(Ke=>{sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`keyup(${ds.debugText(null,Ke.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.dispatchGlobalEvent("globalkeyup",Ke,!0);const At=this.getPDOMEventTrail(Ke.domEvent,"keydown");At&&this.dispatchPDOMEvent(At,"keyup",Ke,!0),this.dispatchGlobalEvent("globalkeyup",Ke,!1),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()},{phetioPlayback:!0,tandem:(Bt=l.tandem)==null?void 0:Bt.createTandem("keyupAction"),parameters:[{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when the PDOM root gets the keyup DOM event."})}interruptPointers(e=null){_.each(this.pointers,t=>{t!==e&&t.interruptAll()})}batchEvent(e,t,n,r){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent("Input.batchEvent"),sceneryLog&&sceneryLog.InputEvent&&sceneryLog.push(),this.display.interactive&&(this.batchedEvents.push(BatchedDOMEvent.pool.create(e,t,n)),(r||!this.batchDOMEvents)&&this.fireBatchedEvents()),this.passiveEvents!==!0&&(n!==this.mouseDown||platform.edge)&&t!==BatchedDOMEventType.ALT_TYPE&&e.domEvent.preventDefault(),sceneryLog&&sceneryLog.InputEvent&&sceneryLog.pop()}fireBatchedEvents(){if(sceneryLog&&sceneryLog.InputEvent&&this.currentlyFiringEvents&&sceneryLog.InputEvent("REENTRANCE DETECTED"),!this.currentlyFiringEvents&&this.batchedEvents.length){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`Input.fireBatchedEvents length:${this.batchedEvents.length}`),sceneryLog&&sceneryLog.InputEvent&&sceneryLog.push(),this.currentlyFiringEvents=!0;const e=this.batchedEvents;for(let t=0;t<e.length;t++){const n=e[t];n.run(this),n.dispose()}cleanArray(e),this.currentlyFiringEvents=!1,sceneryLog&&sceneryLog.InputEvent&&sceneryLog.pop()}}clearBatchedEvents(){this.batchedEvents.length=0}validatePointers(){this.validatePointersAction.execute()}removeTemporaryPointers(){for(let e=this.pointers.length-1;e>=0;e--){const t=this.pointers[e];if(!(t instanceof Mouse)){this.pointers.splice(e,1);const n=t.trail||new Trail(this.rootNode);this.exitEvents(t,EventContext.createSynthetic(),n,0,!0)}}}connectListeners(){BrowserEvents$1.addDisplay(this.display,this.attachToWindow,this.passiveEvents)}disconnectListeners(){BrowserEvents$1.removeDisplay(this.display,this.attachToWindow,this.passiveEvents)}pointFromEvent(e){const t=Vector2.pool.create(e.clientX,e.clientY);if(!this.assumeFullWindow){const n=this.display.domElement.getBoundingClientRect();n.width>0&&n.height>0&&(t.subtractXY(n.left,n.top),(n.width!==this.display.width||n.height!==this.display.height)&&(t.x*=this.display.width/n.width,t.y*=this.display.height/n.height))}return t}addPointer(e){this.pointers.push(e),this.pointerAddedEmitter.emit(e)}removePointer(e){for(let t=this.pointers.length-1;t>=0;t--)this.pointers[t]===e&&this.pointers.splice(t,1);e.dispose()}findPointerById(e){let t=this.pointers.length;for(;t--;){const n=this.pointers[t];if(n.id===e)return n}return null}getPDOMEventTrail(e,t){if(!this.display.interactive)return null;const n=this.getTrailFromPDOMEvent(e);return n&&!(t==="click"&&_.some(n.nodes,s=>s.positionInPDOM)&&e.timeStamp-this.upTimeStamp<=PDOM_CLICK_DELAY)?n:null}initMouse(e){const t=new Mouse(e);return this.mouse=t,this.addPointer(t),t}ensureMouse(e){const t=this.mouse;return t||this.initMouse(e)}initPDOMPointer(){const e=new PDOMPointer(this.display);return this.pdomPointer=e,this.addPointer(e),e}ensurePDOMPointer(){const e=this.pdomPointer;return e||this.initPDOMPointer()}dispatchPDOMEvent(e,t,n,r){this.ensurePDOMPointer().updateTrail(e),PDOMUtils$1.USER_GESTURE_EVENTS.includes(t)&&Display.userGestureEmitter.emit();const s=n.domEvent;s.target&&s.target.hasAttribute(PDOMUtils$1.DATA_EXCLUDE_FROM_INPUT)||(e.isPickable()||PDOM_UNPICKABLE_EVENTS.includes(t)||(e=new Trail([])),assert&&assert(this.pdomPointer),this.dispatchEvent(e,t,this.pdomPointer,n,r))}dispatchGlobalEvent(e,t,n){this.ensurePDOMPointer(),assert&&assert(this.pdomPointer);const r=this.pdomPointer,s=new SceneryEvent(new Trail,e,r,t),a=l=>{if(!l.isDisposed&&l.isVisible()&&l.isInputEnabled()&&l.isPDOMVisible()){for(let d=l._children.length-1;d>=0;d--)a(l._children[d]);!s.aborted&&!s.handled&&(s.currentTarget=l,this.dispatchToListeners(r,l._inputListeners,e,s,n))}};a(this.rootNode)}getRelatedTargetTrail(e){const t=e.relatedTarget;if(t&&this.display.isElementUnderPDOM(t)){const n=e.relatedTarget;assert&&assert(n instanceof window.Element);const r=n.getAttribute(PDOMUtils$1.DATA_PDOM_UNIQUE_ID);return assert&&assert(r,"should not be null"),PDOMInstance$1.uniqueIdToTrail(this.display,r)}return null}getTrailFromPDOMEvent(e){if(assert&&assert(e.target||e[TARGET_SUBSTITUTE_KEY],"need a way to get the target"),!this.display._accessible)return null;if(e[TARGET_SUBSTITUTE_KEY]){const t=e[TARGET_SUBSTITUTE_KEY].getAttribute(PDOMUtils$1.DATA_PDOM_UNIQUE_ID);return PDOMInstance$1.uniqueIdToTrail(this.display,t)}else{const t=e.target;if(assert&&assert(t instanceof window.Element,"target is not an Element",t),t&&this.display.isElementUnderPDOM(t)){const n=t.getAttribute(PDOMUtils$1.DATA_PDOM_UNIQUE_ID);return assert&&assert(n,"should not be null"),PDOMInstance$1.uniqueIdToTrail(this.display,n)}}return null}mouseDown(e,t,n){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`mouseDown('${e}', ${ds.debugText(t,n.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.mouseDownAction.execute(e,t,n),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}mouseUp(e,t){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`mouseUp(${ds.debugText(e,t.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.mouseUpAction.execute(e,t),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}mouseMove(e,t){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`mouseMove(${ds.debugText(e,t.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.mouseMoveAction.execute(e,t),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}mouseOver(e,t){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`mouseOver(${ds.debugText(e,t.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.mouseOverAction.execute(e,t),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}mouseOut(e,t){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`mouseOut(${ds.debugText(e,t.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.mouseOutAction.execute(e,t),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}wheel(e){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`wheel(${ds.debugText(null,e.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.wheelScrollAction.execute(e),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}touchStart(e,t,n){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`touchStart('${e}',${ds.debugText(t,n.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.touchStartAction.execute(e,t,n),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}touchEnd(e,t,n){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`touchEnd('${e}',${ds.debugText(t,n.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.touchEndAction.execute(e,t,n),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}touchMove(e,t,n){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`touchMove('${e}',${ds.debugText(t,n.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.touchMoveAction.execute(e,t,n),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}touchCancel(e,t,n){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`touchCancel('${e}',${ds.debugText(t,n.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.touchCancelAction.execute(e,t,n),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}penStart(e,t,n){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`penStart('${e}',${ds.debugText(t,n.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.penStartAction.execute(e,t,n),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}penEnd(e,t,n){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`penEnd('${e}',${ds.debugText(t,n.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.penEndAction.execute(e,t,n),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}penMove(e,t,n){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`penMove('${e}',${ds.debugText(t,n.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.penMoveAction.execute(e,t,n),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}penCancel(e,t,n){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`penCancel('${e}',${ds.debugText(t,n.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.penCancelAction.execute(e,t,n),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}pointerDown(e,t,n,r){const s=this.attachToWindow?document.body:this.display.domElement;switch(s.setPointerCapture&&r.domEvent.pointerId&&s.setPointerCapture(r.domEvent.pointerId),t=this.handleUnknownPointerType(t,e),t){case"mouse":this.mouseDown(e,n,r);break;case"touch":this.touchStart(e,n,r);break;case"pen":this.penStart(e,n,r);break;default:if(assert)throw new Error(`Unknown pointer type: ${t}`)}}pointerUp(e,t,n,r){switch(this.upTimeStamp=r.domEvent.timeStamp,t=this.handleUnknownPointerType(t,e),t){case"mouse":this.mouseUp(n,r);break;case"touch":this.touchEnd(e,n,r);break;case"pen":this.penEnd(e,n,r);break;default:if(assert)throw new Error(`Unknown pointer type: ${t}`)}}pointerCancel(e,t,n,r){switch(t=this.handleUnknownPointerType(t,e),t){case"mouse":console&&console.log&&console.log("WARNING: Pointer mouse cancel was received");break;case"touch":this.touchCancel(e,n,r);break;case"pen":this.penCancel(e,n,r);break;default:console.log&&console.log(`Unknown pointer type: ${t}`)}}gotPointerCapture(e,t,n,r){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`gotPointerCapture('${e}',${ds.debugText(null,r.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.gotPointerCaptureAction.execute(e,r),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}lostPointerCapture(e,t,n,r){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`lostPointerCapture('${e}',${ds.debugText(null,r.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.lostPointerCaptureAction.execute(e,r),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}pointerMove(e,t,n,r){switch(t=this.handleUnknownPointerType(t,e),t){case"mouse":this.mouseMove(n,r);break;case"touch":this.touchMove(e,n,r);break;case"pen":this.penMove(e,n,r);break;default:console.log&&console.log(`Unknown pointer type: ${t}`)}}pointerOver(e,t,n,r){}pointerOut(e,t,n,r){}pointerEnter(e,t,n,r){}pointerLeave(e,t,n,r){}focusIn(e){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`focusIn('${ds.debugText(null,e.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.focusinAction.execute(e),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}focusOut(e){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`focusOut('${ds.debugText(null,e.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.focusoutAction.execute(e),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}input(e){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`input('${ds.debugText(null,e.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.inputAction.execute(e),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}change(e){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`change('${ds.debugText(null,e.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.changeAction.execute(e),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}click(e){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`click('${ds.debugText(null,e.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.clickAction.execute(e),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}keyDown(e){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`keyDown('${ds.debugText(null,e.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.keydownAction.execute(e),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}keyUp(e){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`keyUp('${ds.debugText(null,e.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.keyupAction.execute(e),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}handleUnknownPointerType(e,t){return e!==""?e:this.mouse&&this.mouse.id===t?"mouse":"touch"}getPointerTrail(e){return this.rootNode.trailUnderPointer(e)||new Trail(this.rootNode)}upEvent(e,t,n){if(this.display.isElementUnderPDOM(t.domEvent.target))return;const r=e.up(n,t.domEvent);sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`upEvent ${e.toString()} changed:${r}`),sceneryLog&&sceneryLog.Input&&sceneryLog.push();const s=this.branchChangeEvents(e,t,r);this.dispatchEvent(s,"up",e,t,!0),e.isTouchLike()&&this.exitEvents(e,t,s,0,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}downEvent(e,t,n){if(this.display.isElementUnderPDOM(t.domEvent.target))return;const r=e.updatePoint(n);sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`downEvent ${e.toString()} changed:${r}`),sceneryLog&&sceneryLog.Input&&sceneryLog.push();const s=this.branchChangeEvents(e,t,r);e.down(t.domEvent),this.dispatchEvent(s,"down",e,t,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}moveEvent(e,t){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`moveEvent ${e.toString()}`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.branchChangeEvents(e,t,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}cancelEvent(e,t,n){const r=e.cancel(n);sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`cancelEvent ${e.toString()} changed:${r}`),sceneryLog&&sceneryLog.Input&&sceneryLog.push();const s=this.branchChangeEvents(e,t,r);this.dispatchEvent(s,"cancel",e,t,!0),e.isTouchLike()&&this.exitEvents(e,t,s,0,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}branchChangeEvents(e,t,n){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`branchChangeEvents: ${e.toString()} sendMove:${n}`),sceneryLog&&sceneryLog.InputEvent&&sceneryLog.push();const r=this.getPointerTrail(e),s=r.slice(0,Math.min(r.nodes.length,r.getLastInputEnabledIndex()+1)),a=e.inputEnabledTrail||new Trail(this.rootNode),l=Trail.branchIndex(s,a),d=a.lastNode()!==s.lastNode();if(sceneryLog&&sceneryLog.InputEvent){const c=e.trail||new Trail(this.rootNode),y=Trail.branchIndex(r,c);(y!==r.length||y!==c.length)&&sceneryLog.InputEvent(`changed from ${c.toString()} to ${r.toString()}`)}return n&&this.dispatchEvent(r,"move",e,t,!0),this.exitEvents(e,t,a,l,d),this.enterEvents(e,t,s,l,d),e.trail=r,e.inputEnabledTrail=s,sceneryLog&&sceneryLog.InputEvent&&sceneryLog.pop(),r}enterEvents(e,t,n,r,s){s&&this.dispatchEvent(n,"over",e,t,!0,!0);for(let a=r;a<n.length;a++)this.dispatchEvent(n.slice(0,a+1),"enter",e,t,!1)}exitEvents(e,t,n,r,s){for(let a=n.length-1;a>=r;a--)this.dispatchEvent(n.slice(0,a+1),"exit",e,t,!1,!0);s&&this.dispatchEvent(n,"out",e,t,!0)}dispatchEvent(e,t,n,r,s,a=!1){sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.EventDispatch(`${t} trail:${e.toString()} pointer:${n.toString()} at ${n.point?n.point.toString():"null"}`),sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.push(),assert&&assert(e,"Falsy trail for dispatchEvent"),sceneryLog&&sceneryLog.EventPath&&sceneryLog.EventPath(`${t} ${e.toPathString()}`);const l=new SceneryEvent(e,t,n,r);this.currentSceneryEvent=l,this.dispatchToListeners(n,n.getListeners(),t,l),this.dispatchToTargets(e,t,n,l,s,a),this.dispatchToListeners(n,this.display.getInputListeners(),t,l),Display.inputListeners.length&&this.dispatchToListeners(n,Display.inputListeners.slice(),t,l),this.currentSceneryEvent=null,sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.pop()}dispatchToListeners(e,t,n,r,s=null){if(r.handled)return;const a=e.type+n;for(let l=0;l<t.length;l++){const d=t[l];(s===null||s===!!d.capture)&&(!r.aborted&&d[a]&&(sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.EventDispatch(a),sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.push(),d[a](r),sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.pop()),!r.aborted&&d[n]&&(sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.EventDispatch(n),sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.push(),d[n](r),sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.pop()))}}dispatchToTargets(e,t,n,r,s,a=!1){if(r.aborted||r.handled)return;const l=e.getLastInputEnabledIndex();for(let d=e.nodes.length-1;d>=0;s?d--:d=-1){const c=e.nodes[d],y=l<d;if(!(c.isDisposed||!a&&y)&&(r.currentTarget=c,this.dispatchToListeners(n,c.getInputListeners(),t,r),r.aborted||r.handled))return}}static serializeDomEvent(e){const t={constructorName:e.constructor.name};return domEventPropertiesToSerialize.forEach(n=>{const r=e[n];r==null?t[n]=null:r instanceof Element&&EVENT_KEY_VALUES_AS_ELEMENTS.includes(n)&&typeof r.getAttribute=="function"&&r.hasAttribute(PDOMUtils$1.DATA_PDOM_UNIQUE_ID)?t[n]={[PDOMUtils$1.DATA_PDOM_UNIQUE_ID]:r.getAttribute(PDOMUtils$1.DATA_PDOM_UNIQUE_ID),id:r.getAttribute("id")}:t[n]=typeof r=="object"?{}:JSON.parse(JSON.stringify(r))}),t}static deserializeDomEvent(e){const t=e.constructorName||"Event",n=_.pick(e,domEventPropertiesSetInConstructor);if(n.relatedTarget){const s=document.getElementById(n.relatedTarget.id);assert&&assert(s,"cannot deserialize event when related target is not in the DOM."),n.relatedTarget=s}const r=new window[t](t,n);for(const s in e)if(e.hasOwnProperty(s)&&!domEventPropertiesSetInConstructor.includes(s))if(s==="target"){if(assert){const a=e.target;a&&a.id&&assert(document.getElementById(a.id),"target should exist in the PDOM to support playback.")}r[TARGET_SUBSTITUTE_KEY]=_.clone(e[s])||{},r[TARGET_SUBSTITUTE_KEY].getAttribute=function(a){return this[a]}}else r[s]=e[s];return r}static debugText(e,t){let n=`${t.timeStamp} ${t.type}`;return e!==null&&(n=`${e.x},${e.y} ${n}`),n}static msPointerType(e){return e.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_TOUCH?"touch":e.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_PEN?"pen":e.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_MOUSE?"mouse":e.pointerType}};ds.InputIO=new IOType("InputIO",{valueType:ds,applyState:_.noop,toStateObject:e=>({pointers:ArrayIOPointerIO.toStateObject(e.pointers)}),stateSchema:{pointers:ArrayIOPointerIO}});let Input=ds;scenery.register("Input",Input);const Cn=class Cn extends EnumerationValue{};Cn.POINTER_TYPE=new Cn,Cn.MS_POINTER_TYPE=new Cn,Cn.TOUCH_TYPE=new Cn,Cn.MOUSE_TYPE=new Cn,Cn.WHEEL_TYPE=new Cn,Cn.ALT_TYPE=new Cn,Cn.enumeration=new Enumeration(Cn,{phetioDocumentation:"The type of batched event"});let BatchedDOMEventType=Cn;const Fl=class Fl{constructor(e,t,n){this.initialize(e,t,n)}initialize(e,t,n){return assert&&assert(e.domEvent,"for some reason, there is no DOM event?"),this.eventContext=e,this.type=t,this.callback=n,this}run(e){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent("Running batched event"),sceneryLog&&sceneryLog.InputEvent&&sceneryLog.push();const t=this.callback;if(e.validatePointers(),this.type===BatchedDOMEventType.POINTER_TYPE){const n=this.eventContext,r=n.domEvent;t.call(e,r.pointerId,r.pointerType,e.pointFromEvent(r),n)}else if(this.type===BatchedDOMEventType.MS_POINTER_TYPE){const n=this.eventContext,r=n.domEvent;t.call(e,r.pointerId,Input.msPointerType(r),e.pointFromEvent(r),n)}else if(this.type===BatchedDOMEventType.TOUCH_TYPE){const n=this.eventContext,r=n.domEvent;for(let s=0;s<r.changedTouches.length;s++){const a=r.changedTouches.item(s);t.call(e,a.identifier,e.pointFromEvent(a),n)}}else if(this.type===BatchedDOMEventType.MOUSE_TYPE){const n=this.eventContext,r=e.pointFromEvent(n.domEvent);t===e.mouseDown?t.call(e,null,r,n):t.call(e,r,n)}else if(this.type===BatchedDOMEventType.WHEEL_TYPE||this.type===BatchedDOMEventType.ALT_TYPE)t.call(e,this.eventContext);else throw new Error(`bad type value: ${this.type}`);sceneryLog&&sceneryLog.InputEvent&&sceneryLog.pop()}dispose(){this.eventContext=null,this.callback=null,this.freeToPool()}freeToPool(){Fl.pool.freeToPool(this)}};Fl.pool=new Pool(Fl);let BatchedDOMEvent=Fl;scenery.register("BatchedDOMEvent",BatchedDOMEvent);const noop=()=>{};let isGloballyAttached=!1;const BrowserEvents={blockFocusCallbacks:!1,addDisplay(o,e,t){assert&&assert(o instanceof Display),assert&&assert(typeof e=="boolean"),assert&&assert(!_.includes(this.attachedDisplays,o),"A display cannot be concurrently attached to events more than one time"),isGloballyAttached||(isGloballyAttached=!0,globalKeyStateTracker$1.attachToWindow(),FocusManager.attachToWindow()),this.attachedDisplays.push(o),e?this.attachedDisplays.length===1&&this.connectWindowListeners(t):this.addOrRemoveListeners(o.domElement,!0,t),o.domElement.addEventListener("wheel",this.onwheel,BrowserEvents.getEventOptions(t,!0))},removeDisplay(o,e,t){assert&&assert(o instanceof Display),assert&&assert(typeof e=="boolean"),assert&&assert(_.includes(this.attachedDisplays,o),"This display was not already attached to listen for window events"),arrayRemove(this.attachedDisplays,o),e?this.attachedDisplays.length===0&&this.disconnectWindowListeners(t):this.addOrRemoveListeners(o.domElement,!1,t),o.domElement.removeEventListener("wheel",this.onwheel,BrowserEvents.getEventOptions(t,!0))},getEventOptions(o,e){if(Features.passive&&o!==null){const n={passive:o};return e&&(n.capture=!1),assert&&assert(!n.capture,"Do not use capture without consulting globalKeyStateTracker, which expects have listeners called FIRST in keyboard-related cases."),n}else return!1},listenersAttachedToWindow:0,listenersAttachedToElement:0,attachedDisplays:[],canUsePointerEvents:!!(window.navigator&&window.navigator.pointerEnabled||window.PointerEvent)&&!platform.firefox,canUseMSPointerEvents:window.navigator&&window.navigator.msPointerEnabled,pointerListenerTypes:["pointerdown","pointerup","pointermove","pointerover","pointerout","pointercancel","gotpointercapture","lostpointercapture"],msPointerListenerTypes:["MSPointerDown","MSPointerUp","MSPointerMove","MSPointerOver","MSPointerOut","MSPointerCancel"],touchListenerTypes:["touchstart","touchend","touchmove","touchcancel"],mouseListenerTypes:["mousedown","mouseup","mousemove","mouseover","mouseout"],wheelListenerTypes:["wheel"],altListenerTypes:PDOMUtils$1.DOM_EVENTS,getNonWheelUsedTypes(){let o;return this.canUsePointerEvents?(sceneryLog&&sceneryLog.Input&&sceneryLog.Input("Detected pointer events support, using that instead of mouse/touch events"),o=this.pointerListenerTypes):this.canUseMSPointerEvents?(sceneryLog&&sceneryLog.Input&&sceneryLog.Input("Detected MS pointer events support, using that instead of mouse/touch events"),o=this.msPointerListenerTypes):(sceneryLog&&sceneryLog.Input&&sceneryLog.Input("No pointer events support detected, using mouse/touch events"),o=this.touchListenerTypes.concat(this.mouseListenerTypes)),o=o.concat(this.altListenerTypes),o},connectWindowListeners(o){this.addOrRemoveListeners(window,!0,o)},disconnectWindowListeners(o){this.addOrRemoveListeners(window,!1,o)},addOrRemoveListeners(o,e,t){assert&&assert(typeof e=="boolean"),assert&&assert(typeof t=="boolean"||t===null);const n=o===window;assert&&assert(!n||this.listenersAttachedToWindow>0==!e,"Do not add listeners to the window when already attached, or remove listeners when none are attached");const r=e?1:-1;n?this.listenersAttachedToWindow+=r:this.listenersAttachedToElement+=r,assert&&assert(this.listenersAttachedToWindow===0||this.listenersAttachedToElement===0,"Listeners should not be added both with addDisplayToWindow and addDisplayToElement. Use only one.");const s=e?"addEventListener":"removeEventListener",a=this.getNonWheelUsedTypes();for(let l=0;l<a.length;l++){const d=a[l];n&&document[s](d,noop,BrowserEvents.getEventOptions(t,!1));const c=this[`on${d}`];assert&&assert(!!c),o[s](d,c,BrowserEvents.getEventOptions(t,!0))}},batchWindowEvent(o,e,t,n){for(let r=0;r<this.attachedDisplays.length;r++){const a=this.attachedDisplays[r]._input;(!BrowserEvents.blockFocusCallbacks||t!=="focusIn"&&t!=="focusOut")&&a.batchEvent(o,e,a[t],n)}},onpointerdown:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("pointerdown"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push();const t=new EventContext(e);e.pointerType==="mouse"&&Display.userGestureEmitter.emit(),BrowserEvents.batchWindowEvent(t,BatchedDOMEventType.POINTER_TYPE,"pointerDown",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onpointerup:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("pointerup"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push();const t=new EventContext(e);Display.userGestureEmitter.emit(),BrowserEvents.batchWindowEvent(t,BatchedDOMEventType.POINTER_TYPE,"pointerUp",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onpointermove:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("pointermove"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.POINTER_TYPE,"pointerMove",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onpointerover:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("pointerover"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.POINTER_TYPE,"pointerOver",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onpointerout:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("pointerout"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.POINTER_TYPE,"pointerOut",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onpointercancel:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("pointercancel"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.POINTER_TYPE,"pointerCancel",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},ongotpointercapture:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("gotpointercapture"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.POINTER_TYPE,"gotPointerCapture",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onlostpointercapture:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("lostpointercapture"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.POINTER_TYPE,"lostPointerCapture",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onMSPointerDown:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("MSPointerDown"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.MS_POINTER_TYPE,"pointerDown",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onMSPointerUp:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("MSPointerUp"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.MS_POINTER_TYPE,"pointerUp",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onMSPointerMove:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("MSPointerMove"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.MS_POINTER_TYPE,"pointerMove",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onMSPointerOver:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("MSPointerOver"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.MS_POINTER_TYPE,"pointerOver",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onMSPointerOut:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("MSPointerOut"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.MS_POINTER_TYPE,"pointerOut",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onMSPointerCancel:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("MSPointerCancel"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.MS_POINTER_TYPE,"pointerCancel",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},ontouchstart:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("touchstart"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.TOUCH_TYPE,"touchStart",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},ontouchend:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("touchend"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push();const t=new EventContext(e);Display.userGestureEmitter.emit(),BrowserEvents.batchWindowEvent(t,BatchedDOMEventType.TOUCH_TYPE,"touchEnd",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},ontouchmove:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("touchmove"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.TOUCH_TYPE,"touchMove",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},ontouchcancel:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("touchcancel"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.TOUCH_TYPE,"touchCancel",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onmousedown:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("mousedown"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push();const t=new EventContext(e);Display.userGestureEmitter.emit(),BrowserEvents.batchWindowEvent(t,BatchedDOMEventType.MOUSE_TYPE,"mouseDown",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onmouseup:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("mouseup"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push();const t=new EventContext(e);Display.userGestureEmitter.emit(),BrowserEvents.batchWindowEvent(t,BatchedDOMEventType.MOUSE_TYPE,"mouseUp",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onmousemove:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("mousemove"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.MOUSE_TYPE,"mouseMove",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onmouseover:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("mouseover"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.MOUSE_TYPE,"mouseOver",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onmouseout:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("mouseout"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.MOUSE_TYPE,"mouseOut",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onwheel:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("wheel"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.WHEEL_TYPE,"wheel",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onfocusin:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("focusin"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),FocusManager.updatePDOMFocusFromEvent(BrowserEvents.attachedDisplays,e,!0),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.ALT_TYPE,"focusIn",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onfocusout:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("focusout"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),FocusManager.updatePDOMFocusFromEvent(BrowserEvents.attachedDisplays,e,!1),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.ALT_TYPE,"focusOut",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},oninput:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("input"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.ALT_TYPE,"input",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onchange:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("change"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.ALT_TYPE,"change",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onclick:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("click"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.ALT_TYPE,"click",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onkeydown:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("keydown"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.ALT_TYPE,"keyDown",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onkeyup:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("keyup"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.ALT_TYPE,"keyUp",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()}};scenery.register("BrowserEvents",BrowserEvents);const BrowserEvents$1=BrowserEvents;class InputFuzzer{constructor(e,t){this.display=e,this.touches=[],this.nextTouchID=1,this.isMouseDown=!1,this.mousePosition=new Vector2(0,0),this.random=new Random({seed:t}),this.mouseToggleAction=()=>{this.mouseToggle()},this.mouseMoveAction=()=>{this.mouseMove()},this.touchStartAction=()=>{const n=this.createTouch(this.getRandomPosition());this.touchStart(n)},this.touchMoveAction=()=>{const n=this.random.sample(this.touches);this.touchMove(n)},this.touchEndAction=()=>{const n=this.random.sample(this.touches);this.touchEnd(n),this.removeTouch(n)},this.touchCancelAction=()=>{const n=this.random.sample(this.touches);this.touchCancel(n),this.removeTouch(n)}}fuzzEvents(e,t,n,r){for(assert&&assert(e>0,`averageEventCount must be positive: ${e}`),this.display._input.currentlyFiringEvents=!0;this.random.nextDouble()<1-1/(e+1);){const a=this.touches.length+(this.isMouseDown?1:0)<r,l=[];t&&(this.isMouseDown||a)&&(l.push(this.mouseToggleAction),l.push(this.mouseMoveAction)),n&&(a&&l.push(this.touchStartAction),this.touches.length&&(l.push(this.random.nextDouble()<.8?this.touchEndAction:this.touchCancelAction),l.push(this.touchMoveAction))),this.random.sample(l)()}this.display._input.currentlyFiringEvents=!1,this.display._input.fireBatchedEvents()}createTouchEvent(e,t){const n=this.display.domElement,r=t.map(s=>({identifier:s.id,target:n,clientX:s.position.x,clientY:s.position.y}));if(window.Touch!==void 0&&window.TouchEvent!==void 0&&window.Touch.length===1&&window.TouchEvent.length===1){const s=r.map(a=>new window.Touch(a));return new window.TouchEvent(e,{cancelable:!0,bubbles:!0,touches:s,targetTouches:[],changedTouches:s,shiftKey:!1})}else{const s=document.createEvent("CustomEvent");return s.initCustomEvent(e,!0,!0,{touches:r,targetTouches:[],changedTouches:r}),s}}getRandomPosition(){return new Vector2(Math.floor(this.random.nextDouble()*this.display.width),Math.floor(this.random.nextDouble()*this.display.height))}createTouch(e){const t={id:this.nextTouchID++,position:e};return this.touches.push(t),t}removeTouch(e){this.touches.splice(this.touches.indexOf(e),1)}touchStart(e){const t=this.createTouchEvent("touchstart",[e]);this.display._input.validatePointers(),this.display._input.touchStart(e.id,e.position,new EventContext(t))}touchMove(e){e.position=this.getRandomPosition();const t=this.createTouchEvent("touchmove",[e]);this.display._input.validatePointers(),this.display._input.touchMove(e.id,e.position,new EventContext(t))}touchEnd(e){const t=this.createTouchEvent("touchend",[e]);this.display._input.validatePointers(),this.display._input.touchEnd(e.id,e.position,new EventContext(t))}touchCancel(e){const t=this.createTouchEvent("touchcancel",[e]);this.display._input.validatePointers(),this.display._input.touchCancel(e.id,e.position,new EventContext(t))}mouseToggle(){const e=document.createEvent("MouseEvent");e.initMouseEvent(this.isMouseDown?"mouseup":"mousedown",!0,!0,window,1,this.mousePosition.x,this.mousePosition.y,this.mousePosition.x,this.mousePosition.y,!1,!1,!1,!1,0,null),this.display._input.validatePointers(),this.isMouseDown?(this.display._input.mouseUp(this.mousePosition,new EventContext(e)),this.isMouseDown=!1):(this.display._input.mouseDown(null,this.mousePosition,new EventContext(e)),this.isMouseDown=!0)}mouseMove(){this.mousePosition=this.getRandomPosition();const e=document.createEvent("MouseEvent");e.initMouseEvent("mousemove",!0,!0,window,0,this.mousePosition.x,this.mousePosition.y,this.mousePosition.x,this.mousePosition.y,!1,!1,!1,!1,0,null),this.display._input.validatePointers(),this.display._input.mouseMove(this.mousePosition,new EventContext(e))}}scenery.register("InputFuzzer",InputFuzzer);class DownUpListener extends PhetioObject{constructor(e){assert&&deprecationWarning("DownUpListener is deprecated, please use PressListener instead"),e=merge({mouseButton:0},e),super(e),this.options=e,this.isDown=!1,this.downCurrentTarget=null,this.downTrail=null,this.pointer=null,this.interrupted=!1,this.downListener={up:t=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`DownUpListener (pointer) up for ${this.downTrail.toString()}`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),assert&&assert(t.pointer===this.pointer),(!(t.pointer instanceof Mouse)||t.domEvent.button===this.options.mouseButton)&&this.buttonUp(t),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},interrupt:()=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`DownUpListener (pointer) interrupt for ${this.downTrail.toString()}`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.interrupt(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},cancel:t=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`DownUpListener (pointer) cancel for ${this.downTrail.toString()}`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),assert&&assert(t.pointer===this.pointer),this.buttonUp(t),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}}}buttonDown(e){this.isDown||e.pointer instanceof Mouse&&e.domEvent.button!==this.options.mouseButton||(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DownUpListener buttonDown"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),e.pointer.addInputListener(this.downListener),this.isDown=!0,this.downCurrentTarget=e.currentTarget,this.downTrail=e.trail.subtrailTo(e.currentTarget,!1),this.pointer=e.pointer,this.options.down&&this.options.down(e,this.downTrail),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop())}buttonUp(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DownUpListener buttonUp"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.isDown=!1,this.pointer.removeInputListener(this.downListener);const t=e.currentTarget;if(e.currentTarget=this.downCurrentTarget,this.options.upInside||this.options.upOutside){const r=e.trail.isExtensionOf(this.downTrail,!0)&&!this.interrupted;r&&this.options.upInside?this.options.upInside(e,this.downTrail):!r&&this.options.upOutside&&this.options.upOutside(e,this.downTrail)}this.options.up&&this.options.up(e,this.downTrail),e.currentTarget=t,sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}down(e){this.buttonDown(e)}interrupt(){if(this.isDown){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DownUpListener interrupt"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.interrupted=!0;const e=EventContext.createSynthetic(),t=new SceneryEvent(new Trail,"synthetic",this.pointer,e);t.currentTarget=this.downCurrentTarget,this.buttonUp(t),this.interrupted=!1,sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}}}scenery.register("DownUpListener",DownUpListener);class ButtonListener extends DownUpListener{constructor(e){assert&&deprecationWarning("ButtonListener is deprecated, please use FireListener instead"),e=merge({phetioType:ButtonListener.ButtonListenerIO,phetioState:!1,phetioEventType:EventType.USER},e),super({tandem:e.tandem,phetioType:e.phetioType,phetioState:e.phetioState,mouseButton:e.mouseButton||0,down:(t,n)=>{this.setButtonState(t,"down")},up:(t,n)=>{this.setButtonState(t,this._overCount>0?"over":"up")}}),this.buttonState="up",this._overCount=0,this._buttonOptions=e}setButtonState(e,t){if(t!==this.buttonState){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`ButtonListener state change to ${t} from ${this.buttonState} for ${this.downTrail?this.downTrail.toString():this.downTrail}`);const n=this.buttonState;this.buttonState=t,this._buttonOptions[t]&&(this.phetioStartEvent(t),this._buttonOptions[t](e,n),this.phetioEndEvent()),this._buttonOptions.fire&&this._overCount>0&&!this.interrupted&&(this._buttonOptions.fireOnDown?t==="down":n==="down")&&(this.phetioStartEvent("fire"),this._buttonOptions.fire(e),this.phetioEndEvent())}}enter(e){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`ButtonListener enter for ${this.downTrail?this.downTrail.toString():this.downTrail}`),this._overCount++,this._overCount===1&&this.setButtonState(e,this.isDown?"down":"over")}exit(e){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`ButtonListener exit for ${this.downTrail?this.downTrail.toString():this.downTrail}`),assert&&assert(this._overCount>0,"Exit events not matched by an enter"),this._overCount--,this._overCount===0&&this.setButtonState(e,this.isDown?"out":"up")}focus(e){this.enter(e)}blur(e){this.exit(e)}click(e){this.setButtonState(e,"down"),this.setButtonState(e,"up")}}scenery.register("ButtonListener",ButtonListener);ButtonListener.ButtonListenerIO=new IOType("ButtonListenerIO",{valueType:ButtonListener,documentation:"Button listener",events:["up","over","down","out","fire"]});class SimpleDragHandler extends PhetioObject{constructor(e){assert&&deprecationWarning("SimpleDragHandler is deprecated, please use DragListener instead"),e=merge({start:null,drag:null,end:null,translate:null,allowTouchSnag:!1,mouseButton:0,dragCursor:"pointer",attach:!0,tandem:Tandem.REQUIRED,phetioState:!1,phetioEventType:EventType.USER,phetioReadOnly:!0},e),super(),this.options=e,this.isDraggingProperty=new BooleanProperty(!1,{phetioReadOnly:e.phetioReadOnly,phetioState:!1,tandem:e.tandem.createTandem("isDraggingProperty"),phetioDocumentation:"Indicates whether the object is dragging"}),this.pointer=null,this.trail=null,this.transform=null,this.node=null,this.lastDragPoint=null,this.startTransformMatrix=null,this.mouseButton=void 0,this.interrupted=!1,this.lastInterruptedTouchLikePointer=null,this._attach=e.attach,this.dragStartAction=new PhetioAction$1((t,n)=>{this.dragging||(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("SimpleDragHandler startDrag"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this._attach&&(n.pointer.dragging=!0),n.pointer.cursor=this.options.dragCursor,n.pointer.addInputListener(this.dragListener,this.options.attach),n.pointer.reserveForDrag(),this.isDraggingProperty.set(!0),this.pointer=n.pointer,this.trail=n.trail.subtrailTo(n.currentTarget,!0),this.transform=this.trail.getTransform(),this.node=n.currentTarget,this.lastDragPoint=n.pointer.point,this.startTransformMatrix=n.currentTarget.getMatrix().copy(),this.mouseButton=n.pointer instanceof Mouse?n.domEvent.button:void 0,this.options.start&&this.options.start.call(null,n,this.trail),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop())},{tandem:e.tandem.createTandem("dragStartAction"),phetioReadOnly:e.phetioReadOnly,parameters:[{name:"point",phetioType:Vector2.Vector2IO,phetioDocumentation:"the position of the drag start in view coordinates"},{phetioPrivate:!0,valueType:[SceneryEvent,null]}]}),this.dragAction=new PhetioAction$1((t,n)=>{if(!this.dragging||this.isDisposed)return;const r=this.pointer.point.minus(this.lastDragPoint);if(r.magnitudeSquared===0)return;const s=this.transform.inverseDelta2(r);if(assert&&assert(n.pointer===this.pointer,"Wrong pointer in move"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`SimpleDragHandler (pointer) move for ${this.trail.toString()}`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.options.translate){const a=this.node.getMatrix().getTranslation();this.options.translate.call(null,{delta:s,oldPosition:a,position:a.plus(s)})}if(this.lastDragPoint=this.pointer.point,this.options.drag){const a=n.currentTarget;n.currentTarget=this.node,this.options.drag.call(null,n,this.trail),n.currentTarget=a}sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},{phetioHighFrequency:!0,phetioReadOnly:e.phetioReadOnly,tandem:e.tandem.createTandem("dragAction"),parameters:[{name:"point",phetioType:Vector2.Vector2IO,phetioDocumentation:"the position of the drag in view coordinates"},{phetioPrivate:!0,valueType:[SceneryEvent,null]}]}),this.dragEndAction=new PhetioAction$1((t,n)=>{this.dragging&&(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("SimpleDragHandler endDrag"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this._attach&&(this.pointer.dragging=!1),this.pointer.cursor=null,this.pointer.removeInputListener(this.dragListener),this.isDraggingProperty.set(!1),this.options.end&&this.options.end.call(null,n,this.trail),this.pointer=null,sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop())},{tandem:e.tandem.createTandem("dragEndAction"),phetioReadOnly:e.phetioReadOnly,parameters:[{name:"point",phetioType:Vector2.Vector2IO,phetioDocumentation:"the position of the drag end in view coordinates"},{phetioPrivate:!0,isValidValue:t=>t===null||t instanceof SceneryEvent||t.pointer&&t.currentTarget}]}),this.transformListener={transform:t=>{if(!this.trail.isExtensionOf(t.trail,!0))return;const n=t.trail.getMatrix(),r=this.transform.getMatrix();this.node.prependMatrix(n.inverted().timesMatrix(r)),this.transform.setMatrix(n)}},this.dragListener={up:t=>{if(!(!this.dragging||this.isDisposed)){if(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`SimpleDragHandler (pointer) up for ${this.trail.toString()}`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),assert&&assert(t.pointer===this.pointer,"Wrong pointer in up"),!(t.pointer instanceof Mouse)||t.domEvent.button===this.mouseButton){const n=t.currentTarget;t.currentTarget=this.node,this.endDrag(t),t.currentTarget=n}sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}},cancel:t=>{if(!this.dragging||this.isDisposed)return;sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`SimpleDragHandler (pointer) cancel for ${this.trail.toString()}`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),assert&&assert(t.pointer===this.pointer,"Wrong pointer in cancel");const n=t.currentTarget;t.currentTarget=this.node,this.endDrag(t),t.currentTarget=n,this.transform||this.node.setMatrix(this.startTransformMatrix),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},move:t=>{this.dragAction.execute(t.pointer.point,t)},interrupt:()=>{this.interrupt()}},this.initializePhetioObject({},e)}get dragging(){return this.isDraggingProperty.get()}set dragging(e){assert&&assert(!1,"illegal call to set dragging on SimpleDragHandler")}startDrag(e){this.dragStartAction.execute(e.pointer.point,e)}endDrag(e){this.dragEndAction.execute(e?e.pointer.point:Vector2.ZERO,e)}interrupt(){this.dragging&&(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("SimpleDragHandler interrupt"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.interrupted=!0,this.pointer&&this.pointer.isTouchLike()&&(this.lastInterruptedTouchLikePointer=this.pointer),this.endDrag({pointer:this.pointer,currentTarget:this.node}),this.interrupted=!1,sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop())}tryToSnag(e){e.pointer instanceof Mouse&&e.domEvent&&this.options.mouseButton!==e.domEvent.button&&this.options.mouseButton!==-1||this.isDisposed||!this.dragging&&(!e.pointer.dragging||!this._attach)&&e.pointer!==this.lastInterruptedTouchLikePointer&&e.canStartPress()&&this.startDrag(e)}tryTouchToSnag(e){this.options.allowTouchSnag&&(this.options.allowTouchSnag===!0||this.options.allowTouchSnag(e))&&this.tryToSnag(e)}down(e){this.tryToSnag(e)}touchenter(e){this.tryTouchToSnag(e)}touchmove(e){this.tryTouchToSnag(e)}dispose(){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("SimpleDragHandler dispose"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.dragging&&(this._attach&&(this.pointer.dragging=!1),this.pointer.cursor=null,this.pointer.removeInputListener(this.dragListener)),this.isDraggingProperty.dispose(),this.dragEndAction.dispose(),this.dragAction.dispose(),this.dragStartAction.dispose(),super.dispose(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}static createForwardingListener(e,t){return t=merge({allowTouchSnag:!1},t),{down:n=>{!n.pointer.dragging&&n.canStartPress()&&e(n)},touchenter:function(n){t.allowTouchSnag&&this.down(n)},touchmove:function(n){t.allowTouchSnag&&this.down(n)}}}}scenery.register("SimpleDragHandler",SimpleDragHandler);let globalID=0;const truePredicate=_.constant(!0),isPressedListener$1=o=>o.isPressed,Mu=class Mu extends EnabledComponent{constructor(e){const t=optionize()({press:_.noop,release:_.noop,targetNode:null,drag:_.noop,attach:!0,mouseButton:0,pressCursor:"pointer",useInputListenerCursor:!1,canStartPress:truePredicate,a11yLooksPressedInterval:100,collapseDragEvents:!1,phetioEnabledPropertyInstrumented:!1,tandem:Tandem.REQUIRED,phetioReadOnly:!0,phetioFeatured:PhetioObject.DEFAULT_OPTIONS.phetioFeatured},e);assert&&assert(typeof t.mouseButton=="number"&&t.mouseButton>=0&&t.mouseButton%1===0,"mouseButton should be a non-negative integer"),assert&&assert(t.pressCursor===null||typeof t.pressCursor=="string","pressCursor should either be a string or null"),assert&&assert(typeof t.press=="function","The press callback should be a function"),assert&&assert(typeof t.release=="function","The release callback should be a function"),assert&&assert(typeof t.drag=="function","The drag callback should be a function"),assert&&assert(t.targetNode===null||t.targetNode instanceof Node$2,"If provided, targetNode should be a Node"),assert&&assert(typeof t.attach=="boolean","attach should be a boolean"),assert&&assert(typeof t.a11yLooksPressedInterval=="number","a11yLooksPressedInterval should be a number"),super(t),this._id=globalID++,sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} construction`),this._mouseButton=t.mouseButton,this._a11yLooksPressedInterval=t.a11yLooksPressedInterval,this._pressCursor=t.pressCursor,this._pressListener=t.press,this._releaseListener=t.release,this._dragListener=t.drag,this._canStartPress=t.canStartPress,this._targetNode=t.targetNode,this._attach=t.attach,this._collapseDragEvents=t.collapseDragEvents,this.overPointers=createObservableArray(),this.isPressedProperty=new BooleanProperty(!1,{reentrant:!0}),this.isOverProperty=new BooleanProperty(!1),this.looksOverProperty=new BooleanProperty(!1),this.isHoveringProperty=new BooleanProperty(!1),this.isHighlightedProperty=new BooleanProperty(!1),this.isFocusedProperty=new BooleanProperty(!1),this.cursorProperty=new DerivedProperty([this.enabledProperty],n=>t.useInputListenerCursor&&n&&this._attach?this._pressCursor:null),this.pointer=null,this.pressedTrail=null,this.interrupted=!1,this._pendingCollapsedDragEvent=null,this._listeningToPointer=!1,this._isHoveringListener=this.invalidateHovering.bind(this),this._isHighlightedListener=this.invalidateHighlighted.bind(this),this.pdomClickingProperty=new BooleanProperty(!1),this.looksPressedProperty=DerivedProperty.or([this.pdomClickingProperty,this.isPressedProperty]),this._pdomClickingTimeoutListener=null,this._pointerListener={up:this.pointerUp.bind(this),cancel:this.pointerCancel.bind(this),move:this.pointerMove.bind(this),interrupt:this.pointerInterrupt.bind(this),listener:this},this._pressAction=new PhetioAction$1(this.onPress.bind(this),{tandem:t.tandem.createTandem("pressAction"),phetioDocumentation:"Executes whenever a press occurs. The first argument when executing can be used to convey info about the SceneryEvent.",phetioReadOnly:!0,phetioFeatured:t.phetioFeatured,phetioEventType:EventType.USER,parameters:[{name:"event",phetioType:SceneryEvent.SceneryEventIO},{phetioPrivate:!0,valueType:[Node$2,null]},{phetioPrivate:!0,valueType:["function",null]}]}),this._releaseAction=new PhetioAction$1(this.onRelease.bind(this),{parameters:[{name:"event",phetioType:NullableIO(SceneryEvent.SceneryEventIO)},{phetioPrivate:!0,valueType:["function",null]}],tandem:t.tandem.createTandem("releaseAction"),phetioDocumentation:"Executes whenever a release occurs.",phetioReadOnly:!0,phetioFeatured:t.phetioFeatured,phetioEventType:EventType.USER}),this.display=null,this.boundInvalidateOverListener=this.invalidateOver.bind(this),this.overPointers.lengthProperty.link(this.invalidateOver.bind(this)),this.isFocusedProperty.link(this.invalidateOver.bind(this)),this.overPointers.lengthProperty.link(this._isHoveringListener),this.isPressedProperty.link(this._isHoveringListener),this.overPointers.addItemAddedListener(n=>n.isDownProperty.link(this._isHoveringListener)),this.overPointers.addItemRemovedListener(n=>n.isDownProperty.unlink(this._isHoveringListener)),this.isHoveringProperty.link(this._isHighlightedListener),this.isPressedProperty.link(this._isHighlightedListener),this.enabledProperty.lazyLink(this.onEnabledPropertyChange.bind(this))}get isPressed(){return this.isPressedProperty.value}get cursor(){return this.cursorProperty.value}get attach(){return this._attach}get targetNode(){return this._targetNode}getCurrentTarget(){return assert&&assert(this.isPressed,"We have no currentTarget if we are not pressed"),this.pressedTrail.lastNode()}get currentTarget(){return this.getCurrentTarget()}canPress(e){return!!this.enabledProperty.value&&!this.isPressed&&this._canStartPress(e,this)&&(!(e.pointer instanceof Mouse)||e.domEvent.button===this._mouseButton)&&(!this._attach||!e.pointer.isAttached())}canClick(){return this.enabledProperty.value&&!this.isPressed&&this._canStartPress(null,this)}press(e,t,n){return assert&&assert(e,"An event is required"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} press`),this.canPress(e)?(this.flushCollapsedDrag(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} successful press`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this._pressAction.execute(e,t||null,n||null),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop(),!0):(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} could not press`),!1)}release(e,t){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} release`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.flushCollapsedDrag(),this._releaseAction.execute(e||null,t||null),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}drag(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} drag`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),assert&&assert(this.isPressed,"Can only drag while pressed"),this._dragListener(e,this),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}interrupt(){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} interrupt`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.pdomClickingProperty.value?(this.interrupted=!0,this._listeningToPointer?this.release():(this.isPressedProperty.value=!1,this._releaseListener(null,this)),stepTimer.hasListener(this._pdomClickingTimeoutListener)&&(stepTimer.clearTimeout(this._pdomClickingTimeoutListener),this.pdomClickingProperty.isDisposed||(this.pdomClickingProperty.value=!1))):this.isPressed&&(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} interrupting`),this.interrupted=!0,this.release()),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}clearOverPointers(){this.overPointers.clear()}step(){this.flushCollapsedDrag()}setCreatePanTargetBounds(e){this._pointerListener.createPanTargetBounds=e}set createPanTargetBounds(e){this.setCreatePanTargetBounds(e)}setCreatePanTargetBoundsFromTrail(e){assert&&assert(e.length>0,"trail has no Nodes to provide localBounds"),this.setCreatePanTargetBounds(()=>e.localToGlobalBounds(e.lastNode().localBounds))}set createPanTargetBoundsFromTrail(e){this.setCreatePanTargetBoundsFromTrail(e)}flushCollapsedDrag(){this._pendingCollapsedDragEvent&&this.drag(this._pendingCollapsedDragEvent),this._pendingCollapsedDragEvent=null}invalidateOver(){let e=!1;if(this._listeningToPointer)e=!1;else for(let t=0;t<this.overPointers.length;t++)if(this.overPointers.get(t).isAttached()){e=!0;break}this.isOverProperty.value=this.overPointers.length>0&&!e,this.looksOverProperty.value=this.isOverProperty.value||this.isFocusedProperty.value&&!!this.display&&this.display.focusManager.pdomFocusHighlightsVisibleProperty.value}invalidateHovering(){for(let e=0;e<this.overPointers.length;e++){const t=this.overPointers[e];if(!t.isDown||t===this.pointer){this.isHoveringProperty.value=!0;return}}this.isHoveringProperty.value=!1}invalidateHighlighted(){this.isHighlightedProperty.value=this.isHoveringProperty.value||this.isPressedProperty.value}onEnabledPropertyChange(e){!e&&this.interrupt()}onPress(e,t,n){assert&&assert(!this.isDisposed,"Should not press on a disposed listener");const r=t||this._targetNode;this.pointer=e.pointer,this.pressedTrail=r?r.getUniqueTrail():e.trail.subtrailTo(e.currentTarget,!1),this.interrupted=!1,this.pointer.addInputListener(this._pointerListener,this._attach),this._listeningToPointer=!0,this.pointer.cursor=this.pressedTrail.lastNode().getEffectiveCursor()||this._pressCursor,this.isPressedProperty.value=!0,this._pressListener(e,this),n&&n()}onRelease(e,t){assert&&assert(this.isPressed,"This listener is not pressed");const n=this;n.pointer.removeInputListener(this._pointerListener),this._listeningToPointer=!1,this.isPressedProperty.value=!1,this._releaseListener(e,this),t&&t(),n.pointer.cursor=null,this.pointer=null,this.pressedTrail=null}down(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} down`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.press(e),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}up(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} up`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.invalidateOver(),this.invalidateHovering(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}enter(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} enter`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.overPointers.push(e.pointer),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}move(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} move`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.invalidateOver(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}exit(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} exit`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.overPointers.includes(e.pointer)&&this.overPointers.remove(e.pointer),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}pointerUp(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} pointer up`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.isPressed&&(assert&&assert(e.pointer===this.pointer),this.release(e)),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}pointerCancel(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} pointer cancel`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.isPressed&&(assert&&assert(e.pointer===this.pointer),this.interrupt()),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}pointerMove(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} pointer move`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.isPressed&&(assert&&assert(e.pointer===this.pointer),this._collapseDragEvents?this._pendingCollapsedDragEvent=e:this.drag(e)),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}pointerInterrupt(){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} pointer interrupt`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.interrupt(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}click(e,t){return this.canClick()&&(this.interrupted=!1,this.pdomClickingProperty.value=!0,this.isFocusedProperty.value=!0,this.isPressedProperty.value=!0,this._pressListener(e,this),t&&t(),this.isPressedProperty.value=!1,this._releaseListener(e,this),stepTimer.clearTimeout(this._pdomClickingTimeoutListener),this._pdomClickingTimeoutListener=stepTimer.setTimeout(()=>{this.pdomClickingProperty.isDisposed||(this.pdomClickingProperty.value=!1)},this._a11yLooksPressedInterval)),!0}focus(e){const t=e.trail.rootNode().getRootedDisplays().filter(n=>n.isAccessible());assert&&assert(t.length===1,"cannot focus node with zero or multiple accessible displays attached"),this.display=t[0],this.display.focusManager.pdomFocusHighlightsVisibleProperty.hasListener(this.boundInvalidateOverListener)||this.display.focusManager.pdomFocusHighlightsVisibleProperty.link(this.boundInvalidateOverListener),this.isFocusedProperty.value=!0}blur(){this.display&&(this.display.focusManager.pdomFocusHighlightsVisibleProperty.hasListener(this.boundInvalidateOverListener)&&this.display.focusManager.pdomFocusHighlightsVisibleProperty.unlink(this.boundInvalidateOverListener),this.display=null),this.isFocusedProperty.value=!1}dispose(){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} dispose`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.overPointers.clear(),this._listeningToPointer&&isPressedListener$1(this)&&this.pointer.removeInputListener(this._pointerListener),this.isPressedProperty.isDisposed||(this.isPressedProperty.unlink(this._isHighlightedListener),this.isPressedProperty.unlink(this._isHoveringListener)),!this.isHoveringProperty.isDisposed&&this.isHoveringProperty.unlink(this._isHighlightedListener),this._pressAction.dispose(),this._releaseAction.dispose(),this.looksPressedProperty.dispose(),this.pdomClickingProperty.dispose(),this.cursorProperty.dispose(),this.isFocusedProperty.dispose(),this.isHighlightedProperty.dispose(),this.isHoveringProperty.dispose(),this.looksOverProperty.dispose(),this.isOverProperty.dispose(),this.isPressedProperty.dispose(),this.overPointers.dispose(),this.display&&(this.display.focusManager.pdomFocusHighlightsVisibleProperty.unlink(this.boundInvalidateOverListener),this.display=null),super.dispose(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}};Mu.phetioAPI={pressAction:{phetioType:PhetioAction$1.PhetioActionIO([SceneryEvent.SceneryEventIO])},releaseAction:{phetioType:PhetioAction$1.PhetioActionIO([NullableIO(SceneryEvent.SceneryEventIO)])}};let PressListener=Mu;scenery.register("PressListener",PressListener);class FireListener extends PressListener{constructor(e){const t=optionize()({fire:_.noop,fireOnDown:!1,fireOnHold:!1,fireOnHoldDelay:400,fireOnHoldInterval:100,tandem:Tandem.REQUIRED,phetioReadOnly:PhetioObject.DEFAULT_OPTIONS.phetioReadOnly},e);assert&&assert(typeof t.fire=="function","The fire callback should be a function"),assert&&assert(typeof t.fireOnDown=="boolean","fireOnDown should be a boolean"),super(t),this._fireOnDown=t.fireOnDown,this.firedEmitter=new Emitter({tandem:t.tandem.createTandem("firedEmitter"),phetioEventType:EventType.USER,phetioReadOnly:t.phetioReadOnly,phetioDocumentation:"Emits at the time that the listener fires",parameters:[{name:"event",phetioType:NullableIO(SceneryEvent.SceneryEventIO)}]}),this.firedEmitter.addListener(t.fire),t.fireOnHold&&(this._timer=new CallbackTimer({callback:this.fire.bind(this,null),delay:t.fireOnHoldDelay,interval:t.fireOnHoldInterval}))}fire(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("FireListener fire"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.firedEmitter.emit(e),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}press(e,t,n){return super.press(e,t,()=>{this._fireOnDown&&this.fire(e),this._timer&&this._timer.start(),n&&n()})}release(e,t){super.release(e,()=>{const n=!this._fireOnDown&&this.isHoveringProperty.value&&!this.interrupted;this._timer?this._timer.stop(n):n&&this.fire(e||null),t&&t()})}click(e,t){return super.click(e,()=>{this.interrupted||this.fire(e),t&&t()})}interrupt(){super.interrupt(),this._timer&&this._timer.stop(!1)}dispose(){this.firedEmitter.dispose(),this._timer&&this._timer.dispose(),super.dispose()}}scenery.register("FireListener",FireListener);const scratchVector2A=new Vector2(0,0),isPressedListener=o=>o.isPressed;class DragListener extends PressListener{constructor(e){const t=optionize()({positionProperty:null,start:null,end:null,transform:null,dragBoundsProperty:null,allowTouchSnag:!0,applyOffset:!0,useParentOffset:!1,trackAncestors:!1,translateNode:!1,mapPosition:null,offsetPosition:null,canClick:!1,tandem:Tandem.REQUIRED,phetioReadOnly:!0,phetioFeatured:PhetioObject.DEFAULT_OPTIONS.phetioFeatured},e);assert&&assert(!t.dragBounds,"options.dragBounds was removed in favor of options.dragBoundsProperty"),assert&&assert(!t.useParentOffset||t.positionProperty,"If useParentOffset is set, a positionProperty is required"),assert&&assert(!(t.mapPosition&&t.dragBoundsProperty),"Only one of mapPosition and dragBoundsProperty can be provided, as they handle mapping of the drag point"),super(t),this._allowTouchSnag=t.allowTouchSnag,this._applyOffset=t.applyOffset,this._useParentOffset=t.useParentOffset,this._trackAncestors=t.trackAncestors,this._translateNode=t.translateNode,this._transform=t.transform,this._positionProperty=t.positionProperty,this._mapPosition=t.mapPosition,this._offsetPosition=t.offsetPosition,this._dragBoundsProperty=t.dragBoundsProperty||new Property(null),this._start=t.start,this._end=t.end,this._canClick=t.canClick,this.isUserControlledProperty=this.isPressedProperty,this._globalPoint=new Vector2(0,0),this._localPoint=new Vector2(0,0),this._parentPoint=new Vector2(0,0),this._modelPoint=new Vector2(0,0),this._modelDelta=new Vector2(0,0),this._parentOffset=new Vector2(0,0),this._transformTracker=null,this._transformTrackerListener=this.ancestorTransformed.bind(this),this._lastInterruptedTouchLikePointer=null,this._dragAction=new PhetioAction$1(n=>{assert&&assert(isPressedListener(this));const s=this.pointer.point;s&&(this._globalPoint.equals(s)||this.reposition(s)),PressListener.prototype.drag.call(this,n)},{parameters:[{name:"event",phetioType:SceneryEvent.SceneryEventIO}],phetioFeatured:t.phetioFeatured,tandem:t.tandem.createTandem("dragAction"),phetioHighFrequency:!0,phetioDocumentation:"Emits whenever a drag occurs with an SceneryEventIO argument.",phetioReadOnly:t.phetioReadOnly,phetioEventType:EventType.USER})}press(e,t,n){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener press"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const r=super.press(e,t,()=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener successful press"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),assert&&assert(isPressedListener(this));const s=this;s.pointer.reserveForDrag(),this.attachTransformTracker(),assert&&assert(s.pointer.point!==null);const a=s.pointer.point,l=this.globalToParentPoint(this._localPoint.set(a));this._useParentOffset&&this.modelToParentPoint(this._parentOffset.set(this._positionProperty.value)).subtract(l),this.parentToLocalPoint(l),this.reposition(a),this._start&&this._start(e,s),n&&n(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()});return sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop(),r}release(e,t){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener release"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),super.release(e,()=>{this.detachTransformTracker(),this._end&&this._end(e||null,this),t&&t()}),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}canClick(){return super.canClick()&&this._canClick}click(e,t){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener click"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const n=super.click(e,()=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener successful press"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this._start&&this._start(e,this),t&&t(),this._end&&this._end(e,this),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()});return sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop(),n}drag(e){assert&&assert(isPressedListener(this));const n=this.pointer.point;!n||this._globalPoint.equals(n)||(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener drag"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this._dragAction.execute(e),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop())}tryTouchSnag(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener tryTouchSnag"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this._allowTouchSnag&&(!this.attach||!e.pointer.isAttached())&&this.press(e),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}getGlobalPoint(){return this._globalPoint.copy()}get globalPoint(){return this.getGlobalPoint()}getLocalPoint(){return this._localPoint.copy()}get localPoint(){return this.getLocalPoint()}getParentPoint(){return this._parentPoint.copy()}get parentPoint(){return this.getParentPoint()}getModelPoint(){return this._modelPoint.copy()}get modelPoint(){return this.getModelPoint()}getModelDelta(){return this._modelDelta.copy()}get modelDelta(){return this.getModelDelta()}globalToParentPoint(e){assert&&assert(isPressedListener(this));const t=this;let n;return assert&&(n=t.pressedTrail.globalToParentPoint(e)),t.pressedTrail.getParentTransform().getInverse().multiplyVector2(e),assert&&assert(e.equals(n)),e}parentToLocalPoint(e){assert&&assert(isPressedListener(this));const t=this;let n;return assert&&(n=t.pressedTrail.lastNode().parentToLocalPoint(e)),t.pressedTrail.lastNode().getTransform().getInverse().multiplyVector2(e),assert&&assert(e.equals(n)),e}localToParentPoint(e){assert&&assert(isPressedListener(this));const t=this;let n;return assert&&(n=t.pressedTrail.lastNode().localToParentPoint(e)),t.pressedTrail.lastNode().getMatrix().multiplyVector2(e),assert&&assert(e.equals(n)),e}parentToModelPoint(e){return this._transform&&(this._transform instanceof Transform3?this._transform:this._transform.value).getInverse().multiplyVector2(e),e}modelToParentPoint(e){return this._transform&&(this._transform instanceof Transform3?this._transform:this._transform.value).getMatrix().multiplyVector2(e),e}mapModelPoint(e){return this._mapPosition?this._mapPosition(e):this._dragBoundsProperty.value?this._dragBoundsProperty.value.closestPointTo(e):e}applyParentOffset(e){this._offsetPosition&&e.add(this._offsetPosition(e,this)),this._applyOffset&&(this._useParentOffset?e.add(this._parentOffset):(e.subtract(this.localToParentPoint(scratchVector2A.set(this._localPoint))),e.add(this.localToParentPoint(scratchVector2A.setXY(0,0)))))}reposition(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener reposition"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),assert&&assert(isPressedListener(this));const t=this;this._globalPoint.set(e),this.applyParentOffset(this.globalToParentPoint(this._parentPoint.set(e))),this._modelDelta.set(this._modelPoint).negate(),this._modelPoint.set(this.mapModelPoint(this.parentToModelPoint(scratchVector2A.set(this._parentPoint)))),this._modelDelta.add(this._modelPoint),this.modelToParentPoint(this._parentPoint.set(this._modelPoint)),this._translateNode&&(t.pressedTrail.lastNode().translation=this._parentPoint),this._positionProperty&&(this._positionProperty.value=this._modelPoint.copy()),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}touchenter(e){e.pointer.isDownProperty.value&&this.tryTouchSnag(e)}touchmove(e){this.tryTouchSnag(e)}ancestorTransformed(){assert&&assert(isPressedListener(this));const t=this.pointer.point;t&&this.reposition(t)}attachTransformTracker(){assert&&assert(isPressedListener(this));const e=this;this._trackAncestors&&(this._transformTracker=new TransformTracker$1(e.pressedTrail.copy().removeDescendant()),this._transformTracker.addListener(this._transformTrackerListener))}detachTransformTracker(){this._transformTracker&&(this._transformTracker.removeListener(this._transformTrackerListener),this._transformTracker.dispose(),this._transformTracker=null)}getDragBounds(){return this._dragBoundsProperty.value}get dragBounds(){return this.getDragBounds()}setTransform(e){this._transform=e}set transform(e){this.setTransform(e)}get transform(){return this.getTransform()}getTransform(){return this._transform}interrupt(){this.pointer&&this.pointer.isTouchLike()&&(this._lastInterruptedTouchLikePointer=this.pointer),super.interrupt()}canPress(e){return e.pointer===this._lastInterruptedTouchLikePointer?!1:super.canPress(e)}dispose(){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener dispose"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this._dragAction.dispose(),this.detachTransformTracker(),super.dispose(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}static createForwardingListener(e,t){const n=optionize()({allowTouchSnag:!0},t);return{down(r){r.canStartPress()&&e(r)},touchenter(r){n.allowTouchSnag&&this.down(r)},touchmove(r){n.allowTouchSnag&&this.down(r)}}}}scenery.register("DragListener",DragListener);class MultiListenerPress{constructor(e,t){this.pointer=e,this.trail=t,this.interrupted=!1,this.initialPoint=e.point,this.localPoint=null,this.recomputeLocalPoint()}recomputeLocalPoint(){this.localPoint=this.trail.globalToLocalPoint(this.pointer.point)}get targetPoint(){return this.trail.globalToParentPoint(this.pointer.point)}}scenery.register("MultiListenerPress",MultiListenerPress);const MOVE_INTERRUPT_MAGNITUDE=25;class MultiListener{constructor(e,t){const n=optionize()({mouseButton:0,pressCursor:"pointer",allowScale:!0,allowRotation:!0,allowMultitouchInterruption:!1,allowMoveInterruption:!0,minScale:1,maxScale:4,tandem:Tandem.REQUIRED},t);this._targetNode=e,this._minScale=n.minScale,this._maxScale=n.maxScale,this._mouseButton=n.mouseButton,this._pressCursor=n.pressCursor,this._allowScale=n.allowScale,this._allowRotation=n.allowRotation,this._allowMultitouchInterruption=n.allowMultitouchInterruption,this._allowMoveInterruption=n.allowMoveInterruption,this._presses=[],this._backgroundPresses=[],this.matrixProperty=new Property(e.matrix.copy(),{phetioValueType:Matrix3.Matrix3IO,tandem:n.tandem.createTandem("matrixProperty"),phetioReadOnly:!0}),this.matrixProperty.link(r=>{this._targetNode.matrix=r}),this._interrupted=!1,this._pressListener={move:r=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener pointer move"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const s=this.findPress(r.pointer);assert&&assert(s,"Press should be found for move event"),this.movePress(s),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},up:r=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener pointer up"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const s=this.findPress(r.pointer);assert&&assert(s,"Press should be found for up event"),this.removePress(s),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},cancel:r=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener pointer cancel"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const s=this.findPress(r.pointer);assert&&assert(s,"Press should be found for cancel event"),s.interrupted=!0,this.removePress(s),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},interrupt:()=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener pointer interrupt"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.interrupt(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}},this._backgroundListener={up:r=>{if(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener background up"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),!this._interrupted){const s=this.findBackgroundPress(r.pointer);assert&&assert(s,"Background press should be found for up event"),this.removeBackgroundPress(s)}sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},move:r=>{const s=this._backgroundPresses.filter(a=>!a.pointer.hasIntent(Intent.DRAG)&&a.initialPoint.distance(a.pointer.point)>MOVE_INTERRUPT_MAGNITUDE);(this.getCurrentScale()!==1||s.length>=2)&&(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener attached, interrupting for press"),s.forEach(a=>{this.removeBackgroundPress(a),this.interruptOtherListeners(a.pointer),this.addPress(a)}))},cancel:r=>{if(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener background cancel"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),!this._interrupted){const s=this.findBackgroundPress(r.pointer);assert&&assert(s,"Background press should be found for cancel event"),this.removeBackgroundPress(s)}sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},interrupt:()=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener background interrupt"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.interrupt(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}}}findPress(e){for(let t=0;t<this._presses.length;t++)if(this._presses[t].pointer===e)return this._presses[t];return null}findBackgroundPress(e){for(let t=0;t<this._backgroundPresses.length;t++)if(this._backgroundPresses[t].pointer===e)return this._backgroundPresses[t];return null}hasPress(e){return _.some(this._presses.concat(this._backgroundPresses),t=>t.pointer===e.pointer)}interruptOtherListeners(e){const t=e.getListeners();for(let n=0;n<t.length;n++){const r=t[n];r!==this._backgroundListener&&r.interrupt&&r.interrupt()}}down(e){if(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener down"),e.pointer instanceof Mouse&&e.domEvent instanceof MouseEvent&&e.domEvent.button!==this._mouseButton){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener abort: wrong mouse button");return}this._interrupted=!1;let t;_.includes(e.trail.nodes,this._targetNode)?t=e.trail.subtrailTo(this._targetNode,!1):t=this._targetNode.getUniqueTrailTo(e.target),assert&&assert(_.includes(t.nodes,this._targetNode),"targetNode must be in the Trail for Press"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const n=new MultiListenerPress(e.pointer,t);!this._allowMoveInterruption&&!this._allowMultitouchInterruption?e.pointer.isAttached()||(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener unattached, using press"),this.addPress(n)):(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener attached, adding background press"),this.addBackgroundPress(n)),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}addPress(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener addPress"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.hasPress(e)||(this._presses.push(e),e.pointer.cursor=this._pressCursor,e.pointer.addInputListener(this._pressListener,!0),this.recomputeLocals(),this.reposition()),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}movePress(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener movePress"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.reposition(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}removePress(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener removePress"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),e.pointer.removeInputListener(this._pressListener),e.pointer.cursor=null,arrayRemove(this._presses,e),this.recomputeLocals(),this.reposition(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}addBackgroundPress(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener addBackgroundPress"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.hasPress(e)||(this._backgroundPresses.push(e),e.pointer.addInputListener(this._backgroundListener,!1)),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}removeBackgroundPress(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener removeBackgroundPress"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),e.pointer.removeInputListener(this._backgroundListener),arrayRemove(this._backgroundPresses,e),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}reposition(){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener reposition"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.matrixProperty.set(this.computeMatrix()),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}recomputeLocals(){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener recomputeLocals"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();for(let e=0;e<this._presses.length;e++)this._presses[e].recomputeLocalPoint();sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}interrupt(){for(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener interrupt"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();this._presses.length;)this.removePress(this._presses[this._presses.length-1]);for(;this._backgroundPresses.length;)this.removeBackgroundPress(this._backgroundPresses[this._backgroundPresses.length-1]);this._interrupted=!0,sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}computeMatrix(){return this._presses.length===0?this._targetNode.getMatrix():this._presses.length===1?this.computeSinglePressMatrix():this._allowScale&&this._allowRotation?this.computeTranslationRotationScaleMatrix():this._allowScale?this.computeTranslationScaleMatrix():this._allowRotation?this.computeTranslationRotationMatrix():this.computeTranslationMatrix()}computeSinglePressMatrix(){const e=this._presses[0].targetPoint,t=this._presses[0].localPoint;assert&&assert(t,"localPoint is not defined on the Press?");const n=this._targetNode.localToParentPoint(t),r=e.minus(n);return Matrix3.translationFromVector(r).timesMatrix(this._targetNode.getMatrix())}computeTranslationMatrix(){const e=new Vector2(0,0);for(let t=0;t<this._presses.length;t++){e.add(this._presses[t].targetPoint);const n=this._presses[t].localPoint;assert&&assert(n,"localPoint is not defined on the Press?"),e.subtract(n)}return Matrix3.translationFromVector(e.dividedScalar(this._presses.length))}computeTranslationScaleMatrix(){const e=this._presses.map(y=>(assert&&assert(y.localPoint,"localPoint is not defined on the Press?"),y.localPoint)),t=this._presses.map(y=>y.targetPoint),n=new Vector2(0,0),r=new Vector2(0,0);e.forEach(y=>{n.add(y)}),t.forEach(y=>{r.add(y)}),n.divideScalar(this._presses.length),r.divideScalar(this._presses.length);let s=0,a=0;e.forEach(y=>{s+=y.distanceSquared(n)}),t.forEach(y=>{a+=y.distanceSquared(r)});let l=this.getCurrentScale();a!==0&&(l=this.limitScale(Math.sqrt(a/s)));const d=Matrix3.translation(r.x,r.y),c=Matrix3.translation(-n.x,-n.y);return d.timesMatrix(Matrix3.scaling(l)).timesMatrix(c)}limitScale(e){let t=Math.max(e,this._minScale);return t=Math.min(t,this._maxScale),t}computeTranslationRotationMatrix(){let e;const t=new Matrix$1(2,this._presses.length),n=new Matrix$1(2,this._presses.length),r=new Vector2(0,0),s=new Vector2(0,0);for(e=0;e<this._presses.length;e++){const m=this._presses[e].localPoint,O=this._presses[e].targetPoint;r.add(m),s.add(O),t.set(0,e,m.x),t.set(1,e,m.y),n.set(0,e,O.x),n.set(1,e,O.y)}for(r.divideScalar(this._presses.length),s.divideScalar(this._presses.length),e=0;e<this._presses.length;e++)t.set(0,e,t.get(0,e)-r.x),t.set(1,e,t.get(1,e)-r.y),n.set(0,e,n.get(0,e)-s.x),n.set(1,e,n.get(1,e)-s.y);const a=t.times(n.transpose()),l=new SingularValueDecomposition(a);let d=l.getV().times(l.getU().transpose());d.det()<0&&(d=l.getV().times(Matrix$1.diagonalMatrix([1,-1])).times(l.getU().transpose()));const c=new Matrix3().rowMajor(d.get(0,0),d.get(0,1),0,d.get(1,0),d.get(1,1),0,0,0,1),y=s.minus(c.timesVector2(r));return c.set02(y.x),c.set12(y.y),c}computeTranslationRotationScaleMatrix(){let e;const t=new Matrix$1(this._presses.length*2,4);for(e=0;e<this._presses.length;e++){const c=this._presses[e].localPoint;t.set(2*e+0,0,c.x),t.set(2*e+0,1,c.y),t.set(2*e+0,2,1),t.set(2*e+1,0,c.y),t.set(2*e+1,1,-c.x),t.set(2*e+1,3,1)}const n=new Matrix$1(this._presses.length*2,1);for(e=0;e<this._presses.length;e++){const c=this._presses[e].targetPoint;n.set(2*e+0,0,c.x),n.set(2*e+1,0,c.y)}const r=SingularValueDecomposition.pseudoinverse(t).times(n),s=r.get(0,0),a=r.get(1,0),l=r.get(2,0),d=r.get(3,0);return new Matrix3().rowMajor(s,a,l,-a,s,d,0,0,1)}getCurrentScale(){return this._targetNode.getScaleVector().x}resetTransform(){this._targetNode.resetTransform(),this.matrixProperty.set(this._targetNode.matrix.copy())}}scenery.register("MultiListener",MultiListener);class ModelViewTransform2 extends Transform3{modelToViewPosition(e){return this.transformPosition2(e)}modelToViewXY(e,t){return new Vector2(this.modelToViewX(e),this.modelToViewY(t))}modelToViewX(e){return this.matrix.m00()*e+this.matrix.m02()}modelToViewY(e){return this.matrix.m11()*e+this.matrix.m12()}modelToViewDelta(e){return this.transformDelta2(e)}modelToViewNormal(e){return this.transformNormal2(e)}modelToViewDeltaX(e){return this.transformDeltaX(e)}modelToViewDeltaY(e){return this.transformDeltaY(e)}modelToViewBounds(e){return this.transformBounds2(e)}modelToViewShape(e){return this.transformShape(e)}modelToViewRay(e){return this.transformRay2(e)}viewToModelPosition(e){return this.inversePosition2(e)}viewToModelXY(e,t){return new Vector2(this.viewToModelX(e),this.viewToModelY(t))}viewToModelX(e){const t=this.getInverse();return t.m00()*e+t.m02()}viewToModelY(e){const t=this.getInverse();return t.m11()*e+t.m12()}viewToModelDelta(e){return this.inverseDelta2(e)}viewToModelDeltaXY(e,t){return new Vector2(this.viewToModelDeltaX(e),this.viewToModelDeltaY(t))}viewToModelNormal(e){return this.inverseNormal2(e)}viewToModelDeltaX(e){return this.inverseDeltaX(e)}viewToModelDeltaY(e){return this.inverseDeltaY(e)}viewToModelBounds(e){return this.inverseBounds2(e)}viewToModelShape(e){return this.inverseShape(e)}viewToModelRay(e){return this.inverseRay2(e)}validateMatrix(e){super.validateMatrix(e),assert&&assert(e.isAligned(),"matrix must be aligned, ModelViewTransform2 does not support arbitrary rotations")}setToRectangleMapping(e,t){const n=t.width/e.width,r=t.x-n*e.x,s=t.height/e.height,a=t.y-s*e.y;return this.setMatrix(Matrix3.affine(n,0,r,0,s,a)),this}setToRectangleInvertedYMapping(e,t){const n=t.width/e.width,r=t.x-n*e.x,s=-t.height/e.height,a=t.y-s*e.getMaxY();return this.setMatrix(Matrix3.affine(n,0,r,0,s,a)),this}static createIdentity(){return new ModelViewTransform2(Matrix3.IDENTITY)}static createOffsetScaleMapping(e,t){return new ModelViewTransform2(Matrix3.affine(t,0,e.x,0,t,e.y))}static createOffsetXYScaleMapping(e,t,n){return new ModelViewTransform2(Matrix3.affine(t,0,e.x,0,n,e.y))}static createSinglePointXYScaleMapping(e,t,n,r){const s=t.x-e.x*n,a=t.y-e.y*r;return ModelViewTransform2.createOffsetXYScaleMapping(new Vector2(s,a),n,r)}static createSinglePointScaleMapping(e,t,n){return ModelViewTransform2.createSinglePointXYScaleMapping(e,t,n,n)}static createSinglePointScaleInvertedYMapping(e,t,n){return ModelViewTransform2.createSinglePointXYScaleMapping(e,t,n,-n)}static createRectangleMapping(e,t){return new ModelViewTransform2().setToRectangleMapping(e,t)}static createRectangleInvertedYMapping(e,t){return new ModelViewTransform2().setToRectangleInvertedYMapping(e,t)}}phetcommon.register("ModelViewTransform2",ModelViewTransform2);const SCRATCH_MATRIX=new Matrix3;class PanZoomListener extends MultiListener{constructor(e,t){var r;const n=optionize()({panBounds:Bounds2.NOTHING,targetBounds:null,targetScale:1,allowRotation:!1},t);super(e,n),this._panBounds=n.panBounds,this._targetBounds=n.targetBounds||e.globalBounds.copy(),this._targetScale=n.targetScale,this.sourceFramePanBoundsProperty=new Property(Tandem.API_GENERATION?new Bounds2(0,0,0,0):this._panBounds,{tandem:(r=n.tandem)==null?void 0:r.createTandem("sourceFramePanBoundsProperty"),phetioReadOnly:!0,phetioValueType:Bounds2.Bounds2IO}),this.sourceFramePanBoundsProperty.lazyLink(()=>{if(isSettingPhetioStateProperty.value){const s=ModelViewTransform2.createRectangleMapping(this.sourceFramePanBoundsProperty.get(),this._panBounds),a=this._targetNode.matrix.translation.componentMultiply(s.matrix.getScaleVector()),l=this.matrixProperty.get().getScaleVector();this.matrixProperty.set(Matrix3.translationFromVector(a).timesMatrix(Matrix3.scaling(l.x,l.y)))}},{phetioDependencies:[this.matrixProperty]})}correctReposition(){SCRATCH_MATRIX.set(this._targetNode.matrix);const e=this._targetBounds.transformed(this._targetNode.getMatrix());e.left>this._panBounds.left&&(this._targetNode.left=this._panBounds.left-(e.left-this._targetNode.left)),e.top>this._panBounds.top&&(this._targetNode.top=this._panBounds.top-(e.top-this._targetNode.top)),e.right<this._panBounds.right&&(this._targetNode.right=this._panBounds.right+(this._targetNode.right-e.right)),e.bottom<this._panBounds.bottom&&(this._targetNode.bottom=this._panBounds.bottom+(this._targetNode.bottom-e.bottom)),SCRATCH_MATRIX.equals(this._targetNode.matrix)||this.matrixProperty.set(this._targetNode.matrix.copy())}addPress(e){super.addPress(e);const n=this._targetBounds.transformed(this._targetNode.getMatrix()).equalsEpsilon(this._panBounds,1e-8);e.pointer.cursor=n?null:this._pressCursor}reposition(){super.reposition(),this.correctReposition()}resetTransform(){super.resetTransform(),this.correctReposition()}setPanBounds(e){this._panBounds=e,Tandem.API_GENERATION||this.sourceFramePanBoundsProperty.set(this._panBounds),this.correctReposition()}setTargetBounds(e){this._targetBounds=e,this.correctReposition()}setTargetScale(e){this._targetScale=e}getTargetBounds(){return this._targetBounds}}scenery.register("PanZoomListener",PanZoomListener);const MOVE_CURSOR="all-scroll",MAX_SCROLL_VELOCITY=150,MAX_TRANSLATION_SPEED=1e3,scratchTranslationVector=new Vector2(0,0),scratchScaleTargetVector=new Vector2(0,0),scratchVelocityVector=new Vector2(0,0),scratchBounds=new Bounds2(0,0,0,0);class AnimatedPanZoomListener extends PanZoomListener{constructor(e,t){const n=optionize()({tandem:Tandem.REQUIRED},t);super(e,n),this.trackpadGestureStartScale=1,this.animatingProperty=new BooleanProperty(!1),this._transformTracker=null,this._focusBoundsListener=null,this.sourcePosition=null,this.destinationPosition=null,this.sourceScale=this.getCurrentScale(),this.destinationScale=this.getCurrentScale(),this.scaleGestureTargetPosition=null,this.discreteScales=calculateDiscreteScales(this._minScale,this._maxScale),this.middlePress=null,this._dragBounds=null,this._transformedPanBounds=this._panBounds.transformed(this._targetNode.matrix.inverted()),this._draggingInDragBounds=!1,this._attachedPointers=[],this.boundsFinite=!1;let r=null,s=null;this.gestureStartAction=new PhetioAction$1(l=>{assert&&assert(l.pageX,"pageX required on DOMEvent"),assert&&assert(l.pageY,"pageY required on DOMEvent"),assert&&assert(l.scale,"scale required on DOMEvent"),l.preventDefault(),this.trackpadGestureStartScale=l.scale,this.scaleGestureTargetPosition=new Vector2(l.pageX,l.pageY)},{phetioPlayback:!0,tandem:n.tandem.createTandem("gestureStartAction"),parameters:[{name:"event",phetioType:EventIO}],phetioEventType:EventType.USER,phetioDocumentation:"Action that executes whenever a gesture starts on a trackpad in macOS Safari."}),this.gestureChangeAction=new PhetioAction$1(l=>{assert&&assert(l.scale,"scale required on DOMEvent"),l.preventDefault();const d=this.sourceScale+l.scale-this.trackpadGestureStartScale;this.setDestinationScale(d)},{phetioPlayback:!0,tandem:n.tandem.createTandem("gestureChangeAction"),parameters:[{name:"event",phetioType:EventIO}],phetioEventType:EventType.USER,phetioDocumentation:"Action that executes whenever a gesture changes on a trackpad in macOS Safari."}),platform.safari&&!platform.mobileSafari&&(r=this.handleGestureStartEvent.bind(this),s=this.handleGestureChangeEvent.bind(this),this.trackpadGestureStartScale=this.getCurrentScale(),window.addEventListener("gesturestart",r),window.addEventListener("gesturechange",s)),globalKeyStateTracker$1.keydownEmitter.addListener(this.windowKeydown.bind(this));const a=this.handleFocusChange.bind(this);FocusManager.pdomFocusProperty.link(a),this.sourceFramePanBoundsProperty.lazyLink(()=>{isSettingPhetioStateProperty.value&&(this.initializePositions(),this.sourceScale=this.getCurrentScale(),this.setDestinationScale(this.sourceScale))},{phetioDependencies:[this.matrixProperty]}),this.disposeAnimatedPanZoomListener=()=>{r&&window.removeEventListener("gesturestart",r),s&&window.removeEventListener("gestureChange",s),this.animatingProperty.dispose(),this._transformTracker&&this._transformTracker.dispose(),FocusManager.pdomFocusProperty.unlink(a)}}step(e){this.middlePress&&this.handleMiddlePress(e),this._attachedPointers.length>0&&this.getCurrentScale()>1&&(this._attachedPointers.length>0&&(this._attachedPointers=this._attachedPointers.filter(t=>t.attachedListener),assert&&assert(this._attachedPointers.length<=10,"Not clearing attachedPointers, there is probably a memory leak")),(this._draggingInDragBounds||this._attachedPointers.some(t=>t instanceof PDOMPointer))&&this.repositionDuringDrag()),this.animateToTargets(e)}down(e){super.down(e),this._dragBounds!==null&&e.pointer.hasIntent(Intent.DRAG)&&(this._attachedPointers.length===0&&(this._draggingInDragBounds=this._dragBounds.containsPoint(e.pointer.point)),e.pointer.attachedListener&&(this._attachedPointers.includes(e.pointer)||this._attachedPointers.push(e.pointer))),e.pointer.type==="mouse"&&e.pointer instanceof Mouse&&e.pointer.middleDown&&!this.middlePress?(this.middlePress=new MiddlePress(e.pointer,e.trail),e.pointer.cursor=MOVE_CURSOR):this.cancelMiddlePress()}cancelMiddlePress(){this.middlePress&&(this.middlePress.pointer.cursor=null,this.middlePress=null,this.stopInProgressAnimation())}movePress(e){this.middlePress||super.movePress(e)}move(e){if(this._attachedPointers.length>0&&this.getCurrentScale()>1)if(this._draggingInDragBounds){if(!this._attachedPointers.includes(e.pointer)){const t=this.hasDragIntent(e.pointer);e.currentTarget!==null&&t&&e.pointer.attachedListener&&this._attachedPointers.push(e.pointer)}}else this._dragBounds&&(this._draggingInDragBounds=this._dragBounds.containsPoint(e.pointer.point))}getTargetNodeDuringDrag(){if(this._attachedPointers.length>0){const e=this._attachedPointers[0].attachedListener;if(assert&&assert(e,"The attached Pointer is expected to have an attached listener."),e.listener instanceof PressListener||e.listener instanceof KeyboardDragListener$1){const t=e.listener;if(t.isPressed)return t.getCurrentTarget()}}return null}getGlobalBoundsToViewDuringDrag(){let e=null;if(this._attachedPointers.length>0){const t=this._attachedPointers[0].attachedListener;if(assert&&assert(t,"The attached Pointer is expected to have an attached listener."),t.createPanTargetBounds)e=t.createPanTargetBounds();else if(t.listener instanceof PressListener||t.listener instanceof KeyboardDragListener$1){const n=t.listener;if(n.isPressed){const r=n.getCurrentTarget();if(r.instances.length===1){const s=r.instances[0].trail;assert&&assert(s,"The target should be in one scene graph and have an instance with a trail."),e=s.parentToGlobalBounds(r.visibleBounds)}}}}return e}repositionDuringDrag(){const e=this.getGlobalBoundsToViewDuringDrag(),t=this.getTargetNodeDuringDrag();e&&this.keepBoundsInView(e,this._attachedPointers.some(n=>n instanceof PDOMPointer),t==null?void 0:t.limitPanDirection)}cancelPanningDuringDrag(e){if(e){const t=this._attachedPointers.indexOf(e.pointer);t>-1&&this._attachedPointers.splice(t,1)}else this._attachedPointers=[];this._draggingInDragBounds=!1}up(e){this.cancelPanningDuringDrag(e)}wheel(e){if(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener wheel"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),!this.middlePress){const t=new Wheel(e,this._targetScale);this.repositionFromWheel(t,e)}sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}windowKeydown(e){this.cancelMiddlePress();const t=_.get(window,"phet.joist.sim",null);if((!t||!t.display._accessible||!t.display.pdomRootElement.contains(e.target))&&(this.handleZoomCommands(e),KeyboardUtils.isArrowKey(e))){const n=new KeyPress(globalKeyStateTracker$1,this.getCurrentScale(),this._targetScale);this.repositionFromKeys(n)}}keydown(e){const t=e.domEvent;assert&&assert(t instanceof KeyboardEvent,"keydown event must be a KeyboardEvent"),this.cancelMiddlePress(),this.handleZoomCommands(t);const n=e.pointer.hasIntent(Intent.KEYBOARD_DRAG);if(KeyboardUtils.isArrowKey(t)&&!n){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener handle arrow key down"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const r=new KeyPress(globalKeyStateTracker$1,this.getCurrentScale(),this._targetScale);this.repositionFromKeys(r),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}}handleFocusChange(e,t){if(this._transformTracker&&(this._transformTracker.dispose(),this._transformTracker=null),t&&t.trail.lastNode()&&t.trail.lastNode().focusPanTargetBoundsProperty){const n=t.trail.lastNode().focusPanTargetBoundsProperty;assert&&assert(this._focusBoundsListener&&n.hasListener(this._focusBoundsListener),"Focus bounds listener should be linked to the previous Node"),n.unlink(this._focusBoundsListener),this._focusBoundsListener=null}if(e){const n=e.trail.lastNode();let r=e.trail;if(e.trail.containsNode(this._targetNode)){const a=e.trail.nodes.indexOf(this._targetNode),l=e.trail.nodes.length;r=e.trail.slice(a,l)}this._transformTracker=new TransformTracker$1(r);const s=()=>{if(this.getCurrentScale()>1){let a;if(n.focusPanTargetBoundsProperty){const l=n.focusPanTargetBoundsProperty.value;a=e.trail.localToGlobalBounds(l)}else a=e.trail.localToGlobalBounds(e.trail.lastNode().localBounds);this.keepBoundsInView(a,!0,n.limitPanDirection)}};this._transformTracker.addListener(s),n.focusPanTargetBoundsProperty&&(this._focusBoundsListener=s,n.focusPanTargetBoundsProperty.link(this._focusBoundsListener)),this.keepTrailInView(e.trail,n.limitPanDirection)}}handleZoomCommands(e){const t=KeyboardZoomUtils.isZoomCommand(e,!0),n=KeyboardZoomUtils.isZoomCommand(e,!1);if(t||n){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiPanZoomListener keyboard zoom in"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),e.preventDefault();const r=this.getNextDiscreteScale(t),s=new KeyPress(globalKeyStateTracker$1,r,this._targetScale);this.repositionFromKeys(s)}else KeyboardZoomUtils.isZoomResetCommand(e)&&(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener keyboard reset"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),e.preventDefault(),this.resetTransform(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop())}handleGestureStartEvent(e){this.gestureStartAction.execute(e)}handleGestureChangeEvent(e){this.gestureChangeAction.execute(e)}handleMiddlePress(e){const t=this.middlePress;assert&&assert(t,"MiddlePress must be defined to handle");const n=this.sourcePosition;if(assert&&assert(n,"sourcePosition must be defined to handle middle press, be sure to call initializePositions"),e>0){const s=t.pointer.point.minus(t.initialPoint),a=s.magnitude/100;a>0&&(s.setMagnitude(Math.min(a/e,MAX_SCROLL_VELOCITY*this._targetScale)),this.setDestinationPosition(n.plus(s)))}}translateScaleToTarget(e,t){const n=this._targetNode.globalToLocalPoint(e),r=this._targetNode.globalToParentPoint(e),s=Matrix3.translation(-n.x,-n.y),a=Matrix3.translation(r.x,r.y),l=this.limitScale(this.getCurrentScale()+t),d=a.timesMatrix(Matrix3.scaling(l)).timesMatrix(s);this.matrixProperty.set(d),this.correctReposition()}setTranslationScaleToTarget(e,t){const n=this._targetNode.globalToLocalPoint(e),r=this._targetNode.globalToParentPoint(e),s=Matrix3.translation(-n.x,-n.y),a=Matrix3.translation(r.x,r.y),l=this.limitScale(t),d=a.timesMatrix(Matrix3.scaling(l)).timesMatrix(s);this.matrixProperty.set(d),this.correctReposition()}translateDelta(e){const t=this._targetNode.globalToParentPoint(this._panBounds.center),n=t.plus(e);this.translateToTarget(n,t)}translateToTarget(e,t){const n=this._targetNode.globalToParentPoint(e),s=this._targetNode.globalToParentPoint(t).minus(n);this.matrixProperty.set(Matrix3.translationFromVector(s).timesMatrix(this._targetNode.getMatrix())),this.correctReposition()}repositionFromKeys(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener reposition from key press"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const t=this.sourcePosition;assert&&assert(t,"sourcePosition must be defined to handle key press, be sure to call initializePositions");const n=e.scale,r=this.getCurrentScale();n!==r?(this.setDestinationScale(n),this.scaleGestureTargetPosition=e.computeScaleTargetFromKeyPress()):e.translationVector.equals(Vector2.ZERO)||this.setDestinationPosition(t.plus(e.translationVector)),this.correctReposition(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}repositionFromWheel(e,t){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener reposition from wheel"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const n=t.domEvent;assert&&assert(n instanceof WheelEvent,"wheel event must be a WheelEvent");const r=this.sourcePosition;if(assert&&assert(r,"sourcePosition must be defined to handle wheel, be sure to call initializePositions"),n.preventDefault(),e.isCtrlKeyDown){const s=this.limitScale(this.getCurrentScale()+e.scaleDelta);this.scaleGestureTargetPosition=e.targetPoint,this.setDestinationScale(s)}else this.setDestinationPosition(r.plus(e.translationVector));this.correctReposition(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}correctReposition(){super.correctReposition(),this._panBounds.isFinite()&&(this._transformedPanBounds=this._panBounds.transformed(this._targetNode.matrix.inverted()),this.sourcePosition=this._transformedPanBounds.center,this.sourceScale=this.getCurrentScale())}addPress(e){super.addPress(e),this.stopInProgressAnimation()}removePress(e){super.removePress(e),this.middlePress&&(e.pointer.cursor=MOVE_CURSOR),this._presses.length===0&&this.stopInProgressAnimation()}interrupt(){this.cancelPanningDuringDrag(),this.cancelMiddlePress(),super.interrupt()}cancel(){this.interrupt()}hasDragIntent(e){return e.hasIntent(Intent.KEYBOARD_DRAG)||e.hasIntent(Intent.DRAG)}panToNode(e,t,n){assert&&assert(this._panBounds.isFinite(),"panBounds should be defined when panning."),this.keepBoundsInView(e.globalBounds,t,n)}keepBoundsInView(e,t,n){assert&&assert(this._panBounds.isFinite(),"panBounds should be defined when panning.");const r=this.sourcePosition;assert&&assert(r,"sourcePosition must be defined to handle keepBoundsInView, be sure to call initializePositions");const s=this._targetNode.globalToLocalBounds(e),a=new Vector2(0,0);let l=0,d=0,c=0,y=0;if(t)l=this._transformedPanBounds.centerX-s.centerX,d=this._transformedPanBounds.centerX-s.centerX,c=this._transformedPanBounds.centerY-s.centerY,y=this._transformedPanBounds.centerY-s.centerY;else if((n==="vertical"||s.width<this._transformedPanBounds.width)&&(n==="horizontal"||s.height<this._transformedPanBounds.height)){const D=150/this.getCurrentScale();l=this._transformedPanBounds.left-s.left+D,d=this._transformedPanBounds.right-s.right-D,c=this._transformedPanBounds.top-s.top+D,y=this._transformedPanBounds.bottom-s.bottom-D}n!=="vertical"&&(d<0&&(a.x=-d),l>0&&(a.x=-l)),n!=="horizontal"&&(y<0&&(a.y=-y),c>0&&(a.y=-c)),this.setDestinationPosition(r.plus(a))}keepTrailInView(e,t){if(this._panBounds.isFinite()&&e.lastNode().bounds.isFinite()){const n=e.localToGlobalBounds(e.lastNode().localBounds);this._panBounds.containsBounds(n)||this.keepBoundsInView(n,!0,t)}}animateToTargets(e){assert&&assert(this.boundsFinite,"initializePositions must be called at least once before animating");const t=this.sourcePosition;assert&&assert(t,"sourcePosition must be defined to animate, be sure to all initializePositions"),assert&&assert(t.isFinite(),"How can the source position not be a finite Vector2?");const n=this.destinationPosition;assert&&assert(n,"destinationPosition must be defined to animate, be sure to all initializePositions"),assert&&assert(n.isFinite(),"How can the destination position not be a finite Vector2?");const r=!n.equalsEpsilon(t,.1),s=!DotUtils.equalsEpsilon(this.sourceScale,this.destinationScale,.001);if(this.animatingProperty.value=r||s,this._presses.length===0||this.middlePress!==null){if(r){const a=n.minus(t);let l=a;a.magnitude!==0&&(l=a.normalized());const d=this.getTranslationSpeed(a.magnitude);scratchVelocityVector.setXY(d,d);const c=scratchVelocityVector.multiplyScalar(e),y=l.componentTimes(c);y.magnitude>a.magnitude&&y.set(a),assert&&assert(y.isFinite(),"Trying to translate with a non-finite Vector2"),this.translateDelta(y)}if(s){assert&&assert(this.scaleGestureTargetPosition,"there must be a scale target point");const a=this.destinationScale-this.sourceScale;let l=a*e*6;Math.abs(l)>Math.abs(a)&&(l=a),this.translateScaleToTarget(this.scaleGestureTargetPosition,l),this.setDestinationPosition(t)}else this.destinationScale!==this.sourceScale&&(assert&&assert(this.scaleGestureTargetPosition,"there must be a scale target point"),this.setTranslationScaleToTarget(this.scaleGestureTargetPosition,this.destinationScale),this.setDestinationPosition(t))}}stopInProgressAnimation(){this.boundsFinite&&this.sourcePosition&&(this.setDestinationScale(this.sourceScale),this.setDestinationPosition(this.sourcePosition))}initializePositions(){this.boundsFinite=this._transformedPanBounds.isFinite(),this.boundsFinite?(this.sourcePosition=this._transformedPanBounds.center,this.setDestinationPosition(this.sourcePosition)):(this.sourcePosition=null,this.destinationPosition=null)}setPanBounds(e){super.setPanBounds(e),this.initializePositions(),this._dragBounds=e.erodedXY(e.width*.1,e.height*.1),assert&&assert(this._dragBounds.hasNonzeroArea(),"drag bounds must have some width and height")}setTargetBounds(e){super.setTargetBounds(e),this.initializePositions()}setDestinationPosition(e){assert&&assert(this.boundsFinite,"bounds must be finite before setting destination positions"),assert&&assert(e.isFinite(),"provided destination position is not defined");const t=this.sourcePosition;assert&&assert(t,"sourcePosition must be defined to set destination position, be sure to call initializePositions"),scratchBounds.setMinMax(t.x-this._transformedPanBounds.left-this._panBounds.left,t.y-this._transformedPanBounds.top-this._panBounds.top,t.x+this._panBounds.right-this._transformedPanBounds.right,t.y+this._panBounds.bottom-this._transformedPanBounds.bottom),this.destinationPosition=scratchBounds.closestPointTo(e)}setDestinationScale(e){this.destinationScale=this.limitScale(e)}getTranslationSpeed(e){assert&&assert(e>=0,"distance for getTranslationSpeed should be a non-negative number");const t=e*this.getCurrentScale(),n=5,r=t*(1/(Math.pow(t,2)-Math.pow(n,2))+n);return Math.min(Math.abs(r),MAX_TRANSLATION_SPEED*this.getCurrentScale())}resetTransform(){super.resetTransform(),this.stopInProgressAnimation()}getNextDiscreteScale(e){const t=this.getCurrentScale();let n=null,r=Number.POSITIVE_INFINITY;for(let a=0;a<this.discreteScales.length;a++){const l=Math.abs(this.discreteScales[a]-t);l<r&&(r=l,n=a)}n=n,assert&&assert(n!==null,"nearestIndex should have been found");let s=e?n+1:n-1;return s=DotUtils.clamp(s,0,this.discreteScales.length-1),this.discreteScales[s]}dispose(){this.disposeAnimatedPanZoomListener()}}class KeyPress{constructor(e,t,n,r){const s=optionize()({translationMagnitude:80},r);let a=0;a+=e.isKeyDown(KeyboardUtils.KEY_RIGHT_ARROW)?1:0,a-=e.isKeyDown(KeyboardUtils.KEY_LEFT_ARROW)?1:0;let l=0;if(l+=e.isKeyDown(KeyboardUtils.KEY_DOWN_ARROW)?1:0,l-=e.isKeyDown(KeyboardUtils.KEY_UP_ARROW)?1:0,scratchTranslationVector.setXY(a,l),!scratchTranslationVector.equals(Vector2.ZERO)){const d=s.translationMagnitude*n;scratchTranslationVector.setMagnitude(d)}this.translationVector=scratchTranslationVector,this.scale=t}computeScaleTargetFromKeyPress(){scratchScaleTargetVector.setXY(0,0);const e=FocusManager.pdomFocusProperty.value;if(e){const t=e.trail,n=t.lastNode();n.bounds.isFinite()&&scratchScaleTargetVector.set(t.parentToGlobalPoint(n.center))}else{const t=PDOMUtils$1.getNextFocusable();if(t!==document.body){assert&&assert(document.body.contains(t),"focusable should be attached to the body");const n=t.offsetLeft+t.offsetWidth/2,r=t.offsetTop+t.offsetHeight/2;scratchScaleTargetVector.setXY(n,r)}}return assert&&assert(scratchScaleTargetVector.isFinite(),"target position not defined"),scratchScaleTargetVector}}class Wheel{constructor(e,t){const n=e.domEvent;assert&&assert(n instanceof WheelEvent,"SceneryEvent should have a DOMEvent from the wheel input"),this.isCtrlKeyDown=n.ctrlKey,this.scaleDelta=n.deltaY>0?-.5:.5,this.targetPoint=e.pointer.point;let r=n.deltaX*.5,s=n.deltaY*.5;n.deltaMode===window.WheelEvent.DOM_DELTA_LINE&&(r=r*25,s=s*25),this.translationVector=scratchTranslationVector.setXY(r*t,s*t)}}class MiddlePress{constructor(e,t){assert&&assert(e.type==="mouse","incorrect pointer type"),this.pointer=e,this.trail=t,this.initialPoint=e.point.copy()}}const calculateDiscreteScales=(o,e)=>{assert&&assert(o>=1,"min scales less than one are currently not supported");const t=8,n=[];for(let s=0;s<t;s++)n[s]=(e-o)/t*(s*s);const r=n[t-1];for(let s=0;s<n.length;s++)n[s]=o+n[s]*(e-o)/r;return n};scenery.register("AnimatedPanZoomListener",AnimatedPanZoomListener);class AnimatedPanZoomSingleton{constructor(){this._listener=null}initialize(e,t){this._listener=new AnimatedPanZoomListener(e,t)}dispose(){assert&&assert(this._listener,"No listener, call initialize first."),this._listener.dispose(),this._listener=null}get listener(){return assert&&assert(this._listener,"No listener, call initialize first."),this._listener}get initialized(){return!!this._listener}}const animatedPanZoomSingleton=new AnimatedPanZoomSingleton;scenery.register("animatedPanZoomSingleton",animatedPanZoomSingleton);class HandleDownlistener{down(e){e.handle()}}scenery.register("HandleDownlistener",HandleDownlistener);const KEYBOARD_DRAG_DIRECTION_KEY_MAP=new Map([["both",{left:[KeyboardUtils.KEY_A,KeyboardUtils.KEY_LEFT_ARROW],right:[KeyboardUtils.KEY_RIGHT_ARROW,KeyboardUtils.KEY_D],up:[KeyboardUtils.KEY_UP_ARROW,KeyboardUtils.KEY_W],down:[KeyboardUtils.KEY_DOWN_ARROW,KeyboardUtils.KEY_S]}],["leftRight",{left:[KeyboardUtils.KEY_A,KeyboardUtils.KEY_LEFT_ARROW,KeyboardUtils.KEY_DOWN_ARROW,KeyboardUtils.KEY_S],right:[KeyboardUtils.KEY_RIGHT_ARROW,KeyboardUtils.KEY_D,KeyboardUtils.KEY_UP_ARROW,KeyboardUtils.KEY_W],up:[],down:[]}],["upDown",{left:[],right:[],up:[KeyboardUtils.KEY_RIGHT_ARROW,KeyboardUtils.KEY_D,KeyboardUtils.KEY_UP_ARROW,KeyboardUtils.KEY_W],down:[KeyboardUtils.KEY_A,KeyboardUtils.KEY_LEFT_ARROW,KeyboardUtils.KEY_DOWN_ARROW,KeyboardUtils.KEY_S]}]]);class KeyboardDragListener extends EnabledComponent{constructor(e){assert&&assertMutuallyExclusiveOptions(e,["dragSpeed","shiftDragSpeed"],["dragDelta","shiftDragDelta"]),assert&&assertMutuallyExclusiveOptions(e,["mapPosition"],["dragBoundsProperty"]);const t=optionize()({dragDelta:10,shiftDragDelta:5,dragSpeed:0,shiftDragSpeed:0,keyboardDragDirection:"both",positionProperty:null,transform:null,dragBoundsProperty:null,mapPosition:null,start:null,drag:null,end:null,moveOnHoldDelay:0,moveOnHoldInterval:1e3/60,hotkeyHoldInterval:800,phetioEnabledPropertyInstrumented:!1,tandem:Tandem.REQUIRED,phetioReadOnly:!0},e);assert&&assert(t.shiftDragSpeed<=t.dragSpeed,"shiftDragSpeed should be less than or equal to shiftDragSpeed, it is intended to provide more fine-grained control"),assert&&assert(t.shiftDragDelta<=t.dragDelta,"shiftDragDelta should be less than or equal to dragDelta, it is intended to provide more fine-grained control"),super(t),this._start=t.start,this._drag=t.drag,this._end=t.end,this._dragBoundsProperty=t.dragBoundsProperty||new Property(null),this._mapPosition=t.mapPosition,this._transform=t.transform,this._positionProperty=t.positionProperty,this._dragSpeed=t.dragSpeed,this._shiftDragSpeed=t.shiftDragSpeed,this._dragDelta=t.dragDelta,this._shiftDragDelta=t.shiftDragDelta,this._moveOnHoldDelay=t.moveOnHoldDelay,this.moveOnHoldInterval=t.moveOnHoldInterval,this._hotkeyHoldInterval=t.hotkeyHoldInterval,this._keyboardDragDirection=t.keyboardDragDirection,this.isPressedProperty=new BooleanProperty(!1,{reentrant:!0}),this.keyState=[],this._hotkeys=[],this.currentHotkey=null,this.hotkeyDisablingDragging=!1,this.hotkeyHoldIntervalCounter=this._hotkeyHoldInterval,this.useDragSpeed=t.dragSpeed>0||t.shiftDragSpeed>0,this.moveOnHoldDelayCounter=0,this.moveOnHoldIntervalCounter=0,this.delayComplete=!1,this.dragStartAction=new PhetioAction$1(r=>{const s=KeyboardUtils.getEventCode(r.domEvent);if(assert&&assert(s,"How can we have a null key for KeyboardDragListener?"),!this.movementKeysDown&&KeyboardUtils.isMovementKey(r.domEvent)&&(assert&&assert(this._pointer===null,"We should have cleared the Pointer reference by now."),this._pointer=r.pointer,r.pointer.addInputListener(this._pointerListener,!0),this.isPressedProperty.value=!0),this.keyState.push({keyDown:!0,key:s,timeDown:0}),this._start&&this.movementKeysDown&&this._start(r),!this.useDragSpeed){const a=this.shiftKeyDown()?this._shiftDragDelta:this._dragDelta;this.updatePosition(a),this.moveOnHoldIntervalCounter=0}},{parameters:[{name:"event",phetioType:SceneryEvent.SceneryEventIO}],tandem:t.tandem.createTandem("dragStartAction"),phetioDocumentation:"Emits whenever a keyboard drag starts.",phetioReadOnly:t.phetioReadOnly,phetioEventType:EventType.USER}),this.dragEmitter=new Emitter({tandem:t.tandem.createTandem("dragEmitter"),phetioHighFrequency:!0,phetioDocumentation:"Emits whenever a keyboard drag occurs.",phetioReadOnly:t.phetioReadOnly,phetioEventType:EventType.USER}),this.dragEndAction=new PhetioAction$1(r=>{this.movementKeysDown||(assert&&assert(r.pointer===this._pointer,"How could the event Pointer be anything other than this PDOMPointer?"),this._pointer.removeInputListener(this._pointerListener),this._pointer=null,this.isPressedProperty.value=!1),this._end&&this._end(r)},{parameters:[{name:"event",phetioType:SceneryEvent.SceneryEventIO}],tandem:t.tandem.createTandem("dragEndAction"),phetioDocumentation:"Emits whenever a keyboard drag ends.",phetioReadOnly:t.phetioReadOnly,phetioEventType:EventType.USER});const n=this.step.bind(this);stepTimer.addListener(n),this.enabledProperty.lazyLink(this.onEnabledPropertyChange.bind(this)),this._pointerListener={listener:this,interrupt:this.interrupt.bind(this)},this._pointer=null,this._disposeKeyboardDragListener=()=>{stepTimer.removeListener(n),this.isPressedProperty.dispose()}}getDragBounds(){return this._dragBoundsProperty.value}get dragBounds(){return this.getDragBounds()}setTransform(e){this._transform=e}set transform(e){this.setTransform(e)}get transform(){return this.getTransform()}getTransform(){return this._transform}get dragSpeed(){return this._dragSpeed}set dragSpeed(e){this._dragSpeed=e}get shiftDragSpeed(){return this._shiftDragSpeed}set shiftDragSpeed(e){this._shiftDragSpeed=e}get dragDelta(){return this._dragDelta}set dragDelta(e){this._dragDelta=e}get shiftDragDelta(){return this._shiftDragDelta}set shiftDragDelta(e){this._shiftDragDelta=e}get moveOnHoldDelay(){return this._moveOnHoldDelay}set moveOnHoldDelay(e){this._moveOnHoldDelay=e}get moveOnHoldInterval(){return this._moveOnHoldInterval}set moveOnHoldInterval(e){assert&&assert(e>0,"if the moveOnHoldInterval is 0, then the dragging will be dependent on how often the dragListener is stepped"),this._moveOnHoldInterval=e}get hotkeyHoldInterval(){return this._hotkeyHoldInterval}set hotkeyHoldInterval(e){this._hotkeyHoldInterval=e}get isPressed(){return!!this._pointer}getCurrentTarget(){return assert&&assert(this.isPressed,"We have no currentTarget if we are not pressed"),assert&&assert(this._pointer&&this._pointer.trail,"Must have a Pointer with an active trail if we are pressed"),this._pointer.trail.lastNode()}onEnabledPropertyChange(e){!e&&this.interrupt()}keydown(e){const t=e.domEvent,n=KeyboardUtils.getEventCode(t);if(assert&&assert(n,"How can we have a null key from a keydown in KeyboardDragListener?"),!t.metaKey&&(KeyboardUtils.isMovementKey(t)&&t.preventDefault(),e.pointer.reserveForKeyboardDrag(),!this.keyInListDown([n]))){if(platform.safari&&KeyboardUtils.isArrowKey(t)&&this.keyInListDown([KeyboardUtils.KEY_RIGHT_ARROW,KeyboardUtils.KEY_LEFT_ARROW,KeyboardUtils.KEY_UP_ARROW,KeyboardUtils.KEY_DOWN_ARROW])){this.interrupt();return}this.canDrag(e)&&this.dragStartAction.execute(e)}}keyup(e){const t=e.domEvent,n=KeyboardUtils.getEventCode(t),r=this.movementKeysDown;n===KeyboardUtils.KEY_TAB&&t.shiftKey&&this.keyState.push({keyDown:!0,key:KeyboardUtils.KEY_SHIFT_LEFT,timeDown:0});for(let a=0;a<this.keyState.length;a++)n===this.keyState[a].key&&this.keyState.splice(a,1);const s=this.movementKeysDown;!s&&r!==s&&this.dragEndAction.execute(e),this.currentHotkey&&!this.allKeysInListDown(this.currentHotkey.keys)&&this.resetHotkeyState(),this.resetPressAndHold()}focusout(e){this.interrupt()}step(e){const t=e*1e3;if(this.keyState.length>0){for(let r=0;r<this.keyState.length;r++)this.keyState[r].keyDown&&(this.keyState[r].timeDown+=t);this.movementKeysDown&&(this.moveOnHoldDelayCounter+=t,this.moveOnHoldIntervalCounter+=t),this.currentHotkey&&(this.hotkeyHoldIntervalCounter+=t);let n=0;if(this.useDragSpeed){const s=(this.shiftKeyDown()?this._shiftDragSpeed:this._dragSpeed)/1e3;n=t*s}else{let r=!1;if(this.moveOnHoldDelayCounter>=this._moveOnHoldDelay&&!this.delayComplete&&(r=!0,this.delayComplete=!0,this.moveOnHoldIntervalCounter=0),this.delayComplete&&this.moveOnHoldIntervalCounter>=this._moveOnHoldInterval){r=!0;const s=this.moveOnHoldIntervalCounter-this._moveOnHoldInterval;this.moveOnHoldIntervalCounter=s}n=r?this.shiftKeyDown()?this._shiftDragDelta:this._dragDelta:0}n>0&&this.updatePosition(n)}}canDrag(e){const t=e.pointer.attachedListener;return this.enabledProperty.value&&(!t||t===this._pointerListener)}updateHotkeys(){for(let e=0;e<this._hotkeys.length;e++){const t=[],n=this._hotkeys[e].keys;for(let s=0;s<n.length;s++)for(let a=0;a<this.keyState.length;a++)this.keyState[a].key===n[s]&&t.push(this.keyState[a]);let r=t.length===1&&n.length===1;for(let s=0;s<t.length-1;s++)t[s+1]&&t[s].timeDown>t[s+1].timeDown&&(r=!0);r&&(this.currentHotkey=this._hotkeys[e],this.hotkeyHoldIntervalCounter>=this._hotkeyHoldInterval&&(this.hotkeyHoldIntervalCounter=0,this._hotkeys[e].callback()))}this.currentHotkey&&(this.keyInListDown(this.currentHotkey.keys)?this.hotkeyDisablingDragging=!0:(this.hotkeyDisablingDragging=!1,this.currentHotkey=null))}updatePosition(e){if(this.updateHotkeys(),!this.hotkeyDisablingDragging){let t=0,n=0;this.leftMovementKeysDown()&&(t-=e),this.rightMovementKeysDown()&&(t+=e),this.upMovementKeysDown()&&(n-=e),this.downMovementKeysDown()&&(n+=e);let r=new Vector2(t,n);if(!r.equals(Vector2.ZERO)){if(this._transform&&(r=(this._transform instanceof Transform3?this._transform:this._transform.value).inverseDelta2(r)),this._positionProperty){let s=this._positionProperty.value.plus(r);s=this.mapModelPoint(s),s.equals(this._positionProperty.value)||(this._positionProperty.value=s)}this._drag&&this._drag(r,this),this.dragEmitter.emit()}}}mapModelPoint(e){return this._mapPosition?this._mapPosition(e):this._dragBoundsProperty.value?this._dragBoundsProperty.value.closestPointTo(e):e}keyInListDown(e){let t=!1;for(let n=0;n<this.keyState.length;n++){if(this.keyState[n].keyDown){for(let r=0;r<e.length;r++)if(e[r]===this.keyState[n].key){t=!0;break}}if(t)break}return t}allKeysInListDown(e){assert&&assert(e.length>0,"You are testing to see if an empty list of keys is down?");let t=!0;for(let n=0;n<e.length;n++){const r=_.find(this.keyState,s=>s.key===e[n]);if(!r||!r.keyDown){t=!1;break}}return t}getKeyboardDragDirectionKeys(){const e=KEYBOARD_DRAG_DIRECTION_KEY_MAP.get(this._keyboardDragDirection);return assert&&assert(e,`No direction keys found in map for KeyboardDragDirection ${this._keyboardDragDirection}`),e}leftMovementKeysDown(){return this.keyInListDown(this.getKeyboardDragDirectionKeys().left)}rightMovementKeysDown(){return this.keyInListDown(this.getKeyboardDragDirectionKeys().right)}upMovementKeysDown(){return this.keyInListDown(this.getKeyboardDragDirectionKeys().up)}downMovementKeysDown(){return this.keyInListDown(this.getKeyboardDragDirectionKeys().down)}getMovementKeysDown(){return this.rightMovementKeysDown()||this.leftMovementKeysDown()||this.upMovementKeysDown()||this.downMovementKeysDown()}get movementKeysDown(){return this.getMovementKeysDown()}enterKeyDown(){return this.keyInListDown([KeyboardUtils.KEY_ENTER])}shiftKeyDown(){return this.keyInListDown(KeyboardUtils.SHIFT_KEYS)}addHotkey(e){this._hotkeys.push(e)}removeHotkey(e){assert&&assert(this._hotkeys.includes(e),"Trying to remove a hotkey that is not in the list of hotkeys.");const t=this._hotkeys.indexOf(e);this._hotkeys.splice(t,1)}setHotkeys(e){this._hotkeys=e.slice(0)}set hotkeys(e){this.setHotkeys(e)}removeAllHotkeys(){this._hotkeys=[]}resetPressAndHold(){this.delayComplete=!1,this.moveOnHoldDelayCounter=0,this.moveOnHoldIntervalCounter=0}resetHotkeyState(){this.currentHotkey=null,this.hotkeyHoldIntervalCounter=this._hotkeyHoldInterval,this.hotkeyDisablingDragging=!1}interrupt(){this.keyState=[],this.resetHotkeyState(),this.resetPressAndHold(),this._pointer&&(assert&&assert(this._pointer.listeners.includes(this._pointerListener),"A reference to the Pointer means it should have the pointerListener"),this._pointer.removeInputListener(this._pointerListener),this._pointer=null,this.isPressedProperty.value=!1,this._end&&this._end())}dispose(){this.interrupt(),this._disposeKeyboardDragListener(),super.dispose()}static isLeftMovementKey(e){return e===KeyboardUtils.KEY_A||e===KeyboardUtils.KEY_LEFT_ARROW}static isRightMovementKey(e){return e===KeyboardUtils.KEY_D||e===KeyboardUtils.KEY_RIGHT_ARROW}static isUpMovementKey(e){return e===KeyboardUtils.KEY_W||e===KeyboardUtils.KEY_UP_ARROW}static isDownMovementKey(e){return e===KeyboardUtils.KEY_S||e===KeyboardUtils.KEY_DOWN_ARROW}}scenery.register("KeyboardDragListener",KeyboardDragListener);const KeyboardDragListener$1=KeyboardDragListener;class KeyboardListener{constructor(e){const t=optionize()({callback:_.noop,cancel:_.noop,focus:_.noop,blur:_.noop,global:!1,capture:!1,handle:!1,abort:!1,listenerFireTrigger:"down",fireOnHold:!1,fireOnHoldDelay:400,fireOnHoldInterval:100},e);this._callback=t.callback,this._cancel=t.cancel,this._focus=t.focus,this._blur=t.blur,this._listenerFireTrigger=t.listenerFireTrigger,this._fireOnHold=t.fireOnHold,this._fireOnHoldDelay=t.fireOnHoldDelay,this._fireOnHoldInterval=t.fireOnHoldInterval,this._activeKeyGroups=[],this.keysDown=!1,this._global=t.global,this._handle=t.handle,this._abort=t.abort,this._keyGroups=this.convertKeysToKeyGroups(t.keys),this.listener=this,this.capture=t.capture,this._windowFocusListener=this.handleWindowFocusChange.bind(this),FocusManager.windowHasFocusProperty.link(this._windowFocusListener)}fireCallback(e,t){this._callback(e,t.naturalKeys,this)}handleKeyDown(e){(this._listenerFireTrigger==="down"||this._listenerFireTrigger==="both")&&this._keyGroups.forEach(t=>{this._activeKeyGroups.includes(t)||this.areKeysDownForListener(t)&&t.keys.includes(globalKeyStateTracker$1.getLastKeyDown())&&(this._activeKeyGroups.push(t),this.keysDown=!0,e.pointer.reserveForKeyboardDrag(),t.timer&&t.timer.start(),this.fireCallback(e,t))}),this.manageEvent(e)}handleKeyUp(e){if(this._activeKeyGroups.length>0&&this._activeKeyGroups.forEach((t,n)=>{this.areKeysDownForListener(t)||(t.timer&&t.timer.stop(!1),this._activeKeyGroups.splice(n,1))}),this._listenerFireTrigger==="up"||this._listenerFireTrigger==="both"){const t=KeyboardUtils.getEventCode(e.domEvent);t&&this._keyGroups.forEach(n=>{this.areModifierKeysDownForListener(n)&&n.keys.includes(t)&&(this.keysDown=!1,this.fireCallback(e,n))})}this.manageEvent(e)}getDownModifierKeys(e){const t=e.modifierKeys,n=[];return t.forEach(r=>{for(const s of r)if(globalKeyStateTracker$1.isKeyDown(s)){n.push(s);break}}),n}areKeysDownForListener(e){const t=this.getDownModifierKeys(e),n=t.length===e.modifierKeys.length,r=e.keys.find(s=>globalKeyStateTracker$1.isKeyDown(s));if(n&&r){const s=[...t,r];return globalKeyStateTracker$1.areKeysDownWithoutExtraModifiers(s)}else return!1}areModifierKeysDownForListener(e){const t=this.getDownModifierKeys(e);return t.length===e.modifierKeys.length?globalKeyStateTracker$1.areKeysDownWithoutExtraModifiers(t):!1}manageEvent(e){this._handle&&e.handle(),this._abort&&e.abort()}keydown(e){this._global||this.handleKeyDown(e)}keyup(e){this._global||this.handleKeyUp(e)}globalkeydown(e){this._global&&this.handleKeyDown(e)}globalkeyup(e){this._global&&this.handleKeyUp(e)}handleCancel(){this.clearActiveKeyGroups(),this._cancel(this)}handleWindowFocusChange(e){e||this.handleCancel()}cancel(){this.handleCancel()}interrupt(){this.handleCancel()}focusout(e){this.interrupt(),this._blur(this)}focusin(e){this._focus(this)}dispose(){this._keyGroups.forEach(e=>{e.timer&&e.timer.dispose()}),this._keyGroups.length=0,FocusManager.windowHasFocusProperty.unlink(this._windowFocusListener)}clearActiveKeyGroups(){this._activeKeyGroups.forEach(e=>{e.timer&&e.timer.stop(!1)}),this._activeKeyGroups.length=0}convertKeysToKeyGroups(e){return e.map(n=>{const r=n.split("+");assert&&assert(r.length>0,"no keys provided?");const s=r.slice(-1)[0],a=EnglishStringToCodeMap[s];assert&&assert(a,`Codes were not found, do you need to add it to EnglishStringToCodeMap? ${s}`);let l=[];r.length>1&&(l=r.slice(0,r.length-1).map(m=>{const O=EnglishStringToCodeMap[m];return assert&&assert(O,`Key not found, do you need to add it to EnglishStringToCodeMap? ${m}`),O}));const d=this._fireOnHold?new CallbackTimer({callback:()=>this.fireCallback(null,c),delay:this._fireOnHoldDelay,interval:this._fireOnHoldInterval}):null,c={keys:a,modifierKeys:l,naturalKeys:n,timer:d};return c})}static eventCodeToEnglishString(e){for(const t in EnglishStringToCodeMap)if(EnglishStringToCodeMap.hasOwnProperty(t)&&EnglishStringToCodeMap[t].includes(e))return t;return null}}scenery.register("KeyboardListener",KeyboardListener);const SpriteListenable=memoize(o=>(assert&&assert(_.includes(inheritance(o),PressListener),"Only PressListener subtypes should mix SpriteListenable"),class extends o{constructor(...e){super(...e),this.spriteInstance=null}press(e,t,n){if(this.isPressed)return!1;if(this.spriteInstance=null,e.currentTarget instanceof Sprites){const r=e.currentTarget;this.spriteInstance=r.getSpriteInstanceFromPoint(r.globalToLocalPoint(e.pointer.point))}return this.spriteInstance?super.press(e,t,n):!1}}));scenery.register("SpriteListenable",SpriteListenable);const PRESS_AND_HOLD_INTERVAL=.75,DOUBLE_TAP_INTERVAL=.6;class SwipeListener{constructor(e){this._pointer=null,this.downPoint=null,this.downEvent=null,this.enabled=!1,this.lastPoint=null,this.currentPoint=null,this.velocity=null,this.swipeDistance=null,this.firstUp=!1,this.timeSinceLastDown=0,this.downPointers=[],this.holdingTime=0,this.focusedNode=null,this.handleEventListener={down:t=>{t.handle(),t.abort(),this.handleDown(t)}},e.pointerAddedEmitter.addListener(t=>{this.enabled&&t.addInputListener(this.handleEventListener,!0)}),this._attachedPointerListener={up:t=>{this.focusedNode&&this.focusedNode.swipeEnd&&this.focusedNode.swipeEnd.bind(this.focusedNode)(t,this),this.focusedNode=null,this._pointer.removeInputListener(this._attachedPointerListener),this._pointer=null},move:t=>{this.focusedNode&&this.focusedNode.swipeMove&&this.focusedNode.swipeMove.bind(this.focusedNode)(t,this)},interrupt:t=>{this.focusedNode=null,this._pointer.removeInputListener(this._attachedPointerListener),this._pointer=null},cancel:t=>{this.focusedNode=null,this._pointer.removeInputListener(this._attachedPointerListener),this._pointer=null}},this._pointerListener={up:t=>{this.endSwipe(),this._pointer=null,this.swipeDistance=t.pointer.point.minus(this.downPoint);const n=this.swipeDistance.y,r=this.swipeDistance.x;if(Math.abs(r)>100&&Math.abs(n)<100)if(r>0){if(FocusManager.pdomFocusedNode&&FocusManager.pdomFocusedNode.innerContent==="Reset All")return;PDOMUtils$1.getNextFocusable(document.body).focus()}else PDOMUtils$1.getPreviousFocusable(document.body).focus();else if(this.firstUp){if(this.timeSinceLastDown<DOUBLE_TAP_INTERVAL){this.firstUp=!1,this.timeSinceLastDown=0;const s=document.getElementsByClassName("a11y-pdom-root")[0];s&&s.contains(t.activeElement)&&t.activeElement.click()}}else this.firstUp=!0},move:t=>{this.lastPoint=this.currentPoint,this.currentPoint=t.pointer.point},interrupt:()=>{this.interrupt()},cancel:()=>{this.interrupt()}},stepTimer.addListener(this.step.bind(this))}handleDown(e){e.pointer.addIntent(Intent.DRAG),this.downPointers.push(e.pointer),this.downPointers.length>1&&(this.downPointers.forEach(t=>t.removeIntent(Intent.DRAG)),e.pointer.removeIntent(Intent.DRAG)),assert&&assert(e.pointer.attachedProperty.get(),"should be attached to the handle listener"),e.pointer.removeInputListener(this.handleEventListener),this._pointer===null&&e.pointer.type==="touch"&&(this._pointer=e.pointer,e.pointer.addInputListener(this._pointerListener,!0),e.abort(),this.downEvent=e,this.downPoint=e.pointer.point,this.currentPoint=this.downPoint.copy(),this.previousPoint=this.currentPoint.copy())}up(e){const t=this.downPointers.indexOf(e.pointer);t>-1&&this.downPointers.splice(t,1)}step(e){if(this.firstUp&&(this.timeSinceLastDown+=e,this.timeSinceLastDown>DOUBLE_TAP_INTERVAL&&(this.firstUp=!1,this.timeSinceLastDown=0)),this._pointer&&!this._pointer.listeners.includes(this._attachedPointerListener))if(this.holdingTime>PRESS_AND_HOLD_INTERVAL){const t=FocusManager.pdomFocusedNode;t&&(this._pointer.removeInputListener(this._pointerListener),this.holdingTime=0,this.focusedNode=t,this._pointer.addInputListener(this._attachedPointerListener,!0),this.focusedNode.swipeStart&&this.focusedNode.swipeStart(this.downEvent,this),this.downEvent=null)}else this.holdingTime+=e;this.lastPoint!==null&&this.currentPoint!==null&&(this.velocity=this.lastPoint.minus(this.currentPoint).dividedScalar(e))}endSwipe(){this.holdingTime=0,this._pointer&&this._pointer.listeners.includes(this._pointerListener)&&this._pointer.removeInputListener(this._pointerListener)}detachPointerListener(){this._pointer.detach(this._attachedPointerListener)}interrupt(){this.endSwipe(),this._pointer=null,this.downEvent=null}}scenery.register("SwipeListener",SwipeListener);const LayoutOrientationValues=["horizontal","vertical"],HorizontalLayoutAlignValues=["left","right","center","origin"],VerticalLayoutAlignValues=["top","bottom","center","origin"],sr=class sr extends EnumerationValue{constructor(e,t,n=Number.POSITIVE_INFINITY){super(),this.horizontal=e,this.vertical=t,this.padRatio=n}static getAllowedAligns(e){return[...e===Orientation.HORIZONTAL?HorizontalLayoutAlignValues:VerticalLayoutAlignValues,null]}static alignToInternal(e,t){return e===Orientation.HORIZONTAL?sr.horizontalAlignToInternal(t):sr.verticalAlignToInternal(t)}static horizontalAlignToInternal(e){return e===null?null:(assert&&assert(horizontalAlignMap[e]),horizontalAlignMap[e])}static verticalAlignToInternal(e){return e===null?null:(assert&&assert(verticalAlignMap[e]),verticalAlignMap[e])}static internalToAlign(e,t){return t===null?null:e===Orientation.HORIZONTAL?t.horizontal:t.vertical}};sr.START=new sr("left","top",0),sr.END=new sr("right","bottom",1),sr.CENTER=new sr("center","center",.5),sr.ORIGIN=new sr("origin","origin"),sr.enumeration=new Enumeration(sr,{phetioDocumentation:"Alignment for layout containers"});let LayoutAlign=sr;const horizontalAlignMap={left:LayoutAlign.START,right:LayoutAlign.END,center:LayoutAlign.CENTER,origin:LayoutAlign.ORIGIN},verticalAlignMap={top:LayoutAlign.START,bottom:LayoutAlign.END,center:LayoutAlign.CENTER,origin:LayoutAlign.ORIGIN};scenery.register("LayoutAlign",LayoutAlign);const HorizontalLayoutJustificationValues=["left","right","center","spaceBetween","spaceAround","spaceEvenly"],VerticalLayoutJustificationValues=["top","bottom","center","spaceBetween","spaceAround","spaceEvenly"],Dn=class Dn extends EnumerationValue{constructor(e,t,n){super(),this.spacingFunctionFactory=e,this.horizontal=t,this.vertical=n}static getAllowedJustificationValues(e){return e===Orientation.HORIZONTAL?HorizontalLayoutJustificationValues:VerticalLayoutJustificationValues}static justifyToInternal(e,t){return e===Orientation.HORIZONTAL?(assert&&assert(horizontalJustificationMap[t]),horizontalJustificationMap[t]):(assert&&assert(verticalJustificationMap[t]),verticalJustificationMap[t])}static internalToJustify(e,t){return e===Orientation.HORIZONTAL?t.horizontal:t.vertical}};Dn.START=new Dn(()=>()=>0,"left","top"),Dn.END=new Dn(e=>t=>t===0?e:0,"right","bottom"),Dn.CENTER=new Dn(e=>t=>t===0?e/2:0,"center","center"),Dn.SPACE_BETWEEN=new Dn((e,t)=>n=>n!==0?e/(t-1):0,"spaceBetween","spaceBetween"),Dn.SPACE_AROUND=new Dn((e,t)=>n=>(n!==0?2:1)*e/(2*t),"spaceAround","spaceAround"),Dn.SPACE_EVENLY=new Dn((e,t)=>n=>e/(t+1),"spaceEvenly","spaceEvenly"),Dn.enumeration=new Enumeration(Dn,{phetioDocumentation:"Justify for layout containers"});let LayoutJustification=Dn;const horizontalJustificationMap={left:LayoutJustification.START,right:LayoutJustification.END,center:LayoutJustification.CENTER,spaceBetween:LayoutJustification.SPACE_BETWEEN,spaceAround:LayoutJustification.SPACE_AROUND,spaceEvenly:LayoutJustification.SPACE_EVENLY},verticalJustificationMap={top:LayoutJustification.START,bottom:LayoutJustification.END,center:LayoutJustification.CENTER,spaceBetween:LayoutJustification.SPACE_BETWEEN,spaceAround:LayoutJustification.SPACE_AROUND,spaceEvenly:LayoutJustification.SPACE_EVENLY};scenery.register("LayoutJustification",LayoutJustification);const DEFAULT_SEPARATOR_LAYOUT_OPTIONS={stretch:!0,isSeparator:!0};class Separator extends Line{constructor(e){super(optionize()({layoutOptions:DEFAULT_SEPARATOR_LAYOUT_OPTIONS,stroke:"rgb(100,100,100)"},e))}}scenery.register("Separator",Separator);class VSeparator extends HeightSizable(Separator){constructor(e){super(),this.localPreferredHeightProperty.link(t=>{t!==null&&(this.y2=t)}),this.mutate(e)}}scenery.register("VSeparator",VSeparator);class HSeparator extends WidthSizable(Separator){constructor(e){super(),this.localPreferredWidthProperty.link(t=>{t!==null&&(this.x2=t)}),this.mutate(e)}}scenery.register("HSeparator",HSeparator);const ql=class ql{constructor(e){this.initialize(e)}initialize(e){return this.trail=e,this}checkPreconditions(){assert&&assert(this.trail,"Should not be disposed"),assert&&assert(this.trail.getParentMatrix().isAxisAligned(),"Transforms with LayoutProxy need to be axis-aligned")}get node(){return assert&&this.checkPreconditions(),this.trail.lastNode()}get bounds(){return assert&&this.checkPreconditions(),this.trail.parentToGlobalBounds(this.node.bounds)}get visibleBounds(){return assert&&this.checkPreconditions(),this.trail.parentToGlobalBounds(this.node.visibleBounds)}get width(){return this.bounds.width}get height(){return this.bounds.height}get x(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformX(this.node.x)}set x(e){assert&&this.checkPreconditions(),this.node.x=this.trail.getParentTransform().inverseX(e)}get y(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformY(this.node.y)}set y(e){assert&&this.checkPreconditions(),this.node.y=this.trail.getParentTransform().inverseY(e)}get translation(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.translation)}set translation(e){assert&&this.checkPreconditions(),this.node.translation=this.trail.getParentTransform().inversePosition2(e)}get left(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformX(this.node.left)}set left(e){this.node.left=this.trail.getParentTransform().inverseX(e)}get right(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformX(this.node.right)}set right(e){assert&&this.checkPreconditions(),this.node.right=this.trail.getParentTransform().inverseX(e)}get centerX(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformX(this.node.centerX)}set centerX(e){assert&&this.checkPreconditions(),this.node.centerX=this.trail.getParentTransform().inverseX(e)}get top(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformY(this.node.top)}set top(e){assert&&this.checkPreconditions(),this.node.top=this.trail.getParentTransform().inverseY(e)}get bottom(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformY(this.node.bottom)}set bottom(e){assert&&this.checkPreconditions(),this.node.bottom=this.trail.getParentTransform().inverseY(e)}get centerY(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformY(this.node.centerY)}set centerY(e){assert&&this.checkPreconditions(),this.node.centerY=this.trail.getParentTransform().inverseY(e)}get leftTop(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.leftTop)}set leftTop(e){assert&&this.checkPreconditions(),this.node.leftTop=this.trail.getParentTransform().inversePosition2(e)}get centerTop(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.centerTop)}set centerTop(e){assert&&this.checkPreconditions(),this.node.centerTop=this.trail.getParentTransform().inversePosition2(e)}get rightTop(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.rightTop)}set rightTop(e){assert&&this.checkPreconditions(),this.node.rightTop=this.trail.getParentTransform().inversePosition2(e)}get leftCenter(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.leftCenter)}set leftCenter(e){assert&&this.checkPreconditions(),this.node.leftCenter=this.trail.getParentTransform().inversePosition2(e)}get center(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.center)}set center(e){assert&&this.checkPreconditions(),this.node.center=this.trail.getParentTransform().inversePosition2(e)}get rightCenter(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.rightCenter)}set rightCenter(e){assert&&this.checkPreconditions(),this.node.rightCenter=this.trail.getParentTransform().inversePosition2(e)}get leftBottom(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.leftBottom)}set leftBottom(e){assert&&this.checkPreconditions(),this.node.leftBottom=this.trail.getParentTransform().inversePosition2(e)}get centerBottom(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.centerBottom)}set centerBottom(e){assert&&this.checkPreconditions(),this.node.centerBottom=this.trail.getParentTransform().inversePosition2(e)}get rightBottom(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.rightBottom)}set rightBottom(e){assert&&this.checkPreconditions(),this.node.rightBottom=this.trail.getParentTransform().inversePosition2(e)}get widthSizable(){return this.node.widthSizable}get heightSizable(){return this.node.heightSizable}get preferredWidth(){assert&&this.checkPreconditions(),assert&&assert(isWidthSizable(this.node));const e=this.node.preferredWidth;return e===null?null:Math.abs(this.trail.getParentTransform().transformDeltaX(e))}set preferredWidth(e){assert&&this.checkPreconditions(),assert&&assert(isWidthSizable(this.node)),this.node.preferredWidth=e===null?null:Math.abs(this.trail.getParentTransform().inverseDeltaX(e))}get preferredHeight(){assert&&this.checkPreconditions(),assert&&assert(isHeightSizable(this.node));const e=this.node.preferredHeight;return e===null?null:Math.abs(this.trail.getParentTransform().transformDeltaY(e))}set preferredHeight(e){assert&&this.checkPreconditions(),assert&&assert(isHeightSizable(this.node)),this.node.preferredHeight=e===null?null:Math.abs(this.trail.getParentTransform().inverseDeltaY(e))}get minimumWidth(){assert&&this.checkPreconditions();const e=isWidthSizable(this.node)?this.node.minimumWidth||0:this.node.width;return Math.abs(this.trail.getParentTransform().transformDeltaX(e))}get minimumHeight(){assert&&this.checkPreconditions();const e=isHeightSizable(this.node)?this.node.minimumHeight||0:this.node.height;return Math.abs(this.trail.getParentTransform().transformDeltaY(e))}getMinimum(e){return e===Orientation.HORIZONTAL?this.minimumWidth:this.minimumHeight}get maxWidth(){return assert&&this.checkPreconditions(),this.node.maxWidth===null?null:Math.abs(this.trail.getParentTransform().transformDeltaX(this.node.maxWidth))}set maxWidth(e){assert&&this.checkPreconditions(),this.node.maxWidth=e===null?null:Math.abs(this.trail.getParentTransform().inverseDeltaX(e))}get maxHeight(){return assert&&this.checkPreconditions(),this.node.maxHeight===null?null:Math.abs(this.trail.getParentTransform().transformDeltaY(this.node.maxHeight))}set maxHeight(e){assert&&this.checkPreconditions(),this.node.maxHeight=e===null?null:Math.abs(this.trail.getParentTransform().inverseDeltaY(e))}getMax(e){return e===Orientation.HORIZONTAL?this.maxWidth:this.maxHeight}get visible(){return this.node.visible}set visible(e){this.node.visible=e}dispose(){this.trail=null,this.freeToPool()}freeToPool(){ql.pool.freeToPool(this)}};ql.pool=new Pool(ql,{maxSize:1e3});let LayoutProxy=ql;scenery.register("LayoutProxy",LayoutProxy);class LayoutProxyProperty extends DerivedProperty1{constructor(e,t,n){const r=new TrailsBetweenProperty(e,t);super([r],a=>a.length===1?LayoutProxy.pool.create(a[0].copy().removeAncestor()):null),this.transformTracker=null,this.trailsBetweenProperty=r,this.lazyLink((a,l)=>{l&&l.dispose()});const s=n==null?void 0:n.onTransformChange;s&&this.link(a=>{this.transformTracker&&(this.transformTracker.dispose(),this.transformTracker=null),a&&(this.transformTracker=new TransformTracker$1(a.trail.copy().addAncestor(e)),this.transformTracker.addListener(s))})}dispose(){this.trailsBetweenProperty.dispose(),this.transformTracker&&this.transformTracker.dispose(),super.dispose()}}scenery.register("LayoutProxyProperty",LayoutProxyProperty);class LayoutConstraint{constructor(e){this._layoutLockCount=0,this._layoutAttemptDuringLock=!1,this._enabled=!0,this._listenedNodes=new Set,this.finishedLayoutEmitter=new TinyEmitter,this.ancestorNode=e,this._updateLayoutListener=this.updateLayoutAutomatically.bind(this)}addNode(e,t=!0){assert&&assert(!this._listenedNodes.has(e)),assert&&assert(!t||!e._activeParentLayoutConstraint,"This node is already managed by a layout container - make sure to wrap it in a Node if DAG, removing it from an old layout container, etc."),t&&(e._activeParentLayoutConstraint=this),e.boundsProperty.lazyLink(this._updateLayoutListener),e.visibleProperty.lazyLink(this._updateLayoutListener),extendsWidthSizable(e)&&(e.minimumWidthProperty.lazyLink(this._updateLayoutListener),e.isWidthResizableProperty.lazyLink(this._updateLayoutListener)),extendsHeightSizable(e)&&(e.minimumHeightProperty.lazyLink(this._updateLayoutListener),e.isHeightResizableProperty.lazyLink(this._updateLayoutListener)),this._listenedNodes.add(e)}removeNode(e){assert&&assert(this._listenedNodes.has(e)),e._activeParentLayoutConstraint===this&&(e._activeParentLayoutConstraint=null),e.boundsProperty.unlink(this._updateLayoutListener),e.visibleProperty.unlink(this._updateLayoutListener),extendsWidthSizable(e)&&(e.minimumWidthProperty.unlink(this._updateLayoutListener),e.isWidthResizableProperty.unlink(this._updateLayoutListener)),extendsHeightSizable(e)&&(e.minimumHeightProperty.unlink(this._updateLayoutListener),e.isHeightResizableProperty.unlink(this._updateLayoutListener)),this._listenedNodes.delete(e)}layout(){}get isLocked(){return this._layoutLockCount>0}lock(){this._layoutLockCount++}unlock(){this._layoutLockCount--}validateLocalPreferredWidth(e){assert&&e.localBounds.isFinite()&&!this._layoutAttemptDuringLock&&e.validateLocalPreferredWidth()}validateLocalPreferredHeight(e){assert&&e.localBounds.isFinite()&&!this._layoutAttemptDuringLock&&e.validateLocalPreferredHeight()}validateLocalPreferredSize(e){assert&&e.localBounds.isFinite()&&!this._layoutAttemptDuringLock&&e.validateLocalPreferredSize()}updateLayout(){let e=0;if(this.isLocked)assert&&e++,assert&&assert(++e<500,"Likely infinite loop detected, are we triggering layout within the layout?"),this._layoutAttemptDuringLock=!0;else{this.lock();do this._layoutAttemptDuringLock=!1,this.layout();while(this._layoutAttemptDuringLock);this.unlock()}}updateLayoutAutomatically(){this._enabled&&this.updateLayout()}createLayoutProxy(e){const t=e.getTrails(n=>n===this.ancestorNode);return t.length===1?LayoutProxy.pool.create(t[0].removeAncestor()):null}get enabled(){return this._enabled}set enabled(e){this._enabled!==e&&(this._enabled=e,this.updateLayoutAutomatically())}dispose(){const e=[...this._listenedNodes.keys()];for(let t=0;t<e.length;t++)this.removeNode(e[t]);this.finishedLayoutEmitter.dispose()}}scenery.register("LayoutConstraint",LayoutConstraint);class LayoutCell{constructor(e,t,n){n?(this.layoutProxyProperty=null,this._proxy=n):(this._proxy=null,this.layoutProxyProperty=new LayoutProxyProperty(e.ancestorNode,t,{onTransformChange:()=>e.updateLayoutAutomatically()}),this.layoutProxyProperty.link(r=>{this._proxy=r,e.updateLayoutAutomatically()})),this._constraint=e,this._node=t,this.layoutOptionsListener=this.onLayoutOptionsChange.bind(this),this.node.layoutOptionsChangedEmitter.addListener(this.layoutOptionsListener)}onLayoutOptionsChange(){}get node(){return this._node}isConnected(){return this._proxy!==null}get proxy(){return assert&&assert(this._proxy),this._proxy}isSizable(e){return e===Orientation.HORIZONTAL?this.proxy.widthSizable:this.proxy.heightSizable}dispose(){this.layoutProxyProperty&&this.layoutProxyProperty.dispose(),this.node.layoutOptionsChangedEmitter.removeListener(this.layoutOptionsListener)}}scenery.register("LayoutCell",LayoutCell);class MarginLayoutCell extends LayoutCell{constructor(e,t,n){super(e,t,n),this.preferredSizeSet=new OrientationPair(!1,!1),this.lastAvailableBounds=Bounds2.NOTHING.copy(),this.lastUsedBounds=Bounds2.NOTHING.copy(),this._marginConstraint=e}reposition(e,t,n,r,s,a){const l=r&&this.isSizable(e)?t:this.getMinimumSize(e);if(assert){const c=e===Orientation.HORIZONTAL?this.node.maxWidth:this.node.maxHeight;assert(!this.isSizable(e)||c===null||Math.abs(c-l)>-1e-9,`Tried to set a preferred size ${l} larger than the specified max${e===Orientation.HORIZONTAL?"Width":"Height"} of ${c}. Ideally, try to avoid putting a maxWidth/maxHeight on a width/height-sizable Node (one that will resize to fit its preferred size) inside a layout container, particularly one that will try to expand the Node past its maximum size.`)}this.attemptPreferredSize(e,l),a===LayoutAlign.ORIGIN?this.positionOrigin(e,n+s):this.positionStart(e,n+(t-this.getCellBounds()[e.size])*a.padRatio);const d=this.getCellBounds();return assert&&assert(d.isFinite()),this.lastAvailableBounds[e.minCoordinate]=n,this.lastAvailableBounds[e.maxCoordinate]=n+t,this.lastUsedBounds.set(d),d}get effectiveLeftMargin(){return this._leftMargin!==null?this._leftMargin:this._marginConstraint._leftMargin}get effectiveRightMargin(){return this._rightMargin!==null?this._rightMargin:this._marginConstraint._rightMargin}get effectiveTopMargin(){return this._topMargin!==null?this._topMargin:this._marginConstraint._topMargin}get effectiveBottomMargin(){return this._bottomMargin!==null?this._bottomMargin:this._marginConstraint._bottomMargin}getEffectiveMinMargin(e){return e===Orientation.HORIZONTAL?this.effectiveLeftMargin:this.effectiveTopMargin}getEffectiveMaxMargin(e){return e===Orientation.HORIZONTAL?this.effectiveRightMargin:this.effectiveBottomMargin}get effectiveMinContentWidth(){return this._minContentWidth!==null?this._minContentWidth:this._marginConstraint._minContentWidth}get effectiveMinContentHeight(){return this._minContentHeight!==null?this._minContentHeight:this._marginConstraint._minContentHeight}getEffectiveMinContent(e){return e===Orientation.HORIZONTAL?this.effectiveMinContentWidth:this.effectiveMinContentHeight}get effectiveMaxContentWidth(){return this._maxContentWidth!==null?this._maxContentWidth:this._marginConstraint._maxContentWidth}get effectiveMaxContentHeight(){return this._maxContentHeight!==null?this._maxContentHeight:this._marginConstraint._maxContentHeight}getEffectiveMaxContent(e){return e===Orientation.HORIZONTAL?this.effectiveMaxContentWidth:this.effectiveMaxContentHeight}getMinimumSize(e){return this.getEffectiveMinMargin(e)+Math.max(this.proxy.getMinimum(e),this.getEffectiveMinContent(e)||0)+this.getEffectiveMaxMargin(e)}getMaximumSize(e){return this.getEffectiveMinMargin(e)+(this.getEffectiveMaxContent(e)||Number.POSITIVE_INFINITY)+this.getEffectiveMaxMargin(e)}attemptPreferredSize(e,t){if(this.proxy[e.sizable]){const n=this.getMinimumSize(e),r=this.getMaximumSize(e);assert&&assert(isFinite(n)),assert&&assert(r>=n),t=DotUtils.clamp(t,n,r);let s=t-this.getEffectiveMinMargin(e)-this.getEffectiveMaxMargin(e);const a=this.proxy.getMax(e);a!==null&&(s=Math.min(a,s)),this._marginConstraint.setProxyPreferredSize(e,this.proxy,s),this.preferredSizeSet.set(e,!0)}}unsetPreferredSize(e){this.proxy[e.sizable]&&this._marginConstraint.setProxyPreferredSize(e,this.proxy,null)}positionStart(e,t){const n=this.getEffectiveMinMargin(e)+t;this._marginConstraint.setProxyMinSide(e,this.proxy,n)}positionOrigin(e,t){this._marginConstraint.setProxyOrigin(e,this.proxy,t)}getOriginBounds(){return this.getCellBounds().shiftedXY(-this.proxy.x,-this.proxy.y)}getCellBounds(){return this.proxy.bounds.withOffsets(this.effectiveLeftMargin,this.effectiveTopMargin,this.effectiveRightMargin,this.effectiveBottomMargin)}dispose(){Orientation.enumeration.values.forEach(e=>{this.preferredSizeSet.get(e)&&this.unsetPreferredSize(e)}),super.dispose()}static createHelperNode(e,t,n){const r=new Node$2,s=.4,a=Shape$1.union(e.map(D=>Shape$1.bounds(D.lastAvailableBounds))),l=Shape$1.union(e.map(D=>Shape$1.bounds(D.lastUsedBounds))),d=Shape$1.union(e.map(D=>Shape$1.bounds(D.proxy.bounds))),c=Shape$1.bounds(t).shapeDifference(a),y=a.shapeDifference(l),m=l.shapeDifference(d),O=(D,z,w)=>{const N=new Text(D,{font:new Font({size:6,family:"monospace"}),fill:z}),H=Rectangle.bounds(N.bounds,{fill:w,children:[N]});return new NodePattern(H,4,Math.floor(H.left),Math.ceil(H.top+1),Math.floor(H.width),Math.floor(H.height-2),Matrix3.rotation2(-Math.PI/4))};return r.addChild(new Path(c,{fill:O("spacing","#000","#fff"),opacity:.6})),r.addChild(new Path(y,{fill:O("empty","#aaa","#000"),opacity:.6})),r.addChild(new Path(m,{fill:O("margin","#600","#f00"),opacity:.6})),r.addChild(Rectangle.bounds(t,{stroke:"white",lineDash:[2,2],lineDashOffset:2,lineWidth:s})),r.addChild(Rectangle.bounds(t,{stroke:"black",lineDash:[2,2],lineWidth:s})),e.forEach(D=>{r.addChild(Rectangle.bounds(D.getCellBounds(),{stroke:"rgba(0,255,0,1)",lineWidth:s}))}),e.forEach(D=>{r.addChild(Rectangle.bounds(D.proxy.bounds,{stroke:"rgba(255,0,0,1)",lineWidth:s}))}),e.forEach(D=>{const z=D.getCellBounds(),w=new PressListener({tandem:Tandem.OPT_OUT});r.addChild(Rectangle.bounds(z,{inputListeners:[w]}));let N=n(D);D.effectiveLeftMargin&&(N+=`leftMargin: ${D.effectiveLeftMargin}
`),D.effectiveRightMargin&&(N+=`rightMargin: ${D.effectiveRightMargin}
`),D.effectiveTopMargin&&(N+=`topMargin: ${D.effectiveTopMargin}
`),D.effectiveBottomMargin&&(N+=`bottomMargin: ${D.effectiveBottomMargin}
`),D.effectiveMinContentWidth&&(N+=`minContentWidth: ${D.effectiveMinContentWidth}
`),D.effectiveMinContentHeight&&(N+=`minContentHeight: ${D.effectiveMinContentHeight}
`),D.effectiveMaxContentWidth&&(N+=`maxContentWidth: ${D.effectiveMaxContentWidth}
`),D.effectiveMaxContentHeight&&(N+=`maxContentHeight: ${D.effectiveMaxContentHeight}
`),N+=`layoutOptions: ${JSON.stringify(D.node.layoutOptions,null,2).replace(/ /g,"&nbsp;")}
`;const H=new RichText(N.trim().replace(/\n/g,"<br>"),{font:new Font({size:12})}),X=Rectangle.bounds(H.bounds.dilated(3),{fill:"rgba(255,255,255,0.8)",children:[H],leftTop:z.leftTop});r.addChild(X),w.isOverProperty.link(ae=>{X.visible=ae})}),r}}scenery.register("MarginLayoutCell",MarginLayoutCell);const LAYOUT_NODE_OPTION_KEYS=["resize","layoutOrigin"];class LayoutNode extends Sizable(Node$2){constructor(e){super(e),this.layoutOriginProperty=new Vector2Property(Vector2.ZERO)}linkLayoutBounds(){this._constraint.layoutBoundsProperty.link(e=>{this.localBounds=e})}setExcludeInvisibleChildrenFromBounds(e){super.setExcludeInvisibleChildrenFromBounds(e),this._constraint.excludeInvisible=e}setChildren(e){if(this.constraint.isLocked)return super.setChildren(e);const t=this.getChildren();return this.constraint.lock(),super.setChildren(e),this.constraint.unlock(),_.isEqual(t,e)||this.constraint.updateLayoutAutomatically(),this}updateLayout(){this._constraint.updateLayout()}get resize(){return this._constraint.enabled}set resize(e){this._constraint.enabled=e}get layoutOrigin(){return this.layoutOriginProperty.value}set layoutOrigin(e){this.layoutOriginProperty.value=e}get constraint(){return this._constraint}dispose(){this._constraint.dispose(),super.dispose()}}scenery.register("LayoutNode",LayoutNode);class LayoutLine{initializeLayoutLine(){this.min=0,this.max=Number.POSITIVE_INFINITY,this.minOrigin=Number.POSITIVE_INFINITY,this.maxOrigin=Number.NEGATIVE_INFINITY,this.size=0,this.position=0}hasOrigin(){return isFinite(this.minOrigin)&&isFinite(this.maxOrigin)}}scenery.register("LayoutLine",LayoutLine);const CHANGE_POSITION_THRESHOLD=1e-9;class NodeLayoutConstraint extends LayoutConstraint{constructor(e,t){const n=optionize()({preferredWidthProperty:new TinyProperty(null),preferredHeightProperty:new TinyProperty(null),minimumWidthProperty:new TinyProperty(null),minimumHeightProperty:new TinyProperty(null),layoutOriginProperty:new TinyProperty(Vector2.ZERO)},t);super(e),this._excludeInvisible=!0,this.layoutBoundsProperty=new Property(Bounds2.NOTHING,{valueComparisonStrategy:"equalsFunction"}),this.preferredWidthProperty=n.preferredWidthProperty,this.preferredHeightProperty=n.preferredHeightProperty,this.minimumWidthProperty=n.minimumWidthProperty,this.minimumHeightProperty=n.minimumHeightProperty,this.layoutOriginProperty=n.layoutOriginProperty,this.preferredWidthProperty.lazyLink(this._updateLayoutListener),this.preferredHeightProperty.lazyLink(this._updateLayoutListener),this.layoutOriginProperty.lazyLink(this._updateLayoutListener)}filterLayoutCells(e){return assert&&assert(_.every(e,t=>!t.node.isDisposed),"A cell's node should not be disposed when layout happens"),e.filter(t=>t.isConnected()&&t.proxy.bounds.isValid()&&(!this.excludeInvisible||t.node.visible))}get excludeInvisible(){return this._excludeInvisible}set excludeInvisible(e){this._excludeInvisible!==e&&(this._excludeInvisible=e,this.updateLayoutAutomatically())}setProxyPreferredSize(e,t,n){t[e.preferredSize]=n}setProxyMinSide(e,t,n){Math.abs(t[e.minSide]-n)>CHANGE_POSITION_THRESHOLD&&(t[e.minSide]=n)}setProxyOrigin(e,t,n){Math.abs(t[e.coordinate]-n)>CHANGE_POSITION_THRESHOLD&&(t[e.coordinate]=n)}dispose(){this.preferredWidthProperty.unlink(this._updateLayoutListener),this.preferredHeightProperty.unlink(this._updateLayoutListener),this.layoutOriginProperty.unlink(this._updateLayoutListener),super.dispose()}}scenery.register("NodeLayoutConstraint",NodeLayoutConstraint);const MARGIN_LAYOUT_CONFIGURABLE_OPTION_KEYS=["margin","xMargin","yMargin","leftMargin","rightMargin","topMargin","bottomMargin","minContentWidth","minContentHeight","maxContentWidth","maxContentHeight"],MarginLayoutConfigurable=memoize(o=>class extends o{constructor(...t){super(...t),this._leftMargin=null,this._rightMargin=null,this._topMargin=null,this._bottomMargin=null,this._minContentWidth=null,this._minContentHeight=null,this._maxContentWidth=null,this._maxContentHeight=null,this.changedEmitter=new TinyEmitter}mutateConfigurable(t){assertMutuallyExclusiveOptions(t,["margin"],["xMargin","yMargin"]),assertMutuallyExclusiveOptions(t,["xMargin"],["leftMargin","rightMargin"]),assertMutuallyExclusiveOptions(t,["yMargin"],["topMargin","bottomMargin"])}setConfigToBaseDefault(){this._leftMargin=0,this._rightMargin=0,this._topMargin=0,this._bottomMargin=0,this._minContentWidth=null,this._minContentHeight=null,this._maxContentWidth=null,this._maxContentHeight=null,this.changedEmitter.emit()}setConfigToInherit(){this._leftMargin=null,this._rightMargin=null,this._topMargin=null,this._bottomMargin=null,this._minContentWidth=null,this._minContentHeight=null,this._maxContentWidth=null,this._maxContentHeight=null,this.changedEmitter.emit()}get leftMargin(){return this._leftMargin}set leftMargin(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)),this._leftMargin!==t&&(this._leftMargin=t,this.changedEmitter.emit())}get rightMargin(){return this._rightMargin}set rightMargin(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)),this._rightMargin!==t&&(this._rightMargin=t,this.changedEmitter.emit())}get topMargin(){return this._topMargin}set topMargin(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)),this._topMargin!==t&&(this._topMargin=t,this.changedEmitter.emit())}get bottomMargin(){return this._bottomMargin}set bottomMargin(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)),this._bottomMargin!==t&&(this._bottomMargin=t,this.changedEmitter.emit())}get xMargin(){return assert&&assert(this._leftMargin===this._rightMargin),this._leftMargin}set xMargin(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)),(this._leftMargin!==t||this._rightMargin!==t)&&(this._leftMargin=t,this._rightMargin=t,this.changedEmitter.emit())}get yMargin(){return assert&&assert(this._topMargin===this._bottomMargin),this._topMargin}set yMargin(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)),(this._topMargin!==t||this._bottomMargin!==t)&&(this._topMargin=t,this._bottomMargin=t,this.changedEmitter.emit())}get margin(){return assert&&assert(this._leftMargin===this._rightMargin&&this._leftMargin===this._topMargin&&this._leftMargin===this._bottomMargin),this._topMargin}set margin(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)),(this._leftMargin!==t||this._rightMargin!==t||this._topMargin!==t||this._bottomMargin!==t)&&(this._leftMargin=t,this._rightMargin=t,this._topMargin=t,this._bottomMargin=t,this.changedEmitter.emit())}get minContentWidth(){return this._minContentWidth}set minContentWidth(t){this._minContentWidth!==t&&(this._minContentWidth=t,this.changedEmitter.emit())}get minContentHeight(){return this._minContentHeight}set minContentHeight(t){this._minContentHeight!==t&&(this._minContentHeight=t,this.changedEmitter.emit())}get maxContentWidth(){return this._maxContentWidth}set maxContentWidth(t){this._maxContentWidth!==t&&(this._maxContentWidth=t,this.changedEmitter.emit())}get maxContentHeight(){return this._maxContentHeight}set maxContentHeight(t){this._maxContentHeight!==t&&(this._maxContentHeight=t,this.changedEmitter.emit())}});scenery.register("MarginLayoutConfigurable",MarginLayoutConfigurable);const FLOW_CONFIGURABLE_OPTION_KEYS=["orientation","align","stretch","grow"].concat(MARGIN_LAYOUT_CONFIGURABLE_OPTION_KEYS),FlowConfigurable=memoize(o=>class extends MarginLayoutConfigurable(o){constructor(...t){super(...t),this._orientation=Orientation.HORIZONTAL,this._align=null,this._stretch=null,this._grow=null,this.orientationChangedEmitter=new TinyEmitter}mutateConfigurable(t){super.mutateConfigurable(t),mutate(this,FLOW_CONFIGURABLE_OPTION_KEYS,t)}setConfigToBaseDefault(){this._align=LayoutAlign.CENTER,this._stretch=!1,this._grow=0,super.setConfigToBaseDefault()}setConfigToInherit(){this._align=null,this._stretch=null,this._grow=null,super.setConfigToInherit()}get orientation(){return this._orientation===Orientation.HORIZONTAL?"horizontal":"vertical"}set orientation(t){assert&&assert(t==="horizontal"||t==="vertical");const n=t==="horizontal"?Orientation.HORIZONTAL:Orientation.VERTICAL;this._orientation!==n&&(this._orientation=n,this.orientationChangedEmitter.emit(),this.changedEmitter.emit())}get align(){const t=LayoutAlign.internalToAlign(this._orientation,this._align);return assert&&assert(t===null||typeof t=="string"),t}set align(t){assert&&assert(LayoutAlign.getAllowedAligns(this._orientation.opposite).includes(t),`align ${t} not supported, with the orientation ${this._orientation}, the valid values are ${LayoutAlign.getAllowedAligns(this._orientation.opposite)}`);const n=LayoutAlign.alignToInternal(this._orientation.opposite,t);assert&&assert(n===null||n instanceof LayoutAlign),this._align!==n&&(this._align=n,this.changedEmitter.emit())}get stretch(){return this._stretch}set stretch(t){this._stretch!==t&&(this._stretch=t,this.changedEmitter.emit())}get grow(){return this._grow}set grow(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)&&t>=0),this._grow!==t&&(this._grow=t,this.changedEmitter.emit())}});scenery.register("FlowConfigurable",FlowConfigurable);const FLOW_CELL_KEYS=[...FLOW_CONFIGURABLE_OPTION_KEYS,"isSeparator"];class FlowCell extends FlowConfigurable(MarginLayoutCell){constructor(e,t,n){super(e,t,n),this.size=0,this._isSeparator=!1,this.flowConstraint=e,this.orientation=e.orientation,this.onLayoutOptionsChange()}get effectiveAlign(){return this._align!==null?this._align:this.flowConstraint._align}get effectiveStretch(){return this._stretch!==null?this._stretch:this.flowConstraint._stretch}get effectiveGrow(){return this._grow!==null?this._grow:this.flowConstraint._grow}onLayoutOptionsChange(){this.node.layoutOptions&&this.setOptions(this.node.layoutOptions),super.onLayoutOptionsChange()}setOptions(e){const t=optionize()({isSeparator:!1},e);assert&&Object.keys(t).forEach(n=>{assert&&assert(FLOW_CELL_KEYS.includes(n),`Cannot provide key ${n} to a FlowCell's layoutOptions. Perhaps this is a Grid-style layout option?`)}),this._isSeparator=t.isSeparator,this.setConfigToInherit(),this.mutateConfigurable(t)}}scenery.register("FlowCell",FlowCell);const Hl=class Hl extends LayoutLine{constructor(e,t){super(),this.initialize(e,t)}initialize(e,t){return this.orientation=e,this.cells=t,this.initializeLayoutLine(),this}getMinimumSize(e){return(this.cells.length-1)*e+_.sum(this.cells.map(t=>t.getMinimumSize(this.orientation)))}freeToPool(){Hl.pool.freeToPool(this)}clean(){this.cells.length=0,this.freeToPool()}};Hl.pool=new Pool(Hl,{defaultArguments:[Orientation.HORIZONTAL,[]]});let FlowLine=Hl;scenery.register("FlowLine",FlowLine);const FLOW_CONSTRAINT_OPTION_KEYS=[...FLOW_CONFIGURABLE_OPTION_KEYS,"spacing","lineSpacing","justify","justifyLines","wrap","excludeInvisible"];class FlowConstraint extends FlowConfigurable(NodeLayoutConstraint){constructor(e,t){super(e,t),this.cells=[],this._justify=LayoutJustification.SPACE_BETWEEN,this._justifyLines=null,this._wrap=!1,this._spacing=0,this._lineSpacing=0,this.displayedCells=[],this.setConfigToBaseDefault(),this.mutateConfigurable(t),mutate(this,FLOW_CONSTRAINT_OPTION_KEYS,t),this.changedEmitter.addListener(this._updateLayoutListener),this.orientationChangedEmitter.addListener(()=>this.cells.forEach(n=>{n.orientation=this.orientation}))}updateSeparatorVisibility(){let e=0;for(;e<this.cells.length;e++){const n=this.cells[e];if(n._isSeparator)n.node.visible=!1;else if(n.node.visible)break}let t=!1;for(let n=this.cells.length-1;n>e;n--){const r=this.cells[n];r._isSeparator?(r.node.visible=t,t=!1):r.node.visible&&(t=!0)}}layout(){super.layout();const e=this._orientation,t=this._orientation.opposite;this.updateSeparatorVisibility();const n=this.filterLayoutCells(this.cells);if(this.displayedCells=n,!n.length){this.layoutBoundsProperty.value=Bounds2.NOTHING,this.minimumWidthProperty.value=null,this.minimumHeightProperty.value=null;return}let r=this.getPreferredProperty(e).value;const s=this.getPreferredProperty(t).value,a=Math.max(...n.map(fe=>fe.getMinimumSize(e)||0));a>(r||Number.POSITIVE_INFINITY)&&(r=a);const l=[];if(this.wrap){let fe=[],be=r||Number.POSITIVE_INFINITY;for(;n.length;){const Ae=n.shift(),W=Ae.getMinimumSize(e);fe.length===0?(fe.push(Ae),be-=W):this.spacing+W<=be+1e-7?(fe.push(Ae),be-=this.spacing+W):(l.push(FlowLine.pool.create(e,fe)),be=r||Number.POSITIVE_INFINITY,fe=[Ae],be-=W)}fe.length&&l.push(FlowLine.pool.create(e,fe))}else l.push(FlowLine.pool.create(e,n));l.forEach(fe=>{fe.cells.forEach(be=>{if(fe.min=Math.max(fe.min,be.getMinimumSize(t)),fe.max=Math.min(fe.max,be.getMaximumSize(t)),be.effectiveAlign===LayoutAlign.ORIGIN){const Ae=be.getOriginBounds();fe.minOrigin=Math.min(Ae[t.minCoordinate],fe.minOrigin),fe.maxOrigin=Math.max(Ae[t.maxCoordinate],fe.maxOrigin)}}),isFinite(fe.minOrigin)&&isFinite(fe.maxOrigin)?fe.size=Math.max(fe.min,fe.maxOrigin-fe.minOrigin):fe.size=fe.min});const d=Math.max(...l.map(fe=>fe.getMinimumSize(this.spacing))),c=_.sum(l.map(fe=>fe.size))+(l.length-1)*this.lineSpacing,y=this.wrap?a:d,m=Math.max(d,r||0),O=Math.max(c,s||0),D=this.layoutOriginProperty.value[e.coordinate],z=this.layoutOriginProperty.value[e.opposite.coordinate];l.forEach(fe=>{const be=_.sum(fe.cells.map(Te=>Te.getMinimumSize(e))),Ae=this.spacing*(fe.cells.length-1);let W=m-be-Ae;fe.cells.forEach(Te=>{Te.size=Te.getMinimumSize(e)});let J;for(;W>1e-7&&(J=fe.cells.filter(Te=>Te.effectiveGrow!==0&&Te.size<Te.getMaximumSize(e)-1e-7)).length;){const Te=_.sum(J.map(Bt=>Bt.effectiveGrow)),Et=Math.min(Math.min(...J.map(Bt=>(Bt.getMaximumSize(e)-Bt.size)/Bt.effectiveGrow)),W/Te);assert&&assert(Et>1e-11),J.forEach(Bt=>{Bt.size+=Et*Bt.effectiveGrow}),W-=Et*Te}fe.cells.forEach(Te=>Te.attemptPreferredSize(e,Te.size));const Ue=this._justify.spacingFunctionFactory(W,fe.cells.length);let gt=D;fe.cells.forEach((Te,Et)=>{gt+=Ue(Et),Et>0&&(gt+=this.spacing),Te.positionStart(e,gt),Te.lastAvailableBounds[e.minCoordinate]=gt,Te.lastAvailableBounds[e.maxCoordinate]=gt+Te.size,gt+=Te.size,assert&&assert(this.spacing>=0||Te.size>=-this.spacing-1e-7,"Negative spacing more than a cell's size causes issues with layout")})});const w=O-c,N=(l[0].hasOrigin()?l[0].minOrigin:0)+z;let H=N;if(this._justifyLines===null)l.forEach(fe=>{fe.size+=w/l.length}),l.forEach(fe=>{fe.position=H,H+=fe.size+this.lineSpacing});else{const fe=this._justifyLines.spacingFunctionFactory(w,l.length);l.forEach((be,Ae)=>{H+=fe(Ae),be.position=H,H+=be.size+this.lineSpacing})}l.forEach(fe=>fe.cells.forEach(be=>{be.reposition(t,fe.size,fe.position,be.effectiveStretch,-fe.minOrigin,be.effectiveAlign)}));const X=D,ae=D+m,oe=N,ue=N+O;this.layoutBoundsProperty.value=Bounds2.oriented(e,X,oe,ae,ue),this.minimumWidthProperty.value=e===Orientation.HORIZONTAL?y:c,this.minimumHeightProperty.value=e===Orientation.HORIZONTAL?c:y,this.finishedLayoutEmitter.emit(),l.forEach(fe=>fe.clean())}get justify(){const e=LayoutJustification.internalToJustify(this._orientation,this._justify);return assert&&assert(LayoutJustification.getAllowedJustificationValues(this._orientation).includes(e)),e}set justify(e){assert&&assert(LayoutJustification.getAllowedJustificationValues(this._orientation).includes(e),`justify ${e} not supported, with the orientation ${this._orientation}, the valid values are ${LayoutJustification.getAllowedJustificationValues(this._orientation)}`);const t=LayoutJustification.justifyToInternal(this._orientation,e);this._justify!==t&&(this._justify=t,this.updateLayoutAutomatically())}get justifyLines(){if(this._justifyLines===null)return null;{const e=LayoutJustification.internalToJustify(this._orientation,this._justifyLines);return assert&&assert(LayoutJustification.getAllowedJustificationValues(this._orientation).includes(e)),e}}set justifyLines(e){assert&&assert(e===null||LayoutJustification.getAllowedJustificationValues(this._orientation.opposite).includes(e),`justify ${e} not supported, with the orientation ${this._orientation.opposite}, the valid values are ${LayoutJustification.getAllowedJustificationValues(this._orientation.opposite)} or null`);const t=e===null?null:LayoutJustification.justifyToInternal(this._orientation.opposite,e);assert&&assert(t===null||t instanceof LayoutJustification),this._justifyLines!==t&&(this._justifyLines=t,this.updateLayoutAutomatically())}get wrap(){return this._wrap}set wrap(e){this._wrap!==e&&(this._wrap=e,this.updateLayoutAutomatically())}get spacing(){return this._spacing}set spacing(e){assert&&assert(isFinite(e)),this._spacing!==e&&(this._spacing=e,this.updateLayoutAutomatically())}get lineSpacing(){return this._lineSpacing}set lineSpacing(e){assert&&assert(isFinite(e)),this._lineSpacing!==e&&(this._lineSpacing=e,this.updateLayoutAutomatically())}insertCell(e,t){assert&&assert(e>=0),assert&&assert(e<=this.cells.length),assert&&assert(!_.includes(this.cells,t)),t.orientation=this.orientation,this.cells.splice(e,0,t),this.addNode(t.node),t.changedEmitter.addListener(this._updateLayoutListener),this.updateLayoutAutomatically()}removeCell(e){assert&&assert(_.includes(this.cells,e)),arrayRemove(this.cells,e),this.removeNode(e.node),e.changedEmitter.removeListener(this._updateLayoutListener),this.updateLayoutAutomatically()}reorderCells(e,t,n){this.cells.splice(t,n-t+1,...e),this.updateLayoutAutomatically()}getPreferredProperty(e){return e===Orientation.HORIZONTAL?this.preferredWidthProperty:this.preferredHeightProperty}dispose(){this.lock(),this.cells.forEach(e=>this.removeCell(e)),this.displayedCells=[],super.dispose(),this.unlock()}static create(e,t){return new FlowConstraint(e,t)}}scenery.register("FlowConstraint",FlowConstraint);const FLOWBOX_OPTION_KEYS=[...LAYOUT_NODE_OPTION_KEYS,...FLOW_CONSTRAINT_OPTION_KEYS.filter(o=>o!=="excludeInvisible")],DEFAULT_OPTIONS$2={orientation:"horizontal",spacing:0,align:"center",stretch:!1},ku=class ku extends LayoutNode{constructor(e){const t=optionize()({excludeInvisibleChildrenFromBounds:!0,resize:!0,disabledOpacity:SceneryConstants.DISABLED_OPACITY},e);super(),this._cellMap=new Map,this._constraint=new FlowConstraint(this,{preferredWidthProperty:this.localPreferredWidthProperty,preferredHeightProperty:this.localPreferredHeightProperty,minimumWidthProperty:this.localMinimumWidthProperty,minimumHeightProperty:this.localMinimumHeightProperty,layoutOriginProperty:this.layoutOriginProperty,orientation:DEFAULT_OPTIONS$2.orientation,spacing:DEFAULT_OPTIONS$2.spacing,align:DEFAULT_OPTIONS$2.align,stretch:DEFAULT_OPTIONS$2.stretch,excludeInvisible:!1}),this.onChildInserted=this.onFlowBoxChildInserted.bind(this),this.onChildRemoved=this.onFlowBoxChildRemoved.bind(this),this.onChildrenReordered=this.onFlowBoxChildrenReordered.bind(this),this.onChildrenChanged=this.onFlowBoxChildrenChanged.bind(this),this.childInsertedEmitter.addListener(this.onChildInserted),this.childRemovedEmitter.addListener(this.onChildRemoved),this.childrenReorderedEmitter.addListener(this.onChildrenReordered),this.childrenChangedEmitter.addListener(this.onChildrenChanged);const n=_.omit(t,REQUIRES_BOUNDS_OPTION_KEYS),r=_.pick(t,REQUIRES_BOUNDS_OPTION_KEYS);this._constraint.lock(),this.mutate(n),this._constraint.unlock(),this._constraint.updateLayout(),this.mutate(r),this.linkLayoutBounds()}onFlowBoxChildInserted(e,t){const n=new FlowCell(this._constraint,e,this._constraint.createLayoutProxy(e));this._cellMap.set(e,n),this._constraint.insertCell(t,n)}onFlowBoxChildRemoved(e){const t=this._cellMap.get(e);assert&&assert(t),this._cellMap.delete(e),this._constraint.removeCell(t),t.dispose()}onFlowBoxChildrenReordered(e,t){this._constraint.reorderCells(this._children.slice(e,t+1).map(n=>this._cellMap.get(n)),e,t)}onFlowBoxChildrenChanged(){this._constraint.updateLayoutAutomatically()}getCell(e){const t=this._cellMap.get(e);return assert&&assert(t),t}get orientation(){return this._constraint.orientation}set orientation(e){this._constraint.orientation=e}get spacing(){return this._constraint.spacing}set spacing(e){this._constraint.spacing=e}get lineSpacing(){return this._constraint.lineSpacing}set lineSpacing(e){this._constraint.lineSpacing=e}get justify(){return this._constraint.justify}set justify(e){this._constraint.justify=e}get justifyLines(){return this._constraint.justifyLines}set justifyLines(e){this._constraint.justifyLines=e}get wrap(){return this._constraint.wrap}set wrap(e){this._constraint.wrap=e}get align(){return assert&&assert(typeof this._constraint.align=="string"),this._constraint.align}set align(e){this._constraint.align=e}get stretch(){return assert&&assert(typeof this._constraint.stretch=="boolean"),this._constraint.stretch}set stretch(e){this._constraint.stretch=e}get grow(){return this._constraint.grow}set grow(e){this._constraint.grow=e}get margin(){return this._constraint.margin}set margin(e){this._constraint.margin=e}get xMargin(){return this._constraint.xMargin}set xMargin(e){this._constraint.xMargin=e}get yMargin(){return this._constraint.yMargin}set yMargin(e){this._constraint.yMargin=e}get leftMargin(){return this._constraint.leftMargin}set leftMargin(e){this._constraint.leftMargin=e}get rightMargin(){return this._constraint.rightMargin}set rightMargin(e){this._constraint.rightMargin=e}get topMargin(){return this._constraint.topMargin}set topMargin(e){this._constraint.topMargin=e}get bottomMargin(){return this._constraint.bottomMargin}set bottomMargin(e){this._constraint.bottomMargin=e}get minContentWidth(){return this._constraint.minContentWidth}set minContentWidth(e){this._constraint.minContentWidth=e}get minContentHeight(){return this._constraint.minContentHeight}set minContentHeight(e){this._constraint.minContentHeight=e}get maxContentWidth(){return this._constraint.maxContentWidth}set maxContentWidth(e){this._constraint.maxContentWidth=e}get maxContentHeight(){return this._constraint.maxContentHeight}set maxContentHeight(e){this._constraint.maxContentHeight=e}dispose(){this._constraint.lock(),this.childInsertedEmitter.removeListener(this.onChildInserted),this.childRemovedEmitter.removeListener(this.onChildRemoved),this.childrenReorderedEmitter.removeListener(this.onChildrenReordered),this.childrenChangedEmitter.removeListener(this.onChildrenChanged);for(const e of this._cellMap.values())e.dispose();super.dispose()}setOrientation(e){return this.orientation=e,this}getOrientation(){return this.orientation}setSpacing(e){return this.spacing=e,this}getSpacing(){return this.spacing}setAlign(e){return this.align=e,this}getAlign(){return this.align}setResize(e){return this.resize=e,this}isResize(){return this.resize}getHelperNode(){return MarginLayoutCell.createHelperNode(this.constraint.displayedCells,this.constraint.layoutBoundsProperty.value,t=>{let n="";const r=Orientation.fromLayoutOrientation(t.orientation);return n+=`align: ${LayoutAlign.internalToAlign(r,t.effectiveAlign)}
`,n+=`stretch: ${t.effectiveStretch}
`,n+=`grow: ${t.effectiveGrow}
`,n})}mutate(e){return super.mutate(e)}};ku.DEFAULT_FLOW_BOX_OPTIONS=DEFAULT_OPTIONS$2;let FlowBox=ku;FlowBox.prototype._mutatorKeys=[...SIZABLE_OPTION_KEYS,...FLOWBOX_OPTION_KEYS,...Node$2.prototype._mutatorKeys];scenery.register("FlowBox",FlowBox);const GRID_CONFIGURABLE_OPTION_KEYS=["xAlign","yAlign","stretch","xStretch","yStretch","grow","xGrow","yGrow"].concat(MARGIN_LAYOUT_CONFIGURABLE_OPTION_KEYS),GridConfigurable=memoize(o=>class extends MarginLayoutConfigurable(o){constructor(...t){super(...t),this._xAlign=null,this._yAlign=null,this._xStretch=null,this._yStretch=null,this._xGrow=null,this._yGrow=null}mutateConfigurable(t){super.mutateConfigurable(t),assertMutuallyExclusiveOptions(t,["stretch"],["xStretch","yStretch"]),assertMutuallyExclusiveOptions(t,["grow"],["xGrow","yGrow"]),mutate(this,GRID_CONFIGURABLE_OPTION_KEYS,t)}setConfigToBaseDefault(){this._xAlign=LayoutAlign.CENTER,this._yAlign=LayoutAlign.CENTER,this._xStretch=!1,this._yStretch=!1,this._xGrow=0,this._yGrow=0,super.setConfigToBaseDefault()}setConfigToInherit(){this._xAlign=null,this._yAlign=null,this._xStretch=null,this._yStretch=null,this._xGrow=null,this._yGrow=null,super.setConfigToInherit()}get xAlign(){const t=this._xAlign===null?null:this._xAlign.horizontal;return assert&&assert(t===null||typeof t=="string"),t}set xAlign(t){assert&&assert(t===null||HorizontalLayoutAlignValues.includes(t),`align ${t} not supported, the valid values are ${HorizontalLayoutAlignValues} or null`);const n=LayoutAlign.horizontalAlignToInternal(t);assert&&assert(n===null||n instanceof LayoutAlign),this._xAlign!==n&&(this._xAlign=n,this.changedEmitter.emit())}get yAlign(){const t=this._yAlign===null?null:this._yAlign.vertical;return assert&&assert(t===null||typeof t=="string"),t}set yAlign(t){assert&&assert(t===null||VerticalLayoutAlignValues.includes(t),`align ${t} not supported, the valid values are ${VerticalLayoutAlignValues} or null`);const n=LayoutAlign.verticalAlignToInternal(t);assert&&assert(n===null||n instanceof LayoutAlign),this._yAlign!==n&&(this._yAlign=n,this.changedEmitter.emit())}get grow(){return assert&&assert(this._xGrow===this._yGrow),this._xGrow}set grow(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)&&t>=0),(this._xGrow!==t||this._yGrow!==t)&&(this._xGrow=t,this._yGrow=t,this.changedEmitter.emit())}get xGrow(){return this._xGrow}set xGrow(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)&&t>=0),this._xGrow!==t&&(this._xGrow=t,this.changedEmitter.emit())}get yGrow(){return this._yGrow}set yGrow(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)&&t>=0),this._yGrow!==t&&(this._yGrow=t,this.changedEmitter.emit())}get stretch(){return assert&&assert(this._xStretch===this._yStretch),this._xStretch}set stretch(t){assert&&assert(t===null||typeof t=="boolean"),(this._xStretch!==t||this._yStretch!==t)&&(this._xStretch=t,this._yStretch=t,this.changedEmitter.emit())}get xStretch(){return this._xStretch}set xStretch(t){assert&&assert(t===null||typeof t=="boolean"),this._xStretch!==t&&(this._xStretch=t,this.changedEmitter.emit())}get yStretch(){return this._yStretch}set yStretch(t){assert&&assert(t===null||typeof t=="boolean"),this._yStretch!==t&&(this._yStretch=t,this.changedEmitter.emit())}});scenery.register("GridConfigurable",GridConfigurable);const GRID_CELL_KEYS=[...GRID_CONFIGURABLE_OPTION_KEYS,"row","column","horizontalSpan","verticalSpan"];class GridCell extends GridConfigurable(MarginLayoutCell){constructor(e,t,n){super(e,t,n),this.gridConstraint=e,this.setOptions(t.layoutOptions),this.onLayoutOptionsChange()}get effectiveXAlign(){return this._xAlign!==null?this._xAlign:this.gridConstraint._xAlign}get effectiveYAlign(){return this._yAlign!==null?this._yAlign:this.gridConstraint._yAlign}getEffectiveAlign(e){return e===Orientation.HORIZONTAL?this.effectiveXAlign:this.effectiveYAlign}get effectiveXGrow(){return this._xGrow!==null?this._xGrow:this.gridConstraint._xGrow}get effectiveYGrow(){return this._yGrow!==null?this._yGrow:this.gridConstraint._yGrow}getEffectiveGrow(e){return e===Orientation.HORIZONTAL?this.effectiveXGrow:this.effectiveYGrow}get effectiveXStretch(){return this._xStretch!==null?this._xStretch:this.gridConstraint._xStretch}get effectiveYStretch(){return this._yStretch!==null?this._yStretch:this.gridConstraint._yStretch}getEffectiveStretch(e){return e===Orientation.HORIZONTAL?this.effectiveXStretch:this.effectiveYStretch}onLayoutOptionsChange(){this.setOptions(this.node.layoutOptions),super.onLayoutOptionsChange()}setOptions(e){const t=optionize()({column:0,row:0,horizontalSpan:1,verticalSpan:1},e);assert&&Object.keys(t).forEach(n=>{assert&&assert(GRID_CELL_KEYS.includes(n),`Cannot provide key ${n} to a GridCell's layoutOptions. Perhaps this is a Flow-style layout option?`)}),assert&&assert(typeof t.column=="number"&&Number.isInteger(t.column)&&isFinite(t.column)&&t.column>=0),assert&&assert(typeof t.row=="number"&&Number.isInteger(t.row)&&isFinite(t.row)&&t.row>=0),assert&&assert(typeof t.horizontalSpan=="number"&&Number.isInteger(t.horizontalSpan)&&isFinite(t.horizontalSpan)&&t.horizontalSpan>=1),assert&&assert(typeof t.verticalSpan=="number"&&Number.isInteger(t.verticalSpan)&&isFinite(t.verticalSpan)&&t.verticalSpan>=1),this.setConfigToInherit(),this.position=new OrientationPair(t.column,t.row),this.size=new OrientationPair(t.horizontalSpan,t.verticalSpan),this.mutateConfigurable(t)}containsIndex(e,t){const n=this.position.get(e),r=this.size.get(e);return t>=n&&t<n+r}containsRow(e){return this.containsIndex(Orientation.VERTICAL,e)}containsColumn(e){return this.containsIndex(Orientation.HORIZONTAL,e)}getIndices(e){const t=this.position.get(e),n=this.size.get(e);return _.range(t,t+n)}}scenery.register("GridCell",GridCell);const zl=class zl extends LayoutLine{constructor(e,t,n){super(),this.initialize(e,t,n)}initialize(e,t,n){return this.index=e,this.cells=t,this.grow=n,this.initializeLayoutLine(),this}freeToPool(){zl.pool.freeToPool(this)}clean(){this.cells.length=0,this.freeToPool()}};zl.pool=new Pool(zl,{defaultArguments:[0,[],0]});let GridLine=zl;scenery.register("GridLine",GridLine);const GRID_CONSTRAINT_OPTION_KEYS=[...GRID_CONFIGURABLE_OPTION_KEYS,"excludeInvisible","spacing","xSpacing","ySpacing"];class GridConstraint extends GridConfigurable(NodeLayoutConstraint){constructor(e,t){super(e,t),this.cells=new Set,this.displayedCells=[],this.displayedLines=new OrientationPair(new Map,new Map),this._spacing=new OrientationPair(0,0),this.setConfigToBaseDefault(),this.mutateConfigurable(t),mutate(this,GRID_CONSTRAINT_OPTION_KEYS,t),this.changedEmitter.addListener(this._updateLayoutListener)}layout(){super.layout();const e=this.filterLayoutCells([...this.cells]);if(this.displayedCells=e,!e.length){this.layoutBoundsProperty.value=Bounds2.NOTHING,this.minimumWidthProperty.value=null,this.minimumHeightProperty.value=null,this.displayedLines.forEach(s=>s.clear());return}const t=new OrientationPair(0,0),n=new OrientationPair(this.preferredWidthProperty.value,this.preferredHeightProperty.value),r=new Bounds2(0,0,0,0);[Orientation.HORIZONTAL,Orientation.VERTICAL].forEach(s=>{const a=this._spacing.get(s),l=this.displayedLines.get(s);l.forEach(N=>N.clean()),l.clear();const c=_.sortedUniq(_.sortBy(_.flatten(e.map(N=>N.getIndices(s))))).map(N=>{const H=_.filter(e,oe=>oe.containsIndex(s,N)),X=Math.max(...H.map(oe=>oe.getEffectiveGrow(s))),ae=GridLine.pool.create(N,H,X);return l.set(N,ae),ae}),y=c.slice(0,-1).map(N=>typeof a=="number"?a:a[N.index]);e.forEach(N=>{if(N.size.get(s)===1){const H=l.get(N.position.get(s));if(H.min=Math.max(H.min,N.getMinimumSize(s)),H.max=Math.min(H.max,N.getMaximumSize(s)),N.getEffectiveAlign(s)===LayoutAlign.ORIGIN){const X=N.getOriginBounds();H.minOrigin=Math.min(X[s.minCoordinate],H.minOrigin),H.maxOrigin=Math.max(X[s.maxCoordinate],H.maxOrigin)}}}),e.forEach(N=>{if(N.size.get(s)>1){assert&&assert(N.getEffectiveAlign(s)!==LayoutAlign.ORIGIN,"origin alignment cannot be specified for cells that span >1 width or height");const H=N.getIndices(s).map(oe=>l.get(oe)),X=_.sum(H.map(oe=>oe.min)),ae=N.getMinimumSize(s);if(ae>X){const oe=(ae-X)/H.length;H.forEach(ue=>{ue.min+=oe})}}}),c.forEach(N=>{N.hasOrigin()?N.size=Math.max(N.min,N.maxOrigin-N.minOrigin):N.size=N.min});const m=_.sum(c.map(N=>N.size))+_.sum(y);t.set(s,m);const O=Math.max(m,n.get(s)||0);let D=O-m,z;for(;D>1e-7&&(z=c.filter(N=>N.grow>0&&N.size<N.max-1e-7)).length;){const N=_.sum(z.map(X=>X.grow)),H=Math.min(Math.min(...z.map(X=>(X.max-X.size)/X.grow)),D/N);assert&&assert(H>1e-11),z.forEach(X=>{X.size+=H*X.grow}),D-=H*N}const w=(c[0].hasOrigin()?c[0].minOrigin:0)+this.layoutOriginProperty.value[s.coordinate];r[s.minCoordinate]=w,r[s.maxCoordinate]=w+O,c.forEach((N,H)=>{const X=_.sum(c.slice(0,H).map(oe=>oe.size)),ae=_.sum(y.slice(0,H));N.position=w+X+ae}),e.forEach(N=>{const H=N.position.get(s),X=N.size.get(s),ae=H+X-1,oe=N.getIndices(s).map(J=>l.get(J)),ue=l.get(H);let fe=0;H!==ae&&c.slice(0,-1).forEach((J,Ue)=>{J.index>=H&&J.index<ae&&(fe+=y[Ue])});const be=_.sum(oe.map(J=>J.size))+fe,Ae=ue.position,W=N.reposition(s,be,Ae,N.getEffectiveStretch(s),-ue.minOrigin,N.getEffectiveAlign(s));r[s.minCoordinate]=Math.min(r[s.minCoordinate],W[s.minCoordinate]),r[s.maxCoordinate]=Math.max(r[s.maxCoordinate],W[s.maxCoordinate])})}),this.layoutBoundsProperty.value=r,this.minimumWidthProperty.value=t.horizontal,this.minimumHeightProperty.value=t.vertical,this.finishedLayoutEmitter.emit()}get spacing(){return assert&&assert(this.xSpacing===this.ySpacing),this.xSpacing}set spacing(e){assert&&assert(typeof e=="number"&&isFinite(e)&&e>=0||Array.isArray(e)&&_.every(e,t=>typeof t=="number"&&isFinite(t)&&t>=0)),(this._spacing.get(Orientation.HORIZONTAL)!==e||this._spacing.get(Orientation.VERTICAL)!==e)&&(this._spacing.set(Orientation.HORIZONTAL,e),this._spacing.set(Orientation.VERTICAL,e),this.updateLayoutAutomatically())}get xSpacing(){return this._spacing.get(Orientation.HORIZONTAL)}set xSpacing(e){assert&&assert(typeof e=="number"&&isFinite(e)&&e>=0||Array.isArray(e)&&_.every(e,t=>typeof t=="number"&&isFinite(t)&&t>=0)),this._spacing.get(Orientation.HORIZONTAL)!==e&&(this._spacing.set(Orientation.HORIZONTAL,e),this.updateLayoutAutomatically())}get ySpacing(){return this._spacing.get(Orientation.VERTICAL)}set ySpacing(e){assert&&assert(typeof e=="number"&&isFinite(e)&&e>=0||Array.isArray(e)&&_.every(e,t=>typeof t=="number"&&isFinite(t)&&t>=0)),this._spacing.get(Orientation.VERTICAL)!==e&&(this._spacing.set(Orientation.VERTICAL,e),this.updateLayoutAutomatically())}addCell(e){assert&&assert(!this.cells.has(e)),this.cells.add(e),this.addNode(e.node),e.changedEmitter.addListener(this._updateLayoutListener),this.updateLayoutAutomatically()}removeCell(e){assert&&assert(this.cells.has(e)),this.cells.delete(e),this.removeNode(e.node),e.changedEmitter.removeListener(this._updateLayoutListener),this.updateLayoutAutomatically()}dispose(){this.lock(),[...this.cells].forEach(e=>this.removeCell(e)),this.displayedLines.forEach(e=>e.clear()),this.displayedCells=[],super.dispose(),this.unlock()}getIndices(e){const t=[];return this.cells.forEach(n=>{t.push(...n.getIndices(e))}),_.sortedUniq(_.sortBy(t))}getCell(e,t){return _.find([...this.cells],n=>n.containsRow(e)&&n.containsColumn(t))||null}getCellFromNode(e){return _.find([...this.cells],t=>t.node===e)||null}getCells(e,t){return _.filter([...this.cells],n=>n.containsIndex(e,t))}static create(e,t){return new GridConstraint(e,t)}}scenery.register("GridConstraint",GridConstraint);const GRIDBOX_OPTION_KEYS=[...LAYOUT_NODE_OPTION_KEYS,...GRID_CONSTRAINT_OPTION_KEYS.filter(o=>o!=="excludeInvisible"),"rows","columns","autoRows","autoColumns"];class GridBox extends LayoutNode{constructor(e){const t=optionize()({excludeInvisibleChildrenFromBounds:!0,resize:!0},e);super(),this._cellMap=new Map,this._autoRows=null,this._autoColumns=null,this._autoLockCount=0,this._constraint=new GridConstraint(this,{preferredWidthProperty:this.localPreferredWidthProperty,preferredHeightProperty:this.localPreferredHeightProperty,minimumWidthProperty:this.localMinimumWidthProperty,minimumHeightProperty:this.localMinimumHeightProperty,layoutOriginProperty:this.layoutOriginProperty,excludeInvisible:!1}),this.onChildInserted=this.onGridBoxChildInserted.bind(this),this.onChildRemoved=this.onGridBoxChildRemoved.bind(this),this.onChildVisibilityToggled=this.updateAllAutoLines.bind(this),this.childInsertedEmitter.addListener(this.onChildInserted),this.childRemovedEmitter.addListener(this.onChildRemoved);const n=_.omit(t,REQUIRES_BOUNDS_OPTION_KEYS),r=_.pick(t,REQUIRES_BOUNDS_OPTION_KEYS);this._constraint.lock(),this.mutate(n),this._constraint.unlock(),this._constraint.updateLayout(),this.mutate(r),this.linkLayoutBounds()}setLines(e,t){const n=[];for(let r=0;r<t.length;r++){const s=t[r];for(let a=0;a<s.length;a++){const l=s[a];l!==null&&(n.push(l),l.mutateLayoutOptions({[e.line]:r,[e.opposite.line]:a}))}}this.children=n}getLines(e){const t=[];for(const n of this._cellMap.values()){const r=n.position.get(e),s=n.position.get(e.opposite);for(;t.length<r+1;)t.push([]);for(;t[r].length<s+1;)t[r].push(null);t[r][s]=n.node}return t}set rows(e){this.setLines(Orientation.VERTICAL,e)}get rows(){return this.getLines(Orientation.VERTICAL)}set columns(e){this.setLines(Orientation.HORIZONTAL,e)}get columns(){return this.getLines(Orientation.HORIZONTAL)}getNodeAt(e,t){const n=this.constraint.getCell(e,t);return n?n.node:null}getRowOfNode(e){return assert&&assert(this.children.includes(e)),this.constraint.getCellFromNode(e).position.vertical}getColumnOfNode(e){return assert&&assert(this.children.includes(e)),this.constraint.getCellFromNode(e).position.horizontal}getNodesInRow(e){return this.constraint.getCells(Orientation.VERTICAL,e).map(t=>t.node)}getNodesInColumn(e){return this.constraint.getCells(Orientation.HORIZONTAL,e).map(t=>t.node)}addRow(e){return this.rows=[...this.rows,e],this}addColumn(e){return this.columns=[...this.columns,e],this}insertRow(e,t){return this.rows=[...this.rows.slice(0,e),t,...this.rows.slice(e)],this}insertColumn(e,t){return this.columns=[...this.columns.slice(0,e),t,...this.columns.slice(e)],this}removeRow(e){return this.rows=[...this.rows.slice(0,e),...this.rows.slice(e+1)],this}removeColumn(e){return this.columns=[...this.columns.slice(0,e),...this.columns.slice(e+1)],this}set autoRows(e){assert&&assert(e===null||typeof e=="number"&&isFinite(e)&&e>=1),this._autoRows!==e&&(this._autoRows=e,this.updateAutoRows())}get autoRows(){return this._autoRows}set autoColumns(e){assert&&assert(e===null||typeof e=="number"&&isFinite(e)&&e>=1),this._autoColumns!==e&&(this._autoColumns=e,this.updateAutoColumns())}get autoColumns(){return this._autoColumns}updateAutoLines(e,t){if(t!==null&&this._autoLockCount===0){let n=0;this.constraint.lock(),this.children.filter(r=>r.bounds.isValid()&&(!this._constraint.excludeInvisible||r.visible)).forEach((r,s)=>{const a=s%t,l=Math.floor(s/t);(!r.layoutOptions||r.layoutOptions[e.line]!==a||r.layoutOptions[e.opposite.line]!==l||r.layoutOptions.horizontalSpan!==1||r.layoutOptions.verticalSpan!==1)&&(n++,r.mutateLayoutOptions({[e.line]:s%t,[e.opposite.line]:Math.floor(s/t),horizontalSpan:1,verticalSpan:1}))}),this.constraint.unlock(),n>0&&this.constraint.updateLayoutAutomatically()}}updateAutoRows(){this.updateAutoLines(Orientation.VERTICAL,this.autoRows)}updateAutoColumns(){this.updateAutoLines(Orientation.HORIZONTAL,this.autoColumns)}updateAllAutoLines(){assert&&assert(this._autoRows===null||this._autoColumns===null,"autoRows and autoColumns should not both be set when updating children"),this.updateAutoRows(),this.updateAutoColumns()}setChildren(e){const t=this.getChildren();return this._autoLockCount++,super.setChildren(e),this._autoLockCount--,_.isEqual(t,e)||this.updateAllAutoLines(),this}onGridBoxChildInserted(e,t){e.visibleProperty.lazyLink(this.onChildVisibilityToggled);const n=new GridCell(this._constraint,e,this._constraint.createLayoutProxy(e));this._cellMap.set(e,n),this._constraint.addCell(n),this.updateAllAutoLines()}onGridBoxChildRemoved(e){const t=this._cellMap.get(e);assert&&assert(t),this._cellMap.delete(e),this._constraint.removeCell(t),t.dispose(),this.updateAllAutoLines(),e.visibleProperty.unlink(this.onChildVisibilityToggled)}mutate(e){return assertMutuallyExclusiveOptions(e,["rows"],["columns"],["children","autoRows","autoColumns"]),e&&assert&&assert(typeof e.autoRows!="number"||typeof e.autoColumns!="number","autoRows and autoColumns should not be specified both as non-null at the same time"),super.mutate(e)}get spacing(){return this._constraint.spacing}set spacing(e){this._constraint.spacing=e}get xSpacing(){return this._constraint.xSpacing}set xSpacing(e){this._constraint.xSpacing=e}get ySpacing(){return this._constraint.ySpacing}set ySpacing(e){this._constraint.ySpacing=e}get xAlign(){return this._constraint.xAlign}set xAlign(e){this._constraint.xAlign=e}get yAlign(){return this._constraint.yAlign}set yAlign(e){this._constraint.yAlign=e}get grow(){return this._constraint.grow}set grow(e){this._constraint.grow=e}get xGrow(){return this._constraint.xGrow}set xGrow(e){this._constraint.xGrow=e}get yGrow(){return this._constraint.yGrow}set yGrow(e){this._constraint.yGrow=e}get stretch(){return this._constraint.stretch}set stretch(e){this._constraint.stretch=e}get xStretch(){return this._constraint.xStretch}set xStretch(e){this._constraint.xStretch=e}get yStretch(){return this._constraint.yStretch}set yStretch(e){this._constraint.yStretch=e}get margin(){return this._constraint.margin}set margin(e){this._constraint.margin=e}get xMargin(){return this._constraint.xMargin}set xMargin(e){this._constraint.xMargin=e}get yMargin(){return this._constraint.yMargin}set yMargin(e){this._constraint.yMargin=e}get leftMargin(){return this._constraint.leftMargin}set leftMargin(e){this._constraint.leftMargin=e}get rightMargin(){return this._constraint.rightMargin}set rightMargin(e){this._constraint.rightMargin=e}get topMargin(){return this._constraint.topMargin}set topMargin(e){this._constraint.topMargin=e}get bottomMargin(){return this._constraint.bottomMargin}set bottomMargin(e){this._constraint.bottomMargin=e}get minContentWidth(){return this._constraint.minContentWidth}set minContentWidth(e){this._constraint.minContentWidth=e}get minContentHeight(){return this._constraint.minContentHeight}set minContentHeight(e){this._constraint.minContentHeight=e}get maxContentWidth(){return this._constraint.maxContentWidth}set maxContentWidth(e){this._constraint.maxContentWidth=e}get maxContentHeight(){return this._constraint.maxContentHeight}set maxContentHeight(e){this._constraint.maxContentHeight=e}setExcludeInvisibleChildrenFromBounds(e){super.setExcludeInvisibleChildrenFromBounds(e),this.updateAllAutoLines()}dispose(){this._constraint.lock(),this.childInsertedEmitter.removeListener(this.onChildInserted),this.childRemovedEmitter.removeListener(this.onChildRemoved);for(const e of this._cellMap.values())e.dispose(),e.node.visibleProperty.unlink(this.onChildVisibilityToggled);super.dispose()}getHelperNode(){return MarginLayoutCell.createHelperNode(this.constraint.displayedCells,this.constraint.layoutBoundsProperty.value,t=>{let n="";return n+=`row: ${t.position.vertical}
`,n+=`column: ${t.position.horizontal}
`,t.size.horizontal>1&&(n+=`horizontalSpan: ${t.size.horizontal}
`),t.size.vertical>1&&(n+=`verticalSpan: ${t.size.vertical}
`),n+=`xAlign: ${LayoutAlign.internalToAlign(Orientation.HORIZONTAL,t.effectiveXAlign)}
`,n+=`yAlign: ${LayoutAlign.internalToAlign(Orientation.VERTICAL,t.effectiveYAlign)}
`,n+=`xStretch: ${t.effectiveXStretch}
`,n+=`yStretch: ${t.effectiveYStretch}
`,n+=`xGrow: ${t.effectiveXGrow}
`,n+=`yGrow: ${t.effectiveYGrow}
`,n})}}GridBox.prototype._mutatorKeys=[...SIZABLE_OPTION_KEYS,...GRIDBOX_OPTION_KEYS,...Node$2.prototype._mutatorKeys];scenery.register("GridBox",GridBox);class GridBackgroundNode extends Node$2{constructor(e,t){assertMutuallyExclusiveOptions(t,["createCellBackground"],["fill","stroke"]);const n=s=>Rectangle.bounds(s.lastAvailableBounds,{fill:r.fill,stroke:r.stroke}),r=optionize()({fill:"white",stroke:"black",createCellBackground:n},t);super(),this.constraint=e,this.createCellBackground=r.createCellBackground,this.layoutListener=this.update.bind(this),this.constraint.finishedLayoutEmitter.addListener(this.layoutListener),this.update(),this.mutate(r)}update(){this.children=this.constraint.displayedCells.map(this.createCellBackground).filter(_.identity)}dispose(){this.constraint.finishedLayoutEmitter.removeListener(this.layoutListener),super.dispose()}}scenery.register("GridBackgroundNode",GridBackgroundNode);class ManualConstraint extends LayoutConstraint{constructor(e,t,n){assert&&assert(Array.isArray(t)&&_.every(t,r=>r instanceof Node$2)),super(e),this.lock(),this.nodes=t,this.cells=t.map(r=>new LayoutCell(this,r,null)),this.layoutCallback=n,this.nodes.forEach(r=>this.addNode(r,!1)),this.unlock(),this.updateLayout()}layout(){if(super.layout(),assert&&assert(_.every(this.nodes,t=>!t.isDisposed)),!_.some(this.cells,t=>!t.isConnected())){const t=this.cells.map(n=>n.proxy);this.layoutCallback.apply(null,t),this.finishedLayoutEmitter.emit()}}dispose(){this.cells.forEach(e=>e.dispose()),super.dispose()}static create(e,t,n){return new ManualConstraint(e,t,n)}}scenery.register("ManualConstraint",ManualConstraint);class RelaxedManualConstraint extends LayoutConstraint{constructor(e,t,n){assert&&assert(Array.isArray(t)&&_.every(t,r=>r instanceof Node$2)),super(e),this.lock(),this.nodes=t,this.cells=t.map(r=>new LayoutCell(this,r,null)),this.layoutCallback=n,this.nodes.forEach(r=>this.addNode(r,!1)),this.unlock(),this.updateLayout()}layout(){super.layout(),assert&&assert(_.every(this.nodes,t=>!t.isDisposed));const e=this.cells.map(t=>t.isConnected()?t.proxy:null);this.layoutCallback.apply(null,e),this.finishedLayoutEmitter.emit()}dispose(){this.cells.forEach(e=>e.dispose()),super.dispose()}static create(e,t,n){return new RelaxedManualConstraint(e,t,n)}}scenery.register("RelaxedManualConstraint",RelaxedManualConstraint);const ALIGNMENT_CONTAINER_OPTION_KEYS=["alignBounds","xAlign","yAlign","margin","xMargin","yMargin","leftMargin","rightMargin","topMargin","bottomMargin","group"],AlignBoxXAlignValues=["left","center","right","stretch"],AlignBoxYAlignValues=["top","center","bottom","stretch"],SuperType=Sizable(Node$2);class AlignBox extends SuperType{constructor(e,t){const n=optionize()({children:[e]},t),r={sizable:!1};super(r),this._xSet=!1,this._ySet=!1,this._contentBoundsListener=_.noop,assert&&assert(n===void 0||Object.getPrototypeOf(n)===Object.prototype,"Extra prototype on Node options object is a code smell"),this._content=e,this._alignBounds=null,this._xAlign="center",this._yAlign="center",this._leftMargin=0,this._rightMargin=0,this._topMargin=0,this._bottomMargin=0,this._group=null,this._contentBoundsListener=this.invalidateAlignment.bind(this),this._alignBoundsProperty=null,this._alignBoundsPropertyListener=_.noop,assertMutuallyExclusiveOptions(n,["alignBounds"],["alignBoundsProperty"]),t!=null&&t.alignBoundsProperty&&(this._alignBoundsProperty=t.alignBoundsProperty,n.alignBounds=this._alignBoundsProperty.value,this._alignBoundsPropertyListener=s=>{this.alignBounds=s},this._alignBoundsProperty.lazyLink(this._alignBoundsPropertyListener)),this.localBounds=new Bounds2(0,0,0,0),this.constraint=new AlignBoxConstraint(this,e),this._content.boundsProperty.link(this._contentBoundsListener),this.mutate(n),Multilink.multilink([this.localPreferredWidthProperty,this.localPreferredHeightProperty],(s,a)=>{if(s!==null||a!==null){const l=this._alignBounds||new Bounds2(0,0,0,0);s&&(l.minX=0,l.maxX=s,this._xSet=!0),a&&(l.minY=0,l.maxY=a,this._ySet=!0),this._alignBounds=l,this.constraint.updateLayout()}})}invalidateAlignment(){sceneryLog&&sceneryLog.AlignBox&&sceneryLog.AlignBox(`AlignBox#${this.id} invalidateAlignment`),sceneryLog&&sceneryLog.AlignBox&&sceneryLog.push(),this._group&&this._group.onAlignBoxResized(this),this.constraint.updateLayout(),sceneryLog&&sceneryLog.AlignBox&&sceneryLog.pop()}setAlignBounds(e){return assert&&assert(e===null||e instanceof Bounds2&&!e.isEmpty()&&e.isFinite(),"alignBounds should be a non-empty finite Bounds2"),this._xSet=!0,this._ySet=!0,this._alignBounds!==e&&(!e||!this._alignBounds||!e.equals(this._alignBounds))&&(this._alignBounds=e,this.constraint.updateLayout()),this}set alignBounds(e){this.setAlignBounds(e)}get alignBounds(){return this.getAlignBounds()}getAlignBounds(){return this._alignBounds}setGroup(e){return assert&&assert(e===null||e instanceof AlignGroup,"group should be an AlignGroup"),this._group!==e&&(this._group&&this._group.removeAlignBox(this),this._group=e,this._group&&this._group.addAlignBox(this)),this}set group(e){this.setGroup(e)}get group(){return this.getGroup()}getGroup(){return this._group}setXAlign(e){return assert&&assert(AlignBoxXAlignValues.includes(e),`xAlign should be one of: ${AlignBoxXAlignValues}`),this._xAlign!==e&&(this._xAlign=e,this.invalidateAlignment()),this}set xAlign(e){this.setXAlign(e)}get xAlign(){return this.getXAlign()}getXAlign(){return this._xAlign}setYAlign(e){return assert&&assert(AlignBoxYAlignValues.includes(e),`xAlign should be one of: ${AlignBoxYAlignValues}`),this._yAlign!==e&&(this._yAlign=e,this.invalidateAlignment()),this}set yAlign(e){this.setYAlign(e)}get yAlign(){return this.getYAlign()}getYAlign(){return this._yAlign}setMargin(e){return assert&&assert(isFinite(e)&&e>=0,"margin should be a finite non-negative number"),(this._leftMargin!==e||this._rightMargin!==e||this._topMargin!==e||this._bottomMargin!==e)&&(this._leftMargin=this._rightMargin=this._topMargin=this._bottomMargin=e,this.invalidateAlignment()),this}set margin(e){this.setMargin(e)}get margin(){return this.getMargin()}getMargin(){return assert&&assert(this._leftMargin===this._rightMargin&&this._leftMargin===this._topMargin&&this._leftMargin===this._bottomMargin,"Getting margin does not have a unique result if the left and right margins are different"),this._leftMargin}setXMargin(e){return assert&&assert(isFinite(e)&&e>=0,"xMargin should be a finite non-negative number"),(this._leftMargin!==e||this._rightMargin!==e)&&(this._leftMargin=this._rightMargin=e,this.invalidateAlignment()),this}set xMargin(e){this.setXMargin(e)}get xMargin(){return this.getXMargin()}getXMargin(){return assert&&assert(this._leftMargin===this._rightMargin,"Getting xMargin does not have a unique result if the left and right margins are different"),this._leftMargin}setYMargin(e){return assert&&assert(isFinite(e)&&e>=0,"yMargin should be a finite non-negative number"),(this._topMargin!==e||this._bottomMargin!==e)&&(this._topMargin=this._bottomMargin=e,this.invalidateAlignment()),this}set yMargin(e){this.setYMargin(e)}get yMargin(){return this.getYMargin()}getYMargin(){return assert&&assert(this._topMargin===this._bottomMargin,"Getting yMargin does not have a unique result if the top and bottom margins are different"),this._topMargin}setLeftMargin(e){return assert&&assert(isFinite(e)&&e>=0,"leftMargin should be a finite non-negative number"),this._leftMargin!==e&&(this._leftMargin=e,this.invalidateAlignment()),this}set leftMargin(e){this.setLeftMargin(e)}get leftMargin(){return this.getLeftMargin()}getLeftMargin(){return this._leftMargin}setRightMargin(e){return assert&&assert(isFinite(e)&&e>=0,"rightMargin should be a finite non-negative number"),this._rightMargin!==e&&(this._rightMargin=e,this.invalidateAlignment()),this}set rightMargin(e){this.setRightMargin(e)}get rightMargin(){return this.getRightMargin()}getRightMargin(){return this._rightMargin}setTopMargin(e){return assert&&assert(isFinite(e)&&e>=0,"topMargin should be a finite non-negative number"),this._topMargin!==e&&(this._topMargin=e,this.invalidateAlignment()),this}set topMargin(e){this.setTopMargin(e)}get topMargin(){return this.getTopMargin()}getTopMargin(){return this._topMargin}setBottomMargin(e){return assert&&assert(isFinite(e)&&e>=0,"bottomMargin should be a finite non-negative number"),this._bottomMargin!==e&&(this._bottomMargin=e,this.invalidateAlignment()),this}set bottomMargin(e){this.setBottomMargin(e)}get bottomMargin(){return this.getBottomMargin()}getBottomMargin(){return this._bottomMargin}getContent(){return this._content}get content(){return this.getContent()}getContentBounds(){sceneryLog&&sceneryLog.AlignBox&&sceneryLog.AlignBox(`AlignBox#${this.id} getContentBounds`),sceneryLog&&sceneryLog.AlignBox&&sceneryLog.push();const e=this._content.bounds;return sceneryLog&&sceneryLog.AlignBox&&sceneryLog.pop(),new Bounds2(e.left-this._leftMargin,e.top-this._topMargin,e.right+this._rightMargin,e.bottom+this._bottomMargin)}setAdjustedLocalBounds(e){if(this._xSet&&this._ySet)this.localBounds=e;else if(this._xSet){const t=this.getContentBounds();this.localBounds=new Bounds2(e.minX,t.minY,e.maxX,t.maxY)}else if(this._ySet){const t=this.getContentBounds();this.localBounds=new Bounds2(t.minX,e.minY,t.maxX,e.maxY)}else this.localBounds=this.getContentBounds()}dispose(){this._alignBoundsProperty&&this._alignBoundsProperty.unlink(this._alignBoundsPropertyListener),this._content.boundsProperty.unlink(this._contentBoundsListener),this._content=new Node$2,this.group=null,this.constraint.dispose(),super.dispose()}mutate(e){return super.mutate(e)}}class AlignBoxConstraint extends LayoutConstraint{constructor(e,t){super(e),this.alignBox=e,this.content=t,this.addNode(t),e.isWidthResizableProperty.lazyLink(this._updateLayoutListener),e.isHeightResizableProperty.lazyLink(this._updateLayoutListener)}updateProperty(e,t){const n=this.content[e],r=this.alignBox.localBounds[e]+t;Math.abs(n-r)>1e-5&&(this.content[e]=r)}layout(){super.layout();const e=this.alignBox,t=this.content;if(sceneryLog&&sceneryLog.AlignBox&&sceneryLog.AlignBox(`AlignBoxConstraint#${this.alignBox.id} layout`),sceneryLog&&sceneryLog.AlignBox&&sceneryLog.push(),!t.bounds.isValid())return;const n=e.leftMargin+e.rightMargin,r=e.topMargin+e.bottomMargin;if(e.alignBounds!==null)e.setAdjustedLocalBounds(e.alignBounds);else{const l=t.width+n,d=t.height+r;e.setAdjustedLocalBounds(new Bounds2(0,0,l,d))}const s=isFinite(t.width)?(isWidthSizable(t)?t.minimumWidth||0:t.width)+n:null,a=isFinite(t.height)?(isHeightSizable(t)?t.minimumHeight||0:t.height)+r:null;t.localBounds.isEmpty()||(e.xAlign==="center"?this.updateProperty("centerX",(e.leftMargin-e.rightMargin)/2):e.xAlign==="left"?this.updateProperty("left",e.leftMargin):e.xAlign==="right"?this.updateProperty("right",-e.rightMargin):e.xAlign==="stretch"?(assert&&assert(isWidthSizable(t),"xAlign:stretch can only be used if WidthSizable is mixed into the content"),t.preferredWidth=e.localWidth-e.leftMargin-e.rightMargin,this.updateProperty("left",e.leftMargin)):assert&&assert(`Bad xAlign: ${e.xAlign}`),e.yAlign==="center"?this.updateProperty("centerY",(e.topMargin-e.bottomMargin)/2):e.yAlign==="top"?this.updateProperty("top",e.topMargin):e.yAlign==="bottom"?this.updateProperty("bottom",-e.bottomMargin):e.yAlign==="stretch"?(assert&&assert(isHeightSizable(t),"yAlign:stretch can only be used if HeightSizable is mixed into the content"),t.preferredHeight=e.localHeight-e.topMargin-e.bottomMargin,this.updateProperty("top",e.topMargin)):assert&&assert(`Bad yAlign: ${e.yAlign}`)),sceneryLog&&sceneryLog.AlignBox&&sceneryLog.pop(),e.localMinimumWidth=e.widthSizable?s:e.localWidth,e.localMinimumHeight=e.heightSizable?a:e.localHeight}}AlignBox.prototype._mutatorKeys=ALIGNMENT_CONTAINER_OPTION_KEYS.concat(SuperType.prototype._mutatorKeys);scenery.register("AlignBox",AlignBox);let globalId$2=1;const DEFAULT_OPTIONS$1={matchHorizontal:!0,matchVertical:!0};class AlignGroup extends Disposable{constructor(e){assert&&assert(e===void 0||Object.getPrototypeOf(e)===Object.prototype,"Extra prototype on options object is a code smell");const t=optionize3()({},DEFAULT_OPTIONS$1,e);assert&&assert(typeof t.matchHorizontal=="boolean"),assert&&assert(typeof t.matchVertical=="boolean"),super(t),this._alignBoxes=[],this._matchHorizontal=t.matchHorizontal,this._matchVertical=t.matchVertical,this._resizeLock=!1,this._maxWidthProperty=new NumberProperty(0),this._maxHeightProperty=new NumberProperty(0),this.id=globalId$2++}getMaxWidth(){return this._maxWidthProperty.value}get maxWidth(){return this.getMaxWidth()}getMaxWidthProperty(){return this._maxWidthProperty}get maxWidthProperty(){return this.getMaxWidthProperty()}getMaxHeight(){return this._maxHeightProperty.value}get maxHeight(){return this.getMaxHeight()}getMaxHeightProperty(){return this._maxHeightProperty}get maxHeightProperty(){return this.getMaxHeightProperty()}getMaxSizeProperty(e){return e===Orientation.HORIZONTAL?this._maxWidthProperty:this._maxHeightProperty}createBox(e,t){return new AlignBox(e,combineOptions({group:this},t))}setMatchHorizontal(e){return this._matchHorizontal!==e&&(this._matchHorizontal=e,this.updateLayout()),this}set matchHorizontal(e){this.setMatchHorizontal(e)}get matchHorizontal(){return this.getMatchHorizontal()}getMatchHorizontal(){return this._matchHorizontal}setMatchVertical(e){return this._matchVertical!==e&&(this._matchVertical=e,this.updateLayout()),this}set matchVertical(e){this.setMatchVertical(e)}get matchVertical(){return this.getMatchVertical()}getMatchVertical(){return this._matchVertical}updateLayout(){if(this._resizeLock)return;this._resizeLock=!0,sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.AlignGroup(`AlignGroup#${this.id} updateLayout`),sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.push(),sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.AlignGroup("AlignGroup computing maximum dimension"),sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.push();let e=0,t=0;for(let n=0;n<this._alignBoxes.length;n++){const s=this._alignBoxes[n].getContentBounds();s.isEmpty()||!s.isFinite()||(e=Math.max(e,s.width),t=Math.max(t,s.height))}if(sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.pop(),sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.AlignGroup("AlignGroup applying to boxes"),sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.push(),this._maxWidthProperty.value=e,this._maxHeightProperty.value=t,e>0&&t>0)for(let n=0;n<this._alignBoxes.length;n++)this.setBoxBounds(this._alignBoxes[n],e,t);sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.pop(),sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.pop(),this._resizeLock=!1}setBoxBounds(e,t,n){let r;if(this._matchVertical&&this._matchHorizontal)r=new Bounds2(0,0,t,n);else{const s=e.getContentBounds();this._matchVertical?r=new Bounds2(0,0,isFinite(s.width)?s.width:t,n):this._matchHorizontal?r=new Bounds2(0,0,t,isFinite(s.height)?s.height:n):r=s}e.alignBounds=r}onAlignBoxResized(e){this.updateLayout()}addAlignBox(e){this._alignBoxes.push(e),this.updateLayout()}removeAlignBox(e){arrayRemove(this._alignBoxes,e),this.updateLayout()}dispose(){for(let e=this._alignBoxes.length-1;e>=0;e--)this._alignBoxes[e].dispose();super.dispose()}}scenery.register("AlignGroup",AlignGroup);class HBox extends FlowBox{constructor(e){assert&&assert(!e||!e.orientation,"HBox sets orientation"),super(optionize()({orientation:"horizontal"},e))}onFlowBoxChildInserted(e,t){assert&&assert(!(e instanceof HSeparator),"HSeparator should not be used in an HBox. Use VSeparator instead"),super.onFlowBoxChildInserted(e,t)}mutate(e){return super.mutate(e)}}scenery.register("HBox",HBox);class VBox extends FlowBox{constructor(e){assert&&assert(!e||!e.orientation,"VBox sets orientation"),super(optionize()({orientation:"vertical"},e))}onFlowBoxChildInserted(e,t){assert&&assert(!(e instanceof VSeparator),"VSeparator should not be used in an VBox. Use HSeparator instead"),super.onFlowBoxChildInserted(e,t)}mutate(e){return super.mutate(e)}}scenery.register("VBox",VBox);const isHimalayaElementNode=o=>o.type.toLowerCase()==="element",isHimalayaTextNode=o=>o.type.toLowerCase()==="text",RichTextUtils={scratchText:new Text(""),himalayaGetAttribute(o,e){if(!e)return null;const t=_.find(e.attributes,n=>n.key===o);return t&&t.value||null},himalayaStyleStringToMap(o){const e=o.split(";"),t={};return e.forEach(n=>{if(n.length>0){const r=n.split(":");assert&&assert(r.length===2,"too many colons"),t[r[0].trim()]=r[1].trim()}}),t}};scenery.register("RichTextUtils",RichTextUtils);const RichTextCleanable=memoize(o=>(assert&&assert(_.includes(inheritance(o),Node$2),"Only Node subtypes should mix Paintable"),class extends o{get isCleanable(){return!0}clean(){const t=this;for(let n=t._children.length-1;n>=0;n--){const r=t._children[n];r.isCleanable&&(t.removeChild(r),r.clean())}t.matrix=Matrix3.IDENTITY,t.freeToPool()}}));scenery.register("RichTextCleanable",RichTextCleanable);const $l=class $l extends RichTextCleanable(Node$2){constructor(e){super(),this.initialize(e)}initialize(e){return this.localBounds=new Bounds2(0,0,0,e),this}freeToPool(){$l.pool.freeToPool(this)}};$l.pool=new Pool($l);let RichTextVerticalSpacer=$l;scenery.register("RichTextVerticalSpacer",RichTextVerticalSpacer);const Ul=class Ul extends RichTextCleanable(Node$2){constructor(e){super(),this.initialize(e)}initialize(e){return this.isLTR=e,this.leftSpacing=0,this.rightSpacing=0,this}addElement(e){const t=this.children.length>0,n=e.width>0,r=e.getScaleVector().x,s=e.leftSpacing*r,a=e.rightSpacing*r;if(!t&&!n)return sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText("No child or element, ignoring"),!1;if(t)if(!n)sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`No element, adding spacing, ltr:${this.isLTR}, spacing: ${s+a}`),this.isLTR?this.rightSpacing+=s+a:this.leftSpacing+=s+a;else return this.isLTR?(sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`LTR add ${this.rightSpacing} + ${s}`),e.left=this.localRight+this.rightSpacing+s,this.rightSpacing=a):(sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`RTL add ${this.leftSpacing} + ${a}`),e.right=this.localLeft-this.leftSpacing-a,this.leftSpacing=s),this.addChild(e),!0;else return sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`First child, ltr:${this.isLTR}, spacing: ${this.isLTR?a:s}`),this.isLTR?(e.left=0,this.leftSpacing=s,this.rightSpacing=a):(e.right=0,this.leftSpacing=s,this.rightSpacing=a),this.addChild(e),!0;return!1}addExtraBeforeSpacing(e){this.isLTR?this.leftSpacing+=e:this.rightSpacing+=e}freeToPool(){Ul.pool.freeToPool(this)}};Ul.pool=new Pool(Ul);let RichTextElement=Ul;scenery.register("RichTextElement",RichTextElement);const Gl=class Gl extends RichTextCleanable(Text){constructor(e,t,n,r,s,a,l){super(""),this.initialize(e,t,n,r,s,a,l)}initialize(e,t,n,r,s,a,l){let d="";for(;e.startsWith(" ");)d+=" ",e=e.slice(1);let c="";for(;e.endsWith(" ");)c=" ",e=e.slice(0,e.length-1);this.string=RichText.contentToString(e,t),this.boundsMethod=r,this.font=n,this.fill=s,this.stroke=a,this.lineWidth=l;const y=d.length?RichTextUtils.scratchText.setString(d).setFont(n).width:0,m=c.length?RichTextUtils.scratchText.setString(c).setFont(n).width:0;return this.leftSpacing=t?y:m,this.rightSpacing=t?m:y,this}clean(){super.clean(),this.fill=null,this.stroke=null}fitsIn(e,t,n){return this.width+(t?n?this.leftSpacing:this.rightSpacing:0)<=e}freeToPool(){Gl.pool.freeToPool(this)}};Gl.pool=new Pool(Gl);let RichTextLeaf=Gl;scenery.register("RichTextLeaf",RichTextLeaf);const Wl=class Wl extends RichTextCleanable(Node$2){constructor(e){super(),this.leftSpacing=0,this.rightSpacing=0,this.initialize(e)}initialize(e){return this.addChild(e),this}clean(){super.clean(),this.removeAllChildren()}fitsIn(e){return this.width<=e}freeToPool(){Wl.pool.freeToPool(this)}};Wl.pool=new Pool(Wl);let RichTextNode=Wl;scenery.register("RichTextNode",RichTextNode);const Yl=class Yl extends Voicing(RichTextCleanable(Node$2)){constructor(e,t){super(),this.fireListener=null,this.accessibleInputListener=null,this.allowLinksListener=null,this.initialize(e,t,!1),this.mutate({cursor:"pointer",tagName:"a"})}initialize(e,t,n=!0){return n&&super.initialize(),this.innerContent=e,this.voicingNameResponse=e,typeof t=="function"?(this.fireListener=new FireListener({fire:t,tandem:Tandem.OPT_OUT}),this.addInputListener(this.fireListener),this.setPDOMAttribute("href","#"),this.setPDOMAttribute("target","_self"),this.accessibleInputListener={click:r=>{r.domEvent&&r.domEvent.preventDefault(),t()}},this.addInputListener(this.accessibleInputListener)):(this.fireListener=new FireListener({fire:r=>{r.isFromPDOM()&&r.domEvent.preventDefault(),self._linkEventsHandled&&r.handle(),openPopup(t)},tandem:Tandem.OPT_OUT}),this.addInputListener(this.fireListener),this.setPDOMAttribute("href",t),this.setPDOMAttribute("target","_blank"),this.allowLinksListener=r=>{this.visible=r},allowLinksProperty.link(this.allowLinksListener)),this}clean(){super.clean(),this.fireListener&&(this.removeInputListener(this.fireListener),this.fireListener.dispose()),this.fireListener=null,this.accessibleInputListener&&(this.removeInputListener(this.accessibleInputListener),this.accessibleInputListener=null),this.allowLinksListener&&(allowLinksProperty.unlink(this.allowLinksListener),this.allowLinksListener=null)}freeToPool(){Yl.pool.freeToPool(this)}};Yl.pool=new Pool(Yl);let RichTextLink=Yl;scenery.register("RichTextLink",RichTextLink);const himalayaVar=himalaya;assert&&assert(himalayaVar,"himalaya dependency needed for RichText.");const RICH_TEXT_OPTION_KEYS=["boundsMethod","font","fill","stroke","lineWidth","subScale","subXSpacing","subYOffset","supScale","supXSpacing","supYOffset","capHeightScale","underlineLineWidth","underlineHeightScale","strikethroughLineWidth","strikethroughHeightScale","linkFill","linkEventsHandled","links","nodes","replaceNewlines","align","leading","lineWrap",Text.STRING_PROPERTY_NAME,"string"],isStringTest=window.QueryStringMachine&&QueryStringMachine.containsKey("stringTest"),DEFAULT_FONT$1=new Font({size:20}),ACCESSIBLE_TAGS=["b","strong","i","em","sub","sup","u","s"],LineBreakState={COMPLETE:"COMPLETE",INCOMPLETE:"INCOMPLETE",NONE:"NONE"},usedLinks=[],usedNodes=[],FONT_STYLE_MAP={"font-family":"family","font-size":"size","font-stretch":"stretch","font-style":"style","font-variant":"variant","font-weight":"weight","line-height":"lineHeight"},FONT_STYLE_KEYS=Object.keys(FONT_STYLE_MAP),STYLE_KEYS=["color"].concat(FONT_STYLE_KEYS),Rr=class Rr extends WidthSizable(Node$2){constructor(e,t){const n=optionize()({fill:"#000000",tandemNameSuffix:"Text",phetioType:Rr.RichTextIO,phetioVisiblePropertyInstrumented:!1},t);typeof e=="string"||typeof e=="number"?n.string=e:n.stringProperty=e,super(),this._font=DEFAULT_FONT$1,this._boundsMethod="hybrid",this._fill="#000000",this._stroke=null,this._lineWidth=1,this._subScale=.75,this._subXSpacing=0,this._subYOffset=0,this._supScale=.75,this._supXSpacing=0,this._supYOffset=0,this._capHeightScale=.75,this._underlineLineWidth=1,this._underlineHeightScale=.15,this._strikethroughLineWidth=1,this._strikethroughHeightScale=.3,this._linkFill="rgb(27,0,241)",this._linkEventsHandled=!1,this._links={},this._nodes={},this._replaceNewlines=!1,this._align="left",this._leading=0,this._lineWrap=null,this._linkItems=[],this._hasAddedLeafToLine=!1,this.needPendingMinimumWidth=!1,this.pendingMinimumWidth=0,this._stringProperty=new TinyForwardingProperty("",!0,this.onStringPropertyChange.bind(this)),this.lineContainer=new Node$2({}),this.addChild(this.lineContainer),this.rebuildRichText(),this.localPreferredWidthProperty.lazyLink(()=>this.rebuildRichText()),this.mutate(n)}onStringPropertyChange(){this.rebuildRichText()}setStringProperty(e){return this._stringProperty.setTargetProperty(e,this,Rr.STRING_PROPERTY_TANDEM_NAME)}set stringProperty(e){this.setStringProperty(e)}get stringProperty(){return this.getStringProperty()}getStringProperty(){return this._stringProperty}getPhetioMouseHitTarget(e=!1){return phetioElementSelectionProperty.value==="string"?this.getStringPropertyPhetioMouseHitTarget(e):super.getPhetioMouseHitTarget(e)}getStringPropertyPhetioMouseHitTarget(e=!1){const t=this._stringProperty.getTargetProperty();return t instanceof PhetioObject?t.getPhetioMouseHitTarget(e):"phetioNotSelectable"}initializePhetioObject(e,t){const n=optionize()({},t),r=this.isPhetioInstrumented();super.initializePhetioObject(e,n),Tandem.PHET_IO_ENABLED&&!r&&this.isPhetioInstrumented()&&this._stringProperty.initializePhetio(this,Rr.STRING_PROPERTY_TANDEM_NAME,()=>new StringProperty(this.string,combineOptions({phetioReadOnly:!0,tandem:this.tandem.createTandem(Rr.STRING_PROPERTY_TANDEM_NAME),phetioDocumentation:"Property for the displayed text"},n.stringPropertyOptions)))}rebuildRichText(){assert&&cleanArray(usedLinks),assert&&cleanArray(usedNodes);const e=this._lineWrap==="stretch";this.widthSizable=e,this.pendingMinimumWidth=0,this.needPendingMinimumWidth=e;const t=this._lineWrap==="stretch"?this.localPreferredWidth:this._lineWrap;if(this.freeChildrenToPool(),this.string===""){this.appendEmptyLeaf();return}sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`RichText#${this.id} rebuild`),sceneryLog&&sceneryLog.RichText&&sceneryLog.push();let n=this.string.replace(/\u202a/g,'<span dir="ltr">').replace(/\u202b/g,'<span dir="rtl">').replace(/\u202c/g,"</span>");this._replaceNewlines&&(n=n.replace(/\n/g,"<br>"));let r;try{r=himalayaVar.parse(n)}catch{r=himalayaVar.parse("INVALID TRANSLATION")}this._linkItems.length=0;const s=t===null?Number.POSITIVE_INFINITY:t,a=!0;let l=RichTextElement.pool.create(a);for(this._hasAddedLeafToLine=!1;r.length;){const d=r[0],c=l.bounds.isValid()?l.width:0,y=this.appendElement(l,d,this._font,this._fill,a,s-c,1);sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`lineBreakState: ${y}`),y!==LineBreakState.NONE&&(l.bounds.isValid()?(sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText("Adding line due to lineBreak"),this.appendLine(l)):this.appendLine(RichTextVerticalSpacer.pool.create(RichTextUtils.scratchText.setString("X").setFont(this._font).height)),l=RichTextElement.pool.create(a),this._hasAddedLeafToLine=!1),y!==LineBreakState.INCOMPLETE&&(sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText("Finished root element"),r.splice(0,1))}for(l.bounds.isValid()&&(sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText("Adding final line"),this.appendLine(l)),this.lineContainer.getChildrenCount()===0&&this.appendEmptyLeaf(),this.alignLines();this._linkItems.length;)(()=>{const d=this._linkItems[0].element,c=this._linkItems[0].href;let y;const m=[];for(y=this._linkItems.length-1;y>=0;y--){const D=this._linkItems[y];D.element===d&&(m.push(D.node),this._linkItems.splice(y,1))}const O=RichTextLink.pool.create(d.innerContent,c);for(this.lineContainer.addChild(O),y=0;y<m.length;y++){const D=m[y],z=D.getUniqueTrailTo(this.lineContainer).getMatrix();D.detach(),D.matrix=z,O.addChild(D)}})();this._linkItems.length=0,assert&&(this._links&&this._links!==!0&&Object.keys(this._links).forEach(d=>{assert&&allowLinksProperty.value&&!isStringTest&&assert(usedLinks.includes(d),`Unused RichText link: ${d}`)}),this._nodes&&Object.keys(this._nodes).forEach(d=>{assert&&allowLinksProperty.value&&!isStringTest&&assert(usedNodes.includes(d),`Unused RichText node: ${d}`)})),this.localMinimumWidth=e?this.pendingMinimumWidth:this.localBounds.width,sceneryLog&&sceneryLog.RichText&&sceneryLog.pop()}freeChildrenToPool(){for(;this.lineContainer._children.length;){const e=this.lineContainer._children[this.lineContainer._children.length-1];this.lineContainer.removeChild(e),e.clean()}}dispose(){this.freeChildrenToPool(),super.dispose(),this._stringProperty.dispose()}appendLine(e){this.lineContainer.bounds.isValid()&&(e.top=this.lineContainer.bottom+this._leading,e.left=0),this.lineContainer.addChild(e)}appendEmptyLeaf(){assert&&assert(this.lineContainer.getChildrenCount()===0),this.appendLine(RichTextLeaf.pool.create("",!0,this._font,this._boundsMethod,this._fill,this._stroke,this._lineWidth))}alignLines(){const e=this._align==="center"?"centerX":this._align,t=this.lineContainer[e];for(let n=0;n<this.lineContainer.getChildrenCount();n++)this.lineContainer.getChildAt(n)[e]=t}appendElement(e,t,n,r,s,a,l){let d=LineBreakState.NONE,c;const y=s?e.rightSpacing:e.leftSpacing,m=a-y;if(isHimalayaTextNode(t)){if(sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`appending leaf: ${t.content}`),sceneryLog&&sceneryLog.RichText&&sceneryLog.push(),c=RichTextLeaf.pool.create(t.content,s,n,this._boundsMethod,r,this._stroke,this._lineWidth),this.needPendingMinimumWidth&&(this.pendingMinimumWidth=Math.max(this.pendingMinimumWidth,Math.max(...getLineBreakRanges(t.content).map(O=>{const D=t.content.slice(O.min,O.max),z=RichTextLeaf.pool.create(D,s,n,this._boundsMethod,r,this._stroke,this._lineWidth),w=z.width*l;return z.dispose(),w})))),!c.fitsIn(m,this._hasAddedLeafToLine,s)){const O=getLineBreakRanges(t.content),D=z=>z.length===0?"":t.content.slice(z[0].min,z[z.length-1].max);if(sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`Overflow leafAdded:${this._hasAddedLeafToLine}, words: ${O.length}`),this._hasAddedLeafToLine||O.length>1){sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText("Skipping words");const z=[];let w=!1;for(z.unshift(O.pop());O.length;)if(c.clean(),c=RichTextLeaf.pool.create(D(O),s,n,this._boundsMethod,r,this._stroke,this._lineWidth),!c.fitsIn(m,this._hasAddedLeafToLine,s)&&(this._hasAddedLeafToLine||O.length>1))sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`Skipping word ${D([O[O.length-1]])}`),z.unshift(O.pop());else{sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`Success with ${D(O)}`),w=!0;break}if(w)d=LineBreakState.INCOMPLETE,t.content=D(z),sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`Remaining content: ${t.content}`);else return c.clean(),LineBreakState.INCOMPLETE}}this._hasAddedLeafToLine=!0,sceneryLog&&sceneryLog.RichText&&sceneryLog.pop()}else if(isHimalayaElementNode(t)){if(t.tagName==="br")return sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText("manual line break"),LineBreakState.COMPLETE;if(t.tagName==="span"){const z=RichTextUtils.himalayaGetAttribute("dir",t);z&&(assert&&assert(z==="ltr"||z==="rtl","Span dir attributes should be ltr or rtl."),s=z==="ltr")}if(t.tagName==="node"){const z=RichTextUtils.himalayaGetAttribute("id",t),w=z&&this._nodes[z]||null;if(assert&&assert(w,z?`Could not find a matching item in RichText's nodes for ${z}. It should be provided in the nodes option`:"No id attribute provided for a given <node> element"),w){if(assert&&usedNodes.push(z),c=RichTextNode.pool.create(w),this._hasAddedLeafToLine&&!c.fitsIn(m))return c.clean(),LineBreakState.INCOMPLETE;const N=RichTextUtils.himalayaGetAttribute("align",t);if(N==="center"||N==="top"||N==="bottom"){const H=RichTextUtils.scratchText.setString("Test").setFont(n).bounds;N==="center"?c.centerY=H.centerY:N==="top"?c.top=H.top:N==="bottom"&&(c.bottom=H.bottom)}}else return d;this._hasAddedLeafToLine=!0}else c=RichTextElement.pool.create(s);sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText("appending element"),sceneryLog&&sceneryLog.RichText&&sceneryLog.push();const O=RichTextUtils.himalayaGetAttribute("style",t);if(O){const z=RichTextUtils.himalayaStyleStringToMap(O);assert&&Object.keys(z).forEach(N=>{assert(_.includes(STYLE_KEYS,N),"See supported style CSS keys")}),z.color&&(r=new Color(z.color));const w={};for(let N=0;N<FONT_STYLE_KEYS.length;N++){const H=FONT_STYLE_KEYS[N];z[H]&&(w[FONT_STYLE_MAP[H]]=z[H])}n=(typeof n=="string"?Font.fromCSS(n):n).copy(w)}if(t.tagName==="a"){let z=RichTextUtils.himalayaGetAttribute("href",t);const w=z;if(z!==null&&this._links!==!0)if(z.startsWith("{{")&&z.indexOf("}}")===z.length-2){const N=z.slice(2,-2);z=this._links[N],assert&&usedLinks.push(N)}else z=null;assert&&assert(z,`Could not find a matching item in RichText's links for ${w}. It should be provided in the links option, or links should be turned to true (to allow the string to create its own urls`),z&&(this._linkFill!==null&&(r=this._linkFill),t.innerContent||(t.innerContent=Rr.himalayaElementToAccessibleString(t,s)),this._linkItems.push({element:t,node:c,href:z}))}else t.tagName==="b"||t.tagName==="strong"?n=(typeof n=="string"?Font.fromCSS(n):n).copy({weight:"bold"}):t.tagName==="i"||t.tagName==="em"?n=(typeof n=="string"?Font.fromCSS(n):n).copy({style:"italic"}):t.tagName==="sub"?(c.scale(this._subScale),c.addExtraBeforeSpacing(this._subXSpacing),c.y+=this._subYOffset):t.tagName==="sup"&&(c.scale(this._supScale),c.addExtraBeforeSpacing(this._supXSpacing),c.y+=this._supYOffset);const D=c.getScaleVector().x;if(t.tagName!=="node"){for(;d===LineBreakState.NONE&&t.children.length;){const z=c.bounds.isValid()?c.width:0,w=t.children[0];d=this.appendElement(c,w,n,r,s,a/D,l*D),d!==LineBreakState.INCOMPLETE&&t.children.splice(0,1);const N=c.bounds.isValid()?c.width:0;a+=z-N}d===LineBreakState.COMPLETE&&t.children.length&&(d=LineBreakState.INCOMPLETE)}if(t.tagName==="sub")isFinite(c.height)&&(c.centerY=0);else if(t.tagName==="sup")isFinite(c.height)&&(c.centerY=RichTextUtils.scratchText.setString("X").setFont(n).top*this._capHeightScale);else if(t.tagName==="u"){const z=-c.top*this._underlineHeightScale;isFinite(c.top)&&c.addChild(new Line(c.localLeft,z,c.localRight,z,{stroke:r,lineWidth:this._underlineLineWidth}))}else if(t.tagName==="s"){const z=c.top*this._strikethroughHeightScale;isFinite(c.top)&&c.addChild(new Line(c.localLeft,z,c.localRight,z,{stroke:r,lineWidth:this._strikethroughLineWidth}))}sceneryLog&&sceneryLog.RichText&&sceneryLog.pop()}return c&&(e.addElement(c)||(this._linkItems=this._linkItems.filter(D=>D.node!==c),c.clean())),d}setString(e){return assert&&assert(e!=null,"String should be defined and non-null. Use the empty string if needed."),e=`${e}`,this._stringProperty.set(e),this}set string(e){this.setString(e)}get string(){return this.getString()}getString(){return this._stringProperty.value}setBoundsMethod(e){return assert&&assert(e==="fast"||e==="fastCanvas"||e==="accurate"||e==="hybrid","Unknown Text boundsMethod"),e!==this._boundsMethod&&(this._boundsMethod=e,this.rebuildRichText()),this}set boundsMethod(e){this.setBoundsMethod(e)}get boundsMethod(){return this.getBoundsMethod()}getBoundsMethod(){return this._boundsMethod}setFont(e){return this._font!==e&&(this._font=e,this.rebuildRichText()),this}set font(e){this.setFont(e)}get font(){return this.getFont()}getFont(){return this._font}setFill(e){return this._fill!==e&&(this._fill=e,this.rebuildRichText()),this}set fill(e){this.setFill(e)}get fill(){return this.getFill()}getFill(){return this._fill}setStroke(e){return this._stroke!==e&&(this._stroke=e,this.rebuildRichText()),this}set stroke(e){this.setStroke(e)}get stroke(){return this.getStroke()}getStroke(){return this._stroke}setLineWidth(e){return this._lineWidth!==e&&(this._lineWidth=e,this.rebuildRichText()),this}set lineWidth(e){this.setLineWidth(e)}get lineWidth(){return this.getLineWidth()}getLineWidth(){return this._lineWidth}setSubScale(e){return assert&&assert(isFinite(e)&&e>0),this._subScale!==e&&(this._subScale=e,this.rebuildRichText()),this}set subScale(e){this.setSubScale(e)}get subScale(){return this.getSubScale()}getSubScale(){return this._subScale}setSubXSpacing(e){return assert&&assert(isFinite(e)),this._subXSpacing!==e&&(this._subXSpacing=e,this.rebuildRichText()),this}set subXSpacing(e){this.setSubXSpacing(e)}get subXSpacing(){return this.getSubXSpacing()}getSubXSpacing(){return this._subXSpacing}setSubYOffset(e){return assert&&assert(isFinite(e)),this._subYOffset!==e&&(this._subYOffset=e,this.rebuildRichText()),this}set subYOffset(e){this.setSubYOffset(e)}get subYOffset(){return this.getSubYOffset()}getSubYOffset(){return this._subYOffset}setSupScale(e){return assert&&assert(isFinite(e)&&e>0),this._supScale!==e&&(this._supScale=e,this.rebuildRichText()),this}set supScale(e){this.setSupScale(e)}get supScale(){return this.getSupScale()}getSupScale(){return this._supScale}setSupXSpacing(e){return assert&&assert(isFinite(e)),this._supXSpacing!==e&&(this._supXSpacing=e,this.rebuildRichText()),this}set supXSpacing(e){this.setSupXSpacing(e)}get supXSpacing(){return this.getSupXSpacing()}getSupXSpacing(){return this._supXSpacing}setSupYOffset(e){return assert&&assert(isFinite(e)),this._supYOffset!==e&&(this._supYOffset=e,this.rebuildRichText()),this}set supYOffset(e){this.setSupYOffset(e)}get supYOffset(){return this.getSupYOffset()}getSupYOffset(){return this._supYOffset}setCapHeightScale(e){return assert&&assert(isFinite(e)&&e>0),this._capHeightScale!==e&&(this._capHeightScale=e,this.rebuildRichText()),this}set capHeightScale(e){this.setCapHeightScale(e)}get capHeightScale(){return this.getCapHeightScale()}getCapHeightScale(){return this._capHeightScale}setUnderlineLineWidth(e){return assert&&assert(isFinite(e)&&e>0),this._underlineLineWidth!==e&&(this._underlineLineWidth=e,this.rebuildRichText()),this}set underlineLineWidth(e){this.setUnderlineLineWidth(e)}get underlineLineWidth(){return this.getUnderlineLineWidth()}getUnderlineLineWidth(){return this._underlineLineWidth}setUnderlineHeightScale(e){return assert&&assert(isFinite(e)&&e>0),this._underlineHeightScale!==e&&(this._underlineHeightScale=e,this.rebuildRichText()),this}set underlineHeightScale(e){this.setUnderlineHeightScale(e)}get underlineHeightScale(){return this.getUnderlineHeightScale()}getUnderlineHeightScale(){return this._underlineHeightScale}setStrikethroughLineWidth(e){return assert&&assert(isFinite(e)&&e>0),this._strikethroughLineWidth!==e&&(this._strikethroughLineWidth=e,this.rebuildRichText()),this}set strikethroughLineWidth(e){this.setStrikethroughLineWidth(e)}get strikethroughLineWidth(){return this.getStrikethroughLineWidth()}getStrikethroughLineWidth(){return this._strikethroughLineWidth}setStrikethroughHeightScale(e){return assert&&assert(isFinite(e)&&e>0),this._strikethroughHeightScale!==e&&(this._strikethroughHeightScale=e,this.rebuildRichText()),this}set strikethroughHeightScale(e){this.setStrikethroughHeightScale(e)}get strikethroughHeightScale(){return this.getStrikethroughHeightScale()}getStrikethroughHeightScale(){return this._strikethroughHeightScale}setLinkFill(e){return this._linkFill!==e&&(this._linkFill=e,this.rebuildRichText()),this}set linkFill(e){this.setLinkFill(e)}get linkFill(){return this.getLinkFill()}getLinkFill(){return this._linkFill}setLinkEventsHandled(e){return this._linkEventsHandled!==e&&(this._linkEventsHandled=e,this.rebuildRichText()),this}set linkEventsHandled(e){this.setLinkEventsHandled(e)}get linkEventsHandled(){return this.getLinkEventsHandled()}getLinkEventsHandled(){return this._linkEventsHandled}setLinks(e){return assert&&assert(e===!0||Object.getPrototypeOf(e)===Object.prototype),this._links!==e&&(this._links=e,this.rebuildRichText()),this}getLinks(){return this._links}set links(e){this.setLinks(e)}get links(){return this.getLinks()}setNodes(e){return assert&&assert(Object.getPrototypeOf(e)===Object.prototype),this._nodes!==e&&(this._nodes=e,this.rebuildRichText()),this}getNodes(){return this._nodes}set nodes(e){this.setNodes(e)}get nodes(){return this.getNodes()}setReplaceNewlines(e){return this._replaceNewlines!==e&&(this._replaceNewlines=e,this.rebuildRichText()),this}set replaceNewlines(e){this.setReplaceNewlines(e)}get replaceNewlines(){return this.getReplaceNewlines()}getReplaceNewlines(){return this._replaceNewlines}setAlign(e){return assert&&assert(e==="left"||e==="center"||e==="right"),this._align!==e&&(this._align=e,this.rebuildRichText()),this}set align(e){this.setAlign(e)}get align(){return this.getAlign()}getAlign(){return this._align}setLeading(e){return assert&&assert(isFinite(e)),this._leading!==e&&(this._leading=e,this.rebuildRichText()),this}set leading(e){this.setLeading(e)}get leading(){return this.getLeading()}getLeading(){return this._leading}setLineWrap(e){return assert&&assert(e===null||e==="stretch"||isFinite(e)&&e>0),this._lineWrap!==e&&(this._lineWrap=e,this.rebuildRichText()),this}set lineWrap(e){this.setLineWrap(e)}get lineWrap(){return this.getLineWrap()}getLineWrap(){return this._lineWrap}mutate(e){return assert&&e&&e.hasOwnProperty("string")&&e.hasOwnProperty(Text.STRING_PROPERTY_NAME)&&e.stringProperty&&assert&&assert(e.stringProperty.value===e.string,"If both string and stringProperty are provided, then values should match"),super.mutate(e)}static stringWithFont(e,t){return`<span style='font-style: ${t.style};font-variant: ${t.variant};font-weight: ${t.weight};font-stretch: ${t.stretch};font-size: ${t.size};font-family: ${t.family};line-height: ${t.lineHeight};'>${e}</span>`}static himalayaElementToString(e,t){if(isHimalayaTextNode(e))return Rr.contentToString(e.content,t);if(isHimalayaElementNode(e)){const n=RichTextUtils.himalayaGetAttribute("dir",e);return e.tagName==="span"&&n&&(t=n==="ltr"),e.children.map(r=>Rr.himalayaElementToString(r,t)).join("")}else return""}static himalayaElementToAccessibleString(e,t){if(isHimalayaTextNode(e))return Rr.contentToString(e.content,t);if(isHimalayaElementNode(e)){const n=RichTextUtils.himalayaGetAttribute("dir",e);e.tagName==="span"&&n&&(t=n==="ltr");const r=e.children.map(s=>Rr.himalayaElementToAccessibleString(s,t)).join("");return _.includes(ACCESSIBLE_TAGS,e.tagName)?`<${e.tagName}>${r}</${e.tagName}>`:r}else return""}static contentToString(e,t){const n=he.decode(e);return t?`‪${n}‬`:`‫${n}‬`}};Rr.STRING_PROPERTY_TANDEM_NAME=Text.STRING_PROPERTY_TANDEM_NAME;let RichText=Rr;RichText.prototype._mutatorKeys=RICH_TEXT_OPTION_KEYS.concat(Node$2.prototype._mutatorKeys);scenery.register("RichText",RichText);RichText.RichTextIO=new IOType("RichTextIO",{valueType:RichText,supertype:Node$2.NodeIO,documentation:"The PhET-iO Type for the scenery RichText node"});class VoicingText extends ReadingBlock(Text){constructor(e,t){const n=optionize()({readingBlockNameResponse:e,tagName:"p",innerContent:e},t);super(e),this.focusHighlight=new ReadingBlockHighlight(this),this.mutate(n)}}scenery.register("VoicingText",VoicingText);class VoicingRichText extends ReadingBlock(RichText){constructor(e,t){const n=optionize()({readingBlockNameResponse:e,innerContent:e,readingBlockTagName:"button"},t);super(e,n),this.focusHighlight=new ReadingBlockHighlight(this)}}scenery.register("VoicingRichText",VoicingRichText);const scenerySerialize=o=>{if(o instanceof Vector2)return{type:"Vector2",x:o.x,y:o.y};if(o instanceof Matrix3)return{type:"Matrix3",m00:o.m00(),m01:o.m01(),m02:o.m02(),m10:o.m10(),m11:o.m11(),m12:o.m12(),m20:o.m20(),m21:o.m21(),m22:o.m22()};if(o instanceof Bounds2){const e=o;return{type:"Bounds2",maxX:e.maxX,maxY:e.maxY,minX:e.minX,minY:e.minY}}else{if(o instanceof Shape$1)return{type:"Shape",path:o.getSVGPath()};if(Array.isArray(o))return{type:"Array",value:o.map(scenerySerialize)};if(o instanceof Color)return{type:"Color",red:o.red,green:o.green,blue:o.blue,alpha:o.alpha};if(o instanceof ReadOnlyProperty)return{type:"Property",value:scenerySerialize(o.value)};if(o instanceof TinyProperty)return{type:"TinyProperty",value:scenerySerialize(o.value)};if(Paint&&o instanceof Paint){const e={};return o.transformMatrix&&(e.transformMatrix=scenerySerialize(o.transformMatrix)),Gradient&&(o instanceof RadialGradient||o instanceof LinearGradient)&&(e.stops=o.stops.map(t=>({ratio:t.ratio,stop:scenerySerialize(t.color)})),e.start=scenerySerialize(o.start),e.end=scenerySerialize(o.end),LinearGradient&&o instanceof LinearGradient?e.type="LinearGradient":RadialGradient&&o instanceof RadialGradient&&(e.type="RadialGradient",e.startRadius=o.startRadius,e.endRadius=o.endRadius)),Pattern&&o instanceof Pattern&&(e.type="Pattern",e.url=o.image.src),e}else if(o instanceof Node$2){const e=o,t={},n={};["visible","opacity","disabledOpacity","pickable","inputEnabled","cursor","transformBounds","renderer","usesOpacity","layerSplit","cssTransform","excludeInvisible","webglScale","preventFit"].forEach(s=>{e[s]!==Node$2.DEFAULT_NODE_OPTIONS[s]&&(t[s]=e[s])}),["tagName","innerContent","accessibleName","helpText"].forEach(s=>{e[s]!==null&&(t[s]=e[s])}),["maxWidth","maxHeight","clipArea","mouseArea","touchArea"].forEach(s=>{e[s]!==Node$2.DEFAULT_NODE_OPTIONS[s]&&(n[s]=scenerySerialize(e[s]))}),e.matrix.isIdentity()||(n.matrix=scenerySerialize(e.matrix)),e._localBoundsOverridden&&(n.localBounds=scenerySerialize(e.localBounds)),n.children=e.children.map(s=>s.id),n.hasInputListeners=e.inputListeners.length>0;const r={id:e.id,type:"Node",types:inheritance(e.constructor).map(s=>s.name).filter(s=>s&&s!=="Object"&&s!=="Node"),name:e.constructor.name,options:t,setup:n};if(Path&&e instanceof Path&&(r.type="Path",n.path=scenerySerialize(e.shape),e.boundsMethod!==Path.DEFAULT_PATH_OPTIONS.boundsMethod&&(t.boundsMethod=e.boundsMethod)),Circle&&e instanceof Circle&&(r.type="Circle",t.radius=e.radius),Line&&e instanceof Line&&(r.type="Line",t.x1=e.x1,t.y1=e.y1,t.x2=e.x2,t.y2=e.y2),Rectangle&&e instanceof Rectangle&&(r.type="Rectangle",t.rectX=e.rectX,t.rectY=e.rectY,t.rectWidth=e.rectWidth,t.rectHeight=e.rectHeight,t.cornerXRadius=e.cornerXRadius,t.cornerYRadius=e.cornerYRadius),Text&&e instanceof Text&&(r.type="Text",e.boundsMethod!=="hybrid"&&(t.boundsMethod=e.boundsMethod),t.string=e.string,t.font=e.font),Image$1&&e instanceof Image$1&&(r.type="Image",["imageOpacity","initialWidth","initialHeight","mipmapBias","mipmapInitialLevel","mipmapMaxLevel"].forEach(s=>{e[s]!==Image$1.DEFAULT_IMAGE_OPTIONS[s]&&(t[s]=e[s])}),n.width=e.imageWidth,n.height=e.imageHeight,e._mipmapData?(n.imageType="mipmapData",n.mipmapData=e._mipmapData.map(s=>({url:s.url,width:s.width,height:s.height}))):(e._mipmap&&(n.generateMipmaps=!0),e._image instanceof HTMLImageElement?(n.imageType="image",n.src=e._image.src):e._image instanceof HTMLCanvasElement&&(n.imageType="canvas",n.src=e._image.toDataURL()))),CanvasNode&&e instanceof CanvasNode||WebGLNode&&e instanceof WebGLNode){r.type=CanvasNode&&e instanceof CanvasNode?"CanvasNode":"WebGLNode",n.canvasBounds=scenerySerialize(e.canvasBounds);const s=1,a=document.createElement("canvas");a.width=Math.ceil(e.canvasBounds.width*s),a.height=Math.ceil(e.canvasBounds.height*s);const l=a.getContext("2d"),d=new CanvasContextWrapper(a,l),c=Matrix3.scale(1/s);d.context.setTransform(s,0,0,s,-e.canvasBounds.left,-e.canvasBounds.top),e.renderToCanvasSelf(d,c),n.url=a.toDataURL(),n.scale=s,n.offset=scenerySerialize(e.canvasBounds.leftTop)}return DOM&&e instanceof DOM&&(r.type="DOM",r.element=new window.XMLSerializer().serializeToString(e.element),e.element instanceof window.HTMLCanvasElement&&(r.dataURL=e.element.toDataURL()),t.preventTransform=e.preventTransform),(Path&&e instanceof Path||Text&&e instanceof Text)&&(["fillPickable","strokePickable","lineWidth","lineCap","lineJoin","lineDashOffset","miterLimit"].forEach(s=>{e[s]!==DEFAULT_OPTIONS$6[s]&&(t[s]=e[s])}),e.fill!==DEFAULT_OPTIONS$6.fill&&(n.fill=scenerySerialize(e.fill)),e.stroke!==DEFAULT_OPTIONS$6.stroke&&(n.stroke=scenerySerialize(e.stroke)),e.lineDash.length&&(n.lineDash=scenerySerialize(e.lineDash))),r}else return o instanceof Display?{type:"Display",width:o.width,height:o.height,backgroundColor:scenerySerialize(o.backgroundColor),tree:{type:"Subtree",rootNodeId:o.rootNode.id,nodes:serializeConnectedNodes(o.rootNode)}}:{type:"value",value:o}}},serializeConnectedNodes=o=>o.getSubtreeNodes().map(scenerySerialize);scenery.register("scenerySerialize",scenerySerialize);const sceneryDeserialize=o=>{const e=["Node","Path","Circle","Line","Rectangle","Text","Image","CanvasNode","WebGLNode","DOM"];if(o.type==="Vector2")return new Vector2(o.x,o.y);if(o.type==="Matrix3")return new Matrix3().rowMajor(o.m00,o.m01,o.m02,o.m10,o.m11,o.m12,o.m20,o.m21,o.m22);if(o.type==="Bounds2")return new Bounds2(o.minX,o.minY,o.maxX,o.maxY);if(o.type==="Shape")return new Shape$1(o.path);if(o.type==="Array")return o.value.map(sceneryDeserialize);if(o.type==="Color")return new Color(o.red,o.green,o.blue,o.alpha);if(o.type==="Property")return new Property(sceneryDeserialize(o.value));if(o.type==="TinyProperty")return new TinyProperty(sceneryDeserialize(o.value));if(o.type==="Pattern"||o.type==="LinearGradient"||o.type==="RadialGradient"){let t;if(o.type==="Pattern"){const n=new window.Image;n.src=o.url,t=new Pattern(n)}else{const n=sceneryDeserialize(o.start),r=sceneryDeserialize(o.end);o.type==="LinearGradient"?t=new LinearGradient(n.x,n.y,r.x,r.y):o.type==="RadialGradient"&&(t=new RadialGradient(n.x,n.y,o.startRadius,r.x,r.y,o.endRadius)),o.stops.forEach(s=>{t.addColorStop(s.ratio,sceneryDeserialize(s.stop))})}return o.transformMatrix&&t.setTransformMatrix(sceneryDeserialize(o.transformMatrix)),t}else if(_.includes(e,o.type)){let t;const n=o.setup;if(o.type==="Node")t=new Node$2;else if(o.type==="Path")t=new Path(sceneryDeserialize(n.path));else if(o.type==="Circle")t=new Circle({});else if(o.type==="Line")t=new Line({});else if(o.type==="Rectangle")t=new Rectangle({});else if(o.type==="Text")t=new Text("");else if(o.type==="Image"){if(n.imageType==="image"||n.imageType==="canvas")t=new Image$1(n.src),n.generateMipmaps&&(t.mipmap=!0);else if(n.imageType==="mipmapData"){const r=n.mipmapData.map(s=>{const a={width:s.width,height:s.height,url:s.url};a.img=new window.Image,a.img.src=s.url,a.canvas=document.createElement("canvas"),a.canvas.width=s.width,a.canvas.height=s.height;const l=a.canvas.getContext("2d");return a.updateCanvas=function(){a.img.complete&&(typeof a.img.naturalWidth>"u"||a.img.naturalWidth>0)&&(l.drawImage(a.img,0,0),delete a.updateCanvas)},a});t=new Image$1(r)}t.initialWidth=n.width,t.initialHeight=n.height}else if(o.type==="CanvasNode"||o.type==="WebGLNode")t=new Node$2({children:[new Image$1(n.url,{translation:sceneryDeserialize(n.offset),scale:1/n.scale})]});else if(o.type==="DOM"){const r=document.createElement("div");r.innerHTML=o.element;const s=r.childNodes[0];if(r.removeChild(s),o.dataURL){const a=new window.Image;a.onload=()=>{s.getContext("2d").drawImage(a,0,0)},a.src=o.dataURL}t=new DOM(s)}return n.clipArea&&(t.clipArea=sceneryDeserialize(n.clipArea)),n.mouseArea&&(t.mouseArea=sceneryDeserialize(n.mouseArea)),n.touchArea&&(t.touchArea=sceneryDeserialize(n.touchArea)),n.matrix&&(t.matrix=sceneryDeserialize(n.matrix)),n.localBounds&&(t.localBounds=sceneryDeserialize(n.localBounds)),n.fill&&(t.fill=sceneryDeserialize(n.fill)),n.stroke&&(t.stroke=sceneryDeserialize(n.stroke)),n.lineDash&&(t.lineDash=sceneryDeserialize(n.lineDash)),t.mutate(o.options),t._serialization=o,t}else if(o.type==="Subtree"){const t={},n=o.nodes.map(sceneryDeserialize);return n.forEach(r=>{t[r._serialization.id]=r}),n.forEach(r=>{r._serialization.setup.children.forEach(s=>{r.addChild(t[s])})}),t[o.rootNodeId]}else return o.type==="value"?o.value:null};scenery.register("sceneryDeserialize",sceneryDeserialize);const sceneryCopy=o=>sceneryDeserialize(scenerySerialize(o));scenery.register("sceneryCopy",sceneryCopy);let globalId$1=1;class Drawable{initialize(e){return assert&&assert(!this.id||this.isDisposed,"If we previously existed, we need to have been disposed"),this.id=this.id||globalId$1++,sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`[${this.constructor.name}*] initialize ${this.toString()}`),this.clean(),this.renderer=e,this.dirty=!0,this.isDisposed=!1,this.linksDirty=!1,this.visibleProperty=new TinyProperty(!0),this.fittableProperty=new TinyProperty(!0),this}clean(){this.parentDrawable=null,this.backbone=null,this.pendingParentDrawable=null,this.pendingBackbone=null,this.pendingAddition=!1,this.pendingRemoval=!1,assert&&assert(!this.previousDrawable&&!this.nextDrawable,"By cleaning (disposal or fresh creation), we should have disconnected from the linked list"),this.previousDrawable=null,this.nextDrawable=null,this.oldPreviousDrawable=null,this.oldNextDrawable=null,this.visibleProperty&&this.visibleProperty.removeAllListeners(),this.fittableProperty&&this.fittableProperty.removeAllListeners()}update(){let e=!1;return this.dirty&&!this.isDisposed&&(this.dirty=!1,e=!0),e}setVisible(e){this.visibleProperty.value=e}set visible(e){this.setVisible(e)}isVisible(){return this.visibleProperty.value}get visible(){return this.isVisible()}setFittable(e){this.fittableProperty.value=e}set fittable(e){this.setFittable(e)}isFittable(){return this.fittableProperty.value}get fittable(){return this.isFittable()}setBlockBackbone(e){sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`[${this.constructor.name}*] setBlockBackbone ${this.toString()} with ${e.toString()}`),assert&&assert(this instanceof Block$1),this.parentDrawable=e,this.backbone=e,this.pendingParentDrawable=e,this.pendingBackbone=e,this.pendingAddition=!1,this.pendingRemoval=!1}notePendingAddition(e,t,n){sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`[${this.constructor.name}*] notePendingAddition ${this.toString()} with ${t.toString()}, ${n?n.toString():"-"}`),assert&&assert(n!==void 0,"backbone can be either null or a backbone"),assert&&assert(t instanceof Block$1),this.pendingParentDrawable=t,this.pendingBackbone=n,this.pendingAddition=!0,this.pendingRemoval||e.markDrawableChangedBlock(this)}notePendingRemoval(e){sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`[${this.constructor.name}*] notePendingRemoval ${this.toString()}`),this.pendingRemoval=!0,this.pendingAddition||e.markDrawableChangedBlock(this)}notePendingMove(e,t){sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`[${this.constructor.name}*] notePendingMove ${this.toString()} with ${t.toString()}`),assert&&assert(t instanceof Block$1),this.pendingParentDrawable=t,(!this.pendingRemoval||!this.pendingAddition)&&e.markDrawableChangedBlock(this),this.pendingAddition=!0,this.pendingRemoval=!0}updateBlock(){sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`[${this.constructor.name}*] updateBlock ${this.toString()} with add:${this.pendingAddition} remove:${this.pendingRemoval} old:${this.parentDrawable?this.parentDrawable.toString():"-"} new:${this.pendingParentDrawable?this.pendingParentDrawable.toString():"-"}`),sceneryLog&&sceneryLog.Drawable&&sceneryLog.push();let e=!1;return(this.pendingRemoval||this.pendingAddition)&&(e=!this.pendingRemoval||!this.pendingAddition||this.parentDrawable!==this.pendingParentDrawable||this.backbone!==this.pendingBackbone,e?(this.pendingRemoval&&(sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`removing from ${this.parentDrawable.toString()}`),this.parentDrawable.removeDrawable(this),this.pendingAddition||(this.pendingParentDrawable=null,this.pendingBackbone=null)),this.parentDrawable=this.pendingParentDrawable,this.backbone=this.pendingBackbone,this.pendingAddition&&(sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`adding to ${this.parentDrawable.toString()}`),this.parentDrawable.addDrawable(this))):(sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable("unchanged"),this.pendingAddition&&Renderer.isCanvas(this.renderer)&&this.parentDrawable.onPotentiallyMovedDrawable(this)),this.pendingAddition=!1,this.pendingRemoval=!1),sceneryLog&&sceneryLog.Drawable&&sceneryLog.pop(),e}updateLinks(){this.oldNextDrawable=this.nextDrawable,this.oldPreviousDrawable=this.previousDrawable,this.linksDirty=!1}markDirty(){this.dirty||(this.dirty=!0,this.parentDrawable&&this.parentDrawable.markDirtyDrawable(this))}markLinksDirty(e){this.linksDirty||(this.linksDirty=!0,e.markDrawableForLinksUpdate(this))}markForDisposal(e){Drawable.disconnectBefore(this,e),Drawable.disconnectAfter(this,e),e.markDrawableForDisposal(this)}disposeImmediately(e){Drawable.disconnectBefore(this,e),Drawable.disconnectAfter(this,e),this.dispose()}dispose(){assert&&assert(!this.isDisposed,"We should not re-dispose drawables"),sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`[${this.constructor.name}*] dispose ${this.toString()}`),sceneryLog&&sceneryLog.Drawable&&sceneryLog.push(),this.clean(),this.isDisposed=!0,this.freeToPool(),sceneryLog&&sceneryLog.Drawable&&sceneryLog.pop()}audit(e,t,n){assertSlow&&(assertSlow&&assertSlow(!this.isDisposed,"If we are being audited, we assume we are in the drawable display tree, and we should not be marked as disposed"),assertSlow&&assertSlow(this.renderer,"Should not have a 0 (no) renderer"),assertSlow&&assertSlow(!this.backbone||this.parentDrawable,"If we have a backbone reference, we must have a parentDrawable (our block)"),e||(assertSlow&&assertSlow(!this.pendingAddition),assertSlow&&assertSlow(!this.pendingRemoval),assertSlow&&assertSlow(this.parentDrawable===this.pendingParentDrawable,"Assure our parent and pending parent match, if we have updated blocks"),assertSlow&&assertSlow(this.backbone===this.pendingBackbone,"Assure our backbone and pending backbone match, if we have updated blocks")),t||(assertSlow&&assertSlow(this.oldPreviousDrawable===this.previousDrawable,"Pending linked-list references should be cleared by now"),assertSlow&&assertSlow(this.oldNextDrawable===this.nextDrawable,"Pending linked-list references should be cleared by now"),assertSlow&&assertSlow(!this.linksDirty,"Links dirty flag should be clean")),n||assertSlow&&assertSlow(!this.dirty,"Should not be dirty at this phase, if we are in the drawable display tree"))}toString(){return`${this.constructor.name}#${this.id}`}toDetailedString(){return this.toString()}static connectDrawables(e,t,n){e.nextDrawable!==t&&(e.nextDrawable&&(e.nextDrawable.markLinksDirty(n),e.nextDrawable.previousDrawable=null),t.previousDrawable&&(t.previousDrawable.markLinksDirty(n),t.previousDrawable.nextDrawable=null),e.nextDrawable=t,t.previousDrawable=e,e.markLinksDirty(n),t.markLinksDirty(n))}static disconnectBefore(e,t){e.previousDrawable&&(e.markLinksDirty(t),e.previousDrawable.markLinksDirty(t),e.previousDrawable.nextDrawable=null,e.previousDrawable=null)}static disconnectAfter(e,t){e.nextDrawable&&(e.markLinksDirty(t),e.nextDrawable.markLinksDirty(t),e.nextDrawable.previousDrawable=null,e.nextDrawable=null)}static listToArray(e,t){const n=[];for(let r=e;n.push(r),r!==t;r=r.nextDrawable);return n}static oldListToArray(e,t){const n=[];for(let r=e;n.push(r),r!==t;r=r.oldNextDrawable);return n}}scenery.register("Drawable",Drawable);class SelfDrawable extends Drawable{constructor(e,t){assert&&assert(typeof e=="number"),assert&&assert(t),super(),this.initialize(e,t)}initialize(e,t){return super.initialize(e),this.drawableVisibilityListener=this.drawableVisibilityListener||this.updateSelfVisibility.bind(this),this.instance=t,this.node=t.trail.lastNode(),this.node.attachDrawable(this),this.instance.selfVisibleEmitter.addListener(this.drawableVisibilityListener),this.updateSelfVisibility(),this}dispose(){this.instance.selfVisibleEmitter.removeListener(this.drawableVisibilityListener),this.node.detachDrawable(this),this.instance=null,this.node=null,super.dispose()}updateSelfVisibility(){this.visible=this.instance.selfVisible}toDetailedString(){return`${this.toString()} (${this.instance.trail.toPathString()})`}}scenery.register("SelfDrawable",SelfDrawable);const PaintableStatelessDrawable=memoize(o=>(assert&&assert(_.includes(inheritance(o),SelfDrawable)),class extends o{initialize(e,t,...n){super.initialize(e,t,...n),this.fillCallback=this.fillCallback||this.markDirtyFill.bind(this),this.strokeCallback=this.strokeCallback||this.markDirtyStroke.bind(this),this.fillObserver=this.fillObserver||new PaintObserver(this.fillCallback),this.strokeObserver=this.strokeObserver||new PaintObserver(this.strokeCallback),this.fillObserver.setPrimary(t.node._fill),this.strokeObserver.setPrimary(t.node._stroke)}dispose(){this.fillObserver.clean(),this.strokeObserver.clean(),super.dispose()}markDirtyFill(){assert&&Color.checkPaint(this.instance.node._fill),this.markPaintDirty(),this.fillObserver.setPrimary(this.instance.node._fill)}markDirtyStroke(){assert&&Color.checkPaint(this.instance.node._stroke),this.markPaintDirty(),this.strokeObserver.setPrimary(this.instance.node._stroke)}markDirtyLineWidth(){this.markPaintDirty()}markDirtyLineOptions(){this.markPaintDirty()}markDirtyCachedPaints(){this.markPaintDirty()}}));scenery.register("PaintableStatelessDrawable",PaintableStatelessDrawable);const PaintableStatelessDrawable$1=PaintableStatelessDrawable,PaintableStatefulDrawable=memoize(o=>(assert&&assert(_.includes(inheritance(o),SelfDrawable)),class extends o{initialize(e,t,...n){super.initialize(e,t,...n),this.dirtyFill=!0,this.hadStroke=!1,this.dirtyStroke=!0,this.dirtyLineWidth=!0,this.dirtyLineOptions=!0,this.dirtyCachedPaints=!0,this.lastCachedPaints=[],this.fillCallback=this.fillCallback||this.markDirtyFill.bind(this),this.strokeCallback=this.strokeCallback||this.markDirtyStroke.bind(this),this.fillObserver=this.fillObserver||new PaintObserver(this.fillCallback),this.strokeObserver=this.strokeObserver||new PaintObserver(this.strokeCallback),this.fillObserver.setPrimary(t.node._fill),this.strokeObserver.setPrimary(t.node._stroke)}cleanPaintableState(){this.dirtyFill=!1,this.dirtyStroke=!1,this.dirtyLineWidth=!1,this.dirtyLineOptions=!1,this.dirtyCachedPaints=!1,this.hadStroke=this.node.getStroke()!==null}dispose(){super.dispose(),this.fillObserver.clean(),this.strokeObserver.clean()}markDirtyFill(){assert&&Color.checkPaint(this.instance.node._fill),this.dirtyFill=!0,this.markPaintDirty(),this.fillObserver.setPrimary(this.instance.node._fill)}markDirtyStroke(){assert&&Color.checkPaint(this.instance.node._stroke),this.dirtyStroke=!0,this.markPaintDirty(),this.strokeObserver.setPrimary(this.instance.node._stroke)}markDirtyLineWidth(){this.dirtyLineWidth=!0,this.markPaintDirty()}markDirtyLineOptions(){this.dirtyLineOptions=!0,this.markPaintDirty()}markDirtyCachedPaints(){this.dirtyCachedPaints=!0,this.markPaintDirty()}}));scenery.register("PaintableStatefulDrawable",PaintableStatefulDrawable);class CanvasSelfDrawable extends SelfDrawable{initialize(e,t){super.initialize(e,t),this.transformListener=this.transformListener||this.markTransformDirty.bind(this),t.relativeTransform.addListener(this.transformListener),t.relativeTransform.addPrecompute()}markTransformDirty(){this.markDirty()}markPaintDirty(){this.markDirty()}updateSelfVisibility(){super.updateSelfVisibility(),this.markDirty()}dispose(){this.instance.relativeTransform.removeListener(this.transformListener),this.instance.relativeTransform.removePrecompute(),super.dispose()}}scenery.register("CanvasSelfDrawable",CanvasSelfDrawable);class DOMSelfDrawable extends SelfDrawable{initialize(e,t){return super.initialize(e,t),this.transformListener=this.transformListener||this.markTransformDirty.bind(this),this.markTransformDirty(),this.visibilityDirty=!0,t.relativeTransform.addListener(this.transformListener),t.relativeTransform.addPrecompute(),this}markTransformDirty(){this.transformDirty=!0,this.markDirty()}getTransformMatrix(){return this.instance.relativeTransform.validate(),this.instance.relativeTransform.matrix}update(){return super.update()?(this.updateDOM(),this.visibilityDirty&&(this.visibilityDirty=!1,this.domElement.style.visibility=this.visible?"":"hidden"),this.cleanPaintableState&&this.cleanPaintableState(),!0):!1}updateDOM(){}updateSelfVisibility(){super.updateSelfVisibility(),this.visibilityDirty||(this.visibilityDirty=!0,this.markDirty())}dispose(){this.instance.relativeTransform.removeListener(this.transformListener),this.instance.relativeTransform.removePrecompute(),super.dispose()}}scenery.register("DOMSelfDrawable",DOMSelfDrawable);class SVGSelfDrawable extends SelfDrawable{initialize(e,t,n,r){return assert&&assert(typeof n=="boolean"),assert&&assert(typeof r=="boolean"),super.initialize(e,t),this.usesPaint=n,this.keepElements=r,this.svgElement=null,this.svgBlock=null,this.usesPaint&&(this.paintState?this.paintState.initialize():this.paintState=new PaintSVGState),this}update(){return super.update()?(this.updateSVG(),!0):!1}updateSVG(){if(this.paintDirty&&this.updateSVGSelf(this.node,this.svgElement),this.usesPaint&&this.dirtyCachedPaints){const e=this.node._cachedPaints.slice();let t,n;for(t=0;t<e.length;t++){const r=e[t];let s=!0;for(n=0;n<this.lastCachedPaints.length;n++)if(r===this.lastCachedPaints[n]){s=!1;break}s&&this.svgBlock.incrementPaint(r)}for(t=0;t<this.lastCachedPaints.length;t++){const r=this.lastCachedPaints[t];let s=!0;for(n=0;n<e.length;n++)if(r===e[n]){s=!1;break}s&&this.svgBlock.decrementPaint(r)}this.lastCachedPaints=e}this.setToCleanState()}updateFillStrokeStyle(e){if(!this.usesPaint)return;this.dirtyFill&&this.paintState.updateFill(this.svgBlock,this.node.getFillValue()),this.dirtyStroke&&this.paintState.updateStroke(this.svgBlock,this.node.getStrokeValue());const t=this.dirtyLineWidth||this.dirtyLineOptions;t&&this.paintState.updateStrokeDetailStyle(this.node),(this.dirtyFill||this.dirtyStroke||t)&&e.setAttribute("style",this.paintState.baseStyle+this.paintState.strokeDetailStyle),this.cleanPaintableState()}updateSVGBlock(e){const t=this.svgBlock;if(this.usesPaint&&t)for(let n=0;n<this.lastCachedPaints.length;n++)t.decrementPaint(this.lastCachedPaints[n]);if(this.svgBlock=e,this.usesPaint)for(let n=0;n<this.lastCachedPaints.length;n++)e.incrementPaint(this.lastCachedPaints[n]);this.updateDefsSelf&&this.updateDefsSelf(e),this.usesPaint&&this.paintState.updateSVGBlock(e),this.usesPaint&&this.markDirtyFill(),this.usesPaint&&this.markDirtyStroke()}dispose(){this.keepElements||(this.svgElement=null),this.updateDefsSelf&&this.updateDefsSelf(null),this.usesPaint&&this.paintState.dispose(),this.defs=null,this.svgBlock=null,super.dispose()}}scenery.register("SVGSelfDrawable",SVGSelfDrawable);class WebGLSelfDrawable extends SelfDrawable{initialize(e,t){return super.initialize(e,t),this.transformListener=this.transformListener||this.markTransformDirty.bind(this),t.relativeTransform.addListener(this.transformListener),t.relativeTransform.addPrecompute(),this}markTransformDirty(){this.markDirty()}updateSelfVisibility(){super.updateSelfVisibility(),this.markDirty()}dispose(){this.instance.relativeTransform.removeListener(this.transformListener),this.instance.relativeTransform.removePrecompute(),super.dispose()}}scenery.register("WebGLSelfDrawable",WebGLSelfDrawable);const CircleStatefulDrawable=memoize(o=>(assert&&assert(_.includes(inheritance(o),SelfDrawable)),class extends PaintableStatefulDrawable(o){initialize(e,t,...n){super.initialize(e,t,...n),this.paintDirty=!0,this.dirtyRadius=!0}markPaintDirty(){this.paintDirty=!0,this.markDirty()}markDirtyRadius(){this.dirtyRadius=!0,this.markPaintDirty()}setToCleanState(){this.paintDirty=!1,this.dirtyRadius=!1}}));scenery.register("CircleStatefulDrawable",CircleStatefulDrawable);const ImageStatefulDrawable=memoize(o=>(assert&&assert(_.includes(inheritance(o),SelfDrawable)),class extends o{initialize(e,t,...n){super.initialize(e,t,...n),this.paintDirty=!0,this.dirtyImage=!0,this.dirtyImageOpacity=!0,this.dirtyMipmap=!0}markPaintDirty(){this.paintDirty=!0,this.markDirty()}markDirtyImage(){this.dirtyImage=!0,this.markPaintDirty()}markDirtyImageOpacity(){this.dirtyImageOpacity=!0,this.markPaintDirty()}markDirtyMipmap(){this.dirtyMipmap=!0,this.markPaintDirty()}setToCleanState(){this.paintDirty=!1,this.dirtyImage=!1,this.dirtyImageOpacity=!1,this.dirtyMipmap=!1}}));scenery.register("ImageStatefulDrawable",ImageStatefulDrawable);const ImageStatefulDrawable$1=ImageStatefulDrawable,LineStatelessDrawable=memoize(o=>(assert&&assert(_.includes(inheritance(o),SelfDrawable)),class extends PaintableStatelessDrawable$1(o){initialize(e,t,...n){super.initialize(e,t,...n),this.paintDirty=!0}markPaintDirty(){this.paintDirty=!0,this.markDirty()}markDirtyLine(){this.markPaintDirty()}markDirtyP1(){this.markPaintDirty()}markDirtyP2(){this.markPaintDirty()}markDirtyX1(){this.markPaintDirty()}markDirtyY1(){this.markPaintDirty()}markDirtyX2(){this.markPaintDirty()}markDirtyY2(){this.markPaintDirty()}}));scenery.register("LineStatelessDrawable",LineStatelessDrawable);const LineStatefulDrawable=memoize(o=>(assert&&assert(_.includes(inheritance(o),SelfDrawable)),class extends PaintableStatefulDrawable(o){initialize(e,t,...n){super.initialize(e,t,...n),this.paintDirty=!0,this.dirtyX1=!0,this.dirtyY1=!0,this.dirtyX2=!0,this.dirtyY2=!0}markPaintDirty(){this.paintDirty=!0,this.markDirty()}markDirtyLine(){this.dirtyX1=!0,this.dirtyY1=!0,this.dirtyX2=!0,this.dirtyY2=!0,this.markPaintDirty()}markDirtyP1(){this.dirtyX1=!0,this.dirtyY1=!0,this.markPaintDirty()}markDirtyP2(){this.dirtyX2=!0,this.dirtyY2=!0,this.markPaintDirty()}markDirtyX1(){this.dirtyX1=!0,this.markPaintDirty()}markDirtyY1(){this.dirtyY1=!0,this.markPaintDirty()}markDirtyX2(){this.dirtyX2=!0,this.markPaintDirty()}markDirtyY2(){this.dirtyY2=!0,this.markPaintDirty()}setToCleanState(){this.paintDirty=!1,this.dirtyX1=!1,this.dirtyY1=!1,this.dirtyX2=!1,this.dirtyY2=!1}}));scenery.register("LineStatefulDrawable",LineStatefulDrawable);const PathStatefulDrawable=memoize(o=>(assert&&assert(_.includes(inheritance(o),SelfDrawable)),class extends PaintableStatefulDrawable(o){initialize(e,t,...n){super.initialize(e,t,...n),this.paintDirty=!0,this.dirtyShape=!0}markPaintDirty(){this.paintDirty=!0,this.markDirty()}markDirtyShape(){this.dirtyShape=!0,this.markPaintDirty()}setToCleanState(){this.paintDirty=!1,this.dirtyShape=!1}}));scenery.register("PathStatefulDrawable",PathStatefulDrawable);const PathStatefulDrawable$1=PathStatefulDrawable,RectangleStatefulDrawable=memoize(o=>(assert&&assert(_.includes(inheritance(o),SelfDrawable)),class extends PaintableStatefulDrawable(o){initialize(e,t,...n){super.initialize(e,t,...n),this.paintDirty=!0,this.dirtyX=!0,this.dirtyY=!0,this.dirtyWidth=!0,this.dirtyHeight=!0,this.dirtyCornerXRadius=!0,this.dirtyCornerYRadius=!0}markPaintDirty(){this.paintDirty=!0,this.markDirty()}markDirtyRectangle(){this.dirtyX=!0,this.dirtyY=!0,this.dirtyWidth=!0,this.dirtyHeight=!0,this.dirtyCornerXRadius=!0,this.dirtyCornerYRadius=!0,this.markPaintDirty()}markDirtyX(){this.dirtyX=!0,this.markPaintDirty()}markDirtyY(){this.dirtyY=!0,this.markPaintDirty()}markDirtyWidth(){this.dirtyWidth=!0,this.markPaintDirty()}markDirtyHeight(){this.dirtyHeight=!0,this.markPaintDirty()}markDirtyCornerXRadius(){this.dirtyCornerXRadius=!0,this.markPaintDirty()}markDirtyCornerYRadius(){this.dirtyCornerYRadius=!0,this.markPaintDirty()}setToCleanState(){this.paintDirty=!1,this.dirtyX=!1,this.dirtyY=!1,this.dirtyWidth=!1,this.dirtyHeight=!1,this.dirtyCornerXRadius=!1,this.dirtyCornerYRadius=!1}}));scenery.register("RectangleStatefulDrawable",RectangleStatefulDrawable);const TextStatefulDrawable=memoize(o=>(assert&&assert(_.includes(inheritance(o),SelfDrawable)),class extends PaintableStatefulDrawable(o){initialize(e,t,...n){super.initialize(e,t,...n),this.paintDirty=!0,this.dirtyText=!0,this.dirtyFont=!0,this.dirtyBounds=!0}markPaintDirty(){this.paintDirty=!0,this.markDirty()}markDirtyText(){this.dirtyText=!0,this.markPaintDirty()}markDirtyFont(){this.dirtyFont=!0,this.markPaintDirty()}markDirtyBounds(){this.dirtyBounds=!0,this.markPaintDirty()}setToCleanState(){this.paintDirty=!1,this.dirtyText=!1,this.dirtyFont=!1,this.dirtyBounds=!1}}));scenery.register("TextStatefulDrawable",TextStatefulDrawable);const TextStatefulDrawable$1=TextStatefulDrawable,emptyArray=[];class CanvasNodeDrawable extends CanvasSelfDrawable{paintCanvas(e,t,n){if(assert&&assert(!t.selfBounds.isEmpty(),`CanvasNode should not be used with an empty canvasBounds. Please set canvasBounds (or use setCanvasBounds()) on ${t.constructor.name}`),!t.selfBounds.isEmpty()){const r=e.context;r.save(),r.fillStyle="black",r.strokeStyle="black",r.lineWidth=1,r.lineCap="butt",r.lineJoin="miter",r.lineDash=emptyArray,r.lineDashOffset=0,r.miterLimit=10,t.paintCanvas(r),r.restore()}}}scenery.register("CanvasNodeDrawable",CanvasNodeDrawable);Poolable.mixInto(CanvasNodeDrawable);const CanvasNodeDrawable$1=CanvasNodeDrawable;class CircleCanvasDrawable extends PaintableStatelessDrawable$1(CanvasSelfDrawable){paintCanvas(e,t,n){assert&&assert(t instanceof Node$2);const r=e.context;r.beginPath(),r.arc(0,0,t._radius,0,Math.PI*2,!1),r.closePath(),t.hasFill()&&(t.beforeCanvasFill(e),r.fill(),t.afterCanvasFill(e)),t.hasPaintableStroke()&&(t.beforeCanvasStroke(e),r.stroke(),t.afterCanvasStroke(e))}markDirtyRadius(){this.markPaintDirty()}dispose(){super.dispose()}}scenery.register("CircleCanvasDrawable",CircleCanvasDrawable);Poolable.mixInto(CircleCanvasDrawable);const CircleCanvasDrawable$1=CircleCanvasDrawable;class CircleDOMDrawable extends CircleStatefulDrawable(DOMSelfDrawable){constructor(e,t){super(e,t),Utils.prepareForTransform(this.domElement)}initialize(e,t){if(super.initialize(e,t),this.matrix=this.matrix||Matrix3.pool.fetch(),!this.fillElement||!this.strokeElement){const n=document.createElement("div");this.fillElement=n;const r=document.createElement("div");this.strokeElement=r,n.style.display="block",n.style.position="absolute",n.style.left="0",n.style.top="0",n.style.pointerEvents="none",r.style.display="block",r.style.position="absolute",r.style.left="0",r.style.top="0",r.style.pointerEvents="none",n.appendChild(r)}this.domElement=this.fillElement}updateDOM(){const e=this.node,t=this.fillElement,n=this.strokeElement;if(this.paintDirty&&(this.dirtyRadius&&(t.style.width=`${2*e._radius}px`,t.style.height=`${2*e._radius}px`,t.style[Features.borderRadius]=`${e._radius}px`),this.dirtyFill&&(t.style.backgroundColor=e.getCSSFill()),this.dirtyStroke&&(e.hasStroke()?n.style.borderStyle="solid":n.style.borderStyle="none"),e.hasStroke())){const r=!this.hadStroke;(r||this.dirtyLineWidth||this.dirtyRadius)&&(n.style.width=`${2*e._radius-e.getLineWidth()}px`,n.style.height=`${2*e._radius-e.getLineWidth()}px`,n.style[Features.borderRadius]=`${e._radius+e.getLineWidth()/2}px`),(r||this.dirtyLineWidth)&&(n.style.left=`${-e.getLineWidth()/2}px`,n.style.top=`${-e.getLineWidth()/2}px`,n.style.borderWidth=`${e.getLineWidth()}px`),(r||this.dirtyStroke)&&(n.style.borderColor=e.getSimpleCSSStroke())}if(this.transformDirty||this.dirtyRadius){this.matrix.set(this.getTransformMatrix());const r=Matrix3.translation(-e._radius,-e._radius);this.matrix.multiplyMatrix(r),r.freeToPool(),Utils.applyPreparedTransform(this.matrix,this.fillElement)}this.setToCleanState(),this.cleanPaintableState(),this.transformDirty=!1}dispose(){super.dispose()}}scenery.register("CircleDOMDrawable",CircleDOMDrawable);Poolable.mixInto(CircleDOMDrawable);const CircleDOMDrawable$1=CircleDOMDrawable,keepSVGCircleElements=!0;class CircleSVGDrawable extends CircleStatefulDrawable(SVGSelfDrawable){initialize(e,t){super.initialize(e,t,!0,keepSVGCircleElements),this.svgElement=this.svgElement||document.createElementNS(svgns,"circle")}updateSVGSelf(){const e=this.svgElement;this.dirtyRadius&&e.setAttribute("r",this.node._radius),this.updateFillStrokeStyle(e)}}scenery.register("CircleSVGDrawable",CircleSVGDrawable);Poolable.mixInto(CircleSVGDrawable);const CircleSVGDrawable$1=CircleSVGDrawable;class DOMDrawable extends DOMSelfDrawable{constructor(e,t){super(e,t),Utils.prepareForTransform(this.domElement)}initialize(e,t){super.initialize(e,t),this.domElement=this.node._container}updateDOM(){this.transformDirty&&!this.node._preventTransform&&Utils.applyPreparedTransform(this.getTransformMatrix(),this.domElement),this.transformDirty=!1}dispose(){super.dispose(),this.domElement=null}}scenery.register("DOMDrawable",DOMDrawable);Poolable.mixInto(DOMDrawable);const DOMDrawable$1=DOMDrawable;class ImageCanvasDrawable extends CanvasSelfDrawable{paintCanvas(e,t,n){const r=t._imageOpacity!==1;if(t._image&&t._image.width!==0&&t._image.height!==0){if(r&&(e.context.save(),e.context.globalAlpha*=t._imageOpacity),t._mipmap&&t.hasMipmaps()){const s=t.getMipmapLevel(n,Imageable$1.CANVAS_MIPMAP_BIAS_ADJUSTMENT),a=t.getMipmapCanvas(s),l=Math.pow(2,s);e.context.drawImage(a,0,0,a.width*l,a.height*l)}else e.context.drawImage(t._image,0,0);r&&e.context.restore()}}markDirtyImage(){this.markPaintDirty()}markDirtyMipmap(){this.markPaintDirty()}markDirtyImageOpacity(){this.markPaintDirty()}}scenery.register("ImageCanvasDrawable",ImageCanvasDrawable);Poolable.mixInto(ImageCanvasDrawable);const ImageCanvasDrawable$1=ImageCanvasDrawable;class ImageDOMDrawable extends ImageStatefulDrawable$1(DOMSelfDrawable){constructor(e,t){super(e,t),Utils.prepareForTransform(this.domElement)}initialize(e,t){super.initialize(e,t),this.domElement||(this.domElement=document.createElement("img"),this.domElement.style.display="block",this.domElement.style.position="absolute",this.domElement.style.pointerEvents="none",this.domElement.style.left="0",this.domElement.style.top="0"),this.hasOpacity=!1}updateDOM(){const e=this.node,t=this.domElement;this.paintDirty&&this.dirtyImage&&(t.src=e._image?e._image.src:"//:0"),this.dirtyImageOpacity&&(e._imageOpacity===1?this.hasOpacity&&(this.hasOpacity=!1,t.style.opacity=""):(this.hasOpacity=!0,t.style.opacity=e._imageOpacity)),this.transformDirty&&Utils.applyPreparedTransform(this.getTransformMatrix(),this.domElement),this.setToCleanState(),this.transformDirty=!1}dispose(){super.dispose()}}scenery.register("ImageDOMDrawable",ImageDOMDrawable);Poolable.mixInto(ImageDOMDrawable);const ImageDOMDrawable$1=ImageDOMDrawable,keepSVGImageElements=!0;class ImageSVGDrawable extends ImageStatefulDrawable$1(SVGSelfDrawable){initialize(e,t){super.initialize(e,t,!1,keepSVGImageElements),sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} initialized for ${t.toString()}`),this.svgElement=this.svgElement||document.createElementNS(svgns,"image"),this.svgElement.setAttribute("x","0"),this.svgElement.setAttribute("y","0"),this.hasOpacity=!1,this.usingMipmap=!1,this.mipmapLevel=-1,this._mipmapTransformListener=this._mipmapTransformListener||this.onMipmapTransform.bind(this),this._mipmapListener=this._mipmapListener||this.onMipmap.bind(this),this.node.mipmapEmitter.addListener(this._mipmapListener),this.updateMipmapStatus(t.node._mipmap)}updateSVGSelf(){const e=this.svgElement;this.dirtyImage?(sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Updating dirty image`),this.node._image?this.updateURL(e,!0):(e.setAttribute("width","0"),e.setAttribute("height","0"),e.setAttributeNS(xlinkns,"xlink:href","//:0"))):this.dirtyMipmap&&this.node._image&&(sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Updating dirty mipmap`),this.updateURL(e,!1)),this.dirtyImageOpacity&&(this.node._imageOpacity===1?this.hasOpacity&&(this.hasOpacity=!1,e.removeAttribute("opacity")):(this.hasOpacity=!0,e.setAttribute("opacity",this.node._imageOpacity)))}updateURL(e,t){let n=-1;if(this.node._mipmap&&(n=this.node.getMipmapLevel(this.instance.relativeTransform.matrix),sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Mipmap level: ${n}`)),!(!t&&n===this.mipmapLevel))if(this.mipmapLevel>=0&&n===-1&&e.removeAttribute("transform"),this.mipmapLevel=n,this.node._mipmap&&this.node.hasMipmaps()){sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Setting image URL to mipmap level ${n}`);const r=this.node.getMipmapURL(n),s=this.node.getMipmapCanvas(n);e.setAttribute("width",`${s.width}px`),e.setAttribute("height",`${s.height}px`),e.setAttribute("transform",`scale(${Math.pow(2,n).toFixed(20)})`),e.setAttributeNS(xlinkns,"xlink:href",r)}else sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Setting image URL`),e.setAttribute("width",`${this.node.getImageWidth()}px`),e.setAttribute("height",`${this.node.getImageHeight()}px`),e.setAttributeNS(xlinkns,"xlink:href",this.node.getImageURL())}updateMipmapStatus(e){this.usingMipmap!==e&&(this.usingMipmap=e,e?(sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Adding mipmap compute/listener needs`),this.instance.relativeTransform.addListener(this._mipmapTransformListener),this.instance.relativeTransform.addPrecompute()):(sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Removing mipmap compute/listener needs`),this.instance.relativeTransform.removeListener(this._mipmapTransformListener),this.instance.relativeTransform.removePrecompute()),this.markDirtyMipmap())}onMipmap(){this.markDirtyMipmap(),this.updateMipmapStatus(this.node._mipmap)}onMipmapTransform(){sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Transform dirties mipmap`),this.markDirtyMipmap()}dispose(){sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} disposing`),this.updateMipmapStatus(!1),this.node.mipmapEmitter.removeListener(this._mipmapListener),super.dispose()}}scenery.register("ImageSVGDrawable",ImageSVGDrawable);Poolable.mixInto(ImageSVGDrawable);const ImageSVGDrawable$1=ImageSVGDrawable,WEBGL_COMPONENTS=5,VERTEX_0_OFFSET=WEBGL_COMPONENTS*0,VERTEX_1_OFFSET=WEBGL_COMPONENTS*1,VERTEX_2_OFFSET=WEBGL_COMPONENTS*2,VERTEX_3_OFFSET=WEBGL_COMPONENTS*3,VERTEX_4_OFFSET=WEBGL_COMPONENTS*4,VERTEX_5_OFFSET=WEBGL_COMPONENTS*5,VERTEX_X_OFFSET=0,VERTEX_Y_OFFSET=1,VERTEX_U_OFFSET=2,VERTEX_V_OFFSET=3,VERTEX_A_OFFSET=4;class ImageWebGLDrawable extends ImageStatefulDrawable$1(WebGLSelfDrawable){initialize(e,t){super.initialize(e,t),this.vertexArray=this.vertexArray||new Float32Array(WEBGL_COMPONENTS*6),this.upperLeft=new Vector2(0,0),this.lowerLeft=new Vector2(0,0),this.upperRight=new Vector2(0,0),this.lowerRight=new Vector2(0,0),this.xyDirty=!0,this.uvDirty=!0,this.updatedOnce=!1,this.sprite=null}onAddToBlock(e){this.webglBlock=e,this.markDirty(),this.reserveSprite()}onRemoveFromBlock(e){this.unreserveSprite()}reserveSprite(){if(this.sprite){if(this.sprite.image===this.node._image)return;this.unreserveSprite()}const e=this.node.getImageWidth(),t=this.node.getImageHeight();this.sprite=e>0&&t>0?this.webglBlock.addSpriteSheetImage(this.node._image,e,t):null,this.xyDirty=!0,this.uvDirty=!0}unreserveSprite(){this.sprite&&this.webglBlock.removeSpriteSheetImage(this.sprite),this.sprite=null}markTransformDirty(){this.xyDirty=!0,super.markTransformDirty()}markPaintDirty(){this.xyDirty=!0,this.uvDirty=!0,this.markDirty()}update(){if(!super.update()||(this.reserveSprite(),(this.dirtyImageOpacity||!this.updatedOnce)&&(this.vertexArray[VERTEX_0_OFFSET+VERTEX_A_OFFSET]=this.node._imageOpacity,this.vertexArray[VERTEX_1_OFFSET+VERTEX_A_OFFSET]=this.node._imageOpacity,this.vertexArray[VERTEX_2_OFFSET+VERTEX_A_OFFSET]=this.node._imageOpacity,this.vertexArray[VERTEX_3_OFFSET+VERTEX_A_OFFSET]=this.node._imageOpacity,this.vertexArray[VERTEX_4_OFFSET+VERTEX_A_OFFSET]=this.node._imageOpacity,this.vertexArray[VERTEX_5_OFFSET+VERTEX_A_OFFSET]=this.node._imageOpacity),this.updatedOnce=!0,!this.sprite))return!1;if(this.uvDirty){this.uvDirty=!1;const e=this.sprite.uvBounds;this.vertexArray[VERTEX_0_OFFSET+VERTEX_U_OFFSET]=e.minX,this.vertexArray[VERTEX_0_OFFSET+VERTEX_V_OFFSET]=e.minY,this.vertexArray[VERTEX_1_OFFSET+VERTEX_U_OFFSET]=e.minX,this.vertexArray[VERTEX_1_OFFSET+VERTEX_V_OFFSET]=e.maxY,this.vertexArray[VERTEX_2_OFFSET+VERTEX_U_OFFSET]=e.maxX,this.vertexArray[VERTEX_2_OFFSET+VERTEX_V_OFFSET]=e.minY,this.vertexArray[VERTEX_3_OFFSET+VERTEX_U_OFFSET]=e.maxX,this.vertexArray[VERTEX_3_OFFSET+VERTEX_V_OFFSET]=e.minY,this.vertexArray[VERTEX_4_OFFSET+VERTEX_U_OFFSET]=e.minX,this.vertexArray[VERTEX_4_OFFSET+VERTEX_V_OFFSET]=e.maxY,this.vertexArray[VERTEX_5_OFFSET+VERTEX_U_OFFSET]=e.maxX,this.vertexArray[VERTEX_5_OFFSET+VERTEX_V_OFFSET]=e.maxY}if(this.xyDirty){this.xyDirty=!1;const e=this.node.getImageWidth(),t=this.node.getImageHeight(),n=this.instance.relativeTransform.matrix;n.multiplyVector2(this.upperLeft.setXY(0,0)),n.multiplyVector2(this.lowerLeft.setXY(0,t)),n.multiplyVector2(this.upperRight.setXY(e,0)),n.multiplyVector2(this.lowerRight.setXY(e,t)),this.vertexArray[VERTEX_0_OFFSET+VERTEX_X_OFFSET]=this.upperLeft.x,this.vertexArray[VERTEX_0_OFFSET+VERTEX_Y_OFFSET]=this.upperLeft.y,this.vertexArray[VERTEX_1_OFFSET+VERTEX_X_OFFSET]=this.lowerLeft.x,this.vertexArray[VERTEX_1_OFFSET+VERTEX_Y_OFFSET]=this.lowerLeft.y,this.vertexArray[VERTEX_2_OFFSET+VERTEX_X_OFFSET]=this.upperRight.x,this.vertexArray[VERTEX_2_OFFSET+VERTEX_Y_OFFSET]=this.upperRight.y,this.vertexArray[VERTEX_3_OFFSET+VERTEX_X_OFFSET]=this.upperRight.x,this.vertexArray[VERTEX_3_OFFSET+VERTEX_Y_OFFSET]=this.upperRight.y,this.vertexArray[VERTEX_4_OFFSET+VERTEX_X_OFFSET]=this.lowerLeft.x,this.vertexArray[VERTEX_4_OFFSET+VERTEX_Y_OFFSET]=this.lowerLeft.y,this.vertexArray[VERTEX_5_OFFSET+VERTEX_X_OFFSET]=this.lowerRight.x,this.vertexArray[VERTEX_5_OFFSET+VERTEX_Y_OFFSET]=this.lowerRight.y}return!0}}ImageWebGLDrawable.prototype.webglRenderer=Renderer.webglTexturedTriangles;scenery.register("ImageWebGLDrawable",ImageWebGLDrawable);Poolable.mixInto(ImageWebGLDrawable);const ImageWebGLDrawable$1=ImageWebGLDrawable;class LineCanvasDrawable extends LineStatelessDrawable(CanvasSelfDrawable){paintCanvas(e,t,n){assert&&assert(t instanceof Node$2);const r=e.context;r.beginPath(),r.moveTo(t.x1,t.y1),r.lineTo(t.x2,t.y2),t.hasPaintableStroke()&&(t.beforeCanvasStroke(e),r.stroke(),t.afterCanvasStroke(e))}}scenery.register("LineCanvasDrawable",LineCanvasDrawable);Poolable.mixInto(LineCanvasDrawable);const LineCanvasDrawable$1=LineCanvasDrawable,keepSVGLineElements=!0;class LineSVGDrawable extends LineStatefulDrawable(SVGSelfDrawable){initialize(e,t){super.initialize(e,t,!0,keepSVGLineElements),this.svgElement=this.svgElement||document.createElementNS(svgns,"line")}updateSVGSelf(){const e=this.svgElement;this.dirtyX1&&e.setAttribute("x1",this.node.x1),this.dirtyY1&&e.setAttribute("y1",this.node.y1),this.dirtyX2&&e.setAttribute("x2",this.node.x2),this.dirtyY2&&e.setAttribute("y2",this.node.y2),this.updateFillStrokeStyle(e)}}scenery.register("LineSVGDrawable",LineSVGDrawable);Poolable.mixInto(LineSVGDrawable);const LineSVGDrawable$1=LineSVGDrawable;class PathCanvasDrawable extends PaintableStatelessDrawable$1(CanvasSelfDrawable){paintCanvas(e,t,n){const r=e.context;t.hasShape()&&(r.beginPath(),t._shape.writeToContext(r),t.hasFill()&&(t.beforeCanvasFill(e),r.fill(),t.afterCanvasFill(e)),t.hasPaintableStroke()&&(t.beforeCanvasStroke(e),r.stroke(),t.afterCanvasStroke(e)))}markDirtyShape(){this.markPaintDirty()}}scenery.register("PathCanvasDrawable",PathCanvasDrawable);Poolable.mixInto(PathCanvasDrawable);const PathCanvasDrawable$1=PathCanvasDrawable,keepSVGPathElements=!0;class PathSVGDrawable extends PathStatefulDrawable$1(SVGSelfDrawable){initialize(e,t){super.initialize(e,t,!0,keepSVGPathElements),this.svgElement=this.svgElement||document.createElementNS(svgns,"path")}updateSVGSelf(){assert&&assert(!this.node.requiresSVGBoundsWorkaround(),"No workaround for https://github.com/phetsims/scenery/issues/196 is provided at this time, please add an epsilon");const e=this.svgElement;if(this.dirtyShape){let t=this.node.hasShape()?this.node._shape.getSVGPath():"";t||(t="M0 0"),e.setAttribute("d",`${t}${platform.safari?" M0 0":""}`)}this.updateFillStrokeStyle(e)}}scenery.register("PathSVGDrawable",PathSVGDrawable);Poolable.mixInto(PathSVGDrawable);const PathSVGDrawable$1=PathSVGDrawable;class RectangleCanvasDrawable extends PaintableStatelessDrawable$1(CanvasSelfDrawable){writeRectangularPath(e,t){e.beginPath(),e.moveTo(t._rectX,t._rectY),e.lineTo(t._rectX+t._rectWidth,t._rectY),e.lineTo(t._rectX+t._rectWidth,t._rectY+t._rectHeight),e.lineTo(t._rectX,t._rectY+t._rectHeight),e.closePath()}paintCanvas(e,t,n){const r=e.context;if(t.isRounded()){r.beginPath();const s=t.getMaximumArcSize(),a=Math.min(t._cornerXRadius,s),l=Math.min(t._cornerYRadius,s),d=t._rectX+a,c=t._rectX+t._rectWidth-a,y=t._rectY+l,m=t._rectY+t._rectHeight-l;a===l?(r.arc(c,y,a,-Math.PI/2,0,!1),r.arc(c,m,a,0,Math.PI/2,!1),r.arc(d,m,a,Math.PI/2,Math.PI,!1),r.arc(d,y,a,Math.PI,Math.PI*3/2,!1)):(r.ellipse(c,y,a,l,0,-Math.PI/2,0,!1),r.ellipse(c,m,a,l,0,0,Math.PI/2,!1),r.ellipse(d,m,a,l,0,Math.PI/2,Math.PI,!1),r.ellipse(d,y,a,l,0,Math.PI,Math.PI*3/2,!1)),r.closePath(),t.hasFill()&&(t.beforeCanvasFill(e),r.fill(),t.afterCanvasFill(e)),t.hasPaintableStroke()&&(t.beforeCanvasStroke(e),r.stroke(),t.afterCanvasStroke(e))}else t.hasFill()&&(t.getFillValue().transformMatrix?(this.writeRectangularPath(r,t),t.beforeCanvasFill(e),r.fill(),t.afterCanvasFill(e)):(t.beforeCanvasFill(e),r.fillRect(t._rectX,t._rectY,t._rectWidth,t._rectHeight),t.afterCanvasFill(e))),t.hasPaintableStroke()&&(t.getStrokeValue().transformMatrix?(this.writeRectangularPath(r,t),t.beforeCanvasStroke(e),r.stroke(),t.afterCanvasStroke(e)):(t.beforeCanvasStroke(e),r.strokeRect(t._rectX,t._rectY,t._rectWidth,t._rectHeight),t.afterCanvasStroke(e)))}markDirtyRectangle(){this.markPaintDirty()}markDirtyX(){this.markDirtyRectangle()}markDirtyY(){this.markDirtyRectangle()}markDirtyWidth(){this.markDirtyRectangle()}markDirtyHeight(){this.markDirtyRectangle()}markDirtyCornerXRadius(){this.markDirtyRectangle()}markDirtyCornerYRadius(){this.markDirtyRectangle()}}scenery.register("RectangleCanvasDrawable",RectangleCanvasDrawable);Poolable.mixInto(RectangleCanvasDrawable);const RectangleCanvasDrawable$1=RectangleCanvasDrawable,scratchMatrix$2=Matrix3.pool.fetch();class RectangleDOMDrawable extends RectangleStatefulDrawable(DOMSelfDrawable){constructor(e,t){super(e,t),Utils.prepareForTransform(this.domElement)}initialize(e,t){if(super.initialize(e,t),!this.fillElement||!this.strokeElement){const n=document.createElement("div");this.fillElement=n,n.style.display="block",n.style.position="absolute",n.style.left="0",n.style.top="0",n.style.pointerEvents="none";const r=document.createElement("div");this.strokeElement=r,r.style.display="block",r.style.position="absolute",r.style.left="0",r.style.top="0",r.style.pointerEvents="none",n.appendChild(r)}this.domElement=this.fillElement}updateDOM(){const e=this.node,t=this.fillElement,n=this.strokeElement;if(this.paintDirty){const r=Math.min(e._cornerXRadius,e._cornerYRadius),s=this.dirtyCornerXRadius||this.dirtyCornerYRadius;if(this.dirtyWidth&&(t.style.width=`${e._rectWidth}px`),this.dirtyHeight&&(t.style.height=`${e._rectHeight}px`),s&&(t.style[Features.borderRadius]=`${r}px`),this.dirtyFill&&(t.style.backgroundColor=e.getCSSFill()),this.dirtyStroke&&(e.hasStroke()?n.style.borderStyle="solid":n.style.borderStyle="none"),e.hasStroke()){const a=!this.hadStroke;(a||this.dirtyWidth||this.dirtyLineWidth)&&(n.style.width=`${e._rectWidth-e.getLineWidth()}px`),(a||this.dirtyHeight||this.dirtyLineWidth)&&(n.style.height=`${e._rectHeight-e.getLineWidth()}px`),(a||this.dirtyLineWidth)&&(n.style.left=`${-e.getLineWidth()/2}px`,n.style.top=`${-e.getLineWidth()/2}px`,n.style.borderWidth=`${e.getLineWidth()}px`),(a||this.dirtyStroke)&&(n.style.borderColor=e.getSimpleCSSStroke()),(a||s||this.dirtyLineWidth||this.dirtyLineOptions)&&(n.style[Features.borderRadius]=e.isRounded()||e.getLineJoin()==="round"?`${r+e.getLineWidth()/2}px`:"0")}}if(this.transformDirty||this.dirtyX||this.dirtyY){scratchMatrix$2.set(this.getTransformMatrix());const r=Matrix3.translation(e._rectX,e._rectY);scratchMatrix$2.multiplyMatrix(r),r.freeToPool(),Utils.applyPreparedTransform(scratchMatrix$2,this.fillElement)}this.setToCleanState(),this.cleanPaintableState(),this.transformDirty=!1}dispose(){super.dispose()}}scenery.register("RectangleDOMDrawable",RectangleDOMDrawable);Poolable.mixInto(RectangleDOMDrawable);const RectangleDOMDrawable$1=RectangleDOMDrawable,keepSVGRectangleElements=!0;class RectangleSVGDrawable extends RectangleStatefulDrawable(SVGSelfDrawable){initialize(e,t){super.initialize(e,t,!0,keepSVGRectangleElements),this.lastArcW=-1,this.lastArcH=-1,this.svgElement=this.svgElement||document.createElementNS(svgns,"rect")}updateSVGSelf(){const e=this.svgElement;if(this.dirtyX&&e.setAttribute("x",this.node._rectX),this.dirtyY&&e.setAttribute("y",this.node._rectY),this.dirtyWidth&&e.setAttribute("width",this.node._rectWidth),this.dirtyHeight&&e.setAttribute("height",this.node._rectHeight),this.dirtyCornerXRadius||this.dirtyCornerYRadius||this.dirtyWidth||this.dirtyHeight){let t=0,n=0;if(this.node.isRounded()){const r=this.node.getMaximumArcSize();t=Math.min(this.node._cornerXRadius,r),n=Math.min(this.node._cornerYRadius,r)}t!==this.lastArcW&&(this.lastArcW=t,e.setAttribute("rx",t)),n!==this.lastArcH&&(this.lastArcH=n,e.setAttribute("ry",n))}this.updateFillStrokeStyle(e)}}scenery.register("RectangleSVGDrawable",RectangleSVGDrawable);Poolable.mixInto(RectangleSVGDrawable);const RectangleSVGDrawable$1=RectangleSVGDrawable,scratchColor=new Color("transparent");class RectangleWebGLDrawable extends RectangleStatefulDrawable(WebGLSelfDrawable){initialize(e,t){super.initialize(e,t),this.vertexArray||(this.vertexArray=new Float32Array(6*6)),this.upperLeft=new Vector2(0,0),this.lowerLeft=new Vector2(0,0),this.upperRight=new Vector2(0,0),this.lowerRight=new Vector2(0,0),this.transformDirty=!0,this.includeVertices=!0}onAddToBlock(e){this.webglBlock=e,this.markDirty()}onRemoveFromBlock(e){}markTransformDirty(){this.transformDirty=!0,super.markTransformDirty()}update(){if(!super.update())return!1;if(this.dirtyFill&&(this.includeVertices=this.node.hasFill(),this.includeVertices)){const e=isTReadOnlyProperty(this.node.fill)?this.node.fill.value:this.node.fill,t=scratchColor.set(e),n=t.red/255,r=t.green/255,s=t.blue/255,a=t.alpha;for(let l=0;l<6;l++){const d=l*6;this.vertexArray[2+d]=n,this.vertexArray[3+d]=r,this.vertexArray[4+d]=s,this.vertexArray[5+d]=a}}if(this.transformDirty||this.dirtyX||this.dirtyY||this.dirtyWidth||this.dirtyHeight){this.transformDirty=!1;const e=this.node._rectX,t=this.node._rectY,n=this.node._rectWidth,r=this.node._rectHeight,s=this.instance.relativeTransform.matrix;s.multiplyVector2(this.upperLeft.setXY(e,t)),s.multiplyVector2(this.lowerLeft.setXY(e,t+r)),s.multiplyVector2(this.upperRight.setXY(e+n,t)),s.multiplyVector2(this.lowerRight.setXY(e+n,t+r)),this.vertexArray[0]=this.upperLeft.x,this.vertexArray[1]=this.upperLeft.y,this.vertexArray[6]=this.lowerLeft.x,this.vertexArray[7]=this.lowerLeft.y,this.vertexArray[12]=this.upperRight.x,this.vertexArray[13]=this.upperRight.y,this.vertexArray[18]=this.upperRight.x,this.vertexArray[19]=this.upperRight.y,this.vertexArray[24]=this.lowerLeft.x,this.vertexArray[25]=this.lowerLeft.y,this.vertexArray[30]=this.lowerRight.x,this.vertexArray[31]=this.lowerRight.y}return this.setToCleanState(),this.cleanPaintableState(),!0}}RectangleWebGLDrawable.prototype.webglRenderer=Renderer.webglVertexColorPolygons;scenery.register("RectangleWebGLDrawable",RectangleWebGLDrawable);Poolable.mixInto(RectangleWebGLDrawable);const RectangleWebGLDrawable$1=RectangleWebGLDrawable;class SpritesCanvasDrawable extends CanvasSelfDrawable{paintCanvas(e,t,n){assert&&assert(t instanceof Node$2);const r=Imageable$1.getApproximateMatrixScale(n)*(window.devicePixelRatio||1),s=t._spriteInstances.length;for(let a=0;a<s;a++){const l=t._spriteInstances[a],d=l.sprite.imageProperty.value,c=l.alpha!==1||d.imageOpacity!==1,y=d._mipmap&&d.hasMipmaps();if(c&&(e.context.save(),e.context.globalAlpha*=l.alpha*d.imageOpacity),l.transformType===SpriteInstanceTransformType.TRANSLATION&&n.isTranslation())if(y){const m=d.getMipmapLevelFromScale(r,Imageable$1.CANVAS_MIPMAP_BIAS_ADJUSTMENT),O=d.getMipmapCanvas(m),D=Math.pow(2,m);e.context.drawImage(O,l.matrix.m02()-d.offset.x,l.matrix.m12()-d.offset.y,O.width*D,O.height*D)}else e.context.drawImage(d.image,l.matrix.m02()-d.offset.x,l.matrix.m12()-d.offset.y);else{if(e.context.save(),l.matrix.canvasAppendTransform(e.context),y){const m=d.getMipmapLevelFromScale(r*Imageable$1.getApproximateMatrixScale(l.matrix),Imageable$1.CANVAS_MIPMAP_BIAS_ADJUSTMENT),O=d.getMipmapCanvas(m),D=Math.pow(2,m);e.context.drawImage(O,-d.offset.x,-d.offset.y,O.width*D,O.height*D)}else e.context.drawImage(d.image,-d.offset.x,-d.offset.y);e.context.restore()}c&&e.context.restore()}}}scenery.register("SpritesCanvasDrawable",SpritesCanvasDrawable);Poolable.mixInto(SpritesCanvasDrawable);const SpritesCanvasDrawable$1=SpritesCanvasDrawable,COMPONENTS=5,FLOAT_QUANTITY=COMPONENTS*6,upperLeft=new Vector2(0,0),lowerLeft=new Vector2(0,0),upperRight=new Vector2(0,0),lowerRight=new Vector2(0,0);class SpritesWebGLDrawable extends WebGLSelfDrawable{initialize(e,t){super.initialize(e,t),this.contextChangeListener=this.onWebGLContextChange.bind(this),this.spriteSheet=new SpriteSheet(!0),this.spriteImageUVMap={},this.vertexArray=new Float32Array(128*FLOAT_QUANTITY),this.transformMatrixArray=new Float32Array(9),this.spriteChangeListener=this.onSpriteChange.bind(this),this.node._sprites.forEach(n=>{n.imageProperty.lazyLink(this.spriteChangeListener),this.addSpriteImage(n.imageProperty.value)}),this.hasDrawn=!1}addSpriteImage(e){this.spriteImageUVMap[e.id]=this.spriteSheet.addImage(e.image,e.image.width,e.image.height).uvBounds}removeSpriteImage(e){this.spriteSheet.removeImage(e.image),delete this.spriteImageUVMap[e.id]}onSpriteChange(e,t){this.removeSpriteImage(t),this.addSpriteImage(e)}setup(){const e=this.webGLBlock.gl;this.spriteSheet.initializeContext(e),this.shaderProgram=new ShaderProgram(e,["attribute vec2 aVertex;","attribute vec2 aTextureCoord;","attribute float aAlpha;","varying vec2 vTextureCoord;","varying float vAlpha;","uniform mat3 uProjectionMatrix;","uniform mat3 uTransformMatrix;","void main() {","  vTextureCoord = aTextureCoord;","  vAlpha = aAlpha;","  vec3 ndc = uProjectionMatrix * ( uTransformMatrix * vec3( aVertex, 1.0 ) );","  gl_Position = vec4( ndc.xy, 0.0, 1.0 );","}"].join(`
`),["precision mediump float;","varying vec2 vTextureCoord;","varying float vAlpha;","uniform sampler2D uTexture;","void main() {","  vec4 color = texture2D( uTexture, vTextureCoord, -0.7 );","  color.a *= vAlpha;","  gl_FragColor = color;","}"].join(`
`),{attributes:["aVertex","aTextureCoord","aAlpha"],uniforms:["uTexture","uProjectionMatrix","uTransformMatrix"]}),this.vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertexArray,e.DYNAMIC_DRAW)}onWebGLContextChange(){this.setup()}onAddToBlock(e){this.webGLBlock=e,this.setup(),e.glChangedEmitter.addListener(this.contextChangeListener)}onRemoveFromBlock(e){e.glChangedEmitter.removeListener(this.contextChangeListener)}draw(){const e=this.node._spriteInstances.length;if(e===0)return 0;this.spriteSheet.updateTexture(),this.shaderProgram.use();let t=0,n=!1;for(;FLOAT_QUANTITY*e>this.vertexArray.length;)this.vertexArray=new Float32Array(this.vertexArray.length*2),n=!0;for(let l=0;l<e;l++){const d=this.node._spriteInstances[l],c=d.sprite.imageProperty.value,y=d.alpha*c.imageOpacity,m=this.spriteImageUVMap[c.id],O=d.matrix,D=c.offset,z=c.image.width,w=c.image.height;O.multiplyVector2(upperLeft.setXY(-D.x,-D.y)),O.multiplyVector2(lowerLeft.setXY(-D.x,w-D.y)),O.multiplyVector2(upperRight.setXY(z-D.x,-D.y)),O.multiplyVector2(lowerRight.setXY(z-D.x,w-D.y)),this.vertexArray[t+0]=upperLeft.x,this.vertexArray[t+1]=upperLeft.y,this.vertexArray[t+2]=m.minX,this.vertexArray[t+3]=m.minY,this.vertexArray[t+4]=y,this.vertexArray[t+5]=lowerLeft.x,this.vertexArray[t+6]=lowerLeft.y,this.vertexArray[t+7]=m.minX,this.vertexArray[t+8]=m.maxY,this.vertexArray[t+9]=y,this.vertexArray[t+10]=upperRight.x,this.vertexArray[t+11]=upperRight.y,this.vertexArray[t+12]=m.maxX,this.vertexArray[t+13]=m.minY,this.vertexArray[t+14]=y,this.vertexArray[t+15]=upperRight.x,this.vertexArray[t+16]=upperRight.y,this.vertexArray[t+17]=m.maxX,this.vertexArray[t+18]=m.minY,this.vertexArray[t+19]=y,this.vertexArray[t+20]=lowerLeft.x,this.vertexArray[t+21]=lowerLeft.y,this.vertexArray[t+22]=m.minX,this.vertexArray[t+23]=m.maxY,this.vertexArray[t+24]=y,this.vertexArray[t+25]=lowerRight.x,this.vertexArray[t+26]=lowerRight.y,this.vertexArray[t+27]=m.maxX,this.vertexArray[t+28]=m.maxY,this.vertexArray[t+29]=y,t+=FLOAT_QUANTITY}const r=this.webGLBlock.gl;r.uniformMatrix3fv(this.shaderProgram.uniformLocations.uProjectionMatrix,!1,this.webGLBlock.projectionMatrixArray),this.instance.relativeTransform.matrix.copyToArray(this.transformMatrixArray),r.uniformMatrix3fv(this.shaderProgram.uniformLocations.uTransformMatrix,!1,this.transformMatrixArray),r.bindBuffer(r.ARRAY_BUFFER,this.vertexBuffer),n?r.bufferData(r.ARRAY_BUFFER,this.vertexArray,r.DYNAMIC_DRAW):r.bufferSubData(r.ARRAY_BUFFER,0,this.vertexArray.subarray(0,t));const s=Float32Array.BYTES_PER_ELEMENT,a=COMPONENTS*s;return r.vertexAttribPointer(this.shaderProgram.attributeLocations.aVertex,2,r.FLOAT,!1,a,0*s),r.vertexAttribPointer(this.shaderProgram.attributeLocations.aTextureCoord,2,r.FLOAT,!1,a,2*s),r.vertexAttribPointer(this.shaderProgram.attributeLocations.aAlpha,1,r.FLOAT,!1,a,4*s),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,this.spriteSheet.texture),r.uniform1i(this.shaderProgram.uniformLocations.uTexture,0),r.drawArrays(r.TRIANGLES,0,t/COMPONENTS),r.bindTexture(r.TEXTURE_2D,null),this.shaderProgram.unuse(),!this.hasDrawn&&platform.safari&&animationFrameTimer.setTimeout(()=>this.markDirty(),0),this.hasDrawn=!0,1}dispose(){this.node._sprites.forEach(e=>{e.imageProperty.unlink(this.spriteChangeListener)}),this.webGLBlock&&(this.webGLBlock=null),super.dispose()}markPaintDirty(){this.markDirty()}}SpritesWebGLDrawable.prototype.webglRenderer=Renderer.webglCustom;scenery.register("SpritesWebGLDrawable",SpritesWebGLDrawable);Poolable.mixInto(SpritesWebGLDrawable);const SpritesWebGLDrawable$1=SpritesWebGLDrawable;class TextCanvasDrawable extends PaintableStatelessDrawable$1(CanvasSelfDrawable){paintCanvas(e,t,n){const r=e.context;(t.hasFill()||t.hasPaintableStroke())&&(e.setFont(t._font.getFont()),e.setDirection("ltr")),t.hasFill()&&(t.beforeCanvasFill(e),r.fillText(t.renderedText,0,0),t.afterCanvasFill(e)),t.hasPaintableStroke()&&(t.beforeCanvasStroke(e),r.strokeText(t.renderedText,0,0),t.afterCanvasStroke(e))}markDirtyText(){this.markPaintDirty()}markDirtyFont(){this.markPaintDirty()}markDirtyBounds(){this.markPaintDirty()}}scenery.register("TextCanvasDrawable",TextCanvasDrawable);Poolable.mixInto(TextCanvasDrawable);const TextCanvasDrawable$1=TextCanvasDrawable,scratchMatrix$1=Matrix3.pool.fetch();class TextDOMDrawable extends TextStatefulDrawable$1(DOMSelfDrawable){constructor(e,t){super(e,t),Utils.prepareForTransform(this.domElement)}initialize(e,t){super.initialize(e,t),this.domElement||(this.domElement=document.createElement("div"),this.domElement.style.display="block",this.domElement.style.position="absolute",this.domElement.style.pointerEvents="none",this.domElement.style.left="0",this.domElement.style.top="0",this.domElement.setAttribute("dir","ltr"))}updateDOM(){const e=this.node,t=this.domElement;if(this.paintDirty&&(this.dirtyFont&&(t.style.font=e.getFont()),this.dirtyStroke&&(t.style.color=e.getCSSFill()),this.dirtyBounds&&(t.style.width=`${e.getSelfBounds().width}px`,t.style.height=`${e.getSelfBounds().height}px`),this.dirtyText&&(t.textContent=e.renderedText)),this.transformDirty||this.dirtyText||this.dirtyFont||this.dirtyBounds){const n=e.getSelfBounds().minY;scratchMatrix$1.set(this.getTransformMatrix());const r=Matrix3.translation(0,n);scratchMatrix$1.multiplyMatrix(r),r.freeToPool(),Utils.applyPreparedTransform(scratchMatrix$1,t)}this.setToCleanState(),this.cleanPaintableState(),this.transformDirty=!1}dispose(){super.dispose()}}scenery.register("TextDOMDrawable",TextDOMDrawable);Poolable.mixInto(TextDOMDrawable);const TextDOMDrawable$1=TextDOMDrawable,keepSVGTextElements=!0,useSVGTextLengthAdjustments=!platform.edge,useTransparentSVGTextWorkaround=platform.safari;class TextSVGDrawable extends TextStatefulDrawable$1(SVGSelfDrawable){initialize(e,t){if(super.initialize(e,t,!0,keepSVGTextElements),this.hasLength=!1,!this.svgElement){const n=document.createElementNS(svgns,"text");if(this.text=n,useTransparentSVGTextWorkaround){const r=document.createElementNS(svgns,"g");r.appendChild(n),this.svgElement=r,this.workaroundRect=document.createElementNS(svgns,"rect"),this.workaroundRect.setAttribute("fill","transparent"),r.appendChild(this.workaroundRect)}else this.svgElement=n;n.appendChild(document.createTextNode("")),n.setAttribute("dominant-baseline","alphabetic"),n.setAttribute("text-rendering","geometricPrecision"),n.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),n.setAttribute("direction","ltr")}}updateSVGSelf(){const e=this.text;if(this.dirtyFont&&(e.setAttribute("font-family",this.node._font.getFamily()),e.setAttribute("font-size",this.node._font.getSize()),e.setAttribute("font-style",this.node._font.getStyle()),e.setAttribute("font-weight",this.node._font.getWeight()),e.setAttribute("font-stretch",this.node._font.getStretch())),this.dirtyText&&(e.lastChild.nodeValue=Utils.safariEmbeddingMarkWorkaround(this.node.renderedText)),this.dirtyBounds&&useSVGTextLengthAdjustments&&(this.node._boundsMethod!=="accurate"&&isFinite(this.node.selfBounds.width)?(this.hasLength||(this.hasLength=!0,e.setAttribute("lengthAdjust","spacingAndGlyphs")),e.setAttribute("textLength",this.node.selfBounds.width)):this.hasLength&&(this.hasLength=!1,e.removeAttribute("lengthAdjust"),e.removeAttribute("textLength")),useTransparentSVGTextWorkaround)){const r=this.node.selfBounds.width*.2,s=this.node.selfBounds.height*.2;this.workaroundRect.setAttribute("x",this.node.selfBounds.minX-r),this.workaroundRect.setAttribute("y",this.node.selfBounds.minY-s),this.workaroundRect.setAttribute("width",this.node.selfBounds.width+2*r),this.workaroundRect.setAttribute("height",this.node.selfBounds.height+2*s)}this.updateFillStrokeStyle(e)}}scenery.register("TextSVGDrawable",TextSVGDrawable);Poolable.mixInto(TextSVGDrawable);const TextSVGDrawable$1=TextSVGDrawable;class WebGLNodeDrawable extends WebGLSelfDrawable{initialize(e,t){super.initialize(e,t),this.contextChangeListener=this.contextChangeListener||this.onWebGLContextChange.bind(this),this.painter=null}createPainter(){const e=this.node.painterType;return new e(this.webGLBlock.gl,this.node)}onWebGLContextChange(){this.painter=this.createPainter()}onAddToBlock(e){this.webGLBlock=e,this.painter=this.createPainter(),e.glChangedEmitter.addListener(this.contextChangeListener)}onRemoveFromBlock(e){e.glChangedEmitter.removeListener(this.contextChangeListener)}draw(){const e=this.instance.relativeTransform.matrix,t=this.painter.paint(e,this.webGLBlock.projectionMatrix);return assert&&assert(t===WebGLNode.PAINTED_SOMETHING||t===WebGLNode.PAINTED_NOTHING),assert&&assert(WebGLNode.PAINTED_NOTHING===0&&WebGLNode.PAINTED_SOMETHING===1,"Ensure we can pass the value through directly to indicate whether draw calls were made"),t}dispose(){this.painter.dispose(),this.painter=null,this.webGLBlock&&(this.webGLBlock=null),super.dispose()}markPaintDirty(){this.markDirty()}get shaderAttributes(){return this.node.shaderAttributes}}WebGLNodeDrawable.prototype.webglRenderer=Renderer.webglCustom;scenery.register("WebGLNodeDrawable",WebGLNodeDrawable);Poolable.mixInto(WebGLNodeDrawable);const WebGLNodeDrawable$1=WebGLNodeDrawable;class InlineCanvasCacheDrawable extends Drawable{constructor(e,t){super(),this.initialize(e,t)}initialize(e,t){super.initialize(e),this.instance=t}stitch(e,t,n,r){}}scenery.register("InlineCanvasCacheDrawable",InlineCanvasCacheDrawable);class SharedCanvasCacheDrawable extends Drawable{constructor(e,t,n,r){super(),this.initialize(e,t,n,r)}initialize(e,t,n,r){super.initialize(t),this.instance=n,this.sharedInstance=r}}scenery.register("SharedCanvasCacheDrawable",SharedCanvasCacheDrawable);class RelativeTransform{constructor(e){this.instance=e}initialize(e,t){return this.display=e,this.trail=t,this.node=t&&t.lastNode(),this.transformDirty=!0,this.nodeTransformListener=this.nodeTransformListener||this.onNodeTransformDirty.bind(this),this.matrix=this.matrix||Matrix3.identity(),this.relativeSelfDirty=!0,this.relativeChildrenListenersCount=0,this.relativePrecomputeCount=0,this.relativeChildrenPrecomputeCount=0,this.relativeFrameId=-1,this.relativeChildDirtyFrame=e?e._frameId:0,this.relativeTransformListeners=cleanArray(this.relativeTransformListeners),this}get parent(){return this.instance.parent?this.instance.parent.relativeTransform:null}addInstance(e){e.stateless?(assert&&assert(!e.relativeTransform.hasAncestorListenerNeed(),"We only track changes properly if stateless instances do not have needs"),assert&&assert(!e.relativeTransform.hasAncestorComputeNeed(),"We only track changes properly if stateless instances do not have needs")):(e.relativeTransform.hasAncestorListenerNeed()&&this.incrementTransformListenerChildren(),e.relativeTransform.hasAncestorComputeNeed()&&this.incrementTransformPrecomputeChildren()),e.relativeTransform.forceMarkTransformDirty()}removeInstance(e){e.relativeTransform.hasAncestorListenerNeed()&&this.decrementTransformListenerChildren(),e.relativeTransform.hasAncestorComputeNeed()&&this.decrementTransformPrecomputeChildren()}attachNodeListeners(){this.node.transformEmitter.addListener(this.nodeTransformListener)}detachNodeListeners(){this.node.transformEmitter.removeListener(this.nodeTransformListener)}hasDescendantListenerNeed(){return this.instance.isTransformed?this.relativeChildrenListenersCount>0:this.relativeChildrenListenersCount>0||this.relativeTransformListeners.length>0}hasAncestorListenerNeed(){return this.instance.isTransformed?this.relativeTransformListeners.length>0:this.relativeChildrenListenersCount>0||this.relativeTransformListeners.length>0}hasSelfListenerNeed(){return this.relativeTransformListeners.length>0}incrementTransformListenerChildren(){const e=this.hasAncestorListenerNeed();this.relativeChildrenListenersCount++,e!==this.hasAncestorListenerNeed()&&(assert&&assert(!this.instance.isTransformed,"Should not be a change in need if we have the isTransformed flag"),this.parent&&this.parent.incrementTransformListenerChildren())}decrementTransformListenerChildren(){const e=this.hasAncestorListenerNeed();this.relativeChildrenListenersCount--,e!==this.hasAncestorListenerNeed()&&(assert&&assert(!this.instance.isTransformed,"Should not be a change in need if we have the isTransformed flag"),this.parent&&this.parent.decrementTransformListenerChildren())}addListener(e){const t=this.hasAncestorListenerNeed();this.relativeTransformListeners.push(e),t!==this.hasAncestorListenerNeed()&&(this.parent&&this.parent.incrementTransformListenerChildren(),this.hasAncestorComputeNeed()||this.forceMarkTransformDirty())}removeListener(e){const t=this.hasAncestorListenerNeed();this.relativeTransformListeners.splice(_.indexOf(this.relativeTransformListeners,e),1),t!==this.hasAncestorListenerNeed()&&this.parent&&this.parent.decrementTransformListenerChildren()}hasDescendantComputeNeed(){return this.instance.isTransformed?this.relativeChildrenPrecomputeCount>0:this.relativeChildrenPrecomputeCount>0||this.relativePrecomputeCount>0}hasAncestorComputeNeed(){return this.instance.isTransformed?this.relativePrecomputeCount>0:this.relativeChildrenPrecomputeCount>0||this.relativePrecomputeCount>0}hasSelfComputeNeed(){return this.relativePrecomputeCount>0}incrementTransformPrecomputeChildren(){const e=this.hasAncestorComputeNeed();this.relativeChildrenPrecomputeCount++,e!==this.hasAncestorComputeNeed()&&(assert&&assert(!this.instance.isTransformed,"Should not be a change in need if we have the isTransformed flag"),this.parent&&this.parent.incrementTransformPrecomputeChildren())}decrementTransformPrecomputeChildren(){const e=this.hasAncestorComputeNeed();this.relativeChildrenPrecomputeCount--,e!==this.hasAncestorComputeNeed()&&(assert&&assert(!this.instance.isTransformed,"Should not be a change in need if we have the isTransformed flag"),this.parent&&this.parent.decrementTransformPrecomputeChildren())}addPrecompute(){const e=this.hasAncestorComputeNeed();this.relativePrecomputeCount++,e!==this.hasAncestorComputeNeed()&&(this.parent&&this.parent.incrementTransformPrecomputeChildren(),this.hasAncestorListenerNeed()||this.forceMarkTransformDirty())}removePrecompute(){const e=this.hasAncestorComputeNeed();this.relativePrecomputeCount--,e!==this.hasAncestorComputeNeed()&&this.parent&&this.parent.decrementTransformPrecomputeChildren()}onNodeTransformDirty(){this.transformDirty||this.forceMarkTransformDirty()}forceMarkTransformDirty(){this.transformDirty=!0,this.relativeSelfDirty=!0;const e=this.display._frameId;let t=this.instance.parent;for(;t&&t.relativeTransform.relativeChildDirtyFrame!==e;){const n=t.parent,r=t.isTransformed;if(t.relativeTransform.relativeChildDirtyFrame=e,n===null){this.display.markTransformRootDirty(t,r);break}else if(r){this.display.markTransformRootDirty(t,!0);break}t=n}}computeRelativeTransform(){const e=this.node.getMatrix();this.instance.parent&&!this.instance.parent.isTransformed?(this.matrix.set(this.parent.matrix),this.matrix.multiplyMatrix(e)):this.matrix.set(e),this.relativeFrameId=this.display._frameId,this.relativeSelfDirty=!1}isValidationNotNeeded(){return this.hasAncestorComputeNeed()||this.relativeFrameId===this.display._frameId}validate(){if(!this.isValidationNotNeeded()&&(this.instance.parent&&!this.instance.parent.isTransformed&&this.parent.validate(),this.relativeSelfDirty)){this.computeRelativeTransform();const e=this.instance.children.length;for(let t=0;t<e;t++)this.instance.children[t].relativeTransform.relativeSelfDirty=!0}}updateTransformListenersAndCompute(e,t,n,r){sceneryLog&&sceneryLog.RelativeTransform&&sceneryLog.RelativeTransform(`update/compute: ${this.toString()} ${e} => ${t}${r?" passTransform":""}`),sceneryLog&&sceneryLog.RelativeTransform&&sceneryLog.push();let s,a;if(r)for(s=this.instance.children.length,a=0;a<s;a++)this.instance.children[a].relativeTransform.updateTransformListenersAndCompute(!1,!1,n,!1);else{const l=e||this.relativeSelfDirty,d=l||this.relativeChildDirtyFrame===n,c=this.hasDescendantComputeNeed(),y=this.hasDescendantListenerNeed(),m=this.hasSelfComputeNeed(),O=this.hasSelfListenerNeed();if(!c&&l&&!t&&(this.relativeSelfDirty=!0),!d||!c&&!y&&!m&&!O){sceneryLog&&sceneryLog.RelativeTransform&&sceneryLog.pop();return}if(l&&(c||m)&&this.computeRelativeTransform(),this.transformDirty&&(this.transformDirty=!1),this.notifyRelativeTransformListeners(),!this.instance.isTransformed||r){const D=l&&!(c||m);for(s=this.instance.children.length,a=0;a<s;a++)this.instance.children[a].relativeTransform.updateTransformListenersAndCompute(l,D,n,!1)}}sceneryLog&&sceneryLog.RelativeTransform&&sceneryLog.pop()}notifyRelativeTransformListeners(){const e=this.relativeTransformListeners.length;for(let t=0;t<e;t++)this.relativeTransformListeners[t]()}audit(e,t){function n(s){const a=Matrix3.pool.fetch(),l=s.node.getMatrix();return s.parent?s.parent.isTransformed?a.set(l):(a.set(n(s.parent)),a.multiplyMatrix(l)):a.set(Matrix3.IDENTITY),a}function r(s){return t&&s.isValidationNotNeeded()?!1:s.relativeSelfDirty||s.parent&&r(s.parent)}if(assertSlow){let s=0,a=0;for(let l=0;l<this.instance.children.length;l++){const d=this.instance.children[l];d.relativeTransform.hasAncestorListenerNeed()&&s++,d.relativeTransform.hasAncestorComputeNeed()&&a++}if(assertSlow(s===this.relativeChildrenListenersCount,"Relative listener count invariant"),assertSlow(a===this.relativeChildrenPrecomputeCount,"Relative precompute count invariant"),assertSlow(!this.parent||this.instance.isTransformed||this.relativeChildDirtyFrame!==e||this.parent.relativeChildDirtyFrame===e,"If we have a parent, we need to hold the invariant this.relativeChildDirtyFrame => parent.relativeChildDirtyFrame"),!t&&!r(this)){const l=n(this);assertSlow(l.equals(this.matrix),"If there is no relativeSelfDirty flag set here or in our ancestors, our matrix should be up-to-date")}}}}scenery.register("RelativeTransform",RelativeTransform);class ChangeInterval{constructor(e,t){this.initialize(e,t)}initialize(e,t){assert&&assert(e===null||e instanceof Drawable,"drawableBefore can either be null to indicate that there is no un-changed drawable before our changes, or it can reference an un-changed drawable"),assert&&assert(t===null||t instanceof Drawable,"drawableAfter can either be null to indicate that there is no un-changed drawable after our changes, or it can reference an un-changed drawable"),this.nextChangeInterval=null,this.drawableBefore=e,this.drawableAfter=t,this.collapsedEmpty=!1}dispose(){this.nextChangeInterval=null,this.drawableBefore=null,this.drawableAfter=null,this.freeToPool()}constrict(){let e=!1;if(this.isEmpty())return!0;for(;this.drawableBefore&&this.drawableBefore.nextDrawable===this.drawableBefore.oldNextDrawable;)if(this.drawableBefore=this.drawableBefore.nextDrawable,e=!0,this.drawableBefore||(assert&&assert(!this.drawableAfter),this.collapsedEmpty=!0),this.isEmpty())return!0;for(;this.drawableAfter&&this.drawableAfter.previousDrawable===this.drawableAfter.oldPreviousDrawable;)if(this.drawableAfter=this.drawableAfter.previousDrawable,e=!0,this.drawableAfter||(assert&&assert(!this.drawableBefore),this.collapsedEmpty=!0),this.isEmpty())return!0;return e}isEmpty(){return this.collapsedEmpty||this.drawableBefore!==null&&this.drawableBefore===this.drawableAfter}getOldInternalDrawableCount(e,t){const n=this.drawableBefore?this.drawableBefore.oldNextDrawable:e,r=this.drawableAfter;let s=0;for(let a=n;a!==r;a=a.oldNextDrawable)s++;return s}getNewInternalDrawableCount(e,t){const n=this.drawableBefore?this.drawableBefore.nextDrawable:e,r=this.drawableAfter;let s=0;for(let a=n;a!==r;a=a.nextDrawable)s++;return s}static newForDisplay(e,t,n){const r=ChangeInterval.createFromPool(e,t);return n.markChangeIntervalToDispose(r),r}}scenery.register("ChangeInterval",ChangeInterval);Poolable.mixInto(ChangeInterval);class Fittability{constructor(e){this.instance=e}initialize(e,t){return this.display=e,this.trail=t,this.node=t&&t.lastNode(),this.selfFittable=!!t&&this.isSelfFitSupported(),this.ancestorsFittable=this.selfFittable,this.subtreeUnfittableCount=this.selfFittable?0:1,this.subtreeFittabilityChangeEmitter=this.subtreeFittabilityChangeEmitter||new TinyEmitter,this}get parent(){return this.instance.parent?this.instance.parent.fittability:null}checkSelfFittability(){const e=this.isSelfFitSupported();this.selfFittable!==e&&this.updateSelfFittable()}isSelfFitSupported(){return this.display._allowLayerFitting&&!this.node.isPreventFit()}markSubtreeFittable(){if(!this.selfFittable)return;this.ancestorsFittable=!0;const e=this.instance.children;for(let t=0;t<e.length;t++)e[t].fittability.markSubtreeFittable();this.instance.updateDrawableFittability(!0)}markSubtreeUnfittable(){if(!this.ancestorsFittable)return;this.ancestorsFittable=!1;const e=this.instance.children;for(let t=0;t<e.length;t++)e[t].fittability.markSubtreeUnfittable();this.instance.updateDrawableFittability(!1)}updateSelfFittable(){const e=this.isSelfFitSupported();assert&&assert(this.selfFittable!==e),this.selfFittable=e,this.selfFittable&&(!this.parent||this.parent.ancestorsFittable)?this.markSubtreeFittable():this.selfFittable||this.markSubtreeUnfittable(),this.selfFittable?this.decrementSubtreeUnfittableCount():this.incrementSubtreeUnfittableCount()}incrementSubtreeUnfittableCount(){this.subtreeUnfittableCount++,this.subtreeUnfittableCount===1&&(this.parent&&this.parent.incrementSubtreeUnfittableCount(),this.subtreeFittabilityChangeEmitter.emit())}decrementSubtreeUnfittableCount(){this.subtreeUnfittableCount--,this.subtreeUnfittableCount===0&&(this.parent&&this.parent.decrementSubtreeUnfittableCount(),this.subtreeFittabilityChangeEmitter.emit())}onInsert(e){this.ancestorsFittable||e.markSubtreeUnfittable(),e.subtreeUnfittableCount>0&&this.incrementSubtreeUnfittableCount()}onRemove(e){this.ancestorsFittable||e.markSubtreeFittable(),e.subtreeUnfittableCount>0&&this.decrementSubtreeUnfittableCount()}audit(){if(assertSlow){assertSlow(this.selfFittable===this.isSelfFitSupported(),"selfFittable diverged from isSelfFitSupported()"),assertSlow(this.ancestorsFittable===((this.parent?this.parent.ancestorsFittable:!0)&&this.selfFittable),"Our ancestorsFittable should be false if our parent or our self is not fittable.");let e=0;this.selfFittable||e++,_.each(this.instance.children,t=>{t.fittability.subtreeUnfittableCount>0&&e++}),assertSlow(this.subtreeUnfittableCount===e,"Incorrect subtreeUnfittableCount")}}}scenery.register("Fittability",Fittability);let globalId=1,clipGlobalId=1;class SVGGroup{constructor(e,t,n){this.id=`group${globalId++}`,this.initialize(e,t,n)}initialize(e,t,n){sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`initializing ${this.toString()}`),this.block=e,this.instance=t,this.node=t.trail.lastNode(),this.parent=n,this.children=cleanArray(this.children),this.hasSelfDrawable=!1,this.selfDrawable=null,this.dirty=!0,this.willApplyTransforms=this.block.transformRootInstance.trail.nodes.length<this.instance.trail.nodes.length,this.willApplyFilters=this.block.filterRootInstance.trail.nodes.length<this.instance.trail.nodes.length,this.transformDirty=!0,this.hasTransform=this.hasTransform!==void 0?this.hasTransform:!1,this.transformDirtyListener=this.transformDirtyListener||this.markTransformDirty.bind(this),this.willApplyTransforms&&this.node.transformEmitter.addListener(this.transformDirtyListener),this.filterDirty=!0,this.visibilityDirty=!0,this.clipDirty=!0,this.filterElement=this.filterElement||null,this.hasOpacity=this.hasOpacity!==void 0?this.hasOpacity:!1,this.hasFilter=!1,this.clipDefinition=this.clipDefinition!==void 0?this.clipDefinition:null,this.clipPath=this.clipPath!==void 0?this.clipPath:null,this.filterChangeListener=this.filterChangeListener||this.onFilterChange.bind(this),this.visibilityDirtyListener=this.visibilityDirtyListener||this.onVisibleChange.bind(this),this.clipDirtyListener=this.clipDirtyListener||this.onClipChange.bind(this),this.node.visibleProperty.lazyLink(this.visibilityDirtyListener),this.willApplyFilters&&this.node.filterChangeEmitter.addListener(this.filterChangeListener),this.node.clipAreaProperty.lazyLink(this.clipDirtyListener),this.orderDirty=!0,this.orderDirtyListener=this.orderDirtyListener||this.markOrderDirty.bind(this),this.node.childrenChangedEmitter.addListener(this.orderDirtyListener),this.svgGroup||(this.svgGroup=document.createElementNS(svgns,"g")),this.instance.addSVGGroup(this),this.block.markDirtyGroup(this)}addSelfDrawable(e){this.selfDrawable=e,this.svgGroup.insertBefore(e.svgElement,this.children.length?this.children[0].svgGroup:null),this.hasSelfDrawable=!0}removeSelfDrawable(e){this.hasSelfDrawable=!1,this.svgGroup.removeChild(e.svgElement),this.selfDrawable=null}addChildGroup(e){this.markOrderDirty(),e.parent=this,this.children.push(e),this.svgGroup.appendChild(e.svgGroup)}removeChildGroup(e){this.markOrderDirty(),e.parent=null,this.children.splice(_.indexOf(this.children,e),1),this.svgGroup.removeChild(e.svgGroup)}markDirty(){this.dirty||(this.dirty=!0,this.block.markDirtyGroup(this))}markOrderDirty(){this.orderDirty||(this.orderDirty=!0,this.markDirty())}markTransformDirty(){this.transformDirty||(this.transformDirty=!0,this.markDirty())}onFilterChange(){this.filterDirty||(this.filterDirty=!0,this.markDirty())}onVisibleChange(){this.visibilityDirty||(this.visibilityDirty=!0,this.markDirty())}onClipChange(){this.clipDirty||(this.clipDirty=!0,this.markDirty())}update(){if(sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`update: ${this.toString()}`),!this.block)return;sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.push();const e=this.svgGroup;if(this.dirty=!1,this.transformDirty&&(this.transformDirty=!1,sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`transform update: ${this.toString()}`),this.willApplyTransforms?this.node.transform.isIdentity()?this.hasTransform&&(this.hasTransform=!1,e.removeAttribute("transform")):(this.hasTransform=!0,e.setAttribute("transform",this.node.transform.getMatrix().getSVGTransform())):this.hasTransform&&(this.hasTransform=!1,e.removeAttribute("transform"))),this.visibilityDirty&&(this.visibilityDirty=!1,sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`visibility update: ${this.toString()}`),e.style.display=this.node.isVisible()?"":"none"),this.filterDirty){this.filterDirty=!1,sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`filter update: ${this.toString()}`);const t=this.node.effectiveOpacity;this.willApplyFilters&&t!==1?(this.hasOpacity=!0,e.setAttribute("opacity",t)):this.hasOpacity&&(this.hasOpacity=!1,e.removeAttribute("opacity"));const n=this.willApplyFilters&&this.node._filters.length,r=`filter-${this.id}`;if(n){for(this.filterElement||(this.filterElement=document.createElementNS(svgns,"filter"),this.filterElement.setAttribute("id",r));this.filterElement.firstChild;)this.filterElement.removeChild(this.filterElement.lastChild);let s=50,a="SourceGraphic";const l=this.node._filters.length;for(let y=0;y<l;y++){const m=this.node._filters[y],O=y===l-1?void 0:`e${y}`;m.applySVGFilter(this.filterElement,a,O),s+=m.filterRegionPercentageIncrease,a=O}const d=`-${toSVGNumber(s)}%`,c=`${toSVGNumber(2*s+100)}%`;this.filterElement.setAttribute("x",d),this.filterElement.setAttribute("y",d),this.filterElement.setAttribute("width",c),this.filterElement.setAttribute("height",c)}n&&(this.hasFilter||this.block.defs.appendChild(this.filterElement),e.setAttribute("filter",`url(#${r})`),this.hasFilter=!0),this.hasFilter&&!n&&(e.removeAttribute("filter"),this.hasFilter=!1,this.block.defs.removeChild(this.filterElement))}if(this.clipDirty)if(this.clipDirty=!1,sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`clip update: ${this.toString()}`),this.node.clipArea){if(!this.clipDefinition){const t=`clip${clipGlobalId++}`;this.clipDefinition=document.createElementNS(svgns,"clipPath"),this.clipDefinition.setAttribute("id",t),this.clipDefinition.setAttribute("clipPathUnits","userSpaceOnUse"),this.block.defs.appendChild(this.clipDefinition),this.clipPath=document.createElementNS(svgns,"path"),this.clipDefinition.appendChild(this.clipPath),e.setAttribute("clip-path",`url(#${t})`)}this.clipPath.setAttribute("d",this.node.clipArea.getSVGPath())}else this.clipDefinition&&(e.removeAttribute("clip-path"),this.block.defs.removeChild(this.clipDefinition),this.clipDefinition=null,this.clipPath=null);if(this.orderDirty){this.orderDirty=!1,sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`order update: ${this.toString()}`),sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.push();let t=this.children.length-1;const n=this.instance.children;for(let r=n.length-1;r>=0;r--){const s=n[r].lookupSVGGroup(this.block);if(s){if(this.children[t]!==s){sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`group out of order: ${t} for ${s.toString()}`),e.insertBefore(s.svgGroup,t+1>=this.children.length?null:this.children[t+1].svgGroup);const a=_.indexOf(this.children,s);assert&&assert(a<t,"The item we are moving backwards to location [idx] should not have an index greater than that"),this.children.splice(a,1),this.children.splice(t,0,s)}else sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`group in place: ${t} for ${s.toString()}`);t--}}sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.pop()}sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.pop()}isReleasable(){return!this.hasSelfDrawable&&!this.children.length&&this.parent}dispose(){sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`dispose ${this.toString()}`),sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.push(),assert&&assert(this.children.length===0,"Should be empty by now"),this.hasFilter&&(this.svgGroup.removeAttribute("filter"),this.hasFilter=!1,this.block.defs.removeChild(this.filterElement)),this.willApplyTransforms&&this.node.transformEmitter.removeListener(this.transformDirtyListener),this.node.visibleProperty.unlink(this.visibilityDirtyListener),this.willApplyFilters&&this.node.filterChangeEmitter.removeListener(this.filterChangeListener),this.node.clipAreaProperty.unlink(this.clipDirtyListener),this.node.childrenChangedEmitter.removeListener(this.orderDirtyListener),this.instance.active&&this.instance.removeSVGGroup(this),this.clipDefinition&&(this.svgGroup.removeAttribute("clip-path"),this.block.defs.removeChild(this.clipDefinition),this.clipDefinition=null,this.clipPath=null),this.parent=null,this.block=null,this.instance=null,this.node=null,cleanArray(this.children),this.selfDrawable=null,this.freeToPool(),sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.pop()}toString(){return`SVGGroup:${this.block.toString()}_${this.instance.toString()}`}static addDrawable(e,t){assert&&assert(t.instance,"Instance is required for a drawable to be grouped correctly in SVG"),SVGGroup.ensureGroupsToInstance(e,t.instance).addSelfDrawable(t)}static removeDrawable(e,t){t.instance.lookupSVGGroup(e).removeSelfDrawable(t),SVGGroup.releaseGroupsToInstance(e,t.instance)}static ensureGroupsToInstance(e,t){let n=t.lookupSVGGroup(e);if(!n){assert&&assert(t!==e.rootGroup.instance,"Making sure we do not walk past our rootGroup");const r=SVGGroup.ensureGroupsToInstance(e,t.parent);n=SVGGroup.createFromPool(e,t,r),r.addChildGroup(n)}return n}static releaseGroupsToInstance(e,t){const n=t.lookupSVGGroup(e);if(n.isReleasable()){const r=n.parent;r.removeChildGroup(n),SVGGroup.releaseGroupsToInstance(e,r.instance),n.dispose()}}}scenery.register("SVGGroup",SVGGroup);Poolable.mixInto(SVGGroup);class Block extends Drawable{initialize(e,t){assert&&assert(!e._isDisposing,"Should not create a block for a Display that is being disposed of"),assert&&assert(!e._isDisposed,"Should not create a block for a disposed Display"),super.initialize(t),this.display=e,this.drawableCount=0,this.used=!0,this.firstDrawable=null,this.lastDrawable=null,this.pendingFirstDrawable=null,this.pendingLastDrawable=null,this.previousBlock=null,this.nextBlock=null,this.zIndex=0,assertSlow&&(this.drawableList=cleanArray(this.drawableList))}dispose(){assert&&assert(this.drawableCount===0,"There should be no drawables on a block when it is disposed"),this.display=null,this.firstDrawable=null,this.lastDrawable=null,this.pendingFirstDrawable=null,this.pendingLastDrawable=null,this.previousBlock=null,this.nextBlock=null,assertSlow&&cleanArray(this.drawableList),super.dispose()}addDrawable(e){if(this.drawableCount++,this.markDirtyDrawable(e),assertSlow){const t=_.indexOf(this.drawableList,e);assertSlow&&assertSlow(t===-1,"Drawable should not be added when it has not been removed"),this.drawableList.push(e),assertSlow&&assertSlow(this.drawableCount===this.drawableList.length,"Count sanity check, to make sure our assertions are not buggy")}}removeDrawable(e){if(this.drawableCount--,this.markDirty(),assertSlow){const t=_.indexOf(this.drawableList,e);assertSlow&&assertSlow(t!==-1,"Drawable should be already added when it is removed"),this.drawableList.splice(t,1),assertSlow&&assertSlow(this.drawableCount===this.drawableList.length,"Count sanity check, to make sure our assertions are not buggy")}}onIntervalChange(e,t){}updateInterval(){(this.pendingFirstDrawable!==this.firstDrawable||this.pendingLastDrawable!==this.lastDrawable)&&(this.onIntervalChange(this.pendingFirstDrawable,this.pendingLastDrawable),this.firstDrawable=this.pendingFirstDrawable,this.lastDrawable=this.pendingLastDrawable)}notifyInterval(e,t){this.pendingFirstDrawable=e,this.pendingLastDrawable=t,this.updateInterval()}audit(e,t,n){if(assertSlow){super.audit(e,t,n);let r=0;if(!t){for(let s=this.firstDrawable;s!==null&&(s.audit(e,t,n),r++,s!==this.lastDrawable);s=s.nextDrawable);if(!e){assertSlow&&assertSlow(r===this.drawableCount,"drawableCount should match"),assertSlow&&assertSlow(this.firstDrawable===this.pendingFirstDrawable,"No pending first drawable"),assertSlow&&assertSlow(this.lastDrawable===this.pendingLastDrawable,"No pending last drawable");for(let s=this.firstDrawable;s!==null&&(assertSlow&&assertSlow(s.renderer===this.renderer,"Renderers should match"),assertSlow&&assertSlow(s.parentDrawable===this,"This block should be this drawable's parent"),assertSlow&&assertSlow(_.indexOf(this.drawableList,s)>=0),s!==this.lastDrawable);s=s.nextDrawable);}}}}}scenery.register("Block",Block);const Block$1=Block,scratchBounds2=Bounds2.NOTHING.copy();class FittedBlock extends Block$1{initialize(e,t,n,r){return super.initialize(e,t),this.transformRootInstance=n,assert&&assert(typeof n.isDisplayRoot=="boolean"),this.canBeFullDisplay=n.isDisplayRoot,assert&&assert(r===FittedBlock.FULL_DISPLAY||r===FittedBlock.COMMON_ANCESTOR),this.preferredFit=r,this.fit=r,this.dirtyFit=!0,this.commonFitInstance=null,this.fitBounds=Bounds2.NOTHING.copy(),this.oldFitBounds=Bounds2.NOTHING.copy(),this.unfittableDrawableCount=0,this.dirtyFitListener=this.dirtyFitListener||this.markDirtyFit.bind(this),this.fittableListener=this.fittableListener||this.onFittabilityChange.bind(this),this.display.sizeProperty.lazyLink(this.dirtyFitListener),this}setFit(e){!this.canBeFullDisplay&&e===FittedBlock.FULL_DISPLAY&&(e=FittedBlock.COMMON_ANCESTOR),this.fit!==e&&(this.fit=e,this.markDirtyFit(),this.oldFitBounds.set(Bounds2.NOTHING),e===FittedBlock.COMMON_ANCESTOR&&this.removeCommonFitInstance())}markDirtyFit(){sceneryLog&&sceneryLog.dirty&&sceneryLog.dirty(`markDirtyFit on FittedBlock#${this.id}`),this.dirtyFit=!0,this.markDirty()}updateFit(){if(assert&&assert(this.fit===FittedBlock.FULL_DISPLAY||this.fit===FittedBlock.COMMON_ANCESTOR,"Unsupported fit"),!(!this.dirtyFit&&this.fit===FittedBlock.FULL_DISPLAY))if(sceneryLog&&sceneryLog.FittedBlock&&sceneryLog.FittedBlock(`updateFit #${this.id}`),this.dirtyFit=!1,this.fit===FittedBlock.COMMON_ANCESTOR&&this.commonFitInstance===null&&this.addCommonFitInstance(this.computeCommonAncestorInstance()),this.fit===FittedBlock.COMMON_ANCESTOR&&this.commonFitInstance.fittability.subtreeUnfittableCount>0&&this.canBeFullDisplay&&(this.oldFitBounds.set(Bounds2.NOTHING),this.fit=FittedBlock.FULL_DISPLAY),this.fit===FittedBlock.FULL_DISPLAY)this.fitBounds.set(Bounds2.NOTHING),this.setSizeFullDisplay();else if(this.fit===FittedBlock.COMMON_ANCESTOR){assert&&assert(this.commonFitInstance.trail.length>=this.transformRootInstance.trail.length),this.fitBounds.set(this.commonFitInstance.node.getLocalBounds());let e=this.commonFitInstance;for(;e!==this.transformRootInstance;)this.fitBounds.transform(e.node.getMatrix()),e=e.parent;this.fitBounds.roundOut(),this.fitBounds.dilate(4),this.transformRootInstance.isDisplayRoot&&(scratchBounds2.setMinMax(0,0,this.display.width,this.display.height),this.fitBounds.constrainBounds(scratchBounds2)),this.fitBounds.isValid()||this.fitBounds.setMinMax(0,0,0,0),this.fitBounds.equals(this.oldFitBounds)||(this.oldFitBounds.set(this.fitBounds),this.setSizeFitBounds())}else throw new Error("unknown fit")}setSizeFullDisplay(){}setSizeFitBounds(){}addCommonFitInstance(e){assert&&assert(this.commonFitInstance===null),e&&(this.commonFitInstance=e,this.commonFitInstance.fittability.subtreeFittabilityChangeEmitter.addListener(this.dirtyFitListener))}removeCommonFitInstance(){this.commonFitInstance&&(this.commonFitInstance.fittability.subtreeFittabilityChangeEmitter.removeListener(this.dirtyFitListener),this.commonFitInstance=null)}dispose(){sceneryLog&&sceneryLog.FittedBlock&&sceneryLog.FittedBlock(`dispose #${this.id}`),this.display.sizeProperty.unlink(this.dirtyFitListener),this.removeCommonFitInstance(),this.transformRootInstance=null,super.dispose()}addDrawable(e){super.addDrawable(e),e.fittableProperty.lazyLink(this.fittableListener),e.fittable||this.incrementUnfittable()}removeDrawable(e){super.removeDrawable(e),e.fittableProperty.unlink(this.fittableListener),e.fittable||this.decrementUnfittable()}onFittabilityChange(e){e?this.decrementUnfittable():this.incrementUnfittable()}incrementUnfittable(){this.unfittableDrawableCount++,this.unfittableDrawableCount===1&&this.checkFitConstraints()}decrementUnfittable(){this.unfittableDrawableCount--,this.unfittableDrawableCount===0&&this.checkFitConstraints()}checkFitConstraints(){this.unfittableDrawableCount>0&&this.canBeFullDisplay?this.setFit(FittedBlock.FULL_DISPLAY):this.setFit(this.preferredFit)}computeCommonAncestorInstance(){assert&&assert(this.firstDrawable.instance&&this.lastDrawable.instance,"For common-ancestor fits, we need the first and last drawables to have direct instance references");let e=this.firstDrawable.instance,t=this.lastDrawable.instance;const n=Math.min(e.trail.length,t.trail.length);for(;e.trail.length>n;)e=e.parent;for(;t.trail.length>n;)t=t.parent;for(;e!==t;)e=e.parent,t=t.parent;const r=e;return assert&&assert(r.trail.length>=this.transformRootInstance.trail.length),r}onIntervalChange(e,t){sceneryLog&&sceneryLog.FittedBlock&&sceneryLog.FittedBlock(`#${this.id}.onIntervalChange ${e.toString()} to ${t.toString()}`),super.onIntervalChange(e,t),this.fit===FittedBlock.COMMON_ANCESTOR&&(this.removeCommonFitInstance(),this.markDirtyFit())}}scenery.register("FittedBlock",FittedBlock);FittedBlock.FULL_DISPLAY=1;FittedBlock.COMMON_ANCESTOR=2;FittedBlock.fitString={1:"fullDisplay",2:"commonAncestor"};const FittedBlock$1=FittedBlock,scratchMatrix=new Matrix3,scratchMatrix2=new Matrix3;class CanvasBlock extends FittedBlock$1{constructor(e,t,n,r){super(),this.initialize(e,t,n,r)}initialize(e,t,n,r){super.initialize(e,t,n,FittedBlock$1.COMMON_ANCESTOR),this.filterRootInstance=r,this.dirtyDrawables=cleanArray(this.dirtyDrawables),this.domElement||(this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.left="0",this.canvas.style.top="0",this.canvas.style.pointerEvents="none",this.canvasId=this.canvas.id=`scenery-canvas${this.id}`,this.context=this.canvas.getContext("2d"),this.context.save(),this.context.miterLimit=20,this.context.miterLimit=10,this.wrapper=new CanvasContextWrapper(this.canvas,this.context),this.domElement=this.canvas,this.wrapperStack=[this.wrapper]),this.wrapperStackIndex=0,this.filterListenerCountMap=this.filterListenerCountMap||{},Utils.prepareForTransform(this.canvas),Utils.unsetTransform(this.canvas),this.canvasDrawOffset=new Vector2(0,0),this.currentDrawable=null,this.clipDirty=!0,this.clipCount=0,this.backingScale=t&Renderer.bitmaskCanvasLowResolution?1:Utils.backingScale(this.context),this.clipDirtyListener=this.markDirty.bind(this),this.opacityDirtyListener=this.markDirty.bind(this),sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`initialized #${this.id}`)}setSizeFullDisplay(){const e=this.display.getSize();this.canvas.width=e.width*this.backingScale,this.canvas.height=e.height*this.backingScale,this.canvas.style.width=`${e.width}px`,this.canvas.style.height=`${e.height}px`,this.wrapper.resetStyles(),this.canvasDrawOffset.setXY(0,0),Utils.unsetTransform(this.canvas)}setSizeFitBounds(){const e=this.fitBounds.minX,t=this.fitBounds.minY;this.canvasDrawOffset.setXY(-e,-t),Utils.setTransform(`matrix(1,0,0,1,${e},${t})`,this.canvas),this.canvas.width=this.fitBounds.width*this.backingScale,this.canvas.height=this.fitBounds.height*this.backingScale,this.canvas.style.width=`${this.fitBounds.width}px`,this.canvas.style.height=`${this.fitBounds.height}px`,this.wrapper.resetStyles()}update(){if(!super.update())return!1;for(sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`update #${this.id}`),sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.push();this.dirtyDrawables.length;)this.dirtyDrawables.pop().update();this.updateFit(),this.context.restore(),this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.save(),this.wrapper.resetStyles(),this.currentDrawable=null;for(let e=this.firstDrawable;e!==null&&(this.renderDrawable(e),e!==this.lastDrawable);e=e.nextDrawable);return this.currentDrawable&&this.walkDown(this.currentDrawable.instance.trail,0),assert&&assert(this.clipCount===0,"clipCount should be zero after walking back down"),sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.pop(),!0}applyClip(e){this.clipDirty=!1,sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`Apply clip ${e.instance.trail.toDebugString()}`),sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.push();const t=this.wrapperStack[this.wrapperStackIndex],n=t.context;if(n.restore(),n.save(),t.resetStyles(),this.clipCount){const s=e.instance.trail;scratchMatrix.rowMajor(this.backingScale,0,this.canvasDrawOffset.x*this.backingScale,0,this.backingScale,this.canvasDrawOffset.y*this.backingScale,0,0,1),scratchMatrix2.set(this.transformRootInstance.trail.getMatrix()).invert(),scratchMatrix2.multiplyMatrix(scratchMatrix).canvasSetTransform(n);for(let a=0;a<s.length;a++){const l=s.nodes[a];l.getMatrix().canvasAppendTransform(n),l.hasClipArea()&&(n.beginPath(),l.clipArea.writeToContext(n),n.clip())}}sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.pop()}pushWrapper(){if(this.wrapperStackIndex++,this.clipDirty=!0,this.wrapperStackIndex===this.wrapperStack.length){const n=document.createElement("canvas"),r=n.getContext("2d");r.save(),this.wrapperStack.push(new CanvasContextWrapper(n,r))}const e=this.wrapperStack[this.wrapperStackIndex],t=e.context;e.setDimensions(this.canvas.width,this.canvas.height),t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,this.canvas.width,this.canvas.height)}popWrapper(){this.wrapperStackIndex--,this.clipDirty=!0}walkDown(e,t){const n=this.filterRootInstance.trail.length-1;for(let r=e.length-1;r>=t;r--){const s=e.nodes[r];if(s.hasClipArea()&&(sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`Pop clip ${e.subtrailTo(s).toDebugString()}`),this.clipCount--,this.clipDirty=!0),r>n){if(s._filters.length){sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`Pop filters ${e.subtrailTo(s).toDebugString()}`);const a=this.wrapperStack[this.wrapperStackIndex],l=this.wrapperStack[this.wrapperStackIndex-1];this.popWrapper(),l.context.setTransform(1,0,0,1,0,0);const d=s._filters;let c=Features.canvasFilter;for(let y=0;y<d.length;y++)c=c&&d[y].isDOMCompatible();if(c){let y="";for(let m=0;m<d.length;m++)y+=`${y?" ":""}${d[m].getCSSFilterString()}`;l.context.filter=y,l.context.drawImage(a.canvas,0,0),l.context.filter="none"}else{for(let y=0;y<d.length;y++)d[y].applyCanvasFilter(a);l.context.drawImage(a.canvas,0,0)}}if(s.getEffectiveOpacity()!==1){sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`Pop opacity ${e.subtrailTo(s).toDebugString()}`);const a=this.wrapperStack[this.wrapperStackIndex],l=this.wrapperStack[this.wrapperStackIndex-1];this.popWrapper(),l.context.setTransform(1,0,0,1,0,0),l.context.globalAlpha=s.getEffectiveOpacity(),l.context.drawImage(a.canvas,0,0),l.context.globalAlpha=1}}}}walkUp(e,t){const n=this.filterRootInstance.trail.length-1;for(let r=t;r<e.length;r++){const s=e.nodes[r];r>n&&(s.getEffectiveOpacity()!==1&&(sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`Push opacity ${e.subtrailTo(s).toDebugString()}`),this.pushWrapper()),s._filters.length&&(sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`Push filters ${e.subtrailTo(s).toDebugString()}`),this.pushWrapper())),s.hasClipArea()&&(sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`Push clip ${e.subtrailTo(s).toDebugString()}`),this.clipCount++,this.clipDirty=!0)}}renderDrawable(e){if(!e.visible||this.canvas.width===0||this.canvas.height===0)return;sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`renderDrawable #${e.id} ${e.instance.trail.toDebugString()}`),sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.push();const t=this.currentDrawable?e.instance.getBranchIndexTo(this.currentDrawable.instance):0;this.currentDrawable&&this.walkDown(this.currentDrawable.instance.trail,t),this.walkUp(e.instance.trail,t);const n=this.wrapperStack[this.wrapperStackIndex],r=n.context;this.clipDirty&&this.applyClip(e),assert&&assert(e.instance.relativeTransform.isValidationNotNeeded());const s=e.instance.relativeTransform.matrix;r.setTransform(this.backingScale,0,0,this.backingScale,this.canvasDrawOffset.x*this.backingScale,this.canvasDrawOffset.y*this.backingScale),e.instance!==this.transformRootInstance&&s.canvasAppendTransform(r),e.paintCanvas(n,e.instance.node,e.instance.relativeTransform.matrix),this.currentDrawable=e,sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.pop()}dispose(){sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`dispose #${this.id}`),this.transformRootInstance=null,cleanArray(this.dirtyDrawables),this.canvas.width=0,this.canvas.height=0,super.dispose()}markDirtyDrawable(e){sceneryLog&&sceneryLog.dirty&&sceneryLog.dirty(`markDirtyDrawable on CanvasBlock#${this.id} with ${e.toString()}`),assert&&assert(e),assert&&this.display.ensureNotPainting(),this.dirtyDrawables.push(e),this.markDirty()}addDrawable(e){sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`#${this.id}.addDrawable ${e.toString()}`),super.addDrawable(e);for(let t=e.instance;t&&t!==this.filterRootInstance;t=t.parent){const n=t.node;this.filterListenerCountMap[n.id]?this.filterListenerCountMap[n.id]++:(this.filterListenerCountMap[n.id]=1,n.filterChangeEmitter.addListener(this.opacityDirtyListener),n.clipAreaProperty.lazyLink(this.clipDirtyListener))}}removeDrawable(e){sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`#${this.id}.removeDrawable ${e.toString()}`);for(let t=e.instance;t&&t!==this.filterRootInstance;t=t.parent){const n=t.node;assert&&assert(this.filterListenerCountMap[n.id]>0),this.filterListenerCountMap[n.id]--,this.filterListenerCountMap[n.id]===0&&(delete this.filterListenerCountMap[n.id],n.clipAreaProperty.unlink(this.clipDirtyListener),n.filterChangeEmitter.removeListener(this.opacityDirtyListener))}super.removeDrawable(e)}onIntervalChange(e,t){sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`#${this.id}.onIntervalChange ${e.toString()} to ${t.toString()}`),super.onIntervalChange(e,t),this.markDirty()}onPotentiallyMovedDrawable(e){sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`#${this.id}.onPotentiallyMovedDrawable ${e.toString()}`),sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.push(),assert&&assert(e.parentDrawable===this),e.markDirty(),sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.pop()}toString(){return`CanvasBlock#${this.id}-${FittedBlock$1.fitString[this.fit]}`}}scenery.register("CanvasBlock",CanvasBlock);Poolable.mixInto(CanvasBlock);const CanvasBlock$1=CanvasBlock;class DOMBlock extends Block$1{constructor(e,t){super(),this.initialize(e,t)}initialize(e,t){return super.initialize(e,t.renderer),this.domDrawable=t,this.domElement=t.domElement,this}update(){return super.update()?(this.domDrawable.update(),!0):!1}dispose(){this.domDrawable=null,this.domElement=null,super.dispose()}markDirtyDrawable(e){this.markDirty()}addDrawable(e){sceneryLog&&sceneryLog.DOMBlock&&sceneryLog.DOMBlock(`#${this.id}.addDrawable ${e.toString()}`),assert&&assert(this.domDrawable===e,"DOMBlock should only be used with one drawable for now (the one it was initialized with)"),super.addDrawable(e)}removeDrawable(e){sceneryLog&&sceneryLog.DOMBlock&&sceneryLog.DOMBlock(`#${this.id}.removeDrawable ${e.toString()}`),assert&&assert(this.domDrawable===e,"DOMBlock should only be used with one drawable for now (the one it was initialized with)"),super.removeDrawable(e)}}scenery.register("DOMBlock",DOMBlock);Poolable.mixInto(DOMBlock);const DOMBlock$1=DOMBlock;class SVGBlock extends FittedBlock$1{constructor(e,t,n,r){super(),this.initialize(e,t,n,r)}initialize(e,t,n,r){super.initialize(e,t,n,FittedBlock$1.COMMON_ANCESTOR),this.filterRootInstance=r,this.dirtyGradients=cleanArray(this.dirtyGradients),this.dirtyGroups=cleanArray(this.dirtyGroups),this.dirtyDrawables=cleanArray(this.dirtyDrawables),this.paintCountMap=this.paintCountMap||new CountMap(this.onAddPaint.bind(this),this.onRemovePaint.bind(this)),this.areReferencesReduced=!0,this.domElement||(this.svg=document.createElementNS(svgns,"svg"),this.svg.style.position="absolute",this.svg.style.left="0",this.svg.style.top="0",this.svg.setAttribute("focusable",!1),this.svg.style["pointer-events"]="none",this.defs=document.createElementNS(svgns,"defs"),this.svg.appendChild(this.defs),this.baseTransformGroup=document.createElementNS(svgns,"g"),this.svg.appendChild(this.baseTransformGroup),this.domElement=this.svg),this.forceRefreshListener=()=>{if(!this.workaroundRect){const c=document.createElementNS(svgns,"g");this.svg.appendChild(c),this.workaroundRect=document.createElementNS(svgns,"rect"),this.workaroundRect.setAttribute("width","0"),this.workaroundRect.setAttribute("height","0"),this.workaroundRect.setAttribute("fill","none"),c.appendChild(this.workaroundRect)}const a=dotRandom.nextIntBetween(0,255),l=dotRandom.nextIntBetween(0,255),d=dotRandom.nextIntBetween(0,255);this.workaroundRect.setAttribute("fill",`rgba(${a},${l},${d},0.02)`)},this.display._refreshSVGEmitter.addListener(this.forceRefreshListener),Utils.prepareForTransform(this.svg),Utils.unsetTransform(this.svg),this.baseTransformGroup.setAttribute("transform","");const s=n.trail.nodes.length>r.trail.nodes.length?r:n;return this.rootGroup=SVGGroup.createFromPool(this,s,null),this.baseTransformGroup.appendChild(this.rootGroup.svgGroup),sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`initialized #${this.id}`),this}onAddPaint(e){const t=e.createSVGPaint(this);return t.definition.setAttribute("id",`${e.id}-${this.id}`),this.defs.appendChild(t.definition),t}onRemovePaint(e,t){this.defs.removeChild(t.definition),t.dispose()}incrementPaint(e){assert&&assert(e.isPaint),sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`incrementPaint ${this} ${e}`),this.paintCountMap.increment(e)}decrementPaint(e){assert&&assert(e.isPaint),sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`decrementPaint ${this} ${e}`),this.paintCountMap.decrement(e)}markDirtyGradient(e){this.dirtyGradients.push(e),this.markDirty()}markDirtyGroup(e){this.dirtyGroups.push(e),this.markDirty(),this.areReferencesReduced&&this.display.markForReducedReferences(this),this.areReferencesReduced=!1}markDirtyDrawable(e){sceneryLog&&sceneryLog.dirty&&sceneryLog.dirty(`markDirtyDrawable on SVGBlock#${this.id} with ${e.toString()}`),this.dirtyDrawables.push(e),this.markDirty(),this.areReferencesReduced&&this.display.markForReducedReferences(this),this.areReferencesReduced=!1}setSizeFullDisplay(){sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`setSizeFullDisplay #${this.id}`),this.baseTransformGroup.removeAttribute("transform"),Utils.unsetTransform(this.svg);const e=this.display.getSize();this.svg.setAttribute("width",e.width),this.svg.setAttribute("height",e.height)}setSizeFitBounds(){sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`setSizeFitBounds #${this.id} with ${this.fitBounds.toString()}`);const e=this.fitBounds.minX,t=this.fitBounds.minY;assert&&assert(isFinite(e)&&isFinite(t),"Invalid SVG transform for SVGBlock"),assert&&assert(this.fitBounds.isValid(),"Invalid fitBounds"),this.baseTransformGroup.setAttribute("transform",`translate(${-e},${-t})`),Utils.setTransform(`matrix(1,0,0,1,${e},${t})`,this.svg),this.svg.setAttribute("width",this.fitBounds.width),this.svg.setAttribute("height",this.fitBounds.height)}update(){if(!super.update())return!1;for(sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`update #${this.id}`);this.dirtyGroups.length;){const e=this.dirtyGroups.pop();e.block===this&&e.update()}for(;this.dirtyGradients.length;)this.dirtyGradients.pop().update();for(;this.dirtyDrawables.length;){const e=this.dirtyDrawables.pop();e.parentDrawable===this&&e.update()}return this.areReferencesReduced=!0,this.updateFit(),!0}reduceReferences(){if(this.areReferencesReduced)return;let e=0,t=0;for(;e<this.dirtyGroups.length;){const n=this.dirtyGroups[e];n.block===this&&(t!==e&&(this.dirtyGroups[t]=n),t++),e++}for(;this.dirtyGroups.length>t;)this.dirtyGroups.pop();for(e=0,t=0;e<this.dirtyDrawables.length;){const n=this.dirtyDrawables[e];n.parentDrawable===this&&(t!==e&&(this.dirtyDrawables[t]=n),t++),e++}for(;this.dirtyDrawables.length>t;)this.dirtyDrawables.pop();this.areReferencesReduced=!0}dispose(){for(sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`dispose #${this.id}`),this.svg.setAttribute("width","0"),this.svg.setAttribute("height","0"),this.filterRootInstance=null,cleanArray(this.dirtyGradients),cleanArray(this.dirtyGroups),cleanArray(this.dirtyDrawables),this.paintCountMap.clear(),this.display._refreshSVGEmitter.removeListener(this.forceRefreshListener),this.baseTransformGroup.removeChild(this.rootGroup.svgGroup),this.rootGroup.dispose(),this.rootGroup=null;this.defs.childNodes.length;)this.defs.removeChild(this.defs.childNodes[0]);super.dispose()}addDrawable(e){sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`#${this.id}.addDrawable ${e.toString()}`),super.addDrawable(e),SVGGroup.addDrawable(this,e),e.updateSVGBlock(this)}removeDrawable(e){sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`#${this.id}.removeDrawable ${e.toString()}`),SVGGroup.removeDrawable(this,e),super.removeDrawable(e)}onIntervalChange(e,t){sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`#${this.id}.onIntervalChange ${e.toString()} to ${t.toString()}`),super.onIntervalChange(e,t)}toString(){return`SVGBlock#${this.id}-${FittedBlock$1.fitString[this.fit]}`}}scenery.register("SVGBlock",SVGBlock);Poolable.mixInto(SVGBlock);class WebGLBlock extends FittedBlock$1{constructor(e,t,n,r){super(),this.initialize(e,t,n,r)}initialize(e,t,n,r){return sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`initialize #${this.id}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push(),super.initialize(e,t,n,FittedBlock$1.FULL_DISPLAY),this.filterRootInstance=r,this.preserveDrawingBuffer=e._preserveDrawingBuffer,this.dirtyDrawables=cleanArray(this.dirtyDrawables),this.spriteSheets=this.spriteSheets||[],this.projectionMatrix=this.projectionMatrix||new Matrix3,this.projectionMatrixArray=new Float32Array(9),this.customProcessor=this.customProcessor||new CustomProcessor,this.vertexColorPolygonsProcessor=this.vertexColorPolygonsProcessor||new VertexColorPolygons(this.projectionMatrixArray),this.texturedTrianglesProcessor=this.texturedTrianglesProcessor||new TexturedTrianglesProcessor(this.projectionMatrixArray),this.glChangedEmitter=new TinyEmitter,this.isContextLost=!1,this.contextLostListener=this.onContextLoss.bind(this),this.contextRestoreListener=this.onContextRestoration.bind(this),this.domElement||(this.domElement=document.createElement("div"),this.domElement.className="webgl-container",this.domElement.style.position="absolute",this.domElement.style.left="0",this.domElement.style.top="0",this.rebuildCanvas()),this.gl.clear(this.gl.COLOR_BUFFER_BIT),Utils.prepareForTransform(this.canvas),Utils.unsetTransform(this.canvas),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop(),this}rebuildCanvas(){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`rebuildCanvas #${this.id}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push();const e=document.createElement("canvas"),t=this.getContextFromCanvas(e);assert&&assert(t||this.canvas,"We should have a WebGL context by now"),t&&(this.canvas&&(this.domElement.removeChild(this.canvas),this.canvas.removeEventListener("webglcontextlost",this.contextLostListener,!1),this.canvas.removeEventListener("webglcontextrestored",this.contextRestoreListener,!1)),this.canvas=e,this.canvas.style.pointerEvents="none",this.canvasId=this.canvas.id=`scenery-webgl${this.id}`,this.canvas.addEventListener("webglcontextlost",this.contextLostListener,!1),this.canvas.addEventListener("webglcontextrestored",this.contextRestoreListener,!1),this.domElement.appendChild(this.canvas),this.setupContext(t)),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop()}setupContext(e){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`setupContext #${this.id}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push(),assert&&assert(e,"Should have an actual context if this is called"),this.isContextLost=!1,this.gl=e,this.backingScale=Utils.backingScale(this.gl),this.display._allowBackingScaleAntialiasing&&e.getParameter(e.SAMPLES)===0&&(this.backingScale*=2),this.originalBackingScale=this.backingScale,Utils.applyWebGLContextDefaults(this.gl),this.markDirty(),this.dirtyFit=!0,this.customProcessor.initializeContext(this.gl),this.vertexColorPolygonsProcessor.initializeContext(this.gl),this.texturedTrianglesProcessor.initializeContext(this.gl);for(let t=0;t<this.spriteSheets.length;t++)this.spriteSheets[t].initializeContext(this.gl);this.glChangedEmitter.emit(),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop()}delayedRebuildCanvas(){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`Delaying rebuilding of Canvas #${this.id}`);const e=this;window.setTimeout(function(){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`Executing delayed rebuilding #${this.id}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push(),e.rebuildCanvas(),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop()})}onContextLoss(e){this.isContextLost||(sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`Context lost #${this.id}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push(),this.isContextLost=!0,e.preventDefault(),this.canvas.style.display="none",this.markDirty(),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop())}onContextRestoration(e){if(this.isContextLost){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`Context restored #${this.id}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push();const t=this.getContextFromCanvas(this.canvas);assert&&assert(t,"We were told the context was restored, so this should work"),this.setupContext(t),this.canvas.style.display="",sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop()}}getContextFromCanvas(e){const t={antialias:!0,preserveDrawingBuffer:this.preserveDrawingBuffer};return e.getContext("webgl",t)||e.getContext("experimental-webgl",t)}setSizeFullDisplay(){const e=this.display.getSize();this.canvas.width=Math.ceil(e.width*this.backingScale),this.canvas.height=Math.ceil(e.height*this.backingScale),this.canvas.style.width=`${e.width}px`,this.canvas.style.height=`${e.height}px`}setSizeFitBounds(){throw new Error("setSizeFitBounds unimplemented for WebGLBlock")}update(){if(!super.update())return!1;sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`update #${this.id}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push();const e=this.gl;for(this.isContextLost&&this.display._aggressiveContextRecreation&&this.delayedRebuildCanvas();this.dirtyDrawables.length;)this.dirtyDrawables.pop().update();const t=this.spriteSheets.length;for(let s=0;s<t;s++)this.spriteSheets[s].updateTexture();this.firstDrawable&&this.firstDrawable===this.lastDrawable&&this.firstDrawable.node&&this.firstDrawable.node._webglScale!==null&&this.backingScale!==this.originalBackingScale*this.firstDrawable.node._webglScale&&(this.backingScale=this.originalBackingScale*this.firstDrawable.node._webglScale,this.dirtyFit=!0),this.updateFit(),this.projectionMatrix.rowMajor(2/this.display.width,0,-1,0,-2/this.display.height,1,0,0,1),this.projectionMatrix.copyToArray(this.projectionMatrixArray),this.preserveDrawingBuffer&&e.clear(e.COLOR_BUFFER_BIT),e.viewport(0,0,this.canvas.width,this.canvas.height);let n=null,r=0;for(let s=this.firstDrawable;s!==null;s=s.nextDrawable){if(s.visible){let a=null;s.webglRenderer===Renderer.webglTexturedTriangles?a=this.texturedTrianglesProcessor:s.webglRenderer===Renderer.webglCustom?a=this.customProcessor:s.webglRenderer===Renderer.webglVertexColorPolygons&&(a=this.vertexColorPolygonsProcessor),assert&&assert(a),a!==n&&(n&&(r+=n.deactivate()),n=a,n.activate()),n.processDrawable(s)}if(s===this.lastDrawable)break}return n&&(r+=n.deactivate()),r===0&&!this.preserveDrawingBuffer&&e.clear(e.COLOR_BUFFER_BIT),e.flush(),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop(),!0}dispose(){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`dispose #${this.id}`),cleanArray(this.dirtyDrawables),super.dispose()}markDirtyDrawable(e){sceneryLog&&sceneryLog.dirty&&sceneryLog.dirty(`markDirtyDrawable on WebGLBlock#${this.id} with ${e.toString()}`),assert&&assert(e),assert&&assert(!e.isDisposed),this.dirtyDrawables.push(e),this.markDirty()}addDrawable(e){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`#${this.id}.addDrawable ${e.toString()}`),super.addDrawable(e),e.onAddToBlock(this)}removeDrawable(e){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`#${this.id}.removeDrawable ${e.toString()}`);let t=0;for(;(t=this.dirtyDrawables.indexOf(e,t))>=0;)this.dirtyDrawables.splice(t,1);e.onRemoveFromBlock(this),super.removeDrawable(e)}addSpriteSheetImage(e,t,n){let r=null;const s=this.spriteSheets.length;for(let a=0;a<s&&(r=this.spriteSheets[a].addImage(e,t,n),!r);a++);if(!r){const a=new SpriteSheet(!0);if(r=a.addImage(e,t,n),a.initializeContext(this.gl),this.spriteSheets.push(a),!r)throw new Error("Attempt to load image that is too large for sprite sheets")}return r}removeSpriteSheetImage(e){e.spriteSheet.removeImage(e.image)}onIntervalChange(e,t){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`#${this.id}.onIntervalChange ${e.toString()} to ${t.toString()}`),super.onIntervalChange(e,t),this.markDirty()}onPotentiallyMovedDrawable(e){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`#${this.id}.onPotentiallyMovedDrawable ${e.toString()}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push(),assert&&assert(e.parentDrawable===this),this.markDirty(),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop()}toString(){return`WebGLBlock#${this.id}-${FittedBlock$1.fitString[this.fit]}`}}scenery.register("WebGLBlock",WebGLBlock);class Processor{activate(){}initializeContext(e){}processDrawable(e){}deactivate(){}}class CustomProcessor extends Processor{constructor(){super(),this.drawable=null}activate(){this.drawCount=0}processDrawable(e){assert&&assert(e.webglRenderer===Renderer.webglCustom),this.drawable=e,this.draw()}deactivate(){return this.drawCount}draw(){if(this.drawable){const e=this.drawable.draw();assert&&assert(typeof e=="number"),this.drawCount+=e,this.drawable=null}}}class VertexColorPolygons extends Processor{constructor(e){assert&&assert(e instanceof Float32Array),super(),this.projectionMatrixArray=e,this.lastArrayLength=128,this.vertexArray=new Float32Array(this.lastArrayLength)}initializeContext(e){assert&&assert(e,"Should be an actual context"),this.gl=e,this.shaderProgram=new ShaderProgram(e,["attribute vec2 aVertex;","attribute vec4 aColor;","varying vec4 vColor;","uniform mat3 uProjectionMatrix;","void main() {","  vColor = aColor;","  vec3 ndc = uProjectionMatrix * vec3( aVertex, 1.0 );","  gl_Position = vec4( ndc.xy, 0.0, 1.0 );","}"].join(`
`),["precision mediump float;","varying vec4 vColor;","void main() {","  gl_FragColor = vec4( vColor.rgb * vColor.a, vColor.a );","}"].join(`
`),{attributes:["aVertex","aColor"],uniforms:["uProjectionMatrix"]}),this.vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertexArray,e.DYNAMIC_DRAW)}activate(){this.shaderProgram.use(),this.vertexArrayIndex=0,this.drawCount=0}processDrawable(e){if(e.includeVertices){const t=e.vertexArray;for(;t.length+this.vertexArrayIndex>this.vertexArray.length;){const n=new Float32Array(this.vertexArray.length*2);n.set(this.vertexArray),this.vertexArray=n}this.vertexArray.set(t,this.vertexArrayIndex),this.vertexArrayIndex+=t.length,this.drawCount++}}deactivate(){return this.drawCount&&this.draw(),this.shaderProgram.unuse(),this.drawCount}draw(){const e=this.gl;e.uniformMatrix3fv(this.shaderProgram.uniformLocations.uProjectionMatrix,!1,this.projectionMatrixArray),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray.length>this.lastArrayLength?e.bufferData(e.ARRAY_BUFFER,this.vertexArray,e.DYNAMIC_DRAW):e.bufferSubData(e.ARRAY_BUFFER,0,this.vertexArray.subarray(0,this.vertexArrayIndex));const t=Float32Array.BYTES_PER_ELEMENT,n=6*t;e.vertexAttribPointer(this.shaderProgram.attributeLocations.aVertex,2,e.FLOAT,!1,n,0*t),e.vertexAttribPointer(this.shaderProgram.attributeLocations.aColor,4,e.FLOAT,!1,n,2*t),e.drawArrays(e.TRIANGLES,0,this.vertexArrayIndex/6),this.vertexArrayIndex=0}}class TexturedTrianglesProcessor extends Processor{constructor(e){assert&&assert(e instanceof Float32Array),super(),this.projectionMatrixArray=e,this.lastArrayLength=128,this.vertexArray=new Float32Array(this.lastArrayLength)}initializeContext(e){assert&&assert(e,"Should be an actual context"),this.gl=e,this.shaderProgram=new ShaderProgram(e,["attribute vec2 aVertex;","attribute vec2 aTextureCoord;","attribute float aAlpha;","varying vec2 vTextureCoord;","varying float vAlpha;","uniform mat3 uProjectionMatrix;","void main() {","  vTextureCoord = aTextureCoord;","  vAlpha = aAlpha;","  vec3 ndc = uProjectionMatrix * vec3( aVertex, 1.0 );","  gl_Position = vec4( ndc.xy, 0.0, 1.0 );","}"].join(`
`),["precision mediump float;","varying vec2 vTextureCoord;","varying float vAlpha;","uniform sampler2D uTexture;","void main() {","  vec4 color = texture2D( uTexture, vTextureCoord, -0.7 );","  color.a *= vAlpha;","  gl_FragColor = color;","}"].join(`
`),{attributes:["aVertex","aTextureCoord","aAlpha"],uniforms:["uTexture","uProjectionMatrix"]}),this.vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertexArray,e.DYNAMIC_DRAW)}activate(){this.shaderProgram.use(),this.currentSpriteSheet=null,this.vertexArrayIndex=0,this.drawCount=0}processDrawable(e){if(!e.sprite)return;assert&&assert(e.webglRenderer===Renderer.webglTexturedTriangles),this.currentSpriteSheet&&e.sprite.spriteSheet!==this.currentSpriteSheet&&this.draw(),this.currentSpriteSheet=e.sprite.spriteSheet;const t=e.vertexArray;for(;t.length+this.vertexArrayIndex>this.vertexArray.length;){const n=new Float32Array(this.vertexArray.length*2);n.set(this.vertexArray),this.vertexArray=n}this.vertexArray.set(t,this.vertexArrayIndex),this.vertexArrayIndex+=t.length}deactivate(){return this.currentSpriteSheet&&this.draw(),this.shaderProgram.unuse(),this.drawCount}draw(){assert&&assert(this.currentSpriteSheet);const e=this.gl;e.uniformMatrix3fv(this.shaderProgram.uniformLocations.uProjectionMatrix,!1,this.projectionMatrixArray),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray.length>this.lastArrayLength?e.bufferData(e.ARRAY_BUFFER,this.vertexArray,e.DYNAMIC_DRAW):e.bufferSubData(e.ARRAY_BUFFER,0,this.vertexArray.subarray(0,this.vertexArrayIndex));const t=5,n=Float32Array.BYTES_PER_ELEMENT,r=t*n;e.vertexAttribPointer(this.shaderProgram.attributeLocations.aVertex,2,e.FLOAT,!1,r,0*n),e.vertexAttribPointer(this.shaderProgram.attributeLocations.aTextureCoord,2,e.FLOAT,!1,r,2*n),e.vertexAttribPointer(this.shaderProgram.attributeLocations.aAlpha,1,e.FLOAT,!1,r,4*n),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.currentSpriteSheet.texture),e.uniform1i(this.shaderProgram.uniformLocations.uTexture,0),e.drawArrays(e.TRIANGLES,0,this.vertexArrayIndex/t),e.bindTexture(e.TEXTURE_2D,null),this.drawCount++,this.currentSpriteSheet=null,this.vertexArrayIndex=0}}Poolable.mixInto(WebGLBlock);const WebGLBlock$1=WebGLBlock;class Stitcher{initialize(e,t,n,r,s,a,l){assert&&assert(a&&l,"We are guaranteed at least one change interval"),assert&&assert(!t||t.previousDrawable===null,"End boundary of drawable linked list should link to null"),assert&&assert(!n||n.nextDrawable===null,"End boundary of drawable linked list should link to null"),sceneryLog&&sceneryLog.Stitch&&(sceneryLog.Stitch(`stitch ${e.toString()} first:${t?t.toString():"null"} last:${n?n.toString():"null"} oldFirst:${r?r.toString():"null"} oldLast:${s?s.toString():"null"}`),sceneryLog.push()),sceneryLog&&sceneryLog.StitchDrawables&&(sceneryLog.StitchDrawables("Before:"),sceneryLog.push(),Stitcher.debugDrawables(r,s,a,l,!1),sceneryLog.pop(),sceneryLog.StitchDrawables("After:"),sceneryLog.push(),Stitcher.debugDrawables(t,n,a,l,!0),sceneryLog.pop()),this.backbone=e,this.firstDrawable=t,this.lastDrawable=n,this.touchedBlocks=cleanArray(this.touchedBlocks),assertSlow&&(assertSlow(!this.initialized,"We should not be already initialized (clean should be called)"),this.initialized=!0,this.reindexed=!1,this.pendingAdditions=[],this.pendingRemovals=[],this.pendingMoves=[],this.createdBlocks=[],this.disposedBlocks=[],this.intervalsNotified=[],this.boundariesRecorded=!1,this.previousBlocks=e.blocks.slice(0))}clean(){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch("clean"),sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch("-----------------------------------"),assertSlow&&(this.auditStitch(),this.initialized=!1),this.backbone=null,this.firstDrawable=null,this.lastDrawable=null,sceneryLog&&sceneryLog.Stitch&&sceneryLog.pop()}recordBackboneBoundaries(){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`recording backbone boundaries: ${this.firstDrawable?this.firstDrawable.toString():"null"} to ${this.lastDrawable?this.lastDrawable.toString():"null"}`),this.backbone.previousFirstDrawable=this.firstDrawable,this.backbone.previousLastDrawable=this.lastDrawable,assertSlow&&(this.boundariesRecorded=!0)}notePendingAddition(e,t){assert&&assert(e.renderer===t.renderer),sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`pending add: ${e.toString()} to ${t.toString()}`),sceneryLog&&sceneryLog.Stitch&&sceneryLog.push(),e.notePendingAddition(this.backbone.display,t,this.backbone),assertSlow&&this.pendingAdditions.push({drawable:e,block:t}),sceneryLog&&sceneryLog.Stitch&&sceneryLog.pop()}notePendingMove(e,t){assert&&assert(e.renderer===t.renderer),sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`pending move: ${e.toString()} to ${t.toString()}`),sceneryLog&&sceneryLog.Stitch&&sceneryLog.push(),e.notePendingMove(this.backbone.display,t),assertSlow&&this.pendingMoves.push({drawable:e,block:t}),sceneryLog&&sceneryLog.Stitch&&sceneryLog.pop()}notePendingRemoval(e){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`pending remove: ${e.toString()}`),sceneryLog&&sceneryLog.Stitch&&sceneryLog.push(),e.notePendingRemoval(this.backbone.display),assertSlow&&this.pendingRemovals.push({drawable:e}),sceneryLog&&sceneryLog.Stitch&&sceneryLog.pop()}markBlockForDisposal(e){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`block for disposal: ${e.toString()}`),sceneryLog&&sceneryLog.Stitch&&sceneryLog.push(),e.domElement.parentNode===this.backbone.domElement&&this.backbone.domElement.removeChild(e.domElement),e.markForDisposal(this.backbone.display),assertSlow&&this.disposedBlocks.push({block:e}),sceneryLog&&sceneryLog.Stitch&&sceneryLog.pop()}removeAllBlocks(){for(sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`marking all blocks for disposal (count ${this.backbone.blocks.length})`),sceneryLog&&sceneryLog.Stitch&&sceneryLog.push();this.backbone.blocks.length;){const e=this.backbone.blocks[0];this.removeBlock(e),this.markBlockForDisposal(e)}sceneryLog&&sceneryLog.Stitch&&sceneryLog.pop()}notifyInterval(e,t,n){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`notify interval: ${e.toString()} ${t.toString()} to ${n.toString()}`),sceneryLog&&sceneryLog.Stitch&&sceneryLog.push(),e.notifyInterval(t,n),this.backbone.markDirtyDrawable(e),assertSlow&&this.intervalsNotified.push({block:e,firstDrawable:t,lastDrawable:n}),sceneryLog&&sceneryLog.Stitch&&sceneryLog.pop()}markBeforeBlock(e,t){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`marking block first drawable ${e.toString()} with ${t.toString()}`),e.pendingFirstDrawable=t,this.touchedBlocks.push(e)}markAfterBlock(e,t){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`marking block last drawable ${e.toString()} with ${t.toString()}`),e.pendingLastDrawable=t,this.touchedBlocks.push(e)}updateBlockIntervals(){for(;this.touchedBlocks.length;){const e=this.touchedBlocks.pop();e.used?(sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`update interval: ${e.toString()} ${e.pendingFirstDrawable.toString()} to ${e.pendingLastDrawable.toString()}`),e.updateInterval(),this.backbone.markDirtyDrawable(e),assertSlow&&this.intervalsNotified.push({block:e,firstDrawable:e.pendingFirstDrawable,lastDrawable:e.pendingLastDrawable})):sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`skipping update interval: ${e.toString()}, unused`)}}createBlock(e,t){const n=this.backbone;let r;if(Renderer.isCanvas(e))r=CanvasBlock$1.createFromPool(n.display,e,n.transformRootInstance,n.backboneInstance);else if(Renderer.isSVG(e))r=SVGBlock.createFromPool(n.display,e,n.transformRootInstance,n.backboneInstance);else if(Renderer.isDOM(e))r=DOMBlock$1.createFromPool(n.display,t);else if(Renderer.isWebGL(e))r=WebGLBlock$1.createFromPool(n.display,e,n.transformRootInstance,n.backboneInstance);else throw new Error(`unsupported renderer for createBlock: ${e}`);return sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`created block: ${r.toString()} with renderer: ${e} for drawable: ${t.toString()}`),r.setBlockBackbone(n),n.domElement.appendChild(r.domElement),n.isDisplayRoot&&r.domElement.setAttribute("aria-hidden",!0),n.markDirtyDrawable(r),assertSlow&&this.createdBlocks.push({block:r,renderer:e,drawable:t}),r}appendBlock(e){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`appending block: ${e.toString()}`),this.backbone.blocks.push(e),assertSlow&&(this.reindexed=!1)}removeBlock(e){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`removing block: ${e.toString()}`);const t=_.indexOf(this.backbone.blocks,e);assert&&assert(t>=0,`Cannot remove block, not attached: ${e.toString()}`),this.backbone.blocks.splice(t,1),assertSlow&&(this.reindexed=!1)}useNoBlocks(){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch("using no blocks"),cleanArray(this.backbone.blocks)}reindex(){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch("reindexing blocks"),this.backbone.reindexBlocks(),assertSlow&&(this.reindexed=!0)}auditStitch(){if(assertSlow){const e=this.backbone.blocks,t=this.previousBlocks;if(assertSlow(this.initialized,"We seem to have finished a stitch without proper initialization"),assertSlow(this.boundariesRecorded,"Our stitch API requires recordBackboneBoundaries() to be called before it is finished."),assertSlow(this.reindexed||e.length===0||t.length===e.length&&_.every(_.zip(t,e),n=>n[0]===n[1]),"Did not reindex on a block change where we are left with blocks"),_.each(this.createdBlocks,n=>{assertSlow(_.some(this.intervalsNotified,r=>n.block===r.block),`Created block does not seem to have an interval notified: ${n.block.toString()}`)}),_.each(this.disposedBlocks,n=>{assertSlow(!_.some(this.intervalsNotified,r=>n.block===r.block),`Removed block seems to have an interval notified: ${n.block.toString()}`)}),_.each(this.disposedBlocks,n=>{const r=n.block;_.each(Drawable.oldListToArray(r.firstDrawable,r.lastDrawable),s=>{assertSlow(_.some(this.pendingRemovals,a=>a.drawable===s)||_.some(this.pendingMoves,a=>a.drawable===s),`Drawable ${s.toString()} originally listed for disposed block ${r.toString()} does not seem to be marked for pending removal or move!`)})}),_.each(this.createdBlocks,n=>{const r=n.block;_.each(Drawable.listToArray(r.pendingFirstDrawable,r.pendingLastDrawable),s=>{assertSlow(_.some(this.pendingAdditions,a=>a.drawable===s&&a.block===r)||_.some(this.pendingMoves,a=>a.drawable===s&&a.block===r),`Drawable ${s.toString()} now listed for created block ${r.toString()} does not seem to be marked for pending addition or move!`)})}),_.each(this.disposedBlocks,n=>{const r=_.indexOf(e,n.block);assertSlow(r<0,`Disposed block ${n.block.toString()} still present at index ${r}`)}),_.each(this.createdBlocks,n=>{const r=_.indexOf(e,n.block);assertSlow(r>=0,`Created block ${n.block.toString()} is not in the blocks array`)}),_.each(e,n=>{assertSlow(n.used,"All current blocks should be marked as used")}),assertSlow(e.length-t.length===this.createdBlocks.length-this.disposedBlocks.length,`The count of unmodified blocks should be constant (equal differences):
created: ${_.map(this.createdBlocks,n=>n.block.id).join(",")}
disposed: ${_.map(this.disposedBlocks,n=>n.block.id).join(",")}
before: ${_.map(t,n=>n.id).join(",")}
after: ${_.map(e,n=>n.id).join(",")}`),assertSlow(this.touchedBlocks.length===0,"If we marked any blocks for changes, we should have called updateBlockIntervals"),e.length){assertSlow(this.backbone.previousFirstDrawable!==null&&this.backbone.previousLastDrawable!==null,"If we are left with at least one block, we must be tracking at least one drawable"),assertSlow(e[0].pendingFirstDrawable===this.backbone.previousFirstDrawable,"Our first drawable should match the first drawable of our first block"),assertSlow(e[e.length-1].pendingLastDrawable===this.backbone.previousLastDrawable,"Our last drawable should match the last drawable of our last block");for(let n=0;n<e.length-1;n++)assertSlow(e[n].pendingLastDrawable.nextDrawable===e[n+1].pendingFirstDrawable&&e[n].pendingLastDrawable===e[n+1].pendingFirstDrawable.previousDrawable,"Consecutive blocks should have boundary drawables that are also consecutive in the linked list")}else assertSlow(this.backbone.previousFirstDrawable===null&&this.backbone.previousLastDrawable===null,"If we are left with no blocks, it must mean we are tracking precisely zero drawables")}}static debugIntervals(e){if(sceneryLog&&sceneryLog.Stitch)for(let t=e;t!==null;t=t.nextChangeInterval)sceneryLog.Stitch(`  interval: ${t.isEmpty()?"(empty) ":""}${t.drawableBefore?t.drawableBefore.toString():"-"} to ${t.drawableAfter?t.drawableAfter.toString():"-"}`)}static debugDrawables(e,t,n,r,s){if(sceneryLog&&sceneryLog.StitchDrawables){if(e===null){sceneryLog.StitchDrawables("nothing","color: #666;");return}let a=n.drawableBefore===null,l=n;for(let d=e;;d=s?d.nextDrawable:d.oldNextDrawable){a&&d===l.drawableAfter&&(a=!1,l=l.nextChangeInterval);const c=`${d.renderer} ${!s&&d.parentDrawable?d.parentDrawable.toString():""} ${d.toDetailedString()}`;if(sceneryLog.StitchDrawables(c,a?s?"color: #0a0;":"color: #a00;":"color: #666"),!a&&l&&l.drawableBefore===d&&(a=!0),d===t)break}}}}scenery.register("Stitcher",Stitcher);function hasGapBetweenDrawables(o,e){return o.renderer!==e.renderer||Renderer.isDOM(o.renderer)||Renderer.isDOM(e.renderer)}function isOpenBefore(o){return o.previousDrawable!==null&&!hasGapBetweenDrawables(o.previousDrawable,o)}function isOpenAfter(o){return o.nextDrawable!==null&&!hasGapBetweenDrawables(o,o.nextDrawable)}function intervalHasNewInternalDrawables(o,e,t){return o.drawableBefore?o.drawableBefore.nextDrawable!==o.drawableAfter:o.drawableAfter?o.drawableAfter.previousDrawable!==o.drawableBefore:e!==null}function intervalHasOldInternalDrawables(o,e,t){return o.drawableBefore?o.drawableBefore.oldNextDrawable!==o.drawableAfter:o.drawableAfter?o.drawableAfter.oldPreviousDrawable!==o.drawableBefore:e!==null}function intervalHasOldInternalBlocks(o,e,t){const n=o.drawableBefore?o.drawableBefore.parentDrawable:null,r=o.drawableAfter?o.drawableAfter.parentDrawable:null;return n&&r&&n===r?!1:n?n.nextBlock!==r:r?r.previousBlock!==n:e!==null}function getLastCompatibleExternalDrawable(o){const e=o.drawableAfter;if(e){const t=e.renderer,n=o.nextChangeInterval?o.nextChangeInterval.drawableBefore.nextDrawable:null;let r=e;for(;;){const s=r.nextDrawable;if(s!==n&&s.renderer===t)r=s;else break}return r}else return null}class GreedyStitcher extends Stitcher{stitch(e,t,n,r,s,a,l){this.initialize(e,t,n,r,s,a,l),this.blockOrderChanged=!1,this.reusableBlocks=cleanArray(this.reusableBlocks),this.blockWasAdded=!1;let d;if(this.recordBackboneBoundaries(),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.GreedyStitcher("phase 1: old linked list"),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.push(),e.blocks.length){const c=e.blocks[0];for(e.blocks[e.blocks.length-1],d=a;d!==null;d=d.nextChangeInterval){if(assert&&assert(!d.isEmpty(),"We now guarantee that the intervals are non-empty"),intervalHasOldInternalDrawables(d,r)){const y=d.drawableBefore?d.drawableBefore.oldNextDrawable:r,m=d.drawableAfter?d.drawableAfter.oldPreviousDrawable:s;for(let O=y;this.notePendingRemoval(O),O!==m;O=O.oldNextDrawable);}if(intervalHasOldInternalBlocks(d,c)){const y=d.drawableBefore===null?e.blocks[0]:d.drawableBefore.parentDrawable.nextBlock,m=d.drawableAfter===null?e.blocks[e.blocks.length-1]:d.drawableAfter.parentDrawable.previousBlock;for(let O=y;this.unuseBlock(O),O!==m;O=O.nextBlock);}}}if(sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.pop(),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.GreedyStitcher("phase 2: new linked list"),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.push(),t)for(d=a;d!==null;d=d.nextChangeInterval)this.processInterval(e,d,t,n);sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.pop(),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.GreedyStitcher("phase 3: cleanup"),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.push(),this.removeUnusedBlocks(),this.updateBlockIntervals(),t===null?this.useNoBlocks():this.blockOrderChanged&&(this.processBlockLinkedList(e,t.pendingParentDrawable,n.pendingParentDrawable),this.reindex()),this.clean(),cleanArray(this.reusableBlocks),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.pop()}processInterval(e,t,n,r){if(assert&&assert(t instanceof ChangeInterval),assert&&assert(n instanceof Drawable,"We assume we have a non-null remaining section"),assert&&assert(r instanceof Drawable,"We assume we have a non-null remaining section"),assert&&assert(!t.isEmpty(),"We now guarantee that the intervals are non-empty"),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`interval: ${t.drawableBefore?t.drawableBefore.toString():"null"} to ${t.drawableAfter?t.drawableAfter.toString():"null"}`),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push(),intervalHasNewInternalDrawables(t,n)){let s=t.drawableBefore?t.drawableBefore.nextDrawable:n,a=null,l=null,d=!0;for(;;){const c=s.nextDrawable,y=c===t.drawableAfter;if(assert&&assert(c!==null||y,"If our nextDrawable is null, isLast must be true"),a||(a=s),l===null&&s.parentDrawable&&!s.parentDrawable.used&&s.backbone===e&&s.parentDrawable.parentDrawable===e&&(l=s.parentDrawable,sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`matching at ${s.toString()} with ${l}`)),(y||hasGapBetweenDrawables(s,c))&&(d&&this.processEdgeCases(t,isOpenBefore(a),isOpenAfter(s)),this.processSubBlock(t,a,s,l,d,y),a=null,l=null,d=!1),y)break;s=c}}else{if(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("no current internal drawables in interval"),t.drawableBefore&&t.drawableAfter){assert&&assert(t.drawableBefore.nextDrawable===t.drawableAfter);const s=!hasGapBetweenDrawables(t.drawableBefore,t.drawableAfter);this.processEdgeCases(t,s,s)}t.drawableBefore&&!isOpenAfter(t.drawableBefore)?(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("closed-after collapsed link:"),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push(),this.linkAfterDrawable(t.drawableBefore),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop()):t.drawableAfter&&!isOpenBefore(t.drawableAfter)&&(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("closed-before collapsed link:"),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push(),this.linkBeforeDrawable(t.drawableAfter),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop())}sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop()}processSubBlock(e,t,n,r,s,a){sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`sub-block: ${t.toString()} to ${n.toString()} ${r?`with matched: ${r.toString()}`:"with no match"}`),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push();const l=isOpenBefore(t),d=isOpenAfter(n);assert&&assert(!l||s,"openBefore implies isFirst"),assert&&assert(!d||a,"openAfter implies isLast"),assert&&assert(!l||!d||t.previousDrawable.pendingParentDrawable===n.nextDrawable.pendingParentDrawable,"If we would use both the before and after blocks, make sure any gluing "),l&&(r=t.previousDrawable.pendingParentDrawable,sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`combining into before block: ${r.toString()}`)),d&&(r=n.nextDrawable.pendingParentDrawable,sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`combining into after block: ${r.toString()}`)),r=this.ensureUsedBlock(r,t);for(let c=t;this.notePendingAddition(c,r),c!==n;c=c.nextDrawable);l||(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("closed-before link:"),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push(),this.linkBeforeDrawable(t),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop()),a&&!d&&(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("last closed-after link:"),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push(),this.linkAfterDrawable(n),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop()),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop()}processEdgeCases(e,t,n){if(e.drawableBefore!==null&&e.drawableAfter!==null){const r=e.drawableBefore.pendingParentDrawable,s=e.drawableAfter.pendingParentDrawable,a=e.nextChangeInterval&&e.nextChangeInterval.drawableAfter?e.nextChangeInterval.drawableAfter.pendingParentDrawable:null;r===s&&(this.blockWasAdded=!0),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`edge case: ${t?"open-before ":""}${n?"open-after ":""}${r.toString()} to ${s.toString()}`),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push();let l;t&&n?(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`glue using ${r.toString()}`),l=r):this.blockWasAdded||r===s?(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("split with fresh block"),l=this.createBlock(e.drawableAfter.renderer,e.drawableAfter),this.blockOrderChanged=!0):(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`split with same afterBlock ${s.toString()}`),l=s),s===l?(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("no externals change here (blockWasAdded => true)"),this.blockWasAdded=!0):(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("moving externals"),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push(),this.changeExternals(e,l),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop()),a!==s&&(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("end of afterBlock stretch"),this.blockWasAdded||(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`unusing ${s.toString()}`),this.unuseBlock(s)),this.blockWasAdded=!1),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop()}}changeExternals(e,t){const n=getLastCompatibleExternalDrawable(e);this.notePendingMoves(t,e.drawableAfter,n),(!e.nextChangeInterval||e.nextChangeInterval.drawableBefore!==n)&&this.linkAfterDrawable(n)}notePendingMoves(e,t,n){for(let r=t;assert&&assert(!r.pendingAddition&&!r.pendingRemoval,"Moved drawables should be thought of as unchanged, and thus have nothing pending yet"),this.notePendingMove(r,e),r!==n;r=r.nextDrawable);}ensureUsedBlock(e,t){return e?(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`using existing block: ${e.toString()}`),e.used||this.useBlock(e)):(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("searching for block"),e=this.getBlockForRenderer(t.renderer,t)),e}getBlockForRenderer(e,t){let n;if(!Renderer.isDOM(e))for(let r=this.reusableBlocks.length-1;r>=0;r--){const s=this.reusableBlocks[r];if(assert&&assert(!s.used),s.renderer===e){this.useBlockAtIndex(s,r),n=s;break}}return n||(n=this.createBlock(e,t)),this.blockOrderChanged=!0,n}unuseBlock(e){e.used?(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`unusing block: ${e.toString()}`),e.used=!1,this.reusableBlocks.push(e)):sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`not using already-unused block: ${e.toString()}`)}useBlock(e){this.useBlockAtIndex(e,_.indexOf(this.reusableBlocks,e))}useBlockAtIndex(e,t){sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`using reusable block: ${e.toString()} with renderer: ${e.renderer}`),assert&&assert(t>=0&&this.reusableBlocks[t]===e,`bad index for useBlockAtIndex: ${t}`),assert&&assert(!e.used,"Should be called on an unused (reusable) block"),this.reusableBlocks.splice(t,1),e.used=!0}removeUnusedBlocks(){for(sceneryLog&&sceneryLog.GreedyStitcher&&this.reusableBlocks.length&&sceneryLog.GreedyStitcher("removeUnusedBlocks"),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.push();this.reusableBlocks.length;){const e=this.reusableBlocks.pop();this.markBlockForDisposal(e),this.blockOrderChanged=!0}sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.pop()}linkBeforeDrawable(e){sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`link before ${e.toString()}`);const t=e.previousDrawable;this.linkBlocks(t?t.pendingParentDrawable:null,e.pendingParentDrawable,t,e)}linkAfterDrawable(e){sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`link after ${e.toString()}`);const t=e.nextDrawable;this.linkBlocks(e.pendingParentDrawable,t?t.pendingParentDrawable:null,e,t)}linkBlocks(e,t,n,r){sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.GreedyStitcher(`linking blocks: ${e?`${e.toString()} (${n.toString()})`:"null"} to ${t?`${t.toString()} (${r.toString()})`:"null"}`),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.push(),assert&&assert(e===null&&n===null||e instanceof Block$1&&n instanceof Drawable),assert&&assert(t===null&&r===null||t instanceof Block$1&&r instanceof Drawable),e&&(e.nextBlock!==t&&(this.blockOrderChanged=!0,e.nextBlock&&(e.nextBlock.previousBlock=null),e.nextBlock=t),this.markAfterBlock(e,n)),t&&(t.previousBlock!==e&&(this.blockOrderChanged=!0,t.previousBlock&&(t.previousBlock.nextBlock=null),t.previousBlock=e),this.markBeforeBlock(t,r)),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.pop()}processBlockLinkedList(e,t,n){for(;e.blocks.length;)e.blocks.pop();if(sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.GreedyStitcher(`processBlockLinkedList: ${t.toString()} to ${n.toString()}`),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.push(),t)for(let r=t;sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.GreedyStitcher(r.toString()),e.blocks.push(r),r!==n;r=r.nextBlock);sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.pop()}}scenery.register("GreedyStitcher",GreedyStitcher);class RebuildStitcher extends Stitcher{stitch(e,t,n,r,s,a,l){this.initialize(e,t,n,r,s,a,l);for(let m=e.previousFirstDrawable;m!==null&&(this.notePendingRemoval(m),m!==e.previousLastDrawable);m=m.oldNextDrawable);this.recordBackboneBoundaries(),this.removeAllBlocks();let d=null,c=0,y=null;for(let m=t;m!==null&&((!d||m.renderer!==c)&&(d&&this.notifyInterval(d,y,m.previousDrawable),c=m.renderer,d=this.createBlock(c,m),Renderer.isDOM(c)&&(c=0),this.appendBlock(d),y=m),this.notePendingAddition(m,d),m!==n);m=m.nextDrawable);d&&this.notifyInterval(d,y,n),this.reindex(),this.clean()}}scenery.register("RebuildStitcher",RebuildStitcher);class BackboneDrawable extends Drawable{constructor(e,t,n,r,s){super(),this.initialize(e,t,n,r,s)}initialize(e,t,n,r,s){if(super.initialize(r),this.display=e,this.backboneInstance=t,this.transformRootInstance=n,this.filterRootAncestorInstance=t.parent?t.parent.getFilterRootInstance():t,this.transformRootAncestorInstance=t.parent?t.parent.getTransformRootInstance():t,this.willApplyTransform=this.transformRootAncestorInstance!==this.transformRootInstance,this.willApplyFilters=this.filterRootAncestorInstance!==this.backboneInstance,this.transformListener=this.transformListener||this.markTransformDirty.bind(this),this.willApplyTransform&&(this.backboneInstance.relativeTransform.addListener(this.transformListener),this.backboneInstance.relativeTransform.addPrecompute()),this.backboneVisibilityListener=this.backboneVisibilityListener||this.updateBackboneVisibility.bind(this),this.backboneInstance.relativeVisibleEmitter.addListener(this.backboneVisibilityListener),this.updateBackboneVisibility(),this.visibilityDirty=!0,this.renderer=r,this.domElement=s?e.domElement:BackboneDrawable.createDivBackbone(),this.isDisplayRoot=s,this.dirtyDrawables=cleanArray(this.dirtyDrawables),Utils.prepareForTransform(this.domElement),this.watchedFilterNodes=cleanArray(this.watchedFilterNodes),this.filterDirty=!0,this.clipDirty=!0,this.filterDirtyListener=this.filterDirtyListener||this.onFilterDirty.bind(this),this.clipDirtyListener=this.clipDirtyListener||this.onClipDirty.bind(this),this.willApplyFilters){assert&&assert(this.filterRootAncestorInstance.trail.nodes.length<this.backboneInstance.trail.nodes.length,"Our backboneInstance should be deeper if we are applying filters");for(let a=this.backboneInstance;a!==this.filterRootAncestorInstance;a=a.parent){const l=a.node;this.watchedFilterNodes.push(l),l.filterChangeEmitter.addListener(this.filterDirtyListener),l.clipAreaProperty.lazyLink(this.clipDirtyListener)}}this.lastZIndex=0,this.blocks=this.blocks||[],this.previousFirstDrawable=null,this.previousLastDrawable=null,this.removedDrawables=!1,this.stitcher=this.stitcher||new GreedyStitcher,sceneryLog&&sceneryLog.BackboneDrawable&&sceneryLog.BackboneDrawable(`initialized ${this.toString()}`)}dispose(){for(sceneryLog&&sceneryLog.BackboneDrawable&&sceneryLog.BackboneDrawable(`dispose ${this.toString()}`),sceneryLog&&sceneryLog.BackboneDrawable&&sceneryLog.push();this.watchedFilterNodes.length;){const e=this.watchedFilterNodes.pop();e.filterChangeEmitter.removeListener(this.filterDirtyListener),e.clipAreaProperty.unlink(this.clipDirtyListener)}if(this.backboneInstance.relativeVisibleEmitter.removeListener(this.backboneVisibilityListener),!this.removedDrawables)for(let e=this.previousFirstDrawable;e!==null&&(e.parentDrawable.removeDrawable(e),e!==this.previousLastDrawable);e=e.nextDrawable);this.markBlocksForDisposal(),this.willApplyTransform&&(this.backboneInstance.relativeTransform.removeListener(this.transformListener),this.backboneInstance.relativeTransform.removePrecompute()),this.backboneInstance=null,this.transformRootInstance=null,this.filterRootAncestorInstance=null,this.transformRootAncestorInstance=null,cleanArray(this.dirtyDrawables),cleanArray(this.watchedFilterNodes),this.previousFirstDrawable=null,this.previousLastDrawable=null,super.dispose(),sceneryLog&&sceneryLog.BackboneDrawable&&sceneryLog.pop()}markBlocksForDisposal(){for(;this.blocks.length;){const e=this.blocks.pop();sceneryLog&&sceneryLog.BackboneDrawable&&sceneryLog.BackboneDrawable(`${this.toString()} removing block: ${e.toString()}`),e.domElement.parentNode===this.domElement&&this.domElement.removeChild(e.domElement),e.markForDisposal(this.display)}}updateBackboneVisibility(){this.visible=this.backboneInstance.relativeVisible,this.visibilityDirty||(this.visibilityDirty=!0,this.markDirty())}markForDisposal(e){for(let t=this.previousFirstDrawable;t!==null&&(t.notePendingRemoval(this.display),t!==this.previousLastDrawable);t=t.oldNextDrawable);this.removedDrawables=!0,super.markForDisposal(e)}markDirtyDrawable(e){assert&&this.display.ensureNotPainting(),this.dirtyDrawables.push(e),this.markDirty()}markTransformDirty(){assert&&assert(this.willApplyTransform,"Sanity check for willApplyTransform"),Utils.applyPreparedTransform(this.backboneInstance.relativeTransform.matrix,this.domElement)}onFilterDirty(){this.filterDirty||(this.filterDirty=!0,this.markDirty())}onClipDirty(){this.clipDirty||(this.clipDirty=!0,this.markDirty())}update(){if(!super.update())return!1;for(;this.dirtyDrawables.length;)this.dirtyDrawables.pop().update();if(this.filterDirty){this.filterDirty=!1;let e="";const t=this.watchedFilterNodes.length;for(let n=0;n<t;n++){const r=this.watchedFilterNodes[n],s=r.getEffectiveOpacity();for(let a=0;a<r._filters.length;a++)e+=`${e?" ":""}${r._filters[a].getCSSFilterString()}`;s!==1&&(e+=`${e?" ":""}opacity(${toSVGNumber(s)})`)}this.domElement.style.filter=e}return this.visibilityDirty&&(this.visibilityDirty=!1,this.domElement.style.display=this.visible?"":"none"),this.clipDirty&&(this.clipDirty=!1),!0}getFilterVisibility(){const e=this.watchedFilterNodes.length;for(let t=0;t<e;t++)if(!this.watchedFilterNodes[t].isVisible())return!1;return!0}getFilterClip(){return""}reindexBlocks(){let e=0;for(let t=0;t<this.blocks.length;t++){const n=this.blocks[t];if(n.zIndex<=e){const r=t+1<this.blocks.length&&this.blocks[t+1].zIndex-1>e?Math.ceil((e+this.blocks[t+1].zIndex)/2):e+20;n.domElement.style.zIndex=n.zIndex=r}e=n.zIndex,assert&&(assert(this.blocks[t].zIndex%1===0,"z-indices should be integers"),assert(this.blocks[t].zIndex>0,"z-indices should be greater than zero for our needs (see spec)"),t>0&&assert(this.blocks[t-1].zIndex<this.blocks[t].zIndex,"z-indices should be strictly increasing"))}this.lastZIndex=e+1}stitch(e,t,n,r){if(n===null||r===null){assert&&assert(n===null),assert&&assert(r===null);return}assert&&assert(r.nextChangeInterval===null,"This allows us to have less checks in the loop"),sceneryLog&&sceneryLog.Stitch&&(sceneryLog.Stitch(`Stitch intervals before constricting: ${this.toString()}`),sceneryLog.push(),Stitcher.debugIntervals(n),sceneryLog.pop());let s=null,a=n,l=!1;for(;a;)l=a.constrict()||l,a.isEmpty()?(assert&&assert(l),s&&(s.nextChangeInterval=a.nextChangeInterval)):(s||(n=a),s=a),a=a.nextChangeInterval;if(s){if(r=s,r.nextChangeInterval=null,sceneryLog&&sceneryLog.Stitch&&l&&(sceneryLog.Stitch(`Stitch intervals after constricting: ${this.toString()}`),sceneryLog.push(),Stitcher.debugIntervals(n),sceneryLog.pop()),sceneryLog&&scenery.isLoggingPerformance()){this.display.perfStitchCount++;let d=n;for(;d;)this.display.perfIntervalCount++,this.display.perfDrawableOldIntervalCount+=d.getOldInternalDrawableCount(this.previousFirstDrawable,this.previousLastDrawable),this.display.perfDrawableNewIntervalCount+=d.getNewInternalDrawableCount(e,t),d=d.nextChangeInterval}this.stitcher.stitch(this,e,t,this.previousFirstDrawable,this.previousLastDrawable,n,r)}}audit(e,t,n){if(assertSlow){super.audit(e,t,n),assertSlow&&assertSlow(this.backboneInstance.isBackbone,"We should reference an instance that requires a backbone"),assertSlow&&assertSlow(this.transformRootInstance.isTransformed,"Transform root should be transformed");for(let r=0;r<this.blocks.length;r++)this.blocks[r].audit(e,t,n)}}static createDivBackbone(){const e=document.createElement("div");return e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.width="0",e.style.height="0",e}static repurposeBackboneContainer(e){return(e.style.position!=="relative"||e.style.position!=="absolute")&&(e.style.position="relative"),e.style.left="0",e.style.top="0",e}}scenery.register("BackboneDrawable",BackboneDrawable);Poolable.mixInto(BackboneDrawable);const BackboneDrawable$1=BackboneDrawable;class ShapeBasedOverlay{constructor(e,t,n){this.display=e,this.rootNode=t;const r=document.createElementNS(svgns,"svg");r.style.position="absolute",r.setAttribute("class",n),r.style.top="0",r.style.left="0",r.style["pointer-events"]="none",this.svg=r;function s(a,l){r.setAttribute("width",""+a),r.setAttribute("height",""+l),r.style.clip=`rect(0px,${a}px,${l}px,0px)`}e.sizeProperty.link(a=>{s(a.width,a.height)}),this.domElement=r}addShape(e,t,n){const r=document.createElementNS(svgns,"path");let s=e.getSVGPath();s||(s="M0 0"),s?r.setAttribute("d",s):r.hasAttribute("d")&&r.removeAttribute("d"),r.setAttribute("style",`fill: none; stroke: ${t}; stroke-dasharray: 5, 3; stroke-dashoffset: ${n?5:0}; stroke-width: 3;`),this.svg.appendChild(r)}update(){for(;this.svg.childNodes.length;)this.svg.removeChild(this.svg.childNodes[this.svg.childNodes.length-1]);this.addShapes()}dispose(){}}scenery.register("ShapeBasedOverlay",ShapeBasedOverlay);class CanvasNodeBoundsOverlay extends ShapeBasedOverlay{constructor(e,t){super(e,t,"canvasNodeBoundsOverlay")}addShapes(){new Trail(this.rootNode).eachTrailUnder(e=>{const t=e.lastNode();if(!t.isVisible())return!0;if(t instanceof CanvasNode&&e.isVisible()){const n=e.getTransform();this.addShape(n.transformShape(Shape$1.bounds(t.selfBounds)),"rgba(0,255,0,0.8)",!0)}return!1})}}scenery.register("CanvasNodeBoundsOverlay",CanvasNodeBoundsOverlay);class FittedBlockBoundsOverlay extends ShapeBasedOverlay{constructor(e,t){super(e,t,"canvasNodeBoundsOverlay")}addShapes(){const e=this;function t(s,a){s.willApplyTransform&&(a=a.timesMatrix(s.backboneInstance.relativeTransform.matrix)),s.blocks.forEach(l=>{n(l,a)})}function n(s,a){if(s instanceof FittedBlock$1&&!s.fitBounds.isEmpty()&&e.addShape(Shape$1.bounds(s.fitBounds).transformed(a),"rgba(255,0,0,0.8)",!0),s.firstDrawable&&s.lastDrawable){for(let l=s.firstDrawable;l!==s.lastDrawable;l=l.nextDrawable)r(l,a);r(s.lastDrawable,a)}}function r(s,a){s instanceof BackboneDrawable$1&&t(s,a)}t(this.display.rootBackbone,Matrix3.IDENTITY)}}scenery.register("FittedBlockBoundsOverlay",FittedBlockBoundsOverlay);let outerHighlightColor=HighlightPath$1.OUTER_FOCUS_COLOR,innerHighlightColor=HighlightPath$1.INNER_FOCUS_COLOR,innerGroupHighlightColor=HighlightPath$1.INNER_LIGHT_GROUP_FOCUS_COLOR,outerGroupHighlightColor=HighlightPath$1.OUTER_LIGHT_GROUP_FOCUS_COLOR;class HighlightOverlay{constructor(e,t,n){this.trail=null,this.node=null,this.activeHighlight=null,this.mode=null,this.groupMode=null,this.groupHighlightNode=null,this.transformTracker=null,this.groupTransformTracker=null,this.nodeModeHighlight=null,this.nodeModeHighlightLayered=!1,this.transformDirty=!0,this.highlightNode=new Node$2,this.readingBlockHighlightNode=new Node$2,this.addedReadingBlockHighlight=null,this.activeReadingBlockNode=null,this.readingBlockTrail=null,this.readingBlockTransformDirty=!0,this.readingBlockTransformTracker=null;const r=optionize()({pdomFocusHighlightsVisibleProperty:new BooleanProperty(!0),interactiveHighlightsVisibleProperty:new BooleanProperty(!1),readingBlockHighlightsVisibleProperty:new BooleanProperty(!1)},n);this.display=e,this.focusRootNode=t,this.focusRootNode.addChild(this.highlightNode),this.focusRootNode.addChild(this.readingBlockHighlightNode),this.pdomFocusHighlightsVisibleProperty=r.pdomFocusHighlightsVisibleProperty,this.interactiveHighlightsVisibleProperty=r.interactiveHighlightsVisibleProperty,this.readingBlockHighlightsVisibleProperty=r.readingBlockHighlightsVisibleProperty,this.focusDisplay=new Display(this.focusRootNode,{allowWebGL:e.isWebGLAllowed(),allowCSSHacks:!1,accessibility:!1,interactive:!1,allowLayerFitting:!0}),this.domElement=this.focusDisplay.domElement,this.domElement.style.pointerEvents="none",this.shapeFocusHighlightPath=new HighlightPath$1(null),this.boundsFocusHighlightPath=new HighlightFromNode$1(null,{useLocalBounds:!0}),this.highlightNode.addChild(this.shapeFocusHighlightPath),this.highlightNode.addChild(this.boundsFocusHighlightPath),this.groupFocusHighlightPath=new HighlightFromNode$1(null,{useLocalBounds:!0,useGroupDilation:!0,outerLineWidth:HighlightPath$1.GROUP_OUTER_LINE_WIDTH,innerLineWidth:HighlightPath$1.GROUP_INNER_LINE_WIDTH,innerStroke:HighlightPath$1.OUTER_FOCUS_COLOR}),this.groupFocusHighlightParent=new Node$2({children:[this.groupFocusHighlightPath]}),this.focusRootNode.addChild(this.groupFocusHighlightParent),this.readingBlockHighlightPath=new ActivatedReadingBlockHighlight$1(null),this.readingBlockHighlightNode.addChild(this.readingBlockHighlightPath),this.boundsListener=this.onBoundsChange.bind(this),this.transformListener=this.onTransformChange.bind(this),this.domFocusListener=this.onFocusChange.bind(this),this.readingBlockTransformListener=this.onReadingBlockTransformChange.bind(this),this.focusHighlightListener=this.onFocusHighlightChange.bind(this),this.interactiveHighlightListener=this.onInteractiveHighlightChange.bind(this),this.focusHighlightsVisibleListener=this.onFocusHighlightsVisibleChange.bind(this),this.voicingHighlightsVisibleListener=this.onVoicingHighlightsVisibleChange.bind(this),this.pointerFocusListener=this.onPointerFocusChange.bind(this),this.lockedPointerFocusListener=this.onLockedPointerFocusChange.bind(this),this.readingBlockFocusListener=this.onReadingBlockFocusChange.bind(this),this.readingBlockHighlightChangeListener=this.onReadingBlockHighlightChange.bind(this),FocusManager.pdomFocusProperty.link(this.domFocusListener),e.focusManager.pointerFocusProperty.link(this.pointerFocusListener),e.focusManager.readingBlockFocusProperty.link(this.readingBlockFocusListener),e.focusManager.lockedPointerFocusProperty.link(this.lockedPointerFocusListener),this.pdomFocusHighlightsVisibleProperty.link(this.focusHighlightsVisibleListener),this.interactiveHighlightsVisibleProperty.link(this.voicingHighlightsVisibleListener)}dispose(){this.hasHighlight()&&this.deactivateHighlight(),FocusManager.pdomFocusProperty.unlink(this.domFocusListener),this.pdomFocusHighlightsVisibleProperty.unlink(this.focusHighlightsVisibleListener),this.interactiveHighlightsVisibleProperty.unlink(this.voicingHighlightsVisibleListener),this.display.focusManager.pointerFocusProperty.unlink(this.pointerFocusListener),this.display.focusManager.readingBlockFocusProperty.unlink(this.readingBlockFocusListener),this.focusDisplay.dispose()}hasHighlight(){return!!this.trail}hasReadingBlockHighlight(){return!!this.readingBlockTrail}activateHighlight(e,t,n,r,s){this.trail=e,this.node=t;const a=n;this.activeHighlight=a;let l=e;if(a==="invisible")this.mode="invisible";else if(a instanceof Shape$1)this.mode="shape",this.shapeFocusHighlightPath.visible=!0,this.shapeFocusHighlightPath.setShape(a);else if(a instanceof Node$2){if(this.mode="node",a instanceof HighlightPath$1){const d=a;assert&&assert(a.shape!==null,"The shape of the Node highlight should be set by now. Does it have bounds?"),d.transformSourceNode&&(l=a.getUniqueHighlightTrail(this.trail))}this.nodeModeHighlight=a,r?(this.nodeModeHighlightLayered=!0,this.nodeModeHighlight.visible=s.get()):(this.nodeModeHighlight.visible=!0,this.highlightNode.addChild(this.nodeModeHighlight))}else this.mode="bounds",this.boundsFocusHighlightPath.setShapeFromNode(this.node),this.boundsFocusHighlightPath.visible=!0,this.node.localBoundsProperty.lazyLink(this.boundsListener),this.onBoundsChange();this.transformTracker=new TransformTracker$1(l,{isStatic:!0}),this.transformTracker.addListener(this.transformListener),this.activateGroupHighlights(),this.updateHighlightColors(),this.transformDirty=!0}activateFocusHighlight(e,t){this.activateHighlight(e,t,t.focusHighlight,t.focusHighlightLayerable,this.pdomFocusHighlightsVisibleProperty),t.focusHighlightChangedEmitter.addListener(this.focusHighlightListener)}activateInteractiveHighlight(e,t){this.activateHighlight(e,t,t.interactiveHighlight||t.focusHighlight,t.interactiveHighlightLayerable,this.interactiveHighlightsVisibleProperty),assert&&assert(t.isInteractiveHighlighting,"Node does not support any kind of interactive highlighting."),t.interactiveHighlightChangedEmitter.addListener(this.interactiveHighlightListener),t.focusHighlightChangedEmitter.addListener(this.interactiveHighlightListener)}activateReadingBlockHighlight(e){this.readingBlockTrail=e;const t=e.lastNode();assert&&assert(t.isReadingBlock,"should not activate a reading block highlight for a Node that is not a ReadingBlock"),this.activeReadingBlockNode=t;const n=this.activeReadingBlockNode.readingBlockActiveHighlight;this.addedReadingBlockHighlight=n,n==="invisible"||(n instanceof Shape$1?(this.readingBlockHighlightPath.setShape(n),this.readingBlockHighlightPath.visible=!0):n instanceof Node$2?this.readingBlockHighlightNode.addChild(n):(this.readingBlockHighlightPath.setShapeFromNode(this.activeReadingBlockNode),this.readingBlockHighlightPath.visible=!0)),this.readingBlockTransformTracker=new TransformTracker$1(this.readingBlockTrail,{isStatic:!0}),this.readingBlockTransformTracker.addListener(this.readingBlockTransformListener),this.activeReadingBlockNode.readingBlockActiveHighlightChangedEmitter.addListener(this.readingBlockHighlightChangeListener),this.readingBlockTransformDirty=!0}deactivateReadingBlockHighlight(){this.readingBlockHighlightPath.visible=!1,this.addedReadingBlockHighlight instanceof Node$2&&this.readingBlockHighlightNode.removeChild(this.addedReadingBlockHighlight),assert&&assert(this.readingBlockTransformTracker,"How can we deactivate the TransformTracker if it wasnt assigned.");const e=this.readingBlockTransformTracker;e.removeListener(this.readingBlockTransformListener),e.dispose(),this.readingBlockTransformTracker=null,assert&&assert(this.activeReadingBlockNode,"How can we deactivate the activeReadingBlockNode if it wasnt assigned."),this.activeReadingBlockNode.readingBlockActiveHighlightChangedEmitter.removeListener(this.readingBlockHighlightChangeListener),this.activeReadingBlockNode=null,this.readingBlockTrail=null,this.addedReadingBlockHighlight=null}deactivateHighlight(){assert&&assert(this.node,"Need an active Node to deactivate highlights");const e=this.node;if(this.mode==="shape")this.shapeFocusHighlightPath.visible=!1;else if(this.mode==="node"){assert&&assert(this.nodeModeHighlight,"How can we deactivate if nodeModeHighlight is not assigned");const n=this.nodeModeHighlight;this.nodeModeHighlightLayered?this.nodeModeHighlightLayered=!1:this.highlightNode.removeChild(n),n.visible=!1,this.nodeModeHighlight=null}else this.mode==="bounds"&&(this.boundsFocusHighlightPath.visible=!1,e.localBoundsProperty.unlink(this.boundsListener));e.focusHighlightChangedEmitter.hasListener(this.focusHighlightListener)&&e.focusHighlightChangedEmitter.removeListener(this.focusHighlightListener);const t=e;t.isInteractiveHighlighting&&(t.interactiveHighlightChangedEmitter.hasListener(this.interactiveHighlightListener)&&t.interactiveHighlightChangedEmitter.removeListener(this.interactiveHighlightListener),t.focusHighlightChangedEmitter.hasListener(this.interactiveHighlightListener)&&t.focusHighlightChangedEmitter.removeListener(this.interactiveHighlightListener)),this.deactivateGroupHighlights(),this.trail=null,this.node=null,this.mode=null,this.activeHighlight=null,this.transformTracker.removeListener(this.transformListener),this.transformTracker.dispose(),this.transformTracker=null}activateGroupHighlights(){assert&&assert(this.trail,"must have an active trail to activate group highlights");const e=this.trail;for(let t=0;t<e.length;t++){const n=e.nodes[t],r=n.groupFocusHighlight;if(r){const s=e.upToNode(n);this.groupTransformTracker=new TransformTracker$1(s),this.groupTransformTracker.addListener(this.transformListener),typeof r=="boolean"?(this.groupFocusHighlightPath.setShapeFromNode(n),this.groupFocusHighlightPath.visible=!0,this.groupHighlightNode=this.groupFocusHighlightPath,this.groupMode="bounds"):r instanceof Node$2&&(this.groupHighlightNode=r,this.groupFocusHighlightParent.addChild(r),this.groupMode="node");break}}}updateHighlightColors(){this.mode==="shape"?(this.shapeFocusHighlightPath.innerHighlightColor!==HighlightOverlay.getInnerHighlightColor()&&this.shapeFocusHighlightPath.setInnerHighlightColor(HighlightOverlay.getInnerHighlightColor()),this.shapeFocusHighlightPath.outerHighlightColor!==HighlightOverlay.getOuterHighlightColor()&&this.shapeFocusHighlightPath.setOuterHighlightColor(HighlightOverlay.getOuterHighlightColor())):this.mode==="bounds"&&(this.boundsFocusHighlightPath.innerHighlightColor!==HighlightOverlay.getInnerHighlightColor()&&this.boundsFocusHighlightPath.setInnerHighlightColor(HighlightOverlay.getInnerHighlightColor()),this.boundsFocusHighlightPath.outerHighlightColor!==HighlightOverlay.getOuterHighlightColor()&&this.boundsFocusHighlightPath.setOuterHighlightColor(HighlightOverlay.getOuterHighlightColor())),this.groupMode&&(this.groupFocusHighlightPath.innerHighlightColor!==HighlightOverlay.getInnerGroupHighlightColor()&&this.groupFocusHighlightPath.setInnerHighlightColor(HighlightOverlay.getInnerGroupHighlightColor()),this.groupFocusHighlightPath.outerHighlightColor!==HighlightOverlay.getOuterGroupHighlightColor()&&this.groupFocusHighlightPath.setOuterHighlightColor(HighlightOverlay.getOuterGroupHighlightColor()))}deactivateGroupHighlights(){this.groupMode&&(this.groupMode==="bounds"?this.groupFocusHighlightPath.visible=!1:this.groupMode==="node"&&(assert&&assert(this.groupHighlightNode,"Need a groupHighlightNode to deactivate this mode"),this.groupFocusHighlightParent.removeChild(this.groupHighlightNode)),this.groupMode=null,this.groupHighlightNode=null,assert&&assert(this.groupTransformTracker,"Need a groupTransformTracker to dispose"),this.groupTransformTracker.removeListener(this.transformListener),this.groupTransformTracker.dispose(),this.groupTransformTracker=null)}afterTransform(){this.mode==="shape"?this.shapeFocusHighlightPath.updateLineWidth():this.mode==="bounds"?this.boundsFocusHighlightPath.updateLineWidth():this.mode==="node"&&this.activeHighlight instanceof HighlightPath$1&&this.activeHighlight.updateLineWidth&&(assert&&assert(this.node,"Need an active Node to update line width"),this.activeHighlight.updateLineWidth(this.node))}onTransformChange(){this.transformDirty=!0}onReadingBlockTransformChange(){this.readingBlockTransformDirty=!0}onBoundsChange(){assert&&assert(this.node,"Must have an active node when bounds are changing"),this.boundsFocusHighlightPath.setShapeFromNode(this.node)}onFocusChange(e){const t=e&&e.display===this.display?e.trail:null;if(this.hasHighlight()&&this.deactivateHighlight(),t&&this.pdomFocusHighlightsVisibleProperty.value){const n=t.lastNode();this.activateFocusHighlight(t,n)}else this.display.focusManager.pointerFocusProperty.value&&this.interactiveHighlightsVisibleProperty.value&&this.updateInteractiveHighlight(this.display.focusManager.pointerFocusProperty.value)}onPointerFocusChange(e){!this.display.focusManager.lockedPointerFocusProperty.value&&!this.display.focusManager.pdomFocusHighlightsVisibleProperty.value&&this.updateInteractiveHighlight(e)}updateInteractiveHighlight(e){const t=e&&e.display===this.display?e.trail:null;this.hasHighlight()&&this.deactivateHighlight();let n=!1;if(t&&!this.display.focusManager.pdomFocusHighlightsVisibleProperty.value){const r=t.lastNode();(r.isReadingBlock&&this.readingBlockHighlightsVisibleProperty.value||!r.isReadingBlock&&this.interactiveHighlightsVisibleProperty.value)&&(this.activateInteractiveHighlight(t,r),n=!0)}!n&&FocusManager.pdomFocus&&this.pdomFocusHighlightsVisibleProperty.value&&this.onFocusChange(FocusManager.pdomFocus)}onLockedPointerFocusChange(e){this.updateInteractiveHighlight(e||this.display.focusManager.pointerFocusProperty.value)}onReadingBlockFocusChange(e){this.hasReadingBlockHighlight()&&this.deactivateReadingBlockHighlight();const t=e&&e.display===this.display?e.trail:null;t&&this.activateReadingBlockHighlight(t)}onFocusHighlightChange(){assert&&assert(this.node&&this.node.focused,"update should only be necessary if node already has focus"),this.onFocusChange(FocusManager.pdomFocus)}onInteractiveHighlightChange(){if(assert){const e=this.node,t=this.display.focusManager.lockedPointerFocusProperty.value;assert(e||t&&t.trail.lastNode()===this.node,"Update should only be necessary if Node is activated with a Pointer or pointer focus is locked during interaction")}this.updateInteractiveHighlight(this.display.focusManager.lockedPointerFocusProperty.value||this.display.focusManager.pointerFocusProperty.value)}onReadingBlockHighlightChange(){assert&&assert(this.activeReadingBlockNode,"Update should only be necessary when there is an active ReadingBlock Node"),assert&&assert(this.activeReadingBlockNode.readingBlockActivated,"Update should only be necessary while the ReadingBlock is activated"),this.onReadingBlockFocusChange(this.display.focusManager.readingBlockFocusProperty.value)}onFocusHighlightsVisibleChange(){this.onFocusChange(FocusManager.pdomFocus)}onVoicingHighlightsVisibleChange(){this.onPointerFocusChange(this.display.focusManager.pointerFocusProperty.value)}update(){this.hasHighlight()&&this.transformDirty&&(this.transformDirty=!1,assert&&assert(this.transformTracker,"The transformTracker must be available on update if transform is dirty"),this.highlightNode.setMatrix(this.transformTracker.matrix),this.groupHighlightNode&&(assert&&assert(this.groupTransformTracker,"The groupTransformTracker must be available on update if transform is dirty"),this.groupHighlightNode.setMatrix(this.groupTransformTracker.matrix)),this.afterTransform()),this.hasReadingBlockHighlight()&&this.readingBlockTransformDirty&&(this.readingBlockTransformDirty=!1,assert&&assert(this.readingBlockTransformTracker,"The groupTransformTracker must be available on update if transform is dirty"),this.readingBlockHighlightNode.setMatrix(this.readingBlockTransformTracker.matrix)),this.display.size.equals(this.focusDisplay.size)||this.focusDisplay.setWidthHeight(this.display.width,this.display.height),this.focusDisplay.updateDisplay()}static setInnerHighlightColor(e){innerHighlightColor=e}static getInnerHighlightColor(){return innerHighlightColor}static setOuterHilightColor(e){outerHighlightColor=e}static getOuterHighlightColor(){return outerHighlightColor}static setInnerGroupHighlightColor(e){innerGroupHighlightColor=e}static getInnerGroupHighlightColor(){return innerGroupHighlightColor}static setOuterGroupHighlightColor(e){outerGroupHighlightColor=e}static getOuterGroupHighlightColor(){return outerGroupHighlightColor}}scenery.register("HighlightOverlay",HighlightOverlay);class HitAreaOverlay extends ShapeBasedOverlay{constructor(e,t){super(e,t,"hitAreaOverlay")}addShapes(){new Trail(this.rootNode).eachTrailUnder(e=>{const t=e.lastNode();if(!t.isVisible()||t.pickable===!1)return!0;if(t.inputListeners.length&&e.isVisible()){const n=HitAreaOverlay.getLocalMouseShape(t),r=HitAreaOverlay.getLocalTouchShape(t),s=e.getMatrix();n.bounds.isEmpty()||this.addShape(n.transformed(s),"rgba(0,0,255,0.8)",!0),r.bounds.isEmpty()||this.addShape(r.transformed(s),"rgba(255,0,0,0.8)",!1)}return!1})}static getLocalMouseShape(e){let t=Shape$1.union([e.mouseArea?e.mouseArea instanceof Shape$1?e.mouseArea:Shape$1.bounds(e.mouseArea):e.getSelfShape(),...e.children.filter(n=>e.visible&&e.pickable!==!1).map(n=>HitAreaOverlay.getLocalMouseShape(n).transformed(n.matrix))]);return e.hasClipArea()&&(t=t.shapeIntersection(e.clipArea)),t}static getLocalTouchShape(e){let t=Shape$1.union([e.touchArea?e.touchArea instanceof Shape$1?e.touchArea:Shape$1.bounds(e.touchArea):e.getSelfShape(),...e.children.filter(n=>e.visible&&e.pickable!==!1).map(n=>HitAreaOverlay.getLocalTouchShape(n).transformed(n.matrix))]);return e.hasClipArea()&&(t=t.shapeIntersection(e.clipArea)),t}}scenery.register("HitAreaOverlay",HitAreaOverlay);class PointerAreaOverlay extends ShapeBasedOverlay{constructor(e,t){super(e,t,"mouseTouchAreaOverlay")}addShapes(){new Trail(this.rootNode).eachTrailUnder(e=>{const t=e.lastNode();if(!t.isVisible())return!0;if((t.mouseArea||t.touchArea)&&e.isVisible()){const n=e.getTransform();t.mouseArea&&this.addShape(n.transformShape(t.mouseArea instanceof Bounds2?Shape$1.bounds(t.mouseArea):t.mouseArea),"rgba(0,0,255,0.8)",!0),t.touchArea&&this.addShape(n.transformShape(t.touchArea instanceof Bounds2?Shape$1.bounds(t.touchArea):t.touchArea),"rgba(255,0,0,0.8)",!1)}return!1})}}scenery.register("PointerAreaOverlay",PointerAreaOverlay);class PointerOverlay{constructor(e,t){this.display=e,this.rootNode=t,this.pointerSVGContainer=document.createElement("div"),this.pointerSVGContainer.style.position="absolute",this.pointerSVGContainer.style.top="0",this.pointerSVGContainer.style.left="0",this.pointerSVGContainer.style["pointer-events"]="none";const n=10,r=1,s=(n+r/2)*2,a=s/2;e.sizeProperty.lazyLink(d=>{this.pointerSVGContainer.setAttribute("width",""+d.width),this.pointerSVGContainer.setAttribute("height",""+d.height),this.pointerSVGContainer.style.clip=`rect(0px,${d.width}px,${d.height}px,0px)`});const l=Matrix3.IDENTITY.copy();this.pointerAdded=d=>{const c=document.createElementNS(svgns,"svg");c.style.position="absolute",c.style.top="0",c.style.left="0",c.style["pointer-events"]="none",Utils.prepareForTransform(c),c.setAttribute("width",""+s),c.setAttribute("height",""+s);const y=document.createElementNS(svgns,"circle");y.setAttribute("cx",""+(n+r/2)),y.setAttribute("cy",""+(n+r/2)),y.setAttribute("r",""+n),y.setAttribute("style","fill:black;"),y.setAttribute("style","stroke:white;"),y.setAttribute("opacity","0.4");const m=z=>Utils.applyPreparedTransform(l.setToTranslation(z.x-a,z.y-a),c),O=()=>{d.isTouchLike()&&(this.pointerSVGContainer.removeChild(c),d.removeInputListener(D))},D={move:()=>{d.point&&m(d.point)},up:O,cancel:O,focus:()=>{d instanceof PDOMPointer&&d.point&&(m(d.point),this.pointerSVGContainer.appendChild(c))},blur:()=>{this.pointerSVGContainer.contains(c)&&this.pointerSVGContainer.removeChild(c)}};d.addInputListener(D),D.move(),c.appendChild(y),this.pointerSVGContainer.appendChild(c)},e._input.pointerAddedEmitter.addListener(this.pointerAdded),e._input&&e._input.mouse&&this.pointerAdded(e._input.mouse),this.domElement=this.pointerSVGContainer}dispose(){this.display._input.pointerAddedEmitter.removeListener(this.pointerAdded)}update(){}}scenery.register("PointerOverlay",PointerOverlay);let globalIdCounter$1=1;const defaultPreferredRenderers=Renderer.createOrderBitmask(Renderer.bitmaskSVG,Renderer.bitmaskCanvas,Renderer.bitmaskDOM,Renderer.bitmaskWebGL);class Instance{constructor(e,t,n,r){ut(this,"display",null);this.active=!1,this.initialize(e,t,n,r)}initialize(e,t,n,r){return assert&&assert(!this.active,"We should never try to initialize an already active object"),t.setImmutable(),this.id=this.id||globalIdCounter$1++,this.isWebGLSupported=e.isWebGLAllowed()&&Utils.isWebGLSupported,this.relativeTransform=this.relativeTransform||new RelativeTransform(this),this.fittability=this.fittability||new Fittability(this),this.visible=!0,this.relativeVisible=!0,this.selfVisible=!0,this.visibilityDirty=!0,this.childVisibilityDirty=!0,this.voicingVisible=!0,this.branchIndexMap=this.branchIndexMap||{},this.branchIndexReferences=cleanArray(this.branchIndexReferences),this.addRemoveCounter=0,this.stitchChangeFrame=e._frameId,this.stitchChangeBefore=0,this.stitchChangeAfter=0,this.stitchChangeOnChildren=0,this.stitchChangeIncluded=!1,this.childInsertedListener=this.childInsertedListener||this.onChildInserted.bind(this),this.childRemovedListener=this.childRemovedListener||this.onChildRemoved.bind(this),this.childrenReorderedListener=this.childrenReorderedListener||this.onChildrenReordered.bind(this),this.visibilityListener=this.visibilityListener||this.onVisibilityChange.bind(this),this.markRenderStateDirtyListener=this.markRenderStateDirtyListener||this.markRenderStateDirty.bind(this),this.visibleEmitter=new TinyEmitter,this.relativeVisibleEmitter=new TinyEmitter,this.selfVisibleEmitter=new TinyEmitter,this.canVoiceEmitter=new TinyEmitter,this.cleanInstance(e,t),this.node.addInstance(this),this.externalReferenceCount=0,this.stateless=!0,this.isDisplayRoot=n,this.isSharedCanvasCacheRoot=r,this.preferredRenderers=0,this.isUnderCanvasCache=r,this.isBackbone=!1,this.isTransformed=!1,this.isVisibilityApplied=!1,this.isInstanceCanvasCache=!1,this.isSharedCanvasCachePlaceholder=!1,this.isSharedCanvasCacheSelf=r,this.selfRenderer=0,this.groupRenderer=0,this.sharedCacheRenderer=0,this.renderStateDirtyFrame=e._frameId,this.skipPruningFrame=e._frameId,sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`initialized ${this.toString()}`),this.active=!0,this}cleanInstance(e,t){this.display=e,this.trail=t,this.node=t?t.lastNode():null,this.parent=null,this.oldParent=null,this.children=cleanArray(this.children),this.sharedCacheInstance=null,this.relativeTransform.initialize(e,t),this.fittability.initialize(e,t),this.instanceRemovalCheckList=cleanArray(this.instanceRemovalCheckList),this.selfDrawable=null,this.groupDrawable=null,this.sharedCacheDrawable=null,this.firstDrawable=null,this.lastDrawable=null,this.firstInnerDrawable=null,this.lastInnerDrawable=null,this.svgGroups=cleanArray(this.svgGroups),this.cleanSyncTreeResults()}cleanSyncTreeResults(){this.beforeStableIndex=this.children.length,this.afterStableIndex=-1,this.firstChangeInterval=null,this.lastChangeInterval=null,this.incompatibleStateChange=!1,this.groupChanged=!1,this.cascadingStateChange=!1,this.anyStateChange=!1}updateRenderingState(){sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`updateRenderingState ${this.toString()}${this.stateless?" (stateless)":""}`),sceneryLog&&sceneryLog.Instance&&sceneryLog.push(),sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`old: ${this.getStateString()}`);const e=this.isBackbone,t=this.isTransformed,n=this.isVisibilityApplied,r=this.isInstanceCanvasCache,s=this.isSharedCanvasCacheSelf,a=this.isSharedCanvasCachePlaceholder,l=this.isUnderCanvasCache,d=this.selfRenderer,c=this.groupRenderer,y=this.sharedCacheRenderer,m=this.preferredRenderers;this.isBackbone=!1,this.isTransformed=!1,this.isVisibilityApplied=!1,this.isInstanceCanvasCache=!1,this.isSharedCanvasCacheSelf=!1,this.isSharedCanvasCachePlaceholder=!1,this.selfRenderer=0,this.groupRenderer=0,this.sharedCacheRenderer=0;const O=this.node;this.isUnderCanvasCache=this.isSharedCanvasCacheRoot||(this.parent?this.parent.isUnderCanvasCache||this.parent.isInstanceCanvasCache||this.parent.isSharedCanvasCacheSelf:!1),this.preferredRenderers=this.parent?this.parent.preferredRenderers:defaultPreferredRenderers,O._renderer&&(this.preferredRenderers=Renderer.pushOrderBitmask(this.preferredRenderers,O._renderer));const D=this.node.hasClipArea(),z=this.node.effectiveOpacity!==1||O._usesOpacity||this.node._filters.length>0;let w=!1,N=!1;if(z)for(let ue=0;ue<this.node._filters.length;ue++){const fe=this.node._filters[ue];fe.isSVGCompatible()||(w=!0),fe.isCanvasCompatible()||(N=!0)}const H=O._cssTransform||O._layerSplit,X=this.isDisplayRoot||!this.isUnderCanvasCache&&H,ae=!X&&(z||D)&&(!w&&this.node._rendererSummary.isSubtreeRenderedExclusivelySVG(this.preferredRenderers)||!N&&this.node._rendererSummary.isSubtreeRenderedExclusivelyCanvas(this.preferredRenderers));if((ae?!1:X||z||D)?(this.isBackbone=!0,this.isVisibilityApplied=!0,this.isTransformed=this.isDisplayRoot||!!O._cssTransform,this.groupRenderer=Renderer.bitmaskDOM):!ae&&(z||D||O._canvasCache)&&(assert&&assert(this.node._rendererSummary.isSingleCanvasSupported(),`Node canvasCache provided, but not all node contents can be rendered with Canvas under ${this.node.constructor.name}`),O._singleCache?this.isSharedCanvasCacheRoot?(this.isSharedCanvasCacheSelf=!0,this.sharedCacheRenderer=this.isWebGLSupported?Renderer.bitmaskWebGL:Renderer.bitmaskCanvas):(assert&&assert(this.node._rendererSummary.areBoundsValid(),`Node singleCache provided, but not all node contents have valid bounds under ${this.node.constructor.name}`),this.isSharedCanvasCachePlaceholder=!0):(this.isInstanceCanvasCache=!0,this.isUnderCanvasCache=!0,this.groupRenderer=this.isWebGLSupported?Renderer.bitmaskWebGL:Renderer.bitmaskCanvas)),this.node.isPainted())if(this.isUnderCanvasCache)this.selfRenderer=Renderer.bitmaskCanvas;else{let ue=this.node._rendererBitmask;if(!this.isWebGLSupported){const fe=Renderer.bitmaskWebGL;ue=ue^ue&fe}this.selfRenderer=ue&Renderer.bitmaskOrder(this.preferredRenderers,0)||ue&Renderer.bitmaskOrder(this.preferredRenderers,1)||ue&Renderer.bitmaskOrder(this.preferredRenderers,2)||ue&Renderer.bitmaskOrder(this.preferredRenderers,3)||ue&Renderer.bitmaskSVG||ue&Renderer.bitmaskCanvas||ue&Renderer.bitmaskDOM||ue&Renderer.bitmaskWebGL||0,assert&&assert(this.selfRenderer,"setSelfRenderer failure?")}this.groupChanged=e!==this.isBackbone||r!==this.isInstanceCanvasCache||s!==this.isSharedCanvasCacheSelf,this.cascadingStateChange=l!==this.isUnderCanvasCache||m!==this.preferredRenderers,this.incompatibleStateChange=this.isTransformed!==t||this.isSharedCanvasCachePlaceholder!==a,this.anyStateChange=this.groupChanged||this.cascadingStateChange||this.incompatibleStateChange||d!==this.selfRenderer||c!==this.groupRenderer||y!==this.sharedCacheRenderer,n!==this.isVisibilityApplied&&(this.visibilityDirty=!0,this.parent&&this.parent.markChildVisibilityDirty()),this.fittability.checkSelfFittability(),sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`new: ${this.getStateString()}`),sceneryLog&&sceneryLog.Instance&&sceneryLog.pop()}getStateString(){return`${`S[ ${this.isDisplayRoot?"displayRoot ":""}${this.isBackbone?"backbone ":""}${this.isInstanceCanvasCache?"instanceCache ":""}${this.isSharedCanvasCachePlaceholder?"sharedCachePlaceholder ":""}${this.isSharedCanvasCacheSelf?"sharedCacheSelf ":""}${this.isTransformed?"TR ":""}${this.isVisibilityApplied?"VIS ":""}${this.selfRenderer?this.selfRenderer.toString(16):"-"},${this.groupRenderer?this.groupRenderer.toString(16):"-"},${this.sharedCacheRenderer?this.sharedCacheRenderer.toString(16):"-"} `}]`}baseSyncTree(){assert&&assert(this.isDisplayRoot,"baseSyncTree() should only be called on the root instance"),sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`-------- START baseSyncTree ${this.toString()} --------`),this.syncTree(),sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`-------- END baseSyncTree ${this.toString()} --------`),this.cleanSyncTreeResults()}syncTree(){sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`syncTree ${this.toString()} ${this.getStateString()}${this.stateless?" (stateless)":""}`),sceneryLog&&sceneryLog.Instance&&sceneryLog.push(),sceneryLog&&scenery.isLoggingPerformance()&&this.display.perfSyncTreeCount++,assert&&assert(!this.parent||!this.parent.stateless,"We should not have a stateless parent instance");const e=this.stateless;if(e||this.parent&&this.parent.cascadingStateChange||this.renderStateDirtyFrame===this.display._frameId?this.updateRenderingState():assertSlow&&(this.updateRenderingState(),assertSlow(!this.anyStateChange)),!e&&this.incompatibleStateChange)return sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`incompatible instance ${this.toString()} ${this.getStateString()}, aborting`),sceneryLog&&sceneryLog.Instance&&sceneryLog.pop(),!1;if(this.stateless=!1,assert&&assert(!e||this.children.length===0,"We should not have child instances on an instance without state"),e&&(this.isTransformed&&this.display.markTransformRootDirty(this,!0),this.attachNodeListeners()),this.isSharedCanvasCachePlaceholder)this.sharedSyncTree();else if(e||this.skipPruningFrame===this.display._frameId||this.anyStateChange){this.prepareChildInstances(e);const t=this.firstDrawable,n=this.lastDrawable,r=this.firstInnerDrawable,s=this.lastInnerDrawable,a=this.updateSelfDrawable();this.localSyncTree(a),assertSlow&&this.auditChangeIntervals(r,s,this.firstInnerDrawable,this.lastInnerDrawable),this.groupSyncTree(e),assertSlow&&this.auditChangeIntervals(t,n,this.firstDrawable,this.lastDrawable)}else sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance("pruned");return sceneryLog&&sceneryLog.Instance&&sceneryLog.pop(),!0}localSyncTree(e){const t=this.display._frameId;let n=this.selfDrawable,r=n;assert&&assert(this.firstChangeInterval===null&&this.lastChangeInterval===null,"sanity checks that cleanSyncTreeResults were called");let s=null;e&&(sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.ChangeInterval("self"),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.push(),s=ChangeInterval.newForDisplay(null,null,this.display),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.pop());let a=s,l=e?null:this.selfDrawable;for(let d=0;d<this.children.length;d++){let c=this.children[d];c.syncTree()||(c=this.updateIncompatibleChildInstance(c,d),c.syncTree());const m=c.shouldIncludeInParentDrawables();m&&c.firstDrawable&&(r?Drawable.connectDrawables(r,c.firstDrawable,this.display):n=c.firstDrawable,r=c.lastDrawable),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.ChangeInterval(`changes for ${c.toString()} in ${this.toString()}`),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.push();const O=c.stitchChangeIncluded,D=m;c.stitchChangeIncluded=D,sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.ChangeInterval(`included: ${O} => ${D}`),c.stitchChangeFrame===t?(sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.ChangeInterval("stitchChangeFrame full change interval"),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.push(),c.firstChangeInterval=c.lastChangeInterval=ChangeInterval.newForDisplay(null,null,this.display),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.pop()):assert&&assert(O===D,"If we do not have stitchChangeFrame activated, our inclusion should not have changed");const z=c.firstChangeInterval;let w=a&&a.drawableAfter===null;const N=z&&z.drawableBefore===null;if(c.stitchChangeBefore===t&&!w&&!N){sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.ChangeInterval("bridge"),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.push();const X=ChangeInterval.newForDisplay(l,null,this.display);a&&(a.nextChangeInterval=X),a=X,s=s||a,w=!0,sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.pop()}if((O||D)&&(w?z?z.drawableBefore===null?(a.drawableAfter=z.drawableAfter,a.nextChangeInterval=z.nextChangeInterval,a=c.lastChangeInterval===z?a:c.lastChangeInterval):(a.drawableAfter=c.firstDrawable,a.nextChangeInterval=z,a=c.lastChangeInterval):a.drawableAfter=c.firstDrawable:z&&(s=s||z,z.drawableBefore===null&&(assert&&assert(!a||l,"If we have a current change interval, we should be guaranteed a non-null lastUnchangedDrawable"),z.drawableBefore=l),a&&(a.nextChangeInterval=z),a=c.lastChangeInterval),l=a&&a.drawableAfter===null?null:c.lastDrawable?c.lastDrawable:l),d===this.children.length-1&&c.stitchChangeAfter===t&&!(a&&a.drawableAfter===null)){const X=ChangeInterval.newForDisplay(l,null,this.display);a&&(a.nextChangeInterval=X),a=X,s=s||a}c.cleanSyncTreeResults(),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.pop()}if(assert&&assert(!!s==!!a,"Presence of first and current change intervals should be equal"),!s&&this.stitchChangeOnChildren===this.display._frameId&&this.children.length===0&&(s=a=ChangeInterval.newForDisplay(null,null,this.display)),this.firstChangeInterval=s,this.lastChangeInterval=a,this.firstDrawable=this.firstInnerDrawable=n,this.lastDrawable=this.lastInnerDrawable=r,assertSlow){let d=null;for(let y=0;y<this.children.length;y++)if(this.children[y].shouldIncludeInParentDrawables()&&this.children[y].firstDrawable){d=this.children[y].firstDrawable;break}this.selfDrawable&&(d=this.selfDrawable);let c=this.selfDrawable;for(let y=this.children.length-1;y>=0;y--)if(this.children[y].shouldIncludeInParentDrawables()&&this.children[y].lastDrawable){c=this.children[y].lastDrawable;break}assertSlow(d===this.firstDrawable),assertSlow(c===this.lastDrawable)}}updateSelfDrawable(){if(this.node.isPainted()){const e=this.selfRenderer;if(!this.selfDrawable||!(this.selfDrawable.renderer&e&Renderer.bitmaskRendererArea))return this.selfDrawable&&(sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`replacing old drawable ${this.selfDrawable.toString()} with new renderer`),this.selfDrawable.markForDisposal(this.display)),this.selfDrawable=Renderer.createSelfDrawable(this,this.node,e,this.fittability.ancestorsFittable),assert&&assert(this.selfDrawable),!0}else assert&&assert(this.selfDrawable===null,"Non-painted nodes should not have a selfDrawable");return!1}updateIncompatibleChildInstance(e,t){if(sceneryLog&&scenery.isLoggingPerformance()){const r=e.getDescendantCount()+1;r>100?sceneryLog.PerfCritical&&sceneryLog.PerfCritical(`incompatible instance rebuild at ${this.trail.toPathString()}: ${r}`):r>40?sceneryLog.PerfMajor&&sceneryLog.PerfMajor(`incompatible instance rebuild at ${this.trail.toPathString()}: ${r}`):r>0&&sceneryLog.PerfMinor&&sceneryLog.PerfMinor(`incompatible instance rebuild at ${this.trail.toPathString()}: ${r}`)}this.display.markInstanceRootForDisposal(e);const n=Instance.createFromPool(this.display,this.trail.copy().addDescendant(e.node,t),!1,!1);return this.replaceInstanceWithIndex(e,n,t),n}groupSyncTree(e){const t=this.groupRenderer;assert&&assert((this.isBackbone?1:0)+(this.isInstanceCanvasCache?1:0)+(this.isSharedCanvasCacheSelf?1:0)==(t?1:0),"We should have precisely one of these flags set for us to have a groupRenderer");const n=!!t!=!!this.groupDrawable||!e&&this.groupChanged||this.groupDrawable&&this.groupDrawable.renderer!==t;n&&(this.groupDrawable&&(sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`replacing group drawable ${this.groupDrawable.toString()}`),this.groupDrawable.markForDisposal(this.display),this.groupDrawable=null),this.firstChangeInterval=this.lastChangeInterval=ChangeInterval.newForDisplay(null,null,this.display)),t&&(this.firstDrawable&&Drawable.disconnectBefore(this.firstDrawable,this.display),this.lastDrawable&&Drawable.disconnectAfter(this.lastDrawable,this.display),this.isBackbone?(n&&(this.groupDrawable=BackboneDrawable$1.createFromPool(this.display,this,this.getTransformRootInstance(),t,this.isDisplayRoot),this.isTransformed&&this.display.markTransformRootDirty(this,!0)),this.firstChangeInterval&&this.groupDrawable.stitch(this.firstDrawable,this.lastDrawable,this.firstChangeInterval,this.lastChangeInterval)):this.isInstanceCanvasCache?(n&&(this.groupDrawable=InlineCanvasCacheDrawable.createFromPool(t,this)),this.firstChangeInterval&&this.groupDrawable.stitch(this.firstDrawable,this.lastDrawable,this.firstChangeInterval,this.lastChangeInterval)):this.isSharedCanvasCacheSelf&&n&&(this.groupDrawable=CanvasBlock$1.createFromPool(t,this)),this.groupDrawable.setFittable(this.fittability.ancestorsFittable),this.firstDrawable=this.lastDrawable=this.groupDrawable),n?this.firstChangeInterval=this.lastChangeInterval=ChangeInterval.newForDisplay(null,null,this.display):t&&(this.firstChangeInterval=this.lastChangeInterval=null)}sharedSyncTree(){this.ensureSharedCacheInitialized();const e=this.sharedCacheRenderer;(!this.sharedCacheDrawable||this.sharedCacheDrawable.renderer!==e)&&(this.sharedCacheDrawable&&(sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`replacing shared cache drawable ${this.sharedCacheDrawable.toString()}`),this.sharedCacheDrawable.markForDisposal(this.display)),this.sharedCacheDrawable=new SharedCanvasCacheDrawable(this.trail,e,this,this.sharedCacheInstance),this.firstDrawable=this.sharedCacheDrawable,this.lastDrawable=this.sharedCacheDrawable,this.firstChangeInterval=this.lastChangeInterval=ChangeInterval.newForDisplay(null,null,this.display))}prepareChildInstances(e){for(;this.instanceRemovalCheckList.length;){const t=this.instanceRemovalCheckList.pop();t.addRemoveCounter===-1&&(t.addRemoveCounter=0,this.display.markInstanceRootForDisposal(t))}if(e)for(let t=0;t<this.node.children.length;t++){const n=this.node.children[t];this.appendInstance(Instance.createFromPool(this.display,this.trail.copy().addDescendant(n,t),!1,!1))}}ensureSharedCacheInitialized(){if(!this.sharedCacheInstance){const e=this.node.getId();this.sharedCacheInstance=this.display._sharedCanvasInstances[e],this.sharedCacheInstance||(this.sharedCacheInstance=Instance.createFromPool(this.display,new Trail(this.node),!1,!0),this.sharedCacheInstance.syncTree(),this.display._sharedCanvasInstances[e]=this.sharedCacheInstance,this.display.markTransformRootDirty(this.sharedCacheInstance,!0)),this.sharedCacheInstance.externalReferenceCount++,this.isTransformed&&this.display.markTransformRootDirty(this,!0)}}shouldIncludeInParentDrawables(){return this.node.isVisible()||!this.node.isExcludeInvisible()}findPreviousDrawable(e){for(let t=e-1;t>=0;t--){const n=this.children[t].lastDrawable;if(n!==null)return n}return null}findNextDrawable(e){const t=this.children.length;for(let n=e+1;n<t;n++){const r=this.children[n].firstDrawable;if(r!==null)return r}return null}appendInstance(e){this.insertInstance(e,this.children.length)}insertInstance(e,t){assert&&assert(e instanceof Instance),assert&&assert(t>=0&&t<=this.children.length,`Instance insertion bounds check for index ${t} with previous children length ${this.children.length}`),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.InstanceTree(`inserting ${e.toString()} into ${this.toString()}`),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.push(),e.stitchChangeFrame=this.display._frameId,this.stitchChangeOnChildren=this.display._frameId,this.children.splice(t,0,e),e.parent=this,e.oldParent=this,t<=this.beforeStableIndex&&(this.beforeStableIndex=t-1),t>this.afterStableIndex?this.afterStableIndex=t+1:this.afterStableIndex++,this.fittability.onInsert(e.fittability),this.relativeTransform.addInstance(e),this.markChildVisibilityDirty(),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.pop()}removeInstance(e){this.removeInstanceWithIndex(e,_.indexOf(this.children,e))}removeInstanceWithIndex(e,t){assert&&assert(e instanceof Instance),assert&&assert(t>=0&&t<this.children.length,`Instance removal bounds check for index ${t} with previous children length ${this.children.length}`),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.InstanceTree(`removing ${e.toString()} from ${this.toString()}`),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.push();const n=this.display._frameId;e.stitchChangeFrame=n,this.stitchChangeOnChildren=n,t-1>=0&&(this.children[t-1].stitchChangeAfter=n),t+1<this.children.length&&(this.children[t+1].stitchChangeBefore=n),this.children.splice(t,1),e.parent=null,e.oldParent=this,t<=this.beforeStableIndex&&(this.beforeStableIndex=t-1),t>=this.afterStableIndex?this.afterStableIndex=t:this.afterStableIndex--,this.fittability.onRemove(e.fittability),this.relativeTransform.removeInstance(e),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.pop()}replaceInstanceWithIndex(e,t,n){this.removeInstanceWithIndex(e,n),this.insertInstance(t,n)}reorderInstances(e,t){assert&&assert(typeof e=="number"),assert&&assert(typeof t=="number"),assert&&assert(e<=t),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.InstanceTree(`Reordering ${this.toString()}`),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.push();const n=this.display._frameId;this.children.splice(e,t-e+1);for(let r=e;r<=t;r++){const s=this.findChildInstanceOnNode(this.node._children[r]);this.children.splice(r,0,s),s.stitchChangeFrame=n,r>e&&(s.stitchChangeAfter=n),r<t&&(s.stitchChangeBefore=n)}this.stitchChangeOnChildren=n,this.beforeStableIndex=Math.min(this.beforeStableIndex,e-1),this.afterStableIndex=Math.max(this.afterStableIndex,t+1),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.pop()}findChildInstanceOnNode(e){const t=e.getInstances();for(let n=0;n<t.length;n++)if(t[n].oldParent===this)return t[n];return null}onChildInserted(e,t){sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`inserting child node ${e.constructor.name}#${e.id} into ${this.toString()}`),sceneryLog&&sceneryLog.Instance&&sceneryLog.push(),assert&&assert(!this.stateless,"If we are stateless, we should not receive these notifications");let n=this.findChildInstanceOnNode(e);n?(sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance("instance already exists"),n.addRemoveCounter+=1,assert&&assert(n.addRemoveCounter===0)):(sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance("creating stub instance"),sceneryLog&&sceneryLog.Instance&&sceneryLog.push(),n=Instance.createFromPool(this.display,this.trail.copy().addDescendant(e,t),!1,!1),sceneryLog&&sceneryLog.Instance&&sceneryLog.pop()),this.insertInstance(n,t),this.markSkipPruning(),sceneryLog&&sceneryLog.Instance&&sceneryLog.pop()}onChildRemoved(e,t){sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`removing child node ${e.constructor.name}#${e.id} from ${this.toString()}`),sceneryLog&&sceneryLog.Instance&&sceneryLog.push(),assert&&assert(!this.stateless,"If we are stateless, we should not receive these notifications"),assert&&assert(this.children[t].node===e,"Ensure that our instance matches up");const n=this.findChildInstanceOnNode(e);assert&&assert(n!==null,"We should always have a reference to a removed instance"),n.addRemoveCounter-=1,assert&&assert(n.addRemoveCounter===-1),this.instanceRemovalCheckList.push(n),this.removeInstanceWithIndex(n,t),this.markSkipPruning(),sceneryLog&&sceneryLog.Instance&&sceneryLog.pop()}onChildrenReordered(e,t){sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`reordering children for ${this.toString()}`),sceneryLog&&sceneryLog.Instance&&sceneryLog.push(),this.reorderInstances(e,t),this.markSkipPruning(),sceneryLog&&sceneryLog.Instance&&sceneryLog.pop()}onVisibilityChange(){assert&&assert(!this.stateless,"If we are stateless, we should not receive these notifications"),this.stitchChangeFrame=this.display._frameId,this.parent&&this.parent.markSkipPruning(),this.visibilityDirty=!0,this.parent&&this.parent.markChildVisibilityDirty()}onOpacityChange(){assert&&assert(!this.stateless,"If we are stateless, we should not receive these notifications"),this.markRenderStateDirty()}markChildVisibilityDirty(){this.childVisibilityDirty||(this.childVisibilityDirty=!0,this.parent&&this.parent.markChildVisibilityDirty())}updateDrawableFittability(e){this.selfDrawable&&this.selfDrawable.setFittable(e),this.groupDrawable&&this.groupDrawable.setFittable(e)}updateVisibility(e,t,n,r){this.visibilityDirty&&(r=!0);const s=this.node.isVisible(),a=this.visible,l=this.relativeVisible,d=this.selfVisible,c=this.node.voicingVisibleProperty.value,y=this.voicingVisible,m=a&&y;this.visible=e&&s,this.voicingVisible=t&&c,this.relativeVisible=n&&s,this.selfVisible=this.isVisibilityApplied?!0:this.relativeVisible;const O=this.children.length;for(let z=0;z<O;z++){const w=this.children[z];(r||w.visibilityDirty||w.childVisibilityDirty)&&w.updateVisibility(this.visible,this.voicingVisible,this.isVisibilityApplied?!0:this.relativeVisible,r)}this.visibilityDirty=!1,this.childVisibilityDirty=!1,this.visible!==a&&this.visibleEmitter.emit(),this.relativeVisible!==l&&this.relativeVisibleEmitter.emit(),this.selfVisible!==d&&this.selfVisibleEmitter.emit();const D=this.voicingVisible&&this.visible;D!==m&&this.canVoiceEmitter.emit(D)}getDescendantCount(){let e=this.children.length;for(let t=0;t<this.children.length;t++)e+=this.children[t].getDescendantCount();return e}addSVGGroup(e){this.svgGroups.push(e)}removeSVGGroup(e){arrayRemove(this.svgGroups,e)}lookupSVGGroup(e){const t=this.svgGroups.length;for(let n=0;n<t;n++){const r=this.svgGroups[n];if(r.block===e)return r}return null}getFilterRootInstance(){return this.isBackbone||this.isInstanceCanvasCache||!this.parent?this:this.parent.getFilterRootInstance()}getTransformRootInstance(){return this.isTransformed||!this.parent?this:this.parent.getTransformRootInstance()}getVisibilityRootInstance(){return this.isVisibilityApplied||!this.parent?this:this.parent.getVisibilityRootInstance()}attachNodeListeners(){this.relativeTransform.attachNodeListeners(),this.isSharedCanvasCachePlaceholder||(this.node.childInsertedEmitter.addListener(this.childInsertedListener),this.node.childRemovedEmitter.addListener(this.childRemovedListener),this.node.childrenReorderedEmitter.addListener(this.childrenReorderedListener),this.node.visibleProperty.lazyLink(this.visibilityListener),this.node.voicingVisibleProperty.lazyLink(this.visibilityListener),this.node.filterChangeEmitter.addListener(this.markRenderStateDirtyListener),this.node.clipAreaProperty.lazyLink(this.markRenderStateDirtyListener),this.node.instanceRefreshEmitter.addListener(this.markRenderStateDirtyListener))}detachNodeListeners(){this.relativeTransform.detachNodeListeners(),this.isSharedCanvasCachePlaceholder||(this.node.childInsertedEmitter.removeListener(this.childInsertedListener),this.node.childRemovedEmitter.removeListener(this.childRemovedListener),this.node.childrenReorderedEmitter.removeListener(this.childrenReorderedListener),this.node.visibleProperty.unlink(this.visibilityListener),this.node.voicingVisibleProperty.unlink(this.visibilityListener),this.node.filterChangeEmitter.removeListener(this.markRenderStateDirtyListener),this.node.clipAreaProperty.unlink(this.markRenderStateDirtyListener),this.node.instanceRefreshEmitter.removeListener(this.markRenderStateDirtyListener))}markRenderStateDirty(){this.renderStateDirtyFrame=this.display._frameId,this.parent&&this.parent.markSkipPruning()}markSkipPruning(){this.skipPruningFrame=this.display._frameId,this.parent&&this.parent.markSkipPruning()}getBranchIndexTo(e){const t=this.branchIndexMap[e.id];if(t!==void 0)return t;const n=this.trail.getBranchIndexTo(e.trail);return this.branchIndexMap[e.id]=n,e.branchIndexMap[this.id]=n,this.branchIndexReferences.push(e),e.branchIndexReferences.push(this),n}dispose(){for(sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`dispose ${this.toString()}`),sceneryLog&&sceneryLog.Instance&&sceneryLog.push(),assert&&assert(this.active,"Seems like we tried to dispose this Instance twice, it is not active"),this.active=!1;this.branchIndexReferences.length;){const t=this.branchIndexReferences.pop();delete this.branchIndexMap[t.id],delete t.branchIndexMap[this.id],arrayRemove(t.branchIndexReferences,this)}this.groupDrawable&&this.groupDrawable.disposeImmediately(this.display),this.sharedCacheDrawable&&this.sharedCacheDrawable.disposeImmediately(this.display),this.selfDrawable&&this.selfDrawable.disposeImmediately(this.display);const e=this.children.length;for(let t=0;t<e;t++)this.children[t].dispose();for(;this.instanceRemovalCheckList.length;){const t=this.instanceRemovalCheckList.pop();t.active&&t.dispose()}this.stateless||this.detachNodeListeners(),this.node.removeInstance(this),this.sharedCacheInstance&&(this.sharedCacheInstance.externalReferenceCount--,this.sharedCacheInstance.externalReferenceCount===0&&(delete this.display._sharedCanvasInstances[this.node.getId()],this.sharedCacheInstance.dispose())),this.cleanInstance(null,null),this.visibleEmitter.removeAllListeners(),this.relativeVisibleEmitter.removeAllListeners(),this.selfVisibleEmitter.removeAllListeners(),this.canVoiceEmitter.removeAllListeners(),this.freeToPool(),sceneryLog&&sceneryLog.Instance&&sceneryLog.pop()}audit(e,t){if(assertSlow){e===void 0&&(e=this.display._frameId),assertSlow(!this.stateless,"State is required for all display instances"),assertSlow(this.firstDrawable===null==(this.lastDrawable===null),"First/last drawables need to both be null or non-null"),assertSlow(!this.isBackbone&&!this.isSharedCanvasCachePlaceholder||this.groupDrawable,"If we are a backbone or shared cache, we need to have a groupDrawable reference"),assertSlow(!this.isSharedCanvasCachePlaceholder||!this.node.isPainted()||this.selfDrawable,"We need to have a selfDrawable if we are painted and not a shared cache"),assertSlow(!this.isTransformed&&!this.isCanvasCache||this.groupDrawable,"We need to have a groupDrawable if we are a backbone or any type of canvas cache"),assertSlow(!this.isSharedCanvasCachePlaceholder||this.sharedCacheDrawable,"We need to have a sharedCacheDrawable if we are a shared cache"),assertSlow(this.addRemoveCounter===0,"Our addRemoveCounter should always be 0 at the end of syncTree");for(let n=0;n<this.children.length;n++)this.children[n].audit(e,t);this.relativeTransform.audit(e,t),this.fittability.audit()}}auditVisibility(e){if(assertSlow){const t=e&&this.node.isVisible(),n=this.trail.isVisible();assertSlow(t===n,"Trail visibility failure"),assertSlow(t===this.visible,"Visible flag failure"),assertSlow(this.voicingVisible===_.reduce(this.trail.nodes,(r,s)=>r&&s.voicingVisibleProperty.value,!0),"When this Instance is voicingVisible: true, all Trail Nodes must also be voicingVisible: true");for(let r=0;r<this.children.length;r++)this.children[r].auditVisibility(t)}}auditChangeIntervals(e,t,n,r){if(e){let a=e;for(;a!==t;)a=a.oldNextDrawable}if(n){let a=n;for(;a!==r;)a=a.nextDrawable}function s(a,l){if(assertSlow)for(assertSlow(a!==null),assertSlow(l!==null);a!==l;)assertSlow(a.nextDrawable===a.oldNextDrawable,"Change interval mismatch"),a=a.nextDrawable}if(assertSlow){const a=this.firstChangeInterval,l=this.lastChangeInterval;if((!a||a.drawableBefore!==null)&&assertSlow(e===n,"If we have no changes, or our first change interval is not open, our firsts should be the same"),(!l||l.drawableAfter!==null)&&assertSlow(t===r,"If we have no changes, or our last change interval is not open, our lasts should be the same"),!a)assertSlow(!l,"We should not be missing only one change interval"),e&&s(e,t);else{assertSlow(l,"We should not be missing only one change interval"),a.drawableBefore!==null&&s(e,a.drawableBefore),l.drawableAfter!==null&&s(l.drawableAfter,t);let d=a;for(;d&&d.nextChangeInterval;){const c=d.nextChangeInterval;assertSlow(d.drawableAfter!==null),assertSlow(c.drawableBefore!==null),s(d.drawableAfter,c.drawableBefore),d=c}}}}toString(){return`${this.id}#${this.node?`${this.node.constructor.name?this.node.constructor.name:"?"}#${this.node.id}`:"-"}`}}scenery.register("Instance",Instance);Poolable.mixInto(Instance);const Instance$1=Instance;class SafariWorkaroundOverlay{constructor(e){this.display=e;const t=document.createElementNS(svgns,"svg");this.domElement=t,t.style.position="absolute",t.setAttribute("class","safari-workaround"),t.style.top="0",t.style.left="0",t.style["pointer-events"]="none",e.sizeProperty.link(n=>{t.setAttribute("width",""+n.width),t.setAttribute("height",""+n.height),t.style.clip=`rect(0px,${n.width}px,${n.height}px,0px)`}),this.rect=document.createElementNS(svgns,"rect"),t.appendChild(this.rect),this.update()}update(){const e=dotRandom.nextDouble();this.rect.setAttribute("x",""+e),this.rect.setAttribute("y",""+e),this.rect.setAttribute("style","fill: rgba(255,200,100,0); stroke: none;"),this.display.width&&this.rect.setAttribute("width",""+(this.display.width-e*2)),this.display.height&&this.rect.setAttribute("height",""+(this.display.height-e*2))}}scenery.register("SafariWorkaroundOverlay",SafariWorkaroundOverlay);const CUSTOM_CURSORS={"scenery-grab-pointer":["grab","-moz-grab","-webkit-grab","pointer"],"scenery-grabbing-pointer":["grabbing","-moz-grabbing","-webkit-grabbing","pointer"]};let globalIdCounter=1;const fr=class fr{constructor(e,t){this._refreshSVGEmitter=new Emitter,this._refreshSVGPending=!1,assert&&assert(e,"rootNode is a required parameter");const n=optionize()({width:t&&t.container&&t.container.clientWidth||640,height:t&&t.container&&t.container.clientHeight||480,allowCSSHacks:!0,allowSafariRedrawWorkaround:!1,allowSceneOverflow:!1,allowLayerFitting:!1,forceSVGRefresh:!1,defaultCursor:"default",backgroundColor:null,preserveDrawingBuffer:!1,allowWebGL:!0,accessibility:!0,supportsInteractiveHighlights:!1,interactive:!0,listenToOnlyElement:!1,batchDOMEvents:!1,assumeFullWindow:!1,aggressiveContextRecreation:!0,passiveEvents:platform.safari?!1:null,allowBackingScaleAntialiasing:!0},t);this.id=globalIdCounter++,this._accessible=n.accessibility,this._preserveDrawingBuffer=n.preserveDrawingBuffer,this._allowWebGL=n.allowWebGL,this._allowCSSHacks=n.allowCSSHacks,this._allowSceneOverflow=n.allowSceneOverflow,this._defaultCursor=n.defaultCursor,this.sizeProperty=new TinyProperty(new Dimension2(n.width,n.height)),this._currentSize=new Dimension2(-1,-1),this._rootNode=e,this._rootNode.addRootedDisplay(this),this._rootBackbone=null,this._domElement=n.container?BackboneDrawable$1.repurposeBackboneContainer(n.container):BackboneDrawable$1.createDivBackbone(),this._sharedCanvasInstances={},this._baseInstance=null,this._frameId=0,this._dirtyTransformRoots=[],this._dirtyTransformRootsWithoutPass=[],this._instanceRootsToDispose=[],this._reduceReferencesNeeded=[],this._drawablesToDispose=[],this._drawablesToChangeBlock=[],this._drawablesToUpdateLinks=[],this._changeIntervalsToDispose=[],this._lastCursor=null,this._currentBackgroundCSS=null,this._backgroundColor=null,this._requestAnimationFrameID=0,this._input=null,this._inputListeners=[],this._interactive=n.interactive,this._listenToOnlyElement=n.listenToOnlyElement,this._batchDOMEvents=n.batchDOMEvents,this._assumeFullWindow=n.assumeFullWindow,this._passiveEvents=n.passiveEvents,this._aggressiveContextRecreation=n.aggressiveContextRecreation,this._allowBackingScaleAntialiasing=n.allowBackingScaleAntialiasing,this._allowLayerFitting=n.allowLayerFitting,this._forceSVGRefresh=n.forceSVGRefresh,this._overlays=[],this._pointerOverlay=null,this._pointerAreaOverlay=null,this._hitAreaOverlay=null,this._canvasAreaBoundsOverlay=null,this._fittedBlockBoundsOverlay=null,assert&&(this._isPainting=!1,this._isDisposing=!1,this._isDisposed=!1),this.applyCSSHacks(),this.setBackgroundColor(n.backgroundColor);const r=new AriaLiveAnnouncer$1;if(this.descriptionUtteranceQueue=new UtteranceQueue$1(r,{initialize:this._accessible,featureSpecificAnnouncingControlPropertyName:"descriptionCanAnnounceProperty"}),platform.safari&&n.allowSafariRedrawWorkaround&&this.addOverlay(new SafariWorkaroundOverlay(this)),this.focusManager=new FocusManager,(this._accessible||n.supportsInteractiveHighlights)&&(this._focusRootNode=new Node$2,this._focusOverlay=new HighlightOverlay(this,this._focusRootNode,{pdomFocusHighlightsVisibleProperty:this.focusManager.pdomFocusHighlightsVisibleProperty,interactiveHighlightsVisibleProperty:this.focusManager.interactiveHighlightsVisibleProperty,readingBlockHighlightsVisibleProperty:this.focusManager.readingBlockHighlightsVisibleProperty}),this.addOverlay(this._focusOverlay)),this._accessible){this._rootPDOMInstance=PDOMInstance$1.pool.create(null,this,new Trail),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`Display root instance: ${this._rootPDOMInstance.toString()}`),PDOMTree$1.rebuildInstanceTree(this._rootPDOMInstance),assert&&assert(this._rootPDOMInstance.peer,"Peer should be created from createFromPool"),this._domElement.appendChild(this._rootPDOMInstance.peer.primarySibling);const s=r.ariaLiveContainer;this._domElement.appendChild(s),s.style[Features.userSelect]="none",this._boundHandleFullScreenNavigation=this.handleFullScreenNavigation.bind(this),globalKeyStateTracker$1.keydownEmitter.addListener(this._boundHandleFullScreenNavigation)}}getDOMElement(){return this._domElement}get domElement(){return this.getDOMElement()}updateDisplay(){sceneryLog&&scenery.isLoggingPerformance()&&(this.perfSyncTreeCount=0,this.perfStitchCount=0,this.perfIntervalCount=0,this.perfDrawableBlockChangeCount=0,this.perfDrawableOldIntervalCount=0,this.perfDrawableNewIntervalCount=0),assert&&fr.assertSubtreeDisposed(this._rootNode),sceneryLog&&sceneryLog.Display&&sceneryLog.Display(`updateDisplay frame ${this._frameId}`),sceneryLog&&sceneryLog.Display&&sceneryLog.push();const e=!!this._baseInstance;for(this._input&&this._input.validatePointers(),this._accessible&&this._rootPDOMInstance.peer.updateSubtreePositioning(),this._rootNode.validateWatchedBounds(),assertSlow&&this._accessible&&this._rootPDOMInstance.auditRoot(),assertSlow&&this._rootNode._picker.audit(),this._baseInstance=this._baseInstance||Instance$1.createFromPool(this,new Trail(this._rootNode),!0,!1),this._baseInstance.baseSyncTree(),e&&this.markTransformRootDirty(this._baseInstance,this._baseInstance.isTransformed);this._drawablesToUpdateLinks.length;)this._drawablesToUpdateLinks.pop().updateLinks();for(;this._changeIntervalsToDispose.length;)this._changeIntervalsToDispose.pop().dispose();for(this._rootBackbone=this._rootBackbone||this._baseInstance.groupDrawable,assert&&assert(this._rootBackbone,"We are guaranteed a root backbone as the groupDrawable on the base instance"),assert&&assert(this._rootBackbone===this._baseInstance.groupDrawable,"We don't want the base instance's groupDrawable to change"),assertSlow&&this._rootBackbone.audit(!0,!1,!0),sceneryLog&&sceneryLog.Display&&sceneryLog.Display("drawable block change phase"),sceneryLog&&sceneryLog.Display&&sceneryLog.push();this._drawablesToChangeBlock.length;){const t=this._drawablesToChangeBlock.pop().updateBlock();sceneryLog&&scenery.isLoggingPerformance()&&t&&this.perfDrawableBlockChangeCount++}for(sceneryLog&&sceneryLog.Display&&sceneryLog.pop(),assertSlow&&this._rootBackbone.audit(!1,!1,!0),assertSlow&&this._baseInstance.audit(this._frameId,!1),this.updateDirtyTransformRoots(),this._baseInstance.updateVisibility(!0,!0,!0,!1),assertSlow&&this._baseInstance.auditVisibility(!0),assertSlow&&this._baseInstance.audit(this._frameId,!0),sceneryLog&&sceneryLog.Display&&sceneryLog.Display("instance root disposal phase"),sceneryLog&&sceneryLog.Display&&sceneryLog.push();this._instanceRootsToDispose.length;)this._instanceRootsToDispose.pop().dispose();for(sceneryLog&&sceneryLog.Display&&sceneryLog.pop(),assertSlow&&this._rootNode.auditInstanceSubtreeForDisplay(this),sceneryLog&&sceneryLog.Display&&sceneryLog.Display("drawable disposal phase"),sceneryLog&&sceneryLog.Display&&sceneryLog.push();this._drawablesToDispose.length;)this._drawablesToDispose.pop().dispose();if(sceneryLog&&sceneryLog.Display&&sceneryLog.pop(),assertSlow&&this._baseInstance.audit(this._frameId,!1),assert&&(assert(!this._isPainting,"Display was already updating paint, may have thrown an error on the last update"),this._isPainting=!0),sceneryLog&&sceneryLog.Display&&sceneryLog.Display("repaint phase"),sceneryLog&&sceneryLog.Display&&sceneryLog.push(),this._rootBackbone.update(),sceneryLog&&sceneryLog.Display&&sceneryLog.pop(),assert&&(this._isPainting=!1),assertSlow&&this._rootBackbone.audit(!1,!1,!1),assertSlow&&this._baseInstance.audit(this._frameId,!1),this.updateCursor(),this.updateBackgroundColor(),this.updateSize(),this._overlays.length){let t=this._rootBackbone.lastZIndex;for(let n=0;n<this._overlays.length;n++){const r=this._overlays[n];r.domElement.style.zIndex=""+t++,r.update()}}for(;this._reduceReferencesNeeded.length;)this._reduceReferencesNeeded.pop().reduceReferences();if(this._frameId++,sceneryLog&&scenery.isLoggingPerformance()){const t=`syncTree count: ${this.perfSyncTreeCount}`;this.perfSyncTreeCount>500?sceneryLog.PerfCritical&&sceneryLog.PerfCritical(t):this.perfSyncTreeCount>100?sceneryLog.PerfMajor&&sceneryLog.PerfMajor(t):this.perfSyncTreeCount>20?sceneryLog.PerfMinor&&sceneryLog.PerfMinor(t):this.perfSyncTreeCount>0&&sceneryLog.PerfVerbose&&sceneryLog.PerfVerbose(t);const n=`drawable block changes: ${this.perfDrawableBlockChangeCount} for -${this.perfDrawableOldIntervalCount} +${this.perfDrawableNewIntervalCount}`;this.perfDrawableBlockChangeCount>200?sceneryLog.PerfCritical&&sceneryLog.PerfCritical(n):this.perfDrawableBlockChangeCount>60?sceneryLog.PerfMajor&&sceneryLog.PerfMajor(n):this.perfDrawableBlockChangeCount>10?sceneryLog.PerfMinor&&sceneryLog.PerfMinor(n):this.perfDrawableBlockChangeCount>0&&sceneryLog.PerfVerbose&&sceneryLog.PerfVerbose(n)}PDOMTree$1.auditPDOMDisplays(this.rootNode),(this._forceSVGRefresh||this._refreshSVGPending)&&(this._refreshSVGPending=!1,this.refreshSVG()),sceneryLog&&sceneryLog.Display&&sceneryLog.pop()}getPhetioElementAt(e){const t=this._rootNode.getPhetioMouseHit(e);return t==="phetioNotSelectable"?null:(t&&assert&&assert(t.isPhetioInstrumented(),"a PhetioMouseHit should be instrumented"),t)}updateSize(){let e=!1;this.size.width!==this._currentSize.width&&(e=!0,this._currentSize.width=this.size.width,this._domElement.style.width=`${this.size.width}px`),this.size.height!==this._currentSize.height&&(e=!0,this._currentSize.height=this.size.height,this._domElement.style.height=`${this.size.height}px`),e&&!this._allowSceneOverflow&&(this._domElement.style.clip=`rect(0px,${this.size.width}px,${this.size.height}px,0px)`)}isWebGLAllowed(){return this._allowWebGL}get webglAllowed(){return this.isWebGLAllowed()}getRootNode(){return this._rootNode}get rootNode(){return this.getRootNode()}getRootBackbone(){return assert&&assert(this._rootBackbone),this._rootBackbone}get rootBackbone(){return this.getRootBackbone()}getSize(){return this.sizeProperty.value}get size(){return this.getSize()}getBounds(){return this.size.toBounds()}get bounds(){return this.getBounds()}setSize(e){assert&&assert(e.width%1===0,"Display.width should be an integer"),assert&&assert(e.width>0,"Display.width should be greater than zero"),assert&&assert(e.height%1===0,"Display.height should be an integer"),assert&&assert(e.height>0,"Display.height should be greater than zero"),this.sizeProperty.value=e}setWidthHeight(e,t){this.setSize(new Dimension2(e,t))}getWidth(){return this.size.width}get width(){return this.getWidth()}set width(e){this.setWidth(e)}setWidth(e){return this.getWidth()!==e&&this.setSize(new Dimension2(e,this.getHeight())),this}getHeight(){return this.size.height}get height(){return this.getHeight()}set height(e){this.setHeight(e)}setHeight(e){return this.getHeight()!==e&&this.setSize(new Dimension2(this.getWidth(),e)),this}setBackgroundColor(e){return assert&&assert(e===null||typeof e=="string"||e instanceof Color),this._backgroundColor=e,this}set backgroundColor(e){this.setBackgroundColor(e)}get backgroundColor(){return this.getBackgroundColor()}getBackgroundColor(){return this._backgroundColor}get interactive(){return this._interactive}set interactive(e){this._accessible&&e!==this._interactive&&this._rootPDOMInstance.peer.recursiveDisable(!e),this._interactive=e,!this._interactive&&this._input&&(this._input.interruptPointers(),this._input.clearBatchedEvents(),this._input.removeTemporaryPointers(),this._rootNode.interruptSubtreeInput(),this.interruptInput())}addOverlay(e){this._overlays.push(e),this._domElement.appendChild(e.domElement),e.domElement.setAttribute("aria-hidden","true")}removeOverlay(e){this._domElement.removeChild(e.domElement),this._overlays.splice(_.indexOf(this._overlays,e),1)}getPDOMRootElement(){return this._accessible?this._rootPDOMInstance.peer.primarySibling:null}get pdomRootElement(){return this.getPDOMRootElement()}isAccessible(){return this._accessible}isElementUnderPDOM(e){return this._accessible&&this.pdomRootElement.contains(e)}handleFullScreenNavigation(e){if(assert&&assert(this.pdomRootElement,"There must be a PDOM to support keyboard navigation"),FullScreen$1.isFullScreen()&&KeyboardUtils.isKeyEvent(e,KeyboardUtils.KEY_TAB)){const t=this.pdomRootElement;(e.shiftKey?PDOMUtils$1.getPreviousFocusable(t||void 0):PDOMUtils$1.getNextFocusable(t||void 0))===e.target&&e.preventDefault()}}getUsedRenderersBitmask(){function e(t){let n=0;return _.each(t.blocks,r=>{r instanceof DOMBlock$1&&r.domDrawable instanceof BackboneDrawable$1?n=n|e(r.domDrawable):n=n|r.renderer}),n}return e(this._rootBackbone)&Renderer.bitmaskRendererArea}markTransformRootDirty(e,t){t?this._dirtyTransformRoots.push(e):this._dirtyTransformRootsWithoutPass.push(e)}updateDirtyTransformRoots(){for(sceneryLog&&sceneryLog.transformSystem&&sceneryLog.transformSystem("updateDirtyTransformRoots"),sceneryLog&&sceneryLog.transformSystem&&sceneryLog.push();this._dirtyTransformRoots.length;)this._dirtyTransformRoots.pop().relativeTransform.updateTransformListenersAndCompute(!1,!1,this._frameId,!0);for(;this._dirtyTransformRootsWithoutPass.length;)this._dirtyTransformRootsWithoutPass.pop().relativeTransform.updateTransformListenersAndCompute(!1,!1,this._frameId,!1);sceneryLog&&sceneryLog.transformSystem&&sceneryLog.pop()}markDrawableChangedBlock(e){sceneryLog&&sceneryLog.Display&&sceneryLog.Display(`markDrawableChangedBlock: ${e.toString()}`),this._drawablesToChangeBlock.push(e)}markForReducedReferences(e){assert&&assert(!!e.reduceReferences),this._reduceReferencesNeeded.push(e)}markInstanceRootForDisposal(e){sceneryLog&&sceneryLog.Display&&sceneryLog.Display(`markInstanceRootForDisposal: ${e.toString()}`),this._instanceRootsToDispose.push(e)}markDrawableForDisposal(e){sceneryLog&&sceneryLog.Display&&sceneryLog.Display(`markDrawableForDisposal: ${e.toString()}`),this._drawablesToDispose.push(e)}markDrawableForLinksUpdate(e){this._drawablesToUpdateLinks.push(e)}markChangeIntervalToDispose(e){this._changeIntervalsToDispose.push(e)}updateBackgroundColor(){assert&&assert(this._backgroundColor===null||typeof this._backgroundColor=="string"||this._backgroundColor instanceof Color);const e=this._backgroundColor===null?"":this._backgroundColor.toCSS?this._backgroundColor.toCSS():this._backgroundColor;e!==this._currentBackgroundCSS&&(this._currentBackgroundCSS=e,this._domElement.style.backgroundColor=e)}updateCursor(){if(this._input&&this._input.mouse&&this._input.mouse.point){if(this._input.mouse.cursor){sceneryLog&&sceneryLog.Cursor&&sceneryLog.Cursor(`set on pointer: ${this._input.mouse.cursor}`),this.setSceneCursor(this._input.mouse.cursor);return}const e=this._rootNode.trailUnderPointer(this._input.mouse);if(e)for(let t=e.getCursorCheckIndex();t>=0;t--){const n=e.nodes[t],r=n.getEffectiveCursor();if(r){sceneryLog&&sceneryLog.Cursor&&sceneryLog.Cursor(`${r} on ${n.constructor.name}#${n.id}`),this.setSceneCursor(r);return}}sceneryLog&&sceneryLog.Cursor&&sceneryLog.Cursor(`--- for ${e?e.toString():"(no hit)"}`)}this.setSceneCursor(this._defaultCursor)}setElementCursor(e){this._domElement.style.cursor=e,this._assumeFullWindow&&(document.body.style.cursor=e)}setSceneCursor(e){if(e!==this._lastCursor){this._lastCursor=e;const t=CUSTOM_CURSORS[e];if(t)for(let n=t.length-1;n>=0;n--)this.setElementCursor(t[n]);else this.setElementCursor(e)}}applyCSSHacks(){this._allowSceneOverflow||(this._domElement.style.overflow="hidden"),this._domElement.style.msTouchAction="none",Features.setStyle(this._domElement,Features.fontSmoothing,"antialiased"),this._allowCSSHacks&&(document.onselectstart=()=>!1,document.body.style.msContentZooming="none",Features.setStyle(this._domElement,Features.userDrag,"none"),Features.setStyle(this._domElement,Features.userSelect,"none"),Features.setStyle(this._domElement,Features.touchAction,"none"),Features.setStyle(this._domElement,Features.touchCallout,"none"),Features.setStyle(this._domElement,Features.tapHighlightColor,"rgba(0,0,0,0)"))}canvasDataURL(e){this.canvasSnapshot(t=>{e(t.toDataURL())})}canvasSnapshot(e){const t=document.createElement("canvas");t.width=this.size.width,t.height=this.size.height;const n=t.getContext("2d");this._rootNode.renderToCanvas(t,n,()=>{e(t,n.getImageData(0,0,t.width,t.height))},this.domElement.style.backgroundColor)}setPointerDisplayVisible(e){const t=!!this._pointerOverlay;e!==t&&(e?(this._pointerOverlay=new PointerOverlay(this,this._rootNode),this.addOverlay(this._pointerOverlay)):(this.removeOverlay(this._pointerOverlay),this._pointerOverlay.dispose(),this._pointerOverlay=null))}setPointerAreaDisplayVisible(e){const t=!!this._pointerAreaOverlay;e!==t&&(e?(this._pointerAreaOverlay=new PointerAreaOverlay(this,this._rootNode),this.addOverlay(this._pointerAreaOverlay)):(this.removeOverlay(this._pointerAreaOverlay),this._pointerAreaOverlay.dispose(),this._pointerAreaOverlay=null))}setHitAreaDisplayVisible(e){const t=!!this._hitAreaOverlay;e!==t&&(e?(this._hitAreaOverlay=new HitAreaOverlay(this,this._rootNode),this.addOverlay(this._hitAreaOverlay)):(this.removeOverlay(this._hitAreaOverlay),this._hitAreaOverlay.dispose(),this._hitAreaOverlay=null))}setCanvasNodeBoundsVisible(e){const t=!!this._canvasAreaBoundsOverlay;e!==t&&(e?(this._canvasAreaBoundsOverlay=new CanvasNodeBoundsOverlay(this,this._rootNode),this.addOverlay(this._canvasAreaBoundsOverlay)):(this.removeOverlay(this._canvasAreaBoundsOverlay),this._canvasAreaBoundsOverlay.dispose(),this._canvasAreaBoundsOverlay=null))}setFittedBlockBoundsVisible(e){const t=!!this._fittedBlockBoundsOverlay;e!==t&&(e?(this._fittedBlockBoundsOverlay=new FittedBlockBoundsOverlay(this,this._rootNode),this.addOverlay(this._fittedBlockBoundsOverlay)):(this.removeOverlay(this._fittedBlockBoundsOverlay),this._fittedBlockBoundsOverlay.dispose(),this._fittedBlockBoundsOverlay=null))}resizeOnWindowResize(){const e=()=>{this.setWidthHeight(window.innerWidth,window.innerHeight)};window.addEventListener("resize",e),e()}updateOnRequestAnimationFrame(e){let t=0,n=0;const r=this;(function s(){r._requestAnimationFrameID=window.requestAnimationFrame(s,r._domElement);const a=Date.now();t!==0&&(n=(a-t)/1e3),t=a,stepTimer.emit(n),e&&e(n),r.updateDisplay()})()}cancelUpdateOnRequestAnimationFrame(){window.cancelAnimationFrame(this._requestAnimationFrameID)}initializeEvents(e){assert&&assert(!this._input,"Events cannot be attached twice to a display (for now)");const t=new Input(this,!this._listenToOnlyElement,this._batchDOMEvents,this._assumeFullWindow,this._passiveEvents,e);this._input=t,t.connectListeners()}detachEvents(){assert&&assert(this._input,"detachEvents() should be called only when events are attached"),this._input.disconnectListeners(),this._input=null}addInputListener(e){return assert&&assert(!_.includes(this._inputListeners,e),"Input listener already registered on this Display"),_.includes(this._inputListeners,e)||this._inputListeners.push(e),this}removeInputListener(e){return assert&&assert(_.includes(this._inputListeners,e)),this._inputListeners.splice(_.indexOf(this._inputListeners,e),1),this}hasInputListener(e){for(let t=0;t<this._inputListeners.length;t++)if(this._inputListeners[t]===e)return!0;return!1}getInputListeners(){return this._inputListeners.slice(0)}get inputListeners(){return this.getInputListeners()}interruptInput(){const e=this.inputListeners;for(let t=0;t<e.length;t++){const n=e[t];n.interrupt&&n.interrupt()}return this}interruptPointers(){return this._input&&this._input.interruptPointers(),this}interruptOtherPointers(e=null){var t;return this._input&&this._input.interruptPointers(e||((t=this._input.currentSceneryEvent)==null?void 0:t.pointer)||null),this}ensureNotPainting(){assert&&assert(!this._isPainting,"This should not be run in the call tree of updateDisplay(). If you see this, it is likely that either the last updateDisplay() had a thrown error and it is trying to be run again (in which case, investigate that error), OR code was run/triggered from inside an updateDisplay() that has the potential to cause an infinite loop, e.g. CanvasNode paintCanvas() call manipulating another Node, or a bounds listener that Scenery missed.")}loseWebGLContexts(){(function e(t){t.blocks&&t.blocks.forEach(n=>{const r=n.gl;r&&Utils.loseContext(r);for(let s=n.firstDrawable;s!==null&&(e(s),s!==n.lastDrawable);s=s.nextDrawable);})})(this._rootBackbone)}inspect(){localStorage.scenerySnapshot=JSON.stringify(scenerySerialize(this))}getDebugHTML(){const e="font-weight: bold; font-size: 120%; margin-top: 5px;";let t=0,n="";n+=`<div style="${e}">Display (${this.id}) Summary</div>`,n+=`${this.size.toString()} frame:${this._frameId} input:${!!this._input} cursor:${this._lastCursor}<br/>`;function r(w){let N=1;for(let H=0;H<w.children.length;H++)N+=r(w.children[H]);return N}n+=`Nodes: ${r(this._rootNode)}<br/>`;function s(w){let N=1;for(let H=0;H<w.children.length;H++)N+=s(w.children[H]);return N}n+=this._baseInstance?`Instances: ${s(this._baseInstance)}<br/>`:"";function a(w){let N=1;if(w.blocks)_.each(w.blocks,H=>{N+=a(H)});else if(w.firstDrawable&&w.lastDrawable){for(let H=w.firstDrawable;H!==w.lastDrawable;H=H.nextDrawable)N+=a(H);N+=a(w.lastDrawable)}return N}n+=this._rootBackbone?`Drawables: ${a(this._rootBackbone)}<br/>`:"";const l={};function d(w){const N=w.constructor.name;l[N]?l[N]++:l[N]=1}function c(w){let N=0;w.selfDrawable&&(d(w.selfDrawable),N++),w.groupDrawable&&(d(w.groupDrawable),N++),w.sharedCacheDrawable&&(d(w.sharedCacheDrawable),N++);for(let H=0;H<w.children.length;H++)N+=c(w.children[H]);return N}n+=this._baseInstance?`Retained Drawables: ${c(this._baseInstance)}<br/>`:"";for(const w in l)n+=`&nbsp;&nbsp;&nbsp;&nbsp;${w}: ${l[w]}<br/>`;function y(w){if(!w.firstDrawable||!w.lastDrawable)return"";const N=w.domDrawable&&w.domDrawable.blocks;let H=`<div style="margin-left: ${t*20}px">`;if(H+=w.toString(),N||(H+=` (${w.drawableCount} drawables)`),H+="</div>",t+=1,N)for(let X=0;X<w.domDrawable.blocks.length;X++)H+=y(w.domDrawable.blocks[X]);return t-=1,H}if(this._rootBackbone){n+=`<div style="${e}">Block Summary</div>`;for(let w=0;w<this._rootBackbone.blocks.length;w++)n+=y(this._rootBackbone.blocks[w])}function m(w){let N="";function H(oe){N+=` <span style="color: #008">${oe}</span>`}const X=w.node;N+=w.id,N+=` ${X.constructor.name?X.constructor.name:"?"}`,N+=` <span style="font-weight: ${X.isPainted()?"bold":"normal"}">${X.id}</span>`,N+=X.getDebugHTMLExtras(),X.visible||H("invis"),w.visible||H("I-invis"),w.relativeVisible||H("I-rel-invis"),w.selfVisible||H("I-self-invis"),w.fittability.ancestorsFittable||H("nofit-ancestor"),w.fittability.selfFittable||H("nofit-self"),X.pickable===!0&&H("pickable"),X.pickable===!1&&H("unpickable"),w.trail.isPickable()&&H('<span style="color: #808">hits</span>'),X.getEffectiveCursor()&&H(`effectiveCursor:${X.getEffectiveCursor()}`),X.clipArea&&H("clipArea"),X.mouseArea&&H("mouseArea"),X.touchArea&&H("touchArea"),X.getInputListeners().length&&H("inputListeners"),X.getRenderer()&&H(`renderer:${X.getRenderer()}`),X.isLayerSplit()&&H("layerSplit"),X.opacity<1&&H(`opacity:${X.opacity}`),X.disabledOpacity<1&&H(`disabledOpacity:${X.disabledOpacity}`),X._boundsEventCount>0&&H(`<span style="color: #800">boundsListen:${X._boundsEventCount}:${X._boundsEventSelfCount}</span>`);let ae="";switch(X.transform.getMatrix().type){case Matrix3Type.IDENTITY:ae="";break;case Matrix3Type.TRANSLATION_2D:ae="translated";break;case Matrix3Type.SCALING:ae="scale";break;case Matrix3Type.AFFINE:ae="affine";break;case Matrix3Type.OTHER:ae="other";break;default:throw new Error(`invalid matrix type: ${X.transform.getMatrix().type}`)}return ae&&(N+=` <span style="color: #88f" title="${X.transform.getMatrix().toString().replace(`
`,"&#10;")}">${ae}</span>`),N+=` <span style="color: #888">[Trail ${w.trail.indices.join(".")}]</span>`,N+=` <span style="color: #8c8">${X._rendererSummary.bitmask.toString(16)}${X._rendererBitmask!==Renderer.bitmaskNodeDefault?` (${X._rendererBitmask.toString(16)})`:""}</span>`,N}function O(w){let N=w.toString();return w.visible&&(N=`<strong>${N}</strong>`),w.dirty&&(N+=w.dirty?' <span style="color: #c00;">[x]</span>':""),w.fittable||(N+=w.dirty?' <span style="color: #0c0;">[no-fit]</span>':""),N}function D(w){let N=`<div style="margin-left: ${t*20}px">`;function H(X,ae){N+=` <span style="color: #888">${X}:${O(ae)}</span>`}N+=m(w),w.selfDrawable&&H("self",w.selfDrawable),w.groupDrawable&&H("group",w.groupDrawable),w.sharedCacheDrawable&&H("sharedCache",w.sharedCacheDrawable),N+="</div>",n+=N,t+=1,_.each(w.children,X=>{D(X)}),t-=1}this._baseInstance&&(n+=`<div style="${e}">Root Instance Tree</div>`,D(this._baseInstance)),_.each(this._sharedCanvasInstances,w=>{n+=`<div style="${e}">Shared Canvas Instance Tree</div>`,D(w)});function z(w){let N=`<div style="margin-left: ${t*20}px">`;if(N+=O(w),w.instance?(N+=` <span style="color: #0a0;">(${w.instance.trail.toPathString()})</span>`,N+=`&nbsp;&nbsp;&nbsp;${m(w.instance)}`):w.backboneInstance&&(N+=` <span style="color: #a00;">(${w.backboneInstance.trail.toPathString()})</span>`,N+=`&nbsp;&nbsp;&nbsp;${m(w.backboneInstance)}`),N+="</div>",n+=N,w.blocks)t+=1,_.each(w.blocks,H=>{z(H)}),t-=1;else if(w.firstDrawable&&w.lastDrawable){t+=1;for(let H=w.firstDrawable;H!==w.lastDrawable;H=H.nextDrawable)z(H);z(w.lastDrawable),t-=1}}return this._rootBackbone&&(n+='<div style="font-weight: bold;">Root Drawable Tree</div>',z(this._rootBackbone)),n}getDebugURI(){return`data:text/html;charset=utf-8,${encodeURIComponent(`<!DOCTYPE html><html lang="en"><head><title>Scenery Debug Snapshot</title></head><body style="font-size: 12px;">${this.getDebugHTML()}</body></html>`)}`}popupDebug(){window.open(this.getDebugURI())}iframeDebug(){const e=document.createElement("iframe");e.width=""+window.innerWidth,e.height=""+window.innerHeight,e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.zIndex="10000",document.body.appendChild(e),e.contentWindow.document.open(),e.contentWindow.document.write(this.getDebugHTML()),e.contentWindow.document.close(),e.contentWindow.document.body.style.background="white";const t=document.createElement("button");t.style.position="absolute",t.style.top="0",t.style.right="0",t.style.zIndex="10001",document.body.appendChild(t),t.textContent="close",["pointerdown","click","touchdown"].forEach(n=>{t.addEventListener(n,()=>{document.body.removeChild(e),document.body.removeChild(t)},!0)})}getPDOMDebugHTML(){let e="";const t="font-weight: bold; font-size: 120%; margin-top: 5px;",n="&nbsp;&nbsp;&nbsp;&nbsp;";e+=`<div style="${t}">Accessible Instances</div><br>`,r(this._rootPDOMInstance,"");function r(d,c){e+=`${c+escapeHTML(`${d.isRootInstance?"":d.node.tagName} ${d.toString()}`)}<br>`,d.children.forEach(y=>{r(y,c+n)})}e+=`<br><div style="${t}">Parallel DOM</div><br>`;let s=this._rootPDOMInstance.peer.primarySibling.outerHTML;s=s.replace(/></g,`>
<`);const a=s.split(`
`);let l="";for(let d=0;d<a.length;d++){const c=a[d],y=c.startsWith("</");y&&(l=l.slice(n.length)),e+=`${l+escapeHTML(c)}<br>`,y||(l+=n)}return e}foreignObjectRasterization(e){const t={};let n=0;function r(z){z.id||(z.id=`unknown-canvas-${n++}`),t[z.id]=z.toDataURL()}function s(z){if(z instanceof BackboneDrawable$1)_.each(z.blocks,w=>{s(w)});else if(z instanceof Block$1&&z.firstDrawable&&z.lastDrawable){for(let w=z.firstDrawable;w!==z.lastDrawable;w=w.nextDrawable)s(w);s(z.lastDrawable),(z instanceof CanvasBlock$1||z instanceof WebGLBlock$1)&&z.canvas&&z.canvas instanceof window.HTMLCanvasElement&&r(z.canvas)}DOMDrawable$1&&z instanceof DOMDrawable$1&&(z.domElement instanceof window.HTMLCanvasElement&&r(z.domElement),Array.prototype.forEach.call(z.domElement.getElementsByTagName("canvas"),w=>{r(w)}))}s(this._rootBackbone);const a=document.implementation.createHTMLDocument("");a.documentElement.innerHTML=this.domElement.outerHTML,a.documentElement.setAttribute("xmlns",a.documentElement.namespaceURI),a.documentElement.appendChild(document.createElement("style")).innerHTML=`.${PDOMSiblingStyle$1.ROOT_CLASS_NAME} { display:none; } `;let l=a.documentElement.getElementsByTagName("canvas");l=Array.prototype.slice.call(l);for(let z=0;z<l.length;z++){const w=l[z],N=w.style.cssText,H=a.createElement("img"),X=t[w.id];assert&&assert(X,"Must have missed a toDataURL() on a Canvas"),H.src=X,H.setAttribute("style",N),w.parentNode.replaceChild(H,w)}const d=this.width,c=this.height,y=()=>{fr.elementToSVGDataURL(a.documentElement,d,c,e)};let m=0,O=!1;const D=Array.prototype.slice.call(a.documentElement.getElementsByTagName("image"));for(let z=0;z<D.length;z++){const w=D[z],N=w.getAttribute("xlink:href");N.slice(0,5)!=="data:"&&(m++,O=!0,(()=>{const H=new window.Image,X=w;H.onload=()=>{const ae=document.createElement("canvas");ae.width=H.width,ae.height=H.height,ae.getContext("2d").drawImage(H,0,0),X.setAttribute("xlink:href",ae.toDataURL()),--m===0&&y(),assert&&assert(m>=0)},H.onerror=()=>{--m===0&&y(),assert&&assert(m>=0)},H.src=N})())}O||y()}popupRasterization(){this.foreignObjectRasterization(e=>{e&&window.open(e)})}getTrailFromPDOMIndicesString(e){if(!this._rootPDOMInstance)return null;let t=this._rootPDOMInstance;const n=e.split(PDOMUtils$1.PDOM_UNIQUE_ID_SEPARATOR);for(let r=0;r<n.length;r++){const s=Number(n[r]);if(t=t.children[s],!t)return null}return t&&t.trail?t.trail:null}refreshSVG(){this._refreshSVGEmitter.emit()}refreshSVGOnNextFrame(){this._refreshSVGPending=!0}dispose(){assert&&(assert(!this._isDisposing),assert(!this._isDisposed),this._isDisposing=!0),this._input&&this.detachEvents(),this._rootNode.removeRootedDisplay(this),this._accessible&&(assert&&assert(this._boundHandleFullScreenNavigation,"_boundHandleFullScreenNavigation was not added to the keyStateTracker"),globalKeyStateTracker$1.keydownEmitter.removeListener(this._boundHandleFullScreenNavigation),this._rootPDOMInstance.dispose()),this._focusOverlay&&this._focusOverlay.dispose(),this.sizeProperty.dispose(),this._baseInstance&&this._baseInstance.dispose(),this.descriptionUtteranceQueue.dispose(),this.focusManager&&this.focusManager.dispose(),assert&&(this._isDisposing=!1,this._isDisposed=!0)}static elementToSVGDataURL(e,t,n,r){const s=document.createElement("canvas"),a=s.getContext("2d");s.width=t,s.height=n;const l=new window.XMLSerializer().serializeToString(e),d=`<svg xmlns="http://www.w3.org/2000/svg" width="${t}" height="${n}"><foreignObject width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml">${l}</div></foreignObject></svg>`,c=new window.Image;c.onload=()=>{a.drawImage(c,0,0),r(s.toDataURL())},c.onerror=()=>{r(null)};const y=new window.TextEncoderLite("utf-8").encode(d),m=window.fromByteArray(y);c.src=`data:image/svg+xml;base64,${m}`}static assertSubtreeDisposed(e){if(assert&&assert(!e.isDisposed,"Disposed nodes should not be included in a scene graph to display."),assert)for(let t=0;t<e.children.length;t++)fr.assertSubtreeDisposed(e.children[t])}static addInputListener(e){assert&&assert(!_.includes(fr.inputListeners,e),"Input listener already registered"),_.includes(fr.inputListeners,e)||fr.inputListeners.push(e)}static removeInputListener(e){assert&&assert(_.includes(fr.inputListeners,e)),fr.inputListeners.splice(_.indexOf(fr.inputListeners,e),1)}static interruptInput(){const e=fr.inputListeners.slice(0);for(let t=0;t<e.length;t++){const n=e[t];n.interrupt&&n.interrupt()}}};fr.INTERRUPT_OTHER_POINTERS=e=>{var t,n;(n=(t=phet==null?void 0:phet.joist)==null?void 0:t.display)==null||n.interruptOtherPointers(e==null?void 0:e.pointer)};let Display=fr;scenery.register("Display",Display);Display.userGestureEmitter=new Emitter;Display.inputListeners=[];const map={};let index=0;function moveForward(o){o._parents.forEach(e=>moveChild(e,o,1))}function moveBackward(o){o._parents.forEach(e=>moveChild(e,o,-1))}function unlinkIndex(o){const e=map[o];assert&&assert(this.parents.length===1,"IndexedNodeIO only supports nodes with a single parent"),this.parents[0].childrenChangedEmitter.removeListener(e),delete map[o]}function moveChild(o,e,t){let r=o.indexOfChild(e)+t;for(;r>0&&r<o.children.length&&!o.children[r].visible;)r+=t;r>=0&&r<o.children.length&&o.moveChildToIndex(e,r),o.onIndexedNodeIOChildMoved&&o.onIndexedNodeIOChildMoved(e)}const IndexedNodeIO=new IOType("IndexedNodeIO",{valueType:Node$2,documentation:"Node that can be moved forward/back by index, which specifies z-order and/or layout order",supertype:Node$2.NodeIO,toStateObject:o=>{const e={index:null};return o.parents[0]&&(assert&&assert(o.parents.length===1,"IndexedNodeIO only supports nodes with a single parent"),e.index=o.parents[0].indexOfChild(o)),e},applyState:(o,e)=>{const t=o.parents[0];if(t&&e.index){assert&&assert(o.parents.length===1,"IndexedNodeIO only supports nodes with a single parent");const n=t.children,r=t.indexOfChild(o);n[r]=n[e.index],n[e.index]=o,t.setChildren(n)}},stateSchema:{index:NullableIO(NumberIO)},methods:{linkIndex:{returnType:NumberIO,parameterTypes:[FunctionIO(VoidIO,[NumberIO])],documentation:"Following the PropertyIO.link pattern, subscribe for notifications when the index in the parent changes, and receive a callback with the current value.  The return value is a numeric ID for use with clearLinkIndex.",implementation:function(o){const e=()=>{assert&&assert(this.parents.length===1,"IndexedNodeIO only supports nodes with a single parent");const n=this.parents[0].indexOfChild(this);o(n)};assert&&assert(this.parents.length===1,"IndexedNodeIO only supports nodes with a single parent"),this.parents[0].childrenChangedEmitter.addListener(e),e();const t=index;return map[t]=e,index++,t}},unlinkIndex:{returnType:VoidIO,parameterTypes:[NumberIO],documentation:"Unlink a listener that has been added using linkIndex, by its numerical ID (like setTimeout/clearTimeout)",implementation:unlinkIndex},clearLinkIndex:{returnType:VoidIO,parameterTypes:[NumberIO],documentation:'Deprecated, see "unlinkIndex".',implementation:function(o){assert&&deprecationWarning("clearLinkIndex is deprecated, use unlinkIndex instead.",!0),unlinkIndex.call(this,o)}},moveForward:{returnType:VoidIO,parameterTypes:[],implementation:function(){return moveForward(this)},documentation:"Move this Node one index forward in each of its parents, skipping invisible Nodes. If the Node is already at the front, this is a no-op."},moveBackward:{returnType:VoidIO,parameterTypes:[],implementation:function(){return moveBackward(this)},documentation:"Move this Node one index backward in each of its parents, skipping invisible Nodes. If the Node is already at the back, this is a no-op."}}});scenery.register("IndexedNodeIO",IndexedNodeIO);class PhetioControlledVisibilityProperty extends DerivedProperty{constructor(e,t,n){n=merge({nodeTandem:Tandem.REQUIRED},n);const r=new BooleanProperty(!0,{tandem:n.nodeTandem.createTandem("visibleProperty")});super([r,...e],(s,...a)=>s&&t(...a))}}scenery.register("PhetioControlledVisibilityProperty",PhetioControlledVisibilityProperty);const SlitherQueryParameters=QueryStringMachine.getAll({p:{type:"string",defaultValue:""},debugScan:{type:"flag"},debugSleep:{type:"flag"},debugColors:{type:"flag"},showPointerAreas:{type:"flag"}});class LocalStorageProperty extends Property{constructor(e,t){super(t.deserialize(localStorage.getItem(e))),this.link(n=>{const r=t.serialize(n),s=n===t.deserialize(null),a=localStorage.getItem(e);s?a!==null&&localStorage.removeItem(e):a!==r&&localStorage.setItem(e,t.serialize(n))})}}class LocalStorageBooleanProperty extends LocalStorageProperty{constructor(e,t){super(e,{serialize:n=>n.toString(),deserialize:n=>n==="true"||n==="false"?n==="true":t})}}class LocalStorageNumberProperty extends LocalStorageProperty{constructor(e,t){super(e,{serialize:n=>n.toString(),deserialize:n=>n===null?t:parseFloat(n)})}}class LocalStorageEnumerationProperty extends LocalStorageProperty{constructor(e,t){super(e,{serialize:n=>n.name,deserialize:n=>n&&t.enumeration.getValue(n)||t})}}class LocalStorageStringProperty extends LocalStorageProperty{constructor(e,t){super(e,{serialize:n=>n,deserialize:n=>n||t})}}const La=class La{static registerDataURL(e,t,n){if(phet.chipper.queryParameters.binder){const r=`${e}/${t}`;La.componentMap[r]=La.componentMap[r]||[];try{n.toDataURL(s=>{La.componentMap[r].push(s)})}catch{}}}static registerToolbox(e){phet.chipper.queryParameters.binder&&La.registerDataURL("sun","ToolboxPattern",e)}};La.componentMap={};let InstanceRegistry=La;phetCore.register("InstanceRegistry",InstanceRegistry);const sun=new Namespace("sun"),base64SoundToByteArray=(o,e)=>{const t=e.replace(new RegExp("^.*,"),""),n=atob(t),r=new Uint8Array(n.length);for(let s=0;s<r.length;s++)r[s]=n.charCodeAt(s);return r},tambo=new Namespace("tambo");class WrappedAudioBuffer{constructor(){this.audioBufferProperty=new TinyProperty(null),assert&&this.audioBufferProperty.lazyLink((e,t)=>{assert&&assert(t===null&&e!==null,"The audio buffer can only be set once")})}}tambo.register("WrappedAudioBuffer",WrappedAudioBuffer);let phetAudioContext;window.AudioContext?phetAudioContext=new window.AudioContext:window.webkitAudioContext?phetAudioContext=new window.webkitAudioContext:(phetAudioContext={},console.error("error: this browser does not support Web Audio"));tambo.register("phetAudioContext",phetAudioContext);const phetAudioContext$1=phetAudioContext,soundURI$g="data:audio/mpeg;base64,//swxAAAA8ADNZQRgDGHni23MIAC1bbaiNgdgM+wEHBiogUAbxA4MT+////gh//8Mf4YzNI0kYiNYjDZaLJCYAZZgbhKQTNx5Vp34WpSu/bhLvzLYwWSHokUhx0EBR4FA/Mp8sOz3gcWfL9YqH7kKIkzd9fLvSkB201St7337UyHKf7X9Pf//Ue9/6irjy/l3s5gqCo1lPVlVSBj//syxAOACFB7hZyUgDEUCu008ZpKfZq0pMq3UhCDwXYfD+n5X+IUp5YiEYMB0CgRCwfQF0AmAUjAlZVJuE4ZaTbKK0AIJCxUAwrWLf////l1oFP9Yo2m1QI89G8bsISUXc8TjPs5pDlVUzUq1VJLFYcIlvdQS0P1lohZFx5hFpVDCPaSKlRsdgIslDzfeqxt8iVd+v6aClA3ydRso//7MsQDgAhYV13sGEqhEJFpcZMJqE0gGS8ZU3ekWmMRbO4kqZnMgAHAFiPmBRdQFgRZHZrTNwZcRTYLKU4qxy3ieKohBwSNif5UwYc4W/ywiEYAtIWoggTByJ+YPcFxgdYE5MVlD41ZJSYBdPF8gQIZtZPy/cZWxBR5Bm7WwZdGkolTRTQXLpSOcoUvf3in/dyBZwzRXAF3ieJEAxD/+zLEBAAIkJlXlYaAARIWb3MegACpLHqwdgk0mfJ913UT0LiL5W+nIh+DsKATQJ4F0E4PF8c7FxaaaCZ80SpqZbfX7J/99fN0p/Onf+zSaVmKSAKAgKAgMAAAAAEBCVMt4sfsyRdHO3PTH0SBFi4jhEgNBinEXeeDSKeby9zBMKun3/pKZ6L//H/6T/p/82bkkAyj/5m7WOWuRFpI//swxAOACDgvi7zDADEQkW289AoWMABHxkZCUEwfjodDiYmpiWw9NWjIAhJEFkFSo4GnxwiDsrBoGn/g0DT64Kgq9BUFQWBo3WFDf4B//ljZRUwaFSyREkApYqDmkM8qYgtylZx9ZL7knEF4rFKLgqfa4GHahJbD5q+ZdeybNpd1LOzqJVWdmJgs9uNUoK61I9Pf1runDP5da2kA//syxAQACHita6eYTzEMFSdkzAigHGL2uEMDLL6xtFmUuujunUP9ODzjFKbt2J5yt77uOmiJWXQ6GAbIjvu17WVn/dDEccwhLJLW6dXU/dcsEAvP8BAST22Qg8WJEX2Cxxs84/BnOt15rGZwVs2FEtKWVPRHZitdbuySkumtHlb0M/U5QwcQRYSLI91T/epbUqPPogEGy4Ldq0ABj//7MsQEgAfcrTesFG1owIRiqMyYmD9U8MBcisSsURTFgBykNZkSUjL+oDB8VGCT310AYfb2ZlVRgEvbASNp8ptD8y7lYYlvxtFsCgAAYAQABAzjzrwIrmT2cuLIZOOOhHHQELC2rOtlix709VXnYiej4dx2rz2Vd/xL6QQAAHCikADAVHicCJrfesiRcXCNaoKuuneW+r1dXxFDvZf/+zLEEQBFcCEJoLHi8JuFVvDMGGz/vqeWI50KHuGnJHLWAAQIl4qgkpSn8oGq1rUCoSk3UAhEYtCgKWWwwIDo////4sLVTEFNRTMuOTkuNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",soundByteArray$g=base64SoundToByteArray(phetAudioContext$1,soundURI$g),unlock$g=asyncLoader.createLock(soundURI$g),wrappedAudioBuffer$g=new WrappedAudioBuffer;let unlocked$g=!1;const safeUnlock$g=()=>{unlocked$g||(unlock$g(),unlocked$g=!0)},onDecodeSuccess$g=o=>{wrappedAudioBuffer$g.audioBufferProperty.value===null&&(wrappedAudioBuffer$g.audioBufferProperty.set(o),safeUnlock$g())},onDecodeError$g=o=>{console.warn("decode of audio data failed, using stubbed sound, error: "+o),wrappedAudioBuffer$g.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$g()},decodePromise$g=phetAudioContext$1.decodeAudioData(soundByteArray$g.buffer,onDecodeSuccess$g,onDecodeError$g);decodePromise$g&&decodePromise$g.then(o=>{wrappedAudioBuffer$g.audioBufferProperty.value===null&&(wrappedAudioBuffer$g.audioBufferProperty.set(o),safeUnlock$g())}).catch(o=>{console.warn("promise rejection caught for audio decode, error = "+o),safeUnlock$g()});const soundURI$f="data:audio/mpeg;base64,//twxAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAAvAAA6xgAFBQoKEBAVFRsbICAmJisrKzExNjY7O0FBRkZMTFFRV1dXXFxiYmdnbGxycnd3fX2CgoKIiI2Nk5OYmJ2do6OoqK6urrOzubm+vsTEycnOztTU2dnZ39/k5Orq7+/19fr6//8AAAA5TEFNRTMuOTlyAc0AAAAAAAAAABRgJAW0QgAAYAAAOsbaTGT/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/7cMQAAA7dBSqUMwACca6u+zCwACApgAAXXczyPLdxZhAGAydwQABDIj/xEZEREf+Lu7u7/u7ve0Rd3etERv//7EAGAydsYQhyCEf3va73/vdxEREREE78RGRBMmnYPg+DgIHC5QH3rB/EAIHCCgQBAoCDsEFAgCBQ5BAMS4P8Hwff8Tg+/Ln/wfw/dtCpCmhkRCphx5RJJZZeBkRuhKWvyydbusLOy2X0io3WgGaNyeDJBmxPyYwBMkkASVLJiZ9hJJ6AbpW4kk99nJJYE5sSUUDSD0v2Uxg7HWSUR3HErRtlPe9nmg/mKDjSLtiEPSe+7iuGG73WurKU76Uc2rl97P/53S1Zi7F7bTdrqiJq7Yyv/6/4uDVj3sbtRSKhqLrLWf///+W7VaNBODMAAAAAhEmcl8uCdsv/+3LECACSeTVr3PYAAgosbbjzDui0GmTRO96xrR6OSGLxYWzCh0mEDaIBVQ1xdHw5aTTq1RBj58yvaK7kDNUcale1G/E8611+6daha6+Nuve72X/mq1vX4PrMdWcrz6xDa5mtWNdU7m/T6NNo///rm27+dT9a+Zkd6fT/g32p4lBxRRZUUEZkSpCIsNCAtctr9kCSmrzv/66lVQ1EAAAYJYBOUKeF2LY8JcplQlohfTxvMumyOzxtvJFI2I1iV/2+b7RFSrZTO6aJ5MkgHPUtQkCaHAveIIOrPtb93Iau5+y1NzYL9Qj73xM3UbSGUWHvsqfnJ4icIKCqmRkXHi7Fv5s+RbK+5lfBfsWpgmsPoMiQNQhUGq3ftfu6lZEQCAAdhIBYSUm4Mg3UkuGF41iEbgUdPDc0Got2R//7cMQPANKRa2aHsMvSTarsuPYZuF8aBIK5DNG4yVq00SKu45iMbvD0hnRdGZTLhUOlQUHEQxZI0nUJm0eSI9baV9KuyiRjoJrc+33zekx8HOlcjZN4SRow5KvReT0TCBrN5PBctW1DG1BO3JGo6UyE3L+XmU8bx+21n2sOs5ISgSu9fP1RoRMsZ77pdCNCIABRCfq0cp2mW1JA00GjDcnVzET1hxp6vWITR2PwVqBRd95y4yfxk4HlFxmuHsEjwSERbPSaPrt1rjJUq8jTztuqiMIVvokgVZPpldExIjDdS9MOF3tn6v8gSijYMhZdMloS84Dyk4Lsoac1AqaTR5XfbyTuuj6NOqzp1t9l4VzLVkgtFz8qLkpm8bfVkTwqWRSIAENhDHdSKh8TFYPi2SliEOJphuJA5jj/+3LEDQDTVTNihj00Sj4o7Hj2GbhRwjFogi0oCEEKpXkDQ1XO4UdTsldrplPYETbDxQUMN2RoQRERZZJQlaICdRovjetIl4a1AypaO64eFzYtvYbaiI8RsJrwhKL8V0lctGLEIJwUhc2no1E10MGWlobJRcTJOnBVN9RTe8x5xQY8gEhGeivAD9Kj2clnP0/r/o7f29wRGQgQABBRd4DWoKRz9PqW7bVVK8wKpJGy86YXjydIg7IaYyTkMnA2HwkDgymWHRgeURnDAzUiQpfWJbqrP1doW7Dr9JpEmgU3ufBglsjOYkLEluXfsxgU5RIm/ko4vtOUFPCpwXcpak5aDGo/HwkcpnNSBxyquxpaphphuZesaERW8FTYmOECqEVujZJWxNWpYjUiAAAAABXCElsN96SxSHuec//7cMQKANBlN2XHsMvKbSrr0PSbWKeMk7RApAVSWnGtss2qvAuSCo2gVOx7aTWgRwdC5Q5XKyMtVNm2IZy4mpVmLH7NfyhaRF/heeJh3pNkpMM/k7aMTihApGZc84qJyHSjTrYzLy6ivnLwz22bTM7drVPZtI9MRR3bZ+9w9Ltel/97bnYuNAAL8LFCONVLkcZinWN2qQORCmlQaUCJT9lzChDkF0X1hSqptOVIxmM7Ucp0/MfyWQlmdLghBKmIp2aFZWM5lgbPoUhg7qxmN4ISJCKXSnqNpc0uRnPprEOYXgy87ih5UlaYQL6pqaJsUsnzp5QwpzOkSOOOTWFwVqakTZwqdaj2KXRFTV0GKh7T2vvbe5QVFDwHXHqlajd9StYlCSAANRqSAJBoRRGHkjA6TxyIA+vliCT/+3LEDICQrSthZhh6yjIkbDj2DmFDE0z2x0vQCQoOhJx8rFAdFDZ2vbJInVXPpSeDcrLjyPC8sAiemDcKFpMhF92taG4+42EiJE1ZhgSicTrsjfS9/CvbIyoCrYmm3DfNNQ5WB0Q10HLJAbJkFwxC0Fu297fNssCm8QbOdO/tV193CKZmBAABKAVIlF5gMAgpbT/O44z8TDeq2eC+HqA1C7E7YpD9EOHZWJJIXXwqFJafKkaZZdeUkUBCEIBI+mpPYiwjK2c+A8hbbZ0dDQQHEkFHoymLa2AxYcIEUMoBuw5KalXDCLHkaBMydjxmN66RnpVdXDBxME0gEChkjzuO1DfKKlQPTu/9v+13e7u5VEUxAAAABwSD4UiRyLeZiLMih9sA4dhKdcRRCU8+ndKQ1pBGhsvHg3XLlP/7cMQWAI6I0WXHsGvJ8J1sOPYNufuFPYo0x0kMlqhDiah7AJAjhyh6wSZ9Q0zW4Fmbk5MFHDKCNKlXyosaC+UZEVWjIBeXysepCx8o6Hnlw99Pcn/nX7xI527e12HMSMQAAAZLEqHHAhktVh7RELbDJhIhuNWyQT1CWJsxIgkxgwokafXGxUcZiPnYTBebWTDm1GtWn8BaUuo1jFYMPL70cz7M6bZigguUndXaEhoGsIBrC6rofIZiBDspucY46sX9muDoPBsWHSspVvxWp8tep+vi/Pr/m/+qqFZFYiAAAAAFC7hekzJyZZ3DPXJLYJ3K6EgEKRDJAQqAAJ2tQkaMlJ9g2bWUVh9pkiZPrkJGOEC3SpVdVtOL2GV3u3WQKxUQ9pnsyKV0M7o+w7uitfchFc62amXq9jP/+3LEL4COtVtl56RNwc+c7Dj2DXiqImdumXoN5G0qdM1vGNpcQB6SK3stfTuhmYAAAPYxDlISOM0FaYScQ9cogwD5parHpabmJ02cKWFaxEmHzXEWQt1XXoQrr0x03A6yYQuPFiCooDQoADMSKNeSiBcJiFTW14plS3IQzZZ+zGUNiJQcVUyQHrrYTEJwCgUMtvaA5BZxkUNHiDpl1/7aiHJDMQAAAAd0PM3hxAzRwnszI9aOm6rP1Cz4kVEYDTgqjaIxSeFa6JUTE6ZAduaEgJFEQuoH1BUmWcgLonJImk1UGSej060BEKzkSvd3FAAcKYvbC5EajkYJHJt4WhjhkSOtLMnpG+e25jF+2IKxowYeXkTMqCiBRrK62W9MqhmKAAAlC7K4mQvz7bDlZi3uLyY4Cd+ileIl4//7cMRNAM+1J1/HpG3B9CRruPYOKDIUIfKFNyE20aoQMRidQ1TMr1HkdQpAaPaAfR1PmVh0sVsqnUJ9E3dkSwIE7XIhHBDikLgQfUa4kGkJQI4T07WgYkhdNcrlx3ztI6+nclBGyChIsak0m6ooFiykFiMdR02XdDUkEAAAABeVhMT4Q4vBoI4zFeh5yKRRoxZKlFZsZV+6GOTYUBUxsbq1Y/JbetkNqurITwvQn7unrGKo455/2ob/hWM6m/K2g7uR0dnbOk2v8RIzo+5ZUvPe/S9PekVx4v+JhTFxvHYyLuI6bRf3RXMd8HLtv/2qZFQxEAAAOCSHcYCfVg9RYz3cy9lxVSZfsYrcVNAqJH2eCC4rDI4HlSx8aLoAxpoicsqREoYYPB4FugaOFJwZcsVvFP1FeGEMm4T/+3LEYYCPESNh57BtyeElq7z0jbmgrq+MIEqRqRSYi0mPhTPRjNVrXp8LJ+SQ8uW7/DMGDumQ+rrzR3ryX3O92v+RqUY0MwAAAAAXTpGONc3KF+OsOo/FKbx/CSJZsYlI6vpgfMqj4UJDFS9C8Q05xZm37dchmZyevLGlS+Yo6iReBS3DRDRkkBm3NIU8lPqUlznCtWw5w498j/rVjQodLFEpY1rC7gWEYiNlrmpnowi9zVTjPdR42UgAACocAoQwUWABDmfHKCVTQThKTl+iZsqrjmg4BabHZYSJEZZOmEq84Q0z7rCMJCwVIgoYBKhkXK2JiFtvV10kLS9eIdhiKnBNcLuLLowUygguW4sUxbD+VRDovWHHNhlL4Svqcj+ywIECwcC0ofQAkOe4oFBcAXFFrV6V3UgAAP/7cMR7gI6FC1/nsGvB+aSrNMSPCAAAACh+NZyMh+4OMvxbieLOobGtP3q+cbgq0+jm4oFc/aijNyMkGkdgNjokoSXTQ5hQyfUbgoRR+Tp3iWggNLiOswIR29Sco88ct9tesg2pEnxe5uFkt0rIjthHI7d5ffJGfpThc2KGVrJKHCa4Mh0gwadW0Ox2ZoSKdWiFIgAQAAAYYh+qQy04eTISpHduURoTsCseKRCxwOaNwnB3iTifm6Xpf0imclarQ2DoNG8EwhEVgqiMCIQkoTNBBkEonHkC0Jrn4QYWJ1nj0dUbWnFWP1q1zMbapdrVZxU0cjdpCeN5nbFOAudL+0i28rLiM3xqRC9deil6Vf5KkQAAAACqQFnRAnqCJiqy4G8eStQLU9OvMh+TI9hdvWQsZbRmEgcUdZP/+3LElACQAPNXp7DUgfEl6rj0juC4ZUW9LDp0h8wMzLz4SBJfRFw/LqZGl9PZhl15roRZOEmRzzRiqcGgOhSG7TFjGAELhQhp+wZO8opy+7Wf24GvfjvoN+j1NaDpKN6//W/krZAABdHpTpuiQp4hyKKihY2M6WQ3k1ROKM4TDhIyM2uZ1PDFYXaMoxKgfKwxORaRDBIOhQUDJVEDRWOChN7MkK8zk1KZiogKKBMFJ+MIkWHqAsFBaK78t0i8H81vTiNZlGLJTvGfdfXMaGYnd/x37uRfFW83arGaiQAAAAC8JgjCkghYAksA1BQODEenTYS1r4kkIWLzMxtUrFcFyUZDq4PJAsKmDQDOOCQyLlAkCpKZGCY4cHk1Dg+vZ5BsG2LQSyiQEtVdwKBnEA6pOJxxDZkLBcafFf/7cMSoAI8Qz1ensHTJ25rq9PSO0Uk1gFwouoNGCTmqoD8Exh5BdIsR+tygKKJMlXsjtLwikYAcLEd50jhPsnhNEWtnicDOl3E00+hhw4LopmBzOCEc6qG0zzSm6XpLQh4UTPImEJg8MS0hkkKR0Ulcw9cTASAOqjSRJExf3ErpIpmVeRkSbBRmOTz1B2M5oqAWLFA4SYYQ4DaH89IgQXFwkLIBc3HI6rs00gAAAAFOryeKsnirMxGiek0Ql+fUU7FMysiRcyoJqtNypOEXRXjaQtGNsK0hPGEbgllldVShrGD8qB6fLMb+EcGMGHcHAJ2IBQGqS0sEKFgJhGHxSCLmYs2LSlDez/YymmTqRfRDVX58Kg5d6wWY7kR6RY6aLNNZQCiMioe5H7en/mQAS40Er5PinS6cC+P/+3LEwgGPxMVVpiR2gdOZKnz2GsjhwQ9MHYTgvoKnBCyD502kiySOjElIzEpLlvLTxZaBCW4hOPpvJoTBPoopYxFwkOdaciroWFLOf58cz0FjdWNPysc1jQy8uzLnn/9SNtnAuGnBMyre8AHTUOgHRUAAC6DiPU6U+1dRIOOCnAaJaRbhAAuoMUTel4QUIkl4pqyNe9RhhpYl4HnQLUuSeQVGlAo5CQmK3FoKltViaMi7CawAUYhAg4FamyWCOQUNLYoPGWr5qSQWFRqPLvbxSxPmRR6Nny3nOliflHGcEYni+kGEMY6kFXZ8IFeP9NDlc0Y8O9tcTsYSyIRwJGk86QER2vD08MQ9KCZdCZPGDaSKA/cu9pYXYj9bXIENI6y9o4NPcU1iT3vmnIuax/nDff/Po1CgAAry5P/7cMTbAJBZK1OnsHSBp6arKPSNskz4ribKE6ihPw63Iv44UDcDMAJFkHTodUNEPAdCCbH50wVBaJoHS6tfNnj1QwWUg7A4TlBdKa094m+FF4hwIGpCllgVzyXPfB/5xRSkgdVnKd35HakP2fGdZHTctg71l8rn8QHbWwgrOVyO/mQzDerZKjQAAAAAABM9eRVBLx50xGtp3TKVDI5x3aRYRjdHLxkQ6ICkXWpFfS83aaYkikisVazNFb3+T9SeYk01sVmnYc/Jc9RpTJTRfiQK8F7wNDliTLEd2zMe66+3khD800PDu2DqgnE4ycaSkIRSUHA9PH/+qo82UlLxSue6k1BNMJySA2DFwYqAV9OY/77LTLIEAYVNAFhCNInLT1ie1//TqiUwAAFMQUuSCKk8WxHHMlUNUCP/+3LE9oCYMSE8rD2cSeKlKjT2DXksr0uY1l5Dz6NBANsQpUAN8fr5lTLY1OBf09EiLl4uVhxNNYfvSCqBIKNrnq/4UYB7IujT5ZFm1GS1L5p+JJG8aNPztXsM7lPi8zk+CXkED1sET0MFJSmKR0VsV1RW0AAAAAAAxaiRbws7h9PRJNE5IRMZrqdLSwqNCY7zsMbSSXAh4rAk3DgLk4KW6KNCACLvjpapUKQ8nSpqyBSpAFFF5JeoRL6XWXiStXwEFL01GXJmq3rzi0qcR+4BXPEbbt4qh+C0xFAfjkpMk5mcmYvkJQ8iMCcoAYMmSIRjAhWOLCcvbB9hzl5wlNWXKkZEWxmWtW05TbXxJ39x2XvHRyW00uTSNKMgRMGBIWhO1Ob79lgRYIAADqIDuXBLHxMTdsW1CEIdN//7cMTrgJO8/0OMMNxBx54p9PMPSJvncnmFXE9XlS3LBZkqH6HIQDEbA4IiYCa0nICQqjodFNgc1g5FQQkAUCQmLa98f1jR6bIS9EkRHx+sVCJAldbn5ENjene5nEdndlq1o3zPg0oD1LDQBipA293w1Sn7+ffVFCAAAAABSVtlf9ozdYDWi1t9ljtfa+67lLHhhTB2QcovsmKmY2MWSDui4GRFpV5LDMhFQAwaq5ZEasz1kTzhxy4Cxm5BiMEkxEVDrB1M05ujIYeS/guZWrAcANMvuc8VPberlwLNKzChQ+hNlBWNo5hldcTiHsoGTQ+2LmWbNvWRm9R1/kZ4iIbpXRQevcLC5bMcs94buQowHACycWDk3cUcthq+hn0alIABVChRZlL/1mupeoeC31IpqtcN9iJO1kz/+3DE9YCWRSs/TDE8AdgbaXT2GmBVw3wSqeCJHIwAFhBizUymLcPdvHpLGcoz1WcxznUQ0uqcRosJPhOSZui9EEjrtWFmGADAOKiAEoEpOGEzCiE6OFlYtSeuZWWkNPUkLMuWsnMdVJRmsm9Cz/WW3gdAQoWNkQeFEyb2mCrLjRp5xG3zy6F3dn9CcZKSAAAAAKhDzrFtPUQ8bo8VIWwpTiLYWBDxYdQS4rlGoAmsQvhjG+aZbi2LSfTwiitTiUbmPT9acVW8W0PRqNNJDj+YqJPQKCHdI2SHFrdJo4t1uHm7mTkbRHjmE1tLGE45+945jkNBcLNRBtSL7BYLsuYn8iuUMaMvItk1SIggAAArQIuxbbDmXq5bPALE3fdOXuU6DQGDReah0uK0mbhx1iZqaLM0IkiMYsLI//tyxPMBlO0lP0wkfIJBG+h1h6V4cYNomiQTDAXtdxT1RK0uBMYtUG+LCik8hiKiJh+/Tqpgv2ZthPLNxPEFLQI0cLOgiuR3LHyHRqZSpF2fGOxeb0GmNmfjVvaDbLsYgoFAmpJoWBsbJ/1QEkb3JC+mawAAAAHafPSpezA32dVgimyt8Ax9SlaLmoJVeMmIgJ8onr5bopuD1pyjRzMMRRSURbUoDFOOFhLKWO/jzu4FgM3RKcFV6l6SxbllKZSsixWwLGLxW5RA78RVxXIaLAr+rBLnSD2hmUK8PniaIxZHAj1EsiOHR9apWIcb6srmK56s2iskmlQcMMD06RkGTRZc0OkzHaLid5Unv7hNA0PFEEU1m//+pyEB9FhFuVIrgkAZIoQyBzJcnDgRBFog3i5lyQCxBIkssGr/+3DE6YCPxM9Lp6R6EjKfqHWHmphgYgAYAKkoshwlqHFYctOIiFYWlixFzrTnIaHAoTEE72EMTGlWA1ql6n1ornaUwBoKs8prshUdjjW2vxJx2VCwuKLZDYbBKapQmioKhGkkTlRs0SLgtUA0cTkMKtoVp9WSx2a+42wr72KNioRp0u57lmRbyM3mpeAAABDdV3N0jroMbWAYkwVwmgQaoo5a5Iw3RvFRCzCLD+paIrx8DnMZh4AYZKtssQQeQSoNpDUsKehnFIq9+XTQ5AkJepnqLcRT7kac9G3rEk7Hjfj4q3eZ41py6rUplWwuQJHno4oSDvamqj5cTZhIQItdM5G2VaM0NRpbejEmmSCASaJXyPFgupDoklAAY0TNLsbxQqRVheo4fKrBVp9uMn2t1fTW0ZUZR6JY//tyxPYBlLEdOSww3EJkoCcg/CXxMw1YoYIRnKjAvJAanTLXNYoiam+nujSnk1h5Wfp0RBYZQBqa3kWoHBW2w34jcaeEpYFpmEo9jSPpwXx9JZsSLDXeGiGfGSar52VE58vIFTz3uZWKVmr3CvK5lx9/5vCt6rrEFv5ysLmoYblhUkrJiwp1f0JgAAAAA9rkcf1w2qtFRXjUCs5eahgwuYw9ibRy5rAoKZkiBQJ/odHxELJXKVpMvWyw+CkV45Sx9wXheVqDQ1tNSQ+WO/rI36clp7cnWm2ZPyweKVH8m4Dzk9HGzQ+V5wnp7aaIlHGBK3kCOAhW5uRzFnICtUJhoHHRnY6QFE1DuNCZo4EBWpw6kqBJ5hix9n/6pCCwAo+DnR5GTAMuwXReB4OBlKcdCLXZ8EmVxciXiHv/+3DE6QGRmOk6zCTcQk+e5yT8MXhIDMAJBCRXgYgkBvH4iQkSbP5rRDsizeUBJA1IhDAQsQAnJDUUSFzWh3GgTk0yMVgOaijLAkw4ISBwkELHF0xKDRuI95AjgwymZj1p0Xh/iYpqrE9gwwyTGFbzbPQfW0v//s338y2mzAAAAAAAAKhwOo4svV7xnLNXFmlfOU3V4KJXMYZ4ny6yUaGyUTysLTlKEgh0SIa2+4qCuZfo0MGCv42JrrcXYgN22VqaP+qbrhNKUMb567iwEABEpLB+yPTTA/qEIygOZbIKNpVHZrPMTkjUyqMgklYW5cN2TqaJBkSBdoKkoiAzBwZNmW29oox6lf/sT8db78BkQECbNJ9O5j5f5CWFAsGa40lJBiy6HLuLwL6sgFgqDpVg7Cg4rIoqmSud//tyxOqBkijxOywkfEIaHGd09JtAEaPNwDjg5KHjdH/TyWO1pPt41B1g18K1LOCEpsJeQ6gqzpcMfTghxbCbqhWWZ1HALGhR6wsUmRK2ISomIhguqfgyOTDkZyMOP2RRIjxYvWvd24YygNSaWDTwVSQTtvZwoVlB3/1/99UQkEAAAAABXD4wrxOUqOiESyIWFTm2h5hkrVkQTVCUPHahKDXBLiwASAzBfIeW4hafJMQolTSfjSbRPnbc2lsEqYROB3vjnXzBQ2eMUl0fqmahCHf10ioIE8Jlm2+rMQSxRlIiMT6NKdqVGfNKoNDE3iVrg0HyqrPCT3kLLx6adjS52uYIe2XLkADc5pj7Ok/40duJerKCyAbtkCH9LFkfGTpsFt4oiqEFeZYoLUkqdAAcYkNRhrQs8QpLuCP/+3DE8QGSINE7rLDaQkycppWHp0IILRLtgYECs/VtRPUBVhSBR1WSlLARENtFTpfsyHsdZmnasqEwDKWCcnUfsJJJWOVSiZF5DOjj4g+YvjJEojFTRYmLkNNvgjRIzjMW2TBZ3SI4QZzyqOtYxSgFmElB9Cxq3BST+r/t/9v//7f3KkAAABKpXhehmDKWpOrBCCNbLD25IAA5JeFnyqSYKlykAKscM2ES2ZxIYA3ojQgmUBFQslcQAnJkpYvuz+Dy8qtLd0UG9SVf+NoC4mXaWsm85TkNZH49LYabE/J0yK9RoYzh8miCbhIbOSWFh8F2GkZUdnJsggwaMG2LaO2Q4n9WaxvNUVEANPSEhceWFgGhOw+Jm1sjqiv/6zQAbJmTjltgmlfqLttKWfQTCV2OS5sCxJeKkhER//tyxPCBkQTRPaew2gKIH6Yhh6dIY1K5S7SqUukVADwG+Xu+kSUWLgLAQe9q52LSSMrSd8cO2EjRBQ5keryxH91WoTqGbBjuG9HehKtdTHTCRQZZ+qLjqFZLGKnNks0uzqjS7WeeTZNgNITOBoERhguJU3JexPGOddv/7GuotdqqUAAAEhLEDUau3fYQn08Mbchqq+S8S+EIhge6W3En3jcyWoYoIkqDTMOIs010266Y40CtFpiuwcKnbG0rERErXdWIqZA9MmMAY4voxhpS5FZpx3wvGknKvH0Yb9hIeeaPP5WtdKIRlkxbYVJC6/BYyTMaPywtqzA7e+hSSLTNdvLTr3fDiA2DYIsSVQRsc4X/+P6P/X/WsRgHxZruqdOvUYEsUoUoK4a/2Rs4gRZEdXOwtIdK1FFWRDH/+3DE7YGTIOEyzD06AiEZpuWHpwhdqgzWl3kzyyzus2dBLxQNdqLLJCMpWGcpAjJVyoPcyjNJoGpUUROF+uXaMhaOSCLVKqXVS2srIUVBpVFIss1YhgjcdzCHK5RpySUzstgqEjAdCoItm3xMOPzpd1qd5IYY9PPf1/soGQDEC4kylI5g6DZfxYVVVDkj+v5C0HlYiy5JFSwdMkkAYmYKZCnzKwwyNC2XELV0taIQEQyA6cLXHeSQ9j4FjFsEfKI7QDQD4AigwkykBjj4F6+BZmiYxuPzyRKbLcTW7grPtrJgxrUJXPaUb3wRIkDAgtJj0IWRor3JwdPWMgpZIMiEDjSp4WFL63u9fqkGrr/k//Qj//v9SAGpJpXrqiVhWQvU/Tfu4z5fqsaGy/W5oc5YpUGURHQhU0CD//tyxO6BktDXMMy9mgIpmSalh6bQvck8YjGgARpNFqrBUf0aUbFWJRo8QFGFMG0U4YkFwoKUCDDJ2ns1WDbeGcgtQigVR/HsvjmtTJlNrkyREtOEWC5KdPGosNGw+dcussRqIlV1E5p3PGrc8oBkEUiJfsVuqKrFnYwvrk/p39JhAAAAAA5B8WnIp26jeIbL8X4tp52FQwyhRB62oLbLVLQIg7CJlHNL8u+yYvarenbElE3rV6rEvG3RNe677sLBrmiLymQAo9gbAicHRIAOOheGJOPicTyWjLY9GkViSzHEuaedhjxpv2tZqqUL2/ZYYb3mi4aYgzI3OufM0CooKKeZaQW8VIBI3UbUH86VqVGrIRYeoRp36Ekwi4mgYH0nPagyVVJB2GyQUz4OBMVVXcIFDnLZ48Kkm6j/+3DE8IGTDNcuLD02wjoa5hmGJ0B3k/0HJgBJAgg6raSdYNGt11ir2FZE1wCFcz/L3c1aLXkz0ci6aTLsJdLnUtlSwy+C5yPD6P9SPa+jIIgy+VwLDUoqah8ElmWhmBY2e0q9QXiRFGg2SagQnFmUfNEtIWyIZKi7gVOiOSSWUwshCzAwpdu1dL////6P/7scmh1WyAAAADL8UKg50wyM40JkTtqdv4ziUurAt+K0kchpkjvSmNwC66mrxJD5MzYRSAP6u1zk+8yjTlUKVglFl8xUM3LoRAtczJgaLNxea9/LBTH7ur7F9MSHDiQFIhFBG4mRCJQMDkq0KXZHNnn+Wq/s1+1qTYbcAAABRC5aPTDUELUZO0MkHQnNvJmQICRAhzkGZEvcQEEZnEQygAICMIU6S9LyN5Qt//tyxO8Bk4ULM00weMJpmiWVrCW4TTBU6CGpwt0pH0pmkvm+SgDuNKL/obtOVjRPXXTUbZFonwJl8nHpUWloukCivj4yYHtih1diJmOB2+uswmEMV1HH2S8lvvRy8OCxcIg2AX1pHjw4k0SeQz6Fippw/Dn3KnC67Tdm4hIf/9f/VQ6AAAAAAfSxZMHvTFFVkeEP0QVpwIwOCKJc0Qc0lA+pdhAIpiutIQmSSALdpUQh/VTJeSNO9H6BnzcxlSYFOofGA4SBJgK03GRAZ811W5f060sAMkA6dA3sJ5d5ecDofrV50vQzhdBnoTBldZW8EDauI6e9j+vjdKJfp1EI6Vyss1/Lwbjx9+fCb0GnPqOZjxUp3d+LtEyASiWUJj6r2cBfM6MJEYJMvRZSkS/S0YFa0XCYcCAhzmb/+3DE5gCOyM8/rDBywnWaJemcMXhqqOi0YskoEnetpli73RWNCGXqFMCXRhnOZhvGgOAcJMksXEN0B6DUHCXAuC2HRG0F0JCHgbITw8NojpgLCkmxgswuSPHeHJa5CuuUtaRZpeospZ2nuEwcLAlGnw44esUGSNHubs+z1+/V5r/p//boIAAAMgviR7GmPsCgVuF13WGs6fuhVpQXYPDDQHnGRQCj+0xORhoQJFRFBHddilLDxIwkdFxczQoEWHWqjcmqztlTV0VhkLupiIXsVdenjrrCWOFhJNDQrDqqPl5AdZEM9Pw9SRuPahlWEkmeTIkNCDpdkqud+lgAVmDilrzhwXsXbqSKquszs5b/t/Q7/+zoRoD0r0FhTqqq6BwLZWRR9pUGl+lqoDF5v5F1Gk/V1OUtJije//tyxO4Bkt0JL4wweoJEmeWZh6bIiIrRy4IcUtQxKMQ8lZBBZsofF36fhMRWJqMNILtzABHdbit9VzlNLljmPCSCy6OR4OBSD0+PlhiYSElWfhvZlzmlK6HpjSV3ml+WejrjEeRmf9S/OFdFgkOCdwGAjgIlJJhVtKg/eaiv/76vQ3/3chpVNbCIAAAALtguFlbgNzXI01jFmIMMYvHoW2zWIjmSg/AhBLCnu5BHCajKP5Frl6zlqc5vJyAqkSkDvZVYedRwsx2pIgTi9RB+UsRAgMyyJE9LbuxBQpY50+RyXbvdU9lrXK0yjzQUC4fCBGViANgiNAjiMQrp2BqKqDLXHzoEcxi20rndK6V6DCCQQAX5TVhgoBjFRUjRKV5LLq9gV1HXep+4eTHaSDDtgd9eK7EglMxpSXT/+3DE7IGSMMsszDDaQk8fJYmGD1DAtLgdKMElJwYbGUSrXJmK4hQvhlDZJKeaQUKWWXZfIay8dIlKRnHLxxsucHLBgwEZI4tozrslqIT/RSAOLDjC3IK45Qxh28m97U2C6HJC7ulLtFei3P21////WjMAAAM8GWeIgIjJ/o8ww4heVPtlrrP2zGWpf0DQ0dDUoaFAzzIoPyC2AyRHQKjL8WYFwoFV2LHpQq+gKSsibu6LuoOKcIijorK0WYZSIXOqWGC/sAM/fB/qTF1Ij2MUl80wGEMgpouUJIGlhWgWRJLyaPLIm4szrb867RoLhxihG46WRz3yNLp29CH0SqLz/+9yq9u293uXu3rtmKiRUABcQQUHKEOOEV8jjfHadBJGMOAo0+aCNhCZitAPmcxlKcarJOJMLARZ//tyxOuAkOjLNaw9DYIdmSYxh46Yc21SoeCAIYklQah9MyhSzBOzE90LOyj2JChS8O4tALVBCKk5LklZKNhFMXZWsfPGNt3LWxPN1JlOBnHSCQmfXTeB5VqQQAyNMKFwy+ksUE4hQvr18Jtt8w3/7fXVIAAAABZOQ0NmHJ+KJpqYl+mNsTYi1hzX1LJQCvEvgpEkGw5i7JRAYQ1Bigqk4D2RQjxAhdA5ghw/R4rAjCoV5LxSk6MwAiFUPSApl1iIyVPIsZJ2oNUPHJZlX1A+eSmHorDwrR9ddUgaYmiKIdXm5NmvjXi0BC44q8RFjp6lq0mktSNJtkriaBGQPAY8UmhK3yqmd02iRT9HJfFOYUnSolEqULEjXFV+yxsUrW1J0o2XO0w9VRwV/NhbZYBgEJZ204QmMghsJC3/+3DE9oCTmM8pDGUxQh2YZej0m0AWSYtqIXIMEbwQQKyrQDgisCwiSZMJsgnGklI9RBg0VY6HpNLLhdc+oBCYoNqZ8TMtdDFW2ool8jlsq0TYEgKAlh0eGggGQkFmDBcXWeU9DFXzGbU5RDprRqVdEtXli36r/YxaYy93iqoQADgxgjEkHRs9Vy3Bhyr2MKsd9+xCBgShTSnMgN1ZtxnwVuaCDrpnCyRojltBQRIloJUxE9Fyv67SGDc20TL6oUu9bCNbGYU1uHXhayylwDge0E6wxIjRHQTNfXiu/Gs+BxPkOjlUIw+CDbIjCrGgLB6FuUpzi1owfYuOvap6dYoWU//wuq9ISTrY1hbOMb9CqiSJaOekSAv0FCq2tASJUUSvYjEWAsTgGHlDlNLaw8pXiuAv8qVhqbzE//twxPYBk/DHKSw9MwJClmVlh6ZYQFcI8VTp/OpG1uLeVJF005k4j+VxVgvjhZiVsAKISYJAWQ7nzCaiFHupWZUsiHMy0qXiq4PiCFJkEjt3kIIJJvZawmFYjaoJNcTcepl30Idub0bUX/av7b3tvZq9vRjFvSmsWZqOtdKVFwAAAC+GBswXS0xoMKXZH1YoHdyGEefpCcNpK0AKeH2eaXQouopYEcXE0WKQNUbgx3NLFxQ5uOY51WRbYqjmV7IUBC1UolpQvBgWBA4QWYAEUBZ7zDKe9l2kjLU3YqelcuFZ8GySIiBM8KHwoeetrM4O0GDu57w3W1xKmvXx2VAetH/0f6DNASrU6VVTgZejyquXngJXzFCy6IZatH5vaEZIkiAlLQUod0BpJgCEIRBG1w1M1kFkkjjSmP/7csTvgdLY0SisMHpCMpYlIYea0Iv/DyhyewcCIDJRGSrHDUlcBsIA7H0WY8DvBwjhpxTHElkQsjYmg3eJyCvZVQSzZGfmRiZNS3p7jjwNCFAJHw2VKNUH3KFNLhixZjYCUmLlLIIxiVAd+95S3rAtirHsrJm4fmWaxVR1g8XsDzSQ0IAFygYSQQAAAC3GPZkNUfZCVolR2i5OnInLK1nQqFcdaGiUfiwMzC1ikFUayaXCi2RHdHZ0fTo9HAvIsQ6lcnBIWjlgxULgfFRBWMklCYp7MpW/RIs9UbLW82RyAKVCAc8qJcdFMnCmenQ+Paw6o62V6vo0LYxe3///97HD3lDFINv4KWERLmpgCpGGO0iHE5e4CqsAho0OoBcpTdhkAGBogAsMK8Q0hOtBR+mXlvRCJnN+Pt+y//twxPABkLi3LSw8y8KalqRFh7MABs6gDTCgCLTH1XSSFQG+UbnIKWCbtH34h1xo2+tyTROfAofFJ8+qbPQfE43stpuU+RpIH5P6omrxjurqrO6B72a879aHOtpX3ujZWGv3oy07tW/6rt70M/1vob9bpkZJ2ZtnMHV0RVRjoQzXtrV2EZY1ZAAAf8kG5C97ENLFZrGWmSl8I2zkvT7o6zmHpKVpThTNaFi6BykGOR3HbD9JUaKoQijjRgypHA6DzfN8rMpVI/ZWwDBAkCT8Fqob/OUlo0WAwmExskIzyDIxRMY1pBV4u/cozdZKSHL3mX81fvMaK+UzdX9P/p/WQByJhFtvXJnlLgYBJ5X66YYW2zhA4vBKZWgOLcK2sObRoRQZMVKMgaX6rv87adihSl7cWgNq/LclrP/7csTrgI8YtS+nsRSCrT+kBYSLiOkypZcCpGIBkZhoCpVO3/e9ypTKhQsL4+BMOJRPiwSVhaOy6eQ4rcbh+fczSI17PhrPdG7uLPD9aFtOisIm1YhUsHwihgVEAVMmyd7jpJGxdt69uwufyFg9Ghc64KZpyXB4wbAofNBUIJErKghAAAB+RsGKW8oRlBjFyLqWA8CbJdfD/WC5oBpJCSk1zqO00CUGIEfHAfBrKNQExYx6kKL8ZkmpWPLFYXiSTQZiKVIjMQzAMRGKCvIBuAOimCozhGzNrHHBuYOlh4hUTCpONOhmbYbLPuaPFnAqObVsba56EUdybdP7TOP1Z7R2oZFJ1RClxcSeyPyxnCZgnPDqAprQcJCUnU3Fy5SnQteIBgkjC6bUHxEhoTBEImM6CXbIpOpNMFBc//twxOwAjxyTLSw8y8KVmOQVhhtIsyXUkZKDzJKmFGKeCMgORdUwhoXhPhin9NCOs6mhwjL7NBUqjpNICktCR9qVBeI45VNy0kkQpeKlAwpohqVGRj2qfKvZVYGuVoPGgjx1bO+8ipF+00TFAC4TkhUKLeWvJJWB0ng2WEBYQB9tXAADSWDpPMspz1J6eqEJZD181SsBXm8XMt4S0XAPKAPIGcLGHGUQOVyHmaVS4nsuHi0ybUB54XBLTBLGpksSY5EeuaNx9FSFQe1ZJrafaNq6FDJBWWgCLiwGILpItQVVLjoJLwwIkjg/dNiul17XKy96/8tb0+0lvYNUXqCkgcRVHwuNuTNELgKtZF5gqVTdoLvN2WFWHTKcNl87BYypIVTBa8GM7RSFgA7SZUMVYIiaCKzGkkWgtf/7csTugZDoqycnsHZCdZXjxYea0KiK8F5N1WyrYxqVImP45TuytvpC8bYygueJAGORAjT5xhpRVsyQs42pbK58hNBs7Iqo5Wo96/2Lm3t823svuiq2339tPv7Itz9mty3+yr+y6LRybMhWySIDIDRR6hDCjNVZzmKqgKIUY4txRQIQAABmGGhQa7o3OLPbE1t34syZ62IM8THYZ2eeRgLEVfBUj7EARIHItiKRqEyp0xjDEwQ04mV0bxpMrkPlXlzQbSfaEM8y0hCvNHx2Cqgg0njVYE5RimKWio5SPDu7syK9tkSh95b8H9a0Rpa/svfP1odtszIm5mr9v/3+/e/1177EZUUkyFuTUhfS91KxJGQjkPHcQqhMLoYBgbF1VQmot5QQTgS7OZxY3hxHM9MYJo6pW8sSuLcQ//twxO6BkJipIsekegJ9QaNBhItIM6I7sw2E+B6z2iv1cuHSF7e2OguC09IMrlSzOLuR9L4z9q8PPrsSYTp3STB0WCrg+koYEx4Fg7Bxax7GLvexDh6+w1nuZ4s3/pdursotvHkxIoOpey8WELTWF1DwSQCkAAB2WoIuve9bdmRNuwqeWIxmGWDWp5sTb0K0ZQsLAMuhxkwc5kbkw/g9dmbYG9V+ddikaQ89iNNrFlmMQWHjrTpZRzEszuz1adt1Ll+Ynq3SEoT5lxs6UNDLDWWzqE8WymDEk5SAuuMZ3Si9uttab/9moiVevJS7+tudX70bcitalZHsy67qV5yPussiC70VWTRzUd1M62cEwKBUtblBrNWgP+1tQl4narNNVyvN1JM4KtSYivVLZG7SgIwJmy9FrU1LF//7csTugZLaCx8sPFFCABUkJPCPgIfaRLNS7bkSqLO0+Sm79Oa4y468Rgq3KYdfyhm7NemsS6Qclli6Ugo4kzkOHEqLJIjmuqsrKt2L2Stey/+pG7/s6IY3ZOm/TT99/29ao6K19DWUZLsc99W7677UI+dZsPbaskn29eWslcWmMJ1STmmSJ0+0JBQBwB3CHkuLkYgfxxjcliqBkTxxp0g2HNUGc0jyP5JCzIhFGOZLcpELlUrUizlq8W4D9FK05SiJ7EXcRjrZunzeDFhXbWa8sTVcS7vb2xXOtdjiNOCKX/zMn7aVHL/19cv6+//X/+XX6LI2IVjkbPidcstTLfBE8JtYiGx1hZoQICJyEbBDAExQNABVQfiPHQr3BdjFUyyPS2l+fGlHGKu08YB1IUecx0ql+qFtNJaF//twxPWAk3YHHSwMXIp9wSLBgRupz2LkWFpxMxTajVPlQNCEl9WGBXQWHN4keNmWka9N4pm0B7rd/XeM42bKsyEJ5Wj2Qv8lij8R8aczFLIZ9WFbzS8uFo//RYq+d5Kcpl/1Tm9O+hEthuQ0mwzMBDgi0yMaBhaIY6BGECAAM1AD0axcbKMx0y2rqj06TkI2eJ1KI51stxOT6Sb8cYt7YdKNRjgezqEpXzlHmhRoz9V6jxe4s81I6hdqSytcYVXKsDGuFSOYM6tsHL2ZFbbRdva57tVrUZ69bsjMZnfZ2borP9NNbc23b//66PYspVqWoCetmD97O2e4lnoih0WOTlvyWHR9HZzJWrbAZxZIkEokIABkBnEGUjMql+KczfNQ/lajC+mil2JZRqzOonJOn8yOSkXMW+lc2P/7csTqABEaAxinhH8KOMEjGPCP4Y6LXUkeeR+3xFE5xlqFAravpamcQa43q2fnMusZrrOs6yTTmVcfOf6nJfCRSs5VCgy/6bYnRCej+W//mL8Sy+VG8jKUGN8mzXrbq5VM2ukNPKd5kDppMw82z9TyYMCUi5pc0xGHKW5wjR11eGpY6tcWa0CV7NKhs7hBRKNiqtmVVmp+yKp3veu+pbCGtEzdXLx7FpPVgk4eUpxWqlmNZW+h+b06a6J61Wrb6tM07KRN+itqltdNfr+9nka6zGqqIxequWhh0wuVzzWj3GJpwgnUUnqjKNlAcP5aJcsyyKRQqsREy4ofIU6uaIzRUNKxgTmDY+ICBQKEmAELDTZX1WGYk2vJFnBSHuqkhycqwzWtTUfMCwsKm+utfk7/8J/538PPIQsw//twxPEAkroNFMeI3UIowWKk8Jvh4SvCGEn0WisTCEJh/PDFMJC89a/huGxz+W7GHr1NDcSFyzV+KuNXFYVIiIlgiFSMMwKqQOjoJPIhsDKAKoDQpgVJVRSdHQDIyh9g0KYgMIwZJlYkpECwrAlEIQRBE8iZlUxBTUUzLjk5LjNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUECAAACodnazoqLWqX+iqnqi/1RF+5Sy/LLSMjVlBAnQ/n//2Wkf/ZKR+Utl/VgoOOllIzWXsshl/y2X4stIyNWChgQdHlQyrauK2gtzXDef/7csTzAxK+DwwnlTuCM8GghICnaTzRor5hXS6b3kel6brXGab1bP+f7zMxym8dyTTivZGdwVSdUq8xxMvlKulOzuDkyqI0SfFCVBgHWmlUrW6G6ZmJhXTe8fuDNBSqTEFNRTMuOTkuM6qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//twxLqD0y4KxQEN+0gAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqg==",soundByteArray$f=base64SoundToByteArray(phetAudioContext$1,soundURI$f),unlock$f=asyncLoader.createLock(soundURI$f),wrappedAudioBuffer$f=new WrappedAudioBuffer;let unlocked$f=!1;const safeUnlock$f=()=>{unlocked$f||(unlock$f(),unlocked$f=!0)},onDecodeSuccess$f=o=>{wrappedAudioBuffer$f.audioBufferProperty.value===null&&(wrappedAudioBuffer$f.audioBufferProperty.set(o),safeUnlock$f())},onDecodeError$f=o=>{console.warn("decode of audio data failed, using stubbed sound, error: "+o),wrappedAudioBuffer$f.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$f()},decodePromise$f=phetAudioContext$1.decodeAudioData(soundByteArray$f.buffer,onDecodeSuccess$f,onDecodeError$f);decodePromise$f&&decodePromise$f.then(o=>{wrappedAudioBuffer$f.audioBufferProperty.value===null&&(wrappedAudioBuffer$f.audioBufferProperty.set(o),safeUnlock$f())}).catch(o=>{console.warn("promise rejection caught for audio decode, error = "+o),safeUnlock$f()});const monitoredAudioContexts=[],stateChangeListenerArrays=[],audioContextStateChangeMonitor={addStateChangeListener(o,e){let t=monitoredAudioContexts.indexOf(o),n;t===-1?(monitoredAudioContexts.push(o),t=monitoredAudioContexts.length-1,n=[],stateChangeListenerArrays.push(n),assert&&assert(!o.onstatechange,"a listener function is already registered for this context"),o.onstatechange=()=>{_.clone(n).forEach(r=>{r(o.state)})}):n=stateChangeListenerArrays[t],n.push(e)},removeStateChangeListener(o,e){const t=monitoredAudioContexts.indexOf(o);assert&&assert(t>=0,"audio context not found");const n=stateChangeListenerArrays[t],r=n.indexOf(e);assert&&assert(r>=0,"listener not found for specified audio context"),n.splice(r,1)},hasListener(o,e){let t=!1;const n=monitoredAudioContexts.indexOf(o);if(n>=0){const r=stateChangeListenerArrays[n];r&&(t=r.includes(e))}return t}};tambo.register("audioContextStateChangeMonitor",audioContextStateChangeMonitor);const soundConstants={DEFAULT_PARAM_CHANGE_TIME_CONSTANT:.015,DEFAULT_LINEAR_GAIN_CHANGE_TIME:.1,TWELFTH_ROOT_OF_TWO:Math.pow(2,1/12)};tambo.register("soundConstants",soundConstants);const Wo=class Wo extends EnumerationValue{};Wo.BASIC=new Wo,Wo.EXTRA=new Wo,Wo.enumeration=new Enumeration(Wo,{phetioDocumentation:"describes whether a sound is considered part of the basic or the extra sounds for the sim"});let SoundScope=Wo;tambo.register("SoundScope",SoundScope);const AUDIO_DUCKING_LEVEL=.15,DEFAULT_REVERB_LEVEL=.02,LINEAR_GAIN_CHANGE_TIME=soundConstants.DEFAULT_LINEAR_GAIN_CHANGE_TIME;class SoundManager extends PhetioObject{constructor(e){var t,n,r,s;super({tandem:e,phetioState:!1,phetioDocumentation:"Controls the simulation's sound. For sims that do not support sound, this element and its children can be ignored."}),this.viewNodeDisplayedPropertyMap=new Map,this.enabledProperty=new BooleanProperty(((n=(t=phet==null?void 0:phet.chipper)==null?void 0:t.queryParameters)==null?void 0:n.supportsSound)||!1,{tandem:e==null?void 0:e.createTandem("enabledProperty"),phetioState:!1,phetioDocumentation:"Determines whether sound is enabled. Supported only if this sim supportsSound=true."}),this.extraSoundEnabledProperty=new BooleanProperty(((s=(r=phet==null?void 0:phet.chipper)==null?void 0:r.queryParameters)==null?void 0:s.extraSoundInitiallyEnabled)||!1,{tandem:e==null?void 0:e.createTandem("extraSoundEnabledProperty"),phetioState:!1,phetioDocumentation:"Determines whether extra sound is enabled. Extra sound is additional sounds that can serve to improve the learning experience for individuals with visual disabilities. Note that not all simulations that support sound also support extra sound. Also note that the value is irrelevant when enabledProperty is false."}),this.soundGeneratorInfoArray=[],this._mainOutputLevel=1,this._reverbLevel=DEFAULT_REVERB_LEVEL,this.gainNodesForCategories=new Map,this.duckingProperties=createObservableArray(),this.initialized=!1,this.soundGeneratorsAwaitingAdd=[],this.mainGainNode=null,this.duckingGainNode=null,this.convolver=null,this.reverbGainNode=null,this.dryGainNode=null}initialize(e,t,n,r,s,a){assert&&assert(!this.initialized,"can't initialize the sound manager more than once");const l=optionize()({categories:["sim-specific","user-interface"]},a);assert&&assert(l.categories.length===_.uniq(l.categories).length,"categories must be unique");const d=phetAudioContext$1.currentTime,c=phetAudioContext$1.createDynamicsCompressor();c.threshold.setValueAtTime(-6,d),c.knee.setValueAtTime(5,d),c.ratio.setValueAtTime(12,d),c.attack.setValueAtTime(0,d),c.release.setValueAtTime(.25,d),c.connect(phetAudioContext$1.destination),this.duckingGainNode=phetAudioContext$1.createGain(),this.duckingGainNode.connect(c),this.mainGainNode=phetAudioContext$1.createGain(),this.mainGainNode.connect(this.duckingGainNode),this.convolver=phetAudioContext$1.createConvolver();const y=N=>{N&&(this.convolver.buffer=N,wrappedAudioBuffer$f.audioBufferProperty.unlink(y))};wrappedAudioBuffer$f.audioBufferProperty.link(y),this.reverbGainNode=phetAudioContext$1.createGain(),this.reverbGainNode.connect(this.mainGainNode),this.reverbGainNode.gain.setValueAtTime(this._reverbLevel,phetAudioContext$1.currentTime),this.convolver.connect(this.reverbGainNode),this.dryGainNode=phetAudioContext$1.createGain(),this.dryGainNode.gain.setValueAtTime(1-this._reverbLevel,phetAudioContext$1.currentTime),this.dryGainNode.gain.linearRampToValueAtTime(1-this._reverbLevel,phetAudioContext$1.currentTime+LINEAR_GAIN_CHANGE_TIME),this.dryGainNode.connect(this.mainGainNode),assert&&assert(this.convolver!==null&&this.dryGainNode!==null,"some audio nodes have not been initialized"),l.categories.forEach(N=>{const H=phetAudioContext$1.createGain();H.connect(this.convolver),H.connect(this.dryGainNode),this.gainNodesForCategories.set(N,H)}),Multilink.multilink([this.enabledProperty,t,e,n,r,s],(N,H,X,ae,oe,ue)=>{const be=N&&H&&X&&ae&&oe&&!ue?this._mainOutputLevel:0;this.mainGainNode.gain.linearRampToValueAtTime(be,phetAudioContext$1.currentTime+LINEAR_GAIN_CHANGE_TIME)});const m=new BooleanProperty(!1),O=()=>{m.value=this.duckingProperties.reduce((N,H)=>N||H.value,!1)};m.lazyLink(N=>{var ae,oe;assert&&assert(this.duckingGainNode,"ducking listener fired, but no ducking gain node exists");const H=N?.05:.5,X=phetAudioContext$1.currentTime;(ae=this.duckingGainNode)==null||ae.gain.cancelScheduledValues(X),(oe=this.duckingGainNode)==null||oe.gain.setTargetAtTime(N?AUDIO_DUCKING_LEVEL:1,X,H)}),this.duckingProperties.addItemAddedListener(N=>{N.link(O);const H=X=>{X===N&&(X.unlink(O),this.duckingProperties.removeItemRemovedListener(H))};this.duckingProperties.addItemRemovedListener(H)});const D=()=>{window.removeEventListener("touchstart",z,!1),Display.userGestureEmitter.hasListener(z)&&Display.userGestureEmitter.removeListener(z)},z=()=>{phetAudioContext$1.state!=="running"?(phet.log&&phet.log(`audio context not running, attempting to resume, state = ${phetAudioContext$1.state}`),phetAudioContext$1.resume().then(()=>{phet.log&&phet.log(`resume appears to have succeeded, phetAudioContext.state = ${phetAudioContext$1.state}`),D()}).catch(N=>{const H=`error when trying to resume audio context, err = ${N}`;console.error(H),assert&&alert(H)})):D()};window.addEventListener("touchstart",z,!1),Display.userGestureEmitter.addListener(z);let w=phetAudioContext$1.state;audioContextStateChangeMonitor.addStateChangeListener(phetAudioContext$1,N=>{phet.log&&phet.log(`audio context state changed, old state = ${w}, new state = ${N}, audio context time = ${phetAudioContext$1.currentTime}`),N!=="running"?(window.addEventListener("touchstart",z,!1),Display.userGestureEmitter.hasListener(z)||Display.userGestureEmitter.addListener(z)):console.log("AudioContext is now running."),w=N}),this.initialized=!0,this.soundGeneratorsAwaitingAdd.forEach(N=>{this.addSoundGenerator(N.soundGenerator,N.soundGeneratorAddOptions)}),this.soundGeneratorsAwaitingAdd.length=0}hasSoundGenerator(e){return _.some(this.soundGeneratorInfoArray,t=>t.soundGenerator===e)}addSoundGenerator(e,t){if(t===void 0&&(t={}),!this.initialized){this.soundGeneratorsAwaitingAdd.push({soundGenerator:e,soundGeneratorAddOptions:t});return}assert&&assert(this.convolver!==null&&this.dryGainNode!==null,"some audio nodes have not been initialized");const n=this.hasSoundGenerator(e);assert&&assert(!n,"can't add the same sound generator twice");const r=optionize()({sonificationLevel:SoundScope.BASIC,associatedViewNode:null,categoryName:null},t);assert&&assert(_.includes(_.values(SoundScope),r.sonificationLevel),`invalid value for sonification level: ${r.sonificationLevel}`),r.categoryName===null?(e.connect(this.convolver),e.connect(this.dryGainNode)):(assert&&assert(this.gainNodesForCategories.has(r.categoryName),`category does not exist : ${r.categoryName}`),e.connect(this.gainNodesForCategories.get(r.categoryName)));const s={soundGenerator:e,sonificationLevel:r.sonificationLevel};if(this.soundGeneratorInfoArray.push(s),e.addEnableControlProperty(this.enabledProperty),r.sonificationLevel===SoundScope.EXTRA&&e.addEnableControlProperty(this.extraSoundEnabledProperty),r.associatedViewNode){const a=new DisplayedProperty(r.associatedViewNode);e.addEnableControlProperty(a),this.viewNodeDisplayedPropertyMap.set(e,a)}}removeSoundGenerator(e){if(!this.initialized){const n=this.soundGeneratorsAwaitingAdd.filter(r=>r.soundGenerator===e);for(assert&&assert(n.length>0,"unable to remove sound generator - not found");n.length>0;)arrayRemove(this.soundGeneratorsAwaitingAdd,n[0]),n.shift();return}let t=null;for(let n=0;n<this.soundGeneratorInfoArray.length;n++)if(this.soundGeneratorInfoArray[n].soundGenerator===e){t=this.soundGeneratorInfoArray[n];break}assert&&assert(t,"unable to remove sound generator - not found"),e.isConnectedTo(this.convolver)&&e.disconnect(this.convolver),e.isConnectedTo(this.dryGainNode)&&e.disconnect(this.dryGainNode),this.gainNodesForCategories.forEach(n=>{e.isConnectedTo(n)&&e.disconnect(n)}),t&&this.soundGeneratorInfoArray.splice(this.soundGeneratorInfoArray.indexOf(t),1),this.viewNodeDisplayedPropertyMap.has(e)&&(this.viewNodeDisplayedPropertyMap.get(e).dispose(),this.viewNodeDisplayedPropertyMap.delete(e))}setMainOutputLevel(e){if(!this.initialized){console.warn("an attempt was made to set the main output level on an uninitialized sound manager, ignoring");return}assert&&assert(e>=0&&e<=1,`output level value out of range: ${e}`),this._mainOutputLevel=e,this.enabledProperty.value&&this.mainGainNode.gain.linearRampToValueAtTime(e,phetAudioContext$1.currentTime+LINEAR_GAIN_CHANGE_TIME)}set mainOutputLevel(e){this.setMainOutputLevel(e)}get mainOutputLevel(){return this.getMainOutputLevel()}getMainOutputLevel(){return this._mainOutputLevel}setOutputLevelForCategory(e,t){if(!this.initialized){console.warn("an attempt was made to set the output level for a sound category on an uninitialized sound manager, ignoring");return}assert&&assert(this.initialized,"output levels for categories cannot be added until initialization has been done"),assert&&assert(t>=0&&t<=1,`output level value out of range: ${t}`),assert&&assert(this.gainNodesForCategories.get(e),`no category with name = ${e}`);const n=this.gainNodesForCategories.get(e);n&&n.gain.setValueAtTime(t,phetAudioContext$1.currentTime)}addDuckingProperty(e){this.duckingProperties.add(e)}removeDuckingProperty(e){assert&&assert(this.duckingProperties.includes(e),"ducking Property not present"),this.duckingProperties.remove(e)}getOutputLevelForCategory(e){if(!this.initialized)return console.warn("an attempt was made to get the output level for a sound category on an uninitialized sound manager, returning 0"),0;const t=this.gainNodesForCategories.get(e);return assert&&assert(t,`no category with name = ${e}`),t.gain.value}setReverbLevel(e){if(!this.initialized){console.warn("an attempt was made to set the reverb level on an uninitialized sound manager, ignoring");return}if(e!==this._reverbLevel){assert&&assert(e>=0&&e<=1,`reverb value out of range: ${e}`);const t=phetAudioContext$1.currentTime;this.reverbGainNode.gain.linearRampToValueAtTime(e,t+LINEAR_GAIN_CHANGE_TIME),this.dryGainNode.gain.linearRampToValueAtTime(1-e,t+LINEAR_GAIN_CHANGE_TIME),this._reverbLevel=e}}set reverbLevel(e){this.setReverbLevel(e)}get reverbLevel(){return this.getReverbLevel()}getReverbLevel(){return this._reverbLevel}set enabled(e){this.enabledProperty.value=e}get enabled(){return this.enabledProperty.value}set sonificationLevel(e){this.extraSoundEnabledProperty.value=e===SoundScope.EXTRA}get sonificationLevel(){return this.extraSoundEnabledProperty.value?SoundScope.EXTRA:SoundScope.BASIC}logGain(e,t){}logMainGain(e){this.mainGainNode&&this.logGain(this.mainGainNode,e)}logReverbGain(e){this.reverbGainNode&&this.logGain(this.reverbGainNode,e)}}const soundManager=new SoundManager;tambo.register("soundManager",soundManager);const AUDIO_DATA_THRESHOLD=.05,SoundUtils={detectSoundBounds:o=>{const e=o.length,t=[],n=[];for(let s=0;s<o.numberOfChannels;s++){const a=o.getChannelData(s);t[s]=findSoundStartIndex(a,e,AUDIO_DATA_THRESHOLD),n[s]=findSoundEndIndex(a,e,AUDIO_DATA_THRESHOLD)}const r=o.sampleRate;return{soundStart:_.min(t)/r,soundEnd:_.max(n)/r}}},findSoundStartIndex=(o,e,t)=>{let n=0,r,s=!1;for(r=0;r<e-1&&!s;r++)o[r]>t&&o[r+1]>o[r]&&(n=r,s=!0);let a=0;for(s=!1,r=n;r>0&&!s;r--){const c=o[r];c<=0&&(a=c===0?r:r+1,s=!0)}let l=0,d=0;for(r=0;r<a;r++)l=Math.max(l,o[r]),d=Math.min(d,o[r]);return a},findSoundEndIndex=(o,e,t)=>{let n=e-1,r=!1,s;for(s=e-1;s>0&&!r;s--)o[s]<=-t&&o[s-1]<o[s]&&(n=s,r=!0);let a=n;for(r=!1,s=n;s<e-1&&!r;s++)o[s+1]>=0&&(a=s,r=!0);let l=0,d=0;for(s=a;s<e;s++)l=Math.max(l,o[s]),d=Math.min(d,o[s]);return a};tambo.register("SoundUtils",SoundUtils);const DEFAULT_TIME_CONSTANT=soundConstants.DEFAULT_PARAM_CHANGE_TIME_CONSTANT,notSettingPhetioStateProperty=DerivedProperty.not(isSettingPhetioStateProperty);class SoundGenerator extends Disposable{constructor(e){super();const t=optionize()({initialOutputLevel:1,audioContext:phetAudioContext$1,connectImmediately:!1,enableControlProperties:[],additionalAudioNodes:[],enabledDuringPhetioStateSetting:!1},e);this.audioContext=t.audioContext,this._outputLevel=t.initialOutputLevel,this.connectionList=[],this.enableControlProperties=createObservableArray(),this.fullyEnabledProperty=new BooleanProperty(!0);const n=()=>{this.fullyEnabledProperty.value=_.every(this.enableControlProperties,r=>r.value)};this.enableControlProperties.addItemAddedListener(r=>{r.link(n);const s=a=>{a===r&&(a.unlink(n),this.enableControlProperties.removeItemRemovedListener(s))};this.enableControlProperties.addItemRemovedListener(s)}),t.enableControlProperties.forEach(r=>{this.addEnableControlProperty(r)}),this.locallyEnabledProperty=new BooleanProperty(!0),this.addEnableControlProperty(this.locallyEnabledProperty),this.mainGainNode=this.audioContext.createGain(),this.mainGainNode.gain.setValueAtTime(this._outputLevel,this.audioContext.currentTime),t.connectImmediately&&this.mainGainNode.connect(this.audioContext.destination),this.fullyEnabledProperty.link(r=>{const s=r?0:this._outputLevel,a=r?this._outputLevel:0,l=this.audioContext.currentTime;this.mainGainNode.gain.setValueAtTime(s,l),this.mainGainNode.gain.linearRampToValueAtTime(a,this.audioContext.currentTime+soundConstants.DEFAULT_LINEAR_GAIN_CHANGE_TIME)}),this.soundSourceDestination=this.mainGainNode;for(let r=t.additionalAudioNodes.length-1;r>=0;r--){const s=t.additionalAudioNodes[r];s.connect(this.soundSourceDestination),this.soundSourceDestination=s}Tandem.PHET_IO_ENABLED&&!t.enabledDuringPhetioStateSetting&&this.addEnableControlProperty(notSettingPhetioStateProperty),this.disposeEmitter.addListener(()=>{this.enableControlProperties.clear()})}connect(e){this.mainGainNode.connect(e),this.connectionList.push(e)}disconnect(e){this.mainGainNode.disconnect(e),this.connectionList=_.without(this.connectionList,e)}isConnectedTo(e){return this.connectionList.includes(e)}setOutputLevel(e,t=DEFAULT_TIME_CONSTANT){if(e!==this._outputLevel){const n=this.audioContext.currentTime;this.fullyEnabledProperty.value&&(this.mainGainNode.gain.cancelScheduledValues(n),t===0?this.mainGainNode.gain.setValueAtTime(e,n):this.audioContext.state==="running"?this.mainGainNode.gain.setTargetAtTime(e,n,t):this.mainGainNode.gain.linearRampToValueAtTime(e,n+soundConstants.DEFAULT_LINEAR_GAIN_CHANGE_TIME)),this._outputLevel=e}}set outputLevel(e){this.setOutputLevel(e)}get outputLevel(){return this.getOutputLevel()}getOutputLevel(){return this._outputLevel}addEnableControlProperty(e){this.enableControlProperties.push(e)}removeEnableControlProperty(e){this.enableControlProperties.remove(e)}get locallyEnabled(){return this.locallyEnabledProperty.value}set locallyEnabled(e){this.locallyEnabledProperty.value=e}get fullyEnabled(){return this.fullyEnabledProperty.value}}tambo.register("SoundGenerator",SoundGenerator);const MAX_PLAY_DEFER_TIME=.2,DEFAULT_TC=soundConstants.DEFAULT_PARAM_CHANGE_TIME_CONSTANT,DEFAULT_STOP_DELAY=.1;class SoundClip extends SoundGenerator{constructor(e,t){const n=optionize()({loop:!1,trimSilence:!0,initialPlaybackRate:1,initiateWhenDisabled:!1,rateChangesAffectPlayingSounds:!0},t);if(super(n),this.wrappedAudioBuffer=e,this.loop=n.loop,this.rateChangesAffectPlayingSounds=n.rateChangesAffectPlayingSounds,this.initiateWhenDisabled=n.initiateWhenDisabled,this.soundStart=0,this.soundEnd=null,n.trimSilence){const r=s=>{if(s){const a=SoundUtils.detectSoundBounds(s);this.soundStart=a.soundStart,this.soundEnd=a.soundEnd,this.wrappedAudioBuffer.audioBufferProperty.unlink(r)}};this.wrappedAudioBuffer.audioBufferProperty.link(r)}this.activeBufferSources=[],this.localGainNode=this.audioContext.createGain(),this.localGainNode.connect(this.soundSourceDestination),this._playbackRate=n.initialPlaybackRate,this.isPlayingProperty=new BooleanProperty(!1),this.timeOfDeferredPlayRequest=Number.NEGATIVE_INFINITY,this.audioContextStateChangeListener=r=>{r==="running"&&((this.loop||(Date.now()-this.timeOfDeferredPlayRequest)/1e3<MAX_PLAY_DEFER_TIME)&&this.play(.1),audioContextStateChangeMonitor.removeStateChangeListener(this.audioContext,this.audioContextStateChangeListener))},this.fullyEnabledProperty.lazyLink(r=>{!this.loop&&!r&&this.stop()})}play(e=0){if(this.audioContext.state==="running"&&this.wrappedAudioBuffer.audioBufferProperty.value){const t=this.audioContext.currentTime;if(this.loop&&!this.isPlayingProperty.get()||!this.loop&&(this.fullyEnabled||this.initiateWhenDisabled)){const n=this.audioContext.createBufferSource();n.buffer=this.wrappedAudioBuffer.audioBufferProperty.value,n.loop=this.loop,n.loopStart=this.soundStart,this.soundEnd&&(n.loopEnd=this.soundEnd),this.localGainNode.gain.cancelScheduledValues(t),this.localGainNode.gain.setValueAtTime(1,t),n.connect(this.soundSourceDestination),this.activeBufferSources.push(n),this.loop||(n.onended=()=>{const r=this.activeBufferSources.indexOf(n);r>-1&&this.activeBufferSources.splice(r,1),this.isPlayingProperty.value=this.activeBufferSources.length>0}),n.playbackRate.setValueAtTime(this._playbackRate,t),n.start(t+e,this.soundStart),this.isPlayingProperty.value=!0}}else this.audioContext.state==="suspended"&&(this.timeOfDeferredPlayRequest=Date.now(),audioContextStateChangeMonitor.hasListener(this.audioContext,this.audioContextStateChangeListener)||audioContextStateChangeMonitor.addStateChangeListener(this.audioContext,this.audioContextStateChangeListener))}stop(e=DEFAULT_STOP_DELAY){const t=e>0?e/4.61:soundConstants.DEFAULT_PARAM_CHANGE_TIME_CONSTANT,n=this.audioContext.currentTime,r=n+e;this.localGainNode.gain.cancelScheduledValues(n),this.localGainNode.gain.setTargetAtTime(0,n,t),this.activeBufferSources.forEach(s=>{s.stop(r)}),this.activeBufferSources.length=0,this.isPlayingProperty.value=!1,audioContextStateChangeMonitor.hasListener(this.audioContext,this.audioContextStateChangeListener)&&audioContextStateChangeMonitor.removeStateChangeListener(this.audioContext,this.audioContextStateChangeListener)}setPlaybackRate(e,t=DEFAULT_TC){if(assert&&assert(e>0,"invalid playback rate: "+e),this.rateChangesAffectPlayingSounds){const n=this.audioContext.currentTime;this.activeBufferSources.forEach(r=>{r.playbackRate.cancelScheduledValues(n),r.playbackRate.setTargetAtTime(e,n,t)})}this._playbackRate=e}getPlaybackRate(){return this._playbackRate}get playbackRate(){return this.getPlaybackRate()}get isPlaying(){return this.isPlayingProperty.value}getNumberOfPlayingInstances(){return this.activeBufferSources.length}}tambo.register("SoundClip",SoundClip);class SoundClipPlayer{constructor(e,t){const n=optionize()({soundClipOptions:{},soundManagerOptions:{}},t);this._soundClip=new SoundClip(e,n.soundClipOptions),soundManager.addSoundGenerator(this._soundClip,n.soundManagerOptions)}play(){this._soundClip.play()}stop(){this._soundClip.stop()}getSoundClip(){return this._soundClip}}tambo.register("SoundClipPlayer",SoundClipPlayer);const switchToLeftSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$g,{soundClipOptions:{initialOutputLevel:.2},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("switchToLeftSoundPlayer",switchToLeftSoundPlayer);const soundURI$e="data:audio/mpeg;base64,//swxAAABQQDHVQRABFbki33MLACAFiANEhrgagQWfE6eUcJxwPv5wuD/ynh/aXfLvD/9HlwfD//EEEPD7ZhOAkFSjlaqEIiQQAEs4eiJWJc1P1YWHlShsUzcufWA094Hx1uq0G20l0OwMrP+XF59gcKx8JP77pO3m998s/Yw/nLVXnrrpQBsXJUFMLEnmlFmN/yDRSkA2wbEgAA//syxAQACKRzd7zHgAkGB+81hgxyg9V/KSvjePEM6MTwDABAfIScR33O56q5d4xqkH7v3jiaZMD6kY9sjxrY2dnb1HHfvNR/kWIABj/dYQ11+H0jIKJAJJKoO2kaXeWiJIkiSIKkCp6SSSRawEonOLl37VSoUBXLB1R4RArEQNHoKne/wVBU9wWDv4KhL8s9QNP/QiqohANaOyIgAP/7MsQEgAhwYVvmPMihFovqvMwtRAH6Ae14cRCJA0gkI0l3oAaVhTxL2UFGwRUl00mkOm7spnrNztCVjBca9pe1ZAAImV6HsdkkYbqCJBixaWQQZZKZsggAaovjuRz0ay4sAStsBa8qCRLYzJqRvdo6N8kxL5ulvc1t68seeejKSpp09k0Niw9j0xU7cwYDINIb9ZH0VZtohLZJIkj/+zLEA4AIWItlrCBPcRURrbawIAYAJxeV16k/ZdmXyuGXKtUDPLTyWvc8HhHuEmbDWxZs3a26Jzoe0n+dLpP9moqDULbjgomp6BR7tp47Kkb/Yy7HHGiQALQa4vBYdia742/8Tg6Ha/Yveot5iAggAUDAwPPgRG2IQAAAAjEAwP1yvoQIToEAAAQ5YPg+BwcOf+D4PhgAJtta7sOB//swxAOACHRxgbj0gAENjex3sIAAQAgIBAQABwvF95I9BqsaLjRfG8H8voXioPoFOTnP5fr6BAbTCiaJqU//xNPUyOwkrvuV+H0skfwwkh/8uGgaN7U4ykgBI0Wl0NRp9iTTuOtTP3h74fLq2RJI5YD4IhSIZoj1X1UVJEZr6+eMZdiQADi2WsYqaj6u1HKNo9Ta1BZ2GWfu2RpE//syxAOAyERfc6ekbHEFiy24x5gugCwNDM0QkIOIpArkSBqEiqI+lT4jPXA6p0BJyc7A/ueQIEDN8GVxZ0NRU6hwZWZ+u0vmJAcZH1s/fvWToCKjwqgrRCT5TA2SpWReMQaRbtiwvwoHGQwVTzCMlEnyNn9u7MLAVgshUNiq2C20CCygTEZw56WOpYszR3GtXoW6ht/2WRFEABIUbP/7MsQFgAjAk2OsvQGxFRLo9YYU3I5XmAGmX2GjdKVSyEyfEei2W4xByQeX12Jv+JSUCUNe3dQcxD//+rd/xZysTZIrIiZR7qJWtsem773JLgTX0uaaZAEhq87YWCLAk2QPRDsijCdQMyTfTUASGYWdhh0rvEmDrF/obq13lSbEnO6iu0XtJAY0AlnTooDLWLYz1nXalTIJHLdbYmT/+zLEA4AHVLVPoTyjMJ8D5egwvAIAa4iOYBvORuqckKIjmT0f3wGoJDpymlsoq0IgUcZlalKJoqD63behXSb3dH1aMG7tj51oii6lBlJ0AStbgiTFQn40KM3C3KpNO+tnib+WCg+IpL/ez9P/2v9tCgACxBbaTwBY2euQgIjICwBbIKp9DCz6zvsneDLl1hU6BTvZ5Wj+z/wVV9QI//swxBYABVwfGUM8wlB8giG0EIgOCIelakAcALdhRIwrRYRkcReWf6vb///KypL96vYV11222AVLFlA4Q0hOHgNAKIBOJRUqoJdlVUxBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//syxDSDwxQk0ISZIHgAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQ==",soundByteArray$e=base64SoundToByteArray(phetAudioContext$1,soundURI$e),unlock$e=asyncLoader.createLock(soundURI$e),wrappedAudioBuffer$e=new WrappedAudioBuffer;let unlocked$e=!1;const safeUnlock$e=()=>{unlocked$e||(unlock$e(),unlocked$e=!0)},onDecodeSuccess$e=o=>{wrappedAudioBuffer$e.audioBufferProperty.value===null&&(wrappedAudioBuffer$e.audioBufferProperty.set(o),safeUnlock$e())},onDecodeError$e=o=>{console.warn("decode of audio data failed, using stubbed sound, error: "+o),wrappedAudioBuffer$e.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$e()},decodePromise$e=phetAudioContext$1.decodeAudioData(soundByteArray$e.buffer,onDecodeSuccess$e,onDecodeError$e);decodePromise$e&&decodePromise$e.then(o=>{wrappedAudioBuffer$e.audioBufferProperty.value===null&&(wrappedAudioBuffer$e.audioBufferProperty.set(o),safeUnlock$e())}).catch(o=>{console.warn("promise rejection caught for audio decode, error = "+o),safeUnlock$e()});const switchToRightSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$e,{soundClipOptions:{initialOutputLevel:.2},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("switchToRightSoundPlayer",switchToRightSoundPlayer);const DEFAULT_SIZE=new Dimension2(60,30);class ToggleSwitch extends Voicing(Node$2){constructor(e,t,n,r){assert&&assertMutuallyExclusiveOptions(r,["a11yName"],["innerContent","voicingNameResponse"]);const s=optionize()({size:DEFAULT_SIZE,toggleWhileDragging:null,dragThreshold:3,toggleThreshold:1,thumbFill:null,thumbStroke:"black",thumbTouchAreaXDilation:8,thumbTouchAreaYDilation:8,thumbMouseAreaXDilation:0,thumbMouseAreaYDilation:0,trackFillLeft:null,trackFillRight:null,trackStroke:"black",cursor:"pointer",disabledOpacity:SceneryConstants.DISABLED_OPACITY,switchToLeftSoundPlayer,switchToRightSoundPlayer,tandem:Tandem.REQUIRED,tandemNameSuffix:"Switch",phetioEventType:EventType.USER,phetioReadOnly:PhetioObject.DEFAULT_OPTIONS.phetioReadOnly,visiblePropertyOptions:{phetioFeatured:!0},phetioEnabledPropertyInstrumented:!0,phetioFeatured:!0,tagName:"button",ariaRole:"switch",a11yName:null,leftValueContextResponse:null,rightValueContextResponse:null},r);let a=null;(!s.trackFillLeft||!s.trackFillRight)&&(a=new LinearGradient(0,0,0,s.size.height).addColorStop(0,"rgb( 40, 40, 40 )").addColorStop(1,"rgb( 200, 200, 200 )")),s.trackFillLeft=s.trackFillLeft||a,s.trackFillRight=s.trackFillRight||a,s.thumbFill=s.thumbFill||new LinearGradient(0,0,0,s.size.height).addColorStop(0,"white").addColorStop(1,"rgb( 200, 200, 200 )"),s.a11yName&&(s.voicingNameResponse=s.a11yName,s.innerContent=s.a11yName),super(),this.onInputEmitter=new Emitter;const l=s.size.height/2,d=new Rectangle(0,0,s.size.width,s.size.height,l,l,{stroke:s.trackStroke,fill:s.trackFillLeft});this.addChild(d);const c=new Rectangle(0,0,s.size.width,s.size.height,l,l,{stroke:s.trackStroke,fill:s.trackFillRight});this.addChild(c);const y=new Rectangle(0,0,.5*s.size.width,s.size.height,l,l,{fill:s.thumbFill,stroke:s.thumbStroke});this.addChild(y),(s.thumbTouchAreaXDilation||s.thumbTouchAreaYDilation)&&(y.touchArea=Shape$1.roundRect(-s.thumbTouchAreaXDilation,-s.thumbTouchAreaYDilation,.5*s.size.width+2*s.thumbTouchAreaXDilation,s.size.height+2*s.thumbTouchAreaYDilation,l,l)),(s.thumbMouseAreaXDilation||s.thumbMouseAreaYDilation)&&(y.mouseArea=Shape$1.roundRect(-s.thumbMouseAreaXDilation,-s.thumbMouseAreaYDilation,.5*s.size.width+2*s.thumbMouseAreaXDilation,s.size.height+2*s.thumbMouseAreaYDilation,l,l));const m=X=>{const ae=d.lineWidth/2;X===t?y.left=-ae:y.right=s.size.width+ae,c.rectWidth=y.right-ae,this.setPDOMAttribute("aria-pressed",X!==t),this.setPDOMAttribute("aria-checked",X!==t)};e.link(m);const O=s.dragThreshold*s.dragThreshold,D=new Vector2(0,0);let z=!1;const w=new PhetioAction$1(X=>{e.value=X,this.onInputEmitter.emit()},{parameters:[{validValues:[t,n],phetioPrivate:!0}],tandem:s.tandem.createTandem("toggleAction"),phetioDocumentation:"Occurs when the switch is toggled via user interaction",phetioReadOnly:s.phetioReadOnly,phetioEventType:EventType.USER});this.onInputEmitter.addListener(()=>{e.value===t?s.switchToLeftSoundPlayer.play():s.switchToRightSoundPlayer.play();const X=e.value===n?s.rightValueContextResponse:s.leftValueContextResponse;X&&(this.alertDescriptionUtterance(X),this.voicingSpeakResponse({contextResponse:Utterance.alertableToText(X)}))});const N=()=>y.centerX<d.centerX?t:n,H=new DragListener({tandem:s.tandem.createTandem("dragListener"),canStartPress:X=>X&&(X.type==="move"||X.type==="enter")?_.includes(X.trail.nodes,y):!0,start:()=>{D.setXY(0,0),z=!1},drag:(X,ae)=>{D.add(ae.modelDelta),z=z||D.magnitudeSquared>O;const oe=ae.getCurrentTarget().globalToLocalPoint(X.pointer.point),ue=y.width/2,fe=d.lineWidth/2;y.centerX=DotUtils.clamp(oe.x,ue-fe,s.size.width-ue+fe),c.rectWidth=y.right-fe;const be=oe.x<(1-2*s.toggleThreshold)*ue||oe.x>(-1+2*s.toggleThreshold)*ue+s.size.width,Ae=N();(s.toggleWhileDragging===!0||be&&s.toggleWhileDragging===null)&&e.value!==Ae&&w.execute(Ae)},end:()=>{const X=e.value===t?n:t,ae=z?N():X;e.value!==ae&&w.execute(ae),m(ae)},canClick:!0});this.addInputListener(H),this.mutate(s),this.addLinkedElement(e,{tandemName:"property"}),this.switchToLeftSoundPlayer=s.switchToLeftSoundPlayer,this.switchToRightSoundPlayer=s.switchToRightSoundPlayer,this.disposeToggleSwitch=()=>{d.dispose(),c.dispose(),e.unlink(m),w.dispose(),H.dispose(),this.onInputEmitter.dispose()}}dispose(){this.disposeToggleSwitch(),super.dispose()}}sun.register("ToggleSwitch",ToggleSwitch);const DEFAULT_SET_LABEL_ENABLED=(o,e)=>{o.opacity=e?1:SceneryConstants.DISABLED_OPACITY};class ABSwitch extends HBox{constructor(e,t,n,r,s,a){var z,w;assert&&assert(n.tandem,"labelA must have a tandem"),assert&&assert(s.tandem,"labelB must have a tandem");const l=optionize()({toggleSwitchOptions:{enabledPropertyOptions:{phetioFeatured:!1}},setLabelEnabled:DEFAULT_SET_LABEL_ENABLED,centerOnSwitch:!1,cursor:"pointer",disabledOpacity:SceneryConstants.DISABLED_OPACITY,spacing:8,tandem:Tandem.REQUIRED,tandemNameSuffix:"Switch",visiblePropertyOptions:{phetioFeatured:!0},phetioEnabledPropertyInstrumented:!0},a),d=new ToggleSwitch(e,t,r,combineOptions({tandem:l.tandem.createTandem("toggleSwitch")},l.toggleSwitchOptions));let c=n,y=s;if(l.centerOnSwitch){const N=new AlignGroup;c=new AlignBox(n,{group:N,xAlign:"right"}),y=new AlignBox(s,{group:N,xAlign:"left"})}l.children=[c,d,y],super(l),this.onInputEmitter=new Emitter,this.property=e,this.valueA=t,this.valueB=r,this.labelA=n,this.labelB=s,this.toggleSwitch=d,this.setLabelEnabled=l.setLabelEnabled;const m=()=>this.updateLabelsEnabled();e.link(m);const O=new PressListener({release:()=>{const N=e.value;e.value=t,N!==t&&this.onInputEmitter.emit()},tandem:n.tandem.createTandem("pressListener")});n.addInputListener(O);const D=new PressListener({release:()=>{const N=e.value;e.value=r,N!==r&&this.onInputEmitter.emit()},tandem:s.tandem.createTandem("pressListener")});s.addInputListener(D),d.onInputEmitter.addListener(()=>this.onInputEmitter.emit()),this.onInputEmitter.addListener(()=>{e.value===r&&d.switchToRightSoundPlayer.play(),e.value===t&&d.switchToLeftSoundPlayer.play()}),this.disposeABSwitch=()=>{e.unlink(m),d.dispose(),this.onInputEmitter.dispose(),n.removeInputListener(O),s.removeInputListener(D),O.dispose(),D.dispose()},assert&&((w=(z=phet==null?void 0:phet.chipper)==null?void 0:z.queryParameters)!=null&&w.binder)&&InstanceRegistry.registerDataURL("sun","ABSwitch",this)}dispose(){this.disposeABSwitch(),super.dispose()}onEnabledPropertyChange(e){!e&&this.interruptSubtreeInput(),this.inputEnabled=e,this.toggleSwitch.enabled=e,this.updateLabelsEnabled()}updateLabelsEnabled(){this.setLabelEnabled(this.labelA,this.enabled&&this.property.value===this.valueA),this.setLabelEnabled(this.labelB,this.enabled&&this.property.value===this.valueB)}}sun.register("ABSwitch",ABSwitch);const soundURI$d="data:audio/mpeg;base64,//swxAAABSAbF7TAgDE5nqu/MHICAAAAcDYkDIEtmZ+0OAIDonAEAIOjgnenW/yhz/g+fh+CEocif//+c5RVQlRIdHdXcHffj/DYYCgBdaS6OzOU+xCNTd7EPI6nQ7mODNUkXlljx1AXgvbsgTi8z3+Z7a8aMfHP9uQFmXb1f/cmZM/9//sIhYP//sNqQJAgNJhWTyGAwFAoAATS//syxAeACW0Hgbi1EBESBuvjNGAAfDtZrw0MQaBPJj2MwQyJDLEhJZGoPjAvCMnP3dlJiAtJ8xr/PKk5hYV//3KDxif//6MYVcnt//+VFswo04EQAACAAC9YdezBqNoZHHQDlUSCuyZAkxazLI1qAeiR+JfccaBj1xti9B5JXrESzzBnSIgoXKxEzkQCos+pbPmxfwWXkwAAFm+93//7MsQDgAh4Z1G5gwABEY3y9x5iAuzlQAAAAAB2Wop4QsaAhgpWdRTKJsZcpp1XP57ykSikyYckLZ4Ty1TSs+HageepBZpVjXhgAMSIXXKmU65I0d/7dt7v7sNgMBwALVb09GkvHVk7fqBciIEitH44DchaeFCkbZVn3vi+3iz997uspO3MNCwv4nKHDdB/+gTro/8WA6oYAgMAeW//+zLEAwAIZH9bHaGAAQMgrTTxid9Ko07zWxQmamYZMUXJVhdXnyiL/VNVCqJJVOgImNStCjd9bH2ZjwZ/qQYUyG79QVWCpgKmMChqVd/4VIkkywFXa2uRpIAhLLU5m1VG6LimpHOKzIapjKZdQGJoCUbq7bMoVyt+j5W6t+WZ/r/KqPLMbv1Kxurf//8tBTuFZBUABV3GwiMDZuFj//swxAUCB4SDK0ywaICeAyN0wyROlYmGu6/rSDZ4E2kDhIFxZeHE1XJXBGqqqgLGqsZQ8m6ArsXr1fUvL1lChr+v/7fq//SC5HLZU2AEjwW0VUCig+dQNmTNmsUQ+tQt+EhX+skFfU3+n+u7/hV6TEFNRTMuOTkuNaqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq",soundByteArray$d=base64SoundToByteArray(phetAudioContext$1,soundURI$d),unlock$d=asyncLoader.createLock(soundURI$d),wrappedAudioBuffer$d=new WrappedAudioBuffer;let unlocked$d=!1;const safeUnlock$d=()=>{unlocked$d||(unlock$d(),unlocked$d=!0)},onDecodeSuccess$d=o=>{wrappedAudioBuffer$d.audioBufferProperty.value===null&&(wrappedAudioBuffer$d.audioBufferProperty.set(o),safeUnlock$d())},onDecodeError$d=o=>{console.warn("decode of audio data failed, using stubbed sound, error: "+o),wrappedAudioBuffer$d.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$d()},decodePromise$d=phetAudioContext$1.decodeAudioData(soundByteArray$d.buffer,onDecodeSuccess$d,onDecodeError$d);decodePromise$d&&decodePromise$d.then(o=>{wrappedAudioBuffer$d.audioBufferProperty.value===null&&(wrappedAudioBuffer$d.audioBufferProperty.set(o),safeUnlock$d())}).catch(o=>{console.warn("promise rejection caught for audio decode, error = "+o),safeUnlock$d()});const accordionBoxClosedSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$d,{soundClipOptions:{initialOutputLevel:.5},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("accordionBoxClosedSoundPlayer",accordionBoxClosedSoundPlayer);const soundURI$c="data:audio/mpeg;base64,//swxAAABsArNnTzABEnmTA3HoACAAIOAYznNNVnYDYAWAjClBSA3BwKB48VkSUAABBynBhYP5QMCc+T4JnwQcoH/6gff/Of/l4gAIJkjluslkskluuAAAkTmCV7K1w6pqz7VkryDnmQVVFCJY0HRFDgrNPT7QRsUHNV+KVNJRPtYt0/426/nj/Tv/sPVjjhtrzPbywAATqIdRsL//syxAOACHStW/2RACEMj6e2smAEqYAYhGmdJfGbQRJM6d5rUVhcXmZTOP9blIoBChWlL5hQoqBgpUdHqJ/1McBGpaGctDO3++hgIUqDV8QgqAAntdpnEwAD6ruLLBhIIEPkpGtP5xWnwVF2czcptv1Fgk0VRRGN9VJRU46pQrSVRX///853QKKZ0dz3cGnwCKBwcHYEIC0hEM5EMv/7MsQEAAiQXW+5hIAREZRslzKwACEMBgAAD9/MyuFW/l8vMAkS99TuX45zufo9JjH/gbUAtafz/MqCaqJP4IIAARGcawPpR8H3iefS7zg45qAIBFAAV1AtJXsx44xwqAZ24lKIsEc5bDMUuS6XnBEXQqAakxM3KX8vlruv28Pc++21X/p71t0ufET/PUOSB+v8FT3Fl3GALLrbdbr/+zLEA4AIWHtvuPWAEROSLXcegALRIIBAAAAIpME09Jpkm6HEpcYWjTFeQLCjn4NAjRM5fbfr4UULuXdO+HtlGqi0a/9EFQ66zxGCz/4GGlyg0HFHJZM7ZIAwEAAAErGUoi0JXI6UF+hiurPpjdxalUIbk1pRYWEUpY39w/BVt/p1i48ySduL+KRKEg8sPo/yoV/yLlIIpJIQSCOJ//swxAODxLAbO7xggDAAADSAAAAEweQCRznEiWHEqW49z3nuJf8Fbqzvw1+e6j3TPf/BakxBTUUzLjk5LjWqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq",soundByteArray$c=base64SoundToByteArray(phetAudioContext$1,soundURI$c),unlock$c=asyncLoader.createLock(soundURI$c),wrappedAudioBuffer$c=new WrappedAudioBuffer;let unlocked$c=!1;const safeUnlock$c=()=>{unlocked$c||(unlock$c(),unlocked$c=!0)},onDecodeSuccess$c=o=>{wrappedAudioBuffer$c.audioBufferProperty.value===null&&(wrappedAudioBuffer$c.audioBufferProperty.set(o),safeUnlock$c())},onDecodeError$c=o=>{console.warn("decode of audio data failed, using stubbed sound, error: "+o),wrappedAudioBuffer$c.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$c()},decodePromise$c=phetAudioContext$1.decodeAudioData(soundByteArray$c.buffer,onDecodeSuccess$c,onDecodeError$c);decodePromise$c&&decodePromise$c.then(o=>{wrappedAudioBuffer$c.audioBufferProperty.value===null&&(wrappedAudioBuffer$c.audioBufferProperty.set(o),safeUnlock$c())}).catch(o=>{console.warn("promise rejection caught for audio decode, error = "+o),safeUnlock$c()});const accordionBoxOpenedSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$c,{soundClipOptions:{initialOutputLevel:.5},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("accordionBoxOpenedSoundPlayer",accordionBoxOpenedSoundPlayer);function getGroupItemNodes(o,e){return o.map(t=>(assert&&assert(!t.node,"Use createNode instead of node"),t.createNode(e&&t.tandemName?e.createTandem(t.tandemName):Tandem.OPTIONAL)))}class ToggleNode extends Node$2{constructor(e,t,n){var l;const r=optionize()({alignChildren:ToggleNode.CENTER,unselectedChildrenSceneGraphStrategy:"included"},n),s=getGroupItemNodes(t,(l=r.tandem)==null?void 0:l.createTandem("elements"));r.children=s,r.alignChildren(r.children),super(r);const a=d=>{const c=[];for(let y=0;y<t.length;y++){const O=t[y].value===d;s[y].visible=O,O&&c.push(s[y])}assert&&assert(c.length===1,`Wrong number of matches: ${c.length}`),r.unselectedChildrenSceneGraphStrategy==="excluded"&&(this.children=c)};e.link(a),this.nodes=s,this.disposeToggleNode=function(){e.unlink(a),s.forEach(d=>d.dispose())}}dispose(){this.disposeToggleNode(),super.dispose()}static CENTER(e){for(let t=1;t<e.length;t++)e[t].center=e[0].center}static CENTER_X(e){for(let t=1;t<e.length;t++)e[t].centerX=e[0].centerX}static CENTER_Y(e){for(let t=1;t<e.length;t++)e[t].centerY=e[0].centerY}static LEFT(e){for(let t=1;t<e.length;t++)e[t].left=e[0].left}static BOTTOM(e){for(let t=1;t<e.length;t++)e[t].bottom=e[0].bottom}static CENTER_BOTTOM(e){for(let t=1;t<e.length;t++)e[t].centerBottom=e[0].centerBottom}static RIGHT(e){for(let t=1;t<e.length;t++)e[t].right=e[0].right}static NONE(e){}}sun.register("ToggleNode",ToggleNode);class BooleanToggleNode extends ToggleNode{constructor(e,t,n,r){super(e,[{value:!0,createNode:()=>t},{value:!1,createNode:()=>n}],r)}}sun.register("BooleanToggleNode",BooleanToggleNode);const soundURI$b="data:audio/mpeg;base64,//swxAAABdzxBVQRADFFHaWrNxAA6lqlJJEQAExvBGPAACkboRpPkaQjfnfz5z/zvk6HfzvO//6nzn/8n8Wo50RIcE5h04AwQBAIwAHAAGGKl44UnQFxrI7b6JARZgWfzRC7X2cjUCZG/TgeAfXziIB7AOgm3/Dlw5chhj/4aoJEnxOhr/+bkURTNP+37dN///zd5/WqMcFKOhHs//syxAMACFBlQBnXgAEQCuRbvLAAMh2cNcpzMDxDOxVSMlAjYsYOAlbMUQJ8hAkSABkLAPbGhQfrk7xotjWuYO3uc9FKLMWDXX39eK91WL8a4ARAYAYFAQZg2BpmMcTuZ9zx5rwEJFAZZgjA1mC8BuLASofGAOAMhs/U/GV40k0Dkso2K6Npbban/lI2Pnd6J3///t66ABTcYocjaf/7MsQDgAX8JTutseaw6RRnNZCJDkFdpsKMGTznDUOCFN3UBmSx0M4MasPlPO6Ar07embS//T/2f27SK//YUG03dpZI2oMaBN8MJA5tI6MkldtNZgLZ+dUe9LvQy6Odv9a9cr9VPRUaBtgq9EWmz6Xj3KZTzOv1ylUAC+0kk0oAEUn+I0HZ6jICCWahweFTlrz07qq2Ls9T3N/Xljr/+zLEEgAFSBMjQWBgUI8CIvA3vAbc1Vf//uoAABTglUoQoEElDJAFw2zpqMe6sqMzu59/9uvz32/t/onv/5FMQU1FMy45OS41VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//swxC8DwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",soundByteArray$b=base64SoundToByteArray(phetAudioContext$1,soundURI$b),unlock$b=asyncLoader.createLock(soundURI$b),wrappedAudioBuffer$b=new WrappedAudioBuffer;let unlocked$b=!1;const safeUnlock$b=()=>{unlocked$b||(unlock$b(),unlocked$b=!0)},onDecodeSuccess$b=o=>{wrappedAudioBuffer$b.audioBufferProperty.value===null&&(wrappedAudioBuffer$b.audioBufferProperty.set(o),safeUnlock$b())},onDecodeError$b=o=>{console.warn("decode of audio data failed, using stubbed sound, error: "+o),wrappedAudioBuffer$b.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$b()},decodePromise$b=phetAudioContext$1.decodeAudioData(soundByteArray$b.buffer,onDecodeSuccess$b,onDecodeError$b);decodePromise$b&&decodePromise$b.then(o=>{wrappedAudioBuffer$b.audioBufferProperty.value===null&&(wrappedAudioBuffer$b.audioBufferProperty.set(o),safeUnlock$b())}).catch(o=>{console.warn("promise rejection caught for audio decode, error = "+o),safeUnlock$b()});const toggleOffSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$b,{soundClipOptions:{initialOutputLevel:.7},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("toggleOffSoundPlayer",toggleOffSoundPlayer);const soundURI$a="data:audio/mpeg;base64,//swxAAAByAnDnWRADEZkyy3M0ALJQcEAMk013znpOVkWGNCg9vD4oJlTQcNxQBIJ0PxSUlJSCwfB8Hz+CAIAN/DH/gg78EHS7//9QIJSLq/wFHg+AwFAAAAAAfFvo6+SmoCLgXFVlJaBRlrks8EfgdfwNGNDIX1icAtgSPunkTDV42yCf+OWMmXBP4hJ/+RAZg8nmowgLA3CbIw//syxAOACDxjRhnXgAEOCqVnuqAERLIypm8wTCMyMagDMoYEAyRAAgCAQ9za/ELra7bNcNI9BMVmPx3pF7P7a/wstMTOL6//gwrwjSeVKioAAkqgEBggJpjMDZgiPBm+0xy7jJ482ppET4kOhhSHhg8CKMhgGASP09uliMpAaC+Gyqiiyjd9/QiJjzxL//////p9lUBqv86UKJp6wP/7MsQEgAWgKTMsbMLwvwUmdaCI3g146KXMwJVAHDYhAjvxQKf+SIBJPJWbIrZ/1aVs/k7Lf2//7QQilFbJGkVBjWeEsADYyEamuw0dNdmGxS1qmJCrAKrGJZ+TX/V+1zX0fitWyROXKQQiijI22kTAod9keTOhUgChZfu1VSXOv2ubHdG+h4jXu2fLMV00rQvomqNH8kAAAARGFj3/+zLEGgDFrBkvoeWAcKKCYxBngBYhtAWgNUjlVDuFH+de4qlT5ENEZ7/8t7K3cKjB1Q/kmOcRTEFNRTMuOTkuNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//swxDMDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",soundByteArray$a=base64SoundToByteArray(phetAudioContext$1,soundURI$a),unlock$a=asyncLoader.createLock(soundURI$a),wrappedAudioBuffer$a=new WrappedAudioBuffer;let unlocked$a=!1;const safeUnlock$a=()=>{unlocked$a||(unlock$a(),unlocked$a=!0)},onDecodeSuccess$a=o=>{wrappedAudioBuffer$a.audioBufferProperty.value===null&&(wrappedAudioBuffer$a.audioBufferProperty.set(o),safeUnlock$a())},onDecodeError$a=o=>{console.warn("decode of audio data failed, using stubbed sound, error: "+o),wrappedAudioBuffer$a.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$a()},decodePromise$a=phetAudioContext$1.decodeAudioData(soundByteArray$a.buffer,onDecodeSuccess$a,onDecodeError$a);decodePromise$a&&decodePromise$a.then(o=>{wrappedAudioBuffer$a.audioBufferProperty.value===null&&(wrappedAudioBuffer$a.audioBufferProperty.set(o),safeUnlock$a())}).catch(o=>{console.warn("promise rejection caught for audio decode, error = "+o),safeUnlock$a()});const toggleOnSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$a,{soundClipOptions:{initialOutputLevel:.7},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("toggleOnSoundPlayer",toggleOnSoundPlayer);const io=class io extends EnumerationValue{};io.IDLE=new io,io.OVER=new io,io.PRESSED=new io,io.enumeration=new Enumeration(io);let ButtonInteractionState=io;sun.register("ButtonInteractionState",ButtonInteractionState);const ColorConstants={LIGHT_BLUE:new Color(153,206,255),LIGHT_GRAY:new Color(220,220,220)},CONTRAST_FILTER=new Contrast(.7),BRIGHTNESS_FILTER=new Brightness(1.2);class ButtonNode extends Sizable(Voicing(Node$2)){constructor(e,t,n,r){var y;const s=optionize()({content:null,minUnstrokedWidth:null,minUnstrokedHeight:null,xMargin:10,yMargin:5,xAlign:"center",yAlign:"center",xContentOffset:0,yContentOffset:0,baseColor:ColorConstants.LIGHT_BLUE,cursor:"pointer",buttonAppearanceStrategy:ButtonNode.FlatAppearanceStrategy,buttonAppearanceStrategyOptions:{},contentAppearanceStrategy:null,contentAppearanceStrategyOptions:{},enabledAppearanceStrategy:(m,O,D,z)=>{D.filters=m?[]:[CONTRAST_FILTER,BRIGHTNESS_FILTER],z&&(z.filters=m?[]:[Grayscale.FULL],z.opacity=m?1:SceneryConstants.DISABLED_OPACITY)},disabledColor:ColorConstants.LIGHT_GRAY,aspectRatio:null,tagName:"button",tandemNameSuffix:"Button",visiblePropertyOptions:{phetioFeatured:!0},phetioEnabledPropertyInstrumented:!0},r);s.listenerOptions=combineOptions({tandem:(y=s.tandem)==null?void 0:y.createTandem("pressListener")},s.listenerOptions),assert&&s.enabledProperty&&assert(s.enabledProperty===e.enabledProperty,"if options.enabledProperty is provided, it must === buttonModel.enabledProperty"),s.enabledProperty=e.enabledProperty,assert&&assert(s.aspectRatio===null||isFinite(s.aspectRatio)&&s.aspectRatio>0,`ButtonNode aspectRatio should be a positive finite value if non-null. Instead received ${s.aspectRatio}.`),super(),this.buttonNodeConstraint=null,this.content=s.content,this.buttonModel=e,this._settableBaseColorProperty=new PaintColorProperty(s.baseColor),this._disabledColorProperty=new PaintColorProperty(s.disabledColor),this.baseColorProperty=new DerivedProperty([this._settableBaseColorProperty,this.enabledProperty,this._disabledColorProperty],(m,O,D)=>O?m:D),this._pressListener=e.createPressListener(s.listenerOptions),this.addInputListener(this._pressListener),assert&&assert(t.fill===null,"ButtonNode controls the fill for the buttonBackground"),t.fill=this.baseColorProperty,this.addChild(t);const a=new s.buttonAppearanceStrategy(t,n,this.baseColorProperty,s.buttonAppearanceStrategyOptions);let l;s.contentAppearanceStrategy&&s.content&&(l=new s.contentAppearanceStrategy(s.content,n,s.contentAppearanceStrategyOptions)),this.maxLineWidth=a.maxLineWidth;let d=null,c=null;if(s.content){const m=s.content;m.pickable=!1,this.buttonNodeConstraint=new ButtonNodeConstraint(this,{content:s.content,xMargin:s.xMargin,yMargin:s.yMargin,maxLineWidth:this.maxLineWidth,minUnstrokedWidth:s.minUnstrokedWidth,minUnstrokedHeight:s.minUnstrokedHeight,aspectRatio:s.aspectRatio}),this.layoutSizeProperty=this.buttonNodeConstraint.layoutSizeProperty,d=new AlignBox(m,{xAlign:s.xAlign,yAlign:s.yAlign,leftMargin:s.xMargin+s.xContentOffset,rightMargin:s.xMargin-s.xContentOffset,topMargin:s.yMargin+s.yContentOffset,bottomMargin:s.yMargin-s.yContentOffset}),c=Multilink.multilink([t.boundsProperty,this.layoutSizeProperty],(O,D)=>{d.alignBounds=Bounds2.point(O.center).dilatedXY(D.width/2,D.height/2)}),this.addChild(d)}else assert&&assert(s.minUnstrokedWidth!==null),assert&&assert(s.minUnstrokedHeight!==null),this.layoutSizeProperty=new TinyProperty(new Dimension2(s.minUnstrokedWidth+this.maxLineWidth,s.minUnstrokedHeight+this.maxLineWidth));this.mutate(s),this.enabledProperty.link(m=>s.enabledAppearanceStrategy(m,this,t,d)),this.disposeButtonNode=()=>{d&&d.dispose(),c&&c.dispose(),a.dispose&&a.dispose(),l&&l.dispose&&l.dispose(),this._pressListener.dispose(),this.baseColorProperty.dispose()}}dispose(){this.buttonNodeConstraint&&this.buttonNodeConstraint.dispose(),this.disposeButtonNode(),super.dispose()}setBaseColor(e){this._settableBaseColorProperty.paint=e}set baseColor(e){this.setBaseColor(e)}get baseColor(){return this.getBaseColor()}getBaseColor(){return this._settableBaseColorProperty.paint}pdomClick(){this._pressListener.click(null)}isPDOMClicking(){return this._pressListener.pdomClickingProperty.get()}}class FlatAppearanceStrategy{constructor(e,t,n,r){const s=new PaintColorProperty(n,{luminanceFactor:.4}),a=new PaintColorProperty(n,{luminanceFactor:-.4}),l=n,d=s,c=a,y=combineOptions({stroke:a},r),m=typeof y.lineWidth=="number"?y.lineWidth:1;e.stroke=y.stroke||a,e.lineWidth=m,this.maxLineWidth=e.hasStroke()?m:0,e.cachedPaints=[l,d,c];function O(D){switch(D){case ButtonInteractionState.IDLE:e.fill=l;break;case ButtonInteractionState.OVER:e.fill=d;break;case ButtonInteractionState.PRESSED:e.fill=c;break;default:throw new Error(`unsupported interactionState: ${D}`)}}t.link(O),this.disposeFlatAppearanceStrategy=()=>{t.hasListener(O)&&t.unlink(O),s.dispose(),a.dispose()}}dispose(){this.disposeFlatAppearanceStrategy()}}class ButtonNodeConstraint extends LayoutConstraint{constructor(e,t){super(e),this.layoutSizeProperty=new TinyProperty(new Dimension2(0,0)),this.isFirstLayout=!0,this.lastLocalPreferredWidth=0,this.lastLocalPreferredHeight=0,this.buttonNode=e,this.content=t.content,this.xMargin=t.xMargin,this.yMargin=t.yMargin,this.maxLineWidth=t.maxLineWidth,this.minUnstrokedWidth=t.minUnstrokedWidth,this.minUnstrokedHeight=t.minUnstrokedHeight,this.aspectRatio=t.aspectRatio,this.buttonNode.localPreferredWidthProperty.lazyLink(this._updateLayoutListener),this.buttonNode.localPreferredHeightProperty.lazyLink(this._updateLayoutListener),this.addNode(this.content,!1),this.layout()}layout(){super.layout();const e=this.buttonNode,t=this.content;let n=Math.max(this.isFirstLayout||e.widthSizable?(isWidthSizable(t)?t.minimumWidth||0:t.width)+this.xMargin*2:e.localMinimumWidth,this.minUnstrokedWidth===null?0:this.minUnstrokedWidth+this.maxLineWidth),r=Math.max(this.isFirstLayout||e.heightSizable?(isHeightSizable(t)?t.minimumHeight||0:t.height)+this.yMargin*2:e.localMinimumHeight,this.minUnstrokedHeight===null?0:this.minUnstrokedHeight+this.maxLineWidth);this.aspectRatio!==null&&(n<r*this.aspectRatio&&(n=r*this.aspectRatio),r<n/this.aspectRatio&&(r=n/this.aspectRatio)),this.lastLocalPreferredWidth=this.isFirstLayout||isWidthSizable(e)?Math.max(n,e.localPreferredWidth||0):this.lastLocalPreferredWidth,this.lastLocalPreferredHeight=this.isFirstLayout||isHeightSizable(e)?Math.max(r,e.localPreferredHeight||0):this.lastLocalPreferredHeight,this.isFirstLayout=!1,this.layoutSizeProperty.value=new Dimension2(this.lastLocalPreferredWidth,this.lastLocalPreferredHeight),e.localMinimumWidth=n,e.localMinimumHeight=r}dispose(){this.buttonNode.localPreferredWidthProperty.unlink(this._updateLayoutListener),this.buttonNode.localPreferredHeightProperty.unlink(this._updateLayoutListener),super.dispose()}}ButtonNode.FlatAppearanceStrategy=FlatAppearanceStrategy;sun.register("ButtonNode",ButtonNode);const VERTICAL_HIGHLIGHT_GRADIENT_LENGTH=7,HORIZONTAL_HIGHLIGHT_GRADIENT_LENGTH=7,SHADE_GRADIENT_LENGTH=3;class RectangularButton extends ButtonNode{constructor(e,t,n){const r=optionize()({size:null,minWidth:HORIZONTAL_HIGHLIGHT_GRADIENT_LENGTH+SHADE_GRADIENT_LENGTH,minHeight:VERTICAL_HIGHLIGHT_GRADIENT_LENGTH+SHADE_GRADIENT_LENGTH,xMargin:8,yMargin:5,touchAreaXDilation:0,touchAreaYDilation:0,mouseAreaXDilation:0,mouseAreaYDilation:0,touchAreaXShift:0,touchAreaYShift:0,mouseAreaXShift:0,mouseAreaYShift:0,stroke:null,lineWidth:.5,cornerRadius:4,leftTopCornerRadius:null,rightTopCornerRadius:null,leftBottomCornerRadius:null,rightBottomCornerRadius:null,buttonAppearanceStrategy:RectangularButton.ThreeDAppearanceStrategy},n);r.content||assert&&assert(r.size!==void 0,"button dimensions needed if no content is supplied."),r.size?(assert&&assert(r.xMargin<r.size.width,"xMargin cannot be larger than width"),assert&&assert(r.yMargin<r.size.height,"yMargin cannot be larger than height"),r.minUnstrokedWidth=r.size.width,r.minUnstrokedHeight=r.size.height):(r.minWidth!==void 0&&(r.minUnstrokedWidth=r.minWidth),r.minHeight!==void 0&&(r.minUnstrokedHeight=r.minHeight)),r.buttonAppearanceStrategyOptions||(r.buttonAppearanceStrategyOptions={stroke:r.stroke,lineWidth:r.lineWidth});let s,a;r.size?(s=r.size.width,a=r.size.height):(s=Math.max(r.content?r.content.width+r.xMargin*2:0,r.minWidth),a=Math.max(r.content?r.content.height+r.yMargin*2:0,r.minHeight));const l=new Path(createButtonShape(s,a,r));if(r.size&&r.content){const c=r.content,y=Math.min((r.size.width-r.xMargin*2)/c.width,(r.size.height-r.yMargin*2)/c.height);r.content=new Node$2({children:[c],scale:y})}super(e,l,t,r);let d=!0;Multilink.multilink([this.isWidthResizableProperty,this.isHeightResizableProperty,this.layoutSizeProperty],(c,y,m)=>{(c||y)&&(l.shape=createButtonShape(c?m.width-this.maxLineWidth:s,y?m.height-this.maxLineWidth:a,r),assert&&assert(!c||l.width<=m.width+1e-7,"button width cannot exceed layout width"),assert&&assert(!y||l.height<=m.height+1e-7,"button width cannot exceed layout height")),(d||c||y)&&(this.touchArea=l.localBounds.dilatedXY(r.touchAreaXDilation,r.touchAreaYDilation).shiftedXY(r.touchAreaXShift,r.touchAreaYShift),this.mouseArea=l.localBounds.dilatedXY(r.mouseAreaXDilation,r.mouseAreaYDilation).shiftedXY(r.mouseAreaXShift,r.mouseAreaYShift)),d=!1})}}function createButtonShape(o,e,t){const n=Math.min(o/2,e/2);return Shape$1.roundedRectangleWithRadii(0,0,o,e,{topLeft:Math.min(n,t.leftTopCornerRadius!==null?t.leftTopCornerRadius:t.cornerRadius),topRight:Math.min(n,t.rightTopCornerRadius!==null?t.rightTopCornerRadius:t.cornerRadius),bottomLeft:Math.min(n,t.leftBottomCornerRadius!==null?t.leftBottomCornerRadius:t.cornerRadius),bottomRight:Math.min(n,t.rightBottomCornerRadius!==null?t.rightBottomCornerRadius:t.cornerRadius)})}let ThreeDAppearanceStrategy$1=class{constructor(e,t,n,r){const s=r&&r.stroke?r.stroke:new PaintColorProperty(n,{luminanceFactor:-.4}),a=r&&r.lineWidth!==void 0?r.lineWidth:.5,l=optionize()({stroke:s,lineWidth:a,overStroke:s,overLineWidth:a,overFill:n,overButtonOpacity:1,selectedStroke:s,selectedLineWidth:a,selectedButtonOpacity:1,deselectedStroke:s,deselectedLineWidth:a,deselectedButtonOpacity:1},r),d=new PaintColorProperty(n,{luminanceFactor:.7}),c=new PaintColorProperty(n,{luminanceFactor:.5}),y=new PaintColorProperty(n,{luminanceFactor:.2}),m=new PaintColorProperty(n,{luminanceFactor:-.3}),O=new PaintColorProperty(n,{luminanceFactor:-.4}),D=new PaintColorProperty(n,{luminanceFactor:-.5}),z=new DerivedProperty([n],ae=>ae.withAlpha(0)),w=new Color(255,255,255,.7),N=new Path(null,{stroke:l.stroke,lineWidth:l.lineWidth,pickable:!1});e.addChild(N),this.maxLineWidth=typeof l.lineWidth=="number"?l.lineWidth:0;let H;const X=()=>{const ae=e.shape.bounds.width,oe=e.shape.bounds.height;N.shape=e.shape,assert&&assert(ae>=HORIZONTAL_HIGHLIGHT_GRADIENT_LENGTH+SHADE_GRADIENT_LENGTH),assert&&assert(oe>=VERTICAL_HIGHLIGHT_GRADIENT_LENGTH+SHADE_GRADIENT_LENGTH);const ue=Math.min(VERTICAL_HIGHLIGHT_GRADIENT_LENGTH/oe,1),fe=Math.max(1-SHADE_GRADIENT_LENGTH/oe,0),be=Math.min(HORIZONTAL_HIGHLIGHT_GRADIENT_LENGTH/ae,1),Ae=Math.max(1-SHADE_GRADIENT_LENGTH/ae,0),W=new LinearGradient(0,0,0,oe).addColorStop(0,d).addColorStop(ue,n).addColorStop(fe,n).addColorStop(1,D),J=new LinearGradient(0,0,ae,0).addColorStop(0,w).addColorStop(be,z).addColorStop(Ae,z).addColorStop(1,D),Ue=new LinearGradient(0,0,0,oe).addColorStop(0,d).addColorStop(ue,c).addColorStop(fe,c).addColorStop(1,D),gt=new LinearGradient(0,0,ae,0).addColorStop(0,w).addColorStop(be/2,new Color(255,255,255,0)).addColorStop(Ae,z).addColorStop(1,m),Te=new LinearGradient(0,0,0,oe).addColorStop(0,d).addColorStop(ue*.67,m).addColorStop(fe,y).addColorStop(1,D);e.cachedPaints=[W,Ue,Te],N.cachedPaints=[J,gt],H&&t.unlink(H),H=Et=>{switch(Et){case ButtonInteractionState.IDLE:e.fill=W,e.stroke=l.deselectedStroke,e.lineWidth=l.deselectedLineWidth,e.opacity=l.deselectedButtonOpacity,N.fill=J,N.opacity=l.deselectedButtonOpacity;break;case ButtonInteractionState.OVER:e.fill=Ue,e.stroke=l.overStroke,e.lineWidth=l.overLineWidth,e.opacity=l.overButtonOpacity,N.fill=gt,N.opacity=l.overButtonOpacity;break;case ButtonInteractionState.PRESSED:e.fill=Te,e.stroke=l.selectedStroke,e.lineWidth=l.selectedLineWidth,e.opacity=l.selectedButtonOpacity,N.fill=gt,N.opacity=l.selectedButtonOpacity;break;default:throw new Error(`unsupported interactionState: ${Et}`)}},t.link(H)};e.selfBoundsProperty.link(X),this.disposeThreeDAppearanceStrategy=()=>{e.selfBoundsProperty.unlink(X),t.hasListener(H)&&t.unlink(H),d.dispose(),c.dispose(),y.dispose(),m.dispose(),O.dispose(),D.dispose(),z.dispose()}}dispose(){this.disposeThreeDAppearanceStrategy()}};RectangularButton.ThreeDAppearanceStrategy=ThreeDAppearanceStrategy$1;sun.register("RectangularButton",RectangularButton);class ToggleButtonInteractionStateProperty extends DerivedProperty2{constructor(e){super([e.looksOverProperty,e.looksPressedProperty],(t,n)=>t&&!n?ButtonInteractionState.OVER:n?ButtonInteractionState.PRESSED:ButtonInteractionState.IDLE,{valueType:ButtonInteractionState})}}sun.register("ToggleButtonInteractionStateProperty",ToggleButtonInteractionStateProperty);class ButtonModel extends EnabledComponent{constructor(e){const t=optionize()({startCallback:_.noop,endCallback:_.noop,tandem:Tandem.REQUIRED,phetioState:PhetioObject.DEFAULT_OPTIONS.phetioState,phetioReadOnly:PhetioObject.DEFAULT_OPTIONS.phetioReadOnly,phetioFeatured:PhetioObject.DEFAULT_OPTIONS.phetioFeatured},e);t.enabledPropertyOptions=combineOptions({phetioState:t.phetioState,phetioReadOnly:t.phetioReadOnly,phetioDocumentation:"When disabled, the button is grayed out and cannot be pressed",phetioFeatured:!0},t.enabledPropertyOptions),super(t),this.overProperty=new BooleanProperty(!1),this.downProperty=new BooleanProperty(!1,{reentrant:!0}),this.focusedProperty=new BooleanProperty(!1),this.looksPressedProperty=new BooleanProperty(!1),this.looksOverProperty=new BooleanProperty(!1),this.produceSoundEmitter=new Emitter,this.interrupted=!1,this.listeners=[],this.looksPressedMultilink=null,this.looksOverMultilink=null,this.downProperty.lazyLink(n=>{n?t.startCallback():t.endCallback(this.looksOverProperty.get())}),this.enabledProperty.link(n=>{if(!n)for(let r=0;r<this.listeners.length;r++){const s=this.listeners[r];s.interrupt&&s.interrupt()}}),this.disposeButtonModel=()=>{this.overProperty.dispose(),this.downProperty.dispose(),this.produceSoundEmitter.dispose(),this.looksPressedMultilink&&this.looksPressedMultilink.dispose(),this.looksOverMultilink&&this.looksOverMultilink.dispose(),this.listeners=[]}}dispose(){this.disposeButtonModel(),super.dispose()}createPressListener(e){e=combineOptions({canStartPress:()=>this.enabledProperty.value},e);const t=new PressListener(e);this.listeners.push(t),t.isPressedProperty.lazyLink(s=>{this.interrupted=t.interrupted,this.downProperty.set(s)}),t.isOverProperty.lazyLink(this.overProperty.set.bind(this.overProperty)),t.isFocusedProperty.lazyLink(this.focusedProperty.set.bind(this.focusedProperty)),this.looksPressedMultilink&&this.looksPressedMultilink.dispose(),this.looksOverMultilink&&this.looksOverMultilink.dispose();const n=this.listeners.map(s=>s.looksPressedProperty);n.push(this.downProperty),this.looksPressedMultilink=Multilink.multilinkAny(n,(...s)=>{this.looksPressedProperty.value=_.reduce(s,(a,l)=>a||l,!1)});const r=this.listeners.map(s=>s.looksOverProperty);return this.looksOverMultilink=Multilink.multilinkAny(r,(...s)=>{this.looksOverProperty.value=_.reduce(s,(a,l)=>a||l,!1)}),t}}sun.register("ButtonModel",ButtonModel);class ToggleButtonModel extends ButtonModel{constructor(e,t,n,r){const s=optionize()({tandem:Tandem.REQUIRED},r);super(s),this.valueOff=e,this.valueOn=t,this.valueProperty=n;const a=d=>{(this.overProperty.get()||this.focusedProperty.get())&&this.enabledProperty.get()&&!this.interrupted&&(d||this.toggle())};this.downProperty.link(a),this.toggledEmitter=new Emitter({tandem:s.tandem.createTandem("toggledEmitter"),phetioDocumentation:"Emits when the button is toggled",phetioEventType:EventType.USER});const l=()=>{assert&&assert(this.valueProperty.value===this.valueOff||this.valueProperty.value===this.valueOn,`unrecognized value: ${this.valueProperty.value}`),this.valueProperty.value=this.valueProperty.value===this.valueOff?this.valueOn:this.valueOff};this.toggledEmitter.addListener(l),this.disposeToggleButtonModel=()=>{this.downProperty.unlink(a),this.toggledEmitter.dispose()}}dispose(){this.disposeToggleButtonModel(),super.dispose()}toggle(){this.toggledEmitter.emit(),this.produceSoundEmitter.emit()}}sun.register("ToggleButtonModel",ToggleButtonModel);class RectangularToggleButton extends RectangularButton{constructor(e,t,n,r){const s=optionize()({valueOffSoundPlayer:toggleOffSoundPlayer,valueOnSoundPlayer:toggleOnSoundPlayer,tandem:Tandem.REQUIRED,phetioFeatured:!0},r),a=new ToggleButtonModel(t,n,e,s),l=new ToggleButtonInteractionStateProperty(a);super(a,l,s),this.addLinkedElement(e,{tandemName:"property"});const d=()=>{e.value===t?s.valueOffSoundPlayer.play():e.value===n&&s.valueOnSoundPlayer.play()};this.buttonModel.produceSoundEmitter.addListener(d),this.disposeRectangularToggleButton=()=>{this.buttonModel.produceSoundEmitter.removeListener(d),a.dispose()}}dispose(){this.disposeRectangularToggleButton(),super.dispose()}}sun.register("RectangularToggleButton",RectangularToggleButton);class BooleanRectangularToggleButton extends RectangularToggleButton{constructor(e,t,n,r){const s=new BooleanToggleNode(e,t,n),a=optionize()({content:s,tandem:Tandem.REQUIRED},r);super(e,!1,!0,a),this.disposeBooleanRectangularToggleButton=()=>{s.dispose()}}dispose(){this.disposeBooleanRectangularToggleButton(),super.dispose()}}sun.register("BooleanRectangularToggleButton",BooleanRectangularToggleButton);const SYMBOL_RELATIVE_WIDTH=.6,RELATIVE_X_MARGIN=(1-SYMBOL_RELATIVE_WIDTH)/2;class ExpandCollapseButton extends BooleanRectangularToggleButton{constructor(e,t){var O,D;const n=optionize()({sideLength:25,stroke:"black",touchAreaXDilation:5,touchAreaYDilation:5,tandem:Tandem.REQUIRED,tandemNameSuffix:"Button"},t);n.cornerRadius=.1*n.sideLength,n.xMargin=RELATIVE_X_MARGIN*n.sideLength,n.yMargin=n.xMargin,n.buttonAppearanceStrategy=ButtonNode.FlatAppearanceStrategy;const r=SYMBOL_RELATIVE_WIDTH*n.sideLength,a={lineWidth:.15*n.sideLength,stroke:"white",centerX:n.sideLength/2,centerY:n.sideLength/2,pickable:!1},l=new Shape$1().moveTo(r/2,0).lineTo(r/2,r).moveTo(0,r/2).lineTo(r,r/2),d=new Path(l,a),c=new Shape$1().moveTo(-r/2,0).lineTo(r/2,0),y=new Path(c,a);super(e,y,d,n);const m=z=>{this.baseColor=z?"rgb( 255, 85, 0 )":"rgb( 0, 179, 0 )",this.setPDOMAttribute("aria-expanded",z)};e.link(m),assert&&((D=(O=phet==null?void 0:phet.chipper)==null?void 0:O.queryParameters)!=null&&D.binder)&&InstanceRegistry.registerDataURL("sun","ExpandCollapseButton",this),this.disposeExpandCollapseButton=()=>{e.unlink(m)}}dispose(){this.disposeExpandCollapseButton(),super.dispose()}}sun.register("ExpandCollapseButton",ExpandCollapseButton);const Ta=class Ta extends Sizable(Node$2){constructor(e,t){var O,D;const n=optionize()({titleNode:null,expandedProperty:null,resize:!0,overrideTitleNodePickable:!0,allowContentToOverlapTitle:!1,cursor:"pointer",lineWidth:1,cornerRadius:10,stroke:"black",fill:"rgb( 238, 238, 238 )",minWidth:0,titleAlignX:"center",titleAlignY:"center",titleXMargin:10,titleYMargin:2,titleXSpacing:5,showTitleWhenExpanded:!0,useExpandedBoundsWhenCollapsed:!0,titleBarExpandCollapse:!0,buttonAlign:"left",buttonXMargin:4,buttonYMargin:2,contentAlign:"center",contentVerticalAlign:"center",contentXMargin:15,contentYMargin:8,contentXSpacing:5,contentYSpacing:8,expandedSoundPlayer:accordionBoxOpenedSoundPlayer,collapsedSoundPlayer:accordionBoxClosedSoundPlayer,tagName:"div",headingTagName:"h3",accessibleNameBehavior:Ta.ACCORDION_BOX_ACCESSIBLE_NAME_BEHAVIOR,voicingNameResponse:null,voicingObjectResponse:null,voicingContextResponse:null,voicingHintResponse:null,tandem:Tandem.REQUIRED,tandemNameSuffix:"AccordionBox",phetioType:Ta.AccordionBoxIO,phetioEventType:EventType.USER,visiblePropertyOptions:{phetioFeatured:!0},titleBarOptions:{fill:null,stroke:null}},t);n.expandCollapseButtonOptions=combineOptions({sideLength:16,cursor:n.cursor,valueOnSoundPlayer:n.expandedSoundPlayer,valueOffSoundPlayer:n.collapsedSoundPlayer,voicingNameResponse:n.voicingNameResponse,voicingObjectResponse:n.voicingObjectResponse,voicingContextResponse:n.voicingContextResponse,voicingHintResponse:n.voicingHintResponse,tandem:n.tandem.createTandem("expandCollapseButton")},n.expandCollapseButtonOptions),super(),this.expandedBoxOutline=null,this.collapsedBoxOutline=null;let r=n.titleNode;r||(r=new Text("",{tandem:n.tandem.createTandem("titleText")}),this.disposeEmitter.addListener(()=>r.dispose())),n.overrideTitleNodePickable&&(r.pickable=!1),this.expandedProperty=n.expandedProperty,this.expandedProperty||(this.expandedProperty=new BooleanProperty(!0,{tandem:n.tandem.createTandem("expandedProperty"),phetioFeatured:!0}),this.disposeEmitter.addListener(()=>this.expandedProperty.dispose())),this.expandCollapseButton=new ExpandCollapseButton(this.expandedProperty,n.expandCollapseButtonOptions),this.disposeEmitter.addListener(()=>this.expandCollapseButton.dispose());const s={fill:n.fill,cornerRadius:n.cornerRadius};this.expandedBox=new Rectangle(s),this.collapsedBox=new Rectangle(s),this.expandedTitleBar=new InteractiveHighlightPath(null,combineOptions({lineWidth:n.lineWidth,cursor:n.cursor},n.titleBarOptions)),this.expandedBox.addChild(this.expandedTitleBar),this.collapsedTitleBar=new InteractiveHighlightRectangle(combineOptions({cornerRadius:n.cornerRadius,cursor:n.cursor},n.titleBarOptions)),this.collapsedBox.addChild(this.collapsedTitleBar),this.disposeEmitter.addListener(()=>{this.collapsedTitleBar.dispose(),this.expandedTitleBar.dispose()}),n.titleBarExpandCollapse?this.collapsedTitleBar.addInputListener({down:()=>{this.expandCollapseButton.isEnabled()&&(this.phetioStartEvent("expanded"),this.expandedProperty.value=!0,n.expandedSoundPlayer.play(),this.phetioEndEvent())}}):(this.expandedTitleBar.interactiveHighlight="invisible",this.collapsedTitleBar.interactiveHighlight="invisible"),n.showTitleWhenExpanded&&n.titleBarExpandCollapse&&this.expandedTitleBar.addInputListener({down:()=>{this.expandCollapseButton.isEnabled()&&(this.phetioStartEvent("collapsed"),n.collapsedSoundPlayer.play(),this.expandedProperty.value=!1,this.phetioEndEvent())}});const a=()=>{const z=this.expandCollapseButton.visible&&this.expandCollapseButton.pickable;this.collapsedTitleBar.pickable=z,this.expandedTitleBar.pickable=z};if(this.expandCollapseButton.visibleProperty.lazyLink(a),this.expandCollapseButton.pickableProperty.lazyLink(a),this.expandCollapseButton.enabledProperty.link(z=>{const w=n.titleBarExpandCollapse&&z;this.collapsedTitleBar.cursor=w&&n.cursor||null,this.expandedTitleBar.cursor=w&&n.cursor||null}),this.expandCollapseButton.setFocusHighlight(new HighlightFromNode$1(this.expandedTitleBar)),this.expandedBox.addChild(e),n.stroke){const z={stroke:n.stroke,lineWidth:n.lineWidth,cornerRadius:n.cornerRadius,pickable:!1};this.expandedBoxOutline=new Rectangle(z),this.expandedBox.addChild(this.expandedBoxOutline),this.collapsedBoxOutline=new Rectangle(z),this.collapsedBox.addChild(this.collapsedBoxOutline)}const l=new Node$2({excludeInvisibleChildrenFromBounds:!n.useExpandedBoundsWhenCollapsed});this.addChild(l);const d=new Node$2({tagName:"div",ariaRole:"region",pdomOrder:[e],ariaLabelledbyAssociations:[{otherNode:this.expandCollapseButton,otherElementName:PDOMPeer$1.PRIMARY_SIBLING,thisElementName:PDOMPeer$1.PRIMARY_SIBLING}]}),c=new Node$2({tagName:n.headingTagName,pdomOrder:[this.expandCollapseButton]}),y=new Node$2({children:[c,d]});this.addChild(y),this.constraint=new AccordionBoxConstraint(this,e,l,this.expandedBox,this.collapsedBox,this.expandedTitleBar,this.collapsedTitleBar,this.expandedBoxOutline,this.collapsedBoxOutline,r,this.expandCollapseButton,n),this.constraint.updateLayout(),this.constraint.enabled=n.resize;const m=()=>{const z=this.expandedProperty.value;this.expandedBox.visible=z,this.collapsedBox.visible=!z,r.visible=z&&n.showTitleWhenExpanded||!z,y.setPDOMAttribute("aria-hidden",!z),this.expandCollapseButton.voicingSpeakFullResponse({hintResponse:null})};this.expandedProperty.link(m),this.disposeEmitter.addListener(()=>this.expandedProperty.unlink(m)),this.mutate(_.omit(n,"cursor")),this.resetAccordionBox=()=>{n.expandedProperty||this.expandedProperty.reset()},assert&&((D=(O=phet==null?void 0:phet.chipper)==null?void 0:O.queryParameters)!=null&&D.binder)&&InstanceRegistry.registerDataURL("sun","AccordionBox",this)}getCollapsedBoxHeight(){const e=this.constraint.lastCollapsedBoxHeight;return assert&&assert(e!==null),e}getExpandedBoxHeight(){const e=this.constraint.lastExpandedBoxHeight;return assert&&assert(e!==null),e}reset(){this.resetAccordionBox()}};Ta.AccordionBoxIO=new IOType("AccordionBoxIO",{valueType:Ta,supertype:Node$2.NodeIO,events:["expanded","collapsed"]}),Ta.ACCORDION_BOX_ACCESSIBLE_NAME_BEHAVIOR=(e,t,n,r)=>(r.push(()=>{e.expandCollapseButton.accessibleName=n}),t);let AccordionBox=Ta;class InteractiveHighlightPath extends InteractiveHighlighting(Path){}class InteractiveHighlightRectangle extends InteractiveHighlighting(Rectangle){}class AccordionBoxConstraint extends LayoutConstraint{constructor(e,t,n,r,s,a,l,d,c,y,m,O){super(e),this.accordionBox=e,this.contentNode=t,this.containerNode=n,this.expandedBox=r,this.collapsedBox=s,this.expandedTitleBar=a,this.collapsedTitleBar=l,this.expandedBoxOutline=d,this.collapsedBoxOutline=c,this.titleNode=y,this.expandCollapseButton=m,this.options=O,this.lastCollapsedBoxHeight=null,this.lastExpandedBoxHeight=null,this.accordionBox.localPreferredWidthProperty.lazyLink(this._updateLayoutListener),this.accordionBox.localPreferredHeightProperty.lazyLink(this._updateLayoutListener),this.accordionBox.expandedProperty.lazyLink(this._updateLayoutListener),this.addNode(t),this.addNode(y)}layout(){super.layout();const e=this.options;if(this.accordionBox.isChildIncludedInLayout(this.contentNode))this.containerNode.children=[this.expandedBox,this.collapsedBox,this.titleNode,this.expandCollapseButton];else{this.containerNode.children=[];return}const n=this.accordionBox.expandedProperty.value||e.useExpandedBoundsWhenCollapsed,r=e.stroke===null?0:e.lineWidth,s=this.createLayoutProxy(this.contentNode),a=this.createLayoutProxy(this.titleNode),l=s.minimumWidth,d=s.minimumHeight,c=a.minimumWidth,y=Math.max(this.expandCollapseButton.height+2*e.buttonYMargin,this.titleNode.height+2*e.titleYMargin),m=e.showTitleWhenExpanded?Math.max((e.allowContentToOverlapTitle?e.contentYMargin:y+e.contentYSpacing)+d+e.contentYMargin,y):Math.max(this.expandCollapseButton.height+2*e.buttonYMargin,d+2*e.contentYMargin);let O=Math.max(e.minWidth,e.buttonXMargin+this.expandCollapseButton.width+e.titleXSpacing+c+e.titleXMargin);e.titleAlignX==="center"&&(O=Math.max(O,(e.buttonXMargin+this.expandCollapseButton.width+e.titleXSpacing)*2+c),O=Math.max(O,e.titleXMargin*2+c)),e.showTitleWhenExpanded?O=Math.max(O,l+2*e.contentXMargin):O=Math.max(O,this.expandCollapseButton.width+l+e.buttonXMargin+e.contentXMargin+e.contentXSpacing);const D=O+r,z=(n?m:y)+r,w=Math.max(D,this.accordionBox.localPreferredWidth||0),N=Math.max(z,this.accordionBox.localPreferredHeight||0),H=w-r,X=N-r;this.lastCollapsedBoxHeight=y,n&&(this.lastExpandedBoxHeight=X),this.collapsedBox.rectWidth=H,this.collapsedBox.rectHeight=y;const ae=this.collapsedBox.selfBounds;if(this.collapsedTitleBar.rectWidth=H,this.collapsedTitleBar.rectHeight=y,this.collapsedBoxOutline&&(this.collapsedBoxOutline.rectWidth=H,this.collapsedBoxOutline.rectHeight=y),n){this.expandedBox.rectWidth=H,this.expandedBox.rectHeight=X;const fe=this.expandedBox.selfBounds;this.expandedBoxOutline&&(this.expandedBoxOutline.rectWidth=H,this.expandedBoxOutline.rectHeight=X),this.expandedTitleBar.shape=Shape$1.roundedRectangleWithRadii(0,0,H,y,{topLeft:e.cornerRadius,topRight:e.cornerRadius});let be=fe.left+e.contentXMargin,Ae=fe.right-e.contentXMargin;e.showTitleWhenExpanded||(e.buttonAlign==="left"?be+=this.expandCollapseButton.width+e.contentXSpacing:Ae-=this.expandCollapseButton.width+e.contentXSpacing);const W=Ae-be,J=X-(e.showTitleWhenExpanded&&!e.allowContentToOverlapTitle?y+e.contentYMargin+e.contentYSpacing:2*e.contentYMargin);isWidthSizable(this.contentNode)&&this.accordionBox.localPreferredWidth!==null&&(this.contentNode.preferredWidth=W),isHeightSizable(this.contentNode)&&this.accordionBox.localPreferredHeight!==null&&(this.contentNode.preferredHeight=J),e.contentVerticalAlign==="top"?this.contentNode.top=fe.bottom-e.contentYMargin-J:e.contentVerticalAlign==="bottom"?this.contentNode.bottom=fe.bottom-e.contentYMargin:this.contentNode.centerY=fe.bottom-e.contentYMargin-J/2,e.contentAlign==="left"?this.contentNode.left=be:e.contentAlign==="right"?this.contentNode.right=Ae:this.contentNode.centerX=(be+Ae)/2}let oe=ae.left+e.titleXMargin,ue=ae.right-e.titleXMargin;e.buttonAlign==="left"?(this.expandCollapseButton.left=ae.left+e.buttonXMargin,oe=this.expandCollapseButton.right+e.titleXSpacing):(this.expandCollapseButton.right=ae.right-e.buttonXMargin,ue=this.expandCollapseButton.left-e.titleXSpacing),isWidthSizable(this.titleNode)&&(this.titleNode.preferredWidth=ue-oe),e.titleAlignX==="left"?this.titleNode.left=oe:e.titleAlignX==="right"?this.titleNode.right=ue:this.titleNode.centerX=ae.centerX,e.titleAlignY==="top"?(this.expandCollapseButton.top=this.collapsedBox.top+Math.max(e.buttonYMargin,e.titleYMargin),this.titleNode.top=this.expandCollapseButton.top):(this.expandCollapseButton.centerY=this.collapsedBox.centerY,this.titleNode.centerY=this.expandCollapseButton.centerY),s.dispose(),a.dispose(),this.accordionBox.localMinimumWidth=D,this.accordionBox.localMinimumHeight=z}dispose(){this.accordionBox.localPreferredWidthProperty.unlink(this._updateLayoutListener),this.accordionBox.localPreferredHeightProperty.unlink(this._updateLayoutListener),this.accordionBox.expandedProperty.unlink(this._updateLayoutListener),super.dispose()}}sun.register("AccordionBox",AccordionBox);const soundURI$9="data:audio/mpeg;base64,//tQxAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAAFAAAE5AAzMzMzMzMzMzMzMzMzMzMzMzMzZmZmZmZmZmZmZmZmZmZmZmZmZmaZmZmZmZmZmZmZmZmZmZmZmZmZmczMzMzMzMzMzMzMzMzMzMzMzMzM//////////////////////////8AAAA5TEFNRTMuOTlyAaUAAAAAAAAAABRAJAZmQgAAQAAABOTGvClKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/7UMQAAAjxrv+ggLoZGTXh9oJQAa222FG3ASABBG51MY/j4AAB4AYI3/H3//Pqd/zv0Jp/8//zn3n6Mmf/J7f//8jf+fOeeggHA4RXkGh8XEwHAMHD4udyCYuhAALhgJqWJAEDGMYxvHlyAHxc9P76dP//T/Rm//p+v9tvb0Tzr1XyfnelP/3b0//5vo86Mlm0dHQrscccRQg5oSYpziaiB52oQCkxnR6LQisRCEMhluyeqEhIiWMiSvQjhwDTCtCPyDkNrP+UsBTNwVsJGSD/+1LEFoAQMWtluYaQEWGP7H+wYAR9IvpDLBawV8OWbG5oShmbiVnh8GAU6ZIjnetMKuOcpmaSndX80HuS7puaIKq/6lvM36lIJf8+Zm6CFA0t3fV/91IOhPJ1GCH13q//5o6DJl9/F3ErtwAGRlJ26tx4H5gV4lzzrIqy8jTNBZl1Hep3doI2/x6AMOljV5/M4clzeagOVs4SmnmZk2fTyahylhxZ1R7/1HlnhEe4KgF3SISoKnviYs9T8sp4Ku5ICsAAg3RwNdct5GVqea2W4P/7UsQHgAuZRzrtmE8JO4qkaa4M4MXAzUcoyYPSsZe/D4w5DUicEmE/ziQka1VaLTh0y8+qp/UtRMpQoli5jYCz6St//RjTOrPXlI/KJaZ2RHX6mMrJqxfqVjPM/K/thi6pyAAPlyOxkEr9tPgR2ldNwBRI0383ZJR5NmIAG2zBZOw1tKaJR6jzjIxgTlVLjBgJmawwRo8JXAUYCz1gr/q+aVWur8tO+j4iUe////6ii3UCwZHQhxd93nYdy9H1MjPwThY/VGgQQLo200aOkCDF//tSxA+CCwg1HK3lIQHXlCPo97AIw8D44EBOcB8oGBIND4gcCBc+IFHC7wwUOA+oMiAaH1PDCw+mxbydxPV3/zjbCnci8p/9nIJTQYSH5vktZIAEdHIA5HkiS4k11MYsCUFS8QSbEVhJUnQlFpKIJNQhJJrBKEZ8kiKoJIkqToSj5KJJ6hiCTXCUJUZJEl45Ek9TCUfQkkyuSSbzS72V1mVruLnhMeBUsHREPDQiPA0VOiJwdKuBlR5Fqtbk3f///t8FdSogAuxJp2uAWhIWFmv/+1LEBgPGHADHoIhgIAAANIAAAATcLVLFRWKCwsLCyxUVFVf6xVmLCws1YqKior////2RVn/+LCwtTEFNRTMuOTkuM1VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQ==",soundByteArray$9=base64SoundToByteArray(phetAudioContext$1,soundURI$9),unlock$9=asyncLoader.createLock(soundURI$9),wrappedAudioBuffer$9=new WrappedAudioBuffer;let unlocked$9=!1;const safeUnlock$9=()=>{unlocked$9||(unlock$9(),unlocked$9=!0)},onDecodeSuccess$9=o=>{wrappedAudioBuffer$9.audioBufferProperty.value===null&&(wrappedAudioBuffer$9.audioBufferProperty.set(o),safeUnlock$9())},onDecodeError$9=o=>{console.warn("decode of audio data failed, using stubbed sound, error: "+o),wrappedAudioBuffer$9.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$9()},decodePromise$9=phetAudioContext$1.decodeAudioData(soundByteArray$9.buffer,onDecodeSuccess$9,onDecodeError$9);decodePromise$9&&decodePromise$9.then(o=>{wrappedAudioBuffer$9.audioBufferProperty.value===null&&(wrappedAudioBuffer$9.audioBufferProperty.set(o),safeUnlock$9())}).catch(o=>{console.warn("promise rejection caught for audio decode, error = "+o),safeUnlock$9()});class MultiSelectionSoundPlayerFactory{constructor(){this._basisSoundClip=null,this.soundPlayers=[]}getSoundClipInstance(){return this._basisSoundClip||(this._basisSoundClip=new SoundClip(wrappedAudioBuffer$9,{initialOutputLevel:.7,rateChangesAffectPlayingSounds:!1}),soundManager.addSoundGenerator(this._basisSoundClip,{categoryName:"user-interface"})),this._basisSoundClip}getSelectionSoundPlayer(e){if(!this.soundPlayers[e]){const t=Math.pow(2,-e/12);this.soundPlayers[e]=new FixedSpeedSoundClipPlayer(this.getSoundClipInstance(),t)}return this.soundPlayers[e]}}class FixedSpeedSoundClipPlayer{constructor(e,t){this.soundPlayer=e,this.playbackRate=t}play(){this.soundPlayer.setPlaybackRate(this.playbackRate),this.soundPlayer.play()}stop(){this.soundPlayer.stop()}}const multiSelectionSoundPlayerFactory=new MultiSelectionSoundPlayerFactory;tambo.register("multiSelectionSoundPlayerFactory",multiSelectionSoundPlayerFactory);const Rh=class Rh extends WidthSizable(Voicing(Node$2)){constructor(e,t,n,r){var oe,ue;const s=optionize()({centerColor:"black",radius:Rh.DEFAULT_RADIUS,selectedColor:"rgb( 143, 197, 250 )",deselectedColor:"white",xSpacing:8,stroke:"black",soundPlayer:multiSelectionSoundPlayerFactory.getSelectionSoundPlayer(0),a11yNameAttribute:null,touchAreaXDilation:0,touchAreaYDilation:0,mouseAreaXDilation:0,mouseAreaYDilation:0,cursor:"pointer",disabledOpacity:SceneryConstants.DISABLED_OPACITY,tandem:Tandem.REQUIRED,tandemNameSuffix:"RadioButton",visiblePropertyOptions:{phetioFeatured:!0},phetioEnabledPropertyInstrumented:!0,tagName:"input",inputType:"radio",containerTagName:"li",labelTagName:"label",appendLabel:!0,appendDescription:!0},r);super(),this.onInputEmitter=new Emitter,this._isMouseAreaCustomized=!1,this._isTouchAreaCustomized=!1,this._isSettingAreas=!1,this.value=t;const a=new Node$2,l=new Circle(s.radius/3,{fill:s.centerColor}),d=new Circle(s.radius,{fill:s.selectedColor,stroke:s.stroke}),c=new Node$2({children:[d,l]});a.addChild(c);const y=new Node$2,m=new Circle(s.radius,{fill:s.deselectedColor,stroke:s.stroke});y.addChild(m);const O=new Node$2({children:[a,y],pickable:!1}),D=()=>{n.left=m.right+s.xSpacing,n.centerY=m.centerY};n.boundsProperty.link(D);const z=new Rectangle({});a.pickable=y.pickable=!1,n.pickable=!1,this.children=[O,n,z],this.constraint=new AquaRadioButtonConstraint(this,O,n,z,s),this.constraint.updateLayout();const w=fe=>{a.visible=fe===t,y.visible=!a.visible};e.link(w);const N=()=>{const fe=e.value;e.set(t),fe!==e.value&&this.onInputEmitter.emit()},H=new FireListener({fire:N,tandem:s.tandem.createTandem("fireListener")});this.addInputListener(H),this.onInputEmitter.addListener(()=>s.soundPlayer.play());const X={change:N};this.addInputListener(X),e.value===t&&this.setPDOMAttribute("checked","checked");const ae=fe=>{this.pdomChecked=fe===t};e.link(ae),s.a11yNameAttribute!==null&&this.setPDOMAttribute("name",s.a11yNameAttribute),this.mutate(s),this.disposeAquaRadioButton=()=>{this.constraint.dispose(),this.onInputEmitter.dispose(),this.removeInputListener(H),this.removeInputListener(X),e.unlink(ae),e.unlink(w),n.boundsProperty.hasListener(D)&&n.boundsProperty.unlink(D),H.dispose()},assert&&((ue=(oe=phet==null?void 0:phet.chipper)==null?void 0:oe.queryParameters)!=null&&ue.binder)&&InstanceRegistry.registerDataURL("sun","AquaRadioButton",this)}dispose(){this.disposeAquaRadioButton(),super.dispose()}};Rh.DEFAULT_RADIUS=7;let AquaRadioButton=Rh;class AquaRadioButtonConstraint extends LayoutConstraint{constructor(e,t,n,r,s){super(e),this.radioButton=e,this.radioNode=t,this.content=n,this.rectangle=r,this.options=s,this.radioButton.localPreferredWidthProperty.lazyLink(this._updateLayoutListener),this.addNode(n)}layout(){super.layout();const e=this.createLayoutProxy(this.content),t=e.minimumWidth,n=this.radioNode.width+this.options.xSpacing+t,r=Math.max(n,this.radioButton.localPreferredWidth||0);isWidthSizable(this.content)&&(e.preferredWidth=r-this.radioNode.width-this.options.xSpacing),e.left=this.radioNode.right+this.options.xSpacing,e.centerY=this.radioNode.centerY,this.rectangle.rectBounds=this.radioNode.bounds.union(e.bounds).withMaxX(Math.max(this.radioNode.left+r,e.right)),this.radioButton._isSettingAreas=!0,this.radioButton._isTouchAreaCustomized||(this.radioButton.touchArea=this.radioButton.localBounds.dilatedXY(this.options.touchAreaXDilation,this.options.touchAreaYDilation)),this.radioButton._isMouseAreaCustomized||(this.radioButton.mouseArea=this.radioButton.localBounds.dilatedXY(this.options.mouseAreaXDilation,this.options.mouseAreaYDilation)),this.radioButton._isSettingAreas=!1,e.dispose(),this.radioButton.localMinimumWidth=n}dispose(){this.radioButton.localPreferredWidthProperty.unlink(this._updateLayoutListener),super.dispose()}}sun.register("AquaRadioButton",AquaRadioButton);let instanceCount$1=0;const CLASS_NAME$1="AquaRadioButtonGroup";class AquaRadioButtonGroup extends FlowBox{constructor(e,t,n){instanceCount$1++;const r=optionize()({touchAreaXDilation:0,touchAreaYDilation:0,mouseAreaXDilation:0,mouseAreaYDilation:0,orientation:"vertical",spacing:3,stretch:!0,disabledOpacity:SceneryConstants.DISABLED_OPACITY,tandem:Tandem.REQUIRED,tandemNameSuffix:"RadioButtonGroup",visiblePropertyOptions:{phetioFeatured:!0},phetioEnabledPropertyInstrumented:!0,phetioFeatured:!0,tagName:"ul",labelTagName:"h3",ariaRole:"radiogroup",groupFocusHighlight:!0},n),s=getGroupItemNodes(t,r.tandem);r.orientation==="vertical"&&(r.align=r.align||"left");const a=t.map((c,y)=>{assert&&assert(!c.tandem,"Cannot specify tandem any more");const m=s[y];return assert&&assert(!m.hasPDOMContent,"Accessibility is provided by AquaRadioButton and AquaRadioButtonGroupItem.labelContent. Additional PDOM content in the provided Node could break accessibility."),new AquaRadioButton(e,c.value,m,combineOptions({a11yNameAttribute:CLASS_NAME$1+instanceCount$1,labelContent:c.labelContent||null,soundPlayer:multiSelectionSoundPlayerFactory.getSelectionSoundPlayer(y),tandem:c.tandemName?r.tandem.createTandem(c.tandemName):r.tandem===Tandem.OPT_OUT?Tandem.OPT_OUT:Tandem.REQUIRED,touchAreaXDilation:r.orientation==="horizontal"?r.spacing/2:r.touchAreaXDilation,touchAreaYDilation:r.orientation==="vertical"?r.spacing/2:r.touchAreaYDilation,mouseAreaXDilation:r.orientation==="horizontal"?r.spacing/2:r.mouseAreaXDilation,mouseAreaYDilation:r.orientation==="vertical"?r.spacing/2:r.mouseAreaYDilation},r.radioButtonOptions,c.options))});r.children=a,super(r),this.onInputEmitter=new Emitter,this.addAriaLabelledbyAssociation({thisElementName:PDOMPeer$1.PRIMARY_SIBLING,otherNode:this,otherElementName:PDOMPeer$1.LABEL_SIBLING});const l=new KeyboardListener({keys:["arrowLeft","arrowRight","arrowUp","arrowDown"],callback:c=>{c&&c.pointer.reserveForKeyboardDrag()}});this.addInputListener(l);const d=this.onRadioButtonInput.bind(this);for(let c=0;c<a.length;c++)a[c].onInputEmitter.addListener(d);this.addLinkedElement(e,{tandemName:"property"}),this.disposeAquaRadioButtonGroup=()=>{this.removeInputListener(l),l.dispose(),a.forEach(c=>c.dispose()),this.onInputEmitter.dispose(),s.forEach(c=>c.dispose())},this.radioButtons=a}onRadioButtonInput(){this.onInputEmitter.emit()}dispose(){this.disposeAquaRadioButtonGroup(),super.dispose()}getButton(e){const t=_.find(this.radioButtons,n=>n.value===e);return assert&&assert(t,`no radio button found for value ${e}`),t}}sun.register("AquaRadioButtonGroup",AquaRadioButtonGroup);const soundURI$8="data:audio/mpeg;base64,//swxAAABlAhPLTAgDE1De+/HoACAH4CwkCAJDo5gDgPRksn2WLHOB8EHShd5cHwfBBwgBBOJw/UCAY/lAxWD/4DB9+CH/6XQjMTIIcYUIQPQIRAIBAACUIawkYq7IQ/BawVqEc7mTjD+OFygBAnHbHq7UkLJ8aCnnrZlPpg3IkRJBgPH/MCQCI985/yAnHAAhmv3lHuAgAgAxJF//syxAOACHQpa7zBAAD8EunxpI3HUCEZHQlA2EYuDsSjE5EkSQGhUDYDxOARLoiBmIgalVgq4qWeWBqsNYKywNO+p/sxFyKwVOlXRFDtZ0S86oQ0C2W+wBOmlaWuS6+BIqZMz+AYy3FuwBkKXM2idVoKlYwUd/oIGgsbLpEbaCsmIyZRtbw6TPwj+mYmGr8QqnGHBLo3LKAAxKabZ//7MsQGAAhsl1OsPMcxAo3mpbCaAvIuuQRmW4WNHhDBJnoBORIlh+I9dvGCTCKP0kzo7rHHTi87diQ2XqnRN77y8lnKUl8zf+X0Fu0iCDV/9AP7el8Cw8raZKqiYShe+6bzYk0zXmEuGnBDcQhyRzPeI4Jbsmj5OxzZVhSX9adVU4Kk9r9esE3etv+/6wUIg3Wm62nA3Ab0EIcLUQ7/+zLECABGICs9oemDMLwEZrQcvFYyDBCUCgUAwQCUSvgROof5poGn9O7o70P/X9P/T+360+lAhIJVtyuNDljXzM7Ek0fGUB/ltZQF8iD7dBcVTs00f31POqR0/V/q/pjEe1z3jyAAQRBHGmSBEEVK6QIYH2miQZKNfgCVtiH9vVLp+w7an/d0jdUx9VnqZIJSvFtsaUFKKFBVCzoe//swxBwABSAhLaDl4nCsA+a0fDyG3vbgKx5OhNXyuPYt7kJJSg9B6heqxP93q/9P6IwSQ8LbYIFBVUF85RwseJPX6+Q7qIq7f/8ayokh7P//V8oyAABbhbGEIBBhOJgEGTBx6KjUiosS54l6y0i3jOz/6f///RVMQU1FMy45OS41VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//syxDWABEQTMaCF4HCNAmL0EJgGVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQ==",soundByteArray$8=base64SoundToByteArray(phetAudioContext$1,soundURI$8),unlock$8=asyncLoader.createLock(soundURI$8),wrappedAudioBuffer$8=new WrappedAudioBuffer;let unlocked$8=!1;const safeUnlock$8=()=>{unlocked$8||(unlock$8(),unlocked$8=!0)},onDecodeSuccess$8=o=>{wrappedAudioBuffer$8.audioBufferProperty.value===null&&(wrappedAudioBuffer$8.audioBufferProperty.set(o),safeUnlock$8())},onDecodeError$8=o=>{console.warn("decode of audio data failed, using stubbed sound, error: "+o),wrappedAudioBuffer$8.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$8()},decodePromise$8=phetAudioContext$1.decodeAudioData(soundByteArray$8.buffer,onDecodeSuccess$8,onDecodeError$8);decodePromise$8&&decodePromise$8.then(o=>{wrappedAudioBuffer$8.audioBufferProperty.value===null&&(wrappedAudioBuffer$8.audioBufferProperty.set(o),safeUnlock$8())}).catch(o=>{console.warn("promise rejection caught for audio decode, error = "+o),safeUnlock$8()});const pushButtonSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$8,{soundClipOptions:{initialOutputLevel:.5},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("pushButtonSoundPlayer",pushButtonSoundPlayer);const twixt=new Namespace("twixt"),Ki=class Ki{constructor(e,t,n){this.value=e,this.derivative=t,this.secondDerivative=n}static polynomialEaseInValue(e,t){return assert&&assert(tIsValid(t),`invalid t: ${t}`),Math.pow(t,e)}static polynomialEaseOutValue(e,t){return assert&&assert(tIsValid(t),`invalid t: ${t}`),1-Math.pow(1-t,e)}static polynomialEaseInOutValue(e,t){return assert&&assert(tIsValid(t),`invalid t: ${t}`),t<=.5?.5*Math.pow(2*t,e):1-Ki.polynomialEaseInOutValue(e,1-t)}static polynomialEaseInDerivative(e,t){return assert&&assert(tIsValid(t),`invalid t: ${t}`),e*Math.pow(t,e-1)}static polynomialEaseOutDerivative(e,t){return assert&&assert(tIsValid(t),`invalid t: ${t}`),e*Math.pow(1-t,e-1)}static polynomialEaseInOutDerivative(e,t){return assert&&assert(tIsValid(t),`invalid t: ${t}`),t<=.5?Math.pow(2,e-1)*e*Math.pow(t,e-1):Ki.polynomialEaseInOutDerivative(e,1-t)}static polynomialEaseInSecondDerivative(e,t){return assert&&assert(tIsValid(t),`invalid t: ${t}`),(e-1)*e*Math.pow(t,e-2)}static polynomialEaseOutSecondDerivative(e,t){return assert&&assert(tIsValid(t),`invalid t: ${t}`),-(e-1)*e*Math.pow(1-t,e-2)}static polynomialEaseInOutSecondDerivative(e,t){return assert&&assert(tIsValid(t),`invalid t: ${t}`),t<=.5?Math.pow(2,e-1)*(e-1)*e*Math.pow(t,e-2):-Ki.polynomialEaseInOutSecondDerivative(e,1-t)}static polynomialEaseIn(e){return new Ki(Ki.polynomialEaseInValue.bind(null,e),Ki.polynomialEaseInDerivative.bind(null,e),Ki.polynomialEaseInSecondDerivative.bind(null,e))}static polynomialEaseOut(e){return new Ki(Ki.polynomialEaseOutValue.bind(null,e),Ki.polynomialEaseOutDerivative.bind(null,e),Ki.polynomialEaseOutSecondDerivative.bind(null,e))}static polynomialEaseInOut(e){return new Ki(Ki.polynomialEaseInOutValue.bind(null,e),Ki.polynomialEaseInOutDerivative.bind(null,e),Ki.polynomialEaseInOutSecondDerivative.bind(null,e))}};Ki.LINEAR=Ki.polynomialEaseIn(1),Ki.QUADRATIC_IN=Ki.polynomialEaseIn(2),Ki.QUADRATIC_OUT=Ki.polynomialEaseOut(2),Ki.QUADRATIC_IN_OUT=Ki.polynomialEaseInOut(2),Ki.CUBIC_IN=Ki.polynomialEaseIn(3),Ki.CUBIC_OUT=Ki.polynomialEaseOut(3),Ki.CUBIC_IN_OUT=Ki.polynomialEaseInOut(3),Ki.QUARTIC_IN=Ki.polynomialEaseIn(4),Ki.QUARTIC_OUT=Ki.polynomialEaseOut(4),Ki.QUARTIC_IN_OUT=Ki.polynomialEaseInOut(4),Ki.QUINTIC_IN=Ki.polynomialEaseIn(5),Ki.QUINTIC_OUT=Ki.polynomialEaseOut(5),Ki.QUINTIC_IN_OUT=Ki.polynomialEaseInOut(5);let Easing=Ki;function tIsValid(o){return typeof o=="number"&&isFinite(o)&&o>=0&&o<=1}twixt.register("Easing",Easing);class AnimationTarget{constructor(e){this.startingValue=null,this.endingValue=null;const t=optionize()({setValue:null,getValue:null,property:null,object:null,attribute:null,to:null,delta:null,speed:null,from:null,easing:Easing.CUBIC_IN_OUT,blend:AnimationTarget.DEFAULT_BLEND,distance:AnimationTarget.DEFAULT_DISTANCE,add:AnimationTarget.DEFAULT_ADD},e);assert&&assert(+(t.property!==null)+ +(t.object!==null)+ +(t.setValue!==null)==1,"Should have one (and only one) way of defining how to set the animated value. Use one of property/object/setValue"),assert&&assert(t.setValue===null||typeof t.setValue=="function","If setValue is provided, it should be a function."),assert&&assert(t.setValue===null||t.from!==null||typeof t.getValue=="function",'If setValue is provided and no "from" value is specified, then getValue needs to be a function.'),assert&&assert(t.to!==null||t.delta!==null,"Need something to animate to, use to/delta"),assert&&assert(t.property===null||isTReadOnlyProperty(t.property)&&t.property.isSettable(),"If property is provided, it should be a settable Property or TinyProperty"),assert&&assert(t.object===null||typeof t.object=="object"&&typeof t.attribute=="string","If object is provided, then object should be an object, and attribute should be a string."),assert&&assert(t.easing instanceof Easing,"The easing should be of type Easing"),assert&&assert(typeof t.blend=="function","The blend option should be a function"),assert&&assert(typeof t.distance=="function","The distance option should be a function"),assert&&assert(typeof t.add=="function","The add option should be a function"),t.object&&(assert&&assert(t.attribute!==null),t.setValue=AnimationTarget.OBJECT_SET(t.object,t.attribute),t.getValue=AnimationTarget.OBJECT_GET(t.object,t.attribute)),t.property&&(t.setValue=AnimationTarget.PROPERTY_SET(t.property),t.getValue=AnimationTarget.PROPERTY_GET(t.property)),assert&&assert(t.setValue!==null),this.getValue=t.getValue,this.setValue=t.setValue,this.easing=t.easing,this.from=t.from,this.to=t.to,this.delta=t.delta,this.speed=t.speed,this.blend=t.blend,this.distance=t.distance,this.add=t.add}static DEFAULT_BLEND(e,t,n){if(assert&&assert(isFinite(n)&&n>=0&&n<=1,`Invalid ratio: ${n}`),n===0)return e;if(n===1)return t;if(typeof e=="number"&&typeof t=="number")return e+(t-e)*n;if(typeof e=="object"&&typeof t=="object"&&typeof e.blend=="function")return e.blend(t,n);throw new Error(`Blending not supported for: ${JSON.stringify(e)}, ${JSON.stringify(t)}, pass in a blend option`)}static DEFAULT_DISTANCE(e,t){if(typeof e=="number"&&typeof t=="number")return Math.abs(e-t);if(typeof e=="object"&&typeof t=="object"&&typeof e.distance=="function")return e.distance(t);throw new Error(`Distance (required for speed) by default not supported for: ${JSON.stringify(e)}, ${JSON.stringify(t)}, pass in a distance option`)}static DEFAULT_ADD(e,t){if(typeof e=="number"&&typeof t=="number")return e+t;if(typeof e=="object"&&typeof t=="object"&&typeof e.plus=="function")return e.plus(t);throw new Error(`Addition (required for delta) by default not supported for: ${JSON.stringify(e)}, ${JSON.stringify(t)}, pass in an add option`)}static OBJECT_SET(e,t){return function(n){e[t]=n}}static OBJECT_GET(e,t){return function(){return e[t]}}static PROPERTY_SET(e){return function(t){e.value=t}}static PROPERTY_GET(e){return function(){return e.value}}computeStartEnd(){assert&&assert(this.to!==null||this.delta!==null),assert&&assert(this.from!==null||this.getValue!==null),this.startingValue=this.from!==null?this.from:this.getValue(),this.endingValue=this.to!==null?this.to:this.add(this.startingValue,this.delta)}update(e){assert&&assert(this.setValue!==null),assert&&assert(this.startingValue!==null),assert&&assert(this.endingValue!==null),this.setValue(this.blend(this.startingValue,this.endingValue,this.easing.value(e)))}hasPreferredDuration(){return this.speed!==null}getPreferredDuration(){return assert&&assert(this.startingValue!==null),assert&&assert(this.delta!==null),this.speed===null?null:this.speed*this.distance(this.startingValue,this.delta)}}twixt.register("AnimationTarget",AnimationTarget);class Animation extends Disposable{constructor(e){const t=optionize()({targets:null,duration:null,delay:0,stepEmitter:stepTimer},e);assert&&assert(+(t.property!==void 0)+ +(t.object!==void 0)+ +(t.setValue!==void 0)+ +(t.targets!==null)==1,"Should have one (and only one) way of defining how to set the animated value. Use one of property/object/setValue/targets"),assert&&assert(typeof t.delay=="number"&&isFinite(t.delay)&&t.delay>=0,"The delay should be a non-negative number."),assert&&assert(t.stepEmitter===null||t.stepEmitter instanceof Emitter||t.stepEmitter instanceof TinyEmitter,"stepEmitter must be null or an (Tiny)Emitter"),super(t),this.length=0,this.remainingDelay=0,this.remainingAnimation=0,this.runningProperty=new BooleanProperty(!1),this.animatingProperty=new BooleanProperty(!1),this.startEmitter=new Emitter,this.beginEmitter=new Emitter,this.finishEmitter=new Emitter({parameters:[{valueType:"number"}]}),this.stopEmitter=new Emitter,this.endedEmitter=new Emitter({hasListenerOrderDependencies:!0}),this.updateEmitter=new Emitter,this.targets=(t.targets===null?[t]:t.targets).map(r=>new AnimationTarget(r)),assert&&assert(+(t.duration!==null)+_.sum(_.map(this.targets,r=>r.hasPreferredDuration()?1:0))===1,"Exactly one duration/speed option should be used."),this.duration=t.duration,this.delay=t.delay;const n=t.stepEmitter;if(n){const r=this.step.bind(this);this.runningProperty.link(s=>{s&&!n.hasListener(r)?n.addListener(r):!s&&n.hasListener(r)&&n.removeListener(r)}),this.disposeEmitter.addListener(()=>{n.hasListener(r)&&n.removeListener(r)})}}start(e){return this.runningProperty.value?this:(this.remainingDelay=this.delay,this.runningProperty.value=!0,this.startEmitter.emit(),this.step(e!==void 0?e:0),this)}stop(){return this.runningProperty.value?(this.runningProperty.value=!1,this.stopEmitter.emit(),this.endedEmitter.emit(),this):this}step(e){if(!this.runningProperty.value)return this;if(!this.animatingProperty.value){if(this.remainingDelay-=e,e=-this.remainingDelay,this.remainingDelay>0)return this;this.length=this.duration;for(let n=0;n<this.targets.length;n++){const r=this.targets[n];r.computeStartEnd(),this.length===null&&(this.length=r.getPreferredDuration())}assert&&assert(this.length!==null,"After going through the targets, we should have a length by now"),this.remainingAnimation=this.length,this.animatingProperty.value=!0,this.beginEmitter.emit()}this.remainingAnimation-=e,e=-this.remainingAnimation,assert&&assert(this.length!==null);const t=this.length>0?DotUtils.clamp((this.length-this.remainingAnimation)/this.length,0,1):1;for(let n=0;n<this.targets.length;n++)this.targets[n].update(t);return this.updateEmitter.emit(),t===1&&(this.animatingProperty.value=!1,this.runningProperty.value=!1,this.finishEmitter.emit(e),this.endedEmitter.emit()),this}then(e){return this.finishEmitter.addListener(t=>e.start(t)),e}dispose(){this.runningProperty.dispose(),this.animatingProperty.dispose(),this.startEmitter.dispose(),this.beginEmitter.dispose(),this.finishEmitter.dispose(),this.stopEmitter.dispose(),this.endedEmitter.dispose(),this.updateEmitter.dispose(),super.dispose()}}twixt.register("Animation",Animation);class PushButtonInteractionStateProperty extends DerivedProperty4{constructor(e){super([e.focusedProperty,e.overProperty,e.looksOverProperty,e.looksPressedProperty],(t,n,r,s)=>r&&!s?ButtonInteractionState.OVER:(n||t)&&s?ButtonInteractionState.PRESSED:ButtonInteractionState.IDLE,{valueType:ButtonInteractionState})}}sun.register("PushButtonInteractionStateProperty",PushButtonInteractionStateProperty);class PushButtonModel extends ButtonModel{constructor(e){const t=optionize()({fireOnDown:!1,listener:null,interruptListener:null,fireOnHold:!1,fireOnHoldDelay:400,fireOnHoldInterval:100,tandem:Tandem.REQUIRED,phetioReadOnly:PhetioObject.DEFAULT_OPTIONS.phetioReadOnly},e);super(t),this.startEvent=null,this.isFiringProperty=new BooleanProperty(!1),this.firedEmitter=new Emitter({tandem:t.tandem.createTandem("firedEmitter"),phetioDocumentation:"Emits when the button is fired",phetioReadOnly:t.phetioReadOnly,phetioEventType:EventType.USER,hasListenerOrderDependencies:!0}),t.interruptListener&&this.firedEmitter.addListener(()=>{t.interruptListener(this.startEvent)}),t.listener!==null&&this.firedEmitter.addListener(t.listener),t.fireOnHold&&(this.timer=new CallbackTimer({callback:this.fire.bind(this),delay:t.fireOnHoldDelay,interval:t.fireOnHoldInterval}));const n=s=>{var a,l,d;if(s)this.enabledProperty.get()&&(this.startEvent=((d=(l=(a=phet==null?void 0:phet.joist)==null?void 0:a.display)==null?void 0:l._input)==null?void 0:d.currentSceneryEvent)||null,t.fireOnDown&&this.fire(),this.timer&&this.timer.start(),(t.fireOnDown||this.timer)&&this.produceSoundEmitter.emit());else{const c=!t.fireOnDown&&(this.overProperty.get()||this.focusedProperty.get())&&this.enabledProperty.get()&&!this.interrupted;this.timer?this.timer.stop(c):c&&(this.produceSoundEmitter.emit(),this.fire())}};this.downProperty.link(n);const r=s=>{!s&&this.timer&&this.timer.stop(!1)};this.enabledProperty.link(r),this.disposePushButtonModel=()=>{this.isFiringProperty.value=!1,this.isFiringProperty.dispose(),this.firedEmitter.dispose(),this.downProperty.unlink(n),this.enabledProperty.unlink(r),this.timer&&(this.timer.dispose(),this.timer=null)}}dispose(){this.disposePushButtonModel(),super.dispose()}addListener(e){this.firedEmitter.addListener(e)}removeListener(e){this.firedEmitter.removeListener(e)}fire(){assert&&assert(!this.isFiringProperty.value,"Cannot fire when already firing"),this.isFiringProperty.value=!0,this.firedEmitter.emit(),this.isFiringProperty.value=!1}}sun.register("PushButtonModel",PushButtonModel);class RectangularPushButton extends RectangularButton{constructor(e){var l,d;const t=optionize()({soundPlayer:pushButtonSoundPlayer,tandem:Tandem.REQUIRED},e),n=t.listener,r=_.omit(t,["listener"]),s=new PushButtonModel(r);super(s,new PushButtonInteractionStateProperty(s),r),this.pushButtonModel=s,n&&this.addListener(n);const a=()=>{t.soundPlayer.play()};s.produceSoundEmitter.addListener(a),this.disposeRectangularPushButton=function(){s.produceSoundEmitter.removeListener(a),s.dispose()},assert&&((d=(l=phet==null?void 0:phet.chipper)==null?void 0:l.queryParameters)!=null&&d.binder)&&InstanceRegistry.registerDataURL("sun","RectangularPushButton",this)}dispose(){super.dispose(),this.disposeRectangularPushButton()}addListener(e){this.pushButtonModel.addListener(e)}removeListener(e){this.pushButtonModel.removeListener(e)}}sun.register("RectangularPushButton",RectangularPushButton);const ANGLES={up:0,down:Math.PI,left:-Math.PI/2,right:Math.PI/2};class CarouselButton extends RectangularPushButton{constructor(e){const t=optionize()({arrowDirection:"up",arrowSize:new Dimension2(20,7),arrowPathOptions:{stroke:"black",lineWidth:3,lineCap:"round"},baseColor:"rgba( 200, 200, 200, 0.5 )",buttonAppearanceStrategy:ButtonNode.FlatAppearanceStrategy,cornerRadius:4},e);let n=null;t.stroke===void 0&&(n=new PaintColorProperty(t.baseColor,{luminanceFactor:-.8}),t.stroke=n),assert&&assert(ANGLES.hasOwnProperty(t.arrowDirection),`invalid direction: ${t.arrowDirection}`);let r=new Shape$1().moveTo(0,0).lineTo(t.arrowSize.width/2,-t.arrowSize.height).lineTo(t.arrowSize.width,0);r=r.transformed(Matrix3.rotation2(ANGLES[t.arrowDirection])),t.content=new Path(r,t.arrowPathOptions);const s=t.arrowDirection,a=t.cornerRadius;if(t.leftTopCornerRadius=s==="up"||s==="left"?a:0,t.rightTopCornerRadius=s==="up"||s==="right"?a:0,t.leftBottomCornerRadius=s==="down"||s==="left"?a:0,t.rightBottomCornerRadius=s==="down"||s==="right"?a:0,s==="up"||s==="down"){const l=t.mouseAreaYDilation/2||0,d=t.touchAreaYDilation/2||0;t.mouseAreaYDilation=l,t.touchAreaYDilation=d,t.mouseAreaYShift=s==="up"?-l:l,t.touchAreaYShift=s==="up"?-d:d}else{const l=t.mouseAreaXDilation/2||0,d=t.touchAreaXDilation/2||0;t.mouseAreaXDilation=l,t.touchAreaXDilation=d,t.mouseAreaXShift=s==="left"?-l:l,t.touchAreaXShift=s==="left"?-d:d}super(t),this.customStrokeProperty=n}dispose(){this.customStrokeProperty&&this.customStrokeProperty.dispose(),super.dispose()}}sun.register("CarouselButton",CarouselButton);const DEFAULT_ARROW_SIZE=new Dimension2(20,7);class Carousel extends Node$2{constructor(e,t){var ue,fe;let n=!1;const r=optionize()({orientation:"horizontal",fill:"white",stroke:"black",lineWidth:1,cornerRadius:4,defaultPageNumber:0,itemsPerPage:4,spacing:12,margin:6,alignBoxOptions:{phetioType:IndexedNodeIO,phetioState:!0,visiblePropertyOptions:{phetioFeatured:!0}},buttonOptions:{xMargin:5,yMargin:5,touchAreaXDilation:0,touchAreaYDilation:0,mouseAreaXDilation:0,mouseAreaYDilation:0,baseColor:"rgba( 200, 200, 200, 0.5 )",disabledColor:ColorConstants.LIGHT_GRAY,lineWidth:1,arrowPathOptions:{stroke:"black",lineWidth:3},arrowSize:DEFAULT_ARROW_SIZE,enabledPropertyOptions:{phetioReadOnly:!0,phetioFeatured:!1},soundPlayer:pushButtonSoundPlayer},separatorsVisible:!1,separatorOptions:{stroke:"rgb( 180, 180, 180 )",lineWidth:.5,pickable:!1},animationEnabled:!0,animationOptions:{duration:.4,stepEmitter:stepTimer,easing:Easing.CUBIC_IN_OUT},tandem:Tandem.OPTIONAL,visiblePropertyOptions:{phetioFeatured:!0}},t);super(),this.isAnimatingProperty=new BooleanProperty(!1),this.animationEnabled=r.animationEnabled,this.items=e,this.itemsPerPage=r.itemsPerPage,this.defaultPageNumber=r.defaultPageNumber;const s=Orientation.fromLayoutOrientation(r.orientation),a=new AlignGroup,l=r.tandem.createTandem("items");this.carouselItemNodes=getGroupItemNodes(e,l),this.alignBoxes=e.map((be,Ae)=>a.createBox(this.carouselItemNodes[Ae],combineOptions({tandem:be.tandemName?l.createTandem(be.tandemName):Tandem.OPTIONAL},r.alignBoxOptions,be.alignBoxOptions))),this.scrollingNode=new ScrollingFlowBox(this,{children:this.alignBoxes,orientation:r.orientation,spacing:r.spacing,[`${s.opposite.coordinate}Margin`]:r.margin}),this.visibleAlignBoxesProperty=DerivedProperty.deriveAny(this.alignBoxes.map(be=>be.visibleProperty),()=>this.getVisibleAlignBoxes()),this.scrollingNode.childrenReorderedEmitter.addListener(()=>this.visibleAlignBoxesProperty.recomputeDerivation());const d=combineOptions({cornerRadius:r.cornerRadius},r.buttonOptions);assert&&assert(r.spacing>=r.margin,"The spacing must be >= the margin, or you will see page 2 items at the end of page 1");const c=r.separatorsVisible?new Node$2({pickable:!1}):null,y=new Node$2({children:r.separatorsVisible?[c,this.scrollingNode]:[this.scrollingNode]}),m=be=>Math.max(Math.ceil(be.length/r.itemsPerPage),1);this.numberOfPagesProperty=new DerivedProperty([this.visibleAlignBoxesProperty],be=>m(be),{isValidValue:be=>be>0});const O=m(this.alignBoxes);assert&&assert(r.defaultPageNumber>=0&&r.defaultPageNumber<=this.numberOfPagesProperty.value-1,`defaultPageNumber is out of range: ${r.defaultPageNumber}`),this.pageNumberProperty=new NumberProperty(r.defaultPageNumber,{tandem:r.tandem.createTandem("pageNumberProperty"),numberType:"Integer",isValidValue:be=>be<this.numberOfPagesProperty.value&&be>=0,range:new Range(0,O-1),phetioFeatured:!0});const D=new DerivedProperty([this.numberOfPagesProperty],be=>be>1),z=new CarouselButton(combineOptions({arrowDirection:s===Orientation.HORIZONTAL?"right":"down",tandem:r.tandem.createTandem("nextButton"),listener:()=>this.pageNumberProperty.set(this.pageNumberProperty.get()+1),enabledProperty:new DerivedProperty([this.pageNumberProperty,this.numberOfPagesProperty],(be,Ae)=>be<Ae-1),visibleProperty:D},d)),w=new CarouselButton(combineOptions({arrowDirection:s===Orientation.HORIZONTAL?"left":"up",tandem:r.tandem.createTandem("previousButton"),listener:()=>this.pageNumberProperty.set(this.pageNumberProperty.get()-1),enabledProperty:new DerivedProperty([this.pageNumberProperty],be=>be>0),visibleProperty:D},d)),N=new Node$2({children:[y]}),H=new Rectangle({cornerRadius:r.cornerRadius,fill:r.fill}),X=new Rectangle({cornerRadius:r.cornerRadius,stroke:r.stroke,pickable:!1});this.carouselConstraint=new CarouselConstraint(this,H,X,N,w,z,y,this.alignBoxes,s,this.scrollingNode,this.itemsPerPage,r.margin,a,c,r.separatorOptions);let ae=null;const oe=new Bounds2(0,0,0,0);Multilink.multilink([this.pageNumberProperty,y.localBoundsProperty],(be,Ae)=>{if(be>=this.numberOfPagesProperty.value)return;ae&&ae.stop();const W=this.visibleAlignBoxesProperty.value[be*r.itemsPerPage],J=W?-W[s.minSide]+r.margin:0,Ue=oe===null||!oe.equals(Ae);oe.set(Ae),this.animationEnabled&&!(isSettingPhetioStateProperty!=null&&isSettingPhetioStateProperty.value)&&n&&!Ue?(ae=new Animation(combineOptions({},r.animationOptions,{to:J,getValue:()=>y[s.coordinate],setValue:gt=>{y[s.coordinate]=gt}})),ae.endedEmitter.addListener(()=>this.isAnimatingProperty.set(!1)),ae.start(),this.isAnimatingProperty.value=!0):y[s.coordinate]=J}),this.visibleAlignBoxesProperty.link(()=>{this.pageNumberProperty.value=Math.min(this.pageNumberProperty.value,this.numberOfPagesProperty.value-1)}),r.children=[H,N,z,w,X],this.disposeCarousel=()=>{this.visibleAlignBoxesProperty.dispose(),this.pageNumberProperty.dispose(),this.alignBoxes.forEach(be=>{assert&&assert(be.children.length===1,"Carousel AlignBox instances should have only one child"),assert&&assert(this.carouselItemNodes.includes(be.children[0]),"Carousel AlignBox instances should wrap a content node"),be.dispose()}),this.scrollingNode.dispose(),this.carouselConstraint.dispose(),this.carouselItemNodes.forEach(be=>be.dispose())},this.mutate(r),n=!0,assert&&((fe=(ue=phet==null?void 0:phet.chipper)==null?void 0:ue.queryParameters)!=null&&fe.binder)&&InstanceRegistry.registerDataURL("sun","Carousel",this)}dispose(){this.disposeCarousel(),super.dispose()}reset(e=!1){const t=this.animationEnabled;this.animationEnabled=e,this.pageNumberProperty.value=Math.min(this.defaultPageNumber,this.numberOfPagesProperty.value-1),this.animationEnabled=t}scrollToItemVisibleIndex(e){this.pageNumberProperty.set(this.itemVisibleIndexToPageNumber(e))}scrollToItem(e){this.scrollToAlignBox(this.getAlignBoxForItem(e))}scrollToAlignBox(e){const t=this.visibleAlignBoxesProperty.value.indexOf(e);assert&&assert(t>=0,"item not present or visible"),t>=0&&this.scrollToItemVisibleIndex(t)}setItemVisible(e,t){this.getAlignBoxForItem(e).visible=t}getAlignBoxForItem(e){const t=this.alignBoxes[this.items.indexOf(e)];return assert&&assert(t,"item does not have corresponding alignBox"),t}getNodeForItem(e){const t=this.carouselItemNodes[this.items.indexOf(e)];return assert&&assert(t,"item does not have corresponding node"),t}itemVisibleIndexToPageNumber(e){return assert&&assert(e>=0&&e<this.items.length,`itemIndex out of range: ${e}`),Math.floor(e/this.itemsPerPage)}getVisibleAlignBoxes(){return _.sortBy(this.alignBoxes.filter(e=>e.visible),e=>this.scrollingNode.children.indexOf(e))}}class ScrollingFlowBox extends FlowBox{constructor(e,t){super(t),this.carousel=e}onIndexedNodeIOChildMoved(e){this.carousel.scrollToAlignBox(e)}}class CarouselConstraint extends LayoutConstraint{constructor(e,t,n,r,s,a,l,d,c,y,m,O,D,z,w){super(e),this.carousel=e,this.backgroundNode=t,this.foregroundNode=n,this.windowNode=r,this.previousButton=s,this.nextButton=a,this.scrollingNodeContainer=l,this.alignBoxes=d,this.orientation=c,this.scrollingNode=y,this.itemsPerPage=m,this.margin=O,this.alignGroup=D,this.separatorLayer=z,this.separatorOptions=w,[this.backgroundNode,this.foregroundNode,this.windowNode,this.previousButton,this.nextButton,this.scrollingNodeContainer,...this.alignBoxes].forEach(N=>this.addNode(N,!1)),this.separatorLayer&&this.scrollingNode.constraint.finishedLayoutEmitter.addListener(()=>{this.updateSeparators()}),this.updateLayout()}updateSeparators(){const e=this.carousel.getVisibleAlignBoxes(),t=e.length>=2?_.range(1,e.length):[];this.separatorLayer.children=t.map(n=>{const r=(e[n-1][this.orientation.maxSide]+e[n][this.orientation.minSide])/2;return new Separator(combineOptions({[`${this.orientation.coordinate}1`]:r,[`${this.orientation.coordinate}2`]:r,[`${this.orientation.opposite.coordinate}2`]:this.scrollingNode[this.orientation.opposite.size]},this.separatorOptions))})}computeClipArea(){const e=this.orientation,t=this.carousel.getVisibleAlignBoxes();if(t.length===0)return new Dimension2(0,0);{const n=t[this.itemsPerPage-1]||t[t.length-1],r=new Dimension2(n[e.maxSide]-t[0][e.minSide]+2*this.margin,this.scrollingNodeContainer.boundsProperty.value[e.opposite.size]);return this.orientation===Orientation.HORIZONTAL?r:r.swapped()}}getBackgroundDimension(){let e,t;if(this.orientation===Orientation.HORIZONTAL){const n=this.nextButton.visible?this.nextButton.width:0,r=this.previousButton.visible?this.previousButton.width:0;e=this.windowNode.width+n+r,t=this.windowNode.height}else{const n=this.nextButton.visible?this.nextButton.height:0,r=this.previousButton.visible?this.previousButton.height:0;e=this.windowNode.width,t=this.windowNode.height+n+r}return new Dimension2(e,t)}layout(){super.layout();const e=this.orientation,n=this.alignGroup.getMaxSizeProperty(e.opposite).value+2*this.margin;this.nextButton[e.opposite.preferredSize]=n,this.previousButton[e.opposite.preferredSize]=n,this.nextButton[e.opposite.centerCoordinate]=this.backgroundNode[e.opposite.centerCoordinate],this.previousButton[e.opposite.centerCoordinate]=this.backgroundNode[e.opposite.centerCoordinate],this.windowNode[e.opposite.centerCoordinate]=this.backgroundNode[e.opposite.centerCoordinate],this.previousButton[e.minSide]=this.backgroundNode[e.minSide],this.nextButton[e.maxSide]=this.backgroundNode[e.maxSide],this.windowNode[e.centerCoordinate]=this.backgroundNode[e.centerCoordinate];const r=this.computeClipArea().toBounds();this.windowNode.clipArea=Shape$1.bounds(r),this.windowNode.localBounds=r;const s=this.getBackgroundDimension();this.carousel.backgroundWidth=s.width,this.carousel.backgroundHeight=s.height;const a=s.toBounds();this.backgroundNode.rectBounds=a,this.foregroundNode.rectBounds=a,this.separatorLayer&&this.updateSeparators()}}sun.register("Carousel",Carousel);const SunConstants={VALUE_NAMED_PLACEHOLDER:"{{value}}",VALUE_NUMBERED_PLACEHOLDER:"{0}",SLIDER_VERTICAL_ROTATION:-Math.PI/2};sun.register("SunConstants",SunConstants);class NullSoundPlayer{play(){}stop(){}}const nullSoundPlayer=new NullSoundPlayer;tambo.register("nullSoundPlayer",nullSoundPlayer);const soundURI$7="data:audio/mpeg;base64,//swxAAAB5gnMzRhAAEHDWyDNLAAAAAaAQAu7tjAQAAABgMBgNNiBBAWD7ykMQf1g+D5/qBMHwfB/iAEPWCDv+o5wfPg+8EAQBMHz6gQB8Hwfsu2uWDrkw/a9xgUaMwFxxwCLsWS7MHN7VJki8fVT75eTqpn7/Xt1QxW//lJVbnfNuFRTzwrLn/5GVBnKMy/FVs5dTYABARKCMRm//syxAQACHBHWZ2kAAEJi+jxpg1Qlry2AYclVGyMwNoFJ29hqHqa1TRqRMCoetKstcqUzHBxQdCJmVcSJ/EQdEo0FXSoNLGkav/ljqPtEvjAoAE0zuEoM3lMJlLY3Uj65AMeMzQN6QWeLFdCcxLNFy4dBVXVfZ1L+gIki4KPQVBb4dERU6CrsFSoaLVHv/Ev9Hw4ANdAAG7VBBhVdP/7MsQFAAh8YybVowABG49vdx6AAm8ODBg8FDy9pmwIBsHPVGiPMueyERxZdIFnSpkzI8fezb+0z6OJVv7HHw7XBWdXwa6/y34l6sq7uitTjFTEgsFYrFQqFQDAGrQXMbpbb3ZGQWPWvTnyyeKKHgQ/nvlUf/u74oOHp/8v3R/dl/UcSXDz+kMBEHI0p5efiDJqb/64foFiBSWqB2r/+zLEA4AIVDlivZGAAQePKiWmDNhtwTYmBYyxnJdmZwmMtZ8ZjInEMMpo+VFWESqmhsWBoClhKKEhCW5UNPCsFVgqImyWS6KTAhEUrYoO7kaAWIJCwQzbgl5XrFBB27xoQwfnY6kozJtFz0SgICsWM3VIKWs6qr0tgI15/pQomHhblqjycRUCWe1dUOpxFOiJ/ooQC+IEEBlVdh0r//swxAUACGCjMy0kSsDoiCAA95gpQaBI041ceup5PSlsv5QNXMyixFLVkTXWpYUBYy/lEl4YCdWlLoZ//zGlKUBEhV0SiFT+us7WdBXqAbQ2hdxgDfH4RQsI+kgo2RnWVECiCa0TrUSNjalrUVVKyg0yapYqqVlRTNVLFf/2P/1qVadsTFKlitVMQU1FMy45OS4zVVVVVVVVVVVV",soundByteArray$7=base64SoundToByteArray(phetAudioContext$1,soundURI$7),unlock$7=asyncLoader.createLock(soundURI$7),wrappedAudioBuffer$7=new WrappedAudioBuffer;let unlocked$7=!1;const safeUnlock$7=()=>{unlocked$7||(unlock$7(),unlocked$7=!0)},onDecodeSuccess$7=o=>{wrappedAudioBuffer$7.audioBufferProperty.value===null&&(wrappedAudioBuffer$7.audioBufferProperty.set(o),safeUnlock$7())},onDecodeError$7=o=>{console.warn("decode of audio data failed, using stubbed sound, error: "+o),wrappedAudioBuffer$7.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$7()},decodePromise$7=phetAudioContext$1.decodeAudioData(soundByteArray$7.buffer,onDecodeSuccess$7,onDecodeError$7);decodePromise$7&&decodePromise$7.then(o=>{wrappedAudioBuffer$7.audioBufferProperty.value===null&&(wrappedAudioBuffer$7.audioBufferProperty.set(o),safeUnlock$7())}).catch(o=>{console.warn("promise rejection caught for audio decode, error = "+o),safeUnlock$7()});const generalCloseSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$7,{soundClipOptions:{initialOutputLevel:.4},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("generalCloseSoundPlayer",generalCloseSoundPlayer);const soundURI$6="data:audio/mpeg;base64,//swxAAABswbPzQxABEQFyzDMlAAAAGoGRIdz0AAARQAAAAAMCd5QEAxBA4sPlz/BAMfw+ooc8EA/EAYKAh/qBBYfwfD4jB/4nD98ZXetEKIxIqnuursF7pTGkY4dNYcaZhOjzgxDNndb75ggdCsIvV3qoeM9HIX215a6Hftuc5FhwFRhvuJuhxbMPp+ir0KlAaCTHVtZuCsLISS//syxAYACGhJXR2jABEVIGmw8YpieZwGg6y5/p6bf69uls4kMS9HVvrXl8hI5WPBY8FawqGh3PYlLA0HQm6ZHvUe/4UB4ChNzls1AZIAAxJNQMBOy4KAeSsL0QgRcxFInzpyhsQ6tvdvaM160ZnbY/2bY19dTlJVJmhrQpT/Vf0eVjfzG////6PMYzmtqJdg0WqADvRwaGDBgBO5T//7MsQFgAkEZSA1swABDRYvdx5QAhmAEZHdFc2HHLBy/LcmfqWvq1yftVsQSJAxzSi25i5w6qqvMy/cjgNSoKu2Q1LHp1S4NCJQsHfLUSINPxK6oxocyIhmMRkMhQAQBuyhLerW2u5zoV4af2nULcHzwOiPxQjFU/nvIyflMKARabfnQqGI/v/FAIV6UJnPAgAca//9NZUgFEnVWuP/+zLEA4AIVL1vnYQAEQkIajDMpMja7T9a7DL+uzSEg2RRajlNmUzFPCBtL7Uyoa/iVlabnj1+Pi9f61X5WuJ9V1XhkOmtYltLGPI1//8s/0PMAKmLuWQPy0Hrh0Uy4C5MCaWoC5bwOjrQpVOQIn9JNDksr2zEBLvAp3LCI8Is9BX1FTsS50j5Us8OCIqEg73ZZ9QByyIAiddlUPU0//swxAUCSEyXLMywatDDBOHA8zBIRfBtlFDU3P7EItHsWE51WgaTVpJLPMzOMYE1qUSth4pRSd1WkZLqqrnGPUobBm4oDUDHol//+rJBUlwL0rYuAoOSuFITEsfTp5a46IhKRBQ6FQkBQCWJESR0KhIeNASKGnsJgJCf///1VUxBTUUzLjk5LjNVVVVVVVVVVVVVVVVVVVVVVVVV",soundByteArray$6=base64SoundToByteArray(phetAudioContext$1,soundURI$6),unlock$6=asyncLoader.createLock(soundURI$6),wrappedAudioBuffer$6=new WrappedAudioBuffer;let unlocked$6=!1;const safeUnlock$6=()=>{unlocked$6||(unlock$6(),unlocked$6=!0)},onDecodeSuccess$6=o=>{wrappedAudioBuffer$6.audioBufferProperty.value===null&&(wrappedAudioBuffer$6.audioBufferProperty.set(o),safeUnlock$6())},onDecodeError$6=o=>{console.warn("decode of audio data failed, using stubbed sound, error: "+o),wrappedAudioBuffer$6.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$6()},decodePromise$6=phetAudioContext$1.decodeAudioData(soundByteArray$6.buffer,onDecodeSuccess$6,onDecodeError$6);decodePromise$6&&decodePromise$6.then(o=>{wrappedAudioBuffer$6.audioBufferProperty.value===null&&(wrappedAudioBuffer$6.audioBufferProperty.set(o),safeUnlock$6())}).catch(o=>{console.warn("promise rejection caught for audio decode, error = "+o),safeUnlock$6()});const generalOpenSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$6,{soundClipOptions:{initialOutputLevel:.4},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("generalOpenSoundPlayer",generalOpenSoundPlayer);class ComboBoxListItemNode extends Voicing(Node$2){constructor(e,t,n,r,s,a){const l=optionize()({cursor:"pointer",align:"left",xMargin:6,highlightFill:"rgb( 245, 245, 245 )",highlightCornerRadius:4,tagName:"li",focusable:!0,ariaRole:"option",positionInPDOM:!0,voicingFocusListener:()=>this.comboBoxListItemNodeVoicingFocusListener(),comboBoxVoicingNameResponsePattern:SunConstants.VALUE_NAMED_PLACEHOLDER,tandem:Tandem.REQUIRED,tandemNameSuffix:"Item",phetioType:IndexedNodeIO,phetioState:!0,visiblePropertyOptions:{phetioFeatured:!0}},a);l.comboBoxVoicingNameResponsePattern=l.comboBoxVoicingNameResponsePattern.get?l.comboBoxVoicingNameResponsePattern.get():l.comboBoxVoicingNameResponsePattern,assert&&assert(!!phet.chipper.queryParameters.stringTest||l.comboBoxVoicingNameResponsePattern.includes("{{value}}"),"value needs to be filled in");const d=new Rectangle({cornerRadius:l.highlightCornerRadius}),c=new Node$2({children:[t]}),y=X=>{d.rectWidth=X,c.maxWidth=X};r.link(y);const m=X=>{d.rectHeight=X,c.maxHeight=X};s.link(m);const O=()=>{l.align==="left"?c.left=d.left+l.xMargin:l.align==="right"?c.right=d.right-l.xMargin:c.centerX=d.centerX,c.centerY=d.centerY};c.boundsProperty.lazyLink(O),O(),l.children=[d,c],super(l),this._supplyOpenResponseOnNextFocus=!1;const D=new DerivedProperty([n],X=>X||""),z=typeof l.comboBoxVoicingNameResponsePattern=="string"?new Property(l.comboBoxVoicingNameResponsePattern):l.comboBoxVoicingNameResponsePattern,w=new PatternStringProperty(z,{value:D},{tandem:Tandem.OPT_OUT});this.voicingNameResponse=w;const N=X=>{this.innerContent=X,this.voicingObjectResponse=X};n.link(N),this.item=e,this.localBoundsProperty.link(X=>{this.focusHighlight=Shape$1.bounds(X)});const H=new PressListener({attach:!1,tandem:Tandem.OPT_OUT});this.addInputListener(H),H.looksOverProperty.link(X=>{d.fill=X?l.highlightFill:null}),this.disposeComboBoxListItemNode=()=>{H.dispose(),w.dispose(),D.dispose(),n.unlink(N),r.unlink(y),s.unlink(m)}}supplyOpenResponseOnNextFocus(){this._supplyOpenResponseOnNextFocus=!0}dispose(){this.disposeComboBoxListItemNode(),super.dispose()}comboBoxListItemNodeVoicingFocusListener(){this.voicingSpeakFullResponse({nameResponse:this._supplyOpenResponseOnNextFocus?this.voicingNameResponse:null,objectResponse:this._supplyOpenResponseOnNextFocus?null:this.voicingObjectResponse,contextResponse:null,hintResponse:this._supplyOpenResponseOnNextFocus?this.voicingHintResponse:null}),this._supplyOpenResponseOnNextFocus=!1}}sun.register("ComboBoxListItemNode",ComboBoxListItemNode);const ALIGN_VALUES$3=["left","center","right"],DEFAULT_OPTIONS={fill:"white",stroke:"black",lineWidth:1,lineDash:[],xMargin:5,yMargin:5,cornerRadius:10,resize:!0,backgroundPickable:!0,excludeInvisibleChildrenFromBounds:!0,align:"left",minWidth:0,minHeight:0};assert&&Object.freeze(DEFAULT_OPTIONS);const Ru=class Ru extends Sizable(Node$2){constructor(e,t){const n=optionize3()({},DEFAULT_OPTIONS,t);assert&&assert(_.includes(ALIGN_VALUES$3,n.align),`invalid align: ${n.align}`),super(),this._content=e,this._backgroundContainer=new Node$2,this._background=new Rectangle(0,0,1,1,{lineWidth:n.lineWidth,pickable:n.backgroundPickable,lineDash:n.lineDash,cornerRadius:n.cornerRadius}),this.setStroke(n.stroke),this.setFill(n.fill),this.addChild(this._backgroundContainer),this.addChild(e),this.constraint=new PanelConstraint(this,n),this.constraint.updateLayout(),this.constraint.enabled=n.resize,this.mutate(n)}getStroke(){return this._background.stroke}get stroke(){return this.getStroke()}set stroke(e){this.setStroke(e)}setStroke(e){this._background.stroke=e,this.constraint&&this.constraint.updateLayoutAutomatically()}getFill(){return this._background.fill}get fill(){return this.getFill()}set fill(e){this.setFill(e)}setFill(e){this._background.fill=e}setExcludeInvisibleChildrenFromBounds(e){super.setExcludeInvisibleChildrenFromBounds(e),this.constraint.updateLayoutAutomatically()}};Ru.DEFAULT_PANEL_OPTIONS=DEFAULT_OPTIONS;let Panel=Ru;class PanelConstraint extends LayoutConstraint{constructor(e,t){super(e),this.panel=e,assert&&assert(typeof t.minWidth=="number","Panel minWidth should be a number"),assert&&assert(typeof t.xMargin=="number","Panel xMargin should be a number"),assert&&assert(typeof t.yMargin=="number","Panel yMargin should be a number"),assert&&assert(typeof t.lineWidth=="number","Panel lineWidth should be a number"),assert&&assert(ALIGN_VALUES$3.includes(t.align),`Panel align should be one of ${ALIGN_VALUES$3}`),this.minWidth=t.minWidth,this.minHeight=t.minHeight,this.xMargin=t.xMargin,this.yMargin=t.yMargin,this.lineWidth=t.lineWidth,this.align=t.align,this.panel.localPreferredWidthProperty.lazyLink(this._updateLayoutListener),this.panel.localPreferredHeightProperty.lazyLink(this._updateLayoutListener),this.addNode(e._content)}layout(){super.layout();const e=this.panel,t=e._content,n=e._background,r=e.stroke===null?0:this.lineWidth,s=e.isChildIncludedInLayout(t);if(e._backgroundContainer.children=s?[n]:[],!s){e.localMinimumWidth=null,e.localMinimumHeight=null;return}const a=isWidthSizable(t)&&t.minimumWidth!==null?t.minimumWidth:t.width,l=isHeightSizable(t)&&t.minimumHeight!==null?t.minimumHeight:t.height,d=Math.max(this.minWidth,a+2*this.xMargin)+r,c=Math.max(this.minHeight,l+2*this.yMargin)+r,y=Math.max(d,e.localPreferredWidth||0),m=Math.max(c,e.localPreferredHeight||0);isWidthSizable(t)&&e.localPreferredWidth!==null&&(t.preferredWidth=y-r-2*this.xMargin),isHeightSizable(t)&&e.localPreferredHeight!==null&&(t.preferredHeight=m-r-2*this.yMargin),n.setRect(0,0,y-r,m-r),this.align==="center"?t.center=n.center:this.align==="left"?(t.left=n.centerX-n.rectWidth/2+this.xMargin,t.centerY=n.centerY):(t.right=n.centerX+n.rectWidth/2-this.xMargin,t.centerY=n.centerY),e.localMinimumWidth=d,e.localMinimumHeight=c}dispose(){this.panel.localPreferredWidthProperty.unlink(this._updateLayoutListener),this.panel.localPreferredHeightProperty.unlink(this._updateLayoutListener),super.dispose()}}sun.register("Panel",Panel);class ComboBoxListBox extends Panel{constructor(e,t,n,r,s,a,l,d,c){assert&&assert(t.length>0,"empty list box is not supported");const y=optionize()({highlightFill:"rgb( 245, 245, 245 )",comboBoxListItemNodeOptions:{},xMargin:12,yMargin:8,backgroundPickable:!0,tagName:"ul",ariaRole:"listbox",groupFocusHighlight:!0,openedSoundPlayer:generalOpenSoundPlayer,closedNoChangeSoundPlayer:generalCloseSoundPlayer,visiblePropertyOptions:{phetioReadOnly:!0}},c);assert&&assert(y.xMargin>0&&y.yMargin>0,`margins must be > 0, xMargin=${y.xMargin}, yMargin=${y.yMargin}`);const m=new PhetioAction$1(fe=>{const be=fe.currentTarget;assert&&assert(be instanceof ComboBoxListItemNode,"expected a ComboBoxListItemNode"),this.selectionOnFireAction=be;const Ae=e.value;a(),e.value=this.selectionOnFireAction.item.value,s(),this.voiceOnNewSelection(e.value,Ae,be),fe.abort()},{parameters:[{phetioPrivate:!0,valueType:SceneryEvent}],tandem:d.createTandem("fireAction"),phetioEventType:EventType.USER}),O={up(fe){m.execute(fe)},keyup:fe=>{fe.domEvent&&KeyboardUtils.isAnyKeyEvent(fe.domEvent,[KeyboardUtils.KEY_ENTER,KeyboardUtils.KEY_SPACE])&&m.execute(fe)},click:fe=>{m.execute(fe)}},D=ComboBox.getMaxItemWidthProperty(n),z=ComboBox.getMaxItemHeightProperty(n),w=new DerivedProperty([D],fe=>fe+y.xMargin),N=new DerivedProperty([z],fe=>fe+y.yMargin),H=[];t.forEach((fe,be)=>{const Ae=r.get(fe.value);assert&&assert(Ae);const W=new ComboBoxListItemNode(fe,n[be],Ae,w,N,combineOptions({align:y.align,highlightFill:y.highlightFill,highlightCornerRadius:y.cornerRadius,xMargin:.5*y.xMargin,tandem:fe.tandemName?d.createTandem(fe.tandemName):Tandem.OPTIONAL},y.comboBoxListItemNodeOptions,fe.comboBoxListItemNodeOptions));H.push(W),W.addInputListener(O)});const X=new VBox({spacing:0,excludeInvisibleChildrenFromBounds:!0,children:H});super(X,combineOptions({},y,{xMargin:y.xMargin/2,yMargin:y.yMargin/2})),this.content=X,this.voiceOnSelectionNode=l,this.selectionOnFireAction=this.getListItemNode(e.value);const ae=t.map(fe=>multiSelectionSoundPlayerFactory.getSelectionSoundPlayer(t.indexOf(fe)));let oe;this.visibleProperty.lazyLink(fe=>{if(fe)y.openedSoundPlayer.play(),oe=this.getListItemNode(e.value);else if(assert&&assert(oe,"no Node for when list box was opened"),oe===this.selectionOnFireAction)y.closedNoChangeSoundPlayer.play();else{const be=this.selectionOnFireAction.item;if(be.soundPlayer)be.soundPlayer.play();else{const Ae=this.getVisibleListItemNodes().indexOf(this.selectionOnFireAction);Ae!==-1&&ae[Ae].play()}}});const ue=new KeyboardListener({keys:["escape","tab","shift+tab","arrowUp","arrowDown","home","end"],callback:(fe,be)=>{const Ae=fe;assert&&assert(Ae,"event is required for this listener");const W=this.getVisibleListItemNodes();if(be==="escape"||be==="tab"||be==="shift+tab")Ae.abort(),s(),a();else if(be==="arrowUp"||be==="arrowDown"){const J=Ae.domEvent;assert&&assert(J,"domEvent is required for this listener"),J.preventDefault();const Ue=be==="arrowDown"?1:-1,gt=W.indexOf(this.getFocusedItemNode());assert&&assert(gt>-1,"how could we receive keydown without a focused list item?");const Te=gt+Ue;W[Te]&&W[Te].focus(),Ae.pointer.reserveForKeyboardDrag()}else be==="home"?W[0].focus():be==="end"&&W[W.length-1].focus()}});this.addInputListener(ue),this.disposeComboBoxListBox=()=>{for(let fe=0;fe<H.length;fe++)H[fe].dispose();this.removeInputListener(ue),ue.dispose(),m.dispose(),D.dispose(),z.dispose()}}dispose(){this.disposeComboBoxListBox(),super.dispose()}setItemVisible(e,t){this.getListItemNode(e).visible=t}isItemVisible(e){return this.getListItemNode(e).visible}getAllListItemNodes(){return this.content.children}getVisibleListItemNodes(){return this.getAllListItemNodes().filter(e=>e.visible)}getListItemNode(e){const t=_.find(this.getAllListItemNodes(),n=>n.item.value===e);return assert&&assert(t,`no item found for value: ${e}`),assert&&assert(t instanceof ComboBoxListItemNode,"invalid listItemNode"),t}getFocusedItemNode(){const e=_.find(this.getAllListItemNodes(),t=>t.focused);return assert&&assert(e,"no item found that has focus"),assert&&assert(e instanceof ComboBoxListItemNode,"invalid listItemNode"),e}focusListItemNode(e){let t=this.getListItemNode(e);t.visible||(t=_.find(this.getAllListItemNodes(),n=>n.visible)),t&&(t.supplyOpenResponseOnNextFocus(),t.focus())}voiceOnNewSelection(e,t,n){const r={nameResponse:n.voicingNameResponse,objectResponse:null,contextResponse:n.voicingContextResponse,hintResponse:null};t===e&&(r.contextResponse=null),this.voiceOnSelectionNode.voicingSpeakResponse(r)}}sun.register("ComboBoxListBox",ComboBoxListBox);const LIST_POSITION_VALUES=["above","below"],ALIGN_VALUES$2=["left","right","center"],ITEM_TANDEM_NAME_SUFFIX="Item",ACCESSIBLE_NAME_BEHAVIOR$1=(o,e,t,n)=>(n.push(()=>{o.button.accessibleName=t}),e),HELP_TEXT_BEHAVIOR=(o,e,t,n)=>(n.push(()=>{o.button.helpText=t}),e),el=class el extends WidthSizable(Node$2){constructor(e,t,n,r){var d,c;assert&&assert(_.uniqBy(t,y=>y.value).length===t.length,"items must have unique values"),assert&&t.forEach(y=>{assert&&assert(!y.tandemName||y.tandemName.endsWith(ITEM_TANDEM_NAME_SUFFIX),`ComboBoxItem tandemName must end with '${ITEM_TANDEM_NAME_SUFFIX}': ${y.tandemName}`)}),assert&&assert(n.maxWidth===null,"ComboBox is responsible for scaling listBox. Setting maxWidth for listParent may result in buggy behavior.");const s=optionize()({align:"left",listPosition:"below",labelXSpacing:10,disabledOpacity:.5,cornerRadius:4,highlightFill:"rgb( 245, 245, 245 )",xMargin:12,yMargin:8,buttonFill:"white",buttonStroke:"black",buttonLineWidth:1,buttonTouchAreaXDilation:0,buttonTouchAreaYDilation:0,buttonMouseAreaXDilation:0,buttonMouseAreaYDilation:0,listFill:"white",listStroke:"black",listLineWidth:1,openedSoundPlayer:generalOpenSoundPlayer,closedNoChangeSoundPlayer:generalCloseSoundPlayer,tagName:"div",accessibleNameBehavior:ACCESSIBLE_NAME_BEHAVIOR$1,helpTextBehavior:HELP_TEXT_BEHAVIOR,comboBoxVoicingNameResponsePattern:SunConstants.VALUE_NAMED_PLACEHOLDER,comboBoxVoicingContextResponse:null,comboBoxVoicingHintResponse:null,tandem:Tandem.REQUIRED,tandemNameSuffix:"ComboBox",phetioType:el.ComboBoxIO,phetioFeatured:!0,phetioEventType:EventType.USER,visiblePropertyOptions:{phetioFeatured:!0},phetioEnabledPropertyInstrumented:!0},r),a=getGroupItemNodes(t,s.tandem.createTandem("items"));assert&&a.forEach(y=>{assert&&assert(!y.hasPDOMContent,"Accessibility is provided by ComboBoxItemNode and ComboBoxItem.a11yLabel. Additional PDOM content in the provided Node could break accessibility.")}),assert&&assert(s.xMargin>0&&s.yMargin>0,`margins must be > 0, xMargin=${s.xMargin}, yMargin=${s.yMargin}`),assert&&assert(_.includes(LIST_POSITION_VALUES,s.listPosition),`invalid listPosition: ${s.listPosition}`),assert&&assert(_.includes(ALIGN_VALUES$2,s.align),`invalid align: ${s.align}`),super(),this.nodes=a,this.a11yNamePropertyMap=el.getA11yNamePropertyMap(t),this.listPosition=s.listPosition,this.button=new ComboBoxButton(e,t,a,this.a11yNamePropertyMap,{align:s.align,arrowDirection:s.listPosition==="below"?"down":"up",cornerRadius:s.cornerRadius,xMargin:s.xMargin,yMargin:s.yMargin,baseColor:s.buttonFill,stroke:s.buttonStroke,lineWidth:s.buttonLineWidth,touchAreaXDilation:s.buttonTouchAreaXDilation,touchAreaYDilation:s.buttonTouchAreaYDilation,mouseAreaXDilation:s.buttonMouseAreaXDilation,mouseAreaYDilation:s.buttonMouseAreaYDilation,localPreferredWidthProperty:this.localPreferredWidthProperty,localMinimumWidthProperty:this.localMinimumWidthProperty,comboBoxVoicingNameResponsePattern:s.comboBoxVoicingNameResponsePattern,tandem:s.tandem.createTandem("button")}),this.addChild(this.button),this.listBox=new ComboBoxListBox(e,t,a,this.a11yNamePropertyMap,this.hideListBox.bind(this),()=>{this.button.blockNextVoicingFocusListener(),this.button.focus()},this.button,s.tandem.createTandem("listBox"),{align:s.align,highlightFill:s.highlightFill,xMargin:s.xMargin,yMargin:s.yMargin,cornerRadius:s.cornerRadius,fill:s.listFill,stroke:s.listStroke,lineWidth:s.listLineWidth,visible:!1,comboBoxListItemNodeOptions:{comboBoxVoicingNameResponsePattern:s.comboBoxVoicingNameResponsePattern,voicingContextResponse:s.comboBoxVoicingContextResponse,voicingHintResponse:s.comboBoxVoicingHintResponse},openedSoundPlayer:s.openedSoundPlayer,closedNoChangeSoundPlayer:s.closedNoChangeSoundPlayer,ariaLabelledbyAssociations:[{otherNode:this.button,otherElementName:PDOMPeer$1.LABEL_SIBLING,thisElementName:PDOMPeer$1.PRIMARY_SIBLING}]}),n.addChild(this.listBox),this.listParent=n;const l=new MatrixBetweenProperty(this.button,this.listParent,{fromCoordinateFrame:"parent",toCoordinateFrame:"local"});Multilink.multilink([l,this.button.localBoundsProperty,this.listBox.localBoundsProperty],y=>{this.scaleAndPositionListBox(y)}),this.opacityProperty.link(y=>{this.listBox.opacityProperty.value=y}),this.mutate(s),assert&&Tandem.VALIDATION&&this.isPhetioInstrumented()&&t.forEach(y=>{assert&&assert(y.tandemName!==null,`PhET-iO instrumented ComboBoxes require ComboBoxItems to have tandemName: ${y.value}`)}),this.button.addListener(()=>{this.listBox.visibleProperty.value=!this.listBox.visibleProperty.value,this.listBox.visibleProperty.value&&this.listBox.focusListItemNode(e.value)}),this.display=null,this.clickToDismissListener={down:y=>{(!phet.chipper.isFuzzEnabled()||dotRandom.nextDouble()<.005)&&(y.trail.containsNode(this.button)||y.trail.containsNode(this.listBox)||this.hideListBox())}},this.dismissWithFocusListener=y=>{y&&!y.trail.containsNode(this.listBox)&&this.hideListBox()},FocusManager.pdomFocusProperty.link(this.dismissWithFocusListener),this.listBox.visibleProperty.link(y=>{y?(this.scaleListBox(),this.listBox.moveToFront(),assert&&assert(!this.display,"unexpected display"),this.display=this.getUniqueTrail().rootNode().getRootedDisplays()[0],this.display.addInputListener(this.clickToDismissListener)):this.display&&this.display.hasInputListener(this.clickToDismissListener)&&(this.display.removeInputListener(this.clickToDismissListener),this.display=null)}),this.displayOnlyProperty=new BooleanProperty(!1,{tandem:s.tandem.createTandem("displayOnlyProperty"),phetioFeatured:!0,phetioDocumentation:"disables interaction with the ComboBox and makes it appear like a display that shows the current selection"}),this.displayOnlyProperty.link(y=>{this.hideListBox(),this.button.setDisplayOnly(y),this.pickable=!y}),this.addLinkedElement(e,{tandemName:"property"}),this.disposeComboBox=()=>{l.dispose(),this.display&&this.display.hasInputListener(this.clickToDismissListener)&&this.display.removeInputListener(this.clickToDismissListener),FocusManager.pdomFocusProperty.unlink(this.dismissWithFocusListener),this.displayOnlyProperty.dispose(),this.listBox.dispose(),this.button.dispose(),a.forEach(y=>y.dispose())},assert&&((c=(d=phet==null?void 0:phet.chipper)==null?void 0:d.queryParameters)!=null&&c.binder)&&InstanceRegistry.registerDataURL("sun","ComboBox",this)}dispose(){this.disposeComboBox(),super.dispose()}showListBox(){this.listBox.visibleProperty.value=!0}hideListBox(){this.listBox.visibleProperty.value=!1}scaleListBox(){if(!this.listBox.localBounds.isEmpty()){const e=this.button.localToGlobalBounds(this.button.localBounds).width/this.button.localBounds.width,t=this.listBox.localToGlobalBounds(this.listBox.localBounds).width/this.listBox.localBounds.width;this.listBox.scale(e/t)}}scaleAndPositionListBox(e){e&&(this.scaleListBox(),this.listPosition==="above"?this.listBox.leftBottom=e.timesVector2(this.button.leftTop):this.listBox.leftTop=e.timesVector2(this.button.leftBottom))}setItemVisible(e,t){this.listBox.setItemVisible(e,t)}isItemVisible(e){return this.listBox.isItemVisible(e)}static getMaxItemWidthProperty(e){const t=_.flatten(e.map(n=>{const r=[n.boundsProperty];return extendsWidthSizable(n)&&(r.push(n.isWidthResizableProperty),r.push(n.minimumWidthProperty)),r}));return DerivedProperty.deriveAny(t,()=>Math.max(...e.map(n=>isWidthSizable(n)?n.minimumWidth||0:n.width)),{strictAxonDependencies:!1})}static getMaxItemHeightProperty(e){const t=e.map(n=>n.boundsProperty);return DerivedProperty.deriveAny(t,()=>Math.max(...e.map(n=>n.height)),{strictAxonDependencies:!1})}static getA11yNamePropertyMap(e){const t=new Map;return e.forEach(n=>{let r;isTReadOnlyProperty(n.a11yName)?r=n.a11yName:typeof n.a11yName=="string"?r=new TinyProperty(n.a11yName):r=new TinyProperty(null),t.set(n.value,r)}),t}};el.ComboBoxIO=new IOType("ComboBoxIO",{valueType:el,documentation:"A combo box is composed of a push button and a listbox. The listbox contains items that represent choices. Pressing the button pops up the listbox. Selecting from an item in the listbox sets the value of an associated Property. The button shows the item that is currently selected.",supertype:Node$2.NodeIO,events:["listBoxShown","listBoxHidden"]});let ComboBox=el;sun.register("ComboBox",ComboBox);const ALIGN_VALUES$1=["left","center","right"],ARROW_DIRECTION_VALUES=["up","down"],ACCESSIBLE_NAME_BEHAVIOR=(o,e,t)=>(e.labelTagName="p",e.labelContent=t,e);class ComboBoxButton extends RectangularPushButton{constructor(e,t,n,r,s){const a=optionize()({align:"left",arrowDirection:"down",arrowFill:"black",comboBoxVoicingNameResponsePattern:SunConstants.VALUE_NAMED_PLACEHOLDER,cursor:"pointer",baseColor:"white",buttonAppearanceStrategy:ButtonNode.FlatAppearanceStrategy,xMargin:12,yMargin:8,stroke:"black",lineWidth:1,soundPlayer:nullSoundPlayer,enabledPropertyOptions:{phetioFeatured:!1},visiblePropertyOptions:{phetioFeatured:!1},localPreferredWidthProperty:new TinyProperty(null),localMinimumWidthProperty:new TinyProperty(null),containerTagName:"div",accessibleNameBehavior:ACCESSIBLE_NAME_BEHAVIOR},s);assert&&assert(_.includes(ALIGN_VALUES$1,a.align),`invalid align: ${a.align}`),assert&&assert(_.includes(ARROW_DIRECTION_VALUES,a.arrowDirection),`invalid arrowDirection: ${a.arrowDirection}`);const l=a.xMargin,d=a.yMargin,c=ComboBox.getMaxItemWidthProperty(n),y=ComboBox.getMaxItemHeightProperty(n),m=new Path(null,{fill:a.arrowFill}),O=_.find(t,ue=>ue.value===e.value),D=t.indexOf(O),z=new Node$2({layoutOptions:{yMargin:d,grow:1,xAlign:a.align},children:[n[D]]}),w=new Line(0,0,0,0,{stroke:"black",lineWidth:a.lineWidth});a.content=new GridBox({rows:[[z,w,m]]}),Multilink.multilink([c,y],(ue,fe)=>{const be=fe+2*d,Ae=be,W=.35*Ae,J=2*W*Math.sqrt(3)/3,Ue=l,gt=l-a.lineWidth/2,Te=-a.lineWidth/2,Et=(Bt,Ke,At)=>Bt==="up"?new Shape$1().moveTo(0,At).lineTo(Ke/2,0).lineTo(Ke,At).close():new Shape$1().moveTo(0,0).lineTo(Ke,0).lineTo(Ke/2,At).close();m.shape=Et(a.arrowDirection,J,W),m.mutateLayoutOptions({minContentWidth:Ae,minContentHeight:Ae}),z.mutateLayoutOptions({minContentWidth:ue,minContentHeight:fe,leftMargin:Ue,rightMargin:gt}),w.y2=be,w.mutateLayoutOptions({rightMargin:Te})}),a.xMargin=0,a.yMargin=0,super(a),this.minimumWidthProperty.link(ue=>{a.localMinimumWidthProperty.value=ue});const N=ue=>{this.preferredWidth=ue};a.localPreferredWidthProperty.link(N),this._blockNextVoicingFocusListener=!1,this.voicingFocusListener=()=>{!this._blockNextVoicingFocusListener&&this.defaultFocusListener(),this._blockNextVoicingFocusListener=!1};let H=null;const X=new DerivedProperty([e],ue=>{const fe=_.find(t,be=>be.value===ue);return assert&&assert(fe,`no item found for value: ${ue}`),fe}),ae=new DerivedProperty([X],ue=>n[t.indexOf(ue)]),oe=new DynamicProperty(X,{derive:ue=>r.get(ue.value)});ae.link(ue=>{z.removeAllChildren(),z.addChild(ue)}),oe.link(ue=>{this.innerContent=ue;const fe=typeof a.comboBoxVoicingNameResponsePattern=="string"?new Property(a.comboBoxVoicingNameResponsePattern):a.comboBoxVoicingNameResponsePattern;H&&H.dispose(),this.voicingNameResponse=H=new PatternStringProperty(fe,{value:ue||""},{tandem:Tandem.OPT_OUT})}),this.ariaLabelledbyAssociations=[{otherNode:this,otherElementName:PDOMPeer$1.LABEL_SIBLING,thisElementName:PDOMPeer$1.PRIMARY_SIBLING},{otherNode:this,otherElementName:PDOMPeer$1.PRIMARY_SIBLING,thisElementName:PDOMPeer$1.PRIMARY_SIBLING}],AriaHasPopUpMutator.mutateNode(this,"listbox"),this.disposeComboBoxButton=()=>{c.dispose(),y.dispose(),X.dispose(),a.localPreferredWidthProperty.unlink(N),H&&H.dispose()},this.arrow=m,this.separatorLine=w}setDisplayOnly(e){this.arrow.visible=!e,this.separatorLine.visible=!e}blockNextVoicingFocusListener(){this._blockNextVoicingFocusListener=!0}dispose(){this.disposeComboBoxButton(),super.dispose()}}sun.register("ComboBoxButton",ComboBoxButton);class PageControl extends Node$2{constructor(e,t,n){const r=optionize()({interactive:!1,orientation:"horizontal",dotRadius:3,lineWidth:1,dotSpacing:10,dotTouchAreaDilation:4,dotMouseAreaDilation:4,currentPageFill:"black",currentPageStroke:null,pageFill:"rgb( 200, 200, 200 )",pageStroke:null,tandem:Tandem.REQUIRED,tandemNameSuffix:"PageControl",visiblePropertyOptions:{phetioFeatured:!0}},n);assert&&assert(LayoutOrientationValues.includes(r.orientation),`invalid orientation=${r.orientation}`);const s=new PressListener({press:m=>{m.currentTarget instanceof DotNode&&(e.value=m.currentTarget.pageNumber)},tandem:r.tandem.createTandem("pressListener")}),a={lineWidth:r.lineWidth,mouseArea:r.dotMouseAreaDilation===0?null:Shape$1.circle(0,0,r.dotRadius+r.dotMouseAreaDilation),touchArea:r.dotTouchAreaDilation===0?null:Shape$1.circle(0,0,r.dotRadius+r.dotTouchAreaDilation),boundsMethod:"unstroked",cursor:r.interactive?"pointer":null,inputListeners:r.interactive?[s]:[]},l=new FlowBox({orientation:r.orientation,spacing:r.dotSpacing});let d=[];l.boundsProperty.link(()=>{l.center=Vector2.ZERO});const c=m=>{d.forEach(O=>{O.fill=m===O.pageNumber?r.currentPageFill:r.pageFill,O.stroke=m===O.pageNumber?r.currentPageStroke:r.pageStroke})};e.link(c);const y=m=>{assert&&assert(m>=1),d=_.range(0,m).map(O=>new DotNode(O,r.dotRadius,a)),l.children=d,c(e.value)};t.link(y),r.children=[l],super(r),this.disposePageControl=()=>{s.dispose(),t.unlink(y),e.unlink(c)}}dispose(){this.disposePageControl(),super.dispose()}}class DotNode extends Circle{constructor(e,t,n){super(t,n),this.pageNumber=e}}sun.register("PageControl",PageControl);class CarouselComboBox extends WidthSizable(Node$2){constructor(e,t,n){const r=optionize()({itemNodeOptions:{align:"left",overColor:Color.grayColor(245),selectedColor:"yellow",xMargin:6,yMargin:2},carouselOptions:{buttonOptions:{arrowSize:new Dimension2(20,4)},orientation:"vertical",spacing:0,margin:0,itemsPerPage:15},pageControlOptions:{interactive:!0},buttonOptions:{arrowDirection:"down",baseColor:"rgb( 218, 236, 255 )",xMargin:6,yMargin:4},tandem:Tandem.OPTIONAL},n);assert&&assert(r.carouselOptions.orientation==="vertical","orientation must be vertical"),assert&&assert(r.buttonOptions.arrowDirection==="down","arrowDirection must be down"),r.carouselOptions.itemsPerPage=Math.min(r.carouselOptions.itemsPerPage,t.length),r.carouselOptions.tandem=r.carouselOptions.tandem||r.tandem.createTandem("carousel"),r.buttonOptions.tandem=r.buttonOptions.tandem||r.tandem.createTandem("button"),super(),this.a11yNamePropertyMap=ComboBox.getA11yNamePropertyMap(t);const s=new AlignGroup,a=getGroupItemNodes(t,r.tandem.createTandem("items")),l=_.map(t,(H,X)=>({createNode:()=>new CarouselItemNode(e,H,a[X],s,r.itemNodeOptions)}));assert&&assert(l.length===t.length,"expected a carouselItem for each comboBoxItem");const d=[],c=new Carousel(l,r.carouselOptions);d.push(c);let y=null;c.numberOfPagesProperty.value>1&&(y=new PageControl(c.pageNumberProperty,c.numberOfPagesProperty,combineOptions({orientation:r.carouselOptions.orientation},r.pageControlOptions)),d.push(y));const m=new HBox({spacing:4,children:d}),O=new ComboBoxButton(e,t,a,this.a11yNamePropertyMap,combineOptions({listener:()=>{m.visible=!m.visible},widthSizable:r.widthSizable,localPreferredWidthProperty:this.localPreferredWidthProperty,localMinimumWidthProperty:this.localMinimumWidthProperty},r.buttonOptions)),D=new VBox({spacing:0,align:"left",children:[O,m]});r.children=[D],this.mutate(r);const z=()=>{m.visible=!1};e.link(z);const w={down:H=>{if(assert&&assert(c.visible,"this listener should be registered only when carousel is visible"),!phet.chipper.isFuzzEnabled()||dotRandom.nextDouble()<.25){const X=H.trail;!X.containsNode(O)&&!X.containsNode(c)&&(!y||!X.containsNode(y))&&(m.visible=!1)}}};let N=null;m.visibleProperty.link(H=>{H?(assert&&assert(!N,"unexpected display"),N=this.getUniqueTrail().rootNode().getRootedDisplays()[0],N.addInputListener(w)):N&&N.hasInputListener(w)&&(N.removeInputListener(w),N=null)}),this.disposeCarouselComboBox=()=>{e.unlink(z),O.dispose(),y&&y.dispose(),c.dispose(),a.forEach(H=>H.dispose())}}dispose(){this.disposeCarouselComboBox(),super.dispose()}}class CarouselItemNode extends Node$2{constructor(e,t,n,r,s){const a=optionize()({align:"left",xMargin:6,yMargin:2,overColor:Color.grayColor(245),selectedColor:"yellow",tandem:Tandem.OPTIONAL},s),l=new AlignBox(n,{xAlign:a.align,group:r}),d=new Rectangle(0,0,1,1);l.boundsProperty.link(m=>{d.setRectBounds(m.dilatedXY(a.xMargin,a.yMargin))}),a.children=[d,l],super(a);const c=new PressListener({press:()=>{e.value=t.value},tandem:a.tandem.createTandem("pressListener")});this.addInputListener(c);const y=new Multilink([e,c.isOverProperty],(m,O)=>{m===t.value?d.fill=a.selectedColor:O?d.fill=a.overColor:d.fill="transparent"});this.disposeCarouselItemNode=()=>{y.dispose()}}dispose(){this.disposeCarouselItemNode(),super.dispose()}}sun.register("CarouselComboBox",CarouselComboBox);const checkEmptySolidShape=new Shape$1("M1120 1280h-832q-66 0 -113 -47t-47 -113v-832q0 -66 47 -113t113 -47h832q66 0 113 47t47 113v832q0 66 -47 113t-113 47zM1408 1120v-832q0 -119 -84.5 -203.5t-203.5 -84.5h-832q-119 0 -203.5 84.5t-84.5 203.5v832q0 119 84.5 203.5t203.5 84.5h832 q119 0 203.5 -84.5t84.5 -203.5z").makeImmutable(),checkSquareOSolidShape=new Shape$1("M1408 606v-318q0 -119 -84.5 -203.5t-203.5 -84.5h-832q-119 0 -203.5 84.5t-84.5 203.5v832q0 119 84.5 203.5t203.5 84.5h832q63 0 117 -25q15 -7 18 -23q3 -17 -9 -29l-49 -49q-10 -10 -23 -10q-3 0 -9 2q-23 6 -45 6h-832q-66 0 -113 -47t-47 -113v-832 q0 -66 47 -113t113 -47h832q66 0 113 47t47 113v254q0 13 9 22l64 64q10 10 23 10q6 0 12 -3q20 -8 20 -29zM1639 1095l-814 -814q-24 -24 -57 -24t-57 24l-430 430q-24 24 -24 57t24 57l110 110q24 24 57 24t57 -24l263 -263l647 647q24 24 57 24t57 -24l110 -110 q24 -24 24 -57t-24 -57z").makeImmutable(),soundURI$5="data:audio/mpeg;base64,//twxAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAARAAAWCgAPDw8PDx4eHh4eHi0tLS0tLTw8PDw8PEtLS0tLS1paWlpaWmlpaWlpaXh4eHh4eIeHh4eHlpaWlpaWpaWlpaWltLS0tLS0w8PDw8PD0tLS0tLS4eHh4eHh8PDw8PDw//////8AAAA3TEFNRTMuOThyAc0AAAAAAAAAABRgJAZTQgAAYAAAFgoMxGP1AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/7cMQAAA7gbOxVvYACW5Fntz3AA5QAAyAQIBEys3MtCTFFg5TGPm8D3KgDTJuEccMxAZkMFHzKy0ykhAROIho0JQOFfTbU8iRzFi4zYwMgBiUFMRDxoHLdpJtwSEMGBAMAKWRFL8swriCVA0i2X2oxYpIxKJZScr2+g+8oCBQ5//5cP////y4P/y4fgEAoFAoFArLYAAAAAAMDYCMx+k2DAeA6MFEIcGgkCIdk1vDGDNcO0Mt0zUwRA+DC3HiMGkE03THtDaEMoMFkBAwKgmzBaBoMAgB8+fQzksxMVigyANDAggAQJN9mcHA4kFpgsEJllrRoCrC05kkQjR0MTisME7eQcphFoRHX7nUoy4CvF0UrhPiwWUy2x/P/PDDn/jLuqAGAAwDcEMMCHBhjCbwtwwKoHpMM+Ev/+3LECwNSzIkWXf2ACj+QoEXu5SkzE0he0zdxYLM8SH/zF7hbcxLcKaMHFCGjA5wQ0wSoE1MK+B4zAZAMwwDwDJMATAJjAxgRc1J/MpODbWY3W8MeEjJxMAAiO5iZUAhUFAIqBAUiEh4OCQSGGHArEVNUyE8wYKmTDJZl8pVXx5IYtUr673fO8xs0t7Ptb8bKV8UnuCIwTR2DLDFMMHUaMyDhPDIsI8M4ME00OMfT/wfHOBoKcxZUYjP9nDXBIzYicDQuIjXdjAyITWM0DiVnjL4Gza8sjHUVTPsCDQw/wMRJhEBZiGHIYMQkLaKoVCMsAmkcYk5vHm0AIAwSGW2TdCGTMcMMCMLyVipZcplALqSm/DURt95nlTdZjvOYyWrK46xN9WogBoCswawJDJACtMW4KExLSlDBsP/7cMQKABFIgQI17gASa5Mjaz3QAE3NLvnQ3agRDJ+DSMbgYExaABTE4EHMFIM4wwBnzAWAVMBYMAwgwkjBjDYNAKwyiLzEKxPMXsGB80aSkKDAQoMWgYtinyYmCYwER4ElzUrDHIBWSrc/T4pDAoBCwVZK7mOFNL3Wh2NUzOn6m+548/kht9JTqojAAAAEgMQKAAAAAAMA8A4wNw8DAgA9MMUIcQhtmGeEGYMAu5gnAomMSHcYCYNBkVBSmS+F8YBgAgGBJMHEU0xtw/zDiLVMxpn4xFAlAGbDnGZJgUfrl2aOjomK8jJwUMhgGABhAFRgKCwUAAu8k437py0SDRp6lj8Bgoski0Ff+++iWkItSgfwrAOkgGWY5f//9ne//7luZoyn9dUFRgAAwIBIw5CYxaOMxUGsxfH/+3LECQNQPJcafd4AGmmS38XvaShMaMQ29Y4HAKZcCMZWigIzAMzxoCgAmHoLiMUTLISzNunD5V0TlJYNXoQzCHBY5jACC4TFgiporE9rpO005iSiseWg60bdWG2ove12Uw7EwqDm/fmUQfYtQ1TWX9eWHZbQWm53a2WrVWZlFN+rfqa0QwzxGjEDGKMJIO8x+AJDCjO1MnMPU5+nqzFkYHM2I20x3iHDBzC1MLsZsxoAeTD9CsMMos8zVDZTN7EePxtJIxYgyDGTB+MPIHowBgGTADBbMMwC8wdAHQgAQwVwPlFxQBAwLQIhICgSXHCUCJKDiKuU7VAVVa7EVuui/6eCOSJLoN/GpSyzj/3aWls7w7EMufvur0t//tfyepULAAMFIm0wPA7iZsMxzQnjI4CXMkIcc3s5sP/7cMQNA1L0jPxPeylKLhGfRe7lKDdTH5GhojDABOMIkYUwNAuTGYGZMKEnMw5RgzDsMvEZsZsuJMGB0IUYbAIphfgdGA+DCYBQfxg1gImBWBMEAOBYBwwDQDk+ESQCASVEjLWMJA2YUAyFiirR2rNnEhGJxRfAMVSYa/K2uxFLZyY9ALryyBa31mHYXsse6+il0QwGAzDEVK6Mc4xQ1IgzDF9B6Npko4yElYDF9IGMnoGwzaSlzxAXzJ51TMYUjdJ8DBIajEz7j4TjDtTFTBaNDKoJjJgVzEJnjFgLzHoWzDQMkaw4TjCgBWmR1ahgHmUObQZ8uBw7/U0NqvX+pi6cMMwCwctZS8lLVXbAUvfaFYaw18B8s95/3a1C+7SqDQADDyGiMrE1QybhITRuVZMKYroyWRTTQ3b/+3LEDQNTCH74T3tJQjOQHwXu5Si1MVYJYyuCnTBmGJMjAKYxKBBjIpHGMVQW4wSBIzHZFRMfdJYzSWXjBrIzMVMOowVQNDBMBfMGAIgGgSmB+AQYB4BKSpgOgCl60STAJAMSVLUGTUnWAwajZPLzVYFySQT3UkGQ6NCofaHDjAkvl+bVW7N37Eb21jAJBdgiffpIYRJMhhFhymNmUUYqY/ZjKjymScW8Y71jZoaoamSqPyY/g7ZnyZZqs8ZmwAx0bSJoXG5vMPJqs3p0j/Jw9JBnWLZq8XZiURphEEQADswVAYwFAQOBwFCwVgaYCAmFADBzYWVPRM3HVLKFzKN0gqUzemZ08y1KNesWma1u3LoakFNh3fx+zpihGmJDu/TVMLUYcyLB+zDTE/M1MgwxgQCTATHNNNW0U//7cMQMg9AYfPgPdylB/o+fQe7hKIkx/DKxKGMy0GoxzTkzcQUzPL00cgQxnZE2mVszgdQzBtM+2AUoKExLAIw9BowtB4w1AQwBBdwQCAxgcCaM4YBCYYkcYQhmxEb0NsmWO6CQ7cnlzmGVwfbmMrP37m5XO///yImYwX+swEB1zFWAWMc8awx9hSzC7C6MewRQ0GiZTadBbMQIRAwOwDTKlXTF1CTLoWjNlbjABMDFJpTCYtT8PIjhwBjDoOAcWhhEEBiCHBhKAwCBAKgqYCgQEAE10MAWSgU5QMG7DnqBsEbG9bNYam3/ksqrXI7d3nQ473nqxvWM8fyYgQolAAMEiHMj0fMTBTM7hoMvhYM9yoMQfQONUNMoiqMESlMJ8AIwfgbzBJBwMMUUUwjAUysDkwNhdDQWDAP/+3LEHgNPbHz+TvsJQeIP30nu4SgDEBEgBhMCgFkwEwEgMBaYAwBCsZWAQzoeAFh9oDBosWZZ0LTk0NOtK5evtb8vns4frSrDV6rhn3mX/zKODLkHIYMQCZgYhqmFwEcYzALBhAg4mG8CAYlrfxg7BhGKuICYF4LBiUM5g8BQMJEzID40bL0xKLYwMmw4t98yiHgzdD8CDkYIBekWYFgqVQAAoAMrCArac7zC5UWADFYMl8ifyiVpZWwyXwywCVyOzey1PX9V/z//1H/TAAAI4AAETSCErTTotzbsTzLs7TNkMzIS0D/pmDHkmTGkczAbByMI0DcwRwAjCZGUMH4AYwoAJjAVFvNh8TgwgASQIAgYHQMpgFgSIIjAXACFgCYeVgMAQBqILBBYAFpTPXTJwz0sdqHWvJOiSP/7cMQ2g0+4fPsu+wlB2Y+eye7hKIdobk7bu6z+13Udv///8x+mpDCjDRMUgCYwUwpDANDLMGcOowyg2jOzJmN+IQoxdAhzDyCdMICkARmmCgImaagmVALmeBoGE+hn+zWGW4/GFgpGG4qFA7jIXiwhLbXYyUKAfF0BSwCg46JXxma6jiKft27aeM5Fnpj1q9Pd/LDOknsP/907tSpADB2CLMPQNoxExQTBCD0MLUPlQwxUOHTr4OtMWsSQwjwjzEJI+AgbpgECSmL0IiYPIIphSAIjxVJu+FmmIeDMYRYOJhPgJGCMBmYB4EpgSAIgoBNEhpw4Ak7jJYAjTP0bAkOG4Dzjj+kISMEUfaki+/1hnhVxgrX//fsv+iBgajjmG8RwZrYgRjCClGBKOgYxwnZii/hmhECgY3z/+3LETgNPqHzuL3spQe2PnYXvYSgNZheg4GK8BOYSgNJhJCIGCQUAYCYMpgyBvmFccYamYOZgDBbhA8RMD4YKYFxgfgWkQDqJCMsFmAUAWrC2VlqYMsCswKppandmgl6WiSMtrfH8prP+5f2anP5//TUwVAaDD0CMMJweQwjQ9jAPBtMvkZk1ysPTdxSzMVkN4xXBYjFLFDHhJTC/BeMYkdUweAJTDKDOMWMc020wDDGGBYMJ8NgweQSUEBgTAamA6AqWRDACBYC0OAebm7ZaFbzgraK/MkcnCWwIl8pvUlUkoMovLcua7lE6L9/rGzQgwLhcTGACZMPoSwEAXmNoDKY/QtJpKfGH4mMuYdw4piNgkGMMBmsa8mOQmmd0OmT6tmD7PASyzt60jOIOzEgHjGAnzKYTTBEOwP/7cMRkA0/EfOgPewlJ4Y4che7hKaAxg2AZECwqApaCgaQLAE8CM5bM3BjTW4arsXJTj45+WRmmvYyigzx3qryX6TVVMAZAtjBIATMwaQB5MB7CmzBlwMgwVcG0MIsQsjIeQ9QwpA7zFxFcMJcBgw8QODBTBGMGoi4w5wlzDcDdMNgHQ06iITGJC2MCcAowBgYDBBAkMe3O4bQOeswgMSROo+8Rd52mMDQuRvhHbcWbq+dqhxm+WrEsAq7n7PIBgBhcmCsB8YaRRphEgWGMiEuYCojRn886GkoJEZ8l4ZoCQa8EmZokiYXg4ZrmwFx5MBQpMvnYP9XXMFCJMVQjMDCRDhKB4o/AEVAwQEGjoC+0AJZ9Whn4OGBTTfNq/EYmmFvf8vuV+3QKIrtLdaoABVmL0GMYzAsRkaD/+3LEeoJPGGLmD/tHCb2MHNnu5ODaGIuDSY9As5uSpwH1AV+BmHjCfE2M2ZQgyTyBgADSYxJWJiCCQmNgEEYgY6hjqo8GEoD2YAYNRg4BtGA4BKdKeCuwsPZ8ieX/WBLiIPqfGQCyVPWoTCI7C4S92FBjSfjcv48++FWulxdwaYAgAdGBYA0Bg+QY+YPOEsGBOAxpggAd6YPSpJmSmAyRgUoBYYH6ATmIKAeYeQmBhABYmVMFaYfQDJiiAxmLsPIZoiwZj+hhiEAwwIASxgA9WQwHgGFBEbEQCsAxhiKy5VXNhEKUAbzyCVU0AxqeszFypzeV+1lUxp/t1eoAQGKQAAwLgljEMBsMhsagwog9DDKAXBAThoRXkmn2R+YLwbhiKDKGPmKUYbAsZgeBOGLuPAYH4JZgdClGJv/7cMSYg87UbNwPe0cJ7o4bAf9hKeN4bVoJ5gtARGA+BwYAYGRg2gYGA2B4VAGwMA4UAByVWFyXtL+xAOqqsAlPplTVneeFaleIT1bDDLDWe/ufoMFUFgwDwxTAlClMAcW8xICNzCmCZM3pz86SyWjJYgzJQNjRiDTAoADJ0kzRIwTIIsTSAdzETNTQ7cjJADDNwLzDUJjAcIFTgLraA5zbN+2zTmVJjNTVmguE/uNS6XNBnPx3YuXbOG96rEXWOs//1f3p///7v0P6qgC4AFgSzBcDvMO8TIeJiBwPBgXhhGCO5QbAYRxi0J5ngVxhyaJkMDhh2HBieeIWGQzlCgwaOM/SmMz1A8xgDMAhMYWBSNZLRLxsK9a64KlrDKr0srbaUz+FmWtJbXH9739l1bm1ffH7f3JV3fv/+3LEsQBPmHDbL3sJQd4N2oHu4OD///X///fpIBBgLAWGCIHaYZgK5g5ATmCSC0YeIZBjkq5GU6LUZykMTGUYWjMYijEYIhcYFhIYNgSZDhKZBPMcfjuNBEUEEAhFUZJwSdMl9JaOKz5DjqhvcvHsVxjMbjCAqV6+9lyLbLv3a0X6ESHnjmkrTgX6ewW628bWpy6aAAAEIBKAAYVGgQJzEA7MHBAeERhQBG6YsEF4lDMeEoCAUYKgI6ZVAYEguZjC2ZGtMcWpghOAQLKNr1LwVPu2Wuurc61Zm1tOXWe/o1tDZJ5cXoLq47k/vbkMSqQ57UHqbUISVThclJqqsAa1V3dqUsXjENcTVSBUCQHmLDZKQCFtO+lwC+DVGKFZhA8Ck5ACX2THBAR54Dl4c+jQuNtZdZ7rPuOGX//7cMTJAk6AYtSvdwcB3graIe684Jd3Kc5TLcMqa1j+V2z++ZfljKYdvVqa/VlNNTWpkJR7VjzOVVd5NBQlGc8z5NIkUcNIozLbzkcqq84/8kUcf1PnK74dLEkq30DAFGtNIonJMclvNIy5wMFJGkUZk4lppFE4ldVr+qreaiclZEjO/scSJEtxTEFNRTMuOTguM6qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqCQACQKKEgQswmgpKTiyiyizTjSizDzDy2eLzc/ypo0osoCEihIoDEA5BDcqWco0FBgUUBgQsQLAzjSizDzDy2drzcqpo0ov/+3LE5QJOoF7PjnWHApQz1oW8mbkoso404so8w+GdnZ4tv//+7VNSUWUWUKEihIELECxAoSBFmHxcNebNGlFmnCRQkCFiBYkUJFAYgWIFgZRZRZh5h9VVVUUJppI1VUxBTUUzLjk4LjNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7cMS2A9IFejpDGM3IAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVU=",soundByteArray$5=base64SoundToByteArray(phetAudioContext$1,soundURI$5),unlock$5=asyncLoader.createLock(soundURI$5),wrappedAudioBuffer$5=new WrappedAudioBuffer;let unlocked$5=!1;const safeUnlock$5=()=>{unlocked$5||(unlock$5(),unlocked$5=!0)},onDecodeSuccess$5=o=>{wrappedAudioBuffer$5.audioBufferProperty.value===null&&(wrappedAudioBuffer$5.audioBufferProperty.set(o),safeUnlock$5())},onDecodeError$5=o=>{console.warn("decode of audio data failed, using stubbed sound, error: "+o),wrappedAudioBuffer$5.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$5()},decodePromise$5=phetAudioContext$1.decodeAudioData(soundByteArray$5.buffer,onDecodeSuccess$5,onDecodeError$5);decodePromise$5&&decodePromise$5.then(o=>{wrappedAudioBuffer$5.audioBufferProperty.value===null&&(wrappedAudioBuffer$5.audioBufferProperty.set(o),safeUnlock$5())}).catch(o=>{console.warn("promise rejection caught for audio decode, error = "+o),safeUnlock$5()});const checkboxCheckedSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$5,{soundClipOptions:{initialOutputLevel:.7},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("checkboxCheckedSoundPlayer",checkboxCheckedSoundPlayer);const soundURI$4="data:audio/mpeg;base64,//swxAAAB3BPLHWkgAEQCy03MPADAYAEAMYCIAZnV5vYJv2ZoxqgRhBhkBBkRJhwZa9g7/tbYe1+jC4beogQMZ4Z5zn7mgQQdxOH//////6SQAIzbNJJdtgAAAAAAHjcV2B1EBJLBB4wV9rCWp5eq0EHE43FpgLhkjdNEqGhFqhSQlQ4TwqZdZ7fN/Hm6YKiu/33NoUAACApAAAI//syxAOCSGxzQ123gDkDjCZJvLDmDQ0HhMRgBVEjBws2OIM9Cky1VU0REAhgK47nqWwHAkIYcB7ePHvXeo2cV1nG4uL6rjXjzXt951bbjQs/hQuyxEeFQaEGUgRohuYvQkhIfrBnlFyQoUla/qMye4qGxUqjhxTJIFPCOfamTewcOH2SkYCFVa21OLZrySygx+bV4B1xgBhA1DB0Bf/7MsQFAAfISyw1x4AxL4ssNzGAAigYRigH0YoI18mGQKOgZ+FY0UWnyRsLJgZYCShStOpdQYKdeV5/q9jbIDYPkLAYtiTETvrZLIYEb2u2uogAAAAAAhkChusjjbfkXleOGpiySKjhjUIlMla3JEsHQqgBs2ns50DIPtDIgjJE46JnUPRPPPOG5G8/yKxQADAZFTP1KgAAIX0AGkv/+zLEA4IIRJ9DPaUAMQuN5o2tmYqinck4ucZbhxEBHFls3WFfhr6dyvz3zgxEmEABChAREwQIwJRfc1jx6QHFWNNqQkrG5wvNNbdf1b//kxUACACHIGAlgmUgpccbebl+BkKCZXQyCAwpKkwRUzEk7AIAwgTBahUNNHisAuFoYmM12rXbbUJ2v5Cwa++fDf///+mgDERUoJgUemjg//swxAUDSExLJi3phxEQCmQBrbx0BkCOdSyG/xxiJyFwYUOAZiABRh0Zh64k8Pj7NAJTjWFStFgyvxBK5IhTLDstCt9Y/SAqpLqiYU1gRqYoIfCMbtwYtoG77YMaQdBGoPhoQOPIxjIsCrswBnOHTzqNAI9TIQEiAQc0oSX9JssKWBt5O9HJA8fEWBHxeXEQzXUAKsQAXwMjEM3O//syxAUCSDxVLM1lJzEbCWPFrmxBNqHM4RC+k5ZUzwUcEaSmKZZCdwJRBNZkJiwDdFN36YdSqdqUT6pYDZ5ScxSDVfZPSpL8M//b6NxDNtjDhTpxDmMDKQMMw1k08tNDTxrGMKLQxRDCMevDKlACBZi1WYsoiEOBwEwdI9e0vdBptNKZfgzJsVH29qtOpUET8k9v4mAAAExTEHgUKP/7MsQEggfQUyJNc0QA2AklmY2YpukjMG6N4KPFG4xmOjdBnIQqBgcbgGQGmcNGdaHtBQplqcsNdnbkroa0zXiUXxyr9wz/WF9usagQAkSHDHulGU3DjA44xIgQwADplHVAGUl7G/MbPAcXSMAgRGUSoN9OUp+zGuLf///V3//+ugKcCSTofFaj5oNcoyUgyJfAIDMwsQBGeEBQiGf/+zLEDgJHUD8UDOksQN6F39wxsAA60sBDGHr5bR5oZBEMkscKhnEIJPCh6j//////+n6AmBgKjhFZNEIgmCyGD2UQjAVEweC2peqxVyOIpL/WDXZ7cNcFTtQdJCEFQVGLPFgaUHJ6dhojDlVttOCJU4BB0qsXplV/tncqptv/p//+n//6abf////9QTTTTRVV9UEJK0kIixWmqoc///swxBiDxvgCi4CEYAgAADSAAAAE/1TTVEWK6UxBTUUzLjk5LjNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",soundByteArray$4=base64SoundToByteArray(phetAudioContext$1,soundURI$4),unlock$4=asyncLoader.createLock(soundURI$4),wrappedAudioBuffer$4=new WrappedAudioBuffer;let unlocked$4=!1;const safeUnlock$4=()=>{unlocked$4||(unlock$4(),unlocked$4=!0)},onDecodeSuccess$4=o=>{wrappedAudioBuffer$4.audioBufferProperty.value===null&&(wrappedAudioBuffer$4.audioBufferProperty.set(o),safeUnlock$4())},onDecodeError$4=o=>{console.warn("decode of audio data failed, using stubbed sound, error: "+o),wrappedAudioBuffer$4.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$4()},decodePromise$4=phetAudioContext$1.decodeAudioData(soundByteArray$4.buffer,onDecodeSuccess$4,onDecodeError$4);decodePromise$4&&decodePromise$4.then(o=>{wrappedAudioBuffer$4.audioBufferProperty.value===null&&(wrappedAudioBuffer$4.audioBufferProperty.set(o),safeUnlock$4())}).catch(o=>{console.warn("promise rejection caught for audio decode, error = "+o),safeUnlock$4()});const checkboxUncheckedSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$4,{soundClipOptions:{initialOutputLevel:.7},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("checkboxUncheckedSoundPlayer",checkboxUncheckedSoundPlayer);const BOOLEAN_VALIDATOR={valueType:"boolean"},SHAPE_MATRIX=m3(.025,0,0,0,-.025,0,0,0,1),uncheckedShape=checkEmptySolidShape.transformed(SHAPE_MATRIX),checkedShape=checkSquareOSolidShape.transformed(SHAPE_MATRIX);class Checkbox extends WidthSizable(Voicing(Node$2)){constructor(e,t,n){var m,O;const r=optionize()({spacing:5,boxWidth:21,checkboxColor:"black",checkboxColorBackground:"white",touchAreaXDilation:0,touchAreaYDilation:0,mouseAreaXDilation:0,mouseAreaYDilation:0,checkedSoundPlayer:checkboxCheckedSoundPlayer,uncheckedSoundPlayer:checkboxUncheckedSoundPlayer,phetioLinkProperty:!0,cursor:"pointer",disabledOpacity:SceneryConstants.DISABLED_OPACITY,tandem:Tandem.REQUIRED,tandemNameSuffix:"Checkbox",phetioEventType:EventType.USER,visiblePropertyOptions:{phetioFeatured:!0},phetioEnabledPropertyInstrumented:!0,phetioReadOnly:PhetioObject.DEFAULT_OPTIONS.phetioReadOnly,phetioFeatured:!0,tagName:"input",inputType:"checkbox",appendDescription:!0,voicingCheckedObjectResponse:null,voicingUncheckedObjectResponse:null,checkedContextResponse:null,uncheckedContextResponse:null,voiceNameResponseOnSelection:!0},n);super(),this._isMouseAreaCustomized=!1,this._isTouchAreaCustomized=!1,this._isSettingAreas=!1;const s=new PhetioAction$1(()=>{e.value=!e.value,validate(e.value,BOOLEAN_VALIDATOR),e.value?(r.checkedSoundPlayer.play(),r.checkedContextResponse&&this.alertDescriptionUtterance(r.checkedContextResponse),this.voicingSpeakResponse({nameResponse:r.voiceNameResponseOnSelection?this.voicingNameResponse:null,objectResponse:Utterance.alertableToText(r.voicingCheckedObjectResponse),contextResponse:Utterance.alertableToText(r.checkedContextResponse)})):(r.uncheckedSoundPlayer.play(),r.uncheckedContextResponse&&this.alertDescriptionUtterance(r.uncheckedContextResponse),this.voicingSpeakResponse({nameResponse:r.voiceNameResponseOnSelection?this.voicingNameResponse:null,objectResponse:Utterance.alertableToText(r.voicingUncheckedObjectResponse),contextResponse:Utterance.alertableToText(r.uncheckedContextResponse)}))},{parameters:[],tandem:r.tandem.createTandem("toggleAction"),phetioDocumentation:"Emits when user input causes the checkbox to toggle, emitting a single arg: the new boolean value of the checkbox state.",phetioReadOnly:!0,phetioEventType:EventType.USER});this.backgroundNode=new Rectangle(0,-r.boxWidth,r.boxWidth*.95,r.boxWidth*.95,r.boxWidth*.2,r.boxWidth*.2,{fill:r.checkboxColorBackground}),this.uncheckedNode=new Path(uncheckedShape,{fill:r.checkboxColor});const a=r.boxWidth/this.uncheckedNode.width;this.uncheckedNode.scale(a),this.checkedNode=new Path(checkedShape,{scale:a,fill:r.checkboxColor});const l=new Node$2({children:[this.backgroundNode,this.checkedNode,this.uncheckedNode]}),d=new Rectangle({});this.children=[l,t,d],this.constraint=new CheckboxConstraint(this,l,this.checkedNode,t,d,r),this.constraint.updateLayout(),t.pickable=!1,t.pdomVisible=!1;const c=new FireListener({fire:()=>s.execute(),tandem:r.tandem.createTandem("fireListener")});this.addInputListener(c);const y=D=>{this.checkedNode.visible=D,this.uncheckedNode.visible=!D,this.pdomChecked=D};e.link(y),this.mutate(r),this.setExcludeLabelSiblingFromInput(),r.phetioLinkProperty&&this.addLinkedElement(e,{tandemName:"property"}),assert&&((O=(m=phet==null?void 0:phet.chipper)==null?void 0:m.queryParameters)!=null&&O.binder)&&InstanceRegistry.registerDataURL("sun","Checkbox",this),this.disposeCheckbox=()=>{d.dispose(),this.backgroundNode.dispose(),this.uncheckedNode.dispose(),this.checkedNode.dispose(),l.dispose(),c.dispose(),e.hasListener(y)&&e.unlink(y),s.dispose()}}dispose(){this.constraint.dispose(),this.disposeCheckbox(),super.dispose()}setCheckboxColorBackground(e){this.backgroundNode.fill=e}set checkboxColorBackground(e){this.setCheckboxColorBackground(e)}get checkboxColorBackground(){return this.getCheckboxColorBackground()}getCheckboxColorBackground(){return this.backgroundNode.fill}setCheckboxColor(e){this.checkedNode.fill=this.uncheckedNode.fill=e}set checkboxColor(e){this.setCheckboxColor(e)}get checkboxColor(){return this.getCheckboxColor()}getCheckboxColor(){return this.checkedNode.fill}setMouseArea(e){return this._isSettingAreas||(this._isMouseAreaCustomized=!0),super.setMouseArea(e)}setTouchArea(e){return this._isSettingAreas||(this._isTouchAreaCustomized=!0),super.setTouchArea(e)}}class CheckboxConstraint extends LayoutConstraint{constructor(e,t,n,r,s,a){super(e),this.checkbox=e,this.checkboxNode=t,this.checkedNode=n,this.content=r,this.rectangle=s,this.options=a,this.checkbox.localPreferredWidthProperty.lazyLink(this._updateLayoutListener),this.addNode(r)}layout(){super.layout();const e=this.createLayoutProxy(this.content),t=e.minimumWidth,n=this.checkedNode.right-this.checkboxNode.left,r=n+this.options.spacing+t,s=Math.max(r,this.checkbox.localPreferredWidth||0);isWidthSizable(this.content)&&this.checkbox.localPreferredWidth!==null&&(e.preferredWidth=s-n-this.options.spacing),e.left=this.checkedNode.right+this.options.spacing,e.centerY=this.checkedNode.centerY,this.rectangle.rectBounds=this.checkboxNode.bounds.union(e.bounds).withMaxX(Math.max(this.checkboxNode.left+s,e.right)),this.checkbox._isSettingAreas=!0,this.checkbox._isTouchAreaCustomized||(this.checkbox.touchArea=this.checkbox.localBounds.dilatedXY(this.options.touchAreaXDilation,this.options.touchAreaYDilation)),this.checkbox._isMouseAreaCustomized||(this.checkbox.mouseArea=this.checkbox.localBounds.dilatedXY(this.options.mouseAreaXDilation,this.options.mouseAreaYDilation)),this.checkbox._isSettingAreas=!1,e.dispose(),this.checkbox.localMinimumWidth=r}dispose(){this.checkbox.localPreferredWidthProperty.unlink(this._updateLayoutListener),super.dispose()}}sun.register("Checkbox",Checkbox);class ClosestDragForwardingListener{constructor(e,t){this.touchThreshold=e,this.mouseThreshold=t,this.items=[]}addDraggableItem(e){this.items.push(e)}removeDraggableItem(e){const t=_.indexOf(this.items,e);assert&&assert(t>=0),this.items.splice(t,1)}down(e){if(e.target===e.currentTarget){let t=0;if(e.pointer.isTouchLike()&&(t=this.touchThreshold),e.pointer instanceof Mouse&&(t=this.mouseThreshold),t){let n=null,r=Number.POSITIVE_INFINITY;const s=e.pointer.point,a=this.items.length;for(let l=0;l<a;l++){const d=this.items[l],c=d.computeDistance(s);c<r&&(r=c,n=d)}n&&r<t&&n.startDrag(e)}}}}sun.register("ClosestDragForwardingListener",ClosestDragForwardingListener);const soundURI$3="data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA//tAwAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAAJAAAIpwB1dXV1dXV1dXV1dZmZmZmZmZmZmZmZt7e3t7e3t7e3t7fDw8PDw8PDw8PDw8/Pz8/Pz8/Pz8/P29vb29vb29vb29vn5+fn5+fn5+fn5/Pz8/Pz8/Pz8/Pz//////////////8AAAAATGF2YzU4LjU0AAAAAAAAAAAAAAAAJAaRAAAAAAAACKfAKvQnAAAAAAD/+9DEAAAOsE9AdZGAK8QbJPc/sEAAG+3c2nDeiOKI2kELTFZOe88bTlVNYoyijKIMQAuIoIxCHLCJXfiAAGBu7u7iwAAQAAAAPH/+hH//+Hh63//h///9Dw//wAHfmHh/+AAH/HDw//AAB2YeHh48AAAAARh4eHjwAAAABGHh4ePAAAAAEYeHh72AAAAAAgIGjKTaAgAAADF5zj41poBnMb3YuDrZ4lswWUT3NCZKkDBJA0IwPgKfMOfCCjBCwXEwfcFTMAZAMjBZAUkwToD3MJ5BHTAtQIwwN8BSIAB8wl6OBagd3mygBhQ4n2aSoGCCpjg+gjBRXLFBUc1FzFBNYIwECT6EgFQMwcYTWZjN8zetdqYr7OMFgASAmvSFbsCMnsyt5YaiLuxmtTc/Ln/zm//y5y5WusNhprzDsst/vn/////VpZTWppVVpaVWt/g0FQVEQVDSu75URBUFREDIKiK5SrP+FQVFAqCpYKgqIgqCoiCoBn+ANTNR9Qnf9QDAyCTMLwPkxiiMzLantMFUFgwBQFzBSBZMAwB1N9D5KowGweiYA8hABLigQAMtuqACgChABghQCoWEwjHHYoeynK7nyOIUWogYdzEPeXRdf/93EzSTPHHzdMvNVURcJrMu1Qn/yNHvOCiTPVcKZ4Jd9aABgZgAGFwCOYpoYBuSTunDGJWAjEDwXoedDHUcykRMOEDRvUyRGWss9DxDsKiq+hoGL/NJcyHaV/WqS10Lj8m4fUgtKwEoz9xzkxTEUiPXSxWZg8dR1MVNFsKnGcb1jVESp/JeehYdKA2B2gsgofDp8OxYwIUg8P0rqp1pfay9SxSMKU/20LvtQgAGPd/rRAMCcC4wNgWTA1E4MctvY19w9jCOB7NS+MOCMKOeAEiDu1gUDLJKSXk1ouM2Jk0RipZHIGzYkvmJZaBsU3Gzw4XvWPBcfkXD2A4lzobX9zU1HmDpxrnji+QYywuly9fWuBN5BIJLLDAbYIBQ4kHywjcRUZY8cHiRAigzC9VahyUolPqupX0+gABK//76tAAEIMMQgEzERTRNAOyvIyKAxHYtOHQKqAwZoGNMV2jipUhKanaYEuqXNAKDJEiQwRbUxSgD//twxOOCDkjjLH3kACIxlCNd7bC8SRNKXVYFRdFKV+4NWSKnVBQOlXSQdGLOhMNRFv8e7///9CeGqkxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqkxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqTEFNRTMuMTAwqqqqqqqqqqqqqqqqqv/7YMT2ABGQoRtPaYVhfw2i9cwkrKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqkxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqTEFNRTMuMTAwqqqqqv/7EMTWA8AAAf4AAAAgAAA0gAAABKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//sQxNYDwAABpAAAACAAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+xDE1gPAAAGkAAAAIAAANIAAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqv/7EMTWA8AAAaQAAAAgAAA0gAAABKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//sQxNYDwAABpAAAACAAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+xDE1gPAAAGkAAAAIAAANIAAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqg==",soundByteArray$3=base64SoundToByteArray(phetAudioContext$1,soundURI$3),unlock$3=asyncLoader.createLock(soundURI$3),wrappedAudioBuffer$3=new WrappedAudioBuffer;let unlocked$3=!1;const safeUnlock$3=()=>{unlocked$3||(unlock$3(),unlocked$3=!0)},onDecodeSuccess$3=o=>{wrappedAudioBuffer$3.audioBufferProperty.value===null&&(wrappedAudioBuffer$3.audioBufferProperty.set(o),safeUnlock$3())},onDecodeError$3=o=>{console.warn("decode of audio data failed, using stubbed sound, error: "+o),wrappedAudioBuffer$3.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$3()},decodePromise$3=phetAudioContext$1.decodeAudioData(soundByteArray$3.buffer,onDecodeSuccess$3,onDecodeError$3);decodePromise$3&&decodePromise$3.then(o=>{wrappedAudioBuffer$3.audioBufferProperty.value===null&&(wrappedAudioBuffer$3.audioBufferProperty.set(o),safeUnlock$3())}).catch(o=>{console.warn("promise rejection caught for audio decode, error = "+o),safeUnlock$3()});const soundURI$2="data:audio/mpeg;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAAEAAAE/QCbm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5vBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHB4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4P////////////////////////////////8AAAAUTEFNRTMuMTAwBJgAAAAAAAAAABUgJAXmQQABpAAABP2CPnqIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//ugxAAAAZABXJQAACjSBy/7MvJBlbA24AeHxx+Z+DJ48Acl/O7e/c+wAAAAAAAEggodS1KhDIMHY9Flj8OAaLhIDnqje9htgSxoj0q3Fksjnr007hUgBFiJkAAAAJRul9HpGarkErUNUSqvEO5RRnr0CYblhVBIAACITTDJN3xrY6pMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpcJoKAAAAAArSgBAzM3OFUFV0GH4AAagOAQ5P8ZoVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//sgxNoAw8QpV9zxgCg6A+w4kAkEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7EMTlgMI4H1/EgQggMYHqUBQYBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//sQxNYDwAAB/gAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVU=",soundByteArray$2=base64SoundToByteArray(phetAudioContext$1,soundURI$2),unlock$2=asyncLoader.createLock(soundURI$2),wrappedAudioBuffer$2=new WrappedAudioBuffer;let unlocked$2=!1;const safeUnlock$2=()=>{unlocked$2||(unlock$2(),unlocked$2=!0)},onDecodeSuccess$2=o=>{wrappedAudioBuffer$2.audioBufferProperty.value===null&&(wrappedAudioBuffer$2.audioBufferProperty.set(o),safeUnlock$2())},onDecodeError$2=o=>{console.warn("decode of audio data failed, using stubbed sound, error: "+o),wrappedAudioBuffer$2.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$2()},decodePromise$2=phetAudioContext$1.decodeAudioData(soundByteArray$2.buffer,onDecodeSuccess$2,onDecodeError$2);decodePromise$2&&decodePromise$2.then(o=>{wrappedAudioBuffer$2.audioBufferProperty.value===null&&(wrappedAudioBuffer$2.audioBufferProperty.set(o),safeUnlock$2())}).catch(o=>{console.warn("promise rejection caught for audio decode, error = "+o),safeUnlock$2()});const generalBoundaryBoopSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$3,{soundClipOptions:{initialOutputLevel:.2},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("generalBoundaryBoopSoundPlayer",generalBoundaryBoopSoundPlayer);const generalSoftClickSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$2,{soundClipOptions:{initialOutputLevel:.2},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("generalSoftClickSoundPlayer",generalSoftClickSoundPlayer);const DEFAULT_NUMBER_OF_MIDDLE_THRESHOLDS=5,DEFAULT_MIN_SOUND_PLAYER=new SoundClipPlayer(wrappedAudioBuffer$3,{soundClipOptions:{initialOutputLevel:.2,initialPlaybackRate:1/Math.pow(2,1/6)},soundManagerOptions:{categoryName:"user-interface"}}),DEFAULT_MIDDLE_MOVING_DOWN_SOUND_PLAYER=new SoundClipPlayer(wrappedAudioBuffer$2,{soundClipOptions:{initialOutputLevel:.2,initialPlaybackRate:1/Math.pow(2,1/6)},soundManagerOptions:{categoryName:"user-interface"}}),DEFAULT_VALUE_CONSTRAINT=o=>DotUtils.roundToInterval(o,1e-9),NO_PLAYBACK_RATE_CHANGE=()=>1,STUB_SOUND_PLAYER_FUNCTION=()=>{assert&&assert(!1,"Code error: This is a stubbed function and should never be invoked.")},Ca=class Ca extends Disposable{constructor(e,t){const n=optionize()({middleMovingUpSoundPlayer:generalSoftClickSoundPlayer,middleMovingDownSoundPlayer:DEFAULT_MIDDLE_MOVING_DOWN_SOUND_PLAYER,middleMovingUpPlaybackRateMapper:NO_PLAYBACK_RATE_CHANGE,middleMovingDownPlaybackRateMapper:NO_PLAYBACK_RATE_CHANGE,numberOfMiddleThresholds:null,interThresholdDelta:null,constrainValue:DEFAULT_VALUE_CONSTRAINT,minSoundPlayer:DEFAULT_MIN_SOUND_PLAYER,maxSoundPlayer:generalBoundaryBoopSoundPlayer,minimumInterMiddleSoundTime:.035},t);assert&&assert(n.minimumInterMiddleSoundTime>=0&&n.minimumInterMiddleSoundTime<1,`unreasonable value for minimumInterMiddleSoundTime: ${n.minimumInterMiddleSoundTime}`),assert&&assert(n.numberOfMiddleThresholds===null||n.interThresholdDelta===null,"cannot specify both the number of middle thresholds and the inter-threshold delta"),assert&&assert(n.numberOfMiddleThresholds===null||Number.isInteger(n.numberOfMiddleThresholds),"numberOfMiddleThresholds must be an integer if specified"),assert&&assert(n.middleMovingUpPlaybackRateMapper===NO_PLAYBACK_RATE_CHANGE||n.middleMovingUpSoundPlayer instanceof SoundClip,"a sound player that supports playback rate changes is required when a playback rate mapper is used"),assert&&assert(n.middleMovingDownPlaybackRateMapper===NO_PLAYBACK_RATE_CHANGE||n.middleMovingDownSoundPlayer instanceof SoundClip,"a sound player that supports playback rate changes is required when a playback rate mapper is used"),n.numberOfMiddleThresholds===null&&n.interThresholdDelta===null&&(n.numberOfMiddleThresholds=DEFAULT_NUMBER_OF_MIDDLE_THRESHOLDS),super(n),this.interThresholdDistance=DEFAULT_NUMBER_OF_MIDDLE_THRESHOLDS,this.valueRangeProperty=e instanceof Range?new TinyProperty(e):e,this.middleMovingUpSoundPlayer=n.middleMovingUpSoundPlayer,this.middleMovingDownSoundPlayer=n.middleMovingDownSoundPlayer,this.middleMovingUpPlaybackRateMapper=n.middleMovingUpPlaybackRateMapper,this.middleMovingDownPlaybackRateMapper=n.middleMovingDownPlaybackRateMapper,this.minSoundPlayer=n.minSoundPlayer,this.maxSoundPlayer=n.maxSoundPlayer,this.minimumInterMiddleSoundTime=n.minimumInterMiddleSoundTime,this.timeOfMostRecentMiddleSound=0,this.constrainValue=n.constrainValue;const r=s=>{n.numberOfMiddleThresholds!==null?this.interThresholdDistance=s.getLength()/(n.numberOfMiddleThresholds+1):n.interThresholdDelta!==null?this.interThresholdDistance=n.interThresholdDelta:(assert&&assert(!1,"should never get here, it is a logic error if we do"),this.interThresholdDistance=s.getLength()/2)};this.valueRangeProperty.link(r),this.disposeEmitter.addListener(()=>{this.valueRangeProperty.unlink(r)})}playSoundIfThresholdReached(e,t){if(e!==t){const n=this.constrainValue(e),r=this.constrainValue(t),s=this.getSurroundingThresholds(r),a=this.getSurroundingThresholds(n),l=s.length===1&&a.length===1&&Math.abs(s[0]-a[0])>this.interThresholdDistance||s.length===1&&a.length===2&&s[0]!==a[0]&&s[0]!==a[1]||s.length===2&&a.length===1&&a[0]!==s[0]&&a[0]!==s[1]||s.length===2&&a.length===2&&a[0]!==s[0],d=a.length===1&&(s.length===2||s[0]!==a[0]);(l||d||n===this.valueRangeProperty.value.min||n===this.valueRangeProperty.value.max)&&this.playSoundForValueChange(e,t)}}playSoundForValueChange(e,t){const n=this.constrainValue(e),r=this.constrainValue(t);if(n!==r||t!==e&&(e===this.valueRangeProperty.value.min||e===this.valueRangeProperty.value.max))if(e===this.valueRangeProperty.value.min&&this.minSoundPlayer!==Ca.USE_MIDDLE_SOUND)this.minSoundPlayer.play();else if(e===this.valueRangeProperty.value.max&&this.maxSoundPlayer!==Ca.USE_MIDDLE_SOUND)this.maxSoundPlayer.play();else{const s=phetAudioContext$1.currentTime;if(s-this.timeOfMostRecentMiddleSound>this.minimumInterMiddleSoundTime){let a,l;n>r?(a=this.middleMovingUpPlaybackRateMapper,l=this.middleMovingUpSoundPlayer):(a=this.middleMovingUpPlaybackRateMapper,l=this.middleMovingDownSoundPlayer),a!==NO_PLAYBACK_RATE_CHANGE&&l.setPlaybackRate(a(e)),l.play(),this.timeOfMostRecentMiddleSound=s}}}getSurroundingThresholds(e){const n=Math.floor(DotUtils.roundToInterval((e-this.valueRangeProperty.value.min)/this.interThresholdDistance,1e-7)),r=DotUtils.roundToInterval(n*this.interThresholdDistance+this.valueRangeProperty.value.min,1e-7),s=[r];if(r!==e){const a=Math.min(DotUtils.roundToInterval(r+this.interThresholdDistance,1e-7),this.valueRangeProperty.value.max);a>r&&s.push(a)}return s}};Ca.NO_SOUND=new Ca(new Range(0,1),{middleMovingUpSoundPlayer:nullSoundPlayer,minSoundPlayer:nullSoundPlayer,maxSoundPlayer:nullSoundPlayer}),Ca.USE_MIDDLE_SOUND={play:STUB_SOUND_PLAYER_FUNCTION,stop:STUB_SOUND_PLAYER_FUNCTION};let ValueChangeSoundPlayer=Ca;tambo.register("ValueChangeSoundPlayer",ValueChangeSoundPlayer);const DEFAULT_TAG_NAME="input",toString$2=o=>`${o}`,DEFAULT_VOICING_ON_END_RESPONSE_OPTIONS={withNameResponse:!1,withObjectResponse:!0,onlyOnValueChange:!0},ACCESSIBLE_VALUE_HANDLER_OPTIONS=["startInput","endInput","onInput","constrainValue","keyboardStep","shiftKeyboardStep","pageKeyboardStep","ariaOrientation","panTargetNode","roundToStepSize","a11yMapPDOMValue","a11yMapValue","a11yRepeatEqualValueText","a11yCreateAriaValueText","a11yCreateContextResponseAlert","contextResponsePerValueChangeDelay","contextResponseMaxDelay","a11yDependencies","voicingOnEndResponseOptions"],AccessibleValueHandler=(o,e)=>{const t=DelayedMutate$1("AccessibleValueHandler",ACCESSIBLE_VALUE_HANDLER_OPTIONS,class extends Voicing(o){constructor(...r){const s=r[e];assert&&assert(s,"providedOptions has required options"),assert&&assert(s.enabledRangeProperty,"enabledRangeProperty is a required option"),assert&&assert(s.valueProperty,"valueProperty is a required option"),assert&&s&&assert(!s.hasOwnProperty("tagName")||s.tagName===null,"AccessibleValueHandler sets its own tagName. Only provide tagName to clear accessible content from the PDOM"),assert&&s&&assert(!s.hasOwnProperty("inputType"),"AccessibleValueHandler sets its own inputType."),assert&&s&&s.roundToStepSize&&assert(s.keyboardStep,"rounding to keyboardStep, define appropriate keyboardStep to round to"),r[e]=optionize()({tagName:DEFAULT_TAG_NAME,inputType:"range"},s),super(...r),this._startInput=_.noop,this._onInput=_.noop,this._endInput=_.noop,this._constrainValue=_.identity,this._a11yMapValue=_.identity,this._panTargetNode=null,this._ariaOrientation=Orientation.HORIZONTAL,this._shiftKey=!1,this._a11yDependencies=[],this._oldValue=null,this._a11yCreateContextResponseAlert=null,this._contextResponseUtterance=new Utterance,this._timesValueTextChangedBeforeAlerting=0,this._contextResponsePerValueChangeDelay=700,this._contextResponseMaxDelay=1500,this._a11yInputHandled=!1,this._blockInput=!1,this._roundToStepSize=!1,this._rangeKeysDown={},this._a11yMapPDOMValue=_.identity,this._a11yCreateAriaValueText=toString$2,this._dependenciesMultilink=null,this._a11yRepeatEqualValueText=!0,this._timesChangedBeforeAlerting=0,this._voicingOnEndResponseOptions=DEFAULT_VOICING_ON_END_RESPONSE_OPTIONS,this._pdomPointer=null,assertHasProperties(this,["inputValue","setPDOMAttribute"]);const a=s.valueProperty,l=s.enabledRangeProperty;s.reverseAlternativeInput?this._valueProperty=new DynamicProperty(new Property(a),{bidirectional:!0,map:y=>l.value.max-y,inverseMap:y=>l.value.max-y}):this._valueProperty=a,this._enabledRangeProperty=l,this._a11yValueTextUpdateListener=this.invalidateAriaValueText.bind(this),this.keyboardStep=(l.get().max-l.get().min)/20,this.shiftKeyboardStep=(l.get().max-l.get().min)/100,this.pageKeyboardStep=(l.get().max-l.get().min)/10,this._valueOnStart=a.value,this.invalidateA11yDependencies();const d=this.invalidateEnabledRange.bind(this);this._enabledRangeProperty.link(d);const c=this.invalidateValueProperty.bind(this);this._valueProperty.link(c),this._pdomPointerListener={interrupt:()=>{this._onInteractionEnd(null)}},this._disposeAccessibleValueHandler=()=>{this._enabledRangeProperty.unlink(d),this._valueProperty.unlink(c),s.reverseAlternativeInput&&(assert&&assert(this._valueProperty instanceof DynamicProperty,"Only a DynamicProperty can be disposed, otherwise this is disposing a Property that AccessibleValueHandler does not have ownership over."),this._valueProperty.dispose()),this._dependenciesMultilink&&this._dependenciesMultilink.dispose(),this._panTargetNode=null,this._a11yDependencies=[]}}set startInput(r){this._startInput=r}get startInput(){return this._startInput}set onInput(r){this._onInput=r}get onInput(){return this._onInput}set endInput(r){this._endInput=r}get endInput(){return this._endInput}set constrainValue(r){this._constrainValue=r}get constrainValue(){return this._constrainValue}set panTargetNode(r){this._panTargetNode=r}get panTargetNode(){return this._panTargetNode}set roundToStepSize(r){this._roundToStepSize=r}get roundToStepSize(){return this._roundToStepSize}set a11yMapPDOMValue(r){this._a11yMapPDOMValue=r,this.invalidateEnabledRange(this._enabledRangeProperty.value),this.invalidateValueProperty(),this.invalidateAriaValueText()}get a11yMapPDOMValue(){return this._a11yMapPDOMValue}set a11yMapValue(r){this._a11yMapValue=r}get a11yMapValue(){return this._a11yMapValue}set a11yRepeatEqualValueText(r){this._a11yRepeatEqualValueText=r,this.invalidateAriaValueText()}get a11yRepeatEqualValueText(){return this._a11yRepeatEqualValueText}set a11yCreateAriaValueText(r){this._a11yCreateAriaValueText=r,this.invalidateAriaValueText()}get a11yCreateAriaValueText(){return this._a11yCreateAriaValueText}set a11yCreateContextResponseAlert(r){this._a11yCreateContextResponseAlert=r}get a11yCreateContextResponseAlert(){return this._a11yCreateContextResponseAlert}set contextResponsePerValueChangeDelay(r){this._contextResponsePerValueChangeDelay=r}get contextResponsePerValueChangeDelay(){return this._contextResponsePerValueChangeDelay}set contextResponseMaxDelay(r){this._contextResponseMaxDelay=r}get contextResponseMaxDelay(){return this._contextResponseMaxDelay}set voicingOnEndResponseOptions(r){this._voicingOnEndResponseOptions=r}get voicingOnEndResponseOptions(){return this._voicingOnEndResponseOptions}invalidateAriaValueText(){this._updateAriaValueText(this._oldValue),this._oldValue=this._valueProperty.value}invalidateEnabledRange(r){const s=this._getMappedValue(r.min),a=this._getMappedValue(r.max);this.setPDOMAttribute("min",s),this.setPDOMAttribute("max",a),this._updateSiblingStepAttribute()}invalidateValueProperty(){const r=this._getMappedValue();this.setPDOMAttribute("aria-valuenow",r),this.inputValue=r}invalidateA11yDependencies(){this._dependenciesMultilink&&this._dependenciesMultilink.dispose(),this._dependenciesMultilink=Multilink.multilinkAny(this._a11yDependencies.concat([this._valueProperty]),this._a11yValueTextUpdateListener)}setA11yDependencies(r){assert&&assert(!r.includes(this._valueProperty),"The value Property is already a dependency, and does not need to be added to this list"),this._a11yDependencies=r,this.invalidateA11yDependencies()}getA11yDependencies(){return this._a11yDependencies}set a11yDependencies(r){this.setA11yDependencies(r)}get a11yDependencies(){return this.getA11yDependencies()}_updateAriaValueText(r){const s=this._getMappedValue(),a=this._a11yCreateAriaValueText(s,this._valueProperty.value,r);let l=PDOMUtils$1.unwrapStringProperty(a);assert&&assert(typeof l=="string");const d=" ";this._a11yRepeatEqualValueText&&this.ariaValueText&&l===this.ariaValueText.replace(new RegExp(d,"g"),"")&&(l=this.ariaValueText+d),this.ariaValueText=l}alertContextResponse(){let r=!1;if(this._a11yCreateContextResponseAlert){const s=this._getMappedValue(),a=this._a11yCreateContextResponseAlert(s,this._valueProperty.value,this._valueOnStart);a&&(this._contextResponseUtterance.alert=a,this.forEachUtteranceQueue(l=>{r||(l.hasUtterance(this._contextResponseUtterance)?(r=!0,this._timesChangedBeforeAlerting++):this._timesChangedBeforeAlerting=1),this._contextResponseUtterance.alertStableDelay=Math.min(this._contextResponseMaxDelay,this._timesChangedBeforeAlerting*this._contextResponsePerValueChangeDelay),l.addToBack(this._contextResponseUtterance)}))}}reset(){this._a11yCreateAriaValueText.reset&&this._a11yCreateAriaValueText.reset(),this._a11yCreateContextResponseAlert&&this._a11yCreateContextResponseAlert.reset&&this._a11yCreateContextResponseAlert.reset(),this._timesChangedBeforeAlerting=0,this._updateAriaValueText(null)}_getMappedValue(r=this._valueProperty.value){return this._a11yMapPDOMValue(r)}getAccessibleValueHandlerInputListener(){return{keydown:this.handleKeyDown.bind(this),keyup:this.handleKeyUp.bind(this),input:this.handleInput.bind(this),change:this.handleChange.bind(this),blur:this.handleBlur.bind(this)}}handleKeyDown(r){const s=r.domEvent,a=KeyboardUtils.getEventCode(s);if(a&&(this._shiftKey=s.shiftKey,KeyboardUtils.isKeyEvent(s,KeyboardUtils.KEY_TAB)&&(this._blockInput=!0),this.enabledProperty.get()&&KeyboardUtils.isRangeKey(s)&&(s.preventDefault(),!s.metaKey))){r.pointer.reserveForKeyboardDrag();let l=!0;this._anyKeysDown()||this._onInteractionStart(r),this._rangeKeysDown[a]=!0;let d=this._valueProperty.get();if(KeyboardUtils.isAnyKeyEvent(s,[KeyboardUtils.KEY_END,KeyboardUtils.KEY_HOME]))a===KeyboardUtils.KEY_END?d=this._enabledRangeProperty.get().max:a===KeyboardUtils.KEY_HOME&&(d=this._enabledRangeProperty.get().min);else{let O;a===KeyboardUtils.KEY_PAGE_UP||a===KeyboardUtils.KEY_PAGE_DOWN?(O=this.pageKeyboardStep,a===KeyboardUtils.KEY_PAGE_UP?d=this._valueProperty.get()+O:a===KeyboardUtils.KEY_PAGE_DOWN&&(d=this._valueProperty.get()-O)):KeyboardUtils.isArrowKey(s)&&(O=s.shiftKey?this.shiftKeyboardStep:this.keyboardStep,l=!s.shiftKey,a===KeyboardUtils.KEY_RIGHT_ARROW||a===KeyboardUtils.KEY_UP_ARROW?d=this._valueProperty.get()+O:(a===KeyboardUtils.KEY_LEFT_ARROW||a===KeyboardUtils.KEY_DOWN_ARROW)&&(d=this._valueProperty.get()-O),this._roundToStepSize&&(d=roundValue(d,this._valueProperty.get(),O)))}const c=this._a11yMapValue(d,this._valueProperty.get());let y=c;l&&(y=this._constrainValue(c)),this._valueProperty.set(DotUtils.clamp(y,this._enabledRangeProperty.get().min,this._enabledRangeProperty.get().max)),this._onInput(r);const m=this._panTargetNode||this;animatedPanZoomSingleton.initialized&&animatedPanZoomSingleton.listener.panToNode(m,!0,m.limitPanDirection)}}handleKeyUp(r){const s=KeyboardUtils.getEventCode(r.domEvent);this._allKeysUp()||(KeyboardUtils.SHIFT_KEYS.includes(s)&&(this._shiftKey=!1),this.enabledProperty.get()&&KeyboardUtils.isRangeKey(r.domEvent)&&(this._rangeKeysDown[s]=!1,this._allKeysUp()&&this._onInteractionEnd(r)))}handleChange(r){this._a11yInputHandled||this.handleInput(r),this._a11yInputHandled=!1}handleInput(r){if(this.enabledProperty.get()&&!this._blockInput){this._a11yInputHandled=!0;let s=this._valueProperty.get();const a=parseFloat(r.domEvent.target.value),l=this._shiftKey?this.shiftKeyboardStep:this.keyboardStep,d=this._getMappedValue();this._onInteractionStart(r),a>d?s=this._valueProperty.get()+l:a<d&&(s=this._valueProperty.get()-l),this._roundToStepSize&&(s=roundValue(s,this._valueProperty.get(),l)),s=DotUtils.clamp(s,this._enabledRangeProperty.get().min,this._enabledRangeProperty.get().max),this._valueProperty.set(this._constrainValue(this._a11yMapValue(s,this._valueProperty.get()))),this._onInput(r),this._onInteractionEnd(r)}this._blockInput=!1}handleBlur(r){this._anyKeysDown()&&this._onInteractionEnd(r),this._shiftKey=!1,this._blockInput=!1,this._rangeKeysDown={}}_onInteractionStart(r){assert&&assert(!this._pdomPointer,"Pointer should have been cleared and detached on end or interrupt."),this._pdomPointer=r.pointer,assert&&assert(this._pdomPointer.attachedListener!==this._pdomPointerListener,"This pointer listener was never removed!"),this._pdomPointer.addInputListener(this._pdomPointerListener,!0),this._valueOnStart=this._valueProperty.value,this._startInput(r)}_onInteractionEnd(r){this._pdomPointer&&(this.alertContextResponse(),this.voicingOnEndResponse(this._valueOnStart),this._endInput(r),assert&&assert(this._pdomPointer.attachedListener===this._pdomPointerListener,"pointer listener should be attached"),this._pdomPointer.removeInputListener(this._pdomPointerListener),this._pdomPointer=null)}setKeyboardStep(r){assert&&assert(r>=0,"keyboard step must be non-negative"),this._keyboardStep=r}set keyboardStep(r){this.setKeyboardStep(r)}get keyboardStep(){return this.getKeyboardStep()}getKeyboardStep(){return this._keyboardStep}setShiftKeyboardStep(r){assert&&assert(r>=0,"shift keyboard step must be non-negative"),this._shiftKeyboardStep=r}set shiftKeyboardStep(r){this.setShiftKeyboardStep(r)}get shiftKeyboardStep(){return this.getShiftKeyboardStep()}getShiftKeyboardStep(){return this._shiftKeyboardStep}getShiftKeyDown(){return this._shiftKey}get shiftKeyDown(){return this.getShiftKeyDown()}setPageKeyboardStep(r){assert&&assert(r>=0,"page keyboard step must be non-negative"),this._pageKeyboardStep=r}set pageKeyboardStep(r){this.setPageKeyboardStep(r)}get pageKeyboardStep(){return this.getPageKeyboardStep()}getPageKeyboardStep(){return this._pageKeyboardStep}setAriaOrientation(r){this._ariaOrientation=r,this.setPDOMAttribute("aria-orientation",r.ariaOrientation)}set ariaOrientation(r){this.setAriaOrientation(r)}get ariaOrientation(){return this._ariaOrientation}getAriaOrientation(){return this._ariaOrientation}_allKeysUp(){return _.every(this._rangeKeysDown,r=>!r)}_anyKeysDown(){return!!_.find(this._rangeKeysDown,r=>r)}_updateSiblingStepAttribute(){let r="any";if(platform.mobileSafari){const s=Math.min(this.keyboardStep,this.shiftKeyboardStep,this.pageKeyboardStep);r=Math.pow(10,-DotUtils.numberOfDecimalPlaces(s));const a=this._getMappedValue(this._enabledRangeProperty.get().min),l=this._getMappedValue(this._enabledRangeProperty.get().max),d=l-a;r/d<1e-5&&(r=l/100,r=Number(r.toPrecision(8)))}this.setPDOMAttribute("step",r)}voicingOnEndResponse(r,s){const a=combineOptions({},this._voicingOnEndResponseOptions,s),l=r!==this._valueProperty.value,d=this._valueProperty.value===this._enabledRangeProperty.value.min||this._valueProperty.value===this._enabledRangeProperty.value.max,c=!!(a.withNameResponse&&this.voicingNameResponse)||!!(a.withObjectResponse&&this.voicingObjectResponse);(!a.onlyOnValueChange||d||l)&&c&&this.voicingSpeakFullResponse({nameResponse:a.withNameResponse?this.voicingNameResponse:null,objectResponse:a.withObjectResponse?this.voicingObjectResponse:null,hintResponse:null})}dispose(){this._disposeAccessibleValueHandler(),super.dispose()}});return t.prototype._mutatorKeys=ACCESSIBLE_VALUE_HANDLER_OPTIONS.concat(t.prototype._mutatorKeys),assert&&assert(t.prototype._mutatorKeys.length===_.uniq(t.prototype._mutatorKeys).length,"duplicate mutator keys in AccessibleValueHandler"),t};sun.register("AccessibleValueHandler",AccessibleValueHandler);const roundValue=function(o,e,t){let n=o;return t!==0&&(n=DotUtils.roundSymmetric(n/t)*t,n=correctRounding(n,e,t)),n},correctRounding=function(o,e,t){let n=o;const r=Math.abs(o-e),s=r>t,a=DotUtils.equalsEpsilon(r,t,1e-14);return s&&!a&&(n+=o>e?-t:t),n};AccessibleValueHandler.DEFAULT_TAG_NAME=DEFAULT_TAG_NAME;const ACCESSIBLE_SLIDER_OPTIONS=["startDrag","drag","endDrag"],AccessibleSlider=(o,e)=>{const t=DelayedMutate$1("AccessibleSlider",ACCESSIBLE_SLIDER_OPTIONS,class extends AccessibleValueHandler(o,e){constructor(...r){const s=r[e];assert&&s&&assert(Object.getPrototypeOf(s)===Object.prototype,"Extra prototype on AccessibleSlider options object is a code smell (or probably a bug)"),assert&&assert(s.startInput===void 0,"AccessibleSlider sets startInput through options.startDrag"),assert&&assert(s.endInput===void 0,"AccessibleSlider sets endInput through options.endDrag"),assert&&assert(s.onInput===void 0,"AccessibleSlider sets onInput through options.drag"),super(...r),this._startDrag=_.noop,this._drag=_.noop,this._endDrag=_.noop,assertHasProperties(this,["addInputListener","removeInputListener"]);const a=this.getAccessibleValueHandlerInputListener();this.addInputListener(a),this._disposeAccessibleSlider=()=>{this.removeInputListener(a)}}set startDrag(r){this._startDrag=r,this.startInput=r}get startDrag(){return this._startDrag}set drag(r){this._drag=r,this.onInput=r}get drag(){return this._drag}set endDrag(r){this._endDrag=r,this.endInput=r}get endDrag(){return this._endDrag}dispose(){this._disposeAccessibleSlider(),super.dispose()}});return t.prototype._mutatorKeys=ACCESSIBLE_SLIDER_OPTIONS.concat(t.prototype._mutatorKeys),assert&&assert(t.prototype._mutatorKeys.length===_.uniq(t.prototype._mutatorKeys).length,"duplicate mutator keys in AccessibleSlider"),t};sun.register("AccessibleSlider",AccessibleSlider);class SliderThumb extends Rectangle{constructor(e){const t=optionize()({size:new Dimension2(22,45),fillHighlighted:"rgb( 71, 207, 255 )",centerLineStroke:"white",fill:"rgb( 50, 145, 184 )",stroke:"black",lineWidth:1,tandem:Tandem.REQUIRED,tandemNameSuffix:"ThumbNode"},e);t.cornerRadius===void 0&&(t.cornerRadius=.25*t.size.width),t.cachedPaints=[t.fill,t.fillHighlighted],super(0,0,t.size.width,t.size.height,t);const n=Rectangle.bounds(this.bounds.dilated(5),{fill:"transparent",localBounds:this.bounds,pickable:!1});this.addChild(n);const r=3;this.addChild(new Path(Shape$1.lineSegment(t.size.width/2,r,t.size.width/2,t.size.height-r),{stroke:t.centerLineStroke}));const s=new PressListener({attach:!1,tandem:Tandem.OPT_OUT});s.isHighlightedProperty.link(a=>{this.fill=a?t.fillHighlighted:t.fill}),this.addInputListener(s)}}sun.register("SliderThumb",SliderThumb);class SliderTick{constructor(e,t,n,r,s,a,l,d,c){this.parent=e,this.value=t,this.label=n,this.labelXProperty=new DerivedProperty([c.valueToPositionProperty],m=>m.evaluate(t)),this.tickNode=new Node$2,e.addChild(this.tickNode);const y=new Path(new Shape$1().moveTo(0,c.top).lineTo(0,c.top-r),{stroke:s,lineWidth:a});this.labelXProperty.link(m=>{y.x=m}),this.tickNode.addChild(y),n&&(this.labelContainer=new Node$2({pickable:!1}),this.tickNode.addChild(this.labelContainer),this.labelContainer.addChild(n),d===Orientation.VERTICAL&&(this.labelContainer.rotation=-SunConstants.SLIDER_VERTICAL_ROTATION),this.labelManualConstraint=ManualConstraint.create(this.tickNode,[y,this.labelContainer],(m,O)=>{O.centerX=m.centerX,O.bottom=m.top-l.tickLabelSpacing}))}dispose(){this.parent.removeChild(this.tickNode),this.labelContainer&&this.labelContainer.dispose(),this.labelXProperty.dispose(),this.labelManualConstraint&&this.labelManualConstraint.dispose()}}sun.register("SliderTick",SliderTick);const DEFAULT_HORIZONTAL_TRACK_SIZE=new Dimension2(100,5),DEFAULT_HORIZONTAL_THUMB_SIZE=new Dimension2(17,34),gr=class gr extends Sizable(AccessibleSlider(Node$2,0)){constructor(e,t,n){var fe,be;assert&&assertMutuallyExclusiveOptions(n,["thumbNode"],["thumbSize","thumbFill","thumbFillHighlighted","thumbStroke","thumbLineWidth","thumbCenterLineStroke","thumbTouchAreaXDilation","thumbTouchAreaYDilation","thumbMouseAreaXDilation","thumbMouseAreaYDilation"]),assert&&assertMutuallyExclusiveOptions(n,["trackNode"],["trackSize","trackFillEnabled","trackFillDisabled","trackStroke","trackLineWidth","trackCornerRadius"]);const r=optionize()({orientation:Orientation.HORIZONTAL,trackNode:null,trackSize:null,trackFillEnabled:"white",trackFillDisabled:"gray",trackStroke:"black",trackLineWidth:1,trackCornerRadius:0,trackPickable:!0,thumbNode:null,thumbSize:null,thumbFill:"rgb(50,145,184)",thumbFillHighlighted:"rgb(71,207,255)",thumbStroke:"black",thumbLineWidth:1,thumbCenterLineStroke:"white",thumbTouchAreaXDilation:11,thumbTouchAreaYDilation:11,thumbMouseAreaXDilation:0,thumbMouseAreaYDilation:0,thumbYOffset:0,tickLabelSpacing:6,majorTickLength:25,majorTickStroke:"black",majorTickLineWidth:1,minorTickLength:10,minorTickStroke:"black",minorTickLineWidth:1,cursor:"pointer",startDrag:_.noop,drag:_.noop,endDrag:_.noop,constrainValue:_.identity,disabledOpacity:SceneryConstants.DISABLED_OPACITY,soundGenerator:gr.DEFAULT_SOUND_GENERATOR,valueChangeSoundGeneratorOptions:{},phetioLinkedProperty:null,tandem:Tandem.REQUIRED,tandemNameSuffix:"Slider",phetioType:gr.SliderIO,phetioFeatured:!0,visiblePropertyOptions:{phetioFeatured:!0},phetioEnabledPropertyInstrumented:!0},n),s=t instanceof Range?new TinyProperty(t):t;if(assert&&assert(r.soundGenerator===gr.DEFAULT_SOUND_GENERATOR||_.isEmpty(r.valueChangeSoundGeneratorOptions),"options should only be supplied when using default sound generator"),r.soundGenerator===gr.DEFAULT_SOUND_GENERATOR?r.soundGenerator=new ValueChangeSoundPlayer(s.value,r.valueChangeSoundGeneratorOptions||{}):r.soundGenerator===null&&(r.soundGenerator=ValueChangeSoundPlayer.NO_SOUND),r.soundGenerator!==ValueChangeSoundPlayer.NO_SOUND){let Ae=e.value;const W=r.drag;r.drag=J=>{J.isFromPDOM()?r.soundGenerator.playSoundForValueChange(e.value,Ae):r.soundGenerator.playSoundIfThresholdReached(e.value,Ae),W(J),Ae=e.value}}r.orientation===Orientation.VERTICAL&&(r.trackSize&&(r.trackSize=r.trackSize.swapped()),r.thumbSize&&(r.thumbSize=r.thumbSize.swapped()),swapObjectKeys(r,"thumbTouchAreaXDilation","thumbTouchAreaYDilation"),swapObjectKeys(r,"thumbMouseAreaXDilation","thumbMouseAreaYDilation")),r.trackSize=r.trackSize||DEFAULT_HORIZONTAL_TRACK_SIZE,r.thumbSize=r.thumbSize||DEFAULT_HORIZONTAL_THUMB_SIZE;const a=r.tandem.createTandem(gr.THUMB_NODE_TANDEM_NAME);Tandem.VALIDATION&&r.thumbNode&&assert&&assert(r.thumbNode.tandem.equals(a),`Passed-in thumbNode must have the correct tandem. Expected: ${a.phetioID}, actual: ${r.thumbNode.tandem.phetioID}`);const l=r.thumbNode||new SliderThumb({size:r.thumbSize,fill:r.thumbFill,fillHighlighted:r.thumbFillHighlighted,stroke:r.thumbStroke,lineWidth:r.thumbLineWidth,centerLineStroke:r.thumbCenterLineStroke,tandem:a}),d=!r.enabledRangeProperty,c=_.pick(r,Node$2.REQUIRES_BOUNDS_OPTION_KEYS),y=combineOptions({ariaOrientation:r.orientation,valueProperty:e,panTargetNode:l,enabledRangeProperty:r.enabledRangeProperty||(t instanceof Range?new Property(t,{valueType:Range,isValidValue:Ae=>Ae.min>=t.min&&Ae.max<=t.max,tandem:r.tandem.createTandem("enabledRangeProperty"),phetioValueType:Range.RangeIO,phetioDocumentation:"Sliders support two ranges: the outer range which specifies the min and max of the track and the enabledRangeProperty, which determines how low and high the thumb can be dragged within the track."}):t)},r);super(y),this.ticks=createObservableArray(),this.proposedValue=null,this.orientation=y.orientation,this.enabledRangeProperty=y.enabledRangeProperty,this.tickOptions=_.pick(r,"tickLabelSpacing","majorTickLength","majorTickStroke","majorTickLineWidth","minorTickLength","minorTickStroke","minorTickLineWidth");const m=[];this.majorTicksParent=new Node$2,this.minorTicksParent=new Node$2,m.push(this.majorTicksParent),m.push(this.minorTicksParent);const O=r.tandem.createTandem(gr.TRACK_NODE_TANDEM_NAME);Tandem.VALIDATION&&r.trackNode&&assert&&assert(r.trackNode.tandem.equals(O),`Passed-in trackNode must have the correct tandem. Expected: ${O.phetioID}, actual: ${r.trackNode.tandem.phetioID}`);const D=new Node$2;m.push(D),assert&&assert(y.trackSize,"trackSize should not be null"),this.track=r.trackNode||new DefaultSliderTrack(e,t,{size:y.trackSize,fillEnabled:y.trackFillEnabled,fillDisabled:y.trackFillDisabled,stroke:y.trackStroke,lineWidth:y.trackLineWidth,cornerRadius:y.trackCornerRadius,startDrag:y.startDrag,drag:y.drag,endDrag:y.endDrag,constrainValue:y.constrainValue,enabledRangeProperty:this.enabledRangeProperty,soundGenerator:r.soundGenerator,pickable:y.trackPickable,voicingOnEndResponse:this.voicingOnEndResponse.bind(this),tandem:O}),m.push(this.track),l.setCenterY(this.track.centerY+r.thumbYOffset),m.push(l);const z=new Node$2({children:m});r.orientation===Orientation.VERTICAL&&(z.rotation=SunConstants.SLIDER_VERTICAL_ROTATION),this.addChild(z),!r.thumbNode&&(r.thumbTouchAreaXDilation||r.thumbTouchAreaYDilation)&&(l.touchArea=l.localBounds.dilatedXY(r.thumbTouchAreaXDilation,r.thumbTouchAreaYDilation)),!r.thumbNode&&(r.thumbMouseAreaXDilation||r.thumbMouseAreaYDilation)&&(l.mouseArea=l.localBounds.dilatedXY(r.thumbMouseAreaXDilation,r.thumbMouseAreaYDilation));let w=0,N=e.value;const H=new DragListener({tandem:l.tandem.createTandem("dragListener"),start:(Ae,W)=>{this.enabledProperty.get()&&(N=e.value,r.startDrag(Ae),w=W.pressedTrail.subtrailTo(z).getTransform().inversePosition2(Ae.pointer.point).x-l.centerX)},drag:(Ae,W)=>{if(this.enabledProperty.get()){const Ue=W.pressedTrail.subtrailTo(z).getTransform().inversePosition2(Ae.pointer.point).x-w;this.proposedValue=this.track.valueToPositionProperty.value.inverse(Ue);const gt=this.enabledRangeProperty.get().constrainValue(this.proposedValue);e.set(r.constrainValue(gt)),r.drag(Ae)}},end:Ae=>{this.enabledProperty.get()&&(r.endDrag(Ae),this.voicingOnEndResponse(N)),this.proposedValue=null}});l.addInputListener(H),this.thumbDragListener=H,this.trackDragListener=this.track.dragListener;const X=Multilink.multilink([e,this.track.valueToPositionProperty],(Ae,W)=>{l.centerX=W.evaluate(Ae)}),ae=Ae=>{if(!e.isPhetioInstrumented()||!isSettingPhetioStateProperty.value)if(this.proposedValue===null)e.set(DotUtils.clamp(e.value,Ae.min,Ae.max));else{const W=DotUtils.clamp(this.proposedValue,Ae.min,Ae.max),J=r.constrainValue(W);e.set(J)}};this.enabledRangeProperty.link(ae);const oe=new SliderConstraint(this,this.track,l,z,r.orientation,D,this.ticks);this.disposeSlider=()=>{oe.dispose(),l.dispose&&l.dispose(),this.track.dispose&&this.track.dispose(),d?this.enabledRangeProperty.dispose():this.enabledRangeProperty.unlink(ae),X.dispose(),H.dispose()},this.focusHighlight=new HighlightFromNode$1(l),assert&&Tandem.VALIDATION&&assert(!r.phetioLinkedProperty||r.phetioLinkedProperty.isPhetioInstrumented(),"If provided, phetioLinkedProperty should be PhET-iO instrumented");const ue=r.phetioLinkedProperty||(e instanceof ReadOnlyProperty?e:null);ue&&this.addLinkedElement(ue,{tandemName:"valueProperty"}),!d&&this.enabledRangeProperty instanceof ReadOnlyProperty&&this.addLinkedElement(this.enabledRangeProperty,{tandemName:"enabledRangeProperty"}),this.mutate(c),assert&&((be=(fe=phet==null?void 0:phet.chipper)==null?void 0:fe.queryParameters)!=null&&be.binder)&&InstanceRegistry.registerDataURL("sun","Slider",this)}get majorTicksVisible(){return this.getMajorTicksVisible()}set majorTicksVisible(e){this.setMajorTicksVisible(e)}get minorTicksVisible(){return this.getMinorTicksVisible()}set minorTicksVisible(e){this.setMinorTicksVisible(e)}dispose(){this.disposeSlider(),this.ticks.forEach(e=>{e.dispose()}),super.dispose()}addMajorTick(e,t){this.addTick(this.majorTicksParent,e,t,this.tickOptions.majorTickLength,this.tickOptions.majorTickStroke,this.tickOptions.majorTickLineWidth)}addMinorTick(e,t){this.addTick(this.minorTicksParent,e,t,this.tickOptions.minorTickLength,this.tickOptions.minorTickStroke,this.tickOptions.minorTickLineWidth)}addTick(e,t,n,r,s,a){this.ticks.push(new SliderTick(e,t,n,r,s,a,this.tickOptions,this.orientation,this.track))}setMajorTicksVisible(e){this.majorTicksParent.visible=e}getMajorTicksVisible(){return this.majorTicksParent.visible}setMinorTicksVisible(e){this.minorTicksParent.visible=e}getMinorTicksVisible(){return this.minorTicksParent.visible}};gr.DEFAULT_SOUND_GENERATOR=new ValueChangeSoundPlayer(new Range(0,1)),gr.THUMB_NODE_TANDEM_NAME="thumbNode",gr.TRACK_NODE_TANDEM_NAME="trackNode",gr.SliderIO=new IOType("SliderIO",{valueType:gr,documentation:"A traditional slider component, with a knob and possibly tick marks",supertype:Node$2.NodeIO});let Slider=gr;class SliderConstraint extends LayoutConstraint{constructor(e,t,n,r,s,a,l){super(e),this.slider=e,this.track=t,this.thumb=n,this.sliderPartsNode=r,this.orientation=s,this.trackSpacer=a,this.ticks=l,s===Orientation.HORIZONTAL?(e.heightSizable=!1,this.preferredProperty=this.slider.localPreferredWidthProperty):(e.widthSizable=!1,this.preferredProperty=this.slider.localPreferredHeightProperty),this.preferredProperty.lazyLink(this._updateLayoutListener),this.track.rangeProperty.lazyLink(this._updateLayoutListener),this.thumb.localBoundsProperty.lazyLink(this._updateLayoutListener);const d=c=>{c.tickNode.localBoundsProperty.lazyLink(this._updateLayoutListener),l.addItemRemovedListener(y=>{y===c&&y.tickNode.localBoundsProperty.hasListener(this._updateLayoutListener)&&c.tickNode.localBoundsProperty.unlink(this._updateLayoutListener)})};l.addItemAddedListener(d),this.addNode(t),this.layout(),this.disposeSliderConstraint=()=>{l.removeItemAddedListener(d),this.preferredProperty.unlink(this._updateLayoutListener),this.track.rangeProperty.unlink(this._updateLayoutListener),this.thumb.localBoundsProperty.unlink(this._updateLayoutListener)}}layout(){super.layout();const e=this.slider,t=this.track,n=this.thumb;this.trackSpacer.localBounds=t.localBounds.dilatedX(n.width/2),assert&&assert(t.minimumWidth!==null);const r=t.leftVisualOverflow+t.rightVisualOverflow,s=t.minimumWidth,a=s-r,l=O=>DotUtils.linear(t.rangeProperty.value.min,t.rangeProperty.value.max,0,1,O),d=-n.width/2-t.leftVisualOverflow,c=n.width/2-t.leftVisualOverflow,y=new Range(d,s+c);if(this.ticks.forEach(O=>{const D=a*l(O.value),z=O.tickNode.width/2;y.includeRange(new Range(-z,z).shifted(D))}),e.widthSizable&&this.preferredProperty.value!==null){const O=CompletePiecewiseLinearFunction.max(CompletePiecewiseLinearFunction.linear(1,c),...this.ticks.map(z=>{const w=l(z.value);return CompletePiecewiseLinearFunction.linear(w,z.tickNode.width/2-r*w)})).minus(CompletePiecewiseLinearFunction.min(CompletePiecewiseLinearFunction.constant(d),...this.ticks.map(z=>{const w=l(z.value);return CompletePiecewiseLinearFunction.linear(w,-z.tickNode.width/2-r*w)}))),D=O.withXValues([s-1,s,...O.points.map(z=>z.x).filter(z=>z>s+1e-10)]).inverted();t.preferredWidth=Math.max(s,D.evaluate(this.preferredProperty.value))}else t.preferredWidth=t.minimumWidth;const m=y.getLength();this.orientation===Orientation.HORIZONTAL?e.localMinimumWidth=m:e.localMinimumHeight=m}dispose(){this.disposeSliderConstraint(),super.dispose()}}sun.register("Slider",Slider);class SliderTrack extends WidthSizable(Node$2){constructor(e,t,n,r){super(),this.rangeProperty=n instanceof Range?new TinyProperty(n):n;const s=optionize()({size:new Dimension2(100,5),startDrag:_.noop,drag:_.noop,endDrag:_.noop,constrainValue:_.identity,enabledRangeProperty:this.rangeProperty,soundGenerator:Slider.DEFAULT_SOUND_GENERATOR,valueChangeSoundGeneratorOptions:{},voicingOnEndResponse:_.noop,leftVisualOverflow:0,rightVisualOverflow:0,tandem:Tandem.REQUIRED,tandemNameSuffix:"TrackNode"},r);s.soundGenerator===Slider.DEFAULT_SOUND_GENERATOR?s.soundGenerator=new ValueChangeSoundPlayer(this.rangeProperty.value,s.valueChangeSoundGeneratorOptions||{}):s.soundGenerator===null&&(s.soundGenerator=ValueChangeSoundPlayer.NO_SOUND),this.leftVisualOverflow=s.leftVisualOverflow,this.rightVisualOverflow=s.rightVisualOverflow,this.minimumSize=s.size,this.minimumWidth=this.minimumSize.width,this.internalWidthProperty=new DerivedProperty([this.localPreferredWidthProperty],d=>(d===null?this.minimumSize.width:Math.max(this.minimumSize.width,d))-s.leftVisualOverflow-s.rightVisualOverflow),this.sizeProperty=new DerivedProperty([this.internalWidthProperty],d=>new Dimension2(d,this.minimumSize.height)),this.valueToPositionProperty=new DerivedProperty([this.rangeProperty,this.internalWidthProperty],(d,c)=>new LinearFunction(d.min,d.max,0,c,!0));const a=(d,c)=>{const y=e.value,O=c.subtrailTo(this).getTransform().inversePosition2(d.pointer.point).x,D=this.valueToPositionProperty.value.inverse(O),z=s.enabledRangeProperty.value.constrainValue(D),w=s.constrainValue(z);e.set(w),d.type==="down"&&s.soundGenerator.playSoundIfThresholdReached(w,y)};this.addChild(t);let l=e.value;this.dragListener=new DragListener({tandem:s.tandem.createTandem("dragListener"),start:(d,c)=>{s.startDrag(d),l=e.value,a(d,c.pressedTrail)},drag:(d,c)=>{s.drag(d),a(d,c.pressedTrail)},end:d=>{s.endDrag(d),s.voicingOnEndResponse(l)}}),t.addInputListener(this.dragListener),this.mutate(s),this.disposeSliderTrack=()=>{t.removeInputListener(this.dragListener),this.dragListener.dispose()}}dispose(){this.disposeSliderTrack(),super.dispose()}}sun.register("SliderTrack",SliderTrack);class DefaultSliderTrack extends SliderTrack{constructor(e,t,n){const r=optionize()({fillEnabled:"white",fillDisabled:"gray",stroke:"black",lineWidth:1,cornerRadius:0},n),s=new Rectangle({fill:r.fillDisabled,stroke:r.stroke,lineWidth:r.lineWidth,cornerRadius:r.cornerRadius,cursor:"default",pickable:!1}),a=new Rectangle({fill:r.fillEnabled,stroke:r.stroke,lineWidth:r.lineWidth,cornerRadius:r.cornerRadius}),l=new Node$2({children:[s,a]});super(e,l,t,combineOptions({leftVisualOverflow:r.stroke!==null?r.lineWidth/2:0,rightVisualOverflow:r.stroke!==null?r.lineWidth/2:0},r));const d=Multilink.multilink([r.enabledRangeProperty,this.valueToPositionProperty,this.sizeProperty],(c,y,m)=>{const O=y.evaluate(c.min),D=y.evaluate(c.max);s.setRect(0,0,m.width,m.height),a.setRect(O,0,D-O,m.height)});this.disposeDefaultSliderTrack=()=>{d.dispose()}}dispose(){this.disposeDefaultSliderTrack(),super.dispose()}}sun.register("DefaultSliderTrack",DefaultSliderTrack);const sceneryPhet=new Namespace("sceneryPhet"),joist=new Namespace("joist"),FALLBACK_LOCALE$3="en",availableRuntimeLocales=_.sortBy(Object.keys(phet.chipper.strings),o=>StringUtils.localeToLocalizedName(o).toLowerCase()),isLocaleValid=o=>!!(o&&availableRuntimeLocales.includes(o)),partialLocale=typeof phet.chipper.locale=="string"?phet.chipper.locale.slice(0,2):void 0,validInitialLocale=isLocaleValid(phet.chipper.locale)?phet.chipper.locale:isLocaleValid(partialLocale)?partialLocale:FALLBACK_LOCALE$3;phet.chipper.locale=validInitialLocale;class LocaleProperty extends Property{unguardedSet(e){availableRuntimeLocales.includes(e)?super.unguardedSet(e):assert&&assert(!1,"Unsupported locale: "+e)}}const localeProperty=new LocaleProperty(validInitialLocale,{tandem:Tandem.GENERAL_MODEL.createTandem("localeProperty"),phetioFeatured:!0,phetioValueType:StringIO,validValues:availableRuntimeLocales,phetioDocumentation:"Specifies language currently displayed in the simulation"});var gd,md;if((md=(gd=phet==null?void 0:phet.chipper)==null?void 0:gd.queryParameters)!=null&&md.keyboardLocaleSwitcher){const o=KeyboardUtils.KEY_I,e=KeyboardUtils.KEY_U;globalKeyStateTracker$1.keydownEmitter.addListener(t=>{const n=r=>{t.preventDefault();const a=(availableRuntimeLocales.indexOf(localeProperty.value)+r+availableRuntimeLocales.length)%availableRuntimeLocales.length;localeProperty.value=availableRuntimeLocales[a],console.log(localeProperty.value)};t.ctrlKey&&!t.shiftKey&&!t.metaKey&&!t.altKey&&(KeyboardUtils.isKeyEvent(t,o)?n(1):KeyboardUtils.isKeyEvent(t,e)&&n(-1))})}joist.register("localeProperty",localeProperty);const fallbackLocalesProperty=new Property([],{tandem:Tandem.GENERAL_MODEL.createTandem("fallbackLocalesProperty"),phetioDocumentation:'An ordered list of locales to "fall back" on when a translation is missing for the selected locale, for example: ["es", "de" ]. "en" will always be added to the end of this, because it has guaranteed full coverage of all translated keys.',phetioFeatured:!0,isValidValue:o=>_.every(o,e=>!!localeInfoModule[e]),phetioValueType:ArrayIO(StringIO)});joist.register("fallbackLocalesProperty",fallbackLocalesProperty);const FALLBACK_LOCALE$2="en",localeOrderProperty=new DerivedProperty([localeProperty,fallbackLocalesProperty],(o,e)=>{const t=[o],n=o.slice(0,2);o!==n&&!t.includes(n)&&t.push(n);for(let s=0;s<e.length;s++){const a=e[s];t.includes(a)||t.push(a)}t.includes(FALLBACK_LOCALE$2)||t.push(FALLBACK_LOCALE$2);const r=t.indexOf(FALLBACK_LOCALE$2);return assert&&assert(r>=0,`Required local in localeOrderProperty: ${FALLBACK_LOCALE$2}`),t.slice(0,r+1)});joist.register("localeOrderProperty",localeOrderProperty);const chipper=new Namespace("chipper");class LocalizedStringProperty extends DynamicProperty{constructor(e,t,n){const r=n&&typeof n.phetioReadOnly=="boolean"?n.phetioReadOnly:TandemConstants.PHET_IO_OBJECT_METADATA_DEFAULTS.phetioReadOnly,s=n&&typeof n.phetioFeatured=="boolean"?n.phetioFeatured:!0,a=n&&typeof n.phetioDocumentation=="string"?n.phetioDocumentation:TandemConstants.PHET_IO_OBJECT_METADATA_DEFAULTS.phetioDocumentation;super(localeProperty,{derive:l=>e.getLocaleSpecificProperty(l),bidirectional:!0,phetioValueType:StringIO,phetioState:!1,tandem:t,phetioFeatured:s,phetioReadOnly:r,phetioDocumentation:a}),this.localizedString=e}get stringKey(){return this.localizedString.stringKey}}chipper.register("LocalizedStringProperty",LocalizedStringProperty);const FALLBACK_LOCALE$1="en";class LocalizedString{constructor(e,t,n,r){this.stringKey=e,this.localePropertyMap=new Map,this.initialValues={},this.englishProperty=new TinyProperty(t),this.initialValues[FALLBACK_LOCALE$1]=t,this.localeOrderListener=this.onLocaleOrderChange.bind(this),localeOrderProperty.lazyLink(this.localeOrderListener),this.property=new LocalizedStringProperty(this,n,r),localizedStrings.push(this)}setInitialValue(e,t){this.initialValues[e]=t,this.getLocaleSpecificProperty(e).value=t}getStateDelta(){const e={};return this.usedLocales.forEach(t=>{const n=this.getRawStringValue(t);n!==null&&n!==this.initialValues[t]&&(e[t]=n)}),e}setStateDelta(e){Object.keys(e).forEach(t=>this.getLocaleSpecificProperty(t)),this.usedLocales.forEach(t=>{const n=this.getLocaleSpecificProperty(t),r=this.initialValues[t]!==void 0?this.initialValues[t]:null,s=e[t]!==void 0?e[t]:null;s===null?r===null?n.clearOverride():n.value=r:n.value=s})}getRawStringValue(e){const t=this.getLocaleSpecificProperty(e);return t instanceof TinyOverrideProperty?t.isOverridden?t.value:null:t.value}get usedLocales(){return[FALLBACK_LOCALE$1,...this.localePropertyMap.keys()]}onLocaleOrderChange(e){const t=[...this.usedLocales,...e];for(let n=t.length-1;n>=0;n--){const r=t[n],s=this.getLocaleSpecificProperty(r);s instanceof TinyOverrideProperty&&(s.targetProperty=this.getLocaleSpecificProperty(LocalizedString.getFallbackLocale(r)))}}getLocaleSpecificProperty(e){return e==="en"?this.englishProperty:(this.localePropertyMap.has(e)||this.localePropertyMap.set(e,new TinyOverrideProperty(this.getLocaleSpecificProperty(LocalizedString.getFallbackLocale(e)))),this.localePropertyMap.get(e))}static getFallbackLocale(e){if(e==="en")return"en";const t=localeOrderProperty.value,n=t.indexOf(e);return n>=0?(assert&&assert(t[t.length-1]==="en"),assert&&assert(n+1<t.length),t[n+1]):e.includes("_")?e.slice(0,2):"en"}dispose(){localeOrderProperty.unlink(this.localeOrderListener),this.property.dispose(),arrayRemove(localizedStrings,this)}restoreInitialValue(e){assert&&assert(typeof this.initialValues[e]=="string","initial value expected for",e),this.property.value=this.initialValues[e]}}chipper.register("LocalizedString",LocalizedString);const FALLBACK_LOCALE="en",localizedStrings=[];window.phet.chipper.localizedStrings=localizedStrings;window.phet.chipper.setAllStrings=o=>{localizedStrings.forEach(e=>{e.property.value=o})};const stringKeyToTandemName=o=>o.replace(/(?:[-_\s]\w)/g,e=>e[1].toUpperCase()),StringStateIOType=new IOType("StringStateIO",{valueType:PhetioObject,toStateObject:()=>{const o={};return localizedStrings.forEach(e=>{const t=e.getStateDelta();Object.keys(t).length>0&&(o[e.property.tandem.phetioID]=t)}),{data:o}},stateSchema:{data:ObjectLiteralIO},applyState:(o,e)=>{Object.keys(e.data).forEach(t=>{if(!localizedStrings.find(r=>r.property.tandem.phetioID===t))throw new CouldNotYetDeserializeError}),localizedStrings.forEach(t=>{t.setStateDelta(e.data[t.property.tandem.phetioID]||{})})}});PhetioObject.create({phetioType:StringStateIOType,tandem:Tandem.GENERAL_MODEL.createTandem("stringsState"),phetioDocumentation:"Strings that have changed from their initial values. Each string value is specific to the locale it changed in.",phetioState:!0});const getStringModule=o=>{assert&&assert(typeof phet.chipper.locale=="string","phet.chipper.locale should have been loaded by now"),assert&&assert(Object.keys(localeInfoModule).includes(phet.chipper.locale),"phet.chipper.locale should have been loaded by now"),assert&&assert(phet.chipper.strings,"phet.chipper.strings should have been loaded by now");const e=`${o}/`;let t=Object.keys(phet.chipper.strings[FALLBACK_LOCALE]).filter(r=>r.startsWith(e));phet.chipper.usedStringsEN&&(t=t.filter(r=>phet.chipper.usedStringsEN.hasOwnProperty(r)));const n={};return t.forEach(r=>{const a=r.slice(e.length).split("."),l=a[a.length-1],d=a.slice(0,a.length-1);let c=n,y=e;if(d.forEach((m,O)=>{y+=`${O>0?".":""}${m}`,assert&&assert(typeof c[m]!="string",`It is not allowed to have two different string keys where one is extended by adding a period (.) at the end of the other. The string key ${y} is extended by ${r} in this case, and should be changed.`),c[m]||(c[m]={}),c=c[m]}),assert&&assert(typeof c[l]!="object",`It is not allowed to have two different string keys where one is extended by adding a period (.) at the end of the other. The string key ${r} is extended by another key, something containing ${c[l]&&Object.keys(c[l])}.`),assert&&assert(!c[l],`We should not have defined this place in the object (${r}), otherwise it means a duplicated string key OR extended string key`),typeof c!="string"){let m=Tandem.STRINGS.createTandem(_.camelCase(o));for(let D=0;D<a.length;D++){let z=stringKeyToTandemName(a[D]);if(D===a.length-1){let w=z,N=0,H=!0;for(;H;)N++,w=`${z}${N===1?"":N}StringProperty`,H=m.hasChild(w);z=w}m=m.createTandem(z)}m.phetioID.includes(".a11y.")&&(m=Tandem.OPT_OUT);const O=new LocalizedString(r,phet.chipper.mapString(phet.chipper.strings[FALLBACK_LOCALE][r]),m,phet.chipper.stringMetadata[r]);Object.keys(phet.chipper.strings).forEach(D=>{const z=phet.chipper.strings[D][r];typeof z=="string"&&z!==""&&O.setInitialValue(D,phet.chipper.mapString(z))}),c[`${l}StringProperty`]=O.property,O.property.link(D=>{c[l]=D})}}),n},SceneryPhetStrings=getStringModule("SCENERY_PHET");sceneryPhet.register("SceneryPhetStrings",SceneryPhetStrings);class PDOMSectionNode extends Node$2{constructor(e,t){super(optionize()({containerTagName:"section",tagName:"div",labelContent:e,labelTagName:"h2"},t))}}sceneryPhet.register("PDOMSectionNode",PDOMSectionNode);class ControlAreaNode extends PDOMSectionNode{constructor(e){super(SceneryPhetStrings.a11y.simSection.controlAreaStringProperty,e)}}sceneryPhet.register("ControlAreaNode",ControlAreaNode);class PlayAreaNode extends PDOMSectionNode{constructor(e){super(SceneryPhetStrings.a11y.simSection.playAreaStringProperty,e)}}sceneryPhet.register("PlayAreaNode",PlayAreaNode);class ScreenSummaryNode extends Node$2{constructor(){super(),this.openingSummaryNode=new Node$2({tagName:"p"});const e=new Node$2({tagName:"p",innerContent:SceneryPhetStrings.a11y.simSection.screenSummary.keyboardShortcutsHintStringProperty});this.addChild(this.openingSummaryNode),this.addChild(e),this.pdomOrder=[this.openingSummaryNode,null,e]}setIntroString(e,t,n){this.openingSummaryNode.innerContent=n&&t?StringUtils.fillIn(SceneryPhetStrings.a11y.simSection.screenSummary.multiScreenIntroStringProperty,{screen:t}):StringUtils.fillIn(SceneryPhetStrings.a11y.simSection.screenSummary.singleScreenIntroPatternStringProperty,{sim:e})}}sceneryPhet.register("ScreenSummaryNode",ScreenSummaryNode);const DEFAULT_LAYOUT_BOUNDS=new Bounds2(0,0,1024,618),tl=class tl extends Node$2{constructor(e){const t=optionize()({layoutBounds:DEFAULT_LAYOUT_BOUNDS.copy(),layerSplit:!0,excludeInvisible:!0,tandem:Tandem.REQUIRED,visiblePropertyOptions:{phetioState:!1,phetioReadOnly:!0},containerTagName:"article",tagName:"div",screenSummaryContent:null,includePDOMNodes:!0},e);super(t),this._screenSummaryContent=null,assert&&this.isPhetioInstrumented()&&assert&&assert(t.tandem.name==="view","tandem name should be view"),this.layoutBounds=t.layoutBounds,this.visibleBoundsProperty=new Property(t.layoutBounds),this.pdomTitleNode=new Node$2({tagName:"h1",focusHighlight:"invisible"}),this.pdomPlayAreaNode=new PlayAreaNode,this.pdomControlAreaNode=new ControlAreaNode,this.pdomScreenSummaryNode=new ScreenSummaryNode,t.screenSummaryContent&&this.setScreenSummaryContent(t.screenSummaryContent),this.visibleProperty.lazyLink(n=>{n?(assert&&assert(!this.pdomTitleNode.focusable,"about to set to be focusable"),this.pdomTitleNode.focusable=!0,this.pdomTitleNode.focus()):this.pdomTitleNode.focusable=!1}),this.pdomTitleNode.addInputListener({blur:()=>{this.pdomTitleNode.focusable=!1}}),this.pdomParentNode=new Node$2({children:t.includePDOMNodes?[this.pdomTitleNode,this.pdomScreenSummaryNode,this.pdomControlAreaNode,this.pdomPlayAreaNode]:[this.pdomTitleNode]}),this.addChild(this.pdomParentNode),this.pdomParentNode.pdomOrder=t.includePDOMNodes?[this.pdomTitleNode,this.pdomScreenSummaryNode,this.pdomPlayAreaNode,this.pdomControlAreaNode]:[this.pdomTitleNode]}setPDOMOrder(e){throw new Error("should not need to set accessible order on a ScreenView")}setChildren(e){return Node$2.prototype.setChildren.call(this,e),this.pdomParentNode&&!this.hasChild(this.pdomParentNode)&&(this.addChild(this.pdomParentNode),this.pdomParentNode.moveToBack()),this}getLayoutScale(e){return tl.getLayoutScale(this.layoutBounds,e)}layout(e,t){this.matrix=tl.getLayoutMatrix(this.layoutBounds,e,t),this.visibleBoundsProperty.value=this.parentToLocalBounds(e)}get screenSummaryContent(){return this._screenSummaryContent}set screenSummaryContent(e){this.setScreenSummaryContent(e)}setScreenSummaryContent(e){assert&&assert(e!==this._screenSummaryContent,"this is already the screen summary Node content"),this._screenSummaryContent&&this.pdomScreenSummaryNode.removeChild(this._screenSummaryContent),this._screenSummaryContent=e,e&&this.pdomScreenSummaryNode.addChild(e)}setScreenSummaryIntroAndTitle(e,t,n,r){this.pdomScreenSummaryNode.setIntroString(e,t,r),this.pdomTitleNode.innerContent=n}getVoicingOverviewContent(){throw new Error("The ScreenView should implement getVoicingOverviewContent if Voicing is enabled")}getVoicingDetailsContent(){throw new Error("The ScreenView should implement getVoicingDetailsContent when the Voicing feature is enabled.")}getVoicingHintContent(){throw new Error("The ScreenView should implement getVoicingHintContent when Voicing is enabled.")}interruptSubtreeInput(){var e,t,n;return(n=(t=(e=window.phet)==null?void 0:e.joist)==null?void 0:t.display)==null||n.interruptOtherPointers(),super.interruptSubtreeInput()}static getLayoutScale(e,t){return Math.min(t.width/e.width,t.height/e.height)}static getLayoutMatrix(e,t,n){const r=optionize()({verticalAlign:"center"},n),s=t.width,a=t.height,l=tl.getLayoutScale(e,t);let d=0,c=0;return l===s/e.width?(c=a/l-e.height,r.verticalAlign==="center"&&(c/=2)):l===a/e.height&&(d=(s/l-e.width)/2),Matrix3.rowMajor(l,0,d*l+t.left,0,l,c*l+t.top,0,0,1)}step(e){}};tl.DEFAULT_LAYOUT_BOUNDS=DEFAULT_LAYOUT_BOUNDS;let ScreenView=tl;joist.register("ScreenView",ScreenView);const DARK_GREEN=new Color(0,200,0),RED_COLORBLIND=new Color(255,85,0),GREEN_COLORBLIND=new Color(0,135,0),PHET_LOGO_BLUE=new Color(106,206,245),PHET_LOGO_YELLOW=new Color(254,225,5),PhetColorScheme={ACCELERATION:new Color(255,255,50),APPLIED_FORCE:new Color(236,153,55),BUTTON_YELLOW:PHET_LOGO_YELLOW,ELASTIC_POTENTIAL_ENERGY:new Color(0,204,255),FRICTION_FORCE:RED_COLORBLIND,GRAVITATIONAL_FORCE:new Color(50,130,215),GRAVITATIONAL_POTENTIAL_ENERGY:new Color(55,130,215),HEAT_THERMAL_ENERGY:RED_COLORBLIND,IMAGINARY_PART:new Color(153,51,102),KINETIC_ENERGY:new Color(30,200,45),MOMENTUM:new Color(50,50,255),NET_WORK:DARK_GREEN,NORMAL_FORCE:new Color(255,235,0),PHET_LOGO_BLUE,PHET_LOGO_YELLOW,POSITION:Color.BLUE,REAL_PART:new Color(255,153,0),RED_COLORBLIND,RESET_ALL_BUTTON_BASE_COLOR:new Color(247,151,34),GREEN_COLORBLIND,TOTAL_ENERGY:new Color(180,180,0),TOTAL_FORCE:DARK_GREEN,VELOCITY:new Color(50,255,50),WALL_FORCE:new Color(153,51,0),SCREEN_ICON_FRAME:"#dddddd"};sceneryPhet.register("PhetColorScheme",PhetColorScheme);class CloseButton extends RectangularPushButton{constructor(e){const t=optionize()({iconLength:16,pathOptions:{stroke:"white",lineWidth:2.5,lineCap:"round"},baseColor:PhetColorScheme.RED_COLORBLIND,xMargin:4,yMargin:4,innerContent:SceneryPhetStrings.a11y.closeStringProperty,voicingNameResponse:SceneryPhetStrings.a11y.closeStringProperty},e),n=new Shape$1().moveTo(-t.iconLength/2,-t.iconLength/2).lineTo(t.iconLength/2,t.iconLength/2).moveTo(t.iconLength/2,-t.iconLength/2).lineTo(-t.iconLength/2,t.iconLength/2);t.content=new Path(n,t.pathOptions),super(t)}}sceneryPhet.register("CloseButton",CloseButton);const DynamicMarkerIO=new IOType("DynamicMarkerIO",{supertype:IOType.ObjectIO,applyState:_.noop,toStateObject:()=>({}),isValidValue:_.stubTrue,documentation:"PhET-iO Type used as a place holder for dynamic elements to be created when set for state."});tandemNamespace.register("DynamicMarkerIO",DynamicMarkerIO);const Popupable=(o,e)=>class extends o{constructor(...t){var d;super(...t);const n=t[e]||{},r=t[t.length-1];assert&&assert(r!==void 0,"config object is required for Popupable.");const s=gracefulBind("phet.joist.sim.showPopup"),a=gracefulBind("phet.joist.sim.hidePopup"),l=optionize()({showPopup:s,hidePopup:a,isModal:!0,layoutBounds:null,focusOnShowNode:null,focusOnHideNode:null,disableModals:_.get(window,"phet.chipper.queryParameters.disableModals")||!1},n);assert&&assert(l.isModal,"Non-modal popups not currently supported"),this.layoutBounds=l.layoutBounds,this._focusOnShowNode=l.focusOnShowNode,this.disableModals=l.disableModals,this.isModal=l.isModal,this._focusOnHideNode=l.focusOnHideNode,this._nodeToFocusOnHide=null,this.popupParent=new PopupParentNode(this,{show:this.show.bind(this),hide:this.hide.bind(this),layout:this.layout.bind(this)}),this.isShowingProperty=new BooleanProperty(!1,{tandem:(d=l.tandem)==null?void 0:d.createTandem("isShowingProperty"),phetioReadOnly:!0,phetioFeatured:!0}),this.isShowingProperty.lazyLink(c=>{c?l.showPopup(this.popupParent,l.isModal):l.hidePopup(this.popupParent,l.isModal)})}layout(t){this.layoutBounds&&(this.popupParent.matrix=ScreenView.getLayoutMatrix(this.layoutBounds,t))}shouldShowPopup(){return!(this.isModal&&this.disableModals)}show(){this.shouldShowPopup()&&(this._nodeToFocusOnHide=this._focusOnHideNode||FocusManager.pdomFocusedNode,this.isShowingProperty.value=!0,this._focusOnShowNode&&this._focusOnShowNode.focusable&&this._focusOnShowNode.focus())}hide(){var t;this.interruptSubtreeInput(),this.isShowingProperty.value=!1,this._nodeToFocusOnHide&&this._nodeToFocusOnHide.focusable&&((t=this._nodeToFocusOnHide.instances[0])!=null&&t.visible)&&this._nodeToFocusOnHide.focus()}get focusOnHideNode(){return this._focusOnHideNode}dispose(){this.hide(),this.isShowingProperty.dispose(),super.dispose()}};class PopupParentNode extends Node$2{constructor(e,t){const n=optionize()({children:[e]},t);super(n),this.show=n.show,this.hide=n.hide,this.layout=n.layout}}sun.register("Popupable",Popupable);const SunStrings=getStringModule("SUN");sun.register("SunStrings",SunStrings);const Kl=class Kl extends Popupable(Panel,1){constructor(e,t){var z;const n=optionize()({xSpacing:10,ySpacing:10,topMargin:15,bottomMargin:15,leftMargin:null,maxWidthMargin:12,maxHeightMargin:12,closeButtonLength:18.2,closeButtonTopMargin:10,closeButtonRightMargin:10,title:null,titleAlign:"center",addAriaLabelledByFromTitle:!0,layoutStrategy:defaultLayoutStrategy,closeButtonListener:()=>this.hide(),closeButtonColor:"black",closeButtonTouchAreaXDilation:0,closeButtonTouchAreaYDilation:0,closeButtonMouseAreaXDilation:0,closeButtonMouseAreaYDilation:0,closeButtonVoicingDialogTitle:null,closeButtonLastInPDOM:!1,openedSoundPlayer:generalOpenSoundPlayer,closedSoundPlayer:generalCloseSoundPlayer,sim:getGlobal("phet.joist.sim"),showCallback:null,hideCallback:null,layoutBounds:ScreenView.DEFAULT_LAYOUT_BOUNDS,focusOnShowNode:null,cornerRadius:10,resize:!0,fill:"white",stroke:"black",backgroundPickable:!0,maxHeight:null,maxWidth:null,tandemNameSuffix:["Dialog",DYNAMIC_ARCHETYPE_NAME],phetioType:Kl.DialogIO,phetioState:!0,phetioVisiblePropertyInstrumented:!1,tagName:"div",ariaRole:"dialog"},t);assert&&assert(n.sim,"sim must be provided, as Dialog needs a Sim instance"),assert&&assert(n.xMargin===void 0,"Dialog sets xMargin"),n.xMargin=0,assert&&assert(n.yMargin===void 0,"Dialog sets yMargin"),n.yMargin=0,n.leftMargin===null&&(n.leftMargin=n.xSpacing+n.closeButtonLength+n.closeButtonRightMargin),assert&&assert(n.maxHeight===null||typeof n.maxHeight=="number"),assert&&assert(n.maxWidth===null||typeof n.maxWidth=="number"),!n.maxWidth&&n.layoutBounds&&(n.maxWidth=applyDoubleMargin(n.layoutBounds.width,n.maxWidthMargin)),!n.maxHeight&&n.layoutBounds&&(n.maxHeight=applyDoubleMargin(n.layoutBounds.height,n.maxHeightMargin));const r=new Utterance({priority:Utterance.MEDIUM_PRIORITY,voicingCanAnnounceProperties:[voicingManager$1.voicingFullyEnabledProperty]}),s=new CloseButton({iconLength:n.closeButtonLength,baseColor:"transparent",buttonAppearanceStrategy:ButtonNode.FlatAppearanceStrategy,xMargin:0,yMargin:0,listener:()=>{s.voicingSpeakContextResponse({utterance:r}),n.closeButtonListener()},pathOptions:{stroke:n.closeButtonColor},tandem:(z=n.tandem)==null?void 0:z.createTandem("closeButton"),phetioState:!1,phetioVisiblePropertyInstrumented:!1,phetioEnabledPropertyInstrumented:!1,soundPlayer:nullSoundPlayer,tagName:"button",innerContent:SunStrings.a11y.closeStringProperty,voicingContextResponse:SunStrings.a11y.closedStringProperty});let a;if(n.closeButtonVoicingDialogTitle){const w=typeof n.closeButtonVoicingDialogTitle=="string"?new TinyProperty(n.closeButtonVoicingDialogTitle):n.closeButtonVoicingDialogTitle;a=s.voicingNameResponse=new PatternStringProperty(SunStrings.a11y.titleClosePatternStringProperty,{title:w},{tandem:Tandem.OPT_OUT})}s.touchArea=s.bounds.dilatedXY(n.closeButtonTouchAreaXDilation,n.closeButtonTouchAreaYDilation),s.mouseArea=s.bounds.dilatedXY(n.closeButtonMouseAreaXDilation,n.closeButtonMouseAreaYDilation);let l=[n.title,e];n.closeButtonLastInPDOM?l.push(s):l.unshift(s),l=l.filter(w=>w!=null),assert&&assert(l[0]),n.focusOnShowNode=n.focusOnShowNode?n.focusOnShowNode:l[0].focusable?l[0]:s,assert&&assert(n.focusOnShowNode instanceof Node$2,"should be non-null and defined"),assert&&assert(n.focusOnShowNode.focusable,"focusOnShowNode must be focusable.");const d=new VBox({children:n.title?[n.title,e]:[e],spacing:n.ySpacing,align:n.titleAlign}),c=new AlignBox(d,{topMargin:n.topMargin,bottomMargin:n.bottomMargin,leftMargin:n.leftMargin}),y=new AlignBox(s,{topMargin:n.closeButtonTopMargin,rightMargin:n.closeButtonRightMargin}),m=new HBox({children:[c,y],spacing:n.xSpacing,align:"top"});super(m,n),this.isShowingProperty.lazyLink(w=>{w?(n.openedSoundPlayer.play(),n.showCallback&&n.showCallback()):(n.closedSoundPlayer.play(),n.hideCallback&&n.hideCallback())}),this.sim=n.sim,this.closeButton=s;const O=Multilink.multilink([this.sim.boundsProperty,this.sim.screenBoundsProperty,this.sim.scaleProperty,this.sim.selectedScreenProperty,this.isShowingProperty,this.localBoundsProperty],(w,N,H)=>{w&&N&&H&&n.layoutStrategy(this,w,N,H)});this.pdomOrder=l,n.title&&n.title.tagName&&n.addAriaLabelledByFromTitle&&this.addAriaLabelledbyAssociation({thisElementName:PDOMPeer$1.PRIMARY_SIBLING,otherNode:n.title,otherElementName:PDOMPeer$1.PRIMARY_SIBLING});const D=new KeyboardListener({keys:["escape","tab","shift+tab"],callback:(w,N)=>{assert&&assert(w&&w.domEvent,"event should be non-null and defined for this listener");const H=w.domEvent;if(N==="escape")H.preventDefault(),this.hide();else if((N==="tab"||N==="shift+tab")&&FullScreen$1.isFullScreen()){assert&&assert(FocusManager.pdomFocus);const X=FocusManager.pdomFocus.trail.getUniqueId(),ae=PDOMUtils$1.getNextFocusable().id===X,oe=PDOMUtils$1.getPreviousFocusable().id===X;ae&&oe&&H.preventDefault()}}});this.addInputListener(D),this.disposeDialog=()=>{O.dispose(),y.dispose(),this.removeInputListener(D),D.dispose(),a&&a.dispose(),s.dispose(),r.dispose(),d.dispose(),m.removeAllChildren(),m.detach()}}dispose(){this.disposeDialog(),super.dispose()}};Kl.DialogIO=new IOType("DialogIO",{valueType:Kl,supertype:DynamicMarkerIO});let Dialog=Kl;function defaultLayoutStrategy(o,e,t,n){o.layoutBounds&&(o.center=o.layoutBounds.center)}function applyDoubleMargin(o,e){return o>e*2?o-e*2:o}sun.register("Dialog",Dialog);class HorizontalAquaRadioButtonGroup extends AquaRadioButtonGroup{constructor(e,t,n){super(e,t,optionize()({orientation:"horizontal"},n))}}sun.register("HorizontalAquaRadioButtonGroup",HorizontalAquaRadioButtonGroup);class HSlider extends Slider{constructor(e,t,n){var r,s;super(e,t,optionize()({orientation:Orientation.HORIZONTAL},n)),assert&&((s=(r=phet==null?void 0:phet.chipper)==null?void 0:r.queryParameters)!=null&&s.binder)&&InstanceRegistry.registerDataURL("sun","HSlider",this)}}sun.register("HSlider",HSlider);class MutableOptionsNode extends Node$2{constructor(e,t,n,r,s){super(),this.nodeProperty=new Property(null),this._constructInstance=()=>Reflect.construct(e,[...t,merge(_.mapValues(r,a=>a.value),n)]),this.multilink=Multilink.multilink(_.values(r),this.replaceCopy.bind(this)),this.mutate(s)}replaceCopy(){const e=this._constructInstance(),t=this.nodeProperty.value;this.nodeProperty.value=e,this.addChild(e),t&&(this.removeChild(t),this.disposeCopy(t))}disposeCopy(e){e.dispose&&e.dispose()}dispose(){this.multilink.dispose(),this.disposeCopy(this.nodeProperty.value),this.nodeProperty.dispose(),super.dispose()}}sun.register("MutableOptionsNode",MutableOptionsNode);const ACCESSIBLE_NUMBER_SPINNER_OPTIONS=["pdomTimerDelay","pdomTimerInterval"],AccessibleNumberSpinner=(o,e)=>{const t=DelayedMutate$1("AccessibleNumberSpinner",ACCESSIBLE_NUMBER_SPINNER_OPTIONS,class extends AccessibleValueHandler(o,e){constructor(...r){const s=r[e];assert&&s&&assert(Object.getPrototypeOf(s)===Object.prototype,"Extra prototype on AccessibleSlider options object is a code smell (or probably a bug)");const a=combineOptions({ariaOrientation:Orientation.VERTICAL},s);r[e]=a,super(...r),this._pdomTimerDelay=400,this._pdomTimerInterval=100,assertHasProperties(this,["addInputListener"]),this._callbackTimer=new CallbackTimer({delay:this._pdomTimerDelay,interval:this._pdomTimerInterval}),this.pdomIncrementDownEmitter=new Emitter({parameters:[{valueType:"boolean"}]}),this.pdomDecrementDownEmitter=new Emitter({parameters:[{valueType:"boolean"}]}),this.setPDOMAttribute("aria-roledescription",SunStrings.a11y.numberSpinnerRoleDescriptionStringProperty);let l=null,d=null;const c={keydown:y=>{if(this.enabledProperty.get()&&KeyboardUtils.isRangeKey(y.domEvent)){const m=y.domEvent;m.preventDefault(),m.metaKey||this._callbackTimer.isRunning()||(this._accessibleNumberSpinnerHandleKeyDown(y),l=this._accessibleNumberSpinnerHandleKeyDown.bind(this,y),d=m,this._callbackTimer.addCallback(l),this._callbackTimer.start())}},keyup:y=>{const m=KeyboardUtils.getEventCode(y.domEvent);KeyboardUtils.isRangeKey(y.domEvent)&&(d&&m===KeyboardUtils.getEventCode(d)&&(this._emitKeyState(y.domEvent,!1),this._callbackTimer.stop(!1),assert&&assert(l),this._callbackTimer.removeCallback(l),l=null,d=null),this.handleKeyUp(y))},blur:y=>{l&&(assert&&assert(d!==null,"key should be down if running downCallback"),this._emitKeyState(d,!1),this._callbackTimer.stop(!1),this._callbackTimer.removeCallback(l)),this.handleBlur(y)},input:this.handleInput.bind(this),change:this.handleChange.bind(this)};this.addInputListener(c),this._disposeAccessibleNumberSpinner=()=>{this._callbackTimer.dispose(),this.pdomIncrementDownEmitter.dispose(),this.pdomDecrementDownEmitter.dispose(),this.removeInputListener(c)}}set pdomTimerDelay(r){this._pdomTimerDelay=r,this._callbackTimer&&(this._callbackTimer.delay=r)}get pdomTimerDelay(){return this._pdomTimerDelay}set pdomTimerInterval(r){this._pdomTimerInterval=r,this._callbackTimer&&(this._callbackTimer.interval=r)}get pdomTimerInterval(){return this._pdomTimerInterval}_accessibleNumberSpinnerHandleKeyDown(r){assert&&assert(r.domEvent,"must have a domEvent"),this.handleKeyDown(r),this._emitKeyState(r.domEvent,!0)}_emitKeyState(r,s){validate(r,{valueType:Event}),KeyboardUtils.isAnyKeyEvent(r,[KeyboardUtils.KEY_UP_ARROW,KeyboardUtils.KEY_RIGHT_ARROW])?this.pdomIncrementDownEmitter.emit(s):KeyboardUtils.isAnyKeyEvent(r,[KeyboardUtils.KEY_DOWN_ARROW,KeyboardUtils.KEY_LEFT_ARROW])&&this.pdomDecrementDownEmitter.emit(s)}dispose(){this._disposeAccessibleNumberSpinner(),super.dispose()}});return t.prototype._mutatorKeys=ACCESSIBLE_NUMBER_SPINNER_OPTIONS.concat(t.prototype._mutatorKeys),assert&&assert(t.prototype._mutatorKeys.length===_.uniq(t.prototype._mutatorKeys).length,"duplicate mutator keys in AccessibleNumberSpinner"),t};sun.register("AccessibleNumberSpinner",AccessibleNumberSpinner);const sceneryPhetQueryParameters=QueryStringMachine.getAll({backgroundColor:{type:"string",defaultValue:"white"},fontFamily:{type:"string",defaultValue:"Arial"}});sceneryPhet.register("sceneryPhetQueryParameters",sceneryPhetQueryParameters);class PhetFont extends Font{constructor(e){assert&&assert(arguments.length===0||arguments.length===1,"Too many arguments");let t;typeof e=="number"||typeof e=="string"?t={size:e}:t=e||{},t=combineOptions({family:sceneryPhetQueryParameters.fontFamily},t),assert&&assert(t.family),t.family=[t.family,"sans-serif"].join(", "),super(t)}}sceneryPhet.register("PhetFont",PhetFont);const MathSymbols={PLUS:"+",MINUS:"−",TIMES:"×",DIVIDE:"÷",DOT:"⋅",UNARY_PLUS:"+",UNARY_MINUS:"-",EQUAL_TO:"=",NOT_EQUAL_TO:"≠",GREATER_THAN:">",LESS_THAN:"<",LESS_THAN_OR_EQUAL:"≤",GREATER_THAN_OR_EQUAL:"≥",PERCENT:"%",INFINITY:"∞",PI:"π",PLUS_MINUS:"±",THETA:"θ",NO_VALUE:"—",DEGREES:"°"};sceneryPhet.register("MathSymbols",MathSymbols);const ButtonStateValues=["up","down","over","out"];class NumberPicker extends AccessibleNumberSpinner(Node$2,0){constructor(e,t,n){var Mt,zt;const r=optionize()({color:new Color(0,0,255),backgroundColor:"white",cornerRadius:6,xMargin:3,yMargin:3,decimalPlaces:0,font:new PhetFont(24),incrementFunction:xt=>xt+1,decrementFunction:xt=>xt-1,timerDelay:400,timerInterval:100,noValueString:MathSymbols.NO_VALUE,align:"center",touchAreaXDilation:10,touchAreaYDilation:10,mouseAreaXDilation:0,mouseAreaYDilation:5,backgroundStroke:"gray",backgroundLineWidth:.5,arrowHeight:6,arrowYSpacing:3,arrowStroke:"black",arrowLineWidth:.25,valueMaxWidth:null,onInput:_.noop,incrementEnabledFunction:(xt,Gt)=>xt!=null&&xt<Gt.max,decrementEnabledFunction:(xt,Gt)=>xt!=null&&xt>Gt.min,disabledOpacity:SceneryConstants.DISABLED_OPACITY,valueChangedSoundPlayer:generalSoftClickSoundPlayer,boundarySoundPlayer:generalBoundaryBoopSoundPlayer,cursor:"pointer",valueProperty:e,enabledRangeProperty:t,pageKeyboardStep:2,voicingObjectResponse:()=>e.value,tandem:Tandem.REQUIRED,tandemNameSuffix:"Picker",phetioReadOnly:PhetioObject.DEFAULT_OPTIONS.phetioReadOnly,visiblePropertyOptions:{phetioFeatured:!0},phetioEnabledPropertyInstrumented:!0,phetioFeatured:!0},n);r.formatValue||(r.formatValue=xt=>DotUtils.toFixed(xt,r.decimalPlaces));let s=null;r.pressedColor===void 0&&(s=new PaintColorProperty(r.color),r.pressedColor=new DerivedProperty([s],xt=>xt.darkerColor()));let a=e.value;const l=r.onInput;r.onInput=()=>{l(),e.value!==a&&(e.value===t.get().max||e.value===t.get().min?r.boundarySoundPlayer.play():r.valueChangedSoundPlayer.play()),a=e.value},assert&&assert(!r.keyboardStep,"NumberPicker sets its own keyboardStep"),assert&&assert(!r.shiftKeyboardStep,"NumberPicker sets its own shiftKeyboardStep");const d=r.incrementFunction(e.get())-e.get();r.keyboardStep=d,r.shiftKeyboardStep=d,r.pdomTimerDelay=r.timerDelay,r.pdomTimerInterval=r.timerInterval;const c=_.pick(r,Node$2.REQUIRES_BOUNDS_OPTION_KEYS);super(_.omit(r,Node$2.REQUIRES_BOUNDS_OPTION_KEYS));const y=new StringUnionProperty("up",{validValues:ButtonStateValues}),m=new StringUnionProperty("down",{validValues:ButtonStateValues}),O=new DerivedProperty([e,t],r.incrementEnabledFunction),D=new DerivedProperty([e,t],r.decrementEnabledFunction),z=new Text("",{font:r.font,pickable:!1});let w=t.get().min;const N=[];for(;w<=t.get().max;)N.push(w),w=r.incrementFunction(w),assert&&assert(N.length<5e5,"Don't infinite loop here");let H=Math.max.apply(null,N.map(xt=>(z.string=r.formatValue(xt),z.width)));r.valueMaxWidth!==null&&(H=Math.min(H,r.valueMaxWidth));const X=H+2*r.xMargin,ae=z.height+2*r.yMargin,oe=1,ue=r.cornerRadius;z.maxWidth=H;const fe=new Path(new Shape$1().arc(ue,ue,ue,Math.PI,Math.PI*3/2,!1).arc(X-ue,ue,ue,-Math.PI/2,0,!1).lineTo(X,ae/2+oe).lineTo(0,ae/2+oe).close(),{pickable:!1}),be=new Path(new Shape$1().arc(X-ue,ae-ue,ue,0,Math.PI/2,!1).arc(ue,ae-ue,ue,Math.PI/2,Math.PI,!1).lineTo(0,ae/2).lineTo(X,ae/2).close(),{pickable:!1}),Ae=new Rectangle(0,0,X,ae,ue,ue,{pickable:!1,stroke:r.backgroundStroke,lineWidth:r.backgroundLineWidth}),W=new Dimension2(.5*X,r.arrowHeight),J={stroke:r.arrowStroke,lineWidth:r.arrowLineWidth,pickable:!1};this.incrementArrow=new Path(new Shape$1().moveTo(W.width/2,0).lineTo(W.width,W.height).lineTo(0,W.height).close(),J),this.incrementArrow.centerX=fe.centerX,this.incrementArrow.bottom=fe.top-r.arrowYSpacing,this.decrementArrow=new Path(new Shape$1().moveTo(W.width/2,W.height).lineTo(0,0).lineTo(W.width,0).close(),J),this.decrementArrow.centerX=be.centerX,this.decrementArrow.top=be.bottom+r.arrowYSpacing;const Ue=new Node$2({children:[fe,this.incrementArrow]});Ue.addChild(new Rectangle(Ue.localBounds));const gt=new Node$2({children:[be,this.decrementArrow]});gt.addChild(new Rectangle(gt.localBounds)),this.addChild(Ue),this.addChild(gt),this.addChild(Ae),this.addChild(z),Ue.touchArea=Shape$1.rectangle(Ue.left-r.touchAreaXDilation/2,Ue.top-r.touchAreaYDilation,Ue.width+r.touchAreaXDilation,Ue.height+r.touchAreaYDilation),gt.touchArea=Shape$1.rectangle(gt.left-r.touchAreaXDilation/2,gt.top,gt.width+r.touchAreaXDilation,gt.height+r.touchAreaYDilation),Ue.mouseArea=Shape$1.rectangle(Ue.left-r.mouseAreaXDilation/2,Ue.top-r.mouseAreaYDilation,Ue.width+r.mouseAreaXDilation,Ue.height+r.mouseAreaYDilation),gt.mouseArea=Shape$1.rectangle(gt.left-r.mouseAreaXDilation/2,gt.top,gt.width+r.mouseAreaXDilation,gt.height+r.mouseAreaYDilation);const Te={up:r.color,over:r.color,down:r.pressedColor,out:r.color,disabled:"rgb(176,176,176)"},Et=createVerticalGradient(r.color,r.backgroundColor,r.color,ae),Bt=createVerticalGradient(r.pressedColor,r.backgroundColor,r.pressedColor,ae),Ke={up:r.backgroundColor,over:Et,down:Bt,out:Bt,disabled:r.backgroundColor},At={fireOnHold:!0,fireOnHoldDelay:r.timerDelay,fireOnHoldInterval:r.timerInterval};this.incrementInputListener=new NumberPickerInputListener(y,combineOptions({tandem:r.tandem.createTandem("incrementInputListener"),fire:xt=>{e.set(Math.min(r.incrementFunction(e.get()),t.get().max)),r.onInput(xt),this.voicingSpeakFullResponse({nameResponse:null,hintResponse:null})}},At)),Ue.addInputListener(this.incrementInputListener),this.decrementInputListener=new NumberPickerInputListener(m,combineOptions({tandem:r.tandem.createTandem("decrementInputListener"),fire:xt=>{e.set(Math.max(r.decrementFunction(e.get()),t.get().min)),r.onInput(xt),this.voicingSpeakFullResponse({nameResponse:null,hintResponse:null})}},At)),gt.addInputListener(this.decrementInputListener),O.link(xt=>{!xt&&this.incrementInputListener.interrupt(),Ue.pickable=xt}),D.link(xt=>{!xt&&this.decrementInputListener.interrupt(),gt.pickable=xt});const nt=xt=>{if(xt==null)z.string=r.noValueString,z.x=(X-z.width)/2;else if(z.string=r.formatValue(xt),r.align==="center")z.centerX=fe.centerX;else if(r.align==="right")z.right=fe.right-r.xMargin;else if(r.align==="left")z.left=fe.left+r.xMargin;else throw new Error(`unsupported value for options.align: ${r.align}`);z.centerY=ae/2};e.link(nt),Multilink.multilink([y,O],(xt,Gt)=>{updateColors(xt,Gt,fe,this.incrementArrow,Ke,Te)}),Multilink.multilink([m,D],(xt,Gt)=>{updateColors(xt,Gt,be,this.decrementArrow,Ke,Te)});const dt=this.localBounds.dilated(HighlightPath$1.getDilationCoefficient(this));this.focusHighlight=new HighlightPath$1(Shape$1.roundedRectangleWithRadii(dt.minX,dt.minY,dt.width,dt.height,{topLeft:r.cornerRadius,topRight:r.cornerRadius,bottomLeft:r.cornerRadius,bottomRight:r.cornerRadius})),this.pdomIncrementDownEmitter.addListener(xt=>{y.value=xt?"down":"up"}),this.pdomDecrementDownEmitter.addListener(xt=>{m.value=xt?"down":"up"}),this.addLinkedElement(e,{tandemName:"valueProperty"}),this.mutate(c),this.disposeNumberPicker=()=>{s&&s.dispose(),O.dispose(),D.dispose(),e.hasListener(nt)&&e.unlink(nt)},assert&&((zt=(Mt=phet==null?void 0:phet.chipper)==null?void 0:Mt.queryParameters)!=null&&zt.binder)&&InstanceRegistry.registerDataURL("scenery-phet","NumberPicker",this)}static createIcon(e,t){const n=optionize()({highlightIncrement:!1,highlightDecrement:!1,range:new Range(e-1,e+1),numberPickerOptions:{pickable:!1,tandem:Tandem.OPT_OUT}},t),r=new NumberPicker(new NumberProperty(e),new Property(n.range),n.numberPickerOptions);return r.removeFromPDOM(),n.highlightDecrement&&(r.decrementInputListener.isOverProperty.value=!0),n.highlightIncrement&&(r.incrementInputListener.isOverProperty.value=!0),r}dispose(){this.disposeNumberPicker(),super.dispose()}setArrowsVisible(e){e||(this.incrementInputListener.interrupt(),this.decrementInputListener.interrupt()),this.incrementArrow.visible=e,this.decrementArrow.visible=e}}class NumberPickerInputListener extends FireListener{constructor(e,t){super(t),Multilink.multilink([this.isOverProperty,this.isPressedProperty],(n,r)=>{e.set(n&&!r?"over":n&&r?"down":!n&&!r?"up":"out")})}}function createVerticalGradient(o,e,t,n){return new LinearGradient(0,0,0,n).addColorStop(0,o).addColorStop(.5,e).addColorStop(1,t)}function updateColors(o,e,t,n,r,s){if(e)if(n.stroke="black",o==="up")t.fill=r.up,n.fill=s.up;else if(o==="over")t.fill=r.over,n.fill=s.over;else if(o==="down")t.fill=r.down,n.fill=s.down;else if(o==="out")t.fill=r.out,n.fill=s.out;else throw new Error(`unsupported buttonState: ${o}`);else t.fill=r.disabled,n.fill=s.disabled,n.stroke=s.disabled}sun.register("NumberPicker",NumberPicker);const DEFAULT_FONT=new PhetFont(20),ALIGN_VALUES=["center","left","right"],DEFAULT_DECIMAL_PLACES=0,Xl=class Xl extends Node$2{constructor(e,t,n){var oe,ue,fe,be;const r=optionize()({align:"right",valuePattern:SunConstants.VALUE_NAMED_PLACEHOLDER,decimalPlaces:DEFAULT_DECIMAL_PLACES,numberFormatter:null,numberFormatterDependencies:[],useRichText:!1,useFullHeight:!1,textOptions:{font:DEFAULT_FONT,fill:"black",maxWidth:null,phetioReadOnly:!0},xMargin:8,yMargin:2,cornerRadius:0,backgroundFill:"white",backgroundStroke:"lightGray",backgroundLineWidth:1,backgroundLineDash:[],minBackgroundWidth:0,noValueString:MathSymbols.NO_VALUE,noValueAlign:null,noValuePattern:null,tandem:Tandem.OPT_OUT,phetioType:Xl.NumberDisplayIO},n);if(assert){const Ae=!!r.numberFormatter,W=r.decimalPlaces!==DEFAULT_DECIMAL_PLACES,J=r.valuePattern!==SunConstants.VALUE_NAMED_PLACEHOLDER,Ue=W||J;(Ae||Ue)&&assert&&assert(Ae!==Ue,"options.numberFormatter is mutually exclusive with options.valuePattern and options.decimalPlaces")}const s=new TinyProperty(r.numberFormatter?r.numberFormatter:Ae=>r.decimalPlaces===null?`${Ae}`:DotUtils.toFixed(Ae,r.decimalPlaces));assert&&assert(!r.hasOwnProperty("unitsNode"),"unitsNode is not a supported option"),assert&&assert(_.includes(ALIGN_VALUES,r.align),`invalid align: ${r.align}`),r.noValueAlign||(r.noValueAlign=r.align),assert&&assert(_.includes(ALIGN_VALUES,r.noValueAlign),`invalid noValueAlign: ${r.noValueAlign}`),assert&&assert(r.textOptions,"did you accidentally set textOptions to null?");const a=Ae=>Ae.includes(SunConstants.VALUE_NUMBERED_PLACEHOLDER)?StringUtils.format(Ae,SunConstants.VALUE_NAMED_PLACEHOLDER):Ae,l=typeof r.valuePattern=="string"?new TinyProperty(a(r.valuePattern)):new DerivedProperty([r.valuePattern],a);assert&&assert(!!((ue=(oe=phet==null?void 0:phet.chipper)==null?void 0:oe.queryParameters)!=null&&ue.stringTest)||l.value.includes(SunConstants.VALUE_NAMED_PLACEHOLDER),`missing value placeholder in options.valuePattern: ${l.value}`),r.noValuePattern||(r.noValuePattern=new DerivedProperty([l],Ae=>Ae));const d=typeof r.noValuePattern=="string"?new TinyProperty(r.noValuePattern):r.noValuePattern;assert&&assert(!!((be=(fe=phet==null?void 0:phet.chipper)==null?void 0:fe.queryParameters)!=null&&be.stringTest)||d.value.includes(SunConstants.VALUE_NAMED_PLACEHOLDER),`missing value placeholder in options.noValuePattern: ${d.value}`);const c=DerivedProperty.deriveAny([s,...r.numberFormatterDependencies],()=>valueToString(t.min,r.noValueString,s.value)),y=DerivedProperty.deriveAny([s,...r.numberFormatterDependencies],()=>valueToString(t.max,r.noValueString,s.value)),m=new DerivedProperty([l,c,y],(Ae,W,J)=>StringUtils.fillIn(Ae,{value:W.length>J.length?W:J})),O=r.useRichText?RichText:Text,D=r.textOptions.tandem||r.tandem.createTandem("valueText"),z=DerivedProperty.deriveAny([e,d,l,s,...r.numberFormatterDependencies],()=>{const Ae=e.value,W=d.value,J=l.value,Ue=s.value,gt=Ae===null&&W?W:J,Te=valueToString(Ae,r.noValueString,Ue);return StringUtils.fillIn(gt,{value:Te})},{phetioFeatured:!0,phetioValueType:StringIO,tandemNameSuffix:"StringProperty",tandem:D.createTandem(Text.STRING_PROPERTY_TANDEM_NAME)}),w=combineOptions({tandem:D},r.textOptions,{maxWidth:null}),N=new O(z,w),H=N.height,X=new Rectangle({cornerRadius:r.cornerRadius,fill:r.backgroundFill,stroke:r.backgroundStroke,lineWidth:r.backgroundLineWidth,lineDash:r.backgroundLineDash});m.link(Ae=>{const W=new O(Ae,_.omit(w,"tandem"));N.maxWidth=r.textOptions.maxWidth!==null?r.textOptions.maxWidth:W.width!==0?W.width:null,W.maxWidth=N.maxWidth,X.rectWidth=Math.max(r.minBackgroundWidth,W.width+2*r.xMargin),X.rectHeight=(r.useFullHeight?H:W.height)+2*r.yMargin});const ae=new Node$2({children:[N]});r.children=[X,ae],super(),this.numberFormatterProperty=s,this.valueText=N,this.backgroundNode=X,ManualConstraint.create(this,[ae,X],(Ae,W)=>{const J=e.value===null?r.noValueAlign:r.align,Ue=W.centerY;J==="center"?Ae.center=new Vector2(W.centerX,Ue):J==="left"?Ae.leftCenter=new Vector2(W.left+r.xMargin,Ue):Ae.rightCenter=new Vector2(W.right-r.xMargin,Ue)}),this.mutate(r),this.disposeNumberDisplay=()=>{z.dispose(),l.dispose()}}dispose(){this.disposeNumberDisplay(),super.dispose()}setNumberFont(e){this.valueText.font=e}set numberFont(e){this.setNumberFont(e)}setNumberFill(e){this.valueText.fill=e}set numberFill(e){this.setNumberFill(e)}setBackgroundFill(e){this.backgroundNode.fill=e}set backgroundFill(e){this.setBackgroundFill(e)}get backgroundFill(){return this.getBackgroundFill()}getBackgroundFill(){return this.backgroundNode.fill}setBackgroundStroke(e){this.backgroundNode.stroke=e}set backgroundStroke(e){this.setBackgroundStroke(e)}getBackgroundWidth(){return this.backgroundNode.getRectWidth()}setBackgroundWidth(e){this.backgroundNode.setRectWidth(e)}get backgroundWidth(){return this.getBackgroundWidth()}set backgroundWidth(e){this.setBackgroundWidth(e)}};Xl.NumberDisplayIO=new IOType("NumberDisplayIO",{valueType:Xl,supertype:Node$2.NodeIO,documentation:"A numeric readout with a background"});let NumberDisplay=Xl;sceneryPhet.register("NumberDisplay",NumberDisplay);const valueToString=(o,e,t)=>{let n=e;return o!==null&&(n=t(o)),n},DEFAULT_ARROW_HEIGHT=20;class ArrowButton extends RectangularPushButton{constructor(e,t,n){const r=optionize()({cursor:"pointer",baseColor:"white",stroke:"black",lineWidth:1,cornerRadius:4,xMargin:7,yMargin:5,touchAreaXDilation:7,touchAreaYDilation:7,arrowHeight:DEFAULT_ARROW_HEIGHT,arrowWidth:DEFAULT_ARROW_HEIGHT*Math.sqrt(3)/2,arrowFill:"black",arrowStroke:null,arrowLineWidth:1,numberOfArrows:1,arrowSpacing:-DEFAULT_ARROW_HEIGHT*.5,fireOnHold:!0,fireOnHoldDelay:400,fireOnHoldInterval:100,startCallback:_.noop,endCallback:_.noop},n);r.listener=t;const s=new Shape$1;for(let a=0;a<r.numberOfArrows;a++){const l=a*(r.arrowHeight+r.arrowSpacing);if(e==="up")s.moveTo(r.arrowHeight/2,l).lineTo(r.arrowHeight,r.arrowWidth+l).lineTo(0,r.arrowWidth+l).close();else if(e==="down")s.moveTo(0,l).lineTo(r.arrowHeight,l).lineTo(r.arrowHeight/2,r.arrowWidth+l).close();else if(e==="left")s.moveTo(l,r.arrowHeight/2).lineTo(r.arrowWidth+l,0).lineTo(r.arrowWidth+l,r.arrowHeight).close();else if(e==="right")s.moveTo(l,0).lineTo(r.arrowWidth+l,r.arrowHeight/2).lineTo(l,r.arrowHeight).close();else throw new Error(`unsupported direction: ${e}`)}r.content=new Path(s,{fill:r.arrowFill,stroke:r.arrowStroke,lineWidth:r.arrowLineWidth,pickable:!1}),super(r)}}sun.register("ArrowButton",ArrowButton);class NumberSpinner extends AccessibleNumberSpinner(Node$2,0){constructor(e,t,n){var ae,oe;assert&&assert(t.value.contains(e.get()),`value ${e.get()} is out of range ${t.value.toString()}`);const r=optionize()({arrowsSoundPlayer:pushButtonSoundPlayer,arrowsPosition:"bothRight",arrowsScale:null,arrowButtonFill:"white",arrowButtonStroke:"black",arrowButtonLineWidth:1,deltaValue:1,xSpacing:5,ySpacing:3,numberDisplayOptions:{cornerRadius:5,backgroundStroke:"black"},touchAreaXDilation:0,touchAreaYDilation:0,mouseAreaXDilation:0,mouseAreaYDilation:0,valueProperty:e,enabledRangeProperty:t,disabledOpacity:SceneryConstants.DISABLED_OPACITY,interactiveHighlight:"invisible",tandem:Tandem.REQUIRED,tandemNameSuffix:"Spinner",phetioFeatured:!0,phetioEnabledPropertyInstrumented:!0},n),s=r.incrementFunction||(ue=>ue+r.deltaValue),a=r.decrementFunction||(ue=>ue-r.deltaValue),l=new NumberDisplay(e,t.value,combineOptions({tandem:r.tandem.createTandem("numberDisplay")},r.numberDisplayOptions)),d={baseColor:r.arrowButtonFill,stroke:r.arrowButtonStroke,lineWidth:r.arrowButtonLineWidth,focusable:!1,soundPlayer:r.arrowsSoundPlayer,enabledPropertyOptions:{phetioReadOnly:!0,phetioFeatured:!1}},c=new ArrowButton(r.arrowsPosition==="topBottom"||r.arrowsPosition==="bothRight"?"up":"right",()=>e.set(s(e.get())),combineOptions({tandem:r.tandem.createTandem("incrementButton")},d)),y=new ArrowButton(r.arrowsPosition==="topBottom"||r.arrowsPosition==="bothRight"?"down":"left",()=>e.set(a(e.get())),combineOptions({tandem:r.tandem.createTandem("decrementButton")},d));let m;m||(r.arrowsPosition==="leftRight"?m=l.height/c.height:r.arrowsPosition==="topBottom"?m=l.width/c.width:r.arrowsPosition==="bothRight"?m=(l.height/2-r.ySpacing/2)/c.height:m=(l.width/2-r.xSpacing/2)/c.width),r.arrowsScale&&(m=m*r.arrowsScale),c.setScaleMagnitude(m),y.setScaleMagnitude(m);const O=()=>{r.arrowsPosition==="leftRight"?(c.left=l.right+r.xSpacing,y.right=l.left-r.xSpacing,c.centerY=y.centerY=l.centerY):r.arrowsPosition==="topBottom"?(c.centerX=y.centerX=l.centerX,c.bottom=l.top-r.ySpacing,y.top=l.bottom+r.ySpacing):r.arrowsPosition==="bothRight"?(c.left=y.left=l.right+r.xSpacing,c.bottom=l.centerY-r.ySpacing/2,y.top=l.centerY+r.ySpacing/2):(c.left=l.centerX+r.xSpacing/2,y.right=l.centerX-r.xSpacing/2,c.top=y.top=l.bottom+r.ySpacing)};l.boundsProperty.link(()=>O()),(r.touchAreaXDilation||r.touchAreaYDilation)&&(c.touchArea=c.localBounds.dilatedXY(r.touchAreaXDilation,r.touchAreaYDilation),y.touchArea=y.localBounds.dilatedXY(r.touchAreaXDilation,r.touchAreaYDilation),r.arrowsPosition==="bothRight"?(c.touchArea=c.touchArea.shiftedY(-r.touchAreaYDilation),y.touchArea=y.touchArea.shiftedY(r.touchAreaYDilation)):r.arrowsPosition==="bothBottom"&&(c.touchArea=c.touchArea.shiftedX(r.touchAreaXDilation),y.touchArea=y.touchArea.shiftedX(-r.touchAreaXDilation))),(r.mouseAreaXDilation||r.mouseAreaYDilation)&&(c.mouseArea=c.localBounds.dilatedXY(r.mouseAreaXDilation,r.mouseAreaYDilation),y.mouseArea=y.localBounds.dilatedXY(r.mouseAreaXDilation,r.mouseAreaYDilation),r.arrowsPosition==="bothRight"?(c.mouseArea=c.mouseArea.shiftedY(-r.mouseAreaYDilation),y.mouseArea=y.mouseArea.shiftedY(r.mouseAreaYDilation)):r.arrowsPosition==="bothBottom"&&(c.mouseArea=c.mouseArea.shiftedX(r.mouseAreaXDilation),y.mouseArea=y.mouseArea.shiftedX(-r.mouseAreaXDilation))),r.children=[l,c,y],assert&&assert(r.keyboardStep===void 0,"NumberSpinner sets keyboardStep, it will be the same as deltaValue"),assert&&assert(r.shiftKeyboardStep===void 0,"NumberSpinner sets shiftKeyboardStep, it will be the same as deltaValue"),assert&&assert(r.pageKeyboardStep===void 0,"NumberSpinner sets pageKeyboardStep, it should not be used with NumberSpinner"),r.keyboardStep=0,r.shiftKeyboardStep=0,r.pageKeyboardStep=0;const D=_.pick(r,Node$2.REQUIRES_BOUNDS_OPTION_KEYS);super(_.omit(r,Node$2.REQUIRES_BOUNDS_OPTION_KEYS));const z=()=>{c.enabled=s(e.value)<=t.value.max,y.enabled=a(e.value)>=t.value.min},w=ue=>{assert&&assert(t.value.contains(ue),`value out of range: ${ue}`),z()};e.link(w);const N=ue=>{e.value=ue.constrainValue(e.value),z()};t.link(N);const H=ue=>ue&&c.pdomClick(),X=ue=>ue&&y.pdomClick();this.pdomIncrementDownEmitter.addListener(H),this.pdomDecrementDownEmitter.addListener(X),this.disposeNumberSpinner=()=>{l.dispose(),c.dispose(),y.dispose(),this.pdomIncrementDownEmitter.removeListener(H),this.pdomDecrementDownEmitter.removeListener(X),e.unlink(w),t.unlink(N)},this.mutate(D),this.numberDisplay=l,this.addLinkedElement(e,{tandemName:"property"}),assert&&((oe=(ae=phet==null?void 0:phet.chipper)==null?void 0:ae.queryParameters)!=null&&oe.binder)&&InstanceRegistry.registerDataURL("sun","NumberSpinner",this)}dispose(){this.disposeNumberSpinner(),super.dispose()}}sun.register("NumberSpinner",NumberSpinner);class OnOffSwitch extends ToggleSwitch{constructor(e,t){const n=optionize()({trackFillLeft:"white",trackFillRight:"rgb( 0, 200, 0 )"},t);super(e,!1,!0,n)}}sun.register("OnOffSwitch",OnOffSwitch);const soundURI$1="data:audio/mpeg;base64,//swxAAABognHnWRADEriei3OrACCEgYAPOkFXghY6uD++Piw3kA4B4y7hchMBxIxLKSksCwfB8Hw+7wfB8H3/E4P+GP/++D58AABoNsRiAAegAAAcAAwfGEzHKEwATU0FYIw6Dg+OLEOCqwYUAazcxYAwgAWZl5g4CTyjQM3o0EQLO/PjeedH/0g7/quk7v////9CoAAgKS3agA//syxAOACFhpYb2WADkFBWUpz2ROAUr4AUY00DNWPwkiueFpjWamdXncJm4WSUvPYHtdLyIybUkqNbEdOAeIJqJS89odMGRdRGULsKEKKu9sAAFgQA2oDCIoIgGYfBxqSpmFgSkaq7FxnJizGCsESGsoBS/52SlqFCkhXIYlBMPwLKiSRYVd1f///7f/lUfvy2gAAL45ZHAEVS5wEP/7MsQFgkd0HRVM9wJwooOhqMw8TrAOxggWZrdB4KswIKoWwjoMDKpkDpawRH8EDMvQbb5c2fQ5IXBwEGakBD9/3/5ub1lQm4/cLYHDTARtPRS+xTotNKqDqFAVBUFeVBUFU4lBYO8sDQNB3iIGqkxBTUUzLjk5LjWqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+zLEFwPAAAGkAAAAIAAANIAAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//swxFsDwAABpAAAACAAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//syxJ6DwAABpAAAACAAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqg==",soundByteArray$1=base64SoundToByteArray(phetAudioContext$1,soundURI$1),unlock$1=asyncLoader.createLock(soundURI$1),wrappedAudioBuffer$1=new WrappedAudioBuffer;let unlocked$1=!1;const safeUnlock$1=()=>{unlocked$1||(unlock$1(),unlocked$1=!0)},onDecodeSuccess$1=o=>{wrappedAudioBuffer$1.audioBufferProperty.value===null&&(wrappedAudioBuffer$1.audioBufferProperty.set(o),safeUnlock$1())},onDecodeError$1=o=>{console.warn("decode of audio data failed, using stubbed sound, error: "+o),wrappedAudioBuffer$1.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$1()},decodePromise$1=phetAudioContext$1.decodeAudioData(soundByteArray$1.buffer,onDecodeSuccess$1,onDecodeError$1);decodePromise$1&&decodePromise$1.then(o=>{wrappedAudioBuffer$1.audioBufferProperty.value===null&&(wrappedAudioBuffer$1.audioBufferProperty.set(o),safeUnlock$1())}).catch(o=>{console.warn("promise rejection caught for audio decode, error = "+o),safeUnlock$1()});const soundURI="data:audio/mpeg;base64,//swxAAABpAhE1WQgDEChGf3OiJCAAAJRgWMA3lCIUyXzv3PfM52Qw9nimjE2HsTh+X09sHwQBB10u/y4e//+gEAQ5cP/u//4nAABASEQsFsvw9GFpIAMRiGNLEgMlRmNb+1MIjHNu4KFilyMxQYzAAc3e/P+566F6J7olttvvTZ9lv1/6++U+z1qgAJHLdLYAABaRtXAaLgn8Bq//syxAiAiaBvUb22ADjOA6MNz+wKcSQr2BxEgs/qJ0XkEPODBEPhEBEOh7HwdhJLwTjcKQmIaxUepm3yySi6sRnp0hr1J8lYfUroW0RJYrMlFAAMN5mqFGCchxplBCFCZuwLfmAFg8RsPKaZAGhqJlpCZMCBA+iTjFW///////Xb//1B2gACzEgggAM2IOQFMKEH4x1EgzS0KJMJgP/7MsQMAkZUGwtNe0BwqQNgNawkjoI6rU0xQyo8AgUADX4Q45so+ubX4c/Qr//w0AVA5axJGw1awwFk8Bk0bAWushk77jjeDg6Vcjgr38sDQNfUJZ3KgqCoK0xBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+zLEIYPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//swxGWDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy45OS41VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//syxKkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy45OS41VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7MsS7g8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+zLEu4PAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//swxLwDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",soundByteArray=base64SoundToByteArray(phetAudioContext$1,soundURI),unlock=asyncLoader.createLock(soundURI),wrappedAudioBuffer=new WrappedAudioBuffer;let unlocked=!1;const safeUnlock=()=>{unlocked||(unlock(),unlocked=!0)},onDecodeSuccess=o=>{wrappedAudioBuffer.audioBufferProperty.value===null&&(wrappedAudioBuffer.audioBufferProperty.set(o),safeUnlock())},onDecodeError=o=>{console.warn("decode of audio data failed, using stubbed sound, error: "+o),wrappedAudioBuffer.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock()},decodePromise=phetAudioContext$1.decodeAudioData(soundByteArray.buffer,onDecodeSuccess,onDecodeError);decodePromise&&decodePromise.then(o=>{wrappedAudioBuffer.audioBufferProperty.value===null&&(wrappedAudioBuffer.audioBufferProperty.set(o),safeUnlock())}).catch(o=>{console.warn("promise rejection caught for audio decode, error = "+o),safeUnlock()});const DEFAULT_DRAG_CLIP_OPTIONS$1={initialOutputLevel:.4};class RichDragListener extends DragListener{constructor(e){const t=optionize()({grabSound:wrappedAudioBuffer$1,releaseSound:wrappedAudioBuffer,grabSoundClipOptions:DEFAULT_DRAG_CLIP_OPTIONS$1,releaseSoundClipOptions:DEFAULT_DRAG_CLIP_OPTIONS$1},e);let n;if(t.grabSound){n=new SoundClip(t.grabSound,t.grabSoundClipOptions),soundManager.addSoundGenerator(n);const s=t.start;t.start=(...a)=>{s&&s(...a),n.play()}}let r;if(t.releaseSound){r=new SoundClip(t.releaseSound,t.releaseSoundClipOptions),soundManager.addSoundGenerator(r);const s=t.end;t.end=(...a)=>{s&&s(...a),r.play()}}super(t),this.disposeEmitter.addListener(()=>{n&&(n.dispose(),soundManager.removeSoundGenerator(n)),r&&(r.dispose(),soundManager.removeSoundGenerator(r))})}}sun.register("RichDragListener",RichDragListener);const DEFAULT_DRAG_CLIP_OPTIONS={initialOutputLevel:.4};class RichKeyboardDragListener extends KeyboardDragListener$1{constructor(e){const t=optionize()({grabSound:wrappedAudioBuffer$1,releaseSound:wrappedAudioBuffer,grabSoundClipOptions:DEFAULT_DRAG_CLIP_OPTIONS,releaseSoundClipOptions:DEFAULT_DRAG_CLIP_OPTIONS},e);let n;if(t.grabSound){n=new SoundClip(t.grabSound,t.grabSoundClipOptions),soundManager.addSoundGenerator(n);const s=t.start;t.start=(...a)=>{s&&s(...a),n.play()}}let r;if(t.releaseSound){r=new SoundClip(t.releaseSound,t.releaseSoundClipOptions),soundManager.addSoundGenerator(r);const s=t.end;t.end=(...a)=>{s&&s(...a),r.play()}}super(t),this.disposeEmitter.addListener(()=>{n&&(n.dispose(),soundManager.removeSoundGenerator(n)),r&&(r.dispose(),soundManager.removeSoundGenerator(r))})}}sun.register("RichKeyboardDragListener",RichKeyboardDragListener);const sunQueryParameters=QueryStringMachine.getAll({backgroundColor:{type:"string",defaultValue:"white"},component:{type:"string",defaultValue:null},layout:{type:"string",defaultValue:"Width of multiple panels"}});sun.register("sunQueryParameters",sunQueryParameters);class VerticalAquaRadioButtonGroup extends AquaRadioButtonGroup{constructor(e,t,n){super(e,t,optionize()({orientation:"vertical",align:"left"},n))}}sun.register("VerticalAquaRadioButtonGroup",VerticalAquaRadioButtonGroup);class VerticalCheckboxGroup extends VBox{constructor(e,t){const n=optionize()({touchAreaXDilation:5,mouseAreaXDilation:5,spacing:10,align:"left",stretch:!0,tandem:Tandem.REQUIRED},t),r=getGroupItemNodes(e,n.tandem),s=[];n.children=[];for(let a=0;a<e.length;a++){const l=e[a],d=r[a];assert&&assert(!d.hasPDOMContent,"Accessibility is provided by Checkbox and VerticalCheckboxGroupItem.options. Additional PDOM content in the provided Node could break accessibility.");const c=n.spacing/2;assert&&assert(!l.tandem,"Cannot specify tandem on item, use tandemName instead");const y=new Checkbox(l.property,d,combineOptions({tandem:l.tandemName?n.tandem.createTandem(l.tandemName):Tandem.OPTIONAL,mouseAreaXDilation:n.mouseAreaXDilation,touchAreaXDilation:n.touchAreaXDilation,mouseAreaYDilation:c,touchAreaYDilation:c},n.checkboxOptions,l.options));s.push(y),n.children.push(y)}super(n),this.disposeVerticalCheckboxGroup=()=>{s.forEach(a=>a.dispose()),r.forEach(a=>a.dispose())}}dispose(){this.disposeVerticalCheckboxGroup(),super.dispose()}}sun.register("VerticalCheckboxGroup",VerticalCheckboxGroup);class VSlider extends Slider{constructor(e,t,n){var r,s;n=optionize()({orientation:Orientation.VERTICAL},n),super(e,t,n),assert&&((s=(r=phet==null?void 0:phet.chipper)==null?void 0:r.queryParameters)!=null&&s.binder)&&InstanceRegistry.registerDataURL("sun","VSlider",this)}}sun.register("VSlider",VSlider);class StickyToggleButtonInteractionStateProperty extends DerivedProperty5{constructor(e){super([e.focusedProperty,e.overProperty,e.looksOverProperty,e.looksPressedProperty,e.valueProperty],(t,n,r,s,a)=>{const l=a===e.valueDown;return r&&!(s||l)?ButtonInteractionState.OVER:(n||t)&&(s||l)||l?ButtonInteractionState.PRESSED:ButtonInteractionState.IDLE},{valueType:ButtonInteractionState})}}sun.register("StickyToggleButtonInteractionStateProperty",StickyToggleButtonInteractionStateProperty);class StickyToggleButtonModel extends ButtonModel{constructor(e,t,n,r){const s=optionize()({tandem:Tandem.REQUIRED},r);super(s),this.valueUp=e,this.valueDown=t,this.valueProperty=n,this.toggledEmitter=new Emitter({tandem:s.tandem.createTandem("toggledEmitter"),phetioDocumentation:"Emits when the button is toggled",phetioEventType:EventType.USER}),this.toggledEmitter.addListener(()=>{assert&&assert(this.valueProperty.value===this.valueUp||this.valueProperty.value===this.valueDown,`unrecognized value: ${this.valueProperty.value}`),this.valueProperty.value=this.valueProperty.value===this.valueUp?this.valueDown:this.valueUp}),this.pressedWhileDownProperty=new BooleanProperty(!1);const a=c=>{const y=this.overProperty.get()||this.focusedProperty.get();this.enabledProperty.get()&&y&&!this.interrupted&&(c&&n.value===e&&(this.toggle(),this.pressedWhileDownProperty.set(!1)),!c&&n.value===t&&(this.pressedWhileDownProperty.get()?this.toggle():this.pressedWhileDownProperty.set(!0))),!c&&!y&&this.pressedWhileDownProperty.set(!0)};this.downProperty.link(a);const l=c=>{this.downProperty.set(c===t)};n.link(l);const d=c=>{c&&this.pressedWhileDownProperty.set(!0)};this.enabledProperty.link(d),this.disposeToggleButtonModel=()=>{this.downProperty.unlink(a),this.enabledProperty.unlink(d),n.unlink(l),this.toggledEmitter.dispose()}}dispose(){this.disposeToggleButtonModel(),super.dispose()}toggle(){this.toggledEmitter.emit(),this.produceSoundEmitter.emit()}}sun.register("StickyToggleButtonModel",StickyToggleButtonModel);class RectangularStickyToggleButton extends RectangularButton{constructor(e,t,n,r){const s=new StickyToggleButtonModel(t,n,e,r),a=new StickyToggleButtonInteractionStateProperty(s);super(s,a,r),this.disposeRectangularStickyToggleButton=()=>{s.dispose()}}dispose(){this.disposeRectangularStickyToggleButton(),super.dispose()}}sun.register("RectangularStickyToggleButton",RectangularStickyToggleButton);class BooleanRectangularStickyToggleButton extends RectangularStickyToggleButton{constructor(e,t){super(e,!1,!0,t)}}sun.register("BooleanRectangularStickyToggleButton",BooleanRectangularStickyToggleButton);const HIGHLIGHT_GRADIENT_LENGTH=5;class RoundButton extends ButtonNode{constructor(e,t,n){const r=optionize()({radius:n&&n.content?null:30,lineWidth:.5,stroke:null,touchAreaDilation:0,mouseAreaDilation:0,touchAreaXShift:0,touchAreaYShift:0,mouseAreaXShift:0,mouseAreaYShift:0,aspectRatio:1,cursor:"pointer",xMargin:5,yMargin:5,buttonAppearanceStrategy:RoundButton.ThreeDAppearanceStrategy},n);r.content||assert&&assert(typeof r.radius=="number",`invalid radius: ${r.radius}`),r.radius&&(assert&&assert(r.xMargin<r.radius,"xMargin cannot be larger than radius"),assert&&assert(r.yMargin<r.radius,"yMargin cannot be larger than radius"),r.minUnstrokedWidth=r.radius*2,r.minUnstrokedHeight=r.radius*2),r.buttonAppearanceStrategyOptions||(r.buttonAppearanceStrategyOptions={stroke:r.stroke,lineWidth:r.lineWidth});const s=r.radius||Math.max(r.content.width+r.xMargin*2,r.content.height+r.yMargin*2)/2;if(r.content&&r.radius){const d=r.content,c=Math.min((r.radius-r.xMargin)*2/d.width,(r.radius-r.yMargin)*2/d.height);r.content=new Node$2({children:[d],scale:c})}const a=new Circle(s);super(e,a,t,r);const l=a.localBounds.width/2;this.touchArea=Shape$1.circle(r.touchAreaXShift,r.touchAreaYShift,l+r.touchAreaDilation),this.mouseArea=Shape$1.circle(r.mouseAreaXShift,r.mouseAreaYShift,l+r.mouseAreaDilation),this.focusHighlight=Shape$1.circle(0,0,l+5)}}class ThreeDAppearanceStrategy{constructor(e,t,n,r){const s=r&&r.stroke?r.stroke:new PaintColorProperty(n,{luminanceFactor:-.4}),a=r&&r.lineWidth!==void 0?r.lineWidth:.3,l=optionize()({stroke:s,lineWidth:a,overStroke:s,overLineWidth:a,overButtonOpacity:1,selectedStroke:s,selectedLineWidth:a,selectedButtonOpacity:1,deselectedStroke:s,deselectedLineWidth:a,deselectedButtonOpacity:1,overFill:n},r),d=new PaintColorProperty(n,{luminanceFactor:.8}),c=new PaintColorProperty(n,{luminanceFactor:.7}),y=new PaintColorProperty(n,{luminanceFactor:.3}),m=new PaintColorProperty(n,{luminanceFactor:-.1}),O=new PaintColorProperty(n,{luminanceFactor:-.2}),D=new PaintColorProperty(n,{luminanceFactor:-.4}),z=new PaintColorProperty(n,{luminanceFactor:-.5}),w=new DerivedProperty([n],Ue=>Ue.withAlpha(0)),N=e.width/2,H=N-HIGHLIGHT_GRADIENT_LENGTH/2,X=N+HIGHLIGHT_GRADIENT_LENGTH/2,ae=HIGHLIGHT_GRADIENT_LENGTH/2,oe=new RadialGradient(ae,ae,H,ae,ae,X).addColorStop(0,n).addColorStop(1,c),ue=new RadialGradient(-ae,-ae,H,-ae,-ae,X).addColorStop(0,w).addColorStop(1,z),fe=new RadialGradient(ae,ae,H,ae,ae,X).addColorStop(0,y).addColorStop(1,d),be=new RadialGradient(-ae,-ae,H,-ae,-ae,X).addColorStop(0,w).addColorStop(1,z),Ae=new RadialGradient(-ae,-ae,0,0,0,X).addColorStop(0,m).addColorStop(.6,O).addColorStop(.8,n).addColorStop(1,d),W=new Circle(N,{stroke:l.stroke?l.stroke:D,lineWidth:l.lineWidth,pickable:!1});e.addChild(W),this.maxLineWidth=W.hasStroke()&&l&&typeof l.lineWidth=="number"?l.lineWidth:0,e.cachedPaints=[oe,fe,Ae],W.cachedPaints=[ue,be];function J(Ue){switch(Ue){case ButtonInteractionState.IDLE:e.fill=oe,e.stroke=l.deselectedStroke,e.lineWidth=l.deselectedLineWidth,e.opacity=l.deselectedButtonOpacity,W.fill=ue,W.opacity=l.deselectedButtonOpacity;break;case ButtonInteractionState.OVER:e.fill=fe,e.stroke=l.overStroke,e.lineWidth=l.overLineWidth,e.opacity=l.overButtonOpacity,W.fill=be,W.opacity=l.overButtonOpacity;break;case ButtonInteractionState.PRESSED:e.fill=Ae,e.stroke=l.selectedStroke,e.lineWidth=l.selectedLineWidth,e.opacity=l.selectedButtonOpacity,W.fill=be,W.opacity=l.selectedButtonOpacity;break;default:throw new Error(`unsupported interactionState: ${Ue}`)}}t.link(J),this.disposeThreeDAppearanceStrategy=()=>{t.hasListener(J)&&t.unlink(J),d.dispose(),c.dispose(),y.dispose(),m.dispose(),O.dispose(),D.dispose(),z.dispose(),w.dispose()}}dispose(){this.disposeThreeDAppearanceStrategy()}}RoundButton.ThreeDAppearanceStrategy=ThreeDAppearanceStrategy;sun.register("RoundButton",RoundButton);class RoundStickyToggleButton extends RoundButton{constructor(e,t,n,r){const s=optionize()({soundPlayer:pushButtonSoundPlayer,tandem:Tandem.REQUIRED},r),a=new StickyToggleButtonModel(t,n,e,s),l=new StickyToggleButtonInteractionStateProperty(a);super(a,l,s);const d=()=>s.soundPlayer.play();a.produceSoundEmitter.addListener(d);const c=y=>this.setPDOMAttribute("aria-pressed",e.value===n);e.link(c),this.disposeRoundStickyToggleButton=()=>{e.unlink(c),a.produceSoundEmitter.removeListener(d),a.dispose()}}dispose(){this.disposeRoundStickyToggleButton(),super.dispose()}}sun.register("RoundStickyToggleButton",RoundStickyToggleButton);class BooleanRoundStickyToggleButton extends RoundStickyToggleButton{constructor(e,t){super(e,!1,!0,t)}}sun.register("BooleanRoundStickyToggleButton",BooleanRoundStickyToggleButton);class RoundToggleButton extends RoundButton{constructor(e,t,n,r){const s=optionize()({valueOffSoundPlayer:toggleOffSoundPlayer,valueOnSoundPlayer:toggleOnSoundPlayer,tandem:Tandem.REQUIRED,phetioFeatured:!0},r),a=new ToggleButtonModel(t,n,e,s),l=new ToggleButtonInteractionStateProperty(a);super(a,l,s),this.addLinkedElement(e,{tandemName:"property"});const d=()=>{e.value===t?s.valueOffSoundPlayer.play():e.value===n&&s.valueOnSoundPlayer.play()};this.buttonModel.produceSoundEmitter.addListener(d),this.disposeRoundToggleButton=()=>{this.buttonModel.produceSoundEmitter.removeListener(d),a.dispose()}}dispose(){this.disposeRoundToggleButton(),super.dispose()}}sun.register("RoundToggleButton",RoundToggleButton);class BooleanRoundToggleButton extends RoundToggleButton{constructor(e,t,n,r){const s=optionize()({content:null,tandem:Tandem.REQUIRED},r),a=new BooleanToggleNode(e,t,n,{tandem:s.tandem.createTandem("toggleNode")});s.content=a,super(e,!1,!0,s),this.disposeBooleanRoundToggleButton=function(){a.dispose()}}dispose(){this.disposeBooleanRoundToggleButton(),super.dispose()}}sun.register("BooleanRoundToggleButton",BooleanRoundToggleButton);class MomentaryButtonInteractionStateProperty extends DerivedProperty2{constructor(e){super([e.looksOverProperty,e.looksPressedProperty],(t,n)=>t&&!n?ButtonInteractionState.OVER:n?ButtonInteractionState.PRESSED:ButtonInteractionState.IDLE,{valueType:ButtonInteractionState})}}sun.register("MomentaryButtonInteractionStateProperty",MomentaryButtonInteractionStateProperty);class MomentaryButtonModel extends ButtonModel{constructor(e,t,n,r){const s=optionize()({tandem:Tandem.REQUIRED,phetioReadOnly:PhetioObject.DEFAULT_OPTIONS.phetioReadOnly},r);super(s);const a=d=>{d?this.enabledProperty.get()&&n.set(t):n.set(e)};this.downProperty.lazyLink(a);const l=d=>{this.downProperty.set(d===t)};n.link(l),this.disposeMomentaryButtonModel=()=>{this.downProperty.unlink(a),n.unlink(l)}}dispose(){this.disposeMomentaryButtonModel(),super.dispose()}}sun.register("MomentaryButtonModel",MomentaryButtonModel);const Nr=class Nr extends EnumerationValue{};Nr.SELECTED=new Nr,Nr.DESELECTED=new Nr,Nr.OVER=new Nr,Nr.PRESSED=new Nr,Nr.enumeration=new Enumeration(Nr);let RadioButtonInteractionState=Nr;sun.register("RadioButtonInteractionState",RadioButtonInteractionState);class RadioButtonInteractionStateProperty extends DerivedProperty5{constructor(e,t,n){super([e.focusedProperty,e.overProperty,e.looksOverProperty,e.looksPressedProperty,t],(r,s,a,l,d)=>{const c=d===n;return a&&!(l||c)?RadioButtonInteractionState.OVER:(s||r)&&l?RadioButtonInteractionState.PRESSED:c?RadioButtonInteractionState.SELECTED:RadioButtonInteractionState.DESELECTED},{valueType:RadioButtonInteractionState})}}sun.register("RadioButtonInteractionStateProperty",RadioButtonInteractionStateProperty);class RectangularMomentaryButton extends RectangularButton{constructor(e,t,n,r){var l,d;const s=optionize()({tandem:Tandem.REQUIRED},r),a=new MomentaryButtonModel(t,n,e,s);super(a,new MomentaryButtonInteractionStateProperty(a),s),this.disposeRectangularMomentaryButton=()=>{a.dispose()},assert&&((d=(l=phet==null?void 0:phet.chipper)==null?void 0:l.queryParameters)!=null&&d.binder)&&InstanceRegistry.registerDataURL("sun","RectangularMomentaryButton",this)}dispose(){this.disposeRectangularMomentaryButton(),super.dispose()}}sun.register("RectangularMomentaryButton",RectangularMomentaryButton);const il=class il extends RectangularButton{constructor(e,t,n){const r=optionize()({soundPlayer:null,baseColor:ColorConstants.LIGHT_BLUE,buttonAppearanceStrategy:il.FlatAppearanceStrategy,buttonAppearanceStrategyOptions:{overButtonOpacity:.8,overStroke:null,selectedStroke:Color.BLACK,selectedLineWidth:1.5,selectedButtonOpacity:1,deselectedStroke:new Color(50,50,50),deselectedLineWidth:1,deselectedButtonOpacity:.6},contentAppearanceStrategy:il.ContentAppearanceStrategy,contentAppearanceStrategyOptions:{overContentOpacity:.8,selectedContentOpacity:1,deselectedContentOpacity:.6},tagName:"input",inputType:"radio",labelTagName:"label",containerTagName:"li",appendDescription:!0,appendLabel:!0,tandem:Tandem.REQUIRED,tandemNameSuffix:"RadioButton",phetioReadOnly:PhetioObject.DEFAULT_OPTIONS.phetioReadOnly},n),s=new ButtonModel({enabledPropertyOptions:r.enabledPropertyOptions,tandem:r.tandem,phetioEnabledPropertyInstrumented:r.phetioEnabledPropertyInstrumented}),a=new RadioButtonInteractionStateProperty(s,e,t);super(s,a,r),this.interactionStateProperty=a,e.value===t&&this.setPDOMAttribute("checked","checked");const l=y=>{this.pdomChecked=y===t};e.link(l),this.property=e,this.value=t,this.firedEmitter=new Emitter({tandem:r.tandem.createTandem("firedEmitter"),phetioDocumentation:"Emits when the radio button is pressed",phetioReadOnly:r.phetioReadOnly,phetioEventType:EventType.USER}),this.firedEmitter.addListener(()=>e.set(t)),s.downProperty.link(y=>{!y&&(s.overProperty.get()||s.focusedProperty.get())&&!s.interrupted&&(this.fire(),this.voicingSpeakFullResponse({hintResponse:null}))});const d=r.soundPlayer||pushButtonSoundPlayer,c=()=>{d.play()};s.produceSoundEmitter.addListener(c),this.disposeRectangularRadioButton=()=>{e.unlink(l),this.firedEmitter.dispose(),s.produceSoundEmitter.removeListener(c),s.dispose(),this.interactionStateProperty.dispose()}}dispose(){this.disposeRectangularRadioButton(),super.dispose()}fire(){this.buttonModel.enabledProperty.get()&&(this.firedEmitter.emit(),this.buttonModel.produceSoundEmitter.emit())}};il.FlatAppearanceStrategy=class{constructor(t,n,r,s){const a=optionize()({stroke:r,lineWidth:1,deselectedButtonOpacity:1,deselectedLineWidth:1,deselectedStroke:"gray",overButtonOpacity:.8,overFill:null,overLineWidth:0,overStroke:null,selectedButtonOpacity:1,selectedLineWidth:1,selectedStroke:"black"},s),l=new PaintColorProperty(r,{luminanceFactor:-.4}),d=new PaintColorProperty(a.overFill||r,{luminanceFactor:s&&s.overFill?0:.4}),c=new PaintColorProperty(a.overStroke||a.deselectedStroke,{luminanceFactor:s&&s.overStroke?0:-.4});this.maxLineWidth=Math.max(a.selectedLineWidth,a.deselectedLineWidth,a.overLineWidth),t.cachedPaints=[r,d,l,c,a.selectedStroke,a.deselectedStroke];function y(m){switch(m){case RadioButtonInteractionState.SELECTED:t.fill=r,t.stroke=a.selectedStroke,t.lineWidth=a.selectedLineWidth,t.opacity=a.selectedButtonOpacity;break;case RadioButtonInteractionState.DESELECTED:t.fill=r,t.stroke=a.deselectedStroke,t.lineWidth=a.deselectedLineWidth,t.opacity=a.deselectedButtonOpacity;break;case RadioButtonInteractionState.OVER:t.fill=d,t.stroke=c,t.lineWidth=Math.max(a.overLineWidth,a.deselectedLineWidth),t.opacity=a.overButtonOpacity;break;case RadioButtonInteractionState.PRESSED:t.fill=l,t.stroke=a.deselectedStroke,t.lineWidth=a.deselectedLineWidth,t.opacity=a.selectedButtonOpacity;break;default:throw new Error(`unsupported interactionState: ${m}`)}}n.link(y),this.disposeFlatAppearanceStrategy=()=>{n.hasListener(y)&&n.unlink(y),c.dispose(),d.dispose(),l.dispose()}}dispose(){this.disposeFlatAppearanceStrategy()}},il.ContentAppearanceStrategy=class{constructor(t,n,r){const s=optionize()({deselectedContentOpacity:1,overContentOpacity:1,selectedContentOpacity:1},r);function a(l){if(t!==null)switch(l){case RadioButtonInteractionState.DESELECTED:t.opacity=s.deselectedContentOpacity;break;case RadioButtonInteractionState.OVER:t.opacity=s.overContentOpacity;break;case RadioButtonInteractionState.SELECTED:t.opacity=s.selectedContentOpacity;break;case RadioButtonInteractionState.PRESSED:t.opacity=s.deselectedContentOpacity;break;default:throw new Error(`unsupported state: ${l}`)}}n.link(a),this.disposeContentAppearanceStrategy=()=>{n.hasListener(a)&&n.unlink(a)}}dispose(){this.disposeContentAppearanceStrategy()}};let RectangularRadioButton=il;sun.register("RectangularRadioButton",RectangularRadioButton);let instanceCount=0;const CLASS_NAME="RectangularRadioButtonGroup";class RectangularRadioButtonGroup extends FlowBox{constructor(e,t,n){var z,w;assert&&assert(_.uniqBy(t,N=>N.value).length===t.length,"items must have unique values"),assert&&assert(_.find(t,N=>N.value===e.value),"one radio button must be associated with property.value");const r=optionize()({soundPlayers:null,labelAlign:"bottom",labelSpacing:0,a11yHighlightXDilation:0,a11yHighlightYDilation:0,touchAreaXDilation:0,touchAreaYDilation:0,mouseAreaXDilation:0,mouseAreaYDilation:0,radioButtonOptions:{baseColor:ColorConstants.LIGHT_BLUE,cornerRadius:4,xMargin:5,yMargin:5,xAlign:"center",yAlign:"center",buttonAppearanceStrategyOptions:{selectedStroke:"black",selectedLineWidth:1.5,selectedButtonOpacity:1,deselectedStroke:new Color(50,50,50),deselectedLineWidth:1,deselectedButtonOpacity:.6,overButtonOpacity:.8},contentAppearanceStrategy:RectangularRadioButton.ContentAppearanceStrategy,contentAppearanceStrategyOptions:{overContentOpacity:.8,selectedContentOpacity:1,deselectedContentOpacity:.6}},spacing:10,stretch:!0,orientation:"vertical",disabledOpacity:SceneryConstants.DISABLED_OPACITY,tandem:Tandem.REQUIRED,tandemNameSuffix:"ButtonGroup",visiblePropertyOptions:{phetioFeatured:!0},phetioEnabledPropertyInstrumented:!0,phetioFeatured:!0,tagName:"ul",labelTagName:"h3",ariaRole:"radiogroup",groupFocusHighlight:!0},n);assert&&assert(r.soundPlayers===null||r.soundPlayers.length===t.length,"If soundPlayers is provided, there must be one per radio button."),instanceCount++;const s=new Map,a=getGroupItemNodes(t,r.tandem);assert&&assert(_.every(a,N=>!N.hasPDOMContent),"Accessibility is provided by RectangularRadioButton and RectangularRadioButtonGroupItem.labelContent. Additional PDOM content in the provided Node could break accessibility.");const l=_.maxBy(a,N=>N.width).width,d=_.maxBy(a,N=>N.height).height,c=[],y=[],m=r.radioButtonOptions.xMargin,O=r.radioButtonOptions.yMargin;for(let N=0;N<t.length;N++){const H=t[N],X=a[N],ae=combineOptions({content:X,minWidth:l+2*m,minHeight:d+2*O,soundPlayer:r.soundPlayers?r.soundPlayers[N]:multiSelectionSoundPlayerFactory.getSelectionSoundPlayer(N),tandem:H.tandemName?r.tandem.createTandem(H.tandemName):r.tandem===Tandem.OPT_OUT?Tandem.OPT_OUT:Tandem.REQUIRED,phetioDocumentation:H.phetioDocumentation||"",touchAreaXDilation:r.orientation==="horizontal"?r.spacing/2:r.touchAreaXDilation,touchAreaYDilation:r.orientation==="vertical"?r.spacing/2:r.touchAreaYDilation,mouseAreaXDilation:r.orientation==="horizontal"?r.spacing/2:r.mouseAreaXDilation,mouseAreaYDilation:r.orientation==="vertical"?r.spacing/2:r.mouseAreaYDilation},r.radioButtonOptions,H.options);H.labelContent&&(ae.labelContent=H.labelContent,ae.voicingNameResponse=H.labelContent),H.descriptionContent&&(ae.descriptionContent=H.descriptionContent),H.voicingContextResponse&&(ae.voicingContextResponse=H.voicingContextResponse);const oe=new RectangularRadioButton(e,H.value,ae);s.set(H.value,oe),oe.setPDOMAttribute("name",CLASS_NAME+instanceCount);let ue;if(H.label){const fe=H.label,be=r.labelAlign==="bottom"||r.labelAlign==="top"?"vertical":"horizontal",Ae=r.labelAlign==="left"||r.labelAlign==="top"?[fe,oe]:[oe,fe];ue=new FlowBox({children:Ae,spacing:r.labelSpacing,orientation:be}),fe.pickable=!1,r.radioButtonOptions.contentAppearanceStrategy&&y.push(new r.radioButtonOptions.contentAppearanceStrategy(fe,oe.interactionStateProperty,r.radioButtonOptions.contentAppearanceStrategyOptions))}else ue=oe;c.push(ue)}r.children=c,super(r),this.radioButtonMap=s,this.addAriaLabelledbyAssociation({thisElementName:PDOMPeer$1.PRIMARY_SIBLING,otherNode:this,otherElementName:PDOMPeer$1.LABEL_SIBLING});const D={keydown:N=>N.pointer.reserveForKeyboardDrag()};this.addInputListener(D),this.addLinkedElement(e,{tandemName:"property"}),this.disposeRadioButtonGroup=()=>{this.removeInputListener(D),c.forEach(N=>N.dispose()),y.forEach(N=>N.dispose&&N.dispose()),a.forEach(N=>N.dispose())},assert&&((w=(z=phet==null?void 0:phet.chipper)==null?void 0:z.queryParameters)!=null&&w.binder)&&InstanceRegistry.registerDataURL("sun","RectangularRadioButtonGroup",this)}getButtonForValue(e){const t=this.radioButtonMap.get(e);return assert&&assert(t,"No button found for value: "+e),t}dispose(){this.radioButtonMap.clear(),this.disposeRadioButtonGroup(),super.dispose()}}sun.register("RectangularRadioButtonGroup",RectangularRadioButtonGroup);class RoundMomentaryButton extends RoundButton{constructor(e,t,n,r){const s=optionize()({tandem:Tandem.REQUIRED},r),a=new MomentaryButtonModel(t,n,e,s);super(a,new MomentaryButtonInteractionStateProperty(a),s),this.disposeRoundMomentaryButton=()=>{a.dispose()}}dispose(){this.disposeRoundMomentaryButton(),super.dispose()}}sun.register("RoundMomentaryButton",RoundMomentaryButton);class RoundPushButton extends RoundButton{constructor(e){var l,d;const t=optionize()({soundPlayer:pushButtonSoundPlayer,tandem:Tandem.REQUIRED},e),n=t.listener,r=_.omit(t,["listener"]),s=new PushButtonModel(r);super(s,new PushButtonInteractionStateProperty(s),r),this.pushButtonModel=s,n&&this.addListener(n);const a=()=>{t.soundPlayer.play()};s.produceSoundEmitter.addListener(a),this.disposeRoundPushButton=()=>{s.produceSoundEmitter.removeListener(a),s.dispose()},assert&&((d=(l=phet==null?void 0:phet.chipper)==null?void 0:l.queryParameters)!=null&&d.binder)&&InstanceRegistry.registerDataURL("sun","RoundPushButton",this)}dispose(){super.dispose(),this.disposeRoundPushButton()}addListener(e){this.pushButtonModel.addListener(e)}removeListener(e){this.pushButtonModel.removeListener(e)}}sun.register("RoundPushButton",RoundPushButton);class TextPushButton extends RectangularPushButton{constructor(e,t){const n=optionize()({font:Font.DEFAULT,textFill:"black",maxTextWidth:null,tandem:Tandem.REQUIRED,innerContent:e},t),r=new Text(e,combineOptions({font:n.font,fill:n.textFill,maxWidth:n.maxTextWidth},n.textNodeOptions));n.content=r,super(n),this.disposeTextPushButton=()=>{r.dispose()}}dispose(){this.disposeTextPushButton(),super.dispose()}}sun.register("TextPushButton",TextPushButton);async function copyToClipboard(o){if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(o);else{const e=document.createElement("textarea");e.value=o,e.style.position="absolute",e.style.left="-999999px",document.body.prepend(e),e.select();try{document.execCommand("copy")}catch(t){console.error(t)}finally{e.remove()}}}const mediaQueryList=window.matchMedia("(prefers-color-scheme: dark)"),isOSDarkModeProperty=new BooleanProperty(mediaQueryList.matches);mediaQueryList.addEventListener("change",o=>{isOSDarkModeProperty.value=o.matches});const lightTheme={name:"Light",isEditable:!0,navbarBackgroundColorProperty:new PaintColorProperty("rgb(238,238,238)"),navbarErrorBackgroundColorProperty:new PaintColorProperty("rgb(218,107,91)"),playAreaBackgroundColorProperty:new PaintColorProperty("rgb(237,237,237)"),playAreaLinearTopColorProperty:new PaintColorProperty("rgba(0,0,0,0)"),playAreaLinearMiddleColorProperty:new PaintColorProperty("rgba(0,0,0,0)"),playAreaLinearBottomColorProperty:new PaintColorProperty("rgba(0,0,0,0)"),playAreaRadialInsideColorProperty:new PaintColorProperty("rgba(255,255,255,0)"),playAreaRadialOutsideColorProperty:new PaintColorProperty("rgba(173,199,210,0)"),puzzleBackgroundColorProperty:new PaintColorProperty("rgb(255,255,255)"),puzzleBackgroundStrokeColorProperty:new PaintColorProperty("rgb(179,179,179)"),vertexColorProperty:new PaintColorProperty("rgb(0,0,0)"),xColorProperty:new PaintColorProperty("rgb(255,0,0)"),blackLineColorProperty:new PaintColorProperty("rgb(64,64,64)"),redLineColorProperty:new PaintColorProperty("rgb(170,170,170)"),whiteLineColorProperty:new PaintColorProperty("rgb(153,153,153)"),selectedFaceColorHighlightColorProperty:new PaintColorProperty("rgba(0,0,0,0.5)"),selectedSectorEditColorProperty:new PaintColorProperty("rgba(0,0,0,0.80000000000000004441)"),hoverHighlightColorProperty:new PaintColorProperty("rgba(127,127,127,0.5999999999999999778)"),simpleRegionTargetColorProperty:new PaintColorProperty("rgba(79,140,238,0)"),faceColorBasicTargetColorProperty:new PaintColorProperty("rgba(240,214,214,0)"),faceColorLightTargetColorProperty:new PaintColorProperty("rgba(245,224,224,0)"),faceColorDarkTargetColorProperty:new PaintColorProperty("rgba(223,191,191,0)"),faceColorOutsideColorProperty:new PaintColorProperty("rgb(255,255,255)"),faceColorInsideColorProperty:new PaintColorProperty("rgb(214,214,214)"),faceColorDefaultColorProperty:new PaintColorProperty("rgb(237,237,237)"),sectorOnlyOneColorProperty:new PaintColorProperty("rgb(255,0,0)"),sectorNotOneColorProperty:new PaintColorProperty("rgb(0,153,204)"),sectorNotZeroColorProperty:new PaintColorProperty("rgb(0,163,0)"),sectorNotTwoColorProperty:new PaintColorProperty("rgb(236,124,19)"),sectorOtherColorProperty:new PaintColorProperty("rgb(182,26,255)"),vertexStateLineProperty:new PaintColorProperty("rgb(0,132,255)"),vertexStateBackgroundProperty:new PaintColorProperty("rgb(255,255,255)"),vertexStateOutlineProperty:new PaintColorProperty("rgb(120,120,120)"),vertexStatePointProperty:new PaintColorProperty("rgb(61,61,61)"),faceValueColorProperty:new PaintColorProperty("rgb(0,0,0)"),faceValueCompletedColorProperty:new PaintColorProperty("rgba(0,0,0,0.2000000000000000111)"),faceValueErrorColorProperty:new PaintColorProperty("rgb(255,0,0)"),edgeWeirdColorProperty:new PaintColorProperty("rgb(136,136,136)"),uiForegroundColorProperty:new PaintColorProperty("rgb(0,0,0)"),uiBackgroundColorProperty:new PaintColorProperty("rgb(255,255,255)"),uiButtonForegroundProperty:new PaintColorProperty("rgb(0,0,0)"),uiButtonBaseColorProperty:new PaintColorProperty("rgb(153,206,255)"),uiButtonDisabledColorProperty:new PaintColorProperty("rgb(220,220,220)"),uiButtonSelectedStrokeColorProperty:new PaintColorProperty("rgb(0,0,0)"),uiButtonDeselectedStrokeColorProperty:new PaintColorProperty("rgb(50,50,50)"),barrierColorProperty:new PaintColorProperty("rgba(127,127,127,0.69999999999999995559)"),generateAddedFaceColorProperty:new PaintColorProperty("rgb(216,184,241)"),generateMinimizedFaceColorProperty:new PaintColorProperty("rgb(173,200,244)")},darkTheme={name:"Dark",isEditable:!0,navbarBackgroundColorProperty:new PaintColorProperty("rgb(17,17,17)"),navbarErrorBackgroundColorProperty:new PaintColorProperty("rgb(115,44,34)"),playAreaBackgroundColorProperty:new PaintColorProperty("rgb(51,51,51)"),playAreaLinearTopColorProperty:new PaintColorProperty("rgba(0,0,0,0)"),playAreaLinearMiddleColorProperty:new PaintColorProperty("rgba(0,0,0,0)"),playAreaLinearBottomColorProperty:new PaintColorProperty("rgba(0,0,0,0)"),playAreaRadialInsideColorProperty:new PaintColorProperty("rgba(66,66,66,0.30999999999999999778)"),playAreaRadialOutsideColorProperty:new PaintColorProperty("rgba(0,0,0,0.17999999999999999334)"),puzzleBackgroundColorProperty:new PaintColorProperty("rgb(13,13,13)"),puzzleBackgroundStrokeColorProperty:new PaintColorProperty("rgb(89,89,89)"),vertexColorProperty:new PaintColorProperty("rgb(119,119,119)"),xColorProperty:new PaintColorProperty("rgb(255,0,0)"),blackLineColorProperty:new PaintColorProperty("rgb(170,170,170)"),redLineColorProperty:new PaintColorProperty("rgb(68,68,68)"),whiteLineColorProperty:new PaintColorProperty("rgb(85,85,85)"),selectedFaceColorHighlightColorProperty:new PaintColorProperty("rgba(255,255,255,0.5)"),selectedSectorEditColorProperty:new PaintColorProperty("rgba(255,255,255,0.80000000000000004441)"),hoverHighlightColorProperty:new PaintColorProperty("rgba(127,127,127,0.5999999999999999778)"),simpleRegionTargetColorProperty:new PaintColorProperty("rgba(207,80,128,0)"),faceColorBasicTargetColorProperty:new PaintColorProperty("rgba(74,18,18,0)"),faceColorLightTargetColorProperty:new PaintColorProperty("rgba(101,43,40,0)"),faceColorDarkTargetColorProperty:new PaintColorProperty("rgba(74,18,18,0)"),faceColorOutsideColorProperty:new PaintColorProperty("rgb(13,13,13)"),faceColorInsideColorProperty:new PaintColorProperty("rgb(64,64,64)"),faceColorDefaultColorProperty:new PaintColorProperty("rgb(38,38,38)"),sectorOnlyOneColorProperty:new PaintColorProperty("rgb(255,0,0)"),sectorNotOneColorProperty:new PaintColorProperty("rgb(8,164,217)"),sectorNotZeroColorProperty:new PaintColorProperty("rgb(42,137,42)"),sectorNotTwoColorProperty:new PaintColorProperty("rgb(224,124,31)"),sectorOtherColorProperty:new PaintColorProperty("rgb(153,0,224)"),vertexStateLineProperty:new PaintColorProperty("rgb(255,119,41)"),vertexStateBackgroundProperty:new PaintColorProperty("rgb(0,0,0)"),vertexStateOutlineProperty:new PaintColorProperty("rgb(56,56,56)"),vertexStatePointProperty:new PaintColorProperty("rgb(209,209,209)"),faceValueColorProperty:new PaintColorProperty("rgb(204,204,204)"),faceValueCompletedColorProperty:new PaintColorProperty("rgba(217,217,217,0.14000000000000001332)"),faceValueErrorColorProperty:new PaintColorProperty("rgb(255,0,0)"),edgeWeirdColorProperty:new PaintColorProperty("rgb(136,136,136)"),uiForegroundColorProperty:new PaintColorProperty("rgb(204,204,204)"),uiBackgroundColorProperty:new PaintColorProperty("rgb(34,34,34)"),uiButtonForegroundProperty:new PaintColorProperty("rgb(0,0,0)"),uiButtonBaseColorProperty:new PaintColorProperty("rgb(206,119,67)"),uiButtonDisabledColorProperty:new PaintColorProperty("rgb(128,128,128)"),uiButtonSelectedStrokeColorProperty:new PaintColorProperty("rgb(255,255,255)"),uiButtonDeselectedStrokeColorProperty:new PaintColorProperty("rgb(200,200,200)"),barrierColorProperty:new PaintColorProperty("rgba(60,60,60,0.69999999999999995559)"),generateAddedFaceColorProperty:new PaintColorProperty("rgb(92,42,123)"),generateMinimizedFaceColorProperty:new PaintColorProperty("rgb(33,68,126)")},fadeLightTheme={...lightTheme,name:"Fade Light",isEditable:!0,navbarBackgroundColorProperty:new PaintColorProperty("rgb(33,33,33)"),playAreaBackgroundColorProperty:new PaintColorProperty("rgb(204,204,204)"),playAreaLinearTopColorProperty:new PaintColorProperty("rgba(255,102,0,0.36999999999999999556)"),playAreaLinearMiddleColorProperty:new PaintColorProperty("rgba(255,0,200,0.3499999999999999778)"),playAreaLinearBottomColorProperty:new PaintColorProperty("rgba(0,17,255,0.34000000000000002442)"),playAreaRadialInsideColorProperty:new PaintColorProperty("rgba(255,255,255,0)"),playAreaRadialOutsideColorProperty:new PaintColorProperty("rgba(255,255,255,0.79000000000000003553)"),puzzleBackgroundStrokeColorProperty:new PaintColorProperty("rgb(148,148,148)")},fadeDarkTheme={...darkTheme,name:"Fade Dark",isEditable:!0,navbarBackgroundColorProperty:new PaintColorProperty("rgb(17,17,17)"),playAreaBackgroundColorProperty:new PaintColorProperty("rgb(255,255,255)"),playAreaLinearTopColorProperty:new PaintColorProperty("rgba(255,102,0,0.64000000000000001332)"),playAreaLinearMiddleColorProperty:new PaintColorProperty("rgba(255,0,208,0.54000000000000003553)"),playAreaLinearBottomColorProperty:new PaintColorProperty("rgba(4,0,255,0.42999999999999999334)"),playAreaRadialInsideColorProperty:new PaintColorProperty("rgba(0,0,0,0.46999999999999997335)"),playAreaRadialOutsideColorProperty:new PaintColorProperty("rgb(0,0,0)"),puzzleBackgroundColorProperty:new PaintColorProperty("rgb(24,23,22)"),puzzleBackgroundStrokeColorProperty:new PaintColorProperty("rgb(92,51,40)"),whiteLineColorProperty:new PaintColorProperty("rgb(78,73,70)")},autoTheme={name:"Auto",isEditable:!1};Object.keys(lightTheme).forEach(o=>{isTReadOnlyProperty(lightTheme[o])&&(autoTheme[o]=new DerivedProperty([isOSDarkModeProperty,lightTheme[o],darkTheme[o]],(e,t,n)=>e?n:t))});const availableThemes=[lightTheme,darkTheme,autoTheme,fadeLightTheme,fadeDarkTheme],themeProperty=new LocalStorageProperty("theme",{serialize:o=>o.name,deserialize:o=>availableThemes.find(e=>e.name===o)??autoTheme});window.themeProperty=themeProperty;const themeToJS=o=>{const e={};return Object.keys(o).forEach(t=>{const n=o[t];n instanceof PaintColorProperty?e[t]=`new PaintColorProperty( '${n.value.toCSS()}' )`:typeof n=="string"?e[t]=`'${n}'`:e[t]=JSON.stringify(n,null,2)}),`{
${Object.keys(e).map(t=>`  ${t}: ${e[t]}`).join(`,
`)}
}`},popupColorEditor=o=>{const e=document.createElement("div");e.style.zoom="0.5",e.style.backgroundColor="rgba(127,127,127,0.3)";const t=document.createElement("button");t.textContent="Close",t.addEventListener("click",()=>{document.body.removeChild(e)}),e.appendChild(t);const n=document.createElement("div"),r=document.createElement("button");r.textContent="Toggle Visibility",r.addEventListener("click",()=>{n.style.display=n.style.display==="none"?"block":"none"}),e.appendChild(r);const s=document.createElement("button");s.textContent="Copy to Clipboard",s.addEventListener("click",()=>{copyToClipboard(themeToJS(o))}),e.appendChild(s),e.appendChild(n),Object.keys(o).forEach(a=>{const l=o[a];if(l instanceof PaintColorProperty){const d=document.createElement("div"),c=document.createElement("input");c.type="color",c.value=l.value.withAlpha(1).toHexString(),c.style.margin="1px",c.style.marginRight="10px";const y=l.value.alpha,m=document.createElement("input"),O=document.createElement("span");m.style.width="100px",m.type="range",m.min="0",m.max="1",m.step="0.01",m.value=`${y}`,m.style.marginRight="10px",O.innerText=y.toFixed(2);const D=()=>{const z=m.valueAsNumber;O.innerText=z.toFixed(2),l.value=new Color(c.value).withAlpha(z)};c.addEventListener("input",D),m.addEventListener("input",D),d.appendChild(c),d.appendChild(O),d.appendChild(m),d.appendChild(document.createTextNode(a)),n.appendChild(d)}}),document.body.appendChild(e),e.style.position="absolute",e.style.zIndex="100000"},navbarBackgroundColorProperty=new DynamicProperty(themeProperty,{derive:"navbarBackgroundColorProperty"}),navbarErrorBackgroundColorProperty=new DynamicProperty(themeProperty,{derive:"navbarErrorBackgroundColorProperty"}),playAreaBackgroundColorProperty=new DynamicProperty(themeProperty,{derive:"playAreaBackgroundColorProperty"}),playAreaLinearTopColorProperty=new DynamicProperty(themeProperty,{derive:"playAreaLinearTopColorProperty"}),playAreaLinearMiddleColorProperty=new DynamicProperty(themeProperty,{derive:"playAreaLinearMiddleColorProperty"}),playAreaLinearBottomColorProperty=new DynamicProperty(themeProperty,{derive:"playAreaLinearBottomColorProperty"}),playAreaRadialInsideColorProperty=new DynamicProperty(themeProperty,{derive:"playAreaRadialInsideColorProperty"}),playAreaRadialOutsideColorProperty=new DynamicProperty(themeProperty,{derive:"playAreaRadialOutsideColorProperty"}),puzzleBackgroundColorProperty=new DynamicProperty(themeProperty,{derive:"puzzleBackgroundColorProperty"}),puzzleBackgroundStrokeColorProperty=new DynamicProperty(themeProperty,{derive:"puzzleBackgroundStrokeColorProperty"}),vertexColorProperty=new DynamicProperty(themeProperty,{derive:"vertexColorProperty"}),xColorProperty=new DynamicProperty(themeProperty,{derive:"xColorProperty"}),blackLineColorProperty=new DynamicProperty(themeProperty,{derive:"blackLineColorProperty"}),redLineColorProperty=new DynamicProperty(themeProperty,{derive:"redLineColorProperty"}),whiteLineColorProperty=new DynamicProperty(themeProperty,{derive:"whiteLineColorProperty"}),selectedFaceColorHighlightColorProperty=new DynamicProperty(themeProperty,{derive:"selectedFaceColorHighlightColorProperty"}),selectedSectorEditColorProperty=new DynamicProperty(themeProperty,{derive:"selectedSectorEditColorProperty"}),hoverHighlightColorProperty=new DynamicProperty(themeProperty,{derive:"hoverHighlightColorProperty"}),simpleRegionTargetColorProperty=new DynamicProperty(themeProperty,{derive:"simpleRegionTargetColorProperty"}),faceColorBasicTargetColorProperty=new DynamicProperty(themeProperty,{derive:"faceColorBasicTargetColorProperty"}),faceColorLightTargetColorProperty=new DynamicProperty(themeProperty,{derive:"faceColorLightTargetColorProperty"}),faceColorDarkTargetColorProperty=new DynamicProperty(themeProperty,{derive:"faceColorDarkTargetColorProperty"}),faceColorOutsideColorProperty=new DynamicProperty(themeProperty,{derive:"faceColorOutsideColorProperty"}),faceColorInsideColorProperty=new DynamicProperty(themeProperty,{derive:"faceColorInsideColorProperty"}),faceColorDefaultColorProperty=new DynamicProperty(themeProperty,{derive:"faceColorDefaultColorProperty"}),sectorOnlyOneColorProperty=new DynamicProperty(themeProperty,{derive:"sectorOnlyOneColorProperty"}),sectorNotOneColorProperty=new DynamicProperty(themeProperty,{derive:"sectorNotOneColorProperty"}),sectorNotZeroColorProperty=new DynamicProperty(themeProperty,{derive:"sectorNotZeroColorProperty"}),sectorNotTwoColorProperty=new DynamicProperty(themeProperty,{derive:"sectorNotTwoColorProperty"}),sectorOtherColorProperty=new DynamicProperty(themeProperty,{derive:"sectorOtherColorProperty"}),vertexStateLineProperty=new DynamicProperty(themeProperty,{derive:"vertexStateLineProperty"}),vertexStateBackgroundProperty=new DynamicProperty(themeProperty,{derive:"vertexStateBackgroundProperty"}),vertexStateOutlineProperty=new DynamicProperty(themeProperty,{derive:"vertexStateOutlineProperty"}),vertexStatePointProperty=new DynamicProperty(themeProperty,{derive:"vertexStatePointProperty"}),faceValueColorProperty=new DynamicProperty(themeProperty,{derive:"faceValueColorProperty"}),faceValueCompletedColorProperty=new DynamicProperty(themeProperty,{derive:"faceValueCompletedColorProperty"}),faceValueErrorColorProperty=new DynamicProperty(themeProperty,{derive:"faceValueErrorColorProperty"}),edgeWeirdColorProperty=new DynamicProperty(themeProperty,{derive:"edgeWeirdColorProperty"}),uiForegroundColorProperty=new DynamicProperty(themeProperty,{derive:"uiForegroundColorProperty"}),uiBackgroundColorProperty=new DynamicProperty(themeProperty,{derive:"uiBackgroundColorProperty"}),uiButtonForegroundProperty=new DynamicProperty(themeProperty,{derive:"uiButtonForegroundProperty"}),uiButtonBaseColorProperty=new DynamicProperty(themeProperty,{derive:"uiButtonBaseColorProperty"}),uiButtonDisabledColorProperty=new DynamicProperty(themeProperty,{derive:"uiButtonDisabledColorProperty"}),uiButtonSelectedStrokeColorProperty=new DynamicProperty(themeProperty,{derive:"uiButtonSelectedStrokeColorProperty"}),uiButtonDeselectedStrokeColorProperty=new DynamicProperty(themeProperty,{derive:"uiButtonDeselectedStrokeColorProperty"}),barrierColorProperty=new DynamicProperty(themeProperty,{derive:"barrierColorProperty"}),generateAddedFaceColorProperty=new DynamicProperty(themeProperty,{derive:"generateAddedFaceColorProperty"}),generateMinimizedFaceColorProperty=new DynamicProperty(themeProperty,{derive:"generateMinimizedFaceColorProperty"}),rectangularButtonAppearanceStrategy=RectangularButton.FlatAppearanceStrategy,uiFontFamily=platform.firefox?"Arial, sans-serif":"Helvetica, Arial, sans-serif",controlBarFont=new Font({family:uiFontFamily,size:15}),uiFont=new Font({family:uiFontFamily,size:16}),uiHeaderFont=new Font({family:uiFontFamily,size:16,weight:"bold"}),puzzleFont=new Font({family:uiFontFamily,size:25}),generateButtonFont=new Font({family:uiFontFamily,size:25}),linesVisibleProperty=new LocalStorageBooleanProperty("linesVisibleProperty",!0),edgeColorsVisibleProperty=new LocalStorageBooleanProperty("simpleRegionColorsVisibleProperty",!0),faceColorsVisibleProperty=new LocalStorageBooleanProperty("faceColorsVisibleProperty",!0),sectorsVisibleProperty=new LocalStorageBooleanProperty("sectorsVisibleProperty",!1),sectorsNextToEdgesVisibleProperty=new LocalStorageBooleanProperty("sectorsNextToEdgesVisibleProperty",!1),sectorsTrivialVisibleProperty=new LocalStorageBooleanProperty("sectorsTrivialVisibleProperty",!1),vertexStateVisibleProperty=new LocalStorageBooleanProperty("vertexStateVisibleProperty",!1),allVertexStateVisibleProperty=new LocalStorageBooleanProperty("allVertexStateVisibleProperty",!1),faceStateVisibleProperty=new LocalStorageBooleanProperty("faceStateVisibleProperty",!1),redLineVisibleProperty=new LocalStorageBooleanProperty("redLineVisibleProperty",!1),whiteLineVisibleProperty=new LocalStorageBooleanProperty("whiteLineVisibleProperty",!0),verticesVisibleProperty=new LocalStorageBooleanProperty("verticesVisibleProperty",!1),redXsVisibleProperty=new LocalStorageBooleanProperty("redXsVisibleProperty",!1),redXsAlignedProperty=new LocalStorageBooleanProperty("redXsAlignedProperty",!1),showHoverHighlightsProperty=new LocalStorageBooleanProperty("showHoverHighlightsProperty",!1),faceColorThresholdProperty=new LocalStorageNumberProperty("faceColorThresholdProperty",Number.POSITIVE_INFINITY),lineJoins=["miter","round","bevel"],joinedLinesJoinProperty=new LocalStorageStringProperty("joinedLinesJoinProperty","round"),lineCaps=["butt","round","square"],joinedLinesCapProperty=new LocalStorageStringProperty("joinedLinesCapProperty","round"),vertexStyles=["round","square"],vertexStyleProperty=new LocalStorageStringProperty("vertexStyleProperty","round"),redLineStyles=["full","gap","middle"],redLineStyleProperty=new LocalStorageStringProperty("redLineStyleProperty","middle"),faceValueStyles=["static","remaining","ratio"],faceValueStyleProperty=new LocalStorageStringProperty("faceValueStyleProperty","static"),smallVertexProperty=new LocalStorageBooleanProperty("smallVertexProperty",!0),controlBarMargin=5,assert$2=(o,...e)=>window.assert(o,...e),assertEnabled=()=>!!window.assert;class BaseVertex{constructor(e,t){ut(this,"incomingHalfEdges");ut(this,"outgoingHalfEdges");ut(this,"edges");ut(this,"faces");this.logicalCoordinates=e,this.viewCoordinates=t,assertEnabled()&&assert$2(e),assertEnabled()&&assert$2(t)}getHalfEdgeTo(e){const t=this.outgoingHalfEdges.find(n=>n.end===e);return assertEnabled()&&assert$2(t),t}getHalfEdgeFrom(e){const t=this.incomingHalfEdges.find(n=>n.start===e);return assertEnabled()&&assert$2(t),t}getEdgeTo(e){const t=this.edges.find(n=>n.start===e||n.end===e);return assertEnabled()&&assert$2(t),t}}class BaseFace{constructor(e,t){ut(this,"halfEdges");ut(this,"edges");ut(this,"vertices");this.logicalCoordinates=e,this.viewCoordinates=t,assertEnabled()&&assert$2(e),assertEnabled()&&assert$2(t)}}class BaseEdge{constructor(e,t){ut(this,"forwardHalf");ut(this,"reversedHalf");ut(this,"forwardFace");ut(this,"reversedFace");ut(this,"vertices");ut(this,"faces");this.start=e,this.end=t,assertEnabled()&&assert$2(e),assertEnabled()&&assert$2(t)}getOtherVertex(e){return assertEnabled()&&assert$2(e===this.start||e===this.end,"vertex must be one of the two vertices of this edge"),e===this.start?this.end:this.start}getOtherFace(e){return assertEnabled()&&assert$2(e===this.forwardFace||e===this.reversedFace,"face must be one of the two faces of this edge"),e===this.forwardFace?this.reversedFace:this.forwardFace}}class BaseHalfEdge{constructor(e,t,n){ut(this,"edge");ut(this,"reversed");ut(this,"next");ut(this,"previous");ut(this,"face",null);this.start=e,this.end=t,this.isReversed=n,assertEnabled()&&assert$2(e),assertEnabled()&&assert$2(t)}}const _$1=window._,getSignedArea=o=>{let e=0;for(let t=0;t<o.length;t++){const n=o[t],r=o[(t+1)%o.length];e+=(r.x+n.x)*(r.y-n.y)}return .5*e},getArea=o=>Math.abs(getSignedArea(o)),getCentroid=o=>{const e=getSignedArea(o);if(e===0)return o.reduce((r,s)=>r.plus(s),new Vector2(0,0)).timesScalar(1/o.length);let t=0,n=0;for(let r=0;r<o.length;r++){const s=o[r],a=o[(r+1)%o.length],l=s.x*(2*s.y+a.y)+a.x*(s.y+2*a.y);t+=(s.x-a.x)*l,n+=(a.y-s.y)*l}return new Vector2(t,n).timesScalar(1/(6*e))},getSignedAreaDerivative=(o,e)=>{let t=0;for(let n=0;n<o.length;n++){const r=o[n],s=o[(n+1)%o.length],a=e[n],l=e[(n+1)%o.length];t+=(s.x+r.x)*(l.y-a.y)+(l.x-a.x)*(s.y-r.y)}return .5*t},rescaleProtoDescriptor=(o,e)=>{const t=o.faces.map(a=>getArea(a.vertices.map(l=>l.viewCoordinates))),n=e(t),r=o.vertices.map(a=>({logicalCoordinates:a.logicalCoordinates,viewCoordinates:a.viewCoordinates.timesScalar(n)})),s=new Map(r.map((a,l)=>[o.vertices[l],a]));return{vertices:r,faces:o.faces.map(a=>({logicalCoordinates:a.logicalCoordinates,vertices:a.vertices.map(l=>s.get(l))}))}},rescaleProtoDescriptorAverage=(o,e)=>rescaleProtoDescriptor(o,t=>Math.sqrt(e/(_$1.sum(t)/t.length))),rescaleProtoDescriptorMinimum=(o,e)=>rescaleProtoDescriptor(o,t=>Math.sqrt(e/Math.min(...t)));class EdgeIdentifier{constructor(e,t){this.start=e,this.end=t}isCanonicalHalfEdge(){return this.start.x<this.end.x||this.start.x===this.end.x&&this.start.y<this.end.y}}class EdgeIdentifierLookup{constructor(){ut(this,"identifiers",[]);ut(this,"canonicalIdentifiers",[]);ut(this,"map",new Map)}add(e,t){if(assertEnabled()&&assert$2(e.x!==t.x||e.y!==t.y),this.lookupAttempt(e,t)!==null)return;const n=(r,s)=>{let a;this.map.has(r)?a=this.map.get(r):(a=new Map,this.map.set(r,a));const l=new EdgeIdentifier(r,s);a.set(s,l),this.identifiers.push(l),l.isCanonicalHalfEdge()&&this.canonicalIdentifiers.push(l)};n(e,t),n(t,e)}getAdjacentLocations(e){const t=this.map.get(e);return t?Array.from(t.keys()):[]}lookupAttempt(e,t){const n=this.map.get(e);return n?n.get(t)??null:null}lookup(e,t){const n=this.lookupAttempt(e,t);return assertEnabled()&&assert$2(n),n}lookupCanonical(e,t){const n=this.lookup(e,t);return n.isCanonicalHalfEdge()?n:this.lookup(t,e)}}const createBoardDescriptor=o=>{const e=o.vertices;let t=o.faces;t=t.map(X=>getSignedArea(X.vertices.map(ae=>ae.viewCoordinates))>0?X:{logicalCoordinates:X.logicalCoordinates,vertices:X.vertices.slice().reverse()});const n=new EdgeIdentifierLookup;t.forEach(X=>{for(let ae=0;ae<X.vertices.length;ae++){const oe=X.vertices[ae].logicalCoordinates,ue=X.vertices[(ae+1)%X.vertices.length].logicalCoordinates;n.add(oe,ue)}});const r=new Map,s=new Map,a=new Map,l=new Map,d=X=>r.get(X)??null,c=X=>s.get(X)??null,y=(X,ae)=>{const oe=n.lookup(X,ae);return l.get(oe)??null},m=e.map(X=>new BaseVertex(X.logicalCoordinates,X.viewCoordinates));m.forEach(X=>r.set(X.logicalCoordinates,X));const O=t.map(X=>new BaseFace(X.logicalCoordinates,getCentroid(X.vertices.map(ae=>ae.viewCoordinates))));O.forEach(X=>s.set(X.logicalCoordinates,X));const D=n.canonicalIdentifiers.map(X=>new BaseEdge(d(X.start),d(X.end)));D.forEach(X=>a.set(n.lookupCanonical(X.start.logicalCoordinates,X.end.logicalCoordinates),X));const z=n.identifiers.map(X=>new BaseHalfEdge(d(X.start),d(X.end),!X.isCanonicalHalfEdge()));z.forEach(X=>l.set(n.lookup(X.start.logicalCoordinates,X.end.logicalCoordinates),X)),D.forEach(X=>{const ae=y(X.start.logicalCoordinates,X.end.logicalCoordinates),oe=y(X.end.logicalCoordinates,X.start.logicalCoordinates);assertEnabled()&&assert$2(ae),assertEnabled()&&assert$2(oe),ae.edge=X,oe.edge=X,ae.reversed=oe,oe.reversed=ae,X.forwardHalf=ae,X.reversedHalf=oe,X.vertices=[X.start,X.end]}),t.forEach(X=>{const ae=c(X.logicalCoordinates),oe=X.vertices.map(be=>d(be.logicalCoordinates)),ue=[],fe=[];for(let be=0;be<oe.length;be++){const Ae=X.vertices[be].logicalCoordinates,W=X.vertices[(be+1)%oe.length].logicalCoordinates,J=X.vertices[(be+2)%oe.length].logicalCoordinates,Ue=y(Ae,W);Ue.face=ae;const gt=y(W,J);Ue.next=gt,gt.previous=Ue,fe.push(Ue),ue.push(Ue.edge)}ae.halfEdges=fe,ae.edges=ue,ae.vertices=oe}),z.forEach(X=>{X.face===void 0&&(X.face=null)}),D.forEach(X=>{X.forwardFace=X.forwardHalf.face,X.reversedFace=X.reversedHalf.face,X.faces=[X.forwardFace,X.reversedFace].filter(ae=>ae!==null)});const w=new Set(z.filter(X=>X.face===null)),N=[],H=[];for(;w.size;){const X=w.values().next().value;w.delete(X);const ae=fe=>{assertEnabled()&&assert$2(fe.face===null);const be=fe.end.logicalCoordinates,J=n.getAdjacentLocations(be).filter(Ue=>Ue!==fe.start.logicalCoordinates).map(Ue=>y(be,Ue)).filter(Ue=>Ue.face===null);return assertEnabled()&&assert$2(J.length===1),J[0]},oe=[X];let ue=ae(X);for(X.next=ue,ue.previous=X;ue!==X;){oe.push(ue),w.delete(ue);const fe=ue;ue=ae(ue),fe.next=ue,ue.previous=fe}getSignedArea(oe.map(fe=>fe.start.viewCoordinates))<0?N.push(oe):H.push(oe)}return assertEnabled()&&assert$2(N.length===1),m.forEach(X=>{const ae=n.getAdjacentLocations(X.logicalCoordinates),oe=y(ae[0],X.logicalCoordinates);let ue=oe;const fe=[oe];for(;ue.reversed.previous!==oe;)assertEnabled()&&assert$2(ue.reversed.previous),ue=ue.reversed.previous,fe.push(ue);X.incomingHalfEdges=fe,X.outgoingHalfEdges=fe.map(be=>be.reversed),X.edges=fe.map(be=>be.edge),X.faces=fe.map(be=>be.face).filter(be=>be!==null)}),{edges:D,vertices:m,faces:O,halfEdges:z,outerBoundary:N[0],innerBoundaries:H}},Qs=class Qs extends EnumerationValue{constructor(e){super(),this.isEnabledProperty=e}};ut(Qs,"EDGE_STATE",new Qs(new BooleanProperty(!0))),ut(Qs,"EDGE_STATE_REVERSED",new Qs(new BooleanProperty(!0))),ut(Qs,"FACE_COLOR_MATCH",new Qs(faceColorsVisibleProperty)),ut(Qs,"FACE_COLOR_OPPOSITE",new Qs(faceColorsVisibleProperty)),ut(Qs,"SECTOR_STATE",new Qs(sectorsVisibleProperty)),ut(Qs,"VERTEX_STATE",new Qs(vertexStateVisibleProperty)),ut(Qs,"FACE_STATE",new Qs(faceStateVisibleProperty)),ut(Qs,"FACE_VALUE",new Qs(new BooleanProperty(!1))),ut(Qs,"DELETE_FACE",new Qs(new BooleanProperty(!1))),ut(Qs,"enumeration",new Enumeration(Qs));let EditMode=Qs;const editModeProperty=new LocalStorageEnumerationProperty("editModeProperty",EditMode.EDGE_STATE);let listenedMode=null;const onEditModeEnabledChange=o=>{o||(editModeProperty.value=EditMode.EDGE_STATE)};editModeProperty.link(o=>{listenedMode&&listenedMode.isEnabledProperty.unlink(onEditModeEnabledChange),console.log("editMode",o.name),listenedMode=o,o.isEnabledProperty.link(onEditModeEnabledChange)});const tryToSetEditMode=o=>{o.isEnabledProperty.value&&(editModeProperty.value=o)},isEdgeEditModeProperty=new DerivedProperty([editModeProperty],o=>o===EditMode.EDGE_STATE||o===EditMode.EDGE_STATE_REVERSED),isFaceColorEditModeProperty=new DerivedProperty([editModeProperty],o=>o===EditMode.FACE_COLOR_MATCH||o===EditMode.FACE_COLOR_OPPOSITE),isSectorEditModeProperty=new DerivedProperty([editModeProperty],o=>o===EditMode.SECTOR_STATE),isVertexEditModeProperty=new DerivedProperty([editModeProperty],o=>o===EditMode.VERTEX_STATE),isFaceEditModeProperty=new DerivedProperty([editModeProperty,isFaceColorEditModeProperty],(o,e)=>e||o===EditMode.FACE_STATE||o===EditMode.FACE_VALUE||o===EditMode.DELETE_FACE),so=class so extends EnumerationValue{};ut(so,"WHITE",new so),ut(so,"BLACK",new so),ut(so,"RED",new so),ut(so,"enumeration",new Enumeration(so));let EdgeState=so;const serializeFace=o=>({x:o.logicalCoordinates.x,y:o.logicalCoordinates.y}),deserializeFace=(o,e)=>{const t=o.faces.find(n=>n.logicalCoordinates.x===e.x&&n.logicalCoordinates.y===e.y);return assertEnabled()&&assert$2(t),t},no=class no extends EnumerationValue{};ut(no,"OUTSIDE",new no),ut(no,"INSIDE",new no),ut(no,"UNDECIDED",new no),ut(no,"enumeration",new Enumeration(no));let FaceColorState=no;const serializeFaceColor=(o,e,t)=>({id:o.id,colorState:o.colorState.toString(),faces:e.map(serializeFace),oppositeFaceColorId:t}),serializeFaceColorData=o=>({type:"FaceColorData",colors:o.getFaceColors().map(e=>{var t;return serializeFaceColor(e,o.getFacesWithColor(e),((t=o.getOppositeFaceColor(e))==null?void 0:t.id)??null)}),invalidFaceColor:o.hasInvalidFaceColors()}),ms=class ms extends EnumerationValue{constructor(e,t,n,r){super(),this.zero=e,this.one=t,this.two=n,this.serializedValue=r}allows(e){return assertEnabled()&&assert$2(e===0||e===1||e===2),e===0&&this.zero||e===1&&this.one||e===2&&this.two}isSubsetOf(e){return(!this.zero||e.zero)&&(!this.one||e.one)&&(!this.two||e.two)}and(e){return ms.getWithValue(this.zero&&e.zero,this.one&&e.one,this.two&&e.two)}or(e){return ms.getWithValue(this.zero||e.zero,this.one||e.one,this.two||e.two)}withZero(e){return ms.getWithValue(e,this.one,this.two)}withOne(e){return ms.getWithValue(this.zero,e,this.two)}withTwo(e){return ms.getWithValue(this.zero,this.one,e)}with(e){return assertEnabled()&&assert$2(e===0||e===1||e===2),ms.getWithValue(e===0?!0:this.zero,e===1?!0:this.one,e===2?!0:this.two)}withAllowZero(){return this.withZero(!0)}withAllowOne(){return this.withOne(!0)}withAllowTwo(){return this.withTwo(!0)}withDisallowZero(){return this.withZero(!1)}withDisallowOne(){return this.withOne(!1)}withDisallowTwo(){return this.withTwo(!1)}serialize(){return this.serializedValue}static getWithValue(e,t,n){return ms.enumeration.values.find(r=>r.zero===e&&r.one===t&&r.two===n)}static getOnly(e){return assertEnabled()&&assert$2(e===0||e===1||e===2),ms.getWithValue(e===0,e===1,e===2)}static getNot(e){return assertEnabled()&&assert$2(e===0||e===1||e===2),ms.getWithValue(e!==0,e!==1,e!==2)}static deserialize(e){const t=sectorStateMap.get(e);return assertEnabled()&&assert$2(t,`invalid serialized value: ${e}`),t}};ut(ms,"NONE",new ms(!1,!1,!1,0)),ut(ms,"ONLY_ZERO",new ms(!0,!1,!1,1)),ut(ms,"ONLY_ONE",new ms(!1,!0,!1,2)),ut(ms,"ONLY_TWO",new ms(!1,!1,!0,3)),ut(ms,"NOT_ZERO",new ms(!1,!0,!0,4)),ut(ms,"NOT_ONE",new ms(!0,!1,!0,5)),ut(ms,"NOT_TWO",new ms(!0,!0,!1,6)),ut(ms,"ANY",new ms(!0,!0,!0,7)),ut(ms,"enumeration",new Enumeration(ms)),ut(ms,"trivialStates",[ms.NONE,ms.ONLY_ZERO,ms.ONLY_TWO,ms.ANY]);let SectorState=ms;const sectorStateMap=new Map(SectorState.enumeration.values.map(o=>[o.serializedValue,o])),getSectorsFromVertex=o=>o.incomingHalfEdges,getFaceOrderedSectorsFromVertex=o=>{let e=getSectorsFromVertex(o);return e=[...e.slice(1),e[0]],assertEnabled()&&assert$2(e[0].edge===o.edges[1]&&e[0].next.edge===o.edges[0]),e},packBooleanArray=o=>{const e=new Uint8Array(Math.ceil(o.length/8));for(let n=0;n<o.length;n++)o[n]&&(e[Math.floor(n/8)]|=1<<7-n%8);const t=btoa(String.fromCharCode(...e));if(assertEnabled()){const n=unpackBooleanArray(t,o.length);assert$2(o.length===n.length&&o.every((r,s)=>r===n[s]))}return t},unpackBooleanArray=(o,e)=>{const t=Uint8Array.from(atob(o),r=>r.charCodeAt(0)),n=[];for(let r=0;r<t.length*8;r++)n.push((t[Math.floor(r/8)]&1<<7-r%8)!==0);return n.slice(0,e)};class VertexState{constructor(e,t,n){ut(this,"order");ut(this,"possibilityCount");ut(this,"matrix");this.vertex=e,this.order=e.edges.length,t?this.matrix=t:this.matrix=_$1.range(0,VertexState.getMatrixSize(this.order)).map(()=>!0),n!==void 0?this.possibilityCount=n:this.possibilityCount=this.matrix.filter(r=>r).length,assertEnabled()&&assert$2(this.matrix.length===VertexState.getMatrixSize(this.order)),assertEnabled()&&assert$2(this.possibilityCount===this.matrix.filter(r=>r).length)}isAny(){return this.possibilityCount===VertexState.getMatrixSize(this.order)}isForced(){return this.possibilityCount===1}allowsEmpty(){return this.matrix[VertexState.getMatrixSize(this.order)-1]}allowsPair(e,t){return this.matrix[this.getPairIndex(e,t)]}getBinaryCombinationsAllowed(e,t){let n=this.allowsEmpty(),r=!1,s=!1,a=!1;for(const l of this.getAllowedPairs()){const d=l[0]===e||l[1]===e,c=l[0]===t||l[1]===t;d&&c?r=!0:d?s=!0:c?a=!0:n=!0}return{allowsNone:n,allowsBoth:r,allowsAOnly:s,allowsBOnly:a}}getAllowedPairs(){const e=[];let t=0;for(let n=0;n<this.order;n++)for(let r=n+1;r<this.order;r++)this.matrix[t++]&&e.push([this.vertex.edges[n],this.vertex.edges[r]]);return e}getFinalStatesOfEdge(e){const t=new Set;for(const n of this.getAllowedPairs())n[0]===e||n[1]===e?t.add(EdgeState.BLACK):t.add(EdgeState.RED);return this.allowsEmpty()&&t.add(EdgeState.RED),t}getPairIndex(e,t){const n=this.vertex.edges.indexOf(e),r=this.vertex.edges.indexOf(t),s=Math.min(n,r),a=Math.max(n,r);return VertexState.getIndex(s,a,this.order)}equals(e){return this.vertex===e.vertex&&this.matrix.every((t,n)=>t===e.matrix[n])}and(e){return assertEnabled()&&assert$2(this.vertex===e.vertex),new VertexState(this.vertex,this.matrix.map((t,n)=>t&&e.matrix[n]))}or(e){return assertEnabled()&&assert$2(this.vertex===e.vertex),new VertexState(this.vertex,this.matrix.map((t,n)=>t||e.matrix[n]))}isSubsetOf(e){return this.matrix.every((t,n)=>!t||e.matrix[n])}withEmpty(e){return new VertexState(this.vertex,this.matrix.slice(0,-1).concat(e))}withPair(e,t,n){const r=this.getPairIndex(e,t);return new VertexState(this.vertex,this.matrix.slice(0,r).concat(n,this.matrix.slice(r+1)))}serialize(){const e=packBooleanArray(this.matrix);return assertEnabled()&&assert$2(this.equals(VertexState.deserialize(this.vertex,e))),e}static getIndex(e,t,n){return e*(2*n-e-1)/2+(t-e-1)}static getMatrixSize(e){return e*(e-1)/2+1}static fromLookup(e,t,n){const r=e.edges.length,s=[];for(let a=0;a<r;a++)for(let l=a+1;l<r;l++)s.push(t(e.edges[a],e.edges[l]));return s.push(n),new VertexState(e,s)}static none(e){return VertexState.fromLookup(e,()=>!1,!1)}static any(e){return VertexState.fromLookup(e,()=>!0,!0)}static withOnlyEmpty(e){return VertexState.fromLookup(e,()=>!1,!0)}static withOnlyPair(e,t,n){return VertexState.fromLookup(e,(r,s)=>r===t&&s===n||r===n&&s===t,!1)}static withoutEmpty(e){return VertexState.fromLookup(e,()=>!0,!1)}static withoutPair(e,t,n){return VertexState.fromLookup(e,(r,s)=>r!==t&&r!==n||s!==t&&s!==n,!0)}static fromEdgeColorSectorData(e,t){const n=e.edges.length,r=[],s=e.edges.filter(w=>t.getEdgeState(w)===EdgeState.BLACK);if(s.length>2)return VertexState.none(e);if(s.length===2)return VertexState.withOnlyPair(e,s[0],s[1]);const a=s.length?s[0]:null,l=new Set(e.edges.filter(w=>t.getEdgeState(w)===EdgeState.RED));if(l.size===n)return VertexState.withOnlyEmpty(e);const d=getFaceOrderedSectorsFromVertex(e),c=d.map(w=>t.getSectorState(w)),y=c.every(w=>w.zero),m=d.map(w=>w.face?t.getFaceColor(w.face):t.getOutsideColor()),O=new Set(m),D=new Map([...O].map(w=>[w,t.getOppositeFaceColor(w)])),z=[...D.values()].every(w=>!w||!O.has(w));for(let w=0;w<n;w++){const N=e.edges[w];if(l.has(N)){for(let H=w+1;H<n;H++)r.push(!1);continue}for(let H=w+1;H<n;H++){let X=!0;const ae=e.edges[H];if(X&&l.has(ae)&&(X=!1),X&&a&&N!==a&&ae!==a&&(X=!1),X&&(X=X&&c.every((oe,ue)=>{const fe=d[ue];let be=0;return(N===fe.edge||N===fe.next.edge)&&be++,(ae===fe.edge||ae===fe.next.edge)&&be++,oe.allows(be)})),X){const oe=m.slice(w,H),ue=[...m.slice(H),...m.slice(0,w)];oe.some(fe=>ue.includes(fe))&&(X=!1),X&&oe.some(fe=>{const be=D.get(fe);return be&&oe.includes(be)})&&(X=!1),X&&ue.some(fe=>{const be=D.get(fe);return be&&ue.includes(be)})&&(X=!1)}r.push(X)}}return r.push(s.length===0&&y&&z),new VertexState(e,r)}static deserialize(e,t){return new VertexState(e,unpackBooleanArray(t,VertexState.getMatrixSize(e.edges.length)))}}class BaseBoard{constructor(e){ut(this,"edges");ut(this,"vertices");ut(this,"faces");ut(this,"halfEdges");ut(this,"outerBoundary");ut(this,"innerBoundaries");this.boardDescriptor=e,this.edges=e.edges,this.vertices=e.vertices,this.faces=e.faces,this.halfEdges=e.halfEdges,this.outerBoundary=e.outerBoundary,this.innerBoundaries=e.innerBoundaries}}const validateBoard=o=>{assertEnabled()&&(o.edges.forEach(e=>{const t=e.forwardHalf,n=e.reversedHalf;assert$2(t.edge===e),assert$2(n.edge===e),assert$2(!t.isReversed),assert$2(n.isReversed),assert$2(t.reversed===n),assert$2(n.reversed===t),assert$2(t.start===e.start),assert$2(t.end===e.end),assert$2(n.start===e.end),assert$2(n.end===e.start),assert$2(t.next.previous===t),assert$2(t.previous.next===t),assert$2(n.next.previous===n),assert$2(n.previous.next===n),assert$2(t.next!==t),assert$2(t.previous!==t),assert$2(n.next!==n),assert$2(n.previous!==n),assert$2(t.next.face===t.face),assert$2(t.previous.face===t.face),assert$2(n.next.face===n.face),assert$2(n.previous.face===n.face),assert$2(t.face===e.forwardFace),assert$2(n.face===e.reversedFace)}),o.vertices.forEach(e=>{e.incomingHalfEdges.forEach(r=>{assert$2(r.end===e)}),e.outgoingHalfEdges.forEach(r=>{assert$2(r.start===e)});const t=r=>e.incomingHalfEdges[(r+e.incomingHalfEdges.length)%e.incomingHalfEdges.length],n=r=>e.outgoingHalfEdges[(r+e.outgoingHalfEdges.length)%e.outgoingHalfEdges.length];_$1.range(0,e.incomingHalfEdges.length).forEach(r=>{const s=t(r),a=n(r);assert$2(s.reversed===a),assert$2(s.next===n(r-1)),assert$2(a.previous===t(r+1))}),e.edges.forEach(r=>{assert$2(r.start===e||r.end===e),assert$2(e.incomingHalfEdges.includes(r.forwardHalf)||e.outgoingHalfEdges.includes(r.forwardHalf)),assert$2(e.incomingHalfEdges.includes(r.reversedHalf)||e.outgoingHalfEdges.includes(r.reversedHalf)),r.forwardFace&&(assert$2(r.forwardFace.vertices.includes(e)),assert$2(e.faces.includes(r.forwardFace))),r.reversedFace&&(assert$2(r.reversedFace.vertices.includes(e)),assert$2(e.faces.includes(r.reversedFace)))}),e.faces.forEach(r=>{assert$2(r.vertices.includes(e))})}))},serializeFaceValueData=(o,e)=>({type:"FaceValueData",faces:o.faces.filter(t=>e.getFaceValue(t)!==null).map(t=>({face:serializeFace(t),state:e.getFaceValue(t)}))}),serializeEdge=o=>({start:{x:o.start.logicalCoordinates.x,y:o.start.logicalCoordinates.y},end:{x:o.end.logicalCoordinates.x,y:o.end.logicalCoordinates.y}}),deserializeEdge=(o,e)=>{const t=o.edges.find(n=>n.start.logicalCoordinates.x===e.start.x&&n.start.logicalCoordinates.y===e.start.y&&n.end.logicalCoordinates.x===e.end.x&&n.end.logicalCoordinates.y===e.end.y);return assertEnabled()&&assert$2(t),t},serializeEdgeStateData=(o,e)=>({type:"EdgeData",edges:o.edges.filter(t=>e.getEdgeState(t)!==EdgeState.WHITE).map(t=>({edge:serializeEdge(t),state:e.getEdgeState(t).name}))}),serializeHalfEdge=o=>({start:{x:o.start.logicalCoordinates.x,y:o.start.logicalCoordinates.y},end:{x:o.end.logicalCoordinates.x,y:o.end.logicalCoordinates.y}}),deserializeHalfEdge=(o,e)=>{const t=o.halfEdges.find(n=>n.start.logicalCoordinates.x===e.start.x&&n.start.logicalCoordinates.y===e.start.y&&n.end.logicalCoordinates.x===e.end.x&&n.end.logicalCoordinates.y===e.end.y);return assertEnabled()&&assert$2(t),t},serializedSimpleRegion=o=>({id:o.id,halfEdges:o.halfEdges.map(serializeHalfEdge),isSolved:o.isSolved}),simpleRegionIsSolved=o=>{const e=o.getSimpleRegions();return e.length===1&&e[0].isSolved&&o.getWeirdEdges().length===0},serializeSimpleRegionData=o=>({type:"SimpleRegionData",simpleRegions:o.getSimpleRegions().map(serializedSimpleRegion),weirdEdges:o.getWeirdEdges().map(serializeEdge)}),serializeSectorStateData=(o,e)=>({type:"SectorStateData",sectors:o.halfEdges.filter(t=>e.getSectorState(t)!==SectorState.ANY).map(t=>({sector:serializeHalfEdge(t),state:e.getSectorState(t).serialize()}))}),serializeVertex=o=>({x:o.logicalCoordinates.x,y:o.logicalCoordinates.y}),deserializeVertex=(o,e)=>{const t=o.vertices.find(n=>n.logicalCoordinates.x===e.x&&n.logicalCoordinates.y===e.y);return assertEnabled()&&assert$2(t),t},serializeVertexStateData=(o,e)=>({type:"VertexStateData",vertices:o.vertices.filter(t=>!e.getVertexState(t).isAny()).map(t=>({vertex:serializeVertex(t),state:e.getVertexState(t).serialize()}))}),serializeFaceStateData=(o,e)=>({type:"FaceStateData",faces:o.faces.map(t=>({face:serializeFace(t),state:e.getFaceState(t).serialize()}))}),serializeCompleteData=(o,e)=>({type:"CompleteData",faceValueData:serializeFaceValueData(o,e),edgeStateData:serializeEdgeStateData(o,e),simpleRegionData:serializeSimpleRegionData(e),faceColorData:serializeFaceColorData(e),sectorStateData:serializeSectorStateData(o,e),vertexStateData:serializeVertexStateData(o,e),faceStateData:serializeFaceStateData(o,e)});class GeneralFaceValueAction{constructor(e,t=new Map){this.board=e,this.faceValueMap=t}apply(e){for(const[t,n]of this.faceValueMap)e.setFaceValue(t,n)}getUndo(e){const t=new Map;for(const n of this.faceValueMap.keys())t.set(n,e.getFaceValue(n));return new GeneralFaceValueAction(this.board,t)}isEmpty(){return this.faceValueMap.size===0}serializeAction(){return{type:"GeneralFaceAction",faces:Array.from(this.faceValueMap.entries()).map(([e,t])=>({face:serializeFace(e),state:t}))}}static deserializeAction(e,t){return new GeneralFaceValueAction(e,new Map(t.faces.map(n=>[deserializeFace(e,n.face),n.state])))}}class GeneralFaceValueDelta extends GeneralFaceValueAction{constructor(t,n,r=new Map){super(t,r);ut(this,"faceValueChangedEmitter",new TinyEmitter);this.parentState=n}getFaceValue(t){return this.faceValueMap.has(t)?this.faceValueMap.get(t):this.parentState.getFaceValue(t)}setFaceValue(t,n){this.getFaceValue(t)!==n&&(this.faceValueMap.set(t,n),this.faceValueChangedEmitter.emit(t,n))}clone(){return new GeneralFaceValueDelta(this.board,this.parentState,new Map(this.faceValueMap))}createDelta(){return new GeneralFaceValueDelta(this.board,this,new Map)}serializeState(t){return serializeFaceValueData(t,this)}}class GeneralFaceValueData{constructor(e,t){ut(this,"faceValueChangedEmitter",new TinyEmitter);ut(this,"faceValueMap",new Map);this.board=e,e.faces.forEach(n=>{this.faceValueMap.set(n,t(n))})}getFaceValue(e){return assertEnabled()&&assert$2(this.faceValueMap.has(e)),this.faceValueMap.get(e)}setFaceValue(e,t){assertEnabled()&&assert$2(this.faceValueMap.has(e)),this.faceValueMap.get(e)!==t&&(this.faceValueMap.set(e,t),this.faceValueChangedEmitter.emit(e,t))}clone(){return new GeneralFaceValueData(this.board,e=>this.getFaceValue(e))}createDelta(){return new GeneralFaceValueDelta(this.board,this)}serializeState(e){return serializeFaceValueData(e,this)}static deserializeState(e,t){const n=new Map(t.faces.map(r=>[deserializeFace(e,r.face),r.state]));return new GeneralFaceValueData(e,r=>n.get(r)??null)}}class GeneralEdgeStateAction{constructor(e,t=new Map){this.board=e,this.edgeStateMap=t}apply(e){for(const[t,n]of this.edgeStateMap)e.setEdgeState(t,n)}getUndo(e){const t=new Map;for(const n of this.edgeStateMap.keys())t.set(n,e.getEdgeState(n));return new GeneralEdgeStateAction(this.board,t)}isEmpty(){return this.edgeStateMap.size===0}serializeAction(){return{type:"GeneralEdgeAction",edges:Array.from(this.edgeStateMap.entries()).map(([e,t])=>({edge:serializeEdge(e),state:t.name}))}}static deserializeAction(e,t){return new GeneralEdgeStateAction(e,new Map(t.edges.map(n=>[deserializeEdge(e,n.edge),EdgeState.enumeration.getValue(n.state)])))}}class GeneralEdgeStateDelta extends GeneralEdgeStateAction{constructor(t,n,r=new Map){super(t,r);ut(this,"edgeStateChangedEmitter",new TinyEmitter);this.parentState=n}getEdgeState(t){return this.edgeStateMap.has(t)?this.edgeStateMap.get(t):this.parentState.getEdgeState(t)}setEdgeState(t,n){const r=this.getEdgeState(t);r!==n&&(this.edgeStateMap.set(t,n),this.edgeStateChangedEmitter.emit(t,n,r))}clone(){return new GeneralEdgeStateDelta(this.board,this.parentState,new Map(this.edgeStateMap))}createDelta(){return new GeneralEdgeStateDelta(this.board,this,new Map)}serializeState(t){return serializeEdgeStateData(t,this)}}class GeneralEdgeStateData{constructor(e,t){ut(this,"edgeStateChangedEmitter",new TinyEmitter);ut(this,"edgeStateMap",new Map);this.board=e,e.edges.forEach(n=>{this.edgeStateMap.set(n,t(n))})}getEdgeState(e){return assertEnabled()&&assert$2(this.edgeStateMap.has(e)),this.edgeStateMap.get(e)}setEdgeState(e,t){assertEnabled()&&assert$2(this.edgeStateMap.has(e));const n=this.edgeStateMap.get(e);n!==t&&(this.edgeStateMap.set(e,t),this.edgeStateChangedEmitter.emit(e,t,n))}clone(){return new GeneralEdgeStateData(this.board,e=>this.getEdgeState(e))}createDelta(){return new GeneralEdgeStateDelta(this.board,this)}serializeState(e){return serializeEdgeStateData(e,this)}static deserializeState(e,t){const n=new Map(t.edges.map(r=>[deserializeEdge(e,r.edge),EdgeState.enumeration.getValue(r.state)]));return new GeneralEdgeStateData(e,r=>n.get(r)??EdgeState.WHITE)}}class EdgeStateCycleAction{constructor(e,t=!0){this.edge=e,this.forward=t}apply(e){const t=e.getEdgeState(this.edge);t===EdgeState.WHITE?e.setEdgeState(this.edge,this.forward?EdgeState.BLACK:EdgeState.RED):t===EdgeState.BLACK?e.setEdgeState(this.edge,this.forward?EdgeState.RED:EdgeState.WHITE):e.setEdgeState(this.edge,this.forward?EdgeState.WHITE:EdgeState.BLACK)}getUndo(e){return new EdgeStateCycleAction(this.edge,!this.forward)}isEmpty(){return!1}serializeAction(){return{type:"EdgeStateCycleAction",edge:serializeEdge(this.edge),forward:this.forward}}static deserializeAction(e,t){return new EdgeStateCycleAction(deserializeEdge(e,t.edge),t.forward)}}class EdgeStateSetAction{constructor(e,t){this.edge=e,this.state=t}apply(e){e.setEdgeState(this.edge,this.state)}getUndo(e){const t=e.getEdgeState(this.edge);return new EdgeStateSetAction(this.edge,t)}isEmpty(){return!1}serializeAction(){return{type:"EdgeStateSetAction",edge:serializeEdge(this.edge),state:this.state.name}}static deserializeAction(e,t){return new EdgeStateSetAction(deserializeEdge(e,t.edge),EdgeState.enumeration.getValue(t.state))}}class FaceValueSetAction{constructor(e,t){this.face=e,this.state=t}apply(e){e.setFaceValue(this.face,this.state)}getUndo(e){const t=e.getFaceValue(this.face);return new FaceValueSetAction(this.face,t)}isEmpty(){return!1}serializeAction(){return{type:"FaceValueSetAction",edge:serializeFace(this.face),state:this.state}}static deserializeAction(e,t){return new FaceValueSetAction(deserializeFace(e,t.edge),t.state)}}class NoOpAction{apply(e){}getUndo(e){return this}isEmpty(){return!0}serializeAction(){return{type:"NoOpAction"}}static deserializeAction(e,t){return new NoOpAction}}class CompositeAction{constructor(e){this.actions=e}apply(e){for(let t=0;t<this.actions.length;t++)this.actions[t].apply(e)}getUndo(e){return new CompositeAction(this.actions.map(t=>t.getUndo(e)).reverse())}isEmpty(){return this.actions.some(e=>!e.isEmpty())}serializeAction(){return{type:"CompositeAction",actions:this.actions.map(e=>e.serializeAction())}}static deserializeAction(e,t){return new CompositeAction(t.actions.map(n=>deserializeAction(e,n)))}}class GeneralSimpleRegion{constructor(e,t,n=!1){ut(this,"edges");ut(this,"a");ut(this,"b");if(this.id=e,this.halfEdges=t,this.isSolved=n,this.a=t[0].start,this.b=t[t.length-1].end,this.edges=t.map(r=>r.edge),assertEnabled()){assert$2(t.length>0);for(let r=0;r<t.length-1;r++)assert$2(t[r].end===t[r+1].start)}}static deserializeSimpleRegion(e,t){return new GeneralSimpleRegion(t.id,t.halfEdges.map(n=>deserializeHalfEdge(e,n)),t.isSolved)}}class GeneralSimpleRegionAction{constructor(e,t=new Set,n=new Set,r=new Set,s=new Set){this.board=e,this.addedRegions=t,this.removedRegions=n,this.addedWeirdEdges=r,this.removedWeirdEdges=s}apply(e){e.modifyRegions(this.addedRegions,this.removedRegions,this.addedWeirdEdges,this.removedWeirdEdges)}getUndo(e){return new GeneralSimpleRegionAction(this.board,this.removedRegions,this.addedRegions,this.removedWeirdEdges,this.addedWeirdEdges)}isEmpty(){return this.addedRegions.size===0&&this.removedRegions.size===0&&this.addedWeirdEdges.size===0&&this.removedWeirdEdges.size===0}serializeAction(){return{type:"GeneralSimpleRegionAction",addedRegions:Array.from(this.addedRegions).map(serializedSimpleRegion),removedRegions:Array.from(this.removedRegions).map(serializedSimpleRegion),addedWeirdEdges:Array.from(this.addedWeirdEdges).map(serializeEdge),removedWeirdEdges:Array.from(this.removedWeirdEdges).map(serializeEdge)}}static deserializeAction(e,t){return new GeneralSimpleRegionAction(e,new Set(t.addedRegions.map(n=>GeneralSimpleRegion.deserializeSimpleRegion(e,n))),new Set(t.removedRegions.map(n=>GeneralSimpleRegion.deserializeSimpleRegion(e,n))),new Set(t.addedWeirdEdges.map(n=>deserializeEdge(e,n))),new Set(t.removedWeirdEdges.map(n=>deserializeEdge(e,n))))}}class InvalidStateError extends Error{constructor(e){super(e)}}class CompositeSolver{constructor(e){this.solvers=e}get dirty(){return this.solvers.some(e=>e.dirty)}nextAction(){for(const e of this.solvers)if(e.dirty){const t=e.nextAction();if(t)return t}return null}clone(e){return new CompositeSolver(this.solvers.map(t=>t.clone(e)))}dispose(){this.solvers.forEach(e=>e.dispose())}}class AnnotatedAction{constructor(e,t){this.action=e,this.annotation=t}apply(e){this.action.apply(e)}getUndo(e){return new AnnotatedAction(this.action.getUndo(e),this.annotation)}isEmpty(){return this.action.isEmpty()}serializeAction(){throw new Error("unimplemented")}static deserializeAction(e,t){throw new Error("unimplemented")}}const getSimpleRegionGlobalId=()=>dotRandom.nextInt(Number.MAX_SAFE_INTEGER);class SafeEdgeToSimpleRegionSolver{constructor(e,t){ut(this,"dirtyEdges",new Set);ut(this,"edgeListener");this.board=e,this.state=t,e.edges.forEach(n=>{this.dirtyEdges.add(n)}),this.edgeListener=(n,r)=>{this.dirtyEdges.add(n)},this.state.edgeStateChangedEmitter.addListener(this.edgeListener)}get dirty(){return this.dirtyEdges.size>0}nextAction(){if(!this.dirty)return null;const e=this.state.getSimpleRegions(),t=this.state.getWeirdEdges(),n=new Set,r=new Set;for(const O of this.dirtyEdges)this.state.getEdgeState(O)===EdgeState.BLACK?n.add(O):r.add(O);const s=new Set,a=new Set,l=new Set(e),d=new Set,c=new Set,y=new Set(t);for(const O of r)y.has(O)&&(y.delete(O),c.add(O));for(const O of n)y.has(O)&&n.delete(O),[...l].some(D=>D.halfEdges.some(z=>z.edge===O))&&n.delete(O);for(const O of e)if(O.halfEdges.some(D=>r.has(D.edge))){const D=[];let z=[];for(const w of O.halfEdges)r.has(w.edge)?z.length>0&&(D.push(z),z=[]):z.push(w);if(z.length>0&&D.push(z),a.add(O),l.delete(O),D.length){if(O.isSolved&&D.length>1){const N=D[0][0],H=D[D.length-1][D[D.length-1].length-1];N.start===H.end&&D[0].unshift(...D.pop())}const w=_$1.maxBy(D,N=>N.length);for(const N of D){const H=new GeneralSimpleRegion(N===w?O.id:getSimpleRegionGlobalId(),N);s.add(H),l.add(H)}}}const m=O=>{const D=O.start,z=O.end,w=[...l].find(ue=>ue.a===D||ue.b===D)||null,N=[...l].find(ue=>ue.a===z||ue.b===z)||null,H=D.edges.filter(ue=>this.state.getEdgeState(ue)===EdgeState.BLACK).length,X=z.edges.filter(ue=>this.state.getEdgeState(ue)===EdgeState.BLACK).length;if(H>2||X>2)return!1;const ae=ue=>{l.add(ue),s.add(ue)},oe=ue=>{l.delete(ue),s.has(ue)?s.delete(ue):a.add(ue)};if(w&&N)if(w===N)if(SafeEdgeToSimpleRegionSolver.isSolvedWithAddedEdge(this.board,this.state,w,O))oe(w),ae(new GeneralSimpleRegion(w.id,SafeEdgeToSimpleRegionSolver.combineHalfEdgeArrays(w.halfEdges,[O.forwardHalf]),!0));else return!1;else{const ue=w.halfEdges.length>=N.halfEdges.length?w:N,fe=ue===w?N:w,be=new GeneralSimpleRegion(ue.id,SafeEdgeToSimpleRegionSolver.combineHalfEdgeArrays(ue.halfEdges,[O.forwardHalf],fe.halfEdges));oe(ue),oe(fe),ae(be)}else if(w){const ue=new GeneralSimpleRegion(w.id,SafeEdgeToSimpleRegionSolver.combineHalfEdgeArrays(w.halfEdges,[O.forwardHalf]));oe(w),ae(ue)}else if(N){const ue=new GeneralSimpleRegion(N.id,SafeEdgeToSimpleRegionSolver.combineHalfEdgeArrays(N.halfEdges,[O.forwardHalf]));oe(N),ae(ue)}else{const ue=new GeneralSimpleRegion(getSimpleRegionGlobalId(),[O.forwardHalf]);ae(ue)}return!0};for(const O of y)m(O)&&(c.add(O),y.delete(O));for(const O of n)m(O)||(d.add(O),y.add(O));return this.dirtyEdges.clear(),s.size||a.size||d.size||c.size?new AnnotatedAction(new GeneralSimpleRegionAction(this.board,s,a,d,c),{type:"SimpleRegions"}):null}clone(e){return new SafeEdgeToSimpleRegionSolver(this.board,e)}dispose(){this.state.edgeStateChangedEmitter.removeListener(this.edgeListener)}static isSolvedWithAddedEdge(e,t,n,r){if(r.start!==n.a&&r.start!==n.b||r.end!==n.a&&r.end!==n.b)return!1;const s=new Set(n.edges);s.add(r);for(const a of e.faces){const l=t.getFaceValue(a);if(l!==null&&a.edges.filter(c=>s.has(c)).length!==l)return!1}return!0}static combineHalfEdgeArrays(...e){if(e.length===0)return[];let t=[...e[0]];for(let n=1;n<e.length;n++){const r=e[n];if(r.length!==0)if(t[0].start===r[0].start)t=[...r.map(s=>s.reversed).reverse(),...t];else if(t[0].start===r[r.length-1].end)t=[...r,...t];else if(t[t.length-1].end===r[0].start)t=[...t,...r];else if(t[t.length-1].end===r[r.length-1].end)t=[...t,...r.map(s=>s.reversed).reverse()];else throw new Error("Cannot combine half edge arrays")}return t}}class SimpleVertexSolver{constructor(e,t,n,r){ut(this,"dirtyVertices",[]);ut(this,"edgeListener");this.board=e,this.state=t,this.options=n,r?this.dirtyVertices.push(...r):this.dirtyVertices.push(...e.vertices),this.edgeListener=(s,a)=>{this.dirtyVertices.push(...s.vertices)},this.state.edgeStateChangedEmitter.addListener(this.edgeListener)}get dirty(){return this.dirtyVertices.length>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyVertices.length;){const e=this.dirtyVertices.pop(),t=e.edges;let n=0,r=0;if(t.forEach(s=>{const a=this.state.getEdgeState(s);return a===EdgeState.BLACK?n++:a===EdgeState.WHITE&&r++,a}),n>2)throw new InvalidStateError("Too many black edges on vertex");if(n===1&&r===0)throw new InvalidStateError("Nowhere for the single edge to go");if(r>0){if(this.options.solveJointToRed&&n===2){const s=t.filter(l=>this.state.getEdgeState(l)===EdgeState.WHITE),a=t.filter(l=>this.state.getEdgeState(l)===EdgeState.BLACK);return assertEnabled()&&assert$2(a.length===2),new AnnotatedAction(new CompositeAction(s.map(l=>new EdgeStateSetAction(l,EdgeState.RED))),{type:"JointToRed",vertex:e,whiteEdges:s,blackEdges:a})}else if(this.options.solveForcedLineToBlack&&n===1&&r===1){const s=t.find(l=>this.state.getEdgeState(l)===EdgeState.WHITE),a=t.find(l=>this.state.getEdgeState(l)===EdgeState.BLACK);return assertEnabled()&&assert$2(s),assertEnabled()&&assert$2(a),new AnnotatedAction(new EdgeStateSetAction(s,EdgeState.BLACK),{type:"ForcedLine",vertex:e,blackEdge:a,whiteEdge:s,redEdges:t.filter(l=>this.state.getEdgeState(l)===EdgeState.RED)})}else if(this.options.solveAlmostEmptyToRed&&n===0&&r===1){const s=t.find(a=>this.state.getEdgeState(a)===EdgeState.WHITE);return assertEnabled()&&assert$2(s),new AnnotatedAction(new EdgeStateSetAction(s,EdgeState.RED),{type:"AlmostEmptyToRed",vertex:e,whiteEdge:s,redEdges:t.filter(a=>this.state.getEdgeState(a)===EdgeState.RED)})}}}return null}clone(e){return new SimpleVertexSolver(this.board,e,this.options,this.dirtyVertices)}dispose(){this.state.edgeStateChangedEmitter.removeListener(this.edgeListener)}}class SimpleFaceSolver{constructor(e,t,n,r){ut(this,"dirtyFaces",[]);ut(this,"faceListener");ut(this,"edgeListener");this.board=e,this.state=t,this.options=n,r?this.dirtyFaces.push(...r):this.dirtyFaces.push(...e.faces.filter(s=>t.getFaceValue(s)!==null)),this.faceListener=(s,a)=>{this.dirtyFaces.push(s)},this.edgeListener=(s,a)=>{this.dirtyFaces.push(...s.faces)},this.state.faceValueChangedEmitter.addListener(this.faceListener),this.state.edgeStateChangedEmitter.addListener(this.edgeListener)}get dirty(){return this.dirtyFaces.length>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyFaces.length;){const e=this.dirtyFaces.pop(),t=this.state.getFaceValue(e);if(t!==null){const n=e.edges;let r=0,s=0,a=0;if(n.forEach(l=>{const d=this.state.getEdgeState(l);return d===EdgeState.BLACK?r++:d===EdgeState.RED?s++:a++,d}),r>t)throw new InvalidStateError("Too many black edges on face");if(s>e.edges.length-t)throw new InvalidStateError("Too many red edges on face");if(a>0){if(this.options.solveToRed&&r===t){const l=n.filter(c=>this.state.getEdgeState(c)===EdgeState.WHITE),d=n.filter(c=>this.state.getEdgeState(c)===EdgeState.BLACK);return new AnnotatedAction(new CompositeAction(l.map(c=>new EdgeStateSetAction(c,EdgeState.RED))),{type:"FaceSatisfied",face:e,whiteEdges:l,blackEdges:d})}else if(this.options.solveToBlack&&s===e.edges.length-t){const l=n.filter(c=>this.state.getEdgeState(c)===EdgeState.WHITE),d=n.filter(c=>this.state.getEdgeState(c)===EdgeState.RED);return new AnnotatedAction(new CompositeAction(l.map(c=>new EdgeStateSetAction(c,EdgeState.BLACK))),{type:"FaceAntiSatisfied",face:e,whiteEdges:l,redEdges:d})}}}}return null}clone(e){return new SimpleFaceSolver(this.board,e,this.options,this.dirtyFaces)}dispose(){this.state.faceValueChangedEmitter.removeListener(this.faceListener),this.state.edgeStateChangedEmitter.removeListener(this.edgeListener)}}class SimpleLoopSolver{constructor(e,t,n,r){ut(this,"dirtySimpleRegions");ut(this,"hasDirtyWeirdEdges",!1);ut(this,"simpleRegionListener");ut(this,"edgeListener");this.board=e,this.state=t,this.options=n,r?this.dirtySimpleRegions=new Set(r):this.dirtySimpleRegions=new Set(t.getSimpleRegions()),this.simpleRegionListener=(s,a,l,d)=>{for(const c of a)this.dirtySimpleRegions.delete(c);for(const c of s)this.dirtySimpleRegions.add(c);this.hasDirtyWeirdEdges=t.getWeirdEdges().length>0},this.state.simpleRegionsChangedEmitter.addListener(this.simpleRegionListener),this.edgeListener=(s,a,l)=>{if(a===EdgeState.RED){const d=this.state.getSimpleRegions(),c=y=>{let m=y,O=null,D=0;do{if(D++>1e4)throw new Error("infinite loop detected");const z=m.edges.filter(H=>this.state.getEdgeState(H)===EdgeState.BLACK);if(z.length===1){for(const H of d)(H.a===m||H.b===m)&&this.dirtySimpleRegions.add(H);break}if(z.length!==0)break;const w=m.edges.filter(H=>this.state.getEdgeState(H)===EdgeState.WHITE);if(w.length!==2)break;const N=w[0].getOtherVertex(m)===O?w[1]:w[0];O=m,m=N.getOtherVertex(m)}while(m!==y)};c(s.start),c(s.end)}},this.state.edgeStateChangedEmitter.addListener(this.edgeListener)}get dirty(){return this.dirtySimpleRegions.size>0||this.hasDirtyWeirdEdges}nextAction(){if(!this.dirty)return null;if(this.state.getWeirdEdges().length)throw new InvalidStateError("has weird edges");const e=this.options.resolveAllRegions?new Set(this.state.getSimpleRegions()):this.dirtySimpleRegions;for(;e.size>0;){const t=e.values().next().value;if(!t.isSolved){const n=t.a,r=t.b,s=t.halfEdges[0].edge;for(const a of n.edges){if(a===s||this.state.getEdgeState(a)===EdgeState.RED)continue;const l=[a];let d=a,c=a.getOtherVertex(n);for(;c!==r;){let y=!1;const m=c.edges.filter(O=>{if(O===d)return!1;const D=this.state.getEdgeState(O);return D===EdgeState.BLACK&&(y=!0),D===EdgeState.WHITE});if(m.length!==1||y)break;d=m[0],l.push(d),c=d.getOtherVertex(c)}if(c===r){if(this.isSolvedWithAddedEdges(t,l)){if(this.options.solveToBlack)return new AnnotatedAction(new CompositeAction(l.map(y=>new EdgeStateSetAction(y,EdgeState.BLACK))),{type:"ForcedSolveLoop",a:n,b:r,regionEdges:t.edges,pathEdges:l})}else if(this.options.solveToRed)return new AnnotatedAction(new CompositeAction(l.map(y=>new EdgeStateSetAction(y,EdgeState.RED))),{type:"PrematureForcedLoop",a:n,b:r,regionEdges:t.edges,pathEdges:l})}}}e.delete(t)}return null}isSolvedWithAddedEdges(e,t){const n=new Set(e.edges);for(const r of t)n.add(r);for(const r of this.board.faces){const s=this.state.getFaceValue(r);if(s!==null&&r.edges.filter(l=>n.has(l)).length!==s)return!1}return!0}clone(e){return new SimpleLoopSolver(this.board,e,this.options,this.dirtySimpleRegions)}dispose(){this.state.simpleRegionsChangedEmitter.removeListener(this.simpleRegionListener),this.state.edgeStateChangedEmitter.removeListener(this.edgeListener)}}const iterateSolver=(o,e)=>{let t=0;for(;o.dirty;){if(t++>1e5)throw new Error("Solver iteration limit exceeded? Looped?");const n=o.nextAction();n&&n.apply(e)}},iterateSolverAndDispose=(o,e)=>{try{iterateSolver(o,e)}finally{o.dispose()}},withSolverFactory=(o,e,t,n,r)=>{const s=o(e,t,r);n(),iterateSolverAndDispose(s,t)},iterateSolverFactory=(o,e,t,n)=>{withSolverFactory(o,e,t,()=>{},n)};class MultipleSolutionsError extends Error{constructor(e){super("Multiple solutions found"),this.solutionEdges=e}}class GeneralFaceColor{constructor(e,t){this.id=e,this.colorState=t}}class GeneralFaceColorAction{constructor(e,t,n,r,s,a){this.board=e,this.addedFaceColors=t,this.removedFaceColors=n,this.faceChangeMap=r,this.oppositeChangeMap=s,this.invalidFaceColor=a,assertEnabled()&&assert$2(n.size<=r.size)}apply(e){e.modifyFaceColors(this.addedFaceColors,this.removedFaceColors,this.faceChangeMap,this.oppositeChangeMap,this.invalidFaceColor)}getUndo(e){throw new Error("getUndo unimplemented in GeneralFaceColorAction")}isEmpty(){return this.addedFaceColors.size===0&&this.removedFaceColors.size===0&&this.faceChangeMap.size===0&&this.oppositeChangeMap.size===0}serializeAction(){throw new Error("serializeAction unimplemented in GeneralFaceColorAction")}static deserializeAction(e,t){throw new Error("deserializeAction unimplemented in GeneralFaceColorAction")}}class GeneralFaceColorDelta extends GeneralFaceColorAction{constructor(t,n,r=new Set,s=new Set,a=new Map,l=new Map,d=!1){super(t,r,s,a,l,d);ut(this,"faceColorsChangedEmitter",new TinyEmitter);this.parentState=n}getFaceColors(){return[...[...this.parentState.getFaceColors()].filter(t=>!this.removedFaceColors.has(t)),...this.addedFaceColors]}getInsideColor(){return this.parentState.getInsideColor()}getOutsideColor(){return this.parentState.getOutsideColor()}getFaceColor(t){return this.faceChangeMap.has(t)?this.faceChangeMap.get(t):this.parentState.getFaceColor(t)}getFacesWithColor(t){let n;this.addedFaceColors.has(t)?n=new Set:n=new Set(this.parentState.getFacesWithColor(t));for(const[r,s]of this.faceChangeMap.entries())s===t?n.add(r):n.has(r)&&n.delete(r);return[...n]}getFaceColorMap(){const t=new Map(this.parentState.getFaceColorMap());for(const[n,r]of this.faceChangeMap.entries())t.set(n,r);return t}getOppositeFaceColor(t){const n=this.oppositeChangeMap.get(t);return n!==void 0?n:this.parentState.getOppositeFaceColor(t)}hasInvalidFaceColors(){return this.invalidFaceColor||this.parentState.hasInvalidFaceColors()}modifyFaceColors(t,n,r,s,a){for(const c of t)this.addedFaceColors.add(c);for(const c of n)this.addedFaceColors.has(c)?this.addedFaceColors.delete(c):this.removedFaceColors.add(c);for(const[c,y]of r.entries())this.faceChangeMap.set(c,y);for(const[c,y]of s.entries())this.oppositeChangeMap.set(c,y);const l=new Set(n);for(const c of this.oppositeChangeMap.keys()){const y=this.oppositeChangeMap.get(c);y&&l.has(y)&&this.oppositeChangeMap.set(c,null)}const d=new Set(s.keys());this.invalidFaceColor=a,this.faceColorsChangedEmitter.emit(t,n,d,[...r.keys()])}clone(){return new GeneralFaceColorDelta(this.board,this.parentState,new Set(this.addedFaceColors),new Set(this.removedFaceColors),new Map(this.faceChangeMap),new Map(this.oppositeChangeMap),this.invalidFaceColor||this.parentState.hasInvalidFaceColors())}createDelta(){return new GeneralFaceColorDelta(this.board,this)}serializeState(t){return serializeFaceColorData(this)}}const getFaceColorGlobalId=()=>dotRandom.nextInt(Number.MAX_SAFE_INTEGER);class GeneralFaceColorData{constructor(e,t,n,r,s,a,l,d){ut(this,"faceColorsChangedEmitter",new TinyEmitter);ut(this,"faceColors");ut(this,"colorMap");ut(this,"colorInverseMap");ut(this,"oppositeColorMap");ut(this,"outsideColor");ut(this,"insideColor");ut(this,"invalidFaceColor");this.board=e,assertEnabled()&&assert$2(!t||l,"Provide all or none of the optional arguments"),this.outsideColor=a||new GeneralFaceColor(getFaceColorGlobalId(),FaceColorState.OUTSIDE),this.insideColor=l||new GeneralFaceColor(getFaceColorGlobalId(),FaceColorState.INSIDE),this.colorMap=new Map(n||[...e.faces].map(c=>[c,new GeneralFaceColor(getFaceColorGlobalId(),FaceColorState.UNDECIDED)])),this.faceColors=new Set(t||[this.outsideColor,this.insideColor,...e.faces.map(c=>this.colorMap.get(c))]),assertEnabled()&&assert$2(this.board.faces.every(c=>this.colorMap.has(c))),assertEnabled()&&assert$2(this.board.faces.every(c=>this.faceColors.has(this.colorMap.get(c)))),this.colorInverseMap=new Map(r?[...r.keys()].map(c=>[c,new Set([...r.get(c)])]):[...this.faceColors].map(c=>[c,new Set([...this.colorMap.keys()].filter(y=>this.colorMap.get(y)===c))])),this.oppositeColorMap=new Map(s||[[this.outsideColor,this.insideColor],[this.insideColor,this.outsideColor]]),this.invalidFaceColor=!!d}getFaceColors(){return[...this.faceColors]}getInsideColor(){return this.insideColor}getOutsideColor(){return this.outsideColor}getFaceColor(e){const t=this.colorMap.get(e);return assertEnabled()&&assert$2(t),t}getFacesWithColor(e){assertEnabled()&&assert$2(this.faceColors.has(e));const t=this.colorInverseMap.get(e);return assertEnabled()&&assert$2(t),[...t]}getFaceColorMap(){return new Map(this.colorMap)}getOppositeFaceColor(e){return this.oppositeColorMap.get(e)??null}hasInvalidFaceColors(){return this.invalidFaceColor}modifyFaceColors(e,t,n,r,s){for(const d of e)this.faceColors.add(d),this.colorInverseMap.set(d,new Set);for(const[d,c]of n.entries()){const y=this.colorMap.get(d);assertEnabled()&&assert$2(y),this.colorMap.set(d,c),this.colorInverseMap.get(y).delete(d),this.colorInverseMap.get(c).add(d)}for(const[d,c]of r.entries())this.oppositeColorMap.set(d,c),this.oppositeColorMap.set(c,d);const a=new Set;for(const d of t)a.add(d),this.faceColors.delete(d),this.colorInverseMap.delete(d),this.oppositeColorMap.delete(d);for(const d of this.faceColors)this.oppositeColorMap.has(d)&&a.has(this.oppositeColorMap.get(d))&&this.oppositeColorMap.delete(d);const l=new Set(r.keys());if(this.invalidFaceColor=s,assertEnabled()&&assert$2(this.board.faces.every(d=>this.colorMap.has(d))),assertEnabled()&&assert$2(this.board.faces.every(d=>this.faceColors.has(this.colorMap.get(d)))),assertEnabled()){const d=new Set(this.getFaceColors());for(const c of d){const y=this.getOppositeFaceColor(c);y&&!d.has(y)&&assert$2(!1,`opposite color ${y} of color ${c} is not in the set of colors`)}}this.faceColorsChangedEmitter.emit(e,t,l,[...n.keys()])}clone(){return new GeneralFaceColorData(this.board,this.faceColors,this.colorMap,this.colorInverseMap,this.oppositeColorMap,this.outsideColor,this.insideColor,this.invalidFaceColor)}createDelta(){return new GeneralFaceColorDelta(this.board,this)}serializeState(e){return serializeFaceColorData(this)}static deserializeState(e,t){const n=t.colors.map(c=>{const y=c.id,m=FaceColorState.enumeration.getValue(c.colorState);return assertEnabled()&&assert$2(m),new GeneralFaceColor(y,m)}),r=new Map,s=new Map,a=new Map;n.forEach((c,y)=>{const m=t.colors[y].faces.map(D=>deserializeFace(e,D));m.forEach(D=>r.set(D,c)),s.set(c,new Set(m));const O=t.colors[y].oppositeFaceColorId;if(O!==null){const D=n.find(z=>z.id===O);assertEnabled()&&assert$2(D),a.set(c,D)}});const l=n.find(c=>c.colorState===FaceColorState.OUTSIDE);assertEnabled()&&assert$2(l);const d=n.find(c=>c.colorState===FaceColorState.INSIDE);return assertEnabled()&&assert$2(d),new GeneralFaceColorData(e,new Set(n),r,s,a,l,d,t.invalidFaceColor)}}class FaceColorInvalidAction{constructor(){}apply(e){e.modifyFaceColors([],[],new Map,new Map,!0)}getUndo(e){throw new Error("getUndo unimplemented in FaceColorInvalidAction")}isEmpty(){return!1}serializeAction(){throw new Error("serializeAction unimplemented in FaceColorInvalidAction")}static deserializeAction(e,t){throw new Error("deserializeAction unimplemented in FaceColorInvalidAction")}}const getFaceColorPointer=(o,e)=>{if(e.colorState===FaceColorState.OUTSIDE)return{type:"absolute",isOutside:!0};if(e.colorState===FaceColorState.INSIDE)return{type:"absolute",isOutside:!1};{const t=[...o.getFacesWithColor(e)][0];return assertEnabled()&&assert$2(t),{type:"face",face:t}}},dereferenceFaceColorPointer=(o,e)=>e.type==="face"?o.getFaceColor(e.face):e.isOutside?o.getOutsideColor():o.getInsideColor();class FaceColorMakeSameAction{constructor(e,t){this.a=e,this.b=t,assertEnabled()&&assert$2(e),assertEnabled()&&assert$2(t)}apply(e){const t=dereferenceFaceColorPointer(e,this.a),n=dereferenceFaceColorPointer(e,this.b);if(t===n)return;const r=e.getOppositeFaceColor(t),s=e.getOppositeFaceColor(n);if(assertEnabled()){const O=new Set(e.getFaceColors());assert$2(O.has(t)),assert$2(O.has(n)),r&&assert$2(O.has(r)),s&&assert$2(O.has(s))}if(r&&r===n||s&&s===t){e.modifyFaceColors([],[],new Map,new Map,!0);return}const a=[],l=new Map,d=new Map,c=FaceColorMakeSameAction.combineFaces(t,n,e,a,l),y=r&&s?FaceColorMakeSameAction.combineFaces(r,s,e,a,l):r||s;c===t&&y===r||c===n&&y===s||(d.set(c,y),y&&d.set(y,c)),e.modifyFaceColors([],a,l,d,!1)}getUndo(e){throw new Error("getUndo unimplemented in FaceColorMakeSameAction")}isEmpty(){return!1}serializeAction(){throw new Error("serializeAction unimplemented in FaceColorMakeSameAction")}static deserializeAction(e,t){throw new Error("deserializeAction unimplemented in FaceColorMakeSameAction")}static combineFaces(e,t,n,r,s){let a=null;if(e.colorState!==FaceColorState.UNDECIDED)a=t;else if(t.colorState!==FaceColorState.UNDECIDED)a=e;else{const d=n.getFacesWithColor(e),c=n.getFacesWithColor(t);a=d.length>c.length?t:e}const l=a===e?t:e;r.push(a);for(const d of n.getFacesWithColor(a))s.set(d,l);return l}}class FaceColorMakeOppositeAction{constructor(e,t){this.a=e,this.b=t,assertEnabled()&&assert$2(e),assertEnabled()&&assert$2(t)}apply(e){const t=dereferenceFaceColorPointer(e,this.a),n=dereferenceFaceColorPointer(e,this.b);if(t===n){e.modifyFaceColors([],[],new Map,new Map,!0);return}const r=e.getOppositeFaceColor(t),s=e.getOppositeFaceColor(n);if(assertEnabled()){const m=new Set(e.getFaceColors());assert$2(m.has(t)),assert$2(m.has(n)),r&&assert$2(m.has(r)),s&&assert$2(m.has(s))}if(r&&r===n||s&&s===t)return;if(r&&r===s){e.modifyFaceColors([],[],new Map,new Map,!0);return}const a=[],l=new Map,d=new Map,c=s?FaceColorMakeSameAction.combineFaces(t,s,e,a,l):t,y=r?FaceColorMakeSameAction.combineFaces(n,r,e,a,l):n;d.set(c,y),d.set(y,c),e.modifyFaceColors([],a,l,d,!1)}getUndo(e){throw new Error("getUndo unimplemented in FaceColorMakeOppositeAction")}isEmpty(){return!1}serializeAction(){throw new Error("serializeAction unimplemented in FaceColorMakeOppositeAction")}static deserializeAction(e,t){throw new Error("deserializeAction unimplemented in FaceColorMakeOppositeAction")}}class SafeEdgeToFaceColorSolver{constructor(e,t){ut(this,"hadEdgeAdjusted",!1);ut(this,"dirtyEdges",new Set);ut(this,"edgeListener");this.board=e,this.state=t,e.edges.forEach(n=>this.dirtyEdges.add(n)),this.edgeListener=(n,r,s)=>{this.dirtyEdges.add(n),this.hadEdgeAdjusted=this.hadEdgeAdjusted||s!==EdgeState.WHITE},this.state.edgeStateChangedEmitter.addListener(this.edgeListener)}get dirty(){return this.dirtyEdges.size>0||this.hadEdgeAdjusted}nextAction(){var t;if(!this.dirty)return null;if(this.hadEdgeAdjusted||this.state.hasInvalidFaceColors()){this.hadEdgeAdjusted=!1,this.dirtyEdges.clear();const n=new Map,r=new ProtoFaceColor(FaceColorState.OUTSIDE,new Set),s=new ProtoFaceColor(FaceColorState.INSIDE,new Set);r.opposite=s,s.opposite=r;const a=new Set([r,s,...this.board.faces.map(ae=>{const oe=new ProtoFaceColor(FaceColorState.UNDECIDED,new Set([ae]));return n.set(ae,oe),oe})]);let l=!1;const d=ae=>{if(ae===null)return r;const oe=n.get(ae);return assertEnabled()&&assert$2(oe),oe},c=(ae,oe)=>{if(oe===r||oe===s)return c(oe,ae);assertEnabled()&&assert$2(ae!==oe);for(const ue of oe.faces)ae.faces.add(ue),n.set(ue,ae);return oe.faces.clear(),a.delete(oe),ae},y=(ae,oe)=>{if(assertEnabled()&&assert$2(a.has(ae)&&a.has(oe)),ae===oe)return;const ue=ae.opposite,fe=oe.opposite;if(ue&&ue===oe){l=!0;return}if(fe&&fe===ae){l=!0;return}const be=c(ae,oe),Ae=ue&&fe?c(ue,fe):ue||fe;be.opposite=Ae,Ae&&(Ae.opposite=be)},m=(ae,oe)=>{if(assertEnabled()&&assert$2(a.has(ae)&&a.has(oe)),ae===oe){l=!0;return}if(ae.opposite&&ae.opposite===oe)return;const ue=ae.opposite,fe=oe.opposite;if(ue&&ue===fe){l=!0;return}const be=fe?c(ae,fe):ae,Ae=ue?c(oe,ue):oe;be.opposite=Ae,Ae.opposite=be};for(const ae of this.board.edges){if(l)break;const oe=this.state.getEdgeState(ae);if(oe!==EdgeState.WHITE){const ue=d(ae.forwardFace),fe=d(ae.reversedFace);oe===EdgeState.BLACK?m(ue,fe):oe===EdgeState.RED&&y(ue,fe)}}if(assertEnabled()){const ae=new Set(this.board.faces);for(const oe of a)for(const ue of oe.faces)ae.delete(ue);assert$2(ae.size===0)}if(l)return new AnnotatedAction(new FaceColorInvalidAction,{type:"InvalidFaceColoring"});const O=new Set(this.state.getFaceColors()),D=new Set,z=new Map,w=(ae,oe)=>{assertEnabled()&&assert$2(O.has(ae)),assertEnabled()&&assert$2(oe.faceColor===null),O.delete(ae),oe.faceColor=ae};w(this.state.getOutsideColor(),r),w(this.state.getInsideColor(),s);for(const ae of a){if(!ae.faceColor){const ue=new Set([...ae.faces].map(Ae=>this.state.getFaceColor(Ae)));let fe=null,be=0;for(const Ae of ue){if(!O.has(Ae))continue;const W=this.state.getFacesWithColor(Ae);W.some(J=>!ae.faces.has(J))||W.length>be&&(fe=Ae,be=W.length)}if(fe)w(fe,ae);else{const Ae=new GeneralFaceColor(getFaceColorGlobalId(),FaceColorState.UNDECIDED);D.add(Ae),ae.faceColor=Ae}}const oe=ae.faceColor;assertEnabled()&&assert$2(oe),ae.faces.forEach(ue=>{this.state.getFaceColor(ue)!==oe&&z.set(ue,oe)})}const N=new Set(O),H=new Map;for(const ae of a){const oe=ae.faceColor,ue=((t=ae.opposite)==null?void 0:t.faceColor)??null;let fe=D.has(oe);fe||(fe=this.state.getOppositeFaceColor(oe)!==ue),fe&&H.set(oe,ue)}return D.size>0||N.size>0||z.size>0||H.size>0||this.state.hasInvalidFaceColors()?new AnnotatedAction(new GeneralFaceColorAction(this.board,D,N,z,H,!1),{type:"GeneralFaceColoring"}):null}else for(;this.dirtyEdges.size;){const n=this.dirtyEdges.values().next().value;this.dirtyEdges.delete(n);const r=this.state.getEdgeState(n);if(r!==EdgeState.WHITE){const s=n.forwardFace?this.state.getFaceColor(n.forwardFace):this.state.getOutsideColor(),a=n.reversedFace?this.state.getFaceColor(n.reversedFace):this.state.getOutsideColor();if(r===EdgeState.BLACK){if(this.state.getOppositeFaceColor(s)!==a)return new AnnotatedAction(new FaceColorMakeOppositeAction(getFaceColorPointer(this.state,s),getFaceColorPointer(this.state,a)),{type:"FaceColoringBlackEdge",edge:n})}else if(r===EdgeState.RED&&s!==a)return new AnnotatedAction(new FaceColorMakeSameAction(getFaceColorPointer(this.state,s),getFaceColorPointer(this.state,a)),{type:"FaceColoringRedEdge",edge:n})}}return null}clone(e){return new SafeEdgeToFaceColorSolver(this.board,e)}dispose(){this.state.edgeStateChangedEmitter.removeListener(this.edgeListener)}}class ProtoFaceColor{constructor(e,t){ut(this,"opposite",null);ut(this,"faceColor",null);this.colorState=e,this.faces=t}}class SimpleFaceColorSolver{constructor(e,t,n,r){ut(this,"dirtyEdges",new Set);ut(this,"faceColorListener");this.board=e,this.state=t,this.options=n,r?this.dirtyEdges=new Set(r):this.dirtyEdges=new Set(e.edges),this.faceColorListener=(s,a,l,d)=>{for(const c of d)for(const y of c.edges)this.dirtyEdges.add(y);for(const c of l){const y=this.state.getFacesWithColor(c);for(const m of y)for(const O of m.edges)this.dirtyEdges.add(O)}},this.state.faceColorsChangedEmitter.addListener(this.faceColorListener)}get dirty(){return this.dirtyEdges.size>0}nextAction(){if(!this.dirty)return null;if(this.state.hasInvalidFaceColors())throw new InvalidStateError("Has invalid face colors");for(;this.dirtyEdges.size>0;){const e=this.dirtyEdges.values().next().value;if(this.state.getEdgeState(e)===EdgeState.WHITE){const n=e.forwardFace?this.state.getFaceColor(e.forwardFace):this.state.getOutsideColor(),r=e.reversedFace?this.state.getFaceColor(e.reversedFace):this.state.getOutsideColor(),s=n===r,a=this.state.getOppositeFaceColor(n)===r;if(this.options.solveToBlack&&a)return new AnnotatedAction(new EdgeStateSetAction(e,EdgeState.BLACK),{type:"FaceColorToBlack",edge:e});if(this.options.solveToRed&&s)return new AnnotatedAction(new EdgeStateSetAction(e,EdgeState.RED),{type:"FaceColorToRed",edge:e})}this.dirtyEdges.delete(e)}return null}clone(e){return new SimpleFaceColorSolver(this.board,e,this.options,this.dirtyEdges)}dispose(){this.state.faceColorsChangedEmitter.removeListener(this.faceColorListener)}}class SafeSolvedEdgeSolver{constructor(e,t){ut(this,"hasDirtySimpleRegions",!0);ut(this,"simpleRegionListener");this.board=e,this.state=t,this.simpleRegionListener=()=>{this.hasDirtySimpleRegions=!0},this.state.simpleRegionsChangedEmitter.addListener(this.simpleRegionListener)}get dirty(){return this.hasDirtySimpleRegions}nextAction(){if(!this.dirty)return null;if(simpleRegionIsSolved(this.state)){const e=this.board.edges.filter(t=>this.state.getEdgeState(t)===EdgeState.WHITE);if(e.length)return new AnnotatedAction(new CompositeAction(e.map(t=>new EdgeStateSetAction(t,EdgeState.RED))),{type:"CompletingEdgesAfterSolve",whiteEdges:e})}return this.hasDirtySimpleRegions=!1,null}clone(e){return new SafeSolvedEdgeSolver(this.board,e)}dispose(){this.state.simpleRegionsChangedEmitter.removeListener(this.simpleRegionListener)}}class FaceColorParitySolver{constructor(e,t,n,r){ut(this,"dirtyFaces",new Set);ut(this,"edgeListener");ut(this,"faceColorListener");this.board=e,this.state=t,this.options=n,r?this.dirtyFaces=new Set(r):this.dirtyFaces=new Set(e.faces),this.faceColorListener=(s,a,l,d)=>{const c=y=>{this.dirtyFaces.add(y);for(const m of y.edges){const O=m.getOtherFace(y);O&&this.dirtyFaces.add(O)}};for(const y of d)c(y);for(const y of[...s,...l]){const m=this.state.getFacesWithColor(y);for(const O of m)c(O)}},this.state.faceColorsChangedEmitter.addListener(this.faceColorListener),this.edgeListener=(s,a)=>{for(const l of s.faces)this.dirtyFaces.add(l)},this.state.edgeStateChangedEmitter.addListener(this.edgeListener)}get dirty(){return this.dirtyFaces.size>0}nextAction(){if(!this.dirty)return null;if(this.state.hasInvalidFaceColors())throw new InvalidStateError("Has invalid face colors");for(;this.dirtyFaces.size>0;){const e=this.dirtyFaces.values().next().value,t=r=>{const s=r.getOtherFace(e),a=s?this.state.getFaceColor(s):this.state.getOutsideColor();return new Side(a,r)},n=e.edges.filter(r=>this.state.getEdgeState(r)===EdgeState.WHITE).map(t);if(n.length){const r=this.state.getFaceValue(e);if(r===null){const s=n[0].color;if(e.edges.map(t).every(d=>d.color===s)&&this.options.solveToRed){const d=e.edges.map(y=>y.getOtherFace(e)).filter(y=>y!==null);if(this.board.faces.some(y=>y!==e&&this.state.getFaceValue(y)!==null&&!d.includes(y)))return new AnnotatedAction(new CompositeAction(n.map(y=>new EdgeStateSetAction(y.edge,EdgeState.RED))),{type:"FaceColorNoTrivialLoop",face:e})}}else{const s=e.edges.filter(d=>this.state.getEdgeState(d)===EdgeState.BLACK).length,a=(d,c,y)=>{let m=[];for(const fe of c){const be=fe.color;let Ae=!1;for(const W of m)if(W.mainColor===be){W.mainColorSides.add(fe),Ae=!0;break}else if(W.oppositeColor===be){W.oppositeColorSides.add(fe),Ae=!0;break}if(!Ae){const W=this.state.getOppositeFaceColor(be),J=new DualColorCount(be,W,0,0);m.push(J),J.mainColorSides.add(fe)}}m=_$1.sortBy(m,fe=>-fe.size);const D=_$1.sortBy(m.flatMap(fe=>{const be=[new SingleColorCount(fe.mainColor,fe.mainCount,fe.mainColorSides)];return fe.oppositeColor&&fe.oppositeColorSides.size&&be.push(new SingleColorCount(fe.oppositeColor,fe.oppositeCount,fe.oppositeColorSides)),be}),fe=>-fe.size)[0],z=D.size,w=d,N=c.length-w,H=Math.max(w,N),X=z>w,ae=z>N,oe=z===H;if(X&&ae)throw new InvalidStateError("Too many adjacent faces with the same color");const ue=()=>{const fe=be=>[be[0].map(Ae=>Ae.edge),be[1].map(Ae=>Ae.edge)];return{face:e,remainingValue:d,availableSideCount:c.length,balancedPairs:y.map(fe)}};if(X&&this.options.solveToRed)return new AnnotatedAction(new CompositeAction([...D.sides].map(fe=>new EdgeStateSetAction(fe.edge,EdgeState.RED))),{type:"FaceColorMatchToRed",matchingEdges:[...D.sides].map(fe=>fe.edge),...ue()});if(ae&&this.options.solveToBlack)return new AnnotatedAction(new CompositeAction([...D.sides].map(fe=>new EdgeStateSetAction(fe.edge,EdgeState.BLACK))),{type:"FaceColorMatchToBlack",matchingEdges:[...D.sides].map(fe=>fe.edge),...ue()});if(oe&&this.options.solveColors){const fe=D.color,be=c.filter(W=>W.color!==fe),Ae=_$1.uniq(be.map(W=>W.color)).filter(W=>W!==this.state.getOppositeFaceColor(fe));if(Ae.length)return assertEnabled()&&assert$2(Ae.every(W=>this.state.getFaceColors().includes(W))),new AnnotatedAction(new CompositeAction(Ae.map(W=>new FaceColorMakeOppositeAction(getFaceColorPointer(this.state,fe),getFaceColorPointer(this.state,W)))),{type:"FaceColorBalance",matchingEdges:[...D.sides].map(W=>W.edge),oppositeEdges:[...be].map(W=>W.edge),...ue()})}if(this.options.allowPartialReduction)for(const fe of m){if(fe.size<1)continue;const be=[...fe.mainColorSides].slice(0,fe.size),Ae=[...fe.oppositeColorSides].slice(0,fe.size),W=c.filter(J=>!be.includes(J)&&!Ae.includes(J));if(W.length){const J=a(w-fe.size,W,y.concat([[be,Ae]]));if(J)return J}}return null},l=a(r-s,n,[]);if(l)return l}}this.dirtyFaces.delete(e)}return null}clone(e){return new FaceColorParitySolver(this.board,e,this.options,this.dirtyFaces)}dispose(){this.state.faceColorsChangedEmitter.removeListener(this.faceColorListener),this.state.edgeStateChangedEmitter.removeListener(this.edgeListener)}}class Side{constructor(e,t){this.color=e,this.edge=t}}class DualColorCount{constructor(e,t,n,r){ut(this,"mainColorSides",new Set);ut(this,"oppositeColorSides",new Set);this.mainColor=e,this.oppositeColor=t,this.mainCount=n,this.oppositeCount=r}get size(){return Math.min(this.mainColorSides.size,this.oppositeColorSides.size)}}class SingleColorCount{constructor(e,t,n){this.color=e,this.count=t,this.sides=n}get size(){return this.sides.size}}const faceAdjacentFaces=o=>{const e=[];for(const t of o.edges){const n=t.getOtherFace(o);n&&e.push(n)}return e},edgeHasVertex=(o,e)=>o.start===e||o.end===e;class StaticDoubleMinusOneFacesSolver{constructor(e,t,n){ut(this,"dirtyFaces");ut(this,"faceListener");this.board=e,this.state=t,n?this.dirtyFaces=new Set(n):this.dirtyFaces=new Set(e.faces),this.faceListener=(r,s)=>{this.dirtyFaces.add(r);for(const a of faceAdjacentFaces(r))this.dirtyFaces.add(a)},this.state.faceValueChangedEmitter.addListener(this.faceListener)}get dirty(){return this.dirtyFaces.size>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyFaces.size;){const e=this.dirtyFaces.values().next().value,t=this.state.getFaceValue(e),n=e.edges.length;if(t===n-1)for(const r of e.edges){const s=r.getOtherFace(e);if(s){const a=this.state.getFaceValue(s),l=s.edges.length;if(a===l-1){const d=new Set([...faceAdjacentFaces(e),...faceAdjacentFaces(s)]);if(this.board.faces.some(c=>(this.state.getFaceValue(c)??0)>0&&!d.has(c))){const c=N=>!edgeHasVertex(N,r.start)&&!edgeHasVertex(N,r.end),y=e.edges.filter(c),m=s.edges.filter(c),O=N=>!N.faces.some(H=>H===e||H===s),D=[...r.start.edges.filter(O),...r.end.edges.filter(O)],z=[r,...y,...m].filter(N=>this.state.getEdgeState(N)!==EdgeState.BLACK),w=D.filter(N=>this.state.getEdgeState(N)!==EdgeState.RED);if(z.length||w.length)return new AnnotatedAction(new CompositeAction([...z.map(N=>new EdgeStateSetAction(N,EdgeState.BLACK)),...w.map(N=>new EdgeStateSetAction(N,EdgeState.RED))]),{type:"DoubleMinusOneFaces",faces:[e,s],toBlackEdges:z,toRedEdges:w})}}}}this.dirtyFaces.delete(e)}return null}clone(e){return new StaticDoubleMinusOneFacesSolver(this.board,e,this.dirtyFaces)}dispose(){this.state.faceValueChangedEmitter.removeListener(this.faceListener)}}class SectorStateSetAction{constructor(e,t){this.sector=e,this.state=t}apply(e){e.setSectorState(this.sector,this.state)}getUndo(e){const t=e.getSectorState(this.sector);return new SectorStateSetAction(this.sector,t)}isEmpty(){return!1}serializeAction(){return{type:"SectorStateSetAction",sector:serializeHalfEdge(this.sector),state:this.state.serialize()}}static deserializeAction(e,t){return new SectorStateSetAction(deserializeHalfEdge(e,t.sector),SectorState.deserialize(t.state))}}class SafeEdgeToSectorSolver{constructor(e,t){ut(this,"dirtySectors",new Set);ut(this,"edgeListener");this.board=e,this.state=t,e.halfEdges.forEach(n=>this.dirtySectors.add(n)),this.edgeListener=(n,r,s)=>{this.dirtySectors.add(n.forwardHalf),this.dirtySectors.add(n.forwardHalf.previous),this.dirtySectors.add(n.reversedHalf),this.dirtySectors.add(n.reversedHalf.previous)},this.state.edgeStateChangedEmitter.addListener(this.edgeListener)}get dirty(){return this.dirtySectors.size>0}nextAction(){if(!this.dirty)return null;for(;this.dirtySectors.size;){const e=this.dirtySectors.values().next().value;this.dirtySectors.delete(e);const t=e.edge,n=e.next.edge,r=this.state.getEdgeState(t),s=this.state.getEdgeState(n),a=this.state.getSectorState(e);let l=a;const d=(r===EdgeState.WHITE?1:0)+(s===EdgeState.WHITE?1:0),c=(r===EdgeState.BLACK?1:0)+(s===EdgeState.BLACK?1:0),y=(r===EdgeState.RED?1:0)+(s===EdgeState.RED?1:0);if(d===0?l=SectorState.getOnly(c):d===1&&(c&&l.zero&&(l=l.withDisallowZero()),y&&l.two&&(l=l.withDisallowTwo())),l!==a)return new AnnotatedAction(new SectorStateSetAction(e,l),{type:d===1?"SingleEdgeToSector":"DoubleEdgeToSector",sector:e,beforeState:a,afterState:l})}return null}clone(e){return new SafeEdgeToSectorSolver(this.board,e)}dispose(){this.state.edgeStateChangedEmitter.removeListener(this.edgeListener)}}class SimpleSectorSolver{constructor(e,t,n){ut(this,"dirtySectors");ut(this,"edgeListener");ut(this,"sectorListener");this.board=e,this.state=t,n?this.dirtySectors=new Set(n):this.dirtySectors=new Set(e.halfEdges),this.edgeListener=(r,s,a)=>{this.dirtySectors.add(r.forwardHalf),this.dirtySectors.add(r.forwardHalf.previous),this.dirtySectors.add(r.reversedHalf),this.dirtySectors.add(r.reversedHalf.previous)},this.state.edgeStateChangedEmitter.addListener(this.edgeListener),this.sectorListener=(r,s,a)=>{this.dirtySectors.add(r)},this.state.sectorStateChangedEmitter.addListener(this.sectorListener)}get dirty(){return this.dirtySectors.size>0}nextAction(){if(!this.dirty)return null;for(;this.dirtySectors.size;){const e=this.dirtySectors.values().next().value;this.dirtySectors.delete(e);const t=e.edge,n=e.next.edge,r=this.state.getSectorState(e);if(r===SectorState.NONE)throw new InvalidStateError(`invalid sector state: ${r}`);const s=this.state.getEdgeState(t),a=this.state.getEdgeState(n),l=(s===EdgeState.WHITE?1:0)+(a===EdgeState.WHITE?1:0),d=(s===EdgeState.BLACK?1:0)+(a===EdgeState.BLACK?1:0),c=(y,m)=>new AnnotatedAction(new CompositeAction([...y.map(O=>new EdgeStateSetAction(O,EdgeState.BLACK)),...m.map(O=>new EdgeStateSetAction(O,EdgeState.RED))]),{type:"ForcedSector",sector:e,sectorState:r,toRedEdges:m,toBlackEdges:y});if(l===0){if(!r.allows(d))throw new InvalidStateError(`invalid state: ${r} with ${d} black edges with no white`)}else if(l===1){const y=r.allows(d),m=r.allows(d+1);if(!y&&!m)throw new InvalidStateError(`invalid state: ${r} with ${d} black edges and 1 white`);if(y&&!m)return c([],[s===EdgeState.WHITE?t:n]);if(m&&!y)return c([s===EdgeState.WHITE?t:n],[])}else if(l===2){if(r===SectorState.ONLY_ZERO)return c([],[t,n]);if(r===SectorState.ONLY_TWO)return c([t,n],[])}else throw new InvalidStateError(`invalid white count: ${l}`)}return null}clone(e){return new SimpleSectorSolver(this.board,e,this.dirtySectors)}dispose(){this.state.edgeStateChangedEmitter.removeListener(this.edgeListener),this.state.sectorStateChangedEmitter.removeListener(this.sectorListener)}}class StaticSectorSolver{constructor(e,t,n){ut(this,"dirtyFaces");ut(this,"faceListener");this.board=e,this.state=t,n?this.dirtyFaces=new Set(n):this.dirtyFaces=new Set(e.faces),this.faceListener=(r,s)=>{this.dirtyFaces.add(r);for(const a of faceAdjacentFaces(r))this.dirtyFaces.add(a)},this.state.faceValueChangedEmitter.addListener(this.faceListener)}get dirty(){return this.dirtyFaces.size>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyFaces.size;){const e=this.dirtyFaces.values().next().value,t=this.state.getFaceValue(e),n=e.edges.length;let r=null;if(t===0?r=SectorState.ONLY_ZERO:t===1?r=SectorState.NOT_TWO:t===n-1?r=SectorState.NOT_ZERO:t===n&&(r=SectorState.ONLY_TWO),r){const s=e.halfEdges,a=[],l=[];for(const d of s){const c=this.state.getSectorState(d),y=c.and(r);if(y===SectorState.NONE)throw new InvalidStateError(`invalid sector state: ${c}`);c!==y&&(a.push(new SectorStateSetAction(d,y)),l.push(d))}if(a.length)return new AnnotatedAction(new CompositeAction(a),{type:"StaticFaceSectors",face:e,sectors:l})}this.dirtyFaces.delete(e)}return null}clone(e){return new StaticSectorSolver(this.board,e,this.dirtyFaces)}dispose(){this.state.faceValueChangedEmitter.removeListener(this.faceListener)}}class VertexStateSetAction{constructor(e,t){this.vertex=e,this.state=t}apply(e){e.setVertexState(this.vertex,this.state)}getUndo(e){const t=e.getVertexState(this.vertex);return new VertexStateSetAction(this.vertex,t)}isEmpty(){return!1}serializeAction(){return{type:"VertexStateSetAction",vertex:serializeVertex(this.vertex),state:this.state.serialize()}}static deserializeAction(e,t){const n=deserializeVertex(e,t.vertex);return new VertexStateSetAction(n,VertexState.deserialize(n,t.state))}}class SafeEdgeSectorColorToVertexSolver{constructor(e,t){ut(this,"dirtyVertices",new Set);ut(this,"edgeListener");ut(this,"sectorListener");ut(this,"faceColorListener");this.board=e,this.state=t,e.vertices.forEach(n=>this.dirtyVertices.add(n)),this.edgeListener=(n,r,s)=>{this.dirtyVertices.add(n.start),this.dirtyVertices.add(n.end)},this.state.edgeStateChangedEmitter.addListener(this.edgeListener),this.sectorListener=(n,r,s)=>{this.dirtyVertices.add(n.end)},this.state.sectorStateChangedEmitter.addListener(this.sectorListener),this.faceColorListener=(n,r,s,a)=>{for(const l of a)for(const d of l.vertices)this.dirtyVertices.add(d);for(const l of s){const d=this.state.getFacesWithColor(l);for(const c of d)for(const y of c.vertices)this.dirtyVertices.add(y)}},this.state.faceColorsChangedEmitter.addListener(this.faceColorListener)}get dirty(){return this.dirtyVertices.size>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyVertices.size;){const e=this.dirtyVertices.values().next().value;this.dirtyVertices.delete(e);const t=this.state.getVertexState(e),n=VertexState.fromEdgeColorSectorData(e,this.state).and(t);if(!t.equals(n))return new AnnotatedAction(new VertexStateSetAction(e,n),{type:"VertexState",vertex:e,beforeState:t,afterState:n})}return null}clone(e){return new SafeEdgeSectorColorToVertexSolver(this.board,e)}dispose(){this.state.edgeStateChangedEmitter.removeListener(this.edgeListener),this.state.sectorStateChangedEmitter.removeListener(this.sectorListener),this.state.faceColorsChangedEmitter.removeListener(this.faceColorListener)}}class VertexToEdgeSolver{constructor(e,t,n,r){ut(this,"dirtyVertices",[]);ut(this,"vertexListener");this.board=e,this.state=t,this.options=n,r?this.dirtyVertices.push(...r):this.dirtyVertices.push(...e.vertices),this.vertexListener=s=>{this.dirtyVertices.push(s)},this.state.vertexStateChangedEmitter.addListener(this.vertexListener)}get dirty(){return this.dirtyVertices.length>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyVertices.length;){const e=this.dirtyVertices.pop(),t=this.state.getVertexState(e);if(t.possibilityCount===0)throw new InvalidStateError("Vertex has no possibilities");const n=[],r=[];for(const s of e.edges)if(this.state.getEdgeState(s)===EdgeState.WHITE){const l=t.getFinalStatesOfEdge(s);if(l.size===1){const d=[...l][0];d===EdgeState.RED&&this.options.solveToRed&&n.push(s),d===EdgeState.BLACK&&this.options.solveToBlack&&r.push(s)}}if(n.length||r.length)return new AnnotatedAction(new CompositeAction([...n.map(s=>new EdgeStateSetAction(s,EdgeState.RED)),...r.map(s=>new EdgeStateSetAction(s,EdgeState.BLACK))]),{type:"VertexStateToEdge",vertex:e,toRedEdges:n,toBlackEdges:r})}return null}clone(e){return new VertexToEdgeSolver(this.board,e,this.options,this.dirtyVertices)}dispose(){this.state.vertexStateChangedEmitter.removeListener(this.vertexListener)}}class VertexToSectorSolver{constructor(e,t,n){ut(this,"dirtyVertices",[]);ut(this,"vertexListener");this.board=e,this.state=t,n?this.dirtyVertices.push(...n):this.dirtyVertices.push(...e.vertices),this.vertexListener=r=>{this.dirtyVertices.push(r)},this.state.vertexStateChangedEmitter.addListener(this.vertexListener)}get dirty(){return this.dirtyVertices.length>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyVertices.length;){const e=this.dirtyVertices.pop(),t=this.state.getVertexState(e);if(t.possibilityCount===0)throw new InvalidStateError("Vertex has no possibilities");const n=getSectorsFromVertex(e),r=n.map(c=>this.state.getSectorState(c)),s=n.map(c=>SectorState.NONE);for(const c of t.getAllowedPairs())for(let y=0;y<n.length;y++){const m=n[y],O=m.edge,D=m.next.edge,z=c[0],w=c[1],N=(O===z||O===w?1:0)+(D===z||D===w?1:0);s[y]=s[y].with(N)}if(t.allowsEmpty())for(let c=0;c<n.length;c++)s[c]=s[c].withZero(!0);for(let c=0;c<n.length;c++)s[c]=s[c].and(r[c]);for(const c of s)if(c===SectorState.NONE)throw new InvalidStateError("Sector has no possibilities");const a=[],l=[],d=[];for(let c=0;c<n.length;c++)r[c]!==s[c]&&(a.push(n[c]),l.push(r[c]),d.push(s[c]));if(a.length)return new AnnotatedAction(new CompositeAction(a.map((c,y)=>new SectorStateSetAction(c,d[y]))),{type:"VertexStateToSector",vertex:e,sectors:a,beforeStates:l,afterStates:d})}return null}clone(e){return new VertexToSectorSolver(this.board,e,this.dirtyVertices)}dispose(){this.state.vertexStateChangedEmitter.removeListener(this.vertexListener)}}class VertexToFaceColorSolver{constructor(e,t,n){ut(this,"dirtyVertices",[]);ut(this,"vertexListener");this.board=e,this.state=t,n?this.dirtyVertices.push(...n):this.dirtyVertices.push(...e.vertices),this.vertexListener=r=>{this.dirtyVertices.push(r)},this.state.vertexStateChangedEmitter.addListener(this.vertexListener)}get dirty(){return this.dirtyVertices.length>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyVertices.length;){const e=this.dirtyVertices[this.dirtyVertices.length-1],t=this.state.getVertexState(e);if(t.possibilityCount===0)throw new InvalidStateError("Vertex has no possibilities");const r=getFaceOrderedSectorsFromVertex(e).map(l=>l.face?this.state.getFaceColor(l.face):this.state.getOutsideColor()),s=new Set(r);if(s.size!==1){const l=new Map([...s].map(c=>[c,new Map([...s].map(y=>[y,!1]))])),d=new Map([...s].map(c=>[c,new Map([...s].map(y=>[y,!1]))]));for(const c of t.getAllowedPairs()){const y=e.edges.indexOf(c[0]),m=e.edges.indexOf(c[1]),O=Math.min(y,m),D=Math.max(y,m),z=r.slice(O,D),w=[...r.slice(D),...r.slice(0,O)],N=H=>{for(let X=0;X<H.length;X++)for(let ae=X+1;ae<H.length;ae++)l.get(H[X]).set(H[ae],!0),l.get(H[ae]).set(H[X],!0)};N(z),N(w);for(const H of z)for(const X of w)H!==X&&(d.get(H).set(X,!0),d.get(X).set(H,!0))}for(const c of s)for(const y of s){if(c===y)continue;const m=t.allowsEmpty()||l.get(c).get(y),O=d.get(c).get(y);if(m&&!O)return new AnnotatedAction(new FaceColorMakeSameAction(getFaceColorPointer(this.state,c),getFaceColorPointer(this.state,y)),{type:"VertexStateToSameFaceColor",vertex:e,facesA:e.faces.filter(D=>this.state.getFaceColor(D)===c),facesB:e.faces.filter(D=>this.state.getFaceColor(D)===y)});if(O&&!m&&this.state.getOppositeFaceColor(c)!==y)return new AnnotatedAction(new FaceColorMakeOppositeAction(getFaceColorPointer(this.state,c),getFaceColorPointer(this.state,y)),{type:"VertexStateToOppositeFaceColor",vertex:e,facesA:e.faces.filter(D=>this.state.getFaceColor(D)===c),facesB:e.faces.filter(D=>this.state.getFaceColor(D)===y)})}}const a=this.dirtyVertices.pop();assertEnabled()&&assert$2(a===e)}return null}clone(e){return new VertexToFaceColorSolver(this.board,e,this.dirtyVertices)}dispose(){this.state.vertexStateChangedEmitter.removeListener(this.vertexListener)}}const lazyFactorials=[],getLazyFactorials=o=>{for(;lazyFactorials.length<=o;)lazyFactorials.push(lazyFactorials.length===0?1:lazyFactorials[lazyFactorials.length-1]*lazyFactorials.length);return lazyFactorials},getBinomialCoefficient=(o,e,t)=>t[o]/(t[e]*t[o-e]),getCombinationIndex=(o,e)=>{o=_$1.sortBy(o);const t=getLazyFactorials(e);let n=0;const r=o.length;for(let s=0;s<r;s++){const a=o[s-1]+1,l=o[s];for(let d=s==0?0:a;d<l;d++)n+=getBinomialCoefficient(e-d-1,r-s-1,t)}return n},getCombinationQuantity=(o,e)=>getBinomialCoefficient(o,e,getLazyFactorials(o)),getBinaryIndex=(o,e)=>{let t=0;for(let n=0;n<o.length;n++)t+=1<<e-o[n]-1;return t},getBinaryQuantity=o=>1<<o;class FaceState{constructor(e,t,n,r){ut(this,"order");ut(this,"possibilityCount");ut(this,"matrix");this.face=e,this.faceValue=t,this.order=e.edges.length,n?this.matrix=n:this.matrix=_$1.range(0,FaceState.getMatrixSize(this.order,this.faceValue)).map(()=>!0),r!==void 0?this.possibilityCount=r:this.possibilityCount=this.matrix.filter(s=>s).length,assertEnabled()&&assert$2(this.matrix.length===FaceState.getMatrixSize(this.order,this.faceValue)),assertEnabled()&&assert$2(this.possibilityCount===this.matrix.filter(s=>s).length)}isAny(){return this.possibilityCount===FaceState.getMatrixSize(this.order,this.faceValue)}isForced(){return this.possibilityCount===1}allowsEmpty(){return this.allowsBlackEdges([])}allowsBlackEdges(e){return this.matrix[this.getBlackEdgesIndex(e)]}getAllowedCombinations(){const e=[];return FaceState.forEachEdgeCombination(this.face.edges,this.faceValue,(t,n)=>{this.matrix[this.getIndexFromIndices(t)]&&e.push(n.slice())}),assertEnabled()&&assert$2(e.length===this.possibilityCount),e}getFinalStatesOfEdge(e){const t=new Set;for(const n of this.getAllowedCombinations())n.includes(e)?t.add(EdgeState.BLACK):t.add(EdgeState.RED);return this.allowsEmpty()&&t.add(EdgeState.RED),t}getBlackEdgesIndex(e){const t=e.map(n=>this.face.edges.indexOf(n));return assertEnabled()&&assert$2(t.every(n=>n>=0)),this.getIndexFromIndices(t)}getIndexFromIndices(e){return this.faceValue===null?getBinaryIndex(e,this.order):getCombinationIndex(e,this.order)}equals(e){return this.face===e.face&&this.matrix.every((t,n)=>t===e.matrix[n])}and(e){return assertEnabled()&&assert$2(this.face===e.face),new FaceState(this.face,this.faceValue,this.matrix.map((t,n)=>t&&e.matrix[n]))}or(e){return assertEnabled()&&assert$2(this.face===e.face),new FaceState(this.face,this.faceValue,this.matrix.map((t,n)=>t||e.matrix[n]))}isSubsetOf(e){return this.matrix.every((t,n)=>!t||e.matrix[n])}withBlackEdges(e,t){const n=this.getBlackEdgesIndex(e);return new FaceState(this.face,this.faceValue,this.matrix.slice(0,n).concat(t,this.matrix.slice(n+1)))}serialize(){if(this.isAny())return{faceValue:this.faceValue,matrix:"",isAny:!0};const e={faceValue:this.faceValue,matrix:packBooleanArray(this.matrix),isAny:!1};return assertEnabled()&&assert$2(this.equals(FaceState.deserialize(this.face,e))),e}static getMatrixSize(e,t){return t===null?getBinaryQuantity(e):getCombinationQuantity(e,t)}static forEachIndexCombination(e,t,n){let r=[];const s=()=>{if(t!==null){if(r.length===t){n(r);return}}else n(r);const a=r.length>0?r[r.length-1]+1:0;for(let l=a;l<e;l++)r.push(l),s(),r.pop()};s()}static forEachEdgeCombination(e,t,n){let r=[],s=[];const a=()=>{if(t!==null){if(r.length===t){n(r,s);return}}else n(r,s);const l=r.length>0?r[r.length-1]+1:0;for(let d=l;d<e.length;d++)r.push(d),s.push(e[d]),a(),r.pop(),s.pop()};a()}static fromLookup(e,t,n){const r=e.edges.length,s=new Array(FaceState.getMatrixSize(r,t)).fill(!1);return FaceState.forEachEdgeCombination(e.edges,t,(a,l)=>{if(n(l)){const c=t===null?getBinaryIndex(a,r):getCombinationIndex(a,r);s[c]=!0}}),new FaceState(e,t,s)}static none(e,t){const n=FaceState.getMatrixSize(e.edges.length,t),r=new Array(n).fill(!1);return new FaceState(e,t,r,0)}static any(e,t){const n=FaceState.getMatrixSize(e.edges.length,t),r=new Array(n).fill(!0);return new FaceState(e,t,r,n)}static withOnlyBlackEdges(e,t,n){const r=FaceState.getMatrixSize(e.edges.length,t),s=new Array(r).fill(!1),a=n.map(d=>e.edges.indexOf(d)),l=t===null?getBinaryIndex(a,e.edges.length):getCombinationIndex(a,e.edges.length);return s[l]=!0,new FaceState(e,t,s,1)}static withoutBlackEdges(e,t,n){const r=FaceState.getMatrixSize(e.edges.length,t),s=new Array(r).fill(!0),a=n.map(d=>e.edges.indexOf(d)),l=t===null?getBinaryIndex(a,e.edges.length):getCombinationIndex(a,e.edges.length);return s[l]=!1,new FaceState(e,t,s,r-1)}static fromVertexAndColorData(e,t,n){const s=e.vertices.map(y=>n.getVertexState(y)).map(y=>{const m=y.vertex.edges.filter(O=>O.faces.includes(e));return assertEnabled()&&assert$2(m.length===2),{edgeA:m[0],edgeB:m[1],...y.getBinaryCombinationsAllowed(m[0],m[1])}}),a=new Map(e.edges.map(y=>{const m=y.getOtherFace(e);return[y,m?n.getFaceColor(m):n.getOutsideColor()]})),l=n.getFaceColor(e),d=new Set([...a.values(),l]),c=new Map([...d].map(y=>[y,n.getOppositeFaceColor(y)]));return FaceState.fromLookup(e,n.getFaceValue(e),y=>{const m=new Set(y);for(const z of s){const w=m.has(z.edgeA),N=m.has(z.edgeB);if(w&&N&&!z.allowsBoth||w&&!N&&!z.allowsAOnly||!w&&N&&!z.allowsBOnly||!w&&!N&&!z.allowsNone)return!1}const O=new Set([l]),D=new Set;for(const z of e.edges){const w=a.get(z);assertEnabled()&&assert$2(w),m.has(z)?D.add(w):O.add(w)}for(const z of O){if(D.has(z))return!1;const w=c.get(z);if(w&&O.has(w))return!1}for(const z of D){const w=c.get(z);if(w&&D.has(w))return!1}if(m.size===e.edges.length){for(const z of t.faces)if(n.getFaceValue(z)!==null){for(const w of z.edges)if(!m.has(w))return!1}}return!0})}static deserialize(e,t){return t.isAny?FaceState.any(e,t.faceValue):new FaceState(e,t.faceValue,unpackBooleanArray(t.matrix,FaceState.getMatrixSize(e.edges.length,t.faceValue)))}}class FaceStateSetAction{constructor(e,t){this.face=e,this.state=t}apply(e){e.setFaceState(this.face,this.state)}getUndo(e){const t=e.getFaceState(this.face);return new FaceStateSetAction(this.face,t)}isEmpty(){return!1}serializeAction(){return{type:"FaceStateSetAction",face:serializeFace(this.face),state:this.state.serialize()}}static deserializeAction(e,t){const n=deserializeFace(e,t.face);return new FaceStateSetAction(n,FaceState.deserialize(n,t.state))}}class VertexColorToFaceSolver{constructor(e,t,n){ut(this,"dirtyFaces");ut(this,"faceValueListener");ut(this,"vertexStateListener");ut(this,"faceColorListener");this.board=e,this.state=t,n?this.dirtyFaces=new Set(n):this.dirtyFaces=new Set(e.faces.filter(r=>t.getFaceValue(r)!==null)),this.faceValueListener=(r,s)=>{this.dirtyFaces.add(r)},this.state.faceValueChangedEmitter.addListener(this.faceValueListener),this.vertexStateListener=r=>{for(const s of r.faces)this.dirtyFaces.add(s)},this.state.vertexStateChangedEmitter.addListener(this.vertexStateListener),this.faceColorListener=(r,s,a,l)=>{const d=c=>{this.dirtyFaces.add(c);for(const y of c.edges){const m=y.getOtherFace(c);m&&this.dirtyFaces.add(m)}};for(const c of l)d(c);for(const c of[...r,...a]){const y=this.state.getFacesWithColor(c);for(const m of y)d(m)}},this.state.faceColorsChangedEmitter.addListener(this.faceColorListener)}get dirty(){return this.dirtyFaces.size>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyFaces.size;){const e=this.dirtyFaces.values().next().value;this.dirtyFaces.delete(e);const t=this.state.getFaceState(e),n=FaceState.fromVertexAndColorData(e,this.board,this.state).and(t);if(!t.equals(n))return new AnnotatedAction(new FaceStateSetAction(e,n),{type:"FaceState",face:e,beforeState:t,afterState:n})}return null}clone(e){return new VertexColorToFaceSolver(this.board,e)}dispose(){this.state.faceValueChangedEmitter.removeListener(this.faceValueListener),this.state.vertexStateChangedEmitter.removeListener(this.vertexStateListener),this.state.faceColorsChangedEmitter.removeListener(this.faceColorListener)}}class FaceToEdgeSolver{constructor(e,t,n,r){ut(this,"dirtyFaces",[]);ut(this,"vertexListener");this.board=e,this.state=t,this.options=n,r?this.dirtyFaces.push(...r):this.dirtyFaces.push(...e.faces),this.vertexListener=s=>{this.dirtyFaces.push(s)},this.state.faceStateChangedEmitter.addListener(this.vertexListener)}get dirty(){return this.dirtyFaces.length>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyFaces.length;){const e=this.dirtyFaces.pop(),t=this.state.getFaceState(e);if(t.possibilityCount===0)throw new InvalidStateError("Face has no possibilities");const n=[],r=[];for(const s of e.edges)if(this.state.getEdgeState(s)===EdgeState.WHITE){const l=t.getFinalStatesOfEdge(s);if(l.size===1){const d=[...l][0];d===EdgeState.RED&&this.options.solveToRed&&n.push(s),d===EdgeState.BLACK&&this.options.solveToBlack&&r.push(s)}}if(n.length||r.length)return new AnnotatedAction(new CompositeAction([...n.map(s=>new EdgeStateSetAction(s,EdgeState.RED)),...r.map(s=>new EdgeStateSetAction(s,EdgeState.BLACK))]),{type:"FaceStateToEdge",face:e,toRedEdges:n,toBlackEdges:r})}return null}clone(e){return new FaceToEdgeSolver(this.board,e,this.options,this.dirtyFaces)}dispose(){this.state.faceStateChangedEmitter.removeListener(this.vertexListener)}}class FaceToSectorSolver{constructor(e,t,n){ut(this,"dirtyFaces",[]);ut(this,"faceListener");this.board=e,this.state=t,n?this.dirtyFaces.push(...n):this.dirtyFaces.push(...e.faces),this.faceListener=r=>{this.dirtyFaces.push(r)},this.state.faceStateChangedEmitter.addListener(this.faceListener)}get dirty(){return this.dirtyFaces.length>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyFaces.length;){const e=this.dirtyFaces.pop(),t=this.state.getFaceState(e);if(t.possibilityCount===0)throw new InvalidStateError("Face has no possibilities");const n=e.halfEdges,r=n.map(c=>this.state.getSectorState(c)),s=n.map(c=>SectorState.NONE);for(const c of t.getAllowedCombinations())for(let y=0;y<n.length;y++){const m=n[y],O=m.edge,D=m.next.edge,z=(c.includes(O)?1:0)+(c.includes(D)?1:0);s[y]=s[y].with(z)}for(let c=0;c<n.length;c++)s[c]=s[c].and(r[c]);for(const c of s)if(c===SectorState.NONE)throw new InvalidStateError("Sector has no possibilities");const a=[],l=[],d=[];for(let c=0;c<n.length;c++)r[c]!==s[c]&&(a.push(n[c]),l.push(r[c]),d.push(s[c]));if(a.length)return new AnnotatedAction(new CompositeAction(a.map((c,y)=>new SectorStateSetAction(c,d[y]))),{type:"FaceStateToSector",face:e,sectors:a,beforeStates:l,afterStates:d})}return null}clone(e){return new FaceToSectorSolver(this.board,e,this.dirtyFaces)}dispose(){this.state.faceStateChangedEmitter.removeListener(this.faceListener)}}class FaceToFaceColorSolver{constructor(e,t,n){ut(this,"dirtyFaces",[]);ut(this,"faceListener");this.board=e,this.state=t,n?this.dirtyFaces.push(...n):this.dirtyFaces.push(...e.faces),this.faceListener=r=>{this.dirtyFaces.push(r)},this.state.faceStateChangedEmitter.addListener(this.faceListener)}get dirty(){return this.dirtyFaces.length>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyFaces.length;){const e=this.dirtyFaces[this.dirtyFaces.length-1],t=this.state.getFaceState(e);if(t.possibilityCount===0)throw new InvalidStateError("Face has no possibilities");const n=new Map(e.edges.map(d=>{const c=d.getOtherFace(e);return[d,c?this.state.getFaceColor(c):this.state.getOutsideColor()]})),r=[e,...e.edges.map(d=>d.getOtherFace(e)).filter(_$1.identity)],s=this.state.getFaceColor(e),a=new Set([...n.values(),s]);if(a.size!==1){const d=new Map([...a].map(y=>[y,new Map([...a].map(m=>[m,!1]))])),c=new Map([...a].map(y=>[y,new Map([...a].map(m=>[m,!1]))]));for(const y of t.getAllowedCombinations()){const m=new Set([s]),O=new Set;for(const z of e.edges)y.includes(z)?O.add(n.get(z)):m.add(n.get(z));const D=z=>{for(let w=0;w<z.length;w++)for(let N=w+1;N<z.length;N++)d.get(z[w]).set(z[N],!0),d.get(z[N]).set(z[w],!0)};D([...m]),D([...O]);for(const z of m)for(const w of O)z!==w&&(c.get(z).set(w,!0),c.get(w).set(z,!0))}for(const y of a)for(const m of a){if(y===m)continue;const O=d.get(y).get(m),D=c.get(y).get(m);if(O&&!D)return new AnnotatedAction(new FaceColorMakeSameAction(getFaceColorPointer(this.state,y),getFaceColorPointer(this.state,m)),{type:"FaceStateToSameFaceColor",face:e,facesA:r.filter(z=>this.state.getFaceColor(z)===y),facesB:r.filter(z=>this.state.getFaceColor(z)===m)});if(D&&!O&&this.state.getOppositeFaceColor(y)!==m)return new AnnotatedAction(new FaceColorMakeOppositeAction(getFaceColorPointer(this.state,y),getFaceColorPointer(this.state,m)),{type:"FaceStateToOppositeFaceColor",face:e,facesA:r.filter(z=>this.state.getFaceColor(z)===y),facesB:r.filter(z=>this.state.getFaceColor(z)===m)})}}const l=this.dirtyFaces.pop();assertEnabled()&&assert$2(l===e)}return null}clone(e){return new FaceToFaceColorSolver(this.board,e,this.dirtyFaces)}dispose(){this.state.faceStateChangedEmitter.removeListener(this.faceListener)}}class FaceToVertexSolver{constructor(e,t,n){ut(this,"dirtyFaces",[]);ut(this,"faceListener");this.board=e,this.state=t,n?this.dirtyFaces.push(...n):this.dirtyFaces.push(...e.faces),this.faceListener=r=>{this.dirtyFaces.push(r)},this.state.faceStateChangedEmitter.addListener(this.faceListener)}get dirty(){return this.dirtyFaces.length>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyFaces.length;){const e=this.dirtyFaces.pop(),t=this.state.getFaceState(e);if(t.possibilityCount===0)throw new InvalidStateError("Face has no possibilities");const n=e.vertices.map(l=>this.state.getVertexState(l)),r=n.map(l=>{const d=l.vertex.edges.filter(c=>c.faces.includes(e));return assertEnabled()&&assert$2(d.length===2),{vertex:l.vertex,vertexState:l,edgeA:d[0],edgeB:d[1],...l.getBinaryCombinationsAllowed(d[0],d[1])}}),s=r.map(l=>({vertex:l.vertex,vertexState:l.vertexState,edgeA:l.edgeA,edgeB:l.edgeB,allowsNone:!1,allowsBoth:!1,allowsAOnly:!1,allowsBOnly:!1}));for(const l of t.getAllowedCombinations())for(const d of s){const c=l.includes(d.edgeA),y=l.includes(d.edgeB);c&&y&&(d.allowsBoth=!0),c&&!y&&(d.allowsAOnly=!0),!c&&y&&(d.allowsBOnly=!0),!c&&!y&&(d.allowsNone=!0)}const a=[];for(let l=0;l<s.length;l++){const d=r[l],c=s[l];if(c.allowsBoth&&(c.allowsBoth=d.allowsBoth),c.allowsAOnly&&(c.allowsAOnly=d.allowsAOnly),c.allowsBOnly&&(c.allowsBOnly=d.allowsBOnly),c.allowsNone&&(c.allowsNone=d.allowsNone),c.allowsBoth!==d.allowsBoth||c.allowsAOnly!==d.allowsAOnly||c.allowsBOnly!==d.allowsBOnly||c.allowsNone!==d.allowsNone){const y=d.vertexState,m=VertexState.fromLookup(d.vertex,(O,D)=>{if(!y.allowsPair(O,D))return!1;const w=O===c.edgeA||D===c.edgeA,N=O===c.edgeB||D===c.edgeB;if(w&&N)return c.allowsBoth;if(w&&!N)return c.allowsAOnly;if(!w&&N)return c.allowsBOnly;if(!w&&!N)return c.allowsNone;throw new Error("Unreachable")},y.allowsEmpty()&&c.allowsNone);assertEnabled()&&assert$2(m.isSubsetOf(y)),y.equals(m)||a.push(m)}}if(a.length)return new AnnotatedAction(new CompositeAction(a.map(l=>new VertexStateSetAction(l.vertex,l))),{type:"FaceStateToVertexState",face:e,vertices:a.map(l=>l.vertex),beforeStates:a.map(l=>n.find(d=>d.vertex===l.vertex)),afterStates:a})}return null}clone(e){return new FaceToVertexSolver(this.board,e,this.dirtyFaces)}dispose(){this.state.faceStateChangedEmitter.removeListener(this.faceListener)}}const autoSolveSimpleVertexJointToRedProperty=new LocalStorageBooleanProperty("autoSolveSimpleVertexJointToRedProperty",!0),autoSolveSimpleVertexForcedLineToBlackProperty=new LocalStorageBooleanProperty("autoSolveSimpleVertexForcedLineToBlackProperty",!0),autoSolveSimpleVertexAlmostEmptyToRedProperty=new LocalStorageBooleanProperty("autoSolveSimpleVertexAlmostEmptyToRedProperty",!0),autoSolveSimpleFaceToRedProperty=new LocalStorageBooleanProperty("autoSolveSimpleFaceToRedProperty",!0),autoSolveSimpleFaceToBlackProperty=new LocalStorageBooleanProperty("autoSolveSimpleFaceToBlackProperty",!0),autoSolveSimpleLoopToRedProperty=new LocalStorageBooleanProperty("autoSolveSimpleLoopToRedProperty",!0),autoSolveSimpleLoopToBlackProperty=new LocalStorageBooleanProperty("autoSolveSimpleLoopToBlackProperty",!1),autoSolveDoubleMinusOneFacesProperty=new LocalStorageBooleanProperty("autoSolveDoubleMinusOneFacesProperty",!1),autoSolveStaticFaceSectorProperty=new LocalStorageBooleanProperty("autoSolveStaticFaceSectorProperty",!0),autoSolveSimpleSectorProperty=new LocalStorageBooleanProperty("autoSolveSimpleSectorProperty",!1),autoSolveVertexToRedEdgeProperty=new LocalStorageBooleanProperty("autoSolveVertexToRedEdgeProperty",!1),autoSolveVertexToBlackEdgeProperty=new LocalStorageBooleanProperty("autoSolveVertexToBlackEdgeProperty",!1),autoSolveVertexToSectorsProperty=new LocalStorageBooleanProperty("autoSolveVertexToSectorsProperty",!1),autoSolveVertexToFaceColorProperty=new LocalStorageBooleanProperty("autoSolveVertexToFaceColorProperty",!1),autoSolveFaceColorToRedProperty=new LocalStorageBooleanProperty("autoSolveFaceColorToRedProperty",!1),autoSolveFaceColorToBlackProperty=new LocalStorageBooleanProperty("autoSolveFaceColorToBlackProperty",!1),autoSolveFaceColorParityToRedProperty=new LocalStorageBooleanProperty("autoSolveFaceColorParityToRedProperty",!1),autoSolveFaceColorParityToBlackProperty=new LocalStorageBooleanProperty("autoSolveFaceColorParityToBlackProperty",!1),autoSolveFaceColorParityColorsProperty=new LocalStorageBooleanProperty("autoSolveFaceColorParityColorsProperty",!1),autoSolveFaceColorParityPartialReductionProperty=new LocalStorageBooleanProperty("autoSolveFaceColorParityPartialReductionProperty",!1),autoSolveVertexColorToFaceProperty=new LocalStorageBooleanProperty("autoSolveVertexColorToFaceProperty",!1),autoSolveFaceToRedProperty=new LocalStorageBooleanProperty("autoSolveFaceToRedProperty",!1),autoSolveFaceToBlackProperty=new LocalStorageBooleanProperty("autoSolveFaceToBlackProperty",!1),autoSolveFaceToSectorsProperty=new LocalStorageBooleanProperty("autoSolveFaceToSectorsProperty",!1),autoSolveFaceToFaceColorsProperty=new LocalStorageBooleanProperty("autoSolveFaceToFaceColorsProperty",!1),autoSolveFaceToVertexProperty=new LocalStorageBooleanProperty("autoSolveFaceToVertexProperty",!1),safeSolverFactory=(o,e,t)=>new CompositeSolver([new SafeEdgeToSimpleRegionSolver(o,e),new SafeSolvedEdgeSolver(o,e),new SafeEdgeToFaceColorSolver(o,e),new SafeEdgeToSectorSolver(o,e),new SafeEdgeSectorColorToVertexSolver(o,e)]),safeSolve=(o,e)=>{iterateSolverFactory(safeSolverFactory,o,e,!0)},finalStateSolverFactory=(o,e,t)=>new CompositeSolver([safeSolverFactory(o,e),new VertexColorToFaceSolver(o,e)]),finalStateSolve=(o,e)=>{iterateSolverFactory(finalStateSolverFactory,o,e,!0)},autoSolverFactoryProperty=new DerivedProperty([autoSolveSimpleVertexJointToRedProperty,autoSolveSimpleVertexForcedLineToBlackProperty,autoSolveSimpleVertexAlmostEmptyToRedProperty,autoSolveSimpleFaceToRedProperty,autoSolveSimpleFaceToBlackProperty,autoSolveSimpleLoopToRedProperty,autoSolveSimpleLoopToBlackProperty,autoSolveDoubleMinusOneFacesProperty,autoSolveStaticFaceSectorProperty,autoSolveSimpleSectorProperty,autoSolveVertexToRedEdgeProperty,autoSolveVertexToBlackEdgeProperty,autoSolveVertexToSectorsProperty,autoSolveVertexToFaceColorProperty,autoSolveFaceColorToRedProperty,autoSolveFaceColorToBlackProperty,autoSolveFaceColorParityToRedProperty,autoSolveFaceColorParityToBlackProperty,autoSolveFaceColorParityColorsProperty,autoSolveFaceColorParityPartialReductionProperty,autoSolveVertexColorToFaceProperty,autoSolveFaceToRedProperty,autoSolveFaceToBlackProperty,autoSolveFaceToSectorsProperty,autoSolveFaceToFaceColorsProperty,autoSolveFaceToVertexProperty],(o,e,t,n,r,s,a,l,d,c,y,m,O,D,z,w,N,H,X,ae,oe,ue,fe,be,Ae,W)=>(J,Ue,gt)=>new CompositeSolver([...o||e||t?[new SimpleVertexSolver(J,Ue,{solveJointToRed:o,solveForcedLineToBlack:e,solveAlmostEmptyToRed:t},gt?void 0:[])]:[],...n||r?[new SimpleFaceSolver(J,Ue,{solveToRed:n,solveToBlack:r},gt?void 0:[])]:[],...l?[new StaticDoubleMinusOneFacesSolver(J,Ue,gt?void 0:[])]:[],safeSolverFactory(J,Ue),...d?[new StaticSectorSolver(J,Ue,gt?void 0:[])]:[],...c?[new SimpleSectorSolver(J,Ue,gt?void 0:[])]:[],...s||a?[new SimpleLoopSolver(J,Ue,{solveToRed:s,solveToBlack:a,resolveAllRegions:!1},gt?void 0:[])]:[],...y||m?[new VertexToEdgeSolver(J,Ue,{solveToRed:y,solveToBlack:m},gt?void 0:[])]:[],...O?[new VertexToSectorSolver(J,Ue,gt?void 0:[])]:[],...z||w?[new SimpleFaceColorSolver(J,Ue,{solveToRed:z,solveToBlack:w},gt?void 0:[])]:[],...N||H||X?[new FaceColorParitySolver(J,Ue,{solveToRed:N,solveToBlack:H,solveColors:X,allowPartialReduction:ae},gt?void 0:[])]:[],...D?[new VertexToFaceColorSolver(J,Ue,gt?void 0:[])]:[],...oe?[new VertexColorToFaceSolver(J,Ue,gt?void 0:[])]:[],...ue||fe?[new FaceToEdgeSolver(J,Ue,{solveToRed:ue,solveToBlack:fe},gt?void 0:[])]:[],...be?[new FaceToSectorSolver(J,Ue,gt?void 0:[])]:[],...Ae?[new FaceToFaceColorSolver(J,Ue,gt?void 0:[])]:[],...W?[new FaceToVertexSolver(J,Ue,gt?void 0:[])]:[]])),standardSolverFactory=(o,e,t)=>new CompositeSolver([new SafeEdgeToSimpleRegionSolver(o,e),new SafeSolvedEdgeSolver(o,e),new SafeEdgeToFaceColorSolver(o,e),new SimpleVertexSolver(o,e,{solveJointToRed:!0,solveForcedLineToBlack:!0,solveAlmostEmptyToRed:!0}),new SimpleFaceSolver(o,e,{solveToRed:!0,solveToBlack:!0}),new SimpleLoopSolver(o,e,{solveToRed:!0,solveToBlack:!0,resolveAllRegions:!1}),new StaticDoubleMinusOneFacesSolver(o,e),new SafeEdgeToSectorSolver(o,e),new StaticSectorSolver(o,e),new SimpleSectorSolver(o,e),new SafeEdgeSectorColorToVertexSolver(o,e),new VertexToEdgeSolver(o,e,{solveToRed:!0,solveToBlack:!0}),new VertexToSectorSolver(o,e),new SimpleFaceColorSolver(o,e,{solveToRed:!0,solveToBlack:!0}),new FaceColorParitySolver(o,e,{solveToRed:!0,solveToBlack:!0,solveColors:!0,allowPartialReduction:!0}),new VertexToFaceColorSolver(o,e),new VertexColorToFaceSolver(o,e),new FaceToEdgeSolver(o,e,{solveToRed:!0,solveToBlack:!0}),new FaceToSectorSolver(o,e),new FaceToFaceColorSolver(o,e),new FaceToVertexSolver(o,e)]);class GeneralSimpleRegionDelta extends GeneralSimpleRegionAction{constructor(t,n,r=new Set,s=new Set,a=new Set,l=new Set){super(t,r,s,a,l);ut(this,"simpleRegionsChangedEmitter",new TinyEmitter);this.parentState=n}getSimpleRegions(){return[...this.parentState.getSimpleRegions().filter(t=>!this.removedRegions.has(t)),...this.addedRegions]}getSimpleRegionWithVertex(t){for(const n of this.getSimpleRegions())if(n.a===t||n.b===t)return n;return null}getSimpleRegionWithEdge(t){for(const n of this.getSimpleRegions())if(n.edges.includes(t))return n;return null}getSimpleRegionWithId(t){for(const n of this.getSimpleRegions())if(n.id===t)return n;return null}getWeirdEdges(){return[...this.parentState.getWeirdEdges().filter(t=>!this.removedWeirdEdges.has(t)),...this.addedWeirdEdges]}modifyRegions(t,n,r,s){for(const a of n)this.addedRegions.has(a)?this.addedRegions.delete(a):this.removedRegions.add(a);for(const a of t)this.addedRegions.add(a);for(const a of s)this.addedWeirdEdges.has(a)?this.addedWeirdEdges.delete(a):this.removedWeirdEdges.add(a);for(const a of r)this.addedWeirdEdges.add(a);this.simpleRegionsChangedEmitter.emit(t,n,r,s)}clone(){return new GeneralSimpleRegionDelta(this.board,this.parentState,new Set(this.addedRegions),new Set(this.removedRegions),new Set(this.addedWeirdEdges),new Set(this.removedWeirdEdges))}createDelta(){return new GeneralSimpleRegionDelta(this.board,this)}serializeState(t){return serializeSimpleRegionData(this)}}class GeneralSimpleRegionData{constructor(e,t,n){ut(this,"simpleRegionsChangedEmitter",new TinyEmitter);ut(this,"simpleRegions");ut(this,"weirdEdges");this.board=e,this.simpleRegions=new Set(t),this.weirdEdges=new Set(n)}getSimpleRegions(){return[...this.simpleRegions]}getSimpleRegionWithVertex(e){for(const t of this.simpleRegions)if(t.a===e||t.b===e)return t;return null}getSimpleRegionWithEdge(e){for(const t of this.simpleRegions)if(t.edges.includes(e))return t;return null}getSimpleRegionWithId(e){for(const t of this.simpleRegions)if(t.id===e)return t;return null}getWeirdEdges(){return[...this.weirdEdges]}modifyRegions(e,t,n,r){for(const s of t)this.simpleRegions.delete(s);for(const s of e)this.simpleRegions.add(s);for(const s of r)this.weirdEdges.delete(s);for(const s of n)this.weirdEdges.add(s);this.simpleRegionsChangedEmitter.emit(e,t,n,r)}clone(){return new GeneralSimpleRegionData(this.board,this.simpleRegions,this.weirdEdges)}createDelta(){return new GeneralSimpleRegionDelta(this.board,this)}serializeState(e){return serializeSimpleRegionData(this)}static deserializeState(e,t){return new GeneralSimpleRegionData(e,t.simpleRegions.map(n=>GeneralSimpleRegion.deserializeSimpleRegion(e,n)),t.weirdEdges.map(n=>deserializeEdge(e,n)))}}const deserializeState=(o,e)=>{const t=e.type;if(t==="CompleteData")return CompleteData.deserializeState(o,e);if(t==="FaceValueData")return GeneralFaceValueData.deserializeState(o,e);if(t==="EdgeData")return GeneralEdgeStateData.deserializeState(o,e);if(t==="SimpleRegionData")return GeneralSimpleRegionData.deserializeState(o,e);throw new Error(`Unknown action type: ${t}, could not deserialize`)};class SquareBoard extends BaseBoard{constructor(t,n){const r=[],s=new Map,a=(d,c)=>{const y=`${d},${c}`;if(!s.has(y)){const m={logicalCoordinates:new Vector2(d,c),viewCoordinates:new Vector2(d,c)};r.push(m),s.set(y,m)}return s.get(y)},l=_$1.range(0,n).flatMap(d=>_$1.range(0,t).map(c=>({logicalCoordinates:new Vector2(c,d),vertices:[a(c,d),a(c+1,d),a(c+1,d+1),a(c,d+1)]})));super(createBoardDescriptor({vertices:r,faces:l}));ut(this,"isSquare",!0);this.width=t,this.height=n,assertEnabled()&&validateBoard(this)}}class HexagonalBoard extends BaseBoard{constructor(t,n,r,s=0){let a,l;r?(a=new Vector2(Math.sqrt(3),0).timesScalar(n),l=new Vector2(Math.sqrt(3)/2,3/2).timesScalar(n)):(a=new Vector2(3/2,Math.sqrt(3)/2).timesScalar(n),l=new Vector2(0,Math.sqrt(3)).timesScalar(n));const d=[new Vector2(1,0),new Vector2(1,-1),new Vector2(0,-1),new Vector2(-1,0),new Vector2(-1,1),new Vector2(0,1)],c=_$1.range(0,6).map(N=>d[N].plus(d[(N+1)%6])),y=N=>c.map(H=>H.plus(N.timesScalar(3))),m=(N,H)=>(Math.abs(N.x-H.x)+Math.abs(N.x+N.y-H.x-H.y)+Math.abs(N.y-H.y))/2,O=[];for(let N=-t;N<=t;N++)for(let H=Math.max(-t,-N-t);H<=Math.min(t,-N+t);H++){const X=new Vector2(N,H);m(X,new Vector2(0,0))>=s&&O.push(X)}const z=_$1.uniqWith(O.flatMap(y),(N,H)=>N.equals(H)).map(N=>({logicalCoordinates:N,viewCoordinates:a.timesScalar(N.x).plus(l.timesScalar(N.y)).timesScalar(1/3)})),w=O.map(N=>({logicalCoordinates:N,vertices:y(N).map(H=>{const X=z.find(ae=>ae.logicalCoordinates.equals(H));return assertEnabled()&&assert$2(X),X})}));super(createBoardDescriptor(rescaleProtoDescriptorAverage({vertices:z,faces:w},n)));ut(this,"isHexagonal",!0);this.radius=t,this.scale=n,this.isPointyTop=r,this.holeRadius=s,assertEnabled()&&validateBoard(this)}static enumeratePointyFaceCoordinates(t){const n=[];for(let r=-t;r<=t;r++)for(let s=Math.max(-t,-r-t);s<=Math.min(t,-r+t);s++)n.push(new Vector2(s,r));return n}}const serializeBoard=o=>o instanceof SquareBoard?{type:"SquareBoard",width:o.width,height:o.height}:o instanceof HexagonalBoard?{type:"HexagonalBoard",radius:o.radius,scale:o.scale,isPointyTop:o.isPointyTop,holeRadius:o.holeRadius}:{type:"BaseBoard",vertices:o.vertices.map(e=>({x:e.logicalCoordinates.x,y:e.logicalCoordinates.y,vx:e.viewCoordinates.x,vy:e.viewCoordinates.y})),faces:o.faces.map(e=>({x:e.logicalCoordinates.x,y:e.logicalCoordinates.y,vertices:e.vertices.map(t=>o.vertices.indexOf(t))}))},deserializeBoard=o=>{if(o.type==="BaseBoard"){const e=o.vertices.map(n=>({logicalCoordinates:new Vector2(n.x,n.y),viewCoordinates:new Vector2(n.vx,n.vy)})),t=o.faces.map(n=>({logicalCoordinates:new Vector2(n.x,n.y),vertices:n.vertices.map(r=>e[r])}));return new BaseBoard(createBoardDescriptor({vertices:e,faces:t}))}else{if(o.type==="SquareBoard")return new SquareBoard(o.width,o.height);if(o.type==="HexagonalBoard")return new HexagonalBoard(o.radius,o.scale,o.isPointyTop,o.holeRadius);throw new Error("Unknown board")}};class BasicPuzzle{constructor(e,t){ut(this,"stateProperty");this.board=e,this.stateProperty=new TinyProperty(t)}static fromSolvedPuzzle(e){return new BasicPuzzle(e.board,e.cleanState)}static loadDefaultPuzzle(){return BasicPuzzle.loadFromSimpleString("10x18 .3.1....1..032....0......3.1....02.3...02....3.1...........2011.01..01.......3...2302..........1102...3.......22..03.0322...........3.2....13...2.30....2.2......1....103..2....1.3.")}static loadFromSimpleString(e){const[t,n]=e.split(" "),[r,s]=t.split("x").map(d=>parseInt(d)),a=new SquareBoard(r,s),l=CompleteData.fromFaces(a,d=>{const c=d.logicalCoordinates.y*r+d.logicalCoordinates.x,y=n[c];return y==="."?null:parseInt(y)});return new BasicPuzzle(a,l)}static loadDeprecatedScalaString(e){if(!e.includes("!"))return BasicPuzzle.loadFromSimpleString(e);const t=1,n=2,r=4,s=8,[a,l]=e.split(" "),[d,c]=a.split("x").map(z=>parseInt(z)),y=new SquareBoard(d,c),m=z=>3*(z.logicalCoordinates.y*d+z.logicalCoordinates.x)+1,O=(z,w)=>{const N=m(z),H=parseInt(l[N+1]),X=parseInt(l[N+2]);return H&w?EdgeState.BLACK:X&w?EdgeState.RED:EdgeState.WHITE},D=CompleteData.fromFacesEdges(y,z=>{const w=l[m(z)];return w==="."?null:parseInt(w)},z=>{if((z.start.logicalCoordinates.x===z.end.logicalCoordinates.x?Orientation.VERTICAL:Orientation.HORIZONTAL)===Orientation.HORIZONTAL){const N=z.start.logicalCoordinates.x<z.end.logicalCoordinates.x?z.forwardFace:z.reversedFace,H=z.start.logicalCoordinates.x<z.end.logicalCoordinates.x?z.reversedFace:z.forwardFace;return N?O(N,n):O(H,s)}else{const N=z.start.logicalCoordinates.y<z.end.logicalCoordinates.y?z.reversedFace:z.forwardFace,H=z.start.logicalCoordinates.y<z.end.logicalCoordinates.y?z.forwardFace:z.reversedFace;return N?O(N,t):O(H,r)}});return new BasicPuzzle(y,D)}static loadPointyTopHexagonalString(e){assertEnabled()&&assert$2(e.startsWith("h")||e.startsWith("H"));const[t,n]=e.slice(1).split(" "),r=parseInt(t),s=new HexagonalBoard(r,Math.sqrt(3)/2,e.startsWith("h")),a=HexagonalBoard.enumeratePointyFaceCoordinates(r),l=new Map;for(let c=0;c<n.length;c++){const y=n[c];if(y===".")continue;const m=a[c];l.set(m,parseInt(y))}const d=CompleteData.fromFaces(s,CompleteData.faceMapLookup(l));return new BasicPuzzle(s,d)}}/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const Z_FIXED$1=4,Z_BINARY=0,Z_TEXT=1,Z_UNKNOWN$1=2;function zero$1(o){let e=o.length;for(;--e>=0;)o[e]=0}const STORED_BLOCK=0,STATIC_TREES=1,DYN_TREES=2,MIN_MATCH$1=3,MAX_MATCH$1=258,LENGTH_CODES$1=29,LITERALS$1=256,L_CODES$1=LITERALS$1+1+LENGTH_CODES$1,D_CODES$1=30,BL_CODES$1=19,HEAP_SIZE$1=2*L_CODES$1+1,MAX_BITS$1=15,Buf_size=16,MAX_BL_BITS=7,END_BLOCK=256,REP_3_6=16,REPZ_3_10=17,REPZ_11_138=18,extra_lbits=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),extra_dbits=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),extra_blbits=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),bl_order=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),DIST_CODE_LEN=512,static_ltree=new Array((L_CODES$1+2)*2);zero$1(static_ltree);const static_dtree=new Array(D_CODES$1*2);zero$1(static_dtree);const _dist_code=new Array(DIST_CODE_LEN);zero$1(_dist_code);const _length_code=new Array(MAX_MATCH$1-MIN_MATCH$1+1);zero$1(_length_code);const base_length=new Array(LENGTH_CODES$1);zero$1(base_length);const base_dist=new Array(D_CODES$1);zero$1(base_dist);function StaticTreeDesc(o,e,t,n,r){this.static_tree=o,this.extra_bits=e,this.extra_base=t,this.elems=n,this.max_length=r,this.has_stree=o&&o.length}let static_l_desc,static_d_desc,static_bl_desc;function TreeDesc(o,e){this.dyn_tree=o,this.max_code=0,this.stat_desc=e}const d_code=o=>o<256?_dist_code[o]:_dist_code[256+(o>>>7)],put_short=(o,e)=>{o.pending_buf[o.pending++]=e&255,o.pending_buf[o.pending++]=e>>>8&255},send_bits=(o,e,t)=>{o.bi_valid>Buf_size-t?(o.bi_buf|=e<<o.bi_valid&65535,put_short(o,o.bi_buf),o.bi_buf=e>>Buf_size-o.bi_valid,o.bi_valid+=t-Buf_size):(o.bi_buf|=e<<o.bi_valid&65535,o.bi_valid+=t)},send_code=(o,e,t)=>{send_bits(o,t[e*2],t[e*2+1])},bi_reverse=(o,e)=>{let t=0;do t|=o&1,o>>>=1,t<<=1;while(--e>0);return t>>>1},bi_flush=o=>{o.bi_valid===16?(put_short(o,o.bi_buf),o.bi_buf=0,o.bi_valid=0):o.bi_valid>=8&&(o.pending_buf[o.pending++]=o.bi_buf&255,o.bi_buf>>=8,o.bi_valid-=8)},gen_bitlen=(o,e)=>{const t=e.dyn_tree,n=e.max_code,r=e.stat_desc.static_tree,s=e.stat_desc.has_stree,a=e.stat_desc.extra_bits,l=e.stat_desc.extra_base,d=e.stat_desc.max_length;let c,y,m,O,D,z,w=0;for(O=0;O<=MAX_BITS$1;O++)o.bl_count[O]=0;for(t[o.heap[o.heap_max]*2+1]=0,c=o.heap_max+1;c<HEAP_SIZE$1;c++)y=o.heap[c],O=t[t[y*2+1]*2+1]+1,O>d&&(O=d,w++),t[y*2+1]=O,!(y>n)&&(o.bl_count[O]++,D=0,y>=l&&(D=a[y-l]),z=t[y*2],o.opt_len+=z*(O+D),s&&(o.static_len+=z*(r[y*2+1]+D)));if(w!==0){do{for(O=d-1;o.bl_count[O]===0;)O--;o.bl_count[O]--,o.bl_count[O+1]+=2,o.bl_count[d]--,w-=2}while(w>0);for(O=d;O!==0;O--)for(y=o.bl_count[O];y!==0;)m=o.heap[--c],!(m>n)&&(t[m*2+1]!==O&&(o.opt_len+=(O-t[m*2+1])*t[m*2],t[m*2+1]=O),y--)}},gen_codes=(o,e,t)=>{const n=new Array(MAX_BITS$1+1);let r=0,s,a;for(s=1;s<=MAX_BITS$1;s++)r=r+t[s-1]<<1,n[s]=r;for(a=0;a<=e;a++){let l=o[a*2+1];l!==0&&(o[a*2]=bi_reverse(n[l]++,l))}},tr_static_init=()=>{let o,e,t,n,r;const s=new Array(MAX_BITS$1+1);for(t=0,n=0;n<LENGTH_CODES$1-1;n++)for(base_length[n]=t,o=0;o<1<<extra_lbits[n];o++)_length_code[t++]=n;for(_length_code[t-1]=n,r=0,n=0;n<16;n++)for(base_dist[n]=r,o=0;o<1<<extra_dbits[n];o++)_dist_code[r++]=n;for(r>>=7;n<D_CODES$1;n++)for(base_dist[n]=r<<7,o=0;o<1<<extra_dbits[n]-7;o++)_dist_code[256+r++]=n;for(e=0;e<=MAX_BITS$1;e++)s[e]=0;for(o=0;o<=143;)static_ltree[o*2+1]=8,o++,s[8]++;for(;o<=255;)static_ltree[o*2+1]=9,o++,s[9]++;for(;o<=279;)static_ltree[o*2+1]=7,o++,s[7]++;for(;o<=287;)static_ltree[o*2+1]=8,o++,s[8]++;for(gen_codes(static_ltree,L_CODES$1+1,s),o=0;o<D_CODES$1;o++)static_dtree[o*2+1]=5,static_dtree[o*2]=bi_reverse(o,5);static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS$1+1,L_CODES$1,MAX_BITS$1),static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES$1,MAX_BITS$1),static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES$1,MAX_BL_BITS)},init_block=o=>{let e;for(e=0;e<L_CODES$1;e++)o.dyn_ltree[e*2]=0;for(e=0;e<D_CODES$1;e++)o.dyn_dtree[e*2]=0;for(e=0;e<BL_CODES$1;e++)o.bl_tree[e*2]=0;o.dyn_ltree[END_BLOCK*2]=1,o.opt_len=o.static_len=0,o.sym_next=o.matches=0},bi_windup=o=>{o.bi_valid>8?put_short(o,o.bi_buf):o.bi_valid>0&&(o.pending_buf[o.pending++]=o.bi_buf),o.bi_buf=0,o.bi_valid=0},smaller=(o,e,t,n)=>{const r=e*2,s=t*2;return o[r]<o[s]||o[r]===o[s]&&n[e]<=n[t]},pqdownheap=(o,e,t)=>{const n=o.heap[t];let r=t<<1;for(;r<=o.heap_len&&(r<o.heap_len&&smaller(e,o.heap[r+1],o.heap[r],o.depth)&&r++,!smaller(e,n,o.heap[r],o.depth));)o.heap[t]=o.heap[r],t=r,r<<=1;o.heap[t]=n},compress_block=(o,e,t)=>{let n,r,s=0,a,l;if(o.sym_next!==0)do n=o.pending_buf[o.sym_buf+s++]&255,n+=(o.pending_buf[o.sym_buf+s++]&255)<<8,r=o.pending_buf[o.sym_buf+s++],n===0?send_code(o,r,e):(a=_length_code[r],send_code(o,a+LITERALS$1+1,e),l=extra_lbits[a],l!==0&&(r-=base_length[a],send_bits(o,r,l)),n--,a=d_code(n),send_code(o,a,t),l=extra_dbits[a],l!==0&&(n-=base_dist[a],send_bits(o,n,l)));while(s<o.sym_next);send_code(o,END_BLOCK,e)},build_tree=(o,e)=>{const t=e.dyn_tree,n=e.stat_desc.static_tree,r=e.stat_desc.has_stree,s=e.stat_desc.elems;let a,l,d=-1,c;for(o.heap_len=0,o.heap_max=HEAP_SIZE$1,a=0;a<s;a++)t[a*2]!==0?(o.heap[++o.heap_len]=d=a,o.depth[a]=0):t[a*2+1]=0;for(;o.heap_len<2;)c=o.heap[++o.heap_len]=d<2?++d:0,t[c*2]=1,o.depth[c]=0,o.opt_len--,r&&(o.static_len-=n[c*2+1]);for(e.max_code=d,a=o.heap_len>>1;a>=1;a--)pqdownheap(o,t,a);c=s;do a=o.heap[1],o.heap[1]=o.heap[o.heap_len--],pqdownheap(o,t,1),l=o.heap[1],o.heap[--o.heap_max]=a,o.heap[--o.heap_max]=l,t[c*2]=t[a*2]+t[l*2],o.depth[c]=(o.depth[a]>=o.depth[l]?o.depth[a]:o.depth[l])+1,t[a*2+1]=t[l*2+1]=c,o.heap[1]=c++,pqdownheap(o,t,1);while(o.heap_len>=2);o.heap[--o.heap_max]=o.heap[1],gen_bitlen(o,e),gen_codes(t,d,o.bl_count)},scan_tree=(o,e,t)=>{let n,r=-1,s,a=e[0*2+1],l=0,d=7,c=4;for(a===0&&(d=138,c=3),e[(t+1)*2+1]=65535,n=0;n<=t;n++)s=a,a=e[(n+1)*2+1],!(++l<d&&s===a)&&(l<c?o.bl_tree[s*2]+=l:s!==0?(s!==r&&o.bl_tree[s*2]++,o.bl_tree[REP_3_6*2]++):l<=10?o.bl_tree[REPZ_3_10*2]++:o.bl_tree[REPZ_11_138*2]++,l=0,r=s,a===0?(d=138,c=3):s===a?(d=6,c=3):(d=7,c=4))},send_tree=(o,e,t)=>{let n,r=-1,s,a=e[0*2+1],l=0,d=7,c=4;for(a===0&&(d=138,c=3),n=0;n<=t;n++)if(s=a,a=e[(n+1)*2+1],!(++l<d&&s===a)){if(l<c)do send_code(o,s,o.bl_tree);while(--l!==0);else s!==0?(s!==r&&(send_code(o,s,o.bl_tree),l--),send_code(o,REP_3_6,o.bl_tree),send_bits(o,l-3,2)):l<=10?(send_code(o,REPZ_3_10,o.bl_tree),send_bits(o,l-3,3)):(send_code(o,REPZ_11_138,o.bl_tree),send_bits(o,l-11,7));l=0,r=s,a===0?(d=138,c=3):s===a?(d=6,c=3):(d=7,c=4)}},build_bl_tree=o=>{let e;for(scan_tree(o,o.dyn_ltree,o.l_desc.max_code),scan_tree(o,o.dyn_dtree,o.d_desc.max_code),build_tree(o,o.bl_desc),e=BL_CODES$1-1;e>=3&&o.bl_tree[bl_order[e]*2+1]===0;e--);return o.opt_len+=3*(e+1)+5+5+4,e},send_all_trees=(o,e,t,n)=>{let r;for(send_bits(o,e-257,5),send_bits(o,t-1,5),send_bits(o,n-4,4),r=0;r<n;r++)send_bits(o,o.bl_tree[bl_order[r]*2+1],3);send_tree(o,o.dyn_ltree,e-1),send_tree(o,o.dyn_dtree,t-1)},detect_data_type=o=>{let e=4093624447,t;for(t=0;t<=31;t++,e>>>=1)if(e&1&&o.dyn_ltree[t*2]!==0)return Z_BINARY;if(o.dyn_ltree[9*2]!==0||o.dyn_ltree[10*2]!==0||o.dyn_ltree[13*2]!==0)return Z_TEXT;for(t=32;t<LITERALS$1;t++)if(o.dyn_ltree[t*2]!==0)return Z_TEXT;return Z_BINARY};let static_init_done=!1;const _tr_init$1=o=>{static_init_done||(tr_static_init(),static_init_done=!0),o.l_desc=new TreeDesc(o.dyn_ltree,static_l_desc),o.d_desc=new TreeDesc(o.dyn_dtree,static_d_desc),o.bl_desc=new TreeDesc(o.bl_tree,static_bl_desc),o.bi_buf=0,o.bi_valid=0,init_block(o)},_tr_stored_block$1=(o,e,t,n)=>{send_bits(o,(STORED_BLOCK<<1)+(n?1:0),3),bi_windup(o),put_short(o,t),put_short(o,~t),t&&o.pending_buf.set(o.window.subarray(e,e+t),o.pending),o.pending+=t},_tr_align$1=o=>{send_bits(o,STATIC_TREES<<1,3),send_code(o,END_BLOCK,static_ltree),bi_flush(o)},_tr_flush_block$1=(o,e,t,n)=>{let r,s,a=0;o.level>0?(o.strm.data_type===Z_UNKNOWN$1&&(o.strm.data_type=detect_data_type(o)),build_tree(o,o.l_desc),build_tree(o,o.d_desc),a=build_bl_tree(o),r=o.opt_len+3+7>>>3,s=o.static_len+3+7>>>3,s<=r&&(r=s)):r=s=t+5,t+4<=r&&e!==-1?_tr_stored_block$1(o,e,t,n):o.strategy===Z_FIXED$1||s===r?(send_bits(o,(STATIC_TREES<<1)+(n?1:0),3),compress_block(o,static_ltree,static_dtree)):(send_bits(o,(DYN_TREES<<1)+(n?1:0),3),send_all_trees(o,o.l_desc.max_code+1,o.d_desc.max_code+1,a+1),compress_block(o,o.dyn_ltree,o.dyn_dtree)),init_block(o),n&&bi_windup(o)},_tr_tally$1=(o,e,t)=>(o.pending_buf[o.sym_buf+o.sym_next++]=e,o.pending_buf[o.sym_buf+o.sym_next++]=e>>8,o.pending_buf[o.sym_buf+o.sym_next++]=t,e===0?o.dyn_ltree[t*2]++:(o.matches++,e--,o.dyn_ltree[(_length_code[t]+LITERALS$1+1)*2]++,o.dyn_dtree[d_code(e)*2]++),o.sym_next===o.sym_end);var _tr_init_1=_tr_init$1,_tr_stored_block_1=_tr_stored_block$1,_tr_flush_block_1=_tr_flush_block$1,_tr_tally_1=_tr_tally$1,_tr_align_1=_tr_align$1,trees={_tr_init:_tr_init_1,_tr_stored_block:_tr_stored_block_1,_tr_flush_block:_tr_flush_block_1,_tr_tally:_tr_tally_1,_tr_align:_tr_align_1};const adler32=(o,e,t,n)=>{let r=o&65535|0,s=o>>>16&65535|0,a=0;for(;t!==0;){a=t>2e3?2e3:t,t-=a;do r=r+e[n++]|0,s=s+r|0;while(--a);r%=65521,s%=65521}return r|s<<16|0};var adler32_1=adler32;const makeTable=()=>{let o,e=[];for(var t=0;t<256;t++){o=t;for(var n=0;n<8;n++)o=o&1?3988292384^o>>>1:o>>>1;e[t]=o}return e},crcTable=new Uint32Array(makeTable()),crc32=(o,e,t,n)=>{const r=crcTable,s=n+t;o^=-1;for(let a=n;a<s;a++)o=o>>>8^r[(o^e[a])&255];return o^-1};var crc32_1=crc32,messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},constants$2={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init,_tr_stored_block,_tr_flush_block,_tr_tally,_tr_align}=trees,{Z_NO_FLUSH:Z_NO_FLUSH$2,Z_PARTIAL_FLUSH,Z_FULL_FLUSH:Z_FULL_FLUSH$1,Z_FINISH:Z_FINISH$3,Z_BLOCK:Z_BLOCK$1,Z_OK:Z_OK$3,Z_STREAM_END:Z_STREAM_END$3,Z_STREAM_ERROR:Z_STREAM_ERROR$2,Z_DATA_ERROR:Z_DATA_ERROR$2,Z_BUF_ERROR:Z_BUF_ERROR$1,Z_DEFAULT_COMPRESSION:Z_DEFAULT_COMPRESSION$1,Z_FILTERED,Z_HUFFMAN_ONLY,Z_RLE,Z_FIXED,Z_DEFAULT_STRATEGY:Z_DEFAULT_STRATEGY$1,Z_UNKNOWN,Z_DEFLATED:Z_DEFLATED$2}=constants$2,MAX_MEM_LEVEL=9,MAX_WBITS$1=15,DEF_MEM_LEVEL=8,LENGTH_CODES=29,LITERALS=256,L_CODES=LITERALS+1+LENGTH_CODES,D_CODES=30,BL_CODES=19,HEAP_SIZE=2*L_CODES+1,MAX_BITS=15,MIN_MATCH=3,MAX_MATCH=258,MIN_LOOKAHEAD=MAX_MATCH+MIN_MATCH+1,PRESET_DICT=32,INIT_STATE=42,GZIP_STATE=57,EXTRA_STATE=69,NAME_STATE=73,COMMENT_STATE=91,HCRC_STATE=103,BUSY_STATE=113,FINISH_STATE=666,BS_NEED_MORE=1,BS_BLOCK_DONE=2,BS_FINISH_STARTED=3,BS_FINISH_DONE=4,OS_CODE=3,err=(o,e)=>(o.msg=messages[e],e),rank=o=>o*2-(o>4?9:0),zero=o=>{let e=o.length;for(;--e>=0;)o[e]=0},slide_hash=o=>{let e,t,n,r=o.w_size;e=o.hash_size,n=e;do t=o.head[--n],o.head[n]=t>=r?t-r:0;while(--e);e=r,n=e;do t=o.prev[--n],o.prev[n]=t>=r?t-r:0;while(--e)};let HASH_ZLIB=(o,e,t)=>(e<<o.hash_shift^t)&o.hash_mask,HASH=HASH_ZLIB;const flush_pending=o=>{const e=o.state;let t=e.pending;t>o.avail_out&&(t=o.avail_out),t!==0&&(o.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+t),o.next_out),o.next_out+=t,e.pending_out+=t,o.total_out+=t,o.avail_out-=t,e.pending-=t,e.pending===0&&(e.pending_out=0))},flush_block_only=(o,e)=>{_tr_flush_block(o,o.block_start>=0?o.block_start:-1,o.strstart-o.block_start,e),o.block_start=o.strstart,flush_pending(o.strm)},put_byte=(o,e)=>{o.pending_buf[o.pending++]=e},putShortMSB=(o,e)=>{o.pending_buf[o.pending++]=e>>>8&255,o.pending_buf[o.pending++]=e&255},read_buf=(o,e,t,n)=>{let r=o.avail_in;return r>n&&(r=n),r===0?0:(o.avail_in-=r,e.set(o.input.subarray(o.next_in,o.next_in+r),t),o.state.wrap===1?o.adler=adler32_1(o.adler,e,r,t):o.state.wrap===2&&(o.adler=crc32_1(o.adler,e,r,t)),o.next_in+=r,o.total_in+=r,r)},longest_match=(o,e)=>{let t=o.max_chain_length,n=o.strstart,r,s,a=o.prev_length,l=o.nice_match;const d=o.strstart>o.w_size-MIN_LOOKAHEAD?o.strstart-(o.w_size-MIN_LOOKAHEAD):0,c=o.window,y=o.w_mask,m=o.prev,O=o.strstart+MAX_MATCH;let D=c[n+a-1],z=c[n+a];o.prev_length>=o.good_match&&(t>>=2),l>o.lookahead&&(l=o.lookahead);do if(r=e,!(c[r+a]!==z||c[r+a-1]!==D||c[r]!==c[n]||c[++r]!==c[n+1])){n+=2,r++;do;while(c[++n]===c[++r]&&c[++n]===c[++r]&&c[++n]===c[++r]&&c[++n]===c[++r]&&c[++n]===c[++r]&&c[++n]===c[++r]&&c[++n]===c[++r]&&c[++n]===c[++r]&&n<O);if(s=MAX_MATCH-(O-n),n=O-MAX_MATCH,s>a){if(o.match_start=e,a=s,s>=l)break;D=c[n+a-1],z=c[n+a]}}while((e=m[e&y])>d&&--t!==0);return a<=o.lookahead?a:o.lookahead},fill_window=o=>{const e=o.w_size;let t,n,r;do{if(n=o.window_size-o.lookahead-o.strstart,o.strstart>=e+(e-MIN_LOOKAHEAD)&&(o.window.set(o.window.subarray(e,e+e-n),0),o.match_start-=e,o.strstart-=e,o.block_start-=e,o.insert>o.strstart&&(o.insert=o.strstart),slide_hash(o),n+=e),o.strm.avail_in===0)break;if(t=read_buf(o.strm,o.window,o.strstart+o.lookahead,n),o.lookahead+=t,o.lookahead+o.insert>=MIN_MATCH)for(r=o.strstart-o.insert,o.ins_h=o.window[r],o.ins_h=HASH(o,o.ins_h,o.window[r+1]);o.insert&&(o.ins_h=HASH(o,o.ins_h,o.window[r+MIN_MATCH-1]),o.prev[r&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=r,r++,o.insert--,!(o.lookahead+o.insert<MIN_MATCH)););}while(o.lookahead<MIN_LOOKAHEAD&&o.strm.avail_in!==0)},deflate_stored=(o,e)=>{let t=o.pending_buf_size-5>o.w_size?o.w_size:o.pending_buf_size-5,n,r,s,a=0,l=o.strm.avail_in;do{if(n=65535,s=o.bi_valid+42>>3,o.strm.avail_out<s||(s=o.strm.avail_out-s,r=o.strstart-o.block_start,n>r+o.strm.avail_in&&(n=r+o.strm.avail_in),n>s&&(n=s),n<t&&(n===0&&e!==Z_FINISH$3||e===Z_NO_FLUSH$2||n!==r+o.strm.avail_in)))break;a=e===Z_FINISH$3&&n===r+o.strm.avail_in?1:0,_tr_stored_block(o,0,0,a),o.pending_buf[o.pending-4]=n,o.pending_buf[o.pending-3]=n>>8,o.pending_buf[o.pending-2]=~n,o.pending_buf[o.pending-1]=~n>>8,flush_pending(o.strm),r&&(r>n&&(r=n),o.strm.output.set(o.window.subarray(o.block_start,o.block_start+r),o.strm.next_out),o.strm.next_out+=r,o.strm.avail_out-=r,o.strm.total_out+=r,o.block_start+=r,n-=r),n&&(read_buf(o.strm,o.strm.output,o.strm.next_out,n),o.strm.next_out+=n,o.strm.avail_out-=n,o.strm.total_out+=n)}while(a===0);return l-=o.strm.avail_in,l&&(l>=o.w_size?(o.matches=2,o.window.set(o.strm.input.subarray(o.strm.next_in-o.w_size,o.strm.next_in),0),o.strstart=o.w_size,o.insert=o.strstart):(o.window_size-o.strstart<=l&&(o.strstart-=o.w_size,o.window.set(o.window.subarray(o.w_size,o.w_size+o.strstart),0),o.matches<2&&o.matches++,o.insert>o.strstart&&(o.insert=o.strstart)),o.window.set(o.strm.input.subarray(o.strm.next_in-l,o.strm.next_in),o.strstart),o.strstart+=l,o.insert+=l>o.w_size-o.insert?o.w_size-o.insert:l),o.block_start=o.strstart),o.high_water<o.strstart&&(o.high_water=o.strstart),a?BS_FINISH_DONE:e!==Z_NO_FLUSH$2&&e!==Z_FINISH$3&&o.strm.avail_in===0&&o.strstart===o.block_start?BS_BLOCK_DONE:(s=o.window_size-o.strstart,o.strm.avail_in>s&&o.block_start>=o.w_size&&(o.block_start-=o.w_size,o.strstart-=o.w_size,o.window.set(o.window.subarray(o.w_size,o.w_size+o.strstart),0),o.matches<2&&o.matches++,s+=o.w_size,o.insert>o.strstart&&(o.insert=o.strstart)),s>o.strm.avail_in&&(s=o.strm.avail_in),s&&(read_buf(o.strm,o.window,o.strstart,s),o.strstart+=s,o.insert+=s>o.w_size-o.insert?o.w_size-o.insert:s),o.high_water<o.strstart&&(o.high_water=o.strstart),s=o.bi_valid+42>>3,s=o.pending_buf_size-s>65535?65535:o.pending_buf_size-s,t=s>o.w_size?o.w_size:s,r=o.strstart-o.block_start,(r>=t||(r||e===Z_FINISH$3)&&e!==Z_NO_FLUSH$2&&o.strm.avail_in===0&&r<=s)&&(n=r>s?s:r,a=e===Z_FINISH$3&&o.strm.avail_in===0&&n===r?1:0,_tr_stored_block(o,o.block_start,n,a),o.block_start+=n,flush_pending(o.strm)),a?BS_FINISH_STARTED:BS_NEED_MORE)},deflate_fast=(o,e)=>{let t,n;for(;;){if(o.lookahead<MIN_LOOKAHEAD){if(fill_window(o),o.lookahead<MIN_LOOKAHEAD&&e===Z_NO_FLUSH$2)return BS_NEED_MORE;if(o.lookahead===0)break}if(t=0,o.lookahead>=MIN_MATCH&&(o.ins_h=HASH(o,o.ins_h,o.window[o.strstart+MIN_MATCH-1]),t=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart),t!==0&&o.strstart-t<=o.w_size-MIN_LOOKAHEAD&&(o.match_length=longest_match(o,t)),o.match_length>=MIN_MATCH)if(n=_tr_tally(o,o.strstart-o.match_start,o.match_length-MIN_MATCH),o.lookahead-=o.match_length,o.match_length<=o.max_lazy_match&&o.lookahead>=MIN_MATCH){o.match_length--;do o.strstart++,o.ins_h=HASH(o,o.ins_h,o.window[o.strstart+MIN_MATCH-1]),t=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart;while(--o.match_length!==0);o.strstart++}else o.strstart+=o.match_length,o.match_length=0,o.ins_h=o.window[o.strstart],o.ins_h=HASH(o,o.ins_h,o.window[o.strstart+1]);else n=_tr_tally(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++;if(n&&(flush_block_only(o,!1),o.strm.avail_out===0))return BS_NEED_MORE}return o.insert=o.strstart<MIN_MATCH-1?o.strstart:MIN_MATCH-1,e===Z_FINISH$3?(flush_block_only(o,!0),o.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):o.sym_next&&(flush_block_only(o,!1),o.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_slow=(o,e)=>{let t,n,r;for(;;){if(o.lookahead<MIN_LOOKAHEAD){if(fill_window(o),o.lookahead<MIN_LOOKAHEAD&&e===Z_NO_FLUSH$2)return BS_NEED_MORE;if(o.lookahead===0)break}if(t=0,o.lookahead>=MIN_MATCH&&(o.ins_h=HASH(o,o.ins_h,o.window[o.strstart+MIN_MATCH-1]),t=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart),o.prev_length=o.match_length,o.prev_match=o.match_start,o.match_length=MIN_MATCH-1,t!==0&&o.prev_length<o.max_lazy_match&&o.strstart-t<=o.w_size-MIN_LOOKAHEAD&&(o.match_length=longest_match(o,t),o.match_length<=5&&(o.strategy===Z_FILTERED||o.match_length===MIN_MATCH&&o.strstart-o.match_start>4096)&&(o.match_length=MIN_MATCH-1)),o.prev_length>=MIN_MATCH&&o.match_length<=o.prev_length){r=o.strstart+o.lookahead-MIN_MATCH,n=_tr_tally(o,o.strstart-1-o.prev_match,o.prev_length-MIN_MATCH),o.lookahead-=o.prev_length-1,o.prev_length-=2;do++o.strstart<=r&&(o.ins_h=HASH(o,o.ins_h,o.window[o.strstart+MIN_MATCH-1]),t=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart);while(--o.prev_length!==0);if(o.match_available=0,o.match_length=MIN_MATCH-1,o.strstart++,n&&(flush_block_only(o,!1),o.strm.avail_out===0))return BS_NEED_MORE}else if(o.match_available){if(n=_tr_tally(o,0,o.window[o.strstart-1]),n&&flush_block_only(o,!1),o.strstart++,o.lookahead--,o.strm.avail_out===0)return BS_NEED_MORE}else o.match_available=1,o.strstart++,o.lookahead--}return o.match_available&&(n=_tr_tally(o,0,o.window[o.strstart-1]),o.match_available=0),o.insert=o.strstart<MIN_MATCH-1?o.strstart:MIN_MATCH-1,e===Z_FINISH$3?(flush_block_only(o,!0),o.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):o.sym_next&&(flush_block_only(o,!1),o.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_rle=(o,e)=>{let t,n,r,s;const a=o.window;for(;;){if(o.lookahead<=MAX_MATCH){if(fill_window(o),o.lookahead<=MAX_MATCH&&e===Z_NO_FLUSH$2)return BS_NEED_MORE;if(o.lookahead===0)break}if(o.match_length=0,o.lookahead>=MIN_MATCH&&o.strstart>0&&(r=o.strstart-1,n=a[r],n===a[++r]&&n===a[++r]&&n===a[++r])){s=o.strstart+MAX_MATCH;do;while(n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&r<s);o.match_length=MAX_MATCH-(s-r),o.match_length>o.lookahead&&(o.match_length=o.lookahead)}if(o.match_length>=MIN_MATCH?(t=_tr_tally(o,1,o.match_length-MIN_MATCH),o.lookahead-=o.match_length,o.strstart+=o.match_length,o.match_length=0):(t=_tr_tally(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++),t&&(flush_block_only(o,!1),o.strm.avail_out===0))return BS_NEED_MORE}return o.insert=0,e===Z_FINISH$3?(flush_block_only(o,!0),o.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):o.sym_next&&(flush_block_only(o,!1),o.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_huff=(o,e)=>{let t;for(;;){if(o.lookahead===0&&(fill_window(o),o.lookahead===0)){if(e===Z_NO_FLUSH$2)return BS_NEED_MORE;break}if(o.match_length=0,t=_tr_tally(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++,t&&(flush_block_only(o,!1),o.strm.avail_out===0))return BS_NEED_MORE}return o.insert=0,e===Z_FINISH$3?(flush_block_only(o,!0),o.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):o.sym_next&&(flush_block_only(o,!1),o.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE};function Config(o,e,t,n,r){this.good_length=o,this.max_lazy=e,this.nice_length=t,this.max_chain=n,this.func=r}const configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)],lm_init=o=>{o.window_size=2*o.w_size,zero(o.head),o.max_lazy_match=configuration_table[o.level].max_lazy,o.good_match=configuration_table[o.level].good_length,o.nice_match=configuration_table[o.level].nice_length,o.max_chain_length=configuration_table[o.level].max_chain,o.strstart=0,o.block_start=0,o.lookahead=0,o.insert=0,o.match_length=o.prev_length=MIN_MATCH-1,o.match_available=0,o.ins_h=0};function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z_DEFLATED$2,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(HEAP_SIZE*2),this.dyn_dtree=new Uint16Array((2*D_CODES+1)*2),this.bl_tree=new Uint16Array((2*BL_CODES+1)*2),zero(this.dyn_ltree),zero(this.dyn_dtree),zero(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(MAX_BITS+1),this.heap=new Uint16Array(2*L_CODES+1),zero(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*L_CODES+1),zero(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const deflateStateCheck=o=>{if(!o)return 1;const e=o.state;return!e||e.strm!==o||e.status!==INIT_STATE&&e.status!==GZIP_STATE&&e.status!==EXTRA_STATE&&e.status!==NAME_STATE&&e.status!==COMMENT_STATE&&e.status!==HCRC_STATE&&e.status!==BUSY_STATE&&e.status!==FINISH_STATE?1:0},deflateResetKeep=o=>{if(deflateStateCheck(o))return err(o,Z_STREAM_ERROR$2);o.total_in=o.total_out=0,o.data_type=Z_UNKNOWN;const e=o.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?GZIP_STATE:e.wrap?INIT_STATE:BUSY_STATE,o.adler=e.wrap===2?0:1,e.last_flush=-2,_tr_init(e),Z_OK$3},deflateReset=o=>{const e=deflateResetKeep(o);return e===Z_OK$3&&lm_init(o.state),e},deflateSetHeader=(o,e)=>deflateStateCheck(o)||o.state.wrap!==2?Z_STREAM_ERROR$2:(o.state.gzhead=e,Z_OK$3),deflateInit2=(o,e,t,n,r,s)=>{if(!o)return Z_STREAM_ERROR$2;let a=1;if(e===Z_DEFAULT_COMPRESSION$1&&(e=6),n<0?(a=0,n=-n):n>15&&(a=2,n-=16),r<1||r>MAX_MEM_LEVEL||t!==Z_DEFLATED$2||n<8||n>15||e<0||e>9||s<0||s>Z_FIXED||n===8&&a!==1)return err(o,Z_STREAM_ERROR$2);n===8&&(n=9);const l=new DeflateState;return o.state=l,l.strm=o,l.status=INIT_STATE,l.wrap=a,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=r+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+MIN_MATCH-1)/MIN_MATCH),l.window=new Uint8Array(l.w_size*2),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<r+6,l.pending_buf_size=l.lit_bufsize*4,l.pending_buf=new Uint8Array(l.pending_buf_size),l.sym_buf=l.lit_bufsize,l.sym_end=(l.lit_bufsize-1)*3,l.level=e,l.strategy=s,l.method=t,deflateReset(o)},deflateInit=(o,e)=>deflateInit2(o,e,Z_DEFLATED$2,MAX_WBITS$1,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY$1),deflate$2=(o,e)=>{if(deflateStateCheck(o)||e>Z_BLOCK$1||e<0)return o?err(o,Z_STREAM_ERROR$2):Z_STREAM_ERROR$2;const t=o.state;if(!o.output||o.avail_in!==0&&!o.input||t.status===FINISH_STATE&&e!==Z_FINISH$3)return err(o,o.avail_out===0?Z_BUF_ERROR$1:Z_STREAM_ERROR$2);const n=t.last_flush;if(t.last_flush=e,t.pending!==0){if(flush_pending(o),o.avail_out===0)return t.last_flush=-1,Z_OK$3}else if(o.avail_in===0&&rank(e)<=rank(n)&&e!==Z_FINISH$3)return err(o,Z_BUF_ERROR$1);if(t.status===FINISH_STATE&&o.avail_in!==0)return err(o,Z_BUF_ERROR$1);if(t.status===INIT_STATE&&t.wrap===0&&(t.status=BUSY_STATE),t.status===INIT_STATE){let r=Z_DEFLATED$2+(t.w_bits-8<<4)<<8,s=-1;if(t.strategy>=Z_HUFFMAN_ONLY||t.level<2?s=0:t.level<6?s=1:t.level===6?s=2:s=3,r|=s<<6,t.strstart!==0&&(r|=PRESET_DICT),r+=31-r%31,putShortMSB(t,r),t.strstart!==0&&(putShortMSB(t,o.adler>>>16),putShortMSB(t,o.adler&65535)),o.adler=1,t.status=BUSY_STATE,flush_pending(o),t.pending!==0)return t.last_flush=-1,Z_OK$3}if(t.status===GZIP_STATE){if(o.adler=0,put_byte(t,31),put_byte(t,139),put_byte(t,8),t.gzhead)put_byte(t,(t.gzhead.text?1:0)+(t.gzhead.hcrc?2:0)+(t.gzhead.extra?4:0)+(t.gzhead.name?8:0)+(t.gzhead.comment?16:0)),put_byte(t,t.gzhead.time&255),put_byte(t,t.gzhead.time>>8&255),put_byte(t,t.gzhead.time>>16&255),put_byte(t,t.gzhead.time>>24&255),put_byte(t,t.level===9?2:t.strategy>=Z_HUFFMAN_ONLY||t.level<2?4:0),put_byte(t,t.gzhead.os&255),t.gzhead.extra&&t.gzhead.extra.length&&(put_byte(t,t.gzhead.extra.length&255),put_byte(t,t.gzhead.extra.length>>8&255)),t.gzhead.hcrc&&(o.adler=crc32_1(o.adler,t.pending_buf,t.pending,0)),t.gzindex=0,t.status=EXTRA_STATE;else if(put_byte(t,0),put_byte(t,0),put_byte(t,0),put_byte(t,0),put_byte(t,0),put_byte(t,t.level===9?2:t.strategy>=Z_HUFFMAN_ONLY||t.level<2?4:0),put_byte(t,OS_CODE),t.status=BUSY_STATE,flush_pending(o),t.pending!==0)return t.last_flush=-1,Z_OK$3}if(t.status===EXTRA_STATE){if(t.gzhead.extra){let r=t.pending,s=(t.gzhead.extra.length&65535)-t.gzindex;for(;t.pending+s>t.pending_buf_size;){let l=t.pending_buf_size-t.pending;if(t.pending_buf.set(t.gzhead.extra.subarray(t.gzindex,t.gzindex+l),t.pending),t.pending=t.pending_buf_size,t.gzhead.hcrc&&t.pending>r&&(o.adler=crc32_1(o.adler,t.pending_buf,t.pending-r,r)),t.gzindex+=l,flush_pending(o),t.pending!==0)return t.last_flush=-1,Z_OK$3;r=0,s-=l}let a=new Uint8Array(t.gzhead.extra);t.pending_buf.set(a.subarray(t.gzindex,t.gzindex+s),t.pending),t.pending+=s,t.gzhead.hcrc&&t.pending>r&&(o.adler=crc32_1(o.adler,t.pending_buf,t.pending-r,r)),t.gzindex=0}t.status=NAME_STATE}if(t.status===NAME_STATE){if(t.gzhead.name){let r=t.pending,s;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>r&&(o.adler=crc32_1(o.adler,t.pending_buf,t.pending-r,r)),flush_pending(o),t.pending!==0)return t.last_flush=-1,Z_OK$3;r=0}t.gzindex<t.gzhead.name.length?s=t.gzhead.name.charCodeAt(t.gzindex++)&255:s=0,put_byte(t,s)}while(s!==0);t.gzhead.hcrc&&t.pending>r&&(o.adler=crc32_1(o.adler,t.pending_buf,t.pending-r,r)),t.gzindex=0}t.status=COMMENT_STATE}if(t.status===COMMENT_STATE){if(t.gzhead.comment){let r=t.pending,s;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>r&&(o.adler=crc32_1(o.adler,t.pending_buf,t.pending-r,r)),flush_pending(o),t.pending!==0)return t.last_flush=-1,Z_OK$3;r=0}t.gzindex<t.gzhead.comment.length?s=t.gzhead.comment.charCodeAt(t.gzindex++)&255:s=0,put_byte(t,s)}while(s!==0);t.gzhead.hcrc&&t.pending>r&&(o.adler=crc32_1(o.adler,t.pending_buf,t.pending-r,r))}t.status=HCRC_STATE}if(t.status===HCRC_STATE){if(t.gzhead.hcrc){if(t.pending+2>t.pending_buf_size&&(flush_pending(o),t.pending!==0))return t.last_flush=-1,Z_OK$3;put_byte(t,o.adler&255),put_byte(t,o.adler>>8&255),o.adler=0}if(t.status=BUSY_STATE,flush_pending(o),t.pending!==0)return t.last_flush=-1,Z_OK$3}if(o.avail_in!==0||t.lookahead!==0||e!==Z_NO_FLUSH$2&&t.status!==FINISH_STATE){let r=t.level===0?deflate_stored(t,e):t.strategy===Z_HUFFMAN_ONLY?deflate_huff(t,e):t.strategy===Z_RLE?deflate_rle(t,e):configuration_table[t.level].func(t,e);if((r===BS_FINISH_STARTED||r===BS_FINISH_DONE)&&(t.status=FINISH_STATE),r===BS_NEED_MORE||r===BS_FINISH_STARTED)return o.avail_out===0&&(t.last_flush=-1),Z_OK$3;if(r===BS_BLOCK_DONE&&(e===Z_PARTIAL_FLUSH?_tr_align(t):e!==Z_BLOCK$1&&(_tr_stored_block(t,0,0,!1),e===Z_FULL_FLUSH$1&&(zero(t.head),t.lookahead===0&&(t.strstart=0,t.block_start=0,t.insert=0))),flush_pending(o),o.avail_out===0))return t.last_flush=-1,Z_OK$3}return e!==Z_FINISH$3?Z_OK$3:t.wrap<=0?Z_STREAM_END$3:(t.wrap===2?(put_byte(t,o.adler&255),put_byte(t,o.adler>>8&255),put_byte(t,o.adler>>16&255),put_byte(t,o.adler>>24&255),put_byte(t,o.total_in&255),put_byte(t,o.total_in>>8&255),put_byte(t,o.total_in>>16&255),put_byte(t,o.total_in>>24&255)):(putShortMSB(t,o.adler>>>16),putShortMSB(t,o.adler&65535)),flush_pending(o),t.wrap>0&&(t.wrap=-t.wrap),t.pending!==0?Z_OK$3:Z_STREAM_END$3)},deflateEnd=o=>{if(deflateStateCheck(o))return Z_STREAM_ERROR$2;const e=o.state.status;return o.state=null,e===BUSY_STATE?err(o,Z_DATA_ERROR$2):Z_OK$3},deflateSetDictionary=(o,e)=>{let t=e.length;if(deflateStateCheck(o))return Z_STREAM_ERROR$2;const n=o.state,r=n.wrap;if(r===2||r===1&&n.status!==INIT_STATE||n.lookahead)return Z_STREAM_ERROR$2;if(r===1&&(o.adler=adler32_1(o.adler,e,t,0)),n.wrap=0,t>=n.w_size){r===0&&(zero(n.head),n.strstart=0,n.block_start=0,n.insert=0);let d=new Uint8Array(n.w_size);d.set(e.subarray(t-n.w_size,t),0),e=d,t=n.w_size}const s=o.avail_in,a=o.next_in,l=o.input;for(o.avail_in=t,o.next_in=0,o.input=e,fill_window(n);n.lookahead>=MIN_MATCH;){let d=n.strstart,c=n.lookahead-(MIN_MATCH-1);do n.ins_h=HASH(n,n.ins_h,n.window[d+MIN_MATCH-1]),n.prev[d&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=d,d++;while(--c);n.strstart=d,n.lookahead=MIN_MATCH-1,fill_window(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=MIN_MATCH-1,n.match_available=0,o.next_in=a,o.input=l,o.avail_in=s,n.wrap=r,Z_OK$3};var deflateInit_1=deflateInit,deflateInit2_1=deflateInit2,deflateReset_1=deflateReset,deflateResetKeep_1=deflateResetKeep,deflateSetHeader_1=deflateSetHeader,deflate_2$1=deflate$2,deflateEnd_1=deflateEnd,deflateSetDictionary_1=deflateSetDictionary,deflateInfo="pako deflate (from Nodeca project)",deflate_1$2={deflateInit:deflateInit_1,deflateInit2:deflateInit2_1,deflateReset:deflateReset_1,deflateResetKeep:deflateResetKeep_1,deflateSetHeader:deflateSetHeader_1,deflate:deflate_2$1,deflateEnd:deflateEnd_1,deflateSetDictionary:deflateSetDictionary_1,deflateInfo};const _has=(o,e)=>Object.prototype.hasOwnProperty.call(o,e);var assign=function(o){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const t=e.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(const n in t)_has(t,n)&&(o[n]=t[n])}}return o},flattenChunks=o=>{let e=0;for(let n=0,r=o.length;n<r;n++)e+=o[n].length;const t=new Uint8Array(e);for(let n=0,r=0,s=o.length;n<s;n++){let a=o[n];t.set(a,r),r+=a.length}return t},common={assign,flattenChunks};let STR_APPLY_UIA_OK=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{STR_APPLY_UIA_OK=!1}const _utf8len=new Uint8Array(256);for(let o=0;o<256;o++)_utf8len[o]=o>=252?6:o>=248?5:o>=240?4:o>=224?3:o>=192?2:1;_utf8len[254]=_utf8len[254]=1;var string2buf=o=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(o);let e,t,n,r,s,a=o.length,l=0;for(r=0;r<a;r++)t=o.charCodeAt(r),(t&64512)===55296&&r+1<a&&(n=o.charCodeAt(r+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),r++)),l+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(l),s=0,r=0;s<l;r++)t=o.charCodeAt(r),(t&64512)===55296&&r+1<a&&(n=o.charCodeAt(r+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),r++)),t<128?e[s++]=t:t<2048?(e[s++]=192|t>>>6,e[s++]=128|t&63):t<65536?(e[s++]=224|t>>>12,e[s++]=128|t>>>6&63,e[s++]=128|t&63):(e[s++]=240|t>>>18,e[s++]=128|t>>>12&63,e[s++]=128|t>>>6&63,e[s++]=128|t&63);return e};const buf2binstring=(o,e)=>{if(e<65534&&o.subarray&&STR_APPLY_UIA_OK)return String.fromCharCode.apply(null,o.length===e?o:o.subarray(0,e));let t="";for(let n=0;n<e;n++)t+=String.fromCharCode(o[n]);return t};var buf2string=(o,e)=>{const t=e||o.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(o.subarray(0,e));let n,r;const s=new Array(t*2);for(r=0,n=0;n<t;){let a=o[n++];if(a<128){s[r++]=a;continue}let l=_utf8len[a];if(l>4){s[r++]=65533,n+=l-1;continue}for(a&=l===2?31:l===3?15:7;l>1&&n<t;)a=a<<6|o[n++]&63,l--;if(l>1){s[r++]=65533;continue}a<65536?s[r++]=a:(a-=65536,s[r++]=55296|a>>10&1023,s[r++]=56320|a&1023)}return buf2binstring(s,r)},utf8border=(o,e)=>{e=e||o.length,e>o.length&&(e=o.length);let t=e-1;for(;t>=0&&(o[t]&192)===128;)t--;return t<0||t===0?e:t+_utf8len[o[t]]>e?t:e},strings={string2buf,buf2string,utf8border};function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var zstream=ZStream;const toString$1=Object.prototype.toString,{Z_NO_FLUSH:Z_NO_FLUSH$1,Z_SYNC_FLUSH,Z_FULL_FLUSH,Z_FINISH:Z_FINISH$2,Z_OK:Z_OK$2,Z_STREAM_END:Z_STREAM_END$2,Z_DEFAULT_COMPRESSION,Z_DEFAULT_STRATEGY,Z_DEFLATED:Z_DEFLATED$1}=constants$2;function Deflate$1(o){this.options=common.assign({level:Z_DEFAULT_COMPRESSION,method:Z_DEFLATED$1,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY},o||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let t=deflate_1$2.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(t!==Z_OK$2)throw new Error(messages[t]);if(e.header&&deflate_1$2.deflateSetHeader(this.strm,e.header),e.dictionary){let n;if(typeof e.dictionary=="string"?n=strings.string2buf(e.dictionary):toString$1.call(e.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(e.dictionary):n=e.dictionary,t=deflate_1$2.deflateSetDictionary(this.strm,n),t!==Z_OK$2)throw new Error(messages[t]);this._dict_set=!0}}Deflate$1.prototype.push=function(o,e){const t=this.strm,n=this.options.chunkSize;let r,s;if(this.ended)return!1;for(e===~~e?s=e:s=e===!0?Z_FINISH$2:Z_NO_FLUSH$1,typeof o=="string"?t.input=strings.string2buf(o):toString$1.call(o)==="[object ArrayBuffer]"?t.input=new Uint8Array(o):t.input=o,t.next_in=0,t.avail_in=t.input.length;;){if(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),(s===Z_SYNC_FLUSH||s===Z_FULL_FLUSH)&&t.avail_out<=6){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(r=deflate_1$2.deflate(t,s),r===Z_STREAM_END$2)return t.next_out>0&&this.onData(t.output.subarray(0,t.next_out)),r=deflate_1$2.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===Z_OK$2;if(t.avail_out===0){this.onData(t.output);continue}if(s>0&&t.next_out>0){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(t.avail_in===0)break}return!0};Deflate$1.prototype.onData=function(o){this.chunks.push(o)};Deflate$1.prototype.onEnd=function(o){o===Z_OK$2&&(this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=o,this.msg=this.strm.msg};function deflate$1(o,e){const t=new Deflate$1(e);if(t.push(o,!0),t.err)throw t.msg||messages[t.err];return t.result}function deflateRaw$1(o,e){return e=e||{},e.raw=!0,deflate$1(o,e)}function gzip$1(o,e){return e=e||{},e.gzip=!0,deflate$1(o,e)}var Deflate_1$1=Deflate$1,deflate_2=deflate$1,deflateRaw_1$1=deflateRaw$1,gzip_1$1=gzip$1,constants$1=constants$2,deflate_1$1={Deflate:Deflate_1$1,deflate:deflate_2,deflateRaw:deflateRaw_1$1,gzip:gzip_1$1,constants:constants$1};const BAD$1=16209,TYPE$1=16191;var inffast=function(e,t){let n,r,s,a,l,d,c,y,m,O,D,z,w,N,H,X,ae,oe,ue,fe,be,Ae,W,J;const Ue=e.state;n=e.next_in,W=e.input,r=n+(e.avail_in-5),s=e.next_out,J=e.output,a=s-(t-e.avail_out),l=s+(e.avail_out-257),d=Ue.dmax,c=Ue.wsize,y=Ue.whave,m=Ue.wnext,O=Ue.window,D=Ue.hold,z=Ue.bits,w=Ue.lencode,N=Ue.distcode,H=(1<<Ue.lenbits)-1,X=(1<<Ue.distbits)-1;e:do{z<15&&(D+=W[n++]<<z,z+=8,D+=W[n++]<<z,z+=8),ae=w[D&H];t:for(;;){if(oe=ae>>>24,D>>>=oe,z-=oe,oe=ae>>>16&255,oe===0)J[s++]=ae&65535;else if(oe&16){ue=ae&65535,oe&=15,oe&&(z<oe&&(D+=W[n++]<<z,z+=8),ue+=D&(1<<oe)-1,D>>>=oe,z-=oe),z<15&&(D+=W[n++]<<z,z+=8,D+=W[n++]<<z,z+=8),ae=N[D&X];i:for(;;){if(oe=ae>>>24,D>>>=oe,z-=oe,oe=ae>>>16&255,oe&16){if(fe=ae&65535,oe&=15,z<oe&&(D+=W[n++]<<z,z+=8,z<oe&&(D+=W[n++]<<z,z+=8)),fe+=D&(1<<oe)-1,fe>d){e.msg="invalid distance too far back",Ue.mode=BAD$1;break e}if(D>>>=oe,z-=oe,oe=s-a,fe>oe){if(oe=fe-oe,oe>y&&Ue.sane){e.msg="invalid distance too far back",Ue.mode=BAD$1;break e}if(be=0,Ae=O,m===0){if(be+=c-oe,oe<ue){ue-=oe;do J[s++]=O[be++];while(--oe);be=s-fe,Ae=J}}else if(m<oe){if(be+=c+m-oe,oe-=m,oe<ue){ue-=oe;do J[s++]=O[be++];while(--oe);if(be=0,m<ue){oe=m,ue-=oe;do J[s++]=O[be++];while(--oe);be=s-fe,Ae=J}}}else if(be+=m-oe,oe<ue){ue-=oe;do J[s++]=O[be++];while(--oe);be=s-fe,Ae=J}for(;ue>2;)J[s++]=Ae[be++],J[s++]=Ae[be++],J[s++]=Ae[be++],ue-=3;ue&&(J[s++]=Ae[be++],ue>1&&(J[s++]=Ae[be++]))}else{be=s-fe;do J[s++]=J[be++],J[s++]=J[be++],J[s++]=J[be++],ue-=3;while(ue>2);ue&&(J[s++]=J[be++],ue>1&&(J[s++]=J[be++]))}}else if(oe&64){e.msg="invalid distance code",Ue.mode=BAD$1;break e}else{ae=N[(ae&65535)+(D&(1<<oe)-1)];continue i}break}}else if(oe&64)if(oe&32){Ue.mode=TYPE$1;break e}else{e.msg="invalid literal/length code",Ue.mode=BAD$1;break e}else{ae=w[(ae&65535)+(D&(1<<oe)-1)];continue t}break}}while(n<r&&s<l);ue=z>>3,n-=ue,z-=ue<<3,D&=(1<<z)-1,e.next_in=n,e.next_out=s,e.avail_in=n<r?5+(r-n):5-(n-r),e.avail_out=s<l?257+(l-s):257-(s-l),Ue.hold=D,Ue.bits=z};const MAXBITS=15,ENOUGH_LENS$1=852,ENOUGH_DISTS$1=592,CODES$1=0,LENS$1=1,DISTS$1=2,lbase=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),lext=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),dbase=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),dext=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),inflate_table=(o,e,t,n,r,s,a,l)=>{const d=l.bits;let c=0,y=0,m=0,O=0,D=0,z=0,w=0,N=0,H=0,X=0,ae,oe,ue,fe,be,Ae=null,W;const J=new Uint16Array(MAXBITS+1),Ue=new Uint16Array(MAXBITS+1);let gt=null,Te,Et,Bt;for(c=0;c<=MAXBITS;c++)J[c]=0;for(y=0;y<n;y++)J[e[t+y]]++;for(D=d,O=MAXBITS;O>=1&&J[O]===0;O--);if(D>O&&(D=O),O===0)return r[s++]=1<<24|64<<16|0,r[s++]=1<<24|64<<16|0,l.bits=1,0;for(m=1;m<O&&J[m]===0;m++);for(D<m&&(D=m),N=1,c=1;c<=MAXBITS;c++)if(N<<=1,N-=J[c],N<0)return-1;if(N>0&&(o===CODES$1||O!==1))return-1;for(Ue[1]=0,c=1;c<MAXBITS;c++)Ue[c+1]=Ue[c]+J[c];for(y=0;y<n;y++)e[t+y]!==0&&(a[Ue[e[t+y]]++]=y);if(o===CODES$1?(Ae=gt=a,W=20):o===LENS$1?(Ae=lbase,gt=lext,W=257):(Ae=dbase,gt=dext,W=0),X=0,y=0,c=m,be=s,z=D,w=0,ue=-1,H=1<<D,fe=H-1,o===LENS$1&&H>ENOUGH_LENS$1||o===DISTS$1&&H>ENOUGH_DISTS$1)return 1;for(;;){Te=c-w,a[y]+1<W?(Et=0,Bt=a[y]):a[y]>=W?(Et=gt[a[y]-W],Bt=Ae[a[y]-W]):(Et=96,Bt=0),ae=1<<c-w,oe=1<<z,m=oe;do oe-=ae,r[be+(X>>w)+oe]=Te<<24|Et<<16|Bt|0;while(oe!==0);for(ae=1<<c-1;X&ae;)ae>>=1;if(ae!==0?(X&=ae-1,X+=ae):X=0,y++,--J[c]===0){if(c===O)break;c=e[t+a[y]]}if(c>D&&(X&fe)!==ue){for(w===0&&(w=D),be+=m,z=c-w,N=1<<z;z+w<O&&(N-=J[z+w],!(N<=0));)z++,N<<=1;if(H+=1<<z,o===LENS$1&&H>ENOUGH_LENS$1||o===DISTS$1&&H>ENOUGH_DISTS$1)return 1;ue=X&fe,r[ue]=D<<24|z<<16|be-s|0}}return X!==0&&(r[be+X]=c-w<<24|64<<16|0),l.bits=D,0};var inftrees=inflate_table;const CODES=0,LENS=1,DISTS=2,{Z_FINISH:Z_FINISH$1,Z_BLOCK,Z_TREES,Z_OK:Z_OK$1,Z_STREAM_END:Z_STREAM_END$1,Z_NEED_DICT:Z_NEED_DICT$1,Z_STREAM_ERROR:Z_STREAM_ERROR$1,Z_DATA_ERROR:Z_DATA_ERROR$1,Z_MEM_ERROR:Z_MEM_ERROR$1,Z_BUF_ERROR,Z_DEFLATED}=constants$2,HEAD=16180,FLAGS=16181,TIME=16182,OS=16183,EXLEN=16184,EXTRA=16185,NAME=16186,COMMENT=16187,HCRC=16188,DICTID=16189,DICT=16190,TYPE=16191,TYPEDO=16192,STORED=16193,COPY_=16194,COPY=16195,TABLE=16196,LENLENS=16197,CODELENS=16198,LEN_=16199,LEN=16200,LENEXT=16201,DIST=16202,DISTEXT=16203,MATCH=16204,LIT=16205,CHECK=16206,LENGTH=16207,DONE=16208,BAD=16209,MEM=16210,SYNC=16211,ENOUGH_LENS=852,ENOUGH_DISTS=592,MAX_WBITS=15,DEF_WBITS=MAX_WBITS,zswap32=o=>(o>>>24&255)+(o>>>8&65280)+((o&65280)<<8)+((o&255)<<24);function InflateState(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const inflateStateCheck=o=>{if(!o)return 1;const e=o.state;return!e||e.strm!==o||e.mode<HEAD||e.mode>SYNC?1:0},inflateResetKeep=o=>{if(inflateStateCheck(o))return Z_STREAM_ERROR$1;const e=o.state;return o.total_in=o.total_out=e.total=0,o.msg="",e.wrap&&(o.adler=e.wrap&1),e.mode=HEAD,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(ENOUGH_LENS),e.distcode=e.distdyn=new Int32Array(ENOUGH_DISTS),e.sane=1,e.back=-1,Z_OK$1},inflateReset=o=>{if(inflateStateCheck(o))return Z_STREAM_ERROR$1;const e=o.state;return e.wsize=0,e.whave=0,e.wnext=0,inflateResetKeep(o)},inflateReset2=(o,e)=>{let t;if(inflateStateCheck(o))return Z_STREAM_ERROR$1;const n=o.state;return e<0?(t=0,e=-e):(t=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?Z_STREAM_ERROR$1:(n.window!==null&&n.wbits!==e&&(n.window=null),n.wrap=t,n.wbits=e,inflateReset(o))},inflateInit2=(o,e)=>{if(!o)return Z_STREAM_ERROR$1;const t=new InflateState;o.state=t,t.strm=o,t.window=null,t.mode=HEAD;const n=inflateReset2(o,e);return n!==Z_OK$1&&(o.state=null),n},inflateInit=o=>inflateInit2(o,DEF_WBITS);let virgin=!0,lenfix,distfix;const fixedtables=o=>{if(virgin){lenfix=new Int32Array(512),distfix=new Int32Array(32);let e=0;for(;e<144;)o.lens[e++]=8;for(;e<256;)o.lens[e++]=9;for(;e<280;)o.lens[e++]=7;for(;e<288;)o.lens[e++]=8;for(inftrees(LENS,o.lens,0,288,lenfix,0,o.work,{bits:9}),e=0;e<32;)o.lens[e++]=5;inftrees(DISTS,o.lens,0,32,distfix,0,o.work,{bits:5}),virgin=!1}o.lencode=lenfix,o.lenbits=9,o.distcode=distfix,o.distbits=5},updatewindow=(o,e,t,n)=>{let r;const s=o.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),n>=s.wsize?(s.window.set(e.subarray(t-s.wsize,t),0),s.wnext=0,s.whave=s.wsize):(r=s.wsize-s.wnext,r>n&&(r=n),s.window.set(e.subarray(t-n,t-n+r),s.wnext),n-=r,n?(s.window.set(e.subarray(t-n,t),0),s.wnext=n,s.whave=s.wsize):(s.wnext+=r,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=r))),0},inflate$2=(o,e)=>{let t,n,r,s,a,l,d,c,y,m,O,D,z,w,N=0,H,X,ae,oe,ue,fe,be,Ae;const W=new Uint8Array(4);let J,Ue;const gt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(inflateStateCheck(o)||!o.output||!o.input&&o.avail_in!==0)return Z_STREAM_ERROR$1;t=o.state,t.mode===TYPE&&(t.mode=TYPEDO),a=o.next_out,r=o.output,d=o.avail_out,s=o.next_in,n=o.input,l=o.avail_in,c=t.hold,y=t.bits,m=l,O=d,Ae=Z_OK$1;e:for(;;)switch(t.mode){case HEAD:if(t.wrap===0){t.mode=TYPEDO;break}for(;y<16;){if(l===0)break e;l--,c+=n[s++]<<y,y+=8}if(t.wrap&2&&c===35615){t.wbits===0&&(t.wbits=15),t.check=0,W[0]=c&255,W[1]=c>>>8&255,t.check=crc32_1(t.check,W,2,0),c=0,y=0,t.mode=FLAGS;break}if(t.head&&(t.head.done=!1),!(t.wrap&1)||(((c&255)<<8)+(c>>8))%31){o.msg="incorrect header check",t.mode=BAD;break}if((c&15)!==Z_DEFLATED){o.msg="unknown compression method",t.mode=BAD;break}if(c>>>=4,y-=4,be=(c&15)+8,t.wbits===0&&(t.wbits=be),be>15||be>t.wbits){o.msg="invalid window size",t.mode=BAD;break}t.dmax=1<<t.wbits,t.flags=0,o.adler=t.check=1,t.mode=c&512?DICTID:TYPE,c=0,y=0;break;case FLAGS:for(;y<16;){if(l===0)break e;l--,c+=n[s++]<<y,y+=8}if(t.flags=c,(t.flags&255)!==Z_DEFLATED){o.msg="unknown compression method",t.mode=BAD;break}if(t.flags&57344){o.msg="unknown header flags set",t.mode=BAD;break}t.head&&(t.head.text=c>>8&1),t.flags&512&&t.wrap&4&&(W[0]=c&255,W[1]=c>>>8&255,t.check=crc32_1(t.check,W,2,0)),c=0,y=0,t.mode=TIME;case TIME:for(;y<32;){if(l===0)break e;l--,c+=n[s++]<<y,y+=8}t.head&&(t.head.time=c),t.flags&512&&t.wrap&4&&(W[0]=c&255,W[1]=c>>>8&255,W[2]=c>>>16&255,W[3]=c>>>24&255,t.check=crc32_1(t.check,W,4,0)),c=0,y=0,t.mode=OS;case OS:for(;y<16;){if(l===0)break e;l--,c+=n[s++]<<y,y+=8}t.head&&(t.head.xflags=c&255,t.head.os=c>>8),t.flags&512&&t.wrap&4&&(W[0]=c&255,W[1]=c>>>8&255,t.check=crc32_1(t.check,W,2,0)),c=0,y=0,t.mode=EXLEN;case EXLEN:if(t.flags&1024){for(;y<16;){if(l===0)break e;l--,c+=n[s++]<<y,y+=8}t.length=c,t.head&&(t.head.extra_len=c),t.flags&512&&t.wrap&4&&(W[0]=c&255,W[1]=c>>>8&255,t.check=crc32_1(t.check,W,2,0)),c=0,y=0}else t.head&&(t.head.extra=null);t.mode=EXTRA;case EXTRA:if(t.flags&1024&&(D=t.length,D>l&&(D=l),D&&(t.head&&(be=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(n.subarray(s,s+D),be)),t.flags&512&&t.wrap&4&&(t.check=crc32_1(t.check,n,D,s)),l-=D,s+=D,t.length-=D),t.length))break e;t.length=0,t.mode=NAME;case NAME:if(t.flags&2048){if(l===0)break e;D=0;do be=n[s+D++],t.head&&be&&t.length<65536&&(t.head.name+=String.fromCharCode(be));while(be&&D<l);if(t.flags&512&&t.wrap&4&&(t.check=crc32_1(t.check,n,D,s)),l-=D,s+=D,be)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=COMMENT;case COMMENT:if(t.flags&4096){if(l===0)break e;D=0;do be=n[s+D++],t.head&&be&&t.length<65536&&(t.head.comment+=String.fromCharCode(be));while(be&&D<l);if(t.flags&512&&t.wrap&4&&(t.check=crc32_1(t.check,n,D,s)),l-=D,s+=D,be)break e}else t.head&&(t.head.comment=null);t.mode=HCRC;case HCRC:if(t.flags&512){for(;y<16;){if(l===0)break e;l--,c+=n[s++]<<y,y+=8}if(t.wrap&4&&c!==(t.check&65535)){o.msg="header crc mismatch",t.mode=BAD;break}c=0,y=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),o.adler=t.check=0,t.mode=TYPE;break;case DICTID:for(;y<32;){if(l===0)break e;l--,c+=n[s++]<<y,y+=8}o.adler=t.check=zswap32(c),c=0,y=0,t.mode=DICT;case DICT:if(t.havedict===0)return o.next_out=a,o.avail_out=d,o.next_in=s,o.avail_in=l,t.hold=c,t.bits=y,Z_NEED_DICT$1;o.adler=t.check=1,t.mode=TYPE;case TYPE:if(e===Z_BLOCK||e===Z_TREES)break e;case TYPEDO:if(t.last){c>>>=y&7,y-=y&7,t.mode=CHECK;break}for(;y<3;){if(l===0)break e;l--,c+=n[s++]<<y,y+=8}switch(t.last=c&1,c>>>=1,y-=1,c&3){case 0:t.mode=STORED;break;case 1:if(fixedtables(t),t.mode=LEN_,e===Z_TREES){c>>>=2,y-=2;break e}break;case 2:t.mode=TABLE;break;case 3:o.msg="invalid block type",t.mode=BAD}c>>>=2,y-=2;break;case STORED:for(c>>>=y&7,y-=y&7;y<32;){if(l===0)break e;l--,c+=n[s++]<<y,y+=8}if((c&65535)!==(c>>>16^65535)){o.msg="invalid stored block lengths",t.mode=BAD;break}if(t.length=c&65535,c=0,y=0,t.mode=COPY_,e===Z_TREES)break e;case COPY_:t.mode=COPY;case COPY:if(D=t.length,D){if(D>l&&(D=l),D>d&&(D=d),D===0)break e;r.set(n.subarray(s,s+D),a),l-=D,s+=D,d-=D,a+=D,t.length-=D;break}t.mode=TYPE;break;case TABLE:for(;y<14;){if(l===0)break e;l--,c+=n[s++]<<y,y+=8}if(t.nlen=(c&31)+257,c>>>=5,y-=5,t.ndist=(c&31)+1,c>>>=5,y-=5,t.ncode=(c&15)+4,c>>>=4,y-=4,t.nlen>286||t.ndist>30){o.msg="too many length or distance symbols",t.mode=BAD;break}t.have=0,t.mode=LENLENS;case LENLENS:for(;t.have<t.ncode;){for(;y<3;){if(l===0)break e;l--,c+=n[s++]<<y,y+=8}t.lens[gt[t.have++]]=c&7,c>>>=3,y-=3}for(;t.have<19;)t.lens[gt[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,J={bits:t.lenbits},Ae=inftrees(CODES,t.lens,0,19,t.lencode,0,t.work,J),t.lenbits=J.bits,Ae){o.msg="invalid code lengths set",t.mode=BAD;break}t.have=0,t.mode=CODELENS;case CODELENS:for(;t.have<t.nlen+t.ndist;){for(;N=t.lencode[c&(1<<t.lenbits)-1],H=N>>>24,X=N>>>16&255,ae=N&65535,!(H<=y);){if(l===0)break e;l--,c+=n[s++]<<y,y+=8}if(ae<16)c>>>=H,y-=H,t.lens[t.have++]=ae;else{if(ae===16){for(Ue=H+2;y<Ue;){if(l===0)break e;l--,c+=n[s++]<<y,y+=8}if(c>>>=H,y-=H,t.have===0){o.msg="invalid bit length repeat",t.mode=BAD;break}be=t.lens[t.have-1],D=3+(c&3),c>>>=2,y-=2}else if(ae===17){for(Ue=H+3;y<Ue;){if(l===0)break e;l--,c+=n[s++]<<y,y+=8}c>>>=H,y-=H,be=0,D=3+(c&7),c>>>=3,y-=3}else{for(Ue=H+7;y<Ue;){if(l===0)break e;l--,c+=n[s++]<<y,y+=8}c>>>=H,y-=H,be=0,D=11+(c&127),c>>>=7,y-=7}if(t.have+D>t.nlen+t.ndist){o.msg="invalid bit length repeat",t.mode=BAD;break}for(;D--;)t.lens[t.have++]=be}}if(t.mode===BAD)break;if(t.lens[256]===0){o.msg="invalid code -- missing end-of-block",t.mode=BAD;break}if(t.lenbits=9,J={bits:t.lenbits},Ae=inftrees(LENS,t.lens,0,t.nlen,t.lencode,0,t.work,J),t.lenbits=J.bits,Ae){o.msg="invalid literal/lengths set",t.mode=BAD;break}if(t.distbits=6,t.distcode=t.distdyn,J={bits:t.distbits},Ae=inftrees(DISTS,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,J),t.distbits=J.bits,Ae){o.msg="invalid distances set",t.mode=BAD;break}if(t.mode=LEN_,e===Z_TREES)break e;case LEN_:t.mode=LEN;case LEN:if(l>=6&&d>=258){o.next_out=a,o.avail_out=d,o.next_in=s,o.avail_in=l,t.hold=c,t.bits=y,inffast(o,O),a=o.next_out,r=o.output,d=o.avail_out,s=o.next_in,n=o.input,l=o.avail_in,c=t.hold,y=t.bits,t.mode===TYPE&&(t.back=-1);break}for(t.back=0;N=t.lencode[c&(1<<t.lenbits)-1],H=N>>>24,X=N>>>16&255,ae=N&65535,!(H<=y);){if(l===0)break e;l--,c+=n[s++]<<y,y+=8}if(X&&!(X&240)){for(oe=H,ue=X,fe=ae;N=t.lencode[fe+((c&(1<<oe+ue)-1)>>oe)],H=N>>>24,X=N>>>16&255,ae=N&65535,!(oe+H<=y);){if(l===0)break e;l--,c+=n[s++]<<y,y+=8}c>>>=oe,y-=oe,t.back+=oe}if(c>>>=H,y-=H,t.back+=H,t.length=ae,X===0){t.mode=LIT;break}if(X&32){t.back=-1,t.mode=TYPE;break}if(X&64){o.msg="invalid literal/length code",t.mode=BAD;break}t.extra=X&15,t.mode=LENEXT;case LENEXT:if(t.extra){for(Ue=t.extra;y<Ue;){if(l===0)break e;l--,c+=n[s++]<<y,y+=8}t.length+=c&(1<<t.extra)-1,c>>>=t.extra,y-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=DIST;case DIST:for(;N=t.distcode[c&(1<<t.distbits)-1],H=N>>>24,X=N>>>16&255,ae=N&65535,!(H<=y);){if(l===0)break e;l--,c+=n[s++]<<y,y+=8}if(!(X&240)){for(oe=H,ue=X,fe=ae;N=t.distcode[fe+((c&(1<<oe+ue)-1)>>oe)],H=N>>>24,X=N>>>16&255,ae=N&65535,!(oe+H<=y);){if(l===0)break e;l--,c+=n[s++]<<y,y+=8}c>>>=oe,y-=oe,t.back+=oe}if(c>>>=H,y-=H,t.back+=H,X&64){o.msg="invalid distance code",t.mode=BAD;break}t.offset=ae,t.extra=X&15,t.mode=DISTEXT;case DISTEXT:if(t.extra){for(Ue=t.extra;y<Ue;){if(l===0)break e;l--,c+=n[s++]<<y,y+=8}t.offset+=c&(1<<t.extra)-1,c>>>=t.extra,y-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){o.msg="invalid distance too far back",t.mode=BAD;break}t.mode=MATCH;case MATCH:if(d===0)break e;if(D=O-d,t.offset>D){if(D=t.offset-D,D>t.whave&&t.sane){o.msg="invalid distance too far back",t.mode=BAD;break}D>t.wnext?(D-=t.wnext,z=t.wsize-D):z=t.wnext-D,D>t.length&&(D=t.length),w=t.window}else w=r,z=a-t.offset,D=t.length;D>d&&(D=d),d-=D,t.length-=D;do r[a++]=w[z++];while(--D);t.length===0&&(t.mode=LEN);break;case LIT:if(d===0)break e;r[a++]=t.length,d--,t.mode=LEN;break;case CHECK:if(t.wrap){for(;y<32;){if(l===0)break e;l--,c|=n[s++]<<y,y+=8}if(O-=d,o.total_out+=O,t.total+=O,t.wrap&4&&O&&(o.adler=t.check=t.flags?crc32_1(t.check,r,O,a-O):adler32_1(t.check,r,O,a-O)),O=d,t.wrap&4&&(t.flags?c:zswap32(c))!==t.check){o.msg="incorrect data check",t.mode=BAD;break}c=0,y=0}t.mode=LENGTH;case LENGTH:if(t.wrap&&t.flags){for(;y<32;){if(l===0)break e;l--,c+=n[s++]<<y,y+=8}if(t.wrap&4&&c!==(t.total&4294967295)){o.msg="incorrect length check",t.mode=BAD;break}c=0,y=0}t.mode=DONE;case DONE:Ae=Z_STREAM_END$1;break e;case BAD:Ae=Z_DATA_ERROR$1;break e;case MEM:return Z_MEM_ERROR$1;case SYNC:default:return Z_STREAM_ERROR$1}return o.next_out=a,o.avail_out=d,o.next_in=s,o.avail_in=l,t.hold=c,t.bits=y,(t.wsize||O!==o.avail_out&&t.mode<BAD&&(t.mode<CHECK||e!==Z_FINISH$1))&&updatewindow(o,o.output,o.next_out,O-o.avail_out),m-=o.avail_in,O-=o.avail_out,o.total_in+=m,o.total_out+=O,t.total+=O,t.wrap&4&&O&&(o.adler=t.check=t.flags?crc32_1(t.check,r,O,o.next_out-O):adler32_1(t.check,r,O,o.next_out-O)),o.data_type=t.bits+(t.last?64:0)+(t.mode===TYPE?128:0)+(t.mode===LEN_||t.mode===COPY_?256:0),(m===0&&O===0||e===Z_FINISH$1)&&Ae===Z_OK$1&&(Ae=Z_BUF_ERROR),Ae},inflateEnd=o=>{if(inflateStateCheck(o))return Z_STREAM_ERROR$1;let e=o.state;return e.window&&(e.window=null),o.state=null,Z_OK$1},inflateGetHeader=(o,e)=>{if(inflateStateCheck(o))return Z_STREAM_ERROR$1;const t=o.state;return t.wrap&2?(t.head=e,e.done=!1,Z_OK$1):Z_STREAM_ERROR$1},inflateSetDictionary=(o,e)=>{const t=e.length;let n,r,s;return inflateStateCheck(o)||(n=o.state,n.wrap!==0&&n.mode!==DICT)?Z_STREAM_ERROR$1:n.mode===DICT&&(r=1,r=adler32_1(r,e,t,0),r!==n.check)?Z_DATA_ERROR$1:(s=updatewindow(o,e,t,t),s?(n.mode=MEM,Z_MEM_ERROR$1):(n.havedict=1,Z_OK$1))};var inflateReset_1=inflateReset,inflateReset2_1=inflateReset2,inflateResetKeep_1=inflateResetKeep,inflateInit_1=inflateInit,inflateInit2_1=inflateInit2,inflate_2$1=inflate$2,inflateEnd_1=inflateEnd,inflateGetHeader_1=inflateGetHeader,inflateSetDictionary_1=inflateSetDictionary,inflateInfo="pako inflate (from Nodeca project)",inflate_1$2={inflateReset:inflateReset_1,inflateReset2:inflateReset2_1,inflateResetKeep:inflateResetKeep_1,inflateInit:inflateInit_1,inflateInit2:inflateInit2_1,inflate:inflate_2$1,inflateEnd:inflateEnd_1,inflateGetHeader:inflateGetHeader_1,inflateSetDictionary:inflateSetDictionary_1,inflateInfo};function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var gzheader=GZheader;const toString=Object.prototype.toString,{Z_NO_FLUSH,Z_FINISH,Z_OK,Z_STREAM_END,Z_NEED_DICT,Z_STREAM_ERROR,Z_DATA_ERROR,Z_MEM_ERROR}=constants$2;function Inflate$1(o){this.options=common.assign({chunkSize:1024*64,windowBits:15,to:""},o||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(o&&o.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let t=inflate_1$2.inflateInit2(this.strm,e.windowBits);if(t!==Z_OK)throw new Error(messages[t]);if(this.header=new gzheader,inflate_1$2.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=strings.string2buf(e.dictionary):toString.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=inflate_1$2.inflateSetDictionary(this.strm,e.dictionary),t!==Z_OK)))throw new Error(messages[t])}Inflate$1.prototype.push=function(o,e){const t=this.strm,n=this.options.chunkSize,r=this.options.dictionary;let s,a,l;if(this.ended)return!1;for(e===~~e?a=e:a=e===!0?Z_FINISH:Z_NO_FLUSH,toString.call(o)==="[object ArrayBuffer]"?t.input=new Uint8Array(o):t.input=o,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),s=inflate_1$2.inflate(t,a),s===Z_NEED_DICT&&r&&(s=inflate_1$2.inflateSetDictionary(t,r),s===Z_OK?s=inflate_1$2.inflate(t,a):s===Z_DATA_ERROR&&(s=Z_NEED_DICT));t.avail_in>0&&s===Z_STREAM_END&&t.state.wrap>0&&o[t.next_in]!==0;)inflate_1$2.inflateReset(t),s=inflate_1$2.inflate(t,a);switch(s){case Z_STREAM_ERROR:case Z_DATA_ERROR:case Z_NEED_DICT:case Z_MEM_ERROR:return this.onEnd(s),this.ended=!0,!1}if(l=t.avail_out,t.next_out&&(t.avail_out===0||s===Z_STREAM_END))if(this.options.to==="string"){let d=strings.utf8border(t.output,t.next_out),c=t.next_out-d,y=strings.buf2string(t.output,d);t.next_out=c,t.avail_out=n-c,c&&t.output.set(t.output.subarray(d,d+c),0),this.onData(y)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(s===Z_OK&&l===0)){if(s===Z_STREAM_END)return s=inflate_1$2.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(t.avail_in===0)break}}return!0};Inflate$1.prototype.onData=function(o){this.chunks.push(o)};Inflate$1.prototype.onEnd=function(o){o===Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=o,this.msg=this.strm.msg};function inflate$1(o,e){const t=new Inflate$1(e);if(t.push(o),t.err)throw t.msg||messages[t.err];return t.result}function inflateRaw$1(o,e){return e=e||{},e.raw=!0,inflate$1(o,e)}var Inflate_1$1=Inflate$1,inflate_2=inflate$1,inflateRaw_1$1=inflateRaw$1,ungzip$1=inflate$1,constants=constants$2,inflate_1$1={Inflate:Inflate_1$1,inflate:inflate_2,inflateRaw:inflateRaw_1$1,ungzip:ungzip$1,constants};const{Deflate,deflate,deflateRaw,gzip}=deflate_1$1,{Inflate,inflate,inflateRaw,ungzip}=inflate_1$1;var Deflate_1=Deflate,deflate_1=deflate,deflateRaw_1=deflateRaw,gzip_1=gzip,Inflate_1=Inflate,inflate_1=inflate,inflateRaw_1=inflateRaw,ungzip_1=ungzip,constants_1=constants$2,pako={Deflate:Deflate_1,deflate:deflate_1,deflateRaw:deflateRaw_1,gzip:gzip_1,Inflate:Inflate_1,inflate:inflate_1,inflateRaw:inflateRaw_1,ungzip:ungzip_1,constants:constants_1};const compressString=o=>{const e=new Uint8Array(o.split("").map(n=>n.charCodeAt(0))),t=pako.deflate(e);return btoa(String.fromCharCode.apply(null,[...t]))},decompressString=o=>{try{const e=new Uint8Array(atob(o).split("").map(n=>n.charCodeAt(0))),t=pako.inflate(e);return String.fromCharCode.apply(null,[...t])}catch{return null}},toPropertyPuzzle=o=>({board:o.board,stateProperty:new Property(o.state)}),serializePuzzle=o=>({version:1,board:serializeBoard(o.board),state:o.stateProperty.value.serializeState(o.board)}),deserializePuzzle=o=>{if(o.version!==1)throw new Error(`Unsupported puzzle version: ${o.version}`);const e=deserializeBoard(o.board),t=deserializeState(e,o.state);return new BasicPuzzle(e,t)},puzzleToCompressedString=o=>{const e=serializePuzzle(o);return compressString(JSON.stringify(e))},puzzleFromCompressedString=o=>{try{const e=JSON.parse(decompressString(o));return deserializePuzzle(e)}catch(e){return console.error(e),null}};var C_MINISAT;C_MINISAT=function(){var module={},require=function(){},process={argv:["node","minisat"],on:function(){},stdout:{write:function(o){console.log("MINISAT-out:",o.replace(/\n$/,""))}},stderr:{write:function(o){console.log("MINISAT-err:",o.replace(/\n$/,""))}}},Module;Module||(Module=(typeof Module<"u"?Module:null)||{});var moduleOverrides={};for(var key in Module)Module.hasOwnProperty(key)&&(moduleOverrides[key]=Module[key]);var ENVIRONMENT_IS_NODE=typeof process=="object"&&typeof require=="function",ENVIRONMENT_IS_WORKER=typeof importScripts=="function",ENVIRONMENT_IS_SHELL=!ENVIRONMENT_IS_NODE&&!ENVIRONMENT_IS_WORKER;if(ENVIRONMENT_IS_NODE){Module.print||(Module.print=function(e){process.stdout.write(e+`
`)}),Module.printErr||(Module.printErr=function(e){process.stderr.write(e+`
`)});var nodeFS=require(),nodePath=require();Module.read=function(e,t){e=nodePath.normalize(e);var n=nodeFS.readFileSync(e);return!n&&e!=nodePath.resolve(e)&&(e=path.join(__dirname,"..","src",e),n=nodeFS.readFileSync(e)),n&&!t&&(n=n.toString()),n},Module.readBinary=function(e){return Module.read(e,!0)},Module.load=function(e){globalEval(read(e))},process.argv.length>1?Module.thisProgram=process.argv[1].replace(/\\/g,"/"):Module.thisProgram="unknown-program",Module.arguments=process.argv.slice(2),typeof module<"u"&&(module.exports=Module),process.on("uncaughtException",function(o){if(!(o instanceof ExitStatus))throw o})}else if(ENVIRONMENT_IS_SHELL)Module.print||(Module.print=print),typeof printErr<"u"&&(Module.printErr=printErr),typeof read<"u"?Module.read=read:Module.read=function(){throw"no read() available (jsc?)"},Module.readBinary=function(e){if(typeof readbuffer=="function")return new Uint8Array(readbuffer(e));var t=read(e,"binary");return assert(typeof t=="object"),t},typeof scriptArgs<"u"?Module.arguments=scriptArgs:typeof arguments<"u"&&(Module.arguments=arguments),this.Module=Module;else if(ENVIRONMENT_IS_WORKER){if(Module.read=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},typeof arguments<"u"&&(Module.arguments=arguments),typeof console<"u")Module.print||(Module.print=function(e){console.log(e)}),Module.printErr||(Module.printErr=function(e){console.log(e)});else{var TRY_USE_DUMP=!1;Module.print||(Module.print=TRY_USE_DUMP&&typeof dump<"u"?function(o){dump(o)}:function(o){})}Module.load=importScripts}else throw"Unknown runtime environment. Where are we?";function globalEval(o){eval.call(null,o)}!Module.load&&Module.read&&(Module.load=function(e){globalEval(Module.read(e))}),Module.print||(Module.print=function(){}),Module.printErr||(Module.printErr=Module.print),Module.arguments||(Module.arguments=[]),Module.thisProgram||(Module.thisProgram="./this.program"),Module.print=Module.print,Module.printErr=Module.printErr,Module.preRun=[],Module.postRun=[];for(var key in moduleOverrides)moduleOverrides.hasOwnProperty(key)&&(Module[key]=moduleOverrides[key]);var Runtime={setTempRet0:function(o){tempRet0=o},getTempRet0:function(){return tempRet0},stackSave:function(){return STACKTOP},stackRestore:function(o){STACKTOP=o},getNativeTypeSize:function(o){switch(o){case"i1":case"i8":return 1;case"i16":return 2;case"i32":return 4;case"i64":return 8;case"float":return 4;case"double":return 8;default:{if(o[o.length-1]==="*")return Runtime.QUANTUM_SIZE;if(o[0]==="i"){var e=parseInt(o.substr(1));return assert(e%8===0),e/8}else return 0}}},getNativeFieldSize:function(o){return Math.max(Runtime.getNativeTypeSize(o),Runtime.QUANTUM_SIZE)},STACK_ALIGN:16,getAlignSize:function(o,e,t){return!t&&(o=="i64"||o=="double")?8:o?Math.min(e||(o?Runtime.getNativeFieldSize(o):0),Runtime.QUANTUM_SIZE):Math.min(e,8)},dynCall:function(o,e,t){return t&&t.length?(t.splice||(t=Array.prototype.slice.call(t)),t.splice(0,0,e),Module["dynCall_"+o].apply(null,t)):Module["dynCall_"+o].call(null,e)},functionPointers:[],addFunction:function(o){for(var e=0;e<Runtime.functionPointers.length;e++)if(!Runtime.functionPointers[e])return Runtime.functionPointers[e]=o,2*(1+e);throw"Finished up all reserved function pointers. Use a higher value for RESERVED_FUNCTION_POINTERS."},removeFunction:function(o){Runtime.functionPointers[(o-2)/2]=null},getAsmConst:function(code,numArgs){Runtime.asmConstCache||(Runtime.asmConstCache={});var func=Runtime.asmConstCache[code];if(func)return func;for(var args=[],i=0;i<numArgs;i++)args.push("$"+i);var source=Pointer_stringify(code);source[0]==='"'&&(source.indexOf('"',1)===source.length-1?source=source.substr(1,source.length-2):abort("invalid EM_ASM input |"+source+"|. Please use EM_ASM(..code..) (no quotes) or EM_ASM({ ..code($0).. }, input) (to input values)"));try{var evalled=eval("(function(Module, FS) { return function("+args.join(",")+"){ "+source+" } })")(Module,typeof FS<"u"?FS:null)}catch(o){throw Module.printErr("error in executing inline EM_ASM code: "+o+` on: 

`+source+`

with args |`+args+"| (make sure to use the right one out of EM_ASM, EM_ASM_ARGS, etc.)"),o}return Runtime.asmConstCache[code]=evalled},warnOnce:function(o){Runtime.warnOnce.shown||(Runtime.warnOnce.shown={}),Runtime.warnOnce.shown[o]||(Runtime.warnOnce.shown[o]=1,Module.printErr(o))},funcWrappers:{},getFuncWrapper:function(o,e){assert(e),Runtime.funcWrappers[e]||(Runtime.funcWrappers[e]={});var t=Runtime.funcWrappers[e];return t[o]||(t[o]=function(){return Runtime.dynCall(e,o,arguments)}),t[o]},UTF8Processor:function(){var o=[],e=0;this.processCChar=function(t){if(t=t&255,o.length==0)return t&128?(o.push(t),(t&224)==192?e=1:(t&240)==224?e=2:e=3,""):String.fromCharCode(t);if(e&&(o.push(t),e--,e>0))return"";var n=o[0],r=o[1],s=o[2],a=o[3],l;if(o.length==2)l=String.fromCharCode((n&31)<<6|r&63);else if(o.length==3)l=String.fromCharCode((n&15)<<12|(r&63)<<6|s&63);else{var d=(n&7)<<18|(r&63)<<12|(s&63)<<6|a&63;l=String.fromCharCode(((d-65536)/1024|0)+55296,(d-65536)%1024+56320)}return o.length=0,l},this.processJSString=function(n){n=unescape(encodeURIComponent(n));for(var r=[],s=0;s<n.length;s++)r.push(n.charCodeAt(s));return r}},getCompilerSetting:function(o){throw"You must build with -s RETAIN_COMPILER_SETTINGS=1 for Runtime.getCompilerSetting or emscripten_get_compiler_setting to work"},stackAlloc:function(o){var e=STACKTOP;return STACKTOP=STACKTOP+o|0,STACKTOP=STACKTOP+15&-16,e},staticAlloc:function(o){var e=STATICTOP;return STATICTOP=STATICTOP+o|0,STATICTOP=STATICTOP+15&-16,e},dynamicAlloc:function(o){var e=DYNAMICTOP;return DYNAMICTOP=DYNAMICTOP+o|0,DYNAMICTOP=DYNAMICTOP+15&-16,DYNAMICTOP>=TOTAL_MEMORY&&enlargeMemory(),e},alignMemory:function(o,e){var t=o=Math.ceil(o/(e||16))*(e||16);return t},makeBigInt:function(o,e,t){var n=t?+(o>>>0)+ +(e>>>0)*4294967296:+(o>>>0)+ +(e|0)*4294967296;return n},GLOBAL_BASE:8,QUANTUM_SIZE:4,__dummy__:0};Module.Runtime=Runtime;var ABORT=!1,tempDouble,tempI64,tempRet0;function assert(o,e){o||abort("Assertion failed: "+e)}function getCFunc(ident){var func=Module["_"+ident];if(!func)try{func=eval("_"+ident)}catch(o){}return assert(func,"Cannot call unknown function "+ident+" (perhaps LLVM optimizations or closure removed it?)"),func}var cwrap,ccall;(function(){var JSfuncs={stackSave:function(){Runtime.stackSave()},stackRestore:function(){Runtime.stackRestore()},arrayToC:function(o){var e=Runtime.stackAlloc(o.length);return writeArrayToMemory(o,e),e},stringToC:function(o){var e=0;return o!=null&&o!==0&&(e=Runtime.stackAlloc((o.length<<2)+1),writeStringToMemory(o,e)),e}},toC={string:JSfuncs.stringToC,array:JSfuncs.arrayToC};ccall=function(e,t,n,r){var s=getCFunc(e),a=[],l=0;if(r)for(var d=0;d<r.length;d++){var c=toC[n[d]];c?(l===0&&(l=Runtime.stackSave()),a[d]=c(r[d])):a[d]=r[d]}var y=s.apply(null,a);return t==="string"&&(y=Pointer_stringify(y)),l!==0&&Runtime.stackRestore(l),y};var sourceRegex=/^function\s*\(([^)]*)\)\s*{\s*([^*]*?)[\s;]*(?:return\s*(.*?)[;\s]*)?}$/;function parseJSFunc(o){var e=o.toString().match(sourceRegex).slice(1);return{arguments:e[0],body:e[1],returnValue:e[2]}}var JSsource={};for(var fun in JSfuncs)JSfuncs.hasOwnProperty(fun)&&(JSsource[fun]=parseJSFunc(JSfuncs[fun]));cwrap=function cwrap(ident,returnType,argTypes){argTypes=argTypes||[];var cfunc=getCFunc(ident),numericArgs=argTypes.every(function(o){return o==="number"}),numericRet=returnType!=="string";if(numericRet&&numericArgs)return cfunc;var argNames=argTypes.map(function(o,e){return"$"+e}),funcstr="(function("+argNames.join(",")+") {",nargs=argTypes.length;if(!numericArgs){funcstr+="var stack = "+JSsource.stackSave.body+";";for(var i=0;i<nargs;i++){var arg=argNames[i],type=argTypes[i];if(type!=="number"){var convertCode=JSsource[type+"ToC"];funcstr+="var "+convertCode.arguments+" = "+arg+";",funcstr+=convertCode.body+";",funcstr+=arg+"="+convertCode.returnValue+";"}}}var cfuncname=parseJSFunc(function(){return cfunc}).returnValue;if(funcstr+="var ret = "+cfuncname+"("+argNames.join(",")+");",!numericRet){var strgfy=parseJSFunc(function(){return Pointer_stringify}).returnValue;funcstr+="ret = "+strgfy+"(ret);"}return numericArgs||(funcstr+=JSsource.stackRestore.body.replace("()","(stack)")+";"),funcstr+="return ret})",eval(funcstr)}})(),Module.cwrap=cwrap,Module.ccall=ccall;function setValue(o,e,t,n){switch(t=t||"i8",t.charAt(t.length-1)==="*"&&(t="i32"),t){case"i1":HEAP8[o>>0]=e;break;case"i8":HEAP8[o>>0]=e;break;case"i16":HEAP16[o>>1]=e;break;case"i32":HEAP32[o>>2]=e;break;case"i64":tempI64=[e>>>0,(tempDouble=e,+Math_abs(tempDouble)>=1?tempDouble>0?(Math_min(+Math_floor(tempDouble/4294967296),4294967295)|0)>>>0:~~+Math_ceil((tempDouble-+(~~tempDouble>>>0))/4294967296)>>>0:0)],HEAP32[o>>2]=tempI64[0],HEAP32[o+4>>2]=tempI64[1];break;case"float":HEAPF32[o>>2]=e;break;case"double":HEAPF64[o>>3]=e;break;default:abort("invalid type for setValue: "+t)}}Module.setValue=setValue;function getValue(o,e,t){switch(e=e||"i8",e.charAt(e.length-1)==="*"&&(e="i32"),e){case"i1":return HEAP8[o>>0];case"i8":return HEAP8[o>>0];case"i16":return HEAP16[o>>1];case"i32":return HEAP32[o>>2];case"i64":return HEAP32[o>>2];case"float":return HEAPF32[o>>2];case"double":return HEAPF64[o>>3];default:abort("invalid type for setValue: "+e)}return null}Module.getValue=getValue;var ALLOC_NORMAL=0,ALLOC_STACK=1,ALLOC_STATIC=2,ALLOC_DYNAMIC=3,ALLOC_NONE=4;Module.ALLOC_NORMAL=ALLOC_NORMAL,Module.ALLOC_STACK=ALLOC_STACK,Module.ALLOC_STATIC=ALLOC_STATIC,Module.ALLOC_DYNAMIC=ALLOC_DYNAMIC,Module.ALLOC_NONE=ALLOC_NONE;function allocate(o,e,t,n){var r,s;typeof o=="number"?(r=!0,s=o):(r=!1,s=o.length);var a=typeof e=="string"?e:null,l;if(t==ALLOC_NONE?l=n:l=[_malloc,Runtime.stackAlloc,Runtime.staticAlloc,Runtime.dynamicAlloc][t===void 0?ALLOC_STATIC:t](Math.max(s,a?1:e.length)),r){var n=l,d;for(assert((l&3)==0),d=l+(s&-4);n<d;n+=4)HEAP32[n>>2]=0;for(d=l+s;n<d;)HEAP8[n++>>0]=0;return l}if(a==="i8")return o.subarray||o.slice?HEAPU8.set(o,l):HEAPU8.set(new Uint8Array(o),l),l;for(var c=0,y,m,O;c<s;){var D=o[c];if(typeof D=="function"&&(D=Runtime.getFunctionIndex(D)),y=a||e[c],y===0){c++;continue}y=="i64"&&(y="i32"),setValue(l+c,D,y),O!==y&&(m=Runtime.getNativeTypeSize(y),O=y),c+=m}return l}Module.allocate=allocate;function Pointer_stringify(o,e){if(e===0||!o)return"";for(var t=!1,n,r=0;;){if(n=HEAPU8[o+r>>0],n>=128)t=!0;else if(n==0&&!e)break;if(r++,e&&r==e)break}e||(e=r);var s="";if(!t){for(var a=1024,l;e>0;)l=String.fromCharCode.apply(String,HEAPU8.subarray(o,o+Math.min(e,a))),s=s?s+l:l,o+=a,e-=a;return s}var d=new Runtime.UTF8Processor;for(r=0;r<e;r++)n=HEAPU8[o+r>>0],s+=d.processCChar(n);return s}Module.Pointer_stringify=Pointer_stringify;function UTF16ToString(o){for(var e=0,t="";;){var n=HEAP16[o+e*2>>1];if(n==0)return t;++e,t+=String.fromCharCode(n)}}Module.UTF16ToString=UTF16ToString;function stringToUTF16(o,e){for(var t=0;t<o.length;++t){var n=o.charCodeAt(t);HEAP16[e+t*2>>1]=n}HEAP16[e+o.length*2>>1]=0}Module.stringToUTF16=stringToUTF16;function UTF32ToString(o){for(var e=0,t="";;){var n=HEAP32[o+e*4>>2];if(n==0)return t;if(++e,n>=65536){var r=n-65536;t+=String.fromCharCode(55296|r>>10,56320|r&1023)}else t+=String.fromCharCode(n)}}Module.UTF32ToString=UTF32ToString;function stringToUTF32(o,e){for(var t=0,n=0;n<o.length;++n){var r=o.charCodeAt(n);if(r>=55296&&r<=57343){var s=o.charCodeAt(++n);r=65536+((r&1023)<<10)|s&1023}HEAP32[e+t*4>>2]=r,++t}HEAP32[e+t*4>>2]=0}Module.stringToUTF32=stringToUTF32;function demangle(o){var e=!!Module.___cxa_demangle;if(e)try{var t=_malloc(o.length);writeStringToMemory(o.substr(1),t);var n=_malloc(4),r=Module.___cxa_demangle(t,0,0,n);if(getValue(n,"i32")===0&&r)return Pointer_stringify(r)}catch{}finally{t&&_free(t),n&&_free(n),r&&_free(r)}var s=3,a={v:"void",b:"bool",c:"char",s:"short",i:"int",l:"long",f:"float",d:"double",w:"wchar_t",a:"signed char",h:"unsigned char",t:"unsigned short",j:"unsigned int",m:"unsigned long",x:"long long",y:"unsigned long long",z:"..."},l=[],d=!0;function c(){s++,o[s]==="K"&&s++;for(var O=[];o[s]!=="E";){if(o[s]==="S"){s++;var D=o.indexOf("_",s),z=o.substring(s,D)||0;O.push(l[z]||"?"),s=D+1;continue}if(o[s]==="C"){O.push(O[O.length-1]),s+=2;continue}var w=parseInt(o.substr(s)),N=w.toString().length;if(!w||!N){s--;break}var H=o.substr(s+N,w);O.push(H),l.push(H),s+=N+w}return s++,O}function y(O,D,z){D=D||1/0;var w="",N=[];function H(){return"("+N.join(", ")+")"}var X;if(o[s]==="N"){if(X=c().join("::"),D--,D===0)return O?[X]:X}else{(o[s]==="K"||d&&o[s]==="L")&&s++;var ae=parseInt(o.substr(s));if(ae){var oe=ae.toString().length;X=o.substr(s+oe,ae),s+=oe+ae}}if(d=!1,o[s]==="I"){s++;var ue=y(!0),fe=y(!0,1,!0);w+=fe[0]+" "+X+"<"+ue.join(", ")+">"}else w=X;e:for(;s<o.length&&D-- >0;){var be=o[s++];if(be in a)N.push(a[be]);else switch(be){case"P":N.push(y(!0,1,!0)[0]+"*");break;case"R":N.push(y(!0,1,!0)[0]+"&");break;case"L":{s++;var Ae=o.indexOf("E",s),ae=Ae-s;N.push(o.substr(s,ae)),s+=ae+2;break}case"A":{var ae=parseInt(o.substr(s));if(s+=ae.toString().length,o[s]!=="_")throw"?";s++,N.push(y(!0,1,!0)[0]+" ["+ae+"]");break}case"E":break e;default:w+="?"+be;break e}}return!z&&N.length===1&&N[0]==="void"&&(N=[]),O?(w&&N.push(w+"?"),N):w+H()}var m=o;try{if(o=="Object._main"||o=="_main")return"main()";if(typeof o=="number"&&(o=Pointer_stringify(o)),o[0]!=="_"||o[1]!=="_"||o[2]!=="Z")return o;switch(o[3]){case"n":return"operator new()";case"d":return"operator delete()"}m=y()}catch{m+="?"}return m.indexOf("?")>=0&&!e&&Runtime.warnOnce("warning: a problem occurred in builtin C++ name demangling; build with  -s DEMANGLE_SUPPORT=1  to link in libcxxabi demangling"),m}function demangleAll(o){return o.replace(/__Z[\w\d_]+/g,function(e){var t=demangle(e);return e===t?e:e+" ["+t+"]"})}function jsStackTrace(){var o=new Error;if(!o.stack){try{throw new Error(0)}catch(e){o=e}if(!o.stack)return"(no stack trace available)"}return o.stack.toString()}function stackTrace(){return demangleAll(jsStackTrace())}Module.stackTrace=stackTrace;var PAGE_SIZE=4096;function alignMemoryPage(o){return o+4095&-4096}var HEAP,HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAPF64,STATIC_BASE=0,STATICTOP=0,STACK_BASE=0,STACKTOP=0,STACK_MAX=0,DYNAMIC_BASE=0,DYNAMICTOP=0;function enlargeMemory(){abort("Cannot enlarge memory arrays. Either (1) compile with -s TOTAL_MEMORY=X with X higher than the current value "+TOTAL_MEMORY+", (2) compile with ALLOW_MEMORY_GROWTH which adjusts the size at runtime but prevents some optimizations, or (3) set Module.TOTAL_MEMORY before the program runs.")}var TOTAL_STACK=Module.TOTAL_STACK||5242880,TOTAL_MEMORY=Module.TOTAL_MEMORY||67108864;Module.FAST_MEMORY;for(var totalMemory=64*1024;totalMemory<TOTAL_MEMORY||totalMemory<2*TOTAL_STACK;)totalMemory<16*1024*1024?totalMemory*=2:totalMemory+=16*1024*1024;totalMemory!==TOTAL_MEMORY&&(Module.printErr("increasing TOTAL_MEMORY to "+totalMemory+" to be compliant with the asm.js spec"),TOTAL_MEMORY=totalMemory),assert(typeof Int32Array<"u"&&typeof Float64Array<"u"&&!!new Int32Array(1).subarray&&!!new Int32Array(1).set,"JS engine does not provide full typed array support");var buffer=new ArrayBuffer(TOTAL_MEMORY);HEAP8=new Int8Array(buffer),HEAP16=new Int16Array(buffer),HEAP32=new Int32Array(buffer),HEAPU8=new Uint8Array(buffer),HEAPU16=new Uint16Array(buffer),HEAPU32=new Uint32Array(buffer),HEAPF32=new Float32Array(buffer),HEAPF64=new Float64Array(buffer),HEAP32[0]=255,assert(HEAPU8[0]===255&&HEAPU8[3]===0,"Typed arrays 2 must be run on a little-endian system"),Module.HEAP=HEAP,Module.buffer=buffer,Module.HEAP8=HEAP8,Module.HEAP16=HEAP16,Module.HEAP32=HEAP32,Module.HEAPU8=HEAPU8,Module.HEAPU16=HEAPU16,Module.HEAPU32=HEAPU32,Module.HEAPF32=HEAPF32,Module.HEAPF64=HEAPF64;function callRuntimeCallbacks(o){for(;o.length>0;){var e=o.shift();if(typeof e=="function"){e();continue}var t=e.func;typeof t=="number"?e.arg===void 0?Runtime.dynCall("v",t):Runtime.dynCall("vi",t,[e.arg]):t(e.arg===void 0?null:e.arg)}}var __ATPRERUN__=[],__ATINIT__=[],__ATMAIN__=[],__ATEXIT__=[],__ATPOSTRUN__=[],runtimeInitialized=!1;function preRun(){if(Module.preRun)for(typeof Module.preRun=="function"&&(Module.preRun=[Module.preRun]);Module.preRun.length;)addOnPreRun(Module.preRun.shift());callRuntimeCallbacks(__ATPRERUN__)}function ensureInitRuntime(){runtimeInitialized||(runtimeInitialized=!0,callRuntimeCallbacks(__ATINIT__))}function preMain(){callRuntimeCallbacks(__ATMAIN__)}function exitRuntime(){callRuntimeCallbacks(__ATEXIT__)}function postRun(){if(Module.postRun)for(typeof Module.postRun=="function"&&(Module.postRun=[Module.postRun]);Module.postRun.length;)addOnPostRun(Module.postRun.shift());callRuntimeCallbacks(__ATPOSTRUN__)}function addOnPreRun(o){__ATPRERUN__.unshift(o)}Module.addOnPreRun=Module.addOnPreRun=addOnPreRun;function addOnInit(o){__ATINIT__.unshift(o)}Module.addOnInit=Module.addOnInit=addOnInit;function addOnPreMain(o){__ATMAIN__.unshift(o)}Module.addOnPreMain=Module.addOnPreMain=addOnPreMain;function addOnExit(o){__ATEXIT__.unshift(o)}Module.addOnExit=Module.addOnExit=addOnExit;function addOnPostRun(o){__ATPOSTRUN__.unshift(o)}Module.addOnPostRun=Module.addOnPostRun=addOnPostRun;function intArrayFromString(o,e,t){var n=new Runtime.UTF8Processor().processJSString(o);return t&&(n.length=t),e||n.push(0),n}Module.intArrayFromString=intArrayFromString;function intArrayToString(o){for(var e=[],t=0;t<o.length;t++){var n=o[t];n>255&&(n&=255),e.push(String.fromCharCode(n))}return e.join("")}Module.intArrayToString=intArrayToString;function writeStringToMemory(o,e,t){for(var n=intArrayFromString(o,t),r=0;r<n.length;){var s=n[r];HEAP8[e+r>>0]=s,r=r+1}}Module.writeStringToMemory=writeStringToMemory;function writeArrayToMemory(o,e){for(var t=0;t<o.length;t++)HEAP8[e+t>>0]=o[t]}Module.writeArrayToMemory=writeArrayToMemory;function writeAsciiToMemory(o,e,t){for(var n=0;n<o.length;n++)HEAP8[e+n>>0]=o.charCodeAt(n);t||(HEAP8[e+o.length>>0]=0)}Module.writeAsciiToMemory=writeAsciiToMemory;function unSign(o,e,t){return o>=0?o:e<=32?2*Math.abs(1<<e-1)+o:Math.pow(2,e)+o}function reSign(o,e,t){if(o<=0)return o;var n=e<=32?Math.abs(1<<e-1):Math.pow(2,e-1);return o>=n&&(e<=32||o>n)&&(o=-2*n+o),o}(!Math.imul||Math.imul(4294967295,5)!==-5)&&(Math.imul=function o(e,t){var n=e>>>16,r=e&65535,s=t>>>16,a=t&65535;return r*a+(n*a+r*s<<16)|0}),Math.imul=Math.imul;var Math_abs=Math.abs,Math_ceil=Math.ceil,Math_floor=Math.floor,Math_pow=Math.pow,Math_min=Math.min,runDependencies=0,dependenciesFulfilled=null;function addRunDependency(o){runDependencies++,Module.monitorRunDependencies&&Module.monitorRunDependencies(runDependencies)}Module.addRunDependency=addRunDependency;function removeRunDependency(o){if(runDependencies--,Module.monitorRunDependencies&&Module.monitorRunDependencies(runDependencies),runDependencies==0&&dependenciesFulfilled){var e=dependenciesFulfilled;dependenciesFulfilled=null,e()}}Module.removeRunDependency=removeRunDependency,Module.preloadedImages={},Module.preloadedAudios={},STATIC_BASE=8,STATICTOP=STATIC_BASE+5664,__ATINIT__.push({func:function(){__GLOBAL__I_a()}},{func:function(){__GLOBAL__I_a127()}}),allocate([78,55,77,105,110,105,115,97,116,50,48,79,117,116,79,102,77,101,109,111,114,121,69,120,99,101,112,116,105,111,110,69,0,0,0,0,0,0,0,0,88,18,0,0,8,0,0,0,78,55,77,105,110,105,115,97,116,54,79,112,116,105,111,110,69,0,0,0,0,0,0,0,88,18,0,0,56,0,0,0,10,32,32,32,32,32,32,32,32,37,115,10,0,0,0,0,0,0,0,0,80,0,0,0,1,0,0,0,2,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,200,0,0,0,1,0,0,0,3,0,0,0,1,0,0,0,1,0,0,0,78,55,77,105,110,105,115,97,116,49,48,66,111,111,108,79,112,116,105,111,110,69,0,0,128,18,0,0,176,0,0,0,80,0,0,0,0,0,0,0,32,32,45,37,115,44,32,45,110,111,45,37,115,0,0,0,40,100,101,102,97,117,108,116,58,32,37,115,41,10,0,0,111,110,0,0,0,0,0,0,111,102,102,0,0,0,0,0,110,111,45,0,0,0,0,0,0,0,0,0,64,1,0,0,1,0,0,0,4,0,0,0,2,0,0,0,2,0,0,0,78,55,77,105,110,105,115,97,116,57,73,110,116,79,112,116,105,111,110,69,0,0,0,0,128,18,0,0,40,1,0,0,80,0,0,0,0,0,0,0,32,32,45,37,45,49,50,115,32,61,32,37,45,56,115,32,91,0,0,0,0,0,0,0,105,109,105,110,0,0,0,0,37,52,100,0,0,0,0,0,32,46,46,32,0,0,0,0,105,109,97,120,0,0,0,0,93,32,40,100,101,102,97,117,108,116,58,32,37,100,41,10,0,0,0,0,0,0,0,0,69,82,82,79,82,33,32,118,97,108,117,101,32,60,37,115,62,32,105,115,32,116,111,111,32,108,97,114,103,101,32,102,111,114,32,111,112,116,105,111,110,32,34,37,115,34,46,10,0,0,0,0,0,0,0,0,69,82,82,79,82,33,32,118,97,108,117,101,32,60,37,115,62,32,105,115,32,116,111,111,32,115,109,97,108,108,32,102,111,114,32,111,112,116,105,111,110,32,34,37,115,34,46,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,118,97,114,45,100,101,99,97,121,0,0,0,0,0,0,0,84,104,101,32,118,97,114,105,97,98,108,101,32,97,99,116,105,118,105,116,121,32,100,101,99,97,121,32,102,97,99,116,111,114,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,99,108,97,45,100,101,99,97,121,0,0,0,0,0,0,0,84,104,101,32,99,108,97,117,115,101,32,97,99,116,105,118,105,116,121,32,100,101,99,97,121,32,102,97,99,116,111,114,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,114,110,100,45,102,114,101,113,0,0,0,0,0,0,0,0,84,104,101,32,102,114,101,113,117,101,110,99,121,32,119,105,116,104,32,119,104,105,99,104,32,116,104,101,32,100,101,99,105,115,105,111,110,32,104,101,117,114,105,115,116,105,99,32,116,114,105,101,115,32,116,111,32,99,104,111,111,115,101,32,97,32,114,97,110,100,111,109,32,118,97,114,105,97,98,108,101,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,114,110,100,45,115,101,101,100,0,0,0,0,0,0,0,0,85,115,101,100,32,98,121,32,116,104,101,32,114,97,110,100,111,109,32,118,97,114,105,97,98,108,101,32,115,101,108,101,99,116,105,111,110,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,99,99,109,105,110,45,109,111,100,101,0,0,0,0,0,0,67,111,110,116,114,111,108,115,32,99,111,110,102,108,105,99,116,32,99,108,97,117,115,101,32,109,105,110,105,109,105,122,97,116,105,111,110,32,40,48,61,110,111,110,101,44,32,49,61,98,97,115,105,99,44,32,50,61,100,101,101,112,41,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,112,104,97,115,101,45,115,97,118,105,110,103,0,0,0,0,67,111,110,116,114,111,108,115,32,116,104,101,32,108,101,118,101,108,32,111,102,32,112,104,97,115,101,32,115,97,118,105,110,103,32,40,48,61,110,111,110,101,44,32,49,61,108,105,109,105,116,101,100,44,32,50,61,102,117,108,108,41,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,114,110,100,45,105,110,105,116,0,0,0,0,0,0,0,0,82,97,110,100,111,109,105,122,101,32,116,104,101,32,105,110,105,116,105,97,108,32,97,99,116,105,118,105,116,121,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,108,117,98,121,0,0,0,0,85,115,101,32,116,104,101,32,76,117,98,121,32,114,101,115,116,97,114,116,32,115,101,113,117,101,110,99,101,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,114,102,105,114,115,116,0,0,84,104,101,32,98,97,115,101,32,114,101,115,116,97,114,116,32,105,110,116,101,114,118,97,108,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,114,105,110,99,0,0,0,0,82,101,115,116,97,114,116,32,105,110,116,101,114,118,97,108,32,105,110,99,114,101,97,115,101,32,102,97,99,116,111,114,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,103,99,45,102,114,97,99,0,84,104,101,32,102,114,97,99,116,105,111,110,32,111,102,32,119,97,115,116,101,100,32,109,101,109,111,114,121,32,97,108,108,111,119,101,100,32,98,101,102,111,114,101,32,97,32,103,97,114,98,97,103,101,32,99,111,108,108,101,99,116,105,111,110,32,105,115,32,116,114,105,103,103,101,114,101,100,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,109,105,110,45,108,101,97,114,110,116,115,0,0,0,0,0,77,105,110,105,109,117,109,32,108,101,97,114,110,116,32,99,108,97,117,115,101,32,108,105,109,105,116,0,0,0,0,0,0,0,0,0,192,7,0,0,5,0,0,0,6,0,0,0,7,0,0,0,0,0,0,0,124,32,37,57,100,32,124,32,37,55,100,32,37,56,100,32,37,56,100,32,124,32,37,56,100,32,37,56,100,32,37,54,46,48,102,32,124,32,37,54,46,51,102,32,37,37,32,124,10,0,0,0,0,0,0,0,124,32,32,71,97,114,98,97,103,101,32,99,111,108,108,101,99,116,105,111,110,58,32,32,32,37,49,50,100,32,98,121,116,101,115,32,61,62,32,37,49,50,100,32,98,121,116,101,115,32,32,32,32,32,32,32,32,32,32,32,32,32,124,10,0,0,0,0,0,0,0,0,78,55,77,105,110,105,115,97,116,54,83,111,108,118,101,114,69,0,0,0,0,0,0,0,88,18,0,0,168,7,0,0,60,98,111,111,108,62,0,0,10,32,32,32,32,32,32,32,32,37,115,10,0,0,0,0,60,105,110,116,51,50,62,0,69,82,82,79,82,33,32,118,97,108,117,101,32,60,37,115,62,32,105,115,32,116,111,111,32,108,97,114,103,101,32,102,111,114,32,111,112,116,105,111,110,32,34,37,115,34,46,10,0,0,0,0,0,0,0,0,69,82,82,79,82,33,32,118,97,108,117,101,32,60,37,115,62,32,105,115,32,116,111,111,32,115,109,97,108,108,32,102,111,114,32,111,112,116,105,111,110,32,34,37,115,34,46,10,0,0,0,0,0,0,0,0,67,79,82,69,0,0,0,0,60,100,111,117,98,108,101,62,0,0,0,0,0,0,0,0,0,0,0,0,168,8,0,0,1,0,0,0,8,0,0,0,3,0,0,0,3,0,0,0,78,55,77,105,110,105,115,97,116,49,50,68,111,117,98,108,101,79,112,116,105,111,110,69,0,0,0,0,0,0,0,0,128,18,0,0,136,8,0,0,80,0,0,0,0,0,0,0,32,32,45,37,45,49,50,115,32,61,32,37,45,56,115,32,37,99,37,52,46,50,103,32,46,46,32,37,52,46,50,103,37,99,32,40,100,101,102,97,117,108,116,58,32,37,103,41,10,0,0,0,0,0,0,0,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,91,32,83,101,97,114,99,104,32,83,116,97,116,105,115,116,105,99,115,32,93,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,0,124,32,67,111,110,102,108,105,99,116,115,32,124,32,32,32,32,32,32,32,32,32,32,79,82,73,71,73,78,65,76,32,32,32,32,32,32,32,32,32,124,32,32,32,32,32,32,32,32,32,32,76,69,65,82,78,84,32,32,32,32,32,32,32,32,32,32,124,32,80,114,111,103,114,101,115,115,32,124,0,124,32,32,32,32,32,32,32,32,32,32,32,124,32,32,32,32,86,97,114,115,32,32,67,108,97,117,115,101,115,32,76,105,116,101,114,97,108,115,32,124,32,32,32,32,76,105,109,105,116,32,32,67,108,97,117,115,101,115,32,76,105,116,47,67,108,32,124,32,32,32,32,32,32,32,32,32,32,124,0,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,97,115,121,109,109,0,0,0,83,104,114,105,110,107,32,99,108,97,117,115,101,115,32,98,121,32,97,115,121,109,109,101,116,114,105,99,32,98,114,97,110,99,104,105,110,103,46,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,114,99,104,101,99,107,0,0,67,104,101,99,107,32,105,102,32,97,32,99,108,97,117,115,101,32,105,115,32,97,108,114,101,97,100,121,32,105,109,112,108,105,101,100,46,32,40,99,111,115,116,108,121,41,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,101,108,105,109,0,0,0,0,80,101,114,102,111,114,109,32,118,97,114,105,97,98,108,101,32,101,108,105,109,105,110,97,116,105,111,110,46,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,103,114,111,119,0,0,0,0,65,108,108,111,119,32,97,32,118,97,114,105,97,98,108,101,32,101,108,105,109,105,110,97,116,105,111,110,32,115,116,101,112,32,116,111,32,103,114,111,119,32,98,121,32,97,32,110,117,109,98,101,114,32,111,102,32,99,108,97,117,115,101,115,46,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,99,108,45,108,105,109,0,0,86,97,114,105,97,98,108,101,115,32,97,114,101,32,110,111,116,32,101,108,105,109,105,110,97,116,101,100,32,105,102,32,105,116,32,112,114,111,100,117,99,101,115,32,97,32,114,101,115,111,108,118,101,110,116,32,119,105,116,104,32,97,32,108,101,110,103,116,104,32,97,98,111,118,101,32,116,104,105,115,32,108,105,109,105,116,46,32,45,49,32,109,101,97,110,115,32,110,111,32,108,105,109,105,116,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,115,117,98,45,108,105,109,0,68,111,32,110,111,116,32,99,104,101,99,107,32,105,102,32,115,117,98,115,117,109,112,116,105,111,110,32,97,103,97,105,110,115,116,32,97,32,99,108,97,117,115,101,32,108,97,114,103,101,114,32,116,104,97,110,32,116,104,105,115,46,32,45,49,32,109,101,97,110,115,32,110,111,32,108,105,109,105,116,46,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,115,105,109,112,45,103,99,45,102,114,97,99,0,0,0,0,84,104,101,32,102,114,97,99,116,105,111,110,32,111,102,32,119,97,115,116,101,100,32,109,101,109,111,114,121,32,97,108,108,111,119,101,100,32,98,101,102,111,114,101,32,97,32,103,97,114,98,97,103,101,32,99,111,108,108,101,99,116,105,111,110,32,105,115,32,116,114,105,103,103,101,114,101,100,32,100,117,114,105,110,103,32,115,105,109,112,108,105,102,105,99,97,116,105,111,110,46,0,0,0,0,0,0,0,120,14,0,0,9,0,0,0,10,0,0,0,11,0,0,0,0,0,0,0,115,117,98,115,117,109,112,116,105,111,110,32,108,101,102,116,58,32,37,49,48,100,32,40,37,49,48,100,32,115,117,98,115,117,109,101,100,44,32,37,49,48,100,32,100,101,108,101,116,101,100,32,108,105,116,101,114,97,108,115,41,13,0,0,101,108,105,109,105,110,97,116,105,111,110,32,108,101,102,116,58,32,37,49,48,100,13,0,124,32,32,69,108,105,109,105,110,97,116,101,100,32,99,108,97,117,115,101,115,58,32,32,32,32,32,37,49,48,46,50,102,32,77,98,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,124,10,0,0,0,0,124,32,32,71,97,114,98,97,103,101,32,99,111,108,108,101,99,116,105,111,110,58,32,32,32,37,49,50,100,32,98,121,116,101,115,32,61,62,32,37,49,50,100,32,98,121,116,101,115,32,32,32,32,32,32,32,32,32,32,32,32,32,124,10,0,0,0,0,0,0,0,0,78,55,77,105,110,105,115,97,116,49,48,83,105,109,112,83,111,108,118,101,114,69,0,0,128,18,0,0,96,14,0,0,192,7,0,0,0,0,0,0,60,100,111,117,98,108,101,62,0,0,0,0,0,0,0,0,60,105,110,116,51,50,62,0,83,73,77,80,0,0,0,0,60,98,111,111,108,62,0,0,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,89,79,33,0,0,0,0,0,2,0,0,0,0,0,0,0,48,15,0,0,0,0,0,0,117,110,99,97,117,103,104,116,0,0,0,0,0,0,0,0,116,101,114,109,105,110,97,116,105,110,103,32,119,105,116,104,32,37,115,32,101,120,99,101,112,116,105,111,110,32,111,102,32,116,121,112,101,32,37,115,58,32,37,115,0,0,0,0,116,101,114,109,105,110,97,116,105,110,103,32,119,105,116,104,32,37,115,32,101,120,99,101,112,116,105,111,110,32,111,102,32,116,121,112,101,32,37,115,0,0,0,0,0,0,0,0,116,101,114,109,105,110,97,116,105,110,103,32,119,105,116,104,32,37,115,32,102,111,114,101,105,103,110,32,101,120,99,101,112,116,105,111,110,0,0,0,116,101,114,109,105,110,97,116,105,110,103,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,112,116,104,114,101,97,100,95,111,110,99,101,32,102,97,105,108,117,114,101,32,105,110,32,95,95,99,120,97,95,103,101,116,95,103,108,111,98,97,108,115,95,102,97,115,116,40,41,0,0,0,0,0,0,0,0,99,97,110,110,111,116,32,99,114,101,97,116,101,32,112,116,104,114,101,97,100,32,107,101,121,32,102,111,114,32,95,95,99,120,97,95,103,101,116,95,103,108,111,98,97,108,115,40,41,0,0,0,0,0,0,0,99,97,110,110,111,116,32,122,101,114,111,32,111,117,116,32,116,104,114,101,97,100,32,118,97,108,117,101,32,102,111,114,32,95,95,99,120,97,95,103,101,116,95,103,108,111,98,97,108,115,40,41,0,0,0,0,0,0,0,0,200,16,0,0,12,0,0,0,13,0,0,0,1,0,0,0,0,0,0,0,115,116,100,58,58,98,97,100,95,97,108,108,111,99,0,0,83,116,57,98,97,100,95,97,108,108,111,99,0,0,0,0,128,18,0,0,184,16,0,0,80,17,0,0,0,0,0,0,116,101,114,109,105,110,97,116,101,95,104,97,110,100,108,101,114,32,117,110,101,120,112,101,99,116,101,100,108,121,32,114,101,116,117,114,110,101,100,0,116,101,114,109,105,110,97,116,101,95,104,97,110,100,108,101,114,32,117,110,101,120,112,101,99,116,101,100,108,121,32,116,104,114,101,119,32,97,110,32,101,120,99,101,112,116,105,111,110,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,83,116,57,101,120,99,101,112,116,105,111,110,0,0,0,0,88,18,0,0,64,17,0,0,83,116,57,116,121,112,101,95,105,110,102,111,0,0,0,0,88,18,0,0,88,17,0,0,78,49,48,95,95,99,120,120,97,98,105,118,49,49,54,95,95,115,104,105,109,95,116,121,112,101,95,105,110,102,111,69,0,0,0,0,0,0,0,0,128,18,0,0,112,17,0,0,104,17,0,0,0,0,0,0,78,49,48,95,95,99,120,120,97,98,105,118,49,49,55,95,95,99,108,97,115,115,95,116,121,112,101,95,105,110,102,111,69,0,0,0,0,0,0,0,128,18,0,0,168,17,0,0,152,17,0,0,0,0,0,0,78,49,48,95,95,99,120,120,97,98,105,118,49,49,57,95,95,112,111,105,110,116,101,114,95,116,121,112,101,95,105,110,102,111,69,0,0,0,0,0,78,49,48,95,95,99,120,120,97,98,105,118,49,49,55,95,95,112,98,97,115,101,95,116,121,112,101,95,105,110,102,111,69,0,0,0,0,0,0,0,128,18,0,0,8,18,0,0,152,17,0,0,0,0,0,0,128,18,0,0,224,17,0,0,48,18,0,0,0,0,0,0,0,0,0,0,208,17,0,0,14,0,0,0,15,0,0,0,16,0,0,0,17,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,200,18,0,0,14,0,0,0,18,0,0,0,16,0,0,0,17,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,78,49,48,95,95,99,120,120,97,98,105,118,49,50,48,95,95,115,105,95,99,108,97,115,115,95,116,121,112,101,95,105,110,102,111,69,0,0,0,0,128,18,0,0,160,18,0,0,208,17,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,1,2,3,4,5,6,7,8,9,255,255,255,255,255,255,255,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,255,255,255,255,255,255,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0,0,0,0,0,0,0,1,2,4,7,3,6,5,0,0,0,0,0,0,0,0,105,110,102,105,110,105,116,121,0,0,0,0,0,0,0,0,110,97,110,0,0,0,0,0,95,112,137,0,255,9,47,15,10,0,0,0,100,0,0,0,232,3,0,0,16,39,0,0,160,134,1,0,64,66,15,0,128,150,152,0,0,225,245,5],"i8",ALLOC_NONE,Runtime.GLOBAL_BASE);var tempDoublePtr=Runtime.alignMemory(allocate(12,"i8",ALLOC_STATIC),8);assert(tempDoublePtr%8==0);function _atexit(o,e){__ATEXIT__.unshift({func:o,arg:e})}function ___cxa_atexit(){return _atexit.apply(null,arguments)}Module._i64Subtract=_i64Subtract;var ___errno_state=0;function ___setErrNo(o){return HEAP32[___errno_state>>2]=o,o}var ERRNO_CODES={EPERM:1,ENOENT:2,ESRCH:3,EINTR:4,EIO:5,ENXIO:6,E2BIG:7,ENOEXEC:8,EBADF:9,ECHILD:10,EAGAIN:11,EWOULDBLOCK:11,ENOMEM:12,EACCES:13,EFAULT:14,ENOTBLK:15,EBUSY:16,EEXIST:17,EXDEV:18,ENODEV:19,ENOTDIR:20,EISDIR:21,EINVAL:22,ENFILE:23,EMFILE:24,ENOTTY:25,ETXTBSY:26,EFBIG:27,ENOSPC:28,ESPIPE:29,EROFS:30,EMLINK:31,EPIPE:32,EDOM:33,ERANGE:34,ENOMSG:42,EIDRM:43,ECHRNG:44,EL2NSYNC:45,EL3HLT:46,EL3RST:47,ELNRNG:48,EUNATCH:49,ENOCSI:50,EL2HLT:51,EDEADLK:35,ENOLCK:37,EBADE:52,EBADR:53,EXFULL:54,ENOANO:55,EBADRQC:56,EBADSLT:57,EDEADLOCK:35,EBFONT:59,ENOSTR:60,ENODATA:61,ETIME:62,ENOSR:63,ENONET:64,ENOPKG:65,EREMOTE:66,ENOLINK:67,EADV:68,ESRMNT:69,ECOMM:70,EPROTO:71,EMULTIHOP:72,EDOTDOT:73,EBADMSG:74,ENOTUNIQ:76,EBADFD:77,EREMCHG:78,ELIBACC:79,ELIBBAD:80,ELIBSCN:81,ELIBMAX:82,ELIBEXEC:83,ENOSYS:38,ENOTEMPTY:39,ENAMETOOLONG:36,ELOOP:40,EOPNOTSUPP:95,EPFNOSUPPORT:96,ECONNRESET:104,ENOBUFS:105,EAFNOSUPPORT:97,EPROTOTYPE:91,ENOTSOCK:88,ENOPROTOOPT:92,ESHUTDOWN:108,ECONNREFUSED:111,EADDRINUSE:98,ECONNABORTED:103,ENETUNREACH:101,ENETDOWN:100,ETIMEDOUT:110,EHOSTDOWN:112,EHOSTUNREACH:113,EINPROGRESS:115,EALREADY:114,EDESTADDRREQ:89,EMSGSIZE:90,EPROTONOSUPPORT:93,ESOCKTNOSUPPORT:94,EADDRNOTAVAIL:99,ENETRESET:102,EISCONN:106,ENOTCONN:107,ETOOMANYREFS:109,EUSERS:87,EDQUOT:122,ESTALE:116,ENOTSUP:95,ENOMEDIUM:123,EILSEQ:84,EOVERFLOW:75,ECANCELED:125,ENOTRECOVERABLE:131,EOWNERDEAD:130,ESTRPIPE:86};function _sysconf(o){switch(o){case 30:return PAGE_SIZE;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 80:case 81:case 79:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:return 200809;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 75:return 16384;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:return typeof navigator=="object"&&navigator.hardwareConcurrency||1}return ___setErrNo(ERRNO_CODES.EINVAL),-1}function __ZSt18uncaught_exceptionv(){return!!__ZSt18uncaught_exceptionv.uncaught_exception}var EXCEPTIONS={last:0,caught:[],infos:{},deAdjust:function(o){if(!o||EXCEPTIONS.infos[o])return o;for(var e in EXCEPTIONS.infos){var t=EXCEPTIONS.infos[e];if(t.adjusted===o)return e}return o},addRef:function(o){if(o){var e=EXCEPTIONS.infos[o];e.refcount++}},decRef:function(o){if(o){var e=EXCEPTIONS.infos[o];assert(e.refcount>0),e.refcount--,e.refcount===0&&(e.destructor&&Runtime.dynCall("vi",e.destructor,[o]),delete EXCEPTIONS.infos[o],___cxa_free_exception(o))}},clearRef:function(o){if(o){var e=EXCEPTIONS.infos[o];e.refcount=0}}};function ___resumeException(o){throw EXCEPTIONS.last||(EXCEPTIONS.last=o),EXCEPTIONS.clearRef(EXCEPTIONS.deAdjust(o)),o+" - Exception catching is disabled, this exception cannot be caught. Compile with -s DISABLE_EXCEPTION_CATCHING=0 or DISABLE_EXCEPTION_CATCHING=2 to catch."}function ___cxa_find_matching_catch(){var o=EXCEPTIONS.last;if(!o)return asm.setTempRet0(0),0|0;var e=EXCEPTIONS.infos[o],t=e.type;if(!t)return asm.setTempRet0(0),o|0;var n=Array.prototype.slice.call(arguments);Module.___cxa_is_pointer_type(t),___cxa_find_matching_catch.buffer||(___cxa_find_matching_catch.buffer=_malloc(4)),HEAP32[___cxa_find_matching_catch.buffer>>2]=o,o=___cxa_find_matching_catch.buffer;for(var r=0;r<n.length;r++)if(n[r]&&Module.___cxa_can_catch(n[r],t,o))return o=HEAP32[o>>2],e.adjusted=o,asm.setTempRet0(n[r]),o|0;return o=HEAP32[o>>2],asm.setTempRet0(t),o|0}function ___cxa_throw(o,e,t){throw EXCEPTIONS.infos[o]={ptr:o,adjusted:o,type:e,destructor:t,refcount:0},EXCEPTIONS.last=o,"uncaught_exception"in __ZSt18uncaught_exceptionv?__ZSt18uncaught_exceptionv.uncaught_exception++:__ZSt18uncaught_exceptionv.uncaught_exception=1,o+" - Exception catching is disabled, this exception cannot be caught. Compile with -s DISABLE_EXCEPTION_CATCHING=0 or DISABLE_EXCEPTION_CATCHING=2 to catch."}Module._memset=_memset,Module._bitshift64Shl=_bitshift64Shl;function _abort(){Module.abort()}var FS=void 0,SOCKFS=void 0;function _send(o,e,t,n){var r=SOCKFS.getSocket(o);return r?_write(o,e,t):(___setErrNo(ERRNO_CODES.EBADF),-1)}function _pwrite(o,e,t,n){var r=FS.getStream(o);if(!r)return ___setErrNo(ERRNO_CODES.EBADF),-1;try{var s=HEAP8;return FS.write(r,s,e,t,n)}catch(a){return FS.handleFSError(a),-1}}function _write(o,e,t){var n=FS.getStream(o);if(!n)return ___setErrNo(ERRNO_CODES.EBADF),-1;try{var r=HEAP8;return FS.write(n,r,e,t)}catch(s){return FS.handleFSError(s),-1}}function _fileno(o){return o=FS.getStreamFromPtr(o),o?o.fd:-1}function _fwrite(o,e,t,n){var r=t*e;if(r==0)return 0;var s=_fileno(n),a=_write(s,o,r);if(a==-1){var l=FS.getStreamFromPtr(n);return l&&(l.error=!0),0}else return a/e|0}Module._strlen=_strlen;function __reallyNegative(o){return o<0||o===0&&1/o===-1/0}function __formatString(o,e){var t=o,n=0;function r(zt){var xt;return zt==="double"?xt=(HEAP32[tempDoublePtr>>2]=HEAP32[e+n>>2],HEAP32[tempDoublePtr+4>>2]=HEAP32[e+(n+4)>>2],+HEAPF64[tempDoublePtr>>3]):zt=="i64"?xt=[HEAP32[e+n>>2],HEAP32[e+(n+4)>>2]]:(zt="i32",xt=HEAP32[e+n>>2]),n+=Runtime.getNativeFieldSize(zt),xt}for(var s=[],a,l,d;;){var c=t;if(a=HEAP8[t>>0],a===0)break;if(l=HEAP8[t+1>>0],a==37){var y=!1,m=!1,O=!1,D=!1,z=!1;e:for(;;){switch(l){case 43:y=!0;break;case 45:m=!0;break;case 35:O=!0;break;case 48:if(D)break e;D=!0;break;case 32:z=!0;break;default:break e}t++,l=HEAP8[t+1>>0]}var w=0;if(l==42)w=r("i32"),t++,l=HEAP8[t+1>>0];else for(;l>=48&&l<=57;)w=w*10+(l-48),t++,l=HEAP8[t+1>>0];var N=!1,H=-1;if(l==46){if(H=0,N=!0,t++,l=HEAP8[t+1>>0],l==42)H=r("i32"),t++;else for(;;){var X=HEAP8[t+1>>0];if(X<48||X>57)break;H=H*10+(X-48),t++}l=HEAP8[t+1>>0]}H<0&&(H=6,N=!1);var ae;switch(String.fromCharCode(l)){case"h":var oe=HEAP8[t+2>>0];oe==104?(t++,ae=1):ae=2;break;case"l":var oe=HEAP8[t+2>>0];oe==108?(t++,ae=8):ae=4;break;case"L":case"q":case"j":ae=8;break;case"z":case"t":case"I":ae=4;break;default:ae=null}switch(ae&&t++,l=HEAP8[t+1>>0],String.fromCharCode(l)){case"d":case"i":case"u":case"o":case"x":case"X":case"p":{var ue=l==100||l==105;ae=ae||4;var d=r("i"+ae*8),fe=d,be;if(ae==8&&(d=Runtime.makeBigInt(d[0],d[1],l==117)),ae<=4){var Ae=Math.pow(256,ae)-1;d=(ue?reSign:unSign)(d&Ae,ae*8)}var W=Math.abs(d),J="";if(l==100||l==105)ae==8&&i64Math?be=i64Math.stringify(fe[0],fe[1],null):be=reSign(d,8*ae).toString(10);else if(l==117)ae==8&&i64Math?be=i64Math.stringify(fe[0],fe[1],!0):be=unSign(d,8*ae).toString(10),d=Math.abs(d);else if(l==111)be=(O?"0":"")+W.toString(8);else if(l==120||l==88){if(J=O&&d!=0?"0x":"",ae==8&&i64Math)if(fe[1]){be=(fe[1]>>>0).toString(16);for(var Ue=(fe[0]>>>0).toString(16);Ue.length<8;)Ue="0"+Ue;be+=Ue}else be=(fe[0]>>>0).toString(16);else if(d<0){d=-d,be=(W-1).toString(16);for(var gt=[],Te=0;Te<be.length;Te++)gt.push((15-parseInt(be[Te],16)).toString(16));for(be=gt.join("");be.length<ae*2;)be="f"+be}else be=W.toString(16);l==88&&(J=J.toUpperCase(),be=be.toUpperCase())}else l==112&&(W===0?be="(nil)":(J="0x",be=W.toString(16)));if(N)for(;be.length<H;)be="0"+be;for(d>=0&&(y?J="+"+J:z&&(J=" "+J)),be.charAt(0)=="-"&&(J="-"+J,be=be.substr(1));J.length+be.length<w;)m?be+=" ":D?be="0"+be:J=" "+J;be=J+be,be.split("").forEach(function(xt){s.push(xt.charCodeAt(0))});break}case"f":case"F":case"e":case"E":case"g":case"G":{var d=r("double"),be;if(isNaN(d))be="nan",D=!1;else if(!isFinite(d))be=(d<0?"-":"")+"inf",D=!1;else{var Et=!1,Bt=Math.min(H,20);if(l==103||l==71){Et=!0,H=H||1;var Ke=parseInt(d.toExponential(Bt).split("e")[1],10);H>Ke&&Ke>=-4?(l=(l==103?"f":"F").charCodeAt(0),H-=Ke+1):(l=(l==103?"e":"E").charCodeAt(0),H--),Bt=Math.min(H,20)}l==101||l==69?(be=d.toExponential(Bt),/[eE][-+]\d$/.test(be)&&(be=be.slice(0,-1)+"0"+be.slice(-1))):(l==102||l==70)&&(be=d.toFixed(Bt),d===0&&__reallyNegative(d)&&(be="-"+be));var At=be.split("e");if(Et&&!O)for(;At[0].length>1&&At[0].indexOf(".")!=-1&&(At[0].slice(-1)=="0"||At[0].slice(-1)==".");)At[0]=At[0].slice(0,-1);else for(O&&be.indexOf(".")==-1&&(At[0]+=".");H>Bt++;)At[0]+="0";be=At[0]+(At.length>1?"e"+At[1]:""),l==69&&(be=be.toUpperCase()),d>=0&&(y?be="+"+be:z&&(be=" "+be))}for(;be.length<w;)m?be+=" ":D&&(be[0]=="-"||be[0]=="+")?be=be[0]+"0"+be.slice(1):be=(D?"0":" ")+be;l<97&&(be=be.toUpperCase()),be.split("").forEach(function(Gt){s.push(Gt.charCodeAt(0))});break}case"s":{var nt=r("i8*"),dt=nt?_strlen(nt):6;if(N&&(dt=Math.min(dt,H)),!m)for(;dt<w--;)s.push(32);if(nt)for(var Te=0;Te<dt;Te++)s.push(HEAPU8[nt++>>0]);else s=s.concat(intArrayFromString("(null)".substr(0,dt),!0));if(m)for(;dt<w--;)s.push(32);break}case"c":{for(m&&s.push(r("i8"));--w>0;)s.push(32);m||s.push(r("i8"));break}case"n":{var Mt=r("i32*");HEAP32[Mt>>2]=s.length;break}case"%":{s.push(a);break}default:for(var Te=c;Te<t+2;Te++)s.push(HEAP8[Te>>0])}t+=2}else s.push(a),t+=1}return s}function _fprintf(o,e,t){var n=__formatString(e,t),r=Runtime.stackSave(),s=_fwrite(allocate(n,"i8",ALLOC_STACK),1,n.length,o);return Runtime.stackRestore(r),s}function _printf(o,e){var t=__formatString(o,e),n=intArrayToString(t);return n[n.length-1]===`
`&&(n=n.substr(0,n.length-1)),Module.print(n),t.length}function _pthread_once(o,e){_pthread_once.seen||(_pthread_once.seen={}),!(o in _pthread_once.seen)&&(Runtime.dynCall("v",e),_pthread_once.seen[o]=1)}function _fputc(o,e){var t=unSign(o&255);HEAP8[_fputc.ret>>0]=t;var n=_fileno(e),r=_write(n,_fputc.ret,1);if(r==-1){var s=FS.getStreamFromPtr(e);return s&&(s.error=!0),-1}else return t}var PTHREAD_SPECIFIC={};function _pthread_getspecific(o){return PTHREAD_SPECIFIC[o]||0}Module._i64Add=_i64Add;function _fputs(o,e){var t=_fileno(e);return _write(t,o,_strlen(o))}allocate(1,"i32*",ALLOC_STATIC);function _puts(o){var e=Pointer_stringify(o),t=e.substr(0);return t[t.length-1]===`
`&&(t=t.substr(0,t.length-1)),Module.print(t),e.length}function _pthread_setspecific(o,e){return o in PTHREAD_SPECIFIC?(PTHREAD_SPECIFIC[o]=e,0):ERRNO_CODES.EINVAL}function __exit(o){Module.exit(o)}function _exit(o){__exit(o)}function _malloc(o){var e=Runtime.dynamicAlloc(o+8);return e+8&4294967288}Module._malloc=_malloc;function ___cxa_allocate_exception(o){return _malloc(o)}function _fmod(o,e){return o%e}function _fmodl(){return _fmod.apply(null,arguments)}Module._bitshift64Lshr=_bitshift64Lshr;function ___cxa_pure_virtual(){throw ABORT=!0,"Pure virtual function called!"}function _time(o){var e=Date.now()/1e3|0;return o&&(HEAP32[o>>2]=e),e}var PTHREAD_SPECIFIC_NEXT_KEY=1;function _pthread_key_create(o,e){return o==0?ERRNO_CODES.EINVAL:(HEAP32[o>>2]=PTHREAD_SPECIFIC_NEXT_KEY,PTHREAD_SPECIFIC[PTHREAD_SPECIFIC_NEXT_KEY]=0,PTHREAD_SPECIFIC_NEXT_KEY++,0)}function ___cxa_guard_acquire(o){return HEAP8[o>>0]?0:(HEAP8[o>>0]=1,1)}function ___cxa_guard_release(){}function _vfprintf(o,e,t){return _fprintf(o,e,HEAP32[t>>2])}function ___cxa_begin_catch(o){return __ZSt18uncaught_exceptionv.uncaught_exception--,EXCEPTIONS.caught.push(o),EXCEPTIONS.addRef(EXCEPTIONS.deAdjust(o)),o}function _emscripten_memcpy_big(o,e,t){return HEAPU8.set(HEAPU8.subarray(e,e+t),o),o}Module._memcpy=_memcpy;var _llvm_pow_f64=Math_pow;function _sbrk(o){var e=_sbrk;e.called||(DYNAMICTOP=alignMemoryPage(DYNAMICTOP),e.called=!0,assert(Runtime.dynamicAlloc),e.alloc=Runtime.dynamicAlloc,Runtime.dynamicAlloc=function(){abort("cannot dynamically allocate, sbrk now has control")});var t=DYNAMICTOP;return o!=0&&e.alloc(o),t}var _fabs=Math_abs;function ___errno_location(){return ___errno_state}function _copysign(o,e){return __reallyNegative(o)===__reallyNegative(e)?o:-o}function _copysignl(){return _copysign.apply(null,arguments)}var ___dso_handle=allocate(1,"i32*",ALLOC_STATIC),_stderr=allocate(1,"i32*",ALLOC_STATIC);___errno_state=Runtime.staticAlloc(4),HEAP32[___errno_state>>2]=0,_fputc.ret=allocate([0],"i8",ALLOC_STATIC),STACK_BASE=STACKTOP=Runtime.alignMemory(STATICTOP),STACK_MAX=STACK_BASE+TOTAL_STACK,DYNAMIC_BASE=DYNAMICTOP=Runtime.alignMemory(STACK_MAX),assert(DYNAMIC_BASE<TOTAL_MEMORY,"TOTAL_MEMORY not big enough for stack");var ctlz_i8=allocate([8,7,6,6,5,5,5,5,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"i8",ALLOC_DYNAMIC),cttz_i8=allocate([8,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,6,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,7,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,6,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0],"i8",ALLOC_DYNAMIC);function invoke_iiii(o,e,t,n){try{return Module.dynCall_iiii(o,e,t,n)}catch(r){if(typeof r!="number"&&r!=="longjmp")throw r;asm.setThrew(1,0)}}function invoke_viiiii(o,e,t,n,r,s){try{Module.dynCall_viiiii(o,e,t,n,r,s)}catch(a){if(typeof a!="number"&&a!=="longjmp")throw a;asm.setThrew(1,0)}}function invoke_vi(o,e){try{Module.dynCall_vi(o,e)}catch(t){if(typeof t!="number"&&t!=="longjmp")throw t;asm.setThrew(1,0)}}function invoke_vii(o,e,t){try{Module.dynCall_vii(o,e,t)}catch(n){if(typeof n!="number"&&n!=="longjmp")throw n;asm.setThrew(1,0)}}function invoke_ii(o,e){try{return Module.dynCall_ii(o,e)}catch(t){if(typeof t!="number"&&t!=="longjmp")throw t;asm.setThrew(1,0)}}function invoke_v(o){try{Module.dynCall_v(o)}catch(e){if(typeof e!="number"&&e!=="longjmp")throw e;asm.setThrew(1,0)}}function invoke_viiiiii(o,e,t,n,r,s,a){try{Module.dynCall_viiiiii(o,e,t,n,r,s,a)}catch(l){if(typeof l!="number"&&l!=="longjmp")throw l;asm.setThrew(1,0)}}function invoke_iii(o,e,t){try{return Module.dynCall_iii(o,e,t)}catch(n){if(typeof n!="number"&&n!=="longjmp")throw n;asm.setThrew(1,0)}}function invoke_viiii(o,e,t,n,r){try{Module.dynCall_viiii(o,e,t,n,r)}catch(s){if(typeof s!="number"&&s!=="longjmp")throw s;asm.setThrew(1,0)}}Module.asmGlobalArg={Math,Int8Array,Int16Array,Int32Array,Uint8Array,Uint16Array,Uint32Array,Float32Array,Float64Array},Module.asmLibraryArg={abort,assert,min:Math_min,invoke_iiii,invoke_viiiii,invoke_vi,invoke_vii,invoke_ii,invoke_v,invoke_viiiiii,invoke_iii,invoke_viiii,_fabs,_llvm_pow_f64,_send,_fmod,___cxa_guard_acquire,___setErrNo,_vfprintf,___cxa_allocate_exception,___cxa_find_matching_catch,___cxa_guard_release,_pwrite,__reallyNegative,_sbrk,___cxa_begin_catch,_emscripten_memcpy_big,_fileno,___resumeException,__ZSt18uncaught_exceptionv,_sysconf,_pthread_getspecific,_atexit,_pthread_once,_puts,_printf,_pthread_key_create,_write,___errno_location,_pthread_setspecific,___cxa_atexit,_copysign,_fputc,___cxa_throw,__exit,_copysignl,_abort,_fwrite,_time,_fprintf,__formatString,_fputs,_exit,___cxa_pure_virtual,_fmodl,STACKTOP,STACK_MAX,tempDoublePtr,ABORT,cttz_i8,ctlz_i8,NaN:NaN,Infinity:1/0,___dso_handle,_stderr};var asm=function(o,e,t){var n=new o.Int8Array(t),r=new o.Int16Array(t),s=new o.Int32Array(t),a=new o.Uint8Array(t),l=new o.Uint16Array(t),d=new o.Uint32Array(t),c=new o.Float32Array(t),y=new o.Float64Array(t),m=e.STACKTOP|0,O=e.STACK_MAX|0,D=e.tempDoublePtr|0,z=e.ABORT|0,w=e.cttz_i8|0,N=e.ctlz_i8|0,H=e.___dso_handle|0,X=e._stderr|0,ae=0,oe=0,ue=0,fe=0,be=+e.NaN,Ae=+e.Infinity,W=0,J=0,Ue=0,gt=0,Te=0,Et=0,Bt=0,Ke=0,At=0,nt=0,dt=0,Mt=0,zt=0,xt=0,Gt=0,yi=0,ti=0,Mi=0,Li=0,qi=o.Math.floor,Pi=o.Math.abs,Oi=o.Math.sqrt,$t=o.Math.pow,Rs=o.Math.cos,is=o.Math.sin,hs=o.Math.tan,qs=o.Math.acos,q=o.Math.asin,Re=o.Math.atan,He=o.Math.atan2,Ze=o.Math.exp,Xe=o.Math.log,Pe=o.Math.ceil,Le=o.Math.imul,De=e.abort,ct=e.assert,h=e.min,f=e.invoke_iiii,b=e.invoke_viiiii,L=e.invoke_vi,I=e.invoke_vii,B=e.invoke_ii,j=e.invoke_v,Y=e.invoke_viiiiii,Z=e.invoke_iii,ie=e.invoke_viiii,pe=e._fabs,me=e._llvm_pow_f64,de=e._send,le=e._fmod,we=e.___cxa_guard_acquire,Ve=e.___setErrNo,ke=e._vfprintf,ye=e.___cxa_allocate_exception,xe=e.___cxa_find_matching_catch,ce=e.___cxa_guard_release,Se=e._pwrite,Ie=e.__reallyNegative,Me=e._sbrk,ze=e.___cxa_begin_catch,Ge=e._emscripten_memcpy_big,We=e._fileno,je=e.___resumeException,rt=e.__ZSt18uncaught_exceptionv,Je=e._sysconf,lt=e._pthread_getspecific,ht=e._atexit,_t=e._pthread_once,bt=e._puts,Tt=e._printf,Jt=e._pthread_key_create,ii=e._write,Rt=e.___errno_location,Si=e._pthread_setspecific,bi=e.___cxa_atexit,_i=e._copysign,mi=e._fputc,Yt=e.___cxa_throw,Ti=e.__exit,os=e._copysignl,St=e._abort,Wi=e._fwrite,zi=e._time,Di=e._fprintf,$s=e.__formatString,Js=e._fputs,ks=e._exit,Vs=e.___cxa_pure_virtual,Ji=e._fmodl,Es=0;function gn(u){u=u|0;var A=0;return A=m,m=m+u|0,m=m+15&-16,A|0}function Us(){return m|0}function qn(u){u=u|0,m=u}function mr(u,A){u=u|0,A=A|0,ae||(ae=u,oe=A)}function Hn(u){u=u|0,n[D>>0]=n[u>>0],n[D+1>>0]=n[u+1>>0],n[D+2>>0]=n[u+2>>0],n[D+3>>0]=n[u+3>>0]}function nr(u){u=u|0,n[D>>0]=n[u>>0],n[D+1>>0]=n[u+1>>0],n[D+2>>0]=n[u+2>>0],n[D+3>>0]=n[u+3>>0],n[D+4>>0]=n[u+4>>0],n[D+5>>0]=n[u+5>>0],n[D+6>>0]=n[u+6>>0],n[D+7>>0]=n[u+7>>0]}function sn(u){u=u|0,nt=u}function mn(){return nt|0}function yr(u){u=u|0,ze(u|0)|0,Ft()}function yn(u){u=u|0}function Os(u,A,T,E,V){u=u|0,A=A|0,T=T|0,E=E|0,V=V|0;var M=0;if(M=m,s[u>>2]=112,s[u+4>>2]=A,s[u+8>>2]=T,s[u+12>>2]=E,s[u+16>>2]=V,!(n[144]|0)&&we(144)|0&&(s[32]=0,s[33]=0,s[34]=0,bi(19,128,H|0)|0,ce(144)),V=s[33]|0,(V|0)==(s[34]|0)&&(E=(V>>1)+2&-2,E=(E|0)<2?2:E,(E|0)>(2147483647-V|0)&&(A=ye(1)|0,Yt(A|0,48,0)),T=s[32]|0,A=E+V|0,s[34]=A,A=ps(T,A<<2)|0,s[32]=A,!(A|0)&&(s[(Rt()|0)>>2]|0)==12&&(A=ye(1)|0,Yt(A|0,48,0)),V=s[33]|0),s[33]=V+1,V=(s[32]|0)+(V<<2)|0,!V){m=M;return}s[V>>2]=u,m=M}function Da(u){u=u|0;var A=0;A=m,tt(u),m=A}function bo(u){u=u|0;var A=0,T=0;if(A=m,T=s[u>>2]|0,!T){m=A;return}s[u+4>>2]=0,di(T),s[u>>2]=0,s[u+8>>2]=0,m=A}function xa(u){u=u|0;var A=0;A=m,tt(u),m=A}function Yo(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0;if(T=m,(n[A>>0]|0)!=45)return F=0,m=T,F|0;for(E=A+1|0,V=110,x=E,F=0;;){if(M=F+1|0,(n[x>>0]|0)!=V<<24>>24){V=1;break}if(x=A+(F+2)|0,(M|0)==3){V=0,E=x;break}else V=n[264+M>>0]|0,F=M}return eh(E,s[u+4>>2]|0)|0?(F=0,m=T,F|0):(n[u+20>>0]=V,F=1,m=T,F|0)}function sl(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0;for(M=m,m=m+16|0,T=M,E=s[X>>2]|0,V=u+4|0,x=s[V>>2]|0,s[T>>2]=x,s[T+4>>2]=x,Di(E|0,216,T|0)|0,x=0;F=x>>>0<(32-((ca(s[V>>2]|0)|0)<<1)|0)>>>0,mi(32,E|0)|0,F;)x=x+1|0;if(s[T>>2]=n[u+20>>0]|0?248:256,Di(E|0,232,T|0)|0,!A){m=M;return}s[T>>2]=s[u+8>>2],Di(E|0,88,T|0)|0,mi(10,E|0)|0,m=M}function Ia(u){u=u|0;var A=0;A=m,tt(u),m=A}function So(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0;if(T=m,m=m+16|0,M=T,V=T+8|0,(n[A>>0]|0)!=45)return U=0,m=T,U|0;K=A+1|0,E=u+4|0,x=s[E>>2]|0,F=n[x>>0]|0;e:do if(F<<24>>24){for(R=0;;){if(U=R,R=R+1|0,(n[K>>0]|0)!=F<<24>>24){u=0;break}if(F=n[x+R>>0]|0,K=A+(U+2)|0,!(F<<24>>24))break e}return m=T,u|0}while(!1);return(n[K>>0]|0)!=61||(A=K+1|0,x=qa(A,V,10)|0,!(s[V>>2]|0))?(U=0,m=T,U|0):((x|0)>(s[u+24>>2]|0)&&(U=s[X>>2]|0,R=s[E>>2]|0,s[M>>2]=A,s[M+4>>2]=R,Di(U|0,416,M|0)|0,ks(1)),(x|0)<(s[u+20>>2]|0)&&(U=s[X>>2]|0,R=s[E>>2]|0,s[M>>2]=A,s[M+4>>2]=R,Di(U|0,472,M|0)|0,ks(1)),s[u+28>>2]=x,U=1,m=T,U|0)}function Ko(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0;if(T=m,m=m+16|0,E=T,V=s[X>>2]|0,M=s[u+16>>2]|0,s[E>>2]=s[u+4>>2],s[E+4>>2]=M,Di(V|0,336,E|0)|0,M=s[u+20>>2]|0,(M|0)==-2147483648?Wi(360,4,1,V|0)|0:(s[E>>2]=M,Di(V|0,368,E|0)|0),Wi(376,4,1,V|0)|0,M=s[u+24>>2]|0,(M|0)==2147483647?Wi(384,4,1,V|0)|0:(s[E>>2]=M,Di(V|0,368,E|0)|0),s[E>>2]=s[u+28>>2],Di(V|0,392,E|0)|0,!A){m=T;return}s[E>>2]=s[u+8>>2],Di(V|0,88,E|0)|0,mi(10,V|0)|0,m=T}function Ur(u){u=u|0;var A=0,T=0,E=0,V=0,M=0;V=m,s[u>>2]=1816,E=u+4|0,T=u+32|0,M=u+48|0,s[E+0>>2]=0,s[E+4>>2]=0,s[E+8>>2]=0,s[E+12>>2]=0,s[E+16>>2]=0,s[E+20>>2]=0,s[T+0>>2]=0,s[T+4>>2]=0,s[T+8>>2]=0,s[T+12>>2]=0,y[M>>3]=+y[75],y[u+56>>3]=+y[89],y[u+64>>3]=+y[103],y[u+72>>3]=+y[123],n[u+80>>0]=n[1364]|0,s[u+84>>2]=s[269],s[u+88>>2]=s[297],n[u+92>>0]=0,n[u+93>>0]=n[1292]|0,y[u+96>>3]=+y[204],s[u+104>>2]=s[439],s[u+108>>2]=s[359],y[u+112>>3]=+y[191],y[u+120>>3]=.3333333333333333,y[u+128>>3]=1.1,s[u+136>>2]=100,y[u+144>>3]=1.5,M=u+316|0,s[u+332>>2]=0,s[u+336>>2]=0,s[u+340>>2]=0,s[u+348>>2]=0,s[u+352>>2]=0,s[u+356>>2]=0,s[u+364>>2]=0,s[u+368>>2]=0,s[u+372>>2]=0,s[u+380>>2]=0,s[u+384>>2]=0,s[u+388>>2]=0,s[u+396>>2]=0,s[u+400>>2]=0,s[u+404>>2]=0,T=u+544|0,s[u+412>>2]=0,s[u+416>>2]=0,s[u+420>>2]=0,s[u+428>>2]=0,s[u+432>>2]=0,s[u+436>>2]=0,s[u+444>>2]=0,s[u+448>>2]=0,s[u+452>>2]=0,Ha(u+152|0,0,176)|0,s[u+456>>2]=T,E=u+460|0,s[E+0>>2]=0,s[E+4>>2]=0,s[E+8>>2]=0,s[E+12>>2]=0,s[E+16>>2]=0,s[E+20>>2]=0,s[u+488>>2]=M,n[u+492>>0]=1,y[u+496>>3]=1,y[u+504>>3]=1,s[u+512>>2]=0,s[u+516>>2]=-1,M=u+520|0,E=u+536|0,s[M+0>>2]=0,s[M+4>>2]=0,s[M+8>>2]=0,s[M+12>>2]=0,n[E>>0]=1,E=u+540|0,s[E+0>>2]=0,s[E+4>>2]=0,s[E+8>>2]=0,s[E+12>>2]=0,s[E+16>>2]=0,Gi(T,1048576),n[u+560>>0]=0,T=u+604|0,E=u+664|0,M=u+564|0,A=M+36|0;do s[M>>2]=0,M=M+4|0;while((M|0)<(A|0));M=T+0|0,A=M+36|0;do s[M>>2]=0,M=M+4|0;while((M|0)<(A|0));M=u+680|0,s[E+0>>2]=-1,s[E+4>>2]=-1,s[E+8>>2]=-1,s[E+12>>2]=-1,n[M>>0]=0,m=V}function Ao(u){u=u|0;var A=0;A=m,ro(u),tt(u),m=A}function ro(u){u=u|0;var A=0,T=0,E=0;if(A=m,s[u>>2]=1816,T=u+628|0,E=s[T>>2]|0,E&&(s[u+632>>2]=0,di(E),s[T>>2]=0,s[u+636>>2]=0),T=u+616|0,E=s[T>>2]|0,E&&(s[u+620>>2]=0,di(E),s[T>>2]=0,s[u+624>>2]=0),T=u+604|0,E=s[T>>2]|0,E&&(s[u+608>>2]=0,di(E),s[T>>2]=0,s[u+612>>2]=0),T=u+588|0,E=s[T>>2]|0,E&&(s[u+592>>2]=0,di(E),s[T>>2]=0,s[u+596>>2]=0),T=u+576|0,E=s[T>>2]|0,E&&(s[u+580>>2]=0,di(E),s[T>>2]=0,s[u+584>>2]=0),T=u+564|0,E=s[T>>2]|0,E&&(s[u+568>>2]=0,di(E),s[T>>2]=0,s[u+572>>2]=0),T=s[u+544>>2]|0,T&&di(T),T=u+472|0,E=s[T>>2]|0,E&&(s[u+476>>2]=0,di(E),s[T>>2]=0,s[u+480>>2]=0),T=u+460|0,E=s[T>>2]|0,E&&(s[u+464>>2]=0,di(E),s[T>>2]=0,s[u+468>>2]=0),Cs(u+412|0),T=u+396|0,E=s[T>>2]|0,E&&(s[u+400>>2]=0,di(E),s[T>>2]=0,s[u+404>>2]=0),T=u+380|0,E=s[T>>2]|0,E&&(s[u+384>>2]=0,di(E),s[T>>2]=0,s[u+388>>2]=0),E=u+364|0,T=s[E>>2]|0,T&&(s[u+368>>2]=0,di(T),s[E>>2]=0,s[u+372>>2]=0),T=u+348|0,E=s[T>>2]|0,E&&(s[u+352>>2]=0,di(E),s[T>>2]=0,s[u+356>>2]=0),T=u+332|0,E=s[T>>2]|0,E&&(s[u+336>>2]=0,di(E),s[T>>2]=0,s[u+340>>2]=0),T=u+316|0,E=s[T>>2]|0,E&&(s[u+320>>2]=0,di(E),s[T>>2]=0,s[u+324>>2]=0),T=u+304|0,E=s[T>>2]|0,E&&(s[u+308>>2]=0,di(E),s[T>>2]=0,s[u+312>>2]=0),T=u+292|0,E=s[T>>2]|0,E&&(s[u+296>>2]=0,di(E),s[T>>2]=0,s[u+300>>2]=0),T=u+280|0,E=s[T>>2]|0,E&&(s[u+284>>2]=0,di(E),s[T>>2]=0,s[u+288>>2]=0),T=u+268|0,E=s[T>>2]|0,E&&(s[u+272>>2]=0,di(E),s[T>>2]=0,s[u+276>>2]=0),T=u+256|0,E=s[T>>2]|0,E&&(s[u+260>>2]=0,di(E),s[T>>2]=0,s[u+264>>2]=0),T=u+32|0,E=s[T>>2]|0,E&&(s[u+36>>2]=0,di(E),s[T>>2]=0,s[u+40>>2]=0),T=u+16|0,E=s[T>>2]|0,E&&(s[u+20>>2]=0,di(E),s[T>>2]=0,s[u+24>>2]=0),E=u+4|0,T=s[E>>2]|0,!T){m=A;return}s[u+8>>2]=0,di(T),s[E>>2]=0,s[u+12>>2]=0,m=A}function wo(u,A,T){u=u|0,A=A|0,T=T|0;var E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0;if(E=m,m=m+16|0,x=E+4|0,M=E,V=u+580|0,K=s[V>>2]|0,(K|0)>0?(U=K+-1|0,te=s[(s[u+576>>2]|0)+(U<<2)>>2]|0,s[V>>2]=U,V=te):(te=u+540|0,V=s[te>>2]|0,s[te>>2]=V+1),K=u+412|0,te=V<<1,s[x>>2]=te,En(K,x),s[M>>2]=te|1,En(K,M),x=u+332|0,K=n[544]|0,M=V+1|0,as(x,M),n[(s[x>>2]|0)+V>>0]=K,x=u+396|0,K=u+400|0,(s[K>>2]|0)<(M|0)){if(U=u+404|0,te=s[U>>2]|0,(te|0)<(M|0)&&(ne=V+2-te&-2,R=(te>>1)+2&-2,R=(ne|0)>(R|0)?ne:R,(R|0)>(2147483647-te|0)&&(ne=ye(1)|0,Yt(ne|0,48,0)),ee=s[x>>2]|0,ne=R+te|0,s[U>>2]=ne,ne=ps(ee,ne<<3)|0,s[x>>2]=ne,!(ne|0)&&(s[(Rt()|0)>>2]|0)==12&&(ee=ye(1)|0,Yt(ee|0,48,0))),U=s[K>>2]|0,(U|0)<(M|0))do R=(s[x>>2]|0)+(U<<3)|0,R&&(ee=R,s[ee>>2]=0,s[ee+4>>2]=0),U=U+1|0;while((U|0)!=(M|0));s[K>>2]=M}if(K=(s[x>>2]|0)+(V<<3)|0,s[K>>2]=-1,s[K+4>>2]=0,K=u+316|0,n[u+93>>0]|0?(ee=u+72|0,F=+y[ee>>3]*1389796,F=F-+(~~(F/2147483647)|0)*2147483647,y[ee>>3]=F,F=F/2147483647*1e-5):F=0,x=u+320|0,(s[x>>2]|0)<(M|0)){if(R=u+324|0,U=s[R>>2]|0,(U|0)<(M|0)&&(ee=V+2-U&-2,te=(U>>1)+2&-2,te=(ee|0)>(te|0)?ee:te,(te|0)>(2147483647-U|0)&&(ee=ye(1)|0,Yt(ee|0,48,0)),ne=s[K>>2]|0,ee=te+U|0,s[R>>2]=ee,ee=ps(ne,ee<<3)|0,s[K>>2]=ee,!(ee|0)&&(s[(Rt()|0)>>2]|0)==12&&(ee=ye(1)|0,Yt(ee|0,48,0))),te=s[x>>2]|0,(te|0)<(M|0)){R=s[K>>2]|0;do U=R+(te<<3)|0,U&&(y[U>>3]=0),te=te+1|0;while((te|0)!=(M|0))}s[x>>2]=M}if(y[(s[K>>2]|0)+(V<<3)>>3]=F,ss(u+588|0,V,0),ss(u+348|0,V,1),x=u+364|0,A=n[A>>0]|0,as(x,M),n[(s[x>>2]|0)+V>>0]=A,x=u+380|0,A=u+384|0,(s[A>>2]|0)<(M|0)){if(K=u+388|0,U=s[K>>2]|0,(U|0)<(M|0)&&(ee=V+2-U&-2,R=(U>>1)+2&-2,R=(ee|0)>(R|0)?ee:R,(R|0)>(2147483647-U|0)&&(ee=ye(1)|0,Yt(ee|0,48,0)),ne=s[x>>2]|0,ee=R+U|0,s[K>>2]=ee,ee=ps(ne,ee)|0,s[x>>2]=ee,!(ee|0)&&(s[(Rt()|0)>>2]|0)==12&&(ee=ye(1)|0,Yt(ee|0,48,0))),K=s[A>>2]|0,(K|0)<(M|0))do R=(s[x>>2]|0)+K|0,R&&(n[R>>0]=0),K=K+1|0;while((K|0)!=(M|0));s[A>>2]=M}return A=u+288|0,x=s[A>>2]|0,(x|0)<(M|0)&&(ee=V+2-x&-2,M=(x>>1)+2&-2,M=(ee|0)>(M|0)?ee:M,(M|0)>(2147483647-x|0)&&(ee=ye(1)|0,Yt(ee|0,48,0)),ne=u+280|0,te=s[ne>>2]|0,ee=M+x|0,s[A>>2]=ee,ee=ps(te,ee<<2)|0,s[ne>>2]=ee,!(ee|0)&&(s[(Rt()|0)>>2]|0)==12&&(ee=ye(1)|0,Yt(ee|0,48,0))),M=u+380|0,A=(s[M>>2]|0)+V|0,x=(n[A>>0]|0)==0,T?x&&(ee=u+200|0,ne=ee,ne=Xi(s[ne>>2]|0,s[ne+4>>2]|0,1,0)|0,s[ee>>2]=ne,s[ee+4>>2]=nt):x||(ee=u+200|0,ne=ee,ne=Xi(s[ne>>2]|0,s[ne+4>>2]|0,-1,-1)|0,s[ee>>2]=ne,s[ee+4>>2]=nt),n[A>>0]=T&1,T=u+460|0,(s[u+476>>2]|0)>(V|0)&&(s[(s[u+472>>2]|0)+(V<<2)>>2]|0)>-1||!(n[(s[M>>2]|0)+V>>0]|0)?(m=E,V|0):(xi(T,V),m=E,V|0)}function Va(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0,_e=0,ge=0,Oe=0;if(T=m,m=m+16|0,x=T+1|0,M=T,E=u+492|0,!(n[E>>0]|0))return _e=0,m=T,_e|0;_e=s[A>>2]|0,V=A+4|0,F=s[V>>2]|0,n[x+0>>0]=n[M+0>>0]|0,Ps(_e,F,x),F=s[V>>2]|0;e:do if((F|0)>0){for(x=u+332|0,M=n[528]|0,K=0,R=0,te=-2;;){if(_e=s[A>>2]|0,U=s[_e+(K<<2)>>2]|0,ee=a[(s[x>>2]|0)+(U>>1)>>0]|0,ge=ee^U&1,ne=ge&255,Oe=M&255,(U|0)==(te^1|0)||ne<<24>>24==M<<24>>24&(Oe>>>1^1)|Oe&2&ge|0){u=1;break}if(ge=n[536]|0,Oe=ge&255,(U|0)!=(te|0)&&!((Oe>>>1^1)&ne<<24>>24==ge<<24>>24|ee&2&Oe|0)?(s[_e+(R<<2)>>2]=U,F=s[V>>2]|0,R=R+1|0):U=te,K=K+1|0,(K|0)<(F|0))te=U;else break e}return m=T,u|0}else K=0,R=0;while(!1);return M=K-R|0,(M|0)>0&&(F=F-M|0,s[V>>2]=F),F?(F|0)==1?(ge=s[s[A>>2]>>2]|0,_e=ge>>1,n[(s[u+332>>2]|0)+_e>>0]=(ge&1^1)&255^1,Oe=s[u+296>>2]|0,_e=(s[u+396>>2]|0)+(_e<<3)|0,s[_e>>2]=-1,s[_e+4>>2]=Oe,_e=u+284|0,Oe=s[_e>>2]|0,s[_e>>2]=Oe+1,s[(s[u+280>>2]|0)+(Oe<<2)>>2]=ge,Oe=(vr(u)|0)==-1,n[E>>0]=Oe&1,m=T,Oe|0):(A=Ns(u+544|0,A,0)|0,V=u+256|0,E=u+260|0,x=s[E>>2]|0,M=u+264|0,(x|0)==(s[M>>2]|0)&&(F=(x>>1)+2&-2,F=(F|0)<2?2:F,(F|0)>(2147483647-x|0)&&(Oe=ye(1)|0,Yt(Oe|0,48,0)),ge=s[V>>2]|0,Oe=F+x|0,s[M>>2]=Oe,Oe=ps(ge,Oe<<2)|0,s[V>>2]=Oe,!(Oe|0)&&(s[(Rt()|0)>>2]|0)==12&&(Oe=ye(1)|0,Yt(Oe|0,48,0)),x=s[E>>2]|0),s[E>>2]=x+1,E=(s[V>>2]|0)+(x<<2)|0,E&&(s[E>>2]=A),Gr(u,A),Oe=1,m=T,Oe|0):(n[E>>0]=0,Oe=0,m=T,Oe|0)}function _r(u,A,T){u=u|0,A=A|0,T=T|0;var E=0,V=0;E=s[A>>2]|0,A=E>>1,n[(s[u+332>>2]|0)+A>>0]=(E&1^1)&255^1,V=s[u+296>>2]|0,A=(s[u+396>>2]|0)+(A<<3)|0,s[A>>2]=T,s[A+4>>2]=V,T=u+284|0,A=s[T>>2]|0,s[T>>2]=A+1,s[(s[u+280>>2]|0)+(A<<2)>>2]=E}function vr(u){u=u|0;var A=0,T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0,_e=0,ge=0,Oe=0,$e=0,Ye=0,it=0,Dt=0,ni=0,ei=0,at=0,Ht=0,Zt=0,kt=0,Xt=0,It=0,Nt=0,Ot=0,st=0,ai=0,fi=0,ui=0,gi=0,Vi=0;if(x=m,m=m+16|0,ee=x,V=u+512|0,ge=s[V>>2]|0,ne=u+284|0,(ge|0)>=(s[ne>>2]|0))return fi=0,st=0,gi=-1,ui=u+184|0,Nt=ui,ai=Nt,ai=s[ai>>2]|0,Nt=Nt+4|0,Nt=s[Nt>>2]|0,Nt=Xi(ai|0,Nt|0,fi|0,st|0)|0,ai=nt,Ot=ui,s[Ot>>2]=Nt,ui=ui+4|0,s[ui>>2]=ai,ui=u+520|0,ai=ui,Ot=ai,Ot=s[Ot>>2]|0,ai=ai+4|0,ai=s[ai>>2]|0,st=un(Ot|0,ai|0,fi|0,st|0)|0,fi=nt,ai=ui,s[ai>>2]=st,ui=ui+4|0,s[ui>>2]=fi,m=x,gi|0;U=u+280|0,M=u+428|0,E=u+412|0,F=u+332|0,K=u+544|0,R=ee+4|0,A=u+396|0,te=u+296|0,T=u+456|0,ni=-1,_e=0;do{if(s[V>>2]=ge+1,Ye=s[(s[U>>2]|0)+(ge<<2)>>2]|0,n[(s[M>>2]|0)+Ye>>0]|0){if(Oe=s[E>>2]|0,ge=Oe+(Ye*12|0)+4|0,Dt=s[ge>>2]|0,(Dt|0)>0){Oe=Oe+(Ye*12|0)|0,$e=0,it=0;do at=s[Oe>>2]|0,ei=at+($e<<3)|0,(s[(s[s[T>>2]>>2]|0)+(s[ei>>2]<<2)>>2]&3|0)!=1&&(ui=ei,gi=s[ui+4>>2]|0,Dt=at+(it<<3)|0,s[Dt>>2]=s[ui>>2],s[Dt+4>>2]=gi,Dt=s[ge>>2]|0,it=it+1|0),$e=$e+1|0;while(($e|0)<(Dt|0))}else $e=0,it=0;Oe=$e-it|0,(Oe|0)>0&&(s[ge>>2]=Dt-Oe),n[(s[M>>2]|0)+Ye>>0]=0}ge=s[E>>2]|0,_e=_e+1|0,Oe=s[ge+(Ye*12|0)>>2]|0,ge=ge+(Ye*12|0)+4|0,it=s[ge>>2]|0,$e=Oe+(it<<3)|0;e:do if(!it)$e=Oe,Dt=Oe;else for(Ye=Ye^1,it=(it<<3)+-1|0,at=Oe,Dt=Oe;;){for(;;){t:for(;;){if(It=s[at+4>>2]|0,gi=a[(s[F>>2]|0)+(It>>1)>>0]^It&1,Ot=n[528]|0,Nt=Ot&255,st=Nt&2,Nt=Nt>>>1^1,(gi&255)<<24>>24==Ot<<24>>24&Nt|st&gi){kt=19;break}if(ei=s[at>>2]|0,kt=s[K>>2]|0,Xt=kt+(ei<<2)|0,Ht=kt+(ei+1<<2)|0,Zt=s[Ht>>2]|0,(Zt|0)==(Ye|0)&&(gi=kt+(ei+2<<2)|0,Zt=s[gi>>2]|0,s[Ht>>2]=Zt,s[gi>>2]=Ye),Ht=at+8|0,s[ee>>2]=ei,s[R>>2]=Zt,(Zt|0)!=(It|0)&&(gi=a[(s[F>>2]|0)+(Zt>>1)>>0]^Zt&1,((gi&255)<<24>>24==Ot<<24>>24&Nt|st&gi|0)!=0)){kt=27;break}if(st=s[Xt>>2]|0,st>>>0<=95){kt=31;break}for(Nt=s[F>>2]|0,Ot=n[536]|0,It=Ot&255,gi=It&2,It=It>>>1^1,ui=2;ai=Xt+(ui<<2)+4|0,fi=s[ai>>2]|0,Vi=a[Nt+(fi>>1)>>0]^fi&1,ui=ui+1|0,!!((Vi&255)<<24>>24==Ot<<24>>24&It|gi&Vi);)if((ui|0)>=(st>>>5|0)){kt=32;break t}if(Vi=kt+(ei+2<<2)|0,s[Vi>>2]=fi,s[ai>>2]=Ye,br((s[E>>2]|0)+((s[Vi>>2]^1)*12|0)|0,ee),(Ht|0)==($e|0))break e;at=Ht}if((kt|0)==19?(kt=0,ui=at,gi=s[ui+4>>2]|0,Vi=Dt,s[Vi>>2]=s[ui>>2],s[Vi+4>>2]=gi,at=at+8|0,Dt=Dt+8|0):(kt|0)==27?(kt=0,gi=ee,Vi=s[gi+4>>2]|0,at=Dt,s[at>>2]=s[gi>>2],s[at+4>>2]=Vi,at=Ht,Dt=Dt+8|0):(kt|0)==31&&(Ot=n[536]|0,kt=32),(kt|0)==32){if(kt=Dt+8|0,Xt=ee,Nt=s[Xt+4>>2]|0,It=Dt,s[It>>2]=s[Xt>>2],s[It+4>>2]=Nt,It=Zt>>1,Nt=Zt&1,Xt=(s[F>>2]|0)+It|0,Vi=a[Xt>>0]^Nt,gi=Ot&255,(Vi&255)<<24>>24==Ot<<24>>24&(gi>>>1^1)|gi&2&Vi)break;n[Xt>>0]=(Nt^1)&255^1,Dt=s[te>>2]|0,at=(s[A>>2]|0)+(It<<3)|0,s[at>>2]=ei,s[at+4>>2]=Dt,at=s[ne>>2]|0,s[ne>>2]=at+1,s[(s[U>>2]|0)+(at<<2)>>2]=Zt,at=Ht,Dt=kt}if((at|0)==($e|0))break e}if(s[V>>2]=s[ne>>2],Ht>>>0<$e>>>0){for(ni=(Oe+(it-Ht)|0)>>>3;ui=Ht,Ht=Ht+8|0,gi=s[ui+4>>2]|0,Vi=kt,s[Vi>>2]=s[ui>>2],s[Vi+4>>2]=gi,!(Ht>>>0>=$e>>>0);)kt=kt+8|0;at=at+(ni+2<<3)|0,Dt=Dt+(ni+2<<3)|0}else at=Ht,Dt=kt;if((at|0)==($e|0)){ni=ei;break}else ni=ei}while(!1);Oe=$e-Dt|0,(Oe|0)>0&&(s[ge>>2]=(s[ge>>2]|0)-(Oe>>3)),ge=s[V>>2]|0}while((ge|0)<(s[ne>>2]|0));return ui=_e,ai=((_e|0)<0)<<31>>31,Vi=ni,gi=u+184|0,Ot=gi,fi=Ot,fi=s[fi>>2]|0,Ot=Ot+4|0,Ot=s[Ot>>2]|0,Ot=Xi(fi|0,Ot|0,ui|0,ai|0)|0,fi=nt,st=gi,s[st>>2]=Ot,gi=gi+4|0,s[gi>>2]=fi,gi=u+520|0,fi=gi,st=fi,st=s[st>>2]|0,fi=fi+4|0,fi=s[fi>>2]|0,ai=un(st|0,fi|0,ui|0,ai|0)|0,ui=nt,fi=gi,s[fi>>2]=ai,gi=gi+4|0,s[gi>>2]=ui,m=x,Vi|0}function Gr(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0;if(T=m,m=m+16|0,K=T+8|0,V=T,M=s[u+544>>2]|0,E=M+(A<<2)|0,x=M+(A+1<<2)|0,F=u+412|0,R=(s[F>>2]|0)+((s[x>>2]^1)*12|0)|0,M=M+(A+2<<2)|0,U=s[M>>2]|0,s[K>>2]=A,s[K+4>>2]=U,br(R,K),M=(s[F>>2]|0)+((s[M>>2]^1)*12|0)|0,x=s[x>>2]|0,s[V>>2]=A,s[V+4>>2]=x,br(M,V),s[E>>2]&4){U=u+216|0,R=U,R=Xi(s[R>>2]|0,s[R+4>>2]|0,1,0)|0,s[U>>2]=R,s[U+4>>2]=nt,U=u+232|0,R=U,R=Xi((s[E>>2]|0)>>>5|0,0,s[R>>2]|0,s[R+4>>2]|0)|0,s[U>>2]=R,s[U+4>>2]=nt,m=T;return}else{U=u+208|0,R=U,R=Xi(s[R>>2]|0,s[R+4>>2]|0,1,0)|0,s[U>>2]=R,s[U+4>>2]=nt,U=u+224|0,R=U,R=Xi((s[E>>2]|0)>>>5|0,0,s[R>>2]|0,s[R+4>>2]|0)|0,s[U>>2]=R,s[U+4>>2]=nt,m=T;return}}function Xo(u,A,T){u=u|0,A=A|0,T=T|0;var E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0;if(V=m,m=m+16|0,K=V+4|0,x=V,M=s[u+544>>2]|0,E=M+(A<<2)|0,F=s[M+(A+1<<2)>>2]^1,!T)s[K>>2]=F,T=u+428|0,R=s[T>>2]|0,F=R+F|0,n[F>>0]|0||(n[F>>0]=1,Hs(u+444|0,K),R=s[T>>2]|0),A=s[M+(A+2<<2)>>2]^1,s[x>>2]=A,A=R+A|0,n[A>>0]|0||(n[A>>0]=1,Hs(u+444|0,x));else{x=u+412|0,T=s[x>>2]|0,K=T+(F*12|0)|0,M=M+(A+2<<2)|0,F=T+(F*12|0)+4|0,R=s[F>>2]|0;e:do if((R|0)>0)for(ne=s[K>>2]|0,te=0;;){if(U=te+1|0,(s[ne+(te<<3)>>2]|0)==(A|0)){U=te;break e}if((U|0)<(R|0))te=U;else break}else U=0;while(!1);if(R=R+-1|0,(U|0)<(R|0)){do T=s[K>>2]|0,R=U,U=U+1|0,te=T+(U<<3)|0,ne=s[te+4>>2]|0,R=T+(R<<3)|0,s[R>>2]=s[te>>2],s[R+4>>2]=ne,R=(s[F>>2]|0)+-1|0;while((U|0)<(R|0));T=s[x>>2]|0}s[F>>2]=R,x=s[M>>2]^1,M=T+(x*12|0)|0,x=T+(x*12|0)+4|0,F=s[x>>2]|0;e:do if((F|0)>0)for(T=s[M>>2]|0,R=0;;){if(K=R+1|0,(s[T+(R<<3)>>2]|0)==(A|0)){K=R;break e}if((K|0)<(F|0))R=K;else break}else K=0;while(!1);if(A=F+-1|0,(K|0)<(A|0))do U=s[M>>2]|0,A=K,K=K+1|0,te=U+(K<<3)|0,ne=s[te+4>>2]|0,A=U+(A<<3)|0,s[A>>2]=s[te>>2],s[A+4>>2]=ne,A=(s[x>>2]|0)+-1|0;while((K|0)<(A|0));s[x>>2]=A}if(s[E>>2]&4){ne=u+216|0,te=ne,te=Xi(s[te>>2]|0,s[te+4>>2]|0,-1,-1)|0,s[ne>>2]=te,s[ne+4>>2]=nt,ne=u+232|0,te=ne,te=un(s[te>>2]|0,s[te+4>>2]|0,(s[E>>2]|0)>>>5|0,0)|0,s[ne>>2]=te,s[ne+4>>2]=nt,m=V;return}else{ne=u+208|0,te=ne,te=Xi(s[te>>2]|0,s[te+4>>2]|0,-1,-1)|0,s[ne>>2]=te,s[ne+4>>2]=nt,ne=u+224|0,te=ne,te=un(s[te>>2]|0,s[te+4>>2]|0,(s[E>>2]|0)>>>5|0,0)|0,s[ne>>2]=te,s[ne+4>>2]=nt,m=V;return}}function Wr(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0;V=m,E=u+544|0,K=s[E>>2]|0,T=K+(A<<2)|0,Xo(u,A,0),K=s[K+(A+1<<2)>>2]|0,M=K>>1,K=(a[(s[u+332>>2]|0)+M>>0]|0)^K&1,U=n[528]|0,R=U&255,(K&255)<<24>>24==U<<24>>24&(R>>>1^1)|R&2&K|0&&(x=(s[u+396>>2]|0)+(M<<3)|0,F=s[x>>2]|0,(F|0)!=-1)&&((s[E>>2]|0)+(F<<2)|0)==(T|0)&&(s[x>>2]=-1),s[T>>2]=s[T>>2]&-4|1,R=s[(s[E>>2]|0)+(A<<2)>>2]|0,U=u+556|0,s[U>>2]=((((R>>>3&1)+(R>>>5)<<2)+4|0)>>>2)+(s[U>>2]|0),m=V}function Oa(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0,K=0;if(T=m,E=s[A>>2]|0,E>>>0<=31)return F=0,m=T,F|0;for(V=s[u+332>>2]|0,M=n[528]|0,x=M&255,F=x&2,x=x>>>1^1,u=0;;){if(K=s[A+(u<<2)+4>>2]|0,K=(a[V+(K>>1)>>0]|0)^K&1,u=u+1|0,(K&255)<<24>>24==M<<24>>24&x|F&K){E=1,A=5;break}if((u|0)>=(E>>>5|0)){E=0,A=5;break}}return(A|0)==5?(m=T,E|0):0}function Br(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0,_e=0,ge=0,Oe=0,$e=0;if(V=m,T=u+296|0,(s[T>>2]|0)<=(A|0)){m=V;return}if(E=u+284|0,ge=s[E>>2]|0,x=u+292|0,Oe=s[x>>2]|0,$e=s[Oe+(A<<2)>>2]|0,(ge|0)>($e|0)){_e=u+280|0,R=u+332|0,K=u+88|0,F=u+348|0,U=u+460|0,ne=u+476|0,ee=u+472|0,te=u+380|0;do ge=ge+-1|0,$e=s[(s[_e>>2]|0)+(ge<<2)>>2]>>1,n[(s[R>>2]|0)+$e>>0]=n[544]|0,Oe=s[K>>2]|0,(Oe|0)<=1?(Oe|0)==1&&(ge|0)>(s[(s[x>>2]|0)+((s[T>>2]|0)+-1<<2)>>2]|0)&&(M=7):M=7,(M|0)==7&&(M=0,n[(s[F>>2]|0)+$e>>0]=s[(s[_e>>2]|0)+(ge<<2)>>2]&1),(s[ne>>2]|0)>($e|0)&&(s[(s[ee>>2]|0)+($e<<2)>>2]|0)>-1||(M=11),(M|0)==11&&(M=0,(n[(s[te>>2]|0)+$e>>0]|0)!=0)&&xi(U,$e),Oe=s[x>>2]|0,$e=s[Oe+(A<<2)>>2]|0;while((ge|0)>($e|0));ge=s[E>>2]|0}if(s[u+512>>2]=$e,u=s[Oe+(A<<2)>>2]|0,(ge-u|0)>0&&(s[E>>2]=u),((s[T>>2]|0)-A|0)<=0){m=V;return}s[T>>2]=A,m=V}function nl(u){u=u|0;var A=0,T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0;for(A=m,E=u+72|0,ne=+y[E>>3]*1389796,ne=ne-+(~~(ne/2147483647)|0)*2147483647,y[E>>3]=ne,F=u+464|0,ne/2147483647<+y[u+64>>3]&&(K=s[F>>2]|0,(K|0)!=0)?(ne=ne*1389796,ne=ne-+(~~(ne/2147483647)|0)*2147483647,y[E>>3]=ne,K=s[(s[u+460>>2]|0)+(~~(+(K|0)*(ne/2147483647))<<2)>>2]|0,U=n[(s[u+332>>2]|0)+K>>0]|0,R=n[544]|0,te=R&255,(te>>>1^1)&U<<24>>24==R<<24>>24|U&2&te|0&&n[(s[u+380>>2]|0)+K>>0]|0&&(te=u+176|0,U=te,U=Xi(s[U>>2]|0,s[U+4>>2]|0,1,0)|0,s[te>>2]=U,s[te+4>>2]=nt)):K=-1,R=u+460|0,te=u+332|0,U=u+380|0;!((K|0)!=-1&&(ee=n[(s[te>>2]|0)+K>>0]|0,M=n[544]|0,T=M&255,V=T>>>1^1,(V&ee<<24>>24==M<<24>>24|ee&2&T|0)!=0)&&n[(s[U>>2]|0)+K>>0]|0);){if(!(s[F>>2]|0)){T=-2,x=17;break}K=on(R)|0}return(x|0)==17?(m=A,T|0):(F=n[(s[u+364>>2]|0)+K>>0]|0,x=F&255,V&F<<24>>24==M<<24>>24|T&2&x?n[u+92>>0]|0?(ne=+y[E>>3]*1389796,ne=ne-+(~~(ne/2147483647)|0)*2147483647,y[E>>3]=ne,ee=ne/2147483647<.5|K<<1,m=A,ee|0):(ee=(n[(s[u+348>>2]|0)+K>>0]|0)!=0|K<<1,m=A,ee|0):(te=n[528]|0,ee=te&255,ee=((ee>>>1^1)&F<<24>>24==te<<24>>24|x&2&ee|0)!=0|K<<1,m=A,ee|0))}function C(u,A,T,E){u=u|0,A=A|0,T=T|0,E=E|0;var V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0,_e=0,ge=0,Oe=0,$e=0,Ye=0,it=0,Dt=0,ni=0,ei=0,at=0,Ht=0,Zt=0,kt=0,Xt=0,It=0,Nt=0,Ot=0,st=0,ai=0,fi=0,ui=0,gi=0,Vi=0,bs=0,li=0,Bs=0,es=0;V=m,m=m+16|0,U=V+8|0,_e=V+4|0,K=V,F=T+4|0,M=s[F>>2]|0,x=T+8|0,(M|0)==(s[x>>2]|0)&&(te=(M>>1)+2&-2,te=(te|0)<2?2:te,(te|0)>(2147483647-M|0)&&(li=ye(1)|0,Yt(li|0,48,0)),bs=s[T>>2]|0,li=te+M|0,s[x>>2]=li,li=ps(bs,li<<2)|0,s[T>>2]=li,!(li|0)&&(s[(Rt()|0)>>2]|0)==12&&(li=ye(1)|0,Yt(li|0,48,0)),M=s[F>>2]|0),x=(s[T>>2]|0)+(M<<2)|0,x&&(s[x>>2]=0,M=s[F>>2]|0),s[F>>2]=M+1,te=u+544|0,Xt=u+280|0,M=u+588|0,x=u+396|0,at=u+504|0,Zt=u+316|0,Ht=u+540|0,ei=u+476|0,ni=u+472|0,Dt=u+460|0,it=u+488|0,Ye=u+296|0,Oe=u+496|0,$e=u+272|0,kt=u+268|0,Nt=-2,It=(s[u+284>>2]|0)+-1|0,Ot=0;do{if(st=s[te>>2]|0,A=st+(A<<2)|0,ai=s[A>>2]|0,ai&4|0&&(ne=+y[Oe>>3],li=A+(ai>>>5<<2)+4|0,Bs=ne+ +c[li>>2],c[li>>2]=Bs,Bs>1e20)){if(ui=s[$e>>2]|0,(ui|0)>0){fi=s[kt>>2]|0,ai=0;do li=st+(s[fi+(ai<<2)>>2]<<2)|0,li=li+((s[li>>2]|0)>>>5<<2)+4|0,c[li>>2]=+c[li>>2]*1e-20,ai=ai+1|0;while((ai|0)!=(ui|0))}y[Oe>>3]=ne*1e-20}if(Nt=(Nt|0)!=-2&1,Nt>>>0<(s[A>>2]|0)>>>5>>>0)do{ai=s[A+(Nt<<2)+4>>2]|0,s[_e>>2]=ai,ai=ai>>1,st=(s[M>>2]|0)+ai|0;do if(!(n[st>>0]|0)&&(s[(s[x>>2]|0)+(ai<<3)+4>>2]|0)>0){if(ui=s[Zt>>2]|0,li=ui+(ai<<3)|0,Bs=+y[at>>3]+ +y[li>>3],y[li>>3]=Bs,Bs>1e100){if(gi=s[Ht>>2]|0,(gi|0)>0){fi=0;do li=ui+(fi<<3)|0,y[li>>3]=+y[li>>3]*1e-100,fi=fi+1|0;while((fi|0)!=(gi|0))}y[at>>3]=+y[at>>3]*1e-100}if((s[ei>>2]|0)>(ai|0)&&(ge=s[ni>>2]|0,ee=s[ge+(ai<<2)>>2]|0,(ee|0)>-1)){fi=s[Dt>>2]|0,ui=s[fi+(ee<<2)>>2]|0;e:do if(!ee)bs=0;else for(li=ee;;){if(bs=li,li=li+-1>>1,Vi=fi+(li<<2)|0,gi=s[Vi>>2]|0,es=s[s[it>>2]>>2]|0,!(+y[es+(ui<<3)>>3]>+y[es+(gi<<3)>>3]))break e;if(s[fi+(bs<<2)>>2]=gi,s[ge+(s[Vi>>2]<<2)>>2]=bs,!li){bs=0;break}}while(!1);s[fi+(bs<<2)>>2]=ui,s[ge+(ui<<2)>>2]=bs}if(n[st>>0]=1,(s[(s[x>>2]|0)+(ai<<3)+4>>2]|0)<(s[Ye>>2]|0)){Hs(T,_e);break}else{Ot=Ot+1|0;break}}while(!1);Nt=Nt+1|0}while((Nt|0)<((s[A>>2]|0)>>>5|0));A=s[Xt>>2]|0,st=s[M>>2]|0;do Nt=It,It=It+-1|0,Nt=s[A+(Nt<<2)>>2]|0,fi=Nt>>1,ai=st+fi|0;while(!(n[ai>>0]|0));A=s[(s[x>>2]|0)+(fi<<3)>>2]|0,n[ai>>0]=0,Ot=Ot+-1|0}while((Ot|0)>0);if(s[s[T>>2]>>2]=Nt^1,_e=u+616|0,Oe=s[_e>>2]|0,ee=u+620|0,Oe?(s[ee>>2]=0,$e=0):$e=s[ee>>2]|0,ge=s[F>>2]|0,($e|0)<(ge|0)){it=u+624|0,Ye=s[it>>2]|0,(Ye|0)<(ge|0)&&(es=ge+1-Ye&-2,$e=(Ye>>1)+2&-2,$e=(es|0)>($e|0)?es:$e,($e|0)>(2147483647-Ye|0)&&(es=ye(1)|0,Yt(es|0,48,0)),es=$e+Ye|0,s[it>>2]=es,Oe=ps(Oe,es<<2)|0,s[_e>>2]=Oe,!(Oe|0)&&(s[(Rt()|0)>>2]|0)==12&&(es=ye(1)|0,Yt(es|0,48,0))),$e=s[ee>>2]|0;e:do if(($e|0)<(ge|0))for(;;){if(Oe=Oe+($e<<2)|0,Oe&&(s[Oe>>2]=0),$e=$e+1|0,($e|0)==(ge|0))break e;Oe=s[_e>>2]|0}while(!1);s[ee>>2]=ge,ge=s[F>>2]|0}if((ge|0)>0){$e=s[_e>>2]|0,Oe=s[T>>2]|0,Ye=0;do s[$e+(Ye<<2)>>2]=s[Oe+(Ye<<2)>>2],Ye=Ye+1|0,ge=s[F>>2]|0;while((Ye|0)<(ge|0))}if(Oe=s[u+84>>2]|0,(Oe|0)==1)if((ge|0)>1)for(K=s[T>>2]|0,R=1,Oe=1;;){ge=s[K+(R<<2)>>2]|0,U=s[x>>2]|0,$e=s[U+(ge>>1<<3)>>2]|0;e:do if(($e|0)!=-1){if(Ye=(s[te>>2]|0)+($e<<2)|0,it=s[Ye>>2]|0,it>>>0>63){for($e=s[M>>2]|0,Dt=1;es=s[Ye+(Dt<<2)+4>>2]>>1,!(!(n[$e+es>>0]|0)&&(s[U+(es<<3)+4>>2]|0)>0);)if(Dt=Dt+1|0,(Dt|0)>=(it>>>5|0))break e;s[K+(Oe<<2)>>2]=ge,Oe=Oe+1|0}}else s[K+(Oe<<2)>>2]=ge,Oe=Oe+1|0;while(!1);if(R=R+1|0,U=s[F>>2]|0,(R|0)>=(U|0)){K=U;break}}else K=ge,R=1,Oe=1;else if((Oe|0)==2)if((ge|0)>1){te=1,Oe=1;do $e=s[T>>2]|0,ge=s[$e+(te<<2)>>2]|0,(s[(s[x>>2]|0)+(ge>>1<<3)>>2]|0)!=-1?(s[K>>2]=ge,s[U+0>>2]=s[K+0>>2],G(u,U)|0||(ge=s[T>>2]|0,$e=ge,ge=s[ge+(te<<2)>>2]|0,R=62)):R=62,(R|0)==62&&(R=0,s[$e+(Oe<<2)>>2]=ge,Oe=Oe+1|0),te=te+1|0,ge=s[F>>2]|0;while((te|0)<(ge|0));K=ge,R=te}else K=ge,R=1,Oe=1;else K=ge,R=ge,Oe=ge;if(es=u+240|0,li=es,li=Xi(s[li>>2]|0,s[li+4>>2]|0,K|0,((K|0)<0)<<31>>31|0)|0,s[es>>2]=li,s[es+4>>2]=nt,R=R-Oe|0,(R|0)>0&&(K=K-R|0,s[F>>2]=K),es=u+248|0,li=es,li=Xi(s[li>>2]|0,s[li+4>>2]|0,K|0,((K|0)<0)<<31>>31|0)|0,s[es>>2]=li,s[es+4>>2]=nt,(K|0)==1)T=0;else{if(T=s[T>>2]|0,(K|0)>2){u=s[x>>2]|0,F=2,R=1;do R=(s[u+(s[T+(F<<2)>>2]>>1<<3)+4>>2]|0)>(s[u+(s[T+(R<<2)>>2]>>1<<3)+4>>2]|0)?F:R,F=F+1|0;while((F|0)<(K|0))}else R=1;li=T+(R<<2)|0,es=s[li>>2]|0,T=T+4|0,s[li>>2]=s[T>>2],s[T>>2]=es,T=s[(s[x>>2]|0)+(es>>1<<3)+4>>2]|0}if(s[E>>2]=T,(s[ee>>2]|0)>0)E=0;else{m=V;return}do n[(s[M>>2]|0)+(s[(s[_e>>2]|0)+(E<<2)>>2]>>1)>>0]=0,E=E+1|0;while((E|0)<(s[ee>>2]|0));m=V}function G(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0,_e=0,ge=0,Oe=0,$e=0;for(T=m,U=s[A>>2]|0,K=u+396|0,ee=s[K>>2]|0,F=u+544|0,ge=(s[F>>2]|0)+(s[ee+(U>>1<<3)>>2]<<2)|0,M=u+604|0,E=u+608|0,s[M>>2]|0&&(s[E>>2]=0),V=u+588|0,x=u+612|0,u=u+616|0,te=1;;){if(te>>>0<(s[ge>>2]|0)>>>5>>>0){if(_e=s[ge+(te<<2)+4>>2]|0,ne=_e>>1,s[ee+(ne<<3)+4>>2]|0&&(R=n[(s[V>>2]|0)+ne>>0]|0,(R+-1<<24>>24&255)>=2)){if(ge=s[E>>2]|0,Oe=(ge|0)==(s[x>>2]|0),R<<24>>24==3||(s[ee+(ne<<3)>>2]|0)==-1){F=8;break}if(Oe){if(ee=(ge>>1)+2&-2,ee=(ee|0)<2?2:ee,(ee|0)>(2147483647-ge|0)){F=24;break}if($e=s[M>>2]|0,Oe=ee+ge|0,s[x>>2]=Oe,Oe=ps($e,Oe<<3)|0,s[M>>2]=Oe,!(Oe|0)&&(s[(Rt()|0)>>2]|0)==12){F=24;break}ge=s[E>>2]|0}s[E>>2]=ge+1,ee=(s[M>>2]|0)+(ge<<3)|0,ee&&($e=ee,s[$e>>2]=te,s[$e+4>>2]=U),s[A>>2]=_e,ge=s[K>>2]|0,U=_e,ee=ge,ge=(s[F>>2]|0)+(s[ge+(ne<<3)>>2]<<2)|0,te=0}}else{if(U=(s[V>>2]|0)+(U>>1)|0,n[U>>0]|0||(n[U>>0]=2,Hs(u,A)),U=s[E>>2]|0,!U){E=1,F=34;break}$e=U+-1|0,U=s[M>>2]|0,te=s[U+($e<<3)>>2]|0,U=s[U+($e<<3)+4>>2]|0,s[A>>2]=U,ee=s[K>>2]|0,ge=(s[F>>2]|0)+(s[ee+(U>>1<<3)>>2]<<2)|0,s[E>>2]=$e}te=te+1|0}if((F|0)==8){if(Oe&&(F=(ge>>1)+2&-2,F=(F|0)<2?2:F,(F|0)>(2147483647-ge|0)&&($e=ye(1)|0,Yt($e|0,48,0)),Oe=s[M>>2]|0,$e=F+ge|0,s[x>>2]=$e,$e=ps(Oe,$e<<3)|0,s[M>>2]=$e,!($e|0)&&(s[(Rt()|0)>>2]|0)==12&&($e=ye(1)|0,Yt($e|0,48,0)),ge=s[E>>2]|0),x=ge+1|0,s[E>>2]=x,F=(s[M>>2]|0)+(ge<<3)|0,F&&(x=F,s[x>>2]=0,s[x+4>>2]=U,x=s[E>>2]|0),(x|0)>0)F=0;else return $e=0,m=T,$e|0;do K=(s[V>>2]|0)+(s[(s[M>>2]|0)+(F<<3)+4>>2]>>1)|0,n[K>>0]|0||(n[K>>0]=3,Hs(u,(s[M>>2]|0)+(F<<3)+4|0),x=s[E>>2]|0),F=F+1|0;while((F|0)<(x|0));return E=0,m=T,E|0}else if((F|0)==24)Yt(ye(1)|0,48,0);else if((F|0)==34)return m=T,E|0;return 0}function Q(u,A,T){u=u|0,A=A|0,T=T|0;var E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0,_e=0,ge=0,Oe=0,$e=0,Ye=0;if(x=m,m=m+32|0,M=x+16|0,V=x+12|0,F=x+8|0,E=x,U=T+20|0,K=T+16|0,(s[U>>2]|0)>0){R=0;do n[(s[T>>2]|0)+(s[(s[K>>2]|0)+(R<<2)>>2]|0)>>0]=0,R=R+1|0;while((R|0)<(s[U>>2]|0))}if(s[K>>2]|0&&(s[U>>2]=0),R=s[A>>2]|0,s[F>>2]=R,s[V>>2]=R,s[M+0>>2]=s[V+0>>2],zn(T,M,0),K=(s[T>>2]|0)+R|0,n[K>>0]|0||(n[K>>0]=1,Hs(T+16|0,F)),!(s[u+296>>2]|0)){m=x;return}if(A=R>>1,te=u+588|0,n[(s[te>>2]|0)+A>>0]=1,ne=s[u+284>>2]|0,U=u+292|0,ge=s[s[U>>2]>>2]|0,(ne|0)>(ge|0)){F=u+280|0,K=u+396|0,R=T+16|0,u=u+544|0;do if(ne=ne+-1|0,_e=s[(s[F>>2]|0)+(ne<<2)>>2]|0,ee=_e>>1,n[(s[te>>2]|0)+ee>>0]|0){ge=s[K>>2]|0,Oe=s[ge+(ee<<3)>>2]|0;e:do if((Oe|0)==-1)_e=_e^1,s[E>>2]=_e,s[V>>2]=_e,s[M+0>>2]=s[V+0>>2],zn(T,M,0),_e=(s[T>>2]|0)+_e|0,n[_e>>0]|0||(n[_e>>0]=1,Hs(R,E));else if(_e=(s[u>>2]|0)+(Oe<<2)|0,Oe=s[_e>>2]|0,Oe>>>0>63)for($e=1;;){if(Ye=s[_e+($e<<2)+4>>2]>>1,(s[ge+(Ye<<3)+4>>2]|0)>0&&(n[(s[te>>2]|0)+Ye>>0]=1,Oe=s[_e>>2]|0),$e=$e+1|0,($e|0)>=(Oe>>>5|0))break e;ge=s[K>>2]|0}while(!1);n[(s[te>>2]|0)+ee>>0]=0,ge=s[s[U>>2]>>2]|0}while((ne|0)>(ge|0))}n[(s[te>>2]|0)+A>>0]=0,m=x}function se(u){u=u|0;var A=0,T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0,_e=0,ge=0,Oe=0,$e=0,Ye=0,it=0;if(T=m,m=m+16|0,R=T+4|0,_e=T,A=u+272|0,Oe=s[A>>2]|0,F=+y[u+496>>3]/+(Oe|0),V=u+544|0,M=u+268|0,ge=s[M>>2]|0,s[_e>>2]=V,s[R+0>>2]=s[_e+0>>2],$n(ge,Oe,R),R=s[A>>2]|0,(R|0)>0){x=u+332|0,K=u+396|0,U=0,ge=0;do{ee=s[M>>2]|0,_e=s[ee+(U<<2)>>2]|0,Oe=s[V>>2]|0,te=Oe+(_e<<2)|0,ne=s[te>>2]|0;do if(ne>>>0>95){if($e=s[Oe+(_e+1<<2)>>2]|0,Oe=$e>>1,$e=(a[(s[x>>2]|0)+Oe>>0]|0)^$e&1,it=n[528]|0,Ye=it&255,($e&255)<<24>>24==it<<24>>24&(Ye>>>1^1)|Ye&2&$e|0&&(it=s[(s[K>>2]|0)+(Oe<<3)>>2]|0,(it|0)!=-1&(it|0)==(_e|0))){E=9;break}if((U|0)>=((R|0)/2|0|0)&&!(+c[te+(ne>>>5<<2)+4>>2]<F)){E=9;break}Wr(u,_e)}else E=9;while(!1);(E|0)==9&&(E=0,s[ee+(ge<<2)>>2]=_e,ge=ge+1|0),U=U+1|0,R=s[A>>2]|0}while((U|0)<(R|0))}else U=0,ge=0;if(E=U-ge|0,(E|0)>0&&(s[A>>2]=R-E),!(+((s[u+556>>2]|0)>>>0)>+y[u+96>>3]*+((s[u+548>>2]|0)>>>0))){m=T;return}ho[s[(s[u>>2]|0)+8>>2]&31](u),m=T}function ve(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0,_e=0,ge=0,Oe=0,$e=0,Ye=0,it=0;if(T=m,E=A+4|0,K=s[E>>2]|0,(K|0)>0){M=u+544|0,V=u+332|0,x=0,F=0;do{Oe=s[A>>2]|0,te=s[Oe+(x<<2)>>2]|0,K=(s[M>>2]|0)+(te<<2)|0,U=s[K>>2]|0;do if(U>>>0>31){$e=s[V>>2]|0,ee=n[528]|0,ne=ee&255,Ye=ne&2,ne=ne>>>1^1,_e=U>>>5,ge=0;do if(it=s[K+(ge<<2)+4>>2]|0,it=(a[$e+(it>>1)>>0]|0)^it&1,ge=ge+1|0,(it&255)<<24>>24==ee<<24>>24&ne|Ye&it){R=7;break}while((ge|0)<(_e|0));if((R|0)==7){R=0,Wr(u,te);break}if(U>>>0>95){R=n[536]|0,ne=U>>>5,te=2;do ee=K+(te<<2)+4|0,it=s[ee>>2]|0,it=(a[(s[V>>2]|0)+(it>>1)>>0]|0)^it&1,Ye=R&255,(it&255)<<24>>24==R<<24>>24&(Ye>>>1^1)|Ye&2&it&&(s[ee>>2]=s[K+(ne+-1<<2)+4>>2],U=s[K>>2]|0,U&8&&(U=U>>>5,s[K+(U+-1<<2)+4>>2]=s[K+(U<<2)+4>>2],U=s[K>>2]|0),U=U+-32|0,s[K>>2]=U,te=te+-1|0),te=te+1|0,ne=U>>>5;while((te|0)<(ne|0));te=s[A>>2]|0,Oe=te,te=s[te+(x<<2)>>2]|0,R=16}else R=16}else R=16;while(!1);(R|0)==16&&(R=0,s[Oe+(F<<2)>>2]=te,F=F+1|0),x=x+1|0,K=s[E>>2]|0}while((x|0)<(K|0))}else x=0,F=0;if(A=x-F|0,(A|0)<=0){m=T;return}s[E>>2]=K-A,m=T}function Ee(u){u=u|0;var A=0,T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0;if(V=m,m=m+16|0,T=V+4|0,M=V,s[T>>2]=0,A=T+4|0,s[A>>2]=0,E=T+8|0,s[E>>2]=0,s[M>>2]=0,x=u+540|0,U=s[x>>2]|0,(U|0)>0){K=u+380|0,F=u+332|0,R=0;do n[(s[K>>2]|0)+R>>0]|0&&(ne=n[(s[F>>2]|0)+R>>0]|0,ee=n[544]|0,te=ee&255,((te>>>1^1)&ne<<24>>24==ee<<24>>24|ne&2&te|0)!=0)&&($i(T,M),U=s[x>>2]|0),R=R+1|0,s[M>>2]=R;while((R|0)<(U|0))}if(nn(u+460|0,T),u=s[T>>2]|0,!u){m=V;return}s[A>>2]=0,di(u),s[T>>2]=0,s[E>>2]=0,m=V}function Be(u){u=u|0;var A=0,T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0,_e=0;if(A=m,E=u+492|0,n[E>>0]|0&&(vr(u)|0)==-1){if(E=u+284|0,V=u+516|0,(s[E>>2]|0)==(s[V>>2]|0)||(M=u+520|0,_e=M,ee=s[_e+4>>2]|0,(ee|0)>0|(ee|0)==0&(s[_e>>2]|0)>>>0>0))return _e=1,m=A,_e|0;if(ve(u,u+268|0),n[u+536>>0]|0){if(ve(u,u+256|0),F=u+564|0,x=u+568|0,(s[x>>2]|0)>0){R=u+588|0,K=0;do n[(s[R>>2]|0)+(s[(s[F>>2]|0)+(K<<2)>>2]|0)>>0]=1,K=K+1|0;while((K|0)<(s[x>>2]|0))}if(te=s[E>>2]|0,(te|0)>0){K=s[u+280>>2]|0,R=s[u+588>>2]|0,ne=0,U=0;do ee=s[K+(ne<<2)>>2]|0,n[R+(ee>>1)>>0]|0||(s[K+(U<<2)>>2]=ee,te=s[E>>2]|0,U=U+1|0),ne=ne+1|0;while((ne|0)<(te|0))}else ne=0,U=0;K=ne-U|0,(K|0)>0&&(te=te-K|0,s[E>>2]=te),s[u+512>>2]=te;e:do if((s[x>>2]|0)>0){U=u+588|0,K=0;do n[(s[U>>2]|0)+(s[(s[F>>2]|0)+(K<<2)>>2]|0)>>0]=0,K=K+1|0,R=s[x>>2]|0;while((K|0)<(R|0));if((R|0)>0){for(R=u+580|0,U=u+584|0,K=u+576|0,te=0;;){if(ee=s[R>>2]|0,(ee|0)==(s[U>>2]|0)){if(ne=(ee>>1)+2&-2,ne=(ne|0)<2?2:ne,(ne|0)>(2147483647-ee|0)){T=28;break}if(_e=s[K>>2]|0,ne=ne+ee|0,s[U>>2]=ne,ne=ps(_e,ne<<2)|0,s[K>>2]=ne,!(ne|0)&&(s[(Rt()|0)>>2]|0)==12){T=28;break}ee=s[R>>2]|0}else ne=s[K>>2]|0;if(_e=ne+(ee<<2)|0,_e&&(s[_e>>2]=0,ee=s[R>>2]|0),s[R>>2]=ee+1,_e=s[F>>2]|0,s[ne+(ee<<2)>>2]=s[_e+(te<<2)>>2],te=te+1|0,(te|0)>=(s[x>>2]|0))break e}(T|0)==28&&Yt(ye(1)|0,48,0)}else T=21}else T=21;while(!1);(T|0)==21&&(_e=s[F>>2]|0),_e&&(s[x>>2]=0)}return+((s[u+556>>2]|0)>>>0)>+y[u+96>>3]*+((s[u+548>>2]|0)>>>0)&&ho[s[(s[u>>2]|0)+8>>2]&31](u),Ee(u),s[V>>2]=s[E>>2],ee=u+224|0,_e=u+232|0,ee=Xi(s[_e>>2]|0,s[_e+4>>2]|0,s[ee>>2]|0,s[ee+4>>2]|0)|0,_e=M,s[_e>>2]=ee,s[_e+4>>2]=nt,_e=1,m=A,_e|0}return n[E>>0]=0,_e=0,m=A,_e|0}function Qe(u,A,T){u=u|0,A=A|0,T=T|0;var E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0,_e=0,ge=0,Oe=0,$e=0,Ye=0,it=0,Dt=0,ni=0,ei=0,at=0,Ht=0,Zt=0,kt=0,Xt=0,It=0,Nt=0,Ot=0,st=0,ai=0,fi=0,ui=0,gi=0,Vi=0,bs=0,li=0,Bs=0,es=0,Vo=0,ln=0,Ks=0,zr=0,ys=0,Xs=0,Yi=0,Rn=0,hr=0,Sn=0,Ci=0,Is=0,zs=0,co=0,Fs=0,fl=0,oh=0,Ga=0,va=0,js=0,jr=0,fs=0,oi=0,Yn=0;x=m,m=m+64|0,Ks=x,Ht=x+60|0,Dt=x+56|0,E=x+44|0,zr=x+40|0,s[E>>2]=0,M=E+4|0,s[M>>2]=0,V=E+8|0,s[V>>2]=0,st=A+160|0,Ot=st,Ot=Xi(s[Ot>>2]|0,s[Ot+4>>2]|0,1,0)|0,s[st>>2]=Ot,s[st+4>>2]=nt,st=(T|0)<0,Ot=A+680|0,Nt=A+664|0,It=A+672|0,R=A+296|0,ge=A+272|0,F=A+284|0,kt=A+640|0,at=A+308|0,ei=A+304|0,U=A+332|0,Zt=A+292|0,Xs=A+168|0,ne=A+396|0,_e=A+280|0,Xt=A+184|0,ni=A+192|0,ee=A+48|0,bs=A+504|0,Vo=A+56|0,ys=A+496|0,Yi=A+656|0,ai=A+144|0,fi=A+648|0,ui=A+128|0,gi=A+44|0,Vi=A+200|0,li=A+208|0,Bs=A+224|0,es=A+216|0,te=A+232|0,ln=A+540|0,K=A+292|0,Oe=A+544|0,Ye=A+276|0,$e=A+268|0,it=A+268|0,Rn=0;e:for(;;){for(hr=st|(Rn|0)<(T|0);Ci=vr(A)|0,(Ci|0)==-1;){if(!hr){Ci=41;break e}if(n[Ot>>0]|0){Ci=41;break e}if(Ci=Nt,Is=s[Ci+4>>2]|0,(Is|0)>=0&&(oi=ni,fs=s[oi+4>>2]|0,!(fs>>>0<Is>>>0|((fs|0)==(Is|0)?(s[oi>>2]|0)>>>0<(s[Ci>>2]|0)>>>0:0)))){Ci=41;break e}if(Ci=It,Is=s[Ci+4>>2]|0,(Is|0)>=0&&(oi=Xt,fs=s[oi+4>>2]|0,!(fs>>>0<Is>>>0|((fs|0)==(Is|0)?(s[oi>>2]|0)>>>0<(s[Ci>>2]|0)>>>0:0)))){Ci=41;break e}if(!(s[R>>2]|0)&&!(Be(A)|0)){Ci=50;break e}for(+((s[ge>>2]|0)-(s[F>>2]|0)|0)>=+y[kt>>3]&&se(A);;){if(Ci=s[R>>2]|0,(Ci|0)>=(s[at>>2]|0)){Ci=59;break}if(Fs=s[(s[ei>>2]|0)+(Ci<<2)>>2]|0,Is=a[(s[U>>2]|0)+(Fs>>1)>>0]|0,oi=Is^Fs&1,zs=oi&255,js=n[528]|0,fs=js&255,!(zs<<24>>24==js<<24>>24&(fs>>>1^1)|fs&2&oi)){Ci=56;break}s[Ht>>2]=s[F>>2],$i(Zt,Ht)}if((Ci|0)==56){if(Ci=0,fs=n[536]|0,oi=fs&255,(oi>>>1^1)&zs<<24>>24==fs<<24>>24|Is&2&oi){Ci=57;break e}(Fs|0)==-2&&(Ci=59)}if((Ci|0)==59&&(oi=Xs,oi=Xi(s[oi>>2]|0,s[oi+4>>2]|0,1,0)|0,Fs=Xs,s[Fs>>2]=oi,s[Fs+4>>2]=nt,Fs=nl(A)|0,(Fs|0)==-2)){Ci=60;break e}s[Ks>>2]=s[F>>2],$i(Zt,Ks),oi=Fs>>1,n[(s[U>>2]|0)+oi>>0]=(Fs&1^1)&255^1,fs=s[R>>2]|0,oi=(s[ne>>2]|0)+(oi<<3)|0,s[oi>>2]=-1,s[oi+4>>2]=fs,oi=s[F>>2]|0,s[F>>2]=oi+1,s[(s[_e>>2]|0)+(oi<<2)>>2]=Fs}if(fs=ni,fs=Xi(s[fs>>2]|0,s[fs+4>>2]|0,1,0)|0,oi=ni,s[oi>>2]=fs,s[oi+4>>2]=nt,Rn=Rn+1|0,!(s[R>>2]|0)){Ci=5;break}if(s[E>>2]|0&&(s[M>>2]=0),C(A,Ci,E,Dt),Br(A,s[Dt>>2]|0),(s[M>>2]|0)==1)fs=s[s[E>>2]>>2]|0,oi=fs>>1,n[(s[U>>2]|0)+oi>>0]=(fs&1^1)&255^1,js=s[R>>2]|0,oi=(s[ne>>2]|0)+(oi<<3)|0,s[oi>>2]=-1,s[oi+4>>2]=js,oi=s[F>>2]|0,s[F>>2]=oi+1,s[(s[_e>>2]|0)+(oi<<2)>>2]=fs;else{if(hr=Ns(Oe,E,1)|0,Ci=s[ge>>2]|0,(Ci|0)==(s[Ye>>2]|0)){if(Is=(Ci>>1)+2&-2,Is=(Is|0)<2?2:Is,(Is|0)>(2147483647-Ci|0)){Ci=14;break}if(fs=s[$e>>2]|0,oi=Is+Ci|0,s[Ye>>2]=oi,oi=ps(fs,oi<<2)|0,s[$e>>2]=oi,!(oi|0)&&(s[(Rt()|0)>>2]|0)==12){Ci=14;break}Ci=s[ge>>2]|0}if(s[ge>>2]=Ci+1,Ci=(s[$e>>2]|0)+(Ci<<2)|0,Ci&&(s[Ci>>2]=hr),Gr(A,hr),zs=s[Oe>>2]|0,oi=zs+(hr<<2)|0,Sn=+y[ys>>3],oi=oi+((s[oi>>2]|0)>>>5<<2)+4|0,Yn=Sn+ +c[oi>>2],c[oi>>2]=Yn,Yn>1e20){if(Is=s[ge>>2]|0,(Is|0)>0){Ci=s[it>>2]|0,Fs=0;do oi=zs+(s[Ci+(Fs<<2)>>2]<<2)|0,oi=oi+((s[oi>>2]|0)>>>5<<2)+4|0,c[oi>>2]=+c[oi>>2]*1e-20,Fs=Fs+1|0;while((Fs|0)!=(Is|0))}y[ys>>3]=Sn*1e-20}fs=s[s[E>>2]>>2]|0,oi=fs>>1,n[(s[U>>2]|0)+oi>>0]=(fs&1^1)&255^1,js=s[R>>2]|0,oi=(s[ne>>2]|0)+(oi<<3)|0,s[oi>>2]=hr,s[oi+4>>2]=js,oi=s[F>>2]|0,s[F>>2]=oi+1,s[(s[_e>>2]|0)+(oi<<2)>>2]=fs}if(y[bs>>3]=1/+y[ee>>3]*+y[bs>>3],y[ys>>3]=1/+y[Vo>>3]*+y[ys>>3],oi=(s[Yi>>2]|0)+-1|0,s[Yi>>2]=oi,!oi&&(Sn=+y[ai>>3]*+y[fi>>3],y[fi>>3]=Sn,s[Yi>>2]=~~Sn,Sn=+y[ui>>3]*+y[kt>>3],y[kt>>3]=Sn,!((s[gi>>2]|0)<=0))){if(Ci=s[ni>>2]|0,hr=s[Vi>>2]|0,va=s[R>>2]|0,va?Is=s[K>>2]|0:Is=F,Is=s[Is>>2]|0,Ga=s[li>>2]|0,oh=s[Bs>>2]|0,fl=s[es>>2]|0,Fs=te,zs=s[Fs>>2]|0,Fs=s[Fs+4>>2]|0,co=+(s[ln>>2]|0),jr=1/co,(va|0)<0)Yn=0;else for(js=0,Yn=0;js?fs=s[(s[K>>2]|0)+(js+-1<<2)>>2]|0:fs=0,(js|0)==(va|0)?oi=F:oi=(s[K>>2]|0)+(js<<2)|0,Yn=Yn+ +$t(+jr,+ +(js|0))*+((s[oi>>2]|0)-fs|0),(js|0)!=(va|0);)js=js+1|0;s[Ks>>2]=Ci,s[Ks+4>>2]=hr-Is,s[Ks+8>>2]=Ga,s[Ks+12>>2]=oh,s[Ks+16>>2]=~~Sn,s[Ks+20>>2]=fl,oi=Ks+24|0,y[D>>3]=(+(zs>>>0)+4294967296*+(Fs>>>0))/+(fl|0),s[oi>>2]=s[D>>2],s[oi+4>>2]=s[D+4>>2],oi=Ks+32|0,y[D>>3]=Yn/co*100,s[oi>>2]=s[D>>2],s[oi+4>>2]=s[D+4>>2],Tt(1832,Ks|0)|0}}if((Ci|0)==5)n[u>>0]=n[536]|0;else if((Ci|0)==14)Yt(ye(1)|0,48,0);else if((Ci|0)==41){if(Sn=+(s[ln>>2]|0),co=1/Sn,U=s[R>>2]|0,(U|0)<0)jr=0;else for(R=0,jr=0;R?te=s[(s[K>>2]|0)+(R+-1<<2)>>2]|0:te=0,(R|0)==(U|0)?ne=F:ne=(s[K>>2]|0)+(R<<2)|0,jr=jr+ +$t(+co,+ +(R|0))*+((s[ne>>2]|0)-te|0),(R|0)!=(U|0);)R=R+1|0;y[A+528>>3]=jr/Sn,Br(A,0),n[u>>0]=n[544]|0}else(Ci|0)==50?n[u>>0]=n[536]|0:(Ci|0)==57?(s[zr>>2]=Fs^1,oi=A+16|0,s[Ks+0>>2]=s[zr+0>>2],Q(A,Ks,oi),n[u>>0]=n[536]|0):(Ci|0)==60&&(n[u>>0]=n[528]|0);if(u=s[E>>2]|0,!u){m=x;return}s[M>>2]=0,di(u),s[E>>2]=0,s[V>>2]=0,m=x}function yt(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0,_e=0,ge=0,Oe=0,$e=0,Ye=0,it=0,Dt=0,ni=0,ei=0,at=0;if(E=m,m=m+16|0,M=E,T=A+4|0,s[T>>2]|0&&(s[A+8>>2]=0),V=A+36|0,x=A+32|0,(s[V>>2]|0)>0){F=A+16|0,K=0;do n[(s[F>>2]|0)+(s[(s[x>>2]|0)+(K<<2)>>2]|0)>>0]=0,K=K+1|0;while((K|0)<(s[V>>2]|0))}if(s[x>>2]|0&&(s[V>>2]=0),x=A+492|0,!(n[x>>0]|0)){n[u>>0]=n[536]|0,m=E;return}F=A+152|0,Dt=F,Dt=Xi(s[Dt>>2]|0,s[Dt+4>>2]|0,1,0)|0,s[F>>2]=Dt,s[F+4>>2]=nt,ni=+y[A+120>>3]*+(s[A+208>>2]|0),F=A+640|0,y[F>>3]=ni,$e=+(s[A+104>>2]|0),ni<$e&&(y[F>>3]=$e),Ye=s[A+136>>2]|0,y[A+648>>3]=+(Ye|0),s[A+656>>2]=Ye,Ye=n[544]|0,F=A+44|0,(s[F>>2]|0)>0?(bt(2288)|0,bt(2368)|0,bt(2448)|0,bt(2528)|0,U=n[544]|0):U=Ye,R=A+192|0,K=A+184|0,Dt=U&255;e:do if((Dt>>>1^1)&Ye<<24>>24==U<<24>>24|Ye&2&Dt)for(ne=A+80|0,ge=A+112|0,te=A+108|0,U=A+680|0,ee=A+664|0,_e=A+672|0,Oe=0;;){if($e=+y[ge>>3],!(n[ne>>0]|0))$e=+$t(+$e,+ +(Oe|0));else{if(Dt=Oe+1|0,(Oe|0)>0){it=0,Ye=1;do it=it+1|0,Ye=Ye<<1|1;while((Ye|0)<(Dt|0));Dt=Ye+-1|0}else it=0,Dt=0;if((Dt|0)!=(Oe|0)){Ye=Oe;do ei=Dt>>1,it=it+-1|0,Ye=(Ye|0)%(ei|0)|0,Dt=ei+-1|0;while((Dt|0)!=(Ye|0))}$e=+$t(+$e,+ +(it|0))}if(Qe(M,A,~~($e*+(s[te>>2]|0))),Ye=n[M>>0]|0,n[U>>0]|0||(Dt=ee,it=s[Dt+4>>2]|0,(it|0)>=0&&(ei=R,at=s[ei+4>>2]|0,!(at>>>0<it>>>0|((at|0)==(it|0)?(s[ei>>2]|0)>>>0<(s[Dt>>2]|0)>>>0:0))))||(Dt=_e,it=s[Dt+4>>2]|0,(it|0)>=0&&(at=K,ei=s[at+4>>2]|0,!(ei>>>0<it>>>0|((ei|0)==(it|0)?(s[at>>2]|0)>>>0<(s[Dt>>2]|0)>>>0:0)))))break e;if(ei=n[544]|0,at=ei&255,(at>>>1^1)&Ye<<24>>24==ei<<24>>24|Ye&2&at)Oe=Oe+1|0;else break}while(!1);if((s[F>>2]|0)>0&&bt(2528)|0,ei=n[528]|0,at=ei&255,M=Ye&2,!((at>>>1^1)&Ye<<24>>24==ei<<24>>24|M&at))ei=n[536]|0,at=ei&255,(at>>>1^1)&Ye<<24>>24==ei<<24>>24|M&at|0&&!(s[V>>2]|0)&&(n[x>>0]=0);else if(V=A+540|0,as(T,s[V>>2]|0),(s[V>>2]|0)>0){M=A+332|0,x=0;do n[(s[T>>2]|0)+x>>0]=n[(s[M>>2]|0)+x>>0]|0,x=x+1|0;while((x|0)<(s[V>>2]|0))}Br(A,0),n[u>>0]=Ye,m=E}function wt(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0,_e=0,ge=0,Oe=0,$e=0,Ye=0;if(T=m,V=u+412|0,rr(V),x=u+540|0,(s[x>>2]|0)>0){M=u+544|0,E=0;do{if(F=E<<1,R=s[V>>2]|0,K=R+(F*12|0)+4|0,(s[K>>2]|0)>0){te=R+(F*12|0)|0,U=0;do _e=(s[te>>2]|0)+(U<<3)|0,R=s[_e>>2]|0,ne=s[M>>2]|0,ee=ne+(R<<2)|0,s[ee>>2]&16?s[_e>>2]=s[ne+(R+1<<2)>>2]:(ge=Gs(A,ee)|0,s[_e>>2]=ge,s[ee>>2]=s[ee>>2]|16,s[ne+(R+1<<2)>>2]=ge),U=U+1|0;while((U|0)<(s[K>>2]|0));K=s[V>>2]|0}else K=R;if(R=F|1,F=K+(R*12|0)+4|0,(s[F>>2]|0)>0){ee=K+(R*12|0)|0,ne=0;do K=(s[ee>>2]|0)+(ne<<3)|0,te=s[K>>2]|0,U=s[M>>2]|0,R=U+(te<<2)|0,s[R>>2]&16?s[K>>2]=s[U+(te+1<<2)>>2]:(ge=Gs(A,R)|0,s[K>>2]=ge,s[R>>2]=s[R>>2]|16,s[U+(te+1<<2)>>2]=ge),ne=ne+1|0;while((ne|0)<(s[F>>2]|0))}E=E+1|0}while((E|0)<(s[x>>2]|0))}if(E=u+284|0,(s[E>>2]|0)>0){F=u+280|0,x=u+396|0,M=u+544|0,V=u+332|0,K=0;do{ee=s[x>>2]|0,te=ee+(s[(s[F>>2]|0)+(K<<2)>>2]>>1<<3)|0,ne=s[te>>2]|0;do if((ne|0)!=-1){if(ge=s[M>>2]|0,_e=ge+(ne<<2)|0,U=(s[_e>>2]&16|0)==0,U){if(Oe=s[ge+(ne+1<<2)>>2]|0,R=Oe>>1,Oe=(a[(s[V>>2]|0)+R>>0]|0)^Oe&1,Ye=n[528]|0,$e=Ye&255,!((Oe&255)<<24>>24==Ye<<24>>24&($e>>>1^1)|$e&2&Oe)||(Ye=s[ee+(R<<3)>>2]|0,!((Ye|0)!=-1&(Ye|0)==(ne|0))))break;if(U){Ye=Gs(A,_e)|0,s[te>>2]=Ye,s[_e>>2]=s[_e>>2]|16,s[ge+(ne+1<<2)>>2]=Ye;break}}s[te>>2]=s[ge+(ne+1<<2)>>2]}while(!1);K=K+1|0}while((K|0)<(s[E>>2]|0))}if(E=u+272|0,R=s[E>>2]|0,(R|0)>0){M=u+268|0,V=u+544|0,K=s[M>>2]|0,x=0,F=0;do te=K+(x<<2)|0,U=s[te>>2]|0,ee=s[V>>2]|0,ne=ee+(U<<2)|0,_e=s[ne>>2]|0,(_e&3|0)!=1&&(_e&16?(R=s[ee+(U+1<<2)>>2]|0,s[te>>2]=R):(R=Gs(A,ne)|0,s[te>>2]=R,s[ne>>2]=s[ne>>2]|16,s[ee+(U+1<<2)>>2]=R,R=s[M>>2]|0,K=R,R=s[R+(x<<2)>>2]|0),s[K+(F<<2)>>2]=R,R=s[E>>2]|0,F=F+1|0),x=x+1|0;while((x|0)<(R|0))}else x=0,F=0;if(V=x-F|0,(V|0)>0&&(s[E>>2]=R-V),E=u+260|0,K=s[E>>2]|0,(K|0)>0){V=u+256|0,u=u+544|0,F=s[V>>2]|0,M=0,x=0;do R=F+(M<<2)|0,te=s[R>>2]|0,U=s[u>>2]|0,ee=U+(te<<2)|0,ne=s[ee>>2]|0,(ne&3|0)!=1&&(ne&16?(K=s[U+(te+1<<2)>>2]|0,s[R>>2]=K):(K=Gs(A,ee)|0,s[R>>2]=K,s[ee>>2]=s[ee>>2]|16,s[U+(te+1<<2)>>2]=K,K=s[V>>2]|0,F=K,K=s[K+(M<<2)>>2]|0),s[F+(x<<2)>>2]=K,K=s[E>>2]|0,x=x+1|0),M=M+1|0;while((M|0)<(K|0))}else M=0,x=0;if(A=M-x|0,(A|0)<=0){m=T;return}s[E>>2]=K-A,m=T}function mt(u){u=u|0;var A=0,T=0,E=0,V=0,M=0,x=0,F=0;V=m,m=m+32|0,x=V,A=V+8|0,T=u+548|0,E=u+556|0,M=(s[T>>2]|0)-(s[E>>2]|0)|0,s[A+0>>2]=0,s[A+4>>2]=0,s[A+8>>2]=0,s[A+12>>2]=0,Gi(A,M),M=A+16|0,n[M>>0]=0,wt(u,A),(s[u+44>>2]|0)>1&&(F=s[A+4>>2]<<2,s[x>>2]=s[T>>2]<<2,s[x+4>>2]=F,Tt(1888,x|0)|0),n[u+560>>0]=n[M>>0]|0,M=u+544|0,x=s[M>>2]|0,x&&di(x),s[M>>2]=s[A>>2],s[T>>2]=s[A+4>>2],s[u+552>>2]=s[A+8>>2],s[E>>2]=s[A+12>>2],m=V}function Kt(){var u=0,A=0,T=0;u=m,m=m+16|0,A=u,n[528]=0,n[536]=1,n[544]=2,Os(552,608,624,2136,2144),s[138]=2168,y[72]=0,y[73]=1,n[592]=0,n[593]=0,r[297]=r[A+0>>1]|0,r[298]=r[A+2>>1]|0,r[299]=r[A+4>>1]|0,y[75]=.95,Os(664,720,736,2136,2144),s[166]=2168,y[86]=0,y[87]=1,n[704]=0,n[705]=0,r[353]=r[A+0>>1]|0,r[354]=r[A+2>>1]|0,r[355]=r[A+4>>1]|0,y[89]=.999,Os(776,832,848,2136,2144),s[194]=2168,y[100]=0,y[101]=1,n[816]=1,n[817]=1,r[409]=r[A+0>>1]|0,r[410]=r[A+2>>1]|0,r[411]=r[A+4>>1]|0,y[103]=0,Os(936,992,1008,2136,2144),s[234]=2168,y[120]=0,y[121]=Ae,n[976]=0,n[977]=0,r[489]=r[A+0>>1]|0,r[490]=r[A+2>>1]|0,r[491]=r[A+4>>1]|0,y[123]=91648253,Os(1048,1080,1096,2136,2016),s[262]=280,T=1068,s[T>>2]=0,s[T+4>>2]=2,s[269]=2,Os(1160,1192,1208,2136,2016),s[290]=280,T=1180,s[T>>2]=0,s[T+4>>2]=2,s[297]=2,Os(1272,1296,1312,2136,1992),s[318]=160,n[1292]=0,Os(1344,1368,1376,2136,1992),s[336]=160,n[1364]=1,Os(1408,1440,1448,2136,2016),s[352]=280,T=1428,s[T>>2]=1,s[T+4>>2]=2147483647,s[359]=100,Os(1480,1536,1544,2136,2144),s[370]=2168,y[188]=1,y[189]=Ae,n[1520]=0,n[1521]=0,r[761]=r[A+0>>1]|0,r[762]=r[A+2>>1]|0,r[763]=r[A+4>>1]|0,y[191]=2,Os(1584,1640,1648,2136,2144),s[396]=2168,y[201]=0,y[202]=Ae,n[1624]=0,n[1625]=0,r[813]=r[A+0>>1]|0,r[814]=r[A+2>>1]|0,r[815]=r[A+4>>1]|0,y[204]=.2,Os(1728,1760,1776,2136,2016),s[432]=280,A=1748,s[A>>2]=0,s[A+4>>2]=2147483647,s[439]=0,m=u}function jt(u){u=u|0;var A=0;A=m,tt(u),m=A}function hi(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0;if(T=m,m=m+16|0,M=T,V=T+8|0,(n[A>>0]|0)!=45)return U=0,m=T,U|0;K=A+1|0,E=u+4|0,x=s[E>>2]|0,F=n[x>>0]|0;e:do if(F<<24>>24){for(R=0;;){if(U=R,R=R+1|0,(n[K>>0]|0)!=F<<24>>24){u=0;break}if(F=n[x+R>>0]|0,K=A+(U+2)|0,!(F<<24>>24))break e}return m=T,u|0}while(!1);return(n[K>>0]|0)!=61||(x=K+1|0,te=+Jl(x,V),!(s[V>>2]|0))?(U=0,m=T,U|0):(ne=+y[u+32>>3],te>=ne&&(n[u+41>>0]|0)==0|te!=ne&&(U=s[X>>2]|0,R=s[E>>2]|0,s[M>>2]=x,s[M+4>>2]=R,Di(U|0,2024,M|0)|0,ks(1)),ne=+y[u+24>>3],te<=ne&&(n[u+40>>0]|0)==0|te!=ne&&(U=s[X>>2]|0,R=s[E>>2]|0,s[M>>2]=x,s[M+4>>2]=R,Di(U|0,2080,M|0)|0,ks(1)),y[u+48>>3]=te,U=1,m=T,U|0)}function Ri(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0;if(T=m,m=m+48|0,E=T,V=s[X>>2]|0,U=s[u+16>>2]|0,F=n[u+40>>0]|0?91:40,R=+y[u+24>>3],K=+y[u+32>>3],M=n[u+41>>0]|0?93:41,x=+y[u+48>>3],s[E>>2]=s[u+4>>2],s[E+4>>2]=U,s[E+8>>2]=F,F=E+12|0,y[D>>3]=R,s[F>>2]=s[D>>2],s[F+4>>2]=s[D+4>>2],F=E+20|0,y[D>>3]=K,s[F>>2]=s[D>>2],s[F+4>>2]=s[D+4>>2],s[E+28>>2]=M,M=E+32|0,y[D>>3]=x,s[M>>2]=s[D>>2],s[M+4>>2]=s[D+4>>2],Di(V|0,2232,E|0)|0,!A){m=T;return}s[E>>2]=s[u+8>>2],Di(V|0,2e3,E|0)|0,mi(10,V|0)|0,m=T}function Gi(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0;if(T=m,E=u+8|0,V=s[E>>2]|0,V>>>0<A>>>0)x=V;else{m=T;return}for(;!(x>>>0>=A>>>0);)if(x=((x>>>3)+2+(x>>>1)&-2)+x|0,s[E>>2]=x,x>>>0<=V>>>0){M=4;break}(M|0)==4&&Yt(ye(1)|0,48,0),E=ps(s[u>>2]|0,x<<2)|0,!(E|0)&&(s[(Rt()|0)>>2]|0)==12&&Yt(ye(1)|0,48,0),s[u>>2]=E,m=T}function Cs(u){u=u|0;var A=0,T=0,E=0,V=0,M=0,x=0,F=0;if(A=m,E=u+32|0,T=s[E>>2]|0,T&&(s[u+36>>2]=0,di(T),s[E>>2]=0,s[u+40>>2]=0),E=u+16|0,T=s[E>>2]|0,T&&(s[u+20>>2]=0,di(T),s[E>>2]=0,s[u+24>>2]=0),E=s[u>>2]|0,!E){m=A;return}if(T=u+4|0,M=s[T>>2]|0,(M|0)>0){V=0;do F=E+(V*12|0)|0,x=s[F>>2]|0,x&&(s[E+(V*12|0)+4>>2]=0,di(x),s[F>>2]=0,s[E+(V*12|0)+8>>2]=0,E=s[u>>2]|0,M=s[T>>2]|0),V=V+1|0;while((V|0)<(M|0))}s[T>>2]=0,di(E),s[u>>2]=0,s[u+8>>2]=0,m=A}function En(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0;if(V=m,m=m+16|0,E=V+4|0,T=V,R=s[A>>2]|0,x=R+1|0,M=u+4|0,(s[M>>2]|0)<(x|0)){if(K=u+8|0,F=s[K>>2]|0,(F|0)<(x|0)&&(U=R+2-F&-2,R=(F>>1)+2&-2,R=(U|0)>(R|0)?U:R,(R|0)>(2147483647-F|0)&&(U=ye(1)|0,Yt(U|0,48,0)),te=s[u>>2]|0,U=R+F|0,s[K>>2]=U,U=ps(te,U*12|0)|0,s[u>>2]=U,!(U|0)&&(s[(Rt()|0)>>2]|0)==12&&(te=ye(1)|0,Yt(te|0,48,0))),K=s[M>>2]|0,(K|0)<(x|0)){F=s[u>>2]|0;do R=F+(K*12|0)|0,R&&(s[R>>2]=0,s[F+(K*12|0)+4>>2]=0,s[F+(K*12|0)+8>>2]=0),K=K+1|0;while((K|0)!=(x|0))}s[M>>2]=x,R=s[A>>2]|0}if(M=s[u>>2]|0,!(s[M+(R*12|0)>>2]|0)){U=R,te=u+16|0,s[T>>2]=U,s[E+0>>2]=s[T+0>>2],zn(te,E,0),m=V;return}s[M+(R*12|0)+4>>2]=0,U=s[A>>2]|0,te=u+16|0,s[T>>2]=U,s[E+0>>2]=s[T+0>>2],zn(te,E,0),m=V}function as(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0,K=0;if(E=m,T=u+4|0,(s[T>>2]|0)>=(A|0)){m=E;return}if(M=u+8|0,V=s[M>>2]|0,(V|0)<(A|0)&&(F=A+1-V&-2,x=(V>>1)+2&-2,x=(F|0)>(x|0)?F:x,(x|0)>(2147483647-V|0)&&(F=ye(1)|0,Yt(F|0,48,0)),K=s[u>>2]|0,F=x+V|0,s[M>>2]=F,F=ps(K,F)|0,s[u>>2]=F,!(F|0)&&(s[(Rt()|0)>>2]|0)==12&&(K=ye(1)|0,Yt(K|0,48,0))),V=s[T>>2]|0,(V|0)<(A|0)){u=s[u>>2]|0;do M=u+V|0,M&&(n[M>>0]=0),V=V+1|0;while((V|0)!=(A|0))}s[T>>2]=A,m=E}function ss(u,A,T){u=u|0,A=A|0,T=T|0;var E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0;if(M=m,V=A+1|0,E=u+4|0,(s[E>>2]|0)>=(V|0)){K=s[u>>2]|0,K=K+A|0,n[K>>0]=T,m=M;return}if(F=u+8|0,x=s[F>>2]|0,(x|0)<(V|0)&&(R=A+2-x&-2,K=(x>>1)+2&-2,K=(R|0)>(K|0)?R:K,(K|0)>(2147483647-x|0)&&(R=ye(1)|0,Yt(R|0,48,0)),U=s[u>>2]|0,R=K+x|0,s[F>>2]=R,R=ps(U,R)|0,s[u>>2]=R,!(R|0)&&(s[(Rt()|0)>>2]|0)==12&&(U=ye(1)|0,Yt(U|0,48,0))),x=s[E>>2]|0,(x|0)<(V|0))do F=(s[u>>2]|0)+x|0,F&&(n[F>>0]=0),x=x+1|0;while((x|0)!=(V|0));s[E>>2]=V,U=s[u>>2]|0,U=U+A|0,n[U>>0]=T,m=M}function xi(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0;if(T=m,m=m+16|0,M=T,s[M>>2]=A,x=u+12|0,V=A+1|0,E=u+16|0,(s[E>>2]|0)<(V|0)&&(K=u+20|0,F=s[K>>2]|0,(F|0)<(V|0)&&(U=A+2-F&-2,R=(F>>1)+2&-2,R=(U|0)>(R|0)?U:R,(R|0)>(2147483647-F|0)&&(U=ye(1)|0,Yt(U|0,48,0)),te=s[x>>2]|0,U=R+F|0,s[K>>2]=U,U=ps(te,U<<2)|0,s[x>>2]=U,!(U|0)&&(s[(Rt()|0)>>2]|0)==12&&(te=ye(1)|0,Yt(te|0,48,0))),F=s[E>>2]|0,(V|0)>(F|0)&&Ha((s[x>>2]|0)+(F<<2)|0,-1,V-F<<2|0)|0,s[E>>2]=V),s[(s[x>>2]|0)+(A<<2)>>2]=s[u+4>>2],$i(u,M),E=s[x>>2]|0,M=s[E+(A<<2)>>2]|0,A=s[u>>2]|0,V=s[A+(M<<2)>>2]|0,!M){U=0,te=A+(U<<2)|0,s[te>>2]=V,te=E+(V<<2)|0,s[te>>2]=U,m=T;return}for(u=u+28|0;;){if(x=M,M=M+-1>>1,F=A+(M<<2)|0,K=s[F>>2]|0,te=s[s[u>>2]>>2]|0,!(+y[te+(V<<3)>>3]>+y[te+(K<<3)>>3])){u=14;break}if(s[A+(x<<2)>>2]=K,s[E+(s[F>>2]<<2)>>2]=x,!M){x=0,u=14;break}}if((u|0)==14){te=A+(x<<2)|0,s[te>>2]=V,te=E+(V<<2)|0,s[te>>2]=x,m=T;return}}function Hs(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0;if(T=m,E=u+4|0,V=s[E>>2]|0,M=u+8|0,x=s[M>>2]|0,(V|0)==(x|0)&(x|0)<(V+1|0)?(x=(V>>1)+2&-2,x=(x|0)<2?2:x,(x|0)>(2147483647-V|0)&&(x=ye(1)|0,Yt(x|0,48,0)),F=s[u>>2]|0,V=x+V|0,s[M>>2]=V,V=ps(F,V<<2)|0,s[u>>2]=V,!(V|0)&&(s[(Rt()|0)>>2]|0)==12&&(F=ye(1)|0,Yt(F|0,48,0))):V=s[u>>2]|0,F=s[E>>2]|0,s[E>>2]=F+1,E=V+(F<<2)|0,!E){m=T;return}s[E>>2]=s[A>>2],m=T}function $i(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0;if(T=m,E=u+4|0,V=s[E>>2]|0,M=u+8|0,x=s[M>>2]|0,(V|0)==(x|0)&(x|0)<(V+1|0)?(x=(V>>1)+2&-2,x=(x|0)<2?2:x,(x|0)>(2147483647-V|0)&&(x=ye(1)|0,Yt(x|0,48,0)),F=s[u>>2]|0,V=x+V|0,s[M>>2]=V,V=ps(F,V<<2)|0,s[u>>2]=V,!(V|0)&&(s[(Rt()|0)>>2]|0)==12&&(F=ye(1)|0,Yt(F|0,48,0))):V=s[u>>2]|0,F=s[E>>2]|0,s[E>>2]=F+1,E=V+(F<<2)|0,!E){m=T;return}s[E>>2]=s[A>>2],m=T}function Ps(u,A,T){u=u|0,A=A|0,T=T|0;var E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0;if(T=m,m=m+16|0,E=T+2|0,M=T+1|0,V=T,(A|0)<16){if(V=A+-1|0,(V|0)>0)M=0;else{m=T;return}do{if(E=M,M=M+1|0,(M|0)<(A|0)){F=E,x=M;do F=(s[u+(x<<2)>>2]|0)<(s[u+(F<<2)>>2]|0)?x:F,x=x+1|0;while((x|0)!=(A|0))}else F=E;U=u+(E<<2)|0,te=s[U>>2]|0,ne=u+(F<<2)|0,s[U>>2]=s[ne>>2],s[ne>>2]=te}while((M|0)!=(V|0));m=T;return}for(x=s[u+(((A|0)/2|0)<<2)>>2]|0,R=-1,U=A;;){do R=R+1|0,K=u+(R<<2)|0,F=s[K>>2]|0;while((F|0)<(x|0));do U=U+-1|0,te=u+(U<<2)|0,ne=s[te>>2]|0;while((x|0)<(ne|0));if((R|0)>=(U|0))break;s[K>>2]=ne,s[te>>2]=F}n[E+0>>0]=n[M+0>>0]|0,Ps(u,R,E),ne=A-R|0,n[E+0>>0]=n[V+0>>0]|0,Ps(K,ne,E),m=T}function Ns(u,A,T){u=u|0,A=A|0,T=T|0;var E=0,V=0,M=0,x=0,F=0,K=0;if(E=m,x=T&1,M=a[u+16>>0]|0|x,V=A+4|0,F=((M+(s[V>>2]|0)<<2)+4|0)>>>2,K=u+4|0,Gi(u,F+(s[K>>2]|0)|0),T=s[K>>2]|0,F=F+T|0,s[K>>2]=F,F>>>0<T>>>0&&Yt(ye(1)|0,48,0),u=(s[u>>2]|0)+(T<<2)|0,!u)return m=E,T|0;if(M=M<<3|x<<2,s[u>>2]=s[u>>2]&-32|M,M=s[V>>2]<<5|M,s[u>>2]=M,(s[V>>2]|0)>0){M=s[A>>2]|0,A=0;do s[u+(A<<2)+4>>2]=s[M+(A<<2)>>2],A=A+1|0;while((A|0)<(s[V>>2]|0));M=s[u>>2]|0}if(!(M&8))return m=E,T|0;if(V=M>>>5,M&4)return c[u+(V<<2)+4>>2]=0,m=E,T|0;if(!V)V=0,M=0;else{M=0,A=0;do M=1<<((s[u+(A<<2)+4>>2]|0)>>>1&31)|M,A=A+1|0;while((A|0)<(V|0))}return s[u+(V<<2)+4>>2]=M,m=E,T|0}function br(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0;if(T=m,E=u+4|0,V=s[E>>2]|0,M=u+8|0,x=s[M>>2]|0,(V|0)==(x|0)&(x|0)<(V+1|0)?(x=(V>>1)+2&-2,x=(x|0)<2?2:x,(x|0)>(2147483647-V|0)&&(x=ye(1)|0,Yt(x|0,48,0)),F=s[u>>2]|0,V=x+V|0,s[M>>2]=V,V=ps(F,V<<3)|0,s[u>>2]=V,!(V|0)&&(s[(Rt()|0)>>2]|0)==12&&(F=ye(1)|0,Yt(F|0,48,0))):V=s[u>>2]|0,F=s[E>>2]|0,s[E>>2]=F+1,E=V+(F<<3)|0,!E){m=T;return}M=A,x=s[M+4>>2]|0,F=E,s[F>>2]=s[M>>2],s[F+4>>2]=x,m=T}function on(u){u=u|0;var A=0,T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0,_e=0,ge=0;if(A=m,T=s[u>>2]|0,V=s[T>>2]|0,F=u+4|0,te=s[T+((s[F>>2]|0)+-1<<2)>>2]|0,s[T>>2]=te,E=s[u+12>>2]|0,s[E+(te<<2)>>2]=0,s[E+(V<<2)>>2]=-1,te=(s[F>>2]|0)+-1|0,s[F>>2]=te,(te|0)<=1)return m=A,V|0;for(M=s[T>>2]|0,K=u+28|0,u=0,R=1;U=(u<<1)+2|0,(U|0)<(te|0)?(ne=s[T+(U<<2)>>2]|0,ge=s[T+(R<<2)>>2]|0,te=s[s[K>>2]>>2]|0,ee=+y[te+(ne<<3)>>3],_e=+y[te+(ge<<3)>>3],ee>_e||(ne=ge,ee=_e,x=6)):(te=s[s[K>>2]>>2]|0,x=s[T+(R<<2)>>2]|0,ne=x,ee=+y[te+(x<<3)>>3],x=6),(x|0)==6&&(x=0,U=R),ee>+y[te+(M<<3)>>3];)if(s[T+(u<<2)>>2]=ne,s[E+(ne<<2)>>2]=u,R=U<<1|1,te=s[F>>2]|0,(R|0)>=(te|0)){u=U;break}else u=U;return s[T+(u<<2)>>2]=M,s[E+(M<<2)>>2]=u,m=A,V|0}function zn(u,A,T){u=u|0,A=A|0,T=T|0;var E=0,V=0,M=0,x=0,F=0,K=0,R=0;if(E=m,F=s[A>>2]|0,A=F+1|0,V=u+4|0,(s[V>>2]|0)>=(A|0)){m=E;return}if(x=u+8|0,M=s[x>>2]|0,(M|0)<(A|0)&&(K=F+2-M&-2,F=(M>>1)+2&-2,F=(K|0)>(F|0)?K:F,(F|0)>(2147483647-M|0)&&(K=ye(1)|0,Yt(K|0,48,0)),R=s[u>>2]|0,K=F+M|0,s[x>>2]=K,K=ps(R,K)|0,s[u>>2]=K,!(K|0)&&(s[(Rt()|0)>>2]|0)==12&&(R=ye(1)|0,Yt(R|0,48,0))),M=s[V>>2]|0,(M|0)<(A|0))do n[(s[u>>2]|0)+M>>0]=T,M=M+1|0;while((M|0)!=(A|0));s[V>>2]=A,m=E}function $n(u,A,T){u=u|0,A=A|0,T=T|0;var E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0,_e=0,ge=0,Oe=0,$e=0,Ye=0;if(E=m,m=m+16|0,M=E+8|0,V=E+4|0,x=E,(A|0)<16){if(V=A+-1|0,(V|0)<=0){m=E;return}M=s[T>>2]|0,T=0;do{if(x=T,T=T+1|0,(T|0)<(A|0)){F=s[M>>2]|0,R=x,K=T;do U=F+(s[u+(K<<2)>>2]<<2)|0,$e=s[U>>2]|0,ee=$e>>>5,$e>>>0>95&&(te=F+(s[u+(R<<2)>>2]<<2)|0,ne=(s[te>>2]|0)>>>5,(ne|0)==2?R=K:R=+c[U+(ee<<2)+4>>2]<+c[te+(ne<<2)+4>>2]?K:R),K=K+1|0;while((K|0)!=(A|0))}else R=x;ge=u+(x<<2)|0,Oe=s[ge>>2]|0,$e=u+(R<<2)|0,s[ge>>2]=s[$e>>2],s[$e>>2]=Oe}while((T|0)!=(V|0));m=E;return}for(F=s[u+(((A|0)/2|0)<<2)>>2]|0,ee=-1,te=A;;){Oe=ee+1|0,ne=u+(Oe<<2)|0,$e=s[ne>>2]|0,K=s[T>>2]|0,R=s[K>>2]|0,ge=R+($e<<2)|0,_e=s[ge>>2]|0,ee=R+(F<<2)|0,U=s[ee>>2]|0;e:do if(_e>>>0>95)for(;;){if(Ye=U>>>5,(Ye|0)!=2&&!(+c[ge+(_e>>>5<<2)+4>>2]<+c[ee+(Ye<<2)+4>>2])){ee=Oe;break e}if(Oe=Oe+1|0,ne=u+(Oe<<2)|0,$e=s[ne>>2]|0,ge=R+($e<<2)|0,_e=s[ge>>2]|0,_e>>>0<=95){ee=Oe;break}}else ee=Oe;while(!1);te=te+-1|0,ge=u+(te<<2)|0,_e=R+(F<<2)|0;e:do if(U>>>0>95)for(;;){if(Oe=R+(s[ge>>2]<<2)|0,Ye=(s[Oe>>2]|0)>>>5,(Ye|0)!=2&&!(+c[_e+(U>>>5<<2)+4>>2]<+c[Oe+(Ye<<2)+4>>2]))break e;Ye=te+-1|0,ge=u+(Ye<<2)|0,te=Ye}while(!1);if((ee|0)>=(te|0))break;s[ne>>2]=s[ge>>2],s[ge>>2]=$e}s[V>>2]=K,s[M+0>>2]=s[V+0>>2],$n(u,ee,M),Ye=A-ee|0,s[x>>2]=K,s[M+0>>2]=s[x+0>>2],$n(ne,Ye,M),m=E}function nn(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0,_e=0,ge=0;if(E=m,V=u+4|0,x=s[V>>2]|0,M=s[u>>2]|0,(x|0)>0){K=s[u+12>>2]|0,F=0;do s[K+(s[M+(F<<2)>>2]<<2)>>2]=-1,F=F+1|0,x=s[V>>2]|0;while((F|0)<(x|0))}if(M&&(s[V>>2]=0,x=0),M=A+4|0,(s[M>>2]|0)>0){F=u+12|0,x=0;do ge=(s[A>>2]|0)+(x<<2)|0,s[(s[F>>2]|0)+(s[ge>>2]<<2)>>2]=x,$i(u,ge),x=x+1|0;while((x|0)<(s[M>>2]|0));x=s[V>>2]|0}if((x|0)<=1){m=E;return}for(M=s[u>>2]|0,A=u+28|0,u=u+12|0,te=x,F=(x|0)/2|0;;){F=F+-1|0,x=s[M+(F<<2)>>2]|0,R=F<<1|1;e:do if((R|0)<(te|0))for(K=F;;){if(U=(K<<1)+2|0,(U|0)<(te|0)?(ne=s[M+(U<<2)>>2]|0,ge=s[M+(R<<2)>>2]|0,te=s[s[A>>2]>>2]|0,ee=+y[te+(ne<<3)>>3],_e=+y[te+(ge<<3)>>3],ee>_e||(ne=ge,ee=_e,T=16)):(te=s[s[A>>2]>>2]|0,T=s[M+(R<<2)>>2]|0,ne=T,ee=+y[te+(T<<3)>>3],T=16),(T|0)==16&&(T=0,U=R),!(ee>+y[te+(x<<3)>>3]))break e;if(s[M+(K<<2)>>2]=ne,s[(s[u>>2]|0)+(ne<<2)>>2]=K,R=U<<1|1,te=s[V>>2]|0,(R|0)>=(te|0)){K=U;break}else K=U}else K=F;while(!1);if(s[M+(K<<2)>>2]=x,s[(s[u>>2]|0)+(x<<2)>>2]=K,(F|0)<=0)break;te=s[V>>2]|0}m=E}function rr(u){u=u|0;var A=0,T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0,_e=0,ge=0;if(T=m,A=u+36|0,K=s[A>>2]|0,E=u+32|0,U=s[E>>2]|0,(K|0)>0){M=u+16|0,V=u+44|0,x=0;do{if(F=U+(x<<2)|0,R=s[F>>2]|0,n[(s[M>>2]|0)+R>>0]|0){if(U=s[u>>2]|0,K=U+(R*12|0)+4|0,ne=s[K>>2]|0,(ne|0)>0){R=U+(R*12|0)|0,U=0,te=0;do ee=s[R>>2]|0,_e=ee+(U<<3)|0,(s[(s[s[V>>2]>>2]|0)+(s[_e>>2]<<2)>>2]&3|0)!=1&&(ge=_e,_e=s[ge+4>>2]|0,ne=ee+(te<<3)|0,s[ne>>2]=s[ge>>2],s[ne+4>>2]=_e,ne=s[K>>2]|0,te=te+1|0),U=U+1|0;while((U|0)<(ne|0))}else U=0,te=0;R=U-te|0,(R|0)>0&&(s[K>>2]=ne-R),n[(s[M>>2]|0)+(s[F>>2]|0)>>0]=0,K=s[A>>2]|0,U=s[E>>2]|0}x=x+1|0}while((x|0)<(K|0))}if(!U){m=T;return}s[A>>2]=0,m=T}function Gs(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0;if(E=m,M=s[A>>2]|0,V=M>>>2&1|(a[u+16>>0]|0),M=((V+(M>>>5)<<2)+4|0)>>>2,x=u+4|0,Gi(u,M+(s[x>>2]|0)|0),T=s[x>>2]|0,M=M+T|0,s[x>>2]=M,M>>>0<T>>>0&&Yt(ye(1)|0,48,0),u=(s[u>>2]|0)+(T<<2)|0,!u)return m=E,T|0;if(V=s[A>>2]&-9|V<<3,s[u>>2]=V,(s[A>>2]|0)>>>0>31){V=0;do s[u+(V<<2)+4>>2]=s[A+(V<<2)+4>>2],V=V+1|0;while((V|0)<((s[A>>2]|0)>>>5|0));V=s[u>>2]|0}return V&8?(M=V>>>5,A=A+(M<<2)+4|0,V&4?(c[u+(M<<2)+4>>2]=+c[A>>2],m=E,T|0):(s[u+(M<<2)+4>>2]=s[A>>2],m=E,T|0)):(m=E,T|0)}function or(u){u=u|0;var A=0,T=0,E=0,V=0,M=0,x=0;if(A=m,m=m+16|0,V=A,Ur(u),s[u>>2]=3424,s[u+684>>2]=s[719],s[u+688>>2]=s[747],s[u+692>>2]=s[785],y[u+696>>3]=+y[411],n[u+704>>0]=n[2652]|0,n[u+705>>0]=n[2724]|0,n[u+706>>0]=n[2804]|0,n[u+707>>0]=1,s[u+708>>2]=0,s[u+712>>2]=0,s[u+716>>2]=0,s[u+720>>2]=1,n[u+724>>0]=1,T=u+732|0,x=u+544|0,s[u+760>>2]=0,s[u+764>>2]=0,s[u+768>>2]=0,s[u+776>>2]=0,s[u+780>>2]=0,s[u+784>>2]=0,s[u+792>>2]=0,s[u+796>>2]=0,s[u+800>>2]=0,M=u+804|0,s[T+0>>2]=0,s[T+4>>2]=0,s[T+8>>2]=0,s[T+12>>2]=0,s[T+16>>2]=0,s[T+20>>2]=0,s[M>>2]=x,M=u+808|0,s[M>>2]=0,s[u+812>>2]=0,s[u+816>>2]=0,T=u+824|0,s[T+0>>2]=0,s[T+4>>2]=0,s[T+8>>2]=0,s[T+12>>2]=0,s[T+16>>2]=0,s[T+20>>2]=0,s[u+852>>2]=M,qr(u+856|0,1),M=u+868|0,T=u+892|0,s[u+920>>2]=0,s[u+924>>2]=0,s[M+0>>2]=0,s[M+4>>2]=0,s[M+8>>2]=0,s[M+12>>2]=0,s[M+16>>2]=0,s[T+0>>2]=0,s[T+4>>2]=0,s[T+8>>2]=0,s[T+12>>2]=0,s[T+16>>2]=0,s[T+20>>2]=0,T=V+4|0,s[T>>2]=0,M=V+8|0,s[M>>2]=2,E=ps(0,8)|0,s[V>>2]=E,!(E|0)&&(s[(Rt()|0)>>2]|0)==12&&Yt(ye(1)|0,48,0),s[E>>2]=-2,s[T>>2]=1,n[u+560>>0]=1,s[u+928>>2]=Ns(x,V,0)|0,n[u+536>>0]=0,!E){m=A;return}s[T>>2]=0,di(E),s[V>>2]=0,s[M>>2]=0,m=A}function an(u){u=u|0;var A=0;A=m,Sr(u),tt(u),m=A}function Sr(u){u=u|0;var A=0,T=0,E=0;if(A=m,s[u>>2]=3424,T=u+904|0,E=s[T>>2]|0,E&&(s[u+908>>2]=0,di(E),s[T>>2]=0,s[u+912>>2]=0),T=u+892|0,E=s[T>>2]|0,E&&(s[u+896>>2]=0,di(E),s[T>>2]=0,s[u+900>>2]=0),T=u+876|0,E=s[T>>2]|0,E&&(s[u+880>>2]=0,di(E),s[T>>2]=0,s[u+884>>2]=0),T=u+856|0,E=s[T>>2]|0,E&&(s[u+860>>2]=0,di(E),s[T>>2]=0,s[u+864>>2]=0),E=u+836|0,T=s[E>>2]|0,T&&(s[u+840>>2]=0,di(T),s[E>>2]=0,s[u+844>>2]=0),T=u+824|0,E=s[T>>2]|0,E&&(s[u+828>>2]=0,di(E),s[T>>2]=0,s[u+832>>2]=0),T=u+808|0,E=s[T>>2]|0,E&&(s[u+812>>2]=0,di(E),s[T>>2]=0,s[u+816>>2]=0),Qo(u+760|0),T=u+744|0,E=s[T>>2]|0,E&&(s[u+748>>2]=0,di(E),s[T>>2]=0,s[u+752>>2]=0),T=u+732|0,E=s[T>>2]|0,!E){ro(u),m=A;return}s[u+736>>2]=0,di(E),s[T>>2]=0,s[u+740>>2]=0,ro(u),m=A}function rn(u,A,T){u=u|0,A=A|0,T=T|0;var E=0,V=0,M=0,x=0,F=0,K=0;return E=m,m=m+32|0,M=E+12|0,F=E+8|0,K=E+16|0,V=E+4|0,x=E,n[K>>0]=n[A>>0]|0,n[M+0>>0]=n[K+0>>0]|0,T=wo(u,M,T)|0,s[F>>2]=T,ss(u+876|0,T,0),ss(u+904|0,T,0),n[u+724>>0]|0?(K=u+808|0,A=T<<1,s[V>>2]=A,s[M+0>>2]=s[V+0>>2],Jo(K,M,0),s[x>>2]=A|1,s[M+0>>2]=s[x+0>>2],Jo(K,M,0),ar(u+760|0,F),ss(u+744|0,T,0),In(u+824|0,T),m=E,T|0):(m=E,T|0)}function _s(u,A,T,E){u=u|0,A=A|0,T=T|0,E=E|0;var V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0,_e=0,ge=0,Oe=0,$e=0,Ye=0,it=0;if(x=m,m=m+32|0,V=x+4|0,ee=x,te=x+16|0,s[V>>2]=0,M=V+4|0,s[M>>2]=0,F=V+8|0,s[F>>2]=0,_e=n[2608]|0,n[u>>0]=_e,K=A+724|0,T=(a[K>>0]&(T&1)|0)!=0,T){if(Oe=A+308|0,it=s[Oe>>2]|0,(it|0)>0){ge=A+304|0,_e=A+876|0,$e=0;do Ye=s[(s[ge>>2]|0)+($e<<2)>>2]>>1,s[ee>>2]=Ye,Ye=(s[_e>>2]|0)+Ye|0,n[Ye>>0]|0||(n[Ye>>0]=1,$i(V,ee),it=s[Oe>>2]|0),$e=$e+1|0;while(($e|0)<(it|0))}ee=(Ar(A,E)|0)&1^1,n[u>>0]=ee,E=n[2608]|0}else E=_e,ee=_e;if(it=E&255,(it>>>1^1)&ee<<24>>24==E<<24>>24|it&2&(ee&255)?(yt(te,A),ee=n[te>>0]|0,n[u>>0]=ee):(s[A+44>>2]|0)>0&&bt(3760)|0,Ye=n[2608]|0,it=Ye&255,(it>>>1^1)&ee<<24>>24==Ye<<24>>24|it&2&(ee&255)|0&&n[A+707>>0]|0&&(ne=(s[A+736>>2]|0)+-1|0,(ne|0)>0)){u=A+732|0,te=A+4|0;do{E=s[u>>2]|0,Oe=s[E+(ne<<2)>>2]|0,$e=ne+-1|0,Ye=s[E+($e<<2)>>2]|0,ne=s[te>>2]|0;e:do if((Oe|0)>1)for(_e=n[2616]|0,ee=_e&255,ge=ee&2,ee=ee>>>1^1,it=$e;;){if(Ye=a[ne+(Ye>>1)>>0]^Ye&1,$e=Oe+-1|0,!((Ye&255)<<24>>24==_e<<24>>24&ee|ge&Ye))break e;if(Oe=it+-1|0,Ye=s[E+(Oe<<2)>>2]|0,($e|0)>1)it=Oe,Oe=$e;else{it=Oe,Oe=$e,U=20;break}}else it=$e,U=20;while(!1);(U|0)==20&&(U=0,n[ne+(Ye>>1)>>0]=(Ye&1^1)&255^1),ne=it-Oe|0}while((ne|0)>0)}if(T&&(R=s[M>>2]|0,(R|0)>0)){U=s[V>>2]|0,T=A+876|0,te=0;do u=s[U+(te<<2)>>2]|0,n[(s[T>>2]|0)+u>>0]=0,n[K>>0]|0&&vs(A,u),te=te+1|0;while((te|0)<(R|0))}if(A=s[V>>2]|0,!A){m=x;return}s[M>>2]=0,di(A),s[V>>2]=0,s[F>>2]=0,m=x}function Ar(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0,_e=0,ge=0,Oe=0,$e=0,Ye=0,it=0,Dt=0,ni=0,ei=0,at=0,Ht=0,Zt=0,kt=0,Xt=0,It=0,Nt=0,Ot=0;if(F=m,m=m+16|0,M=F,!(Be(u)|0))return It=0,m=F,It|0;if(x=u+724|0,!(n[x>>0]|0))return It=1,m=F,It|0;Ye=u+924|0,Oe=u+872|0,$e=u+868|0,ge=u+860|0,ne=u+680|0,it=u+824|0,V=u+828|0,R=u+836|0,Dt=u+904|0,ni=u+332|0,T=u+44|0,ei=u+704|0,Ht=u+706|0,Zt=u+696|0,U=u+556|0,te=u+548|0,at=u+876|0,ee=u+920|0,_e=u+284|0;e:for(;!((s[Ye>>2]|0)<=0&&(s[ee>>2]|0)>=(s[_e>>2]|0)&&(s[V>>2]|0)<=0);){if(ao(u),Xt=s[Oe>>2]|0,It=s[$e>>2]|0,kt=Xt-It|0,(Xt|0)<(It|0)&&(kt=(s[ge>>2]|0)+kt|0),(kt|0)<=0&&(s[ee>>2]|0)>=(s[_e>>2]|0)||(K=11),(K|0)==11&&(K=0,!(jo(u,1)|0))){K=12;break}if(It=s[V>>2]|0,n[ne>>0]|0){K=15;break}if(It)kt=0;else continue;for(;;){if(Ot=s[it>>2]|0,Xt=s[Ot>>2]|0,Nt=s[Ot+(It+-1<<2)>>2]|0,s[Ot>>2]=Nt,It=s[R>>2]|0,s[It+(Nt<<2)>>2]=0,s[It+(Xt<<2)>>2]=-1,It=(s[V>>2]|0)+-1|0,s[V>>2]=It,(It|0)>1&&Yr(it,0),n[ne>>0]|0)continue e;if(!(n[(s[Dt>>2]|0)+Xt>>0]|0)&&(Nt=n[(s[ni>>2]|0)+Xt>>0]|0,It=n[2624]|0,Ot=It&255,((Ot>>>1^1)&Nt<<24>>24==It<<24>>24|Nt&2&Ot|0)!=0)){if((s[T>>2]|0)>1&((kt|0)%100|0|0)==0&&(s[M>>2]=s[V>>2],Tt(3504,M|0)|0),n[ei>>0]|0){if(Ot=(s[at>>2]|0)+Xt|0,It=n[Ot>>0]|0,n[Ot>>0]=1,!(rl(u,Xt)|0)){K=29;break e}n[(s[at>>2]|0)+Xt>>0]=It<<24>>24!=0&1}if(n[Ht>>0]|0&&(Nt=n[(s[ni>>2]|0)+Xt>>0]|0,It=n[2624]|0,Ot=It&255,((Ot>>>1^1)&Nt<<24>>24==It<<24>>24|Nt&2&Ot|0)!=0)&&!(n[(s[at>>2]|0)+Xt>>0]|0)&&!(Eo(u,Xt)|0)){K=35;break e}+((s[U>>2]|0)>>>0)>+y[Zt>>3]*+((s[te>>2]|0)>>>0)&&ho[s[(s[u>>2]|0)+8>>2]&31](u)}if(It=s[V>>2]|0,It)kt=kt+1|0;else continue e}}do if((K|0)==12)n[u+492>>0]=0;else if((K|0)==15){if(ne=s[u+824>>2]|0,(It|0)<=0){if(!ne)break}else{_e=s[R>>2]|0,ee=0;do s[_e+(s[ne+(ee<<2)>>2]<<2)>>2]=-1,ee=ee+1|0;while((ee|0)<(s[V>>2]|0))}s[V>>2]=0}else((K|0)==29||(K|0)==35)&&(n[u+492>>0]=0);while(!1);if(!A)+((s[U>>2]|0)>>>0)>+y[u+96>>3]*+((s[te>>2]|0)>>>0)&&ho[s[(s[u>>2]|0)+8>>2]&31](u);else{if(A=u+744|0,U=s[A>>2]|0,U&&(s[u+748>>2]=0,di(U),s[A>>2]=0,s[u+752>>2]=0),Vn(u+760|0,1),A=u+808|0,U=s[A>>2]|0,U&&(s[u+812>>2]=0,di(U),s[A>>2]=0,s[u+816>>2]=0),U=u+824|0,A=s[U>>2]|0,(s[V>>2]|0)<=0)A&&(K=48);else{K=s[R>>2]|0,R=0;do s[K+(s[A+(R<<2)>>2]<<2)>>2]=-1,R=R+1|0;while((R|0)<(s[V>>2]|0));K=48}(K|0)==48&&(s[V>>2]=0,di(A),s[U>>2]=0,s[u+832>>2]=0),hn(u+856|0,1),n[x>>0]=0,n[u+536>>0]=1,n[u+560>>0]=0,s[u+728>>2]=s[u+540>>2],Ee(u),ho[s[(s[u>>2]|0)+8>>2]&31](u)}return(s[T>>2]|0)>0&&(E=s[u+736>>2]|0,(E|0)>0)&&(y[D>>3]=+(E<<2>>>0)*95367431640625e-20,s[M>>2]=s[D>>2],s[M+4>>2]=s[D+4>>2],Tt(3528,M|0)|0),Ot=(n[u+492>>0]|0)!=0,m=F,Ot|0}function xn(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0;if(T=m,m=m+16|0,V=T,x=u+256|0,F=u+260|0,M=s[F>>2]|0,n[u+705>>0]|0&&oo(u,A)|0)return ne=1,m=T,ne|0;if(!(Va(u,A)|0))return ne=0,m=T,ne|0;if(!(n[u+724>>0]|0)||(A=s[F>>2]|0,(A|0)!=(M+1|0))||(ne=s[(s[x>>2]|0)+(A+-1<<2)>>2]|0,s[V>>2]=ne,R=(s[u+544>>2]|0)+(ne<<2)|0,lr(u+856|0,ne),(s[R>>2]|0)>>>0<=31))return ne=1,m=T,ne|0;K=u+760|0,F=u+808|0,x=u+744|0,M=u+924|0,A=u+824|0,U=u+840|0,u=u+836|0,te=0;do ne=R+(te<<2)+4|0,On((s[K>>2]|0)+((s[ne>>2]>>1)*12|0)|0,V),ee=(s[F>>2]|0)+(s[ne>>2]<<2)|0,s[ee>>2]=(s[ee>>2]|0)+1,n[(s[x>>2]|0)+(s[ne>>2]>>1)>>0]=1,s[M>>2]=(s[M>>2]|0)+1,ne=s[ne>>2]>>1,(s[U>>2]|0)>(ne|0)&&(E=s[(s[u>>2]|0)+(ne<<2)>>2]|0,(E|0)>-1)&&Yr(A,E),te=te+1|0;while((te|0)<((s[R>>2]|0)>>>5|0));return E=1,m=T,E|0}function oo(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0,_e=0;x=m,m=m+16|0,V=x+8|0,M=x+4|0,E=x,s[M>>2]=s[u+284>>2],$i(u+292|0,M),M=A+4|0,K=s[M>>2]|0;e:do if((K|0)>0){for(T=u+332|0,F=0;R=s[(s[A>>2]|0)+(F<<2)>>2]|0,te=a[(s[T>>2]|0)+(R>>1)>>0]|0,ne=te^R&1,U=ne&255,_e=n[2608]|0,ee=_e&255,!(U<<24>>24==_e<<24>>24&(ee>>>1^1)|ee&2&ne);)if(ee=n[2616]|0,_e=ee&255,(_e>>>1^1)&U<<24>>24==ee<<24>>24|te&2&_e||(s[E>>2]=R^1,s[V+0>>2]=s[E+0>>2],_r(u,V,-1),K=s[M>>2]|0),F=F+1|0,(F|0)>=(K|0))break e;return Br(u,0),_e=1,m=x,_e|0}while(!1);return _e=(vr(u)|0)!=-1,Br(u,0),m=x,_e|0}function Fr(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0;if(T=m,m=m+16|0,V=T,E=(s[u+544>>2]|0)+(A<<2)|0,!(n[u+724>>0]|0)){Wr(u,A),m=T;return}if((s[E>>2]|0)>>>0<=31){Wr(u,A),m=T;return}x=u+808|0,F=u+776|0,M=u+792|0,K=0;do R=E+(K<<2)+4|0,U=(s[x>>2]|0)+(s[R>>2]<<2)|0,s[U>>2]=(s[U>>2]|0)+-1,vs(u,s[R>>2]>>1),R=s[R>>2]>>1,s[V>>2]=R,R=(s[F>>2]|0)+R|0,n[R>>0]|0||(n[R>>0]=1,$i(M,V)),K=K+1|0;while((K|0)<((s[E>>2]|0)>>>5|0));Wr(u,A),m=T}function Ss(u,A,T){u=u|0,A=A|0,T=T|0;var E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0,_e=0;if(E=m,m=m+16|0,M=E+4|0,V=E,F=s[u+544>>2]|0,x=F+(A<<2)|0,lr(u+856|0,A),(s[x>>2]&-32|0)==64){Fr(u,A),te=s[T>>2]|0,T=s[x>>2]|0;e:do if(T>>>0>31)for(K=T>>>5,R=0;;){if(U=R+1|0,(s[x+(R<<2)+4>>2]|0)==(te|0)){U=R;break e}if((U|0)<(K|0))R=U;else break}else K=0,U=0;while(!1);if(R=K+-1|0,(U|0)<(R|0))do T=U,U=U+1|0,s[x+(T<<2)+4>>2]=s[x+(U<<2)+4>>2],T=s[x>>2]|0,K=T>>>5,R=K+-1|0;while((U|0)<(R|0));if(T&8&&(s[x+(R<<2)+4>>2]=s[x+(K<<2)+4>>2],T=s[x>>2]|0),K=T+-32|0,s[x>>2]=K,K=K>>>5,!K)K=0,T=0;else{T=0,R=0;do T=1<<((s[x+(R<<2)+4>>2]|0)>>>1&31)|T,R=R+1|0;while((R|0)<(K|0))}s[x+(K<<2)+4>>2]=T}else{Xo(u,A,1),T=s[T>>2]|0,R=s[x>>2]|0;e:do if(R>>>0>31)for(K=R>>>5,U=0;;){if(te=U+1|0,(s[x+(U<<2)+4>>2]|0)==(T|0)){te=U;break e}if((te|0)<(K|0))U=te;else break}else K=0,te=0;while(!1);if(U=K+-1|0,(te|0)<(U|0))do R=te,te=te+1|0,s[x+(R<<2)+4>>2]=s[x+(te<<2)+4>>2],R=s[x>>2]|0,K=R>>>5,U=K+-1|0;while((te|0)<(U|0));if(R&8&&(s[x+(U<<2)+4>>2]=s[x+(K<<2)+4>>2],R=s[x>>2]|0),U=R+-32|0,s[x>>2]=U,U=U>>>5,!U)U=0,K=0;else{K=0,R=0;do K=1<<((s[x+(R<<2)+4>>2]|0)>>>1&31)|K,R=R+1|0;while((R|0)<(U|0))}s[x+(U<<2)+4>>2]=K,Gr(u,A),K=T>>1,R=s[u+760>>2]|0,U=R+(K*12|0)|0,R=R+(K*12|0)+4|0,te=s[R>>2]|0;e:do if((te|0)>0)for(_e=s[U>>2]|0,ne=0;;){if(ee=ne+1|0,(s[_e+(ne<<2)>>2]|0)==(A|0))break e;if((ee|0)<(te|0))ne=ee;else{ne=ee;break}}else ne=0;while(!1);if(te=te+-1|0,(ne|0)<(te|0)){U=s[U>>2]|0;do te=ne,ne=ne+1|0,s[U+(te<<2)>>2]=s[U+(ne<<2)>>2],te=(s[R>>2]|0)+-1|0;while((ne|0)<(te|0))}s[R>>2]=te,_e=(s[u+808>>2]|0)+(T<<2)|0,s[_e>>2]=(s[_e>>2]|0)+-1,vs(u,K)}if((s[x>>2]&-32|0)!=32)return _e=1,m=E,_e|0;if(F=s[F+(A+1<<2)>>2]|0,x=a[(s[u+332>>2]|0)+(F>>1)>>0]|0,_e=x^F&1,A=_e&255,ne=n[2624]|0,ee=ne&255,A<<24>>24==ne<<24>>24&(ee>>>1^1)|ee&2&_e)s[V>>2]=F,s[M+0>>2]=s[V+0>>2],_r(u,M,-1);else if(ee=n[2616]|0,_e=ee&255,(_e>>>1^1)&A<<24>>24==ee<<24>>24|x&2&_e)return _e=0,m=E,_e|0;return _e=(vr(u)|0)==-1,m=E,_e|0}function wr(u,A,T,E,V){u=u|0,A=A|0,T=T|0,E=E|0,V=V|0;var M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0;M=m,m=m+16|0,F=M+4|0,x=M,ne=u+708|0,s[ne>>2]=(s[ne>>2]|0)+1,s[V>>2]|0&&(s[V+4>>2]=0),K=(s[A>>2]|0)>>>5>>>0<(s[T>>2]|0)>>>5>>>0,u=K?T:A,A=K?A:T,K=s[A>>2]|0;e:do if(K>>>0>31){T=0;t:for(;;){R=s[A+(T<<2)+4>>2]|0;i:do if((R>>1|0)!=(E|0)){U=s[u>>2]|0;s:do if(U>>>0>31){for(te=0;ne=s[u+(te<<2)+4>>2]|0,te=te+1|0,!((R^ne)>>>0<2);)if((te|0)>=(U>>>5|0))break s;if((ne|0)==(R^1|0)){V=0;break t}else break i}while(!1);s[F>>2]=R,Hs(V,F),K=s[A>>2]|0}while(!1);if(T=T+1|0,(T|0)>=(K>>>5|0))break e}return m=M,V|0}while(!1);if(T=s[u>>2]|0,T>>>0<=31)return ne=1,m=M,ne|0;F=0;do A=s[u+(F<<2)+4>>2]|0,(A>>1|0)!=(E|0)&&(s[x>>2]=A,Hs(V,x),T=s[u>>2]|0),F=F+1|0;while((F|0)<(T>>>5|0));return V=1,m=M,V|0}function ao(u){u=u|0;var A=0,T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0,_e=0,ge=0,Oe=0,$e=0,Ye=0,it=0;if(A=m,F=u+924|0,!(s[F>>2]|0)){m=A;return}for(M=u+856|0,T=u+872|0,E=u+868|0,x=u+860|0,V=u+544|0,K=0;it=s[T>>2]|0,R=s[E>>2]|0,U=it-R|0,(it|0)<(R|0)&&(U=(s[x>>2]|0)+U|0),!((K|0)>=(U|0));)U=(s[V>>2]|0)+(s[(s[M>>2]|0)+(((R+K|0)%(s[x>>2]|0)|0)<<2)>>2]<<2)|0,R=s[U>>2]|0,R&3||(s[U>>2]=R&-4|2),K=K+1|0;if(K=u+540|0,ee=s[K>>2]|0,(ee|0)>0){U=u+744|0,te=u+776|0,R=u+760|0,u=u+804|0,ne=0;do{if(n[(s[U>>2]|0)+ne>>0]|0){if(_e=(s[te>>2]|0)+ne|0,n[_e>>0]|0){if(ge=s[R>>2]|0,ee=ge+(ne*12|0)+4|0,$e=s[ee>>2]|0,($e|0)>0){ge=s[ge+(ne*12|0)>>2]|0,Ye=0,Oe=0;do it=s[ge+(Ye<<2)>>2]|0,(s[(s[s[u>>2]>>2]|0)+(it<<2)>>2]&3|0)!=1&&(s[ge+(Oe<<2)>>2]=it,$e=s[ee>>2]|0,Oe=Oe+1|0),Ye=Ye+1|0;while((Ye|0)<($e|0))}else Ye=0,Oe=0;ge=Ye-Oe|0,(ge|0)>0&&(s[ee>>2]=$e-ge),n[_e>>0]=0}if(_e=s[R>>2]|0,ee=_e+(ne*12|0)+4|0,Oe=s[ee>>2]|0,(Oe|0)>0){_e=_e+(ne*12|0)|0,ge=0;do $e=s[(s[_e>>2]|0)+(ge<<2)>>2]|0,s[(s[V>>2]|0)+($e<<2)>>2]&3||(lr(M,$e),Oe=(s[V>>2]|0)+(s[(s[_e>>2]|0)+(ge<<2)>>2]<<2)|0,s[Oe>>2]=s[Oe>>2]&-4|2,Oe=s[ee>>2]|0),ge=ge+1|0;while((ge|0)<(Oe|0))}n[(s[U>>2]|0)+ne>>0]=0,ee=s[K>>2]|0}ne=ne+1|0}while((ne|0)<(ee|0));K=0}else K=0;for(;it=s[T>>2]|0,R=s[E>>2]|0,U=it-R|0,(it|0)<(R|0)&&(U=(s[x>>2]|0)+U|0),!((K|0)>=(U|0));)R=(s[V>>2]|0)+(s[(s[M>>2]|0)+(((R+K|0)%(s[x>>2]|0)|0)<<2)>>2]<<2)|0,U=s[R>>2]|0,(U&3|0)==2&&(s[R>>2]=U&-4),K=K+1|0;s[F>>2]=0,m=A}function jo(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0,_e=0,ge=0,Oe=0,$e=0,Ye=0,it=0,Dt=0,ni=0,ei=0,at=0,Ht=0,Zt=0,kt=0,Xt=0,It=0,Nt=0,Ot=0,st=0,ai=0,fi=0,ui=0,gi=0,Vi=0,bs=0,li=0;T=m,m=m+16|0,R=T,Dt=T+12|0,V=u+856|0,K=u+872|0,ee=u+868|0,x=u+860|0,$e=u+680|0,E=u+920|0,M=u+284|0,Oe=u+280|0,_e=u+544|0,ge=u+928|0,te=u+44|0,U=u+776|0,Ye=u+692|0,ne=u+804|0,F=u+760|0,Zt=0,It=0,kt=0;e:for(;;){Xt=s[ee>>2]|0;do{if(at=s[K>>2]|0,Ht=(at|0)<(Xt|0),at=at-Xt|0,Ht?Nt=(s[x>>2]|0)+at|0:Nt=at,(Nt|0)<=0&&(s[E>>2]|0)>=(s[M>>2]|0)){E=1,x=53;break e}if(n[$e>>0]|0){x=8;break e}if(Ht&&(at=(s[x>>2]|0)+at|0),!(at|0)&&(ei=s[E>>2]|0,(ei|0)<(s[M>>2]|0))){if(s[E>>2]=ei+1,s[(s[_e>>2]|0)+((s[ge>>2]|0)+1<<2)>>2]=s[(s[Oe>>2]|0)+(ei<<2)>>2],at=(s[_e>>2]|0)+(s[ge>>2]<<2)|0,Ht=(s[at>>2]|0)>>>5,!Ht)Ht=0,Nt=0;else{Nt=0,Xt=0;do Nt=1<<((s[at+(Xt<<2)+4>>2]|0)>>>1&31)|Nt,Xt=Xt+1|0;while((Xt|0)<(Ht|0))}s[at+(Ht<<2)+4>>2]=Nt,lr(V,s[ge>>2]|0),Xt=s[ee>>2]|0}at=s[(s[V>>2]|0)+(Xt<<2)>>2]|0,Xt=Xt+1|0,ai=s[x>>2]|0,Xt=(Xt|0)==(ai|0)?0:Xt,s[ee>>2]=Xt,Nt=s[_e>>2]|0,Ht=Nt+(at<<2)|0,st=s[Ht>>2]|0}while(st&3|0);if(A&&(s[te>>2]|0)>1&&(Ot=Zt+1|0,(Zt|0)%1e3|0||(st=s[K>>2]|0,s[R>>2]=st-Xt+((st|0)<(Xt|0)?ai:0),s[R+4>>2]=kt,s[R+8>>2]=It,Tt(3440,R|0)|0,st=s[Ht>>2]|0),Zt=Ot),Xt=Nt+(at+1<<2)|0,Nt=s[Xt>>2]>>1,st>>>0>63){Ot=s[F>>2]|0,st=st>>>5,ai=1;do li=s[Ht+(ai<<2)+4>>2]>>1,Nt=(s[Ot+(li*12|0)+4>>2]|0)<(s[Ot+(Nt*12|0)+4>>2]|0)?li:Nt,ai=ai+1|0;while((ai|0)<(st|0))}if(st=(s[U>>2]|0)+Nt|0,n[st>>0]|0){if(ai=s[F>>2]|0,Ot=ai+(Nt*12|0)+4|0,gi=s[Ot>>2]|0,(gi|0)>0){ai=s[ai+(Nt*12|0)>>2]|0,ui=0,fi=0;do Vi=s[ai+(ui<<2)>>2]|0,(s[(s[s[ne>>2]>>2]|0)+(Vi<<2)>>2]&3|0)!=1&&(s[ai+(fi<<2)>>2]=Vi,gi=s[Ot>>2]|0,fi=fi+1|0),ui=ui+1|0;while((ui|0)<(gi|0))}else ui=0,fi=0;ai=ui-fi|0,(ai|0)>0&&(s[Ot>>2]=gi-ai),n[st>>0]=0}if(st=s[F>>2]|0,Ot=s[st+(Nt*12|0)>>2]|0,st=st+(Nt*12|0)+4|0,(s[st>>2]|0)>0)ai=0;else continue;for(;;){if(Vi=s[Ht>>2]|0,Vi&3)continue e;fi=s[Ot+(ai<<2)>>2]|0,ui=s[_e>>2]|0,bs=ui+(fi<<2)|0,gi=s[bs>>2]|0;t:do if(!((gi&3|0)!=0|(fi|0)==(at|0))&&(li=s[Ye>>2]|0,ni=gi>>>5,(li|0)==-1|(ni|0)<(li|0))&&(it=Vi>>>5,ni>>>0>=it>>>0)&&!(s[Ht+(it<<2)+4>>2]&~s[bs+(ni<<2)+4>>2]|0)){ui=ui+(fi+1<<2)|0;do if(Vi>>>0>31){if(gi>>>0>31)bs=-2,gi=0;else break t;for(;;){Vi=s[Xt+(gi<<2)>>2]|0;i:do if((bs|0)==-2)for(li=0;;){if(bs=s[ui+(li<<2)>>2]|0,(Vi|0)==(bs|0)){Vi=-2;break i}if(li=li+1|0,(Vi|0)==(bs^1|0))break i;if(li>>>0>=ni>>>0)break t}else for(li=0;;){if((Vi|0)==(s[ui+(li<<2)>>2]|0)){Vi=bs;break i}if(li=li+1|0,li>>>0>=ni>>>0)break t}while(!1);if(gi=gi+1|0,gi>>>0>=it>>>0)break;bs=Vi}if((Vi|0)==-2)break;if((Vi|0)==-1)break t;if(s[Dt>>2]=Vi^1,s[R+0>>2]=s[Dt+0>>2],!(Ss(u,fi,R)|0)){E=0,x=53;break e}It=It+1|0,ai=(((Vi>>1|0)==(Nt|0))<<31>>31)+ai|0;break t}while(!1);Fr(u,fi),kt=kt+1|0}while(!1);if(ai=ai+1|0,(ai|0)>=(s[st>>2]|0))continue e}}return(x|0)==8?(hn(V,0),s[E>>2]=s[M>>2],li=1,m=T,li|0):(x|0)==53?(m=T,E|0):0}function Zo(u,A,T){u=u|0,A=A|0,T=T|0;var E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0,_e=0,ge=0;if(V=m,m=m+16|0,E=V+12|0,K=V+8|0,x=V+4|0,M=V,F=(s[u+544>>2]|0)+(T<<2)|0,s[F>>2]&3||Oa(u,F)|0)return ee=1,m=V,ee|0;if(s[K>>2]=s[u+284>>2],$i(u+292|0,K),te=s[F>>2]|0,te>>>0>31){K=u+332|0,R=0,U=-2;do ne=s[F+(R<<2)+4>>2]|0,ee=ne>>1,(ee|0)!=(A|0)&&(ee=(a[(s[K>>2]|0)+ee>>0]|0)^ne&1,ge=n[2616]|0,_e=ge&255,((ee&255)<<24>>24==ge<<24>>24&(_e>>>1^1)|_e&2&ee|0)==0)?(s[x>>2]=ne^1,s[E+0>>2]=s[x+0>>2],_r(u,E,-1),te=s[F>>2]|0):U=ne,R=R+1|0;while((R|0)<(te>>>5|0))}else U=-2;return ge=(vr(u)|0)==-1,Br(u,0),!ge&&(ge=u+712|0,s[ge>>2]=(s[ge>>2]|0)+1,s[M>>2]=U,s[E+0>>2]=s[M+0>>2],!(Ss(u,T,E)|0))?(ge=0,m=V,ge|0):(ge=1,m=V,ge|0)}function rl(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0;if(T=m,M=(s[u+776>>2]|0)+A|0,E=u+760|0,n[M>>0]|0){if(F=s[E>>2]|0,V=F+(A*12|0)+4|0,U=s[V>>2]|0,(U|0)>0){x=u+804|0,F=s[F+(A*12|0)>>2]|0,R=0,K=0;do te=s[F+(R<<2)>>2]|0,(s[(s[s[x>>2]>>2]|0)+(te<<2)>>2]&3|0)!=1&&(s[F+(K<<2)>>2]=te,U=s[V>>2]|0,K=K+1|0),R=R+1|0;while((R|0)<(U|0))}else R=0,K=0;x=R-K|0,(x|0)>0&&(s[V>>2]=U-x),n[M>>0]=0}if(V=s[E>>2]|0,U=n[(s[u+332>>2]|0)+A>>0]|0,R=n[2624]|0,te=R&255,!((te>>>1^1)&U<<24>>24==R<<24>>24|U&2&te)||(E=V+(A*12|0)+4|0,M=s[E>>2]|0,!M))return te=1,m=T,te|0;e:do if((M|0)>0){for(V=V+(A*12|0)|0,M=0;;){if(!(Zo(u,A,s[(s[V>>2]|0)+(M<<2)>>2]|0)|0)){u=0;break}if(M=M+1|0,(M|0)>=(s[E>>2]|0))break e}return m=T,u|0}while(!1);return te=jo(u,0)|0,m=T,te|0}function Eo(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0,_e=0,ge=0,Oe=0,$e=0,Ye=0,it=0,Dt=0,ni=0,ei=0,at=0,Ht=0,Zt=0,kt=0,Xt=0,It=0,Nt=0,Ot=0,st=0,ai=0,fi=0,ui=0,gi=0,Vi=0,bs=0,li=0,Bs=0,es=0,Vo=0,ln=0,Ks=0,zr=0,ys=0,Xs=0,Yi=0;if(T=m,m=m+48|0,ge=T+36|0,_e=T+32|0,Oe=T+28|0,$e=T+24|0,E=T+12|0,V=T,U=(s[u+776>>2]|0)+A|0,R=u+760|0,n[U>>0]|0){if(ee=s[R>>2]|0,te=ee+(A*12|0)+4|0,ni=s[te>>2]|0,(ni|0)>0){ne=u+804|0,ee=s[ee+(A*12|0)>>2]|0,it=0,Ye=0;do ei=s[ee+(it<<2)>>2]|0,(s[(s[s[ne>>2]>>2]|0)+(ei<<2)>>2]&3|0)!=1&&(s[ee+(Ye<<2)>>2]=ei,ni=s[te>>2]|0,Ye=Ye+1|0),it=it+1|0;while((it|0)<(ni|0))}else it=0,Ye=0;ne=it-Ye|0,(ne|0)>0&&(s[te>>2]=ni-ne),n[U>>0]=0}Ye=s[R>>2]|0,it=Ye+(A*12|0)|0,s[E>>2]=0,U=E+4|0,s[U>>2]=0,te=E+8|0,s[te>>2]=0,s[V>>2]=0,ee=V+4|0,s[ee>>2]=0,ne=V+8|0,s[ne>>2]=0,Ye=Ye+(A*12|0)+4|0;e:do if((s[Ye>>2]|0)>0){ni=u+544|0,Ht=A<<1,at=0;do{Zt=(s[it>>2]|0)+(at<<2)|0,Xt=(s[ni>>2]|0)+(s[Zt>>2]<<2)|0,Yi=s[Xt>>2]|0,ei=Yi>>>5;t:do if(Yi>>>0>31)for(It=0;;){if(kt=It+1|0,(s[Xt+(It<<2)+4>>2]|0)==(Ht|0)){kt=It;break t}if((kt|0)<(ei|0))It=kt;else break}else kt=0;while(!1);On((kt|0)<(ei|0)?E:V,Zt),at=at+1|0,ei=s[Ye>>2]|0}while((at|0)<(ei|0));if(ni=s[U>>2]|0,Ht=(ni|0)>0,Ht)for(Zt=s[ee>>2]|0,ai=(Zt|0)>0,st=u+544|0,kt=s[E>>2]|0,at=s[V>>2]|0,Xt=u+708|0,Ot=u+684|0,Nt=u+688|0,bs=0,It=0;;){if(ai){ui=kt+(It<<2)|0,fi=s[st>>2]|0,gi=s[Xt>>2]|0,Vi=0;do{es=fi+(s[ui>>2]<<2)|0,ln=fi+(s[at+(Vi<<2)>>2]<<2)|0,gi=gi+1|0,s[Xt>>2]=gi,li=(s[es>>2]|0)>>>5>>>0<(s[ln>>2]|0)>>>5>>>0,Bs=li?ln:es,ln=li?es:ln,es=Bs+4|0,li=ln+4|0,Bs=s[Bs>>2]|0,Vo=Bs>>>5,zr=Vo+-1|0,ln=s[ln>>2]|0;t:do if(ln>>>0>31)for(Ks=0;;){Yi=s[li+(Ks<<2)>>2]|0;i:do if((Yi>>1|0)!=(A|0)){s:do if(Bs>>>0>31){for(Xs=0;ys=s[es+(Xs<<2)>>2]|0,Xs=Xs+1|0,!((ys^Yi)>>>0<2);)if((Xs|0)>=(Vo|0))break s;if((ys|0)==(Yi^1|0))break t;break i}while(!1);zr=zr+1|0}while(!1);if(Ks=Ks+1|0,(Ks|0)>=(ln>>>5|0)){Dt=28;break}}else Dt=28;while(!1);if((Dt|0)==28){if(Dt=0,(bs|0)>=((s[Ot>>2]|0)+ei|0)){u=1;break e}if(Yi=s[Nt>>2]|0,(Yi|0)!=-1&(zr|0)>(Yi|0)){u=1;break e}else bs=bs+1|0}Vi=Vi+1|0}while((Vi|0)<(Zt|0))}if(It=It+1|0,(It|0)>=(ni|0)){Dt=32;break}}else Ht=0,Dt=32}else ni=0,Ht=0,Dt=32;while(!1);e:do if((Dt|0)==32){if(n[(s[u+904>>2]|0)+A>>0]=1,ei=u+380|0,at=(s[ei>>2]|0)+A|0,n[at>>0]|0&&(Yi=u+200|0,Xs=Yi,Xs=Xi(s[Xs>>2]|0,s[Xs+4>>2]|0,-1,-1)|0,s[Yi>>2]=Xs,s[Yi+4>>2]=nt),n[at>>0]=0,at=u+460|0,(s[u+476>>2]|0)>(A|0)&&(s[(s[u+472>>2]|0)+(A<<2)>>2]|0)>-1||(Dt=36),(Dt|0)==36&&n[(s[ei>>2]|0)+A>>0]|0&&xi(at,A),Dt=u+716|0,s[Dt>>2]=(s[Dt>>2]|0)+1,Dt=s[ee>>2]|0,(ni|0)>(Dt|0)){if(at=u+732|0,(Dt|0)>0){$e=u+544|0,Oe=s[V>>2]|0,Xt=u+736|0,kt=0;do{if(Zt=(s[$e>>2]|0)+(s[Oe+(kt<<2)>>2]<<2)|0,ei=s[Xt>>2]|0,(s[Zt>>2]|0)>>>0>31){It=0,Nt=-1;do Yi=Zt+(It<<2)+4|0,s[ge>>2]=s[Yi>>2],On(at,ge),Nt=(s[Yi>>2]>>1|0)==(A|0)?It+ei|0:Nt,It=It+1|0;while((It|0)<((s[Zt>>2]|0)>>>5|0))}else Nt=-1;Yi=s[at>>2]|0,ys=Yi+(Nt<<2)|0,Xs=s[ys>>2]|0,Yi=Yi+(ei<<2)|0,s[ys>>2]=s[Yi>>2],s[Yi>>2]=Xs,s[_e>>2]=(s[Zt>>2]|0)>>>5,On(at,_e),kt=kt+1|0}while((kt|0)<(Dt|0))}s[ge>>2]=A<<1,On(at,ge),s[_e>>2]=1,On(at,_e)}else{if(kt=u+732|0,Ht){It=u+544|0,Xt=s[E>>2]|0,ei=u+736|0,Nt=0;do{if(Zt=(s[It>>2]|0)+(s[Xt+(Nt<<2)>>2]<<2)|0,at=s[ei>>2]|0,(s[Zt>>2]|0)>>>0>31){Ot=0,st=-1;do Yi=Zt+(Ot<<2)+4|0,s[ge>>2]=s[Yi>>2],On(kt,ge),st=(s[Yi>>2]>>1|0)==(A|0)?Ot+at|0:st,Ot=Ot+1|0;while((Ot|0)<((s[Zt>>2]|0)>>>5|0))}else st=-1;Yi=s[kt>>2]|0,ys=Yi+(st<<2)|0,Xs=s[ys>>2]|0,Yi=Yi+(at<<2)|0,s[ys>>2]=s[Yi>>2],s[Yi>>2]=Xs,s[_e>>2]=(s[Zt>>2]|0)>>>5,On(kt,_e),Nt=Nt+1|0}while((Nt|0)<(ni|0))}s[Oe>>2]=A<<1|1,On(kt,Oe),s[$e>>2]=1,On(kt,$e)}if((s[Ye>>2]|0)>0){_e=0;do Fr(u,s[(s[it>>2]|0)+(_e<<2)>>2]|0),_e=_e+1|0;while((_e|0)<(s[Ye>>2]|0))}_e=u+628|0;t:do if(Ht){if(ge=u+544|0,it=s[E>>2]|0,at=s[V>>2]|0,(Dt|0)>0)Ye=0;else for(_e=0;;)if(_e=_e+1|0,(_e|0)>=(ni|0))break t;do{$e=it+(Ye<<2)|0,Oe=0;do{if(Yi=s[ge>>2]|0,wr(u,Yi+(s[$e>>2]<<2)|0,Yi+(s[at+(Oe<<2)>>2]<<2)|0,A,_e)|0&&!(xn(u,_e)|0)){u=0;break e}Oe=Oe+1|0}while((Oe|0)<(Dt|0));Ye=Ye+1|0}while((Ye|0)<(ni|0))}while(!1);_e=s[R>>2]|0,R=_e+(A*12|0)|0,ge=s[R>>2]|0,ge&&(s[_e+(A*12|0)+4>>2]=0,di(ge),s[R>>2]=0,s[_e+(A*12|0)+8>>2]=0),R=u+412|0,A=A<<1,ge=s[R>>2]|0,_e=ge+(A*12|0)+4|0,!(s[_e>>2]|0)&&(K=ge+(A*12|0)|0,F=s[K>>2]|0,(F|0)!=0)&&(s[_e>>2]=0,di(F),s[K>>2]=0,s[ge+(A*12|0)+8>>2]=0,ge=s[R>>2]|0),F=A|1,K=ge+(F*12|0)+4|0,!(s[K>>2]|0)&&(x=ge+(F*12|0)|0,M=s[x>>2]|0,(M|0)!=0)&&(s[K>>2]=0,di(M),s[x>>2]=0,s[ge+(F*12|0)+8>>2]=0),u=jo(u,0)|0,at=s[V>>2]|0}while(!1);return at&&(s[ee>>2]=0,di(at),s[V>>2]=0,s[ne>>2]=0),V=s[E>>2]|0,V?(s[U>>2]=0,di(V),s[E>>2]=0,s[te>>2]=0,m=T,u|0):(m=T,u|0)}function ol(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0,_e=0,ge=0,Oe=0;if(T=m,!(n[u+724>>0]|0)){m=T;return}if(K=u+540|0,(s[K>>2]|0)>0){x=u+760|0,E=u+804|0,V=u+776|0,F=u+544|0,M=0;do{if(U=s[x>>2]|0,R=U+(M*12|0)+4|0,ne=s[R>>2]|0,(ne|0)>0){U=s[U+(M*12|0)>>2]|0,ee=0,te=0;do _e=s[U+(ee<<2)>>2]|0,(s[(s[s[E>>2]>>2]|0)+(_e<<2)>>2]&3|0)!=1&&(s[U+(te<<2)>>2]=_e,ne=s[R>>2]|0,te=te+1|0),ee=ee+1|0;while((ee|0)<(ne|0))}else ee=0,te=0;if(U=ee-te|0,(U|0)>0&&(s[R>>2]=ne-U),n[(s[V>>2]|0)+M>>0]=0,U=s[x>>2]|0,R=U+(M*12|0)+4|0,(s[R>>2]|0)>0){_e=U+(M*12|0)|0,ne=0;do U=(s[_e>>2]|0)+(ne<<2)|0,te=s[U>>2]|0,ee=s[F>>2]|0,ge=ee+(te<<2)|0,s[ge>>2]&16?s[U>>2]=s[ee+(te+1<<2)>>2]:(Oe=Gs(A,ge)|0,s[U>>2]=Oe,s[ge>>2]=s[ge>>2]|16,s[ee+(te+1<<2)>>2]=Oe),ne=ne+1|0;while((ne|0)<(s[R>>2]|0))}M=M+1|0}while((M|0)<(s[K>>2]|0))}E=u+856|0,Oe=s[u+872>>2]|0,V=u+868|0,R=s[V>>2]|0,F=Oe-R|0,(Oe|0)<(R|0)&&(F=(s[u+860>>2]|0)+F|0);e:do if((F|0)>0)for(M=u+860|0,x=u+544|0;;){if(K=s[(s[E>>2]|0)+(R<<2)>>2]|0,U=R+1|0,s[V>>2]=(U|0)==(s[M>>2]|0)?0:U,U=s[x>>2]|0,te=U+(K<<2)|0,R=s[te>>2]|0,R&3||(R&16?K=s[U+(K+1<<2)>>2]|0:(Oe=Gs(A,te)|0,s[te>>2]=s[te>>2]|16,s[U+(K+1<<2)>>2]=Oe,K=Oe),lr(E,K)),F=F+-1|0,(F|0)<=0)break e;R=s[V>>2]|0}else x=u+544|0;while(!1);if(u=u+928|0,E=s[u>>2]|0,M=s[x>>2]|0,V=M+(E<<2)|0,s[V>>2]&16){s[u>>2]=s[M+(E+1<<2)>>2],m=T;return}else{Oe=Gs(A,V)|0,s[u>>2]=Oe,s[V>>2]=s[V>>2]|16,s[M+(E+1<<2)>>2]=Oe,m=T;return}}function Ma(u){u=u|0;var A=0,T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0;M=m,m=m+32|0,K=M,A=M+8|0,T=u+544|0,E=u+548|0,V=u+556|0,x=(s[E>>2]|0)-(s[V>>2]|0)|0,s[A+0>>2]=0,s[A+4>>2]=0,s[A+8>>2]=0,s[A+12>>2]=0,Gi(A,x),x=A+16|0,F=u+560|0,n[x>>0]=n[F>>0]|0,ol(u,A),wt(u,A),(s[u+44>>2]|0)>1&&(R=s[A+4>>2]<<2,s[K>>2]=s[E>>2]<<2,s[K+4>>2]=R,Tt(3608,K|0)|0),n[F>>0]=n[x>>0]|0,x=s[T>>2]|0,x&&di(x),s[T>>2]=s[A>>2],s[E>>2]=s[A+4>>2],s[u+552>>2]=s[A+8>>2],s[V>>2]=s[A+12>>2],m=M}function Er(){var u=0,A=0,T=0;u=m,m=m+16|0,A=u,n[2608]=0,n[2616]=1,n[2624]=2,Os(2632,2656,2664,3744,3752),s[658]=160,n[2652]=0,Os(2704,2728,2736,3744,3752),s[676]=160,n[2724]=0,Os(2784,2808,2816,3744,3752),s[696]=160,n[2804]=1,Os(2848,2880,2888,3744,3736),s[712]=280,T=2868,s[T>>2]=-2147483648,s[T+4>>2]=2147483647,s[719]=0,Os(2960,2992,3e3,3744,3736),s[740]=280,T=2980,s[T>>2]=-1,s[T+4>>2]=2147483647,s[747]=20,Os(3112,3144,3152,3744,3736),s[778]=280,T=3132,s[T>>2]=-1,s[T+4>>2]=2147483647,s[785]=1e3,Os(3240,3296,3312,3744,3720),s[810]=2168,y[408]=0,y[409]=Ae,n[3280]=0,n[3281]=0,r[1641]=r[A+0>>1]|0,r[1642]=r[A+2>>1]|0,r[1643]=r[A+4>>1]|0,y[411]=.5,m=u}function qr(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0;if(T=m,s[u>>2]=0,E=u+4|0,s[E>>2]=0,V=u+8|0,s[V>>2]=0,(A|0)<=0){m=T;return}if(M=A+1&-2,M=(M|0)>2?M:2,s[V>>2]=M,V=ps(0,M<<2)|0,s[u>>2]=V,!(V|0)&&(s[(Rt()|0)>>2]|0)==12&&Yt(ye(1)|0,48,0),u=s[E>>2]|0,(u|0)<(A|0))do M=V+(u<<2)|0,M&&(s[M>>2]=0),u=u+1|0;while((u|0)!=(A|0));s[E>>2]=A,m=T}function Qo(u){u=u|0;var A=0,T=0,E=0,V=0,M=0,x=0,F=0;if(A=m,E=u+32|0,T=s[E>>2]|0,T&&(s[u+36>>2]=0,di(T),s[E>>2]=0,s[u+40>>2]=0),E=u+16|0,T=s[E>>2]|0,T&&(s[u+20>>2]=0,di(T),s[E>>2]=0,s[u+24>>2]=0),E=s[u>>2]|0,!E){m=A;return}if(T=u+4|0,M=s[T>>2]|0,(M|0)>0){V=0;do F=E+(V*12|0)|0,x=s[F>>2]|0,x&&(s[E+(V*12|0)+4>>2]=0,di(x),s[F>>2]=0,s[E+(V*12|0)+8>>2]=0,E=s[u>>2]|0,M=s[T>>2]|0),V=V+1|0;while((V|0)<(M|0))}s[T>>2]=0,di(E),s[u>>2]=0,s[u+8>>2]=0,m=A}function Jo(u,A,T){u=u|0,A=A|0,T=T|0;var E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0;if(E=m,A=s[A>>2]|0,M=A+1|0,V=u+4|0,(s[V>>2]|0)>=(M|0)){K=s[u>>2]|0,K=K+(A<<2)|0,s[K>>2]=T,m=E;return}if(x=u+8|0,K=s[x>>2]|0,(K|0)<(M|0)&&(R=A+2-K&-2,F=(K>>1)+2&-2,F=(R|0)>(F|0)?R:F,(F|0)>(2147483647-K|0)&&(R=ye(1)|0,Yt(R|0,48,0)),U=s[u>>2]|0,R=F+K|0,s[x>>2]=R,R=ps(U,R<<2)|0,s[u>>2]=R,!(R|0)&&(s[(Rt()|0)>>2]|0)==12&&(U=ye(1)|0,Yt(U|0,48,0))),K=s[V>>2]|0,(K|0)<(M|0)){x=s[u>>2]|0;do F=x+(K<<2)|0,F&&(s[F>>2]=0),K=K+1|0;while((K|0)!=(M|0))}s[V>>2]=M,U=s[u>>2]|0,U=U+(A<<2)|0,s[U>>2]=T,m=E}function ar(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0;if(T=m,F=s[A>>2]|0,V=F+1|0,E=u+4|0,(s[E>>2]|0)<(V|0)){if(x=u+8|0,M=s[x>>2]|0,(M|0)<(V|0)&&(K=F+2-M&-2,F=(M>>1)+2&-2,F=(K|0)>(F|0)?K:F,(F|0)>(2147483647-M|0)&&(K=ye(1)|0,Yt(K|0,48,0)),R=s[u>>2]|0,K=F+M|0,s[x>>2]=K,K=ps(R,K*12|0)|0,s[u>>2]=K,!(K|0)&&(s[(Rt()|0)>>2]|0)==12&&(R=ye(1)|0,Yt(R|0,48,0))),x=s[E>>2]|0,(x|0)<(V|0)){M=s[u>>2]|0;do F=M+(x*12|0)|0,F&&(s[F>>2]=0,s[M+(x*12|0)+4>>2]=0,s[M+(x*12|0)+8>>2]=0),x=x+1|0;while((x|0)!=(V|0))}s[E>>2]=V,M=s[A>>2]|0}else M=F;if(E=s[u>>2]|0,s[E+(M*12|0)>>2]|0&&(s[E+(M*12|0)+4>>2]=0,M=s[A>>2]|0),A=u+16|0,E=M+1|0,V=u+20|0,(s[V>>2]|0)>=(E|0)){m=T;return}if(x=u+24|0,u=s[x>>2]|0,(u|0)<(E|0)&&(R=M+2-u&-2,M=(u>>1)+2&-2,M=(R|0)>(M|0)?R:M,(M|0)>(2147483647-u|0)&&(R=ye(1)|0,Yt(R|0,48,0)),K=s[A>>2]|0,R=M+u|0,s[x>>2]=R,R=ps(K,R)|0,s[A>>2]=R,!(R|0)&&(s[(Rt()|0)>>2]|0)==12&&(R=ye(1)|0,Yt(R|0,48,0))),u=s[V>>2]|0,(u|0)<(E|0))do n[(s[A>>2]|0)+u>>0]=0,u=u+1|0;while((u|0)!=(E|0));s[V>>2]=E,m=T}function In(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0,_e=0,ge=0;if(T=m,m=m+16|0,M=T,s[M>>2]=A,V=u+12|0,E=A+1|0,x=u+16|0,(s[x>>2]|0)<(E|0)&&(K=u+20|0,F=s[K>>2]|0,(F|0)<(E|0)&&(U=A+2-F&-2,R=(F>>1)+2&-2,R=(U|0)>(R|0)?U:R,(R|0)>(2147483647-F|0)&&(U=ye(1)|0,Yt(U|0,48,0)),te=s[V>>2]|0,U=R+F|0,s[K>>2]=U,U=ps(te,U<<2)|0,s[V>>2]=U,!(U|0)&&(s[(Rt()|0)>>2]|0)==12&&(te=ye(1)|0,Yt(te|0,48,0))),F=s[x>>2]|0,(E|0)>(F|0)&&Ha((s[V>>2]|0)+(F<<2)|0,-1,E-F<<2|0)|0,s[x>>2]=E),s[(s[V>>2]|0)+(A<<2)>>2]=s[u+4>>2],$i(u,M),E=s[V>>2]|0,F=s[E+(A<<2)>>2]|0,A=s[u>>2]|0,V=s[A+(F<<2)>>2]|0,!F){U=0,te=A+(U<<2)|0,s[te>>2]=V,te=E+(V<<2)|0,s[te>>2]=U,m=T;return}for(u=u+28|0,M=V<<1,x=M|1;;){if(U=F,F=F+-1>>1,R=A+(F<<2)|0,K=s[R>>2]|0,ge=s[s[u>>2]>>2]|0,ne=s[ge+(M<<2)>>2]|0,_e=s[ge+(x<<2)>>2]|0,ne=Gn(_e|0,((_e|0)<0)<<31>>31|0,ne|0,((ne|0)<0)<<31>>31|0)|0,_e=nt,ee=K<<1,te=s[ge+(ee<<2)>>2]|0,ee=s[ge+((ee|1)<<2)>>2]|0,te=Gn(ee|0,((ee|0)<0)<<31>>31|0,te|0,((te|0)<0)<<31>>31|0)|0,ee=nt,!(_e>>>0<ee>>>0|(_e|0)==(ee|0)&ne>>>0<te>>>0)){u=14;break}if(s[A+(U<<2)>>2]=K,s[E+(s[R>>2]<<2)>>2]=U,!F){U=0,u=14;break}}if((u|0)==14){ge=A+(U<<2)|0,s[ge>>2]=V,ge=E+(V<<2)|0,s[ge>>2]=U,m=T;return}}function vs(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0,_e=0,ge=0,Oe=0,$e=0;T=m,M=u+824|0,K=(s[u+840>>2]|0)>(A|0),K&&(s[(s[u+836>>2]|0)+(A<<2)>>2]|0)>-1?x=7:x=3;do if((x|0)==3){if(n[(s[u+876>>2]|0)+A>>0]|0){m=T;return}if(n[(s[u+904>>2]|0)+A>>0]|0){m=T;return}if(te=n[(s[u+332>>2]|0)+A>>0]|0,U=n[2624]|0,ne=U&255,(ne>>>1^1)&te<<24>>24==U<<24>>24|te&2&ne)if(K){x=7;break}else break;else{m=T;return}}while(!1);if((x|0)==7&&(E=s[u+836>>2]|0,V=E+(A<<2)|0,F=s[V>>2]|0,(F|0)>-1)){A=s[M>>2]|0,x=s[A+(F<<2)>>2]|0;e:do if(!F)te=0;else for(K=u+852|0,R=x<<1,u=R|1;;){if(te=F,F=F+-1>>1,ne=A+(F<<2)|0,U=s[ne>>2]|0,$e=s[s[K>>2]>>2]|0,_e=s[$e+(R<<2)>>2]|0,Oe=s[$e+(u<<2)>>2]|0,_e=Gn(Oe|0,((Oe|0)<0)<<31>>31|0,_e|0,((_e|0)<0)<<31>>31|0)|0,Oe=nt,ge=U<<1,ee=s[$e+(ge<<2)>>2]|0,ge=s[$e+((ge|1)<<2)>>2]|0,ee=Gn(ge|0,((ge|0)<0)<<31>>31|0,ee|0,((ee|0)<0)<<31>>31|0)|0,ge=nt,!(Oe>>>0<ge>>>0|(Oe|0)==(ge|0)&_e>>>0<ee>>>0))break e;if(s[A+(te<<2)>>2]=U,s[E+(s[ne>>2]<<2)>>2]=te,!F){te=0;break}}while(!1);s[A+(te<<2)>>2]=x,s[E+(x<<2)>>2]=te,Yr(M,s[V>>2]|0),m=T;return}In(M,A),m=T}function Yr(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0,_e=0,ge=0,Oe=0,$e=0,Ye=0;if(T=m,E=s[u>>2]|0,V=s[E+(A<<2)>>2]|0,U=A<<1|1,R=u+4|0,ne=s[R>>2]|0,(U|0)>=(ne|0)){ee=A,_e=u+12|0,ne=E+(ee<<2)|0,s[ne>>2]=V,_e=s[_e>>2]|0,_e=_e+(V<<2)|0,s[_e>>2]=ee,m=T;return}for(x=u+28|0,K=V<<1,F=K|1,u=u+12|0;;){if(te=(A<<1)+2|0,(te|0)<(ne|0)?(ee=s[E+(te<<2)>>2]|0,_e=s[E+(U<<2)>>2]|0,Ye=ee<<1,ne=s[s[x>>2]>>2]|0,Oe=s[ne+(Ye<<2)>>2]|0,Ye=s[ne+((Ye|1)<<2)>>2]|0,Oe=Gn(Ye|0,((Ye|0)<0)<<31>>31|0,Oe|0,((Oe|0)<0)<<31>>31|0)|0,Ye=nt,$e=_e<<1,ge=s[ne+($e<<2)>>2]|0,$e=s[ne+(($e|1)<<2)>>2]|0,ge=Gn($e|0,(($e|0)<0)<<31>>31|0,ge|0,((ge|0)<0)<<31>>31|0)|0,$e=nt,Ye>>>0<$e>>>0|(Ye|0)==($e|0)&Oe>>>0<ge>>>0||(ee=_e,M=7)):(ee=s[E+(U<<2)>>2]|0,ne=s[s[x>>2]>>2]|0,M=7),(M|0)==7&&(M=0,te=U),ge=ee<<1,$e=s[ne+(ge<<2)>>2]|0,ge=s[ne+((ge|1)<<2)>>2]|0,$e=Gn(ge|0,((ge|0)<0)<<31>>31|0,$e|0,(($e|0)<0)<<31>>31|0)|0,ge=nt,Ye=s[ne+(K<<2)>>2]|0,Oe=s[ne+(F<<2)>>2]|0,Ye=Gn(Oe|0,((Oe|0)<0)<<31>>31|0,Ye|0,((Ye|0)<0)<<31>>31|0)|0,Oe=nt,!(ge>>>0<Oe>>>0|(ge|0)==(Oe|0)&$e>>>0<Ye>>>0)){M=10;break}if(s[E+(A<<2)>>2]=ee,s[(s[u>>2]|0)+(ee<<2)>>2]=A,U=te<<1|1,ne=s[R>>2]|0,(U|0)>=(ne|0)){A=te,M=10;break}else A=te}if((M|0)==10){Ye=E+(A<<2)|0,s[Ye>>2]=V,Ye=s[u>>2]|0,Ye=Ye+(V<<2)|0,s[Ye>>2]=A,m=T;return}}function Vn(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0,K=0;if(T=m,x=s[u>>2]|0,x){E=u+4|0,V=s[E>>2]|0;e:do if((V|0)>0)for(M=0;;){if(F=x+(M*12|0)|0,K=s[F>>2]|0,K&&(s[x+(M*12|0)+4>>2]=0,di(K),s[F>>2]=0,s[x+(M*12|0)+8>>2]=0,V=s[E>>2]|0),M=M+1|0,(M|0)>=(V|0))break e;x=s[u>>2]|0}while(!1);s[E>>2]=0,A&&(di(s[u>>2]|0),s[u>>2]=0,s[u+8>>2]=0)}if(E=u+16|0,V=s[E>>2]|0,V|0&&(s[u+20>>2]=0,A)&&(di(V),s[E>>2]=0,s[u+24>>2]=0),V=u+32|0,E=s[V>>2]|0,!E){m=T;return}if(s[u+36>>2]=0,!A){m=T;return}di(E),s[V>>2]=0,s[u+40>>2]=0,m=T}function hn(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0;if(E=m,V=s[u>>2]|0,T=u+4|0,V?(s[T>>2]=0,A&&(di(V),s[u>>2]=0,s[u+8>>2]=0,V=0)):V=0,(s[T>>2]|0)>=1){x=u+16|0,s[x>>2]=0,x=u+12|0,s[x>>2]=0,m=E;return}if(x=u+8|0,M=s[x>>2]|0,(M|0)<1&&(F=2-M&-2,A=(M>>1)+2&-2,A=(F|0)>(A|0)?F:A,(A|0)>(2147483647-M|0)&&(F=ye(1)|0,Yt(F|0,48,0)),F=A+M|0,s[x>>2]=F,V=ps(V,F<<2)|0,s[u>>2]=V,!(V|0)&&(s[(Rt()|0)>>2]|0)==12&&(F=ye(1)|0,Yt(F|0,48,0))),A=s[T>>2]|0,(A|0)<1)for(;M=V+(A<<2)|0,M&&(s[M>>2]=0),A;)A=A+1|0;s[T>>2]=1,F=u+16|0,s[F>>2]=0,F=u+12|0,s[F>>2]=0,m=E}function lr(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0;if(E=m,m=m+16|0,T=E,V=u+16|0,F=s[V>>2]|0,s[V>>2]=F+1,s[(s[u>>2]|0)+(F<<2)>>2]=A,F=s[V>>2]|0,A=u+4|0,x=s[A>>2]|0,(F|0)==(x|0)&&(s[V>>2]=0,F=0),M=u+12|0,(s[M>>2]|0)!=(F|0)){m=E;return}if(qr(T,(x*3|0)+1>>1),R=s[M>>2]|0,U=s[A>>2]|0,(R|0)<(U|0))for(F=s[u>>2]|0,K=s[T>>2]|0,U=0;;)if(x=U+1|0,s[K+(U<<2)>>2]=s[F+(R<<2)>>2],R=R+1|0,U=s[A>>2]|0,(R|0)>=(U|0)){K=x;break}else U=x;else K=0;if(x=s[u>>2]|0,(s[V>>2]|0)>0){for(F=s[T>>2]|0,R=0;s[F+(K<<2)>>2]=s[x+(R<<2)>>2],R=R+1|0,!((R|0)>=(s[V>>2]|0));)K=K+1|0;U=s[A>>2]|0}s[M>>2]=0,s[V>>2]=U,x?(s[A>>2]=0,di(x),s[u>>2]=0,V=u+8|0,s[V>>2]=0):V=u+8|0,s[u>>2]=s[T>>2],R=T+4|0,s[A>>2]=s[R>>2],U=T+8|0,s[V>>2]=s[U>>2],s[T>>2]=0,s[R>>2]=0,s[U>>2]=0,m=E}function On(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0;if(T=m,E=u+4|0,V=s[E>>2]|0,M=u+8|0,x=s[M>>2]|0,(V|0)==(x|0)&(x|0)<(V+1|0)?(x=(V>>1)+2&-2,x=(x|0)<2?2:x,(x|0)>(2147483647-V|0)&&(x=ye(1)|0,Yt(x|0,48,0)),F=s[u>>2]|0,V=x+V|0,s[M>>2]=V,V=ps(F,V<<2)|0,s[u>>2]=V,!(V|0)&&(s[(Rt()|0)>>2]|0)==12&&(F=ye(1)|0,Yt(F|0,48,0))):V=s[u>>2]|0,F=s[E>>2]|0,s[E>>2]=F+1,E=V+(F<<2)|0,!E){m=T;return}s[E>>2]=s[A>>2],m=T}function _n(){var u=0,A=0;return A=m,bt(3864)|0,u=Fe(936)|0,or(u),m=A,u|0}function ea(u){u=u|0;var A=0;if(A=m,!u){m=A;return}ho[s[(s[u>>2]|0)+4>>2]&31](u),m=A}function Mn(){var u=0,A=0,T=0;u=m,m=m+16|0,A=u,T=Fe(936)|0,or(T),s[964]=T,Ar(T,1)|0,T=s[964]|0,n[A+0>>0]=n[3840]|0,rn(T,A,1)|0,m=u}function Po(u){u=u|0;var A=0,T=0,E=0;if(A=m,m=m+16|0,T=A,(s[962]|0)>=(u|0)){m=A;return}do E=s[964]|0,n[T+0>>0]=n[3840]|0,rn(E,T,1)|0,E=(s[962]|0)+1|0,s[962]=E;while((E|0)<(u|0));m=A}function ta(u){u=u|0;var A=0,T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0;if(V=m,m=m+32|0,M=V+16|0,T=V+4|0,x=V,s[T>>2]=0,E=T+4|0,s[E>>2]=0,A=T+8|0,s[A>>2]=0,F=s[u>>2]|0,F)do{if(K=(F|0)<0?0-F|0:F,(s[962]|0)<(K|0))do R=s[964]|0,n[M+0>>0]=n[3840]|0,rn(R,M,1)|0,R=(s[962]|0)+1|0,s[962]=R;while((R|0)<(K|0));s[x>>2]=K<<1|F>>>31,Hs(T,x),u=u+4|0,F=s[u>>2]|0}while(F|0);return x=s[964]|0,M=x+628|0,ka(T,M),M=xn(x,M)|0,x=s[T>>2]|0,x?(s[E>>2]=0,di(x),s[T>>2]=0,s[A>>2]=0,m=V,M|0):(m=V,M|0)}function Lo(){var u=0,A=0,T=0,E=0;return A=m,m=m+16|0,u=A,T=s[964]|0,E=T+664|0,s[E+0>>2]=-1,s[E+4>>2]=-1,s[E+8>>2]=-1,s[E+12>>2]=-1,s[T+304>>2]|0&&(s[T+308>>2]=0),_s(u,T,1,0),m=A,(n[u>>0]|0)==0|0}function To(){return(s[(s[964]|0)+4>>2]|0)+1|0}function ia(){return s[962]|0}function sa(u){u=u|0;var A=0,T=0,E=0,V=0,M=0,x=0;return A=m,m=m+32|0,M=A+16|0,E=A+4|0,x=A,s[E>>2]=0,T=E+4|0,s[T>>2]=0,V=E+8|0,s[V>>2]=0,s[x>>2]=u<<1,Hs(E,x),u=s[964]|0,x=u+664|0,s[x+0>>2]=-1,s[x+4>>2]=-1,s[x+8>>2]=-1,s[x+12>>2]=-1,ka(E,u+304|0),_s(M,u,1,0),u=(n[M>>0]|0)==0,M=s[E>>2]|0,M?(s[T>>2]=0,di(M),s[E>>2]=0,s[V>>2]=0,m=A,u|0):(m=A,u|0)}function Co(u){u=u|0;var A=0,T=0,E=0;A=m,m=m+16|0,E=A,T=s[964]|0,s[E>>2]=u<<1|1,u=T+628|0,s[u>>2]|0&&(s[T+632>>2]=0),Hs(u,E),xn(T,u)|0,m=A}function Pr(){return s[(s[964]|0)+36>>2]|0}function na(){return s[(s[964]|0)+32>>2]|0}function ka(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0;if(T=m,x=s[A>>2]|0,E=A+4|0,x?(s[E>>2]=0,F=0):F=s[E>>2]|0,E=u+4|0,V=s[E>>2]|0,M=A+4|0,(F|0)<(V|0)){K=A+8|0,F=s[K>>2]|0,(F|0)<(V|0)&&(U=V+1-F&-2,R=(F>>1)+2&-2,R=(U|0)>(R|0)?U:R,(R|0)>(2147483647-F|0)&&(U=ye(1)|0,Yt(U|0,48,0)),U=R+F|0,s[K>>2]=U,x=ps(x,U<<2)|0,s[A>>2]=x,!(x|0)&&(s[(Rt()|0)>>2]|0)==12&&(U=ye(1)|0,Yt(U|0,48,0))),F=s[M>>2]|0;e:do if((F|0)<(V|0))for(;;){if(x=x+(F<<2)|0,x&&(s[x>>2]=0),F=F+1|0,(F|0)==(V|0))break e;x=s[A>>2]|0}while(!1);s[M>>2]=V,V=s[E>>2]|0}if((V|0)<=0){m=T;return}A=s[A>>2]|0,u=s[u>>2]|0,V=0;do s[A+(V<<2)>>2]=s[u+(V<<2)>>2],V=V+1|0;while((V|0)<(s[E>>2]|0));m=T}function vn(u,A){u=u|0,A=A|0;var T=0;T=m,m=m+16|0,s[T>>2]=A,A=s[X>>2]|0,ke(A|0,u|0,T|0)|0,mi(10,A|0)|0,St()}function ra(){var u=0,A=0;if(u=m,m=m+16|0,_t(4064,3)|0)vn(4072,u);else return A=lt(s[1014]|0)|0,m=u,A|0;return 0}function Fe(u){u=u|0;var A=0,T=0;if(A=m,u=u|0?u:1,T=aa(u)|0,T)return m=A,T|0;for(;;){if(T=ri()|0,!T){u=4;break}if(dl[T&3](),T=aa(u)|0,T){u=5;break}}if((u|0)==4)T=ye(4)|0,s[T>>2]=4248,Yt(T|0,4296,12);else if((u|0)==5)return m=A,T|0;return 0}function tt(u){u=u|0;var A=0;A=m,di(u),m=A}function ft(u){u=u|0;var A=0;A=m,tt(u),m=A}function Vt(u){u=u|0}function Pt(u){return u=u|0,4264}function qt(u){u=u|0;var A=0;A=m,m=m+16|0,dl[u&3](),vn(4312,A)}function Ft(){var u=0,A=0;A=ra()|0,A|0&&(u=s[A>>2]|0,(u|0)!=0)&&(A=u+48|0,(s[A>>2]&-256|0)==1126902528?(s[A+4>>2]|0)==1129074247:0)&&qt(s[u+12>>2]|0),A=s[968]|0,s[968]=A+0,qt(A)}function ri(){var u=0;return u=s[1102]|0,s[1102]=u+0,u|0}function Ai(u){u=u|0}function Hi(u){u=u|0}function Bi(u){u=u|0}function Ii(u){u=u|0}function us(u){u=u|0}function ot(u){u=u|0;var A=0;A=m,tt(u),m=A}function Ct(u){u=u|0;var A=0;A=m,tt(u),m=A}function Lt(u,A,T){u=u|0,A=A|0,T=T|0;var E=0,V=0,M=0,x=0;if(E=m,m=m+64|0,V=E,(u|0)==(A|0))return x=1,m=E,x|0;if(!A||(A=xs(A,4504,4560,0)|0,!A))return x=0,m=E,x|0;x=V+0|0,M=x+56|0;do s[x>>2]=0,x=x+4|0;while((x|0)<(M|0));return s[V>>2]=A,s[V+8>>2]=u,s[V+12>>2]=-1,s[V+48>>2]=1,pl[s[(s[A>>2]|0)+28>>2]&3](A,V,s[T>>2]|0,1),(s[V+24>>2]|0)!=1?(x=0,m=E,x|0):(s[T>>2]=s[V+16>>2],x=1,m=E,x|0)}function si(u,A,T,E){u=u|0,A=A|0,T=T|0,E=E|0;var V=0,M=0;if(u=m,V=A+16|0,M=s[V>>2]|0,!M){s[V>>2]=T,s[A+24>>2]=E,s[A+36>>2]=1,m=u;return}if((M|0)!=(T|0)){M=A+36|0,s[M>>2]=(s[M>>2]|0)+1,s[A+24>>2]=2,n[A+54>>0]=1,m=u;return}if(T=A+24|0,(s[T>>2]|0)!=2){m=u;return}s[T>>2]=E,m=u}function wi(u,A,T,E){u=u|0,A=A|0,T=T|0,E=E|0;var V=0;if(V=m,(s[A+8>>2]|0)!=(u|0)){m=V;return}si(0,A,T,E),m=V}function Ei(u,A,T,E){u=u|0,A=A|0,T=T|0,E=E|0;var V=0;if(V=m,(u|0)==(s[A+8>>2]|0)){si(0,A,T,E),m=V;return}else{u=s[u+8>>2]|0,pl[s[(s[u>>2]|0)+28>>2]&3](u,A,T,E),m=V;return}}function xs(u,A,T,E){u=u|0,A=A|0,T=T|0,E=E|0;var V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0;V=m,m=m+64|0,M=V,x=s[u>>2]|0,F=u+(s[x+-8>>2]|0)|0,x=s[x+-4>>2]|0,s[M>>2]=T,s[M+4>>2]=u,s[M+8>>2]=A,s[M+12>>2]=E,R=M+16|0,U=M+20|0,A=M+24|0,K=M+28|0,E=M+32|0,u=M+40|0,te=(x|0)==(T|0),ne=R+0|0,T=ne+36|0;do s[ne>>2]=0,ne=ne+4|0;while((ne|0)<(T|0));return r[R+36>>1]=0,n[R+38>>0]=0,te?(s[M+48>>2]=1,Ua[s[(s[x>>2]|0)+20>>2]&3](x,M,F,F,1,0),ne=(s[A>>2]|0)==1?F:0,m=V,ne|0):(cl[s[(s[x>>2]|0)+24>>2]&3](x,M,F,1,0),M=s[M+36>>2]|0,M?(M|0)==1?(s[A>>2]|0)!=1&&!((s[u>>2]|0)==0&(s[K>>2]|0)==1&(s[E>>2]|0)==1)?(ne=0,m=V,ne|0):(ne=s[R>>2]|0,m=V,ne|0):(ne=0,m=V,ne|0):(ne=(s[u>>2]|0)==1&(s[K>>2]|0)==1&(s[E>>2]|0)==1?s[U>>2]|0:0,m=V,ne|0))}function cs(u,A,T,E,V){u=u|0,A=A|0,T=T|0,E=E|0,V=V|0;var M=0;if(u=m,n[A+53>>0]=1,(s[A+4>>2]|0)!=(E|0)){m=u;return}if(n[A+52>>0]=1,E=A+16|0,M=s[E>>2]|0,!M){if(s[E>>2]=T,s[A+24>>2]=V,s[A+36>>2]=1,!((V|0)==1&&(s[A+48>>2]|0)==1)){m=u;return}n[A+54>>0]=1,m=u;return}if((M|0)!=(T|0)){M=A+36|0,s[M>>2]=(s[M>>2]|0)+1,n[A+54>>0]=1,m=u;return}if(T=A+24|0,E=s[T>>2]|0,(E|0)==2?s[T>>2]=V:V=E,!((V|0)==1&&(s[A+48>>2]|0)==1)){m=u;return}n[A+54>>0]=1,m=u}function al(u,A,T,E,V){u=u|0,A=A|0,T=T|0,E=E|0,V=V|0;var M=0,x=0,F=0,K=0,R=0;if(M=m,(u|0)==(s[A+8>>2]|0)){if((s[A+4>>2]|0)!=(T|0)){m=M;return}if(x=A+28|0,(s[x>>2]|0)==1){m=M;return}s[x>>2]=E,m=M;return}if((u|0)!=(s[A>>2]|0)){K=s[u+8>>2]|0,cl[s[(s[K>>2]|0)+24>>2]&3](K,A,T,E,V),m=M;return}if((s[A+16>>2]|0)!=(T|0)&&(F=A+20|0,(s[F>>2]|0)!=(T|0))){if(s[A+32>>2]=E,E=A+44|0,(s[E>>2]|0)==4){m=M;return}K=A+52|0,n[K>>0]=0,R=A+53|0,n[R>>0]=0,u=s[u+8>>2]|0,Ua[s[(s[u>>2]|0)+20>>2]&3](u,A,T,T,1,V),n[R>>0]|0?n[K>>0]|0||(u=1,x=13):(u=0,x=13);do if((x|0)==13){if(s[F>>2]=T,R=A+40|0,s[R>>2]=(s[R>>2]|0)+1,(s[A+36>>2]|0)==1&&(s[A+24>>2]|0)==2){if(n[A+54>>0]=1,u)break}else x=16;if((x|0)==16&&u)break;s[E>>2]=4,m=M;return}while(!1);s[E>>2]=3,m=M;return}if((E|0)!=1){m=M;return}s[A+32>>2]=1,m=M}function Nh(u,A,T,E,V){u=u|0,A=A|0,T=T|0,E=E|0,V=V|0;var M=0;if(V=m,(s[A+8>>2]|0)==(u|0)){if((s[A+4>>2]|0)!=(T|0)){m=V;return}if(A=A+28|0,(s[A>>2]|0)==1){m=V;return}s[A>>2]=E,m=V;return}if((s[A>>2]|0)!=(u|0)){m=V;return}if((s[A+16>>2]|0)!=(T|0)&&(M=A+20|0,(s[M>>2]|0)!=(T|0))){s[A+32>>2]=E,s[M>>2]=T,u=A+40|0,s[u>>2]=(s[u>>2]|0)+1,(s[A+36>>2]|0)==1&&(s[A+24>>2]|0)==2&&(n[A+54>>0]=1),s[A+44>>2]=4,m=V;return}if((E|0)!=1){m=V;return}s[A+32>>2]=1,m=V}function Un(u,A,T,E,V,M){u=u|0,A=A|0,T=T|0,E=E|0,V=V|0,M=M|0;var x=0;if(x=m,(u|0)==(s[A+8>>2]|0)){cs(0,A,T,E,V),m=x;return}else{u=s[u+8>>2]|0,Ua[s[(s[u>>2]|0)+20>>2]&3](u,A,T,E,V,M),m=x;return}}function Ra(u,A,T,E,V,M){if(u=u|0,A=A|0,T=T|0,E=E|0,V=V|0,M=M|0,M=m,(s[A+8>>2]|0)!=(u|0)){m=M;return}cs(0,A,T,E,V),m=M}function Bh(u,A,T){u=u|0,A=A|0,T=T|0;var E=0,V=0;return E=m,m=m+16|0,V=E,s[V>>2]=s[T>>2],u=ya[s[(s[u>>2]|0)+16>>2]&1](u,A,V)|0,A=u&1,u?(s[T>>2]=s[V>>2],m=E,A|0):(m=E,A|0)}function oa(u){u=u|0;var A=0;return A=m,u?u=(xs(u,4504,4672,0)|0)!=0:u=0,m=A,u&1|0}function Na(){var u=0,A=0,T=0,E=0,V=0;u=m,m=m+16|0,A=u,u=u+12|0,T=ra()|0,T||vn(4040,A),T=s[T>>2]|0,T||vn(4040,A),V=T+48|0,E=s[V>>2]|0,V=s[V+4>>2]|0,(E&-256|0)==1126902528&(V|0)==1129074247||(s[A>>2]=s[970],vn(4e3,A)),(E|0)==1126902529&(V|0)==1129074247?E=s[T+44>>2]|0:E=T+80|0,s[u>>2]=E,V=s[T>>2]|0,T=s[V+4>>2]|0,ya[s[(s[1108]|0)+16>>2]&1](4432,V,u)|0?(V=s[u>>2]|0,E=s[970]|0,V=rh[s[(s[V>>2]|0)+8>>2]&1](V)|0,s[A>>2]=E,s[A+4>>2]=T,s[A+8>>2]=V,vn(3904,A)):(s[A>>2]=s[970],s[A+4>>2]=T,vn(3952,A))}function Ba(){var u=0;if(u=m,m=m+16|0,Jt(4056,20)|0)vn(4128,u);else{m=u;return}}function Ms(u){u=u|0;var A=0;if(A=m,m=m+16|0,di(u),Si(s[1014]|0,0)|0)vn(4184,A);else{m=A;return}}function aa(u){u=u|0;var A=0,T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0,_e=0,ge=0,Oe=0,$e=0,Ye=0,it=0,Dt=0,ni=0,ei=0,at=0,Ht=0,Zt=0,kt=0,Xt=0,It=0,Nt=0,Ot=0,st=0;A=m;do if(u>>>0<245){if(u>>>0<11?u=16:u=u+11&-8,ni=u>>>3,ee=s[1206]|0,Dt=ee>>>ni,Dt&3){M=(Dt&1^1)+ni|0,V=M<<1,T=4864+(V<<2)|0,V=4864+(V+2<<2)|0,x=s[V>>2]|0,F=x+8|0,E=s[F>>2]|0;do if((T|0)!=(E|0))if(E>>>0<(s[1210]|0)>>>0&&St(),K=E+12|0,(s[K>>2]|0)==(x|0)){s[K>>2]=T,s[V>>2]=E;break}else St();else s[1206]=ee&~(1<<M);while(!1);return st=M<<3,s[x+4>>2]=st|3,st=x+(st|4)|0,s[st>>2]=s[st>>2]|1,st=F,m=A,st|0}if(it=s[1208]|0,u>>>0>it>>>0){if(Dt){x=2<<ni,x=Dt<<ni&(x|0-x),x=(x&0-x)+-1|0,T=x>>>12&16,x=x>>>T,F=x>>>5&8,x=x>>>F,V=x>>>2&4,x=x>>>V,M=x>>>1&2,x=x>>>M,E=x>>>1&1,E=(F|T|V|M|E)+(x>>>E)|0,x=E<<1,M=4864+(x<<2)|0,x=4864+(x+2<<2)|0,V=s[x>>2]|0,T=V+8|0,F=s[T>>2]|0;do if((M|0)!=(F|0))if(F>>>0<(s[1210]|0)>>>0&&St(),K=F+12|0,(s[K>>2]|0)==(V|0)){s[K>>2]=M,s[x>>2]=F,It=s[1208]|0;break}else St();else s[1206]=ee&~(1<<E),It=it;while(!1);return st=E<<3,E=st-u|0,s[V+4>>2]=u|3,M=V+u|0,s[V+(u|4)>>2]=E|1,s[V+st>>2]=E,It&&(V=s[1211]|0,R=It>>>3,F=R<<1,x=4864+(F<<2)|0,K=s[1206]|0,R=1<<R,K&R?(F=4864+(F+2<<2)|0,K=s[F>>2]|0,K>>>0<(s[1210]|0)>>>0?St():(Xt=F,kt=K)):(s[1206]=K|R,Xt=4864+(F+2<<2)|0,kt=x),s[Xt>>2]=V,s[kt+12>>2]=V,s[V+8>>2]=kt,s[V+12>>2]=x),s[1208]=E,s[1211]=M,st=T,m=A,st|0}if(ee=s[1207]|0,ee){for(T=(ee&0-ee)+-1|0,Ot=T>>>12&16,T=T>>>Ot,Nt=T>>>5&8,T=T>>>Nt,st=T>>>2&4,T=T>>>st,V=T>>>1&2,T=T>>>V,E=T>>>1&1,E=s[5128+((Nt|Ot|st|V|E)+(T>>>E)<<2)>>2]|0,T=(s[E+4>>2]&-8)-u|0,V=E;M=s[V+16>>2]|0,!(!M&&(M=s[V+20>>2]|0,!M));)V=(s[M+4>>2]&-8)-u|0,st=V>>>0<T>>>0,T=st?V:T,V=M,E=st?M:E;x=s[1210]|0,E>>>0<x>>>0&&St(),V=E+u|0,E>>>0>=V>>>0&&St(),M=s[E+24>>2]|0,K=s[E+12>>2]|0;do if((K|0)==(E|0)){if(K=E+20|0,F=s[K>>2]|0,!F&&(K=E+16|0,F=s[K>>2]|0,!F)){Zt=0;break}for(;;){if(R=F+20|0,U=s[R>>2]|0,U){F=U,K=R;continue}if(R=F+16|0,U=s[R>>2]|0,U)F=U,K=R;else break}if(K>>>0<x>>>0)St();else{s[K>>2]=0,Zt=F;break}}else if(F=s[E+8>>2]|0,F>>>0<x>>>0&&St(),x=F+12|0,(s[x>>2]|0)!=(E|0)&&St(),R=K+8|0,(s[R>>2]|0)==(E|0)){s[x>>2]=K,s[R>>2]=F,Zt=K;break}else St();while(!1);do if(M){if(F=s[E+28>>2]|0,x=5128+(F<<2)|0,(E|0)==(s[x>>2]|0)){if(s[x>>2]=Zt,!Zt){s[1207]=s[1207]&~(1<<F);break}}else if(M>>>0<(s[1210]|0)>>>0&&St(),x=M+16|0,(s[x>>2]|0)==(E|0)?s[x>>2]=Zt:s[M+20>>2]=Zt,!Zt)break;x=s[1210]|0,Zt>>>0<x>>>0&&St(),s[Zt+24>>2]=M,M=s[E+16>>2]|0;do if(M)if(M>>>0<x>>>0)St();else{s[Zt+16>>2]=M,s[M+24>>2]=Zt;break}while(!1);if(M=s[E+20>>2]|0,M)if(M>>>0<(s[1210]|0)>>>0)St();else{s[Zt+20>>2]=M,s[M+24>>2]=Zt;break}}while(!1);return T>>>0<16?(st=T+u|0,s[E+4>>2]=st|3,st=E+(st+4)|0,s[st>>2]=s[st>>2]|1):(s[E+4>>2]=u|3,s[E+(u|4)>>2]=T|1,s[E+(T+u)>>2]=T,x=s[1208]|0,x&&(M=s[1211]|0,K=x>>>3,R=K<<1,x=4864+(R<<2)|0,F=s[1206]|0,K=1<<K,F&K?(F=4864+(R+2<<2)|0,K=s[F>>2]|0,K>>>0<(s[1210]|0)>>>0?St():(Ht=F,at=K)):(s[1206]=F|K,Ht=4864+(R+2<<2)|0,at=x),s[Ht>>2]=M,s[at+12>>2]=M,s[M+8>>2]=at,s[M+12>>2]=x),s[1208]=T,s[1211]=V),st=E+8|0,m=A,st|0}}}else if(u>>>0<=4294967231){if(at=u+11|0,u=at&-8,Zt=s[1207]|0,Zt){Ht=0-u|0,at=at>>>8,at?u>>>0>16777215?kt=31:(Ot=(at+1048320|0)>>>16&8,st=at<<Ot,Nt=(st+520192|0)>>>16&4,st=st<<Nt,kt=(st+245760|0)>>>16&2,kt=14-(Nt|Ot|kt)+(st<<kt>>>15)|0,kt=u>>>(kt+7|0)&1|kt<<1):kt=0,Xt=s[5128+(kt<<2)>>2]|0;e:do if(!Xt)Nt=0,at=0;else for((kt|0)==31?at=0:at=25-(kt>>>1)|0,Nt=0,It=u<<at,at=0;;){if(Ot=s[Xt+4>>2]&-8,st=Ot-u|0,st>>>0<Ht>>>0)if((Ot|0)==(u|0)){Ht=st,Nt=Xt,at=Xt;break e}else Ht=st,at=Xt;if(st=s[Xt+20>>2]|0,Xt=s[Xt+(It>>>31<<2)+16>>2]|0,Nt=(st|0)==0|(st|0)==(Xt|0)?Nt:st,Xt)It=It<<1;else break}while(!1);if((Nt|0)==0&(at|0)==0){if(st=2<<kt,Zt=Zt&(st|0-st),!Zt)break;st=(Zt&0-Zt)+-1|0,Xt=st>>>12&16,st=st>>>Xt,kt=st>>>5&8,st=st>>>kt,It=st>>>2&4,st=st>>>It,Ot=st>>>1&2,st=st>>>Ot,Nt=st>>>1&1,Nt=s[5128+((kt|Xt|It|Ot|Nt)+(st>>>Nt)<<2)>>2]|0}if(Nt)for(;;){if(st=(s[Nt+4>>2]&-8)-u|0,Zt=st>>>0<Ht>>>0,Ht=Zt?st:Ht,at=Zt?Nt:at,Zt=s[Nt+16>>2]|0,Zt){Nt=Zt;continue}if(Nt=s[Nt+20>>2]|0,!Nt)break}if(at|0&&Ht>>>0<((s[1208]|0)-u|0)>>>0){V=s[1210]|0,at>>>0<V>>>0&&St(),T=at+u|0,at>>>0>=T>>>0&&St(),E=s[at+24>>2]|0,M=s[at+12>>2]|0;do if((M|0)==(at|0)){if(x=at+20|0,M=s[x>>2]|0,!M&&(x=at+16|0,M=s[x>>2]|0,!M)){ni=0;break}for(;;){if(F=M+20|0,K=s[F>>2]|0,K){M=K,x=F;continue}if(F=M+16|0,K=s[F>>2]|0,K)M=K,x=F;else break}if(x>>>0<V>>>0)St();else{s[x>>2]=0,ni=M;break}}else if(x=s[at+8>>2]|0,x>>>0<V>>>0&&St(),F=x+12|0,(s[F>>2]|0)!=(at|0)&&St(),V=M+8|0,(s[V>>2]|0)==(at|0)){s[F>>2]=M,s[V>>2]=x,ni=M;break}else St();while(!1);do if(E){if(V=s[at+28>>2]|0,M=5128+(V<<2)|0,(at|0)==(s[M>>2]|0)){if(s[M>>2]=ni,!ni){s[1207]=s[1207]&~(1<<V);break}}else if(E>>>0<(s[1210]|0)>>>0&&St(),V=E+16|0,(s[V>>2]|0)==(at|0)?s[V>>2]=ni:s[E+20>>2]=ni,!ni)break;V=s[1210]|0,ni>>>0<V>>>0&&St(),s[ni+24>>2]=E,E=s[at+16>>2]|0;do if(E)if(E>>>0<V>>>0)St();else{s[ni+16>>2]=E,s[E+24>>2]=ni;break}while(!1);if(E=s[at+20>>2]|0,E)if(E>>>0<(s[1210]|0)>>>0)St();else{s[ni+20>>2]=E,s[E+24>>2]=ni;break}}while(!1);e:do if(Ht>>>0>=16){if(s[at+4>>2]=u|3,s[at+(u|4)>>2]=Ht|1,s[at+(Ht+u)>>2]=Ht,V=Ht>>>3,Ht>>>0<256){x=V<<1,E=4864+(x<<2)|0,M=s[1206]|0,V=1<<V;do if(!(M&V))s[1206]=M|V,Dt=4864+(x+2<<2)|0,it=E;else{if(V=4864+(x+2<<2)|0,M=s[V>>2]|0,M>>>0>=(s[1210]|0)>>>0){Dt=V,it=M;break}St()}while(!1);s[Dt>>2]=T,s[it+12>>2]=T,s[at+(u+8)>>2]=it,s[at+(u+12)>>2]=E;break}if(E=Ht>>>8,E?Ht>>>0>16777215?E=31:(Ot=(E+1048320|0)>>>16&8,st=E<<Ot,Nt=(st+520192|0)>>>16&4,st=st<<Nt,E=(st+245760|0)>>>16&2,E=14-(Nt|Ot|E)+(st<<E>>>15)|0,E=Ht>>>(E+7|0)&1|E<<1):E=0,V=5128+(E<<2)|0,s[at+(u+28)>>2]=E,s[at+(u+20)>>2]=0,s[at+(u+16)>>2]=0,M=s[1207]|0,x=1<<E,!(M&x)){s[1207]=M|x,s[V>>2]=T,s[at+(u+24)>>2]=V,s[at+(u+12)>>2]=T,s[at+(u+8)>>2]=T;break}x=s[V>>2]|0,(E|0)==31?E=0:E=25-(E>>>1)|0;t:do if((s[x+4>>2]&-8|0)!=(Ht|0)){for(E=Ht<<E;M=x+(E>>>31<<2)+16|0,V=s[M>>2]|0,!!V;)if((s[V+4>>2]&-8|0)==(Ht|0)){ee=V;break t}else E=E<<1,x=V;if(M>>>0<(s[1210]|0)>>>0)St();else{s[M>>2]=T,s[at+(u+24)>>2]=x,s[at+(u+12)>>2]=T,s[at+(u+8)>>2]=T;break e}}else ee=x;while(!1);if(V=ee+8|0,E=s[V>>2]|0,st=s[1210]|0,ee>>>0>=st>>>0&E>>>0>=st>>>0){s[E+12>>2]=T,s[V>>2]=T,s[at+(u+8)>>2]=E,s[at+(u+12)>>2]=ee,s[at+(u+24)>>2]=0;break}else St()}else st=Ht+u|0,s[at+4>>2]=st|3,st=at+(st+4)|0,s[st>>2]=s[st>>2]|1;while(!1);return st=at+8|0,m=A,st|0}}}else u=-1;while(!1);if(ee=s[1208]|0,ee>>>0>=u>>>0)return E=ee-u|0,T=s[1211]|0,E>>>0>15?(s[1211]=T+u,s[1208]=E,s[T+(u+4)>>2]=E|1,s[T+ee>>2]=E,s[T+4>>2]=u|3):(s[1208]=0,s[1211]=0,s[T+4>>2]=ee|3,st=T+(ee+4)|0,s[st>>2]=s[st>>2]|1),st=T+8|0,m=A,st|0;if(ee=s[1209]|0,ee>>>0>u>>>0)return Ot=ee-u|0,s[1209]=Ot,st=s[1212]|0,s[1212]=st+u,s[st+(u+4)>>2]=Ot|1,s[st+4>>2]=u|3,st=st+8|0,m=A,st|0;do if(!(s[1324]|0))if(ee=Je(30)|0,ee+-1&ee)St();else{s[1326]=ee,s[1325]=ee,s[1327]=-1,s[1328]=-1,s[1329]=0,s[1317]=0,s[1324]=(zi(0)|0)&-16^1431655768;break}while(!1);if(ni=u+48|0,ee=s[1326]|0,Dt=u+47|0,Ht=ee+Dt|0,ee=0-ee|0,it=Ht&ee,it>>>0<=u>>>0||(at=s[1316]|0,at|0&&(Ot=s[1314]|0,st=Ot+it|0,st>>>0<=Ot>>>0|st>>>0>at>>>0)))return st=0,m=A,st|0;e:do if(s[1317]&4)at=0,ne=198;else{Zt=s[1212]|0;t:do if(Zt){for(at=5272;kt=s[at>>2]|0,!(kt>>>0<=Zt>>>0&&(ei=at+4|0,(kt+(s[ei>>2]|0)|0)>>>0>Zt>>>0));)if(at=s[at+8>>2]|0,!at){ne=181;break t}at?(Ht=Ht-(s[1209]|0)&ee,Ht>>>0<2147483647?(ee=Me(Ht|0)|0,(ee|0)==((s[at>>2]|0)+(s[ei>>2]|0)|0)?(at=Ht,ne=190):(at=Ht,ne=191)):at=0):ne=181}else ne=181;while(!1);do if((ne|0)==181)if(ei=Me(0)|0,(ei|0)!=-1)if(Ht=ei,at=s[1325]|0,ee=at+-1|0,ee&Ht?at=it-Ht+(ee+Ht&0-at)|0:at=it,ee=s[1314]|0,Ht=ee+at|0,at>>>0>u>>>0&at>>>0<2147483647){if(st=s[1316]|0,st|0&&Ht>>>0<=ee>>>0|Ht>>>0>st>>>0){at=0;break}ee=Me(at|0)|0,(ee|0)==(ei|0)?(ee=ei,ne=190):ne=191}else at=0;else at=0;while(!1);t:do if((ne|0)==190){if((ee|0)!=-1){_e=at,ne=201;break e}}else if((ne|0)==191){ne=0-at|0;do if((ee|0)!=-1&at>>>0<2147483647&ni>>>0>at>>>0&&(Ye=s[1326]|0,Ye=Dt-at+Ye&0-Ye,Ye>>>0<2147483647))if((Me(Ye|0)|0)==-1){Me(ne|0)|0,at=0;break t}else{at=Ye+at|0;break}while(!1);if((ee|0)==-1)at=0;else{_e=at,ne=201;break e}}while(!1);s[1317]=s[1317]|4,ne=198}while(!1);if((ne|0)==198&&it>>>0<2147483647&&($e=Me(it|0)|0,Oe=Me(0)|0,($e|0)!=-1&(Oe|0)!=-1&$e>>>0<Oe>>>0)&&(ge=Oe-$e|0,_e=ge>>>0>(u+40|0)>>>0,_e)&&(ee=$e,_e=_e?ge:at,ne=201),(ne|0)==201){ge=(s[1314]|0)+_e|0,s[1314]=ge,ge>>>0>(s[1315]|0)>>>0&&(s[1315]=ge),ge=s[1212]|0;e:do if(ge){for($e=5272;;){if(Oe=s[$e>>2]|0,it=$e+4|0,Dt=s[it>>2]|0,(ee|0)==(Oe+Dt|0)){ne=213;break}if(Ye=s[$e+8>>2]|0,Ye)$e=Ye;else break}if((ne|0)==213&&!(s[$e+12>>2]&8|0)&&ge>>>0>=Oe>>>0&ge>>>0<ee>>>0){s[it>>2]=Dt+_e,T=(s[1209]|0)+_e|0,E=ge+8|0,E&7?E=0-E&7:E=0,st=T-E|0,s[1212]=ge+E,s[1209]=st,s[ge+(E+4)>>2]=st|1,s[ge+(T+4)>>2]=40,s[1213]=s[1328];break}for(Oe=s[1210]|0,ee>>>0<Oe>>>0&&(s[1210]=ee,Oe=ee),it=ee+_e|0,$e=5272;;){if((s[$e>>2]|0)==(it|0)){ne=223;break}if(Ye=s[$e+8>>2]|0,Ye)$e=Ye;else break}if((ne|0)==223&&!(s[$e+12>>2]&8|0)){s[$e>>2]=ee,x=$e+4|0,s[x>>2]=(s[x>>2]|0)+_e,x=ee+8|0,x&7?x=0-x&7:x=0,F=ee+(_e+8)|0,F&7?te=0-F&7:te=0,ne=ee+(te+_e)|0,K=x+u|0,F=ee+K|0,U=ne-(ee+x)-u|0,s[ee+(x+4)>>2]=u|3;t:do if((ne|0)!=(ge|0)){if((ne|0)==(s[1211]|0)){st=(s[1208]|0)+U|0,s[1208]=st,s[1211]=F,s[ee+(K+4)>>2]=st|1,s[ee+(st+K)>>2]=st;break}if(ge=_e+4|0,Ye=s[ee+(ge+te)>>2]|0,(Ye&3|0)==1){u=Ye&-8,$e=Ye>>>3;i:do if(Ye>>>0>=256){R=s[ee+((te|24)+_e)>>2]|0,$e=s[ee+(_e+12+te)>>2]|0;do if(($e|0)==(ne|0)){if(it=te|16,Ye=ee+(ge+it)|0,$e=s[Ye>>2]|0,!$e&&(Ye=ee+(it+_e)|0,$e=s[Ye>>2]|0,!$e)){M=0;break}for(;;){if(Dt=$e+20|0,it=s[Dt>>2]|0,it){$e=it,Ye=Dt;continue}if(Dt=$e+16|0,it=s[Dt>>2]|0,it)$e=it,Ye=Dt;else break}if(Ye>>>0<Oe>>>0)St();else{s[Ye>>2]=0,M=$e;break}}else if(Ye=s[ee+((te|8)+_e)>>2]|0,Ye>>>0<Oe>>>0&&St(),it=Ye+12|0,(s[it>>2]|0)!=(ne|0)&&St(),Oe=$e+8|0,(s[Oe>>2]|0)==(ne|0)){s[it>>2]=$e,s[Oe>>2]=Ye,M=$e;break}else St();while(!1);if(!R)break;Oe=s[ee+(_e+28+te)>>2]|0,$e=5128+(Oe<<2)|0;do if((ne|0)!=(s[$e>>2]|0)){if(R>>>0<(s[1210]|0)>>>0&&St(),Oe=R+16|0,(s[Oe>>2]|0)==(ne|0)?s[Oe>>2]=M:s[R+20>>2]=M,!M)break i}else{if(s[$e>>2]=M,M)break;s[1207]=s[1207]&~(1<<Oe);break i}while(!1);ne=s[1210]|0,M>>>0<ne>>>0&&St(),s[M+24>>2]=R,Oe=te|16,R=s[ee+(Oe+_e)>>2]|0;do if(R)if(R>>>0<ne>>>0)St();else{s[M+16>>2]=R,s[R+24>>2]=M;break}while(!1);if(R=s[ee+(ge+Oe)>>2]|0,!R)break;if(R>>>0<(s[1210]|0)>>>0)St();else{s[M+20>>2]=R,s[R+24>>2]=M;break}}else{M=s[ee+((te|8)+_e)>>2]|0,ge=s[ee+(_e+12+te)>>2]|0,Ye=4864+($e<<1<<2)|0;do if((M|0)!=(Ye|0)){if(M>>>0<Oe>>>0&&St(),(s[M+12>>2]|0)==(ne|0))break;St()}while(!1);if((ge|0)==(M|0)){s[1206]=s[1206]&~(1<<$e);break}do if((ge|0)==(Ye|0))R=ge+8|0;else{if(ge>>>0<Oe>>>0&&St(),Oe=ge+8|0,(s[Oe>>2]|0)==(ne|0)){R=Oe;break}St()}while(!1);s[M+12>>2]=ge,s[R>>2]=M}while(!1);ne=ee+((u|te)+_e)|0,U=u+U|0}if(M=ne+4|0,s[M>>2]=s[M>>2]&-2,s[ee+(K+4)>>2]=U|1,s[ee+(U+K)>>2]=U,M=U>>>3,U>>>0<256){R=M<<1,T=4864+(R<<2)|0,U=s[1206]|0,M=1<<M;do if(!(U&M))s[1206]=U|M,V=4864+(R+2<<2)|0,E=T;else{if(R=4864+(R+2<<2)|0,M=s[R>>2]|0,M>>>0>=(s[1210]|0)>>>0){V=R,E=M;break}St()}while(!1);s[V>>2]=F,s[E+12>>2]=F,s[ee+(K+8)>>2]=E,s[ee+(K+12)>>2]=T;break}E=U>>>8;do if(!E)E=0;else{if(U>>>0>16777215){E=31;break}Ot=(E+1048320|0)>>>16&8,st=E<<Ot,Nt=(st+520192|0)>>>16&4,st=st<<Nt,E=(st+245760|0)>>>16&2,E=14-(Nt|Ot|E)+(st<<E>>>15)|0,E=U>>>(E+7|0)&1|E<<1}while(!1);if(R=5128+(E<<2)|0,s[ee+(K+28)>>2]=E,s[ee+(K+20)>>2]=0,s[ee+(K+16)>>2]=0,M=s[1207]|0,V=1<<E,!(M&V)){s[1207]=M|V,s[R>>2]=F,s[ee+(K+24)>>2]=R,s[ee+(K+12)>>2]=F,s[ee+(K+8)>>2]=F;break}V=s[R>>2]|0,(E|0)==31?E=0:E=25-(E>>>1)|0;i:do if((s[V+4>>2]&-8|0)!=(U|0)){for(E=U<<E;M=V+(E>>>31<<2)+16|0,R=s[M>>2]|0,!!R;)if((s[R+4>>2]&-8|0)==(U|0)){T=R;break i}else E=E<<1,V=R;if(M>>>0<(s[1210]|0)>>>0)St();else{s[M>>2]=F,s[ee+(K+24)>>2]=V,s[ee+(K+12)>>2]=F,s[ee+(K+8)>>2]=F;break t}}else T=V;while(!1);if(E=T+8|0,V=s[E>>2]|0,st=s[1210]|0,T>>>0>=st>>>0&V>>>0>=st>>>0){s[V+12>>2]=F,s[E>>2]=F,s[ee+(K+8)>>2]=V,s[ee+(K+12)>>2]=T,s[ee+(K+24)>>2]=0;break}else St()}else st=(s[1209]|0)+U|0,s[1209]=st,s[1212]=F,s[ee+(K+4)>>2]=st|1;while(!1);return st=ee+(x|8)|0,m=A,st|0}for(E=5272;T=s[E>>2]|0,!(T>>>0<=ge>>>0&&(te=s[E+4>>2]|0,U=T+te|0,U>>>0>ge>>>0));)E=s[E+8>>2]|0;if(E=T+(te+-39)|0,E&7?E=0-E&7:E=0,T=T+(te+-47+E)|0,T=T>>>0<(ge+16|0)>>>0?ge:T,E=T+8|0,V=ee+8|0,V&7?V=0-V&7:V=0,st=_e+-40-V|0,s[1212]=ee+V,s[1209]=st,s[ee+(V+4)>>2]=st|1,s[ee+(_e+-36)>>2]=40,s[1213]=s[1328],s[T+4>>2]=27,s[E+0>>2]=s[1318],s[E+4>>2]=s[1319],s[E+8>>2]=s[1320],s[E+12>>2]=s[1321],s[1318]=ee,s[1319]=_e,s[1321]=0,s[1320]=E,E=T+28|0,s[E>>2]=7,(T+32|0)>>>0<U>>>0)do st=E,E=E+4|0,s[E>>2]=7;while((st+8|0)>>>0<U>>>0);if((T|0)!=(ge|0)){if(T=T-ge|0,E=ge+(T+4)|0,s[E>>2]=s[E>>2]&-2,s[ge+4>>2]=T|1,s[ge+T>>2]=T,E=T>>>3,T>>>0<256){V=E<<1,T=4864+(V<<2)|0,M=s[1206]|0,E=1<<E;do if(!(M&E))s[1206]=M|E,K=4864+(V+2<<2)|0,F=T;else{if(V=4864+(V+2<<2)|0,E=s[V>>2]|0,E>>>0>=(s[1210]|0)>>>0){K=V,F=E;break}St()}while(!1);s[K>>2]=ge,s[F+12>>2]=ge,s[ge+8>>2]=F,s[ge+12>>2]=T;break}if(E=T>>>8,E?T>>>0>16777215?E=31:(Ot=(E+1048320|0)>>>16&8,st=E<<Ot,Nt=(st+520192|0)>>>16&4,st=st<<Nt,E=(st+245760|0)>>>16&2,E=14-(Nt|Ot|E)+(st<<E>>>15)|0,E=T>>>(E+7|0)&1|E<<1):E=0,F=5128+(E<<2)|0,s[ge+28>>2]=E,s[ge+20>>2]=0,s[ge+16>>2]=0,V=s[1207]|0,M=1<<E,!(V&M)){s[1207]=V|M,s[F>>2]=ge,s[ge+24>>2]=F,s[ge+12>>2]=ge,s[ge+8>>2]=ge;break}V=s[F>>2]|0,(E|0)==31?E=0:E=25-(E>>>1)|0;t:do if((s[V+4>>2]&-8|0)!=(T|0)){for(E=T<<E,F=V;V=F+(E>>>31<<2)+16|0,M=s[V>>2]|0,!!M;)if((s[M+4>>2]&-8|0)==(T|0)){x=M;break t}else E=E<<1,F=M;if(V>>>0<(s[1210]|0)>>>0)St();else{s[V>>2]=ge,s[ge+24>>2]=F,s[ge+12>>2]=ge,s[ge+8>>2]=ge;break e}}else x=V;while(!1);if(E=x+8|0,T=s[E>>2]|0,st=s[1210]|0,x>>>0>=st>>>0&T>>>0>=st>>>0){s[T+12>>2]=ge,s[E>>2]=ge,s[ge+8>>2]=T,s[ge+12>>2]=x,s[ge+24>>2]=0;break}else St()}}else{st=s[1210]|0,(st|0)==0|ee>>>0<st>>>0&&(s[1210]=ee),s[1318]=ee,s[1319]=_e,s[1321]=0,s[1215]=s[1324],s[1214]=-1,T=0;do st=T<<1,Ot=4864+(st<<2)|0,s[4864+(st+3<<2)>>2]=Ot,s[4864+(st+2<<2)>>2]=Ot,T=T+1|0;while((T|0)!=32);T=ee+8|0,T&7?T=0-T&7:T=0,st=_e+-40-T|0,s[1212]=ee+T,s[1209]=st,s[ee+(T+4)>>2]=st|1,s[ee+(_e+-36)>>2]=40,s[1213]=s[1328]}while(!1);if(T=s[1209]|0,T>>>0>u>>>0)return Ot=T-u|0,s[1209]=Ot,st=s[1212]|0,s[1212]=st+u,s[st+(u+4)>>2]=Ot|1,s[st+4>>2]=u|3,st=st+8|0,m=A,st|0}return s[(Rt()|0)>>2]=12,st=0,m=A,st|0}function di(u){u=u|0;var A=0,T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0,_e=0,ge=0,Oe=0,$e=0,Ye=0,it=0,Dt=0;if(A=m,!u){m=A;return}_e=u+-8|0,ge=s[1210]|0,_e>>>0<ge>>>0&&St(),te=s[u+-4>>2]|0,U=te&3,(U|0)==1&&St(),F=te&-8,x=u+(F+-8)|0;do if(te&1)E=_e,ne=F;else{if(Ye=s[_e>>2]|0,!U){m=A;return}if(_e=-8-Ye|0,te=u+_e|0,U=Ye+F|0,te>>>0<ge>>>0&&St(),(te|0)==(s[1211]|0)){if(E=u+(F+-4)|0,ne=s[E>>2]|0,(ne&3|0)!=3){E=te,ne=U;break}s[1208]=U,s[E>>2]=ne&-2,s[u+(_e+4)>>2]=U|1,s[x>>2]=U,m=A;return}if($e=Ye>>>3,Ye>>>0<256){if(E=s[u+(_e+8)>>2]|0,ne=s[u+(_e+12)>>2]|0,ee=4864+($e<<1<<2)|0,(E|0)!=(ee|0)&&(E>>>0<ge>>>0&&St(),(s[E+12>>2]|0)!=(te|0)&&St()),(ne|0)==(E|0)){s[1206]=s[1206]&~(1<<$e),E=te,ne=U;break}(ne|0)!=(ee|0)?(ne>>>0<ge>>>0&&St(),ee=ne+8|0,(s[ee>>2]|0)==(te|0)?Oe=ee:St()):Oe=ne+8|0,s[E+12>>2]=ne,s[Oe>>2]=E,E=te,ne=U;break}Oe=s[u+(_e+24)>>2]|0,$e=s[u+(_e+12)>>2]|0;do if(($e|0)==(te|0)){if(Ye=u+(_e+20)|0,$e=s[Ye>>2]|0,!$e&&(Ye=u+(_e+16)|0,$e=s[Ye>>2]|0,!$e)){ee=0;break}for(;;){if(it=$e+20|0,Dt=s[it>>2]|0,Dt){$e=Dt,Ye=it;continue}if(it=$e+16|0,Dt=s[it>>2]|0,Dt)$e=Dt,Ye=it;else break}if(Ye>>>0<ge>>>0)St();else{s[Ye>>2]=0,ee=$e;break}}else if(Ye=s[u+(_e+8)>>2]|0,Ye>>>0<ge>>>0&&St(),ge=Ye+12|0,(s[ge>>2]|0)!=(te|0)&&St(),it=$e+8|0,(s[it>>2]|0)==(te|0)){s[ge>>2]=$e,s[it>>2]=Ye,ee=$e;break}else St();while(!1);if(Oe){if(ge=s[u+(_e+28)>>2]|0,$e=5128+(ge<<2)|0,(te|0)==(s[$e>>2]|0)){if(s[$e>>2]=ee,!ee){s[1207]=s[1207]&~(1<<ge),E=te,ne=U;break}}else if(Oe>>>0<(s[1210]|0)>>>0&&St(),ge=Oe+16|0,(s[ge>>2]|0)==(te|0)?s[ge>>2]=ee:s[Oe+20>>2]=ee,!ee){E=te,ne=U;break}ge=s[1210]|0,ee>>>0<ge>>>0&&St(),s[ee+24>>2]=Oe,Oe=s[u+(_e+16)>>2]|0;do if(Oe)if(Oe>>>0<ge>>>0)St();else{s[ee+16>>2]=Oe,s[Oe+24>>2]=ee;break}while(!1);if(_e=s[u+(_e+20)>>2]|0,_e)if(_e>>>0<(s[1210]|0)>>>0)St();else{s[ee+20>>2]=_e,s[_e+24>>2]=ee,E=te,ne=U;break}else E=te,ne=U}else E=te,ne=U}while(!1);if(E>>>0>=x>>>0&&St(),U=u+(F+-4)|0,te=s[U>>2]|0,te&1||St(),te&2)s[U>>2]=te&-2,s[E+4>>2]=ne|1,s[E+ne>>2]=ne;else{if((x|0)==(s[1212]|0)){if(Dt=(s[1209]|0)+ne|0,s[1209]=Dt,s[1212]=E,s[E+4>>2]=Dt|1,(E|0)!=(s[1211]|0)){m=A;return}s[1211]=0,s[1208]=0,m=A;return}if((x|0)==(s[1211]|0)){Dt=(s[1208]|0)+ne|0,s[1208]=Dt,s[1211]=E,s[E+4>>2]=Dt|1,s[E+Dt>>2]=Dt,m=A;return}ne=(te&-8)+ne|0,U=te>>>3;do if(te>>>0>=256){R=s[u+(F+16)>>2]|0,U=s[u+(F|4)>>2]|0;do if((U|0)==(x|0)){if(te=u+(F+12)|0,U=s[te>>2]|0,!U&&(te=u+(F+8)|0,U=s[te>>2]|0,!U)){K=0;break}for(;;){if(_e=U+20|0,ee=s[_e>>2]|0,ee){U=ee,te=_e;continue}if(ee=U+16|0,_e=s[ee>>2]|0,_e)U=_e,te=ee;else break}if(te>>>0<(s[1210]|0)>>>0)St();else{s[te>>2]=0,K=U;break}}else if(te=s[u+F>>2]|0,te>>>0<(s[1210]|0)>>>0&&St(),ee=te+12|0,(s[ee>>2]|0)!=(x|0)&&St(),_e=U+8|0,(s[_e>>2]|0)==(x|0)){s[ee>>2]=U,s[_e>>2]=te,K=U;break}else St();while(!1);if(R){if(U=s[u+(F+20)>>2]|0,te=5128+(U<<2)|0,(x|0)==(s[te>>2]|0)){if(s[te>>2]=K,!K){s[1207]=s[1207]&~(1<<U);break}}else if(R>>>0<(s[1210]|0)>>>0&&St(),U=R+16|0,(s[U>>2]|0)==(x|0)?s[U>>2]=K:s[R+20>>2]=K,!K)break;x=s[1210]|0,K>>>0<x>>>0&&St(),s[K+24>>2]=R,R=s[u+(F+8)>>2]|0;do if(R)if(R>>>0<x>>>0)St();else{s[K+16>>2]=R,s[R+24>>2]=K;break}while(!1);if(x=s[u+(F+12)>>2]|0,x)if(x>>>0<(s[1210]|0)>>>0)St();else{s[K+20>>2]=x,s[x+24>>2]=K;break}}}else{if(K=s[u+F>>2]|0,F=s[u+(F|4)>>2]|0,u=4864+(U<<1<<2)|0,(K|0)!=(u|0)&&(K>>>0<(s[1210]|0)>>>0&&St(),(s[K+12>>2]|0)!=(x|0)&&St()),(F|0)==(K|0)){s[1206]=s[1206]&~(1<<U);break}(F|0)!=(u|0)?(F>>>0<(s[1210]|0)>>>0&&St(),u=F+8|0,(s[u>>2]|0)==(x|0)?R=u:St()):R=F+8|0,s[K+12>>2]=F,s[R>>2]=K}while(!1);if(s[E+4>>2]=ne|1,s[E+ne>>2]=ne,(E|0)==(s[1211]|0)){s[1208]=ne,m=A;return}}if(x=ne>>>3,ne>>>0<256){F=x<<1,T=4864+(F<<2)|0,K=s[1206]|0,x=1<<x,K&x?(F=4864+(F+2<<2)|0,x=s[F>>2]|0,x>>>0<(s[1210]|0)>>>0?St():(V=F,M=x)):(s[1206]=K|x,V=4864+(F+2<<2)|0,M=T),s[V>>2]=E,s[M+12>>2]=E,s[E+8>>2]=M,s[E+12>>2]=T,m=A;return}V=ne>>>8,V?ne>>>0>16777215?V=31:(it=(V+1048320|0)>>>16&8,Dt=V<<it,Ye=(Dt+520192|0)>>>16&4,Dt=Dt<<Ye,V=(Dt+245760|0)>>>16&2,V=14-(Ye|it|V)+(Dt<<V>>>15)|0,V=ne>>>(V+7|0)&1|V<<1):V=0,M=5128+(V<<2)|0,s[E+28>>2]=V,s[E+20>>2]=0,s[E+16>>2]=0,F=s[1207]|0,x=1<<V;e:do if(F&x){M=s[M>>2]|0,(V|0)==31?V=0:V=25-(V>>>1)|0;t:do if((s[M+4>>2]&-8|0)!=(ne|0)){for(V=ne<<V;F=M+(V>>>31<<2)+16|0,x=s[F>>2]|0,!!x;)if((s[x+4>>2]&-8|0)==(ne|0)){T=x;break t}else V=V<<1,M=x;if(F>>>0<(s[1210]|0)>>>0)St();else{s[F>>2]=E,s[E+24>>2]=M,s[E+12>>2]=E,s[E+8>>2]=E;break e}}else T=M;while(!1);if(M=T+8|0,V=s[M>>2]|0,Dt=s[1210]|0,T>>>0>=Dt>>>0&V>>>0>=Dt>>>0){s[V+12>>2]=E,s[M>>2]=E,s[E+8>>2]=V,s[E+12>>2]=T,s[E+24>>2]=0;break}else St()}else s[1207]=F|x,s[M>>2]=E,s[E+24>>2]=M,s[E+12>>2]=E,s[E+8>>2]=E;while(!1);if(Dt=(s[1214]|0)+-1|0,s[1214]=Dt,!Dt)T=5280;else{m=A;return}for(;T=s[T>>2]|0,T;)T=T+8|0;s[1214]=-1,m=A}function ps(u,A){u=u|0,A=A|0;var T=0,E=0,V=0;T=m;do if(u){if(A>>>0>4294967231){s[(Rt()|0)>>2]=12,E=0;break}if(A>>>0<11?E=16:E=A+11&-8,E=la(u+-8|0,E)|0,E){E=E+8|0;break}E=aa(A)|0,E?(V=s[u+-4>>2]|0,V=(V&-8)-(V&3|0?4:8)|0,ih(E|0,u|0,(V>>>0<A>>>0?V:A)|0)|0,di(u)):E=0}else E=aa(A)|0;while(!1);return m=T,E|0}function Zl(u){return u=u|0,(u|0)==32?u=1:u=(u+-9|0)>>>0<5,u&1|0}function Fh(u,A,T,E,V){u=u|0,A=A|0,T=T|0,E=E|0,V=V|0;var M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0,_e=0,ge=0;if(M=m,A>>>0>36)return s[(Rt()|0)>>2]=22,_e=0,ge=0,nt=_e,m=M,ge|0;x=u+4|0,F=u+100|0;do K=s[x>>2]|0,K>>>0<(s[F>>2]|0)>>>0?(s[x>>2]=K+1,U=a[K>>0]|0):U=Zi(u)|0;while(Zl(U)|0);do if((U|0)==43|(U|0)==45)if(K=((U|0)==45)<<31>>31,R=s[x>>2]|0,R>>>0<(s[F>>2]|0)>>>0){s[x>>2]=R+1,U=a[R>>0]|0;break}else{U=Zi(u)|0;break}else K=0;while(!1);R=(A|0)==0;do if((A&-17|0)==0&(U|0)==48){if(U=s[x>>2]|0,U>>>0<(s[F>>2]|0)>>>0?(s[x>>2]=U+1,U=a[U>>0]|0):U=Zi(u)|0,(U|32|0)!=120)if(R){A=8,T=46;break}else{T=32;break}if(A=s[x>>2]|0,A>>>0<(s[F>>2]|0)>>>0?(s[x>>2]=A+1,U=a[A>>0]|0):U=Zi(u)|0,(a[U+5321>>0]|0)>15)return E=(s[F>>2]|0)==0,E||(s[x>>2]=(s[x>>2]|0)+-1),T?E?(_e=0,ge=0,nt=_e,m=M,ge|0):(s[x>>2]=(s[x>>2]|0)+-1,_e=0,ge=0,nt=_e,m=M,ge|0):(kn(u,0),_e=0,ge=0,nt=_e,m=M,ge|0);A=16,T=46}else if(A=R?10:A,(a[U+5321>>0]|0)>>>0<A>>>0)T=32;else return s[F>>2]|0&&(s[x>>2]=(s[x>>2]|0)+-1),kn(u,0),s[(Rt()|0)>>2]=22,_e=0,ge=0,nt=_e,m=M,ge|0;while(!1);if((T|0)==32)if((A|0)==10){if(A=U+-48|0,A>>>0<10){R=0;do R=(R*10|0)+A|0,A=s[x>>2]|0,A>>>0<(s[F>>2]|0)>>>0?(s[x>>2]=A+1,U=a[A>>0]|0):U=Zi(u)|0,A=U+-48|0;while(A>>>0<10&R>>>0<429496729);te=0}else R=0,te=0;if(A=U+-48|0,A>>>0<10){do{if(ne=Gn(R|0,te|0,10,0)|0,ee=nt,_e=((A|0)<0)<<31>>31,ge=~_e,ee>>>0>ge>>>0|(ee|0)==(ge|0)&ne>>>0>~A>>>0)break;R=Xi(ne|0,ee|0,A|0,_e|0)|0,te=nt,A=s[x>>2]|0,A>>>0<(s[F>>2]|0)>>>0?(s[x>>2]=A+1,U=a[A>>0]|0):U=Zi(u)|0,A=U+-48|0}while(A>>>0<10&(te>>>0<429496729|(te|0)==429496729&R>>>0<2576980378));A>>>0<=9&&(A=10,T=72)}}else T=46;e:do if((T|0)==46){if(!(A+-1&A)){if(T=n[5584+((A*23|0)>>>5&7)>>0]|0,ee=n[U+5321>>0]|0,R=ee&255,R>>>0<A>>>0){U=R,R=0;do R=U|R<<T,U=s[x>>2]|0,U>>>0<(s[F>>2]|0)>>>0?(s[x>>2]=U+1,_e=a[U>>0]|0):_e=Zi(u)|0,ee=n[_e+5321>>0]|0,U=ee&255;while(U>>>0<A>>>0&R>>>0<134217728);te=0}else te=0,R=0,_e=U;if(U=th(-1,-1,T|0)|0,ne=nt,(ee&255)>>>0>=A>>>0|(te>>>0>ne>>>0|(te|0)==(ne|0)&R>>>0>U>>>0)){U=_e,T=72;break}for(;;)if(R=Hr(R|0,te|0,T|0)|0,te=nt,R=ee&255|R,ee=s[x>>2]|0,ee>>>0<(s[F>>2]|0)>>>0?(s[x>>2]=ee+1,_e=a[ee>>0]|0):_e=Zi(u)|0,ee=n[_e+5321>>0]|0,(ee&255)>>>0>=A>>>0|(te>>>0>ne>>>0|(te|0)==(ne|0)&R>>>0>U>>>0)){U=_e,T=72;break e}}if(ee=n[U+5321>>0]|0,T=ee&255,T>>>0<A>>>0){R=0;do R=T+(Le(R,A)|0)|0,T=s[x>>2]|0,T>>>0<(s[F>>2]|0)>>>0?(s[x>>2]=T+1,ne=a[T>>0]|0):ne=Zi(u)|0,ee=n[ne+5321>>0]|0,T=ee&255;while(T>>>0<A>>>0&R>>>0<119304647);te=0}else R=0,te=0,ne=U;if((ee&255)>>>0<A>>>0)for(T=hl(-1,-1,A|0,0)|0,U=nt;;){if(te>>>0>U>>>0|(te|0)==(U|0)&R>>>0>T>>>0){U=ne,T=72;break e}if(_e=Gn(R|0,te|0,A|0,0)|0,ge=nt,ee=ee&255,ge>>>0>4294967295|(ge|0)==-1&_e>>>0>~ee>>>0){U=ne,T=72;break e}if(R=Xi(ee|0,0,_e|0,ge|0)|0,te=nt,ne=s[x>>2]|0,ne>>>0<(s[F>>2]|0)>>>0?(s[x>>2]=ne+1,ne=a[ne>>0]|0):ne=Zi(u)|0,ee=n[ne+5321>>0]|0,(ee&255)>>>0>=A>>>0){U=ne,T=72;break}}else U=ne,T=72}while(!1);if((T|0)==72&&(a[U+5321>>0]|0)>>>0<A>>>0){do T=s[x>>2]|0,T>>>0<(s[F>>2]|0)>>>0?(s[x>>2]=T+1,T=a[T>>0]|0):T=Zi(u)|0;while((a[T+5321>>0]|0)>>>0<A>>>0);s[(Rt()|0)>>2]=34,te=V,R=E}if(s[F>>2]|0&&(s[x>>2]=(s[x>>2]|0)+-1),!(te>>>0<V>>>0|(te|0)==(V|0)&R>>>0<E>>>0)){if(!((E&1|0)!=0|!1|(K|0)!=0))return s[(Rt()|0)>>2]=34,ge=Xi(E|0,V|0,-1,-1)|0,_e=nt,nt=_e,m=M,ge|0;if(te>>>0>V>>>0|(te|0)==(V|0)&R>>>0>E>>>0)return s[(Rt()|0)>>2]=34,_e=V,ge=E,nt=_e,m=M,ge|0}return ge=((K|0)<0)<<31>>31,ge=un(R^K|0,te^ge|0,K|0,ge|0)|0,_e=nt,nt=_e,m=M,ge|0}function qh(u,A,T){u=u|0,A=A|0,T=T|0;var E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0,_e=0,ge=0,Oe=0,$e=0,Ye=0,it=0,Dt=0,ni=0,ei=0,at=0,Ht=0,Zt=0,kt=0,Xt=0,It=0,Nt=0,Ot=0;if(E=m,m=m+512|0,x=E,!A)A=24,M=-149;else if((A|0)==2)A=53,M=-1074;else if((A|0)==1)A=53,M=-1074;else return It=0,m=E,+It;R=u+4|0,U=u+100|0;do V=s[R>>2]|0,V>>>0<(s[U>>2]|0)>>>0?(s[R>>2]=V+1,Oe=a[V>>0]|0):Oe=Zi(u)|0;while(Zl(Oe)|0);do if((Oe|0)==43|(Oe|0)==45)if(V=1-(((Oe|0)==45&1)<<1)|0,K=s[R>>2]|0,K>>>0<(s[U>>2]|0)>>>0){s[R>>2]=K+1,Oe=a[K>>0]|0;break}else{Oe=Zi(u)|0;break}else V=1;while(!1);ee=0;do{if((Oe|32|0)!=(n[5600+ee>>0]|0))break;do if(ee>>>0<7)if(K=s[R>>2]|0,K>>>0<(s[U>>2]|0)>>>0){s[R>>2]=K+1,Oe=a[K>>0]|0;break}else{Oe=Zi(u)|0;break}while(!1);ee=ee+1|0}while(ee>>>0<8);do if((ee|0)==3)te=23;else if((ee|0)!=8){if(K=(T|0)!=0,ee>>>0>3&K){if((ee|0)==8)break;te=23;break}e:do if(!ee){ee=0;do{if((Oe|32|0)!=(n[5616+ee>>0]|0))break e;do if(ee>>>0<2)if(_e=s[R>>2]|0,_e>>>0<(s[U>>2]|0)>>>0){s[R>>2]=_e+1,Oe=a[_e>>0]|0;break}else{Oe=Zi(u)|0;break}while(!1);ee=ee+1|0}while(ee>>>0<3)}while(!1);if(ee)if((ee|0)==3){if(A=s[R>>2]|0,A>>>0<(s[U>>2]|0)>>>0?(s[R>>2]=A+1,A=a[A>>0]|0):A=Zi(u)|0,(A|0)==40)A=1;else return s[U>>2]|0?(s[R>>2]=(s[R>>2]|0)+-1,Ot=be,m=E,+Ot):(Ot=be,m=E,+Ot);for(;V=s[R>>2]|0,V>>>0<(s[U>>2]|0)>>>0?(s[R>>2]=V+1,V=a[V>>0]|0):V=Zi(u)|0,!(!((V+-48|0)>>>0<10|(V+-65|0)>>>0<26)&&!((V+-97|0)>>>0<26|(V|0)==95));)A=A+1|0;if((V|0)==41)return Ot=be,m=E,+Ot;if(V=(s[U>>2]|0)==0,V||(s[R>>2]=(s[R>>2]|0)+-1),!K)return s[(Rt()|0)>>2]=22,kn(u,0),Ot=0,m=E,+Ot;if((A|0)==0|V)return Ot=be,m=E,+Ot;do A=A+-1|0,s[R>>2]=(s[R>>2]|0)+-1;while(A|0);return ne=be,m=E,+ne}else return s[U>>2]|0&&(s[R>>2]=(s[R>>2]|0)+-1),s[(Rt()|0)>>2]=22,kn(u,0),Ot=0,m=E,+Ot;else{do if((Oe|0)==48){if(K=s[R>>2]|0,K>>>0<(s[U>>2]|0)>>>0?(s[R>>2]=K+1,K=a[K>>0]|0):K=Zi(u)|0,(K|32|0)!=120){if(!(s[U>>2]|0)){Oe=48;break}s[R>>2]=(s[R>>2]|0)+-1,Oe=48;break}for(x=s[R>>2]|0,x>>>0<(s[U>>2]|0)>>>0?(s[R>>2]=x+1,it=a[x>>0]|0,$e=0):(it=Zi(u)|0,$e=0);;){if((it|0)==46){te=70;break}else if((it|0)!=48){x=0,K=0,_e=0,ee=0,Oe=0,Ye=0,Zt=1,ge=0,ne=0;break}if(x=s[R>>2]|0,x>>>0<(s[U>>2]|0)>>>0){s[R>>2]=x+1,it=a[x>>0]|0,$e=1;continue}else{it=Zi(u)|0,$e=1;continue}}if((te|0)==70)if(x=s[R>>2]|0,x>>>0<(s[U>>2]|0)>>>0?(s[R>>2]=x+1,it=a[x>>0]|0):it=Zi(u)|0,(it|0)==48){_e=0,ee=0;do x=s[R>>2]|0,x>>>0<(s[U>>2]|0)>>>0?(s[R>>2]=x+1,it=a[x>>0]|0):it=Zi(u)|0,_e=Xi(_e|0,ee|0,-1,-1)|0,ee=nt;while((it|0)==48);x=0,K=0,$e=1,Oe=1,Ye=0,Zt=1,ge=0,ne=0}else x=0,K=0,_e=0,ee=0,Oe=1,Ye=0,Zt=1,ge=0,ne=0;e:for(;;){ni=it+-48|0;do if(ni>>>0>=10){if(Dt=it|32,ei=(it|0)==46,!((Dt+-97|0)>>>0<6|ei))break e;if(ei)if(Oe){it=46;break e}else{_e=K,ee=x,Oe=1;break}else{ni=(it|0)>57?Dt+-87|0:ni,te=83;break}}else te=83;while(!1);if((te|0)==83){te=0;do if((x|0)<0|(x|0)==0&K>>>0<8)Xt=Zt,ge=ni+(ge<<4)|0;else{if((x|0)<0|(x|0)==0&K>>>0<14){It=Zt*.0625,Xt=It,ne=ne+It*+(ni|0);break}(ni|0)==0|(Ye|0)!=0?Xt=Zt:(Ye=1,Xt=Zt,ne=ne+Zt*.5)}while(!1);K=Xi(K|0,x|0,1,0)|0,x=nt,$e=1,Zt=Xt}if(it=s[R>>2]|0,it>>>0<(s[U>>2]|0)>>>0){s[R>>2]=it+1,it=a[it>>0]|0;continue}else{it=Zi(u)|0;continue}}if(!$e)return A=(s[U>>2]|0)==0,A||(s[R>>2]=(s[R>>2]|0)+-1),T?!A&&(F=s[R>>2]|0,s[R>>2]=F+-1,(Oe|0)!=0)&&(s[R>>2]=F+-2):kn(u,0),It=+(V|0)*0,m=E,+It;if(te=(Oe|0)==0,F=te?K:_e,te=te?x:ee,(x|0)<0|(x|0)==0&K>>>0<8)do ge=ge<<4,K=Xi(K|0,x|0,1,0)|0,x=nt;while((x|0)<0|(x|0)==0&K>>>0<8);do if((it|32|0)==112){if(K=ha(u,T)|0,x=nt,(K|0)==0&(x|0)==-2147483648)if(T){if(!(s[U>>2]|0)){K=0,x=0;break}s[R>>2]=(s[R>>2]|0)+-1,K=0,x=0;break}else return kn(u,0),It=0,m=E,+It}else s[U>>2]|0?(s[R>>2]=(s[R>>2]|0)+-1,K=0,x=0):(K=0,x=0);while(!1);if(F=Hr(F|0,te|0,2)|0,F=Xi(F|0,nt|0,-32,-1)|0,x=Xi(F|0,nt|0,K|0,x|0)|0,F=nt,!ge)return It=+(V|0)*0,m=E,+It;if((F|0)>0|(F|0)==0&x>>>0>(0-M|0)>>>0)return s[(Rt()|0)>>2]=34,It=+(V|0)*17976931348623157e292*17976931348623157e292,m=E,+It;if(kt=M+-106|0,Ht=((kt|0)<0)<<31>>31,(F|0)<(Ht|0)|(F|0)==(Ht|0)&x>>>0<kt>>>0)return s[(Rt()|0)>>2]=34,It=+(V|0)*22250738585072014e-324*22250738585072014e-324,m=E,+It;if((ge|0)>-1)do ge=ge<<1,ne>=.5?(Zt=ne+-1,ge=ge|1):Zt=ne,ne=ne+Zt,x=Xi(x|0,F|0,-1,-1)|0,F=nt;while((ge|0)>-1);return M=un(32,0,M|0,((M|0)<0)<<31>>31|0)|0,M=Xi(x|0,F|0,M|0,nt|0)|0,kt=nt,0>(kt|0)|(kt|0)==0&A>>>0>M>>>0?(M|0)<0?(A=0,te=126):(A=M,te=124):te=124,(te|0)==124&&((A|0)<53?te=126:(M=A,Zt=+(V|0),Xt=0)),(te|0)==126&&(Xt=+(V|0),M=A,Zt=Xt,Xt=+os(+ +lo(1,84-A|0),+Xt)),kt=(M|0)<32&ne!=0&(ge&1|0)==0,ne=Zt*(kt?0:ne)+(Xt+Zt*+(((kt&1)+ge|0)>>>0))-Xt,ne==0&&(s[(Rt()|0)>>2]=34),It=+ll(ne,x),m=E,+It}while(!1);for(K=M+A|0,F=0-K|0,ni=0;;){if((Oe|0)==46){te=137;break}else if((Oe|0)!=48){at=0,ei=0,Dt=0;break}if(ee=s[R>>2]|0,ee>>>0<(s[U>>2]|0)>>>0){s[R>>2]=ee+1,Oe=a[ee>>0]|0,ni=1;continue}else{Oe=Zi(u)|0,ni=1;continue}}if((te|0)==137)if(te=s[R>>2]|0,te>>>0<(s[U>>2]|0)>>>0?(s[R>>2]=te+1,Oe=a[te>>0]|0):Oe=Zi(u)|0,(Oe|0)==48){at=0,ei=0;do at=Xi(at|0,ei|0,-1,-1)|0,ei=nt,te=s[R>>2]|0,te>>>0<(s[U>>2]|0)>>>0?(s[R>>2]=te+1,Oe=a[te>>0]|0):Oe=Zi(u)|0;while((Oe|0)==48);ni=1,Dt=1}else at=0,ei=0,Dt=1;s[x>>2]=0,it=Oe+-48|0,Ht=(Oe|0)==46;e:do if(it>>>0<10|Ht){te=x+496|0,Ye=0,$e=0,ge=0,_e=0,ee=0;t:for(;;){do if(Ht)if(!Dt)at=Ye,ei=$e,Dt=1;else break t;else{if(Ht=Xi(Ye|0,$e|0,1,0)|0,$e=nt,kt=(Oe|0)!=48,(_e|0)>=125){if(!kt){Ye=Ht;break}s[te>>2]=s[te>>2]|1,Ye=Ht;break}Ye=x+(_e<<2)|0,ge&&(it=Oe+-48+((s[Ye>>2]|0)*10|0)|0),s[Ye>>2]=it,ge=ge+1|0,it=(ge|0)==9,Ye=Ht,ni=1,ge=it?0:ge,_e=(it&1)+_e|0,ee=kt?Ht:ee}while(!1);if(Oe=s[R>>2]|0,Oe>>>0<(s[U>>2]|0)>>>0?(s[R>>2]=Oe+1,Oe=a[Oe>>0]|0):Oe=Zi(u)|0,it=Oe+-48|0,Ht=(Oe|0)==46,!(it>>>0<10|Ht)){te=160;break e}}it=(ni|0)!=0,te=168}else Ye=0,$e=0,ge=0,_e=0,ee=0,te=160;while(!1);do if((te|0)==160){if(it=(Dt|0)==0,at=it?Ye:at,ei=it?$e:ei,it=(ni|0)!=0,!(it&(Oe|32|0)==101))if((Oe|0)>-1){te=168;break}else{te=170;break}it=ha(u,T)|0,Oe=nt;do if((it|0)==0&(Oe|0)==-2147483648)if(T){if(!(s[U>>2]|0)){it=0,Oe=0;break}s[R>>2]=(s[R>>2]|0)+-1,it=0,Oe=0;break}else return kn(u,0),It=0,m=E,+It;while(!1);u=Xi(it|0,Oe|0,at|0,ei|0)|0,ei=nt}while(!1);if((te|0)==168&&(s[U>>2]|0?(s[R>>2]=(s[R>>2]|0)+-1,it?u=at:te=171):te=170),(te|0)==170&&(it?u=at:te=171),(te|0)==171)return s[(Rt()|0)>>2]=22,kn(u,0),It=0,m=E,+It;if(R=s[x>>2]|0,!R)return It=+(V|0)*0,m=E,+It;if((u|0)==(Ye|0)&(ei|0)==($e|0)&(($e|0)<0|($e|0)==0&Ye>>>0<10)&&A>>>0>30|(R>>>A|0)==0)return It=+(V|0)*+(R>>>0),m=E,+It;if(kt=(M|0)/-2|0,Ht=((kt|0)<0)<<31>>31,(ei|0)>(Ht|0)|(ei|0)==(Ht|0)&u>>>0>kt>>>0)return s[(Rt()|0)>>2]=34,It=+(V|0)*17976931348623157e292*17976931348623157e292,m=E,+It;if(kt=M+-106|0,Ht=((kt|0)<0)<<31>>31,(ei|0)<(Ht|0)|(ei|0)==(Ht|0)&u>>>0<kt>>>0)return s[(Rt()|0)>>2]=34,It=+(V|0)*22250738585072014e-324*22250738585072014e-324,m=E,+It;if(ge){if((ge|0)<9){R=x+(_e<<2)|0,U=s[R>>2]|0;do U=U*10|0,ge=ge+1|0;while((ge|0)!=9);s[R>>2]=U}_e=_e+1|0}if((ee|0)<9&&(ee|0)<=(u|0)&(u|0)<18){if((u|0)==9)return It=+(V|0)*+((s[x>>2]|0)>>>0),m=E,+It;if((u|0)<9)return It=+(V|0)*+((s[x>>2]|0)>>>0)/+(s[5632+(8-u<<2)>>2]|0),m=E,+It;if(kt=A+27+(Le(u,-3)|0)|0,R=s[x>>2]|0,(kt|0)>30|(R>>>kt|0)==0)return It=+(V|0)*+(R>>>0)*+(s[5632+(u+-10<<2)>>2]|0),m=E,+It}if(R=(u|0)%9|0,!R)R=0,U=0;else{if(T=(u|0)>-1?R:R+9|0,te=s[5632+(8-T<<2)>>2]|0,_e){ee=1e9/(te|0)|0,R=0,U=0,ge=0;do at=x+(ge<<2)|0,Ht=s[at>>2]|0,kt=((Ht>>>0)/(te>>>0)|0)+U|0,s[at>>2]=kt,U=Le((Ht>>>0)%(te>>>0)|0,ee)|0,Ht=ge,ge=ge+1|0,(Ht|0)==(R|0)&(kt|0)==0&&(R=ge&127,u=u+-9|0);while((ge|0)!=(_e|0));U&&(s[x+(_e<<2)>>2]=U,_e=_e+1|0)}else R=0,_e=0;U=0,u=9-T+u|0}e:for(;;){if(T=x+(R<<2)|0,(u|0)<18)do{for(ee=0,T=_e+127|0;T=T&127,te=x+(T<<2)|0,ge=Hr(s[te>>2]|0,0,29)|0,ge=Xi(ge|0,nt|0,ee|0,0)|0,ee=nt,ee>>>0>0|(ee|0)==0&ge>>>0>1e9?(kt=hl(ge|0,ee|0,1e9,0)|0,ge=za(ge|0,ee|0,1e9,0)|0,ee=kt):ee=0,s[te>>2]=ge,te=(T|0)==(R|0),(T|0)!=(_e+127&127|0)|te||(_e=ge|0?_e:T),!te;)T=T+-1|0;U=U+-29|0}while(!(ee|0));else{if((u|0)!=18)break;do{if((s[T>>2]|0)>>>0>=9007199){u=18;break e}for(ee=0,te=_e+127|0;te=te&127,ge=x+(te<<2)|0,Oe=Hr(s[ge>>2]|0,0,29)|0,Oe=Xi(Oe|0,nt|0,ee|0,0)|0,ee=nt,ee>>>0>0|(ee|0)==0&Oe>>>0>1e9?(kt=hl(Oe|0,ee|0,1e9,0)|0,Oe=za(Oe|0,ee|0,1e9,0)|0,ee=kt):ee=0,s[ge>>2]=Oe,ge=(te|0)==(R|0),(te|0)!=(_e+127&127|0)|ge||(_e=Oe|0?_e:te),!ge;)te=te+-1|0;U=U+-29|0}while(!(ee|0))}R=R+127&127,(R|0)==(_e|0)&&(kt=_e+127&127,_e=x+((_e+126&127)<<2)|0,s[_e>>2]=s[_e>>2]|s[x+(kt<<2)>>2],_e=kt),s[x+(R<<2)>>2]=ee,u=u+9|0}e:for(;;){for(T=_e+1&127,te=x+((_e+127&127)<<2)|0;;){for(ge=(u|0)==18,ee=(u|0)>27?9:1;;){for(Oe=0;;){if($e=Oe+R&127,($e|0)==(_e|0)){Oe=2;break}if(Ye=s[x+($e<<2)>>2]|0,it=s[5624+(Oe<<2)>>2]|0,Ye>>>0<it>>>0){Oe=2;break}if($e=Oe+1|0,Ye>>>0>it>>>0)break;if(($e|0)<2)Oe=$e;else{Oe=$e;break}}if((Oe|0)==2&ge)break e;if(U=ee+U|0,(R|0)==(_e|0))R=_e;else break}ge=(1<<ee)+-1|0,Oe=1e9>>>ee,$e=R,Ye=0;do at=x+(R<<2)|0,Ht=s[at>>2]|0,kt=(Ht>>>ee)+Ye|0,s[at>>2]=kt,Ye=Le(Ht&ge,Oe)|0,kt=(R|0)==($e|0)&(kt|0)==0,R=R+1&127,u=kt?u+-9|0:u,$e=kt?R:$e;while((R|0)!=(_e|0));if(!Ye){R=$e;continue}if((T|0)!=($e|0))break;s[te>>2]=s[te>>2]|1,R=$e}s[x+(_e<<2)>>2]=Ye,R=$e,_e=T}u=R&127,(u|0)==(_e|0)&&(s[x+(T+-1<<2)>>2]=0,_e=T),Zt=+((s[x+(u<<2)>>2]|0)>>>0),u=R+1&127,(u|0)==(_e|0)&&(_e=_e+1&127,s[x+(_e+-1<<2)>>2]=0),ne=+(V|0),Xt=ne*(Zt*1e9+ +((s[x+(u<<2)>>2]|0)>>>0)),V=U+53|0,M=V-M|0,(M|0)<(A|0)?(M|0)<0?(A=0,u=1,te=244):(A=M,u=1,te=243):(u=0,te=243),(te|0)==243&&((A|0)<53?te=244:(Zt=0,It=0)),(te|0)==244&&(Ot=+os(+ +lo(1,105-A|0),+Xt),Nt=+Ji(+Xt,+ +lo(1,53-A|0)),Zt=Ot,It=Nt,Xt=Ot+(Xt-Nt)),T=R+2&127;do if((T|0)!=(_e|0)){x=s[x+(T<<2)>>2]|0;do if(x>>>0>=5e8){if(x>>>0>5e8){It=ne*.75+It;break}if((R+3&127|0)==(_e|0)){It=ne*.5+It;break}else{It=ne*.75+It;break}}else{if(!(x|0)&&(R+3&127|0)==(_e|0))break;It=ne*.25+It}while(!1);if((53-A|0)<=1||+Ji(+It,1)!=0)break;It=It+1}while(!1);ne=Xt+It-Zt;do if((V&2147483647|0)>(-2-K|0)){if(+Pi(+ne)>=9007199254740992&&(u=(u|0)!=0&(A|0)==(M|0)?0:u,U=U+1|0,ne=ne*.5),(U+50|0)<=(F|0)&&!((u|0)!=0&It!=0))break;s[(Rt()|0)>>2]=34}while(!1);return Ot=+ll(ne,U),m=E,+Ot}}while(!1);if((te|0)==23&&(A=(s[U>>2]|0)==0,A||(s[R>>2]=(s[R>>2]|0)+-1),!(ee>>>0<4|(T|0)==0|A)))do s[R>>2]=(s[R>>2]|0)+-1,ee=ee+-1|0;while(ee>>>0>3);return Ot=+(V|0)*Ae,m=E,+Ot}function kn(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0;if(T=m,s[u+104>>2]=A,V=s[u+8>>2]|0,E=s[u+4>>2]|0,M=V-E|0,s[u+108>>2]=M,(A|0)!=0&(M|0)>(A|0)){s[u+100>>2]=E+A,m=T;return}else{s[u+100>>2]=V,m=T;return}}function Zi(u){u=u|0;var A=0,T=0,E=0,V=0,M=0,x=0,F=0;return T=m,M=u+104|0,F=s[M>>2]|0,F|0&&(s[u+108>>2]|0)>=(F|0)||(x=3),(x|0)==3&&(A=Ql(u)|0,(A|0)>=0)?(x=s[M>>2]|0,M=s[u+8>>2]|0,x|0&&(E=s[u+4>>2]|0,V=x-(s[u+108>>2]|0)+-1|0,(M-E|0)>(V|0))?s[u+100>>2]=E+V:s[u+100>>2]=M,E=s[u+4>>2]|0,M&&(F=u+108|0,s[F>>2]=M+1-E+(s[F>>2]|0)),u=E+-1|0,(a[u>>0]|0|0)==(A|0)?(F=A,m=T,F|0):(n[u>>0]=A,F=A,m=T,F|0)):(s[u+100>>2]=0,F=-1,m=T,F|0)}function lo(u,A){u=+u,A=A|0;var T=0,E=0;return T=m,(A|0)>1023?(u=u*898846567431158e293,E=A+-1023|0,(E|0)>1023?(A=A+-2046|0,A=(A|0)>1023?1023:A,u=u*898846567431158e293):A=E):(A|0)<-1022&&(u=u*22250738585072014e-324,E=A+1022|0,(E|0)<-1022?(A=A+2044|0,A=(A|0)<-1022?-1022:A,u=u*22250738585072014e-324):A=E),A=Hr(A+1023|0,0,52)|0,E=nt,s[D>>2]=A,s[D+4>>2]=E,u=u*+y[D>>3],m=T,+u}function ll(u,A){u=+u,A=A|0;var T=0;return T=m,u=+lo(u,A),m=T,+u}function Fa(u){u=u|0;var A=0,T=0,E=0;return T=m,E=u+74|0,A=n[E>>0]|0,n[E>>0]=A+255|A,E=u+20|0,A=u+44|0,(s[E>>2]|0)>>>0>(s[A>>2]|0)>>>0&&ya[s[u+36>>2]&1](u,0,0)|0,s[u+16>>2]=0,s[u+28>>2]=0,s[E>>2]=0,E=s[u>>2]|0,E&20?E&4?(s[u>>2]=E|32,E=-1,m=T,E|0):(E=-1,m=T,E|0):(E=s[A>>2]|0,s[u+8>>2]=E,s[u+4>>2]=E,E=0,m=T,E|0)}function Ql(u){u=u|0;var A=0,T=0;return A=m,m=m+16|0,T=A,!(s[u+8>>2]|0)&&Fa(u)|0?u=-1:(ya[s[u+32>>2]&1](u,T,1)|0)==1?u=a[T>>0]|0:u=-1,m=A,u|0}function Jl(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0;T=m,m=m+112|0,E=T,x=E+0|0,M=x+112|0;do s[x>>2]=0,x=x+4|0;while((x|0)<(M|0));return M=E+4|0,s[M>>2]=u,x=E+8|0,s[x>>2]=-1,s[E+44>>2]=u,s[E+76>>2]=-1,kn(E,0),V=+qh(E,1,1),E=(s[M>>2]|0)-(s[x>>2]|0)+(s[E+108>>2]|0)|0,A?(E&&(u=u+E|0),s[A>>2]=u,m=T,+V):(m=T,+V)}function qa(u,A,T){u=u|0,A=A|0,T=T|0;var E=0,V=0,M=0;return E=m,m=m+112|0,M=E,s[M>>2]=0,V=M+4|0,s[V>>2]=u,s[M+44>>2]=u,(u|0)<0?s[M+8>>2]=-1:s[M+8>>2]=u+2147483647,s[M+76>>2]=-1,kn(M,0),T=Fh(M,T,1,-2147483648,0)|0,A?(s[A>>2]=u+((s[V>>2]|0)+(s[M+108>>2]|0)-(s[M+8>>2]|0)),m=E,T|0):(m=E,T|0)}function eh(u,A){u=u|0,A=A|0;var T=0,E=0,V=0;if(T=m,V=n[u>>0]|0,E=n[A>>0]|0,!(V<<24>>24)||V<<24>>24!=E<<24>>24)A=V;else{do u=u+1|0,A=A+1|0,V=n[u>>0]|0,E=n[A>>0]|0;while(!(!(V<<24>>24)||V<<24>>24!=E<<24>>24));A=V}return m=T,(A&255)-(E&255)|0}function la(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0,_e=0,ge=0;if(T=m,V=u+4|0,E=s[V>>2]|0,R=E&-8,F=u+R|0,U=s[1210]|0,x=E&3,(x|0)!=1&u>>>0>=U>>>0&u>>>0<F>>>0||St(),M=u+(R|4)|0,ee=s[M>>2]|0,ee&1||St(),!x)return A>>>0<256?(ge=0,m=T,ge|0):R>>>0>=(A+4|0)>>>0&&(R-A|0)>>>0<=s[1326]<<1>>>0?(ge=u,m=T,ge|0):(ge=0,m=T,ge|0);if(R>>>0>=A>>>0)return x=R-A|0,x>>>0<=15?(ge=u,m=T,ge|0):(s[V>>2]=E&1|A|2,s[u+(A+4)>>2]=x|3,s[M>>2]=s[M>>2]|1,Kr(u+A|0,x),ge=u,m=T,ge|0);if((F|0)==(s[1212]|0))return M=(s[1209]|0)+R|0,M>>>0<=A>>>0?(ge=0,m=T,ge|0):(ge=M-A|0,s[V>>2]=E&1|A|2,s[u+(A+4)>>2]=ge|1,s[1212]=u+A,s[1209]=ge,ge=u,m=T,ge|0);if((F|0)==(s[1211]|0))return x=(s[1208]|0)+R|0,x>>>0<A>>>0?(ge=0,m=T,ge|0):(M=x-A|0,M>>>0>15?(s[V>>2]=E&1|A|2,s[u+(A+4)>>2]=M|1,s[u+x>>2]=M,E=u+(x+4)|0,s[E>>2]=s[E>>2]&-2,E=u+A|0):(s[V>>2]=E&1|x|2,E=u+(x+4)|0,s[E>>2]=s[E>>2]|1,E=0,M=0),s[1208]=M,s[1211]=E,ge=u,m=T,ge|0);if(ee&2||(M=(ee&-8)+R|0,M>>>0<A>>>0))return ge=0,m=T,ge|0;x=M-A|0,ne=ee>>>3;do if(ee>>>0>=256){te=s[u+(R+24)>>2]|0,ne=s[u+(R+12)>>2]|0;do if((ne|0)==(F|0)){if(ee=u+(R+20)|0,ne=s[ee>>2]|0,!ne&&(ee=u+(R+16)|0,ne=s[ee>>2]|0,!ne)){K=0;break}for(;;){if(ge=ne+20|0,_e=s[ge>>2]|0,_e){ne=_e,ee=ge;continue}if(_e=ne+16|0,ge=s[_e>>2]|0,ge)ne=ge,ee=_e;else break}if(ee>>>0<U>>>0)St();else{s[ee>>2]=0,K=ne;break}}else if(ee=s[u+(R+8)>>2]|0,ee>>>0<U>>>0&&St(),U=ee+12|0,(s[U>>2]|0)!=(F|0)&&St(),_e=ne+8|0,(s[_e>>2]|0)==(F|0)){s[U>>2]=ne,s[_e>>2]=ee,K=ne;break}else St();while(!1);if(te){if(U=s[u+(R+28)>>2]|0,ne=5128+(U<<2)|0,(F|0)==(s[ne>>2]|0)){if(s[ne>>2]=K,!K){s[1207]=s[1207]&~(1<<U);break}}else if(te>>>0<(s[1210]|0)>>>0&&St(),U=te+16|0,(s[U>>2]|0)==(F|0)?s[U>>2]=K:s[te+20>>2]=K,!K)break;F=s[1210]|0,K>>>0<F>>>0&&St(),s[K+24>>2]=te,U=s[u+(R+16)>>2]|0;do if(U)if(U>>>0<F>>>0)St();else{s[K+16>>2]=U,s[U+24>>2]=K;break}while(!1);if(F=s[u+(R+20)>>2]|0,F)if(F>>>0<(s[1210]|0)>>>0)St();else{s[K+20>>2]=F,s[F+24>>2]=K;break}}}else{if(K=s[u+(R+8)>>2]|0,R=s[u+(R+12)>>2]|0,ee=4864+(ne<<1<<2)|0,(K|0)!=(ee|0)&&(K>>>0<U>>>0&&St(),(s[K+12>>2]|0)!=(F|0)&&St()),(R|0)==(K|0)){s[1206]=s[1206]&~(1<<ne);break}(R|0)!=(ee|0)?(R>>>0<U>>>0&&St(),U=R+8|0,(s[U>>2]|0)==(F|0)?te=U:St()):te=R+8|0,s[K+12>>2]=R,s[te>>2]=K}while(!1);return x>>>0<16?(s[V>>2]=M|E&1|2,ge=u+(M|4)|0,s[ge>>2]=s[ge>>2]|1,ge=u,m=T,ge|0):(s[V>>2]=E&1|A|2,s[u+(A+4)>>2]=x|3,ge=u+(M|4)|0,s[ge>>2]=s[ge>>2]|1,Kr(u+A|0,x),ge=u,m=T,ge|0)}function Kr(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0,_e=0,ge=0,Oe=0,$e=0,Ye=0,it=0;T=m,x=u+A|0,R=s[u+4>>2]|0;do if(R&1)E=u,te=A;else{if(ee=s[u>>2]|0,!(R&3)){m=T;return}if(R=u+(0-ee)|0,U=ee+A|0,ge=s[1210]|0,R>>>0<ge>>>0&&St(),(R|0)==(s[1211]|0)){if(E=u+(A+4)|0,te=s[E>>2]|0,(te&3|0)!=3){E=R,te=U;break}s[1208]=U,s[E>>2]=te&-2,s[u+(4-ee)>>2]=U|1,s[x>>2]=U,m=T;return}if(Oe=ee>>>3,ee>>>0<256){if(E=s[u+(8-ee)>>2]|0,te=s[u+(12-ee)>>2]|0,ne=4864+(Oe<<1<<2)|0,(E|0)!=(ne|0)&&(E>>>0<ge>>>0&&St(),(s[E+12>>2]|0)!=(R|0)&&St()),(te|0)==(E|0)){s[1206]=s[1206]&~(1<<Oe),E=R,te=U;break}(te|0)!=(ne|0)?(te>>>0<ge>>>0&&St(),ne=te+8|0,(s[ne>>2]|0)==(R|0)?_e=ne:St()):_e=te+8|0,s[E+12>>2]=te,s[_e>>2]=E,E=R,te=U;break}_e=s[u+(24-ee)>>2]|0,Oe=s[u+(12-ee)>>2]|0;do if((Oe|0)==(R|0)){if(Ye=16-ee|0,$e=u+(Ye+4)|0,Oe=s[$e>>2]|0,!Oe&&($e=u+Ye|0,Oe=s[$e>>2]|0,!Oe)){ne=0;break}for(;;){if(it=Oe+20|0,Ye=s[it>>2]|0,Ye){Oe=Ye,$e=it;continue}if(Ye=Oe+16|0,it=s[Ye>>2]|0,it)Oe=it,$e=Ye;else break}if($e>>>0<ge>>>0)St();else{s[$e>>2]=0,ne=Oe;break}}else if($e=s[u+(8-ee)>>2]|0,$e>>>0<ge>>>0&&St(),ge=$e+12|0,(s[ge>>2]|0)!=(R|0)&&St(),Ye=Oe+8|0,(s[Ye>>2]|0)==(R|0)){s[ge>>2]=Oe,s[Ye>>2]=$e,ne=Oe;break}else St();while(!1);if(_e){if(Oe=s[u+(28-ee)>>2]|0,ge=5128+(Oe<<2)|0,(R|0)==(s[ge>>2]|0)){if(s[ge>>2]=ne,!ne){s[1207]=s[1207]&~(1<<Oe),E=R,te=U;break}}else if(_e>>>0<(s[1210]|0)>>>0&&St(),ge=_e+16|0,(s[ge>>2]|0)==(R|0)?s[ge>>2]=ne:s[_e+20>>2]=ne,!ne){E=R,te=U;break}ge=s[1210]|0,ne>>>0<ge>>>0&&St(),s[ne+24>>2]=_e,ee=16-ee|0,_e=s[u+ee>>2]|0;do if(_e)if(_e>>>0<ge>>>0)St();else{s[ne+16>>2]=_e,s[_e+24>>2]=ne;break}while(!1);if(ee=s[u+(ee+4)>>2]|0,ee)if(ee>>>0<(s[1210]|0)>>>0)St();else{s[ne+20>>2]=ee,s[ee+24>>2]=ne,E=R,te=U;break}else E=R,te=U}else E=R,te=U}while(!1);if(R=s[1210]|0,x>>>0<R>>>0&&St(),U=u+(A+4)|0,ne=s[U>>2]|0,ne&2)s[U>>2]=ne&-2,s[E+4>>2]=te|1,s[E+te>>2]=te;else{if((x|0)==(s[1212]|0)){if(it=(s[1209]|0)+te|0,s[1209]=it,s[1212]=E,s[E+4>>2]=it|1,(E|0)!=(s[1211]|0)){m=T;return}s[1211]=0,s[1208]=0,m=T;return}if((x|0)==(s[1211]|0)){it=(s[1208]|0)+te|0,s[1208]=it,s[1211]=E,s[E+4>>2]=it|1,s[E+it>>2]=it,m=T;return}te=(ne&-8)+te|0,U=ne>>>3;do if(ne>>>0>=256){K=s[u+(A+24)>>2]|0,ne=s[u+(A+12)>>2]|0;do if((ne|0)==(x|0)){if(ne=u+(A+20)|0,U=s[ne>>2]|0,!U&&(ne=u+(A+16)|0,U=s[ne>>2]|0,!U)){F=0;break}for(;;){if(ee=U+20|0,_e=s[ee>>2]|0,_e){U=_e,ne=ee;continue}if(_e=U+16|0,ee=s[_e>>2]|0,ee)U=ee,ne=_e;else break}if(ne>>>0<R>>>0)St();else{s[ne>>2]=0,F=U;break}}else if(U=s[u+(A+8)>>2]|0,U>>>0<R>>>0&&St(),ee=U+12|0,(s[ee>>2]|0)!=(x|0)&&St(),R=ne+8|0,(s[R>>2]|0)==(x|0)){s[ee>>2]=ne,s[R>>2]=U,F=ne;break}else St();while(!1);if(K){if(U=s[u+(A+28)>>2]|0,R=5128+(U<<2)|0,(x|0)==(s[R>>2]|0)){if(s[R>>2]=F,!F){s[1207]=s[1207]&~(1<<U);break}}else if(K>>>0<(s[1210]|0)>>>0&&St(),R=K+16|0,(s[R>>2]|0)==(x|0)?s[R>>2]=F:s[K+20>>2]=F,!F)break;x=s[1210]|0,F>>>0<x>>>0&&St(),s[F+24>>2]=K,K=s[u+(A+16)>>2]|0;do if(K)if(K>>>0<x>>>0)St();else{s[F+16>>2]=K,s[K+24>>2]=F;break}while(!1);if(x=s[u+(A+20)>>2]|0,x)if(x>>>0<(s[1210]|0)>>>0)St();else{s[F+20>>2]=x,s[x+24>>2]=F;break}}}else{if(F=s[u+(A+8)>>2]|0,u=s[u+(A+12)>>2]|0,A=4864+(U<<1<<2)|0,(F|0)!=(A|0)&&(F>>>0<R>>>0&&St(),(s[F+12>>2]|0)!=(x|0)&&St()),(u|0)==(F|0)){s[1206]=s[1206]&~(1<<U);break}(u|0)!=(A|0)?(u>>>0<R>>>0&&St(),A=u+8|0,(s[A>>2]|0)==(x|0)?K=A:St()):K=u+8|0,s[F+12>>2]=u,s[K>>2]=F}while(!1);if(s[E+4>>2]=te|1,s[E+te>>2]=te,(E|0)==(s[1211]|0)){s[1208]=te,m=T;return}}if(A=te>>>3,te>>>0<256){u=A<<1,x=4864+(u<<2)|0,F=s[1206]|0,A=1<<A,F&A?(u=4864+(u+2<<2)|0,F=s[u>>2]|0,F>>>0<(s[1210]|0)>>>0?St():(M=u,V=F)):(s[1206]=F|A,M=4864+(u+2<<2)|0,V=x),s[M>>2]=E,s[V+12>>2]=E,s[E+8>>2]=V,s[E+12>>2]=x,m=T;return}if(V=te>>>8,V?te>>>0>16777215?V=31:(Ye=(V+1048320|0)>>>16&8,it=V<<Ye,$e=(it+520192|0)>>>16&4,it=it<<$e,V=(it+245760|0)>>>16&2,V=14-($e|Ye|V)+(it<<V>>>15)|0,V=te>>>(V+7|0)&1|V<<1):V=0,M=5128+(V<<2)|0,s[E+28>>2]=V,s[E+20>>2]=0,s[E+16>>2]=0,u=s[1207]|0,x=1<<V,!(u&x)){s[1207]=u|x,s[M>>2]=E,s[E+24>>2]=M,s[E+12>>2]=E,s[E+8>>2]=E,m=T;return}M=s[M>>2]|0,(V|0)==31?V=0:V=25-(V>>>1)|0;e:do if((s[M+4>>2]&-8|0)!=(te|0)){for(V=te<<V,u=M;x=u+(V>>>31<<2)+16|0,M=s[x>>2]|0,!!M;){if((s[M+4>>2]&-8|0)==(te|0))break e;V=V<<1,u=M}x>>>0<(s[1210]|0)>>>0&&St(),s[x>>2]=E,s[E+24>>2]=u,s[E+12>>2]=E,s[E+8>>2]=E,m=T;return}while(!1);V=M+8|0,x=s[V>>2]|0,it=s[1210]|0,M>>>0>=it>>>0&x>>>0>=it>>>0||St(),s[x+12>>2]=E,s[V>>2]=E,s[E+8>>2]=x,s[E+12>>2]=M,s[E+24>>2]=0,m=T}function ha(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0,x=0,F=0;if(T=m,V=u+4|0,M=s[V>>2]|0,E=u+100|0,M>>>0<(s[E>>2]|0)>>>0?(s[V>>2]=M+1,x=a[M>>0]|0):x=Zi(u)|0,(x|0)==43|(x|0)==45?(F=s[V>>2]|0,M=(x|0)==45&1,F>>>0<(s[E>>2]|0)>>>0?(s[V>>2]=F+1,x=a[F>>0]|0):x=Zi(u)|0,(x+-48|0)>>>0>9&(A|0)!=0&&s[E>>2]|0&&(s[V>>2]=(s[V>>2]|0)+-1)):M=0,(x+-48|0)>>>0>9)return s[E>>2]|0?(s[V>>2]=(s[V>>2]|0)+-1,x=-2147483648,F=0,nt=x,m=T,F|0):(x=-2147483648,F=0,nt=x,m=T,F|0);A=0;do A=x+-48+(A*10|0)|0,x=s[V>>2]|0,x>>>0<(s[E>>2]|0)>>>0?(s[V>>2]=x+1,x=a[x>>0]|0):x=Zi(u)|0;while((x+-48|0)>>>0<10&(A|0)<214748364);if(F=((A|0)<0)<<31>>31,(x+-48|0)>>>0<10)do F=Gn(A|0,F|0,10,0)|0,A=nt,x=Xi(x|0,((x|0)<0)<<31>>31|0,-48,-1)|0,A=Xi(x|0,nt|0,F|0,A|0)|0,F=nt,x=s[V>>2]|0,x>>>0<(s[E>>2]|0)>>>0?(s[V>>2]=x+1,x=a[x>>0]|0):x=Zi(u)|0;while((x+-48|0)>>>0<10&((F|0)<21474836|(F|0)==21474836&A>>>0<2061584302));if((x+-48|0)>>>0<10)do x=s[V>>2]|0,x>>>0<(s[E>>2]|0)>>>0?(s[V>>2]=x+1,x=a[x>>0]|0):x=Zi(u)|0;while((x+-48|0)>>>0<10);return s[E>>2]|0&&(s[V>>2]=(s[V>>2]|0)+-1),V=(M|0)!=0,M=un(0,0,A|0,F|0)|0,x=V?nt:F,F=V?M:A,nt=x,m=T,F|0}function Hh(){}function un(u,A,T,E){return u=u|0,A=A|0,T=T|0,E=E|0,A=A-E-(T>>>0>u>>>0|0)>>>0,nt=A,u-T>>>0|0|0}function Ha(u,A,T){u=u|0,A=A|0,T=T|0;var E=0,V=0,M=0,x=0;if(E=u+T|0,(T|0)>=20){if(A=A&255,x=u&3,M=A|A<<8|A<<16|A<<24,V=E&-4,x)for(x=u+4-x|0;(u|0)<(x|0);)n[u>>0]=A,u=u+1|0;for(;(u|0)<(V|0);)s[u>>2]=M,u=u+4|0}for(;(u|0)<(E|0);)n[u>>0]=A,u=u+1|0;return u-T|0}function Hr(u,A,T){return u=u|0,A=A|0,T=T|0,(T|0)<32?(nt=A<<T|(u&(1<<T)-1<<32-T)>>>32-T,u<<T):(nt=u<<T-32,0)}function ca(u){u=u|0;var A=0;for(A=u;n[A>>0]|0;)A=A+1|0;return A-u|0}function Xi(u,A,T,E){return u=u|0,A=A|0,T=T|0,E=E|0,T=u+T>>>0,nt=A+E+(T>>>0<u>>>0|0)>>>0,T|0|0}function th(u,A,T){return u=u|0,A=A|0,T=T|0,(T|0)<32?(nt=A>>>T,u>>>T|(A&(1<<T)-1)<<32-T):(nt=0,A>>>T-32|0)}function ih(u,A,T){u=u|0,A=A|0,T=T|0;var E=0;if((T|0)>=4096)return Ge(u|0,A|0,T|0)|0;if(E=u|0,(u&3)==(A&3)){for(;u&3;){if(!T)return E|0;n[u>>0]=n[A>>0]|0,u=u+1|0,A=A+1|0,T=T-1|0}for(;(T|0)>=4;)s[u>>2]=s[A>>2],u=u+4|0,A=A+4|0,T=T-4|0}for(;(T|0)>0;)n[u>>0]=n[A>>0]|0,u=u+1|0,A=A+1|0,T=T-1|0;return E|0}function Nu(u,A,T){return u=u|0,A=A|0,T=T|0,(T|0)<32?(nt=A>>T,u>>>T|(A&(1<<T)-1)<<32-T):(nt=(A|0)<0?-1:0,A>>T-32|0)}function Do(u){u=u|0;var A=0;return A=n[N+(u>>>24)>>0]|0,(A|0)<8?A|0:(A=n[N+(u>>16&255)>>0]|0,(A|0)<8?A+8|0:(A=n[N+(u>>8&255)>>0]|0,(A|0)<8?A+16|0:(n[N+(u&255)>>0]|0)+24|0))}function Ys(u){u=u|0;var A=0;return A=n[w+(u&255)>>0]|0,(A|0)<8?A|0:(A=n[w+(u>>8&255)>>0]|0,(A|0)<8?A+8|0:(A=n[w+(u>>16&255)>>0]|0,(A|0)<8?A+16|0:(n[w+(u>>>24)>>0]|0)+24|0))}function cn(u,A){u=u|0,A=A|0;var T=0,E=0,V=0,M=0;return M=u&65535,E=A&65535,T=Le(E,M)|0,V=u>>>16,E=(T>>>16)+(Le(E,V)|0)|0,A=A>>>16,u=Le(A,M)|0,nt=(E>>>16)+(Le(A,V)|0)+(((E&65535)+u|0)>>>16)|0,E+u<<16|T&65535|0|0}function Bu(u,A,T,E){u=u|0,A=A|0,T=T|0,E=E|0;var V=0,M=0,x=0,F=0,K=0,R=0;return R=A>>31|((A|0)<0?-1:0)<<1,K=((A|0)<0?-1:0)>>31|((A|0)<0?-1:0)<<1,M=E>>31|((E|0)<0?-1:0)<<1,V=((E|0)<0?-1:0)>>31|((E|0)<0?-1:0)<<1,F=un(R^u,K^A,R,K)|0,x=nt,A=M^R,u=V^K,u=un((Xr(F,x,un(M^T,V^E,M,V)|0,nt,0)|0)^A,nt^u,A,u)|0,u|0}function Fu(u,A,T,E){u=u|0,A=A|0,T=T|0,E=E|0;var V=0,M=0,x=0,F=0,K=0,R=0;return V=m,m=m+8|0,F=V|0,x=A>>31|((A|0)<0?-1:0)<<1,M=((A|0)<0?-1:0)>>31|((A|0)<0?-1:0)<<1,R=E>>31|((E|0)<0?-1:0)<<1,K=((E|0)<0?-1:0)>>31|((E|0)<0?-1:0)<<1,A=un(x^u,M^A,x,M)|0,u=nt,Xr(A,u,un(R^T,K^E,R,K)|0,nt,F)|0,u=un(s[F>>2]^x,s[F+4>>2]^M,x,M)|0,A=nt,m=V,nt=A,u|0}function Gn(u,A,T,E){u=u|0,A=A|0,T=T|0,E=E|0;var V=0,M=0;return V=u,M=T,u=cn(V,M)|0,T=nt,nt=(Le(A,M)|0)+(Le(E,V)|0)+T|T&0,u|0|0|0}function hl(u,A,T,E){return u=u|0,A=A|0,T=T|0,E=E|0,u=Xr(u,A,T,E,0)|0,u|0}function za(u,A,T,E){u=u|0,A=A|0,T=T|0,E=E|0;var V=0,M=0;return M=m,m=m+8|0,V=M|0,Xr(u,A,T,E,V)|0,m=M,nt=s[V+4>>2]|0,s[V>>2]|0|0}function Xr(u,A,T,E,V){u=u|0,A=A|0,T=T|0,E=E|0,V=V|0;var M=0,x=0,F=0,K=0,R=0,U=0,te=0,ne=0,ee=0,_e=0;if(x=u,K=A,F=K,U=T,M=E,R=M,!F)return M=(V|0)!=0,R?M?(s[V>>2]=u|0,s[V+4>>2]=A&0,U=0,te=0,nt=U,te|0):(U=0,te=0,nt=U,te|0):(M&&(s[V>>2]=(x>>>0)%(U>>>0),s[V+4>>2]=0),R=0,te=(x>>>0)/(U>>>0)>>>0,nt=R,te|0);te=(R|0)==0;do if(U){if(!te){if(R=(Do(R|0)|0)-(Do(F|0)|0)|0,R>>>0<=31){te=R+1|0,U=31-R|0,u=R-31>>31,K=te,A=x>>>(te>>>0)&u|F<<U,u=F>>>(te>>>0)&u,R=0,U=x<<U;break}return V?(s[V>>2]=u|0,s[V+4>>2]=K|A&0,U=0,te=0,nt=U,te|0):(U=0,te=0,nt=U,te|0)}if(R=U-1|0,R&U){U=(Do(U|0)|0)+33-(Do(F|0)|0)|0,_e=64-U|0,te=32-U|0,ne=te>>31,ee=U-32|0,u=ee>>31,K=U,A=te-1>>31&F>>>(ee>>>0)|(F<<te|x>>>(U>>>0))&u,u=u&F>>>(U>>>0),R=x<<_e&ne,U=(F<<_e|x>>>(ee>>>0))&ne|x<<te&U-33>>31;break}return V&&(s[V>>2]=R&x,s[V+4>>2]=0),(U|0)==1?(ee=K|A&0,_e=u|0|0,nt=ee,_e|0):(_e=Ys(U|0)|0,ee=F>>>(_e>>>0)|0,_e=F<<32-_e|x>>>(_e>>>0)|0,nt=ee,_e|0)}else{if(te)return V&&(s[V>>2]=(F>>>0)%(U>>>0),s[V+4>>2]=0),ee=0,_e=(F>>>0)/(U>>>0)>>>0,nt=ee,_e|0;if(!x)return V&&(s[V>>2]=0,s[V+4>>2]=(F>>>0)%(R>>>0)),ee=0,_e=(F>>>0)/(R>>>0)>>>0,nt=ee,_e|0;if(U=R-1|0,!(U&R))return V&&(s[V>>2]=u|0,s[V+4>>2]=U&F|A&0),ee=0,_e=F>>>((Ys(R|0)|0)>>>0),nt=ee,_e|0;if(R=(Do(R|0)|0)-(Do(F|0)|0)|0,R>>>0<=30){u=R+1|0,U=31-R|0,K=u,A=F<<U|x>>>(u>>>0),u=F>>>(u>>>0),R=0,U=x<<U;break}return V?(s[V>>2]=u|0,s[V+4>>2]=K|A&0,ee=0,_e=0,nt=ee,_e|0):(ee=0,_e=0,nt=ee,_e|0)}while(!1);if(!K)M=U,E=0,F=0;else{x=T|0|0,M=M|E&0,E=Xi(x,M,-1,-1)|0,T=nt,F=0;do te=U,U=R>>>31|U<<1,R=F|R<<1,te=A<<1|te>>>31|0,ne=A>>>31|u<<1|0,un(E,T,te,ne)|0,_e=nt,ee=_e>>31|((_e|0)<0?-1:0)<<1,F=ee&1,A=un(te,ne,ee&x,(((_e|0)<0?-1:0)>>31|((_e|0)<0?-1:0)<<1)&M)|0,u=nt,K=K-1|0;while(K|0);M=U,E=0}return x=0,V&&(s[V>>2]=A,s[V+4>>2]=u),ee=(R|0)>>>31|(M|x)<<1|(x<<1|R>>>31)&0|E,_e=(R<<1|0)&-2|F,nt=ee,_e|0}function ul(u,A,T,E){return u=u|0,A=A|0,T=T|0,E=E|0,ya[u&1](A|0,T|0,E|0)|0}function xo(u,A,T,E,V,M){u=u|0,A=A|0,T=T|0,E=E|0,V=V|0,M=M|0,cl[u&3](A|0,T|0,E|0,V|0,M|0)}function da(u,A){u=u|0,A=A|0,ho[u&31](A|0)}function pa(u,A,T){u=u|0,A=A|0,T=T|0,uo[u&3](A|0,T|0)}function $a(u,A){return u=u|0,A=A|0,rh[u&1](A|0)|0}function fa(u){u=u|0,dl[u&3]()}function zh(u,A,T,E,V,M,x){u=u|0,A=A|0,T=T|0,E=E|0,V=V|0,M=M|0,x=x|0,Ua[u&3](A|0,T|0,E|0,V|0,M|0,x|0)}function $h(u,A,T){return u=u|0,A=A|0,T=T|0,Wh[u&3](A|0,T|0)|0}function Uh(u,A,T,E,V){u=u|0,A=A|0,T=T|0,E=E|0,V=V|0,pl[u&3](A|0,T|0,E|0,V|0)}function Gh(u,A,T){return u=u|0,A=A|0,T=T|0,De(0),0}function sh(u,A,T,E,V){u=u|0,A=A|0,T=T|0,E=E|0,V=V|0,De(1)}function bn(u){u=u|0,De(2)}function ga(u,A){u=u|0,A=A|0,De(3)}function nh(u){return u=u|0,De(4),0}function Ne(){De(5)}function Io(){Vs()}function ma(u,A,T,E,V,M){u=u|0,A=A|0,T=T|0,E=E|0,V=V|0,M=M|0,De(6)}function Wn(u,A){return u=u|0,A=A|0,De(7),0}function ns(u,A,T,E){u=u|0,A=A|0,T=T|0,E=E|0,De(8)}var ya=[Gh,Lt],cl=[sh,Nh,al,sh],ho=[bn,yn,Da,xa,Ia,ro,Ao,mt,jt,Sr,an,Ma,Vt,ft,Bi,ot,Ii,us,Ct,bo,Ms,bn,bn,bn,bn,bn,bn,bn,bn,bn,bn,bn],uo=[ga,sl,Ko,Ri],rh=[nh,Pt],dl=[Ne,Io,Na,Ba],Ua=[ma,Ra,Un,ma],Wh=[Wn,Yo,So,hi],pl=[ns,wi,Ei,ns];return{_yo:_n,_strlen:ca,_retireVar:Co,_bitshift64Lshr:th,_unyo:ea,_solve:Lo,_bitshift64Shl:Hr,_getSolution:To,___cxa_is_pointer_type:oa,_memset:Ha,_getNumVars:ia,_memcpy:ih,_getConflictClauseSize:Pr,_addClause:ta,_i64Subtract:un,_createTheSolver:Mn,_realloc:ps,_i64Add:Xi,_solveAssuming:sa,___cxa_can_catch:Bh,_ensureVar:Po,_getConflictClause:na,_free:di,_malloc:aa,__GLOBAL__I_a:Kt,__GLOBAL__I_a127:Er,runPostSets:Hh,stackAlloc:gn,stackSave:Us,stackRestore:qn,setThrew:mr,setTempRet0:sn,getTempRet0:mn,dynCall_iiii:ul,dynCall_viiiii:xo,dynCall_vi:da,dynCall_vii:pa,dynCall_ii:$a,dynCall_v:fa,dynCall_viiiiii:zh,dynCall_iii:$h,dynCall_viiii:Uh}}(Module.asmGlobalArg,Module.asmLibraryArg,buffer);Module._yo=asm._yo;var _strlen=Module._strlen=asm._strlen;Module._retireVar=asm._retireVar;var _bitshift64Lshr=Module._bitshift64Lshr=asm._bitshift64Lshr;Module._unyo=asm._unyo,Module._solve=asm._solve;var _bitshift64Shl=Module._bitshift64Shl=asm._bitshift64Shl;Module._getSolution=asm._getSolution,Module.___cxa_is_pointer_type=asm.___cxa_is_pointer_type;var _memset=Module._memset=asm._memset;Module._getNumVars=asm._getNumVars;var _memcpy=Module._memcpy=asm._memcpy;Module._getConflictClauseSize=asm._getConflictClauseSize,Module._addClause=asm._addClause;var _i64Subtract=Module._i64Subtract=asm._i64Subtract;Module._createTheSolver=asm._createTheSolver,Module._realloc=asm._realloc;var _i64Add=Module._i64Add=asm._i64Add;Module._solveAssuming=asm._solveAssuming,Module.___cxa_can_catch=asm.___cxa_can_catch,Module._ensureVar=asm._ensureVar,Module._getConflictClause=asm._getConflictClause;var _free=Module._free=asm._free,_malloc=Module._malloc=asm._malloc,__GLOBAL__I_a=Module.__GLOBAL__I_a=asm.__GLOBAL__I_a,__GLOBAL__I_a127=Module.__GLOBAL__I_a127=asm.__GLOBAL__I_a127;Module.runPostSets=asm.runPostSets,Module.dynCall_iiii=asm.dynCall_iiii,Module.dynCall_viiiii=asm.dynCall_viiiii,Module.dynCall_vi=asm.dynCall_vi,Module.dynCall_vii=asm.dynCall_vii,Module.dynCall_ii=asm.dynCall_ii,Module.dynCall_v=asm.dynCall_v,Module.dynCall_viiiiii=asm.dynCall_viiiiii,Module.dynCall_iii=asm.dynCall_iii,Module.dynCall_viiii=asm.dynCall_viiii,Runtime.stackAlloc=asm.stackAlloc,Runtime.stackSave=asm.stackSave,Runtime.stackRestore=asm.stackRestore,Runtime.setTempRet0=asm.setTempRet0,Runtime.getTempRet0=asm.getTempRet0;var i64Math=function(){var o={math:{}};o.math.Long=function(Pe,Le){this.low_=Pe|0,this.high_=Le|0},o.math.Long.IntCache_={},o.math.Long.fromInt=function(Pe){if(-128<=Pe&&Pe<128){var Le=o.math.Long.IntCache_[Pe];if(Le)return Le}var De=new o.math.Long(Pe|0,Pe<0?-1:0);return-128<=Pe&&Pe<128&&(o.math.Long.IntCache_[Pe]=De),De},o.math.Long.fromNumber=function(Pe){return isNaN(Pe)||!isFinite(Pe)?o.math.Long.ZERO:Pe<=-o.math.Long.TWO_PWR_63_DBL_?o.math.Long.MIN_VALUE:Pe+1>=o.math.Long.TWO_PWR_63_DBL_?o.math.Long.MAX_VALUE:Pe<0?o.math.Long.fromNumber(-Pe).negate():new o.math.Long(Pe%o.math.Long.TWO_PWR_32_DBL_|0,Pe/o.math.Long.TWO_PWR_32_DBL_|0)},o.math.Long.fromBits=function(Pe,Le){return new o.math.Long(Pe,Le)},o.math.Long.fromString=function(Pe,Le){if(Pe.length==0)throw Error("number format error: empty string");var De=Le||10;if(De<2||36<De)throw Error("radix out of range: "+De);if(Pe.charAt(0)=="-")return o.math.Long.fromString(Pe.substring(1),De).negate();if(Pe.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+Pe);for(var ct=o.math.Long.fromNumber(Math.pow(De,8)),h=o.math.Long.ZERO,f=0;f<Pe.length;f+=8){var b=Math.min(8,Pe.length-f),L=parseInt(Pe.substring(f,f+b),De);if(b<8){var I=o.math.Long.fromNumber(Math.pow(De,b));h=h.multiply(I).add(o.math.Long.fromNumber(L))}else h=h.multiply(ct),h=h.add(o.math.Long.fromNumber(L))}return h},o.math.Long.TWO_PWR_16_DBL_=65536,o.math.Long.TWO_PWR_24_DBL_=1<<24,o.math.Long.TWO_PWR_32_DBL_=o.math.Long.TWO_PWR_16_DBL_*o.math.Long.TWO_PWR_16_DBL_,o.math.Long.TWO_PWR_31_DBL_=o.math.Long.TWO_PWR_32_DBL_/2,o.math.Long.TWO_PWR_48_DBL_=o.math.Long.TWO_PWR_32_DBL_*o.math.Long.TWO_PWR_16_DBL_,o.math.Long.TWO_PWR_64_DBL_=o.math.Long.TWO_PWR_32_DBL_*o.math.Long.TWO_PWR_32_DBL_,o.math.Long.TWO_PWR_63_DBL_=o.math.Long.TWO_PWR_64_DBL_/2,o.math.Long.ZERO=o.math.Long.fromInt(0),o.math.Long.ONE=o.math.Long.fromInt(1),o.math.Long.NEG_ONE=o.math.Long.fromInt(-1),o.math.Long.MAX_VALUE=o.math.Long.fromBits(-1,2147483647),o.math.Long.MIN_VALUE=o.math.Long.fromBits(0,-2147483648),o.math.Long.TWO_PWR_24_=o.math.Long.fromInt(1<<24),o.math.Long.prototype.toInt=function(){return this.low_},o.math.Long.prototype.toNumber=function(){return this.high_*o.math.Long.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},o.math.Long.prototype.toString=function(Pe){var Le=Pe||10;if(Le<2||36<Le)throw Error("radix out of range: "+Le);if(this.isZero())return"0";if(this.isNegative())if(this.equals(o.math.Long.MIN_VALUE)){var De=o.math.Long.fromNumber(Le),ct=this.div(De),f=ct.multiply(De).subtract(this);return ct.toString(Le)+f.toInt().toString(Le)}else return"-"+this.negate().toString(Le);for(var h=o.math.Long.fromNumber(Math.pow(Le,6)),f=this,b="";;){var L=f.div(h),I=f.subtract(L.multiply(h)).toInt(),B=I.toString(Le);if(f=L,f.isZero())return B+b;for(;B.length<6;)B="0"+B;b=""+B+b}},o.math.Long.prototype.getHighBits=function(){return this.high_},o.math.Long.prototype.getLowBits=function(){return this.low_},o.math.Long.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:o.math.Long.TWO_PWR_32_DBL_+this.low_},o.math.Long.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(o.math.Long.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var Pe=this.high_!=0?this.high_:this.low_,Le=31;Le>0&&!(Pe&1<<Le);Le--);return this.high_!=0?Le+33:Le+1},o.math.Long.prototype.isZero=function(){return this.high_==0&&this.low_==0},o.math.Long.prototype.isNegative=function(){return this.high_<0},o.math.Long.prototype.isOdd=function(){return(this.low_&1)==1},o.math.Long.prototype.equals=function(Pe){return this.high_==Pe.high_&&this.low_==Pe.low_},o.math.Long.prototype.notEquals=function(Pe){return this.high_!=Pe.high_||this.low_!=Pe.low_},o.math.Long.prototype.lessThan=function(Pe){return this.compare(Pe)<0},o.math.Long.prototype.lessThanOrEqual=function(Pe){return this.compare(Pe)<=0},o.math.Long.prototype.greaterThan=function(Pe){return this.compare(Pe)>0},o.math.Long.prototype.greaterThanOrEqual=function(Pe){return this.compare(Pe)>=0},o.math.Long.prototype.compare=function(Pe){if(this.equals(Pe))return 0;var Le=this.isNegative(),De=Pe.isNegative();return Le&&!De?-1:!Le&&De?1:this.subtract(Pe).isNegative()?-1:1},o.math.Long.prototype.negate=function(){return this.equals(o.math.Long.MIN_VALUE)?o.math.Long.MIN_VALUE:this.not().add(o.math.Long.ONE)},o.math.Long.prototype.add=function(Pe){var Le=this.high_>>>16,De=this.high_&65535,ct=this.low_>>>16,h=this.low_&65535,f=Pe.high_>>>16,b=Pe.high_&65535,L=Pe.low_>>>16,I=Pe.low_&65535,B=0,j=0,Y=0,Z=0;return Z+=h+I,Y+=Z>>>16,Z&=65535,Y+=ct+L,j+=Y>>>16,Y&=65535,j+=De+b,B+=j>>>16,j&=65535,B+=Le+f,B&=65535,o.math.Long.fromBits(Y<<16|Z,B<<16|j)},o.math.Long.prototype.subtract=function(Pe){return this.add(Pe.negate())},o.math.Long.prototype.multiply=function(Pe){if(this.isZero())return o.math.Long.ZERO;if(Pe.isZero())return o.math.Long.ZERO;if(this.equals(o.math.Long.MIN_VALUE))return Pe.isOdd()?o.math.Long.MIN_VALUE:o.math.Long.ZERO;if(Pe.equals(o.math.Long.MIN_VALUE))return this.isOdd()?o.math.Long.MIN_VALUE:o.math.Long.ZERO;if(this.isNegative())return Pe.isNegative()?this.negate().multiply(Pe.negate()):this.negate().multiply(Pe).negate();if(Pe.isNegative())return this.multiply(Pe.negate()).negate();if(this.lessThan(o.math.Long.TWO_PWR_24_)&&Pe.lessThan(o.math.Long.TWO_PWR_24_))return o.math.Long.fromNumber(this.toNumber()*Pe.toNumber());var Le=this.high_>>>16,De=this.high_&65535,ct=this.low_>>>16,h=this.low_&65535,f=Pe.high_>>>16,b=Pe.high_&65535,L=Pe.low_>>>16,I=Pe.low_&65535,B=0,j=0,Y=0,Z=0;return Z+=h*I,Y+=Z>>>16,Z&=65535,Y+=ct*I,j+=Y>>>16,Y&=65535,Y+=h*L,j+=Y>>>16,Y&=65535,j+=De*I,B+=j>>>16,j&=65535,j+=ct*L,B+=j>>>16,j&=65535,j+=h*b,B+=j>>>16,j&=65535,B+=Le*I+De*L+ct*b+h*f,B&=65535,o.math.Long.fromBits(Y<<16|Z,B<<16|j)},o.math.Long.prototype.div=function(Pe){if(Pe.isZero())throw Error("division by zero");if(this.isZero())return o.math.Long.ZERO;if(this.equals(o.math.Long.MIN_VALUE)){if(Pe.equals(o.math.Long.ONE)||Pe.equals(o.math.Long.NEG_ONE))return o.math.Long.MIN_VALUE;if(Pe.equals(o.math.Long.MIN_VALUE))return o.math.Long.ONE;var Le=this.shiftRight(1),De=Le.div(Pe).shiftLeft(1);if(De.equals(o.math.Long.ZERO))return Pe.isNegative()?o.math.Long.ONE:o.math.Long.NEG_ONE;var f=this.subtract(Pe.multiply(De)),ct=De.add(f.div(Pe));return ct}else if(Pe.equals(o.math.Long.MIN_VALUE))return o.math.Long.ZERO;if(this.isNegative())return Pe.isNegative()?this.negate().div(Pe.negate()):this.negate().div(Pe).negate();if(Pe.isNegative())return this.div(Pe.negate()).negate();for(var h=o.math.Long.ZERO,f=this;f.greaterThanOrEqual(Pe);){for(var De=Math.max(1,Math.floor(f.toNumber()/Pe.toNumber())),b=Math.ceil(Math.log(De)/Math.LN2),L=b<=48?1:Math.pow(2,b-48),I=o.math.Long.fromNumber(De),B=I.multiply(Pe);B.isNegative()||B.greaterThan(f);)De-=L,I=o.math.Long.fromNumber(De),B=I.multiply(Pe);I.isZero()&&(I=o.math.Long.ONE),h=h.add(I),f=f.subtract(B)}return h},o.math.Long.prototype.modulo=function(Pe){return this.subtract(this.div(Pe).multiply(Pe))},o.math.Long.prototype.not=function(){return o.math.Long.fromBits(~this.low_,~this.high_)},o.math.Long.prototype.and=function(Pe){return o.math.Long.fromBits(this.low_&Pe.low_,this.high_&Pe.high_)},o.math.Long.prototype.or=function(Pe){return o.math.Long.fromBits(this.low_|Pe.low_,this.high_|Pe.high_)},o.math.Long.prototype.xor=function(Pe){return o.math.Long.fromBits(this.low_^Pe.low_,this.high_^Pe.high_)},o.math.Long.prototype.shiftLeft=function(Pe){if(Pe&=63,Pe==0)return this;var Le=this.low_;if(Pe<32){var De=this.high_;return o.math.Long.fromBits(Le<<Pe,De<<Pe|Le>>>32-Pe)}else return o.math.Long.fromBits(0,Le<<Pe-32)},o.math.Long.prototype.shiftRight=function(Pe){if(Pe&=63,Pe==0)return this;var Le=this.high_;if(Pe<32){var De=this.low_;return o.math.Long.fromBits(De>>>Pe|Le<<32-Pe,Le>>Pe)}else return o.math.Long.fromBits(Le>>Pe-32,Le>=0?0:-1)},o.math.Long.prototype.shiftRightUnsigned=function(Pe){if(Pe&=63,Pe==0)return this;var Le=this.high_;if(Pe<32){var De=this.low_;return o.math.Long.fromBits(De>>>Pe|Le<<32-Pe,Le>>>Pe)}else return Pe==32?o.math.Long.fromBits(Le,0):o.math.Long.fromBits(Le>>>Pe-32,0)};var e;function t(Pe,Le,De){Pe!=null&&(typeof Pe=="number"?this.fromNumber(Pe,Le,De):Le==null&&typeof Pe!="string"?this.fromString(Pe,256):this.fromString(Pe,Le))}function n(){return new t(null)}function r(Pe,Le,De,ct,h,f){for(;--f>=0;){var b=Le*this[Pe++]+De[ct]+h;h=Math.floor(b/67108864),De[ct++]=b&67108863}return h}t.prototype.am=r,e=26,t.prototype.DB=e,t.prototype.DM=(1<<e)-1,t.prototype.DV=1<<e;var s=52;t.prototype.FV=Math.pow(2,s),t.prototype.F1=s-e,t.prototype.F2=2*e-s;var a="0123456789abcdefghijklmnopqrstuvwxyz",l=new Array,d,c;for(d=48,c=0;c<=9;++c)l[d++]=c;for(d=97,c=10;c<36;++c)l[d++]=c;for(d=65,c=10;c<36;++c)l[d++]=c;function y(Pe){return a.charAt(Pe)}function m(Pe,Le){var De=l[Pe.charCodeAt(Le)];return De??-1}function O(Pe){for(var Le=this.t-1;Le>=0;--Le)Pe[Le]=this[Le];Pe.t=this.t,Pe.s=this.s}function D(Pe){this.t=1,this.s=Pe<0?-1:0,Pe>0?this[0]=Pe:Pe<-1?this[0]=Pe+DV:this.t=0}function z(Pe){var Le=n();return Le.fromInt(Pe),Le}function w(Pe,Le){var De;if(Le==16)De=4;else if(Le==8)De=3;else if(Le==256)De=8;else if(Le==2)De=1;else if(Le==32)De=5;else if(Le==4)De=2;else{this.fromRadix(Pe,Le);return}this.t=0,this.s=0;for(var ct=Pe.length,h=!1,f=0;--ct>=0;){var b=De==8?Pe[ct]&255:m(Pe,ct);if(b<0){Pe.charAt(ct)=="-"&&(h=!0);continue}h=!1,f==0?this[this.t++]=b:f+De>this.DB?(this[this.t-1]|=(b&(1<<this.DB-f)-1)<<f,this[this.t++]=b>>this.DB-f):this[this.t-1]|=b<<f,f+=De,f>=this.DB&&(f-=this.DB)}De==8&&Pe[0]&128&&(this.s=-1,f>0&&(this[this.t-1]|=(1<<this.DB-f)-1<<f)),this.clamp(),h&&t.ZERO.subTo(this,this)}function N(){for(var Pe=this.s&this.DM;this.t>0&&this[this.t-1]==Pe;)--this.t}function H(Pe){if(this.s<0)return"-"+this.negate().toString(Pe);var Le;if(Pe==16)Le=4;else if(Pe==8)Le=3;else if(Pe==2)Le=1;else if(Pe==32)Le=5;else if(Pe==4)Le=2;else return this.toRadix(Pe);var De=(1<<Le)-1,ct,h=!1,f="",b=this.t,L=this.DB-b*this.DB%Le;if(b-- >0)for(L<this.DB&&(ct=this[b]>>L)>0&&(h=!0,f=y(ct));b>=0;)L<Le?(ct=(this[b]&(1<<L)-1)<<Le-L,ct|=this[--b]>>(L+=this.DB-Le)):(ct=this[b]>>(L-=Le)&De,L<=0&&(L+=this.DB,--b)),ct>0&&(h=!0),h&&(f+=y(ct));return h?f:"0"}function X(){var Pe=n();return t.ZERO.subTo(this,Pe),Pe}function ae(){return this.s<0?this.negate():this}function oe(Pe){var Le=this.s-Pe.s;if(Le!=0)return Le;var De=this.t;if(Le=De-Pe.t,Le!=0)return this.s<0?-Le:Le;for(;--De>=0;)if((Le=this[De]-Pe[De])!=0)return Le;return 0}function ue(Pe){var Le=1,De;return(De=Pe>>>16)!=0&&(Pe=De,Le+=16),(De=Pe>>8)!=0&&(Pe=De,Le+=8),(De=Pe>>4)!=0&&(Pe=De,Le+=4),(De=Pe>>2)!=0&&(Pe=De,Le+=2),(De=Pe>>1)!=0&&(Pe=De,Le+=1),Le}function fe(){return this.t<=0?0:this.DB*(this.t-1)+ue(this[this.t-1]^this.s&this.DM)}function be(Pe,Le){var De;for(De=this.t-1;De>=0;--De)Le[De+Pe]=this[De];for(De=Pe-1;De>=0;--De)Le[De]=0;Le.t=this.t+Pe,Le.s=this.s}function Ae(Pe,Le){for(var De=Pe;De<this.t;++De)Le[De-Pe]=this[De];Le.t=Math.max(this.t-Pe,0),Le.s=this.s}function W(Pe,Le){var De=Pe%this.DB,ct=this.DB-De,h=(1<<ct)-1,f=Math.floor(Pe/this.DB),b=this.s<<De&this.DM,L;for(L=this.t-1;L>=0;--L)Le[L+f+1]=this[L]>>ct|b,b=(this[L]&h)<<De;for(L=f-1;L>=0;--L)Le[L]=0;Le[f]=b,Le.t=this.t+f+1,Le.s=this.s,Le.clamp()}function J(Pe,Le){Le.s=this.s;var De=Math.floor(Pe/this.DB);if(De>=this.t){Le.t=0;return}var ct=Pe%this.DB,h=this.DB-ct,f=(1<<ct)-1;Le[0]=this[De]>>ct;for(var b=De+1;b<this.t;++b)Le[b-De-1]|=(this[b]&f)<<h,Le[b-De]=this[b]>>ct;ct>0&&(Le[this.t-De-1]|=(this.s&f)<<h),Le.t=this.t-De,Le.clamp()}function Ue(Pe,Le){for(var De=0,ct=0,h=Math.min(Pe.t,this.t);De<h;)ct+=this[De]-Pe[De],Le[De++]=ct&this.DM,ct>>=this.DB;if(Pe.t<this.t){for(ct-=Pe.s;De<this.t;)ct+=this[De],Le[De++]=ct&this.DM,ct>>=this.DB;ct+=this.s}else{for(ct+=this.s;De<Pe.t;)ct-=Pe[De],Le[De++]=ct&this.DM,ct>>=this.DB;ct-=Pe.s}Le.s=ct<0?-1:0,ct<-1?Le[De++]=this.DV+ct:ct>0&&(Le[De++]=ct),Le.t=De,Le.clamp()}function gt(Pe,Le){var De=this.abs(),ct=Pe.abs(),h=De.t;for(Le.t=h+ct.t;--h>=0;)Le[h]=0;for(h=0;h<ct.t;++h)Le[h+De.t]=De.am(0,ct[h],Le,h,0,De.t);Le.s=0,Le.clamp(),this.s!=Pe.s&&t.ZERO.subTo(Le,Le)}function Te(Pe){for(var Le=this.abs(),De=Pe.t=2*Le.t;--De>=0;)Pe[De]=0;for(De=0;De<Le.t-1;++De){var ct=Le.am(De,Le[De],Pe,2*De,0,1);(Pe[De+Le.t]+=Le.am(De+1,2*Le[De],Pe,2*De+1,ct,Le.t-De-1))>=Le.DV&&(Pe[De+Le.t]-=Le.DV,Pe[De+Le.t+1]=1)}Pe.t>0&&(Pe[Pe.t-1]+=Le.am(De,Le[De],Pe,2*De,0,1)),Pe.s=0,Pe.clamp()}function Et(Pe,Le,De){var ct=Pe.abs();if(!(ct.t<=0)){var h=this.abs();if(h.t<ct.t){Le!=null&&Le.fromInt(0),De!=null&&this.copyTo(De);return}De==null&&(De=n());var f=n(),b=this.s,L=Pe.s,I=this.DB-ue(ct[ct.t-1]);I>0?(ct.lShiftTo(I,f),h.lShiftTo(I,De)):(ct.copyTo(f),h.copyTo(De));var B=f.t,j=f[B-1];if(j!=0){var Y=j*(1<<this.F1)+(B>1?f[B-2]>>this.F2:0),Z=this.FV/Y,ie=(1<<this.F1)/Y,pe=1<<this.F2,me=De.t,de=me-B,le=Le??n();for(f.dlShiftTo(de,le),De.compareTo(le)>=0&&(De[De.t++]=1,De.subTo(le,De)),t.ONE.dlShiftTo(B,le),le.subTo(f,f);f.t<B;)f[f.t++]=0;for(;--de>=0;){var we=De[--me]==j?this.DM:Math.floor(De[me]*Z+(De[me-1]+pe)*ie);if((De[me]+=f.am(0,we,De,de,0,B))<we)for(f.dlShiftTo(de,le),De.subTo(le,De);De[me]<--we;)De.subTo(le,De)}Le!=null&&(De.drShiftTo(B,Le),b!=L&&t.ZERO.subTo(Le,Le)),De.t=B,De.clamp(),I>0&&De.rShiftTo(I,De),b<0&&t.ZERO.subTo(De,De)}}}function Bt(Pe){var Le=n();return this.abs().divRemTo(Pe,null,Le),this.s<0&&Le.compareTo(t.ZERO)>0&&Pe.subTo(Le,Le),Le}function Ke(Pe){this.m=Pe}function At(Pe){return Pe.s<0||Pe.compareTo(this.m)>=0?Pe.mod(this.m):Pe}function nt(Pe){return Pe}function dt(Pe){Pe.divRemTo(this.m,null,Pe)}function Mt(Pe,Le,De){Pe.multiplyTo(Le,De),this.reduce(De)}function zt(Pe,Le){Pe.squareTo(Le),this.reduce(Le)}Ke.prototype.convert=At,Ke.prototype.revert=nt,Ke.prototype.reduce=dt,Ke.prototype.mulTo=Mt,Ke.prototype.sqrTo=zt;function xt(){if(this.t<1)return 0;var Pe=this[0];if(!(Pe&1))return 0;var Le=Pe&3;return Le=Le*(2-(Pe&15)*Le)&15,Le=Le*(2-(Pe&255)*Le)&255,Le=Le*(2-((Pe&65535)*Le&65535))&65535,Le=Le*(2-Pe*Le%this.DV)%this.DV,Le>0?this.DV-Le:-Le}function Gt(Pe){this.m=Pe,this.mp=Pe.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<Pe.DB-15)-1,this.mt2=2*Pe.t}function yi(Pe){var Le=n();return Pe.abs().dlShiftTo(this.m.t,Le),Le.divRemTo(this.m,null,Le),Pe.s<0&&Le.compareTo(t.ZERO)>0&&this.m.subTo(Le,Le),Le}function ti(Pe){var Le=n();return Pe.copyTo(Le),this.reduce(Le),Le}function Mi(Pe){for(;Pe.t<=this.mt2;)Pe[Pe.t++]=0;for(var Le=0;Le<this.m.t;++Le){var De=Pe[Le]&32767,ct=De*this.mpl+((De*this.mph+(Pe[Le]>>15)*this.mpl&this.um)<<15)&Pe.DM;for(De=Le+this.m.t,Pe[De]+=this.m.am(0,ct,Pe,Le,0,this.m.t);Pe[De]>=Pe.DV;)Pe[De]-=Pe.DV,Pe[++De]++}Pe.clamp(),Pe.drShiftTo(this.m.t,Pe),Pe.compareTo(this.m)>=0&&Pe.subTo(this.m,Pe)}function Li(Pe,Le){Pe.squareTo(Le),this.reduce(Le)}function qi(Pe,Le,De){Pe.multiplyTo(Le,De),this.reduce(De)}Gt.prototype.convert=yi,Gt.prototype.revert=ti,Gt.prototype.reduce=Mi,Gt.prototype.mulTo=qi,Gt.prototype.sqrTo=Li;function Pi(){return(this.t>0?this[0]&1:this.s)==0}function Oi(Pe,Le){if(Pe>4294967295||Pe<1)return t.ONE;var De=n(),ct=n(),h=Le.convert(this),f=ue(Pe)-1;for(h.copyTo(De);--f>=0;)if(Le.sqrTo(De,ct),(Pe&1<<f)>0)Le.mulTo(ct,h,De);else{var b=De;De=ct,ct=b}return Le.revert(De)}function $t(Pe,Le){var De;return Pe<256||Le.isEven()?De=new Ke(Le):De=new Gt(Le),this.exp(Pe,De)}t.prototype.copyTo=O,t.prototype.fromInt=D,t.prototype.fromString=w,t.prototype.clamp=N,t.prototype.dlShiftTo=be,t.prototype.drShiftTo=Ae,t.prototype.lShiftTo=W,t.prototype.rShiftTo=J,t.prototype.subTo=Ue,t.prototype.multiplyTo=gt,t.prototype.squareTo=Te,t.prototype.divRemTo=Et,t.prototype.invDigit=xt,t.prototype.isEven=Pi,t.prototype.exp=Oi,t.prototype.toString=H,t.prototype.negate=X,t.prototype.abs=ae,t.prototype.compareTo=oe,t.prototype.bitLength=fe,t.prototype.mod=Bt,t.prototype.modPowInt=$t,t.ZERO=z(0),t.ONE=z(1);function Rs(Pe,Le){this.fromInt(0),Le==null&&(Le=10);for(var De=this.chunkSize(Le),ct=Math.pow(Le,De),h=!1,f=0,b=0,L=0;L<Pe.length;++L){var I=m(Pe,L);if(I<0){Pe.charAt(L)=="-"&&this.signum()==0&&(h=!0);continue}b=Le*b+I,++f>=De&&(this.dMultiply(ct),this.dAddOffset(b,0),f=0,b=0)}f>0&&(this.dMultiply(Math.pow(Le,f)),this.dAddOffset(b,0)),h&&t.ZERO.subTo(this,this)}function is(Pe){return Math.floor(Math.LN2*this.DB/Math.log(Pe))}function hs(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1}function qs(Pe){this[this.t]=this.am(0,Pe-1,this,0,0,this.t),++this.t,this.clamp()}function q(Pe,Le){if(Pe!=0){for(;this.t<=Le;)this[this.t++]=0;for(this[Le]+=Pe;this[Le]>=this.DV;)this[Le]-=this.DV,++Le>=this.t&&(this[this.t++]=0),++this[Le]}}function Re(Pe){if(Pe==null&&(Pe=10),this.signum()==0||Pe<2||Pe>36)return"0";var Le=this.chunkSize(Pe),De=Math.pow(Pe,Le),ct=z(De),h=n(),f=n(),b="";for(this.divRemTo(ct,h,f);h.signum()>0;)b=(De+f.intValue()).toString(Pe).substr(1)+b,h.divRemTo(ct,h,f);return f.intValue().toString(Pe)+b}function He(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function Ze(Pe,Le){for(var De=0,ct=0,h=Math.min(Pe.t,this.t);De<h;)ct+=this[De]+Pe[De],Le[De++]=ct&this.DM,ct>>=this.DB;if(Pe.t<this.t){for(ct+=Pe.s;De<this.t;)ct+=this[De],Le[De++]=ct&this.DM,ct>>=this.DB;ct+=this.s}else{for(ct+=this.s;De<Pe.t;)ct+=Pe[De],Le[De++]=ct&this.DM,ct>>=this.DB;ct+=Pe.s}Le.s=ct<0?-1:0,ct>0?Le[De++]=ct:ct<-1&&(Le[De++]=this.DV+ct),Le.t=De,Le.clamp()}t.prototype.fromRadix=Rs,t.prototype.chunkSize=is,t.prototype.signum=hs,t.prototype.dMultiply=qs,t.prototype.dAddOffset=q,t.prototype.toRadix=Re,t.prototype.intValue=He,t.prototype.addTo=Ze;var Xe={abs:function(Pe,Le){var De=new o.math.Long(Pe,Le),ct;De.isNegative()?ct=De.negate():ct=De,HEAP32[tempDoublePtr>>2]=ct.low_,HEAP32[tempDoublePtr+4>>2]=ct.high_},ensureTemps:function(){Xe.ensuredTemps||(Xe.ensuredTemps=!0,Xe.two32=new t,Xe.two32.fromString("4294967296",10),Xe.two64=new t,Xe.two64.fromString("18446744073709551616",10),Xe.temp1=new t,Xe.temp2=new t)},lh2bignum:function(Pe,Le){var De=new t;De.fromString(Le.toString(),10);var ct=new t;De.multiplyTo(Xe.two32,ct);var h=new t;h.fromString(Pe.toString(),10);var f=new t;return h.addTo(ct,f),f},stringify:function(Pe,Le,De){var ct=new o.math.Long(Pe,Le).toString();if(De&&ct[0]=="-"){Xe.ensureTemps();var h=new t;h.fromString(ct,10),ct=new t,Xe.two64.addTo(h,ct),ct=ct.toString(10)}return ct},fromString:function(Pe,Le,De,ct,h){Xe.ensureTemps();var f=new t;f.fromString(Pe,Le);var b=new t;b.fromString(De,10);var L=new t;if(L.fromString(ct,10),h&&f.compareTo(t.ZERO)<0){var I=new t;f.addTo(Xe.two64,I),f=I}var B=!1;f.compareTo(b)<0?(f=b,B=!0):f.compareTo(L)>0&&(f=L,B=!0);var j=o.math.Long.fromString(f.toString());if(HEAP32[tempDoublePtr>>2]=j.low_,HEAP32[tempDoublePtr+4>>2]=j.high_,B)throw"range error"}};return Xe}();function ExitStatus(o){this.name="ExitStatus",this.message="Program terminated with exit("+o+")",this.status=o}ExitStatus.prototype=new Error,ExitStatus.prototype.constructor=ExitStatus;var initialStackTop;dependenciesFulfilled=function o(){!Module.calledRun&&shouldRunNow&&run(),Module.calledRun||(dependenciesFulfilled=o)},Module.callMain=Module.callMain=function o(e){assert(runDependencies==0,"cannot call main when async dependencies remain! (listen on __ATMAIN__)"),assert(__ATPRERUN__.length==0,"cannot call main when preRun functions remain to be called"),e=e||[],ensureInitRuntime();var t=e.length+1;function n(){for(var l=0;l<3;l++)r.push(0)}var r=[allocate(intArrayFromString(Module.thisProgram),"i8",ALLOC_NORMAL)];n();for(var s=0;s<t-1;s=s+1)r.push(allocate(intArrayFromString(e[s]),"i8",ALLOC_NORMAL)),n();r.push(0),r=allocate(r,"i32",ALLOC_NORMAL),initialStackTop=STACKTOP;try{var a=Module._main(t,r,0);exit(a)}catch(l){if(l instanceof ExitStatus)return;if(l=="SimulateInfiniteLoop"){Module.noExitRuntime=!0;return}else throw l&&typeof l=="object"&&l.stack&&Module.printErr("exception thrown: "+[l,l.stack]),l}finally{}};function run(o){if(o=o||Module.arguments,runDependencies>0||(preRun(),runDependencies>0)||Module.calledRun)return;function e(){Module.calledRun||(Module.calledRun=!0,!ABORT&&(ensureInitRuntime(),preMain(),Module._main&&shouldRunNow&&Module.callMain(o),postRun()))}Module.setStatus?(Module.setStatus("Running..."),setTimeout(function(){setTimeout(function(){Module.setStatus("")},1),e()},1)):e()}Module.run=Module.run=run;function exit(o){if(!Module.noExitRuntime)throw ABORT=!0,STACKTOP=initialStackTop,exitRuntime(),ENVIRONMENT_IS_NODE?(process.stdout.once("drain",function(){process.exit(o)}),console.log(" "),setTimeout(function(){process.exit(o)},500)):ENVIRONMENT_IS_SHELL&&typeof quit=="function"&&quit(o),new ExitStatus(o)}Module.exit=Module.exit=exit;function abort(o){o&&(Module.print(o),Module.printErr(o)),ABORT=!0;var e=`
If this abort() is unexpected, build with -s ASSERTIONS=1 which can give more information.`;throw"abort() at "+stackTrace()+e}if(Module.abort=Module.abort=abort,Module.preInit)for(typeof Module.preInit=="function"&&(Module.preInit=[Module.preInit]);Module.preInit.length>0;)Module.preInit.pop()();var shouldRunNow=!0;Module.noInitialRun&&(shouldRunNow=!1),run();var origMalloc=Module._malloc,origFree=Module._free,MEMSTATS={totalMemory:Module.HEAPU8.length,heapUsed:0},MEMSTATS_DATA={pointerToSizeMap:{},getSizeOfPointer:function(o){return MEMSTATS_DATA.pointerToSizeMap[o]}};Module.MEMSTATS=MEMSTATS,Module.MEMSTATS_DATA=MEMSTATS_DATA;var hookedMalloc=function(o){var e=origMalloc(o);return e?(MEMSTATS.heapUsed+=o,MEMSTATS_DATA.pointerToSizeMap[e]=o,e):0},hookedFree=function(o){return o&&(MEMSTATS.heapUsed-=MEMSTATS_DATA.getSizeOfPointer(o)||0,delete MEMSTATS_DATA.pointerToSizeMap[o]),origFree(o)};return Module._malloc=hookedMalloc,Module._free=hookedFree,_malloc=hookedMalloc,_free=hookedFree,module.exports};const C_MINISAT$1=C_MINISAT;var MiniSat;MiniSat=function(){var o=this._C=C_MINISAT$1();this._native={getStackPointer:function(){return o.Runtime.stackSave()},setStackPointer:function(e){o.Runtime.stackRestore(e)},allocateBytes:function(e){return o.allocate(e,"i8",o.ALLOC_STACK)},pushString:function(e){return this.allocateBytes(o.intArrayFromString(e))},savingStack:function(e){var t=this.getStackPointer();try{return e(this,o)}finally{this.setStackPointer(t)}}},o._createTheSolver(),this._clauses=[]};MiniSat.prototype.ensureVar=function(o){this._C._ensureVar(o)};MiniSat.prototype.addClause=function(o){return this._clauses.push(o),this._native.savingStack(function(e,t){var n=t.allocate((o.length+1)*4,"i32",t.ALLOC_STACK);return _$1.each(o,function(r,s){t.setValue(n+s*4,r,"i32")}),t.setValue(n+o.length*4,0,"i32"),!!t._addClause(n)})};MiniSat.prototype.solve=function(){return!!this._C._solve()};MiniSat.prototype.solveAssuming=function(o){return!!this._C._solveAssuming(o)};MiniSat.prototype.getSolution=function(){for(var o=[null],e=this._C,t=e._getNumVars(),n=e._getSolution(),r=0;r<t;r++)o[r+1]=e.getValue(n+r,"i8")===0;return o};MiniSat.prototype.retireVar=function(o){this._C._retireVar(o)};MiniSat.prototype.getConflictClause=function(){for(var o=this._C,e=o._getConflictClauseSize(),t=o._getConflictClause(),n=[],r=0;r<e;r++){var s=o.getValue(t+r*4,"i32"),a=s>>>1,l=s&1?-1:1;n[r]=a*l}return n};const MiniSat$1=MiniSat;var Logic;Logic={};var withDescription=function(o,e){return e.description=o,e},lazyInstanceofTester=function(o,e,t){return withDescription(o,function(n){return n instanceof e[t]})};Logic.isNumTerm=withDescription("a NumTerm (non-zero integer)",function(o){return o===(o|0)&&o!==0});Logic.isNameTerm=withDescription("a NameTerm (string)",function(o){return typeof o=="string"&&!/^-*[0-9]*$/.test(o)});Logic.isTerm=withDescription("a Term (appropriate string or number)",function(o){return Logic.isNumTerm(o)||Logic.isNameTerm(o)});Logic.isWholeNumber=withDescription("a whole number (integer >= 0)",function(o){return o===(o|0)&&o>=0});Logic.isFormula=lazyInstanceofTester("a Formula",Logic,"Formula");Logic.isClause=lazyInstanceofTester("a Clause",Logic,"Clause");Logic.isBits=lazyInstanceofTester("a Bits",Logic,"Bits");Logic._isInteger=withDescription("an integer",function(o){return o===(o|0)});Logic._isFunction=withDescription("a Function",function(o){return typeof o=="function"});Logic._isString=withDescription("a String",function(o){return typeof o=="string"});Logic._isArrayWhere=function(o){var e="an array";return o.description&&(e+=" of "+o.description),withDescription(e,function(t){if(_$1.isArray(t)){for(var n=0;n<t.length;n++)if(!o(t[n]))return!1;return!0}else return!1})};Logic._isFormulaOrTerm=withDescription("a Formula or Term",function(o){return Logic.isFormula(o)||Logic.isTerm(o)});Logic._isFormulaOrTermOrBits=withDescription("a Formula, Term, or Bits",function(o){return Logic.isFormula(o)||Logic.isBits(o)||Logic.isTerm(o)});Logic._MiniSat=MiniSat$1;var isInteger=Logic._isInteger,isFunction=Logic._isFunction,isString=Logic._isString,isArrayWhere=Logic._isArrayWhere,isFormulaOrTerm=Logic._isFormulaOrTerm,isFormulaOrTermOrBits=Logic._isFormulaOrTermOrBits;Logic._assert=function(o,e,t){if(!e(o)){var n=typeof o=="string"?JSON.stringify(o):o;throw new Error(n+" is not "+(e.description||t))}};var assertNumArgs=function(o,e,t){if(o!==e)throw new Error("Expected "+e+" args in "+t+", got "+o)},assert$1=Logic._assert;Logic._assertIfEnabled=function(o,e,t){assert$1&&assert$1(o,e,t)};Logic.disablingAssertions=function(o){var e=assert$1;try{return assert$1=null,o()}finally{assert$1=e}};Logic._disablingTypeChecks=Logic.disablingAssertions;Logic.not=function(o){return assert$1&&assert$1(o,isFormulaOrTerm),o instanceof Logic.Formula?new Logic.NotFormula(o):typeof o=="number"?-o:o.charAt(0)==="-"?o.slice(1):"-"+o};Logic.NAME_FALSE="$F";Logic.NAME_TRUE="$T";Logic.NUM_FALSE=1;Logic.NUM_TRUE=2;Logic.TRUE=Logic.NAME_TRUE;Logic.FALSE=Logic.NAME_FALSE;Logic.Formula=function(){};Logic._defineFormula=function(o,e,t){assert$1&&assert$1(o,isFunction),assert$1&&assert$1(e,isString),o.prototype=new Logic.Formula,o.prototype.type=e,t&&_$1.extend(o.prototype,t)};Logic.Formula.prototype.generateClauses=function(o,e){throw new Error("Cannot generate this Formula; it must be expanded")};Logic.Formula._nextGuid=1;Logic.Formula.prototype._guid=null;Logic.Formula.prototype.guid=function(){return this._guid===null&&(this._guid=Logic.Formula._nextGuid++),this._guid};Logic.Clause=function(){var o=_$1.flatten(arguments);assert$1&&assert$1(o,isArrayWhere(Logic.isNumTerm)),this.terms=o};Logic.Clause.prototype.append=function(){return new Logic.Clause(this.terms.concat(_$1.flatten(arguments)))};var FormulaInfo=function(){this.varName=null,this.varNum=null,this.occursPositively=!1,this.occursNegatively=!1,this.isRequired=!1,this.isForbidden=!1};Logic.Termifier=function(o){this.solver=o};Logic.Termifier.prototype.clause=function(){var o=this,e=_$1.flatten(arguments);return assert$1&&assert$1(e,isArrayWhere(isFormulaOrTerm)),new Logic.Clause(_$1.map(e,function(t){return o.term(t)}))};Logic.Termifier.prototype.term=function(o){return this.solver._formulaToTerm(o)};Logic.Termifier.prototype.generate=function(o,e){return this.solver._generateFormula(o,e,this)};Logic.Solver=function(){var o=this;o.clauses=[],o._num2name=[null],o._name2num={};var e=o.getVarNum(Logic.NAME_FALSE,!1,!0),t=o.getVarNum(Logic.NAME_TRUE,!1,!0);if(e!==Logic.NUM_FALSE||t!==Logic.NUM_TRUE)throw new Error("Assertion failure: $T and $F have wrong numeric value");o._F_used=!1,o._T_used=!1,o.clauses.push(new Logic.Clause(-Logic.NUM_FALSE)),o.clauses.push(new Logic.Clause(Logic.NUM_TRUE)),o._formulaInfo={},o._nextFormulaNumByType={},o._ungeneratedFormulas={},o._numClausesAddedToMiniSat=0,o._unsat=!1,o._minisat=new MiniSat$1,o._termifier=new Logic.Termifier(o)};Logic.Solver.prototype.getVarNum=function(o,e,t){var n=" "+o;if(_$1.has(this._name2num,n))return this._name2num[n];if(e)return 0;if(o.charAt(0)==="$"&&!t)throw new Error("Only generated variable names can start with $");var r=this._num2name.length;return this._name2num[n]=r,this._num2name.push(o),r};Logic.Solver.prototype.getVarName=function(o){assert$1&&assert$1(o,isInteger);var e=this._num2name;if(o<1||o>=e.length)throw new Error("Bad variable num: "+o);return e[o]};Logic.Solver.prototype.toNumTerm=function(o,e){var t=this;if(assert$1&&assert$1(o,Logic.isTerm),typeof o=="number")return o;for(var n=!1;o.charAt(0)==="-";)o=o.slice(1),n=!n;var r=t.getVarNum(o,e);return r?n?-r:r:0};Logic.Solver.prototype.toNameTerm=function(o){var e=this;if(assert$1&&assert$1(o,Logic.isTerm),typeof o=="string"){for(;o.slice(0,2)==="--";)o=o.slice(2);return o}else{var t=!1;return o<0&&(t=!0,o=-o),o=e.getVarName(o),t&&(o="-"+o),o}};Logic.Solver.prototype._addClause=function(o,e,t){var n=this;assert$1&&assert$1(o,Logic.isClause);var r=null;e&&(r=e,assert$1&&assert$1(r,isArrayWhere(Logic.isNumTerm)));var s=!1,a=!1,l=o.terms.length;r&&(o=o.append(r));for(var d=0;d<o.terms.length;d++){var c=o.terms[d],y=c<0?-c:c;if(y===Logic.NUM_FALSE)s=!0;else if(y===Logic.NUM_TRUE)a=!0;else{if(y<1||y>=n._num2name.length)throw new Error("Bad variable number: "+y);d<l&&(t?t(c):n._useFormulaTerm(c))}}this._F_used=this._F_used||s,this._T_used=this._T_used||a,this.clauses.push(o)};Logic.Solver.prototype._useFormulaTerm=function(o,e){var t=this;assert$1&&assert$1(o,Logic.isNumTerm);var n=o<0?-o:o;if(_$1.has(t._ungeneratedFormulas,n)){var r=t._ungeneratedFormulas[n],s=t._getFormulaInfo(r),a=o>0,l=null,d;if(e?d=e:(l=[],d=function(O,D){l.push({clauses:O,extraTerms:D})}),a&&!s.occursPositively){s.occursPositively=!0;var c=t._generateFormula(!0,r);d(c,[-n])}else if(!a&&!s.occursNegatively){s.occursNegatively=!0;var c=t._generateFormula(!1,r);d(c,[n])}if(s.occursPositively&&s.occursNegatively&&delete t._ungeneratedFormulas[n],!!(l&&l.length))for(var y=function(O){t._useFormulaTerm(O,d)};l.length;){var m=l.pop();t._addClauses(m.clauses,m.extraTerms,y)}}};Logic.Solver.prototype._addClauses=function(o,e,t){assert$1&&assert$1(o,isArrayWhere(Logic.isClause));var n=this;_$1.each(o,function(r){n._addClause(r,e,t)})};Logic.Solver.prototype.require=function(){this._requireForbidImpl(!0,_$1.flatten(arguments))};Logic.Solver.prototype.forbid=function(){this._requireForbidImpl(!1,_$1.flatten(arguments))};Logic.Solver.prototype._requireForbidImpl=function(o,e){var t=this;assert$1&&assert$1(e,isArrayWhere(isFormulaOrTerm)),_$1.each(e,function(n){if(n instanceof Logic.NotFormula)t._requireForbidImpl(!o,[n.operand]);else if(n instanceof Logic.Formula){var r=t._getFormulaInfo(n);if(r.varNum!==null){var s=o?1:-1;t._addClause(new Logic.Clause(s*r.varNum))}else t._addClauses(t._generateFormula(o,n));o?r.isRequired=!0:r.isForbidden=!0}else t._addClauses(t._generateFormula(o,n))})};Logic.Solver.prototype._generateFormula=function(o,e,t){var n=this;if(assert$1&&assert$1(e,isFormulaOrTerm),e instanceof Logic.NotFormula)return n._generateFormula(!o,e.operand);if(e instanceof Logic.Formula){var r=n._getFormulaInfo(e);if(o&&r.isRequired||!o&&r.isForbidden)return[];if(o&&r.isForbidden||!o&&r.isRequired)return[new Logic.Clause];var s=e.generateClauses(o,t||n._termifier);return _$1.isArray(s)?s:[s]}else{var a=n.toNumTerm(e),l=o?1:-1;return a===l*Logic.NUM_TRUE||a===-l*Logic.NUM_FALSE?[]:a===l*Logic.NUM_FALSE||a===-l*Logic.NUM_TRUE?[new Logic.Clause]:[new Logic.Clause(l*a)]}};Logic.Solver.prototype._clauseData=function(){var o=_$1.map(this.clauses,"terms");return this._T_used||o.splice(1,1),this._F_used||o.splice(0,1),o};Logic.Solver.prototype._clauseStrings=function(){var o=this,e=o._clauseData();return _$1.map(e,function(t){return _$1.map(t,function(n){var r=o.toNameTerm(n);if(/\s/.test(r)){var s="";r.charAt(0)==="-"&&(s="-",r=r.slice(1)),r=s+'"'+r+'"'}return r}).join(" v ")})};Logic.Solver.prototype._getFormulaInfo=function(o,e){var t=this,n=o.guid();if(!t._formulaInfo[n]){if(e)return null;t._formulaInfo[n]=new FormulaInfo}return t._formulaInfo[n]};Logic.Solver.prototype._formulaToTerm=function(o){var e=this;if(_$1.isArray(o))return assert$1&&assert$1(o,isArrayWhere(isFormulaOrTerm)),_$1.map(o,_$1.bind(e._formulaToTerm,e));if(assert$1&&assert$1(o,isFormulaOrTerm),o instanceof Logic.NotFormula)return Logic.not(e._formulaToTerm(o.operand));if(o instanceof Logic.Formula){var t=this._getFormulaInfo(o);if(t.isRequired)return Logic.NUM_TRUE;if(t.isForbidden)return Logic.NUM_FALSE;if(t.varNum===null){var n=o.type;this._nextFormulaNumByType[n]||(this._nextFormulaNumByType[n]=1);var r=this._nextFormulaNumByType[n]++;t.varName="$"+o.type+r,t.varNum=this.getVarNum(t.varName,!1,!0),this._ungeneratedFormulas[t.varNum]=o}return t.varNum}else return e.toNumTerm(o)};Logic.or=function(){var o=_$1.flatten(arguments);return o.length===0?Logic.FALSE:o.length===1?(assert$1&&assert$1(o[0],isFormulaOrTerm),o[0]):new Logic.OrFormula(o)};Logic.OrFormula=function(o){assert$1&&assert$1(o,isArrayWhere(isFormulaOrTerm)),this.operands=o};Logic._defineFormula(Logic.OrFormula,"or",{generateClauses:function(o,e){if(o)return e.clause(this.operands);var t=[];return _$1.each(this.operands,function(n){t.push.apply(t,e.generate(!1,n))}),t}});Logic.NotFormula=function(o){assert$1&&assert$1(o,isFormulaOrTerm),this.operand=o};Logic._defineFormula(Logic.NotFormula,"not");Logic.and=function(){var o=_$1.flatten(arguments);return o.length===0?Logic.TRUE:o.length===1?(assert$1&&assert$1(o[0],isFormulaOrTerm),o[0]):new Logic.AndFormula(o)};Logic.AndFormula=function(o){assert$1&&assert$1(o,isArrayWhere(isFormulaOrTerm)),this.operands=o};Logic._defineFormula(Logic.AndFormula,"and",{generateClauses:function(o,e){if(o){var t=[];return _$1.each(this.operands,function(n){t.push.apply(t,e.generate(!0,n))}),t}else return e.clause(_$1.map(this.operands,Logic.not))}});var group=function(o,e){for(var t=[],n=0;n<o.length;n+=e)t.push(o.slice(n,n+e));return t};Logic.xor=function(){var o=_$1.flatten(arguments);return o.length===0?Logic.FALSE:o.length===1?(assert$1&&assert$1(o[0],isFormulaOrTerm),o[0]):new Logic.XorFormula(o)};Logic.XorFormula=function(o){assert$1&&assert$1(o,isArrayWhere(isFormulaOrTerm)),this.operands=o};Logic._defineFormula(Logic.XorFormula,"xor",{generateClauses:function(o,e){var t=this.operands,n=Logic.not;if(t.length>3)return e.generate(o,Logic.xor(_$1.map(group(this.operands,3),function(l){return Logic.xor(l)})));if(o){if(t.length===0)return e.clause();if(t.length===1)return e.clause(t[0]);if(t.length===2){var r=t[0],s=t[1];return[e.clause(r,s),e.clause(n(r),n(s))]}else if(t.length===3){var r=t[0],s=t[1],a=t[2];return[e.clause(r,s,a),e.clause(r,n(s),n(a)),e.clause(n(r),s,n(a)),e.clause(n(r),n(s),a)]}}else{if(t.length===0)return[];if(t.length===1)return e.clause(n(t[0]));if(t.length===2){var r=t[0],s=t[1];return[e.clause(r,n(s)),e.clause(n(r),s)]}else if(t.length===3){var r=t[0],s=t[1],a=t[2];return[e.clause(n(r),n(s),n(a)),e.clause(n(r),s,a),e.clause(r,n(s),a),e.clause(r,s,n(a))]}}}});Logic.atMostOne=function(){var o=_$1.flatten(arguments);return o.length<=1?Logic.TRUE:new Logic.AtMostOneFormula(o)};Logic.AtMostOneFormula=function(o){assert$1&&assert$1(o,isArrayWhere(isFormulaOrTerm)),this.operands=o};Logic._defineFormula(Logic.AtMostOneFormula,"atMostOne",{generateClauses:function(o,e){var t=this.operands,n=Logic.not;if(t.length<=1)return[];if(t.length===2)return e.generate(o,Logic.not(Logic.and(t)));if(o&&t.length===3){for(var r=[],s=0;s<t.length;s++)for(var a=s+1;a<t.length;a++)r.push(e.clause(n(t[s]),n(t[a])));return r}else if(!o&&t.length===3){var l=t[0],d=t[1],c=t[2];return[e.clause(l,d),e.clause(l,c),e.clause(d,c)]}else{var y=group(t,3),m=_$1.map(y,function(D){return Logic.or(D)});y[y.length-1].length<2&&y.pop();var O=_$1.map(y,function(D){return Logic.atMostOne(D)});return e.generate(o,Logic.and(Logic.atMostOne(m),O))}}});Logic.implies=function(o,e){return assert$1&&assertNumArgs(arguments.length,2,"Logic.implies"),new Logic.ImpliesFormula(o,e)};Logic.ImpliesFormula=function(o,e){assert$1&&assert$1(o,isFormulaOrTerm),assert$1&&assert$1(e,isFormulaOrTerm),assert$1&&assertNumArgs(arguments.length,2,"Logic.implies"),this.A=o,this.B=e};Logic._defineFormula(Logic.ImpliesFormula,"implies",{generateClauses:function(o,e){return e.generate(o,Logic.or(Logic.not(this.A),this.B))}});Logic.equiv=function(o,e){return assert$1&&assertNumArgs(arguments.length,2,"Logic.equiv"),new Logic.EquivFormula(o,e)};Logic.EquivFormula=function(o,e){assert$1&&assert$1(o,isFormulaOrTerm),assert$1&&assert$1(e,isFormulaOrTerm),assert$1&&assertNumArgs(arguments.length,2,"Logic.equiv"),this.A=o,this.B=e};Logic._defineFormula(Logic.EquivFormula,"equiv",{generateClauses:function(o,e){return e.generate(!o,Logic.xor(this.A,this.B))}});Logic.exactlyOne=function(){var o=_$1.flatten(arguments);return o.length===0?Logic.FALSE:o.length===1?(assert$1&&assert$1(o[0],isFormulaOrTerm),o[0]):new Logic.ExactlyOneFormula(o)};Logic.ExactlyOneFormula=function(o){assert$1&&assert$1(o,isArrayWhere(isFormulaOrTerm)),this.operands=o};Logic._defineFormula(Logic.ExactlyOneFormula,"exactlyOne",{generateClauses:function(o,e){var t=this.operands;return t.length<3?e.generate(o,Logic.xor(t)):e.generate(o,Logic.and(Logic.atMostOne(t),Logic.or(t)))}});Logic.Bits=function(o){assert$1&&assert$1(o,isArrayWhere(isFormulaOrTerm)),this.bits=o};Logic.constantBits=function(o){assert$1&&assert$1(o,Logic.isWholeNumber);for(var e=[];o;)e.push(o&1?Logic.TRUE:Logic.FALSE),o>>>=1;return new Logic.Bits(e)};Logic.variableBits=function(o,e){assert$1&&assert$1(e,Logic.isWholeNumber);for(var t=[],n=0;n<e;n++)t.push(o+"$"+n);return new Logic.Bits(t)};Logic.lessThanOrEqual=function(o,e){return new Logic.LessThanOrEqualFormula(o,e)};Logic.LessThanOrEqualFormula=function(o,e){assert$1&&assert$1(o,Logic.isBits),assert$1&&assert$1(e,Logic.isBits),assert$1&&assertNumArgs(arguments.length,2,"Bits comparison function"),this.bits1=o,this.bits2=e};var genLTE=function(o,e,t,n){var r=[],s=o.bits.slice(),a=e.bits.slice();if(n&&!e.bits.length)return t.clause();for(;s.length>a.length;){var l=s.pop();r.push(t.clause(Logic.not(l)))}for(var d=_$1.map(a,function(y,m){return m<s.length?Logic.xor(s[m],y):y}),c=s.length-1;c>=0;c--)r.push(t.clause(d.slice(c+1),Logic.not(s[c]),a[c]));return n&&r.push.apply(r,t.generate(!0,Logic.or(d))),r};Logic._defineFormula(Logic.LessThanOrEqualFormula,"lte",{generateClauses:function(o,e){return o?genLTE(this.bits1,this.bits2,e,!1):genLTE(this.bits2,this.bits1,e,!0)}});Logic.lessThan=function(o,e){return new Logic.LessThanFormula(o,e)};Logic.LessThanFormula=function(o,e){assert$1&&assert$1(o,Logic.isBits),assert$1&&assert$1(e,Logic.isBits),assert$1&&assertNumArgs(arguments.length,2,"Bits comparison function"),this.bits1=o,this.bits2=e};Logic._defineFormula(Logic.LessThanFormula,"lt",{generateClauses:function(o,e){return o?genLTE(this.bits1,this.bits2,e,!0):genLTE(this.bits2,this.bits1,e,!1)}});Logic.greaterThan=function(o,e){return Logic.lessThan(e,o)};Logic.greaterThanOrEqual=function(o,e){return Logic.lessThanOrEqual(e,o)};Logic.equalBits=function(o,e){return new Logic.EqualBitsFormula(o,e)};Logic.EqualBitsFormula=function(o,e){assert$1&&assert$1(o,Logic.isBits),assert$1&&assert$1(e,Logic.isBits),assert$1&&assertNumArgs(arguments.length,2,"Logic.equalBits"),this.bits1=o,this.bits2=e};Logic._defineFormula(Logic.EqualBitsFormula,"equalBits",{generateClauses:function(o,e){for(var t=this.bits1.bits,n=this.bits2.bits,r=Math.max(t.length,n.length),s=[],a=0;a<r;a++)a>=t.length?s.push(Logic.not(n[a])):a>=n.length?s.push(Logic.not(t[a])):s.push(Logic.equiv(t[a],n[a]));return e.generate(o,Logic.and(s))}});Logic.HalfAdderSum=function(o,e){assert$1&&assert$1(o,isFormulaOrTerm),assert$1&&assert$1(e,isFormulaOrTerm),assert$1&&assertNumArgs(arguments.length,2,"Logic.HalfAdderSum"),this.a=o,this.b=e};Logic._defineFormula(Logic.HalfAdderSum,"hsum",{generateClauses:function(o,e){return e.generate(o,Logic.xor(this.a,this.b))}});Logic.HalfAdderCarry=function(o,e){assert$1&&assert$1(o,isFormulaOrTerm),assert$1&&assert$1(e,isFormulaOrTerm),assert$1&&assertNumArgs(arguments.length,2,"Logic.HalfAdderCarry"),this.a=o,this.b=e};Logic._defineFormula(Logic.HalfAdderCarry,"hcarry",{generateClauses:function(o,e){return e.generate(o,Logic.and(this.a,this.b))}});Logic.FullAdderSum=function(o,e,t){assert$1&&assert$1(o,isFormulaOrTerm),assert$1&&assert$1(e,isFormulaOrTerm),assert$1&&assert$1(t,isFormulaOrTerm),assert$1&&assertNumArgs(arguments.length,3,"Logic.FullAdderSum"),this.a=o,this.b=e,this.c=t};Logic._defineFormula(Logic.FullAdderSum,"fsum",{generateClauses:function(o,e){return e.generate(o,Logic.xor(this.a,this.b,this.c))}});Logic.FullAdderCarry=function(o,e,t){assert$1&&assert$1(o,isFormulaOrTerm),assert$1&&assert$1(e,isFormulaOrTerm),assert$1&&assert$1(t,isFormulaOrTerm),assert$1&&assertNumArgs(arguments.length,3,"Logic.FullAdderCarry"),this.a=o,this.b=e,this.c=t};Logic._defineFormula(Logic.FullAdderCarry,"fcarry",{generateClauses:function(o,e){return e.generate(!o,Logic.atMostOne(this.a,this.b,this.c))}});var binaryWeightedSum=function(o){assert$1&&assert$1(o,isArrayWhere(isArrayWhere(isFormulaOrTerm)));for(var e=_$1.map(o,_$1.clone),t=0,n=[];t<e.length;){var r=e[t];if(!r.length)n.push(Logic.FALSE),t++;else if(r.length===1)n.push(r[0]),t++;else if(r.length===2){var s=new Logic.HalfAdderSum(r[0],r[1]),a=new Logic.HalfAdderCarry(r[0],r[1]);r.length=0,r.push(s),pushToNth(e,t+1,a)}else{var l=r.pop(),d=r.pop(),c=r.pop(),s=new Logic.FullAdderSum(c,d,l),a=new Logic.FullAdderCarry(c,d,l);r.push(s),pushToNth(e,t+1,a)}}return n},pushToNth=function(o,e,t){for(;e>=o.length;)o.push([]);o[e].push(t)},checkWeightedSumArgs=function(o,e){if(assert$1&&assert$1(o,isArrayWhere(isFormulaOrTerm)),typeof e=="number")assert$1&&assert$1(e,Logic.isWholeNumber);else if(assert$1&&assert$1(e,isArrayWhere(Logic.isWholeNumber)),o.length!==e.length)throw new Error("Formula array and weight array must be same length; they are "+o.length+" and "+e.length)};Logic.weightedSum=function(o,e){if(checkWeightedSumArgs(o,e),o.length===0)return new Logic.Bits([]);typeof e=="number"&&(e=_$1.map(o,function(){return e}));var t=[];return _$1.each(o,function(n,r){for(var s=e[r],a=0;s;)s&1&&pushToNth(t,a,n),s>>>=1,a++}),new Logic.Bits(binaryWeightedSum(t))};Logic.sum=function(){var o=_$1.flatten(arguments);assert$1&&assert$1(o,isArrayWhere(isFormulaOrTermOrBits));var e=[];return _$1.each(o,function(t){t instanceof Logic.Bits?_$1.each(t.bits,function(n,r){pushToNth(e,r,n)}):pushToNth(e,0,t)}),new Logic.Bits(binaryWeightedSum(e))};Logic.Solver.prototype.solve=function(o){var e=this;if(o!==void 0&&!(o>=1))throw new Error("_assumpVar must be a variable number");if(e._unsat)return null;for(;e._numClausesAddedToMiniSat<e.clauses.length;){var t=e._numClausesAddedToMiniSat,n=e.clauses[t].terms;assert$1&&assert$1(n,isArrayWhere(Logic.isNumTerm));var r=e._minisat.addClause(n);if(e._numClausesAddedToMiniSat++,!r)return e._unsat=!0,null}assert$1&&assert$1(this._num2name.length-1,Logic.isWholeNumber),e._minisat.ensureVar(this._num2name.length-1);var r=o?e._minisat.solveAssuming(o):e._minisat.solve();return r?new Logic.Solution(e,e._minisat.getSolution()):(o||(e._unsat=!0),null)};Logic.Solver.prototype.solveAssuming=function(o){assert$1&&assert$1(o,isFormulaOrTerm);var e=new Logic.Assumption(o),t=this._formulaToTerm(e);if(!(typeof t=="number"&&t>0))throw new Error("Assertion failure: not a positive numeric term");this._useFormulaTerm(t);var n=this.solve(t);return this._minisat.retireVar(t),n};Logic.Assumption=function(o){assert$1&&assert$1(o,isFormulaOrTerm),this.formula=o};Logic._defineFormula(Logic.Assumption,"assump",{generateClauses:function(o,e){return o?e.clause(this.formula):e.clause(Logic.not(this.formula))}});Logic.Solution=function(o,e){var t=this;t._solver=o,t._assignment=e,t._ungeneratedFormulas=_$1.clone(o._ungeneratedFormulas),t._formulaValueCache={},t._termifier=new Logic.Termifier(t._solver),t._termifier.term=function(n){return t.evaluate(n)?Logic.NUM_TRUE:Logic.NUM_FALSE},t._ignoreUnknownVariables=!1};Logic.Solution.prototype.ignoreUnknownVariables=function(){this._ignoreUnknownVariables=!0};Logic.Solution.prototype.getMap=function(){for(var o=this._solver,e=this._assignment,t={},n=1;n<e.length;n++){var r=o.getVarName(n);r&&r.charAt(0)!=="$"&&(t[r]=e[n])}return t};Logic.Solution.prototype.getTrueVars=function(){for(var o=this._solver,e=this._assignment,t=[],n=1;n<e.length;n++)if(e[n]){var r=o.getVarName(n);r&&r.charAt(0)!=="$"&&t.push(r)}return t.sort(),t};Logic.Solution.prototype.getFormula=function(){for(var o=this._solver,e=this._assignment,t=[],n=1;n<e.length;n++){var r=o.getVarName(n);r&&r.charAt(0)!=="$"&&t.push(e[n]?n:-n)}return Logic.and(t)};Logic.Solution.prototype.evaluate=function(o){var e=this;if(assert$1&&assert$1(o,isFormulaOrTermOrBits),o instanceof Logic.Bits){var t=0;return _$1.each(o.bits,function(w,N){e.evaluate(w)&&(t+=1<<N)}),t}var n=e._solver,r=e._ignoreUnknownVariables,s=e._assignment,a=o;if(a instanceof Logic.NotFormula)return!e.evaluate(a.operand);if(a instanceof Logic.Formula){var l=e._formulaValueCache[a.guid()];if(typeof l=="boolean")return l;var d,c=n._getFormulaInfo(a,!0);if(c&&c.varNum&&c.varNum<s.length&&!_$1.has(e._ungeneratedFormulas,c.varNum))d=s[c.varNum];else var y=n._generateFormula(!0,a,e._termifier),d=_$1.some(y,function(N){return _$1.any(N.terms,function(H){return e.evaluate(H)})});return e._formulaValueCache[a.guid()]=d,d}else{var m=n.toNumTerm(a,!0);if(!m){if(r)return!1;var O=String(a).replace(/^-*/,"");throw new Error("No such variable: "+O)}var D=m,z=!1;if(m<0&&(D=-D,z=!0),D<1||D>=s.length){var O=D;if(D>=1&&D<n._num2name.length&&(O=n._num2name[D]),r)return!1;throw new Error("Variable not part of solution: "+O)}var t=s[D];return z&&(t=!t),t}};Logic.Solution.prototype.getWeightedSum=function(o,e){checkWeightedSumArgs(o,e);var t=0;if(typeof e=="number")for(var n=0;n<o.length;n++)t+=e*(this.evaluate(o[n])?1:0);else for(var n=0;n<o.length;n++)t+=e[n]*(this.evaluate(o[n])?1:0);return t};var getNonZeroWeightedTerms=function(o,e){if(typeof e=="number")return e?o:[];for(var t=[],n=0;n<o.length;n++)e[n]&&t.push(o[n]);return t},minMaxWS=function(o,e,t,n,r,s){var a=e,l=a.getWeightedSum(t,n),d=r&&r.formula,c=d||Logic.weightedSum(t,n),y=r&&r.progress,m=r&&r.strategy,O=null;if(s&&l>0){y&&y("trying",0);var D=null;O=getNonZeroWeightedTerms(t,n);var D=o.solveAssuming(Logic.not(Logic.or(O)));D&&(a=D,l=0)}if(s&&m==="bottom-up")for(var z=1;z<l;z++){y&&y("trying",z);var w=Logic.equalBits(c,Logic.constantBits(z)),N=o.solveAssuming(w);if(N){a=N,l=z;break}}else{if(m&&m!=="default")throw new Error("Bad strategy: "+m);m="default"}if(m==="default")for(;!s||l>0;){y&&y("improving",l);var H=(s?Logic.lessThan:Logic.greaterThan)(c,Logic.constantBits(l)),N=o.solveAssuming(H);if(!N)break;o.require(H),a=N,l=a.getWeightedSum(t,n)}return s&&l===0?(O||(O=getNonZeroWeightedTerms(t,n)),o.forbid(O)):o.require(Logic.equalBits(c,Logic.constantBits(l))),y&&y("finished",l),a};Logic.Solver.prototype.minimizeWeightedSum=function(o,e,t,n){return minMaxWS(this,o,e,t,n,!0)};Logic.Solver.prototype.maximizeWeightedSum=function(o,e,t,n){return minMaxWS(this,o,e,t,n,!1)};const Logic$1=Logic;class MaximumSolverIterationsError extends Error{constructor(){super("Too many iterations!")}}const getSolvedPuzzle=(o,e,t)=>{const n=e.clone();for(const r of t)n.setEdgeState(r,EdgeState.BLACK);return finalStateSolve(o,n),{board:o,cleanState:e,solvedState:n,blackEdges:new Set(t)}},getSolvablePropertyPuzzle=(o,e)=>{try{if(simpleRegionIsSolved(e))return{board:o,stateProperty:new Property(e),solution:getSolvedPuzzle(o,e,[])};const t=satSolve(o,e,{maxIterations:1e4,failOnMultipleSolutions:!0});if(t.length!==1)return null;const n=t[0],r=e.clone();for(const s of n)r.setEdgeState(s,EdgeState.BLACK);return finalStateSolve(o,r),assertEnabled()&&assert$2(simpleRegionIsSolved(r)),{board:o,stateProperty:new Property(e),solution:getSolvedPuzzle(o,e,n)}}catch(t){if(t instanceof MultipleSolutionsError)return null;throw t}},satSolve=(o,e,t)=>{const n=o.edges.filter(Ae=>e.getEdgeState(Ae)===EdgeState.BLACK),r=o.edges.filter(Ae=>e.getEdgeState(Ae)===EdgeState.WHITE);assertEnabled()&&assert$2(r.length,"Need to have at least some undefined edges to use solver");const s=new Set(r),a=new Map(r.map((Ae,W)=>[Ae,`edge${W+1}`])),l=new Map(r.map((Ae,W)=>[`edge${W+1}`,Ae])),d=new Logic$1.Solver,c=Ae=>{const W=a.get(Ae);return assertEnabled()&&assert$2(W!==void 0,"Edge not found!"),W},y=Ae=>`-${c(Ae)}`,m=Ae=>{for(const W of Ae)d.require(Logic$1.not(c(W)))},O=Ae=>{d.require(Logic$1.or(...Ae.map(c)))},D=Ae=>{d.require(Logic$1.or(...Ae.map(y)))},z=(Ae,W)=>{W>0&&(O(Ae),Combination.forEachCombination(Ae,J=>{J.length===Ae.length-W+1&&d.require(Logic$1.not(Logic$1.and(...J.map(y))))}))},w=(Ae,W)=>{Combination.forEachCombination(Ae,J=>{J.length===W+1&&d.require(Logic$1.or(...J.map(y)))})},N=Ae=>{d.require(Logic$1.not(Logic$1.exactlyOne(...Ae.map(c))))},H=Ae=>{w(Ae,2),N(Ae)},X=(Ae,W)=>{W===0?m(Ae):(z(Ae,W),w(Ae,W))};O(r);for(const Ae of o.vertices){let W=0,J=0,Ue=[];for(const gt of Ae.edges){const Te=e.getEdgeState(gt);Te===EdgeState.BLACK?W++:Te===EdgeState.WHITE&&(J++,Ue.push(gt))}J!==0&&(W===0?H(Ue):W===1?X(Ue,1):m(Ue))}let ae=!1;for(const Ae of o.faces){const W=e.getFaceValue(Ae);if(W===null)continue;ae=!0;let J=0,Ue=0,gt=[];for(const Et of Ae.edges){const Bt=e.getEdgeState(Et);Bt===EdgeState.BLACK?J++:Bt===EdgeState.WHITE&&(Ue++,gt.push(Et))}if(Ue===0)continue;const Te=Math.max(W-J,0);X(gt,Te)}assertEnabled()&&assert$2(ae,"No faces with values!");const oe=()=>{let Ae=null;return Logic$1.disablingAssertions(()=>{Ae=d.solve()}),Ae?Ae.getTrueVars().map(J=>l.get(J)):null};let ue=0;const fe=()=>{const Ae=oe();if(Ae===null)return{touchingValueLoops:[],nonTouchingValueLoops:[]};const W=new Set([...Ae,...n]),J=[],Ue=[];for(;W.size;){const gt=W.values().next().value,Te=[];let Et=gt.end,Bt=gt,Ke=!1;for(;Bt;)W.delete(Bt),Te.push(Bt),Ke=Ke||Bt.faces.some(At=>e.getFaceValue(At)!==null),Bt=Et.edges.find(At=>W.has(At))??null,Bt&&(Et=Bt.getOtherVertex(Et));assertEnabled()&&assert$2(Te[0].vertices.some(At=>Te[Te.length-1].vertices.includes(At)),"Loop is not a loop!"),(Ke?J:Ue).push(Te)}return{touchingValueLoops:J,nonTouchingValueLoops:Ue}},be=[];for(;;){const Ae=fe();if(!Ae.touchingValueLoops.length)break;if(Ae.touchingValueLoops.length===1&&(be.push(Ae.touchingValueLoops[0]),be.length>1&&t.failOnMultipleSolutions))throw new MultipleSolutionsError(be);const W=[...Ae.touchingValueLoops,...Ae.nonTouchingValueLoops];for(const J of W)D(J.filter(Ue=>s.has(Ue)));if(ue++,ue>t.maxIterations)throw new MaximumSolverIterationsError}return be};class EdgeStateValidator{constructor(e,t,n){ut(this,"edgeStateChangedEmitter",new TinyEmitter);this.board=e,this.currentState=t,this.solvedState=n}getEdgeState(e){return this.currentState.getEdgeState(e)}setEdgeState(e,t){if(assertEnabled()&&assert$2(this.board.edges.includes(e)),t!==EdgeState.WHITE){const n=this.solvedState.getEdgeState(e);if(t!==n)throw new InvalidStateError(`Attempt to make edge ${t} when it should be ${n}`)}}clone(){return this}createDelta(){return this}serializeState(e){throw new Error("unimplemented")}}class FaceColorValidator{constructor(e,t,n){ut(this,"faceColorsChangedEmitter",new TinyEmitter);this.board=e,this.currentState=t,this.solvedState=n}getFaceColors(){return this.currentState.getFaceColors()}getInsideColor(){return this.currentState.getInsideColor()}getOutsideColor(){return this.currentState.getOutsideColor()}getFaceColor(e){return this.currentState.getFaceColor(e)}getFacesWithColor(e){return this.currentState.getFacesWithColor(e)}getFaceColorMap(){return this.currentState.getFaceColorMap()}getOppositeFaceColor(e){return this.currentState.getOppositeFaceColor(e)}hasInvalidFaceColors(){return this.currentState.hasInvalidFaceColors()}modifyFaceColors(e,t,n,r,s){if(s)throw new InvalidStateError("invalid face color?");const a=new Set([...n.values(),...r.keys(),...n.values()]),l=new Map(this.currentState.getFaceColorMap());for(const y of n.keys())l.set(y,n.get(y));const d=y=>r.has(y)?r.get(y):[...e].includes(y)?this.currentState.getOppositeFaceColor(y):null,c=new Map;for(const y of l.keys()){const m=l.get(y);c.has(m)||c.set(m,new Set([y])),c.get(m).add(y)}for(const y of a){const m=c.get(y);if(!m)continue;const O=[...m];assertEnabled()&&assert$2(O.length>0);const D=this.solvedState.getFaceColor(O[0]);for(const w of O)if(this.solvedState.getFaceColor(w)!==D)throw new InvalidStateError("invalid face color");const z=d(y);if(z){let w;if(z.colorState===FaceColorState.INSIDE?w=this.solvedState.getInsideColor():z.colorState===FaceColorState.OUTSIDE?w=this.solvedState.getOutsideColor():w=this.solvedState.getFaceColor([...c.get(z)][0]),D===w)throw new InvalidStateError("opposite colors are the same")}}}clone(){return this}createDelta(){return this}serializeState(e){throw new Error("unimplemented")}}class SimpleRegionValidator{constructor(e,t,n){ut(this,"simpleRegionsChangedEmitter",new TinyEmitter);this.board=e,this.currentState=t,this.solvedState=n}getSimpleRegions(){return this.currentState.getSimpleRegions()}getSimpleRegionWithVertex(e){return this.currentState.getSimpleRegionWithVertex(e)}getSimpleRegionWithEdge(e){return this.currentState.getSimpleRegionWithEdge(e)}getSimpleRegionWithId(e){return this.currentState.getSimpleRegionWithId(e)}getWeirdEdges(){return this.currentState.getWeirdEdges()}modifyRegions(e,t,n,r){if([...n].length)throw new InvalidStateError("weird edges added")}clone(){return this}createDelta(){return this}serializeState(e){throw new Error("unimplemented")}}class FaceValueValidator{constructor(e,t,n){ut(this,"faceValueChangedEmitter",new TinyEmitter);this.board=e,this.currentState=t,this.solvedState=n}getFaceValue(e){return this.currentState.getFaceValue(e)}setFaceValue(e,t){if(this.solvedState.getFaceValue(e)!==t)throw new InvalidStateError("invalid face state")}clone(){return this}createDelta(){return this}serializeState(e){throw new Error("unimplemented")}}class SectorStateValidator{constructor(e,t,n){ut(this,"sectorStateChangedEmitter",new TinyEmitter);this.board=e,this.currentState=t,this.solvedState=n}getSectorState(e){return this.currentState.getSectorState(e)}setSectorState(e,t){assertEnabled()&&assert$2(this.board.halfEdges.includes(e));const n=this.solvedState.getSectorState(e);if(!n.isSubsetOf(t))throw new InvalidStateError(`Attempt to make sector ${t} when it should be ${n}`)}clone(){return this}createDelta(){return this}serializeState(e){throw new Error("unimplemented")}}class VertexStateValidator{constructor(e,t,n){ut(this,"vertexStateChangedEmitter",new TinyEmitter);this.board=e,this.currentState=t,this.solvedState=n}getVertexState(e){return this.currentState.getVertexState(e)}setVertexState(e,t){assertEnabled()&&assert$2(this.board.vertices.includes(e));const n=this.solvedState.getVertexState(e);if(!n.isSubsetOf(t))throw new InvalidStateError(`Attempt to make vertex ${t} when it should be ${n}`);const r=this.currentState.getVertexState(e);if(!t.isSubsetOf(r))throw new InvalidStateError("Do not generalize vertex state")}clone(){return this}createDelta(){return this}serializeState(e){throw new Error("unimplemented")}}class FaceStateValidator{constructor(e,t,n){ut(this,"faceStateChangedEmitter",new TinyEmitter);this.board=e,this.currentState=t,this.solvedState=n}getFaceState(e){return this.currentState.getFaceState(e)}setFaceState(e,t){assertEnabled()&&assert$2(this.board.faces.includes(e));const n=this.solvedState.getFaceState(e);if(!n.isSubsetOf(t))throw new InvalidStateError(`Attempt to make face ${t} when it should be ${n}`);const r=this.currentState.getFaceState(e);if(!t.isSubsetOf(r))throw new InvalidStateError("Do not generalize face state")}clone(){return this}createDelta(){return this}serializeState(e){throw new Error("unimplemented")}}class CompleteValidator{constructor(e,t,n){ut(this,"anyStateChangedEmitter",new TinyEmitter);ut(this,"edgeStateValidator");ut(this,"faceValueValidator");ut(this,"simpleRegionDataValidator");ut(this,"faceColorValidator");ut(this,"sectorStateValidator");ut(this,"vertexStateValidator");ut(this,"faceStateValidator");assertEnabled()&&assert$2(e),assertEnabled()&&assert$2(n),this.edgeStateValidator=new EdgeStateValidator(e,t,n),this.faceValueValidator=new FaceValueValidator(e,t,n),this.simpleRegionDataValidator=new SimpleRegionValidator(e,t,n),this.faceColorValidator=new FaceColorValidator(e,t,n),this.sectorStateValidator=new SectorStateValidator(e,t,n),this.vertexStateValidator=new VertexStateValidator(e,t,n),this.faceStateValidator=new FaceStateValidator(e,t,n)}getFaceValue(e){return this.faceValueValidator.getFaceValue(e)}setFaceValue(e,t){this.faceValueValidator.setFaceValue(e,t)}get faceValueChangedEmitter(){return this.faceValueValidator.faceValueChangedEmitter}getEdgeState(e){return this.edgeStateValidator.getEdgeState(e)}setEdgeState(e,t){this.edgeStateValidator.setEdgeState(e,t)}get edgeStateChangedEmitter(){return this.edgeStateValidator.edgeStateChangedEmitter}getSimpleRegions(){return this.simpleRegionDataValidator.getSimpleRegions()}getSimpleRegionWithVertex(e){return this.simpleRegionDataValidator.getSimpleRegionWithVertex(e)}getSimpleRegionWithEdge(e){return this.simpleRegionDataValidator.getSimpleRegionWithEdge(e)}getSimpleRegionWithId(e){return this.simpleRegionDataValidator.getSimpleRegionWithId(e)}getWeirdEdges(){return this.simpleRegionDataValidator.getWeirdEdges()}modifyRegions(e,t,n,r){this.simpleRegionDataValidator.modifyRegions(e,t,n,r)}get simpleRegionsChangedEmitter(){return this.simpleRegionDataValidator.simpleRegionsChangedEmitter}getFaceColors(){return this.faceColorValidator.getFaceColors()}getInsideColor(){return this.faceColorValidator.getInsideColor()}getOutsideColor(){return this.faceColorValidator.getOutsideColor()}getFaceColor(e){return this.faceColorValidator.getFaceColor(e)}getFacesWithColor(e){return this.faceColorValidator.getFacesWithColor(e)}getFaceColorMap(){return this.faceColorValidator.getFaceColorMap()}getOppositeFaceColor(e){return this.faceColorValidator.getOppositeFaceColor(e)}hasInvalidFaceColors(){return this.faceColorValidator.hasInvalidFaceColors()}modifyFaceColors(e,t,n,r,s){this.faceColorValidator.modifyFaceColors(e,t,n,r,s)}get faceColorsChangedEmitter(){return this.faceColorValidator.faceColorsChangedEmitter}getSectorState(e){return this.sectorStateValidator.getSectorState(e)}setSectorState(e,t){this.sectorStateValidator.setSectorState(e,t)}get sectorStateChangedEmitter(){return this.sectorStateValidator.sectorStateChangedEmitter}getVertexState(e){return this.vertexStateValidator.getVertexState(e)}setVertexState(e,t){this.vertexStateValidator.setVertexState(e,t)}get vertexStateChangedEmitter(){return this.vertexStateValidator.vertexStateChangedEmitter}getFaceState(e){return this.faceStateValidator.getFaceState(e)}setFaceState(e,t){this.faceStateValidator.setFaceState(e,t)}get faceStateChangedEmitter(){return this.faceStateValidator.faceStateChangedEmitter}clone(){return this}createDelta(){return this}serializeState(e){throw new Error("unimplemented")}}const fn=class fn extends EnumerationValue{constructor(e,t,n){super(),this.fromWhite=e,this.fromBlack=t,this.fromRed=n}apply(e){return e===EdgeState.WHITE?this.fromWhite:e===EdgeState.BLACK?this.fromBlack:this.fromRed}};ut(fn,"CYCLE",new fn(EdgeState.BLACK,EdgeState.RED,EdgeState.WHITE)),ut(fn,"REVERSE_CYCLE",new fn(EdgeState.RED,EdgeState.WHITE,EdgeState.BLACK)),ut(fn,"WHITE_SET",new fn(EdgeState.WHITE,EdgeState.WHITE,EdgeState.WHITE)),ut(fn,"BLACK_SET",new fn(EdgeState.BLACK,EdgeState.BLACK,EdgeState.BLACK)),ut(fn,"RED_SET",new fn(EdgeState.RED,EdgeState.RED,EdgeState.RED)),ut(fn,"BLACK_TOGGLE",new fn(EdgeState.BLACK,EdgeState.WHITE,EdgeState.BLACK)),ut(fn,"RED_TOGGLE",new fn(EdgeState.RED,EdgeState.RED,EdgeState.WHITE)),ut(fn,"enumeration",new Enumeration(fn));let EdgePressStyle=fn;const pressStyle0Property=new LocalStorageEnumerationProperty("pressStyle0",EdgePressStyle.CYCLE),pressStyle1Property=new LocalStorageEnumerationProperty("pressStyle1",EdgePressStyle.WHITE_SET),pressStyle2Property=new LocalStorageEnumerationProperty("pressStyle2",EdgePressStyle.REVERSE_CYCLE),getPressStyle=o=>{switch(o){case 0:return pressStyle0Property.value;case 1:return pressStyle1Property.value;case 2:return pressStyle2Property.value}},uiHintUsesBuiltInSolveProperty=new LocalStorageBooleanProperty("uiHintUsesBuiltInSolve",!1),showUndoRedoAllProperty=new LocalStorageBooleanProperty("showUndoRedoAllProperty",!1);class PuzzleModel extends Disposable{constructor(t){super();ut(this,"stack");ut(this,"stackLengthProperty",new NumberProperty(0));ut(this,"stackPositionProperty",new NumberProperty(0));ut(this,"undoPossibleProperty");ut(this,"redoPossibleProperty");ut(this,"currentSnapshotProperty");ut(this,"hasErrorProperty");ut(this,"isSolvedProperty");ut(this,"pendingHintActionProperty",new Property(null));ut(this,"displayedAnnotationProperty");ut(this,"pendingActionFaceColorProperty",new Property(null));ut(this,"pendingActionSectorProperty",new Property(null));ut(this,"hoverEdgeProperty",new Property(null));ut(this,"hoverFaceProperty",new Property(!1));ut(this,"hoverSectorProperty",new Property(null));ut(this,"hoverHighlightProperty");ut(this,"selectedFaceColorHighlightProperty");ut(this,"selectedSectorEditProperty");this.puzzle=t,this.displayedAnnotationProperty=new DerivedProperty([this.pendingHintActionProperty],r=>r?r.annotation:null);const n=()=>{this.pendingActionFaceColorProperty.value=null,this.pendingActionSectorProperty.value=null};this.stackPositionProperty.lazyLink(n),editModeProperty.lazyLink(n),this.disposeEmitter.addListener(()=>editModeProperty.unlink(n)),this.selectedFaceColorHighlightProperty=new DerivedProperty([t.stateProperty,editModeProperty,this.pendingActionFaceColorProperty],(r,s,a)=>{if((s===EditMode.FACE_COLOR_MATCH||s===EditMode.FACE_COLOR_OPPOSITE)&&a){const l=r.getFacesWithColor(a.color);return{faceColor:a.color,face:a.face,faces:l}}return null}),this.disposeEmitter.addListener(()=>this.selectedFaceColorHighlightProperty.dispose()),this.selectedSectorEditProperty=new DerivedProperty([t.stateProperty,editModeProperty,this.pendingActionSectorProperty],(r,s,a)=>s===EditMode.SECTOR_STATE&&a?{sector:a,currentState:r.getSectorState(a)}:null),this.disposeEmitter.addListener(()=>this.selectedSectorEditProperty.dispose()),this.hoverHighlightProperty=new DerivedProperty([t.stateProperty,editModeProperty,this.hoverEdgeProperty,this.hoverFaceProperty,this.hoverSectorProperty,showHoverHighlightsProperty],(r,s,a,l,d,c)=>{if(s===EditMode.EDGE_STATE||s===EditMode.EDGE_STATE_REVERSED)if(a&&c){const y=r.getEdgeState(a),m=this.getNewEdgeState(y,s===EditMode.EDGE_STATE_REVERSED?2:0);return{type:"edge-state",edge:a,simpleRegion:y===EdgeState.BLACK?r.getSimpleRegionWithEdge(a):null,potentialEdgeState:m}}else return null;else if(s===EditMode.FACE_COLOR_MATCH||s===EditMode.FACE_COLOR_OPPOSITE)if(l!==!1&&c){const y=l?this.puzzle.stateProperty.value.getFaceColor(l):this.puzzle.stateProperty.value.getOutsideColor(),m=this.puzzle.stateProperty.value.getFacesWithColor(y);return{type:"face-color",faceColor:y,face:l,faces:m}}else return null;else return s===EditMode.SECTOR_STATE&&d&&c?{type:"sector",sector:d}:null}),this.disposeEmitter.addListener(()=>this.hoverHighlightProperty.dispose());{const r=t.stateProperty.value.clone();safeSolve(t.board,r),t.stateProperty.value=r}this.stack=[new PuzzleSnapshot(this.puzzle.board,null,t.stateProperty.value)],this.stackLengthProperty.value=1,this.currentSnapshotProperty=new DerivedProperty([this.stackLengthProperty,this.stackPositionProperty],()=>this.stack[this.stackPositionProperty.value]),this.hasErrorProperty=new DerivedProperty([this.currentSnapshotProperty],r=>r.errorDetected),this.isSolvedProperty=new DerivedProperty([this.currentSnapshotProperty],r=>{if(r.state.getWeirdEdges().length||r.state.hasInvalidFaceColors())return!1;const s=r.state.getSimpleRegions();return s.length===1&&s[0].isSolved}),this.addAutoSolveDelta(),this.updateState(),this.undoPossibleProperty=new DerivedProperty([this.stackPositionProperty],r=>r>0),this.redoPossibleProperty=new DerivedProperty([this.stackPositionProperty,this.stackLengthProperty],(r,s)=>r<s-1),autoSolverFactoryProperty.lazyLink(()=>this.onAutoSolveChange())}updateState(){this.pendingHintActionProperty.value=null,this.puzzle.stateProperty.value=this.stack[this.stackPositionProperty.value].state,setTimeout(()=>{localStorage.setItem("puzzleString",puzzleToCompressedString(this.puzzle))},0)}wipeStackTop(){for(;this.stack.length>this.stackPositionProperty.value+1;)this.stack.pop();this.stackLengthProperty.value=this.stack.length}pushTransitionAtCurrentPosition(t){this.wipeStackTop(),this.stack.push(t),this.stackLengthProperty.value=this.stack.length,this.stackPositionProperty.value++}applyUserActionToStack(t,n){const s=this.stack[this.stackPositionProperty.value].state;let a=!1;const l=new CompleteValidator(this.puzzle.board,s,this.puzzle.solution.solvedState);try{t.apply(l)}catch{a=!0}let d=s.createDelta();try{if(withSolverFactory(autoSolverFactoryProperty.value,this.puzzle.board,d,()=>{t.apply(d)},t instanceof UserLoadPuzzleAutoSolveAction),n&&!n(d))throw new InvalidStateError("Auto-solver did not respect user action")}catch(y){if(a=!0,y instanceof InvalidStateError)console.log("error"),d=s.createDelta(),withSolverFactory(safeSolverFactory,this.puzzle.board,d,()=>{t.apply(d)},t instanceof UserLoadPuzzleAutoSolveAction);else throw y}const c=s.clone();d.apply(c),this.pushTransitionAtCurrentPosition(new PuzzleSnapshot(this.puzzle.board,t,c,a))}addAutoSolveDelta(){const t=this.puzzle.stateProperty.value.createDelta();try{if(iterateSolverFactory(autoSolverFactoryProperty.value,this.puzzle.board,t,!0),!t.isEmpty()){const n=this.puzzle.stateProperty.value.clone();t.apply(n),this.pushTransitionAtCurrentPosition(new PuzzleSnapshot(this.puzzle.board,new UserLoadPuzzleAutoSolveAction,n))}}catch(n){if(!(n instanceof InvalidStateError))throw n}}onAutoSolveChange(){const t=this.stack[this.stackPositionProperty.value];t.action&&this.stackPositionProperty.value--,this.applyUserActionToStack(t.action||new UserLoadPuzzleAutoSolveAction),this.updateState()}onUserUndo(){this.stackPositionProperty.value>0&&(this.stackPositionProperty.value--,this.updateState())}onUserRedo(){this.stackPositionProperty.value<this.stackLengthProperty.value-1&&(this.stackPositionProperty.value++,this.updateState())}onUserUndoAll(){this.stackPositionProperty.value>0&&(this.stackPositionProperty.value=0,this.updateState())}onUserRedoAll(){this.stackPositionProperty.value<this.stackLengthProperty.value-1&&(this.stackPositionProperty.value=this.stackLengthProperty.value-1,this.updateState())}onUserEscape(){this.pendingActionFaceColorProperty.value=null,this.pendingActionSectorProperty.value=null}getNewEdgeState(t,n){const r=editModeProperty.value===EditMode.EDGE_STATE_REVERSED;return getPressStyle(r?2-n:n).apply(t)}onUserEdgePress(t,n){const r=this.puzzle.stateProperty.value.getEdgeState(t),s=this.getNewEdgeState(r,n);if(r!==s){const a=this.stack[this.stackPositionProperty.value];a.action&&a.action instanceof EdgeStateSetAction&&a.action.edge===t&&this.stackPositionProperty.value--;const l=new EdgeStateSetAction(t,s);this.applyUserActionToStack(l,d=>d.getEdgeState(t)===s),this.updateState()}}onUserFacePress(t,n){let r=editModeProperty.value===EditMode.FACE_COLOR_MATCH;n===2&&(r=!r);const s=t?this.puzzle.stateProperty.value.getFaceColor(t):this.puzzle.stateProperty.value.getOutsideColor(),a=this.pendingActionFaceColorProperty.value;if(a){if(t!==a.face){const l=a.color;l!==s&&(r?this.applyUserActionToStack(new FaceColorMakeSameAction(getFaceColorPointer(this.puzzle.stateProperty.value,s),getFaceColorPointer(this.puzzle.stateProperty.value,l))):this.applyUserActionToStack(new FaceColorMakeOppositeAction(getFaceColorPointer(this.puzzle.stateProperty.value,s),getFaceColorPointer(this.puzzle.stateProperty.value,l))))}this.pendingActionFaceColorProperty.value=null,this.updateState()}else this.pendingActionFaceColorProperty.value={face:t,color:s}}onUserSectorPress(t,n){this.pendingActionSectorProperty.value=t}onUserSectorSet(t,n){this.applyUserActionToStack(new SectorStateSetAction(t,n)),this.pendingActionSectorProperty.value=null,this.updateState()}onUserEdgeHover(t,n){n?this.hoverEdgeProperty.value=t:this.hoverEdgeProperty.value=null}onUserFaceHover(t,n){n?this.hoverFaceProperty.value=t:this.hoverFaceProperty.value=!1}onUserSectorHover(t,n){n?this.hoverSectorProperty.value=t:this.hoverSectorProperty.value=null}onUserRequestSolve(){const t=this.puzzle.stateProperty.value;if(!simpleRegionIsSolved(t))if(uiHintUsesBuiltInSolveProperty.value){const n=t.clone();iterateSolverFactory(standardSolverFactory,this.puzzle.board,n,!0),this.pushTransitionAtCurrentPosition(new PuzzleSnapshot(this.puzzle.board,new UserRequestSolveAction,n,!1)),this.updateState()}else{const n=satSolve(this.puzzle.board,this.puzzle.stateProperty.value,{maxIterations:1e4,failOnMultipleSolutions:!0});if(n.length===1){const r=this.puzzle.stateProperty.value.clone();n[0].forEach(s=>{r.setEdgeState(s,EdgeState.BLACK)}),safeSolve(this.puzzle.board,r),this.pushTransitionAtCurrentPosition(new PuzzleSnapshot(this.puzzle.board,new UserRequestSolveAction,r,!1)),this.updateState()}else n.length===0?console.log("No solution found"):console.log("Multiple solution found?!?")}}onUserRequestHint(){if(this.pendingHintActionProperty.value){const t=this.pendingHintActionProperty.value;this.pendingHintActionProperty.value=null,this.applyUserActionToStack(new UserPuzzleHintApplyAction(t)),this.updateState()}else{const t=this.puzzle.stateProperty.value.clone(),n=standardSolverFactory(this.puzzle.board,t);try{const r=n.nextAction();if(r){const s=new CompleteValidator(this.puzzle.board,t,this.puzzle.solution.solvedState);let a=!0;try{r.apply(s)}catch(l){if(l instanceof InvalidStateError)a=!1;else throw l}console.log(a?"valid":"INVALID",r),this.pendingHintActionProperty.value=r}else console.log("no action")}catch(r){if(r instanceof InvalidStateError)console.error(r);else throw r}}}}class UserLoadPuzzleAutoSolveAction extends NoOpAction{constructor(){super(...arguments);ut(this,"isUserLoadPuzzleAutoSolveAction",!0)}serializeAction(){return{type:"UserLoadPuzzleAutoSolveAction"}}static deserializeAction(t,n){return new UserLoadPuzzleAutoSolveAction}}class UserRequestSolveAction extends NoOpAction{constructor(){super(...arguments);ut(this,"isUserRequestSolveAction",!0)}serializeAction(){return{type:"UserRequestSolveAction"}}static deserializeAction(t,n){return new UserRequestSolveAction}}class UserPuzzleHintApplyAction{constructor(e){this.hintAction=e}get annotation(){return this.hintAction.annotation}apply(e){this.hintAction.apply(e)}getUndo(e){throw new Error("unimplemented")}isEmpty(){return this.hintAction.isEmpty()}serializeAction(){throw new Error("unimplemented")}static deserializeAction(e,t){throw new Error("unimplemented")}}class PuzzleSnapshot{constructor(e,t,n,r=!1){this.board=e,this.action=t,this.state=n,this.errorDetected=r}}const deserializeAction=(o,e)=>{const t=e.type;if(t==="CompositeAction")return CompositeAction.deserializeAction(o,e);if(t==="CompleteAction")return CompleteAction.deserializeAction(o,e);if(t==="EdgeStateCycleAction")return EdgeStateCycleAction.deserializeAction(o,e);if(t==="EdgeStateSetAction")return EdgeStateSetAction.deserializeAction(o,e);if(t==="GeneralEdgeAction")return GeneralEdgeStateAction.deserializeAction(o,e);if(t==="FaceValueSetAction")return FaceValueSetAction.deserializeAction(o,e);if(t==="GeneralFaceAction")return GeneralFaceValueAction.deserializeAction(o,e);if(t==="GeneralSimpleRegionAction")return GeneralSimpleRegionAction.deserializeAction(o,e);if(t==="NoOpAction")return NoOpAction.deserializeAction(o,e);if(t==="UserLoadPuzzleAutoSolveAction")return UserLoadPuzzleAutoSolveAction.deserializeAction(o,e);if(t==="UserRequestSolveAction")return UserRequestSolveAction.deserializeAction(o,e);throw new Error(`Unknown action type: ${t}, could not deserialize`)};class CompleteAction{constructor(e,t,n,r,s,a,l){this.faceValueAction=e,this.edgeStateAction=t,this.simpleRegionAction=n,this.faceColorAction=r,this.sectorStateAction=s,this.vertexStateAction=a,this.faceStateAction=l}apply(e){this.faceValueAction.apply(e),this.edgeStateAction.apply(e),this.simpleRegionAction.apply(e),this.faceColorAction.apply(e),this.sectorStateAction.apply(e),this.vertexStateAction.apply(e),this.faceStateAction.apply(e)}getUndo(e){return new CompleteAction(this.faceValueAction.getUndo(e),this.edgeStateAction.getUndo(e),this.simpleRegionAction.getUndo(e),this.faceColorAction.getUndo(e),this.sectorStateAction.getUndo(e),this.vertexStateAction.getUndo(e),this.faceStateAction.getUndo(e))}isEmpty(){return this.faceValueAction.isEmpty()&&this.edgeStateAction.isEmpty()&&this.simpleRegionAction.isEmpty()&&this.faceColorAction.isEmpty()&&this.sectorStateAction.isEmpty()&&this.vertexStateAction.isEmpty()&&this.faceStateAction.isEmpty()}serializeAction(){return{type:"CompleteAction",faceValueAction:this.faceValueAction.serializeAction(),edgeStateAction:this.edgeStateAction.serializeAction(),simpleRegionAction:this.simpleRegionAction.serializeAction(),faceColorAction:this.faceColorAction.serializeAction(),sectorStateAction:this.sectorStateAction.serializeAction(),vertexStateAction:this.vertexStateAction.serializeAction(),faceStateAction:this.faceStateAction.serializeAction()}}static deserializeAction(e,t){return new CompleteAction(deserializeAction(e,t.faceStateAction),deserializeAction(e,t.edgeStateAction),deserializeAction(e,t.simpleRegionAction),deserializeAction(e,t.faceColorAction),deserializeAction(e,t.sectorStateAction),deserializeAction(e,t.vertexStateAction),deserializeAction(e,t.faceStateAction))}}class CompleteDelta extends CompleteAction{constructor(t,n,r,s,a,l,d){super(t,n,r,s,a,l,d);ut(this,"anyStateChangedEmitter",new TinyEmitter);this.faceValueDelta=t,this.edgeStateDelta=n,this.simpleRegionDelta=r,this.faceColorDelta=s,this.sectorStateDelta=a,this.vertexStateDelta=l,this.faceStateDelta=d;const c=()=>this.anyStateChangedEmitter.emit();t.faceValueChangedEmitter.addListener(c),n.edgeStateChangedEmitter.addListener(c),r.simpleRegionsChangedEmitter.addListener(c),s.faceColorsChangedEmitter.addListener(c),a.sectorStateChangedEmitter.addListener(c),l.vertexStateChangedEmitter.addListener(c),d.faceStateChangedEmitter.addListener(c)}getFaceValue(t){return this.faceValueDelta.getFaceValue(t)}setFaceValue(t,n){this.faceValueDelta.setFaceValue(t,n)}get faceValueChangedEmitter(){return this.faceValueDelta.faceValueChangedEmitter}getEdgeState(t){return this.edgeStateDelta.getEdgeState(t)}setEdgeState(t,n){this.edgeStateDelta.setEdgeState(t,n)}get edgeStateChangedEmitter(){return this.edgeStateDelta.edgeStateChangedEmitter}getSimpleRegions(){return this.simpleRegionDelta.getSimpleRegions()}getSimpleRegionWithVertex(t){return this.simpleRegionDelta.getSimpleRegionWithVertex(t)}getSimpleRegionWithEdge(t){return this.simpleRegionDelta.getSimpleRegionWithEdge(t)}getSimpleRegionWithId(t){return this.simpleRegionDelta.getSimpleRegionWithId(t)}getWeirdEdges(){return this.simpleRegionDelta.getWeirdEdges()}modifyRegions(t,n,r,s){this.simpleRegionDelta.modifyRegions(t,n,r,s)}get simpleRegionsChangedEmitter(){return this.simpleRegionDelta.simpleRegionsChangedEmitter}getFaceColors(){return this.faceColorDelta.getFaceColors()}getInsideColor(){return this.faceColorDelta.getInsideColor()}getOutsideColor(){return this.faceColorDelta.getOutsideColor()}getFaceColor(t){return this.faceColorDelta.getFaceColor(t)}getFacesWithColor(t){return this.faceColorDelta.getFacesWithColor(t)}getFaceColorMap(){return this.faceColorDelta.getFaceColorMap()}getOppositeFaceColor(t){return this.faceColorDelta.getOppositeFaceColor(t)}hasInvalidFaceColors(){return this.faceColorDelta.hasInvalidFaceColors()}modifyFaceColors(t,n,r,s,a){this.faceColorDelta.modifyFaceColors(t,n,r,s,a)}get faceColorsChangedEmitter(){return this.faceColorDelta.faceColorsChangedEmitter}getSectorState(t){return this.sectorStateDelta.getSectorState(t)}setSectorState(t,n){this.sectorStateDelta.setSectorState(t,n)}get sectorStateChangedEmitter(){return this.sectorStateDelta.sectorStateChangedEmitter}getVertexState(t){return this.vertexStateDelta.getVertexState(t)}setVertexState(t,n){this.vertexStateDelta.setVertexState(t,n)}get vertexStateChangedEmitter(){return this.vertexStateDelta.vertexStateChangedEmitter}getFaceState(t){return this.faceStateDelta.getFaceState(t)}setFaceState(t,n){this.faceStateDelta.setFaceState(t,n)}get faceStateChangedEmitter(){return this.faceStateDelta.faceStateChangedEmitter}clone(){return new CompleteDelta(this.faceValueDelta.clone(),this.edgeStateDelta.clone(),this.simpleRegionDelta.clone(),this.faceColorDelta.clone(),this.sectorStateDelta.clone(),this.vertexStateDelta.clone(),this.faceStateDelta.clone())}createDelta(){return new CompleteDelta(this.faceValueDelta.createDelta(),this.edgeStateDelta.createDelta(),this.simpleRegionDelta.createDelta(),this.faceColorDelta.createDelta(),this.sectorStateDelta.createDelta(),this.vertexStateDelta.createDelta(),this.faceStateDelta.createDelta())}serializeState(t){return serializeCompleteData(t,this)}}class GeneralSectorStateAction{constructor(e,t=new Map){this.board=e,this.sectorStateMap=t}apply(e){for(const[t,n]of this.sectorStateMap)e.setSectorState(t,n)}getUndo(e){const t=new Map;for(const n of this.sectorStateMap.keys())t.set(n,e.getSectorState(n));return new GeneralSectorStateAction(this.board,t)}isEmpty(){return this.sectorStateMap.size===0}serializeAction(){return{type:"GeneralSectorAction",sectors:Array.from(this.sectorStateMap.entries()).map(([e,t])=>({sector:serializeHalfEdge(e),state:t.serialize()}))}}static deserializeAction(e,t){return new GeneralSectorStateAction(e,new Map(t.sectors.map(n=>[deserializeHalfEdge(e,n.sector),SectorState.deserialize(n.state)])))}}class GeneralSectorStateDelta extends GeneralSectorStateAction{constructor(t,n,r=new Map){super(t,r);ut(this,"sectorStateChangedEmitter",new TinyEmitter);this.parentState=n}getSectorState(t){return this.sectorStateMap.has(t)?this.sectorStateMap.get(t):this.parentState.getSectorState(t)}setSectorState(t,n){const r=this.getSectorState(t);r!==n&&(this.sectorStateMap.set(t,n),this.sectorStateChangedEmitter.emit(t,n,r))}clone(){return new GeneralSectorStateDelta(this.board,this.parentState,new Map(this.sectorStateMap))}createDelta(){return new GeneralSectorStateDelta(this.board,this,new Map)}serializeState(t){return serializeSectorStateData(t,this)}}class GeneralSectorStateData{constructor(e,t=()=>SectorState.ANY){ut(this,"sectorStateChangedEmitter",new TinyEmitter);ut(this,"sectorStateMap",new Map);this.board=e,e.halfEdges.forEach(n=>{this.sectorStateMap.set(n,t(n))})}getSectorState(e){return assertEnabled()&&assert$2(this.sectorStateMap.has(e)),this.sectorStateMap.get(e)}setSectorState(e,t){assertEnabled()&&assert$2(this.sectorStateMap.has(e));const n=this.sectorStateMap.get(e);n!==t&&(this.sectorStateMap.set(e,t),this.sectorStateChangedEmitter.emit(e,t,n))}clone(){return new GeneralSectorStateData(this.board,e=>this.getSectorState(e))}createDelta(){return new GeneralSectorStateDelta(this.board,this)}serializeState(e){return serializeSectorStateData(e,this)}static deserializeState(e,t){const n=new Map(t.sectors.map(r=>[deserializeHalfEdge(e,r.sector),SectorState.deserialize(r.state)]));return new GeneralSectorStateData(e,r=>n.get(r)??SectorState.ANY)}}class GeneralVertexStateAction{constructor(e,t=new Map){this.board=e,this.vertexStateMap=t}apply(e){for(const[t,n]of this.vertexStateMap)e.setVertexState(t,n)}getUndo(e){const t=new Map;for(const n of this.vertexStateMap.keys())t.set(n,e.getVertexState(n));return new GeneralVertexStateAction(this.board,t)}isEmpty(){return this.vertexStateMap.size===0}serializeAction(){return{type:"GeneralVertexAction",vertices:Array.from(this.vertexStateMap.entries()).map(([e,t])=>({vertex:serializeVertex(e),state:t.serialize()}))}}static deserializeAction(e,t){return new GeneralVertexStateAction(e,new Map(t.vertices.map(n=>[deserializeVertex(e,n.vertex),VertexState.deserialize(deserializeVertex(e,n.vertex),n.state)])))}}class GeneralVertexStateDelta extends GeneralVertexStateAction{constructor(t,n,r=new Map){super(t,r);ut(this,"vertexStateChangedEmitter",new TinyEmitter);this.parentState=n}getVertexState(t){return this.vertexStateMap.has(t)?this.vertexStateMap.get(t):this.parentState.getVertexState(t)}setVertexState(t,n){const r=this.getVertexState(t);r.equals(n)||(this.vertexStateMap.set(t,n),this.vertexStateChangedEmitter.emit(t,n,r))}clone(){return new GeneralVertexStateDelta(this.board,this.parentState,new Map(this.vertexStateMap))}createDelta(){return new GeneralVertexStateDelta(this.board,this,new Map)}serializeState(t){return serializeVertexStateData(t,this)}}class GeneralVertexStateData{constructor(e,t=VertexState.any){ut(this,"vertexStateChangedEmitter",new TinyEmitter);ut(this,"vertexStateMap",new Map);this.board=e,e.vertices.forEach(n=>{this.vertexStateMap.set(n,t(n))})}getVertexState(e){return assertEnabled()&&assert$2(this.vertexStateMap.has(e)),this.vertexStateMap.get(e)}setVertexState(e,t){assertEnabled()&&assert$2(this.vertexStateMap.has(e));const n=this.vertexStateMap.get(e);n.equals(t)||(this.vertexStateMap.set(e,t),this.vertexStateChangedEmitter.emit(e,t,n))}clone(){return new GeneralVertexStateData(this.board,e=>this.getVertexState(e))}createDelta(){return new GeneralVertexStateDelta(this.board,this)}serializeState(e){return serializeVertexStateData(e,this)}static deserializeState(e,t){const n=new Map(t.vertices.map(r=>{const s=deserializeVertex(e,r.vertex);return[s,VertexState.deserialize(s,r.state)]}));return new GeneralVertexStateData(e,r=>n.get(r)??VertexState.any(r))}}class GeneralFaceStateAction{constructor(e,t=new Map){this.board=e,this.faceStateMap=t}apply(e){for(const[t,n]of this.faceStateMap)e.setFaceState(t,n)}getUndo(e){const t=new Map;for(const n of this.faceStateMap.keys())t.set(n,e.getFaceState(n));return new GeneralFaceStateAction(this.board,t)}isEmpty(){return this.faceStateMap.size===0}serializeAction(){return{type:"GeneralFaceAction",faces:Array.from(this.faceStateMap.entries()).map(([e,t])=>({face:serializeFace(e),state:t.serialize()}))}}static deserializeAction(e,t){return new GeneralFaceStateAction(e,new Map(t.faces.map(n=>[deserializeFace(e,n.face),FaceState.deserialize(deserializeFace(e,n.face),n.state)])))}}class GeneralFaceStateDelta extends GeneralFaceStateAction{constructor(t,n,r=new Map){super(t,r);ut(this,"faceStateChangedEmitter",new TinyEmitter);this.parentState=n}getFaceState(t){return this.faceStateMap.has(t)?this.faceStateMap.get(t):this.parentState.getFaceState(t)}setFaceState(t,n){const r=this.getFaceState(t);r.equals(n)||(this.faceStateMap.set(t,n),this.faceStateChangedEmitter.emit(t,n,r))}clone(){return new GeneralFaceStateDelta(this.board,this.parentState,new Map(this.faceStateMap))}createDelta(){return new GeneralFaceStateDelta(this.board,this,new Map)}serializeState(t){return serializeFaceStateData(t,this)}}class GeneralFaceStateData{constructor(e,t){ut(this,"faceStateChangedEmitter",new TinyEmitter);ut(this,"faceStateMap",new Map);this.board=e,e.faces.forEach(n=>{this.faceStateMap.set(n,t(n))})}getFaceState(e){return assertEnabled()&&assert$2(this.faceStateMap.has(e)),this.faceStateMap.get(e)}setFaceState(e,t){assertEnabled()&&assert$2(this.faceStateMap.has(e));const n=this.faceStateMap.get(e);n.equals(t)||(this.faceStateMap.set(e,t),this.faceStateChangedEmitter.emit(e,t,n))}clone(){return new GeneralFaceStateData(this.board,e=>this.getFaceState(e))}createDelta(){return new GeneralFaceStateDelta(this.board,this)}serializeState(e){return serializeFaceStateData(e,this)}static deserializeState(e,t){const n=new Map(t.faces.map(r=>{const s=deserializeFace(e,r.face);return[s,FaceState.deserialize(s,r.state)]}));return new GeneralFaceStateData(e,r=>{const s=n.get(r);return assertEnabled()&&assert$2(s),s})}}class CompleteData{constructor(e,t,n,r,s,a,l){ut(this,"anyStateChangedEmitter",new TinyEmitter);this.faceValueData=e,this.edgeStateData=t,this.simpleRegionData=n,this.faceColorData=r,this.sectorStateData=s,this.vertexStateData=a,this.faceStateData=l;const d=()=>this.anyStateChangedEmitter.emit();e.faceValueChangedEmitter.addListener(d),t.edgeStateChangedEmitter.addListener(d),n.simpleRegionsChangedEmitter.addListener(d),r.faceColorsChangedEmitter.addListener(d),s.sectorStateChangedEmitter.addListener(d),a.vertexStateChangedEmitter.addListener(d),l.faceStateChangedEmitter.addListener(d)}static fromFacesEdges(e,t,n){const r=new GeneralFaceValueData(e,t);return new CompleteData(r,new GeneralEdgeStateData(e,n),new GeneralSimpleRegionData(e),new GeneralFaceColorData(e),new GeneralSectorStateData(e),new GeneralVertexStateData(e),new GeneralFaceStateData(e,s=>FaceState.any(s,r.getFaceValue(s))))}static fromFaces(e,t){return CompleteData.fromFacesEdges(e,t,()=>EdgeState.WHITE)}static fromFaceValueData(e,t){return CompleteData.fromFaces(e,n=>t.getFaceValue(n))}static empty(e){return CompleteData.fromFaces(e,()=>null)}static faceMapLookup(e){const t=new Map(Array.from(e.entries()).map(([n,r])=>[`${n.x},${n.y}`,r]));return n=>{const r=t.get(`${n.logicalCoordinates.x},${n.logicalCoordinates.y}`);return r!==void 0?r:null}}getFaceValue(e){return this.faceValueData.getFaceValue(e)}setFaceValue(e,t){this.faceValueData.setFaceValue(e,t)}get faceValueChangedEmitter(){return this.faceValueData.faceValueChangedEmitter}getEdgeState(e){return this.edgeStateData.getEdgeState(e)}setEdgeState(e,t){this.edgeStateData.setEdgeState(e,t)}get edgeStateChangedEmitter(){return this.edgeStateData.edgeStateChangedEmitter}getSimpleRegions(){return this.simpleRegionData.getSimpleRegions()}getSimpleRegionWithVertex(e){return this.simpleRegionData.getSimpleRegionWithVertex(e)}getSimpleRegionWithEdge(e){return this.simpleRegionData.getSimpleRegionWithEdge(e)}getSimpleRegionWithId(e){return this.simpleRegionData.getSimpleRegionWithId(e)}getWeirdEdges(){return this.simpleRegionData.getWeirdEdges()}modifyRegions(e,t,n,r){this.simpleRegionData.modifyRegions(e,t,n,r)}get simpleRegionsChangedEmitter(){return this.simpleRegionData.simpleRegionsChangedEmitter}getFaceColors(){return this.faceColorData.getFaceColors()}getInsideColor(){return this.faceColorData.getInsideColor()}getOutsideColor(){return this.faceColorData.getOutsideColor()}getFaceColor(e){return this.faceColorData.getFaceColor(e)}getFacesWithColor(e){return this.faceColorData.getFacesWithColor(e)}getFaceColorMap(){return this.faceColorData.getFaceColorMap()}getOppositeFaceColor(e){return this.faceColorData.getOppositeFaceColor(e)}hasInvalidFaceColors(){return this.faceColorData.hasInvalidFaceColors()}modifyFaceColors(e,t,n,r,s){this.faceColorData.modifyFaceColors(e,t,n,r,s)}get faceColorsChangedEmitter(){return this.faceColorData.faceColorsChangedEmitter}getSectorState(e){return this.sectorStateData.getSectorState(e)}setSectorState(e,t){this.sectorStateData.setSectorState(e,t)}get sectorStateChangedEmitter(){return this.sectorStateData.sectorStateChangedEmitter}getVertexState(e){return this.vertexStateData.getVertexState(e)}setVertexState(e,t){this.vertexStateData.setVertexState(e,t)}get vertexStateChangedEmitter(){return this.vertexStateData.vertexStateChangedEmitter}getFaceState(e){return this.faceStateData.getFaceState(e)}setFaceState(e,t){this.faceStateData.setFaceState(e,t)}get faceStateChangedEmitter(){return this.faceStateData.faceStateChangedEmitter}clone(){return new CompleteData(this.faceValueData.clone(),this.edgeStateData.clone(),this.simpleRegionData.clone(),this.faceColorData.clone(),this.sectorStateData.clone(),this.vertexStateData.clone(),this.faceStateData.clone())}createDelta(){return new CompleteDelta(this.faceValueData.createDelta(),this.edgeStateData.createDelta(),this.simpleRegionData.createDelta(),this.faceColorData.createDelta(),this.sectorStateData.createDelta(),this.vertexStateData.createDelta(),this.faceStateData.createDelta())}serializeState(e){return serializeCompleteData(e,this)}static deserializeState(e,t){const n=GeneralFaceValueData.deserializeState(e,t.faceValueData);return new CompleteData(n,GeneralEdgeStateData.deserializeState(e,t.edgeStateData),t.simpleRegionData?GeneralSimpleRegionData.deserializeState(e,t.simpleRegionData):new GeneralSimpleRegionData(e),t.faceColorData?GeneralFaceColorData.deserializeState(e,t.faceColorData):new GeneralFaceColorData(e),t.sectorStateData?GeneralSectorStateData.deserializeState(e,t.sectorStateData):new GeneralSectorStateData(e),t.vertexStateData?GeneralVertexStateData.deserializeState(e,t.vertexStateData):new GeneralVertexStateData(e),t.faceStateData?GeneralFaceStateData.deserializeState(e,t.faceStateData):new GeneralFaceStateData(e,r=>FaceState.any(r,n.getFaceValue(r))))}}const getCoordinateClusteredMap=(o,e)=>{const t=_$1.sortBy(o),n=[];let r=[];for(let a=0;a<t.length;a++){const l=t[a];r.length===0||Math.abs(r[r.length-1]-l)<=e?r.push(l):(n.push(r),r=[l])}r.length>0&&n.push(r);const s=new Map;return n.forEach(a=>{const l=_$1.sum(a)/a.length;a.forEach(d=>s.set(d,l))}),s};export{RectangularPushButton as $,AnimatedPanZoomListener as A,BaseBoard as B,CompleteData as C,DotUtils as D,EdgeState as E,BooleanProperty as F,VBox as G,BasicPuzzle as H,puzzleToCompressedString as I,copyToClipboard as J,HBox as K,Line as L,Matrix$1 as M,Node$2 as N,uiFont as O,Path as P,uiForegroundColorProperty as Q,Rectangle as R,SingularValueDecomposition as S,Text as T,Image$1 as U,Vector2 as V,HSeparator as W,dotRandom as X,DynamicProperty as Y,TextPushButton as Z,_$1 as _,assertEnabled as a,redXsVisibleProperty as a$,showUndoRedoAllProperty as a0,controlBarMargin as a1,rectangularButtonAppearanceStrategy as a2,uiButtonBaseColorProperty as a3,uiButtonDisabledColorProperty as a4,uiButtonForegroundProperty as a5,controlBarFont as a6,SlitherQueryParameters as a7,puzzleFromCompressedString as a8,getSolvablePropertyPuzzle as a9,getCoordinateClusteredMap as aA,SquareBoard as aB,Orientation as aC,satSolve as aD,MultipleSolutionsError as aE,InvalidStateError as aF,HexagonalBoard as aG,finalStateSolve as aH,standardSolverFactory as aI,simpleRegionIsSolved as aJ,CompleteValidator as aK,FireListener as aL,isFaceColorEditModeProperty as aM,LineStyles as aN,puzzleBackgroundColorProperty as aO,puzzleBackgroundStrokeColorProperty as aP,Graph$1 as aQ,DerivedProperty as aR,verticesVisibleProperty as aS,vertexColorProperty as aT,vertexStyleProperty as aU,smallVertexProperty as aV,puzzleFont as aW,faceValueStyleProperty as aX,faceValueCompletedColorProperty as aY,faceValueErrorColorProperty as aZ,faceStateVisibleProperty as a_,PuzzleModel as aa,Panel as ab,uiBackgroundColorProperty as ac,RectangularRadioButtonGroup as ad,editModeProperty as ae,EditMode as af,uiButtonSelectedStrokeColorProperty as ag,uiButtonDeselectedStrokeColorProperty as ah,Display as ai,Property as aj,TinyProperty as ak,navbarBackgroundColorProperty as al,navbarErrorBackgroundColorProperty as am,AlignBox as an,ManualConstraint as ao,tryToSetEditMode as ap,platform as aq,StringProperty as ar,Font as as,NumberProperty as at,PatternStringProperty as au,getAugmentedNamespace as av,commonjsGlobal as aw,getDefaultExportFromCjs as ax,optionize3 as ay,ConvexHull2 as az,assert$2 as b,Easing as b$,xColorProperty as b0,redXsAlignedProperty as b1,whiteLineVisibleProperty as b2,whiteLineColorProperty as b3,redLineVisibleProperty as b4,redLineColorProperty as b5,redLineStyleProperty as b6,simpleRegionTargetColorProperty as b7,linesVisibleProperty as b8,edgeColorsVisibleProperty as b9,vertexStateOutlineProperty as bA,Circle as bB,vertexStatePointProperty as bC,vertexStateVisibleProperty as bD,allVertexStateVisibleProperty as bE,VertexState as bF,GridBox as bG,showHoverHighlightsProperty as bH,hoverHighlightColorProperty as bI,selectedFaceColorHighlightColorProperty as bJ,selectedSectorEditColorProperty as bK,faceColorsVisibleProperty as bL,isFaceEditModeProperty as bM,isSectorEditModeProperty as bN,isEdgeEditModeProperty as bO,isVertexEditModeProperty as bP,LocalStorageBooleanProperty as bQ,BaseHalfEdge as bR,BaseEdge as bS,BaseFace as bT,BaseVertex as bU,sceneryPhet as bV,InstanceRegistry as bW,Dimension2 as bX,stepTimer as bY,PressListener as bZ,Animation as b_,edgeWeirdColorProperty as ba,joinedLinesJoinProperty as bb,joinedLinesCapProperty as bc,arrayDifference as bd,EnumerationValue as be,Enumeration as bf,faceColorBasicTargetColorProperty as bg,faceColorLightTargetColorProperty as bh,faceColorDarkTargetColorProperty as bi,faceColorInsideColorProperty as bj,faceColorOutsideColorProperty as bk,faceColorThresholdProperty as bl,faceColorDefaultColorProperty as bm,FaceColorState as bn,Color as bo,SectorState as bp,sectorsVisibleProperty as bq,sectorsNextToEdgesVisibleProperty as br,sectorsTrivialVisibleProperty as bs,sectorOtherColorProperty as bt,sectorOnlyOneColorProperty as bu,sectorNotZeroColorProperty as bv,sectorNotOneColorProperty as bw,sectorNotTwoColorProperty as bx,vertexStateLineProperty as by,vertexStateBackgroundProperty as bz,combineOptions as c,createBoardDescriptor as c$,PaintColorProperty as c0,ColorDef$1 as c1,StringUtils as c2,DerivedStringProperty as c3,Tandem as c4,ValueChangeSoundPlayer as c5,Range as c6,WidthSizable as c7,PhetFont as c8,Slider as c9,autoSolveDoubleMinusOneFacesProperty as cA,autoSolveStaticFaceSectorProperty as cB,autoSolveSimpleSectorProperty as cC,autoSolveVertexToRedEdgeProperty as cD,autoSolveVertexToBlackEdgeProperty as cE,autoSolveVertexToSectorsProperty as cF,autoSolveVertexToFaceColorProperty as cG,autoSolveFaceColorToRedProperty as cH,autoSolveFaceColorToBlackProperty as cI,autoSolveFaceColorParityToRedProperty as cJ,autoSolveFaceColorParityToBlackProperty as cK,autoSolveFaceColorParityColorsProperty as cL,autoSolveFaceColorParityPartialReductionProperty as cM,autoSolveVertexColorToFaceProperty as cN,autoSolveFaceToRedProperty as cO,autoSolveFaceToBlackProperty as cP,autoSolveFaceToSectorsProperty as cQ,autoSolveFaceToFaceColorsProperty as cR,availableThemes as cS,themeProperty as cT,popupColorEditor as cU,uiHintUsesBuiltInSolveProperty as cV,lineJoins as cW,lineCaps as cX,vertexStyles as cY,redLineStyles as cZ,faceValueStyles as c_,NumberDisplay as ca,ArrowButton as cb,nullSoundPlayer as cc,isWidthSizable as cd,extendsWidthSizable as ce,IOType as cf,base64SoundToByteArray as cg,asyncLoader as ch,WrappedAudioBuffer as ci,phetAudioContext$1 as cj,SoundClipPlayer as ck,tambo as cl,BooleanRoundToggleButton as cm,SceneryPhetStrings as cn,KeyboardListener as co,barrierColorProperty as cp,Checkbox as cq,VerticalAquaRadioButtonGroup as cr,uiHeaderFont as cs,autoSolveSimpleVertexJointToRedProperty as ct,autoSolveSimpleVertexForcedLineToBlackProperty as cu,autoSolveSimpleVertexAlmostEmptyToRedProperty as cv,autoSolveSimpleFaceToRedProperty as cw,autoSolveSimpleFaceToBlackProperty as cx,autoSolveSimpleLoopToRedProperty as cy,autoSolveSimpleLoopToBlackProperty as cz,arrayRemove as d,rescaleProtoDescriptorMinimum as d0,getSolvedPuzzle as d1,MaximumSolverIterationsError as d2,iterateSolverFactory as d3,LocalStorageEnumerationProperty as d4,AquaRadioButtonGroup as d5,LocalStorageProperty as d6,TinyEmitter as d7,generateButtonFont as d8,generateAddedFaceColorProperty as d9,generateMinimizedFaceColorProperty as da,getSignedArea as e,faceValueColorProperty as f,getCentroid as g,blackLineColorProperty as h,getSignedAreaDerivative as i,Matrix3 as j,Sizable as k,Multilink as l,Bounds2 as m,LinearGradient as n,optionize as o,playAreaBackgroundColorProperty as p,playAreaLinearTopColorProperty as q,playAreaLinearMiddleColorProperty as r,safeSolve as s,toPropertyPuzzle as t,playAreaLinearBottomColorProperty as u,validateBoard as v,RadialGradient as w,playAreaRadialOutsideColorProperty as x,playAreaRadialInsideColorProperty as y,Shape$1 as z};
