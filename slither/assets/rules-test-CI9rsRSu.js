var K=Object.defineProperty;var Z=(c,t,e)=>t in c?K(c,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):c[t]=e;var i=(c,t,e)=>(Z(c,typeof t!="symbol"?t+"":t,e),e);import"./Vector2Property-DCXaH-JP.js";import{N as M,e as tt,V as et,f as st}from"./PhetioControlledVisibilityProperty-C1zM_Uw1.js";import{u as it,p as at,v as rt,w as ht,x as nt}from"./patternBoards-CdPs5rJx.js";import{P as lt}from"./PlanarMappedPatternBoardNode-Dj9hYlW_.js";import{P as ot,k as ct}from"./FeatureSet-Brj-qr45.js";import{P as ut}from"./PatternBoardRuleSet-BglMViWi.js";import{B as v}from"./BinaryRuleCollection-DM-D9egP.js";import{s as P,a as dt,g as _t,b as ft}from"./square-only-edge-unrestricted-l3AKq7zH.js";import{s as G,a as H,b as $,c as gt,d as pt,g as vt,e as Et,f as wt,h as zt,i as mt}from"./square-only-all-unrestricted-C-l069kK.js";import"./getCoordinateClusteredMap-s__X_7ZN.js";import"./getPeriodicTilingGenerator-qmRzQaR8.js";import"./Theme-C7QtLKXh.js";import"./TextPushButton-BPfgO3qK.js";import"./logic-solver-C8wJkzp2.js";import"./PatternRule-L1F6UIQ_.js";import"./getSolutionImpliedRules-a_Xnq1eI.js";import"./HighlanderPruner-DN835Mbg.js";var o=(c=>(c[c.TRUE=0]="TRUE",c[c.FALSE=1]="FALSE",c[c.UNDEF=2]="UNDEF",c))(o||{});(c=>{function t(l){switch(l){case 0:return 0;case 1:return 1;case 2:return 2;default:throw new Error("IllegalArgumentException: value")}}c.valueOf=t;function e(l){return l?0:1}c.valueOfBoolean=e;const s=[[1,0],[0,1],[2,2]];function a(l,d){return s[l][d?1:0]}c.xor=a;const r=[[0,1,2],[1,1,1],[2,1,2]];function h(l,d){return r[l][d]}c.and=h;const n=[[0,0,0],[0,1,2],[0,2,2]];function w(l,d){return n[l][d]}c.or=w})(o||(o={}));class U{constructor(t,e){i(this,"cref");i(this,"blocker");this.cref=t,this.blocker=e}equals(t){if(!(t instanceof U))return!1;const e=t;return this.cref.equals(e.cref)}toString(){return`Watcher(${this.cref}, ${this.blocker})`}}class S{constructor(t,e){i(this,"data",null);i(this,"sz",0);i(this,"defaultObject");i(this,"defaultValue");this.defaultObject=this.create(),this.defaultValue=this.value(this.defaultObject),t!==void 0&&e!==void 0?this.growTo(t,e):t!==void 0&&this.growTo(t)}size(){return this.sz}shrink(t){if(t>this.sz)throw new Error("nelems");for(let e=0;e<t;++e)this.data[--this.sz]=this.defaultValue}shrink_(t){if(t>this.sz)throw new Error("nelems");this.sz-=t}get capacity(){return this.data===null?0:this.data.length}push(t){this.sz===this.capacity&&(this.capacity=this.sz+1),this.data[this.sz++]=t===void 0?this.defaultValue:this.value(t)}push_(t){if(this.sz>=this.capacity)throw new Error("Index out of bounds");this.data[this.sz++]=this.value(t)}pop(){if(this.sz<=0)throw new Error("Index out of bounds");this.sz--}last(){return this.create(this.data[this.sz-1])}get(t){return this.create(this.data[t])}set(t,e){return this.data[t]=this.value(e),e}copyTo(t){t.clear(),t.growTo(this.sz),!(this.sz<=0)&&this.data.slice(0,this.sz).forEach((e,s)=>t.data[s]=e)}moveTo(t){t.clear(!0),t.data=this.data,t.sz=this.sz,this.data=null,this.sz=0}static imax(t,e){const s=e-t>>31;return(t&s)+(e&~s)}set capacity(t){const e=this.capacity;if(e>=t)return;const s=S.imax(t-e+1&-2,(e>>1)+2&-2),a=new Array(e+s).fill(this.defaultValue);this.data!==null&&this.data.slice(0,this.sz).forEach((r,h)=>a[h]=r),this.data=a}growTo(t,e){if(e===void 0)this.growTo(t,this.defaultObject);else{if(this.sz>=t)return;this.capacity=t;for(let s=this.sz;s<t;s++)this.data[s]=this.value(e);this.sz=t}}clear(t=!1){this.data!==null&&(this.sz=0,t&&(this.data=null))}toString(){const t=[];t.push("[");let e="";for(let s=0;s<this.sz;++s)t.push(e+this.toStringValue(this.data[s])),e=", ";return t.push("]"),t.join("")}quickSort(t,e){if(t<=e){const s=this.data[(t+e)/2];let a=t,r=e;for(;a<=r;){for(;this.compare(this.data[a],s)<0;)a++;for(;this.compare(this.data[r],s)>0;)r--;if(a<=r){const h=this.data[a];this.data[a]=this.data[r],this.data[r]=h,a++,r--}}this.quickSort(t,r),this.quickSort(a,e)}}sort(){this.data!==null&&this.quickSort(0,this.sz-1)}remove(t){let e=0;for(;e<this.data.length&&this.data[e]!==this.value(t);e++);if(e>=this.data.length)throw new Error("t");for(;e<this.data.length-1;e++)this.data[e]=this.data[e+1];this.pop()}[Symbol.iterator](){let t=0;return{next:()=>t<this.sz?{done:!1,value:this.create(this.data[t++])}:{done:!0,value:void 0}}}}const g=class g{constructor(t){i(this,"x");this.x=t}compareTo(t){return this.x-t.x}equals(t){return this.compareTo(t)===0}static valueOf(t){switch(t){case g.UNDEF_VALUE:return g.UNDEF;case g.ERROR_VALUE:return g.ERROR}for(let e=g.cache.length;e<=t;++e)g.cache.push(new g(e));return g.cache[t]}static valueOfVar(t,e){if(t<0)throw new Error("variable");return g.valueOf(t+t+(e?1:0))}not(){return g.valueOf(this.x^1)}xor(t){return g.valueOf(this.x^(t?1:0))}sign(){return(this.x&1)===1}var(){return this.x>>>1}value(){return this.x}toString(){switch(this.x){case g.UNDEF_VALUE:return"UNDEF";case g.ERROR_VALUE:return"ERROR"}return`Lit(${this.var()}, ${this.sign()})`}};i(g,"UNDEF_VALUE",-2),i(g,"ERROR_VALUE",-1),i(g,"cache",[]),i(g,"UNDEF",new g(g.UNDEF_VALUE)),i(g,"ERROR",new g(g.ERROR_VALUE));let p=g;class m extends S{constructor(t,e){if(typeof t=="number")e!==void 0?super(t,e):super(t);else if(Array.isArray(t)){super();for(const s of t)this.push(s)}else super()}create(t){return t===void 0?p.UNDEF:p.valueOf(t)}value(t){return t.value()}compare(t,e){return t-e}toStringValue(t){return p.valueOf(t).toString()}}const q=class q extends m{constructor(e,s,a){super();i(this,"_mark");i(this,"_learnt");i(this,"_has_extra");i(this,"_act");i(this,"_abs");this._mark=0,this._learnt=a,this._has_extra=s;for(let r=0;r<e.size();++r)this.push(e.get(r));this._has_extra&&(this._learnt?this._act=0:this.calcAbstraction())}equals(e){return this===e}calcAbstraction(){if(!this._has_extra)throw new Error("has_extra is false");let e=0;for(let s=0;s<this.size();++s)e|=1<<(this.get(s).var()&31);this._abs=e}learnt(){return this._learnt}has_extra(){return this._has_extra}mark(e){if(e===void 0)return this._mark;this._mark=e}reloced(){return!1}relocation(){throw new Error("UnsupportedOperationException")}relocate(e){throw new Error("UnsupportedOperationException")}get activity(){if(!this._has_extra)throw new Error("has_extra is false");return this._act}set activity(e){this._act=e}abstraction(){if(!this._has_extra)throw new Error("has_extra is false");return this._abs}subsumes(e){if(this._learnt||e._learnt)throw new Error("learnt is true");if(!this._has_extra||e._has_extra)throw new Error("has_extra is false");if(e.size()<this.size()||this._abs&~e._abs)return p.ERROR;let s=p.UNDEF;t:for(let a=0;a<this.size();a++){const r=this.get(a);for(let h=0;h<e.size();h++){const n=e.get(h);if(r.equals(n))continue t;if(s.equals(p.UNDEF)&&r.equals(n.not())){s=r;continue t}}return p.ERROR}return s}strengthen(e){this.remove(e),this.calcAbstraction()}};i(q,"CRef_Undef",new q(new m,!1,!1));let E=q;class L{constructor(t,e){i(this,"reason");i(this,"level");this.reason=t,this.level=e}equals(t){return this===t}static mkVarData(t,e){return new L(t,e)}}class j extends S{constructor(t,e){typeof t=="number"?e!==void 0?super(t,e):super(t):super()}create(t){return t===void 0?o.UNDEF:o.valueOf(t)}value(t){return t}compare(t,e){return t-e}toStringValue(t){return o[t].toString()}}class R{constructor(t,e){i(this,"data",null);i(this,"sz",0);t!==void 0&&e!==void 0?this.growTo(t,e):t!==void 0&&this.growTo(t)}static imax(t,e){const s=e-t>>31;return(t&s)+(e&~s)}equals(t){return this===t}size(){return this.sz}shrink(t){if(t>this.sz)throw new Error("nelems");for(let e=0;e<t;++e)this.data[--this.sz]=null}shrink_(t){if(t>this.sz)throw new Error("nelems");this.sz-=t}push(t){this.sz===this.capacity&&(this.capacity=this.sz+1),this.data[this.sz++]=t===void 0?null:t}pop(){if(this.sz<=0)throw new Error("Index out of bounds");this.sz--}last(){return this.data[this.sz-1]}get(t){return this.data[t]}set(t,e){return this.data[t]=e}copyTo(t){t.clear(),t.growTo(this.sz),!(this.sz<=0)&&this.data.slice(0,this.sz).forEach((e,s)=>t.data[s]=e)}moveTo(t){t.clear(!0),t.data=this.data,t.sz=this.sz,this.data=null,this.sz=0}get capacity(){return this.data===null?0:this.data.length}set capacity(t){const e=this.capacity;if(e>=t)return;const s=R.imax(t-e+1&-2,(e>>1)+2&-2),a=new Array(e+s);this.data!==null&&this.data.slice(0,this.sz).forEach((r,h)=>a[h]=r),this.data=a}growTo(t,e){if(!(this.sz>=t)){this.capacity=t;for(let s=this.sz;s<t;s++)this.data[s]=e===void 0?null:e;this.sz=t}}clear(t=!1){this.data!==null&&(this.sz=0,t&&(this.data=null))}toString(){const t=[];t.push("[");let e="";for(let s=0;s<this.data.length;++s)t.push(e+this.data[s]),e=", ";return t.push("]"),t.join("")}sort(t){this.sz<=1||this.data.sort(t)}remove(t){let e=0;for(;e<this.data.length&&!this.data[e].equals(t);e++);if(e>=this.data.length)throw new Error("t");for(;e<this.data.length-1;e++)this.data[e]=this.data[e+1];this.pop()}[Symbol.iterator](){let t=0;return{next:()=>t<this.sz?{done:!1,value:this.data[t++]}:{done:!0,value:void 0}}}}class y{constructor(t,e){i(this,"data",null);i(this,"sz",0);t!==void 0&&e!==void 0?this.growTo(t,e):t!==void 0&&this.growTo(t)}size(){return this.sz}shrink(t){this.shrink_(t)}shrink_(t){if(t>this.sz)throw new Error("nelems");this.sz-=t}get capacity(){return this.data===null?0:this.data.length}push(t){this.sz===this.capacity&&(this.capacity=this.sz+1),this.data[this.sz++]=t===void 0?0:t}pop(){if(this.sz<=0)throw new Error("Index out of bounds");this.sz--}last(){return this.data[this.sz-1]}get(t){if(t>=this.sz)throw new Error("index");return this.data[t]}set(t,e){if(t>=this.sz)throw new Error("index");return this.data[t]=e}copyTo(t){t.clear(),t.growTo(this.sz),!(this.sz<=0)&&this.data.slice(0,this.sz).forEach((e,s)=>t.data[s]=e)}moveTo(t){t.clear(!0),t.data=this.data,t.sz=this.sz,this.data=null,this.sz=0}static imax(t,e){const s=e-t>>31;return(t&s)+(e&~s)}set capacity(t){const e=this.capacity;if(e>=t)return;const s=y.imax(t-e+1&-2,(e>>1)+2&-2),a=new Array(e+s).fill(0);this.data!==null&&this.data.slice(0,this.sz).forEach((r,h)=>a[h]=r),this.data=a}growTo(t,e=0){if(!(this.sz>=t)){this.capacity=t;for(let s=this.sz;s<t;s++)this.data[s]=e;this.sz=t}}clear(t=!1){this.data!==null&&(this.sz=0,t&&(this.data=null))}}class yt{constructor(){i(this,"occs",new R);i(this,"dirty",new y);i(this,"dirties",new m)}init(t){const e=t.value()+1;for(let s=this.occs.size();s<e;++s)this.occs.push(new R);this.dirty.growTo(e,0)}get(t){return this.occs.get(t.value())}set(t,e){return this.occs.set(t.value(),e)}lookup(t){return this.dirty.get(t.value())!==0&&this.clean(t),this.occs.get(t.value())}smudge(t){this.dirty.get(t.value())===0&&(this.dirty.set(t.value(),1),this.dirties.push(t))}clear(){this.occs.clear(),this.dirty.clear(),this.dirties.clear()}cleanAll(){for(let t=0;t<this.dirties.size();t++)this.dirty.get(this.dirties.get(t).value())!==0&&this.clean(this.dirties.get(t));this.dirties.clear()}deleted(t){return t.cref.mark()===1}clean(t){const e=this.occs.get(t.value());let s=0,a=0;for(s=0;s<e.size();s++)this.deleted(e.get(s))||e.set(a++,e.get(s));e.shrink(s-a),this.dirty.set(t.value(),0)}toString(){return`OccLists(occs=${this.occs}, dirty=${this.dirty}, dirties=${this.dirties})`}}class b{constructor(t,e){i(this,"data",null);i(this,"sz",0);t!==void 0&&e!==void 0?this.growTo(t,e):t!==void 0&&this.growTo(t)}size(){return this.sz}shrink(t){this.shrink_(t)}shrink_(t){if(t>this.sz)throw new Error("nelems");this.sz-=t}get capacity(){return this.data===null?0:this.data.length}push(t){this.sz===this.capacity&&(this.capacity=this.sz+1),this.data[this.sz++]=t===void 0?!1:t}pop(){if(this.sz<=0)throw new Error("Index out of bounds");this.sz--}last(){return this.data[this.sz-1]}get(t){if(t>=this.sz)throw new Error("index");return this.data[t]}set(t,e){if(t>=this.sz)throw new Error("index");return this.data[t]=e}copyTo(t){t.clear(),t.growTo(this.sz),!(this.sz<=0)&&this.data.slice(0,this.sz).forEach((e,s)=>t.data[s]=e)}moveTo(t){t.clear(!0),t.data=this.data,t.sz=this.sz,this.data=null,this.sz=0}static imax(t,e){const s=e-t>>31;return(t&s)+(e&~s)}set capacity(t){const e=this.capacity;if(e>=t)return;const s=b.imax(t-e+1&-2,(e>>1)+2&-2),a=new Array(e+s).fill(!1);this.data!==null&&this.data.slice(0,this.sz).forEach((r,h)=>a[h]=r),this.data=a}growTo(t,e){if(!(this.sz>=t)){this.capacity=t;for(let s=this.sz;s<t;s++)this.data[s]=e===void 0?!1:e;this.sz=t}}clear(t=!1){this.data!==null&&(this.sz=0,t&&(this.data=null))}}class D{constructor(t){i(this,"lt");i(this,"heap",new y);i(this,"indices",new y);this.lt=t}static left(t){return t*2+1}static right(t){return(t+1)*2}static parent(t){return t-1>>1}percolateUp(t){const e=this.heap.get(t);let s=D.parent(t);for(;t!==0&&this.lt.call(e,this.heap.get(s));)this.heap.set(t,this.heap.get(s)),this.indices.set(this.heap.get(s),t),t=s,s=D.parent(s);this.heap.set(t,e),this.indices.set(e,t)}percolateDown(t){const e=this.heap.get(t);for(;D.left(t)<this.heap.size();){const s=D.left(t),a=D.right(t),r=a<this.heap.size()&&this.lt.call(this.heap.get(a),this.heap.get(s))?a:s;if(!this.lt.call(this.heap.get(r),e))break;this.heap.set(t,this.heap.get(r)),this.indices.set(this.heap.get(t),t),t=r}this.heap.set(t,e),this.indices.set(e,t)}size(){return this.heap.size()}empty(){return this.heap.size()===0}inHeap(t){return t<this.indices.size()&&this.indices.get(t)>=0}get(t){if(t>=this.heap.size())throw new Error("IndexOutOfBoundsException: index");return this.heap.get(t)}decrease(t){if(!this.inHeap(t))throw new Error("IllegalArgumentException: n");this.percolateUp(this.indices.get(t))}increase(t){if(!this.inHeap(t))throw new Error("IllegalArgumentException: n");this.percolateDown(this.indices.get(t))}update(t){this.inHeap(t)?(this.percolateUp(this.indices.get(t)),this.percolateDown(this.indices.get(t))):this.insert(t)}insert(t){if(this.indices.growTo(t+1,-1),this.inHeap(t))throw new Error("IllegalArgumentException: n");this.indices.set(t,this.heap.size()),this.heap.push(t),this.percolateUp(this.indices.get(t))}removeMin(){const t=this.heap.get(0);return this.heap.set(0,this.heap.last()),this.indices.set(this.heap.get(0),0),this.indices.set(t,-1),this.heap.pop(),this.heap.size()>1&&this.percolateDown(0),t}build(t){for(let e=0;e<this.heap.size();e++)this.indices.set(this.heap.get(e),-1);this.heap.clear();for(let e=0;e<t.size();e++)this.indices.set(t.get(e),e),this.heap.push(t.get(e));for(let e=this.heap.size()/2-1;e>=0;e--)this.percolateDown(e)}clear(){for(let t=0;t<this.heap.size();t++)this.indices.set(this.heap.get(t),-1);this.heap.clear()}}class At{constructor(t){i(this,"activity");this.activity=t}call(t,e){return this.activity.get(t)>this.activity.get(e)}}const z=class z{constructor(t){i(this,"_value");this._value=t}equals(t){return this===t}value(){return this._value}static valueOf(t){if(t===z.UNDEF_VALUE)return z.UNDEF;for(;z.cache.length<=t;)z.cache.push(new z(z.cache.length));return z.cache[t]}toString(){return`Var${this._value}`}};i(z,"UNDEF_VALUE",-1),i(z,"UNDEF",new z(z.UNDEF_VALUE)),i(z,"cache",[]);let f=z;const u=class u{constructor(){i(this,"model",new j);i(this,"conflict",new m);i(this,"verbosity");i(this,"var_decay");i(this,"clause_decay");i(this,"random_var_freq");i(this,"random_seed");i(this,"luby_restart");i(this,"ccmin_mode");i(this,"phase_saving");i(this,"rnd_pol");i(this,"rnd_init_act");i(this,"garbage_frac");i(this,"restart_first");i(this,"restart_inc");i(this,"learntsize_factor");i(this,"learntsize_inc");i(this,"learntsize_adjust_start_confl");i(this,"learntsize_adjust_inc");i(this,"solves");i(this,"starts");i(this,"decisions");i(this,"rnd_decisions");i(this,"propagations");i(this,"conflicts");i(this,"dec_vars");i(this,"clauses_literals");i(this,"learnts_literals");i(this,"max_literals");i(this,"tot_literals");i(this,"_ok");i(this,"_clauses",new R);i(this,"_learnts",new R);i(this,"_cla_inc");i(this,"_activity",new y);i(this,"_var_inc");i(this,"_watches");i(this,"_assigns",new j);i(this,"_polarity",new b);i(this,"_decision",new b);i(this,"_trail",new m);i(this,"_trail_lim",new y);i(this,"_vardata",new R);i(this,"_qhead");i(this,"_simpDB_assigns");i(this,"_simpDB_props");i(this,"_assumptions",new m);i(this,"_order_heap");i(this,"_progress_estimate");i(this,"_remove_satisfied");i(this,"_seen",new b);i(this,"_analyze_stack",new m);i(this,"_analyze_toclear",new m);i(this,"_add_tmp",new m);i(this,"_max_learnts");i(this,"_learntsize_adjust_confl");i(this,"_learntsize_adjust_cnt");i(this,"_conflict_budget");i(this,"_propagation_budget");i(this,"_asynch_interrupt");this.verbosity=u.VERBOSITY_DEFAULT,this.var_decay=u.VAR_DECAY_DEFAULT,this.clause_decay=u.CLAUSE_DECAY_DEFAULT,this.random_var_freq=u.RANDOM_VAR_FREQ_DEFAULT,this.random_seed=u.RANDOM_SEED_DEFAULT,this.luby_restart=u.LUBY_RESTART_DEFAULT,this.ccmin_mode=u.CCMIN_MODE_DEFAULT,this.phase_saving=u.PHASE_SAVING_DEFAULT,this.rnd_pol=!1,this.rnd_init_act=u.RND_INIT_ACT_DEFAULT,this.garbage_frac=u.GARBAGE_FRAC_DEFAULT,this.restart_first=u.RESTART_FIRST_DEFAULT,this.restart_inc=u.RESTART_INC_DEFAULT,this.learntsize_factor=1/3,this.learntsize_inc=1.1,this.learntsize_adjust_start_confl=100,this.learntsize_adjust_inc=1.5,this._ok=!0,this._cla_inc=1,this._var_inc=1,this._watches=new yt,this._qhead=0,this._simpDB_assigns=-1,this._simpDB_props=0,this._order_heap=new D(new At(this._activity)),this._progress_estimate=0,this._remove_satisfied=!0,this._conflict_budget=-1,this._propagation_budget=-1,this._asynch_interrupt=!1}static printf(t,...e){console.log(t,...e)}clauses(){return this._clauses}drand(){this.random_seed*=1389796;const t=Math.floor(this.random_seed/2147483647);return this.random_seed-=t*2147483647,this.random_seed/2147483647}irand(t){return Math.floor(this.drand()*t)}reason(t){return this._vardata.get(t.value()).reason}level(t){return this._vardata.get(t).level}insertVarOrder(t){!this._order_heap.inHeap(t.value())&&this._decision.get(t.value())&&this._order_heap.insert(t.value())}varDecayActivity(){this._var_inc*=1/this.var_decay}varBumpActivity(t,e){if(e===void 0)this.varBumpActivity(t,this._var_inc);else{const s=t.value();if(this._activity.set(s,this._activity.get(s)+e)>1e100){for(let a=0;a<this.nVars();a++)this._activity.set(a,this._activity.get(a)*1e-100);this._var_inc*=1e-100}this._order_heap.inHeap(s)&&this._order_heap.decrease(s)}}claDecayActivity(){this._cla_inc*=1/this.clause_decay}claBumpActivity(t){if(t.activity=t.activity+this._cla_inc,t.activity>1e20){for(let e=0;e<this._learnts.size();e++){const s=this._learnts.get(e);s.activity=s.activity*1e-20}this._cla_inc*=1e-20}}checkGarbage(){}enqueue(t,e){return this.valueLit(t)!==o.UNDEF?this.valueLit(t)!==o.FALSE:(this.uncheckedEnqueue(t,e),!0)}addClause(t){return this.addClause_(t)}locked(t){const e=this.reason(f.valueOf(t.get(0).var()));return this.valueLit(t.get(0))===o.TRUE&&e!==E.CRef_Undef&&e.equals(t)}newDecisionLevel(){this._trail_lim.push(this._trail.size())}decisionLevel(){return this._trail_lim.size()}abstractLevel(t){return 1<<(this.level(t)&31)}valueVar(t){return this._assigns.get(t.value())}valueLit(t){return o.xor(this._assigns.get(t.var()),t.sign())}modelValueVar(t){return this.model.get(t.value())}modelValueLit(t){return o.xor(this.model.get(t.var()),t.sign())}nAssigns(){return this._trail.size()}nClauses(){return this._clauses.size()}nLearnts(){return this._learnts.size()}nVars(){return this._vardata.size()}nFreeVars(){return this.dec_vars-(this._trail_lim.size()===0?this._trail.size():this._trail_lim.get(0))}setPolarity(t,e){this._polarity.set(t.value(),e)}setDecisionVar(t,e){const s=t.value();e&&!this._decision.get(s)?this.dec_vars++:!e&&this._decision.get(s)&&this.dec_vars--,this._decision.set(s,e),this.insertVarOrder(t)}setConfBudget(t){this._conflict_budget=this.conflicts+t}setPropBudget(t){this._propagation_budget=this.propagations+t}interrupt(){this._asynch_interrupt=!0}clearInterrupt(){this._asynch_interrupt=!1}budgetOff(){this._conflict_budget=this._propagation_budget=-1}withinBudget(){return!this._asynch_interrupt&&(this._conflict_budget<0||this.conflicts<this._conflict_budget)&&(this._propagation_budget<0||this.propagations<this._propagation_budget)}solve(){return this.budgetOff(),this._assumptions.clear(),this.solve_()===o.TRUE}solve1(t){return this.budgetOff(),this._assumptions.clear(),this._assumptions.push(t),this.solve_()===o.TRUE}solve2(t,e){return this.budgetOff(),this._assumptions.clear(),this._assumptions.push(t),this._assumptions.push(e),this.solve_()===o.TRUE}solve3(t,e,s){return this.budgetOff(),this._assumptions.clear(),this._assumptions.push(t),this._assumptions.push(e),this._assumptions.push(s),this.solve_()===o.TRUE}solveWithAssumptions(t){return this.budgetOff(),t.copyTo(this._assumptions),this.solve_()===o.TRUE}solveLimited(t){return t.copyTo(this._assumptions),this.solve_()}okay(){return this._ok}newVar(t,e){if(t===void 0)return this.newVar(!0,!0);if(e===void 0)return this.newVar(t,!0);{const s=this.nVars(),a=f.valueOf(s);return this._watches.init(p.valueOfVar(s,!1)),this._watches.init(p.valueOfVar(s,!0)),this._assigns.push(o.UNDEF),this._vardata.push(L.mkVarData(E.CRef_Undef,0)),this._activity.push(this.rnd_init_act?this.drand()*1e-5:0),this._seen.push(!1),this._polarity.push(t),this._decision.push(!1),this._trail.capacity=s+1,this.setDecisionVar(a,e),a}}addEmptyClause(){return this._add_tmp.clear(),this.addClause_(this._add_tmp)}addClause1(t){return this._add_tmp.clear(),this._add_tmp.push(t),this.addClause_(this._add_tmp)}addClause2(t,e){return this._add_tmp.clear(),this._add_tmp.push(t),this._add_tmp.push(e),this.addClause_(this._add_tmp)}addClause3(t,e,s){return this._add_tmp.clear(),this._add_tmp.push(t),this._add_tmp.push(e),this._add_tmp.push(s),this.addClause_(this._add_tmp)}addClauseFromArray(t){this._add_tmp.clear();for(const e of t){if(e===0)throw new Error("all vars must not be zero");this._add_tmp.push(p.valueOfVar(Math.abs(e)-1,e<0))}return this.addClause_(this._add_tmp)}addClause_(t){if(this.decisionLevel()!==0)throw new Error(`decisionLevel() = ${this.decisionLevel()}`);if(!this._ok)return!1;t.sort();let e,s,a;for(s=a=0,e=p.UNDEF;s<t.size();s++){const r=t.get(s).var();for(;r>=this.nVars();)this.newVar();if(this.valueLit(t.get(s))===o.TRUE||t.get(s).equals(e.not()))return!0;this.valueLit(t.get(s))!==o.FALSE&&!t.get(s).equals(e)&&t.set(a++,e=t.get(s))}if(t.shrink(s-a),t.size()===0)return this._ok=!1;if(t.size()===1)return this.uncheckedEnqueueSimple(t.get(0)),this._ok=this.propagate()===E.CRef_Undef;{const r=new E(t,!1,!1);this._clauses.push(r),this.attachClause(r)}return!0}attachClause(t){if(t.size()<=1)throw new Error("cr");this._watches.get(t.get(0).not()).push(new U(t,t.get(1))),this._watches.get(t.get(1).not()).push(new U(t,t.get(0))),t.learnt()?this.learnts_literals+=t.size():this.clauses_literals+=t.size()}detachClause(t,e){if(t.size()<=1)throw new Error("cr");e?(this._watches.get(t.get(0).not()).remove(new U(t,t.get(1))),this._watches.get(t.get(1).not()).remove(new U(t,t.get(0)))):(this._watches.smudge(t.get(0).not()),this._watches.smudge(t.get(1).not())),t.learnt()?this.learnts_literals-=t.size():this.clauses_literals-=t.size()}detachClauseSimple(t){this.detachClause(t,!1)}removeClause(t){this.detachClauseSimple(t),this.locked(t)&&(this._vardata.get(t.get(0).var()).reason=E.CRef_Undef),t.mark(1)}satisfied(t){for(let e=0;e<t.size();e++)if(this.valueLit(t.get(e))===o.TRUE)return!0;return!1}cancelUntil(t){if(this.decisionLevel()>t){for(let e=this._trail.size()-1;e>=this._trail_lim.get(t);e--){const s=this._trail.get(e).var();this._assigns.set(s,o.UNDEF),(this.phase_saving>1||this.phase_saving===1&&e>this._trail_lim.last())&&this._polarity.set(s,this._trail.get(e).sign()),this.insertVarOrder(f.valueOf(s))}this._qhead=this._trail_lim.get(t),this._trail.shrink(this._trail.size()-this._trail_lim.get(t)),this._trail_lim.shrink(this._trail_lim.size()-t)}}pickBranchLit(){let t=f.UNDEF;for(this.drand()<this.random_var_freq&&!this._order_heap.empty()&&(t=f.valueOf(this._order_heap.get(this.irand(this._order_heap.size()))),this.valueVar(t)===o.UNDEF&&this._decision.get(t.value())&&this.rnd_decisions++);t.equals(f.UNDEF)||this.valueVar(t)!==o.UNDEF||!this._decision.get(t.value());)if(this._order_heap.empty()){t=f.UNDEF;break}else t=f.valueOf(this._order_heap.removeMin());return t.equals(f.UNDEF)?p.UNDEF:p.valueOfVar(t.value(),this.rnd_pol?this.drand()<.5:this._polarity.get(t.value()))}analyze(t,e,s){let a=0,r=p.UNDEF;e.push(p.UNDEF);let h=this._trail.size()-1;do{const l=t;l.learnt()&&this.claBumpActivity(l);for(let d=r.equals(p.UNDEF)?0:1;d<l.size();d++){const _=l.get(d);!this._seen.get(_.var())&&this.level(_.var())>0&&(this.varBumpActivity(f.valueOf(_.var())),this._seen.set(_.var(),!0),this.level(_.var())>=this.decisionLevel()?a++:e.push(_))}for(;!this._seen.get(this._trail.get(h--).var()););r=this._trail.get(h+1),t=this.reason(f.valueOf(r.var())),this._seen.set(r.var(),!1),a--}while(a>0);e.set(0,r.not());let n,w;if(e.copyTo(this._analyze_toclear),this.ccmin_mode===2){let l=0;for(n=1;n<e.size();n++)l|=this.abstractLevel(e.get(n).var());for(n=w=1;n<e.size();n++)(this.reason(f.valueOf(e.get(n).var()))===E.CRef_Undef||!this.litRedundant(e.get(n),l))&&e.set(w++,e.get(n))}else if(this.ccmin_mode===1)for(n=w=1;n<e.size();n++){const l=f.valueOf(e.get(n).var());if(this.reason(l)===E.CRef_Undef)e.set(w++,e.get(n));else{const d=this.reason(f.valueOf(e.get(n).var()));for(let _=1;_<d.size();_++)if(!this._seen.get(d.get(_).var())&&this.level(d.get(_).var())>0){e.set(w++,e.get(n));break}}}else n=w=e.size();if(this.max_literals+=e.size(),e.shrink(n-w),this.tot_literals+=e.size(),e.size()===1)s=0;else{let l=1;for(let _=2;_<e.size();_++)this.level(e.get(_).var())>this.level(e.get(l).var())&&(l=_);const d=e.get(l);e.set(l,e.get(1)),e.set(1,d),s=this.level(d.var())}for(let l=0;l<this._analyze_toclear.size();l++)this._seen.set(this._analyze_toclear.get(l).var(),!1);return s}litRedundant(t,e){this._analyze_stack.clear(),this._analyze_stack.push(t);const s=this._analyze_toclear.size();for(;this._analyze_stack.size()>0;){const a=this.reason(f.valueOf(this._analyze_stack.last().var()));this._analyze_stack.pop();for(let r=1;r<a.size();r++){const h=a.get(r);if(!this._seen.get(h.var())&&this.level(h.var())>0)if(this.reason(f.valueOf(h.var()))!==E.CRef_Undef&&this.abstractLevel(h.var())&e)this._seen.set(h.var(),!0),this._analyze_stack.push(h),this._analyze_toclear.push(h);else{for(let n=s;n<this._analyze_toclear.size();n++)this._seen.set(this._analyze_toclear.get(n).var(),!1);return this._analyze_toclear.shrink(this._analyze_toclear.size()-s),!1}}}return!0}analyzeFinal(t,e){if(e.clear(),e.push(t),this.decisionLevel()!==0){this._seen.set(t.var(),!0);for(let s=this._trail.size()-1;s>=this._trail_lim.get(0);s--){const a=f.valueOf(this._trail.get(s).var());if(this._seen.get(a.value())){if(this.reason(a)===E.CRef_Undef)this.level(a.value())>0&&e.push(this._trail.get(s).not());else{const r=this.reason(a);for(let h=1;h<r.size();h++)this.level(r.get(h).var())>0&&this._seen.set(r.get(h).var(),!0)}this._seen.set(a.value(),!1)}}this._seen.set(t.var(),!1)}}uncheckedEnqueue(t,e){if(this.valueLit(t)!==o.UNDEF)throw new Error("p");this._assigns.set(t.var(),o.valueOf(t.sign()?0:1)),this._vardata.set(t.var(),L.mkVarData(e,this.decisionLevel())),this._trail.push_(t)}uncheckedEnqueueSimple(t){this.uncheckedEnqueue(t,E.CRef_Undef)}propagate(){let t=E.CRef_Undef,e=0;for(this._watches.cleanAll();this._qhead<this._trail.size();){const s=this._trail.get(this._qhead++),a=this._watches.get(s);e++;let r=0,h=0,n=a.size();for(;r<n;){const w=a.get(r).blocker;if(this.valueLit(w)===o.TRUE){a.set(h++,a.get(r++));continue}const l=a.get(r).cref,d=s.not();l.get(0).equals(d)&&(l.set(0,l.get(1)),l.set(1,d)),r++;const _=l.get(0),T=new U(l,_);if(!_.equals(w)&&this.valueLit(_)===o.TRUE){a.set(h++,T);continue}for(let O=2;O<l.size();O++){const I=l.get(O);if(this.valueLit(I)!==o.FALSE){l.set(1,I),l.set(O,d),this._watches.get(l.get(1).not()).push(T);break}}if(a.set(h++,T),this.valueLit(_)===o.FALSE)for(t=l,this._qhead=this._trail.size();r<n;)a.set(h++,a.get(r++));else this.uncheckedEnqueue(_,l)}a.shrink(r-h)}return this.propagations+=e,this._simpDB_props-=e,t}reduceDB(){let t,e;const s=this._cla_inc/this._learnts.size();for(this._learnts.sort((a,r)=>a.size()>2&&(r.size()===2||a.activity<r.activity)?-1:r.size()>2&&(a.size()===2||r.activity<a.activity)?1:0),t=e=0;t<this._learnts.size();t++){const a=this._learnts.get(t);a.size()>2&&!this.locked(a)&&(t<this._learnts.size()/2||a.activity<s)?this.removeClause(this._learnts.get(t)):this._learnts.set(e++,this._learnts.get(t))}this._learnts.shrink(t-e),this.checkGarbage()}removeSatisfied(t){let e,s;for(e=s=0;e<t.size();e++){const a=t.get(e);this.satisfied(a)?this.removeClause(t.get(e)):t.set(s++,t.get(e))}t.shrink(e-s)}rebuildOrderHeap(){const t=new y;for(let e=0;e<this.nVars();e++)this._decision.get(e)&&this.valueVar(f.valueOf(e))===o.UNDEF&&t.push(e);this._order_heap.build(t)}simplify(){if(this.decisionLevel()!==0)throw new Error("decisionLevel() != 0");return!this._ok||this.propagate()!==E.CRef_Undef?this._ok=!1:(this.nAssigns()===this._simpDB_assigns||this._simpDB_props>0||(this.removeSatisfied(this._learnts),this._remove_satisfied&&this.removeSatisfied(this._clauses),this.checkGarbage(),this.rebuildOrderHeap(),this._simpDB_assigns=this.nAssigns(),this._simpDB_props=this.clauses_literals+this.learnts_literals),!0)}search(t){if(!this._ok)throw new Error("!ok");let e=0,s=0;const a=new m;for(this.starts++;;){const r=this.propagate();if(r!==E.CRef_Undef){if(this.conflicts++,s++,this.decisionLevel()===0)return o.FALSE;if(a.clear(),e=this.analyze(r,a,e),this.cancelUntil(e),a.size()===1)this.uncheckedEnqueueSimple(a.get(0));else{const h=new E(a,!0,!0);this._learnts.push(h),this.attachClause(h),this.claBumpActivity(h),this.uncheckedEnqueue(a.get(0),h)}this.varDecayActivity(),this.claDecayActivity(),--this._learntsize_adjust_cnt===0&&(this._learntsize_adjust_confl*=this.learntsize_adjust_inc,this._learntsize_adjust_cnt=this._learntsize_adjust_confl,this._max_learnts*=this.learntsize_inc,this.verbosity>=1&&u.printf("| %9d | %7d %8d %8d | %8d %8d %6.0f | %6.3f %% |",this.conflicts,this.dec_vars-(this._trail_lim.size()===0?this._trail.size():this._trail_lim.get(0)),this.nClauses(),this.clauses_literals,this._max_learnts,this.nLearnts(),this.learnts_literals/this.nLearnts(),this.progressEstimate()*100))}else{if(t>=0&&s>=t||!this.withinBudget())return this._progress_estimate=this.progressEstimate(),this.cancelUntil(0),o.UNDEF;if(this.decisionLevel()===0&&!this.simplify())return o.FALSE;this._learnts.size()-this.nAssigns()>=this._max_learnts&&this.reduceDB();let h=p.UNDEF;for(;this.decisionLevel()<this._assumptions.size();){const n=this._assumptions.get(this.decisionLevel());if(this.valueLit(n)===o.TRUE)this.newDecisionLevel();else{if(this.valueLit(n)===o.FALSE)return this.analyzeFinal(n.not(),this.conflict),o.FALSE;h=n;break}}if(h.equals(p.UNDEF)&&(this.decisions++,h=this.pickBranchLit(),h.equals(p.UNDEF)))return o.TRUE;this.newDecisionLevel(),this.uncheckedEnqueueSimple(h)}}}progressEstimate(){let t=0;const e=1/this.nVars();for(let s=0;s<=this.decisionLevel();s++){const a=s===0?0:this._trail_lim.get(s-1),r=s===this.decisionLevel()?this._trail.size():this._trail_lim.get(s);t+=Math.pow(e,s)*(r-a)}return t/this.nVars()}static luby(t,e){let s,a;for(s=1,a=0;s<e+1;a++,s=2*s+1);for(;s-1!==e;)s=s-1>>1,a--,e=e%s;return Math.pow(t,a)}solve_(){if(this.model.clear(),this.conflict.clear(),!this._ok)return o.FALSE;this.solves++,this._max_learnts=this.nClauses()*this.learntsize_factor,this._learntsize_adjust_confl=this.learntsize_adjust_start_confl,this._learntsize_adjust_cnt=this._learntsize_adjust_confl;let t=o.UNDEF;this.verbosity>=1&&(u.printf("============================[ Search Statistics ]=============================="),u.printf("| Conflicts |          ORIGINAL         |          LEARNT          | Progress |"),u.printf("|           |    Vars  Clauses Literals |    Limit  Clauses Lit/Cl |          |"),u.printf("==============================================================================="));let e=0;for(;t===o.UNDEF;){const s=this.luby_restart?u.luby(this.restart_inc,e):Math.pow(this.restart_inc,e);if(t=this.search(s*this.restart_first),!this.withinBudget())break;e++}if(this.verbosity>=1&&u.printf("==============================================================================="),t===o.TRUE){this.model.growTo(this.nVars());for(let s=0;s<this.nVars();s++)this.model.set(s,this.valueVar(f.valueOf(s)))}else t===o.FALSE&&this.conflict.size()===0&&(this._ok=!1);return this.cancelUntil(0),t}static mapVar(t,e,s){return(e.size()<=t||e.get(t)===f.UNDEF)&&(e.growTo(t+1,f.UNDEF),e.set(t,f.valueOf(s[0]++))),e.get(t)}realocAll(t){}garbageCollect(){}static parse_DIMACS_main(t,e){const s=t.split(`
`);let a=0,r=0,h=0;const n=new m;for(const w of s){const l=w.trim().split(/\s+/);if(l.length===0)continue;let d=l.shift();if(d!==void 0&&d!=="c")if(d==="p"){if(d=l.shift(),d!=="cnf")throw new Error("PARSE ERROR! 'cnf' expected after 'p'");a=parseInt(l.shift(),10),r=parseInt(l.shift(),10)}else{for(++h,n.clear();;){const _=parseInt(d,10);if(_===0)break;const T=Math.abs(_)-1;for(;T>=e.nVars();)e.newVar();if(n.push(p.valueOfVar(T,_<0)),d=l.shift(),d===void 0)break}e.addClause_(n)}}if(a!==e.nVars())throw new Error("WARNING! DIMACS header mismatch: wrong number of variables.");if(h!==r)throw new Error("WARNING! DIMACS header mismatch: wrong number of clauses.")}};i(u,"VERBOSITY_DEFAULT",0),i(u,"VAR_DECAY_DEFAULT",.95),i(u,"CLAUSE_DECAY_DEFAULT",.999),i(u,"RANDOM_VAR_FREQ_DEFAULT",0),i(u,"RANDOM_SEED_DEFAULT",91648253),i(u,"CCMIN_MODE_DEFAULT",2),i(u,"PHASE_SAVING_DEFAULT",2),i(u,"RND_INIT_ACT_DEFAULT",!1),i(u,"LUBY_RESTART_DEFAULT",!0),i(u,"RESTART_FIRST_DEFAULT",100),i(u,"RESTART_INC_DEFAULT",2),i(u,"GARBAGE_FRAC_DEFAULT",.2);let N=u;window.assertions.enableAssert();const W=(c,t,e)=>(console.log(c),t.withCollectionNonredundant(e)),k=(c,t)=>{console.log(c,"composite");let e=t[0];for(let s=1;s<t.length;s++)e=W(`${c} ${s}`,e,t[s]);return e},A=(c,t)=>{console.log("DONE WITH",c,t)};k("foo",[v.deserialize(G.collection),v.deserialize(H.collection),v.deserialize($.collection),v.deserialize(P.collection)]);debugger;const V=W("squareOnlyEdge",v.deserialize(dt.collection),v.deserialize(P.collection));A("square-only-edge",V);const x=v.deserialize(H.collection);A("square-only-color",x);const B=k("squareOnlyEdgeSector",[v.deserialize(gt.collection),v.deserialize($.collection),V]);A("square-only-edge-sector",B);const Y=k("squareOnlyAll",[v.deserialize(pt.collection),v.deserialize(G.collection),x,B]);A("square-only-all",Y);const Q=k("generalEdge",[v.deserialize(_t.collection),v.deserialize(ft.collection),V]);A("general-edge",Q);const J=k("generalColor",[v.deserialize(vt.collection),x]);A("general-color",J);const X=k("generalEdgeSector",[v.deserialize(Et.collection),v.deserialize(wt.collection),Q,B]);A("general-edge-sector",X);const Ut=k("generalAll",[v.deserialize(zt.collection),v.deserialize(mt.collection),J,X,Y]);A("general-all",Ut);debugger;const F=new M,Dt=new M({renderer:"svg",children:[F]}),C=new tt(Dt,{allowWebGL:!0,allowBackingScaleAntialiasing:!0,allowSceneOverflow:!1});document.body.appendChild(C.domElement);C.setWidthHeight(window.innerWidth,window.innerHeight);console.log("test");(async()=>{const c=new et({x:10,y:10,align:"left"});F.addChild(c);const t=n=>{c.addChild(new st(n,{margin:5}))},e=it[0][0];t(new lt({patternBoard:e,planarPatternMap:at.get(e)},{labels:!0}));{const n=rt[0][0];console.log(ot.getSolutions(n,[])),console.log(ct(n))}ut.createImpliedChained([ht,...nt],[],{solveEdges:!0,solveFaceColors:!0,solveSectors:!0,highlander:!1}).forEach(n=>{console.log(JSON.stringify(n.serialize()))});const a=new N;[[1,2,3],[-1,-2],[-1,-3],[-2,-3],[4,5,6],[-4,-5],[-4,-6],[-5,-6],[7,8,9],[-7,-8],[-7,-9],[-8,-9],[10,11,12],[-10,-11],[-10,-12],[-11,-12],[-1,-7],[-2,-8],[-3,-9],[-4,-10],[-5,-11],[-6,-12],[-4,-7],[-5,-8],[-6,-9],[-7,-10],[-8,-11],[-9,-12],[-1,-4],[-2,-5],[-3,-6]].forEach(n=>a.addClauseFromArray(n));const h=a.solve();console.log("isSat",h),console.log(a.model.data);debugger;F.bounds.isValid()&&(C.setWidthHeight(Math.ceil(F.right+10),Math.ceil(F.bottom+10)),C.updateDisplay())})();
