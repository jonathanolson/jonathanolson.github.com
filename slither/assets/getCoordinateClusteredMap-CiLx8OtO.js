var Oa=Object.defineProperty;var xa=(o,e,t)=>e in o?Oa(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var ce=(o,e,t)=>(xa(o,typeof e!="symbol"?e+"":e,t),t);import{p as phetCore,q as inheritance,a as arrayRemove,O as Orientation,I as IOType,r as ValueIO,s as StateSchema,t as tandemNamespace,u as axon,P as Property,o as optionize,v as Timer,w as Validation,x as PhetioObject,y as validate,k as Tandem,z as assertMutuallyExclusiveOptions,l as TinyEmitter,A as VoidIO,F as FunctionIO,G as ArrayIO,N as NullableIO,H as IOTypeCache,J as StringIO,R as Range,K as NumberIO,L as ReadOnlyProperty,T as TinyProperty,Q as merge,c as combineOptions,U as propertyStateHandlerSingleton,W as PropertyStatePhase,X as derivationStack,n as Disposable,h as optionize3,Y as deprecationWarning,Z as EnumerationDeprecated,_ as EnumerationIO,D as DotUtils,$ as Namespace,a0 as extend,B as Bounds2,a1 as Transform3,b as Matrix3,V as Vector2,a2 as Poolable,a3 as Complex,M as Matrix,S as SingularValueDecomposition,a4 as Vector4,a5 as Ray2,E as EnumerationValue,i as Enumeration,d as dotRandom,a6 as Pool,a7 as BinPacker,j as Dimension2,a8 as toSVGNumber,a9 as EventType,aa as Random,ab as Permutation,ac as Vector3,ad as Vector2Property,ae as animationFrameTimer,af as Matrix3Type,ag as m3,ah as CompletePiecewiseLinearFunction,ai as LinearFunction,aj as TandemConstants,ak as DYNAMIC_ARCHETYPE_NAME,m as Combination}from"./Vector2Property-DUQoL60W.js";function arrayDifference(o,e,t,n,r){assert&&assert(Array.isArray(o)&&_.uniq(o).length===o.length,"a is not an array of unique items"),assert&&assert(Array.isArray(e)&&_.uniq(e).length===e.length,"b is not an array of unique items"),t=t||[],n=n||[],r=r||[],assert&&assert(Array.isArray(t)&&t.length===0),assert&&assert(Array.isArray(n)&&n.length===0),assert&&assert(Array.isArray(r)&&r.length===0),Array.prototype.push.apply(t,o),Array.prototype.push.apply(n,e);e:for(let s=0;s<t.length;s++){const a=t[s];for(let h=0;h<n.length;h++){const c=n[h];if(a===c){if(r.push(a),t.splice(s,1),n.splice(h,1),h=0,s===t.length)break e;s-=1}}}return t}phetCore.register("arrayDifference",arrayDifference);const assertHasProperties=(o,e)=>{assert&&o&&e.forEach(t=>{assert&&assert(Object.getOwnPropertyDescriptor(o,t)||_.some(inheritance(o.constructor).map(n=>Object.getOwnPropertyDescriptor(n.prototype,t))),`property not defined: ${t}`)})};phetCore.register("assertHasProperties",assertHasProperties);class AsyncLoader{constructor(){this.pendingLocks=[],this.loadComplete=!1,this.listeners=[]}reset(){this.loadComplete=!1}addListener(e){this.listeners.push(e)}proceedIfReady(){this.pendingLocks.length===0&&(assert&&assert(!this.loadComplete,"cannot complete load twice"),this.loadComplete=!0,this.listeners.forEach(e=>e()))}createLock(e){return assert&&assert(!this.loadComplete,"Cannot create more locks after load-step has completed"),this.pendingLocks.push(e),()=>{assert&&assert(this.pendingLocks.includes(e),"invalid lock"),arrayRemove(this.pendingLocks,e),this.proceedIfReady()}}}const asyncLoader=new AsyncLoader;phetCore.register("asyncLoader",asyncLoader);function cleanArray(o){if(assert&&assert(!o||Array.isArray(o),"cleanArray either takes an Array"),o){for(;o.length;)o.pop();return o}else return[]}phetCore.register("cleanArray",cleanArray);function collect(o){const e=[];return o(t=>{e.push(t)}),e}phetCore.register("collect",collect);function copyWithSortedKeys(o){if(Array.isArray(o))return o.map(copyWithSortedKeys);if(typeof o!="object"||o===null)return o;const e={};return Object.keys(o).sort().forEach(t=>{const n=o[t];e[t]=copyWithSortedKeys(n)}),e}phetCore.register("copyWithSortedKeys",copyWithSortedKeys);function detectPrefix(o,e){if(o[e]!==void 0)return e;if(e=e.charAt(0).toUpperCase()+e.slice(1),o[`moz${e}`]!==void 0)return`moz${e}`;if(o[`Moz${e}`]!==void 0)return`Moz${e}`;if(o[`webkit${e}`]!==void 0)return`webkit${e}`;if(o[`ms${e}`]!==void 0)return`ms${e}`;if(o[`o${e}`]!==void 0)return`o${e}`}phetCore.register("detectPrefix",detectPrefix);function detectPrefixEvent(o,e){if(o[`on${e}`]!==void 0)return e;if(o[`onmoz${e}`]!==void 0)return`moz${e}`;if(o[`onMoz${e}`]!==void 0)return`Moz${e}`;if(o[`onwebkit${e}`]!==void 0)return`webkit${e}`;if(o[`onms${e}`]!==void 0)return`ms${e}`;if(o[`ono${e}`]!==void 0)return`o${e}`}phetCore.register("detectPrefixEvent",detectPrefixEvent);function dimensionForEach(o,e,t){const n=[];function r(s,a){return a.forEach((h,c)=>{n.push(c),s===1?t(h,...n):r(s-1,h),n.pop()})}return r(o,e)}phetCore.register("dimensionForEach",dimensionForEach);function dimensionMap(o,e,t){const n=[];function r(s,a){return a.map((h,c)=>{n.push(c);const d=s===1?t(h,...n):r(s-1,h);return n.pop(),d})}return r(o,e)}phetCore.register("dimensionMap",dimensionMap);class EnumerationMap{constructor(e,t){this._map=new Map,this._enumeration=e,this._values=e.enumeration.values,this._values.forEach(n=>{assert&&assert(!this._map.has(n),"Enumeration key override problem"),this._map.set(n,t(n))})}get(e){return assert&&assert(this._values.includes(e)),assert&&assert(this._map.has(e)),this._map.get(e)}set(e,t){assert&&assert(this._values.includes(e)),this._map.set(e,t)}map(e){return new EnumerationMap(this._enumeration,t=>e(this.get(t),t))}forEach(e){this._values.forEach(t=>e(this.get(t),t))}values(){return this._values.map(e=>this.get(e))}}phetCore.register("EnumerationMap",EnumerationMap);function escapeHTML(o){return o.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")}phetCore.register("escapeHTML",escapeHTML);const is=class is{constructor(e,t){this.eventModel=e,this.eventCallback=t,this.period=this.eventModel.getPeriodBeforeNextEvent(),this.timeBeforeNextEvent=this.period}step(e){for(;e>=this.timeBeforeNextEvent;)e-=this.timeBeforeNextEvent,this.period=this.eventModel.getPeriodBeforeNextEvent(),this.timeBeforeNextEvent=this.period,this.eventCallback(e);this.timeBeforeNextEvent-=e}getRatio(){return(this.period-this.timeBeforeNextEvent)/this.period}};is.ConstantEventModel=class{constructor(t){this.rate=t,assert&&assert(t>0,"We need to have a strictly positive rate in order to prevent infinite loops.")}getPeriodBeforeNextEvent(){return 1/this.rate}},is.UniformEventModel=class{constructor(t,n){this.rate=t,this.pseudoRandomNumberSource=n,assert&&assert(t>0,"We need to have a strictly positive rate in order to prevent infinite loops.")}getPeriodBeforeNextEvent(){const t=this.pseudoRandomNumberSource();return assert&&assert(t>=0&&t<1,`Our uniform random number is outside of its expected range with a value of ${t}`),t*2/this.rate}},is.PoissonEventModel=class{constructor(t,n){this.rate=t,this.pseudoRandomNumberSource=n,assert&&assert(t>0,"We need to have a strictly positive poisson rate in order to prevent infinite loops.")}getPeriodBeforeNextEvent(){const t=this.pseudoRandomNumberSource();return assert&&assert(t>=0&&t<1,`Our uniform random number is outside of its expected range with a value of ${t}`),-Math.log(t)/this.rate}};let EventTimer=is;phetCore.register("EventTimer",EventTimer);function extendDefined(o,...e){return _.each(e,t=>{if(t)for(const n in t){const r=Object.getOwnPropertyDescriptor(t,n);r&&(typeof r.get=="function"||t[n]!==void 0)&&Object.defineProperty(o,n,r)}}),o}phetCore.register("extendDefined",extendDefined);const getGlobal=o=>{assert&&assert(o.trim()===o,"path must be trimmed");const e=_.get(window,o);return e!==void 0?e:null};phetCore.register("getGlobal",getGlobal);const gracefulBind=o=>{assert&&assert(o.split(".").length>1,"path must have multiple parts"),assert&&assert(o.trim()===o,"path must be trimmed");const e=o.split("."),t=e.pop(),n=_.get(window,e);return n?n[t].bind(n):null};phetCore.register("gracefulBind",gracefulBind);function identity(o){return o}phetCore.register("identity",identity);function interleave(o,e){assert&&assert(Array.isArray(o));const t=[],n=o.length*2-1;for(let r=0;r<n;r++)r%2===0?t.push(o[r/2]):t.push(e((r-1)/2));return t}phetCore.register("interleave",interleave);function loadScript(o){const e=typeof o=="string"?{src:o}:o,t=e.src,n=e.callback,r=e.async===void 0?!0:e.async,s=e.cacheBust===void 0?!1:e.cacheBust;let a=!1;const h=document.createElement("script");h.type="text/javascript",h.async=r,h.onload=h.onreadystatechange=function(){const d=this.readyState;d&&d!=="complete"&&d!=="loaded"||a||(a=!0,n&&n())},h.src=t+(s?`?random=${Math.random().toFixed(10)}`:"");const c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(h,c)}phetCore.register("loadScript",loadScript);function logGlobal(o){phet.log&&phet.log(`${o}: ${JSON.stringify(getGlobal(o),null,2)}`)}phetCore.register("logGlobal",logGlobal);function memoize(o){const e=new Map;return t=>{if(e.has(t))return e.get(t);{const n=o(t);return e.set(t,n),n}}}phetCore.register("memoize",memoize);class MipmapElement{constructor(e,t,n){this.width=e,this.height=t,this.url=n,this.img=new Image;const r=asyncLoader.createLock(this.img);this.img.onload=r,this.img.src=this.url,this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height;const s=this.canvas.getContext("2d");this.updateCanvas=()=>{this.img.complete&&(typeof this.img.naturalWidth>"u"||this.img.naturalWidth>0)&&(s.drawImage(this.img,0,0),delete this.updateCanvas)}}}phetCore.register("MipmapElement",MipmapElement);function mutate(o,e,t){assert&&assert(o),assert&&assert(Array.isArray(e)),t&&(assert&&assert(Object.getPrototypeOf(t)===Object.prototype,"Extra prototype on options object is a code smell"),_.each(e,n=>{assert&&assert(!t.hasOwnProperty(n)||t[n]!==void 0,`Undefined not allowed for key: ${n}`),t[n]!==void 0&&(o[n]=t[n])}))}phetCore.register("mutate",mutate);class OrientationPair extends EnumerationMap{constructor(e,t){super(Orientation,n=>n===Orientation.HORIZONTAL?e:t)}get horizontal(){return this.get(Orientation.HORIZONTAL)}set horizontal(e){this.set(Orientation.HORIZONTAL,e)}get vertical(){return this.get(Orientation.VERTICAL)}set vertical(e){this.set(Orientation.VERTICAL,e)}with(e,t){return new OrientationPair(e===Orientation.HORIZONTAL?t:this.horizontal,e===Orientation.VERTICAL?t:this.vertical)}static create(e){return new OrientationPair(e(Orientation.HORIZONTAL),e(Orientation.VERTICAL))}map(e){return new OrientationPair(e(this.horizontal,Orientation.HORIZONTAL),e(this.vertical,Orientation.VERTICAL))}}phetCore.register("OrientationPair",OrientationPair);function pairs(o){const e=[],t=o.length;if(t>1)for(let n=0;n<t-1;n++){const r=o[n];for(let s=n+1;s<t;s++)e.push([r,o[s]])}return e}phetCore.register("pairs",pairs);function partition(o,e){assert&&assert(Array.isArray(o));const t=[],n=[],r=o.length;for(let s=0;s<r;s++)e(o[s])?t.push(o[s]):n.push(o[s]);return[t,n]}phetCore.register("partition",partition);const PhysicalConstants={GRAVITATIONAL_CONSTANT:66743e-15,GRAVITY_ON_EARTH:9.81};phetCore.register("PhysicalConstants",PhysicalConstants);const ua=navigator.userAgent;function isIE(o){return getInternetExplorerVersion()===o}function isMobileSafari(){return!!(window.phet&&phet.chipper&&phet.chipper.queryParameters&&phet.chipper.queryParameters["phet-app"]||(ua.match(/(iPod|iPhone|iPad)/)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>=2)&&ua.match(/AppleWebKit/))}function getInternetExplorerVersion(){let o=-1,e=null;return navigator.appName==="Microsoft Internet Explorer"?(e=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"),e.exec(ua)!==null&&(o=parseFloat(RegExp.$1))):navigator.appName==="Netscape"&&(e=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),e.exec(ua)!==null&&(o=parseFloat(RegExp.$1))),o}const platform={firefox:ua.toLowerCase().includes("firefox"),mobileSafari:isMobileSafari(),safari5:!!(ua.match(/Version\/5\./)&&ua.match(/Safari\//)&&ua.match(/AppleWebKit/)),safari6:!!(ua.match(/Version\/6\./)&&ua.match(/Safari\//)&&ua.match(/AppleWebKit/)),safari7:!!(ua.match(/Version\/7\./)&&ua.match(/Safari\//)&&ua.match(/AppleWebKit/)),safari10:!!(ua.match(/Version\/10\./)&&ua.match(/Safari\//)&&ua.match(/AppleWebKit/)),safari11:!!(ua.match(/Version\/11\./)&&ua.match(/Safari\//)&&ua.match(/AppleWebKit/)),safari9:!!(ua.match(/Version\/9\./)&&ua.match(/Safari\//)&&ua.match(/AppleWebKit/)),safari:isMobileSafari()||!!(ua.match(/Version\//)&&ua.match(/Safari\//)&&ua.match(/AppleWebKit/)),ie:getInternetExplorerVersion()!==-1,ie9:isIE(9),ie10:isIE(10),ie11:isIE(11),android:ua.indexOf("Android")>0,edge:!!ua.match(/Edge\//),chromium:/chrom(e|ium)/.test(ua.toLowerCase())&&!ua.match(/Edge\//),chromeOS:ua.indexOf("CrOS")>0,mac:navigator.platform.includes("Mac")};phetCore.register("platform",platform);function required(o){return assert&&assert(o!==void 0,"Required field is undefined."),o}phetCore.register("required",required);function stripEmbeddingMarks(o){return o.replace(/\u202a|\u202b|\u202c/g,"")}phetCore.register("stripEmbeddingMarks",stripEmbeddingMarks);const placeholderObject={};function swapObjectKeys(o,e,t){const n=placeholderObject;let r=n,s=n;return o.hasOwnProperty(e)&&(r=o[e]),o.hasOwnProperty(t)&&(s=o[t]),r!==placeholderObject?o[t]=r:delete o[t],s!==placeholderObject?o[e]=s:delete o[e],o}phetCore.register("swapObjectKeys",swapObjectKeys);const BooleanIO=new IOType("BooleanIO",{supertype:ValueIO,valueType:"boolean",documentation:"PhET-iO Type for Javascript's boolean primitive type",stateSchema:StateSchema.asValue("boolean",{valueType:"boolean"}),toStateObject:_.identity});tandemNamespace.register("BooleanIO",BooleanIO);class BooleanProperty extends Property{constructor(e,t){const n=optionize()({valueType:"boolean",phetioValueType:BooleanIO},t);super(e,n)}toggle(){this.value=!this.value}}axon.register("BooleanProperty",BooleanProperty);const stepTimer=new Timer;axon.register("stepTimer",stepTimer);class CallbackTimer{constructor(e){this.callbacks=[],this._delay=400,this._interval=100,this.delayID=null,this.intervalID=null,this.fired=!1,(e==null?void 0:e.delay)!==void 0&&(this.delay=e.delay),(e==null?void 0:e.interval)!==void 0&&(this.interval=e.interval),e!=null&&e.callback&&this.callbacks.push(e.callback)}isRunning(){return this.delayID!==null||this.intervalID!==null}start(){this.isRunning()||(this.fired=!1,this.delayID=stepTimer.setTimeout(()=>{this.delayID=null,this.intervalID=stepTimer.setInterval(()=>this.fire(),this.interval),this.fire()},this.delay))}stop(e){this.isRunning()&&(this.delayID&&(stepTimer.clearTimeout(this.delayID),this.delayID=null),this.intervalID&&(stepTimer.clearInterval(this.intervalID),this.intervalID=null),e&&!this.fired&&this.fire())}addCallback(e){this.callbacks.includes(e)||this.callbacks.push(e)}removeCallback(e){const t=this.callbacks.indexOf(e);t!==-1&&this.callbacks.splice(t,1)}fire(){const e=this.callbacks.slice(0);for(let t=0;t<e.length;t++)e[t]();this.fired=!0}set delay(e){assert&&assert(e>=0,`bad value for delay: ${e}`),this._delay=e}get delay(){return this._delay}set interval(e){assert&&assert(e>0,`bad value for interval: ${e}`),this._interval=e}get interval(){return this._interval}dispose(){this.stop(!1),this.callbacks.length=0}}axon.register("CallbackTimer",CallbackTimer);const VALIDATE_OPTIONS_FALSE$1={validateValidator:!1},EMPTY_ARRAY$1=[];assert&&Object.freeze(EMPTY_ARRAY$1);const PARAMETER_KEYS=["name","phetioType","phetioDocumentation","phetioPrivate"].concat(Validation.VALIDATOR_KEYS),paramToPhetioType=o=>o.phetioType,paramToName=o=>o.name;class PhetioDataHandler extends PhetioObject{constructor(e){var r;const t=optionize()({parameters:EMPTY_ARRAY$1,hasListenerOrderDependencies:!1,phetioPlayback:PhetioObject.DEFAULT_OPTIONS.phetioPlayback,phetioEventMetadata:PhetioObject.DEFAULT_OPTIONS.phetioEventMetadata,phetioDocumentation:""},e);assert&&PhetioDataHandler.validateParameters(t.parameters,!!((r=t.tandem)!=null&&r.supplied)),assert&&assert(t.phetioType===void 0,"PhetioDataHandler sets its own phetioType. Instead provide parameter phetioTypes through `options.parameters` with a phetioOuterType");const n=t.parameters.filter(paramToPhetioType);t.phetioType=t.phetioOuterType(n.map(paramToPhetioType)),t.phetioPlayback&&(t.phetioEventMetadata=t.phetioEventMetadata||{},assert&&assert(!t.phetioEventMetadata.hasOwnProperty("dataKeys"),"dataKeys should be supplied by PhetioDataHandler, not elsewhere"),t.phetioEventMetadata.dataKeys=t.parameters.map(paramToName)),t.phetioDocumentation=PhetioDataHandler.getPhetioDocumentation(t.phetioDocumentation,n),super(t),this.parameters=t.parameters}static validateParameters(e,t){validate(e,{valueType:Array});let n=!1;for(let r=0;r<e.length;r++){const s=e[r];assert&&assert(Object.getPrototypeOf(s)===Object.prototype,"Extra prototype on parameter object is a code smell"),n=n||s.phetioPrivate,assert&&n&&assert(s.phetioPrivate,"after first phetioPrivate parameter, all subsequent parameters must be phetioPrivate"),assert&&t&&Tandem.VALIDATION&&assert(s.phetioType||s.phetioPrivate,"instrumented Emitters must include phetioType for each parameter or be marked as `phetioPrivate`."),assert&&s.phetioType&&assert(s.name,"`name` is a required parameter for phet-io instrumented parameters."),assert&&assertMutuallyExclusiveOptions(s,["phetioPrivate"],["name","phetioType","phetioDocumentation"]),assert&&assert(_.intersection(Object.keys(s),Validation.VALIDATOR_KEYS).length>0,`validator must be specified for parameter ${r}`);for(const a in s)assert&&assert(PARAMETER_KEYS.includes(a),`unrecognized parameter key: ${a}`);assert&&Object.freeze(e[r]),Validation.validateValidator(s)}assert&&Object.freeze(e)}validateArguments(...e){assert&&assert(e.length===this.parameters.length,`Emitted unexpected number of args. Expected: ${this.parameters.length} and received ${e.length}`);for(let t=0;t<this.parameters.length;t++){const n=this.parameters[t];assert&&validate(e[t],n,VALIDATE_OPTIONS_FALSE$1),n.phetioType&&!n.valueType&&assert&&validate(e[t],n.phetioType.validator,VALIDATE_OPTIONS_FALSE$1)}}getValidationErrors(...e){return assert&&assert(e.length===this.parameters.length,`Emitted unexpected number of args. Expected: ${this.parameters.length} and received ${e.length}`),this.parameters.map((t,n)=>Validation.getValidationError(e[n],t,VALIDATE_OPTIONS_FALSE$1))}getPhetioData(...e){assert&&assert(Tandem.PHET_IO_ENABLED,"should only get phet-io data in phet-io brand");let t=null;if(this.parameters.length>0){t={};for(let n=0;n<this.parameters.length;n++){const r=this.parameters[n];r.phetioPrivate||(assert&&assert(r.name,"name required"),t[r.name]=r.phetioType.toStateObject(e[n]))}}return t}static getPhetioDocumentation(e,t){const n=r=>{const s=r.phetioDocumentation?` - ${r.phetioDocumentation}`:"";return`<li>${r.name}: ${r.phetioType.typeName}${s}</li>`};return e+(t.length===0?"<br>No parameters.":`<br>The parameters are:<br/><ol>${t.map(n).join("<br/>")}</ol>`)}}axon.register("PhetioDataHandler",PhetioDataHandler);const PHET_IO_STATE_DEFAULT$2=!1,Di=class Di extends PhetioDataHandler{constructor(e){const t=optionize()({reentrantNotificationStrategy:"stack",phetioOuterType:Di.EmitterIO,phetioState:PHET_IO_STATE_DEFAULT$2},e);super(t),this.tinyEmitter=new TinyEmitter(null,t.hasListenerOrderDependencies,t.reentrantNotificationStrategy)}emit(...e){assert&&assert(this.tinyEmitter instanceof TinyEmitter,"Emitter should not emit until constructor complete"),assert&&this.validateArguments(...e),Tandem.PHET_IO_ENABLED&&this.isPhetioInstrumented()&&this.phetioStartEvent("emitted",{data:this.getPhetioData(...e)}),this.tinyEmitter.emit(...e),Tandem.PHET_IO_ENABLED&&this.isPhetioInstrumented()&&this.phetioEndEvent()}dispose(){this.tinyEmitter.dispose(),super.dispose()}addListener(e){this.tinyEmitter.addListener(e)}removeListener(e){this.tinyEmitter.removeListener(e)}removeAllListeners(){this.tinyEmitter.removeAllListeners()}hasListener(e){return this.tinyEmitter.hasListener(e)}hasListeners(){return this.tinyEmitter.hasListeners()}getListenerCount(){return this.tinyEmitter.getListenerCount()}debug(e){const t=(...n)=>console.log(e,...n);return this.addListener(t),t}};Di.EmitterIO=e=>{const t=e.map(getTypeName$1).join(",");return cache$6.has(t)||cache$6.set(t,new IOType(`EmitterIO<${e.map(getTypeName$1).join(", ")}>`,{valueType:Di,documentation:"Emits when an event occurs and calls added listeners.",parameterTypes:e,events:["emitted"],metadataDefaults:{phetioState:PHET_IO_STATE_DEFAULT$2},methods:{addListener:{returnType:VoidIO,parameterTypes:[FunctionIO(VoidIO,e)],implementation:Di.prototype.addListener,documentation:"Adds a listener which will be called when the emitter emits."},removeListener:{returnType:VoidIO,parameterTypes:[FunctionIO(VoidIO,e)],implementation:Di.prototype.removeListener,documentation:"Remove a listener."},emit:{returnType:VoidIO,parameterTypes:e,implementation:function(...n){this.emit(...n)},documentation:"Emits a single event to all listeners.",invocableForReadOnlyElements:!1},getValidationErrors:{returnType:ArrayIO(NullableIO(StringIO)),parameterTypes:e,implementation:function(...n){return this.getValidationErrors(...n)},documentation:"Checks to see if the proposed values are valid. Returns an array of length N where each element is an error (string) or null if the value is valid."}}})),cache$6.get(t)};let Emitter=Di;const getTypeName$1=o=>o.typeName,cache$6=new IOTypeCache;axon.register("Emitter",Emitter);const VALID_INTEGER={valueType:"number",isValidValue:o=>o%1===0,validationMessage:"Should be a valid integer"},VALID_NON_NAN={isValidValue:o=>!isNaN(o),validationMessage:"Should not be NaN"},VALIDATE_OPTIONS_FALSE={validateValidator:!1},VALID_NUMBER_TYPES=["FloatingPoint","Integer"],RANGE_PROPERTY_TANDEM_NAME="rangeProperty",DEFAULT_RANGE=Range.EVERYTHING,PropertyIOImpl=Property.PropertyIO(NumberIO),ss=class ss extends Property{constructor(e,t){var d;assert&&t&&assertMutuallyExclusiveOptions(["range"],["validValues"]);const n=optionize()({numberType:"FloatingPoint",range:DEFAULT_RANGE,validators:[],phetioOuterType:()=>ss.NumberPropertyIO},t);n.rangePropertyOptions=optionize()({phetioDocumentation:"Provides the range of possible values for the parent NumberPropertyIO",phetioValueType:Range.RangeIO,phetioReadOnly:!0,tandem:n.range!==DEFAULT_RANGE?(d=n.tandem)==null?void 0:d.createTandem(RANGE_PROPERTY_TANDEM_NAME):Tandem.OPT_OUT},n.rangePropertyOptions),assert&&Tandem.VALIDATION&&n.rangePropertyOptions.tandem&&n.rangePropertyOptions.tandem.supplied&&assert&&assert(n.rangePropertyOptions.tandem.name===RANGE_PROPERTY_TANDEM_NAME,`rangePropertyOptions.tandem.name must be ${RANGE_PROPERTY_TANDEM_NAME}: ${n.rangePropertyOptions.tandem.name}`),n.valueType="number",n.phetioValueType=NumberIO;const s=!(n.range&&n.range instanceof ReadOnlyProperty),a=n.range instanceof ReadOnlyProperty?n.range:new Property(n.range,n.rangePropertyOptions);n.validators.push(VALID_NON_NAN),n.numberType==="Integer"&&n.validators.push(VALID_INTEGER);let h=!1;n.validators.push({isValidValue:y=>a.value.contains(y),validationMessage:()=>`Number value ${h?this.value:e} must be within rangeProperty value: ${a.value}`}),super(e,n),h=!0,this.numberType=n.numberType,this.rangeProperty=a,assert&&Tandem.VALIDATION&&this.rangeProperty.isPhetioInstrumented()&&assert&&assert(this.isPhetioInstrumented(),"NumberProperty must be phet-io instrumented if the range is");const c=()=>{validate(this.value,this.valueValidator,VALIDATE_OPTIONS_FALSE)};if(assert&&this.rangeProperty.link(c),this.rangeProperty.addPhetioStateDependencies([this]),this.addPhetioStateDependencies([this.rangeProperty]),n.validValues&&this.validateNumberAndRangeProperty)for(let y=0;y<n.validValues.length;y++){const g=n.validValues[y];this.validateNumberAndRangeProperty(g)}this.disposeNumberProperty=()=>{s?this.rangeProperty.dispose():assert&&this.rangeProperty.unlink(c)},this.resetNumberProperty=()=>{s&&this.rangeProperty.reset()}}get range(){return this.rangeProperty.value}set range(e){this.rangeProperty.value=e}reset(){this.resetValueAndRange(),super.reset()}dispose(){this.disposeNumberProperty(),super.dispose()}setValueAndRange(e,t){assert&&assert(t.contains(e),`value ${e} is not in range [${t.min},${t.max}]`),this.setDeferred(!0),this.rangeProperty.setDeferred(!0),this.set(e),this.rangeProperty.set(t);const n=this.setDeferred(!1),r=this.rangeProperty.setDeferred(!1);n&&n(),r&&r()}resetValueAndRange(){this.setValueAndRange(this.initialValue,this.rangeProperty.initialValue)}toStateObject(){const e=PropertyIOImpl.toStateObject(this);e.numberType=this.numberType,e.range=Range.RangeIO.toStateObject(this.rangeProperty.value);const t=this.rangeProperty&&this.rangeProperty.isPhetioInstrumented();return e.rangePhetioID=t?this.rangeProperty.tandem.phetioID:null,e}};ss.NumberPropertyIO=new IOType("NumberPropertyIO",{valueType:ss,supertype:PropertyIOImpl,parameterTypes:[NumberIO],documentation:`Extends PropertyIO to add values for the numeric range ( min, max ) and numberType ( '${VALID_NUMBER_TYPES.join("' | '")}' )`,toStateObject:e=>e.toStateObject(),applyState:(e,t)=>{PropertyIOImpl.applyState(e,t)},stateSchema:{numberType:StringIO,range:Range.RangeIO,rangePhetioID:NullableIO(StringIO)}});let NumberProperty=ss;axon.register("NumberProperty",NumberProperty);const isSettingPhetioStateProperty=new TinyProperty(!1);tandemNamespace.register("isSettingPhetioStateProperty",isSettingPhetioStateProperty);const createObservableArray=o=>{var d,y,g,D;assertMutuallyExclusiveOptions(o,["length"],["elements"]);const e=optionize()({hasListenerOrderDependencies:!1,length:0,elements:[],elementAddedEmitterOptions:{},elementRemovedEmitterOptions:{},lengthPropertyOptions:{}},o);let t=null;if(e.phetioType)assert&&assert(e.phetioType.typeName.startsWith("ObservableArrayIO")),t={name:"value",phetioType:e.phetioType.parameterTypes[0]};else if(Validation.getValidatorValidationError(e))t=merge({name:"value"},{isValidValue:_.stubTrue});else{const O=_.pick(e,Validation.VALIDATOR_KEYS);t=merge({name:"value"},O)}const n=new Emitter(combineOptions({tandem:(d=e.tandem)==null?void 0:d.createTandem("elementAddedEmitter"),parameters:[t],phetioReadOnly:!0,hasListenerOrderDependencies:e.hasListenerOrderDependencies},e.elementAddedEmitterOptions)),r=new Emitter(combineOptions({tandem:(y=e.tandem)==null?void 0:y.createTandem("elementRemovedEmitter"),parameters:[t],phetioReadOnly:!0,hasListenerOrderDependencies:e.hasListenerOrderDependencies},e.elementRemovedEmitterOptions)),s=new NumberProperty(0,combineOptions({numberType:"Integer",tandem:(g=e.tandem)==null?void 0:g.createTandem("lengthProperty"),phetioReadOnly:!0,hasListenerOrderDependencies:e.hasListenerOrderDependencies},e.lengthPropertyOptions)),a=[];assert&&n.addListener(()=>{isSettingPhetioStateProperty.value||assert&&assert(s.value===a.length,"lengthProperty out of sync while adding element")}),assert&&r.addListener(()=>{isSettingPhetioStateProperty.value||assert&&assert(s.value===a.length,"lengthProperty out of sync while removing element")});const h=new Proxy(a,{get:function(O,V,k){return assert&&assert(O===a,"array should match the targetArray"),methods.hasOwnProperty(V)?methods[V]:Reflect.get(O,V,k)},set:function(O,V,k){assert&&assert(O===a,"array should match the targetArray");const M=O[V];let N=null;V==="length"&&(N=O.slice(k));const F=Reflect.set(O,V,k),G=Number(V);return Number.isInteger(G)&&G>=0&&M!==k?(s.value=O.length,M!==void 0&&r.emit(O[V]),k!==void 0&&n.emit(k)):V==="length"&&(s.value=k,assert&&assert(N,"removedElements should be defined for key===length"),N&&N.forEach(ie=>r.emit(ie))),F},deleteProperty:function(O,V){assert&&assert(O===a,"array should match the targetArray");const k=Number(V);let M;Number.isInteger(k)&&k>=0&&(M=O[V]);const N=Reflect.deleteProperty(O,V);return M!==void 0&&r.emit(M),N}});h.targetArray=a,h.elementAddedEmitter=n,h.elementRemovedEmitter=r,h.lengthProperty=s;const c=()=>{e.length>=0&&(h.length=e.length),e.elements.length>0&&Array.prototype.push.apply(h,e.elements)};return c(),h.reset=()=>{h.length=0,c()},(D=e.tandem)!=null&&D.supplied&&(assert&&assert(e.phetioType),h.phetioElementType=e.phetioType.parameterTypes[0],h._observableArrayPhetioObject=new ObservableArrayPhetioObject(h,e)),h};class ObservableArrayPhetioObject extends PhetioObject{constructor(e,t){super(t),this.observableArray=e}}const methods={pop(...o){const e=this,t=e.targetArray.length,n=Array.prototype.pop.apply(e.targetArray,o);return e.lengthProperty.value=e.length,t>0&&e.elementRemovedEmitter.emit(n),n},shift(...o){const e=this,t=e.targetArray.length,n=Array.prototype.shift.apply(e.targetArray,o);return e.lengthProperty.value=e.length,t>0&&e.elementRemovedEmitter.emit(n),n},push(...o){const e=this,t=Array.prototype.push.apply(e.targetArray,o);e.lengthProperty.value=e.length;for(let n=0;n<arguments.length;n++)e.elementAddedEmitter.emit(o[n]);return t},unshift(...o){const e=this,t=Array.prototype.unshift.apply(e.targetArray,o);e.lengthProperty.value=e.length;for(let n=0;n<o.length;n++)e.elementAddedEmitter.emit(o[n]);return t},splice(...o){const e=this,t=Array.prototype.splice.apply(e.targetArray,o);e.lengthProperty.value=e.length;const n=t;for(let r=2;r<o.length;r++)e.elementAddedEmitter.emit(o[r]);return n.forEach(r=>e.elementRemovedEmitter.emit(r)),t},copyWithin(...o){const e=this,t=e.targetArray.slice(),n=Array.prototype.copyWithin.apply(e.targetArray,o);return reportDifference(t,e),n},fill(...o){const e=this,t=e.targetArray.slice(),n=Array.prototype.fill.apply(e.targetArray,o);return reportDifference(t,e),n},get:function(o){return this[o]},addItemAddedListener:function(o){this.elementAddedEmitter.addListener(o)},removeItemAddedListener:function(o){this.elementAddedEmitter.removeListener(o)},addItemRemovedListener:function(o){this.elementRemovedEmitter.addListener(o)},removeItemRemovedListener:function(o){this.elementRemovedEmitter.removeListener(o)},add:function(o){this.push(o)},addAll:function(o){this.push(...o)},remove:function(o){arrayRemove(this,o)},removeAll:function(o){o.forEach(e=>arrayRemove(this,e))},clear:function(){for(;this.length>0;)this.pop()},count:function(o){let e=0;for(let t=0;t<this.length;t++)o(this[t])&&e++;return e},find:function(o,e){return assert&&e!==void 0&&assert(typeof e=="number","fromIndex must be numeric, if provided"),assert&&typeof e=="number"&&assert(e>=0&&e<this.length,`fromIndex out of bounds: ${e}`),_.find(this,o,e)},shuffle:function(o){assert&&assert(o,"random must be supplied");const e=o.shuffle(this);this.targetArray.length=0,Array.prototype.push.apply(this.targetArray,e)},getArrayCopy:function(){return this.slice()},dispose:function(){const o=this;o.elementAddedEmitter.dispose(),o.elementRemovedEmitter.dispose(),o.lengthProperty.dispose(),o._observableArrayPhetioObject&&o._observableArrayPhetioObject.dispose()},toStateObject:function(){return{array:this.map(o=>this.phetioElementType.toStateObject(o))}},applyState:function(o){this.length=0;const e=o.array.map(t=>this.phetioElementType.fromStateObject(t));this.push(...e)}},reportDifference=(o,e)=>{const t=o,n=e.targetArray.slice();for(let r=0;r<t.length;r++){const s=t[r],a=n.indexOf(s);a>=0&&(t.splice(r,1),n.splice(a,1),r--)}t.forEach(r=>e.elementRemovedEmitter.emit(r)),n.forEach(r=>e.elementAddedEmitter.emit(r))},cache$5=new IOTypeCache,ObservableArrayIO=o=>(cache$5.has(o)||cache$5.set(o,new IOType(`ObservableArrayIO<${o.typeName}>`,{valueType:ObservableArrayPhetioObject,parameterTypes:[o],toStateObject:e=>e.observableArray.toStateObject(),applyState:(e,t)=>e.observableArray.applyState(t),stateSchema:{array:ArrayIO(o)}})),cache$5.get(o));createObservableArray.ObservableArrayIO=ObservableArrayIO;axon.register("createObservableArray",createObservableArray);const DERIVED_PROPERTY_IO_PREFIX="DerivedPropertyIO",strictAxonDependenciesGlobal=_.hasIn(window,"phet.chipper.queryParameters")&&phet.chipper.queryParameters.strictAxonDependencies;function getDerivedValue(o,e,t){assert&&strictAxonDependenciesGlobal&&o&&derivationStack.push(t);try{return e(...t.map(n=>n.get()))}finally{assert&&strictAxonDependenciesGlobal&&o&&derivationStack.pop()}}class DerivedProperty extends ReadOnlyProperty{constructor(e,t,n){const r=optionize()({phetioReadOnly:!0,phetioOuterType:DerivedProperty.DerivedPropertyIO,phetioLinkDependencies:!0,strictAxonDependencies:!0},n);assert&&assert(e.every(_.identity),"dependencies should all be truthy"),assert&&assert(e.length===_.uniq(e).length,"duplicate dependencies");const s=getDerivedValue(r.strictAxonDependencies,t,e);super(s,r),Tandem.VALIDATION&&this.isPhetioInstrumented()&&assert&&assert(this.phetioType.typeName.startsWith("DerivedPropertyIO"),"phetioType should be DerivedPropertyIO"),this.dependencies=e,this.derivation=t,this.strictAxonDependencies=r.strictAxonDependencies,this.derivedPropertyListener=this.getDerivedPropertyListener.bind(this),e.forEach(a=>{if(a.lazyLink(this.derivedPropertyListener),Tandem.PHET_IO_ENABLED&&this.isPhetioInstrumented()&&a instanceof PhetioObject&&a.isPhetioInstrumented()&&(a instanceof ReadOnlyProperty&&propertyStateHandlerSingleton.registerPhetioOrderDependency(a,PropertyStatePhase.UNDEFER,this,PropertyStatePhase.UNDEFER),r.tandem&&r.phetioLinkDependencies)){const h=r.tandem.createTandem("dependencies");this.addLinkedElement(a,{tandem:h.createTandemFromPhetioID(a.tandem.phetioID)})}})}hasDependency(e){return this.definedDependencies.includes(e)}get definedDependencies(){return assert&&assert(this.dependencies!==null,"Dependencies should be defined, has this Property been disposed?"),this.dependencies}getDerivedPropertyListener(){this.isDisposed||(this.isDeferred?this.hasDeferredValue=!0:super.set(getDerivedValue(this.strictAxonDependencies,this.derivation,this.definedDependencies)))}recomputeDerivation(){this.getDerivedPropertyListener()}dispose(){const e=this.definedDependencies;for(let t=0;t<e.length;t++){const n=e[t];n.hasListener(this.derivedPropertyListener)&&n.unlink(this.derivedPropertyListener)}this.dependencies=null,super.dispose()}setDeferred(e){return this.isDeferred&&!e&&(this.deferredValue=getDerivedValue(this.strictAxonDependencies,this.derivation,this.definedDependencies)),super.setDeferred(e)}static valueEquals(e,t,n){return new DerivedProperty([e,t],(r,s)=>r===s,n)}static valueEqualsConstant(e,t,n){return new DerivedProperty([e],r=>r===t,n)}static and(e,t){return assert&&assert(e.length>0,"must provide a dependency"),DerivedProperty.deriveAny(e,()=>_.reduce(e,andFunction,!0),t)}static or(e,t){return assert&&assert(e.length>0,"must provide a dependency"),DerivedProperty.deriveAny(e,()=>_.reduce(e,orFunction,!1),t)}static multiply(e,t){return assert&&assert(e.length>0,"must provide a dependency"),DerivedProperty.deriveAny(e,()=>_.reduce(e,multiplyFunction,1),t)}static add(e,t){return assert&&assert(e.length>0,"must provide a dependency"),DerivedProperty.deriveAny(e,()=>_.reduce(e,addFunction,0),t)}static not(e,t){return new DerivedProperty([e],n=>!n,t)}static deriveAny(e,t,n){return new DerivedProperty(e,t,n)}}const andFunction=(o,e)=>o&&e.value,orFunction=(o,e)=>(assert&&assert(typeof e.value=="boolean","boolean value required"),o||e.value),multiplyFunction=(o,e)=>(assert&&assert(typeof e.value=="number","number value required"),o*e.value),addFunction=(o,e)=>(assert&&assert(typeof e.value=="number","number value required"),o+e.value),cache$4=new IOTypeCache;DerivedProperty.DerivedPropertyIO=o=>(assert&&assert(o,"DerivedPropertyIO needs parameterType"),cache$4.has(o)||cache$4.set(o,new IOType(`${DERIVED_PROPERTY_IO_PREFIX}<${o.typeName}>`,{valueType:DerivedProperty,parameterTypes:[o],supertype:Property.PropertyIO(o),documentation:"Like PropertyIO, but not settable.  Instead it is derived from other DerivedPropertyIO or PropertyIO instances",applyState:_.noop,methods:{setValue:{returnType:VoidIO,parameterTypes:[o],implementation:DerivedProperty.prototype.set,documentation:"Errors out when you try to set a derived property.",invocableForReadOnlyElements:!1}}})),cache$4.get(o));class DerivedProperty1 extends DerivedProperty{}class DerivedProperty2 extends DerivedProperty{}class DerivedProperty4 extends DerivedProperty{}class DerivedProperty5 extends DerivedProperty{}axon.register("DerivedProperty",DerivedProperty);class DerivedStringProperty extends DerivedProperty{constructor(e,t,n){const r=optionize()({phetioFeatured:!0,phetioValueType:StringIO,tandemNameSuffix:"StringProperty"},n);super(e,t,r)}}axon.register("DerivedStringProperty",DerivedStringProperty);class DynamicProperty extends ReadOnlyProperty{constructor(e,t){const n=optionize()({bidirectional:!1,defaultValue:null,derive:_.identity,map:_.identity,inverseMap:_.identity},t),r=n.derive,s=n.map,a=n.inverseMap,h=typeof r=="function"?r:g=>g[r],c=typeof s=="function"?s:g=>g[s],d=typeof a=="function"?a:g=>g[a],y=e.value===null?c(n.defaultValue):c(h(e.value).value);super(y,n),this.defaultValue=n.defaultValue,this.derive=h,this.map=c,this.inverseMap=d,this.bidirectional=n.bidirectional,this.valuePropertyProperty=e,this.isExternallyChanging=!1,this.propertyPropertyListener=this.onPropertyPropertyChange.bind(this),this.propertyListener=this.onPropertyChange.bind(this),e.link(this.propertyListener),n.bidirectional&&this.lazyLink(this.onSelfChange.bind(this))}onPropertyPropertyChange(e,t,n){this.bidirectional&&this.valuePropertyProperty.value!==null&&n&&this.derive(this.valuePropertyProperty.value)===n&&n.areValuesEqual(this.inverseMap(this.value),n.get())||super.set(this.map(e))}onPropertyChange(e,t){t&&this.derive(t).unlink(this.propertyPropertyListener),e?this.derive(e).link(this.propertyPropertyListener):this.onPropertyPropertyChange(this.defaultValue,null,null)}onSelfChange(e){if(assert&&assert(this.bidirectional),this.valuePropertyProperty.value!==null){const t=this.derive(this.valuePropertyProperty.value);this.areValuesEqual(e,this.map(t.value))||(t.value=this.inverseMap(e))}}dispose(){this.valuePropertyProperty.unlink(this.propertyListener),this.valuePropertyProperty.value!==null&&this.derive(this.valuePropertyProperty.value).unlink(this.propertyPropertyListener),super.dispose()}reset(){assert&&assert(this.bidirectional,"Cannot reset a non-bidirectional DynamicProperty"),this.valuePropertyProperty.value!==null&&this.derive(this.valuePropertyProperty.value).reset()}set(e){assert&&assert(this.bidirectional,`Cannot set values directly to a non-bidirectional DynamicProperty, tried to set: ${e}`),this.isExternallyChanging=!0,super.set(e),this.isExternallyChanging=!1}get value(){return super.value}set value(e){this.set(e)}isSettable(){return super.isSettable()||this.bidirectional}}axon.register("DynamicProperty",DynamicProperty);const TANDEM_NAME="enabledProperty";class EnabledProperty extends BooleanProperty{constructor(e,t){const n=optionize()({phetioDocumentation:"Determines whether the element is enabled (true) or disabled (false).",phetioFeatured:!0,checkTandemName:!0},t);assert&&n&&n.tandem&&n.tandem.supplied&&n.checkTandemName&&assert&&assert(n.tandem.name===TANDEM_NAME,`EnabledProperty tandems should be named ${TANDEM_NAME}`),super(e,n)}static get TANDEM_NAME(){return TANDEM_NAME}}axon.register("EnabledProperty",EnabledProperty);const DEFAULT_OPTIONS$9={enabledProperty:null,enabled:!0,enabledPropertyOptions:null,phetioEnabledPropertyInstrumented:!0,tandem:PhetioObject.DEFAULT_OPTIONS.tandem};class EnabledComponent extends Disposable{constructor(e){const t=optionize3()({},DEFAULT_OPTIONS$9,e),n=!t.enabledProperty;assert&&t.enabledPropertyOptions&&assert(!(!t.phetioEnabledPropertyInstrumented&&t.enabledPropertyOptions.tandem),"incompatible options. Cannot specify phetioEnabledPropertyInstrumented opt out and a Tandem via enabledPropertyOptions."),super(t),this.enabledProperty=t.enabledProperty||new EnabledProperty(t.enabled,merge({tandem:t.phetioEnabledPropertyInstrumented?t.tandem.createTandem(EnabledProperty.TANDEM_NAME):Tandem.OPT_OUT},t.enabledPropertyOptions)),this.disposeEnabledComponent=()=>{n&&this.enabledProperty.dispose()}}setEnabled(e){assert&&assert(this.enabledProperty.isSettable(),"cannot set enabledProperty"),this.enabledProperty.value=e}set enabled(e){this.setEnabled(e)}get enabled(){return this.isEnabled()}isEnabled(){return this.enabledProperty.value}dispose(){this.disposeEnabledComponent(),super.dispose()}}axon.register("EnabledComponent",EnabledComponent);class EnumerationDeprecatedProperty extends Property{constructor(e,t,n){deprecationWarning("Use EnumerationProperty. EnumerationDeprecated should be exchanged for classes that extend EnumerationValue, see WilderEnumerationPatterns for examples."),assert&&assert(e instanceof EnumerationDeprecated,"likely you are using the new and improved Enumeration, better use EnumerationProperty too."),assert&&assert(e.VALUES.includes(t),`invalid initialValue: ${t}`),n&&(assert&&assert(!n.hasOwnProperty("isValidValue"),"EnumerationDeprecatedProperty does not support isValidValue"),assert&&assert(!n.hasOwnProperty("valueType"),"EnumerationDeprecatedProperty sets valueType"),assert&&assert(!n.hasOwnProperty("phetioType"),"EnumerationDeprecatedProperty sets phetioType")),n=merge({valueType:e,phetioValueType:EnumerationIO(e),validValues:e.VALUES},n),super(t,n),this.enumeration=e}}axon.register("EnumerationDeprecatedProperty",EnumerationDeprecatedProperty);class EnumerationProperty extends Property{constructor(e,t){const n=optionize()({enumeration:e.enumeration},t),r=optionize()({validValues:n.enumeration.values,phetioValueType:EnumerationIO({enumeration:n.enumeration})},n);super(e,r)}}axon.register("EnumerationProperty",EnumerationProperty);class MappedProperty extends DynamicProperty{constructor(e,t){super(new TinyProperty(e),t)}}axon.register("MappedProperty",MappedProperty);class Multilink{constructor(e,t,n){if(this.dependencies=e,assert&&assert(e.every(_.identity),"dependencies should all be truthy"),assert&&assert(e.length===_.uniq(e).length,"duplicate dependencies"),this.dependencyListeners=new Map,e.forEach(r=>{const s=()=>{if(!this.isDisposed){const a=e.map(h=>h.get());t(...a)}};this.dependencyListeners.set(r,s),r.lazyLink(s,{phetioDependencies:_.without(e,r)})}),!n){const r=e.map(s=>s.get());t(...r)}this.isDisposed=!1}get definedDependencies(){return assert&&assert(this.dependencies!==null,"Dependencies should be defined, has this Property been disposed?"),this.dependencies}dispose(){assert&&assert(this.dependencies,"A Multilink cannot be disposed twice.");const e=this.definedDependencies;for(let t=0;t<e.length;t++){const n=e[t],r=this.dependencyListeners.get(n);assert&&assert(r,"The listener should exist"),n.hasListener(r)&&n.unlink(r)}this.dependencies=null,this.dependencyListeners.clear(),this.isDisposed=!0}static multilink(e,t){return new Multilink(e,t,!1)}static multilinkAny(e,t){return new Multilink(e,t)}static lazyMultilink(e,t){return new Multilink(e,t,!0)}static lazyMultilinkAny(e,t){return new Multilink(e,t,!0)}static unmultilink(e){e.dispose()}}axon.register("Multilink",Multilink);const ObservableArrayDef={isObservableArray(o){return!!(Array.isArray(o)&&o.elementAddedEmitter&&o.elementRemovedEmitter&&o.lengthProperty)}};axon.register("ObservableArrayDef",ObservableArrayDef);function isTReadOnlyProperty(o){return o instanceof ReadOnlyProperty||o instanceof TinyProperty}const stringify=o=>`${o}`;class PatternStringProperty extends DerivedStringProperty{constructor(e,t,n){assert&&assert(!(t.tandem instanceof Tandem),"Did you intend to put tandem in providedOptions?");const r=optionize()({formatNames:[],decimalPlaces:null,phetioFeatured:!0,tandemNameSuffix:"StringProperty"},n),s=[e],a={},h=Object.keys(t);h.forEach(c=>{const d=t[c];isTReadOnlyProperty(d)&&s.push(d);let y=stringify;if(r.decimalPlaces!==null&&(typeof r.decimalPlaces=="number"||r.decimalPlaces[c]!==null)){const g=typeof r.decimalPlaces=="number"||r.decimalPlaces===null?r.decimalPlaces:r.decimalPlaces[c];assert&&assert(g!==null),y=D=>stringify(typeof D=="number"?DotUtils.toFixed(D,g):D)}r.maps&&r.maps.hasOwnProperty(c)?a[c]=g=>y(r.maps[c](g)):a[c]=y}),super(s,(...c)=>{const d=D=>{const O=s.indexOf(D);return O>=0?c[O]:D};let y=`${d(e)}`;r.formatNames.forEach((D,O)=>{y=y.replace(new RegExp(`\\{${O}\\}`,"g"),`{{${D}}}`)});const g=y.match(/\{\{[^{}]+\}\}/g)||[];for(let D=0;D<g.length;D++){const O=g[D],V=O.replace("{{","").replace("}}","");if(h.includes(V)){let k=d(t[V]);a[V]&&(k=a[V](k)),y=y.replace(O,`${k}`)}}return y},r)}}axon.register("PatternStringProperty",PatternStringProperty);class StringProperty extends Property{constructor(e,t){t&&(assert&&assert(!t.hasOwnProperty("valueType"),"StringProperty sets valueType"),assert&&assert(!t.hasOwnProperty("phetioType"),"StringProperty sets phetioType"));const n=optionize()({valueType:"string",phetioValueType:StringIO},t);super(e,n)}}axon.register("StringProperty",StringProperty);const cache$3=new IOTypeCache,StringUnionIO=o=>{if(assert&&assert(o,"StringUnionIO needs unionValues"),!cache$3.has(o)){const e=o.join(",");cache$3.set(o,new IOType(`StringUnionIO<${e}>`,{documentation:"A PhET-iO Type validating on specific string values.",isValidValue:t=>o.includes(t),toStateObject:_.identity,fromStateObject:_.identity,stateSchema:StateSchema.asValue(`StringUnionIO<${e}>`,{isValidValue:t=>o.includes(t)})}))}return cache$3.get(o)};tandemNamespace.register("StringUnionIO",StringUnionIO);class StringUnionProperty extends Property{constructor(e,t){const n=optionize()({phetioValueType:StringUnionIO(t.validValues)},t);super(e,n)}}axon.register("StringUnionProperty",StringUnionProperty);class TinyForwardingProperty extends TinyProperty{constructor(e,t=!1,n){super(e,n),t&&(this.targetPropertyInstrumented=t),assert&&(this.phetioInitialized=!1)}setValueOrTargetProperty(e,t,n){if(isTReadOnlyProperty(n))this.setTargetProperty(n,e,t);else{const r=this.get();this.clearTargetProperty(),assert&&assert(!this.targetProperty,"just cleared"),this.setPropertyValue(n),this.areValuesEqual(r,n)||this.notifyListeners(r)}}setTargetProperty(e,t=null,n=null){if(assert&&t&&n===null&&this.targetPropertyInstrumented&&assert(!t.isPhetioInstrumented(),"tandemName must be provided for instrumented Nodes"),this.targetProperty===e)return t;const r=this.targetProperty&&this.targetProperty instanceof ReadOnlyProperty&&this.targetProperty.isPhetioInstrumented();assert&&r&&assert(e&&e instanceof ReadOnlyProperty&&e.isPhetioInstrumented(),"Cannot set swap out a PhET-iO instrumented targetProperty for an uninstrumented one");const s=this.targetProperty;this.ownedPhetioProperty&&e!==this.ownedPhetioProperty&&this.disposeOwnedPhetioProperty(),t&&n!==null&&t.updateLinkedElementForProperty(n,s,e);const a=this.get();return this.clearTargetProperty(),this.targetProperty=e,this.targetProperty?(assert&&assert(this.forwardingListener,"forwardingListener is not set yet"),this.targetProperty.lazyLink(this.forwardingListener),this.setPropertyValue(this.targetProperty.value)):this.setPropertyValue(a),this.areValuesEqual(a,this.get())||this.notifyListeners(a),t}clearTargetProperty(){this.forwardingListener=this.forwardingListener||this.onTargetPropertyChange.bind(this),this.targetProperty&&this.targetProperty.unlink(this.forwardingListener),this.targetProperty=null}onTargetPropertyChange(e){super.set(e)}set(e){return this.targetProperty?(assert&&assert(this.targetProperty.isSettable(),"targetProperty must be settable"),this.targetProperty.set(e)):super.set(e),this}setTargetPropertyInstrumented(e,t){return assert&&assert(!t.isPhetioInstrumented(),"this option only works if it is passed in before this Node is instrumented"),this.targetPropertyInstrumented=e,t}getTargetPropertyInstrumented(){return this.targetPropertyInstrumented||!1}initializePhetio(e,t,n){assert&&assert(!this.phetioInitialized,"already initialized"),assert&&assert(!this.ownedPhetioProperty,"Already created the ownedPhetioProperty"),!this.targetProperty&&this.targetPropertyInstrumented?(this.ownedPhetioProperty=n(),assert&&assert(this.ownedPhetioProperty instanceof Property,"The owned property should be an AXON/Property"),assert&&assert(this.ownedPhetioProperty instanceof ReadOnlyProperty&&this.ownedPhetioProperty.isPhetioInstrumented(),"The owned property should be PhET-iO instrumented"),this.setTargetProperty(this.ownedPhetioProperty,e,t)):this.targetProperty&&this.targetProperty instanceof ReadOnlyProperty&&this.targetProperty.isPhetioInstrumented()&&e.updateLinkedElementForProperty(t,null,this.targetProperty),assert&&(this.phetioInitialized=!0)}getTargetProperty(){return this.targetProperty||null}disposeOwnedPhetioProperty(){this.ownedPhetioProperty&&(this.ownedPhetioProperty.dispose(),delete this.ownedPhetioProperty)}dispose(){this.clearTargetProperty(),this.disposeOwnedPhetioProperty(),super.dispose()}}axon.register("TinyForwardingProperty",TinyForwardingProperty);class TinyOverrideProperty extends TinyProperty{constructor(e){super(e.value),this.isOverridden=!1,this._targetProperty=e,assert&&assert(!this.isOverridden,"Should not be overridden on startup"),this._targetListener=this.onTargetPropertyChange.bind(this),this._targetProperty.lazyLink(this._targetListener)}set targetProperty(e){this.setTargetProperty(e)}setTargetProperty(e){if(this.targetProperty===e)return;const t=this.value;this.isOverridden||this._targetProperty.unlink(this._targetListener),this._targetProperty=e,this.isOverridden||(this._targetProperty.lazyLink(this._targetListener),this.equalsValue(t)||this.notifyListeners(t))}clearOverride(){if(this.isOverridden){const e=this.value;this.isOverridden=!1,this._targetProperty.lazyLink(this._targetListener),this.equalsValue(e)||this.notifyListeners(e)}}get(){return this.isOverridden?this._value:this._targetProperty.value}set(e){this.isOverridden||(this._value=this._targetProperty.value),super.set(e)}setPropertyValue(e){this.isOverridden||(this.isOverridden=!0,this._targetProperty.unlink(this._targetListener)),super.setPropertyValue(e)}equalsValue(e){return this.areValuesEqual(e,this.value)}onTargetPropertyChange(e,t){this.isOverridden||this.notifyListeners(t)}notifyListeners(e){this.emit(this.value,e,this)}dispose(){this.isOverridden||this._targetProperty.unlink(this._targetListener),super.dispose()}}axon.register("TinyOverrideProperty",TinyOverrideProperty);class TinyStaticProperty extends TinyProperty{constructor(e,t){super(e),this.onAccessAttempt=t}get(){return this.onAccessAttempt(),super.get()}set(e){throw new Error("Cannot set a TinyStaticProperty value")}isSettable(){return!1}notifyListeners(e){this.emit(this.get(),e,this)}link(e){this.addListener(e),e(this.get(),null,this)}equalsValue(e){return this.areValuesEqual(e,this.get())}}axon.register("TinyStaticProperty",TinyStaticProperty);function isTRangedProperty(o){return(o instanceof ReadOnlyProperty||o instanceof TinyProperty)&&o.isSettable()&&!!o.range&&!!o.rangeProperty}class UnitConversionProperty extends MappedProperty{constructor(e,t){const n=a=>a*t.factor,r=a=>a/t.factor,s=optionize()({bidirectional:!0,map:n,inverseMap:r},t);super(e,s),this._property=e,this.rangeProperty=new Property(DEFAULT_RANGE),isTRangedProperty(e)&&(this._rangeListener=a=>{const h=n(a.min),c=n(a.max);this.rangeProperty.value=new Range(Math.min(h,c),Math.max(h,c))},e.rangeProperty.link(this._rangeListener))}get range(){return this.rangeProperty.value}set range(e){this.rangeProperty.value=e}dispose(){isTRangedProperty(this._property)&&this._property.rangeProperty.unlink(this._rangeListener),this.rangeProperty.dispose()}}axon.register("UnitConversionProperty",UnitConversionProperty);class VarianceNumberProperty extends NumberProperty{constructor(e,t,n){super(e,n),this.computeVariance=t}getRandomizedValue(){return this.computeVariance?this.computeVariance(super.get()):this.get()}}axon.register("VarianceNumberProperty",VarianceNumberProperty);window.sceneryLog=null;const scratchCanvas$1=document.createElement("canvas"),scratchContext$1=scratchCanvas$1.getContext("2d");let logPadding="";const scenery=new Namespace("scenery");scenery.register("scratchCanvas",scratchCanvas$1);scenery.register("scratchContext",scratchContext$1);function stringLogFunction(o){scenery.logString+=`${o.replace(/%c/g,"")}
`}function consoleLogFunction(...o){window.console&&window.console.log&&window.console.log(...Array.prototype.slice.call(o,0))}const logProperties={dirty:{name:"dirty",style:"color: #888;"},bounds:{name:"bounds",style:"color: #888;"},hitTest:{name:"hitTest",style:"color: #888;"},hitTestInternal:{name:"hitTestInternal",style:"color: #888;"},PerfCritical:{name:"Perf",style:"color: #f00;"},PerfMajor:{name:"Perf",style:"color: #aa0;"},PerfMinor:{name:"Perf",style:"color: #088;"},PerfVerbose:{name:"Perf",style:"color: #888;"},Cursor:{name:"Cursor",style:""},Stitch:{name:"Stitch",style:""},StitchDrawables:{name:"Stitch",style:""},GreedyStitcher:{name:"Greedy",style:"color: #088;"},GreedyVerbose:{name:"Greedy",style:"color: #888;"},RelativeTransform:{name:"RelativeTransform",style:"color: #606;"},BackboneDrawable:{name:"Backbone",style:"color: #a00;"},CanvasBlock:{name:"Canvas",style:""},WebGLBlock:{name:"WebGL",style:""},Display:{name:"Display",style:""},DOMBlock:{name:"DOM",style:""},Drawable:{name:"",style:""},FittedBlock:{name:"FittedBlock",style:""},Instance:{name:"Instance",style:""},InstanceTree:{name:"InstanceTree",style:""},ChangeInterval:{name:"ChangeInterval",style:"color: #0a0;"},SVGBlock:{name:"SVG",style:""},SVGGroup:{name:"SVGGroup",style:""},ImageSVGDrawable:{name:"ImageSVGDrawable",style:""},Paints:{name:"Paints",style:""},Filters:{name:"Filters",style:""},AlignBox:{name:"AlignBox",style:""},AlignGroup:{name:"AlignGroup",style:""},RichText:{name:"RichText",style:""},Sim:{name:"Sim",style:""},ParallelDOM:{name:"ParallelDOM",style:""},PDOMInstance:{name:"PDOMInstance",style:""},PDOMTree:{name:"PDOMTree",style:""},PDOMDisplaysInfo:{name:"PDOMDisplaysInfo",style:""},KeyboardFuzzer:{name:"KeyboardFuzzer",style:""},InputListener:{name:"InputListener",style:""},InputEvent:{name:"InputEvent",style:""},OnInput:{name:"OnInput",style:""},Pointer:{name:"Pointer",style:""},Input:{name:"Input",style:""},EventDispatch:{name:"EventDispatch",style:""},EventPath:{name:"EventPath",style:""}};extend(scenery,{logString:"",logFunction:function(...o){window.console&&window.console.log&&window.console.log(...Array.prototype.slice.call(o,0))},switchLogToConsole:function(){scenery.logFunction=consoleLogFunction},switchLogToString:function(){window.console&&window.console.log("switching to string log"),scenery.logFunction=stringLogFunction},enableIndividualLog:function(o){if(o==="stitch"){this.enableIndividualLog("Stitch"),this.enableIndividualLog("StitchDrawables"),this.enableIndividualLog("GreedyStitcher"),this.enableIndividualLog("GreedyVerbose");return}if(o==="perf"){this.enableIndividualLog("PerfCritical"),this.enableIndividualLog("PerfMajor"),this.enableIndividualLog("PerfMinor"),this.enableIndividualLog("PerfVerbose");return}if(o==="input"){this.enableIndividualLog("InputListener"),this.enableIndividualLog("InputEvent"),this.enableIndividualLog("OnInput"),this.enableIndividualLog("Pointer"),this.enableIndividualLog("Input"),this.enableIndividualLog("EventDispatch"),this.enableIndividualLog("EventPath");return}if(o==="a11y"||o==="pdom"){this.enableIndividualLog("ParallelDOM"),this.enableIndividualLog("PDOMInstance"),this.enableIndividualLog("PDOMTree"),this.enableIndividualLog("PDOMDisplaysInfo");return}o&&(assert&&assert(logProperties[o],`Unknown logger: ${o}, please use periods (.) to separate different log names`),window.sceneryLog[o]=window.sceneryLog[o]||function(e,t){const n=logProperties[o],r=n.name?`[${n.name}] `:"";scenery.logFunction(`%c${logPadding}%c${r}${e}`,"color: #ddd;",t||n.style)})},disableIndividualLog:function(o){o&&delete window.sceneryLog[o]},enableLogging:function(o){window.sceneryLog=function(e){scenery.logFunction(e)},window.sceneryLog.push=function(){logPadding+="| "},window.sceneryLog.pop=function(){logPadding=logPadding.slice(0,-2)},window.sceneryLog.getDepth=function(){return logPadding.length/2};for(let e=0;e<o.length;e++)this.enableIndividualLog(o[e])},disableLogging:function(){window.sceneryLog=null},isLoggingPerformance:function(){return window.sceneryLog.PerfCritical||window.sceneryLog.PerfMajor||window.sceneryLog.PerfMinor||window.sceneryLog.PerfVerbose}});const SceneryConstants={DISABLED_OPACITY:.45,DEFAULT_COLOR_PROFILE:"default",PROJECTOR_COLOR_PROFILE:"projector"};scenery.register("SceneryConstants",SceneryConstants);const clamp=DotUtils.clamp,linear=DotUtils.linear,rgbNumber="(-?\\d{1,3}%?)",aNumber="(\\d+|\\d*\\.\\d+)",rawNumber="(\\d{1,3})";function parseRGBNumber(o){let e=1;return o.endsWith("%")&&(e=2.55,o=o.slice(0,o.length-1)),DotUtils.roundSymmetric(Number(o)*e)}const Je=class Je{constructor(e,t,n,r){this.changeEmitter=new TinyEmitter,this.set(e,t,n,r)}copy(){return new Je(this.r,this.g,this.b,this.a)}set(e,t,n,r){if(assert&&assert(e!==void 0,"Can't call Color.set( undefined )"),e===null)this.setRGBA(0,0,0,0);else if(typeof e=="string")this.setCSS(e);else if(e instanceof Je)this.setRGBA(e.r,e.g,e.b,e.a);else if(n===void 0){assert&&assert(t===void 0||typeof t=="number");const s=e>>16&255,a=e>>8&255,h=e>>0&255,c=t===void 0?1:t;this.setRGBA(s,a,h,c)}else assert&&assert(r===void 0||typeof r=="number"),this.setRGBA(e,t,n,r===void 0?1:r);return this}getRed(){return this.r}get red(){return this.getRed()}set red(e){this.setRed(e)}setRed(e){return this.setRGBA(e,this.g,this.b,this.a)}getGreen(){return this.g}get green(){return this.getGreen()}set green(e){this.setGreen(e)}setGreen(e){return this.setRGBA(this.r,e,this.b,this.a)}getBlue(){return this.b}get blue(){return this.getBlue()}set blue(e){this.setBlue(e)}setBlue(e){return this.setRGBA(this.r,this.g,e,this.a)}getAlpha(){return this.a}get alpha(){return this.getAlpha()}set alpha(e){this.setAlpha(e)}setAlpha(e){return this.setRGBA(this.r,this.g,this.b,e)}setRGBA(e,t,n,r){return this.r=DotUtils.roundSymmetric(clamp(e,0,255)),this.g=DotUtils.roundSymmetric(clamp(t,0,255)),this.b=DotUtils.roundSymmetric(clamp(n,0,255)),this.a=clamp(r,0,1),this.updateColor(),this}blend(e,t){const r=Math.pow(this.r,2.4),s=Math.pow(e.r,2.4),a=Math.pow(this.g,2.4),h=Math.pow(e.g,2.4),c=Math.pow(this.b,2.4),d=Math.pow(e.b,2.4),y=Math.pow(r+(s-r)*t,1/2.4),g=Math.pow(a+(h-a)*t,1/2.4),D=Math.pow(c+(d-c)*t,1/2.4),O=this.a+(e.a-this.a)*t;return new Je(y,g,D,O)}computeCSS(){if(this.a===1)return`rgb(${this.r},${this.g},${this.b})`;{let e=this.a.toFixed(20);for(;e.length>=2&&e.endsWith("0")&&e[e.length-2]!==".";)e=e.slice(0,e.length-1);const t=this.a===0||this.a===1?this.a:e;return`rgba(${this.r},${this.g},${this.b},${t})`}}toCSS(){return assert&&assert(this._css===this.computeCSS(),`CSS cached value is ${this._css}, but the computed value appears to be ${this.computeCSS()}`),this._css}setCSS(e){let t=!1;const n=Je.preprocessCSS(e);for(let r=0;r<Je.formatParsers.length;r++){const s=Je.formatParsers[r],a=s.regexp.exec(n);if(a){s.apply(this,a),t=!0;break}}if(!t)throw new Error(`Color unable to parse color string: ${e}`);return this.updateColor(),this}toNumber(){return(this.r<<16)+(this.g<<8)+this.b}updateColor(){assert&&assert(!this.immutable,"Cannot modify an immutable color. Likely caused by trying to mutate a color after it was used for a node fill/stroke"),assert&&assert(typeof this.red=="number"&&typeof this.green=="number"&&typeof this.blue=="number"&&typeof this.alpha=="number",`Ensure color components are numeric: ${this.toString()}`),assert&&assert(isFinite(this.red)&&isFinite(this.green)&&isFinite(this.blue)&&isFinite(this.alpha),"Ensure color components are finite and not NaN"),assert&&assert(this.red>=0&&this.red<=255&&this.green>=0&&this.green<=255&&this.red>=0&&this.red<=255&&this.alpha>=0&&this.alpha<=1,`Ensure color components are in the proper ranges: ${this.toString()}`);const e=this._css;this._css=this.computeCSS(),e!==this._css&&this.changeEmitter.emit()}setImmutable(){return assert&&(this.immutable=!0),this}getCanvasStyle(){return this.toCSS()}setHSLA(e,t,n,r){e=e%360/360,t=clamp(t/100,0,1),n=clamp(n/100,0,1);let s;n<.5?s=n*(t+1):s=n+t-n*t;const a=n*2-s;return this.r=DotUtils.roundSymmetric(Je.hueToRGB(a,s,e+1/3)*255),this.g=DotUtils.roundSymmetric(Je.hueToRGB(a,s,e)*255),this.b=DotUtils.roundSymmetric(Je.hueToRGB(a,s,e-1/3)*255),this.a=clamp(r,0,1),this.updateColor(),this}equals(e){return this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a}withAlpha(e){return new Je(this.r,this.g,this.b,e)}checkFactor(e){return assert&&assert(e===void 0||e>=0&&e<=1,`factor must be between 0 and 1: ${e}`),e===void 0?.7:e}brighterColor(e){e=this.checkFactor(e);const t=Math.min(255,Math.floor(this.r/e)),n=Math.min(255,Math.floor(this.g/e)),r=Math.min(255,Math.floor(this.b/e));return new Je(t,n,r,this.a)}colorUtilsBrighter(e){e=this.checkFactor(e);const t=Math.min(255,this.getRed()+Math.floor(e*(255-this.getRed()))),n=Math.min(255,this.getGreen()+Math.floor(e*(255-this.getGreen()))),r=Math.min(255,this.getBlue()+Math.floor(e*(255-this.getBlue())));return new Je(t,n,r,this.getAlpha())}darkerColor(e){e=this.checkFactor(e);const t=Math.max(0,Math.floor(e*this.r)),n=Math.max(0,Math.floor(e*this.g)),r=Math.max(0,Math.floor(e*this.b));return new Je(t,n,r,this.a)}colorUtilsDarker(e){e=this.checkFactor(e);const t=Math.max(0,this.getRed()-Math.floor(e*this.getRed())),n=Math.max(0,this.getGreen()-Math.floor(e*this.getGreen())),r=Math.max(0,this.getBlue()-Math.floor(e*this.getBlue()));return new Je(t,n,r,this.getAlpha())}colorUtilsBrightness(e){return e===0?this:e>0?this.colorUtilsBrighter(e):this.colorUtilsDarker(-e)}toString(){return`${this.constructor.name}[r:${this.r} g:${this.g} b:${this.b} a:${this.a}]`}toHexString(){let e=this.toNumber().toString(16);for(;e.length<6;)e=`0${e}`;return`#${e}`}toStateObject(){return{r:this.r,g:this.g,b:this.b,a:this.a}}static hueToRGB(e,t,n){return n<0&&(n=n+1),n>1&&(n=n-1),n*6<1?e+(t-e)*n*6:n*2<1?t:n*3<2?e+(t-e)*(2/3-n)*6:e}static toColor(e){return e===null?Je.TRANSPARENT:e instanceof Je?e:typeof e=="string"?new Je(e):Je.toColor(e.value)}static interpolateRGBA(e,t,n){if(n<0||n>1)throw new Error(`distance must be between 0 and 1: ${n}`);const r=Math.floor(linear(0,1,e.r,t.r,n)),s=Math.floor(linear(0,1,e.g,t.g,n)),a=Math.floor(linear(0,1,e.b,t.b,n)),h=linear(0,1,e.a,t.a,n);return new Je(r,s,a,h)}static supersampleBlend(e){const n=e.map(D=>Math.pow(D.r/255,2.2)),r=e.map(D=>Math.pow(D.g/255,2.2)),s=e.map(D=>Math.pow(D.b/255,2.2)),a=e.map(D=>Math.pow(D.a,2.2)),h=_.sum(a);if(h===0)return new Je(0,0,0,0);const c=_.sum(_.range(0,e.length).map(D=>n[D]*a[D]))/h,d=_.sum(_.range(0,e.length).map(D=>r[D]*a[D]))/h,y=_.sum(_.range(0,e.length).map(D=>s[D]*a[D]))/h,g=h/e.length;return new Je(Math.floor(Math.pow(c,1/2.2)*255),Math.floor(Math.pow(d,1/2.2)*255),Math.floor(Math.pow(y,1/2.2)*255),Math.pow(g,1/2.2))}static fromStateObject(e){return new Je(e.r,e.g,e.b,e.a)}static hsla(e,t,n,r){return new Je(0,0,0,1).setHSLA(e,t,n,r)}static checkPaintString(e){if(assert)try{scratchColor$2.setCSS(e)}catch{assert(!1,`The CSS string is an invalid color: ${e}`)}}static checkPaint(e){typeof e=="string"?Je.checkPaintString(e):isTReadOnlyProperty(e)&&typeof e.value=="string"&&Je.checkPaintString(e.value)}static getLuminance(e){const t=Je.toColor(e),n=t.red*.2126+t.green*.7152+t.blue*.0722;return assert&&assert(n>=0&&n<=255,`unexpected luminance: ${n}`),n}static toGrayscale(e){const t=Je.getLuminance(e);return new Je(t,t,t)}static isDarkColor(e,t=186){return assert&&assert(t>=0&&t<=255,"invalid luminanceThreshold"),Je.getLuminance(e)<t}static isLightColor(e,t){return!Je.isDarkColor(e,t)}static grayColor(e,t){return new Je(e,e,e,t)}static preprocessCSS(e){let t=e.replace(/ /g,"").toLowerCase();const n=Je.colorKeywords[t];return n&&(t=`#${n}`),t}static isCSSColorString(e){const t=Je.preprocessCSS(e);for(let n=0;n<Je.formatParsers.length;n++)if(Je.formatParsers[n].regexp.exec(t))return!0;return!1}};Je.formatParsers=[{regexp:/^transparent$/,apply:(e,t)=>{e.setRGBA(0,0,0,0)}},{regexp:/^#(\w{1})(\w{1})(\w{1})$/,apply:(e,t)=>{e.setRGBA(parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),1)}},{regexp:/^#(\w{2})(\w{2})(\w{2})$/,apply:(e,t)=>{e.setRGBA(parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),1)}},{regexp:new RegExp(`^rgb\\(${rgbNumber},${rgbNumber},${rgbNumber}\\)$`),apply:(e,t)=>{e.setRGBA(parseRGBNumber(t[1]),parseRGBNumber(t[2]),parseRGBNumber(t[3]),1)}},{regexp:new RegExp(`^rgba\\(${rgbNumber},${rgbNumber},${rgbNumber},${aNumber}\\)$`),apply:(e,t)=>{e.setRGBA(parseRGBNumber(t[1]),parseRGBNumber(t[2]),parseRGBNumber(t[3]),Number(t[4]))}},{regexp:new RegExp(`^hsl\\(${rawNumber},${rawNumber}%,${rawNumber}%\\)$`),apply:(e,t)=>{e.setHSLA(Number(t[1]),Number(t[2]),Number(t[3]),1)}},{regexp:new RegExp(`^hsla\\(${rawNumber},${rawNumber}%,${rawNumber}%,${aNumber}\\)$`),apply:(e,t)=>{e.setHSLA(Number(t[1]),Number(t[2]),Number(t[3]),Number(t[4]))}}],Je.basicColorKeywords={aqua:"00ffff",black:"000000",blue:"0000ff",fuchsia:"ff00ff",gray:"808080",green:"008000",lime:"00ff00",maroon:"800000",navy:"000080",olive:"808000",purple:"800080",red:"ff0000",silver:"c0c0c0",teal:"008080",white:"ffffff",yellow:"ffff00"},Je.colorKeywords={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"778899",lightslategrey:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};let Color=Je;scenery.register("Color",Color);Color.BLACK=Color.black=new Color(0,0,0).setImmutable();Color.BLUE=Color.blue=new Color(0,0,255).setImmutable();Color.CYAN=Color.cyan=new Color(0,255,255).setImmutable();Color.DARK_GRAY=Color.darkGray=new Color(64,64,64).setImmutable();Color.GRAY=Color.gray=new Color(128,128,128).setImmutable();Color.GREEN=Color.green=new Color(0,255,0).setImmutable();Color.LIGHT_GRAY=Color.lightGray=new Color(192,192,192).setImmutable();Color.MAGENTA=Color.magenta=new Color(255,0,255).setImmutable();Color.ORANGE=Color.orange=new Color(255,200,0).setImmutable();Color.PINK=Color.pink=new Color(255,175,175).setImmutable();Color.RED=Color.red=new Color(255,0,0).setImmutable();Color.WHITE=Color.white=new Color(255,255,255).setImmutable();Color.YELLOW=Color.yellow=new Color(255,255,0).setImmutable();Color.TRANSPARENT=Color.transparent=new Color(0,0,0,0).setImmutable();const scratchColor$2=new Color("blue");Color.ColorIO=new IOType("ColorIO",{valueType:Color,documentation:"A color, with rgba",toStateObject:o=>o.toStateObject(),fromStateObject:o=>new Color(o.r,o.g,o.b,o.a),stateSchema:{r:NumberIO,g:NumberIO,b:NumberIO,a:NumberIO}});const Features={};scenery.register("Features",Features);function supportsDataURLFormatOutput(o){try{const e=document.createElement("canvas");e.width=1,e.height=1;const t=e.getContext("2d");t.fillStyle="black",t.fillRect(0,0,1,1);const n=e.toDataURL([o]),r=`data:${o}`;return n.slice(0,r.length)===r}catch{return!1}}function supportsDataURLFormatOrigin(o,e){const t=document.createElement("canvas");t.width=1,t.height=1;const n=t.getContext("2d"),r=document.createElement("img");r.crossOrigin="Anonymous";const s=()=>{try{n.drawImage(r,0,0),t.toDataURL(),Features[o]=!0}catch{Features[o]=!1}};r.onload=s;try{r.src=e,r.complete&&s()}catch{Features[o]=!1}}Features.canvasPNGOutput=supportsDataURLFormatOutput("image/png");Features.canvasJPEGOutput=supportsDataURLFormatOutput("image/jpeg");Features.canvasGIFOutput=supportsDataURLFormatOutput("image/gif");Features.canvasICONOutput=supportsDataURLFormatOutput("image/x-icon");supportsDataURLFormatOrigin("canvasPNGInput","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQIW2NkYGD4DwABCQEBtxmN7wAAAABJRU5ErkJggg==");supportsDataURLFormatOrigin("canvasJPEGInput","data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAMCAgICAgMCAgIDAwMDBAYEBAQEBAgGBgUGCQgKCgkICQkKDA8MCgsOCwkJDRENDg8QEBEQCgwSExIQEw8QEBD/2wBDAQMDAwQDBAgEBAgQCwkLEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBD/wAARCAABAAEDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD8qqKKKAP/2Q==");supportsDataURLFormatOrigin("canvasSVGInput","data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIj8+DQo8c3ZnIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2aWV3cG9ydD0iMCAwIDEgMSIgd2lkdGg9IjEiIGhlaWdodD0iMSIgPg0KICA8cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMSIgaGVpZ2h0PSIxIiByeD0iMCIgcnk9IjAiIHN0eWxlPSJmaWxsOiBibGFjazsgc3Ryb2tlOiBub25lOyI+PC9yZWN0Pg0KPC9zdmc+DQo=");supportsDataURLFormatOrigin("canvasGIFInput","data:image/gif;base64,R0lGODlhAQABAJEAAAAAAP///////wAAACH5BAEAAAIALAAAAAABAAEAAAICRAEAOw==");const canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");Features.toDataURLHD=detectPrefix(canvas,"toDataURLHD");Features.createImageDataHD=detectPrefix(ctx,"createImageDataHD");Features.getImageDataHD=detectPrefix(ctx,"getImageDataHD");Features.putImageDataHD=detectPrefix(ctx,"putImageDataHD");Features.currentTransform=detectPrefix(ctx,"currentTransform");Features.canvasFilter=detectPrefix(ctx,"filter");const span=document.createElement("span"),div=document.createElement("div");Features.textStroke=detectPrefix(span.style,"textStroke");Features.textStrokeColor=detectPrefix(span.style,"textStrokeColor");Features.textStrokeWidth=detectPrefix(span.style,"textStrokeWidth");Features.transform=detectPrefix(div.style,"transform");Features.transformOrigin=detectPrefix(div.style,"transformOrigin");Features.backfaceVisibility=detectPrefix(div.style,"backfaceVisibility");Features.borderRadius=detectPrefix(div.style,"borderRadius");Features.userSelect=detectPrefix(div.style,"userSelect");Features.touchAction=detectPrefix(div.style,"touchAction");Features.touchCallout=detectPrefix(div.style,"touchCallout");Features.userDrag=detectPrefix(div.style,"userDrag");Features.tapHighlightColor=detectPrefix(div.style,"tapHighlightColor");Features.fontSmoothing=detectPrefix(div.style,"fontSmoothing");Features.requestAnimationFrame=detectPrefix(window,"requestAnimationFrame");Features.cancelAnimationFrame=detectPrefix(window,"cancelAnimationFrame");Features.setStyle=(o,e,t)=>{e!==void 0&&(o.style[e]=t)};Features.passive=!1;window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>{Features.passive=!0}}));const VALID_STYLES=["normal","italic","oblique"],VALID_VARIANTS=["normal","small-caps"],VALID_WEIGHTS=["normal","bold","bolder","lighter","100","200","300","400","500","600","700","800","900"],VALID_STRETCHES=["normal","ultra-condensed","extra-condensed","condensed","semi-condensed","semi-expanded","expanded","extra-expanded","ultra-expanded"],Kt=class Kt extends PhetioObject{constructor(e){assert&&assert(e===void 0||typeof e=="object"&&Object.getPrototypeOf(e)===Object.prototype,"options, if provided, should be a raw object");const t=optionize()({style:"normal",variant:"normal",weight:"normal",stretch:"normal",size:"10px",lineHeight:"normal",family:"sans-serif",phetioType:Kt.FontIO},e);assert&&assert(typeof t.weight=="string"||typeof t.weight=="number","Font weight should be specified as a string or number"),assert&&assert(typeof t.size=="string"||typeof t.size=="number","Font size should be specified as a string or number"),super(t),this._style=t.style,this._variant=t.variant,this._weight=`${t.weight}`,this._stretch=t.stretch,this._size=Kt.castSize(t.size),this._lineHeight=t.lineHeight,this._family=t.family,assert&&assert(typeof this._style=="string"&&_.includes(VALID_STYLES,this._style),'Font style must be one of "normal", "italic", or "oblique"'),assert&&assert(typeof this._variant=="string"&&_.includes(VALID_VARIANTS,this._variant),'Font variant must be "normal" or "small-caps"'),assert&&assert(typeof this._weight=="string"&&_.includes(VALID_WEIGHTS,this._weight),'Font weight must be one of "normal", "bold", "bolder", "lighter", "100", "200", "300", "400", "500", "600", "700", "800", or "900"'),assert&&assert(typeof this._stretch=="string"&&_.includes(VALID_STRETCHES,this._stretch),'Font stretch must be one of "normal", "ultra-condensed", "extra-condensed", "condensed", "semi-condensed", "semi-expanded", "expanded", "extra-expanded", or "ultra-expanded"'),assert&&assert(typeof this._size=="string"&&!_.includes(["0","1","2","3","4","5","6","7","8","9"],this._size[this._size.length-1]),"Font size must be either passed as a number (not a string, interpreted as px), or must contain a suffix for percentage, absolute or relative units, or an explicit size constant"),assert&&assert(typeof this._lineHeight=="string"),assert&&assert(typeof this._family=="string"),this._font=this.computeShorthand()}getFont(){return this._font}get font(){return this.getFont()}getStyle(){return this._style}get style(){return this.getStyle()}getVariant(){return this._variant}get variant(){return this.getVariant()}getWeight(){return this._weight}get weight(){return this.getWeight()}getStretch(){return this._stretch}get stretch(){return this.getStretch()}getSize(){return this._size}get size(){return this.getSize()}getNumericSize(){const e=this._size.match(/^(\d+)px$/);if(e)return Number(e[1]);const t=this._size.match(/^(\d+)pt$/);if(t)return .75*Number(t[1]);const n=this._size.match(/^(\d+)em$/);return n?Number(n[1])/16:12}get numericSize(){return this.getNumericSize()}getLineHeight(){return this._lineHeight}get lineHeight(){return this.getLineHeight()}getFamily(){return this._family}get family(){return this.getFamily()}copy(e){return new Kt(combineOptions({style:this._style,variant:this._variant,weight:this._weight,stretch:this._stretch,size:this._size,lineHeight:this._lineHeight,family:this._family},e))}computeShorthand(){let e="";return this._style!=="normal"&&(e+=`${this._style} `),this._variant!=="normal"&&(e+=`${this._variant} `),this._weight!=="normal"&&(e+=`${this._weight} `),this._stretch!=="normal"&&(e+=`${this._stretch} `),e+=this._size,this._lineHeight!=="normal"&&(e+=`/${this._lineHeight}`),e+=` ${this._family}`,e}toCSS(){return this.getFont()}static castSize(e){return typeof e=="number"?`${e}px`:e}static isFontStyle(e){return VALID_STYLES.includes(e)}static isFontVariant(e){return VALID_VARIANTS.includes(e)}static isFontWeight(e){return VALID_WEIGHTS.includes(e)}static isFontStretch(e){return VALID_STRETCHES.includes(e)}static fromCSS(e){const t={},n=_.filter(e.split(/[\x09\x0A\x0C\x0D\x20]/),r=>r.length>0);for(let r=0;r<n.length;r++){const s=n[r];if(s!=="normal")if(Kt.isFontStyle(s))assert&&assert(t.style===void 0,`Style cannot be applied twice. Already set to "${t.style}", attempt to replace with "${s}"`),t.style=s;else if(Kt.isFontVariant(s))assert&&assert(t.variant===void 0,`Variant cannot be applied twice. Already set to "${t.variant}", attempt to replace with "${s}"`),t.variant=s;else if(Kt.isFontWeight(s))assert&&assert(t.weight===void 0,`Weight cannot be applied twice. Already set to "${t.weight}", attempt to replace with "${s}"`),t.weight=s;else if(Kt.isFontStretch(s))assert&&assert(t.stretch===void 0,`Stretch cannot be applied twice. Already set to "${t.stretch}", attempt to replace with "${s}"`),t.stretch=s;else{const a=s.split(/\//);t.size=a[0],a[1]&&(t.lineHeight=a[1]),t.family=n.slice(r+1).join(" ");break}}return new Kt(t)}};Kt.DEFAULT=new Kt;let Font=Kt;scenery.register("Font",Font);Font.FontIO=new IOType("FontIO",{valueType:Font,documentation:"Font handling for text drawing. Options:<ul><li><strong>style:</strong> normal      &mdash; normal | italic | oblique </li><li><strong>variant:</strong> normal    &mdash; normal | small-caps </li><li><strong>weight:</strong> normal     &mdash; normal | bold | bolder | lighter | 100 | 200 | 300 | 400 | 500 | 600 | 700 | 800 | 900 </li><li><strong>stretch:</strong> normal    &mdash; normal | ultra-condensed | extra-condensed | condensed | semi-condensed | semi-expanded | expanded | extra-expanded | ultra-expanded </li><li><strong>size:</strong> 10px         &mdash; absolute-size | relative-size | length | percentage -- unitless number interpreted as px. absolute suffixes: cm, mm, in, pt, pc, px. relative suffixes: em, ex, ch, rem, vw, vh, vmin, vmax. </li><li><strong>lineHeight:</strong> normal &mdash; normal | number | length | percentage -- NOTE: Canvas spec forces line-height to normal </li><li><strong>family:</strong> sans-serif &mdash; comma-separated list of families, including generic families (serif, sans-serif, cursive, fantasy, monospace). ideally escape with double-quotes</li></ul>",toStateObject:o=>({style:o.getStyle(),variant:o.getVariant(),weight:o.getWeight(),stretch:o.getStretch(),size:o.getSize(),lineHeight:o.getLineHeight(),family:o.getFamily()}),fromStateObject(o){return new Font(o)},stateSchema:{style:StringIO,variant:StringIO,weight:StringIO,stretch:StringIO,size:StringIO,lineHeight:StringIO,family:StringIO}});const Renderer={};scenery.register("Renderer",Renderer);Renderer.numActiveRenderers=4;Renderer.bitsPerRenderer=5;Renderer.bitmaskRendererArea=255;Renderer.bitmaskCurrentRendererArea=15;Renderer.bitmaskLacksOffset=65536;Renderer.bitmaskLacksShift=16;Renderer.bitmaskNodeDefault=Renderer.bitmaskRendererArea;Renderer.bitmaskCanvas=1;Renderer.bitmaskSVG=2;Renderer.bitmaskDOM=4;Renderer.bitmaskWebGL=8;Renderer.bitmaskSingleCanvas=256;Renderer.bitmaskSingleSVG=512;Renderer.bitmaskNotPainted=4096;Renderer.bitmaskBoundsValid=8192;Renderer.bitmaskNoPDOM=16384;Renderer.bitmaskLacksCanvas=Renderer.bitmaskCanvas<<Renderer.bitmaskLacksShift;Renderer.bitmaskLacksSVG=Renderer.bitmaskSVG<<Renderer.bitmaskLacksShift;Renderer.bitmaskLacksDOM=Renderer.bitmaskDOM<<Renderer.bitmaskLacksShift;Renderer.bitmaskLacksWebGL=Renderer.bitmaskWebGL<<Renderer.bitmaskLacksShift;Renderer.isCanvas=function(o){return(o&Renderer.bitmaskCanvas)!==0};Renderer.isSVG=function(o){return(o&Renderer.bitmaskSVG)!==0};Renderer.isDOM=function(o){return(o&Renderer.bitmaskDOM)!==0};Renderer.isWebGL=function(o){return(o&Renderer.bitmaskWebGL)!==0};const rendererMap={canvas:Renderer.bitmaskCanvas,svg:Renderer.bitmaskSVG,dom:Renderer.bitmaskDOM,webgl:Renderer.bitmaskWebGL};Renderer.fromName=function(o){return rendererMap[o]};Renderer.stripBitmask=function(o){return o&Renderer.bitmaskRendererArea};Renderer.createOrderBitmask=function(o,e,t,n){return o=o||0,e=e||0,t=t||0,n=n||0,o|e<<5|t<<10|n<<15};Renderer.bitmaskOrder=function(o,e){return e>0&&(o=o>>5*e),o&Renderer.bitmaskCurrentRendererArea};Renderer.bitmaskOrderFirst=function(o){return o&Renderer.bitmaskCurrentRendererArea};Renderer.bitmaskOrderSecond=function(o){return o>>5&Renderer.bitmaskCurrentRendererArea};Renderer.bitmaskOrderThird=function(o){return o>>10&Renderer.bitmaskCurrentRendererArea};Renderer.bitmaskOrderFourth=function(o){return o>>15&Renderer.bitmaskCurrentRendererArea};Renderer.pushOrderBitmask=function(o,e){assert&&assert(typeof o=="number"),assert&&assert(typeof e=="number");let t=e;const n=Renderer.bitsPerRenderer*Renderer.numActiveRenderers;for(let r=0;r<=n;r+=Renderer.bitsPerRenderer){const s=o>>r&Renderer.bitmaskCurrentRendererArea;if(s===t)return o;if(s===0)return o=o|t<<r,o;if(o=o&~(Renderer.bitmaskCurrentRendererArea<<r),o=o|t<<r,t=s,t===e)return o}throw new Error("pushOrderBitmask overflow")};Renderer.createSelfDrawable=function(o,e,t,n){let r;if(Renderer.isCanvas(t))r=e.createCanvasDrawable(t,o);else if(Renderer.isSVG(t))r=e.createSVGDrawable(t,o);else if(Renderer.isDOM(t))r=e.createDOMDrawable(t,o);else if(Renderer.isWebGL(t))r=e.createWebGLDrawable(t,o);else throw new Error(`Unrecognized renderer: ${t}`);return assert&&_.each(e.drawableMarkFlags,s=>{const a=`markDirty${s[0].toUpperCase()}${s.slice(1)}`;assert(typeof r[a]=="function",`Did not find ${a}`)}),r.setFittable(n),r};Renderer.webglCustom=1;Renderer.webglTexturedTriangles=2;Renderer.webglVertexColorPolygons=3;const svgns="http://www.w3.org/2000/svg";scenery.register("svgns",svgns);const xlinkns="http://www.w3.org/1999/xlink";scenery.register("xlinkns",xlinkns);function p(o,e){return new Vector2(o,e)}const transformProperty=Features.transform,transformOriginProperty=Features.transformOrigin||"transformOrigin";let webglEnabled=!0,_extensionlessWebGLSupport;const Utils={prepareForTransform(o){o.style[transformOriginProperty]="top left"},applyPreparedTransform(o,e){e.style[transformProperty]=o.getCSSTransform()},setTransform(o,e){e.style[transformProperty]=o},unsetTransform(o){o.style[transformProperty]=""},polyfillRequestAnimationFrame(){(!window.requestAnimationFrame||!window.cancelAnimationFrame)&&(!Features.requestAnimationFrame||!Features.cancelAnimationFrame?(window.requestAnimationFrame=o=>{const e=Date.now();return window.setTimeout(()=>{o(Date.now()-e)},16)},window.cancelAnimationFrame=clearTimeout):(window.requestAnimationFrame=window[Features.requestAnimationFrame],window.cancelAnimationFrame=window[Features.cancelAnimationFrame]))},backingStorePixelRatio(o){return o.webkitBackingStorePixelRatio||o.mozBackingStorePixelRatio||o.msBackingStorePixelRatio||o.oBackingStorePixelRatio||o.backingStorePixelRatio||1},backingScale(o){if("devicePixelRatio"in window){const e=Utils.backingStorePixelRatio(o);return window.devicePixelRatio/e}return 1},supportsNativeCanvasFilter(){return!!Features.canvasFilter},supportsImageDataCanvasFilter(){return Utils.backingStorePixelRatio(scenery.scratchContext)===1},scanBounds(o,e,t){const n=_.map(_.range(e),()=>!1),r=_.map(_.range(e),()=>!1);for(let y=0;y<e;y++)for(let g=0;g<e;g++){const D=4*(g*e+y);(o.data[D]!==0||o.data[D+1]!==0||o.data[D+2]!==0||o.data[D+3]!==0)&&(n[y]=!0,r[g]=!0)}const s=_.indexOf(n,!0),a=_.lastIndexOf(n,!0),h=_.indexOf(r,!0),c=_.lastIndexOf(r,!0),d=e/16;return{minBounds:new Bounds2(s<1||s>=e-1?Number.POSITIVE_INFINITY:t.inversePosition2(p(s+1+d,0)).x,h<1||h>=e-1?Number.POSITIVE_INFINITY:t.inversePosition2(p(0,h+1+d)).y,a<1||a>=e-1?Number.NEGATIVE_INFINITY:t.inversePosition2(p(a-d,0)).x,c<1||c>=e-1?Number.NEGATIVE_INFINITY:t.inversePosition2(p(0,c-d)).y),maxBounds:new Bounds2(s<1||s>=e-1?Number.NEGATIVE_INFINITY:t.inversePosition2(p(s-1-d,0)).x,h<1||h>=e-1?Number.NEGATIVE_INFINITY:t.inversePosition2(p(0,h-1-d)).y,a<1||a>=e-1?Number.POSITIVE_INFINITY:t.inversePosition2(p(a+2+d,0)).x,c<1||c>=e-1?Number.POSITIVE_INFINITY:t.inversePosition2(p(0,c+2+d)).y)}},canvasAccurateBounds(o,e){const t=e&&e.precision?e.precision:.001,n=e&&e.resolution?e.resolution:128,r=e&&e.initialScale?e.initialScale:1/16;let s=Bounds2.NOTHING,a=Bounds2.EVERYTHING;const h=document.createElement("canvas");h.width=n,h.height=n;const c=h.getContext("2d");function d(N){c.save(),N.matrix.canvasSetTransform(c),o(c),c.restore();const F=c.getImageData(0,0,n,n),G=Utils.scanBounds(F,n,N);return c.clearRect(0,0,n,n),G}function y(N){const G=(n-4)/(N.maxX-N.minX),ie=(n-2*2)/(N.maxY-N.minY),Z=-G*N.minX+2,W=-ie*N.minY+2;return new Transform3(Matrix3.translation(Z,W).timesMatrix(Matrix3.scaling(G,ie)))}const g=new Transform3;g.append(Matrix3.translation(n/2,n/2)),g.append(Matrix3.scaling(r));const D=d(g);s=s.union(D.minBounds),a=a.intersection(D.maxBounds);let O,V,k;for(O=a.minY,V=a.maxY;isFinite(s.minX)&&isFinite(a.minX)&&Math.abs(s.minX-a.minX)>t&&(k=d(y(new Bounds2(a.minX,O,s.minX,V))),!(s.minX<=k.minBounds.minX&&a.minX>=k.maxBounds.minX));)s=s.withMinX(Math.min(s.minX,k.minBounds.minX)),a=a.withMinX(Math.max(a.minX,k.maxBounds.minX)),O=Math.max(O,k.maxBounds.minY),V=Math.min(V,k.maxBounds.maxY);for(O=a.minY,V=a.maxY;isFinite(s.maxX)&&isFinite(a.maxX)&&Math.abs(s.maxX-a.maxX)>t&&(k=d(y(new Bounds2(s.maxX,O,a.maxX,V))),!(s.maxX>=k.minBounds.maxX&&a.maxX<=k.maxBounds.maxX));)s=s.withMaxX(Math.max(s.maxX,k.minBounds.maxX)),a=a.withMaxX(Math.min(a.maxX,k.maxBounds.maxX)),O=Math.max(O,k.maxBounds.minY),V=Math.min(V,k.maxBounds.maxY);for(O=a.minX,V=a.maxX;isFinite(s.minY)&&isFinite(a.minY)&&Math.abs(s.minY-a.minY)>t&&(k=d(y(new Bounds2(O,a.minY,V,s.minY))),!(s.minY<=k.minBounds.minY&&a.minY>=k.maxBounds.minY));)s=s.withMinY(Math.min(s.minY,k.minBounds.minY)),a=a.withMinY(Math.max(a.minY,k.maxBounds.minY)),O=Math.max(O,k.maxBounds.minX),V=Math.min(V,k.maxBounds.maxX);for(O=a.minX,V=a.maxX;isFinite(s.maxY)&&isFinite(a.maxY)&&Math.abs(s.maxY-a.maxY)>t&&(k=d(y(new Bounds2(O,s.maxY,V,a.maxY))),!(s.maxY>=k.minBounds.maxY&&a.maxY<=k.maxBounds.maxY));)s=s.withMaxY(Math.max(s.maxY,k.minBounds.maxY)),a=a.withMaxY(Math.min(a.maxY,k.maxBounds.maxY)),O=Math.max(O,k.maxBounds.minX),V=Math.min(V,k.maxBounds.maxX);const M=new Bounds2(isFinite(s.minX)&&isFinite(a.minX)?(s.minX+a.minX)/2:Number.POSITIVE_INFINITY,isFinite(s.minY)&&isFinite(a.minY)?(s.minY+a.minY)/2:Number.POSITIVE_INFINITY,isFinite(s.maxX)&&isFinite(a.maxX)?(s.maxX+a.maxX)/2:Number.NEGATIVE_INFINITY,isFinite(s.maxY)&&isFinite(a.maxY)?(s.maxY+a.maxY)/2:Number.NEGATIVE_INFINITY);return M.minBounds=s,M.maxBounds=a,M.isConsistent=a.containsBounds(s),M.precision=Math.max(Math.abs(s.minX-a.minX),Math.abs(s.minY-a.minY),Math.abs(s.maxX-a.maxX),Math.abs(s.maxY-a.maxY)),M},toPowerOf2(o){let e=1;for(;e<o;)e*=2;return e},createShader(o,e,t){const n=o.createShader(t);return o.shaderSource(n,e),o.compileShader(n),o.getShaderParameter(n,o.COMPILE_STATUS)||(console.log("GLSL compile error:"),console.log(o.getShaderInfoLog(n)),console.log(e)),n},applyWebGLContextDefaults(o){o.clearColor(0,0,0,0),o.enable(o.BLEND),o.blendFunc(o.ONE,o.ONE_MINUS_SRC_ALPHA)},setWebGLEnabled(o){webglEnabled=o},checkWebGLSupport(o){if(!webglEnabled)return!1;const e=document.createElement("canvas"),t={failIfMajorPerformanceCaveat:!0};try{const n=!!window.WebGLRenderingContext&&(e.getContext("webgl",t)||e.getContext("experimental-webgl",t));if(!n)return!1;if(o){for(let r=0;r<o.length;r++)if(n.getExtension(o[r])===null)return!1}return!0}catch{return!1}},checkIE11StencilSupport(){const o=document.createElement("canvas");try{const e=!!window.WebGLRenderingContext&&(o.getContext("webgl")||o.getContext("experimental-webgl"));return e?(e.clearStencil(0),e.getError()===0):!1}catch{return!1}},get isWebGLSupported(){return _extensionlessWebGLSupport===void 0&&(_extensionlessWebGLSupport=Utils.checkWebGLSupport()),_extensionlessWebGLSupport},loseContext(o){const e=o.getExtension("WEBGL_lose_context");e&&(e.loseContext(),setTimeout(()=>{e.restoreContext()},1e3))},safariEmbeddingMarkWorkaround(o){if(platform.safari){const e=o.split("");let t="",n=!1;for(let r=0;r<e.length;r++){const s=e[r],a=s==="‪"||s==="‫"||s==="‬";n&&a&&(t+="​"),t+=s,n=a}return t}else return o}};scenery.register("Utils",Utils);const Fs=class Fs{constructor(e,t){this.display=e,this.trail=t}};Fs.FocusIO=new IOType("FocusIO",{valueType:Fs,documentation:"A PhET-iO Type for the instance in the simulation which currently has keyboard focus. FocusIO is serialized into and Object with key `focusedPhetioElement` that is a list of PhET-iO Elements, from parent-most to child-most corresponding to the PhET-iO Element that was instrumented.",toStateObject:e=>{const t=[];return e.trail.nodes.forEach((n,r)=>{n.isPhetioInstrumented()&&t.push(n.tandem.phetioID)}),{focusedPhetioElement:t}},stateSchema:{focusedPhetioElement:ArrayIO(StringIO)}});let Focus=Fs;scenery.register("Focus",Focus);const KEY_RIGHT_ARROW="ArrowRight",KEY_LEFT_ARROW="ArrowLeft",KEY_UP_ARROW="ArrowUp",KEY_DOWN_ARROW="ArrowDown",KEY_SHIFT_RIGHT="ShiftRight",KEY_SHIFT_LEFT="ShiftLeft",KEY_CONTROL_LEFT="ControlLeft",KEY_CONTROL_RIGHT="ControlRight",KEY_ALT_LEFT="AltLeft",KEY_ALT_RIGHT="AltRight",KEY_META_LEFT="MetaLeft",KEY_META_RIGHT="MetaRight",KEY_META_LEFT_FIREFOX="OSLeft",KEY_META_RIGHT_FIREFOX="OSRight",KEY_W="KeyW",KEY_A="KeyA",KEY_S="KeyS",KEY_D="KeyD",KEY_0="Digit0",KEY_1="Digit1",KEY_2="Digit2",KEY_3="Digit3",KEY_4="Digit4",KEY_5="Digit5",KEY_6="Digit6",KEY_7="Digit7",KEY_8="Digit8",KEY_9="Digit9",KEY_ALT="Alt",KEY_SHIFT="Shift",KEY_CONTROL="Control",ARROW_KEYS=[KEY_RIGHT_ARROW,KEY_LEFT_ARROW,KEY_UP_ARROW,KEY_DOWN_ARROW],WASD_KEYS=[KEY_W,KEY_S,KEY_A,KEY_D],NUMBER_KEYS=[KEY_0,KEY_1,KEY_2,KEY_3,KEY_4,KEY_5,KEY_6,KEY_7,KEY_8,KEY_9],SHIFT_KEYS=[KEY_SHIFT_LEFT,KEY_SHIFT_RIGHT],CONTROL_KEYS=[KEY_CONTROL_LEFT,KEY_CONTROL_RIGHT],ALT_KEYS=[KEY_ALT_LEFT,KEY_ALT_RIGHT],META_KEYS=[KEY_META_LEFT,KEY_META_RIGHT,KEY_META_LEFT_FIREFOX,KEY_META_RIGHT_FIREFOX],MODIFIER_KEYS=[KEY_ALT,KEY_CONTROL,KEY_SHIFT],MODIFIER_KEY_CODES=[KEY_ALT_LEFT,KEY_ALT_RIGHT,KEY_CONTROL_LEFT,KEY_CONTROL_RIGHT,KEY_SHIFT_LEFT,KEY_SHIFT_RIGHT,KEY_META_LEFT,KEY_META_RIGHT,KEY_META_LEFT_FIREFOX,KEY_META_RIGHT_FIREFOX],DOM_EVENT_VALIDATOR={valueType:Event},ALL_KEY_CODES=[],KeyboardUtils={KEY_SPACE:"Space",KEY_ENTER:"Enter",KEY_TAB:"Tab",KEY_RIGHT_ARROW,KEY_LEFT_ARROW,KEY_UP_ARROW,KEY_DOWN_ARROW,KEY_SHIFT_LEFT,KEY_SHIFT_RIGHT,KEY_ALT_LEFT,KEY_ALT_RIGHT,KEY_CONTROL_LEFT,KEY_CONTROL_RIGHT,KEY_META_LEFT,KEY_META_RIGHT,KEY_META_LEFT_FIREFOX,KEY_META_RIGHT_FIREFOX,KEY_SHIFT,KEY_ALT,KEY_CONTROL,KEY_ESCAPE:"Escape",KEY_DELETE:"Delete",KEY_BACKSPACE:"Backspace",KEY_PAGE_UP:"PageUp",KEY_PAGE_DOWN:"PageDown",KEY_END:"End",KEY_HOME:"Home",KEY_0,KEY_1,KEY_2,KEY_3,KEY_4,KEY_5,KEY_6,KEY_7,KEY_8,KEY_9,KEY_NUMPAD_0:"Numpad0",KEY_NUMPAD_1:"Numpad1",KEY_NUMPAD_2:"Numpad2",KEY_NUMPAD_3:"Numpad3",KEY_NUMPAD_4:"Numpad4",KEY_NUMPAD_5:"Numpad5",KEY_NUMPAD_6:"Numpad6",KEY_NUMPAD_7:"Numpad7",KEY_NUMPAD_8:"Numpad8",KEY_NUMPAD_9:"Numpad9",KEY_NUMPAD_DECIMAL:"NumpadDecimal",KEY_NUMPAD_PLUS:"NumpadAdd",KEY_NUMPAD_MINUS:"NumpadSubtract",KEY_A:"KeyA",KEY_B:"KeyB",KEY_C:"KeyC",KEY_D:"KeyD",KEY_E:"KeyE",KEY_F:"KeyF",KEY_G:"KeyG",KEY_H:"KeyH",KEY_I:"KeyI",KEY_J:"KeyJ",KEY_K:"KeyK",KEY_L:"KeyL",KEY_M:"KeyM",KEY_N:"KeyN",KEY_O:"KeyO",KEY_P:"KeyP",KEY_Q:"KeyQ",KEY_R:"KeyR",KEY_S:"KeyS",KEY_T:"KeyT",KEY_U:"KeyU",KEY_V:"KeyV",KEY_W:"KeyW",KEY_X:"KeyX",KEY_Y:"KeyY",KEY_Z:"KeyZ",KEY_EQUALS:"Equal",KEY_PLUS:"Equal",KEY_MINUS:"Minus",KEY_PERIOD:"Period",ARROW_KEYS,WASD_KEYS,MOVEMENT_KEYS:ARROW_KEYS.concat(WASD_KEYS),SHIFT_KEYS,CONTROL_KEYS,ALT_KEYS,META_KEYS,MODIFIER_KEY_CODES,MODIFIER_KEY_TO_CODE_MAP:new Map([[KEY_ALT,ALT_KEYS],[KEY_SHIFT,SHIFT_KEYS],[KEY_CONTROL,CONTROL_KEYS]]),isArrowKey(o){return KeyboardUtils.isAnyKeyEvent(o,ARROW_KEYS)},isRangeKey(o){return KeyboardUtils.isArrowKey(o)||KeyboardUtils.isAnyKeyEvent(o,[KeyboardUtils.KEY_PAGE_UP,KeyboardUtils.KEY_PAGE_DOWN,KeyboardUtils.KEY_HOME,KeyboardUtils.KEY_END])},isNumberKey(o){return KeyboardUtils.isAnyKeyEvent(o,NUMBER_KEYS)},getNumberFromCode(o){return KeyboardUtils.isNumberKey(o)&&o instanceof KeyboardEvent?Number(o.code.replace("Digit","")):null},isShiftKey(o){return KeyboardUtils.isAnyKeyEvent(o,SHIFT_KEYS)},isAltKey(o){return KeyboardUtils.isAnyKeyEvent(o,ALT_KEYS)},isControlKey(o){return KeyboardUtils.isAnyKeyEvent(o,CONTROL_KEYS)},isMetaKey(o){return KeyboardUtils.isAnyKeyEvent(o,META_KEYS)},isWASDKey(o){return KeyboardUtils.isAnyKeyEvent(o,WASD_KEYS)},isMovementKey(o){return KeyboardUtils.isAnyKeyEvent(o,KeyboardUtils.MOVEMENT_KEYS)},isAnyKeyEvent(o,e){validate(o,DOM_EVENT_VALIDATOR);const t=KeyboardUtils.getEventCode(o);return t?e.includes(t):!1},isKeyEvent(o,e){return KeyboardUtils.getEventCode(o)===e},getEventCode(o){let e=null;return o instanceof KeyboardEvent&&o.code&&(e=o.code,e.startsWith("Numpad")&&ALL_KEY_CODES.includes(o.key)&&(e=o.key)),e},isModifierKey(o){return MODIFIER_KEYS.includes(o)},ALL_KEYS:ALL_KEY_CODES};for(const o in KeyboardUtils)KeyboardUtils.hasOwnProperty(o)&&typeof KeyboardUtils[o]=="string"&&ALL_KEY_CODES.push(KeyboardUtils[o]);scenery.register("KeyboardUtils",KeyboardUtils);const EnglishStringToCodeMap={q:[KeyboardUtils.KEY_Q],w:[KeyboardUtils.KEY_W],e:[KeyboardUtils.KEY_E],r:[KeyboardUtils.KEY_R],t:[KeyboardUtils.KEY_T],y:[KeyboardUtils.KEY_Y],u:[KeyboardUtils.KEY_U],i:[KeyboardUtils.KEY_I],o:[KeyboardUtils.KEY_O],p:[KeyboardUtils.KEY_P],a:[KeyboardUtils.KEY_A],s:[KeyboardUtils.KEY_S],d:[KeyboardUtils.KEY_D],f:[KeyboardUtils.KEY_F],g:[KeyboardUtils.KEY_G],h:[KeyboardUtils.KEY_H],j:[KeyboardUtils.KEY_J],k:[KeyboardUtils.KEY_K],l:[KeyboardUtils.KEY_L],z:[KeyboardUtils.KEY_Z],x:[KeyboardUtils.KEY_X],c:[KeyboardUtils.KEY_C],v:[KeyboardUtils.KEY_V],b:[KeyboardUtils.KEY_B],n:[KeyboardUtils.KEY_N],m:[KeyboardUtils.KEY_M],0:[KeyboardUtils.KEY_0,KeyboardUtils.KEY_NUMPAD_0],1:[KeyboardUtils.KEY_1,KeyboardUtils.KEY_NUMPAD_1],2:[KeyboardUtils.KEY_2,KeyboardUtils.KEY_NUMPAD_2],3:[KeyboardUtils.KEY_3,KeyboardUtils.KEY_NUMPAD_3],4:[KeyboardUtils.KEY_4,KeyboardUtils.KEY_NUMPAD_4],5:[KeyboardUtils.KEY_5,KeyboardUtils.KEY_NUMPAD_5],6:[KeyboardUtils.KEY_6,KeyboardUtils.KEY_NUMPAD_6],7:[KeyboardUtils.KEY_7,KeyboardUtils.KEY_NUMPAD_7],8:[KeyboardUtils.KEY_8,KeyboardUtils.KEY_NUMPAD_8],9:[KeyboardUtils.KEY_9,KeyboardUtils.KEY_NUMPAD_9],enter:[KeyboardUtils.KEY_ENTER],tab:[KeyboardUtils.KEY_TAB],equals:[KeyboardUtils.KEY_EQUALS],plus:[KeyboardUtils.KEY_PLUS,KeyboardUtils.KEY_NUMPAD_PLUS],minus:[KeyboardUtils.KEY_MINUS,KeyboardUtils.KEY_NUMPAD_MINUS],period:[KeyboardUtils.KEY_PERIOD,KeyboardUtils.KEY_NUMPAD_DECIMAL],escape:[KeyboardUtils.KEY_ESCAPE],delete:[KeyboardUtils.KEY_DELETE],backspace:[KeyboardUtils.KEY_BACKSPACE],pageUp:[KeyboardUtils.KEY_PAGE_UP],pageDown:[KeyboardUtils.KEY_PAGE_DOWN],end:[KeyboardUtils.KEY_END],home:[KeyboardUtils.KEY_HOME],space:[KeyboardUtils.KEY_SPACE],arrowLeft:[KeyboardUtils.KEY_LEFT_ARROW],arrowRight:[KeyboardUtils.KEY_RIGHT_ARROW],arrowUp:[KeyboardUtils.KEY_UP_ARROW],arrowDown:[KeyboardUtils.KEY_DOWN_ARROW],ctrl:KeyboardUtils.CONTROL_KEYS,alt:KeyboardUtils.ALT_KEYS,shift:KeyboardUtils.SHIFT_KEYS,meta:KeyboardUtils.META_KEYS};scenery.register("EnglishStringToCodeMap",EnglishStringToCodeMap);const metaEnglishKeys=["ctrl","alt","shift","meta"],eventCodeToEnglishString=o=>{for(const e in EnglishStringToCodeMap)if(EnglishStringToCodeMap.hasOwnProperty(e)&&EnglishStringToCodeMap[e].includes(o))return e;return null},noExtraPrototype=o=>Object.getPrototypeOf(o)===Object.prototype,ObjectLiteralIO=new IOType("ObjectLiteralIO",{documentation:"PhET-iO Type for object literals",isValidValue:noExtraPrototype,supertype:ValueIO,stateSchema:StateSchema.asValue("object",{valueType:Object,isValidValue:noExtraPrototype}),toStateObject:_.identity});tandemNamespace.register("ObjectLiteralIO",ObjectLiteralIO);const EventIO=new IOType("EventIO",{valueType:window.Event,documentation:"A DOM Event",toStateObject:o=>Input.serializeDomEvent(o),fromStateObject:o=>Input.deserializeDomEvent(o),stateSchema:()=>({constructorName:StringIO,altKey:NullableIO(BooleanIO),button:NullableIO(NumberIO),charCode:NullableIO(NumberIO),clientX:NullableIO(NumberIO),clientY:NullableIO(NumberIO),code:NullableIO(StringIO),ctrlKey:NullableIO(BooleanIO),deltaMode:NullableIO(NumberIO),deltaX:NullableIO(NumberIO),deltaY:NullableIO(NumberIO),deltaZ:NullableIO(NumberIO),key:NullableIO(StringIO),keyCode:NullableIO(NumberIO),metaKey:NullableIO(BooleanIO),pageX:NullableIO(NumberIO),pageY:NullableIO(NumberIO),pointerId:NullableIO(NumberIO),pointerType:NullableIO(StringIO),scale:NullableIO(NumberIO),shiftKey:NullableIO(BooleanIO),target:NullableIO(ObjectLiteralIO),type:NullableIO(StringIO),relatedTarget:NullableIO(ObjectLiteralIO),which:NullableIO(NumberIO)})});scenery.register("EventIO",EventIO);const styleElement=document.createElement("style");styleElement.type="text/css";document.head.appendChild(styleElement);const stylesheet=document.styleSheets[document.styleSheets.length-1];assert&&assert(stylesheet.disabled===!1);const SceneryStyle={stylesheet,styleElement,addRule(o){this.stylesheet.insertRule(o,0)}};scenery.register("SceneryStyle",SceneryStyle);class CanvasContextWrapper{constructor(e,t){this.canvas=e,this.context=t,this.resetStyles()}resetStyles(){this.fillStyle=void 0,this.strokeStyle=void 0,this.lineWidth=void 0,this.lineCap=void 0,this.lineJoin=void 0,this.lineDash=void 0,this.lineDashOffset=void 0,this.miterLimit=void 0,this.font=void 0,this.direction=void 0}setDimensions(e,t){this.canvas.width=e,this.canvas.height=t,this.resetStyles()}setFillStyle(e){e&&isTReadOnlyProperty(e)&&(e=e.value),e&&e.getCanvasStyle&&(e=e.getCanvasStyle()),this.fillStyle!==e&&(this.fillStyle=e,this.context.fillStyle=e)}setStrokeStyle(e){e&&isTReadOnlyProperty(e)&&(e=e.value),e&&e.getCanvasStyle&&(e=e.getCanvasStyle()),this.strokeStyle!==e&&(this.strokeStyle=e,this.context.strokeStyle=e)}setLineWidth(e){this.lineWidth!==e&&(this.lineWidth=e,this.context.lineWidth=e)}setLineCap(e){this.lineCap!==e&&(this.lineCap=e,this.context.lineCap=e)}setLineJoin(e){this.lineJoin!==e&&(this.lineJoin=e,this.context.lineJoin=e)}setMiterLimit(e){assert&&assert(typeof e=="number"),this.miterLimit!==e&&(this.miterLimit=e,this.context.miterLimit=e)}setLineDash(e){assert&&assert(e!==void 0,"undefined line dash would cause hard-to-trace errors"),this.lineDash!==e&&(this.lineDash=e,this.context.setLineDash?this.context.setLineDash(e===null?[]:e):this.context.mozDash!==void 0?this.context.mozDash=e:this.context.webkitLineDash!==void 0&&(this.context.webkitLineDash=e||[]))}setLineDashOffset(e){this.lineDashOffset!==e&&(this.lineDashOffset=e,this.context.lineDashOffset!==void 0?this.context.lineDashOffset=e:this.context.webkitLineDashOffset!==void 0&&(this.context.webkitLineDashOffset=e))}setFont(e){this.font!==e&&(this.font=e,this.context.font=e)}setDirection(e){this.direction!==e&&(this.direction=e,this.context.direction=e)}}scenery.register("CanvasContextWrapper",CanvasContextWrapper);const exitFullscreenPropertyName=detectPrefix(document,"exitFullscreen")||detectPrefix(document,"cancelFullScreen"),fullscreenElementPropertyName=detectPrefix(document,"fullscreenElement")||detectPrefix(document,"fullScreenElement"),fullscreenEnabledPropertyName=detectPrefix(document,"fullscreenEnabled")||detectPrefix(document,"fullScreenEnabled");let fullscreenChangeEvent=detectPrefixEvent(document,"fullscreenchange");fullscreenChangeEvent==="msfullscreenchange"&&(fullscreenChangeEvent="MSFullscreenChange");const FullScreen={isFullScreen(){return!!document[fullscreenElementPropertyName]},isFullScreenEnabled(){return document[fullscreenEnabledPropertyName]&&!platform.safari7},enterFullScreen(o){const e=detectPrefix(document.body,"requestFullscreen")||detectPrefix(document.body,"requestFullScreen");o.domElement[e]&&o.domElement[e]()},exitFullScreen(){document[exitFullscreenPropertyName]&&document[exitFullscreenPropertyName]()},toggleFullScreen(o){FullScreen.isFullScreen()?FullScreen.exitFullScreen():FullScreen.enterFullScreen(o)},isFullScreenProperty:new Property(!1)};document.addEventListener(fullscreenChangeEvent,o=>{FullScreen.isFullScreenProperty.set(FullScreen.isFullScreen())});scenery.register("FullScreen",FullScreen);const FullScreen$1=FullScreen;class CountMap{constructor(e,t){this.create=e,this.destroy=t,this.map=new Map}increment(e,t=1){if(assert&&assert(typeof t=="number"),assert&&assert(t>=1),this.map.has(e))this.map.get(e).count+=t;else{const n=this.create(e),r=CountMapEntry.createFromPool(t,e,n);this.map.set(e,r)}}decrement(e,t=1){assert&&assert(typeof t=="number"),assert&&assert(t>=1);const n=this.map.get(e);n&&(n.count-=t,n.count<1&&(this.destroy(e,n.value),this.map.delete(e),n.dispose()))}get(e){return this.map.get(e).value}clear(){this.map.clear()}}class CountMapEntry{constructor(e,t,n){this.initialize(e,t,n)}initialize(e,t,n){this.count=e,this.key=t,this.value=n}dispose(){this.key=null,this.value=null,this.freeToPool()}}Poolable.mixInto(CountMapEntry,{initialize:CountMapEntry.prototype.initialize});scenery.register("CountMap",CountMap);class DisplayedTrailsProperty extends TinyProperty{constructor(e,t){const n=optionize()({display:null,followPdomOrder:!1,requireVisible:!0,requirePdomVisible:!1,requireEnabled:!1,requireInputEnabled:!1},t);super([]),this.listenedNodeSet=new Set,this.node=e,this.display=n.display,this.followPdomOrder=n.followPdomOrder,this.requireVisible=n.requireVisible,this.requirePdomVisible=n.requirePdomVisible,this.requireEnabled=n.requireEnabled,this.requireInputEnabled=n.requireInputEnabled,this._trailUpdateListener=this.update.bind(this),this.update()}update(){const e=this.display,t=this.followPdomOrder,n=this.requireVisible,r=this.requirePdomVisible,s=this.requireEnabled,a=this.requireInputEnabled,h=[],c=new Set,d=new Trail(this.node);(function D(){const O=d.rootNode();if(O.isDisposed||(c.add(O),n&&!O.visible||r&&!O.pdomVisible||s&&!O.enabled||a&&!O.inputEnabled))return;const V=O.getRootedDisplays();let k;e===null?k=V.length>0:e instanceof Display?k=V.includes(e):k=V.some(e),k&&h.push(d.copy()),(t&&O.pdomParent?[O.pdomParent]:O.parents).forEach(N=>{d.addAncestor(N),D(),d.removeAncestor()})})(),c.forEach(D=>{this.listenedNodeSet.has(D)||this.addNodeListener(D)}),this.listenedNodeSet.forEach(D=>{c.has(D)||this.removeNodeListener(D)});const y=this.value;let g=y.length===h.length;if(g){for(let D=0;D<h.length;D++)if(!y[D].equals(h[D])){g=!1;break}}g||(this.value=h)}addNodeListener(e){this.listenedNodeSet.add(e),e.parentAddedEmitter.addListener(this._trailUpdateListener),e.parentRemovedEmitter.addListener(this._trailUpdateListener),e.rootedDisplayChangedEmitter.addListener(this._trailUpdateListener),e.disposeEmitter.addListener(this._trailUpdateListener),this.followPdomOrder&&e.pdomParentChangedEmitter.addListener(this._trailUpdateListener),this.requireVisible&&e.visibleProperty.lazyLink(this._trailUpdateListener),this.requirePdomVisible&&e.pdomVisibleProperty.lazyLink(this._trailUpdateListener),this.requireEnabled&&e.enabledProperty.lazyLink(this._trailUpdateListener),this.requireInputEnabled&&e.inputEnabledProperty.lazyLink(this._trailUpdateListener)}removeNodeListener(e){this.listenedNodeSet.delete(e),e.parentAddedEmitter.removeListener(this._trailUpdateListener),e.parentRemovedEmitter.removeListener(this._trailUpdateListener),e.rootedDisplayChangedEmitter.removeListener(this._trailUpdateListener),e.disposeEmitter.removeListener(this._trailUpdateListener),this.followPdomOrder&&e.pdomParentChangedEmitter.removeListener(this._trailUpdateListener),this.requireVisible&&e.visibleProperty.unlink(this._trailUpdateListener),this.requirePdomVisible&&e.pdomVisibleProperty.unlink(this._trailUpdateListener),this.requireEnabled&&e.enabledProperty.unlink(this._trailUpdateListener),this.requireInputEnabled&&e.inputEnabledProperty.unlink(this._trailUpdateListener)}dispose(){this.listenedNodeSet.forEach(e=>this.removeNodeListener(e)),super.dispose()}}scenery.register("DisplayedTrailsProperty",DisplayedTrailsProperty);class DisplayedProperty extends DerivedProperty1{constructor(e,t){const n=new DisplayedTrailsProperty(e,t);super([n],r=>r.length>0,t),this.displayedTrailsProperty=n}dispose(){this.displayedTrailsProperty.dispose(),super.dispose()}}scenery.register("DisplayedProperty",DisplayedProperty);class SceneImage{constructor(e){this.scene=e,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.img=document.createElement("img"),this.update()}update(e){this.scene.updateScene(),this.canvas.width=this.scene.getSceneWidth(),this.canvas.height=this.scene.getSceneHeight(),this.scene.renderToCanvas(this.canvas,this.context,()=>{const t=this.toDataURL();this.img.onload=()=>{e(),delete this.img.onload},this.img.src=t})}}scenery.register("SceneImage",SceneImage);var ar,lr,hr,cr,dr;const allowLinksProperty=new BooleanProperty(!((lr=(ar=window==null?void 0:window.phet)==null?void 0:ar.chipper)!=null&&lr.queryParameters)||((dr=(cr=(hr=window==null?void 0:window.phet)==null?void 0:hr.chipper)==null?void 0:cr.queryParameters)==null?void 0:dr.allowLinks),{tandem:Tandem.GENERAL_MODEL.createTandem("allowLinksProperty")});scenery.register("allowLinksProperty",allowLinksProperty);function openPopup(o,e=allowLinksProperty.value){const t=phet&&phet.chipper&&phet.chipper.isFuzzEnabled();if(e&&!t){const n=window.open(o,"_blank");n&&n.focus()}}scenery.register("openPopup",openPopup);const getLineBreakRanges=(o,e)=>{const t=optionize()({requiredOnly:!1},e),n=[],r=new LineBreaker(o);r[Symbol.iterator]=()=>({next(){const a=r.nextBreak();return a!==null?{value:a,done:!1}:{done:!0}}});let s=0;for(const a of r){const h=a.position;t.requiredOnly&&!a.required||(s!==h&&n.push(new Range(s,h)),s=a.position)}return s<o.length&&n.push(new Range(s,o.length)),n};scenery.register("getLineBreakRanges",getLineBreakRanges);const kite=new Namespace("kite"),lineLineIntersection=DotUtils.lineLineIntersection,DEFAULT_OPTIONS$8={lineWidth:1,lineCap:"butt",lineJoin:"miter",lineDash:[],lineDashOffset:0,miterLimit:10};class LineStyles{constructor(e){const t=merge({},DEFAULT_OPTIONS$8,e);this.lineWidth=t.lineWidth,this.lineCap=t.lineCap,this.lineJoin=t.lineJoin,this.lineDash=t.lineDash,this.lineDashOffset=t.lineDashOffset,this.miterLimit=t.miterLimit,assert&&assert(typeof this.lineWidth=="number",`lineWidth should be a number: ${this.lineWidth}`),assert&&assert(isFinite(this.lineWidth),`lineWidth should be a finite number: ${this.lineWidth}`),assert&&assert(this.lineWidth>=0,`lineWidth should be non-negative: ${this.lineWidth}`),assert&&assert(this.lineCap==="butt"||this.lineCap==="round"||this.lineCap==="square",`Invalid lineCap: ${this.lineCap}`),assert&&assert(this.lineJoin==="miter"||this.lineJoin==="round"||this.lineJoin==="bevel",`Invalid lineJoin: ${this.lineJoin}`),assert&&assert(Array.isArray(this.lineDash),`lineDash should be an array: ${this.lineDash}`),assert&&assert(_.every(this.lineDash,n=>typeof n=="number"&&isFinite(n)&&n>=0),`Every lineDash should be a non-negative finite number: ${this.lineDash}`),assert&&assert(typeof this.lineDashOffset=="number",`lineDashOffset should be a number: ${this.lineDashOffset}`),assert&&assert(isFinite(this.lineDashOffset),`lineDashOffset should be a finite number: ${this.lineDashOffset}`),assert&&assert(typeof this.miterLimit=="number",`miterLimit should be a number: ${this.miterLimit}`),assert&&assert(isFinite(this.miterLimit),`miterLimit should be a finite number: ${this.miterLimit}`)}equals(e){if(!(this.lineWidth===e.lineWidth&&this.lineCap===e.lineCap&&this.lineJoin===e.lineJoin&&this.miterLimit===e.miterLimit&&this.lineDashOffset===e.lineDashOffset))return!1;if(this.lineDash.length===e.lineDash.length){for(let n=0;n<this.lineDash.length;n++)if(this.lineDash[n]!==e.lineDash[n])return!1}else return!1;return!0}copy(){return new LineStyles({lineWidth:this.lineWidth,lineCap:this.lineCap,lineJoin:this.lineJoin,lineDash:this.lineDash,lineDashOffset:this.lineDashOffset,miterLimit:this.miterLimit})}leftJoin(e,t,n){t=t.normalized(),n=n.normalized();const r=e.plus(t.perpendicular.negated().times(this.lineWidth/2)),s=e.plus(n.perpendicular.negated().times(this.lineWidth/2)),a=r.equals(s)?[]:[new Line$1(r,s)];let h,c,d;if(t.perpendicular.dot(n)>1e-12)switch(this.lineJoin){case"round":return h=t.angle+Math.PI/2,c=n.angle+Math.PI/2,[new Arc(e,this.lineWidth/2,h,c,!0)];case"miter":if(d=t.angleBetween(n.negated()),1/Math.sin(d/2)<=this.miterLimit&&d<Math.PI-1e-5){const y=lineLineIntersection(r,r.plus(t),s,s.plus(n));return y?[new Line$1(r,y),new Line$1(y,s)]:[new Line$1(r,s)]}else return a;case"bevel":return a;default:throw new Error(`invalid lineJoin: ${this.lineJoin}`)}else return a}rightJoin(e,t,n){return this.leftJoin(e,n.negated(),t.negated())}cap(e,t){t=t.normalized();const n=e.plus(t.perpendicular.times(-this.lineWidth/2)),r=e.plus(t.perpendicular.times(this.lineWidth/2));let s,a,h,c,d,y;switch(this.lineCap){case"butt":return[new Line$1(n,r)];case"round":return s=t.angle,[new Arc(e,this.lineWidth/2,s+Math.PI/2,s-Math.PI/2,!0)];case"square":return a=t.perpendicular.negated().times(this.lineWidth/2),h=t.perpendicular.times(this.lineWidth/2),c=t.times(this.lineWidth/2),d=e.plus(a).plus(c),y=e.plus(h).plus(c),[new Line$1(n,d),new Line$1(d,y),new Line$1(y,r)];default:throw new Error(`invalid lineCap: ${this.lineCap}`)}}}kite.register("LineStyles",LineStyles);class Overlap{constructor(e,t){assert&&assert(isFinite(e)&&e!==0,"a should be a finite non-zero number"),assert&&assert(isFinite(t),"b should be a finite number"),this.a=e,this.b=t;let n=0,r=1,s=this.apply(n),a=this.apply(r);s>1&&(s=1,n=this.applyInverse(s)),s<0&&(s=0,n=this.applyInverse(s)),a>1&&(a=1,r=this.applyInverse(a)),a<0&&(a=0,r=this.applyInverse(a)),this.t0=n,this.t1=r,e>0?(this.qt0=s,this.qt1=a):(this.qt0=a,this.qt1=s),this.t0<0&&this.t0>-1e-8&&(this.t0=0),this.t0>1&&this.t0<1+1e-8&&(this.t0=1),this.t1<0&&this.t1>-1e-8&&(this.t1=0),this.t1>1&&this.t1<1+1e-8&&(this.t1=1),this.qt0<0&&this.qt0>-1e-8&&(this.qt0=0),this.qt0>1&&this.qt0<1+1e-8&&(this.qt0=1),this.qt1<0&&this.qt1>-1e-8&&(this.qt1=0),this.qt1>1&&this.qt1<1+1e-8&&(this.qt1=1),assert&&assert(this.t0>=0&&this.t0<=1,`t0 out of range: ${this.t0}`),assert&&assert(this.t1>=0&&this.t1<=1,`t1 out of range: ${this.t1}`),assert&&assert(this.qt0>=0&&this.qt0<=1,`qt0 out of range: ${this.qt0}`),assert&&assert(this.qt1>=0&&this.qt1<=1,`qt1 out of range: ${this.qt1}`)}apply(e){return this.a*e+this.b}applyInverse(e){return(e-this.b)/this.a}static createLinear(e,t,n,r){const s=(r-t)/(n-e);return new Overlap(s,t-e*s)}}kite.register("Overlap",Overlap);class RayIntersection{constructor(e,t,n,r,s){assert&&assert(isFinite(e)&&e>=0,"invalid distance"),assert&&assert(Math.abs(n.magnitude-1)<1e-7,"invalid normal"),assert&&assert(s>=-1e-10&&s<=1+1e-10,`t out of range: ${s}`),this.point=t,this.normal=n,this.distance=e,this.wind=r,this.t=DotUtils.clamp(s,0,1)}}kite.register("RayIntersection",RayIntersection);class SegmentIntersection{constructor(e,t,n){assert&&assert(t>=-1e-10&&t<=1+1e-10,"aT out of range"),assert&&assert(n>=-1e-10&&n<=1+1e-10,"bT out of range"),this.point=e,this.aT=DotUtils.clamp(t,0,1),this.bT=DotUtils.clamp(n,0,1)}getSwapped(){return new SegmentIntersection(this.point,this.bT,this.aT)}}kite.register("SegmentIntersection",SegmentIntersection);const svgNumber=o=>o.toFixed(20);kite.register("svgNumber",svgNumber);const getDet2=(o,e,t,n)=>o.times(n).minus(e.times(t)),getDeterminant=o=>{const e=o[0],t=o[1],n=o[2],r=o[3],s=o[4],a=o[5],h=o[6],c=o[7],d=o[8];return e.times(s).times(d).plus(t.times(a).times(h)).plus(n.times(r).times(c)).minus(n.times(s).times(h)).minus(t.times(r).times(d)).minus(e.times(a).times(c))},getAdjugateMatrix=o=>{const e=o[0],t=o[1],n=o[2],r=o[3],s=o[4],a=o[5],h=o[6],c=o[7],d=o[8];return[getDet2(s,a,c,d),getDet2(t,n,c,d).negate(),getDet2(t,n,s,a),getDet2(r,a,h,d).negate(),getDet2(e,n,h,d),getDet2(e,n,r,a).negate(),getDet2(r,s,h,c),getDet2(e,t,h,c).negate(),getDet2(e,t,r,s)]},getTranspose=o=>[o[0],o[3],o[6],o[1],o[4],o[7],o[2],o[5],o[8]],getNonzeroRow=(o,e=!1)=>_.sortBy([o.slice(0,3),o.slice(3,6),o.slice(6,9)],t=>-(t[0].magnitude+t[1].magnitude+(e?t[2].magnitude:0)))[0],getNonzeroColumn=(o,e=!1)=>getNonzeroRow(getTranspose(o),e),getAntiSymmetricMatrix=o=>{const e=getAdjugateMatrix(o),t=getNonzeroRow(e);return[Complex.ZERO,t[2],t[1].negated(),t[2].negated(),Complex.ZERO,t[0],t[1],t[0].negated(),Complex.ZERO]},computeAlpha=(o,e)=>{const t=o[0],n=o[1],r=o[3],s=o[4],a=e[0],h=e[1],c=e[3],d=e[4],y=h.times(c).minus(a.times(d)),g=d.negated().times(t).plus(c.times(n)).plus(h.times(r)).minus(a.times(s)),D=n.times(r).minus(t.times(s)),O=Complex.solveQuadraticRoots(y,g,D);return O===null?null:O[0]},getRank1DegenerateConicMatrix=o=>{const e=getAntiSymmetricMatrix(o),t=computeAlpha(o,e);return t===null?o:[o[0].plus(t.times(e[0])),o[1].plus(t.times(e[1])),o[2].plus(t.times(e[2])),o[3].plus(t.times(e[3])),o[4].plus(t.times(e[4])),o[5].plus(t.times(e[5])),o[6].plus(t.times(e[6])),o[7].plus(t.times(e[7])),o[8].plus(t.times(e[8]))]},getRealIntersectionsForDegenerateConic=o=>{const e=[],t=o[0],n=o[1].times(Complex.real(2)),r=o[4],s=o[2].times(Complex.real(2)),a=o[5].times(Complex.real(2)),h=o[8];let c=[];const d=new Complex(-2.51653525696959,1.5292850284402),y=r,g=n.times(d).plus(a),D=t.times(d).times(d).plus(s.times(d)).plus(h),O=Complex.solveQuadraticRoots(y,g,D);if(O&&O.length>=2)c=[[d,O[0]],[d,O[1]]];else{const V=t,k=n.times(d).plus(s),M=r.times(d).times(d).plus(a.times(d)).plus(h),N=Complex.solveQuadraticRoots(V,k,M);if(N&&N.length>=2)c=[[N[0],d],[N[1],d]];else if(O&&O.length===1)c=[[d,O[0]]];else if(N&&N.length===1)c=[[N[0],d]];else throw new Error("Implement more advanced initialization to find two solutions")}return c.forEach(V=>{const k=V[0].real,M=V[1].real,N=V[0].imaginary,F=V[1].imaginary,G=t.real,ie=n.real,Z=r.real,W=s.real,X=a.real,J=t.imaginary,oe=n.imaginary,le=r.imaginary,pe=s.imaginary,ve=a.imaginary,Oe=new Vector4(-2*J*N-oe*F+W+2*G*k+ie*M,-oe*N-2*le*F+X+ie*k+2*Z*M,-pe-2*N*G-F*ie-2*J*k-oe*M,-ve-N*ie-2*F*Z-oe*k-2*le*M),He=new Vector4(pe+2*N*G+F*ie+2*J*k+oe*M,ve+N*ie+2*F*Z+oe*k+2*le*M,-2*J*N-oe*F+W+2*G*k+ie*M,-oe*N-2*le*F+X+ie*k+2*Z*M),Ue=new Vector4(6.1951068548253,-1.159268950386,.1602918829294,3.205818692048202),Le=new Vector4(-5.420628549296924,-15.2069583028685,.159590602048868,5.10688288040682),Ae=(mt,bt)=>bt.timesScalar(mt.dot(bt)/bt.dot(bt)),ae=Oe,Ie=He.minus(Ae(He,ae)),nt=Ue.minus(Ae(Ue,ae)).minus(Ae(Ue,Ie)),Qe=Le.minus(Ae(Le,ae)).minus(Ae(Le,Ie)).minus(Ae(Le,nt)),Be=new Matrix(2,2,[nt.z,Qe.z,nt.w,Qe.w]),We=new SingularValueDecomposition(Be).getSingularValues();let ft=null;if(Math.abs(N)<1e-10&&Math.abs(F)<1e-10)ft=new Vector2(k,M);else{if(Math.abs(We[1])>1e-10){const mt=Be.solve(new Matrix(2,1,[-N,-F])).extractVector2(0);ft=new Vector2(k+mt.x*nt.z+mt.y*Qe.z,M+mt.x*nt.w+mt.y*Qe.w)}else if(Math.abs(We[0])>1e-10){const mt=Math.abs(nt.z)+Math.abs(nt.w)>Math.abs(Qe.z)+Math.abs(Qe.w)?nt:Qe,bt=new Vector2(mt.z,mt.w),Et=new Vector2(N,F).dot(bt)/bt.dot(bt),wt=new Vector4(k,M,N,F).minus(mt.timesScalar(Et));Math.abs(wt.z)<1e-8&&Math.abs(wt.w)<1e-8&&(ft=new Vector2(wt.x,wt.y))}else ft=null;if(ft){if(Math.abs(We[1])>1e-10)e.push(ft);else if(Math.abs(We[0])>1e-10){const mt=Math.abs(nt.z)+Math.abs(nt.w)>Math.abs(Qe.z)+Math.abs(Qe.w),bt=mt?Qe:nt,Et=mt?nt:Qe,vt=Math.abs(Et.z)>Math.abs(Et.w)?bt.z/Et.z:bt.w/Et.w,Ut=Et.timesScalar(vt).minus(bt);e.push(new Ray2(ft,new Vector2(Ut.x,Ut.y).normalized()))}}}}),e},getLinesForDegenerateConic=o=>{const e=getRank1DegenerateConicMatrix(o);return[getNonzeroRow(e),getNonzeroColumn(e)]},lineIntersect=(o,e)=>{const t=o[0],n=o[1],r=o[2],s=e[0],a=e[1],h=e[2],c=s.times(n).minus(t.times(a));if(c.equalsEpsilon(Complex.ZERO,1e-8))return null;{const d=a.times(r).minus(n.times(h)).dividedBy(c);let y;if(!n.equalsEpsilon(Complex.ZERO,1e-8))y=t.negated().times(d).minus(r).dividedBy(n);else if(!a.equalsEpsilon(Complex.ZERO,1e-8))y=s.negated().times(d).minus(h).dividedBy(a);else return null;return Math.abs(d.imaginary)<1e-8&&Math.abs(y.imaginary)<1e-8?new Vector2(d.real,y.real):null}},intersectConicMatrices=(o,e)=>{const t=o.m00(),n=o.m01(),r=o.m02(),s=o.m10(),a=o.m11(),h=o.m12(),c=o.m20(),d=o.m21(),y=o.m22(),g=e.m00(),D=e.m01(),O=e.m02(),V=e.m10(),k=e.m11(),M=e.m12(),N=e.m20(),F=e.m21(),G=e.m22(),ie=-r*a*c+n*h*c+r*s*d-t*h*d-n*s*y+t*a*y,Z=-s*y*D+s*d*O+r*d*V-n*y*V-r*c*k+t*y*k+n*c*M-t*d*M+r*s*F+h*(-d*g+c*D+n*N-t*F)-n*s*G+a*(y*g-c*O-r*N+t*G),W=-y*D*V+d*O*V+y*g*k-c*O*k-d*g*M+c*D*M+h*D*N-a*O*N-r*k*N+n*M*N-h*g*F+s*O*F+r*V*F-t*M*F+a*g*G-s*D*G-n*V*G+t*k*G,X=-O*k*N+D*M*N+O*V*F-g*M*F-D*V*G+g*k*G,J=Complex.solveCubicRoots(Complex.real(ie),Complex.real(Z),Complex.real(W),Complex.real(X));if(!J||J.length===0)return{degenerateConicMatrices:[],intersectionCollections:[],points:[],lines:[]};const le=_.uniqWith(J,(He,Ue)=>He.equals(Ue)).map(He=>[Complex.real(t).multiply(He).add(Complex.real(g)),Complex.real(n).multiply(He).add(Complex.real(D)),Complex.real(r).multiply(He).add(Complex.real(O)),Complex.real(s).multiply(He).add(Complex.real(V)),Complex.real(a).multiply(He).add(Complex.real(k)),Complex.real(h).multiply(He).add(Complex.real(M)),Complex.real(c).multiply(He).add(Complex.real(N)),Complex.real(d).multiply(He).add(Complex.real(F)),Complex.real(y).multiply(He).add(Complex.real(G))]);console.log("determinant magnitudes",le.map(He=>getDeterminant(He).magnitude));const pe=[],ve=le.map(getLinesForDegenerateConic);console.log(ve);const Oe=le.map(getRealIntersectionsForDegenerateConic);console.log(Oe);for(let He=0;He<ve.length;He++){const Ue=ve[He],Le=lineIntersect(Ue[0],Ue[1]);Le&&pe.push(Le);for(let Ae=He+1;Ae<ve.length;Ae++){const ae=ve[Ae],Ie=[lineIntersect(Ue[0],ae[0]),lineIntersect(Ue[0],ae[1]),lineIntersect(Ue[1],ae[0]),lineIntersect(Ue[1],ae[1])];for(let nt=0;nt<4;nt++){const Qe=Ie[nt];Qe&&pe.push(Qe)}}}return{points:pe,degenerateConicMatrices:le,lines:_.flatten(ve),intersectionCollections:Oe}};kite.register("intersectConicMatrices",intersectConicMatrices);function quote(o){return'"'+o.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}const result={parse:function(o,e){const t={svgPath:h,movetoDrawtoCommandGroups:c,movetoDrawtoCommandGroup:d,drawtoCommands:y,drawtoCommand:g,moveto:D,movetoArgumentSequence:O,closepath:V,lineto:k,linetoArgumentSequence:M,horizontalLineto:N,horizontalLinetoArgumentSequence:F,verticalLineto:G,verticalLinetoArgumentSequence:ie,curveto:Z,curvetoArgumentSequence:W,curvetoArgument:X,smoothCurveto:J,smoothCurvetoArgumentSequence:oe,smoothCurvetoArgument:le,quadraticBezierCurveto:pe,quadraticBezierCurvetoArgumentSequence:ve,quadraticBezierCurvetoArgument:Oe,smoothQuadraticBezierCurveto:He,smoothQuadraticBezierCurvetoArgumentSequence:Ue,ellipticalArc:Le,ellipticalArcArgumentSequence:Ae,ellipticalArcArgument:ae,coordinatePair:Ie,nonnegativeNumber:nt,number:Qe,flag:Be,commaWsp:We,comma:ft,floatingPointConstant:mt,fractionalConstant:bt,exponent:Et,sign:wt,digitSequence:vt,digit:Ut,wsp:Ne};if(e!==void 0){if(t[e]===void 0)throw new Error("Invalid rule name: "+quote(e)+".")}else e="svgPath";let n=0,r=0,s=[];function a(T){n<r||(n>r&&(r=n,s=[]),s.push(T))}function h(){let T,K,j,ee,re,q;for(re=n,q=n,T=[],K=Ne();K!==null;)T.push(K),K=Ne();if(T!==null)if(K=c(),K=K!==null?K:"",K!==null){for(j=[],ee=Ne();ee!==null;)j.push(ee),ee=Ne();j!==null?T=[T,K,j]:(T=null,n=q)}else T=null,n=q;else T=null,n=q;return T!==null&&(T=function(H,z){return z||[]}(re,T[1])),T===null&&(n=re),T}function c(){let T,K,j,ee,re;if(ee=n,re=n,T=d(),T!==null){for(K=[],j=Ne();j!==null;)K.push(j),j=Ne();K!==null?(j=c(),j!==null?T=[T,K,j]:(T=null,n=re)):(T=null,n=re)}else T=null,n=re;return T!==null&&(T=function(q,H,z){return H.concat(z)}(ee,T[0],T[2])),T===null&&(n=ee),T===null&&(ee=n,T=d(),T!==null&&(T=function(q,H){return H}(ee,T)),T===null&&(n=ee)),T}function d(){let T,K,j,ee,re;if(ee=n,re=n,T=D(),T!==null){for(K=[],j=Ne();j!==null;)K.push(j),j=Ne();K!==null?(j=y(),j=j!==null?j:"",j!==null?T=[T,K,j]:(T=null,n=re)):(T=null,n=re)}else T=null,n=re;return T!==null&&(T=function(q,H,z){return z.length?H.concat(z):H}(ee,T[0],T[2])),T===null&&(n=ee),T}function y(){let T,K,j,ee,re;if(ee=n,re=n,T=g(),T!==null){for(K=[],j=Ne();j!==null;)K.push(j),j=Ne();K!==null?(j=y(),j!==null?T=[T,K,j]:(T=null,n=re)):(T=null,n=re)}else T=null,n=re;return T!==null&&(T=function(q,H,z){return H.concat(z)}(ee,T[0],T[2])),T===null&&(n=ee),T===null&&(ee=n,T=g(),T!==null&&(T=function(q,H){return H}(ee,T)),T===null&&(n=ee)),T}function g(){let T;return T=V(),T===null&&(T=k(),T===null&&(T=N(),T===null&&(T=G(),T===null&&(T=Z(),T===null&&(T=J(),T===null&&(T=pe(),T===null&&(T=He(),T===null&&(T=Le())))))))),T}function D(){let T,K,j,ee,re;if(ee=n,re=n,o.charCodeAt(n)===77?(T="M",n++):(T=null,a('"M"')),T!==null){for(K=[],j=Ne();j!==null;)K.push(j),j=Ne();K!==null?(j=O(),j!==null?T=[T,K,j]:(T=null,n=re)):(T=null,n=re)}else T=null,n=re;if(T!==null&&(T=function(q,H){return Ft(H,!1)}(ee,T[2])),T===null&&(n=ee),T===null){if(ee=n,re=n,o.charCodeAt(n)===109?(T="m",n++):(T=null,a('"m"')),T!==null){for(K=[],j=Ne();j!==null;)K.push(j),j=Ne();K!==null?(j=O(),j!==null?T=[T,K,j]:(T=null,n=re)):(T=null,n=re)}else T=null,n=re;T!==null&&(T=function(q,H){return Ft(H,!0)}(ee,T[2])),T===null&&(n=ee)}return T}function O(){let T,K,j,ee,re;return ee=n,re=n,T=Ie(),T!==null?(K=We(),K=K!==null?K:"",K!==null?(j=M(),j!==null?T=[T,K,j]:(T=null,n=re)):(T=null,n=re)):(T=null,n=re),T!==null&&(T=function(q,H,z){return[H].concat(z)}(ee,T[0],T[2])),T===null&&(n=ee),T===null&&(ee=n,T=Ie(),T!==null&&(T=function(q,H){return[H]}(ee,T)),T===null&&(n=ee)),T}function V(){let T,K;return K=n,o.charCodeAt(n)===90?(T="Z",n++):(T=null,a('"Z"')),T===null&&(o.charCodeAt(n)===122?(T="z",n++):(T=null,a('"z"'))),T!==null&&(T=function(j,ee){return{cmd:"close"}}()),T===null&&(n=K),T}function k(){let T,K,j,ee,re;if(ee=n,re=n,o.charCodeAt(n)===76?(T="L",n++):(T=null,a('"L"')),T!==null){for(K=[],j=Ne();j!==null;)K.push(j),j=Ne();K!==null?(j=M(),j!==null?T=[T,K,j]:(T=null,n=re)):(T=null,n=re)}else T=null,n=re;if(T!==null&&(T=function(q,H){return H.map(z=>({cmd:"lineTo",args:[z.x,z.y]}))}(ee,T[2])),T===null&&(n=ee),T===null){if(ee=n,re=n,o.charCodeAt(n)===108?(T="l",n++):(T=null,a('"l"')),T!==null){for(K=[],j=Ne();j!==null;)K.push(j),j=Ne();K!==null?(j=M(),j!==null?T=[T,K,j]:(T=null,n=re)):(T=null,n=re)}else T=null,n=re;T!==null&&(T=function(q,H){return H.map(z=>({cmd:"lineToRelative",args:[z.x,z.y]}))}(ee,T[2])),T===null&&(n=ee)}return T}function M(){let T,K,j,ee,re;return ee=n,re=n,T=Ie(),T!==null?(K=We(),K=K!==null?K:"",K!==null?(j=M(),j!==null?T=[T,K,j]:(T=null,n=re)):(T=null,n=re)):(T=null,n=re),T!==null&&(T=function(q,H,z){return[H].concat(z)}(ee,T[0],T[2])),T===null&&(n=ee),T===null&&(ee=n,T=Ie(),T!==null&&(T=function(q,H){return[H]}(ee,T)),T===null&&(n=ee)),T}function N(){let T,K,j,ee,re;if(ee=n,re=n,o.charCodeAt(n)===72?(T="H",n++):(T=null,a('"H"')),T!==null){for(K=[],j=Ne();j!==null;)K.push(j),j=Ne();K!==null?(j=F(),j!==null?T=[T,K,j]:(T=null,n=re)):(T=null,n=re)}else T=null,n=re;if(T!==null&&(T=function(q,H){return H.map(z=>({cmd:"horizontalLineTo",args:[z]}))}(ee,T[2])),T===null&&(n=ee),T===null){if(ee=n,re=n,o.charCodeAt(n)===104?(T="h",n++):(T=null,a('"h"')),T!==null){for(K=[],j=Ne();j!==null;)K.push(j),j=Ne();K!==null?(j=F(),j!==null?T=[T,K,j]:(T=null,n=re)):(T=null,n=re)}else T=null,n=re;T!==null&&(T=function(q,H){return H.map(z=>({cmd:"horizontalLineToRelative",args:[z]}))}(ee,T[2])),T===null&&(n=ee)}return T}function F(){let T,K,j,ee,re;return ee=n,re=n,T=Qe(),T!==null?(K=We(),K=K!==null?K:"",K!==null?(j=F(),j!==null?T=[T,K,j]:(T=null,n=re)):(T=null,n=re)):(T=null,n=re),T!==null&&(T=function(q,H,z){return[H].concat(z)}(ee,T[0],T[2])),T===null&&(n=ee),T===null&&(ee=n,T=Qe(),T!==null&&(T=function(q,H){return[H]}(ee,T)),T===null&&(n=ee)),T}function G(){let T,K,j,ee,re;if(ee=n,re=n,o.charCodeAt(n)===86?(T="V",n++):(T=null,a('"V"')),T!==null){for(K=[],j=Ne();j!==null;)K.push(j),j=Ne();K!==null?(j=ie(),j!==null?T=[T,K,j]:(T=null,n=re)):(T=null,n=re)}else T=null,n=re;if(T!==null&&(T=function(q,H){return H.map(z=>({cmd:"verticalLineTo",args:[z]}))}(ee,T[2])),T===null&&(n=ee),T===null){if(ee=n,re=n,o.charCodeAt(n)===118?(T="v",n++):(T=null,a('"v"')),T!==null){for(K=[],j=Ne();j!==null;)K.push(j),j=Ne();K!==null?(j=ie(),j!==null?T=[T,K,j]:(T=null,n=re)):(T=null,n=re)}else T=null,n=re;T!==null&&(T=function(q,H){return H.map(z=>({cmd:"verticalLineToRelative",args:[z]}))}(ee,T[2])),T===null&&(n=ee)}return T}function ie(){let T,K,j,ee,re;return ee=n,re=n,T=Qe(),T!==null?(K=We(),K=K!==null?K:"",K!==null?(j=ie(),j!==null?T=[T,K,j]:(T=null,n=re)):(T=null,n=re)):(T=null,n=re),T!==null&&(T=function(q,H,z){return[H].concat(z)}(ee,T[0],T[2])),T===null&&(n=ee),T===null&&(ee=n,T=Qe(),T!==null&&(T=function(q,H){return[H]}(ee,T)),T===null&&(n=ee)),T}function Z(){let T,K,j,ee,re;if(ee=n,re=n,o.charCodeAt(n)===67?(T="C",n++):(T=null,a('"C"')),T!==null){for(K=[],j=Ne();j!==null;)K.push(j),j=Ne();K!==null?(j=W(),j!==null?T=[T,K,j]:(T=null,n=re)):(T=null,n=re)}else T=null,n=re;if(T!==null&&(T=function(q,H){return H.map(z=>({cmd:"cubicCurveTo",args:z}))}(ee,T[2])),T===null&&(n=ee),T===null){if(ee=n,re=n,o.charCodeAt(n)===99?(T="c",n++):(T=null,a('"c"')),T!==null){for(K=[],j=Ne();j!==null;)K.push(j),j=Ne();K!==null?(j=W(),j!==null?T=[T,K,j]:(T=null,n=re)):(T=null,n=re)}else T=null,n=re;T!==null&&(T=function(q,H){return H.map(z=>({cmd:"cubicCurveToRelative",args:z}))}(ee,T[2])),T===null&&(n=ee)}return T}function W(){let T,K,j,ee,re;return ee=n,re=n,T=X(),T!==null?(K=We(),K=K!==null?K:"",K!==null?(j=W(),j!==null?T=[T,K,j]:(T=null,n=re)):(T=null,n=re)):(T=null,n=re),T!==null&&(T=function(q,H,z){return[H].concat(z)}(ee,T[0],T[2])),T===null&&(n=ee),T===null&&(ee=n,T=X(),T!==null&&(T=function(q,H){return[H]}(ee,T)),T===null&&(n=ee)),T}function X(){let T,K,j,ee,re,q,H;return q=n,H=n,T=Ie(),T!==null?(K=We(),K=K!==null?K:"",K!==null?(j=Ie(),j!==null?(ee=We(),ee=ee!==null?ee:"",ee!==null?(re=Ie(),re!==null?T=[T,K,j,ee,re]:(T=null,n=H)):(T=null,n=H)):(T=null,n=H)):(T=null,n=H)):(T=null,n=H),T!==null&&(T=function(z,fe,we,Pe){return[fe.x,fe.y,we.x,we.y,Pe.x,Pe.y]}(q,T[0],T[2],T[4])),T===null&&(n=q),T}function J(){let T,K,j,ee,re;if(ee=n,re=n,o.charCodeAt(n)===83?(T="S",n++):(T=null,a('"S"')),T!==null){for(K=[],j=Ne();j!==null;)K.push(j),j=Ne();K!==null?(j=oe(),j!==null?T=[T,K,j]:(T=null,n=re)):(T=null,n=re)}else T=null,n=re;if(T!==null&&(T=function(q,H){return H.map(z=>({cmd:"smoothCubicCurveTo",args:z}))}(ee,T[2])),T===null&&(n=ee),T===null){if(ee=n,re=n,o.charCodeAt(n)===115?(T="s",n++):(T=null,a('"s"')),T!==null){for(K=[],j=Ne();j!==null;)K.push(j),j=Ne();K!==null?(j=oe(),j!==null?T=[T,K,j]:(T=null,n=re)):(T=null,n=re)}else T=null,n=re;T!==null&&(T=function(q,H){return H.map(z=>({cmd:"smoothCubicCurveToRelative",args:z}))}(ee,T[2])),T===null&&(n=ee)}return T}function oe(){let T,K,j,ee,re;return ee=n,re=n,T=le(),T!==null?(K=We(),K=K!==null?K:"",K!==null?(j=oe(),j!==null?T=[T,K,j]:(T=null,n=re)):(T=null,n=re)):(T=null,n=re),T!==null&&(T=function(q,H,z){return[H].concat(z)}(ee,T[0],T[2])),T===null&&(n=ee),T===null&&(ee=n,T=le(),T!==null&&(T=function(q,H){return[H]}(ee,T)),T===null&&(n=ee)),T}function le(){let T,K,j,ee,re;return ee=n,re=n,T=Ie(),T!==null?(K=We(),K=K!==null?K:"",K!==null?(j=Ie(),j!==null?T=[T,K,j]:(T=null,n=re)):(T=null,n=re)):(T=null,n=re),T!==null&&(T=function(q,H,z){return[H.x,H.y,z.x,z.y]}(ee,T[0],T[2])),T===null&&(n=ee),T}function pe(){let T,K,j,ee,re;if(ee=n,re=n,o.charCodeAt(n)===81?(T="Q",n++):(T=null,a('"Q"')),T!==null){for(K=[],j=Ne();j!==null;)K.push(j),j=Ne();K!==null?(j=ve(),j!==null?T=[T,K,j]:(T=null,n=re)):(T=null,n=re)}else T=null,n=re;if(T!==null&&(T=function(q,H){return H.map(z=>({cmd:"quadraticCurveTo",args:z}))}(ee,T[2])),T===null&&(n=ee),T===null){if(ee=n,re=n,o.charCodeAt(n)===113?(T="q",n++):(T=null,a('"q"')),T!==null){for(K=[],j=Ne();j!==null;)K.push(j),j=Ne();K!==null?(j=ve(),j!==null?T=[T,K,j]:(T=null,n=re)):(T=null,n=re)}else T=null,n=re;T!==null&&(T=function(q,H){return H.map(z=>({cmd:"quadraticCurveToRelative",args:z}))}(ee,T[2])),T===null&&(n=ee)}return T}function ve(){let T,K,j,ee,re;return ee=n,re=n,T=Oe(),T!==null?(K=We(),K=K!==null?K:"",K!==null?(j=ve(),j!==null?T=[T,K,j]:(T=null,n=re)):(T=null,n=re)):(T=null,n=re),T!==null&&(T=function(q,H,z){return[H].concat(z)}(ee,T[0],T[2])),T===null&&(n=ee),T===null&&(ee=n,T=Oe(),T!==null&&(T=function(q,H){return[H]}(ee,T)),T===null&&(n=ee)),T}function Oe(){let T,K,j,ee,re;return ee=n,re=n,T=Ie(),T!==null?(K=We(),K=K!==null?K:"",K!==null?(j=Ie(),j!==null?T=[T,K,j]:(T=null,n=re)):(T=null,n=re)):(T=null,n=re),T!==null&&(T=function(q,H,z){return[H.x,H.y,z.x,z.y]}(ee,T[0],T[2])),T===null&&(n=ee),T}function He(){let T,K,j,ee,re;if(ee=n,re=n,o.charCodeAt(n)===84?(T="T",n++):(T=null,a('"T"')),T!==null){for(K=[],j=Ne();j!==null;)K.push(j),j=Ne();K!==null?(j=Ue(),j!==null?T=[T,K,j]:(T=null,n=re)):(T=null,n=re)}else T=null,n=re;if(T!==null&&(T=function(q,H){return H.map(z=>({cmd:"smoothQuadraticCurveTo",args:[z.x,z.y]}))}(ee,T[2])),T===null&&(n=ee),T===null){if(ee=n,re=n,o.charCodeAt(n)===116?(T="t",n++):(T=null,a('"t"')),T!==null){for(K=[],j=Ne();j!==null;)K.push(j),j=Ne();K!==null?(j=Ue(),j!==null?T=[T,K,j]:(T=null,n=re)):(T=null,n=re)}else T=null,n=re;T!==null&&(T=function(q,H){return H.map(z=>({cmd:"smoothQuadraticCurveToRelative",args:[z.x,z.y]}))}(ee,T[2])),T===null&&(n=ee)}return T}function Ue(){let T,K,j,ee,re;return ee=n,re=n,T=Ie(),T!==null?(K=We(),K=K!==null?K:"",K!==null?(j=Ue(),j!==null?T=[T,K,j]:(T=null,n=re)):(T=null,n=re)):(T=null,n=re),T!==null&&(T=function(q,H,z){return[H].concat(z)}(ee,T[0],T[2])),T===null&&(n=ee),T===null&&(ee=n,T=Ie(),T!==null&&(T=function(q,H){return[H]}(ee,T)),T===null&&(n=ee)),T}function Le(){let T,K,j,ee,re;if(ee=n,re=n,o.charCodeAt(n)===65?(T="A",n++):(T=null,a('"A"')),T!==null){for(K=[],j=Ne();j!==null;)K.push(j),j=Ne();K!==null?(j=Ae(),j!==null?T=[T,K,j]:(T=null,n=re)):(T=null,n=re)}else T=null,n=re;if(T!==null&&(T=function(q,H){return H.map(z=>(z[2]*=Math.PI/180,{cmd:"ellipticalArcTo",args:z}))}(ee,T[2])),T===null&&(n=ee),T===null){if(ee=n,re=n,o.charCodeAt(n)===97?(T="a",n++):(T=null,a('"a"')),T!==null){for(K=[],j=Ne();j!==null;)K.push(j),j=Ne();K!==null?(j=Ae(),j!==null?T=[T,K,j]:(T=null,n=re)):(T=null,n=re)}else T=null,n=re;T!==null&&(T=function(q,H){return H.map(z=>(z[2]*=Math.PI/180,{cmd:"ellipticalArcToRelative",args:z}))}(ee,T[2])),T===null&&(n=ee)}return T}function Ae(){let T,K,j,ee,re;return ee=n,re=n,T=ae(),T!==null?(K=We(),K=K!==null?K:"",K!==null?(j=Ae(),j!==null?T=[T,K,j]:(T=null,n=re)):(T=null,n=re)):(T=null,n=re),T!==null&&(T=function(q,H,z){return[H].concat(z)}(ee,T[0],T[2])),T===null&&(n=ee),T===null&&(ee=n,T=ae(),T!==null&&(T=function(q,H){return[H]}(ee,T)),T===null&&(n=ee)),T}function ae(){let T,K,j,ee,re,q,H,z,fe,we,Pe,ke,$e;return ke=n,$e=n,T=nt(),T!==null?(K=We(),K=K!==null?K:"",K!==null?(j=nt(),j!==null?(ee=We(),ee=ee!==null?ee:"",ee!==null?(re=Qe(),re!==null?(q=We(),q!==null?(H=Be(),H!==null?(z=We(),z=z!==null?z:"",z!==null?(fe=Be(),fe!==null?(we=We(),we=we!==null?we:"",we!==null?(Pe=Ie(),Pe!==null?T=[T,K,j,ee,re,q,H,z,fe,we,Pe]:(T=null,n=$e)):(T=null,n=$e)):(T=null,n=$e)):(T=null,n=$e)):(T=null,n=$e)):(T=null,n=$e)):(T=null,n=$e)):(T=null,n=$e)):(T=null,n=$e)):(T=null,n=$e)):(T=null,n=$e),T!==null&&(T=function(lt,et,pt,St,Mt,Is,Gi){return[et,pt,St,Mt,Is,Gi.x,Gi.y]}(ke,T[0],T[2],T[4],T[6],T[8],T[10])),T===null&&(n=ke),T}function Ie(){let T,K,j,ee,re;return ee=n,re=n,T=Qe(),T!==null?(K=We(),K=K!==null?K:"",K!==null?(j=Qe(),j!==null?T=[T,K,j]:(T=null,n=re)):(T=null,n=re)):(T=null,n=re),T!==null&&(T=function(q,H,z){return{x:H,y:z}}(ee,T[0],T[2])),T===null&&(n=ee),T}function nt(){let T,K;return K=n,T=mt(),T!==null&&(T=function(j,ee){return parseFloat(ee)}(K,T)),T===null&&(n=K),T===null&&(K=n,T=vt(),T!==null&&(T=function(j,ee){return Number(ee)}(K,T)),T===null&&(n=K)),T}function Qe(){let T,K,j,ee;return j=n,ee=n,T=wt(),T=T!==null?T:"",T!==null?(K=mt(),K!==null?T=[T,K]:(T=null,n=ee)):(T=null,n=ee),T!==null&&(T=function(re,q,H){return parseFloat(q+H)}(j,T[0],T[1])),T===null&&(n=j),T===null&&(j=n,ee=n,T=wt(),T=T!==null?T:"",T!==null?(K=vt(),K!==null?T=[T,K]:(T=null,n=ee)):(T=null,n=ee),T!==null&&(T=function(re,q,H){return Number(q+H)}(j,T[0],T[1])),T===null&&(n=j)),T}function Be(){let T,K;return K=n,o.charCodeAt(n)===48?(T="0",n++):(T=null,a('"0"')),T!==null&&(T=function(j){return!1}()),T===null&&(n=K),T===null&&(K=n,o.charCodeAt(n)===49?(T="1",n++):(T=null,a('"1"')),T!==null&&(T=function(j){return!0}()),T===null&&(n=K)),T}function We(){let T,K,j,ee,re;if(re=n,K=Ne(),K!==null)for(T=[];K!==null;)T.push(K),K=Ne();else T=null;if(T!==null)if(K=ft(),K=K!==null?K:"",K!==null){for(j=[],ee=Ne();ee!==null;)j.push(ee),ee=Ne();j!==null?T=[T,K,j]:(T=null,n=re)}else T=null,n=re;else T=null,n=re;if(T===null)if(re=n,T=ft(),T!==null){for(K=[],j=Ne();j!==null;)K.push(j),j=Ne();K!==null?T=[T,K]:(T=null,n=re)}else T=null,n=re;return T}function ft(){let T;return o.charCodeAt(n)===44?(T=",",n++):(T=null,a('","')),T}function mt(){let T,K,j,ee;return j=n,ee=n,T=bt(),T!==null?(K=Et(),K=K!==null?K:"",K!==null?T=[T,K]:(T=null,n=ee)):(T=null,n=ee),T!==null&&(T=function(re,q,H){return q+H}(j,T[0],T[1])),T===null&&(n=j),T===null&&(j=n,ee=n,T=vt(),T!==null?(K=Et(),K!==null?T=[T,K]:(T=null,n=ee)):(T=null,n=ee),T!==null&&(T=function(re,q,H){return q+H}(j,T[0],T[1])),T===null&&(n=j)),T}function bt(){let T,K,j,ee,re;return ee=n,re=n,T=vt(),T=T!==null?T:"",T!==null?(o.charCodeAt(n)===46?(K=".",n++):(K=null,a('"."')),K!==null?(j=vt(),j!==null?T=[T,K,j]:(T=null,n=re)):(T=null,n=re)):(T=null,n=re),T!==null&&(T=function(q,H,z){return H+"."+z}(ee,T[0],T[2])),T===null&&(n=ee),T===null&&(ee=n,re=n,T=vt(),T!==null?(o.charCodeAt(n)===46?(K=".",n++):(K=null,a('"."')),K!==null?T=[T,K]:(T=null,n=re)):(T=null,n=re),T!==null&&(T=function(q,H){return H}(ee,T[0])),T===null&&(n=ee)),T}function Et(){let T,K,j,ee,re;return ee=n,re=n,o.charCodeAt(n)===101?(T="e",n++):(T=null,a('"e"')),T===null&&(o.charCodeAt(n)===69?(T="E",n++):(T=null,a('"E"'))),T!==null?(K=wt(),K=K!==null?K:"",K!==null?(j=vt(),j!==null?T=[T,K,j]:(T=null,n=re)):(T=null,n=re)):(T=null,n=re),T!==null&&(T=function(q,H,z,fe){return H+z+fe}(ee,T[0],T[1],T[2])),T===null&&(n=ee),T}function wt(){let T;return o.charCodeAt(n)===43?(T="+",n++):(T=null,a('"+"')),T===null&&(o.charCodeAt(n)===45?(T="-",n++):(T=null,a('"-"'))),T}function vt(){let T,K,j,ee;return j=n,ee=n,T=Ut(),T!==null?(K=vt(),K!==null?T=[T,K]:(T=null,n=ee)):(T=null,n=ee),T!==null&&(T=function(re,q,H){return q+H}(j,T[0],T[1])),T===null&&(n=j),T===null&&(T=Ut()),T}function Ut(){let T;return/^[0-9]/.test(o.charAt(n))?(T=o.charAt(n),n++):(T=null,a("[0-9]")),T}function Ne(){let T;return o.charCodeAt(n)===32?(T=" ",n++):(T=null,a('" "')),T===null&&(o.charCodeAt(n)===9?(T="	",n++):(T=null,a('"\\t"')),T===null&&(o.charCodeAt(n)===13?(T="\r",n++):(T=null,a('"\\r"')),T===null&&(o.charCodeAt(n)===10?(T=`
`,n++):(T=null,a('"\\n"'))))),T}function Pi(T){T.sort();let K=null;const j=[];for(let ee=0;ee<T.length;ee++)T[ee]!==K&&(j.push(T[ee]),K=T[ee]);return j}function $t(){let T=1,K=1,j=!1;for(let ee=0;ee<Math.max(n,r);ee++){const re=o.charAt(ee);re===`
`?(j||T++,K=1,j=!1):re==="\r"||re==="\u2028"||re==="\u2029"?(T++,K=1,j=!0):(K++,j=!1)}return{line:T,column:K}}function Ft(T,K){const j=[{cmd:K?"moveToRelative":"moveTo",args:[T[0].x,T[0].y]}];if(T.length>1)for(let ee=1;ee<T.length;ee++)j.push({cmd:K?"lineToRelative":"lineTo",args:[T[ee].x,T[ee].y]});return j}const $i=t[e]();if($i===null||n!==o.length){const T=Math.max(n,r),K=T<o.length?o.charAt(T):null,j=$t();throw new this.SyntaxError(Pi(s),K,T,j.line,j.column)}return $i},toSource:function(){return this._source}};result.SyntaxError=function(o,e,t,n,r){function s(a,h){let c,d;switch(a.length){case 0:c="end of input";break;case 1:c=a[0];break;default:c=a.slice(0,a.length-1).join(", ")+" or "+a[a.length-1]}return d=h?quote(h):"end of input","Expected "+c+" but "+d+" found."}this.name="SyntaxError",this.expected=o,this.found=e,this.message=s(o,e),this.offset=t,this.line=n,this.column=r};result.SyntaxError.prototype=Error.prototype;kite.register("svgPath",result);const svgPath=kite.svgPath;class Segment{constructor(){this.invalidationEmitter=new TinyEmitter}areStrokedBoundsDilated(){return Math.abs(this.startTangent.x*this.startTangent.y)<1e-7&&Math.abs(this.endTangent.x*this.endTangent.y)<1e-7}getBoundsWithTransform(e){return this.transformed(e).getBounds()}slice(e,t){assert&&assert(e>=0&&e<=1&&t>=0&&t<=1,"Parametric value out of range"),assert&&assert(e<t);let n=this;return t<1&&(n=n.subdivided(t)[0]),e>0&&(n=n.subdivided(DotUtils.linear(0,t,0,1,e))[1]),n}subdivisions(e){let t=this;const n=[];for(let r=0;r<e.length;r++){const s=e[r],a=t.subdivided(s);assert&&assert(a.length===2),n.push(a[0]),t=a[1];for(let h=r+1;h<e.length;h++)e[h]=DotUtils.linear(s,1,0,1,e[h])}return n.push(t),n}subdividedIntoMonotone(){return this.subdivisions(this.getInteriorExtremaTs())}isSufficientlyFlat(e,t){const n=this.start,r=this.positionAt(.5),s=this.end;return Segment.isSufficientlyFlat(e,t,n,r,s)}getArcLength(e,t,n){if(e=e===void 0?1e-10:e,t=t===void 0?1e-8:t,n=n===void 0?15:n,n<=0||this.isSufficientlyFlat(e,t))return this.start.distance(this.end);{const r=this.subdivided(.5);return r[0].getArcLength(e,t,n-1)+r[1].getArcLength(e,t,n-1)}}getDashValues(e,t,n,r){assert&&assert(e.length>0,"Do not call with an empty dash array");const s=this,a=[];let h=0;const c=_.sum(e);t=t%c,t<0&&(t+=c);let d=0,y=0,g=!0;function D(){d=(d+1)%e.length,g=!g}for(;t>0;)t>=e[d]?(t-=e[d],D()):(y=t,t=0);const O=g;return function V(k,M,N,F,G){const ie=(k+M)/2,Z=s.positionAt(ie);if(G>14||Segment.isSufficientlyFlat(n,r,N,Z,F)){const W=N.distance(Z)+Z.distance(F);h+=W;let X=W;for(;y+X>=e[d];){const J=DotUtils.linear(0,W,k,M,W-X+e[d]-y);a.push(J),X-=e[d]-y,y=0,D()}y=y+X}else V(k,ie,N,Z,G+1),V(ie,M,Z,F,G+1)}(0,1,this.start,this.end,0),{values:a,arcLength:h,initiallyInside:O}}toPiecewiseLinearSegments(e,t,n,r,s,a){t=t===void 0?e.minLevels:t,n=n===void 0?e.maxLevels:n,r=r||[];const h=e.pointMap||_.identity;s=s||h(this.start),a=a||h(this.end);const c=h(this.positionAt(.5));assert&&assert(t<=n),assert&&assert(e.distanceEpsilon===null||typeof e.distanceEpsilon=="number"),assert&&assert(e.curveEpsilon===null||typeof e.curveEpsilon=="number"),assert&&assert(!h||typeof h=="function");let d=n===0;if(!d&&t<=0&&(d=this.isSufficientlyFlat(e.distanceEpsilon===null||e.distanceEpsilon===void 0?Number.POSITIVE_INFINITY:e.distanceEpsilon,e.curveEpsilon===null||e.curveEpsilon===void 0?Number.POSITIVE_INFINITY:e.curveEpsilon)),d)r.push(new Line$1(s,a));else{const y=this.subdivided(.5);y[0].toPiecewiseLinearSegments(e,t-1,n-1,r,s,c),y[1].toPiecewiseLinearSegments(e,t-1,n-1,r,c,a)}return r}toPiecewiseLinearOrArcSegments(e){const t=optionize()({minLevels:2,maxLevels:7,curvatureThreshold:.02,errorThreshold:10,errorPoints:[.25,.75]},e),n=[];return this.toPiecewiseLinearOrArcRecursion(t,t.minLevels,t.maxLevels,n,0,1,this.positionAt(0),this.positionAt(1),this.curvatureAt(0),this.curvatureAt(1)),n}toPiecewiseLinearOrArcRecursion(e,t,n,r,s,a,h,c,d,y){const g=(s+a)/2,D=this.positionAt(g),O=this.curvatureAt(g);if(n<=0||t<=0&&Math.abs(d-O)+Math.abs(O-y)<e.curvatureThreshold*2){const V=Arc.createFromPoints(h,D,c);let k=!1;if(V instanceof Arc){const M=V.radius*V.radius;for(let N=0;N<e.errorPoints.length;N++){const F=e.errorPoints[N],G=this.positionAt(s*(1-F)+a*F);if(Math.abs(G.distanceSquared(V.center)-M)>e.errorThreshold){k=!0;break}}}if(!k){r.push(V);return}}this.toPiecewiseLinearOrArcRecursion(e,t-1,n-1,r,s,g,h,D,d,O),this.toPiecewiseLinearOrArcRecursion(e,t-1,n-1,r,g,a,D,c,O,y)}toShape(){return new Shape$1([new Subpath$1([this])])}getClosestPoints(e){return Segment.closestToPoint([this],e,1e-7)}static closestToPoint(e,t,n){const r=n*n;let s=[],a=[],h=Number.POSITIVE_INFINITY,c=!1;for(_.each(e,d=>{if(d instanceof Line$1){const y=d.explicitClosestToPoint(t);_.each(y,g=>{g.distanceSquared<h?(a=[g],h=g.distanceSquared):g.distanceSquared===h&&a.push(g)})}else{const y=[0].concat(d.getInteriorExtremaTs()).concat([1]);for(let g=0;g<y.length-1;g++){const D=y[g],O=y[g+1],V=d.positionAt(D),k=d.positionAt(O),M=Bounds2.point(V).addPoint(k),N=M.minimumDistanceToPointSquared(t);if(N<=h){const F=M.maximumDistanceToPointSquared(t);F<h&&(h=F,a=[]),s.push({ta:D,tb:O,pa:V,pb:k,segment:d,bounds:M,min:N,max:F})}}}});s.length&&!c;){const d=s;s=[],c=!0;for(const y of d){if(y.min>h)continue;c&&y.pa.distanceSquared(y.pb)>r&&(c=!1);const g=(y.ta+y.tb)/2,D=y.segment.positionAt(g),O=Bounds2.point(y.pa).addPoint(D),V=Bounds2.point(y.pb).addPoint(D),k=O.minimumDistanceToPointSquared(t),M=V.minimumDistanceToPointSquared(t);if(k<=h){const N=O.maximumDistanceToPointSquared(t);N<h&&(h=N,a=[]),s.push({ta:y.ta,tb:g,pa:y.pa,pb:D,segment:y.segment,bounds:O,min:k,max:N})}if(M<=h){const N=V.maximumDistanceToPointSquared(t);N<h&&(h=N,a=[]),s.push({ta:g,tb:y.tb,pa:D,pb:y.pb,segment:y.segment,bounds:V,min:M,max:N})}}}return _.each(s,d=>{const y=(d.ta+d.tb)/2,g=d.segment.positionAt(y);a.push({segment:d.segment,t:y,closestPoint:g,distanceSquared:t.distanceSquared(g)})}),a}static polynomialGetOverlapCubic(e,t,n,r,s,a,h,c){if(c===0)return Segment.polynomialGetOverlapQuadratic(e,t,n,s,a,h);const d=Math.sign(r/c)*Math.pow(Math.abs(r/c),1/3);if(d===0)return null;const y=(n-d*d*h)/(3*d*d*c);return{a:d,b:y}}static polynomialGetOverlapQuadratic(e,t,n,r,s,a){if(a===0)return Segment.polynomialGetOverlapLinear(e,t,r,s);if(n/a<0)return null;const c=Math.sqrt(n/a);if(c===0)return null;const d=(t-c*s)/(2*c*a);return{a:c,b:d}}static polynomialGetOverlapLinear(e,t,n,r){if(r===0)return e===n?!0:null;const s=t/r;if(s===0)return null;const a=(e-n)/r;return{a:s,b:a}}static intersect(e,t){if(Line$1&&e instanceof Line$1&&t instanceof Line$1)return Line$1.intersect(e,t);if(Line$1&&e instanceof Line$1)return Line$1.intersectOther(e,t);if(Line$1&&t instanceof Line$1)return Line$1.intersectOther(t,e).map(swapSegmentIntersection);if(Arc&&e instanceof Arc&&t instanceof Arc)return Arc.intersect(e,t);if(EllipticalArc&&e instanceof EllipticalArc&&t instanceof EllipticalArc)return EllipticalArc.intersect(e,t);if(Quadratic&&Cubic&&(e instanceof Quadratic||e instanceof Cubic)&&(t instanceof Quadratic||t instanceof Cubic)){const n=e instanceof Cubic?e:e.degreeElevated(),r=t instanceof Cubic?t:t.degreeElevated(),s=new paper.Curve(n.start.x,n.start.y,n.control1.x,n.control1.y,n.control2.x,n.control2.y,n.end.x,n.end.y),a=new paper.Curve(r.start.x,r.start.y,r.control1.x,r.control1.y,r.control2.x,r.control2.y,r.end.x,r.end.y);return s.getIntersections(a).map(c=>{const d=new Vector2(c.point.x,c.point.y);return new SegmentIntersection(d,c.time,c.intersection.time)})}else return BoundsIntersection.intersect(e,t)}static deserialize(e){return assert&&assert(e.type&&kite[e.type]&&kite[e.type].deserialize),kite[e.type].deserialize(e)}static isSufficientlyFlat(e,t,n,r,s){return!(DotUtils.distToSegmentSquared(r,n,s)/n.distanceSquared(s)>t||DotUtils.distToSegmentSquared(r,n,s)>e)}static filterClosestToPointResult(e){if(e.length===0)return[];const t=_.minBy(e,n=>n.distanceSquared).distanceSquared;return _.uniqWith(e.filter(n=>Math.abs(n.distanceSquared-t)<1e-11),(n,r)=>n.closestPoint.distanceSquared(r.closestPoint)<1e-11)}}kite.register("Segment",Segment);function swapSegmentIntersection(o){return o.getSwapped()}const scratchVector2$1=new Vector2(0,0);let Line$1=class Yt extends Segment{constructor(e,t){super(),this._start=e,this._end=t,this.invalidate()}setStart(e){return assert&&assert(e.isFinite(),`Line start should be finite: ${e.toString()}`),this._start.equals(e)||(this._start=e,this.invalidate()),this}set start(e){this.setStart(e)}get start(){return this.getStart()}getStart(){return this._start}setEnd(e){return assert&&assert(e.isFinite(),`Line end should be finite: ${e.toString()}`),this._end.equals(e)||(this._end=e,this.invalidate()),this}set end(e){this.setEnd(e)}get end(){return this.getEnd()}getEnd(){return this._end}positionAt(e){return assert&&assert(e>=0,"positionAt t should be non-negative"),assert&&assert(e<=1,"positionAt t should be no greater than 1"),this._start.plus(this._end.minus(this._start).times(e))}tangentAt(e){return assert&&assert(e>=0,"tangentAt t should be non-negative"),assert&&assert(e<=1,"tangentAt t should be no greater than 1"),this.getStartTangent()}curvatureAt(e){return assert&&assert(e>=0,"curvatureAt t should be non-negative"),assert&&assert(e<=1,"curvatureAt t should be no greater than 1"),0}subdivided(e){if(assert&&assert(e>=0,"subdivided t should be non-negative"),assert&&assert(e<=1,"subdivided t should be no greater than 1"),e===0||e===1)return[this];const t=this.positionAt(e);return[new Yt(this._start,t),new Yt(t,this._end)]}invalidate(){assert&&assert(this._start instanceof Vector2,`Line start should be a Vector2: ${this._start}`),assert&&assert(this._start.isFinite(),`Line start should be finite: ${this._start.toString()}`),assert&&assert(this._end instanceof Vector2,`Line end should be a Vector2: ${this._end}`),assert&&assert(this._end.isFinite(),`Line end should be finite: ${this._end.toString()}`),this._tangent=null,this._bounds=null,this._svgPathFragment=null,this.invalidationEmitter.emit()}getStartTangent(){return this._tangent===null&&(this._tangent=this._end.minus(this._start).normalized()),this._tangent}get startTangent(){return this.getStartTangent()}getEndTangent(){return this.getStartTangent()}get endTangent(){return this.getEndTangent()}getBounds(){return this._bounds===null&&(this._bounds=Bounds2.NOTHING.copy().addPoint(this._start).addPoint(this._end)),this._bounds}get bounds(){return this.getBounds()}getBoundsWithTransform(e){const t=Bounds2.NOTHING.copy();return t.addPoint(e.multiplyVector2(scratchVector2$1.set(this._start))),t.addPoint(e.multiplyVector2(scratchVector2$1.set(this._end))),t}getNondegenerateSegments(){return this._start.equals(this._end)?[]:[this]}getSVGPathFragment(){let e;return assert&&(e=this._svgPathFragment,this._svgPathFragment=null),this._svgPathFragment||(this._svgPathFragment=`L ${svgNumber(this._end.x)} ${svgNumber(this._end.y)}`),assert&&e&&assert(e===this._svgPathFragment,"Quadratic line segment changed without invalidate()"),this._svgPathFragment}strokeLeft(e){const t=this.getEndTangent().perpendicular.negated().times(e/2);return[new Yt(this._start.plus(t),this._end.plus(t))]}strokeRight(e){const t=this.getStartTangent().perpendicular.times(e/2);return[new Yt(this._end.plus(t),this._start.plus(t))]}getInteriorExtremaTs(){return[]}intersection(e){const t=[],n=this._start,s=this._end.minus(n);if(s.magnitudeSquared===0)return t;const a=e.direction.y*s.x-e.direction.x*s.y;if(a===0)return t;const h=(e.direction.x*(n.y-e.position.y)-e.direction.y*(n.x-e.position.x))/a;if(h<0||h>=1)return t;const c=(s.x*(n.y-e.position.y)-s.y*(n.x-e.position.x))/a;if(c<1e-8)return t;const d=s.perpendicular,y=n.plus(s.times(h)),g=(d.dot(e.direction)>0?d.negated():d).normalized(),D=e.direction.perpendicular.dot(s)<0?1:-1;return t.push(new RayIntersection(c,y,g,D,h)),t}windingIntersection(e){const t=this.intersection(e);return t.length?t[0].wind:0}writeToContext(e){e.lineTo(this._end.x,this._end.y)}transformed(e){return new Yt(e.timesVector2(this._start),e.timesVector2(this._end))}explicitClosestToPoint(e){const t=this._end.minus(this._start);let n=e.minus(this._start).dot(t)/t.magnitudeSquared;n=DotUtils.clamp(n,0,1);const r=this.positionAt(n);return[{segment:this,t:n,closestPoint:r,distanceSquared:e.distanceSquared(r)}]}getSignedAreaFragment(){return 1/2*(this._start.x*this._end.y-this._start.y*this._end.x)}reparameterized(e,t){return new Yt(this.positionAt(t),this.positionAt(e+t))}reversed(){return new Yt(this._end,this._start)}polarToCartesian(e){return this._start.x===this._end.x?[new Yt(Vector2.createPolar(this._start.y,this._start.x),Vector2.createPolar(this._end.y,this._end.x))]:this._start.y===this._end.y?[new Arc(Vector2.ZERO,this._start.y,this._start.x,this._end.x,this._start.x>this._end.x)]:this.toPiecewiseLinearSegments(e)}getArcLength(){return this.start.distance(this.end)}toPiecewiseLinearOrArcSegments(){return[this]}serialize(){return{type:"Line",startX:this._start.x,startY:this._start.y,endX:this._end.x,endY:this._end.y}}getOverlaps(e,t=1e-6){return e instanceof Yt?Yt.getOverlaps(this,e):null}getClosestPoints(e){const t=this._end.minus(this._start),n=t.normalized(),r=e.minus(this._start).dot(n),s=DotUtils.clamp(r/t.magnitude,0,1),a=this.positionAt(s);return[{segment:this,t:s,closestPoint:a,distanceSquared:a.distanceSquared(e)}]}static deserialize(e){return assert&&assert(e.type==="Line"),new Yt(new Vector2(e.startX,e.startY),new Vector2(e.endX,e.endY))}static getOverlaps(e,t,n=1e-6){const r=[],s=e._start.x,a=-1*e._start.x+e._end.x,h=e._start.y,c=-1*e._start.y+e._end.y,d=t._start.x,y=-1*t._start.x+t._end.x,g=t._start.y,D=-1*t._start.y+t._end.y,O=Math.abs(Math.max(e._start.x,e._end.x,t._start.x,t._end.x)-Math.min(e._start.x,e._end.x,t._start.x,t._end.x)),V=Math.abs(Math.max(e._start.y,e._end.y,t._start.y,t._end.y)-Math.min(e._start.y,e._end.y,t._start.y,t._end.y)),k=Segment.polynomialGetOverlapLinear(s,a,d,y),M=Segment.polynomialGetOverlapLinear(h,c,g,D);let N;if(O>V?N=k===null||k===!0?M:k:N=M===null||M===!0?k:M,N===null||N===!0)return r;const F=N.a,G=N.b,ie=d+G*y-s,Z=F*y-a,W=g+G*D-h,X=F*D-c;if(Math.abs(ie)>n||Math.abs(Z+ie)>n||Math.abs(W)>n||Math.abs(X+W)>n)return r;const J=G,oe=F+G;return J>1&&oe>1||J<0&&oe<0?r:[new Overlap(F,G)]}static intersect(e,t){const n=DotUtils.lineSegmentIntersection(e.start.x,e.start.y,e.end.x,e.end.y,t.start.x,t.start.y,t.end.x,t.end.y);if(n!==null){const r=e.explicitClosestToPoint(n)[0].t,s=t.explicitClosestToPoint(n)[0].t;return[new SegmentIntersection(n,r,s)]}else return[]}static intersectOther(e,t){const n=e.end.minus(e.start),r=n.magnitude,s=new Ray2(e.start,n.normalize()),a=t.intersection(s),h=[];for(let c=0;c<a.length;c++){const d=a[c],y=d.distance/r;y>1e-8&&y<1-1e-8&&h.push(new SegmentIntersection(d.point,y,d.t))}return h}};kite.register("Line",Line$1);const solveQuadraticRootsReal$1=DotUtils.solveQuadraticRootsReal,arePointsCollinear$1=DotUtils.arePointsCollinear;function isBetween0And1$1(o){return o>=0&&o<=1}class Quadratic extends Segment{constructor(e,t,n){super(),this._start=e,this._control=t,this._end=n,this.invalidate()}setStart(e){return assert&&assert(e.isFinite(),`Quadratic start should be finite: ${e.toString()}`),this._start.equals(e)||(this._start=e,this.invalidate()),this}set start(e){this.setStart(e)}get start(){return this.getStart()}getStart(){return this._start}setControl(e){return assert&&assert(e.isFinite(),`Quadratic control should be finite: ${e.toString()}`),this._control.equals(e)||(this._control=e,this.invalidate()),this}set control(e){this.setControl(e)}get control(){return this.getControl()}getControl(){return this._control}setEnd(e){return assert&&assert(e.isFinite(),`Quadratic end should be finite: ${e.toString()}`),this._end.equals(e)||(this._end=e,this.invalidate()),this}set end(e){this.setEnd(e)}get end(){return this.getEnd()}getEnd(){return this._end}positionAt(e){assert&&assert(e>=0,"positionAt t should be non-negative"),assert&&assert(e<=1,"positionAt t should be no greater than 1");const t=1-e;return this._start.times(t*t).plus(this._control.times(2*t*e)).plus(this._end.times(e*e))}tangentAt(e){return assert&&assert(e>=0,"tangentAt t should be non-negative"),assert&&assert(e<=1,"tangentAt t should be no greater than 1"),this._control.minus(this._start).times(2*(1-e)).plus(this._end.minus(this._control).times(2*e))}curvatureAt(e){if(assert&&assert(e>=0,"curvatureAt t should be non-negative"),assert&&assert(e<=1,"curvatureAt t should be no greater than 1"),Math.abs(e-.5)>.5-1e-7){const n=e<.5,r=n?this._start:this._end,s=this._control,a=n?this._end:this._start,h=s.minus(r),c=h.magnitude;return(n?-1:1)*h.perpendicular.normalized().dot(a.minus(s))*(this.degree-1)/(this.degree*c*c)}else return this.subdivided(e)[0].curvatureAt(1)}subdivided(e){if(assert&&assert(e>=0,"subdivided t should be non-negative"),assert&&assert(e<=1,"subdivided t should be no greater than 1"),e===0||e===1)return[this];const t=this._start.blend(this._control,e),n=this._control.blend(this._end,e),r=t.blend(n,e);return[new Quadratic(this._start,t,r),new Quadratic(r,n,this._end)]}invalidate(){assert&&assert(this._start instanceof Vector2,`Quadratic start should be a Vector2: ${this._start}`),assert&&assert(this._start.isFinite(),`Quadratic start should be finite: ${this._start.toString()}`),assert&&assert(this._control instanceof Vector2,`Quadratic control should be a Vector2: ${this._control}`),assert&&assert(this._control.isFinite(),`Quadratic control should be finite: ${this._control.toString()}`),assert&&assert(this._end instanceof Vector2,`Quadratic end should be a Vector2: ${this._end}`),assert&&assert(this._end.isFinite(),`Quadratic end should be finite: ${this._end.toString()}`),this._startTangent=null,this._endTangent=null,this._tCriticalX=null,this._tCriticalY=null,this._bounds=null,this._svgPathFragment=null,this.invalidationEmitter.emit()}getStartTangent(){if(this._startTangent===null){const e=this._start.equals(this._control);this._startTangent=e?this._end.minus(this._start).normalized():this._control.minus(this._start).normalized()}return this._startTangent}get startTangent(){return this.getStartTangent()}getEndTangent(){if(this._endTangent===null){const e=this._end.equals(this._control);this._endTangent=e?this._end.minus(this._start).normalized():this._end.minus(this._control).normalized()}return this._endTangent}get endTangent(){return this.getEndTangent()}getTCriticalX(){return this._tCriticalX===null&&(this._tCriticalX=Quadratic.extremaT(this._start.x,this._control.x,this._end.x)),this._tCriticalX}get tCriticalX(){return this.getTCriticalX()}getTCriticalY(){return this._tCriticalY===null&&(this._tCriticalY=Quadratic.extremaT(this._start.y,this._control.y,this._end.y)),this._tCriticalY}get tCriticalY(){return this.getTCriticalY()}getNondegenerateSegments(){const e=this._start,t=this._control,n=this._end,r=e.equals(n),s=e.equals(t),a=e.equals(t);if(r&&s)return[];if(r){const h=this.positionAt(.5);return[new Line$1(e,h),new Line$1(h,n)]}else if(arePointsCollinear$1(e,t,n)){if(s||a)return[new Line$1(e,n)];const h=n.minus(e),c=t.minus(e).dot(h.normalized())/h.magnitude,d=Quadratic.extremaT(0,c,1);if(!isNaN(d)&&d>0&&d<1){const y=this.positionAt(d);return _.flatten([new Line$1(e,y).getNondegenerateSegments(),new Line$1(y,n).getNondegenerateSegments()])}else return[new Line$1(e,n)]}else return[this]}getBounds(){if(this._bounds===null){this._bounds=new Bounds2(Math.min(this._start.x,this._end.x),Math.min(this._start.y,this._end.y),Math.max(this._start.x,this._end.x),Math.max(this._start.y,this._end.y));const e=this.getTCriticalX(),t=this.getTCriticalY();!isNaN(e)&&e>0&&e<1&&(this._bounds=this._bounds.withPoint(this.positionAt(e))),!isNaN(t)&&t>0&&t<1&&(this._bounds=this._bounds.withPoint(this.positionAt(t)))}return this._bounds}get bounds(){return this.getBounds()}offsetTo(e,t){let n=[this];const r=5;for(let a=0;a<r;a++)n=_.flatten(_.map(n,h=>h.subdivided(.5)));let s=_.map(n,a=>a.approximateOffset(e));return t&&(s.reverse(),s=_.map(s,a=>a.reversed())),s}degreeElevated(){return new Cubic(this._start,this._start.plus(this._control.timesScalar(2)).dividedScalar(3),this._end.plus(this._control.timesScalar(2)).dividedScalar(3),this._end)}approximateOffset(e){return new Quadratic(this._start.plus((this._start.equals(this._control)?this._end.minus(this._start):this._control.minus(this._start)).perpendicular.normalized().times(e)),this._control.plus(this._end.minus(this._start).perpendicular.normalized().times(e)),this._end.plus((this._end.equals(this._control)?this._end.minus(this._start):this._end.minus(this._control)).perpendicular.normalized().times(e)))}getSVGPathFragment(){let e;return assert&&(e=this._svgPathFragment,this._svgPathFragment=null),this._svgPathFragment||(this._svgPathFragment=`Q ${svgNumber(this._control.x)} ${svgNumber(this._control.y)} ${svgNumber(this._end.x)} ${svgNumber(this._end.y)}`),assert&&e&&assert(e===this._svgPathFragment,"Quadratic line segment changed without invalidate()"),this._svgPathFragment}strokeLeft(e){return this.offsetTo(-e/2,!1)}strokeRight(e){return this.offsetTo(e/2,!0)}getInteriorExtremaTs(){const e=[],n=this.getTCriticalX(),r=this.getTCriticalY();return!isNaN(n)&&n>1e-10&&n<1-1e-10&&e.push(this.tCriticalX),!isNaN(r)&&r>1e-10&&r<1-1e-10&&e.push(this.tCriticalY),e.sort()}intersection(e){const t=[],n=Matrix3.rotation2(-e.direction.angle).timesMatrix(Matrix3.translation(-e.position.x,-e.position.y)),r=n.timesVector2(this._start),s=n.timesVector2(this._control),a=n.timesVector2(this._end),h=r.y-2*s.y+a.y,c=-2*r.y+2*s.y,d=r.y,y=solveQuadraticRootsReal$1(h,c,d);return _.each(y,g=>{if(g>=0&&g<=1){const D=this.positionAt(g),O=this.tangentAt(g).normalized(),V=O.perpendicular,k=D.minus(e.position);if(k.dot(e.direction)>0){const M=V.dot(e.direction)>0?V.negated():V,N=e.direction.perpendicular.dot(O)<0?1:-1;t.push(new RayIntersection(k.magnitude,D,M,N,g))}}}),t}windingIntersection(e){let t=0;const n=this.intersection(e);return _.each(n,r=>{t+=r.wind}),t}writeToContext(e){e.quadraticCurveTo(this._control.x,this._control.y,this._end.x,this._end.y)}transformed(e){return new Quadratic(e.timesVector2(this._start),e.timesVector2(this._control),e.timesVector2(this._end))}getSignedAreaFragment(){return 1/6*(this._start.x*(2*this._control.y+this._end.y)+this._control.x*(-2*this._start.y+2*this._end.y)+this._end.x*(-this._start.y-2*this._control.y))}reparameterized(e,t){const n=this._start.plus(this._end.plus(this._control.timesScalar(-2))),r=this._control.minus(this._start).timesScalar(2),s=this._start,a=n.timesScalar(e*e),h=n.timesScalar(e*t).timesScalar(2).plus(r.timesScalar(e)),c=n.timesScalar(t*t).plus(r.timesScalar(t)).plus(s);return new Quadratic(c,h.timesScalar(.5).plus(c),a.plus(h).plus(c))}reversed(){return new Quadratic(this._end,this._control,this._start)}serialize(){return{type:"Quadratic",startX:this._start.x,startY:this._start.y,controlX:this._control.x,controlY:this._control.y,endX:this._end.x,endY:this._end.y}}getOverlaps(e,t=1e-6){return e instanceof Quadratic?Quadratic.getOverlaps(this,e):null}static deserialize(e){return assert&&assert(e.type==="Quadratic"),new Quadratic(new Vector2(e.startX,e.startY),new Vector2(e.controlX,e.controlY),new Vector2(e.endX,e.endY))}static extremaT(e,t,n){const r=2*(n-2*t+e);return r!==0?-2*(t-e)/r:NaN}static getOverlaps(e,t,n=1e-6){const r=[],s=e._start.x,a=-2*e._start.x+2*e._control.x,h=e._start.x-2*e._control.x+e._end.x,c=e._start.y,d=-2*e._start.y+2*e._control.y,y=e._start.y-2*e._control.y+e._end.y,g=t._start.x,D=-2*t._start.x+2*t._control.x,O=t._start.x-2*t._control.x+t._end.x,V=t._start.y,k=-2*t._start.y+2*t._control.y,M=t._start.y-2*t._control.y+t._end.y,N=Math.abs(Math.max(e._start.x,e._control.x,e._end.x,t._start.x,t._control.x,t._end.x)-Math.min(e._start.x,e._control.x,e._end.x,t._start.x,t._control.x,t._end.x)),F=Math.abs(Math.max(e._start.y,e._control.y,e._end.y,t._start.y,t._control.y,t._end.y)-Math.min(e._start.y,e._control.y,e._end.y,t._start.y,t._control.y,t._end.y)),G=Segment.polynomialGetOverlapQuadratic(s,a,h,g,D,O),ie=Segment.polynomialGetOverlapQuadratic(c,d,y,V,k,M);let Z;if(N>F?Z=G===null||G===!0?ie:G:Z=ie===null||ie===!0?G:ie,Z===null||Z===!0)return r;const W=Z.a,X=Z.b,J=W*W,oe=X*X,le=2*W*X,pe=g+X*D+oe*O-s,ve=W*D+le*O-a,Oe=J*O-h,He=V+X*k+oe*M-c,Ue=W*k+le*M-d,Le=J*M-y,Ae=DotUtils.solveLinearRootsReal(2*Oe,ve),ae=DotUtils.solveLinearRootsReal(2*Le,Ue),Ie=_.uniq([0,1].concat(Ae?Ae.filter(isBetween0And1$1):[])),nt=_.uniq([0,1].concat(ae?ae.filter(isBetween0And1$1):[]));for(let We=0;We<Ie.length;We++){const ft=Ie[We];if(Math.abs((Oe*ft+ve)*ft+pe)>n)return r}for(let We=0;We<nt.length;We++){const ft=nt[We];if(Math.abs((Le*ft+Ue)*ft+He)>n)return r}const Qe=X,Be=W+X;return Qe>1&&Be>1||Qe<0&&Be<0?r:[new Overlap(W,X)]}}Quadratic.prototype.degree=2;kite.register("Quadratic",Quadratic);const solveQuadraticRootsReal=DotUtils.solveQuadraticRootsReal,solveCubicRootsReal=DotUtils.solveCubicRootsReal,arePointsCollinear=DotUtils.arePointsCollinear,scratchVector1=new Vector2(0,0),scratchVector2=new Vector2(0,0),scratchVector3=new Vector2(0,0);function isBetween0And1(o){return o>=0&&o<=1}class Cubic extends Segment{constructor(e,t,n,r){super(),this._start=e,this._control1=t,this._control2=n,this._end=r,this.invalidate()}setStart(e){return assert&&assert(e.isFinite(),`Cubic start should be finite: ${e.toString()}`),this._start.equals(e)||(this._start=e,this.invalidate()),this}set start(e){this.setStart(e)}get start(){return this.getStart()}getStart(){return this._start}setControl1(e){return assert&&assert(e.isFinite(),`Cubic control1 should be finite: ${e.toString()}`),this._control1.equals(e)||(this._control1=e,this.invalidate()),this}set control1(e){this.setControl1(e)}get control1(){return this.getControl1()}getControl1(){return this._control1}setControl2(e){return assert&&assert(e.isFinite(),`Cubic control2 should be finite: ${e.toString()}`),this._control2.equals(e)||(this._control2=e,this.invalidate()),this}set control2(e){this.setControl2(e)}get control2(){return this.getControl2()}getControl2(){return this._control2}setEnd(e){return assert&&assert(e.isFinite(),`Cubic end should be finite: ${e.toString()}`),this._end.equals(e)||(this._end=e,this.invalidate()),this}set end(e){this.setEnd(e)}get end(){return this.getEnd()}getEnd(){return this._end}positionAt(e){assert&&assert(e>=0,"positionAt t should be non-negative"),assert&&assert(e<=1,"positionAt t should be no greater than 1");const t=1-e,n=t*t*t,r=3*t*t*e,s=3*t*e*e,a=e*e*e;return new Vector2(this._start.x*n+this._control1.x*r+this._control2.x*s+this._end.x*a,this._start.y*n+this._control1.y*r+this._control2.y*s+this._end.y*a)}tangentAt(e){assert&&assert(e>=0,"tangentAt t should be non-negative"),assert&&assert(e<=1,"tangentAt t should be no greater than 1");const t=1-e;return new Vector2(0,0).set(this._start).multiplyScalar(-3*t*t).add(scratchVector1.set(this._control1).multiplyScalar(3*t*t-6*t*e)).add(scratchVector1.set(this._control2).multiplyScalar(6*t*e-3*e*e)).add(scratchVector1.set(this._end).multiplyScalar(3*e*e))}curvatureAt(e){if(assert&&assert(e>=0,"curvatureAt t should be non-negative"),assert&&assert(e<=1,"curvatureAt t should be no greater than 1"),Math.abs(e-.5)>.5-1e-7){const n=e<.5,r=n?this._start:this._end,s=n?this._control1:this._control2,a=n?this._control2:this._control1,h=s.minus(r),c=h.magnitude;return(n?-1:1)*h.perpendicular.normalized().dot(a.minus(s))*(this.degree-1)/(this.degree*c*c)}else return this.subdivided(e)[0].curvatureAt(1)}subdivided(e){if(assert&&assert(e>=0,"subdivided t should be non-negative"),assert&&assert(e<=1,"subdivided t should be no greater than 1"),e===0||e===1)return[this];const t=this._start.blend(this._control1,e),n=this._control2.blend(this._end,e),r=this._control1.blend(this._control2,e),s=t.blend(r,e),a=r.blend(n,e),h=s.blend(a,e);return[new Cubic(this._start,t,s,h),new Cubic(h,a,n,this._end)]}invalidate(){assert&&assert(this._start instanceof Vector2,`Cubic start should be a Vector2: ${this._start}`),assert&&assert(this._start.isFinite(),`Cubic start should be finite: ${this._start.toString()}`),assert&&assert(this._control1 instanceof Vector2,`Cubic control1 should be a Vector2: ${this._control1}`),assert&&assert(this._control1.isFinite(),`Cubic control1 should be finite: ${this._control1.toString()}`),assert&&assert(this._control2 instanceof Vector2,`Cubic control2 should be a Vector2: ${this._control2}`),assert&&assert(this._control2.isFinite(),`Cubic control2 should be finite: ${this._control2.toString()}`),assert&&assert(this._end instanceof Vector2,`Cubic end should be a Vector2: ${this._end}`),assert&&assert(this._end.isFinite(),`Cubic end should be finite: ${this._end.toString()}`),this._startTangent=null,this._endTangent=null,this._r=null,this._s=null,this._tCusp=null,this._tDeterminant=null,this._tInflection1=null,this._tInflection2=null,this._quadratics=null,this._xExtremaT=null,this._yExtremaT=null,this._bounds=null,this._svgPathFragment=null,this.invalidationEmitter.emit()}getStartTangent(){return this._startTangent===null&&(this._startTangent=this.tangentAt(0).normalized()),this._startTangent}get startTangent(){return this.getStartTangent()}getEndTangent(){return this._endTangent===null&&(this._endTangent=this.tangentAt(1).normalized()),this._endTangent}get endTangent(){return this.getEndTangent()}getR(){return this._r===null&&(this._r=this._control1.minus(this._start).normalized()),this._r}get r(){return this.getR()}getS(){return this._s===null&&(this._s=this.getR().perpendicular),this._s}get s(){return this.getS()}getTCusp(){return this._tCusp===null&&this.computeCuspInfo(),assert&&assert(this._tCusp!==null),this._tCusp}get tCusp(){return this.getTCusp()}getTDeterminant(){return this._tDeterminant===null&&this.computeCuspInfo(),assert&&assert(this._tDeterminant!==null),this._tDeterminant}get tDeterminant(){return this.getTDeterminant()}getTInflection1(){return this._tInflection1===null&&this.computeCuspInfo(),assert&&assert(this._tInflection1!==null),this._tInflection1}get tInflection1(){return this.getTInflection1()}getTInflection2(){return this._tInflection2===null&&this.computeCuspInfo(),assert&&assert(this._tInflection2!==null),this._tInflection2}get tInflection2(){return this.getTInflection2()}getQuadratics(){return this._quadratics===null&&this.computeCuspSegments(),assert&&assert(this._quadratics!==null),this._quadratics}getXExtremaT(){return this._xExtremaT===null&&(this._xExtremaT=Cubic.extremaT(this._start.x,this._control1.x,this._control2.x,this._end.x)),this._xExtremaT}get xExtremaT(){return this.getXExtremaT()}getYExtremaT(){return this._yExtremaT===null&&(this._yExtremaT=Cubic.extremaT(this._start.y,this._control1.y,this._control2.y,this._end.y)),this._yExtremaT}get yExtremaT(){return this.getYExtremaT()}getBounds(){return this._bounds===null&&(this._bounds=Bounds2.NOTHING,this._bounds=this._bounds.withPoint(this._start),this._bounds=this._bounds.withPoint(this._end),_.each(this.getXExtremaT(),e=>{e>=0&&e<=1&&(this._bounds=this._bounds.withPoint(this.positionAt(e)))}),_.each(this.getYExtremaT(),e=>{e>=0&&e<=1&&(this._bounds=this._bounds.withPoint(this.positionAt(e)))}),this.hasCusp()&&(this._bounds=this._bounds.withPoint(this.positionAt(this.getTCusp())))),this._bounds}get bounds(){return this.getBounds()}computeCuspInfo(){const e=this._start.times(-1).plus(this._control1.times(3)).plus(this._control2.times(-3)).plus(this._end),t=this._start.times(3).plus(this._control1.times(-6)).plus(this._control2.times(3)),n=this._start.times(-3).plus(this._control1.times(3)),r=e.perpendicular,s=t.perpendicular,a=r.dot(t);if(this._tCusp=-.5*(r.dot(n)/a),this._tDeterminant=this._tCusp*this._tCusp-1/3*(s.dot(n)/a),this._tDeterminant>=0){const h=Math.sqrt(this._tDeterminant);this._tInflection1=this._tCusp-h,this._tInflection2=this._tCusp+h}else this._tInflection1=NaN,this._tInflection2=NaN}computeCuspSegments(){if(this.hasCusp()){this._quadratics=[];const e=this.getTCusp();if(e===0)this._quadratics.push(new Quadratic(this.start,this.control2,this.end));else if(e===1)this._quadratics.push(new Quadratic(this.start,this.control1,this.end));else{const t=this.subdivided(e);this._quadratics.push(new Quadratic(t[0].start,t[0].control1,t[0].end)),this._quadratics.push(new Quadratic(t[1].start,t[1].control2,t[1].end))}}else this._quadratics=null}getNondegenerateSegments(){const e=this._start,t=this._control1,n=this._control2,r=this._end,s=this.degreeReduced(1e-9);if(e.equals(r)&&e.equals(t)&&e.equals(n))return[];if(this.hasCusp())return _.flatten(this.getQuadratics().map(a=>a.getNondegenerateSegments()));if(s)return s.getNondegenerateSegments();if(arePointsCollinear(e,t,r)&&arePointsCollinear(e,n,r)&&!e.equalsEpsilon(r,1e-7)){const a=this.getXExtremaT().concat(this.getYExtremaT()).sort().map(d=>this.positionAt(d)),h=[];let c=e;a.length&&(h.push(new Line$1(e,a[0])),c=a[0]);for(let d=1;d<a.length;d++)h.push(new Line$1(a[d-1],a[d])),c=a[d];return h.push(new Line$1(c,r)),_.flatten(h.map(d=>d.getNondegenerateSegments()))}else return[this]}hasCusp(){const e=this.getTCusp();return e>=0&&e<=1&&this.tangentAt(e).magnitude<1e-7}toRS(e){const t=e.minus(this._start);return new Vector2(t.dot(this.getR()),t.dot(this.getS()))}offsetTo(e,t){const r=[],s=[];for(let a=0;a<32;a++){let h=a/31;t&&(h=1-h),r.push(this.positionAt(h).plus(this.tangentAt(h).perpendicular.normalized().times(e))),a>0&&s.push(new Line$1(r[a-1],r[a]))}return s}getSVGPathFragment(){let e;return assert&&(e=this._svgPathFragment,this._svgPathFragment=null),this._svgPathFragment||(this._svgPathFragment=`C ${svgNumber(this._control1.x)} ${svgNumber(this._control1.y)} ${svgNumber(this._control2.x)} ${svgNumber(this._control2.y)} ${svgNumber(this._end.x)} ${svgNumber(this._end.y)}`),assert&&e&&assert(e===this._svgPathFragment,"Quadratic line segment changed without invalidate()"),this._svgPathFragment}strokeLeft(e){return this.offsetTo(-e/2,!1)}strokeRight(e){return this.offsetTo(e/2,!0)}getInteriorExtremaTs(){const e=this.getXExtremaT().concat(this.getYExtremaT()),t=[];return _.each(e,n=>{n>1e-10&&n<1-1e-10&&_.every(t,s=>Math.abs(n-s)>1e-10)&&t.push(n)}),t.sort()}intersection(e){const t=[],n=Matrix3.rotation2(-e.direction.angle).timesMatrix(Matrix3.translation(-e.position.x,-e.position.y)),r=n.timesVector2(this._start),s=n.timesVector2(this._control1),a=n.timesVector2(this._control2),h=n.timesVector2(this._end),c=-r.y+3*s.y-3*a.y+h.y,d=3*r.y-6*s.y+3*a.y,y=-3*r.y+3*s.y,g=r.y,D=solveCubicRootsReal(c,d,y,g);return _.each(D,O=>{if(O>=0&&O<=1){const V=this.positionAt(O),k=this.tangentAt(O).normalized(),M=k.perpendicular,N=V.minus(e.position);if(N.dot(e.direction)>0){const F=M.dot(e.direction)>0?M.negated():M,G=e.direction.perpendicular.dot(k)<0?1:-1;t.push(new RayIntersection(N.magnitude,V,F,G,O))}}}),t}windingIntersection(e){let t=0;const n=this.intersection(e);return _.each(n,r=>{t+=r.wind}),t}writeToContext(e){e.bezierCurveTo(this._control1.x,this._control1.y,this._control2.x,this._control2.y,this._end.x,this._end.y)}transformed(e){return new Cubic(e.timesVector2(this._start),e.timesVector2(this._control1),e.timesVector2(this._control2),e.timesVector2(this._end))}degreeReduced(e){e=e||0;const t=scratchVector1.set(this._control1).multiplyScalar(3).subtract(this._start).divideScalar(2),n=scratchVector2.set(this._control2).multiplyScalar(3).subtract(this._end).divideScalar(2);return scratchVector3.set(t).subtract(n).magnitude<=e?new Quadratic(this._start,t.average(n),this._end):null}getSignedAreaFragment(){return 1/20*(this._start.x*(6*this._control1.y+3*this._control2.y+this._end.y)+this._control1.x*(-6*this._start.y+3*this._control2.y+3*this._end.y)+this._control2.x*(-3*this._start.y-3*this._control1.y+6*this._end.y)+this._end.x*(-this._start.y-3*this._control1.y-6*this._control2.y))}reversed(){return new Cubic(this._end,this._control2,this._control1,this._start)}getSelfIntersection(){const e=this.getInteriorExtremaTs(),t=[0].concat(e).concat([1]),n=this.subdivisions(e);if(n.length<3)return null;for(let r=0;r<n.length;r++){const s=n[r];for(let a=r+1;a<n.length;a++){const h=n[a],c=BoundsIntersection.intersect(s,h);if(assert&&assert(c.length<2),c.length){const d=c[0];if(d.aT>1e-7&&d.aT<1-1e-7&&d.bT>1e-7&&d.bT<1-1e-7){const y=t[r]+d.aT*(t[r+1]-t[r]),g=t[a]+d.bT*(t[a+1]-t[a]);return new SegmentIntersection(d.point,y,g)}}}}return null}serialize(){return{type:"Cubic",startX:this._start.x,startY:this._start.y,control1X:this._control1.x,control1Y:this._control1.y,control2X:this._control2.x,control2Y:this._control2.y,endX:this._end.x,endY:this._end.y}}getOverlaps(e,t=1e-6){return e instanceof Cubic?Cubic.getOverlaps(this,e):null}static deserialize(e){return assert&&assert(e.type==="Cubic"),new Cubic(new Vector2(e.startX,e.startY),new Vector2(e.control1X,e.control1Y),new Vector2(e.control2X,e.control2Y),new Vector2(e.endX,e.endY))}static extremaT(e,t,n,r){if(e===t&&e===n&&e===r)return[];const s=-3*e+9*t-9*n+3*r,a=6*e-12*t+6*n,h=-3*e+3*t;return _.filter(solveQuadraticRootsReal(s,a,h),isBetween0And1)}static getOverlaps(e,t,n=1e-6){const r=[],s=e._start.x,a=-3*e._start.x+3*e._control1.x,h=3*e._start.x-6*e._control1.x+3*e._control2.x,c=-1*e._start.x+3*e._control1.x-3*e._control2.x+e._end.x,d=e._start.y,y=-3*e._start.y+3*e._control1.y,g=3*e._start.y-6*e._control1.y+3*e._control2.y,D=-1*e._start.y+3*e._control1.y-3*e._control2.y+e._end.y,O=t._start.x,V=-3*t._start.x+3*t._control1.x,k=3*t._start.x-6*t._control1.x+3*t._control2.x,M=-1*t._start.x+3*t._control1.x-3*t._control2.x+t._end.x,N=t._start.y,F=-3*t._start.y+3*t._control1.y,G=3*t._start.y-6*t._control1.y+3*t._control2.y,ie=-1*t._start.y+3*t._control1.y-3*t._control2.y+t._end.y,Z=Math.abs(Math.max(e._start.x,e._control1.x,e._control2.x,e._end.x,e._start.x,e._control1.x,e._control2.x,e._end.x)-Math.min(e._start.x,e._control1.x,e._control2.x,e._end.x,e._start.x,e._control1.x,e._control2.x,e._end.x)),W=Math.abs(Math.max(e._start.y,e._control1.y,e._control2.y,e._end.y,e._start.y,e._control1.y,e._control2.y,e._end.y)-Math.min(e._start.y,e._control1.y,e._control2.y,e._end.y,e._start.y,e._control1.y,e._control2.y,e._end.y)),X=Segment.polynomialGetOverlapCubic(s,a,h,c,O,V,k,M),J=Segment.polynomialGetOverlapCubic(d,y,g,D,N,F,G,ie);let oe;if(Z>W?oe=X===null||X===!0?J:X:oe=J===null||J===!0?X:J,oe===null||oe===!0)return r;const le=oe.a,pe=oe.b,ve=le*le,Oe=le*le*le,He=pe*pe,Ue=pe*pe*pe,Le=2*le*pe,Ae=3*le*He,ae=3*ve*pe,Ie=O+pe*V+He*k+Ue*M-s,nt=le*V+Le*k+Ae*M-a,Qe=ve*k+ae*M-h,Be=Oe*M-c,We=N+pe*F+He*G+Ue*ie-d,ft=le*F+Le*G+Ae*ie-y,mt=ve*G+ae*ie-g,bt=Oe*ie-D,Et=DotUtils.solveQuadraticRootsReal(3*Be,2*Qe,nt),wt=DotUtils.solveQuadraticRootsReal(3*bt,2*mt,ft),vt=_.uniq([0,1].concat(Et!==null?Et.filter(isBetween0And1):[])),Ut=_.uniq([0,1].concat(wt!==null?wt.filter(isBetween0And1):[]));for(let $t=0;$t<vt.length;$t++){const Ft=vt[$t];if(Math.abs(((Be*Ft+Qe)*Ft+nt)*Ft+Ie)>n)return r}for(let $t=0;$t<Ut.length;$t++){const Ft=Ut[$t];if(Math.abs(((bt*Ft+mt)*Ft+ft)*Ft+We)>n)return r}const Ne=pe,Pi=le+pe;return Ne>1&&Pi>1||Ne<0&&Pi<0?r:[new Overlap(le,pe)]}}Cubic.prototype.degree=3;kite.register("Cubic",Cubic);const TWO_PI=Math.PI*2;class Arc extends Segment{constructor(e,t,n,r,s){super(),this._center=e,this._radius=t,this._startAngle=n,this._endAngle=r,this._anticlockwise=s,this.invalidate()}setCenter(e){return assert&&assert(e.isFinite(),`Arc center should be finite: ${e.toString()}`),this._center.equals(e)||(this._center=e,this.invalidate()),this}set center(e){this.setCenter(e)}get center(){return this.getCenter()}getCenter(){return this._center}setRadius(e){return assert&&assert(isFinite(e),`Arc radius should be a finite number: ${e}`),this._radius!==e&&(this._radius=e,this.invalidate()),this}set radius(e){this.setRadius(e)}get radius(){return this.getRadius()}getRadius(){return this._radius}setStartAngle(e){return assert&&assert(isFinite(e),`Arc startAngle should be a finite number: ${e}`),this._startAngle!==e&&(this._startAngle=e,this.invalidate()),this}set startAngle(e){this.setStartAngle(e)}get startAngle(){return this.getStartAngle()}getStartAngle(){return this._startAngle}setEndAngle(e){return assert&&assert(isFinite(e),`Arc endAngle should be a finite number: ${e}`),this._endAngle!==e&&(this._endAngle=e,this.invalidate()),this}set endAngle(e){this.setEndAngle(e)}get endAngle(){return this.getEndAngle()}getEndAngle(){return this._endAngle}setAnticlockwise(e){return this._anticlockwise!==e&&(this._anticlockwise=e,this.invalidate()),this}set anticlockwise(e){this.setAnticlockwise(e)}get anticlockwise(){return this.getAnticlockwise()}getAnticlockwise(){return this._anticlockwise}positionAt(e){return assert&&assert(e>=0,"positionAt t should be non-negative"),assert&&assert(e<=1,"positionAt t should be no greater than 1"),this.positionAtAngle(this.angleAt(e))}tangentAt(e){return assert&&assert(e>=0,"tangentAt t should be non-negative"),assert&&assert(e<=1,"tangentAt t should be no greater than 1"),this.tangentAtAngle(this.angleAt(e))}curvatureAt(e){return assert&&assert(e>=0,"curvatureAt t should be non-negative"),assert&&assert(e<=1,"curvatureAt t should be no greater than 1"),(this._anticlockwise?-1:1)/this._radius}subdivided(e){if(assert&&assert(e>=0,"subdivided t should be non-negative"),assert&&assert(e<=1,"subdivided t should be no greater than 1"),e===0||e===1)return[this];const t=this.angleAt(0),n=this.angleAt(e),r=this.angleAt(1);return[new Arc(this._center,this._radius,t,n,this._anticlockwise),new Arc(this._center,this._radius,n,r,this._anticlockwise)]}invalidate(){this._start=null,this._end=null,this._startTangent=null,this._endTangent=null,this._actualEndAngle=null,this._isFullPerimeter=null,this._angleDifference=null,this._bounds=null,this._svgPathFragment=null,assert&&assert(this._center instanceof Vector2,"Arc center should be a Vector2"),assert&&assert(this._center.isFinite(),"Arc center should be finite (not NaN or infinite)"),assert&&assert(typeof this._radius=="number",`Arc radius should be a number: ${this._radius}`),assert&&assert(isFinite(this._radius),`Arc radius should be a finite number: ${this._radius}`),assert&&assert(typeof this._startAngle=="number",`Arc startAngle should be a number: ${this._startAngle}`),assert&&assert(isFinite(this._startAngle),`Arc startAngle should be a finite number: ${this._startAngle}`),assert&&assert(typeof this._endAngle=="number",`Arc endAngle should be a number: ${this._endAngle}`),assert&&assert(isFinite(this._endAngle),`Arc endAngle should be a finite number: ${this._endAngle}`),assert&&assert(typeof this._anticlockwise=="boolean",`Arc anticlockwise should be a boolean: ${this._anticlockwise}`),this._radius<0&&(this._radius=-this._radius,this._startAngle+=Math.PI,this._endAngle+=Math.PI),assert&&assert(!(!this.anticlockwise&&this._endAngle-this._startAngle<=-Math.PI*2||this.anticlockwise&&this._startAngle-this._endAngle<=-Math.PI*2),"Not handling arcs with start/end angles that show differences in-between browser handling"),assert&&assert(!(!this.anticlockwise&&this._endAngle-this._startAngle>Math.PI*2||this.anticlockwise&&this._startAngle-this._endAngle>Math.PI*2),"Not handling arcs with start/end angles that show differences in-between browser handling"),this.invalidationEmitter.emit()}getStart(){return this._start===null&&(this._start=this.positionAtAngle(this._startAngle)),this._start}get start(){return this.getStart()}getEnd(){return this._end===null&&(this._end=this.positionAtAngle(this._endAngle)),this._end}get end(){return this.getEnd()}getStartTangent(){return this._startTangent===null&&(this._startTangent=this.tangentAtAngle(this._startAngle)),this._startTangent}get startTangent(){return this.getStartTangent()}getEndTangent(){return this._endTangent===null&&(this._endTangent=this.tangentAtAngle(this._endAngle)),this._endTangent}get endTangent(){return this.getEndTangent()}getActualEndAngle(){return this._actualEndAngle===null&&(this._actualEndAngle=Arc.computeActualEndAngle(this._startAngle,this._endAngle,this._anticlockwise)),this._actualEndAngle}get actualEndAngle(){return this.getActualEndAngle()}getIsFullPerimeter(){return this._isFullPerimeter===null&&(this._isFullPerimeter=!this._anticlockwise&&this._endAngle-this._startAngle>=Math.PI*2||this._anticlockwise&&this._startAngle-this._endAngle>=Math.PI*2),this._isFullPerimeter}get isFullPerimeter(){return this.getIsFullPerimeter()}getAngleDifference(){return this._angleDifference===null&&(this._angleDifference=this._anticlockwise?this._startAngle-this._endAngle:this._endAngle-this._startAngle,this._angleDifference<0&&(this._angleDifference+=Math.PI*2),assert&&assert(this._angleDifference>=0)),this._angleDifference}get angleDifference(){return this.getAngleDifference()}getBounds(){return this._bounds===null&&(this._bounds=Bounds2.NOTHING.copy().withPoint(this.getStart()).withPoint(this.getEnd()),this._startAngle!==this._endAngle&&(this.includeBoundsAtAngle(0),this.includeBoundsAtAngle(Math.PI/2),this.includeBoundsAtAngle(Math.PI),this.includeBoundsAtAngle(3*Math.PI/2))),this._bounds}get bounds(){return this.getBounds()}getNondegenerateSegments(){return this._radius<=0||this._startAngle===this._endAngle?[]:[this]}includeBoundsAtAngle(e){this.containsAngle(e)&&(this._bounds=this._bounds.withPoint(this._center.plus(Vector2.createPolar(this._radius,e))))}mapAngle(e){return Math.abs(DotUtils.moduloBetweenDown(e-this._startAngle,-Math.PI,Math.PI))<1e-8?this._startAngle:Math.abs(DotUtils.moduloBetweenDown(e-this.getActualEndAngle(),-Math.PI,Math.PI))<1e-8?this.getActualEndAngle():this._startAngle>this.getActualEndAngle()?DotUtils.moduloBetweenUp(e,this._startAngle-2*Math.PI,this._startAngle):DotUtils.moduloBetweenDown(e,this._startAngle,this._startAngle+2*Math.PI)}tAtAngle(e){const t=(this.mapAngle(e)-this._startAngle)/(this.getActualEndAngle()-this._startAngle);return assert&&assert(t>=0&&t<=1,`tAtAngle out of range: ${t}`),t}angleAt(e){return this._startAngle+(this.getActualEndAngle()-this._startAngle)*e}positionAtAngle(e){return this._center.plus(Vector2.createPolar(this._radius,e))}tangentAtAngle(e){const t=Vector2.createPolar(1,e);return this._anticlockwise?t.perpendicular:t.perpendicular.negated()}containsAngle(e){const t=this._anticlockwise?e-this._endAngle:e-this._startAngle;return DotUtils.moduloBetweenDown(t,0,Math.PI*2)<=this.angleDifference}getSVGPathFragment(){let e;if(assert&&(e=this._svgPathFragment,this._svgPathFragment=null),!this._svgPathFragment){const n=this._anticlockwise?"0":"1";let r;if(this.angleDifference<Math.PI*2-.01)r=this.angleDifference<Math.PI?"0":"1",this._svgPathFragment=`A ${svgNumber(this._radius)} ${svgNumber(this._radius)} 0 ${r} ${n} ${svgNumber(this.end.x)} ${svgNumber(this.end.y)}`;else{const s=(this._startAngle+this._endAngle)/2,a=this._center.plus(Vector2.createPolar(this._radius,s));r="0";const h=`A ${svgNumber(this._radius)} ${svgNumber(this._radius)} 0 ${r} ${n} ${svgNumber(a.x)} ${svgNumber(a.y)}`,c=`A ${svgNumber(this._radius)} ${svgNumber(this._radius)} 0 ${r} ${n} ${svgNumber(this.end.x)} ${svgNumber(this.end.y)}`;this._svgPathFragment=`${h} ${c}`}}return assert&&e&&assert(e===this._svgPathFragment,"Quadratic line segment changed without invalidate()"),this._svgPathFragment}strokeLeft(e){return[new Arc(this._center,this._radius+(this._anticlockwise?1:-1)*e/2,this._startAngle,this._endAngle,this._anticlockwise)]}strokeRight(e){return[new Arc(this._center,this._radius+(this._anticlockwise?-1:1)*e/2,this._endAngle,this._startAngle,!this._anticlockwise)]}getInteriorExtremaTs(){const e=[];return _.each([0,Math.PI/2,Math.PI,3*Math.PI/2],t=>{if(this.containsAngle(t)){const n=this.tAtAngle(t),r=1e-10;n>r&&n<1-r&&e.push(n)}}),e.sort()}intersection(e){const t=[],r=e.position.minus(this._center),s=e.direction.dot(r),a=r.magnitudeSquared,h=4*s*s-4*(a-this._radius*this._radius);if(h<0)return t;const c=e.direction.dot(this._center)-e.direction.dot(e.position),d=Math.sqrt(h)/2,y=c-d,g=c+d;if(g<0)return t;const D=e.pointAtDistance(g),O=D.minus(this._center).normalized(),V=O.angle;if(y<0)this.containsAngle(V)&&t.push(new RayIntersection(g,D,O.negated(),this._anticlockwise?-1:1,this.tAtAngle(V)));else{const k=e.pointAtDistance(y),M=k.minus(this._center).normalized(),N=M.angle;this.containsAngle(N)&&t.push(new RayIntersection(y,k,M,this._anticlockwise?1:-1,this.tAtAngle(N))),this.containsAngle(V)&&t.push(new RayIntersection(g,D,O.negated(),this._anticlockwise?-1:1,this.tAtAngle(V)))}return t}windingIntersection(e){let t=0;const n=this.intersection(e);return _.each(n,r=>{t+=r.wind}),t}writeToContext(e){e.arc(this._center.x,this._center.y,this._radius,this._startAngle,this._endAngle,this._anticlockwise)}transformed(e){const t=e.timesVector2(Vector2.createPolar(1,this._startAngle)).minus(e.timesVector2(Vector2.ZERO)).angle;let n=e.timesVector2(Vector2.createPolar(1,this._endAngle)).minus(e.timesVector2(Vector2.ZERO)).angle;const r=e.getDeterminant()>=0?this._anticlockwise:!this._anticlockwise;Math.abs(this._endAngle-this._startAngle)===Math.PI*2&&(n=r?t-Math.PI*2:t+Math.PI*2);const s=e.getScaleVector();if(s.x!==s.y){const a=s.x*this._radius,h=s.y*this._radius;return new EllipticalArc(e.timesVector2(this._center),a,h,0,t,n,r)}else{const a=s.x*this._radius;return new Arc(e.timesVector2(this._center),a,t,n,r)}}getSignedAreaFragment(){const e=this._startAngle,t=this.getActualEndAngle();return .5*this._radius*(this._radius*(t-e)+this._center.x*(Math.sin(t)-Math.sin(e))-this._center.y*(Math.cos(t)-Math.cos(e)))}reversed(){return new Arc(this._center,this._radius,this._endAngle,this._startAngle,!this._anticlockwise)}getArcLength(){return this.getAngleDifference()*this._radius}toPiecewiseLinearOrArcSegments(){return[this]}serialize(){return{type:"Arc",centerX:this._center.x,centerY:this._center.y,radius:this._radius,startAngle:this._startAngle,endAngle:this._endAngle,anticlockwise:this._anticlockwise}}getOverlaps(e,t=1e-6){return e instanceof Arc?Arc.getOverlaps(this,e):null}getConicMatrix(){const e=this.center.x,t=this.center.y,n=1,r=0,s=1,a=-2*e,h=-2*t,c=e*e+t*t-this.radius*this.radius;return Matrix3.rowMajor(n,r/2,a/2,r/2,s,h/2,a/2,h/2,c)}static deserialize(e){return assert&&assert(e.type==="Arc"),new Arc(new Vector2(e.centerX,e.centerY),e.radius,e.startAngle,e.endAngle,e.anticlockwise)}static computeActualEndAngle(e,t,n){return n?e>t?t:e<t?t-2*Math.PI:e:e<t?t:e>t?t+Math.PI*2:e}static getPartialOverlap(e,t,n,r,s){assert&&assert(e>0&&e<=TWO_PI+1e-10),assert&&assert(t>=0&&t<TWO_PI+1e-10),assert&&assert(n>=0&&n<=TWO_PI+1e-10),assert&&assert(r>=0&&r<=1),assert&&assert(s>=0&&s<=1);const a=n<t,h=a?n:t,c=a?t:n,d=h,y=Math.min(e,c);return y<d+1e-8?[]:[Overlap.createLinear(DotUtils.clamp(DotUtils.linear(0,e,0,1,d),0,1),DotUtils.clamp(DotUtils.linear(t,n,r,s,d),0,1),DotUtils.clamp(DotUtils.linear(0,e,0,1,y),0,1),DotUtils.clamp(DotUtils.linear(t,n,r,s,y),0,1))]}static getAngularOverlaps(e,t,n,r){assert&&assert(isFinite(e)),assert&&assert(isFinite(t)),assert&&assert(isFinite(n)),assert&&assert(isFinite(r));let s=t-e;const a=s<0?-1:1;s*=a;const h=DotUtils.moduloBetweenDown(a*(n-e),0,TWO_PI),c=a*(r-n)+h;let d;return c<-1e-10?(d=-h/(c-h),Arc.getPartialOverlap(s,h,0,0,d).concat(Arc.getPartialOverlap(s,TWO_PI,c+TWO_PI,d,1))):c>TWO_PI+1e-10?(d=(TWO_PI-h)/(c-h),Arc.getPartialOverlap(s,h,TWO_PI,0,d).concat(Arc.getPartialOverlap(s,0,c-TWO_PI,d,1))):Arc.getPartialOverlap(s,h,c,0,1)}static getOverlaps(e,t){return e._center.distance(t._center)>1e-4||Math.abs(e._radius-t._radius)>1e-4?[]:Arc.getAngularOverlaps(e._startAngle,e.getActualEndAngle(),t._startAngle,t.getActualEndAngle())}static getCircleIntersectionPoint(e,t,n,r){assert&&assert(isFinite(t)&&t>=0),assert&&assert(isFinite(r)&&r>=0);const s=n.minus(e),a=s.magnitude;let h=[];if(!(a<1e-10||a>t+r+1e-10))if(a>t+r-1e-10)h=[e.blend(n,t/a)];else{const c=.5*(a*a-r*r+t*t)/a,d=a*a-r*r+t*t,y=4*a*a*t*t-d*d,g=e.blend(n,c/a);if(y>=1e-10){const D=Math.sqrt(y)/a/2,O=s.perpendicular.setMagnitude(D);h=[g.plus(O),g.minus(O)]}else y>-1e-10&&(h=[g])}return assert&&h.forEach(c=>{assert(Math.abs(c.distance(e)-t)<1e-8),assert(Math.abs(c.distance(n)-r)<1e-8)}),h}static intersect(e,t){const r=[];if(e._center.equalsEpsilon(t._center,1e-7)&&Math.abs(e._radius-t._radius)<1e-7){const s=e.positionAt(0),a=e.positionAt(1),h=t.positionAt(0),c=t.positionAt(1);s.equalsEpsilon(h,1e-7)&&r.push(new SegmentIntersection(s.average(h),0,0)),s.equalsEpsilon(c,1e-7)&&r.push(new SegmentIntersection(s.average(c),0,1)),a.equalsEpsilon(h,1e-7)&&r.push(new SegmentIntersection(a.average(h),1,0)),a.equalsEpsilon(c,1e-7)&&r.push(new SegmentIntersection(a.average(c),1,1))}else{const s=Arc.getCircleIntersectionPoint(e._center,e._radius,t._center,t._radius);for(let a=0;a<s.length;a++){const h=s[a],c=h.minus(e._center).angle,d=h.minus(t._center).angle;e.containsAngle(c)&&t.containsAngle(d)&&r.push(new SegmentIntersection(h,e.tAtAngle(c),t.tAtAngle(d)))}}return r}static createFromPoints(e,t,n){const r=DotUtils.circleCenterFromPoints(e,t,n);if(r===null)return new Line$1(e,n);{const s=e.minus(r),a=t.minus(r),h=n.minus(r),c=s.angle,d=a.angle,y=h.angle,g=(s.magnitude+a.magnitude+h.magnitude)/3,D=new Arc(r,g,c,y,!1);return D.containsAngle(d)?D:new Arc(r,g,c,y,!0)}}}kite.register("Arc",Arc);const toDegrees=DotUtils.toDegrees,unitCircleConicMatrix=Matrix3.rowMajor(1,0,0,0,1,0,0,0,-1);class EllipticalArc extends Segment{constructor(e,t,n,r,s,a,h){super(),this._center=e,this._radiusX=t,this._radiusY=n,this._rotation=r,this._startAngle=s,this._endAngle=a,this._anticlockwise=h,this.invalidate()}setCenter(e){return assert&&assert(e.isFinite(),`EllipticalArc center should be finite: ${e.toString()}`),this._center.equals(e)||(this._center=e,this.invalidate()),this}set center(e){this.setCenter(e)}get center(){return this.getCenter()}getCenter(){return this._center}setRadiusX(e){return assert&&assert(isFinite(e),`EllipticalArc radiusX should be a finite number: ${e}`),this._radiusX!==e&&(this._radiusX=e,this.invalidate()),this}set radiusX(e){this.setRadiusX(e)}get radiusX(){return this.getRadiusX()}getRadiusX(){return this._radiusX}setRadiusY(e){return assert&&assert(isFinite(e),`EllipticalArc radiusY should be a finite number: ${e}`),this._radiusY!==e&&(this._radiusY=e,this.invalidate()),this}set radiusY(e){this.setRadiusY(e)}get radiusY(){return this.getRadiusY()}getRadiusY(){return this._radiusY}setRotation(e){return assert&&assert(isFinite(e),`EllipticalArc rotation should be a finite number: ${e}`),this._rotation!==e&&(this._rotation=e,this.invalidate()),this}set rotation(e){this.setRotation(e)}get rotation(){return this.getRotation()}getRotation(){return this._rotation}setStartAngle(e){return assert&&assert(isFinite(e),`EllipticalArc startAngle should be a finite number: ${e}`),this._startAngle!==e&&(this._startAngle=e,this.invalidate()),this}set startAngle(e){this.setStartAngle(e)}get startAngle(){return this.getStartAngle()}getStartAngle(){return this._startAngle}setEndAngle(e){return assert&&assert(isFinite(e),`EllipticalArc endAngle should be a finite number: ${e}`),this._endAngle!==e&&(this._endAngle=e,this.invalidate()),this}set endAngle(e){this.setEndAngle(e)}get endAngle(){return this.getEndAngle()}getEndAngle(){return this._endAngle}setAnticlockwise(e){return this._anticlockwise!==e&&(this._anticlockwise=e,this.invalidate()),this}set anticlockwise(e){this.setAnticlockwise(e)}get anticlockwise(){return this.getAnticlockwise()}getAnticlockwise(){return this._anticlockwise}positionAt(e){return assert&&assert(e>=0,"positionAt t should be non-negative"),assert&&assert(e<=1,"positionAt t should be no greater than 1"),this.positionAtAngle(this.angleAt(e))}tangentAt(e){return assert&&assert(e>=0,"tangentAt t should be non-negative"),assert&&assert(e<=1,"tangentAt t should be no greater than 1"),this.tangentAtAngle(this.angleAt(e))}curvatureAt(e){assert&&assert(e>=0,"curvatureAt t should be non-negative"),assert&&assert(e<=1,"curvatureAt t should be no greater than 1");const t=this.angleAt(e),n=this._radiusX*Math.sin(t),r=this._radiusY*Math.cos(t),s=Math.pow(r*r+n*n,3/2);return(this._anticlockwise?-1:1)*this._radiusX*this._radiusY/s}subdivided(e){if(assert&&assert(e>=0,"subdivided t should be non-negative"),assert&&assert(e<=1,"subdivided t should be no greater than 1"),e===0||e===1)return[this];const t=this.angleAt(0),n=this.angleAt(e),r=this.angleAt(1);return[new EllipticalArc(this._center,this._radiusX,this._radiusY,this._rotation,t,n,this._anticlockwise),new EllipticalArc(this._center,this._radiusX,this._radiusY,this._rotation,n,r,this._anticlockwise)]}invalidate(){if(assert&&assert(this._center instanceof Vector2,"Arc center should be a Vector2"),assert&&assert(this._center.isFinite(),"Arc center should be finite (not NaN or infinite)"),assert&&assert(typeof this._radiusX=="number",`Arc radiusX should be a number: ${this._radiusX}`),assert&&assert(isFinite(this._radiusX),`Arc radiusX should be a finite number: ${this._radiusX}`),assert&&assert(typeof this._radiusY=="number",`Arc radiusY should be a number: ${this._radiusY}`),assert&&assert(isFinite(this._radiusY),`Arc radiusY should be a finite number: ${this._radiusY}`),assert&&assert(typeof this._rotation=="number",`Arc rotation should be a number: ${this._rotation}`),assert&&assert(isFinite(this._rotation),`Arc rotation should be a finite number: ${this._rotation}`),assert&&assert(typeof this._startAngle=="number",`Arc startAngle should be a number: ${this._startAngle}`),assert&&assert(isFinite(this._startAngle),`Arc startAngle should be a finite number: ${this._startAngle}`),assert&&assert(typeof this._endAngle=="number",`Arc endAngle should be a number: ${this._endAngle}`),assert&&assert(isFinite(this._endAngle),`Arc endAngle should be a finite number: ${this._endAngle}`),assert&&assert(typeof this._anticlockwise=="boolean",`Arc anticlockwise should be a boolean: ${this._anticlockwise}`),this._unitTransform=null,this._start=null,this._end=null,this._startTangent=null,this._endTangent=null,this._actualEndAngle=null,this._isFullPerimeter=null,this._angleDifference=null,this._unitArcSegment=null,this._bounds=null,this._svgPathFragment=null,this._radiusX<0&&(this._radiusX=-this._radiusX,this._startAngle=Math.PI-this._startAngle,this._endAngle=Math.PI-this._endAngle,this._anticlockwise=!this._anticlockwise),this._radiusY<0&&(this._radiusY=-this._radiusY,this._startAngle=-this._startAngle,this._endAngle=-this._endAngle,this._anticlockwise=!this._anticlockwise),this._radiusX<this._radiusY){this._rotation+=Math.PI/2,this._startAngle-=Math.PI/2,this._endAngle-=Math.PI/2;const e=this._radiusX;this._radiusX=this._radiusY,this._radiusY=e}if(this._radiusX<this._radiusY)throw new Error("Not verified to work if radiusX < radiusY");assert&&assert(!(!this._anticlockwise&&this._endAngle-this._startAngle<=-Math.PI*2||this._anticlockwise&&this._startAngle-this._endAngle<=-Math.PI*2),"Not handling elliptical arcs with start/end angles that show differences in-between browser handling"),assert&&assert(!(!this._anticlockwise&&this._endAngle-this._startAngle>Math.PI*2||this._anticlockwise&&this._startAngle-this._endAngle>Math.PI*2),"Not handling elliptical arcs with start/end angles that show differences in-between browser handling"),this.invalidationEmitter.emit()}getUnitTransform(){return this._unitTransform===null&&(this._unitTransform=EllipticalArc.computeUnitTransform(this._center,this._radiusX,this._radiusY,this._rotation)),this._unitTransform}get unitTransform(){return this.getUnitTransform()}getStart(){return this._start===null&&(this._start=this.positionAtAngle(this._startAngle)),this._start}get start(){return this.getStart()}getEnd(){return this._end===null&&(this._end=this.positionAtAngle(this._endAngle)),this._end}get end(){return this.getEnd()}getStartTangent(){return this._startTangent===null&&(this._startTangent=this.tangentAtAngle(this._startAngle)),this._startTangent}get startTangent(){return this.getStartTangent()}getEndTangent(){return this._endTangent===null&&(this._endTangent=this.tangentAtAngle(this._endAngle)),this._endTangent}get endTangent(){return this.getEndTangent()}getActualEndAngle(){return this._actualEndAngle===null&&(this._actualEndAngle=Arc.computeActualEndAngle(this._startAngle,this._endAngle,this._anticlockwise)),this._actualEndAngle}get actualEndAngle(){return this.getActualEndAngle()}getIsFullPerimeter(){return this._isFullPerimeter===null&&(this._isFullPerimeter=!this._anticlockwise&&this._endAngle-this._startAngle>=Math.PI*2||this._anticlockwise&&this._startAngle-this._endAngle>=Math.PI*2),this._isFullPerimeter}get isFullPerimeter(){return this.getIsFullPerimeter()}getAngleDifference(){return this._angleDifference===null&&(this._angleDifference=this._anticlockwise?this._startAngle-this._endAngle:this._endAngle-this._startAngle,this._angleDifference<0&&(this._angleDifference+=Math.PI*2),assert&&assert(this._angleDifference>=0)),this._angleDifference}get angleDifference(){return this.getAngleDifference()}getUnitArcSegment(){return this._unitArcSegment===null&&(this._unitArcSegment=new Arc(Vector2.ZERO,1,this._startAngle,this._endAngle,this._anticlockwise)),this._unitArcSegment}get unitArcSegment(){return this.getUnitArcSegment()}getBounds(){if(this._bounds===null&&(this._bounds=Bounds2.NOTHING.withPoint(this.getStart()).withPoint(this.getEnd()),this._startAngle!==this._endAngle)){const e=Math.atan(-(this._radiusY/this._radiusX)*Math.tan(this._rotation)),t=Math.atan(this._radiusY/this._radiusX/Math.tan(this._rotation));this.possibleExtremaAngles=[e,e+Math.PI,t,t+Math.PI],_.each(this.possibleExtremaAngles,this.includeBoundsAtAngle.bind(this))}return this._bounds}get bounds(){return this.getBounds()}getNondegenerateSegments(){if(this._radiusX<=0||this._radiusY<=0||this._startAngle===this._endAngle)return[];if(this._radiusX===this._radiusY){const e=this._startAngle+this._rotation;let t=this._endAngle+this._rotation;return Math.abs(this._endAngle-this._startAngle)===Math.PI*2&&(t=this._anticlockwise?e-Math.PI*2:e+Math.PI*2),[new Arc(this._center,this._radiusX,e,t,this._anticlockwise)]}else return[this]}includeBoundsAtAngle(e){this.unitArcSegment.containsAngle(e)&&(this._bounds=this._bounds.withPoint(this.positionAtAngle(e)))}mapAngle(e){return Math.abs(DotUtils.moduloBetweenDown(e-this._startAngle,-Math.PI,Math.PI))<1e-8?this._startAngle:Math.abs(DotUtils.moduloBetweenDown(e-this.getActualEndAngle(),-Math.PI,Math.PI))<1e-8?this.getActualEndAngle():this._startAngle>this.getActualEndAngle()?DotUtils.moduloBetweenUp(e,this._startAngle-2*Math.PI,this._startAngle):DotUtils.moduloBetweenDown(e,this._startAngle,this._startAngle+2*Math.PI)}tAtAngle(e){return(this.mapAngle(e)-this._startAngle)/(this.getActualEndAngle()-this._startAngle)}angleAt(e){return this._startAngle+(this.getActualEndAngle()-this._startAngle)*e}positionAtAngle(e){return this.getUnitTransform().transformPosition2(Vector2.createPolar(1,e))}tangentAtAngle(e){const t=this.getUnitTransform().transformNormal2(Vector2.createPolar(1,e));return this._anticlockwise?t.perpendicular:t.perpendicular.negated()}offsetTo(e,t){const r=[],s=[];for(let a=0;a<32;a++){let h=a/31;t&&(h=1-h);const c=this.angleAt(h);r.push(this.positionAtAngle(c).plus(this.tangentAtAngle(c).perpendicular.normalized().times(e))),a>0&&s.push(new Line$1(r[a-1],r[a]))}return s}getSVGPathFragment(){let e;if(assert&&(e=this._svgPathFragment,this._svgPathFragment=null),!this._svgPathFragment){const n=this._anticlockwise?"0":"1";let r;const s=toDegrees(this._rotation);if(this.getAngleDifference()<Math.PI*2-.01)r=this.getAngleDifference()<Math.PI?"0":"1",this._svgPathFragment=`A ${svgNumber(this._radiusX)} ${svgNumber(this._radiusY)} ${s} ${r} ${n} ${svgNumber(this.getEnd().x)} ${svgNumber(this.getEnd().y)}`;else{const a=(this._startAngle+this._endAngle)/2,h=this.positionAtAngle(a);r="0";const c=`A ${svgNumber(this._radiusX)} ${svgNumber(this._radiusY)} ${s} ${r} ${n} ${svgNumber(h.x)} ${svgNumber(h.y)}`,d=`A ${svgNumber(this._radiusX)} ${svgNumber(this._radiusY)} ${s} ${r} ${n} ${svgNumber(this.getEnd().x)} ${svgNumber(this.getEnd().y)}`;this._svgPathFragment=`${c} ${d}`}}return assert&&e&&assert(e===this._svgPathFragment,"Quadratic line segment changed without invalidate()"),this._svgPathFragment}strokeLeft(e){return this.offsetTo(-e/2,!1)}strokeRight(e){return this.offsetTo(e/2,!0)}getInteriorExtremaTs(){const e=[];return _.each(this.possibleExtremaAngles,t=>{if(this.unitArcSegment.containsAngle(t)){const n=this.tAtAngle(t),r=1e-10;n>r&&n<1-r&&e.push(n)}}),e.sort()}intersection(e){const t=this.getUnitTransform(),n=t.inverseRay2(e),r=this.getUnitArcSegment().intersection(n);return _.map(r,s=>{const a=t.transformPosition2(s.point),h=e.position.distance(a),c=t.inverseNormal2(s.normal);return new RayIntersection(h,a,c,s.wind,s.t)})}windingIntersection(e){const t=this.getUnitTransform().inverseRay2(e);return this.getUnitArcSegment().windingIntersection(t)}writeToContext(e){e.ellipse?e.ellipse(this._center.x,this._center.y,this._radiusX,this._radiusY,this._rotation,this._startAngle,this._endAngle,this._anticlockwise):(this.getUnitTransform().getMatrix().canvasAppendTransform(e),e.arc(0,0,1,this._startAngle,this._endAngle,this._anticlockwise),this.getUnitTransform().getInverse().canvasAppendTransform(e))}transformed(e){const t=e.timesVector2(Vector2.createPolar(this._radiusX,this._rotation)).minus(e.timesVector2(Vector2.ZERO)),n=e.timesVector2(Vector2.createPolar(this._radiusY,this._rotation+Math.PI/2)).minus(e.timesVector2(Vector2.ZERO)),r=t.angle,s=t.magnitude,a=n.magnitude,h=e.getDeterminant()<0,c=h?!this._anticlockwise:this._anticlockwise,d=h?-this._startAngle:this._startAngle;let y=h?-this._endAngle:this._endAngle;return Math.abs(this._endAngle-this._startAngle)===Math.PI*2&&(y=c?d-Math.PI*2:d+Math.PI*2),new EllipticalArc(e.timesVector2(this._center),s,a,r,d,y,c)}getSignedAreaFragment(){const e=this._startAngle,t=this.getActualEndAngle(),n=Math.sin(e),r=Math.sin(t),s=Math.cos(e),a=Math.cos(t);return .5*(this._radiusX*this._radiusY*(t-e)+Math.cos(this._rotation)*(this._radiusX*this._center.y*(s-a)+this._radiusY*this._center.x*(r-n))+Math.sin(this._rotation)*(this._radiusX*this._center.x*(a-s)+this._radiusY*this._center.y*(r-n)))}reversed(){return new EllipticalArc(this._center,this._radiusX,this._radiusY,this._rotation,this._endAngle,this._startAngle,!this._anticlockwise)}serialize(){return{type:"EllipticalArc",centerX:this._center.x,centerY:this._center.y,radiusX:this._radiusX,radiusY:this._radiusY,rotation:this._rotation,startAngle:this._startAngle,endAngle:this._endAngle,anticlockwise:this._anticlockwise}}getOverlaps(e,t=1e-6){return e instanceof EllipticalArc?EllipticalArc.getOverlaps(this,e):null}getConicMatrix(){const t=EllipticalArc.computeUnitMatrix(this._center,this._radiusX,this._radiusY,this._rotation).inverted();return t.transposed().multiplyMatrix(unitCircleConicMatrix).multiplyMatrix(t)}static deserialize(e){return assert&&assert(e.type==="EllipticalArc"),new EllipticalArc(new Vector2(e.centerX,e.centerY),e.radiusX,e.radiusY,e.rotation,e.startAngle,e.endAngle,e.anticlockwise)}static getOverlapType(e,t,n=1e-4){if(e._center.distance(t._center)<n){const r=Math.abs(e._radiusX-t._radiusX)<n&&Math.abs(e._radiusY-t._radiusY)<n,s=Math.abs(e._radiusX-t._radiusY)<n&&Math.abs(e._radiusY-t._radiusX)<n;if(r&&Math.abs(DotUtils.moduloBetweenDown(e._rotation-t._rotation+Math.PI/2,0,Math.PI)-Math.PI/2)<n)return EllipticalArcOverlapType.MATCHING_OVERLAP;if(s&&Math.abs(DotUtils.moduloBetweenDown(e._rotation-t._rotation,0,Math.PI)-Math.PI/2)<n)return EllipticalArcOverlapType.OPPOSITE_OVERLAP}return EllipticalArcOverlapType.NONE}static getOverlaps(e,t){return EllipticalArc.getOverlapType(e,t)===EllipticalArcOverlapType.NONE?[]:Arc.getAngularOverlaps(e._startAngle+e._rotation,e.getActualEndAngle()+e._rotation,t._startAngle+t._rotation,t.getActualEndAngle()+t._rotation)}static intersect(e,t,n=1e-10){if(EllipticalArc.getOverlapType(e,t,n)===EllipticalArcOverlapType.NONE)return BoundsIntersection.intersect(e,t);{const s=[],a=e.positionAt(0),h=e.positionAt(1),c=t.positionAt(0),d=t.positionAt(1);return a.equalsEpsilon(c,n)&&s.push(new SegmentIntersection(a.average(c),0,0)),a.equalsEpsilon(d,n)&&s.push(new SegmentIntersection(a.average(d),0,1)),h.equalsEpsilon(c,n)&&s.push(new SegmentIntersection(h.average(c),1,0)),h.equalsEpsilon(d,n)&&s.push(new SegmentIntersection(h.average(d),1,1)),s}}static computeUnitMatrix(e,t,n,r){return Matrix3.translationFromVector(e).timesMatrix(Matrix3.rotation2(r)).timesMatrix(Matrix3.scaling(t,n))}static computeUnitTransform(e,t,n,r){return new Transform3(EllipticalArc.computeUnitMatrix(e,t,n,r))}}const ni=class ni extends EnumerationValue{};ni.MATCHING_OVERLAP=new ni,ni.OPPOSITE_OVERLAP=new ni,ni.NONE=new ni,ni.enumeration=new Enumeration(ni);let EllipticalArcOverlapType=ni;kite.register("EllipticalArc",EllipticalArc);class Subpath{constructor(e,t,n){if(this.segments=[],this.invalidatedEmitter=new TinyEmitter,this._bounds=null,this._strokedSubpaths=null,this._strokedSubpathsComputed=!1,this._strokedStyles=null,this._invalidatingPoints=!1,this.points=t||(e&&e.length?_.map(e,r=>r.start).concat(e[e.length-1].end):[]),this.closed=!!n,this._invalidateListener=this.invalidate.bind(this),e)for(let r=0;r<e.length;r++)_.each(e[r].getNondegenerateSegments(),s=>{this.addSegmentDirectly(s)})}getBounds(){if(this._bounds===null){const e=Bounds2.NOTHING.copy();_.each(this.segments,t=>{e.includeBounds(t.getBounds())}),this._bounds=e}return this._bounds}get bounds(){return this.getBounds()}getArcLength(e,t,n){let r=0;for(let s=0;s<this.segments.length;s++)r+=this.segments[s].getArcLength(e,t,n);return r}copy(){return new Subpath(this.segments.slice(0),this.points.slice(0),this.closed)}invalidatePoints(){this._invalidatingPoints=!0;const e=this.segments.length;for(let t=0;t<e;t++)this.segments[t].invalidate();this._invalidatingPoints=!1,this.invalidate()}invalidate(){this._invalidatingPoints||(this._bounds=null,this._strokedSubpathsComputed=!1,this.invalidatedEmitter.emit())}addPoint(e){return this.points.push(e),this}addSegmentDirectly(e){return assert&&assert(e.start.isFinite(),"Segment start is infinite"),assert&&assert(e.end.isFinite(),"Segment end is infinite"),assert&&assert(e.startTangent.isFinite(),"Segment startTangent is infinite"),assert&&assert(e.endTangent.isFinite(),"Segment endTangent is infinite"),assert&&assert(e.bounds.isEmpty()||e.bounds.isFinite(),"Segment bounds is infinite and non-empty"),this.segments.push(e),e.invalidationEmitter.addListener(this._invalidateListener),this}addSegment(e){const n=e.getNondegenerateSegments().length;for(let r=0;r<n;r++)this.addSegmentDirectly(e);return this.invalidate(),this}addClosingSegment(){if(this.hasClosingSegment()){const e=this.getClosingSegment();this.addSegmentDirectly(e),this.invalidate(),this.addPoint(this.getFirstPoint()),this.closed=!0}}close(){this.closed=!0,this.addClosingSegment()}getLength(){return this.points.length}getFirstPoint(){return assert&&assert(this.points.length),_.first(this.points)}getLastPoint(){return assert&&assert(this.points.length),_.last(this.points)}getFirstSegment(){return assert&&assert(this.segments.length),_.first(this.segments)}getLastSegment(){return assert&&assert(this.segments.length),_.last(this.segments)}getFillSegments(){const e=this.segments.slice();return this.hasClosingSegment()&&e.push(this.getClosingSegment()),e}isDrawable(){return this.segments.length>0}isClosed(){return this.closed}hasClosingSegment(){return!this.getFirstPoint().equalsEpsilon(this.getLastPoint(),1e-9)}getClosingSegment(){return assert&&assert(this.hasClosingSegment(),"Implicit closing segment unnecessary on a fully closed path"),new Line$1(this.getLastPoint(),this.getFirstPoint())}getClosestPoints(e){return Segment.filterClosestToPointResult(_.flatten(this.segments.map(t=>t.getClosestPoints(e))))}writeToContext(e){if(this.isDrawable()){const t=this.getFirstSegment().start;e.moveTo(t.x,t.y);let n=this.segments.length;this.closed&&n>=2&&this.segments[n-1]instanceof Line$1&&n--;for(let r=0;r<n;r++)this.segments[r].writeToContext(e);this.closed&&e.closePath()}}toPiecewiseLinear(e){return assert&&assert(!e.pointMap,"For use with pointMap, please use nonlinearTransformed"),new Subpath(_.flatten(_.map(this.segments,t=>t.toPiecewiseLinearSegments(e))),void 0,this.closed)}transformed(e){return new Subpath(_.map(this.segments,t=>t.transformed(e)),_.map(this.points,t=>e.timesVector2(t)),this.closed)}nonlinearTransformed(e){return new Subpath(_.flatten(_.map(this.segments,t=>e.methodName&&t[e.methodName]?t[e.methodName](e):t.toPiecewiseLinearSegments(e))),void 0,this.closed)}getBoundsWithTransform(e){const t=Bounds2.NOTHING.copy(),n=this.segments.length;for(let r=0;r<n;r++)t.includeBounds(this.segments[r].getBoundsWithTransform(e));return t}offset(e){if(!this.isDrawable())return new Subpath([],void 0,this.closed);if(e===0)return new Subpath(this.segments.slice(),void 0,this.closed);let t;const n=this.segments.slice(),r=[];for(t=0;t<n.length;t++)r.push(n[t].strokeLeft(2*e));let s=[];for(t=0;t<n.length;t++){if(this.closed||t>0){const a=(t>0?t:n.length)-1,h=n[t].start,c=n[a].endTangent,d=n[t].startTangent,y=c.perpendicular.negated().times(e).angle,g=d.perpendicular.negated().times(e).angle,D=c.perpendicular.dot(d)>0;s.push(new Arc(h,Math.abs(e),y,g,D))}s=s.concat(r[t])}return new Subpath(s,void 0,this.closed)}stroked(e){if(!this.isDrawable())return[];if(e===void 0&&(e=new LineStyles),assert&&assert(!this._strokedSubpathsComputed||this._strokedStyles&&this._strokedSubpaths),this._strokedSubpathsComputed&&this._strokedStyles.equals(e))return this._strokedSubpaths;const t=e.lineWidth;let n,r=[],s=[];const a=this.getFirstSegment(),h=this.getLastSegment(),c=O=>{r=r.concat(O)},d=O=>{s=s.concat(O)},y=h.end.equals(a.start),g=y?null:new Line$1(this.segments[this.segments.length-1].end,this.segments[0].start);for(n=0;n<this.segments.length;n++)n>0&&c(e.leftJoin(this.segments[n].start,this.segments[n-1].endTangent,this.segments[n].startTangent)),c(this.segments[n].strokeLeft(t));for(n=this.segments.length-1;n>=0;n--)n<this.segments.length-1&&d(e.rightJoin(this.segments[n].end,this.segments[n].endTangent,this.segments[n+1].startTangent)),d(this.segments[n].strokeRight(t));let D;return this.closed?(y?(c(e.leftJoin(h.end,h.endTangent,a.startTangent)),d(e.rightJoin(h.end,h.endTangent,a.startTangent))):(c(e.leftJoin(g.start,h.endTangent,g.startTangent)),c(g.strokeLeft(t)),c(e.leftJoin(g.end,g.endTangent,a.startTangent)),d(e.rightJoin(g.end,g.endTangent,a.startTangent)),d(g.strokeRight(t)),d(e.rightJoin(g.start,h.endTangent,g.startTangent))),D=[new Subpath(r,void 0,!0),new Subpath(s,void 0,!0)]):D=[new Subpath(r.concat(e.cap(h.end,h.endTangent)).concat(s).concat(e.cap(a.start,a.startTangent.negated())),void 0,!0)],this._strokedSubpaths=D,this._strokedSubpathsComputed=!0,this._strokedStyles=e.copy(),D}dashed(e,t,n,r){const s=(c,d)=>{const y=c[c.length-1].concat(d[0]),g=c.slice(0,c.length-1).concat([y]).concat(d.slice(1));return assert&&assert(g.length===c.length+d.length-1),g},a=(c,d)=>{if(!c.hasRightFilled||!d.hasLeftFilled)return!1;const y=_.last(_.last(c.segmentArrays)),g=d.segmentArrays[0][0];return y.end.distance(g.start)<1e-5},h=[];for(let c=0;c<this.segments.length;c++){const d=this.segments[c],y=d.getDashValues(e,t,n,r);h.push(y),t+=y.arcLength;const g=[0].concat(y.values).concat([1]),D=y.initiallyInside;y.hasLeftFilled=D,y.hasRightFilled=g.length%2===0?D:!D,y.segmentArrays=[];for(let O=D?0:1;O<g.length-1;O+=2)g[O]!==g[O+1]&&y.segmentArrays.push([d.slice(g[O],g[O+1])])}for(let c=h.length-1;c>=1;c--){const d=h[c-1],y=h[c];a(d,y)&&h.splice(c-1,2,{segmentArrays:s(d.segmentArrays,y.segmentArrays),hasLeftFilled:d.hasLeftFilled,hasRightFilled:y.hasRightFilled})}if(h.length>1&&a(h[h.length-1],h[0])){const c=h.pop(),d=h.shift();h.push({segmentArrays:s(c.segmentArrays,d.segmentArrays),hasLeftFilled:c.hasLeftFilled,hasRightFilled:d.hasRightFilled})}return this.closed&&h.length===1&&h[0].segmentArrays.length===1&&h[0].hasLeftFilled&&h[0].hasRightFilled?[new Subpath(h[0].segmentArrays[0],void 0,!0)]:_.flatten(h.map(c=>c.segmentArrays)).map(c=>new Subpath(c))}serialize(){return{type:"Subpath",segments:this.segments.map(e=>e.serialize()),points:this.points.map(e=>({x:e.x,y:e.y})),closed:this.closed}}static deserialize(e){return assert&&assert(e.type==="Subpath"),new Subpath(e.segments.map(Segment.deserialize),e.points.map(t=>new Vector2(t.x,t.y)),e.closed)}}kite.register("Subpath",Subpath);const Subpath$1=Subpath,randomSource=Math.random,v=(o,e)=>new Vector2(o,e),weightedSplineVector=(o,e,t,n)=>t.copy().subtract(o).multiplyScalar((1-n)/6).add(e),ut=class ut{constructor(e,t){if(this.subpaths=[],this._invalidatingPoints=!1,this._immutable=!1,this.invalidatedEmitter=new TinyEmitter,this.lastQuadraticControlPoint=null,this.lastCubicControlPoint=null,this._bounds=t?t.copy():null,this.resetControlPoints(),this._invalidateListener=this.invalidate.bind(this),typeof e=="object")for(let n=0;n<e.length;n++)this.addSubpath(e[n]);e&&typeof e!="object"&&_.each(svgPath.parse(e),n=>{assert&&assert(ut.prototype[n.cmd]!==void 0,`method ${n.cmd} from parsed SVG does not exist`),this[n.cmd].apply(this,n.args)}),this.invalidate()}resetControlPoints(){this.lastQuadraticControlPoint=null,this.lastCubicControlPoint=null}setQuadraticControlPoint(e){this.lastQuadraticControlPoint=e,this.lastCubicControlPoint=null}setCubicControlPoint(e){this.lastQuadraticControlPoint=null,this.lastCubicControlPoint=e}moveTo(e,t){return assert&&assert(isFinite(e),`x must be a finite number: ${e}`),assert&&assert(isFinite(t),`y must be a finite number: ${t}`),this.moveToPoint(v(e,t))}moveToRelative(e,t){return assert&&assert(isFinite(e),`x must be a finite number: ${e}`),assert&&assert(isFinite(t),`y must be a finite number: ${t}`),this.moveToPointRelative(v(e,t))}moveToPointRelative(e){return this.moveToPoint(this.getRelativePoint().plus(e))}moveToPoint(e){return this.addSubpath(new Subpath$1().addPoint(e)),this.resetControlPoints(),this}lineTo(e,t){return assert&&assert(isFinite(e),`x must be a finite number: ${e}`),assert&&assert(isFinite(t),`y must be a finite number: ${t}`),this.lineToPoint(v(e,t))}lineToRelative(e,t){return assert&&assert(isFinite(e),`x must be a finite number: ${e}`),assert&&assert(isFinite(t),`y must be a finite number: ${t}`),this.lineToPointRelative(v(e,t))}lineToPointRelative(e){return this.lineToPoint(this.getRelativePoint().plus(e))}lineToPoint(e){if(this.hasSubpaths()){const t=this.getLastSubpath().getLastPoint(),n=e,r=new Line$1(t,n);this.getLastSubpath().addPoint(n),this.addSegmentAndBounds(r)}else this.ensure(e);return this.resetControlPoints(),this}horizontalLineTo(e){return this.lineTo(e,this.getRelativePoint().y)}horizontalLineToRelative(e){return this.lineToRelative(e,0)}verticalLineTo(e){return this.lineTo(this.getRelativePoint().x,e)}verticalLineToRelative(e){return this.lineToRelative(0,e)}zigZagTo(e,t,n,r,s){return this.zigZagToPoint(new Vector2(e,t),n,r,s)}zigZagToPoint(e,t,n,r){assert&&assert(Number.isInteger(n),`numberZigZags must be an integer: ${n}`),this.ensure(e);const s=this.getLastPoint(),a=e.minus(s),h=a.normalized(),c=h.perpendicular.times(t);let d;r?d=a.magnitude/(n+.5):d=a.magnitude/n;for(let y=0;y<n;y++){const g=h.times(y*d).plus(s),D=g.plus(h.times(d/4)).plus(c),O=g.plus(h.times(3*d/4)).minus(c);this.lineToPoint(D),this.lineToPoint(O)}if(r){const g=h.times(n*d).plus(s).plus(h.times(d/4)).plus(c);this.lineToPoint(g)}return this.lineToPoint(e)}quadraticCurveTo(e,t,n,r){return assert&&assert(isFinite(e),`cpx must be a finite number: ${e}`),assert&&assert(isFinite(t),`cpy must be a finite number: ${t}`),assert&&assert(isFinite(n),`x must be a finite number: ${n}`),assert&&assert(isFinite(r),`y must be a finite number: ${r}`),this.quadraticCurveToPoint(v(e,t),v(n,r))}quadraticCurveToRelative(e,t,n,r){return assert&&assert(isFinite(e),`cpx must be a finite number: ${e}`),assert&&assert(isFinite(t),`cpy must be a finite number: ${t}`),assert&&assert(isFinite(n),`x must be a finite number: ${n}`),assert&&assert(isFinite(r),`y must be a finite number: ${r}`),this.quadraticCurveToPointRelative(v(e,t),v(n,r))}quadraticCurveToPointRelative(e,t){const n=this.getRelativePoint();return this.quadraticCurveToPoint(n.plus(e),n.plus(t))}smoothQuadraticCurveTo(e,t){return assert&&assert(isFinite(e),`x must be a finite number: ${e}`),assert&&assert(isFinite(t),`y must be a finite number: ${t}`),this.quadraticCurveToPoint(this.getSmoothQuadraticControlPoint(),v(e,t))}smoothQuadraticCurveToRelative(e,t){return assert&&assert(isFinite(e),`x must be a finite number: ${e}`),assert&&assert(isFinite(t),`y must be a finite number: ${t}`),this.quadraticCurveToPoint(this.getSmoothQuadraticControlPoint(),v(e,t).plus(this.getRelativePoint()))}quadraticCurveToPoint(e,t){this.ensure(e);const n=this.getLastSubpath().getLastPoint(),r=new Quadratic(n,e,t);this.getLastSubpath().addPoint(t);const s=r.getNondegenerateSegments();return _.each(s,a=>{this.addSegmentAndBounds(a)}),this.setQuadraticControlPoint(e),this}cubicCurveTo(e,t,n,r,s,a){return assert&&assert(isFinite(e),`cp1x must be a finite number: ${e}`),assert&&assert(isFinite(t),`cp1y must be a finite number: ${t}`),assert&&assert(isFinite(n),`cp2x must be a finite number: ${n}`),assert&&assert(isFinite(r),`cp2y must be a finite number: ${r}`),assert&&assert(isFinite(s),`x must be a finite number: ${s}`),assert&&assert(isFinite(a),`y must be a finite number: ${a}`),this.cubicCurveToPoint(v(e,t),v(n,r),v(s,a))}cubicCurveToRelative(e,t,n,r,s,a){return assert&&assert(isFinite(e),`cp1x must be a finite number: ${e}`),assert&&assert(isFinite(t),`cp1y must be a finite number: ${t}`),assert&&assert(isFinite(n),`cp2x must be a finite number: ${n}`),assert&&assert(isFinite(r),`cp2y must be a finite number: ${r}`),assert&&assert(isFinite(s),`x must be a finite number: ${s}`),assert&&assert(isFinite(a),`y must be a finite number: ${a}`),this.cubicCurveToPointRelative(v(e,t),v(n,r),v(s,a))}cubicCurveToPointRelative(e,t,n){const r=this.getRelativePoint();return this.cubicCurveToPoint(r.plus(e),r.plus(t),r.plus(n))}smoothCubicCurveTo(e,t,n,r){return assert&&assert(isFinite(e),`cp2x must be a finite number: ${e}`),assert&&assert(isFinite(t),`cp2y must be a finite number: ${t}`),assert&&assert(isFinite(n),`x must be a finite number: ${n}`),assert&&assert(isFinite(r),`y must be a finite number: ${r}`),this.cubicCurveToPoint(this.getSmoothCubicControlPoint(),v(e,t),v(n,r))}smoothCubicCurveToRelative(e,t,n,r){return assert&&assert(isFinite(e),`cp2x must be a finite number: ${e}`),assert&&assert(isFinite(t),`cp2y must be a finite number: ${t}`),assert&&assert(isFinite(n),`x must be a finite number: ${n}`),assert&&assert(isFinite(r),`y must be a finite number: ${r}`),this.cubicCurveToPoint(this.getSmoothCubicControlPoint(),v(e,t).plus(this.getRelativePoint()),v(n,r).plus(this.getRelativePoint()))}cubicCurveToPoint(e,t,n){this.ensure(e);const r=this.getLastSubpath().getLastPoint(),a=new Cubic(r,e,t,n).getNondegenerateSegments();return _.each(a,h=>{this.addSegmentAndBounds(h)}),this.getLastSubpath().addPoint(n),this.setCubicControlPoint(t),this}arc(e,t,n,r,s,a){return assert&&assert(isFinite(e),`centerX must be a finite number: ${e}`),assert&&assert(isFinite(t),`centerY must be a finite number: ${t}`),this.arcPoint(v(e,t),n,r,s,a)}arcPoint(e,t,n,r,s){s===void 0&&(s=!1);const a=new Arc(e,t,n,r,s),h=a.getStart(),c=a.getEnd();return this.hasSubpaths()&&this.getLastSubpath().getLength()>0&&!h.equals(this.getLastSubpath().getLastPoint())&&this.addSegmentAndBounds(new Line$1(this.getLastSubpath().getLastPoint(),h)),this.hasSubpaths()||this.addSubpath(new Subpath$1),this.getLastSubpath().addPoint(h),this.getLastSubpath().addPoint(c),this.addSegmentAndBounds(a),this.resetControlPoints(),this}ellipticalArc(e,t,n,r,s,a,h,c){return assert&&assert(isFinite(e),`centerX must be a finite number: ${e}`),assert&&assert(isFinite(t),`centerY must be a finite number: ${t}`),this.ellipticalArcPoint(v(e,t),n,r,s,a,h,c)}ellipticalArcPoint(e,t,n,r,s,a,h){h===void 0&&(h=!1);const c=new EllipticalArc(e,t,n,r,s,a,h),d=c.start,y=c.end;return this.hasSubpaths()&&this.getLastSubpath().getLength()>0&&!d.equals(this.getLastSubpath().getLastPoint())&&this.addSegmentAndBounds(new Line$1(this.getLastSubpath().getLastPoint(),d)),this.hasSubpaths()||this.addSubpath(new Subpath$1),this.getLastSubpath().addPoint(d),this.getLastSubpath().addPoint(y),this.addSegmentAndBounds(c),this.resetControlPoints(),this}close(){if(this.hasSubpaths()){const e=this.getLastSubpath(),t=new Subpath$1;e.close(),this.addSubpath(t),t.addPoint(e.getFirstPoint())}return this.resetControlPoints(),this}newSubpath(){return this.addSubpath(new Subpath$1),this.resetControlPoints(),this}makeImmutable(){return this._immutable=!0,this.notifyInvalidationListeners(),this}isImmutable(){return this._immutable}ellipticalArcToRelative(e,t,n,r,s,a,h){const c=this.getRelativePoint();return this.ellipticalArcTo(e,t,n,r,s,a+c.x,h+c.y)}ellipticalArcTo(e,t,n,r,s,a,h){const c=new Vector2(a,h);this.ensure(c);const d=this.getLastSubpath().getLastPoint();this.getLastSubpath().addPoint(c),e<0&&(e*=-1),t<0&&(t*=-1);let y=e*e,g=t*t;const D=d.minus(c).dividedScalar(2).rotated(-n),O=D.x*D.x,V=D.y*D.y;let k=new Vector2(e*D.y/t,-t*D.x/e);const M=O/y+V/g;M>1&&(e*=Math.sqrt(M),t*=Math.sqrt(M),y=e*e,g=t*t,k=new Vector2(e*D.y/t,-t*D.x/e)),k.multiplyScalar(Math.sqrt(Math.max(0,(y*g-y*V-g*O)/(y*V+g*O)))),r===s&&k.multiplyScalar(-1);const N=d.blend(c,.5).plus(k.rotated(n)),F=(oe,le)=>(oe.x*le.y-oe.y*le.x>0?1:-1)*oe.angleBetween(le),G=new Vector2((D.x-k.x)/e,(D.y-k.y)/t),ie=new Vector2((-D.x-k.x)/e,(-D.y-k.y)/t),Z=F(Vector2.X_UNIT,G);let W=F(G,ie)%(Math.PI*2);!s&&W>0&&(W-=Math.PI*2),s&&W<0&&(W+=Math.PI*2);const J=new EllipticalArc(N,e,t,n,Z,Z+W,!s).getNondegenerateSegments();return _.each(J,oe=>{this.addSegmentAndBounds(oe)}),this}circle(e,t,n){if(typeof e=="object"){const r=e;return n=t,this.arcPoint(r,n,0,Math.PI*2,!1).close()}else return assert&&assert(isFinite(e),`centerX must be a finite number: ${e}`),assert&&assert(isFinite(t),`centerY must be a finite number: ${t}`),this.arcPoint(v(e,t),n,0,Math.PI*2,!1).close()}ellipse(e,t,n,r,s){if(typeof e=="object"){const a=e;return s=r,r=n,n=t,this.ellipticalArcPoint(a,n,r,s||0,0,Math.PI*2,!1).close()}else return assert&&assert(isFinite(e),`centerX must be a finite number: ${e}`),assert&&assert(isFinite(t),`centerY must be a finite number: ${t}`),this.ellipticalArcPoint(v(e,t),n,r,s||0,0,Math.PI*2,!1).close()}rect(e,t,n,r){assert&&assert(isFinite(e),`x must be a finite number: ${e}`),assert&&assert(isFinite(t),`y must be a finite number: ${t}`),assert&&assert(isFinite(n),`width must be a finite number: ${n}`),assert&&assert(isFinite(r),`height must be a finite number: ${r}`);const s=new Subpath$1;return this.addSubpath(s),s.addPoint(v(e,t)),s.addPoint(v(e+n,t)),s.addPoint(v(e+n,t+r)),s.addPoint(v(e,t+r)),this.addSegmentAndBounds(new Line$1(s.points[0],s.points[1])),this.addSegmentAndBounds(new Line$1(s.points[1],s.points[2])),this.addSegmentAndBounds(new Line$1(s.points[2],s.points[3])),s.close(),this.addSubpath(new Subpath$1),this.getLastSubpath().addPoint(v(e,t)),assert&&assert(!isNaN(this.bounds.getX())),this.resetControlPoints(),this}roundRect(e,t,n,r,s,a){const h=e+s,c=e+n-s,d=t+a,y=t+r-a;return s===a?this.arc(c,d,s,-Math.PI/2,0,!1).arc(c,y,s,0,Math.PI/2,!1).arc(h,y,s,Math.PI/2,Math.PI,!1).arc(h,d,s,Math.PI,Math.PI*3/2,!1).close():this.ellipticalArc(c,d,s,a,0,-Math.PI/2,0,!1).ellipticalArc(c,y,s,a,0,0,Math.PI/2,!1).ellipticalArc(h,y,s,a,0,Math.PI/2,Math.PI,!1).ellipticalArc(h,d,s,a,0,Math.PI,Math.PI*3/2,!1).close(),this}polygon(e){const t=e.length;if(t>0){this.moveToPoint(e[0]);for(let n=1;n<t;n++)this.lineToPoint(e[n])}return this.close()}cardinalSpline(e,t){const n=optionize()({tension:0,isClosedLineSegments:!1},t);assert&&assert(n.tension<1&&n.tension>-1," the tension goes from -1 to 1 ");const r=e.length,s=n.isClosedLineSegments?r:r-1;for(let a=0;a<s;a++){let h;a===0&&!n.isClosedLineSegments?h=[e[0],e[0],e[1],e[2]]:a===s-1&&!n.isClosedLineSegments?h=[e[a-1],e[a],e[a+1],e[a+1]]:h=[e[(a-1+r)%r],e[a%r],e[(a+1)%r],e[(a+2)%r]];const c=[h[1],weightedSplineVector(h[0],h[1],h[2],n.tension),weightedSplineVector(h[3],h[2],h[1],n.tension),h[2]];a===0&&(this.ensure(c[0]),this.getLastSubpath().addPoint(c[0])),this.cubicCurveToPoint(c[1],c[2],c[3])}return this}copy(){return new ut(_.map(this.subpaths,e=>e.copy()),this.bounds)}writeToContext(e){const t=this.subpaths.length;for(let n=0;n<t;n++)this.subpaths[n].writeToContext(e)}getSVGPath(){let e="";const t=this.subpaths.length;for(let n=0;n<t;n++){const r=this.subpaths[n];if(r.isDrawable()){const s=r.segments[0].start;e+=`M ${svgNumber(s.x)} ${svgNumber(s.y)} `;for(let a=0;a<r.segments.length;a++)e+=`${r.segments[a].getSVGPathFragment()} `;r.isClosed()&&(e+="Z ")}}return e}getSVGPathWithSafariWorkaround(){let e="";const t=this.subpaths.length;for(let n=0;n<t;n++){const r=this.subpaths[n];if(r.isDrawable()){const s=r.segments[0].start;e+=`M ${svgNumber(s.x)} ${svgNumber(s.y)} `;for(let a=0;a<r.segments.length;a++){const h=r.segments[a];if(h instanceof Quadratic){const c=h.start,d=h.control,y=h.end,g=(c.x+d.x)/2,D=(c.y+d.y)/2,O=(d.x+y.x)/2,V=(d.y+y.y)/2,k=(g+O)/2,M=(D+V)/2;e+=`Q ${svgNumber(g)} ${svgNumber(D)} ${svgNumber(k)} ${svgNumber(M)} `,e+=`Q ${svgNumber(O)} ${svgNumber(V)} ${svgNumber(y.x)} ${svgNumber(y.y)} `}else e+=`${r.segments[a].getSVGPathFragment()} `}r.isClosed()&&(e+="Z ")}}return e}transformed(e){const t=_.map(this.subpaths,r=>r.transformed(e)),n=_.reduce(t,(r,s)=>r.union(s.bounds),Bounds2.NOTHING);return new ut(t,n)}nonlinearTransformed(e){const t=combineOptions({minLevels:0,maxLevels:7,distanceEpsilon:.16,curveEpsilon:e&&e.includeCurvature?.002:null},e),n=_.map(this.subpaths,s=>s.nonlinearTransformed(t)),r=_.reduce(n,(s,a)=>s.union(a.bounds),Bounds2.NOTHING);return new ut(n,r)}polarToCartesian(e){return this.nonlinearTransformed(combineOptions({pointMap:t=>Vector2.createPolar(t.y,t.x),methodName:"polarToCartesian"},e))}toPiecewiseLinear(e){return assert&&assert(!e||!e.pointMap,"No pointMap for toPiecewiseLinear allowed, since it could create non-linear segments"),assert&&assert(!e||!e.methodName,"No methodName for toPiecewiseLinear allowed, since it could create non-linear segments"),this.nonlinearTransformed(e)}containsPoint(e){const t=Vector2.X_UNIT.copy();let n=0;for(;n<5&&(n++,_.some(this.subpaths,s=>_.some(s.segments,a=>{const h=a.start.minus(e),c=h.magnitude;return c!==0?(h.divideScalar(c),h.subtract(t),h.magnitudeSquared<1e-9):!1})));)t.rotate(dotRandom.nextDouble());return this.windingIntersection(new Ray2(e,t))!==0}intersection(e){let t=[];const n=this.subpaths.length;for(let r=0;r<n;r++){const s=this.subpaths[r];if(s.isDrawable()){const a=s.segments.length;for(let h=0;h<a;h++){const c=s.segments[h];t=t.concat(c.intersection(e))}s.hasClosingSegment()&&(t=t.concat(s.getClosingSegment().intersection(e)))}}return _.sortBy(t,r=>r.distance)}interiorIntersectsLineSegment(e,t){const n=e.blend(t,.5);if(this.containsPoint(n))return!0;const r=t.minus(e),s=r.magnitude;if(s===0)return!1;r.normalize();const a=this.intersection(new Ray2(e,r));for(let h=0;h<a.length;h++)if(a[h].distance<=s)return!0;return!1}windingIntersection(e){let t=0;const n=this.subpaths.length;for(let r=0;r<n;r++){const s=this.subpaths[r];if(s.isDrawable()){const a=s.segments.length;for(let h=0;h<a;h++)t+=s.segments[h].windingIntersection(e);s.hasClosingSegment()&&(t+=s.getClosingSegment().windingIntersection(e))}}return t}intersectsBounds(e){if(this.bounds.intersection(e).equals(this.bounds))return!0;const t=new Ray2(new Vector2(e.minX,e.minY),new Vector2(1,0)),n=new Ray2(new Vector2(e.minX,e.minY),new Vector2(0,1)),r=new Ray2(new Vector2(e.maxX,e.maxY),new Vector2(-1,0)),s=new Ray2(new Vector2(e.maxX,e.maxY),new Vector2(0,-1));let a,h;const c=this.intersection(t).concat(this.intersection(r));for(h=0;h<c.length;h++)if(a=c[h].point,a.x>=e.minX&&a.x<=e.maxX)return!0;const d=this.intersection(n).concat(this.intersection(s));for(h=0;h<d.length;h++)if(a=d[h].point,a.y>=e.minY&&a.y<=e.maxY)return!0;return!1}getStrokedShape(e){let t=[];const n=Bounds2.NOTHING.copy();let r=this.subpaths.length;for(let s=0;s<r;s++){const h=this.subpaths[s].stroked(e);t=t.concat(h)}r=t.length;for(let s=0;s<r;s++)n.includeBounds(t[s].bounds);return new ut(t,n)}getOffsetShape(e){const t=[],n=Bounds2.NOTHING.copy();let r=this.subpaths.length;for(let s=0;s<r;s++)t.push(this.subpaths[s].offset(e));r=t.length;for(let s=0;s<r;s++)n.includeBounds(t[s].bounds);return new ut(t,n)}getDashedShape(e,t,n){const r=optionize()({distanceEpsilon:1e-10,curveEpsilon:1e-8},n);return new ut(_.flatten(this.subpaths.map(s=>s.dashed(e,t,r.distanceEpsilon,r.curveEpsilon))))}getBounds(){if(this._bounds===null){const e=Bounds2.NOTHING.copy();_.each(this.subpaths,t=>{e.includeBounds(t.getBounds())}),this._bounds=e}return this._bounds}get bounds(){return this.getBounds()}getStrokedBounds(e){let t=!0;for(let n=0;n<this.subpaths.length;n++){const r=this.subpaths[n];if(r.isDrawable()&&!r.isClosed()){t=!1;break}for(let s=0;s<r.segments.length;s++)if(!r.segments[s].areStrokedBoundsDilated()){t=!1;break}}if(t)return this.bounds.dilated(e.lineWidth/2);{const n=this.bounds.copy();for(let r=0;r<this.subpaths.length;r++){const s=this.subpaths[r].stroked(e);for(let a=0;a<s.length;a++)n.includeBounds(s[a].bounds)}return n}}getSimplifiedAreaShape(){return Graph$1.simplifyNonZero(this)}getBoundsWithTransform(e,t){const n=Bounds2.NOTHING.copy(),r=this.subpaths.length;for(let s=0;s<r;s++){const a=this.subpaths[s];n.includeBounds(a.getBoundsWithTransform(e))}return t&&n.includeBounds(this.getStrokedShape(t).getBoundsWithTransform(e)),n}getApproximateArea(e){const t=this.bounds.minX,n=this.bounds.minY,r=this.bounds.width,s=this.bounds.height,a=r*s;let h=0;const c=new Vector2(0,0);for(let d=0;d<e;d++)c.x=t+randomSource()*r,c.y=n+randomSource()*s,this.containsPoint(c)&&h++;return a*h/e}getNonoverlappingArea(){return Math.abs(_.sum(this.subpaths.map(e=>_.sum(e.getFillSegments().map(t=>t.getSignedAreaFragment())))))}getArea(){return this.getSimplifiedAreaShape().getNonoverlappingArea()}getApproximateCentroid(e){const t=this.bounds.minX,n=this.bounds.minY,r=this.bounds.width,s=this.bounds.height;let a=0;const h=new Vector2(0,0),c=new Vector2(0,0);for(let d=0;d<e;d++)c.x=t+randomSource()*r,c.y=n+randomSource()*s,this.containsPoint(c)&&(h.add(c),a++);return h.dividedScalar(a)}getClosestPoints(e){return Segment.filterClosestToPointResult(_.flatten(this.subpaths.map(t=>t.getClosestPoints(e))))}getClosestPoint(e){return this.getClosestPoints(e)[0].closestPoint}invalidatePoints(){this._invalidatingPoints=!0;const e=this.subpaths.length;for(let t=0;t<e;t++)this.subpaths[t].invalidatePoints();this._invalidatingPoints=!1,this.invalidate()}toString(){return`new phet.kite.Shape( '${this.getSVGPath()}' )`}invalidate(){assert&&assert(!this._immutable,"Attempt to modify an immutable Shape"),this._invalidatingPoints||(this._bounds=null,this.notifyInvalidationListeners())}notifyInvalidationListeners(){this.invalidatedEmitter.emit()}addSegmentAndBounds(e){this.getLastSubpath().addSegment(e),this.invalidate()}ensure(e){this.hasSubpaths()||(this.addSubpath(new Subpath$1),this.getLastSubpath().addPoint(e))}addSubpath(e){return this.subpaths.push(e),e.invalidatedEmitter.addListener(this._invalidateListener),this.invalidate(),this}hasSubpaths(){return this.subpaths.length>0}getLastSubpath(){return assert&&assert(this.hasSubpaths(),"We should have a subpath if this is called"),_.last(this.subpaths)}getLastPoint(){return assert&&assert(this.hasSubpaths(),"We should have a subpath if this is called"),assert&&assert(this.getLastSubpath().getLastPoint(),"We should have a last point"),this.getLastSubpath().getLastPoint()}getLastSegment(){if(!this.hasSubpaths())return null;const e=this.getLastSubpath();return e.isDrawable()?e.getLastSegment():null}getSmoothQuadraticControlPoint(){const e=this.getLastPoint();return this.lastQuadraticControlPoint?e.plus(e.minus(this.lastQuadraticControlPoint)):e}getSmoothCubicControlPoint(){const e=this.getLastPoint();return this.lastCubicControlPoint?e.plus(e.minus(this.lastCubicControlPoint)):e}getRelativePoint(){let e=Vector2.ZERO;if(this.hasSubpaths()){const t=this.getLastSubpath();t.points.length&&(e=t.getLastPoint())}return e}shapeUnion(e){return Graph$1.binaryResult(this,e,Graph$1.BINARY_NONZERO_UNION)}shapeIntersection(e){return Graph$1.binaryResult(this,e,Graph$1.BINARY_NONZERO_INTERSECTION)}shapeDifference(e){return Graph$1.binaryResult(this,e,Graph$1.BINARY_NONZERO_DIFFERENCE)}shapeXor(e){return Graph$1.binaryResult(this,e,Graph$1.BINARY_NONZERO_XOR)}shapeClip(e,t){return Graph$1.clipShape(e,this,t)}getArcLength(e,t,n){let r=0;for(let s=0;s<this.subpaths.length;s++)r+=this.subpaths[s].getArcLength(e,t,n);return r}serialize(){return{type:"Shape",subpaths:this.subpaths.map(e=>e.serialize())}}static deserialize(e){return assert&&assert(e.type==="Shape"),new ut(e.subpaths.map(Subpath$1.deserialize))}static rectangle(e,t,n,r){return new ut().rect(e,t,n,r)}static roundRect(e,t,n,r,s,a){return new ut().roundRect(e,t,n,r,s,a)}static roundedRectangleWithRadii(e,t,n,r,s){let a=s&&s.topLeft||0,h=s&&s.topRight||0,c=s&&s.bottomLeft||0,d=s&&s.bottomRight||0;assert&&assert(isFinite(e),"Non-finite x"),assert&&assert(isFinite(t),"Non-finite y"),assert&&assert(n>=0&&isFinite(n),"Negative or non-finite width"),assert&&assert(r>=0&&isFinite(r),"Negative or non-finite height"),assert&&assert(a>=0&&isFinite(a),"Invalid topLeft"),assert&&assert(h>=0&&isFinite(h),"Invalid topRight"),assert&&assert(c>=0&&isFinite(c),"Invalid bottomLeft"),assert&&assert(d>=0&&isFinite(d),"Invalid bottomRight");const y=a+h;y>n&&y>0&&(a=a/y*n,h=h/y*n);const g=c+d;g>n&&g>0&&(c=c/g*n,d=d/g*n);const D=a+c;D>r&&D>0&&(a=a/D*r,c=c/D*r);const O=h+d;O>r&&O>0&&(h=h/O*r,d=d/O*r),assert&&assert(a+h<=n,"Corner overlap on top edge"),assert&&assert(c+d<=n,"Corner overlap on bottom edge"),assert&&assert(a+c<=r,"Corner overlap on left edge"),assert&&assert(h+d<=r,"Corner overlap on right edge");const V=new ut,k=e+n,M=t+r;return d>0?V.arc(k-d,M-d,d,0,Math.PI/2,!1):V.moveTo(k,M),c>0?V.arc(e+c,M-c,c,Math.PI/2,Math.PI,!1):V.lineTo(e,M),a>0?V.arc(e+a,t+a,a,Math.PI,3*Math.PI/2,!1):V.lineTo(e,t),h>0?V.arc(k-h,t+h,h,3*Math.PI/2,2*Math.PI,!1):V.lineTo(k,t),V.close(),V}static boundsOffsetWithRadii(e,t,n){const r=e.withOffsets(t.left,t.top,t.right,t.bottom);return ut.roundedRectangleWithRadii(r.minX,r.minY,r.width,r.height,n)}static polygon(e){return new ut().polygon(e)}static bounds(e){return new ut().rect(e.minX,e.minY,e.maxX-e.minX,e.maxY-e.minY)}static lineSegment(e,t,n,r){return typeof e=="number"?new ut().moveTo(e,t).lineTo(n,r):new ut().moveToPoint(e).lineToPoint(t)}static regularPolygon(e,t){const n=new ut;return _.each(_.range(e),r=>{const s=Vector2.createPolar(t,2*Math.PI*r/e);r===0?n.moveToPoint(s):n.lineToPoint(s)}),n.close()}static circle(e,t,n){return t===void 0?new ut().circle(0,0,e):new ut().circle(e,t,n)}static ellipse(e,t,n,r,s){return r===void 0?new ut().ellipse(0,0,e,t,n):new ut().ellipse(e,t,n,r,s)}static arc(e,t,n,r,s,a){return new ut().arc(e,t,n,r,s,a)}static union(e){return Graph$1.unionNonZero(e)}static intersection(e){return Graph$1.intersectionNonZero(e)}static xor(e){return Graph$1.xorNonZero(e)}static segments(e,t){if(assert)for(let n=1;n<e.length;n++)assert(e[n-1].end.equalsEpsilon(e[n].start,1e-6),"Mismatched start/end");return new ut([new Subpath$1(e,void 0,!!t)])}};ut.rect=ut.rectangle,ut.roundRectangle=ut.roundRect;let Shape=ut;kite.register("Shape",Shape);const Shape$1=Shape;let globaId$5=0;const ns=class ns{constructor(e,t){this.id=++globaId$5,this.initialize(e,t)}initialize(e,t){return assert&&assert(e instanceof kite.Edge),assert&&assert(typeof t=="boolean"),this.edge=e,this.face=null,this.isReversed=t,this.signedAreaFragment=e.signedAreaFragment*(t?-1:1),this.startVertex=null,this.endVertex=null,this.sortVector=this.sortVector||new Vector2(0,0),this.data=null,this.updateReferences(),this}serialize(){return{type:"HalfEdge",id:this.id,edge:this.edge.id,face:this.face===null?null:this.face.id,isReversed:this.isReversed,signedAreaFragment:this.signedAreaFragment,startVertex:this.startVertex===null?null:this.startVertex.id,endVertex:this.endVertex===null?null:this.endVertex.id,sortVector:Vector2.Vector2IO.toStateObject(this.sortVector),data:this.data}}dispose(){this.edge=null,this.face=null,this.startVertex=null,this.endVertex=null,this.data=null,this.freeToPool()}getNext(e){for(let t=1;;t++){let n=this.endVertex.incidentHalfEdges.indexOf(this)-t;n<0&&(n+=this.endVertex.incidentHalfEdges.length);const r=this.endVertex.incidentHalfEdges[n].getReversed();if(!(e&&!e(r.edge)))return assert&&assert(this.endVertex===r.startVertex),r}}updateReferences(){this.startVertex=this.isReversed?this.edge.endVertex:this.edge.startVertex,this.endVertex=this.isReversed?this.edge.startVertex:this.edge.endVertex,assert&&assert(this.startVertex),assert&&assert(this.endVertex)}getEndTangent(){return this.isReversed?this.edge.segment.startTangent:this.edge.segment.endTangent.negated()}getEndCurvature(){return this.isReversed?-this.edge.segment.curvatureAt(0):this.edge.segment.curvatureAt(1)}getReversed(){return this.isReversed?this.edge.forwardHalf:this.edge.reversedHalf}getDirectionalSegment(){return this.isReversed?this.edge.segment.reversed():this.edge.segment}freeToPool(){ns.pool.freeToPool(this)}};ce(ns,"pool",new Pool(ns));let HalfEdge=ns;kite.register("HalfEdge",HalfEdge);let globaId$4=0;const Fi=class Fi{constructor(e){this.id=++globaId$4,this.initialize(e)}initialize(e){return assert&&assert(e instanceof Vector2),this.point=e,this.incidentHalfEdges=cleanArray(this.incidentHalfEdges),this.visited=!1,this.visitIndex=0,this.lowIndex=0,this.data=null,this.internalData={},this}serialize(){return{type:"Vertex",id:this.id,point:Vector2.Vector2IO.toStateObject(this.point),incidentHalfEdges:this.incidentHalfEdges.map(e=>e.id),visited:this.visited,visitIndex:this.visitIndex,lowIndex:this.lowIndex}}dispose(){this.point=Vector2.ZERO,cleanArray(this.incidentHalfEdges),this.freeToPool()}sortEdges(){const e=[];for(let r=0;r<this.incidentHalfEdges.length;r++){const s=this.incidentHalfEdges[r];e.push(s.sortVector.setXY(s.getEndTangent().angle,s.getEndCurvature()))}const t=-Math.PI+1e-4;let n=!1;for(;!n;){n=!0;for(let r=0;r<e.length;r++)e[r].x<t&&(n=!1);if(!n)for(let r=0;r<e.length;r++){const s=e[r];s.x-=1.62594024516,s.x<-Math.PI-1e-4&&(s.x+=Math.PI*2)}}this.incidentHalfEdges.sort(Fi.edgeComparison)}static edgeComparison(e,t){const n=e.sortVector.x,r=t.sortVector.x;if(Math.abs(n-r)>1e-5||n!==r&&e.edge.segment instanceof Line$1&&t.edge.segment instanceof Line$1)return n<r?-1:1;{const s=e.sortVector.y,a=t.sortVector.y;if(Math.abs(s-a)>1e-5)return s<a?1:-1;{const c=e.getDirectionalSegment().subdivided(.999)[1].curvatureAt(0),d=t.getDirectionalSegment().subdivided(.999)[1].curvatureAt(0);return c<d?1:-1}}}freeToPool(){Fi.pool.freeToPool(this)}};ce(Fi,"pool",new Pool(Fi));let Vertex=Fi;kite.register("Vertex",Vertex);let globaId$3=0;const rs=class rs{constructor(e,t,n){this.id=++globaId$3,this.initialize(e,t,n)}initialize(e,t,n){return assert&&assert(e instanceof Segment),assert&&assert(t instanceof Vertex),assert&&assert(n instanceof Vertex),assert&&assert(e.start.distance(t.point)<.001),assert&&assert(e.end.distance(n.point)<.001),this.segment=e,this.startVertex=t,this.endVertex=n,this.signedAreaFragment=e.getSignedAreaFragment(),this.forwardHalf=HalfEdge.pool.create(this,!1),this.reversedHalf=HalfEdge.pool.create(this,!0),this.visited=!1,this.data=null,this.internalData={},this}serialize(){return{type:"Edge",id:this.id,segment:this.segment.serialize(),startVertex:this.startVertex===null?null:this.startVertex.id,endVertex:this.endVertex===null?null:this.endVertex.id,signedAreaFragment:this.signedAreaFragment,forwardHalf:this.forwardHalf.serialize(),reversedHalf:this.reversedHalf.serialize(),visited:this.visited,data:this.data}}dispose(){this.segment=null,this.startVertex=null,this.endVertex=null,this.forwardHalf.dispose(),this.reversedHalf.dispose(),this.forwardHalf=null,this.reversedHalf=null,this.data=null,this.freeToPool()}getOtherVertex(e){return assert&&assert(e===this.startVertex||e===this.endVertex),this.startVertex===e?this.endVertex:this.startVertex}updateReferences(){this.forwardHalf.updateReferences(),this.reversedHalf.updateReferences(),assert&&assert(!(this.segment instanceof Line$1)||this.startVertex!==this.endVertex,"No line segments for same vertices")}freeToPool(){rs.pool.freeToPool(this)}};ce(rs,"pool",new Pool(rs));let Edge=rs;kite.register("Edge",Edge);let globaId$2=0;const os=class os{constructor(e){this.id=++globaId$2,this.initialize(e)}initialize(e){return assert&&assert(e===null||e.isInner()),this.boundary=e,this.holes=cleanArray(this.holes),this.windingMap=null,this.filled=null,e&&this.addBoundaryFaceReferences(e),this}serialize(){return{type:"Face",id:this.id,boundary:this.boundary===null?null:this.boundary.id,holes:this.holes.map(e=>e.id),windingMap:this.windingMap,filled:this.filled}}dispose(){this.boundary=null,cleanArray(this.holes),this.windingMap=null,this.filled=null,this.freeToPool()}addBoundaryFaceReferences(e){for(let t=0;t<e.halfEdges.length;t++)assert&&assert(e.halfEdges[t].face===null),e.halfEdges[t].face=this}recursivelyAddHoles(e){assert&&assert(!e.isInner()),this.holes.push(e),this.addBoundaryFaceReferences(e);for(let t=0;t<e.childBoundaries.length;t++)this.recursivelyAddHoles(e.childBoundaries[t])}freeToPool(){os.pool.freeToPool(this)}};ce(os,"pool",new Pool(os));let Face=os;kite.register("Face",Face);let globaId$1=0;const as=class as{constructor(e,t){this.id=++globaId$1,this.initialize(e,t)}initialize(e,t){return assert&&assert(typeof e=="number"),assert&&assert(typeof t=="boolean"),this.shapeId=e,this.closed=t,this.halfEdges=cleanArray(this.halfEdges),this}serialize(){return{type:"Loop",id:this.id,shapeId:this.shapeId,closed:this.closed,halfEdges:this.halfEdges.map(e=>e.id)}}toSubpath(){const e=[];for(let t=0;t<this.halfEdges.length;t++)e.push(this.halfEdges[t].getDirectionalSegment());return new Subpath$1(e,void 0,this.closed)}dispose(){cleanArray(this.halfEdges),this.freeToPool()}freeToPool(){as.pool.freeToPool(this)}};ce(as,"pool",new Pool(as));let Loop=as;kite.register("Loop",Loop);let globaId=0;const ls=class ls{constructor(e){this.id=++globaId,this.initialize(e)}initialize(e){return this.halfEdges=e,this.signedArea=this.computeSignedArea(),this.bounds=this.computeBounds(),this.childBoundaries=cleanArray(this.childBoundaries),this}serialize(){return{type:"Boundary",id:this.id,halfEdges:this.halfEdges.map(e=>e.id),signedArea:this.signedArea,bounds:Bounds2.Bounds2IO.toStateObject(this.bounds),childBoundaries:this.childBoundaries.map(e=>e.id)}}dispose(){this.halfEdges=[],cleanArray(this.childBoundaries),this.freeToPool()}isInner(){return this.signedArea>0}computeSignedArea(){let e=0;for(let t=0;t<this.halfEdges.length;t++)e+=this.halfEdges[t].signedAreaFragment;return e}computeBounds(){const e=Bounds2.NOTHING.copy();for(let t=0;t<this.halfEdges.length;t++)e.includeBounds(this.halfEdges[t].edge.segment.getBounds());return e}computeExtremePoint(e){assert&&assert(this.halfEdges.length>0,"There is no extreme point if we have no edges");const t=[];for(let r=0;r<this.halfEdges.length;r++)t.push(this.halfEdges[r].edge.segment.transformed(e.getMatrix()));const n=Bounds2.NOTHING.copy();for(let r=0;r<t.length;r++)n.includeBounds(t[r].getBounds());for(let r=0;r<t.length;r++){const s=t[r];if(s.getBounds().top===n.top){let a=new Vector2(0,Number.POSITIVE_INFINITY);const h=[0,1].concat(s.getInteriorExtremaTs());for(let c=0;c<h.length;c++){const d=s.positionAt(h[c]);d.y<a.y&&(a=d)}return e.inversePosition2(a)}}throw new Error("Should not reach here if we have segments")}computeExtremeRay(e){const t=this.computeExtremePoint(e),n=e.inverseDelta2(new Vector2(0,-1)).normalized();return new Ray2(t.plus(n.timesScalar(1e-4)),n)}hasHalfEdge(e){for(let t=0;t<this.halfEdges.length;t++)if(this.halfEdges[t]===e)return!0;return!1}toSubpath(){const e=[];for(let t=0;t<this.halfEdges.length;t++)e.push(this.halfEdges[t].getDirectionalSegment());return new Subpath$1(e,null,!0)}freeToPool(){ls.pool.freeToPool(this)}};ce(ls,"pool",new Pool(ls));let Boundary=ls;kite.register("Boundary",Boundary);const _t=class _t{constructor(e,t,n,r,s,a,h,c,d,y){this.initialize(e,t,n,r,s,a,h,c,d,y)}initialize(e,t,n,r,s,a,h,c,d,y){return this.a=e,this.b=t,this.atMin=n,this.atMax=r,this.btMin=s,this.btMax=a,this.aMin=h,this.aMax=c,this.bMin=d,this.bMax=y,this}pushSubdivisions(e){const t=this,n=(t.atMax+t.atMin)/2,r=(t.btMax+t.btMin)/2;if(n===this.atMin||n===this.atMax||r===this.btMin||r===this.btMax){e.push(this);return}const s=t.a.positionAt(n),a=t.b.positionAt(r);_t.boxIntersects(t.aMin,s,t.bMin,a)&&e.push(_t.pool.create(t.a,t.b,t.atMin,n,t.btMin,r,t.aMin,s,t.bMin,a)),_t.boxIntersects(s,t.aMax,t.bMin,a)&&e.push(_t.pool.create(t.a,t.b,n,t.atMax,t.btMin,r,s,t.aMax,t.bMin,a)),_t.boxIntersects(t.aMin,s,a,t.bMax)&&e.push(_t.pool.create(t.a,t.b,t.atMin,n,r,t.btMax,t.aMin,s,a,t.bMax)),_t.boxIntersects(s,t.aMax,a,t.bMax)&&e.push(_t.pool.create(t.a,t.b,n,t.atMax,r,t.btMax,s,t.aMax,a,t.bMax)),this.freeToPool()}distance(e){const t=this.atMin-e.atMin,n=this.atMax-e.atMax,r=this.btMin-e.btMin,s=this.btMax-e.btMax;return t*t+n*n+r*r+s*s}clean(){this.a=null,this.b=null,this.aMin=null,this.aMax=null,this.bMin=null,this.bMax=null}static intersect(e,t){if(!e.bounds.intersectsBounds(t.bounds))return[];const n=_t.getIntersectionRanges(e,t),r=[];for(let a=0;a<n.length;a++){const h=n[a];let c=!1;e:for(let d=0;d<r.length;d++){const y=r[d];for(let g=0;g<y.length;g++){const D=y[g];if(h.distance(D)<1e-13){y.push(h),c=!0;break e}}}c||r.push([h])}const s=[];for(let a=0;a<r.length;a++){const h=r[a];let c=0,d=0;for(let D=0;D<h.length;D++)c+=h[D].atMin+h[D].atMax,d+=h[D].btMin+h[D].btMax;c/=2*h.length,d/=2*h.length;const y=e.positionAt(c),g=t.positionAt(d);assert&&assert(y.distance(g)<1e-10),s.push(new SegmentIntersection(y.average(g),c,d))}for(let a=0;a<n.length;a++)n[a].freeToPool();return _t.cleanPool(),s}static getIntersectionRanges(e,t){const n=e.getInteriorExtremaTs(),r=t.getInteriorExtremaTs(),s=_.zip([0].concat(n),n.concat([1])),a=_.zip([0].concat(r),r.concat([1]));let h=[];for(let c=0;c<s.length;c++)for(let d=0;d<a.length;d++){const y=s[c][0],g=s[c][1],D=a[d][0],O=a[d][1],V=e.positionAt(y),k=e.positionAt(g),M=t.positionAt(D),N=t.positionAt(O);_t.boxIntersects(V,k,M,N)&&h.push(_t.pool.create(e,t,y,g,D,O,V,k,M,N))}for(let c=0;c<50;c++){const d=[];for(let y=h.length-1;y>=0;y--)h[y].pushSubdivisions(d);h=d}return h}static boxIntersects(e,t,n,r){const s=Math.max(Math.min(e.x,t.x),Math.min(n.x,r.x)),a=Math.max(Math.min(e.y,t.y),Math.min(n.y,r.y)),h=Math.min(Math.max(e.x,t.x),Math.max(n.x,r.x)),c=Math.min(Math.max(e.y,t.y),Math.max(n.y,r.y));return h-s>=0&&c-a>=0}static cleanPool(){_t.pool.forEach(e=>e.clean())}freeToPool(){_t.pool.freeToPool(this)}};_t.pool=new Pool(_t);let BoundsIntersection=_t;kite.register("BoundsIntersection",BoundsIntersection);let globalId$8=1;const scratchArray=[];class SegmentTree{constructor(e=1e-6){this.rootNode=SegmentNode.pool.create(this,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY),this.rootNode.isBlack=!0,this.epsilon=e,this.items=new Set}query(e,t){const n=globalId$8++;return this.rootNode?this.rootNode.query(e,this.getMinX(e,this.epsilon),this.getMaxX(e,this.epsilon),n,t):!1}addItem(e){const t=this.getMinX(e,this.epsilon),n=this.getMaxX(e,this.epsilon);this.rootNode.split(t,this),this.rootNode.split(n,this),this.rootNode.addItem(e,t,n),this.items.add(e)}removeItem(e){this.rootNode.removeItem(e,this.getMinX(e,this.epsilon),this.getMaxX(e,this.epsilon)),this.items.delete(e)}audit(){this.rootNode.audit(this.epsilon,this.items,[])}toString(){let e=0,t="";return function n(r){t+=`${_.repeat("  ",e)}${r.toString()}
`,e++,r.hasChildren()&&(n(r.left),n(r.right)),e--}(this.rootNode),t}}const Ii=class Ii{constructor(e,t,n){this.items=[],this.initialize(e,t,n)}initialize(e,t,n){return this.min=t,this.max=n,this.splitValue=null,this.left=null,this.right=null,this.parent=null,this.tree=e,this.isBlack=!1,cleanArray(this.items),this}contains(e){return e>=this.min&&e<=this.max}hasChildren(){return this.splitValue!==null}query(e,t,n,r,s){var h,c;let a=!1;if(this.min<=n&&this.max>=t){for(let d=0;d<this.items.length;d++){const y=this.items[d];if((!((h=y.internalData)!=null&&h.segmentId)||((c=y.internalData)==null?void 0:c.segmentId)<r)&&(y.internalData.segmentId=r,a=s(y),a))return!0}this.hasChildren()&&(a||(a=this.left.query(e,t,n,r,s)),a||(a=this.right.query(e,t,n,r,s)))}return a}swapChild(e,t){assert&&assert(this.left===e||this.right===e),this.left===e?this.left=t:this.right=t}hasChild(e){return this.left===e||this.right===e}otherChild(e){return assert&&assert(this.hasChild(e)),this.left===e?this.right:this.left}leftRotate(e){if(assert&&assert(this.hasChildren()&&this.right.hasChildren()),this.right.hasChildren()){const t=this.right,n=this.left,r=t.left,s=t.right;t.parent=this.parent,this.parent?this.parent.swapChild(this,t):e.rootNode=t,this.parent=t,r.parent=this,t.left=this,this.left=n,this.right=r,this.max=r.max,this.splitValue=n.max,t.min=this.min,t.splitValue=this.max;const a=cleanArray(scratchArray);a.push(...this.items),cleanArray(this.items);for(let h=n.items.length-1;h>=0;h--){const c=n.items[h],d=r.items.indexOf(c);d>=0&&(n.items.splice(h,1),r.items.splice(d,1),this.items.push(c))}r.items.push(...t.items),s.items.push(...t.items),cleanArray(t.items),t.items.push(...a)}}rightRotate(e){assert&&assert(this.hasChildren()&&this.left.hasChildren());const t=this.left,n=this.right,r=t.left,s=t.right;t.parent=this.parent,this.parent?this.parent.swapChild(this,t):e.rootNode=t,this.parent=t,s.parent=this,t.right=this,this.left=s,this.right=n,this.min=s.min,this.splitValue=n.min,t.max=this.max,t.splitValue=this.min;const a=cleanArray(scratchArray);a.push(...this.items),cleanArray(this.items);for(let h=n.items.length-1;h>=0;h--){const c=n.items[h],d=s.items.indexOf(c);d>=0&&(n.items.splice(h,1),s.items.splice(d,1),this.items.push(c))}r.items.push(...t.items),s.items.push(...t.items),cleanArray(t.items),t.items.push(...a)}fixRedBlack(e){if(assert&&assert(!this.isBlack),!this.parent)this.isBlack=!0;else{const t=this.parent;if(!t.isBlack){const n=t.parent,r=n.otherChild(t);r.isBlack?t===n.left?this===t.right?(t.leftRotate(e),t.parent.isBlack=!0,t.parent.parent.isBlack=!1,t.parent.parent.rightRotate(e)):(t.isBlack=!0,n.isBlack=!1,n.rightRotate(e)):this===t.left?(t.rightRotate(e),t.parent.isBlack=!0,t.parent.parent.isBlack=!1,t.parent.parent.leftRotate(e)):(t.isBlack=!0,n.isBlack=!1,n.leftRotate(e)):(t.isBlack=!0,r.isBlack=!0,n.isBlack=!1,n.fixRedBlack(e))}}}split(e,t){if(assert&&assert(this.contains(e)),!(e===this.min||e===this.max))if(this.hasChildren())this.splitValue!==e&&(e>this.splitValue?this.right:this.left).split(e,t);else{this.splitValue=e;const n=Ii.pool.create(this.tree,this.min,e);n.parent=this,this.left=n;const r=Ii.pool.create(this.tree,e,this.max);if(r.parent=this,this.right=r,!this.isBlack&&this.parent){const s=this.parent,a=s.otherChild(this);a.isBlack?(this===s.left?(s.rightRotate(t),n.isBlack=!0):(s.leftRotate(t),r.isBlack=!0),this.fixRedBlack(t)):(this.isBlack=!0,a.isBlack=!0,s.isBlack=!1,s.fixRedBlack(t))}}}addItem(e,t,n){this.min>n||this.max<t||(this.min>=t&&this.max<=n?this.items.push(e):this.hasChildren()&&(this.left.addItem(e,t,n),this.right.addItem(e,t,n)))}removeItem(e,t,n){this.min>n||this.max<t||(this.min>=t&&this.max<=n?(assert&&assert(this.items.includes(e)),arrayRemove(this.items,e)):this.hasChildren()&&(this.left.removeItem(e,t,n),this.right.removeItem(e,t,n)))}audit(e,t,n=[]){if(assert){for(const r of n)assert(!this.items.includes(r));for(const r of this.items)assert(this.tree.getMinX(r,e)<=this.min),assert(this.tree.getMaxX(r,e)>=this.max);for(const r of n)this.tree.getMinX(r,e)<=this.min&&this.tree.getMaxX(r,e)>=this.max&&assert(t.has(r)||this.items.includes(r));if(assert(this.hasChildren()===(this.left!==null)),assert(this.hasChildren()===(this.right!==null)),assert(this.hasChildren()===(this.splitValue!==null)),assert(this.min<this.max),this.parent&&(assert(this.parent.hasChild(this)),assert(this.isBlack||this.parent.isBlack)),this.hasChildren()){assert(this.left.parent===this),assert(this.right.parent===this),assert(this.min===this.left.min),assert(this.max===this.right.max),assert(this.splitValue===this.left.max),assert(this.splitValue===this.right.min);for(const s of this.left.items)assert(!this.right.items.includes(s),"We shouldn't have two children with the same item");const r=[...n,...this.items];this.left.audit(e,t,r),this.right.audit(e,t,r)}}}toString(){return`[${this.min} ${this.max}] split:${this.splitValue} ${this.isBlack?"black":"red"} ${this.items}`}freeToPool(){Ii.pool.freeToPool(this)}};Ii.pool=new Pool(Ii);let SegmentNode=Ii;kite.register("SegmentTree",SegmentTree);class EdgeSegmentTree extends SegmentTree{getMinX(e,t){return e.segment.bounds.left-t}getMaxX(e,t){return e.segment.bounds.right+t}}kite.register("EdgeSegmentTree",EdgeSegmentTree);class VertexSegmentTree extends SegmentTree{getMinX(e,t){return e.point.x-t}getMaxX(e,t){return e.point.x+t}}kite.register("VertexSegmentTree",VertexSegmentTree);let bridgeId=0,globalId$7=0;const VERTEX_COLLAPSE_THRESHOLD_DISTANCE=1e-5,INTERSECTION_ENDPOINT_THRESHOLD_DISTANCE=.1*VERTEX_COLLAPSE_THRESHOLD_DISTANCE,SPLIT_ENDPOINT_THRESHOLD_DISTANCE=.01*VERTEX_COLLAPSE_THRESHOLD_DISTANCE,T_THRESHOLD=1e-6;class Graph{constructor(){this.vertices=[],this.edges=[],this.innerBoundaries=[],this.outerBoundaries=[],this.boundaries=[],this.shapeIds=[],this.loops=[],this.unboundedFace=Face.pool.create(null),this.faces=[this.unboundedFace]}serialize(){return{type:"Graph",vertices:this.vertices.map(e=>e.serialize()),edges:this.edges.map(e=>e.serialize()),boundaries:this.boundaries.map(e=>e.serialize()),innerBoundaries:this.innerBoundaries.map(e=>e.id),outerBoundaries:this.outerBoundaries.map(e=>e.id),shapeIds:this.shapeIds,loops:this.loops.map(e=>e.serialize()),unboundedFace:this.unboundedFace.id,faces:this.faces.map(e=>e.serialize())}}static deserialize(e){const t=new Graph,n={},r={},s={},a={},h={},c={};return t.vertices=e.vertices.map(d=>{const y=new Vertex(Vector2.Vector2IO.fromStateObject(d.point));return n[d.id]=y,y.visited=d.visited,y.visitIndex=d.visitIndex,y.lowIndex=d.lowIndex,y}),t.edges=e.edges.map(d=>{const y=new Edge(Segment.deserialize(d.segment),n[d.startVertex],n[d.endVertex]);r[d.id]=y,y.signedAreaFragment=d.signedAreaFragment;const g=(D,O)=>{s[O.id]=D,D.isReversed=O.isReversed,D.signedAreaFragment=O.signedAreaFragment,D.startVertex=n[O.startVertex.id],D.endVertex=n[O.endVertex.id],D.sortVector=Vector2.Vector2IO.fromStateObject(O.sortVector),D.data=O.data};return g(y.forwardHalf,d.forwardHalf),g(y.reversedHalf,d.reversedHalf),y.visited=d.visited,y.data=d.data,y}),e.vertices.forEach((d,y)=>{const g=t.vertices[y];g.incidentHalfEdges=d.incidentHalfEdges.map(D=>s[D])}),t.boundaries=e.boundaries.map(d=>{const y=Boundary.pool.create(d.halfEdges.map(g=>s[g]));return a[d.id]=y,y.signedArea=d.signedArea,y.bounds=Bounds2.Bounds2IO.fromStateObject(d.bounds),y}),e.boundaries.forEach((d,y)=>{const g=t.boundaries[y];g.childBoundaries=d.childBoundaries.map(D=>a[D])}),t.innerBoundaries=e.innerBoundaries.map(d=>a[d]),t.outerBoundaries=e.outerBoundaries.map(d=>a[d]),t.shapeIds=e.shapeIds,t.loops=e.loops.map(d=>{const y=new Loop(d.shapeId,d.closed);return h[d.id]=y,y.halfEdges=d.halfEdges.map(g=>s[g]),y}),t.faces=e.faces.map((d,y)=>{const g=y===0?t.unboundedFace:new Face(a[d.boundary]);return c[d.id]=g,g.holes=d.holes.map(D=>a[D]),g.windingMap=d.windingMap,g.filled=d.filled,g}),e.edges.forEach((d,y)=>{const g=t.edges[y];g.forwardHalf.face=d.forwardHalf.face===null?null:c[d.forwardHalf.face],g.reversedHalf.face=d.reversedHalf.face===null?null:c[d.reversedHalf.face]}),t}addShape(e,t,n){for(let r=0;r<t.subpaths.length;r++)this.addSubpath(e,t.subpaths[r],n)}addSubpath(e,t,n){if(assert&&assert(typeof e=="number"),assert&&assert(t instanceof Subpath$1),n=merge({ensureClosed:!0},n),this.shapeIds.indexOf(e)<0&&this.shapeIds.push(e),t.segments.length===0)return;const r=t.closed||n.ensureClosed,s=n.ensureClosed?t.getFillSegments():t.segments;let a;const h=[];for(a=0;a<s.length;a++){let d=a-1;d<0&&(d=s.length-1);let y=s[d].end;const g=s[a].start;!r&&a===0&&(y=g),g.equals(y)?h.push(Vertex.pool.create(g)):(assert&&assert(g.distance(y)<1e-5,"Inaccurate start/end points"),h.push(Vertex.pool.create(g.average(y))))}r||h.push(Vertex.pool.create(s[s.length-1].end));const c=Loop.pool.create(e,r);for(a=0;a<s.length;a++){let d=a+1;r&&d===s.length&&(d=0);const y=Edge.pool.create(s[a],h[a],h[d]);c.halfEdges.push(y.forwardHalf),this.addEdge(y)}this.loops.push(c),this.vertices.push(...h)}computeSimplifiedFaces(){this.eliminateOverlap(),this.eliminateSelfIntersection(),this.eliminateIntersection(),this.collapseVertices(),this.removeBridges(),this.removeLowOrderVertices(),this.orderVertexEdges(),this.extractFaces(),this.computeBoundaryTree(),this.computeWindingMap()}computeFaceInclusion(e){for(let t=0;t<this.faces.length;t++){const n=this.faces[t];n.filled=e(n.windingMap)}}createFilledSubGraph(){const e=new Graph,t={};for(let n=0;n<this.edges.length;n++){const r=this.edges[n];if(r.forwardHalf.face.filled!==r.reversedHalf.face.filled){if(!t[r.startVertex.id]){const h=Vertex.pool.create(r.startVertex.point);e.vertices.push(h),t[r.startVertex.id]=h}if(!t[r.endVertex.id]){const h=Vertex.pool.create(r.endVertex.point);e.vertices.push(h),t[r.endVertex.id]=h}const s=t[r.startVertex.id],a=t[r.endVertex.id];e.addEdge(Edge.pool.create(r.segment,s,a))}}return e.collapseAdjacentEdges(),e.orderVertexEdges(),e.extractFaces(),e.computeBoundaryTree(),e.fillAlternatingFaces(),e}facesToShape(){const e=[];for(let t=0;t<this.faces.length;t++){const n=this.faces[t];if(n.filled){e.push(n.boundary.toSubpath());for(let r=0;r<n.holes.length;r++)e.push(n.holes[r].toSubpath())}}return new kite.Shape(e)}dispose(){for(;this.boundaries.length;)this.boundaries.pop().dispose();for(cleanArray(this.innerBoundaries),cleanArray(this.outerBoundaries);this.loops.length;)this.loops.pop().dispose();for(;this.faces.length;)this.faces.pop().dispose();for(;this.vertices.length;)this.vertices.pop().dispose();for(;this.edges.length;)this.edges.pop().dispose()}addEdge(e){assert&&assert(e instanceof Edge),assert&&assert(!_.includes(e.startVertex.incidentHalfEdges,e.reversedHalf),"Should not already be connected"),assert&&assert(!_.includes(e.endVertex.incidentHalfEdges,e.forwardHalf),"Should not already be connected"),this.edges.push(e),e.startVertex.incidentHalfEdges.push(e.reversedHalf),e.endVertex.incidentHalfEdges.push(e.forwardHalf)}removeEdge(e){assert&&assert(e instanceof Edge),arrayRemove(this.edges,e),arrayRemove(e.startVertex.incidentHalfEdges,e.reversedHalf),arrayRemove(e.endVertex.incidentHalfEdges,e.forwardHalf)}replaceEdgeInLoops(e,t){const n=[];for(let r=0;r<t.length;r++)n.push(t[t.length-1-r].getReversed());for(let r=0;r<this.loops.length;r++){const s=this.loops[r];for(let a=s.halfEdges.length-1;a>=0;a--){const h=s.halfEdges[a];if(h.edge===e){const c=h===e.forwardHalf?t:n;Array.prototype.splice.apply(s.halfEdges,[a,1].concat(c))}}}}collapseAdjacentEdges(){let e=!0;for(;e;){e=!1;for(let t=0;t<this.vertices.length;t++){const n=this.vertices[t];if(n.incidentHalfEdges.length===2){const r=n.incidentHalfEdges[0].edge,s=n.incidentHalfEdges[1].edge;let a=r.segment,h=s.segment;const c=r.getOtherVertex(n),d=s.getOtherVertex(n);if(assert&&assert(this.loops.length===0),r.startVertex===n&&(a=a.reversed()),s.endVertex===n&&(h=h.reversed()),a instanceof Line$1&&h instanceof Line$1&&a.tangentAt(0).normalized().distance(h.tangentAt(0).normalized())<1e-6){this.removeEdge(r),this.removeEdge(s),r.dispose(),s.dispose(),arrayRemove(this.vertices,n),n.dispose();const y=new Line$1(c.point,d.point);this.addEdge(new Edge(y,c,d)),e=!0;break}}}}}eliminateOverlap(){const t=new window.FlatQueue,n=new EdgeSegmentTree(1e-4),r=globalId$7++,s=c=>{const d=c.segment.bounds;t.push({start:!0,edge:c},d.minY-1e-4),t.push({start:!1,edge:c},d.maxY+1e-4)},a=c=>{c.internalData.removedId=r};for(let c=0;c<this.edges.length;c++)s(this.edges[c]);const h=[];for(;t.length;){const c=t.pop(),d=c.edge;if(d.internalData.removedId!==r)if(c.start){let y=!1,g,D;if(n.query(d,O=>{const V=d.segment.getOverlaps(O.segment);if(V!==null&&V.length)for(let k=0;k<V.length;k++){const M=V[k];if(Math.abs(M.t1-M.t0)>1e-5&&Math.abs(M.qt1-M.qt0)>1e-5)return D=this.splitOverlap(d,O,M),y=!0,g=O,!0}return!1}),y){n.removeItem(g),a(g),a(d);for(let O=0;O<D.length;O++)s(D[O]);h.push(d),h.push(g)}else n.addItem(d)}else n.removeItem(d)}for(let c=0;c<h.length;c++)h[c].dispose()}splitOverlap(e,t,n){const r=[],s=e.segment,a=t.segment;this.removeEdge(e),this.removeEdge(t);let h=n.t0,c=n.t1,d=n.qt0,y=n.qt1;h<1e-5&&(h=0),c>1-1e-5&&(c=1),d<1e-5&&(d=0),y>1-1e-5&&(y=1);const g=h>0?s.subdivided(h)[0]:null,D=d>0?a.subdivided(d)[0]:null,O=c<1?s.subdivided(c)[1]:null,V=y<1?a.subdivided(y)[1]:null;let k=s;h>0&&(k=k.subdivided(h)[1]),c<1&&(k=k.subdivided(DotUtils.linear(h,1,0,1,c))[0]);let M;g&&D?(M=Vertex.pool.create(k.start),this.vertices.push(M)):g?M=n.a>0?t.startVertex:t.endVertex:M=e.startVertex;let N;O&&V?(N=Vertex.pool.create(k.end),this.vertices.push(N)):O?N=n.a>0?t.endVertex:t.startVertex:N=e.endVertex;const F=Edge.pool.create(k,M,N);r.push(F);let G,ie,Z,W;g&&(G=Edge.pool.create(g,e.startVertex,M),r.push(G)),O&&(ie=Edge.pool.create(O,N,e.endVertex),r.push(ie)),D&&(Z=Edge.pool.create(D,t.startVertex,n.a>0?M:N),r.push(Z)),V&&(W=Edge.pool.create(V,n.a>0?N:M,t.endVertex),r.push(W));for(let pe=0;pe<r.length;pe++)this.addEdge(r[pe]);const X=(g?[G]:[]).concat([F]).concat(O?[ie]:[]),J=(D?[Z]:[]).concat([F]).concat(V?[W]:[]),oe=[],le=[];for(let pe=0;pe<X.length;pe++)oe.push(X[pe].forwardHalf);for(let pe=0;pe<J.length;pe++){const ve=J[pe]!==F||n.a>0;le.push(ve?J[pe].forwardHalf:J[pe].reversedHalf)}return this.replaceEdgeInLoops(e,oe),this.replaceEdgeInLoops(t,le),r}eliminateSelfIntersection(){assert&&assert(this.boundaries.length===0,"Only handles simpler level primitive splitting right now");for(let e=this.edges.length-1;e>=0;e--){const t=this.edges[e],n=t.segment;if(n instanceof Cubic){const r=n.getSelfIntersection();if(r){assert&&assert(r.aT<r.bT);const s=n.subdivisions([r.aT,r.bT]),a=Vertex.pool.create(r.point);this.vertices.push(a);const h=Edge.pool.create(s[0],t.startVertex,a),c=Edge.pool.create(s[1],a,a),d=Edge.pool.create(s[2],a,t.endVertex);this.removeEdge(t),this.addEdge(h),this.addEdge(c),this.addEdge(d),this.replaceEdgeInLoops(t,[h.forwardHalf,c.forwardHalf,d.forwardHalf]),t.dispose()}}}}eliminateIntersection(){const t=new window.FlatQueue,n=new EdgeSegmentTree(1e-4),r=globalId$7++,s=c=>{const d=c.segment.bounds;t.push({start:!0,edge:c},d.minY-1e-4),t.push({start:!1,edge:c},d.maxY+1e-4)},a=c=>{c.internalData.removedId=r};for(let c=0;c<this.edges.length;c++)s(this.edges[c]);const h=[];for(;t.length;){const c=t.pop(),d=c.edge;if(d.internalData.removedId!==r)if(c.start){let y=!1,g,D,O;if(n.query(d,V=>{const k=d.segment,M=V.segment;let N=Segment.intersect(k,M);if(N=N.filter(F=>{const G=F.point;return Graph.isInternal(G,F.aT,k,INTERSECTION_ENDPOINT_THRESHOLD_DISTANCE,T_THRESHOLD)||Graph.isInternal(G,F.bT,M,INTERSECTION_ENDPOINT_THRESHOLD_DISTANCE,T_THRESHOLD)}),N.length){const F=N[0],G=this.simpleSplit(d,V,F.aT,F.bT,F.point);if(G)return y=!0,g=V,D=G.addedEdges,O=G.removedEdges,!0}return!1}),y){O.includes(d)?(a(d),h.push(d)):n.addItem(d),O.includes(g)&&(n.removeItem(g),a(g),h.push(g));for(let V=0;V<D.length;V++)s(D[V])}else n.addItem(d)}else n.removeItem(d)}for(let c=0;c<h.length;c++)h[c].dispose()}simpleSplit(e,t,n,r,s){const a=Graph.isInternal(s,n,e.segment,SPLIT_ENDPOINT_THRESHOLD_DISTANCE,T_THRESHOLD),h=Graph.isInternal(s,r,t.segment,SPLIT_ENDPOINT_THRESHOLD_DISTANCE,T_THRESHOLD);let c=null;a?h?(c=Vertex.pool.create(s),this.vertices.push(c)):c=r<.5?t.startVertex:t.endVertex:c=n<.5?e.startVertex:e.endVertex;let d=!1;const y=[],g=[];return a&&c!==e.startVertex&&c!==e.endVertex&&(y.push(...this.splitEdge(e,n,c)),g.push(e),d=!0),h&&c!==t.startVertex&&c!==t.endVertex&&(y.push(...this.splitEdge(t,r,c)),g.push(t),d=!0),d?{addedEdges:y,removedEdges:g}:null}splitEdge(e,t,n){assert&&assert(this.boundaries.length===0,"Only handles simpler level primitive splitting right now"),assert&&assert(e.startVertex!==n),assert&&assert(e.endVertex!==n);const r=e.segment.subdivided(t);assert&&assert(r.length===2);const s=Edge.pool.create(r[0],e.startVertex,n),a=Edge.pool.create(r[1],n,e.endVertex);return this.removeEdge(e),this.addEdge(s),this.addEdge(a),this.replaceEdgeInLoops(e,[s.forwardHalf,a.forwardHalf]),[s,a]}collapseVertices(){assert&&assert(_.every(this.edges,c=>_.includes(this.vertices,c.startVertex))),assert&&assert(_.every(this.edges,c=>_.includes(this.vertices,c.endVertex)));const e=10*VERTEX_COLLAPSE_THRESHOLD_DISTANCE,t=new window.FlatQueue,n=new VertexSegmentTree(e),r=globalId$7++,s=c=>{t.push({start:!0,vertex:c},c.point.y-e),t.push({start:!1,vertex:c},c.point.y+e)},a=c=>{c.internalData.removedId=r};for(let c=0;c<this.vertices.length;c++)s(this.vertices[c]);const h=[];for(;t.length;){const c=t.pop(),d=c.vertex;if(d.internalData.removedId!==r)if(c.start){let y=!1,g,D;if(n.query(d,O=>{const V=d.point.distance(O.point);if(V<VERTEX_COLLAPSE_THRESHOLD_DISTANCE){const k=Vertex.pool.create(V===0?d.point:d.point.average(O.point));this.vertices.push(k),arrayRemove(this.vertices,d),arrayRemove(this.vertices,O);for(let M=this.edges.length-1;M>=0;M--){const N=this.edges[M],F=N.startVertex===d||N.startVertex===O,G=N.endVertex===d||N.endVertex===O;if(F&&G){if((N.segment.bounds.width>1e-5||N.segment.bounds.height>1e-5)&&(N.segment instanceof Cubic||N.segment instanceof Arc||N.segment instanceof EllipticalArc)){const ie=Edge.pool.create(N.segment,k,k);this.addEdge(ie),this.replaceEdgeInLoops(N,[ie.forwardHalf])}else this.replaceEdgeInLoops(N,[]);this.removeEdge(N),N.dispose()}else F?(N.startVertex=k,k.incidentHalfEdges.push(N.reversedHalf),N.updateReferences()):G&&(N.endVertex=k,k.incidentHalfEdges.push(N.forwardHalf),N.updateReferences())}return D=[k],y=!0,g=O,!0}return!1}),y){n.removeItem(g),a(g),a(d);for(let O=0;O<D.length;O++)s(D[O]);h.push(d),h.push(g)}else n.addItem(d)}else n.removeItem(d)}for(let c=0;c<h.length;c++)h[c].dispose();assert&&assert(_.every(this.edges,c=>_.includes(this.vertices,c.startVertex))),assert&&assert(_.every(this.edges,c=>_.includes(this.vertices,c.endVertex)))}markBridges(e,t){t.visited=!0,t.visitIndex=t.lowIndex=bridgeId++;for(let n=0;n<t.incidentHalfEdges.length;n++){const r=t.incidentHalfEdges[n].edge,s=t.incidentHalfEdges[n].startVertex;s.visited?r.visited||(t.lowIndex=Math.min(t.lowIndex,s.visitIndex)):(r.visited=!0,s.parent=t,this.markBridges(e,s),t.lowIndex=Math.min(t.lowIndex,s.lowIndex),s.lowIndex>t.visitIndex&&e.push(r))}}removeBridges(){const e=[];for(let t=0;t<this.vertices.length;t++){const n=this.vertices[t];n.visited||this.markBridges(e,n)}for(let t=0;t<e.length;t++){const n=e[t];this.removeEdge(n),this.replaceEdgeInLoops(n,[]),n.dispose()}}removeLowOrderVertices(){assert&&assert(_.every(this.edges,t=>_.includes(this.vertices,t.startVertex))),assert&&assert(_.every(this.edges,t=>_.includes(this.vertices,t.endVertex)));let e=!0;for(;e;){e=!1;for(let t=this.vertices.length-1;t>=0;t--){const n=this.vertices[t];if(n.incidentHalfEdges.length<2){for(let r=0;r<n.incidentHalfEdges.length;r++){const s=n.incidentHalfEdges[r].edge;this.removeEdge(s),this.replaceEdgeInLoops(s,[]),s.dispose()}this.vertices.splice(t,1),n.dispose(),e=!0;break}}}assert&&assert(_.every(this.edges,t=>_.includes(this.vertices,t.startVertex))),assert&&assert(_.every(this.edges,t=>_.includes(this.vertices,t.endVertex)))}orderVertexEdges(){for(let e=0;e<this.vertices.length;e++)this.vertices[e].sortEdges()}extractFaces(){const e=[];for(let t=0;t<this.edges.length;t++)e.push(this.edges[t].forwardHalf),e.push(this.edges[t].reversedHalf);for(;e.length;){const t=[];let n=e[0];const r=n;for(;n&&(arrayRemove(e,n),t.push(n),n=n.getNext(),n!==r););const s=Boundary.pool.create(t);(s.signedArea>0?this.innerBoundaries:this.outerBoundaries).push(s),this.boundaries.push(s)}for(let t=0;t<this.innerBoundaries.length;t++)this.faces.push(Face.pool.create(this.innerBoundaries[t]))}computeBoundaryTree(){const e=[],t=new Transform3(Matrix3.rotation2(1.5729657));for(let n=0;n<this.outerBoundaries.length;n++){const r=this.outerBoundaries[n],s=r.computeExtremeRay(t);let a=null,h=Number.POSITIVE_INFINITY,c=!1;for(let d=0;d<this.edges.length;d++){const y=this.edges[d],g=y.segment.intersection(s);for(let D=0;D<g.length;D++){const O=g[D];O.distance<h&&(a=y,h=O.distance,c=O.wind)}}if(a===null)e.push(r);else{const y=c<0?a.reversedHalf:a.forwardHalf;this.getBoundaryOfHalfEdge(y).childBoundaries.push(r)}}e.forEach(this.unboundedFace.recursivelyAddHoles.bind(this.unboundedFace));for(let n=0;n<this.faces.length;n++){const r=this.faces[n];r.boundary!==null&&r.boundary.childBoundaries.forEach(r.recursivelyAddHoles.bind(r))}}computeWindingMap(){const e=this.edges.slice(),t={};for(let n=0;n<this.shapeIds.length;n++)t[this.shapeIds[n]]=0;for(this.unboundedFace.windingMap=t;e.length;)for(let n=e.length-1;n>=0;n--){const r=e[n],s=r.forwardHalf,a=r.reversedHalf,h=s.face,c=a.face;assert&&assert(h!==c);const d=h.windingMap!==null,y=c.windingMap!==null;if(d&&y){if(e.splice(n,1),assert)for(let g=0;g<this.shapeIds.length;g++){const D=this.shapeIds[g];assert(h.windingMap[D]-c.windingMap[D]===this.computeDifferential(r,D))}}else{if(!d&&!y)continue;{const g=d?h:c,D=d?c:h,O={};for(let V=0;V<this.shapeIds.length;V++){const k=this.shapeIds[V],M=this.computeDifferential(r,k);O[k]=g.windingMap[k]+M*(d?-1:1)}D.windingMap=O}}}}computeDifferential(e,t){let n=0;for(let r=0;r<this.loops.length;r++){const s=this.loops[r];if(assert&&assert(s.closed,"This is only defined to work for closed loops"),s.shapeId===t)for(let a=0;a<s.halfEdges.length;a++){const h=s.halfEdges[a];h===e.forwardHalf?n++:h===e.reversedHalf&&n--}}return n}fillAlternatingFaces(){let e=0;for(let t=0;t<this.faces.length;t++)this.faces[t].filled=null,e++;for(this.unboundedFace.filled=!1,e--;e;)for(let t=0;t<this.edges.length;t++){const n=this.edges[t],r=n.forwardHalf.face,s=n.reversedHalf.face,a=r.filled===null,h=s.filled===null;a&&!h?(r.filled=!s.filled,e--):!a&&h&&(s.filled=!r.filled,e--)}}getBoundaryOfHalfEdge(e){for(let t=0;t<this.boundaries.length;t++){const n=this.boundaries[t];if(n.hasHalfEdge(e))return n}throw new Error("Could not find boundary")}static isInternal(e,t,n,r,s){return t>s&&t<1-s&&e.distance(n.start)>r&&e.distance(n.end)>r}static BINARY_NONZERO_UNION(e){return e[0]!==0||e[1]!==0}static BINARY_NONZERO_INTERSECTION(e){return e[0]!==0&&e[1]!==0}static BINARY_NONZERO_DIFFERENCE(e){return e[0]!==0&&e[1]===0}static BINARY_NONZERO_XOR(e){return(e[0]!==0^e[1]!==0)===1}static binaryResult(e,t,n){const r=new Graph;r.addShape(0,e),r.addShape(1,t),r.computeSimplifiedFaces(),r.computeFaceInclusion(n);const s=r.createFilledSubGraph(),a=s.facesToShape();return r.dispose(),s.dispose(),a}static unionNonZero(e){const t=new Graph;for(let s=0;s<e.length;s++)t.addShape(s,e[s]);t.computeSimplifiedFaces(),t.computeFaceInclusion(s=>{for(let a=0;a<e.length;a++)if(s[a]!==0)return!0;return!1});const n=t.createFilledSubGraph(),r=n.facesToShape();return t.dispose(),n.dispose(),r}static intersectionNonZero(e){const t=new Graph;for(let s=0;s<e.length;s++)t.addShape(s,e[s]);t.computeSimplifiedFaces(),t.computeFaceInclusion(s=>{for(let a=0;a<e.length;a++)if(s[a]===0)return!1;return!0});const n=t.createFilledSubGraph(),r=n.facesToShape();return t.dispose(),n.dispose(),r}static xorNonZero(e){const t=new Graph;for(let s=0;s<e.length;s++)t.addShape(s,e[s]);t.computeSimplifiedFaces(),t.computeFaceInclusion(s=>{let a=!1;for(let h=0;h<e.length;h++)s[h]!==0&&(a=!a);return a});const n=t.createFilledSubGraph(),r=n.facesToShape();return t.dispose(),n.dispose(),r}static simplifyNonZero(e){const t=new Graph;t.addShape(0,e),t.computeSimplifiedFaces(),t.computeFaceInclusion(s=>s[0]!==0);const n=t.createFilledSubGraph(),r=n.facesToShape();return t.dispose(),n.dispose(),r}static clipShape(e,t,n){let r,s,a;n=merge({includeExterior:!1,includeBoundary:!0,includeInterior:!0},n);const d=Graph.simplifyNonZero(e),y=new Graph;for(y.addShape(0,t,{ensureClosed:!1}),y.addShape(1,d),y.eliminateOverlap(),y.eliminateSelfIntersection(),y.eliminateIntersection(),y.collapseVertices(),r=0;r<y.loops.length;r++)if(a=y.loops[r],a.shapeId===1)for(s=0;s<a.halfEdges.length;s++)a.halfEdges[s].edge.data=!0;const g=[];for(r=0;r<y.loops.length;r++)if(a=y.loops[r],a.shapeId===0){let D=[];for(s=0;s<a.halfEdges.length;s++){const O=a.halfEdges[s];(O.edge.data?n.includeBoundary:d.containsPoint(O.edge.segment.positionAt(.5))?n.includeInterior:n.includeExterior)?D.push(O.getDirectionalSegment()):D.length&&(g.push(new Subpath$1(D,void 0,a.closed)),D=[])}D.length&&g.push(new Subpath$1(D,void 0,a.closed))}return y.dispose(),new kite.Shape(g)}}kite.register("Graph",Graph);const Graph$1=Graph,scratchVector$1=new Vector2(0,0),scratchMatrix$3=Matrix3.IDENTITY.copy(),Xt=class Xt extends EnumerationValue{};Xt.TRANSLATION=new Xt,Xt.TRANSLATION_AND_SCALE=new Xt,Xt.TRANSLATION_AND_ROTATION=new Xt,Xt.AFFINE=new Xt,Xt.enumeration=new Enumeration(Xt,{phetioDocumentation:"Defines the available transform type for a SpriteInstance"});let SpriteInstanceTransformType=Xt;const hs=class hs{constructor(){this.sprite=null,this.matrix=new Matrix3().setToAffine(1,0,0,0,1,0),this.transformType=SpriteInstanceTransformType.TRANSLATION,this.alpha=1}initialize(){return this}getShape(){return this.sprite?this.sprite.getShape().transformed(this.matrix):new Shape$1}containsPoint(e){if(!this.sprite)return!1;const t=scratchVector$1.set(e);return this.transformType===SpriteInstanceTransformType.AFFINE?scratchMatrix$3.set(this.matrix).invert().multiplyVector2(t):(t.x-=this.matrix.m02(),t.y-=this.matrix.m12(),this.transformType===SpriteInstanceTransformType.TRANSLATION_AND_SCALE?(t.x/=this.matrix.m00(),t.y/=this.matrix.m11()):this.transformType===SpriteInstanceTransformType.TRANSLATION_AND_ROTATION&&t.rotate(-this.matrix.rotation)),this.sprite.containsPoint(t)}freeToPool(){hs.pool.freeToPool(this)}};hs.pool=new Pool(hs,{maxSize:1e3});let SpriteInstance=hs;scenery.register("SpriteInstance",SpriteInstance);const MAX_DIMENSION=new Dimension2(1024,1024),GUTTER_SIZE=1,PADDING=1,mn=class mn{constructor(e){this.useMipmaps=e,this.gl=null,this.texture=null,this.bounds=new Bounds2(0,0,MAX_DIMENSION.width,MAX_DIMENSION.height),assert&&assert(this.bounds.minX===0&&this.bounds.minY===0,"Assumed constraint later on for transforms"),this.width=this.bounds.width,this.height=this.bounds.height,this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.context=this.canvas.getContext("2d"),this.binPacker=new BinPacker(this.bounds),this.dirty=!0,this.usedSprites=[],this.unusedSprites=[]}initializeContext(e){this.gl=e,this.createTexture()}createTexture(){const e=this.gl;assert&&assert(e),this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,this.useMipmaps?e.LINEAR_MIPMAP_LINEAR:e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.canvas),this.useMipmaps&&(e.hint(e.GENERATE_MIPMAP_HINT,e.NICEST),e.generateMipmap(e.TEXTURE_2D)),e.bindTexture(e.TEXTURE_2D,null),this.dirty=!1}updateTexture(){if(assert&&assert(this.gl,"SpriteSheet needs context to updateTexture()"),this.dirty){this.dirty=!1;const e=this.gl;assert&&assert(e),e.bindTexture(e.TEXTURE_2D,this.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.canvas),this.useMipmaps&&(e.hint(e.GENERATE_MIPMAP_HINT,e.NICEST),e.generateMipmap(e.TEXTURE_2D)),e.bindTexture(e.TEXTURE_2D,null)}}addImage(e,t,n){let r;for(r=0;r<this.usedSprites.length;r++){const a=this.usedSprites[r];if(a.image===e)return a.count++,a}for(r=0;r<this.unusedSprites.length;r++){const a=this.unusedSprites[r];if(a.image===e)return a.count++,assert&&assert(a.count===1,"Count should be exactly 1 after coming back from being unused"),this.unusedSprites.splice(r,1),this.usedSprites.push(a),a}let s;for(;!(s=this.binPacker.allocate(t+2*GUTTER_SIZE+PADDING,n+2*GUTTER_SIZE+PADDING))&&this.unusedSprites.length;){const a=this.unusedSprites.shift();this.dirty=!0;const h=a.bin.bounds;this.context.clearRect(h.x,h.y,h.width,h.height),this.binPacker.deallocate(a.bin)}if(s){const a=new Bounds2((s.bounds.minX+GUTTER_SIZE)/this.width,(s.bounds.minY+GUTTER_SIZE)/this.height,(s.bounds.maxX-GUTTER_SIZE-PADDING)/this.width,(s.bounds.maxY-GUTTER_SIZE-PADDING)/this.height),h=new Sprite$1(this,s,a,e,1);return this.copyImageWithGutter(e,t,n,s.bounds.x,s.bounds.y),this.dirty=!0,this.usedSprites.push(h),h}else return null}removeImage(e){let t,n;for(n=0;n<this.usedSprites.length;n++)if(this.usedSprites[n].image===e){t=this.usedSprites[n];break}assert&&assert(t,"Sprite not found for removeImage"),--t.count<=0&&(this.usedSprites.splice(n,1),this.unusedSprites.push(t))}containsImage(e){let t;for(t=0;t<this.usedSprites.length;t++)if(this.usedSprites[t].image===e)return!0;for(t=0;t<this.unusedSprites.length;t++)if(this.unusedSprites[t].image===e)return!0;return!1}copyImageWithGutter(e,t,n,r,s){assert&&assert(GUTTER_SIZE===1),this.copyImageRegion(e,1,1,0,0,r,s),this.copyImageRegion(e,1,1,t-1,0,r+1+t,s),this.copyImageRegion(e,1,1,t-1,n-1,r+1+t,s+1+n),this.copyImageRegion(e,1,1,0,n-1,r,s+1+n),this.copyImageRegion(e,t,1,0,0,r+1,s),this.copyImageRegion(e,t,1,0,n-1,r+1,s+1+n),this.copyImageRegion(e,1,n,0,0,r,s+1),this.copyImageRegion(e,1,n,t-1,0,r+1+t,s+1),this.context.drawImage(e,r+1,s+1)}copyImageRegion(e,t,n,r,s,a,h){this.context.drawImage(e,r,s,t,n,a,h,t,n)}};mn.MAX_DIMENSION=MAX_DIMENSION;let SpriteSheet=mn;scenery.register("SpriteSheet",SpriteSheet);let Sprite$1=class{constructor(e,t,n,r,s){this.spriteSheet=e,this.bin=t,this.uvBounds=n,this.image=r,this.count=s}};SpriteSheet.Sprite=Sprite$1;class ShaderProgram{constructor(e,t,n,r){const s=optionize()({attributes:[],uniforms:[]},r);this.vertexSource=t,this.fragmentSource=n,this.attributeNames=s.attributes,this.uniformNames=s.uniforms,this.initialize(e)}initialize(e){this.gl=e,this.used=!1,this.program=this.gl.createProgram(),this.vertexShader=Utils.createShader(this.gl,this.vertexSource,this.gl.VERTEX_SHADER),this.fragmentShader=Utils.createShader(this.gl,this.fragmentSource,this.gl.FRAGMENT_SHADER),this.gl.attachShader(this.program,this.vertexShader),this.gl.attachShader(this.program,this.fragmentShader),this.gl.linkProgram(this.program),this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS)||(console.log("GLSL link error:"),console.log(this.gl.getProgramInfoLog(this.program)),console.log("for vertex shader"),console.log(this.vertexSource),console.log("for fragment shader"),console.log(this.fragmentSource)),this.gl.deleteShader(this.vertexShader),this.gl.deleteShader(this.fragmentShader),this.uniformLocations={},this.attributeLocations={},this.activeAttributes={},_.each(this.attributeNames,t=>{this.attributeLocations[t]=this.gl.getAttribLocation(this.program,t),this.activeAttributes[t]=!0}),_.each(this.uniformNames,t=>{this.uniformLocations[t]=this.gl.getUniformLocation(this.program,t)}),this.isInitialized=!0}use(){this.used||(this.used=!0,this.gl.useProgram(this.program),_.each(this.attributeNames,e=>{this.activeAttributes[e]&&this.enableVertexAttribArray(e)}))}activateAttribute(e){this.activeAttributes[e]||(this.activeAttributes[e]=!0,this.used&&this.enableVertexAttribArray(e))}enableVertexAttribArray(e){this.gl.enableVertexAttribArray(this.attributeLocations[e])}unuse(){this.used&&(this.used=!1,_.each(this.attributeNames,e=>{this.activeAttributes[e]&&this.disableVertexAttribArray(e)}))}disableVertexAttribArray(e){this.gl.disableVertexAttribArray(this.attributeLocations[e])}deactivateAttribute(e){this.activeAttributes[e]&&(this.activeAttributes[e]=!1,this.used&&this.disableVertexAttribArray(e))}dispose(){this.gl.deleteProgram(this.program)}}scenery.register("ShaderProgram",ShaderProgram);class ColorProperty extends Property{constructor(e,t){t&&(assert&&assert(!t.hasOwnProperty("valueType"),"ColorProperty sets valueType"),assert&&assert(!t.hasOwnProperty("phetioType"),"ColorProperty sets phetioType"));const n=optionize()({valueType:Color,phetioValueType:Color.ColorIO},t);super(e,n)}}scenery.register("ColorProperty",ColorProperty);const TEXT_SIZE_CONTAINER_ID="sceneryTextSizeContainer",TEXT_SIZE_ELEMENT_ID="sceneryTextSizeElement";let svgTextSizeContainer,svgTextSizeElement;const hybridFontVerticalCache={};let deliveredWarning=!1;const TextBounds={approximateSVGBounds(o,e){if(assert&&assert(o instanceof Font,"Font required"),assert&&assert(typeof e=="string","renderedText required"),!svgTextSizeContainer.parentNode)if(document.body)document.body.appendChild(svgTextSizeContainer);else throw new Error("No document.body and trying to get approximate SVG bounds of a Text node");TextBounds.setSVGTextAttributes(svgTextSizeElement,o,e);const t=svgTextSizeElement.getBBox();return t.width===0&&t.height===0&&e.length>0?(deliveredWarning||(deliveredWarning=!0,console.log("WARNING: Guessing text bounds, is the simulation hidden? See https://github.com/phetsims/chipper/issues/768")),TextBounds.guessSVGBounds(o,e)):new Bounds2(t.x,t.y,t.x+t.width,t.y+t.height)},guessSVGBounds(o,e){const t=o.getNumericSize(),n=o.weight==="bold";return new Bounds2(0,-.9*t,(n?.435:.4)*t*e.length,.22*t)},accurateCanvasBounds(o){const e=scenery.scratchContext;e.font=o._font.toCSS(),e.direction="ltr";const t=e.measureText(o.renderedText);return new Bounds2(-t.actualBoundingBoxLeft,-t.actualBoundingBoxAscent,t.actualBoundingBoxRight,t.actualBoundingBoxDescent)},accurateCanvasBoundsFallback(o){const e=TextBounds.approximateSVGBounds(o._font,o.renderedText);if(!o.renderedText.length||e.width===0)return e;const t=Utils.canvasAccurateBounds(n=>{if(n.font=o._font.toCSS(),n.direction="ltr",n.fillText(o.renderedText,0,0),o.hasPaintableStroke()){const r=new CanvasContextWrapper(null,n);o.beforeCanvasStroke(r),n.strokeText(o.renderedText,0,0),o.afterCanvasStroke(r)}},{precision:.5,resolution:128,initialScale:32/Math.max(Math.abs(e.minX),Math.abs(e.minY),Math.abs(e.maxX),Math.abs(e.maxY))});return t.isFinite()?t:e},getVerticalBounds(o){assert&&assert(o instanceof Font,"Font required");const e=o.toCSS();let t=hybridFontVerticalCache[e];return t||(t=hybridFontVerticalCache[e]=TextBounds.approximateSVGBounds(o,"m")),t},approximateCanvasWidth(o,e){assert&&assert(o instanceof Font,"Font required"),assert&&assert(typeof e=="string","renderedText required");const t=scenery.scratchContext;return t.font=o.toCSS(),t.direction="ltr",t.measureText(e).width},approximateHybridBounds(o,e){assert&&assert(o instanceof Font,"Font required"),assert&&assert(typeof e=="string","renderedText required");const t=TextBounds.getVerticalBounds(o),n=TextBounds.approximateCanvasWidth(o,e);return new Bounds2(0,t.minY,n,t.maxY)},approximateDOMBounds(o,e){assert&&assert(o instanceof Font,"Font required");const t=1024,n=document.createElement("div");$(n).css({position:"absolute",left:0,top:0,padding:"0 !important",margin:"0 !important",display:"hidden"});const r=document.createElement("span");$(r).css("font",o.toCSS()),r.appendChild(e),r.setAttribute("direction","ltr");const s=document.createElement("div");$(s).css({"vertical-align":"baseline",display:"inline-block",width:0,height:`${t}px`,margin:"0 !important",padding:"0 !important"}),n.appendChild(r),n.appendChild(s),document.body.appendChild(n);const a=r.getBoundingClientRect(),h=n.getBoundingClientRect(),c=new Bounds2(a.left,a.top-t,a.right+1,a.bottom-t).shiftedXY(-h.left,-h.top);return document.body.removeChild(n),c},approximateImprovedDOMBounds(o,e){assert&&assert(o instanceof Font,"Font required");const t=document.createElement("div");t.style.display="inline-block",t.style.font=o.toCSS(),t.style.color="transparent",t.style.padding="0 !important",t.style.margin="0 !important",t.style.position="absolute",t.style.left="0",t.style.top="0",t.setAttribute("direction","ltr"),t.appendChild(e),document.body.appendChild(t);const n=new Bounds2(t.offsetLeft,t.offsetTop,t.offsetLeft+t.offsetWidth+1,t.offsetTop+t.offsetHeight+1);document.body.removeChild(t);const r=TextBounds.getVerticalBounds(o);return n.shiftedY(r.minY)},setSVGTextAttributes(o,e,t){assert&&assert(e instanceof Font,"Font required"),assert&&assert(typeof t=="string","renderedText required"),o.setAttribute("direction","ltr"),o.setAttribute("font-family",e.getFamily()),o.setAttribute("font-size",e.getSize()),o.setAttribute("font-style",e.getStyle()),o.setAttribute("font-weight",e.getWeight()),o.setAttribute("font-stretch",e.getStretch()),o.lastChild.nodeValue=t},initializeTextBounds(){svgTextSizeContainer=document.getElementById(TEXT_SIZE_CONTAINER_ID),svgTextSizeContainer||(svgTextSizeContainer=document.createElementNS(svgns,"svg"),svgTextSizeContainer.setAttribute("width","2"),svgTextSizeContainer.setAttribute("height","2"),svgTextSizeContainer.setAttribute("id",TEXT_SIZE_CONTAINER_ID),svgTextSizeContainer.setAttribute("style","visibility: hidden; pointer-events: none; position: absolute; left: -65535px; right: -65535px;")),svgTextSizeElement=document.getElementById(TEXT_SIZE_ELEMENT_ID),svgTextSizeElement||(svgTextSizeElement=document.createElementNS(svgns,"text"),svgTextSizeElement.appendChild(document.createTextNode("")),svgTextSizeElement.setAttribute("dominant-baseline","alphabetic"),svgTextSizeElement.setAttribute("text-rendering","geometricPrecision"),svgTextSizeElement.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),svgTextSizeElement.setAttribute("id",TEXT_SIZE_ELEMENT_ID),svgTextSizeContainer.appendChild(svgTextSizeElement))}};scenery.register("TextBounds",TextBounds);class PartialPDOMTrail{constructor(e,t,n){this.pdomInstance=e,this.trail=t,this.isRoot=n,this.isRoot=n,this.fullTrail=this.pdomInstance.trail.copy();for(let r=this.isRoot?0:1;r<this.trail.length;r++)this.fullTrail.addDescendant(this.trail.nodes[r])}}scenery.register("PartialPDOMTrail",PartialPDOMTrail);const SIBLING_CLASS_NAME="a11y-pdom-element",ROOT_CLASS_NAME="a11y-pdom-root",LIST_ITEM_CLASS_NAME="a11y-pdom-list-item";SceneryStyle.addRule(`.${SIBLING_CLASS_NAME}{position: fixed;pointer-events: none;top: 0px;left: 0px;transform-origin: left top 0px;border-width: 0px;border: 0px;padding: 1px 1px;margin: 0px;white-space: nowrap;outline: none;box-shadow:none;border-color:transparent;font-size: 1px;clip: rect(1px, 1px, 1px, 1px);}`);SceneryStyle.addRule(`.${ROOT_CLASS_NAME}{position: absolute;z-index: 1;opacity: 0.0001;}`);SceneryStyle.addRule(`.${LIST_ITEM_CLASS_NAME}{list-style: none;`);const PDOMSiblingStyle={SIBLING_CLASS_NAME,ROOT_CLASS_NAME,LIST_ITEM_CLASS_NAME};scenery.register("PDOMSiblingStyle",PDOMSiblingStyle);const PDOMSiblingStyle$1=PDOMSiblingStyle,NEXT$1="NEXT",PREVIOUS$1="PREVIOUS",INPUT_TAG$2="INPUT",LABEL_TAG$1="LABEL",BUTTON_TAG="BUTTON",TEXTAREA_TAG="TEXTAREA",SELECT_TAG="SELECT",OPTGROUP_TAG="OPTGROUP",DATALIST_TAG="DATALIST",OUTPUT_TAG="OUTPUT",DIV_TAG="DIV",A_TAG="A",AREA_TAG="AREA",P_TAG$1="P",IFRAME_TAG="IFRAME",BOLD_TAG="B",STRONG_TAG="STRONG",I_TAG="I",EM_TAG="EM",MARK_TAG="MARK",SMALL_TAG="SMALL",DEL_TAG="DEL",INS_TAG="INS",SUB_TAG="SUB",SUP_TAG="SUP",BR_TAG="BR",DEFAULT_FOCUSABLE_TAGS=[A_TAG,AREA_TAG,INPUT_TAG$2,SELECT_TAG,TEXTAREA_TAG,BUTTON_TAG,IFRAME_TAG],FORMATTING_TAGS=[BOLD_TAG,STRONG_TAG,I_TAG,EM_TAG,MARK_TAG,SMALL_TAG,DEL_TAG,INS_TAG,SUB_TAG,SUP_TAG,BR_TAG],ELEMENTS_WITHOUT_CLOSING_TAG=[INPUT_TAG$2],DOM_EVENTS=["focusin","focusout","input","change","click","keydown","keyup"],USER_GESTURE_EVENTS=["input","change","click","keydown","keyup"],BLOCKED_DOM_EVENTS=["touchstart","touchend","touchmove","touchcancel","mousedown","mouseup","mousemove","mouseover","mouseout","pointerdown","pointerup","pointermove","pointerover","pointerout","pointercancel","gotpointercapture","lostpointercapture"],ARIA_LABELLEDBY="aria-labelledby",ARIA_DESCRIBEDBY="aria-describedby",ARIA_ACTIVE_DESCENDANT="aria-activedescendant",DATA_FOCUSABLE="data-focusable",DATA_PDOM_UNIQUE_ID="data-unique-id",ASSOCIATION_ATTRIBUTES$1=[ARIA_LABELLEDBY,ARIA_DESCRIBEDBY,ARIA_ACTIVE_DESCENDANT];function getLinearDOMElements(o){const e=o.getElementsByTagName("*"),t=[];for(let n=0;n<e.length;n++)e[n].nodeType===Node.ELEMENT_NODE&&(t[n]=e[n]);return t}function isElementHidden(o){return o.hidden?!0:o===document.body?!1:isElementHidden(o.parentElement)}function getNextPreviousFocusable(o,e){const t=e||document.body,n=getLinearDOMElements(t),r=document.activeElement,s=n.indexOf(r),a=o===NEXT$1?1:-1;let h=s+a;for(;h<n.length&&h>=0;){const c=n[h];if(h+=a,PDOMUtils.isElementFocusable(c))return c}return r}function trimLeft(o){return o.replace(/^\s+/,"")}function tagNameSupportsContent(o){return!_.includes(ELEMENTS_WITHOUT_CLOSING_TAG,o.toUpperCase())}const PDOMUtils={unwrapStringProperty(o){const e=o===null?null:typeof o=="string"?o:o.value;return assert&&assert(e===null||typeof e=="string"),e},getNextFocusable(o){return getNextPreviousFocusable(NEXT$1,o)},getPreviousFocusable(o){return getNextPreviousFocusable(PREVIOUS$1,o)},getFirstFocusable(o){const e=o||document.body,t=getLinearDOMElements(e);let n=document.body,r=0;for(;r<t.length;){const s=t[r];if(r++,PDOMUtils.isElementFocusable(s)){n=s;break}}return n},getRandomFocusable(o){assert&&assert(o,"Random expected");const e=getLinearDOMElements(document.body),t=[];for(let n=0;n<e.length;n++)PDOMUtils.isElementFocusable(e[n])&&t.push(e[n]);return t[o.nextInt(t.length)]},unwrapProperty(o){return isTReadOnlyProperty(o)?o.value:o},containsFormattingTags(o){if(o===null)return!1;assert&&assert(typeof o=="string","unsupported type for textContent.");let e=0;const t=[],n=[];for(;e<o.length;){const a=o.indexOf("<",e),h=o.indexOf(">",e);a>-1&&(t.push(a),e=a+1),h>-1?(n.push(h),e=h+1):e++}if(t.length!==n.length||t.length===0)return!1;let r=!0;const s=o.toUpperCase();for(let a=0;a<t.length;a++){let h=s.substring(t[a]+1,n[a]);h=h.replace("/","");const c=trimLeft(h);h.length-c.length>0||_.includes(FORMATTING_TAGS,h)||(r=!1)}return r},setTextContent(o,e){if(assert&&assert(o instanceof Element),assert&&assert(e===null||typeof e=="string"),e===null)o.innerHTML="";else{const t=e.replaceAll("<br>","<br/>"),n=stripEmbeddingMarks(t);validate(n,Validation.STRING_WITHOUT_TEMPLATE_VARS_VALIDATOR),tagNameSupportsContent(o.tagName)&&(PDOMUtils.containsFormattingTags(n)?o.innerHTML=n:o.textContent=n)}},tagIsDefaultFocusable(o){return _.includes(DEFAULT_FOCUSABLE_TAGS,o.toUpperCase())},isElementFocusable(o){return!document.body.contains(o)||isElementHidden(o)||_.includes(FORMATTING_TAGS,o.tagName)?!1:o.getAttribute(DATA_FOCUSABLE)==="true"},tagNameSupportsContent(o){return tagNameSupportsContent(o)},removeElements(o,e){for(let t=0;t<e.length;t++){const n=e[t];assert&&assert(o.contains(n),"element does not contain child to be removed: ",n),o.removeChild(n)}},insertElements(o,e,t){assert&&assert(o instanceof window.Element),assert&&assert(Array.isArray(e));for(let n=0;n<e.length;n++){const r=e[n];o.insertBefore(r,t||null)}},createElement(o,e,t){t=merge({namespace:null,id:null},t);const n=t.namespace?document.createElementNS(t.namespace,o):document.createElement(o);return t.id&&(n.id=t.id),PDOMUtils.overrideFocusWithTabIndex(n,e),n.classList.add(PDOMSiblingStyle$1.SIBLING_CLASS_NAME),n},overrideFocusWithTabIndex(o,e){PDOMUtils.tagIsDefaultFocusable(o.tagName)!==e?o.tabIndex=e?0:-1:o.removeAttribute("tabindex"),o.setAttribute(DATA_FOCUSABLE,e)},TAGS:{INPUT:INPUT_TAG$2,LABEL:LABEL_TAG$1,BUTTON:BUTTON_TAG,TEXTAREA:TEXTAREA_TAG,SELECT:SELECT_TAG,OPTGROUP:OPTGROUP_TAG,DATALIST:DATALIST_TAG,OUTPUT:OUTPUT_TAG,DIV:DIV_TAG,A:A_TAG,P:P_TAG$1,B:BOLD_TAG,STRONG:STRONG_TAG,I:I_TAG,EM:EM_TAG,MARK:MARK_TAG,SMALL:SMALL_TAG,DEL:DEL_TAG,INS:INS_TAG,SUB:SUB_TAG,SUP:SUP_TAG},FORM_ELEMENTS:[INPUT_TAG$2,BUTTON_TAG,TEXTAREA_TAG,SELECT_TAG,OPTGROUP_TAG,DATALIST_TAG,OUTPUT_TAG,A_TAG],DEFAULT_CONTAINER_TAG_NAME:DIV_TAG,DEFAULT_DESCRIPTION_TAG_NAME:P_TAG$1,DEFAULT_LABEL_TAG_NAME:P_TAG$1,ASSOCIATION_ATTRIBUTES:ASSOCIATION_ATTRIBUTES$1,INPUT_TYPES_THAT_SUPPORT_CHECKED:["RADIO","CHECKBOX"],DOM_EVENTS,USER_GESTURE_EVENTS,BLOCKED_DOM_EVENTS,DATA_PDOM_UNIQUE_ID,PDOM_UNIQUE_ID_SEPARATOR:"-",DATA_EXCLUDE_FROM_INPUT:"data-exclude-from-input"};scenery.register("PDOMUtils",PDOMUtils);const PDOMUtils$1=PDOMUtils,initialProfileName=_.hasIn(window,"phet.chipper.queryParameters.colorProfile")?phet.chipper.queryParameters.colorProfile:SceneryConstants.DEFAULT_COLOR_PROFILE,colorProfiles=_.hasIn(window,"phet.chipper.colorProfiles")?phet.chipper.colorProfiles:[SceneryConstants.DEFAULT_COLOR_PROFILE],colorProfileProperty=new StringProperty(initialProfileName,{tandem:Tandem.GENERAL_VIEW.createTandem("colorProfileProperty"),phetioFeatured:!0,validValues:colorProfiles});scenery.register("colorProfileProperty",colorProfileProperty);const NAME_SEPARATOR=".",instances=[];class ProfileColorProperty extends ColorProperty{constructor(e,t,n,r){const s=optionize()({valueComparisonStrategy:"equalsFunction",tandemNameSuffix:["ColorProperty","FillProperty","StrokeProperty"]},r);if(n=_.mapValues(n,a=>Color.toColor(a).setImmutable()),assert&&assert(n.hasOwnProperty(SceneryConstants.DEFAULT_COLOR_PROFILE),"default color profile must be provided"),assert&&assert(!!n[SceneryConstants.DEFAULT_COLOR_PROFILE],"default color profile must be truthy"),super(Color.toColor(n[colorProfileProperty.value]||n[SceneryConstants.DEFAULT_COLOR_PROFILE]),s),this.colorProfileMap=n,colorProfileProperty.link(a=>{this.value=Color.toColor(this.colorProfileMap[a]||this.colorProfileMap[SceneryConstants.DEFAULT_COLOR_PROFILE])}),this.name=`${e.name}${NAME_SEPARATOR}${t}`,this.link(a=>{window.parent!==window&&window.parent.postMessage(JSON.stringify({type:"reportColor",name:this.name,value:a.toHexString(),alpha:a.getAlpha()}),"*")}),assert){const a=instances.filter(h=>h.name===this.name);assert&&assert(a.length===0,"cannot use the same name for two different ProfileColorProperty instances: "+name)}instances.push(this)}dispose(){arrayRemove(instances,this),super.dispose()}}window.addEventListener("message",o=>{let e;try{e=JSON.parse(o.data)}catch{}if(e&&e.type==="setColor")for(let t=0;t<instances.length;t++){const n=instances[t];n.name===e.name&&(n.colorProfileMap[colorProfileProperty.value]=new Color(e.value).withAlpha(e.alpha),n.value=Color.toColor(n.colorProfileMap[colorProfileProperty.value]))}});scenery.register("ProfileColorProperty",ProfileColorProperty);let globalId$6=1;class Paint{constructor(){this.id=`paint${globalId$6++}`,this.transformMatrix=null}setTransformMatrix(e){return this.transformMatrix!==e&&(this.transformMatrix=e),this}toString(){return this.id}}Paint.prototype.isPaint=!0;scenery.register("Paint",Paint);class Gradient extends Paint{constructor(){super(),assert&&assert(this.constructor.name!=="Gradient","Please create a LinearGradient or RadialGradient. Do not directly use the supertype Gradient."),this.stops=[],this.lastStopRatio=0,this.canvasGradient=null,this.colorStopsDirty=!1,this.lastColorStopValues=[]}addColorStop(e,t){if(assert&&assert(e>=0&&e<=1,"Ratio needs to be between 0,1 inclusively"),assert&&assert(t===null||typeof t=="string"||t instanceof Color||isTReadOnlyProperty(t)&&(t.value===null||typeof t.value=="string"||t.value instanceof Color),"Color should match the addColorStop type specification"),this.lastStopRatio>e)throw new Error("Color stops not specified in the order of increasing ratios");return this.lastStopRatio=e,this.stops.push({ratio:e,color:t}),this.lastColorStopValues.push(""),this}getSVGStops(){return this.stops}invalidateCanvasGradient(){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`Invalidated Canvas Gradient for #${this.id}`),this.colorStopsDirty=!0}haveCanvasColorStopsChanged(){if(this.lastColorStopValues===null)return!0;for(let e=0;e<this.stops.length;e++)if(Gradient.colorToString(this.stops[e].color)!==this.lastColorStopValues[e])return!0;return!1}getCanvasStyle(){if(!this.canvasGradient||this.colorStopsDirty&&this.haveCanvasColorStopsChanged()){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`Regenerating Canvas Gradient for #${this.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.colorStopsDirty=!1,cleanArray(this.lastColorStopValues),this.canvasGradient=this.createCanvasGradient();for(let e=0;e<this.stops.length;e++){const t=this.stops[e],n=Gradient.colorToString(t.color);this.canvasGradient.addColorStop(t.ratio,n),this.lastColorStopValues.push(n)}sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}return this.canvasGradient}static colorToString(e){return isTReadOnlyProperty(e)&&(e=e.value),e===null&&(e="transparent"),e instanceof Color&&(e=e.toCSS()),e}}Gradient.prototype.isGradient=!0;scenery.register("Gradient",Gradient);class LinearGradient extends Gradient{constructor(e,t,n,r){assert&&assert(isFinite(e)&&isFinite(t)&&isFinite(n)&&isFinite(r)),super(),this.start=new Vector2(e,t),this.end=new Vector2(n,r)}createCanvasGradient(){return scenery.scratchContext.createLinearGradient(this.start.x,this.start.y,this.end.x,this.end.y)}createSVGPaint(e){return SVGLinearGradient.pool.create(e,this)}toString(){let e=`new phet.scenery.LinearGradient( ${this.start.x}, ${this.start.y}, ${this.end.x}, ${this.end.y} )`;return _.each(this.stops,t=>{e+=`.addColorStop( ${t.ratio}, ${ColorDef$1.scenerySerialize(t.color)} )`}),e}}LinearGradient.prototype.isLinearGradient=!0;scenery.register("LinearGradient",LinearGradient);class RadialGradient extends Gradient{constructor(e,t,n,r,s,a){if(super(),this.start=new Vector2(e,t),this.end=new Vector2(r,s),platform.safari){const h=(e+r)/2,c=(t+s)/2;this.start.x=h,this.start.y=c,this.end.x=h,this.end.y=c}this.startRadius=n,this.endRadius=a,this.focalPoint=this.start.plus(this.end.minus(this.start).times(this.startRadius/(this.startRadius-this.endRadius))),this.startIsLarger=this.startRadius>this.endRadius,this.largePoint=this.startIsLarger?this.start:this.end,this.maxRadius=Math.max(this.startRadius,this.endRadius),this.minRadius=Math.min(this.startRadius,this.endRadius),this.startRadius>=this.endRadius?assert&&assert(this.focalPoint.minus(this.start).magnitude<=this.startRadius):assert&&assert(this.focalPoint.minus(this.end).magnitude<=this.endRadius)}createCanvasGradient(){return scenery.scratchContext.createRadialGradient(this.start.x,this.start.y,this.startRadius,this.end.x,this.end.y,this.endRadius)}createSVGPaint(e){return SVGRadialGradient.pool.create(e,this)}getSVGStops(){const e=this.startIsLarger,t=this.maxRadius,n=this.minRadius;function r(h,c,d,y,g){return d+(g-h)*(y-d)/(c-h)}function s(h){let c=e?1-h.ratio:h.ratio;return n>0&&(c=r(0,1,n/t,1,c)),{ratio:c,color:h.color}}const a=this.stops.map(s);return e&&a.reverse(),a}toString(){let e=`new phet.scenery.RadialGradient( ${this.start.x}, ${this.start.y}, ${this.startRadius}, ${this.end.x}, ${this.end.y}, ${this.endRadius} )`;return _.each(this.stops,t=>{e+=`.addColorStop( ${t.ratio}, ${ColorDef$1.scenerySerialize(t.color)} )`}),e}}RadialGradient.prototype.isRadialGradient=!0;scenery.register("RadialGradient",RadialGradient);class Pattern extends Paint{constructor(e){super(),this.image=e,this.canvasPattern=scenery.scratchContext.createPattern(e,"repeat")}getCanvasStyle(){return this.canvasPattern}createSVGPaint(e){return SVGPattern.pool.create(this)}toString(){return`new phet.scenery.Pattern( $( '<img src="${this.image.src}"/>' )[0] )`}}Pattern.prototype.isPattern=!0;scenery.register("Pattern",Pattern);class NodePattern extends Pattern{constructor(e,t,n,r,s,a,h=Matrix3.IDENTITY){assert&&assert(t>0&&Number.isInteger(t),"Resolution should be a positive integer"),assert&&assert(Number.isInteger(s)),assert&&assert(Number.isInteger(a));const c=document.createElement("img");function d(g,D,O,V,k){c.src=g.toDataURL()}new Node$2({scale:t,children:[e]}).toCanvas(d,-n*t,-r*t,s*t,a*t),super(c),this.setTransformMatrix(h.timesMatrix(Matrix3.scaling(1/t)))}}scenery.register("NodePattern",NodePattern);let globalId$5=1;class Filter{constructor(){this.id=`filter${globalId$5++}`,this.filterRegionPercentageIncrease=0}isDOMCompatible(){return!1}isSVGCompatible(){return!1}isCanvasCompatible(){return Features.canvasFilter?this.isDOMCompatible():!1}isWebGLCompatible(){return!1}toString(){return this.id}static applyColorMatrix(e,t,n,r){const s=document.createElementNS(svgns,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values",e),s.setAttribute("in",n),s.setAttribute("color-interpolation-filters","sRGB"),r&&s.setAttribute("result",r),t.appendChild(s)}}scenery.register("Filter",Filter);const cache$2=new IOTypeCache,OrIO=o=>{assert&&assert(Array.isArray(o),"OrIO needs to be an array"),assert&&assert(o.length>1,"OrIO needs parameterTypes");const e=o.map(n=>n.typeName),t=e.join(",");if(!cache$2.has(t)){const n=r=>{for(let s=0;s<o.length;s++){const a=o[s];if(Validation.isValueValid(r,a.validator))return!0}return!1};cache$2.set(t,new IOType(`OrIO<${e.join(", ")}>`,{documentation:"A PhET-iO Type adding support for a composite type that can be any of its parameters.",parameterTypes:o,isValidValue:n,toStateObject:r=>{for(let s=0;s<o.length;s++){const a=o[s];if(Validation.isValueValid(r,a.validator))return{index:s,state:a.toStateObject(r)}}throw new Error("somehow the instance was not valid, we should not get here. Why was isValidValue not used before this step?")},fromStateObject:r=>(assert&&assert(r.hasOwnProperty("index"),"index required for deserialization"),assert&&assert(r.hasOwnProperty("state"),"state required for deserialization"),o[r.index].fromStateObject(r.state)),stateSchema:StateSchema.asValue(`${e.join("|")}`,{isValidValue:r=>typeof r.index=="number"?o[r.index].isStateObjectValid(r.state):!1})}))}return cache$2.get(t)};tandemNamespace.register("OrIO",OrIO);class CouldNotYetDeserializeError extends Error{constructor(){super("CouldNotYetDeserializeError")}}tandemNamespace.register("CouldNotYetDeserializeError",CouldNotYetDeserializeError);const cache$1=new IOTypeCache,ReferenceIO=o=>{assert&&assert(o,"ReferenceIO needs parameterType");const e=o;return cache$1.has(e)||(assert&&assert(typeof o.typeName=="string","type name should be a string"),cache$1.set(e,new IOType(`ReferenceIO<${o.typeName}>`,{isValidValue:t=>Validation.isValueValid(t,o.validator),documentation:"Uses reference identity for serializing and deserializing, and validates based on its parameter PhET-iO Type.",parameterTypes:[o],toStateObject(t){return{phetioID:t.tandem.phetioID}},stateSchema:{phetioID:StringIO},fromStateObject(t){if(assert&&assert(t&&typeof t.phetioID=="string","phetioID should be a string"),phet.phetio.phetioEngine.hasPhetioObject(t.phetioID))return phet.phetio.phetioEngine.getPhetioElement(t.phetioID);throw new CouldNotYetDeserializeError},applyState(t){assert&&assert(!1,`ReferenceIO is meant to be used as DataType serialization (see fromStateObject) for phetioID: ${t.tandem.phetioID}`)}}))),cache$1.get(e)};tandemNamespace.register("ReferenceIO",ReferenceIO);const ColorDef={isColorDef(o){return o===null||typeof o=="string"||o instanceof Color||isTReadOnlyProperty(o)&&(o.value===null||typeof o.value=="string"||o.value instanceof Color)},scenerySerialize(o){return o===null?"null":o instanceof Color?`'${o.toCSS()}'`:typeof o=="string"?`'${o}'`:ColorDef.scenerySerialize(o.value)},ColorDefIO:null};ColorDef.ColorDefIO=new IOType("ColorDefIO",{isValidValue:ColorDef.isColorDef,supertype:NullableIO(OrIO([StringIO,Color.ColorIO,ReferenceIO(Property.PropertyIO(NullableIO(OrIO([StringIO,Color.ColorIO]))))]))});scenery.register("ColorDef",ColorDef);const ColorDef$1=ColorDef,PaintDef={isPaintDef(o){return o===null||typeof o=="string"||o instanceof Color||o instanceof Paint||isTReadOnlyProperty(o)&&(o.value===null||typeof o.value=="string"||o.value instanceof Color)},toColor(o){if(typeof o=="string")return new Color(o);if(o instanceof Color)return o.copy();if(isTReadOnlyProperty(o))return PaintDef.toColor(o.value);if(o instanceof Gradient){let e=Color.TRANSPARENT;const t=0;return o.stops.forEach(n=>{e=e.blend(PaintDef.toColor(n.color),1/(t+1))}),e}return Color.TRANSPARENT}};scenery.register("PaintDef",PaintDef);const createGatedVisibleProperty=(o,e,t)=>DerivedProperty.and([o,new BooleanProperty(!0,combineOptions({tandem:e.createTandem("selfVisibleProperty"),phetioFeatured:!0},t))],{tandem:e.createTandem("visibleProperty"),phetioValueType:BooleanIO});scenery.register("createGatedVisibleProperty",createGatedVisibleProperty);const isImageDataSupported=Utils.supportsImageDataCanvasFilter(),useFakeGamma=platform.chromium;class ColorMatrixFilter extends Filter{constructor(e,t,n,r,s,a,h,c,d,y,g,D,O,V,k,M,N,F,G,ie){assert&&assert(isFinite(e),"m00 should be a finite number"),assert&&assert(isFinite(t),"m01 should be a finite number"),assert&&assert(isFinite(n),"m02 should be a finite number"),assert&&assert(isFinite(r),"m03 should be a finite number"),assert&&assert(isFinite(s),"m04 should be a finite number"),assert&&assert(isFinite(a),"m10 should be a finite number"),assert&&assert(isFinite(h),"m11 should be a finite number"),assert&&assert(isFinite(c),"m12 should be a finite number"),assert&&assert(isFinite(d),"m13 should be a finite number"),assert&&assert(isFinite(y),"m14 should be a finite number"),assert&&assert(isFinite(g),"m20 should be a finite number"),assert&&assert(isFinite(D),"m21 should be a finite number"),assert&&assert(isFinite(O),"m22 should be a finite number"),assert&&assert(isFinite(V),"m23 should be a finite number"),assert&&assert(isFinite(k),"m24 should be a finite number"),assert&&assert(isFinite(M),"m30 should be a finite number"),assert&&assert(isFinite(N),"m31 should be a finite number"),assert&&assert(isFinite(F),"m32 should be a finite number"),assert&&assert(isFinite(G),"m33 should be a finite number"),assert&&assert(isFinite(ie),"m34 should be a finite number"),super(),this.m00=e,this.m01=t,this.m02=n,this.m03=r,this.m04=s,this.m10=a,this.m11=h,this.m12=c,this.m13=d,this.m14=y,this.m20=g,this.m21=D,this.m22=O,this.m23=V,this.m24=k,this.m30=M,this.m31=N,this.m32=F,this.m33=G,this.m34=ie}applySVGFilter(e,t,n){Filter.applyColorMatrix(`${toSVGNumber(this.m00)} ${toSVGNumber(this.m01)} ${toSVGNumber(this.m02)} ${toSVGNumber(this.m03)} ${toSVGNumber(this.m04)} ${toSVGNumber(this.m10)} ${toSVGNumber(this.m11)} ${toSVGNumber(this.m12)} ${toSVGNumber(this.m13)} ${toSVGNumber(this.m14)} ${toSVGNumber(this.m20)} ${toSVGNumber(this.m21)} ${toSVGNumber(this.m22)} ${toSVGNumber(this.m23)} ${toSVGNumber(this.m24)} ${toSVGNumber(this.m30)} ${toSVGNumber(this.m31)} ${toSVGNumber(this.m32)} ${toSVGNumber(this.m33)} ${toSVGNumber(this.m34)}`,e,t,n)}applyCanvasFilter(e){const t=e.canvas.width,n=e.canvas.height,r=e.context.getImageData(0,0,t,n),s=t*n;for(let a=0;a<s;a++){const h=a*4;if(useFakeGamma){const d=Math.pow(r.data[h+0]/255,1.45),y=Math.pow(r.data[h+1]/255,1.45),g=Math.pow(r.data[h+2]/255,1.45),D=Math.pow(r.data[h+3]/255,1.45);r.data[h+0]=255*Math.pow(d*this.m00+y*this.m01+g*this.m02+D*this.m03+this.m04,1/1.45),r.data[h+1]=255*Math.pow(d*this.m10+y*this.m11+g*this.m12+D*this.m13+this.m14,1/1.45),r.data[h+2]=255*Math.pow(d*this.m20+y*this.m21+g*this.m22+D*this.m23+this.m24,1/1.45),r.data[h+3]=255*Math.pow(d*this.m30+y*this.m31+g*this.m32+D*this.m33+this.m34,1/1.45)}else{const c=r.data[h+0],d=r.data[h+1],y=r.data[h+2],g=r.data[h+3];r.data[h+0]=c*this.m00+d*this.m01+y*this.m02+g*this.m03+this.m04,r.data[h+1]=c*this.m10+d*this.m11+y*this.m12+g*this.m13+this.m14,r.data[h+2]=c*this.m20+d*this.m21+y*this.m22+g*this.m23+this.m24,r.data[h+3]=c*this.m30+d*this.m31+y*this.m32+g*this.m33+this.m34}}e.context.putImageData(r,0,0)}isSVGCompatible(){return!0}isCanvasCompatible(){return super.isCanvasCompatible()||isImageDataSupported}getCSSFilterString(){throw new Error("unimplemented")}}scenery.register("ColorMatrixFilter",ColorMatrixFilter);const qs=class qs extends ColorMatrixFilter{constructor(e){assert&&assert(isFinite(e),"Brightness amount should be finite"),assert&&assert(e>=0,"Brightness amount should be non-negative"),super(e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0),this.amount=e}getCSSFilterString(){return`brightness(${toSVGNumber(this.amount)})`}isDOMCompatible(){return!0}};qs.BLACKEN=new qs(0);let Brightness=qs;scenery.register("Brightness",Brightness);const Hs=class Hs extends ColorMatrixFilter{constructor(e){assert&&assert(isFinite(e),"Contrast amount should be finite"),assert&&assert(e>=0,"Contrast amount should be non-negative"),super(e,0,0,0,-(.5*e)+.5,0,e,0,0,-(.5*e)+.5,0,0,e,0,-(.5*e)+.5,0,0,0,1,0),this.amount=e}getCSSFilterString(){return`contrast(${toSVGNumber(this.amount)})`}isDOMCompatible(){return!0}};Hs.GRAY=new Hs(0);let Contrast=Hs;scenery.register("Contrast",Contrast);class DropShadow extends Filter{constructor(e,t,n,r=15){assert&&assert(e.isFinite(),"DropShadow offset should be finite"),assert&&assert(isFinite(t),"DropShadow blurRadius should be finite"),assert&&assert(t>=0,"DropShadow blurRadius should be non-negative"),assert&&assert(ColorDef$1.isColorDef(n),"DropShadow color should be a ColorDef"),super(),this.offset=e,this.blurRadius=t,this.color=n,this.colorCSS=PaintDef.toColor(n).toCSS(),this.filterRegionPercentageIncrease=r}getCSSFilterString(){return`drop-shadow(${toSVGNumber(this.offset.x)}px ${toSVGNumber(this.offset.y)}px ${toSVGNumber(this.blurRadius)}px ${this.colorCSS})`}isDOMCompatible(){return!0}applyCanvasFilter(){throw new Error("unimplemented")}applySVGFilter(e,t,n){throw new Error("unimplemented")}}scenery.register("DropShadow",DropShadow);class GaussianBlur extends Filter{constructor(e,t=15){assert&&assert(isFinite(e),"GaussianBlur standardDeviation should be finite"),assert&&assert(e>=0,"GaussianBlur standardDeviation should be non-negative"),super(),this.standardDeviation=e,this.filterRegionPercentageIncrease=t}getCSSFilterString(){return`blur(${toSVGNumber(this.standardDeviation)}px)`}applySVGFilter(e,t,n){const r=document.createElementNS(svgns,"feGaussianBlur");r.setAttribute("stdDeviation",toSVGNumber(this.standardDeviation)),r.setAttribute("edgeMode","none"),e.appendChild(r),r.setAttribute("in",t),n&&r.setAttribute("result",n),e.appendChild(r)}isDOMCompatible(){return!0}isSVGCompatible(){return!0}applyCanvasFilter(e){throw new Error("unimplemented")}}scenery.register("GaussianBlur",GaussianBlur);const Us=class Us extends ColorMatrixFilter{constructor(e=1){assert&&assert(isFinite(e),"Grayscale amount should be finite"),assert&&assert(e>=0,"Grayscale amount should be non-negative"),assert&&assert(e<=1,"Grayscale amount should be no greater than 1");const t=1-e;super(.2126+.7874*t,.7152-.7152*t,.0722-.0722*t,0,0,.2126-.2126*t,.7152+.2848*t,.0722-.0722*t,0,0,.2126-.2126*t,.7152-.7152*t,.0722+.9278*t,0,0,0,0,0,1,0),this.amount=e}getCSSFilterString(){return`grayscale(${toSVGNumber(this.amount)})`}isDOMCompatible(){return!0}};Us.FULL=new Us(1);let Grayscale=Us;scenery.register("Grayscale",Grayscale);class HueRotate extends ColorMatrixFilter{constructor(e){assert&&assert(isFinite(e),"HueRotate amount should be finite"),assert&&assert(e>=0,"HueRotate amount should be non-negative");const t=Math.cos(e),n=Math.sin(e);super(.213+.787*t-.213*n,.715-.715*t-.715*n,.072-.072*t+.928*n,0,0,.213-.213*t+.143*n,.715+.285*t+.14*n,.072-.072*t-.283*n,0,0,.213-.213*t-.787*n,.715-.715*t+.715*n,.072+.928*t+.072*n,0,0,0,0,0,1,0),this.amount=e}getCSSFilterString(){return`hue-rotate(${toSVGNumber(DotUtils.toDegrees(this.amount))}deg)`}isDOMCompatible(){return!0}}scenery.register("HueRotate",HueRotate);const $s=class $s extends Filter{constructor(e=1){assert&&assert(isFinite(e),"Invert amount should be finite"),assert&&assert(e>=0,"Invert amount should be non-negative"),assert&&assert(e<=1,"Invert amount should be no greater than 1"),super(),this.amount=e}getCSSFilterString(){return`invert(${toSVGNumber(this.amount)})`}isDOMCompatible(){return!0}applyCanvasFilter(e){throw new Error("unimplemented")}applySVGFilter(e,t,n){throw new Error("unimplemented")}};$s.FULL=new $s(1);let Invert=$s;scenery.register("Invert",Invert);class Opacity extends Filter{constructor(e){assert&&assert(isFinite(e),"Opacity amount should be finite"),assert&&assert(e>=0,"Opacity amount should be non-negative"),assert&&assert(e<=1,"Opacity amount should be no greater than 1"),super(),this.amount=e}getCSSFilterString(){return`opacity(${toSVGNumber(this.amount)})`}isDOMCompatible(){return!0}applyCanvasFilter(e){throw new Error("unimplemented")}applySVGFilter(e,t,n){throw new Error("unimplemented")}}scenery.register("Opacity",Opacity);class Saturate extends ColorMatrixFilter{constructor(e){assert&&assert(isFinite(e),"Saturate amount should be finite"),assert&&assert(e>=0,"Saturate amount should be non-negative"),super(.213+.787*e,.715-.715*e,.072-.072*e,0,0,.213-.213*e,.715-.285*e,.072-.072*e,0,0,.213-.213*e,.715-.715*e,.072-.928*e,0,0,0,0,0,1,0),this.amount=e}getCSSFilterString(){return`saturate(${toSVGNumber(this.amount)})`}isDOMCompatible(){return!0}}scenery.register("Saturate",Saturate);const Gs=class Gs extends ColorMatrixFilter{constructor(e=1){assert&&assert(isFinite(e),"Sepia amount should be finite"),assert&&assert(e>=0,"Sepia amount should be non-negative"),assert&&assert(e<=1,"Sepia amount should be at most 1"),super(.393+.607*(1-e),.769-.769*(1-e),.189-.189*(1-e),0,0,.349-.349*(1-e),.686+.314*(1-e),.168-.168*(1-e),0,0,.272-.272*(1-e),.534-.534*(1-e),.131+.869*(1-e),0,0,0,0,0,1,0),this.amount=e}getCSSFilterString(){return`sepia(${toSVGNumber(this.amount)})`}isDOMCompatible(){return!0}};Gs.FULL=new Gs(1);let Sepia=Gs;scenery.register("Sepia",Sepia);const INPUT_TAG$1=PDOMUtils$1.TAGS.INPUT,P_TAG=PDOMUtils$1.TAGS.P,DEFAULT_DESCRIPTION_TAG_NAME=P_TAG,DEFAULT_LABEL_TAG_NAME=P_TAG,DEFAULT_PDOM_HEADING_BEHAVIOR=(o,e,t)=>(e.labelTagName=`h${o.headingLevel}`,e.labelContent=t,e),unwrapProperty=o=>{const e=o===null?null:typeof o=="string"?o:o.value;return assert&&assert(e===null||typeof e=="string"),e},FORM_ELEMENTS=PDOMUtils$1.FORM_ELEMENTS,INPUT_TYPES_THAT_SUPPORT_CHECKED=PDOMUtils$1.INPUT_TYPES_THAT_SUPPORT_CHECKED,ASSOCIATION_ATTRIBUTES=PDOMUtils$1.ASSOCIATION_ATTRIBUTES,ACCESSIBILITY_OPTION_KEYS=["focusable","tagName","accessibleName","accessibleNameBehavior","helpText","helpTextBehavior","pdomHeading","pdomHeadingBehavior","containerTagName","containerAriaRole","innerContent","inputType","inputValue","pdomChecked","pdomNamespace","ariaLabel","ariaRole","ariaValueText","labelTagName","labelContent","appendLabel","descriptionTagName","descriptionContent","appendDescription","focusHighlight","focusHighlightLayerable","groupFocusHighlight","pdomVisibleProperty","pdomVisible","pdomOrder","ariaLabelledbyAssociations","ariaDescribedbyAssociations","activeDescendantAssociations","focusPanTargetBoundsProperty","limitPanDirection","positionInPDOM","pdomTransformSourceNode"];class ParallelDOM extends PhetioObject{constructor(e){super(e),this._inputValue=null,this._labelContent=null,this._innerContent=null,this._descriptionContent=null,this._ariaLabel=null,this._hasAppliedAriaLabel=!1,this._ariaValueText=null,this._hasAppliedAriaValueText=!1,this._accessibleName=null,this._helpText=null,this._pdomHeading=null,this.focusHighlightChangedEmitter=new TinyEmitter,this.pdomParentChangedEmitter=new TinyEmitter,this.pdomDisplaysEmitter=new TinyEmitter,this._onPDOMContentChangeListener=this.onPDOMContentChange.bind(this),this._onInputValueChangeListener=this.invalidatePeerInputValue.bind(this),this._onAriaLabelChangeListener=this.onAriaLabelChange.bind(this),this._onAriaValueTextChangeListener=this.onAriaValueTextChange.bind(this),this._onLabelContentChangeListener=this.invalidatePeerLabelSiblingContent.bind(this),this._onDescriptionContentChangeListener=this.invalidatePeerDescriptionSiblingContent.bind(this),this._onInnerContentChangeListener=this.onInnerContentPropertyChange.bind(this),this._tagName=null,this._containerTagName=null,this._labelTagName=null,this._descriptionTagName=null,this._inputType=null,this._pdomChecked=!1,this._appendLabel=!1,this._appendDescription=!1,this._pdomAttributes=[],this._pdomClasses=[],this._pdomNamespace=null,this._ariaRole=null,this._containerAriaRole=null,this._ariaLabelledbyAssociations=[],this._nodesThatAreAriaLabelledbyThisNode=[],this._ariaDescribedbyAssociations=[],this._nodesThatAreAriaDescribedbyThisNode=[],this._activeDescendantAssociations=[],this._nodesThatAreActiveDescendantToThisNode=[],this._focusableOverride=null,this._focusHighlight=null,this._focusHighlightLayerable=!1,this._groupFocusHighlight=!1,this._pdomOrder=null,this._pdomParent=null,this._pdomTransformSourceNode=null,this._focusPanTargetBoundsProperty=null,this._limitPanDirection=null,this._pdomDisplaysInfo=new PDOMDisplaysInfo(this),this._pdomInstances=[],this._positionInPDOM=!1,this.excludeLabelSiblingFromInput=!1,this._pdomVisibleProperty=new TinyForwardingProperty(!0,!1,this.onPdomVisiblePropertyChange.bind(this)),this._accessibleNameBehavior=ParallelDOM.BASIC_ACCESSIBLE_NAME_BEHAVIOR,this._helpTextBehavior=ParallelDOM.HELP_TEXT_AFTER_CONTENT,this._headingLevel=null,this._pdomHeadingBehavior=DEFAULT_PDOM_HEADING_BEHAVIOR,this.pdomBoundInputEnabledListener=this.pdomInputEnabledListener.bind(this)}disposeParallelDOM(){isTReadOnlyProperty(this._accessibleName)&&!this._accessibleName.isDisposed&&(this._accessibleName.unlink(this._onPDOMContentChangeListener),this._accessibleName=null),isTReadOnlyProperty(this._helpText)&&!this._helpText.isDisposed&&(this._helpText.unlink(this._onPDOMContentChangeListener),this._helpText=null),isTReadOnlyProperty(this._pdomHeading)&&!this._pdomHeading.isDisposed&&(this._pdomHeading.unlink(this._onPDOMContentChangeListener),this._pdomHeading=null),isTReadOnlyProperty(this._inputValue)&&!this._inputValue.isDisposed&&(this._inputValue.unlink(this._onPDOMContentChangeListener),this._inputValue=null),isTReadOnlyProperty(this._ariaLabel)&&!this._ariaLabel.isDisposed&&this._ariaLabel.unlink(this._onAriaLabelChangeListener),isTReadOnlyProperty(this._ariaValueText)&&!this._ariaValueText.isDisposed&&this._ariaValueText.unlink(this._onAriaValueTextChangeListener),isTReadOnlyProperty(this._innerContent)&&!this._innerContent.isDisposed&&this._innerContent.unlink(this._onInnerContentChangeListener),isTReadOnlyProperty(this._labelContent)&&!this._labelContent.isDisposed&&this._labelContent.unlink(this._onLabelContentChangeListener),isTReadOnlyProperty(this._descriptionContent)&&!this._descriptionContent.isDisposed&&this._descriptionContent.unlink(this._onDescriptionContentChangeListener),this.inputEnabledProperty.unlink(this.pdomBoundInputEnabledListener),this.pdomOrder=null,this.setPDOMTransformSourceNode(null),this.setAriaLabelledbyAssociations([]),this.setAriaDescribedbyAssociations([]),this.setActiveDescendantAssociations([]),this.removePDOMAttributes(),this._pdomVisibleProperty.dispose()}pdomInputEnabledListener(e){this.setPDOMAttribute("aria-disabled",!e),this.setPDOMAttribute("onclick",e?"":"return false")}isFocused(){for(let e=0;e<this._pdomInstances.length;e++)if(this._pdomInstances[e].peer.isFocused())return!0;return!1}get focused(){return this.isFocused()}focus(){if(this._pdomInstances.length>0){assert&&assert(this.focusable,"trying to set focus on a node that is not focusable"),assert&&assert(this.pdomVisible,"trying to set focus on a node with invisible pdom content"),assert&&assert(this._pdomInstances.length===1,"focus() unsupported for Nodes using DAG, pdom content is not unique");const e=this._pdomInstances[0].peer;assert&&assert(e,"must have a peer to focus"),e.focus()}}blur(){if(this._pdomInstances.length>0){assert&&assert(this._pdomInstances.length===1,"blur() unsupported for Nodes using DAG, pdom content is not unique");const e=this._pdomInstances[0].peer;assert&&assert(e,"must have a peer to blur"),e.blur()}}pdomAudit(){this.hasPDOMContent&&assert&&(this._inputType&&assert(this._tagName.toUpperCase()===INPUT_TAG$1,"tagName must be INPUT to support inputType"),this._pdomChecked&&assert(this._tagName.toUpperCase()===INPUT_TAG$1,"tagName must be INPUT to support pdomChecked."),this._inputValue&&assert(this._tagName.toUpperCase()===INPUT_TAG$1,"tagName must be INPUT to support inputValue"),this._pdomChecked&&assert(INPUT_TYPES_THAT_SUPPORT_CHECKED.includes(this._inputType.toUpperCase()),`inputType does not support checked attribute: ${this._inputType}`),this._focusHighlightLayerable&&assert(this.focusHighlight instanceof Node$2,"focusHighlight must be Node if highlight is layerable"),this._tagName.toUpperCase()===INPUT_TAG$1&&assert(typeof this._inputType=="string"," inputType expected for input"),this.ariaRole==="application"&&assert(this.innerContent||this.accessibleName,"must have some innerContent or element will never be focusable in VoiceOver"));for(let e=0;e<this.children.length;e++)this.children[e].pdomAudit()}setAccessibleName(e){e!==this._accessibleName&&(isTReadOnlyProperty(this._accessibleName)&&!this._accessibleName.isDisposed&&this._accessibleName.unlink(this._onPDOMContentChangeListener),this._accessibleName=e,isTReadOnlyProperty(e)&&e.lazyLink(this._onPDOMContentChangeListener),this.onPDOMContentChange())}set accessibleName(e){this.setAccessibleName(e)}get accessibleName(){return this.getAccessibleName()}getAccessibleName(){return isTReadOnlyProperty(this._accessibleName)?this._accessibleName.value:this._accessibleName}removeFromPDOM(){assert&&assert(this._tagName!==null,"There is no pdom content to clear from the PDOM"),this.tagName=null}setAccessibleNameBehavior(e){this._accessibleNameBehavior!==e&&(this._accessibleNameBehavior=e,this.onPDOMContentChange())}set accessibleNameBehavior(e){this.setAccessibleNameBehavior(e)}get accessibleNameBehavior(){return this.getAccessibleNameBehavior()}getAccessibleNameBehavior(){return this._accessibleNameBehavior}setPDOMHeading(e){e!==this._pdomHeading&&(isTReadOnlyProperty(this._pdomHeading)&&!this._pdomHeading.isDisposed&&this._pdomHeading.unlink(this._onPDOMContentChangeListener),this._pdomHeading=e,isTReadOnlyProperty(e)&&e.lazyLink(this._onPDOMContentChangeListener),this.onPDOMContentChange())}set pdomHeading(e){this.setPDOMHeading(e)}get pdomHeading(){return this.getPDOMHeading()}getPDOMHeading(){return isTReadOnlyProperty(this._pdomHeading)?this._pdomHeading.value:this._pdomHeading}setPDOMHeadingBehavior(e){this._pdomHeadingBehavior!==e&&(this._pdomHeadingBehavior=e,this.onPDOMContentChange())}set pdomHeadingBehavior(e){this.setPDOMHeadingBehavior(e)}get pdomHeadingBehavior(){return this.getPDOMHeadingBehavior()}getPDOMHeadingBehavior(){return this._pdomHeadingBehavior}getHeadingLevel(){return this._headingLevel}get headingLevel(){return this.getHeadingLevel()}computeHeadingLevel(){if(!this._pdomParent)return this.pdomHeading?(this._headingLevel=1,1):0;if(this.pdomHeading){const e=this._pdomParent.computeHeadingLevel()+1;return this._headingLevel=e,e}else return this._pdomParent.computeHeadingLevel()}setHelpText(e){e!==this._helpText&&(isTReadOnlyProperty(this._helpText)&&!this._helpText.isDisposed&&this._helpText.unlink(this._onPDOMContentChangeListener),this._helpText=e,isTReadOnlyProperty(e)&&e.lazyLink(this._onPDOMContentChangeListener),this.onPDOMContentChange())}set helpText(e){this.setHelpText(e)}get helpText(){return this.getHelpText()}getHelpText(){return isTReadOnlyProperty(this._helpText)?this._helpText.value:this._helpText}setHelpTextBehavior(e){this._helpTextBehavior!==e&&(this._helpTextBehavior=e,this.onPDOMContentChange())}set helpTextBehavior(e){this.setHelpTextBehavior(e)}get helpTextBehavior(){return this.getHelpTextBehavior()}getHelpTextBehavior(){return this._helpTextBehavior}setTagName(e){assert&&assert(e===null||typeof e=="string"),e!==this._tagName&&(this._tagName=e,this.onPDOMContentChange())}set tagName(e){this.setTagName(e)}get tagName(){return this.getTagName()}getTagName(){return this._tagName}setLabelTagName(e){assert&&assert(e===null||typeof e=="string"),e!==this._labelTagName&&(this._labelTagName=e,this.onPDOMContentChange())}set labelTagName(e){this.setLabelTagName(e)}get labelTagName(){return this.getLabelTagName()}getLabelTagName(){return this._labelTagName}setDescriptionTagName(e){assert&&assert(e===null||typeof e=="string"),e!==this._descriptionTagName&&(this._descriptionTagName=e,this.onPDOMContentChange())}set descriptionTagName(e){this.setDescriptionTagName(e)}get descriptionTagName(){return this.getDescriptionTagName()}getDescriptionTagName(){return this._descriptionTagName}setInputType(e){if(assert&&assert(e===null||typeof e=="string"),assert&&this.tagName&&assert(this._tagName.toUpperCase()===INPUT_TAG$1,"tag name must be INPUT to support inputType"),e!==this._inputType){this._inputType=e;for(let t=0;t<this._pdomInstances.length;t++){const n=this._pdomInstances[t].peer;e===null?n.removeAttributeFromElement("type"):n.setAttributeToElement("type",e)}}}set inputType(e){this.setInputType(e)}get inputType(){return this.getInputType()}getInputType(){return this._inputType}setAppendLabel(e){this._appendLabel!==e&&(this._appendLabel=e,this.onPDOMContentChange())}set appendLabel(e){this.setAppendLabel(e)}get appendLabel(){return this.getAppendLabel()}getAppendLabel(){return this._appendLabel}setAppendDescription(e){this._appendDescription!==e&&(this._appendDescription=e,this.onPDOMContentChange())}set appendDescription(e){this.setAppendDescription(e)}get appendDescription(){return this.getAppendDescription()}getAppendDescription(){return this._appendDescription}setContainerTagName(e){assert&&assert(e===null||typeof e=="string",`invalid tagName argument: ${e}`),this._containerTagName!==e&&(this._containerTagName=e,this.onPDOMContentChange())}set containerTagName(e){this.setContainerTagName(e)}get containerTagName(){return this.getContainerTagName()}getContainerTagName(){return this._containerTagName}invalidatePeerLabelSiblingContent(){const e=this.labelContent;this._labelTagName||this.setLabelTagName(DEFAULT_LABEL_TAG_NAME);for(let t=0;t<this._pdomInstances.length;t++)this._pdomInstances[t].peer.setLabelSiblingContent(e)}setLabelContent(e){e!==this._labelContent&&(isTReadOnlyProperty(this._labelContent)&&!this._labelContent.isDisposed&&this._labelContent.unlink(this._onLabelContentChangeListener),this._labelContent=e,isTReadOnlyProperty(e)&&e.lazyLink(this._onLabelContentChangeListener),this.invalidatePeerLabelSiblingContent())}set labelContent(e){this.setLabelContent(e)}get labelContent(){return this.getLabelContent()}getLabelContent(){return unwrapProperty(this._labelContent)}onInnerContentPropertyChange(){const e=this.innerContent;for(let t=0;t<this._pdomInstances.length;t++)this._pdomInstances[t].peer.setPrimarySiblingContent(e)}setInnerContent(e){e!==this._innerContent&&(isTReadOnlyProperty(this._innerContent)&&!this._innerContent.isDisposed&&this._innerContent.unlink(this._onInnerContentChangeListener),this._innerContent=e,isTReadOnlyProperty(e)&&e.lazyLink(this._onInnerContentChangeListener),this.onInnerContentPropertyChange())}set innerContent(e){this.setInnerContent(e)}get innerContent(){return this.getInnerContent()}getInnerContent(){return unwrapProperty(this._innerContent)}invalidatePeerDescriptionSiblingContent(){const e=this.descriptionContent;this._descriptionTagName||this.setDescriptionTagName(DEFAULT_DESCRIPTION_TAG_NAME);for(let t=0;t<this._pdomInstances.length;t++)this._pdomInstances[t].peer.setDescriptionSiblingContent(e)}setDescriptionContent(e){e!==this._descriptionContent&&(isTReadOnlyProperty(this._descriptionContent)&&!this._descriptionContent.isDisposed&&this._descriptionContent.unlink(this._onDescriptionContentChangeListener),this._descriptionContent=e,isTReadOnlyProperty(e)&&e.lazyLink(this._onDescriptionContentChangeListener),this.invalidatePeerDescriptionSiblingContent())}set descriptionContent(e){this.setDescriptionContent(e)}get descriptionContent(){return this.getDescriptionContent()}getDescriptionContent(){return unwrapProperty(this._descriptionContent)}setAriaRole(e){assert&&assert(e===null||typeof e=="string"),this._ariaRole!==e&&(this._ariaRole=e,e!==null?this.setPDOMAttribute("role",e):this.removePDOMAttribute("role"))}set ariaRole(e){this.setAriaRole(e)}get ariaRole(){return this.getAriaRole()}getAriaRole(){return this._ariaRole}setContainerAriaRole(e){assert&&assert(e===null||typeof e=="string"),this._containerAriaRole!==e&&(this._containerAriaRole=e,e===null?this.removePDOMAttribute("role",{elementName:PDOMPeer$1.CONTAINER_PARENT}):this.setPDOMAttribute("role",e,{elementName:PDOMPeer$1.CONTAINER_PARENT}))}set containerAriaRole(e){this.setContainerAriaRole(e)}get containerAriaRole(){return this.getContainerAriaRole()}getContainerAriaRole(){return this._containerAriaRole}onAriaValueTextChange(){const e=this.ariaValueText;e===null?this._hasAppliedAriaLabel&&(this.removePDOMAttribute("aria-valuetext"),this._hasAppliedAriaLabel=!1):(this.setPDOMAttribute("aria-valuetext",e),this._hasAppliedAriaLabel=!0)}setAriaValueText(e){this._ariaValueText!==e&&(isTReadOnlyProperty(this._ariaValueText)&&!this._ariaValueText.isDisposed&&this._ariaValueText.unlink(this._onAriaValueTextChangeListener),this._ariaValueText=e,isTReadOnlyProperty(e)&&e.lazyLink(this._onAriaValueTextChangeListener),this.onAriaValueTextChange())}set ariaValueText(e){this.setAriaValueText(e)}get ariaValueText(){return this.getAriaValueText()}getAriaValueText(){return unwrapProperty(this._ariaValueText)}setPDOMNamespace(e){return assert&&assert(e===null||typeof e=="string"),this._pdomNamespace!==e&&(this._pdomNamespace=e,this.onPDOMContentChange()),this}set pdomNamespace(e){this.setPDOMNamespace(e)}get pdomNamespace(){return this.getPDOMNamespace()}getPDOMNamespace(){return this._pdomNamespace}onAriaLabelChange(){const e=this.ariaLabel;e===null?this._hasAppliedAriaLabel&&(this.removePDOMAttribute("aria-label"),this._hasAppliedAriaLabel=!1):(this.setPDOMAttribute("aria-label",e),this._hasAppliedAriaLabel=!0)}setAriaLabel(e){this._ariaLabel!==e&&(isTReadOnlyProperty(this._ariaLabel)&&!this._ariaLabel.isDisposed&&this._ariaLabel.unlink(this._onAriaLabelChangeListener),this._ariaLabel=e,isTReadOnlyProperty(e)&&e.lazyLink(this._onAriaLabelChangeListener),this.onAriaLabelChange())}set ariaLabel(e){this.setAriaLabel(e)}get ariaLabel(){return this.getAriaLabel()}getAriaLabel(){return unwrapProperty(this._ariaLabel)}setFocusHighlight(e){this._focusHighlight!==e&&(this._focusHighlight=e,this._focusHighlightLayerable&&(assert&&assert(e instanceof Node$2),e.visible=!1),this.focusHighlightChangedEmitter.emit())}set focusHighlight(e){this.setFocusHighlight(e)}get focusHighlight(){return this.getFocusHighlight()}getFocusHighlight(){return this._focusHighlight}setFocusHighlightLayerable(e){this._focusHighlightLayerable!==e&&(this._focusHighlightLayerable=e,this._focusHighlight&&(assert&&assert(this._focusHighlight instanceof Node$2),this._focusHighlight.visible=!1,this.focusHighlightChangedEmitter.emit()))}set focusHighlightLayerable(e){this.setFocusHighlightLayerable(e)}get focusHighlightLayerable(){return this.getFocusHighlightLayerable()}getFocusHighlightLayerable(){return this._focusHighlightLayerable}setGroupFocusHighlight(e){this._groupFocusHighlight=e}set groupFocusHighlight(e){this.setGroupFocusHighlight(e)}get groupFocusHighlight(){return this.getGroupFocusHighlight()}getGroupFocusHighlight(){return this._groupFocusHighlight}setAriaLabelledbyAssociations(e){let t,n;if(assert)for(assert(Array.isArray(e)),n=0;n<e.length;n++)t=e[n];if(e.length===0&&this._ariaLabelledbyAssociations.length===0)return;const r=[],s=[],a=[];for(arrayDifference(e,this._ariaLabelledbyAssociations,s,r,a),n=0;n<r.length;n++)t=r[n],this.removeAriaLabelledbyAssociation(t);for(assert&&assert(this._ariaLabelledbyAssociations.length===a.length,"Removing associations should not have triggered other association changes"),n=0;n<s.length;n++){const h=e[n];this.addAriaLabelledbyAssociation(h)}}set ariaLabelledbyAssociations(e){this.setAriaLabelledbyAssociations(e)}get ariaLabelledbyAssociations(){return this.getAriaLabelledbyAssociations()}getAriaLabelledbyAssociations(){return this._ariaLabelledbyAssociations}addAriaLabelledbyAssociation(e){this._ariaLabelledbyAssociations.push(e),e.otherNode._nodesThatAreAriaLabelledbyThisNode.push(this),this.updateAriaLabelledbyAssociationsInPeers()}removeAriaLabelledbyAssociation(e){assert&&assert(_.includes(this._ariaLabelledbyAssociations,e)),this._ariaLabelledbyAssociations.splice(_.indexOf(this._ariaLabelledbyAssociations,e),1)[0].otherNode.removeNodeThatIsAriaLabelledByThisNode(this),this.updateAriaLabelledbyAssociationsInPeers()}removeNodeThatIsAriaLabelledByThisNode(e){const t=_.indexOf(this._nodesThatAreAriaLabelledbyThisNode,e);assert&&assert(t>=0),this._nodesThatAreAriaLabelledbyThisNode.splice(t,1)}updateAriaLabelledbyAssociationsInPeers(){for(let e=0;e<this.pdomInstances.length;e++)this.pdomInstances[e].peer.onAriaLabelledbyAssociationChange()}updateOtherNodesAriaLabelledby(){for(let e=0;e<this._nodesThatAreAriaLabelledbyThisNode.length;e++)this._nodesThatAreAriaLabelledbyThisNode[e].updateAriaLabelledbyAssociationsInPeers()}getNodesThatAreAriaLabelledbyThisNode(){return this._nodesThatAreAriaLabelledbyThisNode}get nodesThatAreAriaLabelledbyThisNode(){return this.getNodesThatAreAriaLabelledbyThisNode()}setAriaDescribedbyAssociations(e){let t;if(assert){assert(Array.isArray(e));for(let h=0;h<e.length;h++)t=e[h]}if(e.length===0&&this._ariaDescribedbyAssociations.length===0)return;const n=[],r=[],s=[];let a;for(arrayDifference(e,this._ariaDescribedbyAssociations,r,n,s),a=0;a<n.length;a++)t=n[a],this.removeAriaDescribedbyAssociation(t);for(assert&&assert(this._ariaDescribedbyAssociations.length===s.length,"Removing associations should not have triggered other association changes"),a=0;a<r.length;a++){const h=e[a];this.addAriaDescribedbyAssociation(h)}}set ariaDescribedbyAssociations(e){this.setAriaDescribedbyAssociations(e)}get ariaDescribedbyAssociations(){return this.getAriaDescribedbyAssociations()}getAriaDescribedbyAssociations(){return this._ariaDescribedbyAssociations}addAriaDescribedbyAssociation(e){assert&&assert(!_.includes(this._ariaDescribedbyAssociations,e),"describedby association already registed"),this._ariaDescribedbyAssociations.push(e),e.otherNode._nodesThatAreAriaDescribedbyThisNode.push(this),this.updateAriaDescribedbyAssociationsInPeers()}hasAriaDescribedbyAssociation(e){return _.includes(this._ariaDescribedbyAssociations,e)}removeAriaDescribedbyAssociation(e){assert&&assert(_.includes(this._ariaDescribedbyAssociations,e)),this._ariaDescribedbyAssociations.splice(_.indexOf(this._ariaDescribedbyAssociations,e),1)[0].otherNode.removeNodeThatIsAriaDescribedByThisNode(this),this.updateAriaDescribedbyAssociationsInPeers()}removeNodeThatIsAriaDescribedByThisNode(e){const t=_.indexOf(this._nodesThatAreAriaDescribedbyThisNode,e);assert&&assert(t>=0),this._nodesThatAreAriaDescribedbyThisNode.splice(t,1)}updateAriaDescribedbyAssociationsInPeers(){for(let e=0;e<this.pdomInstances.length;e++)this.pdomInstances[e].peer.onAriaDescribedbyAssociationChange()}updateOtherNodesAriaDescribedby(){for(let e=0;e<this._nodesThatAreAriaDescribedbyThisNode.length;e++)this._nodesThatAreAriaDescribedbyThisNode[e].updateAriaDescribedbyAssociationsInPeers()}getNodesThatAreAriaDescribedbyThisNode(){return this._nodesThatAreAriaDescribedbyThisNode}get nodesThatAreAriaDescribedbyThisNode(){return this.getNodesThatAreAriaDescribedbyThisNode()}setActiveDescendantAssociations(e){let t;if(assert){assert(Array.isArray(e));for(let h=0;h<e.length;h++)t=e[h]}if(e.length===0&&this._activeDescendantAssociations.length===0)return;const n=[],r=[],s=[];let a;for(arrayDifference(e,this._activeDescendantAssociations,r,n,s),a=0;a<n.length;a++)t=n[a],this.removeActiveDescendantAssociation(t);for(assert&&assert(this._activeDescendantAssociations.length===s.length,"Removing associations should not have triggered other association changes"),a=0;a<r.length;a++){const h=e[a];this.addActiveDescendantAssociation(h)}}set activeDescendantAssociations(e){this.setActiveDescendantAssociations(e)}get activeDescendantAssociations(){return this.getActiveDescendantAssociations()}getActiveDescendantAssociations(){return this._activeDescendantAssociations}addActiveDescendantAssociation(e){this._activeDescendantAssociations.push(e),e.otherNode._nodesThatAreActiveDescendantToThisNode.push(this),this.updateActiveDescendantAssociationsInPeers()}removeActiveDescendantAssociation(e){assert&&assert(_.includes(this._activeDescendantAssociations,e)),this._activeDescendantAssociations.splice(_.indexOf(this._activeDescendantAssociations,e),1)[0].otherNode.removeNodeThatIsActiveDescendantThisNode(this),this.updateActiveDescendantAssociationsInPeers()}removeNodeThatIsActiveDescendantThisNode(e){const t=_.indexOf(this._nodesThatAreActiveDescendantToThisNode,e);assert&&assert(t>=0),this._nodesThatAreActiveDescendantToThisNode.splice(t,1)}updateActiveDescendantAssociationsInPeers(){for(let e=0;e<this.pdomInstances.length;e++)this.pdomInstances[e].peer.onActiveDescendantAssociationChange()}updateOtherNodesActiveDescendant(){for(let e=0;e<this._nodesThatAreActiveDescendantToThisNode.length;e++)this._nodesThatAreActiveDescendantToThisNode[e].updateActiveDescendantAssociationsInPeers()}getNodesThatAreActiveDescendantToThisNode(){return this._nodesThatAreActiveDescendantToThisNode}get nodesThatAreActiveDescendantToThisNode(){return this.getNodesThatAreActiveDescendantToThisNode()}setPDOMOrder(e){if(assert&&assert(Array.isArray(e)||e===null,`Array or null expected, received: ${e}`),assert&&e&&e.forEach((t,n)=>{assert&&assert(t===null||t instanceof Node$2,`Elements of pdomOrder should be either a Node or null. Element at index ${n} is: ${t}`)}),assert&&e&&assert(this.getTrails(t=>_.includes(e,t)).length===0,"pdomOrder should not include any ancestors or the node itself"),this._pdomOrder!==e){const t=this._pdomOrder;this._pdomOrder=e===null?null:e.slice(),PDOMTree$1.pdomOrderChange(this,t,e),this.rendererSummaryRefreshEmitter.emit()}}set pdomOrder(e){this.setPDOMOrder(e)}get pdomOrder(){return this.getPDOMOrder()}getPDOMOrder(){return this._pdomOrder?this._pdomOrder.slice(0):this._pdomOrder}hasPDOMOrder(){return this._pdomOrder!==null&&this._pdomOrder.length!==0&&(this._pdomOrder.length>1||this._pdomOrder[0]!==null)}getPDOMParent(){return this._pdomParent}get pdomParent(){return this.getPDOMParent()}getEffectiveChildren(){const e=[];for(let t=0;t<this._children.length;t++){const n=this._children[t];n._pdomParent||e.push(n)}if(this.hasPDOMOrder()){const t=this.pdomOrder.slice(),n=t.indexOf(null);return n>=0?(e.unshift(n,1),Array.prototype.splice.apply(t,e)):Array.prototype.push.apply(t,e),t}else return e}onPdomVisiblePropertyChange(e){this._pdomDisplaysInfo.onPDOMVisibilityChange(e)}setPdomVisibleProperty(e){return this._pdomVisibleProperty.setTargetProperty(e),this}set pdomVisibleProperty(e){this.setPdomVisibleProperty(e)}get pdomVisibleProperty(){return this.getPdomVisibleProperty()}getPdomVisibleProperty(){return this._pdomVisibleProperty}setPDOMVisible(e){this.pdomVisibleProperty.value=e}set pdomVisible(e){this.setPDOMVisible(e)}get pdomVisible(){return this.isPDOMVisible()}isPDOMVisible(){return this.pdomVisibleProperty.value}isPDOMDisplayed(){for(let e=0;e<this._pdomInstances.length;e++)if(this._pdomInstances[e].isGloballyVisible())return!0;return!1}get pdomDisplayed(){return this.isPDOMDisplayed()}invalidatePeerInputValue(){for(let e=0;e<this.pdomInstances.length;e++)this.pdomInstances[e].peer.onInputValueChange()}setInputValue(e){assert&&this._tagName&&assert(_.includes(FORM_ELEMENTS,this._tagName.toUpperCase()),"dom element must be a form element to support value"),e!==this._inputValue&&(isTReadOnlyProperty(this._inputValue)&&!this._inputValue.isDisposed&&this._inputValue.unlink(this._onPDOMContentChangeListener),this._inputValue=e,isTReadOnlyProperty(e)&&e.lazyLink(this._onPDOMContentChangeListener),this.invalidatePeerInputValue())}set inputValue(e){this.setInputValue(e)}get inputValue(){return this.getInputValue()}getInputValue(){let e;return isTReadOnlyProperty(this._inputValue)?e=this._inputValue.value:e=this._inputValue,e===null?null:""+e}setPDOMChecked(e){this._tagName&&assert&&assert(this._tagName.toUpperCase()===INPUT_TAG$1,"Cannot set checked on a non input tag."),this._inputType&&assert&&assert(INPUT_TYPES_THAT_SUPPORT_CHECKED.includes(this._inputType.toUpperCase()),`inputType does not support checked: ${this._inputType}`),this._pdomChecked!==e&&(this._pdomChecked=e,this.setPDOMAttribute("checked",e,{asProperty:!0}))}set pdomChecked(e){this.setPDOMChecked(e)}get pdomChecked(){return this.getPDOMChecked()}getPDOMChecked(){return this._pdomChecked}getPDOMAttributes(){return this._pdomAttributes.slice(0)}get pdomAttributes(){return this.getPDOMAttributes()}setPDOMAttribute(e,t,n){assert&&n&&assert(Object.getPrototypeOf(n)===Object.prototype,"Extra prototype on pdomAttribute options object is a code smell");const r=optionize()({namespace:null,asProperty:!1,elementName:PDOMPeer$1.PRIMARY_SIBLING},n);assert&&assert(!ASSOCIATION_ATTRIBUTES.includes(e),"setPDOMAttribute does not support association attributes");for(let a=0;a<this._pdomAttributes.length;a++){const h=this._pdomAttributes[a];h.attribute===e&&h.options.namespace===r.namespace&&h.options.elementName===r.elementName&&(h.options.asProperty===r.asProperty?this._pdomAttributes.splice(a,1):this.removePDOMAttribute(h.attribute,h.options))}let s=a=>{assert&&typeof a=="string"&&validate(a,Validation.STRING_WITHOUT_TEMPLATE_VARS_VALIDATOR);for(let h=0;h<this._pdomInstances.length;h++)this._pdomInstances[h].peer.setAttributeToElement(e,a,r)};isTReadOnlyProperty(t)?t.link(s):(s(t),s=null),this._pdomAttributes.push({attribute:e,value:t,listener:s,options:r})}removePDOMAttribute(e,t){assert&&t&&assert(Object.getPrototypeOf(t)===Object.prototype,"Extra prototype on pdomAttribute options object is a code smell");const n=optionize()({namespace:null,elementName:PDOMPeer$1.PRIMARY_SIBLING},t);let r=!1;for(let s=0;s<this._pdomAttributes.length;s++)if(this._pdomAttributes[s].attribute===e&&this._pdomAttributes[s].options.namespace===n.namespace&&this._pdomAttributes[s].options.elementName===n.elementName){const a=this._pdomAttributes[s];a.listener&&isTReadOnlyProperty(a.value)&&!a.value.isDisposed&&a.value.unlink(a.listener),this._pdomAttributes.splice(s,1),r=!0}assert&&assert(r,`Node does not have pdom attribute ${e}`);for(let s=0;s<this._pdomInstances.length;s++)this._pdomInstances[s].peer.removeAttributeFromElement(e,n)}removePDOMAttributes(){const e=this.getPDOMAttributes();for(let t=0;t<e.length;t++){const n=e[t].attribute;this.removePDOMAttribute(n)}}hasPDOMAttribute(e,t){assert&&t&&assert(Object.getPrototypeOf(t)===Object.prototype,"Extra prototype on pdomAttribute options object is a code smell");const n=optionize()({namespace:null,elementName:PDOMPeer$1.PRIMARY_SIBLING},t);let r=!1;for(let s=0;s<this._pdomAttributes.length;s++)this._pdomAttributes[s].attribute===e&&this._pdomAttributes[s].options.namespace===n.namespace&&this._pdomAttributes[s].options.elementName===n.elementName&&(r=!0);return r}setPDOMClass(e,t){const n=optionize()({elementName:PDOMPeer$1.PRIMARY_SIBLING},t);for(let r=0;r<this._pdomClasses.length;r++){const s=this._pdomClasses[r];if(s.className===e&&s.options.elementName===n.elementName)return}this._pdomClasses.push({className:e,options:n});for(let r=0;r<this._pdomInstances.length;r++)this._pdomInstances[r].peer.setClassToElement(e,n)}removePDOMClass(e,t){const n=optionize()({elementName:PDOMPeer$1.PRIMARY_SIBLING},t);let r=!1;for(let s=0;s<this._pdomClasses.length;s++)this._pdomClasses[s].className===e&&this._pdomClasses[s].options.elementName===n.elementName&&(this._pdomClasses.splice(s,1),r=!0);assert&&assert(r,`Node does not have pdom attribute ${e}`);for(let s=0;s<this._pdomClasses.length;s++)this.pdomInstances[s].peer.removeClassFromElement(e,n)}getPDOMClasses(){return this._pdomClasses.slice(0)}get pdomClasses(){return this.getPDOMClasses()}setFocusable(e){if(assert&&assert(e===null||typeof e=="boolean"),this._focusableOverride!==e){this._focusableOverride=e;for(let t=0;t<this._pdomInstances.length;t++)assert&&assert(this._pdomInstances[t].peer,"Peer required to set focusable."),this._pdomInstances[t].peer.setFocusable(this.focusable)}}set focusable(e){this.setFocusable(e)}get focusable(){return this.isFocusable()}isFocusable(){return this._focusableOverride!==null?this._focusableOverride:this._tagName===null?!1:PDOMUtils$1.tagIsDefaultFocusable(this._tagName)}setPDOMTransformSourceNode(e){this._pdomTransformSourceNode=e;for(let t=0;t<this._pdomInstances.length;t++)this._pdomInstances[t].peer.setPDOMTransformSourceNode(this._pdomTransformSourceNode)}set pdomTransformSourceNode(e){this.setPDOMTransformSourceNode(e)}get pdomTransformSourceNode(){return this.getPDOMTransformSourceNode()}getPDOMTransformSourceNode(){return this._pdomTransformSourceNode}setFocusPanTargetBoundsProperty(e){e!==this._focusPanTargetBoundsProperty&&(assert&&assert(!this._focusPanTargetBoundsProperty,"Cannot change focusPanTargetBoundsProperty after it is set."),this._focusPanTargetBoundsProperty=e)}getFocusPanTargetBoundsProperty(){return this._focusPanTargetBoundsProperty}set focusPanTargetBoundsProperty(e){this.setFocusPanTargetBoundsProperty(e)}get focusPanTargetBoundsProperty(){return this.getFocusPanTargetBoundsProperty()}setLimitPanDirection(e){this._limitPanDirection=e}getLimitPanDirection(){return this._limitPanDirection}set limitPanDirection(e){this.setLimitPanDirection(e)}get limitPanDirection(){return this.getLimitPanDirection()}setPositionInPDOM(e){this._positionInPDOM=e;for(let t=0;t<this._pdomInstances.length;t++)this._pdomInstances[t].peer.setPositionInPDOM(e)}set positionInPDOM(e){this.setPositionInPDOM(e)}get positionInPDOM(){return this.getPositionInPDOM()}getPositionInPDOM(){return this._positionInPDOM}setExcludeLabelSiblingFromInput(){this.excludeLabelSiblingFromInput=!0,this.onPDOMContentChange()}isInsidePhetioArchetype(e=this){if(e.isPhetioInstrumented())return e.phetioIsArchetype;for(let t=0;t<e.parents.length;t++)if(this.isInsidePhetioArchetype(e.parents[t]))return!0;return!1}alertDescriptionUtterance(e){if(isSettingPhetioStateProperty.value||Tandem.PHET_IO_ENABLED&&this.isInsidePhetioArchetype())return;const t=this.getConnectedDisplays();for(let n=0;n<t.length;n++){const r=t[n];r.isAccessible()&&r.descriptionUtteranceQueue.addToBack(e)}}forEachUtteranceQueue(e){const t=this.getConnectedDisplays();assert&&assert(t.length>0,"must be connected to a display to use UtteranceQueue features");for(let n=0;n<t.length;n++){const r=t[n];r.isAccessible()&&e(r.descriptionUtteranceQueue)}}getBaseOptions(){const e={};for(let t=0;t<ACCESSIBILITY_OPTION_KEYS.length;t++){const n=ACCESSIBILITY_OPTION_KEYS[t];e[n]=this[n]}return e}getNestedPDOMOrder(){const e=new Trail(this);let t=[];const n=[],r=[n];function s(a,h){let c=0;if(_.each(t,g=>{a===g&&c++}),c>1||c===1&&!h)return;if(a.hasPDOMContent){const g={trail:e.copy(),children:[]};r[r.length-1].push(g),r.push(g.children)}const d=a._pdomOrder===null?[]:a._pdomOrder;t=t.concat(d),_.each(d,g=>{_.each(a.getLeafTrailsTo(g),D=>{D.removeAncestor(),e.addDescendantTrail(D),s(g,!0),e.removeDescendantTrail(D)})});const y=a._children.length;for(let g=0;g<y;g++){const D=a._children[g];e.addDescendant(D,g),s(D,!1),e.removeDescendant()}_.each(d,()=>{t.pop()}),a.hasPDOMContent&&r.pop()}return s(this,!1),n}onPDOMContentChange(){PDOMTree$1.pdomContentChange(this),this.pdomHeading&&this.computeHeadingLevel(),this.rendererSummaryRefreshEmitter.emit()}get hasPDOMContent(){return!!this._tagName}onPDOMAddChild(e){sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.ParallelDOM(`onPDOMAddChild n#${e.id} (parent:n#${this.id})`),sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.push(),assert&&function(n){n._rendererSummary.hasNoPDOM()||n.pdomOrder&&assert(n.getTrails(r=>_.includes(n.pdomOrder,r)).length===0,"pdomOrder should not include any ancestors or the node itself")}(e),assert&&PDOMTree$1.auditNodeForPDOMCycles(this),this._pdomDisplaysInfo.onAddChild(e),PDOMTree$1.addChild(this,e),sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.pop()}onPDOMRemoveChild(e){sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.ParallelDOM(`onPDOMRemoveChild n#${e.id} (parent:n#${this.id})`),sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.push(),this._pdomDisplaysInfo.onRemoveChild(e),PDOMTree$1.removeChild(this,e),e.updateOtherNodesAriaLabelledby(),e.updateOtherNodesAriaDescribedby(),e.updateOtherNodesActiveDescendant(),sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.pop()}onPDOMReorderedChildren(){sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.ParallelDOM(`onPDOMReorderedChildren (parent:n#${this.id})`),sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.push(),PDOMTree$1.childrenOrderChange(this),sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.pop()}updateLinkedElementForProperty(e,t,n){if(assert&&assert(t!==n,"should not be called on same values"),this.isPhetioInstrumented()){t&&t instanceof ReadOnlyProperty&&t.isPhetioInstrumented()&&t instanceof PhetioObject&&this.removeLinkedElements(t);const r=this.tandem.createTandem(e);n&&n instanceof ReadOnlyProperty&&n.isPhetioInstrumented()&&n instanceof PhetioObject&&r!==n.tandem&&this.addLinkedElement(n,{tandemName:e})}}getPDOMInstances(){return this._pdomInstances}get pdomInstances(){return this.getPDOMInstances()}addPDOMInstance(e){this._pdomInstances.push(e)}removePDOMInstance(e){const t=_.indexOf(this._pdomInstances,e);assert&&assert(t!==-1,"Cannot remove a PDOMInstance from a Node if it was not there"),this._pdomInstances.splice(t,1)}static BASIC_ACCESSIBLE_NAME_BEHAVIOR(e,t,n){return e.tagName==="input"?(t.labelTagName="label",t.labelContent=n):PDOMUtils$1.tagNameSupportsContent(e.tagName)?t.innerContent=n:t.ariaLabel=n,t}static HELP_TEXT_BEFORE_CONTENT(e,t,n){return t.descriptionTagName=PDOMUtils$1.DEFAULT_DESCRIPTION_TAG_NAME,t.descriptionContent=n,t.appendDescription=!1,t}static HELP_TEXT_AFTER_CONTENT(e,t,n){return t.descriptionTagName=PDOMUtils$1.DEFAULT_DESCRIPTION_TAG_NAME,t.descriptionContent=n,t.appendDescription=!0,t}}scenery.register("ParallelDOM",ParallelDOM);let globalIdCounter$4=1;const scratchBounds2$1=Bounds2.NOTHING.copy(),scratchBounds2Extra=Bounds2.NOTHING.copy(),scratchMatrix3=new Matrix3,ENABLED_PROPERTY_TANDEM_NAME=EnabledProperty.TANDEM_NAME,VISIBLE_PROPERTY_TANDEM_NAME="visibleProperty",INPUT_ENABLED_PROPERTY_TANDEM_NAME="inputEnabledProperty",PHET_IO_STATE_DEFAULT$1=!1;let maxParentCount=0,maxChildCount=0;const REQUIRES_BOUNDS_OPTION_KEYS=["leftTop","centerTop","rightTop","leftCenter","center","rightCenter","leftBottom","centerBottom","rightBottom","left","right","top","bottom","centerX","centerY"],NODE_OPTION_KEYS=["children","cursor","phetioVisiblePropertyInstrumented","visibleProperty","visible","pickableProperty","pickable","phetioEnabledPropertyInstrumented","enabledProperty","enabled","phetioInputEnabledPropertyInstrumented","inputEnabledProperty","inputEnabled","inputListeners","opacity","disabledOpacity","filters","matrix","translation","x","y","rotation","scale","excludeInvisibleChildrenFromBounds","layoutOptions","localBounds","maxWidth","maxHeight","renderer","layerSplit","usesOpacity","cssTransform","excludeInvisible","webglScale","preventFit","mouseArea","touchArea","clipArea","transformBounds",...REQUIRES_BOUNDS_OPTION_KEYS],DEFAULT_OPTIONS$7={phetioVisiblePropertyInstrumented:!0,visible:!0,opacity:1,disabledOpacity:1,pickable:null,enabled:!0,phetioEnabledPropertyInstrumented:!1,inputEnabled:!0,phetioInputEnabledPropertyInstrumented:!1,clipArea:null,mouseArea:null,touchArea:null,cursor:null,transformBounds:!1,maxWidth:null,maxHeight:null,renderer:null,usesOpacity:!1,layerSplit:!1,cssTransform:!1,excludeInvisible:!1,webglScale:null,preventFit:!1},DEFAULT_INTERNAL_RENDERER=DEFAULT_OPTIONS$7.renderer===null?0:Renderer.fromName(DEFAULT_OPTIONS$7.renderer);var Tt;let Node$1=(Tt=class extends ParallelDOM{constructor(e){super(),this.childrenChangedEmitter=new TinyEmitter,this.childInsertedEmitter=new TinyEmitter,this.childRemovedEmitter=new TinyEmitter,this.childrenReorderedEmitter=new TinyEmitter,this.parentAddedEmitter=new TinyEmitter,this.parentRemovedEmitter=new TinyEmitter,this.transformEmitter=new TinyEmitter,this.instanceRefreshEmitter=new TinyEmitter,this.rendererSummaryRefreshEmitter=new TinyEmitter,this.filterChangeEmitter=new TinyEmitter,this.changedInstanceEmitter=new TinyEmitter,this.rootedDisplayChangedEmitter=new TinyEmitter,this.layoutOptionsChangedEmitter=new TinyEmitter,this._activeParentLayoutConstraint=null,this._id=globalIdCounter$4++,this._instances=[],this._rootedDisplays=[],this._drawables=[],this._visibleProperty=new TinyForwardingProperty(DEFAULT_OPTIONS$7.visible,DEFAULT_OPTIONS$7.phetioVisiblePropertyInstrumented,this.onVisiblePropertyChange.bind(this)),this.opacityProperty=new TinyProperty(DEFAULT_OPTIONS$7.opacity,this.onOpacityPropertyChange.bind(this)),this.disabledOpacityProperty=new TinyProperty(DEFAULT_OPTIONS$7.disabledOpacity,this.onDisabledOpacityPropertyChange.bind(this)),this._pickableProperty=new TinyForwardingProperty(DEFAULT_OPTIONS$7.pickable,!1,this.onPickablePropertyChange.bind(this)),this._enabledProperty=new TinyForwardingProperty(DEFAULT_OPTIONS$7.enabled,DEFAULT_OPTIONS$7.phetioEnabledPropertyInstrumented,this.onEnabledPropertyChange.bind(this)),this._inputEnabledProperty=new TinyForwardingProperty(DEFAULT_OPTIONS$7.inputEnabled,DEFAULT_OPTIONS$7.phetioInputEnabledPropertyInstrumented),this.clipAreaProperty=new TinyProperty(DEFAULT_OPTIONS$7.clipArea),this.voicingVisibleProperty=new TinyProperty(!0),this._mouseArea=DEFAULT_OPTIONS$7.mouseArea,this._touchArea=DEFAULT_OPTIONS$7.touchArea,this._cursor=DEFAULT_OPTIONS$7.cursor,this._children=[],this._parents=[],this._transformBounds=DEFAULT_OPTIONS$7.transformBounds,this._transform=new Transform3,this._transformListener=this.onTransformChange.bind(this),this._transform.changeEmitter.addListener(this._transformListener),this._maxWidth=DEFAULT_OPTIONS$7.maxWidth,this._maxHeight=DEFAULT_OPTIONS$7.maxHeight,this._appliedScaleFactor=1,this._inputListeners=[],this._renderer=DEFAULT_INTERNAL_RENDERER,this._usesOpacity=DEFAULT_OPTIONS$7.usesOpacity,this._layerSplit=DEFAULT_OPTIONS$7.layerSplit,this._cssTransform=DEFAULT_OPTIONS$7.cssTransform,this._excludeInvisible=DEFAULT_OPTIONS$7.excludeInvisible,this._webglScale=DEFAULT_OPTIONS$7.webglScale,this._preventFit=DEFAULT_OPTIONS$7.preventFit,this.inputEnabledProperty.lazyLink(this.pdomBoundInputEnabledListener);const t=this.onBoundsListenersAddedOrRemoved.bind(this),n=this.validateBounds.bind(this),r=this.validateSelfBounds.bind(this);this.boundsProperty=new TinyStaticProperty(Bounds2.NOTHING.copy(),n),this.boundsProperty.changeCount=t,this.localBoundsProperty=new TinyStaticProperty(Bounds2.NOTHING.copy(),n),this.localBoundsProperty.changeCount=t,this.childBoundsProperty=new TinyStaticProperty(Bounds2.NOTHING.copy(),n),this.childBoundsProperty.changeCount=t,this.selfBoundsProperty=new TinyStaticProperty(Bounds2.NOTHING.copy(),r),this._localBoundsOverridden=!1,this._excludeInvisibleChildrenFromBounds=!1,this._layoutOptions=null,this._boundsDirty=!0,this._localBoundsDirty=!0,this._selfBoundsDirty=!0,this._childBoundsDirty=!0,assert&&(this._originalBounds=this.boundsProperty._value,this._originalLocalBounds=this.localBoundsProperty._value,this._originalSelfBounds=this.selfBoundsProperty._value,this._originalChildBounds=this.childBoundsProperty._value),this._filters=[],this._rendererBitmask=Renderer.bitmaskNodeDefault,this._rendererSummary=new RendererSummary$1(this),this._boundsEventCount=0,this._boundsEventSelfCount=0,this._picker=new Picker(this),this._isGettingRemovedFromParent=!1,e&&this.mutate(e)}insertChild(e,t,n){var r,s,a,h;if(assert&&assert(t!=null,"insertChild cannot insert a null/undefined child"),assert&&assert(!_.includes(this._children,t),"Parent already contains child"),assert&&assert(t!==this,"Cannot add self as a child"),assert&&assert(t._parents!==null,"Tried to insert a disposed child node?"),assert&&assert(!t.isDisposed,"Tried to insert a disposed Node"),this._picker.onInsertChild(t),this.changeBoundsEventCount(t._boundsEventCount>0?1:0),this._rendererSummary.summaryChange(RendererSummary$1.bitmaskAll,t._rendererSummary.bitmask),t._parents.push(this),assert&&((s=(r=window.phet)==null?void 0:r.chipper)!=null&&s.queryParameters)&&isFinite(phet.chipper.queryParameters.parentLimit)){const c=t._parents.length;maxParentCount<c&&(maxParentCount=c,console.log(`Max Node parents: ${maxParentCount}`),assert(maxParentCount<=phet.chipper.queryParameters.parentLimit,`parent count of ${maxParentCount} above ?parentLimit=${phet.chipper.queryParameters.parentLimit}`))}if(this._children.splice(e,0,t),assert&&((h=(a=window.phet)==null?void 0:a.chipper)!=null&&h.queryParameters)&&isFinite(phet.chipper.queryParameters.childLimit)){const c=this._children.length;maxChildCount<c&&(maxChildCount=c,console.log(`Max Node children: ${maxChildCount}`),assert(maxChildCount<=phet.chipper.queryParameters.childLimit,`child count of ${maxChildCount} above ?childLimit=${phet.chipper.queryParameters.childLimit}`))}return t._rendererSummary.hasNoPDOM()||this.onPDOMAddChild(t),t.invalidateBounds(),this._boundsDirty=!0,this.childInsertedEmitter.emit(t,e),t.parentAddedEmitter.emit(this),!n&&this.childrenChangedEmitter.emit(),assertSlow&&this._picker.audit(),this}addChild(e,t){return this.insertChild(this._children.length,e,t),this}removeChild(e,t){assert&&assert(e&&e instanceof Tt,"Need to call node.removeChild() with a Node."),assert&&assert(this.hasChild(e),"Attempted to removeChild with a node that was not a child.");const n=_.indexOf(this._children,e);return this.removeChildWithIndex(e,n,t),this}removeChildAt(e,t){assert&&assert(e>=0),assert&&assert(e<this._children.length);const n=this._children[e];return this.removeChildWithIndex(n,e,t),this}removeChildWithIndex(e,t,n){assert&&assert(e&&e instanceof Tt,"Need to call node.removeChildWithIndex() with a Node."),assert&&assert(this.hasChild(e),"Attempted to removeChild with a node that was not a child."),assert&&assert(this._children[t]===e,"Incorrect index for removeChildWithIndex"),assert&&assert(e._parents!==null,"Tried to remove a disposed child node?");const r=_.indexOf(e._parents,this);e._isGettingRemovedFromParent=!0,e._rendererSummary.hasNoPDOM()||this.onPDOMRemoveChild(e),this._picker.onRemoveChild(e),this.changeBoundsEventCount(e._boundsEventCount>0?-1:0),this._rendererSummary.summaryChange(e._rendererSummary.bitmask,RendererSummary$1.bitmaskAll),e._parents.splice(r,1),this._children.splice(t,1),e._isGettingRemovedFromParent=!1,this.invalidateBounds(),this._childBoundsDirty=!0,this.childRemovedEmitter.emit(e,t),e.parentRemovedEmitter.emit(this),!n&&this.childrenChangedEmitter.emit(),assertSlow&&this._picker.audit()}moveChildToIndex(e,t){assert&&assert(this.hasChild(e),"Attempted to moveChildToIndex with a node that was not a child."),assert&&assert(t%1===0&&t>=0&&t<this._children.length,`Invalid index: ${t}`);const n=this.indexOfChild(e);return this._children[t]!==e&&(this._children.splice(n,1),this._children.splice(t,0,e),this._rendererSummary.hasNoPDOM()||this.onPDOMReorderedChildren(),this.childrenReorderedEmitter.emit(Math.min(n,t),Math.max(n,t)),this.childrenChangedEmitter.emit()),this}removeAllChildren(){return this.setChildren([]),this}setChildren(e){const t=[],n=[],r=[];let s;for(arrayDifference(e,this._children,n,t,r),s=t.length-1;s>=0;s--)this.removeChild(t[s],!0);assert&&assert(this._children.length===r.length,"Removing children should not have triggered other children changes");let a=-1,h=-1;for(s=0;s<r.length;s++){const d=r[s];this._children[s]!==d&&(this._children[s]=d,a===-1&&(a=s),h=s)}const c=a!==-1;if(c&&(this._rendererSummary.hasNoPDOM()||this.onPDOMReorderedChildren(),this.childrenReorderedEmitter.emit(a,h)),n.length){let d=0,y=n[d];for(s=0;s<e.length;s++)e[s]===y&&(this.insertChild(s,y,!0),y=n[++d])}if((t.length!==0||n.length!==0||c)&&this.childrenChangedEmitter.emit(),assert)for(let d=0;d<this._children.length;d++)assert(e[d]===this._children[d],"Incorrect child after setChildren, possibly a reentrancy issue");return this}set children(e){this.setChildren(e)}get children(){return this.getChildren()}getChildren(){return this._children.slice(0)}getChildrenCount(){return this._children.length}getParents(){return this._parents.slice(0)}get parents(){return this.getParents()}getParent(){return assert&&assert(this._parents.length<=1,"Cannot call getParent on a node with multiple parents"),this._parents.length?this._parents[0]:null}get parent(){return this.getParent()}getChildAt(e){return this._children[e]}indexOfParent(e){return _.indexOf(this._parents,e)}indexOfChild(e){return _.indexOf(this._children,e)}moveToFront(){return _.each(this.parents,e=>e.moveChildToFront(this)),this}moveChildToFront(e){return this.moveChildToIndex(e,this._children.length-1)}moveForward(){return this.parents.forEach(e=>e.moveChildForward(this)),this}moveChildForward(e){const t=this.indexOfChild(e);return t<this.getChildrenCount()-1&&this.moveChildToIndex(e,t+1),this}moveBackward(){return this.parents.forEach(e=>e.moveChildBackward(this)),this}moveChildBackward(e){const t=this.indexOfChild(e);return t>0&&this.moveChildToIndex(e,t-1),this}moveToBack(){return _.each(this.parents,e=>e.moveChildToBack(this)),this}moveChildToBack(e){return this.moveChildToIndex(e,0)}replaceChild(e,t){assert&&assert(this.hasChild(e),"Attempted to replace a node that was not a child.");const n=this.indexOfChild(e),r=e.focused;return this.removeChild(e,!0),this.insertChild(n,t,!0),this.childrenChangedEmitter.emit(),r&&t.focusable&&t.focus(),this}detach(){return _.each(this._parents.slice(0),e=>e.removeChild(this)),this}changeBoundsEventCount(e){if(e!==0){const t=this._boundsEventCount===0;this._boundsEventCount+=e,assert&&assert(this._boundsEventCount>=0,"subtree bounds event count should be guaranteed to be >= 0");const n=this._boundsEventCount===0;if(t!==n){const r=t?1:-1,s=this._parents.length;for(let a=0;a<s;a++)this._parents[a].changeBoundsEventCount(r)}}}validateSelfBounds(){if(this._selfBoundsDirty){const e=scratchBounds2$1.set(this.selfBoundsProperty._value),t=this.updateSelfBounds();return this._selfBoundsDirty=!1,t&&this.selfBoundsProperty.notifyListeners(e),!0}return!1}validateBounds(){sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds(`validateBounds #${this._id}`),sceneryLog&&sceneryLog.bounds&&sceneryLog.push();let e;const t=1e-13;let n=this.validateSelfBounds();const r=this.childBoundsProperty._value,s=this.localBoundsProperty._value,a=this.selfBoundsProperty._value,h=this.boundsProperty._value;if(this._childBoundsDirty){for(n=!0,sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds("childBounds dirty"),e=this._children.length;e--;){const d=this._children[e];d&&d.validateBounds()}const c=scratchBounds2$1.set(r);for(r.set(Bounds2.NOTHING),e=this._children.length;e--;){const d=this._children[e];(d&&!this._excludeInvisibleChildrenFromBounds||d.isVisible())&&r.includeBounds(d.bounds)}this._childBoundsDirty=!1,sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds(`childBounds: ${r}`),r.equals(c)||r.equalsEpsilon(c,t)||this.childBoundsProperty.notifyListeners(c)}if(this._localBoundsDirty){n=!0,sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds("localBounds dirty"),this._localBoundsDirty=!1;const c=scratchBounds2$1.set(s);if(!this._localBoundsOverridden){s.set(a).includeBounds(r);const d=this.clipArea;d&&s.constrainBounds(d.bounds)}sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds(`localBounds: ${s}`),(this._maxWidth!==null||this._maxHeight!==null)&&this.updateMaxDimension(s),s.equals(c)||(this._boundsDirty=!0,s.equalsEpsilon(c,t)||this.localBoundsProperty.notifyListeners(c))}if(this._boundsDirty){n=!0,sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds("bounds dirty"),this._boundsDirty=!1;const c=scratchBounds2$1.set(h);if(this._transformBounds&&!this._transform.getMatrix().isAxisAligned()){const d=scratchMatrix3.set(this.getMatrix());h.set(Bounds2.NOTHING),this._includeTransformedSubtreeBounds(d,h);const y=this.clipArea;y&&h.constrainBounds(y.getBoundsWithTransform(d))}else h.set(s),this.transformBoundsFromLocalToParent(h);if(sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds(`bounds: ${h}`),!h.equals(c)){for(e=this._parents.length;e--;)this._parents[e].invalidateBounds();h.equalsEpsilon(c,t)||this.boundsProperty.notifyListeners(c)}}return(this._childBoundsDirty||this._boundsDirty)&&(sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds("revalidation"),this.validateBounds()),assert&&(assert(this._originalBounds===this.boundsProperty._value,"Reference for bounds changed!"),assert(this._originalLocalBounds===this.localBoundsProperty._value,"Reference for localBounds changed!"),assert(this._originalSelfBounds===this.selfBoundsProperty._value,"Reference for selfBounds changed!"),assert(this._originalChildBounds===this.childBoundsProperty._value,"Reference for childBounds changed!")),assertSlow&&(()=>{const d=Bounds2.NOTHING.copy();_.each(this._children,O=>{(!this._excludeInvisibleChildrenFromBounds||O.isVisible())&&d.includeBounds(O.boundsProperty._value)});let y=this.selfBoundsProperty._value.union(d);const g=this.clipArea;g&&(y=y.intersection(g.bounds));const D=this.localToParentBounds(y);assertSlow&&assertSlow(this.childBoundsProperty._value.equalsEpsilon(d,1e-6),`Child bounds mismatch after validateBounds: ${this.childBoundsProperty._value.toString()}, expected: ${d.toString()}`),assertSlow&&assertSlow(this._localBoundsOverridden||this._transformBounds||this.boundsProperty._value.equalsEpsilon(D,1e-6),`Bounds mismatch after validateBounds: ${this.boundsProperty._value.toString()}, expected: ${D.toString()}. This could have happened if a bounds instance owned by a Node was directly mutated (e.g. bounds.erode())`)})(),sceneryLog&&sceneryLog.bounds&&sceneryLog.pop(),n}_includeTransformedSubtreeBounds(e,t){this.selfBounds.isEmpty()||t.includeBounds(this.getTransformedSelfBounds(e));const n=this._children.length;for(let r=0;r<n;r++){const s=this._children[r];e.multiplyMatrix(s._transform.getMatrix()),s._includeTransformedSubtreeBounds(e,t),e.multiplyMatrix(s._transform.getInverse())}return t}validateWatchedBounds(){for(;this.watchedBoundsScan(););}watchedBoundsScan(){if(this._boundsEventSelfCount!==0)return this.validateBounds();if(this._boundsEventCount>0&&this._childBoundsDirty){let e=!1;const t=this._children.length;for(let n=0;n<t;n++)e=this._children[n].watchedBoundsScan()||e;return e}else return!1}invalidateBounds(){this._boundsDirty=!0,this._localBoundsDirty=!0;let e=this._parents.length;for(;e--;)this._parents[e].invalidateChildBounds()}invalidateChildBounds(){if(!this._childBoundsDirty){this._childBoundsDirty=!0,this._localBoundsDirty=!0;let e=this._parents.length;for(;e--;)this._parents[e].invalidateChildBounds()}}invalidateSelf(e){assert&&assert(e===void 0||e instanceof Bounds2,"invalidateSelf's newSelfBounds, if provided, needs to be Bounds2");const t=this.selfBoundsProperty._value;if(!e)this._selfBoundsDirty=!0,this.invalidateBounds(),this._picker.onSelfBoundsDirty();else if(assert&&assert(e.isEmpty()||e.isFinite(),"Bounds must be empty or finite in invalidateSelf"),this._selfBoundsDirty=!1,!t.equals(e)){const n=scratchBounds2$1.set(t);this.invalidateBounds(),this._picker.onSelfBoundsDirty(),t.set(e),this.selfBoundsProperty.notifyListeners(n)}assertSlow&&this._picker.audit()}updateSelfBounds(){return assert&&assert(this.selfBoundsProperty._value.equals(Bounds2.NOTHING)),!1}hasChild(e){assert&&assert(e&&e instanceof Tt,"hasChild needs to be called with a Node");const t=_.includes(this._children,e);return assert&&assert(t===_.includes(e._parents,this),"child-parent reference should match parent-child reference"),t}getSelfShape(){return this.selfBounds.isEmpty()?new Shape$1:Shape$1.bounds(this.selfBounds)}getSelfBounds(){return this.selfBoundsProperty.value}get selfBounds(){return this.getSelfBounds()}getSafeSelfBounds(){return this.selfBoundsProperty.value}get safeSelfBounds(){return this.getSafeSelfBounds()}getChildBounds(){return this.childBoundsProperty.value}get childBounds(){return this.getChildBounds()}getLocalBounds(){return this.localBoundsProperty.value}get localBounds(){return this.getLocalBounds()}set localBounds(e){this.setLocalBounds(e)}get localBoundsOverridden(){return this._localBoundsOverridden}setLocalBounds(e){assert&&assert(e===null||e instanceof Bounds2,"localBounds override should be set to either null or a Bounds2"),assert&&assert(e===null||!isNaN(e.minX),"minX for localBounds should not be NaN"),assert&&assert(e===null||!isNaN(e.minY),"minY for localBounds should not be NaN"),assert&&assert(e===null||!isNaN(e.maxX),"maxX for localBounds should not be NaN"),assert&&assert(e===null||!isNaN(e.maxY),"maxY for localBounds should not be NaN");const t=this.localBoundsProperty._value,n=t.copy();if(e===null)this._localBoundsOverridden&&(this._localBoundsOverridden=!1,this.localBoundsProperty.notifyListeners(n),this.invalidateBounds());else{const r=!e.equals(t)||!this._localBoundsOverridden;r&&t.set(e),this._localBoundsOverridden||(this._localBoundsOverridden=!0),r&&(this.localBoundsProperty.notifyListeners(n),this.invalidateBounds())}return this}getTransformedSelfBounds(e){return this.selfBounds.transformed(e)}getTransformedSafeSelfBounds(e){return this.safeSelfBounds.transformed(e)}getSafeTransformedVisibleBounds(e){const t=(e||Matrix3.IDENTITY).timesMatrix(this.matrix),n=Bounds2.NOTHING.copy();if(this.visibleProperty.value&&(this.selfBounds.isEmpty()||n.includeBounds(this.getTransformedSafeSelfBounds(t)),this._children.length))for(let r=0;r<this._children.length;r++)n.includeBounds(this._children[r].getSafeTransformedVisibleBounds(t));return n}get safeTransformedVisibleBounds(){return this.getSafeTransformedVisibleBounds()}setTransformBounds(e){return this._transformBounds!==e&&(this._transformBounds=e,this.invalidateBounds()),this}set transformBounds(e){this.setTransformBounds(e)}get transformBounds(){return this.getTransformBounds()}getTransformBounds(){return this._transformBounds}getBounds(){return this.boundsProperty.value}get bounds(){return this.getBounds()}getVisibleLocalBounds(){const e=this.selfBounds.copy();let t=this._children.length;for(;t--;)e.includeBounds(this._children[t].getVisibleBounds());const n=this.clipArea;return n&&e.constrainBounds(n.bounds),assert&&assert(e.isFinite()||e.isEmpty(),"Visible bounds should not be infinite"),e}get visibleLocalBounds(){return this.getVisibleLocalBounds()}getVisibleBounds(){return this.isVisible()?this.getVisibleLocalBounds().transform(this.getMatrix()):Bounds2.NOTHING}get visibleBounds(){return this.getVisibleBounds()}hitTest(e,t,n){return assert&&assert(e.isFinite(),"The point should be a finite Vector2"),assert&&assert(t===void 0||typeof t=="boolean","If isMouse is provided, it should be a boolean"),assert&&assert(n===void 0||typeof n=="boolean","If isTouch is provided, it should be a boolean"),this._picker.hitTest(e,!!t,!!n)}trailUnderPointer(e){return e.point===null?null:this.hitTest(e.point,e instanceof Mouse,e.isTouchLike())}containsPoint(e){return this.hitTest(e)!==null}containsPointSelf(e){return this.selfBounds.containsPoint(e)}intersectsBoundsSelf(e){return this.selfBounds.intersectsBounds(e)}isPhetioMouseHittable(e){return this.pickable===!1&&!this.isAnyDescendantAPhetioMouseHitTarget()?!1:this.visible&&(this.clipArea===null||this.clipArea.containsPoint(this._transform.getInverse().timesVector2(e)))}isAnyDescendantAPhetioMouseHitTarget(){return this.getPhetioMouseHitTarget()!=="phetioNotSelectable"||_.some(this.children,e=>e.isAnyDescendantAPhetioMouseHitTarget())}getPhetioMouseHit(e){if(!this.isPhetioMouseHittable(e))return null;const t=this._transform.getInverse().timesVector2(e);let n=null;for(let r=this._children.length-1;r>=0;r--){const s=this._children[r].getPhetioMouseHit(t);if(s instanceof PhetioObject)return s;s==="phetioNotSelectable"&&(n=!0)}return n?this.getPhetioMouseHitTarget():this._mouseArea?this._mouseArea.containsPoint(t)?this.getPhetioMouseHitTarget():null:this.selfBounds.containsPoint(t)&&this.containsPointSelf(t)?this.getPhetioMouseHitTarget():null}isPainted(){return!1}areSelfBoundsValid(){return!0}hasParent(){return this._parents.length!==0}hasChildren(){return this._children.length>0}isChildIncludedInLayout(e){return e.bounds.isValid()&&(!this._excludeInvisibleChildrenFromBounds||e.visible)}walkDepthFirst(e){e(this);const t=this._children.length;for(let n=0;n<t;n++)this._children[n].walkDepthFirst(e)}addInputListener(e){return assert&&assert(!_.includes(this._inputListeners,e),"Input listener already registered on this Node"),assert&&assert(e!==null,"Input listener cannot be null"),assert&&assert(e!==void 0,"Input listener cannot be undefined"),_.includes(this._inputListeners,e)||(this._inputListeners.push(e),this._picker.onAddInputListener(),assertSlow&&this._picker.audit()),this}removeInputListener(e){const t=_.indexOf(this._inputListeners,e);return assert&&assert(this.isDisposed||t>=0,"Could not find input listener to remove"),t>=0&&(this._inputListeners.splice(t,1),this._picker.onRemoveInputListener(),assertSlow&&this._picker.audit()),this}hasInputListener(e){for(let t=0;t<this._inputListeners.length;t++)if(this._inputListeners[t]===e)return!0;return!1}interruptInput(){const e=this.inputListeners;for(let t=0;t<e.length;t++){const n=e[t];n.interrupt&&n.interrupt()}return this}interruptSubtreeInput(){this.interruptInput();const e=this._children.slice();for(let t=0;t<e.length;t++)e[t].interruptSubtreeInput();return this}translate(e,t,n){if(typeof e=="number"){if(assert&&assert(isFinite(e),"x should be a finite number"),assert&&assert(typeof t=="number"&&isFinite(t),"y should be a finite number"),Math.abs(e)<1e-12&&Math.abs(t)<1e-12)return;n?this.prependTranslation(e,t):this.appendMatrix(scratchMatrix3.setToTranslation(e,t))}else{const r=e;if(assert&&assert(r.isFinite(),"translation should be a finite Vector2 if not finite numbers"),!r.x&&!r.y)return;this.translate(r.x,r.y,t)}}scale(e,t,n){if(typeof e=="number")if(assert&&assert(isFinite(e),"scales should be finite"),t===void 0||typeof t=="boolean")this.scale(e,e,t);else{if(assert&&assert(isFinite(t),"scales should be finite numbers"),assert&&assert(n===void 0||typeof n=="boolean","If provided, prependInstead should be boolean"),e===1&&t===1)return;n?this.prependMatrix(Matrix3.scaling(e,t)):this.appendMatrix(Matrix3.scaling(e,t))}else{const r=e;assert&&assert(r.isFinite(),"scale should be a finite Vector2 if not a finite number"),this.scale(r.x,r.y,t)}}rotate(e,t){assert&&assert(isFinite(e),"angle should be a finite number"),assert&&assert(t===void 0||typeof t=="boolean"),e%(2*Math.PI)!==0&&(t?this.prependMatrix(Matrix3.rotation2(e)):this.appendMatrix(Matrix3.rotation2(e)))}rotateAround(e,t){assert&&assert(e.isFinite(),"point should be a finite Vector2"),assert&&assert(isFinite(t),"angle should be a finite number");let n=Matrix3.translation(-e.x,-e.y);return n=Matrix3.rotation2(t).timesMatrix(n),n=Matrix3.translation(e.x,e.y).timesMatrix(n),this.prependMatrix(n),this}setX(e){return assert&&assert(isFinite(e),"x should be a finite number"),this.translate(e-this.getX(),0,!0),this}set x(e){this.setX(e)}get x(){return this.getX()}getX(){return this._transform.getMatrix().m02()}setY(e){return assert&&assert(isFinite(e),"y should be a finite number"),this.translate(0,e-this.getY(),!0),this}set y(e){this.setY(e)}get y(){return this.getY()}getY(){return this._transform.getMatrix().m12()}setScaleMagnitude(e,t){const n=this.getScaleVector();return typeof e=="number"?(t===void 0&&(t=e),assert&&assert(isFinite(e),"setScaleMagnitude parameters should be finite numbers"),assert&&assert(isFinite(t),"setScaleMagnitude parameters should be finite numbers"),this.appendMatrix(Matrix3.scaling(e/n.x,t/n.y))):(assert&&assert(e.isFinite(),"first parameter should be a finite Vector2"),this.appendMatrix(Matrix3.scaling(e.x/n.x,e.y/n.y))),this}getScaleVector(){return this._transform.getMatrix().getScaleVector()}setRotation(e){return assert&&assert(isFinite(e),"rotation should be a finite number"),this.appendMatrix(scratchMatrix3.setToRotationZ(e-this.getRotation())),this}set rotation(e){this.setRotation(e)}get rotation(){return this.getRotation()}getRotation(){return this._transform.getMatrix().getRotation()}setTranslation(e,t){const n=this._transform.getMatrix(),r=n.m02(),s=n.m12();let a,h;return typeof e=="number"?(assert&&assert(isFinite(e),"Parameters to setTranslation should be finite numbers"),assert&&assert(t!==void 0&&isFinite(t),"Parameters to setTranslation should be finite numbers"),a=e-r,h=t-s):(assert&&assert(e.isFinite(),"Should be a finite Vector2"),a=e.x-r,h=e.y-s),this.translate(a,h,!0),this}set translation(e){this.setTranslation(e)}get translation(){return this.getTranslation()}getTranslation(){const e=this._transform.getMatrix();return new Vector2(e.m02(),e.m12())}appendMatrix(e){assert&&assert(e.isFinite(),"matrix should be a finite Matrix3"),assert&&assert(e.getDeterminant()!==0,"matrix should not map plane to a line or point"),this._transform.append(e)}prependMatrix(e){assert&&assert(e.isFinite(),"matrix should be a finite Matrix3"),assert&&assert(e.getDeterminant()!==0,"matrix should not map plane to a line or point"),this._transform.prepend(e)}prependTranslation(e,t){assert&&assert(isFinite(e),"x should be a finite number"),assert&&assert(isFinite(t),"y should be a finite number"),!(!e&&!t)&&this._transform.prependTranslation(e,t)}setMatrix(e){assert&&assert(e.isFinite(),"matrix should be a finite Matrix3"),assert&&assert(e.getDeterminant()!==0,"matrix should not map plane to a line or point"),this._transform.setMatrix(e)}set matrix(e){this.setMatrix(e)}get matrix(){return this.getMatrix()}getMatrix(){return this._transform.getMatrix()}getTransform(){return this._transform}get transform(){return this.getTransform()}resetTransform(){this.setMatrix(Matrix3.IDENTITY)}onTransformChange(){this.invalidateBounds(),this._picker.onTransformChange(),assertSlow&&this._picker.audit(),this.transformEmitter.emit()}onSummaryChange(e,t){this._pdomDisplaysInfo.onSummaryChange(e,t)}updateMaxDimension(e){assert&&this.auditMaxDimensions();const t=this._appliedScaleFactor;let n=1;if(this._maxWidth!==null){const s=e.width;s>this._maxWidth&&(n=Math.min(n,this._maxWidth/s))}if(this._maxHeight!==null){const s=e.height;s>this._maxHeight&&(n=Math.min(n,this._maxHeight/s))}const r=n/t;r!==1&&(this._appliedScaleFactor=n,this.scale(r))}auditMaxDimensions(){assert&&assert(this._maxWidth===null||!isWidthSizable(this)||this.preferredWidth===null||this._maxWidth>=this.preferredWidth-1e-7,"If maxWidth and preferredWidth are both non-null, maxWidth should NOT be smaller than the preferredWidth. If that happens, it would trigger an infinite loop"),assert&&assert(this._maxHeight===null||!isHeightSizable(this)||this.preferredHeight===null||this._maxHeight>=this.preferredHeight-1e-7,"If maxHeight and preferredHeight are both non-null, maxHeight should NOT be smaller than the preferredHeight. If that happens, it would trigger an infinite loop")}onMaxDimensionChange(e,t){e===null&&t!==null?(this.changeBoundsEventCount(1),this._boundsEventSelfCount++):e!==null&&t===null&&(this.changeBoundsEventCount(-1),this._boundsEventSelfCount--)}setMaxWidth(e){assert&&assert(e===null||typeof e=="number"&&e>0,"maxWidth should be null (no constraint) or a positive number"),this._maxWidth!==e&&(this.onMaxDimensionChange(this._maxWidth,e),this._maxWidth=e,this.updateMaxDimension(this.localBoundsProperty.value))}set maxWidth(e){this.setMaxWidth(e)}get maxWidth(){return this.getMaxWidth()}getMaxWidth(){return this._maxWidth}setMaxHeight(e){assert&&assert(e===null||typeof e=="number"&&e>0,"maxHeight should be null (no constraint) or a positive number"),this._maxHeight!==e&&(this.onMaxDimensionChange(this._maxHeight,e),this._maxHeight=e,this.updateMaxDimension(this.localBoundsProperty.value))}set maxHeight(e){this.setMaxHeight(e)}get maxHeight(){return this.getMaxHeight()}getMaxHeight(){return this._maxHeight}setLeft(e){const t=this.getLeft();return isFinite(t)&&this.translate(e-t,0,!0),this}set left(e){this.setLeft(e)}get left(){return this.getLeft()}getLeft(){return this.getBounds().minX}setRight(e){const t=this.getRight();return isFinite(t)&&this.translate(e-t,0,!0),this}set right(e){this.setRight(e)}get right(){return this.getRight()}getRight(){return this.getBounds().maxX}setCenterX(e){const t=this.getCenterX();return isFinite(t)&&this.translate(e-t,0,!0),this}set centerX(e){this.setCenterX(e)}get centerX(){return this.getCenterX()}getCenterX(){return this.getBounds().getCenterX()}setCenterY(e){const t=this.getCenterY();return isFinite(t)&&this.translate(0,e-t,!0),this}set centerY(e){this.setCenterY(e)}get centerY(){return this.getCenterY()}getCenterY(){return this.getBounds().getCenterY()}setTop(e){const t=this.getTop();return isFinite(t)&&this.translate(0,e-t,!0),this}set top(e){this.setTop(e)}get top(){return this.getTop()}getTop(){return this.getBounds().minY}setBottom(e){const t=this.getBottom();return isFinite(t)&&this.translate(0,e-t,!0),this}set bottom(e){this.setBottom(e)}get bottom(){return this.getBottom()}getBottom(){return this.getBounds().maxY}setLeftTop(e){assert&&assert(e.isFinite(),"leftTop should be a finite Vector2");const t=this.getLeftTop();return t.isFinite()&&this.translate(e.minus(t),!0),this}set leftTop(e){this.setLeftTop(e)}get leftTop(){return this.getLeftTop()}getLeftTop(){return this.getBounds().getLeftTop()}setCenterTop(e){assert&&assert(e.isFinite(),"centerTop should be a finite Vector2");const t=this.getCenterTop();return t.isFinite()&&this.translate(e.minus(t),!0),this}set centerTop(e){this.setCenterTop(e)}get centerTop(){return this.getCenterTop()}getCenterTop(){return this.getBounds().getCenterTop()}setRightTop(e){assert&&assert(e.isFinite(),"rightTop should be a finite Vector2");const t=this.getRightTop();return t.isFinite()&&this.translate(e.minus(t),!0),this}set rightTop(e){this.setRightTop(e)}get rightTop(){return this.getRightTop()}getRightTop(){return this.getBounds().getRightTop()}setLeftCenter(e){assert&&assert(e.isFinite(),"leftCenter should be a finite Vector2");const t=this.getLeftCenter();return t.isFinite()&&this.translate(e.minus(t),!0),this}set leftCenter(e){this.setLeftCenter(e)}get leftCenter(){return this.getLeftCenter()}getLeftCenter(){return this.getBounds().getLeftCenter()}setCenter(e){assert&&assert(e.isFinite(),"center should be a finite Vector2");const t=this.getCenter();return t.isFinite()&&this.translate(e.minus(t),!0),this}set center(e){this.setCenter(e)}get center(){return this.getCenter()}getCenter(){return this.getBounds().getCenter()}setRightCenter(e){assert&&assert(e.isFinite(),"rightCenter should be a finite Vector2");const t=this.getRightCenter();return t.isFinite()&&this.translate(e.minus(t),!0),this}set rightCenter(e){this.setRightCenter(e)}get rightCenter(){return this.getRightCenter()}getRightCenter(){return this.getBounds().getRightCenter()}setLeftBottom(e){assert&&assert(e.isFinite(),"leftBottom should be a finite Vector2");const t=this.getLeftBottom();return t.isFinite()&&this.translate(e.minus(t),!0),this}set leftBottom(e){this.setLeftBottom(e)}get leftBottom(){return this.getLeftBottom()}getLeftBottom(){return this.getBounds().getLeftBottom()}setCenterBottom(e){assert&&assert(e.isFinite(),"centerBottom should be a finite Vector2");const t=this.getCenterBottom();return t.isFinite()&&this.translate(e.minus(t),!0),this}set centerBottom(e){this.setCenterBottom(e)}get centerBottom(){return this.getCenterBottom()}getCenterBottom(){return this.getBounds().getCenterBottom()}setRightBottom(e){assert&&assert(e.isFinite(),"rightBottom should be a finite Vector2");const t=this.getRightBottom();return t.isFinite()&&this.translate(e.minus(t),!0),this}set rightBottom(e){this.setRightBottom(e)}get rightBottom(){return this.getRightBottom()}getRightBottom(){return this.getBounds().getRightBottom()}getWidth(){return this.getBounds().getWidth()}get width(){return this.getWidth()}getHeight(){return this.getBounds().getHeight()}get height(){return this.getHeight()}getLocalWidth(){return this.getLocalBounds().getWidth()}get localWidth(){return this.getLocalWidth()}getLocalHeight(){return this.getLocalBounds().getHeight()}get localHeight(){return this.getLocalHeight()}getLocalLeft(){return this.getLocalBounds().minX}get localLeft(){return this.getLocalLeft()}getLocalRight(){return this.getLocalBounds().maxX}get localRight(){return this.getLocalRight()}getLocalCenterX(){return this.getLocalBounds().getCenterX()}get localCenterX(){return this.getLocalCenterX()}getLocalCenterY(){return this.getLocalBounds().getCenterY()}get localCenterY(){return this.getLocalCenterY()}getLocalTop(){return this.getLocalBounds().minY}get localTop(){return this.getLocalTop()}getLocalBottom(){return this.getLocalBounds().maxY}get localBottom(){return this.getLocalBottom()}getLocalLeftTop(){return this.getLocalBounds().getLeftTop()}get localLeftTop(){return this.getLocalLeftTop()}getLocalCenterTop(){return this.getLocalBounds().getCenterTop()}get localCenterTop(){return this.getLocalCenterTop()}getLocalRightTop(){return this.getLocalBounds().getRightTop()}get localRightTop(){return this.getLocalRightTop()}getLocalLeftCenter(){return this.getLocalBounds().getLeftCenter()}get localLeftCenter(){return this.getLocalLeftCenter()}getLocalCenter(){return this.getLocalBounds().getCenter()}get localCenter(){return this.getLocalCenter()}getLocalRightCenter(){return this.getLocalBounds().getRightCenter()}get localRightCenter(){return this.getLocalRightCenter()}getLocalLeftBottom(){return this.getLocalBounds().getLeftBottom()}get localLeftBottom(){return this.getLocalLeftBottom()}getLocalCenterBottom(){return this.getLocalBounds().getCenterBottom()}get localCenterBottom(){return this.getLocalCenterBottom()}getLocalRightBottom(){return this.getLocalBounds().getRightBottom()}get localRightBottom(){return this.getLocalRightBottom()}getId(){return this._id}get id(){return this.getId()}onVisiblePropertyChange(e){this._picker.onVisibilityChange(),assertSlow&&this._picker.audit(),this._pdomDisplaysInfo.onVisibilityChange(e);for(let t=0;t<this._parents.length;t++){const n=this._parents[t];n._excludeInvisibleChildrenFromBounds&&n.invalidateChildBounds()}}setVisibleProperty(e){return this._visibleProperty.setTargetProperty(e,this,VISIBLE_PROPERTY_TANDEM_NAME)}set visibleProperty(e){this.setVisibleProperty(e)}get visibleProperty(){return this.getVisibleProperty()}getVisibleProperty(){return this._visibleProperty}setVisible(e){return this.visibleProperty.set(e),this}set visible(e){this.setVisible(e)}get visible(){return this.isVisible()}isVisible(){return this.visibleProperty.value}setPhetioVisiblePropertyInstrumented(e){return this._visibleProperty.setTargetPropertyInstrumented(e,this)}set phetioVisiblePropertyInstrumented(e){this.setPhetioVisiblePropertyInstrumented(e)}get phetioVisiblePropertyInstrumented(){return this.getPhetioVisiblePropertyInstrumented()}getPhetioVisiblePropertyInstrumented(){return this._visibleProperty.getTargetPropertyInstrumented()}swapVisibility(e){assert&&assert(this.visible!==e.visible);const t=this.visible?this:e,n=this.visible?e:this,r=t.focused;return t.visible=!1,n.visible=!0,r&&n.focusable&&n.focus(),this}setOpacity(e){if(assert&&assert(isFinite(e),"opacity should be a finite number"),e<0||e>1)throw new Error(`opacity out of range: ${e}`);this.opacityProperty.value=e}set opacity(e){this.setOpacity(e)}get opacity(){return this.getOpacity()}getOpacity(){return this.opacityProperty.value}setDisabledOpacity(e){if(assert&&assert(isFinite(e),"disabledOpacity should be a finite number"),e<0||e>1)throw new Error(`disabledOpacity out of range: ${e}`);return this.disabledOpacityProperty.value=e,this}set disabledOpacity(e){this.setDisabledOpacity(e)}get disabledOpacity(){return this.getDisabledOpacity()}getDisabledOpacity(){return this.disabledOpacityProperty.value}getEffectiveOpacity(){return this.opacityProperty.value*(this.enabledProperty.value?1:this.disabledOpacityProperty.value)}get effectiveOpacity(){return this.getEffectiveOpacity()}onOpacityPropertyChange(){this.filterChangeEmitter.emit()}onDisabledOpacityPropertyChange(){this._enabledProperty.value||this.filterChangeEmitter.emit()}setFilters(e){assert&&assert(Array.isArray(e),"filters should be an array"),assert&&assert(_.every(e,t=>t instanceof Filter),"filters should consist of Filter objects only"),this._filters.length=0,this._filters.push(...e),this.invalidateHint(),this.filterChangeEmitter.emit()}set filters(e){this.setFilters(e)}get filters(){return this.getFilters()}getFilters(){return this._filters.slice()}setPickableProperty(e){return this._pickableProperty.setTargetProperty(e,this,null)}set pickableProperty(e){this.setPickableProperty(e)}get pickableProperty(){return this.getPickableProperty()}getPickableProperty(){return this._pickableProperty}setPickable(e){return assert&&assert(e===null||typeof e=="boolean"),this._pickableProperty.set(e),this}set pickable(e){this.setPickable(e)}get pickable(){return this.isPickable()}isPickable(){return this._pickableProperty.value}onPickablePropertyChange(e,t){this._picker.onPickableChange(t,e),assertSlow&&this._picker.audit()}setEnabledProperty(e){return this._enabledProperty.setTargetProperty(e,this,ENABLED_PROPERTY_TANDEM_NAME)}set enabledProperty(e){this.setEnabledProperty(e)}get enabledProperty(){return this.getEnabledProperty()}getEnabledProperty(){return this._enabledProperty}setPhetioEnabledPropertyInstrumented(e){return this._enabledProperty.setTargetPropertyInstrumented(e,this)}set phetioEnabledPropertyInstrumented(e){this.setPhetioEnabledPropertyInstrumented(e)}get phetioEnabledPropertyInstrumented(){return this.getPhetioEnabledPropertyInstrumented()}getPhetioEnabledPropertyInstrumented(){return this._enabledProperty.getTargetPropertyInstrumented()}setEnabled(e){return assert&&assert(e===null||typeof e=="boolean"),this._enabledProperty.set(e),this}set enabled(e){this.setEnabled(e)}get enabled(){return this.isEnabled()}isEnabled(){return this._enabledProperty.value}onEnabledPropertyChange(e){!e&&this.interruptSubtreeInput(),this.inputEnabled=e,this.disabledOpacityProperty.value!==1&&this.filterChangeEmitter.emit()}setInputEnabledProperty(e){return this._inputEnabledProperty.setTargetProperty(e,this,INPUT_ENABLED_PROPERTY_TANDEM_NAME)}set inputEnabledProperty(e){this.setInputEnabledProperty(e)}get inputEnabledProperty(){return this.getInputEnabledProperty()}getInputEnabledProperty(){return this._inputEnabledProperty}setPhetioInputEnabledPropertyInstrumented(e){return this._inputEnabledProperty.setTargetPropertyInstrumented(e,this)}set phetioInputEnabledPropertyInstrumented(e){this.setPhetioInputEnabledPropertyInstrumented(e)}get phetioInputEnabledPropertyInstrumented(){return this.getPhetioInputEnabledPropertyInstrumented()}getPhetioInputEnabledPropertyInstrumented(){return this._inputEnabledProperty.getTargetPropertyInstrumented()}setInputEnabled(e){this.inputEnabledProperty.value=e}set inputEnabled(e){this.setInputEnabled(e)}get inputEnabled(){return this.isInputEnabled()}isInputEnabled(){return this.inputEnabledProperty.value}setInputListeners(e){for(assert&&assert(Array.isArray(e));this._inputListeners.length;)this.removeInputListener(this._inputListeners[0]);for(let t=0;t<e.length;t++)this.addInputListener(e[t]);return this}set inputListeners(e){this.setInputListeners(e)}get inputListeners(){return this.getInputListeners()}getInputListeners(){return this._inputListeners.slice(0)}setCursor(e){this._cursor=e==="auto"?null:e}set cursor(e){this.setCursor(e)}get cursor(){return this.getCursor()}getCursor(){return this._cursor}getEffectiveCursor(){if(this._cursor)return this._cursor;for(let e=0;e<this._inputListeners.length;e++){const t=this._inputListeners[e];if(t.cursor)return t.cursor}return null}setMouseArea(e){return assert&&assert(e===null||e instanceof Shape$1||e instanceof Bounds2,"mouseArea needs to be a phet.kite.Shape, phet.dot.Bounds2, or null"),this._mouseArea!==e&&(this._mouseArea=e,this._picker.onMouseAreaChange(),assertSlow&&this._picker.audit()),this}set mouseArea(e){this.setMouseArea(e)}get mouseArea(){return this.getMouseArea()}getMouseArea(){return this._mouseArea}setTouchArea(e){return assert&&assert(e===null||e instanceof Shape$1||e instanceof Bounds2,"touchArea needs to be a phet.kite.Shape, phet.dot.Bounds2, or null"),this._touchArea!==e&&(this._touchArea=e,this._picker.onTouchAreaChange(),assertSlow&&this._picker.audit()),this}set touchArea(e){this.setTouchArea(e)}get touchArea(){return this.getTouchArea()}getTouchArea(){return this._touchArea}setClipArea(e){assert&&assert(e===null||e instanceof Shape$1,"clipArea needs to be a phet.kite.Shape, or null"),this.clipArea!==e&&(this.clipAreaProperty.value=e,this.invalidateBounds(),this._picker.onClipAreaChange(),assertSlow&&this._picker.audit())}set clipArea(e){this.setClipArea(e)}get clipArea(){return this.getClipArea()}getClipArea(){return this.clipAreaProperty.value}hasClipArea(){return this.clipArea!==null}setRendererBitmask(e){assert&&assert(isFinite(e)),e!==this._rendererBitmask&&(this._rendererBitmask=e,this._rendererSummary.selfChange(),this.instanceRefreshEmitter.emit())}invalidateSupportedRenderers(){}invalidateHint(){this.rendererSummaryRefreshEmitter.emit(),this.instanceRefreshEmitter.emit()}setRenderer(e){assert&&assert(e===null||e==="canvas"||e==="svg"||e==="dom"||e==="webgl",'Renderer input should be null, or one of: "canvas", "svg", "dom" or "webgl".');let t=0;e==="canvas"?t=Renderer.bitmaskCanvas:e==="svg"?t=Renderer.bitmaskSVG:e==="dom"?t=Renderer.bitmaskDOM:e==="webgl"&&(t=Renderer.bitmaskWebGL),assert&&assert(e===null==(t===0),"We should only end up with no actual renderer if renderer is null"),this._renderer!==t&&(this._renderer=t,this.invalidateHint())}set renderer(e){this.setRenderer(e)}get renderer(){return this.getRenderer()}getRenderer(){return this._renderer===0?null:this._renderer===Renderer.bitmaskCanvas?"canvas":this._renderer===Renderer.bitmaskSVG?"svg":this._renderer===Renderer.bitmaskDOM?"dom":this._renderer===Renderer.bitmaskWebGL?"webgl":(assert&&assert(!1,"Seems to be an invalid renderer?"),null)}setLayerSplit(e){e!==this._layerSplit&&(this._layerSplit=e,this.invalidateHint())}set layerSplit(e){this.setLayerSplit(e)}get layerSplit(){return this.isLayerSplit()}isLayerSplit(){return this._layerSplit}setUsesOpacity(e){e!==this._usesOpacity&&(this._usesOpacity=e,this.invalidateHint())}set usesOpacity(e){this.setUsesOpacity(e)}get usesOpacity(){return this.getUsesOpacity()}getUsesOpacity(){return this._usesOpacity}setCSSTransform(e){e!==this._cssTransform&&(this._cssTransform=e,this.invalidateHint())}set cssTransform(e){this.setCSSTransform(e)}get cssTransform(){return this.isCSSTransformed()}isCSSTransformed(){return this._cssTransform}setExcludeInvisible(e){e!==this._excludeInvisible&&(this._excludeInvisible=e,this.invalidateHint())}set excludeInvisible(e){this.setExcludeInvisible(e)}get excludeInvisible(){return this.isExcludeInvisible()}isExcludeInvisible(){return this._excludeInvisible}setExcludeInvisibleChildrenFromBounds(e){e!==this._excludeInvisibleChildrenFromBounds&&(this._excludeInvisibleChildrenFromBounds=e,this.invalidateBounds())}set excludeInvisibleChildrenFromBounds(e){this.setExcludeInvisibleChildrenFromBounds(e)}get excludeInvisibleChildrenFromBounds(){return this.isExcludeInvisibleChildrenFromBounds()}isExcludeInvisibleChildrenFromBounds(){return this._excludeInvisibleChildrenFromBounds}setLayoutOptions(e){assert&&assert(e===null||typeof e=="object"&&Object.getPrototypeOf(e)===Object.prototype,"layoutOptions should be null or an plain options-style object"),e!==this._layoutOptions&&(this._layoutOptions=e,this.layoutOptionsChangedEmitter.emit())}set layoutOptions(e){this.setLayoutOptions(e)}get layoutOptions(){return this.getLayoutOptions()}getLayoutOptions(){return this._layoutOptions}mutateLayoutOptions(e){this.layoutOptions=optionize3()({},this.layoutOptions||{},e)}get widthSizable(){return!1}get heightSizable(){return!1}get extendsWidthSizable(){return!1}get extendsHeightSizable(){return!1}get extendsSizable(){return!1}setPreventFit(e){e!==this._preventFit&&(this._preventFit=e,this.invalidateHint())}set preventFit(e){this.setPreventFit(e)}get preventFit(){return this.isPreventFit()}isPreventFit(){return this._preventFit}setWebGLScale(e){assert&&assert(e===null||typeof e=="number"&&isFinite(e)),e!==this._webglScale&&(this._webglScale=e,this.invalidateHint())}set webglScale(e){this.setWebGLScale(e)}get webglScale(){return this.getWebGLScale()}getWebGLScale(){return this._webglScale}getUniqueTrail(e){if(e){const t=this.getTrails(e);return assert&&assert(t.length===1,`getUniqueTrail found ${t.length} matching trails for the predicate`),t[0]}else{const t=new Trail;let n=this;for(;n;)assert&&assert(n._parents.length<=1,`getUniqueTrail found a Node with ${n._parents.length} parents.`),t.addAncestor(n),n=n._parents[0];return t}}getUniqueTrailTo(e){return this.getUniqueTrail(t=>e===t)}getTrails(e){e=e||Tt.defaultTrailPredicate;const t=[],n=new Trail(this);return Trail.appendAncestorTrailsWithPredicate(t,n,e),t}getTrailsTo(e){return this.getTrails(t=>t===e)}getLeafTrails(e){e=e||Tt.defaultLeafTrailPredicate;const t=[],n=new Trail(this);return Trail.appendDescendantTrailsWithPredicate(t,n,e),t}getLeafTrailsTo(e){return this.getLeafTrails(t=>t===e)}getUniqueLeafTrail(e){const t=this.getLeafTrails(e);return assert&&assert(t.length===1,`getUniqueLeafTrail found ${t.length} matching trails for the predicate`),t[0]}getUniqueLeafTrailTo(e){return this.getUniqueLeafTrail(t=>t===e)}getConnectedNodes(){const e=[];let t=this._children.concat(this._parents).concat(this);for(;t.length;){const n=t.pop();_.includes(e,n)||(e.push(n),t=t.concat(n._children,n._parents))}return e}getSubtreeNodes(){const e=[];let t=this._children.concat(this);for(;t.length;){const n=t.pop();_.includes(e,n)||(e.push(n),t=t.concat(n._children))}return e}getTopologicallySortedNodes(){const e={},t=[],n=[];let r;_.each(this.getConnectedNodes(),a=>{e[a.id]={},_.each(a._children,h=>{e[a.id][h.id]=!0}),a.parents.length||t.push(a)});function s(a){delete e[r.id][a.id],_.every(e,h=>!h[a.id])&&t.push(a)}for(;t.length;)r=t.pop(),n.push(r),_.each(r._children,s);return assert&&assert(_.every(e,a=>_.every(a,h=>!1)),"circular reference check"),n}canAddChild(e){if(this===e||_.includes(this._children,e))return!1;const t={},n=[];let r;_.each(this.getConnectedNodes().concat(e.getConnectedNodes()),a=>{t[a.id]={},_.each(a._children,h=>{t[a.id][h.id]=!0}),!a.parents.length&&a!==e&&n.push(a)}),t[this.id][e.id]=!0;function s(a){delete t[r.id][a.id],_.every(t,h=>!h[a.id])&&n.push(a)}for(;n.length;)r=n.pop(),_.each(r._children,s),r===this&&s(e);return _.every(t,a=>_.every(a,h=>!1))}canvasPaintSelf(e,t){}renderToCanvasSelf(e,t){this.isPainted()&&this._rendererBitmask&Renderer.bitmaskCanvas&&this.canvasPaintSelf(e,t)}renderToCanvasSubtree(e,t){t=t||Matrix3.identity(),e.resetStyles(),this.renderToCanvasSelf(e,t);for(let n=0;n<this._children.length;n++){const r=this._children[n];if(r.isVisible()&&r.bounds.isValid()){const s=r.effectiveOpacity!==1||r.clipArea||r._filters.length;if(e.context.save(),t.multiplyMatrix(r._transform.getMatrix()),t.canvasSetTransform(e.context),s){const a=r.localBounds.transformed(t).dilate(4).roundOut().constrainBounds(scratchBounds2Extra.setMinMax(0,0,e.canvas.width,e.canvas.height));if(a.width>0&&a.height>0){const h=document.createElement("canvas");h.width=a.width,h.height=a.height;const c=h.getContext("2d"),d=new CanvasContextWrapper(h,c),y=t.copy().prependTranslation(-a.minX,-a.minY);y.canvasSetTransform(c),r.renderToCanvasSubtree(d,y),e.context.save(),r.clipArea&&(e.context.beginPath(),r.clipArea.writeToContext(e.context),e.context.clip()),e.context.setTransform(1,0,0,1,0,0),e.context.globalAlpha=r.effectiveOpacity;let g=!1;r._filters.length&&(Features.canvasFilter&&_.every(r._filters,D=>D.isDOMCompatible())?(e.context.filter=r._filters.map(D=>D.getCSSFilterString()).join(" "),g=!0):r._filters.forEach(D=>D.applyCanvasFilter(d))),e.context.drawImage(h,a.minX,a.minY),e.context.restore(),g&&(e.context.filter="none")}}else r.renderToCanvasSubtree(e,t);t.multiplyMatrix(r._transform.getInverse()),e.context.restore()}}}renderToCanvas(e,t,n,r){assert&&deprecationWarning("Node.renderToCanvas() is deprecated, please use Node.rasterized() instead"),e.width=e.width,r&&(t.fillStyle=r,t.fillRect(0,0,e.width,e.height));const s=new CanvasContextWrapper(e,t);this.renderToCanvasSubtree(s,Matrix3.identity()),n&&n()}toCanvas(e,t,n,r,s){assert&&assert(t===void 0||typeof t=="number","If provided, x should be a number"),assert&&assert(n===void 0||typeof n=="number","If provided, y should be a number"),assert&&assert(r===void 0||typeof r=="number"&&r>=0&&r%1===0,"If provided, width should be a non-negative integer"),assert&&assert(s===void 0||typeof s=="number"&&s>=0&&s%1===0,"If provided, height should be a non-negative integer");const a=2,h=this.getBounds().union(this.localToParentBounds(this.getSafeSelfBounds()));assert&&assert(!h.isEmpty()||t!==void 0&&n!==void 0&&r!==void 0&&s!==void 0,"Should not call toCanvas on a Node with empty bounds, unless all dimensions are provided"),t=t!==void 0?t:Math.ceil(a-h.minX),n=n!==void 0?n:Math.ceil(a-h.minY),r=r!==void 0?r:Math.ceil(h.getWidth()+2*a),s=s!==void 0?s:Math.ceil(h.getHeight()+2*a);const c=document.createElement("canvas");c.width=r,c.height=s;const d=c.getContext("2d");d.translate(t,n),this._transform.getMatrix().canvasAppendTransform(d);const y=new CanvasContextWrapper(c,d);this.renderToCanvasSubtree(y,Matrix3.translation(t,n).timesMatrix(this._transform.getMatrix())),e(c,t,n,r,s)}toDataURL(e,t,n,r,s){assert&&assert(t===void 0||typeof t=="number","If provided, x should be a number"),assert&&assert(n===void 0||typeof n=="number","If provided, y should be a number"),assert&&assert(r===void 0||typeof r=="number"&&r>=0&&r%1===0,"If provided, width should be a non-negative integer"),assert&&assert(s===void 0||typeof s=="number"&&s>=0&&s%1===0,"If provided, height should be a non-negative integer"),this.toCanvas((a,h,c,d,y)=>{e(a.toDataURL(),h,c,d,y)},t,n,r,s)}toImage(e,t,n,r,s){assert&&deprecationWarning("Node.toImage() is deprecated, please use Node.rasterized() instead"),assert&&assert(t===void 0||typeof t=="number","If provided, x should be a number"),assert&&assert(n===void 0||typeof n=="number","If provided, y should be a number"),assert&&assert(r===void 0||typeof r=="number"&&r>=0&&r%1===0,"If provided, width should be a non-negative integer"),assert&&assert(s===void 0||typeof s=="number"&&s>=0&&s%1===0,"If provided, height should be a non-negative integer"),this.toDataURL((a,h,c)=>{const d=document.createElement("img");d.onload=()=>{e(d,h,c);try{delete d.onload}catch{}},d.src=a},t,n,r,s)}toImageNodeAsynchronous(e,t,n,r,s){assert&&deprecationWarning("Node.toImageNodeAsyncrhonous() is deprecated, please use Node.rasterized() instead"),assert&&assert(t===void 0||typeof t=="number","If provided, x should be a number"),assert&&assert(n===void 0||typeof n=="number","If provided, y should be a number"),assert&&assert(r===void 0||typeof r=="number"&&r>=0&&r%1===0,"If provided, width should be a non-negative integer"),assert&&assert(s===void 0||typeof s=="number"&&s>=0&&s%1===0,"If provided, height should be a non-negative integer"),this.toImage((a,h,c)=>{e(new Tt({children:[new Image$1(a,{x:-h,y:-c})]}))},t,n,r,s)}toCanvasNodeSynchronous(e,t,n,r){assert&&deprecationWarning("Node.toCanvasNodeSynchronous() is deprecated, please use Node.rasterized() instead"),assert&&assert(e===void 0||typeof e=="number","If provided, x should be a number"),assert&&assert(t===void 0||typeof t=="number","If provided, y should be a number"),assert&&assert(n===void 0||typeof n=="number"&&n>=0&&n%1===0,"If provided, width should be a non-negative integer"),assert&&assert(r===void 0||typeof r=="number"&&r>=0&&r%1===0,"If provided, height should be a non-negative integer");let s=null;return this.toCanvas((a,h,c)=>{s=new Tt({children:[new Image$1(a,{x:-h,y:-c})]})},e,t,n,r),assert&&assert(s,"toCanvasNodeSynchronous requires that the node can be rendered only using Canvas"),s}toDataURLImageSynchronous(e,t,n,r){assert&&deprecationWarning("Node.toDataURLImageSychronous() is deprecated, please use Node.rasterized() instead"),assert&&assert(e===void 0||typeof e=="number","If provided, x should be a number"),assert&&assert(t===void 0||typeof t=="number","If provided, y should be a number"),assert&&assert(n===void 0||typeof n=="number"&&n>=0&&n%1===0,"If provided, width should be a non-negative integer"),assert&&assert(r===void 0||typeof r=="number"&&r>=0&&r%1===0,"If provided, height should be a non-negative integer");let s=null;return this.toDataURL((a,h,c,d,y)=>{s=new Image$1(a,{x:-h,y:-c,initialWidth:d,initialHeight:y})},e,t,n,r),assert&&assert(s,"toDataURL failed to return a result synchronously"),s}toDataURLNodeSynchronous(e,t,n,r){return assert&&deprecationWarning("Node.toDataURLNodeSynchronous() is deprecated, please use Node.rasterized() instead"),assert&&assert(e===void 0||typeof e=="number","If provided, x should be a number"),assert&&assert(t===void 0||typeof t=="number","If provided, y should be a number"),assert&&assert(n===void 0||typeof n=="number"&&n>=0&&n%1===0,"If provided, width should be a non-negative integer"),assert&&assert(r===void 0||typeof r=="number"&&r>=0&&r%1===0,"If provided, height should be a non-negative integer"),new Tt({children:[this.toDataURLImageSynchronous(e,t,n,r)]})}rasterized(e){const t=optionize()({resolution:1,sourceBounds:null,useTargetBounds:!0,wrap:!0,useCanvas:!1,imageOptions:{}},e),n=t.resolution,r=t.sourceBounds;assert&&(assert(typeof n=="number"&&n>0,"resolution should be a positive number"),assert(r===null||r instanceof Bounds2,"sourceBounds should be null or a Bounds2"),r&&(assert(r.isValid(),"sourceBounds should be valid (finite non-negative)"),assert(Number.isInteger(r.width),"sourceBounds.width should be an integer"),assert(Number.isInteger(r.height),"sourceBounds.height should be an integer")));const s=new Tt({scale:n,children:[this]});let a=r||this.getSafeTransformedVisibleBounds().dilated(2).roundedOut();n!==1&&(a=new Bounds2(n*a.minX,n*a.minY,n*a.maxX,n*a.maxY),a.width%1!==0&&(a.maxX+=1-a.width%1),a.height%1!==0&&(a.maxY+=1-a.height%1));let h=null;function c(y,g,D,O,V){const k=t.useCanvas?y:y.toDataURL();h=new Image$1(k,combineOptions({},t.imageOptions,{x:-g,y:-D,initialWidth:O,initialHeight:V})),h.scale(1/n,1/n,!0)}s.toCanvas(c,-a.minX,-a.minY,DotUtils.roundSymmetric(a.width),DotUtils.roundSymmetric(a.height)),assert&&assert(h,"The toCanvas should have executed synchronously"),s.dispose();let d=this.getVisibleBounds();if(r&&(d=r.intersection(d)),t.useTargetBounds&&(h.imageBounds=h.parentToLocalBounds(d)),t.wrap){const y=new Tt({children:[h]});return t.useTargetBounds&&(y.localBounds=d),y}else return t.useTargetBounds&&(h.localBounds=h.parentToLocalBounds(d)),h}createDOMDrawable(e,t){throw new Error("createDOMDrawable is abstract. The subtype should either override this method, or not support the DOM renderer")}createSVGDrawable(e,t){throw new Error("createSVGDrawable is abstract. The subtype should either override this method, or not support the DOM renderer")}createCanvasDrawable(e,t){throw new Error("createCanvasDrawable is abstract. The subtype should either override this method, or not support the DOM renderer")}createWebGLDrawable(e,t){throw new Error("createWebGLDrawable is abstract. The subtype should either override this method, or not support the DOM renderer")}getInstances(){return this._instances}get instances(){return this.getInstances()}addInstance(e){this._instances.push(e),this.changedInstanceEmitter.emit(e,!0)}removeInstance(e){const t=_.indexOf(this._instances,e);assert&&assert(t!==-1,"Cannot remove a Instance from a Node if it was not there"),this._instances.splice(t,1),this.changedInstanceEmitter.emit(e,!1)}wasVisuallyDisplayed(e){for(let t=0;t<this._instances.length;t++){const n=this._instances[t];if(n.visible&&(!e||n.display===e))return!0}return!1}getRootedDisplays(){return this._rootedDisplays}get rootedDisplays(){return this.getRootedDisplays()}addRootedDisplay(e){this._rootedDisplays.push(e),this._pdomDisplaysInfo.onAddedRootedDisplay(e),this.rootedDisplayChangedEmitter.emit(e)}removeRootedDisplay(e){const t=_.indexOf(this._rootedDisplays,e);assert&&assert(t!==-1,"Cannot remove a Display from a Node if it was not there"),this._rootedDisplays.splice(t,1),this._pdomDisplaysInfo.onRemovedRootedDisplay(e),this.rootedDisplayChangedEmitter.emit(e)}getRecursiveConnectedDisplays(e){this.rootedDisplays.length&&e.push(...this.rootedDisplays);for(let t=0;t<this._parents.length;t++)e.push(...this._parents[t].getRecursiveConnectedDisplays(e));return _.uniq(e)}getConnectedDisplays(){return _.uniq(this.getRecursiveConnectedDisplays([]))}localToParentPoint(e){return this._transform.transformPosition2(e)}localToParentBounds(e){return this._transform.transformBounds2(e)}parentToLocalPoint(e){return this._transform.inversePosition2(e)}parentToLocalBounds(e){return this._transform.inverseBounds2(e)}transformBoundsFromLocalToParent(e){return e.transform(this._transform.getMatrix())}transformBoundsFromParentToLocal(e){return e.transform(this._transform.getInverse())}getLocalToGlobalMatrix(){let e=this;const t=[];for(;e;)t.push(e._transform.getMatrix()),assert&&assert(e._parents[1]===void 0,"getLocalToGlobalMatrix unable to work for DAG"),e=e._parents[0];const n=Matrix3.identity();for(let r=t.length-1;r>=0;r--)n.multiplyMatrix(t[r]);return n}getUniqueTransform(){return new Transform3(this.getLocalToGlobalMatrix())}getGlobalToLocalMatrix(){return this.getLocalToGlobalMatrix().invert()}localToGlobalPoint(e){let t=this;const n=e.copy();for(;t;)t._transform.getMatrix().multiplyVector2(n),assert&&assert(t._parents[1]===void 0,"localToGlobalPoint unable to work for DAG"),t=t._parents[0];return n}globalToLocalPoint(e){let t=this;const n=[];for(;t;)n.push(t._transform),assert&&assert(t._parents[1]===void 0,"globalToLocalPoint unable to work for DAG"),t=t._parents[0];const r=e.copy();for(let s=n.length-1;s>=0;s--)n[s].getInverse().multiplyVector2(r);return r}localToGlobalBounds(e){return e.transformed(this.getLocalToGlobalMatrix())}globalToLocalBounds(e){return e.transformed(this.getGlobalToLocalMatrix())}parentToGlobalPoint(e){return assert&&assert(this.parents.length<=1,"parentToGlobalPoint unable to work for DAG"),this.parents.length?this.parents[0].localToGlobalPoint(e):e}parentToGlobalBounds(e){return assert&&assert(this.parents.length<=1,"parentToGlobalBounds unable to work for DAG"),this.parents.length?this.parents[0].localToGlobalBounds(e):e}globalToParentPoint(e){return assert&&assert(this.parents.length<=1,"globalToParentPoint unable to work for DAG"),this.parents.length?this.parents[0].globalToLocalPoint(e):e}globalToParentBounds(e){return assert&&assert(this.parents.length<=1,"globalToParentBounds unable to work for DAG"),this.parents.length?this.parents[0].globalToLocalBounds(e):e}getGlobalBounds(){return assert&&assert(this.parents.length<=1,"globalBounds unable to work for DAG"),this.parentToGlobalBounds(this.getBounds())}get globalBounds(){return this.getGlobalBounds()}boundsOf(e){return this.globalToLocalBounds(e.getGlobalBounds())}boundsTo(e){return e.globalToLocalBounds(this.getGlobalBounds())}attachDrawable(e){return this._drawables.push(e),this}detachDrawable(e){const t=_.indexOf(this._drawables,e);return assert&&assert(t>=0,"Invalid operation: trying to detach a non-referenced drawable"),this._drawables.splice(t,1),this}mutate(e){if(!e)return this;assert&&assert(Object.getPrototypeOf(e)===Object.prototype,"Extra prototype on Node options object is a code smell"),assert&&assert(_.filter(["translation","x","left","right","centerX","centerTop","rightTop","leftCenter","center","rightCenter","leftBottom","centerBottom","rightBottom"],n=>e[n]!==void 0).length<=1,`More than one mutation on this Node set the x component, check ${Object.keys(e).join(",")}`),assert&&assert(_.filter(["translation","y","top","bottom","centerY","centerTop","rightTop","leftCenter","center","rightCenter","leftBottom","centerBottom","rightBottom"],n=>e[n]!==void 0).length<=1,`More than one mutation on this Node set the y component, check ${Object.keys(e).join(",")}`),assert&&e.hasOwnProperty("enabled")&&e.hasOwnProperty("enabledProperty")&&assert&&assert(e.enabledProperty.value===e.enabled,"If both enabled and enabledProperty are provided, then values should match"),assert&&e.hasOwnProperty("inputEnabled")&&e.hasOwnProperty("inputEnabledProperty")&&assert&&assert(e.inputEnabledProperty.value===e.inputEnabled,"If both inputEnabled and inputEnabledProperty are provided, then values should match"),assert&&e.hasOwnProperty("visible")&&e.hasOwnProperty("visibleProperty")&&assert&&assert(e.visibleProperty.value===e.visible,"If both visible and visibleProperty are provided, then values should match"),assert&&e.hasOwnProperty("pdomVisible")&&e.hasOwnProperty("pdomVisibleProperty")&&assert&&assert(e.pdomVisibleProperty.value===e.pdomVisible,"If both pdomVisible and pdomVisibleProperty are provided, then values should match"),assert&&e.hasOwnProperty("pickable")&&e.hasOwnProperty("pickableProperty")&&assert&&assert(e.pickableProperty.value===e.pickable,"If both pickable and pickableProperty are provided, then values should match");const t=this._mutatorKeys;for(let n=0;n<t.length;n++){const r=t[n];if(assert&&assert(!e.hasOwnProperty(r)||e[r]!==void 0,`Undefined not allowed for Node key: ${r}`),e[r]!==void 0){const s=Object.getOwnPropertyDescriptor(Tt.prototype,r);s&&typeof s.value=="function"?this[r](e[r]):this[r]=e[r]}}return this.initializePhetioObject(DEFAULT_PHET_IO_OBJECT_BASE_OPTIONS,e),this}initializePhetioObject(e,t){const n=this.isPhetioInstrumented();super.initializePhetioObject(e,t),Tandem.PHET_IO_ENABLED&&!n&&this.isPhetioInstrumented()&&(this._visibleProperty.initializePhetio(this,VISIBLE_PROPERTY_TANDEM_NAME,()=>new BooleanProperty(this.visible,combineOptions({phetioReadOnly:this.phetioReadOnly,tandem:this.tandem.createTandem(VISIBLE_PROPERTY_TANDEM_NAME),phetioDocumentation:"Controls whether the Node will be visible (and interactive)."},t.visiblePropertyOptions))),this._enabledProperty.initializePhetio(this,ENABLED_PROPERTY_TANDEM_NAME,()=>new EnabledProperty(this.enabled,combineOptions({phetioReadOnly:this.phetioReadOnly,phetioDocumentation:'Sets whether the node is enabled. This will set whether input is enabled for this Node and most often children as well. It will also control and toggle the "disabled look" of the node.',tandem:this.tandem.createTandem(ENABLED_PROPERTY_TANDEM_NAME)},t.enabledPropertyOptions))),this._inputEnabledProperty.initializePhetio(this,INPUT_ENABLED_PROPERTY_TANDEM_NAME,()=>new Property(this.inputEnabled,combineOptions({phetioReadOnly:this.phetioReadOnly,tandem:this.tandem.createTandem(INPUT_ENABLED_PROPERTY_TANDEM_NAME),phetioValueType:BooleanIO,phetioFeatured:!0,phetioDocumentation:"Sets whether the element will have input enabled, and hence be interactive."},t.inputEnabledPropertyOptions))))}setVoicingVisible(e){this.voicingVisibleProperty.value!==e&&(this.voicingVisibleProperty.value=e)}set voicingVisible(e){this.setVoicingVisible(e)}get voicingVisible(){return this.isVoicingVisible()}isVoicingVisible(){return this.voicingVisibleProperty.value}getDebugHTMLExtras(){return""}inspect(){localStorage.scenerySnapshot=JSON.stringify({type:"Subtree",rootNodeId:this.id,nodes:serializeConnectedNodes(this)})}toString(){return`${this.constructor.name}#${this.id}`}auditInstanceSubtreeForDisplay(e){if(assertSlow){const t=this._instances.length;for(let n=0;n<t;n++){const r=this._instances[n];r.display===e&&assertSlow(r.trail.isValid(),`Invalid trail on Instance: ${r.toString()} with trail ${r.trail.toString()}`)}this.children.forEach(n=>{n.auditInstanceSubtreeForDisplay(e)})}}onBoundsListenersAddedOrRemoved(e){this.changeBoundsEventCount(e),this._boundsEventSelfCount+=e}dispose(){this.disposeParallelDOM(),this.removeAllChildren(),this.detach(),this._inputEnabledProperty.dispose(),this._enabledProperty.dispose(),this._pickableProperty.dispose(),this._visibleProperty.dispose(),super.dispose()}disposeSubtree(){if(!this.isDisposed){const e=this.children;this.dispose();for(let t=0;t<e.length;t++)e[t].disposeSubtree()}}static defaultTrailPredicate(e){return e._parents.length===0}static defaultLeafTrailPredicate(e){return e._children.length===0}},Tt.REQUIRES_BOUNDS_OPTION_KEYS=REQUIRES_BOUNDS_OPTION_KEYS,Tt.DEFAULT_NODE_OPTIONS=DEFAULT_OPTIONS$7,Tt);Node$1.prototype._mutatorKeys=ACCESSIBILITY_OPTION_KEYS.concat(NODE_OPTION_KEYS);Node$1.prototype.drawableMarkFlags=[];scenery.register("Node",Node$1);Node$1.NodeIO=new IOType("NodeIO",{valueType:Node$1,documentation:"The base type for graphical and potentially interactive objects.",metadataDefaults:{phetioState:PHET_IO_STATE_DEFAULT$1}});const DEFAULT_PHET_IO_OBJECT_BASE_OPTIONS={phetioType:Node$1.NodeIO,phetioState:PHET_IO_STATE_DEFAULT$1},Node$2=Node$1;class Picker{constructor(e){this.node=e,this.selfPruned=!1,this.selfInclusive=!1,this.subtreePrunable=!0,this.subtreePickableCount=0,this.mouseInclusiveBounds=Bounds2.NOTHING.copy(),this.mouseExclusiveBounds=Bounds2.NOTHING.copy(),this.touchInclusiveBounds=Bounds2.NOTHING.copy(),this.touchExclusiveBounds=Bounds2.NOTHING.copy(),this.mouseInclusiveDirty=!0,this.mouseExclusiveDirty=!0,this.touchInclusiveDirty=!0,this.touchExclusiveDirty=!0,this.scratchVector=new Vector2(0,0)}hitTest(e,t,n){assert&&assert(e,"trailUnderPointer requires a point"),sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`-------------- ${this.node.constructor.name}#${this.node.id}`);const r=this.selfInclusive;return t?r?this.validateMouseInclusive():this.validateMouseExclusive():n?r?this.validateTouchInclusive():this.validateTouchExclusive():this.node.validateBounds(),this.recursiveHitTest(e,t,n,!1)}recursiveHitTest(e,t,n,r){if(r=r||this.selfInclusive,this.selfPruned||!r&&this.subtreePrunable)return sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`${this.node.constructor.name}#${this.node.id} pruned ${this.selfPruned?"(self)":"(subtree)"}`),null;let s;if(t?(s=r?this.mouseInclusiveBounds:this.mouseExclusiveBounds,assert&&assert(r?!this.mouseInclusiveDirty:!this.mouseExclusiveDirty)):n?(s=r?this.touchInclusiveBounds:this.touchExclusiveBounds,assert&&assert(r?!this.touchInclusiveDirty:!this.touchExclusiveDirty)):(s=this.node.bounds,assert&&assert(!this.node._boundsDirty)),!s.containsPoint(e))return sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`${this.node.constructor.name}#${this.node.id} pruned: ${t?"mouse":n?"touch":"regular"}`),null;const a=this.node._transform.getInverse().multiplyVector2(this.scratchVector.set(e)),h=this.node.clipArea;if(h!==null&&!h.containsPoint(a))return sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`${this.node.constructor.name}#${this.node.id} out of clip area`),null;sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`${this.node.constructor.name}#${this.node.id}`);for(let c=this.node._children.length-1;c>=0;c--){const d=this.node._children[c];sceneryLog&&sceneryLog.hitTest&&sceneryLog.push();const y=d._picker.recursiveHitTest(a,t,n,r);if(sceneryLog&&sceneryLog.hitTest&&sceneryLog.pop(),y)return y.addAncestor(this.node,c)}return t&&this.node._mouseArea?(sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`${this.node.constructor.name}#${this.node.id} mouse area hit`),this.node._mouseArea.containsPoint(a)?new Trail(this.node):null):n&&this.node._touchArea?(sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`${this.node.constructor.name}#${this.node.id} touch area hit`),this.node._touchArea.containsPoint(a)?new Trail(this.node):null):this.node.selfBounds.containsPoint(a)&&this.node.containsPointSelf(a)?(sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`${this.node.constructor.name}#${this.node.id} self hit`),new Trail(this.node)):null}invalidate(e,t){let n=!!t||!this.mouseInclusiveDirty||!this.touchInclusiveDirty;if(this.mouseInclusiveDirty=!0,this.touchInclusiveDirty=!0,e&&(n=n||!this.mouseExclusiveDirty||!this.touchExclusiveDirty,this.mouseExclusiveDirty=!0,this.touchExclusiveDirty=!0),!this.selfPruned&&n){const r=this.node._parents;for(let s=0;s<r.length;s++)r[s]._picker.invalidate(e||this.selfInclusive,!1)}}validateMouseInclusive(){if(!this.mouseInclusiveDirty)return;this.mouseInclusiveBounds.set(this.node.selfBounds);const e=this.node._children;for(let t=0;t<e.length;t++){const n=e[t]._picker;n.selfPruned||(n.validateMouseInclusive(),this.mouseInclusiveBounds.includeBounds(n.mouseInclusiveBounds))}this.applyAreasAndTransform(this.mouseInclusiveBounds,this.node._mouseArea),this.mouseInclusiveDirty=!1}validateMouseExclusive(){if(!this.mouseExclusiveDirty)return;this.mouseExclusiveBounds.set(this.node.selfBounds);const e=this.node._children;for(let t=0;t<e.length;t++){const n=e[t]._picker;n.subtreePrunable||(n.selfInclusive?(n.validateMouseInclusive(),this.mouseExclusiveBounds.includeBounds(n.mouseInclusiveBounds)):(n.validateMouseExclusive(),this.mouseExclusiveBounds.includeBounds(n.mouseExclusiveBounds)))}this.applyAreasAndTransform(this.mouseExclusiveBounds,this.node._mouseArea),this.mouseExclusiveDirty=!1}validateTouchInclusive(){if(!this.touchInclusiveDirty)return;this.touchInclusiveBounds.set(this.node.selfBounds);const e=this.node._children;for(let t=0;t<e.length;t++){const n=e[t]._picker;n.selfPruned||(n.validateTouchInclusive(),this.touchInclusiveBounds.includeBounds(n.touchInclusiveBounds))}this.applyAreasAndTransform(this.touchInclusiveBounds,this.node._touchArea),this.touchInclusiveDirty=!1}validateTouchExclusive(){if(!this.touchExclusiveDirty)return;this.touchExclusiveBounds.set(this.node.selfBounds);const e=this.node._children;for(let t=0;t<e.length;t++){const n=e[t]._picker;n.subtreePrunable||(n.selfInclusive?(n.validateTouchInclusive(),this.touchExclusiveBounds.includeBounds(n.touchInclusiveBounds)):(n.validateTouchExclusive(),this.touchExclusiveBounds.includeBounds(n.touchExclusiveBounds)))}this.applyAreasAndTransform(this.touchExclusiveBounds,this.node._touchArea),this.touchExclusiveDirty=!1}applyAreasAndTransform(e,t){t&&e.includeBounds(t instanceof Bounds2?t:t.bounds);const n=this.node.clipArea;if(n){const r=n.bounds;e.minX=Math.max(e.minX,r.minX),e.minY=Math.max(e.minY,r.minY),e.maxX=Math.min(e.maxX,r.maxX),e.maxY=Math.min(e.maxY,r.maxY)}this.node.transformBoundsFromLocalToParent(e)}onInsertChild(e){if(!e._picker.selfPruned){const t=e._picker.subtreePickableCount>0;t&&this.changePickableCount(1),this.invalidate(t,!0)}}onRemoveChild(e){if(!e._picker.selfPruned){const t=e._picker.subtreePickableCount>0;t&&this.changePickableCount(-1),this.invalidate(t,!0)}}onAddInputListener(){this.checkSelfInclusive(),this.checkSubtreePrunable(),this.changePickableCount(1),assertSlow&&this.audit()}onRemoveInputListener(){this.checkSelfInclusive(),this.checkSubtreePrunable(),this.changePickableCount(-1),assertSlow&&this.audit()}onPickableChange(e,t){this.checkSelfPruned(),this.checkSelfInclusive(),this.checkSubtreePrunable();const n=(e===!0?-1:0)+(t===!0?1:0);n&&this.changePickableCount(n),assertSlow&&this.audit()}onVisibilityChange(){this.checkSelfPruned(),this.checkSubtreePrunable()}onMouseAreaChange(){this.invalidate(!0)}onTouchAreaChange(){this.invalidate(!0)}onTransformChange(){this.invalidate(!0)}onSelfBoundsDirty(){this.invalidate(!0)}onClipAreaChange(){this.invalidate(!0)}checkSelfPruned(){const e=this.node.pickableProperty.value===!1||!this.node.isVisible();if(this.selfPruned!==e){this.selfPruned=e;const t=this.node._parents;for(let n=0;n<t.length;n++){const r=t[n]._picker;this.subtreePickableCount>0?(r.invalidate(!0,!0),r.changePickableCount(this.selfPruned?-1:1)):r.invalidate(!1,!0)}}}checkSelfInclusive(){const e=this.node.pickableProperty.value===!0||this.node._inputListeners.length>0;this.selfInclusive!==e&&(this.selfInclusive=e,this.invalidate(!0,!0))}checkSubtreePrunable(){const e=this.node.pickableProperty.value===!1||!this.node.isVisible()||this.node.pickableProperty.value!==!0&&this.subtreePickableCount===0;this.subtreePrunable!==e&&(this.subtreePrunable=e,this.invalidate(!0,!0))}changePickableCount(e){if(e===0)return;const t=this.subtreePickableCount===0;this.subtreePickableCount+=e;const n=this.subtreePickableCount===0;if(this.checkSubtreePrunable(),assert&&assert(this.subtreePickableCount>=0,"subtree pickable count should be guaranteed to be >= 0"),!this.selfPruned&&t!==n){const r=this.node._parents.length;for(let s=0;s<r;s++)this.node._parents[s]._picker.changePickableCount(t?1:-1)}}audit(){if(assertSlow){this.node._children.forEach(a=>{a._picker.audit()});const e=assertSlow,t=this.node.pickable===!1||!this.node.isVisible(),n=this.node.pickable===!0||this.node._inputListeners.length>0,r=this.node.pickable===!1||!this.node.isVisible()||this.node.pickable!==!0&&this.subtreePickableCount===0,s=this.node._inputListeners.length+(this.node.pickableProperty.value===!0?1:0)+_.filter(this.node._children,a=>!a._picker.selfPruned&&a._picker.subtreePickableCount>0).length;assertSlow(this.selfPruned===t,"selfPruned mismatch"),assertSlow(this.selfInclusive===n,"selfInclusive mismatch"),assertSlow(this.subtreePrunable===r,"subtreePrunable mismatch"),assertSlow(this.subtreePickableCount===s,"subtreePickableCount mismatch"),this.node._parents.forEach(a=>{const h=a._picker,c=this;h.mouseInclusiveDirty||e(c.selfPruned||!c.mouseInclusiveDirty),h.mouseExclusiveDirty||(c.selfInclusive?e(c.selfPruned||!c.mouseInclusiveDirty):e(c.selfPruned||c.subtreePrunable||!c.mouseExclusiveDirty)),h.touchInclusiveDirty||e(c.selfPruned||!c.touchInclusiveDirty),h.touchExclusiveDirty||(c.selfInclusive?e(c.selfPruned||!c.touchInclusiveDirty):e(c.selfPruned||c.subtreePrunable||!c.touchExclusiveDirty))})}}}scenery.register("Picker",Picker);const summaryBits=[Renderer.bitmaskCanvas,Renderer.bitmaskSVG,Renderer.bitmaskDOM,Renderer.bitmaskWebGL,Renderer.bitmaskSingleCanvas,Renderer.bitmaskSingleSVG,Renderer.bitmaskNotPainted,Renderer.bitmaskBoundsValid,Renderer.bitmaskNoPDOM,Renderer.bitmaskLacksCanvas,Renderer.bitmaskLacksSVG,Renderer.bitmaskLacksDOM,Renderer.bitmaskLacksWebGL],summaryBitIndices={};summaryBits.forEach((o,e)=>{summaryBitIndices[o]=e});const numSummaryBits=summaryBits.length;let bitmaskAll=0;for(let o=0;o<numSummaryBits;o++)bitmaskAll|=summaryBits[o];class RendererSummary{constructor(e){assert&&assert(e instanceof Node$2),assert&&assert(e._rendererBitmask===Renderer.bitmaskNodeDefault,"Node must have a default bitmask when creating a RendererSummary"),assert&&assert(e._children.length===0,"Node cannot have children when creating a RendererSummary"),this.node=e,this._counts=new Int16Array(numSummaryBits),this.bitmask=bitmaskAll,this.selfBitmask=RendererSummary.summaryBitmaskForNodeSelf(e),this.summaryChange(this.bitmask,this.selfBitmask);const t=this.selfChange.bind(this);this.node.filterChangeEmitter.addListener(t),this.node.clipAreaProperty.lazyLink(t),this.node.rendererSummaryRefreshEmitter.addListener(t)}summaryChange(e,t){assert&&this.audit();const n=e^t;let r=0,s=0;for(let a=0;a<numSummaryBits;a++){const h=summaryBits[a],c=summaryBitIndices[h];h&n&&(h&t?(this._counts[c]--,this._counts[c]===0&&(s|=h)):(this._counts[c]++,this._counts[c]===1&&(r|=h)))}if(r||s){const a=this.bitmask;assert&&assert(a!==void 0);for(let c=0;c<numSummaryBits;c++){const d=summaryBits[c];s&d&&(this.bitmask|=d),r&d&&(this.bitmask^=d,assert&&assert(!(this.bitmask&d),"Should be cleared, doing cheaper XOR assuming it already was set"))}this.node.instanceRefreshEmitter.emit(),this.node.onSummaryChange(a,this.bitmask);const h=this.node._parents.length;for(let c=0;c<h;c++)this.node._parents[c]._rendererSummary.summaryChange(r,s);assert&&assert(this.bitmask===this.computeBitmask(),"Sanity check")}assert&&this.audit()}selfChange(){const e=this.selfBitmask,t=RendererSummary.summaryBitmaskForNodeSelf(this.node);e!==t&&(this.summaryChange(e,t),this.selfBitmask=t)}computeBitmask(){let e=0;for(let t=0;t<numSummaryBits;t++)this._counts[t]===0&&(e|=summaryBits[t]);return e}isSubtreeFullyCompatible(e){return!!(e&this.bitmask)}isSubtreeContainingCompatible(e){return!(e<<Renderer.bitmaskLacksShift&this.bitmask)}isSingleCanvasSupported(){return!!(Renderer.bitmaskSingleCanvas&this.bitmask)}isSingleSVGSupported(){return!!(Renderer.bitmaskSingleSVG&this.bitmask)}isNotPainted(){return!!(Renderer.bitmaskNotPainted&this.bitmask)}hasNoPDOM(){return!!(Renderer.bitmaskNoPDOM&this.bitmask)}areBoundsValid(){return!!(Renderer.bitmaskBoundsValid&this.bitmask)}isSubtreeRenderedExclusivelySVG(e){if(!this.isSingleSVGSupported())return!1;for(let t=0;t<Renderer.numActiveRenderers;t++){const n=Renderer.bitmaskOrder(e,t);if(Renderer.bitmaskSVG&n)return!0;if(this.isSubtreeContainingCompatible(n))return!1}return!1}isSubtreeRenderedExclusivelyCanvas(e){if(!this.isSingleCanvasSupported())return!1;for(let t=0;t<Renderer.numActiveRenderers;t++){const n=Renderer.bitmaskOrder(e,t);if(Renderer.bitmaskCanvas&n)return!0;if(this.isSubtreeContainingCompatible(n))return!1}return!1}audit(){if(assert)for(let e=0;e<numSummaryBits;e++){const t=summaryBits[e],n=this._counts[e]===0,r=!!(this.bitmask&t);assert(n===r,"Bits should be set if count is zero")}}toString(){let e=RendererSummary.bitmaskToString(this.bitmask);for(let t=0;t<numSummaryBits;t++){const n=summaryBits[t],r=this._counts[t];r!==0&&(e+=` ${RendererSummary.bitToString(n)}:${r}`)}return e}static summaryBitmaskForNodeSelf(e){let t=e._rendererBitmask;e.isPainted()?t|=(e._rendererBitmask&Renderer.bitmaskCurrentRendererArea^Renderer.bitmaskCurrentRendererArea)<<Renderer.bitmaskLacksShift:t|=Renderer.bitmaskCurrentRendererArea<<Renderer.bitmaskLacksShift;const n=e._cssTransform||e._layerSplit,r=e._renderer;return!n&&Renderer.isSVG(e._rendererBitmask)&&(!r||Renderer.isSVG(r))&&(t|=Renderer.bitmaskSingleSVG),!n&&Renderer.isCanvas(e._rendererBitmask)&&(!r||Renderer.isCanvas(r))&&(t|=Renderer.bitmaskSingleCanvas),e.isPainted()||(t|=Renderer.bitmaskNotPainted),e.areSelfBoundsValid()&&(t|=Renderer.bitmaskBoundsValid),!e.hasPDOMContent&&!e.hasPDOMOrder()&&(t|=Renderer.bitmaskNoPDOM),t}static bitToString(e){return e===Renderer.bitmaskCanvas?"Canvas":e===Renderer.bitmaskSVG?"SVG":e===Renderer.bitmaskDOM?"DOM":e===Renderer.bitmaskWebGL?"WebGL":e===Renderer.bitmaskLacksCanvas?"(-Canvas)":e===Renderer.bitmaskLacksSVG?"(-SVG)":e===Renderer.bitmaskLacksDOM?"(-DOM)":e===Renderer.bitmaskLacksWebGL?"(-WebGL)":e===Renderer.bitmaskSingleCanvas?"SingleCanvas":e===Renderer.bitmaskSingleSVG?"SingleSVG":e===Renderer.bitmaskNotPainted?"NotPainted":e===Renderer.bitmaskBoundsValid?"BoundsValid":e===Renderer.bitmaskNoPDOM?"NotAccessible":"?"}static bitmaskToString(e){let t="";for(let n=0;n<numSummaryBits;n++){const r=summaryBits[n];e&r&&(t+=`${RendererSummary.bitToString(r)} `)}return t}}RendererSummary.bitmaskAll=bitmaskAll;scenery.register("RendererSummary",RendererSummary);const RendererSummary$1=RendererSummary;class PDOMDisplaysInfo{constructor(e){this.node=e,this.pdomDisplays=[]}onAddChild(e){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`onAddChild n#${e.id} (parent:n#${this.node.id})`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),e._pdomDisplaysInfo.canHavePDOMDisplays()&&e._pdomDisplaysInfo.addPDOMDisplays(this.pdomDisplays),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}onRemoveChild(e){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`onRemoveChild n#${e.id} (parent:n#${this.node.id})`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),e._pdomDisplaysInfo.canHavePDOMDisplays()&&e._pdomDisplaysInfo.removePDOMDisplays(this.pdomDisplays),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}onSummaryChange(e,t){if(sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`onSummaryChange n#${this.node.id} wasPDOM:${!(Renderer.bitmaskNoPDOM&e)}, isPDOM:${!(Renderer.bitmaskNoPDOM&t)}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),this.node.visible&&this.node.pdomVisible){const n=!(Renderer.bitmaskNoPDOM&e),r=!(Renderer.bitmaskNoPDOM&t);r&&!n&&this.addAllPDOMDisplays(),!r&&n&&this.removeAllPDOMDisplays()}sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}onVisibilityChange(e){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`onVisibilityChange n#${this.node.id} visible:${e}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),this.node.pdomVisible&&!this.node._rendererSummary.hasNoPDOM()&&(e?this.addAllPDOMDisplays():this.removeAllPDOMDisplays()),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}onPDOMVisibilityChange(e){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`onPDOMVisibilityChange n#${this.node.id} pdomVisible:${e}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),this.node.visible&&!this.node._rendererSummary.hasNoPDOM()&&(e?this.addAllPDOMDisplays():this.removeAllPDOMDisplays()),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}onAddedRootedDisplay(e){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`onAddedRootedDisplay n#${this.node.id}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),e._accessible&&this.canHavePDOMDisplays()&&this.addPDOMDisplays([e]),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}onRemovedRootedDisplay(e){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`onRemovedRootedDisplay n#${this.node.id}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),e._accessible&&this.canHavePDOMDisplays()&&this.removePDOMDisplays([e]),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}canHavePDOMDisplays(){return this.node.visible&&this.node.pdomVisible&&!this.node._rendererSummary.hasNoPDOM()}addAllPDOMDisplays(){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`addAllPDOMDisplays n#${this.node.id}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),assert&&assert(this.pdomDisplays.length===0,"Should be empty before adding everything"),assert&&assert(this.canHavePDOMDisplays(),"Should happen when we can store pdomDisplays");let e;const t=[];for(e=0;e<this.node._parents.length;e++)Array.prototype.push.apply(t,this.node._parents[e]._pdomDisplaysInfo.pdomDisplays);for(e=0;e<this.node._rootedDisplays.length;e++){const n=this.node._rootedDisplays[e];n._accessible&&t.push(n)}this.addPDOMDisplays(t),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}removeAllPDOMDisplays(){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`removeAllPDOMDisplays n#${this.node.id}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),assert&&assert(!this.canHavePDOMDisplays(),"Should happen when we cannot store pdomDisplays"),this.removePDOMDisplays(this.pdomDisplays.slice()),assert&&assert(this.pdomDisplays.length===0,"Should be empty after removing everything"),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}addPDOMDisplays(e){if(sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`addPDOMDisplays n#${this.node.id} numDisplays:${e.length}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),assert&&assert(Array.isArray(e)),e.length!==0){Array.prototype.push.apply(this.pdomDisplays,e);for(let t=0;t<this.node._children.length;t++)this.node._children[t]._pdomDisplaysInfo.canHavePDOMDisplays()&&this.node._children[t]._pdomDisplaysInfo.addPDOMDisplays(e);this.node.pdomDisplaysEmitter.emit()}sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}removePDOMDisplays(e){if(sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`removePDOMDisplays n#${this.node.id} numDisplays:${e.length}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),assert&&assert(Array.isArray(e)),assert&&assert(this.pdomDisplays.length>=e.length,"there should be at least as many PDOMDisplays as Displays"),e.length!==0){let t;for(t=e.length-1;t>=0;t--){const n=this.pdomDisplays.lastIndexOf(e[t]);assert&&assert(n>=0),this.pdomDisplays.splice(t,1)}for(t=0;t<this.node._children.length;t++){const n=this.node._children[t];n._pdomDisplaysInfo.canHavePDOMDisplays()&&!n._isGettingRemovedFromParent&&n._pdomDisplaysInfo.removePDOMDisplays(e)}this.node.pdomDisplaysEmitter.emit()}sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}}scenery.register("PDOMDisplaysInfo",PDOMDisplaysInfo);const CHANGE_POSITION_THRESHOLD$2=1e-9,WIDTH_SIZABLE_OPTION_KEYS=["preferredWidth","minimumWidth","localPreferredWidth","localMinimumWidth","widthSizable"],WidthSizable=memoize(o=>{const e=DelayedMutate$1("WidthSizable",WIDTH_SIZABLE_OPTION_KEYS,class extends o{constructor(...n){super(...n),this.preferredWidthProperty=new TinyProperty(null),this.minimumWidthProperty=new TinyProperty(null),this.localPreferredWidthProperty=new TinyProperty(null),this.localMinimumWidthProperty=new TinyProperty(null),this.isWidthResizableProperty=new TinyProperty(!0),this._preferredSizeChanging=!1,this._minimumSizeChanging=!1,this._preferredSizeChangeAttemptDuringLock=!1,this._minimumSizeChangeAttemptDuringLock=!1,this._updatePreferredWidthListener=this._updatePreferredWidth.bind(this),this._updateLocalPreferredWidthListener=this._updateLocalPreferredWidth.bind(this),this._updateMinimumWidthListener=this._updateMinimumWidth.bind(this),this._updateLocalMinimumWidthListener=this._updateLocalMinimumWidth.bind(this),this.preferredWidthProperty.lazyLink(this._updateLocalPreferredWidthListener),this.localPreferredWidthProperty.lazyLink(this._updatePreferredWidthListener),this.minimumWidthProperty.lazyLink(this._updateLocalMinimumWidthListener),this.localMinimumWidthProperty.lazyLink(this._updateMinimumWidthListener),this.transformEmitter.addListener(this._updateLocalPreferredWidthListener),this.transformEmitter.addListener(this._updateMinimumWidthListener)}get preferredWidth(){return assert&&assert(this.preferredWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),this.preferredWidthProperty.value}set preferredWidth(n){assert&&assert(this.preferredWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(n===null||typeof n=="number"&&isFinite(n)&&n>=0,"preferredWidth should be null or a non-negative finite number"),this.preferredWidthProperty.value=n}get localPreferredWidth(){return assert&&assert(this.localPreferredWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),this.localPreferredWidthProperty.value}set localPreferredWidth(n){assert&&assert(this.localPreferredWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(n===null||typeof n=="number"&&isFinite(n)&&n>=0,"localPreferredWidth should be null or a non-negative finite number"),this.localPreferredWidthProperty.value=n}get minimumWidth(){return assert&&assert(this.minimumWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),this.minimumWidthProperty.value}set minimumWidth(n){assert&&assert(this.minimumWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(n===null||typeof n=="number"&&isFinite(n)),this.minimumWidthProperty.value=n}get localMinimumWidth(){return assert&&assert(this.localMinimumWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),this.localMinimumWidthProperty.value}set localMinimumWidth(n){assert&&assert(this.localMinimumWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(n===null||typeof n=="number"&&isFinite(n)),this.localMinimumWidthProperty.value=n}get widthSizable(){return assert&&assert(this.isWidthResizableProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),this.isWidthResizableProperty.value}set widthSizable(n){assert&&assert(this.isWidthResizableProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),this.isWidthResizableProperty.value=n}get extendsWidthSizable(){return!0}validateLocalPreferredWidth(){if(assert){const n=this.localWidth,r=this.localMinimumWidth===null?n:this.localMinimumWidth,s=this.localPreferredWidth===null?r:this.localPreferredWidth;assert(s===n||Math.abs(s-n)<1e-7)}}_calculateLocalPreferredWidth(){return this.matrix.isAligned()&&this.preferredWidth!==null?Math.abs(this.transform.inverseDeltaX(this.preferredWidth)):null}_onReentrantPreferredWidth(){this._updateLocalPreferredWidthListener()}_updateLocalPreferredWidth(){if(assert&&this.auditMaxDimensions(),this._preferredSizeChanging)this._preferredSizeChangeAttemptDuringLock=!0;else{this._preferredSizeChanging=!0;do{this._preferredSizeChangeAttemptDuringLock=!1;const n=this._calculateLocalPreferredWidth();(this.localPreferredWidthProperty.value===null||n===null||Math.abs(this.localPreferredWidthProperty.value-n)>CHANGE_POSITION_THRESHOLD$2)&&(this.localPreferredWidthProperty.value=n)}while(this._preferredSizeChangeAttemptDuringLock);this._preferredSizeChanging=!1}}_calculatePreferredWidth(){return this.matrix.isAligned()&&this.localPreferredWidth!==null?Math.abs(this.transform.transformDeltaX(this.localPreferredWidth)):null}_updatePreferredWidth(){if(this._preferredSizeChanging)this._preferredSizeChangeAttemptDuringLock=!0;else{this._preferredSizeChanging=!0,this._preferredSizeChangeAttemptDuringLock=!1;const n=this._calculatePreferredWidth();(this.preferredWidthProperty.value===null||n===null||Math.abs(this.preferredWidthProperty.value-n)>CHANGE_POSITION_THRESHOLD$2)&&(this.preferredWidthProperty.value=n),this._preferredSizeChanging=!1,this._preferredSizeChangeAttemptDuringLock&&this._onReentrantPreferredWidth()}}_calculateLocalMinimumWidth(){return this.matrix.isAligned()&&this.minimumWidth!==null?Math.abs(this.transform.inverseDeltaX(this.minimumWidth)):null}_onReentrantLocalMinimumWidth(){this._updateMinimumWidthListener()}_updateLocalMinimumWidth(){if(this._minimumSizeChanging)this._minimumSizeChangeAttemptDuringLock=!0;else{this._minimumSizeChanging=!0;const n=this._calculateLocalMinimumWidth();this._minimumSizeChangeAttemptDuringLock=!1,(this.localMinimumWidthProperty.value===null||n===null||Math.abs(this.localMinimumWidthProperty.value-n)>CHANGE_POSITION_THRESHOLD$2)&&(this.localMinimumWidthProperty.value=n),this._minimumSizeChanging=!1,this._minimumSizeChangeAttemptDuringLock&&this._onReentrantLocalMinimumWidth()}}_calculateMinimumWidth(){return this.matrix.isAligned()&&this.localMinimumWidth!==null?Math.abs(this.transform.transformDeltaX(this.localMinimumWidth)):null}_updateMinimumWidth(){if(this._minimumSizeChanging)this._minimumSizeChangeAttemptDuringLock=!0;else{this._minimumSizeChanging=!0;do{this._minimumSizeChangeAttemptDuringLock=!1;const n=this._calculateMinimumWidth();(this.minimumWidthProperty.value===null||n===null||Math.abs(this.minimumWidthProperty.value-n)>CHANGE_POSITION_THRESHOLD$2)&&(this.minimumWidthProperty.value=n)}while(this._minimumSizeChangeAttemptDuringLock);this._minimumSizeChanging=!1}}mutate(n){return super.mutate(n)}});if(e.prototype._mutatorKeys){const t=e.prototype._mutatorKeys,n=WIDTH_SIZABLE_OPTION_KEYS,r=t.indexOf(REQUIRES_BOUNDS_OPTION_KEYS[0]);e.prototype._mutatorKeys=[...t.slice(0,r),...n,...t.slice(r)]}return e}),isWidthSizable=o=>o.widthSizable,extendsWidthSizable=o=>o.extendsWidthSizable;scenery.register("WidthSizable",WidthSizable);const CHANGE_POSITION_THRESHOLD$1=1e-9,HEIGHT_SIZABLE_OPTION_KEYS=["preferredHeight","minimumHeight","localPreferredHeight","localMinimumHeight","heightSizable"],HeightSizable=memoize(o=>{const e=DelayedMutate$1("HeightSizable",HEIGHT_SIZABLE_OPTION_KEYS,class extends o{constructor(...n){super(...n),this.preferredHeightProperty=new TinyProperty(null),this.minimumHeightProperty=new TinyProperty(null),this.localPreferredHeightProperty=new TinyProperty(null),this.localMinimumHeightProperty=new TinyProperty(null),this.isHeightResizableProperty=new TinyProperty(!0),this._preferredSizeChanging=!1,this._minimumSizeChanging=!1,this._preferredSizeChangeAttemptDuringLock=!1,this._minimumSizeChangeAttemptDuringLock=!1,this._updatePreferredHeightListener=this._updatePreferredHeight.bind(this),this._updateLocalPreferredHeightListener=this._updateLocalPreferredHeight.bind(this),this._updateMinimumHeightListener=this._updateMinimumHeight.bind(this),this._updateLocalMinimumHeightListener=this._updateLocalMinimumHeight.bind(this),this.preferredHeightProperty.lazyLink(this._updateLocalPreferredHeightListener),this.localPreferredHeightProperty.lazyLink(this._updatePreferredHeightListener),this.minimumHeightProperty.lazyLink(this._updateLocalMinimumHeightListener),this.localMinimumHeightProperty.lazyLink(this._updateMinimumHeightListener),this.transformEmitter.addListener(this._updateLocalPreferredHeightListener),this.transformEmitter.addListener(this._updateMinimumHeightListener)}get preferredHeight(){return assert&&assert(this.preferredHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),this.preferredHeightProperty.value}set preferredHeight(n){assert&&assert(this.preferredHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(n===null||typeof n=="number"&&isFinite(n)&&n>=0,"preferredHeight should be null or a non-negative finite number"),this.preferredHeightProperty.value=n}get localPreferredHeight(){return assert&&assert(this.localPreferredHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),this.localPreferredHeightProperty.value}set localPreferredHeight(n){assert&&assert(this.localPreferredHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(n===null||typeof n=="number"&&isFinite(n)&&n>=0,"localPreferredHeight should be null or a non-negative finite number"),this.localPreferredHeightProperty.value=n}get minimumHeight(){return assert&&assert(this.minimumHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),this.minimumHeightProperty.value}set minimumHeight(n){assert&&assert(this.minimumHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(n===null||typeof n=="number"&&isFinite(n)),this.minimumHeightProperty.value=n}get localMinimumHeight(){return assert&&assert(this.localMinimumHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),this.localMinimumHeightProperty.value}set localMinimumHeight(n){assert&&assert(this.localMinimumHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(n===null||typeof n=="number"&&isFinite(n)),this.localMinimumHeightProperty.value=n}get heightSizable(){return assert&&assert(this.isHeightResizableProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),this.isHeightResizableProperty.value}set heightSizable(n){assert&&assert(this.isHeightResizableProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),this.isHeightResizableProperty.value=n}get extendsHeightSizable(){return!0}validateLocalPreferredHeight(){if(assert){const n=this.localHeight,r=this.localMinimumHeight===null?n:this.localMinimumHeight,s=this.localPreferredHeight===null?r:this.localPreferredHeight;assert(s===n||Math.abs(s-n)<1e-7)}}_calculateLocalPreferredHeight(){return this.matrix.isAligned()&&this.preferredHeight!==null?Math.abs(this.transform.inverseDeltaY(this.preferredHeight)):null}_onReentrantPreferredHeight(){this._updateLocalPreferredHeightListener()}_updateLocalPreferredHeight(){if(assert&&this.auditMaxDimensions(),this._preferredSizeChanging)this._preferredSizeChangeAttemptDuringLock=!0;else{this._preferredSizeChanging=!0;do{this._preferredSizeChangeAttemptDuringLock=!1;const n=this._calculateLocalPreferredHeight();(this.localPreferredHeightProperty.value===null||n===null||Math.abs(this.localPreferredHeightProperty.value-n)>CHANGE_POSITION_THRESHOLD$1)&&(this.localPreferredHeightProperty.value=n)}while(this._preferredSizeChangeAttemptDuringLock);this._preferredSizeChanging=!1}}_calculatePreferredHeight(){return this.matrix.isAligned()&&this.localPreferredHeight!==null?Math.abs(this.transform.transformDeltaY(this.localPreferredHeight)):null}_updatePreferredHeight(){if(this._preferredSizeChanging)this._preferredSizeChangeAttemptDuringLock=!0;else{this._preferredSizeChanging=!0,this._preferredSizeChangeAttemptDuringLock=!1;const n=this._calculatePreferredHeight();(this.preferredHeightProperty.value===null||n===null||Math.abs(this.preferredHeightProperty.value-n)>CHANGE_POSITION_THRESHOLD$1)&&(this.preferredHeightProperty.value=n),this._preferredSizeChanging=!1,this._preferredSizeChangeAttemptDuringLock&&this._onReentrantPreferredHeight()}}_calculateLocalMinimumHeight(){return this.matrix.isAligned()&&this.minimumHeight!==null?Math.abs(this.transform.inverseDeltaY(this.minimumHeight)):null}_onReentrantLocalMinimumHeight(){this._updateMinimumHeight()}_updateLocalMinimumHeight(){if(this._minimumSizeChanging)this._minimumSizeChangeAttemptDuringLock=!0;else{this._minimumSizeChanging=!0,this._minimumSizeChangeAttemptDuringLock=!1;const n=this._calculateLocalMinimumHeight();(this.localMinimumHeightProperty.value===null||n===null||Math.abs(this.localMinimumHeightProperty.value-n)>CHANGE_POSITION_THRESHOLD$1)&&(this.localMinimumHeightProperty.value=n),this._minimumSizeChanging=!1,this._minimumSizeChangeAttemptDuringLock&&this._onReentrantLocalMinimumHeight()}}_calculateMinimumHeight(){return this.matrix.isAligned()&&this.localMinimumHeight!==null?Math.abs(this.transform.transformDeltaY(this.localMinimumHeight)):null}_updateMinimumHeight(){if(!this._minimumSizeChanging){this._minimumSizeChanging=!0;do{this._minimumSizeChangeAttemptDuringLock=!1;const n=this._calculateMinimumHeight();(this.minimumHeightProperty.value===null||n===null||Math.abs(this.minimumHeightProperty.value-n)>CHANGE_POSITION_THRESHOLD$1)&&(this.minimumHeightProperty.value=n)}while(this._minimumSizeChangeAttemptDuringLock);this._minimumSizeChanging=!1}}mutate(n){return super.mutate(n)}});if(e.prototype._mutatorKeys){const t=e.prototype._mutatorKeys,n=HEIGHT_SIZABLE_OPTION_KEYS,r=t.indexOf(REQUIRES_BOUNDS_OPTION_KEYS[0]);e.prototype._mutatorKeys=[...t.slice(0,r),...n,...t.slice(r)]}return e}),isHeightSizable=o=>o.heightSizable,extendsHeightSizable=o=>o.extendsHeightSizable;scenery.register("HeightSizable",HeightSizable);const SIZABLE_SELF_OPTION_KEYS=["preferredSize","minimumSize","localPreferredSize","localMinimumSize","sizable"],SIZABLE_OPTION_KEYS=["preferredSize","minimumSize","localPreferredSize","localMinimumSize","sizable",...WIDTH_SIZABLE_OPTION_KEYS,...HEIGHT_SIZABLE_OPTION_KEYS],Sizable=memoize(o=>{const e=WidthSizable(HeightSizable(o)),t=DelayedMutate$1("Sizable",SIZABLE_SELF_OPTION_KEYS,class extends e{constructor(...r){super(...r),this.preferredWidthProperty.lazyLink(this._updateLocalPreferredHeightListener),this.preferredHeightProperty.lazyLink(this._updateLocalPreferredWidthListener),this.localPreferredWidthProperty.lazyLink(this._updatePreferredHeightListener),this.localPreferredHeightProperty.lazyLink(this._updatePreferredWidthListener),this.minimumWidthProperty.lazyLink(this._updateLocalMinimumHeightListener),this.minimumHeightProperty.lazyLink(this._updateLocalMinimumWidthListener),this.localMinimumWidthProperty.lazyLink(this._updateMinimumHeightListener),this.localMinimumHeightProperty.lazyLink(this._updateMinimumWidthListener)}get preferredSize(){return assert&&assert(this.preferredWidth===null==(this.preferredHeight===null),"Cannot get a preferredSize when one of preferredWidth/preferredHeight is null"),this.preferredWidth===null||this.preferredHeight===null?null:new Dimension2(this.preferredWidth,this.preferredHeight)}set preferredSize(r){this.preferredWidth=r===null?null:r.width,this.preferredHeight=r===null?null:r.height}get localPreferredSize(){return assert&&assert(this.localPreferredWidth===null==(this.localPreferredHeight===null),"Cannot get a preferredSize when one of preferredWidth/preferredHeight is null"),this.localPreferredWidth===null||this.localPreferredHeight===null?null:new Dimension2(this.localPreferredWidth,this.localPreferredHeight)}set localPreferredSize(r){this.localPreferredWidth=r===null?null:r.width,this.localPreferredHeight=r===null?null:r.height}get minimumSize(){return assert&&assert(this.minimumWidth===null==(this.minimumHeight===null),"Cannot get a minimumSize when one of minimumWidth/minimumHeight is null"),this.minimumWidth===null||this.minimumHeight===null?null:new Dimension2(this.minimumWidth,this.minimumHeight)}set minimumSize(r){this.minimumWidth=r===null?null:r.width,this.minimumHeight=r===null?null:r.height}get localMinimumSize(){return assert&&assert(this.localMinimumWidth===null==(this.localMinimumHeight===null),"Cannot get a minimumSize when one of minimumWidth/minimumHeight is null"),this.localMinimumWidth===null||this.localMinimumHeight===null?null:new Dimension2(this.localMinimumWidth,this.localMinimumHeight)}set localMinimumSize(r){this.localMinimumWidth=r===null?null:r.width,this.localMinimumHeight=r===null?null:r.height}get sizable(){return assert&&assert(this.widthSizable===this.heightSizable,"widthSizable and heightSizable not the same, which is required for the sizable getter"),this.widthSizable}set sizable(r){this.widthSizable=r,this.heightSizable=r}get extendsSizable(){return!0}validateLocalPreferredSize(){assert&&(this.validateLocalPreferredWidth(),this.validateLocalPreferredHeight())}mutate(r){return assertMutuallyExclusiveOptions(r,["preferredSize"],["preferredWidth","preferredHeight"]),assertMutuallyExclusiveOptions(r,["localPreferredSize"],["localPreferredWidth","localPreferredHeight"]),assertMutuallyExclusiveOptions(r,["minimumSize"],["minimumWidth","minimumHeight"]),assertMutuallyExclusiveOptions(r,["localMinimumSize"],["localMinimumWidth","localMinimumHeight"]),assertMutuallyExclusiveOptions(r,["sizable"],["widthSizable","heightSizable"]),super.mutate(r)}_calculateLocalPreferredWidth(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.preferredWidth!==null)return Math.abs(this.transform.inverseDeltaX(this.preferredWidth))}else if(this.preferredHeight!==null)return Math.abs(this.transform.getInverse().m01()*this.preferredHeight)}return null}_calculateLocalPreferredHeight(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.preferredHeight!==null)return Math.abs(this.transform.inverseDeltaY(this.preferredHeight))}else if(this.preferredWidth!==null)return Math.abs(this.transform.getInverse().m10()*this.preferredWidth)}return null}_calculatePreferredWidth(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.localPreferredWidth!==null)return Math.abs(this.transform.transformDeltaX(this.localPreferredWidth))}else if(this.localPreferredHeight!==null)return Math.abs(this.transform.matrix.m01()*this.localPreferredHeight)}return null}_calculatePreferredHeight(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.localPreferredHeight!==null)return Math.abs(this.transform.transformDeltaY(this.localPreferredHeight))}else if(this.localPreferredWidth!==null)return Math.abs(this.transform.matrix.m10()*this.localPreferredWidth)}return null}_onReentrantLocalMinimumWidth(){this._updateMinimumWidthListener(),this._updateMinimumHeightListener()}_onReentrantLocalMinimumHeight(){this._updateMinimumWidthListener(),this._updateMinimumHeightListener()}_onReentrantPreferredWidth(){this._updateLocalPreferredWidthListener(),this._updateLocalPreferredHeightListener()}_onReentrantPreferredHeight(){this._updateLocalPreferredWidthListener(),this._updateLocalPreferredHeightListener()}_calculateLocalMinimumWidth(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.minimumWidth!==null)return Math.abs(this.transform.inverseDeltaX(this.minimumWidth))}else if(this.minimumHeight!==null)return Math.abs(this.transform.getInverse().m01()*this.minimumHeight)}return null}_calculateLocalMinimumHeight(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.minimumHeight!==null)return Math.abs(this.transform.inverseDeltaY(this.minimumHeight))}else if(this.minimumWidth!==null)return Math.abs(this.transform.getInverse().m10()*this.minimumWidth)}return null}_calculateMinimumWidth(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.localMinimumWidth!==null)return Math.abs(this.transform.transformDeltaX(this.localMinimumWidth))}else if(this.localMinimumHeight!==null)return Math.abs(this.transform.matrix.m01()*this.localMinimumHeight)}return null}_calculateMinimumHeight(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.localMinimumHeight!==null)return Math.abs(this.transform.transformDeltaY(this.localMinimumHeight))}else if(this.localMinimumWidth!==null)return Math.abs(this.transform.matrix.m10()*this.localMinimumWidth)}return null}});if(t.prototype._mutatorKeys){const n=t.prototype._mutatorKeys,r=SIZABLE_SELF_OPTION_KEYS,s=n.indexOf(REQUIRES_BOUNDS_OPTION_KEYS[0]);t.prototype._mutatorKeys=[...n.slice(0,s),...r,...n.slice(s)]}return t});scenery.register("Sizable",Sizable);const ID_SEPARATOR=PDOMUtils$1.PDOM_UNIQUE_ID_SEPARATOR;class Trail{constructor(e){if(assert&&(this.immutable=void 0),e instanceof Trail){const t=e;this.nodes=t.nodes.slice(0),this.length=t.length,this.uniqueId=t.uniqueId,this.indices=t.indices.slice(0);return}if(this.nodes=[],this.length=0,this.uniqueId="",this.indices=[],e)if(e instanceof Node$2){const t=e;this.addDescendant(t)}else{const t=e.length;for(let n=0;n<t;n++)this.addDescendant(e[n])}}copy(){return new Trail(this)}isPainted(){return this.lastNode().isPainted()}isValid(){this.reindex();const e=this.indices.length;for(let t=0;t<e;t++)if(this.indices[t]<0)return!1;return!0}isVisible(){let e=this.nodes.length;for(;e--;)if(!this.nodes[e].isVisible())return!1;return!0}isPDOMVisible(){let e=this.nodes.length;for(;e--;)if(!this.nodes[e].isVisible()||!this.nodes[e].isPDOMVisible())return!1;return!0}getOpacity(){let e=1,t=this.nodes.length;for(;t--;)e*=this.nodes[t].getOpacity();return e}isPickable(){return _.some(this.nodes,e=>e.pickable===!1||!e.visible)?!1:!!_.some(this.nodes,e=>e._inputListeners.length>0||e.pickableProperty.value===!0)}get(e){return e>=0?this.nodes[e]:this.nodes[this.nodes.length+e]}slice(e,t){return new Trail(this.nodes.slice(e,t))}subtrailTo(e,t=!1){return this.slice(0,_.indexOf(this.nodes,e)+(t?0:1))}isEmpty(){return this.nodes.length===0}getMatrixConcatenation(e,t){const n=Matrix3.identity(),r=this.nodes;for(let s=e;s<t;s++)n.multiplyMatrix(r[s].getMatrix());return n}getMatrix(){return this.getMatrixConcatenation(0,this.nodes.length)}getAncestorMatrix(){return this.getMatrixConcatenation(1,this.nodes.length)}getParentMatrix(){return this.getMatrixConcatenation(0,this.nodes.length-1)}getAncestorParentMatrix(){return this.getMatrixConcatenation(1,this.nodes.length-1)}getTransform(){return new Transform3(this.getMatrix())}getParentTransform(){return new Transform3(this.getParentMatrix())}addAncestor(e,t){if(assert&&assert(!this.immutable,"cannot modify an immutable Trail with addAncestor"),assert&&assert(e,"cannot add falsy value to a Trail"),this.nodes.length){const n=this.nodes[0];this.indices.unshift(t===void 0?_.indexOf(e._children,n):t)}return this.nodes.unshift(e),this.length++,this.uniqueId=this.uniqueId?e.id+ID_SEPARATOR+this.uniqueId:`${e.id}`,this}removeAncestor(){return assert&&assert(!this.immutable,"cannot modify an immutable Trail with removeAncestor"),assert&&assert(this.length>0,"cannot remove a Node from an empty trail"),this.nodes.shift(),this.indices.length&&this.indices.shift(),this.length--,this.updateUniqueId(),this}addDescendant(e,t){if(assert&&assert(!this.immutable,"cannot modify an immutable Trail with addDescendant"),assert&&assert(e,"cannot add falsy value to a Trail"),this.nodes.length){const n=this.lastNode();this.indices.push(t===void 0?_.indexOf(n._children,e):t)}return this.nodes.push(e),this.length++,this.uniqueId=this.uniqueId?this.uniqueId+ID_SEPARATOR+e.id:`${e.id}`,this}removeDescendant(){return assert&&assert(!this.immutable,"cannot modify an immutable Trail with removeDescendant"),assert&&assert(this.length>0,"cannot remove a Node from an empty trail"),this.nodes.pop(),this.indices.length&&this.indices.pop(),this.length--,this.updateUniqueId(),this}addDescendantTrail(e){const t=e.length;t&&this.addDescendant(e.nodes[0]);for(let n=1;n<t;n++)this.addDescendant(e.nodes[n],this.indices[n-1])}removeDescendantTrail(e){const t=e.length;for(let n=t-1;n>=0;n--)assert&&assert(this.lastNode()===e.nodes[n]),this.removeDescendant()}reindex(){const e=this.length;for(let t=1;t<e;t++){const n=this.indices[t-1],r=this.nodes[t-1];r._children[n]!==this.nodes[t]&&(this.indices[t-1]=_.indexOf(r._children,this.nodes[t]))}}setImmutable(){return assert&&(assert(this.immutable!==!1,"A trail cannot be made immutable after being flagged as mutable"),this.immutable=!0),this}setMutable(){return assert&&(assert(this.immutable!==!0,"A trail cannot be made mutable after being flagged as immutable"),this.immutable=!1),this}areIndicesValid(){for(let e=1;e<this.length;e++){const t=this.indices[e-1];if(this.nodes[e-1]._children[t]!==this.nodes[e])return!1}return!0}equals(e){if(this.length!==e.length)return!1;for(let t=0;t<this.nodes.length;t++)if(this.nodes[t]!==e.nodes[t])return!1;return!0}upToNode(e){const t=_.indexOf(this.nodes,e);return assert&&assert(t>=0,"Trail does not contain the node"),this.slice(0,_.indexOf(this.nodes,e)+1)}isExtensionOf(e,t){if(this.length<=e.length-(t?1:0))return!1;for(let n=0;n<e.nodes.length;n++)if(this.nodes[n]!==e.nodes[n])return!1;return!0}containsNode(e){return _.includes(this.nodes,e)}getTransformTo(e){return new Transform3(this.getMatrixTo(e))}getMatrixTo(e){this.reindex(),e.reindex();const t=this.getBranchIndexTo(e);let n,r=Matrix3.IDENTITY;for(n=this.length-1;n>=t;n--)r=this.nodes[n].getMatrix().timesMatrix(r);for(n=t;n<e.length;n++)r=e.nodes[n].getTransform().getInverse().timesMatrix(r);return r}getBranchIndexTo(e){assert&&assert(this.nodes[0]===e.nodes[0],"To get a branch index, the trails must have the same root");let t;const n=Math.min(this.length,e.length);for(t=0;t<n&&this.nodes[t]===e.nodes[t];t++);return t}getLastInputEnabledIndex(){let e=-1;for(let t=0;t<this.length&&this.nodes[t].inputEnabled;t++)e=t;return e}getCursorCheckIndex(){return this.getLastInputEnabledIndex()}nodeFromTop(e){return this.nodes[this.length-1-e]}lastNode(){return this.nodeFromTop(0)}rootNode(){return this.nodes[0]}previous(){if(this.nodes.length<=1)return null;const e=this.nodeFromTop(0),t=this.nodeFromTop(1),n=_.indexOf(t._children,e);assert&&assert(n!==-1);const r=this.nodes.slice(0,this.nodes.length-1);if(n===0)return new Trail(r);for(r.push(t._children[n-1]);r[r.length-1]._children.length!==0;){const s=r[r.length-1];r.push(s._children[s._children.length-1])}return new Trail(r)}previousPainted(){let e=this.previous();for(;e&&!e.isPainted();)e=e.previous();return e}next(){const e=this.nodes.slice(0),t=this.nodeFromTop(0);if(t._children.length>0)return e.push(t._children[0]),new Trail(e);{let n=this.nodes.length-1;for(;n>0;){const r=this.nodes[n],s=this.nodes[n-1];e.pop();const a=_.indexOf(s._children,r);if(a!==s._children.length-1)return e.push(s._children[a+1]),new Trail(e);n--}return null}}nextPainted(){let e=this.next();for(;e&&!e.isPainted();)e=e.next();return e}eachTrailUnder(e){new TrailPointer(this,!0).eachTrailBetween(new TrailPointer(this,!1),e)}compare(e){assert&&assert(!this.isEmpty(),"cannot compare with an empty trail"),assert&&assert(!e.isEmpty(),"cannot compare with an empty trail"),assert&&assert(this.nodes[0]===e.nodes[0],"for Trail comparison, trails must have the same root node"),assertSlow&&assertSlow(this.areIndicesValid(),`Trail.compare this.areIndicesValid() failed on ${this.toString()}`),assertSlow&&assertSlow(e.areIndicesValid(),`Trail.compare other.areIndicesValid() failed on ${e.toString()}`);const t=Math.min(this.nodes.length,e.nodes.length);for(let n=0;n<t;n++)if(this.nodes[n]!==e.nodes[n])return this.nodes[n-1].children.indexOf(this.nodes[n])<e.nodes[n-1].children.indexOf(e.nodes[n])?-1:1;return this.nodes.length<e.nodes.length?-1:this.nodes.length>e.nodes.length?1:0}isBefore(e){return this.compare(e)===-1}isAfter(e){return this.compare(e)===1}localToGlobalPoint(e){return this.getMatrix().timesVector2(e)}localToGlobalBounds(e){return e.transformed(this.getMatrix())}globalToLocalPoint(e){return this.getTransform().inversePosition2(e)}globalToLocalBounds(e){return this.getTransform().inverseBounds2(e)}parentToGlobalPoint(e){return this.getParentMatrix().timesVector2(e)}parentToGlobalBounds(e){return e.transformed(this.getParentMatrix())}globalToParentPoint(e){return this.getParentTransform().inversePosition2(e)}globalToParentBounds(e){return this.getParentTransform().inverseBounds2(e)}updateUniqueId(){let e="";const t=this.nodes.length;t>0&&(e+=this.nodes[0]._id);for(let n=1;n<t;n++)e+=ID_SEPARATOR+this.nodes[n]._id;this.uniqueId=e}getUniqueId(){if(assert){const e=this.uniqueId;this.updateUniqueId(),assert(e===this.uniqueId)}return this.uniqueId}toString(){return this.reindex(),this.length?`[Trail ${this.indices.join(".")} ${this.getUniqueId()}]`:"Empty Trail"}toPathString(){return _.map(this.nodes,e=>{let t=e.constructor.name;return t==="Node"&&(t="."),t}).join("/")}toDebugString(){return`${this.toString()} ${this.toPathString()}`}static eachPaintedTrailBetween(e,t,n,r,s){Trail.eachTrailBetween(e,t,a=>a.isPainted()?n(a):!1,r,s)}static eachTrailBetween(e,t,n,r,s){const a=e?new TrailPointer(e.copy(),!0):new TrailPointer(new Trail(s),!0),h=t?new TrailPointer(t.copy(),!0):new TrailPointer(new Trail(s),!1);r&&(a.nestedForwards(),h.nestedBackwards(),a.compareNested(h)===1)||a.depthFirstUntil(h,c=>c.isBefore?n(c.trail):!1,!1)}static branchIndex(e,t){assert&&assert(e.nodes[0]===t.nodes[0],"Branch changes require roots to be the same");let n;const r=Math.min(e.length,t.length);for(n=0;n<r&&e.nodes[n]===t.nodes[n];n++);return n}static sharedTrail(e,t){return e.slice(0,Trail.branchIndex(e,t))}static appendAncestorTrailsWithPredicate(e,t,n){const r=t.rootNode();n(r)&&e.push(t.copy());const s=r._parents.length;for(let a=0;a<s;a++){const h=r._parents[a];t.addAncestor(h),Trail.appendAncestorTrailsWithPredicate(e,t,n),t.removeAncestor()}}static appendDescendantTrailsWithPredicate(e,t,n){const r=t.lastNode();n(r)&&e.push(t.copy());const s=r._children.length;for(let a=0;a<s;a++){const h=r._children[a];t.addDescendant(h,a),Trail.appendDescendantTrailsWithPredicate(e,t,n),t.removeDescendant()}}static spannedSubtrees(e,t){}static fromUniqueId(e,t){const r=t.split(ID_SEPARATOR).map(c=>Number(c));let s=e;const a=r.shift(),h=[s];for(assert&&assert(a===e.id);r.length>0;){const c=r.shift(),y=(s.pdomOrder||[]).concat(s.children);for(let g=0;g<y.length;g++){if(y[g]!==null&&y[g].id===c){const D=y[g];h.push(D),s=D;break}assert&&assert(g!==y.length-1,"unable to find node from unique Trail id")}}return new Trail(h)}}scenery.register("Trail",Trail);class TrailPointer{constructor(e,t){this.trail=e,this.setBefore(t)}isActive(){return!!this.trail}copy(){return assert&&assert(this.isActive()),new TrailPointer(this.trail.copy(),this.isBefore)}setBefore(e){this.isBefore=e,this.isAfter=!e}getRenderSwappedPointer(){assert&&assert(this.isActive());const e=this,t=this.isBefore?e.trail.previous():e.trail.next();return t===null?null:new TrailPointer(t,!this.isBefore)}getRenderBeforePointer(){return this.isBefore?this:this.getRenderSwappedPointer()}getRenderAfterPointer(){return this.isAfter?this:this.getRenderSwappedPointer()}compareRender(e){assert&&assert(e!==null);const t=this.getRenderBeforePointer(),n=e.getRenderBeforePointer();return t!==null&&n!==null?(assert&&assert(t.isActive()&&n.isActive()),t.trail.compare(n.trail)):t===n?0:t===null?1:-1}compareNested(e){assert&&assert(e),assert&&assert(this.isActive()&&e.isActive());const t=this,n=e,r=t.trail.compare(n.trail);return r===0?this.isBefore===e.isBefore?0:this.isBefore?-1:1:t.trail.isExtensionOf(n.trail)?e.isBefore?1:-1:n.trail.isExtensionOf(t.trail)?this.isBefore?-1:1:r}equalsRender(e){return this.compareRender(e)===0}equalsNested(e){return this.compareNested(e)===0}hasTrail(){return!!this.trail}nestedForwards(){assert&&assert(this.isActive());const e=this;if(this.isBefore){const t=e.trail.lastNode()._children;t.length>0?e.trail.addDescendant(t[0],0):this.setBefore(!1)}else{if(e.trail.indices.length===0)return this.trail=null,null;{const t=e.trail.indices[e.trail.indices.length-1];e.trail.removeDescendant();const n=e.trail.lastNode()._children;n.length>t+1&&(e.trail.addDescendant(n[t+1],t+1),this.setBefore(!0))}}return this}nestedBackwards(){assert&&assert(this.isActive());const e=this;if(this.isBefore){if(e.trail.indices.length===0)return this.trail=null,null;{const t=e.trail.indices[e.trail.indices.length-1];e.trail.removeDescendant(),t-1>=0&&(e.trail.addDescendant(e.trail.lastNode()._children[t-1],t-1),this.setBefore(!1))}}else if(e.trail.lastNode()._children.length>0){const t=e.trail.lastNode()._children;e.trail.addDescendant(t[t.length-1],t.length-1)}else this.setBefore(!0);return this}eachNodeBetween(e,t){this.eachTrailBetween(e,n=>t(n.lastNode()))}eachTrailBetween(e,t){this.isBefore&&(assert&&assert(this.isActive()),t(this.trail)),this.depthFirstUntil(e,n=>n.isBefore?t(n.trail):!1,!0)}depthFirstUntil(e,t,n){assert&&assert(this.isActive()&&e.isActive());const r=this,s=e;assert&&assert(this.compareNested(e)<=(n?-1:0),"TrailPointer.depthFirstUntil pointers out of order, possibly in both meanings of the phrase!"),assert&&assert(r.trail.rootNode()===s.trail.rootNode(),"TrailPointer.depthFirstUntil takes pointers with the same root"),r.trail.reindex(),s.trail.reindex();const a=this.copy();a.trail.setMutable();let h=!0;for(;!a.equalsNested(e);){assert&&assert(a.compareNested(e)!==1,"skipped in depthFirstUntil");let c=!1;if(h?(n||(c=t(a)),h=!1):c=t(a),c&&a.isBefore){if(a.setBefore(!1),a.compareNested(e)===1)break}else a.nestedForwards()}n||t(a)}toString(){return assert&&assert(this.isActive()),`[${this.isBefore?"before":"after"} ${this.trail.toString().slice(1)}`}static compareNested(e,t,n,r){const s=e.compare(n);return s===0?t===r?0:t?-1:1:e.isExtensionOf(n)?r?1:-1:n.isExtensionOf(e)?t?-1:1:s}}scenery.register("TrailPointer",TrailPointer);const valueComparisonStrategy=(o,e)=>o.size===e.size&&_.every([...o],t=>e.has(t));class AncestorNodesProperty extends TinyProperty{constructor(e){super(new Set),this.node=e,this.listenedNodeSet=new Set,this.updateEmitter=new TinyEmitter,this.valueComparisonStrategy=valueComparisonStrategy,this._nodeUpdateListener=this.update.bind(this),this.addNodeListener(e),this.update()}update(){const e=new Set;(function t(n){n.parents.forEach(s=>{e.add(s),t(s)})})(this.node),e.forEach(t=>{this.listenedNodeSet.has(t)||this.addNodeListener(t)}),this.listenedNodeSet.forEach(t=>{!e.has(t)&&t!==this.node&&this.removeNodeListener(t)}),this.value=e,this.updateEmitter.emit()}addNodeListener(e){this.listenedNodeSet.add(e),e.parentAddedEmitter.addListener(this._nodeUpdateListener),e.parentRemovedEmitter.addListener(this._nodeUpdateListener)}removeNodeListener(e){this.listenedNodeSet.delete(e),e.parentAddedEmitter.removeListener(this._nodeUpdateListener),e.parentRemovedEmitter.removeListener(this._nodeUpdateListener)}dispose(){this.listenedNodeSet.forEach(e=>this.removeNodeListener(e)),super.dispose()}}scenery.register("AncestorNodesProperty",AncestorNodesProperty);class TrailsBetweenProperty extends TinyProperty{constructor(e,t){super([]),this.listenedNodeSet=new Set,this.rootNode=e,this.leafNode=t,this._trailUpdateListener=this.update.bind(this),this.update()}update(){const e=[],t=new Set,n=new Trail(this.leafNode),r=this.rootNode;(function h(){const c=n.rootNode();t.add(c),c===r&&e.push(n.copy()),c.parents.forEach(d=>{n.addAncestor(d),h(),n.removeAncestor()})})(),t.forEach(h=>{this.listenedNodeSet.has(h)||this.addNodeListener(h)}),this.listenedNodeSet.forEach(h=>{t.has(h)||this.removeNodeListener(h)});const s=this.value;let a=s.length===e.length;if(a){for(let h=0;h<e.length;h++)if(!s[h].equals(e[h])){a=!1;break}}a||(this.value=e)}addNodeListener(e){this.listenedNodeSet.add(e),e.parentAddedEmitter.addListener(this._trailUpdateListener),e.parentRemovedEmitter.addListener(this._trailUpdateListener)}removeNodeListener(e){this.listenedNodeSet.delete(e),e.parentAddedEmitter.removeListener(this._trailUpdateListener),e.parentRemovedEmitter.removeListener(this._trailUpdateListener)}dispose(){this.listenedNodeSet.forEach(e=>this.removeNodeListener(e)),super.dispose()}}scenery.register("TrailsBetweenProperty",TrailsBetweenProperty);class MatrixBetweenProperty extends TinyProperty{constructor(e,t,n){const r=optionize()({fromCoordinateFrame:"local",toCoordinateFrame:"local"},n);super(Matrix3.IDENTITY),this.from=e,this.to=t,this.rootNode=null,this.fromTrail=null,this.toTrail=null,this.listenedNodeSet=new Set,this.fromCoordinateFrame=r.fromCoordinateFrame,this.toCoordinateFrame=r.toCoordinateFrame,this.valueComparisonStrategy="equalsFunction",this.fromAncestorsProperty=new AncestorNodesProperty(e),this.toAncestorsProperty=new AncestorNodesProperty(t);const s=this.update.bind(this);this._nodeTransformListener=this.updateMatrix.bind(this),this.fromAncestorsProperty.updateEmitter.addListener(s),this.toAncestorsProperty.updateEmitter.addListener(s),this.update()}update(){const e=[...this.fromAncestorsProperty.value,this.from],t=[...this.toAncestorsProperty.value,this.to],n=e.filter(h=>t.includes(h));let r=!1;const s=n.filter(h=>{const c=e.filter(N=>h.hasChild(N)),d=t.filter(N=>h.hasChild(N)),y=[],g=[];arrayDifference(c,d,y,g,[]);const O=c.length>1||d.length>1,V=y.length||g.length;O&&V&&(r=!0);const k=y.length>0||this.from===h,M=g.length>0||this.to===h;return k&&M});!r&&s.length===1?(this.rootNode=s[0],this.fromTrail=this.from.getUniqueTrailTo(this.rootNode),this.toTrail=this.to.getUniqueTrailTo(this.rootNode)):(this.rootNode=null,this.fromTrail=null,this.toTrail=null);const a=new Set;this.fromTrail&&this.fromTrail.nodes.forEach(h=>a.add(h)),this.toTrail&&this.toTrail.nodes.forEach(h=>a.add(h)),a.forEach(h=>{this.listenedNodeSet.has(h)||this.addNodeListener(h)}),this.listenedNodeSet.forEach(h=>{!a.has(h)&&h!==this.from&&h!==this.to&&this.removeNodeListener(h)}),this.updateMatrix()}updateMatrix(){if(this.rootNode&&this.fromTrail&&this.toTrail){const e=this.fromTrail.nodes.length===1,t=this.toTrail.nodes.length===1,n=e&&this.fromCoordinateFrame==="parent"||t&&this.toCoordinateFrame==="parent",r=this.fromTrail.getMatrixConcatenation(n?0:1,this.fromTrail.nodes.length-(this.fromCoordinateFrame==="parent"?1:0)),s=this.toTrail.getMatrixConcatenation(n?0:1,this.toTrail.nodes.length-(this.toCoordinateFrame==="parent"?1:0));this.value=s.inverted().timesMatrix(r)}else this.value=null}addNodeListener(e){this.listenedNodeSet.add(e),e.transformEmitter.addListener(this._nodeTransformListener)}removeNodeListener(e){this.listenedNodeSet.delete(e),e.transformEmitter.removeListener(this._nodeTransformListener)}dispose(){this.fromAncestorsProperty.dispose(),this.toAncestorsProperty.dispose(),super.dispose()}}scenery.register("MatrixBetweenProperty",MatrixBetweenProperty);const isSafari5=platform.safari5,PAINTABLE_OPTION_KEYS=["fill","fillPickable","stroke","strokePickable","lineWidth","lineCap","lineJoin","miterLimit","lineDash","lineDashOffset","cachedPaints"],DEFAULT_OPTIONS$6={fill:null,fillPickable:!0,stroke:null,strokePickable:!1,lineWidth:DEFAULT_OPTIONS$8.lineWidth,lineCap:DEFAULT_OPTIONS$8.lineCap,lineJoin:DEFAULT_OPTIONS$8.lineJoin,lineDashOffset:DEFAULT_OPTIONS$8.lineDashOffset,miterLimit:DEFAULT_OPTIONS$8.miterLimit},PAINTABLE_DRAWABLE_MARK_FLAGS=["fill","stroke","lineWidth","lineOptions","cachedPaints"],Paintable=memoize(o=>(assert&&assert(_.includes(inheritance(o),Node$2),"Only Node subtypes should mix Paintable"),class extends o{constructor(...t){super(...t),assertHasProperties(this,["_drawables"]),this._fill=DEFAULT_OPTIONS$6.fill,this._fillPickable=DEFAULT_OPTIONS$6.fillPickable,this._stroke=DEFAULT_OPTIONS$6.stroke,this._strokePickable=DEFAULT_OPTIONS$6.strokePickable,this._cachedPaints=[],this._lineDrawingStyles=new LineStyles}setFill(t){return assert&&assert(PaintDef.isPaintDef(t),"Invalid fill type"),assert&&typeof t=="string"&&Color.checkPaintString(t),this._fill!==t&&(this._fill=t,this.invalidateFill()),this}set fill(t){this.setFill(t)}get fill(){return this.getFill()}getFill(){return this._fill}hasFill(){return this.getFillValue()!==null}getFillValue(){const t=this.getFill();return isTReadOnlyProperty(t)?t.get():t}get fillValue(){return this.getFillValue()}setStroke(t){if(assert&&assert(PaintDef.isPaintDef(t),"Invalid stroke type"),assert&&typeof t=="string"&&Color.checkPaintString(t),this._stroke!==t){if(this._stroke=t,assert&&t instanceof Paint&&t.transformMatrix){const n=t.transformMatrix.getScaleVector();assert(Math.abs(n.x-n.y)<1e-7,"You cannot specify a pattern or gradient to a stroke that does not have a symmetric scale.")}this.invalidateStroke()}return this}set stroke(t){this.setStroke(t)}get stroke(){return this.getStroke()}getStroke(){return this._stroke}hasStroke(){return this.getStrokeValue()!==null}hasPaintableStroke(){return this.hasStroke()&&this.getLineWidth()>0}getStrokeValue(){const t=this.getStroke();return isTReadOnlyProperty(t)?t.get():t}get strokeValue(){return this.getStrokeValue()}setFillPickable(t){return this._fillPickable!==t&&(this._fillPickable=t,this.invalidateFill()),this}set fillPickable(t){this.setFillPickable(t)}get fillPickable(){return this.isFillPickable()}isFillPickable(){return this._fillPickable}setStrokePickable(t){return this._strokePickable!==t&&(this._strokePickable=t,this.invalidateStroke()),this}set strokePickable(t){this.setStrokePickable(t)}get strokePickable(){return this.isStrokePickable()}isStrokePickable(){return this._strokePickable}setLineWidth(t){if(assert&&assert(t>=0,`lineWidth should be non-negative instead of ${t}`),this.getLineWidth()!==t){this._lineDrawingStyles.lineWidth=t,this.invalidateStroke();const n=this._drawables.length;for(let r=0;r<n;r++)this._drawables[r].markDirtyLineWidth()}return this}set lineWidth(t){this.setLineWidth(t)}get lineWidth(){return this.getLineWidth()}getLineWidth(){return this._lineDrawingStyles.lineWidth}setLineCap(t){if(assert&&assert(t==="butt"||t==="round"||t==="square",`lineCap should be one of "butt", "round" or "square", not ${t}`),this._lineDrawingStyles.lineCap!==t){this._lineDrawingStyles.lineCap=t,this.invalidateStroke();const n=this._drawables.length;for(let r=0;r<n;r++)this._drawables[r].markDirtyLineOptions()}return this}set lineCap(t){this.setLineCap(t)}get lineCap(){return this.getLineCap()}getLineCap(){return this._lineDrawingStyles.lineCap}setLineJoin(t){if(assert&&assert(t==="miter"||t==="round"||t==="bevel",`lineJoin should be one of "miter", "round" or "bevel", not ${t}`),this._lineDrawingStyles.lineJoin!==t){this._lineDrawingStyles.lineJoin=t,this.invalidateStroke();const n=this._drawables.length;for(let r=0;r<n;r++)this._drawables[r].markDirtyLineOptions()}return this}set lineJoin(t){this.setLineJoin(t)}get lineJoin(){return this.getLineJoin()}getLineJoin(){return this._lineDrawingStyles.lineJoin}setMiterLimit(t){if(assert&&assert(isFinite(t),"miterLimit should be a finite number"),this._lineDrawingStyles.miterLimit!==t){this._lineDrawingStyles.miterLimit=t,this.invalidateStroke();const n=this._drawables.length;for(let r=0;r<n;r++)this._drawables[r].markDirtyLineOptions()}return this}set miterLimit(t){this.setMiterLimit(t)}get miterLimit(){return this.getMiterLimit()}getMiterLimit(){return this._lineDrawingStyles.miterLimit}setLineDash(t){if(assert&&assert(Array.isArray(t)&&t.every(n=>typeof n=="number"&&isFinite(n)&&n>=0),"lineDash should be an array of finite non-negative numbers"),this._lineDrawingStyles.lineDash!==t){this._lineDrawingStyles.lineDash=t||[],this.invalidateStroke();const n=this._drawables.length;for(let r=0;r<n;r++)this._drawables[r].markDirtyLineOptions()}return this}set lineDash(t){this.setLineDash(t)}get lineDash(){return this.getLineDash()}getLineDash(){return this._lineDrawingStyles.lineDash}hasLineDash(){return!!this._lineDrawingStyles.lineDash.length}setLineDashOffset(t){if(assert&&assert(isFinite(t),`lineDashOffset should be a number, not ${t}`),this._lineDrawingStyles.lineDashOffset!==t){this._lineDrawingStyles.lineDashOffset=t,this.invalidateStroke();const n=this._drawables.length;for(let r=0;r<n;r++)this._drawables[r].markDirtyLineOptions()}return this}set lineDashOffset(t){this.setLineDashOffset(t)}get lineDashOffset(){return this.getLineDashOffset()}getLineDashOffset(){return this._lineDrawingStyles.lineDashOffset}setLineStyles(t){return this._lineDrawingStyles=t,this.invalidateStroke(),this}set lineStyles(t){this.setLineStyles(t)}get lineStyles(){return this.getLineStyles()}getLineStyles(){return this._lineDrawingStyles}setCachedPaints(t){this._cachedPaints=t.filter(r=>r instanceof Paint);const n=this._drawables.length;for(let r=0;r<n;r++)this._drawables[r].markDirtyCachedPaints();return this}set cachedPaints(t){this.setCachedPaints(t)}get cachedPaints(){return this.getCachedPaints()}getCachedPaints(){return this._cachedPaints}addCachedPaint(t){if(t instanceof Paint){this._cachedPaints.push(t);const n=this._drawables.length;for(let r=0;r<n;r++)this._drawables[r].markDirtyCachedPaints()}}removeCachedPaint(t){if(t instanceof Paint){assert&&assert(_.includes(this._cachedPaints,t)),arrayRemove(this._cachedPaints,t);const n=this._drawables.length;for(let r=0;r<n;r++)this._drawables[r].markDirtyCachedPaints()}}beforeCanvasFill(t){assert&&assert(this.getFillValue()!==null);const n=this.getFillValue();t.setFillStyle(n),n.transformMatrix&&(t.context.save(),n.transformMatrix.canvasAppendTransform(t.context))}afterCanvasFill(t){this.getFillValue().transformMatrix&&t.context.restore()}beforeCanvasStroke(t){const n=this.getStrokeValue();if(t.setStrokeStyle(this._stroke),t.setLineCap(this.getLineCap()),t.setLineJoin(this.getLineJoin()),n.transformMatrix){const r=n.transformMatrix.getScaleVector();assert&&assert(Math.abs(r.x-r.y)<1e-7,"You cannot specify a pattern or gradient to a stroke that does not have a symmetric scale.");const s=1/r.x;t.context.save(),n.transformMatrix.canvasAppendTransform(t.context),t.setLineWidth(this.getLineWidth()*s),t.setMiterLimit(this.getMiterLimit()*s),t.setLineDash(this.getLineDash().map(a=>a*s)),t.setLineDashOffset(this.getLineDashOffset()*s)}else t.setLineWidth(this.getLineWidth()),t.setMiterLimit(this.getMiterLimit()),t.setLineDash(this.getLineDash()),t.setLineDashOffset(this.getLineDashOffset())}afterCanvasStroke(t){this.getStrokeValue().transformMatrix&&t.context.restore()}getCSSFill(){const t=this.getFillValue();return t?t.toCSS?t.toCSS():t:"transparent"}getSimpleCSSStroke(){const t=this.getStrokeValue();return t?t.toCSS?t.toCSS():t:"transparent"}appendFillablePropString(t,n){return this._fill&&(n&&(n+=`,
`),typeof this.getFillValue()=="string"?n+=`${t}fill: '${this.getFillValue()}'`:n+=`${t}fill: ${this.getFillValue()}`),n}appendStrokablePropString(t,n){function r(s,a,h){n&&(n+=`,
`),!h&&typeof a=="string"?n+=`${t+s}: '${a}'`:n+=`${t+s}: ${a}`}if(this._stroke){const s=new LineStyles,a=this.getStrokeValue();typeof a=="string"?r("stroke",a):r("stroke",a?a.toString():"null",!0),_.each(["lineWidth","lineCap","miterLimit","lineJoin","lineDashOffset"],h=>{this[h]!==s[h]&&r(h,this[h])}),this.lineDash.length&&r("lineDash",JSON.stringify(this.lineDash),!0)}return n}getFillRendererBitmask(){let t=0;return isSafari5&&this._fill instanceof Gradient||(t|=Renderer.bitmaskSVG),t|=Renderer.bitmaskCanvas,this.hasFill()&&(this._fill instanceof Pattern||this._fill instanceof Gradient)||(t|=Renderer.bitmaskDOM,t|=Renderer.bitmaskWebGL),t}getStrokeRendererBitmask(){let t=0;return t|=Renderer.bitmaskCanvas,t|=Renderer.bitmaskSVG,this.hasStroke()||(t|=Renderer.bitmaskDOM,t|=Renderer.bitmaskWebGL),t}invalidateFill(){this.invalidateSupportedRenderers();const t=this._drawables.length;for(let n=0;n<t;n++)this._drawables[n].markDirtyFill()}invalidateStroke(){this.invalidateSupportedRenderers();const t=this._drawables.length;for(let n=0;n<t;n++)this._drawables[n].markDirtyStroke()}}));scenery.register("Paintable",Paintable);Paintable.DEFAULT_OPTIONS=DEFAULT_OPTIONS$6;const log2=Math.log2||function(o){return Math.log(o)/Math.LN2},DEFAULT_OPTIONS$5={imageOpacity:1,initialWidth:0,initialHeight:0,mipmap:!1,mipmapBias:0,mipmapInitialLevel:4,mipmapMaxLevel:5,hitTestPixels:!1};let scratchCanvas=null,scratchContext=null;const getScratchCanvas=()=>(scratchCanvas||(scratchCanvas=document.createElement("canvas")),scratchCanvas),getScratchContext=()=>(scratchContext||(scratchContext=getScratchCanvas().getContext("2d",{willReadFrequently:!0})),scratchContext),Imageable=o=>class extends o{constructor(...t){super(...t),this._imageProperty=new TinyForwardingProperty(null,!1,this.onImagePropertyChange.bind(this)),this._image=null,this._initialWidth=DEFAULT_OPTIONS$5.initialWidth,this._initialHeight=DEFAULT_OPTIONS$5.initialHeight,this._imageOpacity=DEFAULT_OPTIONS$5.imageOpacity,this._mipmap=DEFAULT_OPTIONS$5.mipmap,this._mipmapBias=DEFAULT_OPTIONS$5.mipmapBias,this._mipmapInitialLevel=DEFAULT_OPTIONS$5.mipmapInitialLevel,this._mipmapMaxLevel=DEFAULT_OPTIONS$5.mipmapMaxLevel,this._hitTestPixels=DEFAULT_OPTIONS$5.hitTestPixels,this._mipmapCanvases=[],this._mipmapURLs=[],this._mipmapData=null,this._imageLoadListener=this._onImageLoad.bind(this),this._imageLoadListenerAttached=!1,this._hitTestImageData=null,this.mipmapEmitter=new TinyEmitter}setImage(t){return assert&&assert(t,"image should be available"),this._imageProperty.value=t,this}set image(t){this.setImage(t)}get image(){return this.getImage()}getImage(){return assert&&assert(this._image!==null),this._image}onImagePropertyChange(t){assert&&assert(t,"image should be available");let n=this._image!==t;if(n&&typeof t=="string"&&this._image&&this._image instanceof HTMLImageElement&&t===this._image.src&&(n=!1),n&&t===this._mipmapData&&(n=!1),n){if(this._initialWidth=0,this._initialHeight=0,this._image&&this._imageLoadListenerAttached&&this._detachImageLoadListener(),this._mipmapData=null,typeof t=="string"){const r=t;t=document.createElement("img"),t.src=r}else Array.isArray(t)&&(this._mipmapData=t,t=t[0].img,this._mipmapInitialLevel=this._mipmapMaxLevel=this._mipmapData.length,this._mipmap=!0);this._image=t,this._image instanceof HTMLImageElement&&(!this._image.width||!this._image.height)&&this._attachImageLoadListener(),this.invalidateImage()}}setImageProperty(t){return this._imageProperty.setTargetProperty(t)}set imageProperty(t){this.setImageProperty(t)}get imageProperty(){return this.getImageProperty()}getImageProperty(){return this._imageProperty}invalidateImage(){this.invalidateMipmaps(),this._invalidateHitTestData()}setImageWithSize(t,n,r){return this.setImage(t),this.setInitialWidth(n),this.setInitialHeight(r),this}setImageOpacity(t){assert&&assert(isFinite(t)&&t>=0&&t<=1,`imageOpacity out of range: ${t}`),this._imageOpacity!==t&&(this._imageOpacity=t)}set imageOpacity(t){this.setImageOpacity(t)}get imageOpacity(){return this.getImageOpacity()}getImageOpacity(){return this._imageOpacity}setInitialWidth(t){return assert&&assert(t>=0&&t%1===0,"initialWidth should be a non-negative integer"),t!==this._initialWidth&&(this._initialWidth=t,this.invalidateImage()),this}set initialWidth(t){this.setInitialWidth(t)}get initialWidth(){return this.getInitialWidth()}getInitialWidth(){return this._initialWidth}setInitialHeight(t){return assert&&assert(t>=0&&t%1===0,"initialHeight should be a non-negative integer"),t!==this._initialHeight&&(this._initialHeight=t,this.invalidateImage()),this}set initialHeight(t){this.setInitialHeight(t)}get initialHeight(){return this.getInitialHeight()}getInitialHeight(){return this._initialHeight}setMipmap(t){return this._mipmap!==t&&(this._mipmap=t,this.invalidateMipmaps()),this}set mipmap(t){this.setMipmap(t)}get mipmap(){return this.isMipmap()}isMipmap(){return this._mipmap}setMipmapBias(t){return this._mipmapBias!==t&&(this._mipmapBias=t,this.invalidateMipmaps()),this}set mipmapBias(t){this.setMipmapBias(t)}get mipmapBias(){return this.getMipmapBias()}getMipmapBias(){return this._mipmapBias}setMipmapInitialLevel(t){return assert&&assert(t%1===0&&t>=0,"mipmapInitialLevel should be a non-negative integer"),this._mipmapInitialLevel!==t&&(this._mipmapInitialLevel=t,this.invalidateMipmaps()),this}set mipmapInitialLevel(t){this.setMipmapInitialLevel(t)}get mipmapInitialLevel(){return this.getMipmapInitialLevel()}getMipmapInitialLevel(){return this._mipmapInitialLevel}setMipmapMaxLevel(t){return assert&&assert(t%1===0&&t>=0,"mipmapMaxLevel should be a non-negative integer"),this._mipmapMaxLevel!==t&&(this._mipmapMaxLevel=t,this.invalidateMipmaps()),this}set mipmapMaxLevel(t){this.setMipmapMaxLevel(t)}get mipmapMaxLevel(){return this.getMipmapMaxLevel()}getMipmapMaxLevel(){return this._mipmapMaxLevel}setHitTestPixels(t){return this._hitTestPixels!==t&&(this._hitTestPixels=t,this._invalidateHitTestData()),this}set hitTestPixels(t){this.setHitTestPixels(t)}get hitTestPixels(){return this.getHitTestPixels()}getHitTestPixels(){return this._hitTestPixels}_constructNextMipmap(){const t=this._mipmapCanvases.length,n=this._mipmapCanvases[t-1];if(n.width*n.height>2){const r=document.createElement("canvas");if(r.width=Math.ceil(n.width/2),r.height=Math.ceil(n.height/2),r.width>0&&r.height>0){const s=r.getContext("2d");s.scale(.5,.5),s.drawImage(n,0,0),this._mipmapCanvases.push(r),this._mipmapURLs.push(r.toDataURL())}}}invalidateMipmaps(){if(cleanArray(this._mipmapCanvases),cleanArray(this._mipmapURLs),this._image&&this._mipmap)if(this._mipmapData)for(let t=0;t<this._mipmapData.length;t++){const n=this._mipmapData[t].url;this._mipmapURLs.push(n);const r=this._mipmapData[t].updateCanvas;r&&r(),this._mipmapCanvases.push(this._mipmapData[t].canvas)}else{const t=document.createElement("canvas");if(t.width=this.getImageWidth(),t.height=this.getImageHeight(),t.width&&t.height){t.getContext("2d").drawImage(this._image,0,0),this._mipmapCanvases.push(t),this._mipmapURLs.push(t.toDataURL());let r=0;for(;++r<this._mipmapInitialLevel;)this._constructNextMipmap()}}this.mipmapEmitter.emit()}getMipmapLevel(t,n=0){assert&&assert(this._mipmap,"Assumes mipmaps can be used");const r=Imageable.getApproximateMatrixScale(t)*(window.devicePixelRatio||1);return this.getMipmapLevelFromScale(r,n)}getMipmapLevelFromScale(t,n=0){if(assert&&assert(t>0,"scale should be a positive number"),t>=1)return 0;let r=log2(1/t);if(r=DotUtils.roundSymmetric(r+this._mipmapBias+n-.7),r<0&&(r=0),r>this._mipmapMaxLevel&&(r=this._mipmapMaxLevel),this.mipmap&&!this._mipmapCanvases[r]){let s=this._mipmapCanvases.length-1;for(;++s<=r;)this._constructNextMipmap();return Math.min(r,this._mipmapCanvases.length-1)}else return r}getMipmapCanvas(t){if(assert&&assert(t>=0&&t<this._mipmapCanvases.length&&t%1===0),this._mipmapData){const n=this._mipmapData[t]&&this._mipmapData[t].updateCanvas;n&&n()}return this._mipmapCanvases[t]}getMipmapURL(t){return assert&&assert(t>=0&&t<this._mipmapCanvases.length&&t%1===0),this._mipmapURLs[t]}hasMipmaps(){return this._mipmapCanvases.length>0}_invalidateHitTestData(){this._hitTestPixels&&this._image!==null&&(this._hitTestImageData=Imageable.getHitTestData(this._image,this.imageWidth,this.imageHeight))}getImageWidth(){if(this._image===null)return 0;const t=this._mipmapData?this._mipmapData[0].width:("naturalWidth"in this._image?this._image.naturalWidth:0)||this._image.width;return t===0?this._initialWidth:(assert&&assert(this._initialWidth===0||this._initialWidth===t,"Bad Image.initialWidth"),t)}get imageWidth(){return this.getImageWidth()}getImageHeight(){if(this._image===null)return 0;const t=this._mipmapData?this._mipmapData[0].height:("naturalHeight"in this._image?this._image.naturalHeight:0)||this._image.height;return t===0?this._initialHeight:(assert&&assert(this._initialHeight===0||this._initialHeight===t,"Bad Image.initialHeight"),t)}get imageHeight(){return this.getImageHeight()}getImageURL(){return assert&&assert(this._image instanceof HTMLImageElement,"Only supported for HTML image elements"),this._image.src}_attachImageLoadListener(){assert&&assert(!this._imageLoadListenerAttached,"Should only be attached to one thing at a time"),this.isDisposed||(this._image.addEventListener("load",this._imageLoadListener),this._imageLoadListenerAttached=!0)}_detachImageLoadListener(){assert&&assert(this._imageLoadListenerAttached,"Needs to be attached first to be detached."),this._image.removeEventListener("load",this._imageLoadListener),this._imageLoadListenerAttached=!1}_onImageLoad(){assert&&assert(this._imageLoadListenerAttached,"If _onImageLoad is firing, it should be attached"),this.invalidateImage(),this._detachImageLoadListener()}dispose(){this._image&&this._imageLoadListenerAttached&&this._detachImageLoadListener(),this._imageProperty.dispose(),super.dispose&&super.dispose()}};Imageable.getHitTestData=(o,e,t)=>{if(!("naturalWidth"in o&&o.naturalWidth||o.width)||!("naturalHeight"in o&&o.naturalHeight||o.height))return null;const n=getScratchCanvas(),r=getScratchContext();return n.width=e,n.height=t,r.drawImage(o,0,0),r.getImageData(0,0,e,t)};Imageable.testHitTestData=(o,e,t,n)=>{const r=DotUtils.clamp(Math.floor(n.x/e*o.width),0,o.width-1),s=DotUtils.clamp(Math.floor(n.y/t*o.height),0,o.height-1),a=4*(r+s*o.width)+3;return o.data[a]!==0};Imageable.hitTestDataToShape=(o,e,t)=>{const n=e/o.width,r=t/o.height,s=new Shape$1;let a=!1,h=0;for(let c=0;c<o.height;c++){for(let d=0;d<o.width;d++){const y=4*(d+c*o.width)+3;o.data[y]!==0?a||(a=!0,h=d):a&&(a=!1,s.rect(h*n,c*n,n*(d-h),r))}a&&(a=!1,s.rect(h*n,c*n,n*(o.width-h),r))}return s.getSimplifiedAreaShape()};Imageable.createSVGImage=(o,e,t)=>{assert&&assert(isFinite(e)&&e>=0&&e%1===0,"width should be a non-negative finite integer"),assert&&assert(isFinite(t)&&t>=0&&t%1===0,"height should be a non-negative finite integer");const n=document.createElementNS(svgns,"image");return n.setAttribute("x","0"),n.setAttribute("y","0"),n.setAttribute("width",`${e}px`),n.setAttribute("height",`${t}px`),n.setAttributeNS(xlinkns,"xlink:href",o),n};Imageable.createFastMipmapFromCanvas=o=>{const e=[],t=o.toDataURL(),n=new window.Image;n.src=t,e.push({img:n,url:t,width:o.width,height:o.height,canvas:o});let r=o;for(;r.width>=2&&r.height>=2;){const s=document.createElement("canvas");s.width=Math.ceil(r.width/2),s.height=Math.ceil(r.height/2);const a=s.getContext("2d");a.setTransform(.5,0,0,.5,0,0),a.drawImage(r,0,0);const h={width:s.width,height:s.height,canvas:s,url:s.toDataURL(),img:new window.Image};h.img.src=h.url,r=s,e.push(h)}return e};Imageable.getApproximateMatrixScale=o=>(Math.sqrt(o.m00()*o.m00()+o.m10()*o.m10())+Math.sqrt(o.m01()*o.m01()+o.m11()*o.m11()))/2;Imageable.CANVAS_MIPMAP_BIAS_ADJUSTMENT=.5;Imageable.DEFAULT_OPTIONS=DEFAULT_OPTIONS$5;scenery.register("Imageable",Imageable);const Imageable$1=Imageable,DelayedMutate=(o,e,t)=>{const n=`_${o}PendingOptions`,r=`_${o}IsConstructed`;return class extends t{constructor(...a){super(...a),this[r]=!0,this.mutate(this[n]),this[n]=void 0}mutate(a){return a&&!this[r]&&(this[n]=combineOptions(this[n]||{},_.pick(a,e)),a=_.omit(a,e)),super.mutate(a)}}};scenery.register("DelayedMutate",DelayedMutate);const DelayedMutate$1=DelayedMutate,IMAGE_OPTION_KEYS=["image","imageProperty","imageOpacity","imageBounds","initialWidth","initialHeight","mipmap","mipmapBias","mipmapInitialLevel","mipmapMaxLevel","hitTestPixels"];var Ds;let Image$1=(Ds=class extends Imageable$1(Node$2){constructor(e,t){const n={};isTReadOnlyProperty(e)?n.imageProperty=e:n.image=e;const r=optionize()(n,t);super(),this._imageBounds=null,this.mutate(r),this.invalidateSupportedRenderers()}invalidateImage(){this._image?this.invalidateSelf(this._imageBounds||new Bounds2(0,0,this.getImageWidth(),this.getImageHeight())):this.invalidateSelf(Bounds2.NOTHING);const e=this._drawables.length;for(let t=0;t<e;t++)this._drawables[t].markDirtyImage();super.invalidateImage(),this.invalidateSupportedRenderers()}invalidateSupportedRenderers(){let e=Renderer.bitmaskCanvas;this.getImageWidth()<=SpriteSheet.MAX_DIMENSION.width&&this.getImageHeight()<=SpriteSheet.MAX_DIMENSION.height&&(e|=Renderer.bitmaskWebGL),this._image instanceof HTMLCanvasElement||(e|=Renderer.bitmaskSVG|Renderer.bitmaskDOM),this.setRendererBitmask(e)}setImageOpacity(e){const t=this._imageOpacity!==e;if(super.setImageOpacity(e),t){const n=this._drawables.length;for(let r=0;r<n;r++)this._drawables[r].markDirtyImageOpacity()}}setImageBounds(e){this._imageBounds!==e&&(this._imageBounds=e,this.invalidateImage())}set imageBounds(e){this.setImageBounds(e)}get imageBounds(){return this._imageBounds}getImageBounds(){return this._imageBounds}isPainted(){return!0}canvasPaintSelf(e,t){ImageCanvasDrawable$1.prototype.paintCanvas(e,this,t)}createDOMDrawable(e,t){return ImageDOMDrawable$1.createFromPool(e,t)}createSVGDrawable(e,t){return ImageSVGDrawable$1.createFromPool(e,t)}createCanvasDrawable(e,t){return ImageCanvasDrawable$1.createFromPool(e,t)}createWebGLDrawable(e,t){return ImageWebGLDrawable$1.createFromPool(e,t)}containsPointSelf(e){const t=Node$2.prototype.containsPointSelf.call(this,e);return!t||!this._hitTestPixels||!this._hitTestImageData?t:Imageable$1.testHitTestData(this._hitTestImageData,this.imageWidth,this.imageHeight,e)}getSelfShape(){return this._hitTestPixels&&this._hitTestImageData?Imageable$1.hitTestDataToShape(this._hitTestImageData,this.imageWidth,this.imageHeight):Node$2.prototype.getSelfShape.call(this)}invalidateMipmaps(){const e=this._image&&this._mipmap&&!this._mipmapData;if(super.invalidateMipmaps(),e){const t=this._drawables.length;for(let n=0;n<t;n++)this._drawables[n].markDirtyMipmap()}}mutate(e){return super.mutate(e)}},Ds.DEFAULT_IMAGE_OPTIONS=combineOptions({},Node$2.DEFAULT_NODE_OPTIONS,Imageable$1.DEFAULT_OPTIONS),Ds);Image$1.prototype._mutatorKeys=[...IMAGE_OPTION_KEYS,...Node$2.prototype._mutatorKeys];Image$1.prototype.drawableMarkFlags=[...Node$2.prototype.drawableMarkFlags,"image","imageOpacity","mipmap"];Image$1.ImageIO=new IOType("ImageIO",{valueType:Image$1,supertype:Node$2.NodeIO,events:["changed"],methods:{setImage:{returnType:VoidIO,parameterTypes:[StringIO],implementation:function(o){const e=new window.Image;e.src=o,this.image=e},documentation:"Set the image from a base64 string",invocableForReadOnlyElements:!1}}});scenery.register("Image",Image$1);const PATH_OPTION_KEYS=["boundsMethod","shape","shapeProperty"],DEFAULT_OPTIONS$4={shape:null,boundsMethod:"accurate"},yn=class yn extends Paintable(Node$2){constructor(e,t){assert&&assert(t===void 0||Object.getPrototypeOf(t)===Object.prototype,"Extra prototype on Node options object is a code smell"),(e||t!=null&&t.shape)&&assert&&assert(!e||!(t!=null&&t.shape),"Do not define shape twice. Check constructor and providedOptions.");const n={boundsMethod:DEFAULT_OPTIONS$4.boundsMethod};isTReadOnlyProperty(e)?n.shapeProperty=e:n.shape=e;const r=optionize()(n,t);super(),this._shapeProperty=new TinyForwardingProperty(null,!1,this.onShapePropertyChange.bind(this)),this._shape=DEFAULT_OPTIONS$4.shape,this._strokedShape=null,this._boundsMethod=DEFAULT_OPTIONS$4.boundsMethod,this._invalidShapeListener=this.invalidateShape.bind(this),this._invalidShapeListenerAttached=!1,this.invalidateSupportedRenderers(),this.mutate(r)}setShape(e){return assert&&assert(e===null||typeof e=="string"||e instanceof Shape$1,"A path's shape should either be null, a string, or a Shape"),this._shapeProperty.value=e,this}set shape(e){this.setShape(e)}get shape(){return this.getShape()}getShape(){return this._shape}onShapePropertyChange(e){assert&&assert(e===null||typeof e=="string"||e instanceof Shape$1,"A path's shape should either be null, a string, or a Shape"),this._shape!==e&&(this._invalidShapeListenerAttached&&this.detachShapeListener(),typeof e=="string"&&(e=new Shape$1(e)),this._shape=e,this.invalidateShape(),this._shape&&!this._shape.isImmutable()&&this.attachShapeListener())}setShapeProperty(e){return this._shapeProperty.setTargetProperty(e)}set shapeProperty(e){this.setShapeProperty(e)}get shapeProperty(){return this.getShapeProperty()}getShapeProperty(){return this._shapeProperty}getStrokedShape(){return assert&&assert(this.hasShape(),"We cannot stroke a non-existing shape"),this._strokedShape||(this._strokedShape=this.getShape().getStrokedShape(this._lineDrawingStyles)),this._strokedShape}getPathRendererBitmask(){return Renderer.bitmaskCanvas|Renderer.bitmaskSVG}invalidateSupportedRenderers(){this.setRendererBitmask(this.getFillRendererBitmask()&this.getStrokeRendererBitmask()&this.getPathRendererBitmask())}invalidateShape(){this.invalidatePath();const e=this._drawables.length;for(let t=0;t<e;t++)this._drawables[t].markDirtyShape();this._invalidShapeListenerAttached&&this._shape&&this._shape.isImmutable()&&this.detachShapeListener()}invalidatePath(){this._strokedShape=null,this.invalidateSelf()}attachShapeListener(){assert&&assert(!this._invalidShapeListenerAttached,"We do not want to have two listeners attached!"),this.isDisposed||(this._shape.invalidatedEmitter.addListener(this._invalidShapeListener),this._invalidShapeListenerAttached=!0)}detachShapeListener(){assert&&assert(this._invalidShapeListenerAttached,"We cannot detach an unattached listener"),this._shape.invalidatedEmitter.removeListener(this._invalidShapeListener),this._invalidShapeListenerAttached=!1}updateSelfBounds(){const e=this.hasShape()?this.computeShapeBounds():Bounds2.NOTHING,t=!e.equals(this.selfBoundsProperty._value);return t&&this.selfBoundsProperty._value.set(e),t}setBoundsMethod(e){return assert&&assert(e==="accurate"||e==="unstroked"||e==="tightPadding"||e==="safePadding"||e==="none"),this._boundsMethod!==e&&(this._boundsMethod=e,this.invalidatePath(),this.rendererSummaryRefreshEmitter.emit()),this}set boundsMethod(e){this.setBoundsMethod(e)}get boundsMethod(){return this.getBoundsMethod()}getBoundsMethod(){return this._boundsMethod}computeShapeBounds(){const e=this.getShape();if(this._boundsMethod==="none"||!e)return Bounds2.NOTHING;if(!this.hasPaintableStroke()||this._boundsMethod==="unstroked")return e.bounds;if(this._boundsMethod==="accurate")return e.getStrokedBounds(this.getLineStyles());{let t;return this._boundsMethod==="safePadding"&&this.getLineJoin()==="miter"?t=this.getMiterLimit():this.getLineCap()==="square"?t=Math.SQRT2:t=1,e.bounds.dilated(t*this.getLineWidth()/2)}}areSelfBoundsValid(){return this._boundsMethod==="accurate"||this._boundsMethod==="safePadding"?!0:this._boundsMethod==="none"?!1:!this.hasStroke()}getTransformedSelfBounds(e){return assert&&assert(this.hasShape()),(this._stroke?this.getStrokedShape():this.getShape()).getBoundsWithTransform(e)}getTransformedSafeSelfBounds(e){return this.getTransformedSelfBounds(e)}invalidateStroke(){this.invalidatePath(),this.rendererSummaryRefreshEmitter.emit(),super.invalidateStroke()}hasShape(){return!!this._shape}canvasPaintSelf(e,t){PathCanvasDrawable$1.prototype.paintCanvas(e,this,t)}createSVGDrawable(e,t){return PathSVGDrawable$1.createFromPool(e,t)}createCanvasDrawable(e,t){return PathCanvasDrawable$1.createFromPool(e,t)}isPainted(){return!0}containsPointSelf(e){let t=!1;return this.hasShape()&&(this._fillPickable&&(t=this.getShape().containsPoint(e)),!t&&this._strokePickable&&(t=this.getStrokedShape().containsPoint(e))),t}getSelfShape(){return Shape$1.union([...this.hasShape()&&this._fillPickable?[this.getShape()]:[],...this.hasShape()&&this._strokePickable?[this.getStrokedShape()]:[]])}intersectsBoundsSelf(e){return this._shape?this._shape.intersectsBounds(e):!1}requiresSVGBoundsWorkaround(){if(!this._stroke||!(this._stroke instanceof Paint)||!this.hasShape())return!1;const e=this.computeShapeBounds();return e.width*e.height===0}getDebugHTMLExtras(){return this._shape?` (<span style="color: #88f" onclick="window.open( 'data:text/plain;charset=utf-8,' + encodeURIComponent( '${this._shape.getSVGPath()}' ) );">path</span>)`:""}dispose(){this._invalidShapeListenerAttached&&this.detachShapeListener(),this._shapeProperty.dispose(),super.dispose()}mutate(e){return super.mutate(e)}};yn.DEFAULT_PATH_OPTIONS=combineOptions({},Node$2.DEFAULT_NODE_OPTIONS,DEFAULT_OPTIONS$4);let Path=yn;Path.prototype._mutatorKeys=[...PAINTABLE_OPTION_KEYS,...PATH_OPTION_KEYS,...Node$2.prototype._mutatorKeys];Path.prototype.drawableMarkFlags=[...Node$2.prototype.drawableMarkFlags,...PAINTABLE_DRAWABLE_MARK_FLAGS,"shape"];scenery.register("Path",Path);const PhetioElementSelectionValues=["view","linked","string","none"],phetioElementSelectionProperty=new Property("none",{tandem:Tandem.GENERAL_VIEW.createTandem("phetioElementSelectionProperty"),phetioValueType:StringIO,validValues:PhetioElementSelectionValues,phetioState:!1,phetioDocumentation:'Specifies how PhET-iO Elements are being selected. "view": the target view element, "linked": the corresponding linked element of the view element (if there is one), "string": select only string elements in the sim, "none": no active selection.'});tandemNamespace.register("phetioElementSelectionProperty",phetioElementSelectionProperty);const STRING_PROPERTY_NAME="stringProperty",TEXT_OPTION_KEYS=["boundsMethod",STRING_PROPERTY_NAME,"string","font","fontWeight","fontFamily","fontStretch","fontStyle","fontSize"],useDOMAsFastBounds=window.navigator.userAgent.includes("like Gecko) Version/5")&&window.navigator.userAgent.includes("Safari/"),jt=class jt extends Paintable(Node$2){constructor(e,t){assert&&assert(t===void 0||Object.getPrototypeOf(t)===Object.prototype,"Extra prototype on Node options object is a code smell"),super(),this._stringProperty=new TinyForwardingProperty("",!0,this.onStringPropertyChange.bind(this)),this._font=Font.DEFAULT,this._boundsMethod="hybrid",this._isHTML=!1,this._cachedRenderedText=null;const n=extendDefined({fill:"#000000",tandemNameSuffix:"Text",phetioType:jt.TextIO,phetioVisiblePropertyInstrumented:!1},t);assert&&assert(!n.hasOwnProperty("string")&&!n.hasOwnProperty(jt.STRING_PROPERTY_TANDEM_NAME),"provide string and stringProperty through constructor arg please"),typeof e=="string"||typeof e=="number"?n.string=e:n.stringProperty=e,this.mutate(n),this.invalidateSupportedRenderers()}mutate(e){return assert&&e&&e.hasOwnProperty("string")&&e.hasOwnProperty(STRING_PROPERTY_NAME)&&assert&&assert(e.stringProperty.value===e.string,"If both string and stringProperty are provided, then values should match"),super.mutate(e)}setString(e){return assert&&assert(e!=null,"String should be defined and non-null. Use the empty string if needed."),e=`${e}`,this._stringProperty.set(e),this}set string(e){this.setString(e)}get string(){return this.getString()}getString(){return this._stringProperty.value}getRenderedText(){return this._cachedRenderedText===null&&(this._cachedRenderedText=this.string.replace(" "," "),platform.edge&&(this._cachedRenderedText=jt.simplifyEmbeddingMarks(this._cachedRenderedText))),this._cachedRenderedText}get renderedText(){return this.getRenderedText()}onStringPropertyChange(){this._cachedRenderedText=null;const e=this._drawables.length;for(let t=0;t<e;t++)this._drawables[t].markDirtyText();this.invalidateText()}setStringProperty(e){return this._stringProperty.setTargetProperty(e,this,jt.STRING_PROPERTY_TANDEM_NAME)}set stringProperty(e){this.setStringProperty(e)}get stringProperty(){return this.getStringProperty()}getStringProperty(){return this._stringProperty}initializePhetioObject(e,t){const n=this.isPhetioInstrumented();super.initializePhetioObject(e,t),Tandem.PHET_IO_ENABLED&&!n&&this.isPhetioInstrumented()&&this._stringProperty.initializePhetio(this,jt.STRING_PROPERTY_TANDEM_NAME,()=>new StringProperty(this.string,combineOptions({phetioReadOnly:!0,tandem:this.tandem.createTandem(jt.STRING_PROPERTY_TANDEM_NAME),phetioDocumentation:"Property for the displayed text"},t.stringPropertyOptions)))}getPhetioMouseHitTarget(e=!1){return phetioElementSelectionProperty.value==="string"?this.getStringPropertyPhetioMouseHitTarget(e):super.getPhetioMouseHitTarget(e)}getStringPropertyPhetioMouseHitTarget(e=!1){const t=this._stringProperty.getTargetProperty();return t instanceof PhetioObject?t.getPhetioMouseHitTarget(e):"phetioNotSelectable"}setBoundsMethod(e){if(assert&&assert(e==="fast"||e==="fastCanvas"||e==="accurate"||e==="hybrid","Unknown Text boundsMethod"),e!==this._boundsMethod){this._boundsMethod=e,this.invalidateSupportedRenderers();const t=this._drawables.length;for(let n=0;n<t;n++)this._drawables[n].markDirtyBounds();this.invalidateText(),this.rendererSummaryRefreshEmitter.emit()}return this}set boundsMethod(e){this.setBoundsMethod(e)}get boundsMethod(){return this.getBoundsMethod()}getBoundsMethod(){return this._boundsMethod}getTextRendererBitmask(){let e=0;return this._boundsMethod!=="fast"&&!this._isHTML&&(e|=Renderer.bitmaskCanvas),this._isHTML||(e|=Renderer.bitmaskSVG),e|=Renderer.bitmaskDOM,e}invalidateSupportedRenderers(){this.setRendererBitmask(this.getFillRendererBitmask()&this.getStrokeRendererBitmask()&this.getTextRendererBitmask())}invalidateText(){this.invalidateSelf();const e=this._drawables.length;for(let t=0;t<e;t++)this._drawables[t].markDirtyBounds();this.invalidateSupportedRenderers()}updateSelfBounds(){let e;this._isHTML||useDOMAsFastBounds&&this._boundsMethod!=="accurate"?e=TextBounds.approximateDOMBounds(this._font,this.getDOMTextNode()):this._boundsMethod==="hybrid"?e=TextBounds.approximateHybridBounds(this._font,this.renderedText):this._boundsMethod==="accurate"?e=TextBounds.accurateCanvasBounds(this):(assert&&assert(this._boundsMethod==="fast"||this._boundsMethod==="fastCanvas"),e=TextBounds.approximateSVGBounds(this._font,this.renderedText)),this.hasStroke()&&e.dilate(this.getLineWidth()/2);const t=!e.equals(this.selfBoundsProperty._value);return t&&this.selfBoundsProperty._value.set(e),t}invalidateStroke(){this.invalidateText(),super.invalidateStroke()}invalidateFill(){this.invalidateText(),super.invalidateFill()}canvasPaintSelf(e,t){TextCanvasDrawable$1.prototype.paintCanvas(e,this,t)}createDOMDrawable(e,t){return TextDOMDrawable$1.createFromPool(e,t)}createSVGDrawable(e,t){return TextSVGDrawable$1.createFromPool(e,t)}createCanvasDrawable(e,t){return TextCanvasDrawable$1.createFromPool(e,t)}getDOMTextNode(){if(this._isHTML){const e=document.createElement("span");return e.innerHTML=this.string,e}else return document.createTextNode(this.renderedText)}getSafeSelfBounds(){const t=this.getSelfBounds();return t.dilatedXY(1*t.width,1*t.height)}setFont(e){if(e!==(typeof e=="string"?this._font.toCSS():this._font)){this._font=typeof e=="string"?Font.fromCSS(e):e;const n=this._drawables.length;for(let r=0;r<n;r++)this._drawables[r].markDirtyFont();this.invalidateText()}return this}set font(e){this.setFont(e)}get font(){return this.getFont()}getFont(){return this._font.getFont()}setFontWeight(e){return this.setFont(this._font.copy({weight:e}))}set fontWeight(e){this.setFontWeight(e)}get fontWeight(){return this.getFontWeight()}getFontWeight(){return this._font.getWeight()}setFontFamily(e){return this.setFont(this._font.copy({family:e}))}set fontFamily(e){this.setFontFamily(e)}get fontFamily(){return this.getFontFamily()}getFontFamily(){return this._font.getFamily()}setFontStretch(e){return this.setFont(this._font.copy({stretch:e}))}set fontStretch(e){this.setFontStretch(e)}get fontStretch(){return this.getFontStretch()}getFontStretch(){return this._font.getStretch()}setFontStyle(e){return this.setFont(this._font.copy({style:e}))}set fontStyle(e){this.setFontStyle(e)}get fontStyle(){return this.getFontStyle()}getFontStyle(){return this._font.getStyle()}setFontSize(e){return this.setFont(this._font.copy({size:e}))}set fontSize(e){this.setFontSize(e)}get fontSize(){return this.getFontSize()}getFontSize(){return this._font.getSize()}isPainted(){return!0}areSelfBoundsValid(){return this._boundsMethod==="accurate"}getDebugHTMLExtras(){return` "${escapeHTML(this.renderedText)}"${this._isHTML?" (html)":""}`}dispose(){super.dispose(),this._stringProperty.dispose()}static embeddedDebugString(e){return e.replace(/\u202a/g,"[LTR]").replace(/\u202b/g,"[RTL]").replace(/\u202c/g,"[POP]")}static simplifyEmbeddingMarks(e){const t={dir:null,children:[],parent:null};let n=t;for(let d=0;d<e.length;d++){const y=e.charAt(d);if(y===LTR$1||y===RTL$1){const g={dir:y,children:[],parent:n};n.children.push(g),n=g}else y===POP$1?(assert&&assert(n.parent,`Bad nesting of embedding marks: ${jt.embeddedDebugString(e)}`),n=n.parent):n.children.push(y)}assert&&assert(n===t,`Bad nesting of embedding marks: ${jt.embeddedDebugString(e)}`);function r(d){for(let y=d.children.length-1;y>=0;y--){const g=d.children[y];typeof g!="string"&&d.dir===g.dir&&d.children.splice(y,1,...g.children)}}function s(d){d.children.length===1&&typeof d.children[0]!="string"&&d.children[0].dir&&(d.dir=d.children[0].dir,d.children=d.children[0].children)}function a(d){for(let y=d.children.length-1;y>=1;y--){const g=d.children[y-1],D=d.children[y];typeof D!="string"&&typeof g!="string"&&D.dir&&g.dir===D.dir&&(g.children=g.children.concat(D.children),d.children.splice(y,1),a(g))}}function h(d){if(typeof d!="string"){for(let y=0;y<d.children.length;y++)h(d.children[y]);s(d),r(d),a(d)}return d}function c(d){if(typeof d=="string")return d;const y=d.children.map(c).join("");return d.dir?`${d.dir+y}‬`:y}return c(h(t))}};jt.STRING_PROPERTY_NAME=STRING_PROPERTY_NAME,jt.STRING_PROPERTY_TANDEM_NAME=STRING_PROPERTY_NAME;let Text=jt;Text.prototype._mutatorKeys=[...PAINTABLE_OPTION_KEYS,...TEXT_OPTION_KEYS,...Node$2.prototype._mutatorKeys];Text.prototype.drawableMarkFlags=[...Node$2.prototype.drawableMarkFlags,...PAINTABLE_DRAWABLE_MARK_FLAGS,"text","font","bounds"];scenery.register("Text",Text);const LTR$1="‪",RTL$1="‫",POP$1="‬";TextBounds.initializeTextBounds();Text.TextIO=new IOType("TextIO",{valueType:Text,supertype:Node$2.NodeIO,documentation:"Text that is displayed in the simulation. TextIO has a nested PropertyIO.&lt;String&gt; for the current string value."});const CANVAS_NODE_OPTION_KEYS=["canvasBounds"];class CanvasNode extends Node$2{constructor(e){super(e),this.setRendererBitmask(Renderer.bitmaskCanvas)}setCanvasBounds(e){this.invalidateSelf(e)}set canvasBounds(e){this.setCanvasBounds(e)}get canvasBounds(){return this.getCanvasBounds()}getCanvasBounds(){return this.getSelfBounds()}isPainted(){return!0}invalidatePaint(){const e=this._drawables.length;for(let t=0;t<e;t++)this._drawables[t].markDirty()}canvasPaintSelf(e,t){this.paintCanvas(e.context)}containsPointSelf(e){return!1}getSelfShape(){return new Shape$1}createCanvasDrawable(e,t){return CanvasNodeDrawable$1.createFromPool(e,t)}mutate(e){return super.mutate(e)}}CanvasNode.prototype._mutatorKeys=CANVAS_NODE_OPTION_KEYS.concat(Node$2.prototype._mutatorKeys);scenery.register("CanvasNode",CanvasNode);const CIRCLE_OPTION_KEYS=["radius"];class Circle extends Path{constructor(e,t){super(null),this._radius=0,typeof e=="object"?(t=e,assert&&assert(t===void 0||Object.getPrototypeOf(t)===Object.prototype,"Extra prototype on Node options object is a code smell")):(assert&&assert(t===void 0||Object.getPrototypeOf(t)===Object.prototype,"Extra prototype on Node options object is a code smell"),t=extendDefined({radius:e},t)),this.mutate(t)}getStrokeRendererBitmask(){let e=super.getStrokeRendererBitmask();return this.hasStroke()&&!this.getStroke().isGradient&&!this.getStroke().isPattern&&this.getLineWidth()<=this.getRadius()&&(e|=Renderer.bitmaskDOM),e}getPathRendererBitmask(){return Renderer.bitmaskCanvas|Renderer.bitmaskSVG|(Features.borderRadius?Renderer.bitmaskDOM:0)}invalidateCircle(){assert&&assert(this._radius>=0,"A circle needs a non-negative radius"),this._shape=null,this.invalidatePath()}createCircleShape(){return Shape$1.circle(0,0,this._radius).makeImmutable()}intersectsBoundsSelf(e){let t=Math.abs(e.centerX),n=Math.abs(e.centerY);const r=e.maxX-t,s=e.maxY-n;return t>r+this._radius||n>s+this._radius?!1:t<=r||n<=s?!0:(t-=r,n-=s,t*t+n*n<=this._radius*this._radius)}canvasPaintSelf(e,t){CircleCanvasDrawable$1.prototype.paintCanvas(e,this,t)}createDOMDrawable(e,t){return CircleDOMDrawable$1.createFromPool(e,t)}createSVGDrawable(e,t){return CircleSVGDrawable$1.createFromPool(e,t)}createCanvasDrawable(e,t){return CircleCanvasDrawable$1.createFromPool(e,t)}setRadius(e){if(assert&&assert(e>=0,"A circle needs a non-negative radius"),assert&&assert(isFinite(e),"A circle needs a finite radius"),this._radius!==e){this._radius=e,this.invalidateCircle();const t=this._drawables.length;for(let n=0;n<t;n++)this._drawables[n].markDirtyRadius()}return this}set radius(e){this.setRadius(e)}get radius(){return this.getRadius()}getRadius(){return this._radius}computeShapeBounds(){let e=new Bounds2(-this._radius,-this._radius,this._radius,this._radius);return this._stroke&&(e=e.dilated(this.getLineWidth()/2)),e}containsPointSelf(e){const t=e.x*e.x+e.y*e.y;let n=!0,r;if(this._strokePickable){r=this.getLineWidth()/2;const s=this._radius+r;n=n&&t<=s*s}if(this._fillPickable)return this._strokePickable?n:t<=this._radius*this._radius;if(this._strokePickable){const s=this._radius-r;return n&&t>=s*s}else return!1}setShape(e){if(e!==null)throw new Error("Cannot set the shape of a Circle to something non-null");return this.invalidatePath(),this}getShape(){return this._shape||(this._shape=this.createCircleShape()),this._shape}hasShape(){return!0}setShapeProperty(e){if(e!==null)throw new Error("Cannot set the shapeProperty of a Circle to something non-null, it handles this itself");return this}mutate(e){return super.mutate(e)}}Circle.prototype._mutatorKeys=CIRCLE_OPTION_KEYS.concat(Path.prototype._mutatorKeys);Circle.prototype.drawableMarkFlags=Path.prototype.drawableMarkFlags.concat(["radius"]).filter(o=>o!=="shape");scenery.register("Circle",Circle);const DOM_OPTION_KEYS=["element","preventTransform","allowInput"],isJQueryElement=o=>!!(o&&o.jquery);class DOM extends Node$2{constructor(e,t){assert&&assert(t===void 0||Object.getPrototypeOf(t)===Object.prototype,"Extra prototype on Node options object is a code smell"),assert&&assert(e instanceof window.Element||e.jquery,"DOM nodes need to be passed an HTML/DOM element or a jQuery selection like $( ... )"),isJQueryElement(e)&&(e=e[0],assert&&assert(e instanceof window.Element)),super(),this._container=document.createElement("div"),this._container.style.position="absolute",this._container.style.left="0",this._container.style.top="0",this._allowInput=!1,this._$container=$(this._container),this.invalidateDOMLock=!1,this._preventTransform=!1,this.invalidateAllowInput(this._allowInput),t=extendDefined({element:e},t),this.mutate(t),this.setRendererBitmask(Renderer.bitmaskDOM)}calculateDOMBounds(){const e=$(this._element);return new Bounds2(0,0,e.width(),e.height())}invalidateDOM(){if(this.invalidateDOMLock)return;this.invalidateDOMLock=!0;const e=document.createElement("div");$(e).css({display:"hidden",padding:"0 !important",margin:"0 !important",position:"absolute",left:0,top:0,width:65535,height:65535}),this._container.removeChild(this._element),e.appendChild(this._element),document.body.appendChild(e);const t=this.calculateDOMBounds();this.invalidateSelf(t),this._$container.width(t.getWidth()),this._$container.height(t.getHeight()),document.body.removeChild(e),e.removeChild(this._element),this._container.appendChild(this._element),this.invalidateDOMLock=!1}createDOMDrawable(e,t){return DOMDrawable$1.createFromPool(e,t)}isPainted(){return!0}setElement(e){return assert&&assert(!this._element,"We should only ever attach one DOMElement to a DOM node"),this._element!==e&&(this._element&&this._container.removeChild(this._element),this._element=e,this._container.appendChild(this._element),this.invalidateDOM()),this}set element(e){this.setElement(e)}get element(){return this.getElement()}getElement(){return this._element}setPreventTransform(e){this._preventTransform!==e&&(this._preventTransform=e)}set preventTransform(e){this.setPreventTransform(e)}get preventTransform(){return this.isTransformPrevented()}isTransformPrevented(){return this._preventTransform}setAllowInput(e){this._allowInput!==e&&(this._allowInput=e,this.invalidateAllowInput(e))}isInputAllowed(){return this._allowInput}invalidateAllowInput(e){this._container.dataset.sceneryAllowInput=e?"true":"false",this._container.style.pointerEvents=e?"auto":"none"}set allowInput(e){this.setAllowInput(e)}get allowInput(){return this.isInputAllowed()}mutate(e){return super.mutate(e)}}DOM.prototype._mutatorKeys=DOM_OPTION_KEYS.concat(Node$2.prototype._mutatorKeys);scenery.register("DOM",DOM);const LINE_OPTION_KEYS=["p1","p2","x1","y1","x2","y2"];class Line extends Path{constructor(e,t,n,r,s){super(null),this._x1=0,this._y1=0,this._x2=0,this._y2=0,typeof e=="object"?e instanceof Vector2?(assert&&assert(n===void 0||typeof n=="object"),assert&&assert(n===void 0||Object.getPrototypeOf(n)===Object.prototype,"Extra prototype on Node options object is a code smell"),s=extendDefined({x1:e.x,y1:e.y,x2:t.x,y2:t.y,strokePickable:!0},n)):(assert&&assert(t===void 0),assert&&assert(e===void 0||Object.getPrototypeOf(e)===Object.prototype,"Extra prototype on Node options object is a code smell"),s=extendDefined({strokePickable:!0},e)):(assert&&assert(e!==void 0&&typeof t=="number"&&typeof n=="number"&&typeof r=="number"),assert&&assert(s===void 0||Object.getPrototypeOf(s)===Object.prototype,"Extra prototype on Node options object is a code smell"),s=extendDefined({x1:e,y1:t,x2:n,y2:r,strokePickable:!0},s)),this.mutate(s)}setLine(e,t,n,r){assert&&assert(e!==void 0&&t!==void 0&&n!==void 0&&r!==void 0,"parameters need to be defined"),this._x1=e,this._y1=t,this._x2=n,this._y2=r;const s=this._drawables.length;for(let a=0;a<s;a++)this._drawables[a].markDirtyLine();return this.invalidateLine(),this}setPoint1(e,t){typeof e=="number"?(assert&&assert(e!==void 0&&t!==void 0,"parameters need to be defined"),this._x1=e,this._y1=t):(assert&&assert(e.x!==void 0&&e.y!==void 0,"parameters need to be defined"),this._x1=e.x,this._y1=e.y);const n=this._drawables.length;for(let r=0;r<n;r++)this._drawables[r].markDirtyP1();return this.invalidateLine(),this}set p1(e){this.setPoint1(e)}get p1(){return new Vector2(this._x1,this._y1)}setPoint2(e,t){typeof e=="number"?(assert&&assert(e!==void 0&&t!==void 0,"parameters need to be defined"),this._x2=e,this._y2=t):(assert&&assert(e.x!==void 0&&e.y!==void 0,"parameters need to be defined"),this._x2=e.x,this._y2=e.y);const n=this._drawables.length;for(let r=0;r<n;r++)this._drawables[r].markDirtyP2();return this.invalidateLine(),this}set p2(e){this.setPoint2(e)}get p2(){return new Vector2(this._x2,this._y2)}setX1(e){if(this._x1!==e){this._x1=e;const t=this._drawables.length;for(let n=0;n<t;n++)this._drawables[n].markDirtyX1();this.invalidateLine()}return this}set x1(e){this.setX1(e)}get x1(){return this.getX1()}getX1(){return this._x1}setY1(e){if(this._y1!==e){this._y1=e;const t=this._drawables.length;for(let n=0;n<t;n++)this._drawables[n].markDirtyY1();this.invalidateLine()}return this}set y1(e){this.setY1(e)}get y1(){return this.getY1()}getY1(){return this._y1}setX2(e){if(this._x2!==e){this._x2=e;const t=this._drawables.length;for(let n=0;n<t;n++)this._drawables[n].markDirtyX2();this.invalidateLine()}return this}set x2(e){this.setX2(e)}get x2(){return this.getX2()}getX2(){return this._x2}setY2(e){if(this._y2!==e){this._y2=e;const t=this._drawables.length;for(let n=0;n<t;n++)this._drawables[n].markDirtyY2();this.invalidateLine()}return this}set y2(e){this.setY2(e)}get y2(){return this.getY2()}getY2(){return this._y2}createLineShape(){return Shape$1.lineSegment(this._x1,this._y1,this._x2,this._y2).makeImmutable()}invalidateLine(){assert&&assert(isFinite(this._x1),`A line needs to have a finite x1 (${this._x1})`),assert&&assert(isFinite(this._y1),`A line needs to have a finite y1 (${this._y1})`),assert&&assert(isFinite(this._x2),`A line needs to have a finite x2 (${this._x2})`),assert&&assert(isFinite(this._y2),`A line needs to have a finite y2 (${this._y2})`),this._shape=null,this.invalidatePath()}containsPointSelf(e){return this._strokePickable?super.containsPointSelf(e):!1}canvasPaintSelf(e,t){LineCanvasDrawable$1.prototype.paintCanvas(e,this,t)}computeShapeBounds(){if(this._stroke){const e=this.getLineCap(),t=this.getLineWidth()/2;if(e==="round")return new Bounds2(Math.min(this._x1,this._x2)-t,Math.min(this._y1,this._y2)-t,Math.max(this._x1,this._x2)+t,Math.max(this._y1,this._y2)+t);{const n=this._x2-this._x1,r=this._y2-this._y1,s=Math.sqrt(n*n+r*r);if(s===0)return new Bounds2(this._x1-t,this._y1-t,this._x2+t,this._y2+t);const a=t*n/s,h=t*r/s,c=Bounds2.NOTHING.copy();return e==="butt"?(c.addCoordinates(this._x1-h,this._y1+a),c.addCoordinates(this._x1+h,this._y1-a),c.addCoordinates(this._x2-h,this._y2+a),c.addCoordinates(this._x2+h,this._y2-a)):(assert&&assert(e==="square"),c.addCoordinates(this._x1-a-h,this._y1-h+a),c.addCoordinates(this._x1-a+h,this._y1-h-a),c.addCoordinates(this._x2+a-h,this._y2+h+a),c.addCoordinates(this._x2+a+h,this._y2+h-a)),c}}else{const e=Bounds2.NOTHING.copy();return e.addCoordinates(this._x1,this._y1),e.addCoordinates(this._x2,this._y2),e}}createSVGDrawable(e,t){return LineSVGDrawable$1.createFromPool(e,t)}createCanvasDrawable(e,t){return LineCanvasDrawable$1.createFromPool(e,t)}setShape(e){if(e!==null)throw new Error("Cannot set the shape of a Line to something non-null");return this.invalidatePath(),this}getShape(){return this._shape||(this._shape=this.createLineShape()),this._shape}hasShape(){return!0}setShapeProperty(e){if(e!==null)throw new Error("Cannot set the shapeProperty of a Line to something non-null, it handles this itself");return this}mutate(e){return super.mutate(e)}getFillRendererBitmask(){return Renderer.bitmaskCanvas|Renderer.bitmaskSVG|Renderer.bitmaskDOM|Renderer.bitmaskWebGL}}Line.prototype._mutatorKeys=LINE_OPTION_KEYS.concat(Path.prototype._mutatorKeys);Line.prototype.drawableMarkFlags=Path.prototype.drawableMarkFlags.concat(["line","p1","p2","x1","x2","y1","y2"]).filter(o=>o!=="shape");scenery.register("Line",Line);const RECTANGLE_OPTION_KEYS=["rectBounds","rectSize","rectX","rectY","rectWidth","rectHeight","cornerRadius","cornerXRadius","cornerYRadius"],SuperType$1=Sizable(Path);class Rectangle extends SuperType$1{constructor(e,t,n,r,s,a,h){const c={sizable:!1};super(null,c);let d={};this._rectX=0,this._rectY=0,this._rectWidth=0,this._rectHeight=0,this._cornerXRadius=0,this._cornerYRadius=0,typeof e=="object"?e instanceof Bounds2?typeof t!="number"?(assert&&assert(arguments.length===1||arguments.length===2,"new Rectangle( bounds, { ... } ) should only take one or two arguments"),assert&&assert(t===void 0||typeof t=="object","new Rectangle( bounds, { ... } ) second parameter should only ever be an options object"),assert&&assert(t===void 0||Object.getPrototypeOf(t)===Object.prototype,"Extra prototype on Node options object is a code smell"),assert&&t&&(assert(t.rectWidth===void 0,"Should not specify rectWidth in multiple ways"),assert(t.rectHeight===void 0,"Should not specify rectHeight in multiple ways"),assert(t.rectBounds===void 0,"Should not specify rectBounds in multiple ways")),d=combineOptions(d,{rectBounds:e},t)):(assert&&assert(arguments.length===3||arguments.length===4,"new Rectangle( bounds, cornerXRadius, cornerYRadius, { ... } ) should only take three or four arguments"),assert&&assert(r===void 0||typeof r=="object","new Rectangle( bounds, cornerXRadius, cornerYRadius, { ... } ) fourth parameter should only ever be an options object"),assert&&assert(r===void 0||Object.getPrototypeOf(r)===Object.prototype,"Extra prototype on Node options object is a code smell"),assert&&r&&(assert(r.rectWidth===void 0,"Should not specify rectWidth in multiple ways"),assert(r.rectHeight===void 0,"Should not specify rectHeight in multiple ways"),assert(r.rectBounds===void 0,"Should not specify rectBounds in multiple ways"),assert(r.cornerXRadius===void 0,"Should not specify cornerXRadius in multiple ways"),assert(r.cornerYRadius===void 0,"Should not specify cornerYRadius in multiple ways"),assert(r.cornerRadius===void 0,"Should not specify cornerRadius in multiple ways")),d=combineOptions(d,{rectBounds:e,cornerXRadius:t,cornerYRadius:n},r)):d=combineOptions(d,e):a===void 0?(assert&&assert(arguments.length===4||arguments.length===5,"new Rectangle( x, y, width, height, { ... } ) should only take four or five arguments"),assert&&assert(s===void 0||typeof s=="object","new Rectangle( x, y, width, height, { ... } ) fifth parameter should only ever be an options object"),assert&&assert(s===void 0||Object.getPrototypeOf(s)===Object.prototype,"Extra prototype on Node options object is a code smell"),assert&&s&&(assert(s.rectX===void 0,"Should not specify rectX in multiple ways"),assert(s.rectY===void 0,"Should not specify rectY in multiple ways"),assert(s.rectWidth===void 0,"Should not specify rectWidth in multiple ways"),assert(s.rectHeight===void 0,"Should not specify rectHeight in multiple ways"),assert(s.rectBounds===void 0,"Should not specify rectBounds in multiple ways")),d=combineOptions(d,{rectX:e,rectY:t,rectWidth:n,rectHeight:r},s)):(assert&&assert(arguments.length===6||arguments.length===7,"new Rectangle( x, y, width, height, cornerXRadius, cornerYRadius{ ... } ) should only take six or seven arguments"),assert&&assert(d===void 0||typeof d=="object","new Rectangle( x, y, width, height, cornerXRadius, cornerYRadius{ ... } ) seventh parameter should only ever be an options object"),assert&&assert(d===void 0||Object.getPrototypeOf(d)===Object.prototype,"Extra prototype on Node options object is a code smell"),assert&&h&&(assert(h.rectX===void 0,"Should not specify rectX in multiple ways"),assert(h.rectY===void 0,"Should not specify rectY in multiple ways"),assert(h.rectWidth===void 0,"Should not specify rectWidth in multiple ways"),assert(h.rectHeight===void 0,"Should not specify rectHeight in multiple ways"),assert(h.rectBounds===void 0,"Should not specify rectBounds in multiple ways"),assert(h.cornerXRadius===void 0,"Should not specify cornerXRadius in multiple ways"),assert(h.cornerYRadius===void 0,"Should not specify cornerYRadius in multiple ways"),assert(h.cornerRadius===void 0,"Should not specify cornerRadius in multiple ways")),d=combineOptions(d,{rectX:e,rectY:t,rectWidth:n,rectHeight:r,cornerXRadius:s,cornerYRadius:a},h)),this.localPreferredWidthProperty.lazyLink(this.updatePreferredSizes.bind(this)),this.localPreferredHeightProperty.lazyLink(this.updatePreferredSizes.bind(this)),this.localMinimumWidthProperty.lazyLink(this.updatePreferredSizes.bind(this)),this.localMinimumHeightProperty.lazyLink(this.updatePreferredSizes.bind(this)),this.mutate(d)}getMaximumArcSize(){return Math.min(this._rectWidth/2,this._rectHeight/2)}getStrokeRendererBitmask(){let e=super.getStrokeRendererBitmask();const t=this.getStroke();return t&&!(t instanceof Gradient)&&!(t instanceof Pattern)&&!this.hasLineDash()&&(this.getLineJoin()==="miter"||this.getLineJoin()==="round"&&Features.borderRadius)&&(e|=Renderer.bitmaskDOM),this.hasStroke()||(e|=Renderer.bitmaskWebGL),e}getPathRendererBitmask(){let e=Renderer.bitmaskCanvas|Renderer.bitmaskSVG;const t=this.getMaximumArcSize();return(!this.hasStroke()||this.getLineWidth()<=this._rectHeight&&this.getLineWidth()<=this._rectWidth)&&(!this.isRounded()||Features.borderRadius&&this._cornerXRadius===this._cornerYRadius)&&this._cornerYRadius<=t&&this._cornerXRadius<=t&&(e|=Renderer.bitmaskDOM),!this.hasStroke()&&!this.isRounded()&&(e|=Renderer.bitmaskWebGL),e}setRect(e,t,n,r,s,a){const h=s!==void 0,c=a!==void 0;if(assert&&assert(isFinite(e)&&isFinite(t)&&isFinite(n)&&isFinite(r),"x/y/width/height should be finite numbers"),assert&&assert(!h||isFinite(s)&&(!c||isFinite(a)),"Corner radii (if provided) should be finite numbers"),this._rectX===e&&this._rectY===t&&this._rectWidth===n&&this._rectHeight===r&&(!h||this._cornerXRadius===s)&&(!c||this._cornerYRadius===a))return this;this._rectX=e,this._rectY=t,this._rectWidth=n,this._rectHeight=r,this._cornerXRadius=h?s:this._cornerXRadius,this._cornerYRadius=c?a:this._cornerYRadius;const d=this._drawables.length;for(let y=0;y<d;y++)this._drawables[y].markDirtyRectangle();return this.invalidateRectangle(),this}setRectX(e){if(assert&&assert(isFinite(e),"rectX should be a finite number"),this._rectX!==e){this._rectX=e;const t=this._drawables.length;for(let n=0;n<t;n++)this._drawables[n].markDirtyX();this.invalidateRectangle()}return this}set rectX(e){this.setRectX(e)}get rectX(){return this.getRectX()}getRectX(){return this._rectX}setRectY(e){if(assert&&assert(isFinite(e),"rectY should be a finite number"),this._rectY!==e){this._rectY=e;const t=this._drawables.length;for(let n=0;n<t;n++)this._drawables[n].markDirtyY();this.invalidateRectangle()}return this}set rectY(e){this.setRectY(e)}get rectY(){return this.getRectY()}getRectY(){return this._rectY}setRectWidth(e){if(assert&&assert(isFinite(e),"rectWidth should be a finite number"),this._rectWidth!==e){this._rectWidth=e;const t=this._drawables.length;for(let n=0;n<t;n++)this._drawables[n].markDirtyWidth();this.invalidateRectangle()}return this}set rectWidth(e){this.setRectWidth(e)}get rectWidth(){return this.getRectWidth()}getRectWidth(){return this._rectWidth}setRectHeight(e){if(assert&&assert(isFinite(e),"rectHeight should be a finite number"),this._rectHeight!==e){this._rectHeight=e;const t=this._drawables.length;for(let n=0;n<t;n++)this._drawables[n].markDirtyHeight();this.invalidateRectangle()}return this}set rectHeight(e){this.setRectHeight(e)}get rectHeight(){return this.getRectHeight()}getRectHeight(){return this._rectHeight}setCornerXRadius(e){if(assert&&assert(isFinite(e),"cornerXRadius should be a finite number"),this._cornerXRadius!==e){this._cornerXRadius=e;const t=this._drawables.length;for(let n=0;n<t;n++)this._drawables[n].markDirtyCornerXRadius();this.invalidateRectangle()}return this}set cornerXRadius(e){this.setCornerXRadius(e)}get cornerXRadius(){return this.getCornerXRadius()}getCornerXRadius(){return this._cornerXRadius}setCornerYRadius(e){if(assert&&assert(isFinite(e),"cornerYRadius should be a finite number"),this._cornerYRadius!==e){this._cornerYRadius=e;const t=this._drawables.length;for(let n=0;n<t;n++)this._drawables[n].markDirtyCornerYRadius();this.invalidateRectangle()}return this}set cornerYRadius(e){this.setCornerYRadius(e)}get cornerYRadius(){return this.getCornerYRadius()}getCornerYRadius(){return this._cornerYRadius}setRectBounds(e){return this.setRect(e.x,e.y,e.width,e.height),this}set rectBounds(e){this.setRectBounds(e)}get rectBounds(){return this.getRectBounds()}getRectBounds(){return Bounds2.rect(this._rectX,this._rectY,this._rectWidth,this._rectHeight)}setRectSize(e){return this.setRectWidth(e.width),this.setRectHeight(e.height),this}set rectSize(e){this.setRectSize(e)}get rectSize(){return this.getRectSize()}getRectSize(){return new Dimension2(this._rectWidth,this._rectHeight)}setRectWidthFromRight(e){if(this._rectWidth!==e){const t=this._rectX+this._rectWidth;this.setRectWidth(e),this.setRectX(t-e)}return this}set rectWidthFromRight(e){this.setRectWidthFromRight(e)}get rectWidthFromRight(){return this.getRectWidth()}setRectHeightFromBottom(e){if(this._rectHeight!==e){const t=this._rectY+this._rectHeight;this.setRectHeight(e),this.setRectY(t-e)}return this}set rectHeightFromBottom(e){this.setRectHeightFromBottom(e)}get rectHeightFromBottom(){return this.getRectHeight()}isRounded(){return this._cornerXRadius!==0&&this._cornerYRadius!==0}computeShapeBounds(){let e=new Bounds2(this._rectX,this._rectY,this._rectX+this._rectWidth,this._rectY+this._rectHeight);return this._stroke&&(e=e.dilated(this.getLineWidth()/2)),e}createRectangleShape(){if(this.isRounded()){const e=Math.min(this._rectWidth/2,this._rectHeight/2);return Shape$1.roundRectangle(this._rectX,this._rectY,this._rectWidth,this._rectHeight,Math.min(e,this._cornerXRadius),Math.min(e,this._cornerYRadius)).makeImmutable()}else return Shape$1.rectangle(this._rectX,this._rectY,this._rectWidth,this._rectHeight).makeImmutable()}invalidateRectangle(){assert&&assert(isFinite(this._rectX),`A rectangle needs to have a finite x (${this._rectX})`),assert&&assert(isFinite(this._rectY),`A rectangle needs to have a finite y (${this._rectY})`),assert&&assert(this._rectWidth>=0&&isFinite(this._rectWidth),`A rectangle needs to have a non-negative finite width (${this._rectWidth})`),assert&&assert(this._rectHeight>=0&&isFinite(this._rectHeight),`A rectangle needs to have a non-negative finite height (${this._rectHeight})`),assert&&assert(this._cornerXRadius>=0&&isFinite(this._cornerXRadius),`A rectangle needs to have a non-negative finite arcWidth (${this._cornerXRadius})`),assert&&assert(this._cornerYRadius>=0&&isFinite(this._cornerYRadius),`A rectangle needs to have a non-negative finite arcHeight (${this._cornerYRadius})`),this._shape=null,this.invalidatePath(),this.invalidateSupportedRenderers()}updatePreferredSizes(){let e=this.localPreferredWidth,t=this.localPreferredHeight;e!==null&&(e=Math.max(e,this.localMinimumWidth||0)),t!==null&&(t=Math.max(t,this.localMinimumHeight||0)),e!==null&&(this.rectWidth=this.hasStroke()?e-this.lineWidth:e),t!==null&&(this.rectHeight=this.hasStroke()?t-this.lineWidth:t)}invalidateStroke(){super.invalidateStroke(),this.updatePreferredSizes()}containsPointSelf(e){const t=this._rectX,n=this._rectY,r=this._rectWidth,s=this._rectHeight,a=this._cornerXRadius,h=this._cornerYRadius,c=this.getLineWidth()/2;let d=!0;if(this._strokePickable){const y=this.isRounded();if(!y&&this.getLineJoin()==="bevel")return super.containsPointSelf(e);const g=this.getLineJoin()==="miter"&&!y;d=d&&Rectangle.intersects(t-c,n-c,r+2*c,s+2*c,g?0:a+c,g?0:h+c,e)}return this._fillPickable?this._strokePickable?d:Rectangle.intersects(t,n,r,s,a,h,e):this._strokePickable?d&&!Rectangle.intersects(t+c,n+c,r-2*c,s-2*c,a-c,h-c,e):!1}intersectsBoundsSelf(e){return!this.computeShapeBounds().intersection(e).isEmpty()}canvasPaintSelf(e,t){RectangleCanvasDrawable$1.prototype.paintCanvas(e,this,t)}createDOMDrawable(e,t){return RectangleDOMDrawable$1.createFromPool(e,t)}createSVGDrawable(e,t){return RectangleSVGDrawable$1.createFromPool(e,t)}createCanvasDrawable(e,t){return RectangleCanvasDrawable$1.createFromPool(e,t)}createWebGLDrawable(e,t){return RectangleWebGLDrawable$1.createFromPool(e,t)}setShape(e){if(e!==null)throw new Error("Cannot set the shape of a Rectangle to something non-null");return this.invalidatePath(),this}getShape(){return this._shape||(this._shape=this.createRectangleShape()),this._shape}hasShape(){return!0}setShapeProperty(e){if(e!==null)throw new Error("Cannot set the shapeProperty of a Rectangle to something non-null, it handles this itself");return this}setCornerRadius(e){return this.setCornerXRadius(e),this.setCornerYRadius(e),this}set cornerRadius(e){this.setCornerRadius(e)}get cornerRadius(){return this.getCornerRadius()}getCornerRadius(){return assert&&assert(this._cornerXRadius===this._cornerYRadius,"getCornerRadius() invalid if x/y radii are different"),this._cornerXRadius}mutate(e){return super.mutate(e)}static intersects(e,t,n,r,s,a,h){const c=h.x>=e&&h.x<=e+n&&h.y>=t&&h.y<=t+r;if(!c||s<=0||a<=0)return c;const d=Math.min(n/2,r/2);s=Math.min(d,s),a=Math.min(d,a);let y,g,D=!1;if(h.x<e+n/2?(y=e+s,D=D||h.x>=y):(y=e+n-s,D=D||h.x<=y),D||(h.y<t+r/2?(g=t+a,D=D||h.y>=g):(g=t+r-a,D=D||h.y<=g),D))return!0;let O=h.x-y,V=h.y-g;return O/=s,V/=a,O*=O,V*=V,O+V<=1}static rect(e,t,n,r,s){return new Rectangle(e,t,n,r,0,0,s)}static roundedRect(e,t,n,r,s,a,h){return new Rectangle(e,t,n,r,s,a,h)}static bounds(e,t){return new Rectangle(e.minX,e.minY,e.width,e.height,t)}static roundedBounds(e,t,n,r){return new Rectangle(e.minX,e.minY,e.width,e.height,t,n,r)}static dimension(e,t){return new Rectangle(0,0,e.width,e.height,0,0,t)}}Rectangle.prototype._mutatorKeys=[...RECTANGLE_OPTION_KEYS,...SuperType$1.prototype._mutatorKeys];Rectangle.prototype.drawableMarkFlags=Path.prototype.drawableMarkFlags.concat(["x","y","width","height","cornerXRadius","cornerYRadius"]).filter(o=>o!=="shape");scenery.register("Rectangle",Rectangle);class Sprites extends Node$2{constructor(e){const t=optionize()({sprites:[],spriteInstances:[],hitTestSprites:!1,renderer:"webgl"},e);super(),this._sprites=t.sprites,this._spriteInstances=t.spriteInstances,this._hitTestSprites=t.hitTestSprites,this.setRendererBitmask(Renderer.bitmaskCanvas|Renderer.bitmaskWebGL),this.mutate(t)}setCanvasBounds(e){this.invalidateSelf(e)}set canvasBounds(e){this.setCanvasBounds(e)}get canvasBounds(){return this.getCanvasBounds()}getCanvasBounds(){return this.getSelfBounds()}canvasPaintSelf(e,t){SpritesCanvasDrawable$1.prototype.paintCanvas(e,this,t)}createCanvasDrawable(e,t){return SpritesCanvasDrawable$1.createFromPool(e,t)}createWebGLDrawable(e,t){return SpritesWebGLDrawable$1.createFromPool(e,t)}containsPointSelf(e){return super.containsPointSelf(e)?this._hitTestSprites?!!this.getSpriteInstanceFromPoint(e):!0:!1}getSpriteInstanceFromPoint(e){for(let t=this._spriteInstances.length-1;t>=0;t--)if(this._spriteInstances[t].containsPoint(e))return this._spriteInstances[t];return null}getSelfShape(){return this._hitTestSprites?Shape$1.union(this._spriteInstances.map(e=>e.getShape())):Shape$1.bounds(this.selfBounds)}isPainted(){return!0}invalidatePaint(){const e=this._drawables.length;for(let t=0;t<e;t++)this._drawables[t].markDirty()}mutate(e){return super.mutate(e)}}Sprites.prototype._mutatorKeys=["canvasBounds"].concat(Node$2.prototype._mutatorKeys);scenery.register("Sprites",Sprites);const WEBGL_NODE_OPTION_KEYS=["canvasBounds"],zs=class zs extends Node$2{constructor(e,t){super(t),this.setRendererBitmask(Renderer.bitmaskWebGL),this.painterType=e}setCanvasBounds(e){return this.invalidateSelf(e),this}set canvasBounds(e){this.setCanvasBounds(e)}get canvasBounds(){return this.getCanvasBounds()}getCanvasBounds(){return this.getSelfBounds()}isPainted(){return!0}invalidatePaint(){const e=this._drawables.length;for(let t=0;t<e;t++)this._drawables[t].markDirty()}containsPointSelf(e){return!1}getSelfShape(){return new Shape$1}canvasPaintSelf(e,t){assert&&assert(!1,"unimplemented: canvasPaintSelf in WebGLNode")}renderToCanvasSelf(e,t){const n=e.canvas.width,r=e.canvas.height,s=document.createElement("canvas");s.width=n,s.height=r;const a={antialias:!0,preserveDrawingBuffer:!0},h=s.getContext("webgl",a)||s.getContext("experimental-webgl",a);Utils.applyWebGLContextDefaults(h);const c=new Matrix3().rowMajor(2/n,0,-1,0,-2/r,1,0,0,1);h.viewport(0,0,n,r);const d=this.painterType,y=new d(h,this);y.paint(t,c),y.dispose(),c.freeToPool(),h.flush(),e.context.setTransform(1,0,0,1,0,0),e.context.drawImage(s,0,0),e.context.restore()}createWebGLDrawable(e,t){return WebGLNodeDrawable$1.createFromPool(e,t)}mutate(e){return super.mutate(e)}};zs.PAINTED_NOTHING=0,zs.PAINTED_SOMETHING=1;let WebGLNode=zs;WebGLNode.prototype._mutatorKeys=WEBGL_NODE_OPTION_KEYS.concat(Node$2.prototype._mutatorKeys);scenery.register("WebGLNode",WebGLNode);class Plane extends Rectangle{constructor(e){super(-2e3,-2e3,6e3,6e3,e)}}scenery.register("Plane",Plane);const Leaf=memoize(o=>class extends o{constructor(...t){super(...t)}insertChild(t,n){throw new Error("Attempt to insert child into Leaf")}removeChildWithIndex(t,n){throw new Error("Attempt to remove child from Leaf")}});scenery.register("Leaf",Leaf);class Spacer extends Leaf(Node$2){constructor(e,t,n){assert&&assert(isFinite(e),"width should be a finite number"),assert&&assert(isFinite(t),"height should be a finite number"),super(),this.localBounds=new Bounds2(0,0,e,t),this.mutate(n)}}scenery.register("Spacer",Spacer);class HStrut extends Spacer{constructor(e,t){super(e,0,t)}}scenery.register("HStrut",HStrut);class VStrut extends Spacer{constructor(e,t){super(0,e,t)}}scenery.register("VStrut",VStrut);let globalIdCounter$3=1;const scratchVector=new Vector2(0,0);class SpriteImage extends Imageable$1(Object){constructor(e,t,n){assert&&assert(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement);const r={hitTestPixels:!1,pickable:!0};isTReadOnlyProperty(e)?r.imageProperty=e:r.image=e;const s=optionize()(r,n);super(),this.id=globalIdCounter$3++,this.offset=t,this.pickable=s.pickable,this.shape=null,this.imageData=null,isTReadOnlyProperty(e)?this.imageProperty=e:this.image=e,mutate(this,Object.keys(Imageable$1.DEFAULT_OPTIONS),s)}get width(){return this.imageWidth}get height(){return this.imageHeight}getShape(){if(!this.pickable)return new Shape$1;if(!this.shape){if(this.hitTestPixels)if(this.ensureImageData(),this.imageData)this.shape=Imageable$1.hitTestDataToShape(this.imageData,this.width,this.height);else return new Shape$1;else if(this.width&&this.height)this.shape=Shape$1.rect(0,0,this.width,this.height);else return new Shape$1;this.shape=this.shape.transformed(Matrix3.translation(-this.offset.x,-this.offset.y))}return this.shape}ensureImageData(){!this.imageData&&this.width&&this.height&&(this.imageData=Imageable$1.getHitTestData(this.image,this.width,this.height))}containsPoint(e){if(!this.pickable)return!1;const t=this.width,n=this.height;if(!t&&!n)return!1;const r=scratchVector.set(e).add(this.offset);return r.x<0||r.y<0||r.x>t||r.y>n?!1:this.hitTestPixels?(this.ensureImageData(),this.imageData?Imageable$1.testHitTestData(this.imageData,t,n,r):!1):!0}}scenery.register("SpriteImage",SpriteImage);class Sprite{constructor(e){this.imageProperty=new Property(e)}getShape(){return this.imageProperty.value.getShape()}containsPoint(e){return this.imageProperty.value.containsPoint(e)}}scenery.register("Sprite",Sprite);class PaintObserver{constructor(e){this.primary=null,this.changeCallback=e,this.notifyChangeCallback=this.notifyChanged.bind(this),this.updateSecondaryListener=this.updateSecondary.bind(this),this.secondaryPropertyCountsMap={}}setPrimary(e){e!==this.primary&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] primary update"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.detachPrimary(this.primary),this.primary=e,this.attachPrimary(e),this.notifyChangeCallback(),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop())}clean(){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] clean"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.detachPrimary(this.primary),this.primary=null,sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}updateSecondary(e,t,n){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] secondary update"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();const r=this.secondaryPropertyCountsMap[n.id];assert&&assert(r>0,"We should always be removing at least one reference");for(let s=0;s<r;s++)this.attachSecondary(e);this.notifyChangeCallback(),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}attachPrimary(e){if(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] attachPrimary"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),isTReadOnlyProperty(e))sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] add Property listener"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.secondaryLazyLinkProperty(e),this.attachSecondary(e.get()),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop();else if(e instanceof Color)sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] Color changed to immutable"),e.setImmutable();else if(e instanceof Gradient){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] add Gradient listeners"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();for(let t=0;t<e.stops.length;t++)this.attachPrimary(e.stops[t].color);sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}detachPrimary(e){if(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] detachPrimary"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),isTReadOnlyProperty(e))sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] remove Property listener"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.secondaryUnlinkProperty(e),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop();else if(e instanceof Gradient){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] remove Gradient listeners"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();for(let t=0;t<e.stops.length;t++)this.detachPrimary(e.stops[t].color);sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}attachSecondary(e){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] attachSecondary"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),e instanceof Color&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] Color set to immutable"),e.setImmutable()),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}notifyChanged(){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] changed"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.primary instanceof Gradient&&this.primary.invalidateCanvasGradient(),this.changeCallback(),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}secondaryLazyLinkProperty(e){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[PaintObserver] secondaryLazyLinkProperty ${e._id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();const t=e.id;this.secondaryPropertyCountsMap[t]?this.secondaryPropertyCountsMap[t]++:(this.secondaryPropertyCountsMap[t]=1,e.lazyLink(this.updateSecondaryListener)),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}secondaryUnlinkProperty(e){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[PaintObserver] secondaryUnlinkProperty ${e._id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();const t=e.id,n=--this.secondaryPropertyCountsMap[t];assert&&assert(n>=0,"We should have had a reference before"),n===0&&(delete this.secondaryPropertyCountsMap[t],e.isDisposed||e.unlink(this.updateSecondaryListener)),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}}scenery.register("PaintObserver",PaintObserver);class PaintColorProperty extends Property{constructor(e,t){const n=PaintDef.toColor(e),r=optionize()({luminanceFactor:0,valueComparisonStrategy:"equalsFunction"},t);super(n,r),this._paint=null,this._luminanceFactor=r.luminanceFactor,this._changeListener=this.invalidatePaint.bind(this),this._paintObserver=new PaintObserver(this._changeListener),this.setPaint(e)}setPaint(e){assert&&assert(PaintDef.isPaintDef(e)),this._paint=e,this._paintObserver.setPrimary(e)}set paint(e){this.setPaint(e)}get paint(){return this.getPaint()}getPaint(){return this._paint}setLuminanceFactor(e){assert&&assert(e>=-1&&e<=1),this.luminanceFactor!==e&&(this._luminanceFactor=e,this.invalidatePaint())}set luminanceFactor(e){this.setLuminanceFactor(e)}get luminanceFactor(){return this.getLuminanceFactor()}getLuminanceFactor(){return this._luminanceFactor}invalidatePaint(){this.value=PaintDef.toColor(this._paint).colorUtilsBrightness(this._luminanceFactor)}dispose(){this.paint=null,super.dispose()}}scenery.register("PaintColorProperty",PaintColorProperty);class PaintSVGState{constructor(){this.initialize()}initialize(){this.svgBlock=null,this.fillStyle="none",this.strokeStyle="none",this.fillPaint=null,this.strokePaint=null,this.updateBaseStyle(),this.strokeDetailStyle=""}dispose(){this.releaseFillPaint(),this.releaseStrokePaint()}releaseFillPaint(){this.fillPaint&&(this.svgBlock.decrementPaint(this.fillPaint),this.fillPaint=null)}releaseStrokePaint(){this.strokePaint&&(this.svgBlock.decrementPaint(this.strokePaint),this.strokePaint=null)}updateFill(e,t){assert&&assert(this.svgBlock===e);const n=paintToSVGStyle(t,e);t!==this.fillPaint&&(this.releaseFillPaint(),t&&t.isPaint&&(this.fillPaint=t,e.incrementPaint(t))),n!==this.fillStyle&&(this.fillStyle=n,this.updateBaseStyle())}updateStroke(e,t){assert&&assert(this.svgBlock===e);const n=paintToSVGStyle(t,e);t!==this.strokePaint&&(this.releaseStrokePaint(),t&&t.isPaint&&(this.strokePaint=t,e.incrementPaint(t))),n!==this.strokeStyle&&(this.strokeStyle=n,this.updateBaseStyle())}updateBaseStyle(){this.baseStyle=`fill: ${this.fillStyle}; stroke: ${this.strokeStyle};`}updateStrokeDetailStyle(e){let t="";const n=e.getLineWidth();n!==1&&(t+=`stroke-width: ${n};`);const r=e.getLineCap();r!=="butt"&&(t+=`stroke-linecap: ${r};`);const s=e.getLineJoin();s!=="miter"&&(t+=`stroke-linejoin: ${s};`);const a=e.getMiterLimit();t+=`stroke-miterlimit: ${a};`,e.hasLineDash()&&(t+=`stroke-dasharray: ${e.getLineDash().join(",")};`,t+=`stroke-dashoffset: ${e.getLineDashOffset()};`),this.strokeDetailStyle=t}updateSVGBlock(e){const t=this.svgBlock;t&&(this.fillPaint&&t.decrementPaint(this.fillPaint),this.strokePaint&&t.decrementPaint(this.strokePaint)),this.svgBlock=e,this.fillPaint&&e.incrementPaint(this.fillPaint),this.strokePaint&&e.incrementPaint(this.strokePaint)}}function paintToSVGStyle(o,e){return o?o.toCSS?o.toCSS():o.isPaint?`url(#${o.id}-${e?e.id:"noblock"})`:o:"none"}scenery.register("PaintSVGState",PaintSVGState);const scratchColor$1=new Color("transparent"),cs=class cs{constructor(e,t,n){this.lastColor=null,this.initialize(e,t,n)}isActiveSVGGradientStop(){return!!this.svgGradient}initialize(e,t,n){return sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] initialize: ${e.gradient.id} : ${t}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.svgGradient=e,this.color=n,this.ratio=t,this.svgElement=this.svgElement||document.createElementNS(svgns,"stop"),this.svgElement.setAttribute("offset",""+t),this.dirty=!0,this.update(),this.propertyListener=this.propertyListener||this.onPropertyChange.bind(this),this.colorListener=this.colorListener||this.markDirty.bind(this),isTReadOnlyProperty(n)?(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] adding Property listener: ${this.svgGradient.gradient.id} : ${this.ratio}`),n.lazyLink(this.propertyListener),n.value instanceof Color&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] adding Color listener: ${this.svgGradient.gradient.id} : ${this.ratio}`),n.value.changeEmitter.addListener(this.colorListener),this.lastColor=n.value)):n instanceof Color&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] adding Color listener: ${this.svgGradient.gradient.id} : ${this.ratio}`),n.changeEmitter.addListener(this.colorListener)),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop(),this}onPropertyChange(e,t){assert&&assert(this.isActiveSVGGradientStop());const n=this;this.lastColor!==null&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] removing Color listener: ${n.svgGradient.gradient.id} : ${this.ratio}`),this.lastColor.changeEmitter.removeListener(this.colorListener),this.lastColor=null),e instanceof Color&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] adding Color listener: ${n.svgGradient.gradient.id} : ${this.ratio}`),e.changeEmitter.addListener(this.colorListener),this.lastColor=e),this.markDirty()}markDirty(){assert&&assert(this.isActiveSVGGradientStop()),this.dirty=!0,this.svgGradient.markDirty()}update(){if(!this.dirty)return;this.dirty=!1,assert&&assert(this.isActiveSVGGradientStop());const e=this;sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] update: ${e.svgGradient.gradient.id} : ${this.ratio}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();let t=this.color;isTReadOnlyProperty(t)&&(t=t.value),t===null&&(t="transparent"),typeof t=="string"?scratchColor$1.setCSS(t):scratchColor$1.set(t);const n=`stop-opacity: ${scratchColor$1.a.toFixed(20)};`;scratchColor$1.alpha=1;const r=`stop-color: ${scratchColor$1.toCSS()};`;this.svgElement.setAttribute("style",`${r} ${n}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}dispose(){assert&&assert(this.isActiveSVGGradientStop());const e=this;sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] dispose: ${e.svgGradient.gradient.id} : ${this.ratio}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();const t=this.color;this.lastColor&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] removing Color listener: ${e.svgGradient.gradient.id} : ${this.ratio}`),this.lastColor.changeEmitter.removeListener(this.colorListener),this.lastColor=null),isTReadOnlyProperty(t)?(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] removing Property listener: ${e.svgGradient.gradient.id} : ${this.ratio}`),t.hasListener(this.propertyListener)&&t.unlink(this.propertyListener)):t instanceof Color&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] removing Color listener: ${e.svgGradient.gradient.id} : ${this.ratio}`),t.changeEmitter.removeListener(this.colorListener)),this.color=null,this.svgGradient=null,this.freeToPool(),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}freeToPool(){cs.pool.freeToPool(this)}};cs.pool=new Pool(cs);let SVGGradientStop=cs;scenery.register("SVGGradientStop",SVGGradientStop);class SVGGradient{constructor(e,t){this.initialize(e,t)}isActiveSVGGradient(){return!!this.svgBlock}initialize(e,t){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradient] initialize ${t.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.svgBlock=e,this.gradient=t;const n=this.definition!==void 0;this.definition=this.definition||this.createDefinition(),n||this.definition.setAttribute("gradientUnits","userSpaceOnUse"),t.transformMatrix?this.definition.setAttribute("gradientTransform",t.transformMatrix.getSVGTransform()):this.definition.removeAttribute("gradientTransform");const r=t.getSVGStops();this.stops=cleanArray(this.stops);for(let s=0;s<r.length;s++){const a=new SVGGradientStop(this,r[s].ratio,r[s].color);this.stops.push(a),this.definition.appendChild(a.svgElement)}this.dirty=!1,sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}markDirty(){if(!this.dirty){assert&&assert(this.isActiveSVGGradient());const e=this;sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradient] switched to dirty: ${this.gradient.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.dirty=!0,e.svgBlock.markDirtyGradient(this),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}}update(){if(this.dirty){this.dirty=!1,sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradient] update: ${this.gradient.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();for(let e=0;e<this.stops.length;e++)this.stops[e].update();sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}}dispose(){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradient] dispose ${this.gradient.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();for(let e=0;e<this.stops.length;e++){const t=this.stops[e];this.definition.removeChild(t.svgElement),t.dispose()}cleanArray(this.stops),this.svgBlock=null,this.gradient=null,this.freeToPool(),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}}scenery.register("SVGGradient",SVGGradient);const ds=class ds extends SVGGradient{constructor(e,t){super(e,t)}initialize(e,t){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGLinearGradient] initialize ${t.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),super.initialize(e,t);const n=t;return this.definition.setAttribute("x1",""+n.start.x),this.definition.setAttribute("y1",""+n.start.y),this.definition.setAttribute("x2",""+n.end.x),this.definition.setAttribute("y2",""+n.end.y),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop(),this}createDefinition(){return document.createElementNS(svgns,"linearGradient")}freeToPool(){ds.pool.freeToPool(this)}};ds.pool=new Pool(ds);let SVGLinearGradient=ds;scenery.register("SVGLinearGradient",SVGLinearGradient);const us=class us extends SVGGradient{constructor(e,t){super(e,t)}initialize(e,t){return sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGRadialGradient] initialize ${t.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),super.initialize(e,t),this.definition.setAttribute("cx",""+t.largePoint.x),this.definition.setAttribute("cy",""+t.largePoint.y),this.definition.setAttribute("r",""+t.maxRadius),this.definition.setAttribute("fx",""+t.focalPoint.x),this.definition.setAttribute("fy",""+t.focalPoint.y),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop(),this}createDefinition(){return document.createElementNS(svgns,"radialGradient")}freeToPool(){us.pool.freeToPool(this)}};us.pool=new Pool(us);let SVGRadialGradient=us;scenery.register("SVGRadialGradient",SVGRadialGradient);const ps=class ps{constructor(e){this.initialize(e)}initialize(e){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGPattern] initialize: ${e.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();const t=this.definition!==void 0;return this.definition=this.definition||document.createElementNS(svgns,"pattern"),t||(this.definition.setAttribute("patternUnits","userSpaceOnUse"),this.definition.setAttribute("patternContentUnits","userSpaceOnUse")),e.transformMatrix?this.definition.setAttribute("patternTransform",e.transformMatrix.getSVGTransform()):this.definition.removeAttribute("patternTransform"),this.definition.setAttribute("x","0"),this.definition.setAttribute("y","0"),this.definition.setAttribute("width",""+e.image.width),this.definition.setAttribute("height",""+e.image.height),this.imageElement=this.imageElement||document.createElementNS(svgns,"image"),this.imageElement.setAttribute("x","0"),this.imageElement.setAttribute("y","0"),this.imageElement.setAttribute("width",`${e.image.width}px`),this.imageElement.setAttribute("height",`${e.image.height}px`),this.imageElement.setAttributeNS(xlinkns,"xlink:href",e.image.src),t||this.definition.appendChild(this.imageElement),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop(),this}update(){}dispose(){this.freeToPool()}freeToPool(){ps.pool.freeToPool(this)}};ps.pool=new Pool(ps);let SVGPattern=ps;scenery.register("SVGPattern",SVGPattern);class TransformTracker{constructor(e,t){this._matrices=null,this._dirtyIndex=0,this._listeners=[],this._nodeTransformListeners=[];const n=optionize()({isStatic:!1},t);this._isStatic=n.isStatic,this.trail=e,this._nodeTransformListeners=[];for(let r=1;r<this.trail.length;r++){const s=(a=>()=>{this.onTransformChange(a)})(r-1);this._nodeTransformListeners.push(s),e.nodes[r].transformEmitter.addListener(s)}}dispose(){for(let e=1;e<this.trail.length;e++){const t=this._nodeTransformListeners[e-1];this.trail.nodes[e].transformEmitter.hasListener(t)&&this.trail.nodes[e].transformEmitter.removeListener(t)}}addListener(e){this._listeners.push(e)}removeListener(e){const t=_.indexOf(this._listeners,e);assert&&assert(t>=0,"TransformTracker listener not found"),this._listeners.splice(t,1)}notifyListeners(){let e=this._listeners;this._isStatic||(e=e.slice());const t=e.length;for(let n=0;n<t;n++)e[n]()}onTransformChange(e){this._dirtyIndex=Math.min(this._dirtyIndex,e),this.notifyListeners()}getMatrix(){if(this._matrices===null){this._matrices=[];for(let t=1;t<this.trail.length;t++)this._matrices.push(new Matrix3)}if(this._matrices.length<=0)return Matrix3.IDENTITY;const e=this._matrices.length;for(let t=this._dirtyIndex;t<e;t++){const n=this.trail.nodes[t+1].matrix;t===0?this._matrices[t].set(n):(this._matrices[t].set(this._matrices[t-1]),this._matrices[t].multiplyMatrix(n))}return this._dirtyIndex=e,this._matrices[e-1]}get matrix(){return this.getMatrix()}}scenery.register("TransformTracker",TransformTracker);const TransformTracker$1=TransformTracker;class TrailVisibilityTracker{constructor(e,t){t=merge({isStatic:!1},t),this.isStatic=t.isStatic,this.trail=e,this._listeners=[],this.trailVisibleProperty=new TinyProperty(this.trail.isVisible()),this._nodeVisibilityListeners=[];for(let n=0;n<this.trail.length;n++){const r=()=>{this.trailVisibleProperty.set(e.isVisible())};this._nodeVisibilityListeners.push(r),e.nodes[n].visibleProperty.link(r)}this.boundTrailVisibilityChangedListener=this.onVisibilityChange.bind(this),this.trailVisibleProperty.link(this.boundTrailVisibilityChangedListener)}addListener(e){assert&&assert(typeof e=="function"),this._listeners.push(e)}removeListener(e){assert&&assert(typeof e=="function");const t=_.indexOf(this._listeners,e);assert&&assert(t>=0,"TrailVisibilityTracker listener not found"),this._listeners.splice(t,1)}dispose(){for(let e=0;e<this.trail.length;e++){const t=this._nodeVisibilityListeners[e];this.trail.nodes[e].visibleProperty.hasListener(t)&&this.trail.nodes[e].visibleProperty.removeListener(t)}this.trailVisibleProperty.unlink(this.boundTrailVisibilityChangedListener)}onVisibilityChange(){this.notifyListeners()}notifyListeners(){let e=this._listeners;this._isStatic||(e=e.slice());const t=e.length;for(let n=0;n<t;n++)e[n]()}}scenery.register("TrailVisibilityTracker",TrailVisibilityTracker);const AriaHasPopUpMutator={mutateNode(o,e){e?o.setPDOMAttribute("aria-haspopup",e):(assert&&assert(o.hasPDOMAttribute("aria-haspopup"),"Set aria-haspopup once before removing it."),o.removePDOMAttribute("aria-haspopup")),o.positionInPDOM=!!e}};scenery.register("AriaHasPopUpMutator",AriaHasPopUpMutator);class FocusableHeadingNode extends Node$2{constructor(e){const t=optionize()({headingLevel:1},e);super(t),this.tagName=`h${t.headingLevel}`,this.focusHighlight="invisible";const n={blur:()=>{this.focusable=!1}};this.addInputListener(n),this.disposeFocusableHeadingNode=()=>{this.removeInputListener(n)}}focus(){this.focusable=!0,super.focus()}dispose(){this.disposeFocusableHeadingNode(),super.dispose()}}scenery.register("FocusableHeadingNode",FocusableHeadingNode);const SPACE=" ",END_OF_DOCUMENT="End of Document",COMMA=",",LINE_WORD_LENGTH=15,NEXT="NEXT",PREVIOUS="PREVIOUS";class Cursor{constructor(e){const t=this;this.outputUtteranceProperty=new Property(new Utterance$1(document.title,"off")),this.linearDOM=this.getLinearDOMElements(e),this.activeElement=null,this.activeLine=null,this.letterPosition=0,this.positionInLine=0,this.wordPosition=0,this.observers=[],this.keyState={},document.addEventListener("keydown",n=>{this.keyState[n.keyCode]=!0;let r;const a=n.shiftKey?PREVIOUS:NEXT;if(this.linearDOM=this.getLinearDOMElements(e),this.updateLiveElementList(),!(this.activeElement&&this.activeElement.getAttribute("role")==="application")){if(this.keyState[40]&&!this.keyState[45])r=this.readNextPreviousLine(NEXT);else if(this.keyState[38]&&!this.keyState[45])r=this.readNextPreviousLine(PREVIOUS);else if(this.keyState[72]){const h=["H1","H2","H3","H4","H5","H6"];r=this.readNextPreviousHeading(h,a)}else this.keyState[9]||(this.keyState[39]&&!this.keyState[17]?r=this.readNextPreviousCharacter(NEXT):this.keyState[37]&&!this.keyState[17]?r=this.readNextPreviousCharacter(PREVIOUS):this.keyState[37]&&this.keyState[17]?r=this.readNextPreviousWord(PREVIOUS):this.keyState[39]&&this.keyState[17]?r=this.readNextPreviousWord(NEXT):this.keyState[45]&&this.keyState[38]?r=this.readActiveLine():this.keyState[49]?r=this.readNextPreviousHeading(["H1"],a):this.keyState[50]?r=this.readNextPreviousHeading(["H2"],a):this.keyState[51]?r=this.readNextPreviousHeading(["H3"],a):this.keyState[52]?r=this.readNextPreviousHeading(["H4"],a):this.keyState[53]?r=this.readNextPreviousHeading(["H5"],a):this.keyState[54]?r=this.readNextPreviousHeading(["H6"],a):this.keyState[70]?r=this.readNextPreviousFormElement(a):this.keyState[66]?r=this.readNextPreviousButton(a):this.keyState[76]?r=this.readNextPreviousList(a):this.keyState[73]?r=this.readNextPreviousListItem(a):this.keyState[45]&&this.keyState[40]&&this.readEntireDocument());this.activeElement&&this.isFocusable(this.activeElement)&&this.activeElement.focus(),r===SPACE&&(r="space"),r&&this.outputUtteranceProperty.set(new Utterance$1(r,"off"))}}),document.addEventListener("keyup",n=>{this.keyState[n.keyCode]=!1}),document.addEventListener("focusin",function(n){if(n.target!==t.activeElement){t.activeElement=n.target;const s=t.getAccessibleText(this.activeElement,!0);if(s){const a=t.activeElement.getAttribute("aria-live");t.outputUtteranceProperty.set(new Utterance$1(s,a))}}})}getLinearDOMElements(e){const t=e.getElementsByTagName("*"),n=[];for(let r=0;r<t.length;r++)t[r].nodeType===Node.ELEMENT_NODE&&(n[r]=t[r]);return n}getLiveRole(e){let t=null;return["log","status","alert","progressbar","marquee","timer","assertive","polite"].forEach(r=>{(e.getAttribute("aria-live")===r||e.getAttribute("role")===r)&&(t=r)}),t}getNextPreviousElement(e){this.activeElement||(this.activeElement=this.linearDOM[0]);const t=e==="NEXT"?1:-1,r=this.linearDOM.indexOf(this.activeElement)+t;return this.linearDOM[r]}getLabel(e){const t=document.getElementsByTagName("label");let n;return Array.prototype.forEach.call(t,r=>{r.getAttribute("for")&&(n=r)}),assert&&assert(n,"No label found for id"),n}getAccessibleText(e,t){let n="";if(!e)return END_OF_DOCUMENT;if(e.getAttribute("class")==="ScreenView"||e.tagName==="HEADER"||e.tagName==="SECTION"||e.tagName==="LABEL")return null;let r=e;for(;r.parentElement;){if(r.getAttribute("aria-hidden")||r.hidden)return null;r=r.parentElement}if(e.tagName==="P"&&(n+=e.textContent),e.tagName==="H1"&&(n+=`Heading Level 1, ${e.textContent}`),e.tagName==="H2"&&(n+=`Heading Level 2, ${e.textContent}`),e.tagName==="H3"&&(n+=`Heading Level 3, ${e.textContent}`),e.tagName==="UL"){const s=e.children.length;n+=`List with ${s} items`}if(e.tagName==="LI"&&(n+=`List Item: ${e.textContent}`),e.tagName==="BUTTON"){const s=" Button";if(e.getAttribute("aria-pressed")){let a=" toggle";const h=" pressed",c=" not";a+=s+COMMA,e.getAttribute("aria-pressed")==="true"?a+=h:a+=c+h,n+=e.textContent+COMMA+a}else n+=e.textContent+s}if(e.tagName==="INPUT"&&(e.type==="reset"&&(n+=`${e.getAttribute("value")} Button`),e.type==="checkbox")){const a=this.getLabel(e.id).textContent;if(e.getAttribute("role")==="switch"){const h=e.getAttribute("aria-checked");if(h){const c=h==="true"?"On":"Off";n+=`${a+COMMA+SPACE}switch${COMMA}${SPACE}${c}`}else assert&&assert(!1,"checkbox switch must have aria-checked attribute")}else{const h=e.checked?" Checked":" Not Checked";n+=`${e.textContent} Checkbox${h}`}}if(t){n.length>0&&(n+=COMMA);const s=e.getAttribute("aria-label");s&&(n+=SPACE+s+COMMA);const a=e.getAttribute("aria-labelledBy");if(a){const y=document.getElementById(a).textContent;n+=SPACE+y+COMMA}r=e;let h;for(;r.parentElement;)if(h=r.getAttribute("role"),h==="document"||h==="application"){n+=SPACE+h+COMMA;break}else r=r.parentElement;e.getAttribute("role")&&(h=e.getAttribute("role"),h==="button"&&(n+=`${SPACE}Button`)),e.draggable&&(n+=`${SPACE}draggable${COMMA}`),e.getAttribute("aria-grabbed")==="true"&&(n+=`${SPACE}grabbed${COMMA}`);const c=e.getAttribute("aria-describedby");if(c){const d=c.split(SPACE);let y,g;d.forEach(D=>{y=document.getElementById(D),g=y.textContent,n+=SPACE+g})}}return n[n.length-1]===","&&(n=n.slice(0,-1)),n}getNextPreviousElementWithPDOMContent(e){let t;for(;!t;)this.activeElement=this.getNextPreviousElement(e),t=this.getAccessibleText(this.activeElement,!1);return this.activeElement}getNextPreviousElementWithRole(e,t){let n=null;const r=t===NEXT?1:-1;this.activeElement||(this.activeElement=this.linearDOM[0]);let s=this.linearDOM.indexOf(this.activeElement)+r;for(;this.linearDOM[s];){for(let a=0;a<e.length;a++){const h=this.linearDOM[s].tagName,c=this.linearDOM[s].type,d=this.linearDOM[s].getAttribute("role"),y=e[a];if(h===y||d===y||c===y){n=this.linearDOM[s];break}}if(n)break;s+=r}return n}readNextPreviousLine(e){let t="";this.letterPosition=0,this.wordPosition=0,this.activeElement||(this.activeElement=this.getNextPreviousElementWithPDOMContent(e));let n=this.getAccessibleText(this.activeElement,!1).split(SPACE);if(e===PREVIOUS&&(this.positionInLine=this.positionInLine-2*LINE_WORD_LENGTH),!n[this.positionInLine]){this.positionInLine=0;const s=this.activeElement;this.activeElement=this.getNextPreviousElementWithPDOMContent(e),n=this.getAccessibleText(this.activeElement,!1).split(" "),this.activeElement||(this.activeElement=s)}const r=this.positionInLine+LINE_WORD_LENGTH;for(let s=this.positionInLine;s<r;s++)if(n[s])if(t+=n[s],this.positionInLine+=1,n[s+1])t+=SPACE;else{this.positionInLine+=LINE_WORD_LENGTH-this.positionInLine%LINE_WORD_LENGTH;break}return this.activeLine=t,t}readActiveLine(){let e="";this.activeLine||(this.activeLine=this.readNextPreviousLine(NEXT));const t=this.activeLine.split(SPACE);for(let n=0;n<LINE_WORD_LENGTH;n++)if(t[n])if(e+=t[n],t[n+1])e+=SPACE;else break;return e}readNextPreviousWord(e){this.activeLine||(this.activeLine=this.readNextPreviousLine(e));const t=this.activeLine.split(SPACE);let n,r;e===NEXT?(r=t.length,n=1):e===PREVIOUS&&(r=0,n=-2),this.wordPosition===r&&(this.activeLine=this.readNextPreviousLine(e));const s=t[this.wordPosition];return this.wordPosition+=n,s}readNextPreviousHeading(e,t){let n,r,s;for(;!n;)s=this.activeElement,r=this.getNextPreviousElementWithRole(e,t),this.activeElement=r,n=this.getAccessibleText(r);if(!r){this.activeElement=s;const a=t===NEXT?"more":"previous";if(e.length===1){const h=`No ${a} headings at `,c=e[0];return h+(c==="H1"?"Level 1":c==="H2"?"Level 2":c==="H3"?"Level 3":c==="H4"?"Level 4":c==="H5"?"Level 5":"Level 6")}return`No ${a} headings`}return this.activeElement=r,n}readNextPreviousButton(e){const t=["button","BUTTON","submit","reset"];let n,r,s;for(;!r;)s=this.activeElement,n=this.getNextPreviousElementWithRole(t,e),this.activeElement=n,r=this.getAccessibleText(n,!0);return n?(this.activeElement=n,r):(this.activeElement=s,`No ${e===NEXT?"more":"previous"} buttons`)}readNextPreviousFormElement(e){const t=["INPUT","BUTTON"],n=["button"],r=t.concat(n);let s,a,h;for(;!a;)h=this.activeElement,s=this.getNextPreviousElementWithRole(r,e),this.activeElement=s,a=this.getAccessibleText(s,!0);return a===END_OF_DOCUMENT?(this.activeElement=h,`No ${e===NEXT?"next":"previous"} form field`):(this.activeElement=s,a)}readNextPreviousListItem(e){this.activeElement||(this.activeElement=this.getNextPreviousElementWithPDOMContent(e));let t;const n=this.activeElement.parentElement;if(n.tagName==="UL"||n.tagName==="OL"){const r=e===NEXT?1:-1;let s=Array.prototype.indexOf.call(n.children,this.activeElement)+r;for(;n.children[s];){if(t=this.getAccessibleText(n.children[s]),t){this.activeElement=n.children[s];break}s+=r}t||(t=this.readNextPreviousList(e))}else t=this.readNextPreviousList(e);return t||`No ${e===NEXT?"more":"previous"} list items`}readNextPreviousList(e){this.activeElement||(this.activeElement=this.getNextPreviousElementWithPDOMContent(e));const t=this.activeElement.parentElement;let n;(t.tagName==="UL"||t.tagName==="OL")&&(n=this.activeElement,this.activeElement=t);const r=this.getNextPreviousElementWithRole(["UL","OL"],e);if(!r)return n&&(this.activeElement=n),`No ${e===NEXT?"more":"previous"} lists`;const s=this.getAccessibleText(r);let a="";const h=r.children[0];return h&&(a=this.getAccessibleText(h),this.activeElement=h),`${s}, ${a}`}readNextPreviousCharacter(e){this.activeLine||(this.activeLine=this.readNextPreviousLine(NEXT));let t,n,r;e===NEXT?(t=this.activeLine.length,n=1,r=0):e===PREVIOUS&&(t=2,n=-1,r=-2),this.letterPosition===t&&(this.activeLine=this.readNextPreviousLine(e),this.letterPosition=this.activeLine.length);const s=this.activeLine[this.letterPosition+r];return this.letterPosition+=n,s}updateLiveElementList(){for(let e=0;e<this.observers.length;e++)this.observers[e]&&this.observers[e].disconnect();this.observers=[];for(let e=0;e<this.linearDOM.length;e++){const t=this.linearDOM[e];if(this.getLiveRole(t)){const r=h=>{h.forEach(c=>{let d,y=c.target;for(;!d;)d=this.getLiveRole(y),y=y.parentElement;if(c.addedNodes[0]){const g=c.addedNodes[0].data;this.outputUtteranceProperty.set(new Utterance$1(g,d))}})},s=new MutationObserver(h=>{r(h)}),a={childList:!0,subtree:!0};s.observe(t,a),this.observers.push(s)}}}readEntireDocument(){const e="polite";let t=this.getAccessibleText(this.activeElement),n=this.activeElement;for(;t!==END_OF_DOCUMENT;)n=this.activeElement,t=this.readNextPreviousLine(NEXT),t===END_OF_DOCUMENT&&(this.activeElement=n),this.outputUtteranceProperty.set(new Utterance$1(t,e))}isFocusable(e){const t=["tabindex","BUTTON","INPUT"];let n=!1;return t.forEach(r=>{(e.getAttribute(r)||e.tagName===r)&&(n=!0)}),n}}scenery.register("Cursor",Cursor);let Utterance$1=class{constructor(e,t){this.text=e,this.liveRole=t}};class Reader{constructor(e){this.speakingStartedEmitter=new Emitter({parameters:[{valueType:Object}]}),this.speakingEndedEmitter=new Emitter({parameters:[{valueType:Object}]}),this.speaking=!1,this.politeUtterances=[];const t=navigator.userAgent,n=t.match(/Windows/),r=!!(t.match(/Version\/[5-9]\./)&&t.match(/Safari\//)&&t.match(/AppleWebKit/));window.speechSynthesis&&SpeechSynthesisUtterance&&window.speechSynthesis.speak?(this.synth=window.speechSynthesis,e.outputUtteranceProperty.link(s=>{const a=new SpeechSynthesisUtterance(s.text);a.addEventListener("start",c=>{this.speakingStartedEmitter.emit(s)}),a.addEventListener("end",c=>{this.speakingEndedEmitter.emit(s)});let h;if(this.synth.getVoices().forEach(c=>{c.default&&(h=c)}),a.voice=h,a.rate=1.2,s.liveRole==="assertive"||s.liveRole==="off"||!s.liveRole)this.politeUtterances=[],this.speaking=!0,n?(this.synth.pause(),this.synth.cancel(),this.synth.speak(a),this.synth.resume()):(this.synth.cancel(),this.synth.speak(a));else if(s.liveRole==="polite")if(r){this.politeUtterances.push(a);const c=()=>{this.speaking=!0;const d=this.politeUtterances.shift();d?this.synth.speak(d):this.speaking=!1};if(this.speaking)setTimeout(()=>{c()},2e3);else{this.synth.speak(a);const d=this.politeUtterances.indexOf(a);d>0&&this.politeUtterances.splice(d,1)}}else this.synth.speak(a)})):e.outputUtteranceProperty.link(()=>{this.speakingStartedEmitter.emit({text:"Sorry! Web Speech API not supported on this platform."})})}}scenery.register("Reader",Reader);const EMPTY_ARRAY=[],PHET_IO_STATE_DEFAULT=!1,gs=class gs extends PhetioDataHandler{constructor(e,t){var r;const n=optionize()({parameters:EMPTY_ARRAY,phetioOuterType:gs.PhetioActionIO,phetioState:PHET_IO_STATE_DEFAULT,phetioReadOnly:PhetioObject.DEFAULT_OPTIONS.phetioReadOnly,phetioHighFrequency:PhetioObject.DEFAULT_OPTIONS.phetioHighFrequency,phetioEventType:PhetioObject.DEFAULT_OPTIONS.phetioEventType,phetioDocumentation:"A class that wraps a function, adding API to execute that function and data stream capture."},t);super(n),this.action=e,this.isExecutingCount=0,this.disposeOnExecuteCompletion=!1,this.executedEmitter=new Emitter({parameters:n.parameters,tandem:(r=n.tandem)==null?void 0:r.createTandem("executedEmitter"),hasListenerOrderDependencies:n.hasListenerOrderDependencies,phetioState:n.phetioState,phetioReadOnly:n.phetioReadOnly,phetioHighFrequency:n.phetioHighFrequency,phetioEventType:n.phetioEventType,phetioDocumentation:"Emitter that emits when this actions work is complete"}),this.disposePhetioAction=()=>{this.executedEmitter.dispose()}}execute(...e){assert&&assert(!this.isDisposed,"should not be called if disposed"),assert&&assert(!this.executedEmitter.isDisposed,"self should not be disposed"),this.isExecutingCount++,assert&&super.validateArguments(...e),Tandem.PHET_IO_ENABLED&&this.isPhetioInstrumented()&&this.phetioStartEvent("executed",{data:this.getPhetioData(...e)}),this.action.apply(null,e),this.executedEmitter.emit(...e),Tandem.PHET_IO_ENABLED&&this.isPhetioInstrumented()&&this.phetioEndEvent(),this.isExecutingCount--,this.disposeOnExecuteCompletion&&this.isExecutingCount===0&&(this.disposePhetioAction(),this.disposeOnExecuteCompletion=!1)}dispose(){this.isExecutingCount>0?this.disposeOnExecuteCompletion=!0:this.disposePhetioAction(),super.dispose()}};gs.PhetioActionIO=e=>{const t=e.map(getTypeName).join(",");return cache.has(t)||cache.set(t,new IOType(`PhetioActionIO<${e.map(getTypeName).join(", ")}>`,{valueType:gs,documentation:"Executes when an event occurs",events:["executed"],parameterTypes:e,metadataDefaults:{phetioState:PHET_IO_STATE_DEFAULT},methods:{execute:{returnType:VoidIO,parameterTypes:e,implementation:function(...n){this.execute(...n)},documentation:"Executes the function the PhetioAction is wrapping.",invocableForReadOnlyElements:!1},getValidationErrors:{returnType:ArrayIO(NullableIO(StringIO)),parameterTypes:e,implementation:function(...n){return this.getValidationErrors(...n)},documentation:"Checks to see if the proposed values are valid. Returns an array of length N where each element is an error (string) or null if the value is valid."}}})),cache.get(t)};let PhetioAction=gs;const getTypeName=o=>o.typeName,cache=new IOTypeCache;tandemNamespace.register("PhetioAction",PhetioAction);const PhetioAction$1=PhetioAction;class KeyStateTracker{constructor(e){var n,r;this.keyState={},this._lastKeyDown=null,this.attachedToDocument=!1,this.documentKeyupListener=null,this.documentKeydownListener=null,this.documentBlurListener=null,this._enabled=!0,this.keydownEmitter=new Emitter({parameters:[{valueType:KeyboardEvent}]}),this.keyupEmitter=new Emitter({parameters:[{valueType:KeyboardEvent}]}),this.keyDownStateChangedEmitter=new Emitter({parameters:[{valueType:[KeyboardEvent,null]}]}),this.keydownUpdateAction=new PhetioAction$1(s=>{const a=KeyboardUtils.getEventCode(s);if(a){if(this.correctModifierKeys(s),assert&&!KeyboardUtils.isShiftKey(s)&&assert(s.shiftKey===this.shiftKeyDown,"shift key inconsistency between event and keyState."),assert&&!KeyboardUtils.isAltKey(s)&&assert(s.altKey===this.altKeyDown,"alt key inconsistency between event and keyState."),assert&&!KeyboardUtils.isControlKey(s)&&assert(s.ctrlKey===this.ctrlKeyDown,"ctrl key inconsistency between event and keyState."),assert&&!KeyboardUtils.isMetaKey(s)&&assert(s.metaKey===this.metaKeyDown,"meta key inconsistency between event and keyState."),!this.isKeyDown(a)){const h=KeyboardUtils.getEventCode(s);assert&&assert(h,"Could not find key from domEvent"),this.keyState[h]={key:h,timeDown:0}}this._lastKeyDown=a,this.keydownEmitter.emit(s),this.keyDownStateChangedEmitter.emit(s)}},{phetioPlayback:!0,tandem:(n=e==null?void 0:e.tandem)==null?void 0:n.createTandem("keydownUpdateAction"),parameters:[{name:"event",phetioType:EventIO}],phetioEventType:EventType.USER,phetioDocumentation:"Action that executes whenever a keydown occurs from the input listeners this keyStateTracker adds (most likely to the document)."}),this.keyupUpdateAction=new PhetioAction$1(s=>{const a=KeyboardUtils.getEventCode(s);a&&(this.correctModifierKeys(s),this.isKeyDown(a)&&delete this.keyState[a],platform.mac&&KeyboardUtils.isMetaKey(s)&&this.clearState(!0),this.keyupEmitter.emit(s),this.keyDownStateChangedEmitter.emit(s))},{phetioPlayback:!0,tandem:(r=e==null?void 0:e.tandem)==null?void 0:r.createTandem("keyupUpdateAction"),parameters:[{name:"event",phetioType:EventIO}],phetioEventType:EventType.USER,phetioDocumentation:"Action that executes whenever a keyup occurs from the input listeners this keyStateTracker adds (most likely to the document)."});const t=this.step.bind(this);stepTimer.addListener(t),this.disposeKeyStateTracker=()=>{stepTimer.removeListener(t),this.attachedToDocument&&this.detachFromDocument()}}keydownUpdate(e){this.enabled&&this.keydownUpdateAction.execute(e)}correctModifierKeys(e){const t=KeyboardUtils.getEventCode(e);assert&&assert(t,"key not found from domEvent");let n=!1;e.shiftKey&&!KeyboardUtils.isShiftKey(e)&&!this.shiftKeyDown&&(n=n||!this.keyState[KeyboardUtils.KEY_SHIFT_LEFT],this.keyState[KeyboardUtils.KEY_SHIFT_LEFT]={key:t,timeDown:0}),e.altKey&&!KeyboardUtils.isAltKey(e)&&!this.altKeyDown&&(n=n||!this.keyState[KeyboardUtils.KEY_ALT_LEFT],this.keyState[KeyboardUtils.KEY_ALT_LEFT]={key:t,timeDown:0}),e.ctrlKey&&!KeyboardUtils.isControlKey(e)&&!this.ctrlKeyDown&&(n=n||!this.keyState[KeyboardUtils.KEY_CONTROL_LEFT],this.keyState[KeyboardUtils.KEY_CONTROL_LEFT]={key:t,timeDown:0}),e.metaKey&&!KeyboardUtils.isMetaKey(e)&&!this.metaKeyDown&&(n=n||!this.keyState[KeyboardUtils.KEY_META_LEFT],this.keyState[KeyboardUtils.KEY_META_LEFT]={key:t,timeDown:0}),!e.shiftKey&&this.shiftKeyDown&&(n=n||!!this.keyState[KeyboardUtils.KEY_SHIFT_LEFT]||!!this.keyState[KeyboardUtils.KEY_SHIFT_RIGHT],delete this.keyState[KeyboardUtils.KEY_SHIFT_LEFT],delete this.keyState[KeyboardUtils.KEY_SHIFT_RIGHT]),!e.altKey&&this.altKeyDown&&(n=n||!!this.keyState[KeyboardUtils.KEY_ALT_LEFT]||!!this.keyState[KeyboardUtils.KEY_ALT_RIGHT],delete this.keyState[KeyboardUtils.KEY_ALT_LEFT],delete this.keyState[KeyboardUtils.KEY_ALT_RIGHT]),!e.ctrlKey&&this.ctrlKeyDown&&(n=n||!!this.keyState[KeyboardUtils.KEY_CONTROL_LEFT]||!!this.keyState[KeyboardUtils.KEY_CONTROL_RIGHT],delete this.keyState[KeyboardUtils.KEY_CONTROL_LEFT],delete this.keyState[KeyboardUtils.KEY_CONTROL_RIGHT]),!e.metaKey&&this.metaKeyDown&&(n=n||KeyboardUtils.META_KEYS.some(r=>!!this.keyState[r]),KeyboardUtils.META_KEYS.forEach(r=>{delete this.keyState[r]})),n&&this.keyDownStateChangedEmitter.emit(e)}keyupUpdate(e){this.enabled&&this.keyupUpdateAction.execute(e)}get movementKeysDown(){return this.isAnyKeyInListDown(KeyboardUtils.MOVEMENT_KEYS)}getLastKeyDown(){return this._lastKeyDown}isKeyDown(e){return!!this.keyState[e]}isEnglishKeyDown(e){return this.isAnyKeyInListDown(EnglishStringToCodeMap[e])}getKeysDown(){return Object.keys(this.keyState)}getEnglishKeysDown(){const e=new Set;for(const t of this.getKeysDown()){const n=eventCodeToEnglishString(t);n&&e.add(n)}return e}isAnyKeyInListDown(e){for(let t=0;t<e.length;t++)if(this.isKeyDown(e[t]))return!0;return!1}areKeysDown(e){for(let n=0;n<e.length;n++)if(!this.isKeyDown(e[n]))return!1;return!0}areKeysExclusivelyDown(e){const t=Object.keys(this.keyState);if(t.length!==e.length)return!1;let n=!0;for(let r=0;r<e.length;r++){const s=e[r];let a=[s];KeyboardUtils.isModifierKey(s)&&(a=KeyboardUtils.MODIFIER_KEY_TO_CODE_MAP.get(s)),_.intersection(t,a).length===0&&(n=!1)}return n}areKeysDownWithoutExtraModifiers(e){for(let t=0;t<KeyboardUtils.MODIFIER_KEY_CODES.length;t++){const n=KeyboardUtils.MODIFIER_KEY_CODES[t];if(this.isKeyDown(n)&&!e.includes(n))return!1}return this.areKeysDown(e)}keysAreDown(){return Object.keys(this.keyState).length>0}get enterKeyDown(){return this.isKeyDown(KeyboardUtils.KEY_ENTER)}get shiftKeyDown(){return this.isAnyKeyInListDown(KeyboardUtils.SHIFT_KEYS)}get altKeyDown(){return this.isAnyKeyInListDown(KeyboardUtils.ALT_KEYS)}get ctrlKeyDown(){return this.isAnyKeyInListDown(KeyboardUtils.CONTROL_KEYS)}get metaKeyDown(){return this.isAnyKeyInListDown(KeyboardUtils.META_KEYS)}timeDownForKey(e){return assert&&assert(this.isKeyDown(e),"cannot get timeDown on a key that is not pressed down"),this.keyState[e].timeDown}clearState(e){this.keyState={},e||this.keyDownStateChangedEmitter.emit(null)}step(e){if(this.keysAreDown()){const t=e*1e3;for(const n in this.keyState)this.keyState[n]&&(this.keyState[n].timeDown+=t)}}attachToWindow(){assert&&assert(!this.attachedToDocument,"KeyStateTracker is already attached to document."),this.documentKeydownListener=t=>{this.keydownUpdate(t)},this.documentKeyupListener=t=>{this.keyupUpdate(t)},this.documentBlurListener=t=>{this.clearState()};const e=()=>{window.addEventListener("keyup",this.documentKeyupListener,{capture:!0}),window.addEventListener("keydown",this.documentKeydownListener,{capture:!0}),window.addEventListener("blur",this.documentBlurListener,{capture:!0}),this.attachedToDocument=!0};if(document)e();else{const t=()=>{e(),window.removeEventListener("load",t)};window.addEventListener("load",t)}}setEnabled(e){this._enabled!==e&&(this._enabled=e,!e&&this.clearState())}set enabled(e){this.setEnabled(e)}get enabled(){return this.isEnabled()}isEnabled(){return this._enabled}detachFromDocument(){assert&&assert(this.attachedToDocument,"KeyStateTracker is not attached to window."),assert&&assert(this.documentKeyupListener,"keyup listener was not created or attached to window"),assert&&assert(this.documentKeydownListener,"keydown listener was not created or attached to window."),assert&&assert(this.documentBlurListener,"blur listener was not created or attached to window."),window.removeEventListener("keyup",this.documentKeyupListener),window.removeEventListener("keydown",this.documentKeydownListener),window.removeEventListener("blur",this.documentBlurListener),this.documentKeyupListener=null,this.documentKeydownListener=null,this.documentBlurListener=null,this.attachedToDocument=!1}dispose(){this.disposeKeyStateTracker()}}scenery.register("KeyStateTracker",KeyStateTracker);class GlobalKeyStateTracker extends KeyStateTracker{constructor(e){super(e)}}const globalKeyStateTracker=new GlobalKeyStateTracker({tandem:Tandem.GENERAL_CONTROLLER.createTandem("keyStateTracker")});scenery.register("globalKeyStateTracker",globalKeyStateTracker);const globalKeyStateTracker$1=globalKeyStateTracker,INTERACTIVE_HIGHLIGHTING_OPTIONS=["interactiveHighlight","interactiveHighlightLayerable","interactiveHighlightEnabled"],InteractiveHighlighting=memoize(o=>{assert&&assert(!o._mixesInteractiveHighlighting,"InteractiveHighlighting is already added to this Type");const e=DelayedMutate$1("InteractiveHighlightingClass",INTERACTIVE_HIGHLIGHTING_OPTIONS,class extends o{constructor(...n){super(...n),this._pointer=null,this.displays={},this._interactiveHighlight=null,this._interactiveHighlightLayerable=!1,this._interactiveHighlightEnabled=!0,this.interactiveHighlightChangedEmitter=new TinyEmitter,this._isInteractiveHighlightActiveProperty=new TinyProperty(!1),this._activationListener={enter:this._onPointerEntered.bind(this),over:this._onPointerOver.bind(this),move:this._onPointerMove.bind(this),exit:this._onPointerExited.bind(this),down:this._onPointerDown.bind(this)},this._changedInstanceListener=this.onChangedInstance.bind(this),this.changedInstanceEmitter.addListener(this._changedInstanceListener),this._interactiveHighlightingEnabledListener=this._onInteractiveHighlightingEnabledChange.bind(this),this._boundPointerFocusClearedListener=this.handleLockedPointerFocusCleared.bind(this);const r=this._onPointerRelease.bind(this),s=this._onPointerCancel.bind(this);this._pointerListener={up:r,cancel:s,interrupt:s},this.isInteractiveHighlightActiveProperty=this._isInteractiveHighlightActiveProperty}get isInteractiveHighlighting(){return!0}static get _mixesInteractiveHighlighting(){return!0}setInteractiveHighlight(n){this._interactiveHighlight!==n&&(this._interactiveHighlight=n,this._interactiveHighlightLayerable&&(assert&&assert(n instanceof Node$2),n.visible=!1),this.interactiveHighlightChangedEmitter.emit())}set interactiveHighlight(n){this.setInteractiveHighlight(n)}get interactiveHighlight(){return this.getInteractiveHighlight()}getInteractiveHighlight(){return this._interactiveHighlight}setInteractiveHighlightLayerable(n){this._interactiveHighlightLayerable!==n&&(this._interactiveHighlightLayerable=n,this._interactiveHighlight&&(assert&&assert(this._interactiveHighlight instanceof Node$2),this._interactiveHighlight.visible=!1,this.interactiveHighlightChangedEmitter.emit()))}set interactiveHighlightLayerable(n){this.setInteractiveHighlightLayerable(n)}get interactiveHighlightLayerable(){return this.getInteractiveHighlightLayerable()}getInteractiveHighlightLayerable(){return this._interactiveHighlightLayerable}setInteractiveHighlightEnabled(n){this._interactiveHighlightEnabled=n;const r=Object.keys(this.displays);for(let s=0;s<r.length;s++){const a=this.displays[r[s]];this._interactiveHighlightingEnabledListener(a.focusManager.pointerHighlightsVisibleProperty.value)}}getInteractiveHighlightEnabled(){return this._interactiveHighlightEnabled}set interactiveHighlightEnabled(n){this.setInteractiveHighlightEnabled(n)}get interactiveHighlightEnabled(){return this.getInteractiveHighlightEnabled()}isInteractiveHighlightActivated(){let n=!1;const r=Object.keys(this.displays);for(let s=0;s<r.length;s++){const a=this.displays[r[s]];if(a.focusManager.pointerHighlightsVisibleProperty.value){const h=a.focusManager.pointerFocusProperty.value,c=a.focusManager.lockedPointerFocusProperty.value;if(c){if((c==null?void 0:c.trail.lastNode())===this){n=!0;break}}else if((h==null?void 0:h.trail.lastNode())===this){n=!0;break}}}return n}handleHighlightActiveChange(){this._isInteractiveHighlightActiveProperty.value=this.isInteractiveHighlightActivated()}dispose(){this.changedInstanceEmitter.removeListener(this._changedInstanceListener),this.hasInputListener(this._activationListener)&&this.removeInputListener(this._activationListener),this._pointer&&(this._pointer.removeInputListener(this._pointerListener),this._pointer=null);const n=Object.keys(this.displays);for(let r=0;r<n.length;r++){const s=this.displays[n[r]];this.onDisplayRemoved(s),delete this.displays[n[r]]}super.dispose&&super.dispose()}_onPointerOver(n){const r=n.trail.nodes.find(s=>s.groupFocusHighlight&&s.isInteractiveHighlighting);if(r){const s=n.trail.subtrailTo(r),a=Object.values(this.displays);for(let h=0;h<a.length;h++){const c=a[h];c.focusManager.pointerFocusProperty.value===null&&c.focusManager.pointerFocusProperty.set(new Focus(c,s))}}}_onPointerEntered(n){let r=!1;const s=Object.values(this.displays);for(let a=0;a<s.length;a++){const h=s[a];if(h.focusManager.pointerFocusProperty.value===null||!n.trail.equals(h.focusManager.pointerFocusProperty.value.trail)){const c=new Focus(h,n.trail);h.focusManager.pointerFocusProperty.set(c),h.focusManager.lockedPointerFocusProperty.value===null&&n.pointer.attachedListener&&(this.lockHighlight(c,h.focusManager),r=!0)}}r&&this.savePointer(n.pointer)}_onPointerMove(n){let r=!1;const s=Object.values(this.displays);for(let a=0;a<s.length;a++){const h=s[a],c=n.trail.subtrailTo(this);if((h.focusManager.pointerFocusProperty.value===null||!c.equals(h.focusManager.pointerFocusProperty.value.trail))&&!this.getDescendantsUseHighlighting(n.trail)){const d=new Focus(h,c);h.focusManager.pointerFocusProperty.set(d),h.focusManager.lockedPointerFocusProperty.value===null&&n.pointer.attachedListener&&(this.lockHighlight(d,h.focusManager),r=!0)}}r&&this.savePointer(n.pointer)}_onPointerExited(n){const r=Object.values(this.displays);for(let s=0;s<r.length;s++){const a=r[s];a.focusManager.pointerFocusProperty.set(null);const h=a.focusManager.lockedPointerFocusProperty.value;!n.trail.isPickable()&&(h===null||n.trail.containsNode(h.trail.lastNode()))&&this._onPointerRelease(n)}}_onPointerDown(n){if(this._pointer===null){let r=!1;const s=Object.values(this.displays);for(let a=0;a<s.length;a++){const h=s[a],c=h.focusManager.pointerFocusProperty.value,d=!!h.focusManager.lockedPointerFocusProperty.value;c&&!d&&(assert&&assert(!c.trail.lastNode().isDisposed,"Focus should not be set to a disposed Node"),this.lockHighlight(c,h.focusManager),r=!0)}r&&this.savePointer(n.pointer)}}onDisplayAdded(n){n.focusManager.pointerHighlightsVisibleProperty.hasListener(this._interactiveHighlightingEnabledListener)||n.focusManager.pointerHighlightsVisibleProperty.link(this._interactiveHighlightingEnabledListener)}onDisplayRemoved(n){n.focusManager.lockedPointerFocusProperty.hasListener(this._boundPointerFocusClearedListener)&&n.focusManager.lockedPointerFocusProperty.unlink(this._boundPointerFocusClearedListener),n.focusManager.pointerHighlightsVisibleProperty.unlink(this._interactiveHighlightingEnabledListener)}_onPointerRelease(n){const r=Object.values(this.displays);for(let s=0;s<r.length;s++){const a=r[s];a.focusManager.lockedPointerFocusProperty.value=null,a.focusManager.lockedPointerFocusProperty.hasListener(this._boundPointerFocusClearedListener)&&a.focusManager.lockedPointerFocusProperty.unlink(this._boundPointerFocusClearedListener)}this._pointer&&this._pointer.listeners.includes(this._pointerListener)&&(this._pointer.removeInputListener(this._pointerListener),this._pointer=null)}_onPointerCancel(n){const r=Object.values(this.displays);for(let s=0;s<r.length;s++)r[s].focusManager.pointerFocusProperty.set(null);this._onPointerRelease(n)}savePointer(n){assert&&assert(this._pointer===null,"It should be impossible to already have a Pointer before locking from touchSnag"),this._pointer=n,this._pointer.addInputListener(this._pointerListener)}lockHighlight(n,r){assert&&assert(this._pointer===null,"It should be impossible to already have a Pointer before locking from touchSnag"),r.lockedPointerFocusProperty.set(new Focus(n.display,n.trail.copy())),assert&&assert(!r.lockedPointerFocusProperty.hasListener(this._boundPointerFocusClearedListener),"this listener still on the lockedPointerFocusProperty indicates a memory leak"),r.lockedPointerFocusProperty.link(this._boundPointerFocusClearedListener)}handleLockedPointerFocusCleared(n){n===null&&this._onPointerRelease()}_onInteractiveHighlightingEnabledChange(n){const r=n&&this._interactiveHighlightEnabled,s=this.hasInputListener(this._activationListener);r&&!s?this.addInputListener(this._activationListener):!r&&s&&this.removeInputListener(this._activationListener),this.handleHighlightActiveChange()}onChangedInstance(n,r){assert&&assert(n.trail,"should have a trail"),assert&&assert(n.display,"should have a display");const s=n.trail.uniqueId;if(r){const a=n.display;this.displays[s]=a,this.onDisplayAdded(a)}else{assert&&assert(n.node,"should have a node");const a=this.displays[s];assert&&assert(a,`interactive highlighting does not have a Display for removed instance: ${s}`),n.node.instances.length===0&&this.onDisplayRemoved(a),delete this.displays[s]}}getDescendantsUseHighlighting(n){const r=n.nodes.indexOf(this),s=n.nodes.slice(r+1,n.nodes.length);let a=!1;for(let h=0;h<s.length;h++)if(s[h].isInteractiveHighlighting){a=!0;break}return a}mutate(n){return super.mutate(n)}});return e.prototype._mutatorKeys=INTERACTIVE_HIGHLIGHTING_OPTIONS.concat(e.prototype._mutatorKeys),assert&&assert(e.prototype._mutatorKeys.length===_.uniq(e.prototype._mutatorKeys).length,"duplicate mutator keys in InteractiveHighlighting"),e});scenery.register("InteractiveHighlighting",InteractiveHighlighting);class InteractiveHighlightingNode extends InteractiveHighlighting(Node$2){constructor(e){super(e)}}scenery.register("InteractiveHighlightingNode",InteractiveHighlightingNode);const localeInfoModule={aa:{name:"Afar",localizedName:"Afar",direction:"ltr"},ab:{name:"Abkhazian",localizedName:"Abkhazian",direction:"ltr"},ae:{name:"Avestan",localizedName:"Avestan",direction:"rtl"},af:{name:"Afrikaans",localizedName:"Afrikaans",direction:"ltr"},ak:{name:"Akan",localizedName:"Akan",direction:"ltr"},am:{name:"Amharic",localizedName:"Amharic",direction:"ltr"},an:{name:"Aragonese",localizedName:"Aragonese",direction:"ltr"},ar:{name:"Arabic",localizedName:"العربية",direction:"rtl"},ar_MA:{name:"Arabic, Morocco",localizedName:"العربية (المغرب)",direction:"rtl"},ar_SA:{name:"Arabic, Saudi Arabia",localizedName:"العربية (السعودية)",direction:"rtl"},as:{name:"Assamese",localizedName:"Assamese",direction:"ltr"},av:{name:"Avaric",localizedName:"Avaric",direction:"ltr"},ay:{name:"Aymara",localizedName:"Aymara",direction:"ltr"},az:{name:"Azerbaijani",localizedName:"Azerbaijani",direction:"ltr"},ba:{name:"Bashkir",localizedName:"Bashkir",direction:"ltr"},be:{name:"Belarusian",localizedName:"беларускі",direction:"ltr"},bg:{name:"Bulgarian",localizedName:"български",direction:"ltr"},bh:{name:"Bihari",localizedName:"Bihari",direction:"ltr"},bi:{name:"Bislama",localizedName:"Bislama",direction:"ltr"},bm:{name:"Bambara",localizedName:"Bambara",direction:"ltr"},bn:{name:"Bengali",localizedName:"Bengali",direction:"ltr"},bo:{name:"Tibetan",localizedName:"Tibetan",direction:"ltr"},br:{name:"Breton",localizedName:"Breton",direction:"ltr"},bs:{name:"Bosnian",localizedName:"Bosnian",direction:"ltr"},ca:{name:"Catalan",localizedName:"català",direction:"ltr"},ce:{name:"Chechen",localizedName:"Chechen",direction:"ltr"},ch:{name:"Chamorro",localizedName:"Chamorro",direction:"ltr"},co:{name:"Corsican",localizedName:"Corsican",direction:"ltr"},cr:{name:"Cree",localizedName:"Cree",direction:"ltr"},cs:{name:"Czech",localizedName:"čeština",direction:"ltr"},cu:{name:"Church Slavic",localizedName:"Church Slavic",direction:"ltr"},cv:{name:"Chuvash",localizedName:"Chuvash",direction:"ltr"},cy:{name:"Welsh",localizedName:"Welsh",direction:"ltr"},da:{name:"Danish",localizedName:"Dansk",direction:"ltr"},de:{name:"German",localizedName:"Deutsch",direction:"ltr"},dv:{name:"Divehi",localizedName:"Divehi",direction:"ltr"},dz:{name:"Dzongkha",localizedName:"Dzongkha",direction:"ltr"},ee:{name:"Ewe",localizedName:"Ewe",direction:"ltr"},el:{name:"Greek",localizedName:"Ελληνικά",direction:"ltr"},en:{name:"English",localizedName:"English",direction:"ltr"},en_CA:{name:"English, Canada",localizedName:"English (Canada)",direction:"ltr"},en_GB:{name:"English, United Kingdom",localizedName:"English (United Kingdom)",direction:"ltr"},eo:{name:"Esperanto",localizedName:"Esperanto",direction:"ltr"},es:{name:"Spanish",localizedName:"español",direction:"ltr"},es_CO:{name:"Spanish, Colombia",localizedName:"español (Colombia)",direction:"ltr"},es_CR:{name:"Spanish, Costa Rica",localizedName:"español (Costa Rica)",direction:"ltr"},es_ES:{name:"Spanish, Spain",localizedName:"español (España)",direction:"ltr"},es_MX:{name:"Spanish, Mexico",localizedName:"español (México)",direction:"ltr"},es_PE:{name:"Spanish, Peru",localizedName:"español (Perú)",direction:"ltr"},et:{name:"Estonian",localizedName:"Eesti",direction:"ltr"},eu:{name:"Basque",localizedName:"Basque",direction:"ltr"},fa:{name:"Persian",localizedName:"Persian",direction:"rtl"},ff:{name:"Fulah",localizedName:"Fulah",direction:"ltr"},fi:{name:"Finnish",localizedName:"suomi",direction:"ltr"},fj:{name:"Fijian",localizedName:"Fijian",direction:"ltr"},fo:{name:"Faroese",localizedName:"Faroese",direction:"ltr"},fr:{name:"French",localizedName:"français",direction:"ltr"},fu:{name:"Friulian",localizedName:"fu",direction:"ltr"},fy:{name:"Western Frisian",localizedName:"Frisian",direction:"ltr"},ga:{name:"Irish",localizedName:"Gaeilge",direction:"ltr"},gd:{name:"Scottish Gaelic",localizedName:"Scottish Gaelic",direction:"ltr"},gl:{name:"Galician",localizedName:"Gallegan",direction:"ltr"},gn:{name:"Guarani",localizedName:"Guarani",direction:"ltr"},gu:{name:"Gujarati",localizedName:"Gujarati",direction:"ltr"},gv:{name:"Manx",localizedName:"Manx",direction:"ltr"},ha:{name:"Hausa",localizedName:"Hausa",direction:"ltr"},hi:{name:"Hindi",localizedName:"हिंदी",direction:"ltr"},ho:{name:"Hiri Motu",localizedName:"Hiri Motu",direction:"ltr"},hr:{name:"Croatian",localizedName:"hrvatski",direction:"ltr"},ht:{name:"Haitian",localizedName:"Haitian",direction:"ltr"},hu:{name:"Hungarian",localizedName:"magyar",direction:"ltr"},hy:{name:"Armenian",localizedName:"Armenian",direction:"ltr"},hz:{name:"Herero",localizedName:"Herero",direction:"ltr"},ia:{name:"Interlingua",localizedName:"Interlingua",direction:"ltr"},ie:{name:"Interlingue",localizedName:"Interlingue",direction:"ltr"},ig:{name:"Igbo",localizedName:"Igbo",direction:"ltr"},ii:{name:"Sichuan Yi",localizedName:"Sichuan Yi",direction:"ltr"},ik:{name:"Inupiaq",localizedName:"Inupiaq",direction:"ltr"},in:{name:"Indonesian",localizedName:"Bahasa Indonesia",direction:"ltr"},io:{name:"Ido",localizedName:"Ido",direction:"ltr"},is:{name:"Icelandic",localizedName:"íslenska",direction:"ltr"},it:{name:"Italian",localizedName:"italiano",direction:"ltr"},iu:{name:"Inuktitut",localizedName:"Inuktitut",direction:"ltr"},iw:{name:"Hebrew",localizedName:"עברית",direction:"rtl"},ja:{name:"Japanese",localizedName:"日本語",direction:"ltr"},ji:{name:"Yiddish",localizedName:"Yiddish",direction:"ltr"},jv:{name:"Javanese",localizedName:"Javanese",direction:"ltr"},ka:{name:"Georgian",localizedName:"Georgian",direction:"ltr"},kg:{name:"Kongo",localizedName:"Kongo",direction:"ltr"},ki:{name:"Kikuyu",localizedName:"Kikuyu",direction:"ltr"},kj:{name:"Kwanyama",localizedName:"Kwanyama",direction:"ltr"},kk:{name:"Kazakh",localizedName:"Kazakh",direction:"ltr"},kl:{name:"Kalaallisut",localizedName:"Greenlandic",direction:"ltr"},km:{name:"Khmer",localizedName:"Khmer",direction:"ltr"},kn:{name:"Kannada",localizedName:"Kannada",direction:"ltr"},ko:{name:"Korean",localizedName:"한국어",direction:"ltr"},kr:{name:"Kanuri",localizedName:"Kanuri",direction:"ltr"},ks:{name:"Kashmiri",localizedName:"Kashmiri",direction:"ltr"},ku:{name:"Kurdish",localizedName:"Kurdish",direction:"ltr"},ku_TR:{name:"Kurdish, Turkey",localizedName:"Kurdish (Turkey)",direction:"ltr"},kv:{name:"Komi",localizedName:"Komi",direction:"ltr"},kw:{name:"Cornish",localizedName:"Cornish",direction:"ltr"},ky:{name:"Kirghiz",localizedName:"Kirghiz",direction:"ltr"},la:{name:"Latin",localizedName:"Latin",direction:"ltr"},lb:{name:"Luxembourgish",localizedName:"Luxembourgish",direction:"ltr"},lg:{name:"Ganda",localizedName:"Ganda",direction:"ltr"},li:{name:"Limburgish",localizedName:"Limburgish",direction:"ltr"},lk:{name:"Lakota",localizedName:"Lakota",direction:"ltr"},ln:{name:"Lingala",localizedName:"Lingala",direction:"ltr"},lo:{name:"Lao",localizedName:"Lao",direction:"ltr"},lt:{name:"Lithuanian",localizedName:"Lietuvių",direction:"ltr"},lu:{name:"Luba-Katanga",localizedName:"Luba-Katanga",direction:"ltr"},lv:{name:"Latvian",localizedName:"Latviešu",direction:"ltr"},mg:{name:"Malagasy",localizedName:"Malagasy",direction:"ltr"},mh:{name:"Marshallese",localizedName:"Marshallese",direction:"ltr"},mi:{name:"Maori",localizedName:"Maori",direction:"ltr"},mk:{name:"Macedonian",localizedName:"македонски",direction:"ltr"},ml:{name:"Malayalam",localizedName:"Malayalam",direction:"ltr"},mn:{name:"Mongolian",localizedName:"Mongolian",direction:"ltr"},mo:{name:"Moldavian",localizedName:"Moldavian",direction:"ltr"},mr:{name:"Marathi",localizedName:"Marathi",direction:"ltr"},ms:{name:"Malay",localizedName:"Bahasa Melayu",direction:"ltr"},mt:{name:"Maltese",localizedName:"Malti",direction:"ltr"},my:{name:"Burmese",localizedName:"Burmese",direction:"ltr"},na:{name:"Nauru",localizedName:"Nauru",direction:"ltr"},nb:{name:"Norwegian Bokmal",localizedName:"Norwegian Bokmål",direction:"ltr"},nd:{name:"North Ndebele",localizedName:"North Ndebele",direction:"ltr"},ne:{name:"Nepali",localizedName:"Nepali",direction:"ltr"},ng:{name:"Ndonga",localizedName:"Ndonga",direction:"ltr"},nl:{name:"Dutch",localizedName:"Nederlands",direction:"ltr"},nn:{name:"Norwegian Nynorsk",localizedName:"Norwegian Nynorsk",direction:"ltr"},nr:{name:"South Ndebele",localizedName:"South Ndebele",direction:"ltr"},nv:{name:"Navajo",localizedName:"Navajo",direction:"ltr"},ny:{name:"Chichewa",localizedName:"Nyanja",direction:"ltr"},oc:{name:"Occitan",localizedName:"Occitan",direction:"ltr"},oj:{name:"Ojibwa",localizedName:"Ojibwa",direction:"ltr"},om:{name:"Oromo",localizedName:"Oromo",direction:"ltr"},or:{name:"Oriya",localizedName:"Oriya",direction:"ltr"},os:{name:"Ossetian",localizedName:"Ossetian",direction:"ltr"},pa:{name:"Panjabi",localizedName:"Panjabi",direction:"ltr"},pi:{name:"Pali",localizedName:"Pali",direction:"ltr"},pl:{name:"Polish",localizedName:"polski",direction:"ltr"},ps:{name:"Pashto",localizedName:"Pushto",direction:"ltr"},pt:{name:"Portuguese",localizedName:"português",direction:"ltr"},pt_BR:{name:"Portuguese, Brazil",localizedName:"português (Brasil)",direction:"ltr"},qu:{name:"Quechua",localizedName:"Quechua",direction:"ltr"},rm:{name:"Raeto-Romance",localizedName:"Raeto-Romance",direction:"ltr"},rn:{name:"Kirundi",localizedName:"Rundi",direction:"ltr"},ro:{name:"Romanian",localizedName:"română",direction:"ltr"},ru:{name:"Russian",localizedName:"русский",direction:"ltr"},rw:{name:"Kinyarwanda",localizedName:"Kinyarwanda",direction:"ltr"},sa:{name:"Sanskrit",localizedName:"Sanskrit",direction:"ltr"},sc:{name:"Sardinian",localizedName:"Sardinian",direction:"ltr"},sd:{name:"Sindhi",localizedName:"Sindhi",direction:"ltr"},se:{name:"Northern Sami",localizedName:"Northern Sami",direction:"ltr"},sg:{name:"Sango",localizedName:"Sango",direction:"ltr"},sh:{name:"Serbo-Croatian",localizedName:"Serbo-Croatian",direction:"ltr"},si:{name:"Sinhalese",localizedName:"Sinhalese",direction:"ltr"},sk:{name:"Slovak",localizedName:"Slovenčina",direction:"ltr"},sl:{name:"Slovenian",localizedName:"Slovenščina",direction:"ltr"},sm:{name:"Samoan",localizedName:"Samoan",direction:"ltr"},sn:{name:"Shona",localizedName:"Shona",direction:"ltr"},so:{name:"Somali",localizedName:"Somali",direction:"ltr"},sq:{name:"Albanian",localizedName:"shqipe",direction:"ltr"},sr:{name:"Serbian",localizedName:"Српски",direction:"ltr"},ss:{name:"Swati",localizedName:"Swati",direction:"ltr"},st:{name:"Sotho",localizedName:"Southern Sotho",direction:"ltr"},su:{name:"Sundanese",localizedName:"Sundanese",direction:"ltr"},sv:{name:"Swedish",localizedName:"svenska",direction:"ltr"},sw:{name:"Swahili",localizedName:"Swahili",direction:"ltr"},ta:{name:"Tamil",localizedName:"Tamil",direction:"ltr"},te:{name:"Telugu",localizedName:"Telugu",direction:"ltr"},tg:{name:"Tajik",localizedName:"Tajik",direction:"ltr"},th:{name:"Thai",localizedName:"ไทย",direction:"ltr"},ti:{name:"Tigrinya",localizedName:"Tigrinya",direction:"ltr"},tk:{name:"Turkmen",localizedName:"Turkmen",direction:"ltr"},tl:{name:"Tagalog",localizedName:"Tagalog",direction:"ltr"},tn:{name:"Tswana",localizedName:"Tswana",direction:"ltr"},to:{name:"Tonga",localizedName:"Tonga",direction:"ltr"},tr:{name:"Turkish",localizedName:"Türkçe",direction:"ltr"},ts:{name:"Tsonga",localizedName:"Tsonga",direction:"ltr"},tt:{name:"Tatar",localizedName:"Tatar",direction:"ltr"},tw:{name:"Twi",localizedName:"Twi",direction:"ltr"},ty:{name:"Tahitian",localizedName:"Tahitian",direction:"ltr"},ug:{name:"Uighur",localizedName:"Uighur",direction:"ltr"},uk:{name:"Ukrainian",localizedName:"українська",direction:"ltr"},ur:{name:"Urdu",localizedName:"Urdu",direction:"rtl"},uz:{name:"Uzbek",localizedName:"Uzbek",direction:"ltr"},ve:{name:"Venda",localizedName:"Venda",direction:"ltr"},vi:{name:"Vietnamese",localizedName:"Tiếng Việt",direction:"ltr"},vo:{name:"Volapuk",localizedName:"Volapük",direction:"ltr"},wa:{name:"Walloon",localizedName:"Walloon",direction:"ltr"},wo:{name:"Wolof",localizedName:"Wolof",direction:"ltr"},xh:{name:"Xhosa",localizedName:"Xhosa",direction:"ltr"},yo:{name:"Yoruba",localizedName:"Yoruba",direction:"ltr"},za:{name:"Zhuang",localizedName:"Zhuang",direction:"ltr"},zh_CN:{name:"Chinese, Simplified",localizedName:"中文 (中国)",direction:"ltr"},zh_HK:{name:"Chinese, Hong Kong",localizedName:"中文 (香港)",direction:"ltr"},zh_TW:{name:"Chinese, Traditional",localizedName:"中文 (台灣)",direction:"ltr"},zu:{name:"Zulu",localizedName:"Zulu",direction:"ltr"}},phetcommon=new Namespace("phetcommon"),LTR="‪",RTL="‫",POP="‬",StringUtils={format:function(o){const e=arguments;return o.replace(/{(\d)}/g,(t,n)=>e[+n+1])},fillIn:function(o,e){o=o&&o.get?o.get():o,assert&&assert(typeof o=="string",`invalid template: ${o}`),assert&&assert(e&&typeof e=="object",`invalid values: ${e}`);let t=o;const n=o.match(/\{\{[^{}]+\}\}/g)||[];for(let r=0;r<n.length;r++){const s=n[r],a=s.replace("{{","").replace("}}","");if(e[a]!==void 0){const h=e[a]&&e[a].get?e[a].get():e[a];t=t.replace(s,h)}}return t},isEmbeddingMark:function(o){return o===LTR||o===RTL||o===POP},embeddedSlice:function(o,e,t){const n=[];let r;for(t===void 0&&(t=o.length),t<0&&(t+=o.length);e<o.length&&StringUtils.isEmbeddingMark(o.charAt(e));)e++;for(;t>=1&&StringUtils.isEmbeddingMark(o.charAt(t-1));)t--;if(e>=t||e>=o.length)return"";for(let D=0;D<e;D++)r=o.charAt(D),r===LTR||r===RTL?n.push(r):r===POP&&n.pop();let s=n.length,a=n.slice();const h=o.slice(e,t);for(let D=0;D<h.length;D++)r=h.charAt(D),r===LTR||r===RTL?n.push(r):r===POP&&(n.pop(),s=Math.min(n.length,s));let c=n;const d=Math.max(0,s-1);a=a.slice(d),c=c.slice(d);const y=a.join(""),g=c.join("").replace(/./g,POP);return y+h+g},embeddedSplit:function(o,e,t){if(e===void 0)return[o];let n=[],r,s=o;function a(){let c,d;if(e instanceof window.RegExp){const y=s.match(e);y?(c=y.index,d=y[0].length):c=-1}else assert&&assert(typeof e=="string"),c=s.indexOf(e),d=e.length;return{index:c,length:d}}let h=0;for(;(r=a()).index>=0;){n.push(StringUtils.embeddedSlice(o,h,h+r.index));const c=r.index+r.length;s=s.slice(c),h+=c}return n.push(StringUtils.embeddedSlice(o,h)),t!==void 0&&(assert&&assert(typeof t=="number"),n=_.first(n,t)),n},embeddedDebugString:function(o){return o.replace(/\u202a/g,"[LTR]").replace(/\u202b/g,"[RTL]").replace(/\u202c/g,"[POP]")},wrapLTR:function(o){return LTR+o+POP},wrapRTL:function(o){return RTL+o+POP},wrapDirection:function(o,e){return assert&&assert(e==="ltr"||e==="rtl"),e==="ltr"?StringUtils.wrapLTR(o):StringUtils.wrapRTL(o)},localeToLocalizedName:function(o){return assert&&assert(localeInfoModule[o],"locale needs to be a valid locale code defined in localeInfoModule"),StringUtils.wrapDirection(localeInfoModule[o].localizedName,localeInfoModule[o].direction)},capitalize(o){const e=o.search(/[A-Za-z0-9]/);if(e===-1)return o.slice(0);const t=e>0?o.slice(0,e):"",n=o.charAt(e).toUpperCase(),r=e+1<o.length?o.slice(e+1):"";return t+n+r}};phetcommon.register("StringUtils",StringUtils);const utteranceQueueNamespace=new Namespace("utteranceQueue"),NAME_KEY="NAME",OBJECT_KEY="OBJECT",CONTEXT_KEY="CONTEXT",HINT_KEY="HINT",DEFAULT_RESPONSE_PATTERNS={nameObjectContextHint:"{{NAME}}, {{OBJECT}}, {{CONTEXT}} {{HINT}}",nameObjectContext:"{{NAME}}, {{OBJECT}}, {{CONTEXT}}",nameObjectHint:"{{NAME}}, {{OBJECT}}, {{HINT}}",nameContextHint:"{{NAME}}, {{CONTEXT}} {{HINT}}",nameObject:"{{NAME}}, {{OBJECT}}",nameContext:"{{NAME}}, {{CONTEXT}}",nameHint:"{{NAME}}, {{HINT}}",name:"{{NAME}}",objectContextHint:"{{OBJECT}}, {{CONTEXT}} {{HINT}}",objectContext:"{{OBJECT}}, {{CONTEXT}}",objectHint:"{{OBJECT}}, {{HINT}}",contextHint:"{{CONTEXT}} {{HINT}}",object:"{{OBJECT}}",context:"{{CONTEXT}}",hint:"{{HINT}}"},Ws=class Ws{constructor(e){const t=optionize3()({},DEFAULT_RESPONSE_PATTERNS,e);this.nameObjectContextHint=t.nameObjectContextHint,this.nameObjectContext=t.nameObjectContext,this.nameObjectHint=t.nameObjectHint,this.nameContextHint=t.nameContextHint,this.nameObject=t.nameObject,this.nameContext=t.nameContext,this.nameHint=t.nameHint,this.name=t.name,this.objectContextHint=t.objectContextHint,this.objectContext=t.objectContext,this.objectHint=t.objectHint,this.contextHint=t.contextHint,this.object=t.object,this.context=t.context,this.hint=t.hint}getResponsePattern(e){const t=this[e];return assert&&assert(t,`no pattern string found for key ${e}`),t}static createPatternKey(e,t,n,r){let s="";return e&&(s=s.concat(NAME_KEY.concat("_"))),t&&(s=s.concat(OBJECT_KEY.concat("_"))),n&&(s=s.concat(CONTEXT_KEY.concat("_"))),r&&(s=s.concat(HINT_KEY.concat("_"))),_.camelCase(s)}};Ws.DEFAULT_RESPONSE_PATTERNS=new Ws;let ResponsePatternCollection=Ws;utteranceQueueNamespace.register("ResponsePatternCollection",ResponsePatternCollection);const DEFAULT_OPTIONS$3={nameResponse:null,objectResponse:null,contextResponse:null,hintResponse:null,ignoreProperties:!1,responsePatternCollection:ResponsePatternCollection.DEFAULT_RESPONSE_PATTERNS},mi=class mi{constructor(e){const t=optionize3()({},DEFAULT_OPTIONS$3,e);assert&&assert(t.responsePatternCollection instanceof ResponsePatternCollection),this._nameResponse=t.nameResponse,this._objectResponse=t.objectResponse,this._contextResponse=t.contextResponse,this._hintResponse=t.hintResponse,this.ignoreProperties=t.ignoreProperties,this.responsePatternCollection=t.responsePatternCollection}getNameResponse(){return mi.getResponseText(this._nameResponse)}get nameResponse(){return this.getNameResponse()}set nameResponse(e){this.setNameResponse(e)}setNameResponse(e){this._nameResponse=e}getObjectResponse(){return mi.getResponseText(this._objectResponse)}get objectResponse(){return this.getObjectResponse()}set objectResponse(e){this.setObjectResponse(e)}setObjectResponse(e){this._objectResponse=e}getContextResponse(){return mi.getResponseText(this._contextResponse)}get contextResponse(){return this.getContextResponse()}set contextResponse(e){this.setContextResponse(e)}setContextResponse(e){this._contextResponse=e}getHintResponse(){return mi.getResponseText(this._hintResponse)}get hintResponse(){return this.getHintResponse()}set hintResponse(e){this.setHintResponse(e)}setHintResponse(e){this._hintResponse=e}static getResponseText(e){return isTReadOnlyProperty(e)?e.value:typeof e=="function"?e():e}copy(){return new mi(this.serialize())}serialize(){return{nameResponse:this.nameResponse,objectResponse:this.objectResponse,contextResponse:this.contextResponse,hintResponse:this.hintResponse,ignoreProperties:this.ignoreProperties,responsePatternCollection:this.responsePatternCollection}}};mi.DEFAULT_OPTIONS=DEFAULT_OPTIONS$3;let ResponsePacket=mi;utteranceQueueNamespace.register("ResponsePacket",ResponsePacket);class ResponseCollector extends PhetioObject{constructor(e){super(),this.nameResponsesEnabledProperty=new BooleanProperty(!0),this.objectResponsesEnabledProperty=new BooleanProperty(!1),this.contextResponsesEnabledProperty=new BooleanProperty(!1),this.hintResponsesEnabledProperty=new BooleanProperty(!1)}reset(){this.nameResponsesEnabledProperty.reset(),this.objectResponsesEnabledProperty.reset(),this.contextResponsesEnabledProperty.reset(),this.hintResponsesEnabledProperty.reset()}collectResponses(e){const t=optionize3()({},ResponsePacket.DEFAULT_OPTIONS,e);assert&&assert(t.responsePatternCollection instanceof ResponsePatternCollection);const n=!!(t.nameResponse&&(this.nameResponsesEnabledProperty.get()||t.ignoreProperties)),r=!!(t.objectResponse&&(this.objectResponsesEnabledProperty.get()||t.ignoreProperties)),s=!!(t.contextResponse&&(this.contextResponsesEnabledProperty.get()||t.ignoreProperties)),a=!!(t.hintResponse&&(this.hintResponsesEnabledProperty.get()||t.ignoreProperties)),h=ResponsePatternCollection.createPatternKey(n,r,s,a);let c="";if(h){const d=t.responsePatternCollection.getResponsePattern(h);c=StringUtils.fillIn(d,{NAME:t.nameResponse,OBJECT:t.objectResponse,CONTEXT:t.contextResponse,HINT:t.hintResponse})}return c}}const responseCollector=new ResponseCollector;utteranceQueueNamespace.register("responseCollector",responseCollector);const responseCollector$1=responseCollector,DEFAULT_PRIORITY=1;let globalIdCounter$2=1;const Qt=class Qt extends Disposable{constructor(e){const t=optionize()({alert:null,predicate:function(){return!0},canAnnounceProperties:[],descriptionCanAnnounceProperties:[],voicingCanAnnounceProperties:[],alertStableDelay:200,alertMaximumDelay:Number.MAX_VALUE,announcerOptions:{},priority:DEFAULT_PRIORITY},e);super(t),this.id=globalIdCounter$2++,this._alert=t.alert,this.predicate=t.predicate,this.canAnnounceProperty=new AnnouncingControlProperty({dependentProperties:t.canAnnounceProperties}),this.descriptionCanAnnounceProperty=new AnnouncingControlProperty({dependentProperties:t.descriptionCanAnnounceProperties}),this.voicingCanAnnounceProperty=new AnnouncingControlProperty({dependentProperties:t.voicingCanAnnounceProperties}),this.alertStableDelay=t.alertStableDelay,this.alertMaximumDelay=t.alertMaximumDelay,this.announcerOptions=t.announcerOptions,this.priorityProperty=new NumberProperty(t.priority),this.previousAlertText=null}static getAlertStringFromResponsePacket(e,t){const n=e.serialize();return t||(n.ignoreProperties=!0),responseCollector$1.collectResponses(n)}getAlertText(e=!1){const t=Qt.alertableToText(this._alert,e);return this.previousAlertText=t,t}getAlert(){return this._alert}get alert(){return this.getAlert()}set alert(e){this.setAlert(e)}setAlert(e){this._alert=e}setAlertStableDelay(e){this.alertStableDelay=e}toString(){return`Utterance_${this.id}#${this.getAlertText()}`}toStateObject(){return{alert:NullableIO(OrIO([StringIO,NumberIO])).toStateObject(this.getAlertText())}}reset(){this.previousAlertText=null}setCanAnnounceProperties(e){this.canAnnounceProperty.setDependentProperties(e)}set canAnnounceProperties(e){this.setCanAnnounceProperties(e)}get canAnnounceProperties(){return this.getCanAnnounceProperties()}getCanAnnounceProperties(){return this.canAnnounceProperty.getDependentProperties()}setDescriptionCanAnnounceProperties(e){this.descriptionCanAnnounceProperty.setDependentProperties(e)}set descriptionCanAnnounceProperties(e){this.setDescriptionCanAnnounceProperties(e)}get descriptionCanAnnounceProperties(){return this.getDescriptionCanAnnounceProperties()}getDescriptionCanAnnounceProperties(){return this.descriptionCanAnnounceProperty.getDependentProperties()}setVoicingCanAnnounceProperties(e){this.voicingCanAnnounceProperty.setDependentProperties(e)}set voicingCanAnnounceProperties(e){this.setVoicingCanAnnounceProperties(e)}get voicingCanAnnounceProperties(){return this.getVoicingCanAnnounceProperties()}getVoicingCanAnnounceProperties(){return this.voicingCanAnnounceProperty.getDependentProperties()}dispose(){this.canAnnounceProperty.dispose(),this.descriptionCanAnnounceProperty.dispose(),this.voicingCanAnnounceProperty.dispose(),this.priorityProperty.dispose(),super.dispose()}static alertableToText(e,t=!1){let n;if(typeof e=="function")n=e();else if(e instanceof ResponsePacket)n=Qt.getAlertStringFromResponsePacket(e,t);else{if(e instanceof Qt)return e.getAlertText(t);isTReadOnlyProperty(e)?n=e.value:n=e}return n}};Qt.TOP_PRIORITY=10,Qt.HIGH_PRIORITY=5,Qt.MEDIUM_PRIORITY=2,Qt.DEFAULT_PRIORITY=DEFAULT_PRIORITY,Qt.LOW_PRIORITY=0,Qt.UtteranceIO=new IOType("UtteranceIO",{valueType:Qt,documentation:"Announces text to a specific browser technology (like aria-live or web speech)",toStateObject:e=>e.toStateObject(),stateSchema:{alert:NullableIO(OrIO([StringIO,NumberIO]))}});let Utterance=Qt;class AnnouncingControlProperty extends DynamicProperty{constructor(e){const t=optionize()({dependentProperties:[]},e),n=new Property(new TinyProperty(!1));super(n),this._dependentProperties=[],this.implementationProperty=n,this.setDependentProperties(t.dependentProperties)}setDependentProperties(e){this.implementationProperty.value&&this.implementationProperty.value.dispose();const t=e.length===0?[new TinyProperty(!0)]:e;this.implementationProperty.value=DerivedProperty.and(t),this._dependentProperties=e}set dependentProperties(e){this.setDependentProperties(e)}get dependentProperties(){return this.getDependentProperties()}getDependentProperties(){return this._dependentProperties.slice(0)}dispose(){this.implementationProperty.dispose(),this._dependentProperties=[],super.dispose()}}utteranceQueueNamespace.register("Utterance",Utterance);const fs=class fs extends PhetioObject{constructor(e){var n;const t=optionize()({respectResponseCollectorProperties:!0,phetioType:fs.AnnouncerIO,phetioState:!1},e);super(t),this.readyToAnnounce=!0,this.hasSpoken=!1,this.respectResponseCollectorProperties=t.respectResponseCollectorProperties,this.announcementCompleteEmitter=new Emitter({parameters:[{name:"utterance",phetioType:Utterance.UtteranceIO},{name:"text",phetioType:NullableIO(OrIO([StringIO,NumberIO]))}],tandem:(n=t.tandem)==null?void 0:n.createTandem("announcementCompleteEmitter"),phetioReadOnly:!0,phetioDocumentation:"The announcement that has just completed. The Utterance text could potentially differ from the exact text that was announced, so both are emitted. Use `text` for an exact match of what was announced."})}shouldUtteranceCancelOther(e,t){return t.priorityProperty.value<e.priorityProperty.value}onUtterancePriorityChange(e){}};fs.AnnouncerIO=new IOType("AnnouncerIO",{valueType:fs,documentation:"Announces text to a specific browser technology (like aria-live or web speech)"});let Announcer=fs;utteranceQueueNamespace.register("Announcer",Announcer);const SpeechSynthesisParentPolyfill={initialize(){if(window.speechSynthesis||window.SpeechSynthesis||window.SpeechSynthesisUtterance)throw new Error("SpeechSynthesis is supported here, the polyfill should not overwrite it");assert&&assert(window.parent,"This polyfill requires a parent frame implementation of SpeechSynthesis."),window.SpeechSynthesis=window.parent.SpeechSynthesis,window.speechSynthesis=new window.parent.SpeechSynthesis,window.SpeechSynthesisUtterance=window.parent.SpeechSynthesisUtterance}};utteranceQueueNamespace.register("SpeechSynthesisParentPolyfill",SpeechSynthesisParentPolyfill);window.phet&&phet.chipper&&phet.chipper.queryParameters&&phet.chipper.queryParameters.speechSynthesisFromParent&&SpeechSynthesisParentPolyfill.initialize();const ENGINE_WAKE_INTERVAL=5e3,PENDING_UTTERANCE_DELAY=5e3,PAUSE_RESUME_WORKAROUND_INTERVAL=1e4,VOICING_UTTERANCE_INTERVAL=125,NOVELTY_VOICES=["Albert","Bad News","Bahh","Bells","Boing","Bubbles","Cellos","Good News","Jester","Organ","Superstar","Trinoids","Whisper","Wobble","Zarvox","Flo","Grandma","Grandpa","Junior"];let initializeCount=0;const voiceLangToSupportedLocale={cmn:"zh_CN",yue:"zh_HK","yue-HK":"zh_HK",yue_HK:"zh_HK","fil-PH":"tl",fil_PH:"tl"},UTTERANCE_OPTION_DEFAULTS={cancelSelf:!0,cancelOther:!0,voice:null};class SpeechSynthesisAnnouncer extends Announcer{constructor(e){var n,r,s,a;const t=optionize()({respectResponseCollectorProperties:!1,debug:!1},e);super(t),this.debug=t.debug,this.voiceProperty=new Property(null,{tandem:(n=t.tandem)==null?void 0:n.createTandem("voiceProperty"),phetioValueType:NullableIO(SpeechSynthesisVoiceIO),phetioState:!1,phetioReadOnly:!0,phetioDocumentation:"the voice that is currently voicing responses"}),this.voiceRateProperty=new NumberProperty(1,{range:new Range(.75,2),tandem:(r=t.tandem)==null?void 0:r.createTandem("voiceRateProperty"),phetioState:!1,phetioDocumentation:"changes the rate of the voicing-feature voice"}),this.voicePitchProperty=new NumberProperty(1,{range:new Range(.5,2),tandem:(s=t.tandem)==null?void 0:s.createTandem("voicePitchProperty"),phetioState:!1,phetioDocumentation:"changes the pitch of the voicing-feature voice"}),this.voiceVolumeProperty=new NumberProperty(1,{range:new Range(0,1)}),this.hasSpoken=!1,this.timeSinceWakingEngine=0,this.timeSincePauseResume=0,this.timeSincePendingUtterance=0,this.timeSinceUtteranceEnd=VOICING_UTTERANCE_INTERVAL,this.startSpeakingEmitter=new Emitter({parameters:[{valueType:"string"},{valueType:Utterance}]}),this.endSpeakingEmitter=new Emitter({parameters:[{valueType:"string"},{valueType:Utterance}]}),this.enabledComponentImplementation=new EnabledComponent({enabled:!1,tandem:t.tandem,enabledPropertyOptions:{phetioDocumentation:"toggles this controller of SpeechSynthesis on and off",phetioState:!1,phetioFeatured:!1}}),assert&&assert(this.enabledComponentImplementation.enabledProperty.isSettable(),"enabledProperty must be settable"),this.enabledProperty=this.enabledComponentImplementation.enabledProperty,this.mainWindowVoicingEnabledProperty=new BooleanProperty(!0,{tandem:(a=t.tandem)==null?void 0:a.createTandem("mainWindowVoicingEnabledProperty"),phetioState:!1,phetioDocumentation:"toggles the voicing feature on and off for the simulation screen (not the voicing preferences and toolbar controls)"}),this.voicingFullyEnabledProperty=DerivedProperty.and([this.enabledProperty,this.mainWindowVoicingEnabledProperty]),this._speechAllowedAndFullyEnabledProperty=new BooleanProperty(!1),this.speechAllowedAndFullyEnabledProperty=this._speechAllowedAndFullyEnabledProperty,this.synth=null,this.voicesProperty=new Property([]),this.speakingSpeechSynthesisUtteranceWrapper=null,this.isInitializedProperty=new BooleanProperty(!1),this.canSpeakProperty=null,this.boundHandleCanSpeakChange=this.handleCanSpeakChange.bind(this),this.boundHandleCanAnnounceChange=this.handleCanAnnounceChange.bind(this),this.debug&&(this.announcementCompleteEmitter.addListener((h,c)=>{console.log("announcement complete",c)}),this.startSpeakingEmitter.addListener(h=>{this.debug&&console.log("startSpeakingListener",h)}),this.endSpeakingEmitter.addListener(h=>{this.debug&&console.log("endSpeakingListener",h)}))}get initialized(){return this.isInitializedProperty.value}initialize(e,t){assert&&assert(!this.initialized,"can only be initialized once"),assert&&assert(SpeechSynthesisAnnouncer.isSpeechSynthesisSupported(),"trying to initialize speech, but speech is not supported on this platform."),assert&&assert(initializeCount===0,"Only one instance of SpeechSynthesisAnnouncer can be initialized at a time."),initializeCount++;const n=optionize()({speechAllowedProperty:new BooleanProperty(!0)},t);this.synth=window.speechSynthesis,this.canSpeakProperty=DerivedProperty.and([n.speechAllowedProperty,this.enabledProperty]),this.canSpeakProperty.link(this.boundHandleCanSpeakChange),Multilink.multilink([n.speechAllowedProperty,this.voicingFullyEnabledProperty],(a,h)=>{this._speechAllowedAndFullyEnabledProperty.value=a&&h});const r=this.getSynth();r.addEventListener&&r.addEventListener("voiceschanged",()=>{this.populateVoices()}),this.populateVoices();const s=()=>{this.timeSinceWakingEngine=ENGINE_WAKE_INTERVAL,e.removeListener(s)};e.addListener(s),stepTimer.addListener(this.step.bind(this)),this.isInitializedProperty.value=!0}step(e){e*=1e3;const t=this.getSynth();this.initialized&&t&&(this.hasSpoken||(this.hasSpoken=t.speaking),this.timeSinceUtteranceEnd=t.speaking?0:this.timeSinceUtteranceEnd+e,this.timeSincePendingUtterance=this.speakingSpeechSynthesisUtteranceWrapper&&!this.speakingSpeechSynthesisUtteranceWrapper.started?this.timeSincePendingUtterance+e:0,this.timeSincePendingUtterance>PENDING_UTTERANCE_DELAY&&(assert&&assert(this.speakingSpeechSynthesisUtteranceWrapper,"should have this.speakingSpeechSynthesisUtteranceWrapper"),this.handleSpeechSynthesisEnd(this.speakingSpeechSynthesisUtteranceWrapper.announceText,this.speakingSpeechSynthesisUtteranceWrapper),this.speakingSpeechSynthesisUtteranceWrapper=null,this.cancelSynth()),this.timeSinceUtteranceEnd>VOICING_UTTERANCE_INTERVAL&&!this.speakingSpeechSynthesisUtteranceWrapper&&(this.readyToAnnounce=!0),platform.chromium&&!platform.android&&this.voiceProperty.value&&!this.voiceProperty.value.localService&&(this.timeSincePauseResume=t.speaking?this.timeSincePauseResume+e:0,this.timeSincePauseResume>PAUSE_RESUME_WORKAROUND_INTERVAL&&(this.timeSincePauseResume=0,t.pause(),t.resume())),platform.chromeOS&&(this.timeSinceWakingEngine+=e,!t.speaking&&this.timeSinceWakingEngine>ENGINE_WAKE_INTERVAL&&(this.timeSinceWakingEngine=0,t.speak(new SpeechSynthesisUtterance(" ")))))}handleCanSpeakChange(e){e||this.cancel()}populateVoices(){const e=this.getSynth();e&&(this.voicesProperty.value=_.uniqBy(e.getVoices(),t=>t.name))}getPrioritizedVoices(){assert&&assert(this.initialized,"No voices available until the SpeechSynthesisAnnouncer is initialized"),assert&&assert(this.voicesProperty.value.length>0,"No voices available to provided a prioritized list.");const e=this.voicesProperty.value.slice(),t=_.filter(e,r=>!_.some(NOVELTY_VOICES,s=>r.name.includes(s))),n=r=>r.name.includes("Google")?-1:r.name.includes("Fred")?t.length:t.indexOf(r);return t.sort((r,s)=>n(r)-n(s))}getEnglishPrioritizedVoices(){return _.filter(this.getPrioritizedVoices(),e=>e.lang==="en-US"||e.lang==="en_US")}getPrioritizedVoicesForLocale(e){const t=e,n=e.replace("_","-");return _.filter(this.getPrioritizedVoices(),r=>{const s=voiceLangToSupportedLocale.hasOwnProperty(r.lang)?voiceLangToSupportedLocale[r.lang]:r.lang;let a=!1;return(s.includes("_")||s.includes("-"))&&(a=t===s.slice(0,2)),a||t===s||n===s})}announce(e,t){this.initialized&&this.canSpeakProperty&&this.canSpeakProperty.value?this.requestSpeech(e,t):this.handleAnnouncementFailure(t,e)}handleAnnouncementFailure(e,t){this.debug&&console.log("announcement failure",t),this.announcementCompleteEmitter.emit(e,t)}speakIgnoringEnabled(e){this.initialized&&(this.cancel(),this.requestSpeech(e.getAlertText(this.respectResponseCollectorProperties),e))}requestSpeech(e,t){if(assert&&assert(SpeechSynthesisAnnouncer.isSpeechSynthesisSupported(),"trying to speak with speechSynthesis, but it is not supported on this platform"),this.debug&&console.log("requestSpeech",e),!e){this.handleAnnouncementFailure(t,e);return}const n=optionize3()({},UTTERANCE_OPTION_DEFAULTS,t.announcerOptions),r=removeBrTags(stripEmbeddingMarks(e+""));validate(r,Validation.STRING_WITHOUT_TEMPLATE_VARS_VALIDATOR);const s=new SpeechSynthesisUtterance(r);s.voice=n.voice||this.voiceProperty.value,s.pitch=this.voicePitchProperty.value,s.rate=this.voiceRateProperty.value,s.volume=this.voiceVolumeProperty.value;const a=()=>{this.startSpeakingEmitter.emit(r,t),assert&&assert(this.speakingSpeechSynthesisUtteranceWrapper,"should have been set in requestSpeech"),this.speakingSpeechSynthesisUtteranceWrapper.started=!0,s.removeEventListener("start",a)},h=()=>{this.handleSpeechSynthesisEnd(r,c)},c=new SpeechSynthesisUtteranceWrapper(t,e,s,!1,h,a);assert&&assert(this.speakingSpeechSynthesisUtteranceWrapper===null,"Wrapper should be null, we should have received an end event to clear it before the next one."),this.speakingSpeechSynthesisUtteranceWrapper=c,s.addEventListener("start",a),s.addEventListener("end",h),s.addEventListener("error",h),this.readyToAnnounce=!1,this.timeSinceUtteranceEnd=0,t.canAnnounceProperty.link(this.boundHandleCanAnnounceChange),t.voicingCanAnnounceProperty.link(this.boundHandleCanAnnounceChange),this.getSynth().speak(s)}handleCanAnnounceChange(){this.speakingSpeechSynthesisUtteranceWrapper&&this.cancelUtteranceIfCanAnnounceFalse(this.speakingSpeechSynthesisUtteranceWrapper.utterance)}cancelUtteranceIfCanAnnounceFalse(e){(!e.canAnnounceProperty.value||!e.voicingCanAnnounceProperty.value)&&this.cancelUtterance(e)}handleSpeechSynthesisEnd(e,t){this.endSpeakingEmitter.emit(e,t.utterance),this.announcementCompleteEmitter.emit(t.utterance,t.speechSynthesisUtterance.text),t.speechSynthesisUtterance.removeEventListener("error",t.endListener),t.speechSynthesisUtterance.removeEventListener("end",t.endListener),t.speechSynthesisUtterance.removeEventListener("start",t.startListener);const n=t.utterance.canAnnounceProperty;n.hasListener(this.boundHandleCanAnnounceChange)&&n.unlink(this.boundHandleCanAnnounceChange);const r=t.utterance.voicingCanAnnounceProperty;r.hasListener(this.boundHandleCanAnnounceChange)&&r.unlink(this.boundHandleCanAnnounceChange),this.speakingSpeechSynthesisUtteranceWrapper=null}getSynth(){return assert&&assert(SpeechSynthesisAnnouncer.isSpeechSynthesisSupported(),"Trying to use SpeechSynthesis, but it is not supported on this platform."),this.synth}cancel(){this.initialized&&this.speakingSpeechSynthesisUtteranceWrapper&&this.cancelUtterance(this.speakingSpeechSynthesisUtteranceWrapper.utterance)}cancelUtterance(e){const t=this.speakingSpeechSynthesisUtteranceWrapper;t&&e===t.utterance&&(this.handleSpeechSynthesisEnd(t.announceText,t),this.cancelSynth())}shouldUtteranceCancelOther(e,t){const n=optionize3()({},UTTERANCE_OPTION_DEFAULTS,e.announcerOptions);let r;return t.priorityProperty.value!==e.priorityProperty.value?r=t.priorityProperty.value<e.priorityProperty.value:(r=n.cancelOther,t&&t===e&&(r=n.cancelSelf)),r}onUtterancePriorityChange(e){const t=this.speakingSpeechSynthesisUtteranceWrapper;t&&this.shouldUtteranceCancelOther(e,t.utterance)&&this.cancelUtterance(t.utterance)}cancelSynth(){assert&&assert(this.initialized,"must be initialized to use synth");const e=this.getSynth();e&&e.cancel()}static isSpeechSynthesisSupported(){return!!window.speechSynthesis&&!!window.SpeechSynthesisUtterance}}class SpeechSynthesisUtteranceWrapper{constructor(e,t,n,r,s,a){this.utterance=e,this.announceText=t,this.speechSynthesisUtterance=n,this.started=r,this.endListener=s,this.startListener=a}}function removeBrTags(o){return o.split("<br/>").join(" ").split("<br>").join(" ")}const SpeechSynthesisVoiceIO=new IOType("SpeechSynthesisVoiceIO",{isValidValue:o=>!0,toStateObject:o=>o.name});utteranceQueueNamespace.register("SpeechSynthesisAnnouncer",SpeechSynthesisAnnouncer);class VoicingManager extends SpeechSynthesisAnnouncer{constructor(e){const t=optionize()({respectResponseCollectorProperties:!0,phetioDocumentation:"Announcer that manages the voicing feature, providing audio responses via WebAudio."},e);super(t)}initialize(e,t){super.initialize(e,t),globalKeyStateTracker$1.keyupEmitter.addListener(n=>{KeyboardUtils.isControlKey(n)&&this.cancel()})}voicingSupportedForLocale(e){return e.startsWith("en")}}const voicingManager=new VoicingManager;scenery.register("voicingManager",voicingManager);const voicingManager$1=voicingManager,NUMBER_OF_ARIA_LIVE_ELEMENTS=4;let ariaLiveAnnouncerIndex=1;const yi=class yi extends EnumerationValue{constructor(e){super(),this.attributeString=e}};yi.POLITE=new yi("polite"),yi.ASSERTIVE=new yi("assertive"),yi.enumeration=new Enumeration(yi);let AriaLive=yi;function createBatchOfPriorityLiveElements(o){const e=o.attributeString,t=document.createElement("div");for(let n=1;n<=NUMBER_OF_ARIA_LIVE_ELEMENTS;n++){const r=document.createElement("p");r.setAttribute("id",`elements-${ariaLiveAnnouncerIndex}-${e}-${n}`),r.setAttribute("aria-live",e),t.appendChild(r)}return t}const ms=class ms extends Announcer{constructor(e){const t=optionize()({respectResponseCollectorProperties:!1,lang:"en"},e);super(t),this.politeElementIndex=0,this.assertiveElementIndex=0,this.ariaLiveContainer=document.createElement("div"),this.ariaLiveContainer.setAttribute("lang",t.lang),this.ariaLiveContainer.setAttribute("id",`aria-live-elements-${ariaLiveAnnouncerIndex}`),this.ariaLiveContainer.setAttribute("style","position: absolute; left: 0px; top: 0px; width: 0px; height: 0px; clip: rect(0px 0px 0px 0px); pointer-events: none;");const n=createBatchOfPriorityLiveElements(AriaLive.POLITE),r=createBatchOfPriorityLiveElements(AriaLive.ASSERTIVE);this.ariaLiveContainer.appendChild(n),this.ariaLiveContainer.appendChild(r),this.politeElements=Array.from(n.children),this.assertiveElements=Array.from(r.children),ariaLiveAnnouncerIndex++}announce(e,t,n){const r=optionize()({ariaLivePriority:AriaLive.POLITE},n);if(this.hasSpoken=!0,e)if(r.ariaLivePriority===AriaLive.POLITE){const s=this.politeElements[this.politeElementIndex];this.updateLiveElement(s,e,t),this.politeElementIndex=(this.politeElementIndex+1)%this.politeElements.length}else if(r.ariaLivePriority===AriaLive.ASSERTIVE){const s=this.assertiveElements[this.assertiveElementIndex];this.updateLiveElement(s,e,t),this.assertiveElementIndex=(this.assertiveElementIndex+1)%this.assertiveElements.length}else assert&&assert(!1,"unsupported aria live prioirity");this.announcementCompleteEmitter.emit(t,e)}cancel(){}cancelUtterance(e){}updateLiveElement(e,t,n){e.textContent="",e.hidden=!1,this.readyToAnnounce=!1,stepTimer.setTimeout(()=>{n.predicate()?(PDOMUtils$1.setTextContent(e,t),stepTimer.setTimeout(()=>{platform.safari?e.hidden=!0:e.textContent="",this.readyToAnnounce=!0},ms.ARIA_LIVE_DELAY)):this.readyToAnnounce=!0},0)}};ms.ARIA_LIVE_DELAY=200,ms.AriaLive=AriaLive;let AriaLiveAnnouncer=ms;utteranceQueueNamespace.register("AriaLiveAnnouncer",AriaLiveAnnouncer);const AriaLiveAnnouncer$1=AriaLiveAnnouncer;class UtteranceWrapper{constructor(e){this.utterance=e,this.timeInQueue=0,this.stableTime=0,this.announcingUtterancePriorityListener=null}resetTimingVariables(){this.timeInQueue=0,this.stableTime=0}}utteranceQueueNamespace.register("UtteranceWrapper",UtteranceWrapper);class UtteranceQueue extends PhetioObject{constructor(e,t){const n=optionize()({debug:!1,initialize:!0,featureSpecificAnnouncingControlPropertyName:null},t);super(n),this.announcer=e,this._initialized=n.initialize,this.featureSpecificAnnouncingControlPropertyName=n.featureSpecificAnnouncingControlPropertyName,this.queue=[],this._muted=!1,this._enabled=!0,this.utteranceToPriorityListenerMap=new Map,this.announcingUtteranceWrapper=null,this.debug=n.debug,this.announcer.announcementCompleteEmitter.addListener(r=>{if(this.announcingUtteranceWrapper&&r===this.announcingUtteranceWrapper.utterance){assert&&assert(this.announcingUtteranceWrapper.announcingUtterancePriorityListener,"announcingUtterancePriorityListener should be set on this.announcingUtteranceWrapper");const s=this.announcingUtteranceWrapper.announcingUtterancePriorityListener;this.announcingUtteranceWrapper.utterance.priorityProperty.hasListener(s)&&(this.announcingUtteranceWrapper.utterance.priorityProperty.unlink(s),this.announcingUtteranceWrapper.announcingUtterancePriorityListener=null,this.announcingUtteranceWrapper=null)}}),this.stepQueueListener=null,this._initialized&&(this.stepQueueListener=this.stepQueue.bind(this),stepTimer.addListener(this.stepQueueListener))}get length(){return this.queue.length}addToBack(e){if(this.initializedAndEnabled)if(!this.announcer.hasSpoken)this.announceImmediately(e);else{const t=this.prepareUtterance(e);this.queue.push(t),this.debug&&console.log("addToBack"),this.addPriorityListenerAndPrioritizeQueue(t)}}addToFront(e){if(deprecationWarning("`addToFront()` has been deprecated because it is confusing, and most of the time doesn't do what is expected, because Utterances are announced based on time-in-queue first, and then position in the queue. It is recommended to use addToBack, and then timing variables on Utterances, or instead call queue.clear() before adding a more important alert to the queue."),!this.initializedAndEnabled)return;const t=this.prepareUtterance(e);this.queue.unshift(t)}addPriorityListenerAndPrioritizeQueue(e){assert&&assert(!this.utteranceToPriorityListenerMap.has(e.utterance),"About to add the priority listener twice and only one should exist on the Utterance. The listener should have been removed by removeOthersAndUpdateUtteranceWrapper.");const t=()=>{this.prioritizeUtterances(e)};e.utterance.priorityProperty.lazyLink(t),this.utteranceToPriorityListenerMap.set(e.utterance,t),this.prioritizeUtterances(e)}prepareUtterance(e){e instanceof Utterance||(e=new Utterance({alert:e}));const t=new UtteranceWrapper(e);return this.removeOthersAndUpdateUtteranceWrapper(t),t.stableTime=0,t}removeUtterance(e){const t=r=>r.utterance===e;assert&&assert(_.find(this.queue,t),"utterance to be removed not found in queue");const n=_.remove(this.queue,t);this.removePriorityListeners(n)}prioritizeUtterances(e){let t=this.queue.indexOf(e);const n=t>=0;let r;n?r=t-1:r=-1;for(let s=r;s>=0;s--){const a=this.queue[s];this.shouldUtteranceCancelOther(e.utterance,a.utterance)&&this.removeUtterance(a.utterance)}if(n){t=this.queue.indexOf(e),assert&&assert(t>-1,"utteranceWrapper is not in queue?");const s=this.queue[t+1];s&&this.shouldUtteranceCancelOther(s.utterance,e.utterance)&&this.removeUtterance(e.utterance)}this.queue.length>0&&this.announcer.onUtterancePriorityChange(this.queue[0].utterance)}shouldUtteranceCancelOther(e,t){return this.announcer.shouldUtteranceCancelOther(e,t)}removeOthersAndUpdateUtteranceWrapper(e){const t=[];for(let r=0;r<this.queue.length;r++){const s=this.queue[r];s.utterance===e.utterance&&t.push(s.timeInQueue)}t.length>=1&&(e.timeInQueue=Math.max(...t));const n=_.remove(this.queue,r=>r.utterance===e.utterance);this.removePriorityListeners(n)}get initializedAndEnabled(){return this._enabled&&this._initialized}getNextUtterance(){let e=null;for(let t=0;t<this.queue.length;t++){const n=this.queue[t];if(n.stableTime>n.utterance.alertStableDelay||n.timeInQueue>n.utterance.alertMaximumDelay){e=n;break}}return e}hasUtterance(e){for(let t=0;t<this.queue.length;t++){const n=this.queue[t];if(e===n.utterance)return!0}return!1}clear(){this.debug&&console.log("UttearnceQueue.clear()"),this.removePriorityListeners(this.queue),this.queue.length=0}cancelUtterance(e){this.announcer.cancelUtterance(e),this.hasUtterance(e)&&this.removeUtterance(e)}cancel(){this.debug&&console.log("UtteranceQueue.cancel()"),this.clear(),this.announcer.cancel()}removePriorityListeners(e){e.forEach(t=>this.removePriorityListener(t.utterance))}removePriorityListener(e){const t=this.utteranceToPriorityListenerMap.get(e);t&&(e.priorityProperty.unlink(t),this.utteranceToPriorityListenerMap.delete(e))}setMuted(e){this._muted=e}set muted(e){this.setMuted(e)}get muted(){return this.getMuted()}getMuted(){return this._muted}setEnabled(e){this._enabled=e}set enabled(e){this.setEnabled(e)}get enabled(){return this.isEnabled()}isEnabled(){return this._enabled}stepQueue(e){if(this._enabled&&(e*=1e3,this.queue.length>0)){for(let n=0;n<this.queue.length;n++){const r=this.queue[n];r.timeInQueue+=e,r.stableTime+=e}const t=this.getNextUtterance();t&&this.attemptToAnnounce(t)}}announceImmediately(e){if(this.initializedAndEnabled&&(this.debug&&console.log("announceImmediately"),e instanceof Utterance||(e=new Utterance({alert:e})),this.announcingUtteranceWrapper===null||this.announcer.shouldUtteranceCancelOther(e,this.announcingUtteranceWrapper.utterance))){const t=this.prepareUtterance(e);t.stableTime=Number.POSITIVE_INFINITY,t.timeInQueue=Number.POSITIVE_INFINITY,this.queue.unshift(t),this.addPriorityListenerAndPrioritizeQueue(t),this.queue.includes(t)&&this.attemptToAnnounce(t)}}attemptToAnnounce(e){const t=e.utterance;if(this.announcer.readyToAnnounce){const n=t.getAlertText(this.announcer.respectResponseCollectorProperties);this.debug&&console.log("ready to announce in attemptToAnnounce(): ",n);const r=!this.featureSpecificAnnouncingControlPropertyName||t[this.featureSpecificAnnouncingControlPropertyName].value,s=t.canAnnounceProperty.value&&t.predicate()&&r;!this._muted&&s&&n!==""?(assert&&assert(this.announcingUtteranceWrapper===null,"announcingUtteranceWrapper and its priorityProperty listener should have been disposed"),this.announcingUtteranceWrapper=e,this.announcingUtteranceWrapper.announcingUtterancePriorityListener=()=>{this.prioritizeUtterances(e)},e.utterance.priorityProperty.link(this.announcingUtteranceWrapper.announcingUtterancePriorityListener),this.debug&&console.log("announcing: ",n),this.announcer.announce(n,t,t.announcerOptions)):this.debug&&console.log("announcer readyToAnnounce but utterance cannot announce, will not be spoken: ",n),this.queue.includes(e)&&this.removeUtterance(e.utterance)}else this.debug&&console.log("announcer not readyToAnnounce")}dispose(){this._initialized&&(assert&&assert(this.stepQueueListener),stepTimer.removeListener(this.stepQueueListener)),super.dispose()}static fromFactory(){const e=new AriaLiveAnnouncer$1,t=new UtteranceQueue(e),n=e.ariaLiveContainer;document.body?document.body.appendChild(n):document.children[0].appendChild(n);let r=0;const s=a=>{const h=a-r;r=a,phet.axon.stepTimer.emit(h/1e3),window.requestAnimationFrame(s)};return window.requestAnimationFrame(s),t}}utteranceQueueNamespace.register("UtteranceQueue",UtteranceQueue);const UtteranceQueue$1=UtteranceQueue,voicingUtteranceQueue=new UtteranceQueue$1(voicingManager$1,{featureSpecificAnnouncingControlPropertyName:"voicingCanAnnounceProperty"});voicingUtteranceQueue.enabled=!1;scenery.register("voicingUtteranceQueue",voicingUtteranceQueue);function assertUtterance(o){if(!(o instanceof Utterance))throw new Error("utterance is not an Utterance")}class OwnedVoicingUtterance extends Utterance{constructor(e){super(e)}}const VOICING_OPTION_KEYS=["voicingNameResponse","voicingObjectResponse","voicingContextResponse","voicingHintResponse","voicingUtterance","voicingResponsePatternCollection","voicingIgnoreVoicingManagerProperties","voicingFocusListener"],Voicing=o=>{assert&&assert(_.includes(inheritance(o),Node$2),"Only Node subtypes should compose Voicing");const e=DelayedMutate$1("Voicing",VOICING_OPTION_KEYS,class gr extends InteractiveHighlighting(o){constructor(...n){super(...n),this._boundInstanceCanVoiceChangeListener=this.onInstanceCanVoiceChange.bind(this),this._voicingUtterance=null,gr.prototype.initialize.call(this)}initialize(...n){return super.initialize&&super.initialize(n),this._voicingCanSpeakProperty=new TinyProperty(!0),this._voicingResponsePacket=new ResponsePacket,this._voicingFocusListener=this.defaultFocusListener,this.setVoicingUtterance(new OwnedVoicingUtterance),this._voicingCanSpeakCount=0,this._boundInstancesChangedListener=this.addOrRemoveInstanceListeners.bind(this),this.changedInstanceEmitter.addListener(this._boundInstancesChangedListener),this._speakContentOnFocusListener={focus:r=>{this._voicingFocusListener&&this._voicingFocusListener(r)}},this.addInputListener(this._speakContentOnFocusListener),this}voicingSpeakFullResponse(n){const r=combineOptions({},n);r.hasOwnProperty("nameResponse")||(r.nameResponse=this._voicingResponsePacket.nameResponse),r.hasOwnProperty("objectResponse")||(r.objectResponse=this._voicingResponsePacket.objectResponse),r.hasOwnProperty("contextResponse")||(r.contextResponse=this._voicingResponsePacket.contextResponse),r.hasOwnProperty("hintResponse")||(r.hintResponse=this._voicingResponsePacket.hintResponse),this.collectAndSpeakResponse(r)}voicingSpeakResponse(n){const r=combineOptions({nameResponse:null,objectResponse:null,contextResponse:null,hintResponse:null},n);this.collectAndSpeakResponse(r)}voicingSpeakNameResponse(n){const r=combineOptions({},n);r.hasOwnProperty("nameResponse")||(r.nameResponse=this._voicingResponsePacket.nameResponse),this.collectAndSpeakResponse(r)}voicingSpeakObjectResponse(n){const r=combineOptions({},n);r.hasOwnProperty("objectResponse")||(r.objectResponse=this._voicingResponsePacket.objectResponse),this.collectAndSpeakResponse(r)}voicingSpeakContextResponse(n){const r=combineOptions({},n);r.hasOwnProperty("contextResponse")||(r.contextResponse=this._voicingResponsePacket.contextResponse),this.collectAndSpeakResponse(r)}voicingSpeakHintResponse(n){const r=combineOptions({},n);r.hasOwnProperty("hintResponse")||(r.hintResponse=this._voicingResponsePacket.hintResponse),this.collectAndSpeakResponse(r)}collectAndSpeakResponse(n){this.speakContent(this.collectResponse(n))}collectResponse(n){const r=combineOptions({ignoreProperties:this._voicingResponsePacket.ignoreProperties,responsePatternCollection:this._voicingResponsePacket.responsePatternCollection,utterance:this.voicingUtterance},n);let s=responseCollector$1.collectResponses(r);return r.utterance&&(r.utterance.alert=s,s=r.utterance),s}speakContent(n){const r=!Tandem.PHET_IO_ENABLED||!this.isInsidePhetioArchetype();n&&r&&voicingUtteranceQueue.addToBack(n)}setVoicingNameResponse(n){this._voicingResponsePacket.nameResponse=n}set voicingNameResponse(n){this.setVoicingNameResponse(n)}get voicingNameResponse(){return this.getVoicingNameResponse()}getVoicingNameResponse(){return this._voicingResponsePacket.nameResponse}setVoicingObjectResponse(n){this._voicingResponsePacket.objectResponse=n}set voicingObjectResponse(n){this.setVoicingObjectResponse(n)}get voicingObjectResponse(){return this.getVoicingObjectResponse()}getVoicingObjectResponse(){return this._voicingResponsePacket.objectResponse}setVoicingContextResponse(n){this._voicingResponsePacket.contextResponse=n}set voicingContextResponse(n){this.setVoicingContextResponse(n)}get voicingContextResponse(){return this.getVoicingContextResponse()}getVoicingContextResponse(){return this._voicingResponsePacket.contextResponse}setVoicingHintResponse(n){this._voicingResponsePacket.hintResponse=n}set voicingHintResponse(n){this.setVoicingHintResponse(n)}get voicingHintResponse(){return this.getVoicingHintResponse()}getVoicingHintResponse(){return this._voicingResponsePacket.hintResponse}setVoicingIgnoreVoicingManagerProperties(n){this._voicingResponsePacket.ignoreProperties=n}set voicingIgnoreVoicingManagerProperties(n){this.setVoicingIgnoreVoicingManagerProperties(n)}get voicingIgnoreVoicingManagerProperties(){return this.getVoicingIgnoreVoicingManagerProperties()}getVoicingIgnoreVoicingManagerProperties(){return this._voicingResponsePacket.ignoreProperties}setVoicingResponsePatternCollection(n){this._voicingResponsePacket.responsePatternCollection=n}set voicingResponsePatternCollection(n){this.setVoicingResponsePatternCollection(n)}get voicingResponsePatternCollection(){return this.getVoicingResponsePatternCollection()}getVoicingResponsePatternCollection(){return this._voicingResponsePacket.responsePatternCollection}setVoicingUtterance(n){this._voicingUtterance!==n&&(this._voicingUtterance&&this.cleanVoicingUtterance(),Voicing.registerUtteranceToVoicingNode(n,this),this._voicingUtterance=n)}set voicingUtterance(n){this.setVoicingUtterance(n)}get voicingUtterance(){return this.getVoicingUtterance()}getVoicingUtterance(){return assertUtterance(this._voicingUtterance),this._voicingUtterance}setVoicingFocusListener(n){this._voicingFocusListener=n}set voicingFocusListener(n){this.setVoicingFocusListener(n)}get voicingFocusListener(){return this.getVoicingFocusListener()}getVoicingFocusListener(){return this._voicingFocusListener}defaultFocusListener(){this.voicingSpeakFullResponse({contextResponse:null})}get isVoicing(){return!0}dispose(){this.removeInputListener(this._speakContentOnFocusListener),this.changedInstanceEmitter.removeListener(this._boundInstancesChangedListener),this._voicingUtterance&&(this.cleanVoicingUtterance(),this._voicingUtterance=null),super.dispose()}clean(){this.removeInputListener(this._speakContentOnFocusListener),this.changedInstanceEmitter.removeListener(this._boundInstancesChangedListener),this._voicingUtterance&&(this.cleanVoicingUtterance(),this._voicingUtterance=null),super.clean&&super.clean()}onInstanceCanVoiceChange(n){n?this._voicingCanSpeakCount++:this._voicingCanSpeakCount--,assert&&assert(this._voicingCanSpeakCount>=0,"the voicingCanSpeakCount should not go below zero"),assert&&assert(this._voicingCanSpeakCount<=this.instances.length,"The voicingCanSpeakCount cannot be greater than the number of Instances."),this._voicingCanSpeakProperty.value=this._voicingCanSpeakCount>0}handleInstancesChanged(n,r){n.visible&&n.voicingVisible&&(this._voicingCanSpeakCount=r?this._voicingCanSpeakCount+1:this._voicingCanSpeakCount-1),this._voicingCanSpeakProperty.value=this._voicingCanSpeakCount>0}addOrRemoveInstanceListeners(n,r){assert&&assert(n.canVoiceEmitter,"Instance must be initialized."),r?n.canVoiceEmitter.addListener(this._boundInstanceCanVoiceChangeListener):n.canVoiceEmitter.removeListener(this._boundInstanceCanVoiceChangeListener),this.handleInstancesChanged(n,r)}cleanVoicingUtterance(){assert&&assert(this._voicingUtterance,"A voicingUtterance must be available to clean."),this._voicingUtterance instanceof OwnedVoicingUtterance?this._voicingUtterance.dispose():this._voicingUtterance&&!this._voicingUtterance.isDisposed&&Voicing.unregisterUtteranceToVoicingNode(this._voicingUtterance,this)}mutate(n){return super.mutate(n)}});return e.prototype._mutatorKeys=VOICING_OPTION_KEYS.concat(e.prototype._mutatorKeys),assert&&assert(e.prototype._mutatorKeys.length===_.uniq(e.prototype._mutatorKeys).length,"duplicate mutator keys in Voicing"),e};Voicing.VOICING_OPTION_KEYS=VOICING_OPTION_KEYS;Voicing.alertUtterance=o=>{assert&&assert(o.voicingCanAnnounceProperties.length>0,"voicingCanAnnounceProperties required, this Utterance might not be connected to Node in the scene graph."),voicingUtteranceQueue.addToBack(o)};Voicing.registerUtteranceToVoicingNode=(o,e)=>{const t=o.voicingCanAnnounceProperties,n=e._voicingCanSpeakProperty;t.includes(n)||(o.voicingCanAnnounceProperties=t.concat([n]))};Voicing.unregisterUtteranceToVoicingNode=(o,e)=>{const t=o.voicingCanAnnounceProperties,n=e._voicingCanSpeakProperty,r=t.indexOf(n);assert&&assert(r>-1,"voicingNode.voicingCanSpeakProperty is not on the Utterance, was it not registered?"),o.voicingCanAnnounceProperties=t.splice(r,1)};Voicing.registerUtteranceToNode=(o,e)=>{const t=o.voicingCanAnnounceProperties;t.includes(e.visibleProperty)||(o.voicingCanAnnounceProperties=o.voicingCanAnnounceProperties.concat([e.visibleProperty])),t.includes(e.voicingVisibleProperty)||(o.voicingCanAnnounceProperties=o.voicingCanAnnounceProperties.concat([e.voicingVisibleProperty]))};Voicing.unregisterUtteranceToNode=(o,e)=>{const t=o.voicingCanAnnounceProperties;assert&&assert(t.includes(e.visibleProperty)&&t.includes(e.voicingVisibleProperty),"visibleProperty and voicingVisibleProperty were not on the Utterance, was it not registered to the node?");const n=t.indexOf(e.visibleProperty),s=t.splice(n,1).indexOf(e.voicingVisibleProperty),a=t.splice(s,1);o.voicingCanAnnounceProperties=a};scenery.register("Voicing",Voicing);class ReadingBlockUtterance extends Utterance{constructor(e,t){super(t),this.readingBlockFocus=e}}scenery.register("ReadingBlockUtterance",ReadingBlockUtterance);const ReadingBlockUtterance$1=ReadingBlockUtterance;class FocusDisplayedController{constructor(e){this.node=null,this.visibilityTracker=null,this.focusProperty=e,this.boundVisibilityListener=this.handleTrailVisibilityChange.bind(this),this.boundInstancesChangedListener=this.handleInstancesChange.bind(this),this.boundNodeDisposedListener=this.handleNodeDisposed.bind(this),this.boundFocusListener=this.handleFocusChange.bind(this),this.focusProperty.link(this.boundFocusListener)}handleFocusChange(e){this.removeDisplayedListeners(),e&&this.addDisplayedListeners(e)}handleTrailVisibilityChange(){this.visibilityTracker&&!this.visibilityTracker.trailVisibleProperty.value&&(this.focusProperty.value=null)}handleInstancesChange(e){e.node&&e.node.instances.length===0&&(this.focusProperty.value=null)}handleNodeDisposed(){this.focusProperty.value=null}addDisplayedListeners(e){assert&&assert(this.visibilityTracker===null,"creating a new TrailVisibilityTracker but the last one was not disposed"),assert&&assert(this.node===null,"Still a reference to the previously focused Node, possible memory leak"),this.visibilityTracker=new TrailVisibilityTracker(e.trail),this.visibilityTracker.addListener(this.boundVisibilityListener),this.node=e.trail.lastNode(),this.node.changedInstanceEmitter.addListener(this.boundInstancesChangedListener),this.node.disposeEmitter.addListener(this.boundNodeDisposedListener)}removeDisplayedListeners(){this.visibilityTracker&&(this.visibilityTracker.removeListener(this.boundVisibilityListener),this.visibilityTracker.dispose(),this.visibilityTracker=null),this.node&&(this.node.changedInstanceEmitter.removeListener(this.boundInstancesChangedListener),this.node.disposeEmitter.removeListener(this.boundNodeDisposedListener),this.node=null)}dispose(){this.removeDisplayedListeners(),this.focusProperty.unlink(this.boundFocusListener),this.node=null,this.visibilityTracker=null}}scenery.register("FocusDisplayedController",FocusDisplayedController);const FocusDisplayedController$1=FocusDisplayedController,ct=class ct{constructor(){this.pointerFocusProperty=new Property(null),this.readingBlockFocusProperty=new Property(null),this.lockedPointerFocusProperty=new Property(null),this.pdomFocusHighlightsVisibleProperty=new BooleanProperty(!0),this.interactiveHighlightsVisibleProperty=new BooleanProperty(!1),this.readingBlockHighlightsVisibleProperty=new BooleanProperty(!1),this.voicingFullyEnabledListener=e=>{this.readingBlockHighlightsVisibleProperty.value=e},voicingManager$1.voicingFullyEnabledProperty.link(this.voicingFullyEnabledListener),this.pointerHighlightsVisibleProperty=new DerivedProperty([this.interactiveHighlightsVisibleProperty,this.readingBlockHighlightsVisibleProperty],(e,t)=>e||t),this.readingBlockFocusController=new FocusDisplayedController$1(this.readingBlockFocusProperty),this.startSpeakingListener=(e,t)=>{this.readingBlockFocusProperty.value=t instanceof ReadingBlockUtterance$1?t.readingBlockFocus:null},voicingManager$1.startSpeakingEmitter.addListener(this.startSpeakingListener),this.endSpeakingListener=(e,t)=>{t instanceof ReadingBlockUtterance$1&&this.readingBlockFocusProperty.value&&(assert&&assert(t.readingBlockFocus,"should be non null focus"),t.readingBlockFocus.trail.equals(this.readingBlockFocusProperty.value.trail)&&(this.readingBlockFocusProperty.value=null))},voicingManager$1.endSpeakingEmitter.addListener(this.endSpeakingListener),this.pointerFocusDisplayedController=new FocusDisplayedController$1(this.pointerFocusProperty),this.lockedPointerFocusDisplayedController=new FocusDisplayedController$1(this.lockedPointerFocusProperty),[this.pointerFocusProperty,this.lockedPointerFocusProperty].forEach(e=>{e.link(this.onPointerFocusChange.bind(this))})}dispose(){this.pointerFocusProperty.dispose(),this.readingBlockFocusProperty.dispose(),this.lockedPointerFocusProperty.dispose(),this.pdomFocusHighlightsVisibleProperty.dispose(),this.interactiveHighlightsVisibleProperty.dispose(),this.readingBlockHighlightsVisibleProperty.dispose(),this.readingBlockFocusController.dispose(),this.pointerFocusDisplayedController.dispose(),this.pointerHighlightsVisibleProperty.dispose(),this.lockedPointerFocusDisplayedController.dispose(),voicingManager$1.startSpeakingEmitter.removeListener(this.startSpeakingListener),voicingManager$1.endSpeakingEmitter.removeListener(this.endSpeakingListener),voicingManager$1.voicingFullyEnabledProperty.unlink(this.voicingFullyEnabledListener)}static updatePDOMFocusFromEvent(e,t,n){if(assert&&assert(document.activeElement,"Must be called from focusin, therefore active elemetn expected"),n)for(let r=0;r<e.length;r++){const s=e[r],a=document.activeElement;if(s.isElementUnderPDOM(a)){const h=a.getAttribute(PDOMUtils$1.DATA_PDOM_UNIQUE_ID);assert&&assert(h,"Event target must have a unique ID on its data if it is in the PDOM.");const c=PDOMInstance$1.uniqueIdToTrail(s,h);assert&&assert(c,"We must have a trail since the target was under the PDOM.");const d=PDOMInstance$1.guessVisualTrail(c,s.rootNode);d.lastNode().focusable?ct.pdomFocus=new Focus(s,d):(t.target.blur(),t.stopImmediatePropagation());break}}else for(let r=0;r<e.length;r++){const s=e[r],a=s._input.getRelatedTargetTrail(t);a&&a.lastNode().focusable?ct.pdomFocus=new Focus(s,PDOMInstance$1.guessVisualTrail(a,s.rootNode)):ct.pdomFocus=null}}onPointerFocusChange(e,t){const n=e==null?void 0:e.trail.lastNode();n&&n.isInteractiveHighlighting&&n.handleHighlightActiveChange();const r=t==null?void 0:t.trail.lastNode();r&&r.isInteractiveHighlighting&&r.handleHighlightActiveChange()}static set pdomFocus(e){if(ct.pdomFocusProperty.value!==e){let t;ct.pdomFocusProperty.value&&(t=ct.pdomFocusedNode),ct.pdomFocusProperty.value=e,t&&!e&&t.blur()}}static get pdomFocus(){return ct.pdomFocusProperty.value}static getPDOMFocusedNode(){let e=null;const t=ct.pdomFocusProperty.get();return t&&(e=t.trail.lastNode()),e}static get pdomFocusedNode(){return this.getPDOMFocusedNode()}static attachToWindow(){assert&&assert(!ct.globallyAttached,"Can only be attached statically once."),ct.attachedWindowFocusListener=()=>{ct._windowHasFocusProperty.value=!0},ct.attachedWindowBlurListener=()=>{ct._windowHasFocusProperty.value=!1},window.addEventListener("focus",ct.attachedWindowFocusListener),window.addEventListener("blur",ct.attachedWindowBlurListener),ct._windowHasFocusProperty.value=document.hasFocus(),ct.globallyAttached=!0}static detachFromWindow(){window.removeEventListener("focus",ct.attachedWindowFocusListener),window.removeEventListener("blur",ct.attachedWindowBlurListener),ct._windowHasFocusProperty.value=!1,ct.globallyAttached=!1}};ct.attachedWindowFocusListener=null,ct.attachedWindowBlurListener=null,ct.globallyAttached=!1,ct.pdomFocusProperty=new Property(null,{tandem:Tandem.GENERAL_MODEL.createTandem("pdomFocusProperty"),phetioDocumentation:"Stores the current focus in the Parallel DOM, null if nothing has focus. This is not updated based on mouse or touch input, only keyboard and other alternative inputs. Note that this only applies to simulations that support alternative input.",phetioValueType:NullableIO(Focus.FocusIO),phetioState:!1,phetioFeatured:!0,phetioReadOnly:!0}),ct._windowHasFocusProperty=new BooleanProperty(!1),ct.windowHasFocusProperty=ct._windowHasFocusProperty;let FocusManager=ct;scenery.register("FocusManager",FocusManager);const OUTER_FOCUS_COLOR=new Color("rgba(212,19,106,0.5)"),INNER_FOCUS_COLOR=new Color("rgba(250,40,135,0.9)"),INNER_LIGHT_GROUP_FOCUS_COLOR=new Color("rgba(233,113,166,1.0)"),OUTER_LIGHT_GROUP_FOCUS_COLOR=new Color("rgba(233,113,166,1.0)"),INNER_DARK_GROUP_FOCUS_COLOR=new Color("rgba(159,15,80,1.0)"),OUTER_DARK_GROUP_FOCUS_COLOR=new Color("rgba(159,15,80,1.0)"),INNER_LINE_WIDTH_BASE=2.5,OUTER_LINE_WIDTH_BASE=4,GROUP_OUTER_LINE_WIDTH=2,GROUP_INNER_LINE_WIDTH=2,Ot=class Ot extends Path{constructor(e,t){const n=optionize()({outerStroke:OUTER_FOCUS_COLOR,innerStroke:INNER_FOCUS_COLOR,outerLineWidth:null,innerLineWidth:null,dashed:!1,transformSourceNode:null},t);super(e),this.highlightChangedEmitter=new Emitter,this._innerHighlightColor=n.innerStroke,this._outerHighlightColor=n.outerStroke;const r=_.pick(n,Object.keys(Path.DEFAULT_PATH_OPTIONS));this.innerLineWidth=n.innerLineWidth,this.outerLineWidth=n.outerLineWidth,this.transformSourceNode=n.transformSourceNode,n.stroke=n.outerStroke,this.mutate(n);const s=combineOptions({},r,{stroke:n.innerStroke});this.innerHighlightPath=new Path(e,s),this.addChild(this.innerHighlightPath),this.updateLineWidth(),n.dashed&&this.makeDashed(!0)}mutateWithInnerHighlight(e){super.mutate(e),this.innerHighlightPath&&this.innerHighlightPath.mutate(e),this.highlightChangedEmitter.emit()}makeDashed(e){const t=e?[7,7]:[];this.mutateWithInnerHighlight({lineDash:t})}setShape(e){return super.setShape(e),this.innerHighlightPath&&this.innerHighlightPath.setShape(e),this.highlightChangedEmitter&&this.highlightChangedEmitter.emit(),this}updateLineWidth(e){e=e||this,this.lineWidth=this.getOuterLineWidth(e),this.innerHighlightPath.lineWidth=this.getInnerLineWidth(e),this.highlightChangedEmitter.emit()}getOuterLineWidth(e){return this.outerLineWidth?this.outerLineWidth:Ot.getOuterLineWidthFromNode(e)}getInnerLineWidth(e){return this.innerLineWidth?this.innerLineWidth:Ot.getInnerLineWidthFromNode(e)}setInnerHighlightColor(e){this._innerHighlightColor=e,this.innerHighlightPath.setStroke(e),this.highlightChangedEmitter.emit()}set innerHighlightColor(e){this.setInnerHighlightColor(e)}get innerHighlightColor(){return this.getInnerHighlightColor()}getInnerHighlightColor(){return this._innerHighlightColor}setOuterHighlightColor(e){this._outerHighlightColor=e,this.setStroke(e),this.highlightChangedEmitter.emit()}set outerHighlightColor(e){this.setOuterHighlightColor(e)}get outerHighlightColor(){return this.getOuterHighlightColor()}getOuterHighlightColor(){return this._outerHighlightColor}getUniqueHighlightTrail(e){assert&&assert(this.transformSourceNode,"getUniqueHighlightTrail requires a transformSourceNode");const t=this.transformSourceNode;let n=null;if(t.instances.length<=1)n=t.getUniqueTrail();else{const r=t.getTrails().filter(s=>s.isExtensionOf(e,!0));assert&&assert(r.length===1,"No unique trail to highlight, either avoid DAG for transformSourceNode or don't use transformSourceNode with HighlightPath"),n=r[0]}return assert&&assert(n,"no unique Trail found for getUniqueHighlightTrail"),n}static getInnerLineWidthFromNode(e){return INNER_LINE_WIDTH_BASE/Ot.getWidthMagnitudeFromTransform(e)}static getOuterLineWidthFromNode(e){return OUTER_LINE_WIDTH_BASE/Ot.getWidthMagnitudeFromTransform(e)}static getWidthMagnitudeFromTransform(e){return e.transform.transformDelta2(Vector2.X_UNIT).magnitude}static getDilationCoefficient(e){return Ot.getOuterLineWidthFromNode(e)*(.5+.25)}static getGroupDilationCoefficient(e){return Ot.getOuterLineWidthFromNode(e)*(.5+1.4)}};Ot.OUTER_FOCUS_COLOR=OUTER_FOCUS_COLOR,Ot.INNER_FOCUS_COLOR=INNER_FOCUS_COLOR,Ot.INNER_LIGHT_GROUP_FOCUS_COLOR=INNER_LIGHT_GROUP_FOCUS_COLOR,Ot.OUTER_LIGHT_GROUP_FOCUS_COLOR=OUTER_LIGHT_GROUP_FOCUS_COLOR,Ot.INNER_DARK_GROUP_FOCUS_COLOR=INNER_DARK_GROUP_FOCUS_COLOR,Ot.OUTER_DARK_GROUP_FOCUS_COLOR=OUTER_DARK_GROUP_FOCUS_COLOR,Ot.GROUP_OUTER_LINE_WIDTH=GROUP_OUTER_LINE_WIDTH,Ot.GROUP_INNER_LINE_WIDTH=GROUP_INNER_LINE_WIDTH;let HighlightPath=Ot;scenery.register("HighlightPath",HighlightPath);const HighlightPath$1=HighlightPath;class GroupHighlightPath extends HighlightPath$1{constructor(e,t){const n=optionize()({outerStroke:HighlightPath$1.OUTER_LIGHT_GROUP_FOCUS_COLOR,innerStroke:HighlightPath$1.INNER_LIGHT_GROUP_FOCUS_COLOR,outerLineWidth:HighlightPath$1.GROUP_OUTER_LINE_WIDTH,innerLineWidth:HighlightPath$1.GROUP_INNER_LINE_WIDTH},t);super(e,n)}}scenery.register("GroupHighlightPath",GroupHighlightPath);class HighlightFromNode extends HighlightPath$1{constructor(e,t){const n=optionize()({useLocalBounds:!0,dilationCoefficient:null,useGroupDilation:!1},t);n.transformSourceNode=e,super(null,n),this.observedBoundsProperty=null,this.boundsListener=null,this.useLocalBounds=n.useLocalBounds,this.useGroupDilation=n.useGroupDilation,this.dilationCoefficient=n.dilationCoefficient,e&&this.setShapeFromNode(e)}setShapeFromNode(e){this.observedBoundsProperty&&(assert&&assert(this.boundsListener,"should be a listener if there is a previous focusHighlightNode"),this.observedBoundsProperty.unlink(this.boundsListener)),this.observedBoundsProperty=e.localBoundsProperty,this.boundsListener=t=>{if(!t.isFinite())return;let n=this.dilationCoefficient;this.dilationCoefficient===null&&(n=this.useGroupDilation?HighlightPath$1.getGroupDilationCoefficient(e):HighlightPath$1.getDilationCoefficient(e));const s=(this.useLocalBounds?e.getVisibleLocalBounds():e.getVisibleBounds()).dilated(n);this.updateLineWidthFromNode(e),this.setShape(Shape$1.bounds(s))},this.observedBoundsProperty.link(this.boundsListener)}updateLineWidthFromNode(e){this.lineWidth=this.getOuterLineWidth(e),this.innerHighlightPath.lineWidth=this.getInnerLineWidth(e)}}scenery.register("HighlightFromNode",HighlightFromNode);const HighlightFromNode$1=HighlightFromNode;class ReadingBlockHighlight extends HighlightFromNode$1{constructor(e,t){const n=optionize()({outerStroke:"grey",innerStroke:"black"},t);super(e,n)}}scenery.register("ReadingBlockHighlight",ReadingBlockHighlight);const READING_BLOCK_OPTION_KEYS=["readingBlockTagName","readingBlockNameResponse","readingBlockHintResponse","readingBlockResponsePatternCollection","readingBlockActiveHighlight"];function assertReadingBlockUtterance(o){o instanceof ReadingBlockUtterance$1||assert&&assert(!1,"utterance is not a ReadinBlockUtterance")}class OwnedReadingBlockUtterance extends ReadingBlockUtterance$1{constructor(e,t){super(e,t)}}const DEFAULT_CONTENT_HINT_PATTERN=new ResponsePatternCollection({nameHint:"{{NAME}}. {{HINT}}"}),ReadingBlock=memoize(o=>{const e=DelayedMutate$1("ReadingBlock",READING_BLOCK_OPTION_KEYS,class extends Voicing(o){constructor(...n){super(...n),this._readingBlockTagName="button",this._readingBlockDisabledTagName="p",this._readingBlockActiveHighlight=null,this.readingBlockActiveHighlightChangedEmitter=new TinyEmitter,this.readingBlockResponsePatternCollection=DEFAULT_CONTENT_HINT_PATTERN,this._localBoundsChangedListener=this._onLocalBoundsChanged.bind(this),this.localBoundsProperty.link(this._localBoundsChangedListener),this._readingBlockInputListener={focus:r=>this._speakReadingBlockContentListener(r),up:r=>this._speakReadingBlockContentListener(r),click:r=>this._speakReadingBlockContentListener(r)},this._readingBlockFocusableChangeListener=this._onReadingBlockFocusableChanged.bind(this),voicingManager$1.speechAllowedAndFullyEnabledProperty.link(this._readingBlockFocusableChangeListener),this.focusHighlight=new ReadingBlockHighlight(this),this.voicingUtterance=new OwnedReadingBlockUtterance(null)}get isReadingBlock(){return!0}setReadingBlockTagName(n){this._readingBlockTagName=n,this._onReadingBlockFocusableChanged(voicingManager$1.speechAllowedAndFullyEnabledProperty.value)}set readingBlockTagName(n){this.setReadingBlockTagName(n)}get readingBlockTagName(){return this.getReadingBlockTagName()}getReadingBlockTagName(){return this._readingBlockTagName}setReadingBlockNameResponse(n){this._voicingResponsePacket.nameResponse=n}set readingBlockNameResponse(n){this.setReadingBlockNameResponse(n)}get readingBlockNameResponse(){return this.getReadingBlockNameResponse()}getReadingBlockNameResponse(){return this._voicingResponsePacket.nameResponse}setReadingBlockHintResponse(n){this._voicingResponsePacket.hintResponse=n}set readingBlockHintResponse(n){this.setReadingBlockHintResponse(n)}get readingBlockHintResponse(){return this.getReadingBlockHintResponse()}getReadingBlockHintResponse(){return this._voicingResponsePacket.hintResponse}setReadingBlockResponsePatternCollection(n){this._voicingResponsePacket.responsePatternCollection=n}set readingBlockResponsePatternCollection(n){this.setReadingBlockResponsePatternCollection(n)}get readingBlockResponsePatternCollection(){return this.getReadingBlockResponsePatternCollection()}getReadingBlockResponsePatternCollection(){return this._voicingResponsePacket.responsePatternCollection}setVoicingUtterance(n){super.setVoicingUtterance(n)}set voicingUtterance(n){super.voicingUtterance=n}get voicingUtterance(){return this.getVoicingUtterance()}getVoicingUtterance(){const n=super.getVoicingUtterance();return assertReadingBlockUtterance(n),n}setVoicingNameResponse(){assert&&assert(!1,"ReadingBlocks only support setting the name response via readingBlockNameResponse")}getVoicingNameResponse(){assert&&assert(!1,"ReadingBlocks only support getting the name response via readingBlockNameResponse")}setVoicingObjectResponse(){assert&&assert(!1,"ReadingBlocks do not support setting object response")}getVoicingObjectResponse(){assert&&assert(!1,"ReadingBlocks do not support setting object response")}setVoicingContextResponse(){assert&&assert(!1,"ReadingBlocks do not support setting context response")}getVoicingContextResponse(){assert&&assert(!1,"ReadingBlocks do not support setting context response")}setVoicingHintResponse(){assert&&assert(!1,"ReadingBlocks only support setting the hint response via readingBlockHintResponse.")}getVoicingHintResponse(){assert&&assert(!1,"ReadingBlocks only support getting the hint response via readingBlockHintResponse.")}setVoicingResponsePatternCollection(){assert&&assert(!1,"ReadingBlocks only support setting the response patterns via readingBlockResponsePatternCollection.")}getVoicingResponsePatternCollection(){assert&&assert(!1,"ReadingBlocks only support getting the response patterns via readingBlockResponsePatternCollection.")}setReadingBlockActiveHighlight(n){this._readingBlockActiveHighlight!==n&&(this._readingBlockActiveHighlight=n,this.readingBlockActiveHighlightChangedEmitter.emit())}set readingBlockActiveHighlight(n){this.setReadingBlockActiveHighlight(n)}get readingBlockActiveHighlight(){return this._readingBlockActiveHighlight}getReadingBlockActiveHighlight(){return this._readingBlockActiveHighlight}isReadingBlockActivated(){let n=!1;const r=Object.keys(this.displays);for(let s=0;s<r.length;s++){const a=this.displays[r[s]].focusManager.readingBlockFocusProperty.value;if(a&&a.trail.lastNode()===this){n=!0;break}}return n}get readingBlockActivated(){return this.isReadingBlockActivated()}_onReadingBlockFocusableChanged(n){this.focusable=n,n?(this.tagName=this._readingBlockTagName,this.hasInputListener(this._readingBlockInputListener)||this.addInputListener(this._readingBlockInputListener)):(this.tagName=this._readingBlockDisabledTagName,this.hasInputListener(this._readingBlockInputListener)&&this.removeInputListener(this._readingBlockInputListener))}_onLocalBoundsChanged(n){this.mouseArea=n,this.touchArea=n}_speakReadingBlockContentListener(n){const r=this.getConnectedDisplays(),s=this.voicingUtterance,a=this.collectResponse({nameResponse:this.getReadingBlockNameResponse(),hintResponse:this.getReadingBlockHintResponse(),ignoreProperties:this.voicingIgnoreVoicingManagerProperties,responsePatternCollection:this._voicingResponsePacket.responsePatternCollection,utterance:s});if(a){for(let h=0;h<r.length;h++)if(!this.getDescendantsUseHighlighting(n.trail)){const c=n.trail.subtrailTo(this),d=PDOMInstance$1.guessVisualTrail(c,r[h].rootNode),y=new Focus(r[h],d);s.readingBlockFocus=y,this.speakContent(a)}}}cleanVoicingUtterance(){this._voicingUtterance instanceof OwnedReadingBlockUtterance&&this._voicingUtterance.dispose(),super.cleanVoicingUtterance()}dispose(){voicingManager$1.speechAllowedAndFullyEnabledProperty.unlink(this._readingBlockFocusableChangeListener),this.localBoundsProperty.unlink(this._localBoundsChangedListener),this.hasInputListener(this._readingBlockInputListener)&&this.removeInputListener(this._readingBlockInputListener),super.dispose()}mutate(n){return super.mutate(n)}});return e.prototype._mutatorKeys=READING_BLOCK_OPTION_KEYS.concat(e.prototype._mutatorKeys),assert&&assert(e.prototype._mutatorKeys.length===_.uniq(e.prototype._mutatorKeys).length,"x mutator keys in ReadingBlock"),e});scenery.register("ReadingBlock",ReadingBlock);const KeyboardZoomUtils={isPlatformMac:()=>_.includes(window.navigator.platform,"Mac"),getPlatformZoomMetaKey:()=>KeyboardZoomUtils.isPlatformMac()?"metaKey":"ctrlKey",isZoomCommand:(o,e)=>{const t=e?KeyboardUtils.KEY_EQUALS:KeyboardUtils.KEY_MINUS,n=KeyboardZoomUtils.getPlatformZoomMetaKey();return o[n]&&KeyboardUtils.isKeyEvent(o,t)},isZoomResetCommand:o=>{const e=KeyboardZoomUtils.getPlatformZoomMetaKey();return o[e]&&KeyboardUtils.isKeyEvent(o,KeyboardUtils.KEY_0)}};scenery.register("KeyboardZoomUtils",KeyboardZoomUtils);const keyboardTestingSchema={INPUT:[...KeyboardUtils.ARROW_KEYS,KeyboardUtils.KEY_PAGE_UP,KeyboardUtils.KEY_PAGE_DOWN,KeyboardUtils.KEY_HOME,KeyboardUtils.KEY_END,KeyboardUtils.KEY_ENTER,KeyboardUtils.KEY_SPACE],DIV:[...KeyboardUtils.ARROW_KEYS,...KeyboardUtils.WASD_KEYS],P:[KeyboardUtils.KEY_ESCAPE],BUTTON:[KeyboardUtils.KEY_ENTER,KeyboardUtils.KEY_SPACE]},ALL_KEYS=KeyboardUtils.ALL_KEYS,MAX_MS_KEY_HOLD_DOWN=100,NEXT_ELEMENT_THRESHOLD=.1,DO_KNOWN_KEYS_THRESHOLD=.6,CLICK_EVENT_THRESHOLD=DO_KNOWN_KEYS_THRESHOLD+.1,KEY_DOWN="keydown",KEY_UP="keyup";class KeyboardFuzzer{constructor(e,t){this.display=e,this.random=new Random({seed:t}),this.numberOfComponentsTested=10,this.keyupListeners=[],this.currentElement=null}chooseNextElement(){if(this.currentElement===null)this.currentElement=document.activeElement;else if(this.random.nextDouble()<NEXT_ELEMENT_THRESHOLD){sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.KeyboardFuzzer("choosing new element"),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.push(),this.clearListeners();const e=PDOMUtils$1.getRandomFocusable(this.random);e.focus(),this.currentElement=e,sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.pop()}}clearListeners(){this.keyupListeners.forEach(e=>{assert&&assert(typeof e.timeout=="function","should have an attached timeout"),stepTimer.clearTimeout(e.timeout),e(),assert&&assert(!this.keyupListeners.includes(e),"calling listener should remove itself from the keyupListeners.")})}triggerClickEvent(){sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.KeyboardFuzzer("triggering click"),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.push();const e=document.activeElement;e instanceof HTMLElement&&e.click(),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.pop()}triggerKeyDownUpEvents(e){sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.KeyboardFuzzer(`trigger keydown/up: ${e}`),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.push(),this.triggerDOMEvent(KEY_DOWN,e);const t=this.random.nextInt(MAX_MS_KEY_HOLD_DOWN),n=()=>{this.triggerDOMEvent(KEY_UP,e),this.keyupListeners.includes(n)&&this.keyupListeners.splice(this.keyupListeners.indexOf(n),1)};n.timeout=stepTimer.setTimeout(n,t===MAX_MS_KEY_HOLD_DOWN?2e3:t),this.keyupListeners.push(n),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.pop()}triggerRandomKeyDownUpEvents(e){const t=ALL_KEYS[Math.floor(this.random.nextDouble()*(ALL_KEYS.length-1))];sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.KeyboardFuzzer(`trigger random keydown/up: ${t}`),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.push(),this.triggerKeyDownUpEvents(t),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.pop()}fuzzBoardEvents(e){if(this.display&&this.display._input&&this.display._input.pdomPointer){const t=this.display._input.pdomPointer;t&&!t.blockTrustedEvents&&(t.blockTrustedEvents=!0)}for(let t=0;t<this.numberOfComponentsTested;t++){this.chooseNextElement();for(let n=0;n<e/this.numberOfComponentsTested;n++){sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.KeyboardFuzzer(`main loop, i=${n}`),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.push();const r=document.activeElement;if(r&&keyboardTestingSchema[r.tagName.toUpperCase()]){const s=this.random.nextDouble();if(s<DO_KNOWN_KEYS_THRESHOLD){const a=keyboardTestingSchema[r.tagName],h=this.random.sample(a);this.triggerKeyDownUpEvents(h)}else s<CLICK_EVENT_THRESHOLD?this.triggerClickEvent():this.triggerRandomKeyDownUpEvents(r)}else r&&this.triggerRandomKeyDownUpEvents(r);sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.pop()}}}triggerDOMEvent(e,t){if(document.activeElement){const n=new KeyboardEvent(e,{bubbles:!0,code:t,shiftKey:globalKeyStateTracker$1.shiftKeyDown,altKey:globalKeyStateTracker$1.altKeyDown,ctrlKey:globalKeyStateTracker$1.ctrlKeyDown});document.activeElement.dispatchEvent(n)}}}scenery.register("KeyboardFuzzer",KeyboardFuzzer);class GroupHighlightFromNode extends HighlightFromNode$1{constructor(e,t){const n=optionize()({outerStroke:HighlightPath$1.OUTER_LIGHT_GROUP_FOCUS_COLOR,innerStroke:HighlightPath$1.INNER_LIGHT_GROUP_FOCUS_COLOR,outerLineWidth:HighlightPath$1.GROUP_OUTER_LINE_WIDTH,innerLineWidth:HighlightPath$1.GROUP_INNER_LINE_WIDTH,useGroupDilation:!0},t);super(e,n)}}scenery.register("GroupHighlightFromNode",GroupHighlightFromNode);const ACTIVATED_HIGHLIGHT_COLOR="rgba(255,255,0,0.5)",bn=class bn extends HighlightFromNode$1{constructor(e,t){const n=optionize()({innerStroke:null,outerStroke:null,fill:ACTIVATED_HIGHLIGHT_COLOR},t);super(e,n)}};bn.ACTIVATED_HIGHLIGHT_COLOR=ACTIVATED_HIGHLIGHT_COLOR;let ActivatedReadingBlockHighlight=bn;scenery.register("ActivatedReadingBlockHighlight",ActivatedReadingBlockHighlight);const ActivatedReadingBlockHighlight$1=ActivatedReadingBlockHighlight,PRIMARY_SIBLING="PRIMARY_SIBLING",LABEL_SIBLING="LABEL_SIBLING",DESCRIPTION_SIBLING="DESCRIPTION_SIBLING",CONTAINER_PARENT="CONTAINER_PARENT",LABEL_TAG=PDOMUtils$1.TAGS.LABEL,INPUT_TAG=PDOMUtils$1.TAGS.INPUT,DISABLED_ATTRIBUTE_NAME="disabled",OBSERVER_CONFIG={attributes:!1,childList:!0,characterData:!0};let globalId$4=1;const scratchGlobalBounds=new Bounds2(0,0,0,0),scratchSiblingBounds=new Bounds2(0,0,0,0),globalNodeTranslationMatrix=new Matrix3,globalToClientScaleMatrix=new Matrix3,nodeScaleMagnitudeMatrix=new Matrix3;class PDOMPeer{constructor(e,t){this.initializePDOMPeer(e,t)}initializePDOMPeer(e,t){return t=merge({primarySibling:null},t),assert&&assert(!this.id||this.isDisposed,"If we previously existed, we need to have been disposed"),this.id=this.id||globalId$4++,this.pdomInstance=e,this.node=this.pdomInstance.node,this.display=e.display,this.trail=e.trail,this.visible=null,this.focusable=null,this._labelSibling=null,this._descriptionSibling=null,this._containerParent=null,this.topLevelElements=[],this.positionDirty=!1,this.forceReflowWorkaround=!1,this.childPositionDirty=!1,this.positionInPDOM=!1,this.mutationObserver=this.mutationObserver||new MutationObserver(this.invalidateCSSPositioning.bind(this,!1)),this.transformListener=this.transformListener||this.invalidateCSSPositioning.bind(this,!1),this.pdomInstance.transformTracker.addListener(this.transformListener),this._preservedDisabledValue=null,this.isDisposed=!1,this.pdomInstance.isRootInstance&&(this._primarySibling=t.primarySibling,this._primarySibling.classList.add(PDOMSiblingStyle$1.ROOT_CLASS_NAME),PDOMUtils$1.BLOCKED_DOM_EVENTS.forEach(n=>{this._primarySibling.addEventListener(n,r=>{r.stopPropagation()})})),this}update(e){let t=this.node.getBaseOptions();const n=[];this.node.accessibleName!==null&&(t=this.node.accessibleNameBehavior(this.node,t,this.node.accessibleName,n),assert&&assert(typeof t=="object","should return an object")),this.node.pdomHeading!==null&&(t=this.node.pdomHeadingBehavior(this.node,t,this.node.pdomHeading,n),assert&&assert(typeof t=="object","should return an object")),this.node.helpText!==null&&(t=this.node.helpTextBehavior(this.node,t,this.node.helpText,n),assert&&assert(typeof t=="object","should return an object")),this._primarySibling=createElement(t.tagName,this.node.focusable,{namespace:t.pdomNamespace}),t.containerTagName&&(this._containerParent=createElement(t.containerTagName,!1)),t.labelTagName&&(this._labelSibling=createElement(t.labelTagName,!1,{excludeFromInput:this.node.excludeLabelSiblingFromInput})),t.descriptionTagName&&(this._descriptionSibling=createElement(t.descriptionTagName,!1)),e&&this.updateIndicesStringAndElementIds(),this.orderElements(t),this.mutationObserver.disconnect(),this.mutationObserver.observe(this._primarySibling,OBSERVER_CONFIG),t.labelContent&&t.labelTagName!==null&&this.setLabelSiblingContent(t.labelContent),t.innerContent&&t.tagName!==null&&this.setPrimarySiblingContent(t.innerContent),t.descriptionContent&&t.descriptionTagName!==null&&this.setDescriptionSiblingContent(t.descriptionContent),t.tagName.toUpperCase()===INPUT_TAG&&t.inputType&&this.setAttributeToElement("type",t.inputType),t.labelTagName&&t.labelTagName.toUpperCase()===LABEL_TAG&&this.setAttributeToElement("for",this._primarySibling.id,{elementName:PDOMPeer.LABEL_SIBLING}),this.setFocusable(this.node.focusable),this.setPositionInPDOM(this.node.positionInPDOM),this.onAriaLabelledbyAssociationChange(),this.onAriaDescribedbyAssociationChange(),this.onActiveDescendantAssociationChange(),this.onAttributeChange(t),this.onClassChange(),this.onInputValueChange(),this.node.updateOtherNodesAriaLabelledby(),this.node.updateOtherNodesAriaDescribedby(),this.node.updateOtherNodesActiveDescendant(),n.forEach(r=>{assert&&assert(typeof r=="function"),r()})}orderElements(e){this._containerParent?(this._containerParent.insertBefore(this._primarySibling,this._containerParent.children[0]||null),this.topLevelElements=[this._containerParent]):this.topLevelElements=[this._labelSibling,this._descriptionSibling,this._primarySibling].filter(_.identity),this._labelSibling&&this.arrangeContentElement(this._labelSibling,e.appendLabel),this._descriptionSibling&&this.arrangeContentElement(this._descriptionSibling,e.appendDescription)}getPrimarySibling(){return this._primarySibling}get primarySibling(){return this.getPrimarySibling()}getLabelSibling(){return this._labelSibling}get labelSibling(){return this.getLabelSibling()}getDescriptionSibling(){return this._descriptionSibling}get descriptionSibling(){return this.getDescriptionSibling()}getContainerParent(){return this._containerParent}get containerParent(){return this.getContainerParent()}getTopLevelElementContainingPrimarySibling(){return this._containerParent||this._primarySibling}onAriaLabelledbyAssociationChange(){this.removeAttributeFromAllElements("aria-labelledby");for(let e=0;e<this.node.ariaLabelledbyAssociations.length;e++){const t=this.node.ariaLabelledbyAssociations[e];assert&&assert(t.otherNode.nodesThatAreAriaLabelledbyThisNode.indexOf(this.node)>=0,"unexpected otherNode"),this.setAssociationAttribute("aria-labelledby",t)}}onAriaDescribedbyAssociationChange(){this.removeAttributeFromAllElements("aria-describedby");for(let e=0;e<this.node.ariaDescribedbyAssociations.length;e++){const t=this.node.ariaDescribedbyAssociations[e];assert&&assert(t.otherNode.nodesThatAreAriaDescribedbyThisNode.indexOf(this.node)>=0,"unexpected otherNode"),this.setAssociationAttribute("aria-describedby",t)}}onActiveDescendantAssociationChange(){this.removeAttributeFromAllElements("aria-activedescendant");for(let e=0;e<this.node.activeDescendantAssociations.length;e++){const t=this.node.activeDescendantAssociations[e];assert&&assert(t.otherNode.nodesThatAreActiveDescendantToThisNode.indexOf(this.node)>=0,"unexpected otherNode"),this.setAssociationAttribute("aria-activedescendant",t)}}handleAttributeWithPDOMOption(e,t){typeof t=="string"?this.setAttributeToElement(e,t):this.removeAttributeFromElement(e)}onAttributeChange(e){for(let t=0;t<this.node.pdomAttributes.length;t++){const n=this.node.pdomAttributes[t];this.setAttributeToElement(n.attribute,n.value,n.options)}this.handleAttributeWithPDOMOption("aria-label",e.ariaLabel),this.handleAttributeWithPDOMOption("role",e.ariaRole)}onClassChange(){for(let e=0;e<this.node.pdomClasses.length;e++){const t=this.node.pdomClasses[e];this.setClassToElement(t.className,t.options)}}onInputValueChange(){if(assert&&assert(this.node.inputValue!==void 0,"use null to remove input value attribute"),this.node.inputValue===null)this.removeAttributeFromElement("value");else{const e=`${this.node.inputValue}`;this.setAttributeToElement("value",e,{asProperty:!0})}}getElementByName(e){if(e===PDOMPeer.PRIMARY_SIBLING)return this._primarySibling;if(e===PDOMPeer.LABEL_SIBLING)return this._labelSibling;if(e===PDOMPeer.DESCRIPTION_SIBLING)return this._descriptionSibling;if(e===PDOMPeer.CONTAINER_PARENT)return this._containerParent;throw new Error(`invalid elementName name: ${e}`)}setAttributeToElement(e,t,n){n=merge({namespace:null,asProperty:!1,elementName:PRIMARY_SIBLING,element:null},n);const r=n.element||this.getElementByName(n.elementName),s=PDOMUtils$1.unwrapProperty(t);let a=s;typeof s=="string"&&(a=stripEmbeddingMarks(s)),e===DISABLED_ATTRIBUTE_NAME&&!this.display.interactive&&(this._preservedDisabledValue=n.asProperty?a:!0),n.namespace?r.setAttributeNS(n.namespace,e,a):n.asProperty?r[e]=a:r.setAttribute(e,a)}removeAttributeFromElement(e,t){t=merge({namespace:null,elementName:PRIMARY_SIBLING,element:null},t);const n=t.element||this.getElementByName(t.elementName);t.namespace?n.removeAttributeNS(t.namespace,e):e===DISABLED_ATTRIBUTE_NAME&&!this.display.interactive?this._preservedDisabledValue=!1:n.removeAttribute(e)}removeAttributeFromAllElements(e){assert&&assert(e!==DISABLED_ATTRIBUTE_NAME,"this method does not currently support disabled, to make Display.interactive toggling easier to implement"),assert&&assert(typeof e=="string"),this._primarySibling&&this._primarySibling.removeAttribute(e),this._labelSibling&&this._labelSibling.removeAttribute(e),this._descriptionSibling&&this._descriptionSibling.removeAttribute(e),this._containerParent&&this._containerParent.removeAttribute(e)}setClassToElement(e,t){assert&&assert(typeof e=="string"),t=merge({elementName:PRIMARY_SIBLING},t),this.getElementByName(t.elementName).classList.add(e)}removeClassFromElement(e,t){assert&&assert(typeof e=="string"),t=merge({elementName:PRIMARY_SIBLING},t),this.getElementByName(t.elementName).classList.remove(e)}setAssociationAttribute(e,t){assert&&assert(PDOMUtils$1.ASSOCIATION_ATTRIBUTES.indexOf(e)>=0,`unsupported attribute for setting with association object: ${e}`);const n=t.otherNode.getPDOMInstances();if(n.length>0){const r=n[0];r===this.pdomInstance&&(r.peer=this),assert&&assert(r.peer,"peer should exist");const s=r.peer.getElementByName(t.otherElementName),a=this.getElementByName(t.thisElementName);if(a&&s){const h=a.getAttribute(e)||"";assert&&assert(typeof h=="string");const c=[h.trim(),s.id].join(" ").trim();this.setAttributeToElement(e,c,{elementName:t.thisElementName})}}}arrangeContentElement(e,t){if(this.topLevelElements[0]===this._containerParent)assert&&assert(this.topLevelElements.length===1),t?this._containerParent.appendChild(e):this._containerParent.insertBefore(e,this._primarySibling);else{arrayRemove(this.topLevelElements,e);const n=this.topLevelElements.indexOf(this._primarySibling),r=t?this.topLevelElements.length:n;this.topLevelElements.splice(r,0,e)}}isVisible(){if(assert){let e=0;this.topLevelElements.forEach(t=>{!t.hidden&&!t.hasAttribute("hidden")&&(e+=1)}),assert(this.visible?e===this.topLevelElements.length:e===0,"some of the peer's elements are visible and some are not")}return this.visible===null?!0:this.visible}setVisible(e){if(assert&&assert(typeof e=="boolean"),this.visible!==e){this.visible=e;for(let t=0;t<this.topLevelElements.length;t++){const n=this.topLevelElements[t];e?this.removeAttributeFromElement("hidden",{element:n}):this.setAttributeToElement("hidden","",{element:n})}this.invalidateCSSPositioning(platform.safari)}}isFocused(){const e=PDOMInstance$1.guessVisualTrail(this.trail,this.display.rootNode);return FocusManager.pdomFocusProperty.value&&FocusManager.pdomFocusProperty.value.trail.equals(e)}focus(){assert&&assert(this._primarySibling,"must have a primary sibling to focus"),FocusManager.windowHasFocusProperty.value&&this._primarySibling.focus()}blur(){assert&&assert(this._primarySibling,"must have a primary sibling to blur"),this._primarySibling.blur()}setFocusable(e){assert&&assert(typeof e=="boolean");const t=this.isFocused();this.focusable!==e&&(this.focusable=e,PDOMUtils$1.overrideFocusWithTabIndex(this.primarySibling,e),t&&!e&&this.blur(),this.invalidateCSSPositioning())}setLabelSiblingContent(e){assert&&assert(e===null||typeof e=="string","incorrect label content type"),this._labelSibling&&PDOMUtils$1.setTextContent(this._labelSibling,e)}setDescriptionSiblingContent(e){assert&&assert(e===null||typeof e=="string","incorrect description content type"),this._descriptionSibling&&PDOMUtils$1.setTextContent(this._descriptionSibling,e)}setPrimarySiblingContent(e){assert&&assert(e===null||typeof e=="string","incorrect inner content type"),assert&&assert(this.pdomInstance.children.length===0,"descendants exist with accessible content, innerContent cannot be used"),assert&&assert(PDOMUtils$1.tagNameSupportsContent(this._primarySibling.tagName),`tagName: ${this.node.tagName} does not support inner content`),this._primarySibling&&PDOMUtils$1.setTextContent(this._primarySibling,e)}setPDOMTransformSourceNode(e){this.pdomInstance.transformTracker.removeListener(this.transformListener),this.pdomInstance.updateTransformTracker(e),this.pdomInstance.transformTracker.addListener(this.transformListener),this.invalidateCSSPositioning()}setPositionInPDOM(e){this.positionInPDOM=e,this.invalidateCSSPositioning()}getElementId(e,t){return`display${this.display.id}-${e}-${t}`}updateIndicesStringAndElementIds(){const e=this.pdomInstance.getPDOMInstanceUniqueId();this._primarySibling&&(this._primarySibling.setAttribute(PDOMUtils$1.DATA_PDOM_UNIQUE_ID,e),this._primarySibling.id=this.getElementId("primary",e)),this._labelSibling&&(this._labelSibling.setAttribute(PDOMUtils$1.DATA_PDOM_UNIQUE_ID,e),this._labelSibling.id=this.getElementId("label",e)),this._descriptionSibling&&(this._descriptionSibling.setAttribute(PDOMUtils$1.DATA_PDOM_UNIQUE_ID,e),this._descriptionSibling.id=this.getElementId("description",e)),this._containerParent&&(this._containerParent.setAttribute(PDOMUtils$1.DATA_PDOM_UNIQUE_ID,e),this._containerParent.id=this.getElementId("container",e))}invalidateCSSPositioning(e=!1){if(!this.positionDirty){if(this.positionDirty=!0,e){this.forceReflowWorkaround=!0;for(let n=0;n<this.topLevelElements.length;n++)this.topLevelElements[n].style.transform="scale(1)"}let t=this.pdomInstance.parent;for(;t;)t.peer.childPositionDirty=!0,t=t.parent}}positionElements(e){if(assert&&assert(this._primarySibling,"a primary sibling required to receive CSS positioning"),assert&&assert(this.positionDirty,"elements should only be repositioned if dirty"),e){const t=this.node.pdomTransformSourceNode||this.node;if(scratchGlobalBounds.set(t.localBounds),scratchGlobalBounds.isFinite()){scratchGlobalBounds.transform(this.pdomInstance.transformTracker.getMatrix());const n=this.display.bounds;if(n.intersectsBounds(scratchGlobalBounds)){scratchGlobalBounds.constrainBounds(n);let r=getClientDimensions(this._primarySibling),s=r.width,a=r.height;s>0&&a>0&&(scratchSiblingBounds.setMinMax(0,0,s,a),scratchSiblingBounds.transform(getCSSMatrix(s,a,scratchGlobalBounds)),setClientBounds(this._primarySibling,scratchSiblingBounds)),this.labelSibling&&(r=getClientDimensions(this._labelSibling),s=r.width,a=r.height,a>0&&s>0&&(scratchSiblingBounds.setMinMax(0,0,s,a),scratchSiblingBounds.transform(getCSSMatrix(s,a,scratchGlobalBounds)),setClientBounds(this._labelSibling,scratchSiblingBounds)))}}}else scratchSiblingBounds.set(PDOMPeer.OFFSCREEN_SIBLING_BOUNDS),setClientBounds(this._primarySibling,scratchSiblingBounds),this._labelSibling&&setClientBounds(this._labelSibling,scratchSiblingBounds);this.forceReflowWorkaround&&this.topLevelElements.forEach(t=>{t.style.transform="",t.style.offsetHeight}),this.positionDirty=!1,this.forceReflowWorkaround=!1}updateSubtreePositioning(e=!1){this.childPositionDirty=!1;const t=this.positionInPDOM||e;this.positionDirty&&this.positionElements(t);for(let n=0;n<this.pdomInstance.children.length;n++){const r=this.pdomInstance.children[n].peer;(r.positionDirty||r.childPositionDirty)&&this.pdomInstance.children[n].peer.updateSubtreePositioning(t)}}recursiveDisable(e){e?(this._preservedDisabledValue=this._primarySibling.disabled,this._primarySibling.disabled=!0):this._primarySibling.disabled=this._preservedDisabledValue;for(let t=0;t<this.pdomInstance.children.length;t++)this.pdomInstance.children[t].peer.recursiveDisable(e)}dispose(){this.isDisposed=!0,this.blur(),this._primarySibling.removeEventListener("blur",this.blurEventListener),this._primarySibling.removeEventListener("focus",this.focusEventListener),this.pdomInstance.transformTracker.removeListener(this.transformListener),this.mutationObserver.disconnect(),this.pdomInstance=null,this.node=null,this.display=null,this.trail=null,this._primarySibling=null,this._labelSibling=null,this._descriptionSibling=null,this._containerParent=null,this.focusable=null,this.freeToPool()}}PDOMPeer.PRIMARY_SIBLING=PRIMARY_SIBLING;PDOMPeer.LABEL_SIBLING=LABEL_SIBLING;PDOMPeer.DESCRIPTION_SIBLING=DESCRIPTION_SIBLING;PDOMPeer.CONTAINER_PARENT=CONTAINER_PARENT;PDOMPeer.OFFSCREEN_SIBLING_BOUNDS=new Bounds2(0,0,1,1);scenery.register("PDOMPeer",PDOMPeer);Poolable.mixInto(PDOMPeer,{initialize:PDOMPeer.prototype.initializePDOMPeer});function createElement(o,e,t){t=merge({siblingName:null,excludeFromInput:!1},t);const n=PDOMUtils$1.createElement(o,e,t);return t.excludeFromInput&&n.setAttribute(PDOMUtils$1.DATA_EXCLUDE_FROM_INPUT,!0),n}function getCSSMatrix(o,e,t){return globalNodeTranslationMatrix.setToTranslation(t.minX,t.minY),globalToClientScaleMatrix.setToScale(t.width/o,t.height/e),globalNodeTranslationMatrix.multiplyMatrix(globalToClientScaleMatrix).multiplyMatrix(nodeScaleMagnitudeMatrix)}function getClientDimensions(o){let e=o.clientWidth,t=o.clientHeight;if(e===0&&t===0){const n=o.getBoundingClientRect();e=n.width,t=n.height}return{width:e,height:t}}function setClientBounds(o,e){o.style.top=`${e.top}px`,o.style.left=`${e.left}px`,o.style.width=`${e.width}px`,o.style.height=`${e.height}px`}const PDOMPeer$1=PDOMPeer,bi=class bi extends EnumerationValue{};bi.INDICES=new bi,bi.TRAIL_ID=new bi,bi.enumeration=new Enumeration(bi);let PDOMUniqueIdStrategy=bi;const UNIQUE_ID_STRATEGY=PDOMUniqueIdStrategy.TRAIL_ID;let globalId$3=1;const Si=class Si{constructor(e,t,n){this.relativeNodes=[],this.relativeVisibilities=[],this.relativeListeners=[],this.transformTracker=null,this.initializePDOMInstance(e,t,n)}initializePDOMInstance(e,t,n){if(assert&&assert(!this.id||this.isDisposed,"If we previously existed, we need to have been disposed"),this.id=this.id||globalId$3++,this.parent=e,this.display=t,this.trail=n,this.isRootInstance=e===null,this.node=this.isRootInstance?null:n.lastNode(),this.children=cleanArray(this.children),this.node&&this.node.addPDOMInstance(this),this.invisibleCount=0,this.relativeNodes=[],this.relativeVisibilities=[],this.relativeListeners=[],this.transformTracker=null,this.updateTransformTracker(this.node?this.node.pdomTransformSourceNode:null),this.isDisposed=!1,this.isRootInstance){const r=document.createElement("div");this.peer=PDOMPeer$1.createFromPool(this,{primarySibling:r})}else{this.peer=PDOMPeer$1.createFromPool(this),this.peer.update(UNIQUE_ID_STRATEGY===PDOMUniqueIdStrategy.TRAIL_ID),assert&&assert(this.peer.primarySibling,"accessible peer must have a primarySibling upon completion of construction");const r=this.parent.trail;for(let s=r.length;s<n.length;s++){const a=n.nodes[s];this.relativeNodes.push(a);const h=a._pdomDisplaysInfo.pdomDisplays,c=_.includes(h,t);this.relativeVisibilities.push(c),c||this.invisibleCount++;const d=this.checkAccessibleDisplayVisibility.bind(this,s-r.length);a.pdomDisplaysEmitter.addListener(d),this.relativeListeners.push(d)}this.updateVisibility()}return sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`Initialized ${this.toString()}`),this}addConsecutiveInstances(e){sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`addConsecutiveInstances on ${this.toString()} with: ${e.map(n=>n.toString()).join(",")}`),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.push();const t=this.children.length>0;Array.prototype.push.apply(this.children,e);for(let n=0;n<e.length;n++)assert&&assert(!!this.peer.primarySibling,"Primary sibling must be defined to insert elements."),PDOMUtils$1.insertElements(this.peer.primarySibling,e[n].peer.topLevelElements);t&&this.sortChildren(),assert&&this.node&&(assert&&assert(this.node instanceof Node$2),this.children.length>0&&assert(!this.node.innerContent,`${this.children.length} child PDOMInstances present but this node has innerContent: ${this.node.innerContent}`)),UNIQUE_ID_STRATEGY===PDOMUniqueIdStrategy.INDICES&&this.updateDescendantPeerIds(e),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.pop()}removeInstancesForTrail(e){sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`removeInstancesForTrail on ${this.toString()} with trail ${e.toString()}`),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.push();for(let t=0;t<this.children.length;t++){const n=this.children[t],r=n.trail;let s=r.length<e.length;if(!s){for(let a=this.trail.length;a<e.length;a++)if(e.nodes[a]!==r.nodes[a]){s=!0;break}}s||(this.children.splice(t,1),n.dispose(),t-=1)}sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.pop()}removeAllChildren(){for(sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`removeAllChildren on ${this.toString()}`),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.push();this.children.length;)this.children.pop().dispose();sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.pop()}findChildWithTrail(e){for(let t=0;t<this.children.length;t++){const n=this.children[t];if(n.trail.equals(e))return n}return null}removeSubtree(e){sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`removeSubtree on ${this.toString()} with trail ${e.toString()}`),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.push();for(let t=this.children.length-1;t>=0;t--){const n=this.children[t];n.trail.isExtensionOf(e,!0)&&(sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`Remove parent: ${this.toString()}, child: ${n.toString()}`),this.children.splice(t,1),n.dispose())}sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.pop()}checkAccessibleDisplayVisibility(e){const t=_.includes(this.relativeNodes[e]._pdomDisplaysInfo.pdomDisplays,this.display),n=this.relativeVisibilities[e];if(t!==n){this.relativeVisibilities[e]=t;const r=this.invisibleCount===0;this.invisibleCount+=t?-1:1,assert&&assert(this.invisibleCount>=0&&this.invisibleCount<=this.relativeNodes.length),this.invisibleCount===0!==r&&this.updateVisibility()}}updateVisibility(){assert&&assert(!!this.peer,"Peer needs to be available on update visibility."),this.peer.setVisible(this.invisibleCount<=0),!this.peer.isVisible()&&FocusManager.pdomFocusedNode&&(assert&&assert(FocusManager.pdomFocusedNode.pdomInstances.length===1,"focusable Nodes do not support DAG, and should be connected with an instance if focused."),FocusManager.pdomFocusedNode.pdomInstances[0].trail.containsNode(this.node)&&(FocusManager.pdomFocus=null))}isGloballyVisible(){return assert&&assert(!!this.peer,"PDOMPeer needs to be available, has this PDOMInstance been disposed?"),this.peer.isVisible()?this.parent?this.parent.isGloballyVisible():!0:!1}getChildOrdering(e){const t=e.lastNode(),n=t.getEffectiveChildren();let r;const s=[];if(t.hasPDOMContent&&t!==this.node){const a=t.pdomInstances;e:for(r=0;r<a.length;r++){const h=a[r];if(h.parent===this){for(let c=0;c<e.length;c++)if(e.nodes[c]!==h.trail.nodes[c+h.trail.length-e.length])continue e;s.push(h)}}assert&&assert(s.length<=1,"If we select more than one this way, we have problems")}else for(r=0;r<n.length;r++)e.addDescendant(n[r],r),Array.prototype.push.apply(s,this.getChildOrdering(e)),e.removeDescendant();return s}sortChildren(){var h,c;assert&&assert(this.peer!==null,"peer required for sort");let e;this.isRootInstance?(assert&&assert(this.display!==null,"Display should be available for the root"),e=this.display.rootNode):(assert&&assert(this.node!==null,"Node should be defined, were we disposed?"),e=this.node);const t=this.getChildOrdering(new Trail(e));assert&&assert(t.length===this.children.length,"sorting should not change number of children"),this.children=t;const n=this.peer.primarySibling,r=((c=(h=FocusManager.pdomFocusedNode)==null?void 0:h.pdomInstances[0])==null?void 0:c.trail)||null;let s=n.childNodes.length-1;const a=r&&_.find(this.children,d=>r.containsNode(d.peer.node));if(a){const d=_.flatten(this.children.map(g=>g.peer.topLevelElements));if(!_.every(d,(g,D)=>n.children[D]===g)){const g=a.peer.getTopLevelElementContainingPrimarySibling(),D=d.indexOf(g);assert&&assert(D>=0);for(let O=0;O<D;O++)n.insertBefore(d[O],g);for(let O=D+1;O<d.length;O++)n.appendChild(d[O])}}else for(let d=this.children.length-1;d>=0;d--){const y=this.children[d].peer;for(let g=y.topLevelElements.length-1;g>=0;g--){const D=y.topLevelElements[g];n.childNodes[s]!==D&&n.insertBefore(D,n.childNodes[s+1]),s--}}if(assert){const d=_.flatten(this.children.map(y=>y.peer.topLevelElements));assert(_.every(d,(y,g)=>n.children[g]===y))}UNIQUE_ID_STRATEGY===PDOMUniqueIdStrategy.INDICES&&this.updateDescendantPeerIds(this.children)}updateTransformTracker(e){this.transformTracker&&this.transformTracker.dispose();let t=null;e?t=e.getUniqueTrail():t=Si.guessVisualTrail(this.trail,this.display.rootNode),this.transformTracker=new TransformTracker$1(t)}getPDOMInstanceUniqueId(){if(UNIQUE_ID_STRATEGY===PDOMUniqueIdStrategy.INDICES){const e=[];let t=this;for(;t.parent;){const n=t.parent.children.indexOf(t);if(n===-1)return"STILL_BEING_CREATED"+dotRandom.nextDouble();e.unshift(n),t=t.parent}return e.join(PDOMUtils$1.PDOM_UNIQUE_ID_SEPARATOR)}else return assert&&assert(UNIQUE_ID_STRATEGY===PDOMUniqueIdStrategy.TRAIL_ID),this.trail.getUniqueId()}updateDescendantPeerIds(e){assert&&assert(UNIQUE_ID_STRATEGY===PDOMUniqueIdStrategy.INDICES,"method should not be used with uniqueId comes from TRAIL_ID");const t=Array.from(e);for(;t.length>0;){const n=t.shift();n.peer.updateIndicesStringAndElementIds(),t.push(...n.children)}}static uniqueIdToTrail(e,t){return UNIQUE_ID_STRATEGY===PDOMUniqueIdStrategy.INDICES?e.getTrailFromPDOMIndicesString(t):(assert&&assert(UNIQUE_ID_STRATEGY===PDOMUniqueIdStrategy.TRAIL_ID),Trail.fromUniqueId(e.rootNode,t))}dispose(){sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`Disposing ${this.toString()}`),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.push(),assert&&assert(!!this.peer,"PDOMPeer required, were we already disposed?");const e=this.peer;if(!this.isRootInstance){PDOMUtils$1.removeElements(this.parent.peer.primarySibling,e.topLevelElements);for(let t=0;t<this.relativeNodes.length;t++)this.relativeNodes[t].pdomDisplaysEmitter.removeListener(this.relativeListeners[t])}for(;this.children.length;)this.children.pop().dispose();e.dispose(),this.transformTracker.dispose(),this.transformTracker=null,this.node&&this.node.removePDOMInstance(this),this.relativeNodes=null,this.display=null,this.trail=null,this.node=null,this.peer=null,this.isDisposed=!0,this.freeToPool(),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.pop()}toString(){return`${this.id}#{${this.trail.toString()}}`}auditRoot(){if(!assert)return;const e=this.display.rootNode;assert(this.trail.length===0,"Should only call auditRoot() on the root PDOMInstance for a display");function t(n,r){assert&&assert(n.children.length===r.children.length,"Different number of children in accessible instance"),assert&&assert(n.node===r.node,"Node mismatch for PDOMInstance");for(let h=0;h<r.children.length;h++)t(n.children[h],r.children[h]);const s=r.isGloballyVisible();let a=!0;for(let h=0;h<r.trail.length;h++)if(r.trail.nodes[h].getTrailsTo(e).filter(y=>y.isPDOMVisible()).length===0){a=!1;break}assert&&assert(s===a,"Instance visibility mismatch")}t(Si.createFakePDOMTree(e),this)}static guessVisualTrail(e,t){e.reindex();const n=e.indices.lastIndexOf(-1);if(n<0)return e;const r=n+1,a=e.nodes[r].getTrailsTo(t);if(a.length===0)return e;const h=a[0];for(let c=r+1;c<e.length;c++)h.addDescendant(e.nodes[c]);return assert&&assert(h.isValid(),`trail not valid: ${e.uniqueId}`),h}static createFakePDOMTree(e){function t(n){let r=_.flatten(n.getEffectiveChildren().map(t));return n.hasPDOMContent&&(r=[{node:n,children:r}]),r}return{node:null,children:t(e)}}freeToPool(){Si.pool.freeToPool(this)}};Si.pool=new Pool(Si,{initialize:Si.prototype.initializePDOMInstance});let PDOMInstance=Si;scenery.register("PDOMInstance",PDOMInstance);const PDOMInstance$1=PDOMInstance,PDOMTree={addChild(o,e){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`addChild parent:n#${o._id}, child:n#${e._id}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),assert&&assert(o instanceof Node$2),assert&&assert(e instanceof Node$2),assert&&assert(!e._rendererSummary.hasNoPDOM());const t=PDOMTree.beforeOp();e._pdomParent||PDOMTree.addTree(o,e),PDOMTree.afterOp(t),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},removeChild(o,e){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`removeChild parent:n#${o._id}, child:n#${e._id}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),assert&&assert(o instanceof Node$2),assert&&assert(e instanceof Node$2),assert&&assert(!e._rendererSummary.hasNoPDOM());const t=PDOMTree.beforeOp();e._pdomParent||PDOMTree.removeTree(o,e),PDOMTree.afterOp(t),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},childrenOrderChange(o){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`childrenOrderChange node:n#${o._id}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),assert&&assert(o instanceof Node$2),assert&&assert(!o._rendererSummary.hasNoPDOM());const e=PDOMTree.beforeOp();PDOMTree.reorder(o),PDOMTree.afterOp(e),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},pdomOrderChange(o,e,t){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`pdomOrderChange n#${o._id}: ${PDOMTree.debugOrder(e)},${PDOMTree.debugOrder(t)}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),assert&&assert(o instanceof Node$2);const n=PDOMTree.beforeOp(),r=[],s=[];arrayDifference(e||[],t||[],r,s),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`removed: ${PDOMTree.debugOrder(r)}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`added: ${PDOMTree.debugOrder(s)}`);let a,h;if(assert){for(a=0;a<r;a++)assert(r[a]===null||r[a]._pdomParent===o,"Node should have had a pdomOrder");for(a=0;a<s;a++)assert(s[a]===null||s[a]._pdomParent===null,"Node is already specified in a pdomOrder")}const c=PDOMTree.findPDOMTrails(o);for(a=0;a<r.length;a++){const d=r[a];d&&(PDOMTree.removeTree(o,d,c),d._pdomParent=null,d.pdomParentChangedEmitter.emit())}for(a=0;a<s.length;a++){const d=s[a];if(d){const y=d._parents;for(h=0;h<y.length;h++)PDOMTree.removeTree(y[h],d);d._pdomParent=o,d.pdomParentChangedEmitter.emit()}}for(a=0;a<r.length;a++){const d=r[a];if(d){const y=d._parents;for(h=0;h<y.length;h++)PDOMTree.addTree(y[h],d)}}for(a=0;a<s.length;a++){const d=s[a];d&&PDOMTree.addTree(o,d,c)}PDOMTree.reorder(o,c),PDOMTree.afterOp(n),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},pdomContentChange(o){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`pdomContentChange n#${o._id}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),assert&&assert(o instanceof Node$2);const e=PDOMTree.beforeOp();let t;const n=o._pdomParent?[o._pdomParent]:o._parents,r=[];for(t=0;t<n.length;t++){const s=n[t],a=PDOMTree.findPDOMTrails(s);r.push(a),PDOMTree.removeTree(s,o,a)}for(t=0;t<n.length;t++)PDOMTree.addTree(n[t],o,r[t]);for(t=0;t<o._rootedDisplays.length;t++){const s=o._rootedDisplays[t];s._accessible&&PDOMTree.rebuildInstanceTree(s._rootPDOMInstance)}PDOMTree.afterOp(e),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},rebuildInstanceTree(o){const e=o.display.rootNode;assert&&assert(e),o.removeAllChildren(),o.addConsecutiveInstances(PDOMTree.createTree(new Trail(e),o.display,o))},addTree(o,e,t){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`addTree parent:n#${o._id}, child:n#${e._id}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),assert&&PDOMTree.auditNodeForPDOMCycles(o),t=t||PDOMTree.findPDOMTrails(o);for(let n=0;n<t.length;n++){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`trail: ${t[n].trail.toString()} full:${t[n].fullTrail.toString()} for ${t[n].pdomInstance.toString()} root:${t[n].isRoot}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push();const r=t[n],s=r.pdomInstance;r.fullTrail.addDescendant(e);const a=PDOMTree.createTree(r.fullTrail,s.display,s);r.fullTrail.removeDescendant(e),s.addConsecutiveInstances(a),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()}sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},removeTree(o,e,t){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`removeTree parent:n#${o._id}, child:n#${e._id}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),t=t||PDOMTree.findPDOMTrails(o);for(let n=0;n<t.length;n++){const r=t[n];r.fullTrail.addDescendant(e),r.pdomInstance.removeInstancesForTrail(r.fullTrail),r.fullTrail.removeDescendant(e)}sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},reorder(o,e){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`reorder n#${o._id}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),e=e||PDOMTree.findPDOMTrails(o);for(let t=0;t<e.length;t++)e[t].pdomInstance.sortChildren();sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},createTree(o,e,t){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`createTree ${o.toString()} parent:${t?t.toString():"null"}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push();const n=o.lastNode(),r=n.getEffectiveChildren();sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`effectiveChildren: ${PDOMTree.debugOrder(r)}`);let s,a=!1;n.hasPDOMContent&&(s=t.findChildWithTrail(o),s?a=!0:s=PDOMInstance$1.pool.create(t,e,o.copy()),t=s);const h=[];for(let c=0;c<r.length;c++)o.addDescendant(r[c],c),Array.prototype.push.apply(h,PDOMTree.createTree(o,e,t)),o.removeDescendant();return s?(s.addConsecutiveInstances(h),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop(),a?[]:[s]):(sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop(),h)},beforeOp(){return BrowserEvents$1.blockFocusCallbacks=!0,FocusManager.pdomFocusedNode},afterOp(o){o&&o.focusable&&o.focus(),BrowserEvents$1.blockFocusCallbacks=!1},findPDOMTrails(o){const e=[];return PDOMTree.recursivePDOMTrailSearch(e,new Trail(o)),e},recursivePDOMTrailSearch(o,e){const t=e.rootNode();let n;if(t.hasPDOMContent){const a=t.pdomInstances;for(n=0;n<a.length;n++)o.push(new PartialPDOMTrail(a[n],e.copy(),!1));return}else{const a=t.rootedDisplays;for(n=0;n<a.length;n++){const h=a[n];h._accessible&&o.push(new PartialPDOMTrail(h._rootPDOMInstance,e.copy(),!0))}}const r=t._pdomParent?[t._pdomParent]:t._parents,s=r.length;for(n=0;n<s;n++){const a=r[n];e.addAncestor(a),PDOMTree.recursivePDOMTrailSearch(o,e),e.removeAncestor()}},auditPDOMDisplays(o){if(assertSlow)if(o._pdomDisplaysInfo.canHavePDOMDisplays()){let e;const t=[];for(e=0;e<o._parents.length;e++)Array.prototype.push.apply(t,o._parents[e]._pdomDisplaysInfo.pdomDisplays);for(e=0;e<o._rootedDisplays.length;e++){const s=o._rootedDisplays[e];s._accessible&&t.push(s)}const n=o._pdomDisplaysInfo.pdomDisplays.slice(),r=t.slice();for(assertSlow(n.length===r.length),e=0;e<r.length;e++)for(let s=0;s<n.length;s++)if(r[e]===n[s]){r.splice(e,1),n.splice(s,1),e--;break}assertSlow(n.length===0&&r.length===0,"Mismatch with accessible pdom displays")}else assertSlow(o._pdomDisplaysInfo.pdomDisplays.length===0,"Invisible/nonaccessible things should have no displays")},auditNodeForPDOMCycles(o){if(assert){const e=new Trail(o);(function t(){const n=e.rootNode();assert(e.length<=1||n!==o,`Accessible PDOM graph cycle detected. The combined scene-graph DAG with pdomOrder defining additional parent-child relationships should still be a DAG. Cycle detected with the trail: ${e.toString()} path: ${e.toPathString()}`);const r=n._parents.length;for(let s=0;s<r;s++){const a=n._parents[s];e.addAncestor(a),t(),e.removeAncestor()}n._pdomParent&&!n._pdomParent.hasChild(n)&&(e.addAncestor(n._pdomParent),t(),e.removeAncestor())})()}},debugOrder(o){return o===null?"null":`[${o.map(e=>e===null?"null":e._id).join(",")}]`}};scenery.register("PDOMTree",PDOMTree);const PDOMTree$1=PDOMTree;class PDOMFuzzer{constructor(e,t,n){assert&&assert(e>=2),n=n||null,this.nodeCount=e,this.logToConsole=t,this.nodes=_.range(0,e).map(()=>new Node$2),this.display=new Display(this.nodes[0]),this.random=new Random({seed:n}),this.actionsTaken=[]}step(){const e=this.random.sample(this.enumerateActions());if(this.logToConsole&&console.log(e.text),this.actionsTaken.push(e),e.execute(),this.display._rootPDOMInstance.auditRoot(),PDOMTree$1.auditPDOMDisplays(this.display.rootNode),this.logToConsole)for(let t=0;t<this.nodes.length;t++){const n=this.nodes[t];console.log(`${t}#${n.id} ${n.tagName} ch:${PDOMTree$1.debugOrder(n.children)} or:${PDOMTree$1.debugOrder(n.pdomOrder)} vis:${n.visible} avis:${n.pdomVisible}`)}}enumerateActions(){const e=[];return this.nodes.forEach(t=>{e.push({text:`#${t.id}.visible = ${!t.visible}`,execute:()=>{t.visible=!t.visible}}),e.push({text:`#${t.id}.pdomVisible = ${!t.pdomVisible}`,execute:()=>{t.pdomVisible=!t.pdomVisible}}),["span","div",null].forEach(n=>{t.tagName!==n&&e.push({text:`#${t.id}.tagName = ${n}`,execute:()=>{t.tagName=n}})}),this.powerSet(arrayDifference(this.nodes,[t]).concat([null])).forEach(n=>{Permutation.forEachPermutation(n,r=>{this.isPDOMOrderChangeLegal(t,r)&&e.push({text:`#${t.id}.pdomOrder = ${PDOMTree$1.debugOrder(r)}`,execute:()=>{t.pdomOrder=r}})})}),this.nodes.forEach(n=>{this.isAddChildLegal(t,n)&&_.range(0,t.children.length+1).forEach(r=>{e.push({text:`#${t.id}.insertChild(${r},#${n.id})`,execute:()=>{t.insertChild(r,n)}})}),t.hasChild(n)&&e.push({text:`#${t.id}.removeChild(#${n.id})`,execute:()=>{t.removeChild(n)}})})}),e}isAddChildLegal(e,t){return!e.hasChild(t)&&this.isAcyclic(e,t)}powerSet(e){if(e.length===0)return[[]];{const t=this.powerSet(e.slice(1));return t.concat(t.map(n=>[e[0]].concat(n)))}}isPDOMOrderChangeLegal(e,t){if(t===null&&(t=[]),t=t.filter(s=>s!==null),_.includes(t,e)||_.uniq(t).length<t.length)return!1;for(let s=0;s<t.length;s++)if(t[s]._pdomParent&&t[s]._pdomParent!==e)return!1;const n=(s,a)=>s===e?s.hasChild(a)||_.includes(t,a):s.hasChild(a)||!!s.pdomOrder&&_.includes(s.pdomOrder,a),r=e.children.concat(t);return _.every(r,s=>this.isAcyclic(e,s,n))}isAcyclic(e,t,n){if(e===t)return!1;const r=t.children.concat(t.pdomOrder).filter(s=>s!==null);for(;r.length;){const s=r.pop();if(s===e)return!1;n?this.nodes.forEach(a=>{n(s,a)&&r.push(a)}):(Array.prototype.push.apply(r,s.children),s.pdomOrder&&Array.prototype.push.apply(r,s.pdomOrder.filter(a=>a!==null)))}return!0}dispose(){this.display.dispose()}}scenery.register("PDOMFuzzer",PDOMFuzzer);const Li=class Li extends EnumerationValue{};Li.DRAG=new Li,Li.KEYBOARD_DRAG=new Li,Li.enumeration=new Enumeration(Li,{phetioDocumentation:"entries when signifying Intent of the pointer"});let Intent=Li;const ys=class ys{constructor(e,t){assert&&assert(e===null||e instanceof Vector2),assert&&assert(Object.getPrototypeOf(this)!==ys.prototype,"Pointer is an abstract class"),this.point=e,this.type=t,this.trail=null,this.inputEnabledTrail=null,this.isDownProperty=new BooleanProperty(!1),this.attachedProperty=new BooleanProperty(!1),this._listeners=[],this._attachedListener=null,this._cursor=null,this.lastEventContext=null,this._intents=[],this._pointerCaptured=!1,this._listenerForDragReserve=null,this._listenerForKeyboardDragReserve=null}setCursor(e){return this._cursor=e,this}set cursor(e){this.setCursor(e)}get cursor(){return this.getCursor()}getCursor(){return this._cursor}getListeners(){return this._listeners.slice()}get listeners(){return this.getListeners()}addInputListener(e,t){sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`addInputListener to ${this.toString()} attach:${t}`),sceneryLog&&sceneryLog.Pointer&&sceneryLog.push(),assert&&assert(e,"A listener must be provided"),assert&&assert(t===void 0||typeof t=="boolean","If provided, the attach parameter should be a boolean value"),assert&&assert(!_.includes(this._listeners,e),"Attempted to add an input listener that was already added"),this._listeners.push(e),t&&(assert&&assert(e.interrupt,"Interrupt should exist on attached listeners"),this.attach(e)),sceneryLog&&sceneryLog.Pointer&&sceneryLog.pop()}removeInputListener(e){sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`removeInputListener to ${this.toString()}`),sceneryLog&&sceneryLog.Pointer&&sceneryLog.push(),assert&&assert(e,"A listener must be provided");const t=_.indexOf(this._listeners,e);assert&&assert(t!==-1,"Could not find the input listener to remove"),this.isAttached()&&e===this._attachedListener&&this.detach(e),this._listeners.splice(t,1),sceneryLog&&sceneryLog.Pointer&&sceneryLog.pop()}getAttachedListener(){return this._attachedListener}get attachedListener(){return this.getAttachedListener()}isAttached(){return this.attachedProperty.value}isTouchLike(){return!1}set isDown(e){this.isDownProperty.value=e}get isDown(){return this.isDownProperty.value}interruptAttached(){this.isAttached()&&this._attachedListener.interrupt()}interruptAll(){const e=this._listeners.slice();for(let t=0;t<e.length;t++){const n=e[t];n.interrupt&&n.interrupt()}}attach(e){sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`Attaching to ${this.toString()}`),assert&&assert(!this.isAttached(),"Attempted to attach to an already attached pointer"),this.attachedProperty.value=!0,this._attachedListener=e}updatePoint(e,t="event"){const n=this.hasPointChanged(e);return e&&sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`pointer ${t} at ${e.toString()}`),this.point=e,n}down(e){this.isDown=!0}up(e,t){return this.isDown=!1,this.updatePoint(e,"up")}cancel(e){return this.isDown=!1,this.updatePoint(e,"cancel")}detach(e){sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`Detaching from ${this.toString()}`),assert&&assert(this.isAttached(),"Cannot detach a listener if one is not attached"),assert&&assert(this._attachedListener===e,"Cannot detach a different listener"),this.attachedProperty.value=!1,this._attachedListener=null}hasPointChanged(e){return this.point!==e&&(!e||!this.point||!this.point.equals(e))}addIntent(e){assert&&assert(Intent.enumeration.includes(e),"trying to set unsupported intent for Pointer"),this._intents.includes(e)||this._intents.push(e),assert&&assert(this._intents.length<=Intent.enumeration.values.length,"to many Intents saved, memory leak likely")}removeIntent(e){if(assert&&assert(Intent.enumeration.includes(e),"trying to set unsupported intent for Pointer"),this._intents.includes(e)){const t=this._intents.indexOf(e);this._intents.splice(t,1)}}hasIntent(e){return this._intents.includes(e)}reserveForDrag(){if(!this._intents.includes(Intent.DRAG)){this.addIntent(Intent.DRAG);const e={up:t=>{this.removeIntent(Intent.DRAG),this.removeInputListener(this._listenerForDragReserve),this._listenerForDragReserve=null}};assert&&assert(this._listenerForDragReserve===null,"still a listener to reserve pointer, memory leak likely"),this._listenerForDragReserve=e,this.addInputListener(this._listenerForDragReserve)}}reserveForKeyboardDrag(){if(!this._intents.includes(Intent.KEYBOARD_DRAG)){this.addIntent(Intent.KEYBOARD_DRAG);const e={keyup:n=>t(),blur:n=>t()},t=()=>{this.removeIntent(Intent.KEYBOARD_DRAG),this.removeInputListener(this._listenerForKeyboardDragReserve),this._listenerForKeyboardDragReserve=null};assert&&assert(this._listenerForDragReserve===null,"still a listener on Pointer for reserve, memory leak likely"),this._listenerForKeyboardDragReserve=e,this.addInputListener(this._listenerForKeyboardDragReserve)}}onGotPointerCapture(){this._pointerCaptured=!0}onLostPointerCapture(){this._pointerCaptured&&this.interruptAll(),this._pointerCaptured=!1}dispose(){sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`Disposing ${this.toString()}`),this._listenerForDragReserve&&this._listeners.includes(this._listenerForDragReserve)&&this.removeInputListener(this._listenerForDragReserve),this._listenerForKeyboardDragReserve&&this._listeners.includes(this._listenerForKeyboardDragReserve)&&this.removeInputListener(this._listenerForKeyboardDragReserve),assert&&assert(this._attachedListener===null,"Attached listeners should be cleared before pointer disposal"),assert&&assert(this._listeners.length===0,"Should not have listeners when a pointer is disposed")}toString(){return`Pointer#${this.type}_at_${this.point}`}};ys.PointerIO=new IOType("PointerIO",{valueType:ys,toStateObject:e=>({point:e.point.toStateObject(),type:e.type}),stateSchema:{point:Vector2.Vector2IO,type:StringIO}});let Pointer=ys;scenery.register("Pointer",Pointer);class Mouse extends Pointer{constructor(e){super(e,"mouse"),this.id=null,this.leftDown=!1,this.middleDown=!1,this.rightDown=!1,this.wheelDelta=new Vector3(0,0,0),this.wheelDeltaMode=0,sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`Created ${this.toString()}`)}down(e){switch(assert&&assert(e instanceof MouseEvent),e.button){case 0:this.leftDown=!0;break;case 1:this.middleDown=!0;break;case 2:this.rightDown=!0;break}return super.down(e)}up(e,t){switch(assert&&assert(t instanceof MouseEvent),t.button){case 0:this.leftDown=!1;break;case 1:this.middleDown=!1;break;case 2:this.rightDown=!1;break}return super.up(e,t)}move(e){const t=this.hasPointChanged(e);return e&&sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`mouse move at ${e.toString()}`),this.point=e,t}over(e){const t=this.hasPointChanged(e);return e&&sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`mouse over at ${e.toString()}`),this.point=e,t}out(e){const t=this.hasPointChanged(e);return e&&sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`mouse out at ${e.toString()}`),t}wheel(e){assert&&assert(e instanceof WheelEvent);const t=e;this.wheelDelta.setXYZ(t.deltaX,t.deltaY,t.deltaZ),this.wheelDeltaMode=t.deltaMode}toString(){return"Mouse"}}scenery.register("Mouse",Mouse);class Touch extends Pointer{constructor(e,t,n){super(t,"touch"),this.id=e,sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`Created ${this.toString()}`)}move(e){const t=this.hasPointChanged(e);return this.point=e,t}toString(){return`Touch#${this.id}`}isTouchLike(){return!0}}scenery.register("Touch",Touch);class Pen extends Pointer{constructor(e,t,n){super(t,"pen"),this.id=e,sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`Created ${this.toString()}`)}move(e){const t=this.hasPointChanged(e);return this.point=e,t}toString(){return`Pen#${this.id}`}isTouchLike(){return!0}}scenery.register("Pen",Pen);class PDOMPointer extends Pointer{constructor(e){super(Vector2.ZERO,"pdom"),this.display=e,this.initializeListeners(),this.blockTrustedEvents=!1,this.keydownTargetNode=null,sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`Created ${this.toString()}`)}initializeListeners(){this.addInputListener({focus:e=>{assert&&assert(this.trail,"trail should have been calculated for the focused node");const t=this.trail.lastNode();if(t.focusable){const n=PDOMInstance$1.guessVisualTrail(this.trail,this.display.rootNode);this.point=n.parentToGlobalPoint(t.center),isNaN(this.point.x)&&this.point.setXY(0,0)}},blur:e=>{this.trail=null,this.keydownTargetNode=null},keydown:e=>{this.blockTrustedEvents&&e.domEvent.isTrusted||(this.keydownTargetNode=e.target)},keyup:e=>{this.blockTrustedEvents&&e.domEvent.isTrusted||this.keydownTargetNode!==e.target&&e.abort()}})}updateTrail(e){return this.trail&&this.trail.equals(e)||(this.trail=e),this.trail}}scenery.register("PDOMPointer",PDOMPointer);class EventContext{constructor(e){this.domEvent=e,this.activeElement=document.activeElement}static createSynthetic(){return new EventContext(new window.Event("synthetic"))}allowsDOMInput(){var t,n;const e=(t=this.domEvent)==null?void 0:t.target;if(e instanceof Element){let r=e;for(;r;){if(r instanceof HTMLElement&&((n=r.dataset)==null?void 0:n.sceneryAllowInput)==="true")return!0;r=r.parentNode}}return!1}}const EventContextIO=new IOType("EventContextIO",{valueType:EventContext,documentation:"A DOM event and its context",toStateObject:o=>({domEvent:Input.serializeDomEvent(o.domEvent)}),fromStateObject:o=>new EventContext(Input.deserializeDomEvent(o.domEvent)),stateSchema:()=>({domEvent:EventIO})});scenery.register("EventContext",EventContext);const Ys=class Ys{constructor(e,t,n,r){this.handled=!1,this.aborted=!1,this.trail=e,this.type=t,this.pointer=n,this.context=r,this.domEvent=r.domEvent,this.activeElement=r.activeElement,this.currentTarget=null,this.target=e.lastNode(),this.isPrimary=!(n instanceof Mouse)||!this.domEvent||this.domEvent.button===0,n.lastEventContext=r}handle(){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent("handled event"),this.handled=!0}abort(){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent("aborted event"),this.aborted=!0}isFromPDOM(){return this.pointer instanceof PDOMPointer}canStartPress(){return!this.pointer.isAttached()&&(!(this.pointer instanceof Mouse)||this.domEvent.button===0)}};Ys.SceneryEventIO=new IOType("SceneryEventIO",{valueType:Ys,documentation:'An event, with a "point" field',toStateObject:e=>({type:e.type,domEventType:NullableIO(EventIO).toStateObject(e.domEvent),point:e.pointer&&e.pointer.point?Vector2.Vector2IO.toStateObject(e.pointer.point):null}),stateSchema:{type:StringIO,domEventType:NullableIO(EventIO),point:NullableIO(Vector2.Vector2IO)}});let SceneryEvent=Ys;scenery.register("SceneryEvent",SceneryEvent);const ArrayIOPointerIO=ArrayIO(Pointer.PointerIO),domEventPropertiesToSerialize=["altKey","button","charCode","clientX","clientY","code","ctrlKey","deltaMode","deltaX","deltaY","deltaZ","key","keyCode","metaKey","pageX","pageY","pointerId","pointerType","scale","shiftKey","target","type","relatedTarget","which"],domEventPropertiesSetInConstructor=["deltaMode","deltaX","deltaY","deltaZ","altKey","button","charCode","clientX","clientY","code","ctrlKey","key","keyCode","metaKey","pageX","pageY","pointerId","pointerType","shiftKey","type","relatedTarget","which"],EVENT_KEY_VALUES_AS_ELEMENTS=["target","relatedTarget"],PDOM_UNPICKABLE_EVENTS=["focus","blur","focusin","focusout"],TARGET_SUBSTITUTE_KEY="targetSubstitute",PDOM_CLICK_DELAY=80,st=class st extends PhetioObject{constructor(e,t,n,r,s,a){var c,d,y,g,D,O,V,k,M,N,F,G,ie,Z,W,X,J,oe,le,pe,ve,Oe,He,Ue;const h=optionize()({phetioType:st.InputIO,phetioDocumentation:"Central point for user input events, such as mouse, touch"},a);super(h),this.currentSceneryEvent=null,this.display=e,this.rootNode=e.rootNode,this.attachToWindow=t,this.batchDOMEvents=n,this.assumeFullWindow=r,this.passiveEvents=s,this.batchedEvents=[],this.pdomPointer=null,this.mouse=null,this.pointers=[],this.pointerAddedEmitter=new TinyEmitter,this.currentlyFiringEvents=!1,this.upTimeStamp=0,this.validatePointersAction=new PhetioAction$1(()=>{let Le=this.pointers.length;for(;Le--;){const Ae=this.pointers[Le];Ae.point&&Ae!==this.pdomPointer&&this.branchChangeEvents(Ae,Ae.lastEventContext||EventContext.createSynthetic(),!1)}},{phetioPlayback:!0,tandem:(c=h.tandem)==null?void 0:c.createTandem("validatePointersAction"),phetioHighFrequency:!0}),this.mouseUpAction=new PhetioAction$1((Le,Ae)=>{const ae=this.ensureMouse(Le);ae.id=null,this.upEvent(ae,Ae,Le)},{phetioPlayback:!0,tandem:(d=h.tandem)==null?void 0:d.createTandem("mouseUpAction"),parameters:[{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when a mouse button is released."}),this.mouseDownAction=new PhetioAction$1((Le,Ae,ae)=>{const Ie=this.ensureMouse(Ae);Ie.id=Le,this.downEvent(Ie,ae,Ae)},{phetioPlayback:!0,tandem:(y=h.tandem)==null?void 0:y.createTandem("mouseDownAction"),parameters:[{name:"id",phetioType:NullableIO(NumberIO)},{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when a mouse button is pressed."}),this.mouseMoveAction=new PhetioAction$1((Le,Ae)=>{const ae=this.ensureMouse(Le);ae.move(Le),this.moveEvent(ae,Ae)},{phetioPlayback:!0,tandem:(g=h.tandem)==null?void 0:g.createTandem("mouseMoveAction"),parameters:[{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when the mouse is moved.",phetioHighFrequency:!0}),this.mouseOverAction=new PhetioAction$1((Le,Ae)=>{this.ensureMouse(Le).over(Le)},{phetioPlayback:!0,tandem:(D=h.tandem)==null?void 0:D.createTandem("mouseOverAction"),parameters:[{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when the mouse is moved while on the sim."}),this.mouseOutAction=new PhetioAction$1((Le,Ae)=>{this.ensureMouse(Le).out(Le)},{phetioPlayback:!0,tandem:(O=h.tandem)==null?void 0:O.createTandem("mouseOutAction"),parameters:[{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when the mouse moves out of the display."}),this.wheelScrollAction=new PhetioAction$1(Le=>{const Ae=Le.domEvent,ae=this.ensureMouse(this.pointFromEvent(Ae));if(ae.wheel(Ae),ae.point){const Ie=this.rootNode.trailUnderPointer(ae)||new Trail(this.rootNode);this.dispatchEvent(Ie,"wheel",ae,Le,!0)}},{phetioPlayback:!0,tandem:(V=h.tandem)==null?void 0:V.createTandem("wheelScrollAction"),parameters:[{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when the mouse wheel scrolls.",phetioHighFrequency:!0}),this.touchStartAction=new PhetioAction$1((Le,Ae,ae)=>{const Ie=new Touch(Le,Ae,ae.domEvent);this.addPointer(Ie),this.downEvent(Ie,ae,Ae)},{phetioPlayback:!0,tandem:(k=h.tandem)==null?void 0:k.createTandem("touchStartAction"),parameters:[{name:"id",phetioType:NumberIO},{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when a touch begins."}),this.touchEndAction=new PhetioAction$1((Le,Ae,ae)=>{const Ie=this.findPointerById(Le);Ie&&(assert&&assert(Ie instanceof Touch),this.upEvent(Ie,ae,Ae),this.removePointer(Ie))},{phetioPlayback:!0,tandem:(M=h.tandem)==null?void 0:M.createTandem("touchEndAction"),parameters:[{name:"id",phetioType:NumberIO},{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when a touch ends."}),this.touchMoveAction=new PhetioAction$1((Le,Ae,ae)=>{const Ie=this.findPointerById(Le);Ie&&(assert&&assert(Ie instanceof Touch),Ie.move(Ae),this.moveEvent(Ie,ae))},{phetioPlayback:!0,tandem:(N=h.tandem)==null?void 0:N.createTandem("touchMoveAction"),parameters:[{name:"id",phetioType:NumberIO},{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when a touch moves.",phetioHighFrequency:!0}),this.touchCancelAction=new PhetioAction$1((Le,Ae,ae)=>{const Ie=this.findPointerById(Le);Ie&&(assert&&assert(Ie instanceof Touch),this.cancelEvent(Ie,ae,Ae),this.removePointer(Ie))},{phetioPlayback:!0,tandem:(F=h.tandem)==null?void 0:F.createTandem("touchCancelAction"),parameters:[{name:"id",phetioType:NumberIO},{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when a touch is canceled."}),this.penStartAction=new PhetioAction$1((Le,Ae,ae)=>{const Ie=new Pen(Le,Ae,ae.domEvent);this.addPointer(Ie),this.downEvent(Ie,ae,Ae)},{phetioPlayback:!0,tandem:(G=h.tandem)==null?void 0:G.createTandem("penStartAction"),parameters:[{name:"id",phetioType:NumberIO},{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when a pen touches the screen."}),this.penEndAction=new PhetioAction$1((Le,Ae,ae)=>{const Ie=this.findPointerById(Le);Ie&&(this.upEvent(Ie,ae,Ae),this.removePointer(Ie))},{phetioPlayback:!0,tandem:(ie=h.tandem)==null?void 0:ie.createTandem("penEndAction"),parameters:[{name:"id",phetioType:NumberIO},{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when a pen is lifted."}),this.penMoveAction=new PhetioAction$1((Le,Ae,ae)=>{const Ie=this.findPointerById(Le);Ie&&(Ie.move(Ae),this.moveEvent(Ie,ae))},{phetioPlayback:!0,tandem:(Z=h.tandem)==null?void 0:Z.createTandem("penMoveAction"),parameters:[{name:"id",phetioType:NumberIO},{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when a pen is moved.",phetioHighFrequency:!0}),this.penCancelAction=new PhetioAction$1((Le,Ae,ae)=>{const Ie=this.findPointerById(Le);Ie&&(this.cancelEvent(Ie,ae,Ae),this.removePointer(Ie))},{phetioPlayback:!0,tandem:(W=h.tandem)==null?void 0:W.createTandem("penCancelAction"),parameters:[{name:"id",phetioType:NumberIO},{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when a pen is canceled."}),this.gotPointerCaptureAction=new PhetioAction$1((Le,Ae)=>{const ae=this.findPointerById(Le);ae&&ae.onGotPointerCapture()},{phetioPlayback:!0,tandem:(X=h.tandem)==null?void 0:X.createTandem("gotPointerCaptureAction"),parameters:[{name:"id",phetioType:NumberIO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when a pointer is captured (normally at the start of an interaction)",phetioHighFrequency:!0}),this.lostPointerCaptureAction=new PhetioAction$1((Le,Ae)=>{const ae=this.findPointerById(Le);ae&&ae.onLostPointerCapture()},{phetioPlayback:!0,tandem:(J=h.tandem)==null?void 0:J.createTandem("lostPointerCaptureAction"),parameters:[{name:"id",phetioType:NumberIO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when a pointer loses its capture (normally at the end of an interaction)",phetioHighFrequency:!0}),this.focusinAction=new PhetioAction$1(Le=>{const Ae=this.getPDOMEventTrail(Le.domEvent,"focusin");Ae&&(sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`focusin(${st.debugText(null,Le.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.dispatchPDOMEvent(Ae,"focus",Le,!1),this.dispatchPDOMEvent(Ae,"focusin",Le,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop())},{phetioPlayback:!0,tandem:(oe=h.tandem)==null?void 0:oe.createTandem("focusinAction"),parameters:[{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when the PDOM root gets the focusin DOM event."}),this.focusoutAction=new PhetioAction$1(Le=>{const Ae=this.getPDOMEventTrail(Le.domEvent,"focusout");Ae&&(sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`focusOut(${st.debugText(null,Le.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.dispatchPDOMEvent(Ae,"blur",Le,!1),this.dispatchPDOMEvent(Ae,"focusout",Le,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop())},{phetioPlayback:!0,tandem:(le=h.tandem)==null?void 0:le.createTandem("focusoutAction"),parameters:[{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when the PDOM root gets the focusout DOM event."}),this.clickAction=new PhetioAction$1(Le=>{const Ae=this.getPDOMEventTrail(Le.domEvent,"click");Ae&&(sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`click(${st.debugText(null,Le.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.dispatchPDOMEvent(Ae,"click",Le,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop())},{phetioPlayback:!0,tandem:(pe=h.tandem)==null?void 0:pe.createTandem("clickAction"),parameters:[{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when the PDOM root gets the click DOM event."}),this.inputAction=new PhetioAction$1(Le=>{const Ae=this.getPDOMEventTrail(Le.domEvent,"input");Ae&&(sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`input(${st.debugText(null,Le.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.dispatchPDOMEvent(Ae,"input",Le,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop())},{phetioPlayback:!0,tandem:(ve=h.tandem)==null?void 0:ve.createTandem("inputAction"),parameters:[{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when the PDOM root gets the input DOM event."}),this.changeAction=new PhetioAction$1(Le=>{const Ae=this.getPDOMEventTrail(Le.domEvent,"change");Ae&&(sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`change(${st.debugText(null,Le.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.dispatchPDOMEvent(Ae,"change",Le,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop())},{phetioPlayback:!0,tandem:(Oe=h.tandem)==null?void 0:Oe.createTandem("changeAction"),parameters:[{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when the PDOM root gets the change DOM event."}),this.keydownAction=new PhetioAction$1(Le=>{sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`keydown(${st.debugText(null,Le.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.dispatchGlobalEvent("globalkeydown",Le,!0);const Ae=this.getPDOMEventTrail(Le.domEvent,"keydown");Ae&&this.dispatchPDOMEvent(Ae,"keydown",Le,!0),this.dispatchGlobalEvent("globalkeydown",Le,!1),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()},{phetioPlayback:!0,tandem:(He=h.tandem)==null?void 0:He.createTandem("keydownAction"),parameters:[{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when the PDOM root gets the keydown DOM event."}),this.keyupAction=new PhetioAction$1(Le=>{sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`keyup(${st.debugText(null,Le.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.dispatchGlobalEvent("globalkeyup",Le,!0);const Ae=this.getPDOMEventTrail(Le.domEvent,"keydown");Ae&&this.dispatchPDOMEvent(Ae,"keyup",Le,!0),this.dispatchGlobalEvent("globalkeyup",Le,!1),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()},{phetioPlayback:!0,tandem:(Ue=h.tandem)==null?void 0:Ue.createTandem("keyupAction"),parameters:[{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when the PDOM root gets the keyup DOM event."})}interruptPointers(e=null){_.each(this.pointers,t=>{t!==e&&t.interruptAll()})}batchEvent(e,t,n,r){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent("Input.batchEvent"),sceneryLog&&sceneryLog.InputEvent&&sceneryLog.push(),this.display.interactive&&(this.batchedEvents.push(BatchedDOMEvent.pool.create(e,t,n)),(r||!this.batchDOMEvents)&&this.fireBatchedEvents()),this.passiveEvents!==!0&&(n!==this.mouseDown||platform.edge)&&t!==BatchedDOMEventType.ALT_TYPE&&!e.allowsDOMInput()&&e.domEvent.preventDefault(),sceneryLog&&sceneryLog.InputEvent&&sceneryLog.pop()}fireBatchedEvents(){if(sceneryLog&&sceneryLog.InputEvent&&this.currentlyFiringEvents&&sceneryLog.InputEvent("REENTRANCE DETECTED"),!this.currentlyFiringEvents&&this.batchedEvents.length){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`Input.fireBatchedEvents length:${this.batchedEvents.length}`),sceneryLog&&sceneryLog.InputEvent&&sceneryLog.push(),this.currentlyFiringEvents=!0;const e=this.batchedEvents;for(let t=0;t<e.length;t++){const n=e[t];n.run(this),n.dispose()}cleanArray(e),this.currentlyFiringEvents=!1,sceneryLog&&sceneryLog.InputEvent&&sceneryLog.pop()}}clearBatchedEvents(){this.batchedEvents.length=0}validatePointers(){this.validatePointersAction.execute()}removeTemporaryPointers(){for(let e=this.pointers.length-1;e>=0;e--){const t=this.pointers[e];if(!(t instanceof Mouse)){this.pointers.splice(e,1);const n=t.trail||new Trail(this.rootNode);this.exitEvents(t,EventContext.createSynthetic(),n,0,!0)}}}connectListeners(){BrowserEvents$1.addDisplay(this.display,this.attachToWindow,this.passiveEvents)}disconnectListeners(){BrowserEvents$1.removeDisplay(this.display,this.attachToWindow,this.passiveEvents)}pointFromEvent(e){const t=Vector2.pool.create(e.clientX,e.clientY);if(!this.assumeFullWindow){const n=this.display.domElement.getBoundingClientRect();n.width>0&&n.height>0&&(t.subtractXY(n.left,n.top),(n.width!==this.display.width||n.height!==this.display.height)&&(t.x*=this.display.width/n.width,t.y*=this.display.height/n.height))}return t}addPointer(e){this.pointers.push(e),this.pointerAddedEmitter.emit(e)}removePointer(e){for(let t=this.pointers.length-1;t>=0;t--)this.pointers[t]===e&&this.pointers.splice(t,1);e.dispose()}findPointerById(e){let t=this.pointers.length;for(;t--;){const n=this.pointers[t];if(n.id===e)return n}return null}getPDOMEventTrail(e,t){if(!this.display.interactive)return null;const n=this.getTrailFromPDOMEvent(e);return n&&!(t==="click"&&_.some(n.nodes,s=>s.positionInPDOM)&&e.timeStamp-this.upTimeStamp<=PDOM_CLICK_DELAY)?n:null}initMouse(e){const t=new Mouse(e);return this.mouse=t,this.addPointer(t),t}ensureMouse(e){const t=this.mouse;return t||this.initMouse(e)}initPDOMPointer(){const e=new PDOMPointer(this.display);return this.pdomPointer=e,this.addPointer(e),e}ensurePDOMPointer(){const e=this.pdomPointer;return e||this.initPDOMPointer()}dispatchPDOMEvent(e,t,n,r){this.ensurePDOMPointer().updateTrail(e),PDOMUtils$1.USER_GESTURE_EVENTS.includes(t)&&Display.userGestureEmitter.emit();const s=n.domEvent;s.target&&s.target.hasAttribute(PDOMUtils$1.DATA_EXCLUDE_FROM_INPUT)||(e.isPickable()||PDOM_UNPICKABLE_EVENTS.includes(t)||(e=new Trail([])),assert&&assert(this.pdomPointer),this.dispatchEvent(e,t,this.pdomPointer,n,r))}dispatchGlobalEvent(e,t,n){this.ensurePDOMPointer(),assert&&assert(this.pdomPointer);const r=this.pdomPointer,s=new SceneryEvent(new Trail,e,r,t),a=h=>{if(!h.isDisposed&&h.isVisible()&&h.isInputEnabled()&&h.isPDOMVisible()){for(let c=h._children.length-1;c>=0;c--)a(h._children[c]);!s.aborted&&!s.handled&&(s.currentTarget=h,this.dispatchToListeners(r,h._inputListeners,e,s,n))}};a(this.rootNode)}getRelatedTargetTrail(e){const t=e.relatedTarget;if(t&&this.display.isElementUnderPDOM(t)){const n=e.relatedTarget;assert&&assert(n instanceof window.Element);const r=n.getAttribute(PDOMUtils$1.DATA_PDOM_UNIQUE_ID);return assert&&assert(r,"should not be null"),PDOMInstance$1.uniqueIdToTrail(this.display,r)}return null}getTrailFromPDOMEvent(e){if(assert&&assert(e.target||e[TARGET_SUBSTITUTE_KEY],"need a way to get the target"),!this.display._accessible)return null;if(e[TARGET_SUBSTITUTE_KEY]){const t=e[TARGET_SUBSTITUTE_KEY].getAttribute(PDOMUtils$1.DATA_PDOM_UNIQUE_ID);return PDOMInstance$1.uniqueIdToTrail(this.display,t)}else{const t=e.target;if(assert&&assert(t instanceof window.Element,"target is not an Element",t),t&&this.display.isElementUnderPDOM(t)){const n=t.getAttribute(PDOMUtils$1.DATA_PDOM_UNIQUE_ID);return assert&&assert(n,"should not be null"),PDOMInstance$1.uniqueIdToTrail(this.display,n)}}return null}mouseDown(e,t,n){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`mouseDown('${e}', ${st.debugText(t,n.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.mouseDownAction.execute(e,t,n),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}mouseUp(e,t){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`mouseUp(${st.debugText(e,t.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.mouseUpAction.execute(e,t),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}mouseMove(e,t){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`mouseMove(${st.debugText(e,t.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.mouseMoveAction.execute(e,t),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}mouseOver(e,t){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`mouseOver(${st.debugText(e,t.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.mouseOverAction.execute(e,t),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}mouseOut(e,t){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`mouseOut(${st.debugText(e,t.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.mouseOutAction.execute(e,t),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}wheel(e){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`wheel(${st.debugText(null,e.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.wheelScrollAction.execute(e),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}touchStart(e,t,n){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`touchStart('${e}',${st.debugText(t,n.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.touchStartAction.execute(e,t,n),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}touchEnd(e,t,n){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`touchEnd('${e}',${st.debugText(t,n.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.touchEndAction.execute(e,t,n),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}touchMove(e,t,n){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`touchMove('${e}',${st.debugText(t,n.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.touchMoveAction.execute(e,t,n),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}touchCancel(e,t,n){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`touchCancel('${e}',${st.debugText(t,n.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.touchCancelAction.execute(e,t,n),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}penStart(e,t,n){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`penStart('${e}',${st.debugText(t,n.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.penStartAction.execute(e,t,n),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}penEnd(e,t,n){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`penEnd('${e}',${st.debugText(t,n.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.penEndAction.execute(e,t,n),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}penMove(e,t,n){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`penMove('${e}',${st.debugText(t,n.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.penMoveAction.execute(e,t,n),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}penCancel(e,t,n){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`penCancel('${e}',${st.debugText(t,n.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.penCancelAction.execute(e,t,n),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}pointerDown(e,t,n,r){const s=this.attachToWindow?document.body:this.display.domElement;switch(s.setPointerCapture&&r.domEvent.pointerId&&!r.allowsDOMInput()&&s.setPointerCapture(r.domEvent.pointerId),t=this.handleUnknownPointerType(t,e),t){case"mouse":this.mouseDown(e,n,r);break;case"touch":this.touchStart(e,n,r);break;case"pen":this.penStart(e,n,r);break;default:if(assert)throw new Error(`Unknown pointer type: ${t}`)}}pointerUp(e,t,n,r){switch(this.upTimeStamp=r.domEvent.timeStamp,t=this.handleUnknownPointerType(t,e),t){case"mouse":this.mouseUp(n,r);break;case"touch":this.touchEnd(e,n,r);break;case"pen":this.penEnd(e,n,r);break;default:if(assert)throw new Error(`Unknown pointer type: ${t}`)}}pointerCancel(e,t,n,r){switch(t=this.handleUnknownPointerType(t,e),t){case"mouse":console&&console.log&&console.log("WARNING: Pointer mouse cancel was received");break;case"touch":this.touchCancel(e,n,r);break;case"pen":this.penCancel(e,n,r);break;default:console.log&&console.log(`Unknown pointer type: ${t}`)}}gotPointerCapture(e,t,n,r){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`gotPointerCapture('${e}',${st.debugText(null,r.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.gotPointerCaptureAction.execute(e,r),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}lostPointerCapture(e,t,n,r){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`lostPointerCapture('${e}',${st.debugText(null,r.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.lostPointerCaptureAction.execute(e,r),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}pointerMove(e,t,n,r){switch(t=this.handleUnknownPointerType(t,e),t){case"mouse":this.mouseMove(n,r);break;case"touch":this.touchMove(e,n,r);break;case"pen":this.penMove(e,n,r);break;default:console.log&&console.log(`Unknown pointer type: ${t}`)}}pointerOver(e,t,n,r){}pointerOut(e,t,n,r){}pointerEnter(e,t,n,r){}pointerLeave(e,t,n,r){}focusIn(e){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`focusIn('${st.debugText(null,e.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.focusinAction.execute(e),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}focusOut(e){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`focusOut('${st.debugText(null,e.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.focusoutAction.execute(e),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}input(e){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`input('${st.debugText(null,e.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.inputAction.execute(e),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}change(e){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`change('${st.debugText(null,e.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.changeAction.execute(e),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}click(e){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`click('${st.debugText(null,e.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.clickAction.execute(e),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}keyDown(e){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`keyDown('${st.debugText(null,e.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.keydownAction.execute(e),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}keyUp(e){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`keyUp('${st.debugText(null,e.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.keyupAction.execute(e),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}handleUnknownPointerType(e,t){return e!==""?e:this.mouse&&this.mouse.id===t?"mouse":"touch"}getPointerTrail(e){return this.rootNode.trailUnderPointer(e)||new Trail(this.rootNode)}upEvent(e,t,n){if(this.display.isElementUnderPDOM(t.domEvent.target))return;const r=e.up(n,t.domEvent);sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`upEvent ${e.toString()} changed:${r}`),sceneryLog&&sceneryLog.Input&&sceneryLog.push();const s=this.branchChangeEvents(e,t,r);this.dispatchEvent(s,"up",e,t,!0),e.isTouchLike()&&this.exitEvents(e,t,s,0,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}downEvent(e,t,n){if(this.display.isElementUnderPDOM(t.domEvent.target))return;const r=e.updatePoint(n);sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`downEvent ${e.toString()} changed:${r}`),sceneryLog&&sceneryLog.Input&&sceneryLog.push();const s=this.branchChangeEvents(e,t,r);e.down(t.domEvent),this.dispatchEvent(s,"down",e,t,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}moveEvent(e,t){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`moveEvent ${e.toString()}`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.branchChangeEvents(e,t,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}cancelEvent(e,t,n){const r=e.cancel(n);sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`cancelEvent ${e.toString()} changed:${r}`),sceneryLog&&sceneryLog.Input&&sceneryLog.push();const s=this.branchChangeEvents(e,t,r);this.dispatchEvent(s,"cancel",e,t,!0),e.isTouchLike()&&this.exitEvents(e,t,s,0,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}branchChangeEvents(e,t,n){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`branchChangeEvents: ${e.toString()} sendMove:${n}`),sceneryLog&&sceneryLog.InputEvent&&sceneryLog.push();const r=this.getPointerTrail(e),s=r.slice(0,Math.min(r.nodes.length,r.getLastInputEnabledIndex()+1)),a=e.inputEnabledTrail||new Trail(this.rootNode),h=Trail.branchIndex(s,a),c=a.lastNode()!==s.lastNode();if(sceneryLog&&sceneryLog.InputEvent){const d=e.trail||new Trail(this.rootNode),y=Trail.branchIndex(r,d);(y!==r.length||y!==d.length)&&sceneryLog.InputEvent(`changed from ${d.toString()} to ${r.toString()}`)}return n&&this.dispatchEvent(r,"move",e,t,!0),this.exitEvents(e,t,a,h,c),this.enterEvents(e,t,s,h,c),e.trail=r,e.inputEnabledTrail=s,sceneryLog&&sceneryLog.InputEvent&&sceneryLog.pop(),r}enterEvents(e,t,n,r,s){s&&this.dispatchEvent(n,"over",e,t,!0,!0);for(let a=r;a<n.length;a++)this.dispatchEvent(n.slice(0,a+1),"enter",e,t,!1)}exitEvents(e,t,n,r,s){for(let a=n.length-1;a>=r;a--)this.dispatchEvent(n.slice(0,a+1),"exit",e,t,!1,!0);s&&this.dispatchEvent(n,"out",e,t,!0)}dispatchEvent(e,t,n,r,s,a=!1){sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.EventDispatch(`${t} trail:${e.toString()} pointer:${n.toString()} at ${n.point?n.point.toString():"null"}`),sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.push(),assert&&assert(e,"Falsy trail for dispatchEvent"),sceneryLog&&sceneryLog.EventPath&&sceneryLog.EventPath(`${t} ${e.toPathString()}`);const h=new SceneryEvent(e,t,n,r);this.currentSceneryEvent=h,this.dispatchToListeners(n,n.getListeners(),t,h),this.dispatchToTargets(e,t,n,h,s,a),this.dispatchToListeners(n,this.display.getInputListeners(),t,h),Display.inputListeners.length&&this.dispatchToListeners(n,Display.inputListeners.slice(),t,h),this.currentSceneryEvent=null,sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.pop()}dispatchToListeners(e,t,n,r,s=null){if(r.handled)return;const a=e.type+n;for(let h=0;h<t.length;h++){const c=t[h];(s===null||s===!!c.capture)&&(!r.aborted&&c[a]&&(sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.EventDispatch(a),sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.push(),c[a](r),sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.pop()),!r.aborted&&c[n]&&(sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.EventDispatch(n),sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.push(),c[n](r),sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.pop()))}}dispatchToTargets(e,t,n,r,s,a=!1){if(r.aborted||r.handled)return;const h=e.getLastInputEnabledIndex();for(let c=e.nodes.length-1;c>=0;s?c--:c=-1){const d=e.nodes[c],y=h<c;if(!(d.isDisposed||!a&&y)&&(r.currentTarget=d,this.dispatchToListeners(n,d.getInputListeners(),t,r),r.aborted||r.handled))return}}static serializeDomEvent(e){const t={constructorName:e.constructor.name};return domEventPropertiesToSerialize.forEach(n=>{const r=e[n];r==null?t[n]=null:r instanceof Element&&EVENT_KEY_VALUES_AS_ELEMENTS.includes(n)&&typeof r.getAttribute=="function"&&r.hasAttribute(PDOMUtils$1.DATA_PDOM_UNIQUE_ID)?t[n]={[PDOMUtils$1.DATA_PDOM_UNIQUE_ID]:r.getAttribute(PDOMUtils$1.DATA_PDOM_UNIQUE_ID),id:r.getAttribute("id")}:t[n]=typeof r=="object"?{}:JSON.parse(JSON.stringify(r))}),t}static deserializeDomEvent(e){const t=e.constructorName||"Event",n=_.pick(e,domEventPropertiesSetInConstructor);if(n.relatedTarget){const s=document.getElementById(n.relatedTarget.id);assert&&assert(s,"cannot deserialize event when related target is not in the DOM."),n.relatedTarget=s}const r=new window[t](t,n);for(const s in e)if(e.hasOwnProperty(s)&&!domEventPropertiesSetInConstructor.includes(s))if(s==="target"){if(assert){const a=e.target;a&&a.id&&assert(document.getElementById(a.id),"target should exist in the PDOM to support playback.")}r[TARGET_SUBSTITUTE_KEY]=_.clone(e[s])||{},r[TARGET_SUBSTITUTE_KEY].getAttribute=function(a){return this[a]}}else r[s]=e[s];return r}static debugText(e,t){let n=`${t.timeStamp} ${t.type}`;return e!==null&&(n=`${e.x},${e.y} ${n}`),n}static msPointerType(e){return e.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_TOUCH?"touch":e.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_PEN?"pen":e.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_MOUSE?"mouse":e.pointerType}};st.InputIO=new IOType("InputIO",{valueType:st,applyState:_.noop,toStateObject:e=>({pointers:ArrayIOPointerIO.toStateObject(e.pointers)}),stateSchema:{pointers:ArrayIOPointerIO}});let Input=st;scenery.register("Input",Input);const xt=class xt extends EnumerationValue{};xt.POINTER_TYPE=new xt,xt.MS_POINTER_TYPE=new xt,xt.TOUCH_TYPE=new xt,xt.MOUSE_TYPE=new xt,xt.WHEEL_TYPE=new xt,xt.ALT_TYPE=new xt,xt.enumeration=new Enumeration(xt,{phetioDocumentation:"The type of batched event"});let BatchedDOMEventType=xt;const bs=class bs{constructor(e,t,n){this.initialize(e,t,n)}initialize(e,t,n){return assert&&assert(e.domEvent,"for some reason, there is no DOM event?"),this.eventContext=e,this.type=t,this.callback=n,this}run(e){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent("Running batched event"),sceneryLog&&sceneryLog.InputEvent&&sceneryLog.push();const t=this.callback;if(e.validatePointers(),this.type===BatchedDOMEventType.POINTER_TYPE){const n=this.eventContext,r=n.domEvent;t.call(e,r.pointerId,r.pointerType,e.pointFromEvent(r),n)}else if(this.type===BatchedDOMEventType.MS_POINTER_TYPE){const n=this.eventContext,r=n.domEvent;t.call(e,r.pointerId,Input.msPointerType(r),e.pointFromEvent(r),n)}else if(this.type===BatchedDOMEventType.TOUCH_TYPE){const n=this.eventContext,r=n.domEvent;for(let s=0;s<r.changedTouches.length;s++){const a=r.changedTouches.item(s);t.call(e,a.identifier,e.pointFromEvent(a),n)}}else if(this.type===BatchedDOMEventType.MOUSE_TYPE){const n=this.eventContext,r=e.pointFromEvent(n.domEvent);t===e.mouseDown?t.call(e,null,r,n):t.call(e,r,n)}else if(this.type===BatchedDOMEventType.WHEEL_TYPE||this.type===BatchedDOMEventType.ALT_TYPE)t.call(e,this.eventContext);else throw new Error(`bad type value: ${this.type}`);sceneryLog&&sceneryLog.InputEvent&&sceneryLog.pop()}dispose(){this.eventContext=null,this.callback=null,this.freeToPool()}freeToPool(){bs.pool.freeToPool(this)}};bs.pool=new Pool(bs);let BatchedDOMEvent=bs;scenery.register("BatchedDOMEvent",BatchedDOMEvent);const noop=()=>{};let isGloballyAttached=!1;const BrowserEvents={blockFocusCallbacks:!1,addDisplay(o,e,t){assert&&assert(o instanceof Display),assert&&assert(typeof e=="boolean"),assert&&assert(!_.includes(this.attachedDisplays,o),"A display cannot be concurrently attached to events more than one time"),isGloballyAttached||(isGloballyAttached=!0,globalKeyStateTracker$1.attachToWindow(),FocusManager.attachToWindow()),this.attachedDisplays.push(o),e?this.attachedDisplays.length===1&&this.connectWindowListeners(t):this.addOrRemoveListeners(o.domElement,!0,t),o.domElement.addEventListener("wheel",this.onwheel,BrowserEvents.getEventOptions(t,!0))},removeDisplay(o,e,t){assert&&assert(o instanceof Display),assert&&assert(typeof e=="boolean"),assert&&assert(_.includes(this.attachedDisplays,o),"This display was not already attached to listen for window events"),arrayRemove(this.attachedDisplays,o),e?this.attachedDisplays.length===0&&this.disconnectWindowListeners(t):this.addOrRemoveListeners(o.domElement,!1,t),o.domElement.removeEventListener("wheel",this.onwheel,BrowserEvents.getEventOptions(t,!0))},getEventOptions(o,e){if(Features.passive&&o!==null){const n={passive:o};return e&&(n.capture=!1),assert&&assert(!n.capture,"Do not use capture without consulting globalKeyStateTracker, which expects have listeners called FIRST in keyboard-related cases."),n}else return!1},listenersAttachedToWindow:0,listenersAttachedToElement:0,attachedDisplays:[],canUsePointerEvents:!!(window.navigator&&window.navigator.pointerEnabled||window.PointerEvent)&&!platform.firefox,canUseMSPointerEvents:window.navigator&&window.navigator.msPointerEnabled,pointerListenerTypes:["pointerdown","pointerup","pointermove","pointerover","pointerout","pointercancel","gotpointercapture","lostpointercapture"],msPointerListenerTypes:["MSPointerDown","MSPointerUp","MSPointerMove","MSPointerOver","MSPointerOut","MSPointerCancel"],touchListenerTypes:["touchstart","touchend","touchmove","touchcancel"],mouseListenerTypes:["mousedown","mouseup","mousemove","mouseover","mouseout"],wheelListenerTypes:["wheel"],altListenerTypes:PDOMUtils$1.DOM_EVENTS,getNonWheelUsedTypes(){let o;return this.canUsePointerEvents?(sceneryLog&&sceneryLog.Input&&sceneryLog.Input("Detected pointer events support, using that instead of mouse/touch events"),o=this.pointerListenerTypes):this.canUseMSPointerEvents?(sceneryLog&&sceneryLog.Input&&sceneryLog.Input("Detected MS pointer events support, using that instead of mouse/touch events"),o=this.msPointerListenerTypes):(sceneryLog&&sceneryLog.Input&&sceneryLog.Input("No pointer events support detected, using mouse/touch events"),o=this.touchListenerTypes.concat(this.mouseListenerTypes)),o=o.concat(this.altListenerTypes),o},connectWindowListeners(o){this.addOrRemoveListeners(window,!0,o)},disconnectWindowListeners(o){this.addOrRemoveListeners(window,!1,o)},addOrRemoveListeners(o,e,t){assert&&assert(typeof e=="boolean"),assert&&assert(typeof t=="boolean"||t===null);const n=o===window;assert&&assert(!n||this.listenersAttachedToWindow>0==!e,"Do not add listeners to the window when already attached, or remove listeners when none are attached");const r=e?1:-1;n?this.listenersAttachedToWindow+=r:this.listenersAttachedToElement+=r,assert&&assert(this.listenersAttachedToWindow===0||this.listenersAttachedToElement===0,"Listeners should not be added both with addDisplayToWindow and addDisplayToElement. Use only one.");const s=e?"addEventListener":"removeEventListener",a=this.getNonWheelUsedTypes();for(let h=0;h<a.length;h++){const c=a[h];n&&document[s](c,noop,BrowserEvents.getEventOptions(t,!1));const d=this[`on${c}`];assert&&assert(!!d),o[s](c,d,BrowserEvents.getEventOptions(t,!0))}},batchWindowEvent(o,e,t,n){for(let r=0;r<this.attachedDisplays.length;r++){const a=this.attachedDisplays[r]._input;(!BrowserEvents.blockFocusCallbacks||t!=="focusIn"&&t!=="focusOut")&&a.batchEvent(o,e,a[t],n)}},onpointerdown:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("pointerdown"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push();const t=new EventContext(e);e.pointerType==="mouse"&&Display.userGestureEmitter.emit(),BrowserEvents.batchWindowEvent(t,BatchedDOMEventType.POINTER_TYPE,"pointerDown",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onpointerup:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("pointerup"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push();const t=new EventContext(e);Display.userGestureEmitter.emit(),BrowserEvents.batchWindowEvent(t,BatchedDOMEventType.POINTER_TYPE,"pointerUp",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onpointermove:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("pointermove"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.POINTER_TYPE,"pointerMove",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onpointerover:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("pointerover"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.POINTER_TYPE,"pointerOver",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onpointerout:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("pointerout"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.POINTER_TYPE,"pointerOut",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onpointercancel:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("pointercancel"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.POINTER_TYPE,"pointerCancel",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},ongotpointercapture:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("gotpointercapture"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.POINTER_TYPE,"gotPointerCapture",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onlostpointercapture:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("lostpointercapture"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.POINTER_TYPE,"lostPointerCapture",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onMSPointerDown:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("MSPointerDown"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.MS_POINTER_TYPE,"pointerDown",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onMSPointerUp:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("MSPointerUp"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.MS_POINTER_TYPE,"pointerUp",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onMSPointerMove:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("MSPointerMove"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.MS_POINTER_TYPE,"pointerMove",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onMSPointerOver:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("MSPointerOver"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.MS_POINTER_TYPE,"pointerOver",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onMSPointerOut:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("MSPointerOut"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.MS_POINTER_TYPE,"pointerOut",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onMSPointerCancel:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("MSPointerCancel"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.MS_POINTER_TYPE,"pointerCancel",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},ontouchstart:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("touchstart"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.TOUCH_TYPE,"touchStart",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},ontouchend:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("touchend"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push();const t=new EventContext(e);Display.userGestureEmitter.emit(),BrowserEvents.batchWindowEvent(t,BatchedDOMEventType.TOUCH_TYPE,"touchEnd",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},ontouchmove:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("touchmove"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.TOUCH_TYPE,"touchMove",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},ontouchcancel:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("touchcancel"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.TOUCH_TYPE,"touchCancel",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onmousedown:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("mousedown"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push();const t=new EventContext(e);Display.userGestureEmitter.emit(),BrowserEvents.batchWindowEvent(t,BatchedDOMEventType.MOUSE_TYPE,"mouseDown",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onmouseup:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("mouseup"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push();const t=new EventContext(e);Display.userGestureEmitter.emit(),BrowserEvents.batchWindowEvent(t,BatchedDOMEventType.MOUSE_TYPE,"mouseUp",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onmousemove:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("mousemove"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.MOUSE_TYPE,"mouseMove",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onmouseover:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("mouseover"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.MOUSE_TYPE,"mouseOver",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onmouseout:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("mouseout"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.MOUSE_TYPE,"mouseOut",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onwheel:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("wheel"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.WHEEL_TYPE,"wheel",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onfocusin:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("focusin"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),FocusManager.updatePDOMFocusFromEvent(BrowserEvents.attachedDisplays,e,!0),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.ALT_TYPE,"focusIn",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onfocusout:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("focusout"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),FocusManager.updatePDOMFocusFromEvent(BrowserEvents.attachedDisplays,e,!1),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.ALT_TYPE,"focusOut",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},oninput:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("input"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.ALT_TYPE,"input",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onchange:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("change"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.ALT_TYPE,"change",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onclick:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("click"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.ALT_TYPE,"click",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onkeydown:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("keydown"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.ALT_TYPE,"keyDown",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onkeyup:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("keyup"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(e),BatchedDOMEventType.ALT_TYPE,"keyUp",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()}};scenery.register("BrowserEvents",BrowserEvents);const BrowserEvents$1=BrowserEvents;class Hotkey extends EnabledComponent{constructor(e){assert&&assert(e.fireOnHoldTiming==="custom"||e.fireOnHoldCustomDelay===void 0&&e.fireOnHoldCustomInterval===void 0,"Cannot specify fireOnHoldCustomDelay / fireOnHoldCustomInterval if fireOnHoldTiming is not custom");const t=optionize()({modifierKeys:[],ignoredModifierKeys:[],fire:_.noop,fireOnDown:!0,fireOnHold:!1,fireOnHoldTiming:"browser",fireOnHoldCustomDelay:400,fireOnHoldCustomInterval:100,allowOverlap:!1},e);super(t),this.isPressedProperty=new BooleanProperty(!1),this.interrupted=!1,this.key=t.key,this.modifierKeys=t.modifierKeys,this.ignoredModifierKeys=t.ignoredModifierKeys,this.fire=t.fire,this.fireOnDown=t.fireOnDown,this.fireOnHold=t.fireOnHold,this.fireOnHoldTiming=t.fireOnHoldTiming,this.allowOverlap=t.allowOverlap,this.keys=_.uniq([this.key,...this.modifierKeys]),this.fireOnHold&&this.fireOnHoldTiming==="custom"&&(this.fireOnHoldTimer=new CallbackTimer({callback:this.fire.bind(this,null),delay:t.fireOnHoldCustomDelay,interval:t.fireOnHoldCustomInterval}),this.disposeEmitter.addListener(()=>this.fireOnHoldTimer.dispose()),this.isPressedProperty.link(n=>{this.fireOnHoldTimer.stop(!1),n&&this.fireOnHoldTimer.start()}))}getHotkeyString(){return[...this.modifierKeys,this.key].join("+")}dispose(){this.isPressedProperty.dispose(),super.dispose()}}scenery.register("Hotkey",Hotkey);class GlobalHotkeyRegistry{constructor(){this.hotkeysProperty=new TinyProperty(new Set)}add(e){assert&&assert(!this.hotkeysProperty.value.has(e),"Hotkey already added"),this.hotkeysProperty.value=new Set([...this.hotkeysProperty.value,e])}remove(e){assert&&assert(this.hotkeysProperty.value.has(e),"Hotkey not found"),this.hotkeysProperty.value=new Set([...this.hotkeysProperty.value].filter(t=>t!==e))}}scenery.register("GlobalHotkeyRegistry",GlobalHotkeyRegistry);const globalHotkeyRegistry=new GlobalHotkeyRegistry,setComparator=(o,e)=>o.size===e.size&&[...o].every(t=>e.has(t));class HotkeyManager{constructor(){this.enabledHotkeysProperty=new TinyProperty(new Set),this.englishKeysDown=new Set,this.modifierKeys=[],this.activeHotkeys=new Set,this.availableHotkeysProperty=new DerivedProperty([globalHotkeyRegistry.hotkeysProperty,FocusManager.pdomFocusProperty],(r,s)=>{const a=new Set(r);if(s)for(const h of s.trail.nodes){if(!h.isInputEnabled())break;h.inputListeners.forEach(c=>{var d;(d=c.hotkeys)==null||d.forEach(y=>{a.add(y)})})}return a},{valueComparisonStrategy:setComparator});const e=()=>{this.availableHotkeysProperty.recomputeDerivation()};FocusManager.pdomFocusProperty.link((r,s)=>{s&&s.trail.nodes.forEach(a=>{a.inputEnabledProperty.unlink(e)}),r&&r.trail.nodes.forEach(a=>{a.inputEnabledProperty.lazyLink(e)})});const t=()=>{this.enabledHotkeysProperty.value=new Set([...this.availableHotkeysProperty.value].filter(r=>r.enabledProperty.value))},n=new Map;this.availableHotkeysProperty.link((r,s)=>{let a=!1;if(s){for(const h of s)if(!r.has(h)){const c=n.get(h);n.delete(h),assert&&assert(c),h.enabledProperty.unlink(c),a=!0}}for(const h of r)if(!s||!s.has(h)){const c=()=>t();n.set(h,c),h.enabledProperty.lazyLink(c),a=!0}a&&t()}),this.enabledHotkeysProperty.link((r,s)=>{if(this.modifierKeys=_.uniq([...metaEnglishKeys,...[...r].flatMap(a=>a.modifierKeys)]),s)for(const a of s)!r.has(a)&&this.activeHotkeys.has(a)&&this.removeActiveHotkey(a,null,!1);this.updateHotkeyStatus(null)}),globalKeyStateTracker$1.keyDownStateChangedEmitter.addListener(r=>{const s=globalKeyStateTracker$1.getEnglishKeysDown();if(!setComparator(this.englishKeysDown,s))this.englishKeysDown=s,this.updateHotkeyStatus(r);else for(const h of[...this.activeHotkeys])h.fireOnHold&&h.fireOnHoldTiming==="browser"&&h.fire(r)})}getHotkeysForMainKey(e){if(!this.englishKeysDown.has(e))return[];const t=[...this.enabledHotkeysProperty.value].filter(n=>n.key!==e?!1:this.modifierKeys.every(r=>this.englishKeysDown.has(r)===n.keys.includes(r)||n.ignoredModifierKeys.includes(r)));if(assert){const n=t.filter(r=>!r.allowOverlap);assert&&assert(n.length<2,`Key conflict detected: ${n.map(r=>r.getHotkeyString())}`)}return t}updateHotkeyStatus(e){const t=KeyboardUtils.getEventCode(e),n=t?eventCodeToEnglishString(t):null;for(const r of this.enabledHotkeysProperty.value){const s=this.getHotkeysForMainKey(r.key).includes(r),a=this.activeHotkeys.has(r);s&&!a?this.addActiveHotkey(r,null,r.key===n):!s&&a&&this.removeActiveHotkey(r,null,r.key===n)}}addActiveHotkey(e,t,n){this.activeHotkeys.add(e),e.isPressedProperty.value=!0,e.interrupted=!1,n&&e.fireOnDown&&e.fire(t)}removeActiveHotkey(e,t,n){e.interrupted=!n,n&&!e.fireOnDown&&e.fire(t),e.isPressedProperty.value=!1,this.activeHotkeys.delete(e)}}scenery.register("HotkeyManager",HotkeyManager);new HotkeyManager;class InputFuzzer{constructor(e,t){this.display=e,this.touches=[],this.nextTouchID=1,this.isMouseDown=!1,this.mousePosition=new Vector2(0,0),this.random=new Random({seed:t}),this.mouseToggleAction=()=>{this.mouseToggle()},this.mouseMoveAction=()=>{this.mouseMove()},this.touchStartAction=()=>{const n=this.createTouch(this.getRandomPosition());this.touchStart(n)},this.touchMoveAction=()=>{const n=this.random.sample(this.touches);this.touchMove(n)},this.touchEndAction=()=>{const n=this.random.sample(this.touches);this.touchEnd(n),this.removeTouch(n)},this.touchCancelAction=()=>{const n=this.random.sample(this.touches);this.touchCancel(n),this.removeTouch(n)}}fuzzEvents(e,t,n,r){for(assert&&assert(e>0,`averageEventCount must be positive: ${e}`),this.display._input.currentlyFiringEvents=!0;this.random.nextDouble()<1-1/(e+1);){const a=this.touches.length+(this.isMouseDown?1:0)<r,h=[];t&&(this.isMouseDown||a)&&(h.push(this.mouseToggleAction),h.push(this.mouseMoveAction)),n&&(a&&h.push(this.touchStartAction),this.touches.length&&(h.push(this.random.nextDouble()<.8?this.touchEndAction:this.touchCancelAction),h.push(this.touchMoveAction))),this.random.sample(h)()}this.display._input.currentlyFiringEvents=!1,this.display._input.fireBatchedEvents()}createTouchEvent(e,t){const n=this.display.domElement,r=t.map(s=>({identifier:s.id,target:n,clientX:s.position.x,clientY:s.position.y}));if(window.Touch!==void 0&&window.TouchEvent!==void 0&&window.Touch.length===1&&window.TouchEvent.length===1){const s=r.map(a=>new window.Touch(a));return new window.TouchEvent(e,{cancelable:!0,bubbles:!0,touches:s,targetTouches:[],changedTouches:s,shiftKey:!1})}else{const s=document.createEvent("CustomEvent");return s.initCustomEvent(e,!0,!0,{touches:r,targetTouches:[],changedTouches:r}),s}}getRandomPosition(){return new Vector2(Math.floor(this.random.nextDouble()*this.display.width),Math.floor(this.random.nextDouble()*this.display.height))}createTouch(e){const t={id:this.nextTouchID++,position:e};return this.touches.push(t),t}removeTouch(e){this.touches.splice(this.touches.indexOf(e),1)}touchStart(e){const t=this.createTouchEvent("touchstart",[e]);this.display._input.validatePointers(),this.display._input.touchStart(e.id,e.position,new EventContext(t))}touchMove(e){e.position=this.getRandomPosition();const t=this.createTouchEvent("touchmove",[e]);this.display._input.validatePointers(),this.display._input.touchMove(e.id,e.position,new EventContext(t))}touchEnd(e){const t=this.createTouchEvent("touchend",[e]);this.display._input.validatePointers(),this.display._input.touchEnd(e.id,e.position,new EventContext(t))}touchCancel(e){const t=this.createTouchEvent("touchcancel",[e]);this.display._input.validatePointers(),this.display._input.touchCancel(e.id,e.position,new EventContext(t))}mouseToggle(){const e=document.createEvent("MouseEvent");e.initMouseEvent(this.isMouseDown?"mouseup":"mousedown",!0,!0,window,1,this.mousePosition.x,this.mousePosition.y,this.mousePosition.x,this.mousePosition.y,!1,!1,!1,!1,0,null),this.display._input.validatePointers(),this.isMouseDown?(this.display._input.mouseUp(this.mousePosition,new EventContext(e)),this.isMouseDown=!1):(this.display._input.mouseDown(null,this.mousePosition,new EventContext(e)),this.isMouseDown=!0)}mouseMove(){this.mousePosition=this.getRandomPosition();const e=document.createEvent("MouseEvent");e.initMouseEvent("mousemove",!0,!0,window,0,this.mousePosition.x,this.mousePosition.y,this.mousePosition.x,this.mousePosition.y,!1,!1,!1,!1,0,null),this.display._input.validatePointers(),this.display._input.mouseMove(this.mousePosition,new EventContext(e))}}scenery.register("InputFuzzer",InputFuzzer);class DownUpListener extends PhetioObject{constructor(e){assert&&deprecationWarning("DownUpListener is deprecated, please use PressListener instead"),e=merge({mouseButton:0},e),super(e),this.options=e,this.isDown=!1,this.downCurrentTarget=null,this.downTrail=null,this.pointer=null,this.interrupted=!1,this.downListener={up:t=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`DownUpListener (pointer) up for ${this.downTrail.toString()}`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),assert&&assert(t.pointer===this.pointer),(!(t.pointer instanceof Mouse)||t.domEvent.button===this.options.mouseButton)&&this.buttonUp(t),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},interrupt:()=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`DownUpListener (pointer) interrupt for ${this.downTrail.toString()}`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.interrupt(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},cancel:t=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`DownUpListener (pointer) cancel for ${this.downTrail.toString()}`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),assert&&assert(t.pointer===this.pointer),this.buttonUp(t),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}}}buttonDown(e){this.isDown||e.pointer instanceof Mouse&&e.domEvent.button!==this.options.mouseButton||(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DownUpListener buttonDown"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),e.pointer.addInputListener(this.downListener),this.isDown=!0,this.downCurrentTarget=e.currentTarget,this.downTrail=e.trail.subtrailTo(e.currentTarget,!1),this.pointer=e.pointer,this.options.down&&this.options.down(e,this.downTrail),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop())}buttonUp(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DownUpListener buttonUp"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.isDown=!1,this.pointer.removeInputListener(this.downListener);const t=e.currentTarget;if(e.currentTarget=this.downCurrentTarget,this.options.upInside||this.options.upOutside){const r=e.trail.isExtensionOf(this.downTrail,!0)&&!this.interrupted;r&&this.options.upInside?this.options.upInside(e,this.downTrail):!r&&this.options.upOutside&&this.options.upOutside(e,this.downTrail)}this.options.up&&this.options.up(e,this.downTrail),e.currentTarget=t,sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}down(e){this.buttonDown(e)}interrupt(){if(this.isDown){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DownUpListener interrupt"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.interrupted=!0;const e=EventContext.createSynthetic(),t=new SceneryEvent(new Trail,"synthetic",this.pointer,e);t.currentTarget=this.downCurrentTarget,this.buttonUp(t),this.interrupted=!1,sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}}}scenery.register("DownUpListener",DownUpListener);class ButtonListener extends DownUpListener{constructor(e){assert&&deprecationWarning("ButtonListener is deprecated, please use FireListener instead"),e=merge({phetioType:ButtonListener.ButtonListenerIO,phetioState:!1,phetioEventType:EventType.USER},e),super({tandem:e.tandem,phetioType:e.phetioType,phetioState:e.phetioState,mouseButton:e.mouseButton||0,down:(t,n)=>{this.setButtonState(t,"down")},up:(t,n)=>{this.setButtonState(t,this._overCount>0?"over":"up")}}),this.buttonState="up",this._overCount=0,this._buttonOptions=e}setButtonState(e,t){if(t!==this.buttonState){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`ButtonListener state change to ${t} from ${this.buttonState} for ${this.downTrail?this.downTrail.toString():this.downTrail}`);const n=this.buttonState;this.buttonState=t,this._buttonOptions[t]&&(this.phetioStartEvent(t),this._buttonOptions[t](e,n),this.phetioEndEvent()),this._buttonOptions.fire&&this._overCount>0&&!this.interrupted&&(this._buttonOptions.fireOnDown?t==="down":n==="down")&&(this.phetioStartEvent("fire"),this._buttonOptions.fire(e),this.phetioEndEvent())}}enter(e){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`ButtonListener enter for ${this.downTrail?this.downTrail.toString():this.downTrail}`),this._overCount++,this._overCount===1&&this.setButtonState(e,this.isDown?"down":"over")}exit(e){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`ButtonListener exit for ${this.downTrail?this.downTrail.toString():this.downTrail}`),assert&&assert(this._overCount>0,"Exit events not matched by an enter"),this._overCount--,this._overCount===0&&this.setButtonState(e,this.isDown?"out":"up")}focus(e){this.enter(e)}blur(e){this.exit(e)}click(e){this.setButtonState(e,"down"),this.setButtonState(e,"up")}}scenery.register("ButtonListener",ButtonListener);ButtonListener.ButtonListenerIO=new IOType("ButtonListenerIO",{valueType:ButtonListener,documentation:"Button listener",events:["up","over","down","out","fire"]});class SimpleDragHandler extends PhetioObject{constructor(e){assert&&deprecationWarning("SimpleDragHandler is deprecated, please use DragListener instead"),e=merge({start:null,drag:null,end:null,translate:null,allowTouchSnag:!1,mouseButton:0,dragCursor:"pointer",attach:!0,tandem:Tandem.REQUIRED,phetioState:!1,phetioEventType:EventType.USER,phetioReadOnly:!0},e),super(),this.options=e,this.isDraggingProperty=new BooleanProperty(!1,{phetioReadOnly:e.phetioReadOnly,phetioState:!1,tandem:e.tandem.createTandem("isDraggingProperty"),phetioDocumentation:"Indicates whether the object is dragging"}),this.pointer=null,this.trail=null,this.transform=null,this.node=null,this.lastDragPoint=null,this.startTransformMatrix=null,this.mouseButton=void 0,this.interrupted=!1,this.lastInterruptedTouchLikePointer=null,this._attach=e.attach,this.dragStartAction=new PhetioAction$1((t,n)=>{this.dragging||(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("SimpleDragHandler startDrag"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this._attach&&(n.pointer.dragging=!0),n.pointer.cursor=this.options.dragCursor,n.pointer.addInputListener(this.dragListener,this.options.attach),n.pointer.reserveForDrag(),this.isDraggingProperty.set(!0),this.pointer=n.pointer,this.trail=n.trail.subtrailTo(n.currentTarget,!0),this.transform=this.trail.getTransform(),this.node=n.currentTarget,this.lastDragPoint=n.pointer.point,this.startTransformMatrix=n.currentTarget.getMatrix().copy(),this.mouseButton=n.pointer instanceof Mouse?n.domEvent.button:void 0,this.options.start&&this.options.start.call(null,n,this.trail),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop())},{tandem:e.tandem.createTandem("dragStartAction"),phetioReadOnly:e.phetioReadOnly,parameters:[{name:"point",phetioType:Vector2.Vector2IO,phetioDocumentation:"the position of the drag start in view coordinates"},{phetioPrivate:!0,valueType:[SceneryEvent,null]}]}),this.dragAction=new PhetioAction$1((t,n)=>{if(!this.dragging||this.isDisposed)return;const r=this.pointer.point.minus(this.lastDragPoint);if(r.magnitudeSquared===0)return;const s=this.transform.inverseDelta2(r);if(assert&&assert(n.pointer===this.pointer,"Wrong pointer in move"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`SimpleDragHandler (pointer) move for ${this.trail.toString()}`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.options.translate){const a=this.node.getMatrix().getTranslation();this.options.translate.call(null,{delta:s,oldPosition:a,position:a.plus(s)})}if(this.lastDragPoint=this.pointer.point,this.options.drag){const a=n.currentTarget;n.currentTarget=this.node,this.options.drag.call(null,n,this.trail),n.currentTarget=a}sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},{phetioHighFrequency:!0,phetioReadOnly:e.phetioReadOnly,tandem:e.tandem.createTandem("dragAction"),parameters:[{name:"point",phetioType:Vector2.Vector2IO,phetioDocumentation:"the position of the drag in view coordinates"},{phetioPrivate:!0,valueType:[SceneryEvent,null]}]}),this.dragEndAction=new PhetioAction$1((t,n)=>{this.dragging&&(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("SimpleDragHandler endDrag"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this._attach&&(this.pointer.dragging=!1),this.pointer.cursor=null,this.pointer.removeInputListener(this.dragListener),this.isDraggingProperty.set(!1),this.options.end&&this.options.end.call(null,n,this.trail),this.pointer=null,sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop())},{tandem:e.tandem.createTandem("dragEndAction"),phetioReadOnly:e.phetioReadOnly,parameters:[{name:"point",phetioType:Vector2.Vector2IO,phetioDocumentation:"the position of the drag end in view coordinates"},{phetioPrivate:!0,isValidValue:t=>t===null||t instanceof SceneryEvent||t.pointer&&t.currentTarget}]}),this.transformListener={transform:t=>{if(!this.trail.isExtensionOf(t.trail,!0))return;const n=t.trail.getMatrix(),r=this.transform.getMatrix();this.node.prependMatrix(n.inverted().timesMatrix(r)),this.transform.setMatrix(n)}},this.dragListener={up:t=>{if(!(!this.dragging||this.isDisposed)){if(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`SimpleDragHandler (pointer) up for ${this.trail.toString()}`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),assert&&assert(t.pointer===this.pointer,"Wrong pointer in up"),!(t.pointer instanceof Mouse)||t.domEvent.button===this.mouseButton){const n=t.currentTarget;t.currentTarget=this.node,this.endDrag(t),t.currentTarget=n}sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}},cancel:t=>{if(!this.dragging||this.isDisposed)return;sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`SimpleDragHandler (pointer) cancel for ${this.trail.toString()}`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),assert&&assert(t.pointer===this.pointer,"Wrong pointer in cancel");const n=t.currentTarget;t.currentTarget=this.node,this.endDrag(t),t.currentTarget=n,this.transform||this.node.setMatrix(this.startTransformMatrix),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},move:t=>{this.dragAction.execute(t.pointer.point,t)},interrupt:()=>{this.interrupt()}},this.initializePhetioObject({},e)}get dragging(){return this.isDraggingProperty.get()}set dragging(e){assert&&assert(!1,"illegal call to set dragging on SimpleDragHandler")}startDrag(e){this.dragStartAction.execute(e.pointer.point,e)}endDrag(e){this.dragEndAction.execute(e?e.pointer.point:Vector2.ZERO,e)}interrupt(){this.dragging&&(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("SimpleDragHandler interrupt"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.interrupted=!0,this.pointer&&this.pointer.isTouchLike()&&(this.lastInterruptedTouchLikePointer=this.pointer),this.endDrag({pointer:this.pointer,currentTarget:this.node}),this.interrupted=!1,sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop())}tryToSnag(e){e.pointer instanceof Mouse&&e.domEvent&&this.options.mouseButton!==e.domEvent.button&&this.options.mouseButton!==-1||this.isDisposed||!this.dragging&&(!e.pointer.dragging||!this._attach)&&e.pointer!==this.lastInterruptedTouchLikePointer&&e.canStartPress()&&this.startDrag(e)}tryTouchToSnag(e){this.options.allowTouchSnag&&(this.options.allowTouchSnag===!0||this.options.allowTouchSnag(e))&&this.tryToSnag(e)}down(e){this.tryToSnag(e)}touchenter(e){this.tryTouchToSnag(e)}touchmove(e){this.tryTouchToSnag(e)}dispose(){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("SimpleDragHandler dispose"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.dragging&&(this._attach&&(this.pointer.dragging=!1),this.pointer.cursor=null,this.pointer.removeInputListener(this.dragListener)),this.isDraggingProperty.dispose(),this.dragEndAction.dispose(),this.dragAction.dispose(),this.dragStartAction.dispose(),super.dispose(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}static createForwardingListener(e,t){return t=merge({allowTouchSnag:!1},t),{down:n=>{!n.pointer.dragging&&n.canStartPress()&&e(n)},touchenter:function(n){t.allowTouchSnag&&this.down(n)},touchmove:function(n){t.allowTouchSnag&&this.down(n)}}}}scenery.register("SimpleDragHandler",SimpleDragHandler);let globalID=0;const truePredicate=_.constant(!0),isPressedListener$1=o=>o.isPressed,Sn=class Sn extends EnabledComponent{constructor(e){const t=optionize()({press:_.noop,release:_.noop,targetNode:null,drag:_.noop,attach:!0,mouseButton:0,pressCursor:"pointer",useInputListenerCursor:!1,canStartPress:truePredicate,a11yLooksPressedInterval:100,collapseDragEvents:!1,phetioEnabledPropertyInstrumented:!1,tandem:Tandem.REQUIRED,phetioReadOnly:!0,phetioFeatured:PhetioObject.DEFAULT_OPTIONS.phetioFeatured},e);assert&&assert(typeof t.mouseButton=="number"&&t.mouseButton>=0&&t.mouseButton%1===0,"mouseButton should be a non-negative integer"),assert&&assert(t.pressCursor===null||typeof t.pressCursor=="string","pressCursor should either be a string or null"),assert&&assert(typeof t.press=="function","The press callback should be a function"),assert&&assert(typeof t.release=="function","The release callback should be a function"),assert&&assert(typeof t.drag=="function","The drag callback should be a function"),assert&&assert(t.targetNode===null||t.targetNode instanceof Node$2,"If provided, targetNode should be a Node"),assert&&assert(typeof t.attach=="boolean","attach should be a boolean"),assert&&assert(typeof t.a11yLooksPressedInterval=="number","a11yLooksPressedInterval should be a number"),super(t),this._id=globalID++,sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} construction`),this._mouseButton=t.mouseButton,this._a11yLooksPressedInterval=t.a11yLooksPressedInterval,this._pressCursor=t.pressCursor,this._pressListener=t.press,this._releaseListener=t.release,this._dragListener=t.drag,this._canStartPress=t.canStartPress,this._targetNode=t.targetNode,this._attach=t.attach,this._collapseDragEvents=t.collapseDragEvents,this.overPointers=createObservableArray(),this.isPressedProperty=new BooleanProperty(!1,{reentrant:!0}),this.isOverProperty=new BooleanProperty(!1),this.looksOverProperty=new BooleanProperty(!1),this.isHoveringProperty=new BooleanProperty(!1),this.isHighlightedProperty=new BooleanProperty(!1),this.isFocusedProperty=new BooleanProperty(!1),this.cursorProperty=new DerivedProperty([this.enabledProperty],n=>t.useInputListenerCursor&&n&&this._attach?this._pressCursor:null),this.pointer=null,this.pressedTrail=null,this.interrupted=!1,this._pendingCollapsedDragEvent=null,this._listeningToPointer=!1,this._isHoveringListener=this.invalidateHovering.bind(this),this._isHighlightedListener=this.invalidateHighlighted.bind(this),this.pdomClickingProperty=new BooleanProperty(!1),this.looksPressedProperty=DerivedProperty.or([this.pdomClickingProperty,this.isPressedProperty]),this._pdomClickingTimeoutListener=null,this._pointerListener={up:this.pointerUp.bind(this),cancel:this.pointerCancel.bind(this),move:this.pointerMove.bind(this),interrupt:this.pointerInterrupt.bind(this),listener:this},this._pressAction=new PhetioAction$1(this.onPress.bind(this),{tandem:t.tandem.createTandem("pressAction"),phetioDocumentation:"Executes whenever a press occurs. The first argument when executing can be used to convey info about the SceneryEvent.",phetioReadOnly:!0,phetioFeatured:t.phetioFeatured,phetioEventType:EventType.USER,parameters:[{name:"event",phetioType:SceneryEvent.SceneryEventIO},{phetioPrivate:!0,valueType:[Node$2,null]},{phetioPrivate:!0,valueType:["function",null]}]}),this._releaseAction=new PhetioAction$1(this.onRelease.bind(this),{parameters:[{name:"event",phetioType:NullableIO(SceneryEvent.SceneryEventIO)},{phetioPrivate:!0,valueType:["function",null]}],tandem:t.tandem.createTandem("releaseAction"),phetioDocumentation:"Executes whenever a release occurs.",phetioReadOnly:!0,phetioFeatured:t.phetioFeatured,phetioEventType:EventType.USER}),this.display=null,this.boundInvalidateOverListener=this.invalidateOver.bind(this),this.overPointers.lengthProperty.link(this.invalidateOver.bind(this)),this.isFocusedProperty.link(this.invalidateOver.bind(this)),this.overPointers.lengthProperty.link(this._isHoveringListener),this.isPressedProperty.link(this._isHoveringListener),this.overPointers.addItemAddedListener(n=>n.isDownProperty.link(this._isHoveringListener)),this.overPointers.addItemRemovedListener(n=>n.isDownProperty.unlink(this._isHoveringListener)),this.isHoveringProperty.link(this._isHighlightedListener),this.isPressedProperty.link(this._isHighlightedListener),this.enabledProperty.lazyLink(this.onEnabledPropertyChange.bind(this))}get isPressed(){return this.isPressedProperty.value}get cursor(){return this.cursorProperty.value}get attach(){return this._attach}get targetNode(){return this._targetNode}getCurrentTarget(){return assert&&assert(this.isPressed,"We have no currentTarget if we are not pressed"),this.pressedTrail.lastNode()}get currentTarget(){return this.getCurrentTarget()}canPress(e){return!!this.enabledProperty.value&&!this.isPressed&&this._canStartPress(e,this)&&(!(e.pointer instanceof Mouse)||e.domEvent.button===this._mouseButton)&&(!this._attach||!e.pointer.isAttached())}canClick(){return this.enabledProperty.value&&!this.isPressed&&this._canStartPress(null,this)}press(e,t,n){return assert&&assert(e,"An event is required"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} press`),this.canPress(e)?(this.flushCollapsedDrag(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} successful press`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this._pressAction.execute(e,t||null,n||null),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop(),!0):(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} could not press`),!1)}release(e,t){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} release`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.flushCollapsedDrag(),this._releaseAction.execute(e||null,t||null),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}drag(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} drag`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),assert&&assert(this.isPressed,"Can only drag while pressed"),this._dragListener(e,this),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}interrupt(){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} interrupt`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.pdomClickingProperty.value?(this.interrupted=!0,this._listeningToPointer?this.release():(this.isPressedProperty.value=!1,this._releaseListener(null,this)),stepTimer.hasListener(this._pdomClickingTimeoutListener)&&(stepTimer.clearTimeout(this._pdomClickingTimeoutListener),this.pdomClickingProperty.isDisposed||(this.pdomClickingProperty.value=!1))):this.isPressed&&(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} interrupting`),this.interrupted=!0,this.release()),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}clearOverPointers(){this.overPointers.clear()}step(){this.flushCollapsedDrag()}setCreatePanTargetBounds(e){this._pointerListener.createPanTargetBounds=e}set createPanTargetBounds(e){this.setCreatePanTargetBounds(e)}setCreatePanTargetBoundsFromTrail(e){assert&&assert(e.length>0,"trail has no Nodes to provide localBounds"),this.setCreatePanTargetBounds(()=>e.localToGlobalBounds(e.lastNode().localBounds))}set createPanTargetBoundsFromTrail(e){this.setCreatePanTargetBoundsFromTrail(e)}flushCollapsedDrag(){this._pendingCollapsedDragEvent&&this.drag(this._pendingCollapsedDragEvent),this._pendingCollapsedDragEvent=null}invalidateOver(){let e=!1;if(this._listeningToPointer)e=!1;else for(let t=0;t<this.overPointers.length;t++)if(this.overPointers.get(t).isAttached()){e=!0;break}this.isOverProperty.value=this.overPointers.length>0&&!e,this.looksOverProperty.value=this.isOverProperty.value||this.isFocusedProperty.value&&!!this.display&&this.display.focusManager.pdomFocusHighlightsVisibleProperty.value}invalidateHovering(){for(let e=0;e<this.overPointers.length;e++){const t=this.overPointers[e];if(!t.isDown||t===this.pointer){this.isHoveringProperty.value=!0;return}}this.isHoveringProperty.value=!1}invalidateHighlighted(){this.isHighlightedProperty.value=this.isHoveringProperty.value||this.isPressedProperty.value}onEnabledPropertyChange(e){!e&&this.interrupt()}onPress(e,t,n){assert&&assert(!this.isDisposed,"Should not press on a disposed listener");const r=t||this._targetNode;this.pointer=e.pointer,this.pressedTrail=r?r.getUniqueTrail():e.trail.subtrailTo(e.currentTarget,!1),this.interrupted=!1,this.pointer.addInputListener(this._pointerListener,this._attach),this._listeningToPointer=!0,this.pointer.cursor=this.pressedTrail.lastNode().getEffectiveCursor()||this._pressCursor,this.isPressedProperty.value=!0,this._pressListener(e,this),n&&n()}onRelease(e,t){assert&&assert(this.isPressed,"This listener is not pressed");const n=this;n.pointer.removeInputListener(this._pointerListener),this._listeningToPointer=!1,this.isPressedProperty.value=!1,this._releaseListener(e,this),t&&t(),n.pointer.cursor=null,this.pointer=null,this.pressedTrail=null}down(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} down`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.press(e),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}up(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} up`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.invalidateOver(),this.invalidateHovering(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}enter(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} enter`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.overPointers.push(e.pointer),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}move(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} move`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.invalidateOver(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}exit(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} exit`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.overPointers.includes(e.pointer)&&this.overPointers.remove(e.pointer),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}pointerUp(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} pointer up`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.isPressed&&(assert&&assert(e.pointer===this.pointer),this.release(e)),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}pointerCancel(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} pointer cancel`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.isPressed&&(assert&&assert(e.pointer===this.pointer),this.interrupt()),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}pointerMove(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} pointer move`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.isPressed&&(assert&&assert(e.pointer===this.pointer),this._collapseDragEvents?this._pendingCollapsedDragEvent=e:this.drag(e)),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}pointerInterrupt(){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} pointer interrupt`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.interrupt(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}click(e,t){return this.canClick()&&(this.interrupted=!1,this.pdomClickingProperty.value=!0,this.isFocusedProperty.value=!0,this.isPressedProperty.value=!0,this._pressListener(e,this),t&&t(),this.isPressedProperty.value=!1,this._releaseListener(e,this),stepTimer.clearTimeout(this._pdomClickingTimeoutListener),this._pdomClickingTimeoutListener=stepTimer.setTimeout(()=>{this.pdomClickingProperty.isDisposed||(this.pdomClickingProperty.value=!1)},this._a11yLooksPressedInterval)),!0}focus(e){const t=e.trail.rootNode().getRootedDisplays().filter(n=>n.isAccessible());assert&&assert(t.length===1,"cannot focus node with zero or multiple accessible displays attached"),this.display=t[0],this.display.focusManager.pdomFocusHighlightsVisibleProperty.hasListener(this.boundInvalidateOverListener)||this.display.focusManager.pdomFocusHighlightsVisibleProperty.link(this.boundInvalidateOverListener),this.isFocusedProperty.value=!0}blur(){this.display&&(this.display.focusManager.pdomFocusHighlightsVisibleProperty.hasListener(this.boundInvalidateOverListener)&&this.display.focusManager.pdomFocusHighlightsVisibleProperty.unlink(this.boundInvalidateOverListener),this.display=null),this.isFocusedProperty.value=!1}dispose(){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} dispose`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.overPointers.clear(),this._listeningToPointer&&isPressedListener$1(this)&&this.pointer.removeInputListener(this._pointerListener),this.isPressedProperty.isDisposed||(this.isPressedProperty.unlink(this._isHighlightedListener),this.isPressedProperty.unlink(this._isHoveringListener)),!this.isHoveringProperty.isDisposed&&this.isHoveringProperty.unlink(this._isHighlightedListener),this._pressAction.dispose(),this._releaseAction.dispose(),this.looksPressedProperty.dispose(),this.pdomClickingProperty.dispose(),this.cursorProperty.dispose(),this.isFocusedProperty.dispose(),this.isHighlightedProperty.dispose(),this.isHoveringProperty.dispose(),this.looksOverProperty.dispose(),this.isOverProperty.dispose(),this.isPressedProperty.dispose(),this.overPointers.dispose(),this.display&&(this.display.focusManager.pdomFocusHighlightsVisibleProperty.unlink(this.boundInvalidateOverListener),this.display=null),super.dispose(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}};Sn.phetioAPI={pressAction:{phetioType:PhetioAction$1.PhetioActionIO([SceneryEvent.SceneryEventIO])},releaseAction:{phetioType:PhetioAction$1.PhetioActionIO([NullableIO(SceneryEvent.SceneryEventIO)])}};let PressListener=Sn;scenery.register("PressListener",PressListener);class FireListener extends PressListener{constructor(e){const t=optionize()({fire:_.noop,fireOnDown:!1,fireOnHold:!1,fireOnHoldDelay:400,fireOnHoldInterval:100,tandem:Tandem.REQUIRED,phetioReadOnly:PhetioObject.DEFAULT_OPTIONS.phetioReadOnly},e);assert&&assert(typeof t.fire=="function","The fire callback should be a function"),assert&&assert(typeof t.fireOnDown=="boolean","fireOnDown should be a boolean"),super(t),this._fireOnDown=t.fireOnDown,this.firedEmitter=new Emitter({tandem:t.tandem.createTandem("firedEmitter"),phetioEventType:EventType.USER,phetioReadOnly:t.phetioReadOnly,phetioDocumentation:"Emits at the time that the listener fires",parameters:[{name:"event",phetioType:NullableIO(SceneryEvent.SceneryEventIO)}]}),this.firedEmitter.addListener(t.fire),t.fireOnHold&&(this._timer=new CallbackTimer({callback:this.fire.bind(this,null),delay:t.fireOnHoldDelay,interval:t.fireOnHoldInterval}))}fire(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("FireListener fire"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.firedEmitter.emit(e),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}press(e,t,n){return super.press(e,t,()=>{this._fireOnDown&&this.fire(e),this._timer&&this._timer.start(),n&&n()})}release(e,t){super.release(e,()=>{const n=!this._fireOnDown&&this.isHoveringProperty.value&&!this.interrupted;this._timer?this._timer.stop(n):n&&this.fire(e||null),t&&t()})}click(e,t){return super.click(e,()=>{this.interrupted||this.fire(e),t&&t()})}interrupt(){super.interrupt(),this._timer&&this._timer.stop(!1)}dispose(){this.firedEmitter.dispose(),this._timer&&this._timer.dispose(),super.dispose()}}scenery.register("FireListener",FireListener);const scratchVector2A=new Vector2(0,0),isPressedListener=o=>o.isPressed;class DragListener extends PressListener{constructor(e){const t=optionize()({positionProperty:null,start:null,end:null,transform:null,dragBoundsProperty:null,allowTouchSnag:!0,applyOffset:!0,useParentOffset:!1,trackAncestors:!1,translateNode:!1,mapPosition:null,offsetPosition:null,canClick:!1,tandem:Tandem.REQUIRED,phetioReadOnly:!0,phetioFeatured:PhetioObject.DEFAULT_OPTIONS.phetioFeatured},e);assert&&assert(!t.dragBounds,"options.dragBounds was removed in favor of options.dragBoundsProperty"),assert&&assert(!t.useParentOffset||t.positionProperty,"If useParentOffset is set, a positionProperty is required"),assert&&assert(!(t.mapPosition&&t.dragBoundsProperty),"Only one of mapPosition and dragBoundsProperty can be provided, as they handle mapping of the drag point"),super(t),this._allowTouchSnag=t.allowTouchSnag,this._applyOffset=t.applyOffset,this._useParentOffset=t.useParentOffset,this._trackAncestors=t.trackAncestors,this._translateNode=t.translateNode,this._transform=t.transform,this._positionProperty=t.positionProperty,this._mapPosition=t.mapPosition,this._offsetPosition=t.offsetPosition,this._dragBoundsProperty=t.dragBoundsProperty||new Property(null),this._start=t.start,this._end=t.end,this._canClick=t.canClick,this.isUserControlledProperty=this.isPressedProperty,this._globalPoint=new Vector2(0,0),this._localPoint=new Vector2(0,0),this._parentPoint=new Vector2(0,0),this._modelPoint=new Vector2(0,0),this._modelDelta=new Vector2(0,0),this._parentOffset=new Vector2(0,0),this._transformTracker=null,this._transformTrackerListener=this.ancestorTransformed.bind(this),this._lastInterruptedTouchLikePointer=null,this._dragAction=new PhetioAction$1(n=>{assert&&assert(isPressedListener(this));const s=this.pointer.point;s&&(this._globalPoint.equals(s)||this.reposition(s)),PressListener.prototype.drag.call(this,n)},{parameters:[{name:"event",phetioType:SceneryEvent.SceneryEventIO}],phetioFeatured:t.phetioFeatured,tandem:t.tandem.createTandem("dragAction"),phetioHighFrequency:!0,phetioDocumentation:"Emits whenever a drag occurs with an SceneryEventIO argument.",phetioReadOnly:t.phetioReadOnly,phetioEventType:EventType.USER})}press(e,t,n){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener press"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const r=super.press(e,t,()=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener successful press"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),assert&&assert(isPressedListener(this));const s=this;s.pointer.reserveForDrag(),this.attachTransformTracker(),assert&&assert(s.pointer.point!==null);const a=s.pointer.point,h=this.globalToParentPoint(this._localPoint.set(a));this._useParentOffset&&this.modelToParentPoint(this._parentOffset.set(this._positionProperty.value)).subtract(h),this.parentToLocalPoint(h),this.reposition(a),this._start&&this._start(e,s),n&&n(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()});return sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop(),r}release(e,t){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener release"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),super.release(e,()=>{this.detachTransformTracker(),this._end&&this._end(e||null,this),t&&t()}),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}canClick(){return super.canClick()&&this._canClick}click(e,t){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener click"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const n=super.click(e,()=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener successful press"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this._start&&this._start(e,this),t&&t(),this._end&&this._end(e,this),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()});return sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop(),n}drag(e){assert&&assert(isPressedListener(this));const n=this.pointer.point;!n||this._globalPoint.equals(n)||(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener drag"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this._dragAction.execute(e),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop())}tryTouchSnag(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener tryTouchSnag"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this._allowTouchSnag&&(!this.attach||!e.pointer.isAttached())&&this.press(e),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}getGlobalPoint(){return this._globalPoint.copy()}get globalPoint(){return this.getGlobalPoint()}getLocalPoint(){return this._localPoint.copy()}get localPoint(){return this.getLocalPoint()}getParentPoint(){return this._parentPoint.copy()}get parentPoint(){return this.getParentPoint()}getModelPoint(){return this._modelPoint.copy()}get modelPoint(){return this.getModelPoint()}getModelDelta(){return this._modelDelta.copy()}get modelDelta(){return this.getModelDelta()}globalToParentPoint(e){assert&&assert(isPressedListener(this));const t=this;let n;return assert&&(n=t.pressedTrail.globalToParentPoint(e)),t.pressedTrail.getParentTransform().getInverse().multiplyVector2(e),assert&&assert(e.equals(n)),e}parentToLocalPoint(e){assert&&assert(isPressedListener(this));const t=this;let n;return assert&&(n=t.pressedTrail.lastNode().parentToLocalPoint(e)),t.pressedTrail.lastNode().getTransform().getInverse().multiplyVector2(e),assert&&assert(e.equals(n)),e}localToParentPoint(e){assert&&assert(isPressedListener(this));const t=this;let n;return assert&&(n=t.pressedTrail.lastNode().localToParentPoint(e)),t.pressedTrail.lastNode().getMatrix().multiplyVector2(e),assert&&assert(e.equals(n)),e}parentToModelPoint(e){return this._transform&&(this._transform instanceof Transform3?this._transform:this._transform.value).getInverse().multiplyVector2(e),e}modelToParentPoint(e){return this._transform&&(this._transform instanceof Transform3?this._transform:this._transform.value).getMatrix().multiplyVector2(e),e}mapModelPoint(e){return this._mapPosition?this._mapPosition(e):this._dragBoundsProperty.value?this._dragBoundsProperty.value.closestPointTo(e):e}applyParentOffset(e){this._offsetPosition&&e.add(this._offsetPosition(e,this)),this._applyOffset&&(this._useParentOffset?e.add(this._parentOffset):(e.subtract(this.localToParentPoint(scratchVector2A.set(this._localPoint))),e.add(this.localToParentPoint(scratchVector2A.setXY(0,0)))))}reposition(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener reposition"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),assert&&assert(isPressedListener(this));const t=this;this._globalPoint.set(e),this.applyParentOffset(this.globalToParentPoint(this._parentPoint.set(e))),this._modelDelta.set(this._modelPoint).negate(),this._modelPoint.set(this.mapModelPoint(this.parentToModelPoint(scratchVector2A.set(this._parentPoint)))),this._modelDelta.add(this._modelPoint),this.modelToParentPoint(this._parentPoint.set(this._modelPoint)),this._translateNode&&(t.pressedTrail.lastNode().translation=this._parentPoint),this._positionProperty&&(this._positionProperty.value=this._modelPoint.copy()),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}touchenter(e){e.pointer.isDownProperty.value&&this.tryTouchSnag(e)}touchmove(e){this.tryTouchSnag(e)}ancestorTransformed(){assert&&assert(isPressedListener(this));const t=this.pointer.point;t&&this.reposition(t)}attachTransformTracker(){assert&&assert(isPressedListener(this));const e=this;this._trackAncestors&&(this._transformTracker=new TransformTracker$1(e.pressedTrail.copy().removeDescendant()),this._transformTracker.addListener(this._transformTrackerListener))}detachTransformTracker(){this._transformTracker&&(this._transformTracker.removeListener(this._transformTrackerListener),this._transformTracker.dispose(),this._transformTracker=null)}getDragBounds(){return this._dragBoundsProperty.value}get dragBounds(){return this.getDragBounds()}setTransform(e){this._transform=e}set transform(e){this.setTransform(e)}get transform(){return this.getTransform()}getTransform(){return this._transform}interrupt(){this.pointer&&this.pointer.isTouchLike()&&(this._lastInterruptedTouchLikePointer=this.pointer),super.interrupt()}canPress(e){return e.pointer===this._lastInterruptedTouchLikePointer?!1:super.canPress(e)}dispose(){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener dispose"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this._dragAction.dispose(),this.detachTransformTracker(),super.dispose(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}static createForwardingListener(e,t){const n=optionize()({allowTouchSnag:!0},t);return{down(r){r.canStartPress()&&e(r)},touchenter(r){n.allowTouchSnag&&this.down(r)},touchmove(r){n.allowTouchSnag&&this.down(r)}}}}scenery.register("DragListener",DragListener);class MultiListenerPress{constructor(e,t){this.pointer=e,this.trail=t,this.interrupted=!1,this.initialPoint=e.point,this.localPoint=null,this.recomputeLocalPoint()}recomputeLocalPoint(){this.localPoint=this.trail.globalToLocalPoint(this.pointer.point)}get targetPoint(){return this.trail.globalToParentPoint(this.pointer.point)}}scenery.register("MultiListenerPress",MultiListenerPress);const MOVE_INTERRUPT_MAGNITUDE=25;class MultiListener{constructor(e,t){const n=optionize()({mouseButton:0,pressCursor:"pointer",allowScale:!0,allowRotation:!0,allowMultitouchInterruption:!1,allowMoveInterruption:!0,minScale:1,maxScale:4,tandem:Tandem.REQUIRED},t);this._targetNode=e,this._minScale=n.minScale,this._maxScale=n.maxScale,this._mouseButton=n.mouseButton,this._pressCursor=n.pressCursor,this._allowScale=n.allowScale,this._allowRotation=n.allowRotation,this._allowMultitouchInterruption=n.allowMultitouchInterruption,this._allowMoveInterruption=n.allowMoveInterruption,this._presses=[],this._backgroundPresses=[],this.matrixProperty=new Property(e.matrix.copy(),{phetioValueType:Matrix3.Matrix3IO,tandem:n.tandem.createTandem("matrixProperty"),phetioReadOnly:!0}),this.matrixProperty.link(r=>{this._targetNode.matrix=r}),this._interrupted=!1,this._pressListener={move:r=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener pointer move"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const s=this.findPress(r.pointer);assert&&assert(s,"Press should be found for move event"),this.movePress(s),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},up:r=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener pointer up"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const s=this.findPress(r.pointer);assert&&assert(s,"Press should be found for up event"),this.removePress(s),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},cancel:r=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener pointer cancel"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const s=this.findPress(r.pointer);assert&&assert(s,"Press should be found for cancel event"),s.interrupted=!0,this.removePress(s),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},interrupt:()=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener pointer interrupt"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.interrupt(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}},this._backgroundListener={up:r=>{if(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener background up"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),!this._interrupted){const s=this.findBackgroundPress(r.pointer);assert&&assert(s,"Background press should be found for up event"),this.removeBackgroundPress(s)}sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},move:r=>{const s=this._backgroundPresses.filter(a=>!a.pointer.hasIntent(Intent.DRAG)&&a.initialPoint.distance(a.pointer.point)>MOVE_INTERRUPT_MAGNITUDE);(this.getCurrentScale()!==1||s.length>=2)&&(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener attached, interrupting for press"),s.forEach(a=>{this.removeBackgroundPress(a),this.interruptOtherListeners(a.pointer),this.addPress(a)}))},cancel:r=>{if(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener background cancel"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),!this._interrupted){const s=this.findBackgroundPress(r.pointer);assert&&assert(s,"Background press should be found for cancel event"),this.removeBackgroundPress(s)}sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},interrupt:()=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener background interrupt"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.interrupt(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}}}findPress(e){for(let t=0;t<this._presses.length;t++)if(this._presses[t].pointer===e)return this._presses[t];return null}findBackgroundPress(e){for(let t=0;t<this._backgroundPresses.length;t++)if(this._backgroundPresses[t].pointer===e)return this._backgroundPresses[t];return null}hasPress(e){return _.some(this._presses.concat(this._backgroundPresses),t=>t.pointer===e.pointer)}interruptOtherListeners(e){const t=e.getListeners();for(let n=0;n<t.length;n++){const r=t[n];r!==this._backgroundListener&&r.interrupt&&r.interrupt()}}down(e){if(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener down"),e.pointer instanceof Mouse&&e.domEvent instanceof MouseEvent&&e.domEvent.button!==this._mouseButton){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener abort: wrong mouse button");return}this._interrupted=!1;let t;_.includes(e.trail.nodes,this._targetNode)?t=e.trail.subtrailTo(this._targetNode,!1):t=this._targetNode.getUniqueTrailTo(e.target),assert&&assert(_.includes(t.nodes,this._targetNode),"targetNode must be in the Trail for Press"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const n=new MultiListenerPress(e.pointer,t);!this._allowMoveInterruption&&!this._allowMultitouchInterruption?e.pointer.isAttached()||(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener unattached, using press"),this.addPress(n)):(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener attached, adding background press"),this.addBackgroundPress(n)),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}addPress(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener addPress"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.hasPress(e)||(this._presses.push(e),e.pointer.cursor=this._pressCursor,e.pointer.addInputListener(this._pressListener,!0),this.recomputeLocals(),this.reposition()),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}movePress(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener movePress"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.reposition(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}removePress(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener removePress"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),e.pointer.removeInputListener(this._pressListener),e.pointer.cursor=null,arrayRemove(this._presses,e),this.recomputeLocals(),this.reposition(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}addBackgroundPress(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener addBackgroundPress"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.hasPress(e)||(this._backgroundPresses.push(e),e.pointer.addInputListener(this._backgroundListener,!1)),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}removeBackgroundPress(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener removeBackgroundPress"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),e.pointer.removeInputListener(this._backgroundListener),arrayRemove(this._backgroundPresses,e),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}reposition(){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener reposition"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.matrixProperty.set(this.computeMatrix()),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}recomputeLocals(){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener recomputeLocals"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();for(let e=0;e<this._presses.length;e++)this._presses[e].recomputeLocalPoint();sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}interrupt(){for(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener interrupt"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();this._presses.length;)this.removePress(this._presses[this._presses.length-1]);for(;this._backgroundPresses.length;)this.removeBackgroundPress(this._backgroundPresses[this._backgroundPresses.length-1]);this._interrupted=!0,sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}computeMatrix(){return this._presses.length===0?this._targetNode.getMatrix():this._presses.length===1?this.computeSinglePressMatrix():this._allowScale&&this._allowRotation?this.computeTranslationRotationScaleMatrix():this._allowScale?this.computeTranslationScaleMatrix():this._allowRotation?this.computeTranslationRotationMatrix():this.computeTranslationMatrix()}computeSinglePressMatrix(){const e=this._presses[0].targetPoint,t=this._presses[0].localPoint;assert&&assert(t,"localPoint is not defined on the Press?");const n=this._targetNode.localToParentPoint(t),r=e.minus(n);return Matrix3.translationFromVector(r).timesMatrix(this._targetNode.getMatrix())}computeTranslationMatrix(){const e=new Vector2(0,0);for(let t=0;t<this._presses.length;t++){e.add(this._presses[t].targetPoint);const n=this._presses[t].localPoint;assert&&assert(n,"localPoint is not defined on the Press?"),e.subtract(n)}return Matrix3.translationFromVector(e.dividedScalar(this._presses.length))}computeTranslationScaleMatrix(){const e=this._presses.map(y=>(assert&&assert(y.localPoint,"localPoint is not defined on the Press?"),y.localPoint)),t=this._presses.map(y=>y.targetPoint),n=new Vector2(0,0),r=new Vector2(0,0);e.forEach(y=>{n.add(y)}),t.forEach(y=>{r.add(y)}),n.divideScalar(this._presses.length),r.divideScalar(this._presses.length);let s=0,a=0;e.forEach(y=>{s+=y.distanceSquared(n)}),t.forEach(y=>{a+=y.distanceSquared(r)});let h=this.getCurrentScale();a!==0&&(h=this.limitScale(Math.sqrt(a/s)));const c=Matrix3.translation(r.x,r.y),d=Matrix3.translation(-n.x,-n.y);return c.timesMatrix(Matrix3.scaling(h)).timesMatrix(d)}limitScale(e){let t=Math.max(e,this._minScale);return t=Math.min(t,this._maxScale),t}computeTranslationRotationMatrix(){let e;const t=new Matrix(2,this._presses.length),n=new Matrix(2,this._presses.length),r=new Vector2(0,0),s=new Vector2(0,0);for(e=0;e<this._presses.length;e++){const g=this._presses[e].localPoint,D=this._presses[e].targetPoint;r.add(g),s.add(D),t.set(0,e,g.x),t.set(1,e,g.y),n.set(0,e,D.x),n.set(1,e,D.y)}for(r.divideScalar(this._presses.length),s.divideScalar(this._presses.length),e=0;e<this._presses.length;e++)t.set(0,e,t.get(0,e)-r.x),t.set(1,e,t.get(1,e)-r.y),n.set(0,e,n.get(0,e)-s.x),n.set(1,e,n.get(1,e)-s.y);const a=t.times(n.transpose()),h=new SingularValueDecomposition(a);let c=h.getV().times(h.getU().transpose());c.det()<0&&(c=h.getV().times(Matrix.diagonalMatrix([1,-1])).times(h.getU().transpose()));const d=new Matrix3().rowMajor(c.get(0,0),c.get(0,1),0,c.get(1,0),c.get(1,1),0,0,0,1),y=s.minus(d.timesVector2(r));return d.set02(y.x),d.set12(y.y),d}computeTranslationRotationScaleMatrix(){let e;const t=new Matrix(this._presses.length*2,4);for(e=0;e<this._presses.length;e++){const d=this._presses[e].localPoint;t.set(2*e+0,0,d.x),t.set(2*e+0,1,d.y),t.set(2*e+0,2,1),t.set(2*e+1,0,d.y),t.set(2*e+1,1,-d.x),t.set(2*e+1,3,1)}const n=new Matrix(this._presses.length*2,1);for(e=0;e<this._presses.length;e++){const d=this._presses[e].targetPoint;n.set(2*e+0,0,d.x),n.set(2*e+1,0,d.y)}const r=SingularValueDecomposition.pseudoinverse(t).times(n),s=r.get(0,0),a=r.get(1,0),h=r.get(2,0),c=r.get(3,0);return new Matrix3().rowMajor(s,a,h,-a,s,c,0,0,1)}getCurrentScale(){return this._targetNode.getScaleVector().x}resetTransform(){this._targetNode.resetTransform(),this.matrixProperty.set(this._targetNode.matrix.copy())}}scenery.register("MultiListener",MultiListener);class ModelViewTransform2 extends Transform3{modelToViewPosition(e){return this.transformPosition2(e)}modelToViewXY(e,t){return new Vector2(this.modelToViewX(e),this.modelToViewY(t))}modelToViewX(e){return this.matrix.m00()*e+this.matrix.m02()}modelToViewY(e){return this.matrix.m11()*e+this.matrix.m12()}modelToViewDelta(e){return this.transformDelta2(e)}modelToViewNormal(e){return this.transformNormal2(e)}modelToViewDeltaX(e){return this.transformDeltaX(e)}modelToViewDeltaY(e){return this.transformDeltaY(e)}modelToViewBounds(e){return this.transformBounds2(e)}modelToViewShape(e){return this.transformShape(e)}modelToViewRay(e){return this.transformRay2(e)}viewToModelPosition(e){return this.inversePosition2(e)}viewToModelXY(e,t){return new Vector2(this.viewToModelX(e),this.viewToModelY(t))}viewToModelX(e){const t=this.getInverse();return t.m00()*e+t.m02()}viewToModelY(e){const t=this.getInverse();return t.m11()*e+t.m12()}viewToModelDelta(e){return this.inverseDelta2(e)}viewToModelDeltaXY(e,t){return new Vector2(this.viewToModelDeltaX(e),this.viewToModelDeltaY(t))}viewToModelNormal(e){return this.inverseNormal2(e)}viewToModelDeltaX(e){return this.inverseDeltaX(e)}viewToModelDeltaY(e){return this.inverseDeltaY(e)}viewToModelBounds(e){return this.inverseBounds2(e)}viewToModelShape(e){return this.inverseShape(e)}viewToModelRay(e){return this.inverseRay2(e)}validateMatrix(e){super.validateMatrix(e),assert&&assert(e.isAligned(),"matrix must be aligned, ModelViewTransform2 does not support arbitrary rotations")}setToRectangleMapping(e,t){const n=t.width/e.width,r=t.x-n*e.x,s=t.height/e.height,a=t.y-s*e.y;return this.setMatrix(Matrix3.affine(n,0,r,0,s,a)),this}setToRectangleInvertedYMapping(e,t){const n=t.width/e.width,r=t.x-n*e.x,s=-t.height/e.height,a=t.y-s*e.getMaxY();return this.setMatrix(Matrix3.affine(n,0,r,0,s,a)),this}static createIdentity(){return new ModelViewTransform2(Matrix3.IDENTITY)}static createOffsetScaleMapping(e,t){return new ModelViewTransform2(Matrix3.affine(t,0,e.x,0,t,e.y))}static createOffsetXYScaleMapping(e,t,n){return new ModelViewTransform2(Matrix3.affine(t,0,e.x,0,n,e.y))}static createSinglePointXYScaleMapping(e,t,n,r){const s=t.x-e.x*n,a=t.y-e.y*r;return ModelViewTransform2.createOffsetXYScaleMapping(new Vector2(s,a),n,r)}static createSinglePointScaleMapping(e,t,n){return ModelViewTransform2.createSinglePointXYScaleMapping(e,t,n,n)}static createSinglePointScaleInvertedYMapping(e,t,n){return ModelViewTransform2.createSinglePointXYScaleMapping(e,t,n,-n)}static createRectangleMapping(e,t){return new ModelViewTransform2().setToRectangleMapping(e,t)}static createRectangleInvertedYMapping(e,t){return new ModelViewTransform2().setToRectangleInvertedYMapping(e,t)}}phetcommon.register("ModelViewTransform2",ModelViewTransform2);const SCRATCH_MATRIX=new Matrix3;class PanZoomListener extends MultiListener{constructor(e,t){var r;const n=optionize()({panBounds:Bounds2.NOTHING,targetBounds:null,targetScale:1,allowRotation:!1},t);super(e,n),this._panBounds=n.panBounds,this._targetBounds=n.targetBounds||e.globalBounds.copy(),this._targetScale=n.targetScale,this.sourceFramePanBoundsProperty=new Property(Tandem.API_GENERATION?new Bounds2(0,0,0,0):this._panBounds,{tandem:(r=n.tandem)==null?void 0:r.createTandem("sourceFramePanBoundsProperty"),phetioReadOnly:!0,phetioValueType:Bounds2.Bounds2IO}),this.sourceFramePanBoundsProperty.lazyLink(()=>{if(isSettingPhetioStateProperty.value){const s=ModelViewTransform2.createRectangleMapping(this.sourceFramePanBoundsProperty.get(),this._panBounds),a=this._targetNode.matrix.translation.componentMultiply(s.matrix.getScaleVector()),h=this.matrixProperty.get().getScaleVector();this.matrixProperty.set(Matrix3.translationFromVector(a).timesMatrix(Matrix3.scaling(h.x,h.y)))}},{phetioDependencies:[this.matrixProperty]})}correctReposition(){SCRATCH_MATRIX.set(this._targetNode.matrix);const e=this._targetBounds.transformed(this._targetNode.getMatrix());e.left>this._panBounds.left&&(this._targetNode.left=this._panBounds.left-(e.left-this._targetNode.left)),e.top>this._panBounds.top&&(this._targetNode.top=this._panBounds.top-(e.top-this._targetNode.top)),e.right<this._panBounds.right&&(this._targetNode.right=this._panBounds.right+(this._targetNode.right-e.right)),e.bottom<this._panBounds.bottom&&(this._targetNode.bottom=this._panBounds.bottom+(this._targetNode.bottom-e.bottom)),SCRATCH_MATRIX.equals(this._targetNode.matrix)||this.matrixProperty.set(this._targetNode.matrix.copy())}addPress(e){super.addPress(e);const n=this._targetBounds.transformed(this._targetNode.getMatrix()).equalsEpsilon(this._panBounds,1e-8);e.pointer.cursor=n?null:this._pressCursor}reposition(){super.reposition(),this.correctReposition()}resetTransform(){super.resetTransform(),this.correctReposition()}setPanBounds(e){this._panBounds=e,Tandem.API_GENERATION||this.sourceFramePanBoundsProperty.set(this._panBounds),this.correctReposition()}setTargetBounds(e){this._targetBounds=e,this.correctReposition()}setTargetScale(e){this._targetScale=e}getTargetBounds(){return this._targetBounds}}scenery.register("PanZoomListener",PanZoomListener);const MOVE_CURSOR="all-scroll",MAX_SCROLL_VELOCITY=150,MAX_TRANSLATION_SPEED=1e3,scratchTranslationVector=new Vector2(0,0),scratchScaleTargetVector=new Vector2(0,0),scratchVelocityVector=new Vector2(0,0),scratchBounds=new Bounds2(0,0,0,0);class AnimatedPanZoomListener extends PanZoomListener{constructor(e,t){const n=optionize()({tandem:Tandem.REQUIRED},t);super(e,n),this.trackpadGestureStartScale=1,this.animatingProperty=new BooleanProperty(!1),this._transformTracker=null,this._focusBoundsListener=null,this.sourcePosition=null,this.destinationPosition=null,this.sourceScale=this.getCurrentScale(),this.destinationScale=this.getCurrentScale(),this.scaleGestureTargetPosition=null,this.discreteScales=calculateDiscreteScales(this._minScale,this._maxScale),this.middlePress=null,this._dragBounds=null,this._transformedPanBounds=this._panBounds.transformed(this._targetNode.matrix.inverted()),this._draggingInDragBounds=!1,this._attachedPointers=[],this.boundsFinite=!1;let r=null,s=null;this.gestureStartAction=new PhetioAction$1(h=>{assert&&assert(h.pageX,"pageX required on DOMEvent"),assert&&assert(h.pageY,"pageY required on DOMEvent"),assert&&assert(h.scale,"scale required on DOMEvent"),h.preventDefault(),this.trackpadGestureStartScale=h.scale,this.scaleGestureTargetPosition=new Vector2(h.pageX,h.pageY)},{phetioPlayback:!0,tandem:n.tandem.createTandem("gestureStartAction"),parameters:[{name:"event",phetioType:EventIO}],phetioEventType:EventType.USER,phetioDocumentation:"Action that executes whenever a gesture starts on a trackpad in macOS Safari."}),this.gestureChangeAction=new PhetioAction$1(h=>{assert&&assert(h.scale,"scale required on DOMEvent"),h.preventDefault();const c=this.sourceScale+h.scale-this.trackpadGestureStartScale;this.setDestinationScale(c)},{phetioPlayback:!0,tandem:n.tandem.createTandem("gestureChangeAction"),parameters:[{name:"event",phetioType:EventIO}],phetioEventType:EventType.USER,phetioDocumentation:"Action that executes whenever a gesture changes on a trackpad in macOS Safari."}),platform.safari&&!platform.mobileSafari&&(r=this.handleGestureStartEvent.bind(this),s=this.handleGestureChangeEvent.bind(this),this.trackpadGestureStartScale=this.getCurrentScale(),window.addEventListener("gesturestart",r),window.addEventListener("gesturechange",s)),globalKeyStateTracker$1.keydownEmitter.addListener(this.windowKeydown.bind(this));const a=this.handleFocusChange.bind(this);FocusManager.pdomFocusProperty.link(a),this.sourceFramePanBoundsProperty.lazyLink(()=>{isSettingPhetioStateProperty.value&&(this.initializePositions(),this.sourceScale=this.getCurrentScale(),this.setDestinationScale(this.sourceScale))},{phetioDependencies:[this.matrixProperty]}),this.disposeAnimatedPanZoomListener=()=>{r&&window.removeEventListener("gesturestart",r),s&&window.removeEventListener("gestureChange",s),this.animatingProperty.dispose(),this._transformTracker&&this._transformTracker.dispose(),FocusManager.pdomFocusProperty.unlink(a)}}step(e){this.middlePress&&this.handleMiddlePress(e),this._attachedPointers.length>0&&this.getCurrentScale()>1&&(this._attachedPointers.length>0&&(this._attachedPointers=this._attachedPointers.filter(t=>t.attachedListener),assert&&assert(this._attachedPointers.length<=10,"Not clearing attachedPointers, there is probably a memory leak")),(this._draggingInDragBounds||this._attachedPointers.some(t=>t instanceof PDOMPointer))&&this.repositionDuringDrag()),this.animateToTargets(e)}down(e){super.down(e),this._dragBounds!==null&&e.pointer.hasIntent(Intent.DRAG)&&(this._attachedPointers.length===0&&(this._draggingInDragBounds=this._dragBounds.containsPoint(e.pointer.point)),e.pointer.attachedListener&&(this._attachedPointers.includes(e.pointer)||this._attachedPointers.push(e.pointer))),e.pointer.type==="mouse"&&e.pointer instanceof Mouse&&e.pointer.middleDown&&!this.middlePress?(this.middlePress=new MiddlePress(e.pointer,e.trail),e.pointer.cursor=MOVE_CURSOR):this.cancelMiddlePress()}cancelMiddlePress(){this.middlePress&&(this.middlePress.pointer.cursor=null,this.middlePress=null,this.stopInProgressAnimation())}movePress(e){this.middlePress||super.movePress(e)}move(e){if(this._attachedPointers.length>0&&this.getCurrentScale()>1)if(this._draggingInDragBounds){if(!this._attachedPointers.includes(e.pointer)){const t=this.hasDragIntent(e.pointer);e.currentTarget!==null&&t&&e.pointer.attachedListener&&this._attachedPointers.push(e.pointer)}}else this._dragBounds&&(this._draggingInDragBounds=this._dragBounds.containsPoint(e.pointer.point))}getTargetNodeDuringDrag(){if(this._attachedPointers.length>0){const e=this._attachedPointers[0].attachedListener;if(assert&&assert(e,"The attached Pointer is expected to have an attached listener."),e.listener instanceof PressListener||e.listener instanceof KeyboardDragListener$1){const t=e.listener;if(t.isPressed)return t.getCurrentTarget()}}return null}getGlobalBoundsToViewDuringDrag(){let e=null;if(this._attachedPointers.length>0){const t=this._attachedPointers[0].attachedListener;if(assert&&assert(t,"The attached Pointer is expected to have an attached listener."),t.createPanTargetBounds)e=t.createPanTargetBounds();else if(t.listener instanceof PressListener||t.listener instanceof KeyboardDragListener$1){const n=t.listener;if(n.isPressed){const r=n.getCurrentTarget();if(r.instances.length===1){const s=r.instances[0].trail;assert&&assert(s,"The target should be in one scene graph and have an instance with a trail."),e=s.parentToGlobalBounds(r.visibleBounds)}}}}return e}repositionDuringDrag(){const e=this.getGlobalBoundsToViewDuringDrag(),t=this.getTargetNodeDuringDrag();e&&this.keepBoundsInView(e,this._attachedPointers.some(n=>n instanceof PDOMPointer),t==null?void 0:t.limitPanDirection)}cancelPanningDuringDrag(e){if(e){const t=this._attachedPointers.indexOf(e.pointer);t>-1&&this._attachedPointers.splice(t,1)}else this._attachedPointers=[];this._draggingInDragBounds=!1}up(e){this.cancelPanningDuringDrag(e)}wheel(e){if(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener wheel"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),!this.middlePress){const t=new Wheel(e,this._targetScale);this.repositionFromWheel(t,e)}sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}windowKeydown(e){this.cancelMiddlePress();const t=_.get(window,"phet.joist.sim",null);if((!t||!t.display._accessible||!t.display.pdomRootElement.contains(e.target))&&(this.handleZoomCommands(e),KeyboardUtils.isArrowKey(e))){const n=new KeyPress(globalKeyStateTracker$1,this.getCurrentScale(),this._targetScale);this.repositionFromKeys(n)}}keydown(e){const t=e.domEvent;assert&&assert(t instanceof KeyboardEvent,"keydown event must be a KeyboardEvent"),this.cancelMiddlePress(),this.handleZoomCommands(t);const n=e.pointer.hasIntent(Intent.KEYBOARD_DRAG);if(KeyboardUtils.isArrowKey(t)&&!n){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener handle arrow key down"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const r=new KeyPress(globalKeyStateTracker$1,this.getCurrentScale(),this._targetScale);this.repositionFromKeys(r),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}}handleFocusChange(e,t){if(this._transformTracker&&(this._transformTracker.dispose(),this._transformTracker=null),t&&t.trail.lastNode()&&t.trail.lastNode().focusPanTargetBoundsProperty){const n=t.trail.lastNode().focusPanTargetBoundsProperty;assert&&assert(this._focusBoundsListener&&n.hasListener(this._focusBoundsListener),"Focus bounds listener should be linked to the previous Node"),n.unlink(this._focusBoundsListener),this._focusBoundsListener=null}if(e){const n=e.trail.lastNode();let r=e.trail;if(e.trail.containsNode(this._targetNode)){const a=e.trail.nodes.indexOf(this._targetNode),h=e.trail.nodes.length;r=e.trail.slice(a,h)}this._transformTracker=new TransformTracker$1(r);const s=()=>{if(this.getCurrentScale()>1){let a;if(n.focusPanTargetBoundsProperty){const h=n.focusPanTargetBoundsProperty.value;a=e.trail.localToGlobalBounds(h)}else a=e.trail.localToGlobalBounds(e.trail.lastNode().localBounds);this.keepBoundsInView(a,!0,n.limitPanDirection)}};this._transformTracker.addListener(s),n.focusPanTargetBoundsProperty&&(this._focusBoundsListener=s,n.focusPanTargetBoundsProperty.link(this._focusBoundsListener)),this.keepTrailInView(e.trail,n.limitPanDirection)}}handleZoomCommands(e){const t=KeyboardZoomUtils.isZoomCommand(e,!0),n=KeyboardZoomUtils.isZoomCommand(e,!1);if(t||n){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiPanZoomListener keyboard zoom in"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),e.preventDefault();const r=this.getNextDiscreteScale(t),s=new KeyPress(globalKeyStateTracker$1,r,this._targetScale);this.repositionFromKeys(s)}else KeyboardZoomUtils.isZoomResetCommand(e)&&(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener keyboard reset"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),e.preventDefault(),this.resetTransform(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop())}handleGestureStartEvent(e){this.gestureStartAction.execute(e)}handleGestureChangeEvent(e){this.gestureChangeAction.execute(e)}handleMiddlePress(e){const t=this.middlePress;assert&&assert(t,"MiddlePress must be defined to handle");const n=this.sourcePosition;if(assert&&assert(n,"sourcePosition must be defined to handle middle press, be sure to call initializePositions"),e>0){const s=t.pointer.point.minus(t.initialPoint),a=s.magnitude/100;a>0&&(s.setMagnitude(Math.min(a/e,MAX_SCROLL_VELOCITY*this._targetScale)),this.setDestinationPosition(n.plus(s)))}}translateScaleToTarget(e,t){const n=this._targetNode.globalToLocalPoint(e),r=this._targetNode.globalToParentPoint(e),s=Matrix3.translation(-n.x,-n.y),a=Matrix3.translation(r.x,r.y),h=this.limitScale(this.getCurrentScale()+t),c=a.timesMatrix(Matrix3.scaling(h)).timesMatrix(s);this.matrixProperty.set(c),this.correctReposition()}setTranslationScaleToTarget(e,t){const n=this._targetNode.globalToLocalPoint(e),r=this._targetNode.globalToParentPoint(e),s=Matrix3.translation(-n.x,-n.y),a=Matrix3.translation(r.x,r.y),h=this.limitScale(t),c=a.timesMatrix(Matrix3.scaling(h)).timesMatrix(s);this.matrixProperty.set(c),this.correctReposition()}translateDelta(e){const t=this._targetNode.globalToParentPoint(this._panBounds.center),n=t.plus(e);this.translateToTarget(n,t)}translateToTarget(e,t){const n=this._targetNode.globalToParentPoint(e),s=this._targetNode.globalToParentPoint(t).minus(n);this.matrixProperty.set(Matrix3.translationFromVector(s).timesMatrix(this._targetNode.getMatrix())),this.correctReposition()}repositionFromKeys(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener reposition from key press"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const t=this.sourcePosition;assert&&assert(t,"sourcePosition must be defined to handle key press, be sure to call initializePositions");const n=e.scale,r=this.getCurrentScale();n!==r?(this.setDestinationScale(n),this.scaleGestureTargetPosition=e.computeScaleTargetFromKeyPress()):e.translationVector.equals(Vector2.ZERO)||this.setDestinationPosition(t.plus(e.translationVector)),this.correctReposition(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}repositionFromWheel(e,t){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener reposition from wheel"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const n=t.domEvent;assert&&assert(n instanceof WheelEvent,"wheel event must be a WheelEvent");const r=this.sourcePosition;if(assert&&assert(r,"sourcePosition must be defined to handle wheel, be sure to call initializePositions"),n.preventDefault(),e.isCtrlKeyDown){const s=this.limitScale(this.getCurrentScale()+e.scaleDelta);this.scaleGestureTargetPosition=e.targetPoint,this.setDestinationScale(s)}else this.setDestinationPosition(r.plus(e.translationVector));this.correctReposition(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}correctReposition(){super.correctReposition(),this._panBounds.isFinite()&&(this._transformedPanBounds=this._panBounds.transformed(this._targetNode.matrix.inverted()),this.sourcePosition=this._transformedPanBounds.center,this.sourceScale=this.getCurrentScale())}addPress(e){super.addPress(e),this.stopInProgressAnimation()}removePress(e){super.removePress(e),this.middlePress&&(e.pointer.cursor=MOVE_CURSOR),this._presses.length===0&&this.stopInProgressAnimation()}interrupt(){this.cancelPanningDuringDrag(),this.cancelMiddlePress(),super.interrupt()}cancel(){this.interrupt()}hasDragIntent(e){return e.hasIntent(Intent.KEYBOARD_DRAG)||e.hasIntent(Intent.DRAG)}panToNode(e,t,n){assert&&assert(this._panBounds.isFinite(),"panBounds should be defined when panning."),this.keepBoundsInView(e.globalBounds,t,n)}keepBoundsInView(e,t,n){assert&&assert(this._panBounds.isFinite(),"panBounds should be defined when panning.");const r=this.sourcePosition;assert&&assert(r,"sourcePosition must be defined to handle keepBoundsInView, be sure to call initializePositions");const s=this._targetNode.globalToLocalBounds(e),a=new Vector2(0,0);let h=0,c=0,d=0,y=0;if(t)h=this._transformedPanBounds.centerX-s.centerX,c=this._transformedPanBounds.centerX-s.centerX,d=this._transformedPanBounds.centerY-s.centerY,y=this._transformedPanBounds.centerY-s.centerY;else if((n==="vertical"||s.width<this._transformedPanBounds.width)&&(n==="horizontal"||s.height<this._transformedPanBounds.height)){const O=150/this.getCurrentScale();h=this._transformedPanBounds.left-s.left+O,c=this._transformedPanBounds.right-s.right-O,d=this._transformedPanBounds.top-s.top+O,y=this._transformedPanBounds.bottom-s.bottom-O}n!=="vertical"&&(c<0&&(a.x=-c),h>0&&(a.x=-h)),n!=="horizontal"&&(y<0&&(a.y=-y),d>0&&(a.y=-d)),this.setDestinationPosition(r.plus(a))}keepTrailInView(e,t){if(this._panBounds.isFinite()&&e.lastNode().bounds.isFinite()){const n=e.localToGlobalBounds(e.lastNode().localBounds);this._panBounds.containsBounds(n)||this.keepBoundsInView(n,!0,t)}}animateToTargets(e){assert&&assert(this.boundsFinite,"initializePositions must be called at least once before animating");const t=this.sourcePosition;assert&&assert(t,"sourcePosition must be defined to animate, be sure to all initializePositions"),assert&&assert(t.isFinite(),"How can the source position not be a finite Vector2?");const n=this.destinationPosition;assert&&assert(n,"destinationPosition must be defined to animate, be sure to all initializePositions"),assert&&assert(n.isFinite(),"How can the destination position not be a finite Vector2?");const r=!n.equalsEpsilon(t,.1),s=!DotUtils.equalsEpsilon(this.sourceScale,this.destinationScale,.001);if(this.animatingProperty.value=r||s,this._presses.length===0||this.middlePress!==null){if(r){const a=n.minus(t);let h=a;a.magnitude!==0&&(h=a.normalized());const c=this.getTranslationSpeed(a.magnitude);scratchVelocityVector.setXY(c,c);const d=scratchVelocityVector.multiplyScalar(e),y=h.componentTimes(d);y.magnitude>a.magnitude&&y.set(a),assert&&assert(y.isFinite(),"Trying to translate with a non-finite Vector2"),this.translateDelta(y)}if(s){assert&&assert(this.scaleGestureTargetPosition,"there must be a scale target point");const a=this.destinationScale-this.sourceScale;let h=a*e*6;Math.abs(h)>Math.abs(a)&&(h=a),this.translateScaleToTarget(this.scaleGestureTargetPosition,h),this.setDestinationPosition(t)}else this.destinationScale!==this.sourceScale&&(assert&&assert(this.scaleGestureTargetPosition,"there must be a scale target point"),this.setTranslationScaleToTarget(this.scaleGestureTargetPosition,this.destinationScale),this.setDestinationPosition(t))}}stopInProgressAnimation(){this.boundsFinite&&this.sourcePosition&&(this.setDestinationScale(this.sourceScale),this.setDestinationPosition(this.sourcePosition))}initializePositions(){this.boundsFinite=this._transformedPanBounds.isFinite(),this.boundsFinite?(this.sourcePosition=this._transformedPanBounds.center,this.setDestinationPosition(this.sourcePosition)):(this.sourcePosition=null,this.destinationPosition=null)}setPanBounds(e){super.setPanBounds(e),this.initializePositions(),this._dragBounds=e.erodedXY(e.width*.1,e.height*.1),assert&&assert(this._dragBounds.hasNonzeroArea(),"drag bounds must have some width and height")}setTargetBounds(e){super.setTargetBounds(e),this.initializePositions()}setDestinationPosition(e){assert&&assert(this.boundsFinite,"bounds must be finite before setting destination positions"),assert&&assert(e.isFinite(),"provided destination position is not defined");const t=this.sourcePosition;assert&&assert(t,"sourcePosition must be defined to set destination position, be sure to call initializePositions"),scratchBounds.setMinMax(t.x-this._transformedPanBounds.left-this._panBounds.left,t.y-this._transformedPanBounds.top-this._panBounds.top,t.x+this._panBounds.right-this._transformedPanBounds.right,t.y+this._panBounds.bottom-this._transformedPanBounds.bottom),this.destinationPosition=scratchBounds.closestPointTo(e)}setDestinationScale(e){this.destinationScale=this.limitScale(e)}getTranslationSpeed(e){assert&&assert(e>=0,"distance for getTranslationSpeed should be a non-negative number");const t=e*this.getCurrentScale(),n=5,r=t*(1/(Math.pow(t,2)-Math.pow(n,2))+n);return Math.min(Math.abs(r),MAX_TRANSLATION_SPEED*this.getCurrentScale())}resetTransform(){super.resetTransform(),this.stopInProgressAnimation()}getNextDiscreteScale(e){const t=this.getCurrentScale();let n=null,r=Number.POSITIVE_INFINITY;for(let a=0;a<this.discreteScales.length;a++){const h=Math.abs(this.discreteScales[a]-t);h<r&&(r=h,n=a)}n=n,assert&&assert(n!==null,"nearestIndex should have been found");let s=e?n+1:n-1;return s=DotUtils.clamp(s,0,this.discreteScales.length-1),this.discreteScales[s]}dispose(){this.disposeAnimatedPanZoomListener()}}class KeyPress{constructor(e,t,n,r){const s=optionize()({translationMagnitude:80},r);let a=0;a+=e.isKeyDown(KeyboardUtils.KEY_RIGHT_ARROW)?1:0,a-=e.isKeyDown(KeyboardUtils.KEY_LEFT_ARROW)?1:0;let h=0;if(h+=e.isKeyDown(KeyboardUtils.KEY_DOWN_ARROW)?1:0,h-=e.isKeyDown(KeyboardUtils.KEY_UP_ARROW)?1:0,scratchTranslationVector.setXY(a,h),!scratchTranslationVector.equals(Vector2.ZERO)){const c=s.translationMagnitude*n;scratchTranslationVector.setMagnitude(c)}this.translationVector=scratchTranslationVector,this.scale=t}computeScaleTargetFromKeyPress(){scratchScaleTargetVector.setXY(0,0);const e=FocusManager.pdomFocusProperty.value;if(e){const t=e.trail,n=t.lastNode();n.bounds.isFinite()&&scratchScaleTargetVector.set(t.parentToGlobalPoint(n.center))}else{const t=PDOMUtils$1.getNextFocusable();if(t!==document.body){assert&&assert(document.body.contains(t),"focusable should be attached to the body");const n=t.offsetLeft+t.offsetWidth/2,r=t.offsetTop+t.offsetHeight/2;scratchScaleTargetVector.setXY(n,r)}}return assert&&assert(scratchScaleTargetVector.isFinite(),"target position not defined"),scratchScaleTargetVector}}class Wheel{constructor(e,t){const n=e.domEvent;assert&&assert(n instanceof WheelEvent,"SceneryEvent should have a DOMEvent from the wheel input"),this.isCtrlKeyDown=n.ctrlKey,this.scaleDelta=n.deltaY>0?-.5:.5,this.targetPoint=e.pointer.point;let r=n.deltaX*.5,s=n.deltaY*.5;n.deltaMode===window.WheelEvent.DOM_DELTA_LINE&&(r=r*25,s=s*25),this.translationVector=scratchTranslationVector.setXY(r*t,s*t)}}class MiddlePress{constructor(e,t){assert&&assert(e.type==="mouse","incorrect pointer type"),this.pointer=e,this.trail=t,this.initialPoint=e.point.copy()}}const calculateDiscreteScales=(o,e)=>{assert&&assert(o>=1,"min scales less than one are currently not supported");const t=8,n=[];for(let s=0;s<t;s++)n[s]=(e-o)/t*(s*s);const r=n[t-1];for(let s=0;s<n.length;s++)n[s]=o+n[s]*(e-o)/r;return n};scenery.register("AnimatedPanZoomListener",AnimatedPanZoomListener);class AnimatedPanZoomSingleton{constructor(){this._listener=null}initialize(e,t){this._listener=new AnimatedPanZoomListener(e,t)}dispose(){assert&&assert(this._listener,"No listener, call initialize first."),this._listener.dispose(),this._listener=null}get listener(){return assert&&assert(this._listener,"No listener, call initialize first."),this._listener}get initialized(){return!!this._listener}}const animatedPanZoomSingleton=new AnimatedPanZoomSingleton;scenery.register("animatedPanZoomSingleton",animatedPanZoomSingleton);class HandleDownlistener{down(e){e.handle()}}scenery.register("HandleDownlistener",HandleDownlistener);const KEYBOARD_DRAG_DIRECTION_KEY_MAP=new Map([["both",{left:[KeyboardUtils.KEY_A,KeyboardUtils.KEY_LEFT_ARROW],right:[KeyboardUtils.KEY_RIGHT_ARROW,KeyboardUtils.KEY_D],up:[KeyboardUtils.KEY_UP_ARROW,KeyboardUtils.KEY_W],down:[KeyboardUtils.KEY_DOWN_ARROW,KeyboardUtils.KEY_S]}],["leftRight",{left:[KeyboardUtils.KEY_A,KeyboardUtils.KEY_LEFT_ARROW,KeyboardUtils.KEY_DOWN_ARROW,KeyboardUtils.KEY_S],right:[KeyboardUtils.KEY_RIGHT_ARROW,KeyboardUtils.KEY_D,KeyboardUtils.KEY_UP_ARROW,KeyboardUtils.KEY_W],up:[],down:[]}],["upDown",{left:[],right:[],up:[KeyboardUtils.KEY_RIGHT_ARROW,KeyboardUtils.KEY_D,KeyboardUtils.KEY_UP_ARROW,KeyboardUtils.KEY_W],down:[KeyboardUtils.KEY_A,KeyboardUtils.KEY_LEFT_ARROW,KeyboardUtils.KEY_DOWN_ARROW,KeyboardUtils.KEY_S]}]]);class KeyboardDragListener extends EnabledComponent{constructor(e){assert&&assertMutuallyExclusiveOptions(e,["dragSpeed","shiftDragSpeed"],["dragDelta","shiftDragDelta"]),assert&&assertMutuallyExclusiveOptions(e,["mapPosition"],["dragBoundsProperty"]);const t=optionize()({dragDelta:10,shiftDragDelta:5,dragSpeed:0,shiftDragSpeed:0,keyboardDragDirection:"both",positionProperty:null,transform:null,dragBoundsProperty:null,mapPosition:null,start:null,drag:null,end:null,moveOnHoldDelay:0,moveOnHoldInterval:1e3/60,hotkeyHoldInterval:800,phetioEnabledPropertyInstrumented:!1,tandem:Tandem.REQUIRED,phetioReadOnly:!0},e);assert&&assert(t.shiftDragSpeed<=t.dragSpeed,"shiftDragSpeed should be less than or equal to shiftDragSpeed, it is intended to provide more fine-grained control"),assert&&assert(t.shiftDragDelta<=t.dragDelta,"shiftDragDelta should be less than or equal to dragDelta, it is intended to provide more fine-grained control"),super(t),this._start=t.start,this._drag=t.drag,this._end=t.end,this._dragBoundsProperty=t.dragBoundsProperty||new Property(null),this._mapPosition=t.mapPosition,this._transform=t.transform,this._positionProperty=t.positionProperty,this._dragSpeed=t.dragSpeed,this._shiftDragSpeed=t.shiftDragSpeed,this._dragDelta=t.dragDelta,this._shiftDragDelta=t.shiftDragDelta,this._moveOnHoldDelay=t.moveOnHoldDelay,this.moveOnHoldInterval=t.moveOnHoldInterval,this._hotkeyHoldInterval=t.hotkeyHoldInterval,this._keyboardDragDirection=t.keyboardDragDirection,this.isPressedProperty=new BooleanProperty(!1,{reentrant:!0}),this.keyState=[],this._hotkeys=[],this.currentHotkey=null,this.hotkeyDisablingDragging=!1,this.hotkeyHoldIntervalCounter=this._hotkeyHoldInterval,this.useDragSpeed=t.dragSpeed>0||t.shiftDragSpeed>0,this.moveOnHoldDelayCounter=0,this.moveOnHoldIntervalCounter=0,this.delayComplete=!1,this.dragStartAction=new PhetioAction$1(r=>{const s=KeyboardUtils.getEventCode(r.domEvent);if(assert&&assert(s,"How can we have a null key for KeyboardDragListener?"),!this.movementKeysDown&&KeyboardUtils.isMovementKey(r.domEvent)&&(assert&&assert(this._pointer===null,"We should have cleared the Pointer reference by now."),this._pointer=r.pointer,r.pointer.addInputListener(this._pointerListener,!0),this.isPressedProperty.value=!0),this.keyState.push({keyDown:!0,key:s,timeDown:0}),this._start&&this.movementKeysDown&&this._start(r),!this.useDragSpeed){const a=this.shiftKeyDown()?this._shiftDragDelta:this._dragDelta;this.updatePosition(a),this.moveOnHoldIntervalCounter=0}},{parameters:[{name:"event",phetioType:SceneryEvent.SceneryEventIO}],tandem:t.tandem.createTandem("dragStartAction"),phetioDocumentation:"Emits whenever a keyboard drag starts.",phetioReadOnly:t.phetioReadOnly,phetioEventType:EventType.USER}),this.dragEmitter=new Emitter({tandem:t.tandem.createTandem("dragEmitter"),phetioHighFrequency:!0,phetioDocumentation:"Emits whenever a keyboard drag occurs.",phetioReadOnly:t.phetioReadOnly,phetioEventType:EventType.USER}),this.dragEndAction=new PhetioAction$1(r=>{this.movementKeysDown||(assert&&assert(r.pointer===this._pointer,"How could the event Pointer be anything other than this PDOMPointer?"),this._pointer.removeInputListener(this._pointerListener),this._pointer=null,this.isPressedProperty.value=!1),this._end&&this._end(r)},{parameters:[{name:"event",phetioType:SceneryEvent.SceneryEventIO}],tandem:t.tandem.createTandem("dragEndAction"),phetioDocumentation:"Emits whenever a keyboard drag ends.",phetioReadOnly:t.phetioReadOnly,phetioEventType:EventType.USER});const n=this.step.bind(this);stepTimer.addListener(n),this.enabledProperty.lazyLink(this.onEnabledPropertyChange.bind(this)),this._pointerListener={listener:this,interrupt:this.interrupt.bind(this)},this._pointer=null,this._disposeKeyboardDragListener=()=>{stepTimer.removeListener(n),this.isPressedProperty.dispose()}}getDragBounds(){return this._dragBoundsProperty.value}get dragBounds(){return this.getDragBounds()}setTransform(e){this._transform=e}set transform(e){this.setTransform(e)}get transform(){return this.getTransform()}getTransform(){return this._transform}get dragSpeed(){return this._dragSpeed}set dragSpeed(e){this._dragSpeed=e}get shiftDragSpeed(){return this._shiftDragSpeed}set shiftDragSpeed(e){this._shiftDragSpeed=e}get dragDelta(){return this._dragDelta}set dragDelta(e){this._dragDelta=e}get shiftDragDelta(){return this._shiftDragDelta}set shiftDragDelta(e){this._shiftDragDelta=e}get moveOnHoldDelay(){return this._moveOnHoldDelay}set moveOnHoldDelay(e){this._moveOnHoldDelay=e}get moveOnHoldInterval(){return this._moveOnHoldInterval}set moveOnHoldInterval(e){assert&&assert(e>0,"if the moveOnHoldInterval is 0, then the dragging will be dependent on how often the dragListener is stepped"),this._moveOnHoldInterval=e}get hotkeyHoldInterval(){return this._hotkeyHoldInterval}set hotkeyHoldInterval(e){this._hotkeyHoldInterval=e}get isPressed(){return!!this._pointer}getCurrentTarget(){return assert&&assert(this.isPressed,"We have no currentTarget if we are not pressed"),assert&&assert(this._pointer&&this._pointer.trail,"Must have a Pointer with an active trail if we are pressed"),this._pointer.trail.lastNode()}onEnabledPropertyChange(e){!e&&this.interrupt()}keydown(e){const t=e.domEvent,n=KeyboardUtils.getEventCode(t);if(assert&&assert(n,"How can we have a null key from a keydown in KeyboardDragListener?"),!t.metaKey&&(KeyboardUtils.isMovementKey(t)&&t.preventDefault(),e.pointer.reserveForKeyboardDrag(),!this.keyInListDown([n]))){if(platform.safari&&KeyboardUtils.isArrowKey(t)&&this.keyInListDown([KeyboardUtils.KEY_RIGHT_ARROW,KeyboardUtils.KEY_LEFT_ARROW,KeyboardUtils.KEY_UP_ARROW,KeyboardUtils.KEY_DOWN_ARROW])){this.interrupt();return}this.canDrag(e)&&this.dragStartAction.execute(e)}}keyup(e){const t=e.domEvent,n=KeyboardUtils.getEventCode(t),r=this.movementKeysDown;n===KeyboardUtils.KEY_TAB&&t.shiftKey&&this.keyState.push({keyDown:!0,key:KeyboardUtils.KEY_SHIFT_LEFT,timeDown:0});for(let a=0;a<this.keyState.length;a++)n===this.keyState[a].key&&this.keyState.splice(a,1);const s=this.movementKeysDown;!s&&r!==s&&this.dragEndAction.execute(e),this.currentHotkey&&!this.allKeysInListDown(this.currentHotkey.keys)&&this.resetHotkeyState(),this.resetPressAndHold()}focusout(e){this.interrupt()}step(e){const t=e*1e3;if(this.keyState.length>0){for(let r=0;r<this.keyState.length;r++)this.keyState[r].keyDown&&(this.keyState[r].timeDown+=t);this.movementKeysDown&&(this.moveOnHoldDelayCounter+=t,this.moveOnHoldIntervalCounter+=t),this.currentHotkey&&(this.hotkeyHoldIntervalCounter+=t);let n=0;if(this.useDragSpeed){const s=(this.shiftKeyDown()?this._shiftDragSpeed:this._dragSpeed)/1e3;n=t*s}else{let r=!1;if(this.moveOnHoldDelayCounter>=this._moveOnHoldDelay&&!this.delayComplete&&(r=!0,this.delayComplete=!0,this.moveOnHoldIntervalCounter=0),this.delayComplete&&this.moveOnHoldIntervalCounter>=this._moveOnHoldInterval){r=!0;const s=this.moveOnHoldIntervalCounter-this._moveOnHoldInterval;this.moveOnHoldIntervalCounter=s}n=r?this.shiftKeyDown()?this._shiftDragDelta:this._dragDelta:0}n>0&&this.updatePosition(n)}}canDrag(e){const t=e.pointer.attachedListener;return this.enabledProperty.value&&(!t||t===this._pointerListener)}updateHotkeys(){for(let e=0;e<this._hotkeys.length;e++){const t=[],n=this._hotkeys[e].keys;for(let s=0;s<n.length;s++)for(let a=0;a<this.keyState.length;a++)this.keyState[a].key===n[s]&&t.push(this.keyState[a]);let r=t.length===1&&n.length===1;for(let s=0;s<t.length-1;s++)t[s+1]&&t[s].timeDown>t[s+1].timeDown&&(r=!0);r&&(this.currentHotkey=this._hotkeys[e],this.hotkeyHoldIntervalCounter>=this._hotkeyHoldInterval&&(this.hotkeyHoldIntervalCounter=0,this._hotkeys[e].callback()))}this.currentHotkey&&(this.keyInListDown(this.currentHotkey.keys)?this.hotkeyDisablingDragging=!0:(this.hotkeyDisablingDragging=!1,this.currentHotkey=null))}updatePosition(e){if(this.updateHotkeys(),!this.hotkeyDisablingDragging){let t=0,n=0;this.leftMovementKeysDown()&&(t-=e),this.rightMovementKeysDown()&&(t+=e),this.upMovementKeysDown()&&(n-=e),this.downMovementKeysDown()&&(n+=e);let r=new Vector2(t,n);if(!r.equals(Vector2.ZERO)){if(this._transform&&(r=(this._transform instanceof Transform3?this._transform:this._transform.value).inverseDelta2(r)),this._positionProperty){let s=this._positionProperty.value.plus(r);s=this.mapModelPoint(s),s.equals(this._positionProperty.value)||(this._positionProperty.value=s)}this._drag&&this._drag(r,this),this.dragEmitter.emit()}}}mapModelPoint(e){return this._mapPosition?this._mapPosition(e):this._dragBoundsProperty.value?this._dragBoundsProperty.value.closestPointTo(e):e}keyInListDown(e){let t=!1;for(let n=0;n<this.keyState.length;n++){if(this.keyState[n].keyDown){for(let r=0;r<e.length;r++)if(e[r]===this.keyState[n].key){t=!0;break}}if(t)break}return t}allKeysInListDown(e){assert&&assert(e.length>0,"You are testing to see if an empty list of keys is down?");let t=!0;for(let n=0;n<e.length;n++){const r=_.find(this.keyState,s=>s.key===e[n]);if(!r||!r.keyDown){t=!1;break}}return t}getKeyboardDragDirectionKeys(){const e=KEYBOARD_DRAG_DIRECTION_KEY_MAP.get(this._keyboardDragDirection);return assert&&assert(e,`No direction keys found in map for KeyboardDragDirection ${this._keyboardDragDirection}`),e}leftMovementKeysDown(){return this.keyInListDown(this.getKeyboardDragDirectionKeys().left)}rightMovementKeysDown(){return this.keyInListDown(this.getKeyboardDragDirectionKeys().right)}upMovementKeysDown(){return this.keyInListDown(this.getKeyboardDragDirectionKeys().up)}downMovementKeysDown(){return this.keyInListDown(this.getKeyboardDragDirectionKeys().down)}getMovementKeysDown(){return this.rightMovementKeysDown()||this.leftMovementKeysDown()||this.upMovementKeysDown()||this.downMovementKeysDown()}get movementKeysDown(){return this.getMovementKeysDown()}enterKeyDown(){return this.keyInListDown([KeyboardUtils.KEY_ENTER])}shiftKeyDown(){return this.keyInListDown(KeyboardUtils.SHIFT_KEYS)}addHotkey(e){this._hotkeys.push(e)}removeHotkey(e){assert&&assert(this._hotkeys.includes(e),"Trying to remove a hotkey that is not in the list of hotkeys.");const t=this._hotkeys.indexOf(e);this._hotkeys.splice(t,1)}setHotkeys(e){this._hotkeys=e.slice(0)}removeAllHotkeys(){this._hotkeys=[]}resetPressAndHold(){this.delayComplete=!1,this.moveOnHoldDelayCounter=0,this.moveOnHoldIntervalCounter=0}resetHotkeyState(){this.currentHotkey=null,this.hotkeyHoldIntervalCounter=this._hotkeyHoldInterval,this.hotkeyDisablingDragging=!1}interrupt(){this.keyState=[],this.resetHotkeyState(),this.resetPressAndHold(),this._pointer&&(assert&&assert(this._pointer.listeners.includes(this._pointerListener),"A reference to the Pointer means it should have the pointerListener"),this._pointer.removeInputListener(this._pointerListener),this._pointer=null,this.isPressedProperty.value=!1,this._end&&this._end())}dispose(){this.interrupt(),this._disposeKeyboardDragListener(),super.dispose()}static isLeftMovementKey(e){return e===KeyboardUtils.KEY_A||e===KeyboardUtils.KEY_LEFT_ARROW}static isRightMovementKey(e){return e===KeyboardUtils.KEY_D||e===KeyboardUtils.KEY_RIGHT_ARROW}static isUpMovementKey(e){return e===KeyboardUtils.KEY_W||e===KeyboardUtils.KEY_UP_ARROW}static isDownMovementKey(e){return e===KeyboardUtils.KEY_S||e===KeyboardUtils.KEY_DOWN_ARROW}}scenery.register("KeyboardDragListener",KeyboardDragListener);const KeyboardDragListener$1=KeyboardDragListener;class KeyboardListener{constructor(e){const t=optionize()({callback:_.noop,cancel:_.noop,focus:_.noop,blur:_.noop,global:!1,capture:!1,handle:!1,abort:!1,listenerFireTrigger:"down",fireOnHold:!1,fireOnHoldDelay:400,fireOnHoldInterval:100},e);this._callback=t.callback,this._cancel=t.cancel,this._focus=t.focus,this._blur=t.blur,this._listenerFireTrigger=t.listenerFireTrigger,this._fireOnHold=t.fireOnHold,this._fireOnHoldDelay=t.fireOnHoldDelay,this._fireOnHoldInterval=t.fireOnHoldInterval,this._activeKeyGroups=[],this.keysDown=!1,this._global=t.global,this._handle=t.handle,this._abort=t.abort,this._keyGroups=this.convertKeysToKeyGroups(t.keys),this.listener=this,this.capture=t.capture,this._windowFocusListener=this.handleWindowFocusChange.bind(this),FocusManager.windowHasFocusProperty.link(this._windowFocusListener)}fireCallback(e,t){this._callback(e,t.naturalKeys,this)}handleKeyDown(e){(this._listenerFireTrigger==="down"||this._listenerFireTrigger==="both")&&this._keyGroups.forEach(t=>{this._activeKeyGroups.includes(t)||this.areKeysDownForListener(t)&&t.keys.includes(globalKeyStateTracker$1.getLastKeyDown())&&(this._activeKeyGroups.push(t),this.keysDown=!0,e.pointer.reserveForKeyboardDrag(),t.timer&&t.timer.start(),this.fireCallback(e,t))}),this.manageEvent(e)}handleKeyUp(e){if(this._activeKeyGroups.length>0&&this._activeKeyGroups.forEach((t,n)=>{this.areKeysDownForListener(t)||(t.timer&&t.timer.stop(!1),this._activeKeyGroups.splice(n,1))}),this._listenerFireTrigger==="up"||this._listenerFireTrigger==="both"){const t=KeyboardUtils.getEventCode(e.domEvent);t&&this._keyGroups.forEach(n=>{this.areModifierKeysDownForListener(n)&&n.keys.includes(t)&&(this.keysDown=!1,this.fireCallback(e,n))})}this.manageEvent(e)}getDownModifierKeys(e){const t=e.modifierKeys,n=[];return t.forEach(r=>{for(const s of r)if(globalKeyStateTracker$1.isKeyDown(s)){n.push(s);break}}),n}areKeysDownForListener(e){const t=this.getDownModifierKeys(e),n=t.length===e.modifierKeys.length,r=e.keys.find(s=>globalKeyStateTracker$1.isKeyDown(s));if(n&&r){const s=[...t,r];return globalKeyStateTracker$1.areKeysDownWithoutExtraModifiers(s)}else return!1}areModifierKeysDownForListener(e){const t=this.getDownModifierKeys(e);return t.length===e.modifierKeys.length?globalKeyStateTracker$1.areKeysDownWithoutExtraModifiers(t):!1}manageEvent(e){this._handle&&e.handle(),this._abort&&e.abort()}keydown(e){this._global||this.handleKeyDown(e)}keyup(e){this._global||this.handleKeyUp(e)}globalkeydown(e){this._global&&this.handleKeyDown(e)}globalkeyup(e){this._global&&this.handleKeyUp(e)}handleCancel(){this.clearActiveKeyGroups(),this._cancel(this)}handleWindowFocusChange(e){e||this.handleCancel()}cancel(){this.handleCancel()}interrupt(){this.handleCancel()}focusout(e){this.interrupt(),this._blur(this)}focusin(e){this._focus(this)}dispose(){this._keyGroups.forEach(e=>{e.timer&&e.timer.dispose()}),this._keyGroups.length=0,FocusManager.windowHasFocusProperty.unlink(this._windowFocusListener)}clearActiveKeyGroups(){this._activeKeyGroups.forEach(e=>{e.timer&&e.timer.stop(!1)}),this._activeKeyGroups.length=0}convertKeysToKeyGroups(e){return e.map(n=>{const r=n.split("+");assert&&assert(r.length>0,"no keys provided?");const s=r.slice(-1)[0],a=EnglishStringToCodeMap[s];assert&&assert(a,`Codes were not found, do you need to add it to EnglishStringToCodeMap? ${s}`);let h=[];r.length>1&&(h=r.slice(0,r.length-1).map(g=>{const D=EnglishStringToCodeMap[g];return assert&&assert(D,`Key not found, do you need to add it to EnglishStringToCodeMap? ${g}`),D}));const c=this._fireOnHold?new CallbackTimer({callback:()=>this.fireCallback(null,d),delay:this._fireOnHoldDelay,interval:this._fireOnHoldInterval}):null,d={keys:a,modifierKeys:h,naturalKeys:n,timer:c};return d})}}scenery.register("KeyboardListener",KeyboardListener);const SpriteListenable=memoize(o=>(assert&&assert(_.includes(inheritance(o),PressListener),"Only PressListener subtypes should mix SpriteListenable"),class extends o{constructor(...e){super(...e),this.spriteInstance=null}press(e,t,n){if(this.isPressed)return!1;if(this.spriteInstance=null,e.currentTarget instanceof Sprites){const r=e.currentTarget;this.spriteInstance=r.getSpriteInstanceFromPoint(r.globalToLocalPoint(e.pointer.point))}return this.spriteInstance?super.press(e,t,n):!1}}));scenery.register("SpriteListenable",SpriteListenable);const PRESS_AND_HOLD_INTERVAL=.75,DOUBLE_TAP_INTERVAL=.6;class SwipeListener{constructor(e){this._pointer=null,this.downPoint=null,this.downEvent=null,this.enabled=!1,this.lastPoint=null,this.currentPoint=null,this.velocity=null,this.swipeDistance=null,this.firstUp=!1,this.timeSinceLastDown=0,this.downPointers=[],this.holdingTime=0,this.focusedNode=null,this.handleEventListener={down:t=>{t.handle(),t.abort(),this.handleDown(t)}},e.pointerAddedEmitter.addListener(t=>{this.enabled&&t.addInputListener(this.handleEventListener,!0)}),this._attachedPointerListener={up:t=>{this.focusedNode&&this.focusedNode.swipeEnd&&this.focusedNode.swipeEnd.bind(this.focusedNode)(t,this),this.focusedNode=null,this._pointer.removeInputListener(this._attachedPointerListener),this._pointer=null},move:t=>{this.focusedNode&&this.focusedNode.swipeMove&&this.focusedNode.swipeMove.bind(this.focusedNode)(t,this)},interrupt:t=>{this.focusedNode=null,this._pointer.removeInputListener(this._attachedPointerListener),this._pointer=null},cancel:t=>{this.focusedNode=null,this._pointer.removeInputListener(this._attachedPointerListener),this._pointer=null}},this._pointerListener={up:t=>{this.endSwipe(),this._pointer=null,this.swipeDistance=t.pointer.point.minus(this.downPoint);const n=this.swipeDistance.y,r=this.swipeDistance.x;if(Math.abs(r)>100&&Math.abs(n)<100)if(r>0){if(FocusManager.pdomFocusedNode&&FocusManager.pdomFocusedNode.innerContent==="Reset All")return;PDOMUtils$1.getNextFocusable(document.body).focus()}else PDOMUtils$1.getPreviousFocusable(document.body).focus();else if(this.firstUp){if(this.timeSinceLastDown<DOUBLE_TAP_INTERVAL){this.firstUp=!1,this.timeSinceLastDown=0;const s=document.getElementsByClassName("a11y-pdom-root")[0];s&&s.contains(t.activeElement)&&t.activeElement.click()}}else this.firstUp=!0},move:t=>{this.lastPoint=this.currentPoint,this.currentPoint=t.pointer.point},interrupt:()=>{this.interrupt()},cancel:()=>{this.interrupt()}},stepTimer.addListener(this.step.bind(this))}handleDown(e){e.pointer.addIntent(Intent.DRAG),this.downPointers.push(e.pointer),this.downPointers.length>1&&(this.downPointers.forEach(t=>t.removeIntent(Intent.DRAG)),e.pointer.removeIntent(Intent.DRAG)),assert&&assert(e.pointer.attachedProperty.get(),"should be attached to the handle listener"),e.pointer.removeInputListener(this.handleEventListener),this._pointer===null&&e.pointer.type==="touch"&&(this._pointer=e.pointer,e.pointer.addInputListener(this._pointerListener,!0),e.abort(),this.downEvent=e,this.downPoint=e.pointer.point,this.currentPoint=this.downPoint.copy(),this.previousPoint=this.currentPoint.copy())}up(e){const t=this.downPointers.indexOf(e.pointer);t>-1&&this.downPointers.splice(t,1)}step(e){if(this.firstUp&&(this.timeSinceLastDown+=e,this.timeSinceLastDown>DOUBLE_TAP_INTERVAL&&(this.firstUp=!1,this.timeSinceLastDown=0)),this._pointer&&!this._pointer.listeners.includes(this._attachedPointerListener))if(this.holdingTime>PRESS_AND_HOLD_INTERVAL){const t=FocusManager.pdomFocusedNode;t&&(this._pointer.removeInputListener(this._pointerListener),this.holdingTime=0,this.focusedNode=t,this._pointer.addInputListener(this._attachedPointerListener,!0),this.focusedNode.swipeStart&&this.focusedNode.swipeStart(this.downEvent,this),this.downEvent=null)}else this.holdingTime+=e;this.lastPoint!==null&&this.currentPoint!==null&&(this.velocity=this.lastPoint.minus(this.currentPoint).dividedScalar(e))}endSwipe(){this.holdingTime=0,this._pointer&&this._pointer.listeners.includes(this._pointerListener)&&this._pointer.removeInputListener(this._pointerListener)}detachPointerListener(){this._pointer.detach(this._attachedPointerListener)}interrupt(){this.endSwipe(),this._pointer=null,this.downEvent=null}}scenery.register("SwipeListener",SwipeListener);const LayoutOrientationValues=["horizontal","vertical"],HorizontalLayoutAlignValues=["left","right","center","origin"],VerticalLayoutAlignValues=["top","bottom","center","origin"],Bt=class Bt extends EnumerationValue{constructor(e,t,n=Number.POSITIVE_INFINITY){super(),this.horizontal=e,this.vertical=t,this.padRatio=n}static getAllowedAligns(e){return[...e===Orientation.HORIZONTAL?HorizontalLayoutAlignValues:VerticalLayoutAlignValues,null]}static alignToInternal(e,t){return e===Orientation.HORIZONTAL?Bt.horizontalAlignToInternal(t):Bt.verticalAlignToInternal(t)}static horizontalAlignToInternal(e){return e===null?null:(assert&&assert(horizontalAlignMap[e]),horizontalAlignMap[e])}static verticalAlignToInternal(e){return e===null?null:(assert&&assert(verticalAlignMap[e]),verticalAlignMap[e])}static internalToAlign(e,t){return t===null?null:e===Orientation.HORIZONTAL?t.horizontal:t.vertical}};Bt.START=new Bt("left","top",0),Bt.END=new Bt("right","bottom",1),Bt.CENTER=new Bt("center","center",.5),Bt.ORIGIN=new Bt("origin","origin"),Bt.enumeration=new Enumeration(Bt,{phetioDocumentation:"Alignment for layout containers"});let LayoutAlign=Bt;const horizontalAlignMap={left:LayoutAlign.START,right:LayoutAlign.END,center:LayoutAlign.CENTER,origin:LayoutAlign.ORIGIN},verticalAlignMap={top:LayoutAlign.START,bottom:LayoutAlign.END,center:LayoutAlign.CENTER,origin:LayoutAlign.ORIGIN};scenery.register("LayoutAlign",LayoutAlign);const HorizontalLayoutJustificationValues=["left","right","center","spaceBetween","spaceAround","spaceEvenly"],VerticalLayoutJustificationValues=["top","bottom","center","spaceBetween","spaceAround","spaceEvenly"],Vt=class Vt extends EnumerationValue{constructor(e,t,n){super(),this.spacingFunctionFactory=e,this.horizontal=t,this.vertical=n}static getAllowedJustificationValues(e){return e===Orientation.HORIZONTAL?HorizontalLayoutJustificationValues:VerticalLayoutJustificationValues}static justifyToInternal(e,t){return e===Orientation.HORIZONTAL?(assert&&assert(horizontalJustificationMap[t]),horizontalJustificationMap[t]):(assert&&assert(verticalJustificationMap[t]),verticalJustificationMap[t])}static internalToJustify(e,t){return e===Orientation.HORIZONTAL?t.horizontal:t.vertical}};Vt.START=new Vt(()=>()=>0,"left","top"),Vt.END=new Vt(e=>t=>t===0?e:0,"right","bottom"),Vt.CENTER=new Vt(e=>t=>t===0?e/2:0,"center","center"),Vt.SPACE_BETWEEN=new Vt((e,t)=>n=>n!==0?e/(t-1):0,"spaceBetween","spaceBetween"),Vt.SPACE_AROUND=new Vt((e,t)=>n=>(n!==0?2:1)*e/(2*t),"spaceAround","spaceAround"),Vt.SPACE_EVENLY=new Vt((e,t)=>n=>e/(t+1),"spaceEvenly","spaceEvenly"),Vt.enumeration=new Enumeration(Vt,{phetioDocumentation:"Justify for layout containers"});let LayoutJustification=Vt;const horizontalJustificationMap={left:LayoutJustification.START,right:LayoutJustification.END,center:LayoutJustification.CENTER,spaceBetween:LayoutJustification.SPACE_BETWEEN,spaceAround:LayoutJustification.SPACE_AROUND,spaceEvenly:LayoutJustification.SPACE_EVENLY},verticalJustificationMap={top:LayoutJustification.START,bottom:LayoutJustification.END,center:LayoutJustification.CENTER,spaceBetween:LayoutJustification.SPACE_BETWEEN,spaceAround:LayoutJustification.SPACE_AROUND,spaceEvenly:LayoutJustification.SPACE_EVENLY};scenery.register("LayoutJustification",LayoutJustification);const DEFAULT_SEPARATOR_LAYOUT_OPTIONS={stretch:!0,isSeparator:!0};class Separator extends Line{constructor(e){super(optionize3()({},{layoutOptions:DEFAULT_SEPARATOR_LAYOUT_OPTIONS,stroke:"rgb(100,100,100)"},e))}}scenery.register("Separator",Separator);class VSeparator extends HeightSizable(Separator){constructor(e){super(),this.localPreferredHeightProperty.link(t=>{t!==null&&(this.y2=t)}),this.mutate(e)}}scenery.register("VSeparator",VSeparator);class HSeparator extends WidthSizable(Separator){constructor(e){super(),this.localPreferredWidthProperty.link(t=>{t!==null&&(this.x2=t)}),this.mutate(e)}}scenery.register("HSeparator",HSeparator);const Ss=class Ss{constructor(e){this.initialize(e)}initialize(e){return this.trail=e,this}checkPreconditions(){assert&&assert(this.trail,"Should not be disposed"),assert&&assert(this.trail.getParentMatrix().isAxisAligned(),"Transforms with LayoutProxy need to be axis-aligned")}get node(){return assert&&this.checkPreconditions(),this.trail.lastNode()}get bounds(){return assert&&this.checkPreconditions(),this.trail.parentToGlobalBounds(this.node.bounds)}get visibleBounds(){return assert&&this.checkPreconditions(),this.trail.parentToGlobalBounds(this.node.visibleBounds)}get width(){return this.bounds.width}get height(){return this.bounds.height}get x(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformX(this.node.x)}set x(e){assert&&this.checkPreconditions(),this.node.x=this.trail.getParentTransform().inverseX(e)}get y(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformY(this.node.y)}set y(e){assert&&this.checkPreconditions(),this.node.y=this.trail.getParentTransform().inverseY(e)}get translation(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.translation)}set translation(e){assert&&this.checkPreconditions(),this.node.translation=this.trail.getParentTransform().inversePosition2(e)}get left(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformX(this.node.left)}set left(e){this.node.left=this.trail.getParentTransform().inverseX(e)}get right(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformX(this.node.right)}set right(e){assert&&this.checkPreconditions(),this.node.right=this.trail.getParentTransform().inverseX(e)}get centerX(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformX(this.node.centerX)}set centerX(e){assert&&this.checkPreconditions(),this.node.centerX=this.trail.getParentTransform().inverseX(e)}get top(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformY(this.node.top)}set top(e){assert&&this.checkPreconditions(),this.node.top=this.trail.getParentTransform().inverseY(e)}get bottom(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformY(this.node.bottom)}set bottom(e){assert&&this.checkPreconditions(),this.node.bottom=this.trail.getParentTransform().inverseY(e)}get centerY(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformY(this.node.centerY)}set centerY(e){assert&&this.checkPreconditions(),this.node.centerY=this.trail.getParentTransform().inverseY(e)}get leftTop(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.leftTop)}set leftTop(e){assert&&this.checkPreconditions(),this.node.leftTop=this.trail.getParentTransform().inversePosition2(e)}get centerTop(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.centerTop)}set centerTop(e){assert&&this.checkPreconditions(),this.node.centerTop=this.trail.getParentTransform().inversePosition2(e)}get rightTop(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.rightTop)}set rightTop(e){assert&&this.checkPreconditions(),this.node.rightTop=this.trail.getParentTransform().inversePosition2(e)}get leftCenter(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.leftCenter)}set leftCenter(e){assert&&this.checkPreconditions(),this.node.leftCenter=this.trail.getParentTransform().inversePosition2(e)}get center(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.center)}set center(e){assert&&this.checkPreconditions(),this.node.center=this.trail.getParentTransform().inversePosition2(e)}get rightCenter(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.rightCenter)}set rightCenter(e){assert&&this.checkPreconditions(),this.node.rightCenter=this.trail.getParentTransform().inversePosition2(e)}get leftBottom(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.leftBottom)}set leftBottom(e){assert&&this.checkPreconditions(),this.node.leftBottom=this.trail.getParentTransform().inversePosition2(e)}get centerBottom(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.centerBottom)}set centerBottom(e){assert&&this.checkPreconditions(),this.node.centerBottom=this.trail.getParentTransform().inversePosition2(e)}get rightBottom(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.rightBottom)}set rightBottom(e){assert&&this.checkPreconditions(),this.node.rightBottom=this.trail.getParentTransform().inversePosition2(e)}get widthSizable(){return this.node.widthSizable}get heightSizable(){return this.node.heightSizable}get preferredWidth(){assert&&this.checkPreconditions(),assert&&assert(isWidthSizable(this.node));const e=this.node.preferredWidth;return e===null?null:Math.abs(this.trail.getParentTransform().transformDeltaX(e))}set preferredWidth(e){assert&&this.checkPreconditions(),assert&&assert(isWidthSizable(this.node)),this.node.preferredWidth=e===null?null:Math.abs(this.trail.getParentTransform().inverseDeltaX(e))}get preferredHeight(){assert&&this.checkPreconditions(),assert&&assert(isHeightSizable(this.node));const e=this.node.preferredHeight;return e===null?null:Math.abs(this.trail.getParentTransform().transformDeltaY(e))}set preferredHeight(e){assert&&this.checkPreconditions(),assert&&assert(isHeightSizable(this.node)),this.node.preferredHeight=e===null?null:Math.abs(this.trail.getParentTransform().inverseDeltaY(e))}get minimumWidth(){assert&&this.checkPreconditions();const e=isWidthSizable(this.node)?this.node.minimumWidth||0:this.node.width;return Math.abs(this.trail.getParentTransform().transformDeltaX(e))}get minimumHeight(){assert&&this.checkPreconditions();const e=isHeightSizable(this.node)?this.node.minimumHeight||0:this.node.height;return Math.abs(this.trail.getParentTransform().transformDeltaY(e))}getMinimum(e){return e===Orientation.HORIZONTAL?this.minimumWidth:this.minimumHeight}get maxWidth(){return assert&&this.checkPreconditions(),this.node.maxWidth===null?null:Math.abs(this.trail.getParentTransform().transformDeltaX(this.node.maxWidth))}set maxWidth(e){assert&&this.checkPreconditions(),this.node.maxWidth=e===null?null:Math.abs(this.trail.getParentTransform().inverseDeltaX(e))}get maxHeight(){return assert&&this.checkPreconditions(),this.node.maxHeight===null?null:Math.abs(this.trail.getParentTransform().transformDeltaY(this.node.maxHeight))}set maxHeight(e){assert&&this.checkPreconditions(),this.node.maxHeight=e===null?null:Math.abs(this.trail.getParentTransform().inverseDeltaY(e))}getMax(e){return e===Orientation.HORIZONTAL?this.maxWidth:this.maxHeight}get visible(){return this.node.visible}set visible(e){this.node.visible=e}dispose(){this.trail=null,this.freeToPool()}freeToPool(){Ss.pool.freeToPool(this)}};Ss.pool=new Pool(Ss,{maxSize:1e3});let LayoutProxy=Ss;scenery.register("LayoutProxy",LayoutProxy);class LayoutProxyProperty extends DerivedProperty1{constructor(e,t,n){const r=new TrailsBetweenProperty(e,t);super([r],a=>a.length===1?LayoutProxy.pool.create(a[0].copy().removeAncestor()):null),this.transformTracker=null,this.trailsBetweenProperty=r,this.lazyLink((a,h)=>{h&&h.dispose()});const s=n==null?void 0:n.onTransformChange;s&&this.link(a=>{this.transformTracker&&(this.transformTracker.dispose(),this.transformTracker=null),a&&(this.transformTracker=new TransformTracker$1(a.trail.copy().addAncestor(e)),this.transformTracker.addListener(s))})}dispose(){this.trailsBetweenProperty.dispose(),this.transformTracker&&this.transformTracker.dispose(),super.dispose()}}scenery.register("LayoutProxyProperty",LayoutProxyProperty);class LayoutConstraint{constructor(e){this._layoutLockCount=0,this._layoutAttemptDuringLock=!1,this._enabled=!0,this._listenedNodes=new Set,this.finishedLayoutEmitter=new TinyEmitter,this.ancestorNode=e,this._updateLayoutListener=this.updateLayoutAutomatically.bind(this)}addNode(e,t=!0){assert&&assert(!this._listenedNodes.has(e)),assert&&assert(!t||!e._activeParentLayoutConstraint,"This node is already managed by a layout container - make sure to wrap it in a Node if DAG, removing it from an old layout container, etc."),t&&(e._activeParentLayoutConstraint=this),e.boundsProperty.lazyLink(this._updateLayoutListener),e.visibleProperty.lazyLink(this._updateLayoutListener),extendsWidthSizable(e)&&(e.minimumWidthProperty.lazyLink(this._updateLayoutListener),e.isWidthResizableProperty.lazyLink(this._updateLayoutListener)),extendsHeightSizable(e)&&(e.minimumHeightProperty.lazyLink(this._updateLayoutListener),e.isHeightResizableProperty.lazyLink(this._updateLayoutListener)),this._listenedNodes.add(e)}removeNode(e){assert&&assert(this._listenedNodes.has(e)),e._activeParentLayoutConstraint===this&&(e._activeParentLayoutConstraint=null),e.boundsProperty.unlink(this._updateLayoutListener),e.visibleProperty.unlink(this._updateLayoutListener),extendsWidthSizable(e)&&(e.minimumWidthProperty.unlink(this._updateLayoutListener),e.isWidthResizableProperty.unlink(this._updateLayoutListener)),extendsHeightSizable(e)&&(e.minimumHeightProperty.unlink(this._updateLayoutListener),e.isHeightResizableProperty.unlink(this._updateLayoutListener)),this._listenedNodes.delete(e)}layout(){}get isLocked(){return this._layoutLockCount>0}lock(){this._layoutLockCount++}unlock(){this._layoutLockCount--}validateLocalPreferredWidth(e){assert&&e.localBounds.isFinite()&&!this._layoutAttemptDuringLock&&e.validateLocalPreferredWidth()}validateLocalPreferredHeight(e){assert&&e.localBounds.isFinite()&&!this._layoutAttemptDuringLock&&e.validateLocalPreferredHeight()}validateLocalPreferredSize(e){assert&&e.localBounds.isFinite()&&!this._layoutAttemptDuringLock&&e.validateLocalPreferredSize()}updateLayout(){let e=0;if(this.isLocked)assert&&e++,assert&&assert(++e<500,"Likely infinite loop detected, are we triggering layout within the layout?"),this._layoutAttemptDuringLock=!0;else{this.lock();do this._layoutAttemptDuringLock=!1,this.layout();while(this._layoutAttemptDuringLock);this.unlock()}}updateLayoutAutomatically(){this._enabled&&this.updateLayout()}createLayoutProxy(e){const t=e.getTrails(n=>n===this.ancestorNode);return t.length===1?LayoutProxy.pool.create(t[0].removeAncestor()):null}get enabled(){return this._enabled}set enabled(e){this._enabled!==e&&(this._enabled=e,this.updateLayoutAutomatically())}dispose(){const e=[...this._listenedNodes.keys()];for(let t=0;t<e.length;t++)this.removeNode(e[t]);this.finishedLayoutEmitter.dispose()}}scenery.register("LayoutConstraint",LayoutConstraint);class LayoutCell{constructor(e,t,n){n?(this.layoutProxyProperty=null,this._proxy=n):(this._proxy=null,this.layoutProxyProperty=new LayoutProxyProperty(e.ancestorNode,t,{onTransformChange:()=>e.updateLayoutAutomatically()}),this.layoutProxyProperty.link(r=>{this._proxy=r,e.updateLayoutAutomatically()})),this._constraint=e,this._node=t,this.layoutOptionsListener=this.onLayoutOptionsChange.bind(this),this.node.layoutOptionsChangedEmitter.addListener(this.layoutOptionsListener)}onLayoutOptionsChange(){}get node(){return this._node}isConnected(){return this._proxy!==null}get proxy(){return assert&&assert(this._proxy),this._proxy}isSizable(e){return e===Orientation.HORIZONTAL?this.proxy.widthSizable:this.proxy.heightSizable}dispose(){this.layoutProxyProperty&&this.layoutProxyProperty.dispose(),this.node.layoutOptionsChangedEmitter.removeListener(this.layoutOptionsListener)}}scenery.register("LayoutCell",LayoutCell);class MarginLayoutCell extends LayoutCell{constructor(e,t,n){super(e,t,n),this.preferredSizeSet=new OrientationPair(!1,!1),this.lastAvailableBounds=Bounds2.NOTHING.copy(),this.lastUsedBounds=Bounds2.NOTHING.copy(),this._marginConstraint=e}reposition(e,t,n,r,s,a){const h=r&&this.isSizable(e)?t:this.getMinimumSize(e);if(assert){const d=e===Orientation.HORIZONTAL?this.node.maxWidth:this.node.maxHeight;assert(!this.isSizable(e)||d===null||Math.abs(d-h)>-1e-9,`Tried to set a preferred size ${h} larger than the specified max${e===Orientation.HORIZONTAL?"Width":"Height"} of ${d}. Ideally, try to avoid putting a maxWidth/maxHeight on a width/height-sizable Node (one that will resize to fit its preferred size) inside a layout container, particularly one that will try to expand the Node past its maximum size.`)}this.attemptPreferredSize(e,h),a===LayoutAlign.ORIGIN?this.positionOrigin(e,n+s):this.positionStart(e,n+(t-this.getCellBounds()[e.size])*a.padRatio);const c=this.getCellBounds();return assert&&assert(c.isFinite()),this.lastAvailableBounds[e.minCoordinate]=n,this.lastAvailableBounds[e.maxCoordinate]=n+t,this.lastUsedBounds.set(c),c}get effectiveLeftMargin(){return this._leftMargin!==null?this._leftMargin:this._marginConstraint._leftMargin}get effectiveRightMargin(){return this._rightMargin!==null?this._rightMargin:this._marginConstraint._rightMargin}get effectiveTopMargin(){return this._topMargin!==null?this._topMargin:this._marginConstraint._topMargin}get effectiveBottomMargin(){return this._bottomMargin!==null?this._bottomMargin:this._marginConstraint._bottomMargin}getEffectiveMinMargin(e){return e===Orientation.HORIZONTAL?this.effectiveLeftMargin:this.effectiveTopMargin}getEffectiveMaxMargin(e){return e===Orientation.HORIZONTAL?this.effectiveRightMargin:this.effectiveBottomMargin}get effectiveMinContentWidth(){return this._minContentWidth!==null?this._minContentWidth:this._marginConstraint._minContentWidth}get effectiveMinContentHeight(){return this._minContentHeight!==null?this._minContentHeight:this._marginConstraint._minContentHeight}getEffectiveMinContent(e){return e===Orientation.HORIZONTAL?this.effectiveMinContentWidth:this.effectiveMinContentHeight}get effectiveMaxContentWidth(){return this._maxContentWidth!==null?this._maxContentWidth:this._marginConstraint._maxContentWidth}get effectiveMaxContentHeight(){return this._maxContentHeight!==null?this._maxContentHeight:this._marginConstraint._maxContentHeight}getEffectiveMaxContent(e){return e===Orientation.HORIZONTAL?this.effectiveMaxContentWidth:this.effectiveMaxContentHeight}getMinimumSize(e){return this.getEffectiveMinMargin(e)+Math.max(this.proxy.getMinimum(e),this.getEffectiveMinContent(e)||0)+this.getEffectiveMaxMargin(e)}getMaximumSize(e){return this.getEffectiveMinMargin(e)+(this.getEffectiveMaxContent(e)||Number.POSITIVE_INFINITY)+this.getEffectiveMaxMargin(e)}attemptPreferredSize(e,t){if(this.proxy[e.sizable]){const n=this.getMinimumSize(e),r=this.getMaximumSize(e);assert&&assert(isFinite(n)),assert&&assert(r>=n),t=DotUtils.clamp(t,n,r);let s=t-this.getEffectiveMinMargin(e)-this.getEffectiveMaxMargin(e);const a=this.proxy.getMax(e);a!==null&&(s=Math.min(a,s)),this._marginConstraint.setProxyPreferredSize(e,this.proxy,s),this.preferredSizeSet.set(e,!0)}}unsetPreferredSize(e){this.proxy[e.sizable]&&this._marginConstraint.setProxyPreferredSize(e,this.proxy,null)}positionStart(e,t){const n=this.getEffectiveMinMargin(e)+t;this._marginConstraint.setProxyMinSide(e,this.proxy,n)}positionOrigin(e,t){this._marginConstraint.setProxyOrigin(e,this.proxy,t)}getOriginBounds(){return this.getCellBounds().shiftedXY(-this.proxy.x,-this.proxy.y)}getCellBounds(){return this.proxy.bounds.withOffsets(this.effectiveLeftMargin,this.effectiveTopMargin,this.effectiveRightMargin,this.effectiveBottomMargin)}dispose(){Orientation.enumeration.values.forEach(e=>{this.preferredSizeSet.get(e)&&this.unsetPreferredSize(e)}),super.dispose()}static createHelperNode(e,t,n){const r=new Node$2,s=.4,a=Shape$1.union(e.map(O=>Shape$1.bounds(O.lastAvailableBounds))),h=Shape$1.union(e.map(O=>Shape$1.bounds(O.lastUsedBounds))),c=Shape$1.union(e.map(O=>Shape$1.bounds(O.proxy.bounds))),d=Shape$1.bounds(t).shapeDifference(a),y=a.shapeDifference(h),g=h.shapeDifference(c),D=(O,V,k)=>{const M=new Text(O,{font:new Font({size:6,family:"monospace"}),fill:V}),N=Rectangle.bounds(M.bounds,{fill:k,children:[M]});return new NodePattern(N,4,Math.floor(N.left),Math.ceil(N.top+1),Math.floor(N.width),Math.floor(N.height-2),Matrix3.rotation2(-Math.PI/4))};return r.addChild(new Path(d,{fill:D("spacing","#000","#fff"),opacity:.6})),r.addChild(new Path(y,{fill:D("empty","#aaa","#000"),opacity:.6})),r.addChild(new Path(g,{fill:D("margin","#600","#f00"),opacity:.6})),r.addChild(Rectangle.bounds(t,{stroke:"white",lineDash:[2,2],lineDashOffset:2,lineWidth:s})),r.addChild(Rectangle.bounds(t,{stroke:"black",lineDash:[2,2],lineWidth:s})),e.forEach(O=>{r.addChild(Rectangle.bounds(O.getCellBounds(),{stroke:"rgba(0,255,0,1)",lineWidth:s}))}),e.forEach(O=>{r.addChild(Rectangle.bounds(O.proxy.bounds,{stroke:"rgba(255,0,0,1)",lineWidth:s}))}),e.forEach(O=>{const V=O.getCellBounds(),k=new PressListener({tandem:Tandem.OPT_OUT});r.addChild(Rectangle.bounds(V,{inputListeners:[k]}));let M=n(O);O.effectiveLeftMargin&&(M+=`leftMargin: ${O.effectiveLeftMargin}
`),O.effectiveRightMargin&&(M+=`rightMargin: ${O.effectiveRightMargin}
`),O.effectiveTopMargin&&(M+=`topMargin: ${O.effectiveTopMargin}
`),O.effectiveBottomMargin&&(M+=`bottomMargin: ${O.effectiveBottomMargin}
`),O.effectiveMinContentWidth&&(M+=`minContentWidth: ${O.effectiveMinContentWidth}
`),O.effectiveMinContentHeight&&(M+=`minContentHeight: ${O.effectiveMinContentHeight}
`),O.effectiveMaxContentWidth&&(M+=`maxContentWidth: ${O.effectiveMaxContentWidth}
`),O.effectiveMaxContentHeight&&(M+=`maxContentHeight: ${O.effectiveMaxContentHeight}
`),M+=`layoutOptions: ${JSON.stringify(O.node.layoutOptions,null,2).replace(/ /g,"&nbsp;")}
`;const N=new RichText(M.trim().replace(/\n/g,"<br>"),{font:new Font({size:12})}),F=Rectangle.bounds(N.bounds.dilated(3),{fill:"rgba(255,255,255,0.8)",children:[N],leftTop:V.leftTop});r.addChild(F),k.isOverProperty.link(G=>{F.visible=G})}),r}}scenery.register("MarginLayoutCell",MarginLayoutCell);const LAYOUT_NODE_OPTION_KEYS=["resize","layoutOrigin"];class LayoutNode extends Sizable(Node$2){constructor(e){super(e),this.layoutOriginProperty=new Vector2Property(Vector2.ZERO)}linkLayoutBounds(){this._constraint.layoutBoundsProperty.link(e=>{this.localBounds=e})}setExcludeInvisibleChildrenFromBounds(e){super.setExcludeInvisibleChildrenFromBounds(e),this._constraint.excludeInvisible=e}setChildren(e){if(this.constraint.isLocked)return super.setChildren(e);const t=this.getChildren();return this.constraint.lock(),super.setChildren(e),this.constraint.unlock(),_.isEqual(t,e)||this.constraint.updateLayoutAutomatically(),this}updateLayout(){this._constraint.updateLayout()}get resize(){return this._constraint.enabled}set resize(e){this._constraint.enabled=e}get layoutOrigin(){return this.layoutOriginProperty.value}set layoutOrigin(e){this.layoutOriginProperty.value=e}get constraint(){return this._constraint}dispose(){this._constraint.dispose(),super.dispose()}}scenery.register("LayoutNode",LayoutNode);class LayoutLine{initializeLayoutLine(){this.min=0,this.max=Number.POSITIVE_INFINITY,this.minOrigin=Number.POSITIVE_INFINITY,this.maxOrigin=Number.NEGATIVE_INFINITY,this.size=0,this.position=0}hasOrigin(){return isFinite(this.minOrigin)&&isFinite(this.maxOrigin)}}scenery.register("LayoutLine",LayoutLine);const CHANGE_POSITION_THRESHOLD=1e-9;class NodeLayoutConstraint extends LayoutConstraint{constructor(e,t){const n=optionize()({preferredWidthProperty:new TinyProperty(null),preferredHeightProperty:new TinyProperty(null),minimumWidthProperty:new TinyProperty(null),minimumHeightProperty:new TinyProperty(null),layoutOriginProperty:new TinyProperty(Vector2.ZERO)},t);super(e),this._excludeInvisible=!0,this.layoutBoundsProperty=new Property(Bounds2.NOTHING,{valueComparisonStrategy:"equalsFunction"}),this.preferredWidthProperty=n.preferredWidthProperty,this.preferredHeightProperty=n.preferredHeightProperty,this.minimumWidthProperty=n.minimumWidthProperty,this.minimumHeightProperty=n.minimumHeightProperty,this.layoutOriginProperty=n.layoutOriginProperty,this.preferredWidthProperty.lazyLink(this._updateLayoutListener),this.preferredHeightProperty.lazyLink(this._updateLayoutListener),this.layoutOriginProperty.lazyLink(this._updateLayoutListener)}filterLayoutCells(e){return assert&&assert(_.every(e,t=>!t.node.isDisposed),"A cell's node should not be disposed when layout happens"),e.filter(t=>t.isConnected()&&t.proxy.bounds.isValid()&&(!this.excludeInvisible||t.node.visible))}get excludeInvisible(){return this._excludeInvisible}set excludeInvisible(e){this._excludeInvisible!==e&&(this._excludeInvisible=e,this.updateLayoutAutomatically())}setProxyPreferredSize(e,t,n){t[e.preferredSize]=n}setProxyMinSide(e,t,n){Math.abs(t[e.minSide]-n)>CHANGE_POSITION_THRESHOLD&&(t[e.minSide]=n)}setProxyOrigin(e,t,n){Math.abs(t[e.coordinate]-n)>CHANGE_POSITION_THRESHOLD&&(t[e.coordinate]=n)}dispose(){this.preferredWidthProperty.unlink(this._updateLayoutListener),this.preferredHeightProperty.unlink(this._updateLayoutListener),this.layoutOriginProperty.unlink(this._updateLayoutListener),super.dispose()}}scenery.register("NodeLayoutConstraint",NodeLayoutConstraint);const MARGIN_LAYOUT_CONFIGURABLE_OPTION_KEYS=["margin","xMargin","yMargin","leftMargin","rightMargin","topMargin","bottomMargin","minContentWidth","minContentHeight","maxContentWidth","maxContentHeight"],MarginLayoutConfigurable=memoize(o=>class extends o{constructor(...t){super(...t),this._leftMargin=null,this._rightMargin=null,this._topMargin=null,this._bottomMargin=null,this._minContentWidth=null,this._minContentHeight=null,this._maxContentWidth=null,this._maxContentHeight=null,this.changedEmitter=new TinyEmitter}mutateConfigurable(t){assertMutuallyExclusiveOptions(t,["margin"],["xMargin","yMargin"]),assertMutuallyExclusiveOptions(t,["xMargin"],["leftMargin","rightMargin"]),assertMutuallyExclusiveOptions(t,["yMargin"],["topMargin","bottomMargin"])}setConfigToBaseDefault(){this._leftMargin=0,this._rightMargin=0,this._topMargin=0,this._bottomMargin=0,this._minContentWidth=null,this._minContentHeight=null,this._maxContentWidth=null,this._maxContentHeight=null,this.changedEmitter.emit()}setConfigToInherit(){this._leftMargin=null,this._rightMargin=null,this._topMargin=null,this._bottomMargin=null,this._minContentWidth=null,this._minContentHeight=null,this._maxContentWidth=null,this._maxContentHeight=null,this.changedEmitter.emit()}get leftMargin(){return this._leftMargin}set leftMargin(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)),this._leftMargin!==t&&(this._leftMargin=t,this.changedEmitter.emit())}get rightMargin(){return this._rightMargin}set rightMargin(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)),this._rightMargin!==t&&(this._rightMargin=t,this.changedEmitter.emit())}get topMargin(){return this._topMargin}set topMargin(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)),this._topMargin!==t&&(this._topMargin=t,this.changedEmitter.emit())}get bottomMargin(){return this._bottomMargin}set bottomMargin(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)),this._bottomMargin!==t&&(this._bottomMargin=t,this.changedEmitter.emit())}get xMargin(){return assert&&assert(this._leftMargin===this._rightMargin),this._leftMargin}set xMargin(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)),(this._leftMargin!==t||this._rightMargin!==t)&&(this._leftMargin=t,this._rightMargin=t,this.changedEmitter.emit())}get yMargin(){return assert&&assert(this._topMargin===this._bottomMargin),this._topMargin}set yMargin(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)),(this._topMargin!==t||this._bottomMargin!==t)&&(this._topMargin=t,this._bottomMargin=t,this.changedEmitter.emit())}get margin(){return assert&&assert(this._leftMargin===this._rightMargin&&this._leftMargin===this._topMargin&&this._leftMargin===this._bottomMargin),this._topMargin}set margin(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)),(this._leftMargin!==t||this._rightMargin!==t||this._topMargin!==t||this._bottomMargin!==t)&&(this._leftMargin=t,this._rightMargin=t,this._topMargin=t,this._bottomMargin=t,this.changedEmitter.emit())}get minContentWidth(){return this._minContentWidth}set minContentWidth(t){this._minContentWidth!==t&&(this._minContentWidth=t,this.changedEmitter.emit())}get minContentHeight(){return this._minContentHeight}set minContentHeight(t){this._minContentHeight!==t&&(this._minContentHeight=t,this.changedEmitter.emit())}get maxContentWidth(){return this._maxContentWidth}set maxContentWidth(t){this._maxContentWidth!==t&&(this._maxContentWidth=t,this.changedEmitter.emit())}get maxContentHeight(){return this._maxContentHeight}set maxContentHeight(t){this._maxContentHeight!==t&&(this._maxContentHeight=t,this.changedEmitter.emit())}});scenery.register("MarginLayoutConfigurable",MarginLayoutConfigurable);const FLOW_CONFIGURABLE_OPTION_KEYS=["orientation","align","stretch","grow"].concat(MARGIN_LAYOUT_CONFIGURABLE_OPTION_KEYS),FlowConfigurable=memoize(o=>class extends MarginLayoutConfigurable(o){constructor(...t){super(...t),this._orientation=Orientation.HORIZONTAL,this._align=null,this._stretch=null,this._grow=null,this.orientationChangedEmitter=new TinyEmitter}mutateConfigurable(t){super.mutateConfigurable(t),mutate(this,FLOW_CONFIGURABLE_OPTION_KEYS,t)}setConfigToBaseDefault(){this._align=LayoutAlign.CENTER,this._stretch=!1,this._grow=0,super.setConfigToBaseDefault()}setConfigToInherit(){this._align=null,this._stretch=null,this._grow=null,super.setConfigToInherit()}get orientation(){return this._orientation===Orientation.HORIZONTAL?"horizontal":"vertical"}set orientation(t){assert&&assert(t==="horizontal"||t==="vertical");const n=t==="horizontal"?Orientation.HORIZONTAL:Orientation.VERTICAL;this._orientation!==n&&(this._orientation=n,this.orientationChangedEmitter.emit(),this.changedEmitter.emit())}get align(){const t=LayoutAlign.internalToAlign(this._orientation,this._align);return assert&&assert(t===null||typeof t=="string"),t}set align(t){assert&&assert(LayoutAlign.getAllowedAligns(this._orientation.opposite).includes(t),`align ${t} not supported, with the orientation ${this._orientation}, the valid values are ${LayoutAlign.getAllowedAligns(this._orientation.opposite)}`);const n=LayoutAlign.alignToInternal(this._orientation.opposite,t);assert&&assert(n===null||n instanceof LayoutAlign),this._align!==n&&(this._align=n,this.changedEmitter.emit())}get stretch(){return this._stretch}set stretch(t){this._stretch!==t&&(this._stretch=t,this.changedEmitter.emit())}get grow(){return this._grow}set grow(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)&&t>=0),this._grow!==t&&(this._grow=t,this.changedEmitter.emit())}});scenery.register("FlowConfigurable",FlowConfigurable);const FLOW_CELL_KEYS=[...FLOW_CONFIGURABLE_OPTION_KEYS,"isSeparator"];class FlowCell extends FlowConfigurable(MarginLayoutCell){constructor(e,t,n){super(e,t,n),this.size=0,this._isSeparator=!1,this.flowConstraint=e,this.orientation=e.orientation,this.onLayoutOptionsChange()}get effectiveAlign(){return this._align!==null?this._align:this.flowConstraint._align}get effectiveStretch(){return this._stretch!==null?this._stretch:this.flowConstraint._stretch}get effectiveGrow(){return this._grow!==null?this._grow:this.flowConstraint._grow}onLayoutOptionsChange(){this.node.layoutOptions&&this.setOptions(this.node.layoutOptions),super.onLayoutOptionsChange()}setOptions(e){const t=optionize()({isSeparator:!1},e);assert&&Object.keys(t).forEach(n=>{assert&&assert(FLOW_CELL_KEYS.includes(n),`Cannot provide key ${n} to a FlowCell's layoutOptions. Perhaps this is a Grid-style layout option?`)}),this._isSeparator=t.isSeparator,this.setConfigToInherit(),this.mutateConfigurable(t)}}scenery.register("FlowCell",FlowCell);const Ls=class Ls extends LayoutLine{constructor(e,t){super(),this.initialize(e,t)}initialize(e,t){return this.orientation=e,this.cells=t,this.initializeLayoutLine(),this}getMinimumSize(e){return(this.cells.length-1)*e+_.sum(this.cells.map(t=>t.getMinimumSize(this.orientation)))}freeToPool(){Ls.pool.freeToPool(this)}clean(){this.cells.length=0,this.freeToPool()}};Ls.pool=new Pool(Ls,{defaultArguments:[Orientation.HORIZONTAL,[]]});let FlowLine=Ls;scenery.register("FlowLine",FlowLine);const FLOW_CONSTRAINT_OPTION_KEYS=[...FLOW_CONFIGURABLE_OPTION_KEYS,"spacing","lineSpacing","justify","justifyLines","wrap","excludeInvisible"];class FlowConstraint extends FlowConfigurable(NodeLayoutConstraint){constructor(e,t){super(e,t),this.cells=[],this._justify=LayoutJustification.SPACE_BETWEEN,this._justifyLines=null,this._wrap=!1,this._spacing=0,this._lineSpacing=0,this.displayedCells=[],this.setConfigToBaseDefault(),this.mutateConfigurable(t),mutate(this,FLOW_CONSTRAINT_OPTION_KEYS,t),this.changedEmitter.addListener(this._updateLayoutListener),this.orientationChangedEmitter.addListener(()=>this.cells.forEach(n=>{n.orientation=this.orientation}))}updateSeparatorVisibility(){let e=0;for(;e<this.cells.length;e++){const n=this.cells[e];if(n._isSeparator)n.node.visible=!1;else if(n.node.visible)break}let t=!1;for(let n=this.cells.length-1;n>e;n--){const r=this.cells[n];r._isSeparator?(r.node.visible=t,t=!1):r.node.visible&&(t=!0)}}layout(){super.layout();const e=this._orientation,t=this._orientation.opposite;this.updateSeparatorVisibility();const n=this.filterLayoutCells(this.cells);if(this.displayedCells=n,!n.length){this.layoutBoundsProperty.value=Bounds2.NOTHING,this.minimumWidthProperty.value=null,this.minimumHeightProperty.value=null;return}let r=this.getPreferredProperty(e).value;const s=this.getPreferredProperty(t).value,a=Math.max(...n.map(W=>W.getMinimumSize(e)||0));a>(r||Number.POSITIVE_INFINITY)&&(r=a);const h=[];if(this.wrap){let W=[],X=r||Number.POSITIVE_INFINITY;for(;n.length;){const J=n.shift(),oe=J.getMinimumSize(e);W.length===0?(W.push(J),X-=oe):this.spacing+oe<=X+1e-7?(W.push(J),X-=this.spacing+oe):(h.push(FlowLine.pool.create(e,W)),X=r||Number.POSITIVE_INFINITY,W=[J],X-=oe)}W.length&&h.push(FlowLine.pool.create(e,W))}else h.push(FlowLine.pool.create(e,n));h.forEach(W=>{W.cells.forEach(X=>{if(W.min=Math.max(W.min,X.getMinimumSize(t)),W.max=Math.min(W.max,X.getMaximumSize(t)),X.effectiveAlign===LayoutAlign.ORIGIN){const J=X.getOriginBounds();W.minOrigin=Math.min(J[t.minCoordinate],W.minOrigin),W.maxOrigin=Math.max(J[t.maxCoordinate],W.maxOrigin)}}),isFinite(W.minOrigin)&&isFinite(W.maxOrigin)?W.size=Math.max(W.min,W.maxOrigin-W.minOrigin):W.size=W.min});const c=Math.max(...h.map(W=>W.getMinimumSize(this.spacing))),d=_.sum(h.map(W=>W.size))+(h.length-1)*this.lineSpacing,y=this.wrap?a:c,g=Math.max(c,r||0),D=Math.max(d,s||0),O=this.layoutOriginProperty.value[e.coordinate],V=this.layoutOriginProperty.value[e.opposite.coordinate];h.forEach(W=>{const X=_.sum(W.cells.map(Oe=>Oe.getMinimumSize(e))),J=this.spacing*(W.cells.length-1);let oe=g-X-J;W.cells.forEach(Oe=>{Oe.size=Oe.getMinimumSize(e)});let le;for(;oe>1e-7&&(le=W.cells.filter(Oe=>Oe.effectiveGrow!==0&&Oe.size<Oe.getMaximumSize(e)-1e-7)).length;){const Oe=_.sum(le.map(Ue=>Ue.effectiveGrow)),He=Math.min(Math.min(...le.map(Ue=>(Ue.getMaximumSize(e)-Ue.size)/Ue.effectiveGrow)),oe/Oe);assert&&assert(He>1e-11),le.forEach(Ue=>{Ue.size+=He*Ue.effectiveGrow}),oe-=He*Oe}W.cells.forEach(Oe=>Oe.attemptPreferredSize(e,Oe.size));const pe=this._justify.spacingFunctionFactory(oe,W.cells.length);let ve=O;W.cells.forEach((Oe,He)=>{ve+=pe(He),He>0&&(ve+=this.spacing),Oe.positionStart(e,ve),Oe.lastAvailableBounds[e.minCoordinate]=ve,Oe.lastAvailableBounds[e.maxCoordinate]=ve+Oe.size,ve+=Oe.size,assert&&assert(this.spacing>=0||Oe.size>=-this.spacing-1e-7,"Negative spacing more than a cell's size causes issues with layout")})});const k=D-d,M=(h[0].hasOrigin()?h[0].minOrigin:0)+V;let N=M;if(this._justifyLines===null)h.forEach(W=>{W.size+=k/h.length}),h.forEach(W=>{W.position=N,N+=W.size+this.lineSpacing});else{const W=this._justifyLines.spacingFunctionFactory(k,h.length);h.forEach((X,J)=>{N+=W(J),X.position=N,N+=X.size+this.lineSpacing})}h.forEach(W=>W.cells.forEach(X=>{X.reposition(t,W.size,W.position,X.effectiveStretch,-W.minOrigin,X.effectiveAlign)}));const F=O,G=O+g,ie=M,Z=M+D;this.layoutBoundsProperty.value=Bounds2.oriented(e,F,ie,G,Z),this.minimumWidthProperty.value=e===Orientation.HORIZONTAL?y:d,this.minimumHeightProperty.value=e===Orientation.HORIZONTAL?d:y,this.finishedLayoutEmitter.emit(),h.forEach(W=>W.clean())}get justify(){const e=LayoutJustification.internalToJustify(this._orientation,this._justify);return assert&&assert(LayoutJustification.getAllowedJustificationValues(this._orientation).includes(e)),e}set justify(e){assert&&assert(LayoutJustification.getAllowedJustificationValues(this._orientation).includes(e),`justify ${e} not supported, with the orientation ${this._orientation}, the valid values are ${LayoutJustification.getAllowedJustificationValues(this._orientation)}`);const t=LayoutJustification.justifyToInternal(this._orientation,e);this._justify!==t&&(this._justify=t,this.updateLayoutAutomatically())}get justifyLines(){if(this._justifyLines===null)return null;{const e=LayoutJustification.internalToJustify(this._orientation,this._justifyLines);return assert&&assert(LayoutJustification.getAllowedJustificationValues(this._orientation).includes(e)),e}}set justifyLines(e){assert&&assert(e===null||LayoutJustification.getAllowedJustificationValues(this._orientation.opposite).includes(e),`justify ${e} not supported, with the orientation ${this._orientation.opposite}, the valid values are ${LayoutJustification.getAllowedJustificationValues(this._orientation.opposite)} or null`);const t=e===null?null:LayoutJustification.justifyToInternal(this._orientation.opposite,e);assert&&assert(t===null||t instanceof LayoutJustification),this._justifyLines!==t&&(this._justifyLines=t,this.updateLayoutAutomatically())}get wrap(){return this._wrap}set wrap(e){this._wrap!==e&&(this._wrap=e,this.updateLayoutAutomatically())}get spacing(){return this._spacing}set spacing(e){assert&&assert(isFinite(e)),this._spacing!==e&&(this._spacing=e,this.updateLayoutAutomatically())}get lineSpacing(){return this._lineSpacing}set lineSpacing(e){assert&&assert(isFinite(e)),this._lineSpacing!==e&&(this._lineSpacing=e,this.updateLayoutAutomatically())}insertCell(e,t){assert&&assert(e>=0),assert&&assert(e<=this.cells.length),assert&&assert(!_.includes(this.cells,t)),t.orientation=this.orientation,this.cells.splice(e,0,t),this.addNode(t.node),t.changedEmitter.addListener(this._updateLayoutListener),this.updateLayoutAutomatically()}removeCell(e){assert&&assert(_.includes(this.cells,e)),arrayRemove(this.cells,e),this.removeNode(e.node),e.changedEmitter.removeListener(this._updateLayoutListener),this.updateLayoutAutomatically()}reorderCells(e,t,n){this.cells.splice(t,n-t+1,...e),this.updateLayoutAutomatically()}getPreferredProperty(e){return e===Orientation.HORIZONTAL?this.preferredWidthProperty:this.preferredHeightProperty}dispose(){this.lock(),this.cells.forEach(e=>this.removeCell(e)),this.displayedCells=[],super.dispose(),this.unlock()}static create(e,t){return new FlowConstraint(e,t)}}scenery.register("FlowConstraint",FlowConstraint);const FLOWBOX_OPTION_KEYS=[...LAYOUT_NODE_OPTION_KEYS,...FLOW_CONSTRAINT_OPTION_KEYS.filter(o=>o!=="excludeInvisible")],DEFAULT_OPTIONS$2={orientation:"horizontal",spacing:0,align:"center",stretch:!1},Ln=class Ln extends LayoutNode{constructor(e){const t=optionize()({excludeInvisibleChildrenFromBounds:!0,resize:!0,disabledOpacity:SceneryConstants.DISABLED_OPACITY},e);super(),this._cellMap=new Map,this._constraint=new FlowConstraint(this,{preferredWidthProperty:this.localPreferredWidthProperty,preferredHeightProperty:this.localPreferredHeightProperty,minimumWidthProperty:this.localMinimumWidthProperty,minimumHeightProperty:this.localMinimumHeightProperty,layoutOriginProperty:this.layoutOriginProperty,orientation:DEFAULT_OPTIONS$2.orientation,spacing:DEFAULT_OPTIONS$2.spacing,align:DEFAULT_OPTIONS$2.align,stretch:DEFAULT_OPTIONS$2.stretch,excludeInvisible:!1}),this.onChildInserted=this.onFlowBoxChildInserted.bind(this),this.onChildRemoved=this.onFlowBoxChildRemoved.bind(this),this.onChildrenReordered=this.onFlowBoxChildrenReordered.bind(this),this.onChildrenChanged=this.onFlowBoxChildrenChanged.bind(this),this.childInsertedEmitter.addListener(this.onChildInserted),this.childRemovedEmitter.addListener(this.onChildRemoved),this.childrenReorderedEmitter.addListener(this.onChildrenReordered),this.childrenChangedEmitter.addListener(this.onChildrenChanged);const n=_.omit(t,REQUIRES_BOUNDS_OPTION_KEYS),r=_.pick(t,REQUIRES_BOUNDS_OPTION_KEYS);this._constraint.lock(),this.mutate(n),this._constraint.unlock(),this._constraint.updateLayout(),this.mutate(r),this.linkLayoutBounds()}onFlowBoxChildInserted(e,t){const n=new FlowCell(this._constraint,e,this._constraint.createLayoutProxy(e));this._cellMap.set(e,n),this._constraint.insertCell(t,n)}onFlowBoxChildRemoved(e){const t=this._cellMap.get(e);assert&&assert(t),this._cellMap.delete(e),this._constraint.removeCell(t),t.dispose()}onFlowBoxChildrenReordered(e,t){this._constraint.reorderCells(this._children.slice(e,t+1).map(n=>this._cellMap.get(n)),e,t)}onFlowBoxChildrenChanged(){this._constraint.updateLayoutAutomatically()}getCell(e){const t=this._cellMap.get(e);return assert&&assert(t),t}get orientation(){return this._constraint.orientation}set orientation(e){this._constraint.orientation=e}get spacing(){return this._constraint.spacing}set spacing(e){this._constraint.spacing=e}get lineSpacing(){return this._constraint.lineSpacing}set lineSpacing(e){this._constraint.lineSpacing=e}get justify(){return this._constraint.justify}set justify(e){this._constraint.justify=e}get justifyLines(){return this._constraint.justifyLines}set justifyLines(e){this._constraint.justifyLines=e}get wrap(){return this._constraint.wrap}set wrap(e){this._constraint.wrap=e}get align(){return assert&&assert(typeof this._constraint.align=="string"),this._constraint.align}set align(e){this._constraint.align=e}get stretch(){return assert&&assert(typeof this._constraint.stretch=="boolean"),this._constraint.stretch}set stretch(e){this._constraint.stretch=e}get grow(){return this._constraint.grow}set grow(e){this._constraint.grow=e}get margin(){return this._constraint.margin}set margin(e){this._constraint.margin=e}get xMargin(){return this._constraint.xMargin}set xMargin(e){this._constraint.xMargin=e}get yMargin(){return this._constraint.yMargin}set yMargin(e){this._constraint.yMargin=e}get leftMargin(){return this._constraint.leftMargin}set leftMargin(e){this._constraint.leftMargin=e}get rightMargin(){return this._constraint.rightMargin}set rightMargin(e){this._constraint.rightMargin=e}get topMargin(){return this._constraint.topMargin}set topMargin(e){this._constraint.topMargin=e}get bottomMargin(){return this._constraint.bottomMargin}set bottomMargin(e){this._constraint.bottomMargin=e}get minContentWidth(){return this._constraint.minContentWidth}set minContentWidth(e){this._constraint.minContentWidth=e}get minContentHeight(){return this._constraint.minContentHeight}set minContentHeight(e){this._constraint.minContentHeight=e}get maxContentWidth(){return this._constraint.maxContentWidth}set maxContentWidth(e){this._constraint.maxContentWidth=e}get maxContentHeight(){return this._constraint.maxContentHeight}set maxContentHeight(e){this._constraint.maxContentHeight=e}dispose(){this._constraint.lock(),this.childInsertedEmitter.removeListener(this.onChildInserted),this.childRemovedEmitter.removeListener(this.onChildRemoved),this.childrenReorderedEmitter.removeListener(this.onChildrenReordered),this.childrenChangedEmitter.removeListener(this.onChildrenChanged);for(const e of this._cellMap.values())e.dispose();super.dispose()}setOrientation(e){return this.orientation=e,this}getOrientation(){return this.orientation}setSpacing(e){return this.spacing=e,this}getSpacing(){return this.spacing}setAlign(e){return this.align=e,this}getAlign(){return this.align}setResize(e){return this.resize=e,this}isResize(){return this.resize}getHelperNode(){return MarginLayoutCell.createHelperNode(this.constraint.displayedCells,this.constraint.layoutBoundsProperty.value,t=>{let n="";const r=Orientation.fromLayoutOrientation(t.orientation);return n+=`align: ${LayoutAlign.internalToAlign(r,t.effectiveAlign)}
`,n+=`stretch: ${t.effectiveStretch}
`,n+=`grow: ${t.effectiveGrow}
`,n})}mutate(e){return super.mutate(e)}};Ln.DEFAULT_FLOW_BOX_OPTIONS=DEFAULT_OPTIONS$2;let FlowBox=Ln;FlowBox.prototype._mutatorKeys=[...SIZABLE_OPTION_KEYS,...FLOWBOX_OPTION_KEYS,...Node$2.prototype._mutatorKeys];scenery.register("FlowBox",FlowBox);const GRID_CONFIGURABLE_OPTION_KEYS=["xAlign","yAlign","stretch","xStretch","yStretch","grow","xGrow","yGrow"].concat(MARGIN_LAYOUT_CONFIGURABLE_OPTION_KEYS),GridConfigurable=memoize(o=>class extends MarginLayoutConfigurable(o){constructor(...t){super(...t),this._xAlign=null,this._yAlign=null,this._xStretch=null,this._yStretch=null,this._xGrow=null,this._yGrow=null}mutateConfigurable(t){super.mutateConfigurable(t),assertMutuallyExclusiveOptions(t,["stretch"],["xStretch","yStretch"]),assertMutuallyExclusiveOptions(t,["grow"],["xGrow","yGrow"]),mutate(this,GRID_CONFIGURABLE_OPTION_KEYS,t)}setConfigToBaseDefault(){this._xAlign=LayoutAlign.CENTER,this._yAlign=LayoutAlign.CENTER,this._xStretch=!1,this._yStretch=!1,this._xGrow=0,this._yGrow=0,super.setConfigToBaseDefault()}setConfigToInherit(){this._xAlign=null,this._yAlign=null,this._xStretch=null,this._yStretch=null,this._xGrow=null,this._yGrow=null,super.setConfigToInherit()}get xAlign(){const t=this._xAlign===null?null:this._xAlign.horizontal;return assert&&assert(t===null||typeof t=="string"),t}set xAlign(t){assert&&assert(t===null||HorizontalLayoutAlignValues.includes(t),`align ${t} not supported, the valid values are ${HorizontalLayoutAlignValues} or null`);const n=LayoutAlign.horizontalAlignToInternal(t);assert&&assert(n===null||n instanceof LayoutAlign),this._xAlign!==n&&(this._xAlign=n,this.changedEmitter.emit())}get yAlign(){const t=this._yAlign===null?null:this._yAlign.vertical;return assert&&assert(t===null||typeof t=="string"),t}set yAlign(t){assert&&assert(t===null||VerticalLayoutAlignValues.includes(t),`align ${t} not supported, the valid values are ${VerticalLayoutAlignValues} or null`);const n=LayoutAlign.verticalAlignToInternal(t);assert&&assert(n===null||n instanceof LayoutAlign),this._yAlign!==n&&(this._yAlign=n,this.changedEmitter.emit())}get grow(){return assert&&assert(this._xGrow===this._yGrow),this._xGrow}set grow(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)&&t>=0),(this._xGrow!==t||this._yGrow!==t)&&(this._xGrow=t,this._yGrow=t,this.changedEmitter.emit())}get xGrow(){return this._xGrow}set xGrow(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)&&t>=0),this._xGrow!==t&&(this._xGrow=t,this.changedEmitter.emit())}get yGrow(){return this._yGrow}set yGrow(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)&&t>=0),this._yGrow!==t&&(this._yGrow=t,this.changedEmitter.emit())}get stretch(){return assert&&assert(this._xStretch===this._yStretch),this._xStretch}set stretch(t){assert&&assert(t===null||typeof t=="boolean"),(this._xStretch!==t||this._yStretch!==t)&&(this._xStretch=t,this._yStretch=t,this.changedEmitter.emit())}get xStretch(){return this._xStretch}set xStretch(t){assert&&assert(t===null||typeof t=="boolean"),this._xStretch!==t&&(this._xStretch=t,this.changedEmitter.emit())}get yStretch(){return this._yStretch}set yStretch(t){assert&&assert(t===null||typeof t=="boolean"),this._yStretch!==t&&(this._yStretch=t,this.changedEmitter.emit())}});scenery.register("GridConfigurable",GridConfigurable);const GRID_CELL_KEYS=[...GRID_CONFIGURABLE_OPTION_KEYS,"row","column","horizontalSpan","verticalSpan"];class GridCell extends GridConfigurable(MarginLayoutCell){constructor(e,t,n){super(e,t,n),this.gridConstraint=e,this.setOptions(t.layoutOptions),this.onLayoutOptionsChange()}get effectiveXAlign(){return this._xAlign!==null?this._xAlign:this.gridConstraint._xAlign}get effectiveYAlign(){return this._yAlign!==null?this._yAlign:this.gridConstraint._yAlign}getEffectiveAlign(e){return e===Orientation.HORIZONTAL?this.effectiveXAlign:this.effectiveYAlign}get effectiveXGrow(){return this._xGrow!==null?this._xGrow:this.gridConstraint._xGrow}get effectiveYGrow(){return this._yGrow!==null?this._yGrow:this.gridConstraint._yGrow}getEffectiveGrow(e){return e===Orientation.HORIZONTAL?this.effectiveXGrow:this.effectiveYGrow}get effectiveXStretch(){return this._xStretch!==null?this._xStretch:this.gridConstraint._xStretch}get effectiveYStretch(){return this._yStretch!==null?this._yStretch:this.gridConstraint._yStretch}getEffectiveStretch(e){return e===Orientation.HORIZONTAL?this.effectiveXStretch:this.effectiveYStretch}onLayoutOptionsChange(){this.setOptions(this.node.layoutOptions),super.onLayoutOptionsChange()}setOptions(e){const t=optionize()({column:0,row:0,horizontalSpan:1,verticalSpan:1},e);assert&&Object.keys(t).forEach(n=>{assert&&assert(GRID_CELL_KEYS.includes(n),`Cannot provide key ${n} to a GridCell's layoutOptions. Perhaps this is a Flow-style layout option?`)}),assert&&assert(typeof t.column=="number"&&Number.isInteger(t.column)&&isFinite(t.column)&&t.column>=0),assert&&assert(typeof t.row=="number"&&Number.isInteger(t.row)&&isFinite(t.row)&&t.row>=0),assert&&assert(typeof t.horizontalSpan=="number"&&Number.isInteger(t.horizontalSpan)&&isFinite(t.horizontalSpan)&&t.horizontalSpan>=1),assert&&assert(typeof t.verticalSpan=="number"&&Number.isInteger(t.verticalSpan)&&isFinite(t.verticalSpan)&&t.verticalSpan>=1),this.setConfigToInherit(),this.position=new OrientationPair(t.column,t.row),this.size=new OrientationPair(t.horizontalSpan,t.verticalSpan),this.mutateConfigurable(t)}containsIndex(e,t){const n=this.position.get(e),r=this.size.get(e);return t>=n&&t<n+r}containsRow(e){return this.containsIndex(Orientation.VERTICAL,e)}containsColumn(e){return this.containsIndex(Orientation.HORIZONTAL,e)}getIndices(e){const t=this.position.get(e),n=this.size.get(e);return _.range(t,t+n)}}scenery.register("GridCell",GridCell);const As=class As extends LayoutLine{constructor(e,t,n){super(),this.initialize(e,t,n)}initialize(e,t,n){return this.index=e,this.cells=t,this.grow=n,this.initializeLayoutLine(),this}freeToPool(){As.pool.freeToPool(this)}clean(){this.cells.length=0,this.freeToPool()}};As.pool=new Pool(As,{defaultArguments:[0,[],0]});let GridLine=As;scenery.register("GridLine",GridLine);const GRID_CONSTRAINT_OPTION_KEYS=[...GRID_CONFIGURABLE_OPTION_KEYS,"excludeInvisible","spacing","xSpacing","ySpacing"];class GridConstraint extends GridConfigurable(NodeLayoutConstraint){constructor(e,t){super(e,t),this.cells=new Set,this.displayedCells=[],this.displayedLines=new OrientationPair(new Map,new Map),this._spacing=new OrientationPair(0,0),this.setConfigToBaseDefault(),this.mutateConfigurable(t),mutate(this,GRID_CONSTRAINT_OPTION_KEYS,t),this.changedEmitter.addListener(this._updateLayoutListener)}layout(){super.layout();const e=this.filterLayoutCells([...this.cells]);if(this.displayedCells=e,!e.length){this.layoutBoundsProperty.value=Bounds2.NOTHING,this.minimumWidthProperty.value=null,this.minimumHeightProperty.value=null,this.displayedLines.forEach(s=>s.clear());return}const t=new OrientationPair(0,0),n=new OrientationPair(this.preferredWidthProperty.value,this.preferredHeightProperty.value),r=new Bounds2(0,0,0,0);[Orientation.HORIZONTAL,Orientation.VERTICAL].forEach(s=>{const a=this._spacing.get(s),h=this.displayedLines.get(s);h.forEach(M=>M.clean()),h.clear();const d=_.sortedUniq(_.sortBy(_.flatten(e.map(M=>M.getIndices(s))))).map(M=>{const N=_.filter(e,ie=>ie.containsIndex(s,M)),F=Math.max(...N.map(ie=>ie.getEffectiveGrow(s))),G=GridLine.pool.create(M,N,F);return h.set(M,G),G}),y=d.slice(0,-1).map(M=>typeof a=="number"?a:a[M.index]);e.forEach(M=>{if(M.size.get(s)===1){const N=h.get(M.position.get(s));if(N.min=Math.max(N.min,M.getMinimumSize(s)),N.max=Math.min(N.max,M.getMaximumSize(s)),M.getEffectiveAlign(s)===LayoutAlign.ORIGIN){const F=M.getOriginBounds();N.minOrigin=Math.min(F[s.minCoordinate],N.minOrigin),N.maxOrigin=Math.max(F[s.maxCoordinate],N.maxOrigin)}}}),e.forEach(M=>{if(M.size.get(s)>1){assert&&assert(M.getEffectiveAlign(s)!==LayoutAlign.ORIGIN,"origin alignment cannot be specified for cells that span >1 width or height");const N=M.getIndices(s).map(ie=>h.get(ie)),F=_.sum(N.map(ie=>ie.min)),G=M.getMinimumSize(s);if(G>F){const ie=(G-F)/N.length;N.forEach(Z=>{Z.min+=ie})}}}),d.forEach(M=>{M.hasOrigin()?M.size=Math.max(M.min,M.maxOrigin-M.minOrigin):M.size=M.min});const g=_.sum(d.map(M=>M.size))+_.sum(y);t.set(s,g);const D=Math.max(g,n.get(s)||0);let O=D-g,V;for(;O>1e-7&&(V=d.filter(M=>M.grow>0&&M.size<M.max-1e-7)).length;){const M=_.sum(V.map(F=>F.grow)),N=Math.min(Math.min(...V.map(F=>(F.max-F.size)/F.grow)),O/M);assert&&assert(N>1e-11),V.forEach(F=>{F.size+=N*F.grow}),O-=N*M}const k=(d[0].hasOrigin()?d[0].minOrigin:0)+this.layoutOriginProperty.value[s.coordinate];r[s.minCoordinate]=k,r[s.maxCoordinate]=k+D,d.forEach((M,N)=>{const F=_.sum(d.slice(0,N).map(ie=>ie.size)),G=_.sum(y.slice(0,N));M.position=k+F+G}),e.forEach(M=>{const N=M.position.get(s),F=M.size.get(s),G=N+F-1,ie=M.getIndices(s).map(le=>h.get(le)),Z=h.get(N);let W=0;N!==G&&d.slice(0,-1).forEach((le,pe)=>{le.index>=N&&le.index<G&&(W+=y[pe])});const X=_.sum(ie.map(le=>le.size))+W,J=Z.position,oe=M.reposition(s,X,J,M.getEffectiveStretch(s),-Z.minOrigin,M.getEffectiveAlign(s));r[s.minCoordinate]=Math.min(r[s.minCoordinate],oe[s.minCoordinate]),r[s.maxCoordinate]=Math.max(r[s.maxCoordinate],oe[s.maxCoordinate])})}),this.layoutBoundsProperty.value=r,this.minimumWidthProperty.value=t.horizontal,this.minimumHeightProperty.value=t.vertical,this.finishedLayoutEmitter.emit()}get spacing(){return assert&&assert(this.xSpacing===this.ySpacing),this.xSpacing}set spacing(e){assert&&assert(typeof e=="number"&&isFinite(e)&&e>=0||Array.isArray(e)&&_.every(e,t=>typeof t=="number"&&isFinite(t)&&t>=0)),(this._spacing.get(Orientation.HORIZONTAL)!==e||this._spacing.get(Orientation.VERTICAL)!==e)&&(this._spacing.set(Orientation.HORIZONTAL,e),this._spacing.set(Orientation.VERTICAL,e),this.updateLayoutAutomatically())}get xSpacing(){return this._spacing.get(Orientation.HORIZONTAL)}set xSpacing(e){assert&&assert(typeof e=="number"&&isFinite(e)&&e>=0||Array.isArray(e)&&_.every(e,t=>typeof t=="number"&&isFinite(t)&&t>=0)),this._spacing.get(Orientation.HORIZONTAL)!==e&&(this._spacing.set(Orientation.HORIZONTAL,e),this.updateLayoutAutomatically())}get ySpacing(){return this._spacing.get(Orientation.VERTICAL)}set ySpacing(e){assert&&assert(typeof e=="number"&&isFinite(e)&&e>=0||Array.isArray(e)&&_.every(e,t=>typeof t=="number"&&isFinite(t)&&t>=0)),this._spacing.get(Orientation.VERTICAL)!==e&&(this._spacing.set(Orientation.VERTICAL,e),this.updateLayoutAutomatically())}addCell(e){assert&&assert(!this.cells.has(e)),this.cells.add(e),this.addNode(e.node),e.changedEmitter.addListener(this._updateLayoutListener),this.updateLayoutAutomatically()}removeCell(e){assert&&assert(this.cells.has(e)),this.cells.delete(e),this.removeNode(e.node),e.changedEmitter.removeListener(this._updateLayoutListener),this.updateLayoutAutomatically()}dispose(){this.lock(),[...this.cells].forEach(e=>this.removeCell(e)),this.displayedLines.forEach(e=>e.clear()),this.displayedCells=[],super.dispose(),this.unlock()}getIndices(e){const t=[];return this.cells.forEach(n=>{t.push(...n.getIndices(e))}),_.sortedUniq(_.sortBy(t))}getCell(e,t){return _.find([...this.cells],n=>n.containsRow(e)&&n.containsColumn(t))||null}getCellFromNode(e){return _.find([...this.cells],t=>t.node===e)||null}getCells(e,t){return _.filter([...this.cells],n=>n.containsIndex(e,t))}static create(e,t){return new GridConstraint(e,t)}}scenery.register("GridConstraint",GridConstraint);const GRIDBOX_OPTION_KEYS=[...LAYOUT_NODE_OPTION_KEYS,...GRID_CONSTRAINT_OPTION_KEYS.filter(o=>o!=="excludeInvisible"),"rows","columns","autoRows","autoColumns"];class GridBox extends LayoutNode{constructor(e){const t=optionize()({excludeInvisibleChildrenFromBounds:!0,resize:!0},e);super(),this._cellMap=new Map,this._autoRows=null,this._autoColumns=null,this._autoLockCount=0,this._constraint=new GridConstraint(this,{preferredWidthProperty:this.localPreferredWidthProperty,preferredHeightProperty:this.localPreferredHeightProperty,minimumWidthProperty:this.localMinimumWidthProperty,minimumHeightProperty:this.localMinimumHeightProperty,layoutOriginProperty:this.layoutOriginProperty,excludeInvisible:!1}),this.onChildInserted=this.onGridBoxChildInserted.bind(this),this.onChildRemoved=this.onGridBoxChildRemoved.bind(this),this.onChildVisibilityToggled=this.updateAllAutoLines.bind(this),this.childInsertedEmitter.addListener(this.onChildInserted),this.childRemovedEmitter.addListener(this.onChildRemoved);const n=_.omit(t,REQUIRES_BOUNDS_OPTION_KEYS),r=_.pick(t,REQUIRES_BOUNDS_OPTION_KEYS);this._constraint.lock(),this.mutate(n),this._constraint.unlock(),this._constraint.updateLayout(),this.mutate(r),this.linkLayoutBounds()}setLines(e,t){const n=[];for(let r=0;r<t.length;r++){const s=t[r];for(let a=0;a<s.length;a++){const h=s[a];h!==null&&(n.push(h),h.mutateLayoutOptions({[e.line]:r,[e.opposite.line]:a}))}}this.children=n}getLines(e){const t=[];for(const n of this._cellMap.values()){const r=n.position.get(e),s=n.position.get(e.opposite);for(;t.length<r+1;)t.push([]);for(;t[r].length<s+1;)t[r].push(null);t[r][s]=n.node}return t}set rows(e){this.setLines(Orientation.VERTICAL,e)}get rows(){return this.getLines(Orientation.VERTICAL)}set columns(e){this.setLines(Orientation.HORIZONTAL,e)}get columns(){return this.getLines(Orientation.HORIZONTAL)}getNodeAt(e,t){const n=this.constraint.getCell(e,t);return n?n.node:null}getRowOfNode(e){return assert&&assert(this.children.includes(e)),this.constraint.getCellFromNode(e).position.vertical}getColumnOfNode(e){return assert&&assert(this.children.includes(e)),this.constraint.getCellFromNode(e).position.horizontal}getNodesInRow(e){return this.constraint.getCells(Orientation.VERTICAL,e).map(t=>t.node)}getNodesInColumn(e){return this.constraint.getCells(Orientation.HORIZONTAL,e).map(t=>t.node)}addRow(e){return this.rows=[...this.rows,e],this}addColumn(e){return this.columns=[...this.columns,e],this}insertRow(e,t){return this.rows=[...this.rows.slice(0,e),t,...this.rows.slice(e)],this}insertColumn(e,t){return this.columns=[...this.columns.slice(0,e),t,...this.columns.slice(e)],this}removeRow(e){return this.rows=[...this.rows.slice(0,e),...this.rows.slice(e+1)],this}removeColumn(e){return this.columns=[...this.columns.slice(0,e),...this.columns.slice(e+1)],this}set autoRows(e){assert&&assert(e===null||typeof e=="number"&&isFinite(e)&&e>=1),this._autoRows!==e&&(this._autoRows=e,this.updateAutoRows())}get autoRows(){return this._autoRows}set autoColumns(e){assert&&assert(e===null||typeof e=="number"&&isFinite(e)&&e>=1),this._autoColumns!==e&&(this._autoColumns=e,this.updateAutoColumns())}get autoColumns(){return this._autoColumns}updateAutoLines(e,t){if(t!==null&&this._autoLockCount===0){let n=0;this.constraint.lock(),this.children.filter(r=>r.bounds.isValid()&&(!this._constraint.excludeInvisible||r.visible)).forEach((r,s)=>{const a=s%t,h=Math.floor(s/t);(!r.layoutOptions||r.layoutOptions[e.line]!==a||r.layoutOptions[e.opposite.line]!==h||r.layoutOptions.horizontalSpan!==1||r.layoutOptions.verticalSpan!==1)&&(n++,r.mutateLayoutOptions({[e.line]:s%t,[e.opposite.line]:Math.floor(s/t),horizontalSpan:1,verticalSpan:1}))}),this.constraint.unlock(),n>0&&this.constraint.updateLayoutAutomatically()}}updateAutoRows(){this.updateAutoLines(Orientation.VERTICAL,this.autoRows)}updateAutoColumns(){this.updateAutoLines(Orientation.HORIZONTAL,this.autoColumns)}updateAllAutoLines(){assert&&assert(this._autoRows===null||this._autoColumns===null,"autoRows and autoColumns should not both be set when updating children"),this.updateAutoRows(),this.updateAutoColumns()}setChildren(e){const t=this.getChildren();return this._autoLockCount++,super.setChildren(e),this._autoLockCount--,_.isEqual(t,e)||this.updateAllAutoLines(),this}onGridBoxChildInserted(e,t){e.visibleProperty.lazyLink(this.onChildVisibilityToggled);const n=new GridCell(this._constraint,e,this._constraint.createLayoutProxy(e));this._cellMap.set(e,n),this._constraint.addCell(n),this.updateAllAutoLines()}onGridBoxChildRemoved(e){const t=this._cellMap.get(e);assert&&assert(t),this._cellMap.delete(e),this._constraint.removeCell(t),t.dispose(),this.updateAllAutoLines(),e.visibleProperty.unlink(this.onChildVisibilityToggled)}mutate(e){return assertMutuallyExclusiveOptions(e,["rows"],["columns"],["children","autoRows","autoColumns"]),e&&assert&&assert(typeof e.autoRows!="number"||typeof e.autoColumns!="number","autoRows and autoColumns should not be specified both as non-null at the same time"),super.mutate(e)}get spacing(){return this._constraint.spacing}set spacing(e){this._constraint.spacing=e}get xSpacing(){return this._constraint.xSpacing}set xSpacing(e){this._constraint.xSpacing=e}get ySpacing(){return this._constraint.ySpacing}set ySpacing(e){this._constraint.ySpacing=e}get xAlign(){return this._constraint.xAlign}set xAlign(e){this._constraint.xAlign=e}get yAlign(){return this._constraint.yAlign}set yAlign(e){this._constraint.yAlign=e}get grow(){return this._constraint.grow}set grow(e){this._constraint.grow=e}get xGrow(){return this._constraint.xGrow}set xGrow(e){this._constraint.xGrow=e}get yGrow(){return this._constraint.yGrow}set yGrow(e){this._constraint.yGrow=e}get stretch(){return this._constraint.stretch}set stretch(e){this._constraint.stretch=e}get xStretch(){return this._constraint.xStretch}set xStretch(e){this._constraint.xStretch=e}get yStretch(){return this._constraint.yStretch}set yStretch(e){this._constraint.yStretch=e}get margin(){return this._constraint.margin}set margin(e){this._constraint.margin=e}get xMargin(){return this._constraint.xMargin}set xMargin(e){this._constraint.xMargin=e}get yMargin(){return this._constraint.yMargin}set yMargin(e){this._constraint.yMargin=e}get leftMargin(){return this._constraint.leftMargin}set leftMargin(e){this._constraint.leftMargin=e}get rightMargin(){return this._constraint.rightMargin}set rightMargin(e){this._constraint.rightMargin=e}get topMargin(){return this._constraint.topMargin}set topMargin(e){this._constraint.topMargin=e}get bottomMargin(){return this._constraint.bottomMargin}set bottomMargin(e){this._constraint.bottomMargin=e}get minContentWidth(){return this._constraint.minContentWidth}set minContentWidth(e){this._constraint.minContentWidth=e}get minContentHeight(){return this._constraint.minContentHeight}set minContentHeight(e){this._constraint.minContentHeight=e}get maxContentWidth(){return this._constraint.maxContentWidth}set maxContentWidth(e){this._constraint.maxContentWidth=e}get maxContentHeight(){return this._constraint.maxContentHeight}set maxContentHeight(e){this._constraint.maxContentHeight=e}setExcludeInvisibleChildrenFromBounds(e){super.setExcludeInvisibleChildrenFromBounds(e),this.updateAllAutoLines()}dispose(){this._constraint.lock(),this.childInsertedEmitter.removeListener(this.onChildInserted),this.childRemovedEmitter.removeListener(this.onChildRemoved);for(const e of this._cellMap.values())e.dispose(),e.node.visibleProperty.unlink(this.onChildVisibilityToggled);super.dispose()}getHelperNode(){return MarginLayoutCell.createHelperNode(this.constraint.displayedCells,this.constraint.layoutBoundsProperty.value,t=>{let n="";return n+=`row: ${t.position.vertical}
`,n+=`column: ${t.position.horizontal}
`,t.size.horizontal>1&&(n+=`horizontalSpan: ${t.size.horizontal}
`),t.size.vertical>1&&(n+=`verticalSpan: ${t.size.vertical}
`),n+=`xAlign: ${LayoutAlign.internalToAlign(Orientation.HORIZONTAL,t.effectiveXAlign)}
`,n+=`yAlign: ${LayoutAlign.internalToAlign(Orientation.VERTICAL,t.effectiveYAlign)}
`,n+=`xStretch: ${t.effectiveXStretch}
`,n+=`yStretch: ${t.effectiveYStretch}
`,n+=`xGrow: ${t.effectiveXGrow}
`,n+=`yGrow: ${t.effectiveYGrow}
`,n})}}GridBox.prototype._mutatorKeys=[...SIZABLE_OPTION_KEYS,...GRIDBOX_OPTION_KEYS,...Node$2.prototype._mutatorKeys];scenery.register("GridBox",GridBox);class GridBackgroundNode extends Node$2{constructor(e,t){assertMutuallyExclusiveOptions(t,["createCellBackground"],["fill","stroke"]);const n=s=>Rectangle.bounds(s.lastAvailableBounds,{fill:r.fill,stroke:r.stroke}),r=optionize()({fill:"white",stroke:"black",createCellBackground:n},t);super(),this.constraint=e,this.createCellBackground=r.createCellBackground,this.layoutListener=this.update.bind(this),this.constraint.finishedLayoutEmitter.addListener(this.layoutListener),this.update(),this.mutate(r)}update(){this.children=this.constraint.displayedCells.map(this.createCellBackground).filter(_.identity)}dispose(){this.constraint.finishedLayoutEmitter.removeListener(this.layoutListener),super.dispose()}}scenery.register("GridBackgroundNode",GridBackgroundNode);class ManualConstraint extends LayoutConstraint{constructor(e,t,n){assert&&assert(Array.isArray(t)&&_.every(t,r=>r instanceof Node$2)),super(e),this.lock(),this.nodes=t,this.cells=t.map(r=>new LayoutCell(this,r,null)),this.layoutCallback=n,this.nodes.forEach(r=>this.addNode(r,!1)),this.unlock(),this.updateLayout()}layout(){if(super.layout(),assert&&assert(_.every(this.nodes,t=>!t.isDisposed)),!_.some(this.cells,t=>!t.isConnected())){const t=this.cells.map(n=>n.proxy);this.layoutCallback.apply(null,t),this.finishedLayoutEmitter.emit()}}dispose(){this.cells.forEach(e=>e.dispose()),super.dispose()}static create(e,t,n){return new ManualConstraint(e,t,n)}}scenery.register("ManualConstraint",ManualConstraint);class RelaxedManualConstraint extends LayoutConstraint{constructor(e,t,n){assert&&assert(Array.isArray(t)&&_.every(t,r=>r instanceof Node$2)),super(e),this.lock(),this.nodes=t,this.cells=t.map(r=>new LayoutCell(this,r,null)),this.layoutCallback=n,this.nodes.forEach(r=>this.addNode(r,!1)),this.unlock(),this.updateLayout()}layout(){super.layout(),assert&&assert(_.every(this.nodes,t=>!t.isDisposed));const e=this.cells.map(t=>t.isConnected()?t.proxy:null);this.layoutCallback.apply(null,e),this.finishedLayoutEmitter.emit()}dispose(){this.cells.forEach(e=>e.dispose()),super.dispose()}static create(e,t,n){return new RelaxedManualConstraint(e,t,n)}}scenery.register("RelaxedManualConstraint",RelaxedManualConstraint);const ALIGNMENT_CONTAINER_OPTION_KEYS=["alignBounds","xAlign","yAlign","margin","xMargin","yMargin","leftMargin","rightMargin","topMargin","bottomMargin","group"],AlignBoxXAlignValues=["left","center","right","stretch"],AlignBoxYAlignValues=["top","center","bottom","stretch"],SuperType=Sizable(Node$2);class AlignBox extends SuperType{constructor(e,t){const n=optionize()({children:[e]},t),r={sizable:!1};super(r),this._xSet=!1,this._ySet=!1,this._contentBoundsListener=_.noop,assert&&assert(n===void 0||Object.getPrototypeOf(n)===Object.prototype,"Extra prototype on Node options object is a code smell"),this._content=e,this._alignBounds=null,this._xAlign="center",this._yAlign="center",this._leftMargin=0,this._rightMargin=0,this._topMargin=0,this._bottomMargin=0,this._group=null,this._contentBoundsListener=this.invalidateAlignment.bind(this),this._alignBoundsProperty=null,this._alignBoundsPropertyListener=_.noop,assertMutuallyExclusiveOptions(n,["alignBounds"],["alignBoundsProperty"]),t!=null&&t.alignBoundsProperty&&(this._alignBoundsProperty=t.alignBoundsProperty,n.alignBounds=this._alignBoundsProperty.value,this._alignBoundsPropertyListener=s=>{this.alignBounds=s},this._alignBoundsProperty.lazyLink(this._alignBoundsPropertyListener)),this.localBounds=new Bounds2(0,0,0,0),this.constraint=new AlignBoxConstraint(this,e),this._content.boundsProperty.link(this._contentBoundsListener),this.mutate(n),Multilink.multilink([this.localPreferredWidthProperty,this.localPreferredHeightProperty],(s,a)=>{if(s!==null||a!==null){const h=this._alignBounds||new Bounds2(0,0,0,0);s&&(h.minX=0,h.maxX=s,this._xSet=!0),a&&(h.minY=0,h.maxY=a,this._ySet=!0),this._alignBounds=h,this.constraint.updateLayout()}})}invalidateAlignment(){sceneryLog&&sceneryLog.AlignBox&&sceneryLog.AlignBox(`AlignBox#${this.id} invalidateAlignment`),sceneryLog&&sceneryLog.AlignBox&&sceneryLog.push(),this._group&&this._group.onAlignBoxResized(this),this.constraint.updateLayout(),sceneryLog&&sceneryLog.AlignBox&&sceneryLog.pop()}setAlignBounds(e){return assert&&assert(e===null||e instanceof Bounds2&&!e.isEmpty()&&e.isFinite(),"alignBounds should be a non-empty finite Bounds2"),this._xSet=!0,this._ySet=!0,this._alignBounds!==e&&(!e||!this._alignBounds||!e.equals(this._alignBounds))&&(this._alignBounds=e,this.constraint.updateLayout()),this}set alignBounds(e){this.setAlignBounds(e)}get alignBounds(){return this.getAlignBounds()}getAlignBounds(){return this._alignBounds}setGroup(e){return assert&&assert(e===null||e instanceof AlignGroup,"group should be an AlignGroup"),this._group!==e&&(this._group&&this._group.removeAlignBox(this),this._group=e,this._group&&this._group.addAlignBox(this)),this}set group(e){this.setGroup(e)}get group(){return this.getGroup()}getGroup(){return this._group}setXAlign(e){return assert&&assert(AlignBoxXAlignValues.includes(e),`xAlign should be one of: ${AlignBoxXAlignValues}`),this._xAlign!==e&&(this._xAlign=e,this.invalidateAlignment()),this}set xAlign(e){this.setXAlign(e)}get xAlign(){return this.getXAlign()}getXAlign(){return this._xAlign}setYAlign(e){return assert&&assert(AlignBoxYAlignValues.includes(e),`xAlign should be one of: ${AlignBoxYAlignValues}`),this._yAlign!==e&&(this._yAlign=e,this.invalidateAlignment()),this}set yAlign(e){this.setYAlign(e)}get yAlign(){return this.getYAlign()}getYAlign(){return this._yAlign}setMargin(e){return assert&&assert(isFinite(e)&&e>=0,"margin should be a finite non-negative number"),(this._leftMargin!==e||this._rightMargin!==e||this._topMargin!==e||this._bottomMargin!==e)&&(this._leftMargin=this._rightMargin=this._topMargin=this._bottomMargin=e,this.invalidateAlignment()),this}set margin(e){this.setMargin(e)}get margin(){return this.getMargin()}getMargin(){return assert&&assert(this._leftMargin===this._rightMargin&&this._leftMargin===this._topMargin&&this._leftMargin===this._bottomMargin,"Getting margin does not have a unique result if the left and right margins are different"),this._leftMargin}setXMargin(e){return assert&&assert(isFinite(e)&&e>=0,"xMargin should be a finite non-negative number"),(this._leftMargin!==e||this._rightMargin!==e)&&(this._leftMargin=this._rightMargin=e,this.invalidateAlignment()),this}set xMargin(e){this.setXMargin(e)}get xMargin(){return this.getXMargin()}getXMargin(){return assert&&assert(this._leftMargin===this._rightMargin,"Getting xMargin does not have a unique result if the left and right margins are different"),this._leftMargin}setYMargin(e){return assert&&assert(isFinite(e)&&e>=0,"yMargin should be a finite non-negative number"),(this._topMargin!==e||this._bottomMargin!==e)&&(this._topMargin=this._bottomMargin=e,this.invalidateAlignment()),this}set yMargin(e){this.setYMargin(e)}get yMargin(){return this.getYMargin()}getYMargin(){return assert&&assert(this._topMargin===this._bottomMargin,"Getting yMargin does not have a unique result if the top and bottom margins are different"),this._topMargin}setLeftMargin(e){return assert&&assert(isFinite(e)&&e>=0,"leftMargin should be a finite non-negative number"),this._leftMargin!==e&&(this._leftMargin=e,this.invalidateAlignment()),this}set leftMargin(e){this.setLeftMargin(e)}get leftMargin(){return this.getLeftMargin()}getLeftMargin(){return this._leftMargin}setRightMargin(e){return assert&&assert(isFinite(e)&&e>=0,"rightMargin should be a finite non-negative number"),this._rightMargin!==e&&(this._rightMargin=e,this.invalidateAlignment()),this}set rightMargin(e){this.setRightMargin(e)}get rightMargin(){return this.getRightMargin()}getRightMargin(){return this._rightMargin}setTopMargin(e){return assert&&assert(isFinite(e)&&e>=0,"topMargin should be a finite non-negative number"),this._topMargin!==e&&(this._topMargin=e,this.invalidateAlignment()),this}set topMargin(e){this.setTopMargin(e)}get topMargin(){return this.getTopMargin()}getTopMargin(){return this._topMargin}setBottomMargin(e){return assert&&assert(isFinite(e)&&e>=0,"bottomMargin should be a finite non-negative number"),this._bottomMargin!==e&&(this._bottomMargin=e,this.invalidateAlignment()),this}set bottomMargin(e){this.setBottomMargin(e)}get bottomMargin(){return this.getBottomMargin()}getBottomMargin(){return this._bottomMargin}getContent(){return this._content}get content(){return this.getContent()}getContentBounds(){sceneryLog&&sceneryLog.AlignBox&&sceneryLog.AlignBox(`AlignBox#${this.id} getContentBounds`),sceneryLog&&sceneryLog.AlignBox&&sceneryLog.push();const e=this._content.bounds;return sceneryLog&&sceneryLog.AlignBox&&sceneryLog.pop(),new Bounds2(e.left-this._leftMargin,e.top-this._topMargin,e.right+this._rightMargin,e.bottom+this._bottomMargin)}setAdjustedLocalBounds(e){if(this._xSet&&this._ySet)this.localBounds=e;else if(this._xSet){const t=this.getContentBounds();this.localBounds=new Bounds2(e.minX,t.minY,e.maxX,t.maxY)}else if(this._ySet){const t=this.getContentBounds();this.localBounds=new Bounds2(t.minX,e.minY,t.maxX,e.maxY)}else this.localBounds=this.getContentBounds()}dispose(){this._alignBoundsProperty&&this._alignBoundsProperty.unlink(this._alignBoundsPropertyListener),this._content.boundsProperty.unlink(this._contentBoundsListener),this._content=new Node$2,this.group=null,this.constraint.dispose(),super.dispose()}mutate(e){return super.mutate(e)}}class AlignBoxConstraint extends LayoutConstraint{constructor(e,t){super(e),this.alignBox=e,this.content=t,this.addNode(t),e.isWidthResizableProperty.lazyLink(this._updateLayoutListener),e.isHeightResizableProperty.lazyLink(this._updateLayoutListener)}updateProperty(e,t){const n=this.content[e],r=this.alignBox.localBounds[e]+t;Math.abs(n-r)>1e-5&&(this.content[e]=r)}layout(){super.layout();const e=this.alignBox,t=this.content;if(sceneryLog&&sceneryLog.AlignBox&&sceneryLog.AlignBox(`AlignBoxConstraint#${this.alignBox.id} layout`),sceneryLog&&sceneryLog.AlignBox&&sceneryLog.push(),!t.bounds.isValid())return;const n=e.leftMargin+e.rightMargin,r=e.topMargin+e.bottomMargin;if(e.alignBounds!==null)e.setAdjustedLocalBounds(e.alignBounds);else{const h=t.width+n,c=t.height+r;e.setAdjustedLocalBounds(new Bounds2(0,0,h,c))}const s=isFinite(t.width)?(isWidthSizable(t)?t.minimumWidth||0:t.width)+n:null,a=isFinite(t.height)?(isHeightSizable(t)?t.minimumHeight||0:t.height)+r:null;t.localBounds.isEmpty()||(e.xAlign==="center"?this.updateProperty("centerX",(e.leftMargin-e.rightMargin)/2):e.xAlign==="left"?this.updateProperty("left",e.leftMargin):e.xAlign==="right"?this.updateProperty("right",-e.rightMargin):e.xAlign==="stretch"?(assert&&assert(isWidthSizable(t),"xAlign:stretch can only be used if WidthSizable is mixed into the content"),t.preferredWidth=e.localWidth-e.leftMargin-e.rightMargin,this.updateProperty("left",e.leftMargin)):assert&&assert(`Bad xAlign: ${e.xAlign}`),e.yAlign==="center"?this.updateProperty("centerY",(e.topMargin-e.bottomMargin)/2):e.yAlign==="top"?this.updateProperty("top",e.topMargin):e.yAlign==="bottom"?this.updateProperty("bottom",-e.bottomMargin):e.yAlign==="stretch"?(assert&&assert(isHeightSizable(t),"yAlign:stretch can only be used if HeightSizable is mixed into the content"),t.preferredHeight=e.localHeight-e.topMargin-e.bottomMargin,this.updateProperty("top",e.topMargin)):assert&&assert(`Bad yAlign: ${e.yAlign}`)),sceneryLog&&sceneryLog.AlignBox&&sceneryLog.pop(),e.localMinimumWidth=e.widthSizable?s:e.localWidth,e.localMinimumHeight=e.heightSizable?a:e.localHeight}}AlignBox.prototype._mutatorKeys=ALIGNMENT_CONTAINER_OPTION_KEYS.concat(SuperType.prototype._mutatorKeys);scenery.register("AlignBox",AlignBox);let globalId$2=1;const DEFAULT_OPTIONS$1={matchHorizontal:!0,matchVertical:!0};class AlignGroup extends Disposable{constructor(e){assert&&assert(e===void 0||Object.getPrototypeOf(e)===Object.prototype,"Extra prototype on options object is a code smell");const t=optionize3()({},DEFAULT_OPTIONS$1,e);assert&&assert(typeof t.matchHorizontal=="boolean"),assert&&assert(typeof t.matchVertical=="boolean"),super(t),this._alignBoxes=[],this._matchHorizontal=t.matchHorizontal,this._matchVertical=t.matchVertical,this._resizeLock=!1,this._maxWidthProperty=new NumberProperty(0),this._maxHeightProperty=new NumberProperty(0),this.id=globalId$2++}getMaxWidth(){return this._maxWidthProperty.value}get maxWidth(){return this.getMaxWidth()}getMaxWidthProperty(){return this._maxWidthProperty}get maxWidthProperty(){return this.getMaxWidthProperty()}getMaxHeight(){return this._maxHeightProperty.value}get maxHeight(){return this.getMaxHeight()}getMaxHeightProperty(){return this._maxHeightProperty}get maxHeightProperty(){return this.getMaxHeightProperty()}getMaxSizeProperty(e){return e===Orientation.HORIZONTAL?this._maxWidthProperty:this._maxHeightProperty}createBox(e,t){return new AlignBox(e,combineOptions({group:this},t))}setMatchHorizontal(e){return this._matchHorizontal!==e&&(this._matchHorizontal=e,this.updateLayout()),this}set matchHorizontal(e){this.setMatchHorizontal(e)}get matchHorizontal(){return this.getMatchHorizontal()}getMatchHorizontal(){return this._matchHorizontal}setMatchVertical(e){return this._matchVertical!==e&&(this._matchVertical=e,this.updateLayout()),this}set matchVertical(e){this.setMatchVertical(e)}get matchVertical(){return this.getMatchVertical()}getMatchVertical(){return this._matchVertical}updateLayout(){if(this._resizeLock)return;this._resizeLock=!0,sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.AlignGroup(`AlignGroup#${this.id} updateLayout`),sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.push(),sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.AlignGroup("AlignGroup computing maximum dimension"),sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.push();let e=0,t=0;for(let n=0;n<this._alignBoxes.length;n++){const s=this._alignBoxes[n].getContentBounds();s.isEmpty()||!s.isFinite()||(e=Math.max(e,s.width),t=Math.max(t,s.height))}if(sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.pop(),sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.AlignGroup("AlignGroup applying to boxes"),sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.push(),this._maxWidthProperty.value=e,this._maxHeightProperty.value=t,e>0&&t>0)for(let n=0;n<this._alignBoxes.length;n++)this.setBoxBounds(this._alignBoxes[n],e,t);sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.pop(),sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.pop(),this._resizeLock=!1}setBoxBounds(e,t,n){let r;if(this._matchVertical&&this._matchHorizontal)r=new Bounds2(0,0,t,n);else{const s=e.getContentBounds();this._matchVertical?r=new Bounds2(0,0,isFinite(s.width)?s.width:t,n):this._matchHorizontal?r=new Bounds2(0,0,t,isFinite(s.height)?s.height:n):r=s}e.alignBounds=r}onAlignBoxResized(e){this.updateLayout()}addAlignBox(e){this._alignBoxes.push(e),this.updateLayout()}removeAlignBox(e){arrayRemove(this._alignBoxes,e),this.updateLayout()}dispose(){for(let e=this._alignBoxes.length-1;e>=0;e--)this._alignBoxes[e].dispose();super.dispose()}}scenery.register("AlignGroup",AlignGroup);class HBox extends FlowBox{constructor(e){assert&&assert(!e||!e.orientation,"HBox sets orientation"),super(optionize()({orientation:"horizontal"},e))}onFlowBoxChildInserted(e,t){assert&&assert(!(e instanceof HSeparator),"HSeparator should not be used in an HBox. Use VSeparator instead"),super.onFlowBoxChildInserted(e,t)}mutate(e){return super.mutate(e)}}scenery.register("HBox",HBox);class VBox extends FlowBox{constructor(e){assert&&assert(!e||!e.orientation,"VBox sets orientation"),super(optionize()({orientation:"vertical"},e))}onFlowBoxChildInserted(e,t){assert&&assert(!(e instanceof VSeparator),"VSeparator should not be used in an VBox. Use HSeparator instead"),super.onFlowBoxChildInserted(e,t)}mutate(e){return super.mutate(e)}}scenery.register("VBox",VBox);const isHimalayaElementNode=o=>o.type.toLowerCase()==="element",isHimalayaTextNode=o=>o.type.toLowerCase()==="text",RichTextUtils={scratchText:new Text(""),himalayaGetAttribute(o,e){if(!e)return null;const t=_.find(e.attributes,n=>n.key===o);return t&&t.value||null},himalayaStyleStringToMap(o){const e=o.split(";"),t={};return e.forEach(n=>{if(n.length>0){const r=n.split(":");assert&&assert(r.length===2,"too many colons"),t[r[0].trim()]=r[1].trim()}}),t}};scenery.register("RichTextUtils",RichTextUtils);const RichTextCleanable=memoize(o=>(assert&&assert(_.includes(inheritance(o),Node$2),"Only Node subtypes should mix Paintable"),class extends o{get isCleanable(){return!0}clean(){const t=this;for(let n=t._children.length-1;n>=0;n--){const r=t._children[n];r.isCleanable&&(t.removeChild(r),r.clean())}t.matrix=Matrix3.IDENTITY,t.freeToPool()}}));scenery.register("RichTextCleanable",RichTextCleanable);const vs=class vs extends RichTextCleanable(Node$2){constructor(e){super(),this.initialize(e)}initialize(e){return this.localBounds=new Bounds2(0,0,0,e),this}freeToPool(){vs.pool.freeToPool(this)}};vs.pool=new Pool(vs);let RichTextVerticalSpacer=vs;scenery.register("RichTextVerticalSpacer",RichTextVerticalSpacer);const Ps=class Ps extends RichTextCleanable(Node$2){constructor(e){super(),this.initialize(e)}initialize(e){return this.isLTR=e,this.leftSpacing=0,this.rightSpacing=0,this}addElement(e){const t=this.children.length>0,n=e.width>0,r=e.getScaleVector().x,s=e.leftSpacing*r,a=e.rightSpacing*r;if(!t&&!n)return sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText("No child or element, ignoring"),!1;if(t)if(!n)sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`No element, adding spacing, ltr:${this.isLTR}, spacing: ${s+a}`),this.isLTR?this.rightSpacing+=s+a:this.leftSpacing+=s+a;else return this.isLTR?(sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`LTR add ${this.rightSpacing} + ${s}`),e.left=this.localRight+this.rightSpacing+s,this.rightSpacing=a):(sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`RTL add ${this.leftSpacing} + ${a}`),e.right=this.localLeft-this.leftSpacing-a,this.leftSpacing=s),this.addChild(e),!0;else return sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`First child, ltr:${this.isLTR}, spacing: ${this.isLTR?a:s}`),this.isLTR?(e.left=0,this.leftSpacing=s,this.rightSpacing=a):(e.right=0,this.leftSpacing=s,this.rightSpacing=a),this.addChild(e),!0;return!1}addExtraBeforeSpacing(e){this.isLTR?this.leftSpacing+=e:this.rightSpacing+=e}freeToPool(){Ps.pool.freeToPool(this)}};Ps.pool=new Pool(Ps);let RichTextElement=Ps;scenery.register("RichTextElement",RichTextElement);const _s=class _s extends RichTextCleanable(Text){constructor(e,t,n,r,s,a,h){super(""),this.initialize(e,t,n,r,s,a,h)}initialize(e,t,n,r,s,a,h){let c="";for(;e.startsWith(" ");)c+=" ",e=e.slice(1);let d="";for(;e.endsWith(" ");)d=" ",e=e.slice(0,e.length-1);this.string=RichText.contentToString(e,t),this.boundsMethod=r,this.font=n,this.fill=s,this.stroke=a,this.lineWidth=h;const y=c.length?RichTextUtils.scratchText.setString(c).setFont(n).width:0,g=d.length?RichTextUtils.scratchText.setString(d).setFont(n).width:0;return this.leftSpacing=t?y:g,this.rightSpacing=t?g:y,this}clean(){super.clean(),this.fill=null,this.stroke=null}fitsIn(e,t,n){return this.width+(t?n?this.leftSpacing:this.rightSpacing:0)<=e}freeToPool(){_s.pool.freeToPool(this)}};_s.pool=new Pool(_s);let RichTextLeaf=_s;scenery.register("RichTextLeaf",RichTextLeaf);const Es=class Es extends RichTextCleanable(Node$2){constructor(e){super(),this.leftSpacing=0,this.rightSpacing=0,this.initialize(e)}initialize(e){return this.addChild(e),this}clean(){super.clean(),this.removeAllChildren()}fitsIn(e){return this.width<=e}freeToPool(){Es.pool.freeToPool(this)}};Es.pool=new Pool(Es);let RichTextNode=Es;scenery.register("RichTextNode",RichTextNode);const Ts=class Ts extends Voicing(RichTextCleanable(Node$2)){constructor(e,t){super(),this.fireListener=null,this.accessibleInputListener=null,this.allowLinksListener=null,this.initialize(e,t,!1),this.mutate({cursor:"pointer",tagName:"a"})}initialize(e,t,n=!0){return n&&super.initialize(),this.innerContent=e,this.voicingNameResponse=e,typeof t=="function"?(this.fireListener=new FireListener({fire:t,tandem:Tandem.OPT_OUT}),this.addInputListener(this.fireListener),this.setPDOMAttribute("href","#"),this.setPDOMAttribute("target","_self"),this.accessibleInputListener={click:r=>{r.domEvent&&r.domEvent.preventDefault(),t()}},this.addInputListener(this.accessibleInputListener)):(this.fireListener=new FireListener({fire:r=>{r.isFromPDOM()&&r.domEvent.preventDefault(),self._linkEventsHandled&&r.handle(),openPopup(t)},tandem:Tandem.OPT_OUT}),this.addInputListener(this.fireListener),this.setPDOMAttribute("href",t),this.setPDOMAttribute("target","_blank"),this.allowLinksListener=r=>{this.visible=r},allowLinksProperty.link(this.allowLinksListener)),this}clean(){super.clean(),this.fireListener&&(this.removeInputListener(this.fireListener),this.fireListener.dispose()),this.fireListener=null,this.accessibleInputListener&&(this.removeInputListener(this.accessibleInputListener),this.accessibleInputListener=null),this.allowLinksListener&&(allowLinksProperty.unlink(this.allowLinksListener),this.allowLinksListener=null)}freeToPool(){Ts.pool.freeToPool(this)}};Ts.pool=new Pool(Ts);let RichTextLink=Ts;scenery.register("RichTextLink",RichTextLink);const himalayaVar=himalaya;assert&&assert(himalayaVar,"himalaya dependency needed for RichText.");const RICH_TEXT_OPTION_KEYS=["boundsMethod","font","fill","stroke","lineWidth","subScale","subXSpacing","subYOffset","supScale","supXSpacing","supYOffset","capHeightScale","underlineLineWidth","underlineHeightScale","strikethroughLineWidth","strikethroughHeightScale","linkFill","linkEventsHandled","links","nodes","replaceNewlines","align","leading","lineWrap",Text.STRING_PROPERTY_NAME,"string"],isStringTest=window.QueryStringMachine&&QueryStringMachine.containsKey("stringTest"),DEFAULT_FONT$1=new Font({size:20}),ACCESSIBLE_TAGS=["b","strong","i","em","sub","sup","u","s"],LineBreakState={COMPLETE:"COMPLETE",INCOMPLETE:"INCOMPLETE",NONE:"NONE"},usedLinks=[],usedNodes=[],FONT_STYLE_MAP={"font-family":"family","font-size":"size","font-stretch":"stretch","font-style":"style","font-variant":"variant","font-weight":"weight","line-height":"lineHeight"},FONT_STYLE_KEYS=Object.keys(FONT_STYLE_MAP),STYLE_KEYS=["color"].concat(FONT_STYLE_KEYS),Zt=class Zt extends WidthSizable(Node$2){constructor(e,t){const n=optionize()({fill:"#000000",tandemNameSuffix:"Text",phetioType:Zt.RichTextIO,phetioVisiblePropertyInstrumented:!1},t);typeof e=="string"||typeof e=="number"?n.string=e:n.stringProperty=e,super(),this._font=DEFAULT_FONT$1,this._boundsMethod="hybrid",this._fill="#000000",this._stroke=null,this._lineWidth=1,this._subScale=.75,this._subXSpacing=0,this._subYOffset=0,this._supScale=.75,this._supXSpacing=0,this._supYOffset=0,this._capHeightScale=.75,this._underlineLineWidth=1,this._underlineHeightScale=.15,this._strikethroughLineWidth=1,this._strikethroughHeightScale=.3,this._linkFill="rgb(27,0,241)",this._linkEventsHandled=!1,this._links={},this._nodes={},this._replaceNewlines=!1,this._align="left",this._leading=0,this._lineWrap=null,this._linkItems=[],this._hasAddedLeafToLine=!1,this.needPendingMinimumWidth=!1,this.pendingMinimumWidth=0,this._stringProperty=new TinyForwardingProperty("",!0,this.onStringPropertyChange.bind(this)),this.lineContainer=new Node$2({}),this.addChild(this.lineContainer),this.rebuildRichText(),this.localPreferredWidthProperty.lazyLink(()=>this.rebuildRichText()),this.mutate(n)}onStringPropertyChange(){this.rebuildRichText()}setStringProperty(e){return this._stringProperty.setTargetProperty(e,this,Zt.STRING_PROPERTY_TANDEM_NAME)}set stringProperty(e){this.setStringProperty(e)}get stringProperty(){return this.getStringProperty()}getStringProperty(){return this._stringProperty}getPhetioMouseHitTarget(e=!1){return phetioElementSelectionProperty.value==="string"?this.getStringPropertyPhetioMouseHitTarget(e):super.getPhetioMouseHitTarget(e)}getStringPropertyPhetioMouseHitTarget(e=!1){const t=this._stringProperty.getTargetProperty();return t instanceof PhetioObject?t.getPhetioMouseHitTarget(e):"phetioNotSelectable"}initializePhetioObject(e,t){const n=optionize()({},t),r=this.isPhetioInstrumented();super.initializePhetioObject(e,n),Tandem.PHET_IO_ENABLED&&!r&&this.isPhetioInstrumented()&&this._stringProperty.initializePhetio(this,Zt.STRING_PROPERTY_TANDEM_NAME,()=>new StringProperty(this.string,combineOptions({phetioReadOnly:!0,tandem:this.tandem.createTandem(Zt.STRING_PROPERTY_TANDEM_NAME),phetioDocumentation:"Property for the displayed text"},n.stringPropertyOptions)))}rebuildRichText(){assert&&cleanArray(usedLinks),assert&&cleanArray(usedNodes);const e=this._lineWrap==="stretch";this.widthSizable=e,this.pendingMinimumWidth=0,this.needPendingMinimumWidth=e;const t=this._lineWrap==="stretch"?this.localPreferredWidth:this._lineWrap;if(this.freeChildrenToPool(),this.string===""){this.appendEmptyLeaf();return}sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`RichText#${this.id} rebuild`),sceneryLog&&sceneryLog.RichText&&sceneryLog.push();let n=this.string.replace(/\u202a/g,'<span dir="ltr">').replace(/\u202b/g,'<span dir="rtl">').replace(/\u202c/g,"</span>");this._replaceNewlines&&(n=n.replace(/\n/g,"<br>"));let r;try{r=himalayaVar.parse(n)}catch{r=himalayaVar.parse("INVALID TRANSLATION")}this._linkItems.length=0;const s=t===null?Number.POSITIVE_INFINITY:t,a=!0;let h=RichTextElement.pool.create(a);for(this._hasAddedLeafToLine=!1;r.length;){const c=r[0],d=h.bounds.isValid()?h.width:0,y=this.appendElement(h,c,this._font,this._fill,a,s-d,1);sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`lineBreakState: ${y}`),y!==LineBreakState.NONE&&(h.bounds.isValid()?(sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText("Adding line due to lineBreak"),this.appendLine(h)):this.appendLine(RichTextVerticalSpacer.pool.create(RichTextUtils.scratchText.setString("X").setFont(this._font).height)),h=RichTextElement.pool.create(a),this._hasAddedLeafToLine=!1),y!==LineBreakState.INCOMPLETE&&(sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText("Finished root element"),r.splice(0,1))}for(h.bounds.isValid()&&(sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText("Adding final line"),this.appendLine(h)),this.lineContainer.getChildrenCount()===0&&this.appendEmptyLeaf(),this.alignLines();this._linkItems.length;)(()=>{const c=this._linkItems[0].element,d=this._linkItems[0].href;let y;const g=[];for(y=this._linkItems.length-1;y>=0;y--){const O=this._linkItems[y];O.element===c&&(g.push(O.node),this._linkItems.splice(y,1))}const D=RichTextLink.pool.create(c.innerContent,d);for(this.lineContainer.addChild(D),y=0;y<g.length;y++){const O=g[y],V=O.getUniqueTrailTo(this.lineContainer).getMatrix();O.detach(),O.matrix=V,D.addChild(O)}})();this._linkItems.length=0,assert&&(this._links&&this._links!==!0&&Object.keys(this._links).forEach(c=>{assert&&allowLinksProperty.value&&!isStringTest&&assert(usedLinks.includes(c),`Unused RichText link: ${c}`)}),this._nodes&&Object.keys(this._nodes).forEach(c=>{assert&&allowLinksProperty.value&&!isStringTest&&assert(usedNodes.includes(c),`Unused RichText node: ${c}`)})),this.localMinimumWidth=e?this.pendingMinimumWidth:this.localBounds.width,sceneryLog&&sceneryLog.RichText&&sceneryLog.pop()}freeChildrenToPool(){for(;this.lineContainer._children.length;){const e=this.lineContainer._children[this.lineContainer._children.length-1];this.lineContainer.removeChild(e),e.clean()}}dispose(){this.freeChildrenToPool(),super.dispose(),this._stringProperty.dispose()}appendLine(e){this.lineContainer.bounds.isValid()&&(e.top=this.lineContainer.bottom+this._leading,e.left=0),this.lineContainer.addChild(e)}appendEmptyLeaf(){assert&&assert(this.lineContainer.getChildrenCount()===0),this.appendLine(RichTextLeaf.pool.create("",!0,this._font,this._boundsMethod,this._fill,this._stroke,this._lineWidth))}alignLines(){const e=this._align==="center"?"centerX":this._align,t=this.lineContainer[e];for(let n=0;n<this.lineContainer.getChildrenCount();n++)this.lineContainer.getChildAt(n)[e]=t}appendElement(e,t,n,r,s,a,h){let c=LineBreakState.NONE,d;const y=s?e.rightSpacing:e.leftSpacing,g=a-y;if(isHimalayaTextNode(t)){if(sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`appending leaf: ${t.content}`),sceneryLog&&sceneryLog.RichText&&sceneryLog.push(),d=RichTextLeaf.pool.create(t.content,s,n,this._boundsMethod,r,this._stroke,this._lineWidth),this.needPendingMinimumWidth&&(this.pendingMinimumWidth=Math.max(this.pendingMinimumWidth,Math.max(...getLineBreakRanges(t.content).map(D=>{const O=t.content.slice(D.min,D.max),V=RichTextLeaf.pool.create(O,s,n,this._boundsMethod,r,this._stroke,this._lineWidth),k=V.width*h;return V.dispose(),k})))),!d.fitsIn(g,this._hasAddedLeafToLine,s)){const D=getLineBreakRanges(t.content),O=V=>V.length===0?"":t.content.slice(V[0].min,V[V.length-1].max);if(sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`Overflow leafAdded:${this._hasAddedLeafToLine}, words: ${D.length}`),this._hasAddedLeafToLine||D.length>1){sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText("Skipping words");const V=[];let k=!1;for(V.unshift(D.pop());D.length;)if(d.clean(),d=RichTextLeaf.pool.create(O(D),s,n,this._boundsMethod,r,this._stroke,this._lineWidth),!d.fitsIn(g,this._hasAddedLeafToLine,s)&&(this._hasAddedLeafToLine||D.length>1))sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`Skipping word ${O([D[D.length-1]])}`),V.unshift(D.pop());else{sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`Success with ${O(D)}`),k=!0;break}if(k)c=LineBreakState.INCOMPLETE,t.content=O(V),sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`Remaining content: ${t.content}`);else return d.clean(),LineBreakState.INCOMPLETE}}this._hasAddedLeafToLine=!0,sceneryLog&&sceneryLog.RichText&&sceneryLog.pop()}else if(isHimalayaElementNode(t)){if(t.tagName==="br")return sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText("manual line break"),LineBreakState.COMPLETE;if(t.tagName==="span"){const V=RichTextUtils.himalayaGetAttribute("dir",t);V&&(assert&&assert(V==="ltr"||V==="rtl","Span dir attributes should be ltr or rtl."),s=V==="ltr")}if(t.tagName==="node"){const V=RichTextUtils.himalayaGetAttribute("id",t),k=V&&this._nodes[V]||null;if(assert&&assert(k,V?`Could not find a matching item in RichText's nodes for ${V}. It should be provided in the nodes option`:"No id attribute provided for a given <node> element"),k){if(assert&&usedNodes.push(V),d=RichTextNode.pool.create(k),this._hasAddedLeafToLine&&!d.fitsIn(g))return d.clean(),LineBreakState.INCOMPLETE;const M=RichTextUtils.himalayaGetAttribute("align",t);if(M==="center"||M==="top"||M==="bottom"){const N=RichTextUtils.scratchText.setString("Test").setFont(n).bounds;M==="center"?d.centerY=N.centerY:M==="top"?d.top=N.top:M==="bottom"&&(d.bottom=N.bottom)}}else return c;this._hasAddedLeafToLine=!0}else d=RichTextElement.pool.create(s);sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText("appending element"),sceneryLog&&sceneryLog.RichText&&sceneryLog.push();const D=RichTextUtils.himalayaGetAttribute("style",t);if(D){const V=RichTextUtils.himalayaStyleStringToMap(D);assert&&Object.keys(V).forEach(M=>{assert(_.includes(STYLE_KEYS,M),"See supported style CSS keys")}),V.color&&(r=new Color(V.color));const k={};for(let M=0;M<FONT_STYLE_KEYS.length;M++){const N=FONT_STYLE_KEYS[M];V[N]&&(k[FONT_STYLE_MAP[N]]=V[N])}n=(typeof n=="string"?Font.fromCSS(n):n).copy(k)}if(t.tagName==="a"){let V=RichTextUtils.himalayaGetAttribute("href",t);const k=V;if(V!==null&&this._links!==!0)if(V.startsWith("{{")&&V.indexOf("}}")===V.length-2){const M=V.slice(2,-2);V=this._links[M],assert&&usedLinks.push(M)}else V=null;assert&&assert(V,`Could not find a matching item in RichText's links for ${k}. It should be provided in the links option, or links should be turned to true (to allow the string to create its own urls`),V&&(this._linkFill!==null&&(r=this._linkFill),t.innerContent||(t.innerContent=Zt.himalayaElementToAccessibleString(t,s)),this._linkItems.push({element:t,node:d,href:V}))}else t.tagName==="b"||t.tagName==="strong"?n=(typeof n=="string"?Font.fromCSS(n):n).copy({weight:"bold"}):t.tagName==="i"||t.tagName==="em"?n=(typeof n=="string"?Font.fromCSS(n):n).copy({style:"italic"}):t.tagName==="sub"?(d.scale(this._subScale),d.addExtraBeforeSpacing(this._subXSpacing),d.y+=this._subYOffset):t.tagName==="sup"&&(d.scale(this._supScale),d.addExtraBeforeSpacing(this._supXSpacing),d.y+=this._supYOffset);const O=d.getScaleVector().x;if(t.tagName!=="node"){for(;c===LineBreakState.NONE&&t.children.length;){const V=d.bounds.isValid()?d.width:0,k=t.children[0];c=this.appendElement(d,k,n,r,s,a/O,h*O),c!==LineBreakState.INCOMPLETE&&t.children.splice(0,1);const M=d.bounds.isValid()?d.width:0;a+=V-M}c===LineBreakState.COMPLETE&&t.children.length&&(c=LineBreakState.INCOMPLETE)}if(t.tagName==="sub")isFinite(d.height)&&(d.centerY=0);else if(t.tagName==="sup")isFinite(d.height)&&(d.centerY=RichTextUtils.scratchText.setString("X").setFont(n).top*this._capHeightScale);else if(t.tagName==="u"){const V=-d.top*this._underlineHeightScale;isFinite(d.top)&&d.addChild(new Line(d.localLeft,V,d.localRight,V,{stroke:r,lineWidth:this._underlineLineWidth}))}else if(t.tagName==="s"){const V=d.top*this._strikethroughHeightScale;isFinite(d.top)&&d.addChild(new Line(d.localLeft,V,d.localRight,V,{stroke:r,lineWidth:this._strikethroughLineWidth}))}sceneryLog&&sceneryLog.RichText&&sceneryLog.pop()}return d&&(e.addElement(d)||(this._linkItems=this._linkItems.filter(O=>O.node!==d),d.clean())),c}setString(e){return assert&&assert(e!=null,"String should be defined and non-null. Use the empty string if needed."),e=`${e}`,this._stringProperty.set(e),this}set string(e){this.setString(e)}get string(){return this.getString()}getString(){return this._stringProperty.value}setBoundsMethod(e){return assert&&assert(e==="fast"||e==="fastCanvas"||e==="accurate"||e==="hybrid","Unknown Text boundsMethod"),e!==this._boundsMethod&&(this._boundsMethod=e,this.rebuildRichText()),this}set boundsMethod(e){this.setBoundsMethod(e)}get boundsMethod(){return this.getBoundsMethod()}getBoundsMethod(){return this._boundsMethod}setFont(e){return this._font!==e&&(this._font=e,this.rebuildRichText()),this}set font(e){this.setFont(e)}get font(){return this.getFont()}getFont(){return this._font}setFill(e){return this._fill!==e&&(this._fill=e,this.rebuildRichText()),this}set fill(e){this.setFill(e)}get fill(){return this.getFill()}getFill(){return this._fill}setStroke(e){return this._stroke!==e&&(this._stroke=e,this.rebuildRichText()),this}set stroke(e){this.setStroke(e)}get stroke(){return this.getStroke()}getStroke(){return this._stroke}setLineWidth(e){return this._lineWidth!==e&&(this._lineWidth=e,this.rebuildRichText()),this}set lineWidth(e){this.setLineWidth(e)}get lineWidth(){return this.getLineWidth()}getLineWidth(){return this._lineWidth}setSubScale(e){return assert&&assert(isFinite(e)&&e>0),this._subScale!==e&&(this._subScale=e,this.rebuildRichText()),this}set subScale(e){this.setSubScale(e)}get subScale(){return this.getSubScale()}getSubScale(){return this._subScale}setSubXSpacing(e){return assert&&assert(isFinite(e)),this._subXSpacing!==e&&(this._subXSpacing=e,this.rebuildRichText()),this}set subXSpacing(e){this.setSubXSpacing(e)}get subXSpacing(){return this.getSubXSpacing()}getSubXSpacing(){return this._subXSpacing}setSubYOffset(e){return assert&&assert(isFinite(e)),this._subYOffset!==e&&(this._subYOffset=e,this.rebuildRichText()),this}set subYOffset(e){this.setSubYOffset(e)}get subYOffset(){return this.getSubYOffset()}getSubYOffset(){return this._subYOffset}setSupScale(e){return assert&&assert(isFinite(e)&&e>0),this._supScale!==e&&(this._supScale=e,this.rebuildRichText()),this}set supScale(e){this.setSupScale(e)}get supScale(){return this.getSupScale()}getSupScale(){return this._supScale}setSupXSpacing(e){return assert&&assert(isFinite(e)),this._supXSpacing!==e&&(this._supXSpacing=e,this.rebuildRichText()),this}set supXSpacing(e){this.setSupXSpacing(e)}get supXSpacing(){return this.getSupXSpacing()}getSupXSpacing(){return this._supXSpacing}setSupYOffset(e){return assert&&assert(isFinite(e)),this._supYOffset!==e&&(this._supYOffset=e,this.rebuildRichText()),this}set supYOffset(e){this.setSupYOffset(e)}get supYOffset(){return this.getSupYOffset()}getSupYOffset(){return this._supYOffset}setCapHeightScale(e){return assert&&assert(isFinite(e)&&e>0),this._capHeightScale!==e&&(this._capHeightScale=e,this.rebuildRichText()),this}set capHeightScale(e){this.setCapHeightScale(e)}get capHeightScale(){return this.getCapHeightScale()}getCapHeightScale(){return this._capHeightScale}setUnderlineLineWidth(e){return assert&&assert(isFinite(e)&&e>0),this._underlineLineWidth!==e&&(this._underlineLineWidth=e,this.rebuildRichText()),this}set underlineLineWidth(e){this.setUnderlineLineWidth(e)}get underlineLineWidth(){return this.getUnderlineLineWidth()}getUnderlineLineWidth(){return this._underlineLineWidth}setUnderlineHeightScale(e){return assert&&assert(isFinite(e)&&e>0),this._underlineHeightScale!==e&&(this._underlineHeightScale=e,this.rebuildRichText()),this}set underlineHeightScale(e){this.setUnderlineHeightScale(e)}get underlineHeightScale(){return this.getUnderlineHeightScale()}getUnderlineHeightScale(){return this._underlineHeightScale}setStrikethroughLineWidth(e){return assert&&assert(isFinite(e)&&e>0),this._strikethroughLineWidth!==e&&(this._strikethroughLineWidth=e,this.rebuildRichText()),this}set strikethroughLineWidth(e){this.setStrikethroughLineWidth(e)}get strikethroughLineWidth(){return this.getStrikethroughLineWidth()}getStrikethroughLineWidth(){return this._strikethroughLineWidth}setStrikethroughHeightScale(e){return assert&&assert(isFinite(e)&&e>0),this._strikethroughHeightScale!==e&&(this._strikethroughHeightScale=e,this.rebuildRichText()),this}set strikethroughHeightScale(e){this.setStrikethroughHeightScale(e)}get strikethroughHeightScale(){return this.getStrikethroughHeightScale()}getStrikethroughHeightScale(){return this._strikethroughHeightScale}setLinkFill(e){return this._linkFill!==e&&(this._linkFill=e,this.rebuildRichText()),this}set linkFill(e){this.setLinkFill(e)}get linkFill(){return this.getLinkFill()}getLinkFill(){return this._linkFill}setLinkEventsHandled(e){return this._linkEventsHandled!==e&&(this._linkEventsHandled=e,this.rebuildRichText()),this}set linkEventsHandled(e){this.setLinkEventsHandled(e)}get linkEventsHandled(){return this.getLinkEventsHandled()}getLinkEventsHandled(){return this._linkEventsHandled}setLinks(e){return assert&&assert(e===!0||Object.getPrototypeOf(e)===Object.prototype),this._links!==e&&(this._links=e,this.rebuildRichText()),this}getLinks(){return this._links}set links(e){this.setLinks(e)}get links(){return this.getLinks()}setNodes(e){return assert&&assert(Object.getPrototypeOf(e)===Object.prototype),this._nodes!==e&&(this._nodes=e,this.rebuildRichText()),this}getNodes(){return this._nodes}set nodes(e){this.setNodes(e)}get nodes(){return this.getNodes()}setReplaceNewlines(e){return this._replaceNewlines!==e&&(this._replaceNewlines=e,this.rebuildRichText()),this}set replaceNewlines(e){this.setReplaceNewlines(e)}get replaceNewlines(){return this.getReplaceNewlines()}getReplaceNewlines(){return this._replaceNewlines}setAlign(e){return assert&&assert(e==="left"||e==="center"||e==="right"),this._align!==e&&(this._align=e,this.rebuildRichText()),this}set align(e){this.setAlign(e)}get align(){return this.getAlign()}getAlign(){return this._align}setLeading(e){return assert&&assert(isFinite(e)),this._leading!==e&&(this._leading=e,this.rebuildRichText()),this}set leading(e){this.setLeading(e)}get leading(){return this.getLeading()}getLeading(){return this._leading}setLineWrap(e){return assert&&assert(e===null||e==="stretch"||isFinite(e)&&e>0),this._lineWrap!==e&&(this._lineWrap=e,this.rebuildRichText()),this}set lineWrap(e){this.setLineWrap(e)}get lineWrap(){return this.getLineWrap()}getLineWrap(){return this._lineWrap}mutate(e){return assert&&e&&e.hasOwnProperty("string")&&e.hasOwnProperty(Text.STRING_PROPERTY_NAME)&&e.stringProperty&&assert&&assert(e.stringProperty.value===e.string,"If both string and stringProperty are provided, then values should match"),super.mutate(e)}static stringWithFont(e,t){return`<span style='font-style: ${t.style};font-variant: ${t.variant};font-weight: ${t.weight};font-stretch: ${t.stretch};font-size: ${t.size};font-family: ${t.family};line-height: ${t.lineHeight};'>${e}</span>`}static himalayaElementToString(e,t){if(isHimalayaTextNode(e))return Zt.contentToString(e.content,t);if(isHimalayaElementNode(e)){const n=RichTextUtils.himalayaGetAttribute("dir",e);return e.tagName==="span"&&n&&(t=n==="ltr"),e.children.map(r=>Zt.himalayaElementToString(r,t)).join("")}else return""}static himalayaElementToAccessibleString(e,t){if(isHimalayaTextNode(e))return Zt.contentToString(e.content,t);if(isHimalayaElementNode(e)){const n=RichTextUtils.himalayaGetAttribute("dir",e);e.tagName==="span"&&n&&(t=n==="ltr");const r=e.children.map(s=>Zt.himalayaElementToAccessibleString(s,t)).join("");return _.includes(ACCESSIBLE_TAGS,e.tagName)?`<${e.tagName}>${r}</${e.tagName}>`:r}else return""}static contentToString(e,t){const n=he.decode(e);return t?`‪${n}‬`:`‫${n}‬`}};Zt.STRING_PROPERTY_TANDEM_NAME=Text.STRING_PROPERTY_TANDEM_NAME;let RichText=Zt;RichText.prototype._mutatorKeys=RICH_TEXT_OPTION_KEYS.concat(Node$2.prototype._mutatorKeys);scenery.register("RichText",RichText);RichText.RichTextIO=new IOType("RichTextIO",{valueType:RichText,supertype:Node$2.NodeIO,documentation:"The PhET-iO Type for the scenery RichText node"});class VoicingText extends ReadingBlock(Text){constructor(e,t){const n=optionize()({readingBlockNameResponse:e,tagName:"p",innerContent:e},t);super(e),this.focusHighlight=new ReadingBlockHighlight(this),this.mutate(n)}}scenery.register("VoicingText",VoicingText);class VoicingRichText extends ReadingBlock(RichText){constructor(e,t){const n=optionize()({readingBlockNameResponse:e,innerContent:e,readingBlockTagName:"button"},t);super(e,n),this.focusHighlight=new ReadingBlockHighlight(this)}}scenery.register("VoicingRichText",VoicingRichText);const scenerySerialize=o=>{if(o instanceof Vector2)return{type:"Vector2",x:o.x,y:o.y};if(o instanceof Matrix3)return{type:"Matrix3",m00:o.m00(),m01:o.m01(),m02:o.m02(),m10:o.m10(),m11:o.m11(),m12:o.m12(),m20:o.m20(),m21:o.m21(),m22:o.m22()};if(o instanceof Bounds2){const e=o;return{type:"Bounds2",maxX:e.maxX,maxY:e.maxY,minX:e.minX,minY:e.minY}}else{if(o instanceof Shape$1)return{type:"Shape",path:o.getSVGPath()};if(Array.isArray(o))return{type:"Array",value:o.map(scenerySerialize)};if(o instanceof Color)return{type:"Color",red:o.red,green:o.green,blue:o.blue,alpha:o.alpha};if(o instanceof ReadOnlyProperty)return{type:"Property",value:scenerySerialize(o.value)};if(o instanceof TinyProperty)return{type:"TinyProperty",value:scenerySerialize(o.value)};if(Paint&&o instanceof Paint){const e={};return o.transformMatrix&&(e.transformMatrix=scenerySerialize(o.transformMatrix)),Gradient&&(o instanceof RadialGradient||o instanceof LinearGradient)&&(e.stops=o.stops.map(t=>({ratio:t.ratio,stop:scenerySerialize(t.color)})),e.start=scenerySerialize(o.start),e.end=scenerySerialize(o.end),LinearGradient&&o instanceof LinearGradient?e.type="LinearGradient":RadialGradient&&o instanceof RadialGradient&&(e.type="RadialGradient",e.startRadius=o.startRadius,e.endRadius=o.endRadius)),Pattern&&o instanceof Pattern&&(e.type="Pattern",e.url=o.image.src),e}else if(o instanceof Node$2){const e=o,t={},n={};["visible","opacity","disabledOpacity","pickable","inputEnabled","cursor","transformBounds","renderer","usesOpacity","layerSplit","cssTransform","excludeInvisible","webglScale","preventFit"].forEach(s=>{e[s]!==Node$2.DEFAULT_NODE_OPTIONS[s]&&(t[s]=e[s])}),["tagName","innerContent","accessibleName","helpText"].forEach(s=>{e[s]!==null&&(t[s]=e[s])}),["maxWidth","maxHeight","clipArea","mouseArea","touchArea"].forEach(s=>{e[s]!==Node$2.DEFAULT_NODE_OPTIONS[s]&&(n[s]=scenerySerialize(e[s]))}),e.matrix.isIdentity()||(n.matrix=scenerySerialize(e.matrix)),e._localBoundsOverridden&&(n.localBounds=scenerySerialize(e.localBounds)),n.children=e.children.map(s=>s.id),n.hasInputListeners=e.inputListeners.length>0;const r={id:e.id,type:"Node",types:inheritance(e.constructor).map(s=>s.name).filter(s=>s&&s!=="Object"&&s!=="Node"),name:e.constructor.name,options:t,setup:n};if(Path&&e instanceof Path&&(r.type="Path",n.path=scenerySerialize(e.shape),e.boundsMethod!==Path.DEFAULT_PATH_OPTIONS.boundsMethod&&(t.boundsMethod=e.boundsMethod)),Circle&&e instanceof Circle&&(r.type="Circle",t.radius=e.radius),Line&&e instanceof Line&&(r.type="Line",t.x1=e.x1,t.y1=e.y1,t.x2=e.x2,t.y2=e.y2),Rectangle&&e instanceof Rectangle&&(r.type="Rectangle",t.rectX=e.rectX,t.rectY=e.rectY,t.rectWidth=e.rectWidth,t.rectHeight=e.rectHeight,t.cornerXRadius=e.cornerXRadius,t.cornerYRadius=e.cornerYRadius),Text&&e instanceof Text&&(r.type="Text",e.boundsMethod!=="hybrid"&&(t.boundsMethod=e.boundsMethod),t.string=e.string,t.font=e.font),Image$1&&e instanceof Image$1&&(r.type="Image",["imageOpacity","initialWidth","initialHeight","mipmapBias","mipmapInitialLevel","mipmapMaxLevel"].forEach(s=>{e[s]!==Image$1.DEFAULT_IMAGE_OPTIONS[s]&&(t[s]=e[s])}),n.width=e.imageWidth,n.height=e.imageHeight,e._mipmapData?(n.imageType="mipmapData",n.mipmapData=e._mipmapData.map(s=>({url:s.url,width:s.width,height:s.height}))):(e._mipmap&&(n.generateMipmaps=!0),e._image instanceof HTMLImageElement?(n.imageType="image",n.src=e._image.src):e._image instanceof HTMLCanvasElement&&(n.imageType="canvas",n.src=e._image.toDataURL()))),CanvasNode&&e instanceof CanvasNode||WebGLNode&&e instanceof WebGLNode){r.type=CanvasNode&&e instanceof CanvasNode?"CanvasNode":"WebGLNode",n.canvasBounds=scenerySerialize(e.canvasBounds);const s=1,a=document.createElement("canvas");a.width=Math.ceil(e.canvasBounds.width*s),a.height=Math.ceil(e.canvasBounds.height*s);const h=a.getContext("2d"),c=new CanvasContextWrapper(a,h),d=Matrix3.scale(1/s);c.context.setTransform(s,0,0,s,-e.canvasBounds.left,-e.canvasBounds.top),e.renderToCanvasSelf(c,d),n.url=a.toDataURL(),n.scale=s,n.offset=scenerySerialize(e.canvasBounds.leftTop)}return DOM&&e instanceof DOM&&(r.type="DOM",r.element=new window.XMLSerializer().serializeToString(e.element),e.element instanceof window.HTMLCanvasElement&&(r.dataURL=e.element.toDataURL()),t.preventTransform=e.preventTransform),(Path&&e instanceof Path||Text&&e instanceof Text)&&(["fillPickable","strokePickable","lineWidth","lineCap","lineJoin","lineDashOffset","miterLimit"].forEach(s=>{e[s]!==DEFAULT_OPTIONS$6[s]&&(t[s]=e[s])}),e.fill!==DEFAULT_OPTIONS$6.fill&&(n.fill=scenerySerialize(e.fill)),e.stroke!==DEFAULT_OPTIONS$6.stroke&&(n.stroke=scenerySerialize(e.stroke)),e.lineDash.length&&(n.lineDash=scenerySerialize(e.lineDash))),r}else return o instanceof Display?{type:"Display",width:o.width,height:o.height,backgroundColor:scenerySerialize(o.backgroundColor),tree:{type:"Subtree",rootNodeId:o.rootNode.id,nodes:serializeConnectedNodes(o.rootNode)}}:{type:"value",value:o}}},serializeConnectedNodes=o=>o.getSubtreeNodes().map(scenerySerialize);scenery.register("scenerySerialize",scenerySerialize);const sceneryDeserialize=o=>{const e=["Node","Path","Circle","Line","Rectangle","Text","Image","CanvasNode","WebGLNode","DOM"];if(o.type==="Vector2")return new Vector2(o.x,o.y);if(o.type==="Matrix3")return new Matrix3().rowMajor(o.m00,o.m01,o.m02,o.m10,o.m11,o.m12,o.m20,o.m21,o.m22);if(o.type==="Bounds2")return new Bounds2(o.minX,o.minY,o.maxX,o.maxY);if(o.type==="Shape")return new Shape$1(o.path);if(o.type==="Array")return o.value.map(sceneryDeserialize);if(o.type==="Color")return new Color(o.red,o.green,o.blue,o.alpha);if(o.type==="Property")return new Property(sceneryDeserialize(o.value));if(o.type==="TinyProperty")return new TinyProperty(sceneryDeserialize(o.value));if(o.type==="Pattern"||o.type==="LinearGradient"||o.type==="RadialGradient"){let t;if(o.type==="Pattern"){const n=new window.Image;n.src=o.url,t=new Pattern(n)}else{const n=sceneryDeserialize(o.start),r=sceneryDeserialize(o.end);o.type==="LinearGradient"?t=new LinearGradient(n.x,n.y,r.x,r.y):o.type==="RadialGradient"&&(t=new RadialGradient(n.x,n.y,o.startRadius,r.x,r.y,o.endRadius)),o.stops.forEach(s=>{t.addColorStop(s.ratio,sceneryDeserialize(s.stop))})}return o.transformMatrix&&t.setTransformMatrix(sceneryDeserialize(o.transformMatrix)),t}else if(_.includes(e,o.type)){let t;const n=o.setup;if(o.type==="Node")t=new Node$2;else if(o.type==="Path")t=new Path(sceneryDeserialize(n.path));else if(o.type==="Circle")t=new Circle({});else if(o.type==="Line")t=new Line({});else if(o.type==="Rectangle")t=new Rectangle({});else if(o.type==="Text")t=new Text("");else if(o.type==="Image"){if(n.imageType==="image"||n.imageType==="canvas")t=new Image$1(n.src),n.generateMipmaps&&(t.mipmap=!0);else if(n.imageType==="mipmapData"){const r=n.mipmapData.map(s=>{const a={width:s.width,height:s.height,url:s.url};a.img=new window.Image,a.img.src=s.url,a.canvas=document.createElement("canvas"),a.canvas.width=s.width,a.canvas.height=s.height;const h=a.canvas.getContext("2d");return a.updateCanvas=function(){a.img.complete&&(typeof a.img.naturalWidth>"u"||a.img.naturalWidth>0)&&(h.drawImage(a.img,0,0),delete a.updateCanvas)},a});t=new Image$1(r)}t.initialWidth=n.width,t.initialHeight=n.height}else if(o.type==="CanvasNode"||o.type==="WebGLNode")t=new Node$2({children:[new Image$1(n.url,{translation:sceneryDeserialize(n.offset),scale:1/n.scale})]});else if(o.type==="DOM"){const r=document.createElement("div");r.innerHTML=o.element;const s=r.childNodes[0];if(r.removeChild(s),o.dataURL){const a=new window.Image;a.onload=()=>{s.getContext("2d").drawImage(a,0,0)},a.src=o.dataURL}t=new DOM(s)}return n.clipArea&&(t.clipArea=sceneryDeserialize(n.clipArea)),n.mouseArea&&(t.mouseArea=sceneryDeserialize(n.mouseArea)),n.touchArea&&(t.touchArea=sceneryDeserialize(n.touchArea)),n.matrix&&(t.matrix=sceneryDeserialize(n.matrix)),n.localBounds&&(t.localBounds=sceneryDeserialize(n.localBounds)),n.fill&&(t.fill=sceneryDeserialize(n.fill)),n.stroke&&(t.stroke=sceneryDeserialize(n.stroke)),n.lineDash&&(t.lineDash=sceneryDeserialize(n.lineDash)),t.mutate(o.options),t._serialization=o,t}else if(o.type==="Subtree"){const t={},n=o.nodes.map(sceneryDeserialize);return n.forEach(r=>{t[r._serialization.id]=r}),n.forEach(r=>{r._serialization.setup.children.forEach(s=>{r.addChild(t[s])})}),t[o.rootNodeId]}else return o.type==="value"?o.value:null};scenery.register("sceneryDeserialize",sceneryDeserialize);const sceneryCopy=o=>sceneryDeserialize(scenerySerialize(o));scenery.register("sceneryCopy",sceneryCopy);let globalId$1=1;class Drawable{initialize(e){return assert&&assert(!this.id||this.isDisposed,"If we previously existed, we need to have been disposed"),this.id=this.id||globalId$1++,sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`[${this.constructor.name}*] initialize ${this.toString()}`),this.clean(),this.renderer=e,this.dirty=!0,this.isDisposed=!1,this.linksDirty=!1,this.visibleProperty=new TinyProperty(!0),this.fittableProperty=new TinyProperty(!0),this}clean(){this.parentDrawable=null,this.backbone=null,this.pendingParentDrawable=null,this.pendingBackbone=null,this.pendingAddition=!1,this.pendingRemoval=!1,assert&&assert(!this.previousDrawable&&!this.nextDrawable,"By cleaning (disposal or fresh creation), we should have disconnected from the linked list"),this.previousDrawable=null,this.nextDrawable=null,this.oldPreviousDrawable=null,this.oldNextDrawable=null,this.visibleProperty&&this.visibleProperty.removeAllListeners(),this.fittableProperty&&this.fittableProperty.removeAllListeners()}update(){let e=!1;return this.dirty&&!this.isDisposed&&(this.dirty=!1,e=!0),e}setVisible(e){this.visibleProperty.value=e}set visible(e){this.setVisible(e)}isVisible(){return this.visibleProperty.value}get visible(){return this.isVisible()}setFittable(e){this.fittableProperty.value=e}set fittable(e){this.setFittable(e)}isFittable(){return this.fittableProperty.value}get fittable(){return this.isFittable()}setBlockBackbone(e){sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`[${this.constructor.name}*] setBlockBackbone ${this.toString()} with ${e.toString()}`),assert&&assert(this instanceof Block$1),this.parentDrawable=e,this.backbone=e,this.pendingParentDrawable=e,this.pendingBackbone=e,this.pendingAddition=!1,this.pendingRemoval=!1}notePendingAddition(e,t,n){sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`[${this.constructor.name}*] notePendingAddition ${this.toString()} with ${t.toString()}, ${n?n.toString():"-"}`),assert&&assert(n!==void 0,"backbone can be either null or a backbone"),assert&&assert(t instanceof Block$1),this.pendingParentDrawable=t,this.pendingBackbone=n,this.pendingAddition=!0,this.pendingRemoval||e.markDrawableChangedBlock(this)}notePendingRemoval(e){sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`[${this.constructor.name}*] notePendingRemoval ${this.toString()}`),this.pendingRemoval=!0,this.pendingAddition||e.markDrawableChangedBlock(this)}notePendingMove(e,t){sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`[${this.constructor.name}*] notePendingMove ${this.toString()} with ${t.toString()}`),assert&&assert(t instanceof Block$1),this.pendingParentDrawable=t,(!this.pendingRemoval||!this.pendingAddition)&&e.markDrawableChangedBlock(this),this.pendingAddition=!0,this.pendingRemoval=!0}updateBlock(){sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`[${this.constructor.name}*] updateBlock ${this.toString()} with add:${this.pendingAddition} remove:${this.pendingRemoval} old:${this.parentDrawable?this.parentDrawable.toString():"-"} new:${this.pendingParentDrawable?this.pendingParentDrawable.toString():"-"}`),sceneryLog&&sceneryLog.Drawable&&sceneryLog.push();let e=!1;return(this.pendingRemoval||this.pendingAddition)&&(e=!this.pendingRemoval||!this.pendingAddition||this.parentDrawable!==this.pendingParentDrawable||this.backbone!==this.pendingBackbone,e?(this.pendingRemoval&&(sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`removing from ${this.parentDrawable.toString()}`),this.parentDrawable.removeDrawable(this),this.pendingAddition||(this.pendingParentDrawable=null,this.pendingBackbone=null)),this.parentDrawable=this.pendingParentDrawable,this.backbone=this.pendingBackbone,this.pendingAddition&&(sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`adding to ${this.parentDrawable.toString()}`),this.parentDrawable.addDrawable(this))):(sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable("unchanged"),this.pendingAddition&&Renderer.isCanvas(this.renderer)&&this.parentDrawable.onPotentiallyMovedDrawable(this)),this.pendingAddition=!1,this.pendingRemoval=!1),sceneryLog&&sceneryLog.Drawable&&sceneryLog.pop(),e}updateLinks(){this.oldNextDrawable=this.nextDrawable,this.oldPreviousDrawable=this.previousDrawable,this.linksDirty=!1}markDirty(){this.dirty||(this.dirty=!0,this.parentDrawable&&this.parentDrawable.markDirtyDrawable(this))}markLinksDirty(e){this.linksDirty||(this.linksDirty=!0,e.markDrawableForLinksUpdate(this))}markForDisposal(e){Drawable.disconnectBefore(this,e),Drawable.disconnectAfter(this,e),e.markDrawableForDisposal(this)}disposeImmediately(e){Drawable.disconnectBefore(this,e),Drawable.disconnectAfter(this,e),this.dispose()}dispose(){assert&&assert(!this.isDisposed,"We should not re-dispose drawables"),sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`[${this.constructor.name}*] dispose ${this.toString()}`),sceneryLog&&sceneryLog.Drawable&&sceneryLog.push(),this.clean(),this.isDisposed=!0,this.freeToPool(),sceneryLog&&sceneryLog.Drawable&&sceneryLog.pop()}audit(e,t,n){assertSlow&&(assertSlow&&assertSlow(!this.isDisposed,"If we are being audited, we assume we are in the drawable display tree, and we should not be marked as disposed"),assertSlow&&assertSlow(this.renderer,"Should not have a 0 (no) renderer"),assertSlow&&assertSlow(!this.backbone||this.parentDrawable,"If we have a backbone reference, we must have a parentDrawable (our block)"),e||(assertSlow&&assertSlow(!this.pendingAddition),assertSlow&&assertSlow(!this.pendingRemoval),assertSlow&&assertSlow(this.parentDrawable===this.pendingParentDrawable,"Assure our parent and pending parent match, if we have updated blocks"),assertSlow&&assertSlow(this.backbone===this.pendingBackbone,"Assure our backbone and pending backbone match, if we have updated blocks")),t||(assertSlow&&assertSlow(this.oldPreviousDrawable===this.previousDrawable,"Pending linked-list references should be cleared by now"),assertSlow&&assertSlow(this.oldNextDrawable===this.nextDrawable,"Pending linked-list references should be cleared by now"),assertSlow&&assertSlow(!this.linksDirty,"Links dirty flag should be clean")),n||assertSlow&&assertSlow(!this.dirty,"Should not be dirty at this phase, if we are in the drawable display tree"))}toString(){return`${this.constructor.name}#${this.id}`}toDetailedString(){return this.toString()}static connectDrawables(e,t,n){e.nextDrawable!==t&&(e.nextDrawable&&(e.nextDrawable.markLinksDirty(n),e.nextDrawable.previousDrawable=null),t.previousDrawable&&(t.previousDrawable.markLinksDirty(n),t.previousDrawable.nextDrawable=null),e.nextDrawable=t,t.previousDrawable=e,e.markLinksDirty(n),t.markLinksDirty(n))}static disconnectBefore(e,t){e.previousDrawable&&(e.markLinksDirty(t),e.previousDrawable.markLinksDirty(t),e.previousDrawable.nextDrawable=null,e.previousDrawable=null)}static disconnectAfter(e,t){e.nextDrawable&&(e.markLinksDirty(t),e.nextDrawable.markLinksDirty(t),e.nextDrawable.previousDrawable=null,e.nextDrawable=null)}static listToArray(e,t){const n=[];for(let r=e;n.push(r),r!==t;r=r.nextDrawable);return n}static oldListToArray(e,t){const n=[];for(let r=e;n.push(r),r!==t;r=r.oldNextDrawable);return n}}scenery.register("Drawable",Drawable);class SelfDrawable extends Drawable{constructor(e,t){assert&&assert(typeof e=="number"),assert&&assert(t),super(),this.initialize(e,t)}initialize(e,t){return super.initialize(e),this.drawableVisibilityListener=this.drawableVisibilityListener||this.updateSelfVisibility.bind(this),this.instance=t,this.node=t.trail.lastNode(),this.node.attachDrawable(this),this.instance.selfVisibleEmitter.addListener(this.drawableVisibilityListener),this.updateSelfVisibility(),this}dispose(){this.instance.selfVisibleEmitter.removeListener(this.drawableVisibilityListener),this.node.detachDrawable(this),this.instance=null,this.node=null,super.dispose()}updateSelfVisibility(){this.visible=this.instance.selfVisible}toDetailedString(){return`${this.toString()} (${this.instance.trail.toPathString()})`}}scenery.register("SelfDrawable",SelfDrawable);const PaintableStatelessDrawable=memoize(o=>(assert&&assert(_.includes(inheritance(o),SelfDrawable)),class extends o{initialize(e,t,...n){super.initialize(e,t,...n),this.fillCallback=this.fillCallback||this.markDirtyFill.bind(this),this.strokeCallback=this.strokeCallback||this.markDirtyStroke.bind(this),this.fillObserver=this.fillObserver||new PaintObserver(this.fillCallback),this.strokeObserver=this.strokeObserver||new PaintObserver(this.strokeCallback),this.fillObserver.setPrimary(t.node._fill),this.strokeObserver.setPrimary(t.node._stroke)}dispose(){this.fillObserver.clean(),this.strokeObserver.clean(),super.dispose()}markDirtyFill(){assert&&Color.checkPaint(this.instance.node._fill),this.markPaintDirty(),this.fillObserver.setPrimary(this.instance.node._fill)}markDirtyStroke(){assert&&Color.checkPaint(this.instance.node._stroke),this.markPaintDirty(),this.strokeObserver.setPrimary(this.instance.node._stroke)}markDirtyLineWidth(){this.markPaintDirty()}markDirtyLineOptions(){this.markPaintDirty()}markDirtyCachedPaints(){this.markPaintDirty()}}));scenery.register("PaintableStatelessDrawable",PaintableStatelessDrawable);const PaintableStatelessDrawable$1=PaintableStatelessDrawable,PaintableStatefulDrawable=memoize(o=>(assert&&assert(_.includes(inheritance(o),SelfDrawable)),class extends o{initialize(e,t,...n){super.initialize(e,t,...n),this.dirtyFill=!0,this.hadStroke=!1,this.dirtyStroke=!0,this.dirtyLineWidth=!0,this.dirtyLineOptions=!0,this.dirtyCachedPaints=!0,this.lastCachedPaints=[],this.fillCallback=this.fillCallback||this.markDirtyFill.bind(this),this.strokeCallback=this.strokeCallback||this.markDirtyStroke.bind(this),this.fillObserver=this.fillObserver||new PaintObserver(this.fillCallback),this.strokeObserver=this.strokeObserver||new PaintObserver(this.strokeCallback),this.fillObserver.setPrimary(t.node._fill),this.strokeObserver.setPrimary(t.node._stroke)}cleanPaintableState(){this.dirtyFill=!1,this.dirtyStroke=!1,this.dirtyLineWidth=!1,this.dirtyLineOptions=!1,this.dirtyCachedPaints=!1,this.hadStroke=this.node.getStroke()!==null}dispose(){super.dispose(),this.fillObserver.clean(),this.strokeObserver.clean()}markDirtyFill(){assert&&Color.checkPaint(this.instance.node._fill),this.dirtyFill=!0,this.markPaintDirty(),this.fillObserver.setPrimary(this.instance.node._fill)}markDirtyStroke(){assert&&Color.checkPaint(this.instance.node._stroke),this.dirtyStroke=!0,this.markPaintDirty(),this.strokeObserver.setPrimary(this.instance.node._stroke)}markDirtyLineWidth(){this.dirtyLineWidth=!0,this.markPaintDirty()}markDirtyLineOptions(){this.dirtyLineOptions=!0,this.markPaintDirty()}markDirtyCachedPaints(){this.dirtyCachedPaints=!0,this.markPaintDirty()}}));scenery.register("PaintableStatefulDrawable",PaintableStatefulDrawable);class CanvasSelfDrawable extends SelfDrawable{initialize(e,t){super.initialize(e,t),this.transformListener=this.transformListener||this.markTransformDirty.bind(this),t.relativeTransform.addListener(this.transformListener),t.relativeTransform.addPrecompute()}markTransformDirty(){this.markDirty()}markPaintDirty(){this.markDirty()}updateSelfVisibility(){super.updateSelfVisibility(),this.markDirty()}dispose(){this.instance.relativeTransform.removeListener(this.transformListener),this.instance.relativeTransform.removePrecompute(),super.dispose()}}scenery.register("CanvasSelfDrawable",CanvasSelfDrawable);class DOMSelfDrawable extends SelfDrawable{initialize(e,t){return super.initialize(e,t),this.transformListener=this.transformListener||this.markTransformDirty.bind(this),this.markTransformDirty(),this.visibilityDirty=!0,t.relativeTransform.addListener(this.transformListener),t.relativeTransform.addPrecompute(),this}markTransformDirty(){this.transformDirty=!0,this.markDirty()}getTransformMatrix(){return this.instance.relativeTransform.validate(),this.instance.relativeTransform.matrix}update(){return super.update()?(this.updateDOM(),this.visibilityDirty&&(this.visibilityDirty=!1,this.domElement.style.visibility=this.visible?"":"hidden"),this.cleanPaintableState&&this.cleanPaintableState(),!0):!1}updateDOM(){}updateSelfVisibility(){super.updateSelfVisibility(),this.visibilityDirty||(this.visibilityDirty=!0,this.markDirty())}dispose(){this.instance.relativeTransform.removeListener(this.transformListener),this.instance.relativeTransform.removePrecompute(),super.dispose()}}scenery.register("DOMSelfDrawable",DOMSelfDrawable);class SVGSelfDrawable extends SelfDrawable{initialize(e,t,n,r){return assert&&assert(typeof n=="boolean"),assert&&assert(typeof r=="boolean"),super.initialize(e,t),this.usesPaint=n,this.keepElements=r,this.svgElement=null,this.svgBlock=null,this.usesPaint&&(this.paintState?this.paintState.initialize():this.paintState=new PaintSVGState),this}update(){return super.update()?(this.updateSVG(),!0):!1}updateSVG(){if(this.paintDirty&&this.updateSVGSelf(this.node,this.svgElement),this.usesPaint&&this.dirtyCachedPaints){const e=this.node._cachedPaints.slice();let t,n;for(t=0;t<e.length;t++){const r=e[t];let s=!0;for(n=0;n<this.lastCachedPaints.length;n++)if(r===this.lastCachedPaints[n]){s=!1;break}s&&this.svgBlock.incrementPaint(r)}for(t=0;t<this.lastCachedPaints.length;t++){const r=this.lastCachedPaints[t];let s=!0;for(n=0;n<e.length;n++)if(r===e[n]){s=!1;break}s&&this.svgBlock.decrementPaint(r)}this.lastCachedPaints=e}this.setToCleanState()}updateFillStrokeStyle(e){if(!this.usesPaint)return;this.dirtyFill&&this.paintState.updateFill(this.svgBlock,this.node.getFillValue()),this.dirtyStroke&&this.paintState.updateStroke(this.svgBlock,this.node.getStrokeValue());const t=this.dirtyLineWidth||this.dirtyLineOptions;t&&this.paintState.updateStrokeDetailStyle(this.node),(this.dirtyFill||this.dirtyStroke||t)&&e.setAttribute("style",this.paintState.baseStyle+this.paintState.strokeDetailStyle),this.cleanPaintableState()}updateSVGBlock(e){const t=this.svgBlock;if(this.usesPaint&&t)for(let n=0;n<this.lastCachedPaints.length;n++)t.decrementPaint(this.lastCachedPaints[n]);if(this.svgBlock=e,this.usesPaint)for(let n=0;n<this.lastCachedPaints.length;n++)e.incrementPaint(this.lastCachedPaints[n]);this.updateDefsSelf&&this.updateDefsSelf(e),this.usesPaint&&this.paintState.updateSVGBlock(e),this.usesPaint&&this.markDirtyFill(),this.usesPaint&&this.markDirtyStroke()}dispose(){this.keepElements||(this.svgElement=null),this.updateDefsSelf&&this.updateDefsSelf(null),this.usesPaint&&this.paintState.dispose(),this.defs=null,this.svgBlock=null,super.dispose()}}scenery.register("SVGSelfDrawable",SVGSelfDrawable);class WebGLSelfDrawable extends SelfDrawable{initialize(e,t){return super.initialize(e,t),this.transformListener=this.transformListener||this.markTransformDirty.bind(this),t.relativeTransform.addListener(this.transformListener),t.relativeTransform.addPrecompute(),this}markTransformDirty(){this.markDirty()}updateSelfVisibility(){super.updateSelfVisibility(),this.markDirty()}dispose(){this.instance.relativeTransform.removeListener(this.transformListener),this.instance.relativeTransform.removePrecompute(),super.dispose()}}scenery.register("WebGLSelfDrawable",WebGLSelfDrawable);const CircleStatefulDrawable=memoize(o=>(assert&&assert(_.includes(inheritance(o),SelfDrawable)),class extends PaintableStatefulDrawable(o){initialize(e,t,...n){super.initialize(e,t,...n),this.paintDirty=!0,this.dirtyRadius=!0}markPaintDirty(){this.paintDirty=!0,this.markDirty()}markDirtyRadius(){this.dirtyRadius=!0,this.markPaintDirty()}setToCleanState(){this.paintDirty=!1,this.dirtyRadius=!1}}));scenery.register("CircleStatefulDrawable",CircleStatefulDrawable);const ImageStatefulDrawable=memoize(o=>(assert&&assert(_.includes(inheritance(o),SelfDrawable)),class extends o{initialize(e,t,...n){super.initialize(e,t,...n),this.paintDirty=!0,this.dirtyImage=!0,this.dirtyImageOpacity=!0,this.dirtyMipmap=!0}markPaintDirty(){this.paintDirty=!0,this.markDirty()}markDirtyImage(){this.dirtyImage=!0,this.markPaintDirty()}markDirtyImageOpacity(){this.dirtyImageOpacity=!0,this.markPaintDirty()}markDirtyMipmap(){this.dirtyMipmap=!0,this.markPaintDirty()}setToCleanState(){this.paintDirty=!1,this.dirtyImage=!1,this.dirtyImageOpacity=!1,this.dirtyMipmap=!1}}));scenery.register("ImageStatefulDrawable",ImageStatefulDrawable);const ImageStatefulDrawable$1=ImageStatefulDrawable,LineStatelessDrawable=memoize(o=>(assert&&assert(_.includes(inheritance(o),SelfDrawable)),class extends PaintableStatelessDrawable$1(o){initialize(e,t,...n){super.initialize(e,t,...n),this.paintDirty=!0}markPaintDirty(){this.paintDirty=!0,this.markDirty()}markDirtyLine(){this.markPaintDirty()}markDirtyP1(){this.markPaintDirty()}markDirtyP2(){this.markPaintDirty()}markDirtyX1(){this.markPaintDirty()}markDirtyY1(){this.markPaintDirty()}markDirtyX2(){this.markPaintDirty()}markDirtyY2(){this.markPaintDirty()}}));scenery.register("LineStatelessDrawable",LineStatelessDrawable);const LineStatefulDrawable=memoize(o=>(assert&&assert(_.includes(inheritance(o),SelfDrawable)),class extends PaintableStatefulDrawable(o){initialize(e,t,...n){super.initialize(e,t,...n),this.paintDirty=!0,this.dirtyX1=!0,this.dirtyY1=!0,this.dirtyX2=!0,this.dirtyY2=!0}markPaintDirty(){this.paintDirty=!0,this.markDirty()}markDirtyLine(){this.dirtyX1=!0,this.dirtyY1=!0,this.dirtyX2=!0,this.dirtyY2=!0,this.markPaintDirty()}markDirtyP1(){this.dirtyX1=!0,this.dirtyY1=!0,this.markPaintDirty()}markDirtyP2(){this.dirtyX2=!0,this.dirtyY2=!0,this.markPaintDirty()}markDirtyX1(){this.dirtyX1=!0,this.markPaintDirty()}markDirtyY1(){this.dirtyY1=!0,this.markPaintDirty()}markDirtyX2(){this.dirtyX2=!0,this.markPaintDirty()}markDirtyY2(){this.dirtyY2=!0,this.markPaintDirty()}setToCleanState(){this.paintDirty=!1,this.dirtyX1=!1,this.dirtyY1=!1,this.dirtyX2=!1,this.dirtyY2=!1}}));scenery.register("LineStatefulDrawable",LineStatefulDrawable);const PathStatefulDrawable=memoize(o=>(assert&&assert(_.includes(inheritance(o),SelfDrawable)),class extends PaintableStatefulDrawable(o){initialize(e,t,...n){super.initialize(e,t,...n),this.paintDirty=!0,this.dirtyShape=!0}markPaintDirty(){this.paintDirty=!0,this.markDirty()}markDirtyShape(){this.dirtyShape=!0,this.markPaintDirty()}setToCleanState(){this.paintDirty=!1,this.dirtyShape=!1}}));scenery.register("PathStatefulDrawable",PathStatefulDrawable);const PathStatefulDrawable$1=PathStatefulDrawable,RectangleStatefulDrawable=memoize(o=>(assert&&assert(_.includes(inheritance(o),SelfDrawable)),class extends PaintableStatefulDrawable(o){initialize(e,t,...n){super.initialize(e,t,...n),this.paintDirty=!0,this.dirtyX=!0,this.dirtyY=!0,this.dirtyWidth=!0,this.dirtyHeight=!0,this.dirtyCornerXRadius=!0,this.dirtyCornerYRadius=!0}markPaintDirty(){this.paintDirty=!0,this.markDirty()}markDirtyRectangle(){this.dirtyX=!0,this.dirtyY=!0,this.dirtyWidth=!0,this.dirtyHeight=!0,this.dirtyCornerXRadius=!0,this.dirtyCornerYRadius=!0,this.markPaintDirty()}markDirtyX(){this.dirtyX=!0,this.markPaintDirty()}markDirtyY(){this.dirtyY=!0,this.markPaintDirty()}markDirtyWidth(){this.dirtyWidth=!0,this.markPaintDirty()}markDirtyHeight(){this.dirtyHeight=!0,this.markPaintDirty()}markDirtyCornerXRadius(){this.dirtyCornerXRadius=!0,this.markPaintDirty()}markDirtyCornerYRadius(){this.dirtyCornerYRadius=!0,this.markPaintDirty()}setToCleanState(){this.paintDirty=!1,this.dirtyX=!1,this.dirtyY=!1,this.dirtyWidth=!1,this.dirtyHeight=!1,this.dirtyCornerXRadius=!1,this.dirtyCornerYRadius=!1}}));scenery.register("RectangleStatefulDrawable",RectangleStatefulDrawable);const TextStatefulDrawable=memoize(o=>(assert&&assert(_.includes(inheritance(o),SelfDrawable)),class extends PaintableStatefulDrawable(o){initialize(e,t,...n){super.initialize(e,t,...n),this.paintDirty=!0,this.dirtyText=!0,this.dirtyFont=!0,this.dirtyBounds=!0}markPaintDirty(){this.paintDirty=!0,this.markDirty()}markDirtyText(){this.dirtyText=!0,this.markPaintDirty()}markDirtyFont(){this.dirtyFont=!0,this.markPaintDirty()}markDirtyBounds(){this.dirtyBounds=!0,this.markPaintDirty()}setToCleanState(){this.paintDirty=!1,this.dirtyText=!1,this.dirtyFont=!1,this.dirtyBounds=!1}}));scenery.register("TextStatefulDrawable",TextStatefulDrawable);const TextStatefulDrawable$1=TextStatefulDrawable,emptyArray=[];class CanvasNodeDrawable extends CanvasSelfDrawable{paintCanvas(e,t,n){if(assert&&assert(!t.selfBounds.isEmpty(),`CanvasNode should not be used with an empty canvasBounds. Please set canvasBounds (or use setCanvasBounds()) on ${t.constructor.name}`),!t.selfBounds.isEmpty()){const r=e.context;r.save(),r.fillStyle="black",r.strokeStyle="black",r.lineWidth=1,r.lineCap="butt",r.lineJoin="miter",r.lineDash=emptyArray,r.lineDashOffset=0,r.miterLimit=10,t.paintCanvas(r),r.restore()}}}scenery.register("CanvasNodeDrawable",CanvasNodeDrawable);Poolable.mixInto(CanvasNodeDrawable);const CanvasNodeDrawable$1=CanvasNodeDrawable;class CircleCanvasDrawable extends PaintableStatelessDrawable$1(CanvasSelfDrawable){paintCanvas(e,t,n){assert&&assert(t instanceof Node$2);const r=e.context;r.beginPath(),r.arc(0,0,t._radius,0,Math.PI*2,!1),r.closePath(),t.hasFill()&&(t.beforeCanvasFill(e),r.fill(),t.afterCanvasFill(e)),t.hasPaintableStroke()&&(t.beforeCanvasStroke(e),r.stroke(),t.afterCanvasStroke(e))}markDirtyRadius(){this.markPaintDirty()}dispose(){super.dispose()}}scenery.register("CircleCanvasDrawable",CircleCanvasDrawable);Poolable.mixInto(CircleCanvasDrawable);const CircleCanvasDrawable$1=CircleCanvasDrawable;class CircleDOMDrawable extends CircleStatefulDrawable(DOMSelfDrawable){constructor(e,t){super(e,t),Utils.prepareForTransform(this.domElement)}initialize(e,t){if(super.initialize(e,t),this.matrix=this.matrix||Matrix3.pool.fetch(),!this.fillElement||!this.strokeElement){const n=document.createElement("div");this.fillElement=n;const r=document.createElement("div");this.strokeElement=r,n.style.display="block",n.style.position="absolute",n.style.left="0",n.style.top="0",n.style.pointerEvents="none",r.style.display="block",r.style.position="absolute",r.style.left="0",r.style.top="0",r.style.pointerEvents="none",n.appendChild(r)}this.domElement=this.fillElement}updateDOM(){const e=this.node,t=this.fillElement,n=this.strokeElement;if(this.paintDirty&&(this.dirtyRadius&&(t.style.width=`${2*e._radius}px`,t.style.height=`${2*e._radius}px`,t.style[Features.borderRadius]=`${e._radius}px`),this.dirtyFill&&(t.style.backgroundColor=e.getCSSFill()),this.dirtyStroke&&(e.hasStroke()?n.style.borderStyle="solid":n.style.borderStyle="none"),e.hasStroke())){const r=!this.hadStroke;(r||this.dirtyLineWidth||this.dirtyRadius)&&(n.style.width=`${2*e._radius-e.getLineWidth()}px`,n.style.height=`${2*e._radius-e.getLineWidth()}px`,n.style[Features.borderRadius]=`${e._radius+e.getLineWidth()/2}px`),(r||this.dirtyLineWidth)&&(n.style.left=`${-e.getLineWidth()/2}px`,n.style.top=`${-e.getLineWidth()/2}px`,n.style.borderWidth=`${e.getLineWidth()}px`),(r||this.dirtyStroke)&&(n.style.borderColor=e.getSimpleCSSStroke())}if(this.transformDirty||this.dirtyRadius){this.matrix.set(this.getTransformMatrix());const r=Matrix3.translation(-e._radius,-e._radius);this.matrix.multiplyMatrix(r),r.freeToPool(),Utils.applyPreparedTransform(this.matrix,this.fillElement)}this.setToCleanState(),this.cleanPaintableState(),this.transformDirty=!1}dispose(){super.dispose()}}scenery.register("CircleDOMDrawable",CircleDOMDrawable);Poolable.mixInto(CircleDOMDrawable);const CircleDOMDrawable$1=CircleDOMDrawable,keepSVGCircleElements=!0;class CircleSVGDrawable extends CircleStatefulDrawable(SVGSelfDrawable){initialize(e,t){super.initialize(e,t,!0,keepSVGCircleElements),this.svgElement=this.svgElement||document.createElementNS(svgns,"circle")}updateSVGSelf(){const e=this.svgElement;this.dirtyRadius&&e.setAttribute("r",this.node._radius),this.updateFillStrokeStyle(e)}}scenery.register("CircleSVGDrawable",CircleSVGDrawable);Poolable.mixInto(CircleSVGDrawable);const CircleSVGDrawable$1=CircleSVGDrawable;class DOMDrawable extends DOMSelfDrawable{constructor(e,t){super(e,t),Utils.prepareForTransform(this.domElement)}initialize(e,t){super.initialize(e,t),this.domElement=this.node._container}updateDOM(){this.transformDirty&&!this.node._preventTransform&&Utils.applyPreparedTransform(this.getTransformMatrix(),this.domElement),this.transformDirty=!1}dispose(){super.dispose(),this.domElement=null}}scenery.register("DOMDrawable",DOMDrawable);Poolable.mixInto(DOMDrawable);const DOMDrawable$1=DOMDrawable;class ImageCanvasDrawable extends CanvasSelfDrawable{paintCanvas(e,t,n){const r=t._imageOpacity!==1;if(t._image&&t._image.width!==0&&t._image.height!==0){if(r&&(e.context.save(),e.context.globalAlpha*=t._imageOpacity),t._mipmap&&t.hasMipmaps()){const s=t.getMipmapLevel(n,Imageable$1.CANVAS_MIPMAP_BIAS_ADJUSTMENT),a=t.getMipmapCanvas(s),h=Math.pow(2,s);e.context.drawImage(a,0,0,a.width*h,a.height*h)}else e.context.drawImage(t._image,0,0);r&&e.context.restore()}}markDirtyImage(){this.markPaintDirty()}markDirtyMipmap(){this.markPaintDirty()}markDirtyImageOpacity(){this.markPaintDirty()}}scenery.register("ImageCanvasDrawable",ImageCanvasDrawable);Poolable.mixInto(ImageCanvasDrawable);const ImageCanvasDrawable$1=ImageCanvasDrawable;class ImageDOMDrawable extends ImageStatefulDrawable$1(DOMSelfDrawable){constructor(e,t){super(e,t),Utils.prepareForTransform(this.domElement)}initialize(e,t){super.initialize(e,t),this.domElement||(this.domElement=document.createElement("img"),this.domElement.style.display="block",this.domElement.style.position="absolute",this.domElement.style.pointerEvents="none",this.domElement.style.left="0",this.domElement.style.top="0"),this.hasOpacity=!1}updateDOM(){const e=this.node,t=this.domElement;this.paintDirty&&this.dirtyImage&&(t.src=e._image?e._image.src:"//:0"),this.dirtyImageOpacity&&(e._imageOpacity===1?this.hasOpacity&&(this.hasOpacity=!1,t.style.opacity=""):(this.hasOpacity=!0,t.style.opacity=e._imageOpacity)),this.transformDirty&&Utils.applyPreparedTransform(this.getTransformMatrix(),this.domElement),this.setToCleanState(),this.transformDirty=!1}dispose(){super.dispose()}}scenery.register("ImageDOMDrawable",ImageDOMDrawable);Poolable.mixInto(ImageDOMDrawable);const ImageDOMDrawable$1=ImageDOMDrawable,keepSVGImageElements=!0;class ImageSVGDrawable extends ImageStatefulDrawable$1(SVGSelfDrawable){initialize(e,t){super.initialize(e,t,!1,keepSVGImageElements),sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} initialized for ${t.toString()}`),this.svgElement=this.svgElement||document.createElementNS(svgns,"image"),this.svgElement.setAttribute("x","0"),this.svgElement.setAttribute("y","0"),this.hasOpacity=!1,this.usingMipmap=!1,this.mipmapLevel=-1,this._mipmapTransformListener=this._mipmapTransformListener||this.onMipmapTransform.bind(this),this._mipmapListener=this._mipmapListener||this.onMipmap.bind(this),this.node.mipmapEmitter.addListener(this._mipmapListener),this.updateMipmapStatus(t.node._mipmap)}updateSVGSelf(){const e=this.svgElement;this.dirtyImage?(sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Updating dirty image`),this.node._image?this.updateURL(e,!0):(e.setAttribute("width","0"),e.setAttribute("height","0"),e.setAttributeNS(xlinkns,"xlink:href","//:0"))):this.dirtyMipmap&&this.node._image&&(sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Updating dirty mipmap`),this.updateURL(e,!1)),this.dirtyImageOpacity&&(this.node._imageOpacity===1?this.hasOpacity&&(this.hasOpacity=!1,e.removeAttribute("opacity")):(this.hasOpacity=!0,e.setAttribute("opacity",this.node._imageOpacity)))}updateURL(e,t){let n=-1;if(this.node._mipmap&&(n=this.node.getMipmapLevel(this.instance.relativeTransform.matrix),sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Mipmap level: ${n}`)),!(!t&&n===this.mipmapLevel))if(this.mipmapLevel>=0&&n===-1&&e.removeAttribute("transform"),this.mipmapLevel=n,this.node._mipmap&&this.node.hasMipmaps()){sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Setting image URL to mipmap level ${n}`);const r=this.node.getMipmapURL(n),s=this.node.getMipmapCanvas(n);e.setAttribute("width",`${s.width}px`),e.setAttribute("height",`${s.height}px`),e.setAttribute("transform",`scale(${Math.pow(2,n).toFixed(20)})`),e.setAttributeNS(xlinkns,"xlink:href",r)}else sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Setting image URL`),e.setAttribute("width",`${this.node.getImageWidth()}px`),e.setAttribute("height",`${this.node.getImageHeight()}px`),e.setAttributeNS(xlinkns,"xlink:href",this.node.getImageURL())}updateMipmapStatus(e){this.usingMipmap!==e&&(this.usingMipmap=e,e?(sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Adding mipmap compute/listener needs`),this.instance.relativeTransform.addListener(this._mipmapTransformListener),this.instance.relativeTransform.addPrecompute()):(sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Removing mipmap compute/listener needs`),this.instance.relativeTransform.removeListener(this._mipmapTransformListener),this.instance.relativeTransform.removePrecompute()),this.markDirtyMipmap())}onMipmap(){this.markDirtyMipmap(),this.updateMipmapStatus(this.node._mipmap)}onMipmapTransform(){sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Transform dirties mipmap`),this.markDirtyMipmap()}dispose(){sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} disposing`),this.updateMipmapStatus(!1),this.node.mipmapEmitter.removeListener(this._mipmapListener),super.dispose()}}scenery.register("ImageSVGDrawable",ImageSVGDrawable);Poolable.mixInto(ImageSVGDrawable);const ImageSVGDrawable$1=ImageSVGDrawable,WEBGL_COMPONENTS=5,VERTEX_0_OFFSET=WEBGL_COMPONENTS*0,VERTEX_1_OFFSET=WEBGL_COMPONENTS*1,VERTEX_2_OFFSET=WEBGL_COMPONENTS*2,VERTEX_3_OFFSET=WEBGL_COMPONENTS*3,VERTEX_4_OFFSET=WEBGL_COMPONENTS*4,VERTEX_5_OFFSET=WEBGL_COMPONENTS*5,VERTEX_X_OFFSET=0,VERTEX_Y_OFFSET=1,VERTEX_U_OFFSET=2,VERTEX_V_OFFSET=3,VERTEX_A_OFFSET=4;class ImageWebGLDrawable extends ImageStatefulDrawable$1(WebGLSelfDrawable){initialize(e,t){super.initialize(e,t),this.vertexArray=this.vertexArray||new Float32Array(WEBGL_COMPONENTS*6),this.upperLeft=new Vector2(0,0),this.lowerLeft=new Vector2(0,0),this.upperRight=new Vector2(0,0),this.lowerRight=new Vector2(0,0),this.xyDirty=!0,this.uvDirty=!0,this.updatedOnce=!1,this.sprite=null}onAddToBlock(e){this.webglBlock=e,this.markDirty(),this.reserveSprite()}onRemoveFromBlock(e){this.unreserveSprite()}reserveSprite(){if(this.sprite){if(this.sprite.image===this.node._image)return;this.unreserveSprite()}const e=this.node.getImageWidth(),t=this.node.getImageHeight();this.sprite=e>0&&t>0?this.webglBlock.addSpriteSheetImage(this.node._image,e,t):null,this.xyDirty=!0,this.uvDirty=!0}unreserveSprite(){this.sprite&&this.webglBlock.removeSpriteSheetImage(this.sprite),this.sprite=null}markTransformDirty(){this.xyDirty=!0,super.markTransformDirty()}markPaintDirty(){this.xyDirty=!0,this.uvDirty=!0,this.markDirty()}update(){if(!super.update()||(this.reserveSprite(),(this.dirtyImageOpacity||!this.updatedOnce)&&(this.vertexArray[VERTEX_0_OFFSET+VERTEX_A_OFFSET]=this.node._imageOpacity,this.vertexArray[VERTEX_1_OFFSET+VERTEX_A_OFFSET]=this.node._imageOpacity,this.vertexArray[VERTEX_2_OFFSET+VERTEX_A_OFFSET]=this.node._imageOpacity,this.vertexArray[VERTEX_3_OFFSET+VERTEX_A_OFFSET]=this.node._imageOpacity,this.vertexArray[VERTEX_4_OFFSET+VERTEX_A_OFFSET]=this.node._imageOpacity,this.vertexArray[VERTEX_5_OFFSET+VERTEX_A_OFFSET]=this.node._imageOpacity),this.updatedOnce=!0,!this.sprite))return!1;if(this.uvDirty){this.uvDirty=!1;const e=this.sprite.uvBounds;this.vertexArray[VERTEX_0_OFFSET+VERTEX_U_OFFSET]=e.minX,this.vertexArray[VERTEX_0_OFFSET+VERTEX_V_OFFSET]=e.minY,this.vertexArray[VERTEX_1_OFFSET+VERTEX_U_OFFSET]=e.minX,this.vertexArray[VERTEX_1_OFFSET+VERTEX_V_OFFSET]=e.maxY,this.vertexArray[VERTEX_2_OFFSET+VERTEX_U_OFFSET]=e.maxX,this.vertexArray[VERTEX_2_OFFSET+VERTEX_V_OFFSET]=e.minY,this.vertexArray[VERTEX_3_OFFSET+VERTEX_U_OFFSET]=e.maxX,this.vertexArray[VERTEX_3_OFFSET+VERTEX_V_OFFSET]=e.minY,this.vertexArray[VERTEX_4_OFFSET+VERTEX_U_OFFSET]=e.minX,this.vertexArray[VERTEX_4_OFFSET+VERTEX_V_OFFSET]=e.maxY,this.vertexArray[VERTEX_5_OFFSET+VERTEX_U_OFFSET]=e.maxX,this.vertexArray[VERTEX_5_OFFSET+VERTEX_V_OFFSET]=e.maxY}if(this.xyDirty){this.xyDirty=!1;const e=this.node.getImageWidth(),t=this.node.getImageHeight(),n=this.instance.relativeTransform.matrix;n.multiplyVector2(this.upperLeft.setXY(0,0)),n.multiplyVector2(this.lowerLeft.setXY(0,t)),n.multiplyVector2(this.upperRight.setXY(e,0)),n.multiplyVector2(this.lowerRight.setXY(e,t)),this.vertexArray[VERTEX_0_OFFSET+VERTEX_X_OFFSET]=this.upperLeft.x,this.vertexArray[VERTEX_0_OFFSET+VERTEX_Y_OFFSET]=this.upperLeft.y,this.vertexArray[VERTEX_1_OFFSET+VERTEX_X_OFFSET]=this.lowerLeft.x,this.vertexArray[VERTEX_1_OFFSET+VERTEX_Y_OFFSET]=this.lowerLeft.y,this.vertexArray[VERTEX_2_OFFSET+VERTEX_X_OFFSET]=this.upperRight.x,this.vertexArray[VERTEX_2_OFFSET+VERTEX_Y_OFFSET]=this.upperRight.y,this.vertexArray[VERTEX_3_OFFSET+VERTEX_X_OFFSET]=this.upperRight.x,this.vertexArray[VERTEX_3_OFFSET+VERTEX_Y_OFFSET]=this.upperRight.y,this.vertexArray[VERTEX_4_OFFSET+VERTEX_X_OFFSET]=this.lowerLeft.x,this.vertexArray[VERTEX_4_OFFSET+VERTEX_Y_OFFSET]=this.lowerLeft.y,this.vertexArray[VERTEX_5_OFFSET+VERTEX_X_OFFSET]=this.lowerRight.x,this.vertexArray[VERTEX_5_OFFSET+VERTEX_Y_OFFSET]=this.lowerRight.y}return!0}}ImageWebGLDrawable.prototype.webglRenderer=Renderer.webglTexturedTriangles;scenery.register("ImageWebGLDrawable",ImageWebGLDrawable);Poolable.mixInto(ImageWebGLDrawable);const ImageWebGLDrawable$1=ImageWebGLDrawable;class LineCanvasDrawable extends LineStatelessDrawable(CanvasSelfDrawable){paintCanvas(e,t,n){assert&&assert(t instanceof Node$2);const r=e.context;r.beginPath(),r.moveTo(t.x1,t.y1),r.lineTo(t.x2,t.y2),t.hasPaintableStroke()&&(t.beforeCanvasStroke(e),r.stroke(),t.afterCanvasStroke(e))}}scenery.register("LineCanvasDrawable",LineCanvasDrawable);Poolable.mixInto(LineCanvasDrawable);const LineCanvasDrawable$1=LineCanvasDrawable,keepSVGLineElements=!0;class LineSVGDrawable extends LineStatefulDrawable(SVGSelfDrawable){initialize(e,t){super.initialize(e,t,!0,keepSVGLineElements),this.svgElement=this.svgElement||document.createElementNS(svgns,"line")}updateSVGSelf(){const e=this.svgElement;this.dirtyX1&&e.setAttribute("x1",this.node.x1),this.dirtyY1&&e.setAttribute("y1",this.node.y1),this.dirtyX2&&e.setAttribute("x2",this.node.x2),this.dirtyY2&&e.setAttribute("y2",this.node.y2),this.updateFillStrokeStyle(e)}}scenery.register("LineSVGDrawable",LineSVGDrawable);Poolable.mixInto(LineSVGDrawable);const LineSVGDrawable$1=LineSVGDrawable;class PathCanvasDrawable extends PaintableStatelessDrawable$1(CanvasSelfDrawable){paintCanvas(e,t,n){const r=e.context;t.hasShape()&&(r.beginPath(),t._shape.writeToContext(r),t.hasFill()&&(t.beforeCanvasFill(e),r.fill(),t.afterCanvasFill(e)),t.hasPaintableStroke()&&(t.beforeCanvasStroke(e),r.stroke(),t.afterCanvasStroke(e)))}markDirtyShape(){this.markPaintDirty()}}scenery.register("PathCanvasDrawable",PathCanvasDrawable);Poolable.mixInto(PathCanvasDrawable);const PathCanvasDrawable$1=PathCanvasDrawable,keepSVGPathElements=!0,useSafariQuadraticWorkaround=platform.safari;class PathSVGDrawable extends PathStatefulDrawable$1(SVGSelfDrawable){initialize(e,t){super.initialize(e,t,!0,keepSVGPathElements),this.svgElement=this.svgElement||document.createElementNS(svgns,"path")}updateSVGSelf(){assert&&assert(!this.node.requiresSVGBoundsWorkaround(),"No workaround for https://github.com/phetsims/scenery/issues/196 is provided at this time, please add an epsilon");const e=this.svgElement;if(this.dirtyShape){let t=this.node.hasShape()?useSafariQuadraticWorkaround?this.node._shape.getSVGPathWithSafariWorkaround():this.node._shape.getSVGPath():"";t||(t="M0 0"),e.setAttribute("d",`${t}${platform.safari?" M0 0":""}`)}this.updateFillStrokeStyle(e)}}scenery.register("PathSVGDrawable",PathSVGDrawable);Poolable.mixInto(PathSVGDrawable);const PathSVGDrawable$1=PathSVGDrawable;class RectangleCanvasDrawable extends PaintableStatelessDrawable$1(CanvasSelfDrawable){writeRectangularPath(e,t){e.beginPath(),e.moveTo(t._rectX,t._rectY),e.lineTo(t._rectX+t._rectWidth,t._rectY),e.lineTo(t._rectX+t._rectWidth,t._rectY+t._rectHeight),e.lineTo(t._rectX,t._rectY+t._rectHeight),e.closePath()}paintCanvas(e,t,n){const r=e.context;if(t.isRounded()){r.beginPath();const s=t.getMaximumArcSize(),a=Math.min(t._cornerXRadius,s),h=Math.min(t._cornerYRadius,s),c=t._rectX+a,d=t._rectX+t._rectWidth-a,y=t._rectY+h,g=t._rectY+t._rectHeight-h;a===h?(r.arc(d,y,a,-Math.PI/2,0,!1),r.arc(d,g,a,0,Math.PI/2,!1),r.arc(c,g,a,Math.PI/2,Math.PI,!1),r.arc(c,y,a,Math.PI,Math.PI*3/2,!1)):(r.ellipse(d,y,a,h,0,-Math.PI/2,0,!1),r.ellipse(d,g,a,h,0,0,Math.PI/2,!1),r.ellipse(c,g,a,h,0,Math.PI/2,Math.PI,!1),r.ellipse(c,y,a,h,0,Math.PI,Math.PI*3/2,!1)),r.closePath(),t.hasFill()&&(t.beforeCanvasFill(e),r.fill(),t.afterCanvasFill(e)),t.hasPaintableStroke()&&(t.beforeCanvasStroke(e),r.stroke(),t.afterCanvasStroke(e))}else t.hasFill()&&(t.getFillValue().transformMatrix?(this.writeRectangularPath(r,t),t.beforeCanvasFill(e),r.fill(),t.afterCanvasFill(e)):(t.beforeCanvasFill(e),r.fillRect(t._rectX,t._rectY,t._rectWidth,t._rectHeight),t.afterCanvasFill(e))),t.hasPaintableStroke()&&(t.getStrokeValue().transformMatrix?(this.writeRectangularPath(r,t),t.beforeCanvasStroke(e),r.stroke(),t.afterCanvasStroke(e)):(t.beforeCanvasStroke(e),r.strokeRect(t._rectX,t._rectY,t._rectWidth,t._rectHeight),t.afterCanvasStroke(e)))}markDirtyRectangle(){this.markPaintDirty()}markDirtyX(){this.markDirtyRectangle()}markDirtyY(){this.markDirtyRectangle()}markDirtyWidth(){this.markDirtyRectangle()}markDirtyHeight(){this.markDirtyRectangle()}markDirtyCornerXRadius(){this.markDirtyRectangle()}markDirtyCornerYRadius(){this.markDirtyRectangle()}}scenery.register("RectangleCanvasDrawable",RectangleCanvasDrawable);Poolable.mixInto(RectangleCanvasDrawable);const RectangleCanvasDrawable$1=RectangleCanvasDrawable,scratchMatrix$2=Matrix3.pool.fetch();class RectangleDOMDrawable extends RectangleStatefulDrawable(DOMSelfDrawable){constructor(e,t){super(e,t),Utils.prepareForTransform(this.domElement)}initialize(e,t){if(super.initialize(e,t),!this.fillElement||!this.strokeElement){const n=document.createElement("div");this.fillElement=n,n.style.display="block",n.style.position="absolute",n.style.left="0",n.style.top="0",n.style.pointerEvents="none";const r=document.createElement("div");this.strokeElement=r,r.style.display="block",r.style.position="absolute",r.style.left="0",r.style.top="0",r.style.pointerEvents="none",n.appendChild(r)}this.domElement=this.fillElement}updateDOM(){const e=this.node,t=this.fillElement,n=this.strokeElement;if(this.paintDirty){const r=Math.min(e._cornerXRadius,e._cornerYRadius),s=this.dirtyCornerXRadius||this.dirtyCornerYRadius;if(this.dirtyWidth&&(t.style.width=`${e._rectWidth}px`),this.dirtyHeight&&(t.style.height=`${e._rectHeight}px`),s&&(t.style[Features.borderRadius]=`${r}px`),this.dirtyFill&&(t.style.backgroundColor=e.getCSSFill()),this.dirtyStroke&&(e.hasStroke()?n.style.borderStyle="solid":n.style.borderStyle="none"),e.hasStroke()){const a=!this.hadStroke;(a||this.dirtyWidth||this.dirtyLineWidth)&&(n.style.width=`${e._rectWidth-e.getLineWidth()}px`),(a||this.dirtyHeight||this.dirtyLineWidth)&&(n.style.height=`${e._rectHeight-e.getLineWidth()}px`),(a||this.dirtyLineWidth)&&(n.style.left=`${-e.getLineWidth()/2}px`,n.style.top=`${-e.getLineWidth()/2}px`,n.style.borderWidth=`${e.getLineWidth()}px`),(a||this.dirtyStroke)&&(n.style.borderColor=e.getSimpleCSSStroke()),(a||s||this.dirtyLineWidth||this.dirtyLineOptions)&&(n.style[Features.borderRadius]=e.isRounded()||e.getLineJoin()==="round"?`${r+e.getLineWidth()/2}px`:"0")}}if(this.transformDirty||this.dirtyX||this.dirtyY){scratchMatrix$2.set(this.getTransformMatrix());const r=Matrix3.translation(e._rectX,e._rectY);scratchMatrix$2.multiplyMatrix(r),r.freeToPool(),Utils.applyPreparedTransform(scratchMatrix$2,this.fillElement)}this.setToCleanState(),this.cleanPaintableState(),this.transformDirty=!1}dispose(){super.dispose()}}scenery.register("RectangleDOMDrawable",RectangleDOMDrawable);Poolable.mixInto(RectangleDOMDrawable);const RectangleDOMDrawable$1=RectangleDOMDrawable,keepSVGRectangleElements=!0;class RectangleSVGDrawable extends RectangleStatefulDrawable(SVGSelfDrawable){initialize(e,t){super.initialize(e,t,!0,keepSVGRectangleElements),this.lastArcW=-1,this.lastArcH=-1,this.svgElement=this.svgElement||document.createElementNS(svgns,"rect")}updateSVGSelf(){const e=this.svgElement;if(this.dirtyX&&e.setAttribute("x",this.node._rectX),this.dirtyY&&e.setAttribute("y",this.node._rectY),this.dirtyWidth&&e.setAttribute("width",this.node._rectWidth),this.dirtyHeight&&e.setAttribute("height",this.node._rectHeight),this.dirtyCornerXRadius||this.dirtyCornerYRadius||this.dirtyWidth||this.dirtyHeight){let t=0,n=0;if(this.node.isRounded()){const r=this.node.getMaximumArcSize();t=Math.min(this.node._cornerXRadius,r),n=Math.min(this.node._cornerYRadius,r)}t!==this.lastArcW&&(this.lastArcW=t,e.setAttribute("rx",t)),n!==this.lastArcH&&(this.lastArcH=n,e.setAttribute("ry",n))}this.updateFillStrokeStyle(e)}}scenery.register("RectangleSVGDrawable",RectangleSVGDrawable);Poolable.mixInto(RectangleSVGDrawable);const RectangleSVGDrawable$1=RectangleSVGDrawable,scratchColor=new Color("transparent");class RectangleWebGLDrawable extends RectangleStatefulDrawable(WebGLSelfDrawable){initialize(e,t){super.initialize(e,t),this.vertexArray||(this.vertexArray=new Float32Array(6*6)),this.upperLeft=new Vector2(0,0),this.lowerLeft=new Vector2(0,0),this.upperRight=new Vector2(0,0),this.lowerRight=new Vector2(0,0),this.transformDirty=!0,this.includeVertices=!0}onAddToBlock(e){this.webglBlock=e,this.markDirty()}onRemoveFromBlock(e){}markTransformDirty(){this.transformDirty=!0,super.markTransformDirty()}update(){if(!super.update())return!1;if(this.dirtyFill&&(this.includeVertices=this.node.hasFill(),this.includeVertices)){const e=isTReadOnlyProperty(this.node.fill)?this.node.fill.value:this.node.fill,t=scratchColor.set(e),n=t.red/255,r=t.green/255,s=t.blue/255,a=t.alpha;for(let h=0;h<6;h++){const c=h*6;this.vertexArray[2+c]=n,this.vertexArray[3+c]=r,this.vertexArray[4+c]=s,this.vertexArray[5+c]=a}}if(this.transformDirty||this.dirtyX||this.dirtyY||this.dirtyWidth||this.dirtyHeight){this.transformDirty=!1;const e=this.node._rectX,t=this.node._rectY,n=this.node._rectWidth,r=this.node._rectHeight,s=this.instance.relativeTransform.matrix;s.multiplyVector2(this.upperLeft.setXY(e,t)),s.multiplyVector2(this.lowerLeft.setXY(e,t+r)),s.multiplyVector2(this.upperRight.setXY(e+n,t)),s.multiplyVector2(this.lowerRight.setXY(e+n,t+r)),this.vertexArray[0]=this.upperLeft.x,this.vertexArray[1]=this.upperLeft.y,this.vertexArray[6]=this.lowerLeft.x,this.vertexArray[7]=this.lowerLeft.y,this.vertexArray[12]=this.upperRight.x,this.vertexArray[13]=this.upperRight.y,this.vertexArray[18]=this.upperRight.x,this.vertexArray[19]=this.upperRight.y,this.vertexArray[24]=this.lowerLeft.x,this.vertexArray[25]=this.lowerLeft.y,this.vertexArray[30]=this.lowerRight.x,this.vertexArray[31]=this.lowerRight.y}return this.setToCleanState(),this.cleanPaintableState(),!0}}RectangleWebGLDrawable.prototype.webglRenderer=Renderer.webglVertexColorPolygons;scenery.register("RectangleWebGLDrawable",RectangleWebGLDrawable);Poolable.mixInto(RectangleWebGLDrawable);const RectangleWebGLDrawable$1=RectangleWebGLDrawable;class SpritesCanvasDrawable extends CanvasSelfDrawable{paintCanvas(e,t,n){assert&&assert(t instanceof Node$2);const r=Imageable$1.getApproximateMatrixScale(n)*(window.devicePixelRatio||1),s=t._spriteInstances.length;assert&&s>0&&assert(t.canvasBounds.isValid(),"Sprites canvasBounds should be set and have non-negative area if it renders sprites");for(let a=0;a<s;a++){const h=t._spriteInstances[a],c=h.sprite.imageProperty.value,d=h.alpha!==1||c.imageOpacity!==1,y=c._mipmap&&c.hasMipmaps();if(d&&(e.context.save(),e.context.globalAlpha*=h.alpha*c.imageOpacity),h.transformType===SpriteInstanceTransformType.TRANSLATION&&n.isTranslation())if(y){const g=c.getMipmapLevelFromScale(r,Imageable$1.CANVAS_MIPMAP_BIAS_ADJUSTMENT),D=c.getMipmapCanvas(g),O=Math.pow(2,g);e.context.drawImage(D,h.matrix.m02()-c.offset.x,h.matrix.m12()-c.offset.y,D.width*O,D.height*O)}else e.context.drawImage(c.image,h.matrix.m02()-c.offset.x,h.matrix.m12()-c.offset.y);else{if(e.context.save(),h.matrix.canvasAppendTransform(e.context),y){const g=c.getMipmapLevelFromScale(r*Imageable$1.getApproximateMatrixScale(h.matrix),Imageable$1.CANVAS_MIPMAP_BIAS_ADJUSTMENT),D=c.getMipmapCanvas(g),O=Math.pow(2,g);e.context.drawImage(D,-c.offset.x,-c.offset.y,D.width*O,D.height*O)}else e.context.drawImage(c.image,-c.offset.x,-c.offset.y);e.context.restore()}d&&e.context.restore()}}}scenery.register("SpritesCanvasDrawable",SpritesCanvasDrawable);Poolable.mixInto(SpritesCanvasDrawable);const SpritesCanvasDrawable$1=SpritesCanvasDrawable,COMPONENTS=5,FLOAT_QUANTITY=COMPONENTS*6,upperLeft=new Vector2(0,0),lowerLeft=new Vector2(0,0),upperRight=new Vector2(0,0),lowerRight=new Vector2(0,0);class SpritesWebGLDrawable extends WebGLSelfDrawable{initialize(e,t){super.initialize(e,t),this.contextChangeListener=this.onWebGLContextChange.bind(this),this.spriteSheet=new SpriteSheet(!0),this.spriteImageUVMap={},this.vertexArray=new Float32Array(128*FLOAT_QUANTITY),this.transformMatrixArray=new Float32Array(9),this.spriteChangeListener=this.onSpriteChange.bind(this),this.node._sprites.forEach(n=>{n.imageProperty.lazyLink(this.spriteChangeListener),this.addSpriteImage(n.imageProperty.value)}),this.hasDrawn=!1}addSpriteImage(e){this.spriteImageUVMap[e.id]=this.spriteSheet.addImage(e.image,e.image.width,e.image.height).uvBounds}removeSpriteImage(e){this.spriteSheet.removeImage(e.image),delete this.spriteImageUVMap[e.id]}onSpriteChange(e,t){this.removeSpriteImage(t),this.addSpriteImage(e)}setup(){const e=this.webGLBlock.gl;this.spriteSheet.initializeContext(e),this.shaderProgram=new ShaderProgram(e,["attribute vec2 aVertex;","attribute vec2 aTextureCoord;","attribute float aAlpha;","varying vec2 vTextureCoord;","varying float vAlpha;","uniform mat3 uProjectionMatrix;","uniform mat3 uTransformMatrix;","void main() {","  vTextureCoord = aTextureCoord;","  vAlpha = aAlpha;","  vec3 ndc = uProjectionMatrix * ( uTransformMatrix * vec3( aVertex, 1.0 ) );","  gl_Position = vec4( ndc.xy, 0.0, 1.0 );","}"].join(`
`),["precision mediump float;","varying vec2 vTextureCoord;","varying float vAlpha;","uniform sampler2D uTexture;","void main() {","  vec4 color = texture2D( uTexture, vTextureCoord, -0.7 );","  color *= vAlpha;","  gl_FragColor = color;","}"].join(`
`),{attributes:["aVertex","aTextureCoord","aAlpha"],uniforms:["uTexture","uProjectionMatrix","uTransformMatrix"]}),this.vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertexArray,e.DYNAMIC_DRAW)}onWebGLContextChange(){this.setup()}onAddToBlock(e){this.webGLBlock=e,this.setup(),e.glChangedEmitter.addListener(this.contextChangeListener)}onRemoveFromBlock(e){e.glChangedEmitter.removeListener(this.contextChangeListener)}draw(){const e=this.node._spriteInstances.length;if(e===0)return 0;assert&&assert(this.node.canvasBounds.isValid(),"Sprites canvasBounds should be set and have non-negative area if it renders sprites"),this.spriteSheet.updateTexture(),this.shaderProgram.use();let t=0,n=!1;for(;FLOAT_QUANTITY*e>this.vertexArray.length;)this.vertexArray=new Float32Array(this.vertexArray.length*2),n=!0;for(let h=0;h<e;h++){const c=this.node._spriteInstances[h],d=c.sprite.imageProperty.value,y=c.alpha*d.imageOpacity,g=this.spriteImageUVMap[d.id],D=c.matrix,O=d.offset,V=d.image.width,k=d.image.height;D.multiplyVector2(upperLeft.setXY(-O.x,-O.y)),D.multiplyVector2(lowerLeft.setXY(-O.x,k-O.y)),D.multiplyVector2(upperRight.setXY(V-O.x,-O.y)),D.multiplyVector2(lowerRight.setXY(V-O.x,k-O.y)),this.vertexArray[t+0]=upperLeft.x,this.vertexArray[t+1]=upperLeft.y,this.vertexArray[t+2]=g.minX,this.vertexArray[t+3]=g.minY,this.vertexArray[t+4]=y,this.vertexArray[t+5]=lowerLeft.x,this.vertexArray[t+6]=lowerLeft.y,this.vertexArray[t+7]=g.minX,this.vertexArray[t+8]=g.maxY,this.vertexArray[t+9]=y,this.vertexArray[t+10]=upperRight.x,this.vertexArray[t+11]=upperRight.y,this.vertexArray[t+12]=g.maxX,this.vertexArray[t+13]=g.minY,this.vertexArray[t+14]=y,this.vertexArray[t+15]=upperRight.x,this.vertexArray[t+16]=upperRight.y,this.vertexArray[t+17]=g.maxX,this.vertexArray[t+18]=g.minY,this.vertexArray[t+19]=y,this.vertexArray[t+20]=lowerLeft.x,this.vertexArray[t+21]=lowerLeft.y,this.vertexArray[t+22]=g.minX,this.vertexArray[t+23]=g.maxY,this.vertexArray[t+24]=y,this.vertexArray[t+25]=lowerRight.x,this.vertexArray[t+26]=lowerRight.y,this.vertexArray[t+27]=g.maxX,this.vertexArray[t+28]=g.maxY,this.vertexArray[t+29]=y,t+=FLOAT_QUANTITY}const r=this.webGLBlock.gl;r.uniformMatrix3fv(this.shaderProgram.uniformLocations.uProjectionMatrix,!1,this.webGLBlock.projectionMatrixArray),this.instance.relativeTransform.matrix.copyToArray(this.transformMatrixArray),r.uniformMatrix3fv(this.shaderProgram.uniformLocations.uTransformMatrix,!1,this.transformMatrixArray),r.bindBuffer(r.ARRAY_BUFFER,this.vertexBuffer),n?r.bufferData(r.ARRAY_BUFFER,this.vertexArray,r.DYNAMIC_DRAW):r.bufferSubData(r.ARRAY_BUFFER,0,this.vertexArray.subarray(0,t));const s=Float32Array.BYTES_PER_ELEMENT,a=COMPONENTS*s;return r.vertexAttribPointer(this.shaderProgram.attributeLocations.aVertex,2,r.FLOAT,!1,a,0*s),r.vertexAttribPointer(this.shaderProgram.attributeLocations.aTextureCoord,2,r.FLOAT,!1,a,2*s),r.vertexAttribPointer(this.shaderProgram.attributeLocations.aAlpha,1,r.FLOAT,!1,a,4*s),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,this.spriteSheet.texture),r.uniform1i(this.shaderProgram.uniformLocations.uTexture,0),r.drawArrays(r.TRIANGLES,0,t/COMPONENTS),r.bindTexture(r.TEXTURE_2D,null),this.shaderProgram.unuse(),!this.hasDrawn&&platform.safari&&animationFrameTimer.setTimeout(()=>this.markDirty(),0),this.hasDrawn=!0,1}dispose(){this.node._sprites.forEach(e=>{e.imageProperty.unlink(this.spriteChangeListener)}),this.webGLBlock&&(this.webGLBlock=null),super.dispose()}markPaintDirty(){this.markDirty()}}SpritesWebGLDrawable.prototype.webglRenderer=Renderer.webglCustom;scenery.register("SpritesWebGLDrawable",SpritesWebGLDrawable);Poolable.mixInto(SpritesWebGLDrawable);const SpritesWebGLDrawable$1=SpritesWebGLDrawable;class TextCanvasDrawable extends PaintableStatelessDrawable$1(CanvasSelfDrawable){paintCanvas(e,t,n){const r=e.context;(t.hasFill()||t.hasPaintableStroke())&&(e.setFont(t._font.getFont()),e.setDirection("ltr")),t.hasFill()&&(t.beforeCanvasFill(e),r.fillText(t.renderedText,0,0),t.afterCanvasFill(e)),t.hasPaintableStroke()&&(t.beforeCanvasStroke(e),r.strokeText(t.renderedText,0,0),t.afterCanvasStroke(e))}markDirtyText(){this.markPaintDirty()}markDirtyFont(){this.markPaintDirty()}markDirtyBounds(){this.markPaintDirty()}}scenery.register("TextCanvasDrawable",TextCanvasDrawable);Poolable.mixInto(TextCanvasDrawable);const TextCanvasDrawable$1=TextCanvasDrawable,scratchMatrix$1=Matrix3.pool.fetch();class TextDOMDrawable extends TextStatefulDrawable$1(DOMSelfDrawable){constructor(e,t){super(e,t),Utils.prepareForTransform(this.domElement)}initialize(e,t){super.initialize(e,t),this.domElement||(this.domElement=document.createElement("div"),this.domElement.style.display="block",this.domElement.style.position="absolute",this.domElement.style.pointerEvents="none",this.domElement.style.left="0",this.domElement.style.top="0",this.domElement.setAttribute("dir","ltr"))}updateDOM(){const e=this.node,t=this.domElement;if(this.paintDirty&&(this.dirtyFont&&(t.style.font=e.getFont()),this.dirtyStroke&&(t.style.color=e.getCSSFill()),this.dirtyBounds&&(t.style.width=`${e.getSelfBounds().width}px`,t.style.height=`${e.getSelfBounds().height}px`),this.dirtyText&&(t.textContent=e.renderedText)),this.transformDirty||this.dirtyText||this.dirtyFont||this.dirtyBounds){const n=e.getSelfBounds().minY;scratchMatrix$1.set(this.getTransformMatrix());const r=Matrix3.translation(0,n);scratchMatrix$1.multiplyMatrix(r),r.freeToPool(),Utils.applyPreparedTransform(scratchMatrix$1,t)}this.setToCleanState(),this.cleanPaintableState(),this.transformDirty=!1}dispose(){super.dispose()}}scenery.register("TextDOMDrawable",TextDOMDrawable);Poolable.mixInto(TextDOMDrawable);const TextDOMDrawable$1=TextDOMDrawable,keepSVGTextElements=!0,useSVGTextLengthAdjustments=!platform.edge,useTransparentSVGTextWorkaround=platform.safari;class TextSVGDrawable extends TextStatefulDrawable$1(SVGSelfDrawable){initialize(e,t){if(super.initialize(e,t,!0,keepSVGTextElements),this.hasLength=!1,!this.svgElement){const n=document.createElementNS(svgns,"text");if(this.text=n,useTransparentSVGTextWorkaround){const r=document.createElementNS(svgns,"g");r.appendChild(n),this.svgElement=r,this.workaroundRect=document.createElementNS(svgns,"rect"),this.workaroundRect.setAttribute("fill","transparent"),r.appendChild(this.workaroundRect)}else this.svgElement=n;n.appendChild(document.createTextNode("")),n.setAttribute("dominant-baseline","alphabetic"),n.setAttribute("text-rendering","geometricPrecision"),n.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),n.setAttribute("direction","ltr")}}updateSVGSelf(){const e=this.text;if(this.dirtyFont&&(e.setAttribute("font-family",this.node._font.getFamily()),e.setAttribute("font-size",this.node._font.getSize()),e.setAttribute("font-style",this.node._font.getStyle()),e.setAttribute("font-weight",this.node._font.getWeight()),e.setAttribute("font-stretch",this.node._font.getStretch())),this.dirtyText&&(e.lastChild.nodeValue=Utils.safariEmbeddingMarkWorkaround(this.node.renderedText)),this.dirtyBounds&&useSVGTextLengthAdjustments&&(this.node._boundsMethod!=="accurate"&&isFinite(this.node.selfBounds.width)?(this.hasLength||(this.hasLength=!0,e.setAttribute("lengthAdjust","spacingAndGlyphs")),e.setAttribute("textLength",this.node.selfBounds.width)):this.hasLength&&(this.hasLength=!1,e.removeAttribute("lengthAdjust"),e.removeAttribute("textLength")),useTransparentSVGTextWorkaround)){const r=this.node.selfBounds.width*.2,s=this.node.selfBounds.height*.2;this.workaroundRect.setAttribute("x",this.node.selfBounds.minX-r),this.workaroundRect.setAttribute("y",this.node.selfBounds.minY-s),this.workaroundRect.setAttribute("width",this.node.selfBounds.width+2*r),this.workaroundRect.setAttribute("height",this.node.selfBounds.height+2*s)}this.updateFillStrokeStyle(e)}}scenery.register("TextSVGDrawable",TextSVGDrawable);Poolable.mixInto(TextSVGDrawable);const TextSVGDrawable$1=TextSVGDrawable;class WebGLNodeDrawable extends WebGLSelfDrawable{initialize(e,t){super.initialize(e,t),this.contextChangeListener=this.contextChangeListener||this.onWebGLContextChange.bind(this),this.painter=null}createPainter(){const e=this.node.painterType;return new e(this.webGLBlock.gl,this.node)}onWebGLContextChange(){this.painter=this.createPainter()}onAddToBlock(e){this.webGLBlock=e,this.painter=this.createPainter(),e.glChangedEmitter.addListener(this.contextChangeListener)}onRemoveFromBlock(e){e.glChangedEmitter.removeListener(this.contextChangeListener)}draw(){const e=this.instance.relativeTransform.matrix,t=this.painter.paint(e,this.webGLBlock.projectionMatrix);return assert&&assert(t===WebGLNode.PAINTED_SOMETHING||t===WebGLNode.PAINTED_NOTHING),assert&&assert(WebGLNode.PAINTED_NOTHING===0&&WebGLNode.PAINTED_SOMETHING===1,"Ensure we can pass the value through directly to indicate whether draw calls were made"),t}dispose(){this.painter.dispose(),this.painter=null,this.webGLBlock&&(this.webGLBlock=null),super.dispose()}markPaintDirty(){this.markDirty()}get shaderAttributes(){return this.node.shaderAttributes}}WebGLNodeDrawable.prototype.webglRenderer=Renderer.webglCustom;scenery.register("WebGLNodeDrawable",WebGLNodeDrawable);Poolable.mixInto(WebGLNodeDrawable);const WebGLNodeDrawable$1=WebGLNodeDrawable;class InlineCanvasCacheDrawable extends Drawable{constructor(e,t){super(),this.initialize(e,t)}initialize(e,t){super.initialize(e),this.instance=t}stitch(e,t,n,r){}}scenery.register("InlineCanvasCacheDrawable",InlineCanvasCacheDrawable);class SharedCanvasCacheDrawable extends Drawable{constructor(e,t,n,r){super(),this.initialize(e,t,n,r)}initialize(e,t,n,r){super.initialize(t),this.instance=n,this.sharedInstance=r}}scenery.register("SharedCanvasCacheDrawable",SharedCanvasCacheDrawable);class RelativeTransform{constructor(e){this.instance=e}initialize(e,t){return this.display=e,this.trail=t,this.node=t&&t.lastNode(),this.transformDirty=!0,this.nodeTransformListener=this.nodeTransformListener||this.onNodeTransformDirty.bind(this),this.matrix=this.matrix||Matrix3.identity(),this.relativeSelfDirty=!0,this.relativeChildrenListenersCount=0,this.relativePrecomputeCount=0,this.relativeChildrenPrecomputeCount=0,this.relativeFrameId=-1,this.relativeChildDirtyFrame=e?e._frameId:0,this.relativeTransformListeners=cleanArray(this.relativeTransformListeners),this}get parent(){return this.instance.parent?this.instance.parent.relativeTransform:null}addInstance(e){e.stateless?(assert&&assert(!e.relativeTransform.hasAncestorListenerNeed(),"We only track changes properly if stateless instances do not have needs"),assert&&assert(!e.relativeTransform.hasAncestorComputeNeed(),"We only track changes properly if stateless instances do not have needs")):(e.relativeTransform.hasAncestorListenerNeed()&&this.incrementTransformListenerChildren(),e.relativeTransform.hasAncestorComputeNeed()&&this.incrementTransformPrecomputeChildren()),e.relativeTransform.forceMarkTransformDirty()}removeInstance(e){e.relativeTransform.hasAncestorListenerNeed()&&this.decrementTransformListenerChildren(),e.relativeTransform.hasAncestorComputeNeed()&&this.decrementTransformPrecomputeChildren()}attachNodeListeners(){this.node.transformEmitter.addListener(this.nodeTransformListener)}detachNodeListeners(){this.node.transformEmitter.removeListener(this.nodeTransformListener)}hasDescendantListenerNeed(){return this.instance.isTransformed?this.relativeChildrenListenersCount>0:this.relativeChildrenListenersCount>0||this.relativeTransformListeners.length>0}hasAncestorListenerNeed(){return this.instance.isTransformed?this.relativeTransformListeners.length>0:this.relativeChildrenListenersCount>0||this.relativeTransformListeners.length>0}hasSelfListenerNeed(){return this.relativeTransformListeners.length>0}incrementTransformListenerChildren(){const e=this.hasAncestorListenerNeed();this.relativeChildrenListenersCount++,e!==this.hasAncestorListenerNeed()&&(assert&&assert(!this.instance.isTransformed,"Should not be a change in need if we have the isTransformed flag"),this.parent&&this.parent.incrementTransformListenerChildren())}decrementTransformListenerChildren(){const e=this.hasAncestorListenerNeed();this.relativeChildrenListenersCount--,e!==this.hasAncestorListenerNeed()&&(assert&&assert(!this.instance.isTransformed,"Should not be a change in need if we have the isTransformed flag"),this.parent&&this.parent.decrementTransformListenerChildren())}addListener(e){const t=this.hasAncestorListenerNeed();this.relativeTransformListeners.push(e),t!==this.hasAncestorListenerNeed()&&(this.parent&&this.parent.incrementTransformListenerChildren(),this.hasAncestorComputeNeed()||this.forceMarkTransformDirty())}removeListener(e){const t=this.hasAncestorListenerNeed();this.relativeTransformListeners.splice(_.indexOf(this.relativeTransformListeners,e),1),t!==this.hasAncestorListenerNeed()&&this.parent&&this.parent.decrementTransformListenerChildren()}hasDescendantComputeNeed(){return this.instance.isTransformed?this.relativeChildrenPrecomputeCount>0:this.relativeChildrenPrecomputeCount>0||this.relativePrecomputeCount>0}hasAncestorComputeNeed(){return this.instance.isTransformed?this.relativePrecomputeCount>0:this.relativeChildrenPrecomputeCount>0||this.relativePrecomputeCount>0}hasSelfComputeNeed(){return this.relativePrecomputeCount>0}incrementTransformPrecomputeChildren(){const e=this.hasAncestorComputeNeed();this.relativeChildrenPrecomputeCount++,e!==this.hasAncestorComputeNeed()&&(assert&&assert(!this.instance.isTransformed,"Should not be a change in need if we have the isTransformed flag"),this.parent&&this.parent.incrementTransformPrecomputeChildren())}decrementTransformPrecomputeChildren(){const e=this.hasAncestorComputeNeed();this.relativeChildrenPrecomputeCount--,e!==this.hasAncestorComputeNeed()&&(assert&&assert(!this.instance.isTransformed,"Should not be a change in need if we have the isTransformed flag"),this.parent&&this.parent.decrementTransformPrecomputeChildren())}addPrecompute(){const e=this.hasAncestorComputeNeed();this.relativePrecomputeCount++,e!==this.hasAncestorComputeNeed()&&(this.parent&&this.parent.incrementTransformPrecomputeChildren(),this.hasAncestorListenerNeed()||this.forceMarkTransformDirty())}removePrecompute(){const e=this.hasAncestorComputeNeed();this.relativePrecomputeCount--,e!==this.hasAncestorComputeNeed()&&this.parent&&this.parent.decrementTransformPrecomputeChildren()}onNodeTransformDirty(){this.transformDirty||this.forceMarkTransformDirty()}forceMarkTransformDirty(){this.transformDirty=!0,this.relativeSelfDirty=!0;const e=this.display._frameId;let t=this.instance.parent;for(;t&&t.relativeTransform.relativeChildDirtyFrame!==e;){const n=t.parent,r=t.isTransformed;if(t.relativeTransform.relativeChildDirtyFrame=e,n===null){this.display.markTransformRootDirty(t,r);break}else if(r){this.display.markTransformRootDirty(t,!0);break}t=n}}computeRelativeTransform(){const e=this.node.getMatrix();this.instance.parent&&!this.instance.parent.isTransformed?(this.matrix.set(this.parent.matrix),this.matrix.multiplyMatrix(e)):this.matrix.set(e),this.relativeFrameId=this.display._frameId,this.relativeSelfDirty=!1}isValidationNotNeeded(){return this.hasAncestorComputeNeed()||this.relativeFrameId===this.display._frameId}validate(){if(!this.isValidationNotNeeded()&&(this.instance.parent&&!this.instance.parent.isTransformed&&this.parent.validate(),this.relativeSelfDirty)){this.computeRelativeTransform();const e=this.instance.children.length;for(let t=0;t<e;t++)this.instance.children[t].relativeTransform.relativeSelfDirty=!0}}updateTransformListenersAndCompute(e,t,n,r){sceneryLog&&sceneryLog.RelativeTransform&&sceneryLog.RelativeTransform(`update/compute: ${this.toString()} ${e} => ${t}${r?" passTransform":""}`),sceneryLog&&sceneryLog.RelativeTransform&&sceneryLog.push();let s,a;if(r)for(s=this.instance.children.length,a=0;a<s;a++)this.instance.children[a].relativeTransform.updateTransformListenersAndCompute(!1,!1,n,!1);else{const h=e||this.relativeSelfDirty,c=h||this.relativeChildDirtyFrame===n,d=this.hasDescendantComputeNeed(),y=this.hasDescendantListenerNeed(),g=this.hasSelfComputeNeed(),D=this.hasSelfListenerNeed();if(!d&&h&&!t&&(this.relativeSelfDirty=!0),!c||!d&&!y&&!g&&!D){sceneryLog&&sceneryLog.RelativeTransform&&sceneryLog.pop();return}if(h&&(d||g)&&this.computeRelativeTransform(),this.transformDirty&&(this.transformDirty=!1),this.notifyRelativeTransformListeners(),!this.instance.isTransformed||r){const O=h&&!(d||g);for(s=this.instance.children.length,a=0;a<s;a++)this.instance.children[a].relativeTransform.updateTransformListenersAndCompute(h,O,n,!1)}}sceneryLog&&sceneryLog.RelativeTransform&&sceneryLog.pop()}notifyRelativeTransformListeners(){const e=this.relativeTransformListeners.length;for(let t=0;t<e;t++)this.relativeTransformListeners[t]()}audit(e,t){function n(s){const a=Matrix3.pool.fetch(),h=s.node.getMatrix();return s.parent?s.parent.isTransformed?a.set(h):(a.set(n(s.parent)),a.multiplyMatrix(h)):a.set(Matrix3.IDENTITY),a}function r(s){return t&&s.isValidationNotNeeded()?!1:s.relativeSelfDirty||s.parent&&r(s.parent)}if(assertSlow){let s=0,a=0;for(let h=0;h<this.instance.children.length;h++){const c=this.instance.children[h];c.relativeTransform.hasAncestorListenerNeed()&&s++,c.relativeTransform.hasAncestorComputeNeed()&&a++}if(assertSlow(s===this.relativeChildrenListenersCount,"Relative listener count invariant"),assertSlow(a===this.relativeChildrenPrecomputeCount,"Relative precompute count invariant"),assertSlow(!this.parent||this.instance.isTransformed||this.relativeChildDirtyFrame!==e||this.parent.relativeChildDirtyFrame===e,"If we have a parent, we need to hold the invariant this.relativeChildDirtyFrame => parent.relativeChildDirtyFrame"),!t&&!r(this)){const h=n(this);assertSlow(h.equals(this.matrix),"If there is no relativeSelfDirty flag set here or in our ancestors, our matrix should be up-to-date")}}}}scenery.register("RelativeTransform",RelativeTransform);class ChangeInterval{constructor(e,t){this.initialize(e,t)}initialize(e,t){assert&&assert(e===null||e instanceof Drawable,"drawableBefore can either be null to indicate that there is no un-changed drawable before our changes, or it can reference an un-changed drawable"),assert&&assert(t===null||t instanceof Drawable,"drawableAfter can either be null to indicate that there is no un-changed drawable after our changes, or it can reference an un-changed drawable"),this.nextChangeInterval=null,this.drawableBefore=e,this.drawableAfter=t,this.collapsedEmpty=!1}dispose(){this.nextChangeInterval=null,this.drawableBefore=null,this.drawableAfter=null,this.freeToPool()}constrict(){let e=!1;if(this.isEmpty())return!0;for(;this.drawableBefore&&this.drawableBefore.nextDrawable===this.drawableBefore.oldNextDrawable;)if(this.drawableBefore=this.drawableBefore.nextDrawable,e=!0,this.drawableBefore||(assert&&assert(!this.drawableAfter),this.collapsedEmpty=!0),this.isEmpty())return!0;for(;this.drawableAfter&&this.drawableAfter.previousDrawable===this.drawableAfter.oldPreviousDrawable;)if(this.drawableAfter=this.drawableAfter.previousDrawable,e=!0,this.drawableAfter||(assert&&assert(!this.drawableBefore),this.collapsedEmpty=!0),this.isEmpty())return!0;return e}isEmpty(){return this.collapsedEmpty||this.drawableBefore!==null&&this.drawableBefore===this.drawableAfter}getOldInternalDrawableCount(e,t){const n=this.drawableBefore?this.drawableBefore.oldNextDrawable:e,r=this.drawableAfter;let s=0;for(let a=n;a!==r;a=a.oldNextDrawable)s++;return s}getNewInternalDrawableCount(e,t){const n=this.drawableBefore?this.drawableBefore.nextDrawable:e,r=this.drawableAfter;let s=0;for(let a=n;a!==r;a=a.nextDrawable)s++;return s}static newForDisplay(e,t,n){const r=ChangeInterval.createFromPool(e,t);return n.markChangeIntervalToDispose(r),r}}scenery.register("ChangeInterval",ChangeInterval);Poolable.mixInto(ChangeInterval);class Fittability{constructor(e){this.instance=e}initialize(e,t){return this.display=e,this.trail=t,this.node=t&&t.lastNode(),this.selfFittable=!!t&&this.isSelfFitSupported(),this.ancestorsFittable=this.selfFittable,this.subtreeUnfittableCount=this.selfFittable?0:1,this.subtreeFittabilityChangeEmitter=this.subtreeFittabilityChangeEmitter||new TinyEmitter,this}get parent(){return this.instance.parent?this.instance.parent.fittability:null}checkSelfFittability(){const e=this.isSelfFitSupported();this.selfFittable!==e&&this.updateSelfFittable()}isSelfFitSupported(){return this.display._allowLayerFitting&&!this.node.isPreventFit()}markSubtreeFittable(){if(!this.selfFittable)return;this.ancestorsFittable=!0;const e=this.instance.children;for(let t=0;t<e.length;t++)e[t].fittability.markSubtreeFittable();this.instance.updateDrawableFittability(!0)}markSubtreeUnfittable(){if(!this.ancestorsFittable)return;this.ancestorsFittable=!1;const e=this.instance.children;for(let t=0;t<e.length;t++)e[t].fittability.markSubtreeUnfittable();this.instance.updateDrawableFittability(!1)}updateSelfFittable(){const e=this.isSelfFitSupported();assert&&assert(this.selfFittable!==e),this.selfFittable=e,this.selfFittable&&(!this.parent||this.parent.ancestorsFittable)?this.markSubtreeFittable():this.selfFittable||this.markSubtreeUnfittable(),this.selfFittable?this.decrementSubtreeUnfittableCount():this.incrementSubtreeUnfittableCount()}incrementSubtreeUnfittableCount(){this.subtreeUnfittableCount++,this.subtreeUnfittableCount===1&&(this.parent&&this.parent.incrementSubtreeUnfittableCount(),this.subtreeFittabilityChangeEmitter.emit())}decrementSubtreeUnfittableCount(){this.subtreeUnfittableCount--,this.subtreeUnfittableCount===0&&(this.parent&&this.parent.decrementSubtreeUnfittableCount(),this.subtreeFittabilityChangeEmitter.emit())}onInsert(e){this.ancestorsFittable||e.markSubtreeUnfittable(),e.subtreeUnfittableCount>0&&this.incrementSubtreeUnfittableCount()}onRemove(e){this.ancestorsFittable||e.markSubtreeFittable(),e.subtreeUnfittableCount>0&&this.decrementSubtreeUnfittableCount()}audit(){if(assertSlow){assertSlow(this.selfFittable===this.isSelfFitSupported(),"selfFittable diverged from isSelfFitSupported()"),assertSlow(this.ancestorsFittable===((this.parent?this.parent.ancestorsFittable:!0)&&this.selfFittable),"Our ancestorsFittable should be false if our parent or our self is not fittable.");let e=0;this.selfFittable||e++,_.each(this.instance.children,t=>{t.fittability.subtreeUnfittableCount>0&&e++}),assertSlow(this.subtreeUnfittableCount===e,"Incorrect subtreeUnfittableCount")}}}scenery.register("Fittability",Fittability);let globalId=1,clipGlobalId=1;class SVGGroup{constructor(e,t,n){this.id=`group${globalId++}`,this.initialize(e,t,n)}initialize(e,t,n){sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`initializing ${this.toString()}`),this.block=e,this.instance=t,this.node=t.trail.lastNode(),this.parent=n,this.children=cleanArray(this.children),this.hasSelfDrawable=!1,this.selfDrawable=null,this.dirty=!0,this.willApplyTransforms=this.block.transformRootInstance.trail.nodes.length<this.instance.trail.nodes.length,this.willApplyFilters=this.block.filterRootInstance.trail.nodes.length<this.instance.trail.nodes.length,this.transformDirty=!0,this.hasTransform=this.hasTransform!==void 0?this.hasTransform:!1,this.transformDirtyListener=this.transformDirtyListener||this.markTransformDirty.bind(this),this.willApplyTransforms&&this.node.transformEmitter.addListener(this.transformDirtyListener),this.filterDirty=!0,this.visibilityDirty=!0,this.clipDirty=!0,this.filterElement=this.filterElement||null,this.hasOpacity=this.hasOpacity!==void 0?this.hasOpacity:!1,this.hasFilter=!1,this.clipDefinition=this.clipDefinition!==void 0?this.clipDefinition:null,this.clipPath=this.clipPath!==void 0?this.clipPath:null,this.filterChangeListener=this.filterChangeListener||this.onFilterChange.bind(this),this.visibilityDirtyListener=this.visibilityDirtyListener||this.onVisibleChange.bind(this),this.clipDirtyListener=this.clipDirtyListener||this.onClipChange.bind(this),this.node.visibleProperty.lazyLink(this.visibilityDirtyListener),this.willApplyFilters&&this.node.filterChangeEmitter.addListener(this.filterChangeListener),this.node.clipAreaProperty.lazyLink(this.clipDirtyListener),this.orderDirty=!0,this.orderDirtyListener=this.orderDirtyListener||this.markOrderDirty.bind(this),this.node.childrenChangedEmitter.addListener(this.orderDirtyListener),this.svgGroup||(this.svgGroup=document.createElementNS(svgns,"g")),this.instance.addSVGGroup(this),this.block.markDirtyGroup(this)}addSelfDrawable(e){this.selfDrawable=e,this.svgGroup.insertBefore(e.svgElement,this.children.length?this.children[0].svgGroup:null),this.hasSelfDrawable=!0}removeSelfDrawable(e){this.hasSelfDrawable=!1,this.svgGroup.removeChild(e.svgElement),this.selfDrawable=null}addChildGroup(e){this.markOrderDirty(),e.parent=this,this.children.push(e),this.svgGroup.appendChild(e.svgGroup)}removeChildGroup(e){this.markOrderDirty(),e.parent=null,this.children.splice(_.indexOf(this.children,e),1),this.svgGroup.removeChild(e.svgGroup)}markDirty(){this.dirty||(this.dirty=!0,this.block.markDirtyGroup(this))}markOrderDirty(){this.orderDirty||(this.orderDirty=!0,this.markDirty())}markTransformDirty(){this.transformDirty||(this.transformDirty=!0,this.markDirty())}onFilterChange(){this.filterDirty||(this.filterDirty=!0,this.markDirty())}onVisibleChange(){this.visibilityDirty||(this.visibilityDirty=!0,this.markDirty())}onClipChange(){this.clipDirty||(this.clipDirty=!0,this.markDirty())}update(){if(sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`update: ${this.toString()}`),!this.block)return;sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.push();const e=this.svgGroup;if(this.dirty=!1,this.transformDirty&&(this.transformDirty=!1,sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`transform update: ${this.toString()}`),this.willApplyTransforms?this.node.transform.isIdentity()?this.hasTransform&&(this.hasTransform=!1,e.removeAttribute("transform")):(this.hasTransform=!0,e.setAttribute("transform",this.node.transform.getMatrix().getSVGTransform())):this.hasTransform&&(this.hasTransform=!1,e.removeAttribute("transform"))),this.visibilityDirty&&(this.visibilityDirty=!1,sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`visibility update: ${this.toString()}`),e.style.display=this.node.isVisible()?"":"none"),this.filterDirty){this.filterDirty=!1,sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`filter update: ${this.toString()}`);const t=this.node.effectiveOpacity;this.willApplyFilters&&t!==1?(this.hasOpacity=!0,e.setAttribute("opacity",t)):this.hasOpacity&&(this.hasOpacity=!1,e.removeAttribute("opacity"));const n=this.willApplyFilters&&this.node._filters.length,r=`filter-${this.id}`;if(n){for(this.filterElement||(this.filterElement=document.createElementNS(svgns,"filter"),this.filterElement.setAttribute("id",r));this.filterElement.firstChild;)this.filterElement.removeChild(this.filterElement.lastChild);let s=50,a="SourceGraphic";const h=this.node._filters.length;for(let y=0;y<h;y++){const g=this.node._filters[y],D=y===h-1?void 0:`e${y}`;g.applySVGFilter(this.filterElement,a,D),s+=g.filterRegionPercentageIncrease,a=D}const c=`-${toSVGNumber(s)}%`,d=`${toSVGNumber(2*s+100)}%`;this.filterElement.setAttribute("x",c),this.filterElement.setAttribute("y",c),this.filterElement.setAttribute("width",d),this.filterElement.setAttribute("height",d)}n&&(this.hasFilter||this.block.defs.appendChild(this.filterElement),e.setAttribute("filter",`url(#${r})`),this.hasFilter=!0),this.hasFilter&&!n&&(e.removeAttribute("filter"),this.hasFilter=!1,this.block.defs.removeChild(this.filterElement))}if(this.clipDirty)if(this.clipDirty=!1,sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`clip update: ${this.toString()}`),this.node.clipArea){if(!this.clipDefinition){const t=`clip${clipGlobalId++}`;this.clipDefinition=document.createElementNS(svgns,"clipPath"),this.clipDefinition.setAttribute("id",t),this.clipDefinition.setAttribute("clipPathUnits","userSpaceOnUse"),this.block.defs.appendChild(this.clipDefinition),this.clipPath=document.createElementNS(svgns,"path"),this.clipDefinition.appendChild(this.clipPath),e.setAttribute("clip-path",`url(#${t})`)}this.clipPath.setAttribute("d",this.node.clipArea.getSVGPath())}else this.clipDefinition&&(e.removeAttribute("clip-path"),this.block.defs.removeChild(this.clipDefinition),this.clipDefinition=null,this.clipPath=null);if(this.orderDirty){this.orderDirty=!1,sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`order update: ${this.toString()}`),sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.push();let t=this.children.length-1;const n=this.instance.children;for(let r=n.length-1;r>=0;r--){const s=n[r].lookupSVGGroup(this.block);if(s){if(this.children[t]!==s){sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`group out of order: ${t} for ${s.toString()}`),e.insertBefore(s.svgGroup,t+1>=this.children.length?null:this.children[t+1].svgGroup);const a=_.indexOf(this.children,s);assert&&assert(a<t,"The item we are moving backwards to location [idx] should not have an index greater than that"),this.children.splice(a,1),this.children.splice(t,0,s)}else sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`group in place: ${t} for ${s.toString()}`);t--}}sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.pop()}sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.pop()}isReleasable(){return!this.hasSelfDrawable&&!this.children.length&&this.parent}dispose(){sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`dispose ${this.toString()}`),sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.push(),assert&&assert(this.children.length===0,"Should be empty by now"),this.hasFilter&&(this.svgGroup.removeAttribute("filter"),this.hasFilter=!1,this.block.defs.removeChild(this.filterElement)),this.willApplyTransforms&&this.node.transformEmitter.removeListener(this.transformDirtyListener),this.node.visibleProperty.unlink(this.visibilityDirtyListener),this.willApplyFilters&&this.node.filterChangeEmitter.removeListener(this.filterChangeListener),this.node.clipAreaProperty.unlink(this.clipDirtyListener),this.node.childrenChangedEmitter.removeListener(this.orderDirtyListener),this.instance.active&&this.instance.removeSVGGroup(this),this.clipDefinition&&(this.svgGroup.removeAttribute("clip-path"),this.block.defs.removeChild(this.clipDefinition),this.clipDefinition=null,this.clipPath=null),this.parent=null,this.block=null,this.instance=null,this.node=null,cleanArray(this.children),this.selfDrawable=null,this.freeToPool(),sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.pop()}toString(){return`SVGGroup:${this.block.toString()}_${this.instance.toString()}`}static addDrawable(e,t){assert&&assert(t.instance,"Instance is required for a drawable to be grouped correctly in SVG"),SVGGroup.ensureGroupsToInstance(e,t.instance).addSelfDrawable(t)}static removeDrawable(e,t){t.instance.lookupSVGGroup(e).removeSelfDrawable(t),SVGGroup.releaseGroupsToInstance(e,t.instance)}static ensureGroupsToInstance(e,t){let n=t.lookupSVGGroup(e);if(!n){assert&&assert(t!==e.rootGroup.instance,"Making sure we do not walk past our rootGroup");const r=SVGGroup.ensureGroupsToInstance(e,t.parent);n=SVGGroup.createFromPool(e,t,r),r.addChildGroup(n)}return n}static releaseGroupsToInstance(e,t){const n=t.lookupSVGGroup(e);if(n.isReleasable()){const r=n.parent;r.removeChildGroup(n),SVGGroup.releaseGroupsToInstance(e,r.instance),n.dispose()}}}scenery.register("SVGGroup",SVGGroup);Poolable.mixInto(SVGGroup);class Block extends Drawable{initialize(e,t){assert&&assert(!e._isDisposing,"Should not create a block for a Display that is being disposed of"),assert&&assert(!e._isDisposed,"Should not create a block for a disposed Display"),super.initialize(t),this.display=e,this.drawableCount=0,this.used=!0,this.firstDrawable=null,this.lastDrawable=null,this.pendingFirstDrawable=null,this.pendingLastDrawable=null,this.previousBlock=null,this.nextBlock=null,this.zIndex=0,assertSlow&&(this.drawableList=cleanArray(this.drawableList))}dispose(){assert&&assert(this.drawableCount===0,"There should be no drawables on a block when it is disposed"),this.display=null,this.firstDrawable=null,this.lastDrawable=null,this.pendingFirstDrawable=null,this.pendingLastDrawable=null,this.previousBlock=null,this.nextBlock=null,assertSlow&&cleanArray(this.drawableList),super.dispose()}addDrawable(e){if(this.drawableCount++,this.markDirtyDrawable(e),assertSlow){const t=_.indexOf(this.drawableList,e);assertSlow&&assertSlow(t===-1,"Drawable should not be added when it has not been removed"),this.drawableList.push(e),assertSlow&&assertSlow(this.drawableCount===this.drawableList.length,"Count sanity check, to make sure our assertions are not buggy")}}removeDrawable(e){if(this.drawableCount--,this.markDirty(),assertSlow){const t=_.indexOf(this.drawableList,e);assertSlow&&assertSlow(t!==-1,"Drawable should be already added when it is removed"),this.drawableList.splice(t,1),assertSlow&&assertSlow(this.drawableCount===this.drawableList.length,"Count sanity check, to make sure our assertions are not buggy")}}onIntervalChange(e,t){}updateInterval(){(this.pendingFirstDrawable!==this.firstDrawable||this.pendingLastDrawable!==this.lastDrawable)&&(this.onIntervalChange(this.pendingFirstDrawable,this.pendingLastDrawable),this.firstDrawable=this.pendingFirstDrawable,this.lastDrawable=this.pendingLastDrawable)}notifyInterval(e,t){this.pendingFirstDrawable=e,this.pendingLastDrawable=t,this.updateInterval()}audit(e,t,n){if(assertSlow){super.audit(e,t,n);let r=0;if(!t){for(let s=this.firstDrawable;s!==null&&(s.audit(e,t,n),r++,s!==this.lastDrawable);s=s.nextDrawable);if(!e){assertSlow&&assertSlow(r===this.drawableCount,"drawableCount should match"),assertSlow&&assertSlow(this.firstDrawable===this.pendingFirstDrawable,"No pending first drawable"),assertSlow&&assertSlow(this.lastDrawable===this.pendingLastDrawable,"No pending last drawable");for(let s=this.firstDrawable;s!==null&&(assertSlow&&assertSlow(s.renderer===this.renderer,"Renderers should match"),assertSlow&&assertSlow(s.parentDrawable===this,"This block should be this drawable's parent"),assertSlow&&assertSlow(_.indexOf(this.drawableList,s)>=0),s!==this.lastDrawable);s=s.nextDrawable);}}}}}scenery.register("Block",Block);const Block$1=Block,scratchBounds2=Bounds2.NOTHING.copy();class FittedBlock extends Block$1{initialize(e,t,n,r){return super.initialize(e,t),this.transformRootInstance=n,assert&&assert(typeof n.isDisplayRoot=="boolean"),this.canBeFullDisplay=n.isDisplayRoot,assert&&assert(r===FittedBlock.FULL_DISPLAY||r===FittedBlock.COMMON_ANCESTOR),this.preferredFit=r,this.fit=r,this.dirtyFit=!0,this.commonFitInstance=null,this.fitBounds=Bounds2.NOTHING.copy(),this.oldFitBounds=Bounds2.NOTHING.copy(),this.unfittableDrawableCount=0,this.dirtyFitListener=this.dirtyFitListener||this.markDirtyFit.bind(this),this.fittableListener=this.fittableListener||this.onFittabilityChange.bind(this),this.display.sizeProperty.lazyLink(this.dirtyFitListener),this}setFit(e){!this.canBeFullDisplay&&e===FittedBlock.FULL_DISPLAY&&(e=FittedBlock.COMMON_ANCESTOR),this.fit!==e&&(this.fit=e,this.markDirtyFit(),this.oldFitBounds.set(Bounds2.NOTHING),e===FittedBlock.COMMON_ANCESTOR&&this.removeCommonFitInstance())}markDirtyFit(){sceneryLog&&sceneryLog.dirty&&sceneryLog.dirty(`markDirtyFit on FittedBlock#${this.id}`),this.dirtyFit=!0,this.markDirty()}updateFit(){if(assert&&assert(this.fit===FittedBlock.FULL_DISPLAY||this.fit===FittedBlock.COMMON_ANCESTOR,"Unsupported fit"),!(!this.dirtyFit&&this.fit===FittedBlock.FULL_DISPLAY))if(sceneryLog&&sceneryLog.FittedBlock&&sceneryLog.FittedBlock(`updateFit #${this.id}`),this.dirtyFit=!1,this.fit===FittedBlock.COMMON_ANCESTOR&&this.commonFitInstance===null&&this.addCommonFitInstance(this.computeCommonAncestorInstance()),this.fit===FittedBlock.COMMON_ANCESTOR&&this.commonFitInstance.fittability.subtreeUnfittableCount>0&&this.canBeFullDisplay&&(this.oldFitBounds.set(Bounds2.NOTHING),this.fit=FittedBlock.FULL_DISPLAY),this.fit===FittedBlock.FULL_DISPLAY)this.fitBounds.set(Bounds2.NOTHING),this.setSizeFullDisplay();else if(this.fit===FittedBlock.COMMON_ANCESTOR){assert&&assert(this.commonFitInstance.trail.length>=this.transformRootInstance.trail.length),this.fitBounds.set(this.commonFitInstance.node.getLocalBounds());let e=this.commonFitInstance;for(;e!==this.transformRootInstance;)this.fitBounds.transform(e.node.getMatrix()),e=e.parent;this.fitBounds.roundOut(),this.fitBounds.dilate(4),this.transformRootInstance.isDisplayRoot&&(scratchBounds2.setMinMax(0,0,this.display.width,this.display.height),this.fitBounds.constrainBounds(scratchBounds2)),this.fitBounds.isValid()||this.fitBounds.setMinMax(0,0,0,0),this.fitBounds.equals(this.oldFitBounds)||(this.oldFitBounds.set(this.fitBounds),this.setSizeFitBounds())}else throw new Error("unknown fit")}setSizeFullDisplay(){}setSizeFitBounds(){}addCommonFitInstance(e){assert&&assert(this.commonFitInstance===null),e&&(this.commonFitInstance=e,this.commonFitInstance.fittability.subtreeFittabilityChangeEmitter.addListener(this.dirtyFitListener))}removeCommonFitInstance(){this.commonFitInstance&&(this.commonFitInstance.fittability.subtreeFittabilityChangeEmitter.removeListener(this.dirtyFitListener),this.commonFitInstance=null)}dispose(){sceneryLog&&sceneryLog.FittedBlock&&sceneryLog.FittedBlock(`dispose #${this.id}`),this.display.sizeProperty.unlink(this.dirtyFitListener),this.removeCommonFitInstance(),this.transformRootInstance=null,super.dispose()}addDrawable(e){super.addDrawable(e),e.fittableProperty.lazyLink(this.fittableListener),e.fittable||this.incrementUnfittable()}removeDrawable(e){super.removeDrawable(e),e.fittableProperty.unlink(this.fittableListener),e.fittable||this.decrementUnfittable()}onFittabilityChange(e){e?this.decrementUnfittable():this.incrementUnfittable()}incrementUnfittable(){this.unfittableDrawableCount++,this.unfittableDrawableCount===1&&this.checkFitConstraints()}decrementUnfittable(){this.unfittableDrawableCount--,this.unfittableDrawableCount===0&&this.checkFitConstraints()}checkFitConstraints(){this.unfittableDrawableCount>0&&this.canBeFullDisplay?this.setFit(FittedBlock.FULL_DISPLAY):this.setFit(this.preferredFit)}computeCommonAncestorInstance(){assert&&assert(this.firstDrawable.instance&&this.lastDrawable.instance,"For common-ancestor fits, we need the first and last drawables to have direct instance references");let e=this.firstDrawable.instance,t=this.lastDrawable.instance;const n=Math.min(e.trail.length,t.trail.length);for(;e.trail.length>n;)e=e.parent;for(;t.trail.length>n;)t=t.parent;for(;e!==t;)e=e.parent,t=t.parent;const r=e;return assert&&assert(r.trail.length>=this.transformRootInstance.trail.length),r}onIntervalChange(e,t){sceneryLog&&sceneryLog.FittedBlock&&sceneryLog.FittedBlock(`#${this.id}.onIntervalChange ${e.toString()} to ${t.toString()}`),super.onIntervalChange(e,t),this.fit===FittedBlock.COMMON_ANCESTOR&&(this.removeCommonFitInstance(),this.markDirtyFit())}}scenery.register("FittedBlock",FittedBlock);FittedBlock.FULL_DISPLAY=1;FittedBlock.COMMON_ANCESTOR=2;FittedBlock.fitString={1:"fullDisplay",2:"commonAncestor"};const FittedBlock$1=FittedBlock,scratchMatrix=new Matrix3,scratchMatrix2=new Matrix3;class CanvasBlock extends FittedBlock$1{constructor(e,t,n,r){super(),this.initialize(e,t,n,r)}initialize(e,t,n,r){super.initialize(e,t,n,FittedBlock$1.COMMON_ANCESTOR),this.filterRootInstance=r,this.dirtyDrawables=cleanArray(this.dirtyDrawables),this.domElement||(this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.left="0",this.canvas.style.top="0",this.canvas.style.pointerEvents="none",this.canvasId=this.canvas.id=`scenery-canvas${this.id}`,this.context=this.canvas.getContext("2d"),this.context.save(),this.context.miterLimit=20,this.context.miterLimit=10,this.wrapper=new CanvasContextWrapper(this.canvas,this.context),this.domElement=this.canvas,this.wrapperStack=[this.wrapper]),this.wrapperStackIndex=0,this.filterListenerCountMap=this.filterListenerCountMap||{},Utils.prepareForTransform(this.canvas),Utils.unsetTransform(this.canvas),this.canvasDrawOffset=new Vector2(0,0),this.currentDrawable=null,this.clipDirty=!0,this.clipCount=0,this.backingScale=t&Renderer.bitmaskCanvasLowResolution?1:Utils.backingScale(this.context),this.clipDirtyListener=this.markDirty.bind(this),this.opacityDirtyListener=this.markDirty.bind(this),sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`initialized #${this.id}`)}setSizeFullDisplay(){const e=this.display.getSize();this.canvas.width=e.width*this.backingScale,this.canvas.height=e.height*this.backingScale,this.canvas.style.width=`${e.width}px`,this.canvas.style.height=`${e.height}px`,this.wrapper.resetStyles(),this.canvasDrawOffset.setXY(0,0),Utils.unsetTransform(this.canvas)}setSizeFitBounds(){const e=this.fitBounds.minX,t=this.fitBounds.minY;this.canvasDrawOffset.setXY(-e,-t),Utils.setTransform(`matrix(1,0,0,1,${e},${t})`,this.canvas),this.canvas.width=this.fitBounds.width*this.backingScale,this.canvas.height=this.fitBounds.height*this.backingScale,this.canvas.style.width=`${this.fitBounds.width}px`,this.canvas.style.height=`${this.fitBounds.height}px`,this.wrapper.resetStyles()}update(){if(!super.update())return!1;for(sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`update #${this.id}`),sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.push();this.dirtyDrawables.length;)this.dirtyDrawables.pop().update();this.updateFit(),this.context.restore(),this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.save(),this.wrapper.resetStyles(),this.currentDrawable=null;for(let e=this.firstDrawable;e!==null&&(this.renderDrawable(e),e!==this.lastDrawable);e=e.nextDrawable);return this.currentDrawable&&this.walkDown(this.currentDrawable.instance.trail,0),assert&&assert(this.clipCount===0,"clipCount should be zero after walking back down"),sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.pop(),!0}applyClip(e){this.clipDirty=!1,sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`Apply clip ${e.instance.trail.toDebugString()}`),sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.push();const t=this.wrapperStack[this.wrapperStackIndex],n=t.context;if(n.restore(),n.save(),t.resetStyles(),this.clipCount){const s=e.instance.trail;scratchMatrix.rowMajor(this.backingScale,0,this.canvasDrawOffset.x*this.backingScale,0,this.backingScale,this.canvasDrawOffset.y*this.backingScale,0,0,1),scratchMatrix2.set(this.transformRootInstance.trail.getMatrix()).invert(),scratchMatrix2.multiplyMatrix(scratchMatrix).canvasSetTransform(n);for(let a=0;a<s.length;a++){const h=s.nodes[a];h.getMatrix().canvasAppendTransform(n),h.hasClipArea()&&(n.beginPath(),h.clipArea.writeToContext(n),n.clip())}}sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.pop()}pushWrapper(){if(this.wrapperStackIndex++,this.clipDirty=!0,this.wrapperStackIndex===this.wrapperStack.length){const n=document.createElement("canvas"),r=n.getContext("2d");r.save(),this.wrapperStack.push(new CanvasContextWrapper(n,r))}const e=this.wrapperStack[this.wrapperStackIndex],t=e.context;e.setDimensions(this.canvas.width,this.canvas.height),t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,this.canvas.width,this.canvas.height)}popWrapper(){this.wrapperStackIndex--,this.clipDirty=!0}walkDown(e,t){const n=this.filterRootInstance.trail.length-1;for(let r=e.length-1;r>=t;r--){const s=e.nodes[r];if(s.hasClipArea()&&(sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`Pop clip ${e.subtrailTo(s).toDebugString()}`),this.clipCount--,this.clipDirty=!0),r>n){if(s._filters.length){sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`Pop filters ${e.subtrailTo(s).toDebugString()}`);const a=this.wrapperStack[this.wrapperStackIndex],h=this.wrapperStack[this.wrapperStackIndex-1];this.popWrapper(),h.context.setTransform(1,0,0,1,0,0);const c=s._filters;let d=Features.canvasFilter;for(let y=0;y<c.length;y++)d=d&&c[y].isDOMCompatible();if(d){let y="";for(let g=0;g<c.length;g++)y+=`${y?" ":""}${c[g].getCSSFilterString()}`;h.context.filter=y,h.context.drawImage(a.canvas,0,0),h.context.filter="none"}else{for(let y=0;y<c.length;y++)c[y].applyCanvasFilter(a);h.context.drawImage(a.canvas,0,0)}}if(s.getEffectiveOpacity()!==1){sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`Pop opacity ${e.subtrailTo(s).toDebugString()}`);const a=this.wrapperStack[this.wrapperStackIndex],h=this.wrapperStack[this.wrapperStackIndex-1];this.popWrapper(),h.context.setTransform(1,0,0,1,0,0),h.context.globalAlpha=s.getEffectiveOpacity(),h.context.drawImage(a.canvas,0,0),h.context.globalAlpha=1}}}}walkUp(e,t){const n=this.filterRootInstance.trail.length-1;for(let r=t;r<e.length;r++){const s=e.nodes[r];r>n&&(s.getEffectiveOpacity()!==1&&(sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`Push opacity ${e.subtrailTo(s).toDebugString()}`),this.pushWrapper()),s._filters.length&&(sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`Push filters ${e.subtrailTo(s).toDebugString()}`),this.pushWrapper())),s.hasClipArea()&&(sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`Push clip ${e.subtrailTo(s).toDebugString()}`),this.clipCount++,this.clipDirty=!0)}}renderDrawable(e){if(!e.visible||this.canvas.width===0||this.canvas.height===0)return;sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`renderDrawable #${e.id} ${e.instance.trail.toDebugString()}`),sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.push();const t=this.currentDrawable?e.instance.getBranchIndexTo(this.currentDrawable.instance):0;this.currentDrawable&&this.walkDown(this.currentDrawable.instance.trail,t),this.walkUp(e.instance.trail,t);const n=this.wrapperStack[this.wrapperStackIndex],r=n.context;this.clipDirty&&this.applyClip(e),assert&&assert(e.instance.relativeTransform.isValidationNotNeeded());const s=e.instance.relativeTransform.matrix;r.setTransform(this.backingScale,0,0,this.backingScale,this.canvasDrawOffset.x*this.backingScale,this.canvasDrawOffset.y*this.backingScale),e.instance!==this.transformRootInstance&&s.canvasAppendTransform(r),e.paintCanvas(n,e.instance.node,e.instance.relativeTransform.matrix),this.currentDrawable=e,sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.pop()}dispose(){sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`dispose #${this.id}`),this.transformRootInstance=null,cleanArray(this.dirtyDrawables),this.canvas.width=0,this.canvas.height=0,super.dispose()}markDirtyDrawable(e){sceneryLog&&sceneryLog.dirty&&sceneryLog.dirty(`markDirtyDrawable on CanvasBlock#${this.id} with ${e.toString()}`),assert&&assert(e),assert&&this.display.ensureNotPainting(),this.dirtyDrawables.push(e),this.markDirty()}addDrawable(e){sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`#${this.id}.addDrawable ${e.toString()}`),super.addDrawable(e);for(let t=e.instance;t&&t!==this.filterRootInstance;t=t.parent){const n=t.node;this.filterListenerCountMap[n.id]?this.filterListenerCountMap[n.id]++:(this.filterListenerCountMap[n.id]=1,n.filterChangeEmitter.addListener(this.opacityDirtyListener),n.clipAreaProperty.lazyLink(this.clipDirtyListener))}}removeDrawable(e){sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`#${this.id}.removeDrawable ${e.toString()}`);for(let t=e.instance;t&&t!==this.filterRootInstance;t=t.parent){const n=t.node;assert&&assert(this.filterListenerCountMap[n.id]>0),this.filterListenerCountMap[n.id]--,this.filterListenerCountMap[n.id]===0&&(delete this.filterListenerCountMap[n.id],n.clipAreaProperty.unlink(this.clipDirtyListener),n.filterChangeEmitter.removeListener(this.opacityDirtyListener))}super.removeDrawable(e)}onIntervalChange(e,t){sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`#${this.id}.onIntervalChange ${e.toString()} to ${t.toString()}`),super.onIntervalChange(e,t),this.markDirty()}onPotentiallyMovedDrawable(e){sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`#${this.id}.onPotentiallyMovedDrawable ${e.toString()}`),sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.push(),assert&&assert(e.parentDrawable===this),e.markDirty(),sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.pop()}toString(){return`CanvasBlock#${this.id}-${FittedBlock$1.fitString[this.fit]}`}}scenery.register("CanvasBlock",CanvasBlock);Poolable.mixInto(CanvasBlock);const CanvasBlock$1=CanvasBlock;class DOMBlock extends Block$1{constructor(e,t){super(),this.initialize(e,t)}initialize(e,t){return super.initialize(e,t.renderer),this.domDrawable=t,this.domElement=t.domElement,this}update(){return super.update()?(this.domDrawable.update(),!0):!1}dispose(){this.domDrawable=null,this.domElement=null,super.dispose()}markDirtyDrawable(e){this.markDirty()}addDrawable(e){sceneryLog&&sceneryLog.DOMBlock&&sceneryLog.DOMBlock(`#${this.id}.addDrawable ${e.toString()}`),assert&&assert(this.domDrawable===e,"DOMBlock should only be used with one drawable for now (the one it was initialized with)"),super.addDrawable(e)}removeDrawable(e){sceneryLog&&sceneryLog.DOMBlock&&sceneryLog.DOMBlock(`#${this.id}.removeDrawable ${e.toString()}`),assert&&assert(this.domDrawable===e,"DOMBlock should only be used with one drawable for now (the one it was initialized with)"),super.removeDrawable(e)}}scenery.register("DOMBlock",DOMBlock);Poolable.mixInto(DOMBlock);const DOMBlock$1=DOMBlock;class SVGBlock extends FittedBlock$1{constructor(e,t,n,r){super(),this.initialize(e,t,n,r)}initialize(e,t,n,r){super.initialize(e,t,n,FittedBlock$1.COMMON_ANCESTOR),this.filterRootInstance=r,this.dirtyGradients=cleanArray(this.dirtyGradients),this.dirtyGroups=cleanArray(this.dirtyGroups),this.dirtyDrawables=cleanArray(this.dirtyDrawables),this.paintCountMap=this.paintCountMap||new CountMap(this.onAddPaint.bind(this),this.onRemovePaint.bind(this)),this.areReferencesReduced=!0,this.domElement||(this.svg=document.createElementNS(svgns,"svg"),this.svg.style.pointerEvents="none",this.svg.style.position="absolute",this.svg.style.left="0",this.svg.style.top="0",this.svg.setAttribute("focusable",!1),this.defs=document.createElementNS(svgns,"defs"),this.svg.appendChild(this.defs),this.baseTransformGroup=document.createElementNS(svgns,"g"),this.svg.appendChild(this.baseTransformGroup),this.domElement=this.svg),this.forceRefreshListener=()=>{if(!this.workaroundRect){const d=document.createElementNS(svgns,"g");this.svg.appendChild(d),this.workaroundRect=document.createElementNS(svgns,"rect"),this.workaroundRect.setAttribute("width","0"),this.workaroundRect.setAttribute("height","0"),this.workaroundRect.setAttribute("fill","none"),d.appendChild(this.workaroundRect)}const a=dotRandom.nextIntBetween(0,255),h=dotRandom.nextIntBetween(0,255),c=dotRandom.nextIntBetween(0,255);this.workaroundRect.setAttribute("fill",`rgba(${a},${h},${c},0.02)`)},this.display._refreshSVGEmitter.addListener(this.forceRefreshListener),Utils.prepareForTransform(this.svg),Utils.unsetTransform(this.svg),this.baseTransformGroup.setAttribute("transform","");const s=n.trail.nodes.length>r.trail.nodes.length?r:n;return this.rootGroup=SVGGroup.createFromPool(this,s,null),this.baseTransformGroup.appendChild(this.rootGroup.svgGroup),sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`initialized #${this.id}`),this}onAddPaint(e){const t=e.createSVGPaint(this);return t.definition.setAttribute("id",`${e.id}-${this.id}`),this.defs.appendChild(t.definition),t}onRemovePaint(e,t){this.defs.removeChild(t.definition),t.dispose()}incrementPaint(e){assert&&assert(e.isPaint),sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`incrementPaint ${this} ${e}`),this.paintCountMap.increment(e)}decrementPaint(e){assert&&assert(e.isPaint),sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`decrementPaint ${this} ${e}`),this.paintCountMap.decrement(e)}markDirtyGradient(e){this.dirtyGradients.push(e),this.markDirty()}markDirtyGroup(e){this.dirtyGroups.push(e),this.markDirty(),this.areReferencesReduced&&this.display.markForReducedReferences(this),this.areReferencesReduced=!1}markDirtyDrawable(e){sceneryLog&&sceneryLog.dirty&&sceneryLog.dirty(`markDirtyDrawable on SVGBlock#${this.id} with ${e.toString()}`),this.dirtyDrawables.push(e),this.markDirty(),this.areReferencesReduced&&this.display.markForReducedReferences(this),this.areReferencesReduced=!1}setSizeFullDisplay(){sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`setSizeFullDisplay #${this.id}`),this.baseTransformGroup.removeAttribute("transform"),Utils.unsetTransform(this.svg);const e=this.display.getSize();this.svg.setAttribute("width",e.width),this.svg.setAttribute("height",e.height)}setSizeFitBounds(){sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`setSizeFitBounds #${this.id} with ${this.fitBounds.toString()}`);const e=this.fitBounds.minX,t=this.fitBounds.minY;assert&&assert(isFinite(e)&&isFinite(t),"Invalid SVG transform for SVGBlock"),assert&&assert(this.fitBounds.isValid(),"Invalid fitBounds"),this.baseTransformGroup.setAttribute("transform",`translate(${-e},${-t})`),Utils.setTransform(`matrix(1,0,0,1,${e},${t})`,this.svg),this.svg.setAttribute("width",this.fitBounds.width),this.svg.setAttribute("height",this.fitBounds.height)}update(){if(!super.update())return!1;for(sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`update #${this.id}`);this.dirtyGroups.length;){const e=this.dirtyGroups.pop();e.block===this&&e.update()}for(;this.dirtyGradients.length;)this.dirtyGradients.pop().update();for(;this.dirtyDrawables.length;){const e=this.dirtyDrawables.pop();e.parentDrawable===this&&e.update()}return this.areReferencesReduced=!0,this.updateFit(),!0}reduceReferences(){if(this.areReferencesReduced)return;let e=0,t=0;for(;e<this.dirtyGroups.length;){const n=this.dirtyGroups[e];n.block===this&&(t!==e&&(this.dirtyGroups[t]=n),t++),e++}for(;this.dirtyGroups.length>t;)this.dirtyGroups.pop();for(e=0,t=0;e<this.dirtyDrawables.length;){const n=this.dirtyDrawables[e];n.parentDrawable===this&&(t!==e&&(this.dirtyDrawables[t]=n),t++),e++}for(;this.dirtyDrawables.length>t;)this.dirtyDrawables.pop();this.areReferencesReduced=!0}dispose(){for(sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`dispose #${this.id}`),this.svg.setAttribute("width","0"),this.svg.setAttribute("height","0"),this.filterRootInstance=null,cleanArray(this.dirtyGradients),cleanArray(this.dirtyGroups),cleanArray(this.dirtyDrawables),this.paintCountMap.clear(),this.display._refreshSVGEmitter.removeListener(this.forceRefreshListener),this.baseTransformGroup.removeChild(this.rootGroup.svgGroup),this.rootGroup.dispose(),this.rootGroup=null;this.defs.childNodes.length;)this.defs.removeChild(this.defs.childNodes[0]);super.dispose()}addDrawable(e){sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`#${this.id}.addDrawable ${e.toString()}`),super.addDrawable(e),SVGGroup.addDrawable(this,e),e.updateSVGBlock(this)}removeDrawable(e){sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`#${this.id}.removeDrawable ${e.toString()}`),SVGGroup.removeDrawable(this,e),super.removeDrawable(e)}onIntervalChange(e,t){sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`#${this.id}.onIntervalChange ${e.toString()} to ${t.toString()}`),super.onIntervalChange(e,t)}toString(){return`SVGBlock#${this.id}-${FittedBlock$1.fitString[this.fit]}`}}scenery.register("SVGBlock",SVGBlock);Poolable.mixInto(SVGBlock);class WebGLBlock extends FittedBlock$1{constructor(e,t,n,r){super(),this.initialize(e,t,n,r)}initialize(e,t,n,r){return sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`initialize #${this.id}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push(),super.initialize(e,t,n,FittedBlock$1.FULL_DISPLAY),this.filterRootInstance=r,this.preserveDrawingBuffer=e._preserveDrawingBuffer,this.dirtyDrawables=cleanArray(this.dirtyDrawables),this.spriteSheets=this.spriteSheets||[],this.projectionMatrix=this.projectionMatrix||new Matrix3,this.projectionMatrixArray=new Float32Array(9),this.customProcessor=this.customProcessor||new CustomProcessor,this.vertexColorPolygonsProcessor=this.vertexColorPolygonsProcessor||new VertexColorPolygons(this.projectionMatrixArray),this.texturedTrianglesProcessor=this.texturedTrianglesProcessor||new TexturedTrianglesProcessor(this.projectionMatrixArray),this.glChangedEmitter=new TinyEmitter,this.isContextLost=!1,this.contextLostListener=this.onContextLoss.bind(this),this.contextRestoreListener=this.onContextRestoration.bind(this),this.domElement||(this.domElement=document.createElement("div"),this.domElement.className="webgl-container",this.domElement.style.position="absolute",this.domElement.style.left="0",this.domElement.style.top="0",this.rebuildCanvas()),this.gl.clear(this.gl.COLOR_BUFFER_BIT),Utils.prepareForTransform(this.canvas),Utils.unsetTransform(this.canvas),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop(),this}rebuildCanvas(){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`rebuildCanvas #${this.id}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push();const e=document.createElement("canvas"),t=this.getContextFromCanvas(e);assert&&assert(t||this.canvas,"We should have a WebGL context by now"),t&&(this.canvas&&(this.domElement.removeChild(this.canvas),this.canvas.removeEventListener("webglcontextlost",this.contextLostListener,!1),this.canvas.removeEventListener("webglcontextrestored",this.contextRestoreListener,!1)),this.canvas=e,this.canvas.style.pointerEvents="none",this.canvasId=this.canvas.id=`scenery-webgl${this.id}`,this.canvas.addEventListener("webglcontextlost",this.contextLostListener,!1),this.canvas.addEventListener("webglcontextrestored",this.contextRestoreListener,!1),this.domElement.appendChild(this.canvas),this.setupContext(t)),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop()}setupContext(e){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`setupContext #${this.id}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push(),assert&&assert(e,"Should have an actual context if this is called"),this.isContextLost=!1,this.gl=e,this.backingScale=Utils.backingScale(this.gl),this.display._allowBackingScaleAntialiasing&&e.getParameter(e.SAMPLES)===0&&(this.backingScale*=2),this.originalBackingScale=this.backingScale,Utils.applyWebGLContextDefaults(this.gl),this.markDirty(),this.dirtyFit=!0,this.customProcessor.initializeContext(this.gl),this.vertexColorPolygonsProcessor.initializeContext(this.gl),this.texturedTrianglesProcessor.initializeContext(this.gl);for(let t=0;t<this.spriteSheets.length;t++)this.spriteSheets[t].initializeContext(this.gl);this.glChangedEmitter.emit(),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop()}delayedRebuildCanvas(){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`Delaying rebuilding of Canvas #${this.id}`);const e=this;window.setTimeout(function(){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`Executing delayed rebuilding #${this.id}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push(),e.rebuildCanvas(),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop()})}onContextLoss(e){this.isContextLost||(sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`Context lost #${this.id}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push(),this.isContextLost=!0,e.preventDefault(),this.canvas.style.display="none",this.markDirty(),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop())}onContextRestoration(e){if(this.isContextLost){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`Context restored #${this.id}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push();const t=this.getContextFromCanvas(this.canvas);assert&&assert(t,"We were told the context was restored, so this should work"),this.setupContext(t),this.canvas.style.display="",sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop()}}getContextFromCanvas(e){const t={antialias:!0,preserveDrawingBuffer:this.preserveDrawingBuffer};return e.getContext("webgl",t)||e.getContext("experimental-webgl",t)}setSizeFullDisplay(){const e=this.display.getSize();this.canvas.width=Math.ceil(e.width*this.backingScale),this.canvas.height=Math.ceil(e.height*this.backingScale),this.canvas.style.width=`${e.width}px`,this.canvas.style.height=`${e.height}px`}setSizeFitBounds(){throw new Error("setSizeFitBounds unimplemented for WebGLBlock")}update(){if(!super.update())return!1;sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`update #${this.id}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push();const e=this.gl;for(this.isContextLost&&this.display._aggressiveContextRecreation&&this.delayedRebuildCanvas();this.dirtyDrawables.length;)this.dirtyDrawables.pop().update();const t=this.spriteSheets.length;for(let s=0;s<t;s++)this.spriteSheets[s].updateTexture();this.firstDrawable&&this.firstDrawable===this.lastDrawable&&this.firstDrawable.node&&this.firstDrawable.node._webglScale!==null&&this.backingScale!==this.originalBackingScale*this.firstDrawable.node._webglScale&&(this.backingScale=this.originalBackingScale*this.firstDrawable.node._webglScale,this.dirtyFit=!0),this.updateFit(),this.projectionMatrix.rowMajor(2/this.display.width,0,-1,0,-2/this.display.height,1,0,0,1),this.projectionMatrix.copyToArray(this.projectionMatrixArray),this.preserveDrawingBuffer&&e.clear(e.COLOR_BUFFER_BIT),e.viewport(0,0,this.canvas.width,this.canvas.height);let n=null,r=0;for(let s=this.firstDrawable;s!==null;s=s.nextDrawable){if(s.visible){let a=null;s.webglRenderer===Renderer.webglTexturedTriangles?a=this.texturedTrianglesProcessor:s.webglRenderer===Renderer.webglCustom?a=this.customProcessor:s.webglRenderer===Renderer.webglVertexColorPolygons&&(a=this.vertexColorPolygonsProcessor),assert&&assert(a),a!==n&&(n&&(r+=n.deactivate()),n=a,n.activate()),n.processDrawable(s)}if(s===this.lastDrawable)break}return n&&(r+=n.deactivate()),r===0&&!this.preserveDrawingBuffer&&e.clear(e.COLOR_BUFFER_BIT),e.flush(),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop(),!0}dispose(){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`dispose #${this.id}`),cleanArray(this.dirtyDrawables),super.dispose()}markDirtyDrawable(e){sceneryLog&&sceneryLog.dirty&&sceneryLog.dirty(`markDirtyDrawable on WebGLBlock#${this.id} with ${e.toString()}`),assert&&assert(e),assert&&assert(!e.isDisposed),this.dirtyDrawables.push(e),this.markDirty()}addDrawable(e){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`#${this.id}.addDrawable ${e.toString()}`),super.addDrawable(e),e.onAddToBlock(this)}removeDrawable(e){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`#${this.id}.removeDrawable ${e.toString()}`);let t=0;for(;(t=this.dirtyDrawables.indexOf(e,t))>=0;)this.dirtyDrawables.splice(t,1);e.onRemoveFromBlock(this),super.removeDrawable(e)}addSpriteSheetImage(e,t,n){let r=null;const s=this.spriteSheets.length;for(let a=0;a<s&&(r=this.spriteSheets[a].addImage(e,t,n),!r);a++);if(!r){const a=new SpriteSheet(!0);if(r=a.addImage(e,t,n),a.initializeContext(this.gl),this.spriteSheets.push(a),!r)throw new Error("Attempt to load image that is too large for sprite sheets")}return r}removeSpriteSheetImage(e){e.spriteSheet.removeImage(e.image)}onIntervalChange(e,t){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`#${this.id}.onIntervalChange ${e.toString()} to ${t.toString()}`),super.onIntervalChange(e,t),this.markDirty()}onPotentiallyMovedDrawable(e){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`#${this.id}.onPotentiallyMovedDrawable ${e.toString()}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push(),assert&&assert(e.parentDrawable===this),this.markDirty(),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop()}toString(){return`WebGLBlock#${this.id}-${FittedBlock$1.fitString[this.fit]}`}}scenery.register("WebGLBlock",WebGLBlock);class Processor{activate(){}initializeContext(e){}processDrawable(e){}deactivate(){}}class CustomProcessor extends Processor{constructor(){super(),this.drawable=null}activate(){this.drawCount=0}processDrawable(e){assert&&assert(e.webglRenderer===Renderer.webglCustom),this.drawable=e,this.draw()}deactivate(){return this.drawCount}draw(){if(this.drawable){const e=this.drawable.draw();assert&&assert(typeof e=="number"),this.drawCount+=e,this.drawable=null}}}class VertexColorPolygons extends Processor{constructor(e){assert&&assert(e instanceof Float32Array),super(),this.projectionMatrixArray=e,this.lastArrayLength=128,this.vertexArray=new Float32Array(this.lastArrayLength)}initializeContext(e){assert&&assert(e,"Should be an actual context"),this.gl=e,this.shaderProgram=new ShaderProgram(e,["attribute vec2 aVertex;","attribute vec4 aColor;","varying vec4 vColor;","uniform mat3 uProjectionMatrix;","void main() {","  vColor = aColor;","  vec3 ndc = uProjectionMatrix * vec3( aVertex, 1.0 );","  gl_Position = vec4( ndc.xy, 0.0, 1.0 );","}"].join(`
`),["precision mediump float;","varying vec4 vColor;","void main() {","  gl_FragColor = vec4( vColor.rgb * vColor.a, vColor.a );","}"].join(`
`),{attributes:["aVertex","aColor"],uniforms:["uProjectionMatrix"]}),this.vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertexArray,e.DYNAMIC_DRAW)}activate(){this.shaderProgram.use(),this.vertexArrayIndex=0,this.drawCount=0}processDrawable(e){if(e.includeVertices){const t=e.vertexArray;for(;t.length+this.vertexArrayIndex>this.vertexArray.length;){const n=new Float32Array(this.vertexArray.length*2);n.set(this.vertexArray),this.vertexArray=n}this.vertexArray.set(t,this.vertexArrayIndex),this.vertexArrayIndex+=t.length,this.drawCount++}}deactivate(){return this.drawCount&&this.draw(),this.shaderProgram.unuse(),this.drawCount}draw(){const e=this.gl;e.uniformMatrix3fv(this.shaderProgram.uniformLocations.uProjectionMatrix,!1,this.projectionMatrixArray),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray.length>this.lastArrayLength?e.bufferData(e.ARRAY_BUFFER,this.vertexArray,e.DYNAMIC_DRAW):e.bufferSubData(e.ARRAY_BUFFER,0,this.vertexArray.subarray(0,this.vertexArrayIndex));const t=Float32Array.BYTES_PER_ELEMENT,n=6*t;e.vertexAttribPointer(this.shaderProgram.attributeLocations.aVertex,2,e.FLOAT,!1,n,0*t),e.vertexAttribPointer(this.shaderProgram.attributeLocations.aColor,4,e.FLOAT,!1,n,2*t),e.drawArrays(e.TRIANGLES,0,this.vertexArrayIndex/6),this.vertexArrayIndex=0}}class TexturedTrianglesProcessor extends Processor{constructor(e){assert&&assert(e instanceof Float32Array),super(),this.projectionMatrixArray=e,this.lastArrayLength=128,this.vertexArray=new Float32Array(this.lastArrayLength)}initializeContext(e){assert&&assert(e,"Should be an actual context"),this.gl=e,this.shaderProgram=new ShaderProgram(e,["attribute vec2 aVertex;","attribute vec2 aTextureCoord;","attribute float aAlpha;","varying vec2 vTextureCoord;","varying float vAlpha;","uniform mat3 uProjectionMatrix;","void main() {","  vTextureCoord = aTextureCoord;","  vAlpha = aAlpha;","  vec3 ndc = uProjectionMatrix * vec3( aVertex, 1.0 );","  gl_Position = vec4( ndc.xy, 0.0, 1.0 );","}"].join(`
`),["precision mediump float;","varying vec2 vTextureCoord;","varying float vAlpha;","uniform sampler2D uTexture;","void main() {","  vec4 color = texture2D( uTexture, vTextureCoord, -0.7 );","  color.a *= vAlpha;","  gl_FragColor = color;","}"].join(`
`),{attributes:["aVertex","aTextureCoord","aAlpha"],uniforms:["uTexture","uProjectionMatrix"]}),this.vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertexArray,e.DYNAMIC_DRAW)}activate(){this.shaderProgram.use(),this.currentSpriteSheet=null,this.vertexArrayIndex=0,this.drawCount=0}processDrawable(e){if(!e.sprite)return;assert&&assert(e.webglRenderer===Renderer.webglTexturedTriangles),this.currentSpriteSheet&&e.sprite.spriteSheet!==this.currentSpriteSheet&&this.draw(),this.currentSpriteSheet=e.sprite.spriteSheet;const t=e.vertexArray;for(;t.length+this.vertexArrayIndex>this.vertexArray.length;){const n=new Float32Array(this.vertexArray.length*2);n.set(this.vertexArray),this.vertexArray=n}this.vertexArray.set(t,this.vertexArrayIndex),this.vertexArrayIndex+=t.length}deactivate(){return this.currentSpriteSheet&&this.draw(),this.shaderProgram.unuse(),this.drawCount}draw(){assert&&assert(this.currentSpriteSheet);const e=this.gl;e.uniformMatrix3fv(this.shaderProgram.uniformLocations.uProjectionMatrix,!1,this.projectionMatrixArray),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray.length>this.lastArrayLength?e.bufferData(e.ARRAY_BUFFER,this.vertexArray,e.DYNAMIC_DRAW):e.bufferSubData(e.ARRAY_BUFFER,0,this.vertexArray.subarray(0,this.vertexArrayIndex));const t=5,n=Float32Array.BYTES_PER_ELEMENT,r=t*n;e.vertexAttribPointer(this.shaderProgram.attributeLocations.aVertex,2,e.FLOAT,!1,r,0*n),e.vertexAttribPointer(this.shaderProgram.attributeLocations.aTextureCoord,2,e.FLOAT,!1,r,2*n),e.vertexAttribPointer(this.shaderProgram.attributeLocations.aAlpha,1,e.FLOAT,!1,r,4*n),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.currentSpriteSheet.texture),e.uniform1i(this.shaderProgram.uniformLocations.uTexture,0),e.drawArrays(e.TRIANGLES,0,this.vertexArrayIndex/t),e.bindTexture(e.TEXTURE_2D,null),this.drawCount++,this.currentSpriteSheet=null,this.vertexArrayIndex=0}}Poolable.mixInto(WebGLBlock);const WebGLBlock$1=WebGLBlock;class Stitcher{initialize(e,t,n,r,s,a,h){assert&&assert(a&&h,"We are guaranteed at least one change interval"),assert&&assert(!t||t.previousDrawable===null,"End boundary of drawable linked list should link to null"),assert&&assert(!n||n.nextDrawable===null,"End boundary of drawable linked list should link to null"),sceneryLog&&sceneryLog.Stitch&&(sceneryLog.Stitch(`stitch ${e.toString()} first:${t?t.toString():"null"} last:${n?n.toString():"null"} oldFirst:${r?r.toString():"null"} oldLast:${s?s.toString():"null"}`),sceneryLog.push()),sceneryLog&&sceneryLog.StitchDrawables&&(sceneryLog.StitchDrawables("Before:"),sceneryLog.push(),Stitcher.debugDrawables(r,s,a,h,!1),sceneryLog.pop(),sceneryLog.StitchDrawables("After:"),sceneryLog.push(),Stitcher.debugDrawables(t,n,a,h,!0),sceneryLog.pop()),this.backbone=e,this.firstDrawable=t,this.lastDrawable=n,this.touchedBlocks=cleanArray(this.touchedBlocks),assertSlow&&(assertSlow(!this.initialized,"We should not be already initialized (clean should be called)"),this.initialized=!0,this.reindexed=!1,this.pendingAdditions=[],this.pendingRemovals=[],this.pendingMoves=[],this.createdBlocks=[],this.disposedBlocks=[],this.intervalsNotified=[],this.boundariesRecorded=!1,this.previousBlocks=e.blocks.slice(0))}clean(){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch("clean"),sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch("-----------------------------------"),assertSlow&&(this.auditStitch(),this.initialized=!1),this.backbone=null,this.firstDrawable=null,this.lastDrawable=null,sceneryLog&&sceneryLog.Stitch&&sceneryLog.pop()}recordBackboneBoundaries(){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`recording backbone boundaries: ${this.firstDrawable?this.firstDrawable.toString():"null"} to ${this.lastDrawable?this.lastDrawable.toString():"null"}`),this.backbone.previousFirstDrawable=this.firstDrawable,this.backbone.previousLastDrawable=this.lastDrawable,assertSlow&&(this.boundariesRecorded=!0)}notePendingAddition(e,t){assert&&assert(e.renderer===t.renderer),sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`pending add: ${e.toString()} to ${t.toString()}`),sceneryLog&&sceneryLog.Stitch&&sceneryLog.push(),e.notePendingAddition(this.backbone.display,t,this.backbone),assertSlow&&this.pendingAdditions.push({drawable:e,block:t}),sceneryLog&&sceneryLog.Stitch&&sceneryLog.pop()}notePendingMove(e,t){assert&&assert(e.renderer===t.renderer),sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`pending move: ${e.toString()} to ${t.toString()}`),sceneryLog&&sceneryLog.Stitch&&sceneryLog.push(),e.notePendingMove(this.backbone.display,t),assertSlow&&this.pendingMoves.push({drawable:e,block:t}),sceneryLog&&sceneryLog.Stitch&&sceneryLog.pop()}notePendingRemoval(e){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`pending remove: ${e.toString()}`),sceneryLog&&sceneryLog.Stitch&&sceneryLog.push(),e.notePendingRemoval(this.backbone.display),assertSlow&&this.pendingRemovals.push({drawable:e}),sceneryLog&&sceneryLog.Stitch&&sceneryLog.pop()}markBlockForDisposal(e){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`block for disposal: ${e.toString()}`),sceneryLog&&sceneryLog.Stitch&&sceneryLog.push(),e.domElement.parentNode===this.backbone.domElement&&this.backbone.domElement.removeChild(e.domElement),e.markForDisposal(this.backbone.display),assertSlow&&this.disposedBlocks.push({block:e}),sceneryLog&&sceneryLog.Stitch&&sceneryLog.pop()}removeAllBlocks(){for(sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`marking all blocks for disposal (count ${this.backbone.blocks.length})`),sceneryLog&&sceneryLog.Stitch&&sceneryLog.push();this.backbone.blocks.length;){const e=this.backbone.blocks[0];this.removeBlock(e),this.markBlockForDisposal(e)}sceneryLog&&sceneryLog.Stitch&&sceneryLog.pop()}notifyInterval(e,t,n){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`notify interval: ${e.toString()} ${t.toString()} to ${n.toString()}`),sceneryLog&&sceneryLog.Stitch&&sceneryLog.push(),e.notifyInterval(t,n),this.backbone.markDirtyDrawable(e),assertSlow&&this.intervalsNotified.push({block:e,firstDrawable:t,lastDrawable:n}),sceneryLog&&sceneryLog.Stitch&&sceneryLog.pop()}markBeforeBlock(e,t){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`marking block first drawable ${e.toString()} with ${t.toString()}`),e.pendingFirstDrawable=t,this.touchedBlocks.push(e)}markAfterBlock(e,t){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`marking block last drawable ${e.toString()} with ${t.toString()}`),e.pendingLastDrawable=t,this.touchedBlocks.push(e)}updateBlockIntervals(){for(;this.touchedBlocks.length;){const e=this.touchedBlocks.pop();e.used?(sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`update interval: ${e.toString()} ${e.pendingFirstDrawable.toString()} to ${e.pendingLastDrawable.toString()}`),e.updateInterval(),this.backbone.markDirtyDrawable(e),assertSlow&&this.intervalsNotified.push({block:e,firstDrawable:e.pendingFirstDrawable,lastDrawable:e.pendingLastDrawable})):sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`skipping update interval: ${e.toString()}, unused`)}}createBlock(e,t){const n=this.backbone;let r;if(Renderer.isCanvas(e))r=CanvasBlock$1.createFromPool(n.display,e,n.transformRootInstance,n.backboneInstance);else if(Renderer.isSVG(e))r=SVGBlock.createFromPool(n.display,e,n.transformRootInstance,n.backboneInstance);else if(Renderer.isDOM(e))r=DOMBlock$1.createFromPool(n.display,t);else if(Renderer.isWebGL(e))r=WebGLBlock$1.createFromPool(n.display,e,n.transformRootInstance,n.backboneInstance);else throw new Error(`unsupported renderer for createBlock: ${e}`);return sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`created block: ${r.toString()} with renderer: ${e} for drawable: ${t.toString()}`),r.setBlockBackbone(n),n.domElement.appendChild(r.domElement),n.isDisplayRoot&&r.domElement.setAttribute("aria-hidden",!0),n.markDirtyDrawable(r),assertSlow&&this.createdBlocks.push({block:r,renderer:e,drawable:t}),r}appendBlock(e){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`appending block: ${e.toString()}`),this.backbone.blocks.push(e),assertSlow&&(this.reindexed=!1)}removeBlock(e){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`removing block: ${e.toString()}`);const t=_.indexOf(this.backbone.blocks,e);assert&&assert(t>=0,`Cannot remove block, not attached: ${e.toString()}`),this.backbone.blocks.splice(t,1),assertSlow&&(this.reindexed=!1)}useNoBlocks(){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch("using no blocks"),cleanArray(this.backbone.blocks)}reindex(){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch("reindexing blocks"),this.backbone.reindexBlocks(),assertSlow&&(this.reindexed=!0)}auditStitch(){if(assertSlow){const e=this.backbone.blocks,t=this.previousBlocks;if(assertSlow(this.initialized,"We seem to have finished a stitch without proper initialization"),assertSlow(this.boundariesRecorded,"Our stitch API requires recordBackboneBoundaries() to be called before it is finished."),assertSlow(this.reindexed||e.length===0||t.length===e.length&&_.every(_.zip(t,e),n=>n[0]===n[1]),"Did not reindex on a block change where we are left with blocks"),_.each(this.createdBlocks,n=>{assertSlow(_.some(this.intervalsNotified,r=>n.block===r.block),`Created block does not seem to have an interval notified: ${n.block.toString()}`)}),_.each(this.disposedBlocks,n=>{assertSlow(!_.some(this.intervalsNotified,r=>n.block===r.block),`Removed block seems to have an interval notified: ${n.block.toString()}`)}),_.each(this.disposedBlocks,n=>{const r=n.block;_.each(Drawable.oldListToArray(r.firstDrawable,r.lastDrawable),s=>{assertSlow(_.some(this.pendingRemovals,a=>a.drawable===s)||_.some(this.pendingMoves,a=>a.drawable===s),`Drawable ${s.toString()} originally listed for disposed block ${r.toString()} does not seem to be marked for pending removal or move!`)})}),_.each(this.createdBlocks,n=>{const r=n.block;_.each(Drawable.listToArray(r.pendingFirstDrawable,r.pendingLastDrawable),s=>{assertSlow(_.some(this.pendingAdditions,a=>a.drawable===s&&a.block===r)||_.some(this.pendingMoves,a=>a.drawable===s&&a.block===r),`Drawable ${s.toString()} now listed for created block ${r.toString()} does not seem to be marked for pending addition or move!`)})}),_.each(this.disposedBlocks,n=>{const r=_.indexOf(e,n.block);assertSlow(r<0,`Disposed block ${n.block.toString()} still present at index ${r}`)}),_.each(this.createdBlocks,n=>{const r=_.indexOf(e,n.block);assertSlow(r>=0,`Created block ${n.block.toString()} is not in the blocks array`)}),_.each(e,n=>{assertSlow(n.used,"All current blocks should be marked as used")}),assertSlow(e.length-t.length===this.createdBlocks.length-this.disposedBlocks.length,`The count of unmodified blocks should be constant (equal differences):
created: ${_.map(this.createdBlocks,n=>n.block.id).join(",")}
disposed: ${_.map(this.disposedBlocks,n=>n.block.id).join(",")}
before: ${_.map(t,n=>n.id).join(",")}
after: ${_.map(e,n=>n.id).join(",")}`),assertSlow(this.touchedBlocks.length===0,"If we marked any blocks for changes, we should have called updateBlockIntervals"),e.length){assertSlow(this.backbone.previousFirstDrawable!==null&&this.backbone.previousLastDrawable!==null,"If we are left with at least one block, we must be tracking at least one drawable"),assertSlow(e[0].pendingFirstDrawable===this.backbone.previousFirstDrawable,"Our first drawable should match the first drawable of our first block"),assertSlow(e[e.length-1].pendingLastDrawable===this.backbone.previousLastDrawable,"Our last drawable should match the last drawable of our last block");for(let n=0;n<e.length-1;n++)assertSlow(e[n].pendingLastDrawable.nextDrawable===e[n+1].pendingFirstDrawable&&e[n].pendingLastDrawable===e[n+1].pendingFirstDrawable.previousDrawable,"Consecutive blocks should have boundary drawables that are also consecutive in the linked list")}else assertSlow(this.backbone.previousFirstDrawable===null&&this.backbone.previousLastDrawable===null,"If we are left with no blocks, it must mean we are tracking precisely zero drawables")}}static debugIntervals(e){if(sceneryLog&&sceneryLog.Stitch)for(let t=e;t!==null;t=t.nextChangeInterval)sceneryLog.Stitch(`  interval: ${t.isEmpty()?"(empty) ":""}${t.drawableBefore?t.drawableBefore.toString():"-"} to ${t.drawableAfter?t.drawableAfter.toString():"-"}`)}static debugDrawables(e,t,n,r,s){if(sceneryLog&&sceneryLog.StitchDrawables){if(e===null){sceneryLog.StitchDrawables("nothing","color: #666;");return}let a=n.drawableBefore===null,h=n;for(let c=e;;c=s?c.nextDrawable:c.oldNextDrawable){a&&c===h.drawableAfter&&(a=!1,h=h.nextChangeInterval);const d=`${c.renderer} ${!s&&c.parentDrawable?c.parentDrawable.toString():""} ${c.toDetailedString()}`;if(sceneryLog.StitchDrawables(d,a?s?"color: #0a0;":"color: #a00;":"color: #666"),!a&&h&&h.drawableBefore===c&&(a=!0),c===t)break}}}}scenery.register("Stitcher",Stitcher);function hasGapBetweenDrawables(o,e){return o.renderer!==e.renderer||Renderer.isDOM(o.renderer)||Renderer.isDOM(e.renderer)}function isOpenBefore(o){return o.previousDrawable!==null&&!hasGapBetweenDrawables(o.previousDrawable,o)}function isOpenAfter(o){return o.nextDrawable!==null&&!hasGapBetweenDrawables(o,o.nextDrawable)}function intervalHasNewInternalDrawables(o,e,t){return o.drawableBefore?o.drawableBefore.nextDrawable!==o.drawableAfter:o.drawableAfter?o.drawableAfter.previousDrawable!==o.drawableBefore:e!==null}function intervalHasOldInternalDrawables(o,e,t){return o.drawableBefore?o.drawableBefore.oldNextDrawable!==o.drawableAfter:o.drawableAfter?o.drawableAfter.oldPreviousDrawable!==o.drawableBefore:e!==null}function intervalHasOldInternalBlocks(o,e,t){const n=o.drawableBefore?o.drawableBefore.parentDrawable:null,r=o.drawableAfter?o.drawableAfter.parentDrawable:null;return n&&r&&n===r?!1:n?n.nextBlock!==r:r?r.previousBlock!==n:e!==null}function getLastCompatibleExternalDrawable(o){const e=o.drawableAfter;if(e){const t=e.renderer,n=o.nextChangeInterval?o.nextChangeInterval.drawableBefore.nextDrawable:null;let r=e;for(;;){const s=r.nextDrawable;if(s!==n&&s.renderer===t)r=s;else break}return r}else return null}class GreedyStitcher extends Stitcher{stitch(e,t,n,r,s,a,h){this.initialize(e,t,n,r,s,a,h),this.blockOrderChanged=!1,this.reusableBlocks=cleanArray(this.reusableBlocks),this.blockWasAdded=!1;let c;if(this.recordBackboneBoundaries(),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.GreedyStitcher("phase 1: old linked list"),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.push(),e.blocks.length){const d=e.blocks[0];for(e.blocks[e.blocks.length-1],c=a;c!==null;c=c.nextChangeInterval){if(assert&&assert(!c.isEmpty(),"We now guarantee that the intervals are non-empty"),intervalHasOldInternalDrawables(c,r)){const y=c.drawableBefore?c.drawableBefore.oldNextDrawable:r,g=c.drawableAfter?c.drawableAfter.oldPreviousDrawable:s;for(let D=y;this.notePendingRemoval(D),D!==g;D=D.oldNextDrawable);}if(intervalHasOldInternalBlocks(c,d)){const y=c.drawableBefore===null?e.blocks[0]:c.drawableBefore.parentDrawable.nextBlock,g=c.drawableAfter===null?e.blocks[e.blocks.length-1]:c.drawableAfter.parentDrawable.previousBlock;for(let D=y;this.unuseBlock(D),D!==g;D=D.nextBlock);}}}if(sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.pop(),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.GreedyStitcher("phase 2: new linked list"),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.push(),t)for(c=a;c!==null;c=c.nextChangeInterval)this.processInterval(e,c,t,n);sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.pop(),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.GreedyStitcher("phase 3: cleanup"),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.push(),this.removeUnusedBlocks(),this.updateBlockIntervals(),t===null?this.useNoBlocks():this.blockOrderChanged&&(this.processBlockLinkedList(e,t.pendingParentDrawable,n.pendingParentDrawable),this.reindex()),this.clean(),cleanArray(this.reusableBlocks),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.pop()}processInterval(e,t,n,r){if(assert&&assert(t instanceof ChangeInterval),assert&&assert(n instanceof Drawable,"We assume we have a non-null remaining section"),assert&&assert(r instanceof Drawable,"We assume we have a non-null remaining section"),assert&&assert(!t.isEmpty(),"We now guarantee that the intervals are non-empty"),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`interval: ${t.drawableBefore?t.drawableBefore.toString():"null"} to ${t.drawableAfter?t.drawableAfter.toString():"null"}`),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push(),intervalHasNewInternalDrawables(t,n)){let s=t.drawableBefore?t.drawableBefore.nextDrawable:n,a=null,h=null,c=!0;for(;;){const d=s.nextDrawable,y=d===t.drawableAfter;if(assert&&assert(d!==null||y,"If our nextDrawable is null, isLast must be true"),a||(a=s),h===null&&s.parentDrawable&&!s.parentDrawable.used&&s.backbone===e&&s.parentDrawable.parentDrawable===e&&(h=s.parentDrawable,sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`matching at ${s.toString()} with ${h}`)),(y||hasGapBetweenDrawables(s,d))&&(c&&this.processEdgeCases(t,isOpenBefore(a),isOpenAfter(s)),this.processSubBlock(t,a,s,h,c,y),a=null,h=null,c=!1),y)break;s=d}}else{if(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("no current internal drawables in interval"),t.drawableBefore&&t.drawableAfter){assert&&assert(t.drawableBefore.nextDrawable===t.drawableAfter);const s=!hasGapBetweenDrawables(t.drawableBefore,t.drawableAfter);this.processEdgeCases(t,s,s)}t.drawableBefore&&!isOpenAfter(t.drawableBefore)?(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("closed-after collapsed link:"),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push(),this.linkAfterDrawable(t.drawableBefore),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop()):t.drawableAfter&&!isOpenBefore(t.drawableAfter)&&(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("closed-before collapsed link:"),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push(),this.linkBeforeDrawable(t.drawableAfter),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop())}sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop()}processSubBlock(e,t,n,r,s,a){sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`sub-block: ${t.toString()} to ${n.toString()} ${r?`with matched: ${r.toString()}`:"with no match"}`),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push();const h=isOpenBefore(t),c=isOpenAfter(n);assert&&assert(!h||s,"openBefore implies isFirst"),assert&&assert(!c||a,"openAfter implies isLast"),assert&&assert(!h||!c||t.previousDrawable.pendingParentDrawable===n.nextDrawable.pendingParentDrawable,"If we would use both the before and after blocks, make sure any gluing "),h&&(r=t.previousDrawable.pendingParentDrawable,sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`combining into before block: ${r.toString()}`)),c&&(r=n.nextDrawable.pendingParentDrawable,sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`combining into after block: ${r.toString()}`)),r=this.ensureUsedBlock(r,t);for(let d=t;this.notePendingAddition(d,r),d!==n;d=d.nextDrawable);h||(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("closed-before link:"),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push(),this.linkBeforeDrawable(t),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop()),a&&!c&&(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("last closed-after link:"),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push(),this.linkAfterDrawable(n),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop()),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop()}processEdgeCases(e,t,n){if(e.drawableBefore!==null&&e.drawableAfter!==null){const r=e.drawableBefore.pendingParentDrawable,s=e.drawableAfter.pendingParentDrawable,a=e.nextChangeInterval&&e.nextChangeInterval.drawableAfter?e.nextChangeInterval.drawableAfter.pendingParentDrawable:null;r===s&&(this.blockWasAdded=!0),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`edge case: ${t?"open-before ":""}${n?"open-after ":""}${r.toString()} to ${s.toString()}`),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push();let h;t&&n?(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`glue using ${r.toString()}`),h=r):this.blockWasAdded||r===s?(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("split with fresh block"),h=this.createBlock(e.drawableAfter.renderer,e.drawableAfter),this.blockOrderChanged=!0):(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`split with same afterBlock ${s.toString()}`),h=s),s===h?(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("no externals change here (blockWasAdded => true)"),this.blockWasAdded=!0):(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("moving externals"),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push(),this.changeExternals(e,h),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop()),a!==s&&(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("end of afterBlock stretch"),this.blockWasAdded||(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`unusing ${s.toString()}`),this.unuseBlock(s)),this.blockWasAdded=!1),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop()}}changeExternals(e,t){const n=getLastCompatibleExternalDrawable(e);this.notePendingMoves(t,e.drawableAfter,n),(!e.nextChangeInterval||e.nextChangeInterval.drawableBefore!==n)&&this.linkAfterDrawable(n)}notePendingMoves(e,t,n){for(let r=t;assert&&assert(!r.pendingAddition&&!r.pendingRemoval,"Moved drawables should be thought of as unchanged, and thus have nothing pending yet"),this.notePendingMove(r,e),r!==n;r=r.nextDrawable);}ensureUsedBlock(e,t){return e?(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`using existing block: ${e.toString()}`),e.used||this.useBlock(e)):(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("searching for block"),e=this.getBlockForRenderer(t.renderer,t)),e}getBlockForRenderer(e,t){let n;if(!Renderer.isDOM(e))for(let r=this.reusableBlocks.length-1;r>=0;r--){const s=this.reusableBlocks[r];if(assert&&assert(!s.used),s.renderer===e){this.useBlockAtIndex(s,r),n=s;break}}return n||(n=this.createBlock(e,t)),this.blockOrderChanged=!0,n}unuseBlock(e){e.used?(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`unusing block: ${e.toString()}`),e.used=!1,this.reusableBlocks.push(e)):sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`not using already-unused block: ${e.toString()}`)}useBlock(e){this.useBlockAtIndex(e,_.indexOf(this.reusableBlocks,e))}useBlockAtIndex(e,t){sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`using reusable block: ${e.toString()} with renderer: ${e.renderer}`),assert&&assert(t>=0&&this.reusableBlocks[t]===e,`bad index for useBlockAtIndex: ${t}`),assert&&assert(!e.used,"Should be called on an unused (reusable) block"),this.reusableBlocks.splice(t,1),e.used=!0}removeUnusedBlocks(){for(sceneryLog&&sceneryLog.GreedyStitcher&&this.reusableBlocks.length&&sceneryLog.GreedyStitcher("removeUnusedBlocks"),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.push();this.reusableBlocks.length;){const e=this.reusableBlocks.pop();this.markBlockForDisposal(e),this.blockOrderChanged=!0}sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.pop()}linkBeforeDrawable(e){sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`link before ${e.toString()}`);const t=e.previousDrawable;this.linkBlocks(t?t.pendingParentDrawable:null,e.pendingParentDrawable,t,e)}linkAfterDrawable(e){sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`link after ${e.toString()}`);const t=e.nextDrawable;this.linkBlocks(e.pendingParentDrawable,t?t.pendingParentDrawable:null,e,t)}linkBlocks(e,t,n,r){sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.GreedyStitcher(`linking blocks: ${e?`${e.toString()} (${n.toString()})`:"null"} to ${t?`${t.toString()} (${r.toString()})`:"null"}`),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.push(),assert&&assert(e===null&&n===null||e instanceof Block$1&&n instanceof Drawable),assert&&assert(t===null&&r===null||t instanceof Block$1&&r instanceof Drawable),e&&(e.nextBlock!==t&&(this.blockOrderChanged=!0,e.nextBlock&&(e.nextBlock.previousBlock=null),e.nextBlock=t),this.markAfterBlock(e,n)),t&&(t.previousBlock!==e&&(this.blockOrderChanged=!0,t.previousBlock&&(t.previousBlock.nextBlock=null),t.previousBlock=e),this.markBeforeBlock(t,r)),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.pop()}processBlockLinkedList(e,t,n){for(;e.blocks.length;)e.blocks.pop();if(sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.GreedyStitcher(`processBlockLinkedList: ${t.toString()} to ${n.toString()}`),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.push(),t)for(let r=t;sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.GreedyStitcher(r.toString()),e.blocks.push(r),r!==n;r=r.nextBlock);sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.pop()}}scenery.register("GreedyStitcher",GreedyStitcher);class RebuildStitcher extends Stitcher{stitch(e,t,n,r,s,a,h){this.initialize(e,t,n,r,s,a,h);for(let g=e.previousFirstDrawable;g!==null&&(this.notePendingRemoval(g),g!==e.previousLastDrawable);g=g.oldNextDrawable);this.recordBackboneBoundaries(),this.removeAllBlocks();let c=null,d=0,y=null;for(let g=t;g!==null&&((!c||g.renderer!==d)&&(c&&this.notifyInterval(c,y,g.previousDrawable),d=g.renderer,c=this.createBlock(d,g),Renderer.isDOM(d)&&(d=0),this.appendBlock(c),y=g),this.notePendingAddition(g,c),g!==n);g=g.nextDrawable);c&&this.notifyInterval(c,y,n),this.reindex(),this.clean()}}scenery.register("RebuildStitcher",RebuildStitcher);class BackboneDrawable extends Drawable{constructor(e,t,n,r,s){super(),this.initialize(e,t,n,r,s)}initialize(e,t,n,r,s){if(super.initialize(r),this.display=e,this.backboneInstance=t,this.transformRootInstance=n,this.filterRootAncestorInstance=t.parent?t.parent.getFilterRootInstance():t,this.transformRootAncestorInstance=t.parent?t.parent.getTransformRootInstance():t,this.willApplyTransform=this.transformRootAncestorInstance!==this.transformRootInstance,this.willApplyFilters=this.filterRootAncestorInstance!==this.backboneInstance,this.transformListener=this.transformListener||this.markTransformDirty.bind(this),this.willApplyTransform&&(this.backboneInstance.relativeTransform.addListener(this.transformListener),this.backboneInstance.relativeTransform.addPrecompute()),this.backboneVisibilityListener=this.backboneVisibilityListener||this.updateBackboneVisibility.bind(this),this.backboneInstance.relativeVisibleEmitter.addListener(this.backboneVisibilityListener),this.updateBackboneVisibility(),this.visibilityDirty=!0,this.renderer=r,this.domElement=s?e.domElement:BackboneDrawable.createDivBackbone(),this.isDisplayRoot=s,this.dirtyDrawables=cleanArray(this.dirtyDrawables),Utils.prepareForTransform(this.domElement),this.watchedFilterNodes=cleanArray(this.watchedFilterNodes),this.filterDirty=!0,this.clipDirty=!0,this.filterDirtyListener=this.filterDirtyListener||this.onFilterDirty.bind(this),this.clipDirtyListener=this.clipDirtyListener||this.onClipDirty.bind(this),this.willApplyFilters){assert&&assert(this.filterRootAncestorInstance.trail.nodes.length<this.backboneInstance.trail.nodes.length,"Our backboneInstance should be deeper if we are applying filters");for(let a=this.backboneInstance;a!==this.filterRootAncestorInstance;a=a.parent){const h=a.node;this.watchedFilterNodes.push(h),h.filterChangeEmitter.addListener(this.filterDirtyListener),h.clipAreaProperty.lazyLink(this.clipDirtyListener)}}this.lastZIndex=0,this.blocks=this.blocks||[],this.previousFirstDrawable=null,this.previousLastDrawable=null,this.removedDrawables=!1,this.stitcher=this.stitcher||new GreedyStitcher,sceneryLog&&sceneryLog.BackboneDrawable&&sceneryLog.BackboneDrawable(`initialized ${this.toString()}`)}dispose(){for(sceneryLog&&sceneryLog.BackboneDrawable&&sceneryLog.BackboneDrawable(`dispose ${this.toString()}`),sceneryLog&&sceneryLog.BackboneDrawable&&sceneryLog.push();this.watchedFilterNodes.length;){const e=this.watchedFilterNodes.pop();e.filterChangeEmitter.removeListener(this.filterDirtyListener),e.clipAreaProperty.unlink(this.clipDirtyListener)}if(this.backboneInstance.relativeVisibleEmitter.removeListener(this.backboneVisibilityListener),!this.removedDrawables)for(let e=this.previousFirstDrawable;e!==null&&(e.parentDrawable.removeDrawable(e),e!==this.previousLastDrawable);e=e.nextDrawable);this.markBlocksForDisposal(),this.willApplyTransform&&(this.backboneInstance.relativeTransform.removeListener(this.transformListener),this.backboneInstance.relativeTransform.removePrecompute()),this.backboneInstance=null,this.transformRootInstance=null,this.filterRootAncestorInstance=null,this.transformRootAncestorInstance=null,cleanArray(this.dirtyDrawables),cleanArray(this.watchedFilterNodes),this.previousFirstDrawable=null,this.previousLastDrawable=null,super.dispose(),sceneryLog&&sceneryLog.BackboneDrawable&&sceneryLog.pop()}markBlocksForDisposal(){for(;this.blocks.length;){const e=this.blocks.pop();sceneryLog&&sceneryLog.BackboneDrawable&&sceneryLog.BackboneDrawable(`${this.toString()} removing block: ${e.toString()}`),e.domElement.parentNode===this.domElement&&this.domElement.removeChild(e.domElement),e.markForDisposal(this.display)}}updateBackboneVisibility(){this.visible=this.backboneInstance.relativeVisible,this.visibilityDirty||(this.visibilityDirty=!0,this.markDirty())}markForDisposal(e){for(let t=this.previousFirstDrawable;t!==null&&(t.notePendingRemoval(this.display),t!==this.previousLastDrawable);t=t.oldNextDrawable);this.removedDrawables=!0,super.markForDisposal(e)}markDirtyDrawable(e){assert&&this.display.ensureNotPainting(),this.dirtyDrawables.push(e),this.markDirty()}markTransformDirty(){assert&&assert(this.willApplyTransform,"Sanity check for willApplyTransform"),Utils.applyPreparedTransform(this.backboneInstance.relativeTransform.matrix,this.domElement)}onFilterDirty(){this.filterDirty||(this.filterDirty=!0,this.markDirty())}onClipDirty(){this.clipDirty||(this.clipDirty=!0,this.markDirty())}update(){if(!super.update())return!1;for(;this.dirtyDrawables.length;)this.dirtyDrawables.pop().update();if(this.filterDirty){this.filterDirty=!1;let e="";const t=this.watchedFilterNodes.length;for(let n=0;n<t;n++){const r=this.watchedFilterNodes[n],s=r.getEffectiveOpacity();for(let a=0;a<r._filters.length;a++)e+=`${e?" ":""}${r._filters[a].getCSSFilterString()}`;s!==1&&(e+=`${e?" ":""}opacity(${toSVGNumber(s)})`)}this.domElement.style.filter=e}return this.visibilityDirty&&(this.visibilityDirty=!1,this.domElement.style.display=this.visible?"":"none"),this.clipDirty&&(this.clipDirty=!1),!0}getFilterVisibility(){const e=this.watchedFilterNodes.length;for(let t=0;t<e;t++)if(!this.watchedFilterNodes[t].isVisible())return!1;return!0}getFilterClip(){return""}reindexBlocks(){let e=0;for(let t=0;t<this.blocks.length;t++){const n=this.blocks[t];if(n.zIndex<=e){const r=t+1<this.blocks.length&&this.blocks[t+1].zIndex-1>e?Math.ceil((e+this.blocks[t+1].zIndex)/2):e+20;n.domElement.style.zIndex=n.zIndex=r}e=n.zIndex,assert&&(assert(this.blocks[t].zIndex%1===0,"z-indices should be integers"),assert(this.blocks[t].zIndex>0,"z-indices should be greater than zero for our needs (see spec)"),t>0&&assert(this.blocks[t-1].zIndex<this.blocks[t].zIndex,"z-indices should be strictly increasing"))}this.lastZIndex=e+1}stitch(e,t,n,r){if(n===null||r===null){assert&&assert(n===null),assert&&assert(r===null);return}assert&&assert(r.nextChangeInterval===null,"This allows us to have less checks in the loop"),sceneryLog&&sceneryLog.Stitch&&(sceneryLog.Stitch(`Stitch intervals before constricting: ${this.toString()}`),sceneryLog.push(),Stitcher.debugIntervals(n),sceneryLog.pop());let s=null,a=n,h=!1;for(;a;)h=a.constrict()||h,a.isEmpty()?(assert&&assert(h),s&&(s.nextChangeInterval=a.nextChangeInterval)):(s||(n=a),s=a),a=a.nextChangeInterval;if(s){if(r=s,r.nextChangeInterval=null,sceneryLog&&sceneryLog.Stitch&&h&&(sceneryLog.Stitch(`Stitch intervals after constricting: ${this.toString()}`),sceneryLog.push(),Stitcher.debugIntervals(n),sceneryLog.pop()),sceneryLog&&scenery.isLoggingPerformance()){this.display.perfStitchCount++;let c=n;for(;c;)this.display.perfIntervalCount++,this.display.perfDrawableOldIntervalCount+=c.getOldInternalDrawableCount(this.previousFirstDrawable,this.previousLastDrawable),this.display.perfDrawableNewIntervalCount+=c.getNewInternalDrawableCount(e,t),c=c.nextChangeInterval}this.stitcher.stitch(this,e,t,this.previousFirstDrawable,this.previousLastDrawable,n,r)}}audit(e,t,n){if(assertSlow){super.audit(e,t,n),assertSlow&&assertSlow(this.backboneInstance.isBackbone,"We should reference an instance that requires a backbone"),assertSlow&&assertSlow(this.transformRootInstance.isTransformed,"Transform root should be transformed");for(let r=0;r<this.blocks.length;r++)this.blocks[r].audit(e,t,n)}}static createDivBackbone(){const e=document.createElement("div");return e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.width="0",e.style.height="0",e}static repurposeBackboneContainer(e){return(e.style.position!=="relative"||e.style.position!=="absolute")&&(e.style.position="relative"),e.style.left="0",e.style.top="0",e}}scenery.register("BackboneDrawable",BackboneDrawable);Poolable.mixInto(BackboneDrawable);const BackboneDrawable$1=BackboneDrawable;class ShapeBasedOverlay{constructor(e,t,n){this.display=e,this.rootNode=t;const r=document.createElementNS(svgns,"svg");r.style.position="absolute",r.setAttribute("class",n),r.style.top="0",r.style.left="0",r.style["pointer-events"]="none",this.svg=r;function s(a,h){r.setAttribute("width",""+a),r.setAttribute("height",""+h),r.style.clip=`rect(0px,${a}px,${h}px,0px)`}e.sizeProperty.link(a=>{s(a.width,a.height)}),this.domElement=r}addShape(e,t,n){const r=document.createElementNS(svgns,"path");let s=e.getSVGPath();s||(s="M0 0"),s?r.setAttribute("d",s):r.hasAttribute("d")&&r.removeAttribute("d"),r.setAttribute("style",`fill: none; stroke: ${t}; stroke-dasharray: 5, 3; stroke-dashoffset: ${n?5:0}; stroke-width: 3;`),this.svg.appendChild(r)}update(){for(;this.svg.childNodes.length;)this.svg.removeChild(this.svg.childNodes[this.svg.childNodes.length-1]);this.addShapes()}dispose(){}}scenery.register("ShapeBasedOverlay",ShapeBasedOverlay);class CanvasNodeBoundsOverlay extends ShapeBasedOverlay{constructor(e,t){super(e,t,"canvasNodeBoundsOverlay")}addShapes(){new Trail(this.rootNode).eachTrailUnder(e=>{const t=e.lastNode();if(!t.isVisible())return!0;if(t instanceof CanvasNode&&e.isVisible()){const n=e.getTransform();this.addShape(n.transformShape(Shape$1.bounds(t.selfBounds)),"rgba(0,255,0,0.8)",!0)}return!1})}}scenery.register("CanvasNodeBoundsOverlay",CanvasNodeBoundsOverlay);class FittedBlockBoundsOverlay extends ShapeBasedOverlay{constructor(e,t){super(e,t,"canvasNodeBoundsOverlay")}addShapes(){const e=this;function t(s,a){s.willApplyTransform&&(a=a.timesMatrix(s.backboneInstance.relativeTransform.matrix)),s.blocks.forEach(h=>{n(h,a)})}function n(s,a){if(s instanceof FittedBlock$1&&!s.fitBounds.isEmpty()&&e.addShape(Shape$1.bounds(s.fitBounds).transformed(a),"rgba(255,0,0,0.8)",!0),s.firstDrawable&&s.lastDrawable){for(let h=s.firstDrawable;h!==s.lastDrawable;h=h.nextDrawable)r(h,a);r(s.lastDrawable,a)}}function r(s,a){s instanceof BackboneDrawable$1&&t(s,a)}t(this.display.rootBackbone,Matrix3.IDENTITY)}}scenery.register("FittedBlockBoundsOverlay",FittedBlockBoundsOverlay);let outerHighlightColor=HighlightPath$1.OUTER_FOCUS_COLOR,innerHighlightColor=HighlightPath$1.INNER_FOCUS_COLOR,innerGroupHighlightColor=HighlightPath$1.INNER_LIGHT_GROUP_FOCUS_COLOR,outerGroupHighlightColor=HighlightPath$1.OUTER_LIGHT_GROUP_FOCUS_COLOR;class HighlightOverlay{constructor(e,t,n){this.trail=null,this.node=null,this.activeHighlight=null,this.mode=null,this.groupMode=null,this.groupHighlightNode=null,this.transformTracker=null,this.groupTransformTracker=null,this.nodeModeHighlight=null,this.nodeModeHighlightLayered=!1,this.transformDirty=!0,this.highlightNode=new Node$2,this.readingBlockHighlightNode=new Node$2,this.addedReadingBlockHighlight=null,this.activeReadingBlockNode=null,this.readingBlockTrail=null,this.readingBlockTransformDirty=!0,this.readingBlockTransformTracker=null;const r=optionize()({pdomFocusHighlightsVisibleProperty:new BooleanProperty(!0),interactiveHighlightsVisibleProperty:new BooleanProperty(!1),readingBlockHighlightsVisibleProperty:new BooleanProperty(!1)},n);this.display=e,this.focusRootNode=t,this.focusRootNode.addChild(this.highlightNode),this.focusRootNode.addChild(this.readingBlockHighlightNode),this.pdomFocusHighlightsVisibleProperty=r.pdomFocusHighlightsVisibleProperty,this.interactiveHighlightsVisibleProperty=r.interactiveHighlightsVisibleProperty,this.readingBlockHighlightsVisibleProperty=r.readingBlockHighlightsVisibleProperty,this.focusDisplay=new Display(this.focusRootNode,{allowWebGL:e.isWebGLAllowed(),allowCSSHacks:!1,accessibility:!1,interactive:!1,allowLayerFitting:!0}),this.domElement=this.focusDisplay.domElement,this.domElement.style.pointerEvents="none",this.shapeFocusHighlightPath=new HighlightPath$1(null),this.boundsFocusHighlightPath=new HighlightFromNode$1(null,{useLocalBounds:!0}),this.highlightNode.addChild(this.shapeFocusHighlightPath),this.highlightNode.addChild(this.boundsFocusHighlightPath),this.groupFocusHighlightPath=new HighlightFromNode$1(null,{useLocalBounds:!0,useGroupDilation:!0,outerLineWidth:HighlightPath$1.GROUP_OUTER_LINE_WIDTH,innerLineWidth:HighlightPath$1.GROUP_INNER_LINE_WIDTH,innerStroke:HighlightPath$1.OUTER_FOCUS_COLOR}),this.groupFocusHighlightParent=new Node$2({children:[this.groupFocusHighlightPath]}),this.focusRootNode.addChild(this.groupFocusHighlightParent),this.readingBlockHighlightPath=new ActivatedReadingBlockHighlight$1(null),this.readingBlockHighlightNode.addChild(this.readingBlockHighlightPath),this.boundsListener=this.onBoundsChange.bind(this),this.transformListener=this.onTransformChange.bind(this),this.domFocusListener=this.onFocusChange.bind(this),this.readingBlockTransformListener=this.onReadingBlockTransformChange.bind(this),this.focusHighlightListener=this.onFocusHighlightChange.bind(this),this.interactiveHighlightListener=this.onInteractiveHighlightChange.bind(this),this.focusHighlightsVisibleListener=this.onFocusHighlightsVisibleChange.bind(this),this.voicingHighlightsVisibleListener=this.onVoicingHighlightsVisibleChange.bind(this),this.pointerFocusListener=this.onPointerFocusChange.bind(this),this.lockedPointerFocusListener=this.onLockedPointerFocusChange.bind(this),this.readingBlockFocusListener=this.onReadingBlockFocusChange.bind(this),this.readingBlockHighlightChangeListener=this.onReadingBlockHighlightChange.bind(this),FocusManager.pdomFocusProperty.link(this.domFocusListener),e.focusManager.pointerFocusProperty.link(this.pointerFocusListener),e.focusManager.readingBlockFocusProperty.link(this.readingBlockFocusListener),e.focusManager.lockedPointerFocusProperty.link(this.lockedPointerFocusListener),this.pdomFocusHighlightsVisibleProperty.link(this.focusHighlightsVisibleListener),this.interactiveHighlightsVisibleProperty.link(this.voicingHighlightsVisibleListener)}dispose(){this.hasHighlight()&&this.deactivateHighlight(),FocusManager.pdomFocusProperty.unlink(this.domFocusListener),this.pdomFocusHighlightsVisibleProperty.unlink(this.focusHighlightsVisibleListener),this.interactiveHighlightsVisibleProperty.unlink(this.voicingHighlightsVisibleListener),this.display.focusManager.pointerFocusProperty.unlink(this.pointerFocusListener),this.display.focusManager.readingBlockFocusProperty.unlink(this.readingBlockFocusListener),this.focusDisplay.dispose()}hasHighlight(){return!!this.trail}hasReadingBlockHighlight(){return!!this.readingBlockTrail}activateHighlight(e,t,n,r,s){this.trail=e,this.node=t;const a=n;this.activeHighlight=a;let h=e;if(a==="invisible")this.mode="invisible";else if(a instanceof Shape$1)this.mode="shape",this.shapeFocusHighlightPath.visible=!0,this.shapeFocusHighlightPath.setShape(a);else if(a instanceof Node$2){if(this.mode="node",a instanceof HighlightPath$1){const c=a;assert&&assert(a.shape!==null,"The shape of the Node highlight should be set by now. Does it have bounds?"),c.transformSourceNode&&(h=a.getUniqueHighlightTrail(this.trail))}this.nodeModeHighlight=a,r?(this.nodeModeHighlightLayered=!0,this.nodeModeHighlight.visible=s.get()):(this.nodeModeHighlight.visible=!0,this.highlightNode.addChild(this.nodeModeHighlight))}else this.mode="bounds",this.boundsFocusHighlightPath.setShapeFromNode(this.node),this.boundsFocusHighlightPath.visible=!0,this.node.localBoundsProperty.lazyLink(this.boundsListener),this.onBoundsChange();this.transformTracker=new TransformTracker$1(h,{isStatic:!0}),this.transformTracker.addListener(this.transformListener),this.activateGroupHighlights(),this.updateHighlightColors(),this.transformDirty=!0}activateFocusHighlight(e,t){this.activateHighlight(e,t,t.focusHighlight,t.focusHighlightLayerable,this.pdomFocusHighlightsVisibleProperty),t.focusHighlightChangedEmitter.addListener(this.focusHighlightListener)}activateInteractiveHighlight(e,t){this.activateHighlight(e,t,t.interactiveHighlight||t.focusHighlight,t.interactiveHighlightLayerable,this.interactiveHighlightsVisibleProperty),assert&&assert(t.isInteractiveHighlighting,"Node does not support any kind of interactive highlighting."),t.interactiveHighlightChangedEmitter.addListener(this.interactiveHighlightListener),t.focusHighlightChangedEmitter.addListener(this.interactiveHighlightListener)}activateReadingBlockHighlight(e){this.readingBlockTrail=e;const t=e.lastNode();assert&&assert(t.isReadingBlock,"should not activate a reading block highlight for a Node that is not a ReadingBlock"),this.activeReadingBlockNode=t;const n=this.activeReadingBlockNode.readingBlockActiveHighlight;this.addedReadingBlockHighlight=n,n==="invisible"||(n instanceof Shape$1?(this.readingBlockHighlightPath.setShape(n),this.readingBlockHighlightPath.visible=!0):n instanceof Node$2?this.readingBlockHighlightNode.addChild(n):(this.readingBlockHighlightPath.setShapeFromNode(this.activeReadingBlockNode),this.readingBlockHighlightPath.visible=!0)),this.readingBlockTransformTracker=new TransformTracker$1(this.readingBlockTrail,{isStatic:!0}),this.readingBlockTransformTracker.addListener(this.readingBlockTransformListener),this.activeReadingBlockNode.readingBlockActiveHighlightChangedEmitter.addListener(this.readingBlockHighlightChangeListener),this.readingBlockTransformDirty=!0}deactivateReadingBlockHighlight(){this.readingBlockHighlightPath.visible=!1,this.addedReadingBlockHighlight instanceof Node$2&&this.readingBlockHighlightNode.removeChild(this.addedReadingBlockHighlight),assert&&assert(this.readingBlockTransformTracker,"How can we deactivate the TransformTracker if it wasnt assigned.");const e=this.readingBlockTransformTracker;e.removeListener(this.readingBlockTransformListener),e.dispose(),this.readingBlockTransformTracker=null,assert&&assert(this.activeReadingBlockNode,"How can we deactivate the activeReadingBlockNode if it wasnt assigned."),this.activeReadingBlockNode.readingBlockActiveHighlightChangedEmitter.removeListener(this.readingBlockHighlightChangeListener),this.activeReadingBlockNode=null,this.readingBlockTrail=null,this.addedReadingBlockHighlight=null}deactivateHighlight(){assert&&assert(this.node,"Need an active Node to deactivate highlights");const e=this.node;if(this.mode==="shape")this.shapeFocusHighlightPath.visible=!1;else if(this.mode==="node"){assert&&assert(this.nodeModeHighlight,"How can we deactivate if nodeModeHighlight is not assigned");const n=this.nodeModeHighlight;this.nodeModeHighlightLayered?this.nodeModeHighlightLayered=!1:this.highlightNode.removeChild(n),n.visible=!1,this.nodeModeHighlight=null}else this.mode==="bounds"&&(this.boundsFocusHighlightPath.visible=!1,e.localBoundsProperty.unlink(this.boundsListener));e.focusHighlightChangedEmitter.hasListener(this.focusHighlightListener)&&e.focusHighlightChangedEmitter.removeListener(this.focusHighlightListener);const t=e;t.isInteractiveHighlighting&&(t.interactiveHighlightChangedEmitter.hasListener(this.interactiveHighlightListener)&&t.interactiveHighlightChangedEmitter.removeListener(this.interactiveHighlightListener),t.focusHighlightChangedEmitter.hasListener(this.interactiveHighlightListener)&&t.focusHighlightChangedEmitter.removeListener(this.interactiveHighlightListener)),this.deactivateGroupHighlights(),this.trail=null,this.node=null,this.mode=null,this.activeHighlight=null,this.transformTracker.removeListener(this.transformListener),this.transformTracker.dispose(),this.transformTracker=null}activateGroupHighlights(){assert&&assert(this.trail,"must have an active trail to activate group highlights");const e=this.trail;for(let t=0;t<e.length;t++){const n=e.nodes[t],r=n.groupFocusHighlight;if(r){const s=e.upToNode(n);this.groupTransformTracker=new TransformTracker$1(s),this.groupTransformTracker.addListener(this.transformListener),typeof r=="boolean"?(this.groupFocusHighlightPath.setShapeFromNode(n),this.groupFocusHighlightPath.visible=!0,this.groupHighlightNode=this.groupFocusHighlightPath,this.groupMode="bounds"):r instanceof Node$2&&(this.groupHighlightNode=r,this.groupFocusHighlightParent.addChild(r),this.groupMode="node");break}}}updateHighlightColors(){this.mode==="shape"?(this.shapeFocusHighlightPath.innerHighlightColor!==HighlightOverlay.getInnerHighlightColor()&&this.shapeFocusHighlightPath.setInnerHighlightColor(HighlightOverlay.getInnerHighlightColor()),this.shapeFocusHighlightPath.outerHighlightColor!==HighlightOverlay.getOuterHighlightColor()&&this.shapeFocusHighlightPath.setOuterHighlightColor(HighlightOverlay.getOuterHighlightColor())):this.mode==="bounds"&&(this.boundsFocusHighlightPath.innerHighlightColor!==HighlightOverlay.getInnerHighlightColor()&&this.boundsFocusHighlightPath.setInnerHighlightColor(HighlightOverlay.getInnerHighlightColor()),this.boundsFocusHighlightPath.outerHighlightColor!==HighlightOverlay.getOuterHighlightColor()&&this.boundsFocusHighlightPath.setOuterHighlightColor(HighlightOverlay.getOuterHighlightColor())),this.groupMode&&(this.groupFocusHighlightPath.innerHighlightColor!==HighlightOverlay.getInnerGroupHighlightColor()&&this.groupFocusHighlightPath.setInnerHighlightColor(HighlightOverlay.getInnerGroupHighlightColor()),this.groupFocusHighlightPath.outerHighlightColor!==HighlightOverlay.getOuterGroupHighlightColor()&&this.groupFocusHighlightPath.setOuterHighlightColor(HighlightOverlay.getOuterGroupHighlightColor()))}deactivateGroupHighlights(){this.groupMode&&(this.groupMode==="bounds"?this.groupFocusHighlightPath.visible=!1:this.groupMode==="node"&&(assert&&assert(this.groupHighlightNode,"Need a groupHighlightNode to deactivate this mode"),this.groupFocusHighlightParent.removeChild(this.groupHighlightNode)),this.groupMode=null,this.groupHighlightNode=null,assert&&assert(this.groupTransformTracker,"Need a groupTransformTracker to dispose"),this.groupTransformTracker.removeListener(this.transformListener),this.groupTransformTracker.dispose(),this.groupTransformTracker=null)}afterTransform(){this.mode==="shape"?this.shapeFocusHighlightPath.updateLineWidth():this.mode==="bounds"?this.boundsFocusHighlightPath.updateLineWidth():this.mode==="node"&&this.activeHighlight instanceof HighlightPath$1&&this.activeHighlight.updateLineWidth&&(assert&&assert(this.node,"Need an active Node to update line width"),this.activeHighlight.updateLineWidth(this.node))}onTransformChange(){this.transformDirty=!0}onReadingBlockTransformChange(){this.readingBlockTransformDirty=!0}onBoundsChange(){assert&&assert(this.node,"Must have an active node when bounds are changing"),this.boundsFocusHighlightPath.setShapeFromNode(this.node)}onFocusChange(e){const t=e&&e.display===this.display?e.trail:null;if(this.hasHighlight()&&this.deactivateHighlight(),t&&this.pdomFocusHighlightsVisibleProperty.value){const n=t.lastNode();this.activateFocusHighlight(t,n)}else this.display.focusManager.pointerFocusProperty.value&&this.interactiveHighlightsVisibleProperty.value&&this.updateInteractiveHighlight(this.display.focusManager.pointerFocusProperty.value)}onPointerFocusChange(e){!this.display.focusManager.lockedPointerFocusProperty.value&&!this.display.focusManager.pdomFocusHighlightsVisibleProperty.value&&this.updateInteractiveHighlight(e)}updateInteractiveHighlight(e){const t=e&&e.display===this.display?e.trail:null;this.hasHighlight()&&this.deactivateHighlight();let n=!1;if(t&&!this.display.focusManager.pdomFocusHighlightsVisibleProperty.value){const r=t.lastNode();(r.isReadingBlock&&this.readingBlockHighlightsVisibleProperty.value||!r.isReadingBlock&&this.interactiveHighlightsVisibleProperty.value)&&(this.activateInteractiveHighlight(t,r),n=!0)}!n&&FocusManager.pdomFocus&&this.pdomFocusHighlightsVisibleProperty.value&&this.onFocusChange(FocusManager.pdomFocus)}onLockedPointerFocusChange(e){this.updateInteractiveHighlight(e||this.display.focusManager.pointerFocusProperty.value)}onReadingBlockFocusChange(e){this.hasReadingBlockHighlight()&&this.deactivateReadingBlockHighlight();const t=e&&e.display===this.display?e.trail:null;t&&this.activateReadingBlockHighlight(t)}onFocusHighlightChange(){assert&&assert(this.node&&this.node.focused,"update should only be necessary if node already has focus"),this.onFocusChange(FocusManager.pdomFocus)}onInteractiveHighlightChange(){if(assert){const e=this.node,t=this.display.focusManager.lockedPointerFocusProperty.value;assert(e||t&&t.trail.lastNode()===this.node,"Update should only be necessary if Node is activated with a Pointer or pointer focus is locked during interaction")}this.updateInteractiveHighlight(this.display.focusManager.lockedPointerFocusProperty.value||this.display.focusManager.pointerFocusProperty.value)}onReadingBlockHighlightChange(){assert&&assert(this.activeReadingBlockNode,"Update should only be necessary when there is an active ReadingBlock Node"),assert&&assert(this.activeReadingBlockNode.readingBlockActivated,"Update should only be necessary while the ReadingBlock is activated"),this.onReadingBlockFocusChange(this.display.focusManager.readingBlockFocusProperty.value)}onFocusHighlightsVisibleChange(){this.onFocusChange(FocusManager.pdomFocus)}onVoicingHighlightsVisibleChange(){this.onPointerFocusChange(this.display.focusManager.pointerFocusProperty.value)}update(){this.hasHighlight()&&this.transformDirty&&(this.transformDirty=!1,assert&&assert(this.transformTracker,"The transformTracker must be available on update if transform is dirty"),this.highlightNode.setMatrix(this.transformTracker.matrix),this.groupHighlightNode&&(assert&&assert(this.groupTransformTracker,"The groupTransformTracker must be available on update if transform is dirty"),this.groupHighlightNode.setMatrix(this.groupTransformTracker.matrix)),this.afterTransform()),this.hasReadingBlockHighlight()&&this.readingBlockTransformDirty&&(this.readingBlockTransformDirty=!1,assert&&assert(this.readingBlockTransformTracker,"The groupTransformTracker must be available on update if transform is dirty"),this.readingBlockHighlightNode.setMatrix(this.readingBlockTransformTracker.matrix)),this.display.size.equals(this.focusDisplay.size)||this.focusDisplay.setWidthHeight(this.display.width,this.display.height),this.focusDisplay.updateDisplay()}static setInnerHighlightColor(e){innerHighlightColor=e}static getInnerHighlightColor(){return innerHighlightColor}static setOuterHilightColor(e){outerHighlightColor=e}static getOuterHighlightColor(){return outerHighlightColor}static setInnerGroupHighlightColor(e){innerGroupHighlightColor=e}static getInnerGroupHighlightColor(){return innerGroupHighlightColor}static setOuterGroupHighlightColor(e){outerGroupHighlightColor=e}static getOuterGroupHighlightColor(){return outerGroupHighlightColor}}scenery.register("HighlightOverlay",HighlightOverlay);class HitAreaOverlay extends ShapeBasedOverlay{constructor(e,t){super(e,t,"hitAreaOverlay")}addShapes(){new Trail(this.rootNode).eachTrailUnder(e=>{const t=e.lastNode();if(!t.isVisible()||t.pickable===!1)return!0;if(t.inputListeners.length&&e.isVisible()){const n=HitAreaOverlay.getLocalMouseShape(t),r=HitAreaOverlay.getLocalTouchShape(t),s=e.getMatrix();n.bounds.isEmpty()||this.addShape(n.transformed(s),"rgba(0,0,255,0.8)",!0),r.bounds.isEmpty()||this.addShape(r.transformed(s),"rgba(255,0,0,0.8)",!1)}return!1})}static getLocalMouseShape(e){let t=Shape$1.union([e.mouseArea?e.mouseArea instanceof Shape$1?e.mouseArea:Shape$1.bounds(e.mouseArea):e.getSelfShape(),...e.children.filter(n=>e.visible&&e.pickable!==!1).map(n=>HitAreaOverlay.getLocalMouseShape(n).transformed(n.matrix))]);return e.hasClipArea()&&(t=t.shapeIntersection(e.clipArea)),t}static getLocalTouchShape(e){let t=Shape$1.union([e.touchArea?e.touchArea instanceof Shape$1?e.touchArea:Shape$1.bounds(e.touchArea):e.getSelfShape(),...e.children.filter(n=>e.visible&&e.pickable!==!1).map(n=>HitAreaOverlay.getLocalTouchShape(n).transformed(n.matrix))]);return e.hasClipArea()&&(t=t.shapeIntersection(e.clipArea)),t}}scenery.register("HitAreaOverlay",HitAreaOverlay);class PointerAreaOverlay extends ShapeBasedOverlay{constructor(e,t){super(e,t,"mouseTouchAreaOverlay")}addShapes(){new Trail(this.rootNode).eachTrailUnder(e=>{const t=e.lastNode();if(!t.isVisible())return!0;if((t.mouseArea||t.touchArea)&&e.isVisible()){const n=e.getTransform();t.mouseArea&&this.addShape(n.transformShape(t.mouseArea instanceof Bounds2?Shape$1.bounds(t.mouseArea):t.mouseArea),"rgba(0,0,255,0.8)",!0),t.touchArea&&this.addShape(n.transformShape(t.touchArea instanceof Bounds2?Shape$1.bounds(t.touchArea):t.touchArea),"rgba(255,0,0,0.8)",!1)}return!1})}}scenery.register("PointerAreaOverlay",PointerAreaOverlay);class PointerOverlay{constructor(e,t){this.display=e,this.rootNode=t,this.pointerSVGContainer=document.createElement("div"),this.pointerSVGContainer.style.position="absolute",this.pointerSVGContainer.style.top="0",this.pointerSVGContainer.style.left="0",this.pointerSVGContainer.style["pointer-events"]="none";const n=10,r=1,s=(n+r/2)*2,a=s/2;e.sizeProperty.lazyLink(c=>{this.pointerSVGContainer.setAttribute("width",""+c.width),this.pointerSVGContainer.setAttribute("height",""+c.height),this.pointerSVGContainer.style.clip=`rect(0px,${c.width}px,${c.height}px,0px)`});const h=Matrix3.IDENTITY.copy();this.pointerAdded=c=>{const d=document.createElementNS(svgns,"svg");d.style.position="absolute",d.style.top="0",d.style.left="0",d.style["pointer-events"]="none",Utils.prepareForTransform(d),d.setAttribute("width",""+s),d.setAttribute("height",""+s);const y=document.createElementNS(svgns,"circle");y.setAttribute("cx",""+(n+r/2)),y.setAttribute("cy",""+(n+r/2)),y.setAttribute("r",""+n),y.setAttribute("style","fill:black;"),y.setAttribute("style","stroke:white;"),y.setAttribute("opacity","0.4");const g=V=>Utils.applyPreparedTransform(h.setToTranslation(V.x-a,V.y-a),d),D=()=>{c.isTouchLike()&&(this.pointerSVGContainer.removeChild(d),c.removeInputListener(O))},O={move:()=>{c.point&&g(c.point)},up:D,cancel:D,focus:()=>{c instanceof PDOMPointer&&c.point&&(g(c.point),this.pointerSVGContainer.appendChild(d))},blur:()=>{this.pointerSVGContainer.contains(d)&&this.pointerSVGContainer.removeChild(d)}};c.addInputListener(O),O.move(),d.appendChild(y),this.pointerSVGContainer.appendChild(d)},e._input.pointerAddedEmitter.addListener(this.pointerAdded),e._input&&e._input.mouse&&this.pointerAdded(e._input.mouse),this.domElement=this.pointerSVGContainer}dispose(){this.display._input.pointerAddedEmitter.removeListener(this.pointerAdded)}update(){}}scenery.register("PointerOverlay",PointerOverlay);let globalIdCounter$1=1;const defaultPreferredRenderers=Renderer.createOrderBitmask(Renderer.bitmaskSVG,Renderer.bitmaskCanvas,Renderer.bitmaskDOM,Renderer.bitmaskWebGL);class Instance{constructor(e,t,n,r){ce(this,"display",null);this.active=!1,this.initialize(e,t,n,r)}initialize(e,t,n,r){return assert&&assert(!this.active,"We should never try to initialize an already active object"),t.setImmutable(),this.id=this.id||globalIdCounter$1++,this.isWebGLSupported=e.isWebGLAllowed()&&Utils.isWebGLSupported,this.relativeTransform=this.relativeTransform||new RelativeTransform(this),this.fittability=this.fittability||new Fittability(this),this.visible=!0,this.relativeVisible=!0,this.selfVisible=!0,this.visibilityDirty=!0,this.childVisibilityDirty=!0,this.voicingVisible=!0,this.branchIndexMap=this.branchIndexMap||{},this.branchIndexReferences=cleanArray(this.branchIndexReferences),this.addRemoveCounter=0,this.stitchChangeFrame=e._frameId,this.stitchChangeBefore=0,this.stitchChangeAfter=0,this.stitchChangeOnChildren=0,this.stitchChangeIncluded=!1,this.childInsertedListener=this.childInsertedListener||this.onChildInserted.bind(this),this.childRemovedListener=this.childRemovedListener||this.onChildRemoved.bind(this),this.childrenReorderedListener=this.childrenReorderedListener||this.onChildrenReordered.bind(this),this.visibilityListener=this.visibilityListener||this.onVisibilityChange.bind(this),this.markRenderStateDirtyListener=this.markRenderStateDirtyListener||this.markRenderStateDirty.bind(this),this.visibleEmitter=new TinyEmitter,this.relativeVisibleEmitter=new TinyEmitter,this.selfVisibleEmitter=new TinyEmitter,this.canVoiceEmitter=new TinyEmitter,this.cleanInstance(e,t),this.node.addInstance(this),this.externalReferenceCount=0,this.stateless=!0,this.isDisplayRoot=n,this.isSharedCanvasCacheRoot=r,this.preferredRenderers=0,this.isUnderCanvasCache=r,this.isBackbone=!1,this.isTransformed=!1,this.isVisibilityApplied=!1,this.isInstanceCanvasCache=!1,this.isSharedCanvasCachePlaceholder=!1,this.isSharedCanvasCacheSelf=r,this.selfRenderer=0,this.groupRenderer=0,this.sharedCacheRenderer=0,this.renderStateDirtyFrame=e._frameId,this.skipPruningFrame=e._frameId,sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`initialized ${this.toString()}`),this.active=!0,this}cleanInstance(e,t){this.display=e,this.trail=t,this.node=t?t.lastNode():null,this.parent=null,this.oldParent=null,this.children=cleanArray(this.children),this.sharedCacheInstance=null,this.relativeTransform.initialize(e,t),this.fittability.initialize(e,t),this.instanceRemovalCheckList=cleanArray(this.instanceRemovalCheckList),this.selfDrawable=null,this.groupDrawable=null,this.sharedCacheDrawable=null,this.firstDrawable=null,this.lastDrawable=null,this.firstInnerDrawable=null,this.lastInnerDrawable=null,this.svgGroups=cleanArray(this.svgGroups),this.cleanSyncTreeResults()}cleanSyncTreeResults(){this.beforeStableIndex=this.children.length,this.afterStableIndex=-1,this.firstChangeInterval=null,this.lastChangeInterval=null,this.incompatibleStateChange=!1,this.groupChanged=!1,this.cascadingStateChange=!1,this.anyStateChange=!1}updateRenderingState(){sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`updateRenderingState ${this.toString()}${this.stateless?" (stateless)":""}`),sceneryLog&&sceneryLog.Instance&&sceneryLog.push(),sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`old: ${this.getStateString()}`);const e=this.isBackbone,t=this.isTransformed,n=this.isVisibilityApplied,r=this.isInstanceCanvasCache,s=this.isSharedCanvasCacheSelf,a=this.isSharedCanvasCachePlaceholder,h=this.isUnderCanvasCache,c=this.selfRenderer,d=this.groupRenderer,y=this.sharedCacheRenderer,g=this.preferredRenderers;this.isBackbone=!1,this.isTransformed=!1,this.isVisibilityApplied=!1,this.isInstanceCanvasCache=!1,this.isSharedCanvasCacheSelf=!1,this.isSharedCanvasCachePlaceholder=!1,this.selfRenderer=0,this.groupRenderer=0,this.sharedCacheRenderer=0;const D=this.node;this.isUnderCanvasCache=this.isSharedCanvasCacheRoot||(this.parent?this.parent.isUnderCanvasCache||this.parent.isInstanceCanvasCache||this.parent.isSharedCanvasCacheSelf:!1),this.preferredRenderers=this.parent?this.parent.preferredRenderers:defaultPreferredRenderers,D._renderer&&(this.preferredRenderers=Renderer.pushOrderBitmask(this.preferredRenderers,D._renderer));const O=this.node.hasClipArea(),V=this.node.effectiveOpacity!==1||D._usesOpacity||this.node._filters.length>0;let k=!1,M=!1;if(V)for(let Z=0;Z<this.node._filters.length;Z++){const W=this.node._filters[Z];W.isSVGCompatible()||(k=!0),W.isCanvasCompatible()||(M=!0)}const N=D._cssTransform||D._layerSplit,F=this.isDisplayRoot||!this.isUnderCanvasCache&&N,G=!F&&(V||O)&&(!k&&this.node._rendererSummary.isSubtreeRenderedExclusivelySVG(this.preferredRenderers)||!M&&this.node._rendererSummary.isSubtreeRenderedExclusivelyCanvas(this.preferredRenderers));if((G?!1:F||V||O)?(this.isBackbone=!0,this.isVisibilityApplied=!0,this.isTransformed=this.isDisplayRoot||!!D._cssTransform,this.groupRenderer=Renderer.bitmaskDOM):!G&&(V||O||D._canvasCache)&&(assert&&assert(this.node._rendererSummary.isSingleCanvasSupported(),`Node canvasCache provided, but not all node contents can be rendered with Canvas under ${this.node.constructor.name}`),D._singleCache?this.isSharedCanvasCacheRoot?(this.isSharedCanvasCacheSelf=!0,this.sharedCacheRenderer=this.isWebGLSupported?Renderer.bitmaskWebGL:Renderer.bitmaskCanvas):(assert&&assert(this.node._rendererSummary.areBoundsValid(),`Node singleCache provided, but not all node contents have valid bounds under ${this.node.constructor.name}`),this.isSharedCanvasCachePlaceholder=!0):(this.isInstanceCanvasCache=!0,this.isUnderCanvasCache=!0,this.groupRenderer=this.isWebGLSupported?Renderer.bitmaskWebGL:Renderer.bitmaskCanvas)),this.node.isPainted())if(this.isUnderCanvasCache)this.selfRenderer=Renderer.bitmaskCanvas;else{let Z=this.node._rendererBitmask;if(!this.isWebGLSupported){const W=Renderer.bitmaskWebGL;Z=Z^Z&W}this.selfRenderer=Z&Renderer.bitmaskOrder(this.preferredRenderers,0)||Z&Renderer.bitmaskOrder(this.preferredRenderers,1)||Z&Renderer.bitmaskOrder(this.preferredRenderers,2)||Z&Renderer.bitmaskOrder(this.preferredRenderers,3)||Z&Renderer.bitmaskSVG||Z&Renderer.bitmaskCanvas||Z&Renderer.bitmaskDOM||Z&Renderer.bitmaskWebGL||0,assert&&assert(this.selfRenderer,"setSelfRenderer failure?")}this.groupChanged=e!==this.isBackbone||r!==this.isInstanceCanvasCache||s!==this.isSharedCanvasCacheSelf,this.cascadingStateChange=h!==this.isUnderCanvasCache||g!==this.preferredRenderers,this.incompatibleStateChange=this.isTransformed!==t||this.isSharedCanvasCachePlaceholder!==a,this.anyStateChange=this.groupChanged||this.cascadingStateChange||this.incompatibleStateChange||c!==this.selfRenderer||d!==this.groupRenderer||y!==this.sharedCacheRenderer,n!==this.isVisibilityApplied&&(this.visibilityDirty=!0,this.parent&&this.parent.markChildVisibilityDirty()),this.fittability.checkSelfFittability(),sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`new: ${this.getStateString()}`),sceneryLog&&sceneryLog.Instance&&sceneryLog.pop()}getStateString(){return`${`S[ ${this.isDisplayRoot?"displayRoot ":""}${this.isBackbone?"backbone ":""}${this.isInstanceCanvasCache?"instanceCache ":""}${this.isSharedCanvasCachePlaceholder?"sharedCachePlaceholder ":""}${this.isSharedCanvasCacheSelf?"sharedCacheSelf ":""}${this.isTransformed?"TR ":""}${this.isVisibilityApplied?"VIS ":""}${this.selfRenderer?this.selfRenderer.toString(16):"-"},${this.groupRenderer?this.groupRenderer.toString(16):"-"},${this.sharedCacheRenderer?this.sharedCacheRenderer.toString(16):"-"} `}]`}baseSyncTree(){assert&&assert(this.isDisplayRoot,"baseSyncTree() should only be called on the root instance"),sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`-------- START baseSyncTree ${this.toString()} --------`),this.syncTree(),sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`-------- END baseSyncTree ${this.toString()} --------`),this.cleanSyncTreeResults()}syncTree(){sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`syncTree ${this.toString()} ${this.getStateString()}${this.stateless?" (stateless)":""}`),sceneryLog&&sceneryLog.Instance&&sceneryLog.push(),sceneryLog&&scenery.isLoggingPerformance()&&this.display.perfSyncTreeCount++,assert&&assert(!this.parent||!this.parent.stateless,"We should not have a stateless parent instance");const e=this.stateless;if(e||this.parent&&this.parent.cascadingStateChange||this.renderStateDirtyFrame===this.display._frameId?this.updateRenderingState():assertSlow&&(this.updateRenderingState(),assertSlow(!this.anyStateChange)),!e&&this.incompatibleStateChange)return sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`incompatible instance ${this.toString()} ${this.getStateString()}, aborting`),sceneryLog&&sceneryLog.Instance&&sceneryLog.pop(),!1;if(this.stateless=!1,assert&&assert(!e||this.children.length===0,"We should not have child instances on an instance without state"),e&&(this.isTransformed&&this.display.markTransformRootDirty(this,!0),this.attachNodeListeners()),this.isSharedCanvasCachePlaceholder)this.sharedSyncTree();else if(e||this.skipPruningFrame===this.display._frameId||this.anyStateChange){this.prepareChildInstances(e);const t=this.firstDrawable,n=this.lastDrawable,r=this.firstInnerDrawable,s=this.lastInnerDrawable,a=this.updateSelfDrawable();this.localSyncTree(a),assertSlow&&this.auditChangeIntervals(r,s,this.firstInnerDrawable,this.lastInnerDrawable),this.groupSyncTree(e),assertSlow&&this.auditChangeIntervals(t,n,this.firstDrawable,this.lastDrawable)}else sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance("pruned");return sceneryLog&&sceneryLog.Instance&&sceneryLog.pop(),!0}localSyncTree(e){const t=this.display._frameId;let n=this.selfDrawable,r=n;assert&&assert(this.firstChangeInterval===null&&this.lastChangeInterval===null,"sanity checks that cleanSyncTreeResults were called");let s=null;e&&(sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.ChangeInterval("self"),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.push(),s=ChangeInterval.newForDisplay(null,null,this.display),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.pop());let a=s,h=e?null:this.selfDrawable;for(let c=0;c<this.children.length;c++){let d=this.children[c];d.syncTree()||(d=this.updateIncompatibleChildInstance(d,c),d.syncTree());const g=d.shouldIncludeInParentDrawables();g&&d.firstDrawable&&(r?Drawable.connectDrawables(r,d.firstDrawable,this.display):n=d.firstDrawable,r=d.lastDrawable),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.ChangeInterval(`changes for ${d.toString()} in ${this.toString()}`),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.push();const D=d.stitchChangeIncluded,O=g;d.stitchChangeIncluded=O,sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.ChangeInterval(`included: ${D} => ${O}`),d.stitchChangeFrame===t?(sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.ChangeInterval("stitchChangeFrame full change interval"),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.push(),d.firstChangeInterval=d.lastChangeInterval=ChangeInterval.newForDisplay(null,null,this.display),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.pop()):assert&&assert(D===O,"If we do not have stitchChangeFrame activated, our inclusion should not have changed");const V=d.firstChangeInterval;let k=a&&a.drawableAfter===null;const M=V&&V.drawableBefore===null;if(d.stitchChangeBefore===t&&!k&&!M){sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.ChangeInterval("bridge"),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.push();const F=ChangeInterval.newForDisplay(h,null,this.display);a&&(a.nextChangeInterval=F),a=F,s=s||a,k=!0,sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.pop()}if((D||O)&&(k?V?V.drawableBefore===null?(a.drawableAfter=V.drawableAfter,a.nextChangeInterval=V.nextChangeInterval,a=d.lastChangeInterval===V?a:d.lastChangeInterval):(a.drawableAfter=d.firstDrawable,a.nextChangeInterval=V,a=d.lastChangeInterval):a.drawableAfter=d.firstDrawable:V&&(s=s||V,V.drawableBefore===null&&(assert&&assert(!a||h,"If we have a current change interval, we should be guaranteed a non-null lastUnchangedDrawable"),V.drawableBefore=h),a&&(a.nextChangeInterval=V),a=d.lastChangeInterval),h=a&&a.drawableAfter===null?null:d.lastDrawable?d.lastDrawable:h),c===this.children.length-1&&d.stitchChangeAfter===t&&!(a&&a.drawableAfter===null)){const F=ChangeInterval.newForDisplay(h,null,this.display);a&&(a.nextChangeInterval=F),a=F,s=s||a}d.cleanSyncTreeResults(),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.pop()}if(assert&&assert(!!s==!!a,"Presence of first and current change intervals should be equal"),!s&&this.stitchChangeOnChildren===this.display._frameId&&this.children.length===0&&(s=a=ChangeInterval.newForDisplay(null,null,this.display)),this.firstChangeInterval=s,this.lastChangeInterval=a,this.firstDrawable=this.firstInnerDrawable=n,this.lastDrawable=this.lastInnerDrawable=r,assertSlow){let c=null;for(let y=0;y<this.children.length;y++)if(this.children[y].shouldIncludeInParentDrawables()&&this.children[y].firstDrawable){c=this.children[y].firstDrawable;break}this.selfDrawable&&(c=this.selfDrawable);let d=this.selfDrawable;for(let y=this.children.length-1;y>=0;y--)if(this.children[y].shouldIncludeInParentDrawables()&&this.children[y].lastDrawable){d=this.children[y].lastDrawable;break}assertSlow(c===this.firstDrawable),assertSlow(d===this.lastDrawable)}}updateSelfDrawable(){if(this.node.isPainted()){const e=this.selfRenderer;if(!this.selfDrawable||!(this.selfDrawable.renderer&e&Renderer.bitmaskRendererArea))return this.selfDrawable&&(sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`replacing old drawable ${this.selfDrawable.toString()} with new renderer`),this.selfDrawable.markForDisposal(this.display)),this.selfDrawable=Renderer.createSelfDrawable(this,this.node,e,this.fittability.ancestorsFittable),assert&&assert(this.selfDrawable),!0}else assert&&assert(this.selfDrawable===null,"Non-painted nodes should not have a selfDrawable");return!1}updateIncompatibleChildInstance(e,t){if(sceneryLog&&scenery.isLoggingPerformance()){const r=e.getDescendantCount()+1;r>100?sceneryLog.PerfCritical&&sceneryLog.PerfCritical(`incompatible instance rebuild at ${this.trail.toPathString()}: ${r}`):r>40?sceneryLog.PerfMajor&&sceneryLog.PerfMajor(`incompatible instance rebuild at ${this.trail.toPathString()}: ${r}`):r>0&&sceneryLog.PerfMinor&&sceneryLog.PerfMinor(`incompatible instance rebuild at ${this.trail.toPathString()}: ${r}`)}this.display.markInstanceRootForDisposal(e);const n=Instance.createFromPool(this.display,this.trail.copy().addDescendant(e.node,t),!1,!1);return this.replaceInstanceWithIndex(e,n,t),n}groupSyncTree(e){const t=this.groupRenderer;assert&&assert((this.isBackbone?1:0)+(this.isInstanceCanvasCache?1:0)+(this.isSharedCanvasCacheSelf?1:0)==(t?1:0),"We should have precisely one of these flags set for us to have a groupRenderer");const n=!!t!=!!this.groupDrawable||!e&&this.groupChanged||this.groupDrawable&&this.groupDrawable.renderer!==t;n&&(this.groupDrawable&&(sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`replacing group drawable ${this.groupDrawable.toString()}`),this.groupDrawable.markForDisposal(this.display),this.groupDrawable=null),this.firstChangeInterval=this.lastChangeInterval=ChangeInterval.newForDisplay(null,null,this.display)),t&&(this.firstDrawable&&Drawable.disconnectBefore(this.firstDrawable,this.display),this.lastDrawable&&Drawable.disconnectAfter(this.lastDrawable,this.display),this.isBackbone?(n&&(this.groupDrawable=BackboneDrawable$1.createFromPool(this.display,this,this.getTransformRootInstance(),t,this.isDisplayRoot),this.isTransformed&&this.display.markTransformRootDirty(this,!0)),this.firstChangeInterval&&this.groupDrawable.stitch(this.firstDrawable,this.lastDrawable,this.firstChangeInterval,this.lastChangeInterval)):this.isInstanceCanvasCache?(n&&(this.groupDrawable=InlineCanvasCacheDrawable.createFromPool(t,this)),this.firstChangeInterval&&this.groupDrawable.stitch(this.firstDrawable,this.lastDrawable,this.firstChangeInterval,this.lastChangeInterval)):this.isSharedCanvasCacheSelf&&n&&(this.groupDrawable=CanvasBlock$1.createFromPool(t,this)),this.groupDrawable.setFittable(this.fittability.ancestorsFittable),this.firstDrawable=this.lastDrawable=this.groupDrawable),n?this.firstChangeInterval=this.lastChangeInterval=ChangeInterval.newForDisplay(null,null,this.display):t&&(this.firstChangeInterval=this.lastChangeInterval=null)}sharedSyncTree(){this.ensureSharedCacheInitialized();const e=this.sharedCacheRenderer;(!this.sharedCacheDrawable||this.sharedCacheDrawable.renderer!==e)&&(this.sharedCacheDrawable&&(sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`replacing shared cache drawable ${this.sharedCacheDrawable.toString()}`),this.sharedCacheDrawable.markForDisposal(this.display)),this.sharedCacheDrawable=new SharedCanvasCacheDrawable(this.trail,e,this,this.sharedCacheInstance),this.firstDrawable=this.sharedCacheDrawable,this.lastDrawable=this.sharedCacheDrawable,this.firstChangeInterval=this.lastChangeInterval=ChangeInterval.newForDisplay(null,null,this.display))}prepareChildInstances(e){for(;this.instanceRemovalCheckList.length;){const t=this.instanceRemovalCheckList.pop();t.addRemoveCounter===-1&&(t.addRemoveCounter=0,this.display.markInstanceRootForDisposal(t))}if(e)for(let t=0;t<this.node.children.length;t++){const n=this.node.children[t];this.appendInstance(Instance.createFromPool(this.display,this.trail.copy().addDescendant(n,t),!1,!1))}}ensureSharedCacheInitialized(){if(!this.sharedCacheInstance){const e=this.node.getId();this.sharedCacheInstance=this.display._sharedCanvasInstances[e],this.sharedCacheInstance||(this.sharedCacheInstance=Instance.createFromPool(this.display,new Trail(this.node),!1,!0),this.sharedCacheInstance.syncTree(),this.display._sharedCanvasInstances[e]=this.sharedCacheInstance,this.display.markTransformRootDirty(this.sharedCacheInstance,!0)),this.sharedCacheInstance.externalReferenceCount++,this.isTransformed&&this.display.markTransformRootDirty(this,!0)}}shouldIncludeInParentDrawables(){return this.node.isVisible()||!this.node.isExcludeInvisible()}findPreviousDrawable(e){for(let t=e-1;t>=0;t--){const n=this.children[t].lastDrawable;if(n!==null)return n}return null}findNextDrawable(e){const t=this.children.length;for(let n=e+1;n<t;n++){const r=this.children[n].firstDrawable;if(r!==null)return r}return null}appendInstance(e){this.insertInstance(e,this.children.length)}insertInstance(e,t){assert&&assert(e instanceof Instance),assert&&assert(t>=0&&t<=this.children.length,`Instance insertion bounds check for index ${t} with previous children length ${this.children.length}`),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.InstanceTree(`inserting ${e.toString()} into ${this.toString()}`),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.push(),e.stitchChangeFrame=this.display._frameId,this.stitchChangeOnChildren=this.display._frameId,this.children.splice(t,0,e),e.parent=this,e.oldParent=this,t<=this.beforeStableIndex&&(this.beforeStableIndex=t-1),t>this.afterStableIndex?this.afterStableIndex=t+1:this.afterStableIndex++,this.fittability.onInsert(e.fittability),this.relativeTransform.addInstance(e),this.markChildVisibilityDirty(),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.pop()}removeInstance(e){this.removeInstanceWithIndex(e,_.indexOf(this.children,e))}removeInstanceWithIndex(e,t){assert&&assert(e instanceof Instance),assert&&assert(t>=0&&t<this.children.length,`Instance removal bounds check for index ${t} with previous children length ${this.children.length}`),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.InstanceTree(`removing ${e.toString()} from ${this.toString()}`),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.push();const n=this.display._frameId;e.stitchChangeFrame=n,this.stitchChangeOnChildren=n,t-1>=0&&(this.children[t-1].stitchChangeAfter=n),t+1<this.children.length&&(this.children[t+1].stitchChangeBefore=n),this.children.splice(t,1),e.parent=null,e.oldParent=this,t<=this.beforeStableIndex&&(this.beforeStableIndex=t-1),t>=this.afterStableIndex?this.afterStableIndex=t:this.afterStableIndex--,this.fittability.onRemove(e.fittability),this.relativeTransform.removeInstance(e),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.pop()}replaceInstanceWithIndex(e,t,n){this.removeInstanceWithIndex(e,n),this.insertInstance(t,n)}reorderInstances(e,t){assert&&assert(typeof e=="number"),assert&&assert(typeof t=="number"),assert&&assert(e<=t),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.InstanceTree(`Reordering ${this.toString()}`),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.push();const n=this.display._frameId;this.children.splice(e,t-e+1);for(let r=e;r<=t;r++){const s=this.findChildInstanceOnNode(this.node._children[r]);this.children.splice(r,0,s),s.stitchChangeFrame=n,r>e&&(s.stitchChangeAfter=n),r<t&&(s.stitchChangeBefore=n)}this.stitchChangeOnChildren=n,this.beforeStableIndex=Math.min(this.beforeStableIndex,e-1),this.afterStableIndex=Math.max(this.afterStableIndex,t+1),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.pop()}findChildInstanceOnNode(e){const t=e.getInstances();for(let n=0;n<t.length;n++)if(t[n].oldParent===this)return t[n];return null}onChildInserted(e,t){sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`inserting child node ${e.constructor.name}#${e.id} into ${this.toString()}`),sceneryLog&&sceneryLog.Instance&&sceneryLog.push(),assert&&assert(!this.stateless,"If we are stateless, we should not receive these notifications");let n=this.findChildInstanceOnNode(e);n?(sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance("instance already exists"),n.addRemoveCounter+=1,assert&&assert(n.addRemoveCounter===0)):(sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance("creating stub instance"),sceneryLog&&sceneryLog.Instance&&sceneryLog.push(),n=Instance.createFromPool(this.display,this.trail.copy().addDescendant(e,t),!1,!1),sceneryLog&&sceneryLog.Instance&&sceneryLog.pop()),this.insertInstance(n,t),this.markSkipPruning(),sceneryLog&&sceneryLog.Instance&&sceneryLog.pop()}onChildRemoved(e,t){sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`removing child node ${e.constructor.name}#${e.id} from ${this.toString()}`),sceneryLog&&sceneryLog.Instance&&sceneryLog.push(),assert&&assert(!this.stateless,"If we are stateless, we should not receive these notifications"),assert&&assert(this.children[t].node===e,"Ensure that our instance matches up");const n=this.findChildInstanceOnNode(e);assert&&assert(n!==null,"We should always have a reference to a removed instance"),n.addRemoveCounter-=1,assert&&assert(n.addRemoveCounter===-1),this.instanceRemovalCheckList.push(n),this.removeInstanceWithIndex(n,t),this.markSkipPruning(),sceneryLog&&sceneryLog.Instance&&sceneryLog.pop()}onChildrenReordered(e,t){sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`reordering children for ${this.toString()}`),sceneryLog&&sceneryLog.Instance&&sceneryLog.push(),this.reorderInstances(e,t),this.markSkipPruning(),sceneryLog&&sceneryLog.Instance&&sceneryLog.pop()}onVisibilityChange(){assert&&assert(!this.stateless,"If we are stateless, we should not receive these notifications"),this.stitchChangeFrame=this.display._frameId,this.parent&&this.parent.markSkipPruning(),this.visibilityDirty=!0,this.parent&&this.parent.markChildVisibilityDirty()}onOpacityChange(){assert&&assert(!this.stateless,"If we are stateless, we should not receive these notifications"),this.markRenderStateDirty()}markChildVisibilityDirty(){this.childVisibilityDirty||(this.childVisibilityDirty=!0,this.parent&&this.parent.markChildVisibilityDirty())}updateDrawableFittability(e){this.selfDrawable&&this.selfDrawable.setFittable(e),this.groupDrawable&&this.groupDrawable.setFittable(e)}updateVisibility(e,t,n,r){this.visibilityDirty&&(r=!0);const s=this.node.isVisible(),a=this.visible,h=this.relativeVisible,c=this.selfVisible,d=this.node.voicingVisibleProperty.value,y=this.voicingVisible,g=a&&y;this.visible=e&&s,this.voicingVisible=t&&d,this.relativeVisible=n&&s,this.selfVisible=this.isVisibilityApplied?!0:this.relativeVisible;const D=this.children.length;for(let V=0;V<D;V++){const k=this.children[V];(r||k.visibilityDirty||k.childVisibilityDirty)&&k.updateVisibility(this.visible,this.voicingVisible,this.isVisibilityApplied?!0:this.relativeVisible,r)}this.visibilityDirty=!1,this.childVisibilityDirty=!1,this.visible!==a&&this.visibleEmitter.emit(),this.relativeVisible!==h&&this.relativeVisibleEmitter.emit(),this.selfVisible!==c&&this.selfVisibleEmitter.emit();const O=this.voicingVisible&&this.visible;O!==g&&this.canVoiceEmitter.emit(O)}getDescendantCount(){let e=this.children.length;for(let t=0;t<this.children.length;t++)e+=this.children[t].getDescendantCount();return e}addSVGGroup(e){this.svgGroups.push(e)}removeSVGGroup(e){arrayRemove(this.svgGroups,e)}lookupSVGGroup(e){const t=this.svgGroups.length;for(let n=0;n<t;n++){const r=this.svgGroups[n];if(r.block===e)return r}return null}getFilterRootInstance(){return this.isBackbone||this.isInstanceCanvasCache||!this.parent?this:this.parent.getFilterRootInstance()}getTransformRootInstance(){return this.isTransformed||!this.parent?this:this.parent.getTransformRootInstance()}getVisibilityRootInstance(){return this.isVisibilityApplied||!this.parent?this:this.parent.getVisibilityRootInstance()}attachNodeListeners(){this.relativeTransform.attachNodeListeners(),this.isSharedCanvasCachePlaceholder||(this.node.childInsertedEmitter.addListener(this.childInsertedListener),this.node.childRemovedEmitter.addListener(this.childRemovedListener),this.node.childrenReorderedEmitter.addListener(this.childrenReorderedListener),this.node.visibleProperty.lazyLink(this.visibilityListener),this.node.voicingVisibleProperty.lazyLink(this.visibilityListener),this.node.filterChangeEmitter.addListener(this.markRenderStateDirtyListener),this.node.clipAreaProperty.lazyLink(this.markRenderStateDirtyListener),this.node.instanceRefreshEmitter.addListener(this.markRenderStateDirtyListener))}detachNodeListeners(){this.relativeTransform.detachNodeListeners(),this.isSharedCanvasCachePlaceholder||(this.node.childInsertedEmitter.removeListener(this.childInsertedListener),this.node.childRemovedEmitter.removeListener(this.childRemovedListener),this.node.childrenReorderedEmitter.removeListener(this.childrenReorderedListener),this.node.visibleProperty.unlink(this.visibilityListener),this.node.voicingVisibleProperty.unlink(this.visibilityListener),this.node.filterChangeEmitter.removeListener(this.markRenderStateDirtyListener),this.node.clipAreaProperty.unlink(this.markRenderStateDirtyListener),this.node.instanceRefreshEmitter.removeListener(this.markRenderStateDirtyListener))}markRenderStateDirty(){this.renderStateDirtyFrame=this.display._frameId,this.parent&&this.parent.markSkipPruning()}markSkipPruning(){this.skipPruningFrame=this.display._frameId,this.parent&&this.parent.markSkipPruning()}getBranchIndexTo(e){const t=this.branchIndexMap[e.id];if(t!==void 0)return t;const n=this.trail.getBranchIndexTo(e.trail);return this.branchIndexMap[e.id]=n,e.branchIndexMap[this.id]=n,this.branchIndexReferences.push(e),e.branchIndexReferences.push(this),n}dispose(){for(sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`dispose ${this.toString()}`),sceneryLog&&sceneryLog.Instance&&sceneryLog.push(),assert&&assert(this.active,"Seems like we tried to dispose this Instance twice, it is not active"),this.active=!1;this.branchIndexReferences.length;){const t=this.branchIndexReferences.pop();delete this.branchIndexMap[t.id],delete t.branchIndexMap[this.id],arrayRemove(t.branchIndexReferences,this)}this.groupDrawable&&this.groupDrawable.disposeImmediately(this.display),this.sharedCacheDrawable&&this.sharedCacheDrawable.disposeImmediately(this.display),this.selfDrawable&&this.selfDrawable.disposeImmediately(this.display);const e=this.children.length;for(let t=0;t<e;t++)this.children[t].dispose();for(;this.instanceRemovalCheckList.length;){const t=this.instanceRemovalCheckList.pop();t.active&&t.dispose()}this.stateless||this.detachNodeListeners(),this.node.removeInstance(this),this.sharedCacheInstance&&(this.sharedCacheInstance.externalReferenceCount--,this.sharedCacheInstance.externalReferenceCount===0&&(delete this.display._sharedCanvasInstances[this.node.getId()],this.sharedCacheInstance.dispose())),this.cleanInstance(null,null),this.visibleEmitter.removeAllListeners(),this.relativeVisibleEmitter.removeAllListeners(),this.selfVisibleEmitter.removeAllListeners(),this.canVoiceEmitter.removeAllListeners(),this.freeToPool(),sceneryLog&&sceneryLog.Instance&&sceneryLog.pop()}audit(e,t){if(assertSlow){e===void 0&&(e=this.display._frameId),assertSlow(!this.stateless,"State is required for all display instances"),assertSlow(this.firstDrawable===null==(this.lastDrawable===null),"First/last drawables need to both be null or non-null"),assertSlow(!this.isBackbone&&!this.isSharedCanvasCachePlaceholder||this.groupDrawable,"If we are a backbone or shared cache, we need to have a groupDrawable reference"),assertSlow(!this.isSharedCanvasCachePlaceholder||!this.node.isPainted()||this.selfDrawable,"We need to have a selfDrawable if we are painted and not a shared cache"),assertSlow(!this.isTransformed&&!this.isCanvasCache||this.groupDrawable,"We need to have a groupDrawable if we are a backbone or any type of canvas cache"),assertSlow(!this.isSharedCanvasCachePlaceholder||this.sharedCacheDrawable,"We need to have a sharedCacheDrawable if we are a shared cache"),assertSlow(this.addRemoveCounter===0,"Our addRemoveCounter should always be 0 at the end of syncTree");for(let n=0;n<this.children.length;n++)this.children[n].audit(e,t);this.relativeTransform.audit(e,t),this.fittability.audit()}}auditVisibility(e){if(assertSlow){const t=e&&this.node.isVisible(),n=this.trail.isVisible();assertSlow(t===n,"Trail visibility failure"),assertSlow(t===this.visible,"Visible flag failure"),assertSlow(this.voicingVisible===_.reduce(this.trail.nodes,(r,s)=>r&&s.voicingVisibleProperty.value,!0),"When this Instance is voicingVisible: true, all Trail Nodes must also be voicingVisible: true");for(let r=0;r<this.children.length;r++)this.children[r].auditVisibility(t)}}auditChangeIntervals(e,t,n,r){if(e){let a=e;for(;a!==t;)a=a.oldNextDrawable}if(n){let a=n;for(;a!==r;)a=a.nextDrawable}function s(a,h){if(assertSlow)for(assertSlow(a!==null),assertSlow(h!==null);a!==h;)assertSlow(a.nextDrawable===a.oldNextDrawable,"Change interval mismatch"),a=a.nextDrawable}if(assertSlow){const a=this.firstChangeInterval,h=this.lastChangeInterval;if((!a||a.drawableBefore!==null)&&assertSlow(e===n,"If we have no changes, or our first change interval is not open, our firsts should be the same"),(!h||h.drawableAfter!==null)&&assertSlow(t===r,"If we have no changes, or our last change interval is not open, our lasts should be the same"),!a)assertSlow(!h,"We should not be missing only one change interval"),e&&s(e,t);else{assertSlow(h,"We should not be missing only one change interval"),a.drawableBefore!==null&&s(e,a.drawableBefore),h.drawableAfter!==null&&s(h.drawableAfter,t);let c=a;for(;c&&c.nextChangeInterval;){const d=c.nextChangeInterval;assertSlow(c.drawableAfter!==null),assertSlow(d.drawableBefore!==null),s(c.drawableAfter,d.drawableBefore),c=d}}}}toString(){return`${this.id}#${this.node?`${this.node.constructor.name?this.node.constructor.name:"?"}#${this.node.id}`:"-"}`}}scenery.register("Instance",Instance);Poolable.mixInto(Instance);const Instance$1=Instance;class SafariWorkaroundOverlay{constructor(e){this.display=e;const t=document.createElementNS(svgns,"svg");this.domElement=t,t.style.position="absolute",t.setAttribute("class","safari-workaround"),t.style.top="0",t.style.left="0",t.style["pointer-events"]="none",e.sizeProperty.link(n=>{t.setAttribute("width",""+n.width),t.setAttribute("height",""+n.height),t.style.clip=`rect(0px,${n.width}px,${n.height}px,0px)`}),this.rect=document.createElementNS(svgns,"rect"),t.appendChild(this.rect),this.update()}update(){const e=dotRandom.nextDouble();this.rect.setAttribute("x",""+e),this.rect.setAttribute("y",""+e),this.rect.setAttribute("style","fill: rgba(255,200,100,0); stroke: none;"),this.display.width&&this.rect.setAttribute("width",""+(this.display.width-e*2)),this.display.height&&this.rect.setAttribute("height",""+(this.display.height-e*2))}}scenery.register("SafariWorkaroundOverlay",SafariWorkaroundOverlay);const CUSTOM_CURSORS={"scenery-grab-pointer":["grab","-moz-grab","-webkit-grab","pointer"],"scenery-grabbing-pointer":["grabbing","-moz-grabbing","-webkit-grabbing","pointer"]};let globalIdCounter=1;const qt=class qt{constructor(e,t){this._refreshSVGEmitter=new Emitter,this._refreshSVGPending=!1,assert&&assert(e,"rootNode is a required parameter");const n=optionize()({width:t&&t.container&&t.container.clientWidth||640,height:t&&t.container&&t.container.clientHeight||480,allowCSSHacks:!0,allowSafariRedrawWorkaround:!1,allowSceneOverflow:!1,allowLayerFitting:!1,forceSVGRefresh:!1,defaultCursor:"default",backgroundColor:null,preserveDrawingBuffer:!1,allowWebGL:!0,accessibility:!0,supportsInteractiveHighlights:!1,interactive:!0,listenToOnlyElement:!1,batchDOMEvents:!1,assumeFullWindow:!1,aggressiveContextRecreation:!0,passiveEvents:platform.safari?!1:null,allowBackingScaleAntialiasing:!0},t);this.id=globalIdCounter++,this._accessible=n.accessibility,this._preserveDrawingBuffer=n.preserveDrawingBuffer,this._allowWebGL=n.allowWebGL,this._allowCSSHacks=n.allowCSSHacks,this._allowSceneOverflow=n.allowSceneOverflow,this._defaultCursor=n.defaultCursor,this.sizeProperty=new TinyProperty(new Dimension2(n.width,n.height)),this._currentSize=new Dimension2(-1,-1),this._rootNode=e,this._rootNode.addRootedDisplay(this),this._rootBackbone=null,this._domElement=n.container?BackboneDrawable$1.repurposeBackboneContainer(n.container):BackboneDrawable$1.createDivBackbone(),this._sharedCanvasInstances={},this._baseInstance=null,this._frameId=0,this._dirtyTransformRoots=[],this._dirtyTransformRootsWithoutPass=[],this._instanceRootsToDispose=[],this._reduceReferencesNeeded=[],this._drawablesToDispose=[],this._drawablesToChangeBlock=[],this._drawablesToUpdateLinks=[],this._changeIntervalsToDispose=[],this._lastCursor=null,this._currentBackgroundCSS=null,this._backgroundColor=null,this._requestAnimationFrameID=0,this._input=null,this._inputListeners=[],this._interactive=n.interactive,this._listenToOnlyElement=n.listenToOnlyElement,this._batchDOMEvents=n.batchDOMEvents,this._assumeFullWindow=n.assumeFullWindow,this._passiveEvents=n.passiveEvents,this._aggressiveContextRecreation=n.aggressiveContextRecreation,this._allowBackingScaleAntialiasing=n.allowBackingScaleAntialiasing,this._allowLayerFitting=n.allowLayerFitting,this._forceSVGRefresh=n.forceSVGRefresh,this._overlays=[],this._pointerOverlay=null,this._pointerAreaOverlay=null,this._hitAreaOverlay=null,this._canvasAreaBoundsOverlay=null,this._fittedBlockBoundsOverlay=null,assert&&(this._isPainting=!1,this._isDisposing=!1,this._isDisposed=!1),this.applyCSSHacks(),this.setBackgroundColor(n.backgroundColor);const r=new AriaLiveAnnouncer$1;if(this.descriptionUtteranceQueue=new UtteranceQueue$1(r,{initialize:this._accessible,featureSpecificAnnouncingControlPropertyName:"descriptionCanAnnounceProperty"}),platform.safari&&n.allowSafariRedrawWorkaround&&this.addOverlay(new SafariWorkaroundOverlay(this)),this.focusManager=new FocusManager,(this._accessible||n.supportsInteractiveHighlights)&&(this._focusRootNode=new Node$2,this._focusOverlay=new HighlightOverlay(this,this._focusRootNode,{pdomFocusHighlightsVisibleProperty:this.focusManager.pdomFocusHighlightsVisibleProperty,interactiveHighlightsVisibleProperty:this.focusManager.interactiveHighlightsVisibleProperty,readingBlockHighlightsVisibleProperty:this.focusManager.readingBlockHighlightsVisibleProperty}),this.addOverlay(this._focusOverlay)),this._accessible){this._rootPDOMInstance=PDOMInstance$1.pool.create(null,this,new Trail),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`Display root instance: ${this._rootPDOMInstance.toString()}`),PDOMTree$1.rebuildInstanceTree(this._rootPDOMInstance),assert&&assert(this._rootPDOMInstance.peer,"Peer should be created from createFromPool"),this._domElement.appendChild(this._rootPDOMInstance.peer.primarySibling);const s=r.ariaLiveContainer;this._domElement.appendChild(s),s.style[Features.userSelect]="none",this._boundHandleFullScreenNavigation=this.handleFullScreenNavigation.bind(this),globalKeyStateTracker$1.keydownEmitter.addListener(this._boundHandleFullScreenNavigation)}}getDOMElement(){return this._domElement}get domElement(){return this.getDOMElement()}updateDisplay(){sceneryLog&&scenery.isLoggingPerformance()&&(this.perfSyncTreeCount=0,this.perfStitchCount=0,this.perfIntervalCount=0,this.perfDrawableBlockChangeCount=0,this.perfDrawableOldIntervalCount=0,this.perfDrawableNewIntervalCount=0),assert&&qt.assertSubtreeDisposed(this._rootNode),sceneryLog&&sceneryLog.Display&&sceneryLog.Display(`updateDisplay frame ${this._frameId}`),sceneryLog&&sceneryLog.Display&&sceneryLog.push();const e=!!this._baseInstance;for(this._input&&this._input.validatePointers(),this._accessible&&this._rootPDOMInstance.peer.updateSubtreePositioning(),this._rootNode.validateWatchedBounds(),assertSlow&&this._accessible&&this._rootPDOMInstance.auditRoot(),assertSlow&&this._rootNode._picker.audit(),this._baseInstance=this._baseInstance||Instance$1.createFromPool(this,new Trail(this._rootNode),!0,!1),this._baseInstance.baseSyncTree(),e&&this.markTransformRootDirty(this._baseInstance,this._baseInstance.isTransformed);this._drawablesToUpdateLinks.length;)this._drawablesToUpdateLinks.pop().updateLinks();for(;this._changeIntervalsToDispose.length;)this._changeIntervalsToDispose.pop().dispose();for(this._rootBackbone=this._rootBackbone||this._baseInstance.groupDrawable,assert&&assert(this._rootBackbone,"We are guaranteed a root backbone as the groupDrawable on the base instance"),assert&&assert(this._rootBackbone===this._baseInstance.groupDrawable,"We don't want the base instance's groupDrawable to change"),assertSlow&&this._rootBackbone.audit(!0,!1,!0),sceneryLog&&sceneryLog.Display&&sceneryLog.Display("drawable block change phase"),sceneryLog&&sceneryLog.Display&&sceneryLog.push();this._drawablesToChangeBlock.length;){const t=this._drawablesToChangeBlock.pop().updateBlock();sceneryLog&&scenery.isLoggingPerformance()&&t&&this.perfDrawableBlockChangeCount++}for(sceneryLog&&sceneryLog.Display&&sceneryLog.pop(),assertSlow&&this._rootBackbone.audit(!1,!1,!0),assertSlow&&this._baseInstance.audit(this._frameId,!1),this.updateDirtyTransformRoots(),this._baseInstance.updateVisibility(!0,!0,!0,!1),assertSlow&&this._baseInstance.auditVisibility(!0),assertSlow&&this._baseInstance.audit(this._frameId,!0),sceneryLog&&sceneryLog.Display&&sceneryLog.Display("instance root disposal phase"),sceneryLog&&sceneryLog.Display&&sceneryLog.push();this._instanceRootsToDispose.length;)this._instanceRootsToDispose.pop().dispose();for(sceneryLog&&sceneryLog.Display&&sceneryLog.pop(),assertSlow&&this._rootNode.auditInstanceSubtreeForDisplay(this),sceneryLog&&sceneryLog.Display&&sceneryLog.Display("drawable disposal phase"),sceneryLog&&sceneryLog.Display&&sceneryLog.push();this._drawablesToDispose.length;)this._drawablesToDispose.pop().dispose();if(sceneryLog&&sceneryLog.Display&&sceneryLog.pop(),assertSlow&&this._baseInstance.audit(this._frameId,!1),assert&&(assert(!this._isPainting,"Display was already updating paint, may have thrown an error on the last update"),this._isPainting=!0),sceneryLog&&sceneryLog.Display&&sceneryLog.Display("repaint phase"),sceneryLog&&sceneryLog.Display&&sceneryLog.push(),this._rootBackbone.update(),sceneryLog&&sceneryLog.Display&&sceneryLog.pop(),assert&&(this._isPainting=!1),assertSlow&&this._rootBackbone.audit(!1,!1,!1),assertSlow&&this._baseInstance.audit(this._frameId,!1),this.updateCursor(),this.updateBackgroundColor(),this.updateSize(),this._overlays.length){let t=this._rootBackbone.lastZIndex;for(let n=0;n<this._overlays.length;n++){const r=this._overlays[n];r.domElement.style.zIndex=""+t++,r.update()}}for(;this._reduceReferencesNeeded.length;)this._reduceReferencesNeeded.pop().reduceReferences();if(this._frameId++,sceneryLog&&scenery.isLoggingPerformance()){const t=`syncTree count: ${this.perfSyncTreeCount}`;this.perfSyncTreeCount>500?sceneryLog.PerfCritical&&sceneryLog.PerfCritical(t):this.perfSyncTreeCount>100?sceneryLog.PerfMajor&&sceneryLog.PerfMajor(t):this.perfSyncTreeCount>20?sceneryLog.PerfMinor&&sceneryLog.PerfMinor(t):this.perfSyncTreeCount>0&&sceneryLog.PerfVerbose&&sceneryLog.PerfVerbose(t);const n=`drawable block changes: ${this.perfDrawableBlockChangeCount} for -${this.perfDrawableOldIntervalCount} +${this.perfDrawableNewIntervalCount}`;this.perfDrawableBlockChangeCount>200?sceneryLog.PerfCritical&&sceneryLog.PerfCritical(n):this.perfDrawableBlockChangeCount>60?sceneryLog.PerfMajor&&sceneryLog.PerfMajor(n):this.perfDrawableBlockChangeCount>10?sceneryLog.PerfMinor&&sceneryLog.PerfMinor(n):this.perfDrawableBlockChangeCount>0&&sceneryLog.PerfVerbose&&sceneryLog.PerfVerbose(n)}PDOMTree$1.auditPDOMDisplays(this.rootNode),(this._forceSVGRefresh||this._refreshSVGPending)&&(this._refreshSVGPending=!1,this.refreshSVG()),sceneryLog&&sceneryLog.Display&&sceneryLog.pop()}getPhetioElementAt(e){const t=this._rootNode.getPhetioMouseHit(e);return t==="phetioNotSelectable"?null:(t&&assert&&assert(t.isPhetioInstrumented(),"a PhetioMouseHit should be instrumented"),t)}updateSize(){let e=!1;this.size.width!==this._currentSize.width&&(e=!0,this._currentSize.width=this.size.width,this._domElement.style.width=`${this.size.width}px`),this.size.height!==this._currentSize.height&&(e=!0,this._currentSize.height=this.size.height,this._domElement.style.height=`${this.size.height}px`),e&&!this._allowSceneOverflow&&(this._domElement.style.clip=`rect(0px,${this.size.width}px,${this.size.height}px,0px)`)}isWebGLAllowed(){return this._allowWebGL}get webglAllowed(){return this.isWebGLAllowed()}getRootNode(){return this._rootNode}get rootNode(){return this.getRootNode()}getRootBackbone(){return assert&&assert(this._rootBackbone),this._rootBackbone}get rootBackbone(){return this.getRootBackbone()}getSize(){return this.sizeProperty.value}get size(){return this.getSize()}getBounds(){return this.size.toBounds()}get bounds(){return this.getBounds()}setSize(e){assert&&assert(e.width%1===0,"Display.width should be an integer"),assert&&assert(e.width>0,"Display.width should be greater than zero"),assert&&assert(e.height%1===0,"Display.height should be an integer"),assert&&assert(e.height>0,"Display.height should be greater than zero"),this.sizeProperty.value=e}setWidthHeight(e,t){this.setSize(new Dimension2(e,t))}getWidth(){return this.size.width}get width(){return this.getWidth()}set width(e){this.setWidth(e)}setWidth(e){return this.getWidth()!==e&&this.setSize(new Dimension2(e,this.getHeight())),this}getHeight(){return this.size.height}get height(){return this.getHeight()}set height(e){this.setHeight(e)}setHeight(e){return this.getHeight()!==e&&this.setSize(new Dimension2(this.getWidth(),e)),this}setBackgroundColor(e){return assert&&assert(e===null||typeof e=="string"||e instanceof Color),this._backgroundColor=e,this}set backgroundColor(e){this.setBackgroundColor(e)}get backgroundColor(){return this.getBackgroundColor()}getBackgroundColor(){return this._backgroundColor}get interactive(){return this._interactive}set interactive(e){this._accessible&&e!==this._interactive&&this._rootPDOMInstance.peer.recursiveDisable(!e),this._interactive=e,!this._interactive&&this._input&&(this._input.interruptPointers(),this._input.clearBatchedEvents(),this._input.removeTemporaryPointers(),this._rootNode.interruptSubtreeInput(),this.interruptInput())}addOverlay(e){this._overlays.push(e),this._domElement.appendChild(e.domElement),e.domElement.setAttribute("aria-hidden","true")}removeOverlay(e){this._domElement.removeChild(e.domElement),this._overlays.splice(_.indexOf(this._overlays,e),1)}getPDOMRootElement(){return this._accessible?this._rootPDOMInstance.peer.primarySibling:null}get pdomRootElement(){return this.getPDOMRootElement()}isAccessible(){return this._accessible}isElementUnderPDOM(e){return this._accessible&&this.pdomRootElement.contains(e)}handleFullScreenNavigation(e){if(assert&&assert(this.pdomRootElement,"There must be a PDOM to support keyboard navigation"),FullScreen$1.isFullScreen()&&KeyboardUtils.isKeyEvent(e,KeyboardUtils.KEY_TAB)){const t=this.pdomRootElement;(e.shiftKey?PDOMUtils$1.getPreviousFocusable(t||void 0):PDOMUtils$1.getNextFocusable(t||void 0))===e.target&&e.preventDefault()}}getUsedRenderersBitmask(){function e(t){let n=0;return _.each(t.blocks,r=>{r instanceof DOMBlock$1&&r.domDrawable instanceof BackboneDrawable$1?n=n|e(r.domDrawable):n=n|r.renderer}),n}return e(this._rootBackbone)&Renderer.bitmaskRendererArea}markTransformRootDirty(e,t){t?this._dirtyTransformRoots.push(e):this._dirtyTransformRootsWithoutPass.push(e)}updateDirtyTransformRoots(){for(sceneryLog&&sceneryLog.transformSystem&&sceneryLog.transformSystem("updateDirtyTransformRoots"),sceneryLog&&sceneryLog.transformSystem&&sceneryLog.push();this._dirtyTransformRoots.length;)this._dirtyTransformRoots.pop().relativeTransform.updateTransformListenersAndCompute(!1,!1,this._frameId,!0);for(;this._dirtyTransformRootsWithoutPass.length;)this._dirtyTransformRootsWithoutPass.pop().relativeTransform.updateTransformListenersAndCompute(!1,!1,this._frameId,!1);sceneryLog&&sceneryLog.transformSystem&&sceneryLog.pop()}markDrawableChangedBlock(e){sceneryLog&&sceneryLog.Display&&sceneryLog.Display(`markDrawableChangedBlock: ${e.toString()}`),this._drawablesToChangeBlock.push(e)}markForReducedReferences(e){assert&&assert(!!e.reduceReferences),this._reduceReferencesNeeded.push(e)}markInstanceRootForDisposal(e){sceneryLog&&sceneryLog.Display&&sceneryLog.Display(`markInstanceRootForDisposal: ${e.toString()}`),this._instanceRootsToDispose.push(e)}markDrawableForDisposal(e){sceneryLog&&sceneryLog.Display&&sceneryLog.Display(`markDrawableForDisposal: ${e.toString()}`),this._drawablesToDispose.push(e)}markDrawableForLinksUpdate(e){this._drawablesToUpdateLinks.push(e)}markChangeIntervalToDispose(e){this._changeIntervalsToDispose.push(e)}updateBackgroundColor(){assert&&assert(this._backgroundColor===null||typeof this._backgroundColor=="string"||this._backgroundColor instanceof Color);const e=this._backgroundColor===null?"":this._backgroundColor.toCSS?this._backgroundColor.toCSS():this._backgroundColor;e!==this._currentBackgroundCSS&&(this._currentBackgroundCSS=e,this._domElement.style.backgroundColor=e)}updateCursor(){if(this._input&&this._input.mouse&&this._input.mouse.point){if(this._input.mouse.cursor){sceneryLog&&sceneryLog.Cursor&&sceneryLog.Cursor(`set on pointer: ${this._input.mouse.cursor}`),this.setSceneCursor(this._input.mouse.cursor);return}const e=this._rootNode.trailUnderPointer(this._input.mouse);if(e)for(let t=e.getCursorCheckIndex();t>=0;t--){const n=e.nodes[t],r=n.getEffectiveCursor();if(r){sceneryLog&&sceneryLog.Cursor&&sceneryLog.Cursor(`${r} on ${n.constructor.name}#${n.id}`),this.setSceneCursor(r);return}}sceneryLog&&sceneryLog.Cursor&&sceneryLog.Cursor(`--- for ${e?e.toString():"(no hit)"}`)}this.setSceneCursor(this._defaultCursor)}setElementCursor(e){this._domElement.style.cursor=e,this._assumeFullWindow&&(document.body.style.cursor=e)}setSceneCursor(e){if(e!==this._lastCursor){this._lastCursor=e;const t=CUSTOM_CURSORS[e];if(t)for(let n=t.length-1;n>=0;n--)this.setElementCursor(t[n]);else this.setElementCursor(e)}}applyCSSHacks(){this._allowSceneOverflow||(this._domElement.style.overflow="hidden"),this._domElement.style.msTouchAction="none",Features.setStyle(this._domElement,Features.fontSmoothing,"antialiased"),this._allowCSSHacks&&(document.onselectstart=()=>!1,document.body.style.msContentZooming="none",Features.setStyle(this._domElement,Features.userDrag,"none"),Features.setStyle(this._domElement,Features.userSelect,"none"),Features.setStyle(this._domElement,Features.touchAction,"none"),Features.setStyle(this._domElement,Features.touchCallout,"none"),Features.setStyle(this._domElement,Features.tapHighlightColor,"rgba(0,0,0,0)"))}canvasDataURL(e){this.canvasSnapshot(t=>{e(t.toDataURL())})}canvasSnapshot(e){const t=document.createElement("canvas");t.width=this.size.width,t.height=this.size.height;const n=t.getContext("2d");this._rootNode.renderToCanvas(t,n,()=>{e(t,n.getImageData(0,0,t.width,t.height))},this.domElement.style.backgroundColor)}setPointerDisplayVisible(e){const t=!!this._pointerOverlay;e!==t&&(e?(this._pointerOverlay=new PointerOverlay(this,this._rootNode),this.addOverlay(this._pointerOverlay)):(this.removeOverlay(this._pointerOverlay),this._pointerOverlay.dispose(),this._pointerOverlay=null))}setPointerAreaDisplayVisible(e){const t=!!this._pointerAreaOverlay;e!==t&&(e?(this._pointerAreaOverlay=new PointerAreaOverlay(this,this._rootNode),this.addOverlay(this._pointerAreaOverlay)):(this.removeOverlay(this._pointerAreaOverlay),this._pointerAreaOverlay.dispose(),this._pointerAreaOverlay=null))}setHitAreaDisplayVisible(e){const t=!!this._hitAreaOverlay;e!==t&&(e?(this._hitAreaOverlay=new HitAreaOverlay(this,this._rootNode),this.addOverlay(this._hitAreaOverlay)):(this.removeOverlay(this._hitAreaOverlay),this._hitAreaOverlay.dispose(),this._hitAreaOverlay=null))}setCanvasNodeBoundsVisible(e){const t=!!this._canvasAreaBoundsOverlay;e!==t&&(e?(this._canvasAreaBoundsOverlay=new CanvasNodeBoundsOverlay(this,this._rootNode),this.addOverlay(this._canvasAreaBoundsOverlay)):(this.removeOverlay(this._canvasAreaBoundsOverlay),this._canvasAreaBoundsOverlay.dispose(),this._canvasAreaBoundsOverlay=null))}setFittedBlockBoundsVisible(e){const t=!!this._fittedBlockBoundsOverlay;e!==t&&(e?(this._fittedBlockBoundsOverlay=new FittedBlockBoundsOverlay(this,this._rootNode),this.addOverlay(this._fittedBlockBoundsOverlay)):(this.removeOverlay(this._fittedBlockBoundsOverlay),this._fittedBlockBoundsOverlay.dispose(),this._fittedBlockBoundsOverlay=null))}resizeOnWindowResize(){const e=()=>{this.setWidthHeight(window.innerWidth,window.innerHeight)};window.addEventListener("resize",e),e()}updateOnRequestAnimationFrame(e){let t=0,n=0;const r=this;(function s(){r._requestAnimationFrameID=window.requestAnimationFrame(s,r._domElement);const a=Date.now();t!==0&&(n=(a-t)/1e3),t=a,stepTimer.emit(n),e&&e(n),r.updateDisplay()})()}cancelUpdateOnRequestAnimationFrame(){window.cancelAnimationFrame(this._requestAnimationFrameID)}initializeEvents(e){assert&&assert(!this._input,"Events cannot be attached twice to a display (for now)");const t=new Input(this,!this._listenToOnlyElement,this._batchDOMEvents,this._assumeFullWindow,this._passiveEvents,e);this._input=t,t.connectListeners()}detachEvents(){assert&&assert(this._input,"detachEvents() should be called only when events are attached"),this._input.disconnectListeners(),this._input=null}addInputListener(e){return assert&&assert(!_.includes(this._inputListeners,e),"Input listener already registered on this Display"),_.includes(this._inputListeners,e)||this._inputListeners.push(e),this}removeInputListener(e){return assert&&assert(_.includes(this._inputListeners,e)),this._inputListeners.splice(_.indexOf(this._inputListeners,e),1),this}hasInputListener(e){for(let t=0;t<this._inputListeners.length;t++)if(this._inputListeners[t]===e)return!0;return!1}getInputListeners(){return this._inputListeners.slice(0)}get inputListeners(){return this.getInputListeners()}interruptInput(){const e=this.inputListeners;for(let t=0;t<e.length;t++){const n=e[t];n.interrupt&&n.interrupt()}return this}interruptPointers(){return this._input&&this._input.interruptPointers(),this}interruptOtherPointers(e=null){var t;return this._input&&this._input.interruptPointers(e||((t=this._input.currentSceneryEvent)==null?void 0:t.pointer)||null),this}ensureNotPainting(){assert&&assert(!this._isPainting,"This should not be run in the call tree of updateDisplay(). If you see this, it is likely that either the last updateDisplay() had a thrown error and it is trying to be run again (in which case, investigate that error), OR code was run/triggered from inside an updateDisplay() that has the potential to cause an infinite loop, e.g. CanvasNode paintCanvas() call manipulating another Node, or a bounds listener that Scenery missed.")}loseWebGLContexts(){(function e(t){t.blocks&&t.blocks.forEach(n=>{const r=n.gl;r&&Utils.loseContext(r);for(let s=n.firstDrawable;s!==null&&(e(s),s!==n.lastDrawable);s=s.nextDrawable);})})(this._rootBackbone)}inspect(){localStorage.scenerySnapshot=JSON.stringify(scenerySerialize(this))}getDebugHTML(){const e="font-weight: bold; font-size: 120%; margin-top: 5px;";let t=0,n="";n+=`<div style="${e}">Display (${this.id}) Summary</div>`,n+=`${this.size.toString()} frame:${this._frameId} input:${!!this._input} cursor:${this._lastCursor}<br/>`;function r(k){let M=1;for(let N=0;N<k.children.length;N++)M+=r(k.children[N]);return M}n+=`Nodes: ${r(this._rootNode)}<br/>`;function s(k){let M=1;for(let N=0;N<k.children.length;N++)M+=s(k.children[N]);return M}n+=this._baseInstance?`Instances: ${s(this._baseInstance)}<br/>`:"";function a(k){let M=1;if(k.blocks)_.each(k.blocks,N=>{M+=a(N)});else if(k.firstDrawable&&k.lastDrawable){for(let N=k.firstDrawable;N!==k.lastDrawable;N=N.nextDrawable)M+=a(N);M+=a(k.lastDrawable)}return M}n+=this._rootBackbone?`Drawables: ${a(this._rootBackbone)}<br/>`:"";const h={};function c(k){const M=k.constructor.name;h[M]?h[M]++:h[M]=1}function d(k){let M=0;k.selfDrawable&&(c(k.selfDrawable),M++),k.groupDrawable&&(c(k.groupDrawable),M++),k.sharedCacheDrawable&&(c(k.sharedCacheDrawable),M++);for(let N=0;N<k.children.length;N++)M+=d(k.children[N]);return M}n+=this._baseInstance?`Retained Drawables: ${d(this._baseInstance)}<br/>`:"";for(const k in h)n+=`&nbsp;&nbsp;&nbsp;&nbsp;${k}: ${h[k]}<br/>`;function y(k){if(!k.firstDrawable||!k.lastDrawable)return"";const M=k.domDrawable&&k.domDrawable.blocks;let N=`<div style="margin-left: ${t*20}px">`;if(N+=k.toString(),M||(N+=` (${k.drawableCount} drawables)`),N+="</div>",t+=1,M)for(let F=0;F<k.domDrawable.blocks.length;F++)N+=y(k.domDrawable.blocks[F]);return t-=1,N}if(this._rootBackbone){n+=`<div style="${e}">Block Summary</div>`;for(let k=0;k<this._rootBackbone.blocks.length;k++)n+=y(this._rootBackbone.blocks[k])}function g(k){let M="";function N(ie){M+=` <span style="color: #008">${ie}</span>`}const F=k.node;M+=k.id,M+=` ${F.constructor.name?F.constructor.name:"?"}`,M+=` <span style="font-weight: ${F.isPainted()?"bold":"normal"}">${F.id}</span>`,M+=F.getDebugHTMLExtras(),F.visible||N("invis"),k.visible||N("I-invis"),k.relativeVisible||N("I-rel-invis"),k.selfVisible||N("I-self-invis"),k.fittability.ancestorsFittable||N("nofit-ancestor"),k.fittability.selfFittable||N("nofit-self"),F.pickable===!0&&N("pickable"),F.pickable===!1&&N("unpickable"),k.trail.isPickable()&&N('<span style="color: #808">hits</span>'),F.getEffectiveCursor()&&N(`effectiveCursor:${F.getEffectiveCursor()}`),F.clipArea&&N("clipArea"),F.mouseArea&&N("mouseArea"),F.touchArea&&N("touchArea"),F.getInputListeners().length&&N("inputListeners"),F.getRenderer()&&N(`renderer:${F.getRenderer()}`),F.isLayerSplit()&&N("layerSplit"),F.opacity<1&&N(`opacity:${F.opacity}`),F.disabledOpacity<1&&N(`disabledOpacity:${F.disabledOpacity}`),F._boundsEventCount>0&&N(`<span style="color: #800">boundsListen:${F._boundsEventCount}:${F._boundsEventSelfCount}</span>`);let G="";switch(F.transform.getMatrix().type){case Matrix3Type.IDENTITY:G="";break;case Matrix3Type.TRANSLATION_2D:G="translated";break;case Matrix3Type.SCALING:G="scale";break;case Matrix3Type.AFFINE:G="affine";break;case Matrix3Type.OTHER:G="other";break;default:throw new Error(`invalid matrix type: ${F.transform.getMatrix().type}`)}return G&&(M+=` <span style="color: #88f" title="${F.transform.getMatrix().toString().replace(`
`,"&#10;")}">${G}</span>`),M+=` <span style="color: #888">[Trail ${k.trail.indices.join(".")}]</span>`,M+=` <span style="color: #8c8">${F._rendererSummary.bitmask.toString(16)}${F._rendererBitmask!==Renderer.bitmaskNodeDefault?` (${F._rendererBitmask.toString(16)})`:""}</span>`,M}function D(k){let M=k.toString();return k.visible&&(M=`<strong>${M}</strong>`),k.dirty&&(M+=k.dirty?' <span style="color: #c00;">[x]</span>':""),k.fittable||(M+=k.dirty?' <span style="color: #0c0;">[no-fit]</span>':""),M}function O(k){let M=`<div style="margin-left: ${t*20}px">`;function N(F,G){M+=` <span style="color: #888">${F}:${D(G)}</span>`}M+=g(k),k.selfDrawable&&N("self",k.selfDrawable),k.groupDrawable&&N("group",k.groupDrawable),k.sharedCacheDrawable&&N("sharedCache",k.sharedCacheDrawable),M+="</div>",n+=M,t+=1,_.each(k.children,F=>{O(F)}),t-=1}this._baseInstance&&(n+=`<div style="${e}">Root Instance Tree</div>`,O(this._baseInstance)),_.each(this._sharedCanvasInstances,k=>{n+=`<div style="${e}">Shared Canvas Instance Tree</div>`,O(k)});function V(k){let M=`<div style="margin-left: ${t*20}px">`;if(M+=D(k),k.instance?(M+=` <span style="color: #0a0;">(${k.instance.trail.toPathString()})</span>`,M+=`&nbsp;&nbsp;&nbsp;${g(k.instance)}`):k.backboneInstance&&(M+=` <span style="color: #a00;">(${k.backboneInstance.trail.toPathString()})</span>`,M+=`&nbsp;&nbsp;&nbsp;${g(k.backboneInstance)}`),M+="</div>",n+=M,k.blocks)t+=1,_.each(k.blocks,N=>{V(N)}),t-=1;else if(k.firstDrawable&&k.lastDrawable){t+=1;for(let N=k.firstDrawable;N!==k.lastDrawable;N=N.nextDrawable)V(N);V(k.lastDrawable),t-=1}}return this._rootBackbone&&(n+='<div style="font-weight: bold;">Root Drawable Tree</div>',V(this._rootBackbone)),n}getDebugURI(){return`data:text/html;charset=utf-8,${encodeURIComponent(`<!DOCTYPE html><html lang="en"><head><title>Scenery Debug Snapshot</title></head><body style="font-size: 12px;">${this.getDebugHTML()}</body></html>`)}`}popupDebug(){window.open(this.getDebugURI())}iframeDebug(){const e=document.createElement("iframe");e.width=""+window.innerWidth,e.height=""+window.innerHeight,e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.zIndex="10000",document.body.appendChild(e),e.contentWindow.document.open(),e.contentWindow.document.write(this.getDebugHTML()),e.contentWindow.document.close(),e.contentWindow.document.body.style.background="white";const t=document.createElement("button");t.style.position="absolute",t.style.top="0",t.style.right="0",t.style.zIndex="10001",document.body.appendChild(t),t.textContent="close",["pointerdown","click","touchdown"].forEach(n=>{t.addEventListener(n,()=>{document.body.removeChild(e),document.body.removeChild(t)},!0)})}getPDOMDebugHTML(){let e="";const t="font-weight: bold; font-size: 120%; margin-top: 5px;",n="&nbsp;&nbsp;&nbsp;&nbsp;";e+=`<div style="${t}">Accessible Instances</div><br>`,r(this._rootPDOMInstance,"");function r(c,d){e+=`${d+escapeHTML(`${c.isRootInstance?"":c.node.tagName} ${c.toString()}`)}<br>`,c.children.forEach(y=>{r(y,d+n)})}e+=`<br><div style="${t}">Parallel DOM</div><br>`;let s=this._rootPDOMInstance.peer.primarySibling.outerHTML;s=s.replace(/></g,`>
<`);const a=s.split(`
`);let h="";for(let c=0;c<a.length;c++){const d=a[c],y=d.startsWith("</");y&&(h=h.slice(n.length)),e+=`${h+escapeHTML(d)}<br>`,y||(h+=n)}return e}foreignObjectRasterization(e){const t={};let n=0;function r(V){V.id||(V.id=`unknown-canvas-${n++}`),t[V.id]=V.toDataURL()}function s(V){if(V instanceof BackboneDrawable$1)_.each(V.blocks,k=>{s(k)});else if(V instanceof Block$1&&V.firstDrawable&&V.lastDrawable){for(let k=V.firstDrawable;k!==V.lastDrawable;k=k.nextDrawable)s(k);s(V.lastDrawable),(V instanceof CanvasBlock$1||V instanceof WebGLBlock$1)&&V.canvas&&V.canvas instanceof window.HTMLCanvasElement&&r(V.canvas)}DOMDrawable$1&&V instanceof DOMDrawable$1&&(V.domElement instanceof window.HTMLCanvasElement&&r(V.domElement),Array.prototype.forEach.call(V.domElement.getElementsByTagName("canvas"),k=>{r(k)}))}s(this._rootBackbone);const a=document.implementation.createHTMLDocument("");a.documentElement.innerHTML=this.domElement.outerHTML,a.documentElement.setAttribute("xmlns",a.documentElement.namespaceURI),a.documentElement.appendChild(document.createElement("style")).innerHTML=`.${PDOMSiblingStyle$1.ROOT_CLASS_NAME} { display:none; } `;let h=a.documentElement.getElementsByTagName("canvas");h=Array.prototype.slice.call(h);for(let V=0;V<h.length;V++){const k=h[V],M=k.style.cssText,N=a.createElement("img"),F=t[k.id];assert&&assert(F,"Must have missed a toDataURL() on a Canvas"),N.src=F,N.setAttribute("style",M),k.parentNode.replaceChild(N,k)}const c=this.width,d=this.height,y=()=>{qt.elementToSVGDataURL(a.documentElement,c,d,e)};let g=0,D=!1;const O=Array.prototype.slice.call(a.documentElement.getElementsByTagName("image"));for(let V=0;V<O.length;V++){const k=O[V],M=k.getAttribute("xlink:href");M.slice(0,5)!=="data:"&&(g++,D=!0,(()=>{const N=new window.Image,F=k;N.onload=()=>{const G=document.createElement("canvas");G.width=N.width,G.height=N.height,G.getContext("2d").drawImage(N,0,0),F.setAttribute("xlink:href",G.toDataURL()),--g===0&&y(),assert&&assert(g>=0)},N.onerror=()=>{--g===0&&y(),assert&&assert(g>=0)},N.src=M})())}D||y()}popupRasterization(){this.foreignObjectRasterization(e=>{e&&window.open(e)})}getTrailFromPDOMIndicesString(e){if(!this._rootPDOMInstance)return null;let t=this._rootPDOMInstance;const n=e.split(PDOMUtils$1.PDOM_UNIQUE_ID_SEPARATOR);for(let r=0;r<n.length;r++){const s=Number(n[r]);if(t=t.children[s],!t)return null}return t&&t.trail?t.trail:null}refreshSVG(){this._refreshSVGEmitter.emit()}refreshSVGOnNextFrame(){this._refreshSVGPending=!0}dispose(){assert&&(assert(!this._isDisposing),assert(!this._isDisposed),this._isDisposing=!0),this._input&&this.detachEvents(),this._rootNode.removeRootedDisplay(this),this._accessible&&(assert&&assert(this._boundHandleFullScreenNavigation,"_boundHandleFullScreenNavigation was not added to the keyStateTracker"),globalKeyStateTracker$1.keydownEmitter.removeListener(this._boundHandleFullScreenNavigation),this._rootPDOMInstance.dispose()),this._focusOverlay&&this._focusOverlay.dispose(),this.sizeProperty.dispose(),this._baseInstance&&this._baseInstance.dispose(),this.descriptionUtteranceQueue.dispose(),this.focusManager&&this.focusManager.dispose(),assert&&(this._isDisposing=!1,this._isDisposed=!0)}static elementToSVGDataURL(e,t,n,r){const s=document.createElement("canvas"),a=s.getContext("2d");s.width=t,s.height=n;const h=new window.XMLSerializer().serializeToString(e),c=`<svg xmlns="http://www.w3.org/2000/svg" width="${t}" height="${n}"><foreignObject width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml">${h}</div></foreignObject></svg>`,d=new window.Image;d.onload=()=>{a.drawImage(d,0,0),r(s.toDataURL())},d.onerror=()=>{r(null)};const y=new window.TextEncoderLite("utf-8").encode(c),g=window.fromByteArray(y);d.src=`data:image/svg+xml;base64,${g}`}static assertSubtreeDisposed(e){if(assert&&assert(!e.isDisposed,"Disposed nodes should not be included in a scene graph to display."),assert)for(let t=0;t<e.children.length;t++)qt.assertSubtreeDisposed(e.children[t])}static addInputListener(e){assert&&assert(!_.includes(qt.inputListeners,e),"Input listener already registered"),_.includes(qt.inputListeners,e)||qt.inputListeners.push(e)}static removeInputListener(e){assert&&assert(_.includes(qt.inputListeners,e)),qt.inputListeners.splice(_.indexOf(qt.inputListeners,e),1)}static interruptInput(){const e=qt.inputListeners.slice(0);for(let t=0;t<e.length;t++){const n=e[t];n.interrupt&&n.interrupt()}}};qt.INTERRUPT_OTHER_POINTERS=e=>{var t,n;(n=(t=phet==null?void 0:phet.joist)==null?void 0:t.display)==null||n.interruptOtherPointers(e==null?void 0:e.pointer)};let Display=qt;scenery.register("Display",Display);Display.userGestureEmitter=new Emitter;Display.inputListeners=[];const map={};let index=0;function moveForward(o){o._parents.forEach(e=>moveChild(e,o,1))}function moveBackward(o){o._parents.forEach(e=>moveChild(e,o,-1))}function unlinkIndex(o){const e=map[o];assert&&assert(this.parents.length===1,"IndexedNodeIO only supports nodes with a single parent"),this.parents[0].childrenChangedEmitter.removeListener(e),delete map[o]}function moveChild(o,e,t){let r=o.indexOfChild(e)+t;for(;r>0&&r<o.children.length&&!o.children[r].visible;)r+=t;r>=0&&r<o.children.length&&o.moveChildToIndex(e,r),o.onIndexedNodeIOChildMoved&&o.onIndexedNodeIOChildMoved(e)}const IndexedNodeIO=new IOType("IndexedNodeIO",{valueType:Node$2,documentation:"Node that can be moved forward/back by index, which specifies z-order and/or layout order",supertype:Node$2.NodeIO,toStateObject:o=>{const e={index:null};return o.parents[0]&&(assert&&assert(o.parents.length===1,"IndexedNodeIO only supports nodes with a single parent"),e.index=o.parents[0].indexOfChild(o)),e},applyState:(o,e)=>{const t=o.parents[0];if(t&&e.index){assert&&assert(o.parents.length===1,"IndexedNodeIO only supports nodes with a single parent");const n=t.children,r=t.indexOfChild(o);n[r]=n[e.index],n[e.index]=o,t.setChildren(n)}},stateSchema:{index:NullableIO(NumberIO)},methods:{linkIndex:{returnType:NumberIO,parameterTypes:[FunctionIO(VoidIO,[NumberIO])],documentation:"Following the PropertyIO.link pattern, subscribe for notifications when the index in the parent changes, and receive a callback with the current value.  The return value is a numeric ID for use with clearLinkIndex.",implementation:function(o){const e=()=>{assert&&assert(this.parents.length===1,"IndexedNodeIO only supports nodes with a single parent");const n=this.parents[0].indexOfChild(this);o(n)};assert&&assert(this.parents.length===1,"IndexedNodeIO only supports nodes with a single parent"),this.parents[0].childrenChangedEmitter.addListener(e),e();const t=index;return map[t]=e,index++,t}},unlinkIndex:{returnType:VoidIO,parameterTypes:[NumberIO],documentation:"Unlink a listener that has been added using linkIndex, by its numerical ID (like setTimeout/clearTimeout)",implementation:unlinkIndex},clearLinkIndex:{returnType:VoidIO,parameterTypes:[NumberIO],documentation:'Deprecated, see "unlinkIndex".',implementation:function(o){assert&&deprecationWarning("clearLinkIndex is deprecated, use unlinkIndex instead.",!0),unlinkIndex.call(this,o)}},moveForward:{returnType:VoidIO,parameterTypes:[],implementation:function(){return moveForward(this)},documentation:"Move this Node one index forward in each of its parents, skipping invisible Nodes. If the Node is already at the front, this is a no-op."},moveBackward:{returnType:VoidIO,parameterTypes:[],implementation:function(){return moveBackward(this)},documentation:"Move this Node one index backward in each of its parents, skipping invisible Nodes. If the Node is already at the back, this is a no-op."}}});scenery.register("IndexedNodeIO",IndexedNodeIO);class PhetioControlledVisibilityProperty extends DerivedProperty{constructor(e,t,n){n=merge({nodeTandem:Tandem.REQUIRED},n);const r=new BooleanProperty(!0,{tandem:n.nodeTandem.createTandem("visibleProperty")});super([r,...e],(s,...a)=>s&&t(...a))}}scenery.register("PhetioControlledVisibilityProperty",PhetioControlledVisibilityProperty);const SlitherQueryParameters=QueryStringMachine.getAll({p:{type:"string",defaultValue:""},debugScan:{type:"flag"},debugSleep:{type:"flag"},debugColors:{type:"flag"},showPointerAreas:{type:"flag"}});class LocalStorageProperty extends Property{constructor(e,t){super(t.deserialize(localStorage.getItem(e))),this.link(n=>{const r=t.serialize(n),s=n===t.deserialize(null),a=localStorage.getItem(e);s?a!==null&&localStorage.removeItem(e):a!==r&&localStorage.setItem(e,t.serialize(n))})}}class LocalStorageBooleanProperty extends LocalStorageProperty{constructor(e,t){super(e,{serialize:n=>n.toString(),deserialize:n=>n==="true"||n==="false"?n==="true":t})}}class LocalStorageNumberProperty extends LocalStorageProperty{constructor(e,t){super(e,{serialize:n=>n.toString(),deserialize:n=>n===null?t:parseFloat(n)})}}class LocalStorageEnumerationProperty extends LocalStorageProperty{constructor(e,t){super(e,{serialize:n=>n.name,deserialize:n=>n&&t.enumeration.getValue(n)||t})}}class LocalStorageStringProperty extends LocalStorageProperty{constructor(e,t){super(e,{serialize:n=>n,deserialize:n=>n||t})}}function registerImplementation(o,e,t){o.toDataURL(n=>{t[e].push(n)})}const Ai=class Ai{static registerDataURL(e,t,n){if(phet.chipper.queryParameters.binder){const r=`${e}/${t}`;Ai.componentMap[r]=Ai.componentMap[r]||[];try{if(n.boundsProperty.value.isFinite())registerImplementation(n,r,Ai.componentMap);else{const s=a=>{a.isFinite()&&(registerImplementation(n,r,Ai.componentMap),n.boundsProperty.unlink(s))};n.boundsProperty.lazyLink(s)}}catch{}}}static registerToolbox(e){phet.chipper.queryParameters.binder&&Ai.registerDataURL("sun","ToolboxPattern",e)}};Ai.componentMap={};let InstanceRegistry=Ai;phetCore.register("InstanceRegistry",InstanceRegistry);const sun=new Namespace("sun"),base64SoundToByteArray=(o,e)=>{const t=e.replace(new RegExp("^.*,"),""),n=atob(t),r=new Uint8Array(n.length);for(let s=0;s<r.length;s++)r[s]=n.charCodeAt(s);return r},tambo=new Namespace("tambo");class WrappedAudioBuffer{constructor(){this.audioBufferProperty=new TinyProperty(null),assert&&this.audioBufferProperty.lazyLink((e,t)=>{assert&&assert(t===null&&e!==null,"The audio buffer can only be set once")})}}tambo.register("WrappedAudioBuffer",WrappedAudioBuffer);let phetAudioContext;window.AudioContext?phetAudioContext=new window.AudioContext:window.webkitAudioContext?phetAudioContext=new window.webkitAudioContext:(phetAudioContext={},console.error("error: this browser does not support Web Audio"));tambo.register("phetAudioContext",phetAudioContext);const phetAudioContext$1=phetAudioContext,soundURI$e="data:audio/mpeg;base64,//swxAAAA8ADNZQRgDGHni23MIAC1bbaiNgdgM+wEHBiogUAbxA4MT+////gh//8Mf4YzNI0kYiNYjDZaLJCYAZZgbhKQTNx5Vp34WpSu/bhLvzLYwWSHokUhx0EBR4FA/Mp8sOz3gcWfL9YqH7kKIkzd9fLvSkB201St7337UyHKf7X9Pf//Ue9/6irjy/l3s5gqCo1lPVlVSBj//syxAOACFB7hZyUgDEUCu008ZpKfZq0pMq3UhCDwXYfD+n5X+IUp5YiEYMB0CgRCwfQF0AmAUjAlZVJuE4ZaTbKK0AIJCxUAwrWLf////l1oFP9Yo2m1QI89G8bsISUXc8TjPs5pDlVUzUq1VJLFYcIlvdQS0P1lohZFx5hFpVDCPaSKlRsdgIslDzfeqxt8iVd+v6aClA3ydRso//7MsQDgAhYV13sGEqhEJFpcZMJqE0gGS8ZU3ekWmMRbO4kqZnMgAHAFiPmBRdQFgRZHZrTNwZcRTYLKU4qxy3ieKohBwSNif5UwYc4W/ywiEYAtIWoggTByJ+YPcFxgdYE5MVlD41ZJSYBdPF8gQIZtZPy/cZWxBR5Bm7WwZdGkolTRTQXLpSOcoUvf3in/dyBZwzRXAF3ieJEAxD/+zLEBAAIkJlXlYaAARIWb3MegACpLHqwdgk0mfJ913UT0LiL5W+nIh+DsKATQJ4F0E4PF8c7FxaaaCZ80SpqZbfX7J/99fN0p/Onf+zSaVmKSAKAgKAgMAAAAAEBCVMt4sfsyRdHO3PTH0SBFi4jhEgNBinEXeeDSKeby9zBMKun3/pKZ6L//H/6T/p/82bkkAyj/5m7WOWuRFpI//swxAOACDgvi7zDADEQkW289AoWMABHxkZCUEwfjodDiYmpiWw9NWjIAhJEFkFSo4GnxwiDsrBoGn/g0DT64Kgq9BUFQWBo3WFDf4B//ljZRUwaFSyREkApYqDmkM8qYgtylZx9ZL7knEF4rFKLgqfa4GHahJbD5q+ZdeybNpd1LOzqJVWdmJgs9uNUoK61I9Pf1runDP5da2kA//syxAQACHita6eYTzEMFSdkzAigHGL2uEMDLL6xtFmUuujunUP9ODzjFKbt2J5yt77uOmiJWXQ6GAbIjvu17WVn/dDEccwhLJLW6dXU/dcsEAvP8BAST22Qg8WJEX2Cxxs84/BnOt15rGZwVs2FEtKWVPRHZitdbuySkumtHlb0M/U5QwcQRYSLI91T/epbUqPPogEGy4Ldq0ABj//7MsQEgAfcrTesFG1owIRiqMyYmD9U8MBcisSsURTFgBykNZkSUjL+oDB8VGCT310AYfb2ZlVRgEvbASNp8ptD8y7lYYlvxtFsCgAAYAQABAzjzrwIrmT2cuLIZOOOhHHQELC2rOtlix709VXnYiej4dx2rz2Vd/xL6QQAAHCikADAVHicCJrfesiRcXCNaoKuuneW+r1dXxFDvZf/+zLEEQBFcCEJoLHi8JuFVvDMGGz/vqeWI50KHuGnJHLWAAQIl4qgkpSn8oGq1rUCoSk3UAhEYtCgKWWwwIDo////4sLVTEFNRTMuOTkuNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",soundByteArray$e=base64SoundToByteArray(phetAudioContext$1,soundURI$e),unlock$e=asyncLoader.createLock(soundURI$e),wrappedAudioBuffer$e=new WrappedAudioBuffer;let unlocked$e=!1;const safeUnlock$e=()=>{unlocked$e||(unlock$e(),unlocked$e=!0)},onDecodeSuccess$e=o=>{wrappedAudioBuffer$e.audioBufferProperty.value===null&&(wrappedAudioBuffer$e.audioBufferProperty.set(o),safeUnlock$e())},onDecodeError$e=o=>{console.warn("decode of audio data failed, using stubbed sound, error: "+o),wrappedAudioBuffer$e.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$e()},decodePromise$e=phetAudioContext$1.decodeAudioData(soundByteArray$e.buffer,onDecodeSuccess$e,onDecodeError$e);decodePromise$e&&decodePromise$e.then(o=>{wrappedAudioBuffer$e.audioBufferProperty.value===null&&(wrappedAudioBuffer$e.audioBufferProperty.set(o),safeUnlock$e())}).catch(o=>{console.warn("promise rejection caught for audio decode, error = "+o),safeUnlock$e()});const soundURI$d="data:audio/mpeg;base64,//twxAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAAvAAA6xgAFBQoKEBAVFRsbICAmJisrKzExNjY7O0FBRkZMTFFRV1dXXFxiYmdnbGxycnd3fX2CgoKIiI2Nk5OYmJ2do6OoqK6urrOzubm+vsTEycnOztTU2dnZ39/k5Orq7+/19fr6//8AAAA5TEFNRTMuOTlyAc0AAAAAAAAAABRgJAW0QgAAYAAAOsbaTGT/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/7cMQAAA7dBSqUMwACca6u+zCwACApgAAXXczyPLdxZhAGAydwQABDIj/xEZEREf+Lu7u7/u7ve0Rd3etERv//7EAGAydsYQhyCEf3va73/vdxEREREE78RGRBMmnYPg+DgIHC5QH3rB/EAIHCCgQBAoCDsEFAgCBQ5BAMS4P8Hwff8Tg+/Ln/wfw/dtCpCmhkRCphx5RJJZZeBkRuhKWvyydbusLOy2X0io3WgGaNyeDJBmxPyYwBMkkASVLJiZ9hJJ6AbpW4kk99nJJYE5sSUUDSD0v2Uxg7HWSUR3HErRtlPe9nmg/mKDjSLtiEPSe+7iuGG73WurKU76Uc2rl97P/53S1Zi7F7bTdrqiJq7Yyv/6/4uDVj3sbtRSKhqLrLWf///+W7VaNBODMAAAAAhEmcl8uCdsv/+3LECACSeTVr3PYAAgosbbjzDui0GmTRO96xrR6OSGLxYWzCh0mEDaIBVQ1xdHw5aTTq1RBj58yvaK7kDNUcale1G/E8611+6daha6+Nuve72X/mq1vX4PrMdWcrz6xDa5mtWNdU7m/T6NNo///rm27+dT9a+Zkd6fT/g32p4lBxRRZUUEZkSpCIsNCAtctr9kCSmrzv/66lVQ1EAAAYJYBOUKeF2LY8JcplQlohfTxvMumyOzxtvJFI2I1iV/2+b7RFSrZTO6aJ5MkgHPUtQkCaHAveIIOrPtb93Iau5+y1NzYL9Qj73xM3UbSGUWHvsqfnJ4icIKCqmRkXHi7Fv5s+RbK+5lfBfsWpgmsPoMiQNQhUGq3ftfu6lZEQCAAdhIBYSUm4Mg3UkuGF41iEbgUdPDc0Got2R//7cMQPANKRa2aHsMvSTarsuPYZuF8aBIK5DNG4yVq00SKu45iMbvD0hnRdGZTLhUOlQUHEQxZI0nUJm0eSI9baV9KuyiRjoJrc+33zekx8HOlcjZN4SRow5KvReT0TCBrN5PBctW1DG1BO3JGo6UyE3L+XmU8bx+21n2sOs5ISgSu9fP1RoRMsZ77pdCNCIABRCfq0cp2mW1JA00GjDcnVzET1hxp6vWITR2PwVqBRd95y4yfxk4HlFxmuHsEjwSERbPSaPrt1rjJUq8jTztuqiMIVvokgVZPpldExIjDdS9MOF3tn6v8gSijYMhZdMloS84Dyk4Lsoac1AqaTR5XfbyTuuj6NOqzp1t9l4VzLVkgtFz8qLkpm8bfVkTwqWRSIAENhDHdSKh8TFYPi2SliEOJphuJA5jj/+3LEDQDTVTNihj00Sj4o7Hj2GbhRwjFogi0oCEEKpXkDQ1XO4UdTsldrplPYETbDxQUMN2RoQRERZZJQlaICdRovjetIl4a1AypaO64eFzYtvYbaiI8RsJrwhKL8V0lctGLEIJwUhc2no1E10MGWlobJRcTJOnBVN9RTe8x5xQY8gEhGeivAD9Kj2clnP0/r/o7f29wRGQgQABBRd4DWoKRz9PqW7bVVK8wKpJGy86YXjydIg7IaYyTkMnA2HwkDgymWHRgeURnDAzUiQpfWJbqrP1doW7Dr9JpEmgU3ufBglsjOYkLEluXfsxgU5RIm/ko4vtOUFPCpwXcpak5aDGo/HwkcpnNSBxyquxpaphphuZesaERW8FTYmOECqEVujZJWxNWpYjUiAAAAABXCElsN96SxSHuec//7cMQKANBlN2XHsMvKbSrr0PSbWKeMk7RApAVSWnGtss2qvAuSCo2gVOx7aTWgRwdC5Q5XKyMtVNm2IZy4mpVmLH7NfyhaRF/heeJh3pNkpMM/k7aMTihApGZc84qJyHSjTrYzLy6ivnLwz22bTM7drVPZtI9MRR3bZ+9w9Ltel/97bnYuNAAL8LFCONVLkcZinWN2qQORCmlQaUCJT9lzChDkF0X1hSqptOVIxmM7Ucp0/MfyWQlmdLghBKmIp2aFZWM5lgbPoUhg7qxmN4ISJCKXSnqNpc0uRnPprEOYXgy87ih5UlaYQL6pqaJsUsnzp5QwpzOkSOOOTWFwVqakTZwqdaj2KXRFTV0GKh7T2vvbe5QVFDwHXHqlajd9StYlCSAANRqSAJBoRRGHkjA6TxyIA+vliCT/+3LEDICQrSthZhh6yjIkbDj2DmFDE0z2x0vQCQoOhJx8rFAdFDZ2vbJInVXPpSeDcrLjyPC8sAiemDcKFpMhF92taG4+42EiJE1ZhgSicTrsjfS9/CvbIyoCrYmm3DfNNQ5WB0Q10HLJAbJkFwxC0Fu297fNssCm8QbOdO/tV193CKZmBAABKAVIlF5gMAgpbT/O44z8TDeq2eC+HqA1C7E7YpD9EOHZWJJIXXwqFJafKkaZZdeUkUBCEIBI+mpPYiwjK2c+A8hbbZ0dDQQHEkFHoymLa2AxYcIEUMoBuw5KalXDCLHkaBMydjxmN66RnpVdXDBxME0gEChkjzuO1DfKKlQPTu/9v+13e7u5VEUxAAAABwSD4UiRyLeZiLMih9sA4dhKdcRRCU8+ndKQ1pBGhsvHg3XLlP/7cMQWAI6I0WXHsGvJ8J1sOPYNufuFPYo0x0kMlqhDiah7AJAjhyh6wSZ9Q0zW4Fmbk5MFHDKCNKlXyosaC+UZEVWjIBeXysepCx8o6Hnlw99Pcn/nX7xI527e12HMSMQAAAZLEqHHAhktVh7RELbDJhIhuNWyQT1CWJsxIgkxgwokafXGxUcZiPnYTBebWTDm1GtWn8BaUuo1jFYMPL70cz7M6bZigguUndXaEhoGsIBrC6rofIZiBDspucY46sX9muDoPBsWHSspVvxWp8tep+vi/Pr/m/+qqFZFYiAAAAAFC7hekzJyZZ3DPXJLYJ3K6EgEKRDJAQqAAJ2tQkaMlJ9g2bWUVh9pkiZPrkJGOEC3SpVdVtOL2GV3u3WQKxUQ9pnsyKV0M7o+w7uitfchFc62amXq9jP/+3LEL4COtVtl56RNwc+c7Dj2DXiqImdumXoN5G0qdM1vGNpcQB6SK3stfTuhmYAAAPYxDlISOM0FaYScQ9cogwD5parHpabmJ02cKWFaxEmHzXEWQt1XXoQrr0x03A6yYQuPFiCooDQoADMSKNeSiBcJiFTW14plS3IQzZZ+zGUNiJQcVUyQHrrYTEJwCgUMtvaA5BZxkUNHiDpl1/7aiHJDMQAAAAd0PM3hxAzRwnszI9aOm6rP1Cz4kVEYDTgqjaIxSeFa6JUTE6ZAduaEgJFEQuoH1BUmWcgLonJImk1UGSej060BEKzkSvd3FAAcKYvbC5EajkYJHJt4WhjhkSOtLMnpG+e25jF+2IKxowYeXkTMqCiBRrK62W9MqhmKAAAlC7K4mQvz7bDlZi3uLyY4Cd+ileIl4//7cMRNAM+1J1/HpG3B9CRruPYOKDIUIfKFNyE20aoQMRidQ1TMr1HkdQpAaPaAfR1PmVh0sVsqnUJ9E3dkSwIE7XIhHBDikLgQfUa4kGkJQI4T07WgYkhdNcrlx3ztI6+nclBGyChIsak0m6ooFiykFiMdR02XdDUkEAAAABeVhMT4Q4vBoI4zFeh5yKRRoxZKlFZsZV+6GOTYUBUxsbq1Y/JbetkNqurITwvQn7unrGKo455/2ob/hWM6m/K2g7uR0dnbOk2v8RIzo+5ZUvPe/S9PekVx4v+JhTFxvHYyLuI6bRf3RXMd8HLtv/2qZFQxEAAAOCSHcYCfVg9RYz3cy9lxVSZfsYrcVNAqJH2eCC4rDI4HlSx8aLoAxpoicsqREoYYPB4FugaOFJwZcsVvFP1FeGEMm4T/+3LEYYCPESNh57BtyeElq7z0jbmgrq+MIEqRqRSYi0mPhTPRjNVrXp8LJ+SQ8uW7/DMGDumQ+rrzR3ryX3O92v+RqUY0MwAAAAAXTpGONc3KF+OsOo/FKbx/CSJZsYlI6vpgfMqj4UJDFS9C8Q05xZm37dchmZyevLGlS+Yo6iReBS3DRDRkkBm3NIU8lPqUlznCtWw5w498j/rVjQodLFEpY1rC7gWEYiNlrmpnowi9zVTjPdR42UgAACocAoQwUWABDmfHKCVTQThKTl+iZsqrjmg4BabHZYSJEZZOmEq84Q0z7rCMJCwVIgoYBKhkXK2JiFtvV10kLS9eIdhiKnBNcLuLLowUygguW4sUxbD+VRDovWHHNhlL4Svqcj+ywIECwcC0ofQAkOe4oFBcAXFFrV6V3UgAAP/7cMR7gI6FC1/nsGvB+aSrNMSPCAAAACh+NZyMh+4OMvxbieLOobGtP3q+cbgq0+jm4oFc/aijNyMkGkdgNjokoSXTQ5hQyfUbgoRR+Tp3iWggNLiOswIR29Sco88ct9tesg2pEnxe5uFkt0rIjthHI7d5ffJGfpThc2KGVrJKHCa4Mh0gwadW0Ox2ZoSKdWiFIgAQAAAYYh+qQy04eTISpHduURoTsCseKRCxwOaNwnB3iTifm6Xpf0imclarQ2DoNG8EwhEVgqiMCIQkoTNBBkEonHkC0Jrn4QYWJ1nj0dUbWnFWP1q1zMbapdrVZxU0cjdpCeN5nbFOAudL+0i28rLiM3xqRC9deil6Vf5KkQAAAACqQFnRAnqCJiqy4G8eStQLU9OvMh+TI9hdvWQsZbRmEgcUdZP/+3LElACQAPNXp7DUgfEl6rj0juC4ZUW9LDp0h8wMzLz4SBJfRFw/LqZGl9PZhl15roRZOEmRzzRiqcGgOhSG7TFjGAELhQhp+wZO8opy+7Wf24GvfjvoN+j1NaDpKN6//W/krZAABdHpTpuiQp4hyKKihY2M6WQ3k1ROKM4TDhIyM2uZ1PDFYXaMoxKgfKwxORaRDBIOhQUDJVEDRWOChN7MkK8zk1KZiogKKBMFJ+MIkWHqAsFBaK78t0i8H81vTiNZlGLJTvGfdfXMaGYnd/x37uRfFW83arGaiQAAAAC8JgjCkghYAksA1BQODEenTYS1r4kkIWLzMxtUrFcFyUZDq4PJAsKmDQDOOCQyLlAkCpKZGCY4cHk1Dg+vZ5BsG2LQSyiQEtVdwKBnEA6pOJxxDZkLBcafFf/7cMSoAI8Qz1ensHTJ25rq9PSO0Uk1gFwouoNGCTmqoD8Exh5BdIsR+tygKKJMlXsjtLwikYAcLEd50jhPsnhNEWtnicDOl3E00+hhw4LopmBzOCEc6qG0zzSm6XpLQh4UTPImEJg8MS0hkkKR0Ulcw9cTASAOqjSRJExf3ErpIpmVeRkSbBRmOTz1B2M5oqAWLFA4SYYQ4DaH89IgQXFwkLIBc3HI6rs00gAAAAFOryeKsnirMxGiek0Ql+fUU7FMysiRcyoJqtNypOEXRXjaQtGNsK0hPGEbgllldVShrGD8qB6fLMb+EcGMGHcHAJ2IBQGqS0sEKFgJhGHxSCLmYs2LSlDez/YymmTqRfRDVX58Kg5d6wWY7kR6RY6aLNNZQCiMioe5H7en/mQAS40Er5PinS6cC+P/+3LEwgGPxMVVpiR2gdOZKnz2GsjhwQ9MHYTgvoKnBCyD502kiySOjElIzEpLlvLTxZaBCW4hOPpvJoTBPoopYxFwkOdaciroWFLOf58cz0FjdWNPysc1jQy8uzLnn/9SNtnAuGnBMyre8AHTUOgHRUAAC6DiPU6U+1dRIOOCnAaJaRbhAAuoMUTel4QUIkl4pqyNe9RhhpYl4HnQLUuSeQVGlAo5CQmK3FoKltViaMi7CawAUYhAg4FamyWCOQUNLYoPGWr5qSQWFRqPLvbxSxPmRR6Nny3nOliflHGcEYni+kGEMY6kFXZ8IFeP9NDlc0Y8O9tcTsYSyIRwJGk86QER2vD08MQ9KCZdCZPGDaSKA/cu9pYXYj9bXIENI6y9o4NPcU1iT3vmnIuax/nDff/Po1CgAAry5P/7cMTbAJBZK1OnsHSBp6arKPSNskz4ribKE6ihPw63Iv44UDcDMAJFkHTodUNEPAdCCbH50wVBaJoHS6tfNnj1QwWUg7A4TlBdKa094m+FF4hwIGpCllgVzyXPfB/5xRSkgdVnKd35HakP2fGdZHTctg71l8rn8QHbWwgrOVyO/mQzDerZKjQAAAAAABM9eRVBLx50xGtp3TKVDI5x3aRYRjdHLxkQ6ICkXWpFfS83aaYkikisVazNFb3+T9SeYk01sVmnYc/Jc9RpTJTRfiQK8F7wNDliTLEd2zMe66+3khD800PDu2DqgnE4ycaSkIRSUHA9PH/+qo82UlLxSue6k1BNMJySA2DFwYqAV9OY/77LTLIEAYVNAFhCNInLT1ie1//TqiUwAAFMQUuSCKk8WxHHMlUNUCP/+3LE9oCYMSE8rD2cSeKlKjT2DXksr0uY1l5Dz6NBANsQpUAN8fr5lTLY1OBf09EiLl4uVhxNNYfvSCqBIKNrnq/4UYB7IujT5ZFm1GS1L5p+JJG8aNPztXsM7lPi8zk+CXkED1sET0MFJSmKR0VsV1RW0AAAAAAAxaiRbws7h9PRJNE5IRMZrqdLSwqNCY7zsMbSSXAh4rAk3DgLk4KW6KNCACLvjpapUKQ8nSpqyBSpAFFF5JeoRL6XWXiStXwEFL01GXJmq3rzi0qcR+4BXPEbbt4qh+C0xFAfjkpMk5mcmYvkJQ8iMCcoAYMmSIRjAhWOLCcvbB9hzl5wlNWXKkZEWxmWtW05TbXxJ39x2XvHRyW00uTSNKMgRMGBIWhO1Ob79lgRYIAADqIDuXBLHxMTdsW1CEIdN//7cMTrgJO8/0OMMNxBx54p9PMPSJvncnmFXE9XlS3LBZkqH6HIQDEbA4IiYCa0nICQqjodFNgc1g5FQQkAUCQmLa98f1jR6bIS9EkRHx+sVCJAldbn5ENjene5nEdndlq1o3zPg0oD1LDQBipA293w1Sn7+ffVFCAAAAABSVtlf9ozdYDWi1t9ljtfa+67lLHhhTB2QcovsmKmY2MWSDui4GRFpV5LDMhFQAwaq5ZEasz1kTzhxy4Cxm5BiMEkxEVDrB1M05ujIYeS/guZWrAcANMvuc8VPberlwLNKzChQ+hNlBWNo5hldcTiHsoGTQ+2LmWbNvWRm9R1/kZ4iIbpXRQevcLC5bMcs94buQowHACycWDk3cUcthq+hn0alIABVChRZlL/1mupeoeC31IpqtcN9iJO1kz/+3DE9YCWRSs/TDE8AdgbaXT2GmBVw3wSqeCJHIwAFhBizUymLcPdvHpLGcoz1WcxznUQ0uqcRosJPhOSZui9EEjrtWFmGADAOKiAEoEpOGEzCiE6OFlYtSeuZWWkNPUkLMuWsnMdVJRmsm9Cz/WW3gdAQoWNkQeFEyb2mCrLjRp5xG3zy6F3dn9CcZKSAAAAAKhDzrFtPUQ8bo8VIWwpTiLYWBDxYdQS4rlGoAmsQvhjG+aZbi2LSfTwiitTiUbmPT9acVW8W0PRqNNJDj+YqJPQKCHdI2SHFrdJo4t1uHm7mTkbRHjmE1tLGE45+945jkNBcLNRBtSL7BYLsuYn8iuUMaMvItk1SIggAAArQIuxbbDmXq5bPALE3fdOXuU6DQGDReah0uK0mbhx1iZqaLM0IkiMYsLI//tyxPMBlO0lP0wkfIJBG+h1h6V4cYNomiQTDAXtdxT1RK0uBMYtUG+LCik8hiKiJh+/Tqpgv2ZthPLNxPEFLQI0cLOgiuR3LHyHRqZSpF2fGOxeb0GmNmfjVvaDbLsYgoFAmpJoWBsbJ/1QEkb3JC+mawAAAAHafPSpezA32dVgimyt8Ax9SlaLmoJVeMmIgJ8onr5bopuD1pyjRzMMRRSURbUoDFOOFhLKWO/jzu4FgM3RKcFV6l6SxbllKZSsixWwLGLxW5RA78RVxXIaLAr+rBLnSD2hmUK8PniaIxZHAj1EsiOHR9apWIcb6srmK56s2iskmlQcMMD06RkGTRZc0OkzHaLid5Unv7hNA0PFEEU1m//+pyEB9FhFuVIrgkAZIoQyBzJcnDgRBFog3i5lyQCxBIkssGr/+3DE6YCPxM9Lp6R6EjKfqHWHmphgYgAYAKkoshwlqHFYctOIiFYWlixFzrTnIaHAoTEE72EMTGlWA1ql6n1ornaUwBoKs8prshUdjjW2vxJx2VCwuKLZDYbBKapQmioKhGkkTlRs0SLgtUA0cTkMKtoVp9WSx2a+42wr72KNioRp0u57lmRbyM3mpeAAABDdV3N0jroMbWAYkwVwmgQaoo5a5Iw3RvFRCzCLD+paIrx8DnMZh4AYZKtssQQeQSoNpDUsKehnFIq9+XTQ5AkJepnqLcRT7kac9G3rEk7Hjfj4q3eZ41py6rUplWwuQJHno4oSDvamqj5cTZhIQItdM5G2VaM0NRpbejEmmSCASaJXyPFgupDoklAAY0TNLsbxQqRVheo4fKrBVp9uMn2t1fTW0ZUZR6JY//tyxPYBlLEdOSww3EJkoCcg/CXxMw1YoYIRnKjAvJAanTLXNYoiam+nujSnk1h5Wfp0RBYZQBqa3kWoHBW2w34jcaeEpYFpmEo9jSPpwXx9JZsSLDXeGiGfGSar52VE58vIFTz3uZWKVmr3CvK5lx9/5vCt6rrEFv5ysLmoYblhUkrJiwp1f0JgAAAAA9rkcf1w2qtFRXjUCs5eahgwuYw9ibRy5rAoKZkiBQJ/odHxELJXKVpMvWyw+CkV45Sx9wXheVqDQ1tNSQ+WO/rI36clp7cnWm2ZPyweKVH8m4Dzk9HGzQ+V5wnp7aaIlHGBK3kCOAhW5uRzFnICtUJhoHHRnY6QFE1DuNCZo4EBWpw6kqBJ5hix9n/6pCCwAo+DnR5GTAMuwXReB4OBlKcdCLXZ8EmVxciXiHv/+3DE6QGRmOk6zCTcQk+e5yT8MXhIDMAJBCRXgYgkBvH4iQkSbP5rRDsizeUBJA1IhDAQsQAnJDUUSFzWh3GgTk0yMVgOaijLAkw4ISBwkELHF0xKDRuI95AjgwymZj1p0Xh/iYpqrE9gwwyTGFbzbPQfW0v//s338y2mzAAAAAAAAKhwOo4svV7xnLNXFmlfOU3V4KJXMYZ4ny6yUaGyUTysLTlKEgh0SIa2+4qCuZfo0MGCv42JrrcXYgN22VqaP+qbrhNKUMb567iwEABEpLB+yPTTA/qEIygOZbIKNpVHZrPMTkjUyqMgklYW5cN2TqaJBkSBdoKkoiAzBwZNmW29oox6lf/sT8db78BkQECbNJ9O5j5f5CWFAsGa40lJBiy6HLuLwL6sgFgqDpVg7Cg4rIoqmSud//tyxOqBkijxOywkfEIaHGd09JtAEaPNwDjg5KHjdH/TyWO1pPt41B1g18K1LOCEpsJeQ6gqzpcMfTghxbCbqhWWZ1HALGhR6wsUmRK2ISomIhguqfgyOTDkZyMOP2RRIjxYvWvd24YygNSaWDTwVSQTtvZwoVlB3/1/99UQkEAAAAABXD4wrxOUqOiESyIWFTm2h5hkrVkQTVCUPHahKDXBLiwASAzBfIeW4hafJMQolTSfjSbRPnbc2lsEqYROB3vjnXzBQ2eMUl0fqmahCHf10ioIE8Jlm2+rMQSxRlIiMT6NKdqVGfNKoNDE3iVrg0HyqrPCT3kLLx6adjS52uYIe2XLkADc5pj7Ok/40duJerKCyAbtkCH9LFkfGTpsFt4oiqEFeZYoLUkqdAAcYkNRhrQs8QpLuCP/+3DE8QGSINE7rLDaQkycppWHp0IILRLtgYECs/VtRPUBVhSBR1WSlLARENtFTpfsyHsdZmnasqEwDKWCcnUfsJJJWOVSiZF5DOjj4g+YvjJEojFTRYmLkNNvgjRIzjMW2TBZ3SI4QZzyqOtYxSgFmElB9Cxq3BST+r/t/9v//7f3KkAAABKpXhehmDKWpOrBCCNbLD25IAA5JeFnyqSYKlykAKscM2ES2ZxIYA3ojQgmUBFQslcQAnJkpYvuz+Dy8qtLd0UG9SVf+NoC4mXaWsm85TkNZH49LYabE/J0yK9RoYzh8miCbhIbOSWFh8F2GkZUdnJsggwaMG2LaO2Q4n9WaxvNUVEANPSEhceWFgGhOw+Jm1sjqiv/6zQAbJmTjltgmlfqLttKWfQTCV2OS5sCxJeKkhER//tyxPCBkQTRPaew2gKIH6Yhh6dIY1K5S7SqUukVADwG+Xu+kSUWLgLAQe9q52LSSMrSd8cO2EjRBQ5keryxH91WoTqGbBjuG9HehKtdTHTCRQZZ+qLjqFZLGKnNks0uzqjS7WeeTZNgNITOBoERhguJU3JexPGOddv/7GuotdqqUAAAEhLEDUau3fYQn08Mbchqq+S8S+EIhge6W3En3jcyWoYoIkqDTMOIs010266Y40CtFpiuwcKnbG0rERErXdWIqZA9MmMAY4voxhpS5FZpx3wvGknKvH0Yb9hIeeaPP5WtdKIRlkxbYVJC6/BYyTMaPywtqzA7e+hSSLTNdvLTr3fDiA2DYIsSVQRsc4X/+P6P/X/WsRgHxZruqdOvUYEsUoUoK4a/2Rs4gRZEdXOwtIdK1FFWRDH/+3DE7YGTIOEyzD06AiEZpuWHpwhdqgzWl3kzyyzus2dBLxQNdqLLJCMpWGcpAjJVyoPcyjNJoGpUUROF+uXaMhaOSCLVKqXVS2srIUVBpVFIss1YhgjcdzCHK5RpySUzstgqEjAdCoItm3xMOPzpd1qd5IYY9PPf1/soGQDEC4kylI5g6DZfxYVVVDkj+v5C0HlYiy5JFSwdMkkAYmYKZCnzKwwyNC2XELV0taIQEQyA6cLXHeSQ9j4FjFsEfKI7QDQD4AigwkykBjj4F6+BZmiYxuPzyRKbLcTW7grPtrJgxrUJXPaUb3wRIkDAgtJj0IWRor3JwdPWMgpZIMiEDjSp4WFL63u9fqkGrr/k//Qj//v9SAGpJpXrqiVhWQvU/Tfu4z5fqsaGy/W5oc5YpUGURHQhU0CD//tyxO6BktDXMMy9mgIpmSalh6bQvck8YjGgARpNFqrBUf0aUbFWJRo8QFGFMG0U4YkFwoKUCDDJ2ns1WDbeGcgtQigVR/HsvjmtTJlNrkyREtOEWC5KdPGosNGw+dcussRqIlV1E5p3PGrc8oBkEUiJfsVuqKrFnYwvrk/p39JhAAAAAA5B8WnIp26jeIbL8X4tp52FQwyhRB62oLbLVLQIg7CJlHNL8u+yYvarenbElE3rV6rEvG3RNe677sLBrmiLymQAo9gbAicHRIAOOheGJOPicTyWjLY9GkViSzHEuaedhjxpv2tZqqUL2/ZYYb3mi4aYgzI3OufM0CooKKeZaQW8VIBI3UbUH86VqVGrIRYeoRp36Ekwi4mgYH0nPagyVVJB2GyQUz4OBMVVXcIFDnLZ48Kkm6j/+3DE8IGTDNcuLD02wjoa5hmGJ0B3k/0HJgBJAgg6raSdYNGt11ir2FZE1wCFcz/L3c1aLXkz0ci6aTLsJdLnUtlSwy+C5yPD6P9SPa+jIIgy+VwLDUoqah8ElmWhmBY2e0q9QXiRFGg2SagQnFmUfNEtIWyIZKi7gVOiOSSWUwshCzAwpdu1dL////6P/7scmh1WyAAAADL8UKg50wyM40JkTtqdv4ziUurAt+K0kchpkjvSmNwC66mrxJD5MzYRSAP6u1zk+8yjTlUKVglFl8xUM3LoRAtczJgaLNxea9/LBTH7ur7F9MSHDiQFIhFBG4mRCJQMDkq0KXZHNnn+Wq/s1+1qTYbcAAABRC5aPTDUELUZO0MkHQnNvJmQICRAhzkGZEvcQEEZnEQygAICMIU6S9LyN5Qt//tyxO8Bk4ULM00weMJpmiWVrCW4TTBU6CGpwt0pH0pmkvm+SgDuNKL/obtOVjRPXXTUbZFonwJl8nHpUWloukCivj4yYHtih1diJmOB2+uswmEMV1HH2S8lvvRy8OCxcIg2AX1pHjw4k0SeQz6Fippw/Dn3KnC67Tdm4hIf/9f/VQ6AAAAAAfSxZMHvTFFVkeEP0QVpwIwOCKJc0Qc0lA+pdhAIpiutIQmSSALdpUQh/VTJeSNO9H6BnzcxlSYFOofGA4SBJgK03GRAZ811W5f060sAMkA6dA3sJ5d5ecDofrV50vQzhdBnoTBldZW8EDauI6e9j+vjdKJfp1EI6Vyss1/Lwbjx9+fCb0GnPqOZjxUp3d+LtEyASiWUJj6r2cBfM6MJEYJMvRZSkS/S0YFa0XCYcCAhzmb/+3DE5gCOyM8/rDBywnWaJemcMXhqqOi0YskoEnetpli73RWNCGXqFMCXRhnOZhvGgOAcJMksXEN0B6DUHCXAuC2HRG0F0JCHgbITw8NojpgLCkmxgswuSPHeHJa5CuuUtaRZpeospZ2nuEwcLAlGnw44esUGSNHubs+z1+/V5r/p//boIAAAMgviR7GmPsCgVuF13WGs6fuhVpQXYPDDQHnGRQCj+0xORhoQJFRFBHddilLDxIwkdFxczQoEWHWqjcmqztlTV0VhkLupiIXsVdenjrrCWOFhJNDQrDqqPl5AdZEM9Pw9SRuPahlWEkmeTIkNCDpdkqud+lgAVmDilrzhwXsXbqSKquszs5b/t/Q7/+zoRoD0r0FhTqqq6BwLZWRR9pUGl+lqoDF5v5F1Gk/V1OUtJije//tyxO4Bkt0JL4wweoJEmeWZh6bIiIrRy4IcUtQxKMQ8lZBBZsofF36fhMRWJqMNILtzABHdbit9VzlNLljmPCSCy6OR4OBSD0+PlhiYSElWfhvZlzmlK6HpjSV3ml+WejrjEeRmf9S/OFdFgkOCdwGAjgIlJJhVtKg/eaiv/76vQ3/3chpVNbCIAAAALtguFlbgNzXI01jFmIMMYvHoW2zWIjmSg/AhBLCnu5BHCajKP5Frl6zlqc5vJyAqkSkDvZVYedRwsx2pIgTi9RB+UsRAgMyyJE9LbuxBQpY50+RyXbvdU9lrXK0yjzQUC4fCBGViANgiNAjiMQrp2BqKqDLXHzoEcxi20rndK6V6DCCQQAX5TVhgoBjFRUjRKV5LLq9gV1HXep+4eTHaSDDtgd9eK7EglMxpSXT/+3DE7IGSMMsszDDaQk8fJYmGD1DAtLgdKMElJwYbGUSrXJmK4hQvhlDZJKeaQUKWWXZfIay8dIlKRnHLxxsucHLBgwEZI4tozrslqIT/RSAOLDjC3IK45Qxh28m97U2C6HJC7ulLtFei3P21////WjMAAAM8GWeIgIjJ/o8ww4heVPtlrrP2zGWpf0DQ0dDUoaFAzzIoPyC2AyRHQKjL8WYFwoFV2LHpQq+gKSsibu6LuoOKcIijorK0WYZSIXOqWGC/sAM/fB/qTF1Ij2MUl80wGEMgpouUJIGlhWgWRJLyaPLIm4szrb867RoLhxihG46WRz3yNLp29CH0SqLz/+9yq9u293uXu3rtmKiRUABcQQUHKEOOEV8jjfHadBJGMOAo0+aCNhCZitAPmcxlKcarJOJMLARZ//tyxOuAkOjLNaw9DYIdmSYxh46Yc21SoeCAIYklQah9MyhSzBOzE90LOyj2JChS8O4tALVBCKk5LklZKNhFMXZWsfPGNt3LWxPN1JlOBnHSCQmfXTeB5VqQQAyNMKFwy+ksUE4hQvr18Jtt8w3/7fXVIAAAABZOQ0NmHJ+KJpqYl+mNsTYi1hzX1LJQCvEvgpEkGw5i7JRAYQ1Bigqk4D2RQjxAhdA5ghw/R4rAjCoV5LxSk6MwAiFUPSApl1iIyVPIsZJ2oNUPHJZlX1A+eSmHorDwrR9ddUgaYmiKIdXm5NmvjXi0BC44q8RFjp6lq0mktSNJtkriaBGQPAY8UmhK3yqmd02iRT9HJfFOYUnSolEqULEjXFV+yxsUrW1J0o2XO0w9VRwV/NhbZYBgEJZ204QmMghsJC3/+3DE9oCTmM8pDGUxQh2YZej0m0AWSYtqIXIMEbwQQKyrQDgisCwiSZMJsgnGklI9RBg0VY6HpNLLhdc+oBCYoNqZ8TMtdDFW2ool8jlsq0TYEgKAlh0eGggGQkFmDBcXWeU9DFXzGbU5RDprRqVdEtXli36r/YxaYy93iqoQADgxgjEkHRs9Vy3Bhyr2MKsd9+xCBgShTSnMgN1ZtxnwVuaCDrpnCyRojltBQRIloJUxE9Fyv67SGDc20TL6oUu9bCNbGYU1uHXhayylwDge0E6wxIjRHQTNfXiu/Gs+BxPkOjlUIw+CDbIjCrGgLB6FuUpzi1owfYuOvap6dYoWU//wuq9ISTrY1hbOMb9CqiSJaOekSAv0FCq2tASJUUSvYjEWAsTgGHlDlNLaw8pXiuAv8qVhqbzE//twxPYBk/DHKSw9MwJClmVlh6ZYQFcI8VTp/OpG1uLeVJF005k4j+VxVgvjhZiVsAKISYJAWQ7nzCaiFHupWZUsiHMy0qXiq4PiCFJkEjt3kIIJJvZawmFYjaoJNcTcepl30Idub0bUX/av7b3tvZq9vRjFvSmsWZqOtdKVFwAAAC+GBswXS0xoMKXZH1YoHdyGEefpCcNpK0AKeH2eaXQouopYEcXE0WKQNUbgx3NLFxQ5uOY51WRbYqjmV7IUBC1UolpQvBgWBA4QWYAEUBZ7zDKe9l2kjLU3YqelcuFZ8GySIiBM8KHwoeetrM4O0GDu57w3W1xKmvXx2VAetH/0f6DNASrU6VVTgZejyquXngJXzFCy6IZatH5vaEZIkiAlLQUod0BpJgCEIRBG1w1M1kFkkjjSmP/7csTvgdLY0SisMHpCMpYlIYea0Iv/DyhyewcCIDJRGSrHDUlcBsIA7H0WY8DvBwjhpxTHElkQsjYmg3eJyCvZVQSzZGfmRiZNS3p7jjwNCFAJHw2VKNUH3KFNLhixZjYCUmLlLIIxiVAd+95S3rAtirHsrJm4fmWaxVR1g8XsDzSQ0IAFygYSQQAAAC3GPZkNUfZCVolR2i5OnInLK1nQqFcdaGiUfiwMzC1ikFUayaXCi2RHdHZ0fTo9HAvIsQ6lcnBIWjlgxULgfFRBWMklCYp7MpW/RIs9UbLW82RyAKVCAc8qJcdFMnCmenQ+Paw6o62V6vo0LYxe3///97HD3lDFINv4KWERLmpgCpGGO0iHE5e4CqsAho0OoBcpTdhkAGBogAsMK8Q0hOtBR+mXlvRCJnN+Pt+y//twxPABkLi3LSw8y8KalqRFh7MABs6gDTCgCLTH1XSSFQG+UbnIKWCbtH34h1xo2+tyTROfAofFJ8+qbPQfE43stpuU+RpIH5P6omrxjurqrO6B72a879aHOtpX3ujZWGv3oy07tW/6rt70M/1vob9bpkZJ2ZtnMHV0RVRjoQzXtrV2EZY1ZAAAf8kG5C97ENLFZrGWmSl8I2zkvT7o6zmHpKVpThTNaFi6BykGOR3HbD9JUaKoQijjRgypHA6DzfN8rMpVI/ZWwDBAkCT8Fqob/OUlo0WAwmExskIzyDIxRMY1pBV4u/cozdZKSHL3mX81fvMaK+UzdX9P/p/WQByJhFtvXJnlLgYBJ5X66YYW2zhA4vBKZWgOLcK2sObRoRQZMVKMgaX6rv87adihSl7cWgNq/LclrP/7csTrgI8YtS+nsRSCrT+kBYSLiOkypZcCpGIBkZhoCpVO3/e9ypTKhQsL4+BMOJRPiwSVhaOy6eQ4rcbh+fczSI17PhrPdG7uLPD9aFtOisIm1YhUsHwihgVEAVMmyd7jpJGxdt69uwufyFg9Ghc64KZpyXB4wbAofNBUIJErKghAAAB+RsGKW8oRlBjFyLqWA8CbJdfD/WC5oBpJCSk1zqO00CUGIEfHAfBrKNQExYx6kKL8ZkmpWPLFYXiSTQZiKVIjMQzAMRGKCvIBuAOimCozhGzNrHHBuYOlh4hUTCpONOhmbYbLPuaPFnAqObVsba56EUdybdP7TOP1Z7R2oZFJ1RClxcSeyPyxnCZgnPDqAprQcJCUnU3Fy5SnQteIBgkjC6bUHxEhoTBEImM6CXbIpOpNMFBc//twxOwAjxyTLSw8y8KVmOQVhhtIsyXUkZKDzJKmFGKeCMgORdUwhoXhPhin9NCOs6mhwjL7NBUqjpNICktCR9qVBeI45VNy0kkQpeKlAwpohqVGRj2qfKvZVYGuVoPGgjx1bO+8ipF+00TFAC4TkhUKLeWvJJWB0ng2WEBYQB9tXAADSWDpPMspz1J6eqEJZD181SsBXm8XMt4S0XAPKAPIGcLGHGUQOVyHmaVS4nsuHi0ybUB54XBLTBLGpksSY5EeuaNx9FSFQe1ZJrafaNq6FDJBWWgCLiwGILpItQVVLjoJLwwIkjg/dNiul17XKy96/8tb0+0lvYNUXqCkgcRVHwuNuTNELgKtZF5gqVTdoLvN2WFWHTKcNl87BYypIVTBa8GM7RSFgA7SZUMVYIiaCKzGkkWgtf/7csTugZDoqycnsHZCdZXjxYea0KiK8F5N1WyrYxqVImP45TuytvpC8bYygueJAGORAjT5xhpRVsyQs42pbK58hNBs7Iqo5Wo96/2Lm3t823svuiq2339tPv7Itz9mty3+yr+y6LRybMhWySIDIDRR6hDCjNVZzmKqgKIUY4txRQIQAABmGGhQa7o3OLPbE1t34syZ62IM8THYZ2eeRgLEVfBUj7EARIHItiKRqEyp0xjDEwQ04mV0bxpMrkPlXlzQbSfaEM8y0hCvNHx2Cqgg0njVYE5RimKWio5SPDu7syK9tkSh95b8H9a0Rpa/svfP1odtszIm5mr9v/3+/e/1177EZUUkyFuTUhfS91KxJGQjkPHcQqhMLoYBgbF1VQmot5QQTgS7OZxY3hxHM9MYJo6pW8sSuLcQ//twxO6BkJipIsekegJ9QaNBhItIM6I7sw2E+B6z2iv1cuHSF7e2OguC09IMrlSzOLuR9L4z9q8PPrsSYTp3STB0WCrg+koYEx4Fg7Bxax7GLvexDh6+w1nuZ4s3/pdursotvHkxIoOpey8WELTWF1DwSQCkAAB2WoIuve9bdmRNuwqeWIxmGWDWp5sTb0K0ZQsLAMuhxkwc5kbkw/g9dmbYG9V+ddikaQ89iNNrFlmMQWHjrTpZRzEszuz1adt1Ll+Ynq3SEoT5lxs6UNDLDWWzqE8WymDEk5SAuuMZ3Si9uttab/9moiVevJS7+tudX70bcitalZHsy67qV5yPussiC70VWTRzUd1M62cEwKBUtblBrNWgP+1tQl4narNNVyvN1JM4KtSYivVLZG7SgIwJmy9FrU1LF//7csTugZLaCx8sPFFCABUkJPCPgIfaRLNS7bkSqLO0+Sm79Oa4y468Rgq3KYdfyhm7NemsS6Qclli6Ugo4kzkOHEqLJIjmuqsrKt2L2Stey/+pG7/s6IY3ZOm/TT99/29ao6K19DWUZLsc99W7677UI+dZsPbaskn29eWslcWmMJ1STmmSJ0+0JBQBwB3CHkuLkYgfxxjcliqBkTxxp0g2HNUGc0jyP5JCzIhFGOZLcpELlUrUizlq8W4D9FK05SiJ7EXcRjrZunzeDFhXbWa8sTVcS7vb2xXOtdjiNOCKX/zMn7aVHL/19cv6+//X/+XX6LI2IVjkbPidcstTLfBE8JtYiGx1hZoQICJyEbBDAExQNABVQfiPHQr3BdjFUyyPS2l+fGlHGKu08YB1IUecx0ql+qFtNJaF//twxPWAk3YHHSwMXIp9wSLBgRupz2LkWFpxMxTajVPlQNCEl9WGBXQWHN4keNmWka9N4pm0B7rd/XeM42bKsyEJ5Wj2Qv8lij8R8aczFLIZ9WFbzS8uFo//RYq+d5Kcpl/1Tm9O+hEthuQ0mwzMBDgi0yMaBhaIY6BGECAAM1AD0axcbKMx0y2rqj06TkI2eJ1KI51stxOT6Sb8cYt7YdKNRjgezqEpXzlHmhRoz9V6jxe4s81I6hdqSytcYVXKsDGuFSOYM6tsHL2ZFbbRdva57tVrUZ69bsjMZnfZ2borP9NNbc23b//66PYspVqWoCetmD97O2e4lnoih0WOTlvyWHR9HZzJWrbAZxZIkEokIABkBnEGUjMql+KczfNQ/lajC+mil2JZRqzOonJOn8yOSkXMW+lc2P/7csTqABEaAxinhH8KOMEjGPCP4Y6LXUkeeR+3xFE5xlqFAravpamcQa43q2fnMusZrrOs6yTTmVcfOf6nJfCRSs5VCgy/6bYnRCej+W//mL8Sy+VG8jKUGN8mzXrbq5VM2ukNPKd5kDppMw82z9TyYMCUi5pc0xGHKW5wjR11eGpY6tcWa0CV7NKhs7hBRKNiqtmVVmp+yKp3veu+pbCGtEzdXLx7FpPVgk4eUpxWqlmNZW+h+b06a6J61Wrb6tM07KRN+itqltdNfr+9nka6zGqqIxequWhh0wuVzzWj3GJpwgnUUnqjKNlAcP5aJcsyyKRQqsREy4ofIU6uaIzRUNKxgTmDY+ICBQKEmAELDTZX1WGYk2vJFnBSHuqkhycqwzWtTUfMCwsKm+utfk7/8J/538PPIQsw//twxPEAkroNFMeI3UIowWKk8Jvh4SvCGEn0WisTCEJh/PDFMJC89a/huGxz+W7GHr1NDcSFyzV+KuNXFYVIiIlgiFSMMwKqQOjoJPIhsDKAKoDQpgVJVRSdHQDIyh9g0KYgMIwZJlYkpECwrAlEIQRBE8iZlUxBTUUzLjk5LjNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUECAAACodnazoqLWqX+iqnqi/1RF+5Sy/LLSMjVlBAnQ/n//2Wkf/ZKR+Utl/VgoOOllIzWXsshl/y2X4stIyNWChgQdHlQyrauK2gtzXDef/7csTzAxK+DwwnlTuCM8GghICnaTzRor5hXS6b3kel6brXGab1bP+f7zMxym8dyTTivZGdwVSdUq8xxMvlKulOzuDkyqI0SfFCVBgHWmlUrW6G6ZmJhXTe8fuDNBSqTEFNRTMuOTkuM6qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//twxLqD0y4KxQEN+0gAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqg==",soundByteArray$d=base64SoundToByteArray(phetAudioContext$1,soundURI$d),unlock$d=asyncLoader.createLock(soundURI$d),wrappedAudioBuffer$d=new WrappedAudioBuffer;let unlocked$d=!1;const safeUnlock$d=()=>{unlocked$d||(unlock$d(),unlocked$d=!0)},onDecodeSuccess$d=o=>{wrappedAudioBuffer$d.audioBufferProperty.value===null&&(wrappedAudioBuffer$d.audioBufferProperty.set(o),safeUnlock$d())},onDecodeError$d=o=>{console.warn("decode of audio data failed, using stubbed sound, error: "+o),wrappedAudioBuffer$d.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$d()},decodePromise$d=phetAudioContext$1.decodeAudioData(soundByteArray$d.buffer,onDecodeSuccess$d,onDecodeError$d);decodePromise$d&&decodePromise$d.then(o=>{wrappedAudioBuffer$d.audioBufferProperty.value===null&&(wrappedAudioBuffer$d.audioBufferProperty.set(o),safeUnlock$d())}).catch(o=>{console.warn("promise rejection caught for audio decode, error = "+o),safeUnlock$d()});const monitoredAudioContexts=[],stateChangeListenerArrays=[],audioContextStateChangeMonitor={addStateChangeListener(o,e){let t=monitoredAudioContexts.indexOf(o),n;t===-1?(monitoredAudioContexts.push(o),t=monitoredAudioContexts.length-1,n=[],stateChangeListenerArrays.push(n),assert&&assert(!o.onstatechange,"a listener function is already registered for this context"),o.onstatechange=()=>{_.clone(n).forEach(r=>{r(o.state)})}):n=stateChangeListenerArrays[t],n.push(e)},removeStateChangeListener(o,e){const t=monitoredAudioContexts.indexOf(o);assert&&assert(t>=0,"audio context not found");const n=stateChangeListenerArrays[t],r=n.indexOf(e);assert&&assert(r>=0,"listener not found for specified audio context"),n.splice(r,1)},hasListener(o,e){let t=!1;const n=monitoredAudioContexts.indexOf(o);if(n>=0){const r=stateChangeListenerArrays[n];r&&(t=r.includes(e))}return t}};tambo.register("audioContextStateChangeMonitor",audioContextStateChangeMonitor);const soundConstants={DEFAULT_PARAM_CHANGE_TIME_CONSTANT:.015,DEFAULT_LINEAR_GAIN_CHANGE_TIME:.1,TWELFTH_ROOT_OF_TWO:Math.pow(2,1/12)};tambo.register("soundConstants",soundConstants);const vi=class vi extends EnumerationValue{};vi.BASIC=new vi,vi.EXTRA=new vi,vi.enumeration=new Enumeration(vi,{phetioDocumentation:"describes whether a sound is considered part of the basic or the extra sounds for the sim"});let SoundScope=vi;tambo.register("SoundScope",SoundScope);const AUDIO_DUCKING_LEVEL=.15,DEFAULT_REVERB_LEVEL=.02,LINEAR_GAIN_CHANGE_TIME=soundConstants.DEFAULT_LINEAR_GAIN_CHANGE_TIME;class SoundManager extends PhetioObject{constructor(e){var t,n,r,s;super({tandem:e,phetioState:!1,phetioDocumentation:"Controls the simulation's sound. For sims that do not support sound, this element and its children can be ignored."}),this.viewNodeDisplayedPropertyMap=new Map,this.enabledProperty=new BooleanProperty(((n=(t=phet==null?void 0:phet.chipper)==null?void 0:t.queryParameters)==null?void 0:n.supportsSound)||!1,{tandem:e==null?void 0:e.createTandem("enabledProperty"),phetioState:!1,phetioDocumentation:"Determines whether sound is enabled. Supported only if this sim supportsSound=true."}),this.extraSoundEnabledProperty=new BooleanProperty(((s=(r=phet==null?void 0:phet.chipper)==null?void 0:r.queryParameters)==null?void 0:s.extraSoundInitiallyEnabled)||!1,{tandem:e==null?void 0:e.createTandem("extraSoundEnabledProperty"),phetioState:!1,phetioDocumentation:"Determines whether extra sound is enabled. Extra sound is additional sounds that can serve to improve the learning experience for individuals with visual disabilities. Note that not all simulations that support sound also support extra sound. Also note that the value is irrelevant when enabledProperty is false."}),this.soundGeneratorInfoArray=[],this._mainOutputLevel=1,this._reverbLevel=DEFAULT_REVERB_LEVEL,this.gainNodesForCategories=new Map,this.duckingProperties=createObservableArray(),this.initialized=!1,this.soundGeneratorsAwaitingAdd=[],this.mainGainNode=null,this.duckingGainNode=null,this.convolver=null,this.reverbGainNode=null,this.dryGainNode=null}initialize(e,t,n,r,s,a){assert&&assert(!this.initialized,"can't initialize the sound manager more than once");const h=optionize()({categories:["sim-specific","user-interface"]},a);assert&&assert(h.categories.length===_.uniq(h.categories).length,"categories must be unique");const c=phetAudioContext$1.currentTime,d=phetAudioContext$1.createDynamicsCompressor();d.threshold.setValueAtTime(-6,c),d.knee.setValueAtTime(5,c),d.ratio.setValueAtTime(12,c),d.attack.setValueAtTime(0,c),d.release.setValueAtTime(.25,c),d.connect(phetAudioContext$1.destination),this.duckingGainNode=phetAudioContext$1.createGain(),this.duckingGainNode.connect(d),this.mainGainNode=phetAudioContext$1.createGain(),this.mainGainNode.connect(this.duckingGainNode),this.convolver=phetAudioContext$1.createConvolver();const y=M=>{M&&(this.convolver.buffer=M,wrappedAudioBuffer$d.audioBufferProperty.unlink(y))};wrappedAudioBuffer$d.audioBufferProperty.link(y),this.reverbGainNode=phetAudioContext$1.createGain(),this.reverbGainNode.connect(this.mainGainNode),this.reverbGainNode.gain.setValueAtTime(this._reverbLevel,phetAudioContext$1.currentTime),this.convolver.connect(this.reverbGainNode),this.dryGainNode=phetAudioContext$1.createGain(),this.dryGainNode.gain.setValueAtTime(1-this._reverbLevel,phetAudioContext$1.currentTime),this.dryGainNode.gain.linearRampToValueAtTime(1-this._reverbLevel,phetAudioContext$1.currentTime+LINEAR_GAIN_CHANGE_TIME),this.dryGainNode.connect(this.mainGainNode),assert&&assert(this.convolver!==null&&this.dryGainNode!==null,"some audio nodes have not been initialized"),h.categories.forEach(M=>{const N=phetAudioContext$1.createGain();N.connect(this.convolver),N.connect(this.dryGainNode),this.gainNodesForCategories.set(M,N)}),Multilink.multilink([this.enabledProperty,t,e,n,r,s],(M,N,F,G,ie,Z)=>{const X=M&&N&&F&&G&&ie&&!Z?this._mainOutputLevel:0;this.mainGainNode.gain.linearRampToValueAtTime(X,phetAudioContext$1.currentTime+LINEAR_GAIN_CHANGE_TIME)});const g=new BooleanProperty(!1),D=()=>{g.value=this.duckingProperties.reduce((M,N)=>M||N.value,!1)};g.lazyLink(M=>{var G,ie;assert&&assert(this.duckingGainNode,"ducking listener fired, but no ducking gain node exists");const N=M?.05:.5,F=phetAudioContext$1.currentTime;(G=this.duckingGainNode)==null||G.gain.cancelScheduledValues(F),(ie=this.duckingGainNode)==null||ie.gain.setTargetAtTime(M?AUDIO_DUCKING_LEVEL:1,F,N)}),this.duckingProperties.addItemAddedListener(M=>{M.link(D);const N=F=>{F===M&&(F.unlink(D),this.duckingProperties.removeItemRemovedListener(N))};this.duckingProperties.addItemRemovedListener(N)});const O=()=>{window.removeEventListener("touchstart",V,!1),Display.userGestureEmitter.hasListener(V)&&Display.userGestureEmitter.removeListener(V)},V=()=>{phetAudioContext$1.state!=="running"?(phet.log&&phet.log(`audio context not running, attempting to resume, state = ${phetAudioContext$1.state}`),phetAudioContext$1.resume().then(()=>{phet.log&&phet.log(`resume appears to have succeeded, phetAudioContext.state = ${phetAudioContext$1.state}`),O()}).catch(M=>{const N=`error when trying to resume audio context, err = ${M}`;console.error(N),assert&&alert(N)})):O()};window.addEventListener("touchstart",V,!1),Display.userGestureEmitter.addListener(V);let k=phetAudioContext$1.state;audioContextStateChangeMonitor.addStateChangeListener(phetAudioContext$1,M=>{phet.log&&phet.log(`audio context state changed, old state = ${k}, new state = ${M}, audio context time = ${phetAudioContext$1.currentTime}`),M!=="running"?(window.addEventListener("touchstart",V,!1),Display.userGestureEmitter.hasListener(V)||Display.userGestureEmitter.addListener(V)):console.log("AudioContext is now running."),k=M}),this.initialized=!0,this.soundGeneratorsAwaitingAdd.forEach(M=>{this.addSoundGenerator(M.soundGenerator,M.soundGeneratorAddOptions)}),this.soundGeneratorsAwaitingAdd.length=0}hasSoundGenerator(e){return _.some(this.soundGeneratorInfoArray,t=>t.soundGenerator===e)}addSoundGenerator(e,t){if(t===void 0&&(t={}),!this.initialized){this.soundGeneratorsAwaitingAdd.push({soundGenerator:e,soundGeneratorAddOptions:t});return}assert&&assert(this.convolver!==null&&this.dryGainNode!==null,"some audio nodes have not been initialized");const n=this.hasSoundGenerator(e);assert&&assert(!n,"can't add the same sound generator twice");const r=optionize()({sonificationLevel:SoundScope.BASIC,associatedViewNode:null,categoryName:null},t);assert&&assert(_.includes(_.values(SoundScope),r.sonificationLevel),`invalid value for sonification level: ${r.sonificationLevel}`),r.categoryName===null?(e.connect(this.convolver),e.connect(this.dryGainNode)):(assert&&assert(this.gainNodesForCategories.has(r.categoryName),`category does not exist : ${r.categoryName}`),e.connect(this.gainNodesForCategories.get(r.categoryName)));const s={soundGenerator:e,sonificationLevel:r.sonificationLevel};if(this.soundGeneratorInfoArray.push(s),e.addEnableControlProperty(this.enabledProperty),r.sonificationLevel===SoundScope.EXTRA&&e.addEnableControlProperty(this.extraSoundEnabledProperty),r.associatedViewNode){const a=new DisplayedProperty(r.associatedViewNode);e.addEnableControlProperty(a),this.viewNodeDisplayedPropertyMap.set(e,a)}}removeSoundGenerator(e){if(!this.initialized){const n=this.soundGeneratorsAwaitingAdd.filter(r=>r.soundGenerator===e);for(assert&&assert(n.length>0,"unable to remove sound generator - not found");n.length>0;)arrayRemove(this.soundGeneratorsAwaitingAdd,n[0]),n.shift();return}let t=null;for(let n=0;n<this.soundGeneratorInfoArray.length;n++)if(this.soundGeneratorInfoArray[n].soundGenerator===e){t=this.soundGeneratorInfoArray[n];break}assert&&assert(t,"unable to remove sound generator - not found"),e.isConnectedTo(this.convolver)&&e.disconnect(this.convolver),e.isConnectedTo(this.dryGainNode)&&e.disconnect(this.dryGainNode),this.gainNodesForCategories.forEach(n=>{e.isConnectedTo(n)&&e.disconnect(n)}),t&&this.soundGeneratorInfoArray.splice(this.soundGeneratorInfoArray.indexOf(t),1),this.viewNodeDisplayedPropertyMap.has(e)&&(this.viewNodeDisplayedPropertyMap.get(e).dispose(),this.viewNodeDisplayedPropertyMap.delete(e))}setMainOutputLevel(e){if(!this.initialized){console.warn("an attempt was made to set the main output level on an uninitialized sound manager, ignoring");return}assert&&assert(e>=0&&e<=1,`output level value out of range: ${e}`),this._mainOutputLevel=e,this.enabledProperty.value&&this.mainGainNode.gain.linearRampToValueAtTime(e,phetAudioContext$1.currentTime+LINEAR_GAIN_CHANGE_TIME)}set mainOutputLevel(e){this.setMainOutputLevel(e)}get mainOutputLevel(){return this.getMainOutputLevel()}getMainOutputLevel(){return this._mainOutputLevel}setOutputLevelForCategory(e,t){if(!this.initialized){console.warn("an attempt was made to set the output level for a sound category on an uninitialized sound manager, ignoring");return}assert&&assert(this.initialized,"output levels for categories cannot be added until initialization has been done"),assert&&assert(t>=0&&t<=1,`output level value out of range: ${t}`),assert&&assert(this.gainNodesForCategories.get(e),`no category with name = ${e}`);const n=this.gainNodesForCategories.get(e);n&&n.gain.setValueAtTime(t,phetAudioContext$1.currentTime)}addDuckingProperty(e){this.duckingProperties.add(e)}removeDuckingProperty(e){assert&&assert(this.duckingProperties.includes(e),"ducking Property not present"),this.duckingProperties.remove(e)}getOutputLevelForCategory(e){if(!this.initialized)return console.warn("an attempt was made to get the output level for a sound category on an uninitialized sound manager, returning 0"),0;const t=this.gainNodesForCategories.get(e);return assert&&assert(t,`no category with name = ${e}`),t.gain.value}setReverbLevel(e){if(!this.initialized){console.warn("an attempt was made to set the reverb level on an uninitialized sound manager, ignoring");return}if(e!==this._reverbLevel){assert&&assert(e>=0&&e<=1,`reverb value out of range: ${e}`);const t=phetAudioContext$1.currentTime;this.reverbGainNode.gain.linearRampToValueAtTime(e,t+LINEAR_GAIN_CHANGE_TIME),this.dryGainNode.gain.linearRampToValueAtTime(1-e,t+LINEAR_GAIN_CHANGE_TIME),this._reverbLevel=e}}set reverbLevel(e){this.setReverbLevel(e)}get reverbLevel(){return this.getReverbLevel()}getReverbLevel(){return this._reverbLevel}set enabled(e){this.enabledProperty.value=e}get enabled(){return this.enabledProperty.value}set sonificationLevel(e){this.extraSoundEnabledProperty.value=e===SoundScope.EXTRA}get sonificationLevel(){return this.extraSoundEnabledProperty.value?SoundScope.EXTRA:SoundScope.BASIC}logGain(e,t){}logMainGain(e){this.mainGainNode&&this.logGain(this.mainGainNode,e)}logReverbGain(e){this.reverbGainNode&&this.logGain(this.reverbGainNode,e)}}const soundManager=new SoundManager;tambo.register("soundManager",soundManager);const AUDIO_DATA_THRESHOLD=.05,MAJOR_SCALE_MULTIPLIERS=[1,Math.pow(soundConstants.TWELFTH_ROOT_OF_TWO,2),Math.pow(soundConstants.TWELFTH_ROOT_OF_TWO,4),Math.pow(soundConstants.TWELFTH_ROOT_OF_TWO,5),Math.pow(soundConstants.TWELFTH_ROOT_OF_TWO,7),Math.pow(soundConstants.TWELFTH_ROOT_OF_TWO,9),Math.pow(soundConstants.TWELFTH_ROOT_OF_TWO,11)],SoundUtils={detectSoundBounds:o=>{const e=o.length,t=[],n=[];for(let s=0;s<o.numberOfChannels;s++){const a=o.getChannelData(s);t[s]=findSoundStartIndex(a,e,AUDIO_DATA_THRESHOLD),n[s]=findSoundEndIndex(a,e,AUDIO_DATA_THRESHOLD)}const r=o.sampleRate;return{soundStart:_.min(t)/r,soundEnd:_.max(n)/r}},getMajorScalePlaybackRate:o=>{const e=o%7,t=Math.floor(o/7);return Math.pow(2,t)*MAJOR_SCALE_MULTIPLIERS[e]}},findSoundStartIndex=(o,e,t)=>{let n=0,r,s=!1;for(r=0;r<e-1&&!s;r++)o[r]>t&&o[r+1]>o[r]&&(n=r,s=!0);let a=0;for(s=!1,r=n;r>0&&!s;r--){const d=o[r];d<=0&&(a=d===0?r:r+1,s=!0)}let h=0,c=0;for(r=0;r<a;r++)h=Math.max(h,o[r]),c=Math.min(c,o[r]);return a},findSoundEndIndex=(o,e,t)=>{let n=e-1,r=!1,s;for(s=e-1;s>0&&!r;s--)o[s]<=-t&&o[s-1]<o[s]&&(n=s,r=!0);let a=n;for(r=!1,s=n;s<e-1&&!r;s++)o[s+1]>=0&&(a=s,r=!0);let h=0,c=0;for(s=a;s<e;s++)h=Math.max(h,o[s]),c=Math.min(c,o[s]);return a};tambo.register("SoundUtils",SoundUtils);const DEFAULT_TIME_CONSTANT=soundConstants.DEFAULT_PARAM_CHANGE_TIME_CONSTANT,notSettingPhetioStateProperty=DerivedProperty.not(isSettingPhetioStateProperty);class SoundGenerator extends Disposable{constructor(e){super();const t=optionize()({initialOutputLevel:1,audioContext:phetAudioContext$1,connectImmediately:!1,enableControlProperties:[],additionalAudioNodes:[],enabledDuringPhetioStateSetting:!1},e);this.audioContext=t.audioContext,this._outputLevel=t.initialOutputLevel,this.connectionList=[],this.enableControlProperties=createObservableArray(),this.fullyEnabledProperty=new BooleanProperty(!0);const n=()=>{this.fullyEnabledProperty.value=_.every(this.enableControlProperties,r=>r.value)};this.enableControlProperties.addItemAddedListener(r=>{r.link(n);const s=a=>{a===r&&(a.unlink(n),this.enableControlProperties.removeItemRemovedListener(s))};this.enableControlProperties.addItemRemovedListener(s)}),t.enableControlProperties.forEach(r=>{this.addEnableControlProperty(r)}),this.locallyEnabledProperty=new BooleanProperty(!0),this.addEnableControlProperty(this.locallyEnabledProperty),this.mainGainNode=this.audioContext.createGain(),this.mainGainNode.gain.setValueAtTime(this._outputLevel,this.audioContext.currentTime),t.connectImmediately&&this.mainGainNode.connect(this.audioContext.destination),this.fullyEnabledProperty.link(r=>{const s=r?0:this._outputLevel,a=r?this._outputLevel:0,h=this.audioContext.currentTime;this.mainGainNode.gain.setValueAtTime(s,h),this.mainGainNode.gain.linearRampToValueAtTime(a,this.audioContext.currentTime+soundConstants.DEFAULT_LINEAR_GAIN_CHANGE_TIME)}),this.soundSourceDestination=this.mainGainNode;for(let r=t.additionalAudioNodes.length-1;r>=0;r--){const s=t.additionalAudioNodes[r];s.connect(this.soundSourceDestination),this.soundSourceDestination=s}Tandem.PHET_IO_ENABLED&&!t.enabledDuringPhetioStateSetting&&this.addEnableControlProperty(notSettingPhetioStateProperty),this.disposeEmitter.addListener(()=>{this.enableControlProperties.clear()})}connect(e){this.mainGainNode.connect(e),this.connectionList.push(e)}disconnect(e){this.mainGainNode.disconnect(e),this.connectionList=_.without(this.connectionList,e)}isConnectedTo(e){return this.connectionList.includes(e)}setOutputLevel(e,t=DEFAULT_TIME_CONSTANT){if(e!==this._outputLevel){const n=this.audioContext.currentTime;this.fullyEnabledProperty.value&&(this.mainGainNode.gain.cancelScheduledValues(n),t===0?this.mainGainNode.gain.setValueAtTime(e,n):this.audioContext.state==="running"?this.mainGainNode.gain.setTargetAtTime(e,n,t):this.mainGainNode.gain.linearRampToValueAtTime(e,n+soundConstants.DEFAULT_LINEAR_GAIN_CHANGE_TIME)),this._outputLevel=e}}set outputLevel(e){this.setOutputLevel(e)}get outputLevel(){return this.getOutputLevel()}getOutputLevel(){return this._outputLevel}addEnableControlProperty(e){this.enableControlProperties.push(e)}removeEnableControlProperty(e){this.enableControlProperties.remove(e)}get locallyEnabled(){return this.locallyEnabledProperty.value}set locallyEnabled(e){this.locallyEnabledProperty.value=e}get fullyEnabled(){return this.fullyEnabledProperty.value}}tambo.register("SoundGenerator",SoundGenerator);const MAX_PLAY_DEFER_TIME=.2,DEFAULT_TC=soundConstants.DEFAULT_PARAM_CHANGE_TIME_CONSTANT,DEFAULT_STOP_DELAY=.1;class SoundClip extends SoundGenerator{constructor(e,t){const n=optionize()({loop:!1,trimSilence:!0,initialPlaybackRate:1,initiateWhenDisabled:!1,rateChangesAffectPlayingSounds:!0},t);if(super(n),this.wrappedAudioBuffer=e,this.loop=n.loop,this.rateChangesAffectPlayingSounds=n.rateChangesAffectPlayingSounds,this.initiateWhenDisabled=n.initiateWhenDisabled,this.soundStart=0,this.soundEnd=null,n.trimSilence){const r=s=>{if(s){const a=SoundUtils.detectSoundBounds(s);this.soundStart=a.soundStart,this.soundEnd=a.soundEnd,this.wrappedAudioBuffer.audioBufferProperty.unlink(r)}};this.wrappedAudioBuffer.audioBufferProperty.link(r)}this.activeBufferSources=[],this.localGainNode=this.audioContext.createGain(),this.localGainNode.connect(this.soundSourceDestination),this._playbackRate=n.initialPlaybackRate,this.isPlayingProperty=new BooleanProperty(!1),this.timeOfDeferredPlayRequest=Number.NEGATIVE_INFINITY,this.audioContextStateChangeListener=r=>{r==="running"&&((this.loop||(Date.now()-this.timeOfDeferredPlayRequest)/1e3<MAX_PLAY_DEFER_TIME)&&this.play(.1),audioContextStateChangeMonitor.removeStateChangeListener(this.audioContext,this.audioContextStateChangeListener))},this.fullyEnabledProperty.lazyLink(r=>{!this.loop&&!r&&this.stop()})}play(e=0){if(this.audioContext.state==="running"&&this.wrappedAudioBuffer.audioBufferProperty.value){const t=this.audioContext.currentTime;if(this.loop&&!this.isPlayingProperty.get()||!this.loop&&(this.fullyEnabled||this.initiateWhenDisabled)){const n=this.audioContext.createBufferSource();n.buffer=this.wrappedAudioBuffer.audioBufferProperty.value,n.loop=this.loop,n.loopStart=this.soundStart,this.soundEnd&&(n.loopEnd=this.soundEnd),this.localGainNode.gain.cancelScheduledValues(t),this.localGainNode.gain.setValueAtTime(1,t),n.connect(this.soundSourceDestination),this.activeBufferSources.push(n),this.loop||(n.onended=()=>{const r=this.activeBufferSources.indexOf(n);r>-1&&this.activeBufferSources.splice(r,1),this.isPlayingProperty.value=this.activeBufferSources.length>0}),n.playbackRate.setValueAtTime(this._playbackRate,t),n.start(t+e,this.soundStart),this.isPlayingProperty.value=!0}}else this.audioContext.state==="suspended"&&(this.timeOfDeferredPlayRequest=Date.now(),audioContextStateChangeMonitor.hasListener(this.audioContext,this.audioContextStateChangeListener)||audioContextStateChangeMonitor.addStateChangeListener(this.audioContext,this.audioContextStateChangeListener))}stop(e=DEFAULT_STOP_DELAY){const t=e>0?e/4.61:soundConstants.DEFAULT_PARAM_CHANGE_TIME_CONSTANT,n=this.audioContext.currentTime,r=n+e;this.localGainNode.gain.cancelScheduledValues(n),this.localGainNode.gain.setTargetAtTime(0,n,t),this.activeBufferSources.forEach(s=>{s.stop(r)}),this.activeBufferSources.length=0,this.isPlayingProperty.value=!1,audioContextStateChangeMonitor.hasListener(this.audioContext,this.audioContextStateChangeListener)&&audioContextStateChangeMonitor.removeStateChangeListener(this.audioContext,this.audioContextStateChangeListener)}setPlaybackRate(e,t=DEFAULT_TC){if(assert&&assert(e>0,"invalid playback rate: "+e),this.rateChangesAffectPlayingSounds){const n=this.audioContext.currentTime;this.activeBufferSources.forEach(r=>{r.playbackRate.cancelScheduledValues(n),r.playbackRate.setTargetAtTime(e,n,t)})}this._playbackRate=e}getPlaybackRate(){return this._playbackRate}get playbackRate(){return this.getPlaybackRate()}get isPlaying(){return this.isPlayingProperty.value}getNumberOfPlayingInstances(){return this.activeBufferSources.length}}tambo.register("SoundClip",SoundClip);class SoundClipPlayer{constructor(e,t){const n=optionize()({soundClipOptions:{},soundManagerOptions:{}},t);this._soundClip=new SoundClip(e,n.soundClipOptions),soundManager.addSoundGenerator(this._soundClip,n.soundManagerOptions)}play(){this._soundClip.play()}stop(){this._soundClip.stop()}getSoundClip(){return this._soundClip}}tambo.register("SoundClipPlayer",SoundClipPlayer);const switchToLeftSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$e,{soundClipOptions:{initialOutputLevel:.2},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("switchToLeftSoundPlayer",switchToLeftSoundPlayer);const soundURI$c="data:audio/mpeg;base64,//swxAAABQQDHVQRABFbki33MLACAFiANEhrgagQWfE6eUcJxwPv5wuD/ynh/aXfLvD/9HlwfD//EEEPD7ZhOAkFSjlaqEIiQQAEs4eiJWJc1P1YWHlShsUzcufWA094Hx1uq0G20l0OwMrP+XF59gcKx8JP77pO3m998s/Yw/nLVXnrrpQBsXJUFMLEnmlFmN/yDRSkA2wbEgAA//syxAQACKRzd7zHgAkGB+81hgxyg9V/KSvjePEM6MTwDABAfIScR33O56q5d4xqkH7v3jiaZMD6kY9sjxrY2dnb1HHfvNR/kWIABj/dYQ11+H0jIKJAJJKoO2kaXeWiJIkiSIKkCp6SSSRawEonOLl37VSoUBXLB1R4RArEQNHoKne/wVBU9wWDv4KhL8s9QNP/QiqohANaOyIgAP/7MsQEgAhwYVvmPMihFovqvMwtRAH6Ae14cRCJA0gkI0l3oAaVhTxL2UFGwRUl00mkOm7spnrNztCVjBca9pe1ZAAImV6HsdkkYbqCJBixaWQQZZKZsggAaovjuRz0ay4sAStsBa8qCRLYzJqRvdo6N8kxL5ulvc1t68seeejKSpp09k0Niw9j0xU7cwYDINIb9ZH0VZtohLZJIkj/+zLEA4AIWItlrCBPcRURrbawIAYAJxeV16k/ZdmXyuGXKtUDPLTyWvc8HhHuEmbDWxZs3a26Jzoe0n+dLpP9moqDULbjgomp6BR7tp47Kkb/Yy7HHGiQALQa4vBYdia742/8Tg6Ha/Yveot5iAggAUDAwPPgRG2IQAAAAjEAwP1yvoQIToEAAAQ5YPg+BwcOf+D4PhgAJtta7sOB//swxAOACHRxgbj0gAENjex3sIAAQAgIBAQABwvF95I9BqsaLjRfG8H8voXioPoFOTnP5fr6BAbTCiaJqU//xNPUyOwkrvuV+H0skfwwkh/8uGgaN7U4ykgBI0Wl0NRp9iTTuOtTP3h74fLq2RJI5YD4IhSIZoj1X1UVJEZr6+eMZdiQADi2WsYqaj6u1HKNo9Ta1BZ2GWfu2RpE//syxAOAyERfc6ekbHEFiy24x5gugCwNDM0QkIOIpArkSBqEiqI+lT4jPXA6p0BJyc7A/ueQIEDN8GVxZ0NRU6hwZWZ+u0vmJAcZH1s/fvWToCKjwqgrRCT5TA2SpWReMQaRbtiwvwoHGQwVTzCMlEnyNn9u7MLAVgshUNiq2C20CCygTEZw56WOpYszR3GtXoW6ht/2WRFEABIUbP/7MsQFgAjAk2OsvQGxFRLo9YYU3I5XmAGmX2GjdKVSyEyfEei2W4xByQeX12Jv+JSUCUNe3dQcxD//+rd/xZysTZIrIiZR7qJWtsem773JLgTX0uaaZAEhq87YWCLAk2QPRDsijCdQMyTfTUASGYWdhh0rvEmDrF/obq13lSbEnO6iu0XtJAY0AlnTooDLWLYz1nXalTIJHLdbYmT/+zLEA4AHVLVPoTyjMJ8D5egwvAIAa4iOYBvORuqckKIjmT0f3wGoJDpymlsoq0IgUcZlalKJoqD63behXSb3dH1aMG7tj51oii6lBlJ0AStbgiTFQn40KM3C3KpNO+tnib+WCg+IpL/ez9P/2v9tCgACxBbaTwBY2euQgIjICwBbIKp9DCz6zvsneDLl1hU6BTvZ5Wj+z/wVV9QI//swxBYABVwfGUM8wlB8giG0EIgOCIelakAcALdhRIwrRYRkcReWf6vb///KypL96vYV11222AVLFlA4Q0hOHgNAKIBOJRUqoJdlVUxBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//syxDSDwxQk0ISZIHgAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQ==",soundByteArray$c=base64SoundToByteArray(phetAudioContext$1,soundURI$c),unlock$c=asyncLoader.createLock(soundURI$c),wrappedAudioBuffer$c=new WrappedAudioBuffer;let unlocked$c=!1;const safeUnlock$c=()=>{unlocked$c||(unlock$c(),unlocked$c=!0)},onDecodeSuccess$c=o=>{wrappedAudioBuffer$c.audioBufferProperty.value===null&&(wrappedAudioBuffer$c.audioBufferProperty.set(o),safeUnlock$c())},onDecodeError$c=o=>{console.warn("decode of audio data failed, using stubbed sound, error: "+o),wrappedAudioBuffer$c.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$c()},decodePromise$c=phetAudioContext$1.decodeAudioData(soundByteArray$c.buffer,onDecodeSuccess$c,onDecodeError$c);decodePromise$c&&decodePromise$c.then(o=>{wrappedAudioBuffer$c.audioBufferProperty.value===null&&(wrappedAudioBuffer$c.audioBufferProperty.set(o),safeUnlock$c())}).catch(o=>{console.warn("promise rejection caught for audio decode, error = "+o),safeUnlock$c()});const switchToRightSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$c,{soundClipOptions:{initialOutputLevel:.2},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("switchToRightSoundPlayer",switchToRightSoundPlayer);const DEFAULT_SIZE=new Dimension2(60,30);class ToggleSwitch extends Voicing(Node$2){constructor(e,t,n,r){assert&&assert(e.valueComparisonStrategy==="reference",'ToggleSwitch depends on "===" equality for value comparison'),assert&&assertMutuallyExclusiveOptions(r,["a11yName"],["innerContent","voicingNameResponse"]);const s=optionize()({size:DEFAULT_SIZE,toggleWhileDragging:null,dragThreshold:3,toggleThreshold:1,thumbFill:null,thumbStroke:"black",thumbTouchAreaXDilation:8,thumbTouchAreaYDilation:8,thumbMouseAreaXDilation:0,thumbMouseAreaYDilation:0,trackFillLeft:null,trackFillRight:null,trackStroke:"black",cursor:"pointer",disabledOpacity:SceneryConstants.DISABLED_OPACITY,switchToLeftSoundPlayer,switchToRightSoundPlayer,tandem:Tandem.REQUIRED,tandemNameSuffix:"Switch",phetioEventType:EventType.USER,phetioReadOnly:PhetioObject.DEFAULT_OPTIONS.phetioReadOnly,visiblePropertyOptions:{phetioFeatured:!0},phetioEnabledPropertyInstrumented:!0,phetioFeatured:!0,tagName:"button",ariaRole:"switch",a11yName:null,leftValueContextResponse:null,rightValueContextResponse:null},r);let a=null;(!s.trackFillLeft||!s.trackFillRight)&&(a=new LinearGradient(0,0,0,s.size.height).addColorStop(0,"rgb( 40, 40, 40 )").addColorStop(1,"rgb( 200, 200, 200 )")),s.trackFillLeft=s.trackFillLeft||a,s.trackFillRight=s.trackFillRight||a,s.thumbFill=s.thumbFill||new LinearGradient(0,0,0,s.size.height).addColorStop(0,"white").addColorStop(1,"rgb( 200, 200, 200 )"),s.a11yName&&(s.voicingNameResponse=s.a11yName,s.innerContent=s.a11yName),super(),this.onInputEmitter=new Emitter;const h=s.size.height/2,c=new Rectangle(0,0,s.size.width,s.size.height,h,h,{stroke:s.trackStroke,fill:s.trackFillLeft});this.addChild(c);const d=new Rectangle(0,0,s.size.width,s.size.height,h,h,{stroke:s.trackStroke,fill:s.trackFillRight});this.addChild(d);const y=new Rectangle(0,0,.5*s.size.width,s.size.height,h,h,{fill:s.thumbFill,stroke:s.thumbStroke});this.addChild(y),(s.thumbTouchAreaXDilation||s.thumbTouchAreaYDilation)&&(y.touchArea=Shape$1.roundRect(-s.thumbTouchAreaXDilation,-s.thumbTouchAreaYDilation,.5*s.size.width+2*s.thumbTouchAreaXDilation,s.size.height+2*s.thumbTouchAreaYDilation,h,h)),(s.thumbMouseAreaXDilation||s.thumbMouseAreaYDilation)&&(y.mouseArea=Shape$1.roundRect(-s.thumbMouseAreaXDilation,-s.thumbMouseAreaYDilation,.5*s.size.width+2*s.thumbMouseAreaXDilation,s.size.height+2*s.thumbMouseAreaYDilation,h,h));const g=F=>{const G=c.lineWidth/2;F===t?y.left=-G:y.right=s.size.width+G,d.rectWidth=y.right-G,this.setPDOMAttribute("aria-pressed",F!==t),this.setPDOMAttribute("aria-checked",F!==t)};e.link(g);const D=s.dragThreshold*s.dragThreshold,O=new Vector2(0,0);let V=!1;const k=new PhetioAction$1(F=>{e.value=F,this.onInputEmitter.emit()},{parameters:[{validValues:[t,n],phetioPrivate:!0}],tandem:s.tandem.createTandem("toggleAction"),phetioDocumentation:"Occurs when the switch is toggled via user interaction",phetioReadOnly:s.phetioReadOnly,phetioEventType:EventType.USER});this.onInputEmitter.addListener(()=>{e.value===t?s.switchToLeftSoundPlayer.play():s.switchToRightSoundPlayer.play();const F=e.value===n?s.rightValueContextResponse:s.leftValueContextResponse;F&&(this.alertDescriptionUtterance(F),this.voicingSpeakResponse({contextResponse:Utterance.alertableToText(F)}))});const M=()=>y.centerX<c.centerX?t:n,N=new DragListener({tandem:s.tandem.createTandem("dragListener"),canStartPress:F=>F&&(F.type==="move"||F.type==="enter")?_.includes(F.trail.nodes,y):!0,start:()=>{O.setXY(0,0),V=!1},drag:(F,G)=>{O.add(G.modelDelta),V=V||O.magnitudeSquared>D;const ie=G.getCurrentTarget().globalToLocalPoint(F.pointer.point),Z=y.width/2,W=c.lineWidth/2;y.centerX=DotUtils.clamp(ie.x,Z-W,s.size.width-Z+W),d.rectWidth=y.right-W;const X=ie.x<(1-2*s.toggleThreshold)*Z||ie.x>(-1+2*s.toggleThreshold)*Z+s.size.width,J=M();(s.toggleWhileDragging===!0||X&&s.toggleWhileDragging===null)&&e.value!==J&&k.execute(J)},end:()=>{const F=e.value===t?n:t,G=V?M():F;e.value!==G&&k.execute(G),g(G)},canClick:!0});this.addInputListener(N),this.mutate(s),this.addLinkedElement(e,{tandemName:"property"}),this.switchToLeftSoundPlayer=s.switchToLeftSoundPlayer,this.switchToRightSoundPlayer=s.switchToRightSoundPlayer,this.disposeToggleSwitch=()=>{c.dispose(),d.dispose(),e.unlink(g),k.dispose(),N.dispose(),this.onInputEmitter.dispose()}}dispose(){this.disposeToggleSwitch(),super.dispose()}}sun.register("ToggleSwitch",ToggleSwitch);const DEFAULT_SET_LABEL_ENABLED=(o,e)=>{o.opacity=e?1:SceneryConstants.DISABLED_OPACITY};class ABSwitch extends HBox{constructor(e,t,n,r,s,a){var V,k;assert&&assert(e.valueComparisonStrategy==="reference",'ABSwitch depends on "===" equality for value comparison'),assert&&assert(n.tandem,"labelA must have a tandem"),assert&&assert(s.tandem,"labelB must have a tandem");const h=optionize()({toggleSwitchOptions:{enabledPropertyOptions:{phetioFeatured:!1}},setLabelEnabled:DEFAULT_SET_LABEL_ENABLED,centerOnSwitch:!1,cursor:"pointer",disabledOpacity:SceneryConstants.DISABLED_OPACITY,spacing:8,tandem:Tandem.REQUIRED,tandemNameSuffix:"Switch",visiblePropertyOptions:{phetioFeatured:!0},phetioEnabledPropertyInstrumented:!0},a),c=new ToggleSwitch(e,t,r,combineOptions({tandem:h.tandem.createTandem("toggleSwitch")},h.toggleSwitchOptions));let d=n,y=s;if(h.centerOnSwitch){const M=new AlignGroup;d=new AlignBox(n,{group:M,xAlign:"right"}),y=new AlignBox(s,{group:M,xAlign:"left"})}h.children=[d,c,y],super(h),this.onInputEmitter=new Emitter,this.property=e,this.valueA=t,this.valueB=r,this.labelA=n,this.labelB=s,this.toggleSwitch=c,this.setLabelEnabled=h.setLabelEnabled;const g=()=>this.updateLabelsEnabled();e.link(g);const D=new PressListener({release:()=>{const M=e.value;e.value=t,M!==t&&this.onInputEmitter.emit()},tandem:n.tandem.createTandem("pressListener")});n.addInputListener(D);const O=new PressListener({release:()=>{const M=e.value;e.value=r,M!==r&&this.onInputEmitter.emit()},tandem:s.tandem.createTandem("pressListener")});s.addInputListener(O),c.onInputEmitter.addListener(()=>this.onInputEmitter.emit()),this.onInputEmitter.addListener(()=>{e.value===r&&c.switchToRightSoundPlayer.play(),e.value===t&&c.switchToLeftSoundPlayer.play()}),this.disposeABSwitch=()=>{e.unlink(g),c.dispose(),this.onInputEmitter.dispose(),n.removeInputListener(D),s.removeInputListener(O),D.dispose(),O.dispose()},assert&&((k=(V=phet==null?void 0:phet.chipper)==null?void 0:V.queryParameters)!=null&&k.binder)&&InstanceRegistry.registerDataURL("sun","ABSwitch",this)}dispose(){this.disposeABSwitch(),super.dispose()}onEnabledPropertyChange(e){!e&&this.interruptSubtreeInput(),this.inputEnabled=e,this.toggleSwitch.enabled=e,this.updateLabelsEnabled()}updateLabelsEnabled(){this.setLabelEnabled(this.labelA,this.enabled&&this.property.value===this.valueA),this.setLabelEnabled(this.labelB,this.enabled&&this.property.value===this.valueB)}}sun.register("ABSwitch",ABSwitch);const soundURI$b="data:audio/mpeg;base64,//swxAAABSAbF7TAgDE5nqu/MHICAAAAcDYkDIEtmZ+0OAIDonAEAIOjgnenW/yhz/g+fh+CEocif//+c5RVQlRIdHdXcHffj/DYYCgBdaS6OzOU+xCNTd7EPI6nQ7mODNUkXlljx1AXgvbsgTi8z3+Z7a8aMfHP9uQFmXb1f/cmZM/9//sIhYP//sNqQJAgNJhWTyGAwFAoAATS//syxAeACW0Hgbi1EBESBuvjNGAAfDtZrw0MQaBPJj2MwQyJDLEhJZGoPjAvCMnP3dlJiAtJ8xr/PKk5hYV//3KDxif//6MYVcnt//+VFswo04EQAACAAC9YdezBqNoZHHQDlUSCuyZAkxazLI1qAeiR+JfccaBj1xti9B5JXrESzzBnSIgoXKxEzkQCos+pbPmxfwWXkwAAFm+93//7MsQDgAh4Z1G5gwABEY3y9x5iAuzlQAAAAAB2Wop4QsaAhgpWdRTKJsZcpp1XP57ykSikyYckLZ4Ty1TSs+HageepBZpVjXhgAMSIXXKmU65I0d/7dt7v7sNgMBwALVb09GkvHVk7fqBciIEitH44DchaeFCkbZVn3vi+3iz997uspO3MNCwv4nKHDdB/+gTro/8WA6oYAgMAeW//+zLEAwAIZH9bHaGAAQMgrTTxid9Ko07zWxQmamYZMUXJVhdXnyiL/VNVCqJJVOgImNStCjd9bH2ZjwZ/qQYUyG79QVWCpgKmMChqVd/4VIkkywFXa2uRpIAhLLU5m1VG6LimpHOKzIapjKZdQGJoCUbq7bMoVyt+j5W6t+WZ/r/KqPLMbv1Kxurf//8tBTuFZBUABV3GwiMDZuFj//swxAUCB4SDK0ywaICeAyN0wyROlYmGu6/rSDZ4E2kDhIFxZeHE1XJXBGqqqgLGqsZQ8m6ArsXr1fUvL1lChr+v/7fq//SC5HLZU2AEjwW0VUCig+dQNmTNmsUQ+tQt+EhX+skFfU3+n+u7/hV6TEFNRTMuOTkuNaqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq",soundByteArray$b=base64SoundToByteArray(phetAudioContext$1,soundURI$b),unlock$b=asyncLoader.createLock(soundURI$b),wrappedAudioBuffer$b=new WrappedAudioBuffer;let unlocked$b=!1;const safeUnlock$b=()=>{unlocked$b||(unlock$b(),unlocked$b=!0)},onDecodeSuccess$b=o=>{wrappedAudioBuffer$b.audioBufferProperty.value===null&&(wrappedAudioBuffer$b.audioBufferProperty.set(o),safeUnlock$b())},onDecodeError$b=o=>{console.warn("decode of audio data failed, using stubbed sound, error: "+o),wrappedAudioBuffer$b.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$b()},decodePromise$b=phetAudioContext$1.decodeAudioData(soundByteArray$b.buffer,onDecodeSuccess$b,onDecodeError$b);decodePromise$b&&decodePromise$b.then(o=>{wrappedAudioBuffer$b.audioBufferProperty.value===null&&(wrappedAudioBuffer$b.audioBufferProperty.set(o),safeUnlock$b())}).catch(o=>{console.warn("promise rejection caught for audio decode, error = "+o),safeUnlock$b()});const accordionBoxClosedSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$b,{soundClipOptions:{initialOutputLevel:.5},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("accordionBoxClosedSoundPlayer",accordionBoxClosedSoundPlayer);const soundURI$a="data:audio/mpeg;base64,//swxAAABsArNnTzABEnmTA3HoACAAIOAYznNNVnYDYAWAjClBSA3BwKB48VkSUAABBynBhYP5QMCc+T4JnwQcoH/6gff/Of/l4gAIJkjluslkskluuAAAkTmCV7K1w6pqz7VkryDnmQVVFCJY0HRFDgrNPT7QRsUHNV+KVNJRPtYt0/426/nj/Tv/sPVjjhtrzPbywAATqIdRsL//syxAOACHStW/2RACEMj6e2smAEqYAYhGmdJfGbQRJM6d5rUVhcXmZTOP9blIoBChWlL5hQoqBgpUdHqJ/1McBGpaGctDO3++hgIUqDV8QgqAAntdpnEwAD6ruLLBhIIEPkpGtP5xWnwVF2czcptv1Fgk0VRRGN9VJRU46pQrSVRX///853QKKZ0dz3cGnwCKBwcHYEIC0hEM5EMv/7MsQEAAiQXW+5hIAREZRslzKwACEMBgAAD9/MyuFW/l8vMAkS99TuX45zufo9JjH/gbUAtafz/MqCaqJP4IIAARGcawPpR8H3iefS7zg45qAIBFAAV1AtJXsx44xwqAZ24lKIsEc5bDMUuS6XnBEXQqAakxM3KX8vlruv28Pc++21X/p71t0ufET/PUOSB+v8FT3Fl3GALLrbdbr/+zLEA4AIWHtvuPWAEROSLXcegALRIIBAAAAIpME09Jpkm6HEpcYWjTFeQLCjn4NAjRM5fbfr4UULuXdO+HtlGqi0a/9EFQ66zxGCz/4GGlyg0HFHJZM7ZIAwEAAAErGUoi0JXI6UF+hiurPpjdxalUIbk1pRYWEUpY39w/BVt/p1i48ySduL+KRKEg8sPo/yoV/yLlIIpJIQSCOJ//swxAODxLAbO7xggDAAADSAAAAEweQCRznEiWHEqW49z3nuJf8Fbqzvw1+e6j3TPf/BakxBTUUzLjk5LjWqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq",soundByteArray$a=base64SoundToByteArray(phetAudioContext$1,soundURI$a),unlock$a=asyncLoader.createLock(soundURI$a),wrappedAudioBuffer$a=new WrappedAudioBuffer;let unlocked$a=!1;const safeUnlock$a=()=>{unlocked$a||(unlock$a(),unlocked$a=!0)},onDecodeSuccess$a=o=>{wrappedAudioBuffer$a.audioBufferProperty.value===null&&(wrappedAudioBuffer$a.audioBufferProperty.set(o),safeUnlock$a())},onDecodeError$a=o=>{console.warn("decode of audio data failed, using stubbed sound, error: "+o),wrappedAudioBuffer$a.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$a()},decodePromise$a=phetAudioContext$1.decodeAudioData(soundByteArray$a.buffer,onDecodeSuccess$a,onDecodeError$a);decodePromise$a&&decodePromise$a.then(o=>{wrappedAudioBuffer$a.audioBufferProperty.value===null&&(wrappedAudioBuffer$a.audioBufferProperty.set(o),safeUnlock$a())}).catch(o=>{console.warn("promise rejection caught for audio decode, error = "+o),safeUnlock$a()});const accordionBoxOpenedSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$a,{soundClipOptions:{initialOutputLevel:.5},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("accordionBoxOpenedSoundPlayer",accordionBoxOpenedSoundPlayer);function getGroupItemNodes(o,e){return o.map(t=>(assert&&assert(!t.node,"Use createNode instead of node"),t.createNode(e&&t.tandemName?e.createTandem(t.tandemName):Tandem.OPTIONAL)))}class ToggleNode extends Node$2{constructor(e,t,n){var h;const r=optionize()({alignChildren:ToggleNode.CENTER,unselectedChildrenSceneGraphStrategy:"included"},n),s=getGroupItemNodes(t,(h=r.tandem)==null?void 0:h.createTandem("elements"));r.children=s,r.alignChildren(r.children),super(r);const a=c=>{const d=[];for(let y=0;y<t.length;y++){const D=t[y].value===c;s[y].visible=D,D&&d.push(s[y])}assert&&assert(d.length===1,`Wrong number of matches: ${d.length}`),r.unselectedChildrenSceneGraphStrategy==="excluded"&&(this.children=d)};e.link(a),this.nodes=s,this.disposeToggleNode=function(){e.unlink(a),s.forEach(c=>c.dispose())}}dispose(){this.disposeToggleNode(),super.dispose()}static CENTER(e){for(let t=1;t<e.length;t++)e[t].center=e[0].center}static CENTER_X(e){for(let t=1;t<e.length;t++)e[t].centerX=e[0].centerX}static CENTER_Y(e){for(let t=1;t<e.length;t++)e[t].centerY=e[0].centerY}static LEFT(e){for(let t=1;t<e.length;t++)e[t].left=e[0].left}static BOTTOM(e){for(let t=1;t<e.length;t++)e[t].bottom=e[0].bottom}static CENTER_BOTTOM(e){for(let t=1;t<e.length;t++)e[t].centerBottom=e[0].centerBottom}static RIGHT(e){for(let t=1;t<e.length;t++)e[t].right=e[0].right}static NONE(e){}}sun.register("ToggleNode",ToggleNode);class BooleanToggleNode extends ToggleNode{constructor(e,t,n,r){super(e,[{value:!0,createNode:()=>t},{value:!1,createNode:()=>n}],r)}}sun.register("BooleanToggleNode",BooleanToggleNode);const soundURI$9="data:audio/mpeg;base64,//swxAAABdzxBVQRADFFHaWrNxAA6lqlJJEQAExvBGPAACkboRpPkaQjfnfz5z/zvk6HfzvO//6nzn/8n8Wo50RIcE5h04AwQBAIwAHAAGGKl44UnQFxrI7b6JARZgWfzRC7X2cjUCZG/TgeAfXziIB7AOgm3/Dlw5chhj/4aoJEnxOhr/+bkURTNP+37dN///zd5/WqMcFKOhHs//syxAMACFBlQBnXgAEQCuRbvLAAMh2cNcpzMDxDOxVSMlAjYsYOAlbMUQJ8hAkSABkLAPbGhQfrk7xotjWuYO3uc9FKLMWDXX39eK91WL8a4ARAYAYFAQZg2BpmMcTuZ9zx5rwEJFAZZgjA1mC8BuLASofGAOAMhs/U/GV40k0Dkso2K6Npbban/lI2Pnd6J3///t66ABTcYocjaf/7MsQDgAX8JTutseaw6RRnNZCJDkFdpsKMGTznDUOCFN3UBmSx0M4MasPlPO6Ar07embS//T/2f27SK//YUG03dpZI2oMaBN8MJA5tI6MkldtNZgLZ+dUe9LvQy6Odv9a9cr9VPRUaBtgq9EWmz6Xj3KZTzOv1ylUAC+0kk0oAEUn+I0HZ6jICCWahweFTlrz07qq2Ls9T3N/Xljr/+zLEEgAFSBMjQWBgUI8CIvA3vAbc1Vf//uoAABTglUoQoEElDJAFw2zpqMe6sqMzu59/9uvz32/t/onv/5FMQU1FMy45OS41VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//swxC8DwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",soundByteArray$9=base64SoundToByteArray(phetAudioContext$1,soundURI$9),unlock$9=asyncLoader.createLock(soundURI$9),wrappedAudioBuffer$9=new WrappedAudioBuffer;let unlocked$9=!1;const safeUnlock$9=()=>{unlocked$9||(unlock$9(),unlocked$9=!0)},onDecodeSuccess$9=o=>{wrappedAudioBuffer$9.audioBufferProperty.value===null&&(wrappedAudioBuffer$9.audioBufferProperty.set(o),safeUnlock$9())},onDecodeError$9=o=>{console.warn("decode of audio data failed, using stubbed sound, error: "+o),wrappedAudioBuffer$9.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$9()},decodePromise$9=phetAudioContext$1.decodeAudioData(soundByteArray$9.buffer,onDecodeSuccess$9,onDecodeError$9);decodePromise$9&&decodePromise$9.then(o=>{wrappedAudioBuffer$9.audioBufferProperty.value===null&&(wrappedAudioBuffer$9.audioBufferProperty.set(o),safeUnlock$9())}).catch(o=>{console.warn("promise rejection caught for audio decode, error = "+o),safeUnlock$9()});const toggleOffSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$9,{soundClipOptions:{initialOutputLevel:.7},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("toggleOffSoundPlayer",toggleOffSoundPlayer);const soundURI$8="data:audio/mpeg;base64,//swxAAAByAnDnWRADEZkyy3M0ALJQcEAMk013znpOVkWGNCg9vD4oJlTQcNxQBIJ0PxSUlJSCwfB8Hz+CAIAN/DH/gg78EHS7//9QIJSLq/wFHg+AwFAAAAAAfFvo6+SmoCLgXFVlJaBRlrks8EfgdfwNGNDIX1icAtgSPunkTDV42yCf+OWMmXBP4hJ/+RAZg8nmowgLA3CbIw//syxAOACDxjRhnXgAEOCqVnuqAERLIypm8wTCMyMagDMoYEAyRAAgCAQ9za/ELra7bNcNI9BMVmPx3pF7P7a/wstMTOL6//gwrwjSeVKioAAkqgEBggJpjMDZgiPBm+0xy7jJ482ppET4kOhhSHhg8CKMhgGASP09uliMpAaC+Gyqiiyjd9/QiJjzxL//////p9lUBqv86UKJp6wP/7MsQEgAWgKTMsbMLwvwUmdaCI3g146KXMwJVAHDYhAjvxQKf+SIBJPJWbIrZ/1aVs/k7Lf2//7QQilFbJGkVBjWeEsADYyEamuw0dNdmGxS1qmJCrAKrGJZ+TX/V+1zX0fitWyROXKQQiijI22kTAod9keTOhUgChZfu1VSXOv2ubHdG+h4jXu2fLMV00rQvomqNH8kAAAARGFj3/+zLEGgDFrBkvoeWAcKKCYxBngBYhtAWgNUjlVDuFH+de4qlT5ENEZ7/8t7K3cKjB1Q/kmOcRTEFNRTMuOTkuNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//swxDMDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",soundByteArray$8=base64SoundToByteArray(phetAudioContext$1,soundURI$8),unlock$8=asyncLoader.createLock(soundURI$8),wrappedAudioBuffer$8=new WrappedAudioBuffer;let unlocked$8=!1;const safeUnlock$8=()=>{unlocked$8||(unlock$8(),unlocked$8=!0)},onDecodeSuccess$8=o=>{wrappedAudioBuffer$8.audioBufferProperty.value===null&&(wrappedAudioBuffer$8.audioBufferProperty.set(o),safeUnlock$8())},onDecodeError$8=o=>{console.warn("decode of audio data failed, using stubbed sound, error: "+o),wrappedAudioBuffer$8.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$8()},decodePromise$8=phetAudioContext$1.decodeAudioData(soundByteArray$8.buffer,onDecodeSuccess$8,onDecodeError$8);decodePromise$8&&decodePromise$8.then(o=>{wrappedAudioBuffer$8.audioBufferProperty.value===null&&(wrappedAudioBuffer$8.audioBufferProperty.set(o),safeUnlock$8())}).catch(o=>{console.warn("promise rejection caught for audio decode, error = "+o),safeUnlock$8()});const toggleOnSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$8,{soundClipOptions:{initialOutputLevel:.7},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("toggleOnSoundPlayer",toggleOnSoundPlayer);const ri=class ri extends EnumerationValue{};ri.IDLE=new ri,ri.OVER=new ri,ri.PRESSED=new ri,ri.enumeration=new Enumeration(ri);let ButtonInteractionState=ri;sun.register("ButtonInteractionState",ButtonInteractionState);const ColorConstants={LIGHT_BLUE:new Color(153,206,255),LIGHT_GRAY:new Color(220,220,220)},CONTRAST_FILTER=new Contrast(.7),BRIGHTNESS_FILTER=new Brightness(1.2);class ButtonNode extends Sizable(Voicing(Node$2)){constructor(e,t,n,r){var y;const s=optionize()({content:null,minUnstrokedWidth:null,minUnstrokedHeight:null,xMargin:10,yMargin:5,xAlign:"center",yAlign:"center",xContentOffset:0,yContentOffset:0,baseColor:ColorConstants.LIGHT_BLUE,cursor:"pointer",buttonAppearanceStrategy:ButtonNode.FlatAppearanceStrategy,buttonAppearanceStrategyOptions:{},contentAppearanceStrategy:null,contentAppearanceStrategyOptions:{},enabledAppearanceStrategy:(g,D,O,V)=>{O.filters=g?[]:[CONTRAST_FILTER,BRIGHTNESS_FILTER],V&&(V.filters=g?[]:[Grayscale.FULL],V.opacity=g?1:SceneryConstants.DISABLED_OPACITY)},disabledColor:ColorConstants.LIGHT_GRAY,aspectRatio:null,tagName:"button",tandemNameSuffix:"Button",visiblePropertyOptions:{phetioFeatured:!0},phetioEnabledPropertyInstrumented:!0},r);s.listenerOptions=combineOptions({tandem:(y=s.tandem)==null?void 0:y.createTandem("pressListener")},s.listenerOptions),assert&&s.enabledProperty&&assert(s.enabledProperty===e.enabledProperty,"if options.enabledProperty is provided, it must === buttonModel.enabledProperty"),s.enabledProperty=e.enabledProperty,assert&&assert(s.aspectRatio===null||isFinite(s.aspectRatio)&&s.aspectRatio>0,`ButtonNode aspectRatio should be a positive finite value if non-null. Instead received ${s.aspectRatio}.`),super(),this.buttonNodeConstraint=null,this.content=s.content,this.buttonModel=e,this._settableBaseColorProperty=new PaintColorProperty(s.baseColor),this._disabledColorProperty=new PaintColorProperty(s.disabledColor),this.baseColorProperty=new DerivedProperty([this._settableBaseColorProperty,this.enabledProperty,this._disabledColorProperty],(g,D,O)=>D?g:O),this._pressListener=e.createPressListener(s.listenerOptions),this.addInputListener(this._pressListener),assert&&assert(t.fill===null,"ButtonNode controls the fill for the buttonBackground"),t.fill=this.baseColorProperty,this.addChild(t);const a=new s.buttonAppearanceStrategy(t,n,this.baseColorProperty,s.buttonAppearanceStrategyOptions);let h;s.contentAppearanceStrategy&&s.content&&(h=new s.contentAppearanceStrategy(s.content,n,s.contentAppearanceStrategyOptions)),this.maxLineWidth=a.maxLineWidth;let c=null,d=null;if(s.content){const g=s.content;g.pickable=!1,this.buttonNodeConstraint=new ButtonNodeConstraint(this,{content:s.content,xMargin:s.xMargin,yMargin:s.yMargin,maxLineWidth:this.maxLineWidth,minUnstrokedWidth:s.minUnstrokedWidth,minUnstrokedHeight:s.minUnstrokedHeight,aspectRatio:s.aspectRatio}),this.layoutSizeProperty=this.buttonNodeConstraint.layoutSizeProperty,c=new AlignBox(g,{xAlign:s.xAlign,yAlign:s.yAlign,leftMargin:s.xMargin+s.xContentOffset,rightMargin:s.xMargin-s.xContentOffset,topMargin:s.yMargin+s.yContentOffset,bottomMargin:s.yMargin-s.yContentOffset}),d=Multilink.multilink([t.boundsProperty,this.layoutSizeProperty],(D,O)=>{c.alignBounds=Bounds2.point(D.center).dilatedXY(O.width/2,O.height/2)}),this.addChild(c)}else assert&&assert(s.minUnstrokedWidth!==null),assert&&assert(s.minUnstrokedHeight!==null),this.layoutSizeProperty=new TinyProperty(new Dimension2(s.minUnstrokedWidth+this.maxLineWidth,s.minUnstrokedHeight+this.maxLineWidth));this.mutate(s),this.enabledProperty.link(g=>s.enabledAppearanceStrategy(g,this,t,c)),this.disposeButtonNode=()=>{c&&c.dispose(),d&&d.dispose(),a.dispose&&a.dispose(),h&&h.dispose&&h.dispose(),this._pressListener.dispose(),this.baseColorProperty.dispose()}}dispose(){this.buttonNodeConstraint&&this.buttonNodeConstraint.dispose(),this.disposeButtonNode(),super.dispose()}setBaseColor(e){this._settableBaseColorProperty.paint=e}set baseColor(e){this.setBaseColor(e)}get baseColor(){return this.getBaseColor()}getBaseColor(){return this._settableBaseColorProperty.paint}pdomClick(){this._pressListener.click(null)}isPDOMClicking(){return this._pressListener.pdomClickingProperty.get()}}class FlatAppearanceStrategy{constructor(e,t,n,r){const s=new PaintColorProperty(n,{luminanceFactor:.4}),a=new PaintColorProperty(n,{luminanceFactor:-.4}),h=n,c=s,d=a,y=combineOptions({stroke:a},r),g=typeof y.lineWidth=="number"?y.lineWidth:1;e.stroke=y.stroke||a,e.lineWidth=g,this.maxLineWidth=e.hasStroke()?g:0,e.cachedPaints=[h,c,d];function D(O){switch(O){case ButtonInteractionState.IDLE:e.fill=h;break;case ButtonInteractionState.OVER:e.fill=c;break;case ButtonInteractionState.PRESSED:e.fill=d;break;default:throw new Error(`unsupported interactionState: ${O}`)}}t.link(D),this.disposeFlatAppearanceStrategy=()=>{t.hasListener(D)&&t.unlink(D),s.dispose(),a.dispose()}}dispose(){this.disposeFlatAppearanceStrategy()}}class ButtonNodeConstraint extends LayoutConstraint{constructor(e,t){super(e),this.layoutSizeProperty=new TinyProperty(new Dimension2(0,0)),this.isFirstLayout=!0,this.lastLocalPreferredWidth=0,this.lastLocalPreferredHeight=0,this.buttonNode=e,this.content=t.content,this.xMargin=t.xMargin,this.yMargin=t.yMargin,this.maxLineWidth=t.maxLineWidth,this.minUnstrokedWidth=t.minUnstrokedWidth,this.minUnstrokedHeight=t.minUnstrokedHeight,this.aspectRatio=t.aspectRatio,this.buttonNode.localPreferredWidthProperty.lazyLink(this._updateLayoutListener),this.buttonNode.localPreferredHeightProperty.lazyLink(this._updateLayoutListener),this.addNode(this.content,!1),this.layout()}layout(){super.layout();const e=this.buttonNode,t=this.content;let n=Math.max(this.isFirstLayout||e.widthSizable?(isWidthSizable(t)?t.minimumWidth||0:t.width)+this.xMargin*2:e.localMinimumWidth,this.minUnstrokedWidth===null?0:this.minUnstrokedWidth+this.maxLineWidth),r=Math.max(this.isFirstLayout||e.heightSizable?(isHeightSizable(t)?t.minimumHeight||0:t.height)+this.yMargin*2:e.localMinimumHeight,this.minUnstrokedHeight===null?0:this.minUnstrokedHeight+this.maxLineWidth);this.aspectRatio!==null&&(n<r*this.aspectRatio&&(n=r*this.aspectRatio),r<n/this.aspectRatio&&(r=n/this.aspectRatio)),this.lastLocalPreferredWidth=this.isFirstLayout||isWidthSizable(e)?Math.max(n,e.localPreferredWidth||0):this.lastLocalPreferredWidth,this.lastLocalPreferredHeight=this.isFirstLayout||isHeightSizable(e)?Math.max(r,e.localPreferredHeight||0):this.lastLocalPreferredHeight,this.isFirstLayout=!1,this.layoutSizeProperty.value=new Dimension2(this.lastLocalPreferredWidth,this.lastLocalPreferredHeight),e.localMinimumWidth=n,e.localMinimumHeight=r}dispose(){this.buttonNode.localPreferredWidthProperty.unlink(this._updateLayoutListener),this.buttonNode.localPreferredHeightProperty.unlink(this._updateLayoutListener),super.dispose()}}ButtonNode.FlatAppearanceStrategy=FlatAppearanceStrategy;sun.register("ButtonNode",ButtonNode);const VERTICAL_HIGHLIGHT_GRADIENT_LENGTH=7,HORIZONTAL_HIGHLIGHT_GRADIENT_LENGTH=7,SHADE_GRADIENT_LENGTH=3;class RectangularButton extends ButtonNode{constructor(e,t,n){const r=optionize()({size:null,minWidth:HORIZONTAL_HIGHLIGHT_GRADIENT_LENGTH+SHADE_GRADIENT_LENGTH,minHeight:VERTICAL_HIGHLIGHT_GRADIENT_LENGTH+SHADE_GRADIENT_LENGTH,xMargin:8,yMargin:5,touchAreaXDilation:0,touchAreaYDilation:0,mouseAreaXDilation:0,mouseAreaYDilation:0,touchAreaXShift:0,touchAreaYShift:0,mouseAreaXShift:0,mouseAreaYShift:0,stroke:null,lineWidth:.5,cornerRadius:4,leftTopCornerRadius:null,rightTopCornerRadius:null,leftBottomCornerRadius:null,rightBottomCornerRadius:null,buttonAppearanceStrategy:RectangularButton.ThreeDAppearanceStrategy},n);r.content||assert&&assert(r.size!==void 0,"button dimensions needed if no content is supplied."),r.size?(assert&&assert(r.xMargin<r.size.width,"xMargin cannot be larger than width"),assert&&assert(r.yMargin<r.size.height,"yMargin cannot be larger than height"),r.minUnstrokedWidth=r.size.width,r.minUnstrokedHeight=r.size.height):(r.minWidth!==void 0&&(r.minUnstrokedWidth=r.minWidth),r.minHeight!==void 0&&(r.minUnstrokedHeight=r.minHeight)),r.buttonAppearanceStrategyOptions||(r.buttonAppearanceStrategyOptions={stroke:r.stroke,lineWidth:r.lineWidth});let s,a;r.size?(s=r.size.width,a=r.size.height):(s=Math.max(r.content?r.content.width+r.xMargin*2:0,r.minWidth),a=Math.max(r.content?r.content.height+r.yMargin*2:0,r.minHeight));const h=new Path(createButtonShape(s,a,r));if(r.size&&r.content){const d=r.content,y=Math.min((r.size.width-r.xMargin*2)/d.width,(r.size.height-r.yMargin*2)/d.height);r.content=new Node$2({children:[d],scale:y})}super(e,h,t,r);let c=!0;Multilink.multilink([this.isWidthResizableProperty,this.isHeightResizableProperty,this.layoutSizeProperty],(d,y,g)=>{(d||y)&&(h.shape=createButtonShape(d?g.width-this.maxLineWidth:s,y?g.height-this.maxLineWidth:a,r),assert&&assert(!d||h.width<=g.width+1e-7,"button width cannot exceed layout width"),assert&&assert(!y||h.height<=g.height+1e-7,"button width cannot exceed layout height")),(c||d||y)&&(this.touchArea=h.localBounds.dilatedXY(r.touchAreaXDilation,r.touchAreaYDilation).shiftedXY(r.touchAreaXShift,r.touchAreaYShift),this.mouseArea=h.localBounds.dilatedXY(r.mouseAreaXDilation,r.mouseAreaYDilation).shiftedXY(r.mouseAreaXShift,r.mouseAreaYShift)),c=!1})}}function createButtonShape(o,e,t){const n=Math.min(o/2,e/2);return Shape$1.roundedRectangleWithRadii(0,0,o,e,{topLeft:Math.min(n,t.leftTopCornerRadius!==null?t.leftTopCornerRadius:t.cornerRadius),topRight:Math.min(n,t.rightTopCornerRadius!==null?t.rightTopCornerRadius:t.cornerRadius),bottomLeft:Math.min(n,t.leftBottomCornerRadius!==null?t.leftBottomCornerRadius:t.cornerRadius),bottomRight:Math.min(n,t.rightBottomCornerRadius!==null?t.rightBottomCornerRadius:t.cornerRadius)})}let ThreeDAppearanceStrategy$1=class{constructor(e,t,n,r){const s=r&&r.stroke?r.stroke:new PaintColorProperty(n,{luminanceFactor:-.4}),a=r&&r.lineWidth!==void 0?r.lineWidth:.5,h=optionize()({stroke:s,lineWidth:a,overStroke:s,overLineWidth:a,overFill:n,overButtonOpacity:1,selectedStroke:s,selectedLineWidth:a,selectedButtonOpacity:1,deselectedStroke:s,deselectedLineWidth:a,deselectedButtonOpacity:1},r),c=new PaintColorProperty(n,{luminanceFactor:.7}),d=new PaintColorProperty(n,{luminanceFactor:.5}),y=new PaintColorProperty(n,{luminanceFactor:.2}),g=new PaintColorProperty(n,{luminanceFactor:-.3}),D=new PaintColorProperty(n,{luminanceFactor:-.4}),O=new PaintColorProperty(n,{luminanceFactor:-.5}),V=new DerivedProperty([n],G=>G.withAlpha(0)),k=new Color(255,255,255,.7),M=new Path(null,{stroke:h.stroke,lineWidth:h.lineWidth,pickable:!1});e.addChild(M),this.maxLineWidth=typeof h.lineWidth=="number"?h.lineWidth:0;let N;const F=()=>{const G=e.shape.bounds.width,ie=e.shape.bounds.height;M.shape=e.shape,assert&&assert(G>=HORIZONTAL_HIGHLIGHT_GRADIENT_LENGTH+SHADE_GRADIENT_LENGTH),assert&&assert(ie>=VERTICAL_HIGHLIGHT_GRADIENT_LENGTH+SHADE_GRADIENT_LENGTH);const Z=Math.min(VERTICAL_HIGHLIGHT_GRADIENT_LENGTH/ie,1),W=Math.max(1-SHADE_GRADIENT_LENGTH/ie,0),X=Math.min(HORIZONTAL_HIGHLIGHT_GRADIENT_LENGTH/G,1),J=Math.max(1-SHADE_GRADIENT_LENGTH/G,0),oe=new LinearGradient(0,0,0,ie).addColorStop(0,c).addColorStop(Z,n).addColorStop(W,n).addColorStop(1,O),le=new LinearGradient(0,0,G,0).addColorStop(0,k).addColorStop(X,V).addColorStop(J,V).addColorStop(1,O),pe=new LinearGradient(0,0,0,ie).addColorStop(0,c).addColorStop(Z,d).addColorStop(W,d).addColorStop(1,O),ve=new LinearGradient(0,0,G,0).addColorStop(0,k).addColorStop(X/2,new Color(255,255,255,0)).addColorStop(J,V).addColorStop(1,g),Oe=new LinearGradient(0,0,0,ie).addColorStop(0,c).addColorStop(Z*.67,g).addColorStop(W,y).addColorStop(1,O);e.cachedPaints=[oe,pe,Oe],M.cachedPaints=[le,ve],N&&t.unlink(N),N=He=>{switch(He){case ButtonInteractionState.IDLE:e.fill=oe,e.stroke=h.deselectedStroke,e.lineWidth=h.deselectedLineWidth,e.opacity=h.deselectedButtonOpacity,M.fill=le,M.opacity=h.deselectedButtonOpacity;break;case ButtonInteractionState.OVER:e.fill=pe,e.stroke=h.overStroke,e.lineWidth=h.overLineWidth,e.opacity=h.overButtonOpacity,M.fill=ve,M.opacity=h.overButtonOpacity;break;case ButtonInteractionState.PRESSED:e.fill=Oe,e.stroke=h.selectedStroke,e.lineWidth=h.selectedLineWidth,e.opacity=h.selectedButtonOpacity,M.fill=ve,M.opacity=h.selectedButtonOpacity;break;default:throw new Error(`unsupported interactionState: ${He}`)}},t.link(N)};e.selfBoundsProperty.link(F),this.disposeThreeDAppearanceStrategy=()=>{e.selfBoundsProperty.unlink(F),t.hasListener(N)&&t.unlink(N),c.dispose(),d.dispose(),y.dispose(),g.dispose(),D.dispose(),O.dispose(),V.dispose()}}dispose(){this.disposeThreeDAppearanceStrategy()}};RectangularButton.ThreeDAppearanceStrategy=ThreeDAppearanceStrategy$1;sun.register("RectangularButton",RectangularButton);class ToggleButtonInteractionStateProperty extends DerivedProperty2{constructor(e){super([e.looksOverProperty,e.looksPressedProperty],(t,n)=>t&&!n?ButtonInteractionState.OVER:n?ButtonInteractionState.PRESSED:ButtonInteractionState.IDLE,{valueType:ButtonInteractionState})}}sun.register("ToggleButtonInteractionStateProperty",ToggleButtonInteractionStateProperty);class ButtonModel extends EnabledComponent{constructor(e){const t=optionize()({startCallback:_.noop,endCallback:_.noop,tandem:Tandem.REQUIRED,phetioState:PhetioObject.DEFAULT_OPTIONS.phetioState,phetioReadOnly:PhetioObject.DEFAULT_OPTIONS.phetioReadOnly,phetioFeatured:PhetioObject.DEFAULT_OPTIONS.phetioFeatured},e);t.enabledPropertyOptions=combineOptions({phetioState:t.phetioState,phetioReadOnly:t.phetioReadOnly,phetioDocumentation:"When disabled, the button is grayed out and cannot be pressed",phetioFeatured:!0},t.enabledPropertyOptions),super(t),this.overProperty=new BooleanProperty(!1),this.downProperty=new BooleanProperty(!1,{reentrant:!0}),this.focusedProperty=new BooleanProperty(!1),this.looksPressedProperty=new BooleanProperty(!1),this.looksOverProperty=new BooleanProperty(!1),this.produceSoundEmitter=new Emitter,this.interrupted=!1,this.listeners=[],this.looksPressedMultilink=null,this.looksOverMultilink=null,this.downProperty.lazyLink(n=>{n?t.startCallback():t.endCallback(this.looksOverProperty.get())}),this.enabledProperty.link(n=>{if(!n)for(let r=0;r<this.listeners.length;r++){const s=this.listeners[r];s.interrupt&&s.interrupt()}}),this.disposeButtonModel=()=>{this.overProperty.dispose(),this.downProperty.dispose(),this.produceSoundEmitter.dispose(),this.looksPressedMultilink&&this.looksPressedMultilink.dispose(),this.looksOverMultilink&&this.looksOverMultilink.dispose(),this.listeners=[]}}dispose(){this.disposeButtonModel(),super.dispose()}createPressListener(e){e=combineOptions({canStartPress:()=>this.enabledProperty.value},e);const t=new PressListener(e);this.listeners.push(t),t.isPressedProperty.lazyLink(s=>{this.interrupted=t.interrupted,this.downProperty.set(s)}),t.isOverProperty.lazyLink(this.overProperty.set.bind(this.overProperty)),t.isFocusedProperty.lazyLink(this.focusedProperty.set.bind(this.focusedProperty)),this.looksPressedMultilink&&this.looksPressedMultilink.dispose(),this.looksOverMultilink&&this.looksOverMultilink.dispose();const n=this.listeners.map(s=>s.looksPressedProperty);n.push(this.downProperty),this.looksPressedMultilink=Multilink.multilinkAny(n,(...s)=>{this.looksPressedProperty.value=_.reduce(s,(a,h)=>a||h,!1)});const r=this.listeners.map(s=>s.looksOverProperty);return this.looksOverMultilink=Multilink.multilinkAny(r,(...s)=>{this.looksOverProperty.value=_.reduce(s,(a,h)=>a||h,!1)}),t}}sun.register("ButtonModel",ButtonModel);class ToggleButtonModel extends ButtonModel{constructor(e,t,n,r){assert&&assert(n.valueComparisonStrategy==="reference",'ToggleButtonModel depends on "===" equality for value comparison');const s=optionize()({tandem:Tandem.REQUIRED},r);super(s),this.valueOff=e,this.valueOn=t,this.valueProperty=n;const a=c=>{(this.overProperty.get()||this.focusedProperty.get())&&this.enabledProperty.get()&&!this.interrupted&&(c||this.toggle())};this.downProperty.link(a),this.toggledEmitter=new Emitter({tandem:s.tandem.createTandem("toggledEmitter"),phetioDocumentation:"Emits when the button is toggled",phetioEventType:EventType.USER});const h=()=>{assert&&assert(this.valueProperty.value===this.valueOff||this.valueProperty.value===this.valueOn,`unrecognized value: ${this.valueProperty.value}`),this.valueProperty.value=this.valueProperty.value===this.valueOff?this.valueOn:this.valueOff};this.toggledEmitter.addListener(h),this.disposeToggleButtonModel=()=>{this.downProperty.unlink(a),this.toggledEmitter.dispose()}}dispose(){this.disposeToggleButtonModel(),super.dispose()}toggle(){this.toggledEmitter.emit(),this.produceSoundEmitter.emit()}}sun.register("ToggleButtonModel",ToggleButtonModel);class RectangularToggleButton extends RectangularButton{constructor(e,t,n,r){assert&&assert(e.valueComparisonStrategy==="reference",'RectangularToggleButton depends on "===" equality for value comparison');const s=optionize()({valueOffSoundPlayer:toggleOffSoundPlayer,valueOnSoundPlayer:toggleOnSoundPlayer,tandem:Tandem.REQUIRED,phetioFeatured:!0},r),a=new ToggleButtonModel(t,n,e,s),h=new ToggleButtonInteractionStateProperty(a);super(a,h,s),this.addLinkedElement(e,{tandemName:"property"});const c=()=>{e.value===t?s.valueOffSoundPlayer.play():e.value===n&&s.valueOnSoundPlayer.play()};this.buttonModel.produceSoundEmitter.addListener(c),this.disposeRectangularToggleButton=()=>{this.buttonModel.produceSoundEmitter.removeListener(c),a.dispose()}}dispose(){this.disposeRectangularToggleButton(),super.dispose()}}sun.register("RectangularToggleButton",RectangularToggleButton);class BooleanRectangularToggleButton extends RectangularToggleButton{constructor(e,t,n,r){const s=new BooleanToggleNode(e,t,n),a=optionize()({content:s,tandem:Tandem.REQUIRED},r);super(e,!1,!0,a),this.disposeBooleanRectangularToggleButton=()=>{s.dispose()}}dispose(){this.disposeBooleanRectangularToggleButton(),super.dispose()}}sun.register("BooleanRectangularToggleButton",BooleanRectangularToggleButton);const SYMBOL_RELATIVE_WIDTH=.6,RELATIVE_X_MARGIN=(1-SYMBOL_RELATIVE_WIDTH)/2;class ExpandCollapseButton extends BooleanRectangularToggleButton{constructor(e,t){var D,O;const n=optionize()({sideLength:25,stroke:"black",touchAreaXDilation:5,touchAreaYDilation:5,tandem:Tandem.REQUIRED,tandemNameSuffix:"Button"},t);n.cornerRadius=.1*n.sideLength,n.xMargin=RELATIVE_X_MARGIN*n.sideLength,n.yMargin=n.xMargin,n.buttonAppearanceStrategy=ButtonNode.FlatAppearanceStrategy;const r=SYMBOL_RELATIVE_WIDTH*n.sideLength,a={lineWidth:.15*n.sideLength,stroke:"white",centerX:n.sideLength/2,centerY:n.sideLength/2,pickable:!1},h=new Shape$1().moveTo(r/2,0).lineTo(r/2,r).moveTo(0,r/2).lineTo(r,r/2),c=new Path(h,a),d=new Shape$1().moveTo(-r/2,0).lineTo(r/2,0),y=new Path(d,a);super(e,y,c,n);const g=V=>{this.baseColor=V?"rgb( 255, 85, 0 )":"rgb( 0, 179, 0 )",this.setPDOMAttribute("aria-expanded",V)};e.link(g),assert&&((O=(D=phet==null?void 0:phet.chipper)==null?void 0:D.queryParameters)!=null&&O.binder)&&InstanceRegistry.registerDataURL("sun","ExpandCollapseButton",this),this.disposeExpandCollapseButton=()=>{e.unlink(g)}}dispose(){this.disposeExpandCollapseButton(),super.dispose()}}sun.register("ExpandCollapseButton",ExpandCollapseButton);const Oi=class Oi extends Sizable(Node$2){constructor(e,t){var D,O;const n=optionize()({titleNode:null,expandedProperty:null,resize:!0,overrideTitleNodePickable:!0,allowContentToOverlapTitle:!1,cursor:"pointer",lineWidth:1,cornerRadius:10,stroke:"black",fill:"rgb( 238, 238, 238 )",minWidth:0,titleAlignX:"center",titleAlignY:"center",titleXMargin:10,titleYMargin:2,titleXSpacing:5,showTitleWhenExpanded:!0,useExpandedBoundsWhenCollapsed:!0,titleBarExpandCollapse:!0,buttonAlign:"left",buttonXMargin:4,buttonYMargin:2,contentAlign:"center",contentVerticalAlign:"center",contentXMargin:15,contentYMargin:8,contentXSpacing:5,contentYSpacing:8,expandedSoundPlayer:accordionBoxOpenedSoundPlayer,collapsedSoundPlayer:accordionBoxClosedSoundPlayer,tagName:"div",headingTagName:"h3",accessibleNameBehavior:Oi.ACCORDION_BOX_ACCESSIBLE_NAME_BEHAVIOR,voicingNameResponse:null,voicingObjectResponse:null,voicingContextResponse:null,voicingHintResponse:null,tandem:Tandem.REQUIRED,tandemNameSuffix:"AccordionBox",phetioType:Oi.AccordionBoxIO,phetioEventType:EventType.USER,visiblePropertyOptions:{phetioFeatured:!0},titleBarOptions:{fill:null,stroke:null}},t);n.expandCollapseButtonOptions=combineOptions({sideLength:16,cursor:n.cursor,valueOnSoundPlayer:n.expandedSoundPlayer,valueOffSoundPlayer:n.collapsedSoundPlayer,voicingNameResponse:n.voicingNameResponse,voicingObjectResponse:n.voicingObjectResponse,voicingContextResponse:n.voicingContextResponse,voicingHintResponse:n.voicingHintResponse,tandem:n.tandem.createTandem("expandCollapseButton")},n.expandCollapseButtonOptions),super(),this.expandedBoxOutline=null,this.collapsedBoxOutline=null;let r=n.titleNode;r||(r=new Text("",{tandem:n.tandem.createTandem("titleText")}),this.disposeEmitter.addListener(()=>r.dispose())),n.overrideTitleNodePickable&&(r.pickable=!1),this.expandedProperty=n.expandedProperty,this.expandedProperty||(this.expandedProperty=new BooleanProperty(!0,{tandem:n.tandem.createTandem("expandedProperty"),phetioFeatured:!0}),this.disposeEmitter.addListener(()=>this.expandedProperty.dispose())),this.expandCollapseButton=new ExpandCollapseButton(this.expandedProperty,n.expandCollapseButtonOptions),this.disposeEmitter.addListener(()=>this.expandCollapseButton.dispose());const s={fill:n.fill,cornerRadius:n.cornerRadius};this.expandedBox=new Rectangle(s),this.collapsedBox=new Rectangle(s),this.expandedTitleBar=new InteractiveHighlightPath(null,combineOptions({lineWidth:n.lineWidth,cursor:n.cursor},n.titleBarOptions)),this.expandedBox.addChild(this.expandedTitleBar),this.collapsedTitleBar=new InteractiveHighlightRectangle(combineOptions({cornerRadius:n.cornerRadius,cursor:n.cursor},n.titleBarOptions)),this.collapsedBox.addChild(this.collapsedTitleBar),this.disposeEmitter.addListener(()=>{this.collapsedTitleBar.dispose(),this.expandedTitleBar.dispose()}),n.titleBarExpandCollapse?this.collapsedTitleBar.addInputListener({down:()=>{this.expandCollapseButton.isEnabled()&&(this.phetioStartEvent("expanded"),this.expandedProperty.value=!0,n.expandedSoundPlayer.play(),this.phetioEndEvent())}}):(this.expandedTitleBar.interactiveHighlight="invisible",this.collapsedTitleBar.interactiveHighlight="invisible"),n.showTitleWhenExpanded&&n.titleBarExpandCollapse&&this.expandedTitleBar.addInputListener({down:()=>{this.expandCollapseButton.isEnabled()&&(this.phetioStartEvent("collapsed"),n.collapsedSoundPlayer.play(),this.expandedProperty.value=!1,this.phetioEndEvent())}});const a=()=>{const V=this.expandCollapseButton.visible&&this.expandCollapseButton.pickable;this.collapsedTitleBar.pickable=V,this.expandedTitleBar.pickable=V};if(this.expandCollapseButton.visibleProperty.lazyLink(a),this.expandCollapseButton.pickableProperty.lazyLink(a),this.expandCollapseButton.enabledProperty.link(V=>{const k=n.titleBarExpandCollapse&&V;this.collapsedTitleBar.cursor=k&&n.cursor||null,this.expandedTitleBar.cursor=k&&n.cursor||null}),this.expandCollapseButton.setFocusHighlight(new HighlightFromNode$1(this.expandedTitleBar)),this.expandedBox.addChild(e),n.stroke){const V={stroke:n.stroke,lineWidth:n.lineWidth,cornerRadius:n.cornerRadius,pickable:!1};this.expandedBoxOutline=new Rectangle(V),this.expandedBox.addChild(this.expandedBoxOutline),this.collapsedBoxOutline=new Rectangle(V),this.collapsedBox.addChild(this.collapsedBoxOutline)}const h=new Node$2({excludeInvisibleChildrenFromBounds:!n.useExpandedBoundsWhenCollapsed});this.addChild(h);const c=new Node$2({tagName:"div",ariaRole:"region",pdomOrder:[e],ariaLabelledbyAssociations:[{otherNode:this.expandCollapseButton,otherElementName:PDOMPeer$1.PRIMARY_SIBLING,thisElementName:PDOMPeer$1.PRIMARY_SIBLING}]}),d=new Node$2({tagName:n.headingTagName,pdomOrder:[this.expandCollapseButton]}),y=new Node$2({children:[d,c]});this.addChild(y),this.constraint=new AccordionBoxConstraint(this,e,h,this.expandedBox,this.collapsedBox,this.expandedTitleBar,this.collapsedTitleBar,this.expandedBoxOutline,this.collapsedBoxOutline,r,this.expandCollapseButton,n),this.constraint.updateLayout(),this.constraint.enabled=n.resize;const g=()=>{const V=this.expandedProperty.value;this.expandedBox.visible=V,this.collapsedBox.visible=!V,r.visible=V&&n.showTitleWhenExpanded||!V,y.setPDOMAttribute("aria-hidden",!V),this.expandCollapseButton.voicingSpeakFullResponse({hintResponse:null})};this.expandedProperty.link(g),this.disposeEmitter.addListener(()=>this.expandedProperty.unlink(g)),this.mutate(_.omit(n,"cursor")),this.resetAccordionBox=()=>{n.expandedProperty||this.expandedProperty.reset()},assert&&((O=(D=phet==null?void 0:phet.chipper)==null?void 0:D.queryParameters)!=null&&O.binder)&&InstanceRegistry.registerDataURL("sun","AccordionBox",this)}getCollapsedBoxHeight(){const e=this.constraint.lastCollapsedBoxHeight;return assert&&assert(e!==null),e}getExpandedBoxHeight(){const e=this.constraint.lastExpandedBoxHeight;return assert&&assert(e!==null),e}reset(){this.resetAccordionBox()}};Oi.AccordionBoxIO=new IOType("AccordionBoxIO",{valueType:Oi,supertype:Node$2.NodeIO,events:["expanded","collapsed"]}),Oi.ACCORDION_BOX_ACCESSIBLE_NAME_BEHAVIOR=(e,t,n,r)=>(r.push(()=>{e.expandCollapseButton.accessibleName=n}),t);let AccordionBox=Oi;class InteractiveHighlightPath extends InteractiveHighlighting(Path){}class InteractiveHighlightRectangle extends InteractiveHighlighting(Rectangle){}class AccordionBoxConstraint extends LayoutConstraint{constructor(e,t,n,r,s,a,h,c,d,y,g,D){super(e),this.accordionBox=e,this.contentNode=t,this.containerNode=n,this.expandedBox=r,this.collapsedBox=s,this.expandedTitleBar=a,this.collapsedTitleBar=h,this.expandedBoxOutline=c,this.collapsedBoxOutline=d,this.titleNode=y,this.expandCollapseButton=g,this.options=D,this.lastCollapsedBoxHeight=null,this.lastExpandedBoxHeight=null,this.accordionBox.localPreferredWidthProperty.lazyLink(this._updateLayoutListener),this.accordionBox.localPreferredHeightProperty.lazyLink(this._updateLayoutListener),this.accordionBox.expandedProperty.lazyLink(this._updateLayoutListener),this.addNode(t),this.addNode(y)}layout(){super.layout();const e=this.options;if(this.accordionBox.isChildIncludedInLayout(this.contentNode))this.containerNode.children=[this.expandedBox,this.collapsedBox,this.titleNode,this.expandCollapseButton];else{this.containerNode.children=[];return}const n=this.accordionBox.expandedProperty.value||e.useExpandedBoundsWhenCollapsed,r=e.stroke===null?0:e.lineWidth,s=this.createLayoutProxy(this.contentNode),a=this.createLayoutProxy(this.titleNode),h=s.minimumWidth,c=s.minimumHeight,d=a.minimumWidth,y=Math.max(this.expandCollapseButton.height+2*e.buttonYMargin,this.titleNode.height+2*e.titleYMargin),g=e.showTitleWhenExpanded?Math.max((e.allowContentToOverlapTitle?e.contentYMargin:y+e.contentYSpacing)+c+e.contentYMargin,y):Math.max(this.expandCollapseButton.height+2*e.buttonYMargin,c+2*e.contentYMargin);let D=Math.max(e.minWidth,e.buttonXMargin+this.expandCollapseButton.width+e.titleXSpacing+d+e.titleXMargin);e.titleAlignX==="center"&&(D=Math.max(D,(e.buttonXMargin+this.expandCollapseButton.width+e.titleXSpacing)*2+d),D=Math.max(D,e.titleXMargin*2+d)),e.showTitleWhenExpanded?D=Math.max(D,h+2*e.contentXMargin):D=Math.max(D,this.expandCollapseButton.width+h+e.buttonXMargin+e.contentXMargin+e.contentXSpacing);const O=D+r,V=(n?g:y)+r,k=Math.max(O,this.accordionBox.localPreferredWidth||0),M=Math.max(V,this.accordionBox.localPreferredHeight||0),N=k-r,F=M-r;this.lastCollapsedBoxHeight=y,n&&(this.lastExpandedBoxHeight=F),this.collapsedBox.rectWidth=N,this.collapsedBox.rectHeight=y;const G=this.collapsedBox.selfBounds;if(this.collapsedTitleBar.rectWidth=N,this.collapsedTitleBar.rectHeight=y,this.collapsedBoxOutline&&(this.collapsedBoxOutline.rectWidth=N,this.collapsedBoxOutline.rectHeight=y),n){this.expandedBox.rectWidth=N,this.expandedBox.rectHeight=F;const W=this.expandedBox.selfBounds;this.expandedBoxOutline&&(this.expandedBoxOutline.rectWidth=N,this.expandedBoxOutline.rectHeight=F),this.expandedTitleBar.shape=Shape$1.roundedRectangleWithRadii(0,0,N,y,{topLeft:e.cornerRadius,topRight:e.cornerRadius});let X=W.left+e.contentXMargin,J=W.right-e.contentXMargin;e.showTitleWhenExpanded||(e.buttonAlign==="left"?X+=this.expandCollapseButton.width+e.contentXSpacing:J-=this.expandCollapseButton.width+e.contentXSpacing);const oe=J-X,le=F-(e.showTitleWhenExpanded&&!e.allowContentToOverlapTitle?y+e.contentYMargin+e.contentYSpacing:2*e.contentYMargin);isWidthSizable(this.contentNode)&&this.accordionBox.localPreferredWidth!==null&&(this.contentNode.preferredWidth=oe),isHeightSizable(this.contentNode)&&this.accordionBox.localPreferredHeight!==null&&(this.contentNode.preferredHeight=le),e.contentVerticalAlign==="top"?this.contentNode.top=W.bottom-e.contentYMargin-le:e.contentVerticalAlign==="bottom"?this.contentNode.bottom=W.bottom-e.contentYMargin:this.contentNode.centerY=W.bottom-e.contentYMargin-le/2,e.contentAlign==="left"?this.contentNode.left=X:e.contentAlign==="right"?this.contentNode.right=J:this.contentNode.centerX=(X+J)/2}let ie=G.left+e.titleXMargin,Z=G.right-e.titleXMargin;e.buttonAlign==="left"?(this.expandCollapseButton.left=G.left+e.buttonXMargin,ie=this.expandCollapseButton.right+e.titleXSpacing):(this.expandCollapseButton.right=G.right-e.buttonXMargin,Z=this.expandCollapseButton.left-e.titleXSpacing),isWidthSizable(this.titleNode)&&(this.titleNode.preferredWidth=Z-ie),e.titleAlignX==="left"?this.titleNode.left=ie:e.titleAlignX==="right"?this.titleNode.right=Z:this.titleNode.centerX=G.centerX,e.titleAlignY==="top"?(this.expandCollapseButton.top=this.collapsedBox.top+Math.max(e.buttonYMargin,e.titleYMargin),this.titleNode.top=this.expandCollapseButton.top):(this.expandCollapseButton.centerY=this.collapsedBox.centerY,this.titleNode.centerY=this.expandCollapseButton.centerY),s.dispose(),a.dispose(),this.accordionBox.localMinimumWidth=O,this.accordionBox.localMinimumHeight=V}dispose(){this.accordionBox.localPreferredWidthProperty.unlink(this._updateLayoutListener),this.accordionBox.localPreferredHeightProperty.unlink(this._updateLayoutListener),this.accordionBox.expandedProperty.unlink(this._updateLayoutListener),super.dispose()}}sun.register("AccordionBox",AccordionBox);const soundURI$7="data:audio/mpeg;base64,//tQxAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAAFAAAE5AAzMzMzMzMzMzMzMzMzMzMzMzMzZmZmZmZmZmZmZmZmZmZmZmZmZmaZmZmZmZmZmZmZmZmZmZmZmZmZmczMzMzMzMzMzMzMzMzMzMzMzMzM//////////////////////////8AAAA5TEFNRTMuOTlyAaUAAAAAAAAAABRAJAZmQgAAQAAABOTGvClKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/7UMQAAAjxrv+ggLoZGTXh9oJQAa222FG3ASABBG51MY/j4AAB4AYI3/H3//Pqd/zv0Jp/8//zn3n6Mmf/J7f//8jf+fOeeggHA4RXkGh8XEwHAMHD4udyCYuhAALhgJqWJAEDGMYxvHlyAHxc9P76dP//T/Rm//p+v9tvb0Tzr1XyfnelP/3b0//5vo86Mlm0dHQrscccRQg5oSYpziaiB52oQCkxnR6LQisRCEMhluyeqEhIiWMiSvQjhwDTCtCPyDkNrP+UsBTNwVsJGSD/+1LEFoAQMWtluYaQEWGP7H+wYAR9IvpDLBawV8OWbG5oShmbiVnh8GAU6ZIjnetMKuOcpmaSndX80HuS7puaIKq/6lvM36lIJf8+Zm6CFA0t3fV/91IOhPJ1GCH13q//5o6DJl9/F3ErtwAGRlJ26tx4H5gV4lzzrIqy8jTNBZl1Hep3doI2/x6AMOljV5/M4clzeagOVs4SmnmZk2fTyahylhxZ1R7/1HlnhEe4KgF3SISoKnviYs9T8sp4Ku5ICsAAg3RwNdct5GVqea2W4P/7UsQHgAuZRzrtmE8JO4qkaa4M4MXAzUcoyYPSsZe/D4w5DUicEmE/ziQka1VaLTh0y8+qp/UtRMpQoli5jYCz6St//RjTOrPXlI/KJaZ2RHX6mMrJqxfqVjPM/K/thi6pyAAPlyOxkEr9tPgR2ldNwBRI0383ZJR5NmIAG2zBZOw1tKaJR6jzjIxgTlVLjBgJmawwRo8JXAUYCz1gr/q+aVWur8tO+j4iUe////6ii3UCwZHQhxd93nYdy9H1MjPwThY/VGgQQLo200aOkCDF//tSxA+CCwg1HK3lIQHXlCPo97AIw8D44EBOcB8oGBIND4gcCBc+IFHC7wwUOA+oMiAaH1PDCw+mxbydxPV3/zjbCnci8p/9nIJTQYSH5vktZIAEdHIA5HkiS4k11MYsCUFS8QSbEVhJUnQlFpKIJNQhJJrBKEZ8kiKoJIkqToSj5KJJ6hiCTXCUJUZJEl45Ek9TCUfQkkyuSSbzS72V1mVruLnhMeBUsHREPDQiPA0VOiJwdKuBlR5Fqtbk3f///t8FdSogAuxJp2uAWhIWFmv/+1LEBgPGHADHoIhgIAAANIAAAATcLVLFRWKCwsLCyxUVFVf6xVmLCws1YqKior////2RVn/+LCwtTEFNRTMuOTkuM1VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQ==",soundByteArray$7=base64SoundToByteArray(phetAudioContext$1,soundURI$7),unlock$7=asyncLoader.createLock(soundURI$7),wrappedAudioBuffer$7=new WrappedAudioBuffer;let unlocked$7=!1;const safeUnlock$7=()=>{unlocked$7||(unlock$7(),unlocked$7=!0)},onDecodeSuccess$7=o=>{wrappedAudioBuffer$7.audioBufferProperty.value===null&&(wrappedAudioBuffer$7.audioBufferProperty.set(o),safeUnlock$7())},onDecodeError$7=o=>{console.warn("decode of audio data failed, using stubbed sound, error: "+o),wrappedAudioBuffer$7.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$7()},decodePromise$7=phetAudioContext$1.decodeAudioData(soundByteArray$7.buffer,onDecodeSuccess$7,onDecodeError$7);decodePromise$7&&decodePromise$7.then(o=>{wrappedAudioBuffer$7.audioBufferProperty.value===null&&(wrappedAudioBuffer$7.audioBufferProperty.set(o),safeUnlock$7())}).catch(o=>{console.warn("promise rejection caught for audio decode, error = "+o),safeUnlock$7()});class MultiSelectionSoundPlayerFactory{constructor(){this._basisSoundClip=null,this.soundPlayers=[]}getSoundClipInstance(){return this._basisSoundClip||(this._basisSoundClip=new SoundClip(wrappedAudioBuffer$7,{initialOutputLevel:.7,rateChangesAffectPlayingSounds:!1}),soundManager.addSoundGenerator(this._basisSoundClip,{categoryName:"user-interface"})),this._basisSoundClip}getSelectionSoundPlayer(e){if(!this.soundPlayers[e]){const t=Math.pow(2,-e/12);this.soundPlayers[e]=new FixedSpeedSoundClipPlayer(this.getSoundClipInstance(),t)}return this.soundPlayers[e]}}class FixedSpeedSoundClipPlayer{constructor(e,t){this.soundPlayer=e,this.playbackRate=t}play(){this.soundPlayer.setPlaybackRate(this.playbackRate),this.soundPlayer.play()}stop(){this.soundPlayer.stop()}}const multiSelectionSoundPlayerFactory=new MultiSelectionSoundPlayerFactory;tambo.register("multiSelectionSoundPlayerFactory",multiSelectionSoundPlayerFactory);const Ks=class Ks extends WidthSizable(Voicing(Node$2)){constructor(e,t,n,r){var ie,Z;assert&&assert(e.valueComparisonStrategy==="reference",'ToggleSwitch depends on "===" equality for value comparison');const s=optionize()({centerColor:"black",radius:Ks.DEFAULT_RADIUS,selectedColor:"rgb( 143, 197, 250 )",deselectedColor:"white",xSpacing:8,stroke:"black",soundPlayer:multiSelectionSoundPlayerFactory.getSelectionSoundPlayer(0),a11yNameAttribute:null,touchAreaXDilation:0,touchAreaYDilation:0,mouseAreaXDilation:0,mouseAreaYDilation:0,cursor:"pointer",disabledOpacity:SceneryConstants.DISABLED_OPACITY,tandem:Tandem.REQUIRED,tandemNameSuffix:"RadioButton",visiblePropertyOptions:{phetioFeatured:!0},phetioEnabledPropertyInstrumented:!0,tagName:"input",inputType:"radio",containerTagName:"li",labelTagName:"label",appendLabel:!0,appendDescription:!0},r);super(),this.onInputEmitter=new Emitter,this._isMouseAreaCustomized=!1,this._isTouchAreaCustomized=!1,this._isSettingAreas=!1,this.value=t;const a=new Node$2,h=new Circle(s.radius/3,{fill:s.centerColor}),c=new Circle(s.radius,{fill:s.selectedColor,stroke:s.stroke}),d=new Node$2({children:[c,h]});a.addChild(d);const y=new Node$2,g=new Circle(s.radius,{fill:s.deselectedColor,stroke:s.stroke});y.addChild(g);const D=new Node$2({children:[a,y],pickable:!1}),O=()=>{n.left=g.right+s.xSpacing,n.centerY=g.centerY};n.boundsProperty.link(O);const V=new Rectangle({});a.pickable=y.pickable=!1,n.pickable=!1,this.children=[D,n,V],this.constraint=new AquaRadioButtonConstraint(this,D,n,V,s),this.constraint.updateLayout();const k=W=>{a.visible=W===t,y.visible=!a.visible};e.link(k);const M=()=>{const W=e.value;e.set(t),W!==e.value&&this.onInputEmitter.emit()},N=new FireListener({fire:M,tandem:s.tandem.createTandem("fireListener")});this.addInputListener(N),this.onInputEmitter.addListener(()=>s.soundPlayer.play());const F={change:M};this.addInputListener(F),e.value===t&&this.setPDOMAttribute("checked","checked");const G=W=>{this.pdomChecked=W===t};e.link(G),s.a11yNameAttribute!==null&&this.setPDOMAttribute("name",s.a11yNameAttribute),this.mutate(s),this.disposeAquaRadioButton=()=>{this.constraint.dispose(),this.onInputEmitter.dispose(),this.removeInputListener(N),this.removeInputListener(F),e.unlink(G),e.unlink(k),n.boundsProperty.hasListener(O)&&n.boundsProperty.unlink(O),N.dispose()},assert&&((Z=(ie=phet==null?void 0:phet.chipper)==null?void 0:ie.queryParameters)!=null&&Z.binder)&&InstanceRegistry.registerDataURL("sun","AquaRadioButton",this)}dispose(){this.disposeAquaRadioButton(),super.dispose()}};Ks.DEFAULT_RADIUS=7;let AquaRadioButton=Ks;class AquaRadioButtonConstraint extends LayoutConstraint{constructor(e,t,n,r,s){super(e),this.radioButton=e,this.radioNode=t,this.content=n,this.rectangle=r,this.options=s,this.radioButton.localPreferredWidthProperty.lazyLink(this._updateLayoutListener),this.addNode(n)}layout(){super.layout();const e=this.createLayoutProxy(this.content),t=e.minimumWidth,n=this.radioNode.width+this.options.xSpacing+t,r=Math.max(n,this.radioButton.localPreferredWidth||0);isWidthSizable(this.content)&&(e.preferredWidth=r-this.radioNode.width-this.options.xSpacing),e.left=this.radioNode.right+this.options.xSpacing,e.centerY=this.radioNode.centerY,this.rectangle.rectBounds=this.radioNode.bounds.union(e.bounds).withMaxX(Math.max(this.radioNode.left+r,e.right)),this.radioButton._isSettingAreas=!0,this.radioButton._isTouchAreaCustomized||(this.radioButton.touchArea=this.radioButton.localBounds.dilatedXY(this.options.touchAreaXDilation,this.options.touchAreaYDilation)),this.radioButton._isMouseAreaCustomized||(this.radioButton.mouseArea=this.radioButton.localBounds.dilatedXY(this.options.mouseAreaXDilation,this.options.mouseAreaYDilation)),this.radioButton._isSettingAreas=!1,e.dispose(),this.radioButton.localMinimumWidth=n}dispose(){this.radioButton.localPreferredWidthProperty.unlink(this._updateLayoutListener),super.dispose()}}sun.register("AquaRadioButton",AquaRadioButton);let instanceCount$1=0;const CLASS_NAME$1="AquaRadioButtonGroup";class AquaRadioButtonGroup extends FlowBox{constructor(e,t,n){instanceCount$1++;const r=optionize()({touchAreaXDilation:0,touchAreaYDilation:0,mouseAreaXDilation:0,mouseAreaYDilation:0,orientation:"vertical",spacing:3,stretch:!0,disabledOpacity:SceneryConstants.DISABLED_OPACITY,tandem:Tandem.REQUIRED,tandemNameSuffix:"RadioButtonGroup",visiblePropertyOptions:{phetioFeatured:!0},phetioEnabledPropertyInstrumented:!0,phetioFeatured:!0,tagName:"ul",labelTagName:"h3",ariaRole:"radiogroup",groupFocusHighlight:!0},n),s=getGroupItemNodes(t,r.tandem);r.orientation==="vertical"&&(r.align=r.align||"left");const a=t.map((d,y)=>{assert&&assert(!d.tandem,"Cannot specify tandem any more");const g=s[y];return assert&&assert(!g.hasPDOMContent,"Accessibility is provided by AquaRadioButton and AquaRadioButtonGroupItem.labelContent. Additional PDOM content in the provided Node could break accessibility."),new AquaRadioButton(e,d.value,g,combineOptions({a11yNameAttribute:CLASS_NAME$1+instanceCount$1,labelContent:d.labelContent||null,soundPlayer:multiSelectionSoundPlayerFactory.getSelectionSoundPlayer(y),tandem:d.tandemName?r.tandem.createTandem(d.tandemName):r.tandem===Tandem.OPT_OUT?Tandem.OPT_OUT:Tandem.REQUIRED,touchAreaXDilation:r.orientation==="horizontal"?r.spacing/2:r.touchAreaXDilation,touchAreaYDilation:r.orientation==="vertical"?r.spacing/2:r.touchAreaYDilation,mouseAreaXDilation:r.orientation==="horizontal"?r.spacing/2:r.mouseAreaXDilation,mouseAreaYDilation:r.orientation==="vertical"?r.spacing/2:r.mouseAreaYDilation},r.radioButtonOptions,d.options))});r.children=a,super(r),this.onInputEmitter=new Emitter,this.addAriaLabelledbyAssociation({thisElementName:PDOMPeer$1.PRIMARY_SIBLING,otherNode:this,otherElementName:PDOMPeer$1.LABEL_SIBLING});const h=new KeyboardListener({keys:["arrowLeft","arrowRight","arrowUp","arrowDown"],callback:d=>{d&&d.pointer.reserveForKeyboardDrag()}});this.addInputListener(h);const c=this.onRadioButtonInput.bind(this);for(let d=0;d<a.length;d++)a[d].onInputEmitter.addListener(c);this.addLinkedElement(e,{tandemName:"property"}),this.disposeAquaRadioButtonGroup=()=>{this.removeInputListener(h),h.dispose(),a.forEach(d=>d.dispose()),this.onInputEmitter.dispose(),s.forEach(d=>d.dispose())},this.radioButtons=a}onRadioButtonInput(){this.onInputEmitter.emit()}dispose(){this.disposeAquaRadioButtonGroup(),super.dispose()}getButton(e){const t=_.find(this.radioButtons,n=>n.value===e);return assert&&assert(t,`no radio button found for value ${e}`),t}}sun.register("AquaRadioButtonGroup",AquaRadioButtonGroup);const soundURI$6="data:audio/mpeg;base64,//swxAAABlAhPLTAgDE1De+/HoACAH4CwkCAJDo5gDgPRksn2WLHOB8EHShd5cHwfBBwgBBOJw/UCAY/lAxWD/4DB9+CH/6XQjMTIIcYUIQPQIRAIBAACUIawkYq7IQ/BawVqEc7mTjD+OFygBAnHbHq7UkLJ8aCnnrZlPpg3IkRJBgPH/MCQCI985/yAnHAAhmv3lHuAgAgAxJF//syxAOACHQpa7zBAAD8EunxpI3HUCEZHQlA2EYuDsSjE5EkSQGhUDYDxOARLoiBmIgalVgq4qWeWBqsNYKywNO+p/sxFyKwVOlXRFDtZ0S86oQ0C2W+wBOmlaWuS6+BIqZMz+AYy3FuwBkKXM2idVoKlYwUd/oIGgsbLpEbaCsmIyZRtbw6TPwj+mYmGr8QqnGHBLo3LKAAxKabZ//7MsQGAAhsl1OsPMcxAo3mpbCaAvIuuQRmW4WNHhDBJnoBORIlh+I9dvGCTCKP0kzo7rHHTi87diQ2XqnRN77y8lnKUl8zf+X0Fu0iCDV/9AP7el8Cw8raZKqiYShe+6bzYk0zXmEuGnBDcQhyRzPeI4Jbsmj5OxzZVhSX9adVU4Kk9r9esE3etv+/6wUIg3Wm62nA3Ab0EIcLUQ7/+zLECABGICs9oemDMLwEZrQcvFYyDBCUCgUAwQCUSvgROof5poGn9O7o70P/X9P/T+360+lAhIJVtyuNDljXzM7Ek0fGUB/ltZQF8iD7dBcVTs00f31POqR0/V/q/pjEe1z3jyAAQRBHGmSBEEVK6QIYH2miQZKNfgCVtiH9vVLp+w7an/d0jdUx9VnqZIJSvFtsaUFKKFBVCzoe//swxBwABSAhLaDl4nCsA+a0fDyG3vbgKx5OhNXyuPYt7kJJSg9B6heqxP93q/9P6IwSQ8LbYIFBVUF85RwseJPX6+Q7qIq7f/8ayokh7P//V8oyAABbhbGEIBBhOJgEGTBx6KjUiosS54l6y0i3jOz/6f///RVMQU1FMy45OS41VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//syxDWABEQTMaCF4HCNAmL0EJgGVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQ==",soundByteArray$6=base64SoundToByteArray(phetAudioContext$1,soundURI$6),unlock$6=asyncLoader.createLock(soundURI$6),wrappedAudioBuffer$6=new WrappedAudioBuffer;let unlocked$6=!1;const safeUnlock$6=()=>{unlocked$6||(unlock$6(),unlocked$6=!0)},onDecodeSuccess$6=o=>{wrappedAudioBuffer$6.audioBufferProperty.value===null&&(wrappedAudioBuffer$6.audioBufferProperty.set(o),safeUnlock$6())},onDecodeError$6=o=>{console.warn("decode of audio data failed, using stubbed sound, error: "+o),wrappedAudioBuffer$6.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$6()},decodePromise$6=phetAudioContext$1.decodeAudioData(soundByteArray$6.buffer,onDecodeSuccess$6,onDecodeError$6);decodePromise$6&&decodePromise$6.then(o=>{wrappedAudioBuffer$6.audioBufferProperty.value===null&&(wrappedAudioBuffer$6.audioBufferProperty.set(o),safeUnlock$6())}).catch(o=>{console.warn("promise rejection caught for audio decode, error = "+o),safeUnlock$6()});const pushButtonSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$6,{soundClipOptions:{initialOutputLevel:.5},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("pushButtonSoundPlayer",pushButtonSoundPlayer);const twixt=new Namespace("twixt"),je=class je{constructor(e,t,n){this.value=e,this.derivative=t,this.secondDerivative=n}static polynomialEaseInValue(e,t){return assert&&assert(tIsValid(t),`invalid t: ${t}`),Math.pow(t,e)}static polynomialEaseOutValue(e,t){return assert&&assert(tIsValid(t),`invalid t: ${t}`),1-Math.pow(1-t,e)}static polynomialEaseInOutValue(e,t){return assert&&assert(tIsValid(t),`invalid t: ${t}`),t<=.5?.5*Math.pow(2*t,e):1-je.polynomialEaseInOutValue(e,1-t)}static polynomialEaseInDerivative(e,t){return assert&&assert(tIsValid(t),`invalid t: ${t}`),e*Math.pow(t,e-1)}static polynomialEaseOutDerivative(e,t){return assert&&assert(tIsValid(t),`invalid t: ${t}`),e*Math.pow(1-t,e-1)}static polynomialEaseInOutDerivative(e,t){return assert&&assert(tIsValid(t),`invalid t: ${t}`),t<=.5?Math.pow(2,e-1)*e*Math.pow(t,e-1):je.polynomialEaseInOutDerivative(e,1-t)}static polynomialEaseInSecondDerivative(e,t){return assert&&assert(tIsValid(t),`invalid t: ${t}`),(e-1)*e*Math.pow(t,e-2)}static polynomialEaseOutSecondDerivative(e,t){return assert&&assert(tIsValid(t),`invalid t: ${t}`),-(e-1)*e*Math.pow(1-t,e-2)}static polynomialEaseInOutSecondDerivative(e,t){return assert&&assert(tIsValid(t),`invalid t: ${t}`),t<=.5?Math.pow(2,e-1)*(e-1)*e*Math.pow(t,e-2):-je.polynomialEaseInOutSecondDerivative(e,1-t)}static polynomialEaseIn(e){return new je(je.polynomialEaseInValue.bind(null,e),je.polynomialEaseInDerivative.bind(null,e),je.polynomialEaseInSecondDerivative.bind(null,e))}static polynomialEaseOut(e){return new je(je.polynomialEaseOutValue.bind(null,e),je.polynomialEaseOutDerivative.bind(null,e),je.polynomialEaseOutSecondDerivative.bind(null,e))}static polynomialEaseInOut(e){return new je(je.polynomialEaseInOutValue.bind(null,e),je.polynomialEaseInOutDerivative.bind(null,e),je.polynomialEaseInOutSecondDerivative.bind(null,e))}};je.LINEAR=je.polynomialEaseIn(1),je.QUADRATIC_IN=je.polynomialEaseIn(2),je.QUADRATIC_OUT=je.polynomialEaseOut(2),je.QUADRATIC_IN_OUT=je.polynomialEaseInOut(2),je.CUBIC_IN=je.polynomialEaseIn(3),je.CUBIC_OUT=je.polynomialEaseOut(3),je.CUBIC_IN_OUT=je.polynomialEaseInOut(3),je.QUARTIC_IN=je.polynomialEaseIn(4),je.QUARTIC_OUT=je.polynomialEaseOut(4),je.QUARTIC_IN_OUT=je.polynomialEaseInOut(4),je.QUINTIC_IN=je.polynomialEaseIn(5),je.QUINTIC_OUT=je.polynomialEaseOut(5),je.QUINTIC_IN_OUT=je.polynomialEaseInOut(5);let Easing=je;function tIsValid(o){return typeof o=="number"&&isFinite(o)&&o>=0&&o<=1}twixt.register("Easing",Easing);class AnimationTarget{constructor(e){this.startingValue=null,this.endingValue=null;const t=optionize()({setValue:null,getValue:null,property:null,object:null,attribute:null,to:null,delta:null,speed:null,from:null,easing:Easing.CUBIC_IN_OUT,blend:AnimationTarget.DEFAULT_BLEND,distance:AnimationTarget.DEFAULT_DISTANCE,add:AnimationTarget.DEFAULT_ADD},e);assert&&assert(+(t.property!==null)+ +(t.object!==null)+ +(t.setValue!==null)==1,"Should have one (and only one) way of defining how to set the animated value. Use one of property/object/setValue"),assert&&assert(t.setValue===null||typeof t.setValue=="function","If setValue is provided, it should be a function."),assert&&assert(t.setValue===null||t.from!==null||typeof t.getValue=="function",'If setValue is provided and no "from" value is specified, then getValue needs to be a function.'),assert&&assert(t.to!==null||t.delta!==null,"Need something to animate to, use to/delta"),assert&&assert(t.property===null||isTReadOnlyProperty(t.property)&&t.property.isSettable(),"If property is provided, it should be a settable Property or TinyProperty"),assert&&assert(t.object===null||typeof t.object=="object"&&typeof t.attribute=="string","If object is provided, then object should be an object, and attribute should be a string."),assert&&assert(t.easing instanceof Easing,"The easing should be of type Easing"),assert&&assert(typeof t.blend=="function","The blend option should be a function"),assert&&assert(typeof t.distance=="function","The distance option should be a function"),assert&&assert(typeof t.add=="function","The add option should be a function"),t.object&&(assert&&assert(t.attribute!==null),t.setValue=AnimationTarget.OBJECT_SET(t.object,t.attribute),t.getValue=AnimationTarget.OBJECT_GET(t.object,t.attribute)),t.property&&(t.setValue=AnimationTarget.PROPERTY_SET(t.property),t.getValue=AnimationTarget.PROPERTY_GET(t.property)),assert&&assert(t.setValue!==null),this.getValue=t.getValue,this.setValue=t.setValue,this.easing=t.easing,this.from=t.from,this.to=t.to,this.delta=t.delta,this.speed=t.speed,this.blend=t.blend,this.distance=t.distance,this.add=t.add}static DEFAULT_BLEND(e,t,n){if(assert&&assert(isFinite(n)&&n>=0&&n<=1,`Invalid ratio: ${n}`),n===0)return e;if(n===1)return t;if(typeof e=="number"&&typeof t=="number")return e+(t-e)*n;if(typeof e=="object"&&typeof t=="object"&&typeof e.blend=="function")return e.blend(t,n);throw new Error(`Blending not supported for: ${JSON.stringify(e)}, ${JSON.stringify(t)}, pass in a blend option`)}static DEFAULT_DISTANCE(e,t){if(typeof e=="number"&&typeof t=="number")return Math.abs(e-t);if(typeof e=="object"&&typeof t=="object"&&typeof e.distance=="function")return e.distance(t);throw new Error(`Distance (required for speed) by default not supported for: ${JSON.stringify(e)}, ${JSON.stringify(t)}, pass in a distance option`)}static DEFAULT_ADD(e,t){if(typeof e=="number"&&typeof t=="number")return e+t;if(typeof e=="object"&&typeof t=="object"&&typeof e.plus=="function")return e.plus(t);throw new Error(`Addition (required for delta) by default not supported for: ${JSON.stringify(e)}, ${JSON.stringify(t)}, pass in an add option`)}static OBJECT_SET(e,t){return function(n){e[t]=n}}static OBJECT_GET(e,t){return function(){return e[t]}}static PROPERTY_SET(e){return function(t){e.value=t}}static PROPERTY_GET(e){return function(){return e.value}}computeStartEnd(){assert&&assert(this.to!==null||this.delta!==null),assert&&assert(this.from!==null||this.getValue!==null),this.startingValue=this.from!==null?this.from:this.getValue(),this.endingValue=this.to!==null?this.to:this.add(this.startingValue,this.delta)}update(e){assert&&assert(this.setValue!==null),assert&&assert(this.startingValue!==null),assert&&assert(this.endingValue!==null),this.setValue(this.blend(this.startingValue,this.endingValue,this.easing.value(e)))}hasPreferredDuration(){return this.speed!==null}getPreferredDuration(){return assert&&assert(this.startingValue!==null),assert&&assert(this.delta!==null),this.speed===null?null:this.speed*this.distance(this.startingValue,this.delta)}}twixt.register("AnimationTarget",AnimationTarget);class Animation extends Disposable{constructor(e){const t=optionize()({targets:null,duration:null,delay:0,stepEmitter:stepTimer},e);assert&&assert(+(t.property!==void 0)+ +(t.object!==void 0)+ +(t.setValue!==void 0)+ +(t.targets!==null)==1,"Should have one (and only one) way of defining how to set the animated value. Use one of property/object/setValue/targets"),assert&&assert(typeof t.delay=="number"&&isFinite(t.delay)&&t.delay>=0,"The delay should be a non-negative number."),assert&&assert(t.stepEmitter===null||t.stepEmitter instanceof Emitter||t.stepEmitter instanceof TinyEmitter,"stepEmitter must be null or an (Tiny)Emitter"),super(t),this.length=0,this.remainingDelay=0,this.remainingAnimation=0,this.runningProperty=new BooleanProperty(!1),this.animatingProperty=new BooleanProperty(!1),this.startEmitter=new Emitter,this.beginEmitter=new Emitter,this.finishEmitter=new Emitter({parameters:[{valueType:"number"}]}),this.stopEmitter=new Emitter,this.endedEmitter=new Emitter({hasListenerOrderDependencies:!0}),this.updateEmitter=new Emitter,this.targets=(t.targets===null?[t]:t.targets).map(r=>new AnimationTarget(r)),assert&&assert(+(t.duration!==null)+_.sum(_.map(this.targets,r=>r.hasPreferredDuration()?1:0))===1,"Exactly one duration/speed option should be used."),this.duration=t.duration,this.delay=t.delay;const n=t.stepEmitter;if(n){const r=this.step.bind(this);this.runningProperty.link(s=>{s&&!n.hasListener(r)?n.addListener(r):!s&&n.hasListener(r)&&n.removeListener(r)}),this.disposeEmitter.addListener(()=>{n.hasListener(r)&&n.removeListener(r)})}}start(e){return this.runningProperty.value?this:(this.remainingDelay=this.delay,this.runningProperty.value=!0,this.startEmitter.emit(),this.step(e!==void 0?e:0),this)}stop(){return this.runningProperty.value?(this.runningProperty.value=!1,this.stopEmitter.emit(),this.endedEmitter.emit(),this):this}step(e){if(!this.runningProperty.value)return this;if(!this.animatingProperty.value){if(this.remainingDelay-=e,e=-this.remainingDelay,this.remainingDelay>0)return this;this.length=this.duration;for(let n=0;n<this.targets.length;n++){const r=this.targets[n];r.computeStartEnd(),this.length===null&&(this.length=r.getPreferredDuration())}assert&&assert(this.length!==null,"After going through the targets, we should have a length by now"),this.remainingAnimation=this.length,this.animatingProperty.value=!0,this.beginEmitter.emit()}this.remainingAnimation-=e,e=-this.remainingAnimation,assert&&assert(this.length!==null);const t=this.length>0?DotUtils.clamp((this.length-this.remainingAnimation)/this.length,0,1):1;for(let n=0;n<this.targets.length;n++)this.targets[n].update(t);return this.updateEmitter.emit(),t===1&&(this.animatingProperty.value=!1,this.runningProperty.value=!1,this.finishEmitter.emit(e),this.endedEmitter.emit()),this}then(e){return this.finishEmitter.addListener(t=>e.start(t)),e}dispose(){this.runningProperty.dispose(),this.animatingProperty.dispose(),this.startEmitter.dispose(),this.beginEmitter.dispose(),this.finishEmitter.dispose(),this.stopEmitter.dispose(),this.endedEmitter.dispose(),this.updateEmitter.dispose(),super.dispose()}}twixt.register("Animation",Animation);class PushButtonInteractionStateProperty extends DerivedProperty4{constructor(e){super([e.focusedProperty,e.overProperty,e.looksOverProperty,e.looksPressedProperty],(t,n,r,s)=>r&&!s?ButtonInteractionState.OVER:(n||t)&&s?ButtonInteractionState.PRESSED:ButtonInteractionState.IDLE,{valueType:ButtonInteractionState})}}sun.register("PushButtonInteractionStateProperty",PushButtonInteractionStateProperty);class PushButtonModel extends ButtonModel{constructor(e){const t=optionize()({fireOnDown:!1,listener:null,interruptListener:null,fireOnHold:!1,fireOnHoldDelay:400,fireOnHoldInterval:100,tandem:Tandem.REQUIRED,phetioReadOnly:PhetioObject.DEFAULT_OPTIONS.phetioReadOnly},e);super(t),this.startEvent=null,this.isFiringProperty=new BooleanProperty(!1),this.firedEmitter=new Emitter({tandem:t.tandem.createTandem("firedEmitter"),phetioDocumentation:"Emits when the button is fired",phetioReadOnly:t.phetioReadOnly,phetioEventType:EventType.USER,hasListenerOrderDependencies:!0}),t.interruptListener&&this.firedEmitter.addListener(()=>{t.interruptListener(this.startEvent)}),t.listener!==null&&this.firedEmitter.addListener(t.listener),t.fireOnHold&&(this.timer=new CallbackTimer({callback:this.fire.bind(this),delay:t.fireOnHoldDelay,interval:t.fireOnHoldInterval}));const n=s=>{var a,h,c;if(s)this.enabledProperty.get()&&(this.startEvent=((c=(h=(a=phet==null?void 0:phet.joist)==null?void 0:a.display)==null?void 0:h._input)==null?void 0:c.currentSceneryEvent)||null,t.fireOnDown&&this.fire(),this.timer&&this.timer.start(),(t.fireOnDown||this.timer)&&this.produceSoundEmitter.emit());else{const d=!t.fireOnDown&&(this.overProperty.get()||this.focusedProperty.get())&&this.enabledProperty.get()&&!this.interrupted;this.timer?this.timer.stop(d):d&&(this.produceSoundEmitter.emit(),this.fire())}};this.downProperty.link(n);const r=s=>{!s&&this.timer&&this.timer.stop(!1)};this.enabledProperty.link(r),this.disposePushButtonModel=()=>{this.isFiringProperty.value=!1,this.isFiringProperty.dispose(),this.firedEmitter.dispose(),this.downProperty.unlink(n),this.enabledProperty.unlink(r),this.timer&&(this.timer.dispose(),this.timer=null)}}dispose(){this.disposePushButtonModel(),super.dispose()}addListener(e){this.firedEmitter.addListener(e)}removeListener(e){this.firedEmitter.removeListener(e)}fire(){assert&&assert(!this.isFiringProperty.value,"Cannot fire when already firing"),this.isFiringProperty.value=!0,this.firedEmitter.emit(),this.isFiringProperty.value=!1}}sun.register("PushButtonModel",PushButtonModel);class RectangularPushButton extends RectangularButton{constructor(e){var h,c;const t=optionize()({soundPlayer:pushButtonSoundPlayer,tandem:Tandem.REQUIRED},e),n=t.listener,r=_.omit(t,["listener"]),s=new PushButtonModel(r);super(s,new PushButtonInteractionStateProperty(s),r),this.pushButtonModel=s,n&&this.addListener(n);const a=()=>{t.soundPlayer.play()};s.produceSoundEmitter.addListener(a),this.disposeRectangularPushButton=function(){s.produceSoundEmitter.removeListener(a),s.dispose()},assert&&((c=(h=phet==null?void 0:phet.chipper)==null?void 0:h.queryParameters)!=null&&c.binder)&&InstanceRegistry.registerDataURL("sun","RectangularPushButton",this)}dispose(){super.dispose(),this.disposeRectangularPushButton()}addListener(e){this.pushButtonModel.addListener(e)}removeListener(e){this.pushButtonModel.removeListener(e)}}sun.register("RectangularPushButton",RectangularPushButton);const ANGLES={up:0,down:Math.PI,left:-Math.PI/2,right:Math.PI/2};class CarouselButton extends RectangularPushButton{constructor(e){const t=optionize()({arrowDirection:"up",arrowSize:new Dimension2(20,7),arrowPathOptions:{stroke:"black",lineWidth:3,lineCap:"round"},baseColor:"rgba( 200, 200, 200, 0.5 )",buttonAppearanceStrategy:ButtonNode.FlatAppearanceStrategy,cornerRadius:4},e);let n=null;t.stroke===void 0&&(n=new PaintColorProperty(t.baseColor,{luminanceFactor:-.8}),t.stroke=n),assert&&assert(ANGLES.hasOwnProperty(t.arrowDirection),`invalid direction: ${t.arrowDirection}`);let r=new Shape$1().moveTo(0,0).lineTo(t.arrowSize.width/2,-t.arrowSize.height).lineTo(t.arrowSize.width,0);r=r.transformed(Matrix3.rotation2(ANGLES[t.arrowDirection])),t.content=new Path(r,t.arrowPathOptions);const s=t.arrowDirection,a=t.cornerRadius;if(t.leftTopCornerRadius=s==="up"||s==="left"?a:0,t.rightTopCornerRadius=s==="up"||s==="right"?a:0,t.leftBottomCornerRadius=s==="down"||s==="left"?a:0,t.rightBottomCornerRadius=s==="down"||s==="right"?a:0,s==="up"||s==="down"){const h=t.mouseAreaYDilation/2||0,c=t.touchAreaYDilation/2||0;t.mouseAreaYDilation=h,t.touchAreaYDilation=c,t.mouseAreaYShift=s==="up"?-h:h,t.touchAreaYShift=s==="up"?-c:c}else{const h=t.mouseAreaXDilation/2||0,c=t.touchAreaXDilation/2||0;t.mouseAreaXDilation=h,t.touchAreaXDilation=c,t.mouseAreaXShift=s==="left"?-h:h,t.touchAreaXShift=s==="left"?-c:c}super(t),this.customStrokeProperty=n}dispose(){this.customStrokeProperty&&this.customStrokeProperty.dispose(),super.dispose()}}sun.register("CarouselButton",CarouselButton);const DEFAULT_ARROW_SIZE=new Dimension2(20,7);class Carousel extends Node$2{constructor(e,t){var Z,W;let n=!1;const r=optionize()({orientation:"horizontal",fill:"white",stroke:"black",lineWidth:1,cornerRadius:4,defaultPageNumber:0,itemsPerPage:4,spacing:12,margin:6,alignBoxOptions:{phetioType:IndexedNodeIO,phetioState:!0,visiblePropertyOptions:{phetioFeatured:!0}},buttonOptions:{xMargin:5,yMargin:5,touchAreaXDilation:0,touchAreaYDilation:0,mouseAreaXDilation:0,mouseAreaYDilation:0,baseColor:"rgba( 200, 200, 200, 0.5 )",disabledColor:ColorConstants.LIGHT_GRAY,lineWidth:1,arrowPathOptions:{stroke:"black",lineWidth:3},arrowSize:DEFAULT_ARROW_SIZE,enabledPropertyOptions:{phetioReadOnly:!0,phetioFeatured:!1},soundPlayer:pushButtonSoundPlayer},separatorsVisible:!1,separatorOptions:{stroke:"rgb( 180, 180, 180 )",lineWidth:.5,pickable:!1},animationEnabled:!0,animationOptions:{duration:.4,stepEmitter:stepTimer,easing:Easing.CUBIC_IN_OUT},tandem:Tandem.OPTIONAL,visiblePropertyOptions:{phetioFeatured:!0}},t);super(),this.isAnimatingProperty=new BooleanProperty(!1),this.animationEnabled=r.animationEnabled,this.items=e,this.itemsPerPage=r.itemsPerPage,this.defaultPageNumber=r.defaultPageNumber;const s=Orientation.fromLayoutOrientation(r.orientation),a=new AlignGroup,h=r.tandem.createTandem("items");this.carouselItemNodes=getGroupItemNodes(e,h),this.alignBoxes=e.map((X,J)=>a.createBox(this.carouselItemNodes[J],combineOptions({tandem:X.tandemName?h.createTandem(X.tandemName):Tandem.OPTIONAL},r.alignBoxOptions,X.alignBoxOptions))),this.scrollingNode=new ScrollingFlowBox(this,{children:this.alignBoxes,orientation:r.orientation,spacing:r.spacing,[`${s.opposite.coordinate}Margin`]:r.margin}),this.visibleAlignBoxesProperty=DerivedProperty.deriveAny(this.alignBoxes.map(X=>X.visibleProperty),()=>this.getVisibleAlignBoxes()),this.scrollingNode.childrenReorderedEmitter.addListener(()=>this.visibleAlignBoxesProperty.recomputeDerivation());const c=combineOptions({cornerRadius:r.cornerRadius},r.buttonOptions);assert&&assert(r.spacing>=r.margin,"The spacing must be >= the margin, or you will see page 2 items at the end of page 1");const d=r.separatorsVisible?new Node$2({pickable:!1}):null,y=new Node$2({children:r.separatorsVisible?[d,this.scrollingNode]:[this.scrollingNode]}),g=X=>Math.max(Math.ceil(X.length/r.itemsPerPage),1);this.numberOfPagesProperty=new DerivedProperty([this.visibleAlignBoxesProperty],X=>g(X),{isValidValue:X=>X>0});const D=g(this.alignBoxes);assert&&assert(r.defaultPageNumber>=0&&r.defaultPageNumber<=this.numberOfPagesProperty.value-1,`defaultPageNumber is out of range: ${r.defaultPageNumber}`),this.pageNumberProperty=new NumberProperty(r.defaultPageNumber,{tandem:r.tandem.createTandem("pageNumberProperty"),numberType:"Integer",isValidValue:X=>X<this.numberOfPagesProperty.value&&X>=0,range:new Range(0,D-1),phetioFeatured:!0});const O=new DerivedProperty([this.numberOfPagesProperty],X=>X>1),V=new CarouselButton(combineOptions({arrowDirection:s===Orientation.HORIZONTAL?"right":"down",tandem:r.tandem.createTandem("nextButton"),listener:()=>this.pageNumberProperty.set(this.pageNumberProperty.get()+1),enabledProperty:new DerivedProperty([this.pageNumberProperty,this.numberOfPagesProperty],(X,J)=>X<J-1),visibleProperty:O},c)),k=new CarouselButton(combineOptions({arrowDirection:s===Orientation.HORIZONTAL?"left":"up",tandem:r.tandem.createTandem("previousButton"),listener:()=>this.pageNumberProperty.set(this.pageNumberProperty.get()-1),enabledProperty:new DerivedProperty([this.pageNumberProperty],X=>X>0),visibleProperty:O},c)),M=new Node$2({children:[y]}),N=new Rectangle({cornerRadius:r.cornerRadius,fill:r.fill}),F=new Rectangle({cornerRadius:r.cornerRadius,stroke:r.stroke,pickable:!1});this.carouselConstraint=new CarouselConstraint(this,N,F,M,k,V,y,this.alignBoxes,s,this.scrollingNode,this.itemsPerPage,r.margin,a,d,r.separatorOptions);let G=null;const ie=new Bounds2(0,0,0,0);Multilink.multilink([this.pageNumberProperty,y.localBoundsProperty],(X,J)=>{if(X>=this.numberOfPagesProperty.value)return;G&&G.stop();const oe=this.visibleAlignBoxesProperty.value[X*r.itemsPerPage],le=oe?-oe[s.minSide]+r.margin:0,pe=ie===null||!ie.equals(J);ie.set(J),this.animationEnabled&&!(isSettingPhetioStateProperty!=null&&isSettingPhetioStateProperty.value)&&n&&!pe?(G=new Animation(combineOptions({},r.animationOptions,{to:le,getValue:()=>y[s.coordinate],setValue:ve=>{y[s.coordinate]=ve}})),G.endedEmitter.addListener(()=>this.isAnimatingProperty.set(!1)),G.start(),this.isAnimatingProperty.value=!0):y[s.coordinate]=le}),this.visibleAlignBoxesProperty.link(()=>{this.pageNumberProperty.value=Math.min(this.pageNumberProperty.value,this.numberOfPagesProperty.value-1)}),r.children=[N,M,V,k,F],this.disposeCarousel=()=>{this.visibleAlignBoxesProperty.dispose(),this.pageNumberProperty.dispose(),this.alignBoxes.forEach(X=>{assert&&assert(X.children.length===1,"Carousel AlignBox instances should have only one child"),assert&&assert(this.carouselItemNodes.includes(X.children[0]),"Carousel AlignBox instances should wrap a content node"),X.dispose()}),this.scrollingNode.dispose(),this.carouselConstraint.dispose(),this.carouselItemNodes.forEach(X=>X.dispose())},this.mutate(r),n=!0,assert&&((W=(Z=phet==null?void 0:phet.chipper)==null?void 0:Z.queryParameters)!=null&&W.binder)&&InstanceRegistry.registerDataURL("sun","Carousel",this)}dispose(){this.disposeCarousel(),super.dispose()}reset(e=!1){const t=this.animationEnabled;this.animationEnabled=e,this.pageNumberProperty.value=Math.min(this.defaultPageNumber,this.numberOfPagesProperty.value-1),this.animationEnabled=t}scrollToItemVisibleIndex(e){this.pageNumberProperty.set(this.itemVisibleIndexToPageNumber(e))}scrollToItem(e){this.scrollToAlignBox(this.getAlignBoxForItem(e))}scrollToAlignBox(e){const t=this.visibleAlignBoxesProperty.value.indexOf(e);assert&&assert(t>=0,"item not present or visible"),t>=0&&this.scrollToItemVisibleIndex(t)}setItemVisible(e,t){this.getAlignBoxForItem(e).visible=t}getAlignBoxForItem(e){const t=this.alignBoxes[this.items.indexOf(e)];return assert&&assert(t,"item does not have corresponding alignBox"),t}getNodeForItem(e){const t=this.carouselItemNodes[this.items.indexOf(e)];return assert&&assert(t,"item does not have corresponding node"),t}itemVisibleIndexToPageNumber(e){return assert&&assert(e>=0&&e<this.items.length,`itemIndex out of range: ${e}`),Math.floor(e/this.itemsPerPage)}getVisibleAlignBoxes(){return _.sortBy(this.alignBoxes.filter(e=>e.visible),e=>this.scrollingNode.children.indexOf(e))}}class ScrollingFlowBox extends FlowBox{constructor(e,t){super(t),this.carousel=e}onIndexedNodeIOChildMoved(e){this.carousel.scrollToAlignBox(e)}}class CarouselConstraint extends LayoutConstraint{constructor(e,t,n,r,s,a,h,c,d,y,g,D,O,V,k){super(e),this.carousel=e,this.backgroundNode=t,this.foregroundNode=n,this.windowNode=r,this.previousButton=s,this.nextButton=a,this.scrollingNodeContainer=h,this.alignBoxes=c,this.orientation=d,this.scrollingNode=y,this.itemsPerPage=g,this.margin=D,this.alignGroup=O,this.separatorLayer=V,this.separatorOptions=k,[this.backgroundNode,this.foregroundNode,this.windowNode,this.previousButton,this.nextButton,this.scrollingNodeContainer,...this.alignBoxes].forEach(M=>this.addNode(M,!1)),this.separatorLayer&&this.scrollingNode.constraint.finishedLayoutEmitter.addListener(()=>{this.updateSeparators()}),this.updateLayout()}updateSeparators(){const e=this.carousel.getVisibleAlignBoxes(),t=e.length>=2?_.range(1,e.length):[];this.separatorLayer.children=t.map(n=>{const r=(e[n-1][this.orientation.maxSide]+e[n][this.orientation.minSide])/2;return new Separator(combineOptions({[`${this.orientation.coordinate}1`]:r,[`${this.orientation.coordinate}2`]:r,[`${this.orientation.opposite.coordinate}2`]:this.scrollingNode[this.orientation.opposite.size]},this.separatorOptions))})}computeClipArea(){const e=this.orientation,t=this.carousel.getVisibleAlignBoxes();if(t.length===0)return new Dimension2(0,0);{const n=t[this.itemsPerPage-1]||t[t.length-1],r=new Dimension2(n[e.maxSide]-t[0][e.minSide]+2*this.margin,this.scrollingNodeContainer.boundsProperty.value[e.opposite.size]);return this.orientation===Orientation.HORIZONTAL?r:r.swapped()}}getBackgroundDimension(){let e,t;if(this.orientation===Orientation.HORIZONTAL){const n=this.nextButton.visible?this.nextButton.width:0,r=this.previousButton.visible?this.previousButton.width:0;e=this.windowNode.width+n+r,t=this.windowNode.height}else{const n=this.nextButton.visible?this.nextButton.height:0,r=this.previousButton.visible?this.previousButton.height:0;e=this.windowNode.width,t=this.windowNode.height+n+r}return new Dimension2(e,t)}layout(){super.layout();const e=this.orientation,n=this.alignGroup.getMaxSizeProperty(e.opposite).value+2*this.margin;this.nextButton[e.opposite.preferredSize]=n,this.previousButton[e.opposite.preferredSize]=n,this.nextButton[e.opposite.centerCoordinate]=this.backgroundNode[e.opposite.centerCoordinate],this.previousButton[e.opposite.centerCoordinate]=this.backgroundNode[e.opposite.centerCoordinate],this.windowNode[e.opposite.centerCoordinate]=this.backgroundNode[e.opposite.centerCoordinate],this.previousButton[e.minSide]=this.backgroundNode[e.minSide],this.nextButton[e.maxSide]=this.backgroundNode[e.maxSide],this.windowNode[e.centerCoordinate]=this.backgroundNode[e.centerCoordinate];const r=this.computeClipArea().toBounds();this.windowNode.clipArea=Shape$1.bounds(r),this.windowNode.localBounds=r;const s=this.getBackgroundDimension();this.carousel.backgroundWidth=s.width,this.carousel.backgroundHeight=s.height;const a=s.toBounds();this.backgroundNode.rectBounds=a,this.foregroundNode.rectBounds=a,this.separatorLayer&&this.updateSeparators()}}sun.register("Carousel",Carousel);const SunConstants={VALUE_NAMED_PLACEHOLDER:"{{value}}",VALUE_NUMBERED_PLACEHOLDER:"{0}",SLIDER_VERTICAL_ROTATION:-Math.PI/2};sun.register("SunConstants",SunConstants);class NullSoundPlayer{play(){}stop(){}}const nullSoundPlayer=new NullSoundPlayer;tambo.register("nullSoundPlayer",nullSoundPlayer);const soundURI$5="data:audio/mpeg;base64,//swxAAAB5gnMzRhAAEHDWyDNLAAAAAaAQAu7tjAQAAABgMBgNNiBBAWD7ykMQf1g+D5/qBMHwfB/iAEPWCDv+o5wfPg+8EAQBMHz6gQB8Hwfsu2uWDrkw/a9xgUaMwFxxwCLsWS7MHN7VJki8fVT75eTqpn7/Xt1QxW//lJVbnfNuFRTzwrLn/5GVBnKMy/FVs5dTYABARKCMRm//syxAQACHBHWZ2kAAEJi+jxpg1Qlry2AYclVGyMwNoFJ29hqHqa1TRqRMCoetKstcqUzHBxQdCJmVcSJ/EQdEo0FXSoNLGkav/ljqPtEvjAoAE0zuEoM3lMJlLY3Uj65AMeMzQN6QWeLFdCcxLNFy4dBVXVfZ1L+gIki4KPQVBb4dERU6CrsFSoaLVHv/Ev9Hw4ANdAAG7VBBhVdP/7MsQFAAh8YybVowABG49vdx6AAm8ODBg8FDy9pmwIBsHPVGiPMueyERxZdIFnSpkzI8fezb+0z6OJVv7HHw7XBWdXwa6/y34l6sq7uitTjFTEgsFYrFQqFQDAGrQXMbpbb3ZGQWPWvTnyyeKKHgQ/nvlUf/u74oOHp/8v3R/dl/UcSXDz+kMBEHI0p5efiDJqb/64foFiBSWqB2r/+zLEA4AIVDlivZGAAQePKiWmDNhtwTYmBYyxnJdmZwmMtZ8ZjInEMMpo+VFWESqmhsWBoClhKKEhCW5UNPCsFVgqImyWS6KTAhEUrYoO7kaAWIJCwQzbgl5XrFBB27xoQwfnY6kozJtFz0SgICsWM3VIKWs6qr0tgI15/pQomHhblqjycRUCWe1dUOpxFOiJ/ooQC+IEEBlVdh0r//swxAUACGCjMy0kSsDoiCAA95gpQaBI041ceup5PSlsv5QNXMyixFLVkTXWpYUBYy/lEl4YCdWlLoZ//zGlKUBEhV0SiFT+us7WdBXqAbQ2hdxgDfH4RQsI+kgo2RnWVECiCa0TrUSNjalrUVVKyg0yapYqqVlRTNVLFf/2P/1qVadsTFKlitVMQU1FMy45OS4zVVVVVVVVVVVV",soundByteArray$5=base64SoundToByteArray(phetAudioContext$1,soundURI$5),unlock$5=asyncLoader.createLock(soundURI$5),wrappedAudioBuffer$5=new WrappedAudioBuffer;let unlocked$5=!1;const safeUnlock$5=()=>{unlocked$5||(unlock$5(),unlocked$5=!0)},onDecodeSuccess$5=o=>{wrappedAudioBuffer$5.audioBufferProperty.value===null&&(wrappedAudioBuffer$5.audioBufferProperty.set(o),safeUnlock$5())},onDecodeError$5=o=>{console.warn("decode of audio data failed, using stubbed sound, error: "+o),wrappedAudioBuffer$5.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$5()},decodePromise$5=phetAudioContext$1.decodeAudioData(soundByteArray$5.buffer,onDecodeSuccess$5,onDecodeError$5);decodePromise$5&&decodePromise$5.then(o=>{wrappedAudioBuffer$5.audioBufferProperty.value===null&&(wrappedAudioBuffer$5.audioBufferProperty.set(o),safeUnlock$5())}).catch(o=>{console.warn("promise rejection caught for audio decode, error = "+o),safeUnlock$5()});const generalCloseSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$5,{soundClipOptions:{initialOutputLevel:.4},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("generalCloseSoundPlayer",generalCloseSoundPlayer);const soundURI$4="data:audio/mpeg;base64,//swxAAABswbPzQxABEQFyzDMlAAAAGoGRIdz0AAARQAAAAAMCd5QEAxBA4sPlz/BAMfw+ooc8EA/EAYKAh/qBBYfwfD4jB/4nD98ZXetEKIxIqnuursF7pTGkY4dNYcaZhOjzgxDNndb75ggdCsIvV3qoeM9HIX215a6Hftuc5FhwFRhvuJuhxbMPp+ir0KlAaCTHVtZuCsLISS//syxAYACGhJXR2jABEVIGmw8YpieZwGg6y5/p6bf69uls4kMS9HVvrXl8hI5WPBY8FawqGh3PYlLA0HQm6ZHvUe/4UB4ChNzls1AZIAAxJNQMBOy4KAeSsL0QgRcxFInzpyhsQ6tvdvaM160ZnbY/2bY19dTlJVJmhrQpT/Vf0eVjfzG////6PMYzmtqJdg0WqADvRwaGDBgBO5T//7MsQFgAkEZSA1swABDRYvdx5QAhmAEZHdFc2HHLBy/LcmfqWvq1yftVsQSJAxzSi25i5w6qqvMy/cjgNSoKu2Q1LHp1S4NCJQsHfLUSINPxK6oxocyIhmMRkMhQAQBuyhLerW2u5zoV4af2nULcHzwOiPxQjFU/nvIyflMKARabfnQqGI/v/FAIV6UJnPAgAca//9NZUgFEnVWuP/+zLEA4AIVL1vnYQAEQkIajDMpMja7T9a7DL+uzSEg2RRajlNmUzFPCBtL7Uyoa/iVlabnj1+Pi9f61X5WuJ9V1XhkOmtYltLGPI1//8s/0PMAKmLuWQPy0Hrh0Uy4C5MCaWoC5bwOjrQpVOQIn9JNDksr2zEBLvAp3LCI8Is9BX1FTsS50j5Us8OCIqEg73ZZ9QByyIAiddlUPU0//swxAUCSEyXLMywatDDBOHA8zBIRfBtlFDU3P7EItHsWE51WgaTVpJLPMzOMYE1qUSth4pRSd1WkZLqqrnGPUobBm4oDUDHol//+rJBUlwL0rYuAoOSuFITEsfTp5a46IhKRBQ6FQkBQCWJESR0KhIeNASKGnsJgJCf///1VUxBTUUzLjk5LjNVVVVVVVVVVVVVVVVVVVVVVVVV",soundByteArray$4=base64SoundToByteArray(phetAudioContext$1,soundURI$4),unlock$4=asyncLoader.createLock(soundURI$4),wrappedAudioBuffer$4=new WrappedAudioBuffer;let unlocked$4=!1;const safeUnlock$4=()=>{unlocked$4||(unlock$4(),unlocked$4=!0)},onDecodeSuccess$4=o=>{wrappedAudioBuffer$4.audioBufferProperty.value===null&&(wrappedAudioBuffer$4.audioBufferProperty.set(o),safeUnlock$4())},onDecodeError$4=o=>{console.warn("decode of audio data failed, using stubbed sound, error: "+o),wrappedAudioBuffer$4.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$4()},decodePromise$4=phetAudioContext$1.decodeAudioData(soundByteArray$4.buffer,onDecodeSuccess$4,onDecodeError$4);decodePromise$4&&decodePromise$4.then(o=>{wrappedAudioBuffer$4.audioBufferProperty.value===null&&(wrappedAudioBuffer$4.audioBufferProperty.set(o),safeUnlock$4())}).catch(o=>{console.warn("promise rejection caught for audio decode, error = "+o),safeUnlock$4()});const generalOpenSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$4,{soundClipOptions:{initialOutputLevel:.4},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("generalOpenSoundPlayer",generalOpenSoundPlayer);class ComboBoxListItemNode extends Voicing(Node$2){constructor(e,t,n,r,s,a){const h=optionize()({cursor:"pointer",align:"left",xMargin:6,highlightFill:"rgb( 245, 245, 245 )",highlightCornerRadius:4,tagName:"li",focusable:!0,ariaRole:"option",positionInPDOM:!0,voicingFocusListener:()=>this.comboBoxListItemNodeVoicingFocusListener(),comboBoxVoicingNameResponsePattern:SunConstants.VALUE_NAMED_PLACEHOLDER,tandem:Tandem.REQUIRED,tandemNameSuffix:"Item",phetioType:IndexedNodeIO,phetioState:!0,visiblePropertyOptions:{phetioFeatured:!0}},a);h.comboBoxVoicingNameResponsePattern=h.comboBoxVoicingNameResponsePattern.get?h.comboBoxVoicingNameResponsePattern.get():h.comboBoxVoicingNameResponsePattern,assert&&assert(!!phet.chipper.queryParameters.stringTest||h.comboBoxVoicingNameResponsePattern.includes("{{value}}"),"value needs to be filled in");const c=new Rectangle({cornerRadius:h.highlightCornerRadius}),d=new Node$2({children:[t]}),y=F=>{c.rectWidth=F,d.maxWidth=F};r.link(y);const g=F=>{c.rectHeight=F,d.maxHeight=F};s.link(g);const D=()=>{h.align==="left"?d.left=c.left+h.xMargin:h.align==="right"?d.right=c.right-h.xMargin:d.centerX=c.centerX,d.centerY=c.centerY};d.boundsProperty.lazyLink(D),D(),h.children=[c,d],super(h),this._supplyOpenResponseOnNextFocus=!1;const O=new DerivedProperty([n],F=>F||""),V=typeof h.comboBoxVoicingNameResponsePattern=="string"?new Property(h.comboBoxVoicingNameResponsePattern):h.comboBoxVoicingNameResponsePattern,k=new PatternStringProperty(V,{value:O},{tandem:Tandem.OPT_OUT});this.voicingNameResponse=k;const M=F=>{this.innerContent=F,this.voicingObjectResponse=F};n.link(M),this.item=e,this.localBoundsProperty.link(F=>{this.focusHighlight=Shape$1.bounds(F)});const N=new PressListener({attach:!1,tandem:Tandem.OPT_OUT});this.addInputListener(N),N.looksOverProperty.link(F=>{c.fill=F?h.highlightFill:null}),this.disposeComboBoxListItemNode=()=>{N.dispose(),k.dispose(),O.dispose(),n.unlink(M),r.unlink(y),s.unlink(g)}}supplyOpenResponseOnNextFocus(){this._supplyOpenResponseOnNextFocus=!0}dispose(){this.disposeComboBoxListItemNode(),super.dispose()}comboBoxListItemNodeVoicingFocusListener(){this.voicingSpeakFullResponse({nameResponse:this._supplyOpenResponseOnNextFocus?this.voicingNameResponse:null,objectResponse:this._supplyOpenResponseOnNextFocus?null:this.voicingObjectResponse,contextResponse:null,hintResponse:this._supplyOpenResponseOnNextFocus?this.voicingHintResponse:null}),this._supplyOpenResponseOnNextFocus=!1}}sun.register("ComboBoxListItemNode",ComboBoxListItemNode);const ALIGN_VALUES$3=["left","center","right"],DEFAULT_OPTIONS={fill:"white",stroke:"black",lineWidth:1,lineDash:[],xMargin:5,yMargin:5,cornerRadius:10,resize:!0,backgroundPickable:!0,excludeInvisibleChildrenFromBounds:!0,align:"left",minWidth:0,minHeight:0};assert&&Object.freeze(DEFAULT_OPTIONS);const An=class An extends Sizable(Node$2){constructor(e,t){const n=optionize3()({},DEFAULT_OPTIONS,t);assert&&assert(_.includes(ALIGN_VALUES$3,n.align),`invalid align: ${n.align}`),super(),this._content=e,this._backgroundContainer=new Node$2,this._background=new Rectangle(0,0,1,1,{lineWidth:n.lineWidth,pickable:n.backgroundPickable,lineDash:n.lineDash,cornerRadius:n.cornerRadius}),this.setStroke(n.stroke),this.setFill(n.fill),this.addChild(this._backgroundContainer),this.addChild(e),this.constraint=new PanelConstraint(this,n),this.constraint.updateLayout(),this.constraint.enabled=n.resize,this.mutate(n)}getStroke(){return this._background.stroke}get stroke(){return this.getStroke()}set stroke(e){this.setStroke(e)}setStroke(e){this._background.stroke=e,this.constraint&&this.constraint.updateLayoutAutomatically()}getFill(){return this._background.fill}get fill(){return this.getFill()}set fill(e){this.setFill(e)}setFill(e){this._background.fill=e}setExcludeInvisibleChildrenFromBounds(e){super.setExcludeInvisibleChildrenFromBounds(e),this.constraint.updateLayoutAutomatically()}};An.DEFAULT_PANEL_OPTIONS=DEFAULT_OPTIONS;let Panel=An;class PanelConstraint extends LayoutConstraint{constructor(e,t){super(e),this.panel=e,assert&&assert(typeof t.minWidth=="number","Panel minWidth should be a number"),assert&&assert(typeof t.xMargin=="number","Panel xMargin should be a number"),assert&&assert(typeof t.yMargin=="number","Panel yMargin should be a number"),assert&&assert(typeof t.lineWidth=="number","Panel lineWidth should be a number"),assert&&assert(ALIGN_VALUES$3.includes(t.align),`Panel align should be one of ${ALIGN_VALUES$3}`),this.minWidth=t.minWidth,this.minHeight=t.minHeight,this.xMargin=t.xMargin,this.yMargin=t.yMargin,this.lineWidth=t.lineWidth,this.align=t.align,this.panel.localPreferredWidthProperty.lazyLink(this._updateLayoutListener),this.panel.localPreferredHeightProperty.lazyLink(this._updateLayoutListener),this.addNode(e._content)}layout(){super.layout();const e=this.panel,t=e._content,n=e._background,r=e.stroke===null?0:this.lineWidth,s=e.isChildIncludedInLayout(t);if(e._backgroundContainer.children=s?[n]:[],!s){e.localMinimumWidth=null,e.localMinimumHeight=null;return}const a=isWidthSizable(t)&&t.minimumWidth!==null?t.minimumWidth:t.width,h=isHeightSizable(t)&&t.minimumHeight!==null?t.minimumHeight:t.height,c=Math.max(this.minWidth,a+2*this.xMargin)+r,d=Math.max(this.minHeight,h+2*this.yMargin)+r,y=Math.max(c,e.localPreferredWidth||0),g=Math.max(d,e.localPreferredHeight||0);isWidthSizable(t)&&e.localPreferredWidth!==null&&(t.preferredWidth=y-r-2*this.xMargin),isHeightSizable(t)&&e.localPreferredHeight!==null&&(t.preferredHeight=g-r-2*this.yMargin),n.setRect(0,0,y-r,g-r),this.align==="center"?t.center=n.center:this.align==="left"?(t.left=n.centerX-n.rectWidth/2+this.xMargin,t.centerY=n.centerY):(t.right=n.centerX+n.rectWidth/2-this.xMargin,t.centerY=n.centerY),e.localMinimumWidth=c,e.localMinimumHeight=d}dispose(){this.panel.localPreferredWidthProperty.unlink(this._updateLayoutListener),this.panel.localPreferredHeightProperty.unlink(this._updateLayoutListener),super.dispose()}}sun.register("Panel",Panel);class ComboBoxListBox extends Panel{constructor(e,t,n,r,s,a,h,c,d){assert&&assert(t.length>0,"empty list box is not supported");const y=optionize()({highlightFill:"rgb( 245, 245, 245 )",comboBoxListItemNodeOptions:{},xMargin:12,yMargin:8,backgroundPickable:!0,tagName:"ul",ariaRole:"listbox",groupFocusHighlight:!0,openedSoundPlayer:generalOpenSoundPlayer,closedNoChangeSoundPlayer:generalCloseSoundPlayer,visiblePropertyOptions:{phetioReadOnly:!0}},d);assert&&assert(y.xMargin>0&&y.yMargin>0,`margins must be > 0, xMargin=${y.xMargin}, yMargin=${y.yMargin}`);const g=new PhetioAction$1(W=>{const X=W.currentTarget;assert&&assert(X instanceof ComboBoxListItemNode,"expected a ComboBoxListItemNode"),this.selectionOnFireAction=X;const J=e.value;a(),e.value=this.selectionOnFireAction.item.value,s(),this.voiceOnNewSelection(e.value,J,X),W.abort()},{parameters:[{phetioPrivate:!0,valueType:SceneryEvent}],tandem:c.createTandem("fireAction"),phetioEventType:EventType.USER}),D={up(W){g.execute(W)},keyup:W=>{W.domEvent&&KeyboardUtils.isAnyKeyEvent(W.domEvent,[KeyboardUtils.KEY_ENTER,KeyboardUtils.KEY_SPACE])&&g.execute(W)},click:W=>{g.execute(W)}},O=ComboBox.getMaxItemWidthProperty(n),V=ComboBox.getMaxItemHeightProperty(n),k=new DerivedProperty([O],W=>W+y.xMargin),M=new DerivedProperty([V],W=>W+y.yMargin),N=[];t.forEach((W,X)=>{const J=r.get(W.value);assert&&assert(J);const oe=new ComboBoxListItemNode(W,n[X],J,k,M,combineOptions({align:y.align,highlightFill:y.highlightFill,highlightCornerRadius:y.cornerRadius,xMargin:.5*y.xMargin,tandem:W.tandemName?c.createTandem(W.tandemName):Tandem.OPTIONAL},y.comboBoxListItemNodeOptions,W.comboBoxListItemNodeOptions));N.push(oe),oe.addInputListener(D)});const F=new VBox({spacing:0,excludeInvisibleChildrenFromBounds:!0,children:N});super(F,combineOptions({},y,{xMargin:y.xMargin/2,yMargin:y.yMargin/2})),this.content=F,this.voiceOnSelectionNode=h,this.selectionOnFireAction=this.getListItemNode(e.value);const G=t.map(W=>multiSelectionSoundPlayerFactory.getSelectionSoundPlayer(t.indexOf(W)));let ie;this.visibleProperty.lazyLink(W=>{if(W)y.openedSoundPlayer.play(),ie=this.getListItemNode(e.value);else if(assert&&assert(ie,"no Node for when list box was opened"),ie===this.selectionOnFireAction)y.closedNoChangeSoundPlayer.play();else{const X=this.selectionOnFireAction.item;if(X.soundPlayer)X.soundPlayer.play();else{const J=this.getVisibleListItemNodes().indexOf(this.selectionOnFireAction);J!==-1&&G[J].play()}}});const Z=new KeyboardListener({keys:["escape","tab","shift+tab","arrowUp","arrowDown","home","end"],callback:(W,X)=>{const J=W;assert&&assert(J,"event is required for this listener");const oe=this.getVisibleListItemNodes();if(X==="escape"||X==="tab"||X==="shift+tab")J.abort(),s(),a();else if(X==="arrowUp"||X==="arrowDown"){const le=J.domEvent;assert&&assert(le,"domEvent is required for this listener"),le.preventDefault();const pe=X==="arrowDown"?1:-1,ve=oe.indexOf(this.getFocusedItemNode());assert&&assert(ve>-1,"how could we receive keydown without a focused list item?");const Oe=ve+pe;oe[Oe]&&oe[Oe].focus(),J.pointer.reserveForKeyboardDrag()}else X==="home"?oe[0].focus():X==="end"&&oe[oe.length-1].focus()}});this.addInputListener(Z),this.disposeComboBoxListBox=()=>{for(let W=0;W<N.length;W++)N[W].dispose();this.removeInputListener(Z),Z.dispose(),g.dispose(),O.dispose(),V.dispose()}}dispose(){this.disposeComboBoxListBox(),super.dispose()}setItemVisible(e,t){this.getListItemNode(e).visible=t}isItemVisible(e){return this.getListItemNode(e).visible}getAllListItemNodes(){return this.content.children}getVisibleListItemNodes(){return this.getAllListItemNodes().filter(e=>e.visible)}getListItemNode(e){const t=_.find(this.getAllListItemNodes(),n=>n.item.value===e);return assert&&assert(t,`no item found for value: ${e}`),assert&&assert(t instanceof ComboBoxListItemNode,"invalid listItemNode"),t}getFocusedItemNode(){const e=_.find(this.getAllListItemNodes(),t=>t.focused);return assert&&assert(e,"no item found that has focus"),assert&&assert(e instanceof ComboBoxListItemNode,"invalid listItemNode"),e}focusListItemNode(e){let t=this.getListItemNode(e);t.visible||(t=_.find(this.getAllListItemNodes(),n=>n.visible)),t&&(t.supplyOpenResponseOnNextFocus(),t.focus())}voiceOnNewSelection(e,t,n){const r={nameResponse:n.voicingNameResponse,objectResponse:null,contextResponse:n.voicingContextResponse,hintResponse:null};t===e&&(r.contextResponse=null),this.voiceOnSelectionNode.voicingSpeakResponse(r)}}sun.register("ComboBoxListBox",ComboBoxListBox);const LIST_POSITION_VALUES=["above","below"],ALIGN_VALUES$2=["left","right","center"],ITEM_TANDEM_NAME_SUFFIX="Item",ACCESSIBLE_NAME_BEHAVIOR$1=(o,e,t,n)=>(n.push(()=>{o.button.accessibleName=t}),e),HELP_TEXT_BEHAVIOR=(o,e,t,n)=>(n.push(()=>{o.button.helpText=t}),e),qi=class qi extends WidthSizable(Node$2){constructor(e,t,n,r){var c,d;assert&&assert(_.uniqBy(t,y=>y.value).length===t.length,"items must have unique values"),assert&&t.forEach(y=>{assert&&assert(!y.tandemName||y.tandemName.endsWith(ITEM_TANDEM_NAME_SUFFIX),`ComboBoxItem tandemName must end with '${ITEM_TANDEM_NAME_SUFFIX}': ${y.tandemName}`)}),assert&&assert(n.maxWidth===null,"ComboBox is responsible for scaling listBox. Setting maxWidth for listParent may result in buggy behavior.");const s=optionize()({align:"left",listPosition:"below",labelXSpacing:10,disabledOpacity:.5,cornerRadius:4,highlightFill:"rgb( 245, 245, 245 )",xMargin:12,yMargin:8,buttonFill:"white",buttonStroke:"black",buttonLineWidth:1,buttonTouchAreaXDilation:0,buttonTouchAreaYDilation:0,buttonMouseAreaXDilation:0,buttonMouseAreaYDilation:0,listFill:"white",listStroke:"black",listLineWidth:1,openedSoundPlayer:generalOpenSoundPlayer,closedNoChangeSoundPlayer:generalCloseSoundPlayer,tagName:"div",buttonLabelTagName:"p",accessibleNameBehavior:ACCESSIBLE_NAME_BEHAVIOR$1,helpTextBehavior:HELP_TEXT_BEHAVIOR,comboBoxVoicingNameResponsePattern:SunConstants.VALUE_NAMED_PLACEHOLDER,comboBoxVoicingContextResponse:null,comboBoxVoicingHintResponse:null,tandem:Tandem.REQUIRED,tandemNameSuffix:"ComboBox",phetioType:qi.ComboBoxIO,phetioFeatured:!0,phetioEventType:EventType.USER,visiblePropertyOptions:{phetioFeatured:!0},phetioEnabledPropertyInstrumented:!0},r),a=getGroupItemNodes(t,s.tandem.createTandem("items"));assert&&a.forEach(y=>{assert&&assert(!y.hasPDOMContent,"Accessibility is provided by ComboBoxItemNode and ComboBoxItem.a11yLabel. Additional PDOM content in the provided Node could break accessibility.")}),assert&&assert(s.xMargin>0&&s.yMargin>0,`margins must be > 0, xMargin=${s.xMargin}, yMargin=${s.yMargin}`),assert&&assert(_.includes(LIST_POSITION_VALUES,s.listPosition),`invalid listPosition: ${s.listPosition}`),assert&&assert(_.includes(ALIGN_VALUES$2,s.align),`invalid align: ${s.align}`),super(),this.nodes=a,this.a11yNamePropertyMap=qi.getA11yNamePropertyMap(t),this.listPosition=s.listPosition,this.button=new ComboBoxButton(e,t,a,this.a11yNamePropertyMap,{align:s.align,arrowDirection:s.listPosition==="below"?"down":"up",cornerRadius:s.cornerRadius,xMargin:s.xMargin,yMargin:s.yMargin,baseColor:s.buttonFill,stroke:s.buttonStroke,lineWidth:s.buttonLineWidth,touchAreaXDilation:s.buttonTouchAreaXDilation,touchAreaYDilation:s.buttonTouchAreaYDilation,mouseAreaXDilation:s.buttonMouseAreaXDilation,mouseAreaYDilation:s.buttonMouseAreaYDilation,localPreferredWidthProperty:this.localPreferredWidthProperty,localMinimumWidthProperty:this.localMinimumWidthProperty,comboBoxVoicingNameResponsePattern:s.comboBoxVoicingNameResponsePattern,labelTagName:s.buttonLabelTagName,tandem:s.tandem.createTandem("button")}),this.addChild(this.button),this.listBox=new ComboBoxListBox(e,t,a,this.a11yNamePropertyMap,this.hideListBox.bind(this),()=>{this.button.blockNextVoicingFocusListener(),this.button.focus()},this.button,s.tandem.createTandem("listBox"),{align:s.align,highlightFill:s.highlightFill,xMargin:s.xMargin,yMargin:s.yMargin,cornerRadius:s.cornerRadius,fill:s.listFill,stroke:s.listStroke,lineWidth:s.listLineWidth,visible:!1,comboBoxListItemNodeOptions:{comboBoxVoicingNameResponsePattern:s.comboBoxVoicingNameResponsePattern,voicingContextResponse:s.comboBoxVoicingContextResponse,voicingHintResponse:s.comboBoxVoicingHintResponse},openedSoundPlayer:s.openedSoundPlayer,closedNoChangeSoundPlayer:s.closedNoChangeSoundPlayer,ariaLabelledbyAssociations:[{otherNode:this.button,otherElementName:PDOMPeer$1.LABEL_SIBLING,thisElementName:PDOMPeer$1.PRIMARY_SIBLING}]}),n.addChild(this.listBox),this.listParent=n;const h=new MatrixBetweenProperty(this.button,this.listParent,{fromCoordinateFrame:"parent",toCoordinateFrame:"local"});Multilink.multilink([h,this.button.localBoundsProperty,this.listBox.localBoundsProperty],y=>{this.scaleAndPositionListBox(y)}),this.opacityProperty.link(y=>{this.listBox.opacityProperty.value=y}),this.mutate(s),assert&&Tandem.VALIDATION&&this.isPhetioInstrumented()&&t.forEach(y=>{assert&&assert(y.tandemName!==null,`PhET-iO instrumented ComboBoxes require ComboBoxItems to have tandemName: ${y.value}`)}),this.button.addListener(()=>{this.listBox.visibleProperty.value=!this.listBox.visibleProperty.value,this.listBox.visibleProperty.value&&this.listBox.focusListItemNode(e.value)}),this.display=null,this.clickToDismissListener={down:y=>{(!phet.chipper.isFuzzEnabled()||dotRandom.nextDouble()<.005)&&(y.trail.containsNode(this.button)||y.trail.containsNode(this.listBox)||this.hideListBox())}},this.dismissWithFocusListener=y=>{y&&!y.trail.containsNode(this.listBox)&&this.hideListBox()},FocusManager.pdomFocusProperty.link(this.dismissWithFocusListener),this.listBox.visibleProperty.link(y=>{y?(this.scaleListBox(),this.listBox.moveToFront(),assert&&assert(!this.display,"unexpected display"),this.display=this.getUniqueTrail().rootNode().getRootedDisplays()[0],this.display.addInputListener(this.clickToDismissListener)):this.display&&this.display.hasInputListener(this.clickToDismissListener)&&(this.display.removeInputListener(this.clickToDismissListener),this.display=null)}),this.displayOnlyProperty=new BooleanProperty(!1,{tandem:s.tandem.createTandem("displayOnlyProperty"),phetioFeatured:!0,phetioDocumentation:"disables interaction with the ComboBox and makes it appear like a display that shows the current selection"}),this.displayOnlyProperty.link(y=>{this.hideListBox(),this.button.setDisplayOnly(y),this.pickable=!y}),this.addLinkedElement(e,{tandemName:"property"}),this.disposeComboBox=()=>{h.dispose(),this.display&&this.display.hasInputListener(this.clickToDismissListener)&&this.display.removeInputListener(this.clickToDismissListener),FocusManager.pdomFocusProperty.unlink(this.dismissWithFocusListener),this.displayOnlyProperty.dispose(),this.listBox.dispose(),this.button.dispose(),a.forEach(y=>y.dispose())},assert&&((d=(c=phet==null?void 0:phet.chipper)==null?void 0:c.queryParameters)!=null&&d.binder)&&InstanceRegistry.registerDataURL("sun","ComboBox",this)}dispose(){this.disposeComboBox(),super.dispose()}showListBox(){this.listBox.visibleProperty.value=!0}hideListBox(){this.listBox.visibleProperty.value=!1}scaleListBox(){if(!this.listBox.localBounds.isEmpty()){const e=this.button.localToGlobalBounds(this.button.localBounds).width/this.button.localBounds.width,t=this.listBox.localToGlobalBounds(this.listBox.localBounds).width/this.listBox.localBounds.width;this.listBox.scale(e/t)}}scaleAndPositionListBox(e){e&&(this.scaleListBox(),this.listPosition==="above"?this.listBox.leftBottom=e.timesVector2(this.button.leftTop):this.listBox.leftTop=e.timesVector2(this.button.leftBottom))}setItemVisible(e,t){this.listBox.setItemVisible(e,t)}isItemVisible(e){return this.listBox.isItemVisible(e)}static getMaxItemWidthProperty(e){const t=_.flatten(e.map(n=>{const r=[n.boundsProperty];return extendsWidthSizable(n)&&(r.push(n.isWidthResizableProperty),r.push(n.minimumWidthProperty)),r}));return DerivedProperty.deriveAny(t,()=>Math.max(...e.map(n=>isWidthSizable(n)?n.minimumWidth||0:n.width)),{strictAxonDependencies:!1})}static getMaxItemHeightProperty(e){const t=e.map(n=>n.boundsProperty);return DerivedProperty.deriveAny(t,()=>Math.max(...e.map(n=>n.height)),{strictAxonDependencies:!1})}static getA11yNamePropertyMap(e){const t=new Map;return e.forEach(n=>{let r;isTReadOnlyProperty(n.a11yName)?r=n.a11yName:typeof n.a11yName=="string"?r=new TinyProperty(n.a11yName):r=new TinyProperty(null),t.set(n.value,r)}),t}};qi.ComboBoxIO=new IOType("ComboBoxIO",{valueType:qi,documentation:"A combo box is composed of a push button and a listbox. The listbox contains items that represent choices. Pressing the button pops up the listbox. Selecting from an item in the listbox sets the value of an associated Property. The button shows the item that is currently selected.",supertype:Node$2.NodeIO,events:["listBoxShown","listBoxHidden"]});let ComboBox=qi;sun.register("ComboBox",ComboBox);const ALIGN_VALUES$1=["left","center","right"],ARROW_DIRECTION_VALUES=["up","down"],ACCESSIBLE_NAME_BEHAVIOR=(o,e,t)=>(e.labelContent=t,e);class ComboBoxButton extends RectangularPushButton{constructor(e,t,n,r,s){const a=optionize()({align:"left",arrowDirection:"down",arrowFill:"black",comboBoxVoicingNameResponsePattern:SunConstants.VALUE_NAMED_PLACEHOLDER,cursor:"pointer",baseColor:"white",buttonAppearanceStrategy:ButtonNode.FlatAppearanceStrategy,xMargin:12,yMargin:8,stroke:"black",lineWidth:1,soundPlayer:nullSoundPlayer,enabledPropertyOptions:{phetioFeatured:!1},visiblePropertyOptions:{phetioFeatured:!1},localPreferredWidthProperty:new TinyProperty(null),localMinimumWidthProperty:new TinyProperty(null),containerTagName:"div",labelTagName:"p",accessibleNameBehavior:ACCESSIBLE_NAME_BEHAVIOR},s);assert&&assert(_.includes(ALIGN_VALUES$1,a.align),`invalid align: ${a.align}`),assert&&assert(_.includes(ARROW_DIRECTION_VALUES,a.arrowDirection),`invalid arrowDirection: ${a.arrowDirection}`);const h=a.xMargin,c=a.yMargin,d=ComboBox.getMaxItemWidthProperty(n),y=ComboBox.getMaxItemHeightProperty(n),g=new Path(null,{fill:a.arrowFill}),D=_.find(t,Z=>Z.value===e.value),O=t.indexOf(D),V=new Node$2({layoutOptions:{yMargin:c,grow:1,xAlign:a.align},children:[n[O]]}),k=new Line(0,0,0,0,{stroke:"black",lineWidth:a.lineWidth});a.content=new GridBox({rows:[[V,k,g]]}),Multilink.multilink([d,y],(Z,W)=>{const X=W+2*c,J=X,oe=.35*J,le=2*oe*Math.sqrt(3)/3,pe=h,ve=h-a.lineWidth/2,Oe=-a.lineWidth/2,He=(Ue,Le,Ae)=>Ue==="up"?new Shape$1().moveTo(0,Ae).lineTo(Le/2,0).lineTo(Le,Ae).close():new Shape$1().moveTo(0,0).lineTo(Le,0).lineTo(Le/2,Ae).close();g.shape=He(a.arrowDirection,le,oe),g.mutateLayoutOptions({minContentWidth:J,minContentHeight:J}),V.mutateLayoutOptions({minContentWidth:Z,minContentHeight:W,leftMargin:pe,rightMargin:ve}),k.y2=X,k.mutateLayoutOptions({rightMargin:Oe})}),a.xMargin=0,a.yMargin=0,super(a),this.minimumWidthProperty.link(Z=>{a.localMinimumWidthProperty.value=Z});const M=Z=>{this.preferredWidth=Z};a.localPreferredWidthProperty.link(M),this._blockNextVoicingFocusListener=!1,this.voicingFocusListener=()=>{!this._blockNextVoicingFocusListener&&this.defaultFocusListener(),this._blockNextVoicingFocusListener=!1};let N=null;const F=new DerivedProperty([e],Z=>{const W=_.find(t,X=>X.value===Z);return assert&&assert(W,`no item found for value: ${Z}`),W}),G=new DerivedProperty([F],Z=>n[t.indexOf(Z)]),ie=new DynamicProperty(F,{derive:Z=>r.get(Z.value)});G.link(Z=>{V.removeAllChildren(),V.addChild(Z)}),ie.link(Z=>{this.innerContent=Z;const W=typeof a.comboBoxVoicingNameResponsePattern=="string"?new Property(a.comboBoxVoicingNameResponsePattern):a.comboBoxVoicingNameResponsePattern;N&&N.dispose(),this.voicingNameResponse=N=new PatternStringProperty(W,{value:Z||""},{tandem:Tandem.OPT_OUT})}),this.ariaLabelledbyAssociations=[{otherNode:this,otherElementName:PDOMPeer$1.LABEL_SIBLING,thisElementName:PDOMPeer$1.PRIMARY_SIBLING},{otherNode:this,otherElementName:PDOMPeer$1.PRIMARY_SIBLING,thisElementName:PDOMPeer$1.PRIMARY_SIBLING}],AriaHasPopUpMutator.mutateNode(this,"listbox"),this.disposeComboBoxButton=()=>{d.dispose(),y.dispose(),F.dispose(),a.localPreferredWidthProperty.unlink(M),N&&N.dispose()},this.arrow=g,this.separatorLine=k}setDisplayOnly(e){this.arrow.visible=!e,this.separatorLine.visible=!e}blockNextVoicingFocusListener(){this._blockNextVoicingFocusListener=!0}dispose(){this.disposeComboBoxButton(),super.dispose()}}sun.register("ComboBoxButton",ComboBoxButton);class PageControl extends Node$2{constructor(e,t,n){const r=optionize()({interactive:!1,orientation:"horizontal",dotRadius:3,lineWidth:1,dotSpacing:10,dotTouchAreaDilation:4,dotMouseAreaDilation:4,currentPageFill:"black",currentPageStroke:null,pageFill:"rgb( 200, 200, 200 )",pageStroke:null,tandem:Tandem.REQUIRED,tandemNameSuffix:"PageControl",visiblePropertyOptions:{phetioFeatured:!0}},n);assert&&assert(LayoutOrientationValues.includes(r.orientation),`invalid orientation=${r.orientation}`);const s=new PressListener({press:g=>{g.currentTarget instanceof DotNode&&(e.value=g.currentTarget.pageNumber)},tandem:r.tandem.createTandem("pressListener")}),a={lineWidth:r.lineWidth,mouseArea:r.dotMouseAreaDilation===0?null:Shape$1.circle(0,0,r.dotRadius+r.dotMouseAreaDilation),touchArea:r.dotTouchAreaDilation===0?null:Shape$1.circle(0,0,r.dotRadius+r.dotTouchAreaDilation),boundsMethod:"unstroked",cursor:r.interactive?"pointer":null,inputListeners:r.interactive?[s]:[]},h=new FlowBox({orientation:r.orientation,spacing:r.dotSpacing});let c=[];h.boundsProperty.link(()=>{h.center=Vector2.ZERO});const d=g=>{c.forEach(D=>{D.fill=g===D.pageNumber?r.currentPageFill:r.pageFill,D.stroke=g===D.pageNumber?r.currentPageStroke:r.pageStroke})};e.link(d);const y=g=>{assert&&assert(g>=1),c=_.range(0,g).map(D=>new DotNode(D,r.dotRadius,a)),h.children=c,d(e.value)};t.link(y),r.children=[h],super(r),this.disposePageControl=()=>{s.dispose(),t.unlink(y),e.unlink(d)}}dispose(){this.disposePageControl(),super.dispose()}}class DotNode extends Circle{constructor(e,t,n){super(t,n),this.pageNumber=e}}sun.register("PageControl",PageControl);class CarouselComboBox extends WidthSizable(Node$2){constructor(e,t,n){const r=optionize()({itemNodeOptions:{align:"left",overColor:Color.grayColor(245),selectedColor:"yellow",xMargin:6,yMargin:2},carouselOptions:{buttonOptions:{arrowSize:new Dimension2(20,4)},orientation:"vertical",spacing:0,margin:0,itemsPerPage:15},pageControlOptions:{interactive:!0},buttonOptions:{arrowDirection:"down",baseColor:"rgb( 218, 236, 255 )",xMargin:6,yMargin:4},tandem:Tandem.OPTIONAL},n);assert&&assert(r.carouselOptions.orientation==="vertical","orientation must be vertical"),assert&&assert(r.buttonOptions.arrowDirection==="down","arrowDirection must be down"),r.carouselOptions.itemsPerPage=Math.min(r.carouselOptions.itemsPerPage,t.length),r.carouselOptions.tandem=r.carouselOptions.tandem||r.tandem.createTandem("carousel"),r.buttonOptions.tandem=r.buttonOptions.tandem||r.tandem.createTandem("button"),super(),this.a11yNamePropertyMap=ComboBox.getA11yNamePropertyMap(t);const s=new AlignGroup,a=getGroupItemNodes(t,r.tandem.createTandem("items")),h=_.map(t,(N,F)=>({createNode:()=>new CarouselItemNode(e,N,a[F],s,r.itemNodeOptions)}));assert&&assert(h.length===t.length,"expected a carouselItem for each comboBoxItem");const c=[],d=new Carousel(h,r.carouselOptions);c.push(d);let y=null;d.numberOfPagesProperty.value>1&&(y=new PageControl(d.pageNumberProperty,d.numberOfPagesProperty,combineOptions({orientation:r.carouselOptions.orientation},r.pageControlOptions)),c.push(y));const g=new HBox({spacing:4,children:c}),D=new ComboBoxButton(e,t,a,this.a11yNamePropertyMap,combineOptions({listener:()=>{g.visible=!g.visible},widthSizable:r.widthSizable,localPreferredWidthProperty:this.localPreferredWidthProperty,localMinimumWidthProperty:this.localMinimumWidthProperty},r.buttonOptions)),O=new VBox({spacing:0,align:"left",children:[D,g]});r.children=[O],this.mutate(r);const V=()=>{g.visible=!1};e.link(V);const k={down:N=>{if(assert&&assert(d.visible,"this listener should be registered only when carousel is visible"),!phet.chipper.isFuzzEnabled()||dotRandom.nextDouble()<.25){const F=N.trail;!F.containsNode(D)&&!F.containsNode(d)&&(!y||!F.containsNode(y))&&(g.visible=!1)}}};let M=null;g.visibleProperty.link(N=>{N?(assert&&assert(!M,"unexpected display"),M=this.getUniqueTrail().rootNode().getRootedDisplays()[0],M.addInputListener(k)):M&&M.hasInputListener(k)&&(M.removeInputListener(k),M=null)}),this.disposeCarouselComboBox=()=>{e.unlink(V),D.dispose(),y&&y.dispose(),d.dispose(),a.forEach(N=>N.dispose())}}dispose(){this.disposeCarouselComboBox(),super.dispose()}}class CarouselItemNode extends Node$2{constructor(e,t,n,r,s){const a=optionize()({align:"left",xMargin:6,yMargin:2,overColor:Color.grayColor(245),selectedColor:"yellow",tandem:Tandem.OPTIONAL},s),h=new AlignBox(n,{xAlign:a.align,group:r}),c=new Rectangle(0,0,1,1);h.boundsProperty.link(g=>{c.setRectBounds(g.dilatedXY(a.xMargin,a.yMargin))}),a.children=[c,h],super(a);const d=new PressListener({press:()=>{e.value=t.value},tandem:a.tandem.createTandem("pressListener")});this.addInputListener(d);const y=new Multilink([e,d.isOverProperty],(g,D)=>{g===t.value?c.fill=a.selectedColor:D?c.fill=a.overColor:c.fill="transparent"});this.disposeCarouselItemNode=()=>{y.dispose()}}dispose(){this.disposeCarouselItemNode(),super.dispose()}}sun.register("CarouselComboBox",CarouselComboBox);const checkEmptySolidShape=new Shape$1("M1120 1280h-832q-66 0 -113 -47t-47 -113v-832q0 -66 47 -113t113 -47h832q66 0 113 47t47 113v832q0 66 -47 113t-113 47zM1408 1120v-832q0 -119 -84.5 -203.5t-203.5 -84.5h-832q-119 0 -203.5 84.5t-84.5 203.5v832q0 119 84.5 203.5t203.5 84.5h832 q119 0 203.5 -84.5t84.5 -203.5z").makeImmutable(),checkSquareOSolidShape=new Shape$1("M1408 606v-318q0 -119 -84.5 -203.5t-203.5 -84.5h-832q-119 0 -203.5 84.5t-84.5 203.5v832q0 119 84.5 203.5t203.5 84.5h832q63 0 117 -25q15 -7 18 -23q3 -17 -9 -29l-49 -49q-10 -10 -23 -10q-3 0 -9 2q-23 6 -45 6h-832q-66 0 -113 -47t-47 -113v-832 q0 -66 47 -113t113 -47h832q66 0 113 47t47 113v254q0 13 9 22l64 64q10 10 23 10q6 0 12 -3q20 -8 20 -29zM1639 1095l-814 -814q-24 -24 -57 -24t-57 24l-430 430q-24 24 -24 57t24 57l110 110q24 24 57 24t57 -24l263 -263l647 647q24 24 57 24t57 -24l110 -110 q24 -24 24 -57t-24 -57z").makeImmutable(),soundURI$3="data:audio/mpeg;base64,//twxAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAARAAAWCgAPDw8PDx4eHh4eHi0tLS0tLTw8PDw8PEtLS0tLS1paWlpaWmlpaWlpaXh4eHh4eIeHh4eHlpaWlpaWpaWlpaWltLS0tLS0w8PDw8PD0tLS0tLS4eHh4eHh8PDw8PDw//////8AAAA3TEFNRTMuOThyAc0AAAAAAAAAABRgJAZTQgAAYAAAFgoMxGP1AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/7cMQAAA7gbOxVvYACW5Fntz3AA5QAAyAQIBEys3MtCTFFg5TGPm8D3KgDTJuEccMxAZkMFHzKy0ykhAROIho0JQOFfTbU8iRzFi4zYwMgBiUFMRDxoHLdpJtwSEMGBAMAKWRFL8swriCVA0i2X2oxYpIxKJZScr2+g+8oCBQ5//5cP////y4P/y4fgEAoFAoFArLYAAAAAAMDYCMx+k2DAeA6MFEIcGgkCIdk1vDGDNcO0Mt0zUwRA+DC3HiMGkE03THtDaEMoMFkBAwKgmzBaBoMAgB8+fQzksxMVigyANDAggAQJN9mcHA4kFpgsEJllrRoCrC05kkQjR0MTisME7eQcphFoRHX7nUoy4CvF0UrhPiwWUy2x/P/PDDn/jLuqAGAAwDcEMMCHBhjCbwtwwKoHpMM+Ev/+3LECwNSzIkWXf2ACj+QoEXu5SkzE0he0zdxYLM8SH/zF7hbcxLcKaMHFCGjA5wQ0wSoE1MK+B4zAZAMwwDwDJMATAJjAxgRc1J/MpODbWY3W8MeEjJxMAAiO5iZUAhUFAIqBAUiEh4OCQSGGHArEVNUyE8wYKmTDJZl8pVXx5IYtUr673fO8xs0t7Ptb8bKV8UnuCIwTR2DLDFMMHUaMyDhPDIsI8M4ME00OMfT/wfHOBoKcxZUYjP9nDXBIzYicDQuIjXdjAyITWM0DiVnjL4Gza8sjHUVTPsCDQw/wMRJhEBZiGHIYMQkLaKoVCMsAmkcYk5vHm0AIAwSGW2TdCGTMcMMCMLyVipZcplALqSm/DURt95nlTdZjvOYyWrK46xN9WogBoCswawJDJACtMW4KExLSlDBsP/7cMQKABFIgQI17gASa5Mjaz3QAE3NLvnQ3agRDJ+DSMbgYExaABTE4EHMFIM4wwBnzAWAVMBYMAwgwkjBjDYNAKwyiLzEKxPMXsGB80aSkKDAQoMWgYtinyYmCYwER4ElzUrDHIBWSrc/T4pDAoBCwVZK7mOFNL3Wh2NUzOn6m+548/kht9JTqojAAAAEgMQKAAAAAAMA8A4wNw8DAgA9MMUIcQhtmGeEGYMAu5gnAomMSHcYCYNBkVBSmS+F8YBgAgGBJMHEU0xtw/zDiLVMxpn4xFAlAGbDnGZJgUfrl2aOjomK8jJwUMhgGABhAFRgKCwUAAu8k437py0SDRp6lj8Bgoski0Ff+++iWkItSgfwrAOkgGWY5f//9ne//7luZoyn9dUFRgAAwIBIw5CYxaOMxUGsxfH/+3LECQNQPJcafd4AGmmS38XvaShMaMQ29Y4HAKZcCMZWigIzAMzxoCgAmHoLiMUTLISzNunD5V0TlJYNXoQzCHBY5jACC4TFgiporE9rpO005iSiseWg60bdWG2ove12Uw7EwqDm/fmUQfYtQ1TWX9eWHZbQWm53a2WrVWZlFN+rfqa0QwzxGjEDGKMJIO8x+AJDCjO1MnMPU5+nqzFkYHM2I20x3iHDBzC1MLsZsxoAeTD9CsMMos8zVDZTN7EePxtJIxYgyDGTB+MPIHowBgGTADBbMMwC8wdAHQgAQwVwPlFxQBAwLQIhICgSXHCUCJKDiKuU7VAVVa7EVuui/6eCOSJLoN/GpSyzj/3aWls7w7EMufvur0t//tfyepULAAMFIm0wPA7iZsMxzQnjI4CXMkIcc3s5sP/7cMQNA1L0jPxPeylKLhGfRe7lKDdTH5GhojDABOMIkYUwNAuTGYGZMKEnMw5RgzDsMvEZsZsuJMGB0IUYbAIphfgdGA+DCYBQfxg1gImBWBMEAOBYBwwDQDk+ESQCASVEjLWMJA2YUAyFiirR2rNnEhGJxRfAMVSYa/K2uxFLZyY9ALryyBa31mHYXsse6+il0QwGAzDEVK6Mc4xQ1IgzDF9B6Npko4yElYDF9IGMnoGwzaSlzxAXzJ51TMYUjdJ8DBIajEz7j4TjDtTFTBaNDKoJjJgVzEJnjFgLzHoWzDQMkaw4TjCgBWmR1ahgHmUObQZ8uBw7/U0NqvX+pi6cMMwCwctZS8lLVXbAUvfaFYaw18B8s95/3a1C+7SqDQADDyGiMrE1QybhITRuVZMKYroyWRTTQ3b/+3LEDQNTCH74T3tJQjOQHwXu5Si1MVYJYyuCnTBmGJMjAKYxKBBjIpHGMVQW4wSBIzHZFRMfdJYzSWXjBrIzMVMOowVQNDBMBfMGAIgGgSmB+AQYB4BKSpgOgCl60STAJAMSVLUGTUnWAwajZPLzVYFySQT3UkGQ6NCofaHDjAkvl+bVW7N37Eb21jAJBdgiffpIYRJMhhFhymNmUUYqY/ZjKjymScW8Y71jZoaoamSqPyY/g7ZnyZZqs8ZmwAx0bSJoXG5vMPJqs3p0j/Jw9JBnWLZq8XZiURphEEQADswVAYwFAQOBwFCwVgaYCAmFADBzYWVPRM3HVLKFzKN0gqUzemZ08y1KNesWma1u3LoakFNh3fx+zpihGmJDu/TVMLUYcyLB+zDTE/M1MgwxgQCTATHNNNW0U//7cMQMg9AYfPgPdylB/o+fQe7hKIkx/DKxKGMy0GoxzTkzcQUzPL00cgQxnZE2mVszgdQzBtM+2AUoKExLAIw9BowtB4w1AQwBBdwQCAxgcCaM4YBCYYkcYQhmxEb0NsmWO6CQ7cnlzmGVwfbmMrP37m5XO///yImYwX+swEB1zFWAWMc8awx9hSzC7C6MewRQ0GiZTadBbMQIRAwOwDTKlXTF1CTLoWjNlbjABMDFJpTCYtT8PIjhwBjDoOAcWhhEEBiCHBhKAwCBAKgqYCgQEAE10MAWSgU5QMG7DnqBsEbG9bNYam3/ksqrXI7d3nQ473nqxvWM8fyYgQolAAMEiHMj0fMTBTM7hoMvhYM9yoMQfQONUNMoiqMESlMJ8AIwfgbzBJBwMMUUUwjAUysDkwNhdDQWDAP/+3LEHgNPbHz+TvsJQeIP30nu4SgDEBEgBhMCgFkwEwEgMBaYAwBCsZWAQzoeAFh9oDBosWZZ0LTk0NOtK5evtb8vns4frSrDV6rhn3mX/zKODLkHIYMQCZgYhqmFwEcYzALBhAg4mG8CAYlrfxg7BhGKuICYF4LBiUM5g8BQMJEzID40bL0xKLYwMmw4t98yiHgzdD8CDkYIBekWYFgqVQAAoAMrCArac7zC5UWADFYMl8ifyiVpZWwyXwywCVyOzey1PX9V/z//1H/TAAAI4AAETSCErTTotzbsTzLs7TNkMzIS0D/pmDHkmTGkczAbByMI0DcwRwAjCZGUMH4AYwoAJjAVFvNh8TgwgASQIAgYHQMpgFgSIIjAXACFgCYeVgMAQBqILBBYAFpTPXTJwz0sdqHWvJOiSP/7cMQ2g0+4fPsu+wlB2Y+eye7hKIdobk7bu6z+13Udv///8x+mpDCjDRMUgCYwUwpDANDLMGcOowyg2jOzJmN+IQoxdAhzDyCdMICkARmmCgImaagmVALmeBoGE+hn+zWGW4/GFgpGG4qFA7jIXiwhLbXYyUKAfF0BSwCg46JXxma6jiKft27aeM5Fnpj1q9Pd/LDOknsP/907tSpADB2CLMPQNoxExQTBCD0MLUPlQwxUOHTr4OtMWsSQwjwjzEJI+AgbpgECSmL0IiYPIIphSAIjxVJu+FmmIeDMYRYOJhPgJGCMBmYB4EpgSAIgoBNEhpw4Ak7jJYAjTP0bAkOG4Dzjj+kISMEUfaki+/1hnhVxgrX//fsv+iBgajjmG8RwZrYgRjCClGBKOgYxwnZii/hmhECgY3z/+3LETgNPqHzuL3spQe2PnYXvYSgNZheg4GK8BOYSgNJhJCIGCQUAYCYMpgyBvmFccYamYOZgDBbhA8RMD4YKYFxgfgWkQDqJCMsFmAUAWrC2VlqYMsCswKppandmgl6WiSMtrfH8prP+5f2anP5//TUwVAaDD0CMMJweQwjQ9jAPBtMvkZk1ysPTdxSzMVkN4xXBYjFLFDHhJTC/BeMYkdUweAJTDKDOMWMc020wDDGGBYMJ8NgweQSUEBgTAamA6AqWRDACBYC0OAebm7ZaFbzgraK/MkcnCWwIl8pvUlUkoMovLcua7lE6L9/rGzQgwLhcTGACZMPoSwEAXmNoDKY/QtJpKfGH4mMuYdw4piNgkGMMBmsa8mOQmmd0OmT6tmD7PASyzt60jOIOzEgHjGAnzKYTTBEOwP/7cMRkA0/EfOgPewlJ4Y4che7hKaAxg2AZECwqApaCgaQLAE8CM5bM3BjTW4arsXJTj45+WRmmvYyigzx3qryX6TVVMAZAtjBIATMwaQB5MB7CmzBlwMgwVcG0MIsQsjIeQ9QwpA7zFxFcMJcBgw8QODBTBGMGoi4w5wlzDcDdMNgHQ06iITGJC2MCcAowBgYDBBAkMe3O4bQOeswgMSROo+8Rd52mMDQuRvhHbcWbq+dqhxm+WrEsAq7n7PIBgBhcmCsB8YaRRphEgWGMiEuYCojRn886GkoJEZ8l4ZoCQa8EmZokiYXg4ZrmwFx5MBQpMvnYP9XXMFCJMVQjMDCRDhKB4o/AEVAwQEGjoC+0AJZ9Whn4OGBTTfNq/EYmmFvf8vuV+3QKIrtLdaoABVmL0GMYzAsRkaD/+3LEeoJPGGLmD/tHCb2MHNnu5ODaGIuDSY9As5uSpwH1AV+BmHjCfE2M2ZQgyTyBgADSYxJWJiCCQmNgEEYgY6hjqo8GEoD2YAYNRg4BtGA4BKdKeCuwsPZ8ieX/WBLiIPqfGQCyVPWoTCI7C4S92FBjSfjcv48++FWulxdwaYAgAdGBYA0Bg+QY+YPOEsGBOAxpggAd6YPSpJmSmAyRgUoBYYH6ATmIKAeYeQmBhABYmVMFaYfQDJiiAxmLsPIZoiwZj+hhiEAwwIASxgA9WQwHgGFBEbEQCsAxhiKy5VXNhEKUAbzyCVU0AxqeszFypzeV+1lUxp/t1eoAQGKQAAwLgljEMBsMhsagwog9DDKAXBAThoRXkmn2R+YLwbhiKDKGPmKUYbAsZgeBOGLuPAYH4JZgdClGJv/7cMSYg87UbNwPe0cJ7o4bAf9hKeN4bVoJ5gtARGA+BwYAYGRg2gYGA2B4VAGwMA4UAByVWFyXtL+xAOqqsAlPplTVneeFaleIT1bDDLDWe/ufoMFUFgwDwxTAlClMAcW8xICNzCmCZM3pz86SyWjJYgzJQNjRiDTAoADJ0kzRIwTIIsTSAdzETNTQ7cjJADDNwLzDUJjAcIFTgLraA5zbN+2zTmVJjNTVmguE/uNS6XNBnPx3YuXbOG96rEXWOs//1f3p///7v0P6qgC4AFgSzBcDvMO8TIeJiBwPBgXhhGCO5QbAYRxi0J5ngVxhyaJkMDhh2HBieeIWGQzlCgwaOM/SmMz1A8xgDMAhMYWBSNZLRLxsK9a64KlrDKr0srbaUz+FmWtJbXH9739l1bm1ffH7f3JV3fv/+3LEsQBPmHDbL3sJQd4N2oHu4OD///X///fpIBBgLAWGCIHaYZgK5g5ATmCSC0YeIZBjkq5GU6LUZykMTGUYWjMYijEYIhcYFhIYNgSZDhKZBPMcfjuNBEUEEAhFUZJwSdMl9JaOKz5DjqhvcvHsVxjMbjCAqV6+9lyLbLv3a0X6ESHnjmkrTgX6ewW628bWpy6aAAAEIBKAAYVGgQJzEA7MHBAeERhQBG6YsEF4lDMeEoCAUYKgI6ZVAYEguZjC2ZGtMcWpghOAQLKNr1LwVPu2Wuurc61Zm1tOXWe/o1tDZJ5cXoLq47k/vbkMSqQ57UHqbUISVThclJqqsAa1V3dqUsXjENcTVSBUCQHmLDZKQCFtO+lwC+DVGKFZhA8Ck5ACX2THBAR54Dl4c+jQuNtZdZ7rPuOGX//7cMTJAk6AYtSvdwcB3graIe684Jd3Kc5TLcMqa1j+V2z++ZfljKYdvVqa/VlNNTWpkJR7VjzOVVd5NBQlGc8z5NIkUcNIozLbzkcqq84/8kUcf1PnK74dLEkq30DAFGtNIonJMclvNIy5wMFJGkUZk4lppFE4ldVr+qreaiclZEjO/scSJEtxTEFNRTMuOTguM6qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqCQACQKKEgQswmgpKTiyiyizTjSizDzDy2eLzc/ypo0osoCEihIoDEA5BDcqWco0FBgUUBgQsQLAzjSizDzDy2drzcqpo0ov/+3LE5QJOoF7PjnWHApQz1oW8mbkoso404so8w+GdnZ4tv//+7VNSUWUWUKEihIELECxAoSBFmHxcNebNGlFmnCRQkCFiBYkUJFAYgWIFgZRZRZh5h9VVVUUJppI1VUxBTUUzLjk4LjNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7cMS2A9IFejpDGM3IAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVU=",soundByteArray$3=base64SoundToByteArray(phetAudioContext$1,soundURI$3),unlock$3=asyncLoader.createLock(soundURI$3),wrappedAudioBuffer$3=new WrappedAudioBuffer;let unlocked$3=!1;const safeUnlock$3=()=>{unlocked$3||(unlock$3(),unlocked$3=!0)},onDecodeSuccess$3=o=>{wrappedAudioBuffer$3.audioBufferProperty.value===null&&(wrappedAudioBuffer$3.audioBufferProperty.set(o),safeUnlock$3())},onDecodeError$3=o=>{console.warn("decode of audio data failed, using stubbed sound, error: "+o),wrappedAudioBuffer$3.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$3()},decodePromise$3=phetAudioContext$1.decodeAudioData(soundByteArray$3.buffer,onDecodeSuccess$3,onDecodeError$3);decodePromise$3&&decodePromise$3.then(o=>{wrappedAudioBuffer$3.audioBufferProperty.value===null&&(wrappedAudioBuffer$3.audioBufferProperty.set(o),safeUnlock$3())}).catch(o=>{console.warn("promise rejection caught for audio decode, error = "+o),safeUnlock$3()});const checkboxCheckedSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$3,{soundClipOptions:{initialOutputLevel:.7},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("checkboxCheckedSoundPlayer",checkboxCheckedSoundPlayer);const soundURI$2="data:audio/mpeg;base64,//swxAAAB3BPLHWkgAEQCy03MPADAYAEAMYCIAZnV5vYJv2ZoxqgRhBhkBBkRJhwZa9g7/tbYe1+jC4beogQMZ4Z5zn7mgQQdxOH//////6SQAIzbNJJdtgAAAAAAHjcV2B1EBJLBB4wV9rCWp5eq0EHE43FpgLhkjdNEqGhFqhSQlQ4TwqZdZ7fN/Hm6YKiu/33NoUAACApAAAI//syxAOCSGxzQ123gDkDjCZJvLDmDQ0HhMRgBVEjBws2OIM9Cky1VU0REAhgK47nqWwHAkIYcB7ePHvXeo2cV1nG4uL6rjXjzXt951bbjQs/hQuyxEeFQaEGUgRohuYvQkhIfrBnlFyQoUla/qMye4qGxUqjhxTJIFPCOfamTewcOH2SkYCFVa21OLZrySygx+bV4B1xgBhA1DB0Bf/7MsQFAAfISyw1x4AxL4ssNzGAAigYRigH0YoI18mGQKOgZ+FY0UWnyRsLJgZYCShStOpdQYKdeV5/q9jbIDYPkLAYtiTETvrZLIYEb2u2uogAAAAAAhkChusjjbfkXleOGpiySKjhjUIlMla3JEsHQqgBs2ns50DIPtDIgjJE46JnUPRPPPOG5G8/yKxQADAZFTP1KgAAIX0AGkv/+zLEA4IIRJ9DPaUAMQuN5o2tmYqinck4ucZbhxEBHFls3WFfhr6dyvz3zgxEmEABChAREwQIwJRfc1jx6QHFWNNqQkrG5wvNNbdf1b//kxUACACHIGAlgmUgpccbebl+BkKCZXQyCAwpKkwRUzEk7AIAwgTBahUNNHisAuFoYmM12rXbbUJ2v5Cwa++fDf///+mgDERUoJgUemjg//swxAUDSExLJi3phxEQCmQBrbx0BkCOdSyG/xxiJyFwYUOAZiABRh0Zh64k8Pj7NAJTjWFStFgyvxBK5IhTLDstCt9Y/SAqpLqiYU1gRqYoIfCMbtwYtoG77YMaQdBGoPhoQOPIxjIsCrswBnOHTzqNAI9TIQEiAQc0oSX9JssKWBt5O9HJA8fEWBHxeXEQzXUAKsQAXwMjEM3O//syxAUCSDxVLM1lJzEbCWPFrmxBNqHM4RC+k5ZUzwUcEaSmKZZCdwJRBNZkJiwDdFN36YdSqdqUT6pYDZ5ScxSDVfZPSpL8M//b6NxDNtjDhTpxDmMDKQMMw1k08tNDTxrGMKLQxRDCMevDKlACBZi1WYsoiEOBwEwdI9e0vdBptNKZfgzJsVH29qtOpUET8k9v4mAAAExTEHgUKP/7MsQEggfQUyJNc0QA2AklmY2YpukjMG6N4KPFG4xmOjdBnIQqBgcbgGQGmcNGdaHtBQplqcsNdnbkroa0zXiUXxyr9wz/WF9usagQAkSHDHulGU3DjA44xIgQwADplHVAGUl7G/MbPAcXSMAgRGUSoN9OUp+zGuLf///V3//+ugKcCSTofFaj5oNcoyUgyJfAIDMwsQBGeEBQiGf/+zLEDgJHUD8UDOksQN6F39wxsAA60sBDGHr5bR5oZBEMkscKhnEIJPCh6j//////+n6AmBgKjhFZNEIgmCyGD2UQjAVEweC2peqxVyOIpL/WDXZ7cNcFTtQdJCEFQVGLPFgaUHJ6dhojDlVttOCJU4BB0qsXplV/tncqptv/p//+n//6abf////9QTTTTRVV9UEJK0kIixWmqoc///swxBiDxvgCi4CEYAgAADSAAAAE/1TTVEWK6UxBTUUzLjk5LjNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",soundByteArray$2=base64SoundToByteArray(phetAudioContext$1,soundURI$2),unlock$2=asyncLoader.createLock(soundURI$2),wrappedAudioBuffer$2=new WrappedAudioBuffer;let unlocked$2=!1;const safeUnlock$2=()=>{unlocked$2||(unlock$2(),unlocked$2=!0)},onDecodeSuccess$2=o=>{wrappedAudioBuffer$2.audioBufferProperty.value===null&&(wrappedAudioBuffer$2.audioBufferProperty.set(o),safeUnlock$2())},onDecodeError$2=o=>{console.warn("decode of audio data failed, using stubbed sound, error: "+o),wrappedAudioBuffer$2.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$2()},decodePromise$2=phetAudioContext$1.decodeAudioData(soundByteArray$2.buffer,onDecodeSuccess$2,onDecodeError$2);decodePromise$2&&decodePromise$2.then(o=>{wrappedAudioBuffer$2.audioBufferProperty.value===null&&(wrappedAudioBuffer$2.audioBufferProperty.set(o),safeUnlock$2())}).catch(o=>{console.warn("promise rejection caught for audio decode, error = "+o),safeUnlock$2()});const checkboxUncheckedSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$2,{soundClipOptions:{initialOutputLevel:.7},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("checkboxUncheckedSoundPlayer",checkboxUncheckedSoundPlayer);const BOOLEAN_VALIDATOR={valueType:"boolean"},SHAPE_MATRIX=m3(.025,0,0,0,-.025,0,0,0,1),uncheckedShape=checkEmptySolidShape.transformed(SHAPE_MATRIX),checkedShape=checkSquareOSolidShape.transformed(SHAPE_MATRIX);class Checkbox extends WidthSizable(Voicing(Node$2)){constructor(e,t,n){var g,D;const r=optionize()({spacing:5,boxWidth:21,checkboxColor:"black",checkboxColorBackground:"white",touchAreaXDilation:0,touchAreaYDilation:0,mouseAreaXDilation:0,mouseAreaYDilation:0,checkedSoundPlayer:checkboxCheckedSoundPlayer,uncheckedSoundPlayer:checkboxUncheckedSoundPlayer,phetioLinkProperty:!0,cursor:"pointer",disabledOpacity:SceneryConstants.DISABLED_OPACITY,tandem:Tandem.REQUIRED,tandemNameSuffix:"Checkbox",phetioEventType:EventType.USER,visiblePropertyOptions:{phetioFeatured:!0},phetioEnabledPropertyInstrumented:!0,phetioReadOnly:PhetioObject.DEFAULT_OPTIONS.phetioReadOnly,phetioFeatured:!0,tagName:"input",inputType:"checkbox",appendDescription:!0,voicingCheckedObjectResponse:null,voicingUncheckedObjectResponse:null,checkedContextResponse:null,uncheckedContextResponse:null,voiceNameResponseOnSelection:!0},n);super(),this._isMouseAreaCustomized=!1,this._isTouchAreaCustomized=!1,this._isSettingAreas=!1;const s=new PhetioAction$1(()=>{e.value=!e.value,validate(e.value,BOOLEAN_VALIDATOR),e.value?(r.checkedSoundPlayer.play(),r.checkedContextResponse&&this.alertDescriptionUtterance(r.checkedContextResponse),this.voicingSpeakResponse({nameResponse:r.voiceNameResponseOnSelection?this.voicingNameResponse:null,objectResponse:Utterance.alertableToText(r.voicingCheckedObjectResponse),contextResponse:Utterance.alertableToText(r.checkedContextResponse)})):(r.uncheckedSoundPlayer.play(),r.uncheckedContextResponse&&this.alertDescriptionUtterance(r.uncheckedContextResponse),this.voicingSpeakResponse({nameResponse:r.voiceNameResponseOnSelection?this.voicingNameResponse:null,objectResponse:Utterance.alertableToText(r.voicingUncheckedObjectResponse),contextResponse:Utterance.alertableToText(r.uncheckedContextResponse)}))},{parameters:[],tandem:r.tandem.createTandem("toggleAction"),phetioDocumentation:"Emits when user input causes the checkbox to toggle, emitting a single arg: the new boolean value of the checkbox state.",phetioReadOnly:!0,phetioEventType:EventType.USER});this.backgroundNode=new Rectangle(0,-r.boxWidth,r.boxWidth*.95,r.boxWidth*.95,r.boxWidth*.2,r.boxWidth*.2,{fill:r.checkboxColorBackground}),this.uncheckedNode=new Path(uncheckedShape,{fill:r.checkboxColor});const a=r.boxWidth/this.uncheckedNode.width;this.uncheckedNode.scale(a),this.checkedNode=new Path(checkedShape,{scale:a,fill:r.checkboxColor});const h=new Node$2({children:[this.backgroundNode,this.checkedNode,this.uncheckedNode]}),c=new Rectangle({});this.children=[h,t,c],this.constraint=new CheckboxConstraint(this,h,this.checkedNode,t,c,r),this.constraint.updateLayout(),t.pickable=!1,t.pdomVisible=!1;const d=new FireListener({fire:()=>s.execute(),tandem:r.tandem.createTandem("fireListener")});this.addInputListener(d);const y=O=>{this.checkedNode.visible=O,this.uncheckedNode.visible=!O,this.pdomChecked=O};e.link(y),this.mutate(r),this.setExcludeLabelSiblingFromInput(),r.phetioLinkProperty&&this.addLinkedElement(e,{tandemName:"property"}),assert&&((D=(g=phet==null?void 0:phet.chipper)==null?void 0:g.queryParameters)!=null&&D.binder)&&InstanceRegistry.registerDataURL("sun","Checkbox",this),this.disposeCheckbox=()=>{c.dispose(),this.backgroundNode.dispose(),this.uncheckedNode.dispose(),this.checkedNode.dispose(),h.dispose(),d.dispose(),e.hasListener(y)&&e.unlink(y),s.dispose()}}dispose(){this.constraint.dispose(),this.disposeCheckbox(),super.dispose()}setCheckboxColorBackground(e){this.backgroundNode.fill=e}set checkboxColorBackground(e){this.setCheckboxColorBackground(e)}get checkboxColorBackground(){return this.getCheckboxColorBackground()}getCheckboxColorBackground(){return this.backgroundNode.fill}setCheckboxColor(e){this.checkedNode.fill=this.uncheckedNode.fill=e}set checkboxColor(e){this.setCheckboxColor(e)}get checkboxColor(){return this.getCheckboxColor()}getCheckboxColor(){return this.checkedNode.fill}setMouseArea(e){return this._isSettingAreas||(this._isMouseAreaCustomized=!0),super.setMouseArea(e)}setTouchArea(e){return this._isSettingAreas||(this._isTouchAreaCustomized=!0),super.setTouchArea(e)}}class CheckboxConstraint extends LayoutConstraint{constructor(e,t,n,r,s,a){super(e),this.checkbox=e,this.checkboxNode=t,this.checkedNode=n,this.content=r,this.rectangle=s,this.options=a,this.checkbox.localPreferredWidthProperty.lazyLink(this._updateLayoutListener),this.addNode(r)}layout(){super.layout();const e=this.createLayoutProxy(this.content),t=e.minimumWidth,n=this.checkedNode.right-this.checkboxNode.left,r=n+this.options.spacing+t,s=Math.max(r,this.checkbox.localPreferredWidth||0);isWidthSizable(this.content)&&this.checkbox.localPreferredWidth!==null&&(e.preferredWidth=s-n-this.options.spacing),e.left=this.checkedNode.right+this.options.spacing,e.centerY=this.checkedNode.centerY,this.rectangle.rectBounds=this.checkboxNode.bounds.union(e.bounds).withMaxX(Math.max(this.checkboxNode.left+s,e.right)),this.checkbox._isSettingAreas=!0,this.checkbox._isTouchAreaCustomized||(this.checkbox.touchArea=this.checkbox.localBounds.dilatedXY(this.options.touchAreaXDilation,this.options.touchAreaYDilation)),this.checkbox._isMouseAreaCustomized||(this.checkbox.mouseArea=this.checkbox.localBounds.dilatedXY(this.options.mouseAreaXDilation,this.options.mouseAreaYDilation)),this.checkbox._isSettingAreas=!1,e.dispose(),this.checkbox.localMinimumWidth=r}dispose(){this.checkbox.localPreferredWidthProperty.unlink(this._updateLayoutListener),super.dispose()}}sun.register("Checkbox",Checkbox);class ClosestDragForwardingListener{constructor(e,t){this.touchThreshold=e,this.mouseThreshold=t,this.items=[]}addDraggableItem(e){this.items.push(e)}removeDraggableItem(e){const t=_.indexOf(this.items,e);assert&&assert(t>=0),this.items.splice(t,1)}down(e){if(e.target===e.currentTarget){let t=0;if(e.pointer.isTouchLike()&&(t=this.touchThreshold),e.pointer instanceof Mouse&&(t=this.mouseThreshold),t){let n=null,r=Number.POSITIVE_INFINITY;const s=e.pointer.point,a=this.items.length;for(let h=0;h<a;h++){const c=this.items[h],d=c.computeDistance(s);d<r&&(r=d,n=c)}n&&r<t&&n.startDrag(e)}}}}sun.register("ClosestDragForwardingListener",ClosestDragForwardingListener);const soundURI$1="data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA//tAwAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAAJAAAIpwB1dXV1dXV1dXV1dZmZmZmZmZmZmZmZt7e3t7e3t7e3t7fDw8PDw8PDw8PDw8/Pz8/Pz8/Pz8/P29vb29vb29vb29vn5+fn5+fn5+fn5/Pz8/Pz8/Pz8/Pz//////////////8AAAAATGF2YzU4LjU0AAAAAAAAAAAAAAAAJAaRAAAAAAAACKfAKvQnAAAAAAD/+9DEAAAOsE9AdZGAK8QbJPc/sEAAG+3c2nDeiOKI2kELTFZOe88bTlVNYoyijKIMQAuIoIxCHLCJXfiAAGBu7u7iwAAQAAAAPH/+hH//+Hh63//h///9Dw//wAHfmHh/+AAH/HDw//AAB2YeHh48AAAAARh4eHjwAAAABGHh4ePAAAAAEYeHh72AAAAAAgIGjKTaAgAAADF5zj41poBnMb3YuDrZ4lswWUT3NCZKkDBJA0IwPgKfMOfCCjBCwXEwfcFTMAZAMjBZAUkwToD3MJ5BHTAtQIwwN8BSIAB8wl6OBagd3mygBhQ4n2aSoGCCpjg+gjBRXLFBUc1FzFBNYIwECT6EgFQMwcYTWZjN8zetdqYr7OMFgASAmvSFbsCMnsyt5YaiLuxmtTc/Ln/zm//y5y5WusNhprzDsst/vn/////VpZTWppVVpaVWt/g0FQVEQVDSu75URBUFREDIKiK5SrP+FQVFAqCpYKgqIgqCoiCoBn+ANTNR9Qnf9QDAyCTMLwPkxiiMzLantMFUFgwBQFzBSBZMAwB1N9D5KowGweiYA8hABLigQAMtuqACgChABghQCoWEwjHHYoeynK7nyOIUWogYdzEPeXRdf/93EzSTPHHzdMvNVURcJrMu1Qn/yNHvOCiTPVcKZ4Jd9aABgZgAGFwCOYpoYBuSTunDGJWAjEDwXoedDHUcykRMOEDRvUyRGWss9DxDsKiq+hoGL/NJcyHaV/WqS10Lj8m4fUgtKwEoz9xzkxTEUiPXSxWZg8dR1MVNFsKnGcb1jVESp/JeehYdKA2B2gsgofDp8OxYwIUg8P0rqp1pfay9SxSMKU/20LvtQgAGPd/rRAMCcC4wNgWTA1E4MctvY19w9jCOB7NS+MOCMKOeAEiDu1gUDLJKSXk1ouM2Jk0RipZHIGzYkvmJZaBsU3Gzw4XvWPBcfkXD2A4lzobX9zU1HmDpxrnji+QYywuly9fWuBN5BIJLLDAbYIBQ4kHywjcRUZY8cHiRAigzC9VahyUolPqupX0+gABK//76tAAEIMMQgEzERTRNAOyvIyKAxHYtOHQKqAwZoGNMV2jipUhKanaYEuqXNAKDJEiQwRbUxSgD//twxOOCDkjjLH3kACIxlCNd7bC8SRNKXVYFRdFKV+4NWSKnVBQOlXSQdGLOhMNRFv8e7///9CeGqkxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqkxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqTEFNRTMuMTAwqqqqqqqqqqqqqqqqqv/7YMT2ABGQoRtPaYVhfw2i9cwkrKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqkxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqTEFNRTMuMTAwqqqqqv/7EMTWA8AAAf4AAAAgAAA0gAAABKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//sQxNYDwAABpAAAACAAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+xDE1gPAAAGkAAAAIAAANIAAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqv/7EMTWA8AAAaQAAAAgAAA0gAAABKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//sQxNYDwAABpAAAACAAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+xDE1gPAAAGkAAAAIAAANIAAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqg==",soundByteArray$1=base64SoundToByteArray(phetAudioContext$1,soundURI$1),unlock$1=asyncLoader.createLock(soundURI$1),wrappedAudioBuffer$1=new WrappedAudioBuffer;let unlocked$1=!1;const safeUnlock$1=()=>{unlocked$1||(unlock$1(),unlocked$1=!0)},onDecodeSuccess$1=o=>{wrappedAudioBuffer$1.audioBufferProperty.value===null&&(wrappedAudioBuffer$1.audioBufferProperty.set(o),safeUnlock$1())},onDecodeError$1=o=>{console.warn("decode of audio data failed, using stubbed sound, error: "+o),wrappedAudioBuffer$1.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$1()},decodePromise$1=phetAudioContext$1.decodeAudioData(soundByteArray$1.buffer,onDecodeSuccess$1,onDecodeError$1);decodePromise$1&&decodePromise$1.then(o=>{wrappedAudioBuffer$1.audioBufferProperty.value===null&&(wrappedAudioBuffer$1.audioBufferProperty.set(o),safeUnlock$1())}).catch(o=>{console.warn("promise rejection caught for audio decode, error = "+o),safeUnlock$1()});const soundURI="data:audio/mpeg;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAAEAAAE/QCbm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5vBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHB4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4P////////////////////////////////8AAAAUTEFNRTMuMTAwBJgAAAAAAAAAABUgJAXmQQABpAAABP2CPnqIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//ugxAAAAZABXJQAACjSBy/7MvJBlbA24AeHxx+Z+DJ48Acl/O7e/c+wAAAAAAAEggodS1KhDIMHY9Flj8OAaLhIDnqje9htgSxoj0q3Fksjnr007hUgBFiJkAAAAJRul9HpGarkErUNUSqvEO5RRnr0CYblhVBIAACITTDJN3xrY6pMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpcJoKAAAAAArSgBAzM3OFUFV0GH4AAagOAQ5P8ZoVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//sgxNoAw8QpV9zxgCg6A+w4kAkEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7EMTlgMI4H1/EgQggMYHqUBQYBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//sQxNYDwAAB/gAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVU=",soundByteArray=base64SoundToByteArray(phetAudioContext$1,soundURI),unlock=asyncLoader.createLock(soundURI),wrappedAudioBuffer=new WrappedAudioBuffer;let unlocked=!1;const safeUnlock=()=>{unlocked||(unlock(),unlocked=!0)},onDecodeSuccess=o=>{wrappedAudioBuffer.audioBufferProperty.value===null&&(wrappedAudioBuffer.audioBufferProperty.set(o),safeUnlock())},onDecodeError=o=>{console.warn("decode of audio data failed, using stubbed sound, error: "+o),wrappedAudioBuffer.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock()},decodePromise=phetAudioContext$1.decodeAudioData(soundByteArray.buffer,onDecodeSuccess,onDecodeError);decodePromise&&decodePromise.then(o=>{wrappedAudioBuffer.audioBufferProperty.value===null&&(wrappedAudioBuffer.audioBufferProperty.set(o),safeUnlock())}).catch(o=>{console.warn("promise rejection caught for audio decode, error = "+o),safeUnlock()});const generalBoundaryBoopSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$1,{soundClipOptions:{initialOutputLevel:.2},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("generalBoundaryBoopSoundPlayer",generalBoundaryBoopSoundPlayer);const generalSoftClickSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer,{soundClipOptions:{initialOutputLevel:.2},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("generalSoftClickSoundPlayer",generalSoftClickSoundPlayer);const DEFAULT_NUMBER_OF_MIDDLE_THRESHOLDS=5,DEFAULT_MIN_SOUND_PLAYER=new SoundClipPlayer(wrappedAudioBuffer$1,{soundClipOptions:{initialOutputLevel:.2,initialPlaybackRate:1/Math.pow(2,1/6)},soundManagerOptions:{categoryName:"user-interface"}}),DEFAULT_MIDDLE_MOVING_DOWN_SOUND_PLAYER=new SoundClipPlayer(wrappedAudioBuffer,{soundClipOptions:{initialOutputLevel:.2,initialPlaybackRate:1/Math.pow(2,1/6)},soundManagerOptions:{categoryName:"user-interface"}}),DEFAULT_VALUE_CONSTRAINT=o=>DotUtils.roundToInterval(o,1e-9),NO_PLAYBACK_RATE_CHANGE=()=>1,STUB_SOUND_PLAYER_FUNCTION=()=>{assert&&assert(!1,"Code error: This is a stubbed function and should never be invoked.")},xi=class xi extends Disposable{constructor(e,t){const n=optionize()({middleMovingUpSoundPlayer:generalSoftClickSoundPlayer,middleMovingDownSoundPlayer:DEFAULT_MIDDLE_MOVING_DOWN_SOUND_PLAYER,middleMovingUpPlaybackRateMapper:NO_PLAYBACK_RATE_CHANGE,middleMovingDownPlaybackRateMapper:NO_PLAYBACK_RATE_CHANGE,numberOfMiddleThresholds:null,interThresholdDelta:null,constrainValue:DEFAULT_VALUE_CONSTRAINT,minSoundPlayer:DEFAULT_MIN_SOUND_PLAYER,maxSoundPlayer:generalBoundaryBoopSoundPlayer,minimumInterMiddleSoundTime:.035},t);assert&&assert(n.minimumInterMiddleSoundTime>=0&&n.minimumInterMiddleSoundTime<1,`unreasonable value for minimumInterMiddleSoundTime: ${n.minimumInterMiddleSoundTime}`),assert&&assert(n.numberOfMiddleThresholds===null||n.interThresholdDelta===null,"cannot specify both the number of middle thresholds and the inter-threshold delta"),assert&&assert(n.numberOfMiddleThresholds===null||Number.isInteger(n.numberOfMiddleThresholds),"numberOfMiddleThresholds must be an integer if specified"),assert&&assert(n.middleMovingUpPlaybackRateMapper===NO_PLAYBACK_RATE_CHANGE||n.middleMovingUpSoundPlayer instanceof SoundClip,"a sound player that supports playback rate changes is required when a playback rate mapper is used"),assert&&assert(n.middleMovingDownPlaybackRateMapper===NO_PLAYBACK_RATE_CHANGE||n.middleMovingDownSoundPlayer instanceof SoundClip,"a sound player that supports playback rate changes is required when a playback rate mapper is used"),n.numberOfMiddleThresholds===null&&n.interThresholdDelta===null&&(n.numberOfMiddleThresholds=DEFAULT_NUMBER_OF_MIDDLE_THRESHOLDS),super(n),this.interThresholdDistance=DEFAULT_NUMBER_OF_MIDDLE_THRESHOLDS,this.valueRangeProperty=e instanceof Range?new TinyProperty(e):e,this.middleMovingUpSoundPlayer=n.middleMovingUpSoundPlayer,this.middleMovingDownSoundPlayer=n.middleMovingDownSoundPlayer,this.middleMovingUpPlaybackRateMapper=n.middleMovingUpPlaybackRateMapper,this.middleMovingDownPlaybackRateMapper=n.middleMovingDownPlaybackRateMapper,this.minSoundPlayer=n.minSoundPlayer,this.maxSoundPlayer=n.maxSoundPlayer,this.minimumInterMiddleSoundTime=n.minimumInterMiddleSoundTime,this.timeOfMostRecentMiddleSound=0,this.constrainValue=n.constrainValue;const r=s=>{n.numberOfMiddleThresholds!==null?this.interThresholdDistance=s.getLength()/(n.numberOfMiddleThresholds+1):n.interThresholdDelta!==null?this.interThresholdDistance=n.interThresholdDelta:(assert&&assert(!1,"should never get here, it is a logic error if we do"),this.interThresholdDistance=s.getLength()/2)};this.valueRangeProperty.link(r),this.disposeEmitter.addListener(()=>{this.valueRangeProperty.unlink(r)})}playSoundIfThresholdReached(e,t){if(e!==t){const n=this.constrainValue(e),r=this.constrainValue(t),s=this.getSurroundingThresholds(r),a=this.getSurroundingThresholds(n),h=s.length===1&&a.length===1&&Math.abs(s[0]-a[0])>this.interThresholdDistance||s.length===1&&a.length===2&&s[0]!==a[0]&&s[0]!==a[1]||s.length===2&&a.length===1&&a[0]!==s[0]&&a[0]!==s[1]||s.length===2&&a.length===2&&a[0]!==s[0],c=a.length===1&&(s.length===2||s[0]!==a[0]);(h||c||n===this.valueRangeProperty.value.min||n===this.valueRangeProperty.value.max)&&this.playSoundForValueChange(e,t)}}playSoundForValueChange(e,t){const n=this.constrainValue(e),r=this.constrainValue(t);if(n!==r||t!==e&&(e===this.valueRangeProperty.value.min||e===this.valueRangeProperty.value.max))if(e===this.valueRangeProperty.value.min&&this.minSoundPlayer!==xi.USE_MIDDLE_SOUND)this.minSoundPlayer.play();else if(e===this.valueRangeProperty.value.max&&this.maxSoundPlayer!==xi.USE_MIDDLE_SOUND)this.maxSoundPlayer.play();else{const s=phetAudioContext$1.currentTime;if(s-this.timeOfMostRecentMiddleSound>this.minimumInterMiddleSoundTime){let a,h;n>r?(a=this.middleMovingUpPlaybackRateMapper,h=this.middleMovingUpSoundPlayer):(a=this.middleMovingUpPlaybackRateMapper,h=this.middleMovingDownSoundPlayer),a!==NO_PLAYBACK_RATE_CHANGE&&h.setPlaybackRate(a(e)),h.play(),this.timeOfMostRecentMiddleSound=s}}}getSurroundingThresholds(e){const n=Math.floor(DotUtils.roundToInterval((e-this.valueRangeProperty.value.min)/this.interThresholdDistance,1e-7)),r=DotUtils.roundToInterval(n*this.interThresholdDistance+this.valueRangeProperty.value.min,1e-7),s=[r];if(r!==e){const a=Math.min(DotUtils.roundToInterval(r+this.interThresholdDistance,1e-7),this.valueRangeProperty.value.max);a>r&&s.push(a)}return s}};xi.NO_SOUND=new xi(new Range(0,1),{middleMovingUpSoundPlayer:nullSoundPlayer,minSoundPlayer:nullSoundPlayer,maxSoundPlayer:nullSoundPlayer}),xi.USE_MIDDLE_SOUND={play:STUB_SOUND_PLAYER_FUNCTION,stop:STUB_SOUND_PLAYER_FUNCTION};let ValueChangeSoundPlayer=xi;tambo.register("ValueChangeSoundPlayer",ValueChangeSoundPlayer);const DEFAULT_TAG_NAME="input",toString=o=>`${o}`,DEFAULT_VOICING_ON_END_RESPONSE_OPTIONS={withNameResponse:!1,withObjectResponse:!0,onlyOnValueChange:!0},ACCESSIBLE_VALUE_HANDLER_OPTIONS=["startInput","endInput","onInput","constrainValue","keyboardStep","shiftKeyboardStep","pageKeyboardStep","ariaOrientation","panTargetNode","roundToStepSize","a11yMapPDOMValue","a11yMapValue","a11yRepeatEqualValueText","a11yCreateAriaValueText","a11yCreateContextResponseAlert","contextResponsePerValueChangeDelay","contextResponseMaxDelay","a11yDependencies","voicingOnEndResponseOptions"],AccessibleValueHandler=(o,e)=>{const t=DelayedMutate$1("AccessibleValueHandler",ACCESSIBLE_VALUE_HANDLER_OPTIONS,class extends Voicing(o){constructor(...r){const s=r[e];assert&&assert(s,"providedOptions has required options"),assert&&assert(s.enabledRangeProperty,"enabledRangeProperty is a required option"),assert&&assert(s.valueProperty,"valueProperty is a required option"),assert&&s&&assert(!s.hasOwnProperty("tagName")||s.tagName===null,"AccessibleValueHandler sets its own tagName. Only provide tagName to clear accessible content from the PDOM"),assert&&s&&assert(!s.hasOwnProperty("inputType"),"AccessibleValueHandler sets its own inputType."),assert&&s&&s.roundToStepSize&&assert(s.keyboardStep,"rounding to keyboardStep, define appropriate keyboardStep to round to"),r[e]=optionize()({tagName:DEFAULT_TAG_NAME,inputType:"range"},s),super(...r),this._startInput=_.noop,this._onInput=_.noop,this._endInput=_.noop,this._constrainValue=_.identity,this._a11yMapValue=_.identity,this._panTargetNode=null,this._ariaOrientation=Orientation.HORIZONTAL,this._shiftKey=!1,this._a11yDependencies=[],this._oldValue=null,this._a11yCreateContextResponseAlert=null,this._contextResponseUtterance=new Utterance,this._timesValueTextChangedBeforeAlerting=0,this._contextResponsePerValueChangeDelay=700,this._contextResponseMaxDelay=1500,this._a11yInputHandled=!1,this._blockInput=!1,this._roundToStepSize=!1,this._rangeKeysDown={},this._a11yMapPDOMValue=_.identity,this._a11yCreateAriaValueText=toString,this._dependenciesMultilink=null,this._a11yRepeatEqualValueText=!0,this._timesChangedBeforeAlerting=0,this._voicingOnEndResponseOptions=DEFAULT_VOICING_ON_END_RESPONSE_OPTIONS,this._pdomPointer=null,assertHasProperties(this,["inputValue","setPDOMAttribute"]);const a=s.valueProperty,h=s.enabledRangeProperty;s.reverseAlternativeInput?this._valueProperty=new DynamicProperty(new Property(a),{bidirectional:!0,map:y=>h.value.max-y,inverseMap:y=>h.value.max-y}):this._valueProperty=a,this._enabledRangeProperty=h,this._a11yValueTextUpdateListener=this.invalidateAriaValueText.bind(this),this.keyboardStep=(h.get().max-h.get().min)/20,this.shiftKeyboardStep=(h.get().max-h.get().min)/100,this.pageKeyboardStep=(h.get().max-h.get().min)/10,this._valueOnStart=a.value,this.invalidateA11yDependencies();const c=this.invalidateEnabledRange.bind(this);this._enabledRangeProperty.link(c);const d=this.invalidateValueProperty.bind(this);this._valueProperty.link(d),this._pdomPointerListener={interrupt:()=>{this._onInteractionEnd(null)}},this._disposeAccessibleValueHandler=()=>{this._enabledRangeProperty.unlink(c),this._valueProperty.unlink(d),s.reverseAlternativeInput&&(assert&&assert(this._valueProperty instanceof DynamicProperty,"Only a DynamicProperty can be disposed, otherwise this is disposing a Property that AccessibleValueHandler does not have ownership over."),this._valueProperty.dispose()),this._dependenciesMultilink&&this._dependenciesMultilink.dispose(),this._panTargetNode=null,this._a11yDependencies=[]}}set startInput(r){this._startInput=r}get startInput(){return this._startInput}set onInput(r){this._onInput=r}get onInput(){return this._onInput}set endInput(r){this._endInput=r}get endInput(){return this._endInput}set constrainValue(r){this._constrainValue=r}get constrainValue(){return this._constrainValue}set panTargetNode(r){this._panTargetNode=r}get panTargetNode(){return this._panTargetNode}set roundToStepSize(r){this._roundToStepSize=r}get roundToStepSize(){return this._roundToStepSize}set a11yMapPDOMValue(r){this._a11yMapPDOMValue=r,this.invalidateEnabledRange(this._enabledRangeProperty.value),this.invalidateValueProperty(),this.invalidateAriaValueText()}get a11yMapPDOMValue(){return this._a11yMapPDOMValue}set a11yMapValue(r){this._a11yMapValue=r}get a11yMapValue(){return this._a11yMapValue}set a11yRepeatEqualValueText(r){this._a11yRepeatEqualValueText=r,this.invalidateAriaValueText()}get a11yRepeatEqualValueText(){return this._a11yRepeatEqualValueText}set a11yCreateAriaValueText(r){this._a11yCreateAriaValueText=r,this.invalidateAriaValueText()}get a11yCreateAriaValueText(){return this._a11yCreateAriaValueText}set a11yCreateContextResponseAlert(r){this._a11yCreateContextResponseAlert=r}get a11yCreateContextResponseAlert(){return this._a11yCreateContextResponseAlert}set contextResponsePerValueChangeDelay(r){this._contextResponsePerValueChangeDelay=r}get contextResponsePerValueChangeDelay(){return this._contextResponsePerValueChangeDelay}set contextResponseMaxDelay(r){this._contextResponseMaxDelay=r}get contextResponseMaxDelay(){return this._contextResponseMaxDelay}set voicingOnEndResponseOptions(r){this._voicingOnEndResponseOptions=r}get voicingOnEndResponseOptions(){return this._voicingOnEndResponseOptions}invalidateAriaValueText(){this._updateAriaValueText(this._oldValue),this._oldValue=this._valueProperty.value}invalidateEnabledRange(r){const s=this._getMappedValue(r.min),a=this._getMappedValue(r.max);this.setPDOMAttribute("min",s),this.setPDOMAttribute("max",a),this._updateSiblingStepAttribute()}invalidateValueProperty(){const r=this._getMappedValue();this.setPDOMAttribute("aria-valuenow",r),this.inputValue=r}invalidateA11yDependencies(){this._dependenciesMultilink&&this._dependenciesMultilink.dispose(),this._dependenciesMultilink=Multilink.multilinkAny(this._a11yDependencies.concat([this._valueProperty]),this._a11yValueTextUpdateListener)}setA11yDependencies(r){assert&&assert(!r.includes(this._valueProperty),"The value Property is already a dependency, and does not need to be added to this list"),this._a11yDependencies=r,this.invalidateA11yDependencies()}getA11yDependencies(){return this._a11yDependencies}set a11yDependencies(r){this.setA11yDependencies(r)}get a11yDependencies(){return this.getA11yDependencies()}_updateAriaValueText(r){const s=this._getMappedValue(),a=this._a11yCreateAriaValueText(s,this._valueProperty.value,r);let h=PDOMUtils$1.unwrapStringProperty(a);assert&&assert(typeof h=="string");const c=" ";this._a11yRepeatEqualValueText&&this.ariaValueText&&h===this.ariaValueText.replace(new RegExp(c,"g"),"")&&(h=this.ariaValueText+c),this.ariaValueText=h}alertContextResponse(){let r=!1;if(this._a11yCreateContextResponseAlert){const s=this._getMappedValue(),a=this._a11yCreateContextResponseAlert(s,this._valueProperty.value,this._valueOnStart);a&&(this._contextResponseUtterance.alert=a,this.forEachUtteranceQueue(h=>{r||(h.hasUtterance(this._contextResponseUtterance)?(r=!0,this._timesChangedBeforeAlerting++):this._timesChangedBeforeAlerting=1),this._contextResponseUtterance.alertStableDelay=Math.min(this._contextResponseMaxDelay,this._timesChangedBeforeAlerting*this._contextResponsePerValueChangeDelay),h.addToBack(this._contextResponseUtterance)}))}}reset(){this._a11yCreateAriaValueText.reset&&this._a11yCreateAriaValueText.reset(),this._a11yCreateContextResponseAlert&&this._a11yCreateContextResponseAlert.reset&&this._a11yCreateContextResponseAlert.reset(),this._timesChangedBeforeAlerting=0,this._updateAriaValueText(null)}_getMappedValue(r=this._valueProperty.value){return this._a11yMapPDOMValue(r)}getAccessibleValueHandlerInputListener(){return{keydown:this.handleKeyDown.bind(this),keyup:this.handleKeyUp.bind(this),input:this.handleInput.bind(this),change:this.handleChange.bind(this),blur:this.handleBlur.bind(this)}}handleKeyDown(r){const s=r.domEvent,a=KeyboardUtils.getEventCode(s);if(a&&(this._shiftKey=s.shiftKey,KeyboardUtils.isKeyEvent(s,KeyboardUtils.KEY_TAB)&&(this._blockInput=!0),this.enabledProperty.get()&&KeyboardUtils.isRangeKey(s)&&(s.preventDefault(),!s.metaKey))){r.pointer.reserveForKeyboardDrag();let h=!0;this._anyKeysDown()||this._onInteractionStart(r),this._rangeKeysDown[a]=!0;let c=this._valueProperty.get();if(KeyboardUtils.isAnyKeyEvent(s,[KeyboardUtils.KEY_END,KeyboardUtils.KEY_HOME]))a===KeyboardUtils.KEY_END?c=this._enabledRangeProperty.get().max:a===KeyboardUtils.KEY_HOME&&(c=this._enabledRangeProperty.get().min);else{let D;a===KeyboardUtils.KEY_PAGE_UP||a===KeyboardUtils.KEY_PAGE_DOWN?(D=this.pageKeyboardStep,a===KeyboardUtils.KEY_PAGE_UP?c=this._valueProperty.get()+D:a===KeyboardUtils.KEY_PAGE_DOWN&&(c=this._valueProperty.get()-D)):KeyboardUtils.isArrowKey(s)&&(D=s.shiftKey?this.shiftKeyboardStep:this.keyboardStep,h=!s.shiftKey,a===KeyboardUtils.KEY_RIGHT_ARROW||a===KeyboardUtils.KEY_UP_ARROW?c=this._valueProperty.get()+D:(a===KeyboardUtils.KEY_LEFT_ARROW||a===KeyboardUtils.KEY_DOWN_ARROW)&&(c=this._valueProperty.get()-D),this._roundToStepSize&&(c=roundValue(c,this._valueProperty.get(),D)))}const d=this._a11yMapValue(c,this._valueProperty.get());let y=d;h&&(y=this._constrainValue(d)),this._valueProperty.set(DotUtils.clamp(y,this._enabledRangeProperty.get().min,this._enabledRangeProperty.get().max)),this._onInput(r);const g=this._panTargetNode||this;animatedPanZoomSingleton.initialized&&animatedPanZoomSingleton.listener.panToNode(g,!0,g.limitPanDirection)}}handleKeyUp(r){const s=KeyboardUtils.getEventCode(r.domEvent);this._allKeysUp()||(KeyboardUtils.SHIFT_KEYS.includes(s)&&(this._shiftKey=!1),this.enabledProperty.get()&&KeyboardUtils.isRangeKey(r.domEvent)&&(this._rangeKeysDown[s]=!1,this._allKeysUp()&&this._onInteractionEnd(r)))}handleChange(r){this._a11yInputHandled||this.handleInput(r),this._a11yInputHandled=!1}handleInput(r){if(this.enabledProperty.get()&&!this._blockInput){this._a11yInputHandled=!0;let s=this._valueProperty.get();const a=parseFloat(r.domEvent.target.value),h=this._shiftKey?this.shiftKeyboardStep:this.keyboardStep,c=this._getMappedValue();this._onInteractionStart(r),a>c?s=this._valueProperty.get()+h:a<c&&(s=this._valueProperty.get()-h),this._roundToStepSize&&(s=roundValue(s,this._valueProperty.get(),h)),s=DotUtils.clamp(s,this._enabledRangeProperty.get().min,this._enabledRangeProperty.get().max),this._valueProperty.set(this._constrainValue(this._a11yMapValue(s,this._valueProperty.get()))),this._onInput(r),this._onInteractionEnd(r)}this._blockInput=!1}handleBlur(r){this._anyKeysDown()&&this._onInteractionEnd(r),this._shiftKey=!1,this._blockInput=!1,this._rangeKeysDown={}}_onInteractionStart(r){assert&&assert(!this._pdomPointer,"Pointer should have been cleared and detached on end or interrupt."),this._pdomPointer=r.pointer,assert&&assert(this._pdomPointer.attachedListener!==this._pdomPointerListener,"This pointer listener was never removed!"),this._pdomPointer.addInputListener(this._pdomPointerListener,!0),this._valueOnStart=this._valueProperty.value,this._startInput(r)}_onInteractionEnd(r){this._pdomPointer&&(this.alertContextResponse(),this.voicingOnEndResponse(this._valueOnStart),this._endInput(r),assert&&assert(this._pdomPointer.attachedListener===this._pdomPointerListener,"pointer listener should be attached"),this._pdomPointer.removeInputListener(this._pdomPointerListener),this._pdomPointer=null)}setKeyboardStep(r){assert&&assert(r>=0,"keyboard step must be non-negative"),this._keyboardStep=r}set keyboardStep(r){this.setKeyboardStep(r)}get keyboardStep(){return this.getKeyboardStep()}getKeyboardStep(){return this._keyboardStep}setShiftKeyboardStep(r){assert&&assert(r>=0,"shift keyboard step must be non-negative"),this._shiftKeyboardStep=r}set shiftKeyboardStep(r){this.setShiftKeyboardStep(r)}get shiftKeyboardStep(){return this.getShiftKeyboardStep()}getShiftKeyboardStep(){return this._shiftKeyboardStep}getShiftKeyDown(){return this._shiftKey}get shiftKeyDown(){return this.getShiftKeyDown()}setPageKeyboardStep(r){assert&&assert(r>=0,"page keyboard step must be non-negative"),this._pageKeyboardStep=r}set pageKeyboardStep(r){this.setPageKeyboardStep(r)}get pageKeyboardStep(){return this.getPageKeyboardStep()}getPageKeyboardStep(){return this._pageKeyboardStep}setAriaOrientation(r){this._ariaOrientation=r,this.setPDOMAttribute("aria-orientation",r.ariaOrientation)}set ariaOrientation(r){this.setAriaOrientation(r)}get ariaOrientation(){return this._ariaOrientation}getAriaOrientation(){return this._ariaOrientation}_allKeysUp(){return _.every(this._rangeKeysDown,r=>!r)}_anyKeysDown(){return!!_.find(this._rangeKeysDown,r=>r)}_updateSiblingStepAttribute(){let r="any";if(platform.mobileSafari){const s=Math.min(this.keyboardStep,this.shiftKeyboardStep,this.pageKeyboardStep);r=Math.pow(10,-DotUtils.numberOfDecimalPlaces(s));const a=this._getMappedValue(this._enabledRangeProperty.get().min),h=this._getMappedValue(this._enabledRangeProperty.get().max),c=h-a;r/c<1e-5&&(r=h/100,r=Number(r.toPrecision(8)))}this.setPDOMAttribute("step",r)}voicingOnEndResponse(r,s){const a=combineOptions({},this._voicingOnEndResponseOptions,s),h=r!==this._valueProperty.value,c=this._valueProperty.value===this._enabledRangeProperty.value.min||this._valueProperty.value===this._enabledRangeProperty.value.max,d=!!(a.withNameResponse&&this.voicingNameResponse)||!!(a.withObjectResponse&&this.voicingObjectResponse);(!a.onlyOnValueChange||c||h)&&d&&this.voicingSpeakFullResponse({nameResponse:a.withNameResponse?this.voicingNameResponse:null,objectResponse:a.withObjectResponse?this.voicingObjectResponse:null,hintResponse:null})}dispose(){this._disposeAccessibleValueHandler(),super.dispose()}});return t.prototype._mutatorKeys=ACCESSIBLE_VALUE_HANDLER_OPTIONS.concat(t.prototype._mutatorKeys),assert&&assert(t.prototype._mutatorKeys.length===_.uniq(t.prototype._mutatorKeys).length,"duplicate mutator keys in AccessibleValueHandler"),t};sun.register("AccessibleValueHandler",AccessibleValueHandler);const roundValue=function(o,e,t){let n=o;return t!==0&&(n=DotUtils.roundSymmetric(n/t)*t,n=correctRounding(n,e,t)),n},correctRounding=function(o,e,t){let n=o;const r=Math.abs(o-e),s=r>t,a=DotUtils.equalsEpsilon(r,t,1e-14);return s&&!a&&(n+=o>e?-t:t),n};AccessibleValueHandler.DEFAULT_TAG_NAME=DEFAULT_TAG_NAME;const ACCESSIBLE_SLIDER_OPTIONS=["startDrag","drag","endDrag"],AccessibleSlider=(o,e)=>{const t=DelayedMutate$1("AccessibleSlider",ACCESSIBLE_SLIDER_OPTIONS,class extends AccessibleValueHandler(o,e){constructor(...r){const s=r[e];assert&&s&&assert(Object.getPrototypeOf(s)===Object.prototype,"Extra prototype on AccessibleSlider options object is a code smell (or probably a bug)"),assert&&assert(s.startInput===void 0,"AccessibleSlider sets startInput through options.startDrag"),assert&&assert(s.endInput===void 0,"AccessibleSlider sets endInput through options.endDrag"),assert&&assert(s.onInput===void 0,"AccessibleSlider sets onInput through options.drag"),super(...r),this._startDrag=_.noop,this._drag=_.noop,this._endDrag=_.noop,assertHasProperties(this,["addInputListener","removeInputListener"]);const a=this.getAccessibleValueHandlerInputListener();this.addInputListener(a),this._disposeAccessibleSlider=()=>{this.removeInputListener(a)}}set startDrag(r){this._startDrag=r,this.startInput=r}get startDrag(){return this._startDrag}set drag(r){this._drag=r,this.onInput=r}get drag(){return this._drag}set endDrag(r){this._endDrag=r,this.endInput=r}get endDrag(){return this._endDrag}dispose(){this._disposeAccessibleSlider(),super.dispose()}});return t.prototype._mutatorKeys=ACCESSIBLE_SLIDER_OPTIONS.concat(t.prototype._mutatorKeys),assert&&assert(t.prototype._mutatorKeys.length===_.uniq(t.prototype._mutatorKeys).length,"duplicate mutator keys in AccessibleSlider"),t};sun.register("AccessibleSlider",AccessibleSlider);class SliderThumb extends Rectangle{constructor(e){const t=optionize()({size:new Dimension2(22,45),fillHighlighted:"rgb( 71, 207, 255 )",centerLineStroke:"white",fill:"rgb( 50, 145, 184 )",stroke:"black",lineWidth:1,tandem:Tandem.REQUIRED,tandemNameSuffix:"ThumbNode"},e);t.cornerRadius===void 0&&(t.cornerRadius=.25*t.size.width),t.cachedPaints=[t.fill,t.fillHighlighted],super(0,0,t.size.width,t.size.height,t);const n=Rectangle.bounds(this.bounds.dilated(5),{fill:"transparent",localBounds:this.bounds,pickable:!1});this.addChild(n);const r=3;this.addChild(new Path(Shape$1.lineSegment(t.size.width/2,r,t.size.width/2,t.size.height-r),{stroke:t.centerLineStroke}));const s=new PressListener({attach:!1,tandem:Tandem.OPT_OUT});s.isHighlightedProperty.link(a=>{this.fill=a?t.fillHighlighted:t.fill}),this.addInputListener(s)}}sun.register("SliderThumb",SliderThumb);class SliderTick{constructor(e,t,n,r,s,a,h,c,d){this.parent=e,this.value=t,this.label=n,this.labelXProperty=new DerivedProperty([d.valueToPositionProperty],g=>g.evaluate(t)),this.tickNode=new Node$2,e.addChild(this.tickNode);const y=new Path(new Shape$1().moveTo(0,d.top).lineTo(0,d.top-r),{stroke:s,lineWidth:a});this.labelXProperty.link(g=>{y.x=g}),this.tickNode.addChild(y),n&&(this.labelContainer=new Node$2({pickable:!1}),this.tickNode.addChild(this.labelContainer),this.labelContainer.addChild(n),c===Orientation.VERTICAL&&(this.labelContainer.rotation=-SunConstants.SLIDER_VERTICAL_ROTATION),this.labelManualConstraint=ManualConstraint.create(this.tickNode,[y,this.labelContainer],(g,D)=>{D.centerX=g.centerX,D.bottom=g.top-h.tickLabelSpacing}))}dispose(){this.parent.removeChild(this.tickNode),this.labelContainer&&this.labelContainer.dispose(),this.labelXProperty.dispose(),this.labelManualConstraint&&this.labelManualConstraint.dispose()}}sun.register("SliderTick",SliderTick);const DEFAULT_HORIZONTAL_TRACK_SIZE=new Dimension2(100,5),DEFAULT_HORIZONTAL_THUMB_SIZE=new Dimension2(17,34),Ht=class Ht extends Sizable(AccessibleSlider(Node$2,0)){constructor(e,t,n){var W,X;assert&&assertMutuallyExclusiveOptions(n,["thumbNode"],["thumbSize","thumbFill","thumbFillHighlighted","thumbStroke","thumbLineWidth","thumbCenterLineStroke","thumbTouchAreaXDilation","thumbTouchAreaYDilation","thumbMouseAreaXDilation","thumbMouseAreaYDilation"]),assert&&assertMutuallyExclusiveOptions(n,["trackNode"],["trackSize","trackFillEnabled","trackFillDisabled","trackStroke","trackLineWidth","trackCornerRadius"]);const r=optionize()({orientation:Orientation.HORIZONTAL,trackNode:null,trackSize:null,trackFillEnabled:"white",trackFillDisabled:"gray",trackStroke:"black",trackLineWidth:1,trackCornerRadius:0,trackPickable:!0,thumbNode:null,thumbSize:null,thumbFill:"rgb(50,145,184)",thumbFillHighlighted:"rgb(71,207,255)",thumbStroke:"black",thumbLineWidth:1,thumbCenterLineStroke:"white",thumbTouchAreaXDilation:11,thumbTouchAreaYDilation:11,thumbMouseAreaXDilation:0,thumbMouseAreaYDilation:0,thumbYOffset:0,tickLabelSpacing:6,majorTickLength:25,majorTickStroke:"black",majorTickLineWidth:1,minorTickLength:10,minorTickStroke:"black",minorTickLineWidth:1,cursor:"pointer",startDrag:_.noop,drag:_.noop,endDrag:_.noop,constrainValue:_.identity,disabledOpacity:SceneryConstants.DISABLED_OPACITY,soundGenerator:Ht.DEFAULT_SOUND_GENERATOR,valueChangeSoundGeneratorOptions:{},phetioLinkedProperty:null,tandem:Tandem.REQUIRED,tandemNameSuffix:"Slider",phetioType:Ht.SliderIO,phetioFeatured:!0,visiblePropertyOptions:{phetioFeatured:!0},phetioEnabledPropertyInstrumented:!0},n),s=t instanceof Range?new TinyProperty(t):t;if(assert&&assert(r.soundGenerator===Ht.DEFAULT_SOUND_GENERATOR||_.isEmpty(r.valueChangeSoundGeneratorOptions),"options should only be supplied when using default sound generator"),r.soundGenerator===Ht.DEFAULT_SOUND_GENERATOR?r.soundGenerator=new ValueChangeSoundPlayer(s.value,r.valueChangeSoundGeneratorOptions||{}):r.soundGenerator===null&&(r.soundGenerator=ValueChangeSoundPlayer.NO_SOUND),r.soundGenerator!==ValueChangeSoundPlayer.NO_SOUND){let J=e.value;const oe=r.drag;r.drag=le=>{le.isFromPDOM()?r.soundGenerator.playSoundForValueChange(e.value,J):r.soundGenerator.playSoundIfThresholdReached(e.value,J),oe(le),J=e.value}}r.orientation===Orientation.VERTICAL&&(r.trackSize&&(r.trackSize=r.trackSize.swapped()),r.thumbSize&&(r.thumbSize=r.thumbSize.swapped()),swapObjectKeys(r,"thumbTouchAreaXDilation","thumbTouchAreaYDilation"),swapObjectKeys(r,"thumbMouseAreaXDilation","thumbMouseAreaYDilation")),r.trackSize=r.trackSize||DEFAULT_HORIZONTAL_TRACK_SIZE,r.thumbSize=r.thumbSize||DEFAULT_HORIZONTAL_THUMB_SIZE;const a=r.tandem.createTandem(Ht.THUMB_NODE_TANDEM_NAME);Tandem.VALIDATION&&r.thumbNode&&assert&&assert(r.thumbNode.tandem.equals(a),`Passed-in thumbNode must have the correct tandem. Expected: ${a.phetioID}, actual: ${r.thumbNode.tandem.phetioID}`);const h=r.thumbNode||new SliderThumb({size:r.thumbSize,fill:r.thumbFill,fillHighlighted:r.thumbFillHighlighted,stroke:r.thumbStroke,lineWidth:r.thumbLineWidth,centerLineStroke:r.thumbCenterLineStroke,tandem:a}),c=!r.enabledRangeProperty,d=_.pick(r,Node$2.REQUIRES_BOUNDS_OPTION_KEYS),y=combineOptions({ariaOrientation:r.orientation,valueProperty:e,panTargetNode:h,enabledRangeProperty:r.enabledRangeProperty||(t instanceof Range?new Property(t,{valueType:Range,isValidValue:J=>J.min>=t.min&&J.max<=t.max,tandem:r.tandem.createTandem("enabledRangeProperty"),phetioValueType:Range.RangeIO,phetioDocumentation:"Sliders support two ranges: the outer range which specifies the min and max of the track and the enabledRangeProperty, which determines how low and high the thumb can be dragged within the track."}):t)},r);super(y),this.ticks=createObservableArray(),this.proposedValue=null,this.orientation=y.orientation,this.enabledRangeProperty=y.enabledRangeProperty,this.tickOptions=_.pick(r,"tickLabelSpacing","majorTickLength","majorTickStroke","majorTickLineWidth","minorTickLength","minorTickStroke","minorTickLineWidth");const g=[];this.majorTicksParent=new Node$2,this.minorTicksParent=new Node$2,g.push(this.majorTicksParent),g.push(this.minorTicksParent);const D=r.tandem.createTandem(Ht.TRACK_NODE_TANDEM_NAME);Tandem.VALIDATION&&r.trackNode&&assert&&assert(r.trackNode.tandem.equals(D),`Passed-in trackNode must have the correct tandem. Expected: ${D.phetioID}, actual: ${r.trackNode.tandem.phetioID}`);const O=new Node$2;g.push(O),assert&&assert(y.trackSize,"trackSize should not be null"),this.track=r.trackNode||new DefaultSliderTrack(e,t,{size:y.trackSize,fillEnabled:y.trackFillEnabled,fillDisabled:y.trackFillDisabled,stroke:y.trackStroke,lineWidth:y.trackLineWidth,cornerRadius:y.trackCornerRadius,startDrag:y.startDrag,drag:y.drag,endDrag:y.endDrag,constrainValue:y.constrainValue,enabledRangeProperty:this.enabledRangeProperty,soundGenerator:r.soundGenerator,pickable:y.trackPickable,voicingOnEndResponse:this.voicingOnEndResponse.bind(this),tandem:D}),g.push(this.track),h.setCenterY(this.track.centerY+r.thumbYOffset),g.push(h);const V=new Node$2({children:g});r.orientation===Orientation.VERTICAL&&(V.rotation=SunConstants.SLIDER_VERTICAL_ROTATION),this.addChild(V),!r.thumbNode&&(r.thumbTouchAreaXDilation||r.thumbTouchAreaYDilation)&&(h.touchArea=h.localBounds.dilatedXY(r.thumbTouchAreaXDilation,r.thumbTouchAreaYDilation)),!r.thumbNode&&(r.thumbMouseAreaXDilation||r.thumbMouseAreaYDilation)&&(h.mouseArea=h.localBounds.dilatedXY(r.thumbMouseAreaXDilation,r.thumbMouseAreaYDilation));let k=0,M=e.value;const N=new DragListener({tandem:h.tandem.createTandem("dragListener"),start:(J,oe)=>{this.enabledProperty.get()&&(M=e.value,r.startDrag(J),k=oe.pressedTrail.subtrailTo(V).getTransform().inversePosition2(J.pointer.point).x-h.centerX)},drag:(J,oe)=>{if(this.enabledProperty.get()){const pe=oe.pressedTrail.subtrailTo(V).getTransform().inversePosition2(J.pointer.point).x-k;this.proposedValue=this.track.valueToPositionProperty.value.inverse(pe);const ve=this.enabledRangeProperty.get().constrainValue(this.proposedValue);e.set(r.constrainValue(ve)),r.drag(J)}},end:J=>{this.enabledProperty.get()&&(r.endDrag(J),this.voicingOnEndResponse(M)),this.proposedValue=null}});h.addInputListener(N),this.thumbDragListener=N,this.trackDragListener=this.track.dragListener;const F=Multilink.multilink([e,this.track.valueToPositionProperty],(J,oe)=>{h.centerX=oe.evaluate(J)}),G=J=>{if(!e.isPhetioInstrumented()||!isSettingPhetioStateProperty.value)if(this.proposedValue===null)e.set(DotUtils.clamp(e.value,J.min,J.max));else{const oe=DotUtils.clamp(this.proposedValue,J.min,J.max),le=r.constrainValue(oe);e.set(le)}};this.enabledRangeProperty.link(G);const ie=new SliderConstraint(this,this.track,h,V,r.orientation,O,this.ticks);this.disposeSlider=()=>{ie.dispose(),h.dispose&&h.dispose(),this.track.dispose&&this.track.dispose(),c?this.enabledRangeProperty.dispose():this.enabledRangeProperty.unlink(G),F.dispose(),N.dispose()},this.focusHighlight=new HighlightFromNode$1(h),assert&&Tandem.VALIDATION&&assert(!r.phetioLinkedProperty||r.phetioLinkedProperty.isPhetioInstrumented(),"If provided, phetioLinkedProperty should be PhET-iO instrumented");const Z=r.phetioLinkedProperty||(e instanceof ReadOnlyProperty?e:null);Z&&this.addLinkedElement(Z,{tandemName:"valueProperty"}),!c&&this.enabledRangeProperty instanceof ReadOnlyProperty&&this.addLinkedElement(this.enabledRangeProperty,{tandemName:"enabledRangeProperty"}),this.mutate(d),assert&&((X=(W=phet==null?void 0:phet.chipper)==null?void 0:W.queryParameters)!=null&&X.binder)&&InstanceRegistry.registerDataURL("sun","Slider",this)}get majorTicksVisible(){return this.getMajorTicksVisible()}set majorTicksVisible(e){this.setMajorTicksVisible(e)}get minorTicksVisible(){return this.getMinorTicksVisible()}set minorTicksVisible(e){this.setMinorTicksVisible(e)}dispose(){this.disposeSlider(),this.ticks.forEach(e=>{e.dispose()}),super.dispose()}addMajorTick(e,t){this.addTick(this.majorTicksParent,e,t,this.tickOptions.majorTickLength,this.tickOptions.majorTickStroke,this.tickOptions.majorTickLineWidth)}addMinorTick(e,t){this.addTick(this.minorTicksParent,e,t,this.tickOptions.minorTickLength,this.tickOptions.minorTickStroke,this.tickOptions.minorTickLineWidth)}addTick(e,t,n,r,s,a){this.ticks.push(new SliderTick(e,t,n,r,s,a,this.tickOptions,this.orientation,this.track))}setMajorTicksVisible(e){this.majorTicksParent.visible=e}getMajorTicksVisible(){return this.majorTicksParent.visible}setMinorTicksVisible(e){this.minorTicksParent.visible=e}getMinorTicksVisible(){return this.minorTicksParent.visible}};Ht.DEFAULT_SOUND_GENERATOR=new ValueChangeSoundPlayer(new Range(0,1)),Ht.THUMB_NODE_TANDEM_NAME="thumbNode",Ht.TRACK_NODE_TANDEM_NAME="trackNode",Ht.SliderIO=new IOType("SliderIO",{valueType:Ht,documentation:"A traditional slider component, with a knob and possibly tick marks",supertype:Node$2.NodeIO});let Slider=Ht;class SliderConstraint extends LayoutConstraint{constructor(e,t,n,r,s,a,h){super(e),this.slider=e,this.track=t,this.thumb=n,this.sliderPartsNode=r,this.orientation=s,this.trackSpacer=a,this.ticks=h,s===Orientation.HORIZONTAL?(e.heightSizable=!1,this.preferredProperty=this.slider.localPreferredWidthProperty):(e.widthSizable=!1,this.preferredProperty=this.slider.localPreferredHeightProperty),this.preferredProperty.lazyLink(this._updateLayoutListener),this.track.rangeProperty.lazyLink(this._updateLayoutListener),this.thumb.localBoundsProperty.lazyLink(this._updateLayoutListener);const c=d=>{d.tickNode.localBoundsProperty.lazyLink(this._updateLayoutListener),h.addItemRemovedListener(y=>{y===d&&y.tickNode.localBoundsProperty.hasListener(this._updateLayoutListener)&&d.tickNode.localBoundsProperty.unlink(this._updateLayoutListener)})};h.addItemAddedListener(c),this.addNode(t),this.layout(),this.disposeSliderConstraint=()=>{h.removeItemAddedListener(c),this.preferredProperty.unlink(this._updateLayoutListener),this.track.rangeProperty.unlink(this._updateLayoutListener),this.thumb.localBoundsProperty.unlink(this._updateLayoutListener)}}layout(){super.layout();const e=this.slider,t=this.track,n=this.thumb;this.trackSpacer.localBounds=t.localBounds.dilatedX(n.width/2),assert&&assert(t.minimumWidth!==null);const r=t.leftVisualOverflow+t.rightVisualOverflow,s=t.minimumWidth,a=s-r,h=D=>DotUtils.linear(t.rangeProperty.value.min,t.rangeProperty.value.max,0,1,D),c=-n.width/2-t.leftVisualOverflow,d=n.width/2-t.leftVisualOverflow,y=new Range(c,s+d);if(this.ticks.forEach(D=>{const O=a*h(D.value),V=D.tickNode.width/2;y.includeRange(new Range(-V,V).shifted(O))}),e.widthSizable&&this.preferredProperty.value!==null){const D=CompletePiecewiseLinearFunction.max(CompletePiecewiseLinearFunction.linear(1,d),...this.ticks.map(V=>{const k=h(V.value);return CompletePiecewiseLinearFunction.linear(k,V.tickNode.width/2-r*k)})).minus(CompletePiecewiseLinearFunction.min(CompletePiecewiseLinearFunction.constant(c),...this.ticks.map(V=>{const k=h(V.value);return CompletePiecewiseLinearFunction.linear(k,-V.tickNode.width/2-r*k)}))),O=D.withXValues([s-1,s,...D.points.map(V=>V.x).filter(V=>V>s+1e-10)]).inverted();t.preferredWidth=Math.max(s,O.evaluate(this.preferredProperty.value))}else t.preferredWidth=t.minimumWidth;const g=y.getLength();this.orientation===Orientation.HORIZONTAL?e.localMinimumWidth=g:e.localMinimumHeight=g}dispose(){this.disposeSliderConstraint(),super.dispose()}}sun.register("Slider",Slider);class SliderTrack extends WidthSizable(Node$2){constructor(e,t,n,r){super(),this.rangeProperty=n instanceof Range?new TinyProperty(n):n;const s=optionize()({size:new Dimension2(100,5),startDrag:_.noop,drag:_.noop,endDrag:_.noop,constrainValue:_.identity,enabledRangeProperty:this.rangeProperty,soundGenerator:Slider.DEFAULT_SOUND_GENERATOR,valueChangeSoundGeneratorOptions:{},voicingOnEndResponse:_.noop,leftVisualOverflow:0,rightVisualOverflow:0,tandem:Tandem.REQUIRED,tandemNameSuffix:"TrackNode"},r);s.soundGenerator===Slider.DEFAULT_SOUND_GENERATOR?s.soundGenerator=new ValueChangeSoundPlayer(this.rangeProperty.value,s.valueChangeSoundGeneratorOptions||{}):s.soundGenerator===null&&(s.soundGenerator=ValueChangeSoundPlayer.NO_SOUND),this.leftVisualOverflow=s.leftVisualOverflow,this.rightVisualOverflow=s.rightVisualOverflow,this.minimumSize=s.size,this.minimumWidth=this.minimumSize.width,this.internalWidthProperty=new DerivedProperty([this.localPreferredWidthProperty],c=>(c===null?this.minimumSize.width:Math.max(this.minimumSize.width,c))-s.leftVisualOverflow-s.rightVisualOverflow),this.sizeProperty=new DerivedProperty([this.internalWidthProperty],c=>new Dimension2(c,this.minimumSize.height)),this.valueToPositionProperty=new DerivedProperty([this.rangeProperty,this.internalWidthProperty],(c,d)=>new LinearFunction(c.min,c.max,0,d,!0));const a=(c,d)=>{const y=e.value,D=d.subtrailTo(this).getTransform().inversePosition2(c.pointer.point).x,O=this.valueToPositionProperty.value.inverse(D),V=s.enabledRangeProperty.value.constrainValue(O),k=s.constrainValue(V);e.set(k),c.type==="down"&&s.soundGenerator.playSoundIfThresholdReached(k,y)};this.addChild(t);let h=e.value;this.dragListener=new DragListener({tandem:s.tandem.createTandem("dragListener"),start:(c,d)=>{s.startDrag(c),h=e.value,a(c,d.pressedTrail)},drag:(c,d)=>{s.drag(c),a(c,d.pressedTrail)},end:c=>{s.endDrag(c),s.voicingOnEndResponse(h)}}),t.addInputListener(this.dragListener),this.mutate(s),this.disposeSliderTrack=()=>{t.removeInputListener(this.dragListener),this.dragListener.dispose()}}dispose(){this.disposeSliderTrack(),super.dispose()}}sun.register("SliderTrack",SliderTrack);class DefaultSliderTrack extends SliderTrack{constructor(e,t,n){const r=optionize()({fillEnabled:"white",fillDisabled:"gray",stroke:"black",lineWidth:1,cornerRadius:0},n),s=new Rectangle({fill:r.fillDisabled,stroke:r.stroke,lineWidth:r.lineWidth,cornerRadius:r.cornerRadius,cursor:"default",pickable:!1}),a=new Rectangle({fill:r.fillEnabled,stroke:r.stroke,lineWidth:r.lineWidth,cornerRadius:r.cornerRadius}),h=new Node$2({children:[s,a]});super(e,h,t,combineOptions({leftVisualOverflow:r.stroke!==null?r.lineWidth/2:0,rightVisualOverflow:r.stroke!==null?r.lineWidth/2:0},r));const c=Multilink.multilink([r.enabledRangeProperty,this.valueToPositionProperty,this.sizeProperty],(d,y,g)=>{const D=y.evaluate(d.min),O=y.evaluate(d.max);s.setRect(0,0,g.width,g.height),a.setRect(D,0,O-D,g.height)});this.disposeDefaultSliderTrack=()=>{c.dispose()}}dispose(){this.disposeDefaultSliderTrack(),super.dispose()}}sun.register("DefaultSliderTrack",DefaultSliderTrack);const sceneryPhet=new Namespace("sceneryPhet"),joist=new Namespace("joist"),FALLBACK_LOCALE$3="en",availableRuntimeLocales=_.sortBy(Object.keys(phet.chipper.strings),o=>StringUtils.localeToLocalizedName(o).toLowerCase()),isLocaleValid=o=>!!(o&&availableRuntimeLocales.includes(o)),partialLocale=typeof phet.chipper.locale=="string"?phet.chipper.locale.slice(0,2):void 0,validInitialLocale=isLocaleValid(phet.chipper.locale)?phet.chipper.locale:isLocaleValid(partialLocale)?partialLocale:FALLBACK_LOCALE$3;phet.chipper.locale=validInitialLocale;class LocaleProperty extends Property{unguardedSet(e){availableRuntimeLocales.includes(e)?super.unguardedSet(e):assert&&assert(!1,"Unsupported locale: "+e)}}const localeProperty=new LocaleProperty(validInitialLocale,{tandem:Tandem.GENERAL_MODEL.createTandem("localeProperty"),phetioFeatured:!0,phetioValueType:StringIO,validValues:availableRuntimeLocales,phetioDocumentation:"Specifies language currently displayed in the simulation"});var ur,pr;if((pr=(ur=phet==null?void 0:phet.chipper)==null?void 0:ur.queryParameters)!=null&&pr.keyboardLocaleSwitcher){const o=KeyboardUtils.KEY_I,e=KeyboardUtils.KEY_U;globalKeyStateTracker$1.keydownEmitter.addListener(t=>{const n=r=>{t.preventDefault();const a=(availableRuntimeLocales.indexOf(localeProperty.value)+r+availableRuntimeLocales.length)%availableRuntimeLocales.length;localeProperty.value=availableRuntimeLocales[a],console.log(localeProperty.value)};t.ctrlKey&&!t.shiftKey&&!t.metaKey&&!t.altKey&&(KeyboardUtils.isKeyEvent(t,o)?n(1):KeyboardUtils.isKeyEvent(t,e)&&n(-1))})}joist.register("localeProperty",localeProperty);const fallbackLocalesProperty=new Property([],{tandem:Tandem.GENERAL_MODEL.createTandem("fallbackLocalesProperty"),phetioDocumentation:'An ordered list of locales to "fall back" on when a translation is missing for the selected locale, for example: ["es", "de" ]. "en" will always be added to the end of this, because it has guaranteed full coverage of all translated keys.',phetioFeatured:!0,isValidValue:o=>_.every(o,e=>!!localeInfoModule[e]),phetioValueType:ArrayIO(StringIO)});joist.register("fallbackLocalesProperty",fallbackLocalesProperty);const FALLBACK_LOCALE$2="en",localeOrderProperty=new DerivedProperty([localeProperty,fallbackLocalesProperty],(o,e)=>{const t=[o],n=o.slice(0,2);o!==n&&!t.includes(n)&&t.push(n);for(let s=0;s<e.length;s++){const a=e[s];t.includes(a)||t.push(a)}t.includes(FALLBACK_LOCALE$2)||t.push(FALLBACK_LOCALE$2);const r=t.indexOf(FALLBACK_LOCALE$2);return assert&&assert(r>=0,`Required local in localeOrderProperty: ${FALLBACK_LOCALE$2}`),t.slice(0,r+1)});joist.register("localeOrderProperty",localeOrderProperty);const chipper=new Namespace("chipper");class LocalizedStringProperty extends DynamicProperty{constructor(e,t,n){const r=n&&typeof n.phetioReadOnly=="boolean"?n.phetioReadOnly:TandemConstants.PHET_IO_OBJECT_METADATA_DEFAULTS.phetioReadOnly,s=n&&typeof n.phetioFeatured=="boolean"?n.phetioFeatured:!0,a=n&&typeof n.phetioDocumentation=="string"?n.phetioDocumentation:TandemConstants.PHET_IO_OBJECT_METADATA_DEFAULTS.phetioDocumentation;super(localeProperty,{derive:h=>e.getLocaleSpecificProperty(h),bidirectional:!0,phetioValueType:StringIO,phetioState:!1,tandem:t,phetioFeatured:s,phetioReadOnly:r,phetioDocumentation:a}),this.localizedString=e}get stringKey(){return this.localizedString.stringKey}}chipper.register("LocalizedStringProperty",LocalizedStringProperty);const FALLBACK_LOCALE$1="en";class LocalizedString{constructor(e,t,n,r){this.stringKey=e,this.localePropertyMap=new Map,this.initialValues={},this.englishProperty=new TinyProperty(t),this.initialValues[FALLBACK_LOCALE$1]=t,this.localeOrderListener=this.onLocaleOrderChange.bind(this),localeOrderProperty.lazyLink(this.localeOrderListener),this.property=new LocalizedStringProperty(this,n,r),localizedStrings.push(this)}setInitialValue(e,t){this.initialValues[e]=t,this.getLocaleSpecificProperty(e).value=t}getStateDelta(){const e={};return this.usedLocales.forEach(t=>{const n=this.getRawStringValue(t);n!==null&&n!==this.initialValues[t]&&(e[t]=n)}),e}setStateDelta(e){Object.keys(e).forEach(t=>this.getLocaleSpecificProperty(t)),this.usedLocales.forEach(t=>{const n=this.getLocaleSpecificProperty(t),r=this.initialValues[t]!==void 0?this.initialValues[t]:null,s=e[t]!==void 0?e[t]:null;s===null?r===null?n.clearOverride():n.value=r:n.value=s})}getRawStringValue(e){const t=this.getLocaleSpecificProperty(e);return t instanceof TinyOverrideProperty?t.isOverridden?t.value:null:t.value}get usedLocales(){return[FALLBACK_LOCALE$1,...this.localePropertyMap.keys()]}onLocaleOrderChange(e){const t=[...this.usedLocales,...e];for(let n=t.length-1;n>=0;n--){const r=t[n],s=this.getLocaleSpecificProperty(r);s instanceof TinyOverrideProperty&&(s.targetProperty=this.getLocaleSpecificProperty(LocalizedString.getFallbackLocale(r)))}}getLocaleSpecificProperty(e){return e==="en"?this.englishProperty:(this.localePropertyMap.has(e)||this.localePropertyMap.set(e,new TinyOverrideProperty(this.getLocaleSpecificProperty(LocalizedString.getFallbackLocale(e)))),this.localePropertyMap.get(e))}static getFallbackLocale(e){if(e==="en")return"en";const t=localeOrderProperty.value,n=t.indexOf(e);return n>=0?(assert&&assert(t[t.length-1]==="en"),assert&&assert(n+1<t.length),t[n+1]):e.includes("_")?e.slice(0,2):"en"}dispose(){localeOrderProperty.unlink(this.localeOrderListener),this.property.dispose(),arrayRemove(localizedStrings,this)}restoreInitialValue(e){assert&&assert(typeof this.initialValues[e]=="string","initial value expected for",e),this.property.value=this.initialValues[e]}}chipper.register("LocalizedString",LocalizedString);const FALLBACK_LOCALE="en",localizedStrings=[];window.phet.chipper.localizedStrings=localizedStrings;window.phet.chipper.setAllStrings=o=>{localizedStrings.forEach(e=>{e.property.value=o})};const stringKeyToTandemName=o=>o.replace(/(?:[-_\s]\w)/g,e=>e[1].toUpperCase()),StringStateIOType=new IOType("StringStateIO",{valueType:PhetioObject,toStateObject:()=>{const o={};return localizedStrings.forEach(e=>{const t=e.getStateDelta();Object.keys(t).length>0&&(o[e.property.tandem.phetioID]=t)}),{data:o}},stateSchema:{data:ObjectLiteralIO},applyState:(o,e)=>{Object.keys(e.data).forEach(t=>{if(!localizedStrings.find(r=>r.property.tandem.phetioID===t))throw new CouldNotYetDeserializeError}),localizedStrings.forEach(t=>{t.setStateDelta(e.data[t.property.tandem.phetioID]||{})})}});PhetioObject.create({phetioType:StringStateIOType,tandem:Tandem.GENERAL_MODEL.createTandem("stringsState"),phetioDocumentation:"Strings that have changed from their initial values. Each string value is specific to the locale it changed in.",phetioState:!0});const getStringModule=o=>{assert&&assert(typeof phet.chipper.locale=="string","phet.chipper.locale should have been loaded by now"),assert&&assert(Object.keys(localeInfoModule).includes(phet.chipper.locale),"phet.chipper.locale should have been loaded by now"),assert&&assert(phet.chipper.strings,"phet.chipper.strings should have been loaded by now");const e=`${o}/`;let t=Object.keys(phet.chipper.strings[FALLBACK_LOCALE]).filter(r=>r.startsWith(e));phet.chipper.usedStringsEN&&(t=t.filter(r=>phet.chipper.usedStringsEN.hasOwnProperty(r)));const n={};return t.forEach(r=>{const a=r.slice(e.length).split("."),h=a[a.length-1],c=a.slice(0,a.length-1);let d=n,y=e;if(c.forEach((g,D)=>{y+=`${D>0?".":""}${g}`,assert&&assert(typeof d[g]!="string",`It is not allowed to have two different string keys where one is extended by adding a period (.) at the end of the other. The string key ${y} is extended by ${r} in this case, and should be changed.`),d[g]||(d[g]={}),d=d[g]}),assert&&assert(typeof d[h]!="object",`It is not allowed to have two different string keys where one is extended by adding a period (.) at the end of the other. The string key ${r} is extended by another key, something containing ${d[h]&&Object.keys(d[h])}.`),assert&&assert(!d[h],`We should not have defined this place in the object (${r}), otherwise it means a duplicated string key OR extended string key`),typeof d!="string"){let g=Tandem.STRINGS.createTandem(_.camelCase(o));for(let O=0;O<a.length;O++){let V=stringKeyToTandemName(a[O]);if(O===a.length-1){let k=V,M=0,N=!0;for(;N;)M++,k=`${V}${M===1?"":M}StringProperty`,N=g.hasChild(k);V=k}g=g.createTandem(V)}g.phetioID.includes(".a11y.")&&(g=Tandem.OPT_OUT);const D=new LocalizedString(r,phet.chipper.mapString(phet.chipper.strings[FALLBACK_LOCALE][r]),g,phet.chipper.stringMetadata[r]);Object.keys(phet.chipper.strings).forEach(O=>{const V=phet.chipper.strings[O][r];typeof V=="string"&&V!==""&&D.setInitialValue(O,phet.chipper.mapString(V))}),d[`${h}StringProperty`]=D.property,D.property.link(O=>{d[h]=O})}}),n},SceneryPhetStrings=getStringModule("SCENERY_PHET");sceneryPhet.register("SceneryPhetStrings",SceneryPhetStrings);class PDOMSectionNode extends Node$2{constructor(e,t){super(optionize()({containerTagName:"section",tagName:"div",labelContent:e,labelTagName:"h2"},t))}}sceneryPhet.register("PDOMSectionNode",PDOMSectionNode);class ControlAreaNode extends PDOMSectionNode{constructor(e){super(SceneryPhetStrings.a11y.simSection.controlAreaStringProperty,e)}}sceneryPhet.register("ControlAreaNode",ControlAreaNode);class PlayAreaNode extends PDOMSectionNode{constructor(e){super(SceneryPhetStrings.a11y.simSection.playAreaStringProperty,e)}}sceneryPhet.register("PlayAreaNode",PlayAreaNode);class ScreenSummaryNode extends Node$2{constructor(){super(),this.openingSummaryNode=new Node$2({tagName:"p"});const e=new Node$2({tagName:"p",innerContent:SceneryPhetStrings.a11y.simSection.screenSummary.keyboardShortcutsHintStringProperty});this.addChild(this.openingSummaryNode),this.addChild(e),this.pdomOrder=[this.openingSummaryNode,null,e]}setIntroString(e,t,n){this.openingSummaryNode.innerContent=n&&t?StringUtils.fillIn(SceneryPhetStrings.a11y.simSection.screenSummary.multiScreenIntroStringProperty,{screen:t}):StringUtils.fillIn(SceneryPhetStrings.a11y.simSection.screenSummary.singleScreenIntroPatternStringProperty,{sim:e})}}sceneryPhet.register("ScreenSummaryNode",ScreenSummaryNode);const DEFAULT_LAYOUT_BOUNDS=new Bounds2(0,0,1024,618),Hi=class Hi extends Node$2{constructor(e){const t=optionize()({layoutBounds:DEFAULT_LAYOUT_BOUNDS.copy(),layerSplit:!0,excludeInvisible:!0,tandem:Tandem.REQUIRED,visiblePropertyOptions:{phetioState:!1,phetioReadOnly:!0},containerTagName:"article",tagName:"div",screenSummaryContent:null,includePDOMNodes:!0},e);super(t),this._screenSummaryContent=null,assert&&this.isPhetioInstrumented()&&assert&&assert(t.tandem.name==="view","tandem name should be view"),this.layoutBounds=t.layoutBounds,this.visibleBoundsProperty=new Property(t.layoutBounds),this.pdomTitleNode=new Node$2({tagName:"h1",focusHighlight:"invisible"}),this.pdomPlayAreaNode=new PlayAreaNode,this.pdomControlAreaNode=new ControlAreaNode,this.pdomScreenSummaryNode=new ScreenSummaryNode,t.screenSummaryContent&&this.setScreenSummaryContent(t.screenSummaryContent),this.visibleProperty.lazyLink(n=>{n?(assert&&assert(!this.pdomTitleNode.focusable,"about to set to be focusable"),this.pdomTitleNode.focusable=!0,this.pdomTitleNode.focus()):this.pdomTitleNode.focusable=!1}),this.pdomTitleNode.addInputListener({blur:()=>{this.pdomTitleNode.focusable=!1}}),this.pdomParentNode=new Node$2({children:t.includePDOMNodes?[this.pdomTitleNode,this.pdomScreenSummaryNode,this.pdomControlAreaNode,this.pdomPlayAreaNode]:[this.pdomTitleNode]}),this.addChild(this.pdomParentNode),this.pdomParentNode.pdomOrder=t.includePDOMNodes?[this.pdomTitleNode,this.pdomScreenSummaryNode,this.pdomPlayAreaNode,this.pdomControlAreaNode]:[this.pdomTitleNode]}setPDOMOrder(e){throw new Error("should not need to set accessible order on a ScreenView")}setChildren(e){return Node$2.prototype.setChildren.call(this,e),this.pdomParentNode&&!this.hasChild(this.pdomParentNode)&&(this.addChild(this.pdomParentNode),this.pdomParentNode.moveToBack()),this}getLayoutScale(e){return Hi.getLayoutScale(this.layoutBounds,e)}layout(e,t){this.matrix=Hi.getLayoutMatrix(this.layoutBounds,e,t),this.visibleBoundsProperty.value=this.parentToLocalBounds(e)}get screenSummaryContent(){return this._screenSummaryContent}set screenSummaryContent(e){this.setScreenSummaryContent(e)}setScreenSummaryContent(e){assert&&assert(e!==this._screenSummaryContent,"this is already the screen summary Node content"),this._screenSummaryContent&&this.pdomScreenSummaryNode.removeChild(this._screenSummaryContent),this._screenSummaryContent=e,e&&this.pdomScreenSummaryNode.addChild(e)}setScreenSummaryIntroAndTitle(e,t,n,r){this.pdomScreenSummaryNode.setIntroString(e,t,r),this.pdomTitleNode.innerContent=n}getVoicingOverviewContent(){throw new Error("The ScreenView should implement getVoicingOverviewContent if Voicing is enabled")}getVoicingDetailsContent(){throw new Error("The ScreenView should implement getVoicingDetailsContent when the Voicing feature is enabled.")}getVoicingHintContent(){throw new Error("The ScreenView should implement getVoicingHintContent when Voicing is enabled.")}interruptSubtreeInput(){var e,t,n;return(n=(t=(e=window.phet)==null?void 0:e.joist)==null?void 0:t.display)==null||n.interruptOtherPointers(),super.interruptSubtreeInput()}static getLayoutScale(e,t){return Math.min(t.width/e.width,t.height/e.height)}static getLayoutMatrix(e,t,n){const r=optionize()({verticalAlign:"center"},n),s=t.width,a=t.height,h=Hi.getLayoutScale(e,t);let c=0,d=0;return h===s/e.width?(d=a/h-e.height,r.verticalAlign==="center"&&(d/=2)):h===a/e.height&&(c=(s/h-e.width)/2),Matrix3.rowMajor(h,0,c*h+t.left,0,h,d*h+t.top,0,0,1)}step(e){}};Hi.DEFAULT_LAYOUT_BOUNDS=DEFAULT_LAYOUT_BOUNDS;let ScreenView=Hi;joist.register("ScreenView",ScreenView);const DARK_GREEN=new Color(0,200,0),RED_COLORBLIND=new Color(255,85,0),GREEN_COLORBLIND=new Color(0,135,0),PHET_LOGO_BLUE=new Color(106,206,245),PHET_LOGO_YELLOW=new Color(254,225,5),PhetColorScheme={ACCELERATION:new Color(255,255,50),APPLIED_FORCE:new Color(236,153,55),BUTTON_YELLOW:PHET_LOGO_YELLOW,ELASTIC_POTENTIAL_ENERGY:new Color(0,204,255),FRICTION_FORCE:RED_COLORBLIND,GRAVITATIONAL_FORCE:new Color(50,130,215),GRAVITATIONAL_POTENTIAL_ENERGY:new Color(55,130,215),HEAT_THERMAL_ENERGY:RED_COLORBLIND,IMAGINARY_PART:new Color(153,51,102),KINETIC_ENERGY:new Color(30,200,45),MOMENTUM:new Color(50,50,255),NET_WORK:DARK_GREEN,NORMAL_FORCE:new Color(255,235,0),PHET_LOGO_BLUE,PHET_LOGO_YELLOW,POSITION:Color.BLUE,REAL_PART:new Color(255,153,0),RED_COLORBLIND,RESET_ALL_BUTTON_BASE_COLOR:new Color(247,151,34),GREEN_COLORBLIND,TOTAL_ENERGY:new Color(180,180,0),TOTAL_FORCE:DARK_GREEN,VELOCITY:new Color(50,255,50),WALL_FORCE:new Color(153,51,0),SCREEN_ICON_FRAME:"#dddddd"};sceneryPhet.register("PhetColorScheme",PhetColorScheme);class CloseButton extends RectangularPushButton{constructor(e){const t=optionize()({iconLength:16,pathOptions:{stroke:"white",lineWidth:2.5,lineCap:"round"},baseColor:PhetColorScheme.RED_COLORBLIND,xMargin:4,yMargin:4,innerContent:SceneryPhetStrings.a11y.closeStringProperty,voicingNameResponse:SceneryPhetStrings.a11y.closeStringProperty},e),n=new Shape$1().moveTo(-t.iconLength/2,-t.iconLength/2).lineTo(t.iconLength/2,t.iconLength/2).moveTo(t.iconLength/2,-t.iconLength/2).lineTo(-t.iconLength/2,t.iconLength/2);t.content=new Path(n,t.pathOptions),super(t)}}sceneryPhet.register("CloseButton",CloseButton);const DynamicMarkerIO=new IOType("DynamicMarkerIO",{supertype:IOType.ObjectIO,applyState:_.noop,toStateObject:()=>({}),isValidValue:_.stubTrue,documentation:"PhET-iO Type used as a place holder for dynamic elements to be created when set for state."});tandemNamespace.register("DynamicMarkerIO",DynamicMarkerIO);const Popupable=(o,e)=>class extends o{constructor(...t){var c;super(...t);const n=t[e]||{},r=t[t.length-1];assert&&assert(r!==void 0,"config object is required for Popupable.");const s=gracefulBind("phet.joist.sim.showPopup"),a=gracefulBind("phet.joist.sim.hidePopup"),h=optionize()({showPopup:s,hidePopup:a,isModal:!0,layoutBounds:null,focusOnShowNode:null,focusOnHideNode:null,disableModals:_.get(window,"phet.chipper.queryParameters.disableModals")||!1},n);assert&&assert(h.isModal,"Non-modal popups not currently supported"),this.layoutBounds=h.layoutBounds,this._focusOnShowNode=h.focusOnShowNode,this.disableModals=h.disableModals,this.isModal=h.isModal,this._focusOnHideNode=h.focusOnHideNode,this._nodeToFocusOnHide=null,this.popupParent=new PopupParentNode(this,{show:this.show.bind(this),hide:this.hide.bind(this),layout:this.layout.bind(this)}),this.isShowingProperty=new BooleanProperty(!1,{tandem:(c=h.tandem)==null?void 0:c.createTandem("isShowingProperty"),phetioReadOnly:!0,phetioFeatured:!0}),this.isShowingProperty.lazyLink(d=>{d?h.showPopup(this.popupParent,h.isModal):h.hidePopup(this.popupParent,h.isModal)})}layout(t){this.layoutBounds&&(this.popupParent.matrix=ScreenView.getLayoutMatrix(this.layoutBounds,t))}shouldShowPopup(){return!(this.isModal&&this.disableModals)}show(){this.shouldShowPopup()&&(this._nodeToFocusOnHide=this._focusOnHideNode||FocusManager.pdomFocusedNode,this.isShowingProperty.value=!0,this._focusOnShowNode&&this._focusOnShowNode.focusable&&this._focusOnShowNode.focus())}hide(){var t;this.interruptSubtreeInput(),this.isShowingProperty.value=!1,this._nodeToFocusOnHide&&this._nodeToFocusOnHide.focusable&&((t=this._nodeToFocusOnHide.instances[0])!=null&&t.visible)&&this._nodeToFocusOnHide.focus()}get focusOnHideNode(){return this._focusOnHideNode}dispose(){this.hide(),this.isShowingProperty.dispose(),super.dispose()}};class PopupParentNode extends Node$2{constructor(e,t){const n=optionize()({children:[e]},t);super(n),this.show=n.show,this.hide=n.hide,this.layout=n.layout}}sun.register("Popupable",Popupable);const SunStrings=getStringModule("SUN");sun.register("SunStrings",SunStrings);const ws=class ws extends Popupable(Panel,1){constructor(e,t){var V;const n=optionize()({xSpacing:10,ySpacing:10,topMargin:15,bottomMargin:15,leftMargin:null,maxWidthMargin:12,maxHeightMargin:12,closeButtonLength:18.2,closeButtonTopMargin:10,closeButtonRightMargin:10,title:null,titleAlign:"center",addAriaLabelledByFromTitle:!0,layoutStrategy:defaultLayoutStrategy,closeButtonListener:()=>this.hide(),closeButtonColor:"black",closeButtonTouchAreaXDilation:0,closeButtonTouchAreaYDilation:0,closeButtonMouseAreaXDilation:0,closeButtonMouseAreaYDilation:0,closeButtonVoicingDialogTitle:null,closeButtonLastInPDOM:!1,openedSoundPlayer:generalOpenSoundPlayer,closedSoundPlayer:generalCloseSoundPlayer,sim:getGlobal("phet.joist.sim"),showCallback:null,hideCallback:null,layoutBounds:ScreenView.DEFAULT_LAYOUT_BOUNDS,focusOnShowNode:null,cornerRadius:10,resize:!0,fill:"white",stroke:"black",backgroundPickable:!0,maxHeight:null,maxWidth:null,tandemNameSuffix:["Dialog",DYNAMIC_ARCHETYPE_NAME],phetioType:ws.DialogIO,phetioState:!0,phetioVisiblePropertyInstrumented:!1,tagName:"div",ariaRole:"dialog"},t);assert&&assert(n.sim,"sim must be provided, as Dialog needs a Sim instance"),assert&&assert(n.xMargin===void 0,"Dialog sets xMargin"),n.xMargin=0,assert&&assert(n.yMargin===void 0,"Dialog sets yMargin"),n.yMargin=0,n.leftMargin===null&&(n.leftMargin=n.xSpacing+n.closeButtonLength+n.closeButtonRightMargin),assert&&assert(n.maxHeight===null||typeof n.maxHeight=="number"),assert&&assert(n.maxWidth===null||typeof n.maxWidth=="number"),!n.maxWidth&&n.layoutBounds&&(n.maxWidth=applyDoubleMargin(n.layoutBounds.width,n.maxWidthMargin)),!n.maxHeight&&n.layoutBounds&&(n.maxHeight=applyDoubleMargin(n.layoutBounds.height,n.maxHeightMargin));const r=new Utterance({priority:Utterance.MEDIUM_PRIORITY,voicingCanAnnounceProperties:[voicingManager$1.voicingFullyEnabledProperty]}),s=new CloseButton({iconLength:n.closeButtonLength,baseColor:"transparent",buttonAppearanceStrategy:ButtonNode.FlatAppearanceStrategy,xMargin:0,yMargin:0,listener:()=>{s.voicingSpeakContextResponse({utterance:r}),n.closeButtonListener()},pathOptions:{stroke:n.closeButtonColor},tandem:(V=n.tandem)==null?void 0:V.createTandem("closeButton"),phetioState:!1,phetioVisiblePropertyInstrumented:!1,phetioEnabledPropertyInstrumented:!1,soundPlayer:nullSoundPlayer,tagName:"button",innerContent:SunStrings.a11y.closeStringProperty,voicingContextResponse:SunStrings.a11y.closedStringProperty});let a;if(n.closeButtonVoicingDialogTitle){const k=typeof n.closeButtonVoicingDialogTitle=="string"?new TinyProperty(n.closeButtonVoicingDialogTitle):n.closeButtonVoicingDialogTitle;a=s.voicingNameResponse=new PatternStringProperty(SunStrings.a11y.titleClosePatternStringProperty,{title:k},{tandem:Tandem.OPT_OUT})}s.touchArea=s.bounds.dilatedXY(n.closeButtonTouchAreaXDilation,n.closeButtonTouchAreaYDilation),s.mouseArea=s.bounds.dilatedXY(n.closeButtonMouseAreaXDilation,n.closeButtonMouseAreaYDilation);let h=[n.title,e];n.closeButtonLastInPDOM?h.push(s):h.unshift(s),h=h.filter(k=>k!=null),assert&&assert(h[0]),n.focusOnShowNode=n.focusOnShowNode?n.focusOnShowNode:h[0].focusable?h[0]:s,assert&&assert(n.focusOnShowNode instanceof Node$2,"should be non-null and defined"),assert&&assert(n.focusOnShowNode.focusable,"focusOnShowNode must be focusable.");const c=new VBox({children:n.title?[n.title,e]:[e],spacing:n.ySpacing,align:n.titleAlign}),d=new AlignBox(c,{topMargin:n.topMargin,bottomMargin:n.bottomMargin,leftMargin:n.leftMargin}),y=new AlignBox(s,{topMargin:n.closeButtonTopMargin,rightMargin:n.closeButtonRightMargin}),g=new HBox({children:[d,y],spacing:n.xSpacing,align:"top"});super(g,n),this.isShowingProperty.lazyLink(k=>{k?(n.openedSoundPlayer.play(),n.showCallback&&n.showCallback()):(n.closedSoundPlayer.play(),n.hideCallback&&n.hideCallback())}),this.sim=n.sim,this.closeButton=s;const D=Multilink.multilink([this.sim.boundsProperty,this.sim.screenBoundsProperty,this.sim.scaleProperty,this.sim.selectedScreenProperty,this.isShowingProperty,this.localBoundsProperty],(k,M,N)=>{k&&M&&N&&n.layoutStrategy(this,k,M,N)});this.pdomOrder=h,n.title&&n.title.tagName&&n.addAriaLabelledByFromTitle&&this.addAriaLabelledbyAssociation({thisElementName:PDOMPeer$1.PRIMARY_SIBLING,otherNode:n.title,otherElementName:PDOMPeer$1.PRIMARY_SIBLING});const O=new KeyboardListener({keys:["escape","tab","shift+tab"],callback:(k,M)=>{assert&&assert(k&&k.domEvent,"event should be non-null and defined for this listener");const N=k.domEvent;if(M==="escape")N.preventDefault(),this.hide();else if((M==="tab"||M==="shift+tab")&&FullScreen$1.isFullScreen()){assert&&assert(FocusManager.pdomFocus);const F=FocusManager.pdomFocus.trail.getUniqueId(),G=PDOMUtils$1.getNextFocusable().id===F,ie=PDOMUtils$1.getPreviousFocusable().id===F;G&&ie&&N.preventDefault()}}});this.addInputListener(O),this.disposeDialog=()=>{D.dispose(),y.dispose(),this.removeInputListener(O),O.dispose(),a&&a.dispose(),s.dispose(),r.dispose(),c.dispose(),g.removeAllChildren(),g.detach()}}dispose(){this.disposeDialog(),super.dispose()}};ws.DialogIO=new IOType("DialogIO",{valueType:ws,supertype:DynamicMarkerIO});let Dialog=ws;function defaultLayoutStrategy(o,e,t,n){o.layoutBounds&&(o.center=o.layoutBounds.center)}function applyDoubleMargin(o,e){return o>e*2?o-e*2:o}sun.register("Dialog",Dialog);class HorizontalAquaRadioButtonGroup extends AquaRadioButtonGroup{constructor(e,t,n){super(e,t,optionize()({orientation:"horizontal"},n))}}sun.register("HorizontalAquaRadioButtonGroup",HorizontalAquaRadioButtonGroup);class HSlider extends Slider{constructor(e,t,n){var r,s;super(e,t,optionize()({orientation:Orientation.HORIZONTAL},n)),assert&&((s=(r=phet==null?void 0:phet.chipper)==null?void 0:r.queryParameters)!=null&&s.binder)&&InstanceRegistry.registerDataURL("sun","HSlider",this)}}sun.register("HSlider",HSlider);class MutableOptionsNode extends Node$2{constructor(e,t,n,r,s){super(),this.nodeProperty=new Property(null),this._constructInstance=()=>Reflect.construct(e,[...t,merge(_.mapValues(r,a=>a.value),n)]),this.multilink=Multilink.multilink(_.values(r),this.replaceCopy.bind(this)),this.mutate(s)}replaceCopy(){const e=this._constructInstance(),t=this.nodeProperty.value;this.nodeProperty.value=e,this.addChild(e),t&&(this.removeChild(t),this.disposeCopy(t))}disposeCopy(e){e.dispose&&e.dispose()}dispose(){this.multilink.dispose(),this.disposeCopy(this.nodeProperty.value),this.nodeProperty.dispose(),super.dispose()}}sun.register("MutableOptionsNode",MutableOptionsNode);const ACCESSIBLE_NUMBER_SPINNER_OPTIONS=["pdomTimerDelay","pdomTimerInterval"],AccessibleNumberSpinner=(o,e)=>{const t=DelayedMutate$1("AccessibleNumberSpinner",ACCESSIBLE_NUMBER_SPINNER_OPTIONS,class extends AccessibleValueHandler(o,e){constructor(...r){const s=r[e];assert&&s&&assert(Object.getPrototypeOf(s)===Object.prototype,"Extra prototype on AccessibleSlider options object is a code smell (or probably a bug)");const a=combineOptions({ariaOrientation:Orientation.VERTICAL},s);r[e]=a,super(...r),this._pdomTimerDelay=400,this._pdomTimerInterval=100,assertHasProperties(this,["addInputListener"]),this._callbackTimer=new CallbackTimer({delay:this._pdomTimerDelay,interval:this._pdomTimerInterval}),this.pdomIncrementDownEmitter=new Emitter({parameters:[{valueType:"boolean"}]}),this.pdomDecrementDownEmitter=new Emitter({parameters:[{valueType:"boolean"}]}),this.setPDOMAttribute("aria-roledescription",SunStrings.a11y.numberSpinnerRoleDescriptionStringProperty);let h=null,c=null;const d={keydown:y=>{if(this.enabledProperty.get()&&KeyboardUtils.isRangeKey(y.domEvent)){const g=y.domEvent;g.preventDefault(),g.metaKey||this._callbackTimer.isRunning()||(this._accessibleNumberSpinnerHandleKeyDown(y),h=this._accessibleNumberSpinnerHandleKeyDown.bind(this,y),c=g,this._callbackTimer.addCallback(h),this._callbackTimer.start())}},keyup:y=>{const g=KeyboardUtils.getEventCode(y.domEvent);KeyboardUtils.isRangeKey(y.domEvent)&&(c&&g===KeyboardUtils.getEventCode(c)&&(this._emitKeyState(y.domEvent,!1),this._callbackTimer.stop(!1),assert&&assert(h),this._callbackTimer.removeCallback(h),h=null,c=null),this.handleKeyUp(y))},blur:y=>{h&&(assert&&assert(c!==null,"key should be down if running downCallback"),this._emitKeyState(c,!1),this._callbackTimer.stop(!1),this._callbackTimer.removeCallback(h)),this.handleBlur(y)},input:this.handleInput.bind(this),change:this.handleChange.bind(this)};this.addInputListener(d),this._disposeAccessibleNumberSpinner=()=>{this._callbackTimer.dispose(),this.pdomIncrementDownEmitter.dispose(),this.pdomDecrementDownEmitter.dispose(),this.removeInputListener(d)}}set pdomTimerDelay(r){this._pdomTimerDelay=r,this._callbackTimer&&(this._callbackTimer.delay=r)}get pdomTimerDelay(){return this._pdomTimerDelay}set pdomTimerInterval(r){this._pdomTimerInterval=r,this._callbackTimer&&(this._callbackTimer.interval=r)}get pdomTimerInterval(){return this._pdomTimerInterval}_accessibleNumberSpinnerHandleKeyDown(r){assert&&assert(r.domEvent,"must have a domEvent"),this.handleKeyDown(r),this._emitKeyState(r.domEvent,!0)}_emitKeyState(r,s){validate(r,{valueType:Event}),KeyboardUtils.isAnyKeyEvent(r,[KeyboardUtils.KEY_UP_ARROW,KeyboardUtils.KEY_RIGHT_ARROW])?this.pdomIncrementDownEmitter.emit(s):KeyboardUtils.isAnyKeyEvent(r,[KeyboardUtils.KEY_DOWN_ARROW,KeyboardUtils.KEY_LEFT_ARROW])&&this.pdomDecrementDownEmitter.emit(s)}dispose(){this._disposeAccessibleNumberSpinner(),super.dispose()}});return t.prototype._mutatorKeys=ACCESSIBLE_NUMBER_SPINNER_OPTIONS.concat(t.prototype._mutatorKeys),assert&&assert(t.prototype._mutatorKeys.length===_.uniq(t.prototype._mutatorKeys).length,"duplicate mutator keys in AccessibleNumberSpinner"),t};sun.register("AccessibleNumberSpinner",AccessibleNumberSpinner);const sceneryPhetQueryParameters=QueryStringMachine.getAll({backgroundColor:{type:"string",defaultValue:"white"},fontFamily:{type:"string",defaultValue:"Arial"}});sceneryPhet.register("sceneryPhetQueryParameters",sceneryPhetQueryParameters);class PhetFont extends Font{constructor(e){assert&&assert(arguments.length===0||arguments.length===1,"Too many arguments");let t;typeof e=="number"||typeof e=="string"?t={size:e}:t=e||{},t=combineOptions({family:sceneryPhetQueryParameters.fontFamily},t),assert&&assert(t.family),t.family=[t.family,"sans-serif"].join(", "),super(t)}}sceneryPhet.register("PhetFont",PhetFont);const MathSymbols={PLUS:"+",MINUS:"−",TIMES:"×",DIVIDE:"÷",DOT:"⋅",UNARY_PLUS:"+",UNARY_MINUS:"-",EQUAL_TO:"=",NOT_EQUAL_TO:"≠",GREATER_THAN:">",LESS_THAN:"<",LESS_THAN_OR_EQUAL:"≤",GREATER_THAN_OR_EQUAL:"≥",PERCENT:"%",INFINITY:"∞",PI:"π",PLUS_MINUS:"±",THETA:"θ",NO_VALUE:"—",DEGREES:"°"};sceneryPhet.register("MathSymbols",MathSymbols);const ButtonStateValues=["up","down","over","out"];class NumberPicker extends AccessibleNumberSpinner(Node$2,0){constructor(e,t,n){var nt,Qe;const r=optionize()({color:new Color(0,0,255),backgroundColor:"white",cornerRadius:6,xMargin:3,yMargin:3,decimalPlaces:0,font:new PhetFont(24),incrementFunction:Be=>Be+1,decrementFunction:Be=>Be-1,timerDelay:400,timerInterval:100,noValueString:MathSymbols.NO_VALUE,align:"center",touchAreaXDilation:10,touchAreaYDilation:10,mouseAreaXDilation:0,mouseAreaYDilation:5,backgroundStroke:"gray",backgroundLineWidth:.5,arrowHeight:6,arrowYSpacing:3,arrowStroke:"black",arrowLineWidth:.25,valueMaxWidth:null,onInput:_.noop,incrementEnabledFunction:(Be,We)=>Be!=null&&Be<We.max,decrementEnabledFunction:(Be,We)=>Be!=null&&Be>We.min,disabledOpacity:SceneryConstants.DISABLED_OPACITY,valueChangedSoundPlayer:generalSoftClickSoundPlayer,boundarySoundPlayer:generalBoundaryBoopSoundPlayer,cursor:"pointer",valueProperty:e,enabledRangeProperty:t,pageKeyboardStep:2,voicingObjectResponse:()=>e.value,tandem:Tandem.REQUIRED,tandemNameSuffix:"Picker",phetioReadOnly:PhetioObject.DEFAULT_OPTIONS.phetioReadOnly,visiblePropertyOptions:{phetioFeatured:!0},phetioEnabledPropertyInstrumented:!0,phetioFeatured:!0},n);r.formatValue||(r.formatValue=Be=>DotUtils.toFixed(Be,r.decimalPlaces));let s=null;r.pressedColor===void 0&&(s=new PaintColorProperty(r.color),r.pressedColor=new DerivedProperty([s],Be=>Be.darkerColor()));let a=e.value;const h=r.onInput;r.onInput=()=>{h(),e.value!==a&&(e.value===t.get().max||e.value===t.get().min?r.boundarySoundPlayer.play():r.valueChangedSoundPlayer.play()),a=e.value},assert&&assert(!r.keyboardStep,"NumberPicker sets its own keyboardStep"),assert&&assert(!r.shiftKeyboardStep,"NumberPicker sets its own shiftKeyboardStep");const c=r.incrementFunction(e.get())-e.get();r.keyboardStep=c,r.shiftKeyboardStep=c,r.pdomTimerDelay=r.timerDelay,r.pdomTimerInterval=r.timerInterval;const d=_.pick(r,Node$2.REQUIRES_BOUNDS_OPTION_KEYS);super(_.omit(r,Node$2.REQUIRES_BOUNDS_OPTION_KEYS));const y=new StringUnionProperty("up",{validValues:ButtonStateValues}),g=new StringUnionProperty("down",{validValues:ButtonStateValues}),D=new DerivedProperty([e,t],r.incrementEnabledFunction),O=new DerivedProperty([e,t],r.decrementEnabledFunction),V=new Text("",{font:r.font,pickable:!1});let k=t.get().min;const M=[];for(;k<=t.get().max;)M.push(k),k=r.incrementFunction(k),assert&&assert(M.length<5e5,"Don't infinite loop here");let N=Math.max.apply(null,M.map(Be=>(V.string=r.formatValue(Be),V.width)));r.valueMaxWidth!==null&&(N=Math.min(N,r.valueMaxWidth));const F=N+2*r.xMargin,G=V.height+2*r.yMargin,ie=1,Z=r.cornerRadius;V.maxWidth=N;const W=new Path(new Shape$1().arc(Z,Z,Z,Math.PI,Math.PI*3/2,!1).arc(F-Z,Z,Z,-Math.PI/2,0,!1).lineTo(F,G/2+ie).lineTo(0,G/2+ie).close(),{pickable:!1}),X=new Path(new Shape$1().arc(F-Z,G-Z,Z,0,Math.PI/2,!1).arc(Z,G-Z,Z,Math.PI/2,Math.PI,!1).lineTo(0,G/2).lineTo(F,G/2).close(),{pickable:!1}),J=new Rectangle(0,0,F,G,Z,Z,{pickable:!1,stroke:r.backgroundStroke,lineWidth:r.backgroundLineWidth}),oe=new Dimension2(.5*F,r.arrowHeight),le={stroke:r.arrowStroke,lineWidth:r.arrowLineWidth,pickable:!1};this.incrementArrow=new Path(new Shape$1().moveTo(oe.width/2,0).lineTo(oe.width,oe.height).lineTo(0,oe.height).close(),le),this.incrementArrow.centerX=W.centerX,this.incrementArrow.bottom=W.top-r.arrowYSpacing,this.decrementArrow=new Path(new Shape$1().moveTo(oe.width/2,oe.height).lineTo(0,0).lineTo(oe.width,0).close(),le),this.decrementArrow.centerX=X.centerX,this.decrementArrow.top=X.bottom+r.arrowYSpacing;const pe=new Node$2({children:[W,this.incrementArrow]});pe.addChild(new Rectangle(pe.localBounds));const ve=new Node$2({children:[X,this.decrementArrow]});ve.addChild(new Rectangle(ve.localBounds)),this.addChild(pe),this.addChild(ve),this.addChild(J),this.addChild(V),pe.touchArea=Shape$1.rectangle(pe.left-r.touchAreaXDilation/2,pe.top-r.touchAreaYDilation,pe.width+r.touchAreaXDilation,pe.height+r.touchAreaYDilation),ve.touchArea=Shape$1.rectangle(ve.left-r.touchAreaXDilation/2,ve.top,ve.width+r.touchAreaXDilation,ve.height+r.touchAreaYDilation),pe.mouseArea=Shape$1.rectangle(pe.left-r.mouseAreaXDilation/2,pe.top-r.mouseAreaYDilation,pe.width+r.mouseAreaXDilation,pe.height+r.mouseAreaYDilation),ve.mouseArea=Shape$1.rectangle(ve.left-r.mouseAreaXDilation/2,ve.top,ve.width+r.mouseAreaXDilation,ve.height+r.mouseAreaYDilation);const Oe={up:r.color,over:r.color,down:r.pressedColor,out:r.color,disabled:"rgb(176,176,176)"},He=createVerticalGradient(r.color,r.backgroundColor,r.color,G),Ue=createVerticalGradient(r.pressedColor,r.backgroundColor,r.pressedColor,G),Le={up:r.backgroundColor,over:He,down:Ue,out:Ue,disabled:r.backgroundColor},Ae={fireOnHold:!0,fireOnHoldDelay:r.timerDelay,fireOnHoldInterval:r.timerInterval};this.incrementInputListener=new NumberPickerInputListener(y,combineOptions({tandem:r.tandem.createTandem("incrementInputListener"),fire:Be=>{e.set(Math.min(r.incrementFunction(e.get()),t.get().max)),r.onInput(Be),this.voicingSpeakFullResponse({nameResponse:null,hintResponse:null})}},Ae)),pe.addInputListener(this.incrementInputListener),this.decrementInputListener=new NumberPickerInputListener(g,combineOptions({tandem:r.tandem.createTandem("decrementInputListener"),fire:Be=>{e.set(Math.max(r.decrementFunction(e.get()),t.get().min)),r.onInput(Be),this.voicingSpeakFullResponse({nameResponse:null,hintResponse:null})}},Ae)),ve.addInputListener(this.decrementInputListener),D.link(Be=>{!Be&&this.incrementInputListener.interrupt(),pe.pickable=Be}),O.link(Be=>{!Be&&this.decrementInputListener.interrupt(),ve.pickable=Be});const ae=Be=>{if(Be==null)V.string=r.noValueString,V.x=(F-V.width)/2;else if(V.string=r.formatValue(Be),r.align==="center")V.centerX=W.centerX;else if(r.align==="right")V.right=W.right-r.xMargin;else if(r.align==="left")V.left=W.left+r.xMargin;else throw new Error(`unsupported value for options.align: ${r.align}`);V.centerY=G/2};e.link(ae),Multilink.multilink([y,D],(Be,We)=>{updateColors(Be,We,W,this.incrementArrow,Le,Oe)}),Multilink.multilink([g,O],(Be,We)=>{updateColors(Be,We,X,this.decrementArrow,Le,Oe)});const Ie=this.localBounds.dilated(HighlightPath$1.getDilationCoefficient(this));this.focusHighlight=new HighlightPath$1(Shape$1.roundedRectangleWithRadii(Ie.minX,Ie.minY,Ie.width,Ie.height,{topLeft:r.cornerRadius,topRight:r.cornerRadius,bottomLeft:r.cornerRadius,bottomRight:r.cornerRadius})),this.pdomIncrementDownEmitter.addListener(Be=>{y.value=Be?"down":"up"}),this.pdomDecrementDownEmitter.addListener(Be=>{g.value=Be?"down":"up"}),this.addLinkedElement(e,{tandemName:"valueProperty"}),this.mutate(d),this.disposeNumberPicker=()=>{s&&s.dispose(),D.dispose(),O.dispose(),e.hasListener(ae)&&e.unlink(ae)},assert&&((Qe=(nt=phet==null?void 0:phet.chipper)==null?void 0:nt.queryParameters)!=null&&Qe.binder)&&InstanceRegistry.registerDataURL("scenery-phet","NumberPicker",this)}static createIcon(e,t){const n=optionize()({highlightIncrement:!1,highlightDecrement:!1,range:new Range(e-1,e+1),numberPickerOptions:{pickable:!1,tandem:Tandem.OPT_OUT}},t),r=new NumberPicker(new NumberProperty(e),new Property(n.range),n.numberPickerOptions);return r.removeFromPDOM(),n.highlightDecrement&&(r.decrementInputListener.isOverProperty.value=!0),n.highlightIncrement&&(r.incrementInputListener.isOverProperty.value=!0),r}dispose(){this.disposeNumberPicker(),super.dispose()}setArrowsVisible(e){e||(this.incrementInputListener.interrupt(),this.decrementInputListener.interrupt()),this.incrementArrow.visible=e,this.decrementArrow.visible=e}}class NumberPickerInputListener extends FireListener{constructor(e,t){super(t),Multilink.multilink([this.isOverProperty,this.isPressedProperty],(n,r)=>{e.set(n&&!r?"over":n&&r?"down":!n&&!r?"up":"out")})}}function createVerticalGradient(o,e,t,n){return new LinearGradient(0,0,0,n).addColorStop(0,o).addColorStop(.5,e).addColorStop(1,t)}function updateColors(o,e,t,n,r,s){if(e)if(n.stroke="black",o==="up")t.fill=r.up,n.fill=s.up;else if(o==="over")t.fill=r.over,n.fill=s.over;else if(o==="down")t.fill=r.down,n.fill=s.down;else if(o==="out")t.fill=r.out,n.fill=s.out;else throw new Error(`unsupported buttonState: ${o}`);else t.fill=r.disabled,n.fill=s.disabled,n.stroke=s.disabled}sun.register("NumberPicker",NumberPicker);const DEFAULT_FONT=new PhetFont(20),ALIGN_VALUES=["center","left","right"],DEFAULT_DECIMAL_PLACES=0,Cs=class Cs extends Node$2{constructor(e,t,n){var ie,Z,W,X;const r=optionize()({align:"right",valuePattern:SunConstants.VALUE_NAMED_PLACEHOLDER,decimalPlaces:DEFAULT_DECIMAL_PLACES,numberFormatter:null,numberFormatterDependencies:[],useRichText:!1,useFullHeight:!1,textOptions:{font:DEFAULT_FONT,fill:"black",maxWidth:null,phetioReadOnly:!0},xMargin:8,yMargin:2,cornerRadius:0,backgroundFill:"white",backgroundStroke:"lightGray",backgroundLineWidth:1,backgroundLineDash:[],minBackgroundWidth:0,noValueString:MathSymbols.NO_VALUE,noValueAlign:null,noValuePattern:null,tandem:Tandem.OPT_OUT,phetioType:Cs.NumberDisplayIO},n);if(assert){const J=!!r.numberFormatter,oe=r.decimalPlaces!==DEFAULT_DECIMAL_PLACES,le=r.valuePattern!==SunConstants.VALUE_NAMED_PLACEHOLDER,pe=oe||le;(J||pe)&&assert&&assert(J!==pe,"options.numberFormatter is mutually exclusive with options.valuePattern and options.decimalPlaces")}const s=new TinyProperty(r.numberFormatter?r.numberFormatter:J=>r.decimalPlaces===null?`${J}`:DotUtils.toFixed(J,r.decimalPlaces));assert&&assert(!r.hasOwnProperty("unitsNode"),"unitsNode is not a supported option"),assert&&assert(_.includes(ALIGN_VALUES,r.align),`invalid align: ${r.align}`),r.noValueAlign||(r.noValueAlign=r.align),assert&&assert(_.includes(ALIGN_VALUES,r.noValueAlign),`invalid noValueAlign: ${r.noValueAlign}`),assert&&assert(r.textOptions,"did you accidentally set textOptions to null?");const a=J=>J.includes(SunConstants.VALUE_NUMBERED_PLACEHOLDER)?StringUtils.format(J,SunConstants.VALUE_NAMED_PLACEHOLDER):J,h=typeof r.valuePattern=="string"?new TinyProperty(a(r.valuePattern)):new DerivedProperty([r.valuePattern],a);assert&&assert(!!((Z=(ie=phet==null?void 0:phet.chipper)==null?void 0:ie.queryParameters)!=null&&Z.stringTest)||h.value.includes(SunConstants.VALUE_NAMED_PLACEHOLDER),`missing value placeholder in options.valuePattern: ${h.value}`),r.noValuePattern||(r.noValuePattern=new DerivedProperty([h],J=>J));const c=typeof r.noValuePattern=="string"?new TinyProperty(r.noValuePattern):r.noValuePattern;assert&&assert(!!((X=(W=phet==null?void 0:phet.chipper)==null?void 0:W.queryParameters)!=null&&X.stringTest)||c.value.includes(SunConstants.VALUE_NAMED_PLACEHOLDER),`missing value placeholder in options.noValuePattern: ${c.value}`);const d=DerivedProperty.deriveAny([s,...r.numberFormatterDependencies],()=>valueToString(t.min,r.noValueString,s.value)),y=DerivedProperty.deriveAny([s,...r.numberFormatterDependencies],()=>valueToString(t.max,r.noValueString,s.value)),g=new DerivedProperty([h,d,y],(J,oe,le)=>StringUtils.fillIn(J,{value:oe.length>le.length?oe:le})),D=r.useRichText?RichText:Text,O=r.textOptions.tandem||r.tandem.createTandem("valueText"),V=DerivedProperty.deriveAny([e,c,h,s,...r.numberFormatterDependencies],()=>{const J=e.value,oe=c.value,le=h.value,pe=s.value,ve=J===null&&oe?oe:le,Oe=valueToString(J,r.noValueString,pe);return StringUtils.fillIn(ve,{value:Oe})},{phetioFeatured:!0,phetioValueType:StringIO,tandemNameSuffix:"StringProperty",tandem:O.createTandem(Text.STRING_PROPERTY_TANDEM_NAME)}),k=combineOptions({tandem:O},r.textOptions,{maxWidth:null}),M=new D(V,k),N=M.height,F=new Rectangle({cornerRadius:r.cornerRadius,fill:r.backgroundFill,stroke:r.backgroundStroke,lineWidth:r.backgroundLineWidth,lineDash:r.backgroundLineDash});g.link(J=>{const oe=new D(J,_.omit(k,"tandem"));M.maxWidth=r.textOptions.maxWidth!==null?r.textOptions.maxWidth:oe.width!==0?oe.width:null,oe.maxWidth=M.maxWidth,F.rectWidth=Math.max(r.minBackgroundWidth,oe.width+2*r.xMargin),F.rectHeight=(r.useFullHeight?N:oe.height)+2*r.yMargin});const G=new Node$2({children:[M]});r.children=[F,G],super(),this.numberFormatterProperty=s,this.valueText=M,this.backgroundNode=F,ManualConstraint.create(this,[G,F],(J,oe)=>{const le=e.value===null?r.noValueAlign:r.align,pe=oe.centerY;le==="center"?J.center=new Vector2(oe.centerX,pe):le==="left"?J.leftCenter=new Vector2(oe.left+r.xMargin,pe):J.rightCenter=new Vector2(oe.right-r.xMargin,pe)}),this.mutate(r),this.disposeNumberDisplay=()=>{V.dispose(),h.dispose()}}dispose(){this.disposeNumberDisplay(),super.dispose()}setNumberFont(e){this.valueText.font=e}set numberFont(e){this.setNumberFont(e)}setNumberFill(e){this.valueText.fill=e}set numberFill(e){this.setNumberFill(e)}setBackgroundFill(e){this.backgroundNode.fill=e}set backgroundFill(e){this.setBackgroundFill(e)}get backgroundFill(){return this.getBackgroundFill()}getBackgroundFill(){return this.backgroundNode.fill}setBackgroundStroke(e){this.backgroundNode.stroke=e}set backgroundStroke(e){this.setBackgroundStroke(e)}getBackgroundWidth(){return this.backgroundNode.getRectWidth()}setBackgroundWidth(e){this.backgroundNode.setRectWidth(e)}get backgroundWidth(){return this.getBackgroundWidth()}set backgroundWidth(e){this.setBackgroundWidth(e)}};Cs.NumberDisplayIO=new IOType("NumberDisplayIO",{valueType:Cs,supertype:Node$2.NodeIO,documentation:"A numeric readout with a background"});let NumberDisplay=Cs;sceneryPhet.register("NumberDisplay",NumberDisplay);const valueToString=(o,e,t)=>{let n=e;return o!==null&&(n=t(o)),n},DEFAULT_ARROW_HEIGHT=20;class ArrowButton extends RectangularPushButton{constructor(e,t,n){const r=optionize()({cursor:"pointer",baseColor:"white",stroke:"black",lineWidth:1,cornerRadius:4,xMargin:7,yMargin:5,touchAreaXDilation:7,touchAreaYDilation:7,arrowHeight:DEFAULT_ARROW_HEIGHT,arrowWidth:DEFAULT_ARROW_HEIGHT*Math.sqrt(3)/2,arrowFill:"black",arrowStroke:null,arrowLineWidth:1,numberOfArrows:1,arrowSpacing:-DEFAULT_ARROW_HEIGHT*.5,fireOnHold:!0,fireOnHoldDelay:400,fireOnHoldInterval:100,startCallback:_.noop,endCallback:_.noop},n);r.listener=t;const s=new Shape$1;for(let a=0;a<r.numberOfArrows;a++){const h=a*(r.arrowHeight+r.arrowSpacing);if(e==="up")s.moveTo(r.arrowHeight/2,h).lineTo(r.arrowHeight,r.arrowWidth+h).lineTo(0,r.arrowWidth+h).close();else if(e==="down")s.moveTo(0,h).lineTo(r.arrowHeight,h).lineTo(r.arrowHeight/2,r.arrowWidth+h).close();else if(e==="left")s.moveTo(h,r.arrowHeight/2).lineTo(r.arrowWidth+h,0).lineTo(r.arrowWidth+h,r.arrowHeight).close();else if(e==="right")s.moveTo(h,0).lineTo(r.arrowWidth+h,r.arrowHeight/2).lineTo(h,r.arrowHeight).close();else throw new Error(`unsupported direction: ${e}`)}r.content=new Path(s,{fill:r.arrowFill,stroke:r.arrowStroke,lineWidth:r.arrowLineWidth,pickable:!1}),super(r)}}sun.register("ArrowButton",ArrowButton);class NumberSpinner extends AccessibleNumberSpinner(Node$2,0){constructor(e,t,n){var G,ie;assert&&assert(t.value.contains(e.get()),`value ${e.get()} is out of range ${t.value.toString()}`);const r=optionize()({arrowsSoundPlayer:pushButtonSoundPlayer,arrowsPosition:"bothRight",arrowsScale:null,arrowButtonFill:"white",arrowButtonStroke:"black",arrowButtonLineWidth:1,deltaValue:1,xSpacing:5,ySpacing:3,numberDisplayOptions:{cornerRadius:5,backgroundStroke:"black"},touchAreaXDilation:0,touchAreaYDilation:0,mouseAreaXDilation:0,mouseAreaYDilation:0,valueProperty:e,enabledRangeProperty:t,disabledOpacity:SceneryConstants.DISABLED_OPACITY,interactiveHighlight:"invisible",tandem:Tandem.REQUIRED,tandemNameSuffix:"Spinner",phetioFeatured:!0,phetioEnabledPropertyInstrumented:!0},n),s=r.incrementFunction||(Z=>Z+r.deltaValue),a=r.decrementFunction||(Z=>Z-r.deltaValue),h=new NumberDisplay(e,t.value,combineOptions({tandem:r.tandem.createTandem("numberDisplay")},r.numberDisplayOptions)),c={baseColor:r.arrowButtonFill,stroke:r.arrowButtonStroke,lineWidth:r.arrowButtonLineWidth,focusable:!1,soundPlayer:r.arrowsSoundPlayer,enabledPropertyOptions:{phetioReadOnly:!0,phetioFeatured:!1}},d=new ArrowButton(r.arrowsPosition==="topBottom"||r.arrowsPosition==="bothRight"?"up":"right",()=>e.set(s(e.get())),combineOptions({tandem:r.tandem.createTandem("incrementButton")},c)),y=new ArrowButton(r.arrowsPosition==="topBottom"||r.arrowsPosition==="bothRight"?"down":"left",()=>e.set(a(e.get())),combineOptions({tandem:r.tandem.createTandem("decrementButton")},c));let g;g||(r.arrowsPosition==="leftRight"?g=h.height/d.height:r.arrowsPosition==="topBottom"?g=h.width/d.width:r.arrowsPosition==="bothRight"?g=(h.height/2-r.ySpacing/2)/d.height:g=(h.width/2-r.xSpacing/2)/d.width),r.arrowsScale&&(g=g*r.arrowsScale),d.setScaleMagnitude(g),y.setScaleMagnitude(g);const D=()=>{r.arrowsPosition==="leftRight"?(d.left=h.right+r.xSpacing,y.right=h.left-r.xSpacing,d.centerY=y.centerY=h.centerY):r.arrowsPosition==="topBottom"?(d.centerX=y.centerX=h.centerX,d.bottom=h.top-r.ySpacing,y.top=h.bottom+r.ySpacing):r.arrowsPosition==="bothRight"?(d.left=y.left=h.right+r.xSpacing,d.bottom=h.centerY-r.ySpacing/2,y.top=h.centerY+r.ySpacing/2):(d.left=h.centerX+r.xSpacing/2,y.right=h.centerX-r.xSpacing/2,d.top=y.top=h.bottom+r.ySpacing)};h.boundsProperty.link(()=>D()),(r.touchAreaXDilation||r.touchAreaYDilation)&&(d.touchArea=d.localBounds.dilatedXY(r.touchAreaXDilation,r.touchAreaYDilation),y.touchArea=y.localBounds.dilatedXY(r.touchAreaXDilation,r.touchAreaYDilation),r.arrowsPosition==="bothRight"?(d.touchArea=d.touchArea.shiftedY(-r.touchAreaYDilation),y.touchArea=y.touchArea.shiftedY(r.touchAreaYDilation)):r.arrowsPosition==="bothBottom"&&(d.touchArea=d.touchArea.shiftedX(r.touchAreaXDilation),y.touchArea=y.touchArea.shiftedX(-r.touchAreaXDilation))),(r.mouseAreaXDilation||r.mouseAreaYDilation)&&(d.mouseArea=d.localBounds.dilatedXY(r.mouseAreaXDilation,r.mouseAreaYDilation),y.mouseArea=y.localBounds.dilatedXY(r.mouseAreaXDilation,r.mouseAreaYDilation),r.arrowsPosition==="bothRight"?(d.mouseArea=d.mouseArea.shiftedY(-r.mouseAreaYDilation),y.mouseArea=y.mouseArea.shiftedY(r.mouseAreaYDilation)):r.arrowsPosition==="bothBottom"&&(d.mouseArea=d.mouseArea.shiftedX(r.mouseAreaXDilation),y.mouseArea=y.mouseArea.shiftedX(-r.mouseAreaXDilation))),r.children=[h,d,y],assert&&assert(r.keyboardStep===void 0,"NumberSpinner sets keyboardStep, it will be the same as deltaValue"),assert&&assert(r.shiftKeyboardStep===void 0,"NumberSpinner sets shiftKeyboardStep, it will be the same as deltaValue"),assert&&assert(r.pageKeyboardStep===void 0,"NumberSpinner sets pageKeyboardStep, it should not be used with NumberSpinner"),r.keyboardStep=0,r.shiftKeyboardStep=0,r.pageKeyboardStep=0;const O=_.pick(r,Node$2.REQUIRES_BOUNDS_OPTION_KEYS);super(_.omit(r,Node$2.REQUIRES_BOUNDS_OPTION_KEYS));const V=()=>{d.enabled=s(e.value)<=t.value.max,y.enabled=a(e.value)>=t.value.min},k=Z=>{assert&&assert(t.value.contains(Z),`value out of range: ${Z}`),V()};e.link(k);const M=Z=>{e.value=Z.constrainValue(e.value),V()};t.link(M);const N=Z=>Z&&d.pdomClick(),F=Z=>Z&&y.pdomClick();this.pdomIncrementDownEmitter.addListener(N),this.pdomDecrementDownEmitter.addListener(F),this.disposeNumberSpinner=()=>{h.dispose(),d.dispose(),y.dispose(),this.pdomIncrementDownEmitter.removeListener(N),this.pdomDecrementDownEmitter.removeListener(F),e.unlink(k),t.unlink(M)},this.mutate(O),this.numberDisplay=h,this.addLinkedElement(e,{tandemName:"property"}),assert&&((ie=(G=phet==null?void 0:phet.chipper)==null?void 0:G.queryParameters)!=null&&ie.binder)&&InstanceRegistry.registerDataURL("sun","NumberSpinner",this)}dispose(){this.disposeNumberSpinner(),super.dispose()}}sun.register("NumberSpinner",NumberSpinner);class OnOffSwitch extends ToggleSwitch{constructor(e,t){const n=optionize()({trackFillLeft:"white",trackFillRight:"rgb( 0, 200, 0 )"},t);super(e,!1,!0,n)}}sun.register("OnOffSwitch",OnOffSwitch);const sunQueryParameters=QueryStringMachine.getAll({backgroundColor:{type:"string",defaultValue:"white"},component:{type:"string",defaultValue:null},layout:{type:"string",defaultValue:"Width of multiple panels"}});sun.register("sunQueryParameters",sunQueryParameters);class VerticalAquaRadioButtonGroup extends AquaRadioButtonGroup{constructor(e,t,n){super(e,t,optionize()({orientation:"vertical",align:"left"},n))}}sun.register("VerticalAquaRadioButtonGroup",VerticalAquaRadioButtonGroup);class VerticalCheckboxGroup extends VBox{constructor(e,t){const n=optionize()({touchAreaXDilation:5,mouseAreaXDilation:5,spacing:10,align:"left",stretch:!0,tandem:Tandem.REQUIRED},t),r=getGroupItemNodes(e,n.tandem),s=[];n.children=[];for(let a=0;a<e.length;a++){const h=e[a],c=r[a];assert&&assert(!c.hasPDOMContent,"Accessibility is provided by Checkbox and VerticalCheckboxGroupItem.options. Additional PDOM content in the provided Node could break accessibility.");const d=n.spacing/2;assert&&assert(!h.tandem,"Cannot specify tandem on item, use tandemName instead");const y=new Checkbox(h.property,c,combineOptions({tandem:h.tandemName?n.tandem.createTandem(h.tandemName):Tandem.OPTIONAL,mouseAreaXDilation:n.mouseAreaXDilation,touchAreaXDilation:n.touchAreaXDilation,mouseAreaYDilation:d,touchAreaYDilation:d},n.checkboxOptions,h.options));s.push(y),n.children.push(y)}super(n),this.disposeVerticalCheckboxGroup=()=>{s.forEach(a=>a.dispose()),r.forEach(a=>a.dispose())}}dispose(){this.disposeVerticalCheckboxGroup(),super.dispose()}}sun.register("VerticalCheckboxGroup",VerticalCheckboxGroup);class VSlider extends Slider{constructor(e,t,n){var r,s;n=optionize()({orientation:Orientation.VERTICAL},n),super(e,t,n),assert&&((s=(r=phet==null?void 0:phet.chipper)==null?void 0:r.queryParameters)!=null&&s.binder)&&InstanceRegistry.registerDataURL("sun","VSlider",this)}}sun.register("VSlider",VSlider);class StickyToggleButtonInteractionStateProperty extends DerivedProperty5{constructor(e){super([e.focusedProperty,e.overProperty,e.looksOverProperty,e.looksPressedProperty,e.valueProperty],(t,n,r,s,a)=>{const h=a===e.valueDown;return r&&!(s||h)?ButtonInteractionState.OVER:(n||t)&&(s||h)||h?ButtonInteractionState.PRESSED:ButtonInteractionState.IDLE},{valueType:ButtonInteractionState})}}sun.register("StickyToggleButtonInteractionStateProperty",StickyToggleButtonInteractionStateProperty);class StickyToggleButtonModel extends ButtonModel{constructor(e,t,n,r){assert&&assert(n.valueComparisonStrategy==="reference",'StickyToggleButtonModel depends on "===" equality for value comparison');const s=optionize()({tandem:Tandem.REQUIRED},r);super(s),this.valueUp=e,this.valueDown=t,this.valueProperty=n,this.toggledEmitter=new Emitter({tandem:s.tandem.createTandem("toggledEmitter"),phetioDocumentation:"Emits when the button is toggled",phetioEventType:EventType.USER}),this.toggledEmitter.addListener(()=>{assert&&assert(this.valueProperty.value===this.valueUp||this.valueProperty.value===this.valueDown,`unrecognized value: ${this.valueProperty.value}`),this.valueProperty.value=this.valueProperty.value===this.valueUp?this.valueDown:this.valueUp}),this.pressedWhileDownProperty=new BooleanProperty(!1);const a=d=>{const y=this.overProperty.get()||this.focusedProperty.get();this.enabledProperty.get()&&y&&!this.interrupted&&(d&&n.value===e&&(this.toggle(),this.pressedWhileDownProperty.set(!1)),!d&&n.value===t&&(this.pressedWhileDownProperty.get()?this.toggle():this.pressedWhileDownProperty.set(!0))),!d&&!y&&this.pressedWhileDownProperty.set(!0)};this.downProperty.link(a);const h=d=>{this.downProperty.set(d===t)};n.link(h);const c=d=>{d&&this.pressedWhileDownProperty.set(!0)};this.enabledProperty.link(c),this.disposeToggleButtonModel=()=>{this.downProperty.unlink(a),this.enabledProperty.unlink(c),n.unlink(h),this.toggledEmitter.dispose()}}dispose(){this.disposeToggleButtonModel(),super.dispose()}toggle(){this.toggledEmitter.emit(),this.produceSoundEmitter.emit()}}sun.register("StickyToggleButtonModel",StickyToggleButtonModel);class RectangularStickyToggleButton extends RectangularButton{constructor(e,t,n,r){const s=new StickyToggleButtonModel(t,n,e,r),a=new StickyToggleButtonInteractionStateProperty(s);super(s,a,r),this.disposeRectangularStickyToggleButton=()=>{s.dispose()}}dispose(){this.disposeRectangularStickyToggleButton(),super.dispose()}}sun.register("RectangularStickyToggleButton",RectangularStickyToggleButton);class BooleanRectangularStickyToggleButton extends RectangularStickyToggleButton{constructor(e,t){super(e,!1,!0,t)}}sun.register("BooleanRectangularStickyToggleButton",BooleanRectangularStickyToggleButton);const HIGHLIGHT_GRADIENT_LENGTH=5;class RoundButton extends ButtonNode{constructor(e,t,n){const r=optionize()({radius:n&&n.content?null:30,lineWidth:.5,stroke:null,touchAreaDilation:0,mouseAreaDilation:0,touchAreaXShift:0,touchAreaYShift:0,mouseAreaXShift:0,mouseAreaYShift:0,aspectRatio:1,cursor:"pointer",xMargin:5,yMargin:5,buttonAppearanceStrategy:RoundButton.ThreeDAppearanceStrategy},n);r.content||assert&&assert(typeof r.radius=="number",`invalid radius: ${r.radius}`),r.radius&&(assert&&assert(r.xMargin<r.radius,"xMargin cannot be larger than radius"),assert&&assert(r.yMargin<r.radius,"yMargin cannot be larger than radius"),r.minUnstrokedWidth=r.radius*2,r.minUnstrokedHeight=r.radius*2),r.buttonAppearanceStrategyOptions||(r.buttonAppearanceStrategyOptions={stroke:r.stroke,lineWidth:r.lineWidth});const s=r.radius||Math.max(r.content.width+r.xMargin*2,r.content.height+r.yMargin*2)/2;if(r.content&&r.radius){const c=r.content,d=Math.min((r.radius-r.xMargin)*2/c.width,(r.radius-r.yMargin)*2/c.height);r.content=new Node$2({children:[c],scale:d})}const a=new Circle(s);super(e,a,t,r);const h=a.localBounds.width/2;this.touchArea=Shape$1.circle(r.touchAreaXShift,r.touchAreaYShift,h+r.touchAreaDilation),this.mouseArea=Shape$1.circle(r.mouseAreaXShift,r.mouseAreaYShift,h+r.mouseAreaDilation),this.focusHighlight=Shape$1.circle(0,0,h+5)}}class ThreeDAppearanceStrategy{constructor(e,t,n,r){const s=r&&r.stroke?r.stroke:new PaintColorProperty(n,{luminanceFactor:-.4}),a=r&&r.lineWidth!==void 0?r.lineWidth:.3,h=optionize()({stroke:s,lineWidth:a,overStroke:s,overLineWidth:a,overButtonOpacity:1,selectedStroke:s,selectedLineWidth:a,selectedButtonOpacity:1,deselectedStroke:s,deselectedLineWidth:a,deselectedButtonOpacity:1,overFill:n},r),c=new PaintColorProperty(n,{luminanceFactor:.8}),d=new PaintColorProperty(n,{luminanceFactor:.7}),y=new PaintColorProperty(n,{luminanceFactor:.3}),g=new PaintColorProperty(n,{luminanceFactor:-.1}),D=new PaintColorProperty(n,{luminanceFactor:-.2}),O=new PaintColorProperty(n,{luminanceFactor:-.4}),V=new PaintColorProperty(n,{luminanceFactor:-.5}),k=new DerivedProperty([n],pe=>pe.withAlpha(0)),M=e.width/2,N=M-HIGHLIGHT_GRADIENT_LENGTH/2,F=M+HIGHLIGHT_GRADIENT_LENGTH/2,G=HIGHLIGHT_GRADIENT_LENGTH/2,ie=new RadialGradient(G,G,N,G,G,F).addColorStop(0,n).addColorStop(1,d),Z=new RadialGradient(-G,-G,N,-G,-G,F).addColorStop(0,k).addColorStop(1,V),W=new RadialGradient(G,G,N,G,G,F).addColorStop(0,y).addColorStop(1,c),X=new RadialGradient(-G,-G,N,-G,-G,F).addColorStop(0,k).addColorStop(1,V),J=new RadialGradient(-G,-G,0,0,0,F).addColorStop(0,g).addColorStop(.6,D).addColorStop(.8,n).addColorStop(1,c),oe=new Circle(M,{stroke:h.stroke?h.stroke:O,lineWidth:h.lineWidth,pickable:!1});e.addChild(oe),this.maxLineWidth=oe.hasStroke()&&h&&typeof h.lineWidth=="number"?h.lineWidth:0,e.cachedPaints=[ie,W,J],oe.cachedPaints=[Z,X];function le(pe){switch(pe){case ButtonInteractionState.IDLE:e.fill=ie,e.stroke=h.deselectedStroke,e.lineWidth=h.deselectedLineWidth,e.opacity=h.deselectedButtonOpacity,oe.fill=Z,oe.opacity=h.deselectedButtonOpacity;break;case ButtonInteractionState.OVER:e.fill=W,e.stroke=h.overStroke,e.lineWidth=h.overLineWidth,e.opacity=h.overButtonOpacity,oe.fill=X,oe.opacity=h.overButtonOpacity;break;case ButtonInteractionState.PRESSED:e.fill=J,e.stroke=h.selectedStroke,e.lineWidth=h.selectedLineWidth,e.opacity=h.selectedButtonOpacity,oe.fill=X,oe.opacity=h.selectedButtonOpacity;break;default:throw new Error(`unsupported interactionState: ${pe}`)}}t.link(le),this.disposeThreeDAppearanceStrategy=()=>{t.hasListener(le)&&t.unlink(le),c.dispose(),d.dispose(),y.dispose(),g.dispose(),D.dispose(),O.dispose(),V.dispose(),k.dispose()}}dispose(){this.disposeThreeDAppearanceStrategy()}}RoundButton.ThreeDAppearanceStrategy=ThreeDAppearanceStrategy;sun.register("RoundButton",RoundButton);class RoundStickyToggleButton extends RoundButton{constructor(e,t,n,r){assert&&assert(e.valueComparisonStrategy==="reference",'RoundStickyToggleButton depends on "===" equality for value comparison');const s=optionize()({soundPlayer:pushButtonSoundPlayer,tandem:Tandem.REQUIRED},r),a=new StickyToggleButtonModel(t,n,e,s),h=new StickyToggleButtonInteractionStateProperty(a);super(a,h,s);const c=()=>s.soundPlayer.play();a.produceSoundEmitter.addListener(c);const d=()=>this.setPDOMAttribute("aria-pressed",e.value===n);e.link(d),this.disposeRoundStickyToggleButton=()=>{e.unlink(d),a.produceSoundEmitter.removeListener(c),a.dispose()}}dispose(){this.disposeRoundStickyToggleButton(),super.dispose()}}sun.register("RoundStickyToggleButton",RoundStickyToggleButton);class BooleanRoundStickyToggleButton extends RoundStickyToggleButton{constructor(e,t){super(e,!1,!0,t)}}sun.register("BooleanRoundStickyToggleButton",BooleanRoundStickyToggleButton);class RoundToggleButton extends RoundButton{constructor(e,t,n,r){assert&&assert(e.valueComparisonStrategy==="reference",'RoundToggleButton depends on "===" equality for value comparison');const s=optionize()({valueOffSoundPlayer:toggleOffSoundPlayer,valueOnSoundPlayer:toggleOnSoundPlayer,tandem:Tandem.REQUIRED,phetioFeatured:!0},r),a=new ToggleButtonModel(t,n,e,s),h=new ToggleButtonInteractionStateProperty(a);super(a,h,s),this.addLinkedElement(e,{tandemName:"property"});const c=()=>{e.value===t?s.valueOffSoundPlayer.play():e.value===n&&s.valueOnSoundPlayer.play()};this.buttonModel.produceSoundEmitter.addListener(c),this.disposeRoundToggleButton=()=>{this.buttonModel.produceSoundEmitter.removeListener(c),a.dispose()}}dispose(){this.disposeRoundToggleButton(),super.dispose()}}sun.register("RoundToggleButton",RoundToggleButton);class BooleanRoundToggleButton extends RoundToggleButton{constructor(e,t,n,r){const s=optionize()({content:null,tandem:Tandem.REQUIRED},r),a=new BooleanToggleNode(e,t,n,{tandem:s.tandem.createTandem("toggleNode")});s.content=a,super(e,!1,!0,s),this.disposeBooleanRoundToggleButton=function(){a.dispose()}}dispose(){this.disposeBooleanRoundToggleButton(),super.dispose()}}sun.register("BooleanRoundToggleButton",BooleanRoundToggleButton);class MomentaryButtonInteractionStateProperty extends DerivedProperty2{constructor(e){super([e.looksOverProperty,e.looksPressedProperty],(t,n)=>t&&!n?ButtonInteractionState.OVER:n?ButtonInteractionState.PRESSED:ButtonInteractionState.IDLE,{valueType:ButtonInteractionState})}}sun.register("MomentaryButtonInteractionStateProperty",MomentaryButtonInteractionStateProperty);class MomentaryButtonModel extends ButtonModel{constructor(e,t,n,r){const s=optionize()({tandem:Tandem.REQUIRED,phetioReadOnly:PhetioObject.DEFAULT_OPTIONS.phetioReadOnly},r);super(s);const a=c=>{c?this.enabledProperty.get()&&n.set(t):n.set(e)};this.downProperty.lazyLink(a);const h=c=>{this.downProperty.set(c===t)};n.link(h),this.disposeMomentaryButtonModel=()=>{this.downProperty.unlink(a),n.unlink(h)}}dispose(){this.disposeMomentaryButtonModel(),super.dispose()}}sun.register("MomentaryButtonModel",MomentaryButtonModel);const Jt=class Jt extends EnumerationValue{};Jt.SELECTED=new Jt,Jt.DESELECTED=new Jt,Jt.OVER=new Jt,Jt.PRESSED=new Jt,Jt.enumeration=new Enumeration(Jt);let RadioButtonInteractionState=Jt;sun.register("RadioButtonInteractionState",RadioButtonInteractionState);class RadioButtonInteractionStateProperty extends DerivedProperty5{constructor(e,t,n){super([e.focusedProperty,e.overProperty,e.looksOverProperty,e.looksPressedProperty,t],(r,s,a,h,c)=>{const d=c===n;return a&&!(h||d)?RadioButtonInteractionState.OVER:(s||r)&&h?RadioButtonInteractionState.PRESSED:d?RadioButtonInteractionState.SELECTED:RadioButtonInteractionState.DESELECTED},{valueType:RadioButtonInteractionState})}}sun.register("RadioButtonInteractionStateProperty",RadioButtonInteractionStateProperty);class RectangularMomentaryButton extends RectangularButton{constructor(e,t,n,r){var h,c;const s=optionize()({tandem:Tandem.REQUIRED},r),a=new MomentaryButtonModel(t,n,e,s);super(a,new MomentaryButtonInteractionStateProperty(a),s),this.disposeRectangularMomentaryButton=()=>{a.dispose()},assert&&((c=(h=phet==null?void 0:phet.chipper)==null?void 0:h.queryParameters)!=null&&c.binder)&&InstanceRegistry.registerDataURL("sun","RectangularMomentaryButton",this)}dispose(){this.disposeRectangularMomentaryButton(),super.dispose()}}sun.register("RectangularMomentaryButton",RectangularMomentaryButton);const Ui=class Ui extends RectangularButton{constructor(e,t,n){assert&&assert(e.valueComparisonStrategy==="reference",'RectangularRadioButton depends on "===" equality for value comparison');const r=optionize()({soundPlayer:null,baseColor:ColorConstants.LIGHT_BLUE,buttonAppearanceStrategy:Ui.FlatAppearanceStrategy,buttonAppearanceStrategyOptions:{overButtonOpacity:.8,overStroke:null,selectedStroke:Color.BLACK,selectedLineWidth:1.5,selectedButtonOpacity:1,deselectedStroke:new Color(50,50,50),deselectedLineWidth:1,deselectedButtonOpacity:.6},contentAppearanceStrategy:Ui.ContentAppearanceStrategy,contentAppearanceStrategyOptions:{overContentOpacity:.8,selectedContentOpacity:1,deselectedContentOpacity:.6},tagName:"input",inputType:"radio",labelTagName:"label",containerTagName:"li",appendDescription:!0,appendLabel:!0,tandem:Tandem.REQUIRED,tandemNameSuffix:"RadioButton",phetioReadOnly:PhetioObject.DEFAULT_OPTIONS.phetioReadOnly},n),s=new ButtonModel({enabledPropertyOptions:r.enabledPropertyOptions,tandem:r.tandem,phetioEnabledPropertyInstrumented:r.phetioEnabledPropertyInstrumented}),a=new RadioButtonInteractionStateProperty(s,e,t);super(s,a,r),this.interactionStateProperty=a,e.value===t&&this.setPDOMAttribute("checked","checked");const h=y=>{this.pdomChecked=y===t};e.link(h),this.property=e,this.value=t,this.firedEmitter=new Emitter({tandem:r.tandem.createTandem("firedEmitter"),phetioDocumentation:"Emits when the radio button is pressed",phetioReadOnly:r.phetioReadOnly,phetioEventType:EventType.USER}),this.firedEmitter.addListener(()=>e.set(t)),s.downProperty.link(y=>{!y&&(s.overProperty.get()||s.focusedProperty.get())&&!s.interrupted&&(this.fire(),this.voicingSpeakFullResponse({hintResponse:null}))});const c=r.soundPlayer||pushButtonSoundPlayer,d=()=>{c.play()};s.produceSoundEmitter.addListener(d),this.disposeRectangularRadioButton=()=>{e.unlink(h),this.firedEmitter.dispose(),s.produceSoundEmitter.removeListener(d),s.dispose(),this.interactionStateProperty.dispose()}}dispose(){this.disposeRectangularRadioButton(),super.dispose()}fire(){this.buttonModel.enabledProperty.get()&&(this.firedEmitter.emit(),this.buttonModel.produceSoundEmitter.emit())}};Ui.FlatAppearanceStrategy=class{constructor(t,n,r,s){const a=optionize()({stroke:r,lineWidth:1,deselectedButtonOpacity:1,deselectedLineWidth:1,deselectedStroke:"gray",overButtonOpacity:.8,overFill:null,overLineWidth:0,overStroke:null,selectedButtonOpacity:1,selectedLineWidth:1,selectedStroke:"black"},s),h=new PaintColorProperty(r,{luminanceFactor:-.4}),c=new PaintColorProperty(a.overFill||r,{luminanceFactor:s&&s.overFill?0:.4}),d=new PaintColorProperty(a.overStroke||a.deselectedStroke,{luminanceFactor:s&&s.overStroke?0:-.4});this.maxLineWidth=Math.max(a.selectedLineWidth,a.deselectedLineWidth,a.overLineWidth),t.cachedPaints=[r,c,h,d,a.selectedStroke,a.deselectedStroke];function y(g){switch(g){case RadioButtonInteractionState.SELECTED:t.fill=r,t.stroke=a.selectedStroke,t.lineWidth=a.selectedLineWidth,t.opacity=a.selectedButtonOpacity;break;case RadioButtonInteractionState.DESELECTED:t.fill=r,t.stroke=a.deselectedStroke,t.lineWidth=a.deselectedLineWidth,t.opacity=a.deselectedButtonOpacity;break;case RadioButtonInteractionState.OVER:t.fill=c,t.stroke=d,t.lineWidth=Math.max(a.overLineWidth,a.deselectedLineWidth),t.opacity=a.overButtonOpacity;break;case RadioButtonInteractionState.PRESSED:t.fill=h,t.stroke=a.deselectedStroke,t.lineWidth=a.deselectedLineWidth,t.opacity=a.selectedButtonOpacity;break;default:throw new Error(`unsupported interactionState: ${g}`)}}n.link(y),this.disposeFlatAppearanceStrategy=()=>{n.hasListener(y)&&n.unlink(y),d.dispose(),c.dispose(),h.dispose()}}dispose(){this.disposeFlatAppearanceStrategy()}},Ui.ContentAppearanceStrategy=class{constructor(t,n,r){const s=optionize()({deselectedContentOpacity:1,overContentOpacity:1,selectedContentOpacity:1},r);function a(h){if(t!==null)switch(h){case RadioButtonInteractionState.DESELECTED:t.opacity=s.deselectedContentOpacity;break;case RadioButtonInteractionState.OVER:t.opacity=s.overContentOpacity;break;case RadioButtonInteractionState.SELECTED:t.opacity=s.selectedContentOpacity;break;case RadioButtonInteractionState.PRESSED:t.opacity=s.deselectedContentOpacity;break;default:throw new Error(`unsupported state: ${h}`)}}n.link(a),this.disposeContentAppearanceStrategy=()=>{n.hasListener(a)&&n.unlink(a)}}dispose(){this.disposeContentAppearanceStrategy()}};let RectangularRadioButton=Ui;sun.register("RectangularRadioButton",RectangularRadioButton);let instanceCount=0;const CLASS_NAME="RectangularRadioButtonGroup";class RectangularRadioButtonGroup extends FlowBox{constructor(e,t,n){var V,k;assert&&assert(_.uniqBy(t,M=>M.value).length===t.length,"items must have unique values"),assert&&assert(_.find(t,M=>M.value===e.value),"one radio button must be associated with property.value");const r=optionize()({soundPlayers:null,labelAlign:"bottom",labelSpacing:0,a11yHighlightXDilation:0,a11yHighlightYDilation:0,touchAreaXDilation:0,touchAreaYDilation:0,mouseAreaXDilation:0,mouseAreaYDilation:0,radioButtonOptions:{baseColor:ColorConstants.LIGHT_BLUE,cornerRadius:4,xMargin:5,yMargin:5,xAlign:"center",yAlign:"center",buttonAppearanceStrategyOptions:{selectedStroke:"black",selectedLineWidth:1.5,selectedButtonOpacity:1,deselectedStroke:new Color(50,50,50),deselectedLineWidth:1,deselectedButtonOpacity:.6,overButtonOpacity:.8},contentAppearanceStrategy:RectangularRadioButton.ContentAppearanceStrategy,contentAppearanceStrategyOptions:{overContentOpacity:.8,selectedContentOpacity:1,deselectedContentOpacity:.6}},spacing:10,stretch:!0,orientation:"vertical",disabledOpacity:SceneryConstants.DISABLED_OPACITY,tandem:Tandem.REQUIRED,tandemNameSuffix:"ButtonGroup",visiblePropertyOptions:{phetioFeatured:!0},phetioEnabledPropertyInstrumented:!0,phetioFeatured:!0,tagName:"ul",labelTagName:"h3",ariaRole:"radiogroup",groupFocusHighlight:!0},n);assert&&assert(r.soundPlayers===null||r.soundPlayers.length===t.length,"If soundPlayers is provided, there must be one per radio button."),instanceCount++;const s=new Map,a=getGroupItemNodes(t,r.tandem);assert&&assert(_.every(a,M=>!M.hasPDOMContent),"Accessibility is provided by RectangularRadioButton and RectangularRadioButtonGroupItem.labelContent. Additional PDOM content in the provided Node could break accessibility.");const h=_.maxBy(a,M=>M.width).width,c=_.maxBy(a,M=>M.height).height,d=[],y=[],g=r.radioButtonOptions.xMargin,D=r.radioButtonOptions.yMargin;for(let M=0;M<t.length;M++){const N=t[M],F=a[M],G=combineOptions({content:F,minWidth:h+2*g,minHeight:c+2*D,soundPlayer:r.soundPlayers?r.soundPlayers[M]:multiSelectionSoundPlayerFactory.getSelectionSoundPlayer(M),tandem:N.tandemName?r.tandem.createTandem(N.tandemName):r.tandem===Tandem.OPT_OUT?Tandem.OPT_OUT:Tandem.REQUIRED,phetioDocumentation:N.phetioDocumentation||"",touchAreaXDilation:r.orientation==="horizontal"?r.spacing/2:r.touchAreaXDilation,touchAreaYDilation:r.orientation==="vertical"?r.spacing/2:r.touchAreaYDilation,mouseAreaXDilation:r.orientation==="horizontal"?r.spacing/2:r.mouseAreaXDilation,mouseAreaYDilation:r.orientation==="vertical"?r.spacing/2:r.mouseAreaYDilation},r.radioButtonOptions,N.options);N.labelContent&&(G.labelContent=N.labelContent,G.voicingNameResponse=N.labelContent),N.descriptionContent&&(G.descriptionContent=N.descriptionContent),N.voicingContextResponse&&(G.voicingContextResponse=N.voicingContextResponse);const ie=new RectangularRadioButton(e,N.value,G);s.set(N.value,ie),ie.setPDOMAttribute("name",CLASS_NAME+instanceCount);let Z;if(N.label){const W=N.label,X=r.labelAlign==="bottom"||r.labelAlign==="top"?"vertical":"horizontal",J=r.labelAlign==="left"||r.labelAlign==="top"?[W,ie]:[ie,W];Z=new FlowBox({children:J,spacing:r.labelSpacing,orientation:X}),W.pickable=!1,r.radioButtonOptions.contentAppearanceStrategy&&y.push(new r.radioButtonOptions.contentAppearanceStrategy(W,ie.interactionStateProperty,r.radioButtonOptions.contentAppearanceStrategyOptions))}else Z=ie;d.push(Z)}r.children=d,super(r),this.radioButtonMap=s,this.addAriaLabelledbyAssociation({thisElementName:PDOMPeer$1.PRIMARY_SIBLING,otherNode:this,otherElementName:PDOMPeer$1.LABEL_SIBLING});const O={keydown:M=>M.pointer.reserveForKeyboardDrag()};this.addInputListener(O),this.addLinkedElement(e,{tandemName:"property"}),this.disposeRadioButtonGroup=()=>{this.removeInputListener(O),d.forEach(M=>M.dispose()),y.forEach(M=>M.dispose&&M.dispose()),a.forEach(M=>M.dispose())},assert&&((k=(V=phet==null?void 0:phet.chipper)==null?void 0:V.queryParameters)!=null&&k.binder)&&InstanceRegistry.registerDataURL("sun","RectangularRadioButtonGroup",this)}getButtonForValue(e){const t=this.radioButtonMap.get(e);return assert&&assert(t,"No button found for value: "+e),t}dispose(){this.radioButtonMap.clear(),this.disposeRadioButtonGroup(),super.dispose()}}sun.register("RectangularRadioButtonGroup",RectangularRadioButtonGroup);class RoundMomentaryButton extends RoundButton{constructor(e,t,n,r){const s=optionize()({tandem:Tandem.REQUIRED},r),a=new MomentaryButtonModel(t,n,e,s);super(a,new MomentaryButtonInteractionStateProperty(a),s),this.disposeRoundMomentaryButton=()=>{a.dispose()}}dispose(){this.disposeRoundMomentaryButton(),super.dispose()}}sun.register("RoundMomentaryButton",RoundMomentaryButton);class RoundPushButton extends RoundButton{constructor(e){var h,c;const t=optionize()({soundPlayer:pushButtonSoundPlayer,tandem:Tandem.REQUIRED},e),n=t.listener,r=_.omit(t,["listener"]),s=new PushButtonModel(r);super(s,new PushButtonInteractionStateProperty(s),r),this.pushButtonModel=s,n&&this.addListener(n);const a=()=>{t.soundPlayer.play()};s.produceSoundEmitter.addListener(a),this.disposeRoundPushButton=()=>{s.produceSoundEmitter.removeListener(a),s.dispose()},assert&&((c=(h=phet==null?void 0:phet.chipper)==null?void 0:h.queryParameters)!=null&&c.binder)&&InstanceRegistry.registerDataURL("sun","RoundPushButton",this)}dispose(){super.dispose(),this.disposeRoundPushButton()}addListener(e){this.pushButtonModel.addListener(e)}removeListener(e){this.pushButtonModel.removeListener(e)}}sun.register("RoundPushButton",RoundPushButton);class TextPushButton extends RectangularPushButton{constructor(e,t){const n=optionize()({font:Font.DEFAULT,textFill:"black",maxTextWidth:null,tandem:Tandem.REQUIRED,innerContent:e},t),r=new Text(e,combineOptions({font:n.font,fill:n.textFill,maxWidth:n.maxTextWidth},n.textNodeOptions));n.content=r,super(n),this.disposeTextPushButton=()=>{r.dispose()}}dispose(){this.disposeTextPushButton(),super.dispose()}}sun.register("TextPushButton",TextPushButton);const _$1=window._,assert$2=(o,...e)=>window.assert(o,...e),assertEnabled=()=>!!window.assert;class BaseVertex{constructor(e,t){ce(this,"incomingHalfEdges");ce(this,"outgoingHalfEdges");ce(this,"edges");ce(this,"faces");this.logicalCoordinates=e,this.viewCoordinates=t,assertEnabled()&&assert$2(e),assertEnabled()&&assert$2(t)}getHalfEdgeTo(e){const t=this.outgoingHalfEdges.find(n=>n.end===e);return assertEnabled()&&assert$2(t),t}getHalfEdgeFrom(e){const t=this.incomingHalfEdges.find(n=>n.start===e);return assertEnabled()&&assert$2(t),t}getEdgeTo(e){const t=this.edges.find(n=>n.start===e||n.end===e);return assertEnabled()&&assert$2(t),t}}class BaseFace{constructor(e,t){ce(this,"halfEdges");ce(this,"edges");ce(this,"vertices");this.logicalCoordinates=e,this.viewCoordinates=t,assertEnabled()&&assert$2(e),assertEnabled()&&assert$2(t)}}class BaseEdge{constructor(e,t){ce(this,"forwardHalf");ce(this,"reversedHalf");ce(this,"forwardFace");ce(this,"reversedFace");ce(this,"vertices");ce(this,"faces");this.start=e,this.end=t,assertEnabled()&&assert$2(e),assertEnabled()&&assert$2(t)}getOtherVertex(e){return assertEnabled()&&assert$2(e===this.start||e===this.end,"vertex must be one of the two vertices of this edge"),e===this.start?this.end:this.start}getOtherFace(e){return assertEnabled()&&assert$2(e===this.forwardFace||e===this.reversedFace,"face must be one of the two faces of this edge"),e===this.forwardFace?this.reversedFace:this.forwardFace}}class BaseHalfEdge{constructor(e,t,n){ce(this,"edge");ce(this,"reversed");ce(this,"next");ce(this,"previous");ce(this,"face",null);this.start=e,this.end=t,this.isReversed=n,assertEnabled()&&assert$2(e),assertEnabled()&&assert$2(t)}}const getSignedArea=o=>{let e=0;for(let t=0;t<o.length;t++){const n=o[t],r=o[(t+1)%o.length];e+=(r.x+n.x)*(r.y-n.y)}return .5*e},getArea=o=>Math.abs(getSignedArea(o)),getCentroid=o=>{const e=getSignedArea(o);if(e===0)return o.reduce((r,s)=>r.plus(s),new Vector2(0,0)).timesScalar(1/o.length);let t=0,n=0;for(let r=0;r<o.length;r++){const s=o[r],a=o[(r+1)%o.length],h=s.x*(2*s.y+a.y)+a.x*(s.y+2*a.y);t+=(s.x-a.x)*h,n+=(a.y-s.y)*h}return new Vector2(t,n).timesScalar(1/(6*e))},getSignedAreaDerivative=(o,e)=>{let t=0;for(let n=0;n<o.length;n++){const r=o[n],s=o[(n+1)%o.length],a=e[n],h=e[(n+1)%o.length];t+=(s.x+r.x)*(h.y-a.y)+(h.x-a.x)*(s.y-r.y)}return .5*t},rescaleProtoDescriptor=(o,e)=>{const t=o.faces.map(a=>getArea(a.vertices.map(h=>h.viewCoordinates))),n=e(t),r=o.vertices.map(a=>({logicalCoordinates:a.logicalCoordinates,viewCoordinates:a.viewCoordinates.timesScalar(n)})),s=new Map(r.map((a,h)=>[o.vertices[h],a]));return{vertices:r,faces:o.faces.map(a=>({logicalCoordinates:a.logicalCoordinates,vertices:a.vertices.map(h=>s.get(h))}))}},rescaleProtoDescriptorAverage=(o,e)=>rescaleProtoDescriptor(o,t=>Math.sqrt(e/(_$1.sum(t)/t.length))),rescaleProtoDescriptorMinimum=(o,e)=>rescaleProtoDescriptor(o,t=>Math.sqrt(e/Math.min(...t)));class EdgeIdentifier{constructor(e,t){this.start=e,this.end=t}isCanonicalHalfEdge(){return this.start.x<this.end.x||this.start.x===this.end.x&&this.start.y<this.end.y}}class EdgeIdentifierLookup{constructor(){ce(this,"identifiers",[]);ce(this,"canonicalIdentifiers",[]);ce(this,"map",new Map)}add(e,t){if(assertEnabled()&&assert$2(e.x!==t.x||e.y!==t.y),this.lookupAttempt(e,t)!==null)return;const n=(r,s)=>{let a;this.map.has(r)?a=this.map.get(r):(a=new Map,this.map.set(r,a));const h=new EdgeIdentifier(r,s);a.set(s,h),this.identifiers.push(h),h.isCanonicalHalfEdge()&&this.canonicalIdentifiers.push(h)};n(e,t),n(t,e)}getAdjacentLocations(e){const t=this.map.get(e);return t?Array.from(t.keys()):[]}lookupAttempt(e,t){const n=this.map.get(e);return n?n.get(t)??null:null}lookup(e,t){const n=this.lookupAttempt(e,t);return assertEnabled()&&assert$2(n),n}lookupCanonical(e,t){const n=this.lookup(e,t);return n.isCanonicalHalfEdge()?n:this.lookup(t,e)}}const createBoardDescriptor=o=>{const e=o.vertices;let t=o.faces;t=t.map(F=>getSignedArea(F.vertices.map(G=>G.viewCoordinates))>0?F:{logicalCoordinates:F.logicalCoordinates,vertices:F.vertices.slice().reverse()});const n=new EdgeIdentifierLookup;t.forEach(F=>{for(let G=0;G<F.vertices.length;G++){const ie=F.vertices[G].logicalCoordinates,Z=F.vertices[(G+1)%F.vertices.length].logicalCoordinates;n.add(ie,Z)}});const r=new Map,s=new Map,a=new Map,h=new Map,c=F=>r.get(F)??null,d=F=>s.get(F)??null,y=(F,G)=>{const ie=n.lookup(F,G);return h.get(ie)??null},g=e.map(F=>new BaseVertex(F.logicalCoordinates,F.viewCoordinates));g.forEach(F=>r.set(F.logicalCoordinates,F));const D=t.map(F=>new BaseFace(F.logicalCoordinates,getCentroid(F.vertices.map(G=>G.viewCoordinates))));D.forEach(F=>s.set(F.logicalCoordinates,F));const O=n.canonicalIdentifiers.map(F=>new BaseEdge(c(F.start),c(F.end)));O.forEach(F=>a.set(n.lookupCanonical(F.start.logicalCoordinates,F.end.logicalCoordinates),F));const V=n.identifiers.map(F=>new BaseHalfEdge(c(F.start),c(F.end),!F.isCanonicalHalfEdge()));V.forEach(F=>h.set(n.lookup(F.start.logicalCoordinates,F.end.logicalCoordinates),F)),O.forEach(F=>{const G=y(F.start.logicalCoordinates,F.end.logicalCoordinates),ie=y(F.end.logicalCoordinates,F.start.logicalCoordinates);assertEnabled()&&assert$2(G),assertEnabled()&&assert$2(ie),G.edge=F,ie.edge=F,G.reversed=ie,ie.reversed=G,F.forwardHalf=G,F.reversedHalf=ie,F.vertices=[F.start,F.end]}),t.forEach(F=>{const G=d(F.logicalCoordinates),ie=F.vertices.map(X=>c(X.logicalCoordinates)),Z=[],W=[];for(let X=0;X<ie.length;X++){const J=F.vertices[X].logicalCoordinates,oe=F.vertices[(X+1)%ie.length].logicalCoordinates,le=F.vertices[(X+2)%ie.length].logicalCoordinates,pe=y(J,oe);pe.face=G;const ve=y(oe,le);pe.next=ve,ve.previous=pe,W.push(pe),Z.push(pe.edge)}G.halfEdges=W,G.edges=Z,G.vertices=ie}),V.forEach(F=>{F.face===void 0&&(F.face=null)}),O.forEach(F=>{F.forwardFace=F.forwardHalf.face,F.reversedFace=F.reversedHalf.face,F.faces=[F.forwardFace,F.reversedFace].filter(G=>G!==null)});const k=new Set(V.filter(F=>F.face===null)),M=[],N=[];for(;k.size;){const F=k.values().next().value;k.delete(F);const G=W=>{assertEnabled()&&assert$2(W.face===null);const X=W.end.logicalCoordinates,le=n.getAdjacentLocations(X).filter(pe=>pe!==W.start.logicalCoordinates).map(pe=>y(X,pe)).filter(pe=>pe.face===null);return assertEnabled()&&assert$2(le.length===1),le[0]},ie=[F];let Z=G(F);for(F.next=Z,Z.previous=F;Z!==F;){ie.push(Z),k.delete(Z);const W=Z;Z=G(Z),W.next=Z,Z.previous=W}getSignedArea(ie.map(W=>W.start.viewCoordinates))<0?M.push(ie):N.push(ie)}return assertEnabled()&&assert$2(M.length===1),g.forEach(F=>{const G=n.getAdjacentLocations(F.logicalCoordinates),ie=y(G[0],F.logicalCoordinates);let Z=ie;const W=[ie];for(;Z.reversed.previous!==ie;)assertEnabled()&&assert$2(Z.reversed.previous),Z=Z.reversed.previous,W.push(Z);F.incomingHalfEdges=W,F.outgoingHalfEdges=W.map(X=>X.reversed),F.edges=W.map(X=>X.edge),F.faces=W.map(X=>X.face).filter(X=>X!==null)}),{edges:O,vertices:g,faces:D,halfEdges:V,outerBoundary:M[0],innerBoundaries:N}};class CompositeSolver{constructor(e){this.solvers=e}get dirty(){return this.solvers.some(e=>e.dirty)}nextAction(){for(const e of this.solvers)if(e.dirty){const t=e.nextAction();if(t)return t}return null}clone(e){return new CompositeSolver(this.solvers.map(t=>t.clone(e)))}dispose(){this.solvers.forEach(e=>e.dispose())}}class InvalidStateError extends Error{constructor(e){super(e)}}const oi=class oi extends EnumerationValue{};ce(oi,"WHITE",new oi),ce(oi,"BLACK",new oi),ce(oi,"RED",new oi),ce(oi,"enumeration",new Enumeration(oi));let EdgeState=oi;const serializeEdge=o=>({start:{x:o.start.logicalCoordinates.x,y:o.start.logicalCoordinates.y},end:{x:o.end.logicalCoordinates.x,y:o.end.logicalCoordinates.y}}),deserializeEdge=(o,e)=>{const t=o.edges.find(n=>n.start.logicalCoordinates.x===e.start.x&&n.start.logicalCoordinates.y===e.start.y&&n.end.logicalCoordinates.x===e.end.x&&n.end.logicalCoordinates.y===e.end.y);return assertEnabled()&&assert$2(t),t};class EdgeStateSetAction{constructor(e,t){this.edge=e,this.state=t}apply(e){e.setEdgeState(this.edge,this.state)}getUndo(e){const t=e.getEdgeState(this.edge);return new EdgeStateSetAction(this.edge,t)}isEmpty(){return!1}serializeAction(){return{type:"EdgeStateSetAction",edge:serializeEdge(this.edge),state:this.state.name}}static deserializeAction(e,t){return new EdgeStateSetAction(deserializeEdge(e,t.edge),EdgeState.enumeration.getValue(t.state))}}class AnnotatedAction{constructor(e,t){this.action=e,this.annotation=t}apply(e){this.action.apply(e)}getUndo(e){return new AnnotatedAction(this.action.getUndo(e),this.annotation)}isEmpty(){return this.action.isEmpty()}serializeAction(){throw new Error("unimplemented")}static deserializeAction(e,t){throw new Error("unimplemented")}}class SimpleFaceColorSolver{constructor(e,t,n,r){ce(this,"dirtyEdges",new Set);ce(this,"faceColorListener");this.board=e,this.state=t,this.options=n,r?this.dirtyEdges=new Set(r):this.dirtyEdges=new Set(e.edges),this.faceColorListener=(s,a,h,c)=>{for(const d of c)for(const y of d.edges)this.dirtyEdges.add(y);for(const d of h){const y=this.state.getFacesWithColor(d);for(const g of y)for(const D of g.edges)this.dirtyEdges.add(D)}},this.state.faceColorsChangedEmitter.addListener(this.faceColorListener)}get dirty(){return this.dirtyEdges.size>0}nextAction(){if(!this.dirty)return null;if(this.state.hasInvalidFaceColors())throw new InvalidStateError("Has invalid face colors");for(;this.dirtyEdges.size>0;){const e=this.dirtyEdges.values().next().value;if(this.state.getEdgeState(e)===EdgeState.WHITE){const n=e.forwardFace?this.state.getFaceColor(e.forwardFace):this.state.getOutsideColor(),r=e.reversedFace?this.state.getFaceColor(e.reversedFace):this.state.getOutsideColor(),s=n===r,a=this.state.getOppositeFaceColor(n)===r;if(this.options.solveToBlack&&a)return new AnnotatedAction(new EdgeStateSetAction(e,EdgeState.BLACK),{type:"FaceColorToBlack",edge:e});if(this.options.solveToRed&&s)return new AnnotatedAction(new EdgeStateSetAction(e,EdgeState.RED),{type:"FaceColorToRed",edge:e})}this.dirtyEdges.delete(e)}return null}clone(e){return new SimpleFaceColorSolver(this.board,e,this.options,this.dirtyEdges)}dispose(){this.state.faceColorsChangedEmitter.removeListener(this.faceColorListener)}}class CompleteAction{constructor(e,t,n,r,s,a,h){this.faceValueAction=e,this.edgeStateAction=t,this.simpleRegionAction=n,this.faceColorAction=r,this.sectorStateAction=s,this.vertexStateAction=a,this.faceStateAction=h}apply(e){this.faceValueAction.apply(e),this.edgeStateAction.apply(e),this.simpleRegionAction.apply(e),this.faceColorAction.apply(e),this.sectorStateAction.apply(e),this.vertexStateAction.apply(e),this.faceStateAction.apply(e)}getUndo(e){return new CompleteAction(this.faceValueAction.getUndo(e),this.edgeStateAction.getUndo(e),this.simpleRegionAction.getUndo(e),this.faceColorAction.getUndo(e),this.sectorStateAction.getUndo(e),this.vertexStateAction.getUndo(e),this.faceStateAction.getUndo(e))}isEmpty(){return this.faceValueAction.isEmpty()&&this.edgeStateAction.isEmpty()&&this.simpleRegionAction.isEmpty()&&this.faceColorAction.isEmpty()&&this.sectorStateAction.isEmpty()&&this.vertexStateAction.isEmpty()&&this.faceStateAction.isEmpty()}serializeAction(){return{type:"CompleteAction",faceValueAction:this.faceValueAction.serializeAction(),edgeStateAction:this.edgeStateAction.serializeAction(),simpleRegionAction:this.simpleRegionAction.serializeAction(),faceColorAction:this.faceColorAction.serializeAction(),sectorStateAction:this.sectorStateAction.serializeAction(),vertexStateAction:this.vertexStateAction.serializeAction(),faceStateAction:this.faceStateAction.serializeAction()}}static deserializeAction(e,t){return new CompleteAction(deserializeAction(e,t.faceStateAction),deserializeAction(e,t.edgeStateAction),deserializeAction(e,t.simpleRegionAction),deserializeAction(e,t.faceColorAction),deserializeAction(e,t.sectorStateAction),deserializeAction(e,t.vertexStateAction),deserializeAction(e,t.faceStateAction))}}class EdgeStateCycleAction{constructor(e,t=!0){this.edge=e,this.forward=t}apply(e){const t=e.getEdgeState(this.edge);t===EdgeState.WHITE?e.setEdgeState(this.edge,this.forward?EdgeState.BLACK:EdgeState.RED):t===EdgeState.BLACK?e.setEdgeState(this.edge,this.forward?EdgeState.RED:EdgeState.WHITE):e.setEdgeState(this.edge,this.forward?EdgeState.WHITE:EdgeState.BLACK)}getUndo(e){return new EdgeStateCycleAction(this.edge,!this.forward)}isEmpty(){return!1}serializeAction(){return{type:"EdgeStateCycleAction",edge:serializeEdge(this.edge),forward:this.forward}}static deserializeAction(e,t){return new EdgeStateCycleAction(deserializeEdge(e,t.edge),t.forward)}}class GeneralEdgeStateAction{constructor(e,t=new Map){this.board=e,this.edgeStateMap=t}apply(e){for(const[t,n]of this.edgeStateMap)e.setEdgeState(t,n)}getUndo(e){const t=new Map;for(const n of this.edgeStateMap.keys())t.set(n,e.getEdgeState(n));return new GeneralEdgeStateAction(this.board,t)}isEmpty(){return this.edgeStateMap.size===0}serializeAction(){return{type:"GeneralEdgeAction",edges:Array.from(this.edgeStateMap.entries()).map(([e,t])=>({edge:serializeEdge(e),state:t.name}))}}static deserializeAction(e,t){return new GeneralEdgeStateAction(e,new Map(t.edges.map(n=>[deserializeEdge(e,n.edge),EdgeState.enumeration.getValue(n.state)])))}}const serializeFace=o=>({x:o.logicalCoordinates.x,y:o.logicalCoordinates.y}),deserializeFace=(o,e)=>{const t=o.faces.find(n=>n.logicalCoordinates.x===e.x&&n.logicalCoordinates.y===e.y);return assertEnabled()&&assert$2(t),t};class FaceValueSetAction{constructor(e,t){this.face=e,this.state=t}apply(e){e.setFaceValue(this.face,this.state)}getUndo(e){const t=e.getFaceValue(this.face);return new FaceValueSetAction(this.face,t)}isEmpty(){return!1}serializeAction(){return{type:"FaceValueSetAction",edge:serializeFace(this.face),state:this.state}}static deserializeAction(e,t){return new FaceValueSetAction(deserializeFace(e,t.edge),t.state)}}class GeneralFaceValueAction{constructor(e,t=new Map){this.board=e,this.faceValueMap=t}apply(e){for(const[t,n]of this.faceValueMap)e.setFaceValue(t,n)}getUndo(e){const t=new Map;for(const n of this.faceValueMap.keys())t.set(n,e.getFaceValue(n));return new GeneralFaceValueAction(this.board,t)}isEmpty(){return this.faceValueMap.size===0}serializeAction(){return{type:"GeneralFaceAction",faces:Array.from(this.faceValueMap.entries()).map(([e,t])=>({face:serializeFace(e),state:t}))}}static deserializeAction(e,t){return new GeneralFaceValueAction(e,new Map(t.faces.map(n=>[deserializeFace(e,n.face),n.state])))}}const serializeHalfEdge=o=>({start:{x:o.start.logicalCoordinates.x,y:o.start.logicalCoordinates.y},end:{x:o.end.logicalCoordinates.x,y:o.end.logicalCoordinates.y}}),serializedSimpleRegion=o=>({id:o.id,halfEdges:o.halfEdges.map(serializeHalfEdge),isSolved:o.isSolved}),simpleRegionIsSolved=o=>{const e=o.getSimpleRegions();return e.length===1&&e[0].isSolved&&o.getWeirdEdges().length===0},serializeSimpleRegionData=o=>({type:"SimpleRegionData",simpleRegions:o.getSimpleRegions().map(serializedSimpleRegion),weirdEdges:o.getWeirdEdges().map(serializeEdge)}),deserializeHalfEdge=(o,e)=>{const t=o.halfEdges.find(n=>n.start.logicalCoordinates.x===e.start.x&&n.start.logicalCoordinates.y===e.start.y&&n.end.logicalCoordinates.x===e.end.x&&n.end.logicalCoordinates.y===e.end.y);return assertEnabled()&&assert$2(t),t};class GeneralSimpleRegion{constructor(e,t,n=!1){ce(this,"edges");ce(this,"a");ce(this,"b");if(this.id=e,this.halfEdges=t,this.isSolved=n,this.a=t[0].start,this.b=t[t.length-1].end,this.edges=t.map(r=>r.edge),assertEnabled()){assert$2(t.length>0);for(let r=0;r<t.length-1;r++)assert$2(t[r].end===t[r+1].start)}}static deserializeSimpleRegion(e,t){return new GeneralSimpleRegion(t.id,t.halfEdges.map(n=>deserializeHalfEdge(e,n)),t.isSolved)}}class GeneralSimpleRegionAction{constructor(e,t=new Set,n=new Set,r=new Set,s=new Set){this.board=e,this.addedRegions=t,this.removedRegions=n,this.addedWeirdEdges=r,this.removedWeirdEdges=s}apply(e){e.modifyRegions(this.addedRegions,this.removedRegions,this.addedWeirdEdges,this.removedWeirdEdges)}getUndo(e){return new GeneralSimpleRegionAction(this.board,this.removedRegions,this.addedRegions,this.removedWeirdEdges,this.addedWeirdEdges)}isEmpty(){return this.addedRegions.size===0&&this.removedRegions.size===0&&this.addedWeirdEdges.size===0&&this.removedWeirdEdges.size===0}serializeAction(){return{type:"GeneralSimpleRegionAction",addedRegions:Array.from(this.addedRegions).map(serializedSimpleRegion),removedRegions:Array.from(this.removedRegions).map(serializedSimpleRegion),addedWeirdEdges:Array.from(this.addedWeirdEdges).map(serializeEdge),removedWeirdEdges:Array.from(this.removedWeirdEdges).map(serializeEdge)}}static deserializeAction(e,t){return new GeneralSimpleRegionAction(e,new Set(t.addedRegions.map(n=>GeneralSimpleRegion.deserializeSimpleRegion(e,n))),new Set(t.removedRegions.map(n=>GeneralSimpleRegion.deserializeSimpleRegion(e,n))),new Set(t.addedWeirdEdges.map(n=>deserializeEdge(e,n))),new Set(t.removedWeirdEdges.map(n=>deserializeEdge(e,n))))}}class NoOpAction{apply(e){}getUndo(e){return this}isEmpty(){return!0}serializeAction(){return{type:"NoOpAction"}}static deserializeAction(e,t){return new NoOpAction}}class UserLoadPuzzleAutoSolveAction extends NoOpAction{constructor(){super(...arguments);ce(this,"isUserLoadPuzzleAutoSolveAction",!0)}serializeAction(){return{type:"UserLoadPuzzleAutoSolveAction"}}static deserializeAction(t,n){return new UserLoadPuzzleAutoSolveAction}}class UserRequestSolveAction extends NoOpAction{constructor(){super(...arguments);ce(this,"isUserRequestSolveAction",!0)}serializeAction(){return{type:"UserRequestSolveAction"}}static deserializeAction(t,n){return new UserRequestSolveAction}}const deserializeAction=(o,e)=>{const t=e.type;if(t==="CompositeAction")return CompositeAction.deserializeAction(o,e);if(t==="CompleteAction")return CompleteAction.deserializeAction(o,e);if(t==="EdgeStateCycleAction")return EdgeStateCycleAction.deserializeAction(o,e);if(t==="EdgeStateSetAction")return EdgeStateSetAction.deserializeAction(o,e);if(t==="GeneralEdgeAction")return GeneralEdgeStateAction.deserializeAction(o,e);if(t==="FaceValueSetAction")return FaceValueSetAction.deserializeAction(o,e);if(t==="GeneralFaceAction")return GeneralFaceValueAction.deserializeAction(o,e);if(t==="GeneralSimpleRegionAction")return GeneralSimpleRegionAction.deserializeAction(o,e);if(t==="NoOpAction")return NoOpAction.deserializeAction(o,e);if(t==="UserLoadPuzzleAutoSolveAction")return UserLoadPuzzleAutoSolveAction.deserializeAction(o,e);if(t==="UserRequestSolveAction")return UserRequestSolveAction.deserializeAction(o,e);throw new Error(`Unknown action type: ${t}, could not deserialize`)};class CompositeAction{constructor(e){this.actions=e}apply(e){for(let t=0;t<this.actions.length;t++)this.actions[t].apply(e)}getUndo(e){return new CompositeAction(this.actions.map(t=>t.getUndo(e)).reverse())}isEmpty(){return this.actions.some(e=>!e.isEmpty())}serializeAction(){return{type:"CompositeAction",actions:this.actions.map(e=>e.serializeAction())}}static deserializeAction(e,t){return new CompositeAction(t.actions.map(n=>deserializeAction(e,n)))}}class SimpleVertexSolver{constructor(e,t,n,r){ce(this,"dirtyVertices",[]);ce(this,"edgeListener");this.board=e,this.state=t,this.options=n,r?this.dirtyVertices.push(...r):this.dirtyVertices.push(...e.vertices),this.edgeListener=(s,a)=>{this.dirtyVertices.push(...s.vertices)},this.state.edgeStateChangedEmitter.addListener(this.edgeListener)}get dirty(){return this.dirtyVertices.length>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyVertices.length;){const e=this.dirtyVertices.pop(),t=e.edges;let n=0,r=0;if(t.forEach(s=>{const a=this.state.getEdgeState(s);return a===EdgeState.BLACK?n++:a===EdgeState.WHITE&&r++,a}),n>2)throw new InvalidStateError("Too many black edges on vertex");if(n===1&&r===0)throw new InvalidStateError("Nowhere for the single edge to go");if(r>0){if(this.options.solveJointToRed&&n===2){const s=t.filter(h=>this.state.getEdgeState(h)===EdgeState.WHITE),a=t.filter(h=>this.state.getEdgeState(h)===EdgeState.BLACK);return assertEnabled()&&assert$2(a.length===2),new AnnotatedAction(new CompositeAction(s.map(h=>new EdgeStateSetAction(h,EdgeState.RED))),{type:"JointToRed",vertex:e,whiteEdges:s,blackEdges:a})}else if(this.options.solveForcedLineToBlack&&n===1&&r===1){const s=t.find(h=>this.state.getEdgeState(h)===EdgeState.WHITE),a=t.find(h=>this.state.getEdgeState(h)===EdgeState.BLACK);return assertEnabled()&&assert$2(s),assertEnabled()&&assert$2(a),new AnnotatedAction(new EdgeStateSetAction(s,EdgeState.BLACK),{type:"ForcedLine",vertex:e,blackEdge:a,whiteEdge:s,redEdges:t.filter(h=>this.state.getEdgeState(h)===EdgeState.RED)})}else if(this.options.solveAlmostEmptyToRed&&n===0&&r===1){const s=t.find(a=>this.state.getEdgeState(a)===EdgeState.WHITE);return assertEnabled()&&assert$2(s),new AnnotatedAction(new EdgeStateSetAction(s,EdgeState.RED),{type:"AlmostEmptyToRed",vertex:e,whiteEdge:s,redEdges:t.filter(a=>this.state.getEdgeState(a)===EdgeState.RED)})}}}return null}clone(e){return new SimpleVertexSolver(this.board,e,this.options,this.dirtyVertices)}dispose(){this.state.edgeStateChangedEmitter.removeListener(this.edgeListener)}}class SimpleFaceSolver{constructor(e,t,n,r){ce(this,"dirtyFaces",[]);ce(this,"faceListener");ce(this,"edgeListener");this.board=e,this.state=t,this.options=n,r?this.dirtyFaces.push(...r):this.dirtyFaces.push(...e.faces.filter(s=>t.getFaceValue(s)!==null)),this.faceListener=(s,a)=>{this.dirtyFaces.push(s)},this.edgeListener=(s,a)=>{this.dirtyFaces.push(...s.faces)},this.state.faceValueChangedEmitter.addListener(this.faceListener),this.state.edgeStateChangedEmitter.addListener(this.edgeListener)}get dirty(){return this.dirtyFaces.length>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyFaces.length;){const e=this.dirtyFaces.pop(),t=this.state.getFaceValue(e);if(t!==null){const n=e.edges;let r=0,s=0,a=0;if(n.forEach(h=>{const c=this.state.getEdgeState(h);return c===EdgeState.BLACK?r++:c===EdgeState.RED?s++:a++,c}),r>t)throw new InvalidStateError("Too many black edges on face");if(s>e.edges.length-t)throw new InvalidStateError("Too many red edges on face");if(a>0){if(this.options.solveToRed&&r===t){const h=n.filter(d=>this.state.getEdgeState(d)===EdgeState.WHITE),c=n.filter(d=>this.state.getEdgeState(d)===EdgeState.BLACK);return new AnnotatedAction(new CompositeAction(h.map(d=>new EdgeStateSetAction(d,EdgeState.RED))),{type:"FaceSatisfied",face:e,whiteEdges:h,blackEdges:c})}else if(this.options.solveToBlack&&s===e.edges.length-t){const h=n.filter(d=>this.state.getEdgeState(d)===EdgeState.WHITE),c=n.filter(d=>this.state.getEdgeState(d)===EdgeState.RED);return new AnnotatedAction(new CompositeAction(h.map(d=>new EdgeStateSetAction(d,EdgeState.BLACK))),{type:"FaceAntiSatisfied",face:e,whiteEdges:h,redEdges:c})}}}}return null}clone(e){return new SimpleFaceSolver(this.board,e,this.options,this.dirtyFaces)}dispose(){this.state.faceValueChangedEmitter.removeListener(this.faceListener),this.state.edgeStateChangedEmitter.removeListener(this.edgeListener)}}class SimpleLoopSolver{constructor(e,t,n,r){ce(this,"dirtySimpleRegions");ce(this,"hasDirtyWeirdEdges",!1);ce(this,"simpleRegionListener");ce(this,"edgeListener");this.board=e,this.state=t,this.options=n,r?this.dirtySimpleRegions=new Set(r):this.dirtySimpleRegions=new Set(t.getSimpleRegions()),this.simpleRegionListener=(s,a,h,c)=>{for(const d of a)this.dirtySimpleRegions.delete(d);for(const d of s)this.dirtySimpleRegions.add(d);this.hasDirtyWeirdEdges=t.getWeirdEdges().length>0},this.state.simpleRegionsChangedEmitter.addListener(this.simpleRegionListener),this.edgeListener=(s,a,h)=>{if(a===EdgeState.RED){const c=this.state.getSimpleRegions(),d=y=>{let g=y,D=null,O=0;do{if(O++>1e4)throw new Error("infinite loop detected");const V=g.edges.filter(N=>this.state.getEdgeState(N)===EdgeState.BLACK);if(V.length===1){for(const N of c)(N.a===g||N.b===g)&&this.dirtySimpleRegions.add(N);break}if(V.length!==0)break;const k=g.edges.filter(N=>this.state.getEdgeState(N)===EdgeState.WHITE);if(k.length!==2)break;const M=k[0].getOtherVertex(g)===D?k[1]:k[0];D=g,g=M.getOtherVertex(g)}while(g!==y)};d(s.start),d(s.end)}},this.state.edgeStateChangedEmitter.addListener(this.edgeListener)}get dirty(){return this.dirtySimpleRegions.size>0||this.hasDirtyWeirdEdges}nextAction(){if(!this.dirty)return null;if(this.state.getWeirdEdges().length)throw new InvalidStateError("has weird edges");const e=this.options.resolveAllRegions?new Set(this.state.getSimpleRegions()):this.dirtySimpleRegions;for(;e.size>0;){const t=e.values().next().value;if(!t.isSolved){const n=t.a,r=t.b,s=t.halfEdges[0].edge;for(const a of n.edges){if(a===s||this.state.getEdgeState(a)===EdgeState.RED)continue;const h=[a];let c=a,d=a.getOtherVertex(n);for(;d!==r;){let y=!1;const g=d.edges.filter(D=>{if(D===c)return!1;const O=this.state.getEdgeState(D);return O===EdgeState.BLACK&&(y=!0),O===EdgeState.WHITE});if(g.length!==1||y)break;c=g[0],h.push(c),d=c.getOtherVertex(d)}if(d===r){if(this.isSolvedWithAddedEdges(t,h)){if(this.options.solveToBlack)return new AnnotatedAction(new CompositeAction(h.map(y=>new EdgeStateSetAction(y,EdgeState.BLACK))),{type:"ForcedSolveLoop",a:n,b:r,regionEdges:t.edges,pathEdges:h})}else if(this.options.solveToRed)return new AnnotatedAction(new CompositeAction(h.map(y=>new EdgeStateSetAction(y,EdgeState.RED))),{type:"PrematureForcedLoop",a:n,b:r,regionEdges:t.edges,pathEdges:h})}}}e.delete(t)}return null}isSolvedWithAddedEdges(e,t){const n=new Set(e.edges);for(const r of t)n.add(r);for(const r of this.board.faces){const s=this.state.getFaceValue(r);if(s!==null&&r.edges.filter(h=>n.has(h)).length!==s)return!1}return!0}clone(e){return new SimpleLoopSolver(this.board,e,this.options,this.dirtySimpleRegions)}dispose(){this.state.simpleRegionsChangedEmitter.removeListener(this.simpleRegionListener),this.state.edgeStateChangedEmitter.removeListener(this.edgeListener)}}const ai=class ai extends EnumerationValue{};ce(ai,"OUTSIDE",new ai),ce(ai,"INSIDE",new ai),ce(ai,"UNDECIDED",new ai),ce(ai,"enumeration",new Enumeration(ai));let FaceColorState=ai;const serializeFaceColor=(o,e,t)=>({id:o.id,colorState:o.colorState.toString(),faces:e.map(serializeFace),oppositeFaceColorId:t}),serializeFaceColorData=o=>({type:"FaceColorData",colors:o.getFaceColors().map(e=>{var t;return serializeFaceColor(e,o.getFacesWithColor(e),((t=o.getOppositeFaceColor(e))==null?void 0:t.id)??null)}),invalidFaceColor:o.hasInvalidFaceColors()}),getFaceColorPointer=(o,e)=>{if(e.colorState===FaceColorState.OUTSIDE)return{type:"absolute",isOutside:!0};if(e.colorState===FaceColorState.INSIDE)return{type:"absolute",isOutside:!1};{const t=[...o.getFacesWithColor(e)][0];return assertEnabled()&&assert$2(t),{type:"face",face:t}}},dereferenceFaceColorPointer=(o,e)=>e.type==="face"?o.getFaceColor(e.face):e.isOutside?o.getOutsideColor():o.getInsideColor();class FaceColorMakeSameAction{constructor(e,t){this.a=e,this.b=t,assertEnabled()&&assert$2(e),assertEnabled()&&assert$2(t)}apply(e){const t=dereferenceFaceColorPointer(e,this.a),n=dereferenceFaceColorPointer(e,this.b);if(t===n)return;const r=e.getOppositeFaceColor(t),s=e.getOppositeFaceColor(n);if(assertEnabled()){const D=new Set(e.getFaceColors());assert$2(D.has(t)),assert$2(D.has(n)),r&&assert$2(D.has(r)),s&&assert$2(D.has(s))}if(r&&r===n||s&&s===t){e.modifyFaceColors([],[],new Map,new Map,!0);return}const a=[],h=new Map,c=new Map,d=FaceColorMakeSameAction.combineFaces(t,n,e,a,h),y=r&&s?FaceColorMakeSameAction.combineFaces(r,s,e,a,h):r||s;d===t&&y===r||d===n&&y===s||(c.set(d,y),y&&c.set(y,d)),e.modifyFaceColors([],a,h,c,!1)}getUndo(e){throw new Error("getUndo unimplemented in FaceColorMakeSameAction")}isEmpty(){return!1}serializeAction(){throw new Error("serializeAction unimplemented in FaceColorMakeSameAction")}static deserializeAction(e,t){throw new Error("deserializeAction unimplemented in FaceColorMakeSameAction")}static combineFaces(e,t,n,r,s){let a=null;if(e.colorState!==FaceColorState.UNDECIDED)a=t;else if(t.colorState!==FaceColorState.UNDECIDED)a=e;else{const c=n.getFacesWithColor(e),d=n.getFacesWithColor(t);a=c.length>d.length?t:e}const h=a===e?t:e;r.push(a);for(const c of n.getFacesWithColor(a))s.set(c,h);return h}}class FaceColorMakeOppositeAction{constructor(e,t){this.a=e,this.b=t,assertEnabled()&&assert$2(e),assertEnabled()&&assert$2(t)}apply(e){const t=dereferenceFaceColorPointer(e,this.a),n=dereferenceFaceColorPointer(e,this.b);if(t===n){e.modifyFaceColors([],[],new Map,new Map,!0);return}const r=e.getOppositeFaceColor(t),s=e.getOppositeFaceColor(n);if(assertEnabled()){const g=new Set(e.getFaceColors());assert$2(g.has(t)),assert$2(g.has(n)),r&&assert$2(g.has(r)),s&&assert$2(g.has(s))}if(r&&r===n||s&&s===t)return;if(r&&r===s){e.modifyFaceColors([],[],new Map,new Map,!0);return}const a=[],h=new Map,c=new Map,d=s?FaceColorMakeSameAction.combineFaces(t,s,e,a,h):t,y=r?FaceColorMakeSameAction.combineFaces(n,r,e,a,h):n;c.set(d,y),c.set(y,d),e.modifyFaceColors([],a,h,c,!1)}getUndo(e){throw new Error("getUndo unimplemented in FaceColorMakeOppositeAction")}isEmpty(){return!1}serializeAction(){throw new Error("serializeAction unimplemented in FaceColorMakeOppositeAction")}static deserializeAction(e,t){throw new Error("deserializeAction unimplemented in FaceColorMakeOppositeAction")}}class FaceColorParitySolver{constructor(e,t,n,r){ce(this,"dirtyFaces",new Set);ce(this,"edgeListener");ce(this,"faceColorListener");this.board=e,this.state=t,this.options=n,r?this.dirtyFaces=new Set(r):this.dirtyFaces=new Set(e.faces),this.faceColorListener=(s,a,h,c)=>{const d=y=>{this.dirtyFaces.add(y);for(const g of y.edges){const D=g.getOtherFace(y);D&&this.dirtyFaces.add(D)}};for(const y of c)d(y);for(const y of[...s,...h]){const g=this.state.getFacesWithColor(y);for(const D of g)d(D)}},this.state.faceColorsChangedEmitter.addListener(this.faceColorListener),this.edgeListener=(s,a)=>{for(const h of s.faces)this.dirtyFaces.add(h)},this.state.edgeStateChangedEmitter.addListener(this.edgeListener)}get dirty(){return this.dirtyFaces.size>0}nextAction(){if(!this.dirty)return null;if(this.state.hasInvalidFaceColors())throw new InvalidStateError("Has invalid face colors");for(;this.dirtyFaces.size>0;){const e=this.dirtyFaces.values().next().value,t=r=>{const s=r.getOtherFace(e),a=s?this.state.getFaceColor(s):this.state.getOutsideColor();return new Side(a,r)},n=e.edges.filter(r=>this.state.getEdgeState(r)===EdgeState.WHITE).map(t);if(n.length){const r=this.state.getFaceValue(e);if(r===null){const s=n[0].color;if(e.edges.map(t).every(c=>c.color===s)&&this.options.solveToRed){const c=e.edges.map(y=>y.getOtherFace(e)).filter(y=>y!==null);if(this.board.faces.some(y=>y!==e&&this.state.getFaceValue(y)!==null&&!c.includes(y)))return new AnnotatedAction(new CompositeAction(n.map(y=>new EdgeStateSetAction(y.edge,EdgeState.RED))),{type:"FaceColorNoTrivialLoop",face:e})}}else{const s=e.edges.filter(c=>this.state.getEdgeState(c)===EdgeState.BLACK).length,a=(c,d,y)=>{let g=[];for(const W of d){const X=W.color;let J=!1;for(const oe of g)if(oe.mainColor===X){oe.mainColorSides.add(W),J=!0;break}else if(oe.oppositeColor===X){oe.oppositeColorSides.add(W),J=!0;break}if(!J){const oe=this.state.getOppositeFaceColor(X),le=new DualColorCount(X,oe,0,0);g.push(le),le.mainColorSides.add(W)}}g=_$1.sortBy(g,W=>-W.size);const O=_$1.sortBy(g.flatMap(W=>{const X=[new SingleColorCount(W.mainColor,W.mainCount,W.mainColorSides)];return W.oppositeColor&&W.oppositeColorSides.size&&X.push(new SingleColorCount(W.oppositeColor,W.oppositeCount,W.oppositeColorSides)),X}),W=>-W.size)[0],V=O.size,k=c,M=d.length-k,N=Math.max(k,M),F=V>k,G=V>M,ie=V===N;if(F&&G)throw new InvalidStateError("Too many adjacent faces with the same color");const Z=()=>{const W=X=>[X[0].map(J=>J.edge),X[1].map(J=>J.edge)];return{face:e,remainingValue:c,availableSideCount:d.length,balancedPairs:y.map(W)}};if(F&&this.options.solveToRed)return new AnnotatedAction(new CompositeAction([...O.sides].map(W=>new EdgeStateSetAction(W.edge,EdgeState.RED))),{type:"FaceColorMatchToRed",matchingEdges:[...O.sides].map(W=>W.edge),...Z()});if(G&&this.options.solveToBlack)return new AnnotatedAction(new CompositeAction([...O.sides].map(W=>new EdgeStateSetAction(W.edge,EdgeState.BLACK))),{type:"FaceColorMatchToBlack",matchingEdges:[...O.sides].map(W=>W.edge),...Z()});if(ie&&this.options.solveColors){const W=O.color,X=d.filter(oe=>oe.color!==W),J=_$1.uniq(X.map(oe=>oe.color)).filter(oe=>oe!==this.state.getOppositeFaceColor(W));if(J.length)return assertEnabled()&&assert$2(J.every(oe=>this.state.getFaceColors().includes(oe))),new AnnotatedAction(new CompositeAction(J.map(oe=>new FaceColorMakeOppositeAction(getFaceColorPointer(this.state,W),getFaceColorPointer(this.state,oe)))),{type:"FaceColorBalance",matchingEdges:[...O.sides].map(oe=>oe.edge),oppositeEdges:[...X].map(oe=>oe.edge),...Z()})}if(this.options.allowPartialReduction)for(const W of g){if(W.size<1)continue;const X=[...W.mainColorSides].slice(0,W.size),J=[...W.oppositeColorSides].slice(0,W.size),oe=d.filter(le=>!X.includes(le)&&!J.includes(le));if(oe.length){const le=a(k-W.size,oe,y.concat([[X,J]]));if(le)return le}}return null},h=a(r-s,n,[]);if(h)return h}}this.dirtyFaces.delete(e)}return null}clone(e){return new FaceColorParitySolver(this.board,e,this.options,this.dirtyFaces)}dispose(){this.state.faceColorsChangedEmitter.removeListener(this.faceColorListener),this.state.edgeStateChangedEmitter.removeListener(this.edgeListener)}}class Side{constructor(e,t){this.color=e,this.edge=t}}class DualColorCount{constructor(e,t,n,r){ce(this,"mainColorSides",new Set);ce(this,"oppositeColorSides",new Set);this.mainColor=e,this.oppositeColor=t,this.mainCount=n,this.oppositeCount=r}get size(){return Math.min(this.mainColorSides.size,this.oppositeColorSides.size)}}class SingleColorCount{constructor(e,t,n){this.color=e,this.count=t,this.sides=n}get size(){return this.sides.size}}const iterateSolver=(o,e)=>{let t=0;for(;o.dirty;){if(t++>1e5)throw new Error("Solver iteration limit exceeded? Looped?");const n=o.nextAction();n&&n.apply(e)}},iterateSolverAndDispose=(o,e)=>{try{iterateSolver(o,e)}finally{o.dispose()}},withSolverFactory=(o,e,t,n,r)=>{const s=o(e,t,r);n(),iterateSolverAndDispose(s,t)},iterateSolverFactory=(o,e,t,n)=>{withSolverFactory(o,e,t,()=>{},n)},faceAdjacentFaces=o=>{const e=[];for(const t of o.edges){const n=t.getOtherFace(o);n&&e.push(n)}return e},edgeHasVertex=(o,e)=>o.start===e||o.end===e;class StaticDoubleMinusOneFacesSolver{constructor(e,t,n){ce(this,"dirtyFaces");ce(this,"faceListener");this.board=e,this.state=t,n?this.dirtyFaces=new Set(n):this.dirtyFaces=new Set(e.faces),this.faceListener=(r,s)=>{this.dirtyFaces.add(r);for(const a of faceAdjacentFaces(r))this.dirtyFaces.add(a)},this.state.faceValueChangedEmitter.addListener(this.faceListener)}get dirty(){return this.dirtyFaces.size>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyFaces.size;){const e=this.dirtyFaces.values().next().value,t=this.state.getFaceValue(e),n=e.edges.length;if(t===n-1)for(const r of e.edges){const s=r.getOtherFace(e);if(s){const a=this.state.getFaceValue(s),h=s.edges.length;if(a===h-1){const c=new Set([...faceAdjacentFaces(e),...faceAdjacentFaces(s)]);if(this.board.faces.some(d=>(this.state.getFaceValue(d)??0)>0&&!c.has(d))){const d=M=>!edgeHasVertex(M,r.start)&&!edgeHasVertex(M,r.end),y=e.edges.filter(d),g=s.edges.filter(d),D=M=>!M.faces.some(N=>N===e||N===s),O=[...r.start.edges.filter(D),...r.end.edges.filter(D)],V=[r,...y,...g].filter(M=>this.state.getEdgeState(M)!==EdgeState.BLACK),k=O.filter(M=>this.state.getEdgeState(M)!==EdgeState.RED);if(V.length||k.length)return new AnnotatedAction(new CompositeAction([...V.map(M=>new EdgeStateSetAction(M,EdgeState.BLACK)),...k.map(M=>new EdgeStateSetAction(M,EdgeState.RED))]),{type:"DoubleMinusOneFaces",faces:[e,s],toBlackEdges:V,toRedEdges:k})}}}}this.dirtyFaces.delete(e)}return null}clone(e){return new StaticDoubleMinusOneFacesSolver(this.board,e,this.dirtyFaces)}dispose(){this.state.faceValueChangedEmitter.removeListener(this.faceListener)}}const rt=class rt extends EnumerationValue{constructor(e,t,n,r){super(),this.zero=e,this.one=t,this.two=n,this.serializedValue=r}allows(e){return assertEnabled()&&assert$2(e===0||e===1||e===2),e===0&&this.zero||e===1&&this.one||e===2&&this.two}isSubsetOf(e){return(!this.zero||e.zero)&&(!this.one||e.one)&&(!this.two||e.two)}and(e){return rt.getWithValue(this.zero&&e.zero,this.one&&e.one,this.two&&e.two)}or(e){return rt.getWithValue(this.zero||e.zero,this.one||e.one,this.two||e.two)}withZero(e){return rt.getWithValue(e,this.one,this.two)}withOne(e){return rt.getWithValue(this.zero,e,this.two)}withTwo(e){return rt.getWithValue(this.zero,this.one,e)}with(e){return assertEnabled()&&assert$2(e===0||e===1||e===2),rt.getWithValue(e===0?!0:this.zero,e===1?!0:this.one,e===2?!0:this.two)}withAllowZero(){return this.withZero(!0)}withAllowOne(){return this.withOne(!0)}withAllowTwo(){return this.withTwo(!0)}withDisallowZero(){return this.withZero(!1)}withDisallowOne(){return this.withOne(!1)}withDisallowTwo(){return this.withTwo(!1)}serialize(){return this.serializedValue}static getWithValue(e,t,n){return rt.enumeration.values.find(r=>r.zero===e&&r.one===t&&r.two===n)}static getOnly(e){return assertEnabled()&&assert$2(e===0||e===1||e===2),rt.getWithValue(e===0,e===1,e===2)}static getNot(e){return assertEnabled()&&assert$2(e===0||e===1||e===2),rt.getWithValue(e!==0,e!==1,e!==2)}static deserialize(e){const t=sectorStateMap.get(e);return assertEnabled()&&assert$2(t,`invalid serialized value: ${e}`),t}};ce(rt,"NONE",new rt(!1,!1,!1,0)),ce(rt,"ONLY_ZERO",new rt(!0,!1,!1,1)),ce(rt,"ONLY_ONE",new rt(!1,!0,!1,2)),ce(rt,"ONLY_TWO",new rt(!1,!1,!0,3)),ce(rt,"NOT_ZERO",new rt(!1,!0,!0,4)),ce(rt,"NOT_ONE",new rt(!0,!1,!0,5)),ce(rt,"NOT_TWO",new rt(!0,!0,!1,6)),ce(rt,"ANY",new rt(!0,!0,!0,7)),ce(rt,"enumeration",new Enumeration(rt)),ce(rt,"trivialStates",[rt.NONE,rt.ONLY_ZERO,rt.ONLY_TWO,rt.ANY]);let SectorState=rt;const sectorStateMap=new Map(SectorState.enumeration.values.map(o=>[o.serializedValue,o]));class SimpleSectorSolver{constructor(e,t,n){ce(this,"dirtySectors");ce(this,"edgeListener");ce(this,"sectorListener");this.board=e,this.state=t,n?this.dirtySectors=new Set(n):this.dirtySectors=new Set(e.halfEdges),this.edgeListener=(r,s,a)=>{this.dirtySectors.add(r.forwardHalf),this.dirtySectors.add(r.forwardHalf.previous),this.dirtySectors.add(r.reversedHalf),this.dirtySectors.add(r.reversedHalf.previous)},this.state.edgeStateChangedEmitter.addListener(this.edgeListener),this.sectorListener=(r,s,a)=>{this.dirtySectors.add(r)},this.state.sectorStateChangedEmitter.addListener(this.sectorListener)}get dirty(){return this.dirtySectors.size>0}nextAction(){if(!this.dirty)return null;for(;this.dirtySectors.size;){const e=this.dirtySectors.values().next().value;this.dirtySectors.delete(e);const t=e.edge,n=e.next.edge,r=this.state.getSectorState(e);if(r===SectorState.NONE)throw new InvalidStateError(`invalid sector state: ${r}`);const s=this.state.getEdgeState(t),a=this.state.getEdgeState(n),h=(s===EdgeState.WHITE?1:0)+(a===EdgeState.WHITE?1:0),c=(s===EdgeState.BLACK?1:0)+(a===EdgeState.BLACK?1:0),d=(y,g)=>new AnnotatedAction(new CompositeAction([...y.map(D=>new EdgeStateSetAction(D,EdgeState.BLACK)),...g.map(D=>new EdgeStateSetAction(D,EdgeState.RED))]),{type:"ForcedSector",sector:e,sectorState:r,toRedEdges:g,toBlackEdges:y});if(h===0){if(!r.allows(c))throw new InvalidStateError(`invalid state: ${r} with ${c} black edges with no white`)}else if(h===1){const y=r.allows(c),g=r.allows(c+1);if(!y&&!g)throw new InvalidStateError(`invalid state: ${r} with ${c} black edges and 1 white`);if(y&&!g)return d([],[s===EdgeState.WHITE?t:n]);if(g&&!y)return d([s===EdgeState.WHITE?t:n],[])}else if(h===2){if(r===SectorState.ONLY_ZERO)return d([],[t,n]);if(r===SectorState.ONLY_TWO)return d([t,n],[])}else throw new InvalidStateError(`invalid white count: ${h}`)}return null}clone(e){return new SimpleSectorSolver(this.board,e,this.dirtySectors)}dispose(){this.state.edgeStateChangedEmitter.removeListener(this.edgeListener),this.state.sectorStateChangedEmitter.removeListener(this.sectorListener)}}class SectorStateSetAction{constructor(e,t){this.sector=e,this.state=t}apply(e){e.setSectorState(this.sector,this.state)}getUndo(e){const t=e.getSectorState(this.sector);return new SectorStateSetAction(this.sector,t)}isEmpty(){return!1}serializeAction(){return{type:"SectorStateSetAction",sector:serializeHalfEdge(this.sector),state:this.state.serialize()}}static deserializeAction(e,t){return new SectorStateSetAction(deserializeHalfEdge(e,t.sector),SectorState.deserialize(t.state))}}class StaticSectorSolver{constructor(e,t,n){ce(this,"dirtyFaces");ce(this,"faceListener");this.board=e,this.state=t,n?this.dirtyFaces=new Set(n):this.dirtyFaces=new Set(e.faces),this.faceListener=(r,s)=>{this.dirtyFaces.add(r);for(const a of faceAdjacentFaces(r))this.dirtyFaces.add(a)},this.state.faceValueChangedEmitter.addListener(this.faceListener)}get dirty(){return this.dirtyFaces.size>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyFaces.size;){const e=this.dirtyFaces.values().next().value,t=this.state.getFaceValue(e),n=e.edges.length;let r=null;if(t===0?r=SectorState.ONLY_ZERO:t===1?r=SectorState.NOT_TWO:t===n-1?r=SectorState.NOT_ZERO:t===n&&(r=SectorState.ONLY_TWO),r){const s=e.halfEdges,a=[],h=[];for(const c of s){const d=this.state.getSectorState(c),y=d.and(r);if(y===SectorState.NONE)throw new InvalidStateError(`invalid sector state: ${d}`);d!==y&&(a.push(new SectorStateSetAction(c,y)),h.push(c))}if(a.length)return new AnnotatedAction(new CompositeAction(a),{type:"StaticFaceSectors",face:e,sectors:h})}this.dirtyFaces.delete(e)}return null}clone(e){return new StaticSectorSolver(this.board,e,this.dirtyFaces)}dispose(){this.state.faceValueChangedEmitter.removeListener(this.faceListener)}}class VertexToEdgeSolver{constructor(e,t,n,r){ce(this,"dirtyVertices",[]);ce(this,"vertexListener");this.board=e,this.state=t,this.options=n,r?this.dirtyVertices.push(...r):this.dirtyVertices.push(...e.vertices),this.vertexListener=s=>{this.dirtyVertices.push(s)},this.state.vertexStateChangedEmitter.addListener(this.vertexListener)}get dirty(){return this.dirtyVertices.length>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyVertices.length;){const e=this.dirtyVertices.pop(),t=this.state.getVertexState(e);if(t.possibilityCount===0)throw new InvalidStateError("Vertex has no possibilities");const n=[],r=[];for(const s of e.edges)if(this.state.getEdgeState(s)===EdgeState.WHITE){const h=t.getFinalStatesOfEdge(s);if(h.size===1){const c=[...h][0];c===EdgeState.RED&&this.options.solveToRed&&n.push(s),c===EdgeState.BLACK&&this.options.solveToBlack&&r.push(s)}}if(n.length||r.length)return new AnnotatedAction(new CompositeAction([...n.map(s=>new EdgeStateSetAction(s,EdgeState.RED)),...r.map(s=>new EdgeStateSetAction(s,EdgeState.BLACK))]),{type:"VertexStateToEdge",vertex:e,toRedEdges:n,toBlackEdges:r})}return null}clone(e){return new VertexToEdgeSolver(this.board,e,this.options,this.dirtyVertices)}dispose(){this.state.vertexStateChangedEmitter.removeListener(this.vertexListener)}}const getSectorsFromVertex=o=>o.incomingHalfEdges;class VertexToSectorSolver{constructor(e,t,n){ce(this,"dirtyVertices",[]);ce(this,"vertexListener");this.board=e,this.state=t,n?this.dirtyVertices.push(...n):this.dirtyVertices.push(...e.vertices),this.vertexListener=r=>{this.dirtyVertices.push(r)},this.state.vertexStateChangedEmitter.addListener(this.vertexListener)}get dirty(){return this.dirtyVertices.length>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyVertices.length;){const e=this.dirtyVertices.pop(),t=this.state.getVertexState(e);if(t.possibilityCount===0)throw new InvalidStateError("Vertex has no possibilities");const n=getSectorsFromVertex(e),r=n.map(d=>this.state.getSectorState(d)),s=n.map(d=>SectorState.NONE);for(const d of t.getAllowedPairs())for(let y=0;y<n.length;y++){const g=n[y],D=g.edge,O=g.next.edge,V=d[0],k=d[1],M=(D===V||D===k?1:0)+(O===V||O===k?1:0);s[y]=s[y].with(M)}if(t.allowsEmpty())for(let d=0;d<n.length;d++)s[d]=s[d].withZero(!0);for(let d=0;d<n.length;d++)s[d]=s[d].and(r[d]);for(const d of s)if(d===SectorState.NONE)throw new InvalidStateError("Sector has no possibilities");const a=[],h=[],c=[];for(let d=0;d<n.length;d++)r[d]!==s[d]&&(a.push(n[d]),h.push(r[d]),c.push(s[d]));if(a.length)return new AnnotatedAction(new CompositeAction(a.map((d,y)=>new SectorStateSetAction(d,c[y]))),{type:"VertexStateToSector",vertex:e,sectors:a,beforeStates:h,afterStates:c})}return null}clone(e){return new VertexToSectorSolver(this.board,e,this.dirtyVertices)}dispose(){this.state.vertexStateChangedEmitter.removeListener(this.vertexListener)}}const getFaceOrderedSectorsFromVertex=o=>{let e=getSectorsFromVertex(o);return e=[...e.slice(1),e[0]],assertEnabled()&&assert$2(e[0].edge===o.edges[1]&&e[0].next.edge===o.edges[0]),e};class VertexToFaceColorSolver{constructor(e,t,n){ce(this,"dirtyVertices",[]);ce(this,"vertexListener");this.board=e,this.state=t,n?this.dirtyVertices.push(...n):this.dirtyVertices.push(...e.vertices),this.vertexListener=r=>{this.dirtyVertices.push(r)},this.state.vertexStateChangedEmitter.addListener(this.vertexListener)}get dirty(){return this.dirtyVertices.length>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyVertices.length;){const e=this.dirtyVertices[this.dirtyVertices.length-1],t=this.state.getVertexState(e);if(t.possibilityCount===0)throw new InvalidStateError("Vertex has no possibilities");const r=getFaceOrderedSectorsFromVertex(e).map(h=>h.face?this.state.getFaceColor(h.face):this.state.getOutsideColor()),s=new Set(r);if(s.size!==1){const h=new Map([...s].map(d=>[d,new Map([...s].map(y=>[y,!1]))])),c=new Map([...s].map(d=>[d,new Map([...s].map(y=>[y,!1]))]));for(const d of t.getAllowedPairs()){const y=e.edges.indexOf(d[0]),g=e.edges.indexOf(d[1]),D=Math.min(y,g),O=Math.max(y,g),V=r.slice(D,O),k=[...r.slice(O),...r.slice(0,D)],M=N=>{for(let F=0;F<N.length;F++)for(let G=F+1;G<N.length;G++)h.get(N[F]).set(N[G],!0),h.get(N[G]).set(N[F],!0)};M(V),M(k);for(const N of V)for(const F of k)N!==F&&(c.get(N).set(F,!0),c.get(F).set(N,!0))}for(const d of s)for(const y of s){if(d===y)continue;const g=t.allowsEmpty()||h.get(d).get(y),D=c.get(d).get(y);if(g&&!D)return new AnnotatedAction(new FaceColorMakeSameAction(getFaceColorPointer(this.state,d),getFaceColorPointer(this.state,y)),{type:"VertexStateToSameFaceColor",vertex:e,facesA:e.faces.filter(O=>this.state.getFaceColor(O)===d),facesB:e.faces.filter(O=>this.state.getFaceColor(O)===y)});if(D&&!g&&this.state.getOppositeFaceColor(d)!==y)return new AnnotatedAction(new FaceColorMakeOppositeAction(getFaceColorPointer(this.state,d),getFaceColorPointer(this.state,y)),{type:"VertexStateToOppositeFaceColor",vertex:e,facesA:e.faces.filter(O=>this.state.getFaceColor(O)===d),facesB:e.faces.filter(O=>this.state.getFaceColor(O)===y)})}}const a=this.dirtyVertices.pop();assertEnabled()&&assert$2(a===e)}return null}clone(e){return new VertexToFaceColorSolver(this.board,e,this.dirtyVertices)}dispose(){this.state.vertexStateChangedEmitter.removeListener(this.vertexListener)}}const packBooleanArray=o=>{const e=new Uint8Array(Math.ceil(o.length/8));for(let n=0;n<o.length;n++)o[n]&&(e[Math.floor(n/8)]|=1<<7-n%8);const t=btoa(String.fromCharCode(...e));if(assertEnabled()){const n=unpackBooleanArray(t,o.length);assert$2(o.length===n.length&&o.every((r,s)=>r===n[s]))}return t},unpackBooleanArray=(o,e)=>{const t=Uint8Array.from(atob(o),r=>r.charCodeAt(0)),n=[];for(let r=0;r<t.length*8;r++)n.push((t[Math.floor(r/8)]&1<<7-r%8)!==0);return n.slice(0,e)},lazyFactorials=[],getLazyFactorials=o=>{for(;lazyFactorials.length<=o;)lazyFactorials.push(lazyFactorials.length===0?1:lazyFactorials[lazyFactorials.length-1]*lazyFactorials.length);return lazyFactorials},getBinomialCoefficient=(o,e,t)=>t[o]/(t[e]*t[o-e]),getCombinationIndex=(o,e)=>{o=_$1.sortBy(o);const t=getLazyFactorials(e);let n=0;const r=o.length;for(let s=0;s<r;s++){const a=o[s-1]+1,h=o[s];for(let c=s==0?0:a;c<h;c++)n+=getBinomialCoefficient(e-c-1,r-s-1,t)}return n},getCombinationQuantity=(o,e)=>getBinomialCoefficient(o,e,getLazyFactorials(o)),getBinaryIndex=(o,e)=>{let t=0;for(let n=0;n<o.length;n++)t+=1<<e-o[n]-1;return t},getBinaryQuantity=o=>1<<o;class FaceState{constructor(e,t,n,r){ce(this,"order");ce(this,"possibilityCount");ce(this,"matrix");this.face=e,this.faceValue=t,this.order=e.edges.length,n?this.matrix=n:this.matrix=_$1.range(0,FaceState.getMatrixSize(this.order,this.faceValue)).map(()=>!0),r!==void 0?this.possibilityCount=r:this.possibilityCount=this.matrix.filter(s=>s).length,assertEnabled()&&assert$2(this.matrix.length===FaceState.getMatrixSize(this.order,this.faceValue)),assertEnabled()&&assert$2(this.possibilityCount===this.matrix.filter(s=>s).length)}isAny(){return this.possibilityCount===FaceState.getMatrixSize(this.order,this.faceValue)}isForced(){return this.possibilityCount===1}allowsEmpty(){return this.allowsBlackEdges([])}allowsBlackEdges(e){return this.matrix[this.getBlackEdgesIndex(e)]}getAllowedCombinations(){const e=[];return FaceState.forEachEdgeCombination(this.face.edges,this.faceValue,(t,n)=>{this.matrix[this.getIndexFromIndices(t)]&&e.push(n.slice())}),assertEnabled()&&assert$2(e.length===this.possibilityCount),e}getFinalStatesOfEdge(e){const t=new Set;for(const n of this.getAllowedCombinations())n.includes(e)?t.add(EdgeState.BLACK):t.add(EdgeState.RED);return this.allowsEmpty()&&t.add(EdgeState.RED),t}getBlackEdgesIndex(e){const t=e.map(n=>this.face.edges.indexOf(n));return assertEnabled()&&assert$2(t.every(n=>n>=0)),this.getIndexFromIndices(t)}getIndexFromIndices(e){return this.faceValue===null?getBinaryIndex(e,this.order):getCombinationIndex(e,this.order)}equals(e){return this.face===e.face&&this.matrix.every((t,n)=>t===e.matrix[n])}and(e){return assertEnabled()&&assert$2(this.face===e.face),new FaceState(this.face,this.faceValue,this.matrix.map((t,n)=>t&&e.matrix[n]))}or(e){return assertEnabled()&&assert$2(this.face===e.face),new FaceState(this.face,this.faceValue,this.matrix.map((t,n)=>t||e.matrix[n]))}isSubsetOf(e){return this.matrix.every((t,n)=>!t||e.matrix[n])}withBlackEdges(e,t){const n=this.getBlackEdgesIndex(e);return new FaceState(this.face,this.faceValue,this.matrix.slice(0,n).concat(t,this.matrix.slice(n+1)))}serialize(){if(this.isAny())return{faceValue:this.faceValue,matrix:"",isAny:!0};const e={faceValue:this.faceValue,matrix:packBooleanArray(this.matrix),isAny:!1};return assertEnabled()&&assert$2(this.equals(FaceState.deserialize(this.face,e))),e}static getMatrixSize(e,t){return t===null?getBinaryQuantity(e):getCombinationQuantity(e,t)}static forEachIndexCombination(e,t,n){let r=[];const s=()=>{if(t!==null){if(r.length===t){n(r);return}}else n(r);const a=r.length>0?r[r.length-1]+1:0;for(let h=a;h<e;h++)r.push(h),s(),r.pop()};s()}static forEachEdgeCombination(e,t,n){let r=[],s=[];const a=()=>{if(t!==null){if(r.length===t){n(r,s);return}}else n(r,s);const h=r.length>0?r[r.length-1]+1:0;for(let c=h;c<e.length;c++)r.push(c),s.push(e[c]),a(),r.pop(),s.pop()};a()}static fromLookup(e,t,n){const r=e.edges.length,s=new Array(FaceState.getMatrixSize(r,t)).fill(!1);return FaceState.forEachEdgeCombination(e.edges,t,(a,h)=>{if(n(h)){const d=t===null?getBinaryIndex(a,r):getCombinationIndex(a,r);s[d]=!0}}),new FaceState(e,t,s)}static none(e,t){const n=FaceState.getMatrixSize(e.edges.length,t),r=new Array(n).fill(!1);return new FaceState(e,t,r,0)}static any(e,t){const n=FaceState.getMatrixSize(e.edges.length,t),r=new Array(n).fill(!0);return new FaceState(e,t,r,n)}static withOnlyBlackEdges(e,t,n){const r=FaceState.getMatrixSize(e.edges.length,t),s=new Array(r).fill(!1),a=n.map(c=>e.edges.indexOf(c)),h=t===null?getBinaryIndex(a,e.edges.length):getCombinationIndex(a,e.edges.length);return s[h]=!0,new FaceState(e,t,s,1)}static withoutBlackEdges(e,t,n){const r=FaceState.getMatrixSize(e.edges.length,t),s=new Array(r).fill(!0),a=n.map(c=>e.edges.indexOf(c)),h=t===null?getBinaryIndex(a,e.edges.length):getCombinationIndex(a,e.edges.length);return s[h]=!1,new FaceState(e,t,s,r-1)}static fromVertexAndColorData(e,t,n){const s=e.vertices.map(y=>n.getVertexState(y)).map(y=>{const g=y.vertex.edges.filter(D=>D.faces.includes(e));return assertEnabled()&&assert$2(g.length===2),{edgeA:g[0],edgeB:g[1],...y.getBinaryCombinationsAllowed(g[0],g[1])}}),a=new Map(e.edges.map(y=>{const g=y.getOtherFace(e);return[y,g?n.getFaceColor(g):n.getOutsideColor()]})),h=n.getFaceColor(e),c=new Set([...a.values(),h]),d=new Map([...c].map(y=>[y,n.getOppositeFaceColor(y)]));return FaceState.fromLookup(e,n.getFaceValue(e),y=>{const g=new Set(y);for(const V of s){const k=g.has(V.edgeA),M=g.has(V.edgeB);if(k&&M&&!V.allowsBoth||k&&!M&&!V.allowsAOnly||!k&&M&&!V.allowsBOnly||!k&&!M&&!V.allowsNone)return!1}const D=new Set([h]),O=new Set;for(const V of e.edges){const k=a.get(V);assertEnabled()&&assert$2(k),g.has(V)?O.add(k):D.add(k)}for(const V of D){if(O.has(V))return!1;const k=d.get(V);if(k&&D.has(k))return!1}for(const V of O){const k=d.get(V);if(k&&O.has(k))return!1}if(g.size===e.edges.length){for(const V of t.faces)if(n.getFaceValue(V)!==null){for(const k of V.edges)if(!g.has(k))return!1}}return!0})}static deserialize(e,t){return t.isAny?FaceState.any(e,t.faceValue):new FaceState(e,t.faceValue,unpackBooleanArray(t.matrix,FaceState.getMatrixSize(e.edges.length,t.faceValue)))}}class FaceStateSetAction{constructor(e,t){this.face=e,this.state=t}apply(e){e.setFaceState(this.face,this.state)}getUndo(e){const t=e.getFaceState(this.face);return new FaceStateSetAction(this.face,t)}isEmpty(){return!1}serializeAction(){return{type:"FaceStateSetAction",face:serializeFace(this.face),state:this.state.serialize()}}static deserializeAction(e,t){const n=deserializeFace(e,t.face);return new FaceStateSetAction(n,FaceState.deserialize(n,t.state))}}class VertexColorToFaceSolver{constructor(e,t,n){ce(this,"dirtyFaces");ce(this,"faceValueListener");ce(this,"vertexStateListener");ce(this,"faceColorListener");this.board=e,this.state=t,n?this.dirtyFaces=new Set(n):this.dirtyFaces=new Set(e.faces.filter(r=>t.getFaceValue(r)!==null)),this.faceValueListener=(r,s)=>{this.dirtyFaces.add(r)},this.state.faceValueChangedEmitter.addListener(this.faceValueListener),this.vertexStateListener=r=>{for(const s of r.faces)this.dirtyFaces.add(s)},this.state.vertexStateChangedEmitter.addListener(this.vertexStateListener),this.faceColorListener=(r,s,a,h)=>{const c=d=>{this.dirtyFaces.add(d);for(const y of d.edges){const g=y.getOtherFace(d);g&&this.dirtyFaces.add(g)}};for(const d of h)c(d);for(const d of[...r,...a]){const y=this.state.getFacesWithColor(d);for(const g of y)c(g)}},this.state.faceColorsChangedEmitter.addListener(this.faceColorListener)}get dirty(){return this.dirtyFaces.size>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyFaces.size;){const e=this.dirtyFaces.values().next().value;this.dirtyFaces.delete(e);const t=this.state.getFaceState(e),n=FaceState.fromVertexAndColorData(e,this.board,this.state).and(t);if(!t.equals(n))return new AnnotatedAction(new FaceStateSetAction(e,n),{type:"FaceState",face:e,beforeState:t,afterState:n})}return null}clone(e){return new VertexColorToFaceSolver(this.board,e)}dispose(){this.state.faceValueChangedEmitter.removeListener(this.faceValueListener),this.state.vertexStateChangedEmitter.removeListener(this.vertexStateListener),this.state.faceColorsChangedEmitter.removeListener(this.faceColorListener)}}class FaceToEdgeSolver{constructor(e,t,n,r){ce(this,"dirtyFaces",[]);ce(this,"vertexListener");this.board=e,this.state=t,this.options=n,r?this.dirtyFaces.push(...r):this.dirtyFaces.push(...e.faces),this.vertexListener=s=>{this.dirtyFaces.push(s)},this.state.faceStateChangedEmitter.addListener(this.vertexListener)}get dirty(){return this.dirtyFaces.length>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyFaces.length;){const e=this.dirtyFaces.pop(),t=this.state.getFaceState(e);if(t.possibilityCount===0)throw new InvalidStateError("Face has no possibilities");const n=[],r=[];for(const s of e.edges)if(this.state.getEdgeState(s)===EdgeState.WHITE){const h=t.getFinalStatesOfEdge(s);if(h.size===1){const c=[...h][0];c===EdgeState.RED&&this.options.solveToRed&&n.push(s),c===EdgeState.BLACK&&this.options.solveToBlack&&r.push(s)}}if(n.length||r.length)return new AnnotatedAction(new CompositeAction([...n.map(s=>new EdgeStateSetAction(s,EdgeState.RED)),...r.map(s=>new EdgeStateSetAction(s,EdgeState.BLACK))]),{type:"FaceStateToEdge",face:e,toRedEdges:n,toBlackEdges:r})}return null}clone(e){return new FaceToEdgeSolver(this.board,e,this.options,this.dirtyFaces)}dispose(){this.state.faceStateChangedEmitter.removeListener(this.vertexListener)}}class FaceToSectorSolver{constructor(e,t,n){ce(this,"dirtyFaces",[]);ce(this,"faceListener");this.board=e,this.state=t,n?this.dirtyFaces.push(...n):this.dirtyFaces.push(...e.faces),this.faceListener=r=>{this.dirtyFaces.push(r)},this.state.faceStateChangedEmitter.addListener(this.faceListener)}get dirty(){return this.dirtyFaces.length>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyFaces.length;){const e=this.dirtyFaces.pop(),t=this.state.getFaceState(e);if(t.possibilityCount===0)throw new InvalidStateError("Face has no possibilities");const n=e.halfEdges,r=n.map(d=>this.state.getSectorState(d)),s=n.map(d=>SectorState.NONE);for(const d of t.getAllowedCombinations())for(let y=0;y<n.length;y++){const g=n[y],D=g.edge,O=g.next.edge,V=(d.includes(D)?1:0)+(d.includes(O)?1:0);s[y]=s[y].with(V)}for(let d=0;d<n.length;d++)s[d]=s[d].and(r[d]);for(const d of s)if(d===SectorState.NONE)throw new InvalidStateError("Sector has no possibilities");const a=[],h=[],c=[];for(let d=0;d<n.length;d++)r[d]!==s[d]&&(a.push(n[d]),h.push(r[d]),c.push(s[d]));if(a.length)return new AnnotatedAction(new CompositeAction(a.map((d,y)=>new SectorStateSetAction(d,c[y]))),{type:"FaceStateToSector",face:e,sectors:a,beforeStates:h,afterStates:c})}return null}clone(e){return new FaceToSectorSolver(this.board,e,this.dirtyFaces)}dispose(){this.state.faceStateChangedEmitter.removeListener(this.faceListener)}}class FaceToFaceColorSolver{constructor(e,t,n){ce(this,"dirtyFaces",[]);ce(this,"faceListener");this.board=e,this.state=t,n?this.dirtyFaces.push(...n):this.dirtyFaces.push(...e.faces),this.faceListener=r=>{this.dirtyFaces.push(r)},this.state.faceStateChangedEmitter.addListener(this.faceListener)}get dirty(){return this.dirtyFaces.length>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyFaces.length;){const e=this.dirtyFaces[this.dirtyFaces.length-1],t=this.state.getFaceState(e);if(t.possibilityCount===0)throw new InvalidStateError("Face has no possibilities");const n=new Map(e.edges.map(c=>{const d=c.getOtherFace(e);return[c,d?this.state.getFaceColor(d):this.state.getOutsideColor()]})),r=[e,...e.edges.map(c=>c.getOtherFace(e)).filter(_$1.identity)],s=this.state.getFaceColor(e),a=new Set([...n.values(),s]);if(a.size!==1){const c=new Map([...a].map(y=>[y,new Map([...a].map(g=>[g,!1]))])),d=new Map([...a].map(y=>[y,new Map([...a].map(g=>[g,!1]))]));for(const y of t.getAllowedCombinations()){const g=new Set([s]),D=new Set;for(const V of e.edges)y.includes(V)?D.add(n.get(V)):g.add(n.get(V));const O=V=>{for(let k=0;k<V.length;k++)for(let M=k+1;M<V.length;M++)c.get(V[k]).set(V[M],!0),c.get(V[M]).set(V[k],!0)};O([...g]),O([...D]);for(const V of g)for(const k of D)V!==k&&(d.get(V).set(k,!0),d.get(k).set(V,!0))}for(const y of a)for(const g of a){if(y===g)continue;const D=c.get(y).get(g),O=d.get(y).get(g);if(D&&!O)return new AnnotatedAction(new FaceColorMakeSameAction(getFaceColorPointer(this.state,y),getFaceColorPointer(this.state,g)),{type:"FaceStateToSameFaceColor",face:e,facesA:r.filter(V=>this.state.getFaceColor(V)===y),facesB:r.filter(V=>this.state.getFaceColor(V)===g)});if(O&&!D&&this.state.getOppositeFaceColor(y)!==g)return new AnnotatedAction(new FaceColorMakeOppositeAction(getFaceColorPointer(this.state,y),getFaceColorPointer(this.state,g)),{type:"FaceStateToOppositeFaceColor",face:e,facesA:r.filter(V=>this.state.getFaceColor(V)===y),facesB:r.filter(V=>this.state.getFaceColor(V)===g)})}}const h=this.dirtyFaces.pop();assertEnabled()&&assert$2(h===e)}return null}clone(e){return new FaceToFaceColorSolver(this.board,e,this.dirtyFaces)}dispose(){this.state.faceStateChangedEmitter.removeListener(this.faceListener)}}class VertexState{constructor(e,t,n){ce(this,"order");ce(this,"possibilityCount");ce(this,"matrix");this.vertex=e,this.order=e.edges.length,t?this.matrix=t:this.matrix=_$1.range(0,VertexState.getMatrixSize(this.order)).map(()=>!0),n!==void 0?this.possibilityCount=n:this.possibilityCount=this.matrix.filter(r=>r).length,assertEnabled()&&assert$2(this.matrix.length===VertexState.getMatrixSize(this.order)),assertEnabled()&&assert$2(this.possibilityCount===this.matrix.filter(r=>r).length)}isAny(){return this.possibilityCount===VertexState.getMatrixSize(this.order)}isForced(){return this.possibilityCount===1}allowsEmpty(){return this.matrix[VertexState.getMatrixSize(this.order)-1]}allowsPair(e,t){return this.matrix[this.getPairIndex(e,t)]}getBinaryCombinationsAllowed(e,t){let n=this.allowsEmpty(),r=!1,s=!1,a=!1;for(const h of this.getAllowedPairs()){const c=h[0]===e||h[1]===e,d=h[0]===t||h[1]===t;c&&d?r=!0:c?s=!0:d?a=!0:n=!0}return{allowsNone:n,allowsBoth:r,allowsAOnly:s,allowsBOnly:a}}getAllowedPairs(){const e=[];let t=0;for(let n=0;n<this.order;n++)for(let r=n+1;r<this.order;r++)this.matrix[t++]&&e.push([this.vertex.edges[n],this.vertex.edges[r]]);return e}getFinalStatesOfEdge(e){const t=new Set;for(const n of this.getAllowedPairs())n[0]===e||n[1]===e?t.add(EdgeState.BLACK):t.add(EdgeState.RED);return this.allowsEmpty()&&t.add(EdgeState.RED),t}getPairIndex(e,t){const n=this.vertex.edges.indexOf(e),r=this.vertex.edges.indexOf(t),s=Math.min(n,r),a=Math.max(n,r);return VertexState.getIndex(s,a,this.order)}equals(e){return this.vertex===e.vertex&&this.matrix.every((t,n)=>t===e.matrix[n])}and(e){return assertEnabled()&&assert$2(this.vertex===e.vertex),new VertexState(this.vertex,this.matrix.map((t,n)=>t&&e.matrix[n]))}or(e){return assertEnabled()&&assert$2(this.vertex===e.vertex),new VertexState(this.vertex,this.matrix.map((t,n)=>t||e.matrix[n]))}isSubsetOf(e){return this.matrix.every((t,n)=>!t||e.matrix[n])}withEmpty(e){return new VertexState(this.vertex,this.matrix.slice(0,-1).concat(e))}withPair(e,t,n){const r=this.getPairIndex(e,t);return new VertexState(this.vertex,this.matrix.slice(0,r).concat(n,this.matrix.slice(r+1)))}serialize(){const e=packBooleanArray(this.matrix);return assertEnabled()&&assert$2(this.equals(VertexState.deserialize(this.vertex,e))),e}static getIndex(e,t,n){return e*(2*n-e-1)/2+(t-e-1)}static getMatrixSize(e){return e*(e-1)/2+1}static fromLookup(e,t,n){const r=e.edges.length,s=[];for(let a=0;a<r;a++)for(let h=a+1;h<r;h++)s.push(t(e.edges[a],e.edges[h]));return s.push(n),new VertexState(e,s)}static none(e){return VertexState.fromLookup(e,()=>!1,!1)}static any(e){return VertexState.fromLookup(e,()=>!0,!0)}static withOnlyEmpty(e){return VertexState.fromLookup(e,()=>!1,!0)}static withOnlyPair(e,t,n){return VertexState.fromLookup(e,(r,s)=>r===t&&s===n||r===n&&s===t,!1)}static withoutEmpty(e){return VertexState.fromLookup(e,()=>!0,!1)}static withoutPair(e,t,n){return VertexState.fromLookup(e,(r,s)=>r!==t&&r!==n||s!==t&&s!==n,!0)}static fromEdgeColorSectorData(e,t){const n=e.edges.length,r=[],s=e.edges.filter(k=>t.getEdgeState(k)===EdgeState.BLACK);if(s.length>2)return VertexState.none(e);if(s.length===2)return VertexState.withOnlyPair(e,s[0],s[1]);const a=s.length?s[0]:null,h=new Set(e.edges.filter(k=>t.getEdgeState(k)===EdgeState.RED));if(h.size===n)return VertexState.withOnlyEmpty(e);const c=getFaceOrderedSectorsFromVertex(e),d=c.map(k=>t.getSectorState(k)),y=d.every(k=>k.zero),g=c.map(k=>k.face?t.getFaceColor(k.face):t.getOutsideColor()),D=new Set(g),O=new Map([...D].map(k=>[k,t.getOppositeFaceColor(k)])),V=[...O.values()].every(k=>!k||!D.has(k));for(let k=0;k<n;k++){const M=e.edges[k];if(h.has(M)){for(let N=k+1;N<n;N++)r.push(!1);continue}for(let N=k+1;N<n;N++){let F=!0;const G=e.edges[N];if(F&&h.has(G)&&(F=!1),F&&a&&M!==a&&G!==a&&(F=!1),F&&(F=F&&d.every((ie,Z)=>{const W=c[Z];let X=0;return(M===W.edge||M===W.next.edge)&&X++,(G===W.edge||G===W.next.edge)&&X++,ie.allows(X)})),F){const ie=g.slice(k,N),Z=[...g.slice(N),...g.slice(0,k)];ie.some(W=>Z.includes(W))&&(F=!1),F&&ie.some(W=>{const X=O.get(W);return X&&ie.includes(X)})&&(F=!1),F&&Z.some(W=>{const X=O.get(W);return X&&Z.includes(X)})&&(F=!1)}r.push(F)}}return r.push(s.length===0&&y&&V),new VertexState(e,r)}static deserialize(e,t){return new VertexState(e,unpackBooleanArray(t,VertexState.getMatrixSize(e.edges.length)))}}const serializeVertex=o=>({x:o.logicalCoordinates.x,y:o.logicalCoordinates.y}),deserializeVertex=(o,e)=>{const t=o.vertices.find(n=>n.logicalCoordinates.x===e.x&&n.logicalCoordinates.y===e.y);return assertEnabled()&&assert$2(t),t};class VertexStateSetAction{constructor(e,t){this.vertex=e,this.state=t}apply(e){e.setVertexState(this.vertex,this.state)}getUndo(e){const t=e.getVertexState(this.vertex);return new VertexStateSetAction(this.vertex,t)}isEmpty(){return!1}serializeAction(){return{type:"VertexStateSetAction",vertex:serializeVertex(this.vertex),state:this.state.serialize()}}static deserializeAction(e,t){const n=deserializeVertex(e,t.vertex);return new VertexStateSetAction(n,VertexState.deserialize(n,t.state))}}class FaceToVertexSolver{constructor(e,t,n){ce(this,"dirtyFaces",[]);ce(this,"faceListener");this.board=e,this.state=t,n?this.dirtyFaces.push(...n):this.dirtyFaces.push(...e.faces),this.faceListener=r=>{this.dirtyFaces.push(r)},this.state.faceStateChangedEmitter.addListener(this.faceListener)}get dirty(){return this.dirtyFaces.length>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyFaces.length;){const e=this.dirtyFaces.pop(),t=this.state.getFaceState(e);if(t.possibilityCount===0)throw new InvalidStateError("Face has no possibilities");const n=e.vertices.map(h=>this.state.getVertexState(h)),r=n.map(h=>{const c=h.vertex.edges.filter(d=>d.faces.includes(e));return assertEnabled()&&assert$2(c.length===2),{vertex:h.vertex,vertexState:h,edgeA:c[0],edgeB:c[1],...h.getBinaryCombinationsAllowed(c[0],c[1])}}),s=r.map(h=>({vertex:h.vertex,vertexState:h.vertexState,edgeA:h.edgeA,edgeB:h.edgeB,allowsNone:!1,allowsBoth:!1,allowsAOnly:!1,allowsBOnly:!1}));for(const h of t.getAllowedCombinations())for(const c of s){const d=h.includes(c.edgeA),y=h.includes(c.edgeB);d&&y&&(c.allowsBoth=!0),d&&!y&&(c.allowsAOnly=!0),!d&&y&&(c.allowsBOnly=!0),!d&&!y&&(c.allowsNone=!0)}const a=[];for(let h=0;h<s.length;h++){const c=r[h],d=s[h];if(d.allowsBoth&&(d.allowsBoth=c.allowsBoth),d.allowsAOnly&&(d.allowsAOnly=c.allowsAOnly),d.allowsBOnly&&(d.allowsBOnly=c.allowsBOnly),d.allowsNone&&(d.allowsNone=c.allowsNone),d.allowsBoth!==c.allowsBoth||d.allowsAOnly!==c.allowsAOnly||d.allowsBOnly!==c.allowsBOnly||d.allowsNone!==c.allowsNone){const y=c.vertexState,g=VertexState.fromLookup(c.vertex,(D,O)=>{if(!y.allowsPair(D,O))return!1;const k=D===d.edgeA||O===d.edgeA,M=D===d.edgeB||O===d.edgeB;if(k&&M)return d.allowsBoth;if(k&&!M)return d.allowsAOnly;if(!k&&M)return d.allowsBOnly;if(!k&&!M)return d.allowsNone;throw new Error("Unreachable")},y.allowsEmpty()&&d.allowsNone);assertEnabled()&&assert$2(g.isSubsetOf(y)),y.equals(g)||a.push(g)}}if(a.length)return new AnnotatedAction(new CompositeAction(a.map(h=>new VertexStateSetAction(h.vertex,h))),{type:"FaceStateToVertexState",face:e,vertices:a.map(h=>h.vertex),beforeStates:a.map(h=>n.find(c=>c.vertex===h.vertex)),afterStates:a})}return null}clone(e){return new FaceToVertexSolver(this.board,e,this.dirtyFaces)}dispose(){this.state.faceStateChangedEmitter.removeListener(this.faceListener)}}const getSimpleRegionGlobalId=()=>dotRandom.nextInt(Number.MAX_SAFE_INTEGER);class SafeEdgeToSimpleRegionSolver{constructor(e,t){ce(this,"dirtyEdges",new Set);ce(this,"edgeListener");this.board=e,this.state=t,e.edges.forEach(n=>{this.dirtyEdges.add(n)}),this.edgeListener=(n,r)=>{this.dirtyEdges.add(n)},this.state.edgeStateChangedEmitter.addListener(this.edgeListener)}get dirty(){return this.dirtyEdges.size>0}nextAction(){if(!this.dirty)return null;const e=this.state.getSimpleRegions(),t=this.state.getWeirdEdges(),n=new Set,r=new Set;for(const D of this.dirtyEdges)this.state.getEdgeState(D)===EdgeState.BLACK?n.add(D):r.add(D);const s=new Set,a=new Set,h=new Set(e),c=new Set,d=new Set,y=new Set(t);for(const D of r)y.has(D)&&(y.delete(D),d.add(D));for(const D of n)y.has(D)&&n.delete(D),[...h].some(O=>O.halfEdges.some(V=>V.edge===D))&&n.delete(D);for(const D of e)if(D.halfEdges.some(O=>r.has(O.edge))){const O=[];let V=[];for(const k of D.halfEdges)r.has(k.edge)?V.length>0&&(O.push(V),V=[]):V.push(k);if(V.length>0&&O.push(V),a.add(D),h.delete(D),O.length){if(D.isSolved&&O.length>1){const M=O[0][0],N=O[O.length-1][O[O.length-1].length-1];M.start===N.end&&O[0].unshift(...O.pop())}const k=_$1.maxBy(O,M=>M.length);for(const M of O){const N=new GeneralSimpleRegion(M===k?D.id:getSimpleRegionGlobalId(),M);s.add(N),h.add(N)}}}const g=D=>{const O=D.start,V=D.end,k=[...h].find(Z=>Z.a===O||Z.b===O)||null,M=[...h].find(Z=>Z.a===V||Z.b===V)||null,N=O.edges.filter(Z=>this.state.getEdgeState(Z)===EdgeState.BLACK).length,F=V.edges.filter(Z=>this.state.getEdgeState(Z)===EdgeState.BLACK).length;if(N>2||F>2)return!1;const G=Z=>{h.add(Z),s.add(Z)},ie=Z=>{h.delete(Z),s.has(Z)?s.delete(Z):a.add(Z)};if(k&&M)if(k===M)if(SafeEdgeToSimpleRegionSolver.isSolvedWithAddedEdge(this.board,this.state,k,D))ie(k),G(new GeneralSimpleRegion(k.id,SafeEdgeToSimpleRegionSolver.combineHalfEdgeArrays(k.halfEdges,[D.forwardHalf]),!0));else return!1;else{const Z=k.halfEdges.length>=M.halfEdges.length?k:M,W=Z===k?M:k,X=new GeneralSimpleRegion(Z.id,SafeEdgeToSimpleRegionSolver.combineHalfEdgeArrays(Z.halfEdges,[D.forwardHalf],W.halfEdges));ie(Z),ie(W),G(X)}else if(k){const Z=new GeneralSimpleRegion(k.id,SafeEdgeToSimpleRegionSolver.combineHalfEdgeArrays(k.halfEdges,[D.forwardHalf]));ie(k),G(Z)}else if(M){const Z=new GeneralSimpleRegion(M.id,SafeEdgeToSimpleRegionSolver.combineHalfEdgeArrays(M.halfEdges,[D.forwardHalf]));ie(M),G(Z)}else{const Z=new GeneralSimpleRegion(getSimpleRegionGlobalId(),[D.forwardHalf]);G(Z)}return!0};for(const D of y)g(D)&&(d.add(D),y.delete(D));for(const D of n)g(D)||(c.add(D),y.add(D));return this.dirtyEdges.clear(),s.size||a.size||c.size||d.size?new AnnotatedAction(new GeneralSimpleRegionAction(this.board,s,a,c,d),{type:"SimpleRegions"}):null}clone(e){return new SafeEdgeToSimpleRegionSolver(this.board,e)}dispose(){this.state.edgeStateChangedEmitter.removeListener(this.edgeListener)}static isSolvedWithAddedEdge(e,t,n,r){if(r.start!==n.a&&r.start!==n.b||r.end!==n.a&&r.end!==n.b)return!1;const s=new Set(n.edges);s.add(r);for(const a of e.faces){const h=t.getFaceValue(a);if(h!==null&&a.edges.filter(d=>s.has(d)).length!==h)return!1}return!0}static combineHalfEdgeArrays(...e){if(e.length===0)return[];let t=[...e[0]];for(let n=1;n<e.length;n++){const r=e[n];if(r.length!==0)if(t[0].start===r[0].start)t=[...r.map(s=>s.reversed).reverse(),...t];else if(t[0].start===r[r.length-1].end)t=[...r,...t];else if(t[t.length-1].end===r[0].start)t=[...t,...r];else if(t[t.length-1].end===r[r.length-1].end)t=[...t,...r.map(s=>s.reversed).reverse()];else throw new Error("Cannot combine half edge arrays")}return t}}class SafeSolvedEdgeSolver{constructor(e,t){ce(this,"hasDirtySimpleRegions",!0);ce(this,"simpleRegionListener");this.board=e,this.state=t,this.simpleRegionListener=()=>{this.hasDirtySimpleRegions=!0},this.state.simpleRegionsChangedEmitter.addListener(this.simpleRegionListener)}get dirty(){return this.hasDirtySimpleRegions}nextAction(){if(!this.dirty)return null;if(simpleRegionIsSolved(this.state)){const e=this.board.edges.filter(t=>this.state.getEdgeState(t)===EdgeState.WHITE);if(e.length)return new AnnotatedAction(new CompositeAction(e.map(t=>new EdgeStateSetAction(t,EdgeState.RED))),{type:"CompletingEdgesAfterSolve",whiteEdges:e})}return this.hasDirtySimpleRegions=!1,null}clone(e){return new SafeSolvedEdgeSolver(this.board,e)}dispose(){this.state.simpleRegionsChangedEmitter.removeListener(this.simpleRegionListener)}}class GeneralFaceColor{constructor(e,t){this.id=e,this.colorState=t}}class GeneralFaceColorAction{constructor(e,t,n,r,s,a){this.board=e,this.addedFaceColors=t,this.removedFaceColors=n,this.faceChangeMap=r,this.oppositeChangeMap=s,this.invalidFaceColor=a,assertEnabled()&&assert$2(n.size<=r.size)}apply(e){e.modifyFaceColors(this.addedFaceColors,this.removedFaceColors,this.faceChangeMap,this.oppositeChangeMap,this.invalidFaceColor)}getUndo(e){throw new Error("getUndo unimplemented in GeneralFaceColorAction")}isEmpty(){return this.addedFaceColors.size===0&&this.removedFaceColors.size===0&&this.faceChangeMap.size===0&&this.oppositeChangeMap.size===0}serializeAction(){throw new Error("serializeAction unimplemented in GeneralFaceColorAction")}static deserializeAction(e,t){throw new Error("deserializeAction unimplemented in GeneralFaceColorAction")}}class GeneralFaceColorDelta extends GeneralFaceColorAction{constructor(t,n,r=new Set,s=new Set,a=new Map,h=new Map,c=!1){super(t,r,s,a,h,c);ce(this,"faceColorsChangedEmitter",new TinyEmitter);this.parentState=n}getFaceColors(){return[...[...this.parentState.getFaceColors()].filter(t=>!this.removedFaceColors.has(t)),...this.addedFaceColors]}getInsideColor(){return this.parentState.getInsideColor()}getOutsideColor(){return this.parentState.getOutsideColor()}getFaceColor(t){return this.faceChangeMap.has(t)?this.faceChangeMap.get(t):this.parentState.getFaceColor(t)}getFacesWithColor(t){let n;this.addedFaceColors.has(t)?n=new Set:n=new Set(this.parentState.getFacesWithColor(t));for(const[r,s]of this.faceChangeMap.entries())s===t?n.add(r):n.has(r)&&n.delete(r);return[...n]}getFaceColorMap(){const t=new Map(this.parentState.getFaceColorMap());for(const[n,r]of this.faceChangeMap.entries())t.set(n,r);return t}getOppositeFaceColor(t){const n=this.oppositeChangeMap.get(t);return n!==void 0?n:this.parentState.getOppositeFaceColor(t)}hasInvalidFaceColors(){return this.invalidFaceColor||this.parentState.hasInvalidFaceColors()}modifyFaceColors(t,n,r,s,a){for(const d of t)this.addedFaceColors.add(d);for(const d of n)this.addedFaceColors.has(d)?this.addedFaceColors.delete(d):this.removedFaceColors.add(d);for(const[d,y]of r.entries())this.faceChangeMap.set(d,y);for(const[d,y]of s.entries())this.oppositeChangeMap.set(d,y);const h=new Set(n);for(const d of this.oppositeChangeMap.keys()){const y=this.oppositeChangeMap.get(d);y&&h.has(y)&&this.oppositeChangeMap.set(d,null)}const c=new Set(s.keys());this.invalidFaceColor=a,this.faceColorsChangedEmitter.emit(t,n,c,[...r.keys()])}clone(){return new GeneralFaceColorDelta(this.board,this.parentState,new Set(this.addedFaceColors),new Set(this.removedFaceColors),new Map(this.faceChangeMap),new Map(this.oppositeChangeMap),this.invalidFaceColor||this.parentState.hasInvalidFaceColors())}createDelta(){return new GeneralFaceColorDelta(this.board,this)}serializeState(t){return serializeFaceColorData(this)}}const getFaceColorGlobalId=()=>dotRandom.nextInt(Number.MAX_SAFE_INTEGER);class GeneralFaceColorData{constructor(e,t,n,r,s,a,h,c){ce(this,"faceColorsChangedEmitter",new TinyEmitter);ce(this,"faceColors");ce(this,"colorMap");ce(this,"colorInverseMap");ce(this,"oppositeColorMap");ce(this,"outsideColor");ce(this,"insideColor");ce(this,"invalidFaceColor");this.board=e,assertEnabled()&&assert$2(!t||h,"Provide all or none of the optional arguments"),this.outsideColor=a||new GeneralFaceColor(getFaceColorGlobalId(),FaceColorState.OUTSIDE),this.insideColor=h||new GeneralFaceColor(getFaceColorGlobalId(),FaceColorState.INSIDE),this.colorMap=new Map(n||[...e.faces].map(d=>[d,new GeneralFaceColor(getFaceColorGlobalId(),FaceColorState.UNDECIDED)])),this.faceColors=new Set(t||[this.outsideColor,this.insideColor,...e.faces.map(d=>this.colorMap.get(d))]),assertEnabled()&&assert$2(this.board.faces.every(d=>this.colorMap.has(d))),assertEnabled()&&assert$2(this.board.faces.every(d=>this.faceColors.has(this.colorMap.get(d)))),this.colorInverseMap=new Map(r?[...r.keys()].map(d=>[d,new Set([...r.get(d)])]):[...this.faceColors].map(d=>[d,new Set([...this.colorMap.keys()].filter(y=>this.colorMap.get(y)===d))])),this.oppositeColorMap=new Map(s||[[this.outsideColor,this.insideColor],[this.insideColor,this.outsideColor]]),this.invalidFaceColor=!!c}getFaceColors(){return[...this.faceColors]}getInsideColor(){return this.insideColor}getOutsideColor(){return this.outsideColor}getFaceColor(e){const t=this.colorMap.get(e);return assertEnabled()&&assert$2(t),t}getFacesWithColor(e){assertEnabled()&&assert$2(this.faceColors.has(e));const t=this.colorInverseMap.get(e);return assertEnabled()&&assert$2(t),[...t]}getFaceColorMap(){return new Map(this.colorMap)}getOppositeFaceColor(e){return this.oppositeColorMap.get(e)??null}hasInvalidFaceColors(){return this.invalidFaceColor}modifyFaceColors(e,t,n,r,s){for(const c of e)this.faceColors.add(c),this.colorInverseMap.set(c,new Set);for(const[c,d]of n.entries()){const y=this.colorMap.get(c);assertEnabled()&&assert$2(y),this.colorMap.set(c,d),this.colorInverseMap.get(y).delete(c),this.colorInverseMap.get(d).add(c)}for(const[c,d]of r.entries())this.oppositeColorMap.set(c,d),this.oppositeColorMap.set(d,c);const a=new Set;for(const c of t)a.add(c),this.faceColors.delete(c),this.colorInverseMap.delete(c),this.oppositeColorMap.delete(c);for(const c of this.faceColors)this.oppositeColorMap.has(c)&&a.has(this.oppositeColorMap.get(c))&&this.oppositeColorMap.delete(c);const h=new Set(r.keys());if(this.invalidFaceColor=s,assertEnabled()&&assert$2(this.board.faces.every(c=>this.colorMap.has(c))),assertEnabled()&&assert$2(this.board.faces.every(c=>this.faceColors.has(this.colorMap.get(c)))),assertEnabled()){const c=new Set(this.getFaceColors());for(const d of c){const y=this.getOppositeFaceColor(d);y&&!c.has(y)&&assert$2(!1,`opposite color ${y} of color ${d} is not in the set of colors`)}}this.faceColorsChangedEmitter.emit(e,t,h,[...n.keys()])}clone(){return new GeneralFaceColorData(this.board,this.faceColors,this.colorMap,this.colorInverseMap,this.oppositeColorMap,this.outsideColor,this.insideColor,this.invalidFaceColor)}createDelta(){return new GeneralFaceColorDelta(this.board,this)}serializeState(e){return serializeFaceColorData(this)}static deserializeState(e,t){const n=t.colors.map(d=>{const y=d.id,g=FaceColorState.enumeration.getValue(d.colorState);return assertEnabled()&&assert$2(g),new GeneralFaceColor(y,g)}),r=new Map,s=new Map,a=new Map;n.forEach((d,y)=>{const g=t.colors[y].faces.map(O=>deserializeFace(e,O));g.forEach(O=>r.set(O,d)),s.set(d,new Set(g));const D=t.colors[y].oppositeFaceColorId;if(D!==null){const O=n.find(V=>V.id===D);assertEnabled()&&assert$2(O),a.set(d,O)}});const h=n.find(d=>d.colorState===FaceColorState.OUTSIDE);assertEnabled()&&assert$2(h);const c=n.find(d=>d.colorState===FaceColorState.INSIDE);return assertEnabled()&&assert$2(c),new GeneralFaceColorData(e,new Set(n),r,s,a,h,c,t.invalidFaceColor)}}class FaceColorInvalidAction{constructor(){}apply(e){e.modifyFaceColors([],[],new Map,new Map,!0)}getUndo(e){throw new Error("getUndo unimplemented in FaceColorInvalidAction")}isEmpty(){return!1}serializeAction(){throw new Error("serializeAction unimplemented in FaceColorInvalidAction")}static deserializeAction(e,t){throw new Error("deserializeAction unimplemented in FaceColorInvalidAction")}}class SafeEdgeToFaceColorSolver{constructor(e,t){ce(this,"hadEdgeAdjusted",!1);ce(this,"dirtyEdges",new Set);ce(this,"edgeListener");this.board=e,this.state=t,e.edges.forEach(n=>this.dirtyEdges.add(n)),this.edgeListener=(n,r,s)=>{this.dirtyEdges.add(n),this.hadEdgeAdjusted=this.hadEdgeAdjusted||s!==EdgeState.WHITE},this.state.edgeStateChangedEmitter.addListener(this.edgeListener)}get dirty(){return this.dirtyEdges.size>0||this.hadEdgeAdjusted}nextAction(){var t;if(!this.dirty)return null;if(this.hadEdgeAdjusted||this.state.hasInvalidFaceColors()){this.hadEdgeAdjusted=!1,this.dirtyEdges.clear();const n=new Map,r=new ProtoFaceColor(FaceColorState.OUTSIDE,new Set),s=new ProtoFaceColor(FaceColorState.INSIDE,new Set);r.opposite=s,s.opposite=r;const a=new Set([r,s,...this.board.faces.map(G=>{const ie=new ProtoFaceColor(FaceColorState.UNDECIDED,new Set([G]));return n.set(G,ie),ie})]);let h=!1;const c=G=>{if(G===null)return r;const ie=n.get(G);return assertEnabled()&&assert$2(ie),ie},d=(G,ie)=>{if(ie===r||ie===s)return d(ie,G);assertEnabled()&&assert$2(G!==ie);for(const Z of ie.faces)G.faces.add(Z),n.set(Z,G);return ie.faces.clear(),a.delete(ie),G},y=(G,ie)=>{if(assertEnabled()&&assert$2(a.has(G)&&a.has(ie)),G===ie)return;const Z=G.opposite,W=ie.opposite;if(Z&&Z===ie){h=!0;return}if(W&&W===G){h=!0;return}const X=d(G,ie),J=Z&&W?d(Z,W):Z||W;X.opposite=J,J&&(J.opposite=X)},g=(G,ie)=>{if(assertEnabled()&&assert$2(a.has(G)&&a.has(ie)),G===ie){h=!0;return}if(G.opposite&&G.opposite===ie)return;const Z=G.opposite,W=ie.opposite;if(Z&&Z===W){h=!0;return}const X=W?d(G,W):G,J=Z?d(ie,Z):ie;X.opposite=J,J.opposite=X};for(const G of this.board.edges){if(h)break;const ie=this.state.getEdgeState(G);if(ie!==EdgeState.WHITE){const Z=c(G.forwardFace),W=c(G.reversedFace);ie===EdgeState.BLACK?g(Z,W):ie===EdgeState.RED&&y(Z,W)}}if(assertEnabled()){const G=new Set(this.board.faces);for(const ie of a)for(const Z of ie.faces)G.delete(Z);assert$2(G.size===0)}if(h)return new AnnotatedAction(new FaceColorInvalidAction,{type:"InvalidFaceColoring"});const D=new Set(this.state.getFaceColors()),O=new Set,V=new Map,k=(G,ie)=>{assertEnabled()&&assert$2(D.has(G)),assertEnabled()&&assert$2(ie.faceColor===null),D.delete(G),ie.faceColor=G};k(this.state.getOutsideColor(),r),k(this.state.getInsideColor(),s);for(const G of a){if(!G.faceColor){const Z=new Set([...G.faces].map(J=>this.state.getFaceColor(J)));let W=null,X=0;for(const J of Z){if(!D.has(J))continue;const oe=this.state.getFacesWithColor(J);oe.some(le=>!G.faces.has(le))||oe.length>X&&(W=J,X=oe.length)}if(W)k(W,G);else{const J=new GeneralFaceColor(getFaceColorGlobalId(),FaceColorState.UNDECIDED);O.add(J),G.faceColor=J}}const ie=G.faceColor;assertEnabled()&&assert$2(ie),G.faces.forEach(Z=>{this.state.getFaceColor(Z)!==ie&&V.set(Z,ie)})}const M=new Set(D),N=new Map;for(const G of a){const ie=G.faceColor,Z=((t=G.opposite)==null?void 0:t.faceColor)??null;let W=O.has(ie);W||(W=this.state.getOppositeFaceColor(ie)!==Z),W&&N.set(ie,Z)}return O.size>0||M.size>0||V.size>0||N.size>0||this.state.hasInvalidFaceColors()?new AnnotatedAction(new GeneralFaceColorAction(this.board,O,M,V,N,!1),{type:"GeneralFaceColoring"}):null}else for(;this.dirtyEdges.size;){const n=this.dirtyEdges.values().next().value;this.dirtyEdges.delete(n);const r=this.state.getEdgeState(n);if(r!==EdgeState.WHITE){const s=n.forwardFace?this.state.getFaceColor(n.forwardFace):this.state.getOutsideColor(),a=n.reversedFace?this.state.getFaceColor(n.reversedFace):this.state.getOutsideColor();if(r===EdgeState.BLACK){if(this.state.getOppositeFaceColor(s)!==a)return new AnnotatedAction(new FaceColorMakeOppositeAction(getFaceColorPointer(this.state,s),getFaceColorPointer(this.state,a)),{type:"FaceColoringBlackEdge",edge:n})}else if(r===EdgeState.RED&&s!==a)return new AnnotatedAction(new FaceColorMakeSameAction(getFaceColorPointer(this.state,s),getFaceColorPointer(this.state,a)),{type:"FaceColoringRedEdge",edge:n})}}return null}clone(e){return new SafeEdgeToFaceColorSolver(this.board,e)}dispose(){this.state.edgeStateChangedEmitter.removeListener(this.edgeListener)}}class ProtoFaceColor{constructor(e,t){ce(this,"opposite",null);ce(this,"faceColor",null);this.colorState=e,this.faces=t}}class SafeEdgeToSectorSolver{constructor(e,t){ce(this,"dirtySectors",new Set);ce(this,"edgeListener");this.board=e,this.state=t,e.halfEdges.forEach(n=>this.dirtySectors.add(n)),this.edgeListener=(n,r,s)=>{this.dirtySectors.add(n.forwardHalf),this.dirtySectors.add(n.forwardHalf.previous),this.dirtySectors.add(n.reversedHalf),this.dirtySectors.add(n.reversedHalf.previous)},this.state.edgeStateChangedEmitter.addListener(this.edgeListener)}get dirty(){return this.dirtySectors.size>0}nextAction(){if(!this.dirty)return null;for(;this.dirtySectors.size;){const e=this.dirtySectors.values().next().value;this.dirtySectors.delete(e);const t=e.edge,n=e.next.edge,r=this.state.getEdgeState(t),s=this.state.getEdgeState(n),a=this.state.getSectorState(e);let h=a;const c=(r===EdgeState.WHITE?1:0)+(s===EdgeState.WHITE?1:0),d=(r===EdgeState.BLACK?1:0)+(s===EdgeState.BLACK?1:0),y=(r===EdgeState.RED?1:0)+(s===EdgeState.RED?1:0);if(c===0?h=SectorState.getOnly(d):c===1&&(d&&h.zero&&(h=h.withDisallowZero()),y&&h.two&&(h=h.withDisallowTwo())),h!==a)return new AnnotatedAction(new SectorStateSetAction(e,h),{type:c===1?"SingleEdgeToSector":"DoubleEdgeToSector",sector:e,beforeState:a,afterState:h})}return null}clone(e){return new SafeEdgeToSectorSolver(this.board,e)}dispose(){this.state.edgeStateChangedEmitter.removeListener(this.edgeListener)}}class SafeEdgeSectorColorToVertexSolver{constructor(e,t){ce(this,"dirtyVertices",new Set);ce(this,"edgeListener");ce(this,"sectorListener");ce(this,"faceColorListener");this.board=e,this.state=t,e.vertices.forEach(n=>this.dirtyVertices.add(n)),this.edgeListener=(n,r,s)=>{this.dirtyVertices.add(n.start),this.dirtyVertices.add(n.end)},this.state.edgeStateChangedEmitter.addListener(this.edgeListener),this.sectorListener=(n,r,s)=>{this.dirtyVertices.add(n.end)},this.state.sectorStateChangedEmitter.addListener(this.sectorListener),this.faceColorListener=(n,r,s,a)=>{for(const h of a)for(const c of h.vertices)this.dirtyVertices.add(c);for(const h of s){const c=this.state.getFacesWithColor(h);for(const d of c)for(const y of d.vertices)this.dirtyVertices.add(y)}},this.state.faceColorsChangedEmitter.addListener(this.faceColorListener)}get dirty(){return this.dirtyVertices.size>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyVertices.size;){const e=this.dirtyVertices.values().next().value;this.dirtyVertices.delete(e);const t=this.state.getVertexState(e),n=VertexState.fromEdgeColorSectorData(e,this.state).and(t);if(!t.equals(n))return new AnnotatedAction(new VertexStateSetAction(e,n),{type:"VertexState",vertex:e,beforeState:t,afterState:n})}return null}clone(e){return new SafeEdgeSectorColorToVertexSolver(this.board,e)}dispose(){this.state.edgeStateChangedEmitter.removeListener(this.edgeListener),this.state.sectorStateChangedEmitter.removeListener(this.sectorListener),this.state.faceColorsChangedEmitter.removeListener(this.faceColorListener)}}const safeSolverFactory=(o,e,t)=>new CompositeSolver([new SafeEdgeToSimpleRegionSolver(o,e),new SafeSolvedEdgeSolver(o,e),new SafeEdgeToFaceColorSolver(o,e),new SafeEdgeToSectorSolver(o,e),new SafeEdgeSectorColorToVertexSolver(o,e)]),autoSolveEnabledProperty=new LocalStorageBooleanProperty("autoSolveEnabledProperty",!0),autoSolveToBlackProperty=new LocalStorageBooleanProperty("autoSolveToBlackProperty",!1),autoSolveSimpleLoopsProperty=new LocalStorageBooleanProperty("autoSolveSimpleLoopsProperty",!1),autoSolveSimpleVertexJointToRedProperty=new LocalStorageBooleanProperty("autoSolveSimpleVertexJointToRedProperty",!0),autoSolveSimpleVertexForcedLineToBlackProperty=new LocalStorageBooleanProperty("autoSolveSimpleVertexForcedLineToBlackProperty",!0),autoSolveSimpleVertexAlmostEmptyToRedProperty=new LocalStorageBooleanProperty("autoSolveSimpleVertexAlmostEmptyToRedProperty",!0),autoSolveSimpleFaceToRedProperty=new LocalStorageBooleanProperty("autoSolveSimpleFaceToRedProperty",!0),autoSolveSimpleFaceToBlackProperty=new LocalStorageBooleanProperty("autoSolveSimpleFaceToBlackProperty",!0),autoSolveSimpleLoopToRedProperty=new LocalStorageBooleanProperty("autoSolveSimpleLoopToRedProperty",!0),autoSolveSimpleLoopToBlackProperty=new LocalStorageBooleanProperty("autoSolveSimpleLoopToBlackProperty",!1),autoSolveDoubleMinusOneFacesProperty=new LocalStorageBooleanProperty("autoSolveDoubleMinusOneFacesProperty",!1),autoSolveStaticFaceSectorProperty=new LocalStorageBooleanProperty("autoSolveStaticFaceSectorProperty",!0),autoSolveSimpleSectorProperty=new LocalStorageBooleanProperty("autoSolveSimpleSectorProperty",!1),autoSolveVertexToRedEdgeProperty=new LocalStorageBooleanProperty("autoSolveVertexToRedEdgeProperty",!1),autoSolveVertexToBlackEdgeProperty=new LocalStorageBooleanProperty("autoSolveVertexToBlackEdgeProperty",!1),autoSolveVertexToSectorsProperty=new LocalStorageBooleanProperty("autoSolveVertexToSectorsProperty",!1),autoSolveVertexToFaceColorProperty=new LocalStorageBooleanProperty("autoSolveVertexToFaceColorProperty",!1),autoSolveFaceColorToRedProperty=new LocalStorageBooleanProperty("autoSolveFaceColorToRedProperty",!1),autoSolveFaceColorToBlackProperty=new LocalStorageBooleanProperty("autoSolveFaceColorToBlackProperty",!1),autoSolveFaceColorParityToRedProperty=new LocalStorageBooleanProperty("autoSolveFaceColorParityToRedProperty",!1),autoSolveFaceColorParityToBlackProperty=new LocalStorageBooleanProperty("autoSolveFaceColorParityToBlackProperty",!1),autoSolveFaceColorParityColorsProperty=new LocalStorageBooleanProperty("autoSolveFaceColorParityColorsProperty",!1),autoSolveFaceColorParityPartialReductionProperty=new LocalStorageBooleanProperty("autoSolveFaceColorParityPartialReductionProperty",!1),autoSolveVertexColorToFaceProperty=new LocalStorageBooleanProperty("autoSolveVertexColorToFaceProperty",!1),autoSolveFaceToRedProperty=new LocalStorageBooleanProperty("autoSolveFaceToRedProperty",!1),autoSolveFaceToBlackProperty=new LocalStorageBooleanProperty("autoSolveFaceToBlackProperty",!1),autoSolveFaceToSectorsProperty=new LocalStorageBooleanProperty("autoSolveFaceToSectorsProperty",!1),autoSolveFaceToFaceColorsProperty=new LocalStorageBooleanProperty("autoSolveFaceToFaceColorsProperty",!1),autoSolveFaceToVertexProperty=new LocalStorageBooleanProperty("autoSolveFaceToVertexProperty",!1),finalStateSolverFactory=(o,e,t)=>new CompositeSolver([safeSolverFactory(o,e),new VertexColorToFaceSolver(o,e)]),finalStateSolve=(o,e)=>{iterateSolverFactory(finalStateSolverFactory,o,e,!0)},autoSolverFactoryProperty=new DerivedProperty([autoSolveSimpleVertexJointToRedProperty,autoSolveSimpleVertexForcedLineToBlackProperty,autoSolveSimpleVertexAlmostEmptyToRedProperty,autoSolveSimpleFaceToRedProperty,autoSolveSimpleFaceToBlackProperty,autoSolveSimpleLoopToRedProperty,autoSolveSimpleLoopToBlackProperty,autoSolveDoubleMinusOneFacesProperty,autoSolveStaticFaceSectorProperty,autoSolveSimpleSectorProperty,autoSolveVertexToRedEdgeProperty,autoSolveVertexToBlackEdgeProperty,autoSolveVertexToSectorsProperty,autoSolveVertexToFaceColorProperty,autoSolveFaceColorToRedProperty,autoSolveFaceColorToBlackProperty,autoSolveFaceColorParityToRedProperty,autoSolveFaceColorParityToBlackProperty,autoSolveFaceColorParityColorsProperty,autoSolveFaceColorParityPartialReductionProperty,autoSolveVertexColorToFaceProperty,autoSolveFaceToRedProperty,autoSolveFaceToBlackProperty,autoSolveFaceToSectorsProperty,autoSolveFaceToFaceColorsProperty,autoSolveFaceToVertexProperty],(o,e,t,n,r,s,a,h,c,d,y,g,D,O,V,k,M,N,F,G,ie,Z,W,X,J,oe)=>(le,pe,ve)=>new CompositeSolver([...o||e||t?[new SimpleVertexSolver(le,pe,{solveJointToRed:o,solveForcedLineToBlack:e,solveAlmostEmptyToRed:t},ve?void 0:[])]:[],...n||r?[new SimpleFaceSolver(le,pe,{solveToRed:n,solveToBlack:r},ve?void 0:[])]:[],...h?[new StaticDoubleMinusOneFacesSolver(le,pe,ve?void 0:[])]:[],safeSolverFactory(le,pe),...c?[new StaticSectorSolver(le,pe,ve?void 0:[])]:[],...d?[new SimpleSectorSolver(le,pe,ve?void 0:[])]:[],...s||a?[new SimpleLoopSolver(le,pe,{solveToRed:s,solveToBlack:a,resolveAllRegions:!1},ve?void 0:[])]:[],...y||g?[new VertexToEdgeSolver(le,pe,{solveToRed:y,solveToBlack:g},ve?void 0:[])]:[],...D?[new VertexToSectorSolver(le,pe,ve?void 0:[])]:[],...V||k?[new SimpleFaceColorSolver(le,pe,{solveToRed:V,solveToBlack:k},ve?void 0:[])]:[],...M||N||F?[new FaceColorParitySolver(le,pe,{solveToRed:M,solveToBlack:N,solveColors:F,allowPartialReduction:G},ve?void 0:[])]:[],...O?[new VertexToFaceColorSolver(le,pe,ve?void 0:[])]:[],...ie?[new VertexColorToFaceSolver(le,pe,ve?void 0:[])]:[],...Z||W?[new FaceToEdgeSolver(le,pe,{solveToRed:Z,solveToBlack:W},ve?void 0:[])]:[],...X?[new FaceToSectorSolver(le,pe,ve?void 0:[])]:[],...J?[new FaceToFaceColorSolver(le,pe,ve?void 0:[])]:[],...oe?[new FaceToVertexSolver(le,pe,ve?void 0:[])]:[]])),serializeFaceValueData=(o,e)=>({type:"FaceValueData",faces:o.faces.filter(t=>e.getFaceValue(t)!==null).map(t=>({face:serializeFace(t),state:e.getFaceValue(t)}))}),serializeEdgeStateData=(o,e)=>({type:"EdgeData",edges:o.edges.filter(t=>e.getEdgeState(t)!==EdgeState.WHITE).map(t=>({edge:serializeEdge(t),state:e.getEdgeState(t).name}))}),serializeSectorStateData=(o,e)=>({type:"SectorStateData",sectors:o.halfEdges.filter(t=>e.getSectorState(t)!==SectorState.ANY).map(t=>({sector:serializeHalfEdge(t),state:e.getSectorState(t).serialize()}))}),serializeVertexStateData=(o,e)=>({type:"VertexStateData",vertices:o.vertices.filter(t=>!e.getVertexState(t).isAny()).map(t=>({vertex:serializeVertex(t),state:e.getVertexState(t).serialize()}))}),serializeFaceStateData=(o,e)=>({type:"FaceStateData",faces:o.faces.map(t=>({face:serializeFace(t),state:e.getFaceState(t).serialize()}))}),serializeCompleteData=(o,e)=>({type:"CompleteData",faceValueData:serializeFaceValueData(o,e),edgeStateData:serializeEdgeStateData(o,e),simpleRegionData:serializeSimpleRegionData(e),faceColorData:serializeFaceColorData(e),sectorStateData:serializeSectorStateData(o,e),vertexStateData:serializeVertexStateData(o,e),faceStateData:serializeFaceStateData(o,e)});class GeneralFaceValueDelta extends GeneralFaceValueAction{constructor(t,n,r=new Map){super(t,r);ce(this,"faceValueChangedEmitter",new TinyEmitter);this.parentState=n}getFaceValue(t){return this.faceValueMap.has(t)?this.faceValueMap.get(t):this.parentState.getFaceValue(t)}setFaceValue(t,n){this.getFaceValue(t)!==n&&(this.faceValueMap.set(t,n),this.faceValueChangedEmitter.emit(t,n))}clone(){return new GeneralFaceValueDelta(this.board,this.parentState,new Map(this.faceValueMap))}createDelta(){return new GeneralFaceValueDelta(this.board,this,new Map)}serializeState(t){return serializeFaceValueData(t,this)}}class GeneralFaceValueData{constructor(e,t){ce(this,"faceValueChangedEmitter",new TinyEmitter);ce(this,"faceValueMap",new Map);this.board=e,e.faces.forEach(n=>{this.faceValueMap.set(n,t(n))})}getFaceValue(e){return assertEnabled()&&assert$2(this.faceValueMap.has(e)),this.faceValueMap.get(e)}setFaceValue(e,t){assertEnabled()&&assert$2(this.faceValueMap.has(e)),this.faceValueMap.get(e)!==t&&(this.faceValueMap.set(e,t),this.faceValueChangedEmitter.emit(e,t))}clone(){return new GeneralFaceValueData(this.board,e=>this.getFaceValue(e))}createDelta(){return new GeneralFaceValueDelta(this.board,this)}serializeState(e){return serializeFaceValueData(e,this)}static deserializeState(e,t){const n=new Map(t.faces.map(r=>[deserializeFace(e,r.face),r.state]));return new GeneralFaceValueData(e,r=>n.get(r)??null)}}class GeneralEdgeStateDelta extends GeneralEdgeStateAction{constructor(t,n,r=new Map){super(t,r);ce(this,"edgeStateChangedEmitter",new TinyEmitter);this.parentState=n}getEdgeState(t){return this.edgeStateMap.has(t)?this.edgeStateMap.get(t):this.parentState.getEdgeState(t)}setEdgeState(t,n){const r=this.getEdgeState(t);r!==n&&(this.edgeStateMap.set(t,n),this.edgeStateChangedEmitter.emit(t,n,r))}clone(){return new GeneralEdgeStateDelta(this.board,this.parentState,new Map(this.edgeStateMap))}createDelta(){return new GeneralEdgeStateDelta(this.board,this,new Map)}serializeState(t){return serializeEdgeStateData(t,this)}}class GeneralEdgeStateData{constructor(e,t){ce(this,"edgeStateChangedEmitter",new TinyEmitter);ce(this,"edgeStateMap",new Map);this.board=e,e.edges.forEach(n=>{this.edgeStateMap.set(n,t(n))})}getEdgeState(e){return assertEnabled()&&assert$2(this.edgeStateMap.has(e)),this.edgeStateMap.get(e)}setEdgeState(e,t){assertEnabled()&&assert$2(this.edgeStateMap.has(e));const n=this.edgeStateMap.get(e);n!==t&&(this.edgeStateMap.set(e,t),this.edgeStateChangedEmitter.emit(e,t,n))}clone(){return new GeneralEdgeStateData(this.board,e=>this.getEdgeState(e))}createDelta(){return new GeneralEdgeStateDelta(this.board,this)}serializeState(e){return serializeEdgeStateData(e,this)}static deserializeState(e,t){const n=new Map(t.edges.map(r=>[deserializeEdge(e,r.edge),EdgeState.enumeration.getValue(r.state)]));return new GeneralEdgeStateData(e,r=>n.get(r)??EdgeState.WHITE)}}class CompleteDelta extends CompleteAction{constructor(t,n,r,s,a,h,c){super(t,n,r,s,a,h,c);ce(this,"anyStateChangedEmitter",new TinyEmitter);this.faceValueDelta=t,this.edgeStateDelta=n,this.simpleRegionDelta=r,this.faceColorDelta=s,this.sectorStateDelta=a,this.vertexStateDelta=h,this.faceStateDelta=c;const d=()=>this.anyStateChangedEmitter.emit();t.faceValueChangedEmitter.addListener(d),n.edgeStateChangedEmitter.addListener(d),r.simpleRegionsChangedEmitter.addListener(d),s.faceColorsChangedEmitter.addListener(d),a.sectorStateChangedEmitter.addListener(d),h.vertexStateChangedEmitter.addListener(d),c.faceStateChangedEmitter.addListener(d)}getFaceValue(t){return this.faceValueDelta.getFaceValue(t)}setFaceValue(t,n){this.faceValueDelta.setFaceValue(t,n)}get faceValueChangedEmitter(){return this.faceValueDelta.faceValueChangedEmitter}getEdgeState(t){return this.edgeStateDelta.getEdgeState(t)}setEdgeState(t,n){this.edgeStateDelta.setEdgeState(t,n)}get edgeStateChangedEmitter(){return this.edgeStateDelta.edgeStateChangedEmitter}getSimpleRegions(){return this.simpleRegionDelta.getSimpleRegions()}getSimpleRegionWithVertex(t){return this.simpleRegionDelta.getSimpleRegionWithVertex(t)}getSimpleRegionWithEdge(t){return this.simpleRegionDelta.getSimpleRegionWithEdge(t)}getSimpleRegionWithId(t){return this.simpleRegionDelta.getSimpleRegionWithId(t)}getWeirdEdges(){return this.simpleRegionDelta.getWeirdEdges()}modifyRegions(t,n,r,s){this.simpleRegionDelta.modifyRegions(t,n,r,s)}get simpleRegionsChangedEmitter(){return this.simpleRegionDelta.simpleRegionsChangedEmitter}getFaceColors(){return this.faceColorDelta.getFaceColors()}getInsideColor(){return this.faceColorDelta.getInsideColor()}getOutsideColor(){return this.faceColorDelta.getOutsideColor()}getFaceColor(t){return this.faceColorDelta.getFaceColor(t)}getFacesWithColor(t){return this.faceColorDelta.getFacesWithColor(t)}getFaceColorMap(){return this.faceColorDelta.getFaceColorMap()}getOppositeFaceColor(t){return this.faceColorDelta.getOppositeFaceColor(t)}hasInvalidFaceColors(){return this.faceColorDelta.hasInvalidFaceColors()}modifyFaceColors(t,n,r,s,a){this.faceColorDelta.modifyFaceColors(t,n,r,s,a)}get faceColorsChangedEmitter(){return this.faceColorDelta.faceColorsChangedEmitter}getSectorState(t){return this.sectorStateDelta.getSectorState(t)}setSectorState(t,n){this.sectorStateDelta.setSectorState(t,n)}get sectorStateChangedEmitter(){return this.sectorStateDelta.sectorStateChangedEmitter}getVertexState(t){return this.vertexStateDelta.getVertexState(t)}setVertexState(t,n){this.vertexStateDelta.setVertexState(t,n)}get vertexStateChangedEmitter(){return this.vertexStateDelta.vertexStateChangedEmitter}getFaceState(t){return this.faceStateDelta.getFaceState(t)}setFaceState(t,n){this.faceStateDelta.setFaceState(t,n)}get faceStateChangedEmitter(){return this.faceStateDelta.faceStateChangedEmitter}clone(){return new CompleteDelta(this.faceValueDelta.clone(),this.edgeStateDelta.clone(),this.simpleRegionDelta.clone(),this.faceColorDelta.clone(),this.sectorStateDelta.clone(),this.vertexStateDelta.clone(),this.faceStateDelta.clone())}createDelta(){return new CompleteDelta(this.faceValueDelta.createDelta(),this.edgeStateDelta.createDelta(),this.simpleRegionDelta.createDelta(),this.faceColorDelta.createDelta(),this.sectorStateDelta.createDelta(),this.vertexStateDelta.createDelta(),this.faceStateDelta.createDelta())}serializeState(t){return serializeCompleteData(t,this)}}class GeneralSimpleRegionDelta extends GeneralSimpleRegionAction{constructor(t,n,r=new Set,s=new Set,a=new Set,h=new Set){super(t,r,s,a,h);ce(this,"simpleRegionsChangedEmitter",new TinyEmitter);this.parentState=n}getSimpleRegions(){return[...this.parentState.getSimpleRegions().filter(t=>!this.removedRegions.has(t)),...this.addedRegions]}getSimpleRegionWithVertex(t){for(const n of this.getSimpleRegions())if(n.a===t||n.b===t)return n;return null}getSimpleRegionWithEdge(t){for(const n of this.getSimpleRegions())if(n.edges.includes(t))return n;return null}getSimpleRegionWithId(t){for(const n of this.getSimpleRegions())if(n.id===t)return n;return null}getWeirdEdges(){return[...this.parentState.getWeirdEdges().filter(t=>!this.removedWeirdEdges.has(t)),...this.addedWeirdEdges]}modifyRegions(t,n,r,s){for(const a of n)this.addedRegions.has(a)?this.addedRegions.delete(a):this.removedRegions.add(a);for(const a of t)this.addedRegions.add(a);for(const a of s)this.addedWeirdEdges.has(a)?this.addedWeirdEdges.delete(a):this.removedWeirdEdges.add(a);for(const a of r)this.addedWeirdEdges.add(a);this.simpleRegionsChangedEmitter.emit(t,n,r,s)}clone(){return new GeneralSimpleRegionDelta(this.board,this.parentState,new Set(this.addedRegions),new Set(this.removedRegions),new Set(this.addedWeirdEdges),new Set(this.removedWeirdEdges))}createDelta(){return new GeneralSimpleRegionDelta(this.board,this)}serializeState(t){return serializeSimpleRegionData(this)}}class GeneralSimpleRegionData{constructor(e,t,n){ce(this,"simpleRegionsChangedEmitter",new TinyEmitter);ce(this,"simpleRegions");ce(this,"weirdEdges");this.board=e,this.simpleRegions=new Set(t),this.weirdEdges=new Set(n)}getSimpleRegions(){return[...this.simpleRegions]}getSimpleRegionWithVertex(e){for(const t of this.simpleRegions)if(t.a===e||t.b===e)return t;return null}getSimpleRegionWithEdge(e){for(const t of this.simpleRegions)if(t.edges.includes(e))return t;return null}getSimpleRegionWithId(e){for(const t of this.simpleRegions)if(t.id===e)return t;return null}getWeirdEdges(){return[...this.weirdEdges]}modifyRegions(e,t,n,r){for(const s of t)this.simpleRegions.delete(s);for(const s of e)this.simpleRegions.add(s);for(const s of r)this.weirdEdges.delete(s);for(const s of n)this.weirdEdges.add(s);this.simpleRegionsChangedEmitter.emit(e,t,n,r)}clone(){return new GeneralSimpleRegionData(this.board,this.simpleRegions,this.weirdEdges)}createDelta(){return new GeneralSimpleRegionDelta(this.board,this)}serializeState(e){return serializeSimpleRegionData(this)}static deserializeState(e,t){return new GeneralSimpleRegionData(e,t.simpleRegions.map(n=>GeneralSimpleRegion.deserializeSimpleRegion(e,n)),t.weirdEdges.map(n=>deserializeEdge(e,n)))}}class GeneralSectorStateAction{constructor(e,t=new Map){this.board=e,this.sectorStateMap=t}apply(e){for(const[t,n]of this.sectorStateMap)e.setSectorState(t,n)}getUndo(e){const t=new Map;for(const n of this.sectorStateMap.keys())t.set(n,e.getSectorState(n));return new GeneralSectorStateAction(this.board,t)}isEmpty(){return this.sectorStateMap.size===0}serializeAction(){return{type:"GeneralSectorAction",sectors:Array.from(this.sectorStateMap.entries()).map(([e,t])=>({sector:serializeHalfEdge(e),state:t.serialize()}))}}static deserializeAction(e,t){return new GeneralSectorStateAction(e,new Map(t.sectors.map(n=>[deserializeHalfEdge(e,n.sector),SectorState.deserialize(n.state)])))}}class GeneralSectorStateDelta extends GeneralSectorStateAction{constructor(t,n,r=new Map){super(t,r);ce(this,"sectorStateChangedEmitter",new TinyEmitter);this.parentState=n}getSectorState(t){return this.sectorStateMap.has(t)?this.sectorStateMap.get(t):this.parentState.getSectorState(t)}setSectorState(t,n){const r=this.getSectorState(t);r!==n&&(this.sectorStateMap.set(t,n),this.sectorStateChangedEmitter.emit(t,n,r))}clone(){return new GeneralSectorStateDelta(this.board,this.parentState,new Map(this.sectorStateMap))}createDelta(){return new GeneralSectorStateDelta(this.board,this,new Map)}serializeState(t){return serializeSectorStateData(t,this)}}class GeneralSectorStateData{constructor(e,t=()=>SectorState.ANY){ce(this,"sectorStateChangedEmitter",new TinyEmitter);ce(this,"sectorStateMap",new Map);this.board=e,e.halfEdges.forEach(n=>{this.sectorStateMap.set(n,t(n))})}getSectorState(e){return assertEnabled()&&assert$2(this.sectorStateMap.has(e)),this.sectorStateMap.get(e)}setSectorState(e,t){assertEnabled()&&assert$2(this.sectorStateMap.has(e));const n=this.sectorStateMap.get(e);n!==t&&(this.sectorStateMap.set(e,t),this.sectorStateChangedEmitter.emit(e,t,n))}clone(){return new GeneralSectorStateData(this.board,e=>this.getSectorState(e))}createDelta(){return new GeneralSectorStateDelta(this.board,this)}serializeState(e){return serializeSectorStateData(e,this)}static deserializeState(e,t){const n=new Map(t.sectors.map(r=>[deserializeHalfEdge(e,r.sector),SectorState.deserialize(r.state)]));return new GeneralSectorStateData(e,r=>n.get(r)??SectorState.ANY)}}class GeneralVertexStateAction{constructor(e,t=new Map){this.board=e,this.vertexStateMap=t}apply(e){for(const[t,n]of this.vertexStateMap)e.setVertexState(t,n)}getUndo(e){const t=new Map;for(const n of this.vertexStateMap.keys())t.set(n,e.getVertexState(n));return new GeneralVertexStateAction(this.board,t)}isEmpty(){return this.vertexStateMap.size===0}serializeAction(){return{type:"GeneralVertexAction",vertices:Array.from(this.vertexStateMap.entries()).map(([e,t])=>({vertex:serializeVertex(e),state:t.serialize()}))}}static deserializeAction(e,t){return new GeneralVertexStateAction(e,new Map(t.vertices.map(n=>[deserializeVertex(e,n.vertex),VertexState.deserialize(deserializeVertex(e,n.vertex),n.state)])))}}class GeneralVertexStateDelta extends GeneralVertexStateAction{constructor(t,n,r=new Map){super(t,r);ce(this,"vertexStateChangedEmitter",new TinyEmitter);this.parentState=n}getVertexState(t){return this.vertexStateMap.has(t)?this.vertexStateMap.get(t):this.parentState.getVertexState(t)}setVertexState(t,n){const r=this.getVertexState(t);r.equals(n)||(this.vertexStateMap.set(t,n),this.vertexStateChangedEmitter.emit(t,n,r))}clone(){return new GeneralVertexStateDelta(this.board,this.parentState,new Map(this.vertexStateMap))}createDelta(){return new GeneralVertexStateDelta(this.board,this,new Map)}serializeState(t){return serializeVertexStateData(t,this)}}class GeneralVertexStateData{constructor(e,t=VertexState.any){ce(this,"vertexStateChangedEmitter",new TinyEmitter);ce(this,"vertexStateMap",new Map);this.board=e,e.vertices.forEach(n=>{this.vertexStateMap.set(n,t(n))})}getVertexState(e){return assertEnabled()&&assert$2(this.vertexStateMap.has(e)),this.vertexStateMap.get(e)}setVertexState(e,t){assertEnabled()&&assert$2(this.vertexStateMap.has(e));const n=this.vertexStateMap.get(e);n.equals(t)||(this.vertexStateMap.set(e,t),this.vertexStateChangedEmitter.emit(e,t,n))}clone(){return new GeneralVertexStateData(this.board,e=>this.getVertexState(e))}createDelta(){return new GeneralVertexStateDelta(this.board,this)}serializeState(e){return serializeVertexStateData(e,this)}static deserializeState(e,t){const n=new Map(t.vertices.map(r=>{const s=deserializeVertex(e,r.vertex);return[s,VertexState.deserialize(s,r.state)]}));return new GeneralVertexStateData(e,r=>n.get(r)??VertexState.any(r))}}class GeneralFaceStateAction{constructor(e,t=new Map){this.board=e,this.faceStateMap=t}apply(e){for(const[t,n]of this.faceStateMap)e.setFaceState(t,n)}getUndo(e){const t=new Map;for(const n of this.faceStateMap.keys())t.set(n,e.getFaceState(n));return new GeneralFaceStateAction(this.board,t)}isEmpty(){return this.faceStateMap.size===0}serializeAction(){return{type:"GeneralFaceAction",faces:Array.from(this.faceStateMap.entries()).map(([e,t])=>({face:serializeFace(e),state:t.serialize()}))}}static deserializeAction(e,t){return new GeneralFaceStateAction(e,new Map(t.faces.map(n=>[deserializeFace(e,n.face),FaceState.deserialize(deserializeFace(e,n.face),n.state)])))}}class GeneralFaceStateDelta extends GeneralFaceStateAction{constructor(t,n,r=new Map){super(t,r);ce(this,"faceStateChangedEmitter",new TinyEmitter);this.parentState=n}getFaceState(t){return this.faceStateMap.has(t)?this.faceStateMap.get(t):this.parentState.getFaceState(t)}setFaceState(t,n){const r=this.getFaceState(t);r.equals(n)||(this.faceStateMap.set(t,n),this.faceStateChangedEmitter.emit(t,n,r))}clone(){return new GeneralFaceStateDelta(this.board,this.parentState,new Map(this.faceStateMap))}createDelta(){return new GeneralFaceStateDelta(this.board,this,new Map)}serializeState(t){return serializeFaceStateData(t,this)}}class GeneralFaceStateData{constructor(e,t){ce(this,"faceStateChangedEmitter",new TinyEmitter);ce(this,"faceStateMap",new Map);this.board=e,e.faces.forEach(n=>{this.faceStateMap.set(n,t(n))})}getFaceState(e){return assertEnabled()&&assert$2(this.faceStateMap.has(e)),this.faceStateMap.get(e)}setFaceState(e,t){assertEnabled()&&assert$2(this.faceStateMap.has(e));const n=this.faceStateMap.get(e);n.equals(t)||(this.faceStateMap.set(e,t),this.faceStateChangedEmitter.emit(e,t,n))}clone(){return new GeneralFaceStateData(this.board,e=>this.getFaceState(e))}createDelta(){return new GeneralFaceStateDelta(this.board,this)}serializeState(e){return serializeFaceStateData(e,this)}static deserializeState(e,t){const n=new Map(t.faces.map(r=>{const s=deserializeFace(e,r.face);return[s,FaceState.deserialize(s,r.state)]}));return new GeneralFaceStateData(e,r=>{const s=n.get(r);return assertEnabled()&&assert$2(s),s})}}class CompleteData{constructor(e,t,n,r,s,a,h){ce(this,"anyStateChangedEmitter",new TinyEmitter);this.faceValueData=e,this.edgeStateData=t,this.simpleRegionData=n,this.faceColorData=r,this.sectorStateData=s,this.vertexStateData=a,this.faceStateData=h;const c=()=>this.anyStateChangedEmitter.emit();e.faceValueChangedEmitter.addListener(c),t.edgeStateChangedEmitter.addListener(c),n.simpleRegionsChangedEmitter.addListener(c),r.faceColorsChangedEmitter.addListener(c),s.sectorStateChangedEmitter.addListener(c),a.vertexStateChangedEmitter.addListener(c),h.faceStateChangedEmitter.addListener(c)}static fromFacesEdges(e,t,n){const r=new GeneralFaceValueData(e,t);return new CompleteData(r,new GeneralEdgeStateData(e,n),new GeneralSimpleRegionData(e),new GeneralFaceColorData(e),new GeneralSectorStateData(e),new GeneralVertexStateData(e),new GeneralFaceStateData(e,s=>FaceState.any(s,r.getFaceValue(s))))}static fromFaces(e,t){return CompleteData.fromFacesEdges(e,t,()=>EdgeState.WHITE)}static fromFaceValueData(e,t){return CompleteData.fromFaces(e,n=>t.getFaceValue(n))}static empty(e){return CompleteData.fromFaces(e,()=>null)}static faceMapLookup(e){const t=new Map(Array.from(e.entries()).map(([n,r])=>[`${n.x},${n.y}`,r]));return n=>{const r=t.get(`${n.logicalCoordinates.x},${n.logicalCoordinates.y}`);return r!==void 0?r:null}}getFaceValue(e){return this.faceValueData.getFaceValue(e)}setFaceValue(e,t){this.faceValueData.setFaceValue(e,t)}get faceValueChangedEmitter(){return this.faceValueData.faceValueChangedEmitter}getEdgeState(e){return this.edgeStateData.getEdgeState(e)}setEdgeState(e,t){this.edgeStateData.setEdgeState(e,t)}get edgeStateChangedEmitter(){return this.edgeStateData.edgeStateChangedEmitter}getSimpleRegions(){return this.simpleRegionData.getSimpleRegions()}getSimpleRegionWithVertex(e){return this.simpleRegionData.getSimpleRegionWithVertex(e)}getSimpleRegionWithEdge(e){return this.simpleRegionData.getSimpleRegionWithEdge(e)}getSimpleRegionWithId(e){return this.simpleRegionData.getSimpleRegionWithId(e)}getWeirdEdges(){return this.simpleRegionData.getWeirdEdges()}modifyRegions(e,t,n,r){this.simpleRegionData.modifyRegions(e,t,n,r)}get simpleRegionsChangedEmitter(){return this.simpleRegionData.simpleRegionsChangedEmitter}getFaceColors(){return this.faceColorData.getFaceColors()}getInsideColor(){return this.faceColorData.getInsideColor()}getOutsideColor(){return this.faceColorData.getOutsideColor()}getFaceColor(e){return this.faceColorData.getFaceColor(e)}getFacesWithColor(e){return this.faceColorData.getFacesWithColor(e)}getFaceColorMap(){return this.faceColorData.getFaceColorMap()}getOppositeFaceColor(e){return this.faceColorData.getOppositeFaceColor(e)}hasInvalidFaceColors(){return this.faceColorData.hasInvalidFaceColors()}modifyFaceColors(e,t,n,r,s){this.faceColorData.modifyFaceColors(e,t,n,r,s)}get faceColorsChangedEmitter(){return this.faceColorData.faceColorsChangedEmitter}getSectorState(e){return this.sectorStateData.getSectorState(e)}setSectorState(e,t){this.sectorStateData.setSectorState(e,t)}get sectorStateChangedEmitter(){return this.sectorStateData.sectorStateChangedEmitter}getVertexState(e){return this.vertexStateData.getVertexState(e)}setVertexState(e,t){this.vertexStateData.setVertexState(e,t)}get vertexStateChangedEmitter(){return this.vertexStateData.vertexStateChangedEmitter}getFaceState(e){return this.faceStateData.getFaceState(e)}setFaceState(e,t){this.faceStateData.setFaceState(e,t)}get faceStateChangedEmitter(){return this.faceStateData.faceStateChangedEmitter}clone(){return new CompleteData(this.faceValueData.clone(),this.edgeStateData.clone(),this.simpleRegionData.clone(),this.faceColorData.clone(),this.sectorStateData.clone(),this.vertexStateData.clone(),this.faceStateData.clone())}createDelta(){return new CompleteDelta(this.faceValueData.createDelta(),this.edgeStateData.createDelta(),this.simpleRegionData.createDelta(),this.faceColorData.createDelta(),this.sectorStateData.createDelta(),this.vertexStateData.createDelta(),this.faceStateData.createDelta())}serializeState(e){return serializeCompleteData(e,this)}static deserializeState(e,t){const n=GeneralFaceValueData.deserializeState(e,t.faceValueData);return new CompleteData(n,GeneralEdgeStateData.deserializeState(e,t.edgeStateData),t.simpleRegionData?GeneralSimpleRegionData.deserializeState(e,t.simpleRegionData):new GeneralSimpleRegionData(e),t.faceColorData?GeneralFaceColorData.deserializeState(e,t.faceColorData):new GeneralFaceColorData(e),t.sectorStateData?GeneralSectorStateData.deserializeState(e,t.sectorStateData):new GeneralSectorStateData(e),t.vertexStateData?GeneralVertexStateData.deserializeState(e,t.vertexStateData):new GeneralVertexStateData(e),t.faceStateData?GeneralFaceStateData.deserializeState(e,t.faceStateData):new GeneralFaceStateData(e,r=>FaceState.any(r,n.getFaceValue(r))))}}class BaseBoard{constructor(e){ce(this,"edges");ce(this,"vertices");ce(this,"faces");ce(this,"halfEdges");ce(this,"outerBoundary");ce(this,"innerBoundaries");this.boardDescriptor=e,this.edges=e.edges,this.vertices=e.vertices,this.faces=e.faces,this.halfEdges=e.halfEdges,this.outerBoundary=e.outerBoundary,this.innerBoundaries=e.innerBoundaries}}const validateBoard=o=>{assertEnabled()&&(o.edges.forEach(e=>{const t=e.forwardHalf,n=e.reversedHalf;assert$2(t.edge===e),assert$2(n.edge===e),assert$2(!t.isReversed),assert$2(n.isReversed),assert$2(t.reversed===n),assert$2(n.reversed===t),assert$2(t.start===e.start),assert$2(t.end===e.end),assert$2(n.start===e.end),assert$2(n.end===e.start),assert$2(t.next.previous===t),assert$2(t.previous.next===t),assert$2(n.next.previous===n),assert$2(n.previous.next===n),assert$2(t.next!==t),assert$2(t.previous!==t),assert$2(n.next!==n),assert$2(n.previous!==n),assert$2(t.next.face===t.face),assert$2(t.previous.face===t.face),assert$2(n.next.face===n.face),assert$2(n.previous.face===n.face),assert$2(t.face===e.forwardFace),assert$2(n.face===e.reversedFace)}),o.vertices.forEach(e=>{e.incomingHalfEdges.forEach(r=>{assert$2(r.end===e)}),e.outgoingHalfEdges.forEach(r=>{assert$2(r.start===e)});const t=r=>e.incomingHalfEdges[(r+e.incomingHalfEdges.length)%e.incomingHalfEdges.length],n=r=>e.outgoingHalfEdges[(r+e.outgoingHalfEdges.length)%e.outgoingHalfEdges.length];_$1.range(0,e.incomingHalfEdges.length).forEach(r=>{const s=t(r),a=n(r);assert$2(s.reversed===a),assert$2(s.next===n(r-1)),assert$2(a.previous===t(r+1))}),e.edges.forEach(r=>{assert$2(r.start===e||r.end===e),assert$2(e.incomingHalfEdges.includes(r.forwardHalf)||e.outgoingHalfEdges.includes(r.forwardHalf)),assert$2(e.incomingHalfEdges.includes(r.reversedHalf)||e.outgoingHalfEdges.includes(r.reversedHalf)),r.forwardFace&&(assert$2(r.forwardFace.vertices.includes(e)),assert$2(e.faces.includes(r.forwardFace))),r.reversedFace&&(assert$2(r.reversedFace.vertices.includes(e)),assert$2(e.faces.includes(r.reversedFace)))}),e.faces.forEach(r=>{assert$2(r.vertices.includes(e))})}))};class HexagonalBoard extends BaseBoard{constructor(t,n,r,s=0){let a,h;r?(a=new Vector2(Math.sqrt(3),0).timesScalar(n),h=new Vector2(Math.sqrt(3)/2,3/2).timesScalar(n)):(a=new Vector2(3/2,Math.sqrt(3)/2).timesScalar(n),h=new Vector2(0,Math.sqrt(3)).timesScalar(n));const c=[new Vector2(1,0),new Vector2(1,-1),new Vector2(0,-1),new Vector2(-1,0),new Vector2(-1,1),new Vector2(0,1)],d=_$1.range(0,6).map(M=>c[M].plus(c[(M+1)%6])),y=M=>d.map(N=>N.plus(M.timesScalar(3))),g=(M,N)=>(Math.abs(M.x-N.x)+Math.abs(M.x+M.y-N.x-N.y)+Math.abs(M.y-N.y))/2,D=[];for(let M=-t;M<=t;M++)for(let N=Math.max(-t,-M-t);N<=Math.min(t,-M+t);N++){const F=new Vector2(M,N);g(F,new Vector2(0,0))>=s&&D.push(F)}const V=_$1.uniqWith(D.flatMap(y),(M,N)=>M.equals(N)).map(M=>({logicalCoordinates:M,viewCoordinates:a.timesScalar(M.x).plus(h.timesScalar(M.y)).timesScalar(1/3)})),k=D.map(M=>({logicalCoordinates:M,vertices:y(M).map(N=>{const F=V.find(G=>G.logicalCoordinates.equals(N));return assertEnabled()&&assert$2(F),F})}));super(createBoardDescriptor(rescaleProtoDescriptorAverage({vertices:V,faces:k},n)));ce(this,"isHexagonal",!0);this.radius=t,this.scale=n,this.isPointyTop=r,this.holeRadius=s,assertEnabled()&&validateBoard(this)}static enumeratePointyFaceCoordinates(t){const n=[];for(let r=-t;r<=t;r++)for(let s=Math.max(-t,-r-t);s<=Math.min(t,-r+t);s++)n.push(new Vector2(s,r));return n}}class SquareBoard extends BaseBoard{constructor(t,n){const r=[],s=new Map,a=(c,d)=>{const y=`${c},${d}`;if(!s.has(y)){const g={logicalCoordinates:new Vector2(c,d),viewCoordinates:new Vector2(c,d)};r.push(g),s.set(y,g)}return s.get(y)},h=_$1.range(0,n).flatMap(c=>_$1.range(0,t).map(d=>({logicalCoordinates:new Vector2(d,c),vertices:[a(d,c),a(d+1,c),a(d+1,c+1),a(d,c+1)]})));super(createBoardDescriptor({vertices:r,faces:h}));ce(this,"isSquare",!0);this.width=t,this.height=n,assertEnabled()&&validateBoard(this)}}class BasicPuzzle{constructor(e,t){ce(this,"stateProperty");this.board=e,this.stateProperty=new TinyProperty(t)}static fromSolvedPuzzle(e){return new BasicPuzzle(e.board,e.cleanState)}static loadDefaultPuzzle(){return BasicPuzzle.loadFromSimpleString("10x18 .3.1....1..032....0......3.1....02.3...02....3.1...........2011.01..01.......3...2302..........1102...3.......22..03.0322...........3.2....13...2.30....2.2......1....103..2....1.3.")}static loadFromSimpleString(e){const[t,n]=e.split(" "),[r,s]=t.split("x").map(c=>parseInt(c)),a=new SquareBoard(r,s),h=CompleteData.fromFaces(a,c=>{const d=c.logicalCoordinates.y*r+c.logicalCoordinates.x,y=n[d];return y==="."?null:parseInt(y)});return new BasicPuzzle(a,h)}static loadDeprecatedScalaString(e){if(!e.includes("!"))return BasicPuzzle.loadFromSimpleString(e);const t=1,n=2,r=4,s=8,[a,h]=e.split(" "),[c,d]=a.split("x").map(V=>parseInt(V)),y=new SquareBoard(c,d),g=V=>3*(V.logicalCoordinates.y*c+V.logicalCoordinates.x)+1,D=(V,k)=>{const M=g(V),N=parseInt(h[M+1]),F=parseInt(h[M+2]);return N&k?EdgeState.BLACK:F&k?EdgeState.RED:EdgeState.WHITE},O=CompleteData.fromFacesEdges(y,V=>{const k=h[g(V)];return k==="."?null:parseInt(k)},V=>{if((V.start.logicalCoordinates.x===V.end.logicalCoordinates.x?Orientation.VERTICAL:Orientation.HORIZONTAL)===Orientation.HORIZONTAL){const M=V.start.logicalCoordinates.x<V.end.logicalCoordinates.x?V.forwardFace:V.reversedFace,N=V.start.logicalCoordinates.x<V.end.logicalCoordinates.x?V.reversedFace:V.forwardFace;return M?D(M,n):D(N,s)}else{const M=V.start.logicalCoordinates.y<V.end.logicalCoordinates.y?V.reversedFace:V.forwardFace,N=V.start.logicalCoordinates.y<V.end.logicalCoordinates.y?V.forwardFace:V.reversedFace;return M?D(M,t):D(N,r)}});return new BasicPuzzle(y,O)}static loadPointyTopHexagonalString(e){assertEnabled()&&assert$2(e.startsWith("h")||e.startsWith("H"));const[t,n]=e.slice(1).split(" "),r=parseInt(t),s=new HexagonalBoard(r,Math.sqrt(3)/2,e.startsWith("h")),a=HexagonalBoard.enumeratePointyFaceCoordinates(r),h=new Map;for(let d=0;d<n.length;d++){const y=n[d];if(y===".")continue;const g=a[d];h.set(g,parseInt(y))}const c=CompleteData.fromFaces(s,CompleteData.faceMapLookup(h));return new BasicPuzzle(s,c)}}var C_MINISAT;C_MINISAT=function(){var module={},require=function(){},process={argv:["node","minisat"],on:function(){},stdout:{write:function(o){console.log("MINISAT-out:",o.replace(/\n$/,""))}},stderr:{write:function(o){console.log("MINISAT-err:",o.replace(/\n$/,""))}}},Module;Module||(Module=(typeof Module<"u"?Module:null)||{});var moduleOverrides={};for(var key in Module)Module.hasOwnProperty(key)&&(moduleOverrides[key]=Module[key]);var ENVIRONMENT_IS_NODE=typeof process=="object"&&typeof require=="function",ENVIRONMENT_IS_WORKER=typeof importScripts=="function",ENVIRONMENT_IS_SHELL=!ENVIRONMENT_IS_NODE&&!ENVIRONMENT_IS_WORKER;if(ENVIRONMENT_IS_NODE){Module.print||(Module.print=function(e){process.stdout.write(e+`
`)}),Module.printErr||(Module.printErr=function(e){process.stderr.write(e+`
`)});var nodeFS=require(),nodePath=require();Module.read=function(e,t){e=nodePath.normalize(e);var n=nodeFS.readFileSync(e);return!n&&e!=nodePath.resolve(e)&&(e=path.join(__dirname,"..","src",e),n=nodeFS.readFileSync(e)),n&&!t&&(n=n.toString()),n},Module.readBinary=function(e){return Module.read(e,!0)},Module.load=function(e){globalEval(read(e))},process.argv.length>1?Module.thisProgram=process.argv[1].replace(/\\/g,"/"):Module.thisProgram="unknown-program",Module.arguments=process.argv.slice(2),typeof module<"u"&&(module.exports=Module),process.on("uncaughtException",function(o){if(!(o instanceof ExitStatus))throw o})}else if(ENVIRONMENT_IS_SHELL)Module.print||(Module.print=print),typeof printErr<"u"&&(Module.printErr=printErr),typeof read<"u"?Module.read=read:Module.read=function(){throw"no read() available (jsc?)"},Module.readBinary=function(e){if(typeof readbuffer=="function")return new Uint8Array(readbuffer(e));var t=read(e,"binary");return assert(typeof t=="object"),t},typeof scriptArgs<"u"?Module.arguments=scriptArgs:typeof arguments<"u"&&(Module.arguments=arguments),this.Module=Module;else if(ENVIRONMENT_IS_WORKER){if(Module.read=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},typeof arguments<"u"&&(Module.arguments=arguments),typeof console<"u")Module.print||(Module.print=function(e){console.log(e)}),Module.printErr||(Module.printErr=function(e){console.log(e)});else{var TRY_USE_DUMP=!1;Module.print||(Module.print=TRY_USE_DUMP&&typeof dump<"u"?function(o){dump(o)}:function(o){})}Module.load=importScripts}else throw"Unknown runtime environment. Where are we?";function globalEval(o){eval.call(null,o)}!Module.load&&Module.read&&(Module.load=function(e){globalEval(Module.read(e))}),Module.print||(Module.print=function(){}),Module.printErr||(Module.printErr=Module.print),Module.arguments||(Module.arguments=[]),Module.thisProgram||(Module.thisProgram="./this.program"),Module.print=Module.print,Module.printErr=Module.printErr,Module.preRun=[],Module.postRun=[];for(var key in moduleOverrides)moduleOverrides.hasOwnProperty(key)&&(Module[key]=moduleOverrides[key]);var Runtime={setTempRet0:function(o){tempRet0=o},getTempRet0:function(){return tempRet0},stackSave:function(){return STACKTOP},stackRestore:function(o){STACKTOP=o},getNativeTypeSize:function(o){switch(o){case"i1":case"i8":return 1;case"i16":return 2;case"i32":return 4;case"i64":return 8;case"float":return 4;case"double":return 8;default:{if(o[o.length-1]==="*")return Runtime.QUANTUM_SIZE;if(o[0]==="i"){var e=parseInt(o.substr(1));return assert(e%8===0),e/8}else return 0}}},getNativeFieldSize:function(o){return Math.max(Runtime.getNativeTypeSize(o),Runtime.QUANTUM_SIZE)},STACK_ALIGN:16,getAlignSize:function(o,e,t){return!t&&(o=="i64"||o=="double")?8:o?Math.min(e||(o?Runtime.getNativeFieldSize(o):0),Runtime.QUANTUM_SIZE):Math.min(e,8)},dynCall:function(o,e,t){return t&&t.length?(t.splice||(t=Array.prototype.slice.call(t)),t.splice(0,0,e),Module["dynCall_"+o].apply(null,t)):Module["dynCall_"+o].call(null,e)},functionPointers:[],addFunction:function(o){for(var e=0;e<Runtime.functionPointers.length;e++)if(!Runtime.functionPointers[e])return Runtime.functionPointers[e]=o,2*(1+e);throw"Finished up all reserved function pointers. Use a higher value for RESERVED_FUNCTION_POINTERS."},removeFunction:function(o){Runtime.functionPointers[(o-2)/2]=null},getAsmConst:function(code,numArgs){Runtime.asmConstCache||(Runtime.asmConstCache={});var func=Runtime.asmConstCache[code];if(func)return func;for(var args=[],i=0;i<numArgs;i++)args.push("$"+i);var source=Pointer_stringify(code);source[0]==='"'&&(source.indexOf('"',1)===source.length-1?source=source.substr(1,source.length-2):abort("invalid EM_ASM input |"+source+"|. Please use EM_ASM(..code..) (no quotes) or EM_ASM({ ..code($0).. }, input) (to input values)"));try{var evalled=eval("(function(Module, FS) { return function("+args.join(",")+"){ "+source+" } })")(Module,typeof FS<"u"?FS:null)}catch(o){throw Module.printErr("error in executing inline EM_ASM code: "+o+` on: 

`+source+`

with args |`+args+"| (make sure to use the right one out of EM_ASM, EM_ASM_ARGS, etc.)"),o}return Runtime.asmConstCache[code]=evalled},warnOnce:function(o){Runtime.warnOnce.shown||(Runtime.warnOnce.shown={}),Runtime.warnOnce.shown[o]||(Runtime.warnOnce.shown[o]=1,Module.printErr(o))},funcWrappers:{},getFuncWrapper:function(o,e){assert(e),Runtime.funcWrappers[e]||(Runtime.funcWrappers[e]={});var t=Runtime.funcWrappers[e];return t[o]||(t[o]=function(){return Runtime.dynCall(e,o,arguments)}),t[o]},UTF8Processor:function(){var o=[],e=0;this.processCChar=function(t){if(t=t&255,o.length==0)return t&128?(o.push(t),(t&224)==192?e=1:(t&240)==224?e=2:e=3,""):String.fromCharCode(t);if(e&&(o.push(t),e--,e>0))return"";var n=o[0],r=o[1],s=o[2],a=o[3],h;if(o.length==2)h=String.fromCharCode((n&31)<<6|r&63);else if(o.length==3)h=String.fromCharCode((n&15)<<12|(r&63)<<6|s&63);else{var c=(n&7)<<18|(r&63)<<12|(s&63)<<6|a&63;h=String.fromCharCode(((c-65536)/1024|0)+55296,(c-65536)%1024+56320)}return o.length=0,h},this.processJSString=function(n){n=unescape(encodeURIComponent(n));for(var r=[],s=0;s<n.length;s++)r.push(n.charCodeAt(s));return r}},getCompilerSetting:function(o){throw"You must build with -s RETAIN_COMPILER_SETTINGS=1 for Runtime.getCompilerSetting or emscripten_get_compiler_setting to work"},stackAlloc:function(o){var e=STACKTOP;return STACKTOP=STACKTOP+o|0,STACKTOP=STACKTOP+15&-16,e},staticAlloc:function(o){var e=STATICTOP;return STATICTOP=STATICTOP+o|0,STATICTOP=STATICTOP+15&-16,e},dynamicAlloc:function(o){var e=DYNAMICTOP;return DYNAMICTOP=DYNAMICTOP+o|0,DYNAMICTOP=DYNAMICTOP+15&-16,DYNAMICTOP>=TOTAL_MEMORY&&enlargeMemory(),e},alignMemory:function(o,e){var t=o=Math.ceil(o/(e||16))*(e||16);return t},makeBigInt:function(o,e,t){var n=t?+(o>>>0)+ +(e>>>0)*4294967296:+(o>>>0)+ +(e|0)*4294967296;return n},GLOBAL_BASE:8,QUANTUM_SIZE:4,__dummy__:0};Module.Runtime=Runtime;var ABORT=!1,tempDouble,tempI64,tempRet0;function assert(o,e){o||abort("Assertion failed: "+e)}function getCFunc(ident){var func=Module["_"+ident];if(!func)try{func=eval("_"+ident)}catch(o){}return assert(func,"Cannot call unknown function "+ident+" (perhaps LLVM optimizations or closure removed it?)"),func}var cwrap,ccall;(function(){var JSfuncs={stackSave:function(){Runtime.stackSave()},stackRestore:function(){Runtime.stackRestore()},arrayToC:function(o){var e=Runtime.stackAlloc(o.length);return writeArrayToMemory(o,e),e},stringToC:function(o){var e=0;return o!=null&&o!==0&&(e=Runtime.stackAlloc((o.length<<2)+1),writeStringToMemory(o,e)),e}},toC={string:JSfuncs.stringToC,array:JSfuncs.arrayToC};ccall=function(e,t,n,r){var s=getCFunc(e),a=[],h=0;if(r)for(var c=0;c<r.length;c++){var d=toC[n[c]];d?(h===0&&(h=Runtime.stackSave()),a[c]=d(r[c])):a[c]=r[c]}var y=s.apply(null,a);return t==="string"&&(y=Pointer_stringify(y)),h!==0&&Runtime.stackRestore(h),y};var sourceRegex=/^function\s*\(([^)]*)\)\s*{\s*([^*]*?)[\s;]*(?:return\s*(.*?)[;\s]*)?}$/;function parseJSFunc(o){var e=o.toString().match(sourceRegex).slice(1);return{arguments:e[0],body:e[1],returnValue:e[2]}}var JSsource={};for(var fun in JSfuncs)JSfuncs.hasOwnProperty(fun)&&(JSsource[fun]=parseJSFunc(JSfuncs[fun]));cwrap=function cwrap(ident,returnType,argTypes){argTypes=argTypes||[];var cfunc=getCFunc(ident),numericArgs=argTypes.every(function(o){return o==="number"}),numericRet=returnType!=="string";if(numericRet&&numericArgs)return cfunc;var argNames=argTypes.map(function(o,e){return"$"+e}),funcstr="(function("+argNames.join(",")+") {",nargs=argTypes.length;if(!numericArgs){funcstr+="var stack = "+JSsource.stackSave.body+";";for(var i=0;i<nargs;i++){var arg=argNames[i],type=argTypes[i];if(type!=="number"){var convertCode=JSsource[type+"ToC"];funcstr+="var "+convertCode.arguments+" = "+arg+";",funcstr+=convertCode.body+";",funcstr+=arg+"="+convertCode.returnValue+";"}}}var cfuncname=parseJSFunc(function(){return cfunc}).returnValue;if(funcstr+="var ret = "+cfuncname+"("+argNames.join(",")+");",!numericRet){var strgfy=parseJSFunc(function(){return Pointer_stringify}).returnValue;funcstr+="ret = "+strgfy+"(ret);"}return numericArgs||(funcstr+=JSsource.stackRestore.body.replace("()","(stack)")+";"),funcstr+="return ret})",eval(funcstr)}})(),Module.cwrap=cwrap,Module.ccall=ccall;function setValue(o,e,t,n){switch(t=t||"i8",t.charAt(t.length-1)==="*"&&(t="i32"),t){case"i1":HEAP8[o>>0]=e;break;case"i8":HEAP8[o>>0]=e;break;case"i16":HEAP16[o>>1]=e;break;case"i32":HEAP32[o>>2]=e;break;case"i64":tempI64=[e>>>0,(tempDouble=e,+Math_abs(tempDouble)>=1?tempDouble>0?(Math_min(+Math_floor(tempDouble/4294967296),4294967295)|0)>>>0:~~+Math_ceil((tempDouble-+(~~tempDouble>>>0))/4294967296)>>>0:0)],HEAP32[o>>2]=tempI64[0],HEAP32[o+4>>2]=tempI64[1];break;case"float":HEAPF32[o>>2]=e;break;case"double":HEAPF64[o>>3]=e;break;default:abort("invalid type for setValue: "+t)}}Module.setValue=setValue;function getValue(o,e,t){switch(e=e||"i8",e.charAt(e.length-1)==="*"&&(e="i32"),e){case"i1":return HEAP8[o>>0];case"i8":return HEAP8[o>>0];case"i16":return HEAP16[o>>1];case"i32":return HEAP32[o>>2];case"i64":return HEAP32[o>>2];case"float":return HEAPF32[o>>2];case"double":return HEAPF64[o>>3];default:abort("invalid type for setValue: "+e)}return null}Module.getValue=getValue;var ALLOC_NORMAL=0,ALLOC_STACK=1,ALLOC_STATIC=2,ALLOC_DYNAMIC=3,ALLOC_NONE=4;Module.ALLOC_NORMAL=ALLOC_NORMAL,Module.ALLOC_STACK=ALLOC_STACK,Module.ALLOC_STATIC=ALLOC_STATIC,Module.ALLOC_DYNAMIC=ALLOC_DYNAMIC,Module.ALLOC_NONE=ALLOC_NONE;function allocate(o,e,t,n){var r,s;typeof o=="number"?(r=!0,s=o):(r=!1,s=o.length);var a=typeof e=="string"?e:null,h;if(t==ALLOC_NONE?h=n:h=[_malloc,Runtime.stackAlloc,Runtime.staticAlloc,Runtime.dynamicAlloc][t===void 0?ALLOC_STATIC:t](Math.max(s,a?1:e.length)),r){var n=h,c;for(assert((h&3)==0),c=h+(s&-4);n<c;n+=4)HEAP32[n>>2]=0;for(c=h+s;n<c;)HEAP8[n++>>0]=0;return h}if(a==="i8")return o.subarray||o.slice?HEAPU8.set(o,h):HEAPU8.set(new Uint8Array(o),h),h;for(var d=0,y,g,D;d<s;){var O=o[d];if(typeof O=="function"&&(O=Runtime.getFunctionIndex(O)),y=a||e[d],y===0){d++;continue}y=="i64"&&(y="i32"),setValue(h+d,O,y),D!==y&&(g=Runtime.getNativeTypeSize(y),D=y),d+=g}return h}Module.allocate=allocate;function Pointer_stringify(o,e){if(e===0||!o)return"";for(var t=!1,n,r=0;;){if(n=HEAPU8[o+r>>0],n>=128)t=!0;else if(n==0&&!e)break;if(r++,e&&r==e)break}e||(e=r);var s="";if(!t){for(var a=1024,h;e>0;)h=String.fromCharCode.apply(String,HEAPU8.subarray(o,o+Math.min(e,a))),s=s?s+h:h,o+=a,e-=a;return s}var c=new Runtime.UTF8Processor;for(r=0;r<e;r++)n=HEAPU8[o+r>>0],s+=c.processCChar(n);return s}Module.Pointer_stringify=Pointer_stringify;function UTF16ToString(o){for(var e=0,t="";;){var n=HEAP16[o+e*2>>1];if(n==0)return t;++e,t+=String.fromCharCode(n)}}Module.UTF16ToString=UTF16ToString;function stringToUTF16(o,e){for(var t=0;t<o.length;++t){var n=o.charCodeAt(t);HEAP16[e+t*2>>1]=n}HEAP16[e+o.length*2>>1]=0}Module.stringToUTF16=stringToUTF16;function UTF32ToString(o){for(var e=0,t="";;){var n=HEAP32[o+e*4>>2];if(n==0)return t;if(++e,n>=65536){var r=n-65536;t+=String.fromCharCode(55296|r>>10,56320|r&1023)}else t+=String.fromCharCode(n)}}Module.UTF32ToString=UTF32ToString;function stringToUTF32(o,e){for(var t=0,n=0;n<o.length;++n){var r=o.charCodeAt(n);if(r>=55296&&r<=57343){var s=o.charCodeAt(++n);r=65536+((r&1023)<<10)|s&1023}HEAP32[e+t*4>>2]=r,++t}HEAP32[e+t*4>>2]=0}Module.stringToUTF32=stringToUTF32;function demangle(o){var e=!!Module.___cxa_demangle;if(e)try{var t=_malloc(o.length);writeStringToMemory(o.substr(1),t);var n=_malloc(4),r=Module.___cxa_demangle(t,0,0,n);if(getValue(n,"i32")===0&&r)return Pointer_stringify(r)}catch{}finally{t&&_free(t),n&&_free(n),r&&_free(r)}var s=3,a={v:"void",b:"bool",c:"char",s:"short",i:"int",l:"long",f:"float",d:"double",w:"wchar_t",a:"signed char",h:"unsigned char",t:"unsigned short",j:"unsigned int",m:"unsigned long",x:"long long",y:"unsigned long long",z:"..."},h=[],c=!0;function d(){s++,o[s]==="K"&&s++;for(var D=[];o[s]!=="E";){if(o[s]==="S"){s++;var O=o.indexOf("_",s),V=o.substring(s,O)||0;D.push(h[V]||"?"),s=O+1;continue}if(o[s]==="C"){D.push(D[D.length-1]),s+=2;continue}var k=parseInt(o.substr(s)),M=k.toString().length;if(!k||!M){s--;break}var N=o.substr(s+M,k);D.push(N),h.push(N),s+=M+k}return s++,D}function y(D,O,V){O=O||1/0;var k="",M=[];function N(){return"("+M.join(", ")+")"}var F;if(o[s]==="N"){if(F=d().join("::"),O--,O===0)return D?[F]:F}else{(o[s]==="K"||c&&o[s]==="L")&&s++;var G=parseInt(o.substr(s));if(G){var ie=G.toString().length;F=o.substr(s+ie,G),s+=ie+G}}if(c=!1,o[s]==="I"){s++;var Z=y(!0),W=y(!0,1,!0);k+=W[0]+" "+F+"<"+Z.join(", ")+">"}else k=F;e:for(;s<o.length&&O-- >0;){var X=o[s++];if(X in a)M.push(a[X]);else switch(X){case"P":M.push(y(!0,1,!0)[0]+"*");break;case"R":M.push(y(!0,1,!0)[0]+"&");break;case"L":{s++;var J=o.indexOf("E",s),G=J-s;M.push(o.substr(s,G)),s+=G+2;break}case"A":{var G=parseInt(o.substr(s));if(s+=G.toString().length,o[s]!=="_")throw"?";s++,M.push(y(!0,1,!0)[0]+" ["+G+"]");break}case"E":break e;default:k+="?"+X;break e}}return!V&&M.length===1&&M[0]==="void"&&(M=[]),D?(k&&M.push(k+"?"),M):k+N()}var g=o;try{if(o=="Object._main"||o=="_main")return"main()";if(typeof o=="number"&&(o=Pointer_stringify(o)),o[0]!=="_"||o[1]!=="_"||o[2]!=="Z")return o;switch(o[3]){case"n":return"operator new()";case"d":return"operator delete()"}g=y()}catch{g+="?"}return g.indexOf("?")>=0&&!e&&Runtime.warnOnce("warning: a problem occurred in builtin C++ name demangling; build with  -s DEMANGLE_SUPPORT=1  to link in libcxxabi demangling"),g}function demangleAll(o){return o.replace(/__Z[\w\d_]+/g,function(e){var t=demangle(e);return e===t?e:e+" ["+t+"]"})}function jsStackTrace(){var o=new Error;if(!o.stack){try{throw new Error(0)}catch(e){o=e}if(!o.stack)return"(no stack trace available)"}return o.stack.toString()}function stackTrace(){return demangleAll(jsStackTrace())}Module.stackTrace=stackTrace;var PAGE_SIZE=4096;function alignMemoryPage(o){return o+4095&-4096}var HEAP,HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAPF64,STATIC_BASE=0,STATICTOP=0,STACK_BASE=0,STACKTOP=0,STACK_MAX=0,DYNAMIC_BASE=0,DYNAMICTOP=0;function enlargeMemory(){abort("Cannot enlarge memory arrays. Either (1) compile with -s TOTAL_MEMORY=X with X higher than the current value "+TOTAL_MEMORY+", (2) compile with ALLOW_MEMORY_GROWTH which adjusts the size at runtime but prevents some optimizations, or (3) set Module.TOTAL_MEMORY before the program runs.")}var TOTAL_STACK=Module.TOTAL_STACK||5242880,TOTAL_MEMORY=Module.TOTAL_MEMORY||67108864;Module.FAST_MEMORY;for(var totalMemory=64*1024;totalMemory<TOTAL_MEMORY||totalMemory<2*TOTAL_STACK;)totalMemory<16*1024*1024?totalMemory*=2:totalMemory+=16*1024*1024;totalMemory!==TOTAL_MEMORY&&(Module.printErr("increasing TOTAL_MEMORY to "+totalMemory+" to be compliant with the asm.js spec"),TOTAL_MEMORY=totalMemory),assert(typeof Int32Array<"u"&&typeof Float64Array<"u"&&!!new Int32Array(1).subarray&&!!new Int32Array(1).set,"JS engine does not provide full typed array support");var buffer=new ArrayBuffer(TOTAL_MEMORY);HEAP8=new Int8Array(buffer),HEAP16=new Int16Array(buffer),HEAP32=new Int32Array(buffer),HEAPU8=new Uint8Array(buffer),HEAPU16=new Uint16Array(buffer),HEAPU32=new Uint32Array(buffer),HEAPF32=new Float32Array(buffer),HEAPF64=new Float64Array(buffer),HEAP32[0]=255,assert(HEAPU8[0]===255&&HEAPU8[3]===0,"Typed arrays 2 must be run on a little-endian system"),Module.HEAP=HEAP,Module.buffer=buffer,Module.HEAP8=HEAP8,Module.HEAP16=HEAP16,Module.HEAP32=HEAP32,Module.HEAPU8=HEAPU8,Module.HEAPU16=HEAPU16,Module.HEAPU32=HEAPU32,Module.HEAPF32=HEAPF32,Module.HEAPF64=HEAPF64;function callRuntimeCallbacks(o){for(;o.length>0;){var e=o.shift();if(typeof e=="function"){e();continue}var t=e.func;typeof t=="number"?e.arg===void 0?Runtime.dynCall("v",t):Runtime.dynCall("vi",t,[e.arg]):t(e.arg===void 0?null:e.arg)}}var __ATPRERUN__=[],__ATINIT__=[],__ATMAIN__=[],__ATEXIT__=[],__ATPOSTRUN__=[],runtimeInitialized=!1;function preRun(){if(Module.preRun)for(typeof Module.preRun=="function"&&(Module.preRun=[Module.preRun]);Module.preRun.length;)addOnPreRun(Module.preRun.shift());callRuntimeCallbacks(__ATPRERUN__)}function ensureInitRuntime(){runtimeInitialized||(runtimeInitialized=!0,callRuntimeCallbacks(__ATINIT__))}function preMain(){callRuntimeCallbacks(__ATMAIN__)}function exitRuntime(){callRuntimeCallbacks(__ATEXIT__)}function postRun(){if(Module.postRun)for(typeof Module.postRun=="function"&&(Module.postRun=[Module.postRun]);Module.postRun.length;)addOnPostRun(Module.postRun.shift());callRuntimeCallbacks(__ATPOSTRUN__)}function addOnPreRun(o){__ATPRERUN__.unshift(o)}Module.addOnPreRun=Module.addOnPreRun=addOnPreRun;function addOnInit(o){__ATINIT__.unshift(o)}Module.addOnInit=Module.addOnInit=addOnInit;function addOnPreMain(o){__ATMAIN__.unshift(o)}Module.addOnPreMain=Module.addOnPreMain=addOnPreMain;function addOnExit(o){__ATEXIT__.unshift(o)}Module.addOnExit=Module.addOnExit=addOnExit;function addOnPostRun(o){__ATPOSTRUN__.unshift(o)}Module.addOnPostRun=Module.addOnPostRun=addOnPostRun;function intArrayFromString(o,e,t){var n=new Runtime.UTF8Processor().processJSString(o);return t&&(n.length=t),e||n.push(0),n}Module.intArrayFromString=intArrayFromString;function intArrayToString(o){for(var e=[],t=0;t<o.length;t++){var n=o[t];n>255&&(n&=255),e.push(String.fromCharCode(n))}return e.join("")}Module.intArrayToString=intArrayToString;function writeStringToMemory(o,e,t){for(var n=intArrayFromString(o,t),r=0;r<n.length;){var s=n[r];HEAP8[e+r>>0]=s,r=r+1}}Module.writeStringToMemory=writeStringToMemory;function writeArrayToMemory(o,e){for(var t=0;t<o.length;t++)HEAP8[e+t>>0]=o[t]}Module.writeArrayToMemory=writeArrayToMemory;function writeAsciiToMemory(o,e,t){for(var n=0;n<o.length;n++)HEAP8[e+n>>0]=o.charCodeAt(n);t||(HEAP8[e+o.length>>0]=0)}Module.writeAsciiToMemory=writeAsciiToMemory;function unSign(o,e,t){return o>=0?o:e<=32?2*Math.abs(1<<e-1)+o:Math.pow(2,e)+o}function reSign(o,e,t){if(o<=0)return o;var n=e<=32?Math.abs(1<<e-1):Math.pow(2,e-1);return o>=n&&(e<=32||o>n)&&(o=-2*n+o),o}(!Math.imul||Math.imul(4294967295,5)!==-5)&&(Math.imul=function o(e,t){var n=e>>>16,r=e&65535,s=t>>>16,a=t&65535;return r*a+(n*a+r*s<<16)|0}),Math.imul=Math.imul;var Math_abs=Math.abs,Math_ceil=Math.ceil,Math_floor=Math.floor,Math_pow=Math.pow,Math_min=Math.min,runDependencies=0,dependenciesFulfilled=null;function addRunDependency(o){runDependencies++,Module.monitorRunDependencies&&Module.monitorRunDependencies(runDependencies)}Module.addRunDependency=addRunDependency;function removeRunDependency(o){if(runDependencies--,Module.monitorRunDependencies&&Module.monitorRunDependencies(runDependencies),runDependencies==0&&dependenciesFulfilled){var e=dependenciesFulfilled;dependenciesFulfilled=null,e()}}Module.removeRunDependency=removeRunDependency,Module.preloadedImages={},Module.preloadedAudios={},STATIC_BASE=8,STATICTOP=STATIC_BASE+5664,__ATINIT__.push({func:function(){__GLOBAL__I_a()}},{func:function(){__GLOBAL__I_a127()}}),allocate([78,55,77,105,110,105,115,97,116,50,48,79,117,116,79,102,77,101,109,111,114,121,69,120,99,101,112,116,105,111,110,69,0,0,0,0,0,0,0,0,88,18,0,0,8,0,0,0,78,55,77,105,110,105,115,97,116,54,79,112,116,105,111,110,69,0,0,0,0,0,0,0,88,18,0,0,56,0,0,0,10,32,32,32,32,32,32,32,32,37,115,10,0,0,0,0,0,0,0,0,80,0,0,0,1,0,0,0,2,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,200,0,0,0,1,0,0,0,3,0,0,0,1,0,0,0,1,0,0,0,78,55,77,105,110,105,115,97,116,49,48,66,111,111,108,79,112,116,105,111,110,69,0,0,128,18,0,0,176,0,0,0,80,0,0,0,0,0,0,0,32,32,45,37,115,44,32,45,110,111,45,37,115,0,0,0,40,100,101,102,97,117,108,116,58,32,37,115,41,10,0,0,111,110,0,0,0,0,0,0,111,102,102,0,0,0,0,0,110,111,45,0,0,0,0,0,0,0,0,0,64,1,0,0,1,0,0,0,4,0,0,0,2,0,0,0,2,0,0,0,78,55,77,105,110,105,115,97,116,57,73,110,116,79,112,116,105,111,110,69,0,0,0,0,128,18,0,0,40,1,0,0,80,0,0,0,0,0,0,0,32,32,45,37,45,49,50,115,32,61,32,37,45,56,115,32,91,0,0,0,0,0,0,0,105,109,105,110,0,0,0,0,37,52,100,0,0,0,0,0,32,46,46,32,0,0,0,0,105,109,97,120,0,0,0,0,93,32,40,100,101,102,97,117,108,116,58,32,37,100,41,10,0,0,0,0,0,0,0,0,69,82,82,79,82,33,32,118,97,108,117,101,32,60,37,115,62,32,105,115,32,116,111,111,32,108,97,114,103,101,32,102,111,114,32,111,112,116,105,111,110,32,34,37,115,34,46,10,0,0,0,0,0,0,0,0,69,82,82,79,82,33,32,118,97,108,117,101,32,60,37,115,62,32,105,115,32,116,111,111,32,115,109,97,108,108,32,102,111,114,32,111,112,116,105,111,110,32,34,37,115,34,46,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,118,97,114,45,100,101,99,97,121,0,0,0,0,0,0,0,84,104,101,32,118,97,114,105,97,98,108,101,32,97,99,116,105,118,105,116,121,32,100,101,99,97,121,32,102,97,99,116,111,114,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,99,108,97,45,100,101,99,97,121,0,0,0,0,0,0,0,84,104,101,32,99,108,97,117,115,101,32,97,99,116,105,118,105,116,121,32,100,101,99,97,121,32,102,97,99,116,111,114,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,114,110,100,45,102,114,101,113,0,0,0,0,0,0,0,0,84,104,101,32,102,114,101,113,117,101,110,99,121,32,119,105,116,104,32,119,104,105,99,104,32,116,104,101,32,100,101,99,105,115,105,111,110,32,104,101,117,114,105,115,116,105,99,32,116,114,105,101,115,32,116,111,32,99,104,111,111,115,101,32,97,32,114,97,110,100,111,109,32,118,97,114,105,97,98,108,101,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,114,110,100,45,115,101,101,100,0,0,0,0,0,0,0,0,85,115,101,100,32,98,121,32,116,104,101,32,114,97,110,100,111,109,32,118,97,114,105,97,98,108,101,32,115,101,108,101,99,116,105,111,110,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,99,99,109,105,110,45,109,111,100,101,0,0,0,0,0,0,67,111,110,116,114,111,108,115,32,99,111,110,102,108,105,99,116,32,99,108,97,117,115,101,32,109,105,110,105,109,105,122,97,116,105,111,110,32,40,48,61,110,111,110,101,44,32,49,61,98,97,115,105,99,44,32,50,61,100,101,101,112,41,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,112,104,97,115,101,45,115,97,118,105,110,103,0,0,0,0,67,111,110,116,114,111,108,115,32,116,104,101,32,108,101,118,101,108,32,111,102,32,112,104,97,115,101,32,115,97,118,105,110,103,32,40,48,61,110,111,110,101,44,32,49,61,108,105,109,105,116,101,100,44,32,50,61,102,117,108,108,41,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,114,110,100,45,105,110,105,116,0,0,0,0,0,0,0,0,82,97,110,100,111,109,105,122,101,32,116,104,101,32,105,110,105,116,105,97,108,32,97,99,116,105,118,105,116,121,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,108,117,98,121,0,0,0,0,85,115,101,32,116,104,101,32,76,117,98,121,32,114,101,115,116,97,114,116,32,115,101,113,117,101,110,99,101,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,114,102,105,114,115,116,0,0,84,104,101,32,98,97,115,101,32,114,101,115,116,97,114,116,32,105,110,116,101,114,118,97,108,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,114,105,110,99,0,0,0,0,82,101,115,116,97,114,116,32,105,110,116,101,114,118,97,108,32,105,110,99,114,101,97,115,101,32,102,97,99,116,111,114,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,103,99,45,102,114,97,99,0,84,104,101,32,102,114,97,99,116,105,111,110,32,111,102,32,119,97,115,116,101,100,32,109,101,109,111,114,121,32,97,108,108,111,119,101,100,32,98,101,102,111,114,101,32,97,32,103,97,114,98,97,103,101,32,99,111,108,108,101,99,116,105,111,110,32,105,115,32,116,114,105,103,103,101,114,101,100,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,109,105,110,45,108,101,97,114,110,116,115,0,0,0,0,0,77,105,110,105,109,117,109,32,108,101,97,114,110,116,32,99,108,97,117,115,101,32,108,105,109,105,116,0,0,0,0,0,0,0,0,0,192,7,0,0,5,0,0,0,6,0,0,0,7,0,0,0,0,0,0,0,124,32,37,57,100,32,124,32,37,55,100,32,37,56,100,32,37,56,100,32,124,32,37,56,100,32,37,56,100,32,37,54,46,48,102,32,124,32,37,54,46,51,102,32,37,37,32,124,10,0,0,0,0,0,0,0,124,32,32,71,97,114,98,97,103,101,32,99,111,108,108,101,99,116,105,111,110,58,32,32,32,37,49,50,100,32,98,121,116,101,115,32,61,62,32,37,49,50,100,32,98,121,116,101,115,32,32,32,32,32,32,32,32,32,32,32,32,32,124,10,0,0,0,0,0,0,0,0,78,55,77,105,110,105,115,97,116,54,83,111,108,118,101,114,69,0,0,0,0,0,0,0,88,18,0,0,168,7,0,0,60,98,111,111,108,62,0,0,10,32,32,32,32,32,32,32,32,37,115,10,0,0,0,0,60,105,110,116,51,50,62,0,69,82,82,79,82,33,32,118,97,108,117,101,32,60,37,115,62,32,105,115,32,116,111,111,32,108,97,114,103,101,32,102,111,114,32,111,112,116,105,111,110,32,34,37,115,34,46,10,0,0,0,0,0,0,0,0,69,82,82,79,82,33,32,118,97,108,117,101,32,60,37,115,62,32,105,115,32,116,111,111,32,115,109,97,108,108,32,102,111,114,32,111,112,116,105,111,110,32,34,37,115,34,46,10,0,0,0,0,0,0,0,0,67,79,82,69,0,0,0,0,60,100,111,117,98,108,101,62,0,0,0,0,0,0,0,0,0,0,0,0,168,8,0,0,1,0,0,0,8,0,0,0,3,0,0,0,3,0,0,0,78,55,77,105,110,105,115,97,116,49,50,68,111,117,98,108,101,79,112,116,105,111,110,69,0,0,0,0,0,0,0,0,128,18,0,0,136,8,0,0,80,0,0,0,0,0,0,0,32,32,45,37,45,49,50,115,32,61,32,37,45,56,115,32,37,99,37,52,46,50,103,32,46,46,32,37,52,46,50,103,37,99,32,40,100,101,102,97,117,108,116,58,32,37,103,41,10,0,0,0,0,0,0,0,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,91,32,83,101,97,114,99,104,32,83,116,97,116,105,115,116,105,99,115,32,93,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,0,124,32,67,111,110,102,108,105,99,116,115,32,124,32,32,32,32,32,32,32,32,32,32,79,82,73,71,73,78,65,76,32,32,32,32,32,32,32,32,32,124,32,32,32,32,32,32,32,32,32,32,76,69,65,82,78,84,32,32,32,32,32,32,32,32,32,32,124,32,80,114,111,103,114,101,115,115,32,124,0,124,32,32,32,32,32,32,32,32,32,32,32,124,32,32,32,32,86,97,114,115,32,32,67,108,97,117,115,101,115,32,76,105,116,101,114,97,108,115,32,124,32,32,32,32,76,105,109,105,116,32,32,67,108,97,117,115,101,115,32,76,105,116,47,67,108,32,124,32,32,32,32,32,32,32,32,32,32,124,0,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,97,115,121,109,109,0,0,0,83,104,114,105,110,107,32,99,108,97,117,115,101,115,32,98,121,32,97,115,121,109,109,101,116,114,105,99,32,98,114,97,110,99,104,105,110,103,46,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,114,99,104,101,99,107,0,0,67,104,101,99,107,32,105,102,32,97,32,99,108,97,117,115,101,32,105,115,32,97,108,114,101,97,100,121,32,105,109,112,108,105,101,100,46,32,40,99,111,115,116,108,121,41,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,101,108,105,109,0,0,0,0,80,101,114,102,111,114,109,32,118,97,114,105,97,98,108,101,32,101,108,105,109,105,110,97,116,105,111,110,46,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,103,114,111,119,0,0,0,0,65,108,108,111,119,32,97,32,118,97,114,105,97,98,108,101,32,101,108,105,109,105,110,97,116,105,111,110,32,115,116,101,112,32,116,111,32,103,114,111,119,32,98,121,32,97,32,110,117,109,98,101,114,32,111,102,32,99,108,97,117,115,101,115,46,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,99,108,45,108,105,109,0,0,86,97,114,105,97,98,108,101,115,32,97,114,101,32,110,111,116,32,101,108,105,109,105,110,97,116,101,100,32,105,102,32,105,116,32,112,114,111,100,117,99,101,115,32,97,32,114,101,115,111,108,118,101,110,116,32,119,105,116,104,32,97,32,108,101,110,103,116,104,32,97,98,111,118,101,32,116,104,105,115,32,108,105,109,105,116,46,32,45,49,32,109,101,97,110,115,32,110,111,32,108,105,109,105,116,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,115,117,98,45,108,105,109,0,68,111,32,110,111,116,32,99,104,101,99,107,32,105,102,32,115,117,98,115,117,109,112,116,105,111,110,32,97,103,97,105,110,115,116,32,97,32,99,108,97,117,115,101,32,108,97,114,103,101,114,32,116,104,97,110,32,116,104,105,115,46,32,45,49,32,109,101,97,110,115,32,110,111,32,108,105,109,105,116,46,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,115,105,109,112,45,103,99,45,102,114,97,99,0,0,0,0,84,104,101,32,102,114,97,99,116,105,111,110,32,111,102,32,119,97,115,116,101,100,32,109,101,109,111,114,121,32,97,108,108,111,119,101,100,32,98,101,102,111,114,101,32,97,32,103,97,114,98,97,103,101,32,99,111,108,108,101,99,116,105,111,110,32,105,115,32,116,114,105,103,103,101,114,101,100,32,100,117,114,105,110,103,32,115,105,109,112,108,105,102,105,99,97,116,105,111,110,46,0,0,0,0,0,0,0,120,14,0,0,9,0,0,0,10,0,0,0,11,0,0,0,0,0,0,0,115,117,98,115,117,109,112,116,105,111,110,32,108,101,102,116,58,32,37,49,48,100,32,40,37,49,48,100,32,115,117,98,115,117,109,101,100,44,32,37,49,48,100,32,100,101,108,101,116,101,100,32,108,105,116,101,114,97,108,115,41,13,0,0,101,108,105,109,105,110,97,116,105,111,110,32,108,101,102,116,58,32,37,49,48,100,13,0,124,32,32,69,108,105,109,105,110,97,116,101,100,32,99,108,97,117,115,101,115,58,32,32,32,32,32,37,49,48,46,50,102,32,77,98,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,124,10,0,0,0,0,124,32,32,71,97,114,98,97,103,101,32,99,111,108,108,101,99,116,105,111,110,58,32,32,32,37,49,50,100,32,98,121,116,101,115,32,61,62,32,37,49,50,100,32,98,121,116,101,115,32,32,32,32,32,32,32,32,32,32,32,32,32,124,10,0,0,0,0,0,0,0,0,78,55,77,105,110,105,115,97,116,49,48,83,105,109,112,83,111,108,118,101,114,69,0,0,128,18,0,0,96,14,0,0,192,7,0,0,0,0,0,0,60,100,111,117,98,108,101,62,0,0,0,0,0,0,0,0,60,105,110,116,51,50,62,0,83,73,77,80,0,0,0,0,60,98,111,111,108,62,0,0,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,89,79,33,0,0,0,0,0,2,0,0,0,0,0,0,0,48,15,0,0,0,0,0,0,117,110,99,97,117,103,104,116,0,0,0,0,0,0,0,0,116,101,114,109,105,110,97,116,105,110,103,32,119,105,116,104,32,37,115,32,101,120,99,101,112,116,105,111,110,32,111,102,32,116,121,112,101,32,37,115,58,32,37,115,0,0,0,0,116,101,114,109,105,110,97,116,105,110,103,32,119,105,116,104,32,37,115,32,101,120,99,101,112,116,105,111,110,32,111,102,32,116,121,112,101,32,37,115,0,0,0,0,0,0,0,0,116,101,114,109,105,110,97,116,105,110,103,32,119,105,116,104,32,37,115,32,102,111,114,101,105,103,110,32,101,120,99,101,112,116,105,111,110,0,0,0,116,101,114,109,105,110,97,116,105,110,103,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,112,116,104,114,101,97,100,95,111,110,99,101,32,102,97,105,108,117,114,101,32,105,110,32,95,95,99,120,97,95,103,101,116,95,103,108,111,98,97,108,115,95,102,97,115,116,40,41,0,0,0,0,0,0,0,0,99,97,110,110,111,116,32,99,114,101,97,116,101,32,112,116,104,114,101,97,100,32,107,101,121,32,102,111,114,32,95,95,99,120,97,95,103,101,116,95,103,108,111,98,97,108,115,40,41,0,0,0,0,0,0,0,99,97,110,110,111,116,32,122,101,114,111,32,111,117,116,32,116,104,114,101,97,100,32,118,97,108,117,101,32,102,111,114,32,95,95,99,120,97,95,103,101,116,95,103,108,111,98,97,108,115,40,41,0,0,0,0,0,0,0,0,200,16,0,0,12,0,0,0,13,0,0,0,1,0,0,0,0,0,0,0,115,116,100,58,58,98,97,100,95,97,108,108,111,99,0,0,83,116,57,98,97,100,95,97,108,108,111,99,0,0,0,0,128,18,0,0,184,16,0,0,80,17,0,0,0,0,0,0,116,101,114,109,105,110,97,116,101,95,104,97,110,100,108,101,114,32,117,110,101,120,112,101,99,116,101,100,108,121,32,114,101,116,117,114,110,101,100,0,116,101,114,109,105,110,97,116,101,95,104,97,110,100,108,101,114,32,117,110,101,120,112,101,99,116,101,100,108,121,32,116,104,114,101,119,32,97,110,32,101,120,99,101,112,116,105,111,110,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,83,116,57,101,120,99,101,112,116,105,111,110,0,0,0,0,88,18,0,0,64,17,0,0,83,116,57,116,121,112,101,95,105,110,102,111,0,0,0,0,88,18,0,0,88,17,0,0,78,49,48,95,95,99,120,120,97,98,105,118,49,49,54,95,95,115,104,105,109,95,116,121,112,101,95,105,110,102,111,69,0,0,0,0,0,0,0,0,128,18,0,0,112,17,0,0,104,17,0,0,0,0,0,0,78,49,48,95,95,99,120,120,97,98,105,118,49,49,55,95,95,99,108,97,115,115,95,116,121,112,101,95,105,110,102,111,69,0,0,0,0,0,0,0,128,18,0,0,168,17,0,0,152,17,0,0,0,0,0,0,78,49,48,95,95,99,120,120,97,98,105,118,49,49,57,95,95,112,111,105,110,116,101,114,95,116,121,112,101,95,105,110,102,111,69,0,0,0,0,0,78,49,48,95,95,99,120,120,97,98,105,118,49,49,55,95,95,112,98,97,115,101,95,116,121,112,101,95,105,110,102,111,69,0,0,0,0,0,0,0,128,18,0,0,8,18,0,0,152,17,0,0,0,0,0,0,128,18,0,0,224,17,0,0,48,18,0,0,0,0,0,0,0,0,0,0,208,17,0,0,14,0,0,0,15,0,0,0,16,0,0,0,17,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,200,18,0,0,14,0,0,0,18,0,0,0,16,0,0,0,17,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,78,49,48,95,95,99,120,120,97,98,105,118,49,50,48,95,95,115,105,95,99,108,97,115,115,95,116,121,112,101,95,105,110,102,111,69,0,0,0,0,128,18,0,0,160,18,0,0,208,17,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,1,2,3,4,5,6,7,8,9,255,255,255,255,255,255,255,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,255,255,255,255,255,255,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0,0,0,0,0,0,0,1,2,4,7,3,6,5,0,0,0,0,0,0,0,0,105,110,102,105,110,105,116,121,0,0,0,0,0,0,0,0,110,97,110,0,0,0,0,0,95,112,137,0,255,9,47,15,10,0,0,0,100,0,0,0,232,3,0,0,16,39,0,0,160,134,1,0,64,66,15,0,128,150,152,0,0,225,245,5],"i8",ALLOC_NONE,Runtime.GLOBAL_BASE);var tempDoublePtr=Runtime.alignMemory(allocate(12,"i8",ALLOC_STATIC),8);assert(tempDoublePtr%8==0);function _atexit(o,e){__ATEXIT__.unshift({func:o,arg:e})}function ___cxa_atexit(){return _atexit.apply(null,arguments)}Module._i64Subtract=_i64Subtract;var ___errno_state=0;function ___setErrNo(o){return HEAP32[___errno_state>>2]=o,o}var ERRNO_CODES={EPERM:1,ENOENT:2,ESRCH:3,EINTR:4,EIO:5,ENXIO:6,E2BIG:7,ENOEXEC:8,EBADF:9,ECHILD:10,EAGAIN:11,EWOULDBLOCK:11,ENOMEM:12,EACCES:13,EFAULT:14,ENOTBLK:15,EBUSY:16,EEXIST:17,EXDEV:18,ENODEV:19,ENOTDIR:20,EISDIR:21,EINVAL:22,ENFILE:23,EMFILE:24,ENOTTY:25,ETXTBSY:26,EFBIG:27,ENOSPC:28,ESPIPE:29,EROFS:30,EMLINK:31,EPIPE:32,EDOM:33,ERANGE:34,ENOMSG:42,EIDRM:43,ECHRNG:44,EL2NSYNC:45,EL3HLT:46,EL3RST:47,ELNRNG:48,EUNATCH:49,ENOCSI:50,EL2HLT:51,EDEADLK:35,ENOLCK:37,EBADE:52,EBADR:53,EXFULL:54,ENOANO:55,EBADRQC:56,EBADSLT:57,EDEADLOCK:35,EBFONT:59,ENOSTR:60,ENODATA:61,ETIME:62,ENOSR:63,ENONET:64,ENOPKG:65,EREMOTE:66,ENOLINK:67,EADV:68,ESRMNT:69,ECOMM:70,EPROTO:71,EMULTIHOP:72,EDOTDOT:73,EBADMSG:74,ENOTUNIQ:76,EBADFD:77,EREMCHG:78,ELIBACC:79,ELIBBAD:80,ELIBSCN:81,ELIBMAX:82,ELIBEXEC:83,ENOSYS:38,ENOTEMPTY:39,ENAMETOOLONG:36,ELOOP:40,EOPNOTSUPP:95,EPFNOSUPPORT:96,ECONNRESET:104,ENOBUFS:105,EAFNOSUPPORT:97,EPROTOTYPE:91,ENOTSOCK:88,ENOPROTOOPT:92,ESHUTDOWN:108,ECONNREFUSED:111,EADDRINUSE:98,ECONNABORTED:103,ENETUNREACH:101,ENETDOWN:100,ETIMEDOUT:110,EHOSTDOWN:112,EHOSTUNREACH:113,EINPROGRESS:115,EALREADY:114,EDESTADDRREQ:89,EMSGSIZE:90,EPROTONOSUPPORT:93,ESOCKTNOSUPPORT:94,EADDRNOTAVAIL:99,ENETRESET:102,EISCONN:106,ENOTCONN:107,ETOOMANYREFS:109,EUSERS:87,EDQUOT:122,ESTALE:116,ENOTSUP:95,ENOMEDIUM:123,EILSEQ:84,EOVERFLOW:75,ECANCELED:125,ENOTRECOVERABLE:131,EOWNERDEAD:130,ESTRPIPE:86};function _sysconf(o){switch(o){case 30:return PAGE_SIZE;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 80:case 81:case 79:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:return 200809;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 75:return 16384;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:return typeof navigator=="object"&&navigator.hardwareConcurrency||1}return ___setErrNo(ERRNO_CODES.EINVAL),-1}function __ZSt18uncaught_exceptionv(){return!!__ZSt18uncaught_exceptionv.uncaught_exception}var EXCEPTIONS={last:0,caught:[],infos:{},deAdjust:function(o){if(!o||EXCEPTIONS.infos[o])return o;for(var e in EXCEPTIONS.infos){var t=EXCEPTIONS.infos[e];if(t.adjusted===o)return e}return o},addRef:function(o){if(o){var e=EXCEPTIONS.infos[o];e.refcount++}},decRef:function(o){if(o){var e=EXCEPTIONS.infos[o];assert(e.refcount>0),e.refcount--,e.refcount===0&&(e.destructor&&Runtime.dynCall("vi",e.destructor,[o]),delete EXCEPTIONS.infos[o],___cxa_free_exception(o))}},clearRef:function(o){if(o){var e=EXCEPTIONS.infos[o];e.refcount=0}}};function ___resumeException(o){throw EXCEPTIONS.last||(EXCEPTIONS.last=o),EXCEPTIONS.clearRef(EXCEPTIONS.deAdjust(o)),o+" - Exception catching is disabled, this exception cannot be caught. Compile with -s DISABLE_EXCEPTION_CATCHING=0 or DISABLE_EXCEPTION_CATCHING=2 to catch."}function ___cxa_find_matching_catch(){var o=EXCEPTIONS.last;if(!o)return asm.setTempRet0(0),0|0;var e=EXCEPTIONS.infos[o],t=e.type;if(!t)return asm.setTempRet0(0),o|0;var n=Array.prototype.slice.call(arguments);Module.___cxa_is_pointer_type(t),___cxa_find_matching_catch.buffer||(___cxa_find_matching_catch.buffer=_malloc(4)),HEAP32[___cxa_find_matching_catch.buffer>>2]=o,o=___cxa_find_matching_catch.buffer;for(var r=0;r<n.length;r++)if(n[r]&&Module.___cxa_can_catch(n[r],t,o))return o=HEAP32[o>>2],e.adjusted=o,asm.setTempRet0(n[r]),o|0;return o=HEAP32[o>>2],asm.setTempRet0(t),o|0}function ___cxa_throw(o,e,t){throw EXCEPTIONS.infos[o]={ptr:o,adjusted:o,type:e,destructor:t,refcount:0},EXCEPTIONS.last=o,"uncaught_exception"in __ZSt18uncaught_exceptionv?__ZSt18uncaught_exceptionv.uncaught_exception++:__ZSt18uncaught_exceptionv.uncaught_exception=1,o+" - Exception catching is disabled, this exception cannot be caught. Compile with -s DISABLE_EXCEPTION_CATCHING=0 or DISABLE_EXCEPTION_CATCHING=2 to catch."}Module._memset=_memset,Module._bitshift64Shl=_bitshift64Shl;function _abort(){Module.abort()}var FS=void 0,SOCKFS=void 0;function _send(o,e,t,n){var r=SOCKFS.getSocket(o);return r?_write(o,e,t):(___setErrNo(ERRNO_CODES.EBADF),-1)}function _pwrite(o,e,t,n){var r=FS.getStream(o);if(!r)return ___setErrNo(ERRNO_CODES.EBADF),-1;try{var s=HEAP8;return FS.write(r,s,e,t,n)}catch(a){return FS.handleFSError(a),-1}}function _write(o,e,t){var n=FS.getStream(o);if(!n)return ___setErrNo(ERRNO_CODES.EBADF),-1;try{var r=HEAP8;return FS.write(n,r,e,t)}catch(s){return FS.handleFSError(s),-1}}function _fileno(o){return o=FS.getStreamFromPtr(o),o?o.fd:-1}function _fwrite(o,e,t,n){var r=t*e;if(r==0)return 0;var s=_fileno(n),a=_write(s,o,r);if(a==-1){var h=FS.getStreamFromPtr(n);return h&&(h.error=!0),0}else return a/e|0}Module._strlen=_strlen;function __reallyNegative(o){return o<0||o===0&&1/o===-1/0}function __formatString(o,e){var t=o,n=0;function r(Qe){var Be;return Qe==="double"?Be=(HEAP32[tempDoublePtr>>2]=HEAP32[e+n>>2],HEAP32[tempDoublePtr+4>>2]=HEAP32[e+(n+4)>>2],+HEAPF64[tempDoublePtr>>3]):Qe=="i64"?Be=[HEAP32[e+n>>2],HEAP32[e+(n+4)>>2]]:(Qe="i32",Be=HEAP32[e+n>>2]),n+=Runtime.getNativeFieldSize(Qe),Be}for(var s=[],a,h,c;;){var d=t;if(a=HEAP8[t>>0],a===0)break;if(h=HEAP8[t+1>>0],a==37){var y=!1,g=!1,D=!1,O=!1,V=!1;e:for(;;){switch(h){case 43:y=!0;break;case 45:g=!0;break;case 35:D=!0;break;case 48:if(O)break e;O=!0;break;case 32:V=!0;break;default:break e}t++,h=HEAP8[t+1>>0]}var k=0;if(h==42)k=r("i32"),t++,h=HEAP8[t+1>>0];else for(;h>=48&&h<=57;)k=k*10+(h-48),t++,h=HEAP8[t+1>>0];var M=!1,N=-1;if(h==46){if(N=0,M=!0,t++,h=HEAP8[t+1>>0],h==42)N=r("i32"),t++;else for(;;){var F=HEAP8[t+1>>0];if(F<48||F>57)break;N=N*10+(F-48),t++}h=HEAP8[t+1>>0]}N<0&&(N=6,M=!1);var G;switch(String.fromCharCode(h)){case"h":var ie=HEAP8[t+2>>0];ie==104?(t++,G=1):G=2;break;case"l":var ie=HEAP8[t+2>>0];ie==108?(t++,G=8):G=4;break;case"L":case"q":case"j":G=8;break;case"z":case"t":case"I":G=4;break;default:G=null}switch(G&&t++,h=HEAP8[t+1>>0],String.fromCharCode(h)){case"d":case"i":case"u":case"o":case"x":case"X":case"p":{var Z=h==100||h==105;G=G||4;var c=r("i"+G*8),W=c,X;if(G==8&&(c=Runtime.makeBigInt(c[0],c[1],h==117)),G<=4){var J=Math.pow(256,G)-1;c=(Z?reSign:unSign)(c&J,G*8)}var oe=Math.abs(c),le="";if(h==100||h==105)G==8&&i64Math?X=i64Math.stringify(W[0],W[1],null):X=reSign(c,8*G).toString(10);else if(h==117)G==8&&i64Math?X=i64Math.stringify(W[0],W[1],!0):X=unSign(c,8*G).toString(10),c=Math.abs(c);else if(h==111)X=(D?"0":"")+oe.toString(8);else if(h==120||h==88){if(le=D&&c!=0?"0x":"",G==8&&i64Math)if(W[1]){X=(W[1]>>>0).toString(16);for(var pe=(W[0]>>>0).toString(16);pe.length<8;)pe="0"+pe;X+=pe}else X=(W[0]>>>0).toString(16);else if(c<0){c=-c,X=(oe-1).toString(16);for(var ve=[],Oe=0;Oe<X.length;Oe++)ve.push((15-parseInt(X[Oe],16)).toString(16));for(X=ve.join("");X.length<G*2;)X="f"+X}else X=oe.toString(16);h==88&&(le=le.toUpperCase(),X=X.toUpperCase())}else h==112&&(oe===0?X="(nil)":(le="0x",X=oe.toString(16)));if(M)for(;X.length<N;)X="0"+X;for(c>=0&&(y?le="+"+le:V&&(le=" "+le)),X.charAt(0)=="-"&&(le="-"+le,X=X.substr(1));le.length+X.length<k;)g?X+=" ":O?X="0"+X:le=" "+le;X=le+X,X.split("").forEach(function(Be){s.push(Be.charCodeAt(0))});break}case"f":case"F":case"e":case"E":case"g":case"G":{var c=r("double"),X;if(isNaN(c))X="nan",O=!1;else if(!isFinite(c))X=(c<0?"-":"")+"inf",O=!1;else{var He=!1,Ue=Math.min(N,20);if(h==103||h==71){He=!0,N=N||1;var Le=parseInt(c.toExponential(Ue).split("e")[1],10);N>Le&&Le>=-4?(h=(h==103?"f":"F").charCodeAt(0),N-=Le+1):(h=(h==103?"e":"E").charCodeAt(0),N--),Ue=Math.min(N,20)}h==101||h==69?(X=c.toExponential(Ue),/[eE][-+]\d$/.test(X)&&(X=X.slice(0,-1)+"0"+X.slice(-1))):(h==102||h==70)&&(X=c.toFixed(Ue),c===0&&__reallyNegative(c)&&(X="-"+X));var Ae=X.split("e");if(He&&!D)for(;Ae[0].length>1&&Ae[0].indexOf(".")!=-1&&(Ae[0].slice(-1)=="0"||Ae[0].slice(-1)==".");)Ae[0]=Ae[0].slice(0,-1);else for(D&&X.indexOf(".")==-1&&(Ae[0]+=".");N>Ue++;)Ae[0]+="0";X=Ae[0]+(Ae.length>1?"e"+Ae[1]:""),h==69&&(X=X.toUpperCase()),c>=0&&(y?X="+"+X:V&&(X=" "+X))}for(;X.length<k;)g?X+=" ":O&&(X[0]=="-"||X[0]=="+")?X=X[0]+"0"+X.slice(1):X=(O?"0":" ")+X;h<97&&(X=X.toUpperCase()),X.split("").forEach(function(We){s.push(We.charCodeAt(0))});break}case"s":{var ae=r("i8*"),Ie=ae?_strlen(ae):6;if(M&&(Ie=Math.min(Ie,N)),!g)for(;Ie<k--;)s.push(32);if(ae)for(var Oe=0;Oe<Ie;Oe++)s.push(HEAPU8[ae++>>0]);else s=s.concat(intArrayFromString("(null)".substr(0,Ie),!0));if(g)for(;Ie<k--;)s.push(32);break}case"c":{for(g&&s.push(r("i8"));--k>0;)s.push(32);g||s.push(r("i8"));break}case"n":{var nt=r("i32*");HEAP32[nt>>2]=s.length;break}case"%":{s.push(a);break}default:for(var Oe=d;Oe<t+2;Oe++)s.push(HEAP8[Oe>>0])}t+=2}else s.push(a),t+=1}return s}function _fprintf(o,e,t){var n=__formatString(e,t),r=Runtime.stackSave(),s=_fwrite(allocate(n,"i8",ALLOC_STACK),1,n.length,o);return Runtime.stackRestore(r),s}function _printf(o,e){var t=__formatString(o,e),n=intArrayToString(t);return n[n.length-1]===`
`&&(n=n.substr(0,n.length-1)),Module.print(n),t.length}function _pthread_once(o,e){_pthread_once.seen||(_pthread_once.seen={}),!(o in _pthread_once.seen)&&(Runtime.dynCall("v",e),_pthread_once.seen[o]=1)}function _fputc(o,e){var t=unSign(o&255);HEAP8[_fputc.ret>>0]=t;var n=_fileno(e),r=_write(n,_fputc.ret,1);if(r==-1){var s=FS.getStreamFromPtr(e);return s&&(s.error=!0),-1}else return t}var PTHREAD_SPECIFIC={};function _pthread_getspecific(o){return PTHREAD_SPECIFIC[o]||0}Module._i64Add=_i64Add;function _fputs(o,e){var t=_fileno(e);return _write(t,o,_strlen(o))}allocate(1,"i32*",ALLOC_STATIC);function _puts(o){var e=Pointer_stringify(o),t=e.substr(0);return t[t.length-1]===`
`&&(t=t.substr(0,t.length-1)),Module.print(t),e.length}function _pthread_setspecific(o,e){return o in PTHREAD_SPECIFIC?(PTHREAD_SPECIFIC[o]=e,0):ERRNO_CODES.EINVAL}function __exit(o){Module.exit(o)}function _exit(o){__exit(o)}function _malloc(o){var e=Runtime.dynamicAlloc(o+8);return e+8&4294967288}Module._malloc=_malloc;function ___cxa_allocate_exception(o){return _malloc(o)}function _fmod(o,e){return o%e}function _fmodl(){return _fmod.apply(null,arguments)}Module._bitshift64Lshr=_bitshift64Lshr;function ___cxa_pure_virtual(){throw ABORT=!0,"Pure virtual function called!"}function _time(o){var e=Date.now()/1e3|0;return o&&(HEAP32[o>>2]=e),e}var PTHREAD_SPECIFIC_NEXT_KEY=1;function _pthread_key_create(o,e){return o==0?ERRNO_CODES.EINVAL:(HEAP32[o>>2]=PTHREAD_SPECIFIC_NEXT_KEY,PTHREAD_SPECIFIC[PTHREAD_SPECIFIC_NEXT_KEY]=0,PTHREAD_SPECIFIC_NEXT_KEY++,0)}function ___cxa_guard_acquire(o){return HEAP8[o>>0]?0:(HEAP8[o>>0]=1,1)}function ___cxa_guard_release(){}function _vfprintf(o,e,t){return _fprintf(o,e,HEAP32[t>>2])}function ___cxa_begin_catch(o){return __ZSt18uncaught_exceptionv.uncaught_exception--,EXCEPTIONS.caught.push(o),EXCEPTIONS.addRef(EXCEPTIONS.deAdjust(o)),o}function _emscripten_memcpy_big(o,e,t){return HEAPU8.set(HEAPU8.subarray(e,e+t),o),o}Module._memcpy=_memcpy;var _llvm_pow_f64=Math_pow;function _sbrk(o){var e=_sbrk;e.called||(DYNAMICTOP=alignMemoryPage(DYNAMICTOP),e.called=!0,assert(Runtime.dynamicAlloc),e.alloc=Runtime.dynamicAlloc,Runtime.dynamicAlloc=function(){abort("cannot dynamically allocate, sbrk now has control")});var t=DYNAMICTOP;return o!=0&&e.alloc(o),t}var _fabs=Math_abs;function ___errno_location(){return ___errno_state}function _copysign(o,e){return __reallyNegative(o)===__reallyNegative(e)?o:-o}function _copysignl(){return _copysign.apply(null,arguments)}var ___dso_handle=allocate(1,"i32*",ALLOC_STATIC),_stderr=allocate(1,"i32*",ALLOC_STATIC);___errno_state=Runtime.staticAlloc(4),HEAP32[___errno_state>>2]=0,_fputc.ret=allocate([0],"i8",ALLOC_STATIC),STACK_BASE=STACKTOP=Runtime.alignMemory(STATICTOP),STACK_MAX=STACK_BASE+TOTAL_STACK,DYNAMIC_BASE=DYNAMICTOP=Runtime.alignMemory(STACK_MAX),assert(DYNAMIC_BASE<TOTAL_MEMORY,"TOTAL_MEMORY not big enough for stack");var ctlz_i8=allocate([8,7,6,6,5,5,5,5,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"i8",ALLOC_DYNAMIC),cttz_i8=allocate([8,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,6,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,7,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,6,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0],"i8",ALLOC_DYNAMIC);function invoke_iiii(o,e,t,n){try{return Module.dynCall_iiii(o,e,t,n)}catch(r){if(typeof r!="number"&&r!=="longjmp")throw r;asm.setThrew(1,0)}}function invoke_viiiii(o,e,t,n,r,s){try{Module.dynCall_viiiii(o,e,t,n,r,s)}catch(a){if(typeof a!="number"&&a!=="longjmp")throw a;asm.setThrew(1,0)}}function invoke_vi(o,e){try{Module.dynCall_vi(o,e)}catch(t){if(typeof t!="number"&&t!=="longjmp")throw t;asm.setThrew(1,0)}}function invoke_vii(o,e,t){try{Module.dynCall_vii(o,e,t)}catch(n){if(typeof n!="number"&&n!=="longjmp")throw n;asm.setThrew(1,0)}}function invoke_ii(o,e){try{return Module.dynCall_ii(o,e)}catch(t){if(typeof t!="number"&&t!=="longjmp")throw t;asm.setThrew(1,0)}}function invoke_v(o){try{Module.dynCall_v(o)}catch(e){if(typeof e!="number"&&e!=="longjmp")throw e;asm.setThrew(1,0)}}function invoke_viiiiii(o,e,t,n,r,s,a){try{Module.dynCall_viiiiii(o,e,t,n,r,s,a)}catch(h){if(typeof h!="number"&&h!=="longjmp")throw h;asm.setThrew(1,0)}}function invoke_iii(o,e,t){try{return Module.dynCall_iii(o,e,t)}catch(n){if(typeof n!="number"&&n!=="longjmp")throw n;asm.setThrew(1,0)}}function invoke_viiii(o,e,t,n,r){try{Module.dynCall_viiii(o,e,t,n,r)}catch(s){if(typeof s!="number"&&s!=="longjmp")throw s;asm.setThrew(1,0)}}Module.asmGlobalArg={Math,Int8Array,Int16Array,Int32Array,Uint8Array,Uint16Array,Uint32Array,Float32Array,Float64Array},Module.asmLibraryArg={abort,assert,min:Math_min,invoke_iiii,invoke_viiiii,invoke_vi,invoke_vii,invoke_ii,invoke_v,invoke_viiiiii,invoke_iii,invoke_viiii,_fabs,_llvm_pow_f64,_send,_fmod,___cxa_guard_acquire,___setErrNo,_vfprintf,___cxa_allocate_exception,___cxa_find_matching_catch,___cxa_guard_release,_pwrite,__reallyNegative,_sbrk,___cxa_begin_catch,_emscripten_memcpy_big,_fileno,___resumeException,__ZSt18uncaught_exceptionv,_sysconf,_pthread_getspecific,_atexit,_pthread_once,_puts,_printf,_pthread_key_create,_write,___errno_location,_pthread_setspecific,___cxa_atexit,_copysign,_fputc,___cxa_throw,__exit,_copysignl,_abort,_fwrite,_time,_fprintf,__formatString,_fputs,_exit,___cxa_pure_virtual,_fmodl,STACKTOP,STACK_MAX,tempDoublePtr,ABORT,cttz_i8,ctlz_i8,NaN:NaN,Infinity:1/0,___dso_handle,_stderr};var asm=function(o,e,t){var n=new o.Int8Array(t),r=new o.Int16Array(t),s=new o.Int32Array(t),a=new o.Uint8Array(t),h=new o.Uint16Array(t),c=new o.Uint32Array(t),d=new o.Float32Array(t),y=new o.Float64Array(t),g=e.STACKTOP|0,D=e.STACK_MAX|0,O=e.tempDoublePtr|0,V=e.ABORT|0,k=e.cttz_i8|0,M=e.ctlz_i8|0,N=e.___dso_handle|0,F=e._stderr|0,G=0,ie=0,Z=0,W=0,X=+e.NaN,J=+e.Infinity,oe=0,le=0,pe=0,ve=0,Oe=0,He=0,Ue=0,Le=0,Ae=0,ae=0,Ie=0,nt=0,Qe=0,Be=0,We=0,ft=0,mt=0,bt=0,Et=0,wt=o.Math.floor,vt=o.Math.abs,Ut=o.Math.sqrt,Ne=o.Math.pow,Pi=o.Math.cos,$t=o.Math.sin,Ft=o.Math.tan,$i=o.Math.acos,T=o.Math.asin,K=o.Math.atan,j=o.Math.atan2,ee=o.Math.exp,re=o.Math.log,q=o.Math.ceil,H=o.Math.imul,z=e.abort,fe=e.assert,we=e.min,Pe=e.invoke_iiii,ke=e.invoke_viiiii,$e=e.invoke_vi,lt=e.invoke_vii,et=e.invoke_ii,pt=e.invoke_v,St=e.invoke_viiiiii,Mt=e.invoke_iii,Is=e.invoke_viiii,Gi=e._fabs,_i=e._llvm_pow_f64,zi=e._send,li=e._fmod,Wi=e.___cxa_guard_acquire,Va=e.___setErrNo,fr=e._vfprintf,Ge=e.___cxa_allocate_exception,ka=e.___cxa_find_matching_catch,mr=e.___cxa_guard_release,Ma=e._pwrite,Ra=e.__reallyNegative,Ei=e._sbrk,yr=e.___cxa_begin_catch,br=e._emscripten_memcpy_big,Na=e._fileno,Ba=e.___resumeException,Fa=e.__ZSt18uncaught_exceptionv,Sr=e._sysconf,Lr=e._pthread_getspecific,qa=e._atexit,Ar=e._pthread_once,Ti=e._puts,Vi=e._printf,vr=e._pthread_key_create,Ha=e._write,Xe=e.___errno_location,Pr=e._pthread_setspecific,_r=e.___cxa_atexit,Ua=e._copysign,Yi=e._fputc,ze=e.___cxa_throw,$a=e.__exit,vn=e._copysignl,ye=e._abort,Xs=e._fwrite,Er=e._time,Rt=e._fprintf,Ga=e.__formatString,za=e._fputs,Os=e._exit,Tr=e.___cxa_pure_virtual,Pn=e._fmodl,Wa=0;function wr(l){l=l|0;var u=0;return u=g,g=g+l|0,g=g+15&-16,u|0}function Cr(){return g|0}function Dr(l){l=l|0,g=l}function Ir(l,u){l=l|0,u=u|0,G||(G=l,ie=u)}function Ya(l){l=l|0,n[O>>0]=n[l>>0],n[O+1>>0]=n[l+1>>0],n[O+2>>0]=n[l+2>>0],n[O+3>>0]=n[l+3>>0]}function Ka(l){l=l|0,n[O>>0]=n[l>>0],n[O+1>>0]=n[l+1>>0],n[O+2>>0]=n[l+2>>0],n[O+3>>0]=n[l+3>>0],n[O+4>>0]=n[l+4>>0],n[O+5>>0]=n[l+5>>0],n[O+6>>0]=n[l+6>>0],n[O+7>>0]=n[l+7>>0]}function Or(l){l=l|0,ae=l}function xr(){return ae|0}function Xa(l){l=l|0,yr(l|0)|0,Bo()}function Vr(l){l=l|0}function At(l,u,m,f,S){l=l|0,u=u|0,m=m|0,f=f|0,S=S|0;var L=0;if(L=g,s[l>>2]=112,s[l+4>>2]=u,s[l+8>>2]=m,s[l+12>>2]=f,s[l+16>>2]=S,!(n[144]|0)&&Wi(144)|0&&(s[32]=0,s[33]=0,s[34]=0,_r(19,128,N|0)|0,mr(144)),S=s[33]|0,(S|0)==(s[34]|0)&&(f=(S>>1)+2&-2,f=(f|0)<2?2:f,(f|0)>(2147483647-S|0)&&(u=Ge(1)|0,ze(u|0,48,0)),m=s[32]|0,u=f+S|0,s[34]=u,u=ht(m,u<<2)|0,s[32]=u,!(u|0)&&(s[(Xe()|0)>>2]|0)==12&&(u=Ge(1)|0,ze(u|0,48,0)),S=s[33]|0),s[33]=S+1,S=(s[32]|0)+(S<<2)|0,!S){g=L;return}s[S>>2]=l,g=L}function kr(l){l=l|0;var u=0;u=g,ci(l),g=u}function Mr(l){l=l|0;var u=0,m=0;if(u=g,m=s[l>>2]|0,!m){g=u;return}s[l+4>>2]=0,Me(m),s[l>>2]=0,s[l+8>>2]=0,g=u}function Rr(l){l=l|0;var u=0;u=g,ci(l),g=u}function Nr(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0;if(m=g,(n[u>>0]|0)!=45)return P=0,g=m,P|0;for(f=u+1|0,S=110,b=f,P=0;;){if(L=P+1|0,(n[b>>0]|0)!=S<<24>>24){S=1;break}if(b=u+(P+2)|0,(L|0)==3){S=0,f=b;break}else S=n[264+L>>0]|0,P=L}return ha(f,s[l+4>>2]|0)|0?(P=0,g=m,P|0):(n[l+20>>0]=S,P=1,g=m,P|0)}function Br(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0;for(L=g,g=g+16|0,m=L,f=s[F>>2]|0,S=l+4|0,b=s[S>>2]|0,s[m>>2]=b,s[m+4>>2]=b,Rt(f|0,216,m|0)|0,b=0;P=b>>>0<(32-((jn(s[S>>2]|0)|0)<<1)|0)>>>0,Yi(32,f|0)|0,P;)b=b+1|0;if(s[m>>2]=n[l+20>>0]|0?248:256,Rt(f|0,232,m|0)|0,!u){g=L;return}s[m>>2]=s[l+8>>2],Rt(f|0,88,m|0)|0,Yi(10,f|0)|0,g=L}function Fr(l){l=l|0;var u=0;u=g,ci(l),g=u}function qr(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0;if(m=g,g=g+16|0,L=m,S=m+8|0,(n[u>>0]|0)!=45)return E=0,g=m,E|0;w=u+1|0,f=l+4|0,b=s[f>>2]|0,P=n[b>>0]|0;e:do if(P<<24>>24){for(A=0;;){if(E=A,A=A+1|0,(n[w>>0]|0)!=P<<24>>24){l=0;break}if(P=n[b+A>>0]|0,w=u+(E+2)|0,!(P<<24>>24))break e}return g=m,l|0}while(!1);return(n[w>>0]|0)!=61||(u=w+1|0,b=la(u,S,10)|0,!(s[S>>2]|0))?(E=0,g=m,E|0):((b|0)>(s[l+24>>2]|0)&&(E=s[F>>2]|0,A=s[f>>2]|0,s[L>>2]=u,s[L+4>>2]=A,Rt(E|0,416,L|0)|0,Os(1)),(b|0)<(s[l+20>>2]|0)&&(E=s[F>>2]|0,A=s[f>>2]|0,s[L>>2]=u,s[L+4>>2]=A,Rt(E|0,472,L|0)|0,Os(1)),s[l+28>>2]=b,E=1,g=m,E|0)}function Hr(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0;if(m=g,g=g+16|0,f=m,S=s[F>>2]|0,L=s[l+16>>2]|0,s[f>>2]=s[l+4>>2],s[f+4>>2]=L,Rt(S|0,336,f|0)|0,L=s[l+20>>2]|0,(L|0)==-2147483648?Xs(360,4,1,S|0)|0:(s[f>>2]=L,Rt(S|0,368,f|0)|0),Xs(376,4,1,S|0)|0,L=s[l+24>>2]|0,(L|0)==2147483647?Xs(384,4,1,S|0)|0:(s[f>>2]=L,Rt(S|0,368,f|0)|0),s[f>>2]=s[l+28>>2],Rt(S|0,392,f|0)|0,!u){g=m;return}s[f>>2]=s[l+8>>2],Rt(S|0,88,f|0)|0,Yi(10,S|0)|0,g=m}function Ur(l){l=l|0;var u=0,m=0,f=0,S=0,L=0;S=g,s[l>>2]=1816,f=l+4|0,m=l+32|0,L=l+48|0,s[f+0>>2]=0,s[f+4>>2]=0,s[f+8>>2]=0,s[f+12>>2]=0,s[f+16>>2]=0,s[f+20>>2]=0,s[m+0>>2]=0,s[m+4>>2]=0,s[m+8>>2]=0,s[m+12>>2]=0,y[L>>3]=+y[75],y[l+56>>3]=+y[89],y[l+64>>3]=+y[103],y[l+72>>3]=+y[123],n[l+80>>0]=n[1364]|0,s[l+84>>2]=s[269],s[l+88>>2]=s[297],n[l+92>>0]=0,n[l+93>>0]=n[1292]|0,y[l+96>>3]=+y[204],s[l+104>>2]=s[439],s[l+108>>2]=s[359],y[l+112>>3]=+y[191],y[l+120>>3]=.3333333333333333,y[l+128>>3]=1.1,s[l+136>>2]=100,y[l+144>>3]=1.5,L=l+316|0,s[l+332>>2]=0,s[l+336>>2]=0,s[l+340>>2]=0,s[l+348>>2]=0,s[l+352>>2]=0,s[l+356>>2]=0,s[l+364>>2]=0,s[l+368>>2]=0,s[l+372>>2]=0,s[l+380>>2]=0,s[l+384>>2]=0,s[l+388>>2]=0,s[l+396>>2]=0,s[l+400>>2]=0,s[l+404>>2]=0,m=l+544|0,s[l+412>>2]=0,s[l+416>>2]=0,s[l+420>>2]=0,s[l+428>>2]=0,s[l+432>>2]=0,s[l+436>>2]=0,s[l+444>>2]=0,s[l+448>>2]=0,s[l+452>>2]=0,Ms(l+152|0,0,176)|0,s[l+456>>2]=m,f=l+460|0,s[f+0>>2]=0,s[f+4>>2]=0,s[f+8>>2]=0,s[f+12>>2]=0,s[f+16>>2]=0,s[f+20>>2]=0,s[l+488>>2]=L,n[l+492>>0]=1,y[l+496>>3]=1,y[l+504>>3]=1,s[l+512>>2]=0,s[l+516>>2]=-1,L=l+520|0,f=l+536|0,s[L+0>>2]=0,s[L+4>>2]=0,s[L+8>>2]=0,s[L+12>>2]=0,n[f>>0]=1,f=l+540|0,s[f+0>>2]=0,s[f+4>>2]=0,s[f+8>>2]=0,s[f+12>>2]=0,s[f+16>>2]=0,Xi(m,1048576),n[l+560>>0]=0,m=l+604|0,f=l+664|0,L=l+564|0,u=L+36|0;do s[L>>2]=0,L=L+4|0;while((L|0)<(u|0));L=m+0|0,u=L+36|0;do s[L>>2]=0,L=L+4|0;while((L|0)<(u|0));L=l+680|0,s[f+0>>2]=-1,s[f+4>>2]=-1,s[f+8>>2]=-1,s[f+12>>2]=-1,n[L>>0]=0,g=S}function $r(l){l=l|0;var u=0;u=g,xs(l),ci(l),g=u}function xs(l){l=l|0;var u=0,m=0,f=0;if(u=g,s[l>>2]=1816,m=l+628|0,f=s[m>>2]|0,f&&(s[l+632>>2]=0,Me(f),s[m>>2]=0,s[l+636>>2]=0),m=l+616|0,f=s[m>>2]|0,f&&(s[l+620>>2]=0,Me(f),s[m>>2]=0,s[l+624>>2]=0),m=l+604|0,f=s[m>>2]|0,f&&(s[l+608>>2]=0,Me(f),s[m>>2]=0,s[l+612>>2]=0),m=l+588|0,f=s[m>>2]|0,f&&(s[l+592>>2]=0,Me(f),s[m>>2]=0,s[l+596>>2]=0),m=l+576|0,f=s[m>>2]|0,f&&(s[l+580>>2]=0,Me(f),s[m>>2]=0,s[l+584>>2]=0),m=l+564|0,f=s[m>>2]|0,f&&(s[l+568>>2]=0,Me(f),s[m>>2]=0,s[l+572>>2]=0),m=s[l+544>>2]|0,m&&Me(m),m=l+472|0,f=s[m>>2]|0,f&&(s[l+476>>2]=0,Me(f),s[m>>2]=0,s[l+480>>2]=0),m=l+460|0,f=s[m>>2]|0,f&&(s[l+464>>2]=0,Me(f),s[m>>2]=0,s[l+468>>2]=0),ro(l+412|0),m=l+396|0,f=s[m>>2]|0,f&&(s[l+400>>2]=0,Me(f),s[m>>2]=0,s[l+404>>2]=0),m=l+380|0,f=s[m>>2]|0,f&&(s[l+384>>2]=0,Me(f),s[m>>2]=0,s[l+388>>2]=0),f=l+364|0,m=s[f>>2]|0,m&&(s[l+368>>2]=0,Me(m),s[f>>2]=0,s[l+372>>2]=0),m=l+348|0,f=s[m>>2]|0,f&&(s[l+352>>2]=0,Me(f),s[m>>2]=0,s[l+356>>2]=0),m=l+332|0,f=s[m>>2]|0,f&&(s[l+336>>2]=0,Me(f),s[m>>2]=0,s[l+340>>2]=0),m=l+316|0,f=s[m>>2]|0,f&&(s[l+320>>2]=0,Me(f),s[m>>2]=0,s[l+324>>2]=0),m=l+304|0,f=s[m>>2]|0,f&&(s[l+308>>2]=0,Me(f),s[m>>2]=0,s[l+312>>2]=0),m=l+292|0,f=s[m>>2]|0,f&&(s[l+296>>2]=0,Me(f),s[m>>2]=0,s[l+300>>2]=0),m=l+280|0,f=s[m>>2]|0,f&&(s[l+284>>2]=0,Me(f),s[m>>2]=0,s[l+288>>2]=0),m=l+268|0,f=s[m>>2]|0,f&&(s[l+272>>2]=0,Me(f),s[m>>2]=0,s[l+276>>2]=0),m=l+256|0,f=s[m>>2]|0,f&&(s[l+260>>2]=0,Me(f),s[m>>2]=0,s[l+264>>2]=0),m=l+32|0,f=s[m>>2]|0,f&&(s[l+36>>2]=0,Me(f),s[m>>2]=0,s[l+40>>2]=0),m=l+16|0,f=s[m>>2]|0,f&&(s[l+20>>2]=0,Me(f),s[m>>2]=0,s[l+24>>2]=0),f=l+4|0,m=s[f>>2]|0,!m){g=u;return}s[l+8>>2]=0,Me(m),s[f>>2]=0,s[l+12>>2]=0,g=u}function Gr(l,u,m){l=l|0,u=u|0,m=m|0;var f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0;if(f=g,g=g+16|0,b=f+4|0,L=f,S=l+580|0,w=s[S>>2]|0,(w|0)>0?(E=w+-1|0,I=s[(s[l+576>>2]|0)+(E<<2)>>2]|0,s[S>>2]=E,S=I):(I=l+540|0,S=s[I>>2]|0,s[I>>2]=S+1),w=l+412|0,I=S<<1,s[b>>2]=I,Dn(w,b),s[L>>2]=I|1,Dn(w,L),b=l+332|0,w=n[544]|0,L=S+1|0,Zs(b,L),n[(s[b>>2]|0)+S>>0]=w,b=l+396|0,w=l+400|0,(s[w>>2]|0)<(L|0)){if(E=l+404|0,I=s[E>>2]|0,(I|0)<(L|0)&&(x=S+2-I&-2,A=(I>>1)+2&-2,A=(x|0)>(A|0)?x:A,(A|0)>(2147483647-I|0)&&(x=Ge(1)|0,ze(x|0,48,0)),C=s[b>>2]|0,x=A+I|0,s[E>>2]=x,x=ht(C,x<<3)|0,s[b>>2]=x,!(x|0)&&(s[(Xe()|0)>>2]|0)==12&&(C=Ge(1)|0,ze(C|0,48,0))),E=s[w>>2]|0,(E|0)<(L|0))do A=(s[b>>2]|0)+(E<<3)|0,A&&(C=A,s[C>>2]=0,s[C+4>>2]=0),E=E+1|0;while((E|0)!=(L|0));s[w>>2]=L}if(w=(s[b>>2]|0)+(S<<3)|0,s[w>>2]=-1,s[w+4>>2]=0,w=l+316|0,n[l+93>>0]|0?(C=l+72|0,P=+y[C>>3]*1389796,P=P-+(~~(P/2147483647)|0)*2147483647,y[C>>3]=P,P=P/2147483647*1e-5):P=0,b=l+320|0,(s[b>>2]|0)<(L|0)){if(A=l+324|0,E=s[A>>2]|0,(E|0)<(L|0)&&(C=S+2-E&-2,I=(E>>1)+2&-2,I=(C|0)>(I|0)?C:I,(I|0)>(2147483647-E|0)&&(C=Ge(1)|0,ze(C|0,48,0)),x=s[w>>2]|0,C=I+E|0,s[A>>2]=C,C=ht(x,C<<3)|0,s[w>>2]=C,!(C|0)&&(s[(Xe()|0)>>2]|0)==12&&(C=Ge(1)|0,ze(C|0,48,0))),I=s[b>>2]|0,(I|0)<(L|0)){A=s[w>>2]|0;do E=A+(I<<3)|0,E&&(y[E>>3]=0),I=I+1|0;while((I|0)!=(L|0))}s[b>>2]=L}if(y[(s[w>>2]|0)+(S<<3)>>3]=P,ji(l+588|0,S,0),ji(l+348|0,S,1),b=l+364|0,u=n[u>>0]|0,Zs(b,L),n[(s[b>>2]|0)+S>>0]=u,b=l+380|0,u=l+384|0,(s[u>>2]|0)<(L|0)){if(w=l+388|0,E=s[w>>2]|0,(E|0)<(L|0)&&(C=S+2-E&-2,A=(E>>1)+2&-2,A=(C|0)>(A|0)?C:A,(A|0)>(2147483647-E|0)&&(C=Ge(1)|0,ze(C|0,48,0)),x=s[b>>2]|0,C=A+E|0,s[w>>2]=C,C=ht(x,C)|0,s[b>>2]=C,!(C|0)&&(s[(Xe()|0)>>2]|0)==12&&(C=Ge(1)|0,ze(C|0,48,0))),w=s[u>>2]|0,(w|0)<(L|0))do A=(s[b>>2]|0)+w|0,A&&(n[A>>0]=0),w=w+1|0;while((w|0)!=(L|0));s[u>>2]=L}return u=l+288|0,b=s[u>>2]|0,(b|0)<(L|0)&&(C=S+2-b&-2,L=(b>>1)+2&-2,L=(C|0)>(L|0)?C:L,(L|0)>(2147483647-b|0)&&(C=Ge(1)|0,ze(C|0,48,0)),x=l+280|0,I=s[x>>2]|0,C=L+b|0,s[u>>2]=C,C=ht(I,C<<2)|0,s[x>>2]=C,!(C|0)&&(s[(Xe()|0)>>2]|0)==12&&(C=Ge(1)|0,ze(C|0,48,0))),L=l+380|0,u=(s[L>>2]|0)+S|0,b=(n[u>>0]|0)==0,m?b&&(C=l+200|0,x=C,x=tt(s[x>>2]|0,s[x+4>>2]|0,1,0)|0,s[C>>2]=x,s[C+4>>2]=ae):b||(C=l+200|0,x=C,x=tt(s[x>>2]|0,s[x+4>>2]|0,-1,-1)|0,s[C>>2]=x,s[C+4>>2]=ae),n[u>>0]=m&1,m=l+460|0,(s[l+476>>2]|0)>(S|0)&&(s[(s[l+472>>2]|0)+(S<<2)>>2]|0)>-1||!(n[(s[L>>2]|0)+S>>0]|0)?(g=f,S|0):(Js(m,S),g=f,S|0)}function zr(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0,B=0,R=0,U=0;if(m=g,g=g+16|0,b=m+1|0,L=m,f=l+492|0,!(n[f>>0]|0))return B=0,g=m,B|0;B=s[u>>2]|0,S=u+4|0,P=s[S>>2]|0,n[b+0>>0]=n[L+0>>0]|0,en(B,P,b),P=s[S>>2]|0;e:do if((P|0)>0){for(b=l+332|0,L=n[528]|0,w=0,A=0,I=-2;;){if(B=s[u>>2]|0,E=s[B+(w<<2)>>2]|0,C=a[(s[b>>2]|0)+(E>>1)>>0]|0,R=C^E&1,x=R&255,U=L&255,(E|0)==(I^1|0)||x<<24>>24==L<<24>>24&(U>>>1^1)|U&2&R|0){l=1;break}if(R=n[536]|0,U=R&255,(E|0)!=(I|0)&&!((U>>>1^1)&x<<24>>24==R<<24>>24|C&2&U|0)?(s[B+(A<<2)>>2]=E,P=s[S>>2]|0,A=A+1|0):E=I,w=w+1|0,(w|0)<(P|0))I=E;else break e}return g=m,l|0}else w=0,A=0;while(!1);return L=w-A|0,(L|0)>0&&(P=P-L|0,s[S>>2]=P),P?(P|0)==1?(R=s[s[u>>2]>>2]|0,B=R>>1,n[(s[l+332>>2]|0)+B>>0]=(R&1^1)&255^1,U=s[l+296>>2]|0,B=(s[l+396>>2]|0)+(B<<3)|0,s[B>>2]=-1,s[B+4>>2]=U,B=l+284|0,U=s[B>>2]|0,s[B>>2]=U+1,s[(s[l+280>>2]|0)+(U<<2)>>2]=R,U=(ki(l)|0)==-1,n[f>>0]=U&1,g=m,U|0):(u=tn(l+544|0,u,0)|0,S=l+256|0,f=l+260|0,b=s[f>>2]|0,L=l+264|0,(b|0)==(s[L>>2]|0)&&(P=(b>>1)+2&-2,P=(P|0)<2?2:P,(P|0)>(2147483647-b|0)&&(U=Ge(1)|0,ze(U|0,48,0)),R=s[S>>2]|0,U=P+b|0,s[L>>2]=U,U=ht(R,U<<2)|0,s[S>>2]=U,!(U|0)&&(s[(Xe()|0)>>2]|0)==12&&(U=Ge(1)|0,ze(U|0,48,0)),b=s[f>>2]|0),s[f>>2]=b+1,f=(s[S>>2]|0)+(b<<2)|0,f&&(s[f>>2]=u),Qs(l,u),U=1,g=m,U|0):(n[f>>0]=0,U=0,g=m,U|0)}function js(l,u,m){l=l|0,u=u|0,m=m|0;var f=0,S=0;f=s[u>>2]|0,u=f>>1,n[(s[l+332>>2]|0)+u>>0]=(f&1^1)&255^1,S=s[l+296>>2]|0,u=(s[l+396>>2]|0)+(u<<3)|0,s[u>>2]=m,s[u+4>>2]=S,m=l+284|0,u=s[m>>2]|0,s[m>>2]=u+1,s[(s[l+280>>2]|0)+(u<<2)>>2]=f}function ki(l){l=l|0;var u=0,m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0,B=0,R=0,U=0,Y=0,Q=0,te=0,de=0,Ce=0,Te=0,ne=0,Se=0,Ee=0,me=0,_e=0,ue=0,be=0,ge=0,se=0,xe=0,qe=0,Fe=0,Re=0,Ye=0;if(b=g,g=g+16|0,C=b,S=l+512|0,R=s[S>>2]|0,x=l+284|0,(R|0)>=(s[x>>2]|0))return qe=0,se=0,Re=-1,Fe=l+184|0,be=Fe,xe=be,xe=s[xe>>2]|0,be=be+4|0,be=s[be>>2]|0,be=tt(xe|0,be|0,qe|0,se|0)|0,xe=ae,ge=Fe,s[ge>>2]=be,Fe=Fe+4|0,s[Fe>>2]=xe,Fe=l+520|0,xe=Fe,ge=xe,ge=s[ge>>2]|0,xe=xe+4|0,xe=s[xe>>2]|0,se=Ct(ge|0,xe|0,qe|0,se|0)|0,qe=ae,xe=Fe,s[xe>>2]=se,Fe=Fe+4|0,s[Fe>>2]=qe,g=b,Re|0;E=l+280|0,L=l+428|0,f=l+412|0,P=l+332|0,w=l+544|0,A=C+4|0,u=l+396|0,I=l+296|0,m=l+456|0,Ce=-1,B=0;do{if(s[S>>2]=R+1,Q=s[(s[E>>2]|0)+(R<<2)>>2]|0,n[(s[L>>2]|0)+Q>>0]|0){if(U=s[f>>2]|0,R=U+(Q*12|0)+4|0,de=s[R>>2]|0,(de|0)>0){U=U+(Q*12|0)|0,Y=0,te=0;do ne=s[U>>2]|0,Te=ne+(Y<<3)|0,(s[(s[s[m>>2]>>2]|0)+(s[Te>>2]<<2)>>2]&3|0)!=1&&(Fe=Te,Re=s[Fe+4>>2]|0,de=ne+(te<<3)|0,s[de>>2]=s[Fe>>2],s[de+4>>2]=Re,de=s[R>>2]|0,te=te+1|0),Y=Y+1|0;while((Y|0)<(de|0))}else Y=0,te=0;U=Y-te|0,(U|0)>0&&(s[R>>2]=de-U),n[(s[L>>2]|0)+Q>>0]=0}R=s[f>>2]|0,B=B+1|0,U=s[R+(Q*12|0)>>2]|0,R=R+(Q*12|0)+4|0,te=s[R>>2]|0,Y=U+(te<<3)|0;e:do if(!te)Y=U,de=U;else for(Q=Q^1,te=(te<<3)+-1|0,ne=U,de=U;;){for(;;){t:for(;;){if(ue=s[ne+4>>2]|0,Re=a[(s[P>>2]|0)+(ue>>1)>>0]^ue&1,ge=n[528]|0,be=ge&255,se=be&2,be=be>>>1^1,(Re&255)<<24>>24==ge<<24>>24&be|se&Re){me=19;break}if(Te=s[ne>>2]|0,me=s[w>>2]|0,_e=me+(Te<<2)|0,Se=me+(Te+1<<2)|0,Ee=s[Se>>2]|0,(Ee|0)==(Q|0)&&(Re=me+(Te+2<<2)|0,Ee=s[Re>>2]|0,s[Se>>2]=Ee,s[Re>>2]=Q),Se=ne+8|0,s[C>>2]=Te,s[A>>2]=Ee,(Ee|0)!=(ue|0)&&(Re=a[(s[P>>2]|0)+(Ee>>1)>>0]^Ee&1,((Re&255)<<24>>24==ge<<24>>24&be|se&Re|0)!=0)){me=27;break}if(se=s[_e>>2]|0,se>>>0<=95){me=31;break}for(be=s[P>>2]|0,ge=n[536]|0,ue=ge&255,Re=ue&2,ue=ue>>>1^1,Fe=2;xe=_e+(Fe<<2)+4|0,qe=s[xe>>2]|0,Ye=a[be+(qe>>1)>>0]^qe&1,Fe=Fe+1|0,!!((Ye&255)<<24>>24==ge<<24>>24&ue|Re&Ye);)if((Fe|0)>=(se>>>5|0)){me=32;break t}if(Ye=me+(Te+2<<2)|0,s[Ye>>2]=qe,s[xe>>2]=Q,sn((s[f>>2]|0)+((s[Ye>>2]^1)*12|0)|0,C),(Se|0)==(Y|0))break e;ne=Se}if((me|0)==19?(me=0,Fe=ne,Re=s[Fe+4>>2]|0,Ye=de,s[Ye>>2]=s[Fe>>2],s[Ye+4>>2]=Re,ne=ne+8|0,de=de+8|0):(me|0)==27?(me=0,Re=C,Ye=s[Re+4>>2]|0,ne=de,s[ne>>2]=s[Re>>2],s[ne+4>>2]=Ye,ne=Se,de=de+8|0):(me|0)==31&&(ge=n[536]|0,me=32),(me|0)==32){if(me=de+8|0,_e=C,be=s[_e+4>>2]|0,ue=de,s[ue>>2]=s[_e>>2],s[ue+4>>2]=be,ue=Ee>>1,be=Ee&1,_e=(s[P>>2]|0)+ue|0,Ye=a[_e>>0]^be,Re=ge&255,(Ye&255)<<24>>24==ge<<24>>24&(Re>>>1^1)|Re&2&Ye)break;n[_e>>0]=(be^1)&255^1,de=s[I>>2]|0,ne=(s[u>>2]|0)+(ue<<3)|0,s[ne>>2]=Te,s[ne+4>>2]=de,ne=s[x>>2]|0,s[x>>2]=ne+1,s[(s[E>>2]|0)+(ne<<2)>>2]=Ee,ne=Se,de=me}if((ne|0)==(Y|0))break e}if(s[S>>2]=s[x>>2],Se>>>0<Y>>>0){for(Ce=(U+(te-Se)|0)>>>3;Fe=Se,Se=Se+8|0,Re=s[Fe+4>>2]|0,Ye=me,s[Ye>>2]=s[Fe>>2],s[Ye+4>>2]=Re,!(Se>>>0>=Y>>>0);)me=me+8|0;ne=ne+(Ce+2<<3)|0,de=de+(Ce+2<<3)|0}else ne=Se,de=me;if((ne|0)==(Y|0)){Ce=Te;break}else Ce=Te}while(!1);U=Y-de|0,(U|0)>0&&(s[R>>2]=(s[R>>2]|0)-(U>>3)),R=s[S>>2]|0}while((R|0)<(s[x>>2]|0));return Fe=B,xe=((B|0)<0)<<31>>31,Ye=Ce,Re=l+184|0,ge=Re,qe=ge,qe=s[qe>>2]|0,ge=ge+4|0,ge=s[ge>>2]|0,ge=tt(qe|0,ge|0,Fe|0,xe|0)|0,qe=ae,se=Re,s[se>>2]=ge,Re=Re+4|0,s[Re>>2]=qe,Re=l+520|0,qe=Re,se=qe,se=s[se>>2]|0,qe=qe+4|0,qe=s[qe>>2]|0,xe=Ct(se|0,qe|0,Fe|0,xe|0)|0,Fe=ae,qe=Re,s[qe>>2]=xe,Re=Re+4|0,s[Re>>2]=Fe,g=b,Ye|0}function Qs(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0;if(m=g,g=g+16|0,w=m+8|0,S=m,L=s[l+544>>2]|0,f=L+(u<<2)|0,b=L+(u+1<<2)|0,P=l+412|0,A=(s[P>>2]|0)+((s[b>>2]^1)*12|0)|0,L=L+(u+2<<2)|0,E=s[L>>2]|0,s[w>>2]=u,s[w+4>>2]=E,sn(A,w),L=(s[P>>2]|0)+((s[L>>2]^1)*12|0)|0,b=s[b>>2]|0,s[S>>2]=u,s[S+4>>2]=b,sn(L,S),s[f>>2]&4){E=l+216|0,A=E,A=tt(s[A>>2]|0,s[A+4>>2]|0,1,0)|0,s[E>>2]=A,s[E+4>>2]=ae,E=l+232|0,A=E,A=tt((s[f>>2]|0)>>>5|0,0,s[A>>2]|0,s[A+4>>2]|0)|0,s[E>>2]=A,s[E+4>>2]=ae,g=m;return}else{E=l+208|0,A=E,A=tt(s[A>>2]|0,s[A+4>>2]|0,1,0)|0,s[E>>2]=A,s[E+4>>2]=ae,E=l+224|0,A=E,A=tt((s[f>>2]|0)>>>5|0,0,s[A>>2]|0,s[A+4>>2]|0)|0,s[E>>2]=A,s[E+4>>2]=ae,g=m;return}}function _n(l,u,m){l=l|0,u=u|0,m=m|0;var f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0;if(S=g,g=g+16|0,w=S+4|0,b=S,L=s[l+544>>2]|0,f=L+(u<<2)|0,P=s[L+(u+1<<2)>>2]^1,!m)s[w>>2]=P,m=l+428|0,A=s[m>>2]|0,P=A+P|0,n[P>>0]|0||(n[P>>0]=1,Gt(l+444|0,w),A=s[m>>2]|0),u=s[L+(u+2<<2)>>2]^1,s[b>>2]=u,u=A+u|0,n[u>>0]|0||(n[u>>0]=1,Gt(l+444|0,b));else{b=l+412|0,m=s[b>>2]|0,w=m+(P*12|0)|0,L=L+(u+2<<2)|0,P=m+(P*12|0)+4|0,A=s[P>>2]|0;e:do if((A|0)>0)for(x=s[w>>2]|0,I=0;;){if(E=I+1|0,(s[x+(I<<3)>>2]|0)==(u|0)){E=I;break e}if((E|0)<(A|0))I=E;else break}else E=0;while(!1);if(A=A+-1|0,(E|0)<(A|0)){do m=s[w>>2]|0,A=E,E=E+1|0,I=m+(E<<3)|0,x=s[I+4>>2]|0,A=m+(A<<3)|0,s[A>>2]=s[I>>2],s[A+4>>2]=x,A=(s[P>>2]|0)+-1|0;while((E|0)<(A|0));m=s[b>>2]|0}s[P>>2]=A,b=s[L>>2]^1,L=m+(b*12|0)|0,b=m+(b*12|0)+4|0,P=s[b>>2]|0;e:do if((P|0)>0)for(m=s[L>>2]|0,A=0;;){if(w=A+1|0,(s[m+(A<<3)>>2]|0)==(u|0)){w=A;break e}if((w|0)<(P|0))A=w;else break}else w=0;while(!1);if(u=P+-1|0,(w|0)<(u|0))do E=s[L>>2]|0,u=w,w=w+1|0,I=E+(w<<3)|0,x=s[I+4>>2]|0,u=E+(u<<3)|0,s[u>>2]=s[I>>2],s[u+4>>2]=x,u=(s[b>>2]|0)+-1|0;while((w|0)<(u|0));s[b>>2]=u}if(s[f>>2]&4){x=l+216|0,I=x,I=tt(s[I>>2]|0,s[I+4>>2]|0,-1,-1)|0,s[x>>2]=I,s[x+4>>2]=ae,x=l+232|0,I=x,I=Ct(s[I>>2]|0,s[I+4>>2]|0,(s[f>>2]|0)>>>5|0,0)|0,s[x>>2]=I,s[x+4>>2]=ae,g=S;return}else{x=l+208|0,I=x,I=tt(s[I>>2]|0,s[I+4>>2]|0,-1,-1)|0,s[x>>2]=I,s[x+4>>2]=ae,x=l+224|0,I=x,I=Ct(s[I>>2]|0,s[I+4>>2]|0,(s[f>>2]|0)>>>5|0,0)|0,s[x>>2]=I,s[x+4>>2]=ae,g=S;return}}function Ki(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0;S=g,f=l+544|0,w=s[f>>2]|0,m=w+(u<<2)|0,_n(l,u,0),w=s[w+(u+1<<2)>>2]|0,L=w>>1,w=(a[(s[l+332>>2]|0)+L>>0]|0)^w&1,E=n[528]|0,A=E&255,(w&255)<<24>>24==E<<24>>24&(A>>>1^1)|A&2&w|0&&(b=(s[l+396>>2]|0)+(L<<3)|0,P=s[b>>2]|0,(P|0)!=-1)&&((s[f>>2]|0)+(P<<2)|0)==(m|0)&&(s[b>>2]=-1),s[m>>2]=s[m>>2]&-4|1,A=s[(s[f>>2]|0)+(u<<2)>>2]|0,E=l+556|0,s[E>>2]=((((A>>>3&1)+(A>>>5)<<2)+4|0)>>>2)+(s[E>>2]|0),g=S}function Wr(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0,w=0;if(m=g,f=s[u>>2]|0,f>>>0<=31)return P=0,g=m,P|0;for(S=s[l+332>>2]|0,L=n[528]|0,b=L&255,P=b&2,b=b>>>1^1,l=0;;){if(w=s[u+(l<<2)+4>>2]|0,w=(a[S+(w>>1)>>0]|0)^w&1,l=l+1|0,(w&255)<<24>>24==L<<24>>24&b|P&w){f=1,u=5;break}if((l|0)>=(f>>>5|0)){f=0,u=5;break}}return(u|0)==5?(g=m,f|0):0}function Mi(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0,B=0,R=0,U=0,Y=0;if(S=g,m=l+296|0,(s[m>>2]|0)<=(u|0)){g=S;return}if(f=l+284|0,R=s[f>>2]|0,b=l+292|0,U=s[b>>2]|0,Y=s[U+(u<<2)>>2]|0,(R|0)>(Y|0)){B=l+280|0,A=l+332|0,w=l+88|0,P=l+348|0,E=l+460|0,x=l+476|0,C=l+472|0,I=l+380|0;do R=R+-1|0,Y=s[(s[B>>2]|0)+(R<<2)>>2]>>1,n[(s[A>>2]|0)+Y>>0]=n[544]|0,U=s[w>>2]|0,(U|0)<=1?(U|0)==1&&(R|0)>(s[(s[b>>2]|0)+((s[m>>2]|0)+-1<<2)>>2]|0)&&(L=7):L=7,(L|0)==7&&(L=0,n[(s[P>>2]|0)+Y>>0]=s[(s[B>>2]|0)+(R<<2)>>2]&1),(s[x>>2]|0)>(Y|0)&&(s[(s[C>>2]|0)+(Y<<2)>>2]|0)>-1||(L=11),(L|0)==11&&(L=0,(n[(s[I>>2]|0)+Y>>0]|0)!=0)&&Js(E,Y),U=s[b>>2]|0,Y=s[U+(u<<2)>>2]|0;while((R|0)>(Y|0));R=s[f>>2]|0}if(s[l+512>>2]=Y,l=s[U+(u<<2)>>2]|0,(R-l|0)>0&&(s[f>>2]=l),((s[m>>2]|0)-u|0)<=0){g=S;return}s[m>>2]=u,g=S}function Yr(l){l=l|0;var u=0,m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0;for(u=g,f=l+72|0,x=+y[f>>3]*1389796,x=x-+(~~(x/2147483647)|0)*2147483647,y[f>>3]=x,P=l+464|0,x/2147483647<+y[l+64>>3]&&(w=s[P>>2]|0,(w|0)!=0)?(x=x*1389796,x=x-+(~~(x/2147483647)|0)*2147483647,y[f>>3]=x,w=s[(s[l+460>>2]|0)+(~~(+(w|0)*(x/2147483647))<<2)>>2]|0,E=n[(s[l+332>>2]|0)+w>>0]|0,A=n[544]|0,I=A&255,(I>>>1^1)&E<<24>>24==A<<24>>24|E&2&I|0&&n[(s[l+380>>2]|0)+w>>0]|0&&(I=l+176|0,E=I,E=tt(s[E>>2]|0,s[E+4>>2]|0,1,0)|0,s[I>>2]=E,s[I+4>>2]=ae)):w=-1,A=l+460|0,I=l+332|0,E=l+380|0;!((w|0)!=-1&&(C=n[(s[I>>2]|0)+w>>0]|0,L=n[544]|0,m=L&255,S=m>>>1^1,(S&C<<24>>24==L<<24>>24|C&2&m|0)!=0)&&n[(s[E>>2]|0)+w>>0]|0);){if(!(s[P>>2]|0)){m=-2,b=17;break}w=oo(A)|0}return(b|0)==17?(g=u,m|0):(P=n[(s[l+364>>2]|0)+w>>0]|0,b=P&255,S&P<<24>>24==L<<24>>24|m&2&b?n[l+92>>0]|0?(x=+y[f>>3]*1389796,x=x-+(~~(x/2147483647)|0)*2147483647,y[f>>3]=x,C=x/2147483647<.5|w<<1,g=u,C|0):(C=(n[(s[l+348>>2]|0)+w>>0]|0)!=0|w<<1,g=u,C|0):(I=n[528]|0,C=I&255,C=((C>>>1^1)&P<<24>>24==I<<24>>24|b&2&C|0)!=0|w<<1,g=u,C|0))}function Kr(l,u,m,f){l=l|0,u=u|0,m=m|0,f=f|0;var S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0,B=0,R=0,U=0,Y=0,Q=0,te=0,de=0,Ce=0,Te=0,ne=0,Se=0,Ee=0,me=0,_e=0,ue=0,be=0,ge=0,se=0,xe=0,qe=0,Fe=0,Re=0,Ye=0,dt=0,Ve=0,Dt=0,it=0;S=g,g=g+16|0,E=S+8|0,B=S+4|0,w=S,P=m+4|0,L=s[P>>2]|0,b=m+8|0,(L|0)==(s[b>>2]|0)&&(I=(L>>1)+2&-2,I=(I|0)<2?2:I,(I|0)>(2147483647-L|0)&&(Ve=Ge(1)|0,ze(Ve|0,48,0)),dt=s[m>>2]|0,Ve=I+L|0,s[b>>2]=Ve,Ve=ht(dt,Ve<<2)|0,s[m>>2]=Ve,!(Ve|0)&&(s[(Xe()|0)>>2]|0)==12&&(Ve=Ge(1)|0,ze(Ve|0,48,0)),L=s[P>>2]|0),b=(s[m>>2]|0)+(L<<2)|0,b&&(s[b>>2]=0,L=s[P>>2]|0),s[P>>2]=L+1,I=l+544|0,_e=l+280|0,L=l+588|0,b=l+396|0,ne=l+504|0,Ee=l+316|0,Se=l+540|0,Te=l+476|0,Ce=l+472|0,de=l+460|0,te=l+488|0,Q=l+296|0,U=l+496|0,Y=l+272|0,me=l+268|0,be=-2,ue=(s[l+284>>2]|0)+-1|0,ge=0;do{if(se=s[I>>2]|0,u=se+(u<<2)|0,xe=s[u>>2]|0,xe&4|0&&(x=+y[U>>3],Ve=u+(xe>>>5<<2)+4|0,Dt=x+ +d[Ve>>2],d[Ve>>2]=Dt,Dt>1e20)){if(Fe=s[Y>>2]|0,(Fe|0)>0){qe=s[me>>2]|0,xe=0;do Ve=se+(s[qe+(xe<<2)>>2]<<2)|0,Ve=Ve+((s[Ve>>2]|0)>>>5<<2)+4|0,d[Ve>>2]=+d[Ve>>2]*1e-20,xe=xe+1|0;while((xe|0)!=(Fe|0))}y[U>>3]=x*1e-20}if(be=(be|0)!=-2&1,be>>>0<(s[u>>2]|0)>>>5>>>0)do{xe=s[u+(be<<2)+4>>2]|0,s[B>>2]=xe,xe=xe>>1,se=(s[L>>2]|0)+xe|0;do if(!(n[se>>0]|0)&&(s[(s[b>>2]|0)+(xe<<3)+4>>2]|0)>0){if(Fe=s[Ee>>2]|0,Ve=Fe+(xe<<3)|0,Dt=+y[ne>>3]+ +y[Ve>>3],y[Ve>>3]=Dt,Dt>1e100){if(Re=s[Se>>2]|0,(Re|0)>0){qe=0;do Ve=Fe+(qe<<3)|0,y[Ve>>3]=+y[Ve>>3]*1e-100,qe=qe+1|0;while((qe|0)!=(Re|0))}y[ne>>3]=+y[ne>>3]*1e-100}if((s[Te>>2]|0)>(xe|0)&&(R=s[Ce>>2]|0,C=s[R+(xe<<2)>>2]|0,(C|0)>-1)){qe=s[de>>2]|0,Fe=s[qe+(C<<2)>>2]|0;e:do if(!C)dt=0;else for(Ve=C;;){if(dt=Ve,Ve=Ve+-1>>1,Ye=qe+(Ve<<2)|0,Re=s[Ye>>2]|0,it=s[s[te>>2]>>2]|0,!(+y[it+(Fe<<3)>>3]>+y[it+(Re<<3)>>3]))break e;if(s[qe+(dt<<2)>>2]=Re,s[R+(s[Ye>>2]<<2)>>2]=dt,!Ve){dt=0;break}}while(!1);s[qe+(dt<<2)>>2]=Fe,s[R+(Fe<<2)>>2]=dt}if(n[se>>0]=1,(s[(s[b>>2]|0)+(xe<<3)+4>>2]|0)<(s[Q>>2]|0)){Gt(m,B);break}else{ge=ge+1|0;break}}while(!1);be=be+1|0}while((be|0)<((s[u>>2]|0)>>>5|0));u=s[_e>>2]|0,se=s[L>>2]|0;do be=ue,ue=ue+-1|0,be=s[u+(be<<2)>>2]|0,qe=be>>1,xe=se+qe|0;while(!(n[xe>>0]|0));u=s[(s[b>>2]|0)+(qe<<3)>>2]|0,n[xe>>0]=0,ge=ge+-1|0}while((ge|0)>0);if(s[s[m>>2]>>2]=be^1,B=l+616|0,U=s[B>>2]|0,C=l+620|0,U?(s[C>>2]=0,Y=0):Y=s[C>>2]|0,R=s[P>>2]|0,(Y|0)<(R|0)){te=l+624|0,Q=s[te>>2]|0,(Q|0)<(R|0)&&(it=R+1-Q&-2,Y=(Q>>1)+2&-2,Y=(it|0)>(Y|0)?it:Y,(Y|0)>(2147483647-Q|0)&&(it=Ge(1)|0,ze(it|0,48,0)),it=Y+Q|0,s[te>>2]=it,U=ht(U,it<<2)|0,s[B>>2]=U,!(U|0)&&(s[(Xe()|0)>>2]|0)==12&&(it=Ge(1)|0,ze(it|0,48,0))),Y=s[C>>2]|0;e:do if((Y|0)<(R|0))for(;;){if(U=U+(Y<<2)|0,U&&(s[U>>2]=0),Y=Y+1|0,(Y|0)==(R|0))break e;U=s[B>>2]|0}while(!1);s[C>>2]=R,R=s[P>>2]|0}if((R|0)>0){Y=s[B>>2]|0,U=s[m>>2]|0,Q=0;do s[Y+(Q<<2)>>2]=s[U+(Q<<2)>>2],Q=Q+1|0,R=s[P>>2]|0;while((Q|0)<(R|0))}if(U=s[l+84>>2]|0,(U|0)==1)if((R|0)>1)for(w=s[m>>2]|0,A=1,U=1;;){R=s[w+(A<<2)>>2]|0,E=s[b>>2]|0,Y=s[E+(R>>1<<3)>>2]|0;e:do if((Y|0)!=-1){if(Q=(s[I>>2]|0)+(Y<<2)|0,te=s[Q>>2]|0,te>>>0>63){for(Y=s[L>>2]|0,de=1;it=s[Q+(de<<2)+4>>2]>>1,!(!(n[Y+it>>0]|0)&&(s[E+(it<<3)+4>>2]|0)>0);)if(de=de+1|0,(de|0)>=(te>>>5|0))break e;s[w+(U<<2)>>2]=R,U=U+1|0}}else s[w+(U<<2)>>2]=R,U=U+1|0;while(!1);if(A=A+1|0,E=s[P>>2]|0,(A|0)>=(E|0)){w=E;break}}else w=R,A=1,U=1;else if((U|0)==2)if((R|0)>1){I=1,U=1;do Y=s[m>>2]|0,R=s[Y+(I<<2)>>2]|0,(s[(s[b>>2]|0)+(R>>1<<3)>>2]|0)!=-1?(s[w>>2]=R,s[E+0>>2]=s[w+0>>2],Xr(l,E)|0||(R=s[m>>2]|0,Y=R,R=s[R+(I<<2)>>2]|0,A=62)):A=62,(A|0)==62&&(A=0,s[Y+(U<<2)>>2]=R,U=U+1|0),I=I+1|0,R=s[P>>2]|0;while((I|0)<(R|0));w=R,A=I}else w=R,A=1,U=1;else w=R,A=R,U=R;if(it=l+240|0,Ve=it,Ve=tt(s[Ve>>2]|0,s[Ve+4>>2]|0,w|0,((w|0)<0)<<31>>31|0)|0,s[it>>2]=Ve,s[it+4>>2]=ae,A=A-U|0,(A|0)>0&&(w=w-A|0,s[P>>2]=w),it=l+248|0,Ve=it,Ve=tt(s[Ve>>2]|0,s[Ve+4>>2]|0,w|0,((w|0)<0)<<31>>31|0)|0,s[it>>2]=Ve,s[it+4>>2]=ae,(w|0)==1)m=0;else{if(m=s[m>>2]|0,(w|0)>2){l=s[b>>2]|0,P=2,A=1;do A=(s[l+(s[m+(P<<2)>>2]>>1<<3)+4>>2]|0)>(s[l+(s[m+(A<<2)>>2]>>1<<3)+4>>2]|0)?P:A,P=P+1|0;while((P|0)<(w|0))}else A=1;Ve=m+(A<<2)|0,it=s[Ve>>2]|0,m=m+4|0,s[Ve>>2]=s[m>>2],s[m>>2]=it,m=s[(s[b>>2]|0)+(it>>1<<3)+4>>2]|0}if(s[f>>2]=m,(s[C>>2]|0)>0)f=0;else{g=S;return}do n[(s[L>>2]|0)+(s[(s[B>>2]|0)+(f<<2)>>2]>>1)>>0]=0,f=f+1|0;while((f|0)<(s[C>>2]|0));g=S}function Xr(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0,B=0,R=0,U=0,Y=0;for(m=g,E=s[u>>2]|0,w=l+396|0,C=s[w>>2]|0,P=l+544|0,R=(s[P>>2]|0)+(s[C+(E>>1<<3)>>2]<<2)|0,L=l+604|0,f=l+608|0,s[L>>2]|0&&(s[f>>2]=0),S=l+588|0,b=l+612|0,l=l+616|0,I=1;;){if(I>>>0<(s[R>>2]|0)>>>5>>>0){if(B=s[R+(I<<2)+4>>2]|0,x=B>>1,s[C+(x<<3)+4>>2]|0&&(A=n[(s[S>>2]|0)+x>>0]|0,(A+-1<<24>>24&255)>=2)){if(R=s[f>>2]|0,U=(R|0)==(s[b>>2]|0),A<<24>>24==3||(s[C+(x<<3)>>2]|0)==-1){P=8;break}if(U){if(C=(R>>1)+2&-2,C=(C|0)<2?2:C,(C|0)>(2147483647-R|0)){P=24;break}if(Y=s[L>>2]|0,U=C+R|0,s[b>>2]=U,U=ht(Y,U<<3)|0,s[L>>2]=U,!(U|0)&&(s[(Xe()|0)>>2]|0)==12){P=24;break}R=s[f>>2]|0}s[f>>2]=R+1,C=(s[L>>2]|0)+(R<<3)|0,C&&(Y=C,s[Y>>2]=I,s[Y+4>>2]=E),s[u>>2]=B,R=s[w>>2]|0,E=B,C=R,R=(s[P>>2]|0)+(s[R+(x<<3)>>2]<<2)|0,I=0}}else{if(E=(s[S>>2]|0)+(E>>1)|0,n[E>>0]|0||(n[E>>0]=2,Gt(l,u)),E=s[f>>2]|0,!E){f=1,P=34;break}Y=E+-1|0,E=s[L>>2]|0,I=s[E+(Y<<3)>>2]|0,E=s[E+(Y<<3)+4>>2]|0,s[u>>2]=E,C=s[w>>2]|0,R=(s[P>>2]|0)+(s[C+(E>>1<<3)>>2]<<2)|0,s[f>>2]=Y}I=I+1|0}if((P|0)==8){if(U&&(P=(R>>1)+2&-2,P=(P|0)<2?2:P,(P|0)>(2147483647-R|0)&&(Y=Ge(1)|0,ze(Y|0,48,0)),U=s[L>>2]|0,Y=P+R|0,s[b>>2]=Y,Y=ht(U,Y<<3)|0,s[L>>2]=Y,!(Y|0)&&(s[(Xe()|0)>>2]|0)==12&&(Y=Ge(1)|0,ze(Y|0,48,0)),R=s[f>>2]|0),b=R+1|0,s[f>>2]=b,P=(s[L>>2]|0)+(R<<3)|0,P&&(b=P,s[b>>2]=0,s[b+4>>2]=E,b=s[f>>2]|0),(b|0)>0)P=0;else return Y=0,g=m,Y|0;do w=(s[S>>2]|0)+(s[(s[L>>2]|0)+(P<<3)+4>>2]>>1)|0,n[w>>0]|0||(n[w>>0]=3,Gt(l,(s[L>>2]|0)+(P<<3)+4|0),b=s[f>>2]|0),P=P+1|0;while((P|0)<(b|0));return f=0,g=m,f|0}else if((P|0)==24)ze(Ge(1)|0,48,0);else if((P|0)==34)return g=m,f|0;return 0}function jr(l,u,m){l=l|0,u=u|0,m=m|0;var f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0,B=0,R=0,U=0,Y=0,Q=0;if(b=g,g=g+32|0,L=b+16|0,S=b+12|0,P=b+8|0,f=b,E=m+20|0,w=m+16|0,(s[E>>2]|0)>0){A=0;do n[(s[m>>2]|0)+(s[(s[w>>2]|0)+(A<<2)>>2]|0)>>0]=0,A=A+1|0;while((A|0)<(s[E>>2]|0))}if(s[w>>2]|0&&(s[E>>2]=0),A=s[u>>2]|0,s[P>>2]=A,s[S>>2]=A,s[L+0>>2]=s[S+0>>2],Vs(m,L,0),w=(s[m>>2]|0)+A|0,n[w>>0]|0||(n[w>>0]=1,Gt(m+16|0,P)),!(s[l+296>>2]|0)){g=b;return}if(u=A>>1,I=l+588|0,n[(s[I>>2]|0)+u>>0]=1,x=s[l+284>>2]|0,E=l+292|0,R=s[s[E>>2]>>2]|0,(x|0)>(R|0)){P=l+280|0,w=l+396|0,A=m+16|0,l=l+544|0;do if(x=x+-1|0,B=s[(s[P>>2]|0)+(x<<2)>>2]|0,C=B>>1,n[(s[I>>2]|0)+C>>0]|0){R=s[w>>2]|0,U=s[R+(C<<3)>>2]|0;e:do if((U|0)==-1)B=B^1,s[f>>2]=B,s[S>>2]=B,s[L+0>>2]=s[S+0>>2],Vs(m,L,0),B=(s[m>>2]|0)+B|0,n[B>>0]|0||(n[B>>0]=1,Gt(A,f));else if(B=(s[l>>2]|0)+(U<<2)|0,U=s[B>>2]|0,U>>>0>63)for(Y=1;;){if(Q=s[B+(Y<<2)+4>>2]>>1,(s[R+(Q<<3)+4>>2]|0)>0&&(n[(s[I>>2]|0)+Q>>0]=1,U=s[B>>2]|0),Y=Y+1|0,(Y|0)>=(U>>>5|0))break e;R=s[w>>2]|0}while(!1);n[(s[I>>2]|0)+C>>0]=0,R=s[s[E>>2]>>2]|0}while((x|0)>(R|0))}n[(s[I>>2]|0)+u>>0]=0,g=b}function Qr(l){l=l|0;var u=0,m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0,B=0,R=0,U=0,Y=0,Q=0,te=0;if(m=g,g=g+16|0,A=m+4|0,B=m,u=l+272|0,U=s[u>>2]|0,P=+y[l+496>>3]/+(U|0),S=l+544|0,L=l+268|0,R=s[L>>2]|0,s[B>>2]=S,s[A+0>>2]=s[B+0>>2],nn(R,U,A),A=s[u>>2]|0,(A|0)>0){b=l+332|0,w=l+396|0,E=0,R=0;do{C=s[L>>2]|0,B=s[C+(E<<2)>>2]|0,U=s[S>>2]|0,I=U+(B<<2)|0,x=s[I>>2]|0;do if(x>>>0>95){if(Y=s[U+(B+1<<2)>>2]|0,U=Y>>1,Y=(a[(s[b>>2]|0)+U>>0]|0)^Y&1,te=n[528]|0,Q=te&255,(Y&255)<<24>>24==te<<24>>24&(Q>>>1^1)|Q&2&Y|0&&(te=s[(s[w>>2]|0)+(U<<3)>>2]|0,(te|0)!=-1&(te|0)==(B|0))){f=9;break}if((E|0)>=((A|0)/2|0|0)&&!(+d[I+(x>>>5<<2)+4>>2]<P)){f=9;break}Ki(l,B)}else f=9;while(!1);(f|0)==9&&(f=0,s[C+(R<<2)>>2]=B,R=R+1|0),E=E+1|0,A=s[u>>2]|0}while((E|0)<(A|0))}else E=0,R=0;if(f=E-R|0,(f|0)>0&&(s[u>>2]=A-f),!(+((s[l+556>>2]|0)>>>0)>+y[l+96>>3]*+((s[l+548>>2]|0)>>>0))){g=m;return}wi[s[(s[l>>2]|0)+8>>2]&31](l),g=m}function En(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0,B=0,R=0,U=0,Y=0,Q=0,te=0;if(m=g,f=u+4|0,w=s[f>>2]|0,(w|0)>0){L=l+544|0,S=l+332|0,b=0,P=0;do{U=s[u>>2]|0,I=s[U+(b<<2)>>2]|0,w=(s[L>>2]|0)+(I<<2)|0,E=s[w>>2]|0;do if(E>>>0>31){Y=s[S>>2]|0,C=n[528]|0,x=C&255,Q=x&2,x=x>>>1^1,B=E>>>5,R=0;do if(te=s[w+(R<<2)+4>>2]|0,te=(a[Y+(te>>1)>>0]|0)^te&1,R=R+1|0,(te&255)<<24>>24==C<<24>>24&x|Q&te){A=7;break}while((R|0)<(B|0));if((A|0)==7){A=0,Ki(l,I);break}if(E>>>0>95){A=n[536]|0,x=E>>>5,I=2;do C=w+(I<<2)+4|0,te=s[C>>2]|0,te=(a[(s[S>>2]|0)+(te>>1)>>0]|0)^te&1,Q=A&255,(te&255)<<24>>24==A<<24>>24&(Q>>>1^1)|Q&2&te&&(s[C>>2]=s[w+(x+-1<<2)+4>>2],E=s[w>>2]|0,E&8&&(E=E>>>5,s[w+(E+-1<<2)+4>>2]=s[w+(E<<2)+4>>2],E=s[w>>2]|0),E=E+-32|0,s[w>>2]=E,I=I+-1|0),I=I+1|0,x=E>>>5;while((I|0)<(x|0));I=s[u>>2]|0,U=I,I=s[I+(b<<2)>>2]|0,A=16}else A=16}else A=16;while(!1);(A|0)==16&&(A=0,s[U+(P<<2)>>2]=I,P=P+1|0),b=b+1|0,w=s[f>>2]|0}while((b|0)<(w|0))}else b=0,P=0;if(u=b-P|0,(u|0)<=0){g=m;return}s[f>>2]=w-u,g=m}function Tn(l){l=l|0;var u=0,m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0;if(S=g,g=g+16|0,m=S+4|0,L=S,s[m>>2]=0,u=m+4|0,s[u>>2]=0,f=m+8|0,s[f>>2]=0,s[L>>2]=0,b=l+540|0,E=s[b>>2]|0,(E|0)>0){w=l+380|0,P=l+332|0,A=0;do n[(s[w>>2]|0)+A>>0]|0&&(x=n[(s[P>>2]|0)+A>>0]|0,C=n[544]|0,I=C&255,((I>>>1^1)&x<<24>>24==C<<24>>24|x&2&I|0)!=0)&&(ti(m,L),E=s[b>>2]|0),A=A+1|0,s[L>>2]=A;while((A|0)<(E|0))}if(ao(l+460|0,m),l=s[m>>2]|0,!l){g=S;return}s[u>>2]=0,Me(l),s[m>>2]=0,s[f>>2]=0,g=S}function wn(l){l=l|0;var u=0,m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0,B=0;if(u=g,f=l+492|0,n[f>>0]|0&&(ki(l)|0)==-1){if(f=l+284|0,S=l+516|0,(s[f>>2]|0)==(s[S>>2]|0)||(L=l+520|0,B=L,C=s[B+4>>2]|0,(C|0)>0|(C|0)==0&(s[B>>2]|0)>>>0>0))return B=1,g=u,B|0;if(En(l,l+268|0),n[l+536>>0]|0){if(En(l,l+256|0),P=l+564|0,b=l+568|0,(s[b>>2]|0)>0){A=l+588|0,w=0;do n[(s[A>>2]|0)+(s[(s[P>>2]|0)+(w<<2)>>2]|0)>>0]=1,w=w+1|0;while((w|0)<(s[b>>2]|0))}if(I=s[f>>2]|0,(I|0)>0){w=s[l+280>>2]|0,A=s[l+588>>2]|0,x=0,E=0;do C=s[w+(x<<2)>>2]|0,n[A+(C>>1)>>0]|0||(s[w+(E<<2)>>2]=C,I=s[f>>2]|0,E=E+1|0),x=x+1|0;while((x|0)<(I|0))}else x=0,E=0;w=x-E|0,(w|0)>0&&(I=I-w|0,s[f>>2]=I),s[l+512>>2]=I;e:do if((s[b>>2]|0)>0){E=l+588|0,w=0;do n[(s[E>>2]|0)+(s[(s[P>>2]|0)+(w<<2)>>2]|0)>>0]=0,w=w+1|0,A=s[b>>2]|0;while((w|0)<(A|0));if((A|0)>0){for(A=l+580|0,E=l+584|0,w=l+576|0,I=0;;){if(C=s[A>>2]|0,(C|0)==(s[E>>2]|0)){if(x=(C>>1)+2&-2,x=(x|0)<2?2:x,(x|0)>(2147483647-C|0)){m=28;break}if(B=s[w>>2]|0,x=x+C|0,s[E>>2]=x,x=ht(B,x<<2)|0,s[w>>2]=x,!(x|0)&&(s[(Xe()|0)>>2]|0)==12){m=28;break}C=s[A>>2]|0}else x=s[w>>2]|0;if(B=x+(C<<2)|0,B&&(s[B>>2]=0,C=s[A>>2]|0),s[A>>2]=C+1,B=s[P>>2]|0,s[x+(C<<2)>>2]=s[B+(I<<2)>>2],I=I+1|0,(I|0)>=(s[b>>2]|0))break e}(m|0)==28&&ze(Ge(1)|0,48,0)}else m=21}else m=21;while(!1);(m|0)==21&&(B=s[P>>2]|0),B&&(s[b>>2]=0)}return+((s[l+556>>2]|0)>>>0)>+y[l+96>>3]*+((s[l+548>>2]|0)>>>0)&&wi[s[(s[l>>2]|0)+8>>2]&31](l),Tn(l),s[S>>2]=s[f>>2],C=l+224|0,B=l+232|0,C=tt(s[B>>2]|0,s[B+4>>2]|0,s[C>>2]|0,s[C+4>>2]|0)|0,B=L,s[B>>2]=C,s[B+4>>2]=ae,B=1,g=u,B|0}return n[f>>0]=0,B=0,g=u,B|0}function Zr(l,u,m){l=l|0,u=u|0,m=m|0;var f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0,B=0,R=0,U=0,Y=0,Q=0,te=0,de=0,Ce=0,Te=0,ne=0,Se=0,Ee=0,me=0,_e=0,ue=0,be=0,ge=0,se=0,xe=0,qe=0,Fe=0,Re=0,Ye=0,dt=0,Ve=0,Dt=0,it=0,Bi=0,Nt=0,Lt=0,pi=0,kt=0,Pt=0,Ze=0,Bs=0,di=0,Wt=0,Ke=0,gt=0,gi=0,es=0,yt=0,fn=0,rr=0,or=0,ts=0,It=0,Ci=0,at=0,De=0,fi=0;b=g,g=g+64|0,Lt=b,Se=b+60|0,de=b+56|0,f=b+44|0,pi=b+40|0,s[f>>2]=0,L=f+4|0,s[L>>2]=0,S=f+8|0,s[S>>2]=0,se=u+160|0,ge=se,ge=tt(s[ge>>2]|0,s[ge+4>>2]|0,1,0)|0,s[se>>2]=ge,s[se+4>>2]=ae,se=(m|0)<0,ge=u+680|0,be=u+664|0,ue=u+672|0,A=u+296|0,R=u+272|0,P=u+284|0,me=u+640|0,ne=u+308|0,Te=u+304|0,E=u+332|0,Ee=u+292|0,Pt=u+168|0,x=u+396|0,B=u+280|0,_e=u+184|0,Ce=u+192|0,C=u+48|0,dt=u+504|0,Bi=u+56|0,kt=u+496|0,Ze=u+656|0,xe=u+144|0,qe=u+648|0,Fe=u+128|0,Re=u+44|0,Ye=u+200|0,Ve=u+208|0,Dt=u+224|0,it=u+216|0,I=u+232|0,Nt=u+540|0,w=u+292|0,U=u+544|0,Q=u+276|0,Y=u+268|0,te=u+268|0,Bs=0;e:for(;;){for(di=se|(Bs|0)<(m|0);Ke=ki(u)|0,(Ke|0)==-1;){if(!di){Ke=41;break e}if(n[ge>>0]|0){Ke=41;break e}if(Ke=be,gt=s[Ke+4>>2]|0,(gt|0)>=0&&(De=Ce,at=s[De+4>>2]|0,!(at>>>0<gt>>>0|((at|0)==(gt|0)?(s[De>>2]|0)>>>0<(s[Ke>>2]|0)>>>0:0)))){Ke=41;break e}if(Ke=ue,gt=s[Ke+4>>2]|0,(gt|0)>=0&&(De=_e,at=s[De+4>>2]|0,!(at>>>0<gt>>>0|((at|0)==(gt|0)?(s[De>>2]|0)>>>0<(s[Ke>>2]|0)>>>0:0)))){Ke=41;break e}if(!(s[A>>2]|0)&&!(wn(u)|0)){Ke=50;break e}for(+((s[R>>2]|0)-(s[P>>2]|0)|0)>=+y[me>>3]&&Qr(u);;){if(Ke=s[A>>2]|0,(Ke|0)>=(s[ne>>2]|0)){Ke=59;break}if(yt=s[(s[Te>>2]|0)+(Ke<<2)>>2]|0,gt=a[(s[E>>2]|0)+(yt>>1)>>0]|0,De=gt^yt&1,gi=De&255,It=n[528]|0,at=It&255,!(gi<<24>>24==It<<24>>24&(at>>>1^1)|at&2&De)){Ke=56;break}s[Se>>2]=s[P>>2],ti(Ee,Se)}if((Ke|0)==56){if(Ke=0,at=n[536]|0,De=at&255,(De>>>1^1)&gi<<24>>24==at<<24>>24|gt&2&De){Ke=57;break e}(yt|0)==-2&&(Ke=59)}if((Ke|0)==59&&(De=Pt,De=tt(s[De>>2]|0,s[De+4>>2]|0,1,0)|0,yt=Pt,s[yt>>2]=De,s[yt+4>>2]=ae,yt=Yr(u)|0,(yt|0)==-2)){Ke=60;break e}s[Lt>>2]=s[P>>2],ti(Ee,Lt),De=yt>>1,n[(s[E>>2]|0)+De>>0]=(yt&1^1)&255^1,at=s[A>>2]|0,De=(s[x>>2]|0)+(De<<3)|0,s[De>>2]=-1,s[De+4>>2]=at,De=s[P>>2]|0,s[P>>2]=De+1,s[(s[B>>2]|0)+(De<<2)>>2]=yt}if(at=Ce,at=tt(s[at>>2]|0,s[at+4>>2]|0,1,0)|0,De=Ce,s[De>>2]=at,s[De+4>>2]=ae,Bs=Bs+1|0,!(s[A>>2]|0)){Ke=5;break}if(s[f>>2]|0&&(s[L>>2]=0),Kr(u,Ke,f,de),Mi(u,s[de>>2]|0),(s[L>>2]|0)==1)at=s[s[f>>2]>>2]|0,De=at>>1,n[(s[E>>2]|0)+De>>0]=(at&1^1)&255^1,It=s[A>>2]|0,De=(s[x>>2]|0)+(De<<3)|0,s[De>>2]=-1,s[De+4>>2]=It,De=s[P>>2]|0,s[P>>2]=De+1,s[(s[B>>2]|0)+(De<<2)>>2]=at;else{if(di=tn(U,f,1)|0,Ke=s[R>>2]|0,(Ke|0)==(s[Q>>2]|0)){if(gt=(Ke>>1)+2&-2,gt=(gt|0)<2?2:gt,(gt|0)>(2147483647-Ke|0)){Ke=14;break}if(at=s[Y>>2]|0,De=gt+Ke|0,s[Q>>2]=De,De=ht(at,De<<2)|0,s[Y>>2]=De,!(De|0)&&(s[(Xe()|0)>>2]|0)==12){Ke=14;break}Ke=s[R>>2]|0}if(s[R>>2]=Ke+1,Ke=(s[Y>>2]|0)+(Ke<<2)|0,Ke&&(s[Ke>>2]=di),Qs(u,di),gi=s[U>>2]|0,De=gi+(di<<2)|0,Wt=+y[kt>>3],De=De+((s[De>>2]|0)>>>5<<2)+4|0,fi=Wt+ +d[De>>2],d[De>>2]=fi,fi>1e20){if(gt=s[R>>2]|0,(gt|0)>0){Ke=s[te>>2]|0,yt=0;do De=gi+(s[Ke+(yt<<2)>>2]<<2)|0,De=De+((s[De>>2]|0)>>>5<<2)+4|0,d[De>>2]=+d[De>>2]*1e-20,yt=yt+1|0;while((yt|0)!=(gt|0))}y[kt>>3]=Wt*1e-20}at=s[s[f>>2]>>2]|0,De=at>>1,n[(s[E>>2]|0)+De>>0]=(at&1^1)&255^1,It=s[A>>2]|0,De=(s[x>>2]|0)+(De<<3)|0,s[De>>2]=di,s[De+4>>2]=It,De=s[P>>2]|0,s[P>>2]=De+1,s[(s[B>>2]|0)+(De<<2)>>2]=at}if(y[dt>>3]=1/+y[C>>3]*+y[dt>>3],y[kt>>3]=1/+y[Bi>>3]*+y[kt>>3],De=(s[Ze>>2]|0)+-1|0,s[Ze>>2]=De,!De&&(Wt=+y[xe>>3]*+y[qe>>3],y[qe>>3]=Wt,s[Ze>>2]=~~Wt,Wt=+y[Fe>>3]*+y[me>>3],y[me>>3]=Wt,!((s[Re>>2]|0)<=0))){if(Ke=s[Ce>>2]|0,di=s[Ye>>2]|0,ts=s[A>>2]|0,ts?gt=s[w>>2]|0:gt=P,gt=s[gt>>2]|0,or=s[Ve>>2]|0,rr=s[Dt>>2]|0,fn=s[it>>2]|0,yt=I,gi=s[yt>>2]|0,yt=s[yt+4>>2]|0,es=+(s[Nt>>2]|0),Ci=1/es,(ts|0)<0)fi=0;else for(It=0,fi=0;It?at=s[(s[w>>2]|0)+(It+-1<<2)>>2]|0:at=0,(It|0)==(ts|0)?De=P:De=(s[w>>2]|0)+(It<<2)|0,fi=fi+ +Ne(+Ci,+ +(It|0))*+((s[De>>2]|0)-at|0),(It|0)!=(ts|0);)It=It+1|0;s[Lt>>2]=Ke,s[Lt+4>>2]=di-gt,s[Lt+8>>2]=or,s[Lt+12>>2]=rr,s[Lt+16>>2]=~~Wt,s[Lt+20>>2]=fn,De=Lt+24|0,y[O>>3]=(+(gi>>>0)+4294967296*+(yt>>>0))/+(fn|0),s[De>>2]=s[O>>2],s[De+4>>2]=s[O+4>>2],De=Lt+32|0,y[O>>3]=fi/es*100,s[De>>2]=s[O>>2],s[De+4>>2]=s[O+4>>2],Vi(1832,Lt|0)|0}}if((Ke|0)==5)n[l>>0]=n[536]|0;else if((Ke|0)==14)ze(Ge(1)|0,48,0);else if((Ke|0)==41){if(Wt=+(s[Nt>>2]|0),es=1/Wt,E=s[A>>2]|0,(E|0)<0)Ci=0;else for(A=0,Ci=0;A?I=s[(s[w>>2]|0)+(A+-1<<2)>>2]|0:I=0,(A|0)==(E|0)?x=P:x=(s[w>>2]|0)+(A<<2)|0,Ci=Ci+ +Ne(+es,+ +(A|0))*+((s[x>>2]|0)-I|0),(A|0)!=(E|0);)A=A+1|0;y[u+528>>3]=Ci/Wt,Mi(u,0),n[l>>0]=n[544]|0}else(Ke|0)==50?n[l>>0]=n[536]|0:(Ke|0)==57?(s[pi>>2]=yt^1,De=u+16|0,s[Lt+0>>2]=s[pi+0>>2],jr(u,Lt,De),n[l>>0]=n[536]|0):(Ke|0)==60&&(n[l>>0]=n[528]|0);if(l=s[f>>2]|0,!l){g=b;return}s[L>>2]=0,Me(l),s[f>>2]=0,s[S>>2]=0,g=b}function Jr(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0,B=0,R=0,U=0,Y=0,Q=0,te=0,de=0,Ce=0,Te=0,ne=0;if(f=g,g=g+16|0,L=f,m=u+4|0,s[m>>2]|0&&(s[u+8>>2]=0),S=u+36|0,b=u+32|0,(s[S>>2]|0)>0){P=u+16|0,w=0;do n[(s[P>>2]|0)+(s[(s[b>>2]|0)+(w<<2)>>2]|0)>>0]=0,w=w+1|0;while((w|0)<(s[S>>2]|0))}if(s[b>>2]|0&&(s[S>>2]=0),b=u+492|0,!(n[b>>0]|0)){n[l>>0]=n[536]|0,g=f;return}P=u+152|0,de=P,de=tt(s[de>>2]|0,s[de+4>>2]|0,1,0)|0,s[P>>2]=de,s[P+4>>2]=ae,Ce=+y[u+120>>3]*+(s[u+208>>2]|0),P=u+640|0,y[P>>3]=Ce,Y=+(s[u+104>>2]|0),Ce<Y&&(y[P>>3]=Y),Q=s[u+136>>2]|0,y[u+648>>3]=+(Q|0),s[u+656>>2]=Q,Q=n[544]|0,P=u+44|0,(s[P>>2]|0)>0?(Ti(2288)|0,Ti(2368)|0,Ti(2448)|0,Ti(2528)|0,E=n[544]|0):E=Q,A=u+192|0,w=u+184|0,de=E&255;e:do if((de>>>1^1)&Q<<24>>24==E<<24>>24|Q&2&de)for(x=u+80|0,R=u+112|0,I=u+108|0,E=u+680|0,C=u+664|0,B=u+672|0,U=0;;){if(Y=+y[R>>3],!(n[x>>0]|0))Y=+Ne(+Y,+ +(U|0));else{if(de=U+1|0,(U|0)>0){te=0,Q=1;do te=te+1|0,Q=Q<<1|1;while((Q|0)<(de|0));de=Q+-1|0}else te=0,de=0;if((de|0)!=(U|0)){Q=U;do Te=de>>1,te=te+-1|0,Q=(Q|0)%(Te|0)|0,de=Te+-1|0;while((de|0)!=(Q|0))}Y=+Ne(+Y,+ +(te|0))}if(Zr(L,u,~~(Y*+(s[I>>2]|0))),Q=n[L>>0]|0,n[E>>0]|0||(de=C,te=s[de+4>>2]|0,(te|0)>=0&&(Te=A,ne=s[Te+4>>2]|0,!(ne>>>0<te>>>0|((ne|0)==(te|0)?(s[Te>>2]|0)>>>0<(s[de>>2]|0)>>>0:0))))||(de=B,te=s[de+4>>2]|0,(te|0)>=0&&(ne=w,Te=s[ne+4>>2]|0,!(Te>>>0<te>>>0|((Te|0)==(te|0)?(s[ne>>2]|0)>>>0<(s[de>>2]|0)>>>0:0)))))break e;if(Te=n[544]|0,ne=Te&255,(ne>>>1^1)&Q<<24>>24==Te<<24>>24|Q&2&ne)U=U+1|0;else break}while(!1);if((s[P>>2]|0)>0&&Ti(2528)|0,Te=n[528]|0,ne=Te&255,L=Q&2,!((ne>>>1^1)&Q<<24>>24==Te<<24>>24|L&ne))Te=n[536]|0,ne=Te&255,(ne>>>1^1)&Q<<24>>24==Te<<24>>24|L&ne|0&&!(s[S>>2]|0)&&(n[b>>0]=0);else if(S=u+540|0,Zs(m,s[S>>2]|0),(s[S>>2]|0)>0){L=u+332|0,b=0;do n[(s[m>>2]|0)+b>>0]=n[(s[L>>2]|0)+b>>0]|0,b=b+1|0;while((b|0)<(s[S>>2]|0))}Mi(u,0),n[l>>0]=Q,g=f}function Cn(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0,B=0,R=0,U=0,Y=0,Q=0;if(m=g,S=l+412|0,lo(S),b=l+540|0,(s[b>>2]|0)>0){L=l+544|0,f=0;do{if(P=f<<1,A=s[S>>2]|0,w=A+(P*12|0)+4|0,(s[w>>2]|0)>0){I=A+(P*12|0)|0,E=0;do B=(s[I>>2]|0)+(E<<3)|0,A=s[B>>2]|0,x=s[L>>2]|0,C=x+(A<<2)|0,s[C>>2]&16?s[B>>2]=s[x+(A+1<<2)>>2]:(R=ui(u,C)|0,s[B>>2]=R,s[C>>2]=s[C>>2]|16,s[x+(A+1<<2)>>2]=R),E=E+1|0;while((E|0)<(s[w>>2]|0));w=s[S>>2]|0}else w=A;if(A=P|1,P=w+(A*12|0)+4|0,(s[P>>2]|0)>0){C=w+(A*12|0)|0,x=0;do w=(s[C>>2]|0)+(x<<3)|0,I=s[w>>2]|0,E=s[L>>2]|0,A=E+(I<<2)|0,s[A>>2]&16?s[w>>2]=s[E+(I+1<<2)>>2]:(R=ui(u,A)|0,s[w>>2]=R,s[A>>2]=s[A>>2]|16,s[E+(I+1<<2)>>2]=R),x=x+1|0;while((x|0)<(s[P>>2]|0))}f=f+1|0}while((f|0)<(s[b>>2]|0))}if(f=l+284|0,(s[f>>2]|0)>0){P=l+280|0,b=l+396|0,L=l+544|0,S=l+332|0,w=0;do{C=s[b>>2]|0,I=C+(s[(s[P>>2]|0)+(w<<2)>>2]>>1<<3)|0,x=s[I>>2]|0;do if((x|0)!=-1){if(R=s[L>>2]|0,B=R+(x<<2)|0,E=(s[B>>2]&16|0)==0,E){if(U=s[R+(x+1<<2)>>2]|0,A=U>>1,U=(a[(s[S>>2]|0)+A>>0]|0)^U&1,Q=n[528]|0,Y=Q&255,!((U&255)<<24>>24==Q<<24>>24&(Y>>>1^1)|Y&2&U)||(Q=s[C+(A<<3)>>2]|0,!((Q|0)!=-1&(Q|0)==(x|0))))break;if(E){Q=ui(u,B)|0,s[I>>2]=Q,s[B>>2]=s[B>>2]|16,s[R+(x+1<<2)>>2]=Q;break}}s[I>>2]=s[R+(x+1<<2)>>2]}while(!1);w=w+1|0}while((w|0)<(s[f>>2]|0))}if(f=l+272|0,A=s[f>>2]|0,(A|0)>0){L=l+268|0,S=l+544|0,w=s[L>>2]|0,b=0,P=0;do I=w+(b<<2)|0,E=s[I>>2]|0,C=s[S>>2]|0,x=C+(E<<2)|0,B=s[x>>2]|0,(B&3|0)!=1&&(B&16?(A=s[C+(E+1<<2)>>2]|0,s[I>>2]=A):(A=ui(u,x)|0,s[I>>2]=A,s[x>>2]=s[x>>2]|16,s[C+(E+1<<2)>>2]=A,A=s[L>>2]|0,w=A,A=s[A+(b<<2)>>2]|0),s[w+(P<<2)>>2]=A,A=s[f>>2]|0,P=P+1|0),b=b+1|0;while((b|0)<(A|0))}else b=0,P=0;if(S=b-P|0,(S|0)>0&&(s[f>>2]=A-S),f=l+260|0,w=s[f>>2]|0,(w|0)>0){S=l+256|0,l=l+544|0,P=s[S>>2]|0,L=0,b=0;do A=P+(L<<2)|0,I=s[A>>2]|0,E=s[l>>2]|0,C=E+(I<<2)|0,x=s[C>>2]|0,(x&3|0)!=1&&(x&16?(w=s[E+(I+1<<2)>>2]|0,s[A>>2]=w):(w=ui(u,C)|0,s[A>>2]=w,s[C>>2]=s[C>>2]|16,s[E+(I+1<<2)>>2]=w,w=s[S>>2]|0,P=w,w=s[w+(L<<2)>>2]|0),s[P+(b<<2)>>2]=w,w=s[f>>2]|0,b=b+1|0),L=L+1|0;while((L|0)<(w|0))}else L=0,b=0;if(u=L-b|0,(u|0)<=0){g=m;return}s[f>>2]=w-u,g=m}function eo(l){l=l|0;var u=0,m=0,f=0,S=0,L=0,b=0,P=0;S=g,g=g+32|0,b=S,u=S+8|0,m=l+548|0,f=l+556|0,L=(s[m>>2]|0)-(s[f>>2]|0)|0,s[u+0>>2]=0,s[u+4>>2]=0,s[u+8>>2]=0,s[u+12>>2]=0,Xi(u,L),L=u+16|0,n[L>>0]=0,Cn(l,u),(s[l+44>>2]|0)>1&&(P=s[u+4>>2]<<2,s[b>>2]=s[m>>2]<<2,s[b+4>>2]=P,Vi(1888,b|0)|0),n[l+560>>0]=n[L>>0]|0,L=l+544|0,b=s[L>>2]|0,b&&Me(b),s[L>>2]=s[u>>2],s[m>>2]=s[u+4>>2],s[l+552>>2]=s[u+8>>2],s[f>>2]=s[u+12>>2],g=S}function to(){var l=0,u=0,m=0;l=g,g=g+16|0,u=l,n[528]=0,n[536]=1,n[544]=2,At(552,608,624,2136,2144),s[138]=2168,y[72]=0,y[73]=1,n[592]=0,n[593]=0,r[297]=r[u+0>>1]|0,r[298]=r[u+2>>1]|0,r[299]=r[u+4>>1]|0,y[75]=.95,At(664,720,736,2136,2144),s[166]=2168,y[86]=0,y[87]=1,n[704]=0,n[705]=0,r[353]=r[u+0>>1]|0,r[354]=r[u+2>>1]|0,r[355]=r[u+4>>1]|0,y[89]=.999,At(776,832,848,2136,2144),s[194]=2168,y[100]=0,y[101]=1,n[816]=1,n[817]=1,r[409]=r[u+0>>1]|0,r[410]=r[u+2>>1]|0,r[411]=r[u+4>>1]|0,y[103]=0,At(936,992,1008,2136,2144),s[234]=2168,y[120]=0,y[121]=J,n[976]=0,n[977]=0,r[489]=r[u+0>>1]|0,r[490]=r[u+2>>1]|0,r[491]=r[u+4>>1]|0,y[123]=91648253,At(1048,1080,1096,2136,2016),s[262]=280,m=1068,s[m>>2]=0,s[m+4>>2]=2,s[269]=2,At(1160,1192,1208,2136,2016),s[290]=280,m=1180,s[m>>2]=0,s[m+4>>2]=2,s[297]=2,At(1272,1296,1312,2136,1992),s[318]=160,n[1292]=0,At(1344,1368,1376,2136,1992),s[336]=160,n[1364]=1,At(1408,1440,1448,2136,2016),s[352]=280,m=1428,s[m>>2]=1,s[m+4>>2]=2147483647,s[359]=100,At(1480,1536,1544,2136,2144),s[370]=2168,y[188]=1,y[189]=J,n[1520]=0,n[1521]=0,r[761]=r[u+0>>1]|0,r[762]=r[u+2>>1]|0,r[763]=r[u+4>>1]|0,y[191]=2,At(1584,1640,1648,2136,2144),s[396]=2168,y[201]=0,y[202]=J,n[1624]=0,n[1625]=0,r[813]=r[u+0>>1]|0,r[814]=r[u+2>>1]|0,r[815]=r[u+4>>1]|0,y[204]=.2,At(1728,1760,1776,2136,2016),s[432]=280,u=1748,s[u>>2]=0,s[u+4>>2]=2147483647,s[439]=0,g=l}function io(l){l=l|0;var u=0;u=g,ci(l),g=u}function so(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0;if(m=g,g=g+16|0,L=m,S=m+8|0,(n[u>>0]|0)!=45)return E=0,g=m,E|0;w=u+1|0,f=l+4|0,b=s[f>>2]|0,P=n[b>>0]|0;e:do if(P<<24>>24){for(A=0;;){if(E=A,A=A+1|0,(n[w>>0]|0)!=P<<24>>24){l=0;break}if(P=n[b+A>>0]|0,w=u+(E+2)|0,!(P<<24>>24))break e}return g=m,l|0}while(!1);return(n[w>>0]|0)!=61||(b=w+1|0,I=+aa(b,S),!(s[S>>2]|0))?(E=0,g=m,E|0):(x=+y[l+32>>3],I>=x&&(n[l+41>>0]|0)==0|I!=x&&(E=s[F>>2]|0,A=s[f>>2]|0,s[L>>2]=b,s[L+4>>2]=A,Rt(E|0,2024,L|0)|0,Os(1)),x=+y[l+24>>3],I<=x&&(n[l+40>>0]|0)==0|I!=x&&(E=s[F>>2]|0,A=s[f>>2]|0,s[L>>2]=b,s[L+4>>2]=A,Rt(E|0,2080,L|0)|0,Os(1)),y[l+48>>3]=I,E=1,g=m,E|0)}function no(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0;if(m=g,g=g+48|0,f=m,S=s[F>>2]|0,E=s[l+16>>2]|0,P=n[l+40>>0]|0?91:40,A=+y[l+24>>3],w=+y[l+32>>3],L=n[l+41>>0]|0?93:41,b=+y[l+48>>3],s[f>>2]=s[l+4>>2],s[f+4>>2]=E,s[f+8>>2]=P,P=f+12|0,y[O>>3]=A,s[P>>2]=s[O>>2],s[P+4>>2]=s[O+4>>2],P=f+20|0,y[O>>3]=w,s[P>>2]=s[O>>2],s[P+4>>2]=s[O+4>>2],s[f+28>>2]=L,L=f+32|0,y[O>>3]=b,s[L>>2]=s[O>>2],s[L+4>>2]=s[O+4>>2],Rt(S|0,2232,f|0)|0,!u){g=m;return}s[f>>2]=s[l+8>>2],Rt(S|0,2e3,f|0)|0,Yi(10,S|0)|0,g=m}function Xi(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0;if(m=g,f=l+8|0,S=s[f>>2]|0,S>>>0<u>>>0)b=S;else{g=m;return}for(;!(b>>>0>=u>>>0);)if(b=((b>>>3)+2+(b>>>1)&-2)+b|0,s[f>>2]=b,b>>>0<=S>>>0){L=4;break}(L|0)==4&&ze(Ge(1)|0,48,0),f=ht(s[l>>2]|0,b<<2)|0,!(f|0)&&(s[(Xe()|0)>>2]|0)==12&&ze(Ge(1)|0,48,0),s[l>>2]=f,g=m}function ro(l){l=l|0;var u=0,m=0,f=0,S=0,L=0,b=0,P=0;if(u=g,f=l+32|0,m=s[f>>2]|0,m&&(s[l+36>>2]=0,Me(m),s[f>>2]=0,s[l+40>>2]=0),f=l+16|0,m=s[f>>2]|0,m&&(s[l+20>>2]=0,Me(m),s[f>>2]=0,s[l+24>>2]=0),f=s[l>>2]|0,!f){g=u;return}if(m=l+4|0,L=s[m>>2]|0,(L|0)>0){S=0;do P=f+(S*12|0)|0,b=s[P>>2]|0,b&&(s[f+(S*12|0)+4>>2]=0,Me(b),s[P>>2]=0,s[f+(S*12|0)+8>>2]=0,f=s[l>>2]|0,L=s[m>>2]|0),S=S+1|0;while((S|0)<(L|0))}s[m>>2]=0,Me(f),s[l>>2]=0,s[l+8>>2]=0,g=u}function Dn(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0;if(S=g,g=g+16|0,f=S+4|0,m=S,A=s[u>>2]|0,b=A+1|0,L=l+4|0,(s[L>>2]|0)<(b|0)){if(w=l+8|0,P=s[w>>2]|0,(P|0)<(b|0)&&(E=A+2-P&-2,A=(P>>1)+2&-2,A=(E|0)>(A|0)?E:A,(A|0)>(2147483647-P|0)&&(E=Ge(1)|0,ze(E|0,48,0)),I=s[l>>2]|0,E=A+P|0,s[w>>2]=E,E=ht(I,E*12|0)|0,s[l>>2]=E,!(E|0)&&(s[(Xe()|0)>>2]|0)==12&&(I=Ge(1)|0,ze(I|0,48,0))),w=s[L>>2]|0,(w|0)<(b|0)){P=s[l>>2]|0;do A=P+(w*12|0)|0,A&&(s[A>>2]=0,s[P+(w*12|0)+4>>2]=0,s[P+(w*12|0)+8>>2]=0),w=w+1|0;while((w|0)!=(b|0))}s[L>>2]=b,A=s[u>>2]|0}if(L=s[l>>2]|0,!(s[L+(A*12|0)>>2]|0)){E=A,I=l+16|0,s[m>>2]=E,s[f+0>>2]=s[m+0>>2],Vs(I,f,0),g=S;return}s[L+(A*12|0)+4>>2]=0,E=s[u>>2]|0,I=l+16|0,s[m>>2]=E,s[f+0>>2]=s[m+0>>2],Vs(I,f,0),g=S}function Zs(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0,w=0;if(f=g,m=l+4|0,(s[m>>2]|0)>=(u|0)){g=f;return}if(L=l+8|0,S=s[L>>2]|0,(S|0)<(u|0)&&(P=u+1-S&-2,b=(S>>1)+2&-2,b=(P|0)>(b|0)?P:b,(b|0)>(2147483647-S|0)&&(P=Ge(1)|0,ze(P|0,48,0)),w=s[l>>2]|0,P=b+S|0,s[L>>2]=P,P=ht(w,P)|0,s[l>>2]=P,!(P|0)&&(s[(Xe()|0)>>2]|0)==12&&(w=Ge(1)|0,ze(w|0,48,0))),S=s[m>>2]|0,(S|0)<(u|0)){l=s[l>>2]|0;do L=l+S|0,L&&(n[L>>0]=0),S=S+1|0;while((S|0)!=(u|0))}s[m>>2]=u,g=f}function ji(l,u,m){l=l|0,u=u|0,m=m|0;var f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0;if(L=g,S=u+1|0,f=l+4|0,(s[f>>2]|0)>=(S|0)){w=s[l>>2]|0,w=w+u|0,n[w>>0]=m,g=L;return}if(P=l+8|0,b=s[P>>2]|0,(b|0)<(S|0)&&(A=u+2-b&-2,w=(b>>1)+2&-2,w=(A|0)>(w|0)?A:w,(w|0)>(2147483647-b|0)&&(A=Ge(1)|0,ze(A|0,48,0)),E=s[l>>2]|0,A=w+b|0,s[P>>2]=A,A=ht(E,A)|0,s[l>>2]=A,!(A|0)&&(s[(Xe()|0)>>2]|0)==12&&(E=Ge(1)|0,ze(E|0,48,0))),b=s[f>>2]|0,(b|0)<(S|0))do P=(s[l>>2]|0)+b|0,P&&(n[P>>0]=0),b=b+1|0;while((b|0)!=(S|0));s[f>>2]=S,E=s[l>>2]|0,E=E+u|0,n[E>>0]=m,g=L}function Js(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0;if(m=g,g=g+16|0,L=m,s[L>>2]=u,b=l+12|0,S=u+1|0,f=l+16|0,(s[f>>2]|0)<(S|0)&&(w=l+20|0,P=s[w>>2]|0,(P|0)<(S|0)&&(E=u+2-P&-2,A=(P>>1)+2&-2,A=(E|0)>(A|0)?E:A,(A|0)>(2147483647-P|0)&&(E=Ge(1)|0,ze(E|0,48,0)),I=s[b>>2]|0,E=A+P|0,s[w>>2]=E,E=ht(I,E<<2)|0,s[b>>2]=E,!(E|0)&&(s[(Xe()|0)>>2]|0)==12&&(I=Ge(1)|0,ze(I|0,48,0))),P=s[f>>2]|0,(S|0)>(P|0)&&Ms((s[b>>2]|0)+(P<<2)|0,-1,S-P<<2|0)|0,s[f>>2]=S),s[(s[b>>2]|0)+(u<<2)>>2]=s[l+4>>2],ti(l,L),f=s[b>>2]|0,L=s[f+(u<<2)>>2]|0,u=s[l>>2]|0,S=s[u+(L<<2)>>2]|0,!L){E=0,I=u+(E<<2)|0,s[I>>2]=S,I=f+(S<<2)|0,s[I>>2]=E,g=m;return}for(l=l+28|0;;){if(b=L,L=L+-1>>1,P=u+(L<<2)|0,w=s[P>>2]|0,I=s[s[l>>2]>>2]|0,!(+y[I+(S<<3)>>3]>+y[I+(w<<3)>>3])){l=14;break}if(s[u+(b<<2)>>2]=w,s[f+(s[P>>2]<<2)>>2]=b,!L){b=0,l=14;break}}if((l|0)==14){I=u+(b<<2)|0,s[I>>2]=S,I=f+(S<<2)|0,s[I>>2]=b,g=m;return}}function Gt(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0;if(m=g,f=l+4|0,S=s[f>>2]|0,L=l+8|0,b=s[L>>2]|0,(S|0)==(b|0)&(b|0)<(S+1|0)?(b=(S>>1)+2&-2,b=(b|0)<2?2:b,(b|0)>(2147483647-S|0)&&(b=Ge(1)|0,ze(b|0,48,0)),P=s[l>>2]|0,S=b+S|0,s[L>>2]=S,S=ht(P,S<<2)|0,s[l>>2]=S,!(S|0)&&(s[(Xe()|0)>>2]|0)==12&&(P=Ge(1)|0,ze(P|0,48,0))):S=s[l>>2]|0,P=s[f>>2]|0,s[f>>2]=P+1,f=S+(P<<2)|0,!f){g=m;return}s[f>>2]=s[u>>2],g=m}function ti(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0;if(m=g,f=l+4|0,S=s[f>>2]|0,L=l+8|0,b=s[L>>2]|0,(S|0)==(b|0)&(b|0)<(S+1|0)?(b=(S>>1)+2&-2,b=(b|0)<2?2:b,(b|0)>(2147483647-S|0)&&(b=Ge(1)|0,ze(b|0,48,0)),P=s[l>>2]|0,S=b+S|0,s[L>>2]=S,S=ht(P,S<<2)|0,s[l>>2]=S,!(S|0)&&(s[(Xe()|0)>>2]|0)==12&&(P=Ge(1)|0,ze(P|0,48,0))):S=s[l>>2]|0,P=s[f>>2]|0,s[f>>2]=P+1,f=S+(P<<2)|0,!f){g=m;return}s[f>>2]=s[u>>2],g=m}function en(l,u,m){l=l|0,u=u|0,m=m|0;var f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0;if(m=g,g=g+16|0,f=m+2|0,L=m+1|0,S=m,(u|0)<16){if(S=u+-1|0,(S|0)>0)L=0;else{g=m;return}do{if(f=L,L=L+1|0,(L|0)<(u|0)){P=f,b=L;do P=(s[l+(b<<2)>>2]|0)<(s[l+(P<<2)>>2]|0)?b:P,b=b+1|0;while((b|0)!=(u|0))}else P=f;E=l+(f<<2)|0,I=s[E>>2]|0,x=l+(P<<2)|0,s[E>>2]=s[x>>2],s[x>>2]=I}while((L|0)!=(S|0));g=m;return}for(b=s[l+(((u|0)/2|0)<<2)>>2]|0,A=-1,E=u;;){do A=A+1|0,w=l+(A<<2)|0,P=s[w>>2]|0;while((P|0)<(b|0));do E=E+-1|0,I=l+(E<<2)|0,x=s[I>>2]|0;while((b|0)<(x|0));if((A|0)>=(E|0))break;s[w>>2]=x,s[I>>2]=P}n[f+0>>0]=n[L+0>>0]|0,en(l,A,f),x=u-A|0,n[f+0>>0]=n[S+0>>0]|0,en(w,x,f),g=m}function tn(l,u,m){l=l|0,u=u|0,m=m|0;var f=0,S=0,L=0,b=0,P=0,w=0;if(f=g,b=m&1,L=a[l+16>>0]|0|b,S=u+4|0,P=((L+(s[S>>2]|0)<<2)+4|0)>>>2,w=l+4|0,Xi(l,P+(s[w>>2]|0)|0),m=s[w>>2]|0,P=P+m|0,s[w>>2]=P,P>>>0<m>>>0&&ze(Ge(1)|0,48,0),l=(s[l>>2]|0)+(m<<2)|0,!l)return g=f,m|0;if(L=L<<3|b<<2,s[l>>2]=s[l>>2]&-32|L,L=s[S>>2]<<5|L,s[l>>2]=L,(s[S>>2]|0)>0){L=s[u>>2]|0,u=0;do s[l+(u<<2)+4>>2]=s[L+(u<<2)>>2],u=u+1|0;while((u|0)<(s[S>>2]|0));L=s[l>>2]|0}if(!(L&8))return g=f,m|0;if(S=L>>>5,L&4)return d[l+(S<<2)+4>>2]=0,g=f,m|0;if(!S)S=0,L=0;else{L=0,u=0;do L=1<<((s[l+(u<<2)+4>>2]|0)>>>1&31)|L,u=u+1|0;while((u|0)<(S|0))}return s[l+(S<<2)+4>>2]=L,g=f,m|0}function sn(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0;if(m=g,f=l+4|0,S=s[f>>2]|0,L=l+8|0,b=s[L>>2]|0,(S|0)==(b|0)&(b|0)<(S+1|0)?(b=(S>>1)+2&-2,b=(b|0)<2?2:b,(b|0)>(2147483647-S|0)&&(b=Ge(1)|0,ze(b|0,48,0)),P=s[l>>2]|0,S=b+S|0,s[L>>2]=S,S=ht(P,S<<3)|0,s[l>>2]=S,!(S|0)&&(s[(Xe()|0)>>2]|0)==12&&(P=Ge(1)|0,ze(P|0,48,0))):S=s[l>>2]|0,P=s[f>>2]|0,s[f>>2]=P+1,f=S+(P<<3)|0,!f){g=m;return}L=u,b=s[L+4>>2]|0,P=f,s[P>>2]=s[L>>2],s[P+4>>2]=b,g=m}function oo(l){l=l|0;var u=0,m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0,B=0,R=0;if(u=g,m=s[l>>2]|0,S=s[m>>2]|0,P=l+4|0,I=s[m+((s[P>>2]|0)+-1<<2)>>2]|0,s[m>>2]=I,f=s[l+12>>2]|0,s[f+(I<<2)>>2]=0,s[f+(S<<2)>>2]=-1,I=(s[P>>2]|0)+-1|0,s[P>>2]=I,(I|0)<=1)return g=u,S|0;for(L=s[m>>2]|0,w=l+28|0,l=0,A=1;E=(l<<1)+2|0,(E|0)<(I|0)?(x=s[m+(E<<2)>>2]|0,R=s[m+(A<<2)>>2]|0,I=s[s[w>>2]>>2]|0,C=+y[I+(x<<3)>>3],B=+y[I+(R<<3)>>3],C>B||(x=R,C=B,b=6)):(I=s[s[w>>2]>>2]|0,b=s[m+(A<<2)>>2]|0,x=b,C=+y[I+(b<<3)>>3],b=6),(b|0)==6&&(b=0,E=A),C>+y[I+(L<<3)>>3];)if(s[m+(l<<2)>>2]=x,s[f+(x<<2)>>2]=l,A=E<<1|1,I=s[P>>2]|0,(A|0)>=(I|0)){l=E;break}else l=E;return s[m+(l<<2)>>2]=L,s[f+(L<<2)>>2]=l,g=u,S|0}function Vs(l,u,m){l=l|0,u=u|0,m=m|0;var f=0,S=0,L=0,b=0,P=0,w=0,A=0;if(f=g,P=s[u>>2]|0,u=P+1|0,S=l+4|0,(s[S>>2]|0)>=(u|0)){g=f;return}if(b=l+8|0,L=s[b>>2]|0,(L|0)<(u|0)&&(w=P+2-L&-2,P=(L>>1)+2&-2,P=(w|0)>(P|0)?w:P,(P|0)>(2147483647-L|0)&&(w=Ge(1)|0,ze(w|0,48,0)),A=s[l>>2]|0,w=P+L|0,s[b>>2]=w,w=ht(A,w)|0,s[l>>2]=w,!(w|0)&&(s[(Xe()|0)>>2]|0)==12&&(A=Ge(1)|0,ze(A|0,48,0))),L=s[S>>2]|0,(L|0)<(u|0))do n[(s[l>>2]|0)+L>>0]=m,L=L+1|0;while((L|0)!=(u|0));s[S>>2]=u,g=f}function nn(l,u,m){l=l|0,u=u|0,m=m|0;var f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0,B=0,R=0,U=0,Y=0,Q=0;if(f=g,g=g+16|0,L=f+8|0,S=f+4|0,b=f,(u|0)<16){if(S=u+-1|0,(S|0)<=0){g=f;return}L=s[m>>2]|0,m=0;do{if(b=m,m=m+1|0,(m|0)<(u|0)){P=s[L>>2]|0,A=b,w=m;do E=P+(s[l+(w<<2)>>2]<<2)|0,Y=s[E>>2]|0,C=Y>>>5,Y>>>0>95&&(I=P+(s[l+(A<<2)>>2]<<2)|0,x=(s[I>>2]|0)>>>5,(x|0)==2?A=w:A=+d[E+(C<<2)+4>>2]<+d[I+(x<<2)+4>>2]?w:A),w=w+1|0;while((w|0)!=(u|0))}else A=b;R=l+(b<<2)|0,U=s[R>>2]|0,Y=l+(A<<2)|0,s[R>>2]=s[Y>>2],s[Y>>2]=U}while((m|0)!=(S|0));g=f;return}for(P=s[l+(((u|0)/2|0)<<2)>>2]|0,C=-1,I=u;;){U=C+1|0,x=l+(U<<2)|0,Y=s[x>>2]|0,w=s[m>>2]|0,A=s[w>>2]|0,R=A+(Y<<2)|0,B=s[R>>2]|0,C=A+(P<<2)|0,E=s[C>>2]|0;e:do if(B>>>0>95)for(;;){if(Q=E>>>5,(Q|0)!=2&&!(+d[R+(B>>>5<<2)+4>>2]<+d[C+(Q<<2)+4>>2])){C=U;break e}if(U=U+1|0,x=l+(U<<2)|0,Y=s[x>>2]|0,R=A+(Y<<2)|0,B=s[R>>2]|0,B>>>0<=95){C=U;break}}else C=U;while(!1);I=I+-1|0,R=l+(I<<2)|0,B=A+(P<<2)|0;e:do if(E>>>0>95)for(;;){if(U=A+(s[R>>2]<<2)|0,Q=(s[U>>2]|0)>>>5,(Q|0)!=2&&!(+d[B+(E>>>5<<2)+4>>2]<+d[U+(Q<<2)+4>>2]))break e;Q=I+-1|0,R=l+(Q<<2)|0,I=Q}while(!1);if((C|0)>=(I|0))break;s[x>>2]=s[R>>2],s[R>>2]=Y}s[S>>2]=w,s[L+0>>2]=s[S+0>>2],nn(l,C,L),Q=u-C|0,s[b>>2]=w,s[L+0>>2]=s[b+0>>2],nn(x,Q,L),g=f}function ao(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0,B=0,R=0;if(f=g,S=l+4|0,b=s[S>>2]|0,L=s[l>>2]|0,(b|0)>0){w=s[l+12>>2]|0,P=0;do s[w+(s[L+(P<<2)>>2]<<2)>>2]=-1,P=P+1|0,b=s[S>>2]|0;while((P|0)<(b|0))}if(L&&(s[S>>2]=0,b=0),L=u+4|0,(s[L>>2]|0)>0){P=l+12|0,b=0;do R=(s[u>>2]|0)+(b<<2)|0,s[(s[P>>2]|0)+(s[R>>2]<<2)>>2]=b,ti(l,R),b=b+1|0;while((b|0)<(s[L>>2]|0));b=s[S>>2]|0}if((b|0)<=1){g=f;return}for(L=s[l>>2]|0,u=l+28|0,l=l+12|0,I=b,P=(b|0)/2|0;;){P=P+-1|0,b=s[L+(P<<2)>>2]|0,A=P<<1|1;e:do if((A|0)<(I|0))for(w=P;;){if(E=(w<<1)+2|0,(E|0)<(I|0)?(x=s[L+(E<<2)>>2]|0,R=s[L+(A<<2)>>2]|0,I=s[s[u>>2]>>2]|0,C=+y[I+(x<<3)>>3],B=+y[I+(R<<3)>>3],C>B||(x=R,C=B,m=16)):(I=s[s[u>>2]>>2]|0,m=s[L+(A<<2)>>2]|0,x=m,C=+y[I+(m<<3)>>3],m=16),(m|0)==16&&(m=0,E=A),!(C>+y[I+(b<<3)>>3]))break e;if(s[L+(w<<2)>>2]=x,s[(s[l>>2]|0)+(x<<2)>>2]=w,A=E<<1|1,I=s[S>>2]|0,(A|0)>=(I|0)){w=E;break}else w=E}else w=P;while(!1);if(s[L+(w<<2)>>2]=b,s[(s[l>>2]|0)+(b<<2)>>2]=w,(P|0)<=0)break;I=s[S>>2]|0}g=f}function lo(l){l=l|0;var u=0,m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0,B=0,R=0;if(m=g,u=l+36|0,w=s[u>>2]|0,f=l+32|0,E=s[f>>2]|0,(w|0)>0){L=l+16|0,S=l+44|0,b=0;do{if(P=E+(b<<2)|0,A=s[P>>2]|0,n[(s[L>>2]|0)+A>>0]|0){if(E=s[l>>2]|0,w=E+(A*12|0)+4|0,x=s[w>>2]|0,(x|0)>0){A=E+(A*12|0)|0,E=0,I=0;do C=s[A>>2]|0,B=C+(E<<3)|0,(s[(s[s[S>>2]>>2]|0)+(s[B>>2]<<2)>>2]&3|0)!=1&&(R=B,B=s[R+4>>2]|0,x=C+(I<<3)|0,s[x>>2]=s[R>>2],s[x+4>>2]=B,x=s[w>>2]|0,I=I+1|0),E=E+1|0;while((E|0)<(x|0))}else E=0,I=0;A=E-I|0,(A|0)>0&&(s[w>>2]=x-A),n[(s[L>>2]|0)+(s[P>>2]|0)>>0]=0,w=s[u>>2]|0,E=s[f>>2]|0}b=b+1|0}while((b|0)<(w|0))}if(!E){g=m;return}s[u>>2]=0,g=m}function ui(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0;if(f=g,L=s[u>>2]|0,S=L>>>2&1|(a[l+16>>0]|0),L=((S+(L>>>5)<<2)+4|0)>>>2,b=l+4|0,Xi(l,L+(s[b>>2]|0)|0),m=s[b>>2]|0,L=L+m|0,s[b>>2]=L,L>>>0<m>>>0&&ze(Ge(1)|0,48,0),l=(s[l>>2]|0)+(m<<2)|0,!l)return g=f,m|0;if(S=s[u>>2]&-9|S<<3,s[l>>2]=S,(s[u>>2]|0)>>>0>31){S=0;do s[l+(S<<2)+4>>2]=s[u+(S<<2)+4>>2],S=S+1|0;while((S|0)<((s[u>>2]|0)>>>5|0));S=s[l>>2]|0}return S&8?(L=S>>>5,u=u+(L<<2)+4|0,S&4?(d[l+(L<<2)+4>>2]=+d[u>>2],g=f,m|0):(s[l+(L<<2)+4>>2]=s[u>>2],g=f,m|0)):(g=f,m|0)}function In(l){l=l|0;var u=0,m=0,f=0,S=0,L=0,b=0;if(u=g,g=g+16|0,S=u,Ur(l),s[l>>2]=3424,s[l+684>>2]=s[719],s[l+688>>2]=s[747],s[l+692>>2]=s[785],y[l+696>>3]=+y[411],n[l+704>>0]=n[2652]|0,n[l+705>>0]=n[2724]|0,n[l+706>>0]=n[2804]|0,n[l+707>>0]=1,s[l+708>>2]=0,s[l+712>>2]=0,s[l+716>>2]=0,s[l+720>>2]=1,n[l+724>>0]=1,m=l+732|0,b=l+544|0,s[l+760>>2]=0,s[l+764>>2]=0,s[l+768>>2]=0,s[l+776>>2]=0,s[l+780>>2]=0,s[l+784>>2]=0,s[l+792>>2]=0,s[l+796>>2]=0,s[l+800>>2]=0,L=l+804|0,s[m+0>>2]=0,s[m+4>>2]=0,s[m+8>>2]=0,s[m+12>>2]=0,s[m+16>>2]=0,s[m+20>>2]=0,s[L>>2]=b,L=l+808|0,s[L>>2]=0,s[l+812>>2]=0,s[l+816>>2]=0,m=l+824|0,s[m+0>>2]=0,s[m+4>>2]=0,s[m+8>>2]=0,s[m+12>>2]=0,s[m+16>>2]=0,s[m+20>>2]=0,s[l+852>>2]=L,Mn(l+856|0,1),L=l+868|0,m=l+892|0,s[l+920>>2]=0,s[l+924>>2]=0,s[L+0>>2]=0,s[L+4>>2]=0,s[L+8>>2]=0,s[L+12>>2]=0,s[L+16>>2]=0,s[m+0>>2]=0,s[m+4>>2]=0,s[m+8>>2]=0,s[m+12>>2]=0,s[m+16>>2]=0,s[m+20>>2]=0,m=S+4|0,s[m>>2]=0,L=S+8|0,s[L>>2]=2,f=ht(0,8)|0,s[S>>2]=f,!(f|0)&&(s[(Xe()|0)>>2]|0)==12&&ze(Ge(1)|0,48,0),s[f>>2]=-2,s[m>>2]=1,n[l+560>>0]=1,s[l+928>>2]=tn(b,S,0)|0,n[l+536>>0]=0,!f){g=u;return}s[m>>2]=0,Me(f),s[S>>2]=0,s[L>>2]=0,g=u}function ho(l){l=l|0;var u=0;u=g,On(l),ci(l),g=u}function On(l){l=l|0;var u=0,m=0,f=0;if(u=g,s[l>>2]=3424,m=l+904|0,f=s[m>>2]|0,f&&(s[l+908>>2]=0,Me(f),s[m>>2]=0,s[l+912>>2]=0),m=l+892|0,f=s[m>>2]|0,f&&(s[l+896>>2]=0,Me(f),s[m>>2]=0,s[l+900>>2]=0),m=l+876|0,f=s[m>>2]|0,f&&(s[l+880>>2]=0,Me(f),s[m>>2]=0,s[l+884>>2]=0),m=l+856|0,f=s[m>>2]|0,f&&(s[l+860>>2]=0,Me(f),s[m>>2]=0,s[l+864>>2]=0),f=l+836|0,m=s[f>>2]|0,m&&(s[l+840>>2]=0,Me(m),s[f>>2]=0,s[l+844>>2]=0),m=l+824|0,f=s[m>>2]|0,f&&(s[l+828>>2]=0,Me(f),s[m>>2]=0,s[l+832>>2]=0),m=l+808|0,f=s[m>>2]|0,f&&(s[l+812>>2]=0,Me(f),s[m>>2]=0,s[l+816>>2]=0),Lo(l+760|0),m=l+744|0,f=s[m>>2]|0,f&&(s[l+748>>2]=0,Me(f),s[m>>2]=0,s[l+752>>2]=0),m=l+732|0,f=s[m>>2]|0,!f){xs(l),g=u;return}s[l+736>>2]=0,Me(f),s[m>>2]=0,s[l+740>>2]=0,xs(l),g=u}function rn(l,u,m){l=l|0,u=u|0,m=m|0;var f=0,S=0,L=0,b=0,P=0,w=0;return f=g,g=g+32|0,L=f+12|0,P=f+8|0,w=f+16|0,S=f+4|0,b=f,n[w>>0]=n[u>>0]|0,n[L+0>>0]=n[w+0>>0]|0,m=Gr(l,L,m)|0,s[P>>2]=m,ji(l+876|0,m,0),ji(l+904|0,m,0),n[l+724>>0]|0?(w=l+808|0,u=m<<1,s[S>>2]=u,s[L+0>>2]=s[S+0>>2],Rn(w,L,0),s[b>>2]=u|1,s[L+0>>2]=s[b+0>>2],Rn(w,L,0),Ao(l+760|0,P),ji(l+744|0,m,0),Nn(l+824|0,m),g=f,m|0):(g=f,m|0)}function xn(l,u,m,f){l=l|0,u=u|0,m=m|0,f=f|0;var S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0,B=0,R=0,U=0,Y=0,Q=0,te=0;if(b=g,g=g+32|0,S=b+4|0,C=b,I=b+16|0,s[S>>2]=0,L=S+4|0,s[L>>2]=0,P=S+8|0,s[P>>2]=0,B=n[2608]|0,n[l>>0]=B,w=u+724|0,m=(a[w>>0]&(m&1)|0)!=0,m){if(U=u+308|0,te=s[U>>2]|0,(te|0)>0){R=u+304|0,B=u+876|0,Y=0;do Q=s[(s[R>>2]|0)+(Y<<2)>>2]>>1,s[C>>2]=Q,Q=(s[B>>2]|0)+Q|0,n[Q>>0]|0||(n[Q>>0]=1,ti(S,C),te=s[U>>2]|0),Y=Y+1|0;while((Y|0)<(te|0))}C=(Vn(u,f)|0)&1^1,n[l>>0]=C,f=n[2608]|0}else f=B,C=B;if(te=f&255,(te>>>1^1)&C<<24>>24==f<<24>>24|te&2&(C&255)?(Jr(I,u),C=n[I>>0]|0,n[l>>0]=C):(s[u+44>>2]|0)>0&&Ti(3760)|0,Q=n[2608]|0,te=Q&255,(te>>>1^1)&C<<24>>24==Q<<24>>24|te&2&(C&255)|0&&n[u+707>>0]|0&&(x=(s[u+736>>2]|0)+-1|0,(x|0)>0)){l=u+732|0,I=u+4|0;do{f=s[l>>2]|0,U=s[f+(x<<2)>>2]|0,Y=x+-1|0,Q=s[f+(Y<<2)>>2]|0,x=s[I>>2]|0;e:do if((U|0)>1)for(B=n[2616]|0,C=B&255,R=C&2,C=C>>>1^1,te=Y;;){if(Q=a[x+(Q>>1)>>0]^Q&1,Y=U+-1|0,!((Q&255)<<24>>24==B<<24>>24&C|R&Q))break e;if(U=te+-1|0,Q=s[f+(U<<2)>>2]|0,(Y|0)>1)te=U,U=Y;else{te=U,U=Y,E=20;break}}else te=Y,E=20;while(!1);(E|0)==20&&(E=0,n[x+(Q>>1)>>0]=(Q&1^1)&255^1),x=te-U|0}while((x|0)>0)}if(m&&(A=s[L>>2]|0,(A|0)>0)){E=s[S>>2]|0,m=u+876|0,I=0;do l=s[E+(I<<2)>>2]|0,n[(s[m>>2]|0)+l>>0]=0,n[w>>0]|0&&hn(u,l),I=I+1|0;while((I|0)<(A|0))}if(u=s[S>>2]|0,!u){g=b;return}s[L>>2]=0,Me(u),s[S>>2]=0,s[P>>2]=0,g=b}function Vn(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0,B=0,R=0,U=0,Y=0,Q=0,te=0,de=0,Ce=0,Te=0,ne=0,Se=0,Ee=0,me=0,_e=0,ue=0,be=0,ge=0;if(P=g,g=g+16|0,L=P,!(wn(l)|0))return ue=0,g=P,ue|0;if(b=l+724|0,!(n[b>>0]|0))return ue=1,g=P,ue|0;Q=l+924|0,U=l+872|0,Y=l+868|0,R=l+860|0,x=l+680|0,te=l+824|0,S=l+828|0,A=l+836|0,de=l+904|0,Ce=l+332|0,m=l+44|0,Te=l+704|0,Se=l+706|0,Ee=l+696|0,E=l+556|0,I=l+548|0,ne=l+876|0,C=l+920|0,B=l+284|0;e:for(;!((s[Q>>2]|0)<=0&&(s[C>>2]|0)>=(s[B>>2]|0)&&(s[S>>2]|0)<=0);){if(po(l),_e=s[U>>2]|0,ue=s[Y>>2]|0,me=_e-ue|0,(_e|0)<(ue|0)&&(me=(s[R>>2]|0)+me|0),(me|0)<=0&&(s[C>>2]|0)>=(s[B>>2]|0)||(w=11),(w|0)==11&&(w=0,!(ln(l,1)|0))){w=12;break}if(ue=s[S>>2]|0,n[x>>0]|0){w=15;break}if(ue)me=0;else continue;for(;;){if(ge=s[te>>2]|0,_e=s[ge>>2]|0,be=s[ge+(ue+-1<<2)>>2]|0,s[ge>>2]=be,ue=s[A>>2]|0,s[ue+(be<<2)>>2]=0,s[ue+(_e<<2)>>2]=-1,ue=(s[S>>2]|0)+-1|0,s[S>>2]=ue,(ue|0)>1&&cn(te,0),n[x>>0]|0)continue e;if(!(n[(s[de>>2]|0)+_e>>0]|0)&&(be=n[(s[Ce>>2]|0)+_e>>0]|0,ue=n[2624]|0,ge=ue&255,((ge>>>1^1)&be<<24>>24==ue<<24>>24|be&2&ge|0)!=0)){if((s[m>>2]|0)>1&((me|0)%100|0|0)==0&&(s[L>>2]=s[S>>2],Vi(3504,L|0)|0),n[Te>>0]|0){if(ge=(s[ne>>2]|0)+_e|0,ue=n[ge>>0]|0,n[ge>>0]=1,!(fo(l,_e)|0)){w=29;break e}n[(s[ne>>2]|0)+_e>>0]=ue<<24>>24!=0&1}if(n[Se>>0]|0&&(be=n[(s[Ce>>2]|0)+_e>>0]|0,ue=n[2624]|0,ge=ue&255,((ge>>>1^1)&be<<24>>24==ue<<24>>24|be&2&ge|0)!=0)&&!(n[(s[ne>>2]|0)+_e>>0]|0)&&!(mo(l,_e)|0)){w=35;break e}+((s[E>>2]|0)>>>0)>+y[Ee>>3]*+((s[I>>2]|0)>>>0)&&wi[s[(s[l>>2]|0)+8>>2]&31](l)}if(ue=s[S>>2]|0,ue)me=me+1|0;else continue e}}do if((w|0)==12)n[l+492>>0]=0;else if((w|0)==15){if(x=s[l+824>>2]|0,(ue|0)<=0){if(!x)break}else{B=s[A>>2]|0,C=0;do s[B+(s[x+(C<<2)>>2]<<2)>>2]=-1,C=C+1|0;while((C|0)<(s[S>>2]|0))}s[S>>2]=0}else((w|0)==29||(w|0)==35)&&(n[l+492>>0]=0);while(!1);if(!u)+((s[E>>2]|0)>>>0)>+y[l+96>>3]*+((s[I>>2]|0)>>>0)&&wi[s[(s[l>>2]|0)+8>>2]&31](l);else{if(u=l+744|0,E=s[u>>2]|0,E&&(s[l+748>>2]=0,Me(E),s[u>>2]=0,s[l+752>>2]=0),vo(l+760|0,1),u=l+808|0,E=s[u>>2]|0,E&&(s[l+812>>2]=0,Me(E),s[u>>2]=0,s[l+816>>2]=0),E=l+824|0,u=s[E>>2]|0,(s[S>>2]|0)<=0)u&&(w=48);else{w=s[A>>2]|0,A=0;do s[w+(s[u+(A<<2)>>2]<<2)>>2]=-1,A=A+1|0;while((A|0)<(s[S>>2]|0));w=48}(w|0)==48&&(s[S>>2]=0,Me(u),s[E>>2]=0,s[l+832>>2]=0),Bn(l+856|0,1),n[b>>0]=0,n[l+536>>0]=1,n[l+560>>0]=0,s[l+728>>2]=s[l+540>>2],Tn(l),wi[s[(s[l>>2]|0)+8>>2]&31](l)}return(s[m>>2]|0)>0&&(f=s[l+736>>2]|0,(f|0)>0)&&(y[O>>3]=+(f<<2>>>0)*95367431640625e-20,s[L>>2]=s[O>>2],s[L+4>>2]=s[O+4>>2],Vi(3528,L|0)|0),ge=(n[l+492>>0]|0)!=0,g=P,ge|0}function on(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0;if(m=g,g=g+16|0,S=m,b=l+256|0,P=l+260|0,L=s[P>>2]|0,n[l+705>>0]|0&&co(l,u)|0)return x=1,g=m,x|0;if(!(zr(l,u)|0))return x=0,g=m,x|0;if(!(n[l+724>>0]|0)||(u=s[P>>2]|0,(u|0)!=(L+1|0))||(x=s[(s[b>>2]|0)+(u+-1<<2)>>2]|0,s[S>>2]=x,A=(s[l+544>>2]|0)+(x<<2)|0,Qi(l+856|0,x),(s[A>>2]|0)>>>0<=31))return x=1,g=m,x|0;w=l+760|0,P=l+808|0,b=l+744|0,L=l+924|0,u=l+824|0,E=l+840|0,l=l+836|0,I=0;do x=A+(I<<2)+4|0,ii((s[w>>2]|0)+((s[x>>2]>>1)*12|0)|0,S),C=(s[P>>2]|0)+(s[x>>2]<<2)|0,s[C>>2]=(s[C>>2]|0)+1,n[(s[b>>2]|0)+(s[x>>2]>>1)>>0]=1,s[L>>2]=(s[L>>2]|0)+1,x=s[x>>2]>>1,(s[E>>2]|0)>(x|0)&&(f=s[(s[l>>2]|0)+(x<<2)>>2]|0,(f|0)>-1)&&cn(u,f),I=I+1|0;while((I|0)<((s[A>>2]|0)>>>5|0));return f=1,g=m,f|0}function co(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0,B=0;b=g,g=g+16|0,S=b+8|0,L=b+4|0,f=b,s[L>>2]=s[l+284>>2],ti(l+292|0,L),L=u+4|0,w=s[L>>2]|0;e:do if((w|0)>0){for(m=l+332|0,P=0;A=s[(s[u>>2]|0)+(P<<2)>>2]|0,I=a[(s[m>>2]|0)+(A>>1)>>0]|0,x=I^A&1,E=x&255,B=n[2608]|0,C=B&255,!(E<<24>>24==B<<24>>24&(C>>>1^1)|C&2&x);)if(C=n[2616]|0,B=C&255,(B>>>1^1)&E<<24>>24==C<<24>>24|I&2&B||(s[f>>2]=A^1,s[S+0>>2]=s[f+0>>2],js(l,S,-1),w=s[L>>2]|0),P=P+1|0,(P|0)>=(w|0))break e;return Mi(l,0),B=1,g=b,B|0}while(!1);return B=(ki(l)|0)!=-1,Mi(l,0),g=b,B|0}function an(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0;if(m=g,g=g+16|0,S=m,f=(s[l+544>>2]|0)+(u<<2)|0,!(n[l+724>>0]|0)){Ki(l,u),g=m;return}if((s[f>>2]|0)>>>0<=31){Ki(l,u),g=m;return}b=l+808|0,P=l+776|0,L=l+792|0,w=0;do A=f+(w<<2)+4|0,E=(s[b>>2]|0)+(s[A>>2]<<2)|0,s[E>>2]=(s[E>>2]|0)+-1,hn(l,s[A>>2]>>1),A=s[A>>2]>>1,s[S>>2]=A,A=(s[P>>2]|0)+A|0,n[A>>0]|0||(n[A>>0]=1,ti(L,S)),w=w+1|0;while((w|0)<((s[f>>2]|0)>>>5|0));Ki(l,u),g=m}function kn(l,u,m){l=l|0,u=u|0,m=m|0;var f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0,B=0;if(f=g,g=g+16|0,L=f+4|0,S=f,P=s[l+544>>2]|0,b=P+(u<<2)|0,Qi(l+856|0,u),(s[b>>2]&-32|0)==64){an(l,u),I=s[m>>2]|0,m=s[b>>2]|0;e:do if(m>>>0>31)for(w=m>>>5,A=0;;){if(E=A+1|0,(s[b+(A<<2)+4>>2]|0)==(I|0)){E=A;break e}if((E|0)<(w|0))A=E;else break}else w=0,E=0;while(!1);if(A=w+-1|0,(E|0)<(A|0))do m=E,E=E+1|0,s[b+(m<<2)+4>>2]=s[b+(E<<2)+4>>2],m=s[b>>2]|0,w=m>>>5,A=w+-1|0;while((E|0)<(A|0));if(m&8&&(s[b+(A<<2)+4>>2]=s[b+(w<<2)+4>>2],m=s[b>>2]|0),w=m+-32|0,s[b>>2]=w,w=w>>>5,!w)w=0,m=0;else{m=0,A=0;do m=1<<((s[b+(A<<2)+4>>2]|0)>>>1&31)|m,A=A+1|0;while((A|0)<(w|0))}s[b+(w<<2)+4>>2]=m}else{_n(l,u,1),m=s[m>>2]|0,A=s[b>>2]|0;e:do if(A>>>0>31)for(w=A>>>5,E=0;;){if(I=E+1|0,(s[b+(E<<2)+4>>2]|0)==(m|0)){I=E;break e}if((I|0)<(w|0))E=I;else break}else w=0,I=0;while(!1);if(E=w+-1|0,(I|0)<(E|0))do A=I,I=I+1|0,s[b+(A<<2)+4>>2]=s[b+(I<<2)+4>>2],A=s[b>>2]|0,w=A>>>5,E=w+-1|0;while((I|0)<(E|0));if(A&8&&(s[b+(E<<2)+4>>2]=s[b+(w<<2)+4>>2],A=s[b>>2]|0),E=A+-32|0,s[b>>2]=E,E=E>>>5,!E)E=0,w=0;else{w=0,A=0;do w=1<<((s[b+(A<<2)+4>>2]|0)>>>1&31)|w,A=A+1|0;while((A|0)<(E|0))}s[b+(E<<2)+4>>2]=w,Qs(l,u),w=m>>1,A=s[l+760>>2]|0,E=A+(w*12|0)|0,A=A+(w*12|0)+4|0,I=s[A>>2]|0;e:do if((I|0)>0)for(B=s[E>>2]|0,x=0;;){if(C=x+1|0,(s[B+(x<<2)>>2]|0)==(u|0))break e;if((C|0)<(I|0))x=C;else{x=C;break}}else x=0;while(!1);if(I=I+-1|0,(x|0)<(I|0)){E=s[E>>2]|0;do I=x,x=x+1|0,s[E+(I<<2)>>2]=s[E+(x<<2)>>2],I=(s[A>>2]|0)+-1|0;while((x|0)<(I|0))}s[A>>2]=I,B=(s[l+808>>2]|0)+(m<<2)|0,s[B>>2]=(s[B>>2]|0)+-1,hn(l,w)}if((s[b>>2]&-32|0)!=32)return B=1,g=f,B|0;if(P=s[P+(u+1<<2)>>2]|0,b=a[(s[l+332>>2]|0)+(P>>1)>>0]|0,B=b^P&1,u=B&255,x=n[2624]|0,C=x&255,u<<24>>24==x<<24>>24&(C>>>1^1)|C&2&B)s[S>>2]=P,s[L+0>>2]=s[S+0>>2],js(l,L,-1);else if(C=n[2616]|0,B=C&255,(B>>>1^1)&u<<24>>24==C<<24>>24|b&2&B)return B=0,g=f,B|0;return B=(ki(l)|0)==-1,g=f,B|0}function uo(l,u,m,f,S){l=l|0,u=u|0,m=m|0,f=f|0,S=S|0;var L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0;L=g,g=g+16|0,P=L+4|0,b=L,x=l+708|0,s[x>>2]=(s[x>>2]|0)+1,s[S>>2]|0&&(s[S+4>>2]=0),w=(s[u>>2]|0)>>>5>>>0<(s[m>>2]|0)>>>5>>>0,l=w?m:u,u=w?u:m,w=s[u>>2]|0;e:do if(w>>>0>31){m=0;t:for(;;){A=s[u+(m<<2)+4>>2]|0;i:do if((A>>1|0)!=(f|0)){E=s[l>>2]|0;s:do if(E>>>0>31){for(I=0;x=s[l+(I<<2)+4>>2]|0,I=I+1|0,!((A^x)>>>0<2);)if((I|0)>=(E>>>5|0))break s;if((x|0)==(A^1|0)){S=0;break t}else break i}while(!1);s[P>>2]=A,Gt(S,P),w=s[u>>2]|0}while(!1);if(m=m+1|0,(m|0)>=(w>>>5|0))break e}return g=L,S|0}while(!1);if(m=s[l>>2]|0,m>>>0<=31)return x=1,g=L,x|0;P=0;do u=s[l+(P<<2)+4>>2]|0,(u>>1|0)!=(f|0)&&(s[b>>2]=u,Gt(S,b),m=s[l>>2]|0),P=P+1|0;while((P|0)<(m>>>5|0));return S=1,g=L,S|0}function po(l){l=l|0;var u=0,m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0,B=0,R=0,U=0,Y=0,Q=0,te=0;if(u=g,P=l+924|0,!(s[P>>2]|0)){g=u;return}for(L=l+856|0,m=l+872|0,f=l+868|0,b=l+860|0,S=l+544|0,w=0;te=s[m>>2]|0,A=s[f>>2]|0,E=te-A|0,(te|0)<(A|0)&&(E=(s[b>>2]|0)+E|0),!((w|0)>=(E|0));)E=(s[S>>2]|0)+(s[(s[L>>2]|0)+(((A+w|0)%(s[b>>2]|0)|0)<<2)>>2]<<2)|0,A=s[E>>2]|0,A&3||(s[E>>2]=A&-4|2),w=w+1|0;if(w=l+540|0,C=s[w>>2]|0,(C|0)>0){E=l+744|0,I=l+776|0,A=l+760|0,l=l+804|0,x=0;do{if(n[(s[E>>2]|0)+x>>0]|0){if(B=(s[I>>2]|0)+x|0,n[B>>0]|0){if(R=s[A>>2]|0,C=R+(x*12|0)+4|0,Y=s[C>>2]|0,(Y|0)>0){R=s[R+(x*12|0)>>2]|0,Q=0,U=0;do te=s[R+(Q<<2)>>2]|0,(s[(s[s[l>>2]>>2]|0)+(te<<2)>>2]&3|0)!=1&&(s[R+(U<<2)>>2]=te,Y=s[C>>2]|0,U=U+1|0),Q=Q+1|0;while((Q|0)<(Y|0))}else Q=0,U=0;R=Q-U|0,(R|0)>0&&(s[C>>2]=Y-R),n[B>>0]=0}if(B=s[A>>2]|0,C=B+(x*12|0)+4|0,U=s[C>>2]|0,(U|0)>0){B=B+(x*12|0)|0,R=0;do Y=s[(s[B>>2]|0)+(R<<2)>>2]|0,s[(s[S>>2]|0)+(Y<<2)>>2]&3||(Qi(L,Y),U=(s[S>>2]|0)+(s[(s[B>>2]|0)+(R<<2)>>2]<<2)|0,s[U>>2]=s[U>>2]&-4|2,U=s[C>>2]|0),R=R+1|0;while((R|0)<(U|0))}n[(s[E>>2]|0)+x>>0]=0,C=s[w>>2]|0}x=x+1|0}while((x|0)<(C|0));w=0}else w=0;for(;te=s[m>>2]|0,A=s[f>>2]|0,E=te-A|0,(te|0)<(A|0)&&(E=(s[b>>2]|0)+E|0),!((w|0)>=(E|0));)A=(s[S>>2]|0)+(s[(s[L>>2]|0)+(((A+w|0)%(s[b>>2]|0)|0)<<2)>>2]<<2)|0,E=s[A>>2]|0,(E&3|0)==2&&(s[A>>2]=E&-4),w=w+1|0;s[P>>2]=0,g=u}function ln(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0,B=0,R=0,U=0,Y=0,Q=0,te=0,de=0,Ce=0,Te=0,ne=0,Se=0,Ee=0,me=0,_e=0,ue=0,be=0,ge=0,se=0,xe=0,qe=0,Fe=0,Re=0,Ye=0,dt=0,Ve=0;m=g,g=g+16|0,A=m,de=m+12|0,S=l+856|0,w=l+872|0,C=l+868|0,b=l+860|0,Y=l+680|0,f=l+920|0,L=l+284|0,U=l+280|0,B=l+544|0,R=l+928|0,I=l+44|0,E=l+776|0,Q=l+692|0,x=l+804|0,P=l+760|0,Ee=0,ue=0,me=0;e:for(;;){_e=s[C>>2]|0;do{if(ne=s[w>>2]|0,Se=(ne|0)<(_e|0),ne=ne-_e|0,Se?be=(s[b>>2]|0)+ne|0:be=ne,(be|0)<=0&&(s[f>>2]|0)>=(s[L>>2]|0)){f=1,b=53;break e}if(n[Y>>0]|0){b=8;break e}if(Se&&(ne=(s[b>>2]|0)+ne|0),!(ne|0)&&(Te=s[f>>2]|0,(Te|0)<(s[L>>2]|0))){if(s[f>>2]=Te+1,s[(s[B>>2]|0)+((s[R>>2]|0)+1<<2)>>2]=s[(s[U>>2]|0)+(Te<<2)>>2],ne=(s[B>>2]|0)+(s[R>>2]<<2)|0,Se=(s[ne>>2]|0)>>>5,!Se)Se=0,be=0;else{be=0,_e=0;do be=1<<((s[ne+(_e<<2)+4>>2]|0)>>>1&31)|be,_e=_e+1|0;while((_e|0)<(Se|0))}s[ne+(Se<<2)+4>>2]=be,Qi(S,s[R>>2]|0),_e=s[C>>2]|0}ne=s[(s[S>>2]|0)+(_e<<2)>>2]|0,_e=_e+1|0,xe=s[b>>2]|0,_e=(_e|0)==(xe|0)?0:_e,s[C>>2]=_e,be=s[B>>2]|0,Se=be+(ne<<2)|0,se=s[Se>>2]|0}while(se&3|0);if(u&&(s[I>>2]|0)>1&&(ge=Ee+1|0,(Ee|0)%1e3|0||(se=s[w>>2]|0,s[A>>2]=se-_e+((se|0)<(_e|0)?xe:0),s[A+4>>2]=me,s[A+8>>2]=ue,Vi(3440,A|0)|0,se=s[Se>>2]|0),Ee=ge),_e=be+(ne+1<<2)|0,be=s[_e>>2]>>1,se>>>0>63){ge=s[P>>2]|0,se=se>>>5,xe=1;do Ve=s[Se+(xe<<2)+4>>2]>>1,be=(s[ge+(Ve*12|0)+4>>2]|0)<(s[ge+(be*12|0)+4>>2]|0)?Ve:be,xe=xe+1|0;while((xe|0)<(se|0))}if(se=(s[E>>2]|0)+be|0,n[se>>0]|0){if(xe=s[P>>2]|0,ge=xe+(be*12|0)+4|0,Re=s[ge>>2]|0,(Re|0)>0){xe=s[xe+(be*12|0)>>2]|0,Fe=0,qe=0;do Ye=s[xe+(Fe<<2)>>2]|0,(s[(s[s[x>>2]>>2]|0)+(Ye<<2)>>2]&3|0)!=1&&(s[xe+(qe<<2)>>2]=Ye,Re=s[ge>>2]|0,qe=qe+1|0),Fe=Fe+1|0;while((Fe|0)<(Re|0))}else Fe=0,qe=0;xe=Fe-qe|0,(xe|0)>0&&(s[ge>>2]=Re-xe),n[se>>0]=0}if(se=s[P>>2]|0,ge=s[se+(be*12|0)>>2]|0,se=se+(be*12|0)+4|0,(s[se>>2]|0)>0)xe=0;else continue;for(;;){if(Ye=s[Se>>2]|0,Ye&3)continue e;qe=s[ge+(xe<<2)>>2]|0,Fe=s[B>>2]|0,dt=Fe+(qe<<2)|0,Re=s[dt>>2]|0;t:do if(!((Re&3|0)!=0|(qe|0)==(ne|0))&&(Ve=s[Q>>2]|0,Ce=Re>>>5,(Ve|0)==-1|(Ce|0)<(Ve|0))&&(te=Ye>>>5,Ce>>>0>=te>>>0)&&!(s[Se+(te<<2)+4>>2]&~s[dt+(Ce<<2)+4>>2]|0)){Fe=Fe+(qe+1<<2)|0;do if(Ye>>>0>31){if(Re>>>0>31)dt=-2,Re=0;else break t;for(;;){Ye=s[_e+(Re<<2)>>2]|0;i:do if((dt|0)==-2)for(Ve=0;;){if(dt=s[Fe+(Ve<<2)>>2]|0,(Ye|0)==(dt|0)){Ye=-2;break i}if(Ve=Ve+1|0,(Ye|0)==(dt^1|0))break i;if(Ve>>>0>=Ce>>>0)break t}else for(Ve=0;;){if((Ye|0)==(s[Fe+(Ve<<2)>>2]|0)){Ye=dt;break i}if(Ve=Ve+1|0,Ve>>>0>=Ce>>>0)break t}while(!1);if(Re=Re+1|0,Re>>>0>=te>>>0)break;dt=Ye}if((Ye|0)==-2)break;if((Ye|0)==-1)break t;if(s[de>>2]=Ye^1,s[A+0>>2]=s[de+0>>2],!(kn(l,qe,A)|0)){f=0,b=53;break e}ue=ue+1|0,xe=(((Ye>>1|0)==(be|0))<<31>>31)+xe|0;break t}while(!1);an(l,qe),me=me+1|0}while(!1);if(xe=xe+1|0,(xe|0)>=(s[se>>2]|0))continue e}}return(b|0)==8?(Bn(S,0),s[f>>2]=s[L>>2],Ve=1,g=m,Ve|0):(b|0)==53?(g=m,f|0):0}function go(l,u,m){l=l|0,u=u|0,m=m|0;var f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0,B=0,R=0;if(S=g,g=g+16|0,f=S+12|0,w=S+8|0,b=S+4|0,L=S,P=(s[l+544>>2]|0)+(m<<2)|0,s[P>>2]&3||Wr(l,P)|0)return C=1,g=S,C|0;if(s[w>>2]=s[l+284>>2],ti(l+292|0,w),I=s[P>>2]|0,I>>>0>31){w=l+332|0,A=0,E=-2;do x=s[P+(A<<2)+4>>2]|0,C=x>>1,(C|0)!=(u|0)&&(C=(a[(s[w>>2]|0)+C>>0]|0)^x&1,R=n[2616]|0,B=R&255,((C&255)<<24>>24==R<<24>>24&(B>>>1^1)|B&2&C|0)==0)?(s[b>>2]=x^1,s[f+0>>2]=s[b+0>>2],js(l,f,-1),I=s[P>>2]|0):E=x,A=A+1|0;while((A|0)<(I>>>5|0))}else E=-2;return R=(ki(l)|0)==-1,Mi(l,0),!R&&(R=l+712|0,s[R>>2]=(s[R>>2]|0)+1,s[L>>2]=E,s[f+0>>2]=s[L+0>>2],!(kn(l,m,f)|0))?(R=0,g=S,R|0):(R=1,g=S,R|0)}function fo(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0;if(m=g,L=(s[l+776>>2]|0)+u|0,f=l+760|0,n[L>>0]|0){if(P=s[f>>2]|0,S=P+(u*12|0)+4|0,E=s[S>>2]|0,(E|0)>0){b=l+804|0,P=s[P+(u*12|0)>>2]|0,A=0,w=0;do I=s[P+(A<<2)>>2]|0,(s[(s[s[b>>2]>>2]|0)+(I<<2)>>2]&3|0)!=1&&(s[P+(w<<2)>>2]=I,E=s[S>>2]|0,w=w+1|0),A=A+1|0;while((A|0)<(E|0))}else A=0,w=0;b=A-w|0,(b|0)>0&&(s[S>>2]=E-b),n[L>>0]=0}if(S=s[f>>2]|0,E=n[(s[l+332>>2]|0)+u>>0]|0,A=n[2624]|0,I=A&255,!((I>>>1^1)&E<<24>>24==A<<24>>24|E&2&I)||(f=S+(u*12|0)+4|0,L=s[f>>2]|0,!L))return I=1,g=m,I|0;e:do if((L|0)>0){for(S=S+(u*12|0)|0,L=0;;){if(!(go(l,u,s[(s[S>>2]|0)+(L<<2)>>2]|0)|0)){l=0;break}if(L=L+1|0,(L|0)>=(s[f>>2]|0))break e}return g=m,l|0}while(!1);return I=ln(l,0)|0,g=m,I|0}function mo(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0,B=0,R=0,U=0,Y=0,Q=0,te=0,de=0,Ce=0,Te=0,ne=0,Se=0,Ee=0,me=0,_e=0,ue=0,be=0,ge=0,se=0,xe=0,qe=0,Fe=0,Re=0,Ye=0,dt=0,Ve=0,Dt=0,it=0,Bi=0,Nt=0,Lt=0,pi=0,kt=0,Pt=0,Ze=0;if(m=g,g=g+48|0,R=m+36|0,B=m+32|0,U=m+28|0,Y=m+24|0,f=m+12|0,S=m,E=(s[l+776>>2]|0)+u|0,A=l+760|0,n[E>>0]|0){if(C=s[A>>2]|0,I=C+(u*12|0)+4|0,Ce=s[I>>2]|0,(Ce|0)>0){x=l+804|0,C=s[C+(u*12|0)>>2]|0,te=0,Q=0;do Te=s[C+(te<<2)>>2]|0,(s[(s[s[x>>2]>>2]|0)+(Te<<2)>>2]&3|0)!=1&&(s[C+(Q<<2)>>2]=Te,Ce=s[I>>2]|0,Q=Q+1|0),te=te+1|0;while((te|0)<(Ce|0))}else te=0,Q=0;x=te-Q|0,(x|0)>0&&(s[I>>2]=Ce-x),n[E>>0]=0}Q=s[A>>2]|0,te=Q+(u*12|0)|0,s[f>>2]=0,E=f+4|0,s[E>>2]=0,I=f+8|0,s[I>>2]=0,s[S>>2]=0,C=S+4|0,s[C>>2]=0,x=S+8|0,s[x>>2]=0,Q=Q+(u*12|0)+4|0;e:do if((s[Q>>2]|0)>0){Ce=l+544|0,Se=u<<1,ne=0;do{Ee=(s[te>>2]|0)+(ne<<2)|0,_e=(s[Ce>>2]|0)+(s[Ee>>2]<<2)|0,Ze=s[_e>>2]|0,Te=Ze>>>5;t:do if(Ze>>>0>31)for(ue=0;;){if(me=ue+1|0,(s[_e+(ue<<2)+4>>2]|0)==(Se|0)){me=ue;break t}if((me|0)<(Te|0))ue=me;else break}else me=0;while(!1);ii((me|0)<(Te|0)?f:S,Ee),ne=ne+1|0,Te=s[Q>>2]|0}while((ne|0)<(Te|0));if(Ce=s[E>>2]|0,Se=(Ce|0)>0,Se)for(Ee=s[C>>2]|0,xe=(Ee|0)>0,se=l+544|0,me=s[f>>2]|0,ne=s[S>>2]|0,_e=l+708|0,ge=l+684|0,be=l+688|0,dt=0,ue=0;;){if(xe){Fe=me+(ue<<2)|0,qe=s[se>>2]|0,Re=s[_e>>2]|0,Ye=0;do{it=qe+(s[Fe>>2]<<2)|0,Nt=qe+(s[ne+(Ye<<2)>>2]<<2)|0,Re=Re+1|0,s[_e>>2]=Re,Ve=(s[it>>2]|0)>>>5>>>0<(s[Nt>>2]|0)>>>5>>>0,Dt=Ve?Nt:it,Nt=Ve?it:Nt,it=Dt+4|0,Ve=Nt+4|0,Dt=s[Dt>>2]|0,Bi=Dt>>>5,pi=Bi+-1|0,Nt=s[Nt>>2]|0;t:do if(Nt>>>0>31)for(Lt=0;;){Ze=s[Ve+(Lt<<2)>>2]|0;i:do if((Ze>>1|0)!=(u|0)){s:do if(Dt>>>0>31){for(Pt=0;kt=s[it+(Pt<<2)>>2]|0,Pt=Pt+1|0,!((kt^Ze)>>>0<2);)if((Pt|0)>=(Bi|0))break s;if((kt|0)==(Ze^1|0))break t;break i}while(!1);pi=pi+1|0}while(!1);if(Lt=Lt+1|0,(Lt|0)>=(Nt>>>5|0)){de=28;break}}else de=28;while(!1);if((de|0)==28){if(de=0,(dt|0)>=((s[ge>>2]|0)+Te|0)){l=1;break e}if(Ze=s[be>>2]|0,(Ze|0)!=-1&(pi|0)>(Ze|0)){l=1;break e}else dt=dt+1|0}Ye=Ye+1|0}while((Ye|0)<(Ee|0))}if(ue=ue+1|0,(ue|0)>=(Ce|0)){de=32;break}}else Se=0,de=32}else Ce=0,Se=0,de=32;while(!1);e:do if((de|0)==32){if(n[(s[l+904>>2]|0)+u>>0]=1,Te=l+380|0,ne=(s[Te>>2]|0)+u|0,n[ne>>0]|0&&(Ze=l+200|0,Pt=Ze,Pt=tt(s[Pt>>2]|0,s[Pt+4>>2]|0,-1,-1)|0,s[Ze>>2]=Pt,s[Ze+4>>2]=ae),n[ne>>0]=0,ne=l+460|0,(s[l+476>>2]|0)>(u|0)&&(s[(s[l+472>>2]|0)+(u<<2)>>2]|0)>-1||(de=36),(de|0)==36&&n[(s[Te>>2]|0)+u>>0]|0&&Js(ne,u),de=l+716|0,s[de>>2]=(s[de>>2]|0)+1,de=s[C>>2]|0,(Ce|0)>(de|0)){if(ne=l+732|0,(de|0)>0){Y=l+544|0,U=s[S>>2]|0,_e=l+736|0,me=0;do{if(Ee=(s[Y>>2]|0)+(s[U+(me<<2)>>2]<<2)|0,Te=s[_e>>2]|0,(s[Ee>>2]|0)>>>0>31){ue=0,be=-1;do Ze=Ee+(ue<<2)+4|0,s[R>>2]=s[Ze>>2],ii(ne,R),be=(s[Ze>>2]>>1|0)==(u|0)?ue+Te|0:be,ue=ue+1|0;while((ue|0)<((s[Ee>>2]|0)>>>5|0))}else be=-1;Ze=s[ne>>2]|0,kt=Ze+(be<<2)|0,Pt=s[kt>>2]|0,Ze=Ze+(Te<<2)|0,s[kt>>2]=s[Ze>>2],s[Ze>>2]=Pt,s[B>>2]=(s[Ee>>2]|0)>>>5,ii(ne,B),me=me+1|0}while((me|0)<(de|0))}s[R>>2]=u<<1,ii(ne,R),s[B>>2]=1,ii(ne,B)}else{if(me=l+732|0,Se){ue=l+544|0,_e=s[f>>2]|0,Te=l+736|0,be=0;do{if(Ee=(s[ue>>2]|0)+(s[_e+(be<<2)>>2]<<2)|0,ne=s[Te>>2]|0,(s[Ee>>2]|0)>>>0>31){ge=0,se=-1;do Ze=Ee+(ge<<2)+4|0,s[R>>2]=s[Ze>>2],ii(me,R),se=(s[Ze>>2]>>1|0)==(u|0)?ge+ne|0:se,ge=ge+1|0;while((ge|0)<((s[Ee>>2]|0)>>>5|0))}else se=-1;Ze=s[me>>2]|0,kt=Ze+(se<<2)|0,Pt=s[kt>>2]|0,Ze=Ze+(ne<<2)|0,s[kt>>2]=s[Ze>>2],s[Ze>>2]=Pt,s[B>>2]=(s[Ee>>2]|0)>>>5,ii(me,B),be=be+1|0}while((be|0)<(Ce|0))}s[U>>2]=u<<1|1,ii(me,U),s[Y>>2]=1,ii(me,Y)}if((s[Q>>2]|0)>0){B=0;do an(l,s[(s[te>>2]|0)+(B<<2)>>2]|0),B=B+1|0;while((B|0)<(s[Q>>2]|0))}B=l+628|0;t:do if(Se){if(R=l+544|0,te=s[f>>2]|0,ne=s[S>>2]|0,(de|0)>0)Q=0;else for(B=0;;)if(B=B+1|0,(B|0)>=(Ce|0))break t;do{Y=te+(Q<<2)|0,U=0;do{if(Ze=s[R>>2]|0,uo(l,Ze+(s[Y>>2]<<2)|0,Ze+(s[ne+(U<<2)>>2]<<2)|0,u,B)|0&&!(on(l,B)|0)){l=0;break e}U=U+1|0}while((U|0)<(de|0));Q=Q+1|0}while((Q|0)<(Ce|0))}while(!1);B=s[A>>2]|0,A=B+(u*12|0)|0,R=s[A>>2]|0,R&&(s[B+(u*12|0)+4>>2]=0,Me(R),s[A>>2]=0,s[B+(u*12|0)+8>>2]=0),A=l+412|0,u=u<<1,R=s[A>>2]|0,B=R+(u*12|0)+4|0,!(s[B>>2]|0)&&(w=R+(u*12|0)|0,P=s[w>>2]|0,(P|0)!=0)&&(s[B>>2]=0,Me(P),s[w>>2]=0,s[R+(u*12|0)+8>>2]=0,R=s[A>>2]|0),P=u|1,w=R+(P*12|0)+4|0,!(s[w>>2]|0)&&(b=R+(P*12|0)|0,L=s[b>>2]|0,(L|0)!=0)&&(s[w>>2]=0,Me(L),s[b>>2]=0,s[R+(P*12|0)+8>>2]=0),l=ln(l,0)|0,ne=s[S>>2]|0}while(!1);return ne&&(s[C>>2]=0,Me(ne),s[S>>2]=0,s[x>>2]=0),S=s[f>>2]|0,S?(s[E>>2]=0,Me(S),s[f>>2]=0,s[I>>2]=0,g=m,l|0):(g=m,l|0)}function yo(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0,B=0,R=0,U=0;if(m=g,!(n[l+724>>0]|0)){g=m;return}if(w=l+540|0,(s[w>>2]|0)>0){b=l+760|0,f=l+804|0,S=l+776|0,P=l+544|0,L=0;do{if(E=s[b>>2]|0,A=E+(L*12|0)+4|0,x=s[A>>2]|0,(x|0)>0){E=s[E+(L*12|0)>>2]|0,C=0,I=0;do B=s[E+(C<<2)>>2]|0,(s[(s[s[f>>2]>>2]|0)+(B<<2)>>2]&3|0)!=1&&(s[E+(I<<2)>>2]=B,x=s[A>>2]|0,I=I+1|0),C=C+1|0;while((C|0)<(x|0))}else C=0,I=0;if(E=C-I|0,(E|0)>0&&(s[A>>2]=x-E),n[(s[S>>2]|0)+L>>0]=0,E=s[b>>2]|0,A=E+(L*12|0)+4|0,(s[A>>2]|0)>0){B=E+(L*12|0)|0,x=0;do E=(s[B>>2]|0)+(x<<2)|0,I=s[E>>2]|0,C=s[P>>2]|0,R=C+(I<<2)|0,s[R>>2]&16?s[E>>2]=s[C+(I+1<<2)>>2]:(U=ui(u,R)|0,s[E>>2]=U,s[R>>2]=s[R>>2]|16,s[C+(I+1<<2)>>2]=U),x=x+1|0;while((x|0)<(s[A>>2]|0))}L=L+1|0}while((L|0)<(s[w>>2]|0))}f=l+856|0,U=s[l+872>>2]|0,S=l+868|0,A=s[S>>2]|0,P=U-A|0,(U|0)<(A|0)&&(P=(s[l+860>>2]|0)+P|0);e:do if((P|0)>0)for(L=l+860|0,b=l+544|0;;){if(w=s[(s[f>>2]|0)+(A<<2)>>2]|0,E=A+1|0,s[S>>2]=(E|0)==(s[L>>2]|0)?0:E,E=s[b>>2]|0,I=E+(w<<2)|0,A=s[I>>2]|0,A&3||(A&16?w=s[E+(w+1<<2)>>2]|0:(U=ui(u,I)|0,s[I>>2]=s[I>>2]|16,s[E+(w+1<<2)>>2]=U,w=U),Qi(f,w)),P=P+-1|0,(P|0)<=0)break e;A=s[S>>2]|0}else b=l+544|0;while(!1);if(l=l+928|0,f=s[l>>2]|0,L=s[b>>2]|0,S=L+(f<<2)|0,s[S>>2]&16){s[l>>2]=s[L+(f+1<<2)>>2],g=m;return}else{U=ui(u,S)|0,s[l>>2]=U,s[S>>2]=s[S>>2]|16,s[L+(f+1<<2)>>2]=U,g=m;return}}function bo(l){l=l|0;var u=0,m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0;L=g,g=g+32|0,w=L,u=L+8|0,m=l+544|0,f=l+548|0,S=l+556|0,b=(s[f>>2]|0)-(s[S>>2]|0)|0,s[u+0>>2]=0,s[u+4>>2]=0,s[u+8>>2]=0,s[u+12>>2]=0,Xi(u,b),b=u+16|0,P=l+560|0,n[b>>0]=n[P>>0]|0,yo(l,u),Cn(l,u),(s[l+44>>2]|0)>1&&(A=s[u+4>>2]<<2,s[w>>2]=s[f>>2]<<2,s[w+4>>2]=A,Vi(3608,w|0)|0),n[P>>0]=n[b>>0]|0,b=s[m>>2]|0,b&&Me(b),s[m>>2]=s[u>>2],s[f>>2]=s[u+4>>2],s[l+552>>2]=s[u+8>>2],s[S>>2]=s[u+12>>2],g=L}function So(){var l=0,u=0,m=0;l=g,g=g+16|0,u=l,n[2608]=0,n[2616]=1,n[2624]=2,At(2632,2656,2664,3744,3752),s[658]=160,n[2652]=0,At(2704,2728,2736,3744,3752),s[676]=160,n[2724]=0,At(2784,2808,2816,3744,3752),s[696]=160,n[2804]=1,At(2848,2880,2888,3744,3736),s[712]=280,m=2868,s[m>>2]=-2147483648,s[m+4>>2]=2147483647,s[719]=0,At(2960,2992,3e3,3744,3736),s[740]=280,m=2980,s[m>>2]=-1,s[m+4>>2]=2147483647,s[747]=20,At(3112,3144,3152,3744,3736),s[778]=280,m=3132,s[m>>2]=-1,s[m+4>>2]=2147483647,s[785]=1e3,At(3240,3296,3312,3744,3720),s[810]=2168,y[408]=0,y[409]=J,n[3280]=0,n[3281]=0,r[1641]=r[u+0>>1]|0,r[1642]=r[u+2>>1]|0,r[1643]=r[u+4>>1]|0,y[411]=.5,g=l}function Mn(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0;if(m=g,s[l>>2]=0,f=l+4|0,s[f>>2]=0,S=l+8|0,s[S>>2]=0,(u|0)<=0){g=m;return}if(L=u+1&-2,L=(L|0)>2?L:2,s[S>>2]=L,S=ht(0,L<<2)|0,s[l>>2]=S,!(S|0)&&(s[(Xe()|0)>>2]|0)==12&&ze(Ge(1)|0,48,0),l=s[f>>2]|0,(l|0)<(u|0))do L=S+(l<<2)|0,L&&(s[L>>2]=0),l=l+1|0;while((l|0)!=(u|0));s[f>>2]=u,g=m}function Lo(l){l=l|0;var u=0,m=0,f=0,S=0,L=0,b=0,P=0;if(u=g,f=l+32|0,m=s[f>>2]|0,m&&(s[l+36>>2]=0,Me(m),s[f>>2]=0,s[l+40>>2]=0),f=l+16|0,m=s[f>>2]|0,m&&(s[l+20>>2]=0,Me(m),s[f>>2]=0,s[l+24>>2]=0),f=s[l>>2]|0,!f){g=u;return}if(m=l+4|0,L=s[m>>2]|0,(L|0)>0){S=0;do P=f+(S*12|0)|0,b=s[P>>2]|0,b&&(s[f+(S*12|0)+4>>2]=0,Me(b),s[P>>2]=0,s[f+(S*12|0)+8>>2]=0,f=s[l>>2]|0,L=s[m>>2]|0),S=S+1|0;while((S|0)<(L|0))}s[m>>2]=0,Me(f),s[l>>2]=0,s[l+8>>2]=0,g=u}function Rn(l,u,m){l=l|0,u=u|0,m=m|0;var f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0;if(f=g,u=s[u>>2]|0,L=u+1|0,S=l+4|0,(s[S>>2]|0)>=(L|0)){w=s[l>>2]|0,w=w+(u<<2)|0,s[w>>2]=m,g=f;return}if(b=l+8|0,w=s[b>>2]|0,(w|0)<(L|0)&&(A=u+2-w&-2,P=(w>>1)+2&-2,P=(A|0)>(P|0)?A:P,(P|0)>(2147483647-w|0)&&(A=Ge(1)|0,ze(A|0,48,0)),E=s[l>>2]|0,A=P+w|0,s[b>>2]=A,A=ht(E,A<<2)|0,s[l>>2]=A,!(A|0)&&(s[(Xe()|0)>>2]|0)==12&&(E=Ge(1)|0,ze(E|0,48,0))),w=s[S>>2]|0,(w|0)<(L|0)){b=s[l>>2]|0;do P=b+(w<<2)|0,P&&(s[P>>2]=0),w=w+1|0;while((w|0)!=(L|0))}s[S>>2]=L,E=s[l>>2]|0,E=E+(u<<2)|0,s[E>>2]=m,g=f}function Ao(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0;if(m=g,P=s[u>>2]|0,S=P+1|0,f=l+4|0,(s[f>>2]|0)<(S|0)){if(b=l+8|0,L=s[b>>2]|0,(L|0)<(S|0)&&(w=P+2-L&-2,P=(L>>1)+2&-2,P=(w|0)>(P|0)?w:P,(P|0)>(2147483647-L|0)&&(w=Ge(1)|0,ze(w|0,48,0)),A=s[l>>2]|0,w=P+L|0,s[b>>2]=w,w=ht(A,w*12|0)|0,s[l>>2]=w,!(w|0)&&(s[(Xe()|0)>>2]|0)==12&&(A=Ge(1)|0,ze(A|0,48,0))),b=s[f>>2]|0,(b|0)<(S|0)){L=s[l>>2]|0;do P=L+(b*12|0)|0,P&&(s[P>>2]=0,s[L+(b*12|0)+4>>2]=0,s[L+(b*12|0)+8>>2]=0),b=b+1|0;while((b|0)!=(S|0))}s[f>>2]=S,L=s[u>>2]|0}else L=P;if(f=s[l>>2]|0,s[f+(L*12|0)>>2]|0&&(s[f+(L*12|0)+4>>2]=0,L=s[u>>2]|0),u=l+16|0,f=L+1|0,S=l+20|0,(s[S>>2]|0)>=(f|0)){g=m;return}if(b=l+24|0,l=s[b>>2]|0,(l|0)<(f|0)&&(A=L+2-l&-2,L=(l>>1)+2&-2,L=(A|0)>(L|0)?A:L,(L|0)>(2147483647-l|0)&&(A=Ge(1)|0,ze(A|0,48,0)),w=s[u>>2]|0,A=L+l|0,s[b>>2]=A,A=ht(w,A)|0,s[u>>2]=A,!(A|0)&&(s[(Xe()|0)>>2]|0)==12&&(A=Ge(1)|0,ze(A|0,48,0))),l=s[S>>2]|0,(l|0)<(f|0))do n[(s[u>>2]|0)+l>>0]=0,l=l+1|0;while((l|0)!=(f|0));s[S>>2]=f,g=m}function Nn(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0,B=0,R=0;if(m=g,g=g+16|0,L=m,s[L>>2]=u,S=l+12|0,f=u+1|0,b=l+16|0,(s[b>>2]|0)<(f|0)&&(w=l+20|0,P=s[w>>2]|0,(P|0)<(f|0)&&(E=u+2-P&-2,A=(P>>1)+2&-2,A=(E|0)>(A|0)?E:A,(A|0)>(2147483647-P|0)&&(E=Ge(1)|0,ze(E|0,48,0)),I=s[S>>2]|0,E=A+P|0,s[w>>2]=E,E=ht(I,E<<2)|0,s[S>>2]=E,!(E|0)&&(s[(Xe()|0)>>2]|0)==12&&(I=Ge(1)|0,ze(I|0,48,0))),P=s[b>>2]|0,(f|0)>(P|0)&&Ms((s[S>>2]|0)+(P<<2)|0,-1,f-P<<2|0)|0,s[b>>2]=f),s[(s[S>>2]|0)+(u<<2)>>2]=s[l+4>>2],ti(l,L),f=s[S>>2]|0,P=s[f+(u<<2)>>2]|0,u=s[l>>2]|0,S=s[u+(P<<2)>>2]|0,!P){E=0,I=u+(E<<2)|0,s[I>>2]=S,I=f+(S<<2)|0,s[I>>2]=E,g=m;return}for(l=l+28|0,L=S<<1,b=L|1;;){if(E=P,P=P+-1>>1,A=u+(P<<2)|0,w=s[A>>2]|0,R=s[s[l>>2]>>2]|0,x=s[R+(L<<2)>>2]|0,B=s[R+(b<<2)>>2]|0,x=ei(B|0,((B|0)<0)<<31>>31|0,x|0,((x|0)<0)<<31>>31|0)|0,B=ae,C=w<<1,I=s[R+(C<<2)>>2]|0,C=s[R+((C|1)<<2)>>2]|0,I=ei(C|0,((C|0)<0)<<31>>31|0,I|0,((I|0)<0)<<31>>31|0)|0,C=ae,!(B>>>0<C>>>0|(B|0)==(C|0)&x>>>0<I>>>0)){l=14;break}if(s[u+(E<<2)>>2]=w,s[f+(s[A>>2]<<2)>>2]=E,!P){E=0,l=14;break}}if((l|0)==14){R=u+(E<<2)|0,s[R>>2]=S,R=f+(S<<2)|0,s[R>>2]=E,g=m;return}}function hn(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0,B=0,R=0,U=0,Y=0;m=g,L=l+824|0,w=(s[l+840>>2]|0)>(u|0),w&&(s[(s[l+836>>2]|0)+(u<<2)>>2]|0)>-1?b=7:b=3;do if((b|0)==3){if(n[(s[l+876>>2]|0)+u>>0]|0){g=m;return}if(n[(s[l+904>>2]|0)+u>>0]|0){g=m;return}if(I=n[(s[l+332>>2]|0)+u>>0]|0,E=n[2624]|0,x=E&255,(x>>>1^1)&I<<24>>24==E<<24>>24|I&2&x)if(w){b=7;break}else break;else{g=m;return}}while(!1);if((b|0)==7&&(f=s[l+836>>2]|0,S=f+(u<<2)|0,P=s[S>>2]|0,(P|0)>-1)){u=s[L>>2]|0,b=s[u+(P<<2)>>2]|0;e:do if(!P)I=0;else for(w=l+852|0,A=b<<1,l=A|1;;){if(I=P,P=P+-1>>1,x=u+(P<<2)|0,E=s[x>>2]|0,Y=s[s[w>>2]>>2]|0,B=s[Y+(A<<2)>>2]|0,U=s[Y+(l<<2)>>2]|0,B=ei(U|0,((U|0)<0)<<31>>31|0,B|0,((B|0)<0)<<31>>31|0)|0,U=ae,R=E<<1,C=s[Y+(R<<2)>>2]|0,R=s[Y+((R|1)<<2)>>2]|0,C=ei(R|0,((R|0)<0)<<31>>31|0,C|0,((C|0)<0)<<31>>31|0)|0,R=ae,!(U>>>0<R>>>0|(U|0)==(R|0)&B>>>0<C>>>0))break e;if(s[u+(I<<2)>>2]=E,s[f+(s[x>>2]<<2)>>2]=I,!P){I=0;break}}while(!1);s[u+(I<<2)>>2]=b,s[f+(b<<2)>>2]=I,cn(L,s[S>>2]|0),g=m;return}Nn(L,u),g=m}function cn(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0,B=0,R=0,U=0,Y=0,Q=0;if(m=g,f=s[l>>2]|0,S=s[f+(u<<2)>>2]|0,E=u<<1|1,A=l+4|0,x=s[A>>2]|0,(E|0)>=(x|0)){C=u,B=l+12|0,x=f+(C<<2)|0,s[x>>2]=S,B=s[B>>2]|0,B=B+(S<<2)|0,s[B>>2]=C,g=m;return}for(b=l+28|0,w=S<<1,P=w|1,l=l+12|0;;){if(I=(u<<1)+2|0,(I|0)<(x|0)?(C=s[f+(I<<2)>>2]|0,B=s[f+(E<<2)>>2]|0,Q=C<<1,x=s[s[b>>2]>>2]|0,U=s[x+(Q<<2)>>2]|0,Q=s[x+((Q|1)<<2)>>2]|0,U=ei(Q|0,((Q|0)<0)<<31>>31|0,U|0,((U|0)<0)<<31>>31|0)|0,Q=ae,Y=B<<1,R=s[x+(Y<<2)>>2]|0,Y=s[x+((Y|1)<<2)>>2]|0,R=ei(Y|0,((Y|0)<0)<<31>>31|0,R|0,((R|0)<0)<<31>>31|0)|0,Y=ae,Q>>>0<Y>>>0|(Q|0)==(Y|0)&U>>>0<R>>>0||(C=B,L=7)):(C=s[f+(E<<2)>>2]|0,x=s[s[b>>2]>>2]|0,L=7),(L|0)==7&&(L=0,I=E),R=C<<1,Y=s[x+(R<<2)>>2]|0,R=s[x+((R|1)<<2)>>2]|0,Y=ei(R|0,((R|0)<0)<<31>>31|0,Y|0,((Y|0)<0)<<31>>31|0)|0,R=ae,Q=s[x+(w<<2)>>2]|0,U=s[x+(P<<2)>>2]|0,Q=ei(U|0,((U|0)<0)<<31>>31|0,Q|0,((Q|0)<0)<<31>>31|0)|0,U=ae,!(R>>>0<U>>>0|(R|0)==(U|0)&Y>>>0<Q>>>0)){L=10;break}if(s[f+(u<<2)>>2]=C,s[(s[l>>2]|0)+(C<<2)>>2]=u,E=I<<1|1,x=s[A>>2]|0,(E|0)>=(x|0)){u=I,L=10;break}else u=I}if((L|0)==10){Q=f+(u<<2)|0,s[Q>>2]=S,Q=s[l>>2]|0,Q=Q+(S<<2)|0,s[Q>>2]=u,g=m;return}}function vo(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0,w=0;if(m=g,b=s[l>>2]|0,b){f=l+4|0,S=s[f>>2]|0;e:do if((S|0)>0)for(L=0;;){if(P=b+(L*12|0)|0,w=s[P>>2]|0,w&&(s[b+(L*12|0)+4>>2]=0,Me(w),s[P>>2]=0,s[b+(L*12|0)+8>>2]=0,S=s[f>>2]|0),L=L+1|0,(L|0)>=(S|0))break e;b=s[l>>2]|0}while(!1);s[f>>2]=0,u&&(Me(s[l>>2]|0),s[l>>2]=0,s[l+8>>2]=0)}if(f=l+16|0,S=s[f>>2]|0,S|0&&(s[l+20>>2]=0,u)&&(Me(S),s[f>>2]=0,s[l+24>>2]=0),S=l+32|0,f=s[S>>2]|0,!f){g=m;return}if(s[l+36>>2]=0,!u){g=m;return}Me(f),s[S>>2]=0,s[l+40>>2]=0,g=m}function Bn(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0;if(f=g,S=s[l>>2]|0,m=l+4|0,S?(s[m>>2]=0,u&&(Me(S),s[l>>2]=0,s[l+8>>2]=0,S=0)):S=0,(s[m>>2]|0)>=1){b=l+16|0,s[b>>2]=0,b=l+12|0,s[b>>2]=0,g=f;return}if(b=l+8|0,L=s[b>>2]|0,(L|0)<1&&(P=2-L&-2,u=(L>>1)+2&-2,u=(P|0)>(u|0)?P:u,(u|0)>(2147483647-L|0)&&(P=Ge(1)|0,ze(P|0,48,0)),P=u+L|0,s[b>>2]=P,S=ht(S,P<<2)|0,s[l>>2]=S,!(S|0)&&(s[(Xe()|0)>>2]|0)==12&&(P=Ge(1)|0,ze(P|0,48,0))),u=s[m>>2]|0,(u|0)<1)for(;L=S+(u<<2)|0,L&&(s[L>>2]=0),u;)u=u+1|0;s[m>>2]=1,P=l+16|0,s[P>>2]=0,P=l+12|0,s[P>>2]=0,g=f}function Qi(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0;if(f=g,g=g+16|0,m=f,S=l+16|0,P=s[S>>2]|0,s[S>>2]=P+1,s[(s[l>>2]|0)+(P<<2)>>2]=u,P=s[S>>2]|0,u=l+4|0,b=s[u>>2]|0,(P|0)==(b|0)&&(s[S>>2]=0,P=0),L=l+12|0,(s[L>>2]|0)!=(P|0)){g=f;return}if(Mn(m,(b*3|0)+1>>1),A=s[L>>2]|0,E=s[u>>2]|0,(A|0)<(E|0))for(P=s[l>>2]|0,w=s[m>>2]|0,E=0;;)if(b=E+1|0,s[w+(E<<2)>>2]=s[P+(A<<2)>>2],A=A+1|0,E=s[u>>2]|0,(A|0)>=(E|0)){w=b;break}else E=b;else w=0;if(b=s[l>>2]|0,(s[S>>2]|0)>0){for(P=s[m>>2]|0,A=0;s[P+(w<<2)>>2]=s[b+(A<<2)>>2],A=A+1|0,!((A|0)>=(s[S>>2]|0));)w=w+1|0;E=s[u>>2]|0}s[L>>2]=0,s[S>>2]=E,b?(s[u>>2]=0,Me(b),s[l>>2]=0,S=l+8|0,s[S>>2]=0):S=l+8|0,s[l>>2]=s[m>>2],A=m+4|0,s[u>>2]=s[A>>2],E=m+8|0,s[S>>2]=s[E>>2],s[m>>2]=0,s[A>>2]=0,s[E>>2]=0,g=f}function ii(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0;if(m=g,f=l+4|0,S=s[f>>2]|0,L=l+8|0,b=s[L>>2]|0,(S|0)==(b|0)&(b|0)<(S+1|0)?(b=(S>>1)+2&-2,b=(b|0)<2?2:b,(b|0)>(2147483647-S|0)&&(b=Ge(1)|0,ze(b|0,48,0)),P=s[l>>2]|0,S=b+S|0,s[L>>2]=S,S=ht(P,S<<2)|0,s[l>>2]=S,!(S|0)&&(s[(Xe()|0)>>2]|0)==12&&(P=Ge(1)|0,ze(P|0,48,0))):S=s[l>>2]|0,P=s[f>>2]|0,s[f>>2]=P+1,f=S+(P<<2)|0,!f){g=m;return}s[f>>2]=s[u>>2],g=m}function Po(){var l=0,u=0;return u=g,Ti(3864)|0,l=Hn(936)|0,In(l),g=u,l|0}function _o(l){l=l|0;var u=0;if(u=g,!l){g=u;return}wi[s[(s[l>>2]|0)+4>>2]&31](l),g=u}function Eo(){var l=0,u=0,m=0;l=g,g=g+16|0,u=l,m=Hn(936)|0,In(m),s[964]=m,Vn(m,1)|0,m=s[964]|0,n[u+0>>0]=n[3840]|0,rn(m,u,1)|0,g=l}function To(l){l=l|0;var u=0,m=0,f=0;if(u=g,g=g+16|0,m=u,(s[962]|0)>=(l|0)){g=u;return}do f=s[964]|0,n[m+0>>0]=n[3840]|0,rn(f,m,1)|0,f=(s[962]|0)+1|0,s[962]=f;while((f|0)<(l|0));g=u}function wo(l){l=l|0;var u=0,m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0;if(S=g,g=g+32|0,L=S+16|0,m=S+4|0,b=S,s[m>>2]=0,f=m+4|0,s[f>>2]=0,u=m+8|0,s[u>>2]=0,P=s[l>>2]|0,P)do{if(w=(P|0)<0?0-P|0:P,(s[962]|0)<(w|0))do A=s[964]|0,n[L+0>>0]=n[3840]|0,rn(A,L,1)|0,A=(s[962]|0)+1|0,s[962]=A;while((A|0)<(w|0));s[b>>2]=w<<1|P>>>31,Gt(m,b),l=l+4|0,P=s[l>>2]|0}while(P|0);return b=s[964]|0,L=b+628|0,Fn(m,L),L=on(b,L)|0,b=s[m>>2]|0,b?(s[f>>2]=0,Me(b),s[m>>2]=0,s[u>>2]=0,g=S,L|0):(g=S,L|0)}function Co(){var l=0,u=0,m=0,f=0;return u=g,g=g+16|0,l=u,m=s[964]|0,f=m+664|0,s[f+0>>2]=-1,s[f+4>>2]=-1,s[f+8>>2]=-1,s[f+12>>2]=-1,s[m+304>>2]|0&&(s[m+308>>2]=0),xn(l,m,1,0),g=u,(n[l>>0]|0)==0|0}function Do(){return(s[(s[964]|0)+4>>2]|0)+1|0}function Io(){return s[962]|0}function Oo(l){l=l|0;var u=0,m=0,f=0,S=0,L=0,b=0;return u=g,g=g+32|0,L=u+16|0,f=u+4|0,b=u,s[f>>2]=0,m=f+4|0,s[m>>2]=0,S=f+8|0,s[S>>2]=0,s[b>>2]=l<<1,Gt(f,b),l=s[964]|0,b=l+664|0,s[b+0>>2]=-1,s[b+4>>2]=-1,s[b+8>>2]=-1,s[b+12>>2]=-1,Fn(f,l+304|0),xn(L,l,1,0),l=(n[L>>0]|0)==0,L=s[f>>2]|0,L?(s[m>>2]=0,Me(L),s[f>>2]=0,s[S>>2]=0,g=u,l|0):(g=u,l|0)}function xo(l){l=l|0;var u=0,m=0,f=0;u=g,g=g+16|0,f=u,m=s[964]|0,s[f>>2]=l<<1|1,l=m+628|0,s[l>>2]|0&&(s[m+632>>2]=0),Gt(l,f),on(m,l)|0,g=u}function Vo(){return s[(s[964]|0)+36>>2]|0}function ko(){return s[(s[964]|0)+32>>2]|0}function Fn(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0;if(m=g,b=s[u>>2]|0,f=u+4|0,b?(s[f>>2]=0,P=0):P=s[f>>2]|0,f=l+4|0,S=s[f>>2]|0,L=u+4|0,(P|0)<(S|0)){w=u+8|0,P=s[w>>2]|0,(P|0)<(S|0)&&(E=S+1-P&-2,A=(P>>1)+2&-2,A=(E|0)>(A|0)?E:A,(A|0)>(2147483647-P|0)&&(E=Ge(1)|0,ze(E|0,48,0)),E=A+P|0,s[w>>2]=E,b=ht(b,E<<2)|0,s[u>>2]=b,!(b|0)&&(s[(Xe()|0)>>2]|0)==12&&(E=Ge(1)|0,ze(E|0,48,0))),P=s[L>>2]|0;e:do if((P|0)<(S|0))for(;;){if(b=b+(P<<2)|0,b&&(s[b>>2]=0),P=P+1|0,(P|0)==(S|0))break e;b=s[u>>2]|0}while(!1);s[L>>2]=S,S=s[f>>2]|0}if((S|0)<=0){g=m;return}u=s[u>>2]|0,l=s[l>>2]|0,S=0;do s[u+(S<<2)>>2]=s[l+(S<<2)>>2],S=S+1|0;while((S|0)<(s[f>>2]|0));g=m}function hi(l,u){l=l|0,u=u|0;var m=0;m=g,g=g+16|0,s[m>>2]=u,u=s[F>>2]|0,fr(u|0,l|0,m|0)|0,Yi(10,u|0)|0,ye()}function qn(){var l=0,u=0;if(l=g,g=g+16|0,Ar(4064,3)|0)hi(4072,l);else return u=Lr(s[1014]|0)|0,g=l,u|0;return 0}function Hn(l){l=l|0;var u=0,m=0;if(u=g,l=l|0?l:1,m=Zi(l)|0,m)return g=u,m|0;for(;;){if(m=Fo()|0,!m){l=4;break}if(pn[m&3](),m=Zi(l)|0,m){l=5;break}}if((l|0)==4)m=Ge(4)|0,s[m>>2]=4248,ze(m|0,4296,12);else if((l|0)==5)return g=u,m|0;return 0}function ci(l){l=l|0;var u=0;u=g,Me(l),g=u}function Mo(l){l=l|0;var u=0;u=g,ci(l),g=u}function Ro(l){l=l|0}function No(l){return l=l|0,4264}function Un(l){l=l|0;var u=0;u=g,g=g+16|0,pn[l&3](),hi(4312,u)}function Bo(){var l=0,u=0;u=qn()|0,u|0&&(l=s[u>>2]|0,(l|0)!=0)&&(u=l+48|0,(s[u>>2]&-256|0)==1126902528?(s[u+4>>2]|0)==1129074247:0)&&Un(s[l+12>>2]|0),u=s[968]|0,s[968]=u+0,Un(u)}function Fo(){var l=0;return l=s[1102]|0,s[1102]=l+0,l|0}function ja(l){l=l|0}function Qa(l){l=l|0}function qo(l){l=l|0}function Ho(l){l=l|0}function Uo(l){l=l|0}function $o(l){l=l|0;var u=0;u=g,ci(l),g=u}function Go(l){l=l|0;var u=0;u=g,ci(l),g=u}function zo(l,u,m){l=l|0,u=u|0,m=m|0;var f=0,S=0,L=0,b=0;if(f=g,g=g+64|0,S=f,(l|0)==(u|0))return b=1,g=f,b|0;if(!u||(u=Gn(u,4504,4560,0)|0,!u))return b=0,g=f,b|0;b=S+0|0,L=b+56|0;do s[b>>2]=0,b=b+4|0;while((b|0)<(L|0));return s[S>>2]=u,s[S+8>>2]=l,s[S+12>>2]=-1,s[S+48>>2]=1,gn[s[(s[u>>2]|0)+28>>2]&3](u,S,s[m>>2]|0,1),(s[S+24>>2]|0)!=1?(b=0,g=f,b|0):(s[m>>2]=s[S+16>>2],b=1,g=f,b|0)}function $n(l,u,m,f){l=l|0,u=u|0,m=m|0,f=f|0;var S=0,L=0;if(l=g,S=u+16|0,L=s[S>>2]|0,!L){s[S>>2]=m,s[u+24>>2]=f,s[u+36>>2]=1,g=l;return}if((L|0)!=(m|0)){L=u+36|0,s[L>>2]=(s[L>>2]|0)+1,s[u+24>>2]=2,n[u+54>>0]=1,g=l;return}if(m=u+24|0,(s[m>>2]|0)!=2){g=l;return}s[m>>2]=f,g=l}function Wo(l,u,m,f){l=l|0,u=u|0,m=m|0,f=f|0;var S=0;if(S=g,(s[u+8>>2]|0)!=(l|0)){g=S;return}$n(0,u,m,f),g=S}function Yo(l,u,m,f){l=l|0,u=u|0,m=m|0,f=f|0;var S=0;if(S=g,(l|0)==(s[u+8>>2]|0)){$n(0,u,m,f),g=S;return}else{l=s[l+8>>2]|0,gn[s[(s[l>>2]|0)+28>>2]&3](l,u,m,f),g=S;return}}function Gn(l,u,m,f){l=l|0,u=u|0,m=m|0,f=f|0;var S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0;S=g,g=g+64|0,L=S,b=s[l>>2]|0,P=l+(s[b+-8>>2]|0)|0,b=s[b+-4>>2]|0,s[L>>2]=m,s[L+4>>2]=l,s[L+8>>2]=u,s[L+12>>2]=f,A=L+16|0,E=L+20|0,u=L+24|0,w=L+28|0,f=L+32|0,l=L+40|0,I=(b|0)==(m|0),x=A+0|0,m=x+36|0;do s[x>>2]=0,x=x+4|0;while((x|0)<(m|0));return r[A+36>>1]=0,n[A+38>>0]=0,I?(s[L+48>>2]=1,Ns[s[(s[b>>2]|0)+20>>2]&3](b,L,P,P,1,0),x=(s[u>>2]|0)==1?P:0,g=S,x|0):(un[s[(s[b>>2]|0)+24>>2]&3](b,L,P,1,0),L=s[L+36>>2]|0,L?(L|0)==1?(s[u>>2]|0)!=1&&!((s[l>>2]|0)==0&(s[w>>2]|0)==1&(s[f>>2]|0)==1)?(x=0,g=S,x|0):(x=s[A>>2]|0,g=S,x|0):(x=0,g=S,x|0):(x=(s[l>>2]|0)==1&(s[w>>2]|0)==1&(s[f>>2]|0)==1?s[E>>2]|0:0,g=S,x|0))}function zn(l,u,m,f,S){l=l|0,u=u|0,m=m|0,f=f|0,S=S|0;var L=0;if(l=g,n[u+53>>0]=1,(s[u+4>>2]|0)!=(f|0)){g=l;return}if(n[u+52>>0]=1,f=u+16|0,L=s[f>>2]|0,!L){if(s[f>>2]=m,s[u+24>>2]=S,s[u+36>>2]=1,!((S|0)==1&&(s[u+48>>2]|0)==1)){g=l;return}n[u+54>>0]=1,g=l;return}if((L|0)!=(m|0)){L=u+36|0,s[L>>2]=(s[L>>2]|0)+1,n[u+54>>0]=1,g=l;return}if(m=u+24|0,f=s[m>>2]|0,(f|0)==2?s[m>>2]=S:S=f,!((S|0)==1&&(s[u+48>>2]|0)==1)){g=l;return}n[u+54>>0]=1,g=l}function Ko(l,u,m,f,S){l=l|0,u=u|0,m=m|0,f=f|0,S=S|0;var L=0,b=0,P=0,w=0,A=0;if(L=g,(l|0)==(s[u+8>>2]|0)){if((s[u+4>>2]|0)!=(m|0)){g=L;return}if(b=u+28|0,(s[b>>2]|0)==1){g=L;return}s[b>>2]=f,g=L;return}if((l|0)!=(s[u>>2]|0)){w=s[l+8>>2]|0,un[s[(s[w>>2]|0)+24>>2]&3](w,u,m,f,S),g=L;return}if((s[u+16>>2]|0)!=(m|0)&&(P=u+20|0,(s[P>>2]|0)!=(m|0))){if(s[u+32>>2]=f,f=u+44|0,(s[f>>2]|0)==4){g=L;return}w=u+52|0,n[w>>0]=0,A=u+53|0,n[A>>0]=0,l=s[l+8>>2]|0,Ns[s[(s[l>>2]|0)+20>>2]&3](l,u,m,m,1,S),n[A>>0]|0?n[w>>0]|0||(l=1,b=13):(l=0,b=13);do if((b|0)==13){if(s[P>>2]=m,A=u+40|0,s[A>>2]=(s[A>>2]|0)+1,(s[u+36>>2]|0)==1&&(s[u+24>>2]|0)==2){if(n[u+54>>0]=1,l)break}else b=16;if((b|0)==16&&l)break;s[f>>2]=4,g=L;return}while(!1);s[f>>2]=3,g=L;return}if((f|0)!=1){g=L;return}s[u+32>>2]=1,g=L}function Xo(l,u,m,f,S){l=l|0,u=u|0,m=m|0,f=f|0,S=S|0;var L=0;if(S=g,(s[u+8>>2]|0)==(l|0)){if((s[u+4>>2]|0)!=(m|0)){g=S;return}if(u=u+28|0,(s[u>>2]|0)==1){g=S;return}s[u>>2]=f,g=S;return}if((s[u>>2]|0)!=(l|0)){g=S;return}if((s[u+16>>2]|0)!=(m|0)&&(L=u+20|0,(s[L>>2]|0)!=(m|0))){s[u+32>>2]=f,s[L>>2]=m,l=u+40|0,s[l>>2]=(s[l>>2]|0)+1,(s[u+36>>2]|0)==1&&(s[u+24>>2]|0)==2&&(n[u+54>>0]=1),s[u+44>>2]=4,g=S;return}if((f|0)!=1){g=S;return}s[u+32>>2]=1,g=S}function jo(l,u,m,f,S,L){l=l|0,u=u|0,m=m|0,f=f|0,S=S|0,L=L|0;var b=0;if(b=g,(l|0)==(s[u+8>>2]|0)){zn(0,u,m,f,S),g=b;return}else{l=s[l+8>>2]|0,Ns[s[(s[l>>2]|0)+20>>2]&3](l,u,m,f,S,L),g=b;return}}function Qo(l,u,m,f,S,L){if(l=l|0,u=u|0,m=m|0,f=f|0,S=S|0,L=L|0,L=g,(s[u+8>>2]|0)!=(l|0)){g=L;return}zn(0,u,m,f,S),g=L}function Zo(l,u,m){l=l|0,u=u|0,m=m|0;var f=0,S=0;return f=g,g=g+16|0,S=f,s[S>>2]=s[m>>2],l=Ji[s[(s[l>>2]|0)+16>>2]&1](l,u,S)|0,u=l&1,l?(s[m>>2]=s[S>>2],g=f,u|0):(g=f,u|0)}function Jo(l){l=l|0;var u=0;return u=g,l?l=(Gn(l,4504,4672,0)|0)!=0:l=0,g=u,l&1|0}function ea(){var l=0,u=0,m=0,f=0,S=0;l=g,g=g+16|0,u=l,l=l+12|0,m=qn()|0,m||hi(4040,u),m=s[m>>2]|0,m||hi(4040,u),S=m+48|0,f=s[S>>2]|0,S=s[S+4>>2]|0,(f&-256|0)==1126902528&(S|0)==1129074247||(s[u>>2]=s[970],hi(4e3,u)),(f|0)==1126902529&(S|0)==1129074247?f=s[m+44>>2]|0:f=m+80|0,s[l>>2]=f,S=s[m>>2]|0,m=s[S+4>>2]|0,Ji[s[(s[1108]|0)+16>>2]&1](4432,S,l)|0?(S=s[l>>2]|0,f=s[970]|0,S=nr[s[(s[S>>2]|0)+8>>2]&1](S)|0,s[u>>2]=f,s[u+4>>2]=m,s[u+8>>2]=S,hi(3904,u)):(s[u>>2]=s[970],s[u+4>>2]=m,hi(3952,u))}function ta(){var l=0;if(l=g,g=g+16|0,vr(4056,20)|0)hi(4128,l);else{g=l;return}}function ia(l){l=l|0;var u=0;if(u=g,g=g+16|0,Me(l),Pr(s[1014]|0,0)|0)hi(4184,u);else{g=u;return}}function Zi(l){l=l|0;var u=0,m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0,B=0,R=0,U=0,Y=0,Q=0,te=0,de=0,Ce=0,Te=0,ne=0,Se=0,Ee=0,me=0,_e=0,ue=0,be=0,ge=0,se=0;u=g;do if(l>>>0<245){if(l>>>0<11?l=16:l=l+11&-8,Ce=l>>>3,C=s[1206]|0,de=C>>>Ce,de&3){L=(de&1^1)+Ce|0,S=L<<1,m=4864+(S<<2)|0,S=4864+(S+2<<2)|0,b=s[S>>2]|0,P=b+8|0,f=s[P>>2]|0;do if((m|0)!=(f|0))if(f>>>0<(s[1210]|0)>>>0&&ye(),w=f+12|0,(s[w>>2]|0)==(b|0)){s[w>>2]=m,s[S>>2]=f;break}else ye();else s[1206]=C&~(1<<L);while(!1);return se=L<<3,s[b+4>>2]=se|3,se=b+(se|4)|0,s[se>>2]=s[se>>2]|1,se=P,g=u,se|0}if(te=s[1208]|0,l>>>0>te>>>0){if(de){b=2<<Ce,b=de<<Ce&(b|0-b),b=(b&0-b)+-1|0,m=b>>>12&16,b=b>>>m,P=b>>>5&8,b=b>>>P,S=b>>>2&4,b=b>>>S,L=b>>>1&2,b=b>>>L,f=b>>>1&1,f=(P|m|S|L|f)+(b>>>f)|0,b=f<<1,L=4864+(b<<2)|0,b=4864+(b+2<<2)|0,S=s[b>>2]|0,m=S+8|0,P=s[m>>2]|0;do if((L|0)!=(P|0))if(P>>>0<(s[1210]|0)>>>0&&ye(),w=P+12|0,(s[w>>2]|0)==(S|0)){s[w>>2]=L,s[b>>2]=P,ue=s[1208]|0;break}else ye();else s[1206]=C&~(1<<f),ue=te;while(!1);return se=f<<3,f=se-l|0,s[S+4>>2]=l|3,L=S+l|0,s[S+(l|4)>>2]=f|1,s[S+se>>2]=f,ue&&(S=s[1211]|0,A=ue>>>3,P=A<<1,b=4864+(P<<2)|0,w=s[1206]|0,A=1<<A,w&A?(P=4864+(P+2<<2)|0,w=s[P>>2]|0,w>>>0<(s[1210]|0)>>>0?ye():(_e=P,me=w)):(s[1206]=w|A,_e=4864+(P+2<<2)|0,me=b),s[_e>>2]=S,s[me+12>>2]=S,s[S+8>>2]=me,s[S+12>>2]=b),s[1208]=f,s[1211]=L,se=m,g=u,se|0}if(C=s[1207]|0,C){for(m=(C&0-C)+-1|0,ge=m>>>12&16,m=m>>>ge,be=m>>>5&8,m=m>>>be,se=m>>>2&4,m=m>>>se,S=m>>>1&2,m=m>>>S,f=m>>>1&1,f=s[5128+((be|ge|se|S|f)+(m>>>f)<<2)>>2]|0,m=(s[f+4>>2]&-8)-l|0,S=f;L=s[S+16>>2]|0,!(!L&&(L=s[S+20>>2]|0,!L));)S=(s[L+4>>2]&-8)-l|0,se=S>>>0<m>>>0,m=se?S:m,S=L,f=se?L:f;b=s[1210]|0,f>>>0<b>>>0&&ye(),S=f+l|0,f>>>0>=S>>>0&&ye(),L=s[f+24>>2]|0,w=s[f+12>>2]|0;do if((w|0)==(f|0)){if(w=f+20|0,P=s[w>>2]|0,!P&&(w=f+16|0,P=s[w>>2]|0,!P)){Ee=0;break}for(;;){if(A=P+20|0,E=s[A>>2]|0,E){P=E,w=A;continue}if(A=P+16|0,E=s[A>>2]|0,E)P=E,w=A;else break}if(w>>>0<b>>>0)ye();else{s[w>>2]=0,Ee=P;break}}else if(P=s[f+8>>2]|0,P>>>0<b>>>0&&ye(),b=P+12|0,(s[b>>2]|0)!=(f|0)&&ye(),A=w+8|0,(s[A>>2]|0)==(f|0)){s[b>>2]=w,s[A>>2]=P,Ee=w;break}else ye();while(!1);do if(L){if(P=s[f+28>>2]|0,b=5128+(P<<2)|0,(f|0)==(s[b>>2]|0)){if(s[b>>2]=Ee,!Ee){s[1207]=s[1207]&~(1<<P);break}}else if(L>>>0<(s[1210]|0)>>>0&&ye(),b=L+16|0,(s[b>>2]|0)==(f|0)?s[b>>2]=Ee:s[L+20>>2]=Ee,!Ee)break;b=s[1210]|0,Ee>>>0<b>>>0&&ye(),s[Ee+24>>2]=L,L=s[f+16>>2]|0;do if(L)if(L>>>0<b>>>0)ye();else{s[Ee+16>>2]=L,s[L+24>>2]=Ee;break}while(!1);if(L=s[f+20>>2]|0,L)if(L>>>0<(s[1210]|0)>>>0)ye();else{s[Ee+20>>2]=L,s[L+24>>2]=Ee;break}}while(!1);return m>>>0<16?(se=m+l|0,s[f+4>>2]=se|3,se=f+(se+4)|0,s[se>>2]=s[se>>2]|1):(s[f+4>>2]=l|3,s[f+(l|4)>>2]=m|1,s[f+(m+l)>>2]=m,b=s[1208]|0,b&&(L=s[1211]|0,w=b>>>3,A=w<<1,b=4864+(A<<2)|0,P=s[1206]|0,w=1<<w,P&w?(P=4864+(A+2<<2)|0,w=s[P>>2]|0,w>>>0<(s[1210]|0)>>>0?ye():(Se=P,ne=w)):(s[1206]=P|w,Se=4864+(A+2<<2)|0,ne=b),s[Se>>2]=L,s[ne+12>>2]=L,s[L+8>>2]=ne,s[L+12>>2]=b),s[1208]=m,s[1211]=S),se=f+8|0,g=u,se|0}}}else if(l>>>0<=4294967231){if(ne=l+11|0,l=ne&-8,Ee=s[1207]|0,Ee){Se=0-l|0,ne=ne>>>8,ne?l>>>0>16777215?me=31:(ge=(ne+1048320|0)>>>16&8,se=ne<<ge,be=(se+520192|0)>>>16&4,se=se<<be,me=(se+245760|0)>>>16&2,me=14-(be|ge|me)+(se<<me>>>15)|0,me=l>>>(me+7|0)&1|me<<1):me=0,_e=s[5128+(me<<2)>>2]|0;e:do if(!_e)be=0,ne=0;else for((me|0)==31?ne=0:ne=25-(me>>>1)|0,be=0,ue=l<<ne,ne=0;;){if(ge=s[_e+4>>2]&-8,se=ge-l|0,se>>>0<Se>>>0)if((ge|0)==(l|0)){Se=se,be=_e,ne=_e;break e}else Se=se,ne=_e;if(se=s[_e+20>>2]|0,_e=s[_e+(ue>>>31<<2)+16>>2]|0,be=(se|0)==0|(se|0)==(_e|0)?be:se,_e)ue=ue<<1;else break}while(!1);if((be|0)==0&(ne|0)==0){if(se=2<<me,Ee=Ee&(se|0-se),!Ee)break;se=(Ee&0-Ee)+-1|0,_e=se>>>12&16,se=se>>>_e,me=se>>>5&8,se=se>>>me,ue=se>>>2&4,se=se>>>ue,ge=se>>>1&2,se=se>>>ge,be=se>>>1&1,be=s[5128+((me|_e|ue|ge|be)+(se>>>be)<<2)>>2]|0}if(be)for(;;){if(se=(s[be+4>>2]&-8)-l|0,Ee=se>>>0<Se>>>0,Se=Ee?se:Se,ne=Ee?be:ne,Ee=s[be+16>>2]|0,Ee){be=Ee;continue}if(be=s[be+20>>2]|0,!be)break}if(ne|0&&Se>>>0<((s[1208]|0)-l|0)>>>0){S=s[1210]|0,ne>>>0<S>>>0&&ye(),m=ne+l|0,ne>>>0>=m>>>0&&ye(),f=s[ne+24>>2]|0,L=s[ne+12>>2]|0;do if((L|0)==(ne|0)){if(b=ne+20|0,L=s[b>>2]|0,!L&&(b=ne+16|0,L=s[b>>2]|0,!L)){Ce=0;break}for(;;){if(P=L+20|0,w=s[P>>2]|0,w){L=w,b=P;continue}if(P=L+16|0,w=s[P>>2]|0,w)L=w,b=P;else break}if(b>>>0<S>>>0)ye();else{s[b>>2]=0,Ce=L;break}}else if(b=s[ne+8>>2]|0,b>>>0<S>>>0&&ye(),P=b+12|0,(s[P>>2]|0)!=(ne|0)&&ye(),S=L+8|0,(s[S>>2]|0)==(ne|0)){s[P>>2]=L,s[S>>2]=b,Ce=L;break}else ye();while(!1);do if(f){if(S=s[ne+28>>2]|0,L=5128+(S<<2)|0,(ne|0)==(s[L>>2]|0)){if(s[L>>2]=Ce,!Ce){s[1207]=s[1207]&~(1<<S);break}}else if(f>>>0<(s[1210]|0)>>>0&&ye(),S=f+16|0,(s[S>>2]|0)==(ne|0)?s[S>>2]=Ce:s[f+20>>2]=Ce,!Ce)break;S=s[1210]|0,Ce>>>0<S>>>0&&ye(),s[Ce+24>>2]=f,f=s[ne+16>>2]|0;do if(f)if(f>>>0<S>>>0)ye();else{s[Ce+16>>2]=f,s[f+24>>2]=Ce;break}while(!1);if(f=s[ne+20>>2]|0,f)if(f>>>0<(s[1210]|0)>>>0)ye();else{s[Ce+20>>2]=f,s[f+24>>2]=Ce;break}}while(!1);e:do if(Se>>>0>=16){if(s[ne+4>>2]=l|3,s[ne+(l|4)>>2]=Se|1,s[ne+(Se+l)>>2]=Se,S=Se>>>3,Se>>>0<256){b=S<<1,f=4864+(b<<2)|0,L=s[1206]|0,S=1<<S;do if(!(L&S))s[1206]=L|S,de=4864+(b+2<<2)|0,te=f;else{if(S=4864+(b+2<<2)|0,L=s[S>>2]|0,L>>>0>=(s[1210]|0)>>>0){de=S,te=L;break}ye()}while(!1);s[de>>2]=m,s[te+12>>2]=m,s[ne+(l+8)>>2]=te,s[ne+(l+12)>>2]=f;break}if(f=Se>>>8,f?Se>>>0>16777215?f=31:(ge=(f+1048320|0)>>>16&8,se=f<<ge,be=(se+520192|0)>>>16&4,se=se<<be,f=(se+245760|0)>>>16&2,f=14-(be|ge|f)+(se<<f>>>15)|0,f=Se>>>(f+7|0)&1|f<<1):f=0,S=5128+(f<<2)|0,s[ne+(l+28)>>2]=f,s[ne+(l+20)>>2]=0,s[ne+(l+16)>>2]=0,L=s[1207]|0,b=1<<f,!(L&b)){s[1207]=L|b,s[S>>2]=m,s[ne+(l+24)>>2]=S,s[ne+(l+12)>>2]=m,s[ne+(l+8)>>2]=m;break}b=s[S>>2]|0,(f|0)==31?f=0:f=25-(f>>>1)|0;t:do if((s[b+4>>2]&-8|0)!=(Se|0)){for(f=Se<<f;L=b+(f>>>31<<2)+16|0,S=s[L>>2]|0,!!S;)if((s[S+4>>2]&-8|0)==(Se|0)){C=S;break t}else f=f<<1,b=S;if(L>>>0<(s[1210]|0)>>>0)ye();else{s[L>>2]=m,s[ne+(l+24)>>2]=b,s[ne+(l+12)>>2]=m,s[ne+(l+8)>>2]=m;break e}}else C=b;while(!1);if(S=C+8|0,f=s[S>>2]|0,se=s[1210]|0,C>>>0>=se>>>0&f>>>0>=se>>>0){s[f+12>>2]=m,s[S>>2]=m,s[ne+(l+8)>>2]=f,s[ne+(l+12)>>2]=C,s[ne+(l+24)>>2]=0;break}else ye()}else se=Se+l|0,s[ne+4>>2]=se|3,se=ne+(se+4)|0,s[se>>2]=s[se>>2]|1;while(!1);return se=ne+8|0,g=u,se|0}}}else l=-1;while(!1);if(C=s[1208]|0,C>>>0>=l>>>0)return f=C-l|0,m=s[1211]|0,f>>>0>15?(s[1211]=m+l,s[1208]=f,s[m+(l+4)>>2]=f|1,s[m+C>>2]=f,s[m+4>>2]=l|3):(s[1208]=0,s[1211]=0,s[m+4>>2]=C|3,se=m+(C+4)|0,s[se>>2]=s[se>>2]|1),se=m+8|0,g=u,se|0;if(C=s[1209]|0,C>>>0>l>>>0)return ge=C-l|0,s[1209]=ge,se=s[1212]|0,s[1212]=se+l,s[se+(l+4)>>2]=ge|1,s[se+4>>2]=l|3,se=se+8|0,g=u,se|0;do if(!(s[1324]|0))if(C=Sr(30)|0,C+-1&C)ye();else{s[1326]=C,s[1325]=C,s[1327]=-1,s[1328]=-1,s[1329]=0,s[1317]=0,s[1324]=(Er(0)|0)&-16^1431655768;break}while(!1);if(Ce=l+48|0,C=s[1326]|0,de=l+47|0,Se=C+de|0,C=0-C|0,te=Se&C,te>>>0<=l>>>0||(ne=s[1316]|0,ne|0&&(ge=s[1314]|0,se=ge+te|0,se>>>0<=ge>>>0|se>>>0>ne>>>0)))return se=0,g=u,se|0;e:do if(s[1317]&4)ne=0,x=198;else{Ee=s[1212]|0;t:do if(Ee){for(ne=5272;me=s[ne>>2]|0,!(me>>>0<=Ee>>>0&&(Te=ne+4|0,(me+(s[Te>>2]|0)|0)>>>0>Ee>>>0));)if(ne=s[ne+8>>2]|0,!ne){x=181;break t}ne?(Se=Se-(s[1209]|0)&C,Se>>>0<2147483647?(C=Ei(Se|0)|0,(C|0)==((s[ne>>2]|0)+(s[Te>>2]|0)|0)?(ne=Se,x=190):(ne=Se,x=191)):ne=0):x=181}else x=181;while(!1);do if((x|0)==181)if(Te=Ei(0)|0,(Te|0)!=-1)if(Se=Te,ne=s[1325]|0,C=ne+-1|0,C&Se?ne=te-Se+(C+Se&0-ne)|0:ne=te,C=s[1314]|0,Se=C+ne|0,ne>>>0>l>>>0&ne>>>0<2147483647){if(se=s[1316]|0,se|0&&Se>>>0<=C>>>0|Se>>>0>se>>>0){ne=0;break}C=Ei(ne|0)|0,(C|0)==(Te|0)?(C=Te,x=190):x=191}else ne=0;else ne=0;while(!1);t:do if((x|0)==190){if((C|0)!=-1){B=ne,x=201;break e}}else if((x|0)==191){x=0-ne|0;do if((C|0)!=-1&ne>>>0<2147483647&Ce>>>0>ne>>>0&&(Q=s[1326]|0,Q=de-ne+Q&0-Q,Q>>>0<2147483647))if((Ei(Q|0)|0)==-1){Ei(x|0)|0,ne=0;break t}else{ne=Q+ne|0;break}while(!1);if((C|0)==-1)ne=0;else{B=ne,x=201;break e}}while(!1);s[1317]=s[1317]|4,x=198}while(!1);if((x|0)==198&&te>>>0<2147483647&&(Y=Ei(te|0)|0,U=Ei(0)|0,(Y|0)!=-1&(U|0)!=-1&Y>>>0<U>>>0)&&(R=U-Y|0,B=R>>>0>(l+40|0)>>>0,B)&&(C=Y,B=B?R:ne,x=201),(x|0)==201){R=(s[1314]|0)+B|0,s[1314]=R,R>>>0>(s[1315]|0)>>>0&&(s[1315]=R),R=s[1212]|0;e:do if(R){for(Y=5272;;){if(U=s[Y>>2]|0,te=Y+4|0,de=s[te>>2]|0,(C|0)==(U+de|0)){x=213;break}if(Q=s[Y+8>>2]|0,Q)Y=Q;else break}if((x|0)==213&&!(s[Y+12>>2]&8|0)&&R>>>0>=U>>>0&R>>>0<C>>>0){s[te>>2]=de+B,m=(s[1209]|0)+B|0,f=R+8|0,f&7?f=0-f&7:f=0,se=m-f|0,s[1212]=R+f,s[1209]=se,s[R+(f+4)>>2]=se|1,s[R+(m+4)>>2]=40,s[1213]=s[1328];break}for(U=s[1210]|0,C>>>0<U>>>0&&(s[1210]=C,U=C),te=C+B|0,Y=5272;;){if((s[Y>>2]|0)==(te|0)){x=223;break}if(Q=s[Y+8>>2]|0,Q)Y=Q;else break}if((x|0)==223&&!(s[Y+12>>2]&8|0)){s[Y>>2]=C,b=Y+4|0,s[b>>2]=(s[b>>2]|0)+B,b=C+8|0,b&7?b=0-b&7:b=0,P=C+(B+8)|0,P&7?I=0-P&7:I=0,x=C+(I+B)|0,w=b+l|0,P=C+w|0,E=x-(C+b)-l|0,s[C+(b+4)>>2]=l|3;t:do if((x|0)!=(R|0)){if((x|0)==(s[1211]|0)){se=(s[1208]|0)+E|0,s[1208]=se,s[1211]=P,s[C+(w+4)>>2]=se|1,s[C+(se+w)>>2]=se;break}if(R=B+4|0,Q=s[C+(R+I)>>2]|0,(Q&3|0)==1){l=Q&-8,Y=Q>>>3;i:do if(Q>>>0>=256){A=s[C+((I|24)+B)>>2]|0,Y=s[C+(B+12+I)>>2]|0;do if((Y|0)==(x|0)){if(te=I|16,Q=C+(R+te)|0,Y=s[Q>>2]|0,!Y&&(Q=C+(te+B)|0,Y=s[Q>>2]|0,!Y)){L=0;break}for(;;){if(de=Y+20|0,te=s[de>>2]|0,te){Y=te,Q=de;continue}if(de=Y+16|0,te=s[de>>2]|0,te)Y=te,Q=de;else break}if(Q>>>0<U>>>0)ye();else{s[Q>>2]=0,L=Y;break}}else if(Q=s[C+((I|8)+B)>>2]|0,Q>>>0<U>>>0&&ye(),te=Q+12|0,(s[te>>2]|0)!=(x|0)&&ye(),U=Y+8|0,(s[U>>2]|0)==(x|0)){s[te>>2]=Y,s[U>>2]=Q,L=Y;break}else ye();while(!1);if(!A)break;U=s[C+(B+28+I)>>2]|0,Y=5128+(U<<2)|0;do if((x|0)!=(s[Y>>2]|0)){if(A>>>0<(s[1210]|0)>>>0&&ye(),U=A+16|0,(s[U>>2]|0)==(x|0)?s[U>>2]=L:s[A+20>>2]=L,!L)break i}else{if(s[Y>>2]=L,L)break;s[1207]=s[1207]&~(1<<U);break i}while(!1);x=s[1210]|0,L>>>0<x>>>0&&ye(),s[L+24>>2]=A,U=I|16,A=s[C+(U+B)>>2]|0;do if(A)if(A>>>0<x>>>0)ye();else{s[L+16>>2]=A,s[A+24>>2]=L;break}while(!1);if(A=s[C+(R+U)>>2]|0,!A)break;if(A>>>0<(s[1210]|0)>>>0)ye();else{s[L+20>>2]=A,s[A+24>>2]=L;break}}else{L=s[C+((I|8)+B)>>2]|0,R=s[C+(B+12+I)>>2]|0,Q=4864+(Y<<1<<2)|0;do if((L|0)!=(Q|0)){if(L>>>0<U>>>0&&ye(),(s[L+12>>2]|0)==(x|0))break;ye()}while(!1);if((R|0)==(L|0)){s[1206]=s[1206]&~(1<<Y);break}do if((R|0)==(Q|0))A=R+8|0;else{if(R>>>0<U>>>0&&ye(),U=R+8|0,(s[U>>2]|0)==(x|0)){A=U;break}ye()}while(!1);s[L+12>>2]=R,s[A>>2]=L}while(!1);x=C+((l|I)+B)|0,E=l+E|0}if(L=x+4|0,s[L>>2]=s[L>>2]&-2,s[C+(w+4)>>2]=E|1,s[C+(E+w)>>2]=E,L=E>>>3,E>>>0<256){A=L<<1,m=4864+(A<<2)|0,E=s[1206]|0,L=1<<L;do if(!(E&L))s[1206]=E|L,S=4864+(A+2<<2)|0,f=m;else{if(A=4864+(A+2<<2)|0,L=s[A>>2]|0,L>>>0>=(s[1210]|0)>>>0){S=A,f=L;break}ye()}while(!1);s[S>>2]=P,s[f+12>>2]=P,s[C+(w+8)>>2]=f,s[C+(w+12)>>2]=m;break}f=E>>>8;do if(!f)f=0;else{if(E>>>0>16777215){f=31;break}ge=(f+1048320|0)>>>16&8,se=f<<ge,be=(se+520192|0)>>>16&4,se=se<<be,f=(se+245760|0)>>>16&2,f=14-(be|ge|f)+(se<<f>>>15)|0,f=E>>>(f+7|0)&1|f<<1}while(!1);if(A=5128+(f<<2)|0,s[C+(w+28)>>2]=f,s[C+(w+20)>>2]=0,s[C+(w+16)>>2]=0,L=s[1207]|0,S=1<<f,!(L&S)){s[1207]=L|S,s[A>>2]=P,s[C+(w+24)>>2]=A,s[C+(w+12)>>2]=P,s[C+(w+8)>>2]=P;break}S=s[A>>2]|0,(f|0)==31?f=0:f=25-(f>>>1)|0;i:do if((s[S+4>>2]&-8|0)!=(E|0)){for(f=E<<f;L=S+(f>>>31<<2)+16|0,A=s[L>>2]|0,!!A;)if((s[A+4>>2]&-8|0)==(E|0)){m=A;break i}else f=f<<1,S=A;if(L>>>0<(s[1210]|0)>>>0)ye();else{s[L>>2]=P,s[C+(w+24)>>2]=S,s[C+(w+12)>>2]=P,s[C+(w+8)>>2]=P;break t}}else m=S;while(!1);if(f=m+8|0,S=s[f>>2]|0,se=s[1210]|0,m>>>0>=se>>>0&S>>>0>=se>>>0){s[S+12>>2]=P,s[f>>2]=P,s[C+(w+8)>>2]=S,s[C+(w+12)>>2]=m,s[C+(w+24)>>2]=0;break}else ye()}else se=(s[1209]|0)+E|0,s[1209]=se,s[1212]=P,s[C+(w+4)>>2]=se|1;while(!1);return se=C+(b|8)|0,g=u,se|0}for(f=5272;m=s[f>>2]|0,!(m>>>0<=R>>>0&&(I=s[f+4>>2]|0,E=m+I|0,E>>>0>R>>>0));)f=s[f+8>>2]|0;if(f=m+(I+-39)|0,f&7?f=0-f&7:f=0,m=m+(I+-47+f)|0,m=m>>>0<(R+16|0)>>>0?R:m,f=m+8|0,S=C+8|0,S&7?S=0-S&7:S=0,se=B+-40-S|0,s[1212]=C+S,s[1209]=se,s[C+(S+4)>>2]=se|1,s[C+(B+-36)>>2]=40,s[1213]=s[1328],s[m+4>>2]=27,s[f+0>>2]=s[1318],s[f+4>>2]=s[1319],s[f+8>>2]=s[1320],s[f+12>>2]=s[1321],s[1318]=C,s[1319]=B,s[1321]=0,s[1320]=f,f=m+28|0,s[f>>2]=7,(m+32|0)>>>0<E>>>0)do se=f,f=f+4|0,s[f>>2]=7;while((se+8|0)>>>0<E>>>0);if((m|0)!=(R|0)){if(m=m-R|0,f=R+(m+4)|0,s[f>>2]=s[f>>2]&-2,s[R+4>>2]=m|1,s[R+m>>2]=m,f=m>>>3,m>>>0<256){S=f<<1,m=4864+(S<<2)|0,L=s[1206]|0,f=1<<f;do if(!(L&f))s[1206]=L|f,w=4864+(S+2<<2)|0,P=m;else{if(S=4864+(S+2<<2)|0,f=s[S>>2]|0,f>>>0>=(s[1210]|0)>>>0){w=S,P=f;break}ye()}while(!1);s[w>>2]=R,s[P+12>>2]=R,s[R+8>>2]=P,s[R+12>>2]=m;break}if(f=m>>>8,f?m>>>0>16777215?f=31:(ge=(f+1048320|0)>>>16&8,se=f<<ge,be=(se+520192|0)>>>16&4,se=se<<be,f=(se+245760|0)>>>16&2,f=14-(be|ge|f)+(se<<f>>>15)|0,f=m>>>(f+7|0)&1|f<<1):f=0,P=5128+(f<<2)|0,s[R+28>>2]=f,s[R+20>>2]=0,s[R+16>>2]=0,S=s[1207]|0,L=1<<f,!(S&L)){s[1207]=S|L,s[P>>2]=R,s[R+24>>2]=P,s[R+12>>2]=R,s[R+8>>2]=R;break}S=s[P>>2]|0,(f|0)==31?f=0:f=25-(f>>>1)|0;t:do if((s[S+4>>2]&-8|0)!=(m|0)){for(f=m<<f,P=S;S=P+(f>>>31<<2)+16|0,L=s[S>>2]|0,!!L;)if((s[L+4>>2]&-8|0)==(m|0)){b=L;break t}else f=f<<1,P=L;if(S>>>0<(s[1210]|0)>>>0)ye();else{s[S>>2]=R,s[R+24>>2]=P,s[R+12>>2]=R,s[R+8>>2]=R;break e}}else b=S;while(!1);if(f=b+8|0,m=s[f>>2]|0,se=s[1210]|0,b>>>0>=se>>>0&m>>>0>=se>>>0){s[m+12>>2]=R,s[f>>2]=R,s[R+8>>2]=m,s[R+12>>2]=b,s[R+24>>2]=0;break}else ye()}}else{se=s[1210]|0,(se|0)==0|C>>>0<se>>>0&&(s[1210]=C),s[1318]=C,s[1319]=B,s[1321]=0,s[1215]=s[1324],s[1214]=-1,m=0;do se=m<<1,ge=4864+(se<<2)|0,s[4864+(se+3<<2)>>2]=ge,s[4864+(se+2<<2)>>2]=ge,m=m+1|0;while((m|0)!=32);m=C+8|0,m&7?m=0-m&7:m=0,se=B+-40-m|0,s[1212]=C+m,s[1209]=se,s[C+(m+4)>>2]=se|1,s[C+(B+-36)>>2]=40,s[1213]=s[1328]}while(!1);if(m=s[1209]|0,m>>>0>l>>>0)return ge=m-l|0,s[1209]=ge,se=s[1212]|0,s[1212]=se+l,s[se+(l+4)>>2]=ge|1,s[se+4>>2]=l|3,se=se+8|0,g=u,se|0}return s[(Xe()|0)>>2]=12,se=0,g=u,se|0}function Me(l){l=l|0;var u=0,m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0,B=0,R=0,U=0,Y=0,Q=0,te=0,de=0;if(u=g,!l){g=u;return}B=l+-8|0,R=s[1210]|0,B>>>0<R>>>0&&ye(),I=s[l+-4>>2]|0,E=I&3,(E|0)==1&&ye(),P=I&-8,b=l+(P+-8)|0;do if(I&1)f=B,x=P;else{if(Q=s[B>>2]|0,!E){g=u;return}if(B=-8-Q|0,I=l+B|0,E=Q+P|0,I>>>0<R>>>0&&ye(),(I|0)==(s[1211]|0)){if(f=l+(P+-4)|0,x=s[f>>2]|0,(x&3|0)!=3){f=I,x=E;break}s[1208]=E,s[f>>2]=x&-2,s[l+(B+4)>>2]=E|1,s[b>>2]=E,g=u;return}if(Y=Q>>>3,Q>>>0<256){if(f=s[l+(B+8)>>2]|0,x=s[l+(B+12)>>2]|0,C=4864+(Y<<1<<2)|0,(f|0)!=(C|0)&&(f>>>0<R>>>0&&ye(),(s[f+12>>2]|0)!=(I|0)&&ye()),(x|0)==(f|0)){s[1206]=s[1206]&~(1<<Y),f=I,x=E;break}(x|0)!=(C|0)?(x>>>0<R>>>0&&ye(),C=x+8|0,(s[C>>2]|0)==(I|0)?U=C:ye()):U=x+8|0,s[f+12>>2]=x,s[U>>2]=f,f=I,x=E;break}U=s[l+(B+24)>>2]|0,Y=s[l+(B+12)>>2]|0;do if((Y|0)==(I|0)){if(Q=l+(B+20)|0,Y=s[Q>>2]|0,!Y&&(Q=l+(B+16)|0,Y=s[Q>>2]|0,!Y)){C=0;break}for(;;){if(te=Y+20|0,de=s[te>>2]|0,de){Y=de,Q=te;continue}if(te=Y+16|0,de=s[te>>2]|0,de)Y=de,Q=te;else break}if(Q>>>0<R>>>0)ye();else{s[Q>>2]=0,C=Y;break}}else if(Q=s[l+(B+8)>>2]|0,Q>>>0<R>>>0&&ye(),R=Q+12|0,(s[R>>2]|0)!=(I|0)&&ye(),te=Y+8|0,(s[te>>2]|0)==(I|0)){s[R>>2]=Y,s[te>>2]=Q,C=Y;break}else ye();while(!1);if(U){if(R=s[l+(B+28)>>2]|0,Y=5128+(R<<2)|0,(I|0)==(s[Y>>2]|0)){if(s[Y>>2]=C,!C){s[1207]=s[1207]&~(1<<R),f=I,x=E;break}}else if(U>>>0<(s[1210]|0)>>>0&&ye(),R=U+16|0,(s[R>>2]|0)==(I|0)?s[R>>2]=C:s[U+20>>2]=C,!C){f=I,x=E;break}R=s[1210]|0,C>>>0<R>>>0&&ye(),s[C+24>>2]=U,U=s[l+(B+16)>>2]|0;do if(U)if(U>>>0<R>>>0)ye();else{s[C+16>>2]=U,s[U+24>>2]=C;break}while(!1);if(B=s[l+(B+20)>>2]|0,B)if(B>>>0<(s[1210]|0)>>>0)ye();else{s[C+20>>2]=B,s[B+24>>2]=C,f=I,x=E;break}else f=I,x=E}else f=I,x=E}while(!1);if(f>>>0>=b>>>0&&ye(),E=l+(P+-4)|0,I=s[E>>2]|0,I&1||ye(),I&2)s[E>>2]=I&-2,s[f+4>>2]=x|1,s[f+x>>2]=x;else{if((b|0)==(s[1212]|0)){if(de=(s[1209]|0)+x|0,s[1209]=de,s[1212]=f,s[f+4>>2]=de|1,(f|0)!=(s[1211]|0)){g=u;return}s[1211]=0,s[1208]=0,g=u;return}if((b|0)==(s[1211]|0)){de=(s[1208]|0)+x|0,s[1208]=de,s[1211]=f,s[f+4>>2]=de|1,s[f+de>>2]=de,g=u;return}x=(I&-8)+x|0,E=I>>>3;do if(I>>>0>=256){A=s[l+(P+16)>>2]|0,E=s[l+(P|4)>>2]|0;do if((E|0)==(b|0)){if(I=l+(P+12)|0,E=s[I>>2]|0,!E&&(I=l+(P+8)|0,E=s[I>>2]|0,!E)){w=0;break}for(;;){if(B=E+20|0,C=s[B>>2]|0,C){E=C,I=B;continue}if(C=E+16|0,B=s[C>>2]|0,B)E=B,I=C;else break}if(I>>>0<(s[1210]|0)>>>0)ye();else{s[I>>2]=0,w=E;break}}else if(I=s[l+P>>2]|0,I>>>0<(s[1210]|0)>>>0&&ye(),C=I+12|0,(s[C>>2]|0)!=(b|0)&&ye(),B=E+8|0,(s[B>>2]|0)==(b|0)){s[C>>2]=E,s[B>>2]=I,w=E;break}else ye();while(!1);if(A){if(E=s[l+(P+20)>>2]|0,I=5128+(E<<2)|0,(b|0)==(s[I>>2]|0)){if(s[I>>2]=w,!w){s[1207]=s[1207]&~(1<<E);break}}else if(A>>>0<(s[1210]|0)>>>0&&ye(),E=A+16|0,(s[E>>2]|0)==(b|0)?s[E>>2]=w:s[A+20>>2]=w,!w)break;b=s[1210]|0,w>>>0<b>>>0&&ye(),s[w+24>>2]=A,A=s[l+(P+8)>>2]|0;do if(A)if(A>>>0<b>>>0)ye();else{s[w+16>>2]=A,s[A+24>>2]=w;break}while(!1);if(b=s[l+(P+12)>>2]|0,b)if(b>>>0<(s[1210]|0)>>>0)ye();else{s[w+20>>2]=b,s[b+24>>2]=w;break}}}else{if(w=s[l+P>>2]|0,P=s[l+(P|4)>>2]|0,l=4864+(E<<1<<2)|0,(w|0)!=(l|0)&&(w>>>0<(s[1210]|0)>>>0&&ye(),(s[w+12>>2]|0)!=(b|0)&&ye()),(P|0)==(w|0)){s[1206]=s[1206]&~(1<<E);break}(P|0)!=(l|0)?(P>>>0<(s[1210]|0)>>>0&&ye(),l=P+8|0,(s[l>>2]|0)==(b|0)?A=l:ye()):A=P+8|0,s[w+12>>2]=P,s[A>>2]=w}while(!1);if(s[f+4>>2]=x|1,s[f+x>>2]=x,(f|0)==(s[1211]|0)){s[1208]=x,g=u;return}}if(b=x>>>3,x>>>0<256){P=b<<1,m=4864+(P<<2)|0,w=s[1206]|0,b=1<<b,w&b?(P=4864+(P+2<<2)|0,b=s[P>>2]|0,b>>>0<(s[1210]|0)>>>0?ye():(S=P,L=b)):(s[1206]=w|b,S=4864+(P+2<<2)|0,L=m),s[S>>2]=f,s[L+12>>2]=f,s[f+8>>2]=L,s[f+12>>2]=m,g=u;return}S=x>>>8,S?x>>>0>16777215?S=31:(te=(S+1048320|0)>>>16&8,de=S<<te,Q=(de+520192|0)>>>16&4,de=de<<Q,S=(de+245760|0)>>>16&2,S=14-(Q|te|S)+(de<<S>>>15)|0,S=x>>>(S+7|0)&1|S<<1):S=0,L=5128+(S<<2)|0,s[f+28>>2]=S,s[f+20>>2]=0,s[f+16>>2]=0,P=s[1207]|0,b=1<<S;e:do if(P&b){L=s[L>>2]|0,(S|0)==31?S=0:S=25-(S>>>1)|0;t:do if((s[L+4>>2]&-8|0)!=(x|0)){for(S=x<<S;P=L+(S>>>31<<2)+16|0,b=s[P>>2]|0,!!b;)if((s[b+4>>2]&-8|0)==(x|0)){m=b;break t}else S=S<<1,L=b;if(P>>>0<(s[1210]|0)>>>0)ye();else{s[P>>2]=f,s[f+24>>2]=L,s[f+12>>2]=f,s[f+8>>2]=f;break e}}else m=L;while(!1);if(L=m+8|0,S=s[L>>2]|0,de=s[1210]|0,m>>>0>=de>>>0&S>>>0>=de>>>0){s[S+12>>2]=f,s[L>>2]=f,s[f+8>>2]=S,s[f+12>>2]=m,s[f+24>>2]=0;break}else ye()}else s[1207]=P|b,s[L>>2]=f,s[f+24>>2]=L,s[f+12>>2]=f,s[f+8>>2]=f;while(!1);if(de=(s[1214]|0)+-1|0,s[1214]=de,!de)m=5280;else{g=u;return}for(;m=s[m>>2]|0,m;)m=m+8|0;s[1214]=-1,g=u}function ht(l,u){l=l|0,u=u|0;var m=0,f=0,S=0;m=g;do if(l){if(u>>>0>4294967231){s[(Xe()|0)>>2]=12,f=0;break}if(u>>>0<11?f=16:f=u+11&-8,f=ca(l+-8|0,f)|0,f){f=f+8|0;break}f=Zi(u)|0,f?(S=s[l+-4>>2]|0,S=(S&-8)-(S&3|0?4:8)|0,Zn(f|0,l|0,(S>>>0<u>>>0?S:u)|0)|0,Me(l)):f=0}else f=Zi(u)|0;while(!1);return g=m,f|0}function Wn(l){return l=l|0,(l|0)==32?l=1:l=(l+-9|0)>>>0<5,l&1|0}function sa(l,u,m,f,S){l=l|0,u=u|0,m=m|0,f=f|0,S=S|0;var L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0,B=0,R=0;if(L=g,u>>>0>36)return s[(Xe()|0)>>2]=22,B=0,R=0,ae=B,g=L,R|0;b=l+4|0,P=l+100|0;do w=s[b>>2]|0,w>>>0<(s[P>>2]|0)>>>0?(s[b>>2]=w+1,E=a[w>>0]|0):E=ot(l)|0;while(Wn(E)|0);do if((E|0)==43|(E|0)==45)if(w=((E|0)==45)<<31>>31,A=s[b>>2]|0,A>>>0<(s[P>>2]|0)>>>0){s[b>>2]=A+1,E=a[A>>0]|0;break}else{E=ot(l)|0;break}else w=0;while(!1);A=(u|0)==0;do if((u&-17|0)==0&(E|0)==48){if(E=s[b>>2]|0,E>>>0<(s[P>>2]|0)>>>0?(s[b>>2]=E+1,E=a[E>>0]|0):E=ot(l)|0,(E|32|0)!=120)if(A){u=8,m=46;break}else{m=32;break}if(u=s[b>>2]|0,u>>>0<(s[P>>2]|0)>>>0?(s[b>>2]=u+1,E=a[u>>0]|0):E=ot(l)|0,(a[E+5321>>0]|0)>15)return f=(s[P>>2]|0)==0,f||(s[b>>2]=(s[b>>2]|0)+-1),m?f?(B=0,R=0,ae=B,g=L,R|0):(s[b>>2]=(s[b>>2]|0)+-1,B=0,R=0,ae=B,g=L,R|0):(si(l,0),B=0,R=0,ae=B,g=L,R|0);u=16,m=46}else if(u=A?10:u,(a[E+5321>>0]|0)>>>0<u>>>0)m=32;else return s[P>>2]|0&&(s[b>>2]=(s[b>>2]|0)+-1),si(l,0),s[(Xe()|0)>>2]=22,B=0,R=0,ae=B,g=L,R|0;while(!1);if((m|0)==32)if((u|0)==10){if(u=E+-48|0,u>>>0<10){A=0;do A=(A*10|0)+u|0,u=s[b>>2]|0,u>>>0<(s[P>>2]|0)>>>0?(s[b>>2]=u+1,E=a[u>>0]|0):E=ot(l)|0,u=E+-48|0;while(u>>>0<10&A>>>0<429496729);I=0}else A=0,I=0;if(u=E+-48|0,u>>>0<10){do{if(x=ei(A|0,I|0,10,0)|0,C=ae,B=((u|0)<0)<<31>>31,R=~B,C>>>0>R>>>0|(C|0)==(R|0)&x>>>0>~u>>>0)break;A=tt(x|0,C|0,u|0,B|0)|0,I=ae,u=s[b>>2]|0,u>>>0<(s[P>>2]|0)>>>0?(s[b>>2]=u+1,E=a[u>>0]|0):E=ot(l)|0,u=E+-48|0}while(u>>>0<10&(I>>>0<429496729|(I|0)==429496729&A>>>0<2576980378));u>>>0<=9&&(u=10,m=72)}}else m=46;e:do if((m|0)==46){if(!(u+-1&u)){if(m=n[5584+((u*23|0)>>>5&7)>>0]|0,C=n[E+5321>>0]|0,A=C&255,A>>>0<u>>>0){E=A,A=0;do A=E|A<<m,E=s[b>>2]|0,E>>>0<(s[P>>2]|0)>>>0?(s[b>>2]=E+1,B=a[E>>0]|0):B=ot(l)|0,C=n[B+5321>>0]|0,E=C&255;while(E>>>0<u>>>0&A>>>0<134217728);I=0}else I=0,A=0,B=E;if(E=Qn(-1,-1,m|0)|0,x=ae,(C&255)>>>0>=u>>>0|(I>>>0>x>>>0|(I|0)==(x|0)&A>>>0>E>>>0)){E=B,m=72;break}for(;;)if(A=Ri(A|0,I|0,m|0)|0,I=ae,A=C&255|A,C=s[b>>2]|0,C>>>0<(s[P>>2]|0)>>>0?(s[b>>2]=C+1,B=a[C>>0]|0):B=ot(l)|0,C=n[B+5321>>0]|0,(C&255)>>>0>=u>>>0|(I>>>0>x>>>0|(I|0)==(x|0)&A>>>0>E>>>0)){E=B,m=72;break e}}if(C=n[E+5321>>0]|0,m=C&255,m>>>0<u>>>0){A=0;do A=m+(H(A,u)|0)|0,m=s[b>>2]|0,m>>>0<(s[P>>2]|0)>>>0?(s[b>>2]=m+1,x=a[m>>0]|0):x=ot(l)|0,C=n[x+5321>>0]|0,m=C&255;while(m>>>0<u>>>0&A>>>0<119304647);I=0}else A=0,I=0,x=E;if((C&255)>>>0<u>>>0)for(m=dn(-1,-1,u|0,0)|0,E=ae;;){if(I>>>0>E>>>0|(I|0)==(E|0)&A>>>0>m>>>0){E=x,m=72;break e}if(B=ei(A|0,I|0,u|0,0)|0,R=ae,C=C&255,R>>>0>4294967295|(R|0)==-1&B>>>0>~C>>>0){E=x,m=72;break e}if(A=tt(C|0,0,B|0,R|0)|0,I=ae,x=s[b>>2]|0,x>>>0<(s[P>>2]|0)>>>0?(s[b>>2]=x+1,x=a[x>>0]|0):x=ot(l)|0,C=n[x+5321>>0]|0,(C&255)>>>0>=u>>>0){E=x,m=72;break}}else E=x,m=72}while(!1);if((m|0)==72&&(a[E+5321>>0]|0)>>>0<u>>>0){do m=s[b>>2]|0,m>>>0<(s[P>>2]|0)>>>0?(s[b>>2]=m+1,m=a[m>>0]|0):m=ot(l)|0;while((a[m+5321>>0]|0)>>>0<u>>>0);s[(Xe()|0)>>2]=34,I=S,A=f}if(s[P>>2]|0&&(s[b>>2]=(s[b>>2]|0)+-1),!(I>>>0<S>>>0|(I|0)==(S|0)&A>>>0<f>>>0)){if(!((f&1|0)!=0|!1|(w|0)!=0))return s[(Xe()|0)>>2]=34,R=tt(f|0,S|0,-1,-1)|0,B=ae,ae=B,g=L,R|0;if(I>>>0>S>>>0|(I|0)==(S|0)&A>>>0>f>>>0)return s[(Xe()|0)>>2]=34,B=S,R=f,ae=B,g=L,R|0}return R=((w|0)<0)<<31>>31,R=Ct(A^w|0,I^R|0,w|0,R|0)|0,B=ae,ae=B,g=L,R|0}function na(l,u,m){l=l|0,u=u|0,m=m|0;var f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0,B=0,R=0,U=0,Y=0,Q=0,te=0,de=0,Ce=0,Te=0,ne=0,Se=0,Ee=0,me=0,_e=0,ue=0,be=0,ge=0;if(f=g,g=g+512|0,b=f,!u)u=24,L=-149;else if((u|0)==2)u=53,L=-1074;else if((u|0)==1)u=53,L=-1074;else return ue=0,g=f,+ue;A=l+4|0,E=l+100|0;do S=s[A>>2]|0,S>>>0<(s[E>>2]|0)>>>0?(s[A>>2]=S+1,U=a[S>>0]|0):U=ot(l)|0;while(Wn(U)|0);do if((U|0)==43|(U|0)==45)if(S=1-(((U|0)==45&1)<<1)|0,w=s[A>>2]|0,w>>>0<(s[E>>2]|0)>>>0){s[A>>2]=w+1,U=a[w>>0]|0;break}else{U=ot(l)|0;break}else S=1;while(!1);C=0;do{if((U|32|0)!=(n[5600+C>>0]|0))break;do if(C>>>0<7)if(w=s[A>>2]|0,w>>>0<(s[E>>2]|0)>>>0){s[A>>2]=w+1,U=a[w>>0]|0;break}else{U=ot(l)|0;break}while(!1);C=C+1|0}while(C>>>0<8);do if((C|0)==3)I=23;else if((C|0)!=8){if(w=(m|0)!=0,C>>>0>3&w){if((C|0)==8)break;I=23;break}e:do if(!C){C=0;do{if((U|32|0)!=(n[5616+C>>0]|0))break e;do if(C>>>0<2)if(B=s[A>>2]|0,B>>>0<(s[E>>2]|0)>>>0){s[A>>2]=B+1,U=a[B>>0]|0;break}else{U=ot(l)|0;break}while(!1);C=C+1|0}while(C>>>0<3)}while(!1);if(C)if((C|0)==3){if(u=s[A>>2]|0,u>>>0<(s[E>>2]|0)>>>0?(s[A>>2]=u+1,u=a[u>>0]|0):u=ot(l)|0,(u|0)==40)u=1;else return s[E>>2]|0?(s[A>>2]=(s[A>>2]|0)+-1,ge=X,g=f,+ge):(ge=X,g=f,+ge);for(;S=s[A>>2]|0,S>>>0<(s[E>>2]|0)>>>0?(s[A>>2]=S+1,S=a[S>>0]|0):S=ot(l)|0,!(!((S+-48|0)>>>0<10|(S+-65|0)>>>0<26)&&!((S+-97|0)>>>0<26|(S|0)==95));)u=u+1|0;if((S|0)==41)return ge=X,g=f,+ge;if(S=(s[E>>2]|0)==0,S||(s[A>>2]=(s[A>>2]|0)+-1),!w)return s[(Xe()|0)>>2]=22,si(l,0),ge=0,g=f,+ge;if((u|0)==0|S)return ge=X,g=f,+ge;do u=u+-1|0,s[A>>2]=(s[A>>2]|0)+-1;while(u|0);return x=X,g=f,+x}else return s[E>>2]|0&&(s[A>>2]=(s[A>>2]|0)+-1),s[(Xe()|0)>>2]=22,si(l,0),ge=0,g=f,+ge;else{do if((U|0)==48){if(w=s[A>>2]|0,w>>>0<(s[E>>2]|0)>>>0?(s[A>>2]=w+1,w=a[w>>0]|0):w=ot(l)|0,(w|32|0)!=120){if(!(s[E>>2]|0)){U=48;break}s[A>>2]=(s[A>>2]|0)+-1,U=48;break}for(b=s[A>>2]|0,b>>>0<(s[E>>2]|0)>>>0?(s[A>>2]=b+1,te=a[b>>0]|0,Y=0):(te=ot(l)|0,Y=0);;){if((te|0)==46){I=70;break}else if((te|0)!=48){b=0,w=0,B=0,C=0,U=0,Q=0,Ee=1,R=0,x=0;break}if(b=s[A>>2]|0,b>>>0<(s[E>>2]|0)>>>0){s[A>>2]=b+1,te=a[b>>0]|0,Y=1;continue}else{te=ot(l)|0,Y=1;continue}}if((I|0)==70)if(b=s[A>>2]|0,b>>>0<(s[E>>2]|0)>>>0?(s[A>>2]=b+1,te=a[b>>0]|0):te=ot(l)|0,(te|0)==48){B=0,C=0;do b=s[A>>2]|0,b>>>0<(s[E>>2]|0)>>>0?(s[A>>2]=b+1,te=a[b>>0]|0):te=ot(l)|0,B=tt(B|0,C|0,-1,-1)|0,C=ae;while((te|0)==48);b=0,w=0,Y=1,U=1,Q=0,Ee=1,R=0,x=0}else b=0,w=0,B=0,C=0,U=1,Q=0,Ee=1,R=0,x=0;e:for(;;){Ce=te+-48|0;do if(Ce>>>0>=10){if(de=te|32,Te=(te|0)==46,!((de+-97|0)>>>0<6|Te))break e;if(Te)if(U){te=46;break e}else{B=w,C=b,U=1;break}else{Ce=(te|0)>57?de+-87|0:Ce,I=83;break}}else I=83;while(!1);if((I|0)==83){I=0;do if((b|0)<0|(b|0)==0&w>>>0<8)_e=Ee,R=Ce+(R<<4)|0;else{if((b|0)<0|(b|0)==0&w>>>0<14){ue=Ee*.0625,_e=ue,x=x+ue*+(Ce|0);break}(Ce|0)==0|(Q|0)!=0?_e=Ee:(Q=1,_e=Ee,x=x+Ee*.5)}while(!1);w=tt(w|0,b|0,1,0)|0,b=ae,Y=1,Ee=_e}if(te=s[A>>2]|0,te>>>0<(s[E>>2]|0)>>>0){s[A>>2]=te+1,te=a[te>>0]|0;continue}else{te=ot(l)|0;continue}}if(!Y)return u=(s[E>>2]|0)==0,u||(s[A>>2]=(s[A>>2]|0)+-1),m?!u&&(P=s[A>>2]|0,s[A>>2]=P+-1,(U|0)!=0)&&(s[A>>2]=P+-2):si(l,0),ue=+(S|0)*0,g=f,+ue;if(I=(U|0)==0,P=I?w:B,I=I?b:C,(b|0)<0|(b|0)==0&w>>>0<8)do R=R<<4,w=tt(w|0,b|0,1,0)|0,b=ae;while((b|0)<0|(b|0)==0&w>>>0<8);do if((te|32|0)==112){if(w=Xn(l,m)|0,b=ae,(w|0)==0&(b|0)==-2147483648)if(m){if(!(s[E>>2]|0)){w=0,b=0;break}s[A>>2]=(s[A>>2]|0)+-1,w=0,b=0;break}else return si(l,0),ue=0,g=f,+ue}else s[E>>2]|0?(s[A>>2]=(s[A>>2]|0)+-1,w=0,b=0):(w=0,b=0);while(!1);if(P=Ri(P|0,I|0,2)|0,P=tt(P|0,ae|0,-32,-1)|0,b=tt(P|0,ae|0,w|0,b|0)|0,P=ae,!R)return ue=+(S|0)*0,g=f,+ue;if((P|0)>0|(P|0)==0&b>>>0>(0-L|0)>>>0)return s[(Xe()|0)>>2]=34,ue=+(S|0)*17976931348623157e292*17976931348623157e292,g=f,+ue;if(me=L+-106|0,Se=((me|0)<0)<<31>>31,(P|0)<(Se|0)|(P|0)==(Se|0)&b>>>0<me>>>0)return s[(Xe()|0)>>2]=34,ue=+(S|0)*22250738585072014e-324*22250738585072014e-324,g=f,+ue;if((R|0)>-1)do R=R<<1,x>=.5?(Ee=x+-1,R=R|1):Ee=x,x=x+Ee,b=tt(b|0,P|0,-1,-1)|0,P=ae;while((R|0)>-1);return L=Ct(32,0,L|0,((L|0)<0)<<31>>31|0)|0,L=tt(b|0,P|0,L|0,ae|0)|0,me=ae,0>(me|0)|(me|0)==0&u>>>0>L>>>0?(L|0)<0?(u=0,I=126):(u=L,I=124):I=124,(I|0)==124&&((u|0)<53?I=126:(L=u,Ee=+(S|0),_e=0)),(I|0)==126&&(_e=+(S|0),L=u,Ee=_e,_e=+vn(+ +ks(1,84-u|0),+_e)),me=(L|0)<32&x!=0&(R&1|0)==0,x=Ee*(me?0:x)+(_e+Ee*+(((me&1)+R|0)>>>0))-_e,x==0&&(s[(Xe()|0)>>2]=34),ue=+Yn(x,b),g=f,+ue}while(!1);for(w=L+u|0,P=0-w|0,Ce=0;;){if((U|0)==46){I=137;break}else if((U|0)!=48){ne=0,Te=0,de=0;break}if(C=s[A>>2]|0,C>>>0<(s[E>>2]|0)>>>0){s[A>>2]=C+1,U=a[C>>0]|0,Ce=1;continue}else{U=ot(l)|0,Ce=1;continue}}if((I|0)==137)if(I=s[A>>2]|0,I>>>0<(s[E>>2]|0)>>>0?(s[A>>2]=I+1,U=a[I>>0]|0):U=ot(l)|0,(U|0)==48){ne=0,Te=0;do ne=tt(ne|0,Te|0,-1,-1)|0,Te=ae,I=s[A>>2]|0,I>>>0<(s[E>>2]|0)>>>0?(s[A>>2]=I+1,U=a[I>>0]|0):U=ot(l)|0;while((U|0)==48);Ce=1,de=1}else ne=0,Te=0,de=1;s[b>>2]=0,te=U+-48|0,Se=(U|0)==46;e:do if(te>>>0<10|Se){I=b+496|0,Q=0,Y=0,R=0,B=0,C=0;t:for(;;){do if(Se)if(!de)ne=Q,Te=Y,de=1;else break t;else{if(Se=tt(Q|0,Y|0,1,0)|0,Y=ae,me=(U|0)!=48,(B|0)>=125){if(!me){Q=Se;break}s[I>>2]=s[I>>2]|1,Q=Se;break}Q=b+(B<<2)|0,R&&(te=U+-48+((s[Q>>2]|0)*10|0)|0),s[Q>>2]=te,R=R+1|0,te=(R|0)==9,Q=Se,Ce=1,R=te?0:R,B=(te&1)+B|0,C=me?Se:C}while(!1);if(U=s[A>>2]|0,U>>>0<(s[E>>2]|0)>>>0?(s[A>>2]=U+1,U=a[U>>0]|0):U=ot(l)|0,te=U+-48|0,Se=(U|0)==46,!(te>>>0<10|Se)){I=160;break e}}te=(Ce|0)!=0,I=168}else Q=0,Y=0,R=0,B=0,C=0,I=160;while(!1);do if((I|0)==160){if(te=(de|0)==0,ne=te?Q:ne,Te=te?Y:Te,te=(Ce|0)!=0,!(te&(U|32|0)==101))if((U|0)>-1){I=168;break}else{I=170;break}te=Xn(l,m)|0,U=ae;do if((te|0)==0&(U|0)==-2147483648)if(m){if(!(s[E>>2]|0)){te=0,U=0;break}s[A>>2]=(s[A>>2]|0)+-1,te=0,U=0;break}else return si(l,0),ue=0,g=f,+ue;while(!1);l=tt(te|0,U|0,ne|0,Te|0)|0,Te=ae}while(!1);if((I|0)==168&&(s[E>>2]|0?(s[A>>2]=(s[A>>2]|0)+-1,te?l=ne:I=171):I=170),(I|0)==170&&(te?l=ne:I=171),(I|0)==171)return s[(Xe()|0)>>2]=22,si(l,0),ue=0,g=f,+ue;if(A=s[b>>2]|0,!A)return ue=+(S|0)*0,g=f,+ue;if((l|0)==(Q|0)&(Te|0)==(Y|0)&((Y|0)<0|(Y|0)==0&Q>>>0<10)&&u>>>0>30|(A>>>u|0)==0)return ue=+(S|0)*+(A>>>0),g=f,+ue;if(me=(L|0)/-2|0,Se=((me|0)<0)<<31>>31,(Te|0)>(Se|0)|(Te|0)==(Se|0)&l>>>0>me>>>0)return s[(Xe()|0)>>2]=34,ue=+(S|0)*17976931348623157e292*17976931348623157e292,g=f,+ue;if(me=L+-106|0,Se=((me|0)<0)<<31>>31,(Te|0)<(Se|0)|(Te|0)==(Se|0)&l>>>0<me>>>0)return s[(Xe()|0)>>2]=34,ue=+(S|0)*22250738585072014e-324*22250738585072014e-324,g=f,+ue;if(R){if((R|0)<9){A=b+(B<<2)|0,E=s[A>>2]|0;do E=E*10|0,R=R+1|0;while((R|0)!=9);s[A>>2]=E}B=B+1|0}if((C|0)<9&&(C|0)<=(l|0)&(l|0)<18){if((l|0)==9)return ue=+(S|0)*+((s[b>>2]|0)>>>0),g=f,+ue;if((l|0)<9)return ue=+(S|0)*+((s[b>>2]|0)>>>0)/+(s[5632+(8-l<<2)>>2]|0),g=f,+ue;if(me=u+27+(H(l,-3)|0)|0,A=s[b>>2]|0,(me|0)>30|(A>>>me|0)==0)return ue=+(S|0)*+(A>>>0)*+(s[5632+(l+-10<<2)>>2]|0),g=f,+ue}if(A=(l|0)%9|0,!A)A=0,E=0;else{if(m=(l|0)>-1?A:A+9|0,I=s[5632+(8-m<<2)>>2]|0,B){C=1e9/(I|0)|0,A=0,E=0,R=0;do ne=b+(R<<2)|0,Se=s[ne>>2]|0,me=((Se>>>0)/(I>>>0)|0)+E|0,s[ne>>2]=me,E=H((Se>>>0)%(I>>>0)|0,C)|0,Se=R,R=R+1|0,(Se|0)==(A|0)&(me|0)==0&&(A=R&127,l=l+-9|0);while((R|0)!=(B|0));E&&(s[b+(B<<2)>>2]=E,B=B+1|0)}else A=0,B=0;E=0,l=9-m+l|0}e:for(;;){if(m=b+(A<<2)|0,(l|0)<18)do{for(C=0,m=B+127|0;m=m&127,I=b+(m<<2)|0,R=Ri(s[I>>2]|0,0,29)|0,R=tt(R|0,ae|0,C|0,0)|0,C=ae,C>>>0>0|(C|0)==0&R>>>0>1e9?(me=dn(R|0,C|0,1e9,0)|0,R=er(R|0,C|0,1e9,0)|0,C=me):C=0,s[I>>2]=R,I=(m|0)==(A|0),(m|0)!=(B+127&127|0)|I||(B=R|0?B:m),!I;)m=m+-1|0;E=E+-29|0}while(!(C|0));else{if((l|0)!=18)break;do{if((s[m>>2]|0)>>>0>=9007199){l=18;break e}for(C=0,I=B+127|0;I=I&127,R=b+(I<<2)|0,U=Ri(s[R>>2]|0,0,29)|0,U=tt(U|0,ae|0,C|0,0)|0,C=ae,C>>>0>0|(C|0)==0&U>>>0>1e9?(me=dn(U|0,C|0,1e9,0)|0,U=er(U|0,C|0,1e9,0)|0,C=me):C=0,s[R>>2]=U,R=(I|0)==(A|0),(I|0)!=(B+127&127|0)|R||(B=U|0?B:I),!R;)I=I+-1|0;E=E+-29|0}while(!(C|0))}A=A+127&127,(A|0)==(B|0)&&(me=B+127&127,B=b+((B+126&127)<<2)|0,s[B>>2]=s[B>>2]|s[b+(me<<2)>>2],B=me),s[b+(A<<2)>>2]=C,l=l+9|0}e:for(;;){for(m=B+1&127,I=b+((B+127&127)<<2)|0;;){for(R=(l|0)==18,C=(l|0)>27?9:1;;){for(U=0;;){if(Y=U+A&127,(Y|0)==(B|0)){U=2;break}if(Q=s[b+(Y<<2)>>2]|0,te=s[5624+(U<<2)>>2]|0,Q>>>0<te>>>0){U=2;break}if(Y=U+1|0,Q>>>0>te>>>0)break;if((Y|0)<2)U=Y;else{U=Y;break}}if((U|0)==2&R)break e;if(E=C+E|0,(A|0)==(B|0))A=B;else break}R=(1<<C)+-1|0,U=1e9>>>C,Y=A,Q=0;do ne=b+(A<<2)|0,Se=s[ne>>2]|0,me=(Se>>>C)+Q|0,s[ne>>2]=me,Q=H(Se&R,U)|0,me=(A|0)==(Y|0)&(me|0)==0,A=A+1&127,l=me?l+-9|0:l,Y=me?A:Y;while((A|0)!=(B|0));if(!Q){A=Y;continue}if((m|0)!=(Y|0))break;s[I>>2]=s[I>>2]|1,A=Y}s[b+(B<<2)>>2]=Q,A=Y,B=m}l=A&127,(l|0)==(B|0)&&(s[b+(m+-1<<2)>>2]=0,B=m),Ee=+((s[b+(l<<2)>>2]|0)>>>0),l=A+1&127,(l|0)==(B|0)&&(B=B+1&127,s[b+(B+-1<<2)>>2]=0),x=+(S|0),_e=x*(Ee*1e9+ +((s[b+(l<<2)>>2]|0)>>>0)),S=E+53|0,L=S-L|0,(L|0)<(u|0)?(L|0)<0?(u=0,l=1,I=244):(u=L,l=1,I=243):(l=0,I=243),(I|0)==243&&((u|0)<53?I=244:(Ee=0,ue=0)),(I|0)==244&&(ge=+vn(+ +ks(1,105-u|0),+_e),be=+Pn(+_e,+ +ks(1,53-u|0)),Ee=ge,ue=be,_e=ge+(_e-be)),m=A+2&127;do if((m|0)!=(B|0)){b=s[b+(m<<2)>>2]|0;do if(b>>>0>=5e8){if(b>>>0>5e8){ue=x*.75+ue;break}if((A+3&127|0)==(B|0)){ue=x*.5+ue;break}else{ue=x*.75+ue;break}}else{if(!(b|0)&&(A+3&127|0)==(B|0))break;ue=x*.25+ue}while(!1);if((53-u|0)<=1||+Pn(+ue,1)!=0)break;ue=ue+1}while(!1);x=_e+ue-Ee;do if((S&2147483647|0)>(-2-w|0)){if(+vt(+x)>=9007199254740992&&(l=(l|0)!=0&(u|0)==(L|0)?0:l,E=E+1|0,x=x*.5),(E+50|0)<=(P|0)&&!((l|0)!=0&ue!=0))break;s[(Xe()|0)>>2]=34}while(!1);return ge=+Yn(x,E),g=f,+ge}}while(!1);if((I|0)==23&&(u=(s[E>>2]|0)==0,u||(s[A>>2]=(s[A>>2]|0)+-1),!(C>>>0<4|(m|0)==0|u)))do s[A>>2]=(s[A>>2]|0)+-1,C=C+-1|0;while(C>>>0>3);return ge=+(S|0)*J,g=f,+ge}function si(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0;if(m=g,s[l+104>>2]=u,S=s[l+8>>2]|0,f=s[l+4>>2]|0,L=S-f|0,s[l+108>>2]=L,(u|0)!=0&(L|0)>(u|0)){s[l+100>>2]=f+u,g=m;return}else{s[l+100>>2]=S,g=m;return}}function ot(l){l=l|0;var u=0,m=0,f=0,S=0,L=0,b=0,P=0;return m=g,L=l+104|0,P=s[L>>2]|0,P|0&&(s[l+108>>2]|0)>=(P|0)||(b=3),(b|0)==3&&(u=oa(l)|0,(u|0)>=0)?(b=s[L>>2]|0,L=s[l+8>>2]|0,b|0&&(f=s[l+4>>2]|0,S=b-(s[l+108>>2]|0)+-1|0,(L-f|0)>(S|0))?s[l+100>>2]=f+S:s[l+100>>2]=L,f=s[l+4>>2]|0,L&&(P=l+108|0,s[P>>2]=L+1-f+(s[P>>2]|0)),l=f+-1|0,(a[l>>0]|0|0)==(u|0)?(P=u,g=m,P|0):(n[l>>0]=u,P=u,g=m,P|0)):(s[l+100>>2]=0,P=-1,g=m,P|0)}function ks(l,u){l=+l,u=u|0;var m=0,f=0;return m=g,(u|0)>1023?(l=l*898846567431158e293,f=u+-1023|0,(f|0)>1023?(u=u+-2046|0,u=(u|0)>1023?1023:u,l=l*898846567431158e293):u=f):(u|0)<-1022&&(l=l*22250738585072014e-324,f=u+1022|0,(f|0)<-1022?(u=u+2044|0,u=(u|0)<-1022?-1022:u,l=l*22250738585072014e-324):u=f),u=Ri(u+1023|0,0,52)|0,f=ae,s[O>>2]=u,s[O+4>>2]=f,l=l*+y[O>>3],g=m,+l}function Yn(l,u){l=+l,u=u|0;var m=0;return m=g,l=+ks(l,u),g=m,+l}function ra(l){l=l|0;var u=0,m=0,f=0;return m=g,f=l+74|0,u=n[f>>0]|0,n[f>>0]=u+255|u,f=l+20|0,u=l+44|0,(s[f>>2]|0)>>>0>(s[u>>2]|0)>>>0&&Ji[s[l+36>>2]&1](l,0,0)|0,s[l+16>>2]=0,s[l+28>>2]=0,s[f>>2]=0,f=s[l>>2]|0,f&20?f&4?(s[l>>2]=f|32,f=-1,g=m,f|0):(f=-1,g=m,f|0):(f=s[u>>2]|0,s[l+8>>2]=f,s[l+4>>2]=f,f=0,g=m,f|0)}function oa(l){l=l|0;var u=0,m=0;return u=g,g=g+16|0,m=u,!(s[l+8>>2]|0)&&ra(l)|0?l=-1:(Ji[s[l+32>>2]&1](l,m,1)|0)==1?l=a[m>>0]|0:l=-1,g=u,l|0}function aa(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0;m=g,g=g+112|0,f=m,b=f+0|0,L=b+112|0;do s[b>>2]=0,b=b+4|0;while((b|0)<(L|0));return L=f+4|0,s[L>>2]=l,b=f+8|0,s[b>>2]=-1,s[f+44>>2]=l,s[f+76>>2]=-1,si(f,0),S=+na(f,1,1),f=(s[L>>2]|0)-(s[b>>2]|0)+(s[f+108>>2]|0)|0,u?(f&&(l=l+f|0),s[u>>2]=l,g=m,+S):(g=m,+S)}function la(l,u,m){l=l|0,u=u|0,m=m|0;var f=0,S=0,L=0;return f=g,g=g+112|0,L=f,s[L>>2]=0,S=L+4|0,s[S>>2]=l,s[L+44>>2]=l,(l|0)<0?s[L+8>>2]=-1:s[L+8>>2]=l+2147483647,s[L+76>>2]=-1,si(L,0),m=sa(L,m,1,-2147483648,0)|0,u?(s[u>>2]=l+((s[S>>2]|0)+(s[L+108>>2]|0)-(s[L+8>>2]|0)),g=f,m|0):(g=f,m|0)}function ha(l,u){l=l|0,u=u|0;var m=0,f=0,S=0;if(m=g,S=n[l>>0]|0,f=n[u>>0]|0,!(S<<24>>24)||S<<24>>24!=f<<24>>24)u=S;else{do l=l+1|0,u=u+1|0,S=n[l>>0]|0,f=n[u>>0]|0;while(!(!(S<<24>>24)||S<<24>>24!=f<<24>>24));u=S}return g=m,(u&255)-(f&255)|0}function ca(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0,B=0,R=0;if(m=g,S=l+4|0,f=s[S>>2]|0,A=f&-8,P=l+A|0,E=s[1210]|0,b=f&3,(b|0)!=1&l>>>0>=E>>>0&l>>>0<P>>>0||ye(),L=l+(A|4)|0,C=s[L>>2]|0,C&1||ye(),!b)return u>>>0<256?(R=0,g=m,R|0):A>>>0>=(u+4|0)>>>0&&(A-u|0)>>>0<=s[1326]<<1>>>0?(R=l,g=m,R|0):(R=0,g=m,R|0);if(A>>>0>=u>>>0)return b=A-u|0,b>>>0<=15?(R=l,g=m,R|0):(s[S>>2]=f&1|u|2,s[l+(u+4)>>2]=b|3,s[L>>2]=s[L>>2]|1,Kn(l+u|0,b),R=l,g=m,R|0);if((P|0)==(s[1212]|0))return L=(s[1209]|0)+A|0,L>>>0<=u>>>0?(R=0,g=m,R|0):(R=L-u|0,s[S>>2]=f&1|u|2,s[l+(u+4)>>2]=R|1,s[1212]=l+u,s[1209]=R,R=l,g=m,R|0);if((P|0)==(s[1211]|0))return b=(s[1208]|0)+A|0,b>>>0<u>>>0?(R=0,g=m,R|0):(L=b-u|0,L>>>0>15?(s[S>>2]=f&1|u|2,s[l+(u+4)>>2]=L|1,s[l+b>>2]=L,f=l+(b+4)|0,s[f>>2]=s[f>>2]&-2,f=l+u|0):(s[S>>2]=f&1|b|2,f=l+(b+4)|0,s[f>>2]=s[f>>2]|1,f=0,L=0),s[1208]=L,s[1211]=f,R=l,g=m,R|0);if(C&2||(L=(C&-8)+A|0,L>>>0<u>>>0))return R=0,g=m,R|0;b=L-u|0,x=C>>>3;do if(C>>>0>=256){I=s[l+(A+24)>>2]|0,x=s[l+(A+12)>>2]|0;do if((x|0)==(P|0)){if(C=l+(A+20)|0,x=s[C>>2]|0,!x&&(C=l+(A+16)|0,x=s[C>>2]|0,!x)){w=0;break}for(;;){if(R=x+20|0,B=s[R>>2]|0,B){x=B,C=R;continue}if(B=x+16|0,R=s[B>>2]|0,R)x=R,C=B;else break}if(C>>>0<E>>>0)ye();else{s[C>>2]=0,w=x;break}}else if(C=s[l+(A+8)>>2]|0,C>>>0<E>>>0&&ye(),E=C+12|0,(s[E>>2]|0)!=(P|0)&&ye(),B=x+8|0,(s[B>>2]|0)==(P|0)){s[E>>2]=x,s[B>>2]=C,w=x;break}else ye();while(!1);if(I){if(E=s[l+(A+28)>>2]|0,x=5128+(E<<2)|0,(P|0)==(s[x>>2]|0)){if(s[x>>2]=w,!w){s[1207]=s[1207]&~(1<<E);break}}else if(I>>>0<(s[1210]|0)>>>0&&ye(),E=I+16|0,(s[E>>2]|0)==(P|0)?s[E>>2]=w:s[I+20>>2]=w,!w)break;P=s[1210]|0,w>>>0<P>>>0&&ye(),s[w+24>>2]=I,E=s[l+(A+16)>>2]|0;do if(E)if(E>>>0<P>>>0)ye();else{s[w+16>>2]=E,s[E+24>>2]=w;break}while(!1);if(P=s[l+(A+20)>>2]|0,P)if(P>>>0<(s[1210]|0)>>>0)ye();else{s[w+20>>2]=P,s[P+24>>2]=w;break}}}else{if(w=s[l+(A+8)>>2]|0,A=s[l+(A+12)>>2]|0,C=4864+(x<<1<<2)|0,(w|0)!=(C|0)&&(w>>>0<E>>>0&&ye(),(s[w+12>>2]|0)!=(P|0)&&ye()),(A|0)==(w|0)){s[1206]=s[1206]&~(1<<x);break}(A|0)!=(C|0)?(A>>>0<E>>>0&&ye(),E=A+8|0,(s[E>>2]|0)==(P|0)?I=E:ye()):I=A+8|0,s[w+12>>2]=A,s[I>>2]=w}while(!1);return b>>>0<16?(s[S>>2]=L|f&1|2,R=l+(L|4)|0,s[R>>2]=s[R>>2]|1,R=l,g=m,R|0):(s[S>>2]=f&1|u|2,s[l+(u+4)>>2]=b|3,R=l+(L|4)|0,s[R>>2]=s[R>>2]|1,Kn(l+u|0,b),R=l,g=m,R|0)}function Kn(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0,B=0,R=0,U=0,Y=0,Q=0,te=0;m=g,b=l+u|0,A=s[l+4>>2]|0;do if(A&1)f=l,I=u;else{if(C=s[l>>2]|0,!(A&3)){g=m;return}if(A=l+(0-C)|0,E=C+u|0,R=s[1210]|0,A>>>0<R>>>0&&ye(),(A|0)==(s[1211]|0)){if(f=l+(u+4)|0,I=s[f>>2]|0,(I&3|0)!=3){f=A,I=E;break}s[1208]=E,s[f>>2]=I&-2,s[l+(4-C)>>2]=E|1,s[b>>2]=E,g=m;return}if(U=C>>>3,C>>>0<256){if(f=s[l+(8-C)>>2]|0,I=s[l+(12-C)>>2]|0,x=4864+(U<<1<<2)|0,(f|0)!=(x|0)&&(f>>>0<R>>>0&&ye(),(s[f+12>>2]|0)!=(A|0)&&ye()),(I|0)==(f|0)){s[1206]=s[1206]&~(1<<U),f=A,I=E;break}(I|0)!=(x|0)?(I>>>0<R>>>0&&ye(),x=I+8|0,(s[x>>2]|0)==(A|0)?B=x:ye()):B=I+8|0,s[f+12>>2]=I,s[B>>2]=f,f=A,I=E;break}B=s[l+(24-C)>>2]|0,U=s[l+(12-C)>>2]|0;do if((U|0)==(A|0)){if(Q=16-C|0,Y=l+(Q+4)|0,U=s[Y>>2]|0,!U&&(Y=l+Q|0,U=s[Y>>2]|0,!U)){x=0;break}for(;;){if(te=U+20|0,Q=s[te>>2]|0,Q){U=Q,Y=te;continue}if(Q=U+16|0,te=s[Q>>2]|0,te)U=te,Y=Q;else break}if(Y>>>0<R>>>0)ye();else{s[Y>>2]=0,x=U;break}}else if(Y=s[l+(8-C)>>2]|0,Y>>>0<R>>>0&&ye(),R=Y+12|0,(s[R>>2]|0)!=(A|0)&&ye(),Q=U+8|0,(s[Q>>2]|0)==(A|0)){s[R>>2]=U,s[Q>>2]=Y,x=U;break}else ye();while(!1);if(B){if(U=s[l+(28-C)>>2]|0,R=5128+(U<<2)|0,(A|0)==(s[R>>2]|0)){if(s[R>>2]=x,!x){s[1207]=s[1207]&~(1<<U),f=A,I=E;break}}else if(B>>>0<(s[1210]|0)>>>0&&ye(),R=B+16|0,(s[R>>2]|0)==(A|0)?s[R>>2]=x:s[B+20>>2]=x,!x){f=A,I=E;break}R=s[1210]|0,x>>>0<R>>>0&&ye(),s[x+24>>2]=B,C=16-C|0,B=s[l+C>>2]|0;do if(B)if(B>>>0<R>>>0)ye();else{s[x+16>>2]=B,s[B+24>>2]=x;break}while(!1);if(C=s[l+(C+4)>>2]|0,C)if(C>>>0<(s[1210]|0)>>>0)ye();else{s[x+20>>2]=C,s[C+24>>2]=x,f=A,I=E;break}else f=A,I=E}else f=A,I=E}while(!1);if(A=s[1210]|0,b>>>0<A>>>0&&ye(),E=l+(u+4)|0,x=s[E>>2]|0,x&2)s[E>>2]=x&-2,s[f+4>>2]=I|1,s[f+I>>2]=I;else{if((b|0)==(s[1212]|0)){if(te=(s[1209]|0)+I|0,s[1209]=te,s[1212]=f,s[f+4>>2]=te|1,(f|0)!=(s[1211]|0)){g=m;return}s[1211]=0,s[1208]=0,g=m;return}if((b|0)==(s[1211]|0)){te=(s[1208]|0)+I|0,s[1208]=te,s[1211]=f,s[f+4>>2]=te|1,s[f+te>>2]=te,g=m;return}I=(x&-8)+I|0,E=x>>>3;do if(x>>>0>=256){w=s[l+(u+24)>>2]|0,x=s[l+(u+12)>>2]|0;do if((x|0)==(b|0)){if(x=l+(u+20)|0,E=s[x>>2]|0,!E&&(x=l+(u+16)|0,E=s[x>>2]|0,!E)){P=0;break}for(;;){if(C=E+20|0,B=s[C>>2]|0,B){E=B,x=C;continue}if(B=E+16|0,C=s[B>>2]|0,C)E=C,x=B;else break}if(x>>>0<A>>>0)ye();else{s[x>>2]=0,P=E;break}}else if(E=s[l+(u+8)>>2]|0,E>>>0<A>>>0&&ye(),C=E+12|0,(s[C>>2]|0)!=(b|0)&&ye(),A=x+8|0,(s[A>>2]|0)==(b|0)){s[C>>2]=x,s[A>>2]=E,P=x;break}else ye();while(!1);if(w){if(E=s[l+(u+28)>>2]|0,A=5128+(E<<2)|0,(b|0)==(s[A>>2]|0)){if(s[A>>2]=P,!P){s[1207]=s[1207]&~(1<<E);break}}else if(w>>>0<(s[1210]|0)>>>0&&ye(),A=w+16|0,(s[A>>2]|0)==(b|0)?s[A>>2]=P:s[w+20>>2]=P,!P)break;b=s[1210]|0,P>>>0<b>>>0&&ye(),s[P+24>>2]=w,w=s[l+(u+16)>>2]|0;do if(w)if(w>>>0<b>>>0)ye();else{s[P+16>>2]=w,s[w+24>>2]=P;break}while(!1);if(b=s[l+(u+20)>>2]|0,b)if(b>>>0<(s[1210]|0)>>>0)ye();else{s[P+20>>2]=b,s[b+24>>2]=P;break}}}else{if(P=s[l+(u+8)>>2]|0,l=s[l+(u+12)>>2]|0,u=4864+(E<<1<<2)|0,(P|0)!=(u|0)&&(P>>>0<A>>>0&&ye(),(s[P+12>>2]|0)!=(b|0)&&ye()),(l|0)==(P|0)){s[1206]=s[1206]&~(1<<E);break}(l|0)!=(u|0)?(l>>>0<A>>>0&&ye(),u=l+8|0,(s[u>>2]|0)==(b|0)?w=u:ye()):w=l+8|0,s[P+12>>2]=l,s[w>>2]=P}while(!1);if(s[f+4>>2]=I|1,s[f+I>>2]=I,(f|0)==(s[1211]|0)){s[1208]=I,g=m;return}}if(u=I>>>3,I>>>0<256){l=u<<1,b=4864+(l<<2)|0,P=s[1206]|0,u=1<<u,P&u?(l=4864+(l+2<<2)|0,P=s[l>>2]|0,P>>>0<(s[1210]|0)>>>0?ye():(L=l,S=P)):(s[1206]=P|u,L=4864+(l+2<<2)|0,S=b),s[L>>2]=f,s[S+12>>2]=f,s[f+8>>2]=S,s[f+12>>2]=b,g=m;return}if(S=I>>>8,S?I>>>0>16777215?S=31:(Q=(S+1048320|0)>>>16&8,te=S<<Q,Y=(te+520192|0)>>>16&4,te=te<<Y,S=(te+245760|0)>>>16&2,S=14-(Y|Q|S)+(te<<S>>>15)|0,S=I>>>(S+7|0)&1|S<<1):S=0,L=5128+(S<<2)|0,s[f+28>>2]=S,s[f+20>>2]=0,s[f+16>>2]=0,l=s[1207]|0,b=1<<S,!(l&b)){s[1207]=l|b,s[L>>2]=f,s[f+24>>2]=L,s[f+12>>2]=f,s[f+8>>2]=f,g=m;return}L=s[L>>2]|0,(S|0)==31?S=0:S=25-(S>>>1)|0;e:do if((s[L+4>>2]&-8|0)!=(I|0)){for(S=I<<S,l=L;b=l+(S>>>31<<2)+16|0,L=s[b>>2]|0,!!L;){if((s[L+4>>2]&-8|0)==(I|0))break e;S=S<<1,l=L}b>>>0<(s[1210]|0)>>>0&&ye(),s[b>>2]=f,s[f+24>>2]=l,s[f+12>>2]=f,s[f+8>>2]=f,g=m;return}while(!1);S=L+8|0,b=s[S>>2]|0,te=s[1210]|0,L>>>0>=te>>>0&b>>>0>=te>>>0||ye(),s[b+12>>2]=f,s[S>>2]=f,s[f+8>>2]=b,s[f+12>>2]=L,s[f+24>>2]=0,g=m}function Xn(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0,b=0,P=0;if(m=g,S=l+4|0,L=s[S>>2]|0,f=l+100|0,L>>>0<(s[f>>2]|0)>>>0?(s[S>>2]=L+1,b=a[L>>0]|0):b=ot(l)|0,(b|0)==43|(b|0)==45?(P=s[S>>2]|0,L=(b|0)==45&1,P>>>0<(s[f>>2]|0)>>>0?(s[S>>2]=P+1,b=a[P>>0]|0):b=ot(l)|0,(b+-48|0)>>>0>9&(u|0)!=0&&s[f>>2]|0&&(s[S>>2]=(s[S>>2]|0)+-1)):L=0,(b+-48|0)>>>0>9)return s[f>>2]|0?(s[S>>2]=(s[S>>2]|0)+-1,b=-2147483648,P=0,ae=b,g=m,P|0):(b=-2147483648,P=0,ae=b,g=m,P|0);u=0;do u=b+-48+(u*10|0)|0,b=s[S>>2]|0,b>>>0<(s[f>>2]|0)>>>0?(s[S>>2]=b+1,b=a[b>>0]|0):b=ot(l)|0;while((b+-48|0)>>>0<10&(u|0)<214748364);if(P=((u|0)<0)<<31>>31,(b+-48|0)>>>0<10)do P=ei(u|0,P|0,10,0)|0,u=ae,b=tt(b|0,((b|0)<0)<<31>>31|0,-48,-1)|0,u=tt(b|0,ae|0,P|0,u|0)|0,P=ae,b=s[S>>2]|0,b>>>0<(s[f>>2]|0)>>>0?(s[S>>2]=b+1,b=a[b>>0]|0):b=ot(l)|0;while((b+-48|0)>>>0<10&((P|0)<21474836|(P|0)==21474836&u>>>0<2061584302));if((b+-48|0)>>>0<10)do b=s[S>>2]|0,b>>>0<(s[f>>2]|0)>>>0?(s[S>>2]=b+1,b=a[b>>0]|0):b=ot(l)|0;while((b+-48|0)>>>0<10);return s[f>>2]|0&&(s[S>>2]=(s[S>>2]|0)+-1),S=(L|0)!=0,L=Ct(0,0,u|0,P|0)|0,b=S?ae:P,P=S?L:u,ae=b,g=m,P|0}function da(){}function Ct(l,u,m,f){return l=l|0,u=u|0,m=m|0,f=f|0,u=u-f-(m>>>0>l>>>0|0)>>>0,ae=u,l-m>>>0|0|0}function Ms(l,u,m){l=l|0,u=u|0,m=m|0;var f=0,S=0,L=0,b=0;if(f=l+m|0,(m|0)>=20){if(u=u&255,b=l&3,L=u|u<<8|u<<16|u<<24,S=f&-4,b)for(b=l+4-b|0;(l|0)<(b|0);)n[l>>0]=u,l=l+1|0;for(;(l|0)<(S|0);)s[l>>2]=L,l=l+4|0}for(;(l|0)<(f|0);)n[l>>0]=u,l=l+1|0;return l-m|0}function Ri(l,u,m){return l=l|0,u=u|0,m=m|0,(m|0)<32?(ae=u<<m|(l&(1<<m)-1<<32-m)>>>32-m,l<<m):(ae=l<<m-32,0)}function jn(l){l=l|0;var u=0;for(u=l;n[u>>0]|0;)u=u+1|0;return u-l|0}function tt(l,u,m,f){return l=l|0,u=u|0,m=m|0,f=f|0,m=l+m>>>0,ae=u+f+(m>>>0<l>>>0|0)>>>0,m|0|0}function Qn(l,u,m){return l=l|0,u=u|0,m=m|0,(m|0)<32?(ae=u>>>m,l>>>m|(u&(1<<m)-1)<<32-m):(ae=0,u>>>m-32|0)}function Zn(l,u,m){l=l|0,u=u|0,m=m|0;var f=0;if((m|0)>=4096)return br(l|0,u|0,m|0)|0;if(f=l|0,(l&3)==(u&3)){for(;l&3;){if(!m)return f|0;n[l>>0]=n[u>>0]|0,l=l+1|0,u=u+1|0,m=m-1|0}for(;(m|0)>=4;)s[l>>2]=s[u>>2],l=l+4|0,u=u+4|0,m=m-4|0}for(;(m|0)>0;)n[l>>0]=n[u>>0]|0,l=l+1|0,u=u+1|0,m=m-1|0;return f|0}function Za(l,u,m){return l=l|0,u=u|0,m=m|0,(m|0)<32?(ae=u>>m,l>>>m|(u&(1<<m)-1)<<32-m):(ae=(u|0)<0?-1:0,u>>m-32|0)}function Ni(l){l=l|0;var u=0;return u=n[M+(l>>>24)>>0]|0,(u|0)<8?u|0:(u=n[M+(l>>16&255)>>0]|0,(u|0)<8?u+8|0:(u=n[M+(l>>8&255)>>0]|0,(u|0)<8?u+16|0:(n[M+(l&255)>>0]|0)+24|0))}function Jn(l){l=l|0;var u=0;return u=n[k+(l&255)>>0]|0,(u|0)<8?u|0:(u=n[k+(l>>8&255)>>0]|0,(u|0)<8?u+8|0:(u=n[k+(l>>16&255)>>0]|0,(u|0)<8?u+16|0:(n[k+(l>>>24)>>0]|0)+24|0))}function pa(l,u){l=l|0,u=u|0;var m=0,f=0,S=0,L=0;return L=l&65535,f=u&65535,m=H(f,L)|0,S=l>>>16,f=(m>>>16)+(H(f,S)|0)|0,u=u>>>16,l=H(u,L)|0,ae=(f>>>16)+(H(u,S)|0)+(((f&65535)+l|0)>>>16)|0,f+l<<16|m&65535|0|0}function Ja(l,u,m,f){l=l|0,u=u|0,m=m|0,f=f|0;var S=0,L=0,b=0,P=0,w=0,A=0;return A=u>>31|((u|0)<0?-1:0)<<1,w=((u|0)<0?-1:0)>>31|((u|0)<0?-1:0)<<1,L=f>>31|((f|0)<0?-1:0)<<1,S=((f|0)<0?-1:0)>>31|((f|0)<0?-1:0)<<1,P=Ct(A^l,w^u,A,w)|0,b=ae,u=L^A,l=S^w,l=Ct((Rs(P,b,Ct(L^m,S^f,L,S)|0,ae,0)|0)^u,ae^l,u,l)|0,l|0}function el(l,u,m,f){l=l|0,u=u|0,m=m|0,f=f|0;var S=0,L=0,b=0,P=0,w=0,A=0;return S=g,g=g+8|0,P=S|0,b=u>>31|((u|0)<0?-1:0)<<1,L=((u|0)<0?-1:0)>>31|((u|0)<0?-1:0)<<1,A=f>>31|((f|0)<0?-1:0)<<1,w=((f|0)<0?-1:0)>>31|((f|0)<0?-1:0)<<1,u=Ct(b^l,L^u,b,L)|0,l=ae,Rs(u,l,Ct(A^m,w^f,A,w)|0,ae,P)|0,l=Ct(s[P>>2]^b,s[P+4>>2]^L,b,L)|0,u=ae,g=S,ae=u,l|0}function ei(l,u,m,f){l=l|0,u=u|0,m=m|0,f=f|0;var S=0,L=0;return S=l,L=m,l=pa(S,L)|0,m=ae,ae=(H(u,L)|0)+(H(f,S)|0)+m|m&0,l|0|0|0}function dn(l,u,m,f){return l=l|0,u=u|0,m=m|0,f=f|0,l=Rs(l,u,m,f,0)|0,l|0}function er(l,u,m,f){l=l|0,u=u|0,m=m|0,f=f|0;var S=0,L=0;return L=g,g=g+8|0,S=L|0,Rs(l,u,m,f,S)|0,g=L,ae=s[S+4>>2]|0,s[S>>2]|0|0}function Rs(l,u,m,f,S){l=l|0,u=u|0,m=m|0,f=f|0,S=S|0;var L=0,b=0,P=0,w=0,A=0,E=0,I=0,x=0,C=0,B=0;if(b=l,w=u,P=w,E=m,L=f,A=L,!P)return L=(S|0)!=0,A?L?(s[S>>2]=l|0,s[S+4>>2]=u&0,E=0,I=0,ae=E,I|0):(E=0,I=0,ae=E,I|0):(L&&(s[S>>2]=(b>>>0)%(E>>>0),s[S+4>>2]=0),A=0,I=(b>>>0)/(E>>>0)>>>0,ae=A,I|0);I=(A|0)==0;do if(E){if(!I){if(A=(Ni(A|0)|0)-(Ni(P|0)|0)|0,A>>>0<=31){I=A+1|0,E=31-A|0,l=A-31>>31,w=I,u=b>>>(I>>>0)&l|P<<E,l=P>>>(I>>>0)&l,A=0,E=b<<E;break}return S?(s[S>>2]=l|0,s[S+4>>2]=w|u&0,E=0,I=0,ae=E,I|0):(E=0,I=0,ae=E,I|0)}if(A=E-1|0,A&E){E=(Ni(E|0)|0)+33-(Ni(P|0)|0)|0,B=64-E|0,I=32-E|0,x=I>>31,C=E-32|0,l=C>>31,w=E,u=I-1>>31&P>>>(C>>>0)|(P<<I|b>>>(E>>>0))&l,l=l&P>>>(E>>>0),A=b<<B&x,E=(P<<B|b>>>(C>>>0))&x|b<<I&E-33>>31;break}return S&&(s[S>>2]=A&b,s[S+4>>2]=0),(E|0)==1?(C=w|u&0,B=l|0|0,ae=C,B|0):(B=Jn(E|0)|0,C=P>>>(B>>>0)|0,B=P<<32-B|b>>>(B>>>0)|0,ae=C,B|0)}else{if(I)return S&&(s[S>>2]=(P>>>0)%(E>>>0),s[S+4>>2]=0),C=0,B=(P>>>0)/(E>>>0)>>>0,ae=C,B|0;if(!b)return S&&(s[S>>2]=0,s[S+4>>2]=(P>>>0)%(A>>>0)),C=0,B=(P>>>0)/(A>>>0)>>>0,ae=C,B|0;if(E=A-1|0,!(E&A))return S&&(s[S>>2]=l|0,s[S+4>>2]=E&P|u&0),C=0,B=P>>>((Jn(A|0)|0)>>>0),ae=C,B|0;if(A=(Ni(A|0)|0)-(Ni(P|0)|0)|0,A>>>0<=30){l=A+1|0,E=31-A|0,w=l,u=P<<E|b>>>(l>>>0),l=P>>>(l>>>0),A=0,E=b<<E;break}return S?(s[S>>2]=l|0,s[S+4>>2]=w|u&0,C=0,B=0,ae=C,B|0):(C=0,B=0,ae=C,B|0)}while(!1);if(!w)L=E,f=0,P=0;else{b=m|0|0,L=L|f&0,f=tt(b,L,-1,-1)|0,m=ae,P=0;do I=E,E=A>>>31|E<<1,A=P|A<<1,I=u<<1|I>>>31|0,x=u>>>31|l<<1|0,Ct(f,m,I,x)|0,B=ae,C=B>>31|((B|0)<0?-1:0)<<1,P=C&1,u=Ct(I,x,C&b,(((B|0)<0?-1:0)>>31|((B|0)<0?-1:0)<<1)&L)|0,l=ae,w=w-1|0;while(w|0);L=E,f=0}return b=0,S&&(s[S>>2]=u,s[S+4>>2]=l),C=(A|0)>>>31|(L|b)<<1|(b<<1|A>>>31)&0|f,B=(A<<1|0)&-2|P,ae=C,B|0}function ga(l,u,m,f){return l=l|0,u=u|0,m=m|0,f=f|0,Ji[l&1](u|0,m|0,f|0)|0}function fa(l,u,m,f,S,L){l=l|0,u=u|0,m=m|0,f=f|0,S=S|0,L=L|0,un[l&3](u|0,m|0,f|0,S|0,L|0)}function ma(l,u){l=l|0,u=u|0,wi[l&31](u|0)}function ya(l,u,m){l=l|0,u=u|0,m=m|0,Da[l&3](u|0,m|0)}function ba(l,u){return l=l|0,u=u|0,nr[l&1](u|0)|0}function Sa(l){l=l|0,pn[l&3]()}function La(l,u,m,f,S,L,b){l=l|0,u=u|0,m=m|0,f=f|0,S=S|0,L=L|0,b=b|0,Ns[l&3](u|0,m|0,f|0,S|0,L|0,b|0)}function Aa(l,u,m){return l=l|0,u=u|0,m=m|0,Ia[l&3](u|0,m|0)|0}function va(l,u,m,f,S){l=l|0,u=u|0,m=m|0,f=f|0,S=S|0,gn[l&3](u|0,m|0,f|0,S|0)}function Pa(l,u,m){return l=l|0,u=u|0,m=m|0,z(0),0}function tr(l,u,m,f,S){l=l|0,u=u|0,m=m|0,f=f|0,S=S|0,z(1)}function zt(l){l=l|0,z(2)}function _a(l,u){l=l|0,u=u|0,z(3)}function Ea(l){return l=l|0,z(4),0}function Ta(){z(5)}function wa(){Tr()}function ir(l,u,m,f,S,L){l=l|0,u=u|0,m=m|0,f=f|0,S=S|0,L=L|0,z(6)}function Ca(l,u){return l=l|0,u=u|0,z(7),0}function sr(l,u,m,f){l=l|0,u=u|0,m=m|0,f=f|0,z(8)}var Ji=[Pa,zo],un=[tr,Xo,Ko,tr],wi=[zt,Vr,kr,Rr,Fr,xs,$r,eo,io,On,ho,bo,Ro,Mo,qo,$o,Ho,Uo,Go,Mr,ia,zt,zt,zt,zt,zt,zt,zt,zt,zt,zt,zt],Da=[_a,Br,Hr,no],nr=[Ea,No],pn=[Ta,wa,ea,ta],Ns=[ir,Qo,jo,ir],Ia=[Ca,Nr,qr,so],gn=[sr,Wo,Yo,sr];return{_yo:Po,_strlen:jn,_retireVar:xo,_bitshift64Lshr:Qn,_unyo:_o,_solve:Co,_bitshift64Shl:Ri,_getSolution:Do,___cxa_is_pointer_type:Jo,_memset:Ms,_getNumVars:Io,_memcpy:Zn,_getConflictClauseSize:Vo,_addClause:wo,_i64Subtract:Ct,_createTheSolver:Eo,_realloc:ht,_i64Add:tt,_solveAssuming:Oo,___cxa_can_catch:Zo,_ensureVar:To,_getConflictClause:ko,_free:Me,_malloc:Zi,__GLOBAL__I_a:to,__GLOBAL__I_a127:So,runPostSets:da,stackAlloc:wr,stackSave:Cr,stackRestore:Dr,setThrew:Ir,setTempRet0:Or,getTempRet0:xr,dynCall_iiii:ga,dynCall_viiiii:fa,dynCall_vi:ma,dynCall_vii:ya,dynCall_ii:ba,dynCall_v:Sa,dynCall_viiiiii:La,dynCall_iii:Aa,dynCall_viiii:va}}(Module.asmGlobalArg,Module.asmLibraryArg,buffer);Module._yo=asm._yo;var _strlen=Module._strlen=asm._strlen;Module._retireVar=asm._retireVar;var _bitshift64Lshr=Module._bitshift64Lshr=asm._bitshift64Lshr;Module._unyo=asm._unyo,Module._solve=asm._solve;var _bitshift64Shl=Module._bitshift64Shl=asm._bitshift64Shl;Module._getSolution=asm._getSolution,Module.___cxa_is_pointer_type=asm.___cxa_is_pointer_type;var _memset=Module._memset=asm._memset;Module._getNumVars=asm._getNumVars;var _memcpy=Module._memcpy=asm._memcpy;Module._getConflictClauseSize=asm._getConflictClauseSize,Module._addClause=asm._addClause;var _i64Subtract=Module._i64Subtract=asm._i64Subtract;Module._createTheSolver=asm._createTheSolver,Module._realloc=asm._realloc;var _i64Add=Module._i64Add=asm._i64Add;Module._solveAssuming=asm._solveAssuming,Module.___cxa_can_catch=asm.___cxa_can_catch,Module._ensureVar=asm._ensureVar,Module._getConflictClause=asm._getConflictClause;var _free=Module._free=asm._free,_malloc=Module._malloc=asm._malloc,__GLOBAL__I_a=Module.__GLOBAL__I_a=asm.__GLOBAL__I_a,__GLOBAL__I_a127=Module.__GLOBAL__I_a127=asm.__GLOBAL__I_a127;Module.runPostSets=asm.runPostSets,Module.dynCall_iiii=asm.dynCall_iiii,Module.dynCall_viiiii=asm.dynCall_viiiii,Module.dynCall_vi=asm.dynCall_vi,Module.dynCall_vii=asm.dynCall_vii,Module.dynCall_ii=asm.dynCall_ii,Module.dynCall_v=asm.dynCall_v,Module.dynCall_viiiiii=asm.dynCall_viiiiii,Module.dynCall_iii=asm.dynCall_iii,Module.dynCall_viiii=asm.dynCall_viiii,Runtime.stackAlloc=asm.stackAlloc,Runtime.stackSave=asm.stackSave,Runtime.stackRestore=asm.stackRestore,Runtime.setTempRet0=asm.setTempRet0,Runtime.getTempRet0=asm.getTempRet0;var i64Math=function(){var o={math:{}};o.math.Long=function(q,H){this.low_=q|0,this.high_=H|0},o.math.Long.IntCache_={},o.math.Long.fromInt=function(q){if(-128<=q&&q<128){var H=o.math.Long.IntCache_[q];if(H)return H}var z=new o.math.Long(q|0,q<0?-1:0);return-128<=q&&q<128&&(o.math.Long.IntCache_[q]=z),z},o.math.Long.fromNumber=function(q){return isNaN(q)||!isFinite(q)?o.math.Long.ZERO:q<=-o.math.Long.TWO_PWR_63_DBL_?o.math.Long.MIN_VALUE:q+1>=o.math.Long.TWO_PWR_63_DBL_?o.math.Long.MAX_VALUE:q<0?o.math.Long.fromNumber(-q).negate():new o.math.Long(q%o.math.Long.TWO_PWR_32_DBL_|0,q/o.math.Long.TWO_PWR_32_DBL_|0)},o.math.Long.fromBits=function(q,H){return new o.math.Long(q,H)},o.math.Long.fromString=function(q,H){if(q.length==0)throw Error("number format error: empty string");var z=H||10;if(z<2||36<z)throw Error("radix out of range: "+z);if(q.charAt(0)=="-")return o.math.Long.fromString(q.substring(1),z).negate();if(q.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+q);for(var fe=o.math.Long.fromNumber(Math.pow(z,8)),we=o.math.Long.ZERO,Pe=0;Pe<q.length;Pe+=8){var ke=Math.min(8,q.length-Pe),$e=parseInt(q.substring(Pe,Pe+ke),z);if(ke<8){var lt=o.math.Long.fromNumber(Math.pow(z,ke));we=we.multiply(lt).add(o.math.Long.fromNumber($e))}else we=we.multiply(fe),we=we.add(o.math.Long.fromNumber($e))}return we},o.math.Long.TWO_PWR_16_DBL_=65536,o.math.Long.TWO_PWR_24_DBL_=1<<24,o.math.Long.TWO_PWR_32_DBL_=o.math.Long.TWO_PWR_16_DBL_*o.math.Long.TWO_PWR_16_DBL_,o.math.Long.TWO_PWR_31_DBL_=o.math.Long.TWO_PWR_32_DBL_/2,o.math.Long.TWO_PWR_48_DBL_=o.math.Long.TWO_PWR_32_DBL_*o.math.Long.TWO_PWR_16_DBL_,o.math.Long.TWO_PWR_64_DBL_=o.math.Long.TWO_PWR_32_DBL_*o.math.Long.TWO_PWR_32_DBL_,o.math.Long.TWO_PWR_63_DBL_=o.math.Long.TWO_PWR_64_DBL_/2,o.math.Long.ZERO=o.math.Long.fromInt(0),o.math.Long.ONE=o.math.Long.fromInt(1),o.math.Long.NEG_ONE=o.math.Long.fromInt(-1),o.math.Long.MAX_VALUE=o.math.Long.fromBits(-1,2147483647),o.math.Long.MIN_VALUE=o.math.Long.fromBits(0,-2147483648),o.math.Long.TWO_PWR_24_=o.math.Long.fromInt(1<<24),o.math.Long.prototype.toInt=function(){return this.low_},o.math.Long.prototype.toNumber=function(){return this.high_*o.math.Long.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},o.math.Long.prototype.toString=function(q){var H=q||10;if(H<2||36<H)throw Error("radix out of range: "+H);if(this.isZero())return"0";if(this.isNegative())if(this.equals(o.math.Long.MIN_VALUE)){var z=o.math.Long.fromNumber(H),fe=this.div(z),Pe=fe.multiply(z).subtract(this);return fe.toString(H)+Pe.toInt().toString(H)}else return"-"+this.negate().toString(H);for(var we=o.math.Long.fromNumber(Math.pow(H,6)),Pe=this,ke="";;){var $e=Pe.div(we),lt=Pe.subtract($e.multiply(we)).toInt(),et=lt.toString(H);if(Pe=$e,Pe.isZero())return et+ke;for(;et.length<6;)et="0"+et;ke=""+et+ke}},o.math.Long.prototype.getHighBits=function(){return this.high_},o.math.Long.prototype.getLowBits=function(){return this.low_},o.math.Long.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:o.math.Long.TWO_PWR_32_DBL_+this.low_},o.math.Long.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(o.math.Long.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var q=this.high_!=0?this.high_:this.low_,H=31;H>0&&!(q&1<<H);H--);return this.high_!=0?H+33:H+1},o.math.Long.prototype.isZero=function(){return this.high_==0&&this.low_==0},o.math.Long.prototype.isNegative=function(){return this.high_<0},o.math.Long.prototype.isOdd=function(){return(this.low_&1)==1},o.math.Long.prototype.equals=function(q){return this.high_==q.high_&&this.low_==q.low_},o.math.Long.prototype.notEquals=function(q){return this.high_!=q.high_||this.low_!=q.low_},o.math.Long.prototype.lessThan=function(q){return this.compare(q)<0},o.math.Long.prototype.lessThanOrEqual=function(q){return this.compare(q)<=0},o.math.Long.prototype.greaterThan=function(q){return this.compare(q)>0},o.math.Long.prototype.greaterThanOrEqual=function(q){return this.compare(q)>=0},o.math.Long.prototype.compare=function(q){if(this.equals(q))return 0;var H=this.isNegative(),z=q.isNegative();return H&&!z?-1:!H&&z?1:this.subtract(q).isNegative()?-1:1},o.math.Long.prototype.negate=function(){return this.equals(o.math.Long.MIN_VALUE)?o.math.Long.MIN_VALUE:this.not().add(o.math.Long.ONE)},o.math.Long.prototype.add=function(q){var H=this.high_>>>16,z=this.high_&65535,fe=this.low_>>>16,we=this.low_&65535,Pe=q.high_>>>16,ke=q.high_&65535,$e=q.low_>>>16,lt=q.low_&65535,et=0,pt=0,St=0,Mt=0;return Mt+=we+lt,St+=Mt>>>16,Mt&=65535,St+=fe+$e,pt+=St>>>16,St&=65535,pt+=z+ke,et+=pt>>>16,pt&=65535,et+=H+Pe,et&=65535,o.math.Long.fromBits(St<<16|Mt,et<<16|pt)},o.math.Long.prototype.subtract=function(q){return this.add(q.negate())},o.math.Long.prototype.multiply=function(q){if(this.isZero())return o.math.Long.ZERO;if(q.isZero())return o.math.Long.ZERO;if(this.equals(o.math.Long.MIN_VALUE))return q.isOdd()?o.math.Long.MIN_VALUE:o.math.Long.ZERO;if(q.equals(o.math.Long.MIN_VALUE))return this.isOdd()?o.math.Long.MIN_VALUE:o.math.Long.ZERO;if(this.isNegative())return q.isNegative()?this.negate().multiply(q.negate()):this.negate().multiply(q).negate();if(q.isNegative())return this.multiply(q.negate()).negate();if(this.lessThan(o.math.Long.TWO_PWR_24_)&&q.lessThan(o.math.Long.TWO_PWR_24_))return o.math.Long.fromNumber(this.toNumber()*q.toNumber());var H=this.high_>>>16,z=this.high_&65535,fe=this.low_>>>16,we=this.low_&65535,Pe=q.high_>>>16,ke=q.high_&65535,$e=q.low_>>>16,lt=q.low_&65535,et=0,pt=0,St=0,Mt=0;return Mt+=we*lt,St+=Mt>>>16,Mt&=65535,St+=fe*lt,pt+=St>>>16,St&=65535,St+=we*$e,pt+=St>>>16,St&=65535,pt+=z*lt,et+=pt>>>16,pt&=65535,pt+=fe*$e,et+=pt>>>16,pt&=65535,pt+=we*ke,et+=pt>>>16,pt&=65535,et+=H*lt+z*$e+fe*ke+we*Pe,et&=65535,o.math.Long.fromBits(St<<16|Mt,et<<16|pt)},o.math.Long.prototype.div=function(q){if(q.isZero())throw Error("division by zero");if(this.isZero())return o.math.Long.ZERO;if(this.equals(o.math.Long.MIN_VALUE)){if(q.equals(o.math.Long.ONE)||q.equals(o.math.Long.NEG_ONE))return o.math.Long.MIN_VALUE;if(q.equals(o.math.Long.MIN_VALUE))return o.math.Long.ONE;var H=this.shiftRight(1),z=H.div(q).shiftLeft(1);if(z.equals(o.math.Long.ZERO))return q.isNegative()?o.math.Long.ONE:o.math.Long.NEG_ONE;var Pe=this.subtract(q.multiply(z)),fe=z.add(Pe.div(q));return fe}else if(q.equals(o.math.Long.MIN_VALUE))return o.math.Long.ZERO;if(this.isNegative())return q.isNegative()?this.negate().div(q.negate()):this.negate().div(q).negate();if(q.isNegative())return this.div(q.negate()).negate();for(var we=o.math.Long.ZERO,Pe=this;Pe.greaterThanOrEqual(q);){for(var z=Math.max(1,Math.floor(Pe.toNumber()/q.toNumber())),ke=Math.ceil(Math.log(z)/Math.LN2),$e=ke<=48?1:Math.pow(2,ke-48),lt=o.math.Long.fromNumber(z),et=lt.multiply(q);et.isNegative()||et.greaterThan(Pe);)z-=$e,lt=o.math.Long.fromNumber(z),et=lt.multiply(q);lt.isZero()&&(lt=o.math.Long.ONE),we=we.add(lt),Pe=Pe.subtract(et)}return we},o.math.Long.prototype.modulo=function(q){return this.subtract(this.div(q).multiply(q))},o.math.Long.prototype.not=function(){return o.math.Long.fromBits(~this.low_,~this.high_)},o.math.Long.prototype.and=function(q){return o.math.Long.fromBits(this.low_&q.low_,this.high_&q.high_)},o.math.Long.prototype.or=function(q){return o.math.Long.fromBits(this.low_|q.low_,this.high_|q.high_)},o.math.Long.prototype.xor=function(q){return o.math.Long.fromBits(this.low_^q.low_,this.high_^q.high_)},o.math.Long.prototype.shiftLeft=function(q){if(q&=63,q==0)return this;var H=this.low_;if(q<32){var z=this.high_;return o.math.Long.fromBits(H<<q,z<<q|H>>>32-q)}else return o.math.Long.fromBits(0,H<<q-32)},o.math.Long.prototype.shiftRight=function(q){if(q&=63,q==0)return this;var H=this.high_;if(q<32){var z=this.low_;return o.math.Long.fromBits(z>>>q|H<<32-q,H>>q)}else return o.math.Long.fromBits(H>>q-32,H>=0?0:-1)},o.math.Long.prototype.shiftRightUnsigned=function(q){if(q&=63,q==0)return this;var H=this.high_;if(q<32){var z=this.low_;return o.math.Long.fromBits(z>>>q|H<<32-q,H>>>q)}else return q==32?o.math.Long.fromBits(H,0):o.math.Long.fromBits(H>>>q-32,0)};var e;function t(q,H,z){q!=null&&(typeof q=="number"?this.fromNumber(q,H,z):H==null&&typeof q!="string"?this.fromString(q,256):this.fromString(q,H))}function n(){return new t(null)}function r(q,H,z,fe,we,Pe){for(;--Pe>=0;){var ke=H*this[q++]+z[fe]+we;we=Math.floor(ke/67108864),z[fe++]=ke&67108863}return we}t.prototype.am=r,e=26,t.prototype.DB=e,t.prototype.DM=(1<<e)-1,t.prototype.DV=1<<e;var s=52;t.prototype.FV=Math.pow(2,s),t.prototype.F1=s-e,t.prototype.F2=2*e-s;var a="0123456789abcdefghijklmnopqrstuvwxyz",h=new Array,c,d;for(c=48,d=0;d<=9;++d)h[c++]=d;for(c=97,d=10;d<36;++d)h[c++]=d;for(c=65,d=10;d<36;++d)h[c++]=d;function y(q){return a.charAt(q)}function g(q,H){var z=h[q.charCodeAt(H)];return z??-1}function D(q){for(var H=this.t-1;H>=0;--H)q[H]=this[H];q.t=this.t,q.s=this.s}function O(q){this.t=1,this.s=q<0?-1:0,q>0?this[0]=q:q<-1?this[0]=q+DV:this.t=0}function V(q){var H=n();return H.fromInt(q),H}function k(q,H){var z;if(H==16)z=4;else if(H==8)z=3;else if(H==256)z=8;else if(H==2)z=1;else if(H==32)z=5;else if(H==4)z=2;else{this.fromRadix(q,H);return}this.t=0,this.s=0;for(var fe=q.length,we=!1,Pe=0;--fe>=0;){var ke=z==8?q[fe]&255:g(q,fe);if(ke<0){q.charAt(fe)=="-"&&(we=!0);continue}we=!1,Pe==0?this[this.t++]=ke:Pe+z>this.DB?(this[this.t-1]|=(ke&(1<<this.DB-Pe)-1)<<Pe,this[this.t++]=ke>>this.DB-Pe):this[this.t-1]|=ke<<Pe,Pe+=z,Pe>=this.DB&&(Pe-=this.DB)}z==8&&q[0]&128&&(this.s=-1,Pe>0&&(this[this.t-1]|=(1<<this.DB-Pe)-1<<Pe)),this.clamp(),we&&t.ZERO.subTo(this,this)}function M(){for(var q=this.s&this.DM;this.t>0&&this[this.t-1]==q;)--this.t}function N(q){if(this.s<0)return"-"+this.negate().toString(q);var H;if(q==16)H=4;else if(q==8)H=3;else if(q==2)H=1;else if(q==32)H=5;else if(q==4)H=2;else return this.toRadix(q);var z=(1<<H)-1,fe,we=!1,Pe="",ke=this.t,$e=this.DB-ke*this.DB%H;if(ke-- >0)for($e<this.DB&&(fe=this[ke]>>$e)>0&&(we=!0,Pe=y(fe));ke>=0;)$e<H?(fe=(this[ke]&(1<<$e)-1)<<H-$e,fe|=this[--ke]>>($e+=this.DB-H)):(fe=this[ke]>>($e-=H)&z,$e<=0&&($e+=this.DB,--ke)),fe>0&&(we=!0),we&&(Pe+=y(fe));return we?Pe:"0"}function F(){var q=n();return t.ZERO.subTo(this,q),q}function G(){return this.s<0?this.negate():this}function ie(q){var H=this.s-q.s;if(H!=0)return H;var z=this.t;if(H=z-q.t,H!=0)return this.s<0?-H:H;for(;--z>=0;)if((H=this[z]-q[z])!=0)return H;return 0}function Z(q){var H=1,z;return(z=q>>>16)!=0&&(q=z,H+=16),(z=q>>8)!=0&&(q=z,H+=8),(z=q>>4)!=0&&(q=z,H+=4),(z=q>>2)!=0&&(q=z,H+=2),(z=q>>1)!=0&&(q=z,H+=1),H}function W(){return this.t<=0?0:this.DB*(this.t-1)+Z(this[this.t-1]^this.s&this.DM)}function X(q,H){var z;for(z=this.t-1;z>=0;--z)H[z+q]=this[z];for(z=q-1;z>=0;--z)H[z]=0;H.t=this.t+q,H.s=this.s}function J(q,H){for(var z=q;z<this.t;++z)H[z-q]=this[z];H.t=Math.max(this.t-q,0),H.s=this.s}function oe(q,H){var z=q%this.DB,fe=this.DB-z,we=(1<<fe)-1,Pe=Math.floor(q/this.DB),ke=this.s<<z&this.DM,$e;for($e=this.t-1;$e>=0;--$e)H[$e+Pe+1]=this[$e]>>fe|ke,ke=(this[$e]&we)<<z;for($e=Pe-1;$e>=0;--$e)H[$e]=0;H[Pe]=ke,H.t=this.t+Pe+1,H.s=this.s,H.clamp()}function le(q,H){H.s=this.s;var z=Math.floor(q/this.DB);if(z>=this.t){H.t=0;return}var fe=q%this.DB,we=this.DB-fe,Pe=(1<<fe)-1;H[0]=this[z]>>fe;for(var ke=z+1;ke<this.t;++ke)H[ke-z-1]|=(this[ke]&Pe)<<we,H[ke-z]=this[ke]>>fe;fe>0&&(H[this.t-z-1]|=(this.s&Pe)<<we),H.t=this.t-z,H.clamp()}function pe(q,H){for(var z=0,fe=0,we=Math.min(q.t,this.t);z<we;)fe+=this[z]-q[z],H[z++]=fe&this.DM,fe>>=this.DB;if(q.t<this.t){for(fe-=q.s;z<this.t;)fe+=this[z],H[z++]=fe&this.DM,fe>>=this.DB;fe+=this.s}else{for(fe+=this.s;z<q.t;)fe-=q[z],H[z++]=fe&this.DM,fe>>=this.DB;fe-=q.s}H.s=fe<0?-1:0,fe<-1?H[z++]=this.DV+fe:fe>0&&(H[z++]=fe),H.t=z,H.clamp()}function ve(q,H){var z=this.abs(),fe=q.abs(),we=z.t;for(H.t=we+fe.t;--we>=0;)H[we]=0;for(we=0;we<fe.t;++we)H[we+z.t]=z.am(0,fe[we],H,we,0,z.t);H.s=0,H.clamp(),this.s!=q.s&&t.ZERO.subTo(H,H)}function Oe(q){for(var H=this.abs(),z=q.t=2*H.t;--z>=0;)q[z]=0;for(z=0;z<H.t-1;++z){var fe=H.am(z,H[z],q,2*z,0,1);(q[z+H.t]+=H.am(z+1,2*H[z],q,2*z+1,fe,H.t-z-1))>=H.DV&&(q[z+H.t]-=H.DV,q[z+H.t+1]=1)}q.t>0&&(q[q.t-1]+=H.am(z,H[z],q,2*z,0,1)),q.s=0,q.clamp()}function He(q,H,z){var fe=q.abs();if(!(fe.t<=0)){var we=this.abs();if(we.t<fe.t){H!=null&&H.fromInt(0),z!=null&&this.copyTo(z);return}z==null&&(z=n());var Pe=n(),ke=this.s,$e=q.s,lt=this.DB-Z(fe[fe.t-1]);lt>0?(fe.lShiftTo(lt,Pe),we.lShiftTo(lt,z)):(fe.copyTo(Pe),we.copyTo(z));var et=Pe.t,pt=Pe[et-1];if(pt!=0){var St=pt*(1<<this.F1)+(et>1?Pe[et-2]>>this.F2:0),Mt=this.FV/St,Is=(1<<this.F1)/St,Gi=1<<this.F2,_i=z.t,zi=_i-et,li=H??n();for(Pe.dlShiftTo(zi,li),z.compareTo(li)>=0&&(z[z.t++]=1,z.subTo(li,z)),t.ONE.dlShiftTo(et,li),li.subTo(Pe,Pe);Pe.t<et;)Pe[Pe.t++]=0;for(;--zi>=0;){var Wi=z[--_i]==pt?this.DM:Math.floor(z[_i]*Mt+(z[_i-1]+Gi)*Is);if((z[_i]+=Pe.am(0,Wi,z,zi,0,et))<Wi)for(Pe.dlShiftTo(zi,li),z.subTo(li,z);z[_i]<--Wi;)z.subTo(li,z)}H!=null&&(z.drShiftTo(et,H),ke!=$e&&t.ZERO.subTo(H,H)),z.t=et,z.clamp(),lt>0&&z.rShiftTo(lt,z),ke<0&&t.ZERO.subTo(z,z)}}}function Ue(q){var H=n();return this.abs().divRemTo(q,null,H),this.s<0&&H.compareTo(t.ZERO)>0&&q.subTo(H,H),H}function Le(q){this.m=q}function Ae(q){return q.s<0||q.compareTo(this.m)>=0?q.mod(this.m):q}function ae(q){return q}function Ie(q){q.divRemTo(this.m,null,q)}function nt(q,H,z){q.multiplyTo(H,z),this.reduce(z)}function Qe(q,H){q.squareTo(H),this.reduce(H)}Le.prototype.convert=Ae,Le.prototype.revert=ae,Le.prototype.reduce=Ie,Le.prototype.mulTo=nt,Le.prototype.sqrTo=Qe;function Be(){if(this.t<1)return 0;var q=this[0];if(!(q&1))return 0;var H=q&3;return H=H*(2-(q&15)*H)&15,H=H*(2-(q&255)*H)&255,H=H*(2-((q&65535)*H&65535))&65535,H=H*(2-q*H%this.DV)%this.DV,H>0?this.DV-H:-H}function We(q){this.m=q,this.mp=q.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<q.DB-15)-1,this.mt2=2*q.t}function ft(q){var H=n();return q.abs().dlShiftTo(this.m.t,H),H.divRemTo(this.m,null,H),q.s<0&&H.compareTo(t.ZERO)>0&&this.m.subTo(H,H),H}function mt(q){var H=n();return q.copyTo(H),this.reduce(H),H}function bt(q){for(;q.t<=this.mt2;)q[q.t++]=0;for(var H=0;H<this.m.t;++H){var z=q[H]&32767,fe=z*this.mpl+((z*this.mph+(q[H]>>15)*this.mpl&this.um)<<15)&q.DM;for(z=H+this.m.t,q[z]+=this.m.am(0,fe,q,H,0,this.m.t);q[z]>=q.DV;)q[z]-=q.DV,q[++z]++}q.clamp(),q.drShiftTo(this.m.t,q),q.compareTo(this.m)>=0&&q.subTo(this.m,q)}function Et(q,H){q.squareTo(H),this.reduce(H)}function wt(q,H,z){q.multiplyTo(H,z),this.reduce(z)}We.prototype.convert=ft,We.prototype.revert=mt,We.prototype.reduce=bt,We.prototype.mulTo=wt,We.prototype.sqrTo=Et;function vt(){return(this.t>0?this[0]&1:this.s)==0}function Ut(q,H){if(q>4294967295||q<1)return t.ONE;var z=n(),fe=n(),we=H.convert(this),Pe=Z(q)-1;for(we.copyTo(z);--Pe>=0;)if(H.sqrTo(z,fe),(q&1<<Pe)>0)H.mulTo(fe,we,z);else{var ke=z;z=fe,fe=ke}return H.revert(z)}function Ne(q,H){var z;return q<256||H.isEven()?z=new Le(H):z=new We(H),this.exp(q,z)}t.prototype.copyTo=D,t.prototype.fromInt=O,t.prototype.fromString=k,t.prototype.clamp=M,t.prototype.dlShiftTo=X,t.prototype.drShiftTo=J,t.prototype.lShiftTo=oe,t.prototype.rShiftTo=le,t.prototype.subTo=pe,t.prototype.multiplyTo=ve,t.prototype.squareTo=Oe,t.prototype.divRemTo=He,t.prototype.invDigit=Be,t.prototype.isEven=vt,t.prototype.exp=Ut,t.prototype.toString=N,t.prototype.negate=F,t.prototype.abs=G,t.prototype.compareTo=ie,t.prototype.bitLength=W,t.prototype.mod=Ue,t.prototype.modPowInt=Ne,t.ZERO=V(0),t.ONE=V(1);function Pi(q,H){this.fromInt(0),H==null&&(H=10);for(var z=this.chunkSize(H),fe=Math.pow(H,z),we=!1,Pe=0,ke=0,$e=0;$e<q.length;++$e){var lt=g(q,$e);if(lt<0){q.charAt($e)=="-"&&this.signum()==0&&(we=!0);continue}ke=H*ke+lt,++Pe>=z&&(this.dMultiply(fe),this.dAddOffset(ke,0),Pe=0,ke=0)}Pe>0&&(this.dMultiply(Math.pow(H,Pe)),this.dAddOffset(ke,0)),we&&t.ZERO.subTo(this,this)}function $t(q){return Math.floor(Math.LN2*this.DB/Math.log(q))}function Ft(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1}function $i(q){this[this.t]=this.am(0,q-1,this,0,0,this.t),++this.t,this.clamp()}function T(q,H){if(q!=0){for(;this.t<=H;)this[this.t++]=0;for(this[H]+=q;this[H]>=this.DV;)this[H]-=this.DV,++H>=this.t&&(this[this.t++]=0),++this[H]}}function K(q){if(q==null&&(q=10),this.signum()==0||q<2||q>36)return"0";var H=this.chunkSize(q),z=Math.pow(q,H),fe=V(z),we=n(),Pe=n(),ke="";for(this.divRemTo(fe,we,Pe);we.signum()>0;)ke=(z+Pe.intValue()).toString(q).substr(1)+ke,we.divRemTo(fe,we,Pe);return Pe.intValue().toString(q)+ke}function j(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function ee(q,H){for(var z=0,fe=0,we=Math.min(q.t,this.t);z<we;)fe+=this[z]+q[z],H[z++]=fe&this.DM,fe>>=this.DB;if(q.t<this.t){for(fe+=q.s;z<this.t;)fe+=this[z],H[z++]=fe&this.DM,fe>>=this.DB;fe+=this.s}else{for(fe+=this.s;z<q.t;)fe+=q[z],H[z++]=fe&this.DM,fe>>=this.DB;fe+=q.s}H.s=fe<0?-1:0,fe>0?H[z++]=fe:fe<-1&&(H[z++]=this.DV+fe),H.t=z,H.clamp()}t.prototype.fromRadix=Pi,t.prototype.chunkSize=$t,t.prototype.signum=Ft,t.prototype.dMultiply=$i,t.prototype.dAddOffset=T,t.prototype.toRadix=K,t.prototype.intValue=j,t.prototype.addTo=ee;var re={abs:function(q,H){var z=new o.math.Long(q,H),fe;z.isNegative()?fe=z.negate():fe=z,HEAP32[tempDoublePtr>>2]=fe.low_,HEAP32[tempDoublePtr+4>>2]=fe.high_},ensureTemps:function(){re.ensuredTemps||(re.ensuredTemps=!0,re.two32=new t,re.two32.fromString("4294967296",10),re.two64=new t,re.two64.fromString("18446744073709551616",10),re.temp1=new t,re.temp2=new t)},lh2bignum:function(q,H){var z=new t;z.fromString(H.toString(),10);var fe=new t;z.multiplyTo(re.two32,fe);var we=new t;we.fromString(q.toString(),10);var Pe=new t;return we.addTo(fe,Pe),Pe},stringify:function(q,H,z){var fe=new o.math.Long(q,H).toString();if(z&&fe[0]=="-"){re.ensureTemps();var we=new t;we.fromString(fe,10),fe=new t,re.two64.addTo(we,fe),fe=fe.toString(10)}return fe},fromString:function(q,H,z,fe,we){re.ensureTemps();var Pe=new t;Pe.fromString(q,H);var ke=new t;ke.fromString(z,10);var $e=new t;if($e.fromString(fe,10),we&&Pe.compareTo(t.ZERO)<0){var lt=new t;Pe.addTo(re.two64,lt),Pe=lt}var et=!1;Pe.compareTo(ke)<0?(Pe=ke,et=!0):Pe.compareTo($e)>0&&(Pe=$e,et=!0);var pt=o.math.Long.fromString(Pe.toString());if(HEAP32[tempDoublePtr>>2]=pt.low_,HEAP32[tempDoublePtr+4>>2]=pt.high_,et)throw"range error"}};return re}();function ExitStatus(o){this.name="ExitStatus",this.message="Program terminated with exit("+o+")",this.status=o}ExitStatus.prototype=new Error,ExitStatus.prototype.constructor=ExitStatus;var initialStackTop;dependenciesFulfilled=function o(){!Module.calledRun&&shouldRunNow&&run(),Module.calledRun||(dependenciesFulfilled=o)},Module.callMain=Module.callMain=function o(e){assert(runDependencies==0,"cannot call main when async dependencies remain! (listen on __ATMAIN__)"),assert(__ATPRERUN__.length==0,"cannot call main when preRun functions remain to be called"),e=e||[],ensureInitRuntime();var t=e.length+1;function n(){for(var h=0;h<3;h++)r.push(0)}var r=[allocate(intArrayFromString(Module.thisProgram),"i8",ALLOC_NORMAL)];n();for(var s=0;s<t-1;s=s+1)r.push(allocate(intArrayFromString(e[s]),"i8",ALLOC_NORMAL)),n();r.push(0),r=allocate(r,"i32",ALLOC_NORMAL),initialStackTop=STACKTOP;try{var a=Module._main(t,r,0);exit(a)}catch(h){if(h instanceof ExitStatus)return;if(h=="SimulateInfiniteLoop"){Module.noExitRuntime=!0;return}else throw h&&typeof h=="object"&&h.stack&&Module.printErr("exception thrown: "+[h,h.stack]),h}finally{}};function run(o){if(o=o||Module.arguments,runDependencies>0||(preRun(),runDependencies>0)||Module.calledRun)return;function e(){Module.calledRun||(Module.calledRun=!0,!ABORT&&(ensureInitRuntime(),preMain(),Module._main&&shouldRunNow&&Module.callMain(o),postRun()))}Module.setStatus?(Module.setStatus("Running..."),setTimeout(function(){setTimeout(function(){Module.setStatus("")},1),e()},1)):e()}Module.run=Module.run=run;function exit(o){if(!Module.noExitRuntime)throw ABORT=!0,STACKTOP=initialStackTop,exitRuntime(),ENVIRONMENT_IS_NODE?(process.stdout.once("drain",function(){process.exit(o)}),console.log(" "),setTimeout(function(){process.exit(o)},500)):ENVIRONMENT_IS_SHELL&&typeof quit=="function"&&quit(o),new ExitStatus(o)}Module.exit=Module.exit=exit;function abort(o){o&&(Module.print(o),Module.printErr(o)),ABORT=!0;var e=`
If this abort() is unexpected, build with -s ASSERTIONS=1 which can give more information.`;throw"abort() at "+stackTrace()+e}if(Module.abort=Module.abort=abort,Module.preInit)for(typeof Module.preInit=="function"&&(Module.preInit=[Module.preInit]);Module.preInit.length>0;)Module.preInit.pop()();var shouldRunNow=!0;Module.noInitialRun&&(shouldRunNow=!1),run();var origMalloc=Module._malloc,origFree=Module._free,MEMSTATS={totalMemory:Module.HEAPU8.length,heapUsed:0},MEMSTATS_DATA={pointerToSizeMap:{},getSizeOfPointer:function(o){return MEMSTATS_DATA.pointerToSizeMap[o]}};Module.MEMSTATS=MEMSTATS,Module.MEMSTATS_DATA=MEMSTATS_DATA;var hookedMalloc=function(o){var e=origMalloc(o);return e?(MEMSTATS.heapUsed+=o,MEMSTATS_DATA.pointerToSizeMap[e]=o,e):0},hookedFree=function(o){return o&&(MEMSTATS.heapUsed-=MEMSTATS_DATA.getSizeOfPointer(o)||0,delete MEMSTATS_DATA.pointerToSizeMap[o]),origFree(o)};return Module._malloc=hookedMalloc,Module._free=hookedFree,_malloc=hookedMalloc,_free=hookedFree,module.exports};const C_MINISAT$1=C_MINISAT;var MiniSat;MiniSat=function(){var o=this._C=C_MINISAT$1();this._native={getStackPointer:function(){return o.Runtime.stackSave()},setStackPointer:function(e){o.Runtime.stackRestore(e)},allocateBytes:function(e){return o.allocate(e,"i8",o.ALLOC_STACK)},pushString:function(e){return this.allocateBytes(o.intArrayFromString(e))},savingStack:function(e){var t=this.getStackPointer();try{return e(this,o)}finally{this.setStackPointer(t)}}},o._createTheSolver(),this._clauses=[]};MiniSat.prototype.ensureVar=function(o){this._C._ensureVar(o)};MiniSat.prototype.addClause=function(o){return this._clauses.push(o),this._native.savingStack(function(e,t){var n=t.allocate((o.length+1)*4,"i32",t.ALLOC_STACK);return _$1.each(o,function(r,s){t.setValue(n+s*4,r,"i32")}),t.setValue(n+o.length*4,0,"i32"),!!t._addClause(n)})};MiniSat.prototype.solve=function(){return!!this._C._solve()};MiniSat.prototype.solveAssuming=function(o){return!!this._C._solveAssuming(o)};MiniSat.prototype.getSolution=function(){for(var o=[null],e=this._C,t=e._getNumVars(),n=e._getSolution(),r=0;r<t;r++)o[r+1]=e.getValue(n+r,"i8")===0;return o};MiniSat.prototype.retireVar=function(o){this._C._retireVar(o)};MiniSat.prototype.getConflictClause=function(){for(var o=this._C,e=o._getConflictClauseSize(),t=o._getConflictClause(),n=[],r=0;r<e;r++){var s=o.getValue(t+r*4,"i32"),a=s>>>1,h=s&1?-1:1;n[r]=a*h}return n};const MiniSat$1=MiniSat;var Logic;Logic={};var withDescription=function(o,e){return e.description=o,e},lazyInstanceofTester=function(o,e,t){return withDescription(o,function(n){return n instanceof e[t]})};Logic.isNumTerm=withDescription("a NumTerm (non-zero integer)",function(o){return o===(o|0)&&o!==0});Logic.isNameTerm=withDescription("a NameTerm (string)",function(o){return typeof o=="string"&&!/^-*[0-9]*$/.test(o)});Logic.isTerm=withDescription("a Term (appropriate string or number)",function(o){return Logic.isNumTerm(o)||Logic.isNameTerm(o)});Logic.isWholeNumber=withDescription("a whole number (integer >= 0)",function(o){return o===(o|0)&&o>=0});Logic.isFormula=lazyInstanceofTester("a Formula",Logic,"Formula");Logic.isClause=lazyInstanceofTester("a Clause",Logic,"Clause");Logic.isBits=lazyInstanceofTester("a Bits",Logic,"Bits");Logic._isInteger=withDescription("an integer",function(o){return o===(o|0)});Logic._isFunction=withDescription("a Function",function(o){return typeof o=="function"});Logic._isString=withDescription("a String",function(o){return typeof o=="string"});Logic._isArrayWhere=function(o){var e="an array";return o.description&&(e+=" of "+o.description),withDescription(e,function(t){if(_$1.isArray(t)){for(var n=0;n<t.length;n++)if(!o(t[n]))return!1;return!0}else return!1})};Logic._isFormulaOrTerm=withDescription("a Formula or Term",function(o){return Logic.isFormula(o)||Logic.isTerm(o)});Logic._isFormulaOrTermOrBits=withDescription("a Formula, Term, or Bits",function(o){return Logic.isFormula(o)||Logic.isBits(o)||Logic.isTerm(o)});Logic._MiniSat=MiniSat$1;var isInteger=Logic._isInteger,isFunction=Logic._isFunction,isString=Logic._isString,isArrayWhere=Logic._isArrayWhere,isFormulaOrTerm=Logic._isFormulaOrTerm,isFormulaOrTermOrBits=Logic._isFormulaOrTermOrBits;Logic._assert=function(o,e,t){if(!e(o)){var n=typeof o=="string"?JSON.stringify(o):o;throw new Error(n+" is not "+(e.description||t))}};var assertNumArgs=function(o,e,t){if(o!==e)throw new Error("Expected "+e+" args in "+t+", got "+o)},assert$1=Logic._assert;Logic._assertIfEnabled=function(o,e,t){assert$1&&assert$1(o,e,t)};Logic.disablingAssertions=function(o){var e=assert$1;try{return assert$1=null,o()}finally{assert$1=e}};Logic._disablingTypeChecks=Logic.disablingAssertions;Logic.not=function(o){return assert$1&&assert$1(o,isFormulaOrTerm),o instanceof Logic.Formula?new Logic.NotFormula(o):typeof o=="number"?-o:o.charAt(0)==="-"?o.slice(1):"-"+o};Logic.NAME_FALSE="$F";Logic.NAME_TRUE="$T";Logic.NUM_FALSE=1;Logic.NUM_TRUE=2;Logic.TRUE=Logic.NAME_TRUE;Logic.FALSE=Logic.NAME_FALSE;Logic.Formula=function(){};Logic._defineFormula=function(o,e,t){assert$1&&assert$1(o,isFunction),assert$1&&assert$1(e,isString),o.prototype=new Logic.Formula,o.prototype.type=e,t&&_$1.extend(o.prototype,t)};Logic.Formula.prototype.generateClauses=function(o,e){throw new Error("Cannot generate this Formula; it must be expanded")};Logic.Formula._nextGuid=1;Logic.Formula.prototype._guid=null;Logic.Formula.prototype.guid=function(){return this._guid===null&&(this._guid=Logic.Formula._nextGuid++),this._guid};Logic.Clause=function(){var o=_$1.flatten(arguments);assert$1&&assert$1(o,isArrayWhere(Logic.isNumTerm)),this.terms=o};Logic.Clause.prototype.append=function(){return new Logic.Clause(this.terms.concat(_$1.flatten(arguments)))};var FormulaInfo=function(){this.varName=null,this.varNum=null,this.occursPositively=!1,this.occursNegatively=!1,this.isRequired=!1,this.isForbidden=!1};Logic.Termifier=function(o){this.solver=o};Logic.Termifier.prototype.clause=function(){var o=this,e=_$1.flatten(arguments);return assert$1&&assert$1(e,isArrayWhere(isFormulaOrTerm)),new Logic.Clause(_$1.map(e,function(t){return o.term(t)}))};Logic.Termifier.prototype.term=function(o){return this.solver._formulaToTerm(o)};Logic.Termifier.prototype.generate=function(o,e){return this.solver._generateFormula(o,e,this)};Logic.Solver=function(){var o=this;o.clauses=[],o._num2name=[null],o._name2num={};var e=o.getVarNum(Logic.NAME_FALSE,!1,!0),t=o.getVarNum(Logic.NAME_TRUE,!1,!0);if(e!==Logic.NUM_FALSE||t!==Logic.NUM_TRUE)throw new Error("Assertion failure: $T and $F have wrong numeric value");o._F_used=!1,o._T_used=!1,o.clauses.push(new Logic.Clause(-Logic.NUM_FALSE)),o.clauses.push(new Logic.Clause(Logic.NUM_TRUE)),o._formulaInfo={},o._nextFormulaNumByType={},o._ungeneratedFormulas={},o._numClausesAddedToMiniSat=0,o._unsat=!1,o._minisat=new MiniSat$1,o._termifier=new Logic.Termifier(o)};Logic.Solver.prototype.getVarNum=function(o,e,t){var n=" "+o;if(_$1.has(this._name2num,n))return this._name2num[n];if(e)return 0;if(o.charAt(0)==="$"&&!t)throw new Error("Only generated variable names can start with $");var r=this._num2name.length;return this._name2num[n]=r,this._num2name.push(o),r};Logic.Solver.prototype.getVarName=function(o){assert$1&&assert$1(o,isInteger);var e=this._num2name;if(o<1||o>=e.length)throw new Error("Bad variable num: "+o);return e[o]};Logic.Solver.prototype.toNumTerm=function(o,e){var t=this;if(assert$1&&assert$1(o,Logic.isTerm),typeof o=="number")return o;for(var n=!1;o.charAt(0)==="-";)o=o.slice(1),n=!n;var r=t.getVarNum(o,e);return r?n?-r:r:0};Logic.Solver.prototype.toNameTerm=function(o){var e=this;if(assert$1&&assert$1(o,Logic.isTerm),typeof o=="string"){for(;o.slice(0,2)==="--";)o=o.slice(2);return o}else{var t=!1;return o<0&&(t=!0,o=-o),o=e.getVarName(o),t&&(o="-"+o),o}};Logic.Solver.prototype._addClause=function(o,e,t){var n=this;assert$1&&assert$1(o,Logic.isClause);var r=null;e&&(r=e,assert$1&&assert$1(r,isArrayWhere(Logic.isNumTerm)));var s=!1,a=!1,h=o.terms.length;r&&(o=o.append(r));for(var c=0;c<o.terms.length;c++){var d=o.terms[c],y=d<0?-d:d;if(y===Logic.NUM_FALSE)s=!0;else if(y===Logic.NUM_TRUE)a=!0;else{if(y<1||y>=n._num2name.length)throw new Error("Bad variable number: "+y);c<h&&(t?t(d):n._useFormulaTerm(d))}}this._F_used=this._F_used||s,this._T_used=this._T_used||a,this.clauses.push(o)};Logic.Solver.prototype._useFormulaTerm=function(o,e){var t=this;assert$1&&assert$1(o,Logic.isNumTerm);var n=o<0?-o:o;if(_$1.has(t._ungeneratedFormulas,n)){var r=t._ungeneratedFormulas[n],s=t._getFormulaInfo(r),a=o>0,h=null,c;if(e?c=e:(h=[],c=function(D,O){h.push({clauses:D,extraTerms:O})}),a&&!s.occursPositively){s.occursPositively=!0;var d=t._generateFormula(!0,r);c(d,[-n])}else if(!a&&!s.occursNegatively){s.occursNegatively=!0;var d=t._generateFormula(!1,r);c(d,[n])}if(s.occursPositively&&s.occursNegatively&&delete t._ungeneratedFormulas[n],!!(h&&h.length))for(var y=function(D){t._useFormulaTerm(D,c)};h.length;){var g=h.pop();t._addClauses(g.clauses,g.extraTerms,y)}}};Logic.Solver.prototype._addClauses=function(o,e,t){assert$1&&assert$1(o,isArrayWhere(Logic.isClause));var n=this;_$1.each(o,function(r){n._addClause(r,e,t)})};Logic.Solver.prototype.require=function(){this._requireForbidImpl(!0,_$1.flatten(arguments))};Logic.Solver.prototype.forbid=function(){this._requireForbidImpl(!1,_$1.flatten(arguments))};Logic.Solver.prototype._requireForbidImpl=function(o,e){var t=this;assert$1&&assert$1(e,isArrayWhere(isFormulaOrTerm)),_$1.each(e,function(n){if(n instanceof Logic.NotFormula)t._requireForbidImpl(!o,[n.operand]);else if(n instanceof Logic.Formula){var r=t._getFormulaInfo(n);if(r.varNum!==null){var s=o?1:-1;t._addClause(new Logic.Clause(s*r.varNum))}else t._addClauses(t._generateFormula(o,n));o?r.isRequired=!0:r.isForbidden=!0}else t._addClauses(t._generateFormula(o,n))})};Logic.Solver.prototype._generateFormula=function(o,e,t){var n=this;if(assert$1&&assert$1(e,isFormulaOrTerm),e instanceof Logic.NotFormula)return n._generateFormula(!o,e.operand);if(e instanceof Logic.Formula){var r=n._getFormulaInfo(e);if(o&&r.isRequired||!o&&r.isForbidden)return[];if(o&&r.isForbidden||!o&&r.isRequired)return[new Logic.Clause];var s=e.generateClauses(o,t||n._termifier);return _$1.isArray(s)?s:[s]}else{var a=n.toNumTerm(e),h=o?1:-1;return a===h*Logic.NUM_TRUE||a===-h*Logic.NUM_FALSE?[]:a===h*Logic.NUM_FALSE||a===-h*Logic.NUM_TRUE?[new Logic.Clause]:[new Logic.Clause(h*a)]}};Logic.Solver.prototype._clauseData=function(){var o=_$1.map(this.clauses,"terms");return this._T_used||o.splice(1,1),this._F_used||o.splice(0,1),o};Logic.Solver.prototype._clauseStrings=function(){var o=this,e=o._clauseData();return _$1.map(e,function(t){return _$1.map(t,function(n){var r=o.toNameTerm(n);if(/\s/.test(r)){var s="";r.charAt(0)==="-"&&(s="-",r=r.slice(1)),r=s+'"'+r+'"'}return r}).join(" v ")})};Logic.Solver.prototype._getFormulaInfo=function(o,e){var t=this,n=o.guid();if(!t._formulaInfo[n]){if(e)return null;t._formulaInfo[n]=new FormulaInfo}return t._formulaInfo[n]};Logic.Solver.prototype._formulaToTerm=function(o){var e=this;if(_$1.isArray(o))return assert$1&&assert$1(o,isArrayWhere(isFormulaOrTerm)),_$1.map(o,_$1.bind(e._formulaToTerm,e));if(assert$1&&assert$1(o,isFormulaOrTerm),o instanceof Logic.NotFormula)return Logic.not(e._formulaToTerm(o.operand));if(o instanceof Logic.Formula){var t=this._getFormulaInfo(o);if(t.isRequired)return Logic.NUM_TRUE;if(t.isForbidden)return Logic.NUM_FALSE;if(t.varNum===null){var n=o.type;this._nextFormulaNumByType[n]||(this._nextFormulaNumByType[n]=1);var r=this._nextFormulaNumByType[n]++;t.varName="$"+o.type+r,t.varNum=this.getVarNum(t.varName,!1,!0),this._ungeneratedFormulas[t.varNum]=o}return t.varNum}else return e.toNumTerm(o)};Logic.or=function(){var o=_$1.flatten(arguments);return o.length===0?Logic.FALSE:o.length===1?(assert$1&&assert$1(o[0],isFormulaOrTerm),o[0]):new Logic.OrFormula(o)};Logic.OrFormula=function(o){assert$1&&assert$1(o,isArrayWhere(isFormulaOrTerm)),this.operands=o};Logic._defineFormula(Logic.OrFormula,"or",{generateClauses:function(o,e){if(o)return e.clause(this.operands);var t=[];return _$1.each(this.operands,function(n){t.push.apply(t,e.generate(!1,n))}),t}});Logic.NotFormula=function(o){assert$1&&assert$1(o,isFormulaOrTerm),this.operand=o};Logic._defineFormula(Logic.NotFormula,"not");Logic.and=function(){var o=_$1.flatten(arguments);return o.length===0?Logic.TRUE:o.length===1?(assert$1&&assert$1(o[0],isFormulaOrTerm),o[0]):new Logic.AndFormula(o)};Logic.AndFormula=function(o){assert$1&&assert$1(o,isArrayWhere(isFormulaOrTerm)),this.operands=o};Logic._defineFormula(Logic.AndFormula,"and",{generateClauses:function(o,e){if(o){var t=[];return _$1.each(this.operands,function(n){t.push.apply(t,e.generate(!0,n))}),t}else return e.clause(_$1.map(this.operands,Logic.not))}});var group=function(o,e){for(var t=[],n=0;n<o.length;n+=e)t.push(o.slice(n,n+e));return t};Logic.xor=function(){var o=_$1.flatten(arguments);return o.length===0?Logic.FALSE:o.length===1?(assert$1&&assert$1(o[0],isFormulaOrTerm),o[0]):new Logic.XorFormula(o)};Logic.XorFormula=function(o){assert$1&&assert$1(o,isArrayWhere(isFormulaOrTerm)),this.operands=o};Logic._defineFormula(Logic.XorFormula,"xor",{generateClauses:function(o,e){var t=this.operands,n=Logic.not;if(t.length>3)return e.generate(o,Logic.xor(_$1.map(group(this.operands,3),function(h){return Logic.xor(h)})));if(o){if(t.length===0)return e.clause();if(t.length===1)return e.clause(t[0]);if(t.length===2){var r=t[0],s=t[1];return[e.clause(r,s),e.clause(n(r),n(s))]}else if(t.length===3){var r=t[0],s=t[1],a=t[2];return[e.clause(r,s,a),e.clause(r,n(s),n(a)),e.clause(n(r),s,n(a)),e.clause(n(r),n(s),a)]}}else{if(t.length===0)return[];if(t.length===1)return e.clause(n(t[0]));if(t.length===2){var r=t[0],s=t[1];return[e.clause(r,n(s)),e.clause(n(r),s)]}else if(t.length===3){var r=t[0],s=t[1],a=t[2];return[e.clause(n(r),n(s),n(a)),e.clause(n(r),s,a),e.clause(r,n(s),a),e.clause(r,s,n(a))]}}}});Logic.atMostOne=function(){var o=_$1.flatten(arguments);return o.length<=1?Logic.TRUE:new Logic.AtMostOneFormula(o)};Logic.AtMostOneFormula=function(o){assert$1&&assert$1(o,isArrayWhere(isFormulaOrTerm)),this.operands=o};Logic._defineFormula(Logic.AtMostOneFormula,"atMostOne",{generateClauses:function(o,e){var t=this.operands,n=Logic.not;if(t.length<=1)return[];if(t.length===2)return e.generate(o,Logic.not(Logic.and(t)));if(o&&t.length===3){for(var r=[],s=0;s<t.length;s++)for(var a=s+1;a<t.length;a++)r.push(e.clause(n(t[s]),n(t[a])));return r}else if(!o&&t.length===3){var h=t[0],c=t[1],d=t[2];return[e.clause(h,c),e.clause(h,d),e.clause(c,d)]}else{var y=group(t,3),g=_$1.map(y,function(O){return Logic.or(O)});y[y.length-1].length<2&&y.pop();var D=_$1.map(y,function(O){return Logic.atMostOne(O)});return e.generate(o,Logic.and(Logic.atMostOne(g),D))}}});Logic.implies=function(o,e){return assert$1&&assertNumArgs(arguments.length,2,"Logic.implies"),new Logic.ImpliesFormula(o,e)};Logic.ImpliesFormula=function(o,e){assert$1&&assert$1(o,isFormulaOrTerm),assert$1&&assert$1(e,isFormulaOrTerm),assert$1&&assertNumArgs(arguments.length,2,"Logic.implies"),this.A=o,this.B=e};Logic._defineFormula(Logic.ImpliesFormula,"implies",{generateClauses:function(o,e){return e.generate(o,Logic.or(Logic.not(this.A),this.B))}});Logic.equiv=function(o,e){return assert$1&&assertNumArgs(arguments.length,2,"Logic.equiv"),new Logic.EquivFormula(o,e)};Logic.EquivFormula=function(o,e){assert$1&&assert$1(o,isFormulaOrTerm),assert$1&&assert$1(e,isFormulaOrTerm),assert$1&&assertNumArgs(arguments.length,2,"Logic.equiv"),this.A=o,this.B=e};Logic._defineFormula(Logic.EquivFormula,"equiv",{generateClauses:function(o,e){return e.generate(!o,Logic.xor(this.A,this.B))}});Logic.exactlyOne=function(){var o=_$1.flatten(arguments);return o.length===0?Logic.FALSE:o.length===1?(assert$1&&assert$1(o[0],isFormulaOrTerm),o[0]):new Logic.ExactlyOneFormula(o)};Logic.ExactlyOneFormula=function(o){assert$1&&assert$1(o,isArrayWhere(isFormulaOrTerm)),this.operands=o};Logic._defineFormula(Logic.ExactlyOneFormula,"exactlyOne",{generateClauses:function(o,e){var t=this.operands;return t.length<3?e.generate(o,Logic.xor(t)):e.generate(o,Logic.and(Logic.atMostOne(t),Logic.or(t)))}});Logic.Bits=function(o){assert$1&&assert$1(o,isArrayWhere(isFormulaOrTerm)),this.bits=o};Logic.constantBits=function(o){assert$1&&assert$1(o,Logic.isWholeNumber);for(var e=[];o;)e.push(o&1?Logic.TRUE:Logic.FALSE),o>>>=1;return new Logic.Bits(e)};Logic.variableBits=function(o,e){assert$1&&assert$1(e,Logic.isWholeNumber);for(var t=[],n=0;n<e;n++)t.push(o+"$"+n);return new Logic.Bits(t)};Logic.lessThanOrEqual=function(o,e){return new Logic.LessThanOrEqualFormula(o,e)};Logic.LessThanOrEqualFormula=function(o,e){assert$1&&assert$1(o,Logic.isBits),assert$1&&assert$1(e,Logic.isBits),assert$1&&assertNumArgs(arguments.length,2,"Bits comparison function"),this.bits1=o,this.bits2=e};var genLTE=function(o,e,t,n){var r=[],s=o.bits.slice(),a=e.bits.slice();if(n&&!e.bits.length)return t.clause();for(;s.length>a.length;){var h=s.pop();r.push(t.clause(Logic.not(h)))}for(var c=_$1.map(a,function(y,g){return g<s.length?Logic.xor(s[g],y):y}),d=s.length-1;d>=0;d--)r.push(t.clause(c.slice(d+1),Logic.not(s[d]),a[d]));return n&&r.push.apply(r,t.generate(!0,Logic.or(c))),r};Logic._defineFormula(Logic.LessThanOrEqualFormula,"lte",{generateClauses:function(o,e){return o?genLTE(this.bits1,this.bits2,e,!1):genLTE(this.bits2,this.bits1,e,!0)}});Logic.lessThan=function(o,e){return new Logic.LessThanFormula(o,e)};Logic.LessThanFormula=function(o,e){assert$1&&assert$1(o,Logic.isBits),assert$1&&assert$1(e,Logic.isBits),assert$1&&assertNumArgs(arguments.length,2,"Bits comparison function"),this.bits1=o,this.bits2=e};Logic._defineFormula(Logic.LessThanFormula,"lt",{generateClauses:function(o,e){return o?genLTE(this.bits1,this.bits2,e,!0):genLTE(this.bits2,this.bits1,e,!1)}});Logic.greaterThan=function(o,e){return Logic.lessThan(e,o)};Logic.greaterThanOrEqual=function(o,e){return Logic.lessThanOrEqual(e,o)};Logic.equalBits=function(o,e){return new Logic.EqualBitsFormula(o,e)};Logic.EqualBitsFormula=function(o,e){assert$1&&assert$1(o,Logic.isBits),assert$1&&assert$1(e,Logic.isBits),assert$1&&assertNumArgs(arguments.length,2,"Logic.equalBits"),this.bits1=o,this.bits2=e};Logic._defineFormula(Logic.EqualBitsFormula,"equalBits",{generateClauses:function(o,e){for(var t=this.bits1.bits,n=this.bits2.bits,r=Math.max(t.length,n.length),s=[],a=0;a<r;a++)a>=t.length?s.push(Logic.not(n[a])):a>=n.length?s.push(Logic.not(t[a])):s.push(Logic.equiv(t[a],n[a]));return e.generate(o,Logic.and(s))}});Logic.HalfAdderSum=function(o,e){assert$1&&assert$1(o,isFormulaOrTerm),assert$1&&assert$1(e,isFormulaOrTerm),assert$1&&assertNumArgs(arguments.length,2,"Logic.HalfAdderSum"),this.a=o,this.b=e};Logic._defineFormula(Logic.HalfAdderSum,"hsum",{generateClauses:function(o,e){return e.generate(o,Logic.xor(this.a,this.b))}});Logic.HalfAdderCarry=function(o,e){assert$1&&assert$1(o,isFormulaOrTerm),assert$1&&assert$1(e,isFormulaOrTerm),assert$1&&assertNumArgs(arguments.length,2,"Logic.HalfAdderCarry"),this.a=o,this.b=e};Logic._defineFormula(Logic.HalfAdderCarry,"hcarry",{generateClauses:function(o,e){return e.generate(o,Logic.and(this.a,this.b))}});Logic.FullAdderSum=function(o,e,t){assert$1&&assert$1(o,isFormulaOrTerm),assert$1&&assert$1(e,isFormulaOrTerm),assert$1&&assert$1(t,isFormulaOrTerm),assert$1&&assertNumArgs(arguments.length,3,"Logic.FullAdderSum"),this.a=o,this.b=e,this.c=t};Logic._defineFormula(Logic.FullAdderSum,"fsum",{generateClauses:function(o,e){return e.generate(o,Logic.xor(this.a,this.b,this.c))}});Logic.FullAdderCarry=function(o,e,t){assert$1&&assert$1(o,isFormulaOrTerm),assert$1&&assert$1(e,isFormulaOrTerm),assert$1&&assert$1(t,isFormulaOrTerm),assert$1&&assertNumArgs(arguments.length,3,"Logic.FullAdderCarry"),this.a=o,this.b=e,this.c=t};Logic._defineFormula(Logic.FullAdderCarry,"fcarry",{generateClauses:function(o,e){return e.generate(!o,Logic.atMostOne(this.a,this.b,this.c))}});var binaryWeightedSum=function(o){assert$1&&assert$1(o,isArrayWhere(isArrayWhere(isFormulaOrTerm)));for(var e=_$1.map(o,_$1.clone),t=0,n=[];t<e.length;){var r=e[t];if(!r.length)n.push(Logic.FALSE),t++;else if(r.length===1)n.push(r[0]),t++;else if(r.length===2){var s=new Logic.HalfAdderSum(r[0],r[1]),a=new Logic.HalfAdderCarry(r[0],r[1]);r.length=0,r.push(s),pushToNth(e,t+1,a)}else{var h=r.pop(),c=r.pop(),d=r.pop(),s=new Logic.FullAdderSum(d,c,h),a=new Logic.FullAdderCarry(d,c,h);r.push(s),pushToNth(e,t+1,a)}}return n},pushToNth=function(o,e,t){for(;e>=o.length;)o.push([]);o[e].push(t)},checkWeightedSumArgs=function(o,e){if(assert$1&&assert$1(o,isArrayWhere(isFormulaOrTerm)),typeof e=="number")assert$1&&assert$1(e,Logic.isWholeNumber);else if(assert$1&&assert$1(e,isArrayWhere(Logic.isWholeNumber)),o.length!==e.length)throw new Error("Formula array and weight array must be same length; they are "+o.length+" and "+e.length)};Logic.weightedSum=function(o,e){if(checkWeightedSumArgs(o,e),o.length===0)return new Logic.Bits([]);typeof e=="number"&&(e=_$1.map(o,function(){return e}));var t=[];return _$1.each(o,function(n,r){for(var s=e[r],a=0;s;)s&1&&pushToNth(t,a,n),s>>>=1,a++}),new Logic.Bits(binaryWeightedSum(t))};Logic.sum=function(){var o=_$1.flatten(arguments);assert$1&&assert$1(o,isArrayWhere(isFormulaOrTermOrBits));var e=[];return _$1.each(o,function(t){t instanceof Logic.Bits?_$1.each(t.bits,function(n,r){pushToNth(e,r,n)}):pushToNth(e,0,t)}),new Logic.Bits(binaryWeightedSum(e))};Logic.Solver.prototype.solve=function(o){var e=this;if(o!==void 0&&!(o>=1))throw new Error("_assumpVar must be a variable number");if(e._unsat)return null;for(;e._numClausesAddedToMiniSat<e.clauses.length;){var t=e._numClausesAddedToMiniSat,n=e.clauses[t].terms;assert$1&&assert$1(n,isArrayWhere(Logic.isNumTerm));var r=e._minisat.addClause(n);if(e._numClausesAddedToMiniSat++,!r)return e._unsat=!0,null}assert$1&&assert$1(this._num2name.length-1,Logic.isWholeNumber),e._minisat.ensureVar(this._num2name.length-1);var r=o?e._minisat.solveAssuming(o):e._minisat.solve();return r?new Logic.Solution(e,e._minisat.getSolution()):(o||(e._unsat=!0),null)};Logic.Solver.prototype.solveAssuming=function(o){assert$1&&assert$1(o,isFormulaOrTerm);var e=new Logic.Assumption(o),t=this._formulaToTerm(e);if(!(typeof t=="number"&&t>0))throw new Error("Assertion failure: not a positive numeric term");this._useFormulaTerm(t);var n=this.solve(t);return this._minisat.retireVar(t),n};Logic.Assumption=function(o){assert$1&&assert$1(o,isFormulaOrTerm),this.formula=o};Logic._defineFormula(Logic.Assumption,"assump",{generateClauses:function(o,e){return o?e.clause(this.formula):e.clause(Logic.not(this.formula))}});Logic.Solution=function(o,e){var t=this;t._solver=o,t._assignment=e,t._ungeneratedFormulas=_$1.clone(o._ungeneratedFormulas),t._formulaValueCache={},t._termifier=new Logic.Termifier(t._solver),t._termifier.term=function(n){return t.evaluate(n)?Logic.NUM_TRUE:Logic.NUM_FALSE},t._ignoreUnknownVariables=!1};Logic.Solution.prototype.ignoreUnknownVariables=function(){this._ignoreUnknownVariables=!0};Logic.Solution.prototype.getMap=function(){for(var o=this._solver,e=this._assignment,t={},n=1;n<e.length;n++){var r=o.getVarName(n);r&&r.charAt(0)!=="$"&&(t[r]=e[n])}return t};Logic.Solution.prototype.getTrueVars=function(){for(var o=this._solver,e=this._assignment,t=[],n=1;n<e.length;n++)if(e[n]){var r=o.getVarName(n);r&&r.charAt(0)!=="$"&&t.push(r)}return t.sort(),t};Logic.Solution.prototype.getFormula=function(){for(var o=this._solver,e=this._assignment,t=[],n=1;n<e.length;n++){var r=o.getVarName(n);r&&r.charAt(0)!=="$"&&t.push(e[n]?n:-n)}return Logic.and(t)};Logic.Solution.prototype.evaluate=function(o){var e=this;if(assert$1&&assert$1(o,isFormulaOrTermOrBits),o instanceof Logic.Bits){var t=0;return _$1.each(o.bits,function(k,M){e.evaluate(k)&&(t+=1<<M)}),t}var n=e._solver,r=e._ignoreUnknownVariables,s=e._assignment,a=o;if(a instanceof Logic.NotFormula)return!e.evaluate(a.operand);if(a instanceof Logic.Formula){var h=e._formulaValueCache[a.guid()];if(typeof h=="boolean")return h;var c,d=n._getFormulaInfo(a,!0);if(d&&d.varNum&&d.varNum<s.length&&!_$1.has(e._ungeneratedFormulas,d.varNum))c=s[d.varNum];else var y=n._generateFormula(!0,a,e._termifier),c=_$1.some(y,function(M){return _$1.any(M.terms,function(N){return e.evaluate(N)})});return e._formulaValueCache[a.guid()]=c,c}else{var g=n.toNumTerm(a,!0);if(!g){if(r)return!1;var D=String(a).replace(/^-*/,"");throw new Error("No such variable: "+D)}var O=g,V=!1;if(g<0&&(O=-O,V=!0),O<1||O>=s.length){var D=O;if(O>=1&&O<n._num2name.length&&(D=n._num2name[O]),r)return!1;throw new Error("Variable not part of solution: "+D)}var t=s[O];return V&&(t=!t),t}};Logic.Solution.prototype.getWeightedSum=function(o,e){checkWeightedSumArgs(o,e);var t=0;if(typeof e=="number")for(var n=0;n<o.length;n++)t+=e*(this.evaluate(o[n])?1:0);else for(var n=0;n<o.length;n++)t+=e[n]*(this.evaluate(o[n])?1:0);return t};var getNonZeroWeightedTerms=function(o,e){if(typeof e=="number")return e?o:[];for(var t=[],n=0;n<o.length;n++)e[n]&&t.push(o[n]);return t},minMaxWS=function(o,e,t,n,r,s){var a=e,h=a.getWeightedSum(t,n),c=r&&r.formula,d=c||Logic.weightedSum(t,n),y=r&&r.progress,g=r&&r.strategy,D=null;if(s&&h>0){y&&y("trying",0);var O=null;D=getNonZeroWeightedTerms(t,n);var O=o.solveAssuming(Logic.not(Logic.or(D)));O&&(a=O,h=0)}if(s&&g==="bottom-up")for(var V=1;V<h;V++){y&&y("trying",V);var k=Logic.equalBits(d,Logic.constantBits(V)),M=o.solveAssuming(k);if(M){a=M,h=V;break}}else{if(g&&g!=="default")throw new Error("Bad strategy: "+g);g="default"}if(g==="default")for(;!s||h>0;){y&&y("improving",h);var N=(s?Logic.lessThan:Logic.greaterThan)(d,Logic.constantBits(h)),M=o.solveAssuming(N);if(!M)break;o.require(N),a=M,h=a.getWeightedSum(t,n)}return s&&h===0?(D||(D=getNonZeroWeightedTerms(t,n)),o.forbid(D)):o.require(Logic.equalBits(d,Logic.constantBits(h))),y&&y("finished",h),a};Logic.Solver.prototype.minimizeWeightedSum=function(o,e,t,n){return minMaxWS(this,o,e,t,n,!0)};Logic.Solver.prototype.maximizeWeightedSum=function(o,e,t,n){return minMaxWS(this,o,e,t,n,!1)};const Logic$1=Logic;class MultipleSolutionsError extends Error{constructor(e){super("Multiple solutions found"),this.solutionEdges=e}}class MaximumSolverIterationsError extends Error{constructor(){super("Too many iterations!")}}const getSolvedPuzzle=(o,e,t)=>{const n=e.clone();for(const r of t)n.setEdgeState(r,EdgeState.BLACK);return finalStateSolve(o,n),{board:o,cleanState:e,solvedState:n,blackEdges:new Set(t)}},getSolvablePropertyPuzzle=(o,e)=>{try{if(simpleRegionIsSolved(e))return{board:o,stateProperty:new Property(e),solution:getSolvedPuzzle(o,e,[])};const t=satSolve(o,e,{maxIterations:1e4,failOnMultipleSolutions:!0});if(t.length!==1)return null;const n=t[0],r=e.clone();for(const s of n)r.setEdgeState(s,EdgeState.BLACK);return finalStateSolve(o,r),assertEnabled()&&assert$2(simpleRegionIsSolved(r)),{board:o,stateProperty:new Property(e),solution:getSolvedPuzzle(o,e,n)}}catch(t){if(t instanceof MultipleSolutionsError)return null;throw t}},satSolve=(o,e,t)=>{const n=o.edges.filter(J=>e.getEdgeState(J)===EdgeState.BLACK),r=o.edges.filter(J=>e.getEdgeState(J)===EdgeState.WHITE);assertEnabled()&&assert$2(r.length,"Need to have at least some undefined edges to use solver");const s=new Set(r),a=new Map(r.map((J,oe)=>[J,`edge${oe+1}`])),h=new Map(r.map((J,oe)=>[`edge${oe+1}`,J])),c=new Logic$1.Solver,d=J=>{const oe=a.get(J);return assertEnabled()&&assert$2(oe!==void 0,"Edge not found!"),oe},y=J=>`-${d(J)}`,g=J=>{for(const oe of J)c.require(Logic$1.not(d(oe)))},D=J=>{c.require(Logic$1.or(...J.map(d)))},O=J=>{c.require(Logic$1.or(...J.map(y)))},V=(J,oe)=>{oe>0&&(D(J),Combination.forEachCombination(J,le=>{le.length===J.length-oe+1&&c.require(Logic$1.not(Logic$1.and(...le.map(y))))}))},k=(J,oe)=>{Combination.forEachCombination(J,le=>{le.length===oe+1&&c.require(Logic$1.or(...le.map(y)))})},M=J=>{c.require(Logic$1.not(Logic$1.exactlyOne(...J.map(d))))},N=J=>{k(J,2),M(J)},F=(J,oe)=>{oe===0?g(J):(V(J,oe),k(J,oe))};D(r);for(const J of o.vertices){let oe=0,le=0,pe=[];for(const ve of J.edges){const Oe=e.getEdgeState(ve);Oe===EdgeState.BLACK?oe++:Oe===EdgeState.WHITE&&(le++,pe.push(ve))}le!==0&&(oe===0?N(pe):oe===1?F(pe,1):g(pe))}let G=!1;for(const J of o.faces){const oe=e.getFaceValue(J);if(oe===null)continue;G=!0;let le=0,pe=0,ve=[];for(const He of J.edges){const Ue=e.getEdgeState(He);Ue===EdgeState.BLACK?le++:Ue===EdgeState.WHITE&&(pe++,ve.push(He))}if(pe===0)continue;const Oe=Math.max(oe-le,0);F(ve,Oe)}assertEnabled()&&assert$2(G,"No faces with values!");const ie=()=>{let J=null;return Logic$1.disablingAssertions(()=>{J=c.solve()}),J?J.getTrueVars().map(le=>h.get(le)):null};let Z=0;const W=()=>{const J=ie();if(J===null)return{touchingValueLoops:[],nonTouchingValueLoops:[]};const oe=new Set([...J,...n]),le=[],pe=[];for(;oe.size;){const ve=oe.values().next().value,Oe=[];let He=ve.end,Ue=ve,Le=!1;for(;Ue;)oe.delete(Ue),Oe.push(Ue),Le=Le||Ue.faces.some(Ae=>e.getFaceValue(Ae)!==null),Ue=He.edges.find(Ae=>oe.has(Ae))??null,Ue&&(He=Ue.getOtherVertex(He));assertEnabled()&&assert$2(Oe[0].vertices.some(Ae=>Oe[Oe.length-1].vertices.includes(Ae)),"Loop is not a loop!"),(Le?le:pe).push(Oe)}return{touchingValueLoops:le,nonTouchingValueLoops:pe}},X=[];for(;;){const J=W();if(!J.touchingValueLoops.length)break;if(J.touchingValueLoops.length===1&&(X.push(J.touchingValueLoops[0]),X.length>1&&t.failOnMultipleSolutions))throw new MultipleSolutionsError(X);const oe=[...J.touchingValueLoops,...J.nonTouchingValueLoops];for(const le of oe)O(le.filter(pe=>s.has(pe)));if(Z++,Z>t.maxIterations)throw new MaximumSolverIterationsError}return X},getCoordinateClusteredMap=(o,e)=>{const t=_$1.sortBy(o),n=[];let r=[];for(let a=0;a<t.length;a++){const h=t[a];r.length===0||Math.abs(r[r.length-1]-h)<=e?r.push(h):(n.push(r),r=[h])}r.length>0&&n.push(r);const s=new Map;return n.forEach(a=>{const h=_$1.sum(a)/a.length;a.forEach(c=>s.set(c,h))}),s};export{RichText as $,AnimatedPanZoomListener as A,BaseBoard as B,CompleteData as C,DynamicProperty as D,EdgeState as E,Font as F,satSolve as G,HBox as H,Image$1 as I,MultipleSolutionsError as J,InvalidStateError as K,Line as L,Multilink as M,Node$2 as N,HexagonalBoard as O,Path as P,finalStateSolve as Q,Rectangle as R,Sizable as S,Text as T,simpleRegionIsSolved as U,VBox as V,FireListener as W,LineStyles as X,Graph$1 as Y,DerivedProperty as Z,_$1 as _,assertEnabled as a,BooleanRoundToggleButton as a$,arrayDifference as a0,FaceColorState as a1,Color as a2,SectorState as a3,iterateSolverFactory as a4,safeSolverFactory as a5,FaceColorMakeSameAction as a6,getFaceColorPointer as a7,FaceColorMakeOppositeAction as a8,GridBox as a9,BaseEdge as aA,BaseFace as aB,BaseVertex as aC,sceneryPhet as aD,InstanceRegistry as aE,stepTimer as aF,PressListener as aG,Animation as aH,Easing as aI,ColorDef$1 as aJ,StringUtils as aK,DerivedStringProperty as aL,ValueChangeSoundPlayer as aM,WidthSizable as aN,PhetFont as aO,Slider as aP,NumberDisplay as aQ,ArrowButton as aR,nullSoundPlayer as aS,isWidthSizable as aT,extendsWidthSizable as aU,base64SoundToByteArray as aV,asyncLoader as aW,WrappedAudioBuffer as aX,phetAudioContext$1 as aY,SoundClipPlayer as aZ,tambo as a_,AlignGroup as aa,Circle as ab,PaintColorProperty as ac,LocalStorageProperty as ad,RectangularButton as ae,LocalStorageBooleanProperty as af,LocalStorageNumberProperty as ag,LocalStorageStringProperty as ah,SafeEdgeToSimpleRegionSolver as ai,SafeSolvedEdgeSolver as aj,SafeEdgeToFaceColorSolver as ak,SafeEdgeToSectorSolver as al,SafeEdgeSectorColorToVertexSolver as am,VertexColorToFaceSolver as an,CompositeSolver as ao,autoSolverFactoryProperty as ap,autoSolveToBlackProperty as aq,autoSolveSimpleLoopsProperty as ar,SimpleVertexSolver as as,SimpleFaceSolver as at,SimpleLoopSolver as au,StaticSectorSolver as av,SimpleFaceColorSolver as aw,LocalStorageEnumerationProperty as ax,VertexState as ay,BaseHalfEdge as az,assert$2 as b,SceneryPhetStrings as b0,KeyboardListener as b1,DragListener as b2,SoundClip as b3,soundManager as b4,GeneralFaceValueData as b5,GeneralEdgeStateData as b6,GeneralSimpleRegionData as b7,createBoardDescriptor as b8,StaticDoubleMinusOneFacesSolver as b9,autoSolveVertexToSectorsProperty as bA,autoSolveVertexToFaceColorProperty as bB,autoSolveFaceColorToRedProperty as bC,autoSolveFaceColorToBlackProperty as bD,autoSolveFaceColorParityToRedProperty as bE,autoSolveFaceColorParityToBlackProperty as bF,autoSolveFaceColorParityColorsProperty as bG,autoSolveFaceColorParityPartialReductionProperty as bH,autoSolveVertexColorToFaceProperty as bI,autoSolveFaceToRedProperty as bJ,autoSolveFaceToBlackProperty as bK,autoSolveFaceToSectorsProperty as bL,autoSolveFaceToFaceColorsProperty as bM,autoSolveEnabledProperty as bN,Checkbox as bO,getSolvedPuzzle as bP,MaximumSolverIterationsError as bQ,AquaRadioButtonGroup as bR,EdgeStateSetAction as bS,SectorStateSetAction as bT,AnnotatedAction as bU,CompositeAction as bV,UserLoadPuzzleAutoSolveAction as bW,withSolverFactory as bX,UserRequestSolveAction as bY,SimpleSectorSolver as ba,VertexToEdgeSolver as bb,VertexToSectorSolver as bc,FaceColorParitySolver as bd,VertexToFaceColorSolver as be,FaceToEdgeSolver as bf,FaceToSectorSolver as bg,FaceToFaceColorSolver as bh,FaceToVertexSolver as bi,Logic$1 as bj,rescaleProtoDescriptorMinimum as bk,VerticalAquaRadioButtonGroup as bl,OnOffSwitch as bm,RectangularRadioButtonGroup as bn,autoSolveSimpleVertexJointToRedProperty as bo,autoSolveSimpleVertexForcedLineToBlackProperty as bp,autoSolveSimpleVertexAlmostEmptyToRedProperty as bq,autoSolveSimpleFaceToRedProperty as br,autoSolveSimpleFaceToBlackProperty as bs,autoSolveSimpleLoopToRedProperty as bt,autoSolveSimpleLoopToBlackProperty as bu,autoSolveDoubleMinusOneFacesProperty as bv,autoSolveStaticFaceSectorProperty as bw,autoSolveSimpleSectorProperty as bx,autoSolveVertexToRedEdgeProperty as by,autoSolveVertexToBlackEdgeProperty as bz,getSignedArea as c,getSignedAreaDerivative as d,LinearGradient as e,RadialGradient as f,getCentroid as g,Shape$1 as h,BooleanProperty as i,BasicPuzzle as j,HSeparator as k,TextPushButton as l,RectangularPushButton as m,SlitherQueryParameters as n,getSolvablePropertyPuzzle as o,Panel as p,Display as q,AlignBox as r,ManualConstraint as s,platform as t,StringProperty as u,validateBoard as v,NumberProperty as w,PatternStringProperty as x,getCoordinateClusteredMap as y,SquareBoard as z};
