var N0=Object.defineProperty;var B0=(a,t,s)=>t in a?N0(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s;var gt=(a,t,s)=>(B0(a,typeof t!="symbol"?t+"":t,s),s);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function s(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(o){if(o.ep)return;o.ep=!0;const n=s(o);fetch(o.href,n)}})();var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function getAugmentedNamespace(a){if(a.__esModule)return a;var t=a.default;if(typeof t=="function"){var s=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};s.prototype=t.prototype}else s={};return Object.defineProperty(s,"__esModule",{value:!0}),Object.keys(a).forEach(function(r){var o=Object.getOwnPropertyDescriptor(a,r);Object.defineProperty(s,r,o.get?o:{enumerable:!0,get:function(){return a[r]}})}),s}/*!
 * jQuery JavaScript Library v2.1.0
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright 2005, 2014 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2014-01-23T21:10Z
 */(function(a){(function(t,s){window.$=t.document?s(t,!0):function(r){if(!r.document)throw new Error("jQuery requires a window with a document");return s(r)}})(typeof window<"u"?window:commonjsGlobal,function(t,s){var r=[],o=r.slice,n=r.concat,l=r.push,h=r.indexOf,g={},d=g.toString,A=g.hasOwnProperty,S="".trim,O={},I=t.document,W="2.1.0",L=function(V,j){return new L.fn.init(V,j)},H=/^-ms-/,Y=/-([\da-z])/gi,Q=function(V,j){return j.toUpperCase()};L.fn=L.prototype={jquery:W,constructor:L,selector:"",length:0,toArray:function(){return o.call(this)},get:function(V){return V!=null?V<0?this[V+this.length]:this[V]:o.call(this)},pushStack:function(V){var j=L.merge(this.constructor(),V);return j.prevObject=this,j.context=this.context,j},each:function(V,j){return L.each(this,V,j)},map:function(V){return this.pushStack(L.map(this,function(j,se){return V.call(j,se,j)}))},slice:function(){return this.pushStack(o.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(V){var j=this.length,se=+V+(V<0?j:0);return this.pushStack(se>=0&&se<j?[this[se]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:l,sort:r.sort,splice:r.splice},L.extend=L.fn.extend=function(){var V,j,se,le,Pe,De,$e=arguments[0]||{},st=1,At=arguments.length,Dt=!1;for(typeof $e=="boolean"&&(Dt=$e,$e=arguments[st]||{},st++),typeof $e!="object"&&!L.isFunction($e)&&($e={}),st===At&&($e=this,st--);st<At;st++)if((V=arguments[st])!=null)for(j in V)se=$e[j],le=V[j],$e!==le&&(Dt&&le&&(L.isPlainObject(le)||(Pe=L.isArray(le)))?(Pe?(Pe=!1,De=se&&L.isArray(se)?se:[]):De=se&&L.isPlainObject(se)?se:{},$e[j]=L.extend(Dt,De,le)):le!==void 0&&($e[j]=le));return $e},L.extend({expando:"jQuery"+(W+Math.random()).replace(/\D/g,""),isReady:!0,error:function(V){throw new Error(V)},noop:function(){},isFunction:function(V){return L.type(V)==="function"},isArray:Array.isArray,isWindow:function(V){return V!=null&&V===V.window},isNumeric:function(V){return V-parseFloat(V)>=0},isPlainObject:function(V){if(L.type(V)!=="object"||V.nodeType||L.isWindow(V))return!1;try{if(V.constructor&&!A.call(V.constructor.prototype,"isPrototypeOf"))return!1}catch{return!1}return!0},isEmptyObject:function(V){var j;for(j in V)return!1;return!0},type:function(V){return V==null?V+"":typeof V=="object"||typeof V=="function"?g[d.call(V)]||"object":typeof V},globalEval:function(V){var j,se=eval;V=L.trim(V),V&&(V.indexOf("use strict")===1?(j=I.createElement("script"),j.text=V,I.head.appendChild(j).parentNode.removeChild(j)):se(V))},camelCase:function(V){return V.replace(H,"ms-").replace(Y,Q)},nodeName:function(V,j){return V.nodeName&&V.nodeName.toLowerCase()===j.toLowerCase()},each:function(V,j,se){var le,Pe=0,De=V.length,$e=pe(V);if(se){if($e)for(;Pe<De&&(le=j.apply(V[Pe],se),le!==!1);Pe++);else for(Pe in V)if(le=j.apply(V[Pe],se),le===!1)break}else if($e)for(;Pe<De&&(le=j.call(V[Pe],Pe,V[Pe]),le!==!1);Pe++);else for(Pe in V)if(le=j.call(V[Pe],Pe,V[Pe]),le===!1)break;return V},trim:function(V){return V==null?"":S.call(V)},makeArray:function(V,j){var se=j||[];return V!=null&&(pe(Object(V))?L.merge(se,typeof V=="string"?[V]:V):l.call(se,V)),se},inArray:function(V,j,se){return j==null?-1:h.call(j,V,se)},merge:function(V,j){for(var se=+j.length,le=0,Pe=V.length;le<se;le++)V[Pe++]=j[le];return V.length=Pe,V},grep:function(V,j,se){for(var le,Pe=[],De=0,$e=V.length,st=!se;De<$e;De++)le=!j(V[De],De),le!==st&&Pe.push(V[De]);return Pe},map:function(V,j,se){var le,Pe=0,De=V.length,$e=pe(V),st=[];if($e)for(;Pe<De;Pe++)le=j(V[Pe],Pe,se),le!=null&&st.push(le);else for(Pe in V)le=j(V[Pe],Pe,se),le!=null&&st.push(le);return n.apply([],st)},guid:1,proxy:function(V,j){var se,le,Pe;if(typeof j=="string"&&(se=V[j],j=V,V=se),!!L.isFunction(V))return le=o.call(arguments,2),Pe=function(){return V.apply(j||this,le.concat(o.call(arguments)))},Pe.guid=V.guid=V.guid||L.guid++,Pe},now:Date.now,support:O}),L.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(V,j){g["[object "+j+"]"]=j.toLowerCase()});function pe(V){var j=V.length,se=L.type(V);return se==="function"||L.isWindow(V)?!1:V.nodeType===1&&j?!0:se==="array"||j===0||typeof j=="number"&&j>0&&j-1 in V}var de=function(V){var j,se,le,Pe,De,$e,st,At,Dt,St,Jt,ti,fi,zi,Zi,Ms,On,ps="sizzle"+-new Date,hs=V.document,Ni=0,Ys=0,Xi=io(),Is=io(),$s=io(),Dr=function(Ue,ot){return Ue===ot&&(Dt=!0),0},pn="undefined",Zn=1<<31,Qn={}.hasOwnProperty,cn=[],fr=cn.pop,Zs=cn.push,gr=cn.push,gn=cn.slice,xr=cn.indexOf||function(Ue){for(var ot=0,vt=this.length;ot<vt;ot++)if(this[ot]===Ue)return ot;return-1},dn="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",Ps="[\\x20\\t\\r\\n\\f]",Ir="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",Fn=Ir.replace("w","w#"),mo="\\["+Ps+"*("+Ir+")"+Ps+"*(?:([*^$|!~]?=)"+Ps+`*(?:(['"])((?:\\\\.|[^\\\\])*?)\\3|(`+Fn+")|)|)"+Ps+"*\\]",Kr=":("+Ir+`)(?:\\(((['"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|`+mo.replace(3,8)+")*)|.*)\\)|)",Ls=new RegExp("^"+Ps+"+|((?:^|[^\\\\])(?:\\\\.)*)"+Ps+"+$","g"),Vr=new RegExp("^"+Ps+"*,"+Ps+"*"),yo=new RegExp("^"+Ps+"*([>+~]|"+Ps+")"+Ps+"*"),ra=new RegExp("="+Ps+`*([^\\]'"]*?)`+Ps+"*\\]","g"),oa=new RegExp(Kr),fl=new RegExp("^"+Fn+"$"),Oo={ID:new RegExp("^#("+Ir+")"),CLASS:new RegExp("^\\.("+Ir+")"),TAG:new RegExp("^("+Ir.replace("w","w*")+")"),ATTR:new RegExp("^"+mo),PSEUDO:new RegExp("^"+Kr),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+Ps+"*(even|odd|(([+-]|)(\\d*)n|)"+Ps+"*(?:([+-]|)"+Ps+"*(\\d+)|))"+Ps+"*\\)|)","i"),bool:new RegExp("^(?:"+dn+")$","i"),needsContext:new RegExp("^"+Ps+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+Ps+"*((?:-\\d)?\\d*)"+Ps+"*\\)|)(?=[^-]|$)","i")},gl=/^(?:input|select|textarea|button)$/i,$a=/^h\d$/i,Or=/^[^{]+\{\s*\[native \w/,Xr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,aa=/[+~]/,la=/'|\\/g,mr=new RegExp("\\\\([\\da-f]{1,6}"+Ps+"?|("+Ps+")|.)","ig"),qn=function(Ue,ot,vt){var Bt="0x"+ot-65536;return Bt!==Bt||vt?ot:Bt<0?String.fromCharCode(Bt+65536):String.fromCharCode(Bt>>10|55296,Bt&1023|56320)};try{gr.apply(cn=gn.call(hs.childNodes),hs.childNodes),cn[hs.childNodes.length].nodeType}catch{gr={apply:cn.length?function(ot,vt){Zs.apply(ot,gn.call(vt))}:function(ot,vt){for(var Bt=ot.length,xt=0;ot[Bt++]=vt[xt++];);ot.length=Bt-1}}}function Es(Ue,ot,vt,Bt){var xt,Wt,Ut,ui,Di,Yi,Ui,Bi,ms,ct;if((ot?ot.ownerDocument||ot:hs)!==Jt&&St(ot),ot=ot||Jt,vt=vt||[],!Ue||typeof Ue!="string")return vt;if((ui=ot.nodeType)!==1&&ui!==9)return[];if(fi&&!Bt){if(xt=Xr.exec(Ue))if(Ut=xt[1]){if(ui===9)if(Wt=ot.getElementById(Ut),Wt&&Wt.parentNode){if(Wt.id===Ut)return vt.push(Wt),vt}else return vt;else if(ot.ownerDocument&&(Wt=ot.ownerDocument.getElementById(Ut))&&On(ot,Wt)&&Wt.id===Ut)return vt.push(Wt),vt}else{if(xt[2])return gr.apply(vt,ot.getElementsByTagName(Ue)),vt;if((Ut=xt[3])&&se.getElementsByClassName&&ot.getElementsByClassName)return gr.apply(vt,ot.getElementsByClassName(Ut)),vt}if(se.qsa&&(!zi||!zi.test(Ue))){if(Bi=Ui=ps,ms=ot,ct=ui===9&&Ue,ui===1&&ot.nodeName.toLowerCase()!=="object"){for(Yi=ko(Ue),(Ui=ot.getAttribute("id"))?Bi=Ui.replace(la,"\\$&"):ot.setAttribute("id",Bi),Bi="[id='"+Bi+"'] ",Di=Yi.length;Di--;)Yi[Di]=Bi+Ro(Yi[Di]);ms=aa.test(Ue)&&Mo(ot.parentNode)||ot,ct=Yi.join(",")}if(ct)try{return gr.apply(vt,ms.querySelectorAll(ct)),vt}catch{}finally{Ui||ot.removeAttribute("id")}}}return ga(Ue.replace(Ls,"$1"),ot,vt,Bt)}function io(){var Ue=[];function ot(vt,Bt){return Ue.push(vt+" ")>le.cacheLength&&delete ot[Ue.shift()],ot[vt+" "]=Bt}return ot}function Hn(Ue){return Ue[ps]=!0,Ue}function yn(Ue){var ot=Jt.createElement("div");try{return!!Ue(ot)}catch{return!1}finally{ot.parentNode&&ot.parentNode.removeChild(ot),ot=null}}function yr(Ue,ot){for(var vt=Ue.split("|"),Bt=Ue.length;Bt--;)le.attrHandle[vt[Bt]]=ot}function zn(Ue,ot){var vt=ot&&Ue,Bt=vt&&Ue.nodeType===1&&ot.nodeType===1&&(~ot.sourceIndex||Zn)-(~Ue.sourceIndex||Zn);if(Bt)return Bt;if(vt){for(;vt=vt.nextSibling;)if(vt===ot)return-1}return Ue?1:-1}function Ln(Ue){return function(ot){var vt=ot.nodeName.toLowerCase();return vt==="input"&&ot.type===Ue}}function ha(Ue){return function(ot){var vt=ot.nodeName.toLowerCase();return(vt==="input"||vt==="button")&&ot.type===Ue}}function $n(Ue){return Hn(function(ot){return ot=+ot,Hn(function(vt,Bt){for(var xt,Wt=Ue([],vt.length,ot),Ut=Wt.length;Ut--;)vt[xt=Wt[Ut]]&&(vt[xt]=!(Bt[xt]=vt[xt]))})})}function Mo(Ue){return Ue&&typeof Ue.getElementsByTagName!==pn&&Ue}se=Es.support={},De=Es.isXML=function(Ue){var ot=Ue&&(Ue.ownerDocument||Ue).documentElement;return ot?ot.nodeName!=="HTML":!1},St=Es.setDocument=function(Ue){var ot,vt=Ue?Ue.ownerDocument||Ue:hs,Bt=vt.defaultView;return vt===Jt||vt.nodeType!==9||!vt.documentElement?Jt:(Jt=vt,ti=vt.documentElement,fi=!De(vt),Bt&&Bt!==Bt.top&&(Bt.addEventListener?Bt.addEventListener("unload",function(){St()},!1):Bt.attachEvent&&Bt.attachEvent("onunload",function(){St()})),se.attributes=yn(function(xt){return xt.className="i",!xt.getAttribute("className")}),se.getElementsByTagName=yn(function(xt){return xt.appendChild(vt.createComment("")),!xt.getElementsByTagName("*").length}),se.getElementsByClassName=Or.test(vt.getElementsByClassName)&&yn(function(xt){return xt.innerHTML="<div class='a'></div><div class='a i'></div>",xt.firstChild.className="i",xt.getElementsByClassName("i").length===2}),se.getById=yn(function(xt){return ti.appendChild(xt).id=ps,!vt.getElementsByName||!vt.getElementsByName(ps).length}),se.getById?(le.find.ID=function(xt,Wt){if(typeof Wt.getElementById!==pn&&fi){var Ut=Wt.getElementById(xt);return Ut&&Ut.parentNode?[Ut]:[]}},le.filter.ID=function(xt){var Wt=xt.replace(mr,qn);return function(Ut){return Ut.getAttribute("id")===Wt}}):(delete le.find.ID,le.filter.ID=function(xt){var Wt=xt.replace(mr,qn);return function(Ut){var ui=typeof Ut.getAttributeNode!==pn&&Ut.getAttributeNode("id");return ui&&ui.value===Wt}}),le.find.TAG=se.getElementsByTagName?function(xt,Wt){if(typeof Wt.getElementsByTagName!==pn)return Wt.getElementsByTagName(xt)}:function(xt,Wt){var Ut,ui=[],Di=0,Yi=Wt.getElementsByTagName(xt);if(xt==="*"){for(;Ut=Yi[Di++];)Ut.nodeType===1&&ui.push(Ut);return ui}return Yi},le.find.CLASS=se.getElementsByClassName&&function(xt,Wt){if(typeof Wt.getElementsByClassName!==pn&&fi)return Wt.getElementsByClassName(xt)},Zi=[],zi=[],(se.qsa=Or.test(vt.querySelectorAll))&&(yn(function(xt){xt.innerHTML="<select t=''><option selected=''></option></select>",xt.querySelectorAll("[t^='']").length&&zi.push("[*^$]="+Ps+`*(?:''|"")`),xt.querySelectorAll("[selected]").length||zi.push("\\["+Ps+"*(?:value|"+dn+")"),xt.querySelectorAll(":checked").length||zi.push(":checked")}),yn(function(xt){var Wt=vt.createElement("input");Wt.setAttribute("type","hidden"),xt.appendChild(Wt).setAttribute("name","D"),xt.querySelectorAll("[name=d]").length&&zi.push("name"+Ps+"*[*^$|!~]?="),xt.querySelectorAll(":enabled").length||zi.push(":enabled",":disabled"),xt.querySelectorAll("*,:x"),zi.push(",.*:")})),(se.matchesSelector=Or.test(Ms=ti.webkitMatchesSelector||ti.mozMatchesSelector||ti.oMatchesSelector||ti.msMatchesSelector))&&yn(function(xt){se.disconnectedMatch=Ms.call(xt,"div"),Ms.call(xt,"[s!='']:x"),Zi.push("!=",Kr)}),zi=zi.length&&new RegExp(zi.join("|")),Zi=Zi.length&&new RegExp(Zi.join("|")),ot=Or.test(ti.compareDocumentPosition),On=ot||Or.test(ti.contains)?function(xt,Wt){var Ut=xt.nodeType===9?xt.documentElement:xt,ui=Wt&&Wt.parentNode;return xt===ui||!!(ui&&ui.nodeType===1&&(Ut.contains?Ut.contains(ui):xt.compareDocumentPosition&&xt.compareDocumentPosition(ui)&16))}:function(xt,Wt){if(Wt){for(;Wt=Wt.parentNode;)if(Wt===xt)return!0}return!1},Dr=ot?function(xt,Wt){if(xt===Wt)return Dt=!0,0;var Ut=!xt.compareDocumentPosition-!Wt.compareDocumentPosition;return Ut||(Ut=(xt.ownerDocument||xt)===(Wt.ownerDocument||Wt)?xt.compareDocumentPosition(Wt):1,Ut&1||!se.sortDetached&&Wt.compareDocumentPosition(xt)===Ut?xt===vt||xt.ownerDocument===hs&&On(hs,xt)?-1:Wt===vt||Wt.ownerDocument===hs&&On(hs,Wt)?1:At?xr.call(At,xt)-xr.call(At,Wt):0:Ut&4?-1:1)}:function(xt,Wt){if(xt===Wt)return Dt=!0,0;var Ut,ui=0,Di=xt.parentNode,Yi=Wt.parentNode,Ui=[xt],Bi=[Wt];if(!Di||!Yi)return xt===vt?-1:Wt===vt?1:Di?-1:Yi?1:At?xr.call(At,xt)-xr.call(At,Wt):0;if(Di===Yi)return zn(xt,Wt);for(Ut=xt;Ut=Ut.parentNode;)Ui.unshift(Ut);for(Ut=Wt;Ut=Ut.parentNode;)Bi.unshift(Ut);for(;Ui[ui]===Bi[ui];)ui++;return ui?zn(Ui[ui],Bi[ui]):Ui[ui]===hs?-1:Bi[ui]===hs?1:0},vt)},Es.matches=function(Ue,ot){return Es(Ue,null,null,ot)},Es.matchesSelector=function(Ue,ot){if((Ue.ownerDocument||Ue)!==Jt&&St(Ue),ot=ot.replace(ra,"='$1']"),se.matchesSelector&&fi&&(!Zi||!Zi.test(ot))&&(!zi||!zi.test(ot)))try{var vt=Ms.call(Ue,ot);if(vt||se.disconnectedMatch||Ue.document&&Ue.document.nodeType!==11)return vt}catch{}return Es(ot,Jt,null,[Ue]).length>0},Es.contains=function(Ue,ot){return(Ue.ownerDocument||Ue)!==Jt&&St(Ue),On(Ue,ot)},Es.attr=function(Ue,ot){(Ue.ownerDocument||Ue)!==Jt&&St(Ue);var vt=le.attrHandle[ot.toLowerCase()],Bt=vt&&Qn.call(le.attrHandle,ot.toLowerCase())?vt(Ue,ot,!fi):void 0;return Bt!==void 0?Bt:se.attributes||!fi?Ue.getAttribute(ot):(Bt=Ue.getAttributeNode(ot))&&Bt.specified?Bt.value:null},Es.error=function(Ue){throw new Error("Syntax error, unrecognized expression: "+Ue)},Es.uniqueSort=function(Ue){var ot,vt=[],Bt=0,xt=0;if(Dt=!se.detectDuplicates,At=!se.sortStable&&Ue.slice(0),Ue.sort(Dr),Dt){for(;ot=Ue[xt++];)ot===Ue[xt]&&(Bt=vt.push(xt));for(;Bt--;)Ue.splice(vt[Bt],1)}return At=null,Ue},Pe=Es.getText=function(Ue){var ot,vt="",Bt=0,xt=Ue.nodeType;if(xt){if(xt===1||xt===9||xt===11){if(typeof Ue.textContent=="string")return Ue.textContent;for(Ue=Ue.firstChild;Ue;Ue=Ue.nextSibling)vt+=Pe(Ue)}else if(xt===3||xt===4)return Ue.nodeValue}else for(;ot=Ue[Bt++];)vt+=Pe(ot);return vt},le=Es.selectors={cacheLength:50,createPseudo:Hn,match:Oo,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(Ue){return Ue[1]=Ue[1].replace(mr,qn),Ue[3]=(Ue[4]||Ue[5]||"").replace(mr,qn),Ue[2]==="~="&&(Ue[3]=" "+Ue[3]+" "),Ue.slice(0,4)},CHILD:function(Ue){return Ue[1]=Ue[1].toLowerCase(),Ue[1].slice(0,3)==="nth"?(Ue[3]||Es.error(Ue[0]),Ue[4]=+(Ue[4]?Ue[5]+(Ue[6]||1):2*(Ue[3]==="even"||Ue[3]==="odd")),Ue[5]=+(Ue[7]+Ue[8]||Ue[3]==="odd")):Ue[3]&&Es.error(Ue[0]),Ue},PSEUDO:function(Ue){var ot,vt=!Ue[5]&&Ue[2];return Oo.CHILD.test(Ue[0])?null:(Ue[3]&&Ue[4]!==void 0?Ue[2]=Ue[4]:vt&&oa.test(vt)&&(ot=ko(vt,!0))&&(ot=vt.indexOf(")",vt.length-ot)-vt.length)&&(Ue[0]=Ue[0].slice(0,ot),Ue[2]=vt.slice(0,ot)),Ue.slice(0,3))}},filter:{TAG:function(Ue){var ot=Ue.replace(mr,qn).toLowerCase();return Ue==="*"?function(){return!0}:function(vt){return vt.nodeName&&vt.nodeName.toLowerCase()===ot}},CLASS:function(Ue){var ot=Xi[Ue+" "];return ot||(ot=new RegExp("(^|"+Ps+")"+Ue+"("+Ps+"|$)"))&&Xi(Ue,function(vt){return ot.test(typeof vt.className=="string"&&vt.className||typeof vt.getAttribute!==pn&&vt.getAttribute("class")||"")})},ATTR:function(Ue,ot,vt){return function(Bt){var xt=Es.attr(Bt,Ue);return xt==null?ot==="!=":ot?(xt+="",ot==="="?xt===vt:ot==="!="?xt!==vt:ot==="^="?vt&&xt.indexOf(vt)===0:ot==="*="?vt&&xt.indexOf(vt)>-1:ot==="$="?vt&&xt.slice(-vt.length)===vt:ot==="~="?(" "+xt+" ").indexOf(vt)>-1:ot==="|="?xt===vt||xt.slice(0,vt.length+1)===vt+"-":!1):!0}},CHILD:function(Ue,ot,vt,Bt,xt){var Wt=Ue.slice(0,3)!=="nth",Ut=Ue.slice(-4)!=="last",ui=ot==="of-type";return Bt===1&&xt===0?function(Di){return!!Di.parentNode}:function(Di,Yi,Ui){var Bi,ms,ct,Ot,It,li,xi=Wt!==Ut?"nextSibling":"previousSibling",Ii=Di.parentNode,Rs=ui&&Di.nodeName.toLowerCase(),ys=!Ui&&!ui;if(Ii){if(Wt){for(;xi;){for(ct=Di;ct=ct[xi];)if(ui?ct.nodeName.toLowerCase()===Rs:ct.nodeType===1)return!1;li=xi=Ue==="only"&&!li&&"nextSibling"}return!0}if(li=[Ut?Ii.firstChild:Ii.lastChild],Ut&&ys){for(ms=Ii[ps]||(Ii[ps]={}),Bi=ms[Ue]||[],It=Bi[0]===Ni&&Bi[1],Ot=Bi[0]===Ni&&Bi[2],ct=It&&Ii.childNodes[It];ct=++It&&ct&&ct[xi]||(Ot=It=0)||li.pop();)if(ct.nodeType===1&&++Ot&&ct===Di){ms[Ue]=[Ni,It,Ot];break}}else if(ys&&(Bi=(Di[ps]||(Di[ps]={}))[Ue])&&Bi[0]===Ni)Ot=Bi[1];else for(;(ct=++It&&ct&&ct[xi]||(Ot=It=0)||li.pop())&&!((ui?ct.nodeName.toLowerCase()===Rs:ct.nodeType===1)&&++Ot&&(ys&&((ct[ps]||(ct[ps]={}))[Ue]=[Ni,Ot]),ct===Di)););return Ot-=xt,Ot===Bt||Ot%Bt===0&&Ot/Bt>=0}}},PSEUDO:function(Ue,ot){var vt,Bt=le.pseudos[Ue]||le.setFilters[Ue.toLowerCase()]||Es.error("unsupported pseudo: "+Ue);return Bt[ps]?Bt(ot):Bt.length>1?(vt=[Ue,Ue,"",ot],le.setFilters.hasOwnProperty(Ue.toLowerCase())?Hn(function(xt,Wt){for(var Ut,ui=Bt(xt,ot),Di=ui.length;Di--;)Ut=xr.call(xt,ui[Di]),xt[Ut]=!(Wt[Ut]=ui[Di])}):function(xt){return Bt(xt,0,vt)}):Bt}},pseudos:{not:Hn(function(Ue){var ot=[],vt=[],Bt=$e(Ue.replace(Ls,"$1"));return Bt[ps]?Hn(function(xt,Wt,Ut,ui){for(var Di,Yi=Bt(xt,null,ui,[]),Ui=xt.length;Ui--;)(Di=Yi[Ui])&&(xt[Ui]=!(Wt[Ui]=Di))}):function(xt,Wt,Ut){return ot[0]=xt,Bt(ot,null,Ut,vt),!vt.pop()}}),has:Hn(function(Ue){return function(ot){return Es(Ue,ot).length>0}}),contains:Hn(function(Ue){return function(ot){return(ot.textContent||ot.innerText||Pe(ot)).indexOf(Ue)>-1}}),lang:Hn(function(Ue){return fl.test(Ue||"")||Es.error("unsupported lang: "+Ue),Ue=Ue.replace(mr,qn).toLowerCase(),function(ot){var vt;do if(vt=fi?ot.lang:ot.getAttribute("xml:lang")||ot.getAttribute("lang"))return vt=vt.toLowerCase(),vt===Ue||vt.indexOf(Ue+"-")===0;while((ot=ot.parentNode)&&ot.nodeType===1);return!1}}),target:function(Ue){var ot=V.location&&V.location.hash;return ot&&ot.slice(1)===Ue.id},root:function(Ue){return Ue===ti},focus:function(Ue){return Ue===Jt.activeElement&&(!Jt.hasFocus||Jt.hasFocus())&&!!(Ue.type||Ue.href||~Ue.tabIndex)},enabled:function(Ue){return Ue.disabled===!1},disabled:function(Ue){return Ue.disabled===!0},checked:function(Ue){var ot=Ue.nodeName.toLowerCase();return ot==="input"&&!!Ue.checked||ot==="option"&&!!Ue.selected},selected:function(Ue){return Ue.parentNode&&Ue.parentNode.selectedIndex,Ue.selected===!0},empty:function(Ue){for(Ue=Ue.firstChild;Ue;Ue=Ue.nextSibling)if(Ue.nodeType<6)return!1;return!0},parent:function(Ue){return!le.pseudos.empty(Ue)},header:function(Ue){return $a.test(Ue.nodeName)},input:function(Ue){return gl.test(Ue.nodeName)},button:function(Ue){var ot=Ue.nodeName.toLowerCase();return ot==="input"&&Ue.type==="button"||ot==="button"},text:function(Ue){var ot;return Ue.nodeName.toLowerCase()==="input"&&Ue.type==="text"&&((ot=Ue.getAttribute("type"))==null||ot.toLowerCase()==="text")},first:$n(function(){return[0]}),last:$n(function(Ue,ot){return[ot-1]}),eq:$n(function(Ue,ot,vt){return[vt<0?vt+ot:vt]}),even:$n(function(Ue,ot){for(var vt=0;vt<ot;vt+=2)Ue.push(vt);return Ue}),odd:$n(function(Ue,ot){for(var vt=1;vt<ot;vt+=2)Ue.push(vt);return Ue}),lt:$n(function(Ue,ot,vt){for(var Bt=vt<0?vt+ot:vt;--Bt>=0;)Ue.push(Bt);return Ue}),gt:$n(function(Ue,ot,vt){for(var Bt=vt<0?vt+ot:vt;++Bt<ot;)Ue.push(Bt);return Ue})}},le.pseudos.nth=le.pseudos.eq;for(j in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})le.pseudos[j]=Ln(j);for(j in{submit:!0,reset:!0})le.pseudos[j]=ha(j);function ca(){}ca.prototype=le.filters=le.pseudos,le.setFilters=new ca;function ko(Ue,ot){var vt,Bt,xt,Wt,Ut,ui,Di,Yi=Is[Ue+" "];if(Yi)return ot?0:Yi.slice(0);for(Ut=Ue,ui=[],Di=le.preFilter;Ut;){(!vt||(Bt=Vr.exec(Ut)))&&(Bt&&(Ut=Ut.slice(Bt[0].length)||Ut),ui.push(xt=[])),vt=!1,(Bt=yo.exec(Ut))&&(vt=Bt.shift(),xt.push({value:vt,type:Bt[0].replace(Ls," ")}),Ut=Ut.slice(vt.length));for(Wt in le.filter)(Bt=Oo[Wt].exec(Ut))&&(!Di[Wt]||(Bt=Di[Wt](Bt)))&&(vt=Bt.shift(),xt.push({value:vt,type:Wt,matches:Bt}),Ut=Ut.slice(vt.length));if(!vt)break}return ot?Ut.length:Ut?Es.error(Ue):Is(Ue,ui).slice(0)}function Ro(Ue){for(var ot=0,vt=Ue.length,Bt="";ot<vt;ot++)Bt+=Ue[ot].value;return Bt}function da(Ue,ot,vt){var Bt=ot.dir,xt=vt&&Bt==="parentNode",Wt=Ys++;return ot.first?function(Ut,ui,Di){for(;Ut=Ut[Bt];)if(Ut.nodeType===1||xt)return Ue(Ut,ui,Di)}:function(Ut,ui,Di){var Yi,Ui,Bi=[Ni,Wt];if(Di){for(;Ut=Ut[Bt];)if((Ut.nodeType===1||xt)&&Ue(Ut,ui,Di))return!0}else for(;Ut=Ut[Bt];)if(Ut.nodeType===1||xt){if(Ui=Ut[ps]||(Ut[ps]={}),(Yi=Ui[Bt])&&Yi[0]===Ni&&Yi[1]===Wt)return Bi[2]=Yi[2];if(Ui[Bt]=Bi,Bi[2]=Ue(Ut,ui,Di))return!0}}}function pa(Ue){return Ue.length>1?function(ot,vt,Bt){for(var xt=Ue.length;xt--;)if(!Ue[xt](ot,vt,Bt))return!1;return!0}:Ue[0]}function No(Ue,ot,vt,Bt,xt){for(var Wt,Ut=[],ui=0,Di=Ue.length,Yi=ot!=null;ui<Di;ui++)(Wt=Ue[ui])&&(!vt||vt(Wt,Bt,xt))&&(Ut.push(Wt),Yi&&ot.push(ui));return Ut}function Mr(Ue,ot,vt,Bt,xt,Wt){return Bt&&!Bt[ps]&&(Bt=Mr(Bt)),xt&&!xt[ps]&&(xt=Mr(xt,Wt)),Hn(function(Ut,ui,Di,Yi){var Ui,Bi,ms,ct=[],Ot=[],It=ui.length,li=Ut||Cn(ot||"*",Di.nodeType?[Di]:Di,[]),xi=Ue&&(Ut||!ot)?No(li,ct,Ue,Di,Yi):li,Ii=vt?xt||(Ut?Ue:It||Bt)?[]:ui:xi;if(vt&&vt(xi,Ii,Di,Yi),Bt)for(Ui=No(Ii,Ot),Bt(Ui,[],Di,Yi),Bi=Ui.length;Bi--;)(ms=Ui[Bi])&&(Ii[Ot[Bi]]=!(xi[Ot[Bi]]=ms));if(Ut){if(xt||Ue){if(xt){for(Ui=[],Bi=Ii.length;Bi--;)(ms=Ii[Bi])&&Ui.push(xi[Bi]=ms);xt(null,Ii=[],Ui,Yi)}for(Bi=Ii.length;Bi--;)(ms=Ii[Bi])&&(Ui=xt?xr.call(Ut,ms):ct[Bi])>-1&&(Ut[Ui]=!(ui[Ui]=ms))}}else Ii=No(Ii===ui?Ii.splice(It,Ii.length):Ii),xt?xt(null,ui,Ii,Yi):gr.apply(ui,Ii)})}function fa(Ue){for(var ot,vt,Bt,xt=Ue.length,Wt=le.relative[Ue[0].type],Ut=Wt||le.relative[" "],ui=Wt?1:0,Di=da(function(Bi){return Bi===ot},Ut,!0),Yi=da(function(Bi){return xr.call(ot,Bi)>-1},Ut,!0),Ui=[function(Bi,ms,ct){return!Wt&&(ct||ms!==st)||((ot=ms).nodeType?Di(Bi,ms,ct):Yi(Bi,ms,ct))}];ui<xt;ui++)if(vt=le.relative[Ue[ui].type])Ui=[da(pa(Ui),vt)];else{if(vt=le.filter[Ue[ui].type].apply(null,Ue[ui].matches),vt[ps]){for(Bt=++ui;Bt<xt&&!le.relative[Ue[Bt].type];Bt++);return Mr(ui>1&&pa(Ui),ui>1&&Ro(Ue.slice(0,ui-1).concat({value:Ue[ui-2].type===" "?"*":""})).replace(Ls,"$1"),vt,ui<Bt&&fa(Ue.slice(ui,Bt)),Bt<xt&&fa(Ue=Ue.slice(Bt)),Bt<xt&&Ro(Ue))}Ui.push(vt)}return pa(Ui)}function Ua(Ue,ot){var vt=ot.length>0,Bt=Ue.length>0,xt=function(Wt,Ut,ui,Di,Yi){var Ui,Bi,ms,ct=0,Ot="0",It=Wt&&[],li=[],xi=st,Ii=Wt||Bt&&le.find.TAG("*",Yi),Rs=Ni+=xi==null?1:Math.random()||.1,ys=Ii.length;for(Yi&&(st=Ut!==Jt&&Ut);Ot!==ys&&(Ui=Ii[Ot])!=null;Ot++){if(Bt&&Ui){for(Bi=0;ms=Ue[Bi++];)if(ms(Ui,Ut,ui)){Di.push(Ui);break}Yi&&(Ni=Rs)}vt&&((Ui=!ms&&Ui)&&ct--,Wt&&It.push(Ui))}if(ct+=Ot,vt&&Ot!==ct){for(Bi=0;ms=ot[Bi++];)ms(It,li,Ut,ui);if(Wt){if(ct>0)for(;Ot--;)It[Ot]||li[Ot]||(li[Ot]=fr.call(Di));li=No(li)}gr.apply(Di,li),Yi&&!Wt&&li.length>0&&ct+ot.length>1&&Es.uniqueSort(Di)}return Yi&&(Ni=Rs,st=xi),It};return vt?Hn(xt):xt}$e=Es.compile=function(Ue,ot){var vt,Bt=[],xt=[],Wt=$s[Ue+" "];if(!Wt){for(ot||(ot=ko(Ue)),vt=ot.length;vt--;)Wt=fa(ot[vt]),Wt[ps]?Bt.push(Wt):xt.push(Wt);Wt=$s(Ue,Ua(xt,Bt))}return Wt};function Cn(Ue,ot,vt){for(var Bt=0,xt=ot.length;Bt<xt;Bt++)Es(Ue,ot[Bt],vt);return vt}function ga(Ue,ot,vt,Bt){var xt,Wt,Ut,ui,Di,Yi=ko(Ue);if(!Bt&&Yi.length===1){if(Wt=Yi[0]=Yi[0].slice(0),Wt.length>2&&(Ut=Wt[0]).type==="ID"&&se.getById&&ot.nodeType===9&&fi&&le.relative[Wt[1].type]){if(ot=(le.find.ID(Ut.matches[0].replace(mr,qn),ot)||[])[0],!ot)return vt;Ue=Ue.slice(Wt.shift().value.length)}for(xt=Oo.needsContext.test(Ue)?0:Wt.length;xt--&&(Ut=Wt[xt],!le.relative[ui=Ut.type]);)if((Di=le.find[ui])&&(Bt=Di(Ut.matches[0].replace(mr,qn),aa.test(Wt[0].type)&&Mo(ot.parentNode)||ot))){if(Wt.splice(xt,1),Ue=Bt.length&&Ro(Wt),!Ue)return gr.apply(vt,Bt),vt;break}}return $e(Ue,Yi)(Bt,ot,!fi,vt,aa.test(Ue)&&Mo(ot.parentNode)||ot),vt}return se.sortStable=ps.split("").sort(Dr).join("")===ps,se.detectDuplicates=!!Dt,St(),se.sortDetached=yn(function(Ue){return Ue.compareDocumentPosition(Jt.createElement("div"))&1}),yn(function(Ue){return Ue.innerHTML="<a href='#'></a>",Ue.firstChild.getAttribute("href")==="#"})||yr("type|href|height|width",function(Ue,ot,vt){if(!vt)return Ue.getAttribute(ot,ot.toLowerCase()==="type"?1:2)}),(!se.attributes||!yn(function(Ue){return Ue.innerHTML="<input/>",Ue.firstChild.setAttribute("value",""),Ue.firstChild.getAttribute("value")===""}))&&yr("value",function(Ue,ot,vt){if(!vt&&Ue.nodeName.toLowerCase()==="input")return Ue.defaultValue}),yn(function(Ue){return Ue.getAttribute("disabled")==null})||yr(dn,function(Ue,ot,vt){var Bt;if(!vt)return Ue[ot]===!0?ot.toLowerCase():(Bt=Ue.getAttributeNode(ot))&&Bt.specified?Bt.value:null}),Es}(t);L.find=de,L.expr=de.selectors,L.expr[":"]=L.expr.pseudos,L.unique=de.uniqueSort,L.text=de.getText,L.isXMLDoc=de.isXML,L.contains=de.contains;var fe=L.expr.match.needsContext,ye=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,Ee=/^.[^:#\[\.,]*$/;function Le(V,j,se){if(L.isFunction(j))return L.grep(V,function(le,Pe){return!!j.call(le,Pe,le)!==se});if(j.nodeType)return L.grep(V,function(le){return le===j!==se});if(typeof j=="string"){if(Ee.test(j))return L.filter(j,V,se);j=L.filter(j,V)}return L.grep(V,function(le){return h.call(j,le)>=0!==se})}L.filter=function(V,j,se){var le=j[0];return se&&(V=":not("+V+")"),j.length===1&&le.nodeType===1?L.find.matchesSelector(le,V)?[le]:[]:L.find.matches(V,L.grep(j,function(Pe){return Pe.nodeType===1}))},L.fn.extend({find:function(V){var j,se=this.length,le=[],Pe=this;if(typeof V!="string")return this.pushStack(L(V).filter(function(){for(j=0;j<se;j++)if(L.contains(Pe[j],this))return!0}));for(j=0;j<se;j++)L.find(V,Pe[j],le);return le=this.pushStack(se>1?L.unique(le):le),le.selector=this.selector?this.selector+" "+V:V,le},filter:function(V){return this.pushStack(Le(this,V||[],!1))},not:function(V){return this.pushStack(Le(this,V||[],!0))},is:function(V){return!!Le(this,typeof V=="string"&&fe.test(V)?L(V):V||[],!1).length}});var Z,ne=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,Ke=L.fn.init=function(V,j){var se,le;if(!V)return this;if(typeof V=="string")if(V[0]==="<"&&V[V.length-1]===">"&&V.length>=3?se=[null,V,null]:se=ne.exec(V),se&&(se[1]||!j))if(se[1]){if(j=j instanceof L?j[0]:j,L.merge(this,L.parseHTML(se[1],j&&j.nodeType?j.ownerDocument||j:I,!0)),ye.test(se[1])&&L.isPlainObject(j))for(se in j)L.isFunction(this[se])?this[se](j[se]):this.attr(se,j[se]);return this}else return le=I.getElementById(se[2]),le&&le.parentNode&&(this.length=1,this[0]=le),this.context=I,this.selector=V,this;else return!j||j.jquery?(j||Z).find(V):this.constructor(j).find(V);else{if(V.nodeType)return this.context=this[0]=V,this.length=1,this;if(L.isFunction(V))return typeof Z.ready<"u"?Z.ready(V):V(L)}return V.selector!==void 0&&(this.selector=V.selector,this.context=V.context),L.makeArray(V,this)};Ke.prototype=L.fn,Z=L(I);var _t=/^(?:parents|prev(?:Until|All))/,xe={children:!0,contents:!0,next:!0,prev:!0};L.extend({dir:function(V,j,se){for(var le=[],Pe=se!==void 0;(V=V[j])&&V.nodeType!==9;)if(V.nodeType===1){if(Pe&&L(V).is(se))break;le.push(V)}return le},sibling:function(V,j){for(var se=[];V;V=V.nextSibling)V.nodeType===1&&V!==j&&se.push(V);return se}}),L.fn.extend({has:function(V){var j=L(V,this),se=j.length;return this.filter(function(){for(var le=0;le<se;le++)if(L.contains(this,j[le]))return!0})},closest:function(V,j){for(var se,le=0,Pe=this.length,De=[],$e=fe.test(V)||typeof V!="string"?L(V,j||this.context):0;le<Pe;le++)for(se=this[le];se&&se!==j;se=se.parentNode)if(se.nodeType<11&&($e?$e.index(se)>-1:se.nodeType===1&&L.find.matchesSelector(se,V))){De.push(se);break}return this.pushStack(De.length>1?L.unique(De):De)},index:function(V){return V?typeof V=="string"?h.call(L(V),this[0]):h.call(this,V.jquery?V[0]:V):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(V,j){return this.pushStack(L.unique(L.merge(this.get(),L(V,j))))},addBack:function(V){return this.add(V==null?this.prevObject:this.prevObject.filter(V))}});function Ct(V,j){for(;(V=V[j])&&V.nodeType!==1;);return V}L.each({parent:function(V){var j=V.parentNode;return j&&j.nodeType!==11?j:null},parents:function(V){return L.dir(V,"parentNode")},parentsUntil:function(V,j,se){return L.dir(V,"parentNode",se)},next:function(V){return Ct(V,"nextSibling")},prev:function(V){return Ct(V,"previousSibling")},nextAll:function(V){return L.dir(V,"nextSibling")},prevAll:function(V){return L.dir(V,"previousSibling")},nextUntil:function(V,j,se){return L.dir(V,"nextSibling",se)},prevUntil:function(V,j,se){return L.dir(V,"previousSibling",se)},siblings:function(V){return L.sibling((V.parentNode||{}).firstChild,V)},children:function(V){return L.sibling(V.firstChild)},contents:function(V){return V.contentDocument||L.merge([],V.childNodes)}},function(V,j){L.fn[V]=function(se,le){var Pe=L.map(this,j,se);return V.slice(-5)!=="Until"&&(le=se),le&&typeof le=="string"&&(Pe=L.filter(le,Pe)),this.length>1&&(xe[V]||L.unique(Pe),_t.test(V)&&Pe.reverse()),this.pushStack(Pe)}});var zt=/\S+/g,Je={};function Et(V){var j=Je[V]={};return L.each(V.match(zt)||[],function(se,le){j[le]=!0}),j}L.Callbacks=function(V){V=typeof V=="string"?Je[V]||Et(V):L.extend({},V);var j,se,le,Pe,De,$e,st=[],At=!V.once&&[],Dt=function(Jt){for(j=V.memory&&Jt,se=!0,$e=Pe||0,Pe=0,De=st.length,le=!0;st&&$e<De;$e++)if(st[$e].apply(Jt[0],Jt[1])===!1&&V.stopOnFalse){j=!1;break}le=!1,st&&(At?At.length&&Dt(At.shift()):j?st=[]:St.disable())},St={add:function(){if(st){var Jt=st.length;(function ti(fi){L.each(fi,function(zi,Zi){var Ms=L.type(Zi);Ms==="function"?(!V.unique||!St.has(Zi))&&st.push(Zi):Zi&&Zi.length&&Ms!=="string"&&ti(Zi)})})(arguments),le?De=st.length:j&&(Pe=Jt,Dt(j))}return this},remove:function(){return st&&L.each(arguments,function(Jt,ti){for(var fi;(fi=L.inArray(ti,st,fi))>-1;)st.splice(fi,1),le&&(fi<=De&&De--,fi<=$e&&$e--)}),this},has:function(Jt){return Jt?L.inArray(Jt,st)>-1:!!(st&&st.length)},empty:function(){return st=[],De=0,this},disable:function(){return st=At=j=void 0,this},disabled:function(){return!st},lock:function(){return At=void 0,j||St.disable(),this},locked:function(){return!At},fireWith:function(Jt,ti){return st&&(!se||At)&&(ti=ti||[],ti=[Jt,ti.slice?ti.slice():ti],le?At.push(ti):Dt(ti)),this},fire:function(){return St.fireWith(this,arguments),this},fired:function(){return!!se}};return St},L.extend({Deferred:function(V){var j=[["resolve","done",L.Callbacks("once memory"),"resolved"],["reject","fail",L.Callbacks("once memory"),"rejected"],["notify","progress",L.Callbacks("memory")]],se="pending",le={state:function(){return se},always:function(){return Pe.done(arguments).fail(arguments),this},then:function(){var De=arguments;return L.Deferred(function($e){L.each(j,function(st,At){var Dt=L.isFunction(De[st])&&De[st];Pe[At[1]](function(){var St=Dt&&Dt.apply(this,arguments);St&&L.isFunction(St.promise)?St.promise().done($e.resolve).fail($e.reject).progress($e.notify):$e[At[0]+"With"](this===le?$e.promise():this,Dt?[St]:arguments)})}),De=null}).promise()},promise:function(De){return De!=null?L.extend(De,le):le}},Pe={};return le.pipe=le.then,L.each(j,function(De,$e){var st=$e[2],At=$e[3];le[$e[1]]=st.add,At&&st.add(function(){se=At},j[De^1][2].disable,j[2][2].lock),Pe[$e[0]]=function(){return Pe[$e[0]+"With"](this===Pe?le:this,arguments),this},Pe[$e[0]+"With"]=st.fireWith}),le.promise(Pe),V&&V.call(Pe,Pe),Pe},when:function(V){var j=0,se=o.call(arguments),le=se.length,Pe=le!==1||V&&L.isFunction(V.promise)?le:0,De=Pe===1?V:L.Deferred(),$e=function(St,Jt,ti){return function(fi){Jt[St]=this,ti[St]=arguments.length>1?o.call(arguments):fi,ti===st?De.notifyWith(Jt,ti):--Pe||De.resolveWith(Jt,ti)}},st,At,Dt;if(le>1)for(st=new Array(le),At=new Array(le),Dt=new Array(le);j<le;j++)se[j]&&L.isFunction(se[j].promise)?se[j].promise().done($e(j,Dt,se)).fail(De.reject).progress($e(j,At,st)):--Pe;return Pe||De.resolveWith(Dt,se),De.promise()}});var ht;L.fn.ready=function(V){return L.ready.promise().done(V),this},L.extend({isReady:!1,readyWait:1,holdReady:function(V){V?L.readyWait++:L.ready(!0)},ready:function(V){(V===!0?--L.readyWait:L.isReady)||(L.isReady=!0,!(V!==!0&&--L.readyWait>0)&&(ht.resolveWith(I,[L]),L.fn.trigger&&L(I).trigger("ready").off("ready")))}});function mt(){I.removeEventListener("DOMContentLoaded",mt,!1),t.removeEventListener("load",mt,!1),L.ready()}L.ready.promise=function(V){return ht||(ht=L.Deferred(),I.readyState==="complete"?setTimeout(L.ready):(I.addEventListener("DOMContentLoaded",mt,!1),t.addEventListener("load",mt,!1))),ht.promise(V)},L.ready.promise();var Nt=L.access=function(V,j,se,le,Pe,De,$e){var st=0,At=V.length,Dt=se==null;if(L.type(se)==="object"){Pe=!0;for(st in se)L.access(V,j,st,se[st],!0,De,$e)}else if(le!==void 0&&(Pe=!0,L.isFunction(le)||($e=!0),Dt&&($e?(j.call(V,le),j=null):(Dt=j,j=function(St,Jt,ti){return Dt.call(L(St),ti)})),j))for(;st<At;st++)j(V[st],se,$e?le:le.call(V[st],st,j(V[st],se)));return Pe?V:Dt?j.call(V):At?j(V[0],se):De};L.acceptData=function(V){return V.nodeType===1||V.nodeType===9||!+V.nodeType};function Gt(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=L.expando+Math.random()}Gt.uid=1,Gt.accepts=L.acceptData,Gt.prototype={key:function(V){if(!Gt.accepts(V))return 0;var j={},se=V[this.expando];if(!se){se=Gt.uid++;try{j[this.expando]={value:se},Object.defineProperties(V,j)}catch{j[this.expando]=se,L.extend(V,j)}}return this.cache[se]||(this.cache[se]={}),se},set:function(V,j,se){var le,Pe=this.key(V),De=this.cache[Pe];if(typeof j=="string")De[j]=se;else if(L.isEmptyObject(De))L.extend(this.cache[Pe],j);else for(le in j)De[le]=j[le];return De},get:function(V,j){var se=this.cache[this.key(V)];return j===void 0?se:se[j]},access:function(V,j,se){var le;return j===void 0||j&&typeof j=="string"&&se===void 0?(le=this.get(V,j),le!==void 0?le:this.get(V,L.camelCase(j))):(this.set(V,j,se),se!==void 0?se:j)},remove:function(V,j){var se,le,Pe,De=this.key(V),$e=this.cache[De];if(j===void 0)this.cache[De]={};else for(L.isArray(j)?le=j.concat(j.map(L.camelCase)):(Pe=L.camelCase(j),j in $e?le=[j,Pe]:(le=Pe,le=le in $e?[le]:le.match(zt)||[])),se=le.length;se--;)delete $e[le[se]]},hasData:function(V){return!L.isEmptyObject(this.cache[V[this.expando]]||{})},discard:function(V){V[this.expando]&&delete this.cache[V[this.expando]]}};var Mt=new Gt,jt=new Gt,Ai=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,oi=/([A-Z])/g;function ki(V,j,se){var le;if(se===void 0&&V.nodeType===1)if(le="data-"+j.replace(oi,"-$1").toLowerCase(),se=V.getAttribute(le),typeof se=="string"){try{se=se==="true"?!0:se==="false"?!1:se==="null"?null:+se+""===se?+se:Ai.test(se)?L.parseJSON(se):se}catch{}jt.set(V,j,se)}else se=void 0;return se}L.extend({hasData:function(V){return jt.hasData(V)||Mt.hasData(V)},data:function(V,j,se){return jt.access(V,j,se)},removeData:function(V,j){jt.remove(V,j)},_data:function(V,j,se){return Mt.access(V,j,se)},_removeData:function(V,j){Mt.remove(V,j)}}),L.fn.extend({data:function(V,j){var se,le,Pe,De=this[0],$e=De&&De.attributes;if(V===void 0){if(this.length&&(Pe=jt.get(De),De.nodeType===1&&!Mt.get(De,"hasDataAttrs"))){for(se=$e.length;se--;)le=$e[se].name,le.indexOf("data-")===0&&(le=L.camelCase(le.slice(5)),ki(De,le,Pe[le]));Mt.set(De,"hasDataAttrs",!0)}return Pe}return typeof V=="object"?this.each(function(){jt.set(this,V)}):Nt(this,function(st){var At,Dt=L.camelCase(V);if(De&&st===void 0)return At=jt.get(De,V),At!==void 0||(At=jt.get(De,Dt),At!==void 0)||(At=ki(De,Dt,void 0),At!==void 0)?At:void 0;this.each(function(){var St=jt.get(this,Dt);jt.set(this,Dt,st),V.indexOf("-")!==-1&&St!==void 0&&jt.set(this,V,st)})},null,j,arguments.length>1,null,!0)},removeData:function(V){return this.each(function(){jt.remove(this,V)})}}),L.extend({queue:function(V,j,se){var le;if(V)return j=(j||"fx")+"queue",le=Mt.get(V,j),se&&(!le||L.isArray(se)?le=Mt.access(V,j,L.makeArray(se)):le.push(se)),le||[]},dequeue:function(V,j){j=j||"fx";var se=L.queue(V,j),le=se.length,Pe=se.shift(),De=L._queueHooks(V,j),$e=function(){L.dequeue(V,j)};Pe==="inprogress"&&(Pe=se.shift(),le--),Pe&&(j==="fx"&&se.unshift("inprogress"),delete De.stop,Pe.call(V,$e,De)),!le&&De&&De.empty.fire()},_queueHooks:function(V,j){var se=j+"queueHooks";return Mt.get(V,se)||Mt.access(V,se,{empty:L.Callbacks("once memory").add(function(){Mt.remove(V,[j+"queue",se])})})}}),L.fn.extend({queue:function(V,j){var se=2;return typeof V!="string"&&(j=V,V="fx",se--),arguments.length<se?L.queue(this[0],V):j===void 0?this:this.each(function(){var le=L.queue(this,V,j);L._queueHooks(this,V),V==="fx"&&le[0]!=="inprogress"&&L.dequeue(this,V)})},dequeue:function(V){return this.each(function(){L.dequeue(this,V)})},clearQueue:function(V){return this.queue(V||"fx",[])},promise:function(V,j){var se,le=1,Pe=L.Deferred(),De=this,$e=this.length,st=function(){--le||Pe.resolveWith(De,[De])};for(typeof V!="string"&&(j=V,V=void 0),V=V||"fx";$e--;)se=Mt.get(De[$e],V+"queueHooks"),se&&se.empty&&(le++,se.empty.add(st));return st(),Pe.promise(j)}});var Li=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Wi=["Top","Right","Bottom","Left"],Vi=function(V,j){return V=j||V,L.css(V,"display")==="none"||!L.contains(V.ownerDocument,V)},qi=/^(?:checkbox|radio)$/i;(function(){var V=I.createDocumentFragment(),j=V.appendChild(I.createElement("div"));j.innerHTML="<input type='radio' checked='checked' name='t'/>",O.checkClone=j.cloneNode(!0).cloneNode(!0).lastChild.checked,j.innerHTML="<textarea>x</textarea>",O.noCloneChecked=!!j.cloneNode(!0).lastChild.defaultValue})();var Kt="undefined";O.focusinBubbles="onfocusin"in t;var zs=/^key/,ls=/^(?:mouse|contextmenu)|click/,gs=/^(?:focusinfocus|focusoutblur)$/,Ws=/^([^.]*)(?:\.(.+)|)$/;function K(){return!0}function He(){return!1}function We(){try{return I.activeElement}catch{}}L.event={global:{},add:function(V,j,se,le,Pe){var De,$e,st,At,Dt,St,Jt,ti,fi,zi,Zi,Ms=Mt.get(V);if(Ms)for(se.handler&&(De=se,se=De.handler,Pe=De.selector),se.guid||(se.guid=L.guid++),(At=Ms.events)||(At=Ms.events={}),($e=Ms.handle)||($e=Ms.handle=function(On){return typeof L!==Kt&&L.event.triggered!==On.type?L.event.dispatch.apply(V,arguments):void 0}),j=(j||"").match(zt)||[""],Dt=j.length;Dt--;)st=Ws.exec(j[Dt])||[],fi=Zi=st[1],zi=(st[2]||"").split(".").sort(),fi&&(Jt=L.event.special[fi]||{},fi=(Pe?Jt.delegateType:Jt.bindType)||fi,Jt=L.event.special[fi]||{},St=L.extend({type:fi,origType:Zi,data:le,handler:se,guid:se.guid,selector:Pe,needsContext:Pe&&L.expr.match.needsContext.test(Pe),namespace:zi.join(".")},De),(ti=At[fi])||(ti=At[fi]=[],ti.delegateCount=0,(!Jt.setup||Jt.setup.call(V,le,zi,$e)===!1)&&V.addEventListener&&V.addEventListener(fi,$e,!1)),Jt.add&&(Jt.add.call(V,St),St.handler.guid||(St.handler.guid=se.guid)),Pe?ti.splice(ti.delegateCount++,0,St):ti.push(St),L.event.global[fi]=!0)},remove:function(V,j,se,le,Pe){var De,$e,st,At,Dt,St,Jt,ti,fi,zi,Zi,Ms=Mt.hasData(V)&&Mt.get(V);if(!(!Ms||!(At=Ms.events))){for(j=(j||"").match(zt)||[""],Dt=j.length;Dt--;){if(st=Ws.exec(j[Dt])||[],fi=Zi=st[1],zi=(st[2]||"").split(".").sort(),!fi){for(fi in At)L.event.remove(V,fi+j[Dt],se,le,!0);continue}for(Jt=L.event.special[fi]||{},fi=(le?Jt.delegateType:Jt.bindType)||fi,ti=At[fi]||[],st=st[2]&&new RegExp("(^|\\.)"+zi.join("\\.(?:.*\\.|)")+"(\\.|$)"),$e=De=ti.length;De--;)St=ti[De],(Pe||Zi===St.origType)&&(!se||se.guid===St.guid)&&(!st||st.test(St.namespace))&&(!le||le===St.selector||le==="**"&&St.selector)&&(ti.splice(De,1),St.selector&&ti.delegateCount--,Jt.remove&&Jt.remove.call(V,St));$e&&!ti.length&&((!Jt.teardown||Jt.teardown.call(V,zi,Ms.handle)===!1)&&L.removeEvent(V,fi,Ms.handle),delete At[fi])}L.isEmptyObject(At)&&(delete Ms.handle,Mt.remove(V,"events"))}},trigger:function(V,j,se,le){var Pe,De,$e,st,At,Dt,St,Jt=[se||I],ti=A.call(V,"type")?V.type:V,fi=A.call(V,"namespace")?V.namespace.split("."):[];if(De=$e=se=se||I,!(se.nodeType===3||se.nodeType===8)&&!gs.test(ti+L.event.triggered)&&(ti.indexOf(".")>=0&&(fi=ti.split("."),ti=fi.shift(),fi.sort()),At=ti.indexOf(":")<0&&"on"+ti,V=V[L.expando]?V:new L.Event(ti,typeof V=="object"&&V),V.isTrigger=le?2:3,V.namespace=fi.join("."),V.namespace_re=V.namespace?new RegExp("(^|\\.)"+fi.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,V.result=void 0,V.target||(V.target=se),j=j==null?[V]:L.makeArray(j,[V]),St=L.event.special[ti]||{},!(!le&&St.trigger&&St.trigger.apply(se,j)===!1))){if(!le&&!St.noBubble&&!L.isWindow(se)){for(st=St.delegateType||ti,gs.test(st+ti)||(De=De.parentNode);De;De=De.parentNode)Jt.push(De),$e=De;$e===(se.ownerDocument||I)&&Jt.push($e.defaultView||$e.parentWindow||t)}for(Pe=0;(De=Jt[Pe++])&&!V.isPropagationStopped();)V.type=Pe>1?st:St.bindType||ti,Dt=(Mt.get(De,"events")||{})[V.type]&&Mt.get(De,"handle"),Dt&&Dt.apply(De,j),Dt=At&&De[At],Dt&&Dt.apply&&L.acceptData(De)&&(V.result=Dt.apply(De,j),V.result===!1&&V.preventDefault());return V.type=ti,!le&&!V.isDefaultPrevented()&&(!St._default||St._default.apply(Jt.pop(),j)===!1)&&L.acceptData(se)&&At&&L.isFunction(se[ti])&&!L.isWindow(se)&&($e=se[At],$e&&(se[At]=null),L.event.triggered=ti,se[ti](),L.event.triggered=void 0,$e&&(se[At]=$e)),V.result}},dispatch:function(V){V=L.event.fix(V);var j,se,le,Pe,De,$e=[],st=o.call(arguments),At=(Mt.get(this,"events")||{})[V.type]||[],Dt=L.event.special[V.type]||{};if(st[0]=V,V.delegateTarget=this,!(Dt.preDispatch&&Dt.preDispatch.call(this,V)===!1)){for($e=L.event.handlers.call(this,V,At),j=0;(Pe=$e[j++])&&!V.isPropagationStopped();)for(V.currentTarget=Pe.elem,se=0;(De=Pe.handlers[se++])&&!V.isImmediatePropagationStopped();)(!V.namespace_re||V.namespace_re.test(De.namespace))&&(V.handleObj=De,V.data=De.data,le=((L.event.special[De.origType]||{}).handle||De.handler).apply(Pe.elem,st),le!==void 0&&(V.result=le)===!1&&(V.preventDefault(),V.stopPropagation()));return Dt.postDispatch&&Dt.postDispatch.call(this,V),V.result}},handlers:function(V,j){var se,le,Pe,De,$e=[],st=j.delegateCount,At=V.target;if(st&&At.nodeType&&(!V.button||V.type!=="click")){for(;At!==this;At=At.parentNode||this)if(At.disabled!==!0||V.type!=="click"){for(le=[],se=0;se<st;se++)De=j[se],Pe=De.selector+" ",le[Pe]===void 0&&(le[Pe]=De.needsContext?L(Pe,this).index(At)>=0:L.find(Pe,this,null,[At]).length),le[Pe]&&le.push(De);le.length&&$e.push({elem:At,handlers:le})}}return st<j.length&&$e.push({elem:this,handlers:j.slice(st)}),$e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(V,j){return V.which==null&&(V.which=j.charCode!=null?j.charCode:j.keyCode),V}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(V,j){var se,le,Pe,De=j.button;return V.pageX==null&&j.clientX!=null&&(se=V.target.ownerDocument||I,le=se.documentElement,Pe=se.body,V.pageX=j.clientX+(le&&le.scrollLeft||Pe&&Pe.scrollLeft||0)-(le&&le.clientLeft||Pe&&Pe.clientLeft||0),V.pageY=j.clientY+(le&&le.scrollTop||Pe&&Pe.scrollTop||0)-(le&&le.clientTop||Pe&&Pe.clientTop||0)),!V.which&&De!==void 0&&(V.which=De&1?1:De&2?3:De&4?2:0),V}},fix:function(V){if(V[L.expando])return V;var j,se,le,Pe=V.type,De=V,$e=this.fixHooks[Pe];for($e||(this.fixHooks[Pe]=$e=ls.test(Pe)?this.mouseHooks:zs.test(Pe)?this.keyHooks:{}),le=$e.props?this.props.concat($e.props):this.props,V=new L.Event(De),j=le.length;j--;)se=le[j],V[se]=De[se];return V.target||(V.target=I),V.target.nodeType===3&&(V.target=V.target.parentNode),$e.filter?$e.filter(V,De):V},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==We()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===We()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if(this.type==="checkbox"&&this.click&&L.nodeName(this,"input"))return this.click(),!1},_default:function(V){return L.nodeName(V.target,"a")}},beforeunload:{postDispatch:function(V){V.result!==void 0&&(V.originalEvent.returnValue=V.result)}}},simulate:function(V,j,se,le){var Pe=L.extend(new L.Event,se,{type:V,isSimulated:!0,originalEvent:{}});le?L.event.trigger(Pe,null,j):L.event.dispatch.call(j,Pe),Pe.isDefaultPrevented()&&se.preventDefault()}},L.removeEvent=function(V,j,se){V.removeEventListener&&V.removeEventListener(j,se,!1)},L.Event=function(V,j){if(!(this instanceof L.Event))return new L.Event(V,j);V&&V.type?(this.originalEvent=V,this.type=V.type,this.isDefaultPrevented=V.defaultPrevented||V.defaultPrevented===void 0&&V.getPreventDefault&&V.getPreventDefault()?K:He):this.type=V,j&&L.extend(this,j),this.timeStamp=V&&V.timeStamp||L.now(),this[L.expando]=!0},L.Event.prototype={isDefaultPrevented:He,isPropagationStopped:He,isImmediatePropagationStopped:He,preventDefault:function(){var V=this.originalEvent;this.isDefaultPrevented=K,V&&V.preventDefault&&V.preventDefault()},stopPropagation:function(){var V=this.originalEvent;this.isPropagationStopped=K,V&&V.stopPropagation&&V.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=K,this.stopPropagation()}},L.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(V,j){L.event.special[V]={delegateType:j,bindType:j,handle:function(se){var le,Pe=this,De=se.relatedTarget,$e=se.handleObj;return(!De||De!==Pe&&!L.contains(Pe,De))&&(se.type=$e.origType,le=$e.handler.apply(this,arguments),se.type=j),le}}}),O.focusinBubbles||L.each({focus:"focusin",blur:"focusout"},function(V,j){var se=function(le){L.event.simulate(j,le.target,L.event.fix(le),!0)};L.event.special[j]={setup:function(){var le=this.ownerDocument||this,Pe=Mt.access(le,j);Pe||le.addEventListener(V,se,!0),Mt.access(le,j,(Pe||0)+1)},teardown:function(){var le=this.ownerDocument||this,Pe=Mt.access(le,j)-1;Pe?Mt.access(le,j,Pe):(le.removeEventListener(V,se,!0),Mt.remove(le,j))}}}),L.fn.extend({on:function(V,j,se,le,Pe){var De,$e;if(typeof V=="object"){typeof j!="string"&&(se=se||j,j=void 0);for($e in V)this.on($e,j,se,V[$e],Pe);return this}if(se==null&&le==null?(le=j,se=j=void 0):le==null&&(typeof j=="string"?(le=se,se=void 0):(le=se,se=j,j=void 0)),le===!1)le=He;else if(!le)return this;return Pe===1&&(De=le,le=function(st){return L().off(st),De.apply(this,arguments)},le.guid=De.guid||(De.guid=L.guid++)),this.each(function(){L.event.add(this,V,le,se,j)})},one:function(V,j,se,le){return this.on(V,j,se,le,1)},off:function(V,j,se){var le,Pe;if(V&&V.preventDefault&&V.handleObj)return le=V.handleObj,L(V.delegateTarget).off(le.namespace?le.origType+"."+le.namespace:le.origType,le.selector,le.handler),this;if(typeof V=="object"){for(Pe in V)this.off(Pe,j,V[Pe]);return this}return(j===!1||typeof j=="function")&&(se=j,j=void 0),se===!1&&(se=He),this.each(function(){L.event.remove(this,V,se,j)})},trigger:function(V,j){return this.each(function(){L.event.trigger(V,j,this)})},triggerHandler:function(V,j){var se=this[0];if(se)return L.event.trigger(V,j,se,!0)}});var it=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,et=/<([\w:]+)/,Ie=/<|&#?\w+;/,Ve=/<(?:script|style|link)/i,Me=/checked\s*(?:[^=]|=\s*.checked.)/i,yt=/^$|\/(?:java|ecma)script/i,u=/^true\/(.*)/,y=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,w={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};w.optgroup=w.option,w.tbody=w.tfoot=w.colgroup=w.caption=w.thead,w.th=w.td;function D(V,j){return L.nodeName(V,"table")&&L.nodeName(j.nodeType!==11?j:j.firstChild,"tr")?V.getElementsByTagName("tbody")[0]||V.appendChild(V.ownerDocument.createElement("tbody")):V}function N(V){return V.type=(V.getAttribute("type")!==null)+"/"+V.type,V}function U(V){var j=u.exec(V.type);return j?V.type=j[1]:V.removeAttribute("type"),V}function te(V,j){for(var se=0,le=V.length;se<le;se++)Mt.set(V[se],"globalEval",!j||Mt.get(j[se],"globalEval"))}function J(V,j){var se,le,Pe,De,$e,st,At,Dt;if(j.nodeType===1){if(Mt.hasData(V)&&(De=Mt.access(V),$e=Mt.set(j,De),Dt=De.events,Dt)){delete $e.handle,$e.events={};for(Pe in Dt)for(se=0,le=Dt[Pe].length;se<le;se++)L.event.add(j,Pe,Dt[Pe][se])}jt.hasData(V)&&(st=jt.access(V),At=L.extend({},st),jt.set(j,At))}}function ie(V,j){var se=V.getElementsByTagName?V.getElementsByTagName(j||"*"):V.querySelectorAll?V.querySelectorAll(j||"*"):[];return j===void 0||j&&L.nodeName(V,j)?L.merge([V],se):se}function ae(V,j){var se=j.nodeName.toLowerCase();se==="input"&&qi.test(V.type)?j.checked=V.checked:(se==="input"||se==="textarea")&&(j.defaultValue=V.defaultValue)}L.extend({clone:function(V,j,se){var le,Pe,De,$e,st=V.cloneNode(!0),At=L.contains(V.ownerDocument,V);if(!O.noCloneChecked&&(V.nodeType===1||V.nodeType===11)&&!L.isXMLDoc(V))for($e=ie(st),De=ie(V),le=0,Pe=De.length;le<Pe;le++)ae(De[le],$e[le]);if(j)if(se)for(De=De||ie(V),$e=$e||ie(st),le=0,Pe=De.length;le<Pe;le++)J(De[le],$e[le]);else J(V,st);return $e=ie(st,"script"),$e.length>0&&te($e,!At&&ie(V,"script")),st},buildFragment:function(V,j,se,le){for(var Pe,De,$e,st,At,Dt,St=j.createDocumentFragment(),Jt=[],ti=0,fi=V.length;ti<fi;ti++)if(Pe=V[ti],Pe||Pe===0)if(L.type(Pe)==="object")L.merge(Jt,Pe.nodeType?[Pe]:Pe);else if(!Ie.test(Pe))Jt.push(j.createTextNode(Pe));else{for(De=De||St.appendChild(j.createElement("div")),$e=(et.exec(Pe)||["",""])[1].toLowerCase(),st=w[$e]||w._default,De.innerHTML=st[1]+Pe.replace(it,"<$1></$2>")+st[2],Dt=st[0];Dt--;)De=De.lastChild;L.merge(Jt,De.childNodes),De=St.firstChild,De.textContent=""}for(St.textContent="",ti=0;Pe=Jt[ti++];)if(!(le&&L.inArray(Pe,le)!==-1)&&(At=L.contains(Pe.ownerDocument,Pe),De=ie(St.appendChild(Pe),"script"),At&&te(De),se))for(Dt=0;Pe=De[Dt++];)yt.test(Pe.type||"")&&se.push(Pe);return St},cleanData:function(V){for(var j,se,le,Pe,De,$e,st=L.event.special,At=0;(se=V[At])!==void 0;At++){if(L.acceptData(se)&&(De=se[Mt.expando],De&&(j=Mt.cache[De]))){if(le=Object.keys(j.events||{}),le.length)for($e=0;(Pe=le[$e])!==void 0;$e++)st[Pe]?L.event.remove(se,Pe):L.removeEvent(se,Pe,j.handle);Mt.cache[De]&&delete Mt.cache[De]}delete jt.cache[se[jt.expando]]}}}),L.fn.extend({text:function(V){return Nt(this,function(j){return j===void 0?L.text(this):this.empty().each(function(){(this.nodeType===1||this.nodeType===11||this.nodeType===9)&&(this.textContent=j)})},null,V,arguments.length)},append:function(){return this.domManip(arguments,function(V){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var j=D(this,V);j.appendChild(V)}})},prepend:function(){return this.domManip(arguments,function(V){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var j=D(this,V);j.insertBefore(V,j.firstChild)}})},before:function(){return this.domManip(arguments,function(V){this.parentNode&&this.parentNode.insertBefore(V,this)})},after:function(){return this.domManip(arguments,function(V){this.parentNode&&this.parentNode.insertBefore(V,this.nextSibling)})},remove:function(V,j){for(var se,le=V?L.filter(V,this):this,Pe=0;(se=le[Pe])!=null;Pe++)!j&&se.nodeType===1&&L.cleanData(ie(se)),se.parentNode&&(j&&L.contains(se.ownerDocument,se)&&te(ie(se,"script")),se.parentNode.removeChild(se));return this},empty:function(){for(var V,j=0;(V=this[j])!=null;j++)V.nodeType===1&&(L.cleanData(ie(V,!1)),V.textContent="");return this},clone:function(V,j){return V=V??!1,j=j??V,this.map(function(){return L.clone(this,V,j)})},html:function(V){return Nt(this,function(j){var se=this[0]||{},le=0,Pe=this.length;if(j===void 0&&se.nodeType===1)return se.innerHTML;if(typeof j=="string"&&!Ve.test(j)&&!w[(et.exec(j)||["",""])[1].toLowerCase()]){j=j.replace(it,"<$1></$2>");try{for(;le<Pe;le++)se=this[le]||{},se.nodeType===1&&(L.cleanData(ie(se,!1)),se.innerHTML=j);se=0}catch{}}se&&this.empty().append(j)},null,V,arguments.length)},replaceWith:function(){var V=arguments[0];return this.domManip(arguments,function(j){V=this.parentNode,L.cleanData(ie(this)),V&&V.replaceChild(j,this)}),V&&(V.length||V.nodeType)?this:this.remove()},detach:function(V){return this.remove(V,!0)},domManip:function(V,j){V=n.apply([],V);var se,le,Pe,De,$e,st,At=0,Dt=this.length,St=this,Jt=Dt-1,ti=V[0],fi=L.isFunction(ti);if(fi||Dt>1&&typeof ti=="string"&&!O.checkClone&&Me.test(ti))return this.each(function(zi){var Zi=St.eq(zi);fi&&(V[0]=ti.call(this,zi,Zi.html())),Zi.domManip(V,j)});if(Dt&&(se=L.buildFragment(V,this[0].ownerDocument,!1,this),le=se.firstChild,se.childNodes.length===1&&(se=le),le)){for(Pe=L.map(ie(se,"script"),N),De=Pe.length;At<Dt;At++)$e=se,At!==Jt&&($e=L.clone($e,!0,!0),De&&L.merge(Pe,ie($e,"script"))),j.call(this[At],$e,At);if(De)for(st=Pe[Pe.length-1].ownerDocument,L.map(Pe,U),At=0;At<De;At++)$e=Pe[At],yt.test($e.type||"")&&!Mt.access($e,"globalEval")&&L.contains(st,$e)&&($e.src?L._evalUrl&&L._evalUrl($e.src):L.globalEval($e.textContent.replace(y,"")))}return this}}),L.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(V,j){L.fn[V]=function(se){for(var le,Pe=[],De=L(se),$e=De.length-1,st=0;st<=$e;st++)le=st===$e?this:this.clone(!0),L(De[st])[j](le),l.apply(Pe,le.get());return this.pushStack(Pe)}});var ve,Se={};function be(V,j){var se=L(j.createElement(V)).appendTo(j.body),le=t.getDefaultComputedStyle?t.getDefaultComputedStyle(se[0]).display:L.css(se[0],"display");return se.detach(),le}function ge(V){var j=I,se=Se[V];return se||(se=be(V,j),(se==="none"||!se)&&(ve=(ve||L("<iframe frameborder='0' width='0' height='0'/>")).appendTo(j.documentElement),j=ve[0].contentDocument,j.write(),j.close(),se=be(V,j),ve.detach()),Se[V]=se),se}var Ce=/^margin/,Ne=new RegExp("^("+Li+")(?!px)[a-z%]+$","i"),qe=function(V){return V.ownerDocument.defaultView.getComputedStyle(V,null)};function Ae(V,j,se){var le,Pe,De,$e,st=V.style;return se=se||qe(V),se&&($e=se.getPropertyValue(j)||se[j]),se&&($e===""&&!L.contains(V.ownerDocument,V)&&($e=L.style(V,j)),Ne.test($e)&&Ce.test(j)&&(le=st.width,Pe=st.minWidth,De=st.maxWidth,st.minWidth=st.maxWidth=st.width=$e,$e=se.width,st.width=le,st.minWidth=Pe,st.maxWidth=De)),$e!==void 0?$e+"":$e}function ke(V,j){return{get:function(){if(V()){delete this.get;return}return(this.get=j).apply(this,arguments)}}}(function(){var V,j,se="padding:0;margin:0;border:0;display:block;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box",le=I.documentElement,Pe=I.createElement("div"),De=I.createElement("div");De.style.backgroundClip="content-box",De.cloneNode(!0).style.backgroundClip="",O.clearCloneStyle=De.style.backgroundClip==="content-box",Pe.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",Pe.appendChild(De);function $e(){De.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%",le.appendChild(Pe);var st=t.getComputedStyle(De,null);V=st.top!=="1%",j=st.width==="4px",le.removeChild(Pe)}t.getComputedStyle&&L.extend(O,{pixelPosition:function(){return $e(),V},boxSizingReliable:function(){return j==null&&$e(),j},reliableMarginRight:function(){var st,At=De.appendChild(I.createElement("div"));return At.style.cssText=De.style.cssText=se,At.style.marginRight=At.style.width="0",De.style.width="1px",le.appendChild(Pe),st=!parseFloat(t.getComputedStyle(At,null).marginRight),le.removeChild(Pe),De.innerHTML="",st}})})(),L.swap=function(V,j,se,le){var Pe,De,$e={};for(De in j)$e[De]=V.style[De],V.style[De]=j[De];Pe=se.apply(V,le||[]);for(De in j)V.style[De]=$e[De];return Pe};var me=/^(none|table(?!-c[ea]).+)/,Te=new RegExp("^("+Li+")(.*)$","i"),Re=new RegExp("^([+-])=("+Li+")","i"),Fe={position:"absolute",visibility:"hidden",display:"block"},Ye={letterSpacing:0,fontWeight:400},je=["Webkit","O","Moz","ms"];function Ze(V,j){if(j in V)return j;for(var se=j[0].toUpperCase()+j.slice(1),le=j,Pe=je.length;Pe--;)if(j=je[Pe]+se,j in V)return j;return le}function tt(V,j,se){var le=Te.exec(j);return le?Math.max(0,le[1]-(se||0))+(le[2]||"px"):j}function ut(V,j,se,le,Pe){for(var De=se===(le?"border":"content")?4:j==="width"?1:0,$e=0;De<4;De+=2)se==="margin"&&($e+=L.css(V,se+Wi[De],!0,Pe)),le?(se==="content"&&($e-=L.css(V,"padding"+Wi[De],!0,Pe)),se!=="margin"&&($e-=L.css(V,"border"+Wi[De]+"Width",!0,Pe))):($e+=L.css(V,"padding"+Wi[De],!0,Pe),se!=="padding"&&($e+=L.css(V,"border"+Wi[De]+"Width",!0,Pe)));return $e}function nt(V,j,se){var le=!0,Pe=j==="width"?V.offsetWidth:V.offsetHeight,De=qe(V),$e=L.css(V,"boxSizing",!1,De)==="border-box";if(Pe<=0||Pe==null){if(Pe=Ae(V,j,De),(Pe<0||Pe==null)&&(Pe=V.style[j]),Ne.test(Pe))return Pe;le=$e&&(O.boxSizingReliable()||Pe===V.style[j]),Pe=parseFloat(Pe)||0}return Pe+ut(V,j,se||($e?"border":"content"),le,De)+"px"}function pt(V,j){for(var se,le,Pe,De=[],$e=0,st=V.length;$e<st;$e++)le=V[$e],le.style&&(De[$e]=Mt.get(le,"olddisplay"),se=le.style.display,j?(!De[$e]&&se==="none"&&(le.style.display=""),le.style.display===""&&Vi(le)&&(De[$e]=Mt.access(le,"olddisplay",ge(le.nodeName)))):De[$e]||(Pe=Vi(le),(se&&se!=="none"||!Pe)&&Mt.set(le,"olddisplay",Pe?se:L.css(le,"display"))));for($e=0;$e<st;$e++)le=V[$e],le.style&&(!j||le.style.display==="none"||le.style.display==="")&&(le.style.display=j?De[$e]||"":"none");return V}L.extend({cssHooks:{opacity:{get:function(V,j){if(j){var se=Ae(V,"opacity");return se===""?"1":se}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(V,j,se,le){if(!(!V||V.nodeType===3||V.nodeType===8||!V.style)){var Pe,De,$e,st=L.camelCase(j),At=V.style;if(j=L.cssProps[st]||(L.cssProps[st]=Ze(At,st)),$e=L.cssHooks[j]||L.cssHooks[st],se!==void 0){if(De=typeof se,De==="string"&&(Pe=Re.exec(se))&&(se=(Pe[1]+1)*Pe[2]+parseFloat(L.css(V,j)),De="number"),se==null||se!==se)return;De==="number"&&!L.cssNumber[st]&&(se+="px"),!O.clearCloneStyle&&se===""&&j.indexOf("background")===0&&(At[j]="inherit"),(!$e||!("set"in $e)||(se=$e.set(V,se,le))!==void 0)&&(At[j]="",At[j]=se)}else return $e&&"get"in $e&&(Pe=$e.get(V,!1,le))!==void 0?Pe:At[j]}},css:function(V,j,se,le){var Pe,De,$e,st=L.camelCase(j);return j=L.cssProps[st]||(L.cssProps[st]=Ze(V.style,st)),$e=L.cssHooks[j]||L.cssHooks[st],$e&&"get"in $e&&(Pe=$e.get(V,!0,se)),Pe===void 0&&(Pe=Ae(V,j,le)),Pe==="normal"&&j in Ye&&(Pe=Ye[j]),se===""||se?(De=parseFloat(Pe),se===!0||L.isNumeric(De)?De||0:Pe):Pe}}),L.each(["height","width"],function(V,j){L.cssHooks[j]={get:function(se,le,Pe){if(le)return se.offsetWidth===0&&me.test(L.css(se,"display"))?L.swap(se,Fe,function(){return nt(se,j,Pe)}):nt(se,j,Pe)},set:function(se,le,Pe){var De=Pe&&qe(se);return tt(se,le,Pe?ut(se,j,Pe,L.css(se,"boxSizing",!1,De)==="border-box",De):0)}}}),L.cssHooks.marginRight=ke(O.reliableMarginRight,function(V,j){if(j)return L.swap(V,{display:"inline-block"},Ae,[V,"marginRight"])}),L.each({margin:"",padding:"",border:"Width"},function(V,j){L.cssHooks[V+j]={expand:function(se){for(var le=0,Pe={},De=typeof se=="string"?se.split(" "):[se];le<4;le++)Pe[V+Wi[le]+j]=De[le]||De[le-2]||De[0];return Pe}},Ce.test(V)||(L.cssHooks[V+j].set=tt)}),L.fn.extend({css:function(V,j){return Nt(this,function(se,le,Pe){var De,$e,st={},At=0;if(L.isArray(le)){for(De=qe(se),$e=le.length;At<$e;At++)st[le[At]]=L.css(se,le[At],!1,De);return st}return Pe!==void 0?L.style(se,le,Pe):L.css(se,le)},V,j,arguments.length>1)},show:function(){return pt(this,!0)},hide:function(){return pt(this)},toggle:function(V){return typeof V=="boolean"?V?this.show():this.hide():this.each(function(){Vi(this)?L(this).show():L(this).hide()})}});function ft(V,j,se,le,Pe){return new ft.prototype.init(V,j,se,le,Pe)}L.Tween=ft,ft.prototype={constructor:ft,init:function(V,j,se,le,Pe,De){this.elem=V,this.prop=se,this.easing=Pe||"swing",this.options=j,this.start=this.now=this.cur(),this.end=le,this.unit=De||(L.cssNumber[se]?"":"px")},cur:function(){var V=ft.propHooks[this.prop];return V&&V.get?V.get(this):ft.propHooks._default.get(this)},run:function(V){var j,se=ft.propHooks[this.prop];return this.options.duration?this.pos=j=L.easing[this.easing](V,this.options.duration*V,0,1,this.options.duration):this.pos=j=V,this.now=(this.end-this.start)*j+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),se&&se.set?se.set(this):ft.propHooks._default.set(this),this}},ft.prototype.init.prototype=ft.prototype,ft.propHooks={_default:{get:function(V){var j;return V.elem[V.prop]!=null&&(!V.elem.style||V.elem.style[V.prop]==null)?V.elem[V.prop]:(j=L.css(V.elem,V.prop,""),!j||j==="auto"?0:j)},set:function(V){L.fx.step[V.prop]?L.fx.step[V.prop](V):V.elem.style&&(V.elem.style[L.cssProps[V.prop]]!=null||L.cssHooks[V.prop])?L.style(V.elem,V.prop,V.now+V.unit):V.elem[V.prop]=V.now}}},ft.propHooks.scrollTop=ft.propHooks.scrollLeft={set:function(V){V.elem.nodeType&&V.elem.parentNode&&(V.elem[V.prop]=V.now)}},L.easing={linear:function(V){return V},swing:function(V){return .5-Math.cos(V*Math.PI)/2}},L.fx=ft.prototype.init,L.fx.step={};var wt,Tt,Vt=/^(?:toggle|show|hide)$/,ni=new RegExp("^(?:([+-])=|)("+Li+")([a-z%]*)$","i"),ai=/queueHooks$/,Ht=[Qt],Ci={"*":[function(V,j){var se=this.createTween(V,j),le=se.cur(),Pe=ni.exec(j),De=Pe&&Pe[3]||(L.cssNumber[V]?"":"px"),$e=(L.cssNumber[V]||De!=="px"&&+le)&&ni.exec(L.css(se.elem,V)),st=1,At=20;if($e&&$e[3]!==De){De=De||$e[3],Pe=Pe||[],$e=+le||1;do st=st||".5",$e=$e/st,L.style(se.elem,V,$e+De);while(st!==(st=se.cur()/le)&&st!==1&&--At)}return Pe&&($e=se.start=+$e||+le||0,se.unit=De,se.end=Pe[1]?$e+(Pe[1]+1)*Pe[2]:+Pe[2]),se}]};function Ti(){return setTimeout(function(){wt=void 0}),wt=L.now()}function Pi(V,j){var se,le=0,Pe={height:V};for(j=j?1:0;le<4;le+=2-j)se=Wi[le],Pe["margin"+se]=Pe["padding"+se]=V;return j&&(Pe.opacity=Pe.width=V),Pe}function wi(V,j,se){for(var le,Pe=(Ci[j]||[]).concat(Ci["*"]),De=0,$e=Pe.length;De<$e;De++)if(le=Pe[De].call(se,j,V))return le}function Qt(V,j,se){var le,Pe,De,$e,st,At,Dt,St=this,Jt={},ti=V.style,fi=V.nodeType&&Vi(V),zi=Mt.get(V,"fxshow");se.queue||(st=L._queueHooks(V,"fx"),st.unqueued==null&&(st.unqueued=0,At=st.empty.fire,st.empty.fire=function(){st.unqueued||At()}),st.unqueued++,St.always(function(){St.always(function(){st.unqueued--,L.queue(V,"fx").length||st.empty.fire()})})),V.nodeType===1&&("height"in j||"width"in j)&&(se.overflow=[ti.overflow,ti.overflowX,ti.overflowY],Dt=L.css(V,"display"),Dt==="none"&&(Dt=ge(V.nodeName)),Dt==="inline"&&L.css(V,"float")==="none"&&(ti.display="inline-block")),se.overflow&&(ti.overflow="hidden",St.always(function(){ti.overflow=se.overflow[0],ti.overflowX=se.overflow[1],ti.overflowY=se.overflow[2]}));for(le in j)if(Pe=j[le],Vt.exec(Pe)){if(delete j[le],De=De||Pe==="toggle",Pe===(fi?"hide":"show"))if(Pe==="show"&&zi&&zi[le]!==void 0)fi=!0;else continue;Jt[le]=zi&&zi[le]||L.style(V,le)}if(!L.isEmptyObject(Jt)){zi?"hidden"in zi&&(fi=zi.hidden):zi=Mt.access(V,"fxshow",{}),De&&(zi.hidden=!fi),fi?L(V).show():St.done(function(){L(V).hide()}),St.done(function(){var Zi;Mt.remove(V,"fxshow");for(Zi in Jt)L.style(V,Zi,Jt[Zi])});for(le in Jt)$e=wi(fi?zi[le]:0,le,St),le in zi||(zi[le]=$e.start,fi&&($e.end=$e.start,$e.start=le==="width"||le==="height"?1:0))}}function Oi(V,j){var se,le,Pe,De,$e;for(se in V)if(le=L.camelCase(se),Pe=j[le],De=V[se],L.isArray(De)&&(Pe=De[1],De=V[se]=De[0]),se!==le&&(V[le]=De,delete V[se]),$e=L.cssHooks[le],$e&&"expand"in $e){De=$e.expand(De),delete V[le];for(se in De)se in V||(V[se]=De[se],j[se]=Pe)}else j[le]=Pe}function ds(V,j,se){var le,Pe,De=0,$e=Ht.length,st=L.Deferred().always(function(){delete At.elem}),At=function(){if(Pe)return!1;for(var Jt=wt||Ti(),ti=Math.max(0,Dt.startTime+Dt.duration-Jt),fi=ti/Dt.duration||0,zi=1-fi,Zi=0,Ms=Dt.tweens.length;Zi<Ms;Zi++)Dt.tweens[Zi].run(zi);return st.notifyWith(V,[Dt,zi,ti]),zi<1&&Ms?ti:(st.resolveWith(V,[Dt]),!1)},Dt=st.promise({elem:V,props:L.extend({},j),opts:L.extend(!0,{specialEasing:{}},se),originalProperties:j,originalOptions:se,startTime:wt||Ti(),duration:se.duration,tweens:[],createTween:function(Jt,ti){var fi=L.Tween(V,Dt.opts,Jt,ti,Dt.opts.specialEasing[Jt]||Dt.opts.easing);return Dt.tweens.push(fi),fi},stop:function(Jt){var ti=0,fi=Jt?Dt.tweens.length:0;if(Pe)return this;for(Pe=!0;ti<fi;ti++)Dt.tweens[ti].run(1);return Jt?st.resolveWith(V,[Dt,Jt]):st.rejectWith(V,[Dt,Jt]),this}}),St=Dt.props;for(Oi(St,Dt.opts.specialEasing);De<$e;De++)if(le=Ht[De].call(Dt,V,St,Dt.opts),le)return le;return L.map(St,wi,Dt),L.isFunction(Dt.opts.start)&&Dt.opts.start.call(V,Dt),L.fx.timer(L.extend(At,{elem:V,anim:Dt,queue:Dt.opts.queue})),Dt.progress(Dt.opts.progress).done(Dt.opts.done,Dt.opts.complete).fail(Dt.opts.fail).always(Dt.opts.always)}L.Animation=L.extend(ds,{tweener:function(V,j){L.isFunction(V)?(j=V,V=["*"]):V=V.split(" ");for(var se,le=0,Pe=V.length;le<Pe;le++)se=V[le],Ci[se]=Ci[se]||[],Ci[se].unshift(j)},prefilter:function(V,j){j?Ht.unshift(V):Ht.push(V)}}),L.speed=function(V,j,se){var le=V&&typeof V=="object"?L.extend({},V):{complete:se||!se&&j||L.isFunction(V)&&V,duration:V,easing:se&&j||j&&!L.isFunction(j)&&j};return le.duration=L.fx.off?0:typeof le.duration=="number"?le.duration:le.duration in L.fx.speeds?L.fx.speeds[le.duration]:L.fx.speeds._default,(le.queue==null||le.queue===!0)&&(le.queue="fx"),le.old=le.complete,le.complete=function(){L.isFunction(le.old)&&le.old.call(this),le.queue&&L.dequeue(this,le.queue)},le},L.fn.extend({fadeTo:function(V,j,se,le){return this.filter(Vi).css("opacity",0).show().end().animate({opacity:j},V,se,le)},animate:function(V,j,se,le){var Pe=L.isEmptyObject(V),De=L.speed(j,se,le),$e=function(){var st=ds(this,L.extend({},V),De);(Pe||Mt.get(this,"finish"))&&st.stop(!0)};return $e.finish=$e,Pe||De.queue===!1?this.each($e):this.queue(De.queue,$e)},stop:function(V,j,se){var le=function(Pe){var De=Pe.stop;delete Pe.stop,De(se)};return typeof V!="string"&&(se=j,j=V,V=void 0),j&&V!==!1&&this.queue(V||"fx",[]),this.each(function(){var Pe=!0,De=V!=null&&V+"queueHooks",$e=L.timers,st=Mt.get(this);if(De)st[De]&&st[De].stop&&le(st[De]);else for(De in st)st[De]&&st[De].stop&&ai.test(De)&&le(st[De]);for(De=$e.length;De--;)$e[De].elem===this&&(V==null||$e[De].queue===V)&&($e[De].anim.stop(se),Pe=!1,$e.splice(De,1));(Pe||!se)&&L.dequeue(this,V)})},finish:function(V){return V!==!1&&(V=V||"fx"),this.each(function(){var j,se=Mt.get(this),le=se[V+"queue"],Pe=se[V+"queueHooks"],De=L.timers,$e=le?le.length:0;for(se.finish=!0,L.queue(this,V,[]),Pe&&Pe.stop&&Pe.stop.call(this,!0),j=De.length;j--;)De[j].elem===this&&De[j].queue===V&&(De[j].anim.stop(!0),De.splice(j,1));for(j=0;j<$e;j++)le[j]&&le[j].finish&&le[j].finish.call(this);delete se.finish})}}),L.each(["toggle","show","hide"],function(V,j){var se=L.fn[j];L.fn[j]=function(le,Pe,De){return le==null||typeof le=="boolean"?se.apply(this,arguments):this.animate(Pi(j,!0),le,Pe,De)}}),L.each({slideDown:Pi("show"),slideUp:Pi("hide"),slideToggle:Pi("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(V,j){L.fn[V]=function(se,le,Pe){return this.animate(j,se,le,Pe)}}),L.timers=[],L.fx.tick=function(){var V,j=0,se=L.timers;for(wt=L.now();j<se.length;j++)V=se[j],!V()&&se[j]===V&&se.splice(j--,1);se.length||L.fx.stop(),wt=void 0},L.fx.timer=function(V){L.timers.push(V),V()?L.fx.start():L.timers.pop()},L.fx.interval=13,L.fx.start=function(){Tt||(Tt=setInterval(L.fx.tick,L.fx.interval))},L.fx.stop=function(){clearInterval(Tt),Tt=null},L.fx.speeds={slow:600,fast:200,_default:400},L.fn.delay=function(V,j){return V=L.fx&&L.fx.speeds[V]||V,j=j||"fx",this.queue(j,function(se,le){var Pe=setTimeout(se,V);le.stop=function(){clearTimeout(Pe)}})},function(){var V=I.createElement("input"),j=I.createElement("select"),se=j.appendChild(I.createElement("option"));V.type="checkbox",O.checkOn=V.value!=="",O.optSelected=se.selected,j.disabled=!0,O.optDisabled=!se.disabled,V=I.createElement("input"),V.value="t",V.type="radio",O.radioValue=V.value==="t"}();var Lt,Qi,Ki=L.expr.attrHandle;L.fn.extend({attr:function(V,j){return Nt(this,L.attr,V,j,arguments.length>1)},removeAttr:function(V){return this.each(function(){L.removeAttr(this,V)})}}),L.extend({attr:function(V,j,se){var le,Pe,De=V.nodeType;if(!(!V||De===3||De===8||De===2)){if(typeof V.getAttribute===Kt)return L.prop(V,j,se);if((De!==1||!L.isXMLDoc(V))&&(j=j.toLowerCase(),le=L.attrHooks[j]||(L.expr.match.bool.test(j)?Qi:Lt)),se!==void 0)if(se===null)L.removeAttr(V,j);else return le&&"set"in le&&(Pe=le.set(V,se,j))!==void 0?Pe:(V.setAttribute(j,se+""),se);else return le&&"get"in le&&(Pe=le.get(V,j))!==null?Pe:(Pe=L.find.attr(V,j),Pe??void 0)}},removeAttr:function(V,j){var se,le,Pe=0,De=j&&j.match(zt);if(De&&V.nodeType===1)for(;se=De[Pe++];)le=L.propFix[se]||se,L.expr.match.bool.test(se)&&(V[le]=!1),V.removeAttribute(se)},attrHooks:{type:{set:function(V,j){if(!O.radioValue&&j==="radio"&&L.nodeName(V,"input")){var se=V.value;return V.setAttribute("type",j),se&&(V.value=se),j}}}}}),Qi={set:function(V,j,se){return j===!1?L.removeAttr(V,se):V.setAttribute(se,se),se}},L.each(L.expr.match.bool.source.match(/\w+/g),function(V,j){var se=Ki[j]||L.find.attr;Ki[j]=function(le,Pe,De){var $e,st;return De||(st=Ki[Pe],Ki[Pe]=$e,$e=se(le,Pe,De)!=null?Pe.toLowerCase():null,Ki[Pe]=st),$e}});var Ri=/^(?:input|select|textarea|button)$/i;L.fn.extend({prop:function(V,j){return Nt(this,L.prop,V,j,arguments.length>1)},removeProp:function(V){return this.each(function(){delete this[L.propFix[V]||V]})}}),L.extend({propFix:{for:"htmlFor",class:"className"},prop:function(V,j,se){var le,Pe,De,$e=V.nodeType;if(!(!V||$e===3||$e===8||$e===2))return De=$e!==1||!L.isXMLDoc(V),De&&(j=L.propFix[j]||j,Pe=L.propHooks[j]),se!==void 0?Pe&&"set"in Pe&&(le=Pe.set(V,se,j))!==void 0?le:V[j]=se:Pe&&"get"in Pe&&(le=Pe.get(V,j))!==null?le:V[j]},propHooks:{tabIndex:{get:function(V){return V.hasAttribute("tabindex")||Ri.test(V.nodeName)||V.href?V.tabIndex:-1}}}}),O.optSelected||(L.propHooks.selected={get:function(V){var j=V.parentNode;return j&&j.parentNode&&j.parentNode.selectedIndex,null}}),L.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){L.propFix[this.toLowerCase()]=this});var Xs=/[\t\r\n\f]/g;L.fn.extend({addClass:function(V){var j,se,le,Pe,De,$e,st=typeof V=="string"&&V,At=0,Dt=this.length;if(L.isFunction(V))return this.each(function(St){L(this).addClass(V.call(this,St,this.className))});if(st){for(j=(V||"").match(zt)||[];At<Dt;At++)if(se=this[At],le=se.nodeType===1&&(se.className?(" "+se.className+" ").replace(Xs," "):" "),le){for(De=0;Pe=j[De++];)le.indexOf(" "+Pe+" ")<0&&(le+=Pe+" ");$e=L.trim(le),se.className!==$e&&(se.className=$e)}}return this},removeClass:function(V){var j,se,le,Pe,De,$e,st=arguments.length===0||typeof V=="string"&&V,At=0,Dt=this.length;if(L.isFunction(V))return this.each(function(St){L(this).removeClass(V.call(this,St,this.className))});if(st){for(j=(V||"").match(zt)||[];At<Dt;At++)if(se=this[At],le=se.nodeType===1&&(se.className?(" "+se.className+" ").replace(Xs," "):""),le){for(De=0;Pe=j[De++];)for(;le.indexOf(" "+Pe+" ")>=0;)le=le.replace(" "+Pe+" "," ");$e=V?L.trim(le):"",se.className!==$e&&(se.className=$e)}}return this},toggleClass:function(V,j){var se=typeof V;return typeof j=="boolean"&&se==="string"?j?this.addClass(V):this.removeClass(V):L.isFunction(V)?this.each(function(le){L(this).toggleClass(V.call(this,le,this.className,j),j)}):this.each(function(){if(se==="string")for(var le,Pe=0,De=L(this),$e=V.match(zt)||[];le=$e[Pe++];)De.hasClass(le)?De.removeClass(le):De.addClass(le);else(se===Kt||se==="boolean")&&(this.className&&Mt.set(this,"__className__",this.className),this.className=this.className||V===!1?"":Mt.get(this,"__className__")||"")})},hasClass:function(V){for(var j=" "+V+" ",se=0,le=this.length;se<le;se++)if(this[se].nodeType===1&&(" "+this[se].className+" ").replace(Xs," ").indexOf(j)>=0)return!0;return!1}});var on=/\r/g;L.fn.extend({val:function(V){var j,se,le,Pe=this[0];return arguments.length?(le=L.isFunction(V),this.each(function(De){var $e;this.nodeType===1&&(le?$e=V.call(this,De,L(this).val()):$e=V,$e==null?$e="":typeof $e=="number"?$e+="":L.isArray($e)&&($e=L.map($e,function(st){return st==null?"":st+""})),j=L.valHooks[this.type]||L.valHooks[this.nodeName.toLowerCase()],(!j||!("set"in j)||j.set(this,$e,"value")===void 0)&&(this.value=$e))})):Pe?(j=L.valHooks[Pe.type]||L.valHooks[Pe.nodeName.toLowerCase()],j&&"get"in j&&(se=j.get(Pe,"value"))!==void 0?se:(se=Pe.value,typeof se=="string"?se.replace(on,""):se??"")):void 0}}),L.extend({valHooks:{select:{get:function(V){for(var j,se,le=V.options,Pe=V.selectedIndex,De=V.type==="select-one"||Pe<0,$e=De?null:[],st=De?Pe+1:le.length,At=Pe<0?st:De?Pe:0;At<st;At++)if(se=le[At],(se.selected||At===Pe)&&(O.optDisabled?!se.disabled:se.getAttribute("disabled")===null)&&(!se.parentNode.disabled||!L.nodeName(se.parentNode,"optgroup"))){if(j=L(se).val(),De)return j;$e.push(j)}return $e},set:function(V,j){for(var se,le,Pe=V.options,De=L.makeArray(j),$e=Pe.length;$e--;)le=Pe[$e],(le.selected=L.inArray(L(le).val(),De)>=0)&&(se=!0);return se||(V.selectedIndex=-1),De}}}}),L.each(["radio","checkbox"],function(){L.valHooks[this]={set:function(V,j){if(L.isArray(j))return V.checked=L.inArray(L(V).val(),j)>=0}},O.checkOn||(L.valHooks[this].get=function(V){return V.getAttribute("value")===null?"on":V.value})}),L.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(V,j){L.fn[j]=function(se,le){return arguments.length>0?this.on(j,null,se,le):this.trigger(j)}}),L.fn.extend({hover:function(V,j){return this.mouseenter(V).mouseleave(j||V)},bind:function(V,j,se){return this.on(V,null,j,se)},unbind:function(V,j){return this.off(V,null,j)},delegate:function(V,j,se,le){return this.on(j,V,se,le)},undelegate:function(V,j,se){return arguments.length===1?this.off(V,"**"):this.off(j,V||"**",se)}});var Hs=L.now(),Bs=/\?/;L.parseJSON=function(V){return JSON.parse(V+"")},L.parseXML=function(V){var j,se;if(!V||typeof V!="string")return null;try{se=new DOMParser,j=se.parseFromString(V,"text/xml")}catch{j=void 0}return(!j||j.getElementsByTagName("parsererror").length)&&L.error("Invalid XML: "+V),j};var rs,xs,Pn=/#.*$/,js=/([?&])_=[^&]*/,Xn=/^(.*?):[ \t]*([^\r\n]*)$/mg,Er=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,jn=/^(?:GET|HEAD)$/,pr=/^\/\//,hn=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,En={},Tr={},Tn="*/".concat("*");try{xs=location.href}catch{xs=I.createElement("a"),xs.href="",xs=xs.href}rs=hn.exec(xs.toLowerCase())||[];function Fs(V){return function(j,se){typeof j!="string"&&(se=j,j="*");var le,Pe=0,De=j.toLowerCase().match(zt)||[];if(L.isFunction(se))for(;le=De[Pe++];)le[0]==="+"?(le=le.slice(1)||"*",(V[le]=V[le]||[]).unshift(se)):(V[le]=V[le]||[]).push(se)}}function Ba(V,j,se,le){var Pe={},De=V===Tr;function $e(st){var At;return Pe[st]=!0,L.each(V[st]||[],function(Dt,St){var Jt=St(j,se,le);if(typeof Jt=="string"&&!De&&!Pe[Jt])return j.dataTypes.unshift(Jt),$e(Jt),!1;if(De)return!(At=Jt)}),At}return $e(j.dataTypes[0])||!Pe["*"]&&$e("*")}function Do(V,j){var se,le,Pe=L.ajaxSettings.flatOptions||{};for(se in j)j[se]!==void 0&&((Pe[se]?V:le||(le={}))[se]=j[se]);return le&&L.extend(!0,V,le),V}function Fa(V,j,se){for(var le,Pe,De,$e,st=V.contents,At=V.dataTypes;At[0]==="*";)At.shift(),le===void 0&&(le=V.mimeType||j.getResponseHeader("Content-Type"));if(le){for(Pe in st)if(st[Pe]&&st[Pe].test(le)){At.unshift(Pe);break}}if(At[0]in se)De=At[0];else{for(Pe in se){if(!At[0]||V.converters[Pe+" "+At[0]]){De=Pe;break}$e||($e=Pe)}De=De||$e}if(De)return De!==At[0]&&At.unshift(De),se[De]}function ia(V,j,se,le){var Pe,De,$e,st,At,Dt={},St=V.dataTypes.slice();if(St[1])for($e in V.converters)Dt[$e.toLowerCase()]=V.converters[$e];for(De=St.shift();De;)if(V.responseFields[De]&&(se[V.responseFields[De]]=j),!At&&le&&V.dataFilter&&(j=V.dataFilter(j,V.dataType)),At=De,De=St.shift(),De){if(De==="*")De=At;else if(At!=="*"&&At!==De){if($e=Dt[At+" "+De]||Dt["* "+De],!$e){for(Pe in Dt)if(st=Pe.split(" "),st[1]===De&&($e=Dt[At+" "+st[0]]||Dt["* "+st[0]],$e)){$e===!0?$e=Dt[Pe]:Dt[Pe]!==!0&&(De=st[0],St.unshift(st[1]));break}}if($e!==!0)if($e&&V.throws)j=$e(j);else try{j=$e(j)}catch(Jt){return{state:"parsererror",error:$e?Jt:"No conversion from "+At+" to "+De}}}}return{state:"success",data:j}}L.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:xs,type:"GET",isLocal:Er.test(rs[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Tn,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":L.parseJSON,"text xml":L.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(V,j){return j?Do(Do(V,L.ajaxSettings),j):Do(L.ajaxSettings,V)},ajaxPrefilter:Fs(En),ajaxTransport:Fs(Tr),ajax:function(V,j){typeof V=="object"&&(j=V,V=void 0),j=j||{};var se,le,Pe,De,$e,st,At,Dt,St=L.ajaxSetup({},j),Jt=St.context||St,ti=St.context&&(Jt.nodeType||Jt.jquery)?L(Jt):L.event,fi=L.Deferred(),zi=L.Callbacks("once memory"),Zi=St.statusCode||{},Ms={},On={},ps=0,hs="canceled",Ni={readyState:0,getResponseHeader:function(Xi){var Is;if(ps===2){if(!De)for(De={};Is=Xn.exec(Pe);)De[Is[1].toLowerCase()]=Is[2];Is=De[Xi.toLowerCase()]}return Is??null},getAllResponseHeaders:function(){return ps===2?Pe:null},setRequestHeader:function(Xi,Is){var $s=Xi.toLowerCase();return ps||(Xi=On[$s]=On[$s]||Xi,Ms[Xi]=Is),this},overrideMimeType:function(Xi){return ps||(St.mimeType=Xi),this},statusCode:function(Xi){var Is;if(Xi)if(ps<2)for(Is in Xi)Zi[Is]=[Zi[Is],Xi[Is]];else Ni.always(Xi[Ni.status]);return this},abort:function(Xi){var Is=Xi||hs;return se&&se.abort(Is),Ys(0,Is),this}};if(fi.promise(Ni).complete=zi.add,Ni.success=Ni.done,Ni.error=Ni.fail,St.url=((V||St.url||xs)+"").replace(Pn,"").replace(pr,rs[1]+"//"),St.type=j.method||j.type||St.method||St.type,St.dataTypes=L.trim(St.dataType||"*").toLowerCase().match(zt)||[""],St.crossDomain==null&&(st=hn.exec(St.url.toLowerCase()),St.crossDomain=!!(st&&(st[1]!==rs[1]||st[2]!==rs[2]||(st[3]||(st[1]==="http:"?"80":"443"))!==(rs[3]||(rs[1]==="http:"?"80":"443"))))),St.data&&St.processData&&typeof St.data!="string"&&(St.data=L.param(St.data,St.traditional)),Ba(En,St,j,Ni),ps===2)return Ni;At=St.global,At&&L.active++===0&&L.event.trigger("ajaxStart"),St.type=St.type.toUpperCase(),St.hasContent=!jn.test(St.type),le=St.url,St.hasContent||(St.data&&(le=St.url+=(Bs.test(le)?"&":"?")+St.data,delete St.data),St.cache===!1&&(St.url=js.test(le)?le.replace(js,"$1_="+Hs++):le+(Bs.test(le)?"&":"?")+"_="+Hs++)),St.ifModified&&(L.lastModified[le]&&Ni.setRequestHeader("If-Modified-Since",L.lastModified[le]),L.etag[le]&&Ni.setRequestHeader("If-None-Match",L.etag[le])),(St.data&&St.hasContent&&St.contentType!==!1||j.contentType)&&Ni.setRequestHeader("Content-Type",St.contentType),Ni.setRequestHeader("Accept",St.dataTypes[0]&&St.accepts[St.dataTypes[0]]?St.accepts[St.dataTypes[0]]+(St.dataTypes[0]!=="*"?", "+Tn+"; q=0.01":""):St.accepts["*"]);for(Dt in St.headers)Ni.setRequestHeader(Dt,St.headers[Dt]);if(St.beforeSend&&(St.beforeSend.call(Jt,Ni,St)===!1||ps===2))return Ni.abort();hs="abort";for(Dt in{success:1,error:1,complete:1})Ni[Dt](St[Dt]);if(se=Ba(Tr,St,j,Ni),!se)Ys(-1,"No Transport");else{Ni.readyState=1,At&&ti.trigger("ajaxSend",[Ni,St]),St.async&&St.timeout>0&&($e=setTimeout(function(){Ni.abort("timeout")},St.timeout));try{ps=1,se.send(Ms,Ys)}catch(Xi){if(ps<2)Ys(-1,Xi);else throw Xi}}function Ys(Xi,Is,$s,Dr){var pn,Zn,Qn,cn,fr,Zs=Is;ps!==2&&(ps=2,$e&&clearTimeout($e),se=void 0,Pe=Dr||"",Ni.readyState=Xi>0?4:0,pn=Xi>=200&&Xi<300||Xi===304,$s&&(cn=Fa(St,Ni,$s)),cn=ia(St,cn,Ni,pn),pn?(St.ifModified&&(fr=Ni.getResponseHeader("Last-Modified"),fr&&(L.lastModified[le]=fr),fr=Ni.getResponseHeader("etag"),fr&&(L.etag[le]=fr)),Xi===204||St.type==="HEAD"?Zs="nocontent":Xi===304?Zs="notmodified":(Zs=cn.state,Zn=cn.data,Qn=cn.error,pn=!Qn)):(Qn=Zs,(Xi||!Zs)&&(Zs="error",Xi<0&&(Xi=0))),Ni.status=Xi,Ni.statusText=(Is||Zs)+"",pn?fi.resolveWith(Jt,[Zn,Zs,Ni]):fi.rejectWith(Jt,[Ni,Zs,Qn]),Ni.statusCode(Zi),Zi=void 0,At&&ti.trigger(pn?"ajaxSuccess":"ajaxError",[Ni,St,pn?Zn:Qn]),zi.fireWith(Jt,[Ni,Zs]),At&&(ti.trigger("ajaxComplete",[Ni,St]),--L.active||L.event.trigger("ajaxStop")))}return Ni},getJSON:function(V,j,se){return L.get(V,j,se,"json")},getScript:function(V,j){return L.get(V,void 0,j,"script")}}),L.each(["get","post"],function(V,j){L[j]=function(se,le,Pe,De){return L.isFunction(le)&&(De=De||Pe,Pe=le,le=void 0),L.ajax({url:se,type:j,dataType:De,data:le,success:Pe})}}),L.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(V,j){L.fn[j]=function(se){return this.on(j,se)}}),L._evalUrl=function(V){return L.ajax({url:V,type:"GET",dataType:"script",async:!1,global:!1,throws:!0})},L.fn.extend({wrapAll:function(V){var j;return L.isFunction(V)?this.each(function(se){L(this).wrapAll(V.call(this,se))}):(this[0]&&(j=L(V,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&j.insertBefore(this[0]),j.map(function(){for(var se=this;se.firstElementChild;)se=se.firstElementChild;return se}).append(this)),this)},wrapInner:function(V){return L.isFunction(V)?this.each(function(j){L(this).wrapInner(V.call(this,j))}):this.each(function(){var j=L(this),se=j.contents();se.length?se.wrapAll(V):j.append(V)})},wrap:function(V){var j=L.isFunction(V);return this.each(function(se){L(this).wrapAll(j?V.call(this,se):V)})},unwrap:function(){return this.parent().each(function(){L.nodeName(this,"body")||L(this).replaceWith(this.childNodes)}).end()}}),L.expr.filters.hidden=function(V){return V.offsetWidth<=0&&V.offsetHeight<=0},L.expr.filters.visible=function(V){return!L.expr.filters.hidden(V)};var dl=/%20/g,qa=/\[\]$/,xo=/\r?\n/g,sa=/^(?:submit|button|image|reset|file)$/i,Jr=/^(?:input|select|textarea|keygen)/i;function Io(V,j,se,le){var Pe;if(L.isArray(j))L.each(j,function(De,$e){se||qa.test(V)?le(V,$e):Io(V+"["+(typeof $e=="object"?De:"")+"]",$e,se,le)});else if(!se&&L.type(j)==="object")for(Pe in j)Io(V+"["+Pe+"]",j[Pe],se,le);else le(V,j)}L.param=function(V,j){var se,le=[],Pe=function(De,$e){$e=L.isFunction($e)?$e():$e??"",le[le.length]=encodeURIComponent(De)+"="+encodeURIComponent($e)};if(j===void 0&&(j=L.ajaxSettings&&L.ajaxSettings.traditional),L.isArray(V)||V.jquery&&!L.isPlainObject(V))L.each(V,function(){Pe(this.name,this.value)});else for(se in V)Io(se,V[se],j,Pe);return le.join("&").replace(dl,"+")},L.fn.extend({serialize:function(){return L.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var V=L.prop(this,"elements");return V?L.makeArray(V):this}).filter(function(){var V=this.type;return this.name&&!L(this).is(":disabled")&&Jr.test(this.nodeName)&&!sa.test(V)&&(this.checked||!qi.test(V))}).map(function(V,j){var se=L(this).val();return se==null?null:L.isArray(se)?L.map(se,function(le){return{name:j.name,value:le.replace(xo,`\r
`)}}):{name:j.name,value:se.replace(xo,`\r
`)}}).get()}}),L.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch{}};var go=0,Vo={},Ha={0:200,1223:204},Lr=L.ajaxSettings.xhr();t.ActiveXObject&&L(t).on("unload",function(){for(var V in Vo)Vo[V]()}),O.cors=!!Lr&&"withCredentials"in Lr,O.ajax=Lr=!!Lr,L.ajaxTransport(function(V){var j;if(O.cors||Lr&&!V.crossDomain)return{send:function(se,le){var Pe,De=V.xhr(),$e=++go;if(De.open(V.type,V.url,V.async,V.username,V.password),V.xhrFields)for(Pe in V.xhrFields)De[Pe]=V.xhrFields[Pe];V.mimeType&&De.overrideMimeType&&De.overrideMimeType(V.mimeType),!V.crossDomain&&!se["X-Requested-With"]&&(se["X-Requested-With"]="XMLHttpRequest");for(Pe in se)De.setRequestHeader(Pe,se[Pe]);j=function(st){return function(){j&&(delete Vo[$e],j=De.onload=De.onerror=null,st==="abort"?De.abort():st==="error"?le(De.status,De.statusText):le(Ha[De.status]||De.status,De.statusText,typeof De.responseText=="string"?{text:De.responseText}:void 0,De.getAllResponseHeaders()))}},De.onload=j(),De.onerror=j("error"),j=Vo[$e]=j("abort"),De.send(V.hasContent&&V.data||null)},abort:function(){j&&j()}}}),L.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(V){return L.globalEval(V),V}}}),L.ajaxPrefilter("script",function(V){V.cache===void 0&&(V.cache=!1),V.crossDomain&&(V.type="GET")}),L.ajaxTransport("script",function(V){if(V.crossDomain){var j,se;return{send:function(le,Pe){j=L("<script>").prop({async:!0,charset:V.scriptCharset,src:V.url}).on("load error",se=function(De){j.remove(),se=null,De&&Pe(De.type==="error"?404:200,De.type)}),I.head.appendChild(j[0])},abort:function(){se&&se()}}}});var Cr=[],eo=/(=)\?(?=&|$)|\?\?/;L.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var V=Cr.pop()||L.expando+"_"+Hs++;return this[V]=!0,V}}),L.ajaxPrefilter("json jsonp",function(V,j,se){var le,Pe,De,$e=V.jsonp!==!1&&(eo.test(V.url)?"url":typeof V.data=="string"&&!(V.contentType||"").indexOf("application/x-www-form-urlencoded")&&eo.test(V.data)&&"data");if($e||V.dataTypes[0]==="jsonp")return le=V.jsonpCallback=L.isFunction(V.jsonpCallback)?V.jsonpCallback():V.jsonpCallback,$e?V[$e]=V[$e].replace(eo,"$1"+le):V.jsonp!==!1&&(V.url+=(Bs.test(V.url)?"&":"?")+V.jsonp+"="+le),V.converters["script json"]=function(){return De||L.error(le+" was not called"),De[0]},V.dataTypes[0]="json",Pe=t[le],t[le]=function(){De=arguments},se.always(function(){t[le]=Pe,V[le]&&(V.jsonpCallback=j.jsonpCallback,Cr.push(le)),De&&L.isFunction(Pe)&&Pe(De[0]),De=Pe=void 0}),"script"}),L.parseHTML=function(V,j,se){if(!V||typeof V!="string")return null;typeof j=="boolean"&&(se=j,j=!1),j=j||I;var le=ye.exec(V),Pe=!se&&[];return le?[j.createElement(le[1])]:(le=L.buildFragment([V],j,Pe),Pe&&Pe.length&&L(Pe).remove(),L.merge([],le.childNodes))};var na=L.fn.load;L.fn.load=function(V,j,se){if(typeof V!="string"&&na)return na.apply(this,arguments);var le,Pe,De,$e=this,st=V.indexOf(" ");return st>=0&&(le=V.slice(st),V=V.slice(0,st)),L.isFunction(j)?(se=j,j=void 0):j&&typeof j=="object"&&(Pe="POST"),$e.length>0&&L.ajax({url:V,type:Pe,dataType:"html",data:j}).done(function(At){De=arguments,$e.html(le?L("<div>").append(L.parseHTML(At)).find(le):At)}).complete(se&&function(At,Dt){$e.each(se,De||[At.responseText,Dt,At])}),this},L.expr.filters.animated=function(V){return L.grep(L.timers,function(j){return V===j.elem}).length};var to=t.document.documentElement;function za(V){return L.isWindow(V)?V:V.nodeType===9&&V.defaultView}L.offset={setOffset:function(V,j,se){var le,Pe,De,$e,st,At,Dt,St=L.css(V,"position"),Jt=L(V),ti={};St==="static"&&(V.style.position="relative"),st=Jt.offset(),De=L.css(V,"top"),At=L.css(V,"left"),Dt=(St==="absolute"||St==="fixed")&&(De+At).indexOf("auto")>-1,Dt?(le=Jt.position(),$e=le.top,Pe=le.left):($e=parseFloat(De)||0,Pe=parseFloat(At)||0),L.isFunction(j)&&(j=j.call(V,se,st)),j.top!=null&&(ti.top=j.top-st.top+$e),j.left!=null&&(ti.left=j.left-st.left+Pe),"using"in j?j.using.call(V,ti):Jt.css(ti)}},L.fn.extend({offset:function(V){if(arguments.length)return V===void 0?this:this.each(function($e){L.offset.setOffset(this,V,$e)});var j,se,le=this[0],Pe={top:0,left:0},De=le&&le.ownerDocument;if(De)return j=De.documentElement,L.contains(j,le)?(typeof le.getBoundingClientRect!==Kt&&(Pe=le.getBoundingClientRect()),se=za(De),{top:Pe.top+se.pageYOffset-j.clientTop,left:Pe.left+se.pageXOffset-j.clientLeft}):Pe},position:function(){if(this[0]){var V,j,se=this[0],le={top:0,left:0};return L.css(se,"position")==="fixed"?j=se.getBoundingClientRect():(V=this.offsetParent(),j=this.offset(),L.nodeName(V[0],"html")||(le=V.offset()),le.top+=L.css(V[0],"borderTopWidth",!0),le.left+=L.css(V[0],"borderLeftWidth",!0)),{top:j.top-le.top-L.css(se,"marginTop",!0),left:j.left-le.left-L.css(se,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var V=this.offsetParent||to;V&&!L.nodeName(V,"html")&&L.css(V,"position")==="static";)V=V.offsetParent;return V||to})}}),L.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(V,j){var se=j==="pageYOffset";L.fn[V]=function(le){return Nt(this,function(Pe,De,$e){var st=za(Pe);if($e===void 0)return st?st[j]:Pe[De];st?st.scrollTo(se?t.pageXOffset:$e,se?$e:t.pageYOffset):Pe[De]=$e},V,le,arguments.length,null)}}),L.each(["top","left"],function(V,j){L.cssHooks[j]=ke(O.pixelPosition,function(se,le){if(le)return le=Ae(se,j),Ne.test(le)?L(se).position()[j]+"px":le})}),L.each({Height:"height",Width:"width"},function(V,j){L.each({padding:"inner"+V,content:j,"":"outer"+V},function(se,le){L.fn[le]=function(Pe,De){var $e=arguments.length&&(se||typeof Pe!="boolean"),st=se||(Pe===!0||De===!0?"margin":"border");return Nt(this,function(At,Dt,St){var Jt;return L.isWindow(At)?At.document.documentElement["client"+V]:At.nodeType===9?(Jt=At.documentElement,Math.max(At.body["scroll"+V],Jt["scroll"+V],At.body["offset"+V],Jt["offset"+V],Jt["client"+V])):St===void 0?L.css(At,Dt,st):L.style(At,Dt,St,st)},j,$e?Pe:void 0,$e,null)}})}),L.fn.size=function(){return this.length},L.fn.andSelf=L.fn.addBack;var Yr=t.jQuery,pl=t.$;return L.noConflict=function(V){return t.$===L&&(t.$=pl),V&&t.jQuery===L&&(t.jQuery=Yr),L},typeof s===Kt&&(t.jQuery=t.$=L),L})})();var lodash4_17_4={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright JS Foundation and other contributors <https://js.foundation/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */lodash4_17_4.exports;(function(a,t){(function(){var s,r="4.17.4",o=200,n="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",l="Expected a function",h="__lodash_hash_undefined__",g=500,d="__lodash_placeholder__",A=1,S=2,O=4,I=1,W=2,L=1,H=2,Y=4,Q=8,pe=16,de=32,fe=64,ye=128,Ee=256,Le=512,Z=30,ne="...",Ke=800,_t=16,xe=1,Ct=2,zt=3,Je=1/0,Et=9007199254740991,ht=17976931348623157e292,mt=NaN,Nt=4294967295,Gt=Nt-1,Mt=Nt>>>1,jt=[["ary",ye],["bind",L],["bindKey",H],["curry",Q],["curryRight",pe],["flip",Le],["partial",de],["partialRight",fe],["rearg",Ee]],Ai="[object Arguments]",oi="[object Array]",ki="[object AsyncFunction]",Li="[object Boolean]",Wi="[object Date]",Vi="[object DOMException]",qi="[object Error]",Kt="[object Function]",zs="[object GeneratorFunction]",ls="[object Map]",gs="[object Number]",Ws="[object Null]",K="[object Object]",He="[object Promise]",We="[object Proxy]",it="[object RegExp]",et="[object Set]",Ie="[object String]",Ve="[object Symbol]",Me="[object Undefined]",yt="[object WeakMap]",u="[object WeakSet]",y="[object ArrayBuffer]",w="[object DataView]",D="[object Float32Array]",N="[object Float64Array]",U="[object Int8Array]",te="[object Int16Array]",J="[object Int32Array]",ie="[object Uint8Array]",ae="[object Uint8ClampedArray]",ve="[object Uint16Array]",Se="[object Uint32Array]",be=/\b__p \+= '';/g,ge=/\b(__p \+=) '' \+/g,Ce=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Ne=/&(?:amp|lt|gt|quot|#39);/g,qe=/[&<>"']/g,Ae=RegExp(Ne.source),ke=RegExp(qe.source),me=/<%-([\s\S]+?)%>/g,Te=/<%([\s\S]+?)%>/g,Re=/<%=([\s\S]+?)%>/g,Fe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ye=/^\w*$/,je=/^\./,Ze=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,tt=/[\\^$.*+?()[\]{}|]/g,ut=RegExp(tt.source),nt=/^\s+|\s+$/g,pt=/^\s+/,ft=/\s+$/,wt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Tt=/\{\n\/\* \[wrapped with (.+)\] \*/,Vt=/,? & /,ni=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ai=/\\(\\)?/g,Ht=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Ci=/\w*$/,Ti=/^[-+]0x[0-9a-f]+$/i,Pi=/^0b[01]+$/i,wi=/^\[object .+?Constructor\]$/,Qt=/^0o[0-7]+$/i,Oi=/^(?:0|[1-9]\d*)$/,ds=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Lt=/($^)/,Qi=/['\n\r\u2028\u2029\\]/g,Ki="\\ud800-\\udfff",Ri="\\u0300-\\u036f",Xs="\\ufe20-\\ufe2f",on="\\u20d0-\\u20ff",Hs=Ri+Xs+on,Bs="\\u2700-\\u27bf",rs="a-z\\xdf-\\xf6\\xf8-\\xff",xs="\\xac\\xb1\\xd7\\xf7",Pn="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",js="\\u2000-\\u206f",Xn=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Er="A-Z\\xc0-\\xd6\\xd8-\\xde",jn="\\ufe0e\\ufe0f",pr=xs+Pn+js+Xn,hn="['’]",En="["+Ki+"]",Tr="["+pr+"]",Tn="["+Hs+"]",Fs="\\d+",Ba="["+Bs+"]",Do="["+rs+"]",Fa="[^"+Ki+pr+Fs+Bs+rs+Er+"]",ia="\\ud83c[\\udffb-\\udfff]",dl="(?:"+Tn+"|"+ia+")",qa="[^"+Ki+"]",xo="(?:\\ud83c[\\udde6-\\uddff]){2}",sa="[\\ud800-\\udbff][\\udc00-\\udfff]",Jr="["+Er+"]",Io="\\u200d",go="(?:"+Do+"|"+Fa+")",Vo="(?:"+Jr+"|"+Fa+")",Ha="(?:"+hn+"(?:d|ll|m|re|s|t|ve))?",Lr="(?:"+hn+"(?:D|LL|M|RE|S|T|VE))?",Cr=dl+"?",eo="["+jn+"]?",na="(?:"+Io+"(?:"+[qa,xo,sa].join("|")+")"+eo+Cr+")*",to="\\d*(?:(?:1st|2nd|3rd|(?![123])\\dth)\\b)",za="\\d*(?:(?:1ST|2ND|3RD|(?![123])\\dTH)\\b)",Yr=eo+Cr+na,pl="(?:"+[Ba,xo,sa].join("|")+")"+Yr,V="(?:"+[qa+Tn+"?",Tn,xo,sa,En].join("|")+")",j=RegExp(hn,"g"),se=RegExp(Tn,"g"),le=RegExp(ia+"(?="+ia+")|"+V+Yr,"g"),Pe=RegExp([Jr+"?"+Do+"+"+Ha+"(?="+[Tr,Jr,"$"].join("|")+")",Vo+"+"+Lr+"(?="+[Tr,Jr+go,"$"].join("|")+")",Jr+"?"+go+"+"+Ha,Jr+"+"+Lr,za,to,Fs,pl].join("|"),"g"),De=RegExp("["+Io+Ki+Hs+jn+"]"),$e=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,st=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],At=-1,Dt={};Dt[D]=Dt[N]=Dt[U]=Dt[te]=Dt[J]=Dt[ie]=Dt[ae]=Dt[ve]=Dt[Se]=!0,Dt[Ai]=Dt[oi]=Dt[y]=Dt[Li]=Dt[w]=Dt[Wi]=Dt[qi]=Dt[Kt]=Dt[ls]=Dt[gs]=Dt[K]=Dt[it]=Dt[et]=Dt[Ie]=Dt[yt]=!1;var St={};St[Ai]=St[oi]=St[y]=St[w]=St[Li]=St[Wi]=St[D]=St[N]=St[U]=St[te]=St[J]=St[ls]=St[gs]=St[K]=St[it]=St[et]=St[Ie]=St[Ve]=St[ie]=St[ae]=St[ve]=St[Se]=!0,St[qi]=St[Kt]=St[yt]=!1;var Jt={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},ti={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},fi={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},zi={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Zi=parseFloat,Ms=parseInt,On=typeof commonjsGlobal=="object"&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,ps=typeof self=="object"&&self&&self.Object===Object&&self,hs=On||ps||Function("return this")(),Ni=t&&!t.nodeType&&t,Ys=Ni&&!0&&a&&!a.nodeType&&a,Xi=Ys&&Ys.exports===Ni,Is=Xi&&On.process,$s=function(){try{return Is&&Is.binding&&Is.binding("util")}catch{}}(),Dr=$s&&$s.isArrayBuffer,pn=$s&&$s.isDate,Zn=$s&&$s.isMap,Qn=$s&&$s.isRegExp,cn=$s&&$s.isSet,fr=$s&&$s.isTypedArray;function Zs(ct,Ot){return ct.set(Ot[0],Ot[1]),ct}function gr(ct,Ot){return ct.add(Ot),ct}function gn(ct,Ot,It){switch(It.length){case 0:return ct.call(Ot);case 1:return ct.call(Ot,It[0]);case 2:return ct.call(Ot,It[0],It[1]);case 3:return ct.call(Ot,It[0],It[1],It[2])}return ct.apply(Ot,It)}function xr(ct,Ot,It,li){for(var xi=-1,Ii=ct==null?0:ct.length;++xi<Ii;){var Rs=ct[xi];Ot(li,Rs,It(Rs),ct)}return li}function dn(ct,Ot){for(var It=-1,li=ct==null?0:ct.length;++It<li&&Ot(ct[It],It,ct)!==!1;);return ct}function Ps(ct,Ot){for(var It=ct==null?0:ct.length;It--&&Ot(ct[It],It,ct)!==!1;);return ct}function Ir(ct,Ot){for(var It=-1,li=ct==null?0:ct.length;++It<li;)if(!Ot(ct[It],It,ct))return!1;return!0}function Fn(ct,Ot){for(var It=-1,li=ct==null?0:ct.length,xi=0,Ii=[];++It<li;){var Rs=ct[It];Ot(Rs,It,ct)&&(Ii[xi++]=Rs)}return Ii}function mo(ct,Ot){var It=ct==null?0:ct.length;return!!It&&Xr(ct,Ot,0)>-1}function Kr(ct,Ot,It){for(var li=-1,xi=ct==null?0:ct.length;++li<xi;)if(It(Ot,ct[li]))return!0;return!1}function Ls(ct,Ot){for(var It=-1,li=ct==null?0:ct.length,xi=Array(li);++It<li;)xi[It]=Ot(ct[It],It,ct);return xi}function Vr(ct,Ot){for(var It=-1,li=Ot.length,xi=ct.length;++It<li;)ct[xi+It]=Ot[It];return ct}function yo(ct,Ot,It,li){var xi=-1,Ii=ct==null?0:ct.length;for(li&&Ii&&(It=ct[++xi]);++xi<Ii;)It=Ot(It,ct[xi],xi,ct);return It}function ra(ct,Ot,It,li){var xi=ct==null?0:ct.length;for(li&&xi&&(It=ct[--xi]);xi--;)It=Ot(It,ct[xi],xi,ct);return It}function oa(ct,Ot){for(var It=-1,li=ct==null?0:ct.length;++It<li;)if(Ot(ct[It],It,ct))return!0;return!1}var fl=qn("length");function Oo(ct){return ct.split("")}function gl(ct){return ct.match(ni)||[]}function $a(ct,Ot,It){var li;return It(ct,function(xi,Ii,Rs){if(Ot(xi,Ii,Rs))return li=Ii,!1}),li}function Or(ct,Ot,It,li){for(var xi=ct.length,Ii=It+(li?1:-1);li?Ii--:++Ii<xi;)if(Ot(ct[Ii],Ii,ct))return Ii;return-1}function Xr(ct,Ot,It){return Ot===Ot?Bt(ct,Ot,It):Or(ct,la,It)}function aa(ct,Ot,It,li){for(var xi=It-1,Ii=ct.length;++xi<Ii;)if(li(ct[xi],Ot))return xi;return-1}function la(ct){return ct!==ct}function mr(ct,Ot){var It=ct==null?0:ct.length;return It?yn(ct,Ot)/It:mt}function qn(ct){return function(Ot){return Ot==null?s:Ot[ct]}}function Es(ct){return function(Ot){return ct==null?s:ct[Ot]}}function io(ct,Ot,It,li,xi){return xi(ct,function(Ii,Rs,ys){It=li?(li=!1,Ii):Ot(It,Ii,Rs,ys)}),It}function Hn(ct,Ot){var It=ct.length;for(ct.sort(Ot);It--;)ct[It]=ct[It].value;return ct}function yn(ct,Ot){for(var It,li=-1,xi=ct.length;++li<xi;){var Ii=Ot(ct[li]);Ii!==s&&(It=It===s?Ii:It+Ii)}return It}function yr(ct,Ot){for(var It=-1,li=Array(ct);++It<ct;)li[It]=Ot(It);return li}function zn(ct,Ot){return Ls(Ot,function(It){return[It,ct[It]]})}function Ln(ct){return function(Ot){return ct(Ot)}}function ha(ct,Ot){return Ls(Ot,function(It){return ct[It]})}function $n(ct,Ot){return ct.has(Ot)}function Mo(ct,Ot){for(var It=-1,li=ct.length;++It<li&&Xr(Ot,ct[It],0)>-1;);return It}function ca(ct,Ot){for(var It=ct.length;It--&&Xr(Ot,ct[It],0)>-1;);return It}function ko(ct,Ot){for(var It=ct.length,li=0;It--;)ct[It]===Ot&&++li;return li}var Ro=Es(Jt),da=Es(ti);function pa(ct){return"\\"+zi[ct]}function No(ct,Ot){return ct==null?s:ct[Ot]}function Mr(ct){return De.test(ct)}function fa(ct){return $e.test(ct)}function Ua(ct){for(var Ot,It=[];!(Ot=ct.next()).done;)It.push(Ot.value);return It}function Cn(ct){var Ot=-1,It=Array(ct.size);return ct.forEach(function(li,xi){It[++Ot]=[xi,li]}),It}function ga(ct,Ot){return function(It){return ct(Ot(It))}}function Ue(ct,Ot){for(var It=-1,li=ct.length,xi=0,Ii=[];++It<li;){var Rs=ct[It];(Rs===Ot||Rs===d)&&(ct[It]=d,Ii[xi++]=It)}return Ii}function ot(ct){var Ot=-1,It=Array(ct.size);return ct.forEach(function(li){It[++Ot]=li}),It}function vt(ct){var Ot=-1,It=Array(ct.size);return ct.forEach(function(li){It[++Ot]=[li,li]}),It}function Bt(ct,Ot,It){for(var li=It-1,xi=ct.length;++li<xi;)if(ct[li]===Ot)return li;return-1}function xt(ct,Ot,It){for(var li=It+1;li--;)if(ct[li]===Ot)return li;return li}function Wt(ct){return Mr(ct)?Di(ct):fl(ct)}function Ut(ct){return Mr(ct)?Yi(ct):Oo(ct)}var ui=Es(fi);function Di(ct){for(var Ot=le.lastIndex=0;le.test(ct);)++Ot;return Ot}function Yi(ct){return ct.match(le)||[]}function Ui(ct){return ct.match(Pe)||[]}var Bi=function ct(Ot){Ot=Ot==null?hs:ms.defaults(hs.Object(),Ot,ms.pick(hs,st));var It=Ot.Array,li=Ot.Date,xi=Ot.Error,Ii=Ot.Function,Rs=Ot.Math,ys=Ot.Object,ml=Ot.RegExp,Wh=Ot.String,Jn=Ot.TypeError,Ga=It.prototype,Yh=Ii.prototype,ma=ys.prototype,Wa=Ot["__core-js_shared__"],Ya=Yh.toString,qs=ma.hasOwnProperty,ya=0,yi=function(){var b=/[^.]+$/.exec(Wa&&Wa.keys&&Wa.keys.IE_PROTO||"");return b?"Symbol(src)_1."+b:""}(),vs=ma.toString,oh=Ya.call(ys),Kh=hs._,Xh=ml("^"+Ya.call(qs).replace(tt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Un=Xi?Ot.Buffer:s,ss=Ot.Symbol,bo=Ot.Uint8Array,yl=Un?Un.allocUnsafe:s,Ka=ga(ys.getPrototypeOf,ys),ah=ys.create,lh=ma.propertyIsEnumerable,Xa=Ga.splice,hh=ss?ss.isConcatSpreadable:s,ba=ss?ss.iterator:s,so=ss?ss.toStringTag:s,va=function(){try{var b=Da(ys,"defineProperty");return b({},"",{}),b}catch{}}(),jh=Ot.clearTimeout!==hs.clearTimeout&&Ot.clearTimeout,bn=li&&li.now!==hs.Date.now&&li.now,ja=Ot.setTimeout!==hs.setTimeout&&Ot.setTimeout,jr=Rs.ceil,Sa=Rs.floor,ts=ys.getOwnPropertySymbols,uh=Un?Un.isBuffer:s,ch=Ot.isFinite,Wu=Ga.join,Bo=ga(ys.keys,ys),Js=Rs.max,_n=Rs.min,Yu=li.now,Ku=Ot.parseInt,er=Rs.random,bl=Ga.reverse,Za=Da(Ot,"DataView"),no=Da(Ot,"Map"),vl=Da(Ot,"Promise"),Fo=Da(Ot,"Set"),Aa=Da(Ot,"WeakMap"),wa=Da(ys,"create"),Qa=Aa&&new Aa,Pa={},Zh=xa(Za),Qh=xa(no),Jh=xa(vl),eu=xa(Fo),dh=xa(Aa),Dn=ss?ss.prototype:s,Ea=Dn?Dn.valueOf:s,ph=Dn?Dn.toString:s;function ze(b){if(nn(b)&&!is(b)&&!(b instanceof us)){if(b instanceof tr)return b;if(qs.call(b,"__wrapped__"))return Nc(b)}return new tr(b)}var qo=function(){function b(){}return function(E){if(!Qs(E))return{};if(ah)return ah(E);b.prototype=E;var q=new b;return b.prototype=s,q}}();function Ta(){}function tr(b,E){this.__wrapped__=b,this.__actions__=[],this.__chain__=!!E,this.__index__=0,this.__values__=s}ze.templateSettings={escape:me,evaluate:Te,interpolate:Re,variable:"",imports:{_:ze}},ze.prototype=Ta.prototype,ze.prototype.constructor=ze,tr.prototype=qo(Ta.prototype),tr.prototype.constructor=tr;function us(b){this.__wrapped__=b,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Nt,this.__views__=[]}function La(){var b=new us(this.__wrapped__);return b.__actions__=sr(this.__actions__),b.__dir__=this.__dir__,b.__filtered__=this.__filtered__,b.__iteratees__=sr(this.__iteratees__),b.__takeCount__=this.__takeCount__,b.__views__=sr(this.__views__),b}function _l(){if(this.__filtered__){var b=new us(this);b.__dir__=-1,b.__filtered__=!0}else b=this.clone(),b.__dir__*=-1;return b}function vo(){var b=this.__wrapped__.value(),E=this.__dir__,q=is(b),ce=E<0,Oe=q?b.length:0,Ge=op(0,Oe,this.__views__),rt=Ge.start,bt=Ge.end,Pt=bt-rt,Zt=ce?bt:rt-1,Xt=this.__iteratees__,si=Xt.length,mi=0,Ei=_n(Pt,this.__takeCount__);if(!q||!ce&&Oe==Pt&&Ei==Pt)return lc(b,this.__actions__);var Gi=[];e:for(;Pt--&&mi<Ei;){Zt+=E;for(var fs=-1,ji=b[Zt];++fs<si;){var Ss=Xt[fs],Os=Ss.iteratee,Wn=Ss.type,Yn=Os(ji);if(Wn==Ct)ji=Yn;else if(!Yn){if(Wn==xe)continue e;break e}}Gi[mi++]=ji}return Gi}us.prototype=qo(Ta.prototype),us.prototype.constructor=us;function _o(b){var E=-1,q=b==null?0:b.length;for(this.clear();++E<q;){var ce=b[E];this.set(ce[0],ce[1])}}function fh(){this.__data__=wa?wa(null):{},this.size=0}function Sl(b){var E=this.has(b)&&delete this.__data__[b];return this.size-=E?1:0,E}function Ja(b){var E=this.__data__;if(wa){var q=E[b];return q===h?s:q}return qs.call(E,b)?E[b]:s}function tu(b){var E=this.__data__;return wa?E[b]!==s:qs.call(E,b)}function Al(b,E){var q=this.__data__;return this.size+=this.has(b)?0:1,q[b]=wa&&E===s?h:E,this}_o.prototype.clear=fh,_o.prototype.delete=Sl,_o.prototype.get=Ja,_o.prototype.has=tu,_o.prototype.set=Al;function m(b){var E=-1,q=b==null?0:b.length;for(this.clear();++E<q;){var ce=b[E];this.set(ce[0],ce[1])}}function T(){this.__data__=[],this.size=0}function x(b){var E=this.__data__,q=ei(E,b);if(q<0)return!1;var ce=E.length-1;return q==ce?E.pop():Xa.call(E,q,1),--this.size,!0}function C(b){var E=this.__data__,q=ei(E,b);return q<0?s:E[q][1]}function B(b){return ei(this.__data__,b)>-1}function F(b,E){var q=this.__data__,ce=ei(q,b);return ce<0?(++this.size,q.push([b,E])):q[ce][1]=E,this}m.prototype.clear=T,m.prototype.delete=x,m.prototype.get=C,m.prototype.has=B,m.prototype.set=F;function R(b){var E=-1,q=b==null?0:b.length;for(this.clear();++E<q;){var ce=b[E];this.set(ce[0],ce[1])}}function G(){this.size=0,this.__data__={hash:new _o,map:new(no||m),string:new _o}}function ee(b){var E=Eh(this,b).delete(b);return this.size-=E?1:0,E}function z(b){return Eh(this,b).get(b)}function X(b){return Eh(this,b).has(b)}function oe(b,E){var q=Eh(this,b),ce=q.size;return q.set(b,E),this.size+=q.size==ce?0:1,this}R.prototype.clear=G,R.prototype.delete=ee,R.prototype.get=z,R.prototype.has=X,R.prototype.set=oe;function ue(b){var E=-1,q=b==null?0:b.length;for(this.__data__=new R;++E<q;)this.add(b[E])}function re(b){return this.__data__.set(b,h),this}function we(b){return this.__data__.has(b)}ue.prototype.add=ue.prototype.push=re,ue.prototype.has=we;function _e(b){var E=this.__data__=new m(b);this.size=E.size}function Be(){this.__data__=new m,this.size=0}function Xe(b){var E=this.__data__,q=E.delete(b);return this.size=E.size,q}function Qe(b){return this.__data__.get(b)}function at(b){return this.__data__.has(b)}function kt(b,E){var q=this.__data__;if(q instanceof m){var ce=q.__data__;if(!no||ce.length<o-1)return ce.push([b,E]),this.size=++q.size,this;q=this.__data__=new R(ce)}return q.set(b,E),this.size=q.size,this}_e.prototype.clear=Be,_e.prototype.delete=Xe,_e.prototype.get=Qe,_e.prototype.has=at,_e.prototype.set=kt;function hi(b,E){var q=is(b),ce=!q&&Ia(b),Oe=!q&&!ce&&Go(b),Ge=!q&&!ce&&!Oe&&nl(b),rt=q||ce||Oe||Ge,bt=rt?yr(b.length,Wh):[],Pt=bt.length;for(var Zt in b)(E||qs.call(b,Zt))&&!(rt&&(Zt=="length"||Oe&&(Zt=="offset"||Zt=="parent")||Ge&&(Zt=="buffer"||Zt=="byteLength"||Zt=="byteOffset")||Po(Zt,Pt)))&&bt.push(Zt);return bt}function ri(b){var E=b.length;return E?b[ou(0,E-1)]:s}function dt(b,E){return Th(sr(b),vi(E,0,b.length))}function Yt(b){return Th(sr(b))}function ii(b,E,q){(q!==s&&!lo(b[E],q)||q===s&&!(E in b))&&lt(b,E,q)}function qt(b,E,q){var ce=b[E];(!(qs.call(b,E)&&lo(ce,q))||q===s&&!(E in b))&&lt(b,E,q)}function ei(b,E){for(var q=b.length;q--;)if(lo(b[q][0],E))return q;return-1}function Rt(b,E,q,ce){return Us(b,function(Oe,Ge,rt){E(ce,Oe,q(Oe),rt)}),ce}function $t(b,E){return b&&oo(E,Sn(E),b)}function Ft(b,E){return b&&oo(E,Sr(E),b)}function lt(b,E,q){E=="__proto__"&&va?va(b,E,{configurable:!0,enumerable:!0,value:q,writable:!0}):b[E]=q}function di(b,E){for(var q=-1,ce=E.length,Oe=It(ce),Ge=b==null;++q<ce;)Oe[q]=Ge?s:Iu(b,E[q]);return Oe}function vi(b,E,q){return b===b&&(q!==s&&(b=b<=q?b:q),E!==s&&(b=b>=E?b:E)),b}function gi(b,E,q,ce,Oe,Ge){var rt,bt=E&A,Pt=E&S,Zt=E&O;if(q&&(rt=Oe?q(b,ce,Oe,Ge):q(b)),rt!==s)return rt;if(!Qs(b))return b;var Xt=is(b);if(Xt){if(rt=lp(b),!bt)return sr(b,rt)}else{var si=Mn(b),mi=si==Kt||si==zs;if(Go(b))return uc(b,bt);if(si==K||si==Ai||mi&&!Oe){if(rt=Pt||mi?{}:Cc(b),!bt)return Pt?Zd(b,Ft(rt,b)):jd(b,$t(rt,b))}else{if(!St[si])return Oe?b:{};rt=hp(b,si,gi,bt)}}Ge||(Ge=new _e);var Ei=Ge.get(b);if(Ei)return Ei;Ge.set(b,rt);var Gi=Zt?Pt?bu:yu:Pt?Sr:Sn,fs=Xt?s:Gi(b);return dn(fs||b,function(ji,Ss){fs&&(Ss=ji,ji=b[Ss]),qt(rt,Ss,gi(ji,E,q,Ss,b,Ge))}),rt}function Si(b){var E=Sn(b);return function(q){return Fi(q,b,E)}}function Fi(b,E,q){var ce=q.length;if(b==null)return!ce;for(b=ys(b);ce--;){var Oe=q[ce],Ge=E[Oe],rt=b[Oe];if(rt===s&&!(Oe in b)||!Ge(rt))return!1}return!0}function Ts(b,E,q){if(typeof b!="function")throw new Jn(l);return Ll(function(){b.apply(s,q)},E)}function pi(b,E,q,ce){var Oe=-1,Ge=mo,rt=!0,bt=b.length,Pt=[],Zt=E.length;if(!bt)return Pt;q&&(E=Ls(E,Ln(q))),ce?(Ge=Kr,rt=!1):E.length>=o&&(Ge=$n,rt=!1,E=new ue(E));e:for(;++Oe<bt;){var Xt=b[Oe],si=q==null?Xt:q(Xt);if(Xt=ce||Xt!==0?Xt:0,rt&&si===si){for(var mi=Zt;mi--;)if(E[mi]===si)continue e;Pt.push(Xt)}else Ge(E,si,ce)||Pt.push(Xt)}return Pt}var Us=gc(Gn),os=gc(br,!0);function Ho(b,E){var q=!0;return Us(b,function(ce,Oe,Ge){return q=!!E(ce,Oe,Ge),q}),q}function mn(b,E,q){for(var ce=-1,Oe=b.length;++ce<Oe;){var Ge=b[ce],rt=E(Ge);if(rt!=null&&(bt===s?rt===rt&&!_r(rt):q(rt,bt)))var bt=rt,Pt=Ge}return Pt}function en(b,E,q,ce){var Oe=b.length;for(q=ns(q),q<0&&(q=-q>Oe?0:Oe+q),ce=ce===s||ce>Oe?Oe:ns(ce),ce<0&&(ce+=Oe),ce=q>ce?0:sd(ce);q<ce;)b[q++]=E;return b}function Zr(b,E){var q=[];return Us(b,function(ce,Oe,Ge){E(ce,Oe,Ge)&&q.push(ce)}),q}function ws(b,E,q,ce,Oe){var Ge=-1,rt=b.length;for(q||(q=cp),Oe||(Oe=[]);++Ge<rt;){var bt=b[Ge];E>0&&q(bt)?E>1?ws(bt,E-1,q,ce,Oe):Vr(Oe,bt):ce||(Oe[Oe.length]=bt)}return Oe}var tn=mc(),Ji=mc(!0);function Gn(b,E){return b&&tn(b,E,Sn)}function br(b,E){return b&&Ji(b,E,Sn)}function xn(b,E){return Fn(E,function(q){return Eo(b[q])})}function Mi(b,E){E=$o(E,b);for(var q=0,ce=E.length;b!=null&&q<ce;)b=b[ao(E[q++])];return q&&q==ce?b:s}function Ns(b,E,q){var ce=E(b);return is(b)?ce:Vr(ce,q(b))}function Ks(b){return b==null?b===s?Me:Ws:so&&so in ys(b)?rp(b):bp(b)}function So(b,E){return b>E}function Gs(b,E){return b!=null&&qs.call(b,E)}function wl(b,E){return b!=null&&E in ys(b)}function gh(b,E,q){return b>=_n(E,q)&&b<Js(E,q)}function el(b,E,q){for(var ce=q?Kr:mo,Oe=b[0].length,Ge=b.length,rt=Ge,bt=It(Ge),Pt=1/0,Zt=[];rt--;){var Xt=b[rt];rt&&E&&(Xt=Ls(Xt,Ln(E))),Pt=_n(Xt.length,Pt),bt[rt]=!q&&(E||Oe>=120&&Xt.length>=120)?new ue(rt&&Xt):s}Xt=b[0];var si=-1,mi=bt[0];e:for(;++si<Oe&&Zt.length<Pt;){var Ei=Xt[si],Gi=E?E(Ei):Ei;if(Ei=q||Ei!==0?Ei:0,!(mi?$n(mi,Gi):ce(Zt,Gi,q))){for(rt=Ge;--rt;){var fs=bt[rt];if(!(fs?$n(fs,Gi):ce(b[rt],Gi,q)))continue e}mi&&mi.push(Gi),Zt.push(Ei)}}return Zt}function Ca(b,E,q,ce){return Gn(b,function(Oe,Ge,rt){E(ce,q(Oe),Ge,rt)}),ce}function sn(b,E,q){E=$o(E,b),b=Vc(b,E);var ce=b==null?b:b[ao(Rr(E))];return ce==null?s:gn(ce,b,q)}function ro(b){return nn(b)&&Ks(b)==Ai}function _s(b){return nn(b)&&Ks(b)==y}function ci(b){return nn(b)&&Ks(b)==Wi}function ir(b,E,q,ce,Oe){return b===E?!0:b==null||E==null||!nn(b)&&!nn(E)?b!==b&&E!==E:Ld(b,E,q,ce,ir,Oe)}function Ld(b,E,q,ce,Oe,Ge){var rt=is(b),bt=is(E),Pt=rt?oi:Mn(b),Zt=bt?oi:Mn(E);Pt=Pt==Ai?K:Pt,Zt=Zt==Ai?K:Zt;var Xt=Pt==K,si=Zt==K,mi=Pt==Zt;if(mi&&Go(b)){if(!Go(E))return!1;rt=!0,Xt=!1}if(mi&&!Xt)return Ge||(Ge=new _e),rt||nl(b)?Ec(b,E,q,ce,Oe,Ge):sp(b,E,Pt,q,ce,Oe,Ge);if(!(q&I)){var Ei=Xt&&qs.call(b,"__wrapped__"),Gi=si&&qs.call(E,"__wrapped__");if(Ei||Gi){var fs=Ei?b.value():b,ji=Gi?E.value():E;return Ge||(Ge=new _e),Oe(fs,ji,q,ce,Ge)}}return mi?(Ge||(Ge=new _e),np(b,E,q,ce,Oe,Ge)):!1}function Cd(b){return nn(b)&&Mn(b)==ls}function iu(b,E,q,ce){var Oe=q.length,Ge=Oe,rt=!ce;if(b==null)return!Ge;for(b=ys(b);Oe--;){var bt=q[Oe];if(rt&&bt[2]?bt[1]!==b[bt[0]]:!(bt[0]in b))return!1}for(;++Oe<Ge;){bt=q[Oe];var Pt=bt[0],Zt=b[Pt],Xt=bt[1];if(rt&&bt[2]){if(Zt===s&&!(Pt in b))return!1}else{var si=new _e;if(ce)var mi=ce(Zt,Xt,Pt,b,E,si);if(!(mi===s?ir(Xt,Zt,I|W,ce,si):mi))return!1}}return!0}function Xu(b){if(!Qs(b)||pp(b))return!1;var E=Eo(b)?Xh:wi;return E.test(xa(b))}function Dd(b){return nn(b)&&Ks(b)==it}function xd(b){return nn(b)&&Mn(b)==et}function Id(b){return nn(b)&&Vh(b.length)&&!!Dt[Ks(b)]}function ju(b){return typeof b=="function"?b:b==null?or:typeof b=="object"?is(b)?Ju(b[0],b[1]):Qu(b):fd(b)}function su(b){if(!Tl(b))return Bo(b);var E=[];for(var q in ys(b))qs.call(b,q)&&q!="constructor"&&E.push(q);return E}function Vd(b){if(!Qs(b))return yp(b);var E=Tl(b),q=[];for(var ce in b)ce=="constructor"&&(E||!qs.call(b,ce))||q.push(ce);return q}function nu(b,E){return b<E}function Zu(b,E){var q=-1,ce=rr(b)?It(b.length):[];return Us(b,function(Oe,Ge,rt){ce[++q]=E(Oe,Ge,rt)}),ce}function Qu(b){var E=_u(b);return E.length==1&&E[0][2]?xc(E[0][0],E[0][1]):function(q){return q===b||iu(q,b,E)}}function Ju(b,E){return Au(b)&&Dc(E)?xc(ao(b),E):function(q){var ce=Iu(q,b);return ce===s&&ce===E?Vu(q,b):ir(E,ce,I|W)}}function mh(b,E,q,ce,Oe){b!==E&&tn(E,function(Ge,rt){if(Qs(Ge))Oe||(Oe=new _e),Od(b,E,rt,q,mh,ce,Oe);else{var bt=ce?ce(b[rt],Ge,rt+"",b,E,Oe):s;bt===s&&(bt=Ge),ii(b,rt,bt)}},Sr)}function Od(b,E,q,ce,Oe,Ge,rt){var bt=b[q],Pt=E[q],Zt=rt.get(Pt);if(Zt){ii(b,q,Zt);return}var Xt=Ge?Ge(bt,Pt,q+"",b,E,rt):s,si=Xt===s;if(si){var mi=is(Pt),Ei=!mi&&Go(Pt),Gi=!mi&&!Ei&&nl(Pt);Xt=Pt,mi||Ei||Gi?is(bt)?Xt=bt:an(bt)?Xt=sr(bt):Ei?(si=!1,Xt=uc(Pt,!0)):Gi?(si=!1,Xt=cc(Pt,!0)):Xt=[]:Cl(Pt)||Ia(Pt)?(Xt=bt,Ia(bt)?Xt=nd(bt):(!Qs(bt)||ce&&Eo(bt))&&(Xt=Cc(Pt))):si=!1}si&&(rt.set(Pt,Xt),Oe(Xt,Pt,ce,Ge,rt),rt.delete(Pt)),ii(b,q,Xt)}function ec(b,E){var q=b.length;if(q)return E+=E<0?q:0,Po(E,q)?b[E]:s}function tc(b,E,q){var ce=-1;E=Ls(E.length?E:[or],Ln(Hi()));var Oe=Zu(b,function(Ge,rt,bt){var Pt=Ls(E,function(Zt){return Zt(Ge)});return{criteria:Pt,index:++ce,value:Ge}});return Hn(Oe,function(Ge,rt){return Xd(Ge,rt,q)})}function Md(b,E){return ic(b,E,function(q,ce){return Vu(b,ce)})}function ic(b,E,q){for(var ce=-1,Oe=E.length,Ge={};++ce<Oe;){var rt=E[ce],bt=Mi(b,rt);q(bt,rt)&&Pl(Ge,$o(rt,b),bt)}return Ge}function kd(b){return function(E){return Mi(E,b)}}function ru(b,E,q,ce){var Oe=ce?aa:Xr,Ge=-1,rt=E.length,bt=b;for(b===E&&(E=sr(E)),q&&(bt=Ls(b,Ln(q)));++Ge<rt;)for(var Pt=0,Zt=E[Ge],Xt=q?q(Zt):Zt;(Pt=Oe(bt,Xt,Pt,ce))>-1;)bt!==b&&Xa.call(bt,Pt,1),Xa.call(b,Pt,1);return b}function sc(b,E){for(var q=b?E.length:0,ce=q-1;q--;){var Oe=E[q];if(q==ce||Oe!==Ge){var Ge=Oe;Po(Oe)?Xa.call(b,Oe,1):hu(b,Oe)}}return b}function ou(b,E){return b+Sa(er()*(E-b+1))}function Rd(b,E,q,ce){for(var Oe=-1,Ge=Js(jr((E-b)/(q||1)),0),rt=It(Ge);Ge--;)rt[ce?Ge:++Oe]=b,b+=q;return rt}function au(b,E){var q="";if(!b||E<1||E>Et)return q;do E%2&&(q+=b),E=Sa(E/2),E&&(b+=b);while(E);return q}function cs(b,E){return Pu(Ic(b,E,or),b+"")}function Nd(b){return ri(rl(b))}function Bd(b,E){var q=rl(b);return Th(q,vi(E,0,q.length))}function Pl(b,E,q,ce){if(!Qs(b))return b;E=$o(E,b);for(var Oe=-1,Ge=E.length,rt=Ge-1,bt=b;bt!=null&&++Oe<Ge;){var Pt=ao(E[Oe]),Zt=q;if(Oe!=rt){var Xt=bt[Pt];Zt=ce?ce(Xt,Pt,bt):s,Zt===s&&(Zt=Qs(Xt)?Xt:Po(E[Oe+1])?[]:{})}qt(bt,Pt,Zt),bt=bt[Pt]}return b}var nc=Qa?function(b,E){return Qa.set(b,E),b}:or,Fd=va?function(b,E){return va(b,"toString",{configurable:!0,enumerable:!1,value:Mu(E),writable:!0})}:or;function qd(b){return Th(rl(b))}function kr(b,E,q){var ce=-1,Oe=b.length;E<0&&(E=-E>Oe?0:Oe+E),q=q>Oe?Oe:q,q<0&&(q+=Oe),Oe=E>q?0:q-E>>>0,E>>>=0;for(var Ge=It(Oe);++ce<Oe;)Ge[ce]=b[ce+E];return Ge}function Hd(b,E){var q;return Us(b,function(ce,Oe,Ge){return q=E(ce,Oe,Ge),!q}),!!q}function yh(b,E,q){var ce=0,Oe=b==null?ce:b.length;if(typeof E=="number"&&E===E&&Oe<=Mt){for(;ce<Oe;){var Ge=ce+Oe>>>1,rt=b[Ge];rt!==null&&!_r(rt)&&(q?rt<=E:rt<E)?ce=Ge+1:Oe=Ge}return Oe}return lu(b,E,or,q)}function lu(b,E,q,ce){E=q(E);for(var Oe=0,Ge=b==null?0:b.length,rt=E!==E,bt=E===null,Pt=_r(E),Zt=E===s;Oe<Ge;){var Xt=Sa((Oe+Ge)/2),si=q(b[Xt]),mi=si!==s,Ei=si===null,Gi=si===si,fs=_r(si);if(rt)var ji=ce||Gi;else Zt?ji=Gi&&(ce||mi):bt?ji=Gi&&mi&&(ce||!Ei):Pt?ji=Gi&&mi&&!Ei&&(ce||!fs):Ei||fs?ji=!1:ji=ce?si<=E:si<E;ji?Oe=Xt+1:Ge=Xt}return _n(Ge,Gt)}function rc(b,E){for(var q=-1,ce=b.length,Oe=0,Ge=[];++q<ce;){var rt=b[q],bt=E?E(rt):rt;if(!q||!lo(bt,Pt)){var Pt=bt;Ge[Oe++]=rt===0?0:rt}}return Ge}function oc(b){return typeof b=="number"?b:_r(b)?mt:+b}function vr(b){if(typeof b=="string")return b;if(is(b))return Ls(b,vr)+"";if(_r(b))return ph?ph.call(b):"";var E=b+"";return E=="0"&&1/b==-Je?"-0":E}function zo(b,E,q){var ce=-1,Oe=mo,Ge=b.length,rt=!0,bt=[],Pt=bt;if(q)rt=!1,Oe=Kr;else if(Ge>=o){var Zt=E?null:tp(b);if(Zt)return ot(Zt);rt=!1,Oe=$n,Pt=new ue}else Pt=E?[]:bt;e:for(;++ce<Ge;){var Xt=b[ce],si=E?E(Xt):Xt;if(Xt=q||Xt!==0?Xt:0,rt&&si===si){for(var mi=Pt.length;mi--;)if(Pt[mi]===si)continue e;E&&Pt.push(si),bt.push(Xt)}else Oe(Pt,si,q)||(Pt!==bt&&Pt.push(si),bt.push(Xt))}return bt}function hu(b,E){return E=$o(E,b),b=Vc(b,E),b==null||delete b[ao(Rr(E))]}function ac(b,E,q,ce){return Pl(b,E,q(Mi(b,E)),ce)}function bh(b,E,q,ce){for(var Oe=b.length,Ge=ce?Oe:-1;(ce?Ge--:++Ge<Oe)&&E(b[Ge],Ge,b););return q?kr(b,ce?0:Ge,ce?Ge+1:Oe):kr(b,ce?Ge+1:0,ce?Oe:Ge)}function lc(b,E){var q=b;return q instanceof us&&(q=q.value()),yo(E,function(ce,Oe){return Oe.func.apply(Oe.thisArg,Vr([ce],Oe.args))},q)}function uu(b,E,q){var ce=b.length;if(ce<2)return ce?zo(b[0]):[];for(var Oe=-1,Ge=It(ce);++Oe<ce;)for(var rt=b[Oe],bt=-1;++bt<ce;)bt!=Oe&&(Ge[Oe]=pi(Ge[Oe]||rt,b[bt],E,q));return zo(ws(Ge,1),E,q)}function hc(b,E,q){for(var ce=-1,Oe=b.length,Ge=E.length,rt={};++ce<Oe;){var bt=ce<Ge?E[ce]:s;q(rt,b[ce],bt)}return rt}function cu(b){return an(b)?b:[]}function du(b){return typeof b=="function"?b:or}function $o(b,E){return is(b)?b:Au(b,E)?[b]:Rc(Vs(b))}var zd=cs;function Uo(b,E,q){var ce=b.length;return q=q===s?ce:q,!E&&q>=ce?b:kr(b,E,q)}var $d=jh||function(b){return hs.clearTimeout(b)};function uc(b,E){if(E)return b.slice();var q=b.length,ce=yl?yl(q):new b.constructor(q);return b.copy(ce),ce}function pu(b){var E=new b.constructor(b.byteLength);return new bo(E).set(new bo(b)),E}function Ud(b,E){var q=E?pu(b.buffer):b.buffer;return new b.constructor(q,b.byteOffset,b.byteLength)}function Gd(b,E,q){var ce=E?q(Cn(b),A):Cn(b);return yo(ce,Zs,new b.constructor)}function Wd(b){var E=new b.constructor(b.source,Ci.exec(b));return E.lastIndex=b.lastIndex,E}function Yd(b,E,q){var ce=E?q(ot(b),A):ot(b);return yo(ce,gr,new b.constructor)}function Kd(b){return Ea?ys(Ea.call(b)):{}}function cc(b,E){var q=E?pu(b.buffer):b.buffer;return new b.constructor(q,b.byteOffset,b.length)}function dc(b,E){if(b!==E){var q=b!==s,ce=b===null,Oe=b===b,Ge=_r(b),rt=E!==s,bt=E===null,Pt=E===E,Zt=_r(E);if(!bt&&!Zt&&!Ge&&b>E||Ge&&rt&&Pt&&!bt&&!Zt||ce&&rt&&Pt||!q&&Pt||!Oe)return 1;if(!ce&&!Ge&&!Zt&&b<E||Zt&&q&&Oe&&!ce&&!Ge||bt&&q&&Oe||!rt&&Oe||!Pt)return-1}return 0}function Xd(b,E,q){for(var ce=-1,Oe=b.criteria,Ge=E.criteria,rt=Oe.length,bt=q.length;++ce<rt;){var Pt=dc(Oe[ce],Ge[ce]);if(Pt){if(ce>=bt)return Pt;var Zt=q[ce];return Pt*(Zt=="desc"?-1:1)}}return b.index-E.index}function pc(b,E,q,ce){for(var Oe=-1,Ge=b.length,rt=q.length,bt=-1,Pt=E.length,Zt=Js(Ge-rt,0),Xt=It(Pt+Zt),si=!ce;++bt<Pt;)Xt[bt]=E[bt];for(;++Oe<rt;)(si||Oe<Ge)&&(Xt[q[Oe]]=b[Oe]);for(;Zt--;)Xt[bt++]=b[Oe++];return Xt}function fc(b,E,q,ce){for(var Oe=-1,Ge=b.length,rt=-1,bt=q.length,Pt=-1,Zt=E.length,Xt=Js(Ge-bt,0),si=It(Xt+Zt),mi=!ce;++Oe<Xt;)si[Oe]=b[Oe];for(var Ei=Oe;++Pt<Zt;)si[Ei+Pt]=E[Pt];for(;++rt<bt;)(mi||Oe<Ge)&&(si[Ei+q[rt]]=b[Oe++]);return si}function sr(b,E){var q=-1,ce=b.length;for(E||(E=It(ce));++q<ce;)E[q]=b[q];return E}function oo(b,E,q,ce){var Oe=!q;q||(q={});for(var Ge=-1,rt=E.length;++Ge<rt;){var bt=E[Ge],Pt=ce?ce(q[bt],b[bt],bt,q,b):s;Pt===s&&(Pt=b[bt]),Oe?lt(q,bt,Pt):qt(q,bt,Pt)}return q}function jd(b,E){return oo(b,Su(b),E)}function Zd(b,E){return oo(b,Tc(b),E)}function vh(b,E){return function(q,ce){var Oe=is(q)?xr:Rt,Ge=E?E():{};return Oe(q,b,Hi(ce,2),Ge)}}function tl(b){return cs(function(E,q){var ce=-1,Oe=q.length,Ge=Oe>1?q[Oe-1]:s,rt=Oe>2?q[2]:s;for(Ge=b.length>3&&typeof Ge=="function"?(Oe--,Ge):s,rt&&nr(q[0],q[1],rt)&&(Ge=Oe<3?s:Ge,Oe=1),E=ys(E);++ce<Oe;){var bt=q[ce];bt&&b(E,bt,ce,Ge)}return E})}function gc(b,E){return function(q,ce){if(q==null)return q;if(!rr(q))return b(q,ce);for(var Oe=q.length,Ge=E?Oe:-1,rt=ys(q);(E?Ge--:++Ge<Oe)&&ce(rt[Ge],Ge,rt)!==!1;);return q}}function mc(b){return function(E,q,ce){for(var Oe=-1,Ge=ys(E),rt=ce(E),bt=rt.length;bt--;){var Pt=rt[b?bt:++Oe];if(q(Ge[Pt],Pt,Ge)===!1)break}return E}}function Qd(b,E,q){var ce=E&L,Oe=El(b);function Ge(){var rt=this&&this!==hs&&this instanceof Ge?Oe:b;return rt.apply(ce?q:this,arguments)}return Ge}function yc(b){return function(E){E=Vs(E);var q=Mr(E)?Ut(E):s,ce=q?q[0]:E.charAt(0),Oe=q?Uo(q,1).join(""):E.slice(1);return ce[b]()+Oe}}function il(b){return function(E){return yo(dd(cd(E).replace(j,"")),b,"")}}function El(b){return function(){var E=arguments;switch(E.length){case 0:return new b;case 1:return new b(E[0]);case 2:return new b(E[0],E[1]);case 3:return new b(E[0],E[1],E[2]);case 4:return new b(E[0],E[1],E[2],E[3]);case 5:return new b(E[0],E[1],E[2],E[3],E[4]);case 6:return new b(E[0],E[1],E[2],E[3],E[4],E[5]);case 7:return new b(E[0],E[1],E[2],E[3],E[4],E[5],E[6])}var q=qo(b.prototype),ce=b.apply(q,E);return Qs(ce)?ce:q}}function Jd(b,E,q){var ce=El(b);function Oe(){for(var Ge=arguments.length,rt=It(Ge),bt=Ge,Pt=sl(Oe);bt--;)rt[bt]=arguments[bt];var Zt=Ge<3&&rt[0]!==Pt&&rt[Ge-1]!==Pt?[]:Ue(rt,Pt);if(Ge-=Zt.length,Ge<q)return Ac(b,E,_h,Oe.placeholder,s,rt,Zt,s,s,q-Ge);var Xt=this&&this!==hs&&this instanceof Oe?ce:b;return gn(Xt,this,rt)}return Oe}function bc(b){return function(E,q,ce){var Oe=ys(E);if(!rr(E)){var Ge=Hi(q,3);E=Sn(E),q=function(bt){return Ge(Oe[bt],bt,Oe)}}var rt=b(E,q,ce);return rt>-1?Oe[Ge?E[rt]:rt]:s}}function vc(b){return wo(function(E){var q=E.length,ce=q,Oe=tr.prototype.thru;for(b&&E.reverse();ce--;){var Ge=E[ce];if(typeof Ge!="function")throw new Jn(l);if(Oe&&!rt&&Ph(Ge)=="wrapper")var rt=new tr([],!0)}for(ce=rt?ce:q;++ce<q;){Ge=E[ce];var bt=Ph(Ge),Pt=bt=="wrapper"?vu(Ge):s;Pt&&wu(Pt[0])&&Pt[1]==(ye|Q|de|Ee)&&!Pt[4].length&&Pt[9]==1?rt=rt[Ph(Pt[0])].apply(rt,Pt[3]):rt=Ge.length==1&&wu(Ge)?rt[bt]():rt.thru(Ge)}return function(){var Zt=arguments,Xt=Zt[0];if(rt&&Zt.length==1&&is(Xt))return rt.plant(Xt).value();for(var si=0,mi=q?E[si].apply(this,Zt):Xt;++si<q;)mi=E[si].call(this,mi);return mi}})}function _h(b,E,q,ce,Oe,Ge,rt,bt,Pt,Zt){var Xt=E&ye,si=E&L,mi=E&H,Ei=E&(Q|pe),Gi=E&Le,fs=mi?s:El(b);function ji(){for(var Ss=arguments.length,Os=It(Ss),Wn=Ss;Wn--;)Os[Wn]=arguments[Wn];if(Ei)var Yn=sl(ji),Wo=ko(Os,Yn);if(ce&&(Os=pc(Os,ce,Oe,Ei)),Ge&&(Os=fc(Os,Ge,rt,Ei)),Ss-=Wo,Ei&&Ss<Zt){var ln=Ue(Os,Yn);return Ac(b,E,_h,ji.placeholder,q,Os,ln,bt,Pt,Zt-Ss)}var Qr=si?q:this,Lo=mi?Qr[b]:b;return Ss=Os.length,bt?Os=vp(Os,bt):Gi&&Ss>1&&Os.reverse(),Xt&&Pt<Ss&&(Os.length=Pt),this&&this!==hs&&this instanceof ji&&(Lo=fs||El(Lo)),Lo.apply(Qr,Os)}return ji}function _c(b,E){return function(q,ce){return Ca(q,b,E(ce),{})}}function Sh(b,E){return function(q,ce){var Oe;if(q===s&&ce===s)return E;if(q!==s&&(Oe=q),ce!==s){if(Oe===s)return ce;typeof q=="string"||typeof ce=="string"?(q=vr(q),ce=vr(ce)):(q=oc(q),ce=oc(ce)),Oe=b(q,ce)}return Oe}}function fu(b){return wo(function(E){return E=Ls(E,Ln(Hi())),cs(function(q){var ce=this;return b(E,function(Oe){return gn(Oe,ce,q)})})})}function Ah(b,E){E=E===s?" ":vr(E);var q=E.length;if(q<2)return q?au(E,b):E;var ce=au(E,jr(b/Wt(E)));return Mr(E)?Uo(Ut(ce),0,b).join(""):ce.slice(0,b)}function ep(b,E,q,ce){var Oe=E&L,Ge=El(b);function rt(){for(var bt=-1,Pt=arguments.length,Zt=-1,Xt=ce.length,si=It(Xt+Pt),mi=this&&this!==hs&&this instanceof rt?Ge:b;++Zt<Xt;)si[Zt]=ce[Zt];for(;Pt--;)si[Zt++]=arguments[++bt];return gn(mi,Oe?q:this,si)}return rt}function Sc(b){return function(E,q,ce){return ce&&typeof ce!="number"&&nr(E,q,ce)&&(q=ce=s),E=To(E),q===s?(q=E,E=0):q=To(q),ce=ce===s?E<q?1:-1:To(ce),Rd(E,q,ce,b)}}function wh(b){return function(E,q){return typeof E=="string"&&typeof q=="string"||(E=Nr(E),q=Nr(q)),b(E,q)}}function Ac(b,E,q,ce,Oe,Ge,rt,bt,Pt,Zt){var Xt=E&Q,si=Xt?rt:s,mi=Xt?s:rt,Ei=Xt?Ge:s,Gi=Xt?s:Ge;E|=Xt?de:fe,E&=~(Xt?fe:de),E&Y||(E&=~(L|H));var fs=[b,E,Oe,Ei,si,Gi,mi,bt,Pt,Zt],ji=q.apply(s,fs);return wu(b)&&Oc(ji,fs),ji.placeholder=ce,Mc(ji,b,E)}function gu(b){var E=Rs[b];return function(q,ce){if(q=Nr(q),ce=ce==null?0:_n(ns(ce),292),ce){var Oe=(Vs(q)+"e").split("e"),Ge=E(Oe[0]+"e"+(+Oe[1]+ce));return Oe=(Vs(Ge)+"e").split("e"),+(Oe[0]+"e"+(+Oe[1]-ce))}return E(q)}}var tp=Fo&&1/ot(new Fo([,-0]))[1]==Je?function(b){return new Fo(b)}:Nu;function wc(b){return function(E){var q=Mn(E);return q==ls?Cn(E):q==et?vt(E):zn(E,b(E))}}function Ao(b,E,q,ce,Oe,Ge,rt,bt){var Pt=E&H;if(!Pt&&typeof b!="function")throw new Jn(l);var Zt=ce?ce.length:0;if(Zt||(E&=~(de|fe),ce=Oe=s),rt=rt===s?rt:Js(ns(rt),0),bt=bt===s?bt:ns(bt),Zt-=Oe?Oe.length:0,E&fe){var Xt=ce,si=Oe;ce=Oe=s}var mi=Pt?s:vu(b),Ei=[b,E,q,ce,Oe,Xt,si,Ge,rt,bt];if(mi&&mp(Ei,mi),b=Ei[0],E=Ei[1],q=Ei[2],ce=Ei[3],Oe=Ei[4],bt=Ei[9]=Ei[9]===s?Pt?0:b.length:Js(Ei[9]-Zt,0),!bt&&E&(Q|pe)&&(E&=~(Q|pe)),!E||E==L)var Gi=Qd(b,E,q);else E==Q||E==pe?Gi=Jd(b,E,bt):(E==de||E==(L|de))&&!Oe.length?Gi=ep(b,E,q,ce):Gi=_h.apply(s,Ei);var fs=mi?nc:Oc;return Mc(fs(Gi,Ei),b,E)}function mu(b,E,q,ce){return b===s||lo(b,ma[q])&&!qs.call(ce,q)?E:b}function Pc(b,E,q,ce,Oe,Ge){return Qs(b)&&Qs(E)&&(Ge.set(E,b),mh(b,E,s,Pc,Ge),Ge.delete(E)),b}function ip(b){return Cl(b)?s:b}function Ec(b,E,q,ce,Oe,Ge){var rt=q&I,bt=b.length,Pt=E.length;if(bt!=Pt&&!(rt&&Pt>bt))return!1;var Zt=Ge.get(b);if(Zt&&Ge.get(E))return Zt==E;var Xt=-1,si=!0,mi=q&W?new ue:s;for(Ge.set(b,E),Ge.set(E,b);++Xt<bt;){var Ei=b[Xt],Gi=E[Xt];if(ce)var fs=rt?ce(Gi,Ei,Xt,E,b,Ge):ce(Ei,Gi,Xt,b,E,Ge);if(fs!==s){if(fs)continue;si=!1;break}if(mi){if(!oa(E,function(ji,Ss){if(!$n(mi,Ss)&&(Ei===ji||Oe(Ei,ji,q,ce,Ge)))return mi.push(Ss)})){si=!1;break}}else if(!(Ei===Gi||Oe(Ei,Gi,q,ce,Ge))){si=!1;break}}return Ge.delete(b),Ge.delete(E),si}function sp(b,E,q,ce,Oe,Ge,rt){switch(q){case w:if(b.byteLength!=E.byteLength||b.byteOffset!=E.byteOffset)return!1;b=b.buffer,E=E.buffer;case y:return!(b.byteLength!=E.byteLength||!Ge(new bo(b),new bo(E)));case Li:case Wi:case gs:return lo(+b,+E);case qi:return b.name==E.name&&b.message==E.message;case it:case Ie:return b==E+"";case ls:var bt=Cn;case et:var Pt=ce&I;if(bt||(bt=ot),b.size!=E.size&&!Pt)return!1;var Zt=rt.get(b);if(Zt)return Zt==E;ce|=W,rt.set(b,E);var Xt=Ec(bt(b),bt(E),ce,Oe,Ge,rt);return rt.delete(b),Xt;case Ve:if(Ea)return Ea.call(b)==Ea.call(E)}return!1}function np(b,E,q,ce,Oe,Ge){var rt=q&I,bt=yu(b),Pt=bt.length,Zt=yu(E),Xt=Zt.length;if(Pt!=Xt&&!rt)return!1;for(var si=Pt;si--;){var mi=bt[si];if(!(rt?mi in E:qs.call(E,mi)))return!1}var Ei=Ge.get(b);if(Ei&&Ge.get(E))return Ei==E;var Gi=!0;Ge.set(b,E),Ge.set(E,b);for(var fs=rt;++si<Pt;){mi=bt[si];var ji=b[mi],Ss=E[mi];if(ce)var Os=rt?ce(Ss,ji,mi,E,b,Ge):ce(ji,Ss,mi,b,E,Ge);if(!(Os===s?ji===Ss||Oe(ji,Ss,q,ce,Ge):Os)){Gi=!1;break}fs||(fs=mi=="constructor")}if(Gi&&!fs){var Wn=b.constructor,Yn=E.constructor;Wn!=Yn&&"constructor"in b&&"constructor"in E&&!(typeof Wn=="function"&&Wn instanceof Wn&&typeof Yn=="function"&&Yn instanceof Yn)&&(Gi=!1)}return Ge.delete(b),Ge.delete(E),Gi}function wo(b){return Pu(Ic(b,s,qc),b+"")}function yu(b){return Ns(b,Sn,Su)}function bu(b){return Ns(b,Sr,Tc)}var vu=Qa?function(b){return Qa.get(b)}:Nu;function Ph(b){for(var E=b.name+"",q=Pa[E],ce=qs.call(Pa,E)?q.length:0;ce--;){var Oe=q[ce],Ge=Oe.func;if(Ge==null||Ge==b)return Oe.name}return E}function sl(b){var E=qs.call(ze,"placeholder")?ze:b;return E.placeholder}function Hi(){var b=ze.iteratee||ku;return b=b===ku?ju:b,arguments.length?b(arguments[0],arguments[1]):b}function Eh(b,E){var q=b.__data__;return dp(E)?q[typeof E=="string"?"string":"hash"]:q.map}function _u(b){for(var E=Sn(b),q=E.length;q--;){var ce=E[q],Oe=b[ce];E[q]=[ce,Oe,Dc(Oe)]}return E}function Da(b,E){var q=No(b,E);return Xu(q)?q:s}function rp(b){var E=qs.call(b,so),q=b[so];try{b[so]=s;var ce=!0}catch{}var Oe=vs.call(b);return ce&&(E?b[so]=q:delete b[so]),Oe}var Su=ts?function(b){return b==null?[]:(b=ys(b),Fn(ts(b),function(E){return lh.call(b,E)}))}:Bu,Tc=ts?function(b){for(var E=[];b;)Vr(E,Su(b)),b=Ka(b);return E}:Bu,Mn=Ks;(Za&&Mn(new Za(new ArrayBuffer(1)))!=w||no&&Mn(new no)!=ls||vl&&Mn(vl.resolve())!=He||Fo&&Mn(new Fo)!=et||Aa&&Mn(new Aa)!=yt)&&(Mn=function(b){var E=Ks(b),q=E==K?b.constructor:s,ce=q?xa(q):"";if(ce)switch(ce){case Zh:return w;case Qh:return ls;case Jh:return He;case eu:return et;case dh:return yt}return E});function op(b,E,q){for(var ce=-1,Oe=q.length;++ce<Oe;){var Ge=q[ce],rt=Ge.size;switch(Ge.type){case"drop":b+=rt;break;case"dropRight":E-=rt;break;case"take":E=_n(E,b+rt);break;case"takeRight":b=Js(b,E-rt);break}}return{start:b,end:E}}function ap(b){var E=b.match(Tt);return E?E[1].split(Vt):[]}function Lc(b,E,q){E=$o(E,b);for(var ce=-1,Oe=E.length,Ge=!1;++ce<Oe;){var rt=ao(E[ce]);if(!(Ge=b!=null&&q(b,rt)))break;b=b[rt]}return Ge||++ce!=Oe?Ge:(Oe=b==null?0:b.length,!!Oe&&Vh(Oe)&&Po(rt,Oe)&&(is(b)||Ia(b)))}function lp(b){var E=b.length,q=b.constructor(E);return E&&typeof b[0]=="string"&&qs.call(b,"index")&&(q.index=b.index,q.input=b.input),q}function Cc(b){return typeof b.constructor=="function"&&!Tl(b)?qo(Ka(b)):{}}function hp(b,E,q,ce){var Oe=b.constructor;switch(E){case y:return pu(b);case Li:case Wi:return new Oe(+b);case w:return Ud(b,ce);case D:case N:case U:case te:case J:case ie:case ae:case ve:case Se:return cc(b,ce);case ls:return Gd(b,ce,q);case gs:case Ie:return new Oe(b);case it:return Wd(b);case et:return Yd(b,ce,q);case Ve:return Kd(b)}}function up(b,E){var q=E.length;if(!q)return b;var ce=q-1;return E[ce]=(q>1?"& ":"")+E[ce],E=E.join(q>2?", ":" "),b.replace(wt,`{
/* [wrapped with `+E+`] */
`)}function cp(b){return is(b)||Ia(b)||!!(hh&&b&&b[hh])}function Po(b,E){return E=E??Et,!!E&&(typeof b=="number"||Oi.test(b))&&b>-1&&b%1==0&&b<E}function nr(b,E,q){if(!Qs(q))return!1;var ce=typeof E;return(ce=="number"?rr(q)&&Po(E,q.length):ce=="string"&&E in q)?lo(q[E],b):!1}function Au(b,E){if(is(b))return!1;var q=typeof b;return q=="number"||q=="symbol"||q=="boolean"||b==null||_r(b)?!0:Ye.test(b)||!Fe.test(b)||E!=null&&b in ys(E)}function dp(b){var E=typeof b;return E=="string"||E=="number"||E=="symbol"||E=="boolean"?b!=="__proto__":b===null}function wu(b){var E=Ph(b),q=ze[E];if(typeof q!="function"||!(E in us.prototype))return!1;if(b===q)return!0;var ce=vu(q);return!!ce&&b===ce[0]}function pp(b){return!!yi&&yi in b}var fp=Wa?Eo:Fu;function Tl(b){var E=b&&b.constructor,q=typeof E=="function"&&E.prototype||ma;return b===q}function Dc(b){return b===b&&!Qs(b)}function xc(b,E){return function(q){return q==null?!1:q[b]===E&&(E!==s||b in ys(q))}}function gp(b){var E=xh(b,function(ce){return q.size===g&&q.clear(),ce}),q=E.cache;return E}function mp(b,E){var q=b[1],ce=E[1],Oe=q|ce,Ge=Oe<(L|H|ye),rt=ce==ye&&q==Q||ce==ye&&q==Ee&&b[7].length<=E[8]||ce==(ye|Ee)&&E[7].length<=E[8]&&q==Q;if(!(Ge||rt))return b;ce&L&&(b[2]=E[2],Oe|=q&L?0:Y);var bt=E[3];if(bt){var Pt=b[3];b[3]=Pt?pc(Pt,bt,E[4]):bt,b[4]=Pt?Ue(b[3],d):E[4]}return bt=E[5],bt&&(Pt=b[5],b[5]=Pt?fc(Pt,bt,E[6]):bt,b[6]=Pt?Ue(b[5],d):E[6]),bt=E[7],bt&&(b[7]=bt),ce&ye&&(b[8]=b[8]==null?E[8]:_n(b[8],E[8])),b[9]==null&&(b[9]=E[9]),b[0]=E[0],b[1]=Oe,b}function yp(b){var E=[];if(b!=null)for(var q in ys(b))E.push(q);return E}function bp(b){return vs.call(b)}function Ic(b,E,q){return E=Js(E===s?b.length-1:E,0),function(){for(var ce=arguments,Oe=-1,Ge=Js(ce.length-E,0),rt=It(Ge);++Oe<Ge;)rt[Oe]=ce[E+Oe];Oe=-1;for(var bt=It(E+1);++Oe<E;)bt[Oe]=ce[Oe];return bt[E]=q(rt),gn(b,this,bt)}}function Vc(b,E){return E.length<2?b:Mi(b,kr(E,0,-1))}function vp(b,E){for(var q=b.length,ce=_n(E.length,q),Oe=sr(b);ce--;){var Ge=E[ce];b[ce]=Po(Ge,q)?Oe[Ge]:s}return b}var Oc=kc(nc),Ll=ja||function(b,E){return hs.setTimeout(b,E)},Pu=kc(Fd);function Mc(b,E,q){var ce=E+"";return Pu(b,up(ce,_p(ap(ce),q)))}function kc(b){var E=0,q=0;return function(){var ce=Yu(),Oe=_t-(ce-q);if(q=ce,Oe>0){if(++E>=Ke)return arguments[0]}else E=0;return b.apply(s,arguments)}}function Th(b,E){var q=-1,ce=b.length,Oe=ce-1;for(E=E===s?ce:E;++q<E;){var Ge=ou(q,Oe),rt=b[Ge];b[Ge]=b[q],b[q]=rt}return b.length=E,b}var Rc=gp(function(b){var E=[];return je.test(b)&&E.push(""),b.replace(Ze,function(q,ce,Oe,Ge){E.push(Oe?Ge.replace(ai,"$1"):ce||q)}),E});function ao(b){if(typeof b=="string"||_r(b))return b;var E=b+"";return E=="0"&&1/b==-Je?"-0":E}function xa(b){if(b!=null){try{return Ya.call(b)}catch{}try{return b+""}catch{}}return""}function _p(b,E){return dn(jt,function(q){var ce="_."+q[0];E&q[1]&&!mo(b,ce)&&b.push(ce)}),b.sort()}function Nc(b){if(b instanceof us)return b.clone();var E=new tr(b.__wrapped__,b.__chain__);return E.__actions__=sr(b.__actions__),E.__index__=b.__index__,E.__values__=b.__values__,E}function Sp(b,E,q){(q?nr(b,E,q):E===s)?E=1:E=Js(ns(E),0);var ce=b==null?0:b.length;if(!ce||E<1)return[];for(var Oe=0,Ge=0,rt=It(jr(ce/E));Oe<ce;)rt[Ge++]=kr(b,Oe,Oe+=E);return rt}function Ap(b){for(var E=-1,q=b==null?0:b.length,ce=0,Oe=[];++E<q;){var Ge=b[E];Ge&&(Oe[ce++]=Ge)}return Oe}function wp(){var b=arguments.length;if(!b)return[];for(var E=It(b-1),q=arguments[0],ce=b;ce--;)E[ce-1]=arguments[ce];return Vr(is(q)?sr(q):[q],ws(E,1))}var Pp=cs(function(b,E){return an(b)?pi(b,ws(E,1,an,!0)):[]}),Ep=cs(function(b,E){var q=Rr(E);return an(q)&&(q=s),an(b)?pi(b,ws(E,1,an,!0),Hi(q,2)):[]}),Tp=cs(function(b,E){var q=Rr(E);return an(q)&&(q=s),an(b)?pi(b,ws(E,1,an,!0),s,q):[]});function Lp(b,E,q){var ce=b==null?0:b.length;return ce?(E=q||E===s?1:ns(E),kr(b,E<0?0:E,ce)):[]}function Cp(b,E,q){var ce=b==null?0:b.length;return ce?(E=q||E===s?1:ns(E),E=ce-E,kr(b,0,E<0?0:E)):[]}function Dp(b,E){return b&&b.length?bh(b,Hi(E,3),!0,!0):[]}function xp(b,E){return b&&b.length?bh(b,Hi(E,3),!0):[]}function Ip(b,E,q,ce){var Oe=b==null?0:b.length;return Oe?(q&&typeof q!="number"&&nr(b,E,q)&&(q=0,ce=Oe),en(b,E,q,ce)):[]}function Bc(b,E,q){var ce=b==null?0:b.length;if(!ce)return-1;var Oe=q==null?0:ns(q);return Oe<0&&(Oe=Js(ce+Oe,0)),Or(b,Hi(E,3),Oe)}function Fc(b,E,q){var ce=b==null?0:b.length;if(!ce)return-1;var Oe=ce-1;return q!==s&&(Oe=ns(q),Oe=q<0?Js(ce+Oe,0):_n(Oe,ce-1)),Or(b,Hi(E,3),Oe,!0)}function qc(b){var E=b==null?0:b.length;return E?ws(b,1):[]}function Vp(b){var E=b==null?0:b.length;return E?ws(b,Je):[]}function Op(b,E){var q=b==null?0:b.length;return q?(E=E===s?1:ns(E),ws(b,E)):[]}function Mp(b){for(var E=-1,q=b==null?0:b.length,ce={};++E<q;){var Oe=b[E];ce[Oe[0]]=Oe[1]}return ce}function Hc(b){return b&&b.length?b[0]:s}function kp(b,E,q){var ce=b==null?0:b.length;if(!ce)return-1;var Oe=q==null?0:ns(q);return Oe<0&&(Oe=Js(ce+Oe,0)),Xr(b,E,Oe)}function Rp(b){var E=b==null?0:b.length;return E?kr(b,0,-1):[]}var Np=cs(function(b){var E=Ls(b,cu);return E.length&&E[0]===b[0]?el(E):[]}),Bp=cs(function(b){var E=Rr(b),q=Ls(b,cu);return E===Rr(q)?E=s:q.pop(),q.length&&q[0]===b[0]?el(q,Hi(E,2)):[]}),Fp=cs(function(b){var E=Rr(b),q=Ls(b,cu);return E=typeof E=="function"?E:s,E&&q.pop(),q.length&&q[0]===b[0]?el(q,s,E):[]});function qp(b,E){return b==null?"":Wu.call(b,E)}function Rr(b){var E=b==null?0:b.length;return E?b[E-1]:s}function Hp(b,E,q){var ce=b==null?0:b.length;if(!ce)return-1;var Oe=ce;return q!==s&&(Oe=ns(q),Oe=Oe<0?Js(ce+Oe,0):_n(Oe,ce-1)),E===E?xt(b,E,Oe):Or(b,la,Oe,!0)}function zp(b,E){return b&&b.length?ec(b,ns(E)):s}var $p=cs(zc);function zc(b,E){return b&&b.length&&E&&E.length?ru(b,E):b}function Up(b,E,q){return b&&b.length&&E&&E.length?ru(b,E,Hi(q,2)):b}function Gp(b,E,q){return b&&b.length&&E&&E.length?ru(b,E,s,q):b}var Wp=wo(function(b,E){var q=b==null?0:b.length,ce=di(b,E);return sc(b,Ls(E,function(Oe){return Po(Oe,q)?+Oe:Oe}).sort(dc)),ce});function Yp(b,E){var q=[];if(!(b&&b.length))return q;var ce=-1,Oe=[],Ge=b.length;for(E=Hi(E,3);++ce<Ge;){var rt=b[ce];E(rt,ce,b)&&(q.push(rt),Oe.push(ce))}return sc(b,Oe),q}function Eu(b){return b==null?b:bl.call(b)}function Kp(b,E,q){var ce=b==null?0:b.length;return ce?(q&&typeof q!="number"&&nr(b,E,q)?(E=0,q=ce):(E=E==null?0:ns(E),q=q===s?ce:ns(q)),kr(b,E,q)):[]}function Xp(b,E){return yh(b,E)}function jp(b,E,q){return lu(b,E,Hi(q,2))}function Zp(b,E){var q=b==null?0:b.length;if(q){var ce=yh(b,E);if(ce<q&&lo(b[ce],E))return ce}return-1}function Qp(b,E){return yh(b,E,!0)}function Jp(b,E,q){return lu(b,E,Hi(q,2),!0)}function ef(b,E){var q=b==null?0:b.length;if(q){var ce=yh(b,E,!0)-1;if(lo(b[ce],E))return ce}return-1}function tf(b){return b&&b.length?rc(b):[]}function sf(b,E){return b&&b.length?rc(b,Hi(E,2)):[]}function nf(b){var E=b==null?0:b.length;return E?kr(b,1,E):[]}function rf(b,E,q){return b&&b.length?(E=q||E===s?1:ns(E),kr(b,0,E<0?0:E)):[]}function of(b,E,q){var ce=b==null?0:b.length;return ce?(E=q||E===s?1:ns(E),E=ce-E,kr(b,E<0?0:E,ce)):[]}function af(b,E){return b&&b.length?bh(b,Hi(E,3),!1,!0):[]}function lf(b,E){return b&&b.length?bh(b,Hi(E,3)):[]}var hf=cs(function(b){return zo(ws(b,1,an,!0))}),uf=cs(function(b){var E=Rr(b);return an(E)&&(E=s),zo(ws(b,1,an,!0),Hi(E,2))}),cf=cs(function(b){var E=Rr(b);return E=typeof E=="function"?E:s,zo(ws(b,1,an,!0),s,E)});function df(b){return b&&b.length?zo(b):[]}function pf(b,E){return b&&b.length?zo(b,Hi(E,2)):[]}function ff(b,E){return E=typeof E=="function"?E:s,b&&b.length?zo(b,s,E):[]}function Tu(b){if(!(b&&b.length))return[];var E=0;return b=Fn(b,function(q){if(an(q))return E=Js(q.length,E),!0}),yr(E,function(q){return Ls(b,qn(q))})}function $c(b,E){if(!(b&&b.length))return[];var q=Tu(b);return E==null?q:Ls(q,function(ce){return gn(E,s,ce)})}var gf=cs(function(b,E){return an(b)?pi(b,E):[]}),mf=cs(function(b){return uu(Fn(b,an))}),yf=cs(function(b){var E=Rr(b);return an(E)&&(E=s),uu(Fn(b,an),Hi(E,2))}),bf=cs(function(b){var E=Rr(b);return E=typeof E=="function"?E:s,uu(Fn(b,an),s,E)}),vf=cs(Tu);function _f(b,E){return hc(b||[],E||[],qt)}function Sf(b,E){return hc(b||[],E||[],Pl)}var Af=cs(function(b){var E=b.length,q=E>1?b[E-1]:s;return q=typeof q=="function"?(b.pop(),q):s,$c(b,q)});function Uc(b){var E=ze(b);return E.__chain__=!0,E}function wf(b,E){return E(b),b}function Lh(b,E){return E(b)}var Pf=wo(function(b){var E=b.length,q=E?b[0]:0,ce=this.__wrapped__,Oe=function(Ge){return di(Ge,b)};return E>1||this.__actions__.length||!(ce instanceof us)||!Po(q)?this.thru(Oe):(ce=ce.slice(q,+q+(E?1:0)),ce.__actions__.push({func:Lh,args:[Oe],thisArg:s}),new tr(ce,this.__chain__).thru(function(Ge){return E&&!Ge.length&&Ge.push(s),Ge}))});function Ef(){return Uc(this)}function Tf(){return new tr(this.value(),this.__chain__)}function Lf(){this.__values__===s&&(this.__values__=id(this.value()));var b=this.__index__>=this.__values__.length,E=b?s:this.__values__[this.__index__++];return{done:b,value:E}}function Cf(){return this}function Df(b){for(var E,q=this;q instanceof Ta;){var ce=Nc(q);ce.__index__=0,ce.__values__=s,E?Oe.__wrapped__=ce:E=ce;var Oe=ce;q=q.__wrapped__}return Oe.__wrapped__=b,E}function xf(){var b=this.__wrapped__;if(b instanceof us){var E=b;return this.__actions__.length&&(E=new us(this)),E=E.reverse(),E.__actions__.push({func:Lh,args:[Eu],thisArg:s}),new tr(E,this.__chain__)}return this.thru(Eu)}function If(){return lc(this.__wrapped__,this.__actions__)}var Vf=vh(function(b,E,q){qs.call(b,q)?++b[q]:lt(b,q,1)});function Of(b,E,q){var ce=is(b)?Ir:Ho;return q&&nr(b,E,q)&&(E=s),ce(b,Hi(E,3))}function Mf(b,E){var q=is(b)?Fn:Zr;return q(b,Hi(E,3))}var kf=bc(Bc),Rf=bc(Fc);function Nf(b,E){return ws(Ch(b,E),1)}function Bf(b,E){return ws(Ch(b,E),Je)}function Ff(b,E,q){return q=q===s?1:ns(q),ws(Ch(b,E),q)}function Gc(b,E){var q=is(b)?dn:Us;return q(b,Hi(E,3))}function Wc(b,E){var q=is(b)?Ps:os;return q(b,Hi(E,3))}var qf=vh(function(b,E,q){qs.call(b,q)?b[q].push(E):lt(b,q,[E])});function Hf(b,E,q,ce){b=rr(b)?b:rl(b),q=q&&!ce?ns(q):0;var Oe=b.length;return q<0&&(q=Js(Oe+q,0)),Oh(b)?q<=Oe&&b.indexOf(E,q)>-1:!!Oe&&Xr(b,E,q)>-1}var zf=cs(function(b,E,q){var ce=-1,Oe=typeof E=="function",Ge=rr(b)?It(b.length):[];return Us(b,function(rt){Ge[++ce]=Oe?gn(E,rt,q):sn(rt,E,q)}),Ge}),$f=vh(function(b,E,q){lt(b,q,E)});function Ch(b,E){var q=is(b)?Ls:Zu;return q(b,Hi(E,3))}function Uf(b,E,q,ce){return b==null?[]:(is(E)||(E=E==null?[]:[E]),q=ce?s:q,is(q)||(q=q==null?[]:[q]),tc(b,E,q))}var Gf=vh(function(b,E,q){b[q?0:1].push(E)},function(){return[[],[]]});function Wf(b,E,q){var ce=is(b)?yo:io,Oe=arguments.length<3;return ce(b,Hi(E,4),q,Oe,Us)}function Yf(b,E,q){var ce=is(b)?ra:io,Oe=arguments.length<3;return ce(b,Hi(E,4),q,Oe,os)}function Kf(b,E){var q=is(b)?Fn:Zr;return q(b,Ih(Hi(E,3)))}function Xf(b){var E=is(b)?ri:Nd;return E(b)}function jf(b,E,q){(q?nr(b,E,q):E===s)?E=1:E=ns(E);var ce=is(b)?dt:Bd;return ce(b,E)}function Zf(b){var E=is(b)?Yt:qd;return E(b)}function Qf(b){if(b==null)return 0;if(rr(b))return Oh(b)?Wt(b):b.length;var E=Mn(b);return E==ls||E==et?b.size:su(b).length}function Jf(b,E,q){var ce=is(b)?oa:Hd;return q&&nr(b,E,q)&&(E=s),ce(b,Hi(E,3))}var eg=cs(function(b,E){if(b==null)return[];var q=E.length;return q>1&&nr(b,E[0],E[1])?E=[]:q>2&&nr(E[0],E[1],E[2])&&(E=[E[0]]),tc(b,ws(E,1),[])}),Dh=bn||function(){return hs.Date.now()};function tg(b,E){if(typeof E!="function")throw new Jn(l);return b=ns(b),function(){if(--b<1)return E.apply(this,arguments)}}function Yc(b,E,q){return E=q?s:E,E=b&&E==null?b.length:E,Ao(b,ye,s,s,s,s,E)}function Kc(b,E){var q;if(typeof E!="function")throw new Jn(l);return b=ns(b),function(){return--b>0&&(q=E.apply(this,arguments)),b<=1&&(E=s),q}}var Lu=cs(function(b,E,q){var ce=L;if(q.length){var Oe=Ue(q,sl(Lu));ce|=de}return Ao(b,ce,E,q,Oe)}),Xc=cs(function(b,E,q){var ce=L|H;if(q.length){var Oe=Ue(q,sl(Xc));ce|=de}return Ao(E,ce,b,q,Oe)});function jc(b,E,q){E=q?s:E;var ce=Ao(b,Q,s,s,s,s,s,E);return ce.placeholder=jc.placeholder,ce}function Zc(b,E,q){E=q?s:E;var ce=Ao(b,pe,s,s,s,s,s,E);return ce.placeholder=Zc.placeholder,ce}function Qc(b,E,q){var ce,Oe,Ge,rt,bt,Pt,Zt=0,Xt=!1,si=!1,mi=!0;if(typeof b!="function")throw new Jn(l);E=Nr(E)||0,Qs(q)&&(Xt=!!q.leading,si="maxWait"in q,Ge=si?Js(Nr(q.maxWait)||0,E):Ge,mi="trailing"in q?!!q.trailing:mi);function Ei(ln){var Qr=ce,Lo=Oe;return ce=Oe=s,Zt=ln,rt=b.apply(Lo,Qr),rt}function Gi(ln){return Zt=ln,bt=Ll(Ss,E),Xt?Ei(ln):rt}function fs(ln){var Qr=ln-Pt,Lo=ln-Zt,gd=E-Qr;return si?_n(gd,Ge-Lo):gd}function ji(ln){var Qr=ln-Pt,Lo=ln-Zt;return Pt===s||Qr>=E||Qr<0||si&&Lo>=Ge}function Ss(){var ln=Dh();if(ji(ln))return Os(ln);bt=Ll(Ss,fs(ln))}function Os(ln){return bt=s,mi&&ce?Ei(ln):(ce=Oe=s,rt)}function Wn(){bt!==s&&$d(bt),Zt=0,ce=Pt=Oe=bt=s}function Yn(){return bt===s?rt:Os(Dh())}function Wo(){var ln=Dh(),Qr=ji(ln);if(ce=arguments,Oe=this,Pt=ln,Qr){if(bt===s)return Gi(Pt);if(si)return bt=Ll(Ss,E),Ei(Pt)}return bt===s&&(bt=Ll(Ss,E)),rt}return Wo.cancel=Wn,Wo.flush=Yn,Wo}var ig=cs(function(b,E){return Ts(b,1,E)}),sg=cs(function(b,E,q){return Ts(b,Nr(E)||0,q)});function ng(b){return Ao(b,Le)}function xh(b,E){if(typeof b!="function"||E!=null&&typeof E!="function")throw new Jn(l);var q=function(){var ce=arguments,Oe=E?E.apply(this,ce):ce[0],Ge=q.cache;if(Ge.has(Oe))return Ge.get(Oe);var rt=b.apply(this,ce);return q.cache=Ge.set(Oe,rt)||Ge,rt};return q.cache=new(xh.Cache||R),q}xh.Cache=R;function Ih(b){if(typeof b!="function")throw new Jn(l);return function(){var E=arguments;switch(E.length){case 0:return!b.call(this);case 1:return!b.call(this,E[0]);case 2:return!b.call(this,E[0],E[1]);case 3:return!b.call(this,E[0],E[1],E[2])}return!b.apply(this,E)}}function rg(b){return Kc(2,b)}var og=zd(function(b,E){E=E.length==1&&is(E[0])?Ls(E[0],Ln(Hi())):Ls(ws(E,1),Ln(Hi()));var q=E.length;return cs(function(ce){for(var Oe=-1,Ge=_n(ce.length,q);++Oe<Ge;)ce[Oe]=E[Oe].call(this,ce[Oe]);return gn(b,this,ce)})}),Cu=cs(function(b,E){var q=Ue(E,sl(Cu));return Ao(b,de,s,E,q)}),Jc=cs(function(b,E){var q=Ue(E,sl(Jc));return Ao(b,fe,s,E,q)}),ag=wo(function(b,E){return Ao(b,Ee,s,s,s,E)});function lg(b,E){if(typeof b!="function")throw new Jn(l);return E=E===s?E:ns(E),cs(b,E)}function hg(b,E){if(typeof b!="function")throw new Jn(l);return E=E==null?0:Js(ns(E),0),cs(function(q){var ce=q[E],Oe=Uo(q,0,E);return ce&&Vr(Oe,ce),gn(b,this,Oe)})}function ug(b,E,q){var ce=!0,Oe=!0;if(typeof b!="function")throw new Jn(l);return Qs(q)&&(ce="leading"in q?!!q.leading:ce,Oe="trailing"in q?!!q.trailing:Oe),Qc(b,E,{leading:ce,maxWait:E,trailing:Oe})}function cg(b){return Yc(b,1)}function dg(b,E){return Cu(du(E),b)}function pg(){if(!arguments.length)return[];var b=arguments[0];return is(b)?b:[b]}function fg(b){return gi(b,O)}function gg(b,E){return E=typeof E=="function"?E:s,gi(b,O,E)}function mg(b){return gi(b,A|O)}function yg(b,E){return E=typeof E=="function"?E:s,gi(b,A|O,E)}function bg(b,E){return E==null||Fi(b,E,Sn(E))}function lo(b,E){return b===E||b!==b&&E!==E}var vg=wh(So),_g=wh(function(b,E){return b>=E}),Ia=ro(function(){return arguments}())?ro:function(b){return nn(b)&&qs.call(b,"callee")&&!lh.call(b,"callee")},is=It.isArray,Sg=Dr?Ln(Dr):_s;function rr(b){return b!=null&&Vh(b.length)&&!Eo(b)}function an(b){return nn(b)&&rr(b)}function Ag(b){return b===!0||b===!1||nn(b)&&Ks(b)==Li}var Go=uh||Fu,wg=pn?Ln(pn):ci;function Pg(b){return nn(b)&&b.nodeType===1&&!Cl(b)}function Eg(b){if(b==null)return!0;if(rr(b)&&(is(b)||typeof b=="string"||typeof b.splice=="function"||Go(b)||nl(b)||Ia(b)))return!b.length;var E=Mn(b);if(E==ls||E==et)return!b.size;if(Tl(b))return!su(b).length;for(var q in b)if(qs.call(b,q))return!1;return!0}function Tg(b,E){return ir(b,E)}function Lg(b,E,q){q=typeof q=="function"?q:s;var ce=q?q(b,E):s;return ce===s?ir(b,E,s,q):!!ce}function Du(b){if(!nn(b))return!1;var E=Ks(b);return E==qi||E==Vi||typeof b.message=="string"&&typeof b.name=="string"&&!Cl(b)}function Cg(b){return typeof b=="number"&&ch(b)}function Eo(b){if(!Qs(b))return!1;var E=Ks(b);return E==Kt||E==zs||E==ki||E==We}function ed(b){return typeof b=="number"&&b==ns(b)}function Vh(b){return typeof b=="number"&&b>-1&&b%1==0&&b<=Et}function Qs(b){var E=typeof b;return b!=null&&(E=="object"||E=="function")}function nn(b){return b!=null&&typeof b=="object"}var Dg=Zn?Ln(Zn):Cd;function xg(b,E){return b===E||iu(b,E,_u(E))}function Ig(b,E,q){return q=typeof q=="function"?q:s,iu(b,E,_u(E),q)}function Vg(b){return td(b)&&b!=+b}function Og(b){if(fp(b))throw new xi(n);return Xu(b)}function Mg(b){return b===null}function kg(b){return b==null}function td(b){return typeof b=="number"||nn(b)&&Ks(b)==gs}function Cl(b){if(!nn(b)||Ks(b)!=K)return!1;var E=Ka(b);if(E===null)return!0;var q=qs.call(E,"constructor")&&E.constructor;return typeof q=="function"&&q instanceof q&&Ya.call(q)==oh}var xu=Qn?Ln(Qn):Dd;function Rg(b){return ed(b)&&b>=-Et&&b<=Et}var Ng=cn?Ln(cn):xd;function Oh(b){return typeof b=="string"||!is(b)&&nn(b)&&Ks(b)==Ie}function _r(b){return typeof b=="symbol"||nn(b)&&Ks(b)==Ve}var nl=fr?Ln(fr):Id;function Bg(b){return b===s}function Fg(b){return nn(b)&&Mn(b)==yt}function qg(b){return nn(b)&&Ks(b)==u}var Hg=wh(nu),zg=wh(function(b,E){return b<=E});function id(b){if(!b)return[];if(rr(b))return Oh(b)?Ut(b):sr(b);if(ba&&b[ba])return Ua(b[ba]());var E=Mn(b),q=E==ls?Cn:E==et?ot:rl;return q(b)}function To(b){if(!b)return b===0?b:0;if(b=Nr(b),b===Je||b===-Je){var E=b<0?-1:1;return E*ht}return b===b?b:0}function ns(b){var E=To(b),q=E%1;return E===E?q?E-q:E:0}function sd(b){return b?vi(ns(b),0,Nt):0}function Nr(b){if(typeof b=="number")return b;if(_r(b))return mt;if(Qs(b)){var E=typeof b.valueOf=="function"?b.valueOf():b;b=Qs(E)?E+"":E}if(typeof b!="string")return b===0?b:+b;b=b.replace(nt,"");var q=Pi.test(b);return q||Qt.test(b)?Ms(b.slice(2),q?2:8):Ti.test(b)?mt:+b}function nd(b){return oo(b,Sr(b))}function $g(b){return b?vi(ns(b),-Et,Et):b===0?b:0}function Vs(b){return b==null?"":vr(b)}var Ug=tl(function(b,E){if(Tl(E)||rr(E)){oo(E,Sn(E),b);return}for(var q in E)qs.call(E,q)&&qt(b,q,E[q])}),rd=tl(function(b,E){oo(E,Sr(E),b)}),Dl=tl(function(b,E,q,ce){oo(E,Sr(E),b,ce)}),Gg=tl(function(b,E,q,ce){oo(E,Sn(E),b,ce)}),Wg=wo(di);function Yg(b,E){var q=qo(b);return E==null?q:$t(q,E)}var Kg=cs(function(b){return b.push(s,mu),gn(Dl,s,b)}),Xg=cs(function(b){return b.push(s,Pc),gn(od,s,b)});function jg(b,E){return $a(b,Hi(E,3),Gn)}function Zg(b,E){return $a(b,Hi(E,3),br)}function Qg(b,E){return b==null?b:tn(b,Hi(E,3),Sr)}function Jg(b,E){return b==null?b:Ji(b,Hi(E,3),Sr)}function em(b,E){return b&&Gn(b,Hi(E,3))}function tm(b,E){return b&&br(b,Hi(E,3))}function im(b){return b==null?[]:xn(b,Sn(b))}function sm(b){return b==null?[]:xn(b,Sr(b))}function Iu(b,E,q){var ce=b==null?s:Mi(b,E);return ce===s?q:ce}function nm(b,E){return b!=null&&Lc(b,E,Gs)}function Vu(b,E){return b!=null&&Lc(b,E,wl)}var rm=_c(function(b,E,q){b[E]=q},Mu(or)),om=_c(function(b,E,q){qs.call(b,E)?b[E].push(q):b[E]=[q]},Hi),am=cs(sn);function Sn(b){return rr(b)?hi(b):su(b)}function Sr(b){return rr(b)?hi(b,!0):Vd(b)}function lm(b,E){var q={};return E=Hi(E,3),Gn(b,function(ce,Oe,Ge){lt(q,E(ce,Oe,Ge),ce)}),q}function hm(b,E){var q={};return E=Hi(E,3),Gn(b,function(ce,Oe,Ge){lt(q,Oe,E(ce,Oe,Ge))}),q}var um=tl(function(b,E,q){mh(b,E,q)}),od=tl(function(b,E,q,ce){mh(b,E,q,ce)}),cm=wo(function(b,E){var q={};if(b==null)return q;var ce=!1;E=Ls(E,function(Ge){return Ge=$o(Ge,b),ce||(ce=Ge.length>1),Ge}),oo(b,bu(b),q),ce&&(q=gi(q,A|S|O,ip));for(var Oe=E.length;Oe--;)hu(q,E[Oe]);return q});function dm(b,E){return ad(b,Ih(Hi(E)))}var pm=wo(function(b,E){return b==null?{}:Md(b,E)});function ad(b,E){if(b==null)return{};var q=Ls(bu(b),function(ce){return[ce]});return E=Hi(E),ic(b,q,function(ce,Oe){return E(ce,Oe[0])})}function fm(b,E,q){E=$o(E,b);var ce=-1,Oe=E.length;for(Oe||(Oe=1,b=s);++ce<Oe;){var Ge=b==null?s:b[ao(E[ce])];Ge===s&&(ce=Oe,Ge=q),b=Eo(Ge)?Ge.call(b):Ge}return b}function gm(b,E,q){return b==null?b:Pl(b,E,q)}function mm(b,E,q,ce){return ce=typeof ce=="function"?ce:s,b==null?b:Pl(b,E,q,ce)}var ld=wc(Sn),hd=wc(Sr);function ym(b,E,q){var ce=is(b),Oe=ce||Go(b)||nl(b);if(E=Hi(E,4),q==null){var Ge=b&&b.constructor;Oe?q=ce?new Ge:[]:Qs(b)?q=Eo(Ge)?qo(Ka(b)):{}:q={}}return(Oe?dn:Gn)(b,function(rt,bt,Pt){return E(q,rt,bt,Pt)}),q}function bm(b,E){return b==null?!0:hu(b,E)}function vm(b,E,q){return b==null?b:ac(b,E,du(q))}function _m(b,E,q,ce){return ce=typeof ce=="function"?ce:s,b==null?b:ac(b,E,du(q),ce)}function rl(b){return b==null?[]:ha(b,Sn(b))}function Sm(b){return b==null?[]:ha(b,Sr(b))}function Am(b,E,q){return q===s&&(q=E,E=s),q!==s&&(q=Nr(q),q=q===q?q:0),E!==s&&(E=Nr(E),E=E===E?E:0),vi(Nr(b),E,q)}function wm(b,E,q){return E=To(E),q===s?(q=E,E=0):q=To(q),b=Nr(b),gh(b,E,q)}function Pm(b,E,q){if(q&&typeof q!="boolean"&&nr(b,E,q)&&(E=q=s),q===s&&(typeof E=="boolean"?(q=E,E=s):typeof b=="boolean"&&(q=b,b=s)),b===s&&E===s?(b=0,E=1):(b=To(b),E===s?(E=b,b=0):E=To(E)),b>E){var ce=b;b=E,E=ce}if(q||b%1||E%1){var Oe=er();return _n(b+Oe*(E-b+Zi("1e-"+((Oe+"").length-1))),E)}return ou(b,E)}var Em=il(function(b,E,q){return E=E.toLowerCase(),b+(q?ud(E):E)});function ud(b){return Ou(Vs(b).toLowerCase())}function cd(b){return b=Vs(b),b&&b.replace(ds,Ro).replace(se,"")}function Tm(b,E,q){b=Vs(b),E=vr(E);var ce=b.length;q=q===s?ce:vi(ns(q),0,ce);var Oe=q;return q-=E.length,q>=0&&b.slice(q,Oe)==E}function Lm(b){return b=Vs(b),b&&ke.test(b)?b.replace(qe,da):b}function Cm(b){return b=Vs(b),b&&ut.test(b)?b.replace(tt,"\\$&"):b}var Dm=il(function(b,E,q){return b+(q?"-":"")+E.toLowerCase()}),xm=il(function(b,E,q){return b+(q?" ":"")+E.toLowerCase()}),Im=yc("toLowerCase");function Vm(b,E,q){b=Vs(b),E=ns(E);var ce=E?Wt(b):0;if(!E||ce>=E)return b;var Oe=(E-ce)/2;return Ah(Sa(Oe),q)+b+Ah(jr(Oe),q)}function Om(b,E,q){b=Vs(b),E=ns(E);var ce=E?Wt(b):0;return E&&ce<E?b+Ah(E-ce,q):b}function Mm(b,E,q){b=Vs(b),E=ns(E);var ce=E?Wt(b):0;return E&&ce<E?Ah(E-ce,q)+b:b}function km(b,E,q){return q||E==null?E=0:E&&(E=+E),Ku(Vs(b).replace(pt,""),E||0)}function Rm(b,E,q){return(q?nr(b,E,q):E===s)?E=1:E=ns(E),au(Vs(b),E)}function Nm(){var b=arguments,E=Vs(b[0]);return b.length<3?E:E.replace(b[1],b[2])}var Bm=il(function(b,E,q){return b+(q?"_":"")+E.toLowerCase()});function Fm(b,E,q){return q&&typeof q!="number"&&nr(b,E,q)&&(E=q=s),q=q===s?Nt:q>>>0,q?(b=Vs(b),b&&(typeof E=="string"||E!=null&&!xu(E))&&(E=vr(E),!E&&Mr(b))?Uo(Ut(b),0,q):b.split(E,q)):[]}var qm=il(function(b,E,q){return b+(q?" ":"")+Ou(E)});function Hm(b,E,q){return b=Vs(b),q=q==null?0:vi(ns(q),0,b.length),E=vr(E),b.slice(q,q+E.length)==E}function zm(b,E,q){var ce=ze.templateSettings;q&&nr(b,E,q)&&(E=s),b=Vs(b),E=Dl({},E,ce,mu);var Oe=Dl({},E.imports,ce.imports,mu),Ge=Sn(Oe),rt=ha(Oe,Ge),bt,Pt,Zt=0,Xt=E.interpolate||Lt,si="__p += '",mi=ml((E.escape||Lt).source+"|"+Xt.source+"|"+(Xt===Re?Ht:Lt).source+"|"+(E.evaluate||Lt).source+"|$","g"),Ei="//# sourceURL="+("sourceURL"in E?E.sourceURL:"lodash.templateSources["+ ++At+"]")+`
`;b.replace(mi,function(ji,Ss,Os,Wn,Yn,Wo){return Os||(Os=Wn),si+=b.slice(Zt,Wo).replace(Qi,pa),Ss&&(bt=!0,si+=`' +
__e(`+Ss+`) +
'`),Yn&&(Pt=!0,si+=`';
`+Yn+`;
__p += '`),Os&&(si+=`' +
((__t = (`+Os+`)) == null ? '' : __t) +
'`),Zt=Wo+ji.length,ji}),si+=`';
`;var Gi=E.variable;Gi||(si=`with (obj) {
`+si+`
}
`),si=(Pt?si.replace(be,""):si).replace(ge,"$1").replace(Ce,"$1;"),si="function("+(Gi||"obj")+`) {
`+(Gi?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(bt?", __e = _.escape":"")+(Pt?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+si+`return __p
}`;var fs=pd(function(){return Ii(Ge,Ei+"return "+si).apply(s,rt)});if(fs.source=si,Du(fs))throw fs;return fs}function $m(b){return Vs(b).toLowerCase()}function Um(b){return Vs(b).toUpperCase()}function Gm(b,E,q){if(b=Vs(b),b&&(q||E===s))return b.replace(nt,"");if(!b||!(E=vr(E)))return b;var ce=Ut(b),Oe=Ut(E),Ge=Mo(ce,Oe),rt=ca(ce,Oe)+1;return Uo(ce,Ge,rt).join("")}function Wm(b,E,q){if(b=Vs(b),b&&(q||E===s))return b.replace(ft,"");if(!b||!(E=vr(E)))return b;var ce=Ut(b),Oe=ca(ce,Ut(E))+1;return Uo(ce,0,Oe).join("")}function Ym(b,E,q){if(b=Vs(b),b&&(q||E===s))return b.replace(pt,"");if(!b||!(E=vr(E)))return b;var ce=Ut(b),Oe=Mo(ce,Ut(E));return Uo(ce,Oe).join("")}function Km(b,E){var q=Z,ce=ne;if(Qs(E)){var Oe="separator"in E?E.separator:Oe;q="length"in E?ns(E.length):q,ce="omission"in E?vr(E.omission):ce}b=Vs(b);var Ge=b.length;if(Mr(b)){var rt=Ut(b);Ge=rt.length}if(q>=Ge)return b;var bt=q-Wt(ce);if(bt<1)return ce;var Pt=rt?Uo(rt,0,bt).join(""):b.slice(0,bt);if(Oe===s)return Pt+ce;if(rt&&(bt+=Pt.length-bt),xu(Oe)){if(b.slice(bt).search(Oe)){var Zt,Xt=Pt;for(Oe.global||(Oe=ml(Oe.source,Vs(Ci.exec(Oe))+"g")),Oe.lastIndex=0;Zt=Oe.exec(Xt);)var si=Zt.index;Pt=Pt.slice(0,si===s?bt:si)}}else if(b.indexOf(vr(Oe),bt)!=bt){var mi=Pt.lastIndexOf(Oe);mi>-1&&(Pt=Pt.slice(0,mi))}return Pt+ce}function Xm(b){return b=Vs(b),b&&Ae.test(b)?b.replace(Ne,ui):b}var jm=il(function(b,E,q){return b+(q?" ":"")+E.toUpperCase()}),Ou=yc("toUpperCase");function dd(b,E,q){return b=Vs(b),E=q?s:E,E===s?fa(b)?Ui(b):gl(b):b.match(E)||[]}var pd=cs(function(b,E){try{return gn(b,s,E)}catch(q){return Du(q)?q:new xi(q)}}),Zm=wo(function(b,E){return dn(E,function(q){q=ao(q),lt(b,q,Lu(b[q],b))}),b});function Qm(b){var E=b==null?0:b.length,q=Hi();return b=E?Ls(b,function(ce){if(typeof ce[1]!="function")throw new Jn(l);return[q(ce[0]),ce[1]]}):[],cs(function(ce){for(var Oe=-1;++Oe<E;){var Ge=b[Oe];if(gn(Ge[0],this,ce))return gn(Ge[1],this,ce)}})}function Jm(b){return Si(gi(b,A))}function Mu(b){return function(){return b}}function e0(b,E){return b==null||b!==b?E:b}var t0=vc(),i0=vc(!0);function or(b){return b}function ku(b){return ju(typeof b=="function"?b:gi(b,A))}function s0(b){return Qu(gi(b,A))}function n0(b,E){return Ju(b,gi(E,A))}var r0=cs(function(b,E){return function(q){return sn(q,b,E)}}),o0=cs(function(b,E){return function(q){return sn(b,q,E)}});function Ru(b,E,q){var ce=Sn(E),Oe=xn(E,ce);q==null&&!(Qs(E)&&(Oe.length||!ce.length))&&(q=E,E=b,b=this,Oe=xn(E,Sn(E)));var Ge=!(Qs(q)&&"chain"in q)||!!q.chain,rt=Eo(b);return dn(Oe,function(bt){var Pt=E[bt];b[bt]=Pt,rt&&(b.prototype[bt]=function(){var Zt=this.__chain__;if(Ge||Zt){var Xt=b(this.__wrapped__),si=Xt.__actions__=sr(this.__actions__);return si.push({func:Pt,args:arguments,thisArg:b}),Xt.__chain__=Zt,Xt}return Pt.apply(b,Vr([this.value()],arguments))})}),b}function a0(){return hs._===this&&(hs._=Kh),this}function Nu(){}function l0(b){return b=ns(b),cs(function(E){return ec(E,b)})}var h0=fu(Ls),u0=fu(Ir),c0=fu(oa);function fd(b){return Au(b)?qn(ao(b)):kd(b)}function p0(b){return function(E){return b==null?s:Mi(b,E)}}var f0=Sc(),g0=Sc(!0);function Bu(){return[]}function Fu(){return!1}function m0(){return{}}function y0(){return""}function b0(){return!0}function v0(b,E){if(b=ns(b),b<1||b>Et)return[];var q=Nt,ce=_n(b,Nt);E=Hi(E),b-=Nt;for(var Oe=yr(ce,E);++q<b;)E(q);return Oe}function _0(b){return is(b)?Ls(b,ao):_r(b)?[b]:sr(Rc(Vs(b)))}function S0(b){var E=++ya;return Vs(b)+E}var A0=Sh(function(b,E){return b+E},0),w0=gu("ceil"),P0=Sh(function(b,E){return b/E},1),E0=gu("floor");function T0(b){return b&&b.length?mn(b,or,So):s}function L0(b,E){return b&&b.length?mn(b,Hi(E,2),So):s}function C0(b){return mr(b,or)}function D0(b,E){return mr(b,Hi(E,2))}function x0(b){return b&&b.length?mn(b,or,nu):s}function I0(b,E){return b&&b.length?mn(b,Hi(E,2),nu):s}var V0=Sh(function(b,E){return b*E},1),O0=gu("round"),M0=Sh(function(b,E){return b-E},0);function k0(b){return b&&b.length?yn(b,or):0}function R0(b,E){return b&&b.length?yn(b,Hi(E,2)):0}return ze.after=tg,ze.ary=Yc,ze.assign=Ug,ze.assignIn=rd,ze.assignInWith=Dl,ze.assignWith=Gg,ze.at=Wg,ze.before=Kc,ze.bind=Lu,ze.bindAll=Zm,ze.bindKey=Xc,ze.castArray=pg,ze.chain=Uc,ze.chunk=Sp,ze.compact=Ap,ze.concat=wp,ze.cond=Qm,ze.conforms=Jm,ze.constant=Mu,ze.countBy=Vf,ze.create=Yg,ze.curry=jc,ze.curryRight=Zc,ze.debounce=Qc,ze.defaults=Kg,ze.defaultsDeep=Xg,ze.defer=ig,ze.delay=sg,ze.difference=Pp,ze.differenceBy=Ep,ze.differenceWith=Tp,ze.drop=Lp,ze.dropRight=Cp,ze.dropRightWhile=Dp,ze.dropWhile=xp,ze.fill=Ip,ze.filter=Mf,ze.flatMap=Nf,ze.flatMapDeep=Bf,ze.flatMapDepth=Ff,ze.flatten=qc,ze.flattenDeep=Vp,ze.flattenDepth=Op,ze.flip=ng,ze.flow=t0,ze.flowRight=i0,ze.fromPairs=Mp,ze.functions=im,ze.functionsIn=sm,ze.groupBy=qf,ze.initial=Rp,ze.intersection=Np,ze.intersectionBy=Bp,ze.intersectionWith=Fp,ze.invert=rm,ze.invertBy=om,ze.invokeMap=zf,ze.iteratee=ku,ze.keyBy=$f,ze.keys=Sn,ze.keysIn=Sr,ze.map=Ch,ze.mapKeys=lm,ze.mapValues=hm,ze.matches=s0,ze.matchesProperty=n0,ze.memoize=xh,ze.merge=um,ze.mergeWith=od,ze.method=r0,ze.methodOf=o0,ze.mixin=Ru,ze.negate=Ih,ze.nthArg=l0,ze.omit=cm,ze.omitBy=dm,ze.once=rg,ze.orderBy=Uf,ze.over=h0,ze.overArgs=og,ze.overEvery=u0,ze.overSome=c0,ze.partial=Cu,ze.partialRight=Jc,ze.partition=Gf,ze.pick=pm,ze.pickBy=ad,ze.property=fd,ze.propertyOf=p0,ze.pull=$p,ze.pullAll=zc,ze.pullAllBy=Up,ze.pullAllWith=Gp,ze.pullAt=Wp,ze.range=f0,ze.rangeRight=g0,ze.rearg=ag,ze.reject=Kf,ze.remove=Yp,ze.rest=lg,ze.reverse=Eu,ze.sampleSize=jf,ze.set=gm,ze.setWith=mm,ze.shuffle=Zf,ze.slice=Kp,ze.sortBy=eg,ze.sortedUniq=tf,ze.sortedUniqBy=sf,ze.split=Fm,ze.spread=hg,ze.tail=nf,ze.take=rf,ze.takeRight=of,ze.takeRightWhile=af,ze.takeWhile=lf,ze.tap=wf,ze.throttle=ug,ze.thru=Lh,ze.toArray=id,ze.toPairs=ld,ze.toPairsIn=hd,ze.toPath=_0,ze.toPlainObject=nd,ze.transform=ym,ze.unary=cg,ze.union=hf,ze.unionBy=uf,ze.unionWith=cf,ze.uniq=df,ze.uniqBy=pf,ze.uniqWith=ff,ze.unset=bm,ze.unzip=Tu,ze.unzipWith=$c,ze.update=vm,ze.updateWith=_m,ze.values=rl,ze.valuesIn=Sm,ze.without=gf,ze.words=dd,ze.wrap=dg,ze.xor=mf,ze.xorBy=yf,ze.xorWith=bf,ze.zip=vf,ze.zipObject=_f,ze.zipObjectDeep=Sf,ze.zipWith=Af,ze.entries=ld,ze.entriesIn=hd,ze.extend=rd,ze.extendWith=Dl,Ru(ze,ze),ze.add=A0,ze.attempt=pd,ze.camelCase=Em,ze.capitalize=ud,ze.ceil=w0,ze.clamp=Am,ze.clone=fg,ze.cloneDeep=mg,ze.cloneDeepWith=yg,ze.cloneWith=gg,ze.conformsTo=bg,ze.deburr=cd,ze.defaultTo=e0,ze.divide=P0,ze.endsWith=Tm,ze.eq=lo,ze.escape=Lm,ze.escapeRegExp=Cm,ze.every=Of,ze.find=kf,ze.findIndex=Bc,ze.findKey=jg,ze.findLast=Rf,ze.findLastIndex=Fc,ze.findLastKey=Zg,ze.floor=E0,ze.forEach=Gc,ze.forEachRight=Wc,ze.forIn=Qg,ze.forInRight=Jg,ze.forOwn=em,ze.forOwnRight=tm,ze.get=Iu,ze.gt=vg,ze.gte=_g,ze.has=nm,ze.hasIn=Vu,ze.head=Hc,ze.identity=or,ze.includes=Hf,ze.indexOf=kp,ze.inRange=wm,ze.invoke=am,ze.isArguments=Ia,ze.isArray=is,ze.isArrayBuffer=Sg,ze.isArrayLike=rr,ze.isArrayLikeObject=an,ze.isBoolean=Ag,ze.isBuffer=Go,ze.isDate=wg,ze.isElement=Pg,ze.isEmpty=Eg,ze.isEqual=Tg,ze.isEqualWith=Lg,ze.isError=Du,ze.isFinite=Cg,ze.isFunction=Eo,ze.isInteger=ed,ze.isLength=Vh,ze.isMap=Dg,ze.isMatch=xg,ze.isMatchWith=Ig,ze.isNaN=Vg,ze.isNative=Og,ze.isNil=kg,ze.isNull=Mg,ze.isNumber=td,ze.isObject=Qs,ze.isObjectLike=nn,ze.isPlainObject=Cl,ze.isRegExp=xu,ze.isSafeInteger=Rg,ze.isSet=Ng,ze.isString=Oh,ze.isSymbol=_r,ze.isTypedArray=nl,ze.isUndefined=Bg,ze.isWeakMap=Fg,ze.isWeakSet=qg,ze.join=qp,ze.kebabCase=Dm,ze.last=Rr,ze.lastIndexOf=Hp,ze.lowerCase=xm,ze.lowerFirst=Im,ze.lt=Hg,ze.lte=zg,ze.max=T0,ze.maxBy=L0,ze.mean=C0,ze.meanBy=D0,ze.min=x0,ze.minBy=I0,ze.stubArray=Bu,ze.stubFalse=Fu,ze.stubObject=m0,ze.stubString=y0,ze.stubTrue=b0,ze.multiply=V0,ze.nth=zp,ze.noConflict=a0,ze.noop=Nu,ze.now=Dh,ze.pad=Vm,ze.padEnd=Om,ze.padStart=Mm,ze.parseInt=km,ze.random=Pm,ze.reduce=Wf,ze.reduceRight=Yf,ze.repeat=Rm,ze.replace=Nm,ze.result=fm,ze.round=O0,ze.runInContext=ct,ze.sample=Xf,ze.size=Qf,ze.snakeCase=Bm,ze.some=Jf,ze.sortedIndex=Xp,ze.sortedIndexBy=jp,ze.sortedIndexOf=Zp,ze.sortedLastIndex=Qp,ze.sortedLastIndexBy=Jp,ze.sortedLastIndexOf=ef,ze.startCase=qm,ze.startsWith=Hm,ze.subtract=M0,ze.sum=k0,ze.sumBy=R0,ze.template=zm,ze.times=v0,ze.toFinite=To,ze.toInteger=ns,ze.toLength=sd,ze.toLower=$m,ze.toNumber=Nr,ze.toSafeInteger=$g,ze.toString=Vs,ze.toUpper=Um,ze.trim=Gm,ze.trimEnd=Wm,ze.trimStart=Ym,ze.truncate=Km,ze.unescape=Xm,ze.uniqueId=S0,ze.upperCase=jm,ze.upperFirst=Ou,ze.each=Gc,ze.eachRight=Wc,ze.first=Hc,Ru(ze,function(){var b={};return Gn(ze,function(E,q){qs.call(ze.prototype,q)||(b[q]=E)}),b}(),{chain:!1}),ze.VERSION=r,dn(["bind","bindKey","curry","curryRight","partial","partialRight"],function(b){ze[b].placeholder=ze}),dn(["drop","take"],function(b,E){us.prototype[b]=function(q){q=q===s?1:Js(ns(q),0);var ce=this.__filtered__&&!E?new us(this):this.clone();return ce.__filtered__?ce.__takeCount__=_n(q,ce.__takeCount__):ce.__views__.push({size:_n(q,Nt),type:b+(ce.__dir__<0?"Right":"")}),ce},us.prototype[b+"Right"]=function(q){return this.reverse()[b](q).reverse()}}),dn(["filter","map","takeWhile"],function(b,E){var q=E+1,ce=q==xe||q==zt;us.prototype[b]=function(Oe){var Ge=this.clone();return Ge.__iteratees__.push({iteratee:Hi(Oe,3),type:q}),Ge.__filtered__=Ge.__filtered__||ce,Ge}}),dn(["head","last"],function(b,E){var q="take"+(E?"Right":"");us.prototype[b]=function(){return this[q](1).value()[0]}}),dn(["initial","tail"],function(b,E){var q="drop"+(E?"":"Right");us.prototype[b]=function(){return this.__filtered__?new us(this):this[q](1)}}),us.prototype.compact=function(){return this.filter(or)},us.prototype.find=function(b){return this.filter(b).head()},us.prototype.findLast=function(b){return this.reverse().find(b)},us.prototype.invokeMap=cs(function(b,E){return typeof b=="function"?new us(this):this.map(function(q){return sn(q,b,E)})}),us.prototype.reject=function(b){return this.filter(Ih(Hi(b)))},us.prototype.slice=function(b,E){b=ns(b);var q=this;return q.__filtered__&&(b>0||E<0)?new us(q):(b<0?q=q.takeRight(-b):b&&(q=q.drop(b)),E!==s&&(E=ns(E),q=E<0?q.dropRight(-E):q.take(E-b)),q)},us.prototype.takeRightWhile=function(b){return this.reverse().takeWhile(b).reverse()},us.prototype.toArray=function(){return this.take(Nt)},Gn(us.prototype,function(b,E){var q=/^(?:filter|find|map|reject)|While$/.test(E),ce=/^(?:head|last)$/.test(E),Oe=ze[ce?"take"+(E=="last"?"Right":""):E],Ge=ce||/^find/.test(E);Oe&&(ze.prototype[E]=function(){var rt=this.__wrapped__,bt=ce?[1]:arguments,Pt=rt instanceof us,Zt=bt[0],Xt=Pt||is(rt),si=function(Ss){var Os=Oe.apply(ze,Vr([Ss],bt));return ce&&mi?Os[0]:Os};Xt&&q&&typeof Zt=="function"&&Zt.length!=1&&(Pt=Xt=!1);var mi=this.__chain__,Ei=!!this.__actions__.length,Gi=Ge&&!mi,fs=Pt&&!Ei;if(!Ge&&Xt){rt=fs?rt:new us(this);var ji=b.apply(rt,bt);return ji.__actions__.push({func:Lh,args:[si],thisArg:s}),new tr(ji,mi)}return Gi&&fs?b.apply(this,bt):(ji=this.thru(si),Gi?ce?ji.value()[0]:ji.value():ji)})}),dn(["pop","push","shift","sort","splice","unshift"],function(b){var E=Ga[b],q=/^(?:push|sort|unshift)$/.test(b)?"tap":"thru",ce=/^(?:pop|shift)$/.test(b);ze.prototype[b]=function(){var Oe=arguments;if(ce&&!this.__chain__){var Ge=this.value();return E.apply(is(Ge)?Ge:[],Oe)}return this[q](function(rt){return E.apply(is(rt)?rt:[],Oe)})}}),Gn(us.prototype,function(b,E){var q=ze[E];if(q){var ce=q.name+"",Oe=Pa[ce]||(Pa[ce]=[]);Oe.push({name:E,func:q})}}),Pa[_h(s,H).name]=[{name:"wrapper",func:s}],us.prototype.clone=La,us.prototype.reverse=_l,us.prototype.value=vo,ze.prototype.at=Pf,ze.prototype.chain=Ef,ze.prototype.commit=Tf,ze.prototype.next=Lf,ze.prototype.plant=Df,ze.prototype.reverse=xf,ze.prototype.toJSON=ze.prototype.valueOf=ze.prototype.value=If,ze.prototype.first=ze.prototype.head,ba&&(ze.prototype[ba]=Cf),ze},ms=Bi();Ys?((Ys.exports=ms)._=ms,Ni._=ms):hs._=ms,hs._=ms}).call(window)})(lodash4_17_4,lodash4_17_4.exports);lodash4_17_4.exports;(function(){window.phetio=window.phetio||{};const a=".",t="_",s="-",r="general",o="global",n="homeScreen",l="model",h="view",g="colors",d="strings",A="controller",S="Screen",O="archetype",I="Capsule";window.phetio.PhetioIDUtils={append:function(W,...L){return L.forEach(H=>{if(assert&&assert(H.indexOf(a)===-1,`separator appears in componentName: ${H}`),H==="")return;W+=(W===""?"":a)+H}),W},getComponentName:function(W){assert&&assert(W.length>0);const L=W.lastIndexOf(a);return L===-1?W:W.substring(L+1,W.length)},getParentID:function(W){const L=W.lastIndexOf(a);return L===-1?null:W.substring(0,L)},getDOMElementID:function(W){return`phetioID:${W}`},getScreenID:function(W){const L=[],H=W.split(a);for(let Y=0;Y<H.length;Y++){const Q=H[Y];L.push(Q);const pe=Q.indexOf(S);if(pe>0&&pe+S.length===Q.length)return L.join(a)}return null},getGroupElementIndex:function(W){return assert&&assert(W.indexOf(window.phetio.PhetioIDUtils.GROUP_SEPARATOR)>=0,"component name for phetioID should have group element syntax"),Number(W.split(window.phetio.PhetioIDUtils.GROUP_SEPARATOR)[1])},isAncestor:function(W,L){const H=W.split(a),Y=L.split(a);for(let Q=0;Q<H.length;Q++)if(H[Q]!==Y[Q])return!1;return L!==W},getArchetypalPhetioID:function(W){const L=W.split(a);for(let H=0;H<L.length;H++){const Y=L[H];if(Y.endsWith(I)&&H<L.length-1)L[H+1]=O,H++;else{const Q=Y.split(s).map(pe=>pe.includes(t)?O:pe);L[H]=Q.join(s)}}return L.join(a)},SEPARATOR:a,GROUP_SEPARATOR:t,INTER_TERM_SEPARATOR:s,GENERAL_COMPONENT_NAME:r,GLOBAL_COMPONENT_NAME:o,HOME_SCREEN_COMPONENT_NAME:n,MODEL_COMPONENT_NAME:l,VIEW_COMPONENT_NAME:h,CONTROLLER_COMPONENT_NAME:A,COLORS_COMPONENT_NAME:g,STRINGS_COMPONENT_NAME:d,ARCHETYPE:O,CAPSULE_SUFFIX:I}})();window.LineBreaker=(()=>{const a=(()=>{var mt=0,Nt=-3;function Gt(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}function Mt(Me,yt){this.source=Me,this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=yt,this.destLen=0,this.ltree=new Gt,this.dtree=new Gt}var jt=new Gt,Ai=new Gt,oi=new Uint8Array(30),ki=new Uint16Array(30),Li=new Uint8Array(30),Wi=new Uint16Array(30),Vi=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),qi=new Gt,Kt=new Uint8Array(320);function zs(Me,yt,u,y){var w,D;for(w=0;w<u;++w)Me[w]=0;for(w=0;w<30-u;++w)Me[w+u]=w/u|0;for(D=y,w=0;w<30;++w)yt[w]=D,D+=1<<Me[w]}function ls(Me,yt){var u;for(u=0;u<7;++u)Me.table[u]=0;for(Me.table[7]=24,Me.table[8]=152,Me.table[9]=112,u=0;u<24;++u)Me.trans[u]=256+u;for(u=0;u<144;++u)Me.trans[24+u]=u;for(u=0;u<8;++u)Me.trans[168+u]=280+u;for(u=0;u<112;++u)Me.trans[176+u]=144+u;for(u=0;u<5;++u)yt.table[u]=0;for(yt.table[5]=32,u=0;u<32;++u)yt.trans[u]=u}var gs=new Uint16Array(16);function Ws(Me,yt,u,y){var w,D;for(w=0;w<16;++w)Me.table[w]=0;for(w=0;w<y;++w)Me.table[yt[u+w]]++;for(Me.table[0]=0,D=0,w=0;w<16;++w)gs[w]=D,D+=Me.table[w];for(w=0;w<y;++w)yt[u+w]&&(Me.trans[gs[yt[u+w]]++]=w)}function K(Me){Me.bitcount--||(Me.tag=Me.source[Me.sourceIndex++],Me.bitcount=7);var yt=Me.tag&1;return Me.tag>>>=1,yt}function He(Me,yt,u){if(!yt)return u;for(;Me.bitcount<24;)Me.tag|=Me.source[Me.sourceIndex++]<<Me.bitcount,Me.bitcount+=8;var y=Me.tag&65535>>>16-yt;return Me.tag>>>=yt,Me.bitcount-=yt,y+u}function We(Me,yt){for(;Me.bitcount<24;)Me.tag|=Me.source[Me.sourceIndex++]<<Me.bitcount,Me.bitcount+=8;var u=0,y=0,w=0,D=Me.tag;do y=2*y+(D&1),D>>>=1,++w,u+=yt.table[w],y-=yt.table[w];while(y>=0);return Me.tag=D,Me.bitcount-=w,yt.trans[u+y]}function it(Me,yt,u){var y,w,D,N,U,te;for(y=He(Me,5,257),w=He(Me,5,1),D=He(Me,4,4),N=0;N<19;++N)Kt[N]=0;for(N=0;N<D;++N){var J=He(Me,3,0);Kt[Vi[N]]=J}for(Ws(qi,Kt,0,19),U=0;U<y+w;){var ie=We(Me,qi);switch(ie){case 16:var ae=Kt[U-1];for(te=He(Me,2,3);te;--te)Kt[U++]=ae;break;case 17:for(te=He(Me,3,3);te;--te)Kt[U++]=0;break;case 18:for(te=He(Me,7,11);te;--te)Kt[U++]=0;break;default:Kt[U++]=ie;break}}Ws(yt,Kt,0,y),Ws(u,Kt,y,w)}function et(Me,yt,u){for(;;){var y=We(Me,yt);if(y===256)return mt;if(y<256)Me.dest[Me.destLen++]=y;else{var w,D,N,U;for(y-=257,w=He(Me,oi[y],ki[y]),D=We(Me,u),N=Me.destLen-He(Me,Li[D],Wi[D]),U=N;U<N+w;++U)Me.dest[Me.destLen++]=Me.dest[U]}}}function Ie(Me){for(var yt,u,y;Me.bitcount>8;)Me.sourceIndex--,Me.bitcount-=8;if(yt=Me.source[Me.sourceIndex+1],yt=256*yt+Me.source[Me.sourceIndex],u=Me.source[Me.sourceIndex+3],u=256*u+Me.source[Me.sourceIndex+2],yt!==(~u&65535))return Nt;for(Me.sourceIndex+=4,y=yt;y;--y)Me.dest[Me.destLen++]=Me.source[Me.sourceIndex++];return Me.bitcount=0,mt}function Ve(Me,yt){var u=new Mt(Me,yt),y,w,D;do{switch(y=K(u),w=He(u,2,0),w){case 0:D=Ie(u);break;case 1:D=et(u,jt,Ai);break;case 2:it(u,u.ltree,u.dtree),D=et(u,u.ltree,u.dtree);break;default:D=Nt}if(D!==mt)throw new Error("Data error")}while(!y);return u.destLen<u.dest.length?typeof u.dest.slice=="function"?u.dest.slice(0,u.destLen):u.dest.subarray(0,u.destLen):u.dest}return ls(jt,Ai),zs(oi,ki,4,3),zs(Li,Wi,2,1),oi[28]=0,ki[28]=258,Ve})(),t=(()=>{const mt=new Uint8Array(new Uint32Array([305419896]).buffer)[0]===18,Nt=(jt,Ai,oi)=>{let ki=jt[Ai];jt[Ai]=jt[oi],jt[oi]=ki},Gt=jt=>{const Ai=jt.length;for(let oi=0;oi<Ai;oi+=4)Nt(jt,oi,oi+3),Nt(jt,oi+1,oi+2)};return jt=>{mt&&Gt(jt)}})(),s=(()=>{class Ws{constructor(He){const We=typeof He.readUInt32BE=="function"&&typeof He.slice=="function";if(We||He instanceof Uint8Array){let it;if(We)this.highStart=He.readUInt32LE(0),this.errorValue=He.readUInt32LE(4),it=He.readUInt32LE(8),He=He.slice(12);else{const et=new DataView(He.buffer);this.highStart=et.getUint32(0,!0),this.errorValue=et.getUint32(4,!0),it=et.getUint32(8,!0),He=He.subarray(12)}He=a(He,new Uint8Array(it)),He=a(He,new Uint8Array(it)),t(He),this.data=new Uint32Array(He.buffer)}else({data:this.data,highStart:this.highStart,errorValue:this.errorValue}=He)}get(He){let We;return He<0||He>1114111?this.errorValue:He<55296||He>56319&&He<=65535?(We=(this.data[He>>5]<<2)+(He&31),this.data[We]):He<=65535?(We=(this.data[2048+(He-55296>>5)]<<2)+(He&31),this.data[We]):He<this.highStart?(We=this.data[2080+(He>>11)],We=this.data[We+(He>>5&63)],We=(We<<2)+(He&31),this.data[We]):this.data[this.data.length-4]}}return Ws})(),n=(mt=>{const Nt=window.atob(mt),Gt=new Uint8Array(Nt.length);for(var Mt=0;Mt<Nt.length;Mt++)Gt[Mt]=Nt.charCodeAt(Mt);return Gt})("AAgOAAAAAAAQ4QAAAQ0P8vDtnQuMXUUZx+eyu7d7797d9m5bHoWltKVUlsjLWE0VJNigQoMVqkStEoNQQUl5GIo1KKmogEgqkKbBRki72lYabZMGKoGAjQRtJJDaCCIRiiigREBQS3z+xzOTnZ3O+3HOhd5NfpkzZx7fN9988zivu2M9hGwB28F94DnwEngd/Asc1EtIs9c/bIPDwCxwLDgezHcodyo4w5C+CCwBS8FnwSXgCnA1uFbI93XwbXAbWAfWgx+CzWAb+An4KfgFeAzsYWWfYuFz4CXwGvgb+Dfo6yNkEEwGh4CZYB44FpwI3g1OY+kfBItZOo2fB84Hy8DF4HJwNbiWpV8PVoO1LH4n2NRXyN+KcAd4kNVP9XsY4aPgcfAbsBfs6SniL4K/sPjfEf6HlanXCRkCw2BGvUh/keWfXS/CY+pFXs7x9XHmM94LTmWIeU2cgbxnS/k/B3kf86jDhU8L9V2E40vAFWAlWFUfb++NOL4F3C7JX4/4GiE+hvgWsF0oS7mXldspnN+F493gyXrh9xTav0cg3EvzgVfBG6wsmVSEkxBOBgdPGpd7JI6PnqRvJ68/xlbHof53gPeA94OzwLngk+ACsAwsByvASrAK3MB0Ws3CtQjvBJvAVrADPMDSHkb4CNijaccTwvnf4fiPEs8Lxy+D18A/QU8/xjgYBjPAbDAKTgYLwOngTHAO+EQ/8wuEF4EvsPiVCFf2+9tsFStzA8LVHuXXBsi6QyqzUYiPMR/7Mc7dAx7oL8bzw/3u/Bw8Bp4Az4AXwCtgHzsmDXP5fiF9iiVvly5d0sHngar16NKlS5cuXbp06fLmYlqHXrcd3ph4P0THUY3iXh49novju4S0tzfs5d+JPKewfAsRntZb3K9ZhOMlrO6lCC8An28U9+OuovcPcPxlVu5rCL/VmHh/iHIrzn3fIPu7SN8Axmg+8AOwEWwCm7tp3bRuWjetm5Y8bSu4B9zbKO6ZVsnORrVU3f4uXTqZ2H3sLoyx3eDXjfDndE9qyj6L838CfwVvgFpzYnof4oNgOhgBc8Fos9DrZIQLmtXPP1MmF6wGj4H+KXoWguvADkXaPil+YpuQy8Am8Ey7ODdtmJDF4HowBp4De6HDTNjhfHAHeBr0DBBy0kDxfPbcgSIusgrcWhtnJ8vL+TPix7UIOQtcBq4C28Cr4KRBnANbwSuDE+s50JgyNNFuXbp06XIgsXjIvPafjvXozKY+fVFz/z0LT1uCtKVSWbrOLWPnztG8e0Xfy7ol8XtZJi7WtG+5od2UFXQ/A12vUeS7jp27yVKHjdsU9lXB869TyNvAzt0lpP2oWbwLdjiO78bx/Sz+EMJHwK9Y/LcIfw+eZ3F67/Hl5vh9xX80J+rwX8SvRDhpgL17iPAQMHNArfPrqHPewLheI+AERV6efwV418B4nOZ/H+IfYHV8GOF5LJ3eAz0fx8sM9S0fUNud39O9CulfGZhY5huI3wzWgNvBelbHZoTbNPVpfYjKQpkHwUNgl0LWblbnk0LbbDxr0OMFpL3iqWdu9nWYPlVAWkXY39LnGdCkDbeqv1YNbfcMQ3t9oe8lzm6NH9N1ZB6Ln4BwfkJZJk7RyFnYKt6b/JDQXx9p5X+eFdqOjzM9P9MB/lUlFzr20aXIdzlY4dmn9F3YqtvoO76/2hp/D/xA5Zue88nNyL8GbFbs075X0tyUig3Qd2MCnf//HjnzpbsR3g9+1kHzzVjdnE71/qVBX9rGPUh/ysNWe1neFzvIDi5zAufV1sT0N0poR22wkFUfTOPfA4N2mbZ5fSrqOHSw+IbkSBbOGSzSRgf91/GTUWYBOB2cIZQ/G8cfBZ8CFwrnL8XxF8FKcA24jqXdiPA7Qr61OF7H4mMItwzuv2/YLth1ISt3Hzu3k4W7EH5JqPdRHD/O4k+z8A8IX5Lq3y7Z4nXE9xn6kX6vQ4bKfy+ok+hH+xf3hq9dnTTHhjKd2GmDuWA242iHMq4cC7A8kJ7i8o1+skSa7Jieo38HCWnoNjKFhdSFBxzpZ7QE6lI8N4S14aASZcryaV/WWHw66f6NHuCoxuQxmvM56GX9QMd8Q4D65ywGP+ZzRJuM+zQvx/MOS2VFeqQ4IXnH26zM9Xe6/E6D+4foAzzuajPZp8Qyw5ayZVDWuH0z0BtYRkeIDqH9KO9VbH1btd/lhNqCzvl8zeLnG0S/hnU6baHfpiuO6yy0rd+DHURo/zYF5H26j03rQsip2ndzz82u1z9N4VjWKWeb68Tedpt95HRVXp7H1R6p+/Wt4FPy/PpWwscOLRJ+PVWF/+W0iVyGzs18TIvXkOJ1Wxm66vSXz+vylenrZcj1ub439W+K8RNCGTJi2p/TJ1K23VaXr35tRpnzmjxequgfcfyk6B/TGBVlyedsNgpdd/h+W1U3P99QyFPNo1X3TwpM/WLTIWYfoBqXrv6iskHZ/RFr79R6hIyHBrH3f1nrUVnjP8SnZZ+rYtzr9Exld5MNbPNErusAPg+77u/eDOPftU9yj39TH7rezxd1LvsZQJlzkWlOirG/79zjMj/mtHUKu7vKy+3/LnXr9okyKedjX5/0He9iP/j63LwOQdarEVlfy8OO/Lqw023j6xcqmwxLiOd6heM2i9cV9LJy8jMJ23yQ+rpbfu7EQ/pXE8KYvUSqvVnb4XzZa6LrHMXHR+zcLvqWbm/Bn0/HzIs6fWPHoat8XfnDKmZGxRxeMbn2UqZ5Q94nmcZRbqqUXbZ8+lcjE+cPX11t814orvvAXNcG8vqj2vvk1MGn3anlj0bIT72v47bvE+Lc98T9b6r7AKn6j+8Duf7D0nnZx/j7Zjn0j9nbpSTndaLr9WNLivP+iN23xF7L+fqv6ZouFyb78jxVXvv5jJ9YUs9/sddO8h7KNg5jrhfaJGztT6G7KF+1d6yCmD5Kdb2fan60rSc552fZr3zeQ9DpnPp+Si5cx5Ktv2QfSzF/mMbWdOm46rFI4XstnU9xeqX4NKb7TKEdcr6pZOK3ID1k/LvFHkVczEuZLEDr499YqvqBym1aEHWgcvoYOtv0M91qQl5TfpO/in6rWx8OVpT1Wedkv3f5xom3T/xeR/6Gx6V86PWAOB4bBpqWdN+yTcVxjIyGRz/FrDGu6w/3d7kPm8StX8RyPu+uuvpNju/vTLJV37GpvoM0oZPnW87VLnL/5pDno1NoW1R6yedU6TyUv3u19a3KFnIbTLYz+ZCLP4T0tU1uivFgso0pnsJ/UtXvarNY28Xq5cvkBDrQP/E5ZaiuQwwfmTlsOiQRU1fMuqrDd/3ISSuwjOwXOfTyGUMpZIXq4GpLn3pUcdfzch2x7XO1u2uZHOPb1G6b3Xg9PH1IIWeEpJlPQtqos2EKW8b0u8rnuP1UeVLoXJb9be0uG9nnbchjU+XTszT5VeNBThPHnc5OKj1U9aj0GTHIVaGy1YhEWT4ixns00DT+XEzWn/7VAsIc63Cov3OdyhwjrnaqQqZvWKXdypRdlq+k8msZ031U+Rm4fA+3TtyeR9hwfW9G9yxDN0fZMN33F+9TE6md4hwoxumfaUzI9fN3PFT3xVV2msrQ3UsnChm6Nulk8TndpS28D3zX9tTIPsF/z7Am5OkTjm1tI1JZW74+4VgsZ0N3L1yXV3WeP5uR7TGHHdvC3JQlxybfpd22tDlk/2eofRK8TzrN/qnar/K/OUTth6I/+jAnEptNbPvFHP2gs40N3+dfMWtwqvVct7/wfd8gtQ7imifial9ZJ9/3IHLYU6eDj3+4PhsNhX+vwvcWLnu6kGfEMe8DuciPfUfGZB8X/7HJy/Gefe5n+VRGFd/wyP2ta7/LO4yh/sbLV/k9lev6kfO9Dt/5U67b1/6u/epqB1U9Me23jfHY9sscAg4tkbLl+e4/U36rJ9ddxfd6sg5vq5ice42Wpk/pb9FOJ36/W9tpv4kbC79nUbZceX8Zu6/qJ+P3WvhvA8v3reh7Jbn2d6rrNC7XNZTLma4Ba0JI9efX2uLzF5scG/w9UNU1ZxW+ymUfzELeTllXlQ1rUuhzjS5fp9c964iFBOqeSz63bU065nZKdU+mDEz3qHIjjifquw0pnb/raRtvrnsYcb46ihT3taoYz6brdNW9l6rWRnE/navdPn1XlR1km7hcz1WlH/elKuSOSvLLuE8U6m8uzwRdfcGl73VyTHuyMvzJ1Sa2cWDTP/Z63Kc94n2B1PYr24dz1JlyHLlcP+S4B6vD1c9EW4q2LWstCvUjeVy63k/LMYdUNd5D1xQfvVTzX1VjkMsUv88N8VH5fReVn/Fjn++/h6X6Q8a6b1/q3g/i/ewi0/Scs8zxXeV6mWIOUPlPzBgdFerW+bZrm2P18dnjuK6HunEp+rHvPMXbr+sHVb/lnL+pTP57jPw9Cvk3PW178JD9qChfzuvTf7Htl38L1QUf/VKu9SFjwWbTWPvFEvu7Uq76y7+31g6QlYPc669pbsm9Xur2LWI9Pu8ypfDXqm3A2z8s1FWGn4ntL9NfQu2oSlftX9uetvTtv7J8Ql4zxfXGZ3zk8PeQ9w59x2uMfqI8/q5eKh/l9cb2rwsu9rSNl06ZP2Pmxtz+rNMx93yno0n2/82rVH7rQ+y9P15H6FyRun9ViH81ATmffI7nJ5r8uXXW6enbP6b/B8/l5OifVHYLnb9S39s2zcc+Ph+rh8+eQgVPS72elzGWY/tUtbbabBpDiI7yN1q6/4th2y+ErAc5+9BVvu/7KamJbWNZeuqI/R4tRf+YyD1HmOZM1bMV3/14Sn10c0Xu+Sj1nOXb5jL73ncdy02uvlXZNde65dOHYl7Vs4KYuS6FzWLn2zJlpZqPXPVPOa5yzKOyn1VhT9lmMfdbfH7D11Wf2PXN5h9y+dD287+qxgSnaYmnIrRtIb8pJe6/Uv9OVer6Whn0zfGO/BEloZI9ojmfAlUflClDd178bTmVHVTpZXOkAlk/lb42UujmI89HH5V+cl7XtowY6vTxLVWok6UrGzoGTHN+bB+6ri05687VNpvfuvRfaP2uMlNQth1D5JjGelm/8yn+9p3p/7qk9gnfeddXZmq/Sm333PJT659Kv1zjNbZ9uv2Oi//67CV8/N1nj1DmviyXDNVeJkaeaX8UsyesYg8cu2+NvdaPfb+lLDu5tvt/"),l=new s(n),h=5,g=12,d=13,A=16,S=17,O=22,I=28,W=31,L=33,H=34,Y=35,Q=36,pe=37,de=38,fe=39,ye=40,Ee=41,Le=42,Z=0,ne=1,Ke=2,_t=3,xe=4,Ct=[[xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,_t,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe],[Z,xe,xe,ne,ne,xe,xe,xe,xe,ne,ne,Z,Z,Z,Z,ne,ne,ne,Z,Z,xe,Ke,xe,Z,Z,Z,Z,Z,Z,Z,Z,ne,Z],[Z,xe,xe,ne,ne,xe,xe,xe,xe,ne,ne,ne,ne,ne,Z,ne,ne,ne,Z,Z,xe,Ke,xe,Z,Z,Z,Z,Z,Z,Z,Z,ne,Z],[xe,xe,xe,ne,ne,ne,xe,xe,xe,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,xe,Ke,xe,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne],[ne,xe,xe,ne,ne,ne,xe,xe,xe,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,xe,Ke,xe,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne],[Z,xe,xe,ne,ne,ne,xe,xe,xe,Z,Z,Z,Z,Z,Z,ne,ne,ne,Z,Z,xe,Ke,xe,Z,Z,Z,Z,Z,Z,Z,Z,ne,Z],[Z,xe,xe,ne,ne,ne,xe,xe,xe,Z,Z,Z,Z,Z,Z,ne,ne,ne,Z,Z,xe,Ke,xe,Z,Z,Z,Z,Z,Z,Z,Z,ne,Z],[Z,xe,xe,ne,ne,ne,xe,xe,xe,Z,Z,ne,Z,ne,Z,ne,ne,ne,Z,Z,xe,Ke,xe,Z,Z,Z,Z,Z,Z,Z,Z,ne,Z],[Z,xe,xe,ne,ne,ne,xe,xe,xe,Z,Z,ne,ne,ne,Z,ne,ne,ne,Z,Z,xe,Ke,xe,Z,Z,Z,Z,Z,Z,Z,Z,ne,Z],[ne,xe,xe,ne,ne,ne,xe,xe,xe,Z,Z,ne,ne,ne,ne,ne,ne,ne,Z,Z,xe,Ke,xe,ne,ne,ne,ne,ne,Z,ne,ne,ne,Z],[ne,xe,xe,ne,ne,ne,xe,xe,xe,Z,Z,ne,ne,ne,Z,ne,ne,ne,Z,Z,xe,Ke,xe,Z,Z,Z,Z,Z,Z,Z,Z,ne,Z],[ne,xe,xe,ne,ne,ne,xe,xe,xe,ne,ne,ne,ne,ne,Z,ne,ne,ne,Z,Z,xe,Ke,xe,Z,Z,Z,Z,Z,Z,Z,Z,ne,Z],[ne,xe,xe,ne,ne,ne,xe,xe,xe,ne,ne,ne,ne,ne,Z,ne,ne,ne,Z,Z,xe,Ke,xe,Z,Z,Z,Z,Z,Z,Z,Z,ne,Z],[ne,xe,xe,ne,ne,ne,xe,xe,xe,ne,ne,ne,ne,ne,Z,ne,ne,ne,Z,Z,xe,Ke,xe,Z,Z,Z,Z,Z,Z,Z,Z,ne,Z],[Z,xe,xe,ne,ne,ne,xe,xe,xe,Z,ne,Z,Z,Z,Z,ne,ne,ne,Z,Z,xe,Ke,xe,Z,Z,Z,Z,Z,Z,Z,Z,ne,Z],[Z,xe,xe,ne,ne,ne,xe,xe,xe,Z,Z,Z,Z,Z,Z,ne,ne,ne,Z,Z,xe,Ke,xe,Z,Z,Z,Z,Z,Z,Z,Z,ne,Z],[Z,xe,xe,ne,Z,ne,xe,xe,xe,Z,Z,ne,Z,Z,Z,ne,ne,ne,Z,Z,xe,Ke,xe,Z,Z,Z,Z,Z,Z,Z,Z,ne,Z],[Z,xe,xe,ne,Z,ne,xe,xe,xe,Z,Z,Z,Z,Z,Z,ne,ne,ne,Z,Z,xe,Ke,xe,Z,Z,Z,Z,Z,Z,Z,Z,ne,Z],[ne,xe,xe,ne,ne,ne,xe,xe,xe,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,xe,Ke,xe,ne,ne,ne,ne,ne,ne,ne,ne,ne,Z],[Z,xe,xe,ne,ne,ne,xe,xe,xe,Z,Z,Z,Z,Z,Z,ne,ne,ne,Z,xe,xe,Ke,xe,Z,Z,Z,Z,Z,Z,Z,Z,ne,Z],[Z,Z,Z,Z,Z,Z,Z,Z,Z,Z,Z,Z,Z,Z,Z,Z,Z,Z,Z,Z,xe,Z,Z,Z,Z,Z,Z,Z,Z,Z,Z,Z,Z],[ne,xe,xe,ne,ne,ne,xe,xe,xe,ne,ne,ne,ne,ne,Z,ne,ne,ne,Z,Z,xe,Ke,xe,Z,Z,Z,Z,Z,Z,Z,Z,ne,Z],[ne,xe,xe,ne,ne,ne,xe,xe,xe,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,xe,Ke,xe,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne],[Z,xe,xe,ne,ne,ne,xe,xe,xe,Z,ne,Z,Z,Z,Z,ne,ne,ne,Z,Z,xe,Ke,xe,Z,Z,Z,ne,ne,Z,Z,Z,ne,Z],[Z,xe,xe,ne,ne,ne,xe,xe,xe,Z,ne,Z,Z,Z,Z,ne,ne,ne,Z,Z,xe,Ke,xe,Z,Z,Z,Z,ne,Z,Z,Z,ne,Z],[Z,xe,xe,ne,ne,ne,xe,xe,xe,Z,ne,Z,Z,Z,Z,ne,ne,ne,Z,Z,xe,Ke,xe,ne,ne,ne,ne,Z,Z,Z,Z,ne,Z],[Z,xe,xe,ne,ne,ne,xe,xe,xe,Z,ne,Z,Z,Z,Z,ne,ne,ne,Z,Z,xe,Ke,xe,Z,Z,Z,ne,ne,Z,Z,Z,ne,Z],[Z,xe,xe,ne,ne,ne,xe,xe,xe,Z,ne,Z,Z,Z,Z,ne,ne,ne,Z,Z,xe,Ke,xe,Z,Z,Z,Z,ne,Z,Z,Z,ne,Z],[Z,xe,xe,ne,ne,ne,xe,xe,xe,Z,Z,Z,Z,Z,Z,ne,ne,ne,Z,Z,xe,Ke,xe,Z,Z,Z,Z,Z,ne,Z,Z,ne,Z],[Z,xe,xe,ne,ne,ne,xe,xe,xe,Z,ne,Z,Z,Z,Z,ne,ne,ne,Z,Z,xe,Ke,xe,Z,Z,Z,Z,Z,Z,Z,ne,ne,Z],[Z,xe,xe,ne,ne,ne,xe,xe,xe,Z,ne,Z,Z,Z,Z,ne,ne,ne,Z,Z,xe,Ke,xe,Z,Z,Z,Z,Z,Z,Z,Z,ne,Z],[ne,xe,xe,ne,ne,ne,xe,xe,xe,ne,ne,ne,ne,ne,Z,ne,ne,ne,Z,Z,xe,Ke,xe,Z,Z,Z,Z,Z,Z,Z,Z,ne,Z],[Z,xe,xe,ne,ne,Z,xe,xe,xe,Z,Z,Z,Z,Z,Z,Z,Z,Z,Z,Z,xe,Ke,xe,Z,Z,Z,Z,Z,Z,Z,Z,ne,Z]],zt=function(mt){switch(mt){case L:return g;case fe:case ye:case Le:return g;case Y:return h;default:return mt}},Je=function(mt){switch(mt){case pe:case de:return H;case Ee:return O;default:return mt}};class Et{constructor(Nt,Gt=!1){this.position=Nt,this.required=Gt}}class ht{constructor(Nt){this.string=Nt,this.pos=0,this.lastPos=0,this.curClass=null,this.nextClass=null,this.LB8a=!1,this.LB21a=!1,this.LB30a=0}nextCodePoint(){const Nt=this.string.charCodeAt(this.pos++),Gt=this.string.charCodeAt(this.pos);return 55296<=Nt&&Nt<=56319&&56320<=Gt&&Gt<=57343?(this.pos++,(Nt-55296)*1024+(Gt-56320)+65536):Nt}nextCharClass(){return zt(l.get(this.nextCodePoint()))}getSimpleBreak(){switch(this.nextClass){case Ee:return!1;case H:case pe:case de:return this.curClass=H,!1;case Q:return this.curClass=Q,!1}return null}getPairTableBreak(Nt){let Gt=!1;switch(Ct[this.curClass][this.nextClass]){case Z:Gt=!0;break;case ne:Gt=Nt===Ee;break;case Ke:if(Gt=Nt===Ee,!Gt)return Gt=!1,Gt;break;case _t:if(Nt!==Ee)return Gt;break}return this.LB8a&&(Gt=!1),this.LB21a&&(this.curClass===A||this.curClass===S)?(Gt=!1,this.LB21a=!1):this.LB21a=this.curClass===d,this.curClass===I?(this.LB30a++,this.LB30a==2&&this.nextClass===I&&(Gt=!0,this.LB30a=0)):this.LB30a=0,this.curClass=this.nextClass,Gt}nextBreak(){if(this.curClass==null){let Nt=this.nextCharClass();this.curClass=Je(Nt),this.nextClass=Nt,this.LB8a=Nt===W,this.LB30a=0}for(;this.pos<this.string.length;){this.lastPos=this.pos;const Nt=this.nextClass;if(this.nextClass=this.nextCharClass(),this.curClass===H||this.curClass===Q&&this.nextClass!==pe)return this.curClass=Je(zt(this.nextClass)),new Et(this.lastPos,!0);let Gt=this.getSimpleBreak();if(Gt===null&&(Gt=this.getPairTableBreak(Nt)),this.LB8a=this.nextClass===W,Gt)return new Et(this.lastPos)}return this.lastPos<this.string.length?(this.lastPos=this.string.length,new Et(this.string.length)):null}}return ht})();class FlatQueue{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(t,s){let r=this.length++;for(this.ids[r]=t,this.values[r]=s;r>0;){const o=r-1>>1,n=this.values[o];if(s>=n)break;this.ids[r]=this.ids[o],this.values[r]=n,r=o}this.ids[r]=t,this.values[r]=s}pop(){if(this.length===0)return;const t=this.ids[0];if(this.length--,this.length>0){const s=this.ids[0]=this.ids[this.length],r=this.values[0]=this.values[this.length],o=this.length>>1;let n=0;for(;n<o;){let l=(n<<1)+1;const h=l+1;let g=this.ids[l],d=this.values[l];const A=this.values[h];if(h<this.length&&A<d&&(l=h,g=this.ids[h],d=A),d>=r)break;this.ids[n]=g,this.values[n]=d,n=l}this.ids[n]=s,this.values[n]=r}return t}peek(){if(this.length!==0)return this.ids[0]}peekValue(){if(this.length!==0)return this.values[0]}}window.FlatQueue=FlatQueue;var paperJs0_12_17={exports:{}};/*!
 * Paper.js v0.12.17 - The Swiss Army Knife of Vector Graphics Scripting.
 * http://paperjs.org/
 *
 * Copyright (c) 2011 - 2020, Jürg Lehni & Jonathan Puckey
 * http://juerglehni.com/ & https://puckey.studio/
 *
 * Distributed under the MIT license. See LICENSE file for details.
 *
 * All rights reserved.
 *
 * Date: Thu Nov 3 21:15:36 2022 +0100
 *
 ***
 *
 * Straps.js - Class inheritance library with support for bean-style accessors
 *
 * Copyright (c) 2006 - 2020 Jürg Lehni
 * http://juerglehni.com/
 *
 * Distributed under the MIT license.
 *
 ***
 *
 * Acorn.js
 * https://marijnhaverbeke.nl/acorn/
 *
 * Acorn is a tiny, fast JavaScript parser written in JavaScript,
 * created by Marijn Haverbeke and released under an MIT license.
 *
 */(function(a){(function(t,s){t=t||r.self;var r=t.window,o=t.document,n=new function(){var u=/^(statics|enumerable|beans|preserve)$/,y=[],w=y.slice,D=Object.create,N=Object.getOwnPropertyDescriptor,U=Object.defineProperty,te=y.forEach||function(be,ge){for(var Ce=0,Ne=this.length;Ce<Ne;Ce++)be.call(ge,this[Ce],Ce,this)},J=function(be,ge){for(var Ce in this)this.hasOwnProperty(Ce)&&be.call(ge,this[Ce],Ce,this)},ie=Object.assign||function(be){for(var ge=1,Ce=arguments.length;ge<Ce;ge++){var Ne=arguments[ge];for(var qe in Ne)Ne.hasOwnProperty(qe)&&(be[qe]=Ne[qe])}return be},ae=function(be,ge,Ce){if(be){var Ne=N(be,"length");(Ne&&typeof Ne.value=="number"?te:J).call(be,ge,Ce=Ce||be)}return Ce};function ve(be,ge,Ce,Ne,qe){var Ae={};function ke(Ye,je){je=je||(je=N(ge,Ye))&&(je.get?je:je.value),typeof je=="string"&&je[0]==="#"&&(je=be[je.substring(1)]||je);var Ze=typeof je=="function",tt=je,ut=qe||Ze&&!je.base?je&&je.get?Ye in be:be[Ye]:null,nt;(!qe||!ut)&&(Ze&&ut&&(je.base=ut),Ze&&Ne!==!1&&(nt=Ye.match(/^([gs]et|is)(([A-Z])(.*))$/))&&(Ae[nt[3].toLowerCase()+nt[4]]=nt[2]),(!tt||Ze||!tt.get||typeof tt.get!="function"||!Se.isPlainObject(tt))&&(tt={value:tt,writable:!0}),(N(be,Ye)||{configurable:!0}).configurable&&(tt.configurable=!0,tt.enumerable=Ce??!nt),U(be,Ye,tt))}if(ge){for(var me in ge)ge.hasOwnProperty(me)&&!u.test(me)&&ke(me);for(var me in Ae){var Te=Ae[me],Re=be["set"+Te],Fe=be["get"+Te]||Re&&be["is"+Te];Fe&&(Ne===!0||Fe.length===0)&&ke(me,{get:Fe,set:Re})}}return be}function Se(){for(var be=0,ge=arguments.length;be<ge;be++){var Ce=arguments[be];Ce&&ie(this,Ce)}return this}return ve(Se,{inject:function(be){if(be){var ge=be.statics===!0?be:be.statics,Ce=be.beans,Ne=be.preserve;ge!==be&&ve(this.prototype,be,be.enumerable,Ce,Ne),ve(this,ge,null,Ce,Ne)}for(var qe=1,Ae=arguments.length;qe<Ae;qe++)this.inject(arguments[qe]);return this},extend:function(){for(var be=this,ge,Ce,Ne=0,qe,Ae=arguments.length;Ne<Ae&&!(ge&&Ce);Ne++)qe=arguments[Ne],ge=ge||qe.initialize,Ce=Ce||qe.prototype;return ge=ge||function(){be.apply(this,arguments)},Ce=ge.prototype=Ce||D(this.prototype),U(Ce,"constructor",{value:ge,writable:!0,configurable:!0}),ve(ge,this),arguments.length&&this.inject.apply(ge,arguments),ge.base=be,ge}}).inject({enumerable:!1,initialize:Se,set:Se,inject:function(){for(var be=0,ge=arguments.length;be<ge;be++){var Ce=arguments[be];Ce&&ve(this,Ce,Ce.enumerable,Ce.beans,Ce.preserve)}return this},extend:function(){var be=D(this);return be.inject.apply(be,arguments)},each:function(be,ge){return ae(this,be,ge)},clone:function(){return new this.constructor(this)},statics:{set:ie,each:ae,create:D,define:U,describe:N,clone:function(be){return ie(new be.constructor,be)},isPlainObject:function(be){var ge=be!=null&&be.constructor;return ge&&(ge===Object||ge===Se||ge.name==="Object")},pick:function(be,ge){return be!==s?be:ge},slice:function(be,ge,Ce){return w.call(be,ge,Ce)}}})};r.paper=n,n.inject({enumerable:!1,toString:function(){return this._id!=null?(this._class||"Object")+(this._name?" '"+this._name+"'":" @"+this._id):"{ "+n.each(this,function(u,y){if(!/^_/.test(y)){var w=typeof u;this.push(y+": "+(w==="number"?A.instance.number(u):w==="string"?"'"+u+"'":u))}},[]).join(", ")+" }"},getClassName:function(){return this._class||""},importJSON:function(u){return n.importJSON(u,this)},exportJSON:function(u){return n.exportJSON(this,u)},toJSON:function(){return n.serialize(this)},set:function(u,y){return u&&n.filter(this,u,y,this._prioritize),this}},{beans:!1,statics:{exports:{},extend:function u(){var y=u.base.apply(this,arguments),w=y.prototype._class;return w&&!n.exports[w]&&(n.exports[w]=y),y},equals:function(u,y){if(u===y)return!0;if(u&&u.equals)return u.equals(y);if(y&&y.equals)return y.equals(u);if(u&&y&&typeof u=="object"&&typeof y=="object"){if(Array.isArray(u)&&Array.isArray(y)){var w=u.length;if(w!==y.length)return!1;for(;w--;)if(!n.equals(u[w],y[w]))return!1}else{var D=Object.keys(u),w=D.length;if(w!==Object.keys(y).length)return!1;for(;w--;){var N=D[w];if(!(y.hasOwnProperty(N)&&n.equals(u[N],y[N])))return!1}}return!0}return!1},read:function(u,y,w,D){if(this===n){var N=this.peek(u,y);return u.__index++,N}var U=this.prototype,te=U._readIndex,J=y||te&&u.__index||0,ie=u.length,ae=u[J];if(D=D||ie-J,ae instanceof this||w&&w.readNull&&ae==null&&D<=1)return te&&(u.__index=J+1),ae&&w&&w.clone?ae.clone():ae;if(ae=n.create(U),te&&(ae.__read=!0),ae=ae.initialize.apply(ae,J>0||J+D<ie?n.slice(u,J,J+D):u)||ae,te){u.__index=J+ae.__read;var ve=ae.__filtered;ve&&(u.__filtered=ve,ae.__filtered=s),ae.__read=s}return ae},peek:function(u,y){return u[u.__index=y||u.__index||0]},remain:function(u){return u.length-(u.__index||0)},readList:function(u,y,w,D){for(var N=[],U,te=y||0,J=D?te+D:u.length,ie=te;ie<J;ie++)N.push(Array.isArray(U=u[ie])?this.read(U,0,w):this.read(u,ie,w,1));return N},readNamed:function(u,y,w,D,N){var U=this.getNamed(u,y),te=U!==s;if(te){var J=u.__filtered;if(!J){var ie=this.getSource(u);J=u.__filtered=n.create(ie),J.__unfiltered=ie}J[y]=s}return this.read(te?[U]:u,w,D,N)},readSupported:function(u,y){var w=this.getSource(u),D=this,N=!1;return w&&Object.keys(w).forEach(function(U){if(U in y){var te=D.readNamed(u,U);te!==s&&(y[U]=te),N=!0}}),N},getSource:function(u){var y=u.__source;if(y===s){var w=u.length===1&&u[0];y=u.__source=w&&n.isPlainObject(w)?w:null}return y},getNamed:function(u,y){var w=this.getSource(u);if(w)return y?w[y]:u.__filtered||w},hasNamed:function(u,y){return!!this.getNamed(u,y)},filter:function(u,y,w,D){var N;function U(ve){if(!(w&&ve in w)&&!(N&&ve in N)){var Se=y[ve];Se!==s&&(u[ve]=Se)}}if(D){for(var te={},J=0,ie,ae=D.length;J<ae;J++)(ie=D[J])in y&&(U(ie),te[ie]=!0);N=te}return Object.keys(y.__unfiltered||y).forEach(U),u},isPlainValue:function(u,y){return n.isPlainObject(u)||Array.isArray(u)||y&&typeof u=="string"},serialize:function(u,y,w,D){y=y||{};var N=!D,U;if(N&&(y.formatter=new A(y.precision),D={length:0,definitions:{},references:{},add:function(Se,be){var ge="#"+Se._id,Ce=this.references[ge];if(!Ce){this.length++;var Ne=be.call(Se),qe=Se._class;qe&&Ne[0]!==qe&&Ne.unshift(qe),this.definitions[ge]=Ne,Ce=this.references[ge]=[ge]}return Ce}}),u&&u._serialize){U=u._serialize(y,D);var te=u._class;te&&!u._compactSerialize&&(N||!w)&&U[0]!==te&&U.unshift(te)}else if(Array.isArray(u)){U=[];for(var J=0,ie=u.length;J<ie;J++)U[J]=n.serialize(u[J],y,w,D)}else if(n.isPlainObject(u)){U={};for(var ae=Object.keys(u),J=0,ie=ae.length;J<ie;J++){var ve=ae[J];U[ve]=n.serialize(u[ve],y,w,D)}}else typeof u=="number"?U=y.formatter.number(u,y.precision):U=u;return N&&D.length>0?[["dictionary",D.definitions],U]:U},deserialize:function(u,y,w,D,N){var U=u,te=!w,J=te&&u&&u.length&&u[0][0]==="dictionary";if(w=w||{},Array.isArray(u)){var ie=u[0],ae=ie==="dictionary";if(u.length==1&&/^#/.test(ie))return w.dictionary[ie];ie=n.exports[ie],U=[];for(var ve=ie?1:0,Se=u.length;ve<Se;ve++)U.push(n.deserialize(u[ve],y,w,ae,J));if(ie){var be=U;y?U=y(ie,be,te||N):U=new ie(be)}}else if(n.isPlainObject(u)){U={},D&&(w.dictionary=U);for(var ge in u)U[ge]=n.deserialize(u[ge],y,w)}return J?U[1]:U},exportJSON:function(u,y){var w=n.serialize(u,y);return y&&y.asString==!1?w:JSON.stringify(w)},importJSON:function(u,y){return n.deserialize(typeof u=="string"?JSON.parse(u):u,function(w,D,N){var U=N&&y&&y.constructor===w,te=U?y:n.create(w.prototype);if(D.length===1&&te instanceof ye&&(U||!(te instanceof Le))){var J=D[0];n.isPlainObject(J)&&(J.insert=!1,U&&(D=D.concat([ye.INSERT])))}return(U?te.set:w).apply(te,D),U&&(y=null),te})},push:function(u,y){var w=y.length;if(w<4096)u.push.apply(u,y);else{var D=u.length;u.length+=w;for(var N=0;N<w;N++)u[D+N]=y[N]}return u},splice:function(u,y,w,D){var N=y&&y.length,U=w===s;w=U?u.length:w,w>u.length&&(w=u.length);for(var te=0;te<N;te++)y[te]._index=w+te;if(U)return n.push(u,y),[];var J=[w,D];y&&n.push(J,y);for(var ie=u.splice.apply(u,J),te=0,ae=ie.length;te<ae;te++)ie[te]._index=s;for(var te=w+N,ae=u.length;te<ae;te++)u[te]._index=te;return ie},capitalize:function(u){return u.replace(/\b[a-z]/g,function(y){return y.toUpperCase()})},camelize:function(u){return u.replace(/-(.)/g,function(y,w){return w.toUpperCase()})},hyphenate:function(u){return u.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var l={on:function(u,y){if(typeof u!="string")n.each(u,function(U,te){this.on(te,U)},this);else{var w=this._eventTypes,D=w&&w[u],N=this._callbacks=this._callbacks||{};N=N[u]=N[u]||[],N.indexOf(y)===-1&&(N.push(y),D&&D.install&&N.length===1&&D.install.call(this,u))}return this},off:function(u,y){if(typeof u!="string"){n.each(u,function(te,J){this.off(J,te)},this);return}var w=this._eventTypes,D=w&&w[u],N=this._callbacks&&this._callbacks[u],U;return N&&(!y||(U=N.indexOf(y))!==-1&&N.length===1?(D&&D.uninstall&&D.uninstall.call(this,u),delete this._callbacks[u]):U!==-1&&N.splice(U,1)),this},once:function(u,y){return this.on(u,function w(){y.apply(this,arguments),this.off(u,w)})},emit:function(u,y){var w=this._callbacks&&this._callbacks[u];if(!w)return!1;var D=n.slice(arguments,1),N=y&&y.target&&!y.currentTarget;w=w.slice(),N&&(y.currentTarget=this);for(var U=0,te=w.length;U<te;U++)if(w[U].apply(this,D)==!1){y&&y.stop&&y.stop();break}return N&&delete y.currentTarget,!0},responds:function(u){return!!(this._callbacks&&this._callbacks[u])},attach:"#on",detach:"#off",fire:"#emit",_installEvents:function(u){var y=this._eventTypes,w=this._callbacks,D=u?"install":"uninstall";if(y){for(var N in w)if(w[N].length>0){var U=y[N],te=U&&U[D];te&&te.call(this,N)}}},statics:{inject:function u(y){var w=y._events;if(w){var D={};n.each(w,function(N,U){var te=typeof N=="string",J=te?N:U,ie=n.capitalize(J),ae=J.substring(2).toLowerCase();D[ae]=te?{}:N,J="_"+J,y["get"+ie]=function(){return this[J]},y["set"+ie]=function(ve){var Se=this[J];Se&&this.off(ae,Se),ve&&this.on(ae,ve),this[J]=ve}}),y._eventTypes=D}return u.base.apply(this,arguments)}}},h=n.extend({_class:"PaperScope",initialize:function u(){yt=this,this.settings=new n({applyMatrix:!0,insertItems:!0,handleSize:4,hitTolerance:0}),this.project=null,this.projects=[],this.tools=[],this._id=u._id++,u._scopes[this._id]=this;var y=u.prototype;if(!this.support){var w=et.getContext(1,1)||{};y.support={nativeDash:"setLineDash"in w||"mozDash"in w,nativeBlendModes:Ie.nativeModes},et.release(w)}if(!this.agent){var D=t.navigator.userAgent.toLowerCase(),N=(/(darwin|win|mac|linux|freebsd|sunos)/.exec(D)||[])[0],U=N==="darwin"?"mac":N,te=y.agent=y.browser={platform:U};U&&(te[U]=!0),D.replace(/(opera|chrome|safari|webkit|firefox|msie|trident|atom|node|jsdom)\/?\s*([.\d]+)(?:.*version\/([.\d]+))?(?:.*rv\:v?([.\d]+))?/g,function(J,ie,ae,ve,Se){if(!te.chrome){var be=ie==="opera"?ve:/^(node|trident)$/.test(ie)?Se:ae;te.version=be,te.versionNumber=parseFloat(be),ie={trident:"msie",jsdom:"node"}[ie]||ie,te.name=ie,te[ie]=!0}}),te.chrome&&delete te.webkit,te.atom&&delete te.chrome}},version:"0.12.17",getView:function(){var u=this.project;return u&&u._view},getPaper:function(){return this},execute:function(u,y){},install:function(u){var y=this;n.each(["project","view","tool"],function(D){n.define(u,D,{configurable:!0,get:function(){return y[D]}})});for(var w in this)!/^_/.test(w)&&this[w]&&(u[w]=this[w])},setup:function(u){return yt=this,this.project=new fe(u),this},createCanvas:function(u,y){return et.getCanvas(u,y)},activate:function(){yt=this},clear:function(){for(var u=this.projects,y=this.tools,w=u.length-1;w>=0;w--)u[w].remove();for(var w=y.length-1;w>=0;w--)y[w].remove()},remove:function(){this.clear(),delete h._scopes[this._id]},statics:new function(){function u(y){return y+="Attribute",function(w,D){return w[y](D)||w[y]("data-paper-"+D)}}return{_scopes:{},_id:0,get:function(y){return this._scopes[y]||null},getAttribute:u("get"),hasAttribute:u("has")}}}),g=n.extend(l,{initialize:function(u){this._scope=yt,this._index=this._scope[this._list].push(this)-1,(u||!this._scope[this._reference])&&this.activate()},activate:function(){if(!this._scope)return!1;var u=this._scope[this._reference];return u&&u!==this&&u.emit("deactivate"),this._scope[this._reference]=this,this.emit("activate",u),!0},isActive:function(){return this._scope[this._reference]===this},remove:function(){return this._index==null?!1:(n.splice(this._scope[this._list],null,this._index,1),this._scope[this._reference]==this&&(this._scope[this._reference]=null),this._scope=null,!0)},getView:function(){return this._scope.getView()}}),d={findItemBoundsCollisions:function(u,y,w){function D(te){for(var J=new Array(te.length),ie=0;ie<te.length;ie++){var ae=te[ie].getBounds();J[ie]=[ae.left,ae.top,ae.right,ae.bottom]}return J}var N=D(u),U=!y||y===u?N:D(y);return this.findBoundsCollisions(N,U,w||0)},findCurveBoundsCollisions:function(u,y,w,D){function N(be){for(var ge=Math.min,Ce=Math.max,Ne=new Array(be.length),qe=0;qe<be.length;qe++){var Ae=be[qe];Ne[qe]=[ge(Ae[0],Ae[2],Ae[4],Ae[6]),ge(Ae[1],Ae[3],Ae[5],Ae[7]),Ce(Ae[0],Ae[2],Ae[4],Ae[6]),Ce(Ae[1],Ae[3],Ae[5],Ae[7])]}return Ne}var U=N(u),te=!y||y===u?U:N(y);if(D){for(var J=this.findBoundsCollisions(U,te,w||0,!1,!0),ie=this.findBoundsCollisions(U,te,w||0,!0,!0),ae=[],ve=0,Se=J.length;ve<Se;ve++)ae[ve]={hor:J[ve],ver:ie[ve]};return ae}return this.findBoundsCollisions(U,te,w||0)},findBoundsCollisions:function(u,y,w,D,N){var U=!y||u===y,te=U?u:u.concat(y),J=u.length,ie=te.length;function ae(ai,Ht,Ci){for(var Ti=0,Pi=ai.length;Ti<Pi;){var wi=Pi+Ti>>>1;te[ai[wi]][Ht]<Ci?Ti=wi+1:Pi=wi}return Ti-1}for(var ve=D?1:0,Se=ve+2,be=D?0:1,ge=be+2,Ce=new Array(ie),Ne=0;Ne<ie;Ne++)Ce[Ne]=Ne;Ce.sort(function(ai,Ht){return te[ai][ve]-te[Ht][ve]});for(var qe=[],Ae=new Array(J),Ne=0;Ne<ie;Ne++){var ke=Ce[Ne],me=te[ke],Te=U?ke:ke-J,Re=ke<J,Fe=U||!Re,Ye=Re?[]:null;if(qe.length){var je=ae(qe,Se,me[ve]-w)+1;if(qe.splice(0,je),U&&N){Ye=Ye.concat(qe);for(var Ze=0;Ze<qe.length;Ze++){var tt=qe[Ze];Ae[tt].push(Te)}}else for(var ut=me[ge],nt=me[be],Ze=0;Ze<qe.length;Ze++){var tt=qe[Ze],pt=te[tt],ft=tt<J,wt=U||tt>=J;(N||(Re&&wt||Fe&&ft)&&ut>=pt[be]-w&&nt<=pt[ge]+w)&&(Re&&wt&&Ye.push(U?tt:tt-J),Fe&&ft&&Ae[tt].push(Te))}}if(Re&&(u===y&&Ye.push(ke),Ae[ke]=Ye),qe.length){var Tt=me[Se],Vt=ae(qe,Se,Tt);qe.splice(Vt+1,0,ke)}else qe.push(ke)}for(var Ne=0;Ne<Ae.length;Ne++){var ni=Ae[Ne];ni&&ni.sort(function(Ht,Ci){return Ht-Ci})}return Ae}},A=n.extend({initialize:function(u){this.precision=n.pick(u,5),this.multiplier=Math.pow(10,this.precision)},number:function(u){return this.precision<16?Math.round(u*this.multiplier)/this.multiplier:u},pair:function(u,y,w){return this.number(u)+(w||",")+this.number(y)},point:function(u,y){return this.number(u.x)+(y||",")+this.number(u.y)},size:function(u,y){return this.number(u.width)+(y||",")+this.number(u.height)},rectangle:function(u,y){return this.point(u,y)+(y||",")+this.size(u,y)}});A.instance=new A;var S=new function(){var u=[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],y=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]],w=Math.abs,D=Math.sqrt,N=Math.pow,U=Math.log2||function(Se){return Math.log(Se)*Math.LOG2E},te=1e-12,J=112e-18;function ie(Se,be,ge){return Se<be?be:Se>ge?ge:Se}function ae(Se,be,ge){function Ce(je){var Ze=je*134217729,tt=je-Ze,ut=tt+Ze,nt=je-ut;return[ut,nt]}var Ne=be*be-Se*ge,qe=be*be+Se*ge;if(w(Ne)*3<qe){var Ae=Ce(Se),ke=Ce(be),me=Ce(ge),Te=be*be,Re=ke[0]*ke[0]-Te+2*ke[0]*ke[1]+ke[1]*ke[1],Fe=Se*ge,Ye=Ae[0]*me[0]-Fe+Ae[0]*me[1]+Ae[1]*me[0]+Ae[1]*me[1];Ne=Te-Fe+(Re-Ye)}return Ne}function ve(){var Se=Math.max.apply(Math,arguments);return Se&&(Se<1e-8||Se>1e8)?N(2,-Math.round(U(Se))):0}return{EPSILON:te,MACHINE_EPSILON:J,CURVETIME_EPSILON:1e-8,GEOMETRIC_EPSILON:1e-7,TRIGONOMETRIC_EPSILON:1e-8,ANGULAR_EPSILON:1e-5,KAPPA:4*(D(2)-1)/3,isZero:function(Se){return Se>=-te&&Se<=te},isMachineZero:function(Se){return Se>=-J&&Se<=J},clamp:ie,integrate:function(Se,be,ge,Ce){for(var Ne=u[Ce-2],qe=y[Ce-2],Ae=(ge-be)*.5,ke=Ae+be,me=0,Te=Ce+1>>1,Re=Ce&1?qe[me++]*Se(ke):0;me<Te;){var Fe=Ae*Ne[me];Re+=qe[me++]*(Se(ke+Fe)+Se(ke-Fe))}return Ae*Re},findRoot:function(Se,be,ge,Ce,Ne,qe,Ae){for(var ke=0;ke<qe;ke++){var me=Se(ge),Te=me/be(ge),Re=ge-Te;if(w(Te)<Ae){ge=Re;break}me>0?(Ne=ge,ge=Re<=Ce?(Ce+Ne)*.5:Re):(Ce=ge,ge=Re>=Ne?(Ce+Ne)*.5:Re)}return ie(ge,Ce,Ne)},solveQuadratic:function(Se,be,ge,Ce,Ne,qe){var Ae,ke=1/0;if(w(Se)<te){if(w(be)<te)return w(ge)<te?-1:0;Ae=-ge/be}else{be*=-.5;var me=ae(Se,be,ge);if(me&&w(me)<J){var Te=ve(w(Se),w(be),w(ge));Te&&(Se*=Te,be*=Te,ge*=Te,me=ae(Se,be,ge))}if(me>=-J){var Re=me<0?0:D(me),Fe=be+(be<0?-Re:Re);Fe===0?(Ae=ge/Se,ke=-Ae):(Ae=Fe/Se,ke=ge/Fe)}}var Ye=0,je=Ne==null,Ze=Ne-te,tt=qe+te;return isFinite(Ae)&&(je||Ae>Ze&&Ae<tt)&&(Ce[Ye++]=je?Ae:ie(Ae,Ne,qe)),ke!==Ae&&isFinite(ke)&&(je||ke>Ze&&ke<tt)&&(Ce[Ye++]=je?ke:ie(ke,Ne,qe)),Ye},solveCubic:function(Se,be,ge,Ce,Ne,qe,Ae){var ke=ve(w(Se),w(be),w(ge),w(Ce)),me,Te,Re,Fe,Ye;ke&&(Se*=ke,be*=ke,ge*=ke,Ce*=ke);function je(Vt){me=Vt;var ni=Se*me;Te=ni+be,Re=Te*me+ge,Fe=(ni+Te)*me+Re,Ye=Re*me+Ce}if(w(Se)<te)Se=be,Te=ge,Re=Ce,me=1/0;else if(w(Ce)<te)Te=be,Re=ge,me=0;else{je(-(be/Se)/3);var Ze=Ye/Se,tt=N(w(Ze),1/3),ut=Ze<0?-1:1,nt=-Fe/Se,pt=nt>0?1.324717957244746*Math.max(tt,D(nt)):tt,ft=me-ut*pt;if(ft!==me){do je(ft),ft=Fe===0?me:me-Ye/Fe/(1+J);while(ut*ft>ut*me);w(Se)*me*me>w(Ce/me)&&(Re=-Ce/me,Te=(Re-ge)/me)}}var wt=S.solveQuadratic(Se,Te,Re,Ne,qe,Ae),Tt=qe==null;return isFinite(me)&&(wt===0||wt>0&&me!==Ne[0]&&me!==Ne[1])&&(Tt||me>qe-te&&me<Ae+te)&&(Ne[wt++]=Tt?me:ie(me,qe,Ae)),wt}}},O={_id:1,_pools:{},get:function(u){if(u){var y=this._pools[u];return y||(y=this._pools[u]={_id:1}),y._id++}else return this._id++}},I=n.extend({_class:"Point",_readIndex:!0,initialize:function(y,w){var D=typeof y,N=this.__read,U=0;if(D==="number"){var te=typeof w=="number";this._set(y,te?w:y),N&&(U=te?2:1)}else if(D==="undefined"||y===null)this._set(0,0),N&&(U=y===null?1:0);else{var J=D==="string"?y.split(/[\s,]+/)||[]:y;U=1,Array.isArray(J)?this._set(+J[0],+(J.length>1?J[1]:J[0])):"x"in J?this._set(J.x||0,J.y||0):"width"in J?this._set(J.width||0,J.height||0):"angle"in J?(this._set(J.length||0,0),this.setAngle(J.angle||0)):(this._set(0,0),U=0)}return N&&(this.__read=U),this},set:"#initialize",_set:function(u,y){return this.x=u,this.y=y,this},equals:function(u){return this===u||u&&(this.x===u.x&&this.y===u.y||Array.isArray(u)&&this.x===u[0]&&this.y===u[1])||!1},clone:function(){return new I(this.x,this.y)},toString:function(){var u=A.instance;return"{ x: "+u.number(this.x)+", y: "+u.number(this.y)+" }"},_serialize:function(u){var y=u.formatter;return[y.number(this.x),y.number(this.y)]},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},setLength:function(u){if(this.isZero()){var y=this._angle||0;this._set(Math.cos(y)*u,Math.sin(y)*u)}else{var w=u/this.getLength();S.isZero(w)&&this.getAngle(),this._set(this.x*w,this.y*w)}},getAngle:function(){return this.getAngleInRadians.apply(this,arguments)*180/Math.PI},setAngle:function(u){this.setAngleInRadians.call(this,u*Math.PI/180)},getAngleInDegrees:"#getAngle",setAngleInDegrees:"#setAngle",getAngleInRadians:function(){if(arguments.length){var u=I.read(arguments),y=this.getLength()*u.getLength();if(S.isZero(y))return NaN;var w=this.dot(u)/y;return Math.acos(w<-1?-1:w>1?1:w)}else return this.isZero()?this._angle||0:this._angle=Math.atan2(this.y,this.x)},setAngleInRadians:function(u){if(this._angle=u,!this.isZero()){var y=this.getLength();this._set(Math.cos(u)*y,Math.sin(u)*y)}},getQuadrant:function(){return this.x>=0?this.y>=0?1:4:this.y>=0?2:3}},{beans:!1,getDirectedAngle:function(){var u=I.read(arguments);return Math.atan2(this.cross(u),this.dot(u))*180/Math.PI},getDistance:function(){var u=arguments,y=I.read(u),w=y.x-this.x,D=y.y-this.y,N=w*w+D*D,U=n.read(u);return U?N:Math.sqrt(N)},normalize:function(u){u===s&&(u=1);var y=this.getLength(),w=y!==0?u/y:0,D=new I(this.x*w,this.y*w);return w>=0&&(D._angle=this._angle),D},rotate:function(u,y){if(u===0)return this.clone();u=u*Math.PI/180;var w=y?this.subtract(y):this,D=Math.sin(u),N=Math.cos(u);return w=new I(w.x*N-w.y*D,w.x*D+w.y*N),y?w.add(y):w},transform:function(u){return u?u._transformPoint(this):this},add:function(){var u=I.read(arguments);return new I(this.x+u.x,this.y+u.y)},subtract:function(){var u=I.read(arguments);return new I(this.x-u.x,this.y-u.y)},multiply:function(){var u=I.read(arguments);return new I(this.x*u.x,this.y*u.y)},divide:function(){var u=I.read(arguments);return new I(this.x/u.x,this.y/u.y)},modulo:function(){var u=I.read(arguments);return new I(this.x%u.x,this.y%u.y)},negate:function(){return new I(-this.x,-this.y)},isInside:function(){return Y.read(arguments).contains(this)},isClose:function(){var u=arguments,y=I.read(u),w=n.read(u);return this.getDistance(y)<=w},isCollinear:function(){var u=I.read(arguments);return I.isCollinear(this.x,this.y,u.x,u.y)},isColinear:"#isCollinear",isOrthogonal:function(){var u=I.read(arguments);return I.isOrthogonal(this.x,this.y,u.x,u.y)},isZero:function(){var u=S.isZero;return u(this.x)&&u(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},isInQuadrant:function(u){return this.x*(u>1&&u<4?-1:1)>=0&&this.y*(u>2?-1:1)>=0},dot:function(){var u=I.read(arguments);return this.x*u.x+this.y*u.y},cross:function(){var u=I.read(arguments);return this.x*u.y-this.y*u.x},project:function(){var u=I.read(arguments),y=u.isZero()?0:this.dot(u)/u.dot(u);return new I(u.x*y,u.y*y)},statics:{min:function(){var u=arguments,y=I.read(u),w=I.read(u);return new I(Math.min(y.x,w.x),Math.min(y.y,w.y))},max:function(){var u=arguments,y=I.read(u),w=I.read(u);return new I(Math.max(y.x,w.x),Math.max(y.y,w.y))},random:function(){return new I(Math.random(),Math.random())},isCollinear:function(u,y,w,D){return Math.abs(u*D-y*w)<=Math.sqrt((u*u+y*y)*(w*w+D*D))*1e-8},isOrthogonal:function(u,y,w,D){return Math.abs(u*w+y*D)<=Math.sqrt((u*u+y*y)*(w*w+D*D))*1e-8}}},n.each(["round","ceil","floor","abs"],function(u){var y=Math[u];this[u]=function(){return new I(y(this.x),y(this.y))}},{})),W=I.extend({initialize:function(y,w,D,N){this._x=y,this._y=w,this._owner=D,this._setter=N},_set:function(u,y,w){return this._x=u,this._y=y,w||this._owner[this._setter](this),this},getX:function(){return this._x},setX:function(u){this._x=u,this._owner[this._setter](this)},getY:function(){return this._y},setY:function(u){this._y=u,this._owner[this._setter](this)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(u){this._owner._changeSelection(this._getSelection(),u)},_getSelection:function(){return this._setter==="setPosition"?4:0}}),L=n.extend({_class:"Size",_readIndex:!0,initialize:function(y,w){var D=typeof y,N=this.__read,U=0;if(D==="number"){var te=typeof w=="number";this._set(y,te?w:y),N&&(U=te?2:1)}else if(D==="undefined"||y===null)this._set(0,0),N&&(U=y===null?1:0);else{var J=D==="string"?y.split(/[\s,]+/)||[]:y;U=1,Array.isArray(J)?this._set(+J[0],+(J.length>1?J[1]:J[0])):"width"in J?this._set(J.width||0,J.height||0):"x"in J?this._set(J.x||0,J.y||0):(this._set(0,0),U=0)}return N&&(this.__read=U),this},set:"#initialize",_set:function(u,y){return this.width=u,this.height=y,this},equals:function(u){return u===this||u&&(this.width===u.width&&this.height===u.height||Array.isArray(u)&&this.width===u[0]&&this.height===u[1])||!1},clone:function(){return new L(this.width,this.height)},toString:function(){var u=A.instance;return"{ width: "+u.number(this.width)+", height: "+u.number(this.height)+" }"},_serialize:function(u){var y=u.formatter;return[y.number(this.width),y.number(this.height)]},add:function(){var u=L.read(arguments);return new L(this.width+u.width,this.height+u.height)},subtract:function(){var u=L.read(arguments);return new L(this.width-u.width,this.height-u.height)},multiply:function(){var u=L.read(arguments);return new L(this.width*u.width,this.height*u.height)},divide:function(){var u=L.read(arguments);return new L(this.width/u.width,this.height/u.height)},modulo:function(){var u=L.read(arguments);return new L(this.width%u.width,this.height%u.height)},negate:function(){return new L(-this.width,-this.height)},isZero:function(){var u=S.isZero;return u(this.width)&&u(this.height)},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{min:function(u,y){return new L(Math.min(u.width,y.width),Math.min(u.height,y.height))},max:function(u,y){return new L(Math.max(u.width,y.width),Math.max(u.height,y.height))},random:function(){return new L(Math.random(),Math.random())}}},n.each(["round","ceil","floor","abs"],function(u){var y=Math[u];this[u]=function(){return new L(y(this.width),y(this.height))}},{})),H=L.extend({initialize:function(y,w,D,N){this._width=y,this._height=w,this._owner=D,this._setter=N},_set:function(u,y,w){return this._width=u,this._height=y,w||this._owner[this._setter](this),this},getWidth:function(){return this._width},setWidth:function(u){this._width=u,this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(u){this._height=u,this._owner[this._setter](this)}}),Y=n.extend({_class:"Rectangle",_readIndex:!0,beans:!0,initialize:function(y,w,D,N){var U=arguments,te=typeof y,J;if(te==="number"?(this._set(y,w,D,N),J=4):te==="undefined"||y===null?(this._set(0,0,0,0),J=y===null?1:0):U.length===1&&(Array.isArray(y)?(this._set.apply(this,y),J=1):y.x!==s||y.width!==s?(this._set(y.x||0,y.y||0,y.width||0,y.height||0),J=1):y.from===s&&y.to===s&&(this._set(0,0,0,0),n.readSupported(U,this)&&(J=1))),J===s){var ie=I.readNamed(U,"from"),ae=n.peek(U),ve=ie.x,Se=ie.y,be,ge;if(ae&&ae.x!==s||n.hasNamed(U,"to")){var Ce=I.readNamed(U,"to");be=Ce.x-ve,ge=Ce.y-Se,be<0&&(ve=Ce.x,be=-be),ge<0&&(Se=Ce.y,ge=-ge)}else{var Ne=L.read(U);be=Ne.width,ge=Ne.height}this._set(ve,Se,be,ge),J=U.__index}var qe=U.__filtered;return qe&&(this.__filtered=qe),this.__read&&(this.__read=J),this},set:"#initialize",_set:function(u,y,w,D){return this.x=u,this.y=y,this.width=w,this.height=D,this},clone:function(){return new Y(this.x,this.y,this.width,this.height)},equals:function(u){var y=n.isPlainValue(u)?Y.read(arguments):u;return y===this||y&&this.x===y.x&&this.y===y.y&&this.width===y.width&&this.height===y.height||!1},toString:function(){var u=A.instance;return"{ x: "+u.number(this.x)+", y: "+u.number(this.y)+", width: "+u.number(this.width)+", height: "+u.number(this.height)+" }"},_serialize:function(u){var y=u.formatter;return[y.number(this.x),y.number(this.y),y.number(this.width),y.number(this.height)]},getPoint:function(u){var y=u?I:W;return new y(this.x,this.y,this,"setPoint")},setPoint:function(){var u=I.read(arguments);this.x=u.x,this.y=u.y},getSize:function(u){var y=u?L:H;return new y(this.width,this.height,this,"setSize")},_fw:1,_fh:1,setSize:function(){var u=L.read(arguments),y=this._sx,w=this._sy,D=u.width,N=u.height;y&&(this.x+=(this.width-D)*y),w&&(this.y+=(this.height-N)*w),this.width=D,this.height=N,this._fw=this._fh=1},getLeft:function(){return this.x},setLeft:function(u){if(!this._fw){var y=u-this.x;this.width-=this._sx===.5?y*2:y}this.x=u,this._sx=this._fw=0},getTop:function(){return this.y},setTop:function(u){if(!this._fh){var y=u-this.y;this.height-=this._sy===.5?y*2:y}this.y=u,this._sy=this._fh=0},getRight:function(){return this.x+this.width},setRight:function(u){if(!this._fw){var y=u-this.x;this.width=this._sx===.5?y*2:y}this.x=u-this.width,this._sx=1,this._fw=0},getBottom:function(){return this.y+this.height},setBottom:function(u){if(!this._fh){var y=u-this.y;this.height=this._sy===.5?y*2:y}this.y=u-this.height,this._sy=1,this._fh=0},getCenterX:function(){return this.x+this.width/2},setCenterX:function(u){this._fw||this._sx===.5?this.x=u-this.width/2:(this._sx&&(this.x+=(u-this.x)*2*this._sx),this.width=(u-this.x)*2),this._sx=.5,this._fw=0},getCenterY:function(){return this.y+this.height/2},setCenterY:function(u){this._fh||this._sy===.5?this.y=u-this.height/2:(this._sy&&(this.y+=(u-this.y)*2*this._sy),this.height=(u-this.y)*2),this._sy=.5,this._fh=0},getCenter:function(u){var y=u?I:W;return new y(this.getCenterX(),this.getCenterY(),this,"setCenter")},setCenter:function(){var u=I.read(arguments);return this.setCenterX(u.x),this.setCenterY(u.y),this},getArea:function(){return this.width*this.height},isEmpty:function(){return this.width===0||this.height===0},contains:function(u){return u&&u.width!==s||(Array.isArray(u)?u:arguments).length===4?this._containsRectangle(Y.read(arguments)):this._containsPoint(I.read(arguments))},_containsPoint:function(u){var y=u.x,w=u.y;return y>=this.x&&w>=this.y&&y<=this.x+this.width&&w<=this.y+this.height},_containsRectangle:function(u){var y=u.x,w=u.y;return y>=this.x&&w>=this.y&&y+u.width<=this.x+this.width&&w+u.height<=this.y+this.height},intersects:function(){var u=Y.read(arguments),y=n.read(arguments)||0;return u.x+u.width>this.x-y&&u.y+u.height>this.y-y&&u.x<this.x+this.width+y&&u.y<this.y+this.height+y},intersect:function(){var u=Y.read(arguments),y=Math.max(this.x,u.x),w=Math.max(this.y,u.y),D=Math.min(this.x+this.width,u.x+u.width),N=Math.min(this.y+this.height,u.y+u.height);return new Y(y,w,D-y,N-w)},unite:function(){var u=Y.read(arguments),y=Math.min(this.x,u.x),w=Math.min(this.y,u.y),D=Math.max(this.x+this.width,u.x+u.width),N=Math.max(this.y+this.height,u.y+u.height);return new Y(y,w,D-y,N-w)},include:function(){var u=I.read(arguments),y=Math.min(this.x,u.x),w=Math.min(this.y,u.y),D=Math.max(this.x+this.width,u.x),N=Math.max(this.y+this.height,u.y);return new Y(y,w,D-y,N-w)},expand:function(){var u=L.read(arguments),y=u.width,w=u.height;return new Y(this.x-y/2,this.y-w/2,this.width+y,this.height+w)},scale:function(u,y){return this.expand(this.width*u-this.width,this.height*(y===s?u:y)-this.height)}},n.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],function(u,y){var w=u.join(""),D=/^[RL]/.test(w);y>=4&&(u[1]+=D?"Y":"X");var N=u[D?0:1],U=u[D?1:0],te="get"+N,J="get"+U,ie="set"+N,ae="set"+U,ve="get"+w,Se="set"+w;this[ve]=function(be){var ge=be?I:W;return new ge(this[te](),this[J](),this,Se)},this[Se]=function(){var be=I.read(arguments);this[ie](be.x),this[ae](be.y)}},{beans:!0})),Q=Y.extend({initialize:function(y,w,D,N,U,te){this._set(y,w,D,N,!0),this._owner=U,this._setter=te},_set:function(u,y,w,D,N){return this._x=u,this._y=y,this._width=w,this._height=D,N||this._owner[this._setter](this),this}},new function(){var u=Y.prototype;return n.each(["x","y","width","height"],function(y){var w=n.capitalize(y),D="_"+y;this["get"+w]=function(){return this[D]},this["set"+w]=function(N){this[D]=N,this._dontNotify||this._owner[this._setter](this)}},n.each(["Point","Size","Center","Left","Top","Right","Bottom","CenterX","CenterY","TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],function(y){var w="set"+y;this[w]=function(){this._dontNotify=!0,u[w].apply(this,arguments),this._dontNotify=!1,this._owner[this._setter](this)}},{isSelected:function(){return!!(this._owner._selection&2)},setSelected:function(y){var w=this._owner;w._changeSelection&&w._changeSelection(2,y)}}))}),pe=n.extend({_class:"Matrix",initialize:function u(y,w){var D=arguments,N=D.length,U=!0;if(N>=6?this._set.apply(this,D):N===1||N===2?y instanceof u?this._set(y._a,y._b,y._c,y._d,y._tx,y._ty,w):Array.isArray(y)?this._set.apply(this,w?y.concat([w]):y):U=!1:N?U=!1:this.reset(),!U)throw new Error("Unsupported matrix parameters");return this},set:"#initialize",_set:function(u,y,w,D,N,U,te){return this._a=u,this._b=y,this._c=w,this._d=D,this._tx=N,this._ty=U,te||this._changed(),this},_serialize:function(u,y){return n.serialize(this.getValues(),u,!0,y)},_changed:function(){var u=this._owner;u&&(u._applyMatrix?u.transform(null,!0):u._changed(25))},clone:function(){return new pe(this._a,this._b,this._c,this._d,this._tx,this._ty)},equals:function(u){return u===this||u&&this._a===u._a&&this._b===u._b&&this._c===u._c&&this._d===u._d&&this._tx===u._tx&&this._ty===u._ty},toString:function(){var u=A.instance;return"[["+[u.number(this._a),u.number(this._c),u.number(this._tx)].join(", ")+"], ["+[u.number(this._b),u.number(this._d),u.number(this._ty)].join(", ")+"]]"},reset:function(u){return this._a=this._d=1,this._b=this._c=this._tx=this._ty=0,u||this._changed(),this},apply:function(u,y){var w=this._owner;return w?(w.transform(null,n.pick(u,!0),y),this.isIdentity()):!1},translate:function(){var u=I.read(arguments),y=u.x,w=u.y;return this._tx+=y*this._a+w*this._c,this._ty+=y*this._b+w*this._d,this._changed(),this},scale:function(){var u=arguments,y=I.read(u),w=I.read(u,0,{readNull:!0});return w&&this.translate(w),this._a*=y.x,this._b*=y.x,this._c*=y.y,this._d*=y.y,w&&this.translate(w.negate()),this._changed(),this},rotate:function(u){u*=Math.PI/180;var y=I.read(arguments,1),w=y.x,D=y.y,N=Math.cos(u),U=Math.sin(u),te=w-w*N+D*U,J=D-w*U-D*N,ie=this._a,ae=this._b,ve=this._c,Se=this._d;return this._a=N*ie+U*ve,this._b=N*ae+U*Se,this._c=-U*ie+N*ve,this._d=-U*ae+N*Se,this._tx+=te*ie+J*ve,this._ty+=te*ae+J*Se,this._changed(),this},shear:function(){var u=arguments,y=I.read(u),w=I.read(u,0,{readNull:!0});w&&this.translate(w);var D=this._a,N=this._b;return this._a+=y.y*this._c,this._b+=y.y*this._d,this._c+=y.x*D,this._d+=y.x*N,w&&this.translate(w.negate()),this._changed(),this},skew:function(){var u=arguments,y=I.read(u),w=I.read(u,0,{readNull:!0}),D=Math.PI/180,N=new I(Math.tan(y.x*D),Math.tan(y.y*D));return this.shear(N,w)},append:function(u,y){if(u){var w=this._a,D=this._b,N=this._c,U=this._d,te=u._a,J=u._c,ie=u._b,ae=u._d,ve=u._tx,Se=u._ty;this._a=te*w+ie*N,this._c=J*w+ae*N,this._b=te*D+ie*U,this._d=J*D+ae*U,this._tx+=ve*w+Se*N,this._ty+=ve*D+Se*U,y||this._changed()}return this},prepend:function(u,y){if(u){var w=this._a,D=this._b,N=this._c,U=this._d,te=this._tx,J=this._ty,ie=u._a,ae=u._c,ve=u._b,Se=u._d,be=u._tx,ge=u._ty;this._a=ie*w+ae*D,this._c=ie*N+ae*U,this._b=ve*w+Se*D,this._d=ve*N+Se*U,this._tx=ie*te+ae*J+be,this._ty=ve*te+Se*J+ge,y||this._changed()}return this},appended:function(u){return this.clone().append(u)},prepended:function(u){return this.clone().prepend(u)},invert:function(){var u=this._a,y=this._b,w=this._c,D=this._d,N=this._tx,U=this._ty,te=u*D-y*w,J=null;return te&&!isNaN(te)&&isFinite(N)&&isFinite(U)&&(this._a=D/te,this._b=-y/te,this._c=-w/te,this._d=u/te,this._tx=(w*U-D*N)/te,this._ty=(y*N-u*U)/te,J=this),J},inverted:function(){return this.clone().invert()},concatenate:"#append",preConcatenate:"#prepend",chain:"#appended",_shiftless:function(){return new pe(this._a,this._b,this._c,this._d,0,0)},_orNullIfIdentity:function(){return this.isIdentity()?null:this},isIdentity:function(){return this._a===1&&this._b===0&&this._c===0&&this._d===1&&this._tx===0&&this._ty===0},isInvertible:function(){var u=this._a*this._d-this._c*this._b;return u&&!isNaN(u)&&isFinite(this._tx)&&isFinite(this._ty)},isSingular:function(){return!this.isInvertible()},transform:function(u,y,w){return arguments.length<3?this._transformPoint(I.read(arguments)):this._transformCoordinates(u,y,w)},_transformPoint:function(u,y,w){var D=u.x,N=u.y;return y||(y=new I),y._set(D*this._a+N*this._c+this._tx,D*this._b+N*this._d+this._ty,w)},_transformCoordinates:function(u,y,w){for(var D=0,N=2*w;D<N;D+=2){var U=u[D],te=u[D+1];y[D]=U*this._a+te*this._c+this._tx,y[D+1]=U*this._b+te*this._d+this._ty}return y},_transformCorners:function(u){var y=u.x,w=u.y,D=y+u.width,N=w+u.height,U=[y,w,D,w,D,N,y,N];return this._transformCoordinates(U,U,4)},_transformBounds:function(u,y,w){for(var D=this._transformCorners(u),N=D.slice(0,2),U=N.slice(),te=2;te<8;te++){var J=D[te],ie=te&1;J<N[ie]?N[ie]=J:J>U[ie]&&(U[ie]=J)}return y||(y=new Y),y._set(N[0],N[1],U[0]-N[0],U[1]-N[1],w)},inverseTransform:function(){return this._inverseTransform(I.read(arguments))},_inverseTransform:function(u,y,w){var D=this._a,N=this._b,U=this._c,te=this._d,J=this._tx,ie=this._ty,ae=D*te-N*U,ve=null;if(ae&&!isNaN(ae)&&isFinite(J)&&isFinite(ie)){var Se=u.x-this._tx,be=u.y-this._ty;y||(y=new I),ve=y._set((Se*te-be*U)/ae,(be*D-Se*N)/ae,w)}return ve},decompose:function(){var u=this._a,y=this._b,w=this._c,D=this._d,N=u*D-y*w,U=Math.sqrt,te=Math.atan2,J=180/Math.PI,ie,ae,ve;if(u!==0||y!==0){var Se=U(u*u+y*y);ie=Math.acos(u/Se)*(y>0?1:-1),ae=[Se,N/Se],ve=[te(u*w+y*D,Se*Se),0]}else if(w!==0||D!==0){var be=U(w*w+D*D);ie=Math.asin(w/be)*(D>0?1:-1),ae=[N/be,be],ve=[0,te(u*w+y*D,be*be)]}else ie=0,ve=ae=[0,0];return{translation:this.getTranslation(),rotation:ie*J,scaling:new I(ae),skewing:new I(ve[0]*J,ve[1]*J)}},getValues:function(){return[this._a,this._b,this._c,this._d,this._tx,this._ty]},getTranslation:function(){return new I(this._tx,this._ty)},getScaling:function(){return this.decompose().scaling},getRotation:function(){return this.decompose().rotation},applyToContext:function(u){this.isIdentity()||u.transform(this._a,this._b,this._c,this._d,this._tx,this._ty)}},n.each(["a","b","c","d","tx","ty"],function(u){var y=n.capitalize(u),w="_"+u;this["get"+y]=function(){return this[w]},this["set"+y]=function(D){this[w]=D,this._changed()}},{})),de=n.extend({_class:"Line",initialize:function(y,w,D,N,U){var te=!1;arguments.length>=4?(this._px=y,this._py=w,this._vx=D,this._vy=N,te=U):(this._px=y.x,this._py=y.y,this._vx=w.x,this._vy=w.y,te=D),te||(this._vx-=this._px,this._vy-=this._py)},getPoint:function(){return new I(this._px,this._py)},getVector:function(){return new I(this._vx,this._vy)},getLength:function(){return this.getVector().getLength()},intersect:function(u,y){return de.intersect(this._px,this._py,this._vx,this._vy,u._px,u._py,u._vx,u._vy,!0,y)},getSide:function(u,y){return de.getSide(this._px,this._py,this._vx,this._vy,u.x,u.y,!0,y)},getDistance:function(u){return Math.abs(this.getSignedDistance(u))},getSignedDistance:function(u){return de.getSignedDistance(this._px,this._py,this._vx,this._vy,u.x,u.y,!0)},isCollinear:function(u){return I.isCollinear(this._vx,this._vy,u._vx,u._vy)},isOrthogonal:function(u){return I.isOrthogonal(this._vx,this._vy,u._vx,u._vy)},statics:{intersect:function(u,y,w,D,N,U,te,J,ie,ae){ie||(w-=u,D-=y,te-=N,J-=U);var ve=w*J-D*te;if(!S.isMachineZero(ve)){var Se=u-N,be=y-U,ge=(te*be-J*Se)/ve,Ce=(w*be-D*Se)/ve,Ne=1e-12,qe=-Ne,Ae=1+Ne;if(ae||qe<ge&&ge<Ae&&qe<Ce&&Ce<Ae)return ae||(ge=ge<=0?0:ge>=1?1:ge),new I(u+ge*w,y+ge*D)}},getSide:function(u,y,w,D,N,U,te,J){te||(w-=u,D-=y);var ie=N-u,ae=U-y,ve=ie*D-ae*w;return!J&&S.isMachineZero(ve)&&(ve=(ie*w+ie*w)/(w*w+D*D),ve>=0&&ve<=1&&(ve=0)),ve<0?-1:ve>0?1:0},getSignedDistance:function(u,y,w,D,N,U,te){return te||(w-=u,D-=y),w===0?D>0?N-u:u-N:D===0?w<0?U-y:y-U:((N-u)*D-(U-y)*w)/(D>w?D*Math.sqrt(1+w*w/(D*D)):w*Math.sqrt(1+D*D/(w*w)))},getDistance:function(u,y,w,D,N,U,te){return Math.abs(de.getSignedDistance(u,y,w,D,N,U,te))}}}),fe=g.extend({_class:"Project",_list:"projects",_reference:"project",_compactSerialize:!0,initialize:function(y){g.call(this,!0),this._children=[],this._namedChildren={},this._activeLayer=null,this._currentStyle=new Wi(null,null,this),this._view=Kt.create(this,y||et.getCanvas(1,1)),this._selectionItems={},this._selectionCount=0,this._updateVersion=0},_serialize:function(u,y){return n.serialize(this._children,u,!0,y)},_changed:function(u,y){if(u&1){var w=this._view;w&&(w._needsUpdate=!0,!w._requested&&w._autoUpdate&&w.requestUpdate())}var D=this._changes;if(D&&y){var N=this._changesById,U=y._id,te=N[U];te?te.flags|=u:D.push(N[U]={item:y,flags:u})}},clear:function(){for(var u=this._children,y=u.length-1;y>=0;y--)u[y].remove()},isEmpty:function(){return!this._children.length},remove:function u(){return u.base.call(this)?(this._view&&this._view.remove(),!0):!1},getView:function(){return this._view},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(u){this._currentStyle.set(u)},getIndex:function(){return this._index},getOptions:function(){return this._scope.settings},getLayers:function(){return this._children},getActiveLayer:function(){return this._activeLayer||new Le({project:this,insert:!0})},getSymbolDefinitions:function(){var u=[],y={};return this.getItems({class:Ke,match:function(w){var D=w._definition,N=D._id;return y[N]||(y[N]=!0,u.push(D)),!1}}),u},getSymbols:"getSymbolDefinitions",getSelectedItems:function(){var u=this._selectionItems,y=[];for(var w in u){var D=u[w],N=D._selection;N&1&&D.isInserted()?y.push(D):N||this._updateSelection(D)}return y},_updateSelection:function(u){var y=u._id,w=this._selectionItems;u._selection?w[y]!==u&&(this._selectionCount++,w[y]=u):w[y]===u&&(this._selectionCount--,delete w[y])},selectAll:function(){for(var u=this._children,y=0,w=u.length;y<w;y++)u[y].setFullySelected(!0)},deselectAll:function(){var u=this._selectionItems;for(var y in u)u[y].setFullySelected(!1)},addLayer:function(u){return this.insertLayer(s,u)},insertLayer:function(u,y){if(y instanceof Le){y._remove(!1,!0),n.splice(this._children,[y],u,0),y._setProject(this,!0);var w=y._name;w&&y.setName(w),this._changes&&y._changed(5),this._activeLayer||(this._activeLayer=y)}else y=null;return y},_insertItem:function(u,y,w){return y=this.insertLayer(u,y)||(this._activeLayer||this._insertItem(s,new Le(ye.NO_INSERT),!0)).insertChild(u,y),w&&y.activate&&y.activate(),y},getItems:function(u){return ye._getItems(this,u)},getItem:function(u){return ye._getItems(this,u,null,null,!0)[0]||null},importJSON:function(u){this.activate();var y=this._activeLayer;return n.importJSON(u,y&&y.isEmpty()&&y)},removeOn:function(u){var y=this._removeSets;if(y){u==="mouseup"&&(y.mousedrag=null);var w=y[u];if(w){for(var D in w){var N=w[D];for(var U in y){var te=y[U];te&&te!=w&&delete te[N._id]}N.remove()}y[u]=null}}},draw:function(u,y,w){this._updateVersion++,u.save(),y.applyToContext(u);for(var D=this._children,N=new n({offset:new I(0,0),pixelRatio:w,viewMatrix:y.isIdentity()?null:y,matrices:[new pe],updateMatrix:!0}),U=0,te=D.length;U<te;U++)D[U].draw(u,N);if(u.restore(),this._selectionCount>0){u.save(),u.strokeWidth=1;var J=this._selectionItems,ie=this._scope.settings.handleSize,ae=this._updateVersion;for(var ve in J)J[ve]._drawSelection(u,y,ie,J,ae);u.restore()}}}),ye=n.extend(l,{statics:{extend:function u(y){return y._serializeFields&&(y._serializeFields=n.set({},this.prototype._serializeFields,y._serializeFields)),u.base.apply(this,arguments)},INSERT:{insert:!0},NO_INSERT:{insert:!1}},_class:"Item",_name:null,_applyMatrix:!0,_canApplyMatrix:!0,_canScaleStroke:!1,_pivot:null,_visible:!0,_blendMode:"normal",_opacity:1,_locked:!1,_guide:!1,_clipMask:!1,_selection:0,_selectBounds:!0,_selectChildren:!1,_serializeFields:{name:null,applyMatrix:null,matrix:new pe,pivot:null,visible:!0,blendMode:"normal",opacity:1,locked:!1,guide:!1,clipMask:!1,selected:!1,data:{}},_prioritize:["applyMatrix"]},new function(){var u=["onMouseDown","onMouseUp","onMouseDrag","onClick","onDoubleClick","onMouseMove","onMouseEnter","onMouseLeave"];return n.each(u,function(y){this._events[y]={install:function(w){this.getView()._countItemEvent(w,1)},uninstall:function(w){this.getView()._countItemEvent(w,-1)}}},{_events:{onFrame:{install:function(){this.getView()._animateItem(this,!0)},uninstall:function(){this.getView()._animateItem(this,!1)}},onLoad:{},onError:{}},statics:{_itemHandlers:u}})},{initialize:function(){},_initialize:function(u,y){var w=u&&n.isPlainObject(u),D=w&&u.internal===!0,N=this._matrix=new pe,U=w&&u.project||yt.project,te=yt.settings;return this._id=D?null:O.get(),this._parent=this._index=null,this._applyMatrix=this._canApplyMatrix&&te.applyMatrix,y&&N.translate(y),N._owner=this,this._style=new Wi(U._currentStyle,this,U),D||w&&u.insert==!1||!te.insertItems&&!(w&&u.insert==!0)?this._setProject(U):(w&&u.parent||U)._insertItem(s,this,!0),w&&u!==ye.NO_INSERT&&u!==ye.INSERT&&this.set(u,{internal:!0,insert:!0,project:!0,parent:!0}),w},_serialize:function(u,y){var w={},D=this;function N(U){for(var te in U){var J=D[te];n.equals(J,te==="leading"?U.fontSize*1.2:U[te])||(w[te]=n.serialize(J,u,te!=="data",y))}}return N(this._serializeFields),this instanceof Ee||N(this._style._defaults),[this._class,w]},_changed:function(u){var y=this._symbol,w=this._parent||y,D=this._project;u&8&&(this._bounds=this._position=this._decomposed=s),u&16&&(this._globalMatrix=s),w&&u&72&&ye._clearBoundsCache(w),u&2&&ye._clearBoundsCache(this),D&&D._changed(u,this),y&&y._changed(u)},getId:function(){return this._id},getName:function(){return this._name},setName:function(u){if(this._name&&this._removeNamed(),u===+u+"")throw new Error("Names consisting only of numbers are not supported.");var y=this._getOwner();if(u&&y){var w=y._children,D=y._namedChildren;(D[u]=D[u]||[]).push(this),u in w||(w[u]=this)}this._name=u||s,this._changed(256)},getStyle:function(){return this._style},setStyle:function(u){this.getStyle().set(u)}},n.each(["locked","visible","blendMode","opacity","guide"],function(u){var y=n.capitalize(u),w="_"+u,D={locked:256,visible:265};this["get"+y]=function(){return this[w]},this["set"+y]=function(N){N!=this[w]&&(this[w]=N,this._changed(D[u]||257))}},{}),{beans:!0,getSelection:function(){return this._selection},setSelection:function(u){if(u!==this._selection){this._selection=u;var y=this._project;y&&(y._updateSelection(this),this._changed(257))}},_changeSelection:function(u,y){var w=this._selection;this.setSelection(y?w|u:w&~u)},isSelected:function(){if(this._selectChildren){for(var u=this._children,y=0,w=u.length;y<w;y++)if(u[y].isSelected())return!0}return!!(this._selection&1)},setSelected:function(u){if(this._selectChildren)for(var y=this._children,w=0,D=y.length;w<D;w++)y[w].setSelected(u);this._changeSelection(1,u)},isFullySelected:function(){var u=this._children,y=!!(this._selection&1);if(u&&y){for(var w=0,D=u.length;w<D;w++)if(!u[w].isFullySelected())return!1;return!0}return y},setFullySelected:function(u){var y=this._children;if(y)for(var w=0,D=y.length;w<D;w++)y[w].setFullySelected(u);this._changeSelection(1,u)},isClipMask:function(){return this._clipMask},setClipMask:function(u){this._clipMask!=(u=!!u)&&(this._clipMask=u,u&&(this.setFillColor(null),this.setStrokeColor(null)),this._changed(257),this._parent&&this._parent._changed(2048))},getData:function(){return this._data||(this._data={}),this._data},setData:function(u){this._data=u},getPosition:function(u){var y=u?I:W,w=this._position||(this._position=this._getPositionFromBounds());return new y(w.x,w.y,this,"setPosition")},setPosition:function(){this.translate(I.read(arguments).subtract(this.getPosition(!0)))},_getPositionFromBounds:function(u){return this._pivot?this._matrix._transformPoint(this._pivot):(u||this.getBounds()).getCenter(!0)},getPivot:function(){var u=this._pivot;return u?new W(u.x,u.y,this,"setPivot"):null},setPivot:function(){this._pivot=I.read(arguments,0,{clone:!0,readNull:!0}),this._position=s}},n.each({getStrokeBounds:{stroke:!0},getHandleBounds:{handle:!0},getInternalBounds:{internal:!0}},function(u,y){this[y]=function(w){return this.getBounds(w,u)}},{beans:!0,getBounds:function(u,y){var w=y||u instanceof pe,D=n.set({},w?y:u,this._boundsOptions);(!D.stroke||this.getStrokeScaling())&&(D.cacheItem=this);var N=this._getCachedBounds(w&&u,D).rect;return arguments.length?N:new Q(N.x,N.y,N.width,N.height,this,"setBounds")},setBounds:function(){var u=Y.read(arguments),y=this.getBounds(),w=this._matrix,D=new pe,N=u.getCenter();D.translate(N),(u.width!=y.width||u.height!=y.height)&&(w.isInvertible()||(w.set(w._backup||new pe().translate(w.getTranslation())),y=this.getBounds()),D.scale(y.width!==0?u.width/y.width:0,y.height!==0?u.height/y.height:0)),N=y.getCenter(),D.translate(-N.x,-N.y),this.transform(D)},_getBounds:function(u,y){var w=this._children;return!w||!w.length?new Y:(ye._updateBoundsCache(this,y.cacheItem),ye._getBounds(w,u,y))},_getBoundsCacheKey:function(u,y){return[u.stroke?1:0,u.handle?1:0,y?1:0].join("")},_getCachedBounds:function(u,y,w){u=u&&u._orNullIfIdentity();var D=y.internal&&!w,N=y.cacheItem,U=D?null:this._matrix._orNullIfIdentity(),te=N&&(!u||u.equals(U))&&this._getBoundsCacheKey(y,D),J=this._bounds;if(ye._updateBoundsCache(this._parent||this._symbol,N),te&&J&&te in J){var ie=J[te];return{rect:ie.rect.clone(),nonscaling:ie.nonscaling}}var ae=this._getBounds(u||U,y),ve=ae.rect||ae,Se=this._style,be=ae.nonscaling||Se.hasStroke()&&!Se.getStrokeScaling();if(te){J||(this._bounds=J={});var ie=J[te]={rect:ve.clone(),nonscaling:be,internal:D}}return{rect:ve,nonscaling:be}},_getStrokeMatrix:function(u,y){var w=this.getStrokeScaling()?null:y&&y.internal?this:this._parent||this._symbol&&this._symbol._item,D=w?w.getViewMatrix().invert():u;return D&&D._shiftless()},statics:{_updateBoundsCache:function(u,y){if(u&&y){var w=y._id,D=u._boundsCache=u._boundsCache||{ids:{},list:[]};D.ids[w]||(D.list.push(y),D.ids[w]=y)}},_clearBoundsCache:function(u){var y=u._boundsCache;if(y){u._bounds=u._position=u._boundsCache=s;for(var w=0,D=y.list,N=D.length;w<N;w++){var U=D[w];U!==u&&(U._bounds=U._position=s,U._boundsCache&&ye._clearBoundsCache(U))}}},_getBounds:function(u,y,w){var D=1/0,N=-D,U=D,te=N,J=!1;w=w||{};for(var ie=0,ae=u.length;ie<ae;ie++){var ve=u[ie];if(ve._visible&&!ve.isEmpty(!0)){var Se=ve._getCachedBounds(y&&y.appended(ve._matrix),w,!0),be=Se.rect;D=Math.min(be.x,D),U=Math.min(be.y,U),N=Math.max(be.x+be.width,N),te=Math.max(be.y+be.height,te),Se.nonscaling&&(J=!0)}}return{rect:isFinite(D)?new Y(D,U,N-D,te-U):new Y,nonscaling:J}}}}),{beans:!0,_decompose:function(){return this._applyMatrix?null:this._decomposed||(this._decomposed=this._matrix.decompose())},getRotation:function(){var u=this._decompose();return u?u.rotation:0},setRotation:function(u){var y=this.getRotation();if(y!=null&&u!=null){var w=this._decomposed;this.rotate(u-y),w&&(w.rotation=u,this._decomposed=w)}},getScaling:function(){var u=this._decompose(),y=u&&u.scaling;return new W(y?y.x:1,y?y.y:1,this,"setScaling")},setScaling:function(){var u=this.getScaling(),y=I.read(arguments,0,{clone:!0,readNull:!0});if(u&&y&&!u.equals(y)){var w=this.getRotation(),D=this._decomposed,N=new pe,U=S.isZero;if(U(u.x)||U(u.y))N.translate(D.translation),w&&N.rotate(w),N.scale(y.x,y.y),this._matrix.set(N);else{var te=this.getPosition(!0);N.translate(te),w&&N.rotate(w),N.scale(y.x/u.x,y.y/u.y),w&&N.rotate(-w),N.translate(te.negate()),this.transform(N)}D&&(D.scaling=y,this._decomposed=D)}},getMatrix:function(){return this._matrix},setMatrix:function(){var u=this._matrix;u.set.apply(u,arguments)},getGlobalMatrix:function(u){var y=this._globalMatrix;if(y)for(var w=this._parent,D=[];w;){if(!w._globalMatrix){y=null;for(var N=0,U=D.length;N<U;N++)D[N]._globalMatrix=null;break}D.push(w),w=w._parent}if(!y){y=this._globalMatrix=this._matrix.clone();var w=this._parent;w&&y.prepend(w.getGlobalMatrix(!0))}return u?y:y.clone()},getViewMatrix:function(){return this.getGlobalMatrix().prepend(this.getView()._matrix)},getApplyMatrix:function(){return this._applyMatrix},setApplyMatrix:function(u){(this._applyMatrix=this._canApplyMatrix&&!!u)&&this.transform(null,!0)},getTransformContent:"#getApplyMatrix",setTransformContent:"#setApplyMatrix"},{getProject:function(){return this._project},_setProject:function(u,y){if(this._project!==u){this._project&&this._installEvents(!1),this._project=u;for(var w=this._children,D=0,N=w&&w.length;D<N;D++)w[D]._setProject(u);y=!0}y&&this._installEvents(!0)},getView:function(){return this._project._view},_installEvents:function u(y){u.base.call(this,y);for(var w=this._children,D=0,N=w&&w.length;D<N;D++)w[D]._installEvents(y)},getLayer:function(){for(var u=this;u=u._parent;)if(u instanceof Le)return u;return null},getParent:function(){return this._parent},setParent:function(u){return u.addChild(this)},_getOwner:"#getParent",getChildren:function(){return this._children},setChildren:function(u){this.removeChildren(),this.addChildren(u)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){var u=this._getOwner();return u&&u._children[this._index+1]||null},getPreviousSibling:function(){var u=this._getOwner();return u&&u._children[this._index-1]||null},getIndex:function(){return this._index},equals:function(u){return u===this||u&&this._class===u._class&&this._style.equals(u._style)&&this._matrix.equals(u._matrix)&&this._locked===u._locked&&this._visible===u._visible&&this._blendMode===u._blendMode&&this._opacity===u._opacity&&this._clipMask===u._clipMask&&this._guide===u._guide&&this._equals(u)||!1},_equals:function(u){return n.equals(this._children,u._children)},clone:function(u){var y=new this.constructor(ye.NO_INSERT),w=this._children,D=n.pick(u?u.insert:s,u===s||u===!0),N=n.pick(u?u.deep:s,!0);w&&y.copyAttributes(this),(!w||N)&&y.copyContent(this),w||y.copyAttributes(this),D&&y.insertAbove(this);var U=this._name,te=this._parent;if(U&&te){for(var w=te._children,J=U,ie=1;w[U];)U=J+" "+ie++;U!==J&&y.setName(U)}return y},copyContent:function(u){for(var y=u._children,w=0,D=y&&y.length;w<D;w++)this.addChild(y[w].clone(!1),!0)},copyAttributes:function(u,y){this.setStyle(u._style);for(var w=["_locked","_visible","_blendMode","_opacity","_clipMask","_guide"],D=0,N=w.length;D<N;D++){var U=w[D];u.hasOwnProperty(U)&&(this[U]=u[U])}y||this._matrix.set(u._matrix,!0),this.setApplyMatrix(u._applyMatrix),this.setPivot(u._pivot),this.setSelection(u._selection);var te=u._data,J=u._name;this._data=te?n.clone(te):null,J&&this.setName(J)},rasterize:function(u,y){var w,D,N;n.isPlainObject(u)?(w=u.resolution,D=u.insert,N=u.raster):(w=u,D=y),N||(N=new ne(ye.NO_INSERT));var U=this.getStrokeBounds(),te=(w||this.getView().getResolution())/72,J=U.getTopLeft().floor(),ie=U.getBottomRight().ceil(),ae=new L(ie.subtract(J)),ve=ae.multiply(te);if(N.setSize(ve,!0),!ve.isZero()){var Se=N.getContext(!0),be=new pe().scale(te).translate(J.negate());Se.save(),be.applyToContext(Se),this.draw(Se,new n({matrices:[be]})),Se.restore()}return N._matrix.set(new pe().translate(J.add(ae.divide(2))).scale(1/te)),(D===s||D)&&N.insertAbove(this),N},contains:function(){var u=this._matrix;return u.isInvertible()&&!!this._contains(u._inverseTransform(I.read(arguments)))},_contains:function(u){var y=this._children;if(y){for(var w=y.length-1;w>=0;w--)if(y[w].contains(u))return!0;return!1}return u.isInside(this.getInternalBounds())},isInside:function(){return Y.read(arguments).contains(this.getBounds())},_asPathItem:function(){return new mt.Rectangle({rectangle:this.getInternalBounds(),matrix:this._matrix,insert:!1})},intersects:function(u,y){return u instanceof ye?this._asPathItem().getIntersections(u._asPathItem(),null,y,!0).length>0:!1}},new function(){function u(){var D=arguments;return this._hitTest(I.read(D),xe.getOptions(D))}function y(){var D=arguments,N=I.read(D),U=xe.getOptions(D),te=[];return this._hitTest(N,new n({all:te},U)),te}function w(D,N,U,te){var J=this._children;if(J)for(var ie=J.length-1;ie>=0;ie--){var ae=J[ie],ve=ae!==te&&ae._hitTest(D,N,U);if(ve&&!N.all)return ve}return null}return fe.inject({hitTest:u,hitTestAll:y,_hitTest:w}),{hitTest:u,hitTestAll:y,_hitTestChildren:w}},{_hitTest:function(u,y,w){if(this._locked||!this._visible||this._guide&&!y.guides||this.isEmpty())return null;var D=this._matrix,N=w?w.appended(D):this.getGlobalMatrix().prepend(this.getView()._matrix),U=Math.max(y.tolerance,1e-12),te=y._tolerancePadding=new L(mt._getStrokePadding(U,D._shiftless().invert()));if(u=D._inverseTransform(u),!u||!this._children&&!this.getBounds({internal:!0,stroke:!0,handle:!0}).expand(te.multiply(2))._containsPoint(u))return null;var J=!(y.guides&&!this._guide||y.selected&&!this.isSelected()||y.type&&y.type!==n.hyphenate(this._class)||y.class&&!(this instanceof y.class)),ie=y.match,ae=this,ve,Se;function be(me){return me&&ie&&!ie(me)&&(me=null),me&&y.all&&y.all.push(me),me}function ge(me,Te){var Re=Te?ve["get"+Te]():ae.getPosition();if(u.subtract(Re).divide(te).length<=1)return new xe(me,ae,{name:Te?n.hyphenate(Te):me,point:Re})}var Ce=y.position,Ne=y.center,qe=y.bounds;if(J&&this._parent&&(Ce||Ne||qe)){if((Ne||qe)&&(ve=this.getInternalBounds()),Se=Ce&&ge("position")||Ne&&ge("center","Center"),!Se&&qe)for(var Ae=["TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],ke=0;ke<8&&!Se;ke++)Se=ge("bounds",Ae[ke]);Se=be(Se)}return Se||(Se=this._hitTestChildren(u,y,N)||J&&be(this._hitTestSelf(u,y,N,this.getStrokeScaling()?null:N._shiftless().invert()))||null),Se&&Se.point&&(Se.point=D.transform(Se.point)),Se},_hitTestSelf:function(u,y){if(y.fill&&this.hasFill()&&this._contains(u))return new xe("fill",this)},matches:function(u,y){function w(te,J){for(var ie in te)if(te.hasOwnProperty(ie)){var ae=te[ie],ve=J[ie];if(n.isPlainObject(ae)&&n.isPlainObject(ve)){if(!w(ae,ve))return!1}else if(!n.equals(ae,ve))return!1}return!0}var D=typeof u;if(D==="object"){for(var N in u)if(u.hasOwnProperty(N)&&!this.matches(N,u[N]))return!1;return!0}else{if(D==="function")return u(this);if(u==="match")return y(this);var U=/^(empty|editable)$/.test(u)?this["is"+n.capitalize(u)]():u==="type"?n.hyphenate(this._class):this[u];if(u==="class"){if(typeof y=="function")return this instanceof y;U=this._class}if(typeof y=="function")return!!y(U);if(y){if(y.test)return y.test(U);if(n.isPlainObject(y))return w(y,U)}return n.equals(U,y)}},getItems:function(u){return ye._getItems(this,u,this._matrix)},getItem:function(u){return ye._getItems(this,u,this._matrix,null,!0)[0]||null},statics:{_getItems:function u(y,w,D,N,U){if(!N){var te=typeof w=="object"&&w,J=te&&te.overlapping,ie=te&&te.inside,ae=J||ie,be=ae&&Y.read([ae]);N={items:[],recursive:te&&te.recursive!==!1,inside:!!ie,overlapping:!!J,rect:be,path:J&&new mt.Rectangle({rectangle:be,insert:!1})},te&&(w=n.filter({},w,{recursive:!0,inside:!0,overlapping:!0}))}var ve=y._children,Se=N.items,be=N.rect;D=be&&(D||new pe);for(var ge=0,Ce=ve&&ve.length;ge<Ce;ge++){var Ne=ve[ge],qe=D&&D.appended(Ne._matrix),Ae=!0;if(be){var ae=Ne.getBounds(qe);if(!be.intersects(ae))continue;be.contains(ae)||N.overlapping&&(ae.contains(be)||N.path.intersects(Ne,qe))||(Ae=!1)}if(Ae&&Ne.matches(w)&&(Se.push(Ne),U)||(N.recursive!==!1&&u(Ne,w,qe,N,U),U&&Se.length>0))break}return Se}}},{importJSON:function(u){var y=n.importJSON(u,this);return y!==this?this.addChild(y):y},addChild:function(u){return this.insertChild(s,u)},insertChild:function(u,y){var w=y?this.insertChildren(u,[y]):null;return w&&w[0]},addChildren:function(u){return this.insertChildren(this._children.length,u)},insertChildren:function(u,y){var w=this._children;if(w&&y&&y.length>0){y=n.slice(y);for(var D={},N=y.length-1;N>=0;N--){var U=y[N],te=U&&U._id;!U||D[te]?y.splice(N,1):(U._remove(!1,!0),D[te]=!0)}n.splice(w,y,u,0);for(var J=this._project,ie=J._changes,N=0,ae=y.length;N<ae;N++){var U=y[N],ve=U._name;U._parent=this,U._setProject(J,!0),ve&&U.setName(ve),ie&&U._changed(5)}this._changed(11)}else y=null;return y},_insertItem:"#insertChild",_insertAt:function(u,y){var w=u&&u._getOwner(),D=u!==this&&w?this:null;return D&&(D._remove(!1,!0),w._insertItem(u._index+y,D)),D},insertAbove:function(u){return this._insertAt(u,1)},insertBelow:function(u){return this._insertAt(u,0)},sendToBack:function(){var u=this._getOwner();return u?u._insertItem(0,this):null},bringToFront:function(){var u=this._getOwner();return u?u._insertItem(s,this):null},appendTop:"#addChild",appendBottom:function(u){return this.insertChild(0,u)},moveAbove:"#insertAbove",moveBelow:"#insertBelow",addTo:function(u){return u._insertItem(s,this)},copyTo:function(u){return this.clone(!1).addTo(u)},reduce:function(u){var y=this._children;if(y&&y.length===1){var w=y[0].reduce(u);return this._parent?(w.insertAbove(this),this.remove()):w.remove(),w}return this},_removeNamed:function(){var u=this._getOwner();if(u){var y=u._children,w=u._namedChildren,D=this._name,N=w[D],U=N?N.indexOf(this):-1;U!==-1&&(y[D]==this&&delete y[D],N.splice(U,1),N.length?y[D]=N[0]:delete w[D])}},_remove:function(u,y){var w=this._getOwner(),D=this._project,N=this._index;return this._style&&this._style._dispose(),w?(this._name&&this._removeNamed(),N!=null&&(D._activeLayer===this&&(D._activeLayer=this.getNextSibling()||this.getPreviousSibling()),n.splice(w._children,null,N,1)),this._installEvents(!1),u&&D._changes&&this._changed(5),y&&w._changed(11,this),this._parent=null,!0):!1},remove:function(){return this._remove(!0,!0)},replaceWith:function(u){var y=u&&u.insertBelow(this);return y&&this.remove(),y},removeChildren:function(u,y){if(!this._children)return null;u=u||0,y=n.pick(y,this._children.length);for(var w=n.splice(this._children,null,u,y-u),D=w.length-1;D>=0;D--)w[D]._remove(!0,!1);return w.length>0&&this._changed(11),w},clear:"#removeChildren",reverseChildren:function(){if(this._children){this._children.reverse();for(var u=0,y=this._children.length;u<y;u++)this._children[u]._index=u;this._changed(11)}},isEmpty:function(u){var y=this._children,w=y?y.length:0;if(u){for(var D=0;D<w;D++)if(!y[D].isEmpty(u))return!1;return!0}return!w},isEditable:function(){for(var u=this;u;){if(!u._visible||u._locked)return!1;u=u._parent}return!0},hasFill:function(){return this.getStyle().hasFill()},hasStroke:function(){return this.getStyle().hasStroke()},hasShadow:function(){return this.getStyle().hasShadow()},_getOrder:function(u){function y(te){var J=[];do J.unshift(te);while(te=te._parent);return J}for(var w=y(this),D=y(u),N=0,U=Math.min(w.length,D.length);N<U;N++)if(w[N]!=D[N])return w[N]._index<D[N]._index?1:-1;return 0},hasChildren:function(){return this._children&&this._children.length>0},isInserted:function(){return this._parent?this._parent.isInserted():!1},isAbove:function(u){return this._getOrder(u)===-1},isBelow:function(u){return this._getOrder(u)===1},isParent:function(u){return this._parent===u},isChild:function(u){return u&&u._parent===this},isDescendant:function(u){for(var y=this;y=y._parent;)if(y===u)return!0;return!1},isAncestor:function(u){return u?u.isDescendant(this):!1},isSibling:function(u){return this._parent===u._parent},isGroupedWith:function(u){for(var y=this._parent;y;){if(y._parent&&/^(Group|Layer|CompoundPath)$/.test(y._class)&&u.isDescendant(y))return!0;y=y._parent}return!1}},n.each(["rotate","scale","shear","skew"],function(u){var y=u==="rotate";this[u]=function(){var w=arguments,D=(y?n:I).read(w),N=I.read(w,0,{readNull:!0});return this.transform(new pe()[u](D,N||this.getPosition(!0)))}},{translate:function(){var u=new pe;return this.transform(u.translate.apply(u,arguments))},transform:function(u,y,w){var D=this._matrix,N=u&&!u.isIdentity(),U=w&&this._canApplyMatrix||this._applyMatrix&&(N||!D.isIdentity()||y&&this._children);if(!N&&!U)return this;if(N){!u.isInvertible()&&D.isInvertible()&&(D._backup=D.getValues()),D.prepend(u,!0);var te=this._style,J=te.getFillColor(!0),ie=te.getStrokeColor(!0);J&&J.transform(u),ie&&ie.transform(u)}if(U&&(U=this._transformContent(D,y,w))){var ae=this._pivot;ae&&D._transformPoint(ae,ae,!0),D.reset(!0),w&&this._canApplyMatrix&&(this._applyMatrix=!0)}var ve=this._bounds,Se=this._position;(N||U)&&this._changed(25);var be=N&&ve&&u.decompose();if(be&&be.skewing.isZero()&&be.rotation%90===0){for(var ge in ve){var Ce=ve[ge];if(Ce.nonscaling)delete ve[ge];else if(U||!Ce.internal){var Ne=Ce.rect;u._transformBounds(Ne,Ne)}}this._bounds=ve;var qe=ve[this._getBoundsCacheKey(this._boundsOptions||{})];qe&&(this._position=this._getPositionFromBounds(qe.rect))}else N&&Se&&this._pivot&&(this._position=u._transformPoint(Se,Se));return this},_transformContent:function(u,y,w){var D=this._children;if(D){for(var N=0,U=D.length;N<U;N++)D[N].transform(u,y,w);return!0}},globalToLocal:function(){return this.getGlobalMatrix(!0)._inverseTransform(I.read(arguments))},localToGlobal:function(){return this.getGlobalMatrix(!0)._transformPoint(I.read(arguments))},parentToLocal:function(){return this._matrix._inverseTransform(I.read(arguments))},localToParent:function(){return this._matrix._transformPoint(I.read(arguments))},fitBounds:function(u,y){u=Y.read(arguments);var w=this.getBounds(),D=w.height/w.width,N=u.height/u.width,U=(y?D>N:D<N)?u.width/w.width:u.height/w.height,te=new Y(new I,new L(w.width*U,w.height*U));te.setCenter(u.getCenter()),this.setBounds(te)}}),{_setStyles:function(u,y,w){var D=this._style,N=this._matrix;if(D.hasFill()&&(u.fillStyle=D.getFillColor().toCanvasStyle(u,N)),D.hasStroke()){u.strokeStyle=D.getStrokeColor().toCanvasStyle(u,N),u.lineWidth=D.getStrokeWidth();var U=D.getStrokeJoin(),te=D.getStrokeCap(),J=D.getMiterLimit();if(U&&(u.lineJoin=U),te&&(u.lineCap=te),J&&(u.miterLimit=J),yt.support.nativeDash){var ie=D.getDashArray(),ae=D.getDashOffset();ie&&ie.length&&("setLineDash"in u?(u.setLineDash(ie),u.lineDashOffset=ae):(u.mozDash=ie,u.mozDashOffset=ae))}}if(D.hasShadow()){var ve=y.pixelRatio||1,Se=w._shiftless().prepend(new pe().scale(ve,ve)),be=Se.transform(new I(D.getShadowBlur(),0)),ge=Se.transform(this.getShadowOffset());u.shadowColor=D.getShadowColor().toCanvasStyle(u),u.shadowBlur=be.getLength(),u.shadowOffsetX=ge.x,u.shadowOffsetY=ge.y}},draw:function(u,y,w){if(this._updateVersion=this._project._updateVersion,!(!this._visible||this._opacity===0)){var D=y.matrices,N=y.viewMatrix,U=this._matrix,te=D[D.length-1].appended(U);if(te.isInvertible()){N=N?N.appended(te):te,D.push(te),y.updateMatrix&&(this._globalMatrix=te);var J=this._blendMode,ie=S.clamp(this._opacity,0,1),ae=J==="normal",ve=Ie.nativeModes[J],Se=ae&&ie===1||y.dontStart||y.clip||(ve||ae&&ie<1)&&this._canComposite(),be=y.pixelRatio||1,ge,Ce,Ne;if(!Se){var qe=this.getStrokeBounds(N);if(!qe.width||!qe.height){D.pop();return}Ne=y.offset,Ce=y.offset=qe.getTopLeft().floor(),ge=u,u=et.getContext(qe.getSize().ceil().add(1).multiply(be)),be!==1&&u.scale(be,be)}u.save();var Ae=w?w.appended(U):this._canScaleStroke&&!this.getStrokeScaling(!0)&&N,ke=!Se&&y.clipItem,me=!Ae||ke;if(Se?(u.globalAlpha=ie,ve&&(u.globalCompositeOperation=J)):me&&u.translate(-Ce.x,-Ce.y),me&&(Se?U:N).applyToContext(u),ke&&y.clipItem.draw(u,y.extend({clip:!0})),Ae){u.setTransform(be,0,0,be,0,0);var Te=y.offset;Te&&u.translate(-Te.x,-Te.y)}this._draw(u,y,N,Ae),u.restore(),D.pop(),y.clip&&!y.dontFinish&&u.clip(this.getFillRule()),Se||(Ie.process(J,u,ge,ie,Ce.subtract(Ne).multiply(be)),et.release(u),y.offset=Ne)}}},_isUpdated:function(u){var y=this._parent;if(y instanceof Nt)return y._isUpdated(u);var w=this._updateVersion===u;return!w&&y&&y._visible&&y._isUpdated(u)&&(this._updateVersion=u,w=!0),w},_drawSelection:function(u,y,w,D,N){var U=this._selection,te=U&1,J=U&2||te&&this._selectBounds,ie=U&4;if(this._drawSelected||(te=!1),(te||J||ie)&&this._isUpdated(N)){var ae,ve=this.getSelectedColor(!0)||(ae=this.getLayer())&&ae.getSelectedColor(!0),Se=y.appended(this.getGlobalMatrix(!0)),be=w/2;if(u.strokeStyle=u.fillStyle=ve?ve.toCanvasStyle(u):"#009dec",te&&this._drawSelected(u,Se,D),ie){var ge=this.getPosition(!0),Ce=this._parent,Ne=Ce?Ce.localToGlobal(ge):ge,qe=Ne.x,Ae=Ne.y;u.beginPath(),u.arc(qe,Ae,be,0,Math.PI*2,!0),u.stroke();for(var ke=[[0,-1],[1,0],[0,1],[-1,0]],me=be,Te=w+1,Re=0;Re<4;Re++){var Fe=ke[Re],Ye=Fe[0],je=Fe[1];u.moveTo(qe+Ye*me,Ae+je*me),u.lineTo(qe+Ye*Te,Ae+je*Te),u.stroke()}}if(J){var Ze=Se._transformCorners(this.getInternalBounds());u.beginPath();for(var Re=0;Re<8;Re++)u[Re?"lineTo":"moveTo"](Ze[Re],Ze[++Re]);u.closePath(),u.stroke();for(var Re=0;Re<8;Re++)u.fillRect(Ze[Re]-be,Ze[++Re]-be,w,w)}}},_canComposite:function(){return!1}},n.each(["down","drag","up","move"],function(u){this["removeOn"+n.capitalize(u)]=function(){var y={};return y[u]=!0,this.removeOn(y)}},{removeOn:function(u){for(var y in u)if(u[y]){var w="mouse"+y,D=this._project,N=D._removeSets=D._removeSets||{};N[w]=N[w]||{},N[w][this._id]=this}return this}}),{tween:function(u,y,w){w||(w=y,y=u,u=null,w||(w=y,y=null));var D=w&&w.easing,N=w&&w.start,U=w!=null&&(typeof w=="number"?w:w.duration),te=new We(this,u,y,U,D,N);function J(ie){te._handleFrame(ie.time*1e3),te.running||this.off("frame",J)}return U&&this.on("frame",J),te},tweenTo:function(u,y){return this.tween(null,u,y)},tweenFrom:function(u,y){return this.tween(u,null,y)}}),Ee=ye.extend({_class:"Group",_selectBounds:!1,_selectChildren:!0,_serializeFields:{children:[]},initialize:function(y){this._children=[],this._namedChildren={},this._initialize(y)||this.addChildren(Array.isArray(y)?y:arguments)},_changed:function u(y){u.base.call(this,y),y&2050&&(this._clipItem=s)},_getClipItem:function(){var u=this._clipItem;if(u===s){u=null;for(var y=this._children,w=0,D=y.length;w<D;w++)if(y[w]._clipMask){u=y[w];break}this._clipItem=u}return u},isClipped:function(){return!!this._getClipItem()},setClipped:function(u){var y=this.getFirstChild();y&&y.setClipMask(u)},_getBounds:function u(y,w){var D=this._getClipItem();return D?D._getCachedBounds(D._matrix.prepended(y),n.set({},w,{stroke:!1})):u.base.call(this,y,w)},_hitTestChildren:function u(y,w,D){var N=this._getClipItem();return(!N||N.contains(y))&&u.base.call(this,y,w,D,N)},_draw:function(u,y){var w=y.clip,D=!w&&this._getClipItem();y=y.extend({clipItem:D,clip:!1}),w?(u.beginPath(),y.dontStart=y.dontFinish=!0):D&&D.draw(u,y.extend({clip:!0}));for(var N=this._children,U=0,te=N.length;U<te;U++){var J=N[U];J!==D&&J.draw(u,y)}}}),Le=Ee.extend({_class:"Layer",initialize:function(){Ee.apply(this,arguments)},_getOwner:function(){return this._parent||this._index!=null&&this._project},isInserted:function u(){return this._parent?u.base.call(this):this._index!=null},activate:function(){this._project._activeLayer=this},_hitTestSelf:function(){}}),Z=ye.extend({_class:"Shape",_applyMatrix:!1,_canApplyMatrix:!1,_canScaleStroke:!0,_serializeFields:{type:null,size:null,radius:null},initialize:function(y,w){this._initialize(y,w)},_equals:function(u){return this._type===u._type&&this._size.equals(u._size)&&n.equals(this._radius,u._radius)},copyContent:function(u){this.setType(u._type),this.setSize(u._size),this.setRadius(u._radius)},getType:function(){return this._type},setType:function(u){this._type=u},getShape:"#getType",setShape:"#setType",getSize:function(){var u=this._size;return new H(u.width,u.height,this,"setSize")},setSize:function(){var u=L.read(arguments);if(!this._size)this._size=u.clone();else if(!this._size.equals(u)){var y=this._type,w=u.width,D=u.height;y==="rectangle"?this._radius.set(L.min(this._radius,u.divide(2).abs())):y==="circle"?(w=D=(w+D)/2,this._radius=w/2):y==="ellipse"&&this._radius._set(w/2,D/2),this._size._set(w,D),this._changed(9)}},getRadius:function(){var u=this._radius;return this._type==="circle"?u:new H(u.width,u.height,this,"setRadius")},setRadius:function(u){var y=this._type;if(y==="circle"){if(u===this._radius)return;var w=u*2;this._radius=u,this._size._set(w,w)}else if(u=L.read(arguments),!this._radius)this._radius=u.clone();else{if(this._radius.equals(u))return;if(this._radius.set(u),y==="rectangle"){var w=L.max(this._size,u.multiply(2));this._size.set(w)}else y==="ellipse"&&this._size._set(u.width*2,u.height*2)}this._changed(9)},isEmpty:function(){return!1},toPath:function(u){var y=new mt[n.capitalize(this._type)]({center:new I,size:this._size,radius:this._radius,insert:!1});return y.copyAttributes(this),yt.settings.applyMatrix&&y.setApplyMatrix(!0),(u===s||u)&&y.insertAbove(this),y},toShape:"#clone",_asPathItem:function(){return this.toPath(!1)},_draw:function(u,y,w,D){var N=this._style,U=N.hasFill(),te=N.hasStroke(),J=y.dontFinish||y.clip,ie=!D;if(U||te||J){var ae=this._type,ve=this._radius,Se=ae==="circle";if(y.dontStart||u.beginPath(),ie&&Se)u.arc(0,0,ve,0,Math.PI*2,!0);else{var be=Se?ve:ve.width,ge=Se?ve:ve.height,Ce=this._size,Ne=Ce.width,qe=Ce.height;if(ie&&ae==="rectangle"&&be===0&&ge===0)u.rect(-Ne/2,-qe/2,Ne,qe);else{var Ae=Ne/2,ke=qe/2,me=1-.5522847498307936,Te=be*me,Re=ge*me,Fe=[-Ae,-ke+ge,-Ae,-ke+Re,-Ae+Te,-ke,-Ae+be,-ke,Ae-be,-ke,Ae-Te,-ke,Ae,-ke+Re,Ae,-ke+ge,Ae,ke-ge,Ae,ke-Re,Ae-Te,ke,Ae-be,ke,-Ae+be,ke,-Ae+Te,ke,-Ae,ke-Re,-Ae,ke-ge];D&&D.transform(Fe,Fe,32),u.moveTo(Fe[0],Fe[1]),u.bezierCurveTo(Fe[2],Fe[3],Fe[4],Fe[5],Fe[6],Fe[7]),Ae!==be&&u.lineTo(Fe[8],Fe[9]),u.bezierCurveTo(Fe[10],Fe[11],Fe[12],Fe[13],Fe[14],Fe[15]),ke!==ge&&u.lineTo(Fe[16],Fe[17]),u.bezierCurveTo(Fe[18],Fe[19],Fe[20],Fe[21],Fe[22],Fe[23]),Ae!==be&&u.lineTo(Fe[24],Fe[25]),u.bezierCurveTo(Fe[26],Fe[27],Fe[28],Fe[29],Fe[30],Fe[31])}}u.closePath()}!J&&(U||te)&&(this._setStyles(u,y,w),U&&(u.fill(N.getFillRule()),u.shadowColor="rgba(0,0,0,0)"),te&&u.stroke())},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_getBounds:function(u,y){var w=new Y(this._size).setCenter(0,0),D=this._style,N=y.stroke&&D.hasStroke()&&D.getStrokeWidth();return u&&(w=u._transformBounds(w)),N?w.expand(mt._getStrokePadding(N,this._getStrokeMatrix(u,y))):w}},new function(){function u(w,D,N){var U=w._radius;if(!U.isZero())for(var te=w._size.divide(2),J=1;J<=4;J++){var ie=new I(J>1&&J<4?-1:1,J>2?-1:1),ae=ie.multiply(te),ve=ae.subtract(ie.multiply(U)),Se=new Y(N?ae.add(ie.multiply(N)):ae,ve);if(Se.contains(D))return{point:ve,quadrant:J}}}function y(w,D,N,U){var te=w.divide(D);return(!U||te.isInQuadrant(U))&&te.subtract(te.normalize()).multiply(D).divide(N).length<=1}return{_contains:function w(D){if(this._type==="rectangle"){var N=u(this,D);return N?D.subtract(N.point).divide(this._radius).getLength()<=1:w.base.call(this,D)}else return D.divide(this.size).getLength()<=.5},_hitTestSelf:function w(D,N,U,te){var J=!1,ie=this._style,ae=N.stroke&&ie.hasStroke(),ve=N.fill&&ie.hasFill();if(ae||ve){var Se=this._type,be=this._radius,ge=ae?ie.getStrokeWidth()/2:0,Ce=N._tolerancePadding.add(mt._getStrokePadding(ge,!ie.getStrokeScaling()&&te));if(Se==="rectangle"){var Ne=Ce.multiply(2),qe=u(this,D,Ne);if(qe)J=y(D.subtract(qe.point),be,Ce,qe.quadrant);else{var Ae=new Y(this._size).setCenter(0,0),ke=Ae.expand(Ne),me=Ae.expand(Ne.negate());J=ke._containsPoint(D)&&!me._containsPoint(D)}}else J=y(D,be,Ce)}return J?new xe(ae?"stroke":"fill",this):w.base.apply(this,arguments)}}},{statics:new function(){function u(y,w,D,N,U){var te=n.create(Z.prototype);return te._type=y,te._size=D,te._radius=N,te._initialize(n.getNamed(U),w),te}return{Circle:function(){var y=arguments,w=I.readNamed(y,"center"),D=n.readNamed(y,"radius");return u("circle",w,new L(D*2),D,y)},Rectangle:function(){var y=arguments,w=Y.readNamed(y,"rectangle"),D=L.min(L.readNamed(y,"radius"),w.getSize(!0).divide(2));return u("rectangle",w.getCenter(!0),w.getSize(!0),D,y)},Ellipse:function(){var y=arguments,w=Z._readEllipse(y),D=w.radius;return u("ellipse",w.center,D.multiply(2),D,y)},_readEllipse:function(y){var w,D;if(n.hasNamed(y,"radius"))w=I.readNamed(y,"center"),D=L.readNamed(y,"radius");else{var N=Y.readNamed(y,"rectangle");w=N.getCenter(!0),D=N.getSize(!0).divide(2)}return{center:w,radius:D}}}}}),ne=ye.extend({_class:"Raster",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!1,handle:!1},_serializeFields:{crossOrigin:null,source:null},_prioritize:["crossOrigin"],_smoothing:"low",beans:!0,initialize:function(y,w){if(!this._initialize(y,w!==s&&I.read(arguments))){var D,N=typeof y,U=N==="string"?o.getElementById(y):N==="object"?y:null;if(U&&U!==ye.NO_INSERT){if(U.getContext||U.naturalHeight!=null)D=U;else if(U){var te=L.read(arguments);te.isZero()||(D=et.getCanvas(te))}}D?this.setImage(D):this.setSource(y)}this._size||(this._size=new L,this._loaded=!1)},_equals:function(u){return this.getSource()===u.getSource()},copyContent:function(u){var y=u._image,w=u._canvas;if(y)this._setImage(y);else if(w){var D=et.getCanvas(u._size);D.getContext("2d").drawImage(w,0,0),this._setImage(D)}this._crossOrigin=u._crossOrigin},getSize:function(){var u=this._size;return new H(u?u.width:0,u?u.height:0,this,"setSize")},setSize:function(u,y){var w=L.read(arguments);if(w.equals(this._size))y&&this.clear();else if(w.width>0&&w.height>0){var D=!y&&this.getElement();this._setImage(et.getCanvas(w)),D&&this.getContext(!0).drawImage(D,0,0,w.width,w.height)}else this._canvas&&et.release(this._canvas),this._size=w.clone()},getWidth:function(){return this._size?this._size.width:0},setWidth:function(u){this.setSize(u,this.getHeight())},getHeight:function(){return this._size?this._size.height:0},setHeight:function(u){this.setSize(this.getWidth(),u)},getLoaded:function(){return this._loaded},isEmpty:function(){var u=this._size;return!u||u.width===0&&u.height===0},getResolution:function(){var u=this._matrix,y=new I(0,0).transform(u),w=new I(1,0).transform(u).subtract(y),D=new I(0,1).transform(u).subtract(y);return new L(72/w.getLength(),72/D.getLength())},getPpi:"#getResolution",getImage:function(){return this._image},setImage:function(u){var y=this;function w(D){var N=y.getView(),U=D&&D.type||"load";N&&y.responds(U)&&(yt=N._scope,y.emit(U,new ls(D)))}this._setImage(u),this._loaded?setTimeout(w,0):u&&qi.add(u,{load:function(D){y._setImage(u),w(D)},error:w})},_setImage:function(u){this._canvas&&et.release(this._canvas),u&&u.getContext?(this._image=null,this._canvas=u,this._loaded=!0):(this._image=u,this._canvas=null,this._loaded=!!(u&&u.src&&u.complete)),this._size=new L(u?u.naturalWidth||u.width:0,u?u.naturalHeight||u.height:0),this._context=null,this._changed(1033)},getCanvas:function(){if(!this._canvas){var u=et.getContext(this._size);try{this._image&&u.drawImage(this._image,0,0),this._canvas=u.canvas}catch{et.release(u)}}return this._canvas},setCanvas:"#setImage",getContext:function(u){return this._context||(this._context=this.getCanvas().getContext("2d")),u&&(this._image=null,this._changed(1025)),this._context},setContext:function(u){this._context=u},getSource:function(){var u=this._image;return u&&u.src||this.toDataURL()},setSource:function(u){var y=new t.Image,w=this._crossOrigin;w&&(y.crossOrigin=w),u&&(y.src=u),this.setImage(y)},getCrossOrigin:function(){var u=this._image;return u&&u.crossOrigin||this._crossOrigin||""},setCrossOrigin:function(u){this._crossOrigin=u;var y=this._image;y&&(y.crossOrigin=u)},getSmoothing:function(){return this._smoothing},setSmoothing:function(u){this._smoothing=typeof u=="string"?u:u?"low":"off",this._changed(257)},getElement:function(){return this._canvas||this._loaded&&this._image}},{beans:!1,getSubCanvas:function(){var u=Y.read(arguments),y=et.getContext(u.getSize());return y.drawImage(this.getCanvas(),u.x,u.y,u.width,u.height,0,0,u.width,u.height),y.canvas},getSubRaster:function(){var u=Y.read(arguments),y=new ne(ye.NO_INSERT);return y._setImage(this.getSubCanvas(u)),y.translate(u.getCenter().subtract(this.getSize().divide(2))),y._matrix.prepend(this._matrix),y.insertAbove(this),y},toDataURL:function(){var u=this._image,y=u&&u.src;if(/^data:/.test(y))return y;var w=this.getCanvas();return w?w.toDataURL.apply(w,arguments):null},drawImage:function(u){var y=I.read(arguments,1);this.getContext(!0).drawImage(u,y.x,y.y)},getAverageColor:function(u){var y,w;if(u?u instanceof ht?(w=u,y=u.getBounds()):typeof u=="object"&&("width"in u?y=new Y(u):"x"in u&&(y=new Y(u.x-.5,u.y-.5,1,1))):y=this.getBounds(),!y)return null;var D=32,N=Math.min(y.width,D),U=Math.min(y.height,D),te=ne._sampleContext;te?te.clearRect(0,0,D+1,D+1):te=ne._sampleContext=et.getContext(new L(D)),te.save();var J=new pe().scale(N/y.width,U/y.height).translate(-y.x,-y.y);J.applyToContext(te),w&&w.draw(te,new n({clip:!0,matrices:[J]})),this._matrix.applyToContext(te);var ie=this.getElement(),ae=this._size;ie&&te.drawImage(ie,-ae.width/2,-ae.height/2),te.restore();for(var ve=te.getImageData(.5,.5,Math.ceil(N),Math.ceil(U)).data,Se=[0,0,0],be=0,ge=0,Ce=ve.length;ge<Ce;ge+=4){var Ne=ve[ge+3];be+=Ne,Ne/=255,Se[0]+=ve[ge]*Ne,Se[1]+=ve[ge+1]*Ne,Se[2]+=ve[ge+2]*Ne}for(var ge=0;ge<3;ge++)Se[ge]/=be;return be?oi.read(Se):null},getPixel:function(){var u=I.read(arguments),y=this.getContext().getImageData(u.x,u.y,1,1).data;return new oi("rgb",[y[0]/255,y[1]/255,y[2]/255],y[3]/255)},setPixel:function(){var u=arguments,y=I.read(u),w=oi.read(u),D=w._convert("rgb"),N=w._alpha,U=this.getContext(!0),te=U.createImageData(1,1),J=te.data;J[0]=D[0]*255,J[1]=D[1]*255,J[2]=D[2]*255,J[3]=N!=null?N*255:255,U.putImageData(te,y.x,y.y)},clear:function(){var u=this._size;this.getContext(!0).clearRect(0,0,u.width+1,u.height+1)},createImageData:function(){var u=L.read(arguments);return this.getContext().createImageData(u.width,u.height)},getImageData:function(){var u=Y.read(arguments);return u.isEmpty()&&(u=new Y(this._size)),this.getContext().getImageData(u.x,u.y,u.width,u.height)},putImageData:function(u){var y=I.read(arguments,1);this.getContext(!0).putImageData(u,y.x,y.y)},setImageData:function(u){this.setSize(u),this.getContext(!0).putImageData(u,0,0)},_getBounds:function(u,y){var w=new Y(this._size).setCenter(0,0);return u?u._transformBounds(w):w},_hitTestSelf:function(u){if(this._contains(u)){var y=this;return new xe("pixel",y,{offset:u.add(y._size.divide(2)).round(),color:{get:function(){return y.getPixel(this.offset)}}})}},_draw:function(u,y,w){var D=this.getElement();if(D&&D.width>0&&D.height>0){u.globalAlpha=S.clamp(this._opacity,0,1),this._setStyles(u,y,w);var N=this._smoothing,U=N==="off";Vi.setPrefixed(u,U?"imageSmoothingEnabled":"imageSmoothingQuality",U?!1:N),u.drawImage(D,-this._size.width/2,-this._size.height/2)}},_canComposite:function(){return!0}}),Ke=ye.extend({_class:"SymbolItem",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!0},_serializeFields:{symbol:null},initialize:function(y,w){this._initialize(y,w!==s&&I.read(arguments,1))||this.setDefinition(y instanceof _t?y:new _t(y))},_equals:function(u){return this._definition===u._definition},copyContent:function(u){this.setDefinition(u._definition)},getDefinition:function(){return this._definition},setDefinition:function(u){this._definition=u,this._changed(9)},getSymbol:"#getDefinition",setSymbol:"#setDefinition",isEmpty:function(){return this._definition._item.isEmpty()},_getBounds:function(u,y){var w=this._definition._item;return w._getCachedBounds(w._matrix.prepended(u),y)},_hitTestSelf:function(u,y,w){var D=y.extend({all:!1}),N=this._definition._item._hitTest(u,D,w);return N&&(N.item=this),N},_draw:function(u,y){this._definition._item.draw(u,y)}}),_t=n.extend({_class:"SymbolDefinition",initialize:function(y,w){this._id=O.get(),this.project=yt.project,y&&this.setItem(y,w)},_serialize:function(u,y){return y.add(this,function(){return n.serialize([this._class,this._item],u,!1,y)})},_changed:function(u){u&8&&ye._clearBoundsCache(this),u&1&&this.project._changed(u)},getItem:function(){return this._item},setItem:function(u,y){u._symbol&&(u=u.clone()),this._item&&(this._item._symbol=null),this._item=u,u.remove(),u.setSelected(!1),y||u.setPosition(new I),u._symbol=this,this._changed(9)},getDefinition:"#getItem",setDefinition:"#setItem",place:function(u){return new Ke(this,u)},clone:function(){return new _t(this._item.clone(!1))},equals:function(u){return u===this||u&&this._item.equals(u._item)||!1}}),xe=n.extend({_class:"HitResult",initialize:function(y,w,D){this.type=y,this.item=w,D&&this.inject(D)},statics:{getOptions:function(u){var y=u&&n.read(u);return new n({type:null,tolerance:yt.settings.hitTolerance,fill:!y,stroke:!y,segments:!y,handles:!1,ends:!1,position:!1,center:!1,bounds:!1,guides:!1,selected:!1},y)}}}),Ct=n.extend({_class:"Segment",beans:!0,_selection:0,initialize:function(y,w,D,N,U,te){var J=arguments.length,ie,ae,ve,Se;J>0&&(y==null||typeof y=="object"?J===1&&y&&"point"in y?(ie=y.point,ae=y.handleIn,ve=y.handleOut,Se=y.selection):(ie=y,ae=w,ve=D,Se=N):(ie=[y,w],ae=D!==s?[D,N]:null,ve=U!==s?[U,te]:null)),new zt(ie,this,"_point"),new zt(ae,this,"_handleIn"),new zt(ve,this,"_handleOut"),Se&&this.setSelection(Se)},_serialize:function(u,y){var w=this._point,D=this._selection,N=D||this.hasHandles()?[w,this._handleIn,this._handleOut]:w;return D&&N.push(D),n.serialize(N,u,!0,y)},_changed:function(u){var y=this._path;if(y){var w=y._curves,D=this._index,N;w&&((!u||u===this._point||u===this._handleIn)&&(N=D>0?w[D-1]:y._closed?w[w.length-1]:null)&&N._changed(),(!u||u===this._point||u===this._handleOut)&&(N=w[D])&&N._changed()),y._changed(41)}},getPoint:function(){return this._point},setPoint:function(){this._point.set(I.read(arguments))},getHandleIn:function(){return this._handleIn},setHandleIn:function(){this._handleIn.set(I.read(arguments))},getHandleOut:function(){return this._handleOut},setHandleOut:function(){this._handleOut.set(I.read(arguments))},hasHandles:function(){return!this._handleIn.isZero()||!this._handleOut.isZero()},isSmooth:function(){var u=this._handleIn,y=this._handleOut;return!u.isZero()&&!y.isZero()&&u.isCollinear(y)},clearHandles:function(){this._handleIn._set(0,0),this._handleOut._set(0,0)},getSelection:function(){return this._selection},setSelection:function(u){var y=this._selection,w=this._path;this._selection=u=u||0,w&&u!==y&&(w._updateSelection(this,y,u),w._changed(257))},_changeSelection:function(u,y){var w=this._selection;this.setSelection(y?w|u:w&~u)},isSelected:function(){return!!(this._selection&7)},setSelected:function(u){this._changeSelection(7,u)},getIndex:function(){return this._index!==s?this._index:null},getPath:function(){return this._path||null},getCurve:function(){var u=this._path,y=this._index;return u?(y>0&&!u._closed&&y===u._segments.length-1&&y--,u.getCurves()[y]||null):null},getLocation:function(){var u=this.getCurve();return u?new Et(u,this===u._segment1?0:1):null},getNext:function(){var u=this._path&&this._path._segments;return u&&(u[this._index+1]||this._path._closed&&u[0])||null},smooth:function(u,y,w){var D=u||{},N=D.type,U=D.factor,te=this.getPrevious(),J=this.getNext(),ie=(te||this)._point,ae=this._point,ve=(J||this)._point,Se=ie.getDistance(ae),be=ae.getDistance(ve);if(!N||N==="catmull-rom"){var ge=U===s?.5:U,Ce=Math.pow(Se,ge),Ne=Ce*Ce,qe=Math.pow(be,ge),Ae=qe*qe;if(!y&&te){var ke=2*Ae+3*qe*Ce+Ne,me=3*qe*(qe+Ce);this.setHandleIn(me!==0?new I((Ae*ie._x+ke*ae._x-Ne*ve._x)/me-ae._x,(Ae*ie._y+ke*ae._y-Ne*ve._y)/me-ae._y):new I)}if(!w&&J){var ke=2*Ne+3*Ce*qe+Ae,me=3*Ce*(Ce+qe);this.setHandleOut(me!==0?new I((Ne*ve._x+ke*ae._x-Ae*ie._x)/me-ae._x,(Ne*ve._y+ke*ae._y-Ae*ie._y)/me-ae._y):new I)}}else if(N==="geometric"){if(te&&J){var Te=ie.subtract(ve),Re=U===s?.4:U,Fe=Re*Se/(Se+be);y||this.setHandleIn(Te.multiply(Fe)),w||this.setHandleOut(Te.multiply(Fe-Re))}}else throw new Error("Smoothing method '"+N+"' not supported.")},getPrevious:function(){var u=this._path&&this._path._segments;return u&&(u[this._index-1]||this._path._closed&&u[u.length-1])||null},isFirst:function(){return!this._index},isLast:function(){var u=this._path;return u&&this._index===u._segments.length-1||!1},reverse:function(){var u=this._handleIn,y=this._handleOut,w=u.clone();u.set(y),y.set(w)},reversed:function(){return new Ct(this._point,this._handleOut,this._handleIn)},remove:function(){return this._path?!!this._path.removeSegment(this._index):!1},clone:function(){return new Ct(this._point,this._handleIn,this._handleOut)},equals:function(u){return u===this||u&&this._class===u._class&&this._point.equals(u._point)&&this._handleIn.equals(u._handleIn)&&this._handleOut.equals(u._handleOut)||!1},toString:function(){var u=["point: "+this._point];return this._handleIn.isZero()||u.push("handleIn: "+this._handleIn),this._handleOut.isZero()||u.push("handleOut: "+this._handleOut),"{ "+u.join(", ")+" }"},transform:function(u){this._transformCoordinates(u,new Array(6),!0),this._changed()},interpolate:function(u,y,w){var D=1-w,N=w,U=u._point,te=y._point,J=u._handleIn,ie=y._handleIn,ae=y._handleOut,ve=u._handleOut;this._point._set(D*U._x+N*te._x,D*U._y+N*te._y,!0),this._handleIn._set(D*J._x+N*ie._x,D*J._y+N*ie._y,!0),this._handleOut._set(D*ve._x+N*ae._x,D*ve._y+N*ae._y,!0),this._changed()},_transformCoordinates:function(u,y,w){var D=this._point,N=!w||!this._handleIn.isZero()?this._handleIn:null,U=!w||!this._handleOut.isZero()?this._handleOut:null,te=D._x,J=D._y,ie=2;return y[0]=te,y[1]=J,N&&(y[ie++]=N._x+te,y[ie++]=N._y+J),U&&(y[ie++]=U._x+te,y[ie++]=U._y+J),u&&(u._transformCoordinates(y,y,ie/2),te=y[0],J=y[1],w?(D._x=te,D._y=J,ie=2,N&&(N._x=y[ie++]-te,N._y=y[ie++]-J),U&&(U._x=y[ie++]-te,U._y=y[ie++]-J)):(N||(y[ie++]=te,y[ie++]=J),U||(y[ie++]=te,y[ie++]=J))),y}}),zt=I.extend({initialize:function(y,w,D){var N,U,te;if(!y)N=U=0;else if((N=y[0])!==s)U=y[1];else{var J=y;(N=J.x)===s&&(J=I.read(arguments),N=J.x),U=J.y,te=J.selected}this._x=N,this._y=U,this._owner=w,w[D]=this,te&&this.setSelected(!0)},_set:function(u,y){return this._x=u,this._y=y,this._owner._changed(this),this},getX:function(){return this._x},setX:function(u){this._x=u,this._owner._changed(this)},getY:function(){return this._y},setY:function(u){this._y=u,this._owner._changed(this)},isZero:function(){var u=S.isZero;return u(this._x)&&u(this._y)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(u){this._owner._changeSelection(this._getSelection(),u)},_getSelection:function(){var u=this._owner;return this===u._point?1:this===u._handleIn?2:this===u._handleOut?4:0}}),Je=n.extend({_class:"Curve",beans:!0,initialize:function(y,w,D,N,U,te,J,ie){var ae=arguments.length,ve,Se,be,ge,Ce,Ne;ae===3?(this._path=y,ve=w,Se=D):ae?ae===1?"segment1"in y?(ve=new Ct(y.segment1),Se=new Ct(y.segment2)):"point1"in y?(be=y.point1,Ce=y.handle1,Ne=y.handle2,ge=y.point2):Array.isArray(y)&&(be=[y[0],y[1]],ge=[y[6],y[7]],Ce=[y[2]-y[0],y[3]-y[1]],Ne=[y[4]-y[6],y[5]-y[7]]):ae===2?(ve=new Ct(y),Se=new Ct(w)):ae===4?(be=y,Ce=w,Ne=D,ge=N):ae===8&&(be=[y,w],ge=[J,ie],Ce=[D-y,N-w],Ne=[U-J,te-ie]):(ve=new Ct,Se=new Ct),this._segment1=ve||new Ct(be,null,Ce),this._segment2=Se||new Ct(ge,Ne,null)},_serialize:function(u,y){return n.serialize(this.hasHandles()?[this.getPoint1(),this.getHandle1(),this.getHandle2(),this.getPoint2()]:[this.getPoint1(),this.getPoint2()],u,!0,y)},_changed:function(){this._length=this._bounds=s},clone:function(){return new Je(this._segment1,this._segment2)},toString:function(){var u=["point1: "+this._segment1._point];return this._segment1._handleOut.isZero()||u.push("handle1: "+this._segment1._handleOut),this._segment2._handleIn.isZero()||u.push("handle2: "+this._segment2._handleIn),u.push("point2: "+this._segment2._point),"{ "+u.join(", ")+" }"},classify:function(){return Je.classify(this.getValues())},remove:function(){var u=!1;if(this._path){var y=this._segment2,w=y._handleOut;u=y.remove(),u&&this._segment1._handleOut.set(w)}return u},getPoint1:function(){return this._segment1._point},setPoint1:function(){this._segment1._point.set(I.read(arguments))},getPoint2:function(){return this._segment2._point},setPoint2:function(){this._segment2._point.set(I.read(arguments))},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(){this._segment1._handleOut.set(I.read(arguments))},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(){this._segment2._handleIn.set(I.read(arguments))},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var u=this._path&&this._path._curves;return u&&(u[this._segment1._index+1]||this._path._closed&&u[0])||null},getPrevious:function(){var u=this._path&&this._path._curves;return u&&(u[this._segment1._index-1]||this._path._closed&&u[u.length-1])||null},isFirst:function(){return!this._segment1._index},isLast:function(){var u=this._path;return u&&this._segment1._index===u._curves.length-1||!1},isSelected:function(){return this.getPoint1().isSelected()&&this.getHandle1().isSelected()&&this.getHandle2().isSelected()&&this.getPoint2().isSelected()},setSelected:function(u){this.getPoint1().setSelected(u),this.getHandle1().setSelected(u),this.getHandle2().setSelected(u),this.getPoint2().setSelected(u)},getValues:function(u){return Je.getValues(this._segment1,this._segment2,u)},getPoints:function(){for(var u=this.getValues(),y=[],w=0;w<8;w+=2)y.push(new I(u[w],u[w+1]));return y}},{getLength:function(){return this._length==null&&(this._length=Je.getLength(this.getValues(),0,1)),this._length},getArea:function(){return Je.getArea(this.getValues())},getLine:function(){return new de(this._segment1._point,this._segment2._point)},getPart:function(u,y){return new Je(Je.getPart(this.getValues(),u,y))},getPartLength:function(u,y){return Je.getLength(this.getValues(),u,y)},divideAt:function(u){return this.divideAtTime(u&&u.curve===this?u.time:this.getTimeAt(u))},divideAtTime:function(u,y){var w=1e-8,D=1-w,N=null;if(u>=w&&u<=D){var U=Je.subdivide(this.getValues(),u),te=U[0],J=U[1],ie=y||this.hasHandles(),ae=this._segment1,ve=this._segment2,Se=this._path;ie&&(ae._handleOut._set(te[2]-te[0],te[3]-te[1]),ve._handleIn._set(J[4]-J[6],J[5]-J[7]));var be=te[6],ge=te[7],Ce=new Ct(new I(be,ge),ie&&new I(te[4]-be,te[5]-ge),ie&&new I(J[2]-be,J[3]-ge));Se?(Se.insert(ae._index+1,Ce),N=this.getNext()):(this._segment2=Ce,this._changed(),N=new Je(Ce,ve))}return N},splitAt:function(u){var y=this._path;return y?y.splitAt(u):null},splitAtTime:function(u){return this.splitAt(this.getLocationAtTime(u))},divide:function(u,y){return this.divideAtTime(u===s?.5:y?u:this.getTimeAt(u))},split:function(u,y){return this.splitAtTime(u===s?.5:y?u:this.getTimeAt(u))},reversed:function(){return new Je(this._segment2.reversed(),this._segment1.reversed())},clearHandles:function(){this._segment1._handleOut._set(0,0),this._segment2._handleIn._set(0,0)},statics:{getValues:function(u,y,w,D){var N=u._point,U=u._handleOut,te=y._handleIn,J=y._point,ie=N.x,ae=N.y,ve=J.x,Se=J.y,be=D?[ie,ae,ie,ae,ve,Se,ve,Se]:[ie,ae,ie+U._x,ae+U._y,ve+te._x,Se+te._y,ve,Se];return w&&w._transformCoordinates(be,be,4),be},subdivide:function(u,y){var w=u[0],D=u[1],N=u[2],U=u[3],te=u[4],J=u[5],ie=u[6],ae=u[7];y===s&&(y=.5);var ve=1-y,Se=ve*w+y*N,be=ve*D+y*U,ge=ve*N+y*te,Ce=ve*U+y*J,Ne=ve*te+y*ie,qe=ve*J+y*ae,Ae=ve*Se+y*ge,ke=ve*be+y*Ce,me=ve*ge+y*Ne,Te=ve*Ce+y*qe,Re=ve*Ae+y*me,Fe=ve*ke+y*Te;return[[w,D,Se,be,Ae,ke,Re,Fe],[Re,Fe,me,Te,Ne,qe,ie,ae]]},getMonoCurves:function(u,y){var w=[],D=y?0:1,N=u[D+0],U=u[D+2],te=u[D+4],J=u[D+6];if(N>=U==U>=te&&U>=te==te>=J||Je.isStraight(u))w.push(u);else{var ie=3*(U-te)-N+J,ae=2*(N+te)-4*U,ve=U-N,Se=1e-8,be=1-Se,ge=[],Ce=S.solveQuadratic(ie,ae,ve,ge,Se,be);if(!Ce)w.push(u);else{ge.sort();var Ne=ge[0],qe=Je.subdivide(u,Ne);w.push(qe[0]),Ce>1&&(Ne=(ge[1]-Ne)/(1-Ne),qe=Je.subdivide(qe[1],Ne),w.push(qe[0])),w.push(qe[1])}}return w},solveCubic:function(u,y,w,D,N,U){var te=u[y],J=u[y+2],ie=u[y+4],ae=u[y+6],ve=0;if(!(te<w&&ae<w&&J<w&&ie<w||te>w&&ae>w&&J>w&&ie>w)){var Se=3*(J-te),be=3*(ie-J)-Se,ge=ae-te-Se-be;ve=S.solveCubic(ge,be,Se,te-w,D,N,U)}return ve},getTimeOf:function(u,y){var w=new I(u[0],u[1]),D=new I(u[6],u[7]),N=1e-12,U=1e-7,te=y.isClose(w,N)?0:y.isClose(D,N)?1:null;if(te===null)for(var J=[y.x,y.y],ie=[],ae=0;ae<2;ae++)for(var ve=Je.solveCubic(u,ae,J[ae],ie,0,1),Se=0;Se<ve;Se++){var be=ie[Se];if(y.isClose(Je.getPoint(u,be),U))return be}return y.isClose(w,U)?0:y.isClose(D,U)?1:null},getNearestTime:function(u,y){if(Je.isStraight(u)){var w=u[0],D=u[1],N=u[6],U=u[7],te=N-w,J=U-D,ie=te*te+J*J;if(ie===0)return 0;var ae=((y.x-w)*te+(y.y-D)*J)/ie;return ae<1e-12?0:ae>.999999999999?1:Je.getTimeOf(u,new I(w+ae*te,D+ae*J))}var ve=100,Se=1/0,be=0;function ge(qe){if(qe>=0&&qe<=1){var Ae=y.getDistance(Je.getPoint(u,qe),!0);if(Ae<Se)return Se=Ae,be=qe,!0}}for(var Ce=0;Ce<=ve;Ce++)ge(Ce/ve);for(var Ne=1/(ve*2);Ne>1e-8;)!ge(be-Ne)&&!ge(be+Ne)&&(Ne/=2);return be},getPart:function(u,y,w){var D=y>w;if(D){var N=y;y=w,w=N}return y>0&&(u=Je.subdivide(u,y)[1]),w<1&&(u=Je.subdivide(u,(w-y)/(1-y))[0]),D?[u[6],u[7],u[4],u[5],u[2],u[3],u[0],u[1]]:u},isFlatEnough:function(u,y){var w=u[0],D=u[1],N=u[2],U=u[3],te=u[4],J=u[5],ie=u[6],ae=u[7],ve=3*N-2*w-ie,Se=3*U-2*D-ae,be=3*te-2*ie-w,ge=3*J-2*ae-D;return Math.max(ve*ve,be*be)+Math.max(Se*Se,ge*ge)<=16*y*y},getArea:function(u){var y=u[0],w=u[1],D=u[2],N=u[3],U=u[4],te=u[5],J=u[6],ie=u[7];return 3*((ie-w)*(D+U)-(J-y)*(N+te)+N*(y-U)-D*(w-te)+ie*(U+y/3)-J*(te+w/3))/20},getBounds:function(u){for(var y=u.slice(0,2),w=y.slice(),D=[0,0],N=0;N<2;N++)Je._addBounds(u[N],u[N+2],u[N+4],u[N+6],N,0,y,w,D);return new Y(y[0],y[1],w[0]-y[0],w[1]-y[1])},_addBounds:function(u,y,w,D,N,U,te,J,ie){function ae(Re,Fe){var Ye=Re-Fe,je=Re+Fe;Ye<te[N]&&(te[N]=Ye),je>J[N]&&(J[N]=je)}U/=2;var ve=te[N]+U,Se=J[N]-U;if(u<ve||y<ve||w<ve||D<ve||u>Se||y>Se||w>Se||D>Se)if(y<u!=y<D&&w<u!=w<D)ae(u,0),ae(D,0);else{var be=3*(y-w)-u+D,ge=2*(u+w)-4*y,Ce=y-u,Ne=S.solveQuadratic(be,ge,Ce,ie),qe=1e-8,Ae=1-qe;ae(D,0);for(var ke=0;ke<Ne;ke++){var me=ie[ke],Te=1-me;qe<=me&&me<=Ae&&ae(Te*Te*Te*u+3*Te*Te*me*y+3*Te*me*me*w+me*me*me*D,U)}}}}},n.each(["getBounds","getStrokeBounds","getHandleBounds"],function(u){this[u]=function(){this._bounds||(this._bounds={});var y=this._bounds[u];return y||(y=this._bounds[u]=mt[u]([this._segment1,this._segment2],!1,this._path)),y.clone()}},{}),n.each({isStraight:function(u,y,w,D){if(y.isZero()&&w.isZero())return!0;var N=D.subtract(u);if(N.isZero())return!1;if(N.isCollinear(y)&&N.isCollinear(w)){var U=new de(u,D),te=1e-7;if(U.getDistance(u.add(y))<te&&U.getDistance(D.add(w))<te){var J=N.dot(N),ie=N.dot(y)/J,ae=N.dot(w)/J;return ie>=0&&ie<=1&&ae<=0&&ae>=-1}}return!1},isLinear:function(u,y,w,D){var N=D.subtract(u).divide(3);return y.equals(N)&&w.negate().equals(N)}},function(u,y){this[y]=function(w){var D=this._segment1,N=this._segment2;return u(D._point,D._handleOut,N._handleIn,N._point,w)},this.statics[y]=function(w,D){var N=w[0],U=w[1],te=w[6],J=w[7];return u(new I(N,U),new I(w[2]-N,w[3]-U),new I(w[4]-te,w[5]-J),new I(te,J),D)}},{statics:{},hasHandles:function(){return!this._segment1._handleOut.isZero()||!this._segment2._handleIn.isZero()},hasLength:function(u){return(!this.getPoint1().equals(this.getPoint2())||this.hasHandles())&&this.getLength()>(u||0)},isCollinear:function(u){return u&&this.isStraight()&&u.isStraight()&&this.getLine().isCollinear(u.getLine())},isHorizontal:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).y)<1e-8},isVertical:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).x)<1e-8}}),{beans:!1,getLocationAt:function(u,y){return this.getLocationAtTime(y?u:this.getTimeAt(u))},getLocationAtTime:function(u){return u!=null&&u>=0&&u<=1?new Et(this,u):null},getTimeAt:function(u,y){return Je.getTimeAt(this.getValues(),u,y)},getParameterAt:"#getTimeAt",getTimesWithTangent:function(){var u=I.read(arguments);return u.isZero()?[]:Je.getTimesWithTangent(this.getValues(),u)},getOffsetAtTime:function(u){return this.getPartLength(0,u)},getLocationOf:function(){return this.getLocationAtTime(this.getTimeOf(I.read(arguments)))},getOffsetOf:function(){var u=this.getLocationOf.apply(this,arguments);return u?u.getOffset():null},getTimeOf:function(){return Je.getTimeOf(this.getValues(),I.read(arguments))},getParameterOf:"#getTimeOf",getNearestLocation:function(){var u=I.read(arguments),y=this.getValues(),w=Je.getNearestTime(y,u),D=Je.getPoint(y,w);return new Et(this,w,D,null,u.getDistance(D))},getNearestPoint:function(){var u=this.getNearestLocation.apply(this,arguments);return u&&u.getPoint()}},new function(){var u=["getPoint","getTangent","getNormal","getWeightedTangent","getWeightedNormal","getCurvature"];return n.each(u,function(y){this[y+"At"]=function(w,D){var N=this.getValues();return Je[y](N,D?w:Je.getTimeAt(N,w))},this[y+"AtTime"]=function(w){return Je[y](this.getValues(),w)}},{statics:{_evaluateMethods:u}})},new function(){function u(D){var N=D[0],U=D[1],te=D[2],J=D[3],ie=D[4],ae=D[5],ve=D[6],Se=D[7],be=9*(te-ie)+3*(ve-N),ge=6*(N+ie)-12*te,Ce=3*(te-N),Ne=9*(J-ae)+3*(Se-U),qe=6*(U+ae)-12*J,Ae=3*(J-U);return function(ke){var me=(be*ke+ge)*ke+Ce,Te=(Ne*ke+qe)*ke+Ae;return Math.sqrt(me*me+Te*Te)}}function y(D,N){return Math.max(2,Math.min(16,Math.ceil(Math.abs(N-D)*32)))}function w(D,N,U,te){if(N==null||N<0||N>1)return null;var J=D[0],ie=D[1],ae=D[2],ve=D[3],Se=D[4],be=D[5],ge=D[6],Ce=D[7],Ne=S.isZero;Ne(ae-J)&&Ne(ve-ie)&&(ae=J,ve=ie),Ne(Se-ge)&&Ne(be-Ce)&&(Se=ge,be=Ce);var qe=3*(ae-J),Ae=3*(Se-ae)-qe,ke=ge-J-qe-Ae,me=3*(ve-ie),Te=3*(be-ve)-me,Re=Ce-ie-me-Te,Fe,Ye;if(U===0)Fe=N===0?J:N===1?ge:((ke*N+Ae)*N+qe)*N+J,Ye=N===0?ie:N===1?Ce:((Re*N+Te)*N+me)*N+ie;else{var je=1e-8,Ze=1-je;if(N<je?(Fe=qe,Ye=me):N>Ze?(Fe=3*(ge-Se),Ye=3*(Ce-be)):(Fe=(3*ke*N+2*Ae)*N+qe,Ye=(3*Re*N+2*Te)*N+me),te){Fe===0&&Ye===0&&(N<je||N>Ze)&&(Fe=Se-ae,Ye=be-ve);var tt=Math.sqrt(Fe*Fe+Ye*Ye);tt&&(Fe/=tt,Ye/=tt)}if(U===3){var Se=6*ke*N+2*Ae,be=6*Re*N+2*Te,ut=Math.pow(Fe*Fe+Ye*Ye,3/2);Fe=ut!==0?(Fe*be-Ye*Se)/ut:0,Ye=0}}return U===2?new I(Ye,-Fe):new I(Fe,Ye)}return{statics:{classify:function(D){var N=D[0],U=D[1],te=D[2],J=D[3],ie=D[4],ae=D[5],ve=D[6],Se=D[7],be=N*(Se-ae)+U*(ie-ve)+ve*ae-Se*ie,ge=te*(U-Se)+J*(ve-N)+N*Se-U*ve,Ce=ie*(J-U)+ae*(N-te)+te*U-J*N,Ne=3*Ce,qe=Ne-ge,Ae=qe-ge+be,ke=Math.sqrt(Ae*Ae+qe*qe+Ne*Ne),me=ke!==0?1/ke:0,Te=S.isZero,Re="serpentine";Ae*=me,qe*=me,Ne*=me;function Fe(tt,ut,nt){var pt=ut!==s,ft=pt&&ut>0&&ut<1,wt=pt&&nt>0&&nt<1;return pt&&(!(ft||wt)||tt==="loop"&&!(ft&&wt))&&(tt="arch",ft=wt=!1),{type:tt,roots:ft||wt?ft&&wt?ut<nt?[ut,nt]:[nt,ut]:[ft?ut:nt]:null}}if(Te(Ae))return Te(qe)?Fe(Te(Ne)?"line":"quadratic"):Fe(Re,Ne/(3*qe));var Ye=3*qe*qe-4*Ae*Ne;if(Te(Ye))return Fe("cusp",qe/(2*Ae));var je=Ye>0?Math.sqrt(Ye/3):Math.sqrt(-Ye),Ze=2*Ae;return Fe(Ye>0?Re:"loop",(qe+je)/Ze,(qe-je)/Ze)},getLength:function(D,N,U,te){if(N===s&&(N=0),U===s&&(U=1),Je.isStraight(D)){var J=D;U<1&&(J=Je.subdivide(J,U)[0],N/=U),N>0&&(J=Je.subdivide(J,N)[1]);var ie=J[6]-J[0],ae=J[7]-J[1];return Math.sqrt(ie*ie+ae*ae)}return S.integrate(te||u(D),N,U,y(N,U))},getTimeAt:function(D,N,U){if(U===s&&(U=N<0?1:0),N===0)return U;var te=Math.abs,J=1e-12,ie=N>0,ae=ie?U:0,ve=ie?1:U,Se=u(D),be=Je.getLength(D,ae,ve,Se),ge=te(N)-be;if(te(ge)<J)return ie?ve:ae;if(ge>J)return null;var Ce=N/be,Ne=0;function qe(Ae){return Ne+=S.integrate(Se,U,Ae,y(U,Ae)),U=Ae,Ne-N}return S.findRoot(qe,Se,U+Ce,ae,ve,32,1e-12)},getPoint:function(D,N){return w(D,N,0,!1)},getTangent:function(D,N){return w(D,N,1,!0)},getWeightedTangent:function(D,N){return w(D,N,1,!1)},getNormal:function(D,N){return w(D,N,2,!0)},getWeightedNormal:function(D,N){return w(D,N,2,!1)},getCurvature:function(D,N){return w(D,N,3,!1).x},getPeaks:function(D){var N=D[0],U=D[1],te=D[2],J=D[3],ie=D[4],ae=D[5],ve=D[6],Se=D[7],be=-N+3*te-3*ie+ve,ge=3*N-6*te+3*ie,Ce=-3*N+3*te,Ne=-U+3*J-3*ae+Se,qe=3*U-6*J+3*ae,Ae=-3*U+3*J,ke=1e-8,me=1-ke,Te=[];return S.solveCubic(9*(be*be+Ne*Ne),9*(be*ge+qe*Ne),2*(ge*ge+qe*qe)+3*(Ce*be+Ae*Ne),Ce*ge+qe*Ae,Te,ke,me),Te.sort()}}}},new function(){function u(ge,Ce,Ne,qe,Ae,ke,me){var Te=!me&&Ne.getPrevious()===Ae,Re=!me&&Ne!==Ae&&Ne.getNext()===Ae,Fe=1e-8,Ye=1-Fe;if(qe!==null&&qe>=(Te?Fe:0)&&qe<=(Re?Ye:1)&&ke!==null&&ke>=(Re?Fe:0)&&ke<=(Te?Ye:1)){var je=new Et(Ne,qe,null,me),Ze=new Et(Ae,ke,null,me);je._intersection=Ze,Ze._intersection=je,(!Ce||Ce(je))&&Et.insert(ge,je,!0)}}function y(ge,Ce,Ne,qe,Ae,ke,me,Te,Re,Fe,Ye,je,Ze){if(++Re>=4096||++Te>=40)return Re;var tt=1e-9,ut=Ce[0],nt=Ce[1],pt=Ce[6],ft=Ce[7],wt=de.getSignedDistance,Tt=wt(ut,nt,pt,ft,Ce[2],Ce[3]),Vt=wt(ut,nt,pt,ft,Ce[4],Ce[5]),ni=Tt*Vt>0?3/4:4/9,ai=ni*Math.min(0,Tt,Vt),Ht=ni*Math.max(0,Tt,Vt),Ci=wt(ut,nt,pt,ft,ge[0],ge[1]),Ti=wt(ut,nt,pt,ft,ge[2],ge[3]),Pi=wt(ut,nt,pt,ft,ge[4],ge[5]),wi=wt(ut,nt,pt,ft,ge[6],ge[7]),Qt=w(Ci,Ti,Pi,wi),Oi=Qt[0],ds=Qt[1],Lt,Qi;if(Tt===0&&Vt===0&&Ci===0&&Ti===0&&Pi===0&&wi===0||(Lt=D(Oi,ds,ai,Ht))==null||(Qi=D(Oi.reverse(),ds.reverse(),ai,Ht))==null)return Re;var Ki=Fe+(Ye-Fe)*Lt,Ri=Fe+(Ye-Fe)*Qi;if(Math.max(Ze-je,Ri-Ki)<tt){var Xs=(Ki+Ri)/2,on=(je+Ze)/2;u(Ae,ke,me?qe:Ne,me?on:Xs,me?Ne:qe,me?Xs:on)}else{ge=Je.getPart(ge,Lt,Qi);var Hs=Ze-je;if(Qi-Lt>.8)if(Ri-Ki>Hs){var Bs=Je.subdivide(ge,.5),Xs=(Ki+Ri)/2;Re=y(Ce,Bs[0],qe,Ne,Ae,ke,!me,Te,Re,je,Ze,Ki,Xs),Re=y(Ce,Bs[1],qe,Ne,Ae,ke,!me,Te,Re,je,Ze,Xs,Ri)}else{var Bs=Je.subdivide(Ce,.5),on=(je+Ze)/2;Re=y(Bs[0],ge,qe,Ne,Ae,ke,!me,Te,Re,je,on,Ki,Ri),Re=y(Bs[1],ge,qe,Ne,Ae,ke,!me,Te,Re,on,Ze,Ki,Ri)}else Hs===0||Hs>=tt?Re=y(Ce,ge,qe,Ne,Ae,ke,!me,Te,Re,je,Ze,Ki,Ri):Re=y(ge,Ce,Ne,qe,Ae,ke,me,Te,Re,Ki,Ri,je,Ze)}return Re}function w(ge,Ce,Ne,qe){var Ae=[0,ge],ke=[1/3,Ce],me=[2/3,Ne],Te=[1,qe],Re=Ce-(2*ge+qe)/3,Fe=Ne-(ge+2*qe)/3,Ye;if(Re*Fe<0)Ye=[[Ae,ke,Te],[Ae,me,Te]];else{var je=Re/Fe;Ye=[je>=2?[Ae,ke,Te]:je<=.5?[Ae,me,Te]:[Ae,ke,me,Te],[Ae,Te]]}return(Re||Fe)<0?Ye.reverse():Ye}function D(ge,Ce,Ne,qe){return ge[0][1]<Ne?N(ge,!0,Ne):Ce[0][1]>qe?N(Ce,!1,qe):ge[0][0]}function N(ge,Ce,Ne){for(var qe=ge[0][0],Ae=ge[0][1],ke=1,me=ge.length;ke<me;ke++){var Te=ge[ke][0],Re=ge[ke][1];if(Ce?Re>=Ne:Re<=Ne)return Re===Ne?Te:qe+(Ne-Ae)*(Te-qe)/(Re-Ae);qe=Te,Ae=Re}return null}function U(ge,Ce,Ne,qe,Ae){var ke=S.isZero;if(ke(qe)&&ke(Ae)){var me=Je.getTimeOf(ge,new I(Ce,Ne));return me===null?[]:[me]}for(var Te=Math.atan2(-Ae,qe),Re=Math.sin(Te),Fe=Math.cos(Te),Ye=[],je=[],Ze=0;Ze<8;Ze+=2){var tt=ge[Ze]-Ce,ut=ge[Ze+1]-Ne;Ye.push(tt*Fe-ut*Re,tt*Re+ut*Fe)}return Je.solveCubic(Ye,1,0,je,0,1),je}function te(ge,Ce,Ne,qe,Ae,ke,me){for(var Te=Ce[0],Re=Ce[1],Fe=Ce[6],Ye=Ce[7],je=U(ge,Te,Re,Fe-Te,Ye-Re),Ze=0,tt=je.length;Ze<tt;Ze++){var ut=je[Ze],nt=Je.getPoint(ge,ut),pt=Je.getTimeOf(Ce,nt);pt!==null&&u(Ae,ke,me?qe:Ne,me?pt:ut,me?Ne:qe,me?ut:pt)}}function J(ge,Ce,Ne,qe,Ae,ke){var me=de.intersect(ge[0],ge[1],ge[6],ge[7],Ce[0],Ce[1],Ce[6],Ce[7]);me&&u(Ae,ke,Ne,Je.getTimeOf(ge,me),qe,Je.getTimeOf(Ce,me))}function ie(ge,Ce,Ne,qe,Ae,ke){var me=1e-12,Te=Math.min,Re=Math.max;if(Re(ge[0],ge[2],ge[4],ge[6])+me>Te(Ce[0],Ce[2],Ce[4],Ce[6])&&Te(ge[0],ge[2],ge[4],ge[6])-me<Re(Ce[0],Ce[2],Ce[4],Ce[6])&&Re(ge[1],ge[3],ge[5],ge[7])+me>Te(Ce[1],Ce[3],Ce[5],Ce[7])&&Te(ge[1],ge[3],ge[5],ge[7])-me<Re(Ce[1],Ce[3],Ce[5],Ce[7])){var Fe=Se(ge,Ce);if(Fe)for(var Ye=0;Ye<2;Ye++){var je=Fe[Ye];u(Ae,ke,Ne,je[0],qe,je[1],!0)}else{var Ze=Je.isStraight(ge),tt=Je.isStraight(Ce),ut=Ze&&tt,nt=Ze&&!tt,pt=Ae.length;if((ut?J:Ze||tt?te:y)(nt?Ce:ge,nt?ge:Ce,nt?qe:Ne,nt?Ne:qe,Ae,ke,nt,0,0,0,1,0,1),!ut||Ae.length===pt)for(var Ye=0;Ye<4;Ye++){var ft=Ye>>1,wt=Ye&1,Tt=ft*6,Vt=wt*6,ni=new I(ge[Tt],ge[Tt+1]),ai=new I(Ce[Vt],Ce[Vt+1]);ni.isClose(ai,me)&&u(Ae,ke,Ne,ft,qe,wt)}}}return Ae}function ae(ge,Ce,Ne,qe){var Ae=Je.classify(ge);if(Ae.type==="loop"){var ke=Ae.roots;u(Ne,qe,Ce,ke[0],Ce,ke[1])}return Ne}function ve(ge,Ce,Ne,qe,Ae,ke){var me=1e-7,Te=!Ce;Te&&(Ce=ge);for(var Re=ge.length,Fe=Ce.length,Ye=new Array(Re),je=Te?Ye:new Array(Fe),Ze=[],tt=0;tt<Re;tt++)Ye[tt]=ge[tt].getValues(qe);if(!Te)for(var tt=0;tt<Fe;tt++)je[tt]=Ce[tt].getValues(Ae);for(var ut=d.findCurveBoundsCollisions(Ye,je,me),nt=0;nt<Re;nt++){var pt=ge[nt],ft=Ye[nt];Te&&ae(ft,pt,Ze,Ne);var wt=ut[nt];if(wt)for(var Tt=0;Tt<wt.length;Tt++){if(ke&&Ze.length)return Ze;var Vt=wt[Tt];if(!Te||Vt>nt){var ni=Ce[Vt],ai=je[Vt];ie(ft,ai,pt,ni,Ze,Ne)}}}return Ze}function Se(ge,Ce){function Ne(wi){var Qt=wi[6]-wi[0],Oi=wi[7]-wi[1];return Qt*Qt+Oi*Oi}var qe=Math.abs,Ae=de.getDistance,ke=1e-8,me=1e-7,Te=Je.isStraight(ge),Re=Je.isStraight(Ce),Fe=Te&&Re,Ye=Ne(ge)<Ne(Ce),je=Ye?Ce:ge,Ze=Ye?ge:Ce,tt=je[0],ut=je[1],nt=je[6]-tt,pt=je[7]-ut;if(Ae(tt,ut,nt,pt,Ze[0],Ze[1],!0)<me&&Ae(tt,ut,nt,pt,Ze[6],Ze[7],!0)<me)!Fe&&Ae(tt,ut,nt,pt,je[2],je[3],!0)<me&&Ae(tt,ut,nt,pt,je[4],je[5],!0)<me&&Ae(tt,ut,nt,pt,Ze[2],Ze[3],!0)<me&&Ae(tt,ut,nt,pt,Ze[4],Ze[5],!0)<me&&(Te=Re=Fe=!0);else if(Fe)return null;if(Te^Re)return null;for(var ft=[ge,Ce],wt=[],Tt=0;Tt<4&&wt.length<2;Tt++){var Vt=Tt&1,ni=Vt^1,ai=Tt>>1,Ht=Je.getTimeOf(ft[Vt],new I(ft[ni][ai?6:0],ft[ni][ai?7:1]));if(Ht!=null){var Ci=Vt?[ai,Ht]:[Ht,ai];(!wt.length||qe(Ci[0]-wt[0][0])>ke&&qe(Ci[1]-wt[0][1])>ke)&&wt.push(Ci)}if(Tt>2&&!wt.length)break}if(wt.length!==2)wt=null;else if(!Fe){var Ti=Je.getPart(ge,wt[0][0],wt[1][0]),Pi=Je.getPart(Ce,wt[0][1],wt[1][1]);(qe(Pi[2]-Ti[2])>me||qe(Pi[3]-Ti[3])>me||qe(Pi[4]-Ti[4])>me||qe(Pi[5]-Ti[5])>me)&&(wt=null)}return wt}function be(ge,Ce){var Ne=ge[0],qe=ge[1],Ae=ge[2],ke=ge[3],me=ge[4],Te=ge[5],Re=ge[6],Fe=ge[7],Ye=Ce.normalize(),je=Ye.x,Ze=Ye.y,tt=3*Re-9*me+9*Ae-3*Ne,ut=3*Fe-9*Te+9*ke-3*qe,nt=6*me-12*Ae+6*Ne,pt=6*Te-12*ke+6*qe,ft=3*Ae-3*Ne,wt=3*ke-3*qe,Tt=2*tt*Ze-2*ut*je,Vt=[];if(Math.abs(Tt)<S.CURVETIME_EPSILON){var ni=tt*wt-ut*ft,Tt=tt*pt-ut*nt;if(Tt!=0){var ai=-ni/Tt;ai>=0&&ai<=1&&Vt.push(ai)}}else{var Ht=(nt*nt-4*tt*ft)*Ze*Ze+(-2*nt*pt+4*ut*ft+4*tt*wt)*je*Ze+(pt*pt-4*ut*wt)*je*je,Ci=nt*Ze-pt*je;if(Ht>=0&&Tt!=0){var Ti=Math.sqrt(Ht),Pi=-(Ci+Ti)/Tt,wi=(-Ci+Ti)/Tt;Pi>=0&&Pi<=1&&Vt.push(Pi),wi>=0&&wi<=1&&Vt.push(wi)}}return Vt}return{getIntersections:function(ge){var Ce=this.getValues(),Ne=ge&&ge!==this&&ge.getValues();return Ne?ie(Ce,Ne,this,ge,[]):ae(Ce,this,[])},statics:{getOverlaps:Se,getIntersections:ve,getCurveLineIntersections:U,getTimesWithTangent:be}}}),Et=n.extend({_class:"CurveLocation",initialize:function(y,w,D,N,U){if(w>=.99999999){var te=y.getNext();te&&(w=0,y=te)}this._setCurve(y),this._time=w,this._point=D||y.getPointAtTime(w),this._overlap=N,this._distance=U,this._intersection=this._next=this._previous=null},_setPath:function(u){this._path=u,this._version=u?u._version:0},_setCurve:function(u){this._setPath(u._path),this._curve=u,this._segment=null,this._segment1=u._segment1,this._segment2=u._segment2},_setSegment:function(u){var y=u.getCurve();y?this._setCurve(y):(this._setPath(u._path),this._segment1=u,this._segment2=null),this._segment=u,this._time=u===this._segment1?0:1,this._point=u._point.clone()},getSegment:function(){var u=this._segment;if(!u){var y=this.getCurve(),w=this.getTime();w===0?u=y._segment1:w===1?u=y._segment2:w!=null&&(u=y.getPartLength(0,w)<y.getPartLength(w,1)?y._segment1:y._segment2),this._segment=u}return u},getCurve:function(){var u=this._path,y=this;u&&u._version!==this._version&&(this._time=this._offset=this._curveOffset=this._curve=null);function w(D){var N=D&&D.getCurve();if(N&&(y._time=N.getTimeOf(y._point))!=null)return y._setCurve(N),N}return this._curve||w(this._segment)||w(this._segment1)||w(this._segment2.getPrevious())},getPath:function(){var u=this.getCurve();return u&&u._path},getIndex:function(){var u=this.getCurve();return u&&u.getIndex()},getTime:function(){var u=this.getCurve(),y=this._time;return u&&y==null?this._time=u.getTimeOf(this._point):y},getParameter:"#getTime",getPoint:function(){return this._point},getOffset:function(){var u=this._offset;if(u==null){u=0;var y=this.getPath(),w=this.getIndex();if(y&&w!=null)for(var D=y.getCurves(),N=0;N<w;N++)u+=D[N].getLength();this._offset=u+=this.getCurveOffset()}return u},getCurveOffset:function(){var u=this._curveOffset;if(u==null){var y=this.getCurve(),w=this.getTime();this._curveOffset=u=w!=null&&y&&y.getPartLength(0,w)}return u},getIntersection:function(){return this._intersection},getDistance:function(){return this._distance},divide:function(){var u=this.getCurve(),y=u&&u.divideAtTime(this.getTime());return y&&this._setSegment(y._segment1),y},split:function(){var u=this.getCurve(),y=u._path,w=u&&u.splitAtTime(this.getTime());return w&&this._setSegment(y.getLastSegment()),w},equals:function(u,y){var w=this===u;if(!w&&u instanceof Et){var D=this.getCurve(),N=u.getCurve(),U=D._path,te=N._path;if(U===te){var J=Math.abs,ie=1e-7,ae=J(this.getOffset()-u.getOffset()),ve=!y&&this._intersection,Se=!y&&u._intersection;w=(ae<ie||U&&J(U.getLength()-ae)<ie)&&(!ve&&!Se||ve&&Se&&ve.equals(Se,!0))}}return w},toString:function(){var u=[],y=this.getPoint(),w=A.instance;y&&u.push("point: "+y);var D=this.getIndex();D!=null&&u.push("index: "+D);var N=this.getTime();return N!=null&&u.push("time: "+w.number(N)),this._distance!=null&&u.push("distance: "+w.number(this._distance)),"{ "+u.join(", ")+" }"},isTouching:function(){var u=this._intersection;if(u&&this.getTangent().isCollinear(u.getTangent())){var y=this.getCurve(),w=u.getCurve();return!(y.isStraight()&&w.isStraight()&&y.getLine().intersect(w.getLine()))}return!1},isCrossing:function(){var u=this._intersection;if(!u)return!1;var y=this.getTime(),w=u.getTime(),D=1e-8,N=1-D,U=y>=D&&y<=N,te=w>=D&&w<=N;if(U&&te)return!this.isTouching();var J=this.getCurve(),ie=J&&y<D?J.getPrevious():J,ae=u.getCurve(),ve=ae&&w<D?ae.getPrevious():ae;if(y>N&&(J=J.getNext()),w>N&&(ae=ae.getNext()),!ie||!J||!ve||!ae)return!1;var Se=[];function be(je,Ze){var tt=je.getValues(),ut=Je.classify(tt).roots||Je.getPeaks(tt),nt=ut.length,pt=Je.getLength(tt,Ze&&nt?ut[nt-1]:0,!Ze&&nt?ut[0]:1);Se.push(nt?pt:pt/32)}function ge(je,Ze,tt){return Ze<tt?je>Ze&&je<tt:je>Ze||je<tt}U||(be(ie,!0),be(J,!1)),te||(be(ve,!0),be(ae,!1));var Ce=this.getPoint(),Ne=Math.min.apply(Math,Se),qe=U?J.getTangentAtTime(y):J.getPointAt(Ne).subtract(Ce),Ae=U?qe.negate():ie.getPointAt(-Ne).subtract(Ce),ke=te?ae.getTangentAtTime(w):ae.getPointAt(Ne).subtract(Ce),me=te?ke.negate():ve.getPointAt(-Ne).subtract(Ce),Te=Ae.getAngle(),Re=qe.getAngle(),Fe=me.getAngle(),Ye=ke.getAngle();return!!(U?ge(Te,Fe,Ye)^ge(Re,Fe,Ye)&&ge(Te,Ye,Fe)^ge(Re,Ye,Fe):ge(Fe,Te,Re)^ge(Ye,Te,Re)&&ge(Fe,Re,Te)^ge(Ye,Re,Te))},hasOverlap:function(){return!!this._overlap}},n.each(Je._evaluateMethods,function(u){var y=u+"At";this[u]=function(){var w=this.getCurve(),D=this.getTime();return D!=null&&w&&w[y](D,!0)}},{preserve:!0}),new function(){function u(y,w,D){var N=y.length,U=0,te=N-1;function J(Ce,Ne){for(var qe=Ce+Ne;qe>=-1&&qe<=N;qe+=Ne){var Ae=y[(qe%N+N)%N];if(!w.getPoint().isClose(Ae.getPoint(),1e-7))break;if(w.equals(Ae))return Ae}return null}for(;U<=te;){var ie=U+te>>>1,ae=y[ie],ve;if(D&&(ve=w.equals(ae)?ae:J(ie,-1)||J(ie,1)))return w._overlap&&(ve._overlap=ve._intersection._overlap=!0),ve;var Se=w.getPath(),be=ae.getPath(),ge=Se!==be?Se._id-be._id:w.getIndex()+w.getTime()-(ae.getIndex()+ae.getTime());ge<0?te=ie-1:U=ie+1}return y.splice(U,0,w),w}return{statics:{insert:u,expand:function(y){for(var w=y.slice(),D=y.length-1;D>=0;D--)u(w,y[D]._intersection,!1);return w}}}}),ht=ye.extend({_class:"PathItem",_selectBounds:!1,_canScaleStroke:!0,beans:!0,initialize:function(){},statics:{create:function(u){var y,w,D;if(n.isPlainObject(u)?(w=u.segments,y=u.pathData):Array.isArray(u)?w=u:typeof u=="string"&&(y=u),w){var N=w[0];D=N&&Array.isArray(N[0])}else y&&(D=(y.match(/m/gi)||[]).length>1||/z\s*\S+/i.test(y));var U=D?Nt:mt;return new U(u)}},_asPathItem:function(){return this},isClockwise:function(){return this.getArea()>=0},setClockwise:function(u){this.isClockwise()!=(u=!!u)&&this.reverse()},setPathData:function(u){var y=u&&u.match(/[mlhvcsqtaz][^mlhvcsqtaz]*/ig),w,D=!1,N,U,te=new I,J=new I;function ie(me,Te){var Re=+w[me];return D&&(Re+=te[Te]),Re}function ae(me){return new I(ie(me,"x"),ie(me+1,"y"))}this.clear();for(var ve=0,Se=y&&y.length;ve<Se;ve++){var be=y[ve],ge=be[0],Ce=ge.toLowerCase();w=be.match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g);var Ne=w&&w.length;switch(D=ge===Ce,N==="z"&&!/[mz]/.test(Ce)&&this.moveTo(te),Ce){case"m":case"l":for(var qe=Ce==="m",Ae=0;Ae<Ne;Ae+=2)this[qe?"moveTo":"lineTo"](te=ae(Ae)),qe&&(J=te,qe=!1);U=te;break;case"h":case"v":var ke=Ce==="h"?"x":"y";te=te.clone();for(var Ae=0;Ae<Ne;Ae++)te[ke]=ie(Ae,ke),this.lineTo(te);U=te;break;case"c":for(var Ae=0;Ae<Ne;Ae+=6)this.cubicCurveTo(ae(Ae),U=ae(Ae+2),te=ae(Ae+4));break;case"s":for(var Ae=0;Ae<Ne;Ae+=4)this.cubicCurveTo(/[cs]/.test(N)?te.multiply(2).subtract(U):te,U=ae(Ae),te=ae(Ae+2)),N=Ce;break;case"q":for(var Ae=0;Ae<Ne;Ae+=4)this.quadraticCurveTo(U=ae(Ae),te=ae(Ae+2));break;case"t":for(var Ae=0;Ae<Ne;Ae+=2)this.quadraticCurveTo(U=/[qt]/.test(N)?te.multiply(2).subtract(U):te,te=ae(Ae)),N=Ce;break;case"a":for(var Ae=0;Ae<Ne;Ae+=7)this.arcTo(te=ae(Ae+5),new L(+w[Ae],+w[Ae+1]),+w[Ae+2],+w[Ae+4],+w[Ae+3]);break;case"z":this.closePath(1e-12),te=J;break}N=Ce}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_contains:function(u){var y=u.isInside(this.getBounds({internal:!0,handle:!0}))?this._getWinding(u):{};return y.onPath||!!(this.getFillRule()==="evenodd"?y.windingL&1||y.windingR&1:y.winding)},getIntersections:function(u,y,w,D){var N=this===u||!u,U=this._matrix._orNullIfIdentity(),te=N?U:(w||u._matrix)._orNullIfIdentity();return N||this.getBounds(U).intersects(u.getBounds(te),1e-12)?Je.getIntersections(this.getCurves(),!N&&u.getCurves(),y,U,te,D):[]},getCrossings:function(u){return this.getIntersections(u,function(y){return y.isCrossing()})},getNearestLocation:function(){for(var u=I.read(arguments),y=this.getCurves(),w=1/0,D=null,N=0,U=y.length;N<U;N++){var te=y[N].getNearestLocation(u);te._distance<w&&(w=te._distance,D=te)}return D},getNearestPoint:function(){var u=this.getNearestLocation.apply(this,arguments);return u&&u.getPoint()},interpolate:function(u,y,w){var D=!this._children,N=D?"_segments":"_children",U=u[N],te=y[N],J=this[N];if(!U||!te||U.length!==te.length)throw new Error("Invalid operands in interpolate() call: "+u+", "+y);var ie=J.length,ae=te.length;if(ie<ae)for(var ve=D?Ct:mt,Se=ie;Se<ae;Se++)this.add(new ve);else ie>ae&&this[D?"removeSegments":"removeChildren"](ae,ie);for(var Se=0;Se<ae;Se++)J[Se].interpolate(U[Se],te[Se],w);D&&(this.setClosed(u._closed),this._changed(9))},compare:function(u){var y=!1;if(u){var w=this._children||[this],D=u._children?u._children.slice():[u],N=w.length,U=D.length,te=[],J=0;y=!0;for(var ie=d.findItemBoundsCollisions(w,D,S.GEOMETRIC_EPSILON),ae=N-1;ae>=0&&y;ae--){var ve=w[ae];y=!1;var Se=ie[ae];if(Se)for(var be=Se.length-1;be>=0&&!y;be--)ve.compare(D[Se[be]])&&(te[Se[be]]||(te[Se[be]]=!0,J++),y=!0)}y=y&&J===U}return y}}),mt=ht.extend({_class:"Path",_serializeFields:{segments:[],closed:!1},initialize:function(y){this._closed=!1,this._segments=[],this._version=0;var w=arguments,D=Array.isArray(y)?typeof y[0]=="object"?y:w:y&&y.size===s&&(y.x!==s||y.point!==s)?w:null;D&&D.length>0?this.setSegments(D):(this._curves=s,this._segmentSelection=0,!D&&typeof y=="string"&&(this.setPathData(y),y=null)),this._initialize(!D&&y)},_equals:function(u){return this._closed===u._closed&&n.equals(this._segments,u._segments)},copyContent:function(u){this.setSegments(u._segments),this._closed=u._closed},_changed:function u(y){if(u.base.call(this,y),y&8){if(this._length=this._area=s,y&32)this._version++;else if(this._curves)for(var w=0,D=this._curves.length;w<D;w++)this._curves[w]._changed()}else y&64&&(this._bounds=s)},getStyle:function(){var u=this._parent;return(u instanceof Nt?u:this)._style},getSegments:function(){return this._segments},setSegments:function(u){var y=this.isFullySelected(),w=u&&u.length;if(this._segments.length=0,this._segmentSelection=0,this._curves=s,w){var D=u[w-1];typeof D=="boolean"&&(this.setClosed(D),w--),this._add(Ct.readList(u,0,{},w))}y&&this.setFullySelected(!0)},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var u=this._curves,y=this._segments;if(!u){var w=this._countCurves();u=this._curves=new Array(w);for(var D=0;D<w;D++)u[D]=new Je(this,y[D],y[D+1]||y[0])}return u},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var u=this.getCurves();return u[u.length-1]},isClosed:function(){return this._closed},setClosed:function(u){if(this._closed!=(u=!!u)){if(this._closed=u,this._curves){var y=this._curves.length=this._countCurves();u&&(this._curves[y-1]=new Je(this,this._segments[y-1],this._segments[0]))}this._changed(41)}}},{beans:!0,getPathData:function(u,y){var w=this._segments,D=w.length,N=new A(y),U=new Array(6),te=!0,J,ie,ae,ve,Se,be,ge,Ce,Ne=[];function qe(ke,me){if(ke._transformCoordinates(u,U),J=U[0],ie=U[1],te)Ne.push("M"+N.pair(J,ie)),te=!1;else if(Se=U[2],be=U[3],Se===J&&be===ie&&ge===ae&&Ce===ve){if(!me){var Te=J-ae,Re=ie-ve;Ne.push(Te===0?"v"+N.number(Re):Re===0?"h"+N.number(Te):"l"+N.pair(Te,Re))}}else Ne.push("c"+N.pair(ge-ae,Ce-ve)+" "+N.pair(Se-ae,be-ve)+" "+N.pair(J-ae,ie-ve));ae=J,ve=ie,ge=U[4],Ce=U[5]}if(!D)return"";for(var Ae=0;Ae<D;Ae++)qe(w[Ae]);return this._closed&&D>0&&(qe(w[0],!0),Ne.push("z")),Ne.join("")},isEmpty:function(){return!this._segments.length},_transformContent:function(u){for(var y=this._segments,w=new Array(6),D=0,N=y.length;D<N;D++)y[D]._transformCoordinates(u,w,!0);return!0},_add:function(u,te){for(var w=this._segments,D=this._curves,N=u.length,U=te==null,te=U?w.length:te,J=0;J<N;J++){var ie=u[J];ie._path&&(ie=u[J]=ie.clone()),ie._path=this,ie._index=te+J,ie._selection&&this._updateSelection(ie,0,ie._selection)}if(U)n.push(w,u);else{w.splice.apply(w,[te,0].concat(u));for(var J=te+N,ae=w.length;J<ae;J++)w[J]._index=J}if(D){var ve=this._countCurves(),Se=te>0&&te+N-1===ve?te-1:te,be=Se,ge=Math.min(Se+N,ve);u._curves&&(D.splice.apply(D,[Se,0].concat(u._curves)),be+=u._curves.length);for(var J=be;J<ge;J++)D.splice(J,0,new Je(this,null,null));this._adjustCurves(Se,ge)}return this._changed(41),u},_adjustCurves:function(u,y){for(var w=this._segments,D=this._curves,N,U=u;U<y;U++)N=D[U],N._path=this,N._segment1=w[U],N._segment2=w[U+1]||w[0],N._changed();(N=D[this._closed&&!u?w.length-1:u-1])&&(N._segment2=w[u]||w[0],N._changed()),(N=D[y])&&(N._segment1=w[y],N._changed())},_countCurves:function(){var u=this._segments.length;return!this._closed&&u>0?u-1:u},add:function(u){var y=arguments;return y.length>1&&typeof u!="number"?this._add(Ct.readList(y)):this._add([Ct.read(y)])[0]},insert:function(u,y){var w=arguments;return w.length>2&&typeof y!="number"?this._add(Ct.readList(w,1),u):this._add([Ct.read(w,1)],u)[0]},addSegment:function(){return this._add([Ct.read(arguments)])[0]},insertSegment:function(u){return this._add([Ct.read(arguments,1)],u)[0]},addSegments:function(u){return this._add(Ct.readList(u))},insertSegments:function(u,y){return this._add(Ct.readList(y),u)},removeSegment:function(u){return this.removeSegments(u,u+1)[0]||null},removeSegments:function(u,y,w){u=u||0,y=n.pick(y,this._segments.length);var D=this._segments,N=this._curves,U=D.length,te=D.splice(u,y-u),J=te.length;if(!J)return te;for(var ie=0;ie<J;ie++){var ae=te[ie];ae._selection&&this._updateSelection(ae,ae._selection,0),ae._index=ae._path=null}for(var ie=u,ve=D.length;ie<ve;ie++)D[ie]._index=ie;if(N){for(var Se=u>0&&y===U+(this._closed?1:0)?u-1:u,N=N.splice(Se,J),ie=N.length-1;ie>=0;ie--)N[ie]._path=null;w&&(te._curves=N.slice(1)),this._adjustCurves(Se,Se)}return this._changed(41),te},clear:"#removeSegments",hasHandles:function(){for(var u=this._segments,y=0,w=u.length;y<w;y++)if(u[y].hasHandles())return!0;return!1},clearHandles:function(){for(var u=this._segments,y=0,w=u.length;y<w;y++)u[y].clearHandles()},getLength:function(){if(this._length==null){for(var u=this.getCurves(),y=0,w=0,D=u.length;w<D;w++)y+=u[w].getLength();this._length=y}return this._length},getArea:function(){var u=this._area;if(u==null){var y=this._segments,w=this._closed;u=0;for(var D=0,N=y.length;D<N;D++){var U=D+1===N;u+=Je.getArea(Je.getValues(y[D],y[U?0:D+1],null,U&&!w))}this._area=u}return u},isFullySelected:function(){var u=this._segments.length;return this.isSelected()&&u>0&&this._segmentSelection===u*7},setFullySelected:function(u){u&&this._selectSegments(!0),this.setSelected(u)},setSelection:function u(y){y&1||this._selectSegments(!1),u.base.call(this,y)},_selectSegments:function(u){var y=this._segments,w=y.length,D=u?7:0;this._segmentSelection=D*w;for(var N=0;N<w;N++)y[N]._selection=D},_updateSelection:function(u,y,w){u._selection=w;var D=this._segmentSelection+=w-y;D>0&&this.setSelected(!0)},divideAt:function(u){var y=this.getLocationAt(u),w;return y&&(w=y.getCurve().divideAt(y.getCurveOffset()))?w._segment1:null},splitAt:function(u){var y=this.getLocationAt(u),w=y&&y.index,D=y&&y.time,N=1e-8,U=1-N;D>U&&(w++,D=0);var te=this.getCurves();if(w>=0&&w<te.length){D>=N&&te[w++].divideAtTime(D);var J=this.removeSegments(w,this._segments.length,!0),ie;return this._closed?(this.setClosed(!1),ie=this):(ie=new mt(ye.NO_INSERT),ie.insertAbove(this),ie.copyAttributes(this)),ie._add(J,0),this.addSegment(J[0]),ie}return null},split:function(u,y){var w,D=y===s?u:(w=this.getCurves()[u])&&w.getLocationAtTime(y);return D!=null?this.splitAt(D):null},join:function(u,y){var w=y||0;if(u&&u!==this){var D=u._segments,N=this.getLastSegment(),U=u.getLastSegment();if(!U)return this;N&&N._point.isClose(U._point,w)&&u.reverse();var te=u.getFirstSegment();if(N&&N._point.isClose(te._point,w))N.setHandleOut(te._handleOut),this._add(D.slice(1));else{var J=this.getFirstSegment();J&&J._point.isClose(te._point,w)&&u.reverse(),U=u.getLastSegment(),J&&J._point.isClose(U._point,w)?(J.setHandleIn(U._handleIn),this._add(D.slice(0,D.length-1),0)):this._add(D.slice())}u._closed&&this._add([D[0]]),u.remove()}var ie=this.getFirstSegment(),ae=this.getLastSegment();return ie!==ae&&ie._point.isClose(ae._point,w)&&(ie.setHandleIn(ae._handleIn),ae.remove(),this.setClosed(!0)),this},reduce:function(u){for(var y=this.getCurves(),w=u&&u.simplify,D=w?1e-7:0,N=y.length-1;N>=0;N--){var U=y[N];!U.hasHandles()&&(!U.hasLength(D)||w&&U.isCollinear(U.getNext()))&&U.remove()}return this},reverse:function(){this._segments.reverse();for(var u=0,y=this._segments.length;u<y;u++){var w=this._segments[u],D=w._handleIn;w._handleIn=w._handleOut,w._handleOut=D,w._index=u}this._curves=null,this._changed(9)},flatten:function(u){for(var y=new Gt(this,u||.25,256,!0),w=y.parts,D=w.length,N=[],U=0;U<D;U++)N.push(new Ct(w[U].curve.slice(0,2)));!this._closed&&D>0&&N.push(new Ct(w[D-1].curve.slice(6))),this.setSegments(N)},simplify:function(u){var y=new Mt(this).fit(u||2.5);return y&&this.setSegments(y),!!y},smooth:function(u){var y=this,w=u||{},D=w.type||"asymmetric",N=this._segments,U=N.length,te=this._closed;function J(Oi,ds){var Lt=Oi&&Oi.index;if(Lt!=null){var Qi=Oi.path;if(Qi&&Qi!==y)throw new Error(Oi._class+" "+Lt+" of "+Qi+" is not part of "+y);ds&&Oi instanceof Je&&Lt++}else Lt=typeof Oi=="number"?Oi:ds;return Math.min(Lt<0&&te?Lt%U:Lt<0?Lt+U:Lt,U-1)}var ie=te&&w.from===s&&w.to===s,ae=J(w.from,0),ve=J(w.to,U-1);if(ae>ve)if(te)ae-=U;else{var Se=ae;ae=ve,ve=Se}if(/^(?:asymmetric|continuous)$/.test(D)){var be=D==="asymmetric",ge=Math.min,Ce=ve-ae+1,Ne=Ce-1,qe=ie?ge(Ce,4):1,Ae=qe,ke=qe,me=[];if(te||(Ae=ge(1,ae),ke=ge(1,U-ve-1)),Ne+=Ae+ke,Ne<=1)return;for(var Te=0,Re=ae-Ae;Te<=Ne;Te++,Re++)me[Te]=N[(Re<0?Re+U:Re)%U]._point;for(var Fe=me[0]._x+2*me[1]._x,Ye=me[0]._y+2*me[1]._y,je=2,Ze=Ne-1,tt=[Fe],ut=[Ye],nt=[je],pt=[],ft=[],Te=1;Te<Ne;Te++){var wt=Te<Ze,Tt=wt||be?1:2,Vt=wt?4:be?2:7,ni=wt?4:be?3:8,ai=wt?2:be?0:1,Ht=Tt/je;je=nt[Te]=Vt-Ht,Fe=tt[Te]=ni*me[Te]._x+ai*me[Te+1]._x-Ht*Fe,Ye=ut[Te]=ni*me[Te]._y+ai*me[Te+1]._y-Ht*Ye}pt[Ze]=tt[Ze]/nt[Ze],ft[Ze]=ut[Ze]/nt[Ze];for(var Te=Ne-2;Te>=0;Te--)pt[Te]=(tt[Te]-pt[Te+1])/nt[Te],ft[Te]=(ut[Te]-ft[Te+1])/nt[Te];pt[Ne]=(3*me[Ne]._x-pt[Ze])/2,ft[Ne]=(3*me[Ne]._y-ft[Ze])/2;for(var Te=Ae,Ci=Ne-ke,Re=ae;Te<=Ci;Te++,Re++){var Ti=N[Re<0?Re+U:Re],Pi=Ti._point,wi=pt[Te]-Pi._x,Qt=ft[Te]-Pi._y;(ie||Te<Ci)&&Ti.setHandleOut(wi,Qt),(ie||Te>Ae)&&Ti.setHandleIn(-wi,-Qt)}}else for(var Te=ae;Te<=ve;Te++)N[Te<0?Te+U:Te].smooth(w,!ie&&Te===ae,!ie&&Te===ve)},toShape:function(u){if(!this._closed)return null;var y=this._segments,w,D,N,U;function te(be,ge){var Ce=y[be],Ne=Ce.getNext(),qe=y[ge],Ae=qe.getNext();return Ce._handleOut.isZero()&&Ne._handleIn.isZero()&&qe._handleOut.isZero()&&Ae._handleIn.isZero()&&Ne._point.subtract(Ce._point).isCollinear(Ae._point.subtract(qe._point))}function J(be){var ge=y[be],Ce=ge.getPrevious(),Ne=ge.getNext();return Ce._handleOut.isZero()&&ge._handleIn.isZero()&&ge._handleOut.isZero()&&Ne._handleIn.isZero()&&ge._point.subtract(Ce._point).isOrthogonal(Ne._point.subtract(ge._point))}function ie(be){var ge=y[be],Ce=ge.getNext(),Ne=ge._handleOut,qe=Ce._handleIn,Ae=.5522847498307936;if(Ne.isOrthogonal(qe)){var ke=ge._point,me=Ce._point,Te=new de(ke,Ne,!0).intersect(new de(me,qe,!0),!0);return Te&&S.isZero(Ne.getLength()/Te.subtract(ke).getLength()-Ae)&&S.isZero(qe.getLength()/Te.subtract(me).getLength()-Ae)}return!1}function ae(be,ge){return y[be]._point.getDistance(y[ge]._point)}if(!this.hasHandles()&&y.length===4&&te(0,2)&&te(1,3)&&J(1)?(w=Z.Rectangle,D=new L(ae(0,3),ae(0,1)),U=y[1]._point.add(y[2]._point).divide(2)):y.length===8&&ie(0)&&ie(2)&&ie(4)&&ie(6)&&te(1,5)&&te(3,7)?(w=Z.Rectangle,D=new L(ae(1,6),ae(0,3)),N=D.subtract(new L(ae(0,7),ae(1,2))).divide(2),U=y[3]._point.add(y[4]._point).divide(2)):y.length===4&&ie(0)&&ie(1)&&ie(2)&&ie(3)&&(S.isZero(ae(0,2)-ae(1,3))?(w=Z.Circle,N=ae(0,2)/2):(w=Z.Ellipse,N=new L(ae(2,0)/2,ae(3,1)/2)),U=y[1]._point),w){var ve=this.getPosition(!0),Se=new w({center:ve,size:D,radius:N,insert:!1});return Se.copyAttributes(this,!0),Se._matrix.prepend(this._matrix),Se.rotate(U.subtract(ve).getAngle()+90),(u===s||u)&&Se.insertAbove(this),Se}return null},toPath:"#clone",compare:function u(y){if(!y||y instanceof Nt)return u.base.call(this,y);var w=this.getCurves(),D=y.getCurves(),N=w.length,U=D.length;if(!N||!U)return N==U;for(var te=w[0].getValues(),J=[],ie=0,ae,ve=0,Se,be=0;be<U;be++){var qe=D[be].getValues();J.push(qe);var ge=Je.getOverlaps(te,qe);if(ge){ae=!be&&ge[0][0]>0?U-1:be,Se=ge[0][1];break}}for(var Ce=Math.abs,Ne=1e-8,qe=J[ae],Ae;te&&qe;){var ge=Je.getOverlaps(te,qe);if(ge){var ke=ge[0][0];if(Ce(ke-ve)<Ne){ve=ge[1][0],ve===1&&(te=++ie<N?w[ie].getValues():null,ve=0);var me=ge[0][1];if(Ce(me-Se)<Ne){if(Ae||(Ae=[ae,me]),Se=ge[1][1],Se===1&&(++ae>=U&&(ae=0),qe=J[ae]||D[ae].getValues(),Se=0),!te)return Ae[0]===ae&&Ae[1]===Se;continue}}}break}return!1},_hitTestSelf:function(u,y,w,D){var N=this,U=this.getStyle(),te=this._segments,J=te.length,ie=this._closed,ae=y._tolerancePadding,ve=ae,Se,be,ge,Ce,Ne,qe,Ae=y.stroke&&U.hasStroke(),ke=y.fill&&U.hasFill(),me=y.curves,Te=Ae?U.getStrokeWidth()/2:ke&&y.tolerance>0||me?0:null;Te!==null&&(Te>0?(Se=U.getStrokeJoin(),be=U.getStrokeCap(),ge=U.getMiterLimit(),ve=ve.add(mt._getStrokePadding(Te,D))):Se=be="round");function Re(pt,ft){return u.subtract(pt).divide(ft).length<=1}function Fe(pt,ft,wt){if(!y.selected||ft.isSelected()){var Tt=pt._point;if(ft!==Tt&&(ft=ft.add(Tt)),Re(ft,ve))return new xe(wt,N,{segment:pt,point:ft})}}function Ye(pt,ft){return(ft||y.segments)&&Fe(pt,pt._point,"segment")||!ft&&y.handles&&(Fe(pt,pt._handleIn,"handle-in")||Fe(pt,pt._handleOut,"handle-out"))}function je(pt){Ce.add(pt)}function Ze(pt){var ft=ie||pt._index>0&&pt._index<J-1;if((ft?Se:be)==="round")return Re(pt._point,ve);if(Ce=new mt({internal:!0,closed:!0}),ft?pt.isSmooth()||mt._addBevelJoin(pt,Se,Te,ge,null,D,je,!0):be==="square"&&mt._addSquareCap(pt,be,Te,null,D,je,!0),!Ce.isEmpty()){var wt;return Ce.contains(u)||(wt=Ce.getNearestLocation(u))&&Re(wt.getPoint(),ae)}}if(y.ends&&!y.segments&&!ie){if(qe=Ye(te[0],!0)||Ye(te[J-1],!0))return qe}else if(y.segments||y.handles){for(var tt=0;tt<J;tt++)if(qe=Ye(te[tt]))return qe}if(Te!==null){if(Ne=this.getNearestLocation(u),Ne){var ut=Ne.getTime();ut===0||ut===1&&J>1?Ze(Ne.getSegment())||(Ne=null):Re(Ne.getPoint(),ve)||(Ne=null)}if(!Ne&&Se==="miter"&&J>1)for(var tt=0;tt<J;tt++){var nt=te[tt];if(u.getDistance(nt._point)<=ge*Te&&Ze(nt)){Ne=nt.getLocation();break}}}return!Ne&&ke&&this._contains(u)||Ne&&!Ae&&!me?new xe("fill",this):Ne?new xe(Ae?"stroke":"curve",this,{location:Ne,point:Ne.getPoint()}):null}},n.each(Je._evaluateMethods,function(u){this[u+"At"]=function(y){var w=this.getLocationAt(y);return w&&w[u]()}},{beans:!1,getLocationOf:function(){for(var u=I.read(arguments),y=this.getCurves(),w=0,D=y.length;w<D;w++){var N=y[w].getLocationOf(u);if(N)return N}return null},getOffsetOf:function(){var u=this.getLocationOf.apply(this,arguments);return u?u.getOffset():null},getLocationAt:function(u){if(typeof u=="number"){for(var y=this.getCurves(),w=0,D=0,N=y.length;D<N;D++){var U=w,te=y[D];if(w+=te.getLength(),w>u)return te.getLocationAt(u-U)}if(y.length>0&&u<=this.getLength())return new Et(y[y.length-1],1)}else if(u&&u.getPath&&u.getPath()===this)return u;return null},getOffsetsWithTangent:function(){var u=I.read(arguments);if(u.isZero())return[];for(var y=[],w=0,D=this.getCurves(),N=0,U=D.length;N<U;N++){for(var te=D[N],J=te.getTimesWithTangent(u),ie=0,ae=J.length;ie<ae;ie++){var ve=w+te.getOffsetAtTime(J[ie]);y.indexOf(ve)<0&&y.push(ve)}w+=te.length}return y}}),new function(){function u(w,D,N,U){if(U<=0)return;var te=U/2,J=U-2,ie=te-1,ae=new Array(6),ve,Se;function be(ke){var me=ae[ke],Te=ae[ke+1];(ve!=me||Se!=Te)&&(w.beginPath(),w.moveTo(ve,Se),w.lineTo(me,Te),w.stroke(),w.beginPath(),w.arc(me,Te,te,0,Math.PI*2,!0),w.fill())}for(var ge=0,Ce=D.length;ge<Ce;ge++){var Ne=D[ge],qe=Ne._selection;if(Ne._transformCoordinates(N,ae),ve=ae[0],Se=ae[1],qe&2&&be(2),qe&4&&be(4),w.fillRect(ve-te,Se-te,U,U),J>0&&!(qe&1)){var Ae=w.fillStyle;w.fillStyle="#ffffff",w.fillRect(ve-ie,Se-ie,J,J),w.fillStyle=Ae}}}function y(w,D,N){var U=D._segments,te=U.length,J=new Array(6),ie=!0,ae,ve,Se,be,ge,Ce,Ne,qe;function Ae(me){if(N)me._transformCoordinates(N,J),ae=J[0],ve=J[1];else{var Te=me._point;ae=Te._x,ve=Te._y}if(ie)w.moveTo(ae,ve),ie=!1;else{if(N)ge=J[2],Ce=J[3];else{var Re=me._handleIn;ge=ae+Re._x,Ce=ve+Re._y}ge===ae&&Ce===ve&&Ne===Se&&qe===be?w.lineTo(ae,ve):w.bezierCurveTo(Ne,qe,ge,Ce,ae,ve)}if(Se=ae,be=ve,N)Ne=J[4],qe=J[5];else{var Re=me._handleOut;Ne=Se+Re._x,qe=be+Re._y}}for(var ke=0;ke<te;ke++)Ae(U[ke]);D._closed&&te>0&&Ae(U[0])}return{_draw:function(w,D,N,U){var te=D.dontStart,J=D.dontFinish||D.clip,ie=this.getStyle(),ae=ie.hasFill(),ve=ie.hasStroke(),Se=ie.getDashArray(),be=!yt.support.nativeDash&&ve&&Se&&Se.length;te||w.beginPath(),(ae||ve&&!be||J)&&(y(w,this,U),this._closed&&w.closePath());function ge(me){return Se[(me%be+be)%be]}if(!J&&(ae||ve)&&(this._setStyles(w,D,N),ae&&(w.fill(ie.getFillRule()),w.shadowColor="rgba(0,0,0,0)"),ve)){if(be){te||w.beginPath();for(var Ce=new Gt(this,.25,32,!1,U),Ne=Ce.length,qe=-ie.getDashOffset(),Ae,ke=0;qe>0;)qe-=ge(ke--)+ge(ke--);for(;qe<Ne;)Ae=qe+ge(ke++),(qe>0||Ae>0)&&Ce.drawPart(w,Math.max(qe,0),Math.max(Ae,0)),qe=Ae+ge(ke++)}w.stroke()}},_drawSelected:function(w,D){w.beginPath(),y(w,this,D),w.stroke(),u(w,this._segments,D,yt.settings.handleSize)}}},new function(){function u(y){var w=y._segments;if(!w.length)throw new Error("Use a moveTo() command first");return w[w.length-1]}return{moveTo:function(){var y=this._segments;y.length===1&&this.removeSegment(0),y.length||this._add([new Ct(I.read(arguments))])},moveBy:function(){throw new Error("moveBy() is unsupported on Path items.")},lineTo:function(){this._add([new Ct(I.read(arguments))])},cubicCurveTo:function(){var y=arguments,w=I.read(y),D=I.read(y),N=I.read(y),U=u(this);U.setHandleOut(w.subtract(U._point)),this._add([new Ct(N,D.subtract(N))])},quadraticCurveTo:function(){var y=arguments,w=I.read(y),D=I.read(y),N=u(this)._point;this.cubicCurveTo(w.add(N.subtract(w).multiply(1/3)),w.add(D.subtract(w).multiply(1/3)),D)},curveTo:function(){var y=arguments,w=I.read(y),D=I.read(y),N=n.pick(n.read(y),.5),U=1-N,te=u(this)._point,J=w.subtract(te.multiply(U*U)).subtract(D.multiply(N*N)).divide(2*N*U);if(J.isNaN())throw new Error("Cannot put a curve through points with parameter = "+N);this.quadraticCurveTo(J,D)},arcTo:function(){var y=arguments,w=Math.abs,D=Math.sqrt,N=u(this),U=N._point,te=I.read(y),J,ie=n.peek(y),ae=n.pick(ie,!0),ve,Se,be,ge;if(typeof ae=="boolean")var Ce=U.add(te).divide(2),J=Ce.add(Ce.subtract(U).rotate(ae?-90:90));else if(n.remain(y)<=2)J=te,te=I.read(y);else if(!U.equals(te)){var Ne=L.read(y),qe=S.isZero;if(qe(Ne.width)||qe(Ne.height))return this.lineTo(te);var Ae=n.read(y),ae=!!n.read(y),ke=!!n.read(y),Ce=U.add(te).divide(2),me=U.subtract(Ce).rotate(-Ae),Te=me.x,Re=me.y,Fe=w(Ne.width),Ye=w(Ne.height),je=Fe*Fe,Ze=Ye*Ye,tt=Te*Te,ut=Re*Re,nt=D(tt/je+ut/Ze);if(nt>1&&(Fe*=nt,Ye*=nt,je=Fe*Fe,Ze=Ye*Ye),nt=(je*Ze-je*ut-Ze*tt)/(je*ut+Ze*tt),w(nt)<1e-12&&(nt=0),nt<0)throw new Error("Cannot create an arc with the given arguments");ve=new I(Fe*Re/Ye,-Ye*Te/Fe).multiply((ke===ae?-1:1)*D(nt)).rotate(Ae).add(Ce),ge=new pe().translate(ve).rotate(Ae).scale(Fe,Ye),be=ge._inverseTransform(U),Se=be.getDirectedAngle(ge._inverseTransform(te)),!ae&&Se>0?Se-=360:ae&&Se<0&&(Se+=360)}if(J){var pt=new de(U.add(J).divide(2),J.subtract(U).rotate(90),!0),ft=new de(J.add(te).divide(2),te.subtract(J).rotate(90),!0),wt=new de(U,te),Tt=wt.getSide(J);if(ve=pt.intersect(ft,!0),!ve){if(!Tt)return this.lineTo(te);throw new Error("Cannot create an arc with the given arguments")}be=U.subtract(ve),Se=be.getDirectedAngle(te.subtract(ve));var Vt=wt.getSide(ve,!0);Vt===0?Se=Tt*w(Se):Tt===Vt&&(Se+=Se<0?360:-360)}if(Se){for(var ni=1e-5,ai=w(Se),Ht=ai>=360?4:Math.ceil((ai-ni)/90),Ci=Se/Ht,Ti=Ci*Math.PI/360,Pi=4/3*Math.sin(Ti)/(1+Math.cos(Ti)),wi=[],Qt=0;Qt<=Ht;Qt++){var me=te,Oi=null;if(Qt<Ht&&(Oi=be.rotate(90).multiply(Pi),ge?(me=ge._transformPoint(be),Oi=ge._transformPoint(be.add(Oi)).subtract(me)):me=ve.add(be)),!Qt)N.setHandleOut(Oi);else{var ds=be.rotate(-90).multiply(Pi);ge&&(ds=ge._transformPoint(be.add(ds)).subtract(me)),wi.push(new Ct(me,ds,Oi))}be=be.rotate(Ci)}this._add(wi)}},lineBy:function(){var y=I.read(arguments),w=u(this)._point;this.lineTo(w.add(y))},curveBy:function(){var y=arguments,w=I.read(y),D=I.read(y),N=n.read(y),U=u(this)._point;this.curveTo(U.add(w),U.add(D),N)},cubicCurveBy:function(){var y=arguments,w=I.read(y),D=I.read(y),N=I.read(y),U=u(this)._point;this.cubicCurveTo(U.add(w),U.add(D),U.add(N))},quadraticCurveBy:function(){var y=arguments,w=I.read(y),D=I.read(y),N=u(this)._point;this.quadraticCurveTo(N.add(w),N.add(D))},arcBy:function(){var y=arguments,w=u(this)._point,D=w.add(I.read(y)),N=n.pick(n.peek(y),!0);typeof N=="boolean"?this.arcTo(D,N):this.arcTo(D,w.add(I.read(y)))},closePath:function(y){this.setClosed(!0),this.join(this,y)}}},{_getBounds:function(u,y){var w=y.handle?"getHandleBounds":y.stroke?"getStrokeBounds":"getBounds";return mt[w](this._segments,this._closed,this,u,y)},statics:{getBounds:function(u,y,w,D,N,U){var te=u[0];if(!te)return new Y;var J=new Array(6),ie=te._transformCoordinates(D,new Array(6)),ae=ie.slice(0,2),ve=ae.slice(),Se=new Array(2);function be(Ne){Ne._transformCoordinates(D,J);for(var qe=0;qe<2;qe++)Je._addBounds(ie[qe],ie[qe+4],J[qe+2],J[qe],qe,U?U[qe]:0,ae,ve,Se);var Ae=ie;ie=J,J=Ae}for(var ge=1,Ce=u.length;ge<Ce;ge++)be(u[ge]);return y&&be(te),new Y(ae[0],ae[1],ve[0]-ae[0],ve[1]-ae[1])},getStrokeBounds:function(u,y,w,D,N){var U=w.getStyle(),te=U.hasStroke(),J=U.getStrokeWidth(),ie=te&&w._getStrokeMatrix(D,N),ae=te&&mt._getStrokePadding(J,ie),ve=mt.getBounds(u,y,w,D,N,ae);if(!te)return ve;var Se=J/2,be=U.getStrokeJoin(),ge=U.getStrokeCap(),Ce=U.getMiterLimit(),Ne=new Y(new L(ae));function qe(Fe){ve=ve.include(Fe)}function Ae(Fe){ve=ve.unite(Ne.setCenter(Fe._point.transform(D)))}function ke(Fe,Ye){Ye==="round"||Fe.isSmooth()?Ae(Fe):mt._addBevelJoin(Fe,Ye,Se,Ce,D,ie,qe)}function me(Fe,Ye){Ye==="round"?Ae(Fe):mt._addSquareCap(Fe,Ye,Se,D,ie,qe)}var Te=u.length-(y?0:1);if(Te>0){for(var Re=1;Re<Te;Re++)ke(u[Re],be);y?ke(u[0],be):(me(u[0],ge),me(u[u.length-1],ge))}return ve},_getStrokePadding:function(u,y){if(!y)return[u,u];var w=new I(u,0).transform(y),D=new I(0,u).transform(y),N=w.getAngleInRadians(),U=w.getLength(),te=D.getLength(),J=Math.sin(N),ie=Math.cos(N),ae=Math.tan(N),ve=Math.atan2(te*ae,U),Se=Math.atan2(te,ae*U);return[Math.abs(U*Math.cos(ve)*ie+te*Math.sin(ve)*J),Math.abs(te*Math.sin(Se)*ie+U*Math.cos(Se)*J)]},_addBevelJoin:function(u,y,w,D,N,U,te,J){var ie=u.getCurve(),ae=ie.getPrevious(),ve=ie.getPoint1().transform(N),Se=ae.getNormalAtTime(1).multiply(w).transform(U),be=ie.getNormalAtTime(0).multiply(w).transform(U),ge=Se.getDirectedAngle(be);if((ge<0||ge>=180)&&(Se=Se.negate(),be=be.negate()),J&&te(ve),te(ve.add(Se)),y==="miter"){var Ce=new de(ve.add(Se),new I(-Se.y,Se.x),!0).intersect(new de(ve.add(be),new I(-be.y,be.x),!0),!0);Ce&&ve.getDistance(Ce)<=D*w&&te(Ce)}te(ve.add(be))},_addSquareCap:function(u,y,w,D,N,U,te){var J=u._point.transform(D),ie=u.getLocation(),ae=ie.getNormal().multiply(ie.getTime()===0?w:-w).transform(N);y==="square"&&(te&&(U(J.subtract(ae)),U(J.add(ae))),J=J.add(ae.rotate(-90))),U(J.add(ae)),U(J.subtract(ae))},getHandleBounds:function(u,y,w,D,N){var U=w.getStyle(),te=N.stroke&&U.hasStroke(),J,ie;if(te){var ae=w._getStrokeMatrix(D,N),ve=U.getStrokeWidth()/2,Se=ve;U.getStrokeJoin()==="miter"&&(Se=ve*U.getMiterLimit()),U.getStrokeCap()==="square"&&(Se=Math.max(Se,ve*Math.SQRT2)),J=mt._getStrokePadding(ve,ae),ie=mt._getStrokePadding(Se,ae)}for(var be=new Array(6),ge=1/0,Ce=-ge,Ne=ge,qe=Ce,Ae=0,ke=u.length;Ae<ke;Ae++){var me=u[Ae];me._transformCoordinates(D,be);for(var Te=0;Te<6;Te+=2){var Re=Te?J:ie,Fe=Re?Re[0]:0,Ye=Re?Re[1]:0,je=be[Te],Ze=be[Te+1],tt=je-Fe,ut=je+Fe,nt=Ze-Ye,pt=Ze+Ye;tt<ge&&(ge=tt),ut>Ce&&(Ce=ut),nt<Ne&&(Ne=nt),pt>qe&&(qe=pt)}}return new Y(ge,Ne,Ce-ge,qe-Ne)}}});mt.inject({statics:new function(){var u=.5522847498307936,y=[new Ct([-1,0],[0,u],[0,-u]),new Ct([0,-1],[-u,0],[u,0]),new Ct([1,0],[0,-u],[0,u]),new Ct([0,1],[u,0],[-u,0])];function w(N,U,te){var J=n.getNamed(te),ie=new mt(J&&(J.insert==!0?ye.INSERT:J.insert==!1?ye.NO_INSERT:null));return ie._add(N),ie._closed=U,ie.set(J,ye.INSERT)}function D(N,U,te){for(var J=new Array(4),ie=0;ie<4;ie++){var ae=y[ie];J[ie]=new Ct(ae._point.multiply(U).add(N),ae._handleIn.multiply(U),ae._handleOut.multiply(U))}return w(J,!0,te)}return{Line:function(){var N=arguments;return w([new Ct(I.readNamed(N,"from")),new Ct(I.readNamed(N,"to"))],!1,N)},Circle:function(){var N=arguments,U=I.readNamed(N,"center"),te=n.readNamed(N,"radius");return D(U,new L(te),N)},Rectangle:function(){var N=arguments,U=Y.readNamed(N,"rectangle"),te=L.readNamed(N,"radius",0,{readNull:!0}),J=U.getBottomLeft(!0),ie=U.getTopLeft(!0),ae=U.getTopRight(!0),ve=U.getBottomRight(!0),Se;if(!te||te.isZero())Se=[new Ct(J),new Ct(ie),new Ct(ae),new Ct(ve)];else{te=L.min(te,U.getSize(!0).divide(2));var be=te.width,ge=te.height,Ce=be*u,Ne=ge*u;Se=[new Ct(J.add(be,0),null,[-Ce,0]),new Ct(J.subtract(0,ge),[0,Ne]),new Ct(ie.add(0,ge),null,[0,-Ne]),new Ct(ie.add(be,0),[-Ce,0],null),new Ct(ae.subtract(be,0),null,[Ce,0]),new Ct(ae.add(0,ge),[0,-Ne],null),new Ct(ve.subtract(0,ge),null,[0,Ne]),new Ct(ve.subtract(be,0),[Ce,0])]}return w(Se,!0,N)},RoundRectangle:"#Rectangle",Ellipse:function(){var N=arguments,U=Z._readEllipse(N);return D(U.center,U.radius,N)},Oval:"#Ellipse",Arc:function(){var N=arguments,U=I.readNamed(N,"from"),te=I.readNamed(N,"through"),J=I.readNamed(N,"to"),ie=n.getNamed(N),ae=new mt(ie&&ie.insert==!1&&ye.NO_INSERT);return ae.moveTo(U),ae.arcTo(te,J),ae.set(ie)},RegularPolygon:function(){for(var N=arguments,U=I.readNamed(N,"center"),te=n.readNamed(N,"sides"),J=n.readNamed(N,"radius"),ie=360/te,ae=te%3===0,ve=new I(0,ae?-J:J),Se=ae?-1:.5,be=new Array(te),ge=0;ge<te;ge++)be[ge]=new Ct(U.add(ve.rotate((ge+Se)*ie)));return w(be,!0,N)},Star:function(){for(var N=arguments,U=I.readNamed(N,"center"),te=n.readNamed(N,"points")*2,J=n.readNamed(N,"radius1"),ie=n.readNamed(N,"radius2"),ae=360/te,ve=new I(0,-1),Se=new Array(te),be=0;be<te;be++)Se[be]=new Ct(U.add(ve.rotate(ae*be).multiply(be%2?ie:J)));return w(Se,!0,N)}}}});var Nt=ht.extend({_class:"CompoundPath",_serializeFields:{children:[]},beans:!0,initialize:function(y){this._children=[],this._namedChildren={},this._initialize(y)||(typeof y=="string"?this.setPathData(y):this.addChildren(Array.isArray(y)?y:arguments))},insertChildren:function u(y,w){var D=w,N=D[0];N&&typeof N[0]=="number"&&(D=[D]);for(var U=w.length-1;U>=0;U--){var te=D[U];D===w&&!(te instanceof mt)&&(D=n.slice(D)),Array.isArray(te)?D[U]=new mt({segments:te,insert:!1}):te instanceof Nt&&(D.splice.apply(D,[U,1].concat(te.removeChildren())),te.remove())}return u.base.call(this,y,D)},reduce:function u(y){for(var w=this._children,D=w.length-1;D>=0;D--){var N=w[D].reduce(y);N.isEmpty()&&N.remove()}if(!w.length){var N=new mt(ye.NO_INSERT);return N.copyAttributes(this),N.insertAbove(this),this.remove(),N}return u.base.call(this)},isClosed:function(){for(var u=this._children,y=0,w=u.length;y<w;y++)if(!u[y]._closed)return!1;return!0},setClosed:function(u){for(var y=this._children,w=0,D=y.length;w<D;w++)y[w].setClosed(u)},getFirstSegment:function(){var u=this.getFirstChild();return u&&u.getFirstSegment()},getLastSegment:function(){var u=this.getLastChild();return u&&u.getLastSegment()},getCurves:function(){for(var u=this._children,y=[],w=0,D=u.length;w<D;w++)n.push(y,u[w].getCurves());return y},getFirstCurve:function(){var u=this.getFirstChild();return u&&u.getFirstCurve()},getLastCurve:function(){var u=this.getLastChild();return u&&u.getLastCurve()},getArea:function(){for(var u=this._children,y=0,w=0,D=u.length;w<D;w++)y+=u[w].getArea();return y},getLength:function(){for(var u=this._children,y=0,w=0,D=u.length;w<D;w++)y+=u[w].getLength();return y},getPathData:function(u,y){for(var w=this._children,D=[],N=0,U=w.length;N<U;N++){var te=w[N],J=te._matrix;D.push(te.getPathData(u&&!J.isIdentity()?u.appended(J):u,y))}return D.join("")},_hitTestChildren:function u(y,w,D){return u.base.call(this,y,w.class===mt||w.type==="path"?w:n.set({},w,{fill:!1}),D)},_draw:function(u,y,w,D){var N=this._children;if(N.length){y=y.extend({dontStart:!0,dontFinish:!0}),u.beginPath();for(var U=0,te=N.length;U<te;U++)N[U].draw(u,y,D);if(!y.clip){this._setStyles(u,y,w);var J=this._style;J.hasFill()&&(u.fill(J.getFillRule()),u.shadowColor="rgba(0,0,0,0)"),J.hasStroke()&&u.stroke()}}},_drawSelected:function(u,y,w){for(var D=this._children,N=0,U=D.length;N<U;N++){var te=D[N],J=te._matrix;w[te._id]||te._drawSelected(u,J.isIdentity()?y:y.appended(J))}}},new function(){function u(y,w){var D=y._children;if(w&&!D.length)throw new Error("Use a moveTo() command first");return D[D.length-1]}return n.each(["lineTo","cubicCurveTo","quadraticCurveTo","curveTo","arcTo","lineBy","cubicCurveBy","quadraticCurveBy","curveBy","arcBy"],function(y){this[y]=function(){var w=u(this,!0);w[y].apply(w,arguments)}},{moveTo:function(){var y=u(this),w=y&&y.isEmpty()?y:new mt(ye.NO_INSERT);w!==y&&this.addChild(w),w.moveTo.apply(w,arguments)},moveBy:function(){var y=u(this,!0),w=y&&y.getLastSegment(),D=I.read(arguments);this.moveTo(w?D.add(w._point):D)},closePath:function(y){u(this,!0).closePath(y)}})},n.each(["reverse","flatten","simplify","smooth"],function(u){this[u]=function(y){for(var w=this._children,D,N=0,U=w.length;N<U;N++)D=w[N][u](y)||D;return D}},{}));ht.inject(new function(){var u=Math.min,y=Math.max,w=Math.abs,D={unite:{1:!0,2:!0},intersect:{2:!0},subtract:{1:!0},exclude:{1:!0,"-1":!0}};function N(Ae){return Ae._children||[Ae]}function U(Ae,ke){var me=Ae.clone(!1).reduce({simplify:!0}).transform(null,!0,!0);if(ke){for(var Te=N(me),Re=0,Fe=Te.length;Re<Fe;Re++){var Ae=Te[Re];!Ae._closed&&!Ae.isEmpty()&&(Ae.closePath(1e-12),Ae.getFirstSegment().setHandleIn(0,0),Ae.getLastSegment().setHandleOut(0,0))}me=me.resolveCrossings().reorient(me.getFillRule()==="nonzero",!0)}return me}function te(Ae,ke,me,Te,Re){var Fe=new Nt(ye.NO_INSERT);return Fe.addChildren(Ae,!0),Fe=Fe.reduce({simplify:ke}),Re&&Re.insert==!1||Fe.insertAbove(Te&&me.isSibling(Te)&&me.getIndex()<Te.getIndex()?Te:me),Fe.copyAttributes(me,!0),Fe}function J(Ae){return Ae.hasOverlap()||Ae.isCrossing()}function ie(Ae,ke,me,Te){if(Te&&(Te.trace==!1||Te.stroke)&&/^(subtract|intersect)$/.test(me))return ae(Ae,ke,me);var Re=U(Ae,!0),Fe=ke&&Ae!==ke&&U(ke,!0),Ye=D[me];Ye[me]=!0,Fe&&(Ye.subtract||Ye.exclude)^(Fe.isClockwise()^Re.isClockwise())&&Fe.reverse();var je=ge(Et.expand(Re.getIntersections(Fe,J))),Ze=N(Re),tt=Fe&&N(Fe),ut=[],nt=[],pt;function ft(Oi){for(var ds=0,Lt=Oi.length;ds<Lt;ds++){var Qi=Oi[ds];n.push(ut,Qi._segments),n.push(nt,Qi.getCurves()),Qi._overlapsOnly=!0}}function wt(Oi){for(var ds=[],Lt=0,Qi=Oi&&Oi.length;Lt<Qi;Lt++)ds.push(nt[Oi[Lt]]);return ds}if(je.length){ft(Ze),tt&&ft(tt);for(var Tt=new Array(nt.length),Vt=0,ni=nt.length;Vt<ni;Vt++)Tt[Vt]=nt[Vt].getValues();for(var ai=d.findCurveBoundsCollisions(Tt,Tt,0,!0),Ht={},Vt=0;Vt<nt.length;Vt++){var Ci=nt[Vt],Ti=Ci._path._id,Pi=Ht[Ti]=Ht[Ti]||{};Pi[Ci.getIndex()]={hor:wt(ai[Vt].hor),ver:wt(ai[Vt].ver)}}for(var Vt=0,ni=je.length;Vt<ni;Vt++)Ne(je[Vt]._segment,Re,Fe,Ht,Ye);for(var Vt=0,ni=ut.length;Vt<ni;Vt++){var wi=ut[Vt],Qt=wi._intersection;wi._winding||Ne(wi,Re,Fe,Ht,Ye),Qt&&Qt._overlap||(wi._path._overlapsOnly=!1)}pt=qe(ut,Ye)}else pt=be(tt?Ze.concat(tt):Ze.slice(),function(Oi){return!!Ye[Oi]});return te(pt,!0,Ae,ke,Te)}function ae(Ae,ke,me){var Te=U(Ae),Re=U(ke),Fe=Te.getIntersections(Re,J),Ye=me==="subtract",je=me==="divide",Ze={},tt=[];function ut(ft){if(!Ze[ft._id]&&(je||Re.contains(ft.getPointAt(ft.getLength()/2))^Ye))return tt.unshift(ft),Ze[ft._id]=!0}for(var nt=Fe.length-1;nt>=0;nt--){var pt=Fe[nt].split();pt&&(ut(pt)&&pt.getFirstSegment().setHandleIn(0,0),Te.getLastSegment().setHandleOut(0,0))}return ut(Te),te(tt,!1,Ae,ke)}function ve(Ae,ke){for(var me=Ae;me;){if(me===ke)return;me=me._previous}for(;Ae._next&&Ae._next!==ke;)Ae=Ae._next;if(!Ae._next){for(;ke._previous;)ke=ke._previous;Ae._next=ke,ke._previous=Ae}}function Se(Ae){for(var ke=Ae.length-1;ke>=0;ke--)Ae[ke].clearHandles()}function be(Ae,ke,me){var Te=Ae&&Ae.length;if(Te){var Re=n.each(Ae,function(ai,Ht){this[ai._id]={container:null,winding:ai.isClockwise()?1:-1,index:Ht}},{}),Fe=Ae.slice().sort(function(ai,Ht){return w(Ht.getArea())-w(ai.getArea())}),Ye=Fe[0],je=d.findItemBoundsCollisions(Fe,null,S.GEOMETRIC_EPSILON);me==null&&(me=Ye.isClockwise());for(var Ze=0;Ze<Te;Ze++){var tt=Fe[Ze],ut=Re[tt._id],nt=0,pt=je[Ze];if(pt){for(var ft=null,wt=pt.length-1;wt>=0;wt--)if(pt[wt]<Ze){ft=ft||tt.getInteriorPoint();var Tt=Fe[pt[wt]];if(Tt.contains(ft)){var Vt=Re[Tt._id];nt=Vt.winding,ut.winding+=nt,ut.container=Vt.exclude?Vt.container:Tt;break}}}if(ke(ut.winding)===ke(nt))ut.exclude=!0,Ae[ut.index]=null;else{var ni=ut.container;tt.setClockwise(ni?!ni.isClockwise():me)}}}return Ae}function ge(Ae,ke,me){var Te=ke&&[],Re=1e-8,Fe=1-Re,Ye=!1,je=me||[],Ze=me&&{},tt,ut,nt;function pt(ds){return ds._path._id+"."+ds._segment1._index}for(var ft=(me&&me.length)-1;ft>=0;ft--){var wt=me[ft];wt._path&&(Ze[pt(wt)]=!0)}for(var ft=Ae.length-1;ft>=0;ft--){var Tt=Ae[ft],Vt=Tt._time,ni=Vt,ai=ke&&!ke(Tt),wt=Tt._curve,Ht;if(wt&&(wt!==ut?(Ye=!wt.hasHandles()||Ze&&Ze[pt(wt)],tt=[],nt=null,ut=wt):nt>=Re&&(Vt/=nt)),ai){tt&&tt.push(Tt);continue}else ke&&Te.unshift(Tt);if(nt=ni,Vt<Re)Ht=wt._segment1;else if(Vt>Fe)Ht=wt._segment2;else{var Ci=wt.divideAtTime(Vt,!0);Ye&&je.push(wt,Ci),Ht=Ci._segment1;for(var Ti=tt.length-1;Ti>=0;Ti--){var Pi=tt[Ti];Pi._time=(Pi._time-Vt)/(1-Vt)}}Tt._setSegment(Ht);var wi=Ht._intersection,Qt=Tt._intersection;if(wi){ve(wi,Qt);for(var Oi=wi;Oi;)ve(Oi._intersection,wi),Oi=Oi._next}else Ht._intersection=Qt}return me||Se(je),Te||Ae}function Ce(Ae,ke,me,Te,Re){var Fe=Array.isArray(ke)?ke:ke[me?"hor":"ver"],Ye=me?1:0,je=Ye^1,Ze=[Ae.x,Ae.y],tt=Ze[Ye],ut=Ze[je],nt=1e-9,pt=1e-6,ft=tt-nt,wt=tt+nt,Tt=0,Vt=0,ni=0,ai=0,Ht=!1,Ci=!1,Ti=1,Pi=[],wi,Qt;function Oi(rs){var xs=rs[je+0],Pn=rs[je+6];if(!(ut<u(xs,Pn)||ut>y(xs,Pn))){var js=rs[Ye+0],Xn=rs[Ye+2],Er=rs[Ye+4],jn=rs[Ye+6];if(xs===Pn){(js<wt&&jn>ft||jn<wt&&js>ft)&&(Ht=!0);return}var pr=ut===xs?0:ut===Pn||ft>y(js,Xn,Er,jn)||wt<u(js,Xn,Er,jn)?1:Je.solveCubic(rs,je,ut,Pi,0,1)>0?Pi[0]:1,hn=pr===0?js:pr===1?jn:Je.getPoint(rs,pr)[me?"y":"x"],En=xs>Pn?1:-1,Tr=wi[je]>wi[je+6]?1:-1,Tn=wi[Ye+6];return ut!==xs?(hn<ft?ni+=En:hn>wt?ai+=En:Ht=!0,hn>tt-pt&&hn<tt+pt&&(Ti/=2)):(En!==Tr?js<ft?ni+=En:js>wt&&(ai+=En):js!=Tn&&(Tn<wt&&hn>wt?(ai+=En,Ht=!0):Tn>ft&&hn<ft&&(ni+=En,Ht=!0)),Ti/=4),wi=rs,!Re&&hn>ft&&hn<wt&&Je.getTangent(rs,pr)[me?"x":"y"]===0&&Ce(Ae,ke,!me,Te,!0)}}function ds(rs){var xs=rs[je+0],Pn=rs[je+2],js=rs[je+4],Xn=rs[je+6];if(ut<=y(xs,Pn,js,Xn)&&ut>=u(xs,Pn,js,Xn)){for(var Er=rs[Ye+0],jn=rs[Ye+2],pr=rs[Ye+4],hn=rs[Ye+6],En=ft>y(Er,jn,pr,hn)||wt<u(Er,jn,pr,hn)?[rs]:Je.getMonoCurves(rs,me),Tr,Tn=0,Fs=En.length;Tn<Fs;Tn++)if(Tr=Oi(En[Tn]))return Tr}}for(var Lt=0,Qi=Fe.length;Lt<Qi;Lt++){var Ki=Fe[Lt],Ri=Ki._path,Xs=Ki.getValues(),on;if((!Lt||Fe[Lt-1]._path!==Ri)&&(wi=null,Ri._closed||(Qt=Je.getValues(Ri.getLastCurve().getSegment2(),Ki.getSegment1(),null,!Te),Qt[je]!==Qt[je+6]&&(wi=Qt)),!wi)){wi=Xs;for(var Hs=Ri.getLastCurve();Hs&&Hs!==Ki;){var Bs=Hs.getValues();if(Bs[je]!==Bs[je+6]){wi=Bs;break}Hs=Hs.getPrevious()}}if(on=ds(Xs))return on;if(Lt+1===Qi||Fe[Lt+1]._path!==Ri){if(Qt&&(on=ds(Qt)))return on;Ht&&!ni&&!ai&&(ni=ai=Ri.isClockwise(Te)^me?1:-1),Tt+=ni,Vt+=ai,ni=ai=0,Ht&&(Ci=!0,Ht=!1),Qt=null}}return Tt=w(Tt),Vt=w(Vt),{winding:y(Tt,Vt),windingL:Tt,windingR:Vt,quality:Ti,onPath:Ci}}function Ne(Ae,ke,me,Te,Re){var Fe=[],Ye=Ae,je=0,nt;do{var Ze=Ae.getCurve();if(Ze){var tt=Ze.getLength();Fe.push({segment:Ae,curve:Ze,length:tt}),je+=tt}Ae=Ae.getNext()}while(Ae&&!Ae._intersection&&Ae!==Ye);for(var ut=[.5,.25,.75],nt={winding:0,quality:-1},pt=.001,ft=1-pt,wt=0;wt<ut.length&&nt.quality<.5;wt++)for(var tt=je*ut[wt],Tt=0,Vt=Fe.length;Tt<Vt;Tt++){var ni=Fe[Tt],ai=ni.length;if(tt<=ai){var Ze=ni.curve,Ht=Ze._path,Ci=Ht._parent,Ti=Ci instanceof Nt?Ci:Ht,Pi=S.clamp(Ze.getTimeAt(tt),pt,ft),wi=Ze.getPointAtTime(Pi),Qt=w(Ze.getTangentAtTime(Pi).y)<Math.SQRT1_2,Oi=null;if(Re.subtract&&me){var ds=Ti===ke?me:ke,Lt=ds._getWinding(wi,Qt,!0);if(Ti===ke&&Lt.winding||Ti===me&&!Lt.winding){if(Lt.quality<1)continue;Oi={winding:0,quality:1}}}Oi=Oi||Ce(wi,Te[Ht._id][Ze.getIndex()],Qt,!0),Oi.quality>nt.quality&&(nt=Oi);break}tt-=ai}for(var Tt=Fe.length-1;Tt>=0;Tt--)Fe[Tt].segment._winding=nt}function qe(Ae,ke){var me=[],Te;function Re(Qi){var Ki;return!!(Qi&&!Qi._visited&&(!ke||ke[(Ki=Qi._winding||{}).winding]&&!(ke.unite&&Ki.winding===2&&Ki.windingL&&Ki.windingR)))}function Fe(Qi){if(Qi){for(var Ki=0,Ri=Te.length;Ki<Ri;Ki++)if(Qi===Te[Ki])return!0}return!1}function Ye(Qi){for(var Ki=Qi._segments,Ri=0,Xs=Ki.length;Ri<Xs;Ri++)Ki[Ri]._visited=!0}function je(Qi,Ki){var Ri=Qi._intersection,Xs=Ri,on=[];Ki&&(Te=[Qi]);function Hs(Bs,rs){for(;Bs&&Bs!==rs;){var xs=Bs._segment,Pn=xs&&xs._path;if(Pn){var js=xs.getNext()||Pn.getFirstSegment(),Xn=js._intersection;xs!==Qi&&(Fe(xs)||Fe(js)||js&&Re(xs)&&(Re(js)||Xn&&Re(Xn._segment)))&&on.push(xs),Ki&&Te.push(xs)}Bs=Bs._next}}if(Ri){for(Hs(Ri);Ri&&Ri._previous;)Ri=Ri._previous;Hs(Ri,Xs)}return on}Ae.sort(function(Qi,Ki){var Ri=Qi._intersection,Xs=Ki._intersection,on=!!(Ri&&Ri._overlap),Hs=!!(Xs&&Xs._overlap),Bs=Qi._path,rs=Ki._path;return on^Hs?on?1:-1:!Ri^!Xs?Ri?1:-1:Bs!==rs?Bs._id-rs._id:Qi._index-Ki._index});for(var Ze=0,tt=Ae.length;Ze<tt;Ze++){var ut=Ae[Ze],nt=Re(ut),pt=null,ft=!1,wt=!0,Tt=[],Vt,ni,ai;if(nt&&ut._path._overlapsOnly){var Ht=ut._path,Ci=ut._intersection._segment._path;Ht.compare(Ci)&&(Ht.getArea()&&me.push(Ht.clone(!1)),Ye(Ht),Ye(Ci),nt=!1)}for(;nt;){var Ti=!pt,Pi=je(ut,Ti),wi=Pi.shift(),ft=!Ti&&(Fe(ut)||Fe(wi)),Qt=!ft&&wi;if(Ti&&(pt=new mt(ye.NO_INSERT),Vt=null),ft){(ut.isFirst()||ut.isLast())&&(wt=ut._path._closed),ut._visited=!0;break}if(Qt&&Vt&&(Tt.push(Vt),Vt=null),Vt||(Qt&&Pi.push(ut),Vt={start:pt._segments.length,crossings:Pi,visited:ni=[],handleIn:ai}),Qt&&(ut=wi),!Re(ut)){pt.removeSegments(Vt.start);for(var Oi=0,ds=ni.length;Oi<ds;Oi++)ni[Oi]._visited=!1;ni.length=0;do ut=Vt&&Vt.crossings.shift(),(!ut||!ut._path)&&(ut=null,Vt=Tt.pop(),Vt&&(ni=Vt.visited,ai=Vt.handleIn));while(Vt&&!Re(ut));if(!ut)break}var Lt=ut.getNext();pt.add(new Ct(ut._point,ai,Lt&&ut._handleOut)),ut._visited=!0,ni.push(ut),ut=Lt||ut._path.getFirstSegment(),ai=Lt&&Lt._handleIn}ft&&(wt&&(pt.getFirstSegment().setHandleIn(ai),pt.setClosed(wt)),pt.getArea()!==0&&me.push(pt))}return me}return{_getWinding:function(Ae,ke,me){return Ce(Ae,this.getCurves(),ke,me)},unite:function(Ae,ke){return ie(this,Ae,"unite",ke)},intersect:function(Ae,ke){return ie(this,Ae,"intersect",ke)},subtract:function(Ae,ke){return ie(this,Ae,"subtract",ke)},exclude:function(Ae,ke){return ie(this,Ae,"exclude",ke)},divide:function(Ae,ke){return ke&&(ke.trace==!1||ke.stroke)?ae(this,Ae,"divide"):te([this.subtract(Ae,ke),this.intersect(Ae,ke)],!0,this,Ae,ke)},resolveCrossings:function(){var Ae=this._children,ke=Ae||[this];function me(Vt,ni){var ai=Vt&&Vt._intersection;return ai&&ai._overlap&&ai._path===ni}var Te=!1,Re=!1,Fe=this.getIntersections(null,function(Vt){return Vt.hasOverlap()&&(Te=!0)||Vt.isCrossing()&&(Re=!0)}),Ye=Te&&Re&&[];if(Fe=Et.expand(Fe),Te)for(var je=ge(Fe,function(Vt){return Vt.hasOverlap()},Ye),Ze=je.length-1;Ze>=0;Ze--){var tt=je[Ze],ut=tt._path,nt=tt._segment,pt=nt.getPrevious(),ft=nt.getNext();me(pt,ut)&&me(ft,ut)&&(nt.remove(),pt._handleOut._set(0,0),ft._handleIn._set(0,0),pt!==nt&&!pt.getCurve().hasLength()&&(ft._handleIn.set(pt._handleIn),pt.remove()))}Re&&(ge(Fe,Te&&function(Vt){var ni=Vt.getCurve(),ai=Vt.getSegment(),Ht=Vt._intersection,Ci=Ht._curve,Ti=Ht._segment;if(ni&&Ci&&ni._path&&Ci._path)return!0;ai&&(ai._intersection=null),Ti&&(Ti._intersection=null)},Ye),Ye&&Se(Ye),ke=qe(n.each(ke,function(Vt){n.push(this,Vt._segments)},[])));var wt=ke.length,Tt;return wt>1&&Ae?(ke!==Ae&&this.setChildren(ke),Tt=this):wt===1&&!Ae&&(ke[0]!==this&&this.setSegments(ke[0].removeSegments()),Tt=this),Tt||(Tt=new Nt(ye.NO_INSERT),Tt.addChildren(ke),Tt=Tt.reduce(),Tt.copyAttributes(this),this.replaceWith(Tt)),Tt},reorient:function(Ae,ke){var me=this._children;return me&&me.length?this.setChildren(be(this.removeChildren(),function(Te){return!!(Ae?Te:Te&1)},ke)):ke!==s&&this.setClockwise(ke),this},getInteriorPoint:function(){var Ae=this.getBounds(),ke=Ae.getCenter(!0);if(!this.contains(ke)){for(var me=this.getCurves(),Te=ke.y,Re=[],Fe=[],Ye=0,je=me.length;Ye<je;Ye++){var Ze=me[Ye].getValues(),tt=Ze[1],ut=Ze[3],nt=Ze[5],pt=Ze[7];if(Te>=u(tt,ut,nt,pt)&&Te<=y(tt,ut,nt,pt))for(var ft=Je.getMonoCurves(Ze),wt=0,Tt=ft.length;wt<Tt;wt++){var Vt=ft[wt],ni=Vt[1],ai=Vt[7];if(ni!==ai&&(Te>=ni&&Te<=ai||Te>=ai&&Te<=ni)){var Ht=Te===ni?Vt[0]:Te===ai?Vt[6]:Je.solveCubic(Vt,1,Te,Fe,0,1)===1?Je.getPoint(Vt,Fe[0]).x:(Vt[0]+Vt[6])/2;Re.push(Ht)}}}Re.length>1&&(Re.sort(function(Ci,Ti){return Ci-Ti}),ke.x=(Re[0]+Re[1])/2)}return ke}}});var Gt=n.extend({_class:"PathFlattener",initialize:function(u,y,w,D,N){var U=[],te=[],J=0,ie=1/(w||32),ae=u._segments,ve=ae[0],Se;function be(qe,Ae){var ke=Je.getValues(qe,Ae,N);U.push(ke),ge(ke,qe._index,0,1)}function ge(qe,Ae,ke,me){if(me-ke>ie&&!(D&&Je.isStraight(qe))&&!Je.isFlatEnough(qe,y||.25)){var Te=Je.subdivide(qe,.5),Re=(ke+me)/2;ge(Te[0],Ae,ke,Re),ge(Te[1],Ae,Re,me)}else{var Fe=qe[6]-qe[0],Ye=qe[7]-qe[1],je=Math.sqrt(Fe*Fe+Ye*Ye);je>0&&(J+=je,te.push({offset:J,curve:qe,index:Ae,time:me}))}}for(var Ce=1,Ne=ae.length;Ce<Ne;Ce++)Se=ae[Ce],be(ve,Se),ve=Se;u._closed&&be(Se||ve,ae[0]),this.curves=U,this.parts=te,this.length=J,this.index=0},_get:function(u){for(var y=this.parts,w=y.length,D,N=this.index;D=N,!(!N||y[--N].offset<u););for(;D<w;D++){var U=y[D];if(U.offset>=u){this.index=D;var te=y[D-1],J=te&&te.index===U.index?te.time:0,ie=te?te.offset:0;return{index:U.index,time:J+(U.time-J)*(u-ie)/(U.offset-ie)}}}return{index:y[w-1].index,time:1}},drawPart:function(u,y,w){for(var D=this._get(y),N=this._get(w),U=D.index,te=N.index;U<=te;U++){var J=Je.getPart(this.curves[U],U===D.index?D.time:0,U===N.index?N.time:1);U===D.index&&u.moveTo(J[0],J[1]),u.bezierCurveTo.apply(u,J.slice(2))}}},n.each(Je._evaluateMethods,function(u){this[u+"At"]=function(y){var w=this._get(y);return Je[u](this.curves[w.index],w.time)}},{})),Mt=n.extend({initialize:function(u){for(var y=this.points=[],w=u._segments,D=u._closed,N=0,U,te=w.length;N<te;N++){var J=w[N].point;(!U||!U.equals(J))&&y.push(U=J.clone())}D&&(y.unshift(y[y.length-1]),y.push(y[1])),this.closed=D},fit:function(u){var y=this.points,w=y.length,D=null;return w>0&&(D=[new Ct(y[0])],w>1&&(this.fitCubic(D,u,0,w-1,y[1].subtract(y[0]),y[w-2].subtract(y[w-1])),this.closed&&(D.shift(),D.pop()))),D},fitCubic:function(u,y,w,D,N,U){var te=this.points;if(D-w===1){var J=te[w],ie=te[D],ae=J.getDistance(ie)/3;this.addCurve(u,[J,J.add(N.normalize(ae)),ie.add(U.normalize(ae)),ie]);return}for(var ve=this.chordLengthParameterize(w,D),Se=Math.max(y,y*y),be,ge=!0,Ce=0;Ce<=4;Ce++){var Ne=this.generateBezier(w,D,ve,N,U),qe=this.findMaxError(w,D,Ne,ve);if(qe.error<y&&ge){this.addCurve(u,Ne);return}if(be=qe.index,qe.error>=Se)break;ge=this.reparameterize(w,D,ve,Ne),Se=qe.error}var Ae=te[be-1].subtract(te[be+1]);this.fitCubic(u,y,w,be,N,Ae),this.fitCubic(u,y,be,D,Ae.negate(),U)},addCurve:function(u,y){var w=u[u.length-1];w.setHandleOut(y[1].subtract(y[0])),u.push(new Ct(y[3],y[2].subtract(y[3])))},generateBezier:function(u,y,w,D,N){for(var U=1e-12,te=Math.abs,J=this.points,ie=J[u],ae=J[y],ve=[[0,0],[0,0]],Se=[0,0],be=0,ge=y-u+1;be<ge;be++){var Ce=w[be],Ne=1-Ce,qe=3*Ce*Ne,Ae=Ne*Ne*Ne,ke=qe*Ne,me=qe*Ce,Te=Ce*Ce*Ce,Re=D.normalize(ke),Fe=N.normalize(me),Ye=J[u+be].subtract(ie.multiply(Ae+ke)).subtract(ae.multiply(me+Te));ve[0][0]+=Re.dot(Re),ve[0][1]+=Re.dot(Fe),ve[1][0]=ve[0][1],ve[1][1]+=Fe.dot(Fe),Se[0]+=Re.dot(Ye),Se[1]+=Fe.dot(Ye)}var je=ve[0][0]*ve[1][1]-ve[1][0]*ve[0][1],Ze,tt;if(te(je)>U){var ut=ve[0][0]*Se[1]-ve[1][0]*Se[0],nt=Se[0]*ve[1][1]-Se[1]*ve[0][1];Ze=nt/je,tt=ut/je}else{var pt=ve[0][0]+ve[0][1],ft=ve[1][0]+ve[1][1];Ze=tt=te(pt)>U?Se[0]/pt:te(ft)>U?Se[1]/ft:0}var wt=ae.getDistance(ie),Tt=U*wt,Vt,ni;if(Ze<Tt||tt<Tt)Ze=tt=wt/3;else{var ai=ae.subtract(ie);Vt=D.normalize(Ze),ni=N.normalize(tt),Vt.dot(ai)-ni.dot(ai)>wt*wt&&(Ze=tt=wt/3,Vt=ni=null)}return[ie,ie.add(Vt||D.normalize(Ze)),ae.add(ni||N.normalize(tt)),ae]},reparameterize:function(u,y,w,D){for(var N=u;N<=y;N++)w[N-u]=this.findRoot(D,this.points[N],w[N-u]);for(var N=1,U=w.length;N<U;N++)if(w[N]<=w[N-1])return!1;return!0},findRoot:function(u,y,w){for(var D=[],N=[],U=0;U<=2;U++)D[U]=u[U+1].subtract(u[U]).multiply(3);for(var U=0;U<=1;U++)N[U]=D[U+1].subtract(D[U]).multiply(2);var te=this.evaluate(3,u,w),J=this.evaluate(2,D,w),ie=this.evaluate(1,N,w),ae=te.subtract(y),ve=J.dot(J)+ae.dot(ie);return S.isMachineZero(ve)?w:w-ae.dot(J)/ve},evaluate:function(u,y,w){for(var D=y.slice(),N=1;N<=u;N++)for(var U=0;U<=u-N;U++)D[U]=D[U].multiply(1-w).add(D[U+1].multiply(w));return D[0]},chordLengthParameterize:function(u,y){for(var w=[0],D=u+1;D<=y;D++)w[D-u]=w[D-u-1]+this.points[D].getDistance(this.points[D-1]);for(var D=1,N=y-u;D<=N;D++)w[D]/=w[N];return w},findMaxError:function(u,y,w,D){for(var N=Math.floor((y-u+1)/2),U=0,te=u+1;te<y;te++){var J=this.evaluate(3,w,D[te-u]),ie=J.subtract(this.points[te]),ae=ie.x*ie.x+ie.y*ie.y;ae>=U&&(U=ae,N=te)}return{error:U,index:N}}}),jt=ye.extend({_class:"TextItem",_applyMatrix:!1,_canApplyMatrix:!1,_serializeFields:{content:null},_boundsOptions:{stroke:!1,handle:!1},initialize:function(y){this._content="",this._lines=[];var w=y&&n.isPlainObject(y)&&y.x===s&&y.y===s;this._initialize(w&&y,!w&&I.read(arguments))},_equals:function(u){return this._content===u._content},copyContent:function(u){this.setContent(u._content)},getContent:function(){return this._content},setContent:function(u){this._content=""+u,this._lines=this._content.split(/\r\n|\n|\r/mg),this._changed(521)},isEmpty:function(){return!this._content},getCharacterStyle:"#getStyle",setCharacterStyle:"#setStyle",getParagraphStyle:"#getStyle",setParagraphStyle:"#setStyle"}),Ai=jt.extend({_class:"PointText",initialize:function(){jt.apply(this,arguments)},getPoint:function(){var u=this._matrix.getTranslation();return new W(u.x,u.y,this,"setPoint")},setPoint:function(){var u=I.read(arguments);this.translate(u.subtract(this._matrix.getTranslation()))},_draw:function(u,y,w){if(this._content){this._setStyles(u,y,w);var D=this._lines,N=this._style,U=N.hasFill(),te=N.hasStroke(),J=N.getLeading(),ie=u.shadowColor;u.font=N.getFontStyle(),u.textAlign=N.getJustification();for(var ae=0,ve=D.length;ae<ve;ae++){u.shadowColor=ie;var Se=D[ae];U&&(u.fillText(Se,0,0),u.shadowColor="rgba(0,0,0,0)"),te&&u.strokeText(Se,0,0),u.translate(0,J)}}},_getBounds:function(u,y){var w=this._style,D=this._lines,N=D.length,U=w.getJustification(),te=w.getLeading(),J=this.getView().getTextWidth(w.getFontStyle(),D),ie=0;U!=="left"&&(ie-=J/(U==="center"?2:1));var ae=new Y(ie,N?-.75*te:0,J,N*te);return u?u._transformBounds(ae,ae):ae}}),oi=n.extend(new function(){var u={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"],gradient:["gradient","origin","destination","highlight"]},y={},w={transparent:[0,0,0,0]},D;function N(J){var ie=J.match(/^#([\da-f]{2})([\da-f]{2})([\da-f]{2})([\da-f]{2})?$/i)||J.match(/^#([\da-f])([\da-f])([\da-f])([\da-f])?$/i),ae="rgb",ve;if(ie){var Se=ie[4]?4:3;ve=new Array(Se);for(var be=0;be<Se;be++){var ge=ie[be+1];ve[be]=parseInt(ge.length==1?ge+ge:ge,16)/255}}else if(ie=J.match(/^(rgb|hsl)a?\((.*)\)$/)){ae=ie[1],ve=ie[2].trim().split(/[,\s]+/g);for(var Ce=ae==="hsl",be=0,Ne=Math.min(ve.length,4);be<Ne;be++){var qe=ve[be],ge=parseFloat(qe);if(Ce)if(be===0){var Ae=qe.match(/([a-z]*)$/)[1];ge*={turn:360,rad:180/Math.PI,grad:.9}[Ae]||1}else be<3&&(ge/=100);else be<3&&(ge/=/%$/.test(qe)?100:255);ve[be]=ge}}else{var ke=w[J];if(!ke)if(r){D||(D=et.getContext(1,1,{willReadFrequently:!0}),D.globalCompositeOperation="copy"),D.fillStyle="rgba(0,0,0,0)",D.fillStyle=J,D.fillRect(0,0,1,1);var me=D.getImageData(0,0,1,1).data;ke=w[J]=[me[0]/255,me[1]/255,me[2]/255]}else ke=[0,0,0];ve=ke.slice()}return[ae,ve]}var U=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],te={"rgb-hsb":function(J,ie,ae){var ve=Math.max(J,ie,ae),Se=Math.min(J,ie,ae),be=ve-Se,ge=be===0?0:(ve==J?(ie-ae)/be+(ie<ae?6:0):ve==ie?(ae-J)/be+2:(J-ie)/be+4)*60;return[ge,ve===0?0:be/ve,ve]},"hsb-rgb":function(J,ie,ae){J=(J/60%6+6)%6;var Se=Math.floor(J),ve=J-Se,Se=U[Se],be=[ae,ae*(1-ie),ae*(1-ie*ve),ae*(1-ie*(1-ve))];return[be[Se[0]],be[Se[1]],be[Se[2]]]},"rgb-hsl":function(J,ie,ae){var ve=Math.max(J,ie,ae),Se=Math.min(J,ie,ae),be=ve-Se,ge=be===0,Ce=ge?0:(ve==J?(ie-ae)/be+(ie<ae?6:0):ve==ie?(ae-J)/be+2:(J-ie)/be+4)*60,Ne=(ve+Se)/2,qe=ge?0:Ne<.5?be/(ve+Se):be/(2-ve-Se);return[Ce,qe,Ne]},"hsl-rgb":function(J,ie,ae){if(J=(J/360%1+1)%1,ie===0)return[ae,ae,ae];for(var ve=[J+1/3,J,J-1/3],Se=ae<.5?ae*(1+ie):ae+ie-ae*ie,be=2*ae-Se,ge=[],Ce=0;Ce<3;Ce++){var Ne=ve[Ce];Ne<0&&(Ne+=1),Ne>1&&(Ne-=1),ge[Ce]=6*Ne<1?be+(Se-be)*6*Ne:2*Ne<1?Se:3*Ne<2?be+(Se-be)*(2/3-Ne)*6:be}return ge},"rgb-gray":function(J,ie,ae){return[J*.2989+ie*.587+ae*.114]},"gray-rgb":function(J){return[J,J,J]},"gray-hsb":function(J){return[0,0,J]},"gray-hsl":function(J){return[0,0,J]},"gradient-rgb":function(){return[]},"rgb-gradient":function(){return[]}};return n.each(u,function(J,ie){y[ie]=[],n.each(J,function(ae,ve){var Se=n.capitalize(ae),be=/^(hue|saturation)$/.test(ae),ge=y[ie][ve]=ie==="gradient"?ae==="gradient"?function(Ce){var Ne=this._components[0];return Ce=ki.read(Array.isArray(Ce)?Ce:arguments,0,{readNull:!0}),Ne!==Ce&&(Ne&&Ne._removeOwner(this),Ce&&Ce._addOwner(this)),Ce}:function(){return I.read(arguments,0,{readNull:ae==="highlight",clone:!0})}:function(Ce){return Ce==null||isNaN(Ce)?0:+Ce};this["get"+Se]=function(){return this._type===ie||be&&/^hs[bl]$/.test(this._type)?this._components[ve]:this._convert(ie)[ve]},this["set"+Se]=function(Ce){this._type!==ie&&!(be&&/^hs[bl]$/.test(this._type))&&(this._components=this._convert(ie),this._properties=u[ie],this._type=ie),this._components[ve]=ge.call(this,Ce),this._changed()}},this)},{_class:"Color",_readIndex:!0,initialize:function J(ie){var ae=arguments,ve=this.__read,Se=0,be,ge,Ce,Ne;Array.isArray(ie)&&(ae=ie,ie=ae[0]);var qe=ie!=null&&typeof ie;if(qe==="string"&&ie in u&&(be=ie,ie=ae[1],Array.isArray(ie)?(ge=ie,Ce=ae[2]):(ve&&(Se=1),ae=n.slice(ae,1),qe=typeof ie)),!ge){if(Ne=qe==="number"?ae:qe==="object"&&ie.length!=null?ie:null,Ne){be||(be=Ne.length>=3?"rgb":"gray");var Ae=u[be].length;Ce=Ne[Ae],ve&&(Se+=Ne===arguments?Ae+(Ce!=null?1:0):1),Ne.length>Ae&&(Ne=n.slice(Ne,0,Ae))}else if(qe==="string"){var ke=N(ie);be=ke[0],ge=ke[1],ge.length===4&&(Ce=ge[3],ge.length--)}else if(qe==="object")if(ie.constructor===J){if(be=ie._type,ge=ie._components.slice(),Ce=ie._alpha,be==="gradient")for(var me=1,Te=ge.length;me<Te;me++){var Re=ge[me];Re&&(ge[me]=Re.clone())}}else if(ie.constructor===ki)be="gradient",Ne=ae;else{be="hue"in ie?"lightness"in ie?"hsl":"hsb":"gradient"in ie||"stops"in ie||"radial"in ie?"gradient":"gray"in ie?"gray":"rgb";var Fe=u[be],Ye=y[be];this._components=ge=[];for(var me=0,Te=Fe.length;me<Te;me++){var je=ie[Fe[me]];je==null&&!me&&be==="gradient"&&"stops"in ie&&(je={stops:ie.stops,radial:ie.radial}),je=Ye[me].call(this,je),je!=null&&(ge[me]=je)}Ce=ie.alpha}ve&&be&&(Se=1)}if(this._type=be||"rgb",!ge){this._components=ge=[];for(var Ye=y[this._type],me=0,Te=Ye.length;me<Te;me++){var je=Ye[me].call(this,Ne&&Ne[me]);je!=null&&(ge[me]=je)}}return this._components=ge,this._properties=u[this._type],this._alpha=Ce,ve&&(this.__read=Se),this},set:"#initialize",_serialize:function(J,ie){var ae=this.getComponents();return n.serialize(/^(gray|rgb)$/.test(this._type)?ae:[this._type].concat(ae),J,!0,ie)},_changed:function(){this._canvasStyle=null,this._owner&&(this._setter?this._owner[this._setter](this):this._owner._changed(129))},_convert:function(J){var ie;return this._type===J?this._components.slice():(ie=te[this._type+"-"+J])?ie.apply(this,this._components):te["rgb-"+J].apply(this,te[this._type+"-rgb"].apply(this,this._components))},convert:function(J){return new oi(J,this._convert(J),this._alpha)},getType:function(){return this._type},setType:function(J){this._components=this._convert(J),this._properties=u[J],this._type=J},getComponents:function(){var J=this._components.slice();return this._alpha!=null&&J.push(this._alpha),J},getAlpha:function(){return this._alpha!=null?this._alpha:1},setAlpha:function(J){this._alpha=J==null?null:Math.min(Math.max(J,0),1),this._changed()},hasAlpha:function(){return this._alpha!=null},equals:function(J){var ie=n.isPlainValue(J,!0)?oi.read(arguments):J;return ie===this||ie&&this._class===ie._class&&this._type===ie._type&&this.getAlpha()===ie.getAlpha()&&n.equals(this._components,ie._components)||!1},toString:function(){for(var J=this._properties,ie=[],ae=this._type==="gradient",ve=A.instance,Se=0,be=J.length;Se<be;Se++){var ge=this._components[Se];ge!=null&&ie.push(J[Se]+": "+(ae?ge:ve.number(ge)))}return this._alpha!=null&&ie.push("alpha: "+ve.number(this._alpha)),"{ "+ie.join(", ")+" }"},toCSS:function(J){var ie=this._convert("rgb"),ae=J||this._alpha==null?1:this._alpha;function ve(Se){return Math.round((Se<0?0:Se>1?1:Se)*255)}return ie=[ve(ie[0]),ve(ie[1]),ve(ie[2])],ae<1&&ie.push(ae<0?0:ae),J?"#"+((1<<24)+(ie[0]<<16)+(ie[1]<<8)+ie[2]).toString(16).slice(1):(ie.length==4?"rgba(":"rgb(")+ie.join(",")+")"},toCanvasStyle:function(J,ie){if(this._canvasStyle)return this._canvasStyle;if(this._type!=="gradient")return this._canvasStyle=this.toCSS();var ae=this._components,ve=ae[0],Se=ve._stops,be=ae[1],ge=ae[2],Ce=ae[3],Ne=ie&&ie.inverted(),qe;if(Ne&&(be=Ne._transformPoint(be),ge=Ne._transformPoint(ge),Ce&&(Ce=Ne._transformPoint(Ce))),ve._radial){var Ae=ge.getDistance(be);if(Ce){var ke=Ce.subtract(be);ke.getLength()>Ae&&(Ce=be.add(ke.normalize(Ae-.1)))}var me=Ce||be;qe=J.createRadialGradient(me.x,me.y,0,be.x,be.y,Ae)}else qe=J.createLinearGradient(be.x,be.y,ge.x,ge.y);for(var Te=0,Re=Se.length;Te<Re;Te++){var Fe=Se[Te],Ye=Fe._offset;qe.addColorStop(Ye??Te/(Re-1),Fe._color.toCanvasStyle())}return this._canvasStyle=qe},transform:function(J){if(this._type==="gradient"){for(var ie=this._components,ae=1,ve=ie.length;ae<ve;ae++){var Se=ie[ae];J._transformPoint(Se,Se,!0)}this._changed()}},statics:{_types:u,random:function(){var J=Math.random;return new oi(J(),J(),J())},_setOwner:function(J,ie,ae){return J&&(J._owner&&ie&&J._owner!==ie&&(J=J.clone()),!J._owner^!ie&&(J._owner=ie||null,J._setter=ae||null)),J}}})},new function(){var u={add:function(y,w){return y+w},subtract:function(y,w){return y-w},multiply:function(y,w){return y*w},divide:function(y,w){return y/w}};return n.each(u,function(y,w){this[w]=function(D){D=oi.read(arguments);for(var N=this._type,U=this._components,te=D._convert(N),J=0,ie=U.length;J<ie;J++)te[J]=y(U[J],te[J]);return new oi(N,te,this._alpha!=null?y(this._alpha,D.getAlpha()):null)}},{})}),ki=n.extend({_class:"Gradient",initialize:function(y,w){this._id=O.get(),y&&n.isPlainObject(y)&&(this.set(y),y=w=null),this._stops==null&&this.setStops(y||["white","black"]),this._radial==null&&this.setRadial(typeof w=="string"&&w==="radial"||w||!1)},_serialize:function(u,y){return y.add(this,function(){return n.serialize([this._stops,this._radial],u,!0,y)})},_changed:function(){for(var u=0,y=this._owners&&this._owners.length;u<y;u++)this._owners[u]._changed()},_addOwner:function(u){this._owners||(this._owners=[]),this._owners.push(u)},_removeOwner:function(u){var y=this._owners?this._owners.indexOf(u):-1;y!=-1&&(this._owners.splice(y,1),this._owners.length||(this._owners=s))},clone:function(){for(var u=[],y=0,w=this._stops.length;y<w;y++)u[y]=this._stops[y].clone();return new ki(u,this._radial)},getStops:function(){return this._stops},setStops:function(u){if(u.length<2)throw new Error("Gradient stop list needs to contain at least two stops.");var y=this._stops;if(y)for(var w=0,D=y.length;w<D;w++)y[w]._owner=s;y=this._stops=Li.readList(u,0,{clone:!0});for(var w=0,D=y.length;w<D;w++)y[w]._owner=this;this._changed()},getRadial:function(){return this._radial},setRadial:function(u){this._radial=u,this._changed()},equals:function(u){if(u===this)return!0;if(u&&this._class===u._class){var y=this._stops,w=u._stops,D=y.length;if(D===w.length){for(var N=0;N<D;N++)if(!y[N].equals(w[N]))return!1;return!0}}return!1}}),Li=n.extend({_class:"GradientStop",initialize:function(y,w){var D=y,N=w;typeof y=="object"&&w===s&&(Array.isArray(y)&&typeof y[0]!="number"?(D=y[0],N=y[1]):("color"in y||"offset"in y||"rampPoint"in y)&&(D=y.color,N=y.offset||y.rampPoint||0)),this.setColor(D),this.setOffset(N)},clone:function(){return new Li(this._color.clone(),this._offset)},_serialize:function(u,y){var w=this._color,D=this._offset;return n.serialize(D==null?[w]:[w,D],u,!0,y)},_changed:function(){this._owner&&this._owner._changed(129)},getOffset:function(){return this._offset},setOffset:function(u){this._offset=u,this._changed()},getRampPoint:"#getOffset",setRampPoint:"#setOffset",getColor:function(){return this._color},setColor:function(){oi._setOwner(this._color,null),this._color=oi._setOwner(oi.read(arguments,0),this,"setColor"),this._changed()},equals:function(u){return u===this||u&&this._class===u._class&&this._color.equals(u._color)&&this._offset==u._offset||!1}}),Wi=n.extend(new function(){var u={fillColor:null,fillRule:"nonzero",strokeColor:null,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",strokeScaling:!0,miterLimit:10,dashOffset:0,dashArray:[],shadowColor:null,shadowBlur:0,shadowOffset:new I,selectedColor:null},y=n.set({},u,{fontFamily:"sans-serif",fontWeight:"normal",fontSize:12,leading:null,justification:"left"}),w=n.set({},y,{fillColor:new oi}),D={strokeWidth:193,strokeCap:193,strokeJoin:193,strokeScaling:201,miterLimit:193,fontFamily:9,fontWeight:9,fontSize:9,font:9,leading:9,justification:9},N={beans:!0},U={_class:"Style",beans:!0,initialize:function(J,ie,ae){this._values={},this._owner=ie,this._project=ie&&ie._project||ae||yt.project,this._defaults=!ie||ie instanceof Ee?y:ie instanceof jt?w:u,J&&this.set(J)}};return n.each(y,function(te,J){var ie=/Color$/.test(J),ae=J==="shadowOffset",ve=n.capitalize(J),Se=D[J],be="set"+ve,ge="get"+ve;U[be]=function(Ce){var Ne=this._owner,qe=Ne&&Ne._children,Ae=qe&&qe.length>0&&!(Ne instanceof Nt);if(Ae)for(var ke=0,me=qe.length;ke<me;ke++)qe[ke]._style[be](Ce);if((J==="selectedColor"||!Ae)&&J in this._defaults){var Te=this._values[J];Te!==Ce&&(ie&&(Te&&(oi._setOwner(Te,null),Te._canvasStyle=null),Ce&&Ce.constructor===oi&&(Ce=oi._setOwner(Ce,Ne,Ae&&be))),this._values[J]=Ce,Ne&&Ne._changed(Se||129))}},U[ge]=function(Ce){var Ne=this._owner,qe=Ne&&Ne._children,Ae=qe&&qe.length>0&&!(Ne instanceof Nt),ke;if(Ae&&!Ce)for(var me=0,Te=qe.length;me<Te;me++){var Re=qe[me]._style[ge]();if(!me)ke=Re;else if(!n.equals(ke,Re))return s}else if(J in this._defaults){var ke=this._values[J];if(ke===s)ke=this._defaults[J],ke&&ke.clone&&(ke=ke.clone());else{var Fe=ie?oi:ae?I:null;Fe&&!(ke&&ke.constructor===Fe)&&(this._values[J]=ke=Fe.read([ke],0,{readNull:!0,clone:!0}))}}return ke&&ie&&(ke=oi._setOwner(ke,Ne,Ae&&be)),ke},N[ge]=function(Ce){return this._style[ge](Ce)},N[be]=function(Ce){this._style[be](Ce)}}),n.each({Font:"FontFamily",WindingRule:"FillRule"},function(te,J){var ie="get"+J,ae="set"+J;U[ie]=N[ie]="#get"+te,U[ae]=N[ae]="#set"+te}),ye.inject(N),U},{set:function(u){var y=u instanceof Wi,w=y?u._values:u;if(w){for(var D in w)if(D in this._defaults){var N=w[D];this[D]=N&&y&&N.clone?N.clone():N}}},equals:function(u){function y(w,D,N){var U=w._values,te=D._values,J=D._defaults;for(var ie in U){var ae=U[ie],ve=te[ie];if(!(N&&ie in te)&&!n.equals(ae,ve===s?J[ie]:ve))return!1}return!0}return u===this||u&&this._class===u._class&&y(this,u)&&y(u,this,!0)||!1},_dispose:function(){var u;u=this.getFillColor(),u&&(u._canvasStyle=null),u=this.getStrokeColor(),u&&(u._canvasStyle=null),u=this.getShadowColor(),u&&(u._canvasStyle=null)},hasFill:function(){var u=this.getFillColor();return!!u&&u.alpha>0},hasStroke:function(){var u=this.getStrokeColor();return!!u&&u.alpha>0&&this.getStrokeWidth()>0},hasShadow:function(){var u=this.getShadowColor();return!!u&&u.alpha>0&&(this.getShadowBlur()>0||!this.getShadowOffset().isZero())},getView:function(){return this._project._view},getFontStyle:function(){var u=this.getFontSize();return this.getFontWeight()+" "+u+(/[a-z]/i.test(u+"")?" ":"px ")+this.getFontFamily()},getFont:"#getFontFamily",setFont:"#setFontFamily",getLeading:function u(){var y=u.base.call(this),w=this.getFontSize();return/pt|em|%|px/.test(w)&&(w=this.getView().getPixelSize(w)),y??w*1.2}}),Vi=new function(){function u(y,w,D,N){for(var U=["","webkit","moz","Moz","ms","o"],te=w[0].toUpperCase()+w.substring(1),J=0;J<6;J++){var ie=U[J],ae=ie?ie+te:w;if(ae in y){if(D)y[ae]=N;else return y[ae];break}}}return{getStyles:function(y){var w=y&&y.nodeType!==9?y.ownerDocument:y,D=w&&w.defaultView;return D&&D.getComputedStyle(y,"")},getBounds:function(y,w){var D=y.ownerDocument,N=D.body,U=D.documentElement,te;try{te=y.getBoundingClientRect()}catch{te={left:0,top:0,width:0,height:0}}var J=te.left-(U.clientLeft||N.clientLeft||0),ie=te.top-(U.clientTop||N.clientTop||0);if(!w){var ae=D.defaultView;J+=ae.pageXOffset||U.scrollLeft||N.scrollLeft,ie+=ae.pageYOffset||U.scrollTop||N.scrollTop}return new Y(J,ie,te.width,te.height)},getViewportBounds:function(y){var w=y.ownerDocument,D=w.defaultView,N=w.documentElement;return new Y(0,0,D.innerWidth||N.clientWidth,D.innerHeight||N.clientHeight)},getOffset:function(y,w){return Vi.getBounds(y,w).getPoint()},getSize:function(y){return Vi.getBounds(y,!0).getSize()},isInvisible:function(y){return Vi.getSize(y).equals(new L(0,0))},isInView:function(y){return!Vi.isInvisible(y)&&Vi.getViewportBounds(y).intersects(Vi.getBounds(y,!0))},isInserted:function(y){return o.body.contains(y)},getPrefixed:function(y,w){return y&&u(y,w)},setPrefixed:function(y,w,D){if(typeof w=="object")for(var N in w)u(y,N,!0,w[N]);else u(y,w,!0,D)}}},qi={add:function(u,y){if(u)for(var w in y)for(var D=y[w],N=w.split(/[\s,]+/g),U=0,te=N.length;U<te;U++){var J=N[U],ie=u===o&&(J==="touchstart"||J==="touchmove")?{passive:!1}:!1;u.addEventListener(J,D,ie)}},remove:function(u,y){if(u)for(var w in y)for(var D=y[w],N=w.split(/[\s,]+/g),U=0,te=N.length;U<te;U++)u.removeEventListener(N[U],D,!1)},getPoint:function(u){var y=u.targetTouches?u.targetTouches.length?u.targetTouches[0]:u.changedTouches[0]:u;return new I(y.pageX||y.clientX+o.documentElement.scrollLeft,y.pageY||y.clientY+o.documentElement.scrollTop)},getTarget:function(u){return u.target||u.srcElement},getRelatedTarget:function(u){return u.relatedTarget||u.toElement},getOffset:function(u,y){return qi.getPoint(u).subtract(Vi.getOffset(y||qi.getTarget(u)))}};qi.requestAnimationFrame=new function(){var u=Vi.getPrefixed(r,"requestAnimationFrame"),y=!1,w=[],D;function N(){var U=w;w=[];for(var te=0,J=U.length;te<J;te++)U[te]();y=u&&w.length,y&&u(N)}return function(U){w.push(U),u?y||(u(N),y=!0):D||(D=setInterval(N,1e3/60))}};var Kt=n.extend(l,{_class:"View",initialize:function u(y,w){function D(Se){return w[Se]||parseInt(w.getAttribute(Se),10)}function N(){var Se=Vi.getSize(w);return Se.isNaN()||Se.isZero()?new L(D("width"),D("height")):Se}var U;if(r&&w){this._id=w.getAttribute("id"),this._id==null&&w.setAttribute("id",this._id="paper-view-"+u._id++),qi.add(w,this._viewEvents);var te="none";if(Vi.setPrefixed(w.style,{userDrag:te,userSelect:te,touchCallout:te,contentZooming:te,tapHighlightColor:"rgba(0,0,0,0)"}),h.hasAttribute(w,"resize")){var J=this;qi.add(r,this._windowEvents={resize:function(){J.setViewSize(N())}})}if(U=N(),h.hasAttribute(w,"stats")&&typeof Stats<"u"){this._stats=new Stats;var ie=this._stats.domElement,ae=ie.style,ve=Vi.getOffset(w);ae.position="absolute",ae.left=ve.x+"px",ae.top=ve.y+"px",o.body.appendChild(ie)}}else U=new L(w),w=null;this._project=y,this._scope=y._scope,this._element=w,this._pixelRatio||(this._pixelRatio=r&&r.devicePixelRatio||1),this._setElementSize(U.width,U.height),this._viewSize=U,u._views.push(this),u._viewsById[this._id]=this,(this._matrix=new pe)._owner=this,u._focused||(u._focused=this),this._frameItems={},this._frameItemCount=0,this._itemEvents={native:{},virtual:{}},this._autoUpdate=!yt.agent.node,this._needsUpdate=!1},remove:function(){if(!this._project)return!1;Kt._focused===this&&(Kt._focused=null),Kt._views.splice(Kt._views.indexOf(this),1),delete Kt._viewsById[this._id];var u=this._project;return u._view===this&&(u._view=null),qi.remove(this._element,this._viewEvents),qi.remove(r,this._windowEvents),this._element=this._project=null,this.off("frame"),this._animate=!1,this._frameItems={},!0},_events:n.each(ye._itemHandlers.concat(["onResize","onKeyDown","onKeyUp"]),function(u){this[u]={}},{onFrame:{install:function(){this.play()},uninstall:function(){this.pause()}}}),_animate:!1,_time:0,_count:0,getAutoUpdate:function(){return this._autoUpdate},setAutoUpdate:function(u){this._autoUpdate=u,u&&this.requestUpdate()},update:function(){},draw:function(){this.update()},requestUpdate:function(){if(!this._requested){var u=this;qi.requestAnimationFrame(function(){if(u._requested=!1,u._animate){u.requestUpdate();var y=u._element;(!Vi.getPrefixed(o,"hidden")||h.getAttribute(y,"keepalive")==="true")&&Vi.isInView(y)&&u._handleFrame()}u._autoUpdate&&u.update()}),this._requested=!0}},play:function(){this._animate=!0,this.requestUpdate()},pause:function(){this._animate=!1},_handleFrame:function(){yt=this._scope;var u=Date.now()/1e3,y=this._last?u-this._last:0;this._last=u,this.emit("frame",new n({delta:y,time:this._time+=y,count:this._count++})),this._stats&&this._stats.update()},_animateItem:function(u,y){var w=this._frameItems;y?(w[u._id]={item:u,time:0,count:0},++this._frameItemCount===1&&this.on("frame",this._handleFrameItems)):(delete w[u._id],--this._frameItemCount===0&&this.off("frame",this._handleFrameItems))},_handleFrameItems:function(u){for(var y in this._frameItems){var w=this._frameItems[y];w.item.emit("frame",new n(u,{time:w.time+=u.delta,count:w.count++}))}},_changed:function(){this._project._changed(4097),this._bounds=this._decomposed=s},getElement:function(){return this._element},getPixelRatio:function(){return this._pixelRatio},getResolution:function(){return this._pixelRatio*72},getViewSize:function(){var u=this._viewSize;return new H(u.width,u.height,this,"setViewSize")},setViewSize:function(){var u=L.read(arguments),y=u.subtract(this._viewSize);y.isZero()||(this._setElementSize(u.width,u.height),this._viewSize.set(u),this._changed(),this.emit("resize",{size:u,delta:y}),this._autoUpdate&&this.update())},_setElementSize:function(u,y){var w=this._element;w&&(w.width!==u&&(w.width=u),w.height!==y&&(w.height=y))},getBounds:function(){return this._bounds||(this._bounds=this._matrix.inverted()._transformBounds(new Y(new I,this._viewSize))),this._bounds},getSize:function(){return this.getBounds().getSize()},isVisible:function(){return Vi.isInView(this._element)},isInserted:function(){return Vi.isInserted(this._element)},getPixelSize:function(u){var y=this._element,w;if(y){var D=y.parentNode,N=o.createElement("div");N.style.fontSize=u,D.appendChild(N),w=parseFloat(Vi.getStyles(N).fontSize),D.removeChild(N)}else w=parseFloat(w);return w},getTextWidth:function(u,y){return 0}},n.each(["rotate","scale","shear","skew"],function(u){var y=u==="rotate";this[u]=function(){var w=arguments,D=(y?n:I).read(w),N=I.read(w,0,{readNull:!0});return this.transform(new pe()[u](D,N||this.getCenter(!0)))}},{_decompose:function(){return this._decomposed||(this._decomposed=this._matrix.decompose())},translate:function(){var u=new pe;return this.transform(u.translate.apply(u,arguments))},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(){var u=I.read(arguments);this.translate(this.getCenter().subtract(u))},getZoom:function(){var u=this._decompose().scaling;return(u.x+u.y)/2},setZoom:function(u){this.transform(new pe().scale(u/this.getZoom(),this.getCenter()))},getRotation:function(){return this._decompose().rotation},setRotation:function(u){var y=this.getRotation();y!=null&&u!=null&&this.rotate(u-y)},getScaling:function(){var u=this._decompose().scaling;return new W(u.x,u.y,this,"setScaling")},setScaling:function(){var u=this.getScaling(),y=I.read(arguments,0,{clone:!0,readNull:!0});u&&y&&this.scale(y.x/u.x,y.y/u.y)},getMatrix:function(){return this._matrix},setMatrix:function(){var u=this._matrix;u.set.apply(u,arguments)},transform:function(u){this._matrix.append(u)},scrollBy:function(){this.translate(I.read(arguments).negate())}}),{projectToView:function(){return this._matrix._transformPoint(I.read(arguments))},viewToProject:function(){return this._matrix._inverseTransform(I.read(arguments))},getEventPoint:function(u){return this.viewToProject(qi.getOffset(u,this._element))}},{statics:{_views:[],_viewsById:{},_id:0,create:function(u,y){o&&typeof y=="string"&&(y=o.getElementById(y));var w=r?zs:Kt;return new w(u,y)}}},new function(){if(!r)return;var u,y,w=!1,D=!1;function N(nt){var pt=qi.getTarget(nt);return pt.getAttribute&&Kt._viewsById[pt.getAttribute("id")]}function U(){var nt=Kt._focused;if(!nt||!nt.isVisible()){for(var pt=0,ft=Kt._views.length;pt<ft;pt++)if((nt=Kt._views[pt]).isVisible()){Kt._focused=y=nt;break}}}function te(nt,pt,ft){nt._handleMouseEvent("mousemove",pt,ft)}var J=r.navigator,ie,ae,ve;J.pointerEnabled||J.msPointerEnabled?(ie="pointerdown MSPointerDown",ae="pointermove MSPointerMove",ve="pointerup pointercancel MSPointerUp MSPointerCancel"):(ie="touchstart",ae="touchmove",ve="touchend touchcancel","ontouchstart"in r&&J.userAgent.match(/mobile|tablet|ip(ad|hone|od)|android|silk/i)||(ie+=" mousedown",ae+=" mousemove",ve+=" mouseup"));var Se={},be={mouseout:function(nt){var pt=Kt._focused,ft=qi.getRelatedTarget(nt);if(pt&&(!ft||ft.nodeName==="HTML")){var wt=qi.getOffset(nt,pt._element),Tt=wt.x,Vt=Math.abs,ni=Vt(Tt),ai=1<<25,Ht=ni-ai;wt.x=Vt(Ht)<ni?Ht*(Tt<0?-1:1):Tt,te(pt,nt,pt.viewToProject(wt))}},scroll:U};Se[ie]=function(nt){var pt=Kt._focused=N(nt);w||(w=!0,pt._handleMouseEvent("mousedown",nt))},be[ae]=function(nt){var pt=Kt._focused;if(!D){var ft=N(nt);ft?pt!==ft&&(pt&&te(pt,nt),u||(u=pt),pt=Kt._focused=y=ft):y&&y===pt&&(u&&!u.isInserted()&&(u=null),pt=Kt._focused=u,u=null,U())}pt&&te(pt,nt)},be[ie]=function(){D=!0},be[ve]=function(nt){var pt=Kt._focused;pt&&w&&pt._handleMouseEvent("mouseup",nt),D=w=!1},qi.add(o,be),qi.add(r,{load:U});var ge=!1,Ce=!1,Ne={doubleclick:"click",mousedrag:"mousemove"},qe=!1,Ae,ke,me,Te,Re,Fe,Ye,je;function Ze(nt,pt,ft,wt,Tt,Vt,ni){var ai=!1,Ht;function Ci(Ti,Pi){if(Ti.responds(Pi)){if(Ht||(Ht=new K(Pi,wt,Tt,pt||Ti,Vt?Tt.subtract(Vt):null)),Ti.emit(Pi,Ht)&&(ge=!0,Ht.prevented&&(Ce=!0),Ht.stopped))return ai=!0}else{var wi=Ne[Pi];if(wi)return Ci(Ti,wi)}}for(;nt&&nt!==ni&&!Ci(nt,ft);)nt=nt._parent;return ai}function tt(nt,pt,ft,wt,Tt,Vt){return nt._project.removeOn(ft),Ce=ge=!1,Re&&Ze(Re,null,ft,wt,Tt,Vt)||pt&&pt!==Re&&!pt.isDescendant(Re)&&Ze(pt,null,ft==="mousedrag"?"mousemove":ft,wt,Tt,Vt,Re)||Ze(nt,Re||pt||nt,ft,wt,Tt,Vt)}var ut={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}};return{_viewEvents:Se,_handleMouseEvent:function(nt,pt,ft){var wt=this._itemEvents,Tt=wt.native[nt],Vt=nt==="mousemove",ni=this._scope.tool,ai=this;function Ht(ds){return wt.virtual[ds]||ai.responds(ds)||ni&&ni.responds(ds)}Vt&&w&&Ht("mousedrag")&&(nt="mousedrag"),ft||(ft=this.getEventPoint(pt));var Ci=this.getBounds().contains(ft),Ti=Tt&&Ci&&ai._project.hitTest(ft,{tolerance:0,fill:!0,stroke:!0}),Pi=Ti&&Ti.item||null,wi=!1,Qt={};if(Qt[nt.substr(5)]=!0,Tt&&Pi!==Te&&(Te&&Ze(Te,null,"mouseleave",pt,ft),Pi&&Ze(Pi,null,"mouseenter",pt,ft),Te=Pi),qe^Ci&&(Ze(this,null,Ci?"mouseenter":"mouseleave",pt,ft),wi=!0),(Ci||Qt.drag)&&!ft.equals(ke)&&(tt(this,Pi,Vt?nt:"mousemove",pt,ft,ke),wi=!0),qe=Ci,Qt.down&&Ci||Qt.up&&Ae){if(tt(this,Pi,nt,pt,ft,Ae),Qt.down){if(je=Pi===Fe&&Date.now()-Ye<300,me=Fe=Pi,!Ce&&Pi){for(var Oi=Pi;Oi&&!Oi.responds("mousedrag");)Oi=Oi._parent;Oi&&(Re=Pi)}Ae=ft}else Qt.up&&(!Ce&&Pi===me&&(Ye=Date.now(),tt(this,Pi,je?"doubleclick":"click",pt,ft,Ae),je=!1),me=Re=null);qe=!1,wi=!0}ke=ft,wi&&ni&&(ge=ni._handleMouseEvent(nt,pt,ft,Qt)||ge),pt.cancelable!==!1&&(ge&&!Qt.move||Qt.down&&Ht("mouseup"))&&pt.preventDefault()},_handleKeyEvent:function(nt,pt,ft,wt){var Tt=this._scope,Vt=Tt.tool,ni;function ai(Ht){Ht.responds(nt)&&(yt=Tt,Ht.emit(nt,ni=ni||new gs(nt,pt,ft,wt)))}this.isVisible()&&(ai(this),Vt&&Vt.responds(nt)&&ai(Vt))},_countItemEvent:function(nt,pt){var ft=this._itemEvents,wt=ft.native,Tt=ft.virtual;for(var Vt in ut)wt[Vt]=(wt[Vt]||0)+(ut[Vt][nt]||0)*pt;Tt[nt]=(Tt[nt]||0)+pt},statics:{updateFocus:U,_resetState:function(){w=D=ge=qe=!1,u=y=Ae=ke=me=Te=Re=Fe=Ye=je=null}}}}),zs=Kt.extend({_class:"CanvasView",initialize:function(y,w){if(!(w instanceof r.HTMLCanvasElement)){var D=L.read(arguments,1);if(D.isZero())throw new Error("Cannot create CanvasView with the provided argument: "+n.slice(arguments,1));w=et.getCanvas(D)}var N=this._context=w.getContext("2d");if(N.save(),this._pixelRatio=1,!/^off|false$/.test(h.getAttribute(w,"hidpi"))){var U=r.devicePixelRatio||1,te=Vi.getPrefixed(N,"backingStorePixelRatio")||1;this._pixelRatio=U/te}Kt.call(this,y,w),this._needsUpdate=!0},remove:function u(){return this._context.restore(),u.base.call(this)},_setElementSize:function u(y,w){var D=this._pixelRatio;if(u.base.call(this,y*D,w*D),D!==1){var N=this._element,U=this._context;if(!h.hasAttribute(N,"resize")){var te=N.style;te.width=y+"px",te.height=w+"px"}U.restore(),U.save(),U.scale(D,D)}},getContext:function(){return this._context},getPixelSize:function u(y){var w=yt.agent,D;if(w&&w.firefox)D=u.base.call(this,y);else{var N=this._context,U=N.font;N.font=y+" serif",D=parseFloat(N.font),N.font=U}return D},getTextWidth:function(u,y){var w=this._context,D=w.font,N=0;w.font=u;for(var U=0,te=y.length;U<te;U++)N=Math.max(N,w.measureText(y[U]).width);return w.font=D,N},update:function(){if(!this._needsUpdate)return!1;var u=this._project,y=this._context,w=this._viewSize;return y.clearRect(0,0,w.width+1,w.height+1),u&&u.draw(y,this._matrix,this._pixelRatio),this._needsUpdate=!1,!0}}),ls=n.extend({_class:"Event",initialize:function(y){this.event=y,this.type=y&&y.type},prevented:!1,stopped:!1,preventDefault:function(){this.prevented=!0,this.event.preventDefault()},stopPropagation:function(){this.stopped=!0,this.event.stopPropagation()},stop:function(){this.stopPropagation(),this.preventDefault()},getTimeStamp:function(){return this.event.timeStamp},getModifiers:function(){return Ws.modifiers}}),gs=ls.extend({_class:"KeyEvent",initialize:function(y,w,D,N){this.type=y,this.event=w,this.key=D,this.character=N},toString:function(){return"{ type: '"+this.type+"', key: '"+this.key+"', character: '"+this.character+"', modifiers: "+this.getModifiers()+" }"}}),Ws=new function(){var u={"	":"tab"," ":"space","\b":"backspace","":"delete",Spacebar:"space",Del:"delete",Win:"meta",Esc:"escape"},y={tab:"	",space:" ",enter:"\r"},w={},D={},N,U,te=new n({shift:!1,control:!1,alt:!1,meta:!1,capsLock:!1,space:!1}).inject({option:{get:function(){return this.alt}},command:{get:function(){var ae=yt&&yt.agent;return ae&&ae.mac?this.meta:this.control}}});function J(ae){var ve=ae.key||ae.keyIdentifier;return ve=/^U\+/.test(ve)?String.fromCharCode(parseInt(ve.substr(2),16)):/^Arrow[A-Z]/.test(ve)?ve.substr(5):ve==="Unidentified"||ve===s?String.fromCharCode(ae.keyCode):ve,u[ve]||(ve.length>1?n.hyphenate(ve):ve.toLowerCase())}function ie(ae,ve,Se,be){var ge=Kt._focused,Ce;if(w[ve]=ae,ae?D[ve]=Se:delete D[ve],ve.length>1&&(Ce=n.camelize(ve))in te){te[Ce]=ae;var Ne=yt&&yt.agent;if(Ce==="meta"&&Ne&&Ne.mac)if(ae)N={};else{for(var qe in N)qe in D&&ie(!1,qe,N[qe],be);N=null}}else ae&&N&&(N[ve]=Se);ge&&ge._handleKeyEvent(ae?"keydown":"keyup",be,ve,Se)}return qi.add(o,{keydown:function(ae){var ve=J(ae),Se=yt&&yt.agent;ve.length>1||Se&&Se.chrome&&(ae.altKey||Se.mac&&ae.metaKey||!Se.mac&&ae.ctrlKey)?ie(!0,ve,y[ve]||(ve.length>1?"":ve),ae):U=ve},keypress:function(ae){if(U){var ve=J(ae),Se=ae.charCode,be=Se>=32?String.fromCharCode(Se):ve.length>1?"":ve;ve!==U&&(ve=be.toLowerCase()),ie(!0,ve,be,ae),U=null}},keyup:function(ae){var ve=J(ae);ve in D&&ie(!1,ve,D[ve],ae)}}),qi.add(r,{blur:function(ae){for(var ve in D)ie(!1,ve,D[ve],ae)}}),{modifiers:te,isDown:function(ae){return!!w[ae]}}},K=ls.extend({_class:"MouseEvent",initialize:function(y,w,D,N,U){this.type=y,this.event=w,this.point=D,this.target=N,this.delta=U},toString:function(){return"{ type: '"+this.type+"', point: "+this.point+", target: "+this.target+(this.delta?", delta: "+this.delta:"")+", modifiers: "+this.getModifiers()+" }"}}),He=ls.extend({_class:"ToolEvent",_item:null,initialize:function(y,w,D){this.tool=y,this.type=w,this.event=D},_choosePoint:function(u,y){return u||(y?y.clone():null)},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(u){this._point=u},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(u){this._lastPoint=u},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(u){this._downPoint=u},getMiddlePoint:function(){return!this._middlePoint&&this.tool._lastPoint?this.tool._point.add(this.tool._lastPoint).divide(2):this._middlePoint},setMiddlePoint:function(u){this._middlePoint=u},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(u){this._delta=u},getCount:function(){return this.tool[/^mouse(down|up)$/.test(this.type)?"_downCount":"_moveCount"]},setCount:function(u){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=u},getItem:function(){if(!this._item){var u=this.tool._scope.project.hitTest(this.getPoint());if(u){for(var y=u.item,w=y._parent;/^(Group|CompoundPath)$/.test(w._class);)y=w,w=w._parent;this._item=y}}return this._item},setItem:function(u){this._item=u},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}});g.extend({_class:"Tool",_list:"tools",_reference:"tool",_events:["onMouseDown","onMouseUp","onMouseDrag","onMouseMove","onActivate","onDeactivate","onEditOptions","onKeyDown","onKeyUp"],initialize:function(y){g.call(this),this._moveCount=-1,this._downCount=-1,this.set(y)},getMinDistance:function(){return this._minDistance},setMinDistance:function(u){this._minDistance=u,u!=null&&this._maxDistance!=null&&u>this._maxDistance&&(this._maxDistance=u)},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(u){this._maxDistance=u,this._minDistance!=null&&u!=null&&u<this._minDistance&&(this._minDistance=u)},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(u){this._minDistance=this._maxDistance=u},_handleMouseEvent:function(u,y,w,D){yt=this._scope,D.drag&&!this.responds(u)&&(u="mousemove");var N=D.move||D.drag,U=this.responds(u),te=this.minDistance,J=this.maxDistance,ie=!1,ae=this;function ve(be,ge){var Ce=w,Ne=N?ae._point:ae._downPoint||Ce;if(N){if(ae._moveCount>=0&&Ce.equals(Ne))return!1;if(Ne&&(be!=null||ge!=null)){var qe=Ce.subtract(Ne),Ae=qe.getLength();if(Ae<(be||0))return!1;ge&&(Ce=Ne.add(qe.normalize(Math.min(Ae,ge))))}ae._moveCount++}return ae._point=Ce,ae._lastPoint=Ne||Ce,D.down&&(ae._moveCount=-1,ae._downPoint=Ce,ae._downCount++),!0}function Se(){U&&(ie=ae.emit(u,new He(ae,u,y))||ie)}if(D.down)ve(),Se();else if(D.up)ve(null,J),Se();else if(U)for(;ve(te,J);)Se();return ie}});var We=n.extend(l,{_class:"Tween",statics:{easings:new n({linear:function(u){return u},easeInQuad:function(u){return u*u},easeOutQuad:function(u){return u*(2-u)},easeInOutQuad:function(u){return u<.5?2*u*u:-1+2*(2-u)*u},easeInCubic:function(u){return u*u*u},easeOutCubic:function(u){return--u*u*u+1},easeInOutCubic:function(u){return u<.5?4*u*u*u:(u-1)*(2*u-2)*(2*u-2)+1},easeInQuart:function(u){return u*u*u*u},easeOutQuart:function(u){return 1- --u*u*u*u},easeInOutQuart:function(u){return u<.5?8*u*u*u*u:1-8*--u*u*u*u},easeInQuint:function(u){return u*u*u*u*u},easeOutQuint:function(u){return 1+--u*u*u*u*u},easeInOutQuint:function(u){return u<.5?16*u*u*u*u*u:1+16*--u*u*u*u*u}})},initialize:function u(y,w,D,N,U,te){this.object=y;var J=typeof U,ie=J==="function";this.type=ie?J:J==="string"?U:"linear",this.easing=ie?U:u.easings[this.type],this.duration=N,this.running=!1,this._then=null,this._startTime=null;var ae=w||D;this._keys=ae?Object.keys(ae):[],this._parsedKeys=this._parseKeys(this._keys),this._from=ae&&this._getState(w),this._to=ae&&this._getState(D),te!==!1&&this.start()},then:function(u){return this._then=u,this},start:function(){return this._startTime=null,this.running=!0,this},stop:function(){return this.running=!1,this},update:function(u){if(this.running){u>=1&&(u=1,this.running=!1);for(var y=this.easing(u),w=this._keys,D=function(ve){return typeof ve=="function"?ve(y,u):ve},N=0,U=w&&w.length;N<U;N++){var te=w[N],J=D(this._from[te]),ie=D(this._to[te]),ae=J&&ie&&J.__add&&ie.__add?ie.__subtract(J).__multiply(y).__add(J):(ie-J)*y+J;this._setProperty(this._parsedKeys[te],ae)}this.responds("update")&&this.emit("update",new n({progress:u,factor:y})),!this.running&&this._then&&this._then(this.object)}return this},_events:{onUpdate:{}},_handleFrame:function(u){var y=this._startTime,w=y?(u-y)/this.duration:0;y||(this._startTime=u),this.update(w)},_getState:function(u){for(var y=this._keys,w={},D=0,N=y.length;D<N;D++){var U=y[D],te=this._parsedKeys[U],J=this._getProperty(te),ie;if(u){var ae=this._resolveValue(J,u[U]);this._setProperty(te,ae),ie=this._getProperty(te),ie=ie&&ie.clone?ie.clone():ie,this._setProperty(te,J)}else ie=J&&J.clone?J.clone():J;w[U]=ie}return w},_resolveValue:function(u,y){if(y){if(Array.isArray(y)&&y.length===2){var w=y[0];return w&&w.match&&w.match(/^[+\-\*\/]=/)?this._calculate(u,w[0],y[1]):y}else if(typeof y=="string"){var D=y.match(/^[+\-*/]=(.*)/);if(D){var N=JSON.parse(D[1].replace(/(['"])?([a-zA-Z0-9_]+)(['"])?:/g,'"$2": '));return this._calculate(u,y[0],N)}}}return y},_calculate:function(u,y,w){return yt.PaperScript.calculateBinary(u,y,w)},_parseKeys:function(u){for(var y={},w=0,D=u.length;w<D;w++){var N=u[w],U=N.replace(/\.([^.]*)/g,"/$1").replace(/\[['"]?([^'"\]]*)['"]?\]/g,"/$1");y[N]=U.split("/")}return y},_getProperty:function(u,y){for(var w=this.object,D=0,N=u.length-(y||0);D<N&&w;D++)w=w[u[D]];return w},_setProperty:function(u,y){var w=this._getProperty(u,1);w&&(w[u[u.length-1]]=y)}}),it={request:function(u){var y=new t.XMLHttpRequest;return y.open((u.method||"get").toUpperCase(),u.url,n.pick(u.async,!0)),u.mimeType&&y.overrideMimeType(u.mimeType),y.onload=function(){var w=y.status;w===0||w===200?u.onLoad&&u.onLoad.call(y,y.responseText):y.onerror()},y.onerror=function(){var w=y.status,D='Could not load "'+u.url+'" (Status: '+w+")";if(u.onError)u.onError(D,w);else throw new Error(D)},y.send(null)}},et=n.exports.CanvasProvider={canvases:[],getCanvas:function(u,y,w){if(!r)return null;var D,N=!0;typeof u=="object"&&(y=u.height,u=u.width),this.canvases.length?D=this.canvases.pop():(D=o.createElement("canvas"),N=!1);var U=D.getContext("2d",w||{});if(!U)throw new Error("Canvas "+D+" is unable to provide a 2D context.");return D.width===u&&D.height===y?N&&U.clearRect(0,0,u+1,y+1):(D.width=u,D.height=y),U.save(),D},getContext:function(u,y,w){var D=this.getCanvas(u,y,w);return D?D.getContext("2d",w||{}):null},release:function(u){var y=u&&u.canvas?u.canvas:u;y&&y.getContext&&(y.getContext("2d").restore(),this.canvases.push(y))}},Ie=new function(){var u=Math.min,y=Math.max,w=Math.abs,D,N,U,te,J,ie,ae,ve,Se,be,ge;function Ce(Re,Fe,Ye){return .2989*Re+.587*Fe+.114*Ye}function Ne(Re,Fe,Ye,tt){var Ze=tt-Ce(Re,Fe,Ye);Se=Re+Ze,be=Fe+Ze,ge=Ye+Ze;var tt=Ce(Se,be,ge),ut=u(Se,be,ge),nt=y(Se,be,ge);if(ut<0){var pt=tt-ut;Se=tt+(Se-tt)*tt/pt,be=tt+(be-tt)*tt/pt,ge=tt+(ge-tt)*tt/pt}if(nt>255){var ft=255-tt,wt=nt-tt;Se=tt+(Se-tt)*ft/wt,be=tt+(be-tt)*ft/wt,ge=tt+(ge-tt)*ft/wt}}function qe(Re,Fe,Ye){return y(Re,Fe,Ye)-u(Re,Fe,Ye)}function Ae(Re,Fe,Ye,je){var Ze=[Re,Fe,Ye],tt=y(Re,Fe,Ye),ut=u(Re,Fe,Ye),nt;ut=ut===Re?0:ut===Fe?1:2,tt=tt===Re?0:tt===Fe?1:2,nt=u(ut,tt)===0?y(ut,tt)===1?2:1:0,Ze[tt]>Ze[ut]?(Ze[nt]=(Ze[nt]-Ze[ut])*je/(Ze[tt]-Ze[ut]),Ze[tt]=je):Ze[nt]=Ze[tt]=0,Ze[ut]=0,Se=Ze[0],be=Ze[1],ge=Ze[2]}var ke={multiply:function(){Se=J*D/255,be=ie*N/255,ge=ae*U/255},screen:function(){Se=J+D-J*D/255,be=ie+N-ie*N/255,ge=ae+U-ae*U/255},overlay:function(){Se=J<128?2*J*D/255:255-2*(255-J)*(255-D)/255,be=ie<128?2*ie*N/255:255-2*(255-ie)*(255-N)/255,ge=ae<128?2*ae*U/255:255-2*(255-ae)*(255-U)/255},"soft-light":function(){var Re=D*J/255;Se=Re+J*(255-(255-J)*(255-D)/255-Re)/255,Re=N*ie/255,be=Re+ie*(255-(255-ie)*(255-N)/255-Re)/255,Re=U*ae/255,ge=Re+ae*(255-(255-ae)*(255-U)/255-Re)/255},"hard-light":function(){Se=D<128?2*D*J/255:255-2*(255-D)*(255-J)/255,be=N<128?2*N*ie/255:255-2*(255-N)*(255-ie)/255,ge=U<128?2*U*ae/255:255-2*(255-U)*(255-ae)/255},"color-dodge":function(){Se=J===0?0:D===255?255:u(255,255*J/(255-D)),be=ie===0?0:N===255?255:u(255,255*ie/(255-N)),ge=ae===0?0:U===255?255:u(255,255*ae/(255-U))},"color-burn":function(){Se=J===255?255:D===0?0:y(0,255-(255-J)*255/D),be=ie===255?255:N===0?0:y(0,255-(255-ie)*255/N),ge=ae===255?255:U===0?0:y(0,255-(255-ae)*255/U)},darken:function(){Se=J<D?J:D,be=ie<N?ie:N,ge=ae<U?ae:U},lighten:function(){Se=J>D?J:D,be=ie>N?ie:N,ge=ae>U?ae:U},difference:function(){Se=J-D,Se<0&&(Se=-Se),be=ie-N,be<0&&(be=-be),ge=ae-U,ge<0&&(ge=-ge)},exclusion:function(){Se=J+D*(255-J-J)/255,be=ie+N*(255-ie-ie)/255,ge=ae+U*(255-ae-ae)/255},hue:function(){Ae(D,N,U,qe(J,ie,ae)),Ne(Se,be,ge,Ce(J,ie,ae))},saturation:function(){Ae(J,ie,ae,qe(D,N,U)),Ne(Se,be,ge,Ce(J,ie,ae))},luminosity:function(){Ne(J,ie,ae,Ce(D,N,U))},color:function(){Ne(D,N,U,Ce(J,ie,ae))},add:function(){Se=u(J+D,255),be=u(ie+N,255),ge=u(ae+U,255)},subtract:function(){Se=y(J-D,0),be=y(ie-N,0),ge=y(ae-U,0)},average:function(){Se=(J+D)/2,be=(ie+N)/2,ge=(ae+U)/2},negation:function(){Se=255-w(255-D-J),be=255-w(255-N-ie),ge=255-w(255-U-ae)}},me=this.nativeModes=n.each(["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","lighter","darker","copy","xor"],function(Re){this[Re]=!0},{}),Te=et.getContext(1,1,{willReadFrequently:!0});Te&&(n.each(ke,function(Re,Fe){var Ye=Fe==="darken",je=!1;Te.save();try{Te.fillStyle=Ye?"#300":"#a00",Te.fillRect(0,0,1,1),Te.globalCompositeOperation=Fe,Te.globalCompositeOperation===Fe&&(Te.fillStyle=Ye?"#a00":"#300",Te.fillRect(0,0,1,1),je=Te.getImageData(0,0,1,1).data[0]!==Ye?170:51)}catch{}Te.restore(),me[Fe]=je}),et.release(Te)),this.process=function(Re,Fe,Ye,je,Ze){var tt=Fe.canvas,ut=Re==="normal";if(ut||me[Re])Ye.save(),Ye.setTransform(1,0,0,1,0,0),Ye.globalAlpha=je,ut||(Ye.globalCompositeOperation=Re),Ye.drawImage(tt,Ze.x,Ze.y),Ye.restore();else{var nt=ke[Re];if(!nt)return;for(var pt=Ye.getImageData(Ze.x,Ze.y,tt.width,tt.height),ft=pt.data,wt=Fe.getImageData(0,0,tt.width,tt.height).data,Tt=0,Vt=ft.length;Tt<Vt;Tt+=4){D=wt[Tt],J=ft[Tt],N=wt[Tt+1],ie=ft[Tt+1],U=wt[Tt+2],ae=ft[Tt+2],te=wt[Tt+3],ve=ft[Tt+3],nt();var ni=te*je/255,ai=1-ni;ft[Tt]=ni*Se+ai*J,ft[Tt+1]=ni*be+ai*ie,ft[Tt+2]=ni*ge+ai*ae,ft[Tt+3]=te*je+ai*ve}Ye.putImageData(pt,Ze.x,Ze.y)}}},Ve=new function(){var u="http://www.w3.org/2000/svg",y="http://www.w3.org/2000/xmlns",w="http://www.w3.org/1999/xlink",D={href:w,xlink:y,xmlns:y+"/","xmlns:xlink":y+"/"};function N(J,ie,ae){return te(o.createElementNS(u,J),ie,ae)}function U(J,ie){var ae=D[ie],ve=ae?J.getAttributeNS(ae,ie):J.getAttribute(ie);return ve==="null"?null:ve}function te(J,ie,ae){for(var ve in ie){var Se=ie[ve],be=D[ve];typeof Se=="number"&&ae&&(Se=ae.number(Se)),be?J.setAttributeNS(be,ve,Se):J.setAttribute(ve,Se)}return J}return{svg:u,xmlns:y,xlink:w,create:N,get:U,set:te}},Me=n.each({fillColor:["fill","color"],fillRule:["fill-rule","string"],strokeColor:["stroke","color"],strokeWidth:["stroke-width","number"],strokeCap:["stroke-linecap","string"],strokeJoin:["stroke-linejoin","string"],strokeScaling:["vector-effect","lookup",{true:"none",false:"non-scaling-stroke"},function(u,y){return!y&&(u instanceof ht||u instanceof Z||u instanceof jt)}],miterLimit:["stroke-miterlimit","number"],dashArray:["stroke-dasharray","array"],dashOffset:["stroke-dashoffset","number"],fontFamily:["font-family","string"],fontWeight:["font-weight","string"],fontSize:["font-size","number"],justification:["text-anchor","lookup",{left:"start",center:"middle",right:"end"}],opacity:["opacity","number"],blendMode:["mix-blend-mode","style"]},function(u,y){var w=n.capitalize(y),D=u[2];this[y]={type:u[1],property:y,attribute:u[0],toSVG:D,fromSVG:D&&n.each(D,function(N,U){this[N]=U},{}),exportFilter:u[3],get:"get"+w,set:"set"+w}},{});new function(){var u;function y(ke,me,Te){var Re=new n,Fe=ke.getTranslation();if(me){var Ye;ke.isInvertible()?(ke=ke._shiftless(),Ye=ke._inverseTransform(Fe),Fe=null):Ye=new I,Re[Te?"cx":"x"]=Ye.x,Re[Te?"cy":"y"]=Ye.y}if(!ke.isIdentity()){var je=ke.decompose();if(je){var Ze=[],tt=je.rotation,ut=je.scaling,nt=je.skewing;Fe&&!Fe.isZero()&&Ze.push("translate("+u.point(Fe)+")"),tt&&Ze.push("rotate("+u.number(tt)+")"),(!S.isZero(ut.x-1)||!S.isZero(ut.y-1))&&Ze.push("scale("+u.point(ut)+")"),nt.x&&Ze.push("skewX("+u.number(nt.x)+")"),nt.y&&Ze.push("skewY("+u.number(nt.y)+")"),Re.transform=Ze.join(" ")}else Re.transform="matrix("+ke.getValues().join(",")+")"}return Re}function w(ke,me){for(var Te=y(ke._matrix),Re=ke._children,Fe=Ve.create("g",Te,u),Ye=0,je=Re.length;Ye<je;Ye++){var Ze=Re[Ye],tt=qe(Ze,me);if(tt)if(Ze.isClipMask()){var ut=Ve.create("clipPath");ut.appendChild(tt),Ce(Ze,ut,"clip"),Ve.set(Fe,{"clip-path":"url(#"+ut.id+")"})}else Fe.appendChild(tt)}return Fe}function D(ke,me){var Te=y(ke._matrix,!0),Re=ke.getSize(),Fe=ke.getImage();return Te.x-=Re.width/2,Te.y-=Re.height/2,Te.width=Re.width,Te.height=Re.height,Te.href=me.embedImages==!1&&Fe&&Fe.src||ke.toDataURL(),Ve.create("image",Te,u)}function N(ke,me){var Te=me.matchShapes;if(Te){var Re=ke.toShape(!1);if(Re)return U(Re)}var Fe=ke._segments,Ye=Fe.length,je,Ze=y(ke._matrix);if(Te&&Ye>=2&&!ke.hasHandles())if(Ye>2){je=ke._closed?"polygon":"polyline";for(var tt=[],ut=0;ut<Ye;ut++)tt.push(u.point(Fe[ut]._point));Ze.points=tt.join(" ")}else{je="line";var nt=Fe[0]._point,pt=Fe[1]._point;Ze.set({x1:nt.x,y1:nt.y,x2:pt.x,y2:pt.y})}else je="path",Ze.d=ke.getPathData(null,me.precision);return Ve.create(je,Ze,u)}function U(ke){var me=ke._type,Te=ke._radius,Re=y(ke._matrix,!0,me!=="rectangle");if(me==="rectangle"){me="rect";var Fe=ke._size,Ye=Fe.width,je=Fe.height;Re.x-=Ye/2,Re.y-=je/2,Re.width=Ye,Re.height=je,Te.isZero()&&(Te=null)}return Te&&(me==="circle"?Re.r=Te:(Re.rx=Te.width,Re.ry=Te.height)),Ve.create(me,Re,u)}function te(ke,me){var Te=y(ke._matrix),Re=ke.getPathData(null,me.precision);return Re&&(Te.d=Re),Ve.create("path",Te,u)}function J(ke,me){var Te=y(ke._matrix,!0),Re=ke._definition,Fe=ge(Re,"symbol"),Ye=Re._item,je=Ye.getStrokeBounds();return Fe||(Fe=Ve.create("symbol",{viewBox:u.rectangle(je)}),Fe.appendChild(qe(Ye,me)),Ce(Re,Fe,"symbol")),Te.href="#"+Fe.id,Te.x+=je.x,Te.y+=je.y,Te.width=je.width,Te.height=je.height,Te.overflow="visible",Ve.create("use",Te,u)}function ie(ke){var me=ge(ke,"color");if(!me){var Te=ke.getGradient(),Re=Te._radial,Fe=ke.getOrigin(),Ye=ke.getDestination(),je;if(Re){je={cx:Fe.x,cy:Fe.y,r:Fe.getDistance(Ye)};var Ze=ke.getHighlight();Ze&&(je.fx=Ze.x,je.fy=Ze.y)}else je={x1:Fe.x,y1:Fe.y,x2:Ye.x,y2:Ye.y};je.gradientUnits="userSpaceOnUse",me=Ve.create((Re?"radial":"linear")+"Gradient",je,u);for(var tt=Te._stops,ut=0,nt=tt.length;ut<nt;ut++){var pt=tt[ut],ft=pt._color,wt=ft.getAlpha(),Tt=pt._offset;je={offset:Tt??ut/(nt-1)},ft&&(je["stop-color"]=ft.toCSS(!0)),wt<1&&(je["stop-opacity"]=wt),me.appendChild(Ve.create("stop",je,u))}Ce(ke,me,"color")}return"url(#"+me.id+")"}function ae(ke){var me=Ve.create("text",y(ke._matrix,!0),u);return me.textContent=ke._content,me}var ve={Group:w,Layer:w,Raster:D,Path:N,Shape:U,CompoundPath:te,SymbolItem:J,PointText:ae};function Se(ke,me,Te){var Re={},Fe=!Te&&ke.getParent(),Ye=[];return ke._name!=null&&(Re.id=ke._name),n.each(Me,function(je){var Ze=je.get,tt=je.type,ut=ke[Ze]();if(je.exportFilter?je.exportFilter(ke,ut):!Fe||!n.equals(Fe[Ze](),ut)){if(tt==="color"&&ut!=null){var nt=ut.getAlpha();nt<1&&(Re[je.attribute+"-opacity"]=nt)}tt==="style"?Ye.push(je.attribute+": "+ut):Re[je.attribute]=ut==null?"none":tt==="color"?ut.gradient?ie(ut):ut.toCSS(!0):tt==="array"?ut.join(","):tt==="lookup"?je.toSVG[ut]:ut}}),Ye.length&&(Re.style=Ye.join(";")),Re.opacity===1&&delete Re.opacity,ke._visible||(Re.visibility="hidden"),Ve.set(me,Re,u)}var be;function ge(ke,me){return be||(be={ids:{},svgs:{}}),ke&&be.svgs[me+"-"+(ke._id||ke.__id||(ke.__id=O.get("svg")))]}function Ce(ke,me,Te){be||ge();var Re=be.ids[Te]=(be.ids[Te]||0)+1;me.id=Te+"-"+Re,be.svgs[Te+"-"+(ke._id||ke.__id)]=me}function Ne(ke,me){var Te=ke,Re=null;if(be){Te=ke.nodeName.toLowerCase()==="svg"&&ke;for(var Fe in be.svgs)Re||(Te||(Te=Ve.create("svg"),Te.appendChild(ke)),Re=Te.insertBefore(Ve.create("defs"),Te.firstChild)),Re.appendChild(be.svgs[Fe]);be=null}return me.asString?new t.XMLSerializer().serializeToString(Te):Te}function qe(ke,me,Te){var Re=ve[ke._class],Fe=Re&&Re(ke,me);if(Fe){var Ye=me.onExport;Ye&&(Fe=Ye(ke,Fe,me)||Fe);var je=JSON.stringify(ke._data);je&&je!=="{}"&&je!=="null"&&Fe.setAttribute("data-paper-data",je)}return Fe&&Se(ke,Fe,Te)}function Ae(ke){return ke||(ke={}),u=new A(ke.precision),ke}ye.inject({exportSVG:function(ke){return ke=Ae(ke),Ne(qe(this,ke,!0),ke)}}),fe.inject({exportSVG:function(ke){ke=Ae(ke);var me=this._children,Te=this.getView(),Re=n.pick(ke.bounds,"view"),Fe=ke.matrix||Re==="view"&&Te._matrix,Ye=Fe&&pe.read([Fe]),je=Re==="view"?new Y([0,0],Te.getViewSize()):Re==="content"?ye._getBounds(me,Ye,{stroke:!0}).rect:Y.read([Re],0,{readNull:!0}),Ze={version:"1.1",xmlns:Ve.svg,"xmlns:xlink":Ve.xlink};je&&(Ze.width=je.width,Ze.height=je.height,(je.x||je.x===0||je.y||je.y===0)&&(Ze.viewBox=u.rectangle(je)));var tt=Ve.create("svg",Ze,u),ut=tt;Ye&&!Ye.isIdentity()&&(ut=tt.appendChild(Ve.create("g",y(Ye),u)));for(var nt=0,pt=me.length;nt<pt;nt++)ut.appendChild(qe(me[nt],ke,!0));return Ne(tt,ke)}})},new function(){var u={},y;function w(me,Te,Re,Fe,Ye,je){var Ze=Ve.get(me,Te)||je,tt=Ze==null?Fe?null:Re?"":0:Re?Ze:parseFloat(Ze);return/%\s*$/.test(Ze)?tt/100*(Ye?1:y[/x|^width/.test(Te)?"width":"height"]):tt}function D(me,Te,Re,Fe,Ye,je,Ze){return Te=w(me,Te||"x",!1,Fe,Ye,je),Re=w(me,Re||"y",!1,Fe,Ye,Ze),Fe&&(Te==null||Re==null)?null:new I(Te,Re)}function N(me,Te,Re,Fe,Ye){return Te=w(me,Te||"width",!1,Fe,Ye),Re=w(me,Re||"height",!1,Fe,Ye),Fe&&(Te==null||Re==null)?null:new L(Te,Re)}function U(me,Te,Re){return me==="none"?null:Te==="number"?parseFloat(me):Te==="array"?me?me.split(/[\s,]+/g).map(parseFloat):[]:Te==="color"?qe(me)||me:Te==="lookup"?Re[me]:me}function te(me,Te,Re,Fe){var Ye=me.childNodes,je=Te==="clippath",Ze=Te==="defs",tt=new Ee,ut=tt._project,nt=ut._currentStyle,pt=[];if(!je&&!Ze&&(tt=Ne(tt,me,Fe),ut._currentStyle=tt._style.clone()),Fe)for(var ft=me.querySelectorAll("defs"),wt=0,Tt=ft.length;wt<Tt;wt++)Ae(ft[wt],Re,!1);for(var wt=0,Tt=Ye.length;wt<Tt;wt++){var Vt=Ye[wt],ni;Vt.nodeType===1&&!/^defs$/i.test(Vt.nodeName)&&(ni=Ae(Vt,Re,!1))&&!(ni instanceof _t)&&pt.push(ni)}return tt.addChildren(pt),je&&(tt=Ne(tt.reduce(),me,Fe)),ut._currentStyle=nt,(je||Ze)&&(tt.remove(),tt=null),tt}function J(me,Te){for(var Re=me.getAttribute("points").match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g),Fe=[],Ye=0,je=Re.length;Ye<je;Ye+=2)Fe.push(new I(parseFloat(Re[Ye]),parseFloat(Re[Ye+1])));var Ze=new mt(Fe);return Te==="polygon"&&Ze.closePath(),Ze}function ie(me){return ht.create(me.getAttribute("d"))}function ae(me,Te){var Re=(w(me,"href",!0)||"").substring(1),Fe=Te==="radialgradient",Ye;if(Re)Ye=u[Re].getGradient(),Ye._radial^Fe&&(Ye=Ye.clone(),Ye._radial=Fe);else{for(var je=me.childNodes,Ze=[],tt=0,ut=je.length;tt<ut;tt++){var nt=je[tt];nt.nodeType===1&&Ze.push(Ne(new Li,nt))}Ye=new ki(Ze,Fe)}var pt,ft,wt,Tt=w(me,"gradientUnits",!0)!=="userSpaceOnUse";Fe?(pt=D(me,"cx","cy",!1,Tt,"50%","50%"),ft=pt.add(w(me,"r",!1,!1,Tt,"50%"),0),wt=D(me,"fx","fy",!0,Tt)):(pt=D(me,"x1","y1",!1,Tt,"0%","0%"),ft=D(me,"x2","y2",!1,Tt,"100%","0%"));var Vt=Ne(new oi(Ye,pt,ft,wt),me);return Vt._scaleToBounds=Tt,null}var ve={"#document":function(me,Te,Re,Fe){for(var Ye=me.childNodes,je=0,Ze=Ye.length;je<Ze;je++){var tt=Ye[je];if(tt.nodeType===1)return Ae(tt,Re,Fe)}},g:te,svg:te,clippath:te,polygon:J,polyline:J,path:ie,lineargradient:ae,radialgradient:ae,image:function(me){var Te=new ne(w(me,"href",!0));return Te.on("load",function(){var Re=N(me);this.setSize(Re);var Fe=D(me).add(Re.divide(2));this._matrix.append(new pe().translate(Fe))}),Te},symbol:function(me,Te,Re,Fe){return new _t(te(me,Te,Re,Fe),!0)},defs:te,use:function(me){var Te=(w(me,"href",!0)||"").substring(1),Re=u[Te],Fe=D(me);return Re?Re instanceof _t?Re.place(Fe):Re.clone().translate(Fe):null},circle:function(me){return new Z.Circle(D(me,"cx","cy"),w(me,"r"))},ellipse:function(me){return new Z.Ellipse({center:D(me,"cx","cy"),radius:N(me,"rx","ry")})},rect:function(me){return new Z.Rectangle(new Y(D(me),N(me)),N(me,"rx","ry"))},line:function(me){return new mt.Line(D(me,"x1","y1"),D(me,"x2","y2"))},text:function(me){var Te=new Ai(D(me).add(D(me,"dx","dy")));return Te.setContent(me.textContent.trim()||""),Te},switch:te};function Se(me,Te,Re,Fe){if(me.transform){for(var Ye=(Fe.getAttribute(Re)||"").split(/\)\s*/g),je=new pe,Ze=0,tt=Ye.length;Ze<tt;Ze++){var ut=Ye[Ze];if(!ut)break;for(var nt=ut.split(/\(\s*/),pt=nt[0],ft=nt[1].split(/[\s,]+/g),wt=0,Tt=ft.length;wt<Tt;wt++)ft[wt]=parseFloat(ft[wt]);switch(pt){case"matrix":je.append(new pe(ft[0],ft[1],ft[2],ft[3],ft[4],ft[5]));break;case"rotate":je.rotate(ft[0],ft[1]||0,ft[2]||0);break;case"translate":je.translate(ft[0],ft[1]||0);break;case"scale":je.scale(ft);break;case"skewX":je.skew(ft[0],0);break;case"skewY":je.skew(0,ft[0]);break}}me.transform(je)}}function be(me,Te,Re){var Fe=Re==="fill-opacity"?"getFillColor":"getStrokeColor",Ye=me[Fe]&&me[Fe]();Ye&&Ye.setAlpha(parseFloat(Te))}var ge=n.set(n.each(Me,function(me){this[me.attribute]=function(Te,Re){if(Te[me.set]&&(Te[me.set](U(Re,me.type,me.fromSVG)),me.type==="color")){var Fe=Te[me.get]();if(Fe&&Fe._scaleToBounds){var Ye=Te.getBounds();Fe.transform(new pe().translate(Ye.getPoint()).scale(Ye.getSize()))}}}},{}),{id:function(me,Te){u[Te]=me,me.setName&&me.setName(Te)},"clip-path":function(me,Te){var Re=qe(Te);if(Re)if(Re=Re.clone(),Re.setClipMask(!0),me instanceof Ee)me.insertChild(0,Re);else return new Ee(Re,me)},gradientTransform:Se,transform:Se,"fill-opacity":be,"stroke-opacity":be,visibility:function(me,Te){me.setVisible&&me.setVisible(Te==="visible")},display:function(me,Te){me.setVisible&&me.setVisible(Te!==null)},"stop-color":function(me,Te){me.setColor&&me.setColor(Te)},"stop-opacity":function(me,Te){me._color&&me._color.setAlpha(parseFloat(Te))},offset:function(me,Te){if(me.setOffset){var Re=Te.match(/(.*)%$/);me.setOffset(Re?Re[1]/100:parseFloat(Te))}},viewBox:function(me,Te,Re,Fe,Ye){var je=new Y(U(Te,"array")),Ze=N(Fe,null,null,!0),tt,ut;if(me instanceof Ee){var nt=Ze?Ze.divide(je.getSize()):1,ut=new pe().scale(nt).translate(je.getPoint().negate());tt=me}else me instanceof _t&&(Ze&&je.setSize(Ze),tt=me._item);if(tt){if(Ce(Fe,"overflow",Ye)!=="visible"){var pt=new Z.Rectangle(je);pt.setClipMask(!0),tt.addChild(pt)}ut&&tt.transform(ut)}}});function Ce(me,Te,Re){var Fe=me.attributes[Te],Ye=Fe&&Fe.value;if(!Ye&&me.style){var je=n.camelize(Te);Ye=me.style[je],!Ye&&Re.node[je]!==Re.parent[je]&&(Ye=Re.node[je])}return Ye?Ye==="none"?null:Ye:s}function Ne(me,Te,Re){var Fe=Te.parentNode,Ye={node:Vi.getStyles(Te)||{},parent:!Re&&!/^defs$/i.test(Fe.tagName)&&Vi.getStyles(Fe)||{}};return n.each(ge,function(je,Ze){var tt=Ce(Te,Ze,Ye);me=tt!==s&&je(me,tt,Ze,Te,Ye)||me}),me}function qe(me){var Te=me&&me.match(/\((?:["'#]*)([^"')]+)/),Re=Te&&Te[1],Fe=Re&&u[r?Re.replace(r.location.href.split("#")[0]+"#",""):Re];return Fe&&Fe._scaleToBounds&&(Fe=Fe.clone(),Fe._scaleToBounds=!0),Fe}function Ae(me,Te,Re){var Fe=me.nodeName.toLowerCase(),Ye=Fe!=="#document",je=o.body,Ze,tt,ut;Re&&Ye&&(y=yt.getView().getSize(),y=N(me,null,null,!0)||y,Ze=Ve.create("svg",{style:"stroke-width: 1px; stroke-miterlimit: 10"}),tt=me.parentNode,ut=me.nextSibling,Ze.appendChild(me),je.appendChild(Ze));var nt=yt.settings,pt=nt.applyMatrix,ft=nt.insertItems;nt.applyMatrix=!1,nt.insertItems=!1;var wt=ve[Fe],Tt=wt&&wt(me,Fe,Te,Re)||null;if(nt.insertItems=ft,nt.applyMatrix=pt,Tt){Ye&&!(Tt instanceof Ee)&&(Tt=Ne(Tt,me,Re));var Vt=Te.onImport,ni=Ye&&me.getAttribute("data-paper-data");Vt&&(Tt=Vt(me,Tt,Te)||Tt),Te.expandShapes&&Tt instanceof Z&&(Tt.remove(),Tt=Tt.toPath()),ni&&(Tt._data=JSON.parse(ni))}return Ze&&(je.removeChild(Ze),tt&&(ut?tt.insertBefore(me,ut):tt.appendChild(me))),Re&&(u={},Tt&&n.pick(Te.applyMatrix,pt)&&Tt.matrix.apply(!0,!0)),Tt}function ke(me,Te,Re){if(!me)return null;Te=typeof Te=="function"?{onLoad:Te}:Te||{};var Fe=yt,Ye=null;function je(nt){try{var pt=typeof nt=="object"?nt:new t.DOMParser().parseFromString(nt.trim(),"image/svg+xml");if(!pt.nodeName)throw pt=null,new Error("Unsupported SVG source: "+me);yt=Fe,Ye=Ae(pt,Te,!0),(!Te||Te.insert!==!1)&&Re._insertItem(s,Ye);var ft=Te.onLoad;ft&&ft(Ye,nt)}catch(wt){Ze(wt)}}function Ze(nt,pt){var ft=Te.onError;if(ft)ft(nt,pt);else throw new Error(nt)}if(typeof me=="string"&&!/^[\s\S]*</.test(me)){var tt=o.getElementById(me);tt?je(tt):it.request({url:me,async:!0,onLoad:je,onError:Ze})}else if(typeof File<"u"&&me instanceof File){var ut=new FileReader;return ut.onload=function(){je(ut.result)},ut.onerror=function(){Ze(ut.error)},ut.readAsText(me)}else je(me);return Ye}ye.inject({importSVG:function(me,Te){return ke(me,Te,this)}}),fe.inject({importSVG:function(me,Te){return this.activate(),ke(me,Te,this)}})};var yt=new(h.inject(n.exports,{Base:n,Numerical:S,Key:Ws,DomEvent:qi,DomElement:Vi,document:o,window:r,Symbol:_t,PlacedSymbol:Ke}));return yt.agent.node,typeof s=="function"&&s.amd?s("paper",yt):a&&(a.exports=yt),yt}).call(window,typeof self=="object"?self:null)})(paperJs0_12_17);var he1_1_1={exports:{}};/*! https://mths.be/he v1.1.1 by @mathias | MIT license */he1_1_1.exports;(function(a,t){(function(s){var r=t,o=a&&a.exports==r&&a,n=typeof commonjsGlobal=="object"&&commonjsGlobal;(n.global===n||n.window===n)&&(s=n);var l=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,h=/[\x01-\x7F]/g,g=/[\x01-\t\x0B\f\x0E-\x1F\x7F\x81\x8D\x8F\x90\x9D\xA0-\uFFFF]/g,d=/<\u20D2|=\u20E5|>\u20D2|\u205F\u200A|\u219D\u0338|\u2202\u0338|\u2220\u20D2|\u2229\uFE00|\u222A\uFE00|\u223C\u20D2|\u223D\u0331|\u223E\u0333|\u2242\u0338|\u224B\u0338|\u224D\u20D2|\u224E\u0338|\u224F\u0338|\u2250\u0338|\u2261\u20E5|\u2264\u20D2|\u2265\u20D2|\u2266\u0338|\u2267\u0338|\u2268\uFE00|\u2269\uFE00|\u226A\u0338|\u226A\u20D2|\u226B\u0338|\u226B\u20D2|\u227F\u0338|\u2282\u20D2|\u2283\u20D2|\u228A\uFE00|\u228B\uFE00|\u228F\u0338|\u2290\u0338|\u2293\uFE00|\u2294\uFE00|\u22B4\u20D2|\u22B5\u20D2|\u22D8\u0338|\u22D9\u0338|\u22DA\uFE00|\u22DB\uFE00|\u22F5\u0338|\u22F9\u0338|\u2933\u0338|\u29CF\u0338|\u29D0\u0338|\u2A6D\u0338|\u2A70\u0338|\u2A7D\u0338|\u2A7E\u0338|\u2AA1\u0338|\u2AA2\u0338|\u2AAC\uFE00|\u2AAD\uFE00|\u2AAF\u0338|\u2AB0\u0338|\u2AC5\u0338|\u2AC6\u0338|\u2ACB\uFE00|\u2ACC\uFE00|\u2AFD\u20E5|[\xA0-\u0113\u0116-\u0122\u0124-\u012B\u012E-\u014D\u0150-\u017E\u0192\u01B5\u01F5\u0237\u02C6\u02C7\u02D8-\u02DD\u0311\u0391-\u03A1\u03A3-\u03A9\u03B1-\u03C9\u03D1\u03D2\u03D5\u03D6\u03DC\u03DD\u03F0\u03F1\u03F5\u03F6\u0401-\u040C\u040E-\u044F\u0451-\u045C\u045E\u045F\u2002-\u2005\u2007-\u2010\u2013-\u2016\u2018-\u201A\u201C-\u201E\u2020-\u2022\u2025\u2026\u2030-\u2035\u2039\u203A\u203E\u2041\u2043\u2044\u204F\u2057\u205F-\u2063\u20AC\u20DB\u20DC\u2102\u2105\u210A-\u2113\u2115-\u211E\u2122\u2124\u2127-\u2129\u212C\u212D\u212F-\u2131\u2133-\u2138\u2145-\u2148\u2153-\u215E\u2190-\u219B\u219D-\u21A7\u21A9-\u21AE\u21B0-\u21B3\u21B5-\u21B7\u21BA-\u21DB\u21DD\u21E4\u21E5\u21F5\u21FD-\u2205\u2207-\u2209\u220B\u220C\u220F-\u2214\u2216-\u2218\u221A\u221D-\u2238\u223A-\u2257\u2259\u225A\u225C\u225F-\u2262\u2264-\u228B\u228D-\u229B\u229D-\u22A5\u22A7-\u22B0\u22B2-\u22BB\u22BD-\u22DB\u22DE-\u22E3\u22E6-\u22F7\u22F9-\u22FE\u2305\u2306\u2308-\u2310\u2312\u2313\u2315\u2316\u231C-\u231F\u2322\u2323\u232D\u232E\u2336\u233D\u233F\u237C\u23B0\u23B1\u23B4-\u23B6\u23DC-\u23DF\u23E2\u23E7\u2423\u24C8\u2500\u2502\u250C\u2510\u2514\u2518\u251C\u2524\u252C\u2534\u253C\u2550-\u256C\u2580\u2584\u2588\u2591-\u2593\u25A1\u25AA\u25AB\u25AD\u25AE\u25B1\u25B3-\u25B5\u25B8\u25B9\u25BD-\u25BF\u25C2\u25C3\u25CA\u25CB\u25EC\u25EF\u25F8-\u25FC\u2605\u2606\u260E\u2640\u2642\u2660\u2663\u2665\u2666\u266A\u266D-\u266F\u2713\u2717\u2720\u2736\u2758\u2772\u2773\u27C8\u27C9\u27E6-\u27ED\u27F5-\u27FA\u27FC\u27FF\u2902-\u2905\u290C-\u2913\u2916\u2919-\u2920\u2923-\u292A\u2933\u2935-\u2939\u293C\u293D\u2945\u2948-\u294B\u294E-\u2976\u2978\u2979\u297B-\u297F\u2985\u2986\u298B-\u2996\u299A\u299C\u299D\u29A4-\u29B7\u29B9\u29BB\u29BC\u29BE-\u29C5\u29C9\u29CD-\u29D0\u29DC-\u29DE\u29E3-\u29E5\u29EB\u29F4\u29F6\u2A00-\u2A02\u2A04\u2A06\u2A0C\u2A0D\u2A10-\u2A17\u2A22-\u2A27\u2A29\u2A2A\u2A2D-\u2A31\u2A33-\u2A3C\u2A3F\u2A40\u2A42-\u2A4D\u2A50\u2A53-\u2A58\u2A5A-\u2A5D\u2A5F\u2A66\u2A6A\u2A6D-\u2A75\u2A77-\u2A9A\u2A9D-\u2AA2\u2AA4-\u2AB0\u2AB3-\u2AC8\u2ACB\u2ACC\u2ACF-\u2ADB\u2AE4\u2AE6-\u2AE9\u2AEB-\u2AF3\u2AFD\uFB00-\uFB04]|\uD835[\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDCCF\uDD04\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDD6B]/g,A={"­":"shy","‌":"zwnj","‍":"zwj","‎":"lrm","⁣":"ic","⁢":"it","⁡":"af","‏":"rlm","​":"ZeroWidthSpace","⁠":"NoBreak","̑":"DownBreve","⃛":"tdot","⃜":"DotDot","	":"Tab","\n":"NewLine"," ":"puncsp"," ":"MediumSpace"," ":"thinsp"," ":"hairsp"," ":"emsp13"," ":"ensp"," ":"emsp14"," ":"emsp"," ":"numsp"," ":"nbsp","  ":"ThickSpace","‾":"oline",_:"lowbar","‐":"dash","–":"ndash","—":"mdash","―":"horbar",",":"comma",";":"semi","⁏":"bsemi",":":"colon","⩴":"Colone","!":"excl","¡":"iexcl","?":"quest","¿":"iquest",".":"period","‥":"nldr","…":"mldr","·":"middot","'":"apos","‘":"lsquo","’":"rsquo","‚":"sbquo","‹":"lsaquo","›":"rsaquo",'"':"quot","“":"ldquo","”":"rdquo","„":"bdquo","«":"laquo","»":"raquo","(":"lpar",")":"rpar","[":"lsqb","]":"rsqb","{":"lcub","}":"rcub","⌈":"lceil","⌉":"rceil","⌊":"lfloor","⌋":"rfloor","⦅":"lopar","⦆":"ropar","⦋":"lbrke","⦌":"rbrke","⦍":"lbrkslu","⦎":"rbrksld","⦏":"lbrksld","⦐":"rbrkslu","⦑":"langd","⦒":"rangd","⦓":"lparlt","⦔":"rpargt","⦕":"gtlPar","⦖":"ltrPar","⟦":"lobrk","⟧":"robrk","⟨":"lang","⟩":"rang","⟪":"Lang","⟫":"Rang","⟬":"loang","⟭":"roang","❲":"lbbrk","❳":"rbbrk","‖":"Vert","§":"sect","¶":"para","@":"commat","*":"ast","/":"sol",undefined:null,"&":"amp","#":"num","%":"percnt","‰":"permil","‱":"pertenk","†":"dagger","‡":"Dagger","•":"bull","⁃":"hybull","′":"prime","″":"Prime","‴":"tprime","⁗":"qprime","‵":"bprime","⁁":"caret","`":"grave","´":"acute","˜":"tilde","^":"Hat","¯":"macr","˘":"breve","˙":"dot","¨":"die","˚":"ring","˝":"dblac","¸":"cedil","˛":"ogon","ˆ":"circ","ˇ":"caron","°":"deg","©":"copy","®":"reg","℗":"copysr","℘":"wp","℞":"rx","℧":"mho","℩":"iiota","←":"larr","↚":"nlarr","→":"rarr","↛":"nrarr","↑":"uarr","↓":"darr","↔":"harr","↮":"nharr","↕":"varr","↖":"nwarr","↗":"nearr","↘":"searr","↙":"swarr","↝":"rarrw","↝̸":"nrarrw","↞":"Larr","↟":"Uarr","↠":"Rarr","↡":"Darr","↢":"larrtl","↣":"rarrtl","↤":"mapstoleft","↥":"mapstoup","↦":"map","↧":"mapstodown","↩":"larrhk","↪":"rarrhk","↫":"larrlp","↬":"rarrlp","↭":"harrw","↰":"lsh","↱":"rsh","↲":"ldsh","↳":"rdsh","↵":"crarr","↶":"cularr","↷":"curarr","↺":"olarr","↻":"orarr","↼":"lharu","↽":"lhard","↾":"uharr","↿":"uharl","⇀":"rharu","⇁":"rhard","⇂":"dharr","⇃":"dharl","⇄":"rlarr","⇅":"udarr","⇆":"lrarr","⇇":"llarr","⇈":"uuarr","⇉":"rrarr","⇊":"ddarr","⇋":"lrhar","⇌":"rlhar","⇐":"lArr","⇍":"nlArr","⇑":"uArr","⇒":"rArr","⇏":"nrArr","⇓":"dArr","⇔":"iff","⇎":"nhArr","⇕":"vArr","⇖":"nwArr","⇗":"neArr","⇘":"seArr","⇙":"swArr","⇚":"lAarr","⇛":"rAarr","⇝":"zigrarr","⇤":"larrb","⇥":"rarrb","⇵":"duarr","⇽":"loarr","⇾":"roarr","⇿":"hoarr","∀":"forall","∁":"comp","∂":"part","∂̸":"npart","∃":"exist","∄":"nexist","∅":"empty","∇":"Del","∈":"in","∉":"notin","∋":"ni","∌":"notni","϶":"bepsi","∏":"prod","∐":"coprod","∑":"sum","+":"plus","±":"pm","÷":"div","×":"times","<":"lt","≮":"nlt","<⃒":"nvlt","=":"equals","≠":"ne","=⃥":"bne","⩵":"Equal",">":"gt","≯":"ngt",">⃒":"nvgt","¬":"not","|":"vert","¦":"brvbar","−":"minus","∓":"mp","∔":"plusdo","⁄":"frasl","∖":"setmn","∗":"lowast","∘":"compfn","√":"Sqrt","∝":"prop","∞":"infin","∟":"angrt","∠":"ang","∠⃒":"nang","∡":"angmsd","∢":"angsph","∣":"mid","∤":"nmid","∥":"par","∦":"npar","∧":"and","∨":"or","∩":"cap","∩︀":"caps","∪":"cup","∪︀":"cups","∫":"int","∬":"Int","∭":"tint","⨌":"qint","∮":"oint","∯":"Conint","∰":"Cconint","∱":"cwint","∲":"cwconint","∳":"awconint","∴":"there4","∵":"becaus","∶":"ratio","∷":"Colon","∸":"minusd","∺":"mDDot","∻":"homtht","∼":"sim","≁":"nsim","∼⃒":"nvsim","∽":"bsim","∽̱":"race","∾":"ac","∾̳":"acE","∿":"acd","≀":"wr","≂":"esim","≂̸":"nesim","≃":"sime","≄":"nsime","≅":"cong","≇":"ncong","≆":"simne","≈":"ap","≉":"nap","≊":"ape","≋":"apid","≋̸":"napid","≌":"bcong","≍":"CupCap","≭":"NotCupCap","≍⃒":"nvap","≎":"bump","≎̸":"nbump","≏":"bumpe","≏̸":"nbumpe","≐":"doteq","≐̸":"nedot","≑":"eDot","≒":"efDot","≓":"erDot","≔":"colone","≕":"ecolon","≖":"ecir","≗":"cire","≙":"wedgeq","≚":"veeeq","≜":"trie","≟":"equest","≡":"equiv","≢":"nequiv","≡⃥":"bnequiv","≤":"le","≰":"nle","≤⃒":"nvle","≥":"ge","≱":"nge","≥⃒":"nvge","≦":"lE","≦̸":"nlE","≧":"gE","≧̸":"ngE","≨︀":"lvnE","≨":"lnE","≩":"gnE","≩︀":"gvnE","≪":"ll","≪̸":"nLtv","≪⃒":"nLt","≫":"gg","≫̸":"nGtv","≫⃒":"nGt","≬":"twixt","≲":"lsim","≴":"nlsim","≳":"gsim","≵":"ngsim","≶":"lg","≸":"ntlg","≷":"gl","≹":"ntgl","≺":"pr","⊀":"npr","≻":"sc","⊁":"nsc","≼":"prcue","⋠":"nprcue","≽":"sccue","⋡":"nsccue","≾":"prsim","≿":"scsim","≿̸":"NotSucceedsTilde","⊂":"sub","⊄":"nsub","⊂⃒":"vnsub","⊃":"sup","⊅":"nsup","⊃⃒":"vnsup","⊆":"sube","⊈":"nsube","⊇":"supe","⊉":"nsupe","⊊︀":"vsubne","⊊":"subne","⊋︀":"vsupne","⊋":"supne","⊍":"cupdot","⊎":"uplus","⊏":"sqsub","⊏̸":"NotSquareSubset","⊐":"sqsup","⊐̸":"NotSquareSuperset","⊑":"sqsube","⋢":"nsqsube","⊒":"sqsupe","⋣":"nsqsupe","⊓":"sqcap","⊓︀":"sqcaps","⊔":"sqcup","⊔︀":"sqcups","⊕":"oplus","⊖":"ominus","⊗":"otimes","⊘":"osol","⊙":"odot","⊚":"ocir","⊛":"oast","⊝":"odash","⊞":"plusb","⊟":"minusb","⊠":"timesb","⊡":"sdotb","⊢":"vdash","⊬":"nvdash","⊣":"dashv","⊤":"top","⊥":"bot","⊧":"models","⊨":"vDash","⊭":"nvDash","⊩":"Vdash","⊮":"nVdash","⊪":"Vvdash","⊫":"VDash","⊯":"nVDash","⊰":"prurel","⊲":"vltri","⋪":"nltri","⊳":"vrtri","⋫":"nrtri","⊴":"ltrie","⋬":"nltrie","⊴⃒":"nvltrie","⊵":"rtrie","⋭":"nrtrie","⊵⃒":"nvrtrie","⊶":"origof","⊷":"imof","⊸":"mumap","⊹":"hercon","⊺":"intcal","⊻":"veebar","⊽":"barvee","⊾":"angrtvb","⊿":"lrtri","⋀":"Wedge","⋁":"Vee","⋂":"xcap","⋃":"xcup","⋄":"diam","⋅":"sdot","⋆":"Star","⋇":"divonx","⋈":"bowtie","⋉":"ltimes","⋊":"rtimes","⋋":"lthree","⋌":"rthree","⋍":"bsime","⋎":"cuvee","⋏":"cuwed","⋐":"Sub","⋑":"Sup","⋒":"Cap","⋓":"Cup","⋔":"fork","⋕":"epar","⋖":"ltdot","⋗":"gtdot","⋘":"Ll","⋘̸":"nLl","⋙":"Gg","⋙̸":"nGg","⋚︀":"lesg","⋚":"leg","⋛":"gel","⋛︀":"gesl","⋞":"cuepr","⋟":"cuesc","⋦":"lnsim","⋧":"gnsim","⋨":"prnsim","⋩":"scnsim","⋮":"vellip","⋯":"ctdot","⋰":"utdot","⋱":"dtdot","⋲":"disin","⋳":"isinsv","⋴":"isins","⋵":"isindot","⋵̸":"notindot","⋶":"notinvc","⋷":"notinvb","⋹":"isinE","⋹̸":"notinE","⋺":"nisd","⋻":"xnis","⋼":"nis","⋽":"notnivc","⋾":"notnivb","⌅":"barwed","⌆":"Barwed","⌌":"drcrop","⌍":"dlcrop","⌎":"urcrop","⌏":"ulcrop","⌐":"bnot","⌒":"profline","⌓":"profsurf","⌕":"telrec","⌖":"target","⌜":"ulcorn","⌝":"urcorn","⌞":"dlcorn","⌟":"drcorn","⌢":"frown","⌣":"smile","⌭":"cylcty","⌮":"profalar","⌶":"topbot","⌽":"ovbar","⌿":"solbar","⍼":"angzarr","⎰":"lmoust","⎱":"rmoust","⎴":"tbrk","⎵":"bbrk","⎶":"bbrktbrk","⏜":"OverParenthesis","⏝":"UnderParenthesis","⏞":"OverBrace","⏟":"UnderBrace","⏢":"trpezium","⏧":"elinters","␣":"blank","─":"boxh","│":"boxv","┌":"boxdr","┐":"boxdl","└":"boxur","┘":"boxul","├":"boxvr","┤":"boxvl","┬":"boxhd","┴":"boxhu","┼":"boxvh","═":"boxH","║":"boxV","╒":"boxdR","╓":"boxDr","╔":"boxDR","╕":"boxdL","╖":"boxDl","╗":"boxDL","╘":"boxuR","╙":"boxUr","╚":"boxUR","╛":"boxuL","╜":"boxUl","╝":"boxUL","╞":"boxvR","╟":"boxVr","╠":"boxVR","╡":"boxvL","╢":"boxVl","╣":"boxVL","╤":"boxHd","╥":"boxhD","╦":"boxHD","╧":"boxHu","╨":"boxhU","╩":"boxHU","╪":"boxvH","╫":"boxVh","╬":"boxVH","▀":"uhblk","▄":"lhblk","█":"block","░":"blk14","▒":"blk12","▓":"blk34","□":"squ","▪":"squf","▫":"EmptyVerySmallSquare","▭":"rect","▮":"marker","▱":"fltns","△":"xutri","▴":"utrif","▵":"utri","▸":"rtrif","▹":"rtri","▽":"xdtri","▾":"dtrif","▿":"dtri","◂":"ltrif","◃":"ltri","◊":"loz","○":"cir","◬":"tridot","◯":"xcirc","◸":"ultri","◹":"urtri","◺":"lltri","◻":"EmptySmallSquare","◼":"FilledSmallSquare","★":"starf","☆":"star","☎":"phone","♀":"female","♂":"male","♠":"spades","♣":"clubs","♥":"hearts","♦":"diams","♪":"sung","✓":"check","✗":"cross","✠":"malt","✶":"sext","❘":"VerticalSeparator","⟈":"bsolhsub","⟉":"suphsol","⟵":"xlarr","⟶":"xrarr","⟷":"xharr","⟸":"xlArr","⟹":"xrArr","⟺":"xhArr","⟼":"xmap","⟿":"dzigrarr","⤂":"nvlArr","⤃":"nvrArr","⤄":"nvHarr","⤅":"Map","⤌":"lbarr","⤍":"rbarr","⤎":"lBarr","⤏":"rBarr","⤐":"RBarr","⤑":"DDotrahd","⤒":"UpArrowBar","⤓":"DownArrowBar","⤖":"Rarrtl","⤙":"latail","⤚":"ratail","⤛":"lAtail","⤜":"rAtail","⤝":"larrfs","⤞":"rarrfs","⤟":"larrbfs","⤠":"rarrbfs","⤣":"nwarhk","⤤":"nearhk","⤥":"searhk","⤦":"swarhk","⤧":"nwnear","⤨":"toea","⤩":"tosa","⤪":"swnwar","⤳":"rarrc","⤳̸":"nrarrc","⤵":"cudarrr","⤶":"ldca","⤷":"rdca","⤸":"cudarrl","⤹":"larrpl","⤼":"curarrm","⤽":"cularrp","⥅":"rarrpl","⥈":"harrcir","⥉":"Uarrocir","⥊":"lurdshar","⥋":"ldrushar","⥎":"LeftRightVector","⥏":"RightUpDownVector","⥐":"DownLeftRightVector","⥑":"LeftUpDownVector","⥒":"LeftVectorBar","⥓":"RightVectorBar","⥔":"RightUpVectorBar","⥕":"RightDownVectorBar","⥖":"DownLeftVectorBar","⥗":"DownRightVectorBar","⥘":"LeftUpVectorBar","⥙":"LeftDownVectorBar","⥚":"LeftTeeVector","⥛":"RightTeeVector","⥜":"RightUpTeeVector","⥝":"RightDownTeeVector","⥞":"DownLeftTeeVector","⥟":"DownRightTeeVector","⥠":"LeftUpTeeVector","⥡":"LeftDownTeeVector","⥢":"lHar","⥣":"uHar","⥤":"rHar","⥥":"dHar","⥦":"luruhar","⥧":"ldrdhar","⥨":"ruluhar","⥩":"rdldhar","⥪":"lharul","⥫":"llhard","⥬":"rharul","⥭":"lrhard","⥮":"udhar","⥯":"duhar","⥰":"RoundImplies","⥱":"erarr","⥲":"simrarr","⥳":"larrsim","⥴":"rarrsim","⥵":"rarrap","⥶":"ltlarr","⥸":"gtrarr","⥹":"subrarr","⥻":"suplarr","⥼":"lfisht","⥽":"rfisht","⥾":"ufisht","⥿":"dfisht","⦚":"vzigzag","⦜":"vangrt","⦝":"angrtvbd","⦤":"ange","⦥":"range","⦦":"dwangle","⦧":"uwangle","⦨":"angmsdaa","⦩":"angmsdab","⦪":"angmsdac","⦫":"angmsdad","⦬":"angmsdae","⦭":"angmsdaf","⦮":"angmsdag","⦯":"angmsdah","⦰":"bemptyv","⦱":"demptyv","⦲":"cemptyv","⦳":"raemptyv","⦴":"laemptyv","⦵":"ohbar","⦶":"omid","⦷":"opar","⦹":"operp","⦻":"olcross","⦼":"odsold","⦾":"olcir","⦿":"ofcir","⧀":"olt","⧁":"ogt","⧂":"cirscir","⧃":"cirE","⧄":"solb","⧅":"bsolb","⧉":"boxbox","⧍":"trisb","⧎":"rtriltri","⧏":"LeftTriangleBar","⧏̸":"NotLeftTriangleBar","⧐":"RightTriangleBar","⧐̸":"NotRightTriangleBar","⧜":"iinfin","⧝":"infintie","⧞":"nvinfin","⧣":"eparsl","⧤":"smeparsl","⧥":"eqvparsl","⧫":"lozf","⧴":"RuleDelayed","⧶":"dsol","⨀":"xodot","⨁":"xoplus","⨂":"xotime","⨄":"xuplus","⨆":"xsqcup","⨍":"fpartint","⨐":"cirfnint","⨑":"awint","⨒":"rppolint","⨓":"scpolint","⨔":"npolint","⨕":"pointint","⨖":"quatint","⨗":"intlarhk","⨢":"pluscir","⨣":"plusacir","⨤":"simplus","⨥":"plusdu","⨦":"plussim","⨧":"plustwo","⨩":"mcomma","⨪":"minusdu","⨭":"loplus","⨮":"roplus","⨯":"Cross","⨰":"timesd","⨱":"timesbar","⨳":"smashp","⨴":"lotimes","⨵":"rotimes","⨶":"otimesas","⨷":"Otimes","⨸":"odiv","⨹":"triplus","⨺":"triminus","⨻":"tritime","⨼":"iprod","⨿":"amalg","⩀":"capdot","⩂":"ncup","⩃":"ncap","⩄":"capand","⩅":"cupor","⩆":"cupcap","⩇":"capcup","⩈":"cupbrcap","⩉":"capbrcup","⩊":"cupcup","⩋":"capcap","⩌":"ccups","⩍":"ccaps","⩐":"ccupssm","⩓":"And","⩔":"Or","⩕":"andand","⩖":"oror","⩗":"orslope","⩘":"andslope","⩚":"andv","⩛":"orv","⩜":"andd","⩝":"ord","⩟":"wedbar","⩦":"sdote","⩪":"simdot","⩭":"congdot","⩭̸":"ncongdot","⩮":"easter","⩯":"apacir","⩰":"apE","⩰̸":"napE","⩱":"eplus","⩲":"pluse","⩳":"Esim","⩷":"eDDot","⩸":"equivDD","⩹":"ltcir","⩺":"gtcir","⩻":"ltquest","⩼":"gtquest","⩽":"les","⩽̸":"nles","⩾":"ges","⩾̸":"nges","⩿":"lesdot","⪀":"gesdot","⪁":"lesdoto","⪂":"gesdoto","⪃":"lesdotor","⪄":"gesdotol","⪅":"lap","⪆":"gap","⪇":"lne","⪈":"gne","⪉":"lnap","⪊":"gnap","⪋":"lEg","⪌":"gEl","⪍":"lsime","⪎":"gsime","⪏":"lsimg","⪐":"gsiml","⪑":"lgE","⪒":"glE","⪓":"lesges","⪔":"gesles","⪕":"els","⪖":"egs","⪗":"elsdot","⪘":"egsdot","⪙":"el","⪚":"eg","⪝":"siml","⪞":"simg","⪟":"simlE","⪠":"simgE","⪡":"LessLess","⪡̸":"NotNestedLessLess","⪢":"GreaterGreater","⪢̸":"NotNestedGreaterGreater","⪤":"glj","⪥":"gla","⪦":"ltcc","⪧":"gtcc","⪨":"lescc","⪩":"gescc","⪪":"smt","⪫":"lat","⪬":"smte","⪬︀":"smtes","⪭":"late","⪭︀":"lates","⪮":"bumpE","⪯":"pre","⪯̸":"npre","⪰":"sce","⪰̸":"nsce","⪳":"prE","⪴":"scE","⪵":"prnE","⪶":"scnE","⪷":"prap","⪸":"scap","⪹":"prnap","⪺":"scnap","⪻":"Pr","⪼":"Sc","⪽":"subdot","⪾":"supdot","⪿":"subplus","⫀":"supplus","⫁":"submult","⫂":"supmult","⫃":"subedot","⫄":"supedot","⫅":"subE","⫅̸":"nsubE","⫆":"supE","⫆̸":"nsupE","⫇":"subsim","⫈":"supsim","⫋︀":"vsubnE","⫋":"subnE","⫌︀":"vsupnE","⫌":"supnE","⫏":"csub","⫐":"csup","⫑":"csube","⫒":"csupe","⫓":"subsup","⫔":"supsub","⫕":"subsub","⫖":"supsup","⫗":"suphsub","⫘":"supdsub","⫙":"forkv","⫚":"topfork","⫛":"mlcp","⫤":"Dashv","⫦":"Vdashl","⫧":"Barv","⫨":"vBar","⫩":"vBarv","⫫":"Vbar","⫬":"Not","⫭":"bNot","⫮":"rnmid","⫯":"cirmid","⫰":"midcir","⫱":"topcir","⫲":"nhpar","⫳":"parsim","⫽":"parsl","⫽⃥":"nparsl","♭":"flat","♮":"natur","♯":"sharp","¤":"curren","¢":"cent",$:"dollar","£":"pound","¥":"yen","€":"euro","¹":"sup1","½":"half","⅓":"frac13","¼":"frac14","⅕":"frac15","⅙":"frac16","⅛":"frac18","²":"sup2","⅔":"frac23","⅖":"frac25","³":"sup3","¾":"frac34","⅗":"frac35","⅜":"frac38","⅘":"frac45","⅚":"frac56","⅝":"frac58","⅞":"frac78","𝒶":"ascr","𝕒":"aopf","𝔞":"afr","𝔸":"Aopf","𝔄":"Afr","𝒜":"Ascr",ª:"ordf",á:"aacute",Á:"Aacute",à:"agrave",À:"Agrave",ă:"abreve",Ă:"Abreve",â:"acirc",Â:"Acirc",å:"aring",Å:"angst",ä:"auml",Ä:"Auml",ã:"atilde",Ã:"Atilde",ą:"aogon",Ą:"Aogon",ā:"amacr",Ā:"Amacr",æ:"aelig",Æ:"AElig","𝒷":"bscr","𝕓":"bopf","𝔟":"bfr","𝔹":"Bopf",ℬ:"Bscr","𝔅":"Bfr","𝔠":"cfr","𝒸":"cscr","𝕔":"copf",ℭ:"Cfr","𝒞":"Cscr",ℂ:"Copf",ć:"cacute",Ć:"Cacute",ĉ:"ccirc",Ĉ:"Ccirc",č:"ccaron",Č:"Ccaron",ċ:"cdot",Ċ:"Cdot",ç:"ccedil",Ç:"Ccedil","℅":"incare","𝔡":"dfr","ⅆ":"dd","𝕕":"dopf","𝒹":"dscr","𝒟":"Dscr","𝔇":"Dfr","ⅅ":"DD","𝔻":"Dopf",ď:"dcaron",Ď:"Dcaron",đ:"dstrok",Đ:"Dstrok",ð:"eth",Ð:"ETH","ⅇ":"ee",ℯ:"escr","𝔢":"efr","𝕖":"eopf",ℰ:"Escr","𝔈":"Efr","𝔼":"Eopf",é:"eacute",É:"Eacute",è:"egrave",È:"Egrave",ê:"ecirc",Ê:"Ecirc",ě:"ecaron",Ě:"Ecaron",ë:"euml",Ë:"Euml",ė:"edot",Ė:"Edot",ę:"eogon",Ę:"Eogon",ē:"emacr",Ē:"Emacr","𝔣":"ffr","𝕗":"fopf","𝒻":"fscr","𝔉":"Ffr","𝔽":"Fopf",ℱ:"Fscr",ﬀ:"fflig",ﬃ:"ffilig",ﬄ:"ffllig",ﬁ:"filig",fj:"fjlig",ﬂ:"fllig",ƒ:"fnof",ℊ:"gscr","𝕘":"gopf","𝔤":"gfr","𝒢":"Gscr","𝔾":"Gopf","𝔊":"Gfr",ǵ:"gacute",ğ:"gbreve",Ğ:"Gbreve",ĝ:"gcirc",Ĝ:"Gcirc",ġ:"gdot",Ġ:"Gdot",Ģ:"Gcedil","𝔥":"hfr",ℎ:"planckh","𝒽":"hscr","𝕙":"hopf",ℋ:"Hscr",ℌ:"Hfr",ℍ:"Hopf",ĥ:"hcirc",Ĥ:"Hcirc",ℏ:"hbar",ħ:"hstrok",Ħ:"Hstrok","𝕚":"iopf","𝔦":"ifr","𝒾":"iscr","ⅈ":"ii","𝕀":"Iopf",ℐ:"Iscr",ℑ:"Im",í:"iacute",Í:"Iacute",ì:"igrave",Ì:"Igrave",î:"icirc",Î:"Icirc",ï:"iuml",Ï:"Iuml",ĩ:"itilde",Ĩ:"Itilde",İ:"Idot",į:"iogon",Į:"Iogon",ī:"imacr",Ī:"Imacr",ĳ:"ijlig",Ĳ:"IJlig",ı:"imath","𝒿":"jscr","𝕛":"jopf","𝔧":"jfr","𝒥":"Jscr","𝔍":"Jfr","𝕁":"Jopf",ĵ:"jcirc",Ĵ:"Jcirc","ȷ":"jmath","𝕜":"kopf","𝓀":"kscr","𝔨":"kfr","𝒦":"Kscr","𝕂":"Kopf","𝔎":"Kfr",ķ:"kcedil",Ķ:"Kcedil","𝔩":"lfr","𝓁":"lscr",ℓ:"ell","𝕝":"lopf",ℒ:"Lscr","𝔏":"Lfr","𝕃":"Lopf",ĺ:"lacute",Ĺ:"Lacute",ľ:"lcaron",Ľ:"Lcaron",ļ:"lcedil",Ļ:"Lcedil",ł:"lstrok",Ł:"Lstrok",ŀ:"lmidot",Ŀ:"Lmidot","𝔪":"mfr","𝕞":"mopf","𝓂":"mscr","𝔐":"Mfr","𝕄":"Mopf",ℳ:"Mscr","𝔫":"nfr","𝕟":"nopf","𝓃":"nscr",ℕ:"Nopf","𝒩":"Nscr","𝔑":"Nfr",ń:"nacute",Ń:"Nacute",ň:"ncaron",Ň:"Ncaron",ñ:"ntilde",Ñ:"Ntilde",ņ:"ncedil",Ņ:"Ncedil","№":"numero",ŋ:"eng",Ŋ:"ENG","𝕠":"oopf","𝔬":"ofr",ℴ:"oscr","𝒪":"Oscr","𝔒":"Ofr","𝕆":"Oopf",º:"ordm",ó:"oacute",Ó:"Oacute",ò:"ograve",Ò:"Ograve",ô:"ocirc",Ô:"Ocirc",ö:"ouml",Ö:"Ouml",ő:"odblac",Ő:"Odblac",õ:"otilde",Õ:"Otilde",ø:"oslash",Ø:"Oslash",ō:"omacr",Ō:"Omacr",œ:"oelig",Œ:"OElig","𝔭":"pfr","𝓅":"pscr","𝕡":"popf",ℙ:"Popf","𝔓":"Pfr","𝒫":"Pscr","𝕢":"qopf","𝔮":"qfr","𝓆":"qscr","𝒬":"Qscr","𝔔":"Qfr",ℚ:"Qopf",ĸ:"kgreen","𝔯":"rfr","𝕣":"ropf","𝓇":"rscr",ℛ:"Rscr",ℜ:"Re",ℝ:"Ropf",ŕ:"racute",Ŕ:"Racute",ř:"rcaron",Ř:"Rcaron",ŗ:"rcedil",Ŗ:"Rcedil","𝕤":"sopf","𝓈":"sscr","𝔰":"sfr","𝕊":"Sopf","𝔖":"Sfr","𝒮":"Sscr","Ⓢ":"oS",ś:"sacute",Ś:"Sacute",ŝ:"scirc",Ŝ:"Scirc",š:"scaron",Š:"Scaron",ş:"scedil",Ş:"Scedil",ß:"szlig","𝔱":"tfr","𝓉":"tscr","𝕥":"topf","𝒯":"Tscr","𝔗":"Tfr","𝕋":"Topf",ť:"tcaron",Ť:"Tcaron",ţ:"tcedil",Ţ:"Tcedil","™":"trade",ŧ:"tstrok",Ŧ:"Tstrok","𝓊":"uscr","𝕦":"uopf","𝔲":"ufr","𝕌":"Uopf","𝔘":"Ufr","𝒰":"Uscr",ú:"uacute",Ú:"Uacute",ù:"ugrave",Ù:"Ugrave",ŭ:"ubreve",Ŭ:"Ubreve",û:"ucirc",Û:"Ucirc",ů:"uring",Ů:"Uring",ü:"uuml",Ü:"Uuml",ű:"udblac",Ű:"Udblac",ũ:"utilde",Ũ:"Utilde",ų:"uogon",Ų:"Uogon",ū:"umacr",Ū:"Umacr","𝔳":"vfr","𝕧":"vopf","𝓋":"vscr","𝔙":"Vfr","𝕍":"Vopf","𝒱":"Vscr","𝕨":"wopf","𝓌":"wscr","𝔴":"wfr","𝒲":"Wscr","𝕎":"Wopf","𝔚":"Wfr",ŵ:"wcirc",Ŵ:"Wcirc","𝔵":"xfr","𝓍":"xscr","𝕩":"xopf","𝕏":"Xopf","𝔛":"Xfr","𝒳":"Xscr","𝔶":"yfr","𝓎":"yscr","𝕪":"yopf","𝒴":"Yscr","𝔜":"Yfr","𝕐":"Yopf",ý:"yacute",Ý:"Yacute",ŷ:"ycirc",Ŷ:"Ycirc",ÿ:"yuml",Ÿ:"Yuml","𝓏":"zscr","𝔷":"zfr","𝕫":"zopf",ℨ:"Zfr",ℤ:"Zopf","𝒵":"Zscr",ź:"zacute",Ź:"Zacute",ž:"zcaron",Ž:"Zcaron",ż:"zdot",Ż:"Zdot",Ƶ:"imped",þ:"thorn",Þ:"THORN",ŉ:"napos",α:"alpha",Α:"Alpha",β:"beta",Β:"Beta",γ:"gamma",Γ:"Gamma",δ:"delta",Δ:"Delta",ε:"epsi","ϵ":"epsiv",Ε:"Epsilon",ϝ:"gammad",Ϝ:"Gammad",ζ:"zeta",Ζ:"Zeta",η:"eta",Η:"Eta",θ:"theta",ϑ:"thetav",Θ:"Theta",ι:"iota",Ι:"Iota",κ:"kappa",ϰ:"kappav",Κ:"Kappa",λ:"lambda",Λ:"Lambda",μ:"mu",µ:"micro",Μ:"Mu",ν:"nu",Ν:"Nu",ξ:"xi",Ξ:"Xi",ο:"omicron",Ο:"Omicron",π:"pi",ϖ:"piv",Π:"Pi",ρ:"rho",ϱ:"rhov",Ρ:"Rho",σ:"sigma",Σ:"Sigma",ς:"sigmaf",τ:"tau",Τ:"Tau",υ:"upsi",Υ:"Upsilon",ϒ:"Upsi",φ:"phi",ϕ:"phiv",Φ:"Phi",χ:"chi",Χ:"Chi",ψ:"psi",Ψ:"Psi",ω:"omega",Ω:"ohm",а:"acy",А:"Acy",б:"bcy",Б:"Bcy",в:"vcy",В:"Vcy",г:"gcy",Г:"Gcy",ѓ:"gjcy",Ѓ:"GJcy",д:"dcy",Д:"Dcy",ђ:"djcy",Ђ:"DJcy",е:"iecy",Е:"IEcy",ё:"iocy",Ё:"IOcy",є:"jukcy",Є:"Jukcy",ж:"zhcy",Ж:"ZHcy",з:"zcy",З:"Zcy",ѕ:"dscy",Ѕ:"DScy",и:"icy",И:"Icy",і:"iukcy",І:"Iukcy",ї:"yicy",Ї:"YIcy",й:"jcy",Й:"Jcy",ј:"jsercy",Ј:"Jsercy",к:"kcy",К:"Kcy",ќ:"kjcy",Ќ:"KJcy",л:"lcy",Л:"Lcy",љ:"ljcy",Љ:"LJcy",м:"mcy",М:"Mcy",н:"ncy",Н:"Ncy",њ:"njcy",Њ:"NJcy",о:"ocy",О:"Ocy",п:"pcy",П:"Pcy",р:"rcy",Р:"Rcy",с:"scy",С:"Scy",т:"tcy",Т:"Tcy",ћ:"tshcy",Ћ:"TSHcy",у:"ucy",У:"Ucy",ў:"ubrcy",Ў:"Ubrcy",ф:"fcy",Ф:"Fcy",х:"khcy",Х:"KHcy",ц:"tscy",Ц:"TScy",ч:"chcy",Ч:"CHcy",џ:"dzcy",Џ:"DZcy",ш:"shcy",Ш:"SHcy",щ:"shchcy",Щ:"SHCHcy",ъ:"hardcy",Ъ:"HARDcy",ы:"ycy",Ы:"Ycy",ь:"softcy",Ь:"SOFTcy",э:"ecy",Э:"Ecy",ю:"yucy",Ю:"YUcy",я:"yacy",Я:"YAcy",ℵ:"aleph",ℶ:"beth",ℷ:"gimel",ℸ:"daleth"},S=/["&'<>`]/g,O={'"':"&quot;","&":"&amp;","'":"&#x27;","<":"&lt;",">":"&gt;","`":"&#x60;"},I=/&#(?:[xX][^a-fA-F0-9]|[^0-9xX])/,W=/[\0-\x08\x0B\x0E-\x1F\x7F-\x9F\uFDD0-\uFDEF\uFFFE\uFFFF]|[\uD83F\uD87F\uD8BF\uD8FF\uD93F\uD97F\uD9BF\uD9FF\uDA3F\uDA7F\uDABF\uDAFF\uDB3F\uDB7F\uDBBF\uDBFF][\uDFFE\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,L=/&#([0-9]+)(;?)|&#[xX]([a-fA-F0-9]+)(;?)|&([0-9a-zA-Z]+);|&(Aacute|Agrave|Atilde|Ccedil|Eacute|Egrave|Iacute|Igrave|Ntilde|Oacute|Ograve|Oslash|Otilde|Uacute|Ugrave|Yacute|aacute|agrave|atilde|brvbar|ccedil|curren|divide|eacute|egrave|frac12|frac14|frac34|iacute|igrave|iquest|middot|ntilde|oacute|ograve|oslash|otilde|plusmn|uacute|ugrave|yacute|AElig|Acirc|Aring|Ecirc|Icirc|Ocirc|THORN|Ucirc|acirc|acute|aelig|aring|cedil|ecirc|icirc|iexcl|laquo|micro|ocirc|pound|raquo|szlig|thorn|times|ucirc|Auml|COPY|Euml|Iuml|Ouml|QUOT|Uuml|auml|cent|copy|euml|iuml|macr|nbsp|ordf|ordm|ouml|para|quot|sect|sup1|sup2|sup3|uuml|yuml|AMP|ETH|REG|amp|deg|eth|not|reg|shy|uml|yen|GT|LT|gt|lt)([=a-zA-Z0-9])?/g,H={aacute:"á",Aacute:"Á",abreve:"ă",Abreve:"Ă",ac:"∾",acd:"∿",acE:"∾̳",acirc:"â",Acirc:"Â",acute:"´",acy:"а",Acy:"А",aelig:"æ",AElig:"Æ",af:"⁡",afr:"𝔞",Afr:"𝔄",agrave:"à",Agrave:"À",alefsym:"ℵ",aleph:"ℵ",alpha:"α",Alpha:"Α",amacr:"ā",Amacr:"Ā",amalg:"⨿",amp:"&",AMP:"&",and:"∧",And:"⩓",andand:"⩕",andd:"⩜",andslope:"⩘",andv:"⩚",ang:"∠",ange:"⦤",angle:"∠",angmsd:"∡",angmsdaa:"⦨",angmsdab:"⦩",angmsdac:"⦪",angmsdad:"⦫",angmsdae:"⦬",angmsdaf:"⦭",angmsdag:"⦮",angmsdah:"⦯",angrt:"∟",angrtvb:"⊾",angrtvbd:"⦝",angsph:"∢",angst:"Å",angzarr:"⍼",aogon:"ą",Aogon:"Ą",aopf:"𝕒",Aopf:"𝔸",ap:"≈",apacir:"⩯",ape:"≊",apE:"⩰",apid:"≋",apos:"'",ApplyFunction:"⁡",approx:"≈",approxeq:"≊",aring:"å",Aring:"Å",ascr:"𝒶",Ascr:"𝒜",Assign:"≔",ast:"*",asymp:"≈",asympeq:"≍",atilde:"ã",Atilde:"Ã",auml:"ä",Auml:"Ä",awconint:"∳",awint:"⨑",backcong:"≌",backepsilon:"϶",backprime:"‵",backsim:"∽",backsimeq:"⋍",Backslash:"∖",Barv:"⫧",barvee:"⊽",barwed:"⌅",Barwed:"⌆",barwedge:"⌅",bbrk:"⎵",bbrktbrk:"⎶",bcong:"≌",bcy:"б",Bcy:"Б",bdquo:"„",becaus:"∵",because:"∵",Because:"∵",bemptyv:"⦰",bepsi:"϶",bernou:"ℬ",Bernoullis:"ℬ",beta:"β",Beta:"Β",beth:"ℶ",between:"≬",bfr:"𝔟",Bfr:"𝔅",bigcap:"⋂",bigcirc:"◯",bigcup:"⋃",bigodot:"⨀",bigoplus:"⨁",bigotimes:"⨂",bigsqcup:"⨆",bigstar:"★",bigtriangledown:"▽",bigtriangleup:"△",biguplus:"⨄",bigvee:"⋁",bigwedge:"⋀",bkarow:"⤍",blacklozenge:"⧫",blacksquare:"▪",blacktriangle:"▴",blacktriangledown:"▾",blacktriangleleft:"◂",blacktriangleright:"▸",blank:"␣",blk12:"▒",blk14:"░",blk34:"▓",block:"█",bne:"=⃥",bnequiv:"≡⃥",bnot:"⌐",bNot:"⫭",bopf:"𝕓",Bopf:"𝔹",bot:"⊥",bottom:"⊥",bowtie:"⋈",boxbox:"⧉",boxdl:"┐",boxdL:"╕",boxDl:"╖",boxDL:"╗",boxdr:"┌",boxdR:"╒",boxDr:"╓",boxDR:"╔",boxh:"─",boxH:"═",boxhd:"┬",boxhD:"╥",boxHd:"╤",boxHD:"╦",boxhu:"┴",boxhU:"╨",boxHu:"╧",boxHU:"╩",boxminus:"⊟",boxplus:"⊞",boxtimes:"⊠",boxul:"┘",boxuL:"╛",boxUl:"╜",boxUL:"╝",boxur:"└",boxuR:"╘",boxUr:"╙",boxUR:"╚",boxv:"│",boxV:"║",boxvh:"┼",boxvH:"╪",boxVh:"╫",boxVH:"╬",boxvl:"┤",boxvL:"╡",boxVl:"╢",boxVL:"╣",boxvr:"├",boxvR:"╞",boxVr:"╟",boxVR:"╠",bprime:"‵",breve:"˘",Breve:"˘",brvbar:"¦",bscr:"𝒷",Bscr:"ℬ",bsemi:"⁏",bsim:"∽",bsime:"⋍",bsol:"\\",bsolb:"⧅",bsolhsub:"⟈",bull:"•",bullet:"•",bump:"≎",bumpe:"≏",bumpE:"⪮",bumpeq:"≏",Bumpeq:"≎",cacute:"ć",Cacute:"Ć",cap:"∩",Cap:"⋒",capand:"⩄",capbrcup:"⩉",capcap:"⩋",capcup:"⩇",capdot:"⩀",CapitalDifferentialD:"ⅅ",caps:"∩︀",caret:"⁁",caron:"ˇ",Cayleys:"ℭ",ccaps:"⩍",ccaron:"č",Ccaron:"Č",ccedil:"ç",Ccedil:"Ç",ccirc:"ĉ",Ccirc:"Ĉ",Cconint:"∰",ccups:"⩌",ccupssm:"⩐",cdot:"ċ",Cdot:"Ċ",cedil:"¸",Cedilla:"¸",cemptyv:"⦲",cent:"¢",centerdot:"·",CenterDot:"·",cfr:"𝔠",Cfr:"ℭ",chcy:"ч",CHcy:"Ч",check:"✓",checkmark:"✓",chi:"χ",Chi:"Χ",cir:"○",circ:"ˆ",circeq:"≗",circlearrowleft:"↺",circlearrowright:"↻",circledast:"⊛",circledcirc:"⊚",circleddash:"⊝",CircleDot:"⊙",circledR:"®",circledS:"Ⓢ",CircleMinus:"⊖",CirclePlus:"⊕",CircleTimes:"⊗",cire:"≗",cirE:"⧃",cirfnint:"⨐",cirmid:"⫯",cirscir:"⧂",ClockwiseContourIntegral:"∲",CloseCurlyDoubleQuote:"”",CloseCurlyQuote:"’",clubs:"♣",clubsuit:"♣",colon:":",Colon:"∷",colone:"≔",Colone:"⩴",coloneq:"≔",comma:",",commat:"@",comp:"∁",compfn:"∘",complement:"∁",complexes:"ℂ",cong:"≅",congdot:"⩭",Congruent:"≡",conint:"∮",Conint:"∯",ContourIntegral:"∮",copf:"𝕔",Copf:"ℂ",coprod:"∐",Coproduct:"∐",copy:"©",COPY:"©",copysr:"℗",CounterClockwiseContourIntegral:"∳",crarr:"↵",cross:"✗",Cross:"⨯",cscr:"𝒸",Cscr:"𝒞",csub:"⫏",csube:"⫑",csup:"⫐",csupe:"⫒",ctdot:"⋯",cudarrl:"⤸",cudarrr:"⤵",cuepr:"⋞",cuesc:"⋟",cularr:"↶",cularrp:"⤽",cup:"∪",Cup:"⋓",cupbrcap:"⩈",cupcap:"⩆",CupCap:"≍",cupcup:"⩊",cupdot:"⊍",cupor:"⩅",cups:"∪︀",curarr:"↷",curarrm:"⤼",curlyeqprec:"⋞",curlyeqsucc:"⋟",curlyvee:"⋎",curlywedge:"⋏",curren:"¤",curvearrowleft:"↶",curvearrowright:"↷",cuvee:"⋎",cuwed:"⋏",cwconint:"∲",cwint:"∱",cylcty:"⌭",dagger:"†",Dagger:"‡",daleth:"ℸ",darr:"↓",dArr:"⇓",Darr:"↡",dash:"‐",dashv:"⊣",Dashv:"⫤",dbkarow:"⤏",dblac:"˝",dcaron:"ď",Dcaron:"Ď",dcy:"д",Dcy:"Д",dd:"ⅆ",DD:"ⅅ",ddagger:"‡",ddarr:"⇊",DDotrahd:"⤑",ddotseq:"⩷",deg:"°",Del:"∇",delta:"δ",Delta:"Δ",demptyv:"⦱",dfisht:"⥿",dfr:"𝔡",Dfr:"𝔇",dHar:"⥥",dharl:"⇃",dharr:"⇂",DiacriticalAcute:"´",DiacriticalDot:"˙",DiacriticalDoubleAcute:"˝",DiacriticalGrave:"`",DiacriticalTilde:"˜",diam:"⋄",diamond:"⋄",Diamond:"⋄",diamondsuit:"♦",diams:"♦",die:"¨",DifferentialD:"ⅆ",digamma:"ϝ",disin:"⋲",div:"÷",divide:"÷",divideontimes:"⋇",divonx:"⋇",djcy:"ђ",DJcy:"Ђ",dlcorn:"⌞",dlcrop:"⌍",dollar:"$",dopf:"𝕕",Dopf:"𝔻",dot:"˙",Dot:"¨",DotDot:"⃜",doteq:"≐",doteqdot:"≑",DotEqual:"≐",dotminus:"∸",dotplus:"∔",dotsquare:"⊡",doublebarwedge:"⌆",DoubleContourIntegral:"∯",DoubleDot:"¨",DoubleDownArrow:"⇓",DoubleLeftArrow:"⇐",DoubleLeftRightArrow:"⇔",DoubleLeftTee:"⫤",DoubleLongLeftArrow:"⟸",DoubleLongLeftRightArrow:"⟺",DoubleLongRightArrow:"⟹",DoubleRightArrow:"⇒",DoubleRightTee:"⊨",DoubleUpArrow:"⇑",DoubleUpDownArrow:"⇕",DoubleVerticalBar:"∥",downarrow:"↓",Downarrow:"⇓",DownArrow:"↓",DownArrowBar:"⤓",DownArrowUpArrow:"⇵",DownBreve:"̑",downdownarrows:"⇊",downharpoonleft:"⇃",downharpoonright:"⇂",DownLeftRightVector:"⥐",DownLeftTeeVector:"⥞",DownLeftVector:"↽",DownLeftVectorBar:"⥖",DownRightTeeVector:"⥟",DownRightVector:"⇁",DownRightVectorBar:"⥗",DownTee:"⊤",DownTeeArrow:"↧",drbkarow:"⤐",drcorn:"⌟",drcrop:"⌌",dscr:"𝒹",Dscr:"𝒟",dscy:"ѕ",DScy:"Ѕ",dsol:"⧶",dstrok:"đ",Dstrok:"Đ",dtdot:"⋱",dtri:"▿",dtrif:"▾",duarr:"⇵",duhar:"⥯",dwangle:"⦦",dzcy:"џ",DZcy:"Џ",dzigrarr:"⟿",eacute:"é",Eacute:"É",easter:"⩮",ecaron:"ě",Ecaron:"Ě",ecir:"≖",ecirc:"ê",Ecirc:"Ê",ecolon:"≕",ecy:"э",Ecy:"Э",eDDot:"⩷",edot:"ė",eDot:"≑",Edot:"Ė",ee:"ⅇ",efDot:"≒",efr:"𝔢",Efr:"𝔈",eg:"⪚",egrave:"è",Egrave:"È",egs:"⪖",egsdot:"⪘",el:"⪙",Element:"∈",elinters:"⏧",ell:"ℓ",els:"⪕",elsdot:"⪗",emacr:"ē",Emacr:"Ē",empty:"∅",emptyset:"∅",EmptySmallSquare:"◻",emptyv:"∅",EmptyVerySmallSquare:"▫",emsp:" ",emsp13:" ",emsp14:" ",eng:"ŋ",ENG:"Ŋ",ensp:" ",eogon:"ę",Eogon:"Ę",eopf:"𝕖",Eopf:"𝔼",epar:"⋕",eparsl:"⧣",eplus:"⩱",epsi:"ε",epsilon:"ε",Epsilon:"Ε",epsiv:"ϵ",eqcirc:"≖",eqcolon:"≕",eqsim:"≂",eqslantgtr:"⪖",eqslantless:"⪕",Equal:"⩵",equals:"=",EqualTilde:"≂",equest:"≟",Equilibrium:"⇌",equiv:"≡",equivDD:"⩸",eqvparsl:"⧥",erarr:"⥱",erDot:"≓",escr:"ℯ",Escr:"ℰ",esdot:"≐",esim:"≂",Esim:"⩳",eta:"η",Eta:"Η",eth:"ð",ETH:"Ð",euml:"ë",Euml:"Ë",euro:"€",excl:"!",exist:"∃",Exists:"∃",expectation:"ℰ",exponentiale:"ⅇ",ExponentialE:"ⅇ",fallingdotseq:"≒",fcy:"ф",Fcy:"Ф",female:"♀",ffilig:"ﬃ",fflig:"ﬀ",ffllig:"ﬄ",ffr:"𝔣",Ffr:"𝔉",filig:"ﬁ",FilledSmallSquare:"◼",FilledVerySmallSquare:"▪",fjlig:"fj",flat:"♭",fllig:"ﬂ",fltns:"▱",fnof:"ƒ",fopf:"𝕗",Fopf:"𝔽",forall:"∀",ForAll:"∀",fork:"⋔",forkv:"⫙",Fouriertrf:"ℱ",fpartint:"⨍",frac12:"½",frac13:"⅓",frac14:"¼",frac15:"⅕",frac16:"⅙",frac18:"⅛",frac23:"⅔",frac25:"⅖",frac34:"¾",frac35:"⅗",frac38:"⅜",frac45:"⅘",frac56:"⅚",frac58:"⅝",frac78:"⅞",frasl:"⁄",frown:"⌢",fscr:"𝒻",Fscr:"ℱ",gacute:"ǵ",gamma:"γ",Gamma:"Γ",gammad:"ϝ",Gammad:"Ϝ",gap:"⪆",gbreve:"ğ",Gbreve:"Ğ",Gcedil:"Ģ",gcirc:"ĝ",Gcirc:"Ĝ",gcy:"г",Gcy:"Г",gdot:"ġ",Gdot:"Ġ",ge:"≥",gE:"≧",gel:"⋛",gEl:"⪌",geq:"≥",geqq:"≧",geqslant:"⩾",ges:"⩾",gescc:"⪩",gesdot:"⪀",gesdoto:"⪂",gesdotol:"⪄",gesl:"⋛︀",gesles:"⪔",gfr:"𝔤",Gfr:"𝔊",gg:"≫",Gg:"⋙",ggg:"⋙",gimel:"ℷ",gjcy:"ѓ",GJcy:"Ѓ",gl:"≷",gla:"⪥",glE:"⪒",glj:"⪤",gnap:"⪊",gnapprox:"⪊",gne:"⪈",gnE:"≩",gneq:"⪈",gneqq:"≩",gnsim:"⋧",gopf:"𝕘",Gopf:"𝔾",grave:"`",GreaterEqual:"≥",GreaterEqualLess:"⋛",GreaterFullEqual:"≧",GreaterGreater:"⪢",GreaterLess:"≷",GreaterSlantEqual:"⩾",GreaterTilde:"≳",gscr:"ℊ",Gscr:"𝒢",gsim:"≳",gsime:"⪎",gsiml:"⪐",gt:">",Gt:"≫",GT:">",gtcc:"⪧",gtcir:"⩺",gtdot:"⋗",gtlPar:"⦕",gtquest:"⩼",gtrapprox:"⪆",gtrarr:"⥸",gtrdot:"⋗",gtreqless:"⋛",gtreqqless:"⪌",gtrless:"≷",gtrsim:"≳",gvertneqq:"≩︀",gvnE:"≩︀",Hacek:"ˇ",hairsp:" ",half:"½",hamilt:"ℋ",hardcy:"ъ",HARDcy:"Ъ",harr:"↔",hArr:"⇔",harrcir:"⥈",harrw:"↭",Hat:"^",hbar:"ℏ",hcirc:"ĥ",Hcirc:"Ĥ",hearts:"♥",heartsuit:"♥",hellip:"…",hercon:"⊹",hfr:"𝔥",Hfr:"ℌ",HilbertSpace:"ℋ",hksearow:"⤥",hkswarow:"⤦",hoarr:"⇿",homtht:"∻",hookleftarrow:"↩",hookrightarrow:"↪",hopf:"𝕙",Hopf:"ℍ",horbar:"―",HorizontalLine:"─",hscr:"𝒽",Hscr:"ℋ",hslash:"ℏ",hstrok:"ħ",Hstrok:"Ħ",HumpDownHump:"≎",HumpEqual:"≏",hybull:"⁃",hyphen:"‐",iacute:"í",Iacute:"Í",ic:"⁣",icirc:"î",Icirc:"Î",icy:"и",Icy:"И",Idot:"İ",iecy:"е",IEcy:"Е",iexcl:"¡",iff:"⇔",ifr:"𝔦",Ifr:"ℑ",igrave:"ì",Igrave:"Ì",ii:"ⅈ",iiiint:"⨌",iiint:"∭",iinfin:"⧜",iiota:"℩",ijlig:"ĳ",IJlig:"Ĳ",Im:"ℑ",imacr:"ī",Imacr:"Ī",image:"ℑ",ImaginaryI:"ⅈ",imagline:"ℐ",imagpart:"ℑ",imath:"ı",imof:"⊷",imped:"Ƶ",Implies:"⇒",in:"∈",incare:"℅",infin:"∞",infintie:"⧝",inodot:"ı",int:"∫",Int:"∬",intcal:"⊺",integers:"ℤ",Integral:"∫",intercal:"⊺",Intersection:"⋂",intlarhk:"⨗",intprod:"⨼",InvisibleComma:"⁣",InvisibleTimes:"⁢",iocy:"ё",IOcy:"Ё",iogon:"į",Iogon:"Į",iopf:"𝕚",Iopf:"𝕀",iota:"ι",Iota:"Ι",iprod:"⨼",iquest:"¿",iscr:"𝒾",Iscr:"ℐ",isin:"∈",isindot:"⋵",isinE:"⋹",isins:"⋴",isinsv:"⋳",isinv:"∈",it:"⁢",itilde:"ĩ",Itilde:"Ĩ",iukcy:"і",Iukcy:"І",iuml:"ï",Iuml:"Ï",jcirc:"ĵ",Jcirc:"Ĵ",jcy:"й",Jcy:"Й",jfr:"𝔧",Jfr:"𝔍",jmath:"ȷ",jopf:"𝕛",Jopf:"𝕁",jscr:"𝒿",Jscr:"𝒥",jsercy:"ј",Jsercy:"Ј",jukcy:"є",Jukcy:"Є",kappa:"κ",Kappa:"Κ",kappav:"ϰ",kcedil:"ķ",Kcedil:"Ķ",kcy:"к",Kcy:"К",kfr:"𝔨",Kfr:"𝔎",kgreen:"ĸ",khcy:"х",KHcy:"Х",kjcy:"ќ",KJcy:"Ќ",kopf:"𝕜",Kopf:"𝕂",kscr:"𝓀",Kscr:"𝒦",lAarr:"⇚",lacute:"ĺ",Lacute:"Ĺ",laemptyv:"⦴",lagran:"ℒ",lambda:"λ",Lambda:"Λ",lang:"⟨",Lang:"⟪",langd:"⦑",langle:"⟨",lap:"⪅",Laplacetrf:"ℒ",laquo:"«",larr:"←",lArr:"⇐",Larr:"↞",larrb:"⇤",larrbfs:"⤟",larrfs:"⤝",larrhk:"↩",larrlp:"↫",larrpl:"⤹",larrsim:"⥳",larrtl:"↢",lat:"⪫",latail:"⤙",lAtail:"⤛",late:"⪭",lates:"⪭︀",lbarr:"⤌",lBarr:"⤎",lbbrk:"❲",lbrace:"{",lbrack:"[",lbrke:"⦋",lbrksld:"⦏",lbrkslu:"⦍",lcaron:"ľ",Lcaron:"Ľ",lcedil:"ļ",Lcedil:"Ļ",lceil:"⌈",lcub:"{",lcy:"л",Lcy:"Л",ldca:"⤶",ldquo:"“",ldquor:"„",ldrdhar:"⥧",ldrushar:"⥋",ldsh:"↲",le:"≤",lE:"≦",LeftAngleBracket:"⟨",leftarrow:"←",Leftarrow:"⇐",LeftArrow:"←",LeftArrowBar:"⇤",LeftArrowRightArrow:"⇆",leftarrowtail:"↢",LeftCeiling:"⌈",LeftDoubleBracket:"⟦",LeftDownTeeVector:"⥡",LeftDownVector:"⇃",LeftDownVectorBar:"⥙",LeftFloor:"⌊",leftharpoondown:"↽",leftharpoonup:"↼",leftleftarrows:"⇇",leftrightarrow:"↔",Leftrightarrow:"⇔",LeftRightArrow:"↔",leftrightarrows:"⇆",leftrightharpoons:"⇋",leftrightsquigarrow:"↭",LeftRightVector:"⥎",LeftTee:"⊣",LeftTeeArrow:"↤",LeftTeeVector:"⥚",leftthreetimes:"⋋",LeftTriangle:"⊲",LeftTriangleBar:"⧏",LeftTriangleEqual:"⊴",LeftUpDownVector:"⥑",LeftUpTeeVector:"⥠",LeftUpVector:"↿",LeftUpVectorBar:"⥘",LeftVector:"↼",LeftVectorBar:"⥒",leg:"⋚",lEg:"⪋",leq:"≤",leqq:"≦",leqslant:"⩽",les:"⩽",lescc:"⪨",lesdot:"⩿",lesdoto:"⪁",lesdotor:"⪃",lesg:"⋚︀",lesges:"⪓",lessapprox:"⪅",lessdot:"⋖",lesseqgtr:"⋚",lesseqqgtr:"⪋",LessEqualGreater:"⋚",LessFullEqual:"≦",LessGreater:"≶",lessgtr:"≶",LessLess:"⪡",lesssim:"≲",LessSlantEqual:"⩽",LessTilde:"≲",lfisht:"⥼",lfloor:"⌊",lfr:"𝔩",Lfr:"𝔏",lg:"≶",lgE:"⪑",lHar:"⥢",lhard:"↽",lharu:"↼",lharul:"⥪",lhblk:"▄",ljcy:"љ",LJcy:"Љ",ll:"≪",Ll:"⋘",llarr:"⇇",llcorner:"⌞",Lleftarrow:"⇚",llhard:"⥫",lltri:"◺",lmidot:"ŀ",Lmidot:"Ŀ",lmoust:"⎰",lmoustache:"⎰",lnap:"⪉",lnapprox:"⪉",lne:"⪇",lnE:"≨",lneq:"⪇",lneqq:"≨",lnsim:"⋦",loang:"⟬",loarr:"⇽",lobrk:"⟦",longleftarrow:"⟵",Longleftarrow:"⟸",LongLeftArrow:"⟵",longleftrightarrow:"⟷",Longleftrightarrow:"⟺",LongLeftRightArrow:"⟷",longmapsto:"⟼",longrightarrow:"⟶",Longrightarrow:"⟹",LongRightArrow:"⟶",looparrowleft:"↫",looparrowright:"↬",lopar:"⦅",lopf:"𝕝",Lopf:"𝕃",loplus:"⨭",lotimes:"⨴",lowast:"∗",lowbar:"_",LowerLeftArrow:"↙",LowerRightArrow:"↘",loz:"◊",lozenge:"◊",lozf:"⧫",lpar:"(",lparlt:"⦓",lrarr:"⇆",lrcorner:"⌟",lrhar:"⇋",lrhard:"⥭",lrm:"‎",lrtri:"⊿",lsaquo:"‹",lscr:"𝓁",Lscr:"ℒ",lsh:"↰",Lsh:"↰",lsim:"≲",lsime:"⪍",lsimg:"⪏",lsqb:"[",lsquo:"‘",lsquor:"‚",lstrok:"ł",Lstrok:"Ł",lt:"<",Lt:"≪",LT:"<",ltcc:"⪦",ltcir:"⩹",ltdot:"⋖",lthree:"⋋",ltimes:"⋉",ltlarr:"⥶",ltquest:"⩻",ltri:"◃",ltrie:"⊴",ltrif:"◂",ltrPar:"⦖",lurdshar:"⥊",luruhar:"⥦",lvertneqq:"≨︀",lvnE:"≨︀",macr:"¯",male:"♂",malt:"✠",maltese:"✠",map:"↦",Map:"⤅",mapsto:"↦",mapstodown:"↧",mapstoleft:"↤",mapstoup:"↥",marker:"▮",mcomma:"⨩",mcy:"м",Mcy:"М",mdash:"—",mDDot:"∺",measuredangle:"∡",MediumSpace:" ",Mellintrf:"ℳ",mfr:"𝔪",Mfr:"𝔐",mho:"℧",micro:"µ",mid:"∣",midast:"*",midcir:"⫰",middot:"·",minus:"−",minusb:"⊟",minusd:"∸",minusdu:"⨪",MinusPlus:"∓",mlcp:"⫛",mldr:"…",mnplus:"∓",models:"⊧",mopf:"𝕞",Mopf:"𝕄",mp:"∓",mscr:"𝓂",Mscr:"ℳ",mstpos:"∾",mu:"μ",Mu:"Μ",multimap:"⊸",mumap:"⊸",nabla:"∇",nacute:"ń",Nacute:"Ń",nang:"∠⃒",nap:"≉",napE:"⩰̸",napid:"≋̸",napos:"ŉ",napprox:"≉",natur:"♮",natural:"♮",naturals:"ℕ",nbsp:" ",nbump:"≎̸",nbumpe:"≏̸",ncap:"⩃",ncaron:"ň",Ncaron:"Ň",ncedil:"ņ",Ncedil:"Ņ",ncong:"≇",ncongdot:"⩭̸",ncup:"⩂",ncy:"н",Ncy:"Н",ndash:"–",ne:"≠",nearhk:"⤤",nearr:"↗",neArr:"⇗",nearrow:"↗",nedot:"≐̸",NegativeMediumSpace:"​",NegativeThickSpace:"​",NegativeThinSpace:"​",NegativeVeryThinSpace:"​",nequiv:"≢",nesear:"⤨",nesim:"≂̸",NestedGreaterGreater:"≫",NestedLessLess:"≪",NewLine:`
`,nexist:"∄",nexists:"∄",nfr:"𝔫",Nfr:"𝔑",nge:"≱",ngE:"≧̸",ngeq:"≱",ngeqq:"≧̸",ngeqslant:"⩾̸",nges:"⩾̸",nGg:"⋙̸",ngsim:"≵",ngt:"≯",nGt:"≫⃒",ngtr:"≯",nGtv:"≫̸",nharr:"↮",nhArr:"⇎",nhpar:"⫲",ni:"∋",nis:"⋼",nisd:"⋺",niv:"∋",njcy:"њ",NJcy:"Њ",nlarr:"↚",nlArr:"⇍",nldr:"‥",nle:"≰",nlE:"≦̸",nleftarrow:"↚",nLeftarrow:"⇍",nleftrightarrow:"↮",nLeftrightarrow:"⇎",nleq:"≰",nleqq:"≦̸",nleqslant:"⩽̸",nles:"⩽̸",nless:"≮",nLl:"⋘̸",nlsim:"≴",nlt:"≮",nLt:"≪⃒",nltri:"⋪",nltrie:"⋬",nLtv:"≪̸",nmid:"∤",NoBreak:"⁠",NonBreakingSpace:" ",nopf:"𝕟",Nopf:"ℕ",not:"¬",Not:"⫬",NotCongruent:"≢",NotCupCap:"≭",NotDoubleVerticalBar:"∦",NotElement:"∉",NotEqual:"≠",NotEqualTilde:"≂̸",NotExists:"∄",NotGreater:"≯",NotGreaterEqual:"≱",NotGreaterFullEqual:"≧̸",NotGreaterGreater:"≫̸",NotGreaterLess:"≹",NotGreaterSlantEqual:"⩾̸",NotGreaterTilde:"≵",NotHumpDownHump:"≎̸",NotHumpEqual:"≏̸",notin:"∉",notindot:"⋵̸",notinE:"⋹̸",notinva:"∉",notinvb:"⋷",notinvc:"⋶",NotLeftTriangle:"⋪",NotLeftTriangleBar:"⧏̸",NotLeftTriangleEqual:"⋬",NotLess:"≮",NotLessEqual:"≰",NotLessGreater:"≸",NotLessLess:"≪̸",NotLessSlantEqual:"⩽̸",NotLessTilde:"≴",NotNestedGreaterGreater:"⪢̸",NotNestedLessLess:"⪡̸",notni:"∌",notniva:"∌",notnivb:"⋾",notnivc:"⋽",NotPrecedes:"⊀",NotPrecedesEqual:"⪯̸",NotPrecedesSlantEqual:"⋠",NotReverseElement:"∌",NotRightTriangle:"⋫",NotRightTriangleBar:"⧐̸",NotRightTriangleEqual:"⋭",NotSquareSubset:"⊏̸",NotSquareSubsetEqual:"⋢",NotSquareSuperset:"⊐̸",NotSquareSupersetEqual:"⋣",NotSubset:"⊂⃒",NotSubsetEqual:"⊈",NotSucceeds:"⊁",NotSucceedsEqual:"⪰̸",NotSucceedsSlantEqual:"⋡",NotSucceedsTilde:"≿̸",NotSuperset:"⊃⃒",NotSupersetEqual:"⊉",NotTilde:"≁",NotTildeEqual:"≄",NotTildeFullEqual:"≇",NotTildeTilde:"≉",NotVerticalBar:"∤",npar:"∦",nparallel:"∦",nparsl:"⫽⃥",npart:"∂̸",npolint:"⨔",npr:"⊀",nprcue:"⋠",npre:"⪯̸",nprec:"⊀",npreceq:"⪯̸",nrarr:"↛",nrArr:"⇏",nrarrc:"⤳̸",nrarrw:"↝̸",nrightarrow:"↛",nRightarrow:"⇏",nrtri:"⋫",nrtrie:"⋭",nsc:"⊁",nsccue:"⋡",nsce:"⪰̸",nscr:"𝓃",Nscr:"𝒩",nshortmid:"∤",nshortparallel:"∦",nsim:"≁",nsime:"≄",nsimeq:"≄",nsmid:"∤",nspar:"∦",nsqsube:"⋢",nsqsupe:"⋣",nsub:"⊄",nsube:"⊈",nsubE:"⫅̸",nsubset:"⊂⃒",nsubseteq:"⊈",nsubseteqq:"⫅̸",nsucc:"⊁",nsucceq:"⪰̸",nsup:"⊅",nsupe:"⊉",nsupE:"⫆̸",nsupset:"⊃⃒",nsupseteq:"⊉",nsupseteqq:"⫆̸",ntgl:"≹",ntilde:"ñ",Ntilde:"Ñ",ntlg:"≸",ntriangleleft:"⋪",ntrianglelefteq:"⋬",ntriangleright:"⋫",ntrianglerighteq:"⋭",nu:"ν",Nu:"Ν",num:"#",numero:"№",numsp:" ",nvap:"≍⃒",nvdash:"⊬",nvDash:"⊭",nVdash:"⊮",nVDash:"⊯",nvge:"≥⃒",nvgt:">⃒",nvHarr:"⤄",nvinfin:"⧞",nvlArr:"⤂",nvle:"≤⃒",nvlt:"<⃒",nvltrie:"⊴⃒",nvrArr:"⤃",nvrtrie:"⊵⃒",nvsim:"∼⃒",nwarhk:"⤣",nwarr:"↖",nwArr:"⇖",nwarrow:"↖",nwnear:"⤧",oacute:"ó",Oacute:"Ó",oast:"⊛",ocir:"⊚",ocirc:"ô",Ocirc:"Ô",ocy:"о",Ocy:"О",odash:"⊝",odblac:"ő",Odblac:"Ő",odiv:"⨸",odot:"⊙",odsold:"⦼",oelig:"œ",OElig:"Œ",ofcir:"⦿",ofr:"𝔬",Ofr:"𝔒",ogon:"˛",ograve:"ò",Ograve:"Ò",ogt:"⧁",ohbar:"⦵",ohm:"Ω",oint:"∮",olarr:"↺",olcir:"⦾",olcross:"⦻",oline:"‾",olt:"⧀",omacr:"ō",Omacr:"Ō",omega:"ω",Omega:"Ω",omicron:"ο",Omicron:"Ο",omid:"⦶",ominus:"⊖",oopf:"𝕠",Oopf:"𝕆",opar:"⦷",OpenCurlyDoubleQuote:"“",OpenCurlyQuote:"‘",operp:"⦹",oplus:"⊕",or:"∨",Or:"⩔",orarr:"↻",ord:"⩝",order:"ℴ",orderof:"ℴ",ordf:"ª",ordm:"º",origof:"⊶",oror:"⩖",orslope:"⩗",orv:"⩛",oS:"Ⓢ",oscr:"ℴ",Oscr:"𝒪",oslash:"ø",Oslash:"Ø",osol:"⊘",otilde:"õ",Otilde:"Õ",otimes:"⊗",Otimes:"⨷",otimesas:"⨶",ouml:"ö",Ouml:"Ö",ovbar:"⌽",OverBar:"‾",OverBrace:"⏞",OverBracket:"⎴",OverParenthesis:"⏜",par:"∥",para:"¶",parallel:"∥",parsim:"⫳",parsl:"⫽",part:"∂",PartialD:"∂",pcy:"п",Pcy:"П",percnt:"%",period:".",permil:"‰",perp:"⊥",pertenk:"‱",pfr:"𝔭",Pfr:"𝔓",phi:"φ",Phi:"Φ",phiv:"ϕ",phmmat:"ℳ",phone:"☎",pi:"π",Pi:"Π",pitchfork:"⋔",piv:"ϖ",planck:"ℏ",planckh:"ℎ",plankv:"ℏ",plus:"+",plusacir:"⨣",plusb:"⊞",pluscir:"⨢",plusdo:"∔",plusdu:"⨥",pluse:"⩲",PlusMinus:"±",plusmn:"±",plussim:"⨦",plustwo:"⨧",pm:"±",Poincareplane:"ℌ",pointint:"⨕",popf:"𝕡",Popf:"ℙ",pound:"£",pr:"≺",Pr:"⪻",prap:"⪷",prcue:"≼",pre:"⪯",prE:"⪳",prec:"≺",precapprox:"⪷",preccurlyeq:"≼",Precedes:"≺",PrecedesEqual:"⪯",PrecedesSlantEqual:"≼",PrecedesTilde:"≾",preceq:"⪯",precnapprox:"⪹",precneqq:"⪵",precnsim:"⋨",precsim:"≾",prime:"′",Prime:"″",primes:"ℙ",prnap:"⪹",prnE:"⪵",prnsim:"⋨",prod:"∏",Product:"∏",profalar:"⌮",profline:"⌒",profsurf:"⌓",prop:"∝",Proportion:"∷",Proportional:"∝",propto:"∝",prsim:"≾",prurel:"⊰",pscr:"𝓅",Pscr:"𝒫",psi:"ψ",Psi:"Ψ",puncsp:" ",qfr:"𝔮",Qfr:"𝔔",qint:"⨌",qopf:"𝕢",Qopf:"ℚ",qprime:"⁗",qscr:"𝓆",Qscr:"𝒬",quaternions:"ℍ",quatint:"⨖",quest:"?",questeq:"≟",quot:'"',QUOT:'"',rAarr:"⇛",race:"∽̱",racute:"ŕ",Racute:"Ŕ",radic:"√",raemptyv:"⦳",rang:"⟩",Rang:"⟫",rangd:"⦒",range:"⦥",rangle:"⟩",raquo:"»",rarr:"→",rArr:"⇒",Rarr:"↠",rarrap:"⥵",rarrb:"⇥",rarrbfs:"⤠",rarrc:"⤳",rarrfs:"⤞",rarrhk:"↪",rarrlp:"↬",rarrpl:"⥅",rarrsim:"⥴",rarrtl:"↣",Rarrtl:"⤖",rarrw:"↝",ratail:"⤚",rAtail:"⤜",ratio:"∶",rationals:"ℚ",rbarr:"⤍",rBarr:"⤏",RBarr:"⤐",rbbrk:"❳",rbrace:"}",rbrack:"]",rbrke:"⦌",rbrksld:"⦎",rbrkslu:"⦐",rcaron:"ř",Rcaron:"Ř",rcedil:"ŗ",Rcedil:"Ŗ",rceil:"⌉",rcub:"}",rcy:"р",Rcy:"Р",rdca:"⤷",rdldhar:"⥩",rdquo:"”",rdquor:"”",rdsh:"↳",Re:"ℜ",real:"ℜ",realine:"ℛ",realpart:"ℜ",reals:"ℝ",rect:"▭",reg:"®",REG:"®",ReverseElement:"∋",ReverseEquilibrium:"⇋",ReverseUpEquilibrium:"⥯",rfisht:"⥽",rfloor:"⌋",rfr:"𝔯",Rfr:"ℜ",rHar:"⥤",rhard:"⇁",rharu:"⇀",rharul:"⥬",rho:"ρ",Rho:"Ρ",rhov:"ϱ",RightAngleBracket:"⟩",rightarrow:"→",Rightarrow:"⇒",RightArrow:"→",RightArrowBar:"⇥",RightArrowLeftArrow:"⇄",rightarrowtail:"↣",RightCeiling:"⌉",RightDoubleBracket:"⟧",RightDownTeeVector:"⥝",RightDownVector:"⇂",RightDownVectorBar:"⥕",RightFloor:"⌋",rightharpoondown:"⇁",rightharpoonup:"⇀",rightleftarrows:"⇄",rightleftharpoons:"⇌",rightrightarrows:"⇉",rightsquigarrow:"↝",RightTee:"⊢",RightTeeArrow:"↦",RightTeeVector:"⥛",rightthreetimes:"⋌",RightTriangle:"⊳",RightTriangleBar:"⧐",RightTriangleEqual:"⊵",RightUpDownVector:"⥏",RightUpTeeVector:"⥜",RightUpVector:"↾",RightUpVectorBar:"⥔",RightVector:"⇀",RightVectorBar:"⥓",ring:"˚",risingdotseq:"≓",rlarr:"⇄",rlhar:"⇌",rlm:"‏",rmoust:"⎱",rmoustache:"⎱",rnmid:"⫮",roang:"⟭",roarr:"⇾",robrk:"⟧",ropar:"⦆",ropf:"𝕣",Ropf:"ℝ",roplus:"⨮",rotimes:"⨵",RoundImplies:"⥰",rpar:")",rpargt:"⦔",rppolint:"⨒",rrarr:"⇉",Rrightarrow:"⇛",rsaquo:"›",rscr:"𝓇",Rscr:"ℛ",rsh:"↱",Rsh:"↱",rsqb:"]",rsquo:"’",rsquor:"’",rthree:"⋌",rtimes:"⋊",rtri:"▹",rtrie:"⊵",rtrif:"▸",rtriltri:"⧎",RuleDelayed:"⧴",ruluhar:"⥨",rx:"℞",sacute:"ś",Sacute:"Ś",sbquo:"‚",sc:"≻",Sc:"⪼",scap:"⪸",scaron:"š",Scaron:"Š",sccue:"≽",sce:"⪰",scE:"⪴",scedil:"ş",Scedil:"Ş",scirc:"ŝ",Scirc:"Ŝ",scnap:"⪺",scnE:"⪶",scnsim:"⋩",scpolint:"⨓",scsim:"≿",scy:"с",Scy:"С",sdot:"⋅",sdotb:"⊡",sdote:"⩦",searhk:"⤥",searr:"↘",seArr:"⇘",searrow:"↘",sect:"§",semi:";",seswar:"⤩",setminus:"∖",setmn:"∖",sext:"✶",sfr:"𝔰",Sfr:"𝔖",sfrown:"⌢",sharp:"♯",shchcy:"щ",SHCHcy:"Щ",shcy:"ш",SHcy:"Ш",ShortDownArrow:"↓",ShortLeftArrow:"←",shortmid:"∣",shortparallel:"∥",ShortRightArrow:"→",ShortUpArrow:"↑",shy:"­",sigma:"σ",Sigma:"Σ",sigmaf:"ς",sigmav:"ς",sim:"∼",simdot:"⩪",sime:"≃",simeq:"≃",simg:"⪞",simgE:"⪠",siml:"⪝",simlE:"⪟",simne:"≆",simplus:"⨤",simrarr:"⥲",slarr:"←",SmallCircle:"∘",smallsetminus:"∖",smashp:"⨳",smeparsl:"⧤",smid:"∣",smile:"⌣",smt:"⪪",smte:"⪬",smtes:"⪬︀",softcy:"ь",SOFTcy:"Ь",sol:"/",solb:"⧄",solbar:"⌿",sopf:"𝕤",Sopf:"𝕊",spades:"♠",spadesuit:"♠",spar:"∥",sqcap:"⊓",sqcaps:"⊓︀",sqcup:"⊔",sqcups:"⊔︀",Sqrt:"√",sqsub:"⊏",sqsube:"⊑",sqsubset:"⊏",sqsubseteq:"⊑",sqsup:"⊐",sqsupe:"⊒",sqsupset:"⊐",sqsupseteq:"⊒",squ:"□",square:"□",Square:"□",SquareIntersection:"⊓",SquareSubset:"⊏",SquareSubsetEqual:"⊑",SquareSuperset:"⊐",SquareSupersetEqual:"⊒",SquareUnion:"⊔",squarf:"▪",squf:"▪",srarr:"→",sscr:"𝓈",Sscr:"𝒮",ssetmn:"∖",ssmile:"⌣",sstarf:"⋆",star:"☆",Star:"⋆",starf:"★",straightepsilon:"ϵ",straightphi:"ϕ",strns:"¯",sub:"⊂",Sub:"⋐",subdot:"⪽",sube:"⊆",subE:"⫅",subedot:"⫃",submult:"⫁",subne:"⊊",subnE:"⫋",subplus:"⪿",subrarr:"⥹",subset:"⊂",Subset:"⋐",subseteq:"⊆",subseteqq:"⫅",SubsetEqual:"⊆",subsetneq:"⊊",subsetneqq:"⫋",subsim:"⫇",subsub:"⫕",subsup:"⫓",succ:"≻",succapprox:"⪸",succcurlyeq:"≽",Succeeds:"≻",SucceedsEqual:"⪰",SucceedsSlantEqual:"≽",SucceedsTilde:"≿",succeq:"⪰",succnapprox:"⪺",succneqq:"⪶",succnsim:"⋩",succsim:"≿",SuchThat:"∋",sum:"∑",Sum:"∑",sung:"♪",sup:"⊃",Sup:"⋑",sup1:"¹",sup2:"²",sup3:"³",supdot:"⪾",supdsub:"⫘",supe:"⊇",supE:"⫆",supedot:"⫄",Superset:"⊃",SupersetEqual:"⊇",suphsol:"⟉",suphsub:"⫗",suplarr:"⥻",supmult:"⫂",supne:"⊋",supnE:"⫌",supplus:"⫀",supset:"⊃",Supset:"⋑",supseteq:"⊇",supseteqq:"⫆",supsetneq:"⊋",supsetneqq:"⫌",supsim:"⫈",supsub:"⫔",supsup:"⫖",swarhk:"⤦",swarr:"↙",swArr:"⇙",swarrow:"↙",swnwar:"⤪",szlig:"ß",Tab:"	",target:"⌖",tau:"τ",Tau:"Τ",tbrk:"⎴",tcaron:"ť",Tcaron:"Ť",tcedil:"ţ",Tcedil:"Ţ",tcy:"т",Tcy:"Т",tdot:"⃛",telrec:"⌕",tfr:"𝔱",Tfr:"𝔗",there4:"∴",therefore:"∴",Therefore:"∴",theta:"θ",Theta:"Θ",thetasym:"ϑ",thetav:"ϑ",thickapprox:"≈",thicksim:"∼",ThickSpace:"  ",thinsp:" ",ThinSpace:" ",thkap:"≈",thksim:"∼",thorn:"þ",THORN:"Þ",tilde:"˜",Tilde:"∼",TildeEqual:"≃",TildeFullEqual:"≅",TildeTilde:"≈",times:"×",timesb:"⊠",timesbar:"⨱",timesd:"⨰",tint:"∭",toea:"⤨",top:"⊤",topbot:"⌶",topcir:"⫱",topf:"𝕥",Topf:"𝕋",topfork:"⫚",tosa:"⤩",tprime:"‴",trade:"™",TRADE:"™",triangle:"▵",triangledown:"▿",triangleleft:"◃",trianglelefteq:"⊴",triangleq:"≜",triangleright:"▹",trianglerighteq:"⊵",tridot:"◬",trie:"≜",triminus:"⨺",TripleDot:"⃛",triplus:"⨹",trisb:"⧍",tritime:"⨻",trpezium:"⏢",tscr:"𝓉",Tscr:"𝒯",tscy:"ц",TScy:"Ц",tshcy:"ћ",TSHcy:"Ћ",tstrok:"ŧ",Tstrok:"Ŧ",twixt:"≬",twoheadleftarrow:"↞",twoheadrightarrow:"↠",uacute:"ú",Uacute:"Ú",uarr:"↑",uArr:"⇑",Uarr:"↟",Uarrocir:"⥉",ubrcy:"ў",Ubrcy:"Ў",ubreve:"ŭ",Ubreve:"Ŭ",ucirc:"û",Ucirc:"Û",ucy:"у",Ucy:"У",udarr:"⇅",udblac:"ű",Udblac:"Ű",udhar:"⥮",ufisht:"⥾",ufr:"𝔲",Ufr:"𝔘",ugrave:"ù",Ugrave:"Ù",uHar:"⥣",uharl:"↿",uharr:"↾",uhblk:"▀",ulcorn:"⌜",ulcorner:"⌜",ulcrop:"⌏",ultri:"◸",umacr:"ū",Umacr:"Ū",uml:"¨",UnderBar:"_",UnderBrace:"⏟",UnderBracket:"⎵",UnderParenthesis:"⏝",Union:"⋃",UnionPlus:"⊎",uogon:"ų",Uogon:"Ų",uopf:"𝕦",Uopf:"𝕌",uparrow:"↑",Uparrow:"⇑",UpArrow:"↑",UpArrowBar:"⤒",UpArrowDownArrow:"⇅",updownarrow:"↕",Updownarrow:"⇕",UpDownArrow:"↕",UpEquilibrium:"⥮",upharpoonleft:"↿",upharpoonright:"↾",uplus:"⊎",UpperLeftArrow:"↖",UpperRightArrow:"↗",upsi:"υ",Upsi:"ϒ",upsih:"ϒ",upsilon:"υ",Upsilon:"Υ",UpTee:"⊥",UpTeeArrow:"↥",upuparrows:"⇈",urcorn:"⌝",urcorner:"⌝",urcrop:"⌎",uring:"ů",Uring:"Ů",urtri:"◹",uscr:"𝓊",Uscr:"𝒰",utdot:"⋰",utilde:"ũ",Utilde:"Ũ",utri:"▵",utrif:"▴",uuarr:"⇈",uuml:"ü",Uuml:"Ü",uwangle:"⦧",vangrt:"⦜",varepsilon:"ϵ",varkappa:"ϰ",varnothing:"∅",varphi:"ϕ",varpi:"ϖ",varpropto:"∝",varr:"↕",vArr:"⇕",varrho:"ϱ",varsigma:"ς",varsubsetneq:"⊊︀",varsubsetneqq:"⫋︀",varsupsetneq:"⊋︀",varsupsetneqq:"⫌︀",vartheta:"ϑ",vartriangleleft:"⊲",vartriangleright:"⊳",vBar:"⫨",Vbar:"⫫",vBarv:"⫩",vcy:"в",Vcy:"В",vdash:"⊢",vDash:"⊨",Vdash:"⊩",VDash:"⊫",Vdashl:"⫦",vee:"∨",Vee:"⋁",veebar:"⊻",veeeq:"≚",vellip:"⋮",verbar:"|",Verbar:"‖",vert:"|",Vert:"‖",VerticalBar:"∣",VerticalLine:"|",VerticalSeparator:"❘",VerticalTilde:"≀",VeryThinSpace:" ",vfr:"𝔳",Vfr:"𝔙",vltri:"⊲",vnsub:"⊂⃒",vnsup:"⊃⃒",vopf:"𝕧",Vopf:"𝕍",vprop:"∝",vrtri:"⊳",vscr:"𝓋",Vscr:"𝒱",vsubne:"⊊︀",vsubnE:"⫋︀",vsupne:"⊋︀",vsupnE:"⫌︀",Vvdash:"⊪",vzigzag:"⦚",wcirc:"ŵ",Wcirc:"Ŵ",wedbar:"⩟",wedge:"∧",Wedge:"⋀",wedgeq:"≙",weierp:"℘",wfr:"𝔴",Wfr:"𝔚",wopf:"𝕨",Wopf:"𝕎",wp:"℘",wr:"≀",wreath:"≀",wscr:"𝓌",Wscr:"𝒲",xcap:"⋂",xcirc:"◯",xcup:"⋃",xdtri:"▽",xfr:"𝔵",Xfr:"𝔛",xharr:"⟷",xhArr:"⟺",xi:"ξ",Xi:"Ξ",xlarr:"⟵",xlArr:"⟸",xmap:"⟼",xnis:"⋻",xodot:"⨀",xopf:"𝕩",Xopf:"𝕏",xoplus:"⨁",xotime:"⨂",xrarr:"⟶",xrArr:"⟹",xscr:"𝓍",Xscr:"𝒳",xsqcup:"⨆",xuplus:"⨄",xutri:"△",xvee:"⋁",xwedge:"⋀",yacute:"ý",Yacute:"Ý",yacy:"я",YAcy:"Я",ycirc:"ŷ",Ycirc:"Ŷ",ycy:"ы",Ycy:"Ы",yen:"¥",yfr:"𝔶",Yfr:"𝔜",yicy:"ї",YIcy:"Ї",yopf:"𝕪",Yopf:"𝕐",yscr:"𝓎",Yscr:"𝒴",yucy:"ю",YUcy:"Ю",yuml:"ÿ",Yuml:"Ÿ",zacute:"ź",Zacute:"Ź",zcaron:"ž",Zcaron:"Ž",zcy:"з",Zcy:"З",zdot:"ż",Zdot:"Ż",zeetrf:"ℨ",ZeroWidthSpace:"​",zeta:"ζ",Zeta:"Ζ",zfr:"𝔷",Zfr:"ℨ",zhcy:"ж",ZHcy:"Ж",zigrarr:"⇝",zopf:"𝕫",Zopf:"ℤ",zscr:"𝓏",Zscr:"𝒵",zwj:"‍",zwnj:"‌"},Y={aacute:"á",Aacute:"Á",acirc:"â",Acirc:"Â",acute:"´",aelig:"æ",AElig:"Æ",agrave:"à",Agrave:"À",amp:"&",AMP:"&",aring:"å",Aring:"Å",atilde:"ã",Atilde:"Ã",auml:"ä",Auml:"Ä",brvbar:"¦",ccedil:"ç",Ccedil:"Ç",cedil:"¸",cent:"¢",copy:"©",COPY:"©",curren:"¤",deg:"°",divide:"÷",eacute:"é",Eacute:"É",ecirc:"ê",Ecirc:"Ê",egrave:"è",Egrave:"È",eth:"ð",ETH:"Ð",euml:"ë",Euml:"Ë",frac12:"½",frac14:"¼",frac34:"¾",gt:">",GT:">",iacute:"í",Iacute:"Í",icirc:"î",Icirc:"Î",iexcl:"¡",igrave:"ì",Igrave:"Ì",iquest:"¿",iuml:"ï",Iuml:"Ï",laquo:"«",lt:"<",LT:"<",macr:"¯",micro:"µ",middot:"·",nbsp:" ",not:"¬",ntilde:"ñ",Ntilde:"Ñ",oacute:"ó",Oacute:"Ó",ocirc:"ô",Ocirc:"Ô",ograve:"ò",Ograve:"Ò",ordf:"ª",ordm:"º",oslash:"ø",Oslash:"Ø",otilde:"õ",Otilde:"Õ",ouml:"ö",Ouml:"Ö",para:"¶",plusmn:"±",pound:"£",quot:'"',QUOT:'"',raquo:"»",reg:"®",REG:"®",sect:"§",shy:"­",sup1:"¹",sup2:"²",sup3:"³",szlig:"ß",thorn:"þ",THORN:"Þ",times:"×",uacute:"ú",Uacute:"Ú",ucirc:"û",Ucirc:"Û",ugrave:"ù",Ugrave:"Ù",uml:"¨",uuml:"ü",Uuml:"Ü",yacute:"ý",Yacute:"Ý",yen:"¥",yuml:"ÿ"},Q={0:"�",128:"€",130:"‚",131:"ƒ",132:"„",133:"…",134:"†",135:"‡",136:"ˆ",137:"‰",138:"Š",139:"‹",140:"Œ",142:"Ž",145:"‘",146:"’",147:"“",148:"”",149:"•",150:"–",151:"—",152:"˜",153:"™",154:"š",155:"›",156:"œ",158:"ž",159:"Ÿ"},pe=[1,2,3,4,5,6,7,8,11,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,64976,64977,64978,64979,64980,64981,64982,64983,64984,64985,64986,64987,64988,64989,64990,64991,64992,64993,64994,64995,64996,64997,64998,64999,65e3,65001,65002,65003,65004,65005,65006,65007,65534,65535,131070,131071,196606,196607,262142,262143,327678,327679,393214,393215,458750,458751,524286,524287,589822,589823,655358,655359,720894,720895,786430,786431,851966,851967,917502,917503,983038,983039,1048574,1048575,1114110,1114111],de=String.fromCharCode,fe={},ye=fe.hasOwnProperty,Ee=function(mt,Nt){return ye.call(mt,Nt)},Le=function(mt,Nt){for(var Gt=-1,Mt=mt.length;++Gt<Mt;)if(mt[Gt]==Nt)return!0;return!1},Z=function(mt,Nt){if(!mt)return Nt;var Gt={},Mt;for(Mt in Nt)Gt[Mt]=Ee(mt,Mt)?mt[Mt]:Nt[Mt];return Gt},ne=function(mt,Nt){var Gt="";return mt>=55296&&mt<=57343||mt>1114111?(Nt&&xe("character reference outside the permissible Unicode range"),"�"):Ee(Q,mt)?(Nt&&xe("disallowed character reference"),Q[mt]):(Nt&&Le(pe,mt)&&xe("disallowed character reference"),mt>65535&&(mt-=65536,Gt+=de(mt>>>10&1023|55296),mt=56320|mt&1023),Gt+=de(mt),Gt)},Ke=function(mt){return"&#x"+mt.toString(16).toUpperCase()+";"},_t=function(mt){return"&#"+mt+";"},xe=function(mt){throw Error("Parse error: "+mt)},Ct=function(mt,Nt){Nt=Z(Nt,Ct.options);var Gt=Nt.strict;Gt&&W.test(mt)&&xe("forbidden code point");var Mt=Nt.encodeEverything,jt=Nt.useNamedReferences,Ai=Nt.allowUnsafeSymbols,oi=Nt.decimal?_t:Ke,ki=function(Li){return oi(Li.charCodeAt(0))};return Mt?(mt=mt.replace(h,function(Li){return jt&&Ee(A,Li)?"&"+A[Li]+";":ki(Li)}),jt&&(mt=mt.replace(/&gt;\u20D2/g,"&nvgt;").replace(/&lt;\u20D2/g,"&nvlt;").replace(/&#x66;&#x6A;/g,"&fjlig;")),jt&&(mt=mt.replace(d,function(Li){return"&"+A[Li]+";"}))):jt?(Ai||(mt=mt.replace(S,function(Li){return"&"+A[Li]+";"})),mt=mt.replace(/&gt;\u20D2/g,"&nvgt;").replace(/&lt;\u20D2/g,"&nvlt;"),mt=mt.replace(d,function(Li){return"&"+A[Li]+";"})):Ai||(mt=mt.replace(S,ki)),mt.replace(l,function(Li){var Wi=Li.charCodeAt(0),Vi=Li.charCodeAt(1),qi=(Wi-55296)*1024+Vi-56320+65536;return oi(qi)}).replace(g,ki)};Ct.options={allowUnsafeSymbols:!1,encodeEverything:!1,strict:!1,useNamedReferences:!1,decimal:!1};var zt=function(mt,Nt){Nt=Z(Nt,zt.options);var Gt=Nt.strict;return Gt&&I.test(mt)&&xe("malformed character reference"),mt.replace(L,function(Mt,jt,Ai,oi,ki,Li,Wi,Vi){var qi,Kt,zs,ls,gs,Ws;return jt?(zs=jt,Kt=Ai,Gt&&!Kt&&xe("character reference was not terminated by a semicolon"),qi=parseInt(zs,10),ne(qi,Gt)):oi?(ls=oi,Kt=ki,Gt&&!Kt&&xe("character reference was not terminated by a semicolon"),qi=parseInt(ls,16),ne(qi,Gt)):Li?(gs=Li,Ee(H,gs)?H[gs]:(Gt&&xe("named character reference was not terminated by a semicolon"),Mt)):(gs=Wi,Ws=Vi,Ws&&Nt.isAttributeValue?(Gt&&Ws=="="&&xe("`&` did not start a character reference"),Mt):(Gt&&xe("named character reference was not terminated by a semicolon"),Y[gs]+(Ws||"")))})};zt.options={isAttributeValue:!1,strict:!1};var Je=function(mt){return mt.replace(S,function(Nt){return O[Nt]})},Et={version:"1.1.1",encode:Ct,decode:zt,escape:Je,unescape:zt};if(r&&!r.nodeType)if(o)o.exports=Et;else for(var ht in Et)Ee(Et,ht)&&(r[ht]=Et[ht]);else s.he=Et})(window)})(he1_1_1,he1_1_1.exports);he1_1_1.exports;(function(){window.byteLength=h,window.toByteArray=g,window.fromByteArray=S;for(var a=[],t=[],s=typeof Uint8Array<"u"?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,n=r.length;o<n;++o)a[o]=r[o],t[r.charCodeAt(o)]=o;t[45]=62,t[95]=63;function l(O){var I=O.length;if(I%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return O[I-2]==="="?2:O[I-1]==="="?1:0}function h(O){return O.length*3/4-l(O)}function g(O){var I,W,L,H,Y,Q,pe=O.length;Y=l(O),Q=new s(pe*3/4-Y),L=Y>0?pe-4:pe;var de=0;for(I=0,W=0;I<L;I+=4,W+=3)H=t[O.charCodeAt(I)]<<18|t[O.charCodeAt(I+1)]<<12|t[O.charCodeAt(I+2)]<<6|t[O.charCodeAt(I+3)],Q[de++]=H>>16&255,Q[de++]=H>>8&255,Q[de++]=H&255;return Y===2?(H=t[O.charCodeAt(I)]<<2|t[O.charCodeAt(I+1)]>>4,Q[de++]=H&255):Y===1&&(H=t[O.charCodeAt(I)]<<10|t[O.charCodeAt(I+1)]<<4|t[O.charCodeAt(I+2)]>>2,Q[de++]=H>>8&255,Q[de++]=H&255),Q}function d(O){return a[O>>18&63]+a[O>>12&63]+a[O>>6&63]+a[O&63]}function A(O,I,W){for(var L,H=[],Y=I;Y<W;Y+=3)L=(O[Y]<<16)+(O[Y+1]<<8)+O[Y+2],H.push(d(L));return H.join("")}function S(O){for(var I,W=O.length,L=W%3,H="",Y=[],Q=16383,pe=0,de=W-L;pe<de;pe+=Q)Y.push(A(O,pe,pe+Q>de?de:pe+Q));return L===1?(I=O[W-1],H+=a[I>>2],H+=a[I<<4&63],H+="=="):L===2&&(I=(O[W-2]<<8)+O[W-1],H+=a[I>>10],H+=a[I>>4&63],H+=a[I<<2&63],H+="="),Y.push(H),Y.join("")}})();var QueryStringMachine$1={exports:{}};(function(a){(function(t,s){typeof window.define=="function"&&window.define.amd?window.define([],s):a.exports?window.QueryStringMachine=s():t.QueryStringMachine=s()})(window,()=>{const t=",",s=()=>{try{return localStorage.getItem("phetTeamMember")==="true"}catch{return!1}},r=o=>o.length===0||o.indexOf("?")===0;return function(){const o=(de,fe,ye,Ee,Le)=>{if(!de)if(Ee.public)if(n.addWarning(fe,ye,Le),Ee.hasOwnProperty("defaultValue"))ye=Ee.defaultValue;else{const Z=pe[Ee.type];Q(Z.hasOwnProperty("defaultValue"),"Type must have a default value if the provided schema does not have one."),ye=Z.defaultValue}else Q(de,Le);return ye},n={warnings:[],get:function(de,fe){return this.getForString(de,fe,window.location.search)},getAll:function(de){return this.getAllForString(de,window.location.search)},getForString:function(de,fe,ye){if(!r(ye))throw new Error(`Query strings should be either the empty string or start with a "?": ${ye}`);const Ee=fe.private&&!s()?[]:l(de,ye);h(de,fe);let Le=A(de,fe,Ee);fe.hasOwnProperty("validValues")?Le=o(Y(Le,fe.validValues),de,Le,fe,`Invalid value supplied for key "${de}": ${Le} is not a member of valid values: ${fe.validValues.join(", ")}`):fe.hasOwnProperty("isValidValue")&&(Le=o(fe.isValidValue(Le),de,Le,fe,`Invalid value supplied for key "${de}": ${Le}`));let Z=pe[fe.type].isValidValue(Le);if(fe.type==="array"&&Array.isArray(Le)){let ne=!0;for(let Ke=0;Ke<Le.length;Ke++){const _t=Le[Ke];if(!pe[fe.elementSchema.type].isValidValue(_t)){ne=!1;break}if(fe.elementSchema.hasOwnProperty("isValidValue")&&!fe.elementSchema.isValidValue(_t)){ne=!1;break}if(fe.elementSchema.hasOwnProperty("validValues")&&!Y(_t,fe.elementSchema.validValues)){ne=!1;break}}Z=Z&&ne}return Le=o(Z,de,Le,fe,`Invalid value for type, key: ${de}`),Le},getAllForString:function(de,fe){const ye={};for(const Ee in de)de.hasOwnProperty(Ee)&&(ye[Ee]=this.getForString(Ee,de[Ee],fe));return ye},containsKey:function(de){return this.containsKeyForString(de,window.location.search)},containsKeyForString:function(de,fe){if(!r(fe))throw new Error(`Query strings should be either the empty string or start with a "?": ${fe}`);return l(de,fe).length>0},deepEquals:function(de,fe){if(typeof de!=typeof fe)return!1;if(typeof de=="string"||typeof de=="number"||typeof de=="boolean")return de===fe;if(de===null&&fe===null||de===void 0&&fe===void 0)return!0;if(de===null&&fe===void 0||de===void 0&&fe===null)return!1;const ye=Object.keys(de),Ee=Object.keys(fe);if(ye.length!==Ee.length)return!1;if(ye.length===0)return de===fe;for(let Le=0;Le<ye.length;Le++){if(ye[Le]!==Ee[Le])return!1;const Z=de[ye[Le]],ne=fe[ye[Le]];if(!n.deepEquals(Z,ne))return!1}return!0},removeKeyValuePair:function(de,fe){if(assert&&assert(typeof de=="string",`url should be string, but it was: ${typeof de}`),assert&&assert(typeof fe=="string",`url should be string, but it was: ${typeof fe}`),assert&&assert(r(de),"queryString should be length 0 or begin with ?"),assert&&assert(fe.length>0,"url should be a string with length > 0"),de.indexOf("?")===0){const ye=[],Le=de.substring(1).split("&");for(let Z=0;Z<Le.length;Z++){const ne=Le[Z],Ke=ne.split("=");decodeURIComponent(Ke[0])!==fe&&ye.push(ne)}return ye.length>0?`?${ye.join("&")}`:""}else return de},removeKeyValuePairs:function(de,fe){for(let ye=0;ye<fe.length;ye++)de=this.removeKeyValuePair(de,fe[ye]);return de},appendQueryString:function(de,fe){if((fe.indexOf("?")===0||fe.indexOf("&")===0)&&(fe=fe.substring(1)),fe.length===0)return de;const ye=de.indexOf("?")>=0?"&":"?";return de+ye+fe},appendQueryStringArray:function(de,fe){for(let ye=0;ye<fe.length;ye++)de=this.appendQueryString(de,fe[ye]);return de},getQueryString:function(de){const fe=de.indexOf("?");return fe>=0?de.substring(fe):"?"},addWarning:function(de,fe,ye){console.warn(ye),this.warnings.push({key:de,value:fe,message:ye})},hasWarning:function(de){let fe=!1;for(let ye=0;ye<this.warnings.length&&!fe;ye++)fe=this.warnings[ye].key===de;return fe},getQueryParametersFromString:function(de){return de.indexOf("?")===0?de.substring(1).split("&"):[]},getSingleQueryParameterString:function(de,fe){const ye=this.getQueryString(fe),Ee=this.getQueryParametersFromString(ye);for(let Le=0;Le<Ee.length;Le++){const Z=Ee[Le],ne=Z.split("=");if(decodeURIComponent(ne[0])===de)return Z}return null}},l=function(de,fe){const ye=[],Ee=fe.slice(1).split("&");for(let Le=0;Le<Ee.length;Le++){const Z=Ee[Le].split("="),ne=Z[0],Ke=Z.slice(1).join("=");ne===de&&(Ke?ye.push(decodeURIComponent(Ke)):ye.push(null))}return ye},h=function(de,fe){Q(fe.hasOwnProperty("type"),`type field is required for key: ${de}`),Q(pe.hasOwnProperty(fe.type),`invalid type: ${fe.type} for key: ${de}`),fe.hasOwnProperty("parse")&&Q(typeof fe.parse=="function",`parse must be a function for key: ${de}`),Q(!(fe.hasOwnProperty("validValues")&&fe.hasOwnProperty("isValidValue")),fe),fe.hasOwnProperty("validValues")&&Q(Array.isArray(fe.validValues),`isValidValue must be an array for key: ${de}`),fe.hasOwnProperty("isValidValue")&&Q(typeof fe.isValidValue=="function",`isValidValue must be a function for key: ${de}`),fe.hasOwnProperty("defaultValue")&&Q(pe[fe.type].isValidValue(fe.defaultValue),`defaultValue incorrect type: ${de}`),fe.hasOwnProperty("validValues")&&fe.validValues.forEach(ye=>Q(pe[fe.type].isValidValue(ye),`validValue incorrect type for key: ${de}`)),fe.hasOwnProperty("defaultValue")&&fe.hasOwnProperty("validValues")&&Q(Y(fe.defaultValue,fe.validValues),fe),fe.hasOwnProperty("public")&&fe.public&&fe.type!=="flag"&&Q(fe.hasOwnProperty("defaultValue"),`defaultValue is required when public: true for key: ${de}`),d(de,fe,pe[fe.type].required,pe[fe.type].optional),pe[fe.type].validateSchema&&pe[fe.type].validateSchema(de,fe)},g=function(de,fe){fe.hasOwnProperty("separator")&&Q(typeof fe.separator=="string"&&fe.separator.length===1,`invalid separator: ${fe.separator}, for key: ${de}`),Q(!fe.elementSchema.hasOwnProperty("public"),"Array elements should not declare public; it comes from the array schema itself."),h(`${de}.element`,fe.elementSchema)},d=function(de,fe,ye,Ee){const Le=Object.getOwnPropertyNames(fe);ye.forEach(ne=>{Q(Le.indexOf(ne)!==-1,`missing required property: ${ne} for key: ${de}`)});const Z=ye.concat(Ee);Le.forEach(ne=>{Q(ne==="type"||Z.indexOf(ne)!==-1,`unsupported property: ${ne} for key: ${de}`)})},A=function(de,fe,ye){let Ee;return Q(ye.length<=1,`query parameter cannot occur multiple times: ${de}`),fe.type==="flag"?Ee=pe[fe.type].parse(de,fe,ye[0]):(Q(ye[0]!==void 0||fe.hasOwnProperty("defaultValue"),`missing required query parameter: ${de}`),ye[0]===void 0?Ee=fe.defaultValue:Ee=pe[fe.type].parse(de,fe,ye[0])),Ee},S=function(de,fe,ye){return ye===null?!0:ye===void 0?!1:ye},O=function(de,fe,ye){return ye==="true"?!0:ye==="false"?!1:ye},I=function(de,fe,ye){const Ee=Number(ye);return ye===null||isNaN(Ee)?ye:Ee},W=function(de,fe,ye){return ye},L=function(de,fe,ye){let Ee;return ye===null?Ee=[]:Ee=ye.split(fe.separator||t).map(Le=>A(de,fe.elementSchema,[Le])),Ee},H=function(de,fe,ye){return fe.parse(ye)},Y=function(de,fe){let ye=!1;for(let Ee=0;Ee<fe.length&&!ye;Ee++)ye=n.deepEquals(fe[Ee],de);return ye},Q=function(de,fe){if(!de)throw console&&console.log&&console.log(fe),new Error(`Query String Machine Assertion failed: ${fe}`)},pe={flag:{required:[],optional:["private","public"],validateSchema:null,parse:S,isValidValue:de=>de===!0||de===!1,defaultValue:!0},boolean:{required:[],optional:["defaultValue","private","public"],validateSchema:null,parse:O,isValidValue:de=>de===!0||de===!1},number:{required:[],optional:["defaultValue","validValues","isValidValue","private","public"],validateSchema:null,parse:I,isValidValue:de=>typeof de=="number"&&!isNaN(de)},string:{required:[],optional:["defaultValue","validValues","isValidValue","private","public"],validateSchema:null,parse:W,isValidValue:de=>de===null||typeof de=="string"},array:{required:["elementSchema"],optional:["defaultValue","validValues","isValidValue","separator","validValues","private","public"],validateSchema:g,parse:L,isValidValue:de=>Array.isArray(de)||de===null},custom:{required:["parse"],optional:["defaultValue","validValues","isValidValue","private","public"],validateSchema:null,parse:H,isValidValue:de=>!0}};return n}()})})(QueryStringMachine$1);function commonjsRequire(a){throw new Error('Could not dynamically require "'+a+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}(function(a,t){(function(s){window.himalaya=s()})(function(){return function(){function s(r,o,n){function l(d,A){if(!o[d]){if(!r[d]){var S=typeof commonjsRequire=="function"&&commonjsRequire;if(!A&&S)return S(d,!0);if(h)return h(d,!0);var O=new Error("Cannot find module '"+d+"'");throw O.code="MODULE_NOT_FOUND",O}var I=o[d]={exports:{}};r[d][0].call(I.exports,function(W){var L=r[d][1][W];return l(L||W)},I,I.exports,s,r,o,n)}return o[d].exports}for(var h=typeof commonjsRequire=="function"&&commonjsRequire,g=0;g<n.length;g++)l(n[g]);return l}return s}()({1:[function(s,r,o){var n=function(){var S="/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/compat.js",O="cde94accf38c67a096269c512dfb0f1bca69a38a",I=(function(){}).constructor,W=new I("return this")(),L="__coverage__",H={path:"/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/compat.js",statementMap:{0:{start:{line:10,column:2},end:{line:10,column:72}},1:{start:{line:14,column:16},end:{line:14,column:62}},2:{start:{line:15,column:20},end:{line:15,column:56}},3:{start:{line:16,column:2},end:{line:16,column:48}},4:{start:{line:20,column:2},end:{line:20,column:56}},5:{start:{line:24,column:2},end:{line:24,column:42}},6:{start:{line:28,column:14},end:{line:28,column:26}},7:{start:{line:29,column:2},end:{line:29,column:29}},8:{start:{line:29,column:17},end:{line:29,column:29}},9:{start:{line:31,column:22},end:{line:31,column:34}},10:{start:{line:32,column:23},end:{line:32,column:47}},11:{start:{line:33,column:20},end:{line:33,column:70}},12:{start:{line:34,column:2},end:{line:38,column:3}},13:{start:{line:35,column:20},end:{line:35,column:40}},14:{start:{line:36,column:4},end:{line:36,column:46}},15:{start:{line:36,column:35},end:{line:36,column:46}},16:{start:{line:37,column:4},end:{line:37,column:55}},17:{start:{line:37,column:44},end:{line:37,column:55}},18:{start:{line:40,column:2},end:{line:40,column:14}}},fnMap:{0:{name:"startsWith",decl:{start:{line:9,column:16},end:{line:9,column:26}},loc:{start:{line:9,column:57},end:{line:11,column:1}},line:9},1:{name:"endsWith",decl:{start:{line:13,column:16},end:{line:13,column:24}},loc:{start:{line:13,column:55},end:{line:17,column:1}},line:13},2:{name:"stringIncludes",decl:{start:{line:19,column:16},end:{line:19,column:30}},loc:{start:{line:19,column:61},end:{line:21,column:1}},line:19},3:{name:"isRealNaN",decl:{start:{line:23,column:16},end:{line:23,column:25}},loc:{start:{line:23,column:30},end:{line:25,column:1}},line:23},4:{name:"arrayIncludes",decl:{start:{line:27,column:16},end:{line:27,column:29}},loc:{start:{line:27,column:63},end:{line:41,column:1}},line:27}},branchMap:{0:{loc:{start:{line:10,column:20},end:{line:10,column:33}},type:"binary-expr",locations:[{start:{line:10,column:20},end:{line:10,column:28}},{start:{line:10,column:32},end:{line:10,column:33}}],line:10},1:{loc:{start:{line:14,column:17},end:{line:14,column:39}},type:"binary-expr",locations:[{start:{line:14,column:17},end:{line:14,column:25}},{start:{line:14,column:29},end:{line:14,column:39}}],line:14},2:{loc:{start:{line:16,column:9},end:{line:16,column:48}},type:"binary-expr",locations:[{start:{line:16,column:9},end:{line:16,column:25}},{start:{line:16,column:29},end:{line:16,column:48}}],line:16},3:{loc:{start:{line:20,column:35},end:{line:20,column:48}},type:"binary-expr",locations:[{start:{line:20,column:35},end:{line:20,column:43}},{start:{line:20,column:47},end:{line:20,column:48}}],line:20},4:{loc:{start:{line:24,column:9},end:{line:24,column:42}},type:"binary-expr",locations:[{start:{line:24,column:9},end:{line:24,column:30}},{start:{line:24,column:34},end:{line:24,column:42}}],line:24},5:{loc:{start:{line:29,column:2},end:{line:29,column:29}},type:"if",locations:[{start:{line:29,column:2},end:{line:29,column:29}},{start:{line:29,column:2},end:{line:29,column:29}}],line:29},6:{loc:{start:{line:33,column:20},end:{line:33,column:70}},type:"cond-expr",locations:[{start:{line:33,column:39},end:{line:33,column:50}},{start:{line:33,column:53},end:{line:33,column:70}}],line:33},7:{loc:{start:{line:36,column:4},end:{line:36,column:46}},type:"if",locations:[{start:{line:36,column:4},end:{line:36,column:46}},{start:{line:36,column:4},end:{line:36,column:46}}],line:36},8:{loc:{start:{line:37,column:4},end:{line:37,column:55}},type:"if",locations:[{start:{line:37,column:4},end:{line:37,column:55}},{start:{line:37,column:4},end:{line:37,column:55}}],line:37},9:{loc:{start:{line:37,column:8},end:{line:37,column:42}},type:"binary-expr",locations:[{start:{line:37,column:8},end:{line:37,column:20}},{start:{line:37,column:24},end:{line:37,column:42}}],line:37}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0},f:{0:0,1:0,2:0,3:0,4:0},b:{0:[0,0],1:[0,0],2:[0,0],3:[0,0],4:[0,0],5:[0,0],6:[0,0],7:[0,0],8:[0,0],9:[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},Y=W[L]||(W[L]={});return Y[S]&&Y[S].hash===O?Y[S]:(H.hash=O,Y[S]=H)}();Object.defineProperty(o,"__esModule",{value:!0}),o.startsWith=l,o.endsWith=h,o.stringIncludes=g,o.isRealNaN=d,o.arrayIncludes=A;function l(S,O,I){return n.f[0]++,n.s[0]++,S.substr((n.b[0][0]++,I||(n.b[0][1]++,0)),O.length)===O}function h(S,O,I){n.f[1]++;var W=(n.s[1]++,n.b[1][0]++,(I||(n.b[1][1]++,S.length))-O.length),L=(n.s[2]++,S.lastIndexOf(O,W));return n.s[3]++,n.b[2][0]++,L!==-1&&(n.b[2][1]++,L===W)}function g(S,O,I){return n.f[2]++,n.s[4]++,S.indexOf(O,(n.b[3][0]++,I||(n.b[3][1]++,0)))!==-1}function d(S){return n.f[3]++,n.s[5]++,n.b[4][0]++,typeof S=="number"&&(n.b[4][1]++,isNaN(S))}function A(S,O,I){n.f[4]++;var W=(n.s[6]++,S.length);if(n.s[7]++,W===0)return n.b[5][0]++,n.s[8]++,!1;n.b[5][1]++;var L=(n.s[9]++,I|0),H=(n.s[10]++,d(O)),Y=(n.s[11]++,L>=0?(n.b[6][0]++,L):(n.b[6][1]++,W+L));for(n.s[12]++;Y<W;){var Q=(n.s[13]++,S[Y++]);if(n.s[14]++,Q===O)return n.b[7][0]++,n.s[15]++,!0;if(n.b[7][1]++,n.s[16]++,n.b[9][0]++,H&&(n.b[9][1]++,d(Q)))return n.b[8][0]++,n.s[17]++,!0;n.b[8][1]++}return n.s[18]++,!1}},{}],2:[function(s,r,o){var n=function(){var A="/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/format.js",S="ef8c4d14fa58c2bce23a58bf5d7c370846a07329",O=(function(){}).constructor,I=new O("return this")(),W="__coverage__",L={path:"/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/format.js",statementMap:{0:{start:{line:2,column:14},end:{line:2,column:30}},1:{start:{line:3,column:2},end:{line:3,column:30}},2:{start:{line:3,column:18},end:{line:3,column:30}},3:{start:{line:4,column:2},end:{line:4,column:57}},4:{start:{line:8,column:14},end:{line:8,column:27}},5:{start:{line:9,column:14},end:{line:9,column:28}},6:{start:{line:10,column:23},end:{line:10,column:49}},7:{start:{line:11,column:2},end:{line:13,column:3}},8:{start:{line:12,column:4},end:{line:12,column:28}},9:{start:{line:14,column:2},end:{line:14,column:12}},10:{start:{line:18,column:2},end:{line:32,column:4}},11:{start:{line:19,column:17},end:{line:19,column:26}},12:{start:{line:20,column:23},end:{line:27,column:39}},13:{start:{line:28,column:4},end:{line:30,column:5}},14:{start:{line:29,column:6},end:{line:29,column:41}},15:{start:{line:31,column:4},end:{line:31,column:21}},16:{start:{line:36,column:2},end:{line:43,column:4}},17:{start:{line:37,column:18},end:{line:37,column:50}},18:{start:{line:38,column:16},end:{line:38,column:24}},19:{start:{line:39,column:18},end:{line:41,column:12}},20:{start:{line:42,column:4},end:{line:42,column:23}}},fnMap:{0:{name:"splitHead",decl:{start:{line:1,column:16},end:{line:1,column:25}},loc:{start:{line:1,column:37},end:{line:5,column:1}},line:1},1:{name:"unquote",decl:{start:{line:7,column:16},end:{line:7,column:23}},loc:{start:{line:7,column:30},end:{line:15,column:1}},line:7},2:{name:"format",decl:{start:{line:17,column:16},end:{line:17,column:22}},loc:{start:{line:17,column:40},end:{line:33,column:1}},line:17},3:{name:"(anonymous_3)",decl:{start:{line:18,column:19},end:{line:18,column:20}},loc:{start:{line:18,column:27},end:{line:32,column:3}},line:18},4:{name:"formatAttributes",decl:{start:{line:35,column:16},end:{line:35,column:32}},loc:{start:{line:35,column:46},end:{line:44,column:1}},line:35},5:{name:"(anonymous_5)",decl:{start:{line:36,column:24},end:{line:36,column:25}},loc:{start:{line:36,column:37},end:{line:43,column:3}},line:36}},branchMap:{0:{loc:{start:{line:3,column:2},end:{line:3,column:30}},type:"if",locations:[{start:{line:3,column:2},end:{line:3,column:30}},{start:{line:3,column:2},end:{line:3,column:30}}],line:3},1:{loc:{start:{line:10,column:23},end:{line:10,column:49}},type:"binary-expr",locations:[{start:{line:10,column:23},end:{line:10,column:34}},{start:{line:10,column:38},end:{line:10,column:49}}],line:10},2:{loc:{start:{line:11,column:2},end:{line:13,column:3}},type:"if",locations:[{start:{line:11,column:2},end:{line:13,column:3}},{start:{line:11,column:2},end:{line:13,column:3}}],line:11},3:{loc:{start:{line:11,column:6},end:{line:11,column:45}},type:"binary-expr",locations:[{start:{line:11,column:6},end:{line:11,column:18}},{start:{line:11,column:22},end:{line:11,column:45}}],line:11},4:{loc:{start:{line:20,column:23},end:{line:27,column:39}},type:"cond-expr",locations:[{start:{line:21,column:8},end:{line:26,column:7}},{start:{line:27,column:8},end:{line:27,column:39}}],line:20},5:{loc:{start:{line:28,column:4},end:{line:30,column:5}},type:"if",locations:[{start:{line:28,column:4},end:{line:30,column:5}},{start:{line:28,column:4},end:{line:30,column:5}}],line:28},6:{loc:{start:{line:39,column:18},end:{line:41,column:12}},type:"cond-expr",locations:[{start:{line:40,column:8},end:{line:40,column:25}},{start:{line:41,column:8},end:{line:41,column:12}}],line:39}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0},f:{0:0,1:0,2:0,3:0,4:0,5:0},b:{0:[0,0],1:[0,0],2:[0,0],3:[0,0],4:[0,0],5:[0,0],6:[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},H=I[W]||(I[W]={});return H[A]&&H[A].hash===S?H[A]:(L.hash=S,H[A]=L)}();Object.defineProperty(o,"__esModule",{value:!0}),o.splitHead=l,o.unquote=h,o.format=g,o.formatAttributes=d;function l(A,S){n.f[0]++;var O=(n.s[0]++,A.indexOf(S));return n.s[1]++,O===-1?(n.b[0][0]++,n.s[2]++,[A]):(n.b[0][1]++,n.s[3]++,[A.slice(0,O),A.slice(O+S.length)])}function h(A){n.f[1]++;var S=(n.s[4]++,A.charAt(0)),O=(n.s[5]++,A.length-1),I=(n.s[6]++,n.b[1][0]++,S==='"'||(n.b[1][1]++,S==="'"));return n.s[7]++,n.b[3][0]++,I&&(n.b[3][1]++,S===A.charAt(O))?(n.b[2][0]++,n.s[8]++,A.slice(1,O)):(n.b[2][1]++,n.s[9]++,A)}function g(A,S){return n.f[2]++,n.s[10]++,A.map(function(O){n.f[3]++;var I=(n.s[11]++,O.type),W=(n.s[12]++,I==="element"?(n.b[4][0]++,{type:I,tagName:O.tagName.toLowerCase(),attributes:d(O.attributes),children:g(O.children,S)}):(n.b[4][1]++,{type:I,content:O.content}));return n.s[13]++,S.includePositions?(n.b[5][0]++,n.s[14]++,W.position=O.position):n.b[5][1]++,n.s[15]++,W})}function d(A){return n.f[4]++,n.s[16]++,A.map(function(S){n.f[5]++;var O=(n.s[17]++,l(S.trim(),"=")),I=(n.s[18]++,O[0]),W=(n.s[19]++,typeof O[1]=="string"?(n.b[6][0]++,h(O[1])):(n.b[6][1]++,null));return n.s[20]++,{key:I,value:W}})}},{}],3:[function(s,r,o){var n=function(){var Y="/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/index.js",Q="a91ca68b6320b199fa63e4cbd37dce6857e0c43d",pe=(function(){}).constructor,de=new pe("return this")(),fe="__coverage__",ye={path:"/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/index.js",statementMap:{0:{start:{line:12,column:29},end:{line:18,column:1}},1:{start:{line:21,column:17},end:{line:21,column:36}},2:{start:{line:22,column:16},end:{line:22,column:39}},3:{start:{line:23,column:2},end:{line:23,column:31}},4:{start:{line:27,column:2},end:{line:27,column:29}}},fnMap:{0:{name:"parse",decl:{start:{line:20,column:16},end:{line:20,column:21}},loc:{start:{line:20,column:53},end:{line:24,column:1}},line:20},1:{name:"stringify",decl:{start:{line:26,column:16},end:{line:26,column:25}},loc:{start:{line:26,column:57},end:{line:28,column:1}},line:26}},branchMap:{0:{loc:{start:{line:20,column:28},end:{line:20,column:51}},type:"default-arg",locations:[{start:{line:20,column:38},end:{line:20,column:51}}],line:20},1:{loc:{start:{line:26,column:32},end:{line:26,column:55}},type:"default-arg",locations:[{start:{line:26,column:42},end:{line:26,column:55}}],line:26}},s:{0:0,1:0,2:0,3:0,4:0},f:{0:0,1:0},b:{0:[0],1:[0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},Ee=de[fe]||(de[fe]={});return Ee[Y]&&Ee[Y].hash===Q?Ee[Y]:(ye.hash=Q,Ee[Y]=ye)}();Object.defineProperty(o,"__esModule",{value:!0}),o.parseDefaults=void 0,o.parse=L,o.stringify=H;var l=s("./lexer"),h=I(l),g=s("./parser"),d=I(g),A=s("./format"),S=s("./stringify"),O=s("./tags");function I(Y){return Y&&Y.__esModule?Y:{default:Y}}var W=o.parseDefaults=(n.s[0]++,{voidTags:O.voidTags,closingTags:O.closingTags,childlessTags:O.childlessTags,closingTagAncestorBreakers:O.closingTagAncestorBreakers,includePositions:!1});function L(Y){var Q=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(n.b[0][0]++,W);n.f[0]++;var pe=(n.s[1]++,(0,h.default)(Y,Q)),de=(n.s[2]++,(0,d.default)(pe,Q));return n.s[3]++,(0,A.format)(de,Q)}function H(Y){var Q=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(n.b[1][0]++,W);return n.f[1]++,n.s[4]++,(0,S.toHTML)(Y,Q)}},{"./format":2,"./lexer":4,"./parser":5,"./stringify":6,"./tags":7}],4:[function(s,r,o){var n=function(){var Le="/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/lexer.js",Z="99f1269b85a36e02e6fcfa2eb5c9423a8a428848",ne=(function(){}).constructor,Ke=new ne("return this")(),_t="__coverage__",xe={path:"/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/lexer.js",statementMap:{0:{start:{line:9,column:16},end:{line:9,column:30}},1:{start:{line:10,column:14},end:{line:10,column:42}},2:{start:{line:11,column:2},end:{line:19,column:3}},3:{start:{line:12,column:17},end:{line:12,column:30}},4:{start:{line:13,column:4},end:{line:18,column:5}},5:{start:{line:14,column:6},end:{line:14,column:21}},6:{start:{line:15,column:6},end:{line:15,column:25}},7:{start:{line:17,column:6},end:{line:17,column:23}},8:{start:{line:23,column:14},end:{line:23,column:34}},9:{start:{line:24,column:2},end:{line:24,column:41}},10:{start:{line:28,column:2},end:{line:32,column:3}},11:{start:{line:36,column:2},end:{line:40,column:3}},12:{start:{line:44,column:16},end:{line:49,column:3}},13:{start:{line:50,column:2},end:{line:50,column:12}},14:{start:{line:51,column:2},end:{line:51,column:21}},15:{start:{line:55,column:42},end:{line:55,column:47}},16:{start:{line:56,column:14},end:{line:56,column:24}},17:{start:{line:57,column:2},end:{line:72,column:3}},18:{start:{line:58,column:18},end:{line:58,column:38}},19:{start:{line:59,column:4},end:{line:59,column:18}},20:{start:{line:60,column:4},end:{line:71,column:5}},21:{start:{line:61,column:24},end:{line:61,column:57}},22:{start:{line:62,column:6},end:{line:70,column:7}},23:{start:{line:63,column:8},end:{line:63,column:25}},24:{start:{line:65,column:24},end:{line:65,column:37}},25:{start:{line:66,column:24},end:{line:66,column:45}},26:{start:{line:67,column:8},end:{line:69,column:9}},27:{start:{line:68,column:10},end:{line:68,column:36}},28:{start:{line:75,column:21},end:{line:75,column:34}},29:{start:{line:77,column:2},end:{line:87,column:3}},30:{start:{line:78,column:20},end:{line:78,column:43}},31:{start:{line:79,column:4},end:{line:81,column:5}},32:{start:{line:80,column:6},end:{line:80,column:20}},33:{start:{line:82,column:17},end:{line:82,column:40}},34:{start:{line:83,column:4},end:{line:85,column:5}},35:{start:{line:84,column:6},end:{line:84,column:20}},36:{start:{line:86,column:4},end:{line:86,column:23}},37:{start:{line:91,column:15},end:{line:91,column:21}},38:{start:{line:92,column:26},end:{line:92,column:31}},39:{start:{line:93,column:16},end:{line:93,column:48}},40:{start:{line:94,column:2},end:{line:94,column:40}},41:{start:{line:94,column:34},end:{line:94,column:40}},42:{start:{line:95,column:2},end:{line:97,column:3}},43:{start:{line:96,column:4},end:{line:96,column:24}},44:{start:{line:99,column:16},end:{line:99,column:38}},45:{start:{line:100,column:18},end:{line:100,column:52}},46:{start:{line:101,column:2},end:{line:101,column:38}},47:{start:{line:102,column:14},end:{line:102,column:36}},48:{start:{line:103,column:2},end:{line:103,column:60}},49:{start:{line:107,column:26},end:{line:107,column:31}},50:{start:{line:108,column:16},end:{line:108,column:38}},51:{start:{line:109,column:2},end:{line:109,column:32}},52:{start:{line:110,column:19},end:{line:110,column:53}},53:{start:{line:111,column:19},end:{line:111,column:33}},54:{start:{line:112,column:2},end:{line:114,column:3}},55:{start:{line:113,column:4},end:{line:113,column:40}},56:{start:{line:116,column:18},end:{line:116,column:55}},57:{start:{line:117,column:2},end:{line:117,column:41}},58:{start:{line:118,column:2},end:{line:125,column:4}},59:{start:{line:129,column:26},end:{line:129,column:31}},60:{start:{line:131,column:23},end:{line:131,column:53}},61:{start:{line:132,column:18},end:{line:132,column:36}},62:{start:{line:133,column:18},end:{line:133,column:40}},63:{start:{line:134,column:4},end:{line:134,column:46}},64:{start:{line:135,column:4},end:{line:135,column:68}},65:{start:{line:137,column:18},end:{line:137,column:35}},66:{start:{line:138,column:2},end:{line:138,column:25}},67:{start:{line:140,column:22},end:{line:140,column:48}},68:{start:{line:141,column:18},end:{line:141,column:35}},69:{start:{line:142,column:4},end:{line:142,column:46}},70:{start:{line:143,column:16},end:{line:143,column:38}},71:{start:{line:144,column:4},end:{line:144,column:64}},72:{start:{line:146,column:2},end:{line:146,column:16}},73:{start:{line:150,column:19},end:{line:150,column:23}},74:{start:{line:152,column:2},end:{line:152,column:30}},75:{start:{line:156,column:26},end:{line:156,column:31}},76:{start:{line:157,column:14},end:{line:157,column:24}},77:{start:{line:158,column:14},end:{line:158,column:28}},78:{start:{line:159,column:2},end:{line:164,column:3}},79:{start:{line:160,column:17},end:{line:160,column:34}},80:{start:{line:161,column:22},end:{line:161,column:79}},81:{start:{line:162,column:4},end:{line:162,column:24}},82:{start:{line:162,column:19},end:{line:162,column:24}},83:{start:{line:163,column:4},end:{line:163,column:11}},84:{start:{line:166,column:12},end:{line:166,column:21}},85:{start:{line:167,column:2},end:{line:172,column:3}},86:{start:{line:168,column:17},end:{line:168,column:32}},87:{start:{line:169,column:22},end:{line:169,column:79}},88:{start:{line:170,column:4},end:{line:170,column:25}},89:{start:{line:170,column:20},end:{line:170,column:25}},90:{start:{line:171,column:4},end:{line:171,column:9}},91:{start:{line:174,column:2},end:{line:174,column:34}},92:{start:{line:175,column:18},end:{line:175,column:39}},93:{start:{line:176,column:2},end:{line:179,column:4}},94:{start:{line:180,column:2},end:{line:180,column:16}},95:{start:{line:184,column:34},end:{line:184,column:39}},96:{start:{line:185,column:15},end:{line:185,column:29}},97:{start:{line:186,column:14},end:{line:186,column:18}},98:{start:{line:187,column:18},end:{line:187,column:24}},99:{start:{line:188,column:16},end:{line:188,column:18}},100:{start:{line:189,column:14},end:{line:189,column:24}},101:{start:{line:190,column:2},end:{line:227,column:3}},102:{start:{line:191,column:17},end:{line:191,column:35}},103:{start:{line:192,column:4},end:{line:199,column:5}},104:{start:{line:193,column:25},end:{line:193,column:39}},105:{start:{line:194,column:6},end:{line:196,column:7}},106:{start:{line:195,column:8},end:{line:195,column:20}},107:{start:{line:197,column:6},end:{line:197,column:14}},108:{start:{line:198,column:6},end:{line:198,column:14}},109:{start:{line:201,column:21},end:{line:201,column:49}},110:{start:{line:202,column:4},end:{line:207,column:5}},111:{start:{line:203,column:6},end:{line:205,column:7}},112:{start:{line:204,column:8},end:{line:204,column:48}},113:{start:{line:206,column:6},end:{line:206,column:11}},114:{start:{line:209,column:22},end:{line:209,column:44}},115:{start:{line:210,column:4},end:{line:217,column:5}},116:{start:{line:211,column:6},end:{line:213,column:7}},117:{start:{line:212,column:8},end:{line:212,column:48}},118:{start:{line:214,column:6},end:{line:214,column:28}},119:{start:{line:215,column:6},end:{line:215,column:14}},120:{start:{line:216,column:6},end:{line:216,column:14}},121:{start:{line:219,column:25},end:{line:219,column:54}},122:{start:{line:220,column:4},end:{line:224,column:5}},123:{start:{line:221,column:6},end:{line:221,column:18}},124:{start:{line:222,column:6},end:{line:222,column:14}},125:{start:{line:223,column:6},end:{line:223,column:14}},126:{start:{line:226,column:4},end:{line:226,column:12}},127:{start:{line:228,column:2},end:{line:228,column:37}},128:{start:{line:230,column:15},end:{line:230,column:27}},129:{start:{line:231,column:15},end:{line:231,column:26}},130:{start:{line:232,column:2},end:{line:269,column:3}},131:{start:{line:233,column:17},end:{line:233,column:25}},132:{start:{line:234,column:22},end:{line:234,column:46}},133:{start:{line:235,column:4},end:{line:253,column:5}},134:{start:{line:236,column:25},end:{line:236,column:37}},135:{start:{line:237,column:6},end:{line:252,column:7}},136:{start:{line:238,column:8},end:{line:243,column:9}},137:{start:{line:239,column:26},end:{line:239,column:43}},138:{start:{line:240,column:10},end:{line:240,column:47}},139:{start:{line:241,column:10},end:{line:241,column:16}},140:{start:{line:242,column:10},end:{line:242,column:18}},141:{start:{line:244,column:26},end:{line:244,column:38}},142:{start:{line:245,column:8},end:{line:245,column:14}},143:{start:{line:246,column:8},end:{line:251,column:9}},144:{start:{line:247,column:26},end:{line:247,column:48}},145:{start:{line:248,column:10},end:{line:248,column:47}},146:{start:{line:249,column:10},end:{line:249,column:16}},147:{start:{line:250,column:10},end:{line:250,column:18}},148:{start:{line:254,column:4},end:{line:266,column:5}},149:{start:{line:255,column:25},end:{line:255,column:37}},150:{start:{line:256,column:6},end:{line:261,column:7}},151:{start:{line:257,column:24},end:{line:257,column:41}},152:{start:{line:258,column:8},end:{line:258,column:45}},153:{start:{line:259,column:8},end:{line:259,column:14}},154:{start:{line:260,column:8},end:{line:260,column:16}},155:{start:{line:263,column:22},end:{line:263,column:39}},156:{start:{line:264,column:6},end:{line:264,column:43}},157:{start:{line:265,column:6},end:{line:265,column:14}},158:{start:{line:268,column:4},end:{line:268,column:38}},159:{start:{line:272,column:13},end:{line:272,column:20}},160:{start:{line:275,column:34},end:{line:275,column:39}},161:{start:{line:276,column:22},end:{line:276,column:43}},162:{start:{line:277,column:14},end:{line:277,column:24}},163:{start:{line:278,column:14},end:{line:278,column:28}},164:{start:{line:279,column:2},end:{line:311,column:3}},165:{start:{line:280,column:20},end:{line:280,column:44}},166:{start:{line:281,column:4},end:{line:284,column:5}},167:{start:{line:282,column:6},end:{line:282,column:20}},168:{start:{line:283,column:6},end:{line:283,column:11}},169:{start:{line:286,column:29},end:{line:286,column:51}},170:{start:{line:287,column:4},end:{line:287,column:48}},171:{start:{line:288,column:21},end:{line:288,column:66}},172:{start:{line:289,column:17},end:{line:289,column:33}},173:{start:{line:290,column:4},end:{line:293,column:5}},174:{start:{line:291,column:6},end:{line:291,column:37}},175:{start:{line:292,column:6},end:{line:292,column:14}},176:{start:{line:295,column:4},end:{line:306,column:5}},177:{start:{line:296,column:24},end:{line:296,column:46}},178:{start:{line:297,column:6},end:{line:297,column:42}},179:{start:{line:298,column:6},end:{line:305,column:8}},180:{start:{line:308,column:4},end:{line:308,column:39}},181:{start:{line:309,column:4},end:{line:309,column:56}},182:{start:{line:310,column:4},end:{line:310,column:9}}},fnMap:{0:{name:"feedPosition",decl:{start:{line:8,column:16},end:{line:8,column:28}},loc:{start:{line:8,column:50},end:{line:20,column:1}},line:8},1:{name:"jumpPosition",decl:{start:{line:22,column:16},end:{line:22,column:28}},loc:{start:{line:22,column:50},end:{line:25,column:1}},line:22},2:{name:"makeInitialPosition",decl:{start:{line:27,column:16},end:{line:27,column:35}},loc:{start:{line:27,column:39},end:{line:33,column:1}},line:27},3:{name:"copyPosition",decl:{start:{line:35,column:16},end:{line:35,column:28}},loc:{start:{line:35,column:40},end:{line:41,column:1}},line:35},4:{name:"lexer",decl:{start:{line:43,column:24},end:{line:43,column:29}},loc:{start:{line:43,column:45},end:{line:52,column:1}},line:43},5:{name:"lex",decl:{start:{line:54,column:16},end:{line:54,column:19}},loc:{start:{line:54,column:28},end:{line:73,column:1}},line:54},6:{name:"findTextEnd",decl:{start:{line:76,column:16},end:{line:76,column:27}},loc:{start:{line:76,column:41},end:{line:88,column:1}},line:76},7:{name:"lexText",decl:{start:{line:90,column:16},end:{line:90,column:23}},loc:{start:{line:90,column:32},end:{line:104,column:1}},line:90},8:{name:"lexComment",decl:{start:{line:106,column:16},end:{line:106,column:26}},loc:{start:{line:106,column:35},end:{line:126,column:1}},line:106},9:{name:"lexTag",decl:{start:{line:128,column:16},end:{line:128,column:22}},loc:{start:{line:128,column:31},end:{line:147,column:1}},line:128},10:{name:"isWhitespaceChar",decl:{start:{line:151,column:16},end:{line:151,column:32}},loc:{start:{line:151,column:40},end:{line:153,column:1}},line:151},11:{name:"lexTagName",decl:{start:{line:155,column:16},end:{line:155,column:26}},loc:{start:{line:155,column:35},end:{line:181,column:1}},line:155},12:{name:"lexTagAttributes",decl:{start:{line:183,column:16},end:{line:183,column:32}},loc:{start:{line:183,column:41},end:{line:270,column:1}},line:183},13:{name:"lexSkipTag",decl:{start:{line:274,column:16},end:{line:274,column:26}},loc:{start:{line:274,column:44},end:{line:312,column:1}},line:274}},branchMap:{0:{loc:{start:{line:13,column:4},end:{line:18,column:5}},type:"if",locations:[{start:{line:13,column:4},end:{line:18,column:5}},{start:{line:13,column:4},end:{line:18,column:5}}],line:13},1:{loc:{start:{line:60,column:4},end:{line:71,column:5}},type:"if",locations:[{start:{line:60,column:4},end:{line:71,column:5}},{start:{line:60,column:4},end:{line:71,column:5}}],line:60},2:{loc:{start:{line:62,column:6},end:{line:70,column:7}},type:"if",locations:[{start:{line:62,column:6},end:{line:70,column:7}},{start:{line:62,column:6},end:{line:70,column:7}}],line:62},3:{loc:{start:{line:67,column:8},end:{line:69,column:9}},type:"if",locations:[{start:{line:67,column:8},end:{line:69,column:9}},{start:{line:67,column:8},end:{line:69,column:9}}],line:67},4:{loc:{start:{line:79,column:4},end:{line:81,column:5}},type:"if",locations:[{start:{line:79,column:4},end:{line:81,column:5}},{start:{line:79,column:4},end:{line:81,column:5}}],line:79},5:{loc:{start:{line:83,column:4},end:{line:85,column:5}},type:"if",locations:[{start:{line:83,column:4},end:{line:85,column:5}},{start:{line:83,column:4},end:{line:85,column:5}}],line:83},6:{loc:{start:{line:83,column:8},end:{line:83,column:63}},type:"binary-expr",locations:[{start:{line:83,column:8},end:{line:83,column:20}},{start:{line:83,column:24},end:{line:83,column:36}},{start:{line:83,column:40},end:{line:83,column:63}}],line:83},7:{loc:{start:{line:94,column:2},end:{line:94,column:40}},type:"if",locations:[{start:{line:94,column:2},end:{line:94,column:40}},{start:{line:94,column:2},end:{line:94,column:40}}],line:94},8:{loc:{start:{line:95,column:2},end:{line:97,column:3}},type:"if",locations:[{start:{line:95,column:2},end:{line:97,column:3}},{start:{line:95,column:2},end:{line:97,column:3}}],line:95},9:{loc:{start:{line:112,column:2},end:{line:114,column:3}},type:"if",locations:[{start:{line:112,column:2},end:{line:114,column:3}},{start:{line:112,column:2},end:{line:114,column:3}}],line:112},10:{loc:{start:{line:134,column:32},end:{line:134,column:45}},type:"cond-expr",locations:[{start:{line:134,column:40},end:{line:134,column:41}},{start:{line:134,column:44},end:{line:134,column:45}}],line:134},11:{loc:{start:{line:142,column:32},end:{line:142,column:45}},type:"cond-expr",locations:[{start:{line:142,column:40},end:{line:142,column:41}},{start:{line:142,column:44},end:{line:142,column:45}}],line:142},12:{loc:{start:{line:161,column:24},end:{line:161,column:78}},type:"binary-expr",locations:[{start:{line:161,column:24},end:{line:161,column:46}},{start:{line:161,column:50},end:{line:161,column:62}},{start:{line:161,column:66},end:{line:161,column:78}}],line:161},13:{loc:{start:{line:162,column:4},end:{line:162,column:24}},type:"if",locations:[{start:{line:162,column:4},end:{line:162,column:24}},{start:{line:162,column:4},end:{line:162,column:24}}],line:162},14:{loc:{start:{line:169,column:24},end:{line:169,column:78}},type:"binary-expr",locations:[{start:{line:169,column:24},end:{line:169,column:46}},{start:{line:169,column:50},end:{line:169,column:62}},{start:{line:169,column:66},end:{line:169,column:78}}],line:169},15:{loc:{start:{line:170,column:4},end:{line:170,column:25}},type:"if",locations:[{start:{line:170,column:4},end:{line:170,column:25}},{start:{line:170,column:4},end:{line:170,column:25}}],line:170},16:{loc:{start:{line:192,column:4},end:{line:199,column:5}},type:"if",locations:[{start:{line:192,column:4},end:{line:199,column:5}},{start:{line:192,column:4},end:{line:199,column:5}}],line:192},17:{loc:{start:{line:194,column:6},end:{line:196,column:7}},type:"if",locations:[{start:{line:194,column:6},end:{line:196,column:7}},{start:{line:194,column:6},end:{line:196,column:7}}],line:194},18:{loc:{start:{line:201,column:21},end:{line:201,column:49}},type:"binary-expr",locations:[{start:{line:201,column:21},end:{line:201,column:33}},{start:{line:201,column:37},end:{line:201,column:49}}],line:201},19:{loc:{start:{line:202,column:4},end:{line:207,column:5}},type:"if",locations:[{start:{line:202,column:4},end:{line:207,column:5}},{start:{line:202,column:4},end:{line:207,column:5}}],line:202},20:{loc:{start:{line:203,column:6},end:{line:205,column:7}},type:"if",locations:[{start:{line:203,column:6},end:{line:205,column:7}},{start:{line:203,column:6},end:{line:205,column:7}}],line:203},21:{loc:{start:{line:210,column:4},end:{line:217,column:5}},type:"if",locations:[{start:{line:210,column:4},end:{line:217,column:5}},{start:{line:210,column:4},end:{line:217,column:5}}],line:210},22:{loc:{start:{line:211,column:6},end:{line:213,column:7}},type:"if",locations:[{start:{line:211,column:6},end:{line:213,column:7}},{start:{line:211,column:6},end:{line:213,column:7}}],line:211},23:{loc:{start:{line:219,column:25},end:{line:219,column:54}},type:"binary-expr",locations:[{start:{line:219,column:25},end:{line:219,column:38}},{start:{line:219,column:42},end:{line:219,column:54}}],line:219},24:{loc:{start:{line:220,column:4},end:{line:224,column:5}},type:"if",locations:[{start:{line:220,column:4},end:{line:224,column:5}},{start:{line:220,column:4},end:{line:224,column:5}}],line:220},25:{loc:{start:{line:235,column:4},end:{line:253,column:5}},type:"if",locations:[{start:{line:235,column:4},end:{line:253,column:5}},{start:{line:235,column:4},end:{line:253,column:5}}],line:235},26:{loc:{start:{line:237,column:6},end:{line:252,column:7}},type:"if",locations:[{start:{line:237,column:6},end:{line:252,column:7}},{start:{line:237,column:6},end:{line:252,column:7}}],line:237},27:{loc:{start:{line:237,column:10},end:{line:237,column:51}},type:"binary-expr",locations:[{start:{line:237,column:10},end:{line:237,column:20}},{start:{line:237,column:24},end:{line:237,column:51}}],line:237},28:{loc:{start:{line:238,column:8},end:{line:243,column:9}},type:"if",locations:[{start:{line:238,column:8},end:{line:243,column:9}},{start:{line:238,column:8},end:{line:243,column:9}}],line:238},29:{loc:{start:{line:246,column:8},end:{line:251,column:9}},type:"if",locations:[{start:{line:246,column:8},end:{line:251,column:9}},{start:{line:246,column:8},end:{line:251,column:9}}],line:246},30:{loc:{start:{line:254,column:4},end:{line:266,column:5}},type:"if",locations:[{start:{line:254,column:4},end:{line:266,column:5}},{start:{line:254,column:4},end:{line:266,column:5}}],line:254},31:{loc:{start:{line:256,column:6},end:{line:261,column:7}},type:"if",locations:[{start:{line:256,column:6},end:{line:261,column:7}},{start:{line:256,column:6},end:{line:261,column:7}}],line:256},32:{loc:{start:{line:256,column:10},end:{line:256,column:56}},type:"binary-expr",locations:[{start:{line:256,column:10},end:{line:256,column:20}},{start:{line:256,column:24},end:{line:256,column:56}}],line:256},33:{loc:{start:{line:281,column:4},end:{line:284,column:5}},type:"if",locations:[{start:{line:281,column:4},end:{line:284,column:5}},{start:{line:281,column:4},end:{line:284,column:5}}],line:281},34:{loc:{start:{line:290,column:4},end:{line:293,column:5}},type:"if",locations:[{start:{line:290,column:4},end:{line:293,column:5}},{start:{line:290,column:4},end:{line:293,column:5}}],line:290},35:{loc:{start:{line:295,column:4},end:{line:306,column:5}},type:"if",locations:[{start:{line:295,column:4},end:{line:306,column:5}},{start:{line:295,column:4},end:{line:306,column:5}}],line:295}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0,25:0,26:0,27:0,28:0,29:0,30:0,31:0,32:0,33:0,34:0,35:0,36:0,37:0,38:0,39:0,40:0,41:0,42:0,43:0,44:0,45:0,46:0,47:0,48:0,49:0,50:0,51:0,52:0,53:0,54:0,55:0,56:0,57:0,58:0,59:0,60:0,61:0,62:0,63:0,64:0,65:0,66:0,67:0,68:0,69:0,70:0,71:0,72:0,73:0,74:0,75:0,76:0,77:0,78:0,79:0,80:0,81:0,82:0,83:0,84:0,85:0,86:0,87:0,88:0,89:0,90:0,91:0,92:0,93:0,94:0,95:0,96:0,97:0,98:0,99:0,100:0,101:0,102:0,103:0,104:0,105:0,106:0,107:0,108:0,109:0,110:0,111:0,112:0,113:0,114:0,115:0,116:0,117:0,118:0,119:0,120:0,121:0,122:0,123:0,124:0,125:0,126:0,127:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:0,136:0,137:0,138:0,139:0,140:0,141:0,142:0,143:0,144:0,145:0,146:0,147:0,148:0,149:0,150:0,151:0,152:0,153:0,154:0,155:0,156:0,157:0,158:0,159:0,160:0,161:0,162:0,163:0,164:0,165:0,166:0,167:0,168:0,169:0,170:0,171:0,172:0,173:0,174:0,175:0,176:0,177:0,178:0,179:0,180:0,181:0,182:0},f:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0},b:{0:[0,0],1:[0,0],2:[0,0],3:[0,0],4:[0,0],5:[0,0],6:[0,0,0],7:[0,0],8:[0,0],9:[0,0],10:[0,0],11:[0,0],12:[0,0,0],13:[0,0],14:[0,0,0],15:[0,0],16:[0,0],17:[0,0],18:[0,0],19:[0,0],20:[0,0],21:[0,0],22:[0,0],23:[0,0],24:[0,0],25:[0,0],26:[0,0],27:[0,0],28:[0,0],29:[0,0],30:[0,0],31:[0,0],32:[0,0],33:[0,0],34:[0,0],35:[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},Ct=Ke[_t]||(Ke[_t]={});return Ct[Le]&&Ct[Le].hash===Z?Ct[Le]:(xe.hash=Z,Ct[Le]=xe)}();Object.defineProperty(o,"__esModule",{value:!0}),o.feedPosition=h,o.jumpPosition=g,o.makeInitialPosition=d,o.copyPosition=A,o.default=S,o.lex=O,o.findTextEnd=W,o.lexText=L,o.lexComment=H,o.lexTag=Y,o.isWhitespaceChar=pe,o.lexTagName=de,o.lexTagAttributes=fe,o.lexSkipTag=Ee;var l=s("./compat");function h(Le,Z,ne){n.f[0]++;var Ke=(n.s[0]++,Le.index),_t=(n.s[1]++,Le.index=Ke+ne);n.s[2]++;for(var xe=Ke;xe<_t;xe++){var Ct=(n.s[3]++,Z.charAt(xe));n.s[4]++,Ct===`
`?(n.b[0][0]++,n.s[5]++,Le.line++,n.s[6]++,Le.column=0):(n.b[0][1]++,n.s[7]++,Le.column++)}}function g(Le,Z,ne){n.f[1]++;var Ke=(n.s[8]++,ne-Le.index);return n.s[9]++,h(Le,Z,Ke)}function d(){return n.f[2]++,n.s[10]++,{index:0,column:0,line:0}}function A(Le){return n.f[3]++,n.s[11]++,{index:Le.index,line:Le.line,column:Le.column}}function S(Le,Z){n.f[4]++;var ne=(n.s[12]++,{str:Le,options:Z,position:d(),tokens:[]});return n.s[13]++,O(ne),n.s[14]++,ne.tokens}function O(Le){n.f[5]++;var Z=(n.s[15]++,Le),ne=Z.str,Ke=Z.options.childlessTags,_t=(n.s[16]++,ne.length);for(n.s[17]++;Le.position.index<_t;){var xe=(n.s[18]++,Le.position.index);if(n.s[19]++,L(Le),n.s[20]++,Le.position.index===xe){n.b[1][0]++;var Ct=(n.s[21]++,(0,l.startsWith)(ne,"!--",xe+1));if(n.s[22]++,Ct)n.b[2][0]++,n.s[23]++,H(Le);else{n.b[2][1]++;var zt=(n.s[24]++,Y(Le)),Je=(n.s[25]++,zt.toLowerCase());n.s[26]++,(0,l.arrayIncludes)(Ke,Je)?(n.b[3][0]++,n.s[27]++,Ee(zt,Le)):n.b[3][1]++}}else n.b[1][1]++}}var I=(n.s[28]++,/[A-Za-z0-9]/);function W(Le,Z){for(n.f[6]++,n.s[29]++;;){var ne=(n.s[30]++,Le.indexOf("<",Z));if(n.s[31]++,ne===-1)return n.b[4][0]++,n.s[32]++,ne;n.b[4][1]++;var Ke=(n.s[33]++,Le.charAt(ne+1));if(n.s[34]++,n.b[6][0]++,Ke==="/"||(n.b[6][1]++,Ke==="!")||(n.b[6][2]++,I.test(Ke)))return n.b[5][0]++,n.s[35]++,ne;n.b[5][1]++,n.s[36]++,Z=ne+1}}function L(Le){n.f[7]++;var Z=(n.s[37]++,"text"),ne=(n.s[38]++,Le),Ke=ne.str,_t=ne.position,xe=(n.s[39]++,W(Ke,_t.index));if(n.s[40]++,xe===_t.index){n.b[7][0]++,n.s[41]++;return}else n.b[7][1]++;n.s[42]++,xe===-1?(n.b[8][0]++,n.s[43]++,xe=Ke.length):n.b[8][1]++;var Ct=(n.s[44]++,A(_t)),zt=(n.s[45]++,Ke.slice(_t.index,xe));n.s[46]++,g(_t,Ke,xe);var Je=(n.s[47]++,A(_t));n.s[48]++,Le.tokens.push({type:Z,content:zt,position:{start:Ct,end:Je}})}function H(Le){n.f[8]++;var Z=(n.s[49]++,Le),ne=Z.str,Ke=Z.position,_t=(n.s[50]++,A(Ke));n.s[51]++,h(Ke,ne,4);var xe=(n.s[52]++,ne.indexOf("-->",Ke.index)),Ct=(n.s[53]++,xe+3);n.s[54]++,xe===-1?(n.b[9][0]++,n.s[55]++,xe=Ct=ne.length):n.b[9][1]++;var zt=(n.s[56]++,ne.slice(Ke.index,xe));n.s[57]++,g(Ke,ne,Ct),n.s[58]++,Le.tokens.push({type:"comment",content:zt,position:{start:_t,end:A(Ke)}})}function Y(Le){n.f[9]++;var Z=(n.s[59]++,Le),ne=Z.str,Ke=Z.position;{var _t=(n.s[60]++,ne.charAt(Ke.index+1)),xe=(n.s[61]++,_t==="/"),Ct=(n.s[62]++,A(Ke));n.s[63]++,h(Ke,ne,xe?(n.b[10][0]++,2):(n.b[10][1]++,1)),n.s[64]++,Le.tokens.push({type:"tag-start",close:xe,position:{start:Ct}})}var zt=(n.s[65]++,de(Le));n.s[66]++,fe(Le);{var Je=(n.s[67]++,ne.charAt(Ke.index)),Et=(n.s[68]++,Je==="/");n.s[69]++,h(Ke,ne,Et?(n.b[11][0]++,2):(n.b[11][1]++,1));var ht=(n.s[70]++,A(Ke));n.s[71]++,Le.tokens.push({type:"tag-end",close:Et,position:{end:ht}})}return n.s[72]++,zt}var Q=(n.s[73]++,/\s/);function pe(Le){return n.f[10]++,n.s[74]++,Q.test(Le)}function de(Le){n.f[11]++;var Z=(n.s[75]++,Le),ne=Z.str,Ke=Z.position,_t=(n.s[76]++,ne.length),xe=(n.s[77]++,Ke.index);for(n.s[78]++;xe<_t;){var Ct=(n.s[79]++,ne.charAt(xe)),zt=(n.s[80]++,n.b[12][0]++,!(pe(Ct)||(n.b[12][1]++,Ct==="/")||(n.b[12][2]++,Ct===">")));if(n.s[81]++,zt){n.b[13][0]++,n.s[82]++;break}else n.b[13][1]++;n.s[83]++,xe++}var Je=(n.s[84]++,xe+1);for(n.s[85]++;Je<_t;){var Et=(n.s[86]++,ne.charAt(Je)),ht=(n.s[87]++,n.b[14][0]++,!(pe(Et)||(n.b[14][1]++,Et==="/")||(n.b[14][2]++,Et===">")));if(n.s[88]++,ht)n.b[15][1]++;else{n.b[15][0]++,n.s[89]++;break}n.s[90]++,Je++}n.s[91]++,g(Ke,ne,Je);var mt=(n.s[92]++,ne.slice(xe,Je));return n.s[93]++,Le.tokens.push({type:"tag",content:mt}),n.s[94]++,mt}function fe(Le){n.f[12]++;var Z=(n.s[95]++,Le),ne=Z.str,Ke=Z.position,_t=Z.tokens,xe=(n.s[96]++,Ke.index),Ct=(n.s[97]++,null),zt=(n.s[98]++,xe),Je=(n.s[99]++,[]),Et=(n.s[100]++,ne.length);for(n.s[101]++;xe<Et;){var ht=(n.s[102]++,ne.charAt(xe));if(n.s[103]++,Ct){n.b[16][0]++;var mt=(n.s[104]++,ht===Ct);n.s[105]++,mt?(n.b[17][0]++,n.s[106]++,Ct=null):n.b[17][1]++,n.s[107]++,xe++,n.s[108]++;continue}else n.b[16][1]++;var Nt=(n.s[109]++,n.b[18][0]++,ht==="/"||(n.b[18][1]++,ht===">"));if(n.s[110]++,Nt){n.b[19][0]++,n.s[111]++,xe!==zt?(n.b[20][0]++,n.s[112]++,Je.push(ne.slice(zt,xe))):n.b[20][1]++,n.s[113]++;break}else n.b[19][1]++;var Gt=(n.s[114]++,pe(ht));if(n.s[115]++,Gt){n.b[21][0]++,n.s[116]++,xe!==zt?(n.b[22][0]++,n.s[117]++,Je.push(ne.slice(zt,xe))):n.b[22][1]++,n.s[118]++,zt=xe+1,n.s[119]++,xe++,n.s[120]++;continue}else n.b[21][1]++;var Mt=(n.s[121]++,n.b[23][0]++,ht==="'"||(n.b[23][1]++,ht==='"'));if(n.s[122]++,Mt){n.b[24][0]++,n.s[123]++,Ct=ht,n.s[124]++,xe++,n.s[125]++;continue}else n.b[24][1]++;n.s[126]++,xe++}n.s[127]++,g(Ke,ne,xe);var jt=(n.s[128]++,Je.length),Ai=(n.s[129]++,"attribute");n.s[130]++;for(var oi=0;oi<jt;oi++){var ki=(n.s[131]++,Je[oi]),Li=(n.s[132]++,ki.indexOf("=")===-1);if(n.s[133]++,Li){n.b[25][0]++;var Wi=(n.s[134]++,Je[oi+1]);if(n.s[135]++,n.b[27][0]++,Wi&&(n.b[27][1]++,(0,l.startsWith)(Wi,"="))){if(n.b[26][0]++,n.s[136]++,Wi.length>1){n.b[28][0]++;var Vi=(n.s[137]++,ki+Wi);n.s[138]++,_t.push({type:Ai,content:Vi}),n.s[139]++,oi+=1,n.s[140]++;continue}else n.b[28][1]++;var qi=(n.s[141]++,Je[oi+2]);if(n.s[142]++,oi+=1,n.s[143]++,qi){n.b[29][0]++;var Kt=(n.s[144]++,ki+"="+qi);n.s[145]++,_t.push({type:Ai,content:Kt}),n.s[146]++,oi+=1,n.s[147]++;continue}else n.b[29][1]++}else n.b[26][1]++}else n.b[25][1]++;if(n.s[148]++,(0,l.endsWith)(ki,"=")){n.b[30][0]++;var zs=(n.s[149]++,Je[oi+1]);if(n.s[150]++,n.b[32][0]++,zs&&(n.b[32][1]++,!(0,l.stringIncludes)(zs,"="))){n.b[31][0]++;var ls=(n.s[151]++,ki+zs);n.s[152]++,_t.push({type:Ai,content:ls}),n.s[153]++,oi+=1,n.s[154]++;continue}else n.b[31][1]++;var gs=(n.s[155]++,ki.slice(0,-1));n.s[156]++,_t.push({type:Ai,content:gs}),n.s[157]++;continue}else n.b[30][1]++;n.s[158]++,_t.push({type:Ai,content:ki})}}var ye=(n.s[159]++,[].push);function Ee(Le,Z){n.f[13]++;var ne=(n.s[160]++,Z),Ke=ne.str,_t=ne.position,xe=ne.tokens,Ct=(n.s[161]++,Le.toLowerCase()),zt=(n.s[162]++,Ke.length),Je=(n.s[163]++,_t.index);for(n.s[164]++;Je<zt;){var Et=(n.s[165]++,Ke.indexOf("</",Je));if(n.s[166]++,Et===-1){n.b[33][0]++,n.s[167]++,L(Z),n.s[168]++;break}else n.b[33][1]++;var ht=(n.s[169]++,A(_t));n.s[170]++,g(ht,Ke,Et);var mt=(n.s[171]++,{str:Ke,position:ht,tokens:[]}),Nt=(n.s[172]++,Y(mt));if(n.s[173]++,Ct!==Nt.toLowerCase()){n.b[34][0]++,n.s[174]++,Je=mt.position.index,n.s[175]++;continue}else n.b[34][1]++;if(n.s[176]++,Et!==_t.index){n.b[35][0]++;var Gt=(n.s[177]++,A(_t));n.s[178]++,g(_t,Ke,Et),n.s[179]++,xe.push({type:"text",content:Ke.slice(Gt.index,Et),position:{start:Gt,end:A(_t)}})}else n.b[35][1]++;n.s[180]++,ye.apply(xe,mt.tokens),n.s[181]++,g(_t,Ke,mt.position.index),n.s[182]++;break}}},{"./compat":1}],5:[function(s,r,o){var n=function(){var S="/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/parser.js",O="10fb0478bb046c7059c47c8225586b7e30f48474",I=(function(){}).constructor,W=new I("return this")(),L="__coverage__",H={path:"/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/parser.js",statementMap:{0:{start:{line:4,column:15},end:{line:4,column:44}},1:{start:{line:5,column:16},end:{line:5,column:59}},2:{start:{line:6,column:2},end:{line:6,column:14}},3:{start:{line:7,column:2},end:{line:7,column:22}},4:{start:{line:11,column:21},end:{line:11,column:39}},5:{start:{line:12,column:2},end:{line:24,column:3}},6:{start:{line:13,column:23},end:{line:13,column:39}},7:{start:{line:14,column:4},end:{line:23,column:5}},8:{start:{line:15,column:28},end:{line:15,column:55}},9:{start:{line:16,column:6},end:{line:18,column:7}},10:{start:{line:17,column:8},end:{line:17,column:13}},11:{start:{line:19,column:6},end:{line:21,column:7}},12:{start:{line:20,column:8},end:{line:20,column:19}},13:{start:{line:22,column:6},end:{line:22,column:20}},14:{start:{line:25,column:2},end:{line:25,column:14}},15:{start:{line:29,column:2},end:{line:29,column:45}},16:{start:{line:30,column:2},end:{line:32,column:3}},17:{start:{line:31,column:4},end:{line:31,column:47}},18:{start:{line:33,column:2},end:{line:33,column:25}},19:{start:{line:37,column:28},end:{line:37,column:33}},20:{start:{line:38,column:16},end:{line:38,column:21}},21:{start:{line:39,column:14},end:{line:39,column:46}},22:{start:{line:40,column:14},end:{line:40,column:27}},23:{start:{line:41,column:17},end:{line:41,column:22}},24:{start:{line:42,column:2},end:{line:132,column:3}},25:{start:{line:43,column:18},end:{line:43,column:32}},26:{start:{line:44,column:4},end:{line:48,column:5}},27:{start:{line:45,column:6},end:{line:45,column:23}},28:{start:{line:46,column:6},end:{line:46,column:14}},29:{start:{line:47,column:6},end:{line:47,column:14}},30:{start:{line:50,column:21},end:{line:50,column:37}},31:{start:{line:51,column:4},end:{line:51,column:12}},32:{start:{line:52,column:20},end:{line:52,column:50}},33:{start:{line:53,column:4},end:{line:73,column:5}},34:{start:{line:54,column:18},end:{line:54,column:30}},35:{start:{line:55,column:25},end:{line:55,column:30}},36:{start:{line:56,column:6},end:{line:61,column:7}},37:{start:{line:57,column:8},end:{line:60,column:9}},38:{start:{line:58,column:10},end:{line:58,column:29}},39:{start:{line:59,column:10},end:{line:59,column:15}},40:{start:{line:62,column:6},end:{line:66,column:7}},41:{start:{line:63,column:25},end:{line:63,column:39}},42:{start:{line:64,column:8},end:{line:64,column:46}},43:{start:{line:64,column:41},end:{line:64,column:46}},44:{start:{line:65,column:8},end:{line:65,column:16}},45:{start:{line:67,column:6},end:{line:72,column:7}},46:{start:{line:68,column:8},end:{line:68,column:88}},47:{start:{line:69,column:8},end:{line:69,column:13}},48:{start:{line:71,column:8},end:{line:71,column:16}},49:{start:{line:75,column:25},end:{line:75,column:68}},50:{start:{line:76,column:34},end:{line:76,column:46}},51:{start:{line:77,column:4},end:{line:80,column:5}},52:{start:{line:78,column:56},end:{line:78,column:63}},53:{start:{line:79,column:6},end:{line:79,column:77}},54:{start:{line:82,column:4},end:{line:95,column:5}},55:{start:{line:85,column:25},end:{line:85,column:41}},56:{start:{line:86,column:6},end:{line:94,column:7}},57:{start:{line:87,column:8},end:{line:92,column:9}},58:{start:{line:88,column:10},end:{line:88,column:86}},59:{start:{line:89,column:32},end:{line:89,column:48}},60:{start:{line:90,column:10},end:{line:90,column:47}},61:{start:{line:91,column:10},end:{line:91,column:15}},62:{start:{line:93,column:8},end:{line:93,column:39}},63:{start:{line:97,column:21},end:{line:97,column:23}},64:{start:{line:99,column:4},end:{line:104,column:5}},65:{start:{line:100,column:6},end:{line:100,column:32}},66:{start:{line:101,column:6},end:{line:101,column:45}},67:{start:{line:101,column:40},end:{line:101,column:45}},68:{start:{line:102,column:6},end:{line:102,column:40}},69:{start:{line:103,column:6},end:{line:103,column:14}},70:{start:{line:106,column:4},end:{line:106,column:12}},71:{start:{line:107,column:21},end:{line:107,column:23}},72:{start:{line:108,column:21},end:{line:111,column:5}},73:{start:{line:112,column:24},end:{line:118,column:5}},74:{start:{line:119,column:4},end:{line:119,column:27}},75:{start:{line:121,column:24},end:{line:121,column:86}},76:{start:{line:122,column:4},end:{line:131,column:5}},77:{start:{line:123,column:19},end:{line:123,column:60}},78:{start:{line:124,column:25},end:{line:124,column:57}},79:{start:{line:125,column:6},end:{line:125,column:23}},80:{start:{line:126,column:6},end:{line:126,column:32}},81:{start:{line:127,column:31},end:{line:127,column:52}},82:{start:{line:128,column:6},end:{line:130,column:7}},83:{start:{line:129,column:8},end:{line:129,column:66}},84:{start:{line:133,column:2},end:{line:133,column:23}}},fnMap:{0:{name:"parser",decl:{start:{line:3,column:24},end:{line:3,column:30}},loc:{start:{line:3,column:49},end:{line:8,column:1}},line:3},1:{name:"hasTerminalParent",decl:{start:{line:10,column:16},end:{line:10,column:33}},loc:{start:{line:10,column:62},end:{line:26,column:1}},line:10},2:{name:"rewindStack",decl:{start:{line:28,column:16},end:{line:28,column:27}},loc:{start:{line:28,column:81},end:{line:34,column:1}},line:28},3:{name:"parse",decl:{start:{line:36,column:16},end:{line:36,column:21}},loc:{start:{line:36,column:30},end:{line:134,column:1}},line:36}},branchMap:{0:{loc:{start:{line:12,column:2},end:{line:24,column:3}},type:"if",locations:[{start:{line:12,column:2},end:{line:24,column:3}},{start:{line:12,column:2},end:{line:24,column:3}}],line:12},1:{loc:{start:{line:16,column:6},end:{line:18,column:7}},type:"if",locations:[{start:{line:16,column:6},end:{line:18,column:7}},{start:{line:16,column:6},end:{line:18,column:7}}],line:16},2:{loc:{start:{line:19,column:6},end:{line:21,column:7}},type:"if",locations:[{start:{line:19,column:6},end:{line:21,column:7}},{start:{line:19,column:6},end:{line:21,column:7}}],line:19},3:{loc:{start:{line:44,column:4},end:{line:48,column:5}},type:"if",locations:[{start:{line:44,column:4},end:{line:48,column:5}},{start:{line:44,column:4},end:{line:48,column:5}}],line:44},4:{loc:{start:{line:53,column:4},end:{line:73,column:5}},type:"if",locations:[{start:{line:53,column:4},end:{line:73,column:5}},{start:{line:53,column:4},end:{line:73,column:5}}],line:53},5:{loc:{start:{line:57,column:8},end:{line:60,column:9}},type:"if",locations:[{start:{line:57,column:8},end:{line:60,column:9}},{start:{line:57,column:8},end:{line:60,column:9}}],line:57},6:{loc:{start:{line:64,column:8},end:{line:64,column:46}},type:"if",locations:[{start:{line:64,column:8},end:{line:64,column:46}},{start:{line:64,column:8},end:{line:64,column:46}}],line:64},7:{loc:{start:{line:67,column:6},end:{line:72,column:7}},type:"if",locations:[{start:{line:67,column:6},end:{line:72,column:7}},{start:{line:67,column:6},end:{line:72,column:7}}],line:67},8:{loc:{start:{line:77,column:4},end:{line:80,column:5}},type:"if",locations:[{start:{line:77,column:4},end:{line:80,column:5}},{start:{line:77,column:4},end:{line:80,column:5}}],line:77},9:{loc:{start:{line:82,column:4},end:{line:95,column:5}},type:"if",locations:[{start:{line:82,column:4},end:{line:95,column:5}},{start:{line:82,column:4},end:{line:95,column:5}}],line:82},10:{loc:{start:{line:87,column:8},end:{line:92,column:9}},type:"if",locations:[{start:{line:87,column:8},end:{line:92,column:9}},{start:{line:87,column:8},end:{line:92,column:9}}],line:87},11:{loc:{start:{line:101,column:6},end:{line:101,column:45}},type:"if",locations:[{start:{line:101,column:6},end:{line:101,column:45}},{start:{line:101,column:6},end:{line:101,column:45}}],line:101},12:{loc:{start:{line:121,column:26},end:{line:121,column:85}},type:"binary-expr",locations:[{start:{line:121,column:26},end:{line:121,column:41}},{start:{line:121,column:45},end:{line:121,column:85}}],line:121},13:{loc:{start:{line:122,column:4},end:{line:131,column:5}},type:"if",locations:[{start:{line:122,column:4},end:{line:131,column:5}},{start:{line:122,column:4},end:{line:131,column:5}}],line:122},14:{loc:{start:{line:128,column:6},end:{line:130,column:7}},type:"if",locations:[{start:{line:128,column:6},end:{line:130,column:7}},{start:{line:128,column:6},end:{line:130,column:7}}],line:128}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0,25:0,26:0,27:0,28:0,29:0,30:0,31:0,32:0,33:0,34:0,35:0,36:0,37:0,38:0,39:0,40:0,41:0,42:0,43:0,44:0,45:0,46:0,47:0,48:0,49:0,50:0,51:0,52:0,53:0,54:0,55:0,56:0,57:0,58:0,59:0,60:0,61:0,62:0,63:0,64:0,65:0,66:0,67:0,68:0,69:0,70:0,71:0,72:0,73:0,74:0,75:0,76:0,77:0,78:0,79:0,80:0,81:0,82:0,83:0,84:0},f:{0:0,1:0,2:0,3:0},b:{0:[0,0],1:[0,0],2:[0,0],3:[0,0],4:[0,0],5:[0,0],6:[0,0],7:[0,0],8:[0,0],9:[0,0],10:[0,0],11:[0,0],12:[0,0],13:[0,0],14:[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},Y=W[L]||(W[L]={});return Y[S]&&Y[S].hash===O?Y[S]:(H.hash=O,Y[S]=H)}();Object.defineProperty(o,"__esModule",{value:!0}),o.default=h,o.hasTerminalParent=g,o.rewindStack=d,o.parse=A;var l=s("./compat");function h(S,O){n.f[0]++;var I=(n.s[0]++,{tagName:null,children:[]}),W=(n.s[1]++,{tokens:S,options:O,cursor:0,stack:[I]});return n.s[2]++,A(W),n.s[3]++,I.children}function g(S,O,I){n.f[1]++;var W=(n.s[4]++,I[S]);if(n.s[5]++,W){n.b[0][0]++;var L=(n.s[6]++,O.length-1);for(n.s[7]++;L>=0;){var H=(n.s[8]++,O[L].tagName);if(n.s[9]++,H===S){n.b[1][0]++,n.s[10]++;break}else n.b[1][1]++;if(n.s[11]++,(0,l.arrayIncludes)(W,H))return n.b[2][0]++,n.s[12]++,!0;n.b[2][1]++,n.s[13]++,L--}}else n.b[0][1]++;return n.s[14]++,!1}function d(S,O,I,W){n.f[2]++,n.s[15]++,S[O].position.end=W,n.s[16]++;for(var L=O+1,H=S.length;L<H;L++)n.s[17]++,S[L].position.end=I;n.s[18]++,S.splice(O)}function A(S){n.f[3]++;var O=(n.s[19]++,S),I=O.tokens,W=O.options,L=(n.s[20]++,S),H=L.stack,Y=(n.s[21]++,H[H.length-1].children),Q=(n.s[22]++,I.length),pe=(n.s[23]++,S),de=pe.cursor;for(n.s[24]++;de<Q;){var fe=(n.s[25]++,I[de]);if(n.s[26]++,fe.type!=="tag-start"){n.b[3][0]++,n.s[27]++,Y.push(fe),n.s[28]++,de++,n.s[29]++;continue}else n.b[3][1]++;var ye=(n.s[30]++,I[++de]);n.s[31]++,de++;var Ee=(n.s[32]++,ye.content.toLowerCase());if(n.s[33]++,fe.close){n.b[4][0]++;var Le=(n.s[34]++,H.length),Z=(n.s[35]++,!1);for(n.s[36]++;--Le>-1;)if(n.s[37]++,H[Le].tagName===Ee){n.b[5][0]++,n.s[38]++,Z=!0,n.s[39]++;break}else n.b[5][1]++;for(n.s[40]++;de<Q;){var ne=(n.s[41]++,I[de]);if(n.s[42]++,ne.type!=="tag-end"){n.b[6][0]++,n.s[43]++;break}else n.b[6][1]++;n.s[44]++,de++}if(n.s[45]++,Z){n.b[7][0]++,n.s[46]++,d(H,Le,fe.position.start,I[de-1].position.end),n.s[47]++;break}else{n.b[7][1]++,n.s[48]++;continue}}else n.b[4][1]++;var Ke=(n.s[49]++,(0,l.arrayIncludes)(W.closingTags,Ee)),_t=(n.s[50]++,Ke);if(n.s[51]++,_t){n.b[8][0]++;var xe=(n.s[52]++,W),Ct=xe.closingTagAncestorBreakers;n.s[53]++,_t=!g(Ee,H,Ct)}else n.b[8][1]++;if(n.s[54]++,_t){n.b[9][0]++;var zt=(n.s[55]++,H.length-1);for(n.s[56]++;zt>0;){if(n.s[57]++,Ee===H[zt].tagName){n.b[10][0]++,n.s[58]++,d(H,zt,fe.position.start,fe.position.start);var Je=(n.s[59]++,zt-1);n.s[60]++,Y=H[Je].children,n.s[61]++;break}else n.b[10][1]++;n.s[62]++,zt=zt-1}}else n.b[9][1]++;var Et=(n.s[63]++,[]),ht=void 0;for(n.s[64]++;de<Q;){if(n.s[65]++,ht=I[de],n.s[66]++,ht.type==="tag-end"){n.b[11][0]++,n.s[67]++;break}else n.b[11][1]++;n.s[68]++,Et.push(ht.content),n.s[69]++,de++}n.s[70]++,de++;var mt=(n.s[71]++,[]),Nt=(n.s[72]++,{start:fe.position.start,end:ht.position.end}),Gt=(n.s[73]++,{type:"element",tagName:ye.content,attributes:Et,children:mt,position:Nt});n.s[74]++,Y.push(Gt);var Mt=(n.s[75]++,n.b[12][0]++,!(ht.close||(n.b[12][1]++,(0,l.arrayIncludes)(W.voidTags,Ee))));if(n.s[76]++,Mt){n.b[13][0]++;var jt=(n.s[77]++,H.push({tagName:Ee,children:mt,position:Nt})),Ai=(n.s[78]++,{tokens:I,options:W,cursor:de,stack:H});n.s[79]++,A(Ai),n.s[80]++,de=Ai.cursor;var oi=(n.s[81]++,H.length===jt);n.s[82]++,oi?(n.b[14][0]++,n.s[83]++,Gt.position.end=I[de-1].position.end):n.b[14][1]++}else n.b[13][1]++}n.s[84]++,S.cursor=de}},{"./compat":1}],6:[function(s,r,o){var n=function(){var d="/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/stringify.js",A="4a6a4628f3d12bd91f868fee07f716c74df89307",S=(function(){}).constructor,O=new S("return this")(),I="__coverage__",W={path:"/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/stringify.js",statementMap:{0:{start:{line:4,column:2},end:{line:12,column:8}},1:{start:{line:5,column:25},end:{line:5,column:34}},2:{start:{line:6,column:4},end:{line:8,column:5}},3:{start:{line:7,column:6},end:{line:7,column:30}},4:{start:{line:9,column:24},end:{line:9,column:50}},5:{start:{line:10,column:18},end:{line:10,column:42}},6:{start:{line:11,column:4},end:{line:11,column:53}},7:{start:{line:16,column:2},end:{line:28,column:13}},8:{start:{line:17,column:4},end:{line:19,column:5}},9:{start:{line:18,column:6},end:{line:18,column:25}},10:{start:{line:20,column:4},end:{line:22,column:5}},11:{start:{line:21,column:6},end:{line:21,column:37}},12:{start:{line:23,column:44},end:{line:23,column:48}},13:{start:{line:24,column:26},end:{line:24,column:80}},14:{start:{line:25,column:4},end:{line:27,column:94}}},fnMap:{0:{name:"formatAttributes",decl:{start:{line:3,column:16},end:{line:3,column:32}},loc:{start:{line:3,column:46},end:{line:13,column:1}},line:3},1:{name:"(anonymous_1)",decl:{start:{line:4,column:27},end:{line:4,column:28}},loc:{start:{line:4,column:49},end:{line:12,column:3}},line:4},2:{name:"toHTML",decl:{start:{line:15,column:16},end:{line:15,column:22}},loc:{start:{line:15,column:39},end:{line:29,column:1}},line:15},3:{name:"(anonymous_3)",decl:{start:{line:16,column:18},end:{line:16,column:19}},loc:{start:{line:16,column:26},end:{line:28,column:3}},line:16}},branchMap:{0:{loc:{start:{line:6,column:4},end:{line:8,column:5}},type:"if",locations:[{start:{line:6,column:4},end:{line:8,column:5}},{start:{line:6,column:4},end:{line:8,column:5}}],line:6},1:{loc:{start:{line:10,column:18},end:{line:10,column:42}},type:"cond-expr",locations:[{start:{line:10,column:32},end:{line:10,column:35}},{start:{line:10,column:38},end:{line:10,column:42}}],line:10},2:{loc:{start:{line:17,column:4},end:{line:19,column:5}},type:"if",locations:[{start:{line:17,column:4},end:{line:19,column:5}},{start:{line:17,column:4},end:{line:19,column:5}}],line:17},3:{loc:{start:{line:20,column:4},end:{line:22,column:5}},type:"if",locations:[{start:{line:20,column:4},end:{line:22,column:5}},{start:{line:20,column:4},end:{line:22,column:5}}],line:20},4:{loc:{start:{line:25,column:11},end:{line:27,column:94}},type:"cond-expr",locations:[{start:{line:26,column:8},end:{line:26,column:53}},{start:{line:27,column:8},end:{line:27,column:94}}],line:25}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0},f:{0:0,1:0,2:0,3:0},b:{0:[0,0],1:[0,0],2:[0,0],3:[0,0],4:[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},L=O[I]||(O[I]={});return L[d]&&L[d].hash===A?L[d]:(W.hash=A,L[d]=W)}();Object.defineProperty(o,"__esModule",{value:!0}),o.formatAttributes=h,o.toHTML=g;var l=s("./compat");function h(d){return n.f[0]++,n.s[0]++,d.reduce(function(A,S){n.f[1]++;var O=(n.s[1]++,S),I=O.key,W=O.value;if(n.s[2]++,W===null)return n.b[0][0]++,n.s[3]++,A+" "+I;n.b[0][1]++;var L=(n.s[4]++,W.indexOf("'")!==-1),H=(n.s[5]++,L?(n.b[1][0]++,'"'):(n.b[1][1]++,"'"));return n.s[6]++,A+" "+I+"="+H+W+H},"")}function g(d,A){return n.f[2]++,n.s[7]++,d.map(function(S){if(n.f[3]++,n.s[8]++,S.type==="text")return n.b[2][0]++,n.s[9]++,S.content;if(n.b[2][1]++,n.s[10]++,S.type==="comment")return n.b[3][0]++,n.s[11]++,"<!--"+S.content+"-->";n.b[3][1]++;var O=(n.s[12]++,S),I=O.tagName,W=O.attributes,L=O.children,H=(n.s[13]++,(0,l.arrayIncludes)(A.voidTags,I.toLowerCase()));return n.s[14]++,H?(n.b[4][0]++,"<"+I+h(W)+">"):(n.b[4][1]++,"<"+I+h(W)+">"+g(L,A)+"</"+I+">")}).join("")}o.default={toHTML:g}},{"./compat":1}],7:[function(s,r,o){var n=function(){var l="/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/tags.js",h="6039b9f65d15797c952509955976acf6930e65a4",g=(function(){}).constructor,d=new g("return this")(),A="__coverage__",S={path:"/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/tags.js",statementMap:{0:{start:{line:5,column:29},end:{line:5,column:60}},1:{start:{line:11,column:27},end:{line:14,column:1}},2:{start:{line:23,column:42},end:{line:32,column:1}},3:{start:{line:38,column:24},end:{line:42,column:1}}},fnMap:{},branchMap:{},s:{0:0,1:0,2:0,3:0},f:{},b:{},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},O=d[A]||(d[A]={});return O[l]&&O[l].hash===h?O[l]:(S.hash=h,O[l]=S)}();Object.defineProperty(o,"__esModule",{value:!0}),o.childlessTags=(n.s[0]++,["style","script","template"]),o.closingTags=(n.s[1]++,["html","head","body","p","dt","dd","li","option","thead","th","tbody","tr","td","tfoot","colgroup"]),o.closingTagAncestorBreakers=(n.s[2]++,{li:["ul","ol","menu"],dt:["dl"],dd:["dl"],tbody:["table"],thead:["table"],tfoot:["table"],tr:["table"],td:["table"]}),o.voidTags=(n.s[3]++,["!doctype","area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"])},{}]},{},[3])(3)})})();(function(){window.assertions=window.assertions||{},window.assertions.assertFunction=window.assertions.assertFunction||function(a,...t){if(!a){t=t.filter(r=>!!t),window.navigator&&window.navigator.appName==="Microsoft Internet Explorer"&&t.push(`stack=
${new Error().stack}`);const s=t.length>0?"Assertion failed: ":"Assertion failed";if(console&&console.error&&console.error(s,...t),window.QueryStringMachine&&QueryStringMachine.containsKey("debugger"))debugger;throw new Error(s+t.join(`
 `))}},window.assert=window.assert||null,window.assertSlow=window.assertSlow||null,window.assertions.enableAssert=function(){window.assert=window.assertions.assertFunction,window.console&&window.console.log&&window.console.log("enabling assert")},window.assertions.disableAssert=function(){window.assert=null,window.console&&window.console.log&&window.console.log("disabling assert")},window.assertions.enableAssertSlow=function(){window.assertSlow=window.assertions.assertFunction,window.console&&window.console.log&&window.console.log("enabling assertSlow")},window.assertions.disableAssertSlow=function(){window.assertSlow=null,window.console&&window.console.log&&window.console.log("disabling assertSlow")}})();window.phet=window.phet||{};window.phet.chipper=window.phet.chipper||{};window.phet.chipper.packageObject={name:"scenery-lab-demo"};window.phet.chipper.stringRepos=[{repo:"joist",requirejsNamespace:"JOIST"},{repo:"scenery-phet",requirejsNamespace:"SCENERY_PHET"},{repo:"sun",requirejsNamespace:"SUN"},{repo:"tambo",requirejsNamespace:"TAMBO"},{repo:"vegas",requirejsNamespace:"VEGAS"}];window.phet.chipper.strings={en:{a11y:{numberSpinnerRoleDescription:{value:"number spinner"},close:{value:"Close"},closed:{value:"Closed"},titleClosePattern:{value:"{{title}}, Close."}}}};let isHMR;try{isHMR=module&&module.hot}catch{isHMR=!1}const isHMR$1=isHMR;class Namespace{constructor(t){if(this.name=t,window.phet){if(t==="chipper")return window.phet.chipper.name="chipper",window.phet.chipper.register=this.register.bind(window.phet.chipper),window.phet.chipper;{const s=!_.hasIn(window,"phet.chipper.brand");assert&&!s&&assert(!window.phet[t],`namespace ${t} already exists`),window.phet[t]=this}}}register(t,s){if(t.includes("."))isHMR$1||assert&&assert(!this[t],`${t} is already registered for namespace ${this.name}`),this[t]=s;else{const r=t.split(".");let o=this;for(let l=0;l<r.length-1;l++)isHMR$1||assert&&assert(!!o[r[l]],`${[this.name].concat(r.slice(0,l+1)).join(".")} needs to be defined to register ${t}`),o=o[r[l]];const n=r[r.length-1];isHMR$1||assert&&assert(!o[n],`${t} is already registered for namespace ${this.name}`),o[n]=s}return s}}const phetCore=new Namespace("phetCore");phetCore.register("Namespace",Namespace);function arrayDifference(a,t,s,r,o){assert&&assert(Array.isArray(a)&&_.uniq(a).length===a.length,"a is not an array of unique items"),assert&&assert(Array.isArray(t)&&_.uniq(t).length===t.length,"b is not an array of unique items"),s=s||[],r=r||[],o=o||[],assert&&assert(Array.isArray(s)&&s.length===0),assert&&assert(Array.isArray(r)&&r.length===0),assert&&assert(Array.isArray(o)&&o.length===0),Array.prototype.push.apply(s,a),Array.prototype.push.apply(r,t);e:for(let n=0;n<s.length;n++){const l=s[n];for(let h=0;h<r.length;h++){const g=r[h];if(l===g){if(o.push(l),s.splice(n,1),r.splice(h,1),h=0,n===s.length)break e;n-=1}}}return s}phetCore.register("arrayDifference",arrayDifference);function arrayRemove(a,t){assert&&assert(Array.isArray(a),"arrayRemove takes an Array");const s=_.indexOf(a,t);assert&&assert(s>=0,"item not found in Array"),a.splice(s,1)}phetCore.register("arrayRemove",arrayRemove);function inheritance(a){const t=[a];let s=a.prototype;for(;s&&(s=Object.getPrototypeOf(s));)s.constructor&&t.push(s.constructor);return t}phetCore.register("inheritance",inheritance);const assertHasProperties=(a,t)=>{assert&&a&&t.forEach(s=>{assert&&assert(Object.getOwnPropertyDescriptor(a,s)||_.some(inheritance(a.constructor).map(r=>Object.getOwnPropertyDescriptor(r.prototype,s))),`property not defined: ${s}`)})};phetCore.register("assertHasProperties",assertHasProperties);const assertMutuallyExclusiveOptions=function(a,...t){if(assert&&a){const s=t.map(r=>Object.keys(_.pick(a,...r)));s.filter(r=>r.length>0).length>1&&assert&&assert(!1,`Cannot simultaneously specify ${s.join(" and ")}`)}};phetCore.register("assertMutuallyExclusiveOptions",assertMutuallyExclusiveOptions);class AsyncLoader{constructor(){this.pendingLocks=[],this.loadComplete=!1,this.listeners=[]}reset(){this.loadComplete=!1}addListener(t){this.listeners.push(t)}proceedIfReady(){this.pendingLocks.length===0&&(assert&&assert(!this.loadComplete,"cannot complete load twice"),this.loadComplete=!0,this.listeners.forEach(t=>t()))}createLock(t){return assert&&assert(!this.loadComplete,"Cannot create more locks after load-step has completed"),this.pendingLocks.push(t),()=>{assert&&assert(this.pendingLocks.includes(t),"invalid lock"),arrayRemove(this.pendingLocks,t),this.proceedIfReady()}}}const asyncLoader=new AsyncLoader;phetCore.register("asyncLoader",asyncLoader);function cleanArray(a){if(assert&&assert(!a||Array.isArray(a),"cleanArray either takes an Array"),a){for(;a.length;)a.pop();return a}else return[]}phetCore.register("cleanArray",cleanArray);function collect(a){const t=[];return a(s=>{t.push(s)}),t}phetCore.register("collect",collect);function copyWithSortedKeys(a){if(Array.isArray(a))return a.map(copyWithSortedKeys);if(typeof a!="object"||a===null)return a;const t={};return Object.keys(a).sort().forEach(s=>{const r=a[s];t[s]=copyWithSortedKeys(r)}),t}phetCore.register("copyWithSortedKeys",copyWithSortedKeys);const deprecatedMessages={},deprecationWarning=(a,t=window.phet&&window.phet.chipper&&window.phet.chipper.queryParameters&&phet.chipper.queryParameters.deprecationWarnings)=>{t&&!deprecatedMessages.hasOwnProperty(a)&&(deprecatedMessages[a]=!0,console.warn(`Deprecation warning: ${a}`))};phetCore.register("deprecationWarning",deprecationWarning);function detectPrefix(a,t){if(a[t]!==void 0)return t;if(t=t.charAt(0).toUpperCase()+t.slice(1),a[`moz${t}`]!==void 0)return`moz${t}`;if(a[`Moz${t}`]!==void 0)return`Moz${t}`;if(a[`webkit${t}`]!==void 0)return`webkit${t}`;if(a[`ms${t}`]!==void 0)return`ms${t}`;if(a[`o${t}`]!==void 0)return`o${t}`}phetCore.register("detectPrefix",detectPrefix);function detectPrefixEvent(a,t){if(a[`on${t}`]!==void 0)return t;if(a[`onmoz${t}`]!==void 0)return`moz${t}`;if(a[`onMoz${t}`]!==void 0)return`Moz${t}`;if(a[`onwebkit${t}`]!==void 0)return`webkit${t}`;if(a[`onms${t}`]!==void 0)return`ms${t}`;if(a[`ono${t}`]!==void 0)return`o${t}`}phetCore.register("detectPrefixEvent",detectPrefixEvent);function dimensionForEach(a,t,s){const r=[];function o(n,l){return l.forEach((h,g)=>{r.push(g),n===1?s(h,...r):o(n-1,h),r.pop()})}return o(a,t)}phetCore.register("dimensionForEach",dimensionForEach);function dimensionMap(a,t,s){const r=[];function o(n,l){return l.map((h,g)=>{r.push(g);const d=n===1?s(h,...r):o(n-1,h);return r.pop(),d})}return o(a,t)}phetCore.register("dimensionMap",dimensionMap);const kh=class kh{toString(){return this.name}isEnumerationValue(){return!0}constructor(){const t=this.constructor;assert&&assert(!kh.sealedCache.has(t),"cannot create instanceof of a sealed constructor"),this._name=null,this._enumeration=null}set name(t){assert&&assert(!this._name,"name cannot be changed once defined."),this._name=t}get name(){return assert&&assert(this._name,"name cannot be retrieved until it has been filled in by Enumeration."),this._name}set enumeration(t){assert&&assert(!this._enumeration,"enumeration cannot be changed once defined."),this._enumeration=t}get enumeration(){return assert&&assert(this._enumeration,"enumeration cannot be retrieved until it has been filled in by Enumeration."),this._enumeration}};kh.sealedCache=new Set;let EnumerationValue=kh;phetCore.register("EnumerationValue",EnumerationValue);const OPTIONS_SUFFIX="Options";function merge(a,...t){return assert&&assertIsMergeable(a),assert&&assert(a!==null,"target should not be null"),assert&&assert(t.length>0,"at least one source expected"),_.each(t,s=>{if(s){assert&&assertIsMergeable(s);for(const r in s)if(s.hasOwnProperty(r)&&s[r]!==void 0){const o=s[r];_.endsWith(r,OPTIONS_SUFFIX)&&r!==OPTIONS_SUFFIX?(assert&&assert(o!==void 0,"nested *Options should not be undefined"),a[r]=merge(a[r]||{},o)):a[r]=o}}}),a}function assertIsMergeable(a){assert&&assert(a===null||a&&typeof a=="object"&&Object.getPrototypeOf(a)===Object.prototype,"object is not compatible with merge"),a!==null&&Object.keys(a).forEach(t=>{const s=Object.getOwnPropertyDescriptor(a,t);assert&&assert(!s.hasOwnProperty("set"),"cannot use merge with an object that has a setter"),assert&&assert(!s.hasOwnProperty("get"),"cannot use merge with an object that has a getter")})}phetCore.register("merge",merge);const merge4=(a,t,s,r)=>merge(a,t,s,r);function optionize(){return merge4}function optionize3(){return merge4}function combineOptions(a,...t){return merge4(a,...t)}phetCore.register("optionize",optionize);class Enumeration{constructor(t,s){const r=optionize()({phetioDocumentation:"",instanceType:t},s);this.phetioDocumentation=r.phetioDocumentation;const o=r.instanceType,n=_.reverse(inheritance(t));assert&&assert(n.includes(o),"the specified type should be in its own hierarchy"),this.keys=[],this.values=[],n.forEach(l=>{Object.keys(l).forEach(h=>{const g=l[h];g instanceof o&&(assert&&assert(h===h.toUpperCase(),"keys should be upper case by convention"),this.keys.push(h),this.values.push(g),g instanceof t&&(g.name=h,g.enumeration=this))})}),assert&&assert(this.keys.length>0,"no keys found"),assert&&assert(this.values.length>0,"no values found"),this.Enumeration=t,EnumerationValue.sealedCache.add(t)}getKey(t){return t.name}getValue(t){return this.Enumeration[t]}includes(t){return this.values.includes(t)}}phetCore.register("Enumeration",Enumeration);class EnumerationDeprecated{constructor(t){deprecationWarning("EnumerationDeprecated should be exchanged for classes that extend EnumerationValue, see WilderEnumerationPatterns for examples."),assert&&assert(t,"config must be provided");const s=!!t.keys,r=!!t.map;assert&&assert(s!==r,"must provide one or the other but not both of keys/map");const o=t.keys||Object.keys(t.map),n=t.map||{};t=merge({phetioDocumentation:null,beforeFreeze:null},t),assert&&assert(Array.isArray(o),"Values should be an array"),assert&&assert(_.uniq(o).length===o.length,"There should be no duplicated values provided"),assert&&o.forEach(l=>assert(typeof l=="string","Each value should be a string")),assert&&o.forEach(l=>assert(/^[A-Z][A-Z0-9_]*$/g.test(l),"EnumerationDeprecated values should be uppercase alphanumeric with underscores and begin with a letter")),assert&&assert(!_.includes(o,"VALUES"),"This is the name of a built-in provided value, so it cannot be included as an enumeration value"),assert&&assert(!_.includes(o,"KEYS"),"This is the name of a built-in provided value, so it cannot be included as an enumeration value"),assert&&assert(!_.includes(o,"includes"),"This is the name of a built-in provided value, so it cannot be included as an enumeration value"),this.phetioDocumentation=t.phetioDocumentation,this.KEYS=o,this.VALUES=[],o.forEach(l=>{const h=n[l]||{};assert&&assert(h.name===void 0,'"rich" enumeration values cannot provide their own name attribute'),assert&&assert(h.toString===Object.prototype.toString,'"rich" enumeration values cannot provide their own toString'),h.name=l,h.toString=()=>l,this[l]=h,this.VALUES.push(h)}),t.beforeFreeze&&t.beforeFreeze(this),assert&&Object.freeze(this),assert&&Object.freeze(this.VALUES),assert&&Object.freeze(this.KEYS),assert&&o.forEach(l=>assert&&Object.freeze(n[l]))}toString(){return this.KEYS.join(", ")}includes(t){return _.includes(this.VALUES,t)}getValue(t){return this[t]}getKey(t){return t.name}get values(){return this.VALUES}get keys(){return this.KEYS}get enumeration(){return this}static byKeys(t,s){return assert&&assert(Array.isArray(t),"keys must be an array"),assert&&assert(!s||s.keys===void 0),new EnumerationDeprecated(merge({keys:t},s))}static byMap(t,s){if(assert&&assert(!s||s.map===void 0),assert){const r=_.values(t);assert&&assert(r.length>=1,"must have at least 2 entries in an enumeration"),assert&&assert(_.every(r,o=>o.constructor===r[0].constructor),"Values must have same constructor")}return new EnumerationDeprecated(merge({map:t},s))}}phetCore.register("EnumerationDeprecated",EnumerationDeprecated);class EnumerationMap{constructor(t,s){this._map=new Map,this._enumeration=t,this._values=t.enumeration.values,this._values.forEach(r=>{assert&&assert(!this._map.has(r),"Enumeration key override problem"),this._map.set(r,s(r))})}get(t){return assert&&assert(this._values.includes(t)),assert&&assert(this._map.has(t)),this._map.get(t)}set(t,s){assert&&assert(this._values.includes(t)),this._map.set(t,s)}map(t){return new EnumerationMap(this._enumeration,s=>t(this.get(s),s))}forEach(t){this._values.forEach(s=>t(this.get(s),s))}values(){return this._values.map(t=>this.get(t))}}phetCore.register("EnumerationMap",EnumerationMap);function escapeHTML(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")}phetCore.register("escapeHTML",escapeHTML);const xl=class xl{constructor(t,s){this.eventModel=t,this.eventCallback=s,this.period=this.eventModel.getPeriodBeforeNextEvent(),this.timeBeforeNextEvent=this.period}step(t){for(;t>=this.timeBeforeNextEvent;)t-=this.timeBeforeNextEvent,this.period=this.eventModel.getPeriodBeforeNextEvent(),this.timeBeforeNextEvent=this.period,this.eventCallback(t);this.timeBeforeNextEvent-=t}getRatio(){return(this.period-this.timeBeforeNextEvent)/this.period}};xl.ConstantEventModel=class{constructor(s){this.rate=s,assert&&assert(s>0,"We need to have a strictly positive rate in order to prevent infinite loops.")}getPeriodBeforeNextEvent(){return 1/this.rate}},xl.UniformEventModel=class{constructor(s,r){this.rate=s,this.pseudoRandomNumberSource=r,assert&&assert(s>0,"We need to have a strictly positive rate in order to prevent infinite loops.")}getPeriodBeforeNextEvent(){const s=this.pseudoRandomNumberSource();return assert&&assert(s>=0&&s<1,`Our uniform random number is outside of its expected range with a value of ${s}`),s*2/this.rate}},xl.PoissonEventModel=class{constructor(s,r){this.rate=s,this.pseudoRandomNumberSource=r,assert&&assert(s>0,"We need to have a strictly positive poisson rate in order to prevent infinite loops.")}getPeriodBeforeNextEvent(){const s=this.pseudoRandomNumberSource();return assert&&assert(s>=0&&s<1,`Our uniform random number is outside of its expected range with a value of ${s}`),-Math.log(s)/this.rate}};let EventTimer=xl;phetCore.register("EventTimer",EventTimer);function extend(a,...t){return _.each(t,s=>{if(s)for(const r in s)Object.defineProperty(a,r,Object.getOwnPropertyDescriptor(s,r))}),a}phetCore.register("extend",extend);function extendDefined(a,...t){return _.each(t,s=>{if(s)for(const r in s){const o=Object.getOwnPropertyDescriptor(s,r);o&&(typeof o.get=="function"||s[r]!==void 0)&&Object.defineProperty(a,r,o)}}),a}phetCore.register("extendDefined",extendDefined);const getGlobal=a=>{assert&&assert(a.trim()===a,"path must be trimmed");const t=_.get(window,a);return t!==void 0?t:null};phetCore.register("getGlobal",getGlobal);const gracefulBind=a=>{assert&&assert(a.split(".").length>1,"path must have multiple parts"),assert&&assert(a.trim()===a,"path must be trimmed");const t=a.split("."),s=t.pop(),r=_.get(window,t);return r?r[s].bind(r):null};phetCore.register("gracefulBind",gracefulBind);function identity$1(a){return a}phetCore.register("identity",identity$1);function interleave(a,t){assert&&assert(Array.isArray(a));const s=[],r=a.length*2-1;for(let o=0;o<r;o++)o%2===0?s.push(a[o/2]):s.push(t((o-1)/2));return s}phetCore.register("interleave",interleave);function isArray(a){return Object.prototype.toString.call(a)==="[object Array]"}phetCore.register("isArray",isArray);function loadScript(a){const t=typeof a=="string"?{src:a}:a,s=t.src,r=t.callback,o=t.async===void 0?!0:t.async,n=t.cacheBust===void 0?!1:t.cacheBust;let l=!1;const h=document.createElement("script");h.type="text/javascript",h.async=o,h.onload=h.onreadystatechange=function(){const d=this.readyState;d&&d!=="complete"&&d!=="loaded"||l||(l=!0,r&&r())},h.src=s+(n?`?random=${Math.random().toFixed(10)}`:"");const g=document.getElementsByTagName("script")[0];g.parentNode.insertBefore(h,g)}phetCore.register("loadScript",loadScript);function logGlobal(a){phet.log&&phet.log(`${a}: ${JSON.stringify(getGlobal(a),null,2)}`)}phetCore.register("logGlobal",logGlobal);function memoize(a){const t=new Map;return s=>{if(t.has(s))return t.get(s);{const r=a(s);return t.set(s,r),r}}}phetCore.register("memoize",memoize);class MipmapElement{constructor(t,s,r){this.width=t,this.height=s,this.url=r,this.img=new Image;const o=asyncLoader.createLock(this.img);this.img.onload=o,this.img.src=this.url,this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height;const n=this.canvas.getContext("2d");this.updateCanvas=()=>{this.img.complete&&(typeof this.img.naturalWidth>"u"||this.img.naturalWidth>0)&&(n.drawImage(this.img,0,0),delete this.updateCanvas)}}}phetCore.register("MipmapElement",MipmapElement);function mutate(a,t,s){assert&&assert(a),assert&&assert(Array.isArray(t)),s&&(assert&&assert(Object.getPrototypeOf(s)===Object.prototype,"Extra prototype on options object is a code smell"),_.each(t,r=>{assert&&assert(!s.hasOwnProperty(r)||s[r]!==void 0,`Undefined not allowed for key: ${r}`),s[r]!==void 0&&(a[r]=s[r])}))}phetCore.register("mutate",mutate);const ho=class ho extends EnumerationValue{static fromLayoutOrientation(t){return t==="horizontal"?ho.HORIZONTAL:ho.VERTICAL}constructor(t,s,r,o,n,l,h,g,d,A,S,O,I,W,L,H,Y,Q,pe){super(),this.coordinate=t,this.centerCoordinate=s,this.minCoordinate=r,this.maxCoordinate=o,this.minSide=n,this.maxSide=l,this.minSize=h,this.maxSize=g,this.rectCoordinate=d,this.rectSize=A,this.flowBoxOrientation=S,this.size=O,this.line=I,this.preferredSize=W,this.localPreferredSize=L,this.sizable=H,this.ariaOrientation=S,this.modelToView=Y,this.viewToModel=Q,this.toVector=pe}};ho.HORIZONTAL=new ho("x","centerX","minX","maxX","left","right","minWidth","maxWidth","rectX","rectWidth","horizontal","width","column","preferredWidth","localPreferredWidth","widthSizable",(t,s)=>t.modelToViewX(s),(t,s)=>t.viewToModelX(s),(t,s,r)=>new r(t,s,0,0)),ho.VERTICAL=new ho("y","centerY","minY","maxY","top","bottom","minHeight","maxHeight","rectY","rectHeight","vertical","height","row","preferredHeight","localPreferredHeight","heightSizable",(t,s)=>t.modelToViewY(s),(t,s)=>t.viewToModelY(s),(t,s,r)=>new r(s,t,0,0)),ho.enumeration=new Enumeration(ho,{phetioDocumentation:"Horizontal or vertical orientation"});let Orientation=ho;Orientation.HORIZONTAL.opposite=Orientation.VERTICAL;Orientation.VERTICAL.opposite=Orientation.HORIZONTAL;phetCore.register("Orientation",Orientation);class OrientationPair extends EnumerationMap{constructor(t,s){super(Orientation,r=>r===Orientation.HORIZONTAL?t:s)}get horizontal(){return this.get(Orientation.HORIZONTAL)}set horizontal(t){this.set(Orientation.HORIZONTAL,t)}get vertical(){return this.get(Orientation.VERTICAL)}set vertical(t){this.set(Orientation.VERTICAL,t)}with(t,s){return new OrientationPair(t===Orientation.HORIZONTAL?s:this.horizontal,t===Orientation.VERTICAL?s:this.vertical)}static create(t){return new OrientationPair(t(Orientation.HORIZONTAL),t(Orientation.VERTICAL))}map(t){return new OrientationPair(t(this.horizontal,Orientation.HORIZONTAL),t(this.vertical,Orientation.VERTICAL))}}phetCore.register("OrientationPair",OrientationPair);function pairs(a){const t=[],s=a.length;if(s>1)for(let r=0;r<s-1;r++){const o=a[r];for(let n=r+1;n<s;n++)t.push([o,a[n]])}return t}phetCore.register("pairs",pairs);function partition(a,t){assert&&assert(Array.isArray(a));const s=[],r=[],o=a.length;for(let n=0;n<o;n++)t(a[n])?s.push(a[n]):r.push(a[n]);return[s,r]}phetCore.register("partition",partition);const PhysicalConstants={GRAVITATIONAL_CONSTANT:66743e-15,GRAVITY_ON_EARTH:9.81};phetCore.register("PhysicalConstants",PhysicalConstants);const ua=navigator.userAgent;function isIE(a){return getInternetExplorerVersion()===a}function isMobileSafari(){return!!(window.phet&&phet.chipper&&phet.chipper.queryParameters&&phet.chipper.queryParameters["phet-app"]||(ua.match(/(iPod|iPhone|iPad)/)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>=2)&&ua.match(/AppleWebKit/))}function getInternetExplorerVersion(){let a=-1,t=null;return navigator.appName==="Microsoft Internet Explorer"?(t=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"),t.exec(ua)!==null&&(a=parseFloat(RegExp.$1))):navigator.appName==="Netscape"&&(t=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),t.exec(ua)!==null&&(a=parseFloat(RegExp.$1))),a}const platform={firefox:ua.toLowerCase().includes("firefox"),mobileSafari:isMobileSafari(),safari5:!!(ua.match(/Version\/5\./)&&ua.match(/Safari\//)&&ua.match(/AppleWebKit/)),safari6:!!(ua.match(/Version\/6\./)&&ua.match(/Safari\//)&&ua.match(/AppleWebKit/)),safari7:!!(ua.match(/Version\/7\./)&&ua.match(/Safari\//)&&ua.match(/AppleWebKit/)),safari10:!!(ua.match(/Version\/10\./)&&ua.match(/Safari\//)&&ua.match(/AppleWebKit/)),safari11:!!(ua.match(/Version\/11\./)&&ua.match(/Safari\//)&&ua.match(/AppleWebKit/)),safari9:!!(ua.match(/Version\/9\./)&&ua.match(/Safari\//)&&ua.match(/AppleWebKit/)),safari:isMobileSafari()||!!(ua.match(/Version\//)&&ua.match(/Safari\//)&&ua.match(/AppleWebKit/)),ie:getInternetExplorerVersion()!==-1,ie9:isIE(9),ie10:isIE(10),ie11:isIE(11),android:ua.indexOf("Android")>0,edge:!!ua.match(/Edge\//),chromium:/chrom(e|ium)/.test(ua.toLowerCase())&&!ua.match(/Edge\//),chromeOS:ua.indexOf("CrOS")>0,mac:navigator.platform.includes("Mac")};phetCore.register("platform",platform);class Pool{constructor(t,...s){this.objects=[];const r=optionize()({defaultArguments:[],initialize:t.prototype.initialize,maxSize:100,initialSize:0,useDefaultConstruction:!1},s[0]);for(assert&&assert(r.maxSize>=0),assert&&assert(r.initialSize>=0),this._maxPoolSize=r.maxSize,this.partialConstructor=Function.prototype.bind.bind(t,t),this.DefaultConstructor=this.partialConstructor(...r.defaultArguments),this.initialize=r.initialize,assert&&assert(this.initialize,"Either pass in an initialize option, or provide a method named initialize on the type with the proper signature"),this.useDefaultConstruction=r.useDefaultConstruction;this.objects.length<r.initialSize;)this.objects.push(this.createDefaultObject())}createDefaultObject(){return new this.DefaultConstructor}fetch(){return this.objects.length?this.objects.pop():this.createDefaultObject()}create(...t){let s;return this.objects.length?(s=this.objects.pop(),this.initialize.apply(s,t)):this.useDefaultConstruction?(s=this.createDefaultObject(),this.initialize.apply(s,t)):s=new(this.partialConstructor(...t)),s}get poolSize(){return this.objects.length}set maxPoolSize(t){assert&&assert(t===Number.POSITIVE_INFINITY||Number.isInteger(t)&&t>=0,"maxPoolSize should be a non-negative integer or infinity"),this._maxPoolSize=t}get maxPoolSize(){return this._maxPoolSize}freeToPool(t){this.objects.length<this.maxPoolSize&&this.objects.push(t)}forEach(t){this.objects.forEach(t)}}phetCore.register("Pool",Pool);const Poolable={mixInto(a,t){const s=optionize()({defaultArguments:[],initialize:a.prototype.initialize,maxSize:100,initialSize:0,useDefaultConstruction:!1},t);assert&&assert(s.maxSize>=0),assert&&assert(s.initialSize>=0);const r=[];let o=s.maxSize;const n=Function.prototype.bind.bind(a,a),l=n(...s.defaultArguments),h=s.initialize,g=s.useDefaultConstruction,d=a.prototype;for(extend(a,{pool:r,dirtyFromPool(){return r.length?r.pop():new l},createFromPool(...A){let S;return r.length?(S=r.pop(),h.apply(S,A)):g?(S=new l,h.apply(S,A)):S=new(n(...A)),S},get poolSize(){return r.length},set maxPoolSize(A){assert&&assert(A===Number.POSITIVE_INFINITY||Number.isInteger(A)&&A>=0,"maxPoolSize should be a non-negative integer or infinity"),o=A},get maxPoolSize(){return o}}),extend(d,{freeToPool(){r.length<o&&r.push(this)}});r.length<s.initialSize;)r.push(new l);return a}};phetCore.register("Poolable",Poolable);function required(a){return assert&&assert(a!==void 0,"Required field is undefined."),a}phetCore.register("required",required);function stripEmbeddingMarks(a){return a.replace(/\u202a|\u202b|\u202c/g,"")}phetCore.register("stripEmbeddingMarks",stripEmbeddingMarks);const placeholderObject={};function swapObjectKeys(a,t,s){const r=placeholderObject;let o=r,n=r;return a.hasOwnProperty(t)&&(o=a[t]),a.hasOwnProperty(s)&&(n=a[s]),o!==placeholderObject?a[s]=o:delete a[s],n!==placeholderObject?a[t]=n:delete a[t],a}phetCore.register("swapObjectKeys",swapObjectKeys);const axon=new Namespace("axon"),TYPEOF_STRINGS=["string","number","boolean","function"],VALIDATOR_KEYS=["valueType","validValues","valueComparisonStrategy","isValidValue","phetioType","validators"],In=class In{static getValidatorValidationError(t){if(!(t instanceof Object))return"validator must be an Object";if(!(t.hasOwnProperty("isValidValue")||t.hasOwnProperty("valueType")||t.hasOwnProperty("validValues")||t.hasOwnProperty("valueComparisonStrategy")||t.hasOwnProperty("phetioType")||t.hasOwnProperty("validators")))return this.combineErrorMessages(`validator must have at least one of: ${VALIDATOR_KEYS.join(",")}`,t.validationMessage);if(t.hasOwnProperty("valueType")){const s=In.getValueOrElementTypeValidationError(t.valueType);if(s)return this.combineErrorMessages(`Invalid valueType: ${t.valueType}, error: ${s}`,t.validationMessage)}if(t.hasOwnProperty("isValidValue")&&!(typeof t.isValidValue=="function"||t.isValidValue===null||t.isValidValue===void 0))return this.combineErrorMessages(`isValidValue must be a function: ${t.isValidValue}`,t.validationMessage);if(t.hasOwnProperty("valueComparisonStrategy")&&!(t.valueComparisonStrategy==="reference"||t.valueComparisonStrategy==="lodashDeep"||t.valueComparisonStrategy==="equalsFunction"||typeof t.isValidValue=="function"))return this.combineErrorMessages(`valueComparisonStrategy must be "reference", "lodashDeep", 
        "equalsFunction", or a comparison function: ${t.valueComparisonStrategy}`,t.validationMessage);if(t.validValues!==void 0&&t.validValues!==null){if(!Array.isArray(t.validValues))return this.combineErrorMessages(`validValues must be an array: ${t.validValues}`,t.validationMessage);const s=_.omit(t,"validValues");if(In.containsValidatorKey(s))for(let r=0;r<t.validValues.length;r++){const o=t.validValues[r],n=In.getValidationError(o,s);if(n)return this.combineErrorMessages(`Item not valid in validValues: ${o}, error: ${n}`,t.validationMessage)}}if(t.hasOwnProperty("phetioType")){if(!t.phetioType)return this.combineErrorMessages("falsey phetioType provided",t.validationMessage);if(!t.phetioType.validator)return this.combineErrorMessages(`validator needed for phetioType: ${t.phetioType.typeName}`,t.validationMessage);const s=In.getValidatorValidationError(t.phetioType.validator);if(s)return this.combineErrorMessages(s,t.validationMessage)}if(t.hasOwnProperty("validators")){const s=t.validators;for(let r=0;r<s.length;r++){const o=s[r],n=In.getValidatorValidationError(o);if(n)return this.combineErrorMessages(`validators[${r}] invalid: ${n}`,t.validationMessage)}}return null}static getValueTypeValidatorValidationError(t){return typeof t=="function"||typeof t=="string"||t instanceof EnumerationDeprecated||t===null||t===void 0?typeof t=="string"&&!_.includes(TYPEOF_STRINGS,t)?`valueType not a supported primitive types: ${t}`:null:`valueType must be {function|string|EnumerationDeprecated|null|undefined}, valueType=${t}`}static validateValidator(t){if(assert){const s=In.getValidatorValidationError(t);s&&assert(!1,s)}}static containsValidatorKey(t){if(!(t instanceof Object))return!1;for(let s=0;s<VALIDATOR_KEYS.length;s++)if(t.hasOwnProperty(VALIDATOR_KEYS[s]))return!0;return!1}static combineErrorMessages(t,s){return s&&(t=`${typeof s=="function"?s():s}: ${t}`),t}static isValueValid(t,s,r){return this.getValidationError(t,s,r)===null}static getValidationError(t,s,r){const o=optionize()({validateValidator:!0},r);if(o.validateValidator){const n=In.getValidatorValidationError(s);if(n)return n}if(s.hasOwnProperty("valueType")){const n=s.valueType;if(Array.isArray(n)){if(!_.some(n.map(l=>!In.getValueTypeValidationError(t,l,s.validationMessage))))return this.combineErrorMessages(`value not valid for any valueType in ${n.toString().substring(0,100)}, value: ${t}`,s.validationMessage)}else if(n){const l=In.getValueTypeValidationError(t,n,s.validationMessage);if(l)return l}}if(s.validValues){const n=s.valueComparisonStrategy||"reference";if(!s.validValues.some(h=>{if(n==="reference")return h===t;if(n==="equalsFunction"){const g=h;return assert&&assert(!!g.equals,"no equals function for 1st arg"),assert&&assert(!!t.equals,"no equals function for 2nd arg"),assert&&assert(g.equals(t)===t.equals(g),"incompatible equality checks"),g.equals(t)}return n==="lodashDeep"?_.isEqual(h,t):n(h,t)}))return this.combineErrorMessages(`value not in validValues: ${t}`,s.validationMessage)}if(s.hasOwnProperty("isValidValue")&&!s.isValidValue(t))return this.combineErrorMessages(`value failed isValidValue: ${t}`,s.validationMessage);if(s.hasOwnProperty("phetioType")){const n=In.getValidationError(t,s.phetioType.validator,o);if(n)return this.combineErrorMessages(`value failed phetioType validator: ${t}, error: ${n}`,s.validationMessage)}if(s.hasOwnProperty("validators")){const n=s.validators;for(let l=0;l<n.length;l++){const h=n[l],g=In.getValidationError(t,h,o);if(g)return this.combineErrorMessages(`Failed validation for validators[${l}]: ${g}`,s.validationMessage)}}return null}static getValueTypeValidationError(t,s,r){return typeof s=="string"&&typeof t!==s?this.combineErrorMessages(`value should have typeof ${s}, value=${t}`,r):s===Array&&!Array.isArray(t)?this.combineErrorMessages(`value should have been an array, value=${t}`,r):s instanceof EnumerationDeprecated&&!s.includes(t)?this.combineErrorMessages(`value is not a member of EnumerationDeprecated ${s}`,r):typeof s=="function"&&!(t instanceof s)?this.combineErrorMessages(`value should be instanceof ${s.name}, value=${t}`,r):s===null&&t!==null?this.combineErrorMessages(`value should be null, value=${t}`,r):null}static getValueOrElementTypeValidationError(t){if(Array.isArray(t))for(let s=0;s<t.length;s++){const r=t[s],o=In.getValueTypeValidatorValidationError(r);if(o)return`Array value invalid: ${o}`}else if(t){const s=In.getValueTypeValidatorValidationError(t);if(s)return`Value type invalid: ${s}`}return null}};In.VALIDATOR_KEYS=VALIDATOR_KEYS,In.STRING_WITHOUT_TEMPLATE_VARS_VALIDATOR={valueType:"string",isValidValue:t=>!/\{\{\w*\}\}/.test(t)};let Validation=In;axon.register("Validation",Validation);const validate=(a,t,s)=>{if(assert){const r=Validation.getValidationError(a,t,s);if(r){const o=_.pick(t,Validation.VALIDATOR_KEYS);o.phetioType&&(o.phetioType=_.pick(t.phetioType,["validator","typeName"]));const n=JSON.stringify(o,null,2);assert&&assert(!1,"validation failed for value:",a,r,"prunedValidator:",n)}}};axon.register("validate",validate);const tandemNamespace=new Namespace("tandem"),PhetioConstants={IO_TYPE_SUFFIX:"IO"};tandemNamespace.register("PhetioConstants",PhetioConstants);const OBJECT_IO_TYPE_NAME="ObjectIO",EVENT_TYPE_MODEL="MODEL",metadataDefaults={phetioTypeName:OBJECT_IO_TYPE_NAME,phetioDocumentation:"",phetioState:!0,phetioReadOnly:!1,phetioEventType:EVENT_TYPE_MODEL,phetioHighFrequency:!1,phetioPlayback:!1,phetioDynamicElement:!1,phetioIsArchetype:!1,phetioFeatured:!1,phetioDesigned:!1,phetioArchetypePhetioID:null},BASE_TANDEM_CHARACTER_CLASS="a-zA-Z0-9[\\],",BASE_DYNAMIC_TANDEM_CHARACTER_CLASS=`${BASE_TANDEM_CHARACTER_CLASS}_`,BASE_DERIVED_TANDEM_CHARACTER_CLASS=`${BASE_DYNAMIC_TANDEM_CHARACTER_CLASS}\\-`,TandemConstants={OBJECT_IO_TYPE_NAME,EVENT_TYPE_MODEL,PHET_IO_OBJECT_METADATA_DEFAULTS:metadataDefaults,METADATA_KEY_NAME:"_metadata",DATA_KEY_NAME:"_data",BASE_TANDEM_CHARACTER_CLASS,BASE_DYNAMIC_TANDEM_CHARACTER_CLASS,BASE_DERIVED_TANDEM_CHARACTER_CLASS};tandemNamespace.register("TandemConstants",TandemConstants);class StateSchema{constructor(t){assert&&assertMutuallyExclusiveOptions(t,["compositeSchema"],["displayString","validator"]);const s=optionize()({displayString:"",validator:null,compositeSchema:null},t);this.displayString=s.displayString,this.validator=s.validator,this.compositeSchema=s.compositeSchema}defaultApplyState(t,s){assert&&assert(this.isComposite(),"defaultApplyState from stateSchema only applies to composite stateSchemas");for(const r in this.compositeSchema)if(this.compositeSchema.hasOwnProperty(r)){assert&&assert(s.hasOwnProperty(r),`stateObject does not have expected schema key: ${r}`);const o=this.compositeSchema[r],n=this.getCoreObjectAccessorName(r,t);o.defaultDeserializationMethod==="fromStateObject"?t[n]=this.compositeSchema[r].fromStateObject(s[r]):(assert&&assert(o.defaultDeserializationMethod==="applyState","unexpected deserialization method"),this.compositeSchema[r].applyState(t[n],s[r]))}}defaultToStateObject(t){assert&&assert(this.isComposite(),"defaultToStateObject from stateSchema only applies to composite stateSchemas");const s={};for(const r in this.compositeSchema)if(this.compositeSchema.hasOwnProperty(r)){const o=this.getCoreObjectAccessorName(r,t);if(assert){const n=Object.getOwnPropertyDescriptor(t,o);let l=!1;if(t.constructor.prototype){const g=Object.getOwnPropertyDescriptor(t.constructor.prototype,o);l=!!g&&!!g.get}const h=!!n&&n.hasOwnProperty("value")&&n.writable;assert&&assert(h||l,`cannot get state because coreObject does not have expected schema key: ${o}`)}s[r]=this.compositeSchema[r].toStateObject(t[o])}return s}getCoreObjectAccessorName(t,s){assert&&assert(!t.startsWith("__"),"State keys should not start with too many underscores: "+t+". When serializing ",s);const r=t.startsWith("_")?t.substring(1):t,o=`_${r}`;let n;return s.hasOwnProperty(o)?n=o:n=r,n}isComposite(){return!!this.compositeSchema}checkStateObjectValid(t,s,r){if(this.isComposite()){const o=t,n=this.compositeSchema;let l=null;return o?(Object.keys(n).forEach(g=>{typeof g=="string"?(o.hasOwnProperty(g)?n[g].isStateObjectValid(o[g],!1)||(assert&&s&&assert(!1,`stateObject is not valid for ${g}. stateObject=`,o[g],"schema=",n[g]),l=!1):(assert&&s&&assert(!1,`${g} in state schema but not in the state object`),l=!1),r.push(g)):(console.error("key should be a string",g),assert&&assert(!1,"key should be a string"))}),l):(assert&&s&&assert(!1,"There was no stateObject, but there was a state schema saying there should be",n),l=!1,l)}else{assert&&assert(this.validator,"validator must be present if not composite");const o=t;if(assert&&s){const n=Validation.getValidationError(o,this.validator);assert(n===null,"valueStateObject failed validation",o,n)}return Validation.isValueValid(o,this.validator)}}getRelatedTypes(){const t=[];return this.compositeSchema&&Object.keys(this.compositeSchema).forEach(r=>{this.compositeSchema[r]instanceof IOType&&t.push(this.compositeSchema[r])}),t}getStateSchemaAPI(){return this.isComposite()?_.mapValues(this.compositeSchema,t=>t.typeName):this.displayString}static asValue(t,s){return assert&&assert(s,"validator required"),new StateSchema({validator:s,displayString:t})}}tandemNamespace.register("StateSchema",StateSchema);const VALIDATE_OPTIONS_FALSE$3={validateValidator:!1},getCoreTypeName=a=>{const t=a.indexOf(PhetioConstants.IO_TYPE_SUFFIX);return assert&&assert(t>=0,"IO should be in the type name"),a.substring(0,t)};class IOType{constructor(t,s){this.typeName=t;const r=s.supertype||IOType.ObjectIO,o=!!s.toStateObject,n=!!s.applyState,l=!!s.stateSchema,h=optionize()({supertype:IOType.ObjectIO,methods:{},events:[],metadataDefaults:{},dataDefaults:{},methodOrder:[],parameterTypes:[],documentation:`PhET-iO Type for ${getCoreTypeName(t)}`,isFunctionType:!1,toStateObject:r&&r.toStateObject,fromStateObject:r&&r.fromStateObject,stateObjectToCreateElementArguments:r&&r.stateObjectToCreateElementArguments,applyState:r&&r.applyState,stateSchema:null,defaultDeserializationMethod:"fromStateObject",addChildElement:r&&r.addChildElement},s);if(assert&&r&&Object.keys(h.metadataDefaults).forEach(g=>{assert&&r.getAllMetadataDefaults().hasOwnProperty(g)&&assert(r.getAllMetadataDefaults()[g]!==h.metadataDefaults[g],`${g} should not have the same default value as the ancestor metadata default.`)}),this.supertype=r,this.documentation=h.documentation,this.methods=h.methods,this.events=h.events,this.metadataDefaults=h.metadataDefaults,this.dataDefaults=h.dataDefaults,this.methodOrder=h.methodOrder,this.parameterTypes=h.parameterTypes,this.validator=_.pick(h,Validation.VALIDATOR_KEYS),this.validator.validationMessage=this.validator.validationMessage||`Validation failed IOType Validator: ${this.typeName}`,this.defaultDeserializationMethod=h.defaultDeserializationMethod,h.stateSchema===null||h.stateSchema instanceof StateSchema)this.stateSchema=h.stateSchema;else{const g=typeof h.stateSchema=="function"?h.stateSchema(this):h.stateSchema;this.stateSchema=new StateSchema({compositeSchema:g})}if(assert&&assert(!this.stateSchema||o||this.stateSchema.isComposite(),"toStateObject method must be provided for value StateSchemas"),this.toStateObject=g=>{validate(g,this.validator,VALIDATE_OPTIONS_FALSE$3);let d;return!o&&l&&this.stateSchema&&this.stateSchema.isComposite()?d=this.defaultToStateObject(g):d=h.toStateObject(g),(o||l)&&assert&&this.validateStateObject(d),d},this.fromStateObject=h.fromStateObject,this.stateObjectToCreateElementArguments=h.stateObjectToCreateElementArguments,this.applyState=(g,d)=>{validate(g,this.validator,VALIDATE_OPTIONS_FALSE$3),(n||l)&&assert&&g.phetioType&&g.phetioType.validateStateObject(d),!n&&l&&this.stateSchema&&this.stateSchema.isComposite()?this.defaultApplyState(g,d):h.applyState(g,d)},this.isFunctionType=h.isFunctionType,this.addChildElement=h.addChildElement,assert)if(assert&&assert(r||this.typeName==="ObjectIO","supertype is required"),assert&&assert(!this.typeName.includes("."),"Dots should not appear in type names"),assert&&assert(this.typeName.split(/[<(]/)[0].endsWith(PhetioConstants.IO_TYPE_SUFFIX),`IOType name must end with ${PhetioConstants.IO_TYPE_SUFFIX}`),assert&&assert(this.hasOwnProperty("typeName"),"this.typeName is required"),this.methods&&Object.values(this.methods).forEach(g=>{typeof g=="object"&&assert&&g.invocableForReadOnlyElements&&assert(typeof g.invocableForReadOnlyElements=="boolean",`invocableForReadOnlyElements must be of type boolean: ${g.invocableForReadOnlyElements}`)}),assert&&assert(this.documentation.length>0,"documentation must be provided"),this.methods&&this.hasOwnProperty("methodOrder")&&this.methodOrder.forEach(g=>{assert&&assert(this.methods[g],`methodName not in public methods: ${g}`)}),r){const g=r.getTypeHierarchy();assert&&this.events&&this.events.forEach(d=>{assert&&assert(!_.some(g,A=>A.events.includes(d)),`IOType should not declare event that parent also has: ${d}`)})}else assert&&assert(typeof h.toStateObject=="function","toStateObject must be defined"),assert&&assert(typeof h.fromStateObject=="function","fromStateObject must be defined"),assert&&assert(typeof h.stateObjectToCreateElementArguments=="function","stateObjectToCreateElementArguments must be defined"),assert&&assert(typeof h.applyState=="function","applyState must be defined")}defaultToStateObject(t){let s={};return this.supertype&&(s=this.supertype.defaultToStateObject(t)),this.stateSchema&&this.stateSchema.isComposite()?_.merge(s,this.stateSchema.defaultToStateObject(t)):s}defaultApplyState(t,s){this.supertype&&this.supertype.defaultApplyState(t,s),this.stateSchema&&this.stateSchema.isComposite()&&this.stateSchema.defaultApplyState(t,s)}getTypeHierarchy(){const t=[];let s=this;for(;s;)t.push(s),s=s.supertype;return t}extends(t){return this.getTypeHierarchy().includes(t)}getAllMetadataDefaults(){return _.merge({},this.supertype?this.supertype.getAllMetadataDefaults():{},this.metadataDefaults)}getAllDataDefaults(){return _.merge({},this.supertype?this.supertype.getAllDataDefaults():{},this.dataDefaults)}isStateObjectValid(t,s=!1,r=[]){let o=!0;if(this.stateSchema){const n=this.stateSchema.checkStateObjectValid(t,s,r);if(n!==null)return n}return this.supertype?o&&this.supertype.isStateObjectValid(t,s,r):!this.supertype&&t&&typeof t!="string"&&!Array.isArray(t)?(Object.keys(t).forEach(n=>{const l=r.includes(n);l||(o=!1),assert&&s&&assert(l,`stateObject provided a key that is not in the schema: ${n}`)}),o):!0}validateStateObject(t){this.isStateObjectValid(t,!0)}toString(){return this.typeName}}const DEFAULT_STATE=null;IOType.ObjectIO=new IOType(TandemConstants.OBJECT_IO_TYPE_NAME,{isValidValue:()=>!0,supertype:null,documentation:"The root of the PhET-iO Type hierarchy",toStateObject:a=>(phet&&phet.tandem&&phet.tandem.Tandem.VALIDATION&&(assert&&assert(a.tandem,"coreObject must be PhET-iO object"),assert&&assert(!a.phetioState,`fell back to root serialization state for ${a.tandem.phetioID}. Potential solutions:
         * mark the type as phetioState: false
         * create a custom toStateObject method in your IOType
         * perhaps you have everything right, but forgot to pass in the IOType via phetioType in the constructor`)),DEFAULT_STATE),fromStateObject:()=>{throw new Error("ObjectIO.fromStateObject should not be called")},stateObjectToCreateElementArguments:()=>[],applyState:_.noop,metadataDefaults:TandemConstants.PHET_IO_OBJECT_METADATA_DEFAULTS,dataDefaults:{initialState:DEFAULT_STATE},stateSchema:null});tandemNamespace.register("IOType",IOType);const InfiniteNumberIO=new IOType("InfiniteNumberIO",{valueType:"number",documentation:"PhET-iO Type for Javascript's number primitive type",toStateObject:a=>a===Number.POSITIVE_INFINITY?"POSITIVE_INFINITY":a===Number.NEGATIVE_INFINITY?"NEGATIVE_INFINITY":a,fromStateObject:a=>a==="POSITIVE_INFINITY"?Number.POSITIVE_INFINITY:a==="NEGATIVE_INFINITY"?Number.NEGATIVE_INFINITY:a,stateSchema:StateSchema.asValue("'POSITIVE_INFINITY'|'NEGATIVE_INFINITY'|number",{isValidValue:a=>a==="POSITIVE_INFINITY"||a==="NEGATIVE_INFINITY"||typeof a=="number"&&!isNaN(a)})});tandemNamespace.register("InfiniteNumberIO",InfiniteNumberIO);const NumberIO=new IOType("NumberIO",{valueType:"number",documentation:"PhET-iO Type for Javascript's number primitive type",toStateObject:_.identity,fromStateObject:a=>a,stateSchema:StateSchema.asValue("number",{isValidValue:a=>typeof a=="number"&&!isNaN(a)&&a!==Number.POSITIVE_INFINITY&&a!==Number.NEGATIVE_INFINITY})});tandemNamespace.register("NumberIO",NumberIO);const dot=new Namespace("dot");dot.register("FastArray",window.Float64Array?window.Float64Array:window.Array);var DP=20,RM=1,MAX_DP=1e6,MAX_POWER=1e6,NE=-7,PE=21,STRICT=!1,NAME$1="[big.js] ",INVALID=NAME$1+"Invalid ",INVALID_DP=INVALID+"decimal places",INVALID_RM=INVALID+"rounding mode",DIV_BY_ZERO=NAME$1+"Division by zero",P={},UNDEFINED=void 0,NUMERIC=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;function _Big_(){function a(t){var s=this;if(!(s instanceof a))return t===UNDEFINED?_Big_():new a(t);if(t instanceof a)s.s=t.s,s.e=t.e,s.c=t.c.slice();else{if(typeof t!="string"){if(a.strict===!0&&typeof t!="bigint")throw TypeError(INVALID+"value");t=t===0&&1/t<0?"-0":String(t)}parse$1(s,t)}s.constructor=a}return a.prototype=P,a.DP=DP,a.RM=RM,a.NE=NE,a.PE=PE,a.strict=STRICT,a.roundDown=0,a.roundHalfUp=1,a.roundHalfEven=2,a.roundUp=3,a}function parse$1(a,t){var s,r,o;if(!NUMERIC.test(t))throw Error(INVALID+"number");for(a.s=t.charAt(0)=="-"?(t=t.slice(1),-1):1,(s=t.indexOf("."))>-1&&(t=t.replace(".","")),(r=t.search(/e/i))>0?(s<0&&(s=r),s+=+t.slice(r+1),t=t.substring(0,r)):s<0&&(s=t.length),o=t.length,r=0;r<o&&t.charAt(r)=="0";)++r;if(r==o)a.c=[a.e=0];else{for(;o>0&&t.charAt(--o)=="0";);for(a.e=s-r-1,a.c=[],s=0;r<=o;)a.c[s++]=+t.charAt(r++)}return a}function round(a,t,s,r){var o=a.c;if(s===UNDEFINED&&(s=a.constructor.RM),s!==0&&s!==1&&s!==2&&s!==3)throw Error(INVALID_RM);if(t<1)r=s===3&&(r||!!o[0])||t===0&&(s===1&&o[0]>=5||s===2&&(o[0]>5||o[0]===5&&(r||o[1]!==UNDEFINED))),o.length=1,r?(a.e=a.e-t+1,o[0]=1):o[0]=a.e=0;else if(t<o.length){if(r=s===1&&o[t]>=5||s===2&&(o[t]>5||o[t]===5&&(r||o[t+1]!==UNDEFINED||o[t-1]&1))||s===3&&(r||!!o[0]),o.length=t,r){for(;++o[--t]>9;)if(o[t]=0,t===0){++a.e,o.unshift(1);break}}for(t=o.length;!o[--t];)o.pop()}return a}function stringify$1(a,t,s){var r=a.e,o=a.c.join(""),n=o.length;if(t)o=o.charAt(0)+(n>1?"."+o.slice(1):"")+(r<0?"e":"e+")+r;else if(r<0){for(;++r;)o="0"+o;o="0."+o}else if(r>0)if(++r>n)for(r-=n;r--;)o+="0";else r<n&&(o=o.slice(0,r)+"."+o.slice(r));else n>1&&(o=o.charAt(0)+"."+o.slice(1));return a.s<0&&s?"-"+o:o}P.abs=function(){var a=new this.constructor(this);return a.s=1,a};P.cmp=function(a){var t,s=this,r=s.c,o=(a=new s.constructor(a)).c,n=s.s,l=a.s,h=s.e,g=a.e;if(!r[0]||!o[0])return r[0]?n:o[0]?-l:0;if(n!=l)return n;if(t=n<0,h!=g)return h>g^t?1:-1;for(l=(h=r.length)<(g=o.length)?h:g,n=-1;++n<l;)if(r[n]!=o[n])return r[n]>o[n]^t?1:-1;return h==g?0:h>g^t?1:-1};P.div=function(a){var t=this,s=t.constructor,r=t.c,o=(a=new s(a)).c,n=t.s==a.s?1:-1,l=s.DP;if(l!==~~l||l<0||l>MAX_DP)throw Error(INVALID_DP);if(!o[0])throw Error(DIV_BY_ZERO);if(!r[0])return a.s=n,a.c=[a.e=0],a;var h,g,d,A,S,O=o.slice(),I=h=o.length,W=r.length,L=r.slice(0,h),H=L.length,Y=a,Q=Y.c=[],pe=0,de=l+(Y.e=t.e-a.e)+1;for(Y.s=n,n=de<0?0:de,O.unshift(0);H++<h;)L.push(0);do{for(d=0;d<10;d++){if(h!=(H=L.length))A=h>H?1:-1;else for(S=-1,A=0;++S<h;)if(o[S]!=L[S]){A=o[S]>L[S]?1:-1;break}if(A<0){for(g=H==h?o:O;H;){if(L[--H]<g[H]){for(S=H;S&&!L[--S];)L[S]=9;--L[S],L[H]+=10}L[H]-=g[H]}for(;!L[0];)L.shift()}else break}Q[pe++]=A?d:++d,L[0]&&A?L[H]=r[I]||0:L=[r[I]]}while((I++<W||L[0]!==UNDEFINED)&&n--);return!Q[0]&&pe!=1&&(Q.shift(),Y.e--,de--),pe>de&&round(Y,de,s.RM,L[0]!==UNDEFINED),Y};P.eq=function(a){return this.cmp(a)===0};P.gt=function(a){return this.cmp(a)>0};P.gte=function(a){return this.cmp(a)>-1};P.lt=function(a){return this.cmp(a)<0};P.lte=function(a){return this.cmp(a)<1};P.minus=P.sub=function(a){var t,s,r,o,n=this,l=n.constructor,h=n.s,g=(a=new l(a)).s;if(h!=g)return a.s=-g,n.plus(a);var d=n.c.slice(),A=n.e,S=a.c,O=a.e;if(!d[0]||!S[0])return S[0]?a.s=-g:d[0]?a=new l(n):a.s=1,a;if(h=A-O){for((o=h<0)?(h=-h,r=d):(O=A,r=S),r.reverse(),g=h;g--;)r.push(0);r.reverse()}else for(s=((o=d.length<S.length)?d:S).length,h=g=0;g<s;g++)if(d[g]!=S[g]){o=d[g]<S[g];break}if(o&&(r=d,d=S,S=r,a.s=-a.s),(g=(s=S.length)-(t=d.length))>0)for(;g--;)d[t++]=0;for(g=t;s>h;){if(d[--s]<S[s]){for(t=s;t&&!d[--t];)d[t]=9;--d[t],d[s]+=10}d[s]-=S[s]}for(;d[--g]===0;)d.pop();for(;d[0]===0;)d.shift(),--O;return d[0]||(a.s=1,d=[O=0]),a.c=d,a.e=O,a};P.mod=function(a){var t,s=this,r=s.constructor,o=s.s,n=(a=new r(a)).s;if(!a.c[0])throw Error(DIV_BY_ZERO);return s.s=a.s=1,t=a.cmp(s)==1,s.s=o,a.s=n,t?new r(s):(o=r.DP,n=r.RM,r.DP=r.RM=0,s=s.div(a),r.DP=o,r.RM=n,this.minus(s.times(a)))};P.neg=function(){var a=new this.constructor(this);return a.s=-a.s,a};P.plus=P.add=function(a){var t,s,r,o=this,n=o.constructor;if(a=new n(a),o.s!=a.s)return a.s=-a.s,o.minus(a);var l=o.e,h=o.c,g=a.e,d=a.c;if(!h[0]||!d[0])return d[0]||(h[0]?a=new n(o):a.s=o.s),a;if(h=h.slice(),t=l-g){for(t>0?(g=l,r=d):(t=-t,r=h),r.reverse();t--;)r.push(0);r.reverse()}for(h.length-d.length<0&&(r=d,d=h,h=r),t=d.length,s=0;t;h[t]%=10)s=(h[--t]=h[t]+d[t]+s)/10|0;for(s&&(h.unshift(s),++g),t=h.length;h[--t]===0;)h.pop();return a.c=h,a.e=g,a};P.pow=function(a){var t=this,s=new t.constructor("1"),r=s,o=a<0;if(a!==~~a||a<-MAX_POWER||a>MAX_POWER)throw Error(INVALID+"exponent");for(o&&(a=-a);a&1&&(r=r.times(t)),a>>=1,!!a;)t=t.times(t);return o?s.div(r):r};P.prec=function(a,t){if(a!==~~a||a<1||a>MAX_DP)throw Error(INVALID+"precision");return round(new this.constructor(this),a,t)};P.round=function(a,t){if(a===UNDEFINED)a=0;else if(a!==~~a||a<-MAX_DP||a>MAX_DP)throw Error(INVALID_DP);return round(new this.constructor(this),a+this.e+1,t)};P.sqrt=function(){var a,t,s,r=this,o=r.constructor,n=r.s,l=r.e,h=new o("0.5");if(!r.c[0])return new o(r);if(n<0)throw Error(NAME$1+"No square root");n=Math.sqrt(r+""),n===0||n===1/0?(t=r.c.join(""),t.length+l&1||(t+="0"),n=Math.sqrt(t),l=((l+1)/2|0)-(l<0||l&1),a=new o((n==1/0?"5e":(n=n.toExponential()).slice(0,n.indexOf("e")+1))+l)):a=new o(n+""),l=a.e+(o.DP+=4);do s=a,a=h.times(s.plus(r.div(s)));while(s.c.slice(0,l).join("")!==a.c.slice(0,l).join(""));return round(a,(o.DP-=4)+a.e+1,o.RM)};P.times=P.mul=function(a){var t,s=this,r=s.constructor,o=s.c,n=(a=new r(a)).c,l=o.length,h=n.length,g=s.e,d=a.e;if(a.s=s.s==a.s?1:-1,!o[0]||!n[0])return a.c=[a.e=0],a;for(a.e=g+d,l<h&&(t=o,o=n,n=t,d=l,l=h,h=d),t=new Array(d=l+h);d--;)t[d]=0;for(g=h;g--;){for(h=0,d=l+g;d>g;)h=t[d]+n[g]*o[d-g-1]+h,t[d--]=h%10,h=h/10|0;t[d]=h}for(h?++a.e:t.shift(),g=t.length;!t[--g];)t.pop();return a.c=t,a};P.toExponential=function(a,t){var s=this,r=s.c[0];if(a!==UNDEFINED){if(a!==~~a||a<0||a>MAX_DP)throw Error(INVALID_DP);for(s=round(new s.constructor(s),++a,t);s.c.length<a;)s.c.push(0)}return stringify$1(s,!0,!!r)};P.toFixed=function(a,t){var s=this,r=s.c[0];if(a!==UNDEFINED){if(a!==~~a||a<0||a>MAX_DP)throw Error(INVALID_DP);for(s=round(new s.constructor(s),a+s.e+1,t),a=a+s.e+1;s.c.length<a;)s.c.push(0)}return stringify$1(s,!1,!!r)};P[Symbol.for("nodejs.util.inspect.custom")]=P.toJSON=P.toString=function(){var a=this,t=a.constructor;return stringify$1(a,a.e<=t.NE||a.e>=t.PE,!!a.c[0])};P.toNumber=function(){var a=Number(stringify$1(this,!0,!0));if(this.constructor.strict===!0&&!this.eq(a.toString()))throw Error(NAME$1+"Imprecise conversion");return a};P.toPrecision=function(a,t){var s=this,r=s.constructor,o=s.c[0];if(a!==UNDEFINED){if(a!==~~a||a<1||a>MAX_DP)throw Error(INVALID+"precision");for(s=round(new r(s),a,t);s.c.length<a;)s.c.push(0)}return stringify$1(s,a<=s.e||s.e<=r.NE||s.e>=r.PE,!!o)};P.valueOf=function(){var a=this,t=a.constructor;if(t.strict===!0)throw Error(NAME$1+"valueOf disallowed");return stringify$1(a,a.e<=t.NE||a.e>=t.PE,!0)};var Big=_Big_();const ol=class ol{constructor(t,s,r,o){this.x=t,this.y=s,this.z=r,this.w=o}getMagnitude(){return Math.sqrt(this.magnitudeSquared)}get magnitude(){return this.getMagnitude()}getMagnitudeSquared(){return this.dot(this)}get magnitudeSquared(){return this.getMagnitudeSquared()}distance(t){return this.minus(t).magnitude}distanceXYZW(t,s,r,o){const n=this.x-t,l=this.y-s,h=this.z-r,g=this.w-o;return Math.sqrt(n*n+l*l+h*h+g*g)}distanceSquared(t){return this.minus(t).magnitudeSquared}distanceSquaredXYZW(t,s,r,o){const n=this.x-t,l=this.y-s,h=this.z-r,g=this.w-o;return n*n+l*l+h*h+g*g}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}dotXYZW(t,s,r,o){return this.x*t+this.y*s+this.z*r+this.w*o}angleBetween(t){return Math.acos(dot.clamp(this.normalized().dot(t.normalized()),-1,1))}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w}equalsEpsilon(t,s){return s||(s=0),Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)+Math.abs(this.w-t.w)<=s}isFinite(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.z)&&isFinite(this.w)}copy(t){return t?t.set(this):v4(this.x,this.y,this.z,this.w)}normalized(){const t=this.magnitude;return assert&&assert(t!==0,"Cannot normalize a zero-magnitude vector"),this.dividedScalar(t)}roundedSymmetric(){return this.copy().roundSymmetric()}withMagnitude(t){return this.copy().setMagnitude(t)}timesScalar(t){return v4(this.x*t,this.y*t,this.z*t,this.w*t)}times(t){return this.timesScalar(t)}componentTimes(t){return v4(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)}plus(t){return v4(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)}plusXYZW(t,s,r,o){return v4(this.x+t,this.y+s,this.z+r,this.w+o)}plusScalar(t){return v4(this.x+t,this.y+t,this.z+t,this.w+t)}minus(t){return v4(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)}minusXYZW(t,s,r,o){return v4(this.x-t,this.y-s,this.z-r,this.w-o)}minusScalar(t){return v4(this.x-t,this.y-t,this.z-t,this.w-t)}dividedScalar(t){return v4(this.x/t,this.y/t,this.z/t,this.w/t)}negated(){return v4(-this.x,-this.y,-this.z,-this.w)}blend(t,s){return this.plus(t.minus(this).times(s))}average(t){return this.blend(t,.5)}toString(){return`Vector4(${this.x}, ${this.y}, ${this.z}, ${this.w})`}toVector3(){return new Vector3(this.x,this.y,this.z)}setXYZW(t,s,r,o){return this.x=t,this.y=s,this.z=r,this.w=o,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}set(t){return this.setXYZW(t.x,t.y,t.z,t.w)}setMagnitude(t){const s=t/this.magnitude;return this.multiplyScalar(s)}add(t){return this.setXYZW(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)}addXYZW(t,s,r,o){return this.setXYZW(this.x+t,this.y+s,this.z+r,this.w+o)}addScalar(t){return this.setXYZW(this.x+t,this.y+t,this.z+t,this.w+t)}subtract(t){return this.setXYZW(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)}subtractXYZW(t,s,r,o){return this.setXYZW(this.x-t,this.y-s,this.z-r,this.w-o)}subtractScalar(t){return this.setXYZW(this.x-t,this.y-t,this.z-t,this.w-t)}multiplyScalar(t){return this.setXYZW(this.x*t,this.y*t,this.z*t,this.w*t)}multiply(t){return this.multiplyScalar(t)}componentMultiply(t){return this.setXYZW(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)}divideScalar(t){return this.setXYZW(this.x/t,this.y/t,this.z/t,this.w/t)}negate(){return this.setXYZW(-this.x,-this.y,-this.z,-this.w)}normalize(){const t=this.magnitude;if(t===0)throw new Error("Cannot normalize a zero-magnitude vector");return this.divideScalar(t)}roundSymmetric(){return this.setXYZW(DotUtils.roundSymmetric(this.x),DotUtils.roundSymmetric(this.y),DotUtils.roundSymmetric(this.z),DotUtils.roundSymmetric(this.w))}freeToPool(){ol.pool.freeToPool(this)}};ol.pool=new Pool(ol,{maxSize:1e3,initialize:ol.prototype.setXYZW,defaultArguments:[0,0,0,0]});let Vector4=ol;Vector4.prototype.isVector4=!0;Vector4.prototype.dimension=4;dot.register("Vector4",Vector4);const v4=Vector4.pool.create.bind(Vector4.pool);dot.register("v4",v4);class ImmutableVector4 extends Vector4{static mutableOverrideHelper(t){ImmutableVector4.prototype[t]=()=>{throw new Error(`Cannot call mutable method '${t}' on immutable Vector3`)}}}ImmutableVector4.mutableOverrideHelper("setXYZW");ImmutableVector4.mutableOverrideHelper("setX");ImmutableVector4.mutableOverrideHelper("setY");ImmutableVector4.mutableOverrideHelper("setZ");ImmutableVector4.mutableOverrideHelper("setW");Vector4.ZERO=assert?new ImmutableVector4(0,0,0,0):new Vector4(0,0,0,0);Vector4.X_UNIT=assert?new ImmutableVector4(1,0,0,0):new Vector4(1,0,0,0);Vector4.Y_UNIT=assert?new ImmutableVector4(0,1,0,0):new Vector4(0,1,0,0);Vector4.Z_UNIT=assert?new ImmutableVector4(0,0,1,0):new Vector4(0,0,1,0);Vector4.W_UNIT=assert?new ImmutableVector4(0,0,0,1):new Vector4(0,0,0,1);const ADDING_ACCUMULATOR$1=(a,t)=>a.add(t),Va=class Va{constructor(t,s,r){this.x=t,this.y=s,this.z=r}getMagnitude(){return Math.sqrt(this.magnitudeSquared)}get magnitude(){return this.getMagnitude()}getMagnitudeSquared(){return this.dot(this)}get magnitudeSquared(){return this.getMagnitudeSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceXYZ(t,s,r){const o=this.x-t,n=this.y-s,l=this.z-r;return Math.sqrt(o*o+n*n+l*l)}distanceSquared(t){const s=this.x-t.x,r=this.y-t.y,o=this.z-t.z;return s*s+r*r+o*o}distanceSquaredXYZ(t,s,r){const o=this.x-t,n=this.y-s,l=this.z-r;return o*o+n*n+l*l}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}dotXYZ(t,s,r){return this.x*t+this.y*s+this.z*r}angleBetween(t){return Math.acos(DotUtils.clamp(this.normalized().dot(t.normalized()),-1,1))}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}equalsEpsilon(t,s){return s||(s=0),Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)<=s}isFinite(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.z)}copy(t){return t?t.set(this):v3(this.x,this.y,this.z)}cross(t){return v3(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}normalized(){const t=this.magnitude;if(t===0)throw new Error("Cannot normalize a zero-magnitude vector");return v3(this.x/t,this.y/t,this.z/t)}roundedSymmetric(){return this.copy().roundSymmetric()}withMagnitude(t){return this.copy().setMagnitude(t)}timesScalar(t){return v3(this.x*t,this.y*t,this.z*t)}times(t){return this.timesScalar(t)}componentTimes(t){return v3(this.x*t.x,this.y*t.y,this.z*t.z)}plus(t){return v3(this.x+t.x,this.y+t.y,this.z+t.z)}plusXYZ(t,s,r){return v3(this.x+t,this.y+s,this.z+r)}plusScalar(t){return v3(this.x+t,this.y+t,this.z+t)}minus(t){return v3(this.x-t.x,this.y-t.y,this.z-t.z)}minusXYZ(t,s,r){return v3(this.x-t,this.y-s,this.z-r)}minusScalar(t){return v3(this.x-t,this.y-t,this.z-t)}dividedScalar(t){return v3(this.x/t,this.y/t,this.z/t)}negated(){return v3(-this.x,-this.y,-this.z)}blend(t,s){return this.plus(t.minus(this).times(s))}average(t){return this.blend(t,.5)}static average(t){return _.reduce(t,ADDING_ACCUMULATOR$1,new Va(0,0,0)).divideScalar(t.length)}toString(){return`Vector3(${this.x}, ${this.y}, ${this.z})`}toVector2(){return v2(this.x,this.y)}toVector4(){return v4(this.x,this.y,this.z,1)}toVector4Zero(){return v4(this.x,this.y,this.z,0)}setXYZ(t,s,r){return this.x=t,this.y=s,this.z=r,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}set(t){return this.setXYZ(t.x,t.y,t.z)}setMagnitude(t){const s=t/this.magnitude;return this.multiplyScalar(s)}add(t){return this.setXYZ(this.x+t.x,this.y+t.y,this.z+t.z)}addXYZ(t,s,r){return this.setXYZ(this.x+t,this.y+s,this.z+r)}addScalar(t){return this.setXYZ(this.x+t,this.y+t,this.z+t)}subtract(t){return this.setXYZ(this.x-t.x,this.y-t.y,this.z-t.z)}subtractXYZ(t,s,r){return this.setXYZ(this.x-t,this.y-s,this.z-r)}subtractScalar(t){return this.setXYZ(this.x-t,this.y-t,this.z-t)}multiplyScalar(t){return this.setXYZ(this.x*t,this.y*t,this.z*t)}multiply(t){return this.multiplyScalar(t)}componentMultiply(t){return this.setXYZ(this.x*t.x,this.y*t.y,this.z*t.z)}divideScalar(t){return this.setXYZ(this.x/t,this.y/t,this.z/t)}negate(){return this.setXYZ(-this.x,-this.y,-this.z)}setCross(t){return this.setXYZ(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}normalize(){const t=this.magnitude;if(t===0)throw new Error("Cannot normalize a zero-magnitude vector");return this.divideScalar(t)}roundSymmetric(){return this.setXYZ(DotUtils.roundSymmetric(this.x),DotUtils.roundSymmetric(this.y),DotUtils.roundSymmetric(this.z))}toStateObject(){return{x:this.x,y:this.y,z:this.z}}freeToPool(){Va.pool.freeToPool(this)}static slerp(t,s,r){return dot.Quaternion.slerp(new dot.Quaternion,dot.Quaternion.getRotationQuaternion(t,s),r).timesVector3(t)}static fromStateObject(t){return v3(t.x,t.y,t.z)}};Va.pool=new Pool(Va,{maxSize:1e3,initialize:Va.prototype.setXYZ,defaultArguments:[0,0,0]});let Vector3=Va;Vector3.prototype.isVector3=!0;Vector3.prototype.dimension=3;dot.register("Vector3",Vector3);const v3=Vector3.pool.create.bind(Vector3.pool);dot.register("v3",v3);class ImmutableVector3 extends Vector3{static mutableOverrideHelper(t){ImmutableVector3.prototype[t]=()=>{throw new Error(`Cannot call mutable method '${t}' on immutable Vector3`)}}}ImmutableVector3.mutableOverrideHelper("setXYZ");ImmutableVector3.mutableOverrideHelper("setX");ImmutableVector3.mutableOverrideHelper("setY");ImmutableVector3.mutableOverrideHelper("setZ");Vector3.ZERO=assert?new ImmutableVector3(0,0,0):new Vector3(0,0,0);Vector3.X_UNIT=assert?new ImmutableVector3(1,0,0):new Vector3(1,0,0);Vector3.Y_UNIT=assert?new ImmutableVector3(0,1,0):new Vector3(0,1,0);Vector3.Z_UNIT=assert?new ImmutableVector3(0,0,1):new Vector3(0,0,1);Vector3.Vector3IO=new IOType("Vector3IO",{valueType:Vector3,documentation:"Basic 3-dimensional vector, represented as (x,y,z)",toStateObject:a=>a.toStateObject(),fromStateObject:Vector3.fromStateObject,stateSchema:{x:NumberIO,y:NumberIO,z:NumberIO}});const EPSILON=Number.MIN_VALUE,TWO_PI$1=2*Math.PI;let generate,z0,z1;const Utils$1={clamp(a,t,s){return a<t?t:a>s?s:a},moduloBetweenDown(a,t,s){assert&&assert(s>t,"max > min required for moduloBetween");const r=s-t;let o=(a-t)%r;return o<0&&(o+=r),o+t},moduloBetweenUp(a,t,s){return-Utils$1.moduloBetweenDown(-a,-s,-t)},rangeInclusive(a,t){if(t<a)return[];const s=new Array(t-a+1);for(let r=a;r<=t;r++)s[r-a]=r;return s},rangeExclusive(a,t){return Utils$1.rangeInclusive(a+1,t-1)},toRadians(a){return Math.PI*a/180},toDegrees(a){return 180*a/Math.PI},mod(a,t){return a/t%1===0?0:a%t},gcd(a,t){return Math.abs(t===0?a:this.gcd(t,Utils$1.mod(a,t)))},lcm(a,t){return Utils$1.roundSymmetric(Math.abs(a*t)/Utils$1.gcd(a,t))},lineLineIntersection(a,t,s,r){if(a.equals(t)||s.equals(r))return null;const n=a.x-t.x,l=s.x-r.x,h=a.y-t.y,g=s.y-r.y,d=n*g-h*l;if(Math.abs(d)<1e-10)return null;const A=a.x*t.y-a.y*t.x,S=s.x*r.y-s.y*r.x;return new Vector2((A*l-n*S)/d,(A*g-h*S)/d)},circleCenterFromPoints(a,t,s){const r=new Vector2((a.x+t.x)/2,(a.y+t.y)/2),o=new Vector2((t.x+s.x)/2,(t.y+s.y)/2),n=new Vector2(r.x+(t.y-a.y),r.y-(t.x-a.x)),l=new Vector2(o.x+(s.y-t.y),o.y-(s.x-t.x));return Utils$1.lineLineIntersection(r,n,o,l)},pointInCircleFromPoints(a,t,s,r){assert&&assert(Utils$1.triangleAreaSigned(a,t,s)>0,"Defined points should be in a counterclockwise order");const o=a.x-r.x,n=a.y-r.y,l=(a.x-r.x)*(a.x-r.x)+(a.y-r.y)*(a.y-r.y),h=t.x-r.x,g=t.y-r.y,d=(t.x-r.x)*(t.x-r.x)+(t.y-r.y)*(t.y-r.y),A=s.x-r.x,S=s.y-r.y,O=(s.x-r.x)*(s.x-r.x)+(s.y-r.y)*(s.y-r.y);return o*g*O+n*d*A+l*h*S-l*g*A-n*h*O-o*d*S>0},sphereRayIntersection(a,t,s){s=s===void 0?1e-5:s;const r=new Vector3(0,0,0),o=t.direction,n=t.position,l=n.minus(r),h=o.dot(l),g=l.magnitudeSquared,d=4*h*h-4*(g-a*a);if(d<s)return null;const A=o.dot(r)-o.dot(n),S=Math.sqrt(d)/2,O=A-S,I=A+S;if(I<s)return null;const W=t.pointAtDistance(I),L=W.minus(r).normalized();if(O<s)return{distance:I,hitPoint:W,normal:L.negated(),fromOutside:!1};{const H=t.pointAtDistance(O),Y=H.minus(r).normalized();return{distance:O,hitPoint:H,normal:Y,fromOutside:!0}}},solveLinearRootsReal(a,t){return a===0?t===0?null:[]:[-t/a]},solveQuadraticRootsReal(a,t,s){if(a===0||Math.abs(t/a)>1e7||Math.abs(s/a)>1e7)return Utils$1.solveLinearRootsReal(t,s);const o=t*t-4*a*s;if(o<0)return[];const n=Math.sqrt(o);return[(-t-n)/(2*a),(-t+n)/(2*a)]},solveCubicRootsReal(a,t,s,r,o=1e-7){let n;if(a===0)n=Utils$1.solveQuadraticRootsReal(t,s,r);else if(a===0||Math.abs(t/a)>1e7||Math.abs(s/a)>1e7||Math.abs(r/a)>1e7)n=Utils$1.solveQuadraticRootsReal(t,s,r);else if(r===0||Math.abs(a/r)>1e7||Math.abs(t/r)>1e7||Math.abs(s/r)>1e7)n=[0].concat(Utils$1.solveQuadraticRootsReal(a,t,s));else{t/=a,s/=a,r/=a;const h=(3*s-t*t)/9,g=(-(27*r)+t*(9*s-2*(t*t)))/54,d=h*h*h+g*g,A=t/3;if(d>o){const S=Math.sqrt(d);n=[Utils$1.cubeRoot(g+S)+Utils$1.cubeRoot(g-S)-A]}else if(d>-o){const S=Utils$1.cubeRoot(g),O=-A-S;n=[-A+2*S,O,O]}else{let S=-h*h*h;S=Math.acos(g/Math.sqrt(S));const O=2*Math.sqrt(-h);n=[-A+O*Math.cos(S/3),-A+O*Math.cos((S+2*Math.PI)/3),-A+O*Math.cos((S+4*Math.PI)/3)]}}return assert&&n&&n.forEach(l=>assert(isFinite(l),"All returned solveCubicRootsReal roots should be finite")),n},cubeRoot(a){return a>=0?Math.pow(a,1/3):-Math.pow(-a,1/3)},linear(a,t,s,r,o){return assert&&assert(typeof o=="number","linear requires a number to evaluate"),(r-s)/(t-a)*(o-a)+s},roundSymmetric(a){return(a<0?-1:1)*Math.round(Math.abs(a))},toFixed(a,t){if(assert&&assert(typeof a=="number"),assert&&assert(Number.isInteger(t),`decimal places must be an integer: ${t}`),isNaN(a))return"NaN";if(a===Number.POSITIVE_INFINITY)return"Infinity";if(a===Number.NEGATIVE_INFINITY)return"-Infinity";const s=new Big(a).toFixed(t);return s.startsWith("-0.")&&Number.parseFloat(s)===0?"0"+s.slice(2):s},toFixedNumber(a,t){return parseFloat(Utils$1.toFixed(a,t))},equalsEpsilon(a,t,s){return Math.abs(a-t)<=s},lineSegmentIntersection(a,t,s,r,o,n,l,h){const g=(O,I,W,L,H,Y)=>(Y-I)*(W-O)-(L-I)*(H-O);if(g(a,t,o,n,l,h)*g(s,r,o,n,l,h)>0||g(o,n,a,t,s,r)*g(l,h,a,t,s,r)>0)return null;const d=(a-s)*(n-h)-(t-r)*(o-l);if(Math.abs(d)<1e-10)return null;if(a===o&&t===n||a===l&&t===h)return new Vector2(a,t);if(s===o&&r===n||s===l&&r===h)return new Vector2(s,r);const A=((a*r-t*s)*(o-l)-(a-s)*(o*h-n*l))/d,S=((a*r-t*s)*(n-h)-(t-r)*(o*h-n*l))/d;return new Vector2(A,S)},distToSegmentSquared(a,t,s){const r=t.distanceSquared(s);if(r===0)return a.distanceSquared(t);const o=((a.x-t.x)*(s.x-t.x)+(a.y-t.y)*(s.y-t.y))/r;let n;return o<0?n=a.distanceSquared(t):o>1?n=a.distanceSquared(s):n=a.distanceSquared(new Vector2(t.x+o*(s.x-t.x),t.y+o*(s.y-t.y))),n},distToSegment(a,t,s){return Math.sqrt(this.distToSegmentSquared(a,t,s))},arePointsCollinear(a,t,s,r){return r===void 0&&(r=0),Utils$1.triangleArea(a,t,s)<=r},triangleArea(a,t,s){return Math.abs(Utils$1.triangleAreaSigned(a,t,s))},triangleAreaSigned(a,t,s){return a.x*(t.y-s.y)+t.x*(s.y-a.y)+s.x*(a.y-t.y)},centroidOfPolygon(a){const t=new Vector2(0,0);let s=0;return a.forEach((r,o)=>{const n=a[(o+1)%a.length],l=r.x*n.y-n.x*r.y;s+=l/2,t.addXY((r.x+n.x)*l,(r.y+n.y)*l)}),t.divideScalar(6*s),t},cosh(a){return(Math.exp(a)+Math.exp(-a))/2},sinh(a){return(Math.exp(a)-Math.exp(-a))/2},log10(a){return Math.log(a)/Math.LN10},boxMullerTransform(a,t,s){if(generate=!generate,!generate)return z1*t+a;let r,o;do r=s.nextDouble(),o=s.nextDouble();while(r<=EPSILON);return z0=Math.sqrt(-2*Math.log(r))*Math.cos(TWO_PI$1*o),z1=Math.sqrt(-2*Math.log(r))*Math.sin(TWO_PI$1*o),z0*t+a},numberOfDecimalPlaces(a){if(assert&&assert(typeof a=="number"&&isFinite(a),`value must be a finite number ${a}`),Math.floor(a)===a)return 0;{const t=a.toString();if(t.includes("e")){const s=t.split("e"),r=s[0],o=Number(s[1]),n=r.includes(".")?r.split(".")[1].length:0;return Math.max(n-o,0)}else return t.split(".")[1].length}},roundToInterval(a,t){return Utils$1.toFixedNumber(Utils$1.roundSymmetric(a/t)*t,Utils$1.numberOfDecimalPlaces(t))}};dot.register("Utils",Utils$1);dot.clamp=Utils$1.clamp;dot.moduloBetweenDown=Utils$1.moduloBetweenDown;dot.moduloBetweenUp=Utils$1.moduloBetweenUp;dot.rangeInclusive=Utils$1.rangeInclusive;dot.rangeExclusive=Utils$1.rangeExclusive;dot.toRadians=Utils$1.toRadians;dot.toDegrees=Utils$1.toDegrees;dot.lineLineIntersection=Utils$1.lineLineIntersection;dot.lineSegmentIntersection=Utils$1.lineSegmentIntersection;dot.sphereRayIntersection=Utils$1.sphereRayIntersection;dot.solveQuadraticRootsReal=Utils$1.solveQuadraticRootsReal;dot.solveCubicRootsReal=Utils$1.solveCubicRootsReal;dot.cubeRoot=Utils$1.cubeRoot;dot.linear=Utils$1.linear;dot.boxMullerTransform=Utils$1.boxMullerTransform;const DotUtils=Utils$1,ADDING_ACCUMULATOR=(a,t)=>a.add(t),Yo=class Yo{constructor(t,s){this.x=t,this.y=s}getMagnitude(){return Math.sqrt(this.magnitudeSquared)}get magnitude(){return this.getMagnitude()}getMagnitudeSquared(){return this.x*this.x+this.y*this.y}get magnitudeSquared(){return this.getMagnitudeSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceXY(t,s){const r=this.x-t,o=this.y-s;return Math.sqrt(r*r+o*o)}distanceSquared(t){const s=this.x-t.x,r=this.y-t.y;return s*s+r*r}distanceSquaredXY(t,s){const r=this.x-t,o=this.y-s;return r*r+o*o}dot(t){return this.x*t.x+this.y*t.y}dotXY(t,s){return this.x*t+this.y*s}getAngle(){return Math.atan2(this.y,this.x)}get angle(){return this.getAngle()}angleBetween(t){const s=this.magnitude,r=t.magnitude;return Math.acos(dot.clamp((this.x*t.x+this.y*t.y)/(s*r),-1,1))}equals(t){return this.x===t.x&&this.y===t.y}equalsEpsilon(t,s){return s||(s=0),Math.max(Math.abs(this.x-t.x),Math.abs(this.y-t.y))<=s}isFinite(){return isFinite(this.x)&&isFinite(this.y)}copy(t){return t?t.set(this):v2(this.x,this.y)}crossScalar(t){return this.x*t.y-this.y*t.x}normalized(){const t=this.magnitude;if(t===0)throw new Error("Cannot normalize a zero-magnitude vector");return v2(this.x/t,this.y/t)}roundedSymmetric(){return this.copy().roundSymmetric()}withMagnitude(t){return this.copy().setMagnitude(t)}timesScalar(t){return v2(this.x*t,this.y*t)}times(t){return this.timesScalar(t)}componentTimes(t){return v2(this.x*t.x,this.y*t.y)}plus(t){return v2(this.x+t.x,this.y+t.y)}plusXY(t,s){return v2(this.x+t,this.y+s)}plusScalar(t){return v2(this.x+t,this.y+t)}minus(t){return v2(this.x-t.x,this.y-t.y)}minusXY(t,s){return v2(this.x-t,this.y-s)}minusScalar(t){return v2(this.x-t,this.y-t)}dividedScalar(t){return v2(this.x/t,this.y/t)}negated(){return v2(-this.x,-this.y)}getPerpendicular(){return v2(this.y,-this.x)}get perpendicular(){return this.getPerpendicular()}rotated(t){const s=this.angle+t,r=this.magnitude;return v2(r*Math.cos(s),r*Math.sin(s))}rotateAboutXY(t,s,r){const o=this.x-t,n=this.y-s,l=Math.cos(r),h=Math.sin(r);return this.x=t+o*l-n*h,this.y=s+o*h+n*l,this}rotateAboutPoint(t,s){return this.rotateAboutXY(t.x,t.y,s)}rotatedAboutXY(t,s,r){return v2(this.x,this.y).rotateAboutXY(t,s,r)}rotatedAboutPoint(t,s){return this.rotatedAboutXY(t.x,t.y,s)}blend(t,s){return v2(this.x+(t.x-this.x)*s,this.y+(t.y-this.y)*s)}average(t){return this.blend(t,.5)}static average(t){return _.reduce(t,ADDING_ACCUMULATOR,new Yo(0,0)).divideScalar(t.length)}toString(){return`Vector2(${this.x}, ${this.y})`}toVector3(){return new Vector3(this.x,this.y,0)}setXY(t,s){return this.x=t,this.y=s,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}set(t){return this.setXY(t.x,t.y)}setMagnitude(t){const s=t/this.magnitude;return this.multiplyScalar(s)}add(t){return this.setXY(this.x+t.x,this.y+t.y)}addXY(t,s){return this.setXY(this.x+t,this.y+s)}addScalar(t){return this.setXY(this.x+t,this.y+t)}subtract(t){return this.setXY(this.x-t.x,this.y-t.y)}subtractXY(t,s){return this.setXY(this.x-t,this.y-s)}subtractScalar(t){return this.setXY(this.x-t,this.y-t)}multiplyScalar(t){return this.setXY(this.x*t,this.y*t)}multiply(t){return this.multiplyScalar(t)}componentMultiply(t){return this.setXY(this.x*t.x,this.y*t.y)}divideScalar(t){return this.setXY(this.x/t,this.y/t)}negate(){return this.setXY(-this.x,-this.y)}normalize(){const t=this.magnitude;if(t===0)throw new Error("Cannot normalize a zero-magnitude vector");return this.divideScalar(t)}roundSymmetric(){return this.setXY(DotUtils.roundSymmetric(this.x),DotUtils.roundSymmetric(this.y))}rotate(t){const s=this.angle+t,r=this.magnitude;return this.setXY(r*Math.cos(s),r*Math.sin(s))}setPolar(t,s){return this.setXY(t*Math.cos(s),t*Math.sin(s))}toStateObject(){return{x:this.x,y:this.y}}freeToPool(){Yo.pool.freeToPool(this)}static createPolar(t,s){return new Yo(0,0).setPolar(t,s)}static fromStateObject(t){return v2(t.x,t.y)}static getAngleBetweenVectors(t,s){const r=s.x-t.x,o=s.y-t.y;return Math.atan2(o,r)}static getDistanceBetweenVectors(t,s){const r=s.x-t.x,o=s.y-t.y;return Math.sqrt(r*r+o*o)}};Yo.pool=new Pool(Yo,{maxSize:1e3,initialize:Yo.prototype.setXY,defaultArguments:[0,0]});let Vector2=Yo;Vector2.prototype.isVector2=!0;Vector2.prototype.dimension=2;dot.register("Vector2",Vector2);const v2=Vector2.pool.create.bind(Vector2.pool);dot.register("v2",v2);class ImmutableVector2 extends Vector2{static mutableOverrideHelper(t){ImmutableVector2.prototype[t]=()=>{throw new Error(`Cannot call mutable method '${t}' on immutable Vector2`)}}}ImmutableVector2.mutableOverrideHelper("setXY");ImmutableVector2.mutableOverrideHelper("setX");ImmutableVector2.mutableOverrideHelper("setY");Vector2.ZERO=assert?new ImmutableVector2(0,0):new Vector2(0,0);Vector2.X_UNIT=assert?new ImmutableVector2(1,0):new Vector2(1,0);Vector2.Y_UNIT=assert?new ImmutableVector2(0,1):new Vector2(0,1);const STATE_SCHEMA$2={x:NumberIO,y:NumberIO};Vector2.Vector2IO=new IOType("Vector2IO",{valueType:Vector2,stateSchema:STATE_SCHEMA$2,toStateObject:a=>a.toStateObject(),fromStateObject:a=>Vector2.fromStateObject(a),documentation:"A numerical object with x and y properties, like {x:3,y:4}"});const STATE_SCHEMA$1={min:InfiniteNumberIO,max:InfiniteNumberIO},Kn=class Kn{constructor(t,s){this._min=t,this._max=s}getMin(){return this._min}get min(){return this.getMin()}set min(t){this.setMin(t)}setMin(t){assert&&assert(t<=this._max,`min must be <= max: ${t}`),this._min=t}getMax(){return this._max}get max(){return this.getMax()}set max(t){this.setMax(t)}setMax(t){assert&&assert(this._min<=t,`max must be >= to min: ${t}`),this._max=t}setMinMax(t,s){return assert&&assert(t<=s,`max must be >= to min. min: ${t}, max: ${s}`),this._min=t,this._max=s,this}set(t){return this.setMinMax(t.min,t.max),this}addValue(t){this._min=Math.min(this._min,t),this._max=Math.max(this._max,t)}withValue(t){return new Kn(Math.min(this._min,t),Math.max(this._max,t))}copy(){return new Kn(this._min,this._max)}getLength(){return this._max-this._min}getCenter(){return(this._max+this._min)/2}contains(t){return t>=this._min&&t<=this._max}containsRange(t){return this._min<=t.min&&this._max>=t.max}intersects(t){return this._max>=t.min&&t.max>=this._min}intersectsExclusive(t){return this._max>t.min&&t.max>this._min}union(t){return new Kn(Math.min(this.min,t.min),Math.max(this.max,t.max))}intersection(t){return new Kn(Math.max(this.min,t.min),Math.min(this.max,t.max))}includeRange(t){return this.setMinMax(Math.min(this.min,t.min),Math.max(this.max,t.max))}constrainRange(t){return this.setMinMax(Math.max(this.min,t.min),Math.min(this.max,t.max))}shifted(t){return new Kn(this.min+t,this.max+t)}toString(){return`[Range (min:${this._min} max:${this._max})]`}constrainValue(t){return Math.min(Math.max(t,this._min),this._max)}equals(t){return this.constructor===t.constructor&&this._min===t.min&&this._max===t.max}equalsEpsilon(t,s){return this.constructor===t.constructor&&Math.abs(this._min-t.min)<=s&&Math.abs(this._max-t.max)<=s}getNormalizedValue(t){return assert&&assert(this.getLength()!==0,"cannot get normalized value without a range length"),(t-this.min)/this.getLength()}expandNormalizedValue(t){return assert&&assert(this.getLength()!==0,"cannot get expand normalized value without a range length"),t*this.getLength()+this.min}get defaultValue(){throw new Error("defaultValue is undefined, did you mean to use RangeWithValue?")}toStateObject(){return{min:InfiniteNumberIO.toStateObject(this.min),max:InfiniteNumberIO.toStateObject(this.max)}}clampDelta(t,s){return assert&&assert(this.contains(t)),t+s<this.min?this.min-t:t+s>this.max?this.max-t:s}static fromStateObject(t){return new Kn(InfiniteNumberIO.fromStateObject(t.min),InfiniteNumberIO.fromStateObject(t.max))}};Kn.RangeIO=new IOType("RangeIO",{valueType:Kn,documentation:'A range with "min" and "max" members.',stateSchema:STATE_SCHEMA$1,toStateObject:t=>t.toStateObject(),fromStateObject:t=>Kn.fromStateObject(t)}),Kn.EVERYTHING=new Kn(Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY),Kn.NOTHING=new Kn(Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY);let Range=Kn;dot.register("Range",Range);const scratchVector2$2=new Vector2(0,0),kn=class kn{constructor(t,s,r,o){assert&&assert(o!==void 0,"Bounds2 requires 4 parameters"),this.minX=t,this.minY=s,this.maxX=r,this.maxY=o}getWidth(){return this.maxX-this.minX}get width(){return this.getWidth()}getHeight(){return this.maxY-this.minY}get height(){return this.getHeight()}getX(){return this.minX}get x(){return this.getX()}getY(){return this.minY}get y(){return this.getY()}getMinX(){return this.minX}getMinY(){return this.minY}getMaxX(){return this.maxX}getMaxY(){return this.maxY}getLeft(){return this.minX}get left(){return this.minX}getTop(){return this.minY}get top(){return this.minY}getRight(){return this.maxX}get right(){return this.maxX}getBottom(){return this.maxY}get bottom(){return this.maxY}getCenterX(){return(this.maxX+this.minX)/2}get centerX(){return this.getCenterX()}getCenterY(){return(this.maxY+this.minY)/2}get centerY(){return this.getCenterY()}getLeftTop(){return new Vector2(this.minX,this.minY)}get leftTop(){return this.getLeftTop()}getCenterTop(){return new Vector2(this.getCenterX(),this.minY)}get centerTop(){return this.getCenterTop()}getRightTop(){return new Vector2(this.maxX,this.minY)}get rightTop(){return this.getRightTop()}getLeftCenter(){return new Vector2(this.minX,this.getCenterY())}get leftCenter(){return this.getLeftCenter()}getCenter(){return new Vector2(this.getCenterX(),this.getCenterY())}get center(){return this.getCenter()}getRightCenter(){return new Vector2(this.maxX,this.getCenterY())}get rightCenter(){return this.getRightCenter()}getLeftBottom(){return new Vector2(this.minX,this.maxY)}get leftBottom(){return this.getLeftBottom()}getCenterBottom(){return new Vector2(this.getCenterX(),this.maxY)}get centerBottom(){return this.getCenterBottom()}getRightBottom(){return new Vector2(this.maxX,this.maxY)}get rightBottom(){return this.getRightBottom()}isEmpty(){return this.getWidth()<0||this.getHeight()<0}isFinite(){return isFinite(this.minX)&&isFinite(this.minY)&&isFinite(this.maxX)&&isFinite(this.maxY)}hasNonzeroArea(){return this.getWidth()>0&&this.getHeight()>0}isValid(){return!this.isEmpty()&&this.isFinite()}closestPointTo(t){return this.containsCoordinates(t.x,t.y)?t:this.getConstrainedPoint(t)}closestBoundaryPointTo(t){if(this.containsCoordinates(t.x,t.y)){const s=t.x<this.centerX?this.minX:this.maxX,r=t.y<this.centerY?this.minY:this.maxY;return Math.abs(s-t.x)<Math.abs(r-t.y)?new Vector2(s,t.y):new Vector2(t.x,r)}else return this.getConstrainedPoint(t)}getConstrainedPoint(t){const s=Math.max(Math.min(t.x,this.maxX),this.x),r=Math.max(Math.min(t.y,this.maxY),this.y);return new Vector2(s,r)}containsCoordinates(t,s){return this.minX<=t&&t<=this.maxX&&this.minY<=s&&s<=this.maxY}containsPoint(t){return this.containsCoordinates(t.x,t.y)}containsBounds(t){return this.minX<=t.minX&&this.maxX>=t.maxX&&this.minY<=t.minY&&this.maxY>=t.maxY}intersectsBounds(t){const s=Math.max(this.minX,t.minX),r=Math.max(this.minY,t.minY),o=Math.min(this.maxX,t.maxX),n=Math.min(this.maxY,t.maxY);return o-s>=0&&n-r>=0}minimumDistanceToPointSquared(t){const s=t.x<this.minX?this.minX:t.x>this.maxX?this.maxX:null,r=t.y<this.minY?this.minY:t.y>this.maxY?this.maxY:null;let o;if(s===null&&r===null)return 0;if(s===null)return o=r-t.y,o*o;if(r===null)return o=s-t.x,o*o;{const n=s-t.x,l=r-t.y;return n*n+l*l}}maximumDistanceToPointSquared(t){let s=t.x>this.getCenterX()?this.minX:this.maxX,r=t.y>this.getCenterY()?this.minY:this.maxY;return s-=t.x,r-=t.y,s*s+r*r}toString(){return`[x:(${this.minX},${this.maxX}),y:(${this.minY},${this.maxY})]`}equals(t){return this.minX===t.minX&&this.minY===t.minY&&this.maxX===t.maxX&&this.maxY===t.maxY}equalsEpsilon(t,s){s=s!==void 0?s:0;const r=this.isFinite(),o=t.isFinite();return r&&o?Math.abs(this.minX-t.minX)<s&&Math.abs(this.minY-t.minY)<s&&Math.abs(this.maxX-t.maxX)<s&&Math.abs(this.maxY-t.maxY)<s:r!==o?!1:this===t?!0:(isFinite(this.minX+t.minX)?Math.abs(this.minX-t.minX)<s:this.minX===t.minX)&&(isFinite(this.minY+t.minY)?Math.abs(this.minY-t.minY)<s:this.minY===t.minY)&&(isFinite(this.maxX+t.maxX)?Math.abs(this.maxX-t.maxX)<s:this.maxX===t.maxX)&&(isFinite(this.maxY+t.maxY)?Math.abs(this.maxY-t.maxY)<s:this.maxY===t.maxY)}copy(t){return t?t.set(this):b2(this.minX,this.minY,this.maxX,this.maxY)}static create(t){return b2(t.minX,t.minY,t.maxX,t.maxY)}union(t){return b2(Math.min(this.minX,t.minX),Math.min(this.minY,t.minY),Math.max(this.maxX,t.maxX),Math.max(this.maxY,t.maxY))}intersection(t){return b2(Math.max(this.minX,t.minX),Math.max(this.minY,t.minY),Math.min(this.maxX,t.maxX),Math.min(this.maxY,t.maxY))}withCoordinates(t,s){return b2(Math.min(this.minX,t),Math.min(this.minY,s),Math.max(this.maxX,t),Math.max(this.maxY,s))}withPoint(t){return this.withCoordinates(t.x,t.y)}withX(t){return this.copy().addX(t)}withY(t){return this.copy().addY(t)}withMinX(t){return b2(t,this.minY,this.maxX,this.maxY)}withMinY(t){return b2(this.minX,t,this.maxX,this.maxY)}withMaxX(t){return b2(this.minX,this.minY,t,this.maxY)}withMaxY(t){return b2(this.minX,this.minY,this.maxX,t)}roundedOut(){return b2(Math.floor(this.minX),Math.floor(this.minY),Math.ceil(this.maxX),Math.ceil(this.maxY))}roundedIn(){return b2(Math.ceil(this.minX),Math.ceil(this.minY),Math.floor(this.maxX),Math.floor(this.maxY))}transformed(t){return this.copy().transform(t)}dilated(t){return this.dilatedXY(t,t)}dilatedX(t){return b2(this.minX-t,this.minY,this.maxX+t,this.maxY)}dilatedY(t){return b2(this.minX,this.minY-t,this.maxX,this.maxY+t)}dilatedXY(t,s){return b2(this.minX-t,this.minY-s,this.maxX+t,this.maxY+s)}eroded(t){return this.dilated(-t)}erodedX(t){return this.dilatedX(-t)}erodedY(t){return this.dilatedY(-t)}erodedXY(t,s){return this.dilatedXY(-t,-s)}withOffsets(t,s,r,o){return b2(this.minX-t,this.minY-s,this.maxX+r,this.maxY+o)}shiftedX(t){return b2(this.minX+t,this.minY,this.maxX+t,this.maxY)}shiftedY(t){return b2(this.minX,this.minY+t,this.maxX,this.maxY+t)}shiftedXY(t,s){return b2(this.minX+t,this.minY+s,this.maxX+t,this.maxY+s)}shifted(t){return this.shiftedXY(t.x,t.y)}blend(t,s){const r=1-s;return b2(r*this.minX+s*t.minX,r*this.minY+s*t.minY,r*this.maxX+s*t.maxX,r*this.maxY+s*t.maxY)}setMinMax(t,s,r,o){return this.minX=t,this.minY=s,this.maxX=r,this.maxY=o,this}setMinX(t){return this.minX=t,this}setMinY(t){return this.minY=t,this}setMaxX(t){return this.maxX=t,this}setMaxY(t){return this.maxY=t,this}set(t){return this.setMinMax(t.minX,t.minY,t.maxX,t.maxY)}includeBounds(t){return this.setMinMax(Math.min(this.minX,t.minX),Math.min(this.minY,t.minY),Math.max(this.maxX,t.maxX),Math.max(this.maxY,t.maxY))}constrainBounds(t){return this.setMinMax(Math.max(this.minX,t.minX),Math.max(this.minY,t.minY),Math.min(this.maxX,t.maxX),Math.min(this.maxY,t.maxY))}addCoordinates(t,s){return this.setMinMax(Math.min(this.minX,t),Math.min(this.minY,s),Math.max(this.maxX,t),Math.max(this.maxY,s))}addPoint(t){return this.addCoordinates(t.x,t.y)}addX(t){return this.minX=Math.min(t,this.minX),this.maxX=Math.max(t,this.maxX),this}addY(t){return this.minY=Math.min(t,this.minY),this.maxY=Math.max(t,this.maxY),this}roundOut(){return this.setMinMax(Math.floor(this.minX),Math.floor(this.minY),Math.ceil(this.maxX),Math.ceil(this.maxY))}roundIn(){return this.setMinMax(Math.ceil(this.minX),Math.ceil(this.minY),Math.floor(this.maxX),Math.floor(this.maxY))}transform(t){if(this.isEmpty())return this;if(t.isIdentity())return this;const s=this.minX,r=this.minY,o=this.maxX,n=this.maxY;return this.set(kn.NOTHING),this.addPoint(t.multiplyVector2(scratchVector2$2.setXY(s,r))),this.addPoint(t.multiplyVector2(scratchVector2$2.setXY(s,n))),this.addPoint(t.multiplyVector2(scratchVector2$2.setXY(o,r))),this.addPoint(t.multiplyVector2(scratchVector2$2.setXY(o,n))),this}dilate(t){return this.dilateXY(t,t)}dilateX(t){return this.setMinMax(this.minX-t,this.minY,this.maxX+t,this.maxY)}dilateY(t){return this.setMinMax(this.minX,this.minY-t,this.maxX,this.maxY+t)}dilateXY(t,s){return this.setMinMax(this.minX-t,this.minY-s,this.maxX+t,this.maxY+s)}erode(t){return this.dilate(-t)}erodeX(t){return this.dilateX(-t)}erodeY(t){return this.dilateY(-t)}erodeXY(t,s){return this.dilateXY(-t,-s)}offset(t,s,r,o){return b2(this.minX-t,this.minY-s,this.maxX+r,this.maxY+o)}shiftX(t){return this.setMinMax(this.minX+t,this.minY,this.maxX+t,this.maxY)}shiftY(t){return this.setMinMax(this.minX,this.minY+t,this.maxX,this.maxY+t)}shiftXY(t,s){return this.setMinMax(this.minX+t,this.minY+s,this.maxX+t,this.maxY+s)}shift(t){return this.shiftXY(t.x,t.y)}getXRange(){return new Range(this.minX,this.maxX)}setXRange(t){return this.setMinMax(t.min,this.minY,t.max,this.maxY)}get xRange(){return this.getXRange()}set xRange(t){this.setXRange(t)}getYRange(){return new Range(this.minY,this.maxY)}setYRange(t){return this.setMinMax(this.minX,t.min,this.maxX,t.max)}get yRange(){return this.getYRange()}set yRange(t){this.setYRange(t)}getClosestPoint(t,s,r){return r?r.setXY(t,s):r=new Vector2(t,s),r.x<this.minX&&(r.x=this.minX),r.x>this.maxX&&(r.x=this.maxX),r.y<this.minY&&(r.y=this.minY),r.y>this.maxY&&(r.y=this.maxY),r}freeToPool(){kn.pool.freeToPool(this)}static rect(t,s,r,o){return b2(t,s,t+r,s+o)}static oriented(t,s,r,o,n){return t===Orientation.HORIZONTAL?new kn(s,r,o,n):new kn(r,s,n,o)}static point(t,s){if(t instanceof Vector2){const r=t;return b2(r.x,r.y,r.x,r.y)}else return b2(t,s,t,s)}};kn.pool=new Pool(kn,{maxSize:1e3,initialize:kn.prototype.setMinMax,defaultArguments:[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY]}),kn.NOTHING=new kn(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),kn.EVERYTHING=new kn(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),kn.Bounds2IO=new IOType("Bounds2IO",{valueType:kn,documentation:"a 2-dimensional bounds rectangle",toStateObject:t=>({minX:t.minX,minY:t.minY,maxX:t.maxX,maxY:t.maxY}),fromStateObject:t=>new kn(InfiniteNumberIO.fromStateObject(t.minX),InfiniteNumberIO.fromStateObject(t.minY),InfiniteNumberIO.fromStateObject(t.maxX),InfiniteNumberIO.fromStateObject(t.maxY)),stateSchema:{minX:InfiniteNumberIO,maxX:InfiniteNumberIO,minY:InfiniteNumberIO,maxY:InfiniteNumberIO}});let Bounds2=kn;dot.register("Bounds2",Bounds2);const b2=Bounds2.pool.create.bind(Bounds2.pool);dot.register("b2",b2);Bounds2.prototype.isBounds=!0;Bounds2.prototype.dimension=2;function catchImmutableSetterLowHangingFruit(a){a.setMinMax=()=>{throw new Error('Attempt to set "setMinMax" of an immutable Bounds2 object')},a.set=()=>{throw new Error('Attempt to set "set" of an immutable Bounds2 object')},a.includeBounds=()=>{throw new Error('Attempt to set "includeBounds" of an immutable Bounds2 object')},a.constrainBounds=()=>{throw new Error('Attempt to set "constrainBounds" of an immutable Bounds2 object')},a.addCoordinates=()=>{throw new Error('Attempt to set "addCoordinates" of an immutable Bounds2 object')},a.transform=()=>{throw new Error('Attempt to set "transform" of an immutable Bounds2 object')}}assert&&(catchImmutableSetterLowHangingFruit(Bounds2.EVERYTHING),catchImmutableSetterLowHangingFruit(Bounds2.NOTHING));class BinPacker{constructor(t){this.rootBin=new Bin(t,null)}allocate(t,s){const r=this.rootBin.findAvailableBin(t,s);if(r){const o=r.split(t,s);return o.use(),o}else return null}deallocate(t){t.unuse()}toString(){let t="",s="";function r(o){t+=`${s+o.toString()}
`,s=`${s}  `,_.each(o.children,r),s=s.substring(2)}return r(this.rootBin),t}}dot.register("BinPacker",BinPacker);class Bin{constructor(t,s){this.bounds=t,this.parent=s,this.isSplit=!1,this.isUsed=!1,this.children=[]}findAvailableBin(t,s){if(assert&&assert(t>0&&s>0,"Empty bin requested?"),this.isUsed)return null;if(this.bounds.width<t||this.bounds.height<s)return null;if(this.isSplit){for(let r=0;r<this.children.length;r++){const o=this.children[r].findAvailableBin(t,s);if(o)return o}return null}else return this}split(t,s){if(assert&&assert(this.bounds.width>=t&&this.bounds.height>=s,"Bin does not have space"),assert&&assert(!this.isSplit,"Bin should not be re-split"),assert&&assert(!this.isUsed,"Bin should not be split when used"),assert&&assert(t>0&&s>0,"Empty bin requested?"),t===this.bounds.width&&s===this.bounds.height)return this;this.isSplit=!0;const r=this.bounds.minX+t,o=this.bounds.minY+s,n=new Bounds2(this.bounds.minX,this.bounds.minY,r,o),l=new Bounds2(r,this.bounds.minY,this.bounds.maxX,o),h=new Bounds2(this.bounds.minX,o,this.bounds.maxX,this.bounds.maxY),g=new Bin(n,this);return this.children.push(g),l.hasNonzeroArea()&&this.children.push(new Bin(l,this)),h.hasNonzeroArea()&&this.children.push(new Bin(h,this)),g}use(){assert&&assert(!this.isSplit,"Should not mark a split bin as used"),assert&&assert(!this.isUsed,"Should not mark a used bin as used"),this.isUsed=!0}unuse(){assert&&assert(this.isUsed,"Can only unuse a used instance"),this.isUsed=!1,this.parent&&this.parent.attemptToCollapse()}attemptToCollapse(){assert&&assert(this.isSplit,"Should only attempt to collapse split bins");for(let t=0;t<this.children.length;t++){const s=this.children[t];if(s.isSplit||s.isUsed)return}this.children=[],this.isSplit=!1,this.parent&&this.parent.attemptToCollapse()}toString(){return this.bounds.toString()+(this.isUsed?" used":"")}}BinPacker.Bin=Bin;const Cs=class Cs{constructor(t,s,r,o,n,l){this.minX=t,this.minY=s,this.minZ=r,this.maxX=o,this.maxY=n,this.maxZ=l,this.isBounds=!0,this.dimension=3,assert&&assert(n!==void 0,"Bounds3 requires 4 parameters")}getWidth(){return this.maxX-this.minX}get width(){return this.getWidth()}getHeight(){return this.maxY-this.minY}get height(){return this.getHeight()}getDepth(){return this.maxZ-this.minZ}get depth(){return this.getDepth()}getX(){return this.minX}get x(){return this.getX()}getY(){return this.minY}get y(){return this.getY()}getZ(){return this.minZ}get z(){return this.getZ()}getMinX(){return this.minX}getMinY(){return this.minY}getMinZ(){return this.minZ}getMaxX(){return this.maxX}getMaxY(){return this.maxY}getMaxZ(){return this.maxZ}getLeft(){return this.minX}get left(){return this.minX}getTop(){return this.minY}get top(){return this.minY}getBack(){return this.minZ}get back(){return this.minZ}getRight(){return this.maxX}get right(){return this.maxX}getBottom(){return this.maxY}get bottom(){return this.maxY}getFront(){return this.maxZ}get front(){return this.maxZ}getCenterX(){return(this.maxX+this.minX)/2}get centerX(){return this.getCenterX()}getCenterY(){return(this.maxY+this.minY)/2}get centerY(){return this.getCenterY()}getCenterZ(){return(this.maxZ+this.minZ)/2}get centerZ(){return this.getCenterZ()}getCenter(){return new Vector3(this.getCenterX(),this.getCenterY(),this.getCenterZ())}get center(){return this.getCenter()}isEmpty(){return this.getWidth()<0||this.getHeight()<0||this.getDepth()<0}isFinite(){return isFinite(this.minX)&&isFinite(this.minY)&&isFinite(this.minZ)&&isFinite(this.maxX)&&isFinite(this.maxY)&&isFinite(this.maxZ)}hasNonzeroArea(){return this.getWidth()>0&&this.getHeight()>0&&this.getDepth()>0}isValid(){return!this.isEmpty()&&this.isFinite()}containsCoordinates(t,s,r){return this.minX<=t&&t<=this.maxX&&this.minY<=s&&s<=this.maxY&&this.minZ<=r&&r<=this.maxZ}containsPoint(t){return this.containsCoordinates(t.x,t.y,t.z)}containsBounds(t){return this.minX<=t.minX&&this.maxX>=t.maxX&&this.minY<=t.minY&&this.maxY>=t.maxY&&this.minZ<=t.minZ&&this.maxZ>=t.maxZ}intersectsBounds(t){return!this.intersection(t).isEmpty()}toString(){return`[x:(${this.minX},${this.maxX}),y:(${this.minY},${this.maxY}),z:(${this.minZ},${this.maxZ})]`}equals(t){return this.minX===t.minX&&this.minY===t.minY&&this.minZ===t.minZ&&this.maxX===t.maxX&&this.maxY===t.maxY&&this.maxZ===t.maxZ}equalsEpsilon(t,s){s=s!==void 0?s:0;const r=this.isFinite(),o=t.isFinite();return r&&o?Math.abs(this.minX-t.minX)<s&&Math.abs(this.minY-t.minY)<s&&Math.abs(this.minZ-t.minZ)<s&&Math.abs(this.maxX-t.maxX)<s&&Math.abs(this.maxY-t.maxY)<s&&Math.abs(this.maxZ-t.maxZ)<s:r!==o?!1:this===t?!0:(isFinite(this.minX+t.minX)?Math.abs(this.minX-t.minX)<s:this.minX===t.minX)&&(isFinite(this.minY+t.minY)?Math.abs(this.minY-t.minY)<s:this.minY===t.minY)&&(isFinite(this.minZ+t.minZ)?Math.abs(this.minZ-t.minZ)<s:this.minZ===t.minZ)&&(isFinite(this.maxX+t.maxX)?Math.abs(this.maxX-t.maxX)<s:this.maxX===t.maxX)&&(isFinite(this.maxY+t.maxY)?Math.abs(this.maxY-t.maxY)<s:this.maxY===t.maxY)&&(isFinite(this.maxZ+t.maxZ)?Math.abs(this.maxZ-t.maxZ)<s:this.maxZ===t.maxZ)}copy(t){return t?t.set(this):new Cs(this.minX,this.minY,this.minZ,this.maxX,this.maxY,this.maxZ)}union(t){return new Cs(Math.min(this.minX,t.minX),Math.min(this.minY,t.minY),Math.min(this.minZ,t.minZ),Math.max(this.maxX,t.maxX),Math.max(this.maxY,t.maxY),Math.max(this.maxZ,t.maxZ))}intersection(t){return new Cs(Math.max(this.minX,t.minX),Math.max(this.minY,t.minY),Math.max(this.minZ,t.minZ),Math.min(this.maxX,t.maxX),Math.min(this.maxY,t.maxY),Math.min(this.maxZ,t.maxZ))}withCoordinates(t,s,r){return new Cs(Math.min(this.minX,t),Math.min(this.minY,s),Math.min(this.minZ,r),Math.max(this.maxX,t),Math.max(this.maxY,s),Math.max(this.maxZ,r))}withPoint(t){return this.withCoordinates(t.x,t.y,t.z)}withMinX(t){return new Cs(t,this.minY,this.minZ,this.maxX,this.maxY,this.maxZ)}withMinY(t){return new Cs(this.minX,t,this.minZ,this.maxX,this.maxY,this.maxZ)}withMinZ(t){return new Cs(this.minX,this.minY,t,this.maxX,this.maxY,this.maxZ)}withMaxX(t){return new Cs(this.minX,this.minY,this.minZ,t,this.maxY,this.maxZ)}withMaxY(t){return new Cs(this.minX,this.minY,this.minZ,this.maxX,t,this.maxZ)}withMaxZ(t){return new Cs(this.minX,this.minY,this.minZ,this.maxX,this.maxY,t)}roundedOut(){return new Cs(Math.floor(this.minX),Math.floor(this.minY),Math.floor(this.minZ),Math.ceil(this.maxX),Math.ceil(this.maxY),Math.ceil(this.maxZ))}roundedIn(){return new Cs(Math.ceil(this.minX),Math.ceil(this.minY),Math.ceil(this.minZ),Math.floor(this.maxX),Math.floor(this.maxY),Math.floor(this.maxZ))}transformed(t){return this.copy().transform(t)}dilated(t){return this.dilatedXYZ(t,t,t)}dilatedX(t){return new Cs(this.minX-t,this.minY,this.minZ,this.maxX+t,this.maxY,this.maxZ)}dilatedY(t){return new Cs(this.minX,this.minY-t,this.minZ,this.maxX,this.maxY+t,this.maxZ)}dilatedZ(t){return new Cs(this.minX,this.minY,this.minZ-t,this.maxX,this.maxY,this.maxZ+t)}dilatedXYZ(t,s,r){return new Cs(this.minX-t,this.minY-s,this.minZ-r,this.maxX+t,this.maxY+s,this.maxZ+r)}eroded(t){return this.dilated(-t)}erodedX(t){return this.dilatedX(-t)}erodedY(t){return this.dilatedY(-t)}erodedZ(t){return this.dilatedZ(-t)}erodedXYZ(t,s,r){return this.dilatedXYZ(-t,-s,-r)}shiftedX(t){return new Cs(this.minX+t,this.minY,this.minZ,this.maxX+t,this.maxY,this.maxZ)}shiftedY(t){return new Cs(this.minX,this.minY+t,this.minZ,this.maxX,this.maxY+t,this.maxZ)}shiftedZ(t){return new Cs(this.minX,this.minY,this.minZ+t,this.maxX,this.maxY,this.maxZ+t)}shiftedXYZ(t,s,r){return new Cs(this.minX+t,this.minY+s,this.minZ+r,this.maxX+t,this.maxY+s,this.maxZ+r)}shifted(t){return this.shiftedXYZ(t.x,t.y,t.z)}setMinMax(t,s,r,o,n,l){return this.minX=t,this.minY=s,this.minZ=r,this.maxX=o,this.maxY=n,this.maxZ=l,this}setMinX(t){return this.minX=t,this}setMinY(t){return this.minY=t,this}setMinZ(t){return this.minZ=t,this}setMaxX(t){return this.maxX=t,this}setMaxY(t){return this.maxY=t,this}setMaxZ(t){return this.maxZ=t,this}set(t){return this.setMinMax(t.minX,t.minY,t.minZ,t.maxX,t.maxY,t.maxZ)}includeBounds(t){return this.setMinMax(Math.min(this.minX,t.minX),Math.min(this.minY,t.minY),Math.min(this.minZ,t.minZ),Math.max(this.maxX,t.maxX),Math.max(this.maxY,t.maxY),Math.max(this.maxZ,t.maxZ))}constrainBounds(t){return this.setMinMax(Math.max(this.minX,t.minX),Math.max(this.minY,t.minY),Math.max(this.minZ,t.minZ),Math.min(this.maxX,t.maxX),Math.min(this.maxY,t.maxY),Math.min(this.maxZ,t.maxZ))}addCoordinates(t,s,r){return this.setMinMax(Math.min(this.minX,t),Math.min(this.minY,s),Math.min(this.minZ,r),Math.max(this.maxX,t),Math.max(this.maxY,s),Math.max(this.maxZ,r))}addPoint(t){return this.addCoordinates(t.x,t.y,t.z)}roundOut(){return this.setMinMax(Math.floor(this.minX),Math.floor(this.minY),Math.floor(this.minZ),Math.ceil(this.maxX),Math.ceil(this.maxY),Math.ceil(this.maxZ))}roundIn(){return this.setMinMax(Math.ceil(this.minX),Math.ceil(this.minY),Math.ceil(this.minZ),Math.floor(this.maxX),Math.floor(this.maxY),Math.floor(this.maxZ))}transform(t){if(this.isEmpty())return this;if(t.isIdentity())return this;let s=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY,h=Number.NEGATIVE_INFINITY;const g=new Vector3(0,0,0);function d(A){s=Math.min(s,A.x),r=Math.min(r,A.y),o=Math.min(o,A.z),n=Math.max(n,A.x),l=Math.max(l,A.y),h=Math.max(h,A.z)}return d(t.multiplyVector3(g.setXYZ(this.minX,this.minY,this.minZ))),d(t.multiplyVector3(g.setXYZ(this.minX,this.maxY,this.minZ))),d(t.multiplyVector3(g.setXYZ(this.maxX,this.minY,this.minZ))),d(t.multiplyVector3(g.setXYZ(this.maxX,this.maxY,this.minZ))),d(t.multiplyVector3(g.setXYZ(this.minX,this.minY,this.maxZ))),d(t.multiplyVector3(g.setXYZ(this.minX,this.maxY,this.maxZ))),d(t.multiplyVector3(g.setXYZ(this.maxX,this.minY,this.maxZ))),d(t.multiplyVector3(g.setXYZ(this.maxX,this.maxY,this.maxZ))),this.setMinMax(s,r,o,n,l,h)}dilate(t){return this.dilateXYZ(t,t,t)}dilateX(t){return this.setMinMax(this.minX-t,this.minY,this.minZ,this.maxX+t,this.maxY,this.maxZ)}dilateY(t){return this.setMinMax(this.minX,this.minY-t,this.minZ,this.maxX,this.maxY+t,this.maxZ)}dilateZ(t){return this.setMinMax(this.minX,this.minY,this.minZ-t,this.maxX,this.maxY,this.maxZ+t)}dilateXYZ(t,s,r){return this.setMinMax(this.minX-t,this.minY-s,this.minZ-r,this.maxX+t,this.maxY+s,this.maxZ+r)}erode(t){return this.dilate(-t)}erodeX(t){return this.dilateX(-t)}erodeY(t){return this.dilateY(-t)}erodeZ(t){return this.dilateZ(-t)}erodeXYZ(t,s,r){return this.dilateXYZ(-t,-s,-r)}shiftX(t){return this.setMinMax(this.minX+t,this.minY,this.minZ,this.maxX+t,this.maxY,this.maxZ)}shiftY(t){return this.setMinMax(this.minX,this.minY+t,this.minZ,this.maxX,this.maxY+t,this.maxZ)}shiftZ(t){return this.setMinMax(this.minX,this.minY,this.minZ+t,this.maxX,this.maxY,this.maxZ+t)}shiftXYZ(t,s,r){return this.setMinMax(this.minX+t,this.minY+s,this.minZ+r,this.maxX+t,this.maxY+s,this.maxZ+r)}shift(t){return this.shiftXYZ(t.x,t.y,t.z)}static cuboid(t,s,r,o,n,l){return new Cs(t,s,r,t+o,s+n,r+l)}static point(t,s,r){return new Cs(t,s,r,t,s,r)}};Cs.NOTHING=new Cs(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),Cs.EVERYTHING=new Cs(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),Cs.Bounds3IO=new IOType("Bounds3IO",{valueType:Cs,documentation:"a 3-dimensional bounds (bounding box)",stateSchema:{minX:NumberIO,minY:NumberIO,minZ:NumberIO,maxX:NumberIO,maxY:NumberIO,maxZ:NumberIO},toStateObject:t=>({minX:t.minX,minY:t.minY,minZ:t.minZ,maxX:t.maxX,maxY:t.maxY,maxZ:t.maxZ}),fromStateObject:t=>new Cs(t.minX,t.minY,t.minZ,t.maxX,t.maxY,t.maxZ)});let Bounds3=Cs;dot.register("Bounds3",Bounds3);Poolable.mixInto(Bounds3,{initialize:Bounds3.prototype.setMinMax});class Combination{constructor(t){this.inclusions=t}size(){return this.inclusions.length}includes(t){return this.inclusions[t]}apply(t){return t.filter((s,r)=>this.inclusions[r])}inverted(){return new Combination(this.inclusions.map(t=>!t))}getIncludedIndices(){return _.range(0,this.size()).filter(t=>this.inclusions[t])}toString(){return`C[${this.inclusions.map(t=>t?"1":"0").join("")}]`}equals(t){return this.inclusions.length===t.inclusions.length&&_.isEqual(this.inclusions,t.inclusions)}static empty(t){return new Combination(_.range(0,t).map(()=>!1))}static full(t){return new Combination(_.range(0,t).map(()=>!0))}static combinations(t){const s=[],r=[];return function o(n){n===t?s.push(new Combination(r.slice())):(r.push(!1),o(n+1),r.pop(),r.push(!0),o(n+1),r.pop())}(0),s}static forEachCombination(t,s){const r=[];(function o(n){n===t.length?s(r):(o(n+1),r.push(t[n]),o(n+1),r.pop())})(0)}static combinationsOf(t){const s=[];return Combination.forEachCombination(t,r=>{s.push(r.slice())}),s}}dot.register("Combination",Combination);class CompletePiecewiseLinearFunction{constructor(t){assert&&assert(t.length>0),assert&&t.forEach((s,r)=>{r<t.length-1&&assert&&assert(s.x<t[r+1].x,"Points should be strictly increasing in x value (ordered by their x value)")}),this.points=t.slice();for(let s=0;s<this.points.length-2;s++){const r=this.points[s],o=this.points[s+1],n=this.points[s+2];DotUtils.arePointsCollinear(r,o,n)&&(this.points.splice(s+1,1),s--)}}findMatchingPair(t){assert&&assert(this.points.length>1);let s=0;for(;s<this.points.length-2&&this.points[s+1].x<t;)s++;return[this.points[s],this.points[s+1]]}evaluate(t){if(this.points.length===1)return this.points[0].y;{const[s,r]=this.findMatchingPair(t);return s.x===t?s.y:r.x===t?r.y:DotUtils.linear(s.x,r.x,s.y,r.y,t)}}getCombinedXValues(t){return CompletePiecewiseLinearFunction.sortedUniqueEpsilon(this.points.map(s=>s.x).concat(t.points.map(s=>s.x)))}getIntersectedXValues(t){const s=this.getCombinedXValues(t),r=[];for(let n=0;n<s.length-1;n++){const l=s[n],h=s[n+1],g=DotUtils.lineLineIntersection(new Vector2(l,this.evaluate(l)),new Vector2(h,this.evaluate(h)),new Vector2(l,t.evaluate(l)),new Vector2(h,t.evaluate(h)));g&&(n===0||g.x>l)&&(n===s.length-2||g.x<h)&&r.push(g.x)}const o=CompletePiecewiseLinearFunction.sortedUniqueEpsilon([...s,...r]);return[o[0]-1,...o,o[o.length-1]+1]}binaryXOperation(t,s,r){return new CompletePiecewiseLinearFunction(r.map(o=>new Vector2(o,s(this.evaluate(o),t.evaluate(o)))))}binaryPointwiseOperation(t,s){return this.binaryXOperation(t,s,this.getCombinedXValues(t))}binaryIntersectingOperation(t,s){return this.binaryXOperation(t,s,this.getIntersectedXValues(t))}plus(t){return this.binaryPointwiseOperation(t,(s,r)=>s+r)}minus(t){return this.binaryPointwiseOperation(t,(s,r)=>s-r)}min(t){return this.binaryIntersectingOperation(t,Math.min)}max(t){return this.binaryIntersectingOperation(t,Math.max)}withXValues(t){return new CompletePiecewiseLinearFunction(t.map(s=>new Vector2(s,this.evaluate(s))))}inverted(){const t=this.points.map(s=>new Vector2(s.y,s.x));return t.length>1&&t[0].x>t[1].x&&t.reverse(),new CompletePiecewiseLinearFunction(t)}static sum(...t){return t.reduce((s,r)=>s.plus(r))}static min(...t){return t.reduce((s,r)=>s.min(r))}static max(...t){return t.reduce((s,r)=>s.max(r))}static constant(t){return new CompletePiecewiseLinearFunction([new Vector2(0,t)])}static linear(t,s){return new CompletePiecewiseLinearFunction([new Vector2(0,s),new Vector2(1,t+s)])}static sortedUniqueEpsilon(t,s=1e-10){t=_.sortBy(t);for(let r=0;r<t.length-1;r++)Math.abs(t[r]-t[r+1])<s&&(t.splice(r,1),r--);return t}}dot.register("CompletePiecewiseLinearFunction",CompletePiecewiseLinearFunction);const $i=class $i{constructor(t,s){this.real=t,this.imaginary=s}copy(t){return t?t.set(this):new $i(this.real,this.imaginary)}phase(){return Math.atan2(this.imaginary,this.real)}getMagnitude(){return Math.sqrt(this.magnitudeSquared)}get magnitude(){return this.getMagnitude()}getMagnitudeSquared(){return this.real*this.real+this.imaginary*this.imaginary}get magnitudeSquared(){return this.getMagnitudeSquared()}getArgument(){return Math.atan2(this.imaginary,this.real)}get argument(){return this.getArgument()}equals(t){return this.real===t.real&&this.imaginary===t.imaginary}equalsEpsilon(t,s=0){return Math.max(Math.abs(this.real-t.real),Math.abs(this.imaginary-t.imaginary))<=s}plus(t){return new $i(this.real+t.real,this.imaginary+t.imaginary)}minus(t){return new $i(this.real-t.real,this.imaginary-t.imaginary)}times(t){return new $i(this.real*t.real-this.imaginary*t.imaginary,this.real*t.imaginary+this.imaginary*t.real)}dividedBy(t){const s=t.magnitudeSquared;return new $i((this.real*t.real+this.imaginary*t.imaginary)/s,(this.imaginary*t.real-this.real*t.imaginary)/s)}negated(){return new $i(-this.real,-this.imaginary)}sqrtOf(){const t=this.magnitude;return new $i(Math.sqrt((t+this.real)/2),(this.imaginary>=0?1:-1)*Math.sqrt((t-this.real)/2))}powerByReal(t){const s=Math.pow(this.magnitude,t),r=t*this.phase();return new $i(s*Math.cos(r),s*Math.sin(r))}sinOf(){return new $i(Math.sin(this.real)*DotUtils.cosh(this.imaginary),Math.cos(this.real)*DotUtils.sinh(this.imaginary))}cosOf(){return new $i(Math.cos(this.real)*DotUtils.cosh(this.imaginary),-Math.sin(this.real)*DotUtils.sinh(this.imaginary))}squared(){return this.times(this)}conjugated(){return new $i(this.real,-this.imaginary)}exponentiated(){return $i.createPolar(Math.exp(this.real),this.imaginary)}setRealImaginary(t,s){return this.real=t,this.imaginary=s,this}setReal(t){return this.real=t,this}setImaginary(t){return this.imaginary=t,this}set(t){return this.setRealImaginary(t.real,t.imaginary)}setPolar(t,s){return this.setRealImaginary(t*Math.cos(s),t*Math.sin(s))}add(t){return this.setRealImaginary(this.real+t.real,this.imaginary+t.imaginary)}subtract(t){return this.setRealImaginary(this.real-t.real,this.imaginary-t.imaginary)}multiply(t){return this.setRealImaginary(this.real*t.real-this.imaginary*t.imaginary,this.real*t.imaginary+this.imaginary*t.real)}divide(t){const s=t.magnitudeSquared;return this.setRealImaginary((this.real*t.real+this.imaginary*t.imaginary)/s,(this.imaginary*t.real-this.real*t.imaginary)/s)}negate(){return this.setRealImaginary(-this.real,-this.imaginary)}exponentiate(){return this.setPolar(Math.exp(this.real),this.imaginary)}square(){return this.multiply(this)}sqrt(){const t=this.magnitude;return this.setRealImaginary(Math.sqrt((t+this.real)/2),(this.imaginary>=0?1:-1)*Math.sqrt((t-this.real)/2))}sin(){return this.setRealImaginary(Math.sin(this.real)*DotUtils.cosh(this.imaginary),Math.cos(this.real)*DotUtils.sinh(this.imaginary))}cos(){return this.setRealImaginary(Math.cos(this.real)*DotUtils.cosh(this.imaginary),-Math.sin(this.real)*DotUtils.sinh(this.imaginary))}conjugate(){return this.setRealImaginary(this.real,-this.imaginary)}getCubeRoots(){const t=this.argument/3,s=this.magnitude,r=$i.real(Math.cbrt(s));return[r.times($i.imaginary(t).exponentiate()),r.times($i.imaginary(t+Math.PI*2/3).exponentiate()),r.times($i.imaginary(t-Math.PI*2/3).exponentiate())]}toString(){return`Complex(${this.real}, ${this.imaginary})`}static real(t){return new $i(t,0)}static imaginary(t){return new $i(0,t)}static createPolar(t,s){return new $i(t*Math.cos(s),t*Math.sin(s))}static solveLinearRoots(t,s){return t.equals($i.ZERO)?s.equals($i.ZERO)?null:[]:[s.dividedBy(t).negate()]}static solveQuadraticRoots(t,s,r){if(t.equals($i.ZERO))return $i.solveLinearRoots(s,r);const o=$i.real(2).multiply(t),n=s.times(s),l=$i.real(4).multiply(t).multiply(r),h=n.subtract(l).sqrt();return[h.minus(s).divide(o),h.negated().subtract(s).divide(o)]}static solveCubicRoots(t,s,r,o){if(t.equals($i.ZERO))return $i.solveQuadraticRoots(s,r,o);const n=t.times($i.real(3)).negate(),l=t.times(t),h=s.times(s),g=h.times(s),d=r.times(r),A=d.times(r),S=t.times(s).times(r),O=h,I=t.times(r).times($i.real(3)),W=g.times($i.real(2)).add(l.times(o).multiply($i.real(27))),L=S.times($i.real(9));if(O.equals(I)&&W.equals(L)){const fe=s.divide(n);return[fe,fe,fe]}const H=O.minus(I),Y=W.minus(L),Q=S.times(o).multiply($i.real(18)).add(h.times(d)),pe=g.times(o).multiply($i.real(4)).add(A.times(t).multiply($i.real(4))).add(l.times(o).multiply(o).multiply($i.real(27)));if(Q.equals(pe)){const fe=S.times($i.real(4)).subtract(g.plus(l.times(o).multiply($i.real(9)))).divide(t.times(H)),ye=t.times(o).multiply($i.real(9)).subtract(s.times(r)).divide(H.times($i.real(2)));return[fe,ye,ye]}let de;return O.equals(I)?de=Y:de=Y.plus(Y.times(Y).subtract(H.times(H).multiply(H).multiply($i.real(4))).sqrt()).divide($i.real(2)),de.getCubeRoots().map(fe=>s.plus(fe).add(H.dividedBy(fe)).divide(n))}};$i.ZERO=new $i(0,0),$i.ONE=new $i(1,0),$i.I=new $i(0,1);let Complex=$i;dot.register("Complex",Complex);function ccw(a,t,s){return t.minus(a).crossScalar(s.minus(a))}const ConvexHull2={grahamScan:(a,t)=>{if(a.length<=2)return a;let s=Number.POSITIVE_INFINITY,r=null;_.each(a,n=>{n.y<=s&&(n.y===s&&r?n.x<r.x&&(r=n):(s=n.y,r=n))}),a=_.sortBy(a,n=>n.minus(r).angle),a.splice(_.indexOf(a,r),1);const o=[r];return _.each(a,n=>{if(r.x===n.x&&r.y===n.y)return;function l(){if(o.length<2)return!1;const h=ccw(o[o.length-2],o[o.length-1],n);return t?h<0:h<=0}for(;l();)o.pop();o.push(n)}),o}};dot.register("ConvexHull2",ConvexHull2);const Fr=class Fr extends EnumerationValue{};Fr.OVER_DAMPED=new Fr,Fr.UNDER_DAMPED=new Fr,Fr.CRITICALLY_DAMPED=new Fr,Fr.UNKNOWN=new Fr,Fr.enumeration=new Enumeration(Fr);let SolutionType=Fr;class DampedHarmonic{constructor(t,s,r,o,n){assert&&assert(isFinite(t)&&t!==0),assert&&assert(isFinite(s)),assert&&assert(isFinite(r)&&r!==0),assert&&assert(isFinite(o)),assert&&assert(isFinite(n)),this.dampingConstant=s/t,this.angularFrequencySquared=r/t,assert&&assert(this.dampingConstant>=0,"a and b should share the same sign"),assert&&assert(this.angularFrequencySquared>0,"a and c should share the same sign"),this.discriminant=this.dampingConstant*this.dampingConstant-4*this.angularFrequencySquared,this.solutionType=SolutionType.UNKNOWN,this.c1=0,this.c2=0,Math.abs(this.discriminant)<1e-5?(this.solutionType=SolutionType.CRITICALLY_DAMPED,this.angularFrequency=Math.sqrt(this.angularFrequencySquared),this.c1=o,this.c2=n+this.angularFrequency*o):this.discriminant<0?(this.solutionType=SolutionType.UNDER_DAMPED,this.frequency=.5*Math.sqrt(-this.discriminant),this.c1=o,this.c2=this.dampingConstant*o/(2*this.frequency)+n/this.frequency):(this.solutionType=SolutionType.OVER_DAMPED,this.positiveRoot=.5*(-this.dampingConstant+Math.sqrt(this.discriminant)),this.negativeRoot=.5*(-this.dampingConstant-Math.sqrt(this.discriminant)),this.c2=(this.negativeRoot*o-n)/(this.negativeRoot-this.positiveRoot),this.c1=o-this.c2)}getValue(t){if(this.solutionType===SolutionType.CRITICALLY_DAMPED)return assert&&assert(this.angularFrequency!==void 0),(this.c1+this.c2*t)*Math.exp(-this.angularFrequency*t);if(this.solutionType===SolutionType.UNDER_DAMPED){assert&&assert(this.frequency!==void 0);const s=this.frequency*t;return Math.exp(-(this.dampingConstant/2)*t)*(this.c1*Math.cos(s)+this.c2*Math.sin(s))}else{if(this.solutionType===SolutionType.OVER_DAMPED)return assert&&assert(this.positiveRoot!==void 0),assert&&assert(this.negativeRoot!==void 0),this.c1*Math.exp(this.negativeRoot*t)+this.c2*Math.exp(this.positiveRoot*t);throw new Error("Unknown solution type?")}}getDerivative(t){if(this.solutionType===SolutionType.CRITICALLY_DAMPED)return assert&&assert(this.angularFrequency!==void 0),Math.exp(-this.angularFrequency*t)*(this.c2-this.angularFrequency*(this.c1+this.c2*t));if(this.solutionType===SolutionType.UNDER_DAMPED){assert&&assert(this.frequency!==void 0);const s=this.frequency*t,r=Math.cos(s),o=Math.sin(s),n=this.frequency*(this.c2*r-this.c1*o),l=.5*this.dampingConstant*(this.c1*r+this.c2*o);return Math.exp(-.5*this.dampingConstant*t)*(n-l)}else{if(this.solutionType===SolutionType.OVER_DAMPED)return assert&&assert(this.positiveRoot!==void 0),assert&&assert(this.negativeRoot!==void 0),this.c1*this.negativeRoot*Math.exp(this.negativeRoot*t)+this.c2*this.positiveRoot*Math.exp(this.positiveRoot*t);throw new Error("Unknown solution type?")}}}dot.register("DampedHarmonic",DampedHarmonic);class DelaunayTriangulation{constructor(t,s,r){r=merge({},r);let o;if(this.points=t,this.constraints=s,this.triangles=[],this.edges=[],this.convexHull=[],t.length===0)return;for(this.vertices=t.map((h,g)=>(assert&&assert(h instanceof Vector2&&h.isFinite()),new Vertex$1(h,g))),o=0;o<this.constraints.length;o++){const h=this.constraints[o],g=h[0],d=h[1];assert&&assert(typeof g=="number"&&isFinite(g)&&g%1===0&&g>=0&&g<t.length),assert&&assert(typeof d=="number"&&isFinite(d)&&d%1===0&&d>=0&&d<t.length),assert&&assert(g!==d),this.vertices[g].constrainedVertices.push(this.vertices[d])}for(this.vertices.sort(DelaunayTriangulation.vertexComparison),o=0;o<this.vertices.length;o++){const h=this.vertices[o];h.sortedIndex=o;for(let g=h.constrainedVertices.length-1;g>=0;g--){const d=h.constrainedVertices[g];d.sortedIndex===-1&&(d.constrainedVertices.push(h),h.constrainedVertices.splice(g,1))}}this.bottomVertex=this.vertices[0],this.remainingVertices=this.vertices.slice(1);const n=Bounds2.NOTHING.copy();for(o=t.length-1;o>=0;o--)n.addPoint(t[o]);const l=.4;this.artificialMinVertex=new Vertex$1(new Vector2(n.minX-n.width*l,n.minY-n.height*l),-1),this.artificialMaxVertex=new Vertex$1(new Vector2(n.maxX+n.width*l,n.minY-n.height*l),-2),this.edges.push(new Edge$1(this.artificialMinVertex,this.artificialMaxVertex)),this.edges.push(new Edge$1(this.artificialMaxVertex,this.bottomVertex)),this.edges.push(new Edge$1(this.bottomVertex,this.artificialMinVertex)),this.triangles.push(new Triangle(this.artificialMinVertex,this.artificialMaxVertex,this.bottomVertex,this.edges[1],this.edges[2],this.edges[0])),this.firstFrontEdge=this.edges[1],this.edges[1].connectAfter(this.edges[2]),this.firstHullEdge=this.edges[0]}step(){const t=this.remainingVertices.shift(),s=t.point.x;let r=this.firstFrontEdge;for(;r;){if(s>r.endVertex.point.x){const o=new Edge$1(r.startVertex,t),n=new Edge$1(t,r.endVertex);o.connectAfter(n),this.edges.push(o),this.edges.push(n),this.triangles.push(new Triangle(r.endVertex,r.startVertex,t,o,n,r)),this.reconnectFrontEdges(r,r,o,n),this.legalizeEdge(r),this.addHalfPiHeuristic(o,n),this.constrainEdges(t,o,n);break}else if(s===r.endVertex.point.x){const o=r.nextEdge,n=r;assert&&assert(o!==null);const l=r.endVertex,h=o.endVertex,g=n.startVertex,d=new Edge$1(t,h),A=new Edge$1(g,t),S=new Edge$1(l,t);A.connectAfter(d),this.edges.push(d),this.edges.push(A),this.edges.push(S),this.triangles.push(new Triangle(h,l,t,S,d,o)),this.triangles.push(new Triangle(l,g,t,A,S,n)),this.reconnectFrontEdges(n,o,A,d),this.legalizeEdge(o),this.legalizeEdge(n),this.legalizeEdge(S),this.addHalfPiHeuristic(A,d),this.constrainEdges(t,A,d);break}r=r.nextEdge}}fillBorderTriangle(t,s,r,o,n){assert&&assert(t instanceof Edge$1),assert&&assert(s instanceof Edge$1),assert&&assert(r instanceof Vertex$1),assert&&assert(o instanceof Vertex$1),assert&&assert(n instanceof Vertex$1),assert&&assert(o===t.startVertex||o===t.endVertex,"middleVertex should be in firstEdge"),assert&&assert(o===s.startVertex||o===s.endVertex,"middleVertex should be in secondEdge"),assert&&assert(r===t.startVertex||r===t.endVertex,"firstSideVertex should be in firstEdge"),assert&&assert(n===s.startVertex||n===s.endVertex,"secondSideVertex should be in secondEdge");const l=new Edge$1(r,n);return this.edges.push(l),this.triangles.push(new Triangle(n,o,r,t,l,s)),this.legalizeEdge(t),this.legalizeEdge(s),l}reconnectFrontEdges(t,s,r,o){const n=t.previousEdge,l=s.nextEdge;n?(n.disconnectAfter(),n.connectAfter(r)):this.firstFrontEdge=r,l&&(s.disconnectAfter(),o.connectAfter(l))}addHalfPiHeuristic(t,s){assert&&assert(t.endVertex===s.startVertex);const r=t.endVertex;for(;t.previousEdge&&DotUtils.triangleAreaSigned(r.point,t.startVertex.point,t.previousEdge.startVertex.point)>0&&r.point.minus(t.startVertex.point).angleBetween(t.previousEdge.startVertex.point.minus(t.startVertex.point))<Math.PI/2;){const o=t.previousEdge,n=new Edge$1(o.startVertex,r);this.edges.push(n),this.triangles.push(new Triangle(r,t.startVertex,o.startVertex,o,n,t)),this.reconnectFrontEdges(o,t,n,n),this.legalizeEdge(o),this.legalizeEdge(t),t=n}for(;s.nextEdge&&DotUtils.triangleAreaSigned(r.point,s.nextEdge.endVertex.point,s.endVertex.point)>0&&r.point.minus(s.endVertex.point).angleBetween(s.nextEdge.endVertex.point.minus(s.endVertex.point))<Math.PI/2;){const o=s.nextEdge,n=new Edge$1(r,o.endVertex);this.edges.push(n),this.triangles.push(new Triangle(r,s.nextEdge.endVertex,s.endVertex,o,s,n)),this.reconnectFrontEdges(s,o,n,n),this.legalizeEdge(o),this.legalizeEdge(s),s=n}}constrainEdges(t,s,r){assert&&assert(t instanceof Vertex$1),assert&&assert(s instanceof Edge$1),assert&&assert(r instanceof Edge$1),assert&&assert(t===s.endVertex),assert&&assert(t===r.startVertex);for(let o=0;o<t.constrainedVertices.length;o++){const n=t.constrainedVertices[o];if(n===s.startVertex||n===r.endVertex)break;const l=[],h=[];let g=null,d=null;const A=[],S=[];let O=DelaunayTriangulation.vertexProduct(t,s.startVertex,n)>0,I=DelaunayTriangulation.vertexProduct(t,r.endVertex,n)<0;if(!O&&!I){assert&&assert(s.triangles.length===1),assert&&assert(r.triangles.length===1);let L=s.startVertex,H;for(g=s.triangles[0];DelaunayTriangulation.vertexProduct(t,H=g.getEdgeOppositeFromVertex(t).getOtherVertex(L),n)<0;)g=g.getEdgeOppositeFromVertex(L).getOtherTriangle(g),L=H;if(g.hasVertex(n))break;A.push(g),d=g.getEdgeOppositeFromVertex(t),S.push(d),l.push(g.getEdgeOppositeFromVertex(L)),h.push(g.getEdgeOppositeFromVertex(d.getOtherVertex(L))),assert&&assert(l[0].getOtherVertex(t).point.x<h[0].getOtherVertex(t).point.x)}for(;!O;){if(I)break;if(d.triangles.length>1){const L=d.getOtherTriangle(g);if(L.hasVertex(n)){A.push(L),l.push(L.getNextEdge(d)),h.push(L.getPreviousEdge(d));break}else{let H;L.aEdge!==d&&L.aEdge.intersectsConstrainedEdge(t,n)?H=L.aEdge:L.bEdge!==d&&L.bEdge.intersectsConstrainedEdge(t,n)?H=L.bEdge:L.cEdge!==d&&L.cEdge.intersectsConstrainedEdge(t,n)&&(H=L.cEdge),assert&&assert(H),L.getNextEdge(H)===d?l.push(L.getPreviousEdge(H)):h.push(L.getNextEdge(H)),d=H,S.push(d),g=L,A.push(g)}}else n.point.x<t.point.x?I=!0:O=!0}for(let L=0;L<A.length;L++){const H=A[L];arrayRemove(this.triangles,H),H.remove()}for(let L=0;L<S.length;L++)arrayRemove(this.edges,S[L]);const W=new Edge$1(n,t);W.isConstrained=!0,this.edges.push(W),l.push(W),h.push(W),h.reverse(),window.triDebug&&window.triDebug(this),this.triangulatePolygon(l),this.triangulatePolygon(h)}}triangulatePolygon(t){for(;t.length>3;){for(let s=0;s<t.length;s++){const r=s<t.length-1?s+1:0;assert&&assert(t[s].getSharedVertex(t[r]))}for(let s=0;s<t.length;s++){const r=s<t.length-1?s+1:0,o=t[s],n=t[r],l=o.getSharedVertex(n),h=o.getOtherVertex(l),g=n.getOtherVertex(l);if(DotUtils.triangleAreaSigned(h.point,l.point,g.point)<=0)continue;const d=g.point.minus(l.point),A=h.point.minus(l.point),S=d.dot(d),O=d.dot(A),I=A.dot(A),W=S*I-O*O;let L=t[0].getSharedVertex(t[t.length-1]),H=!1;for(let Y=0;Y<t.length;Y++){const Q=t[Y].getOtherVertex(L);if(Q!==l&&Q!==h&&Q!==g){const pe=Q.point.minus(l.point),de=d.dot(pe),fe=A.dot(pe),ye=(I*de-O*fe)/W,Ee=(S*fe-O*de)/W;if(ye>=-1e-10&&Ee>=-1e-10&&ye+Ee<1+1e-10){H=!0;break}}L=Q}if(!H){const Y=new Edge$1(h,g);this.edges.push(Y),this.triangles.push(new Triangle(h,l,g,n,Y,o)),r>s?t.splice(s,2,Y):(t.splice(s,1,Y),t.splice(r,1)),window.triDebug&&window.triDebug(this)}}}t.length===3&&(this.triangles.push(new Triangle(t[0].getSharedVertex(t[1]),t[1].getSharedVertex(t[2]),t[0].getSharedVertex(t[2]),t[2],t[0],t[1])),window.triDebug&&window.triDebug(this))}finalize(){const t=[];let s=this.firstFrontEdge.nextEdge;for(;s&&s.nextEdge;)t.push(s),s=s.nextEdge;const r=this.firstFrontEdge,o=s;assert&&assert(this.firstFrontEdge.triangles.length===1),assert&&assert(o.triangles.length===1);for(let g=0;g<t.length-1;g++){const d=t[g],A=t[g+1];if(DotUtils.triangleAreaSigned(A.endVertex.point,d.endVertex.point,d.startVertex.point)>1e-10){const S=this.fillBorderTriangle(d,A,d.startVertex,d.endVertex,A.endVertex);t.splice(g,2,S),g=Math.max(g-2,-1),window.triDebug&&window.triDebug(this)}}this.firstFrontEdge=null;const n=[],l=[r];let h=r;for(;h!==o;){const g=h.triangles[0];g.remove(),arrayRemove(this.triangles,g);const d=g.getNonArtificialEdge();if(d){n.push(d);const A=d.getSharedVertex(h);h=g.getEdgeOppositeFromVertex(A)}else assert&&assert(h.startVertex===this.artificialMaxVertex),l.push(g.getEdgeOppositeFromVertex(h.endVertex)),h=g.getEdgeOppositeFromVertex(h.startVertex);l.push(h)}for(let g=0;g<l.length;g++)arrayRemove(this.edges,l[g]);window.triDebug&&window.triDebug(this);for(let g=0;g<n.length-1;g++){const d=n[g+1],A=n[g],S=d.getSharedVertex(A),O=d.getOtherVertex(S),I=A.getOtherVertex(S);if(DotUtils.triangleAreaSigned(I.point,S.point,O.point)>1e-10){const W=this.fillBorderTriangle(d,A,O,S,I);n.splice(g,2,W),g=Math.max(g-2,-1),window.triDebug&&window.triDebug(this)}}for(let g=0;g<t.length;g++)this.convexHull.push(t[g].startVertex);this.convexHull.push(t[t.length-1].endVertex);for(let g=n.length-1;g>=1;g--)this.convexHull.push(n[g].getSharedVertex(n[g-1]))}legalizeEdge(t){if(!_.includes(this.edges,t)||t.triangles.length!==2||t.isConstrained)return;const s=t.triangles[0],r=t.triangles[1],o=s.getVertexOppositeFromEdge(t),n=r.getVertexOppositeFromEdge(t);if(DotUtils.pointInCircleFromPoints(s.aVertex.point,s.bVertex.point,s.cVertex.point,n.point)||DotUtils.pointInCircleFromPoints(r.aVertex.point,r.bVertex.point,r.cVertex.point,o.point)){s.remove(),r.remove(),arrayRemove(this.triangles,s),arrayRemove(this.triangles,r),arrayRemove(this.edges,t);const l=new Edge$1(o,n);this.edges.push(l);const h=r.getEdgeOppositeFromVertex(r.getVertexBefore(n)),g=s.getEdgeOppositeFromVertex(s.getVertexAfter(o)),d=s.getEdgeOppositeFromVertex(s.getVertexBefore(o)),A=r.getEdgeOppositeFromVertex(r.getVertexAfter(n));this.triangles.push(new Triangle(o,n,s.getVertexBefore(o),h,g,l)),this.triangles.push(new Triangle(n,o,r.getVertexBefore(n),d,A,l)),this.legalizeEdge(h),this.legalizeEdge(g),this.legalizeEdge(d),this.legalizeEdge(A)}}static vertexComparison(t,s){return assert&&assert(t instanceof Vertex$1),assert&&assert(s instanceof Vertex$1),t=t.point,s=s.point,t.y<s.y?-1:t.y>s.y?1:t.x<s.x?-1:t.x>s.x?1:0}static vertexProduct(t,s,r){const o=s.point.minus(t.point),n=r.point.minus(t.point);return o.crossScalar(n)}}dot.register("DelaunayTriangulation",DelaunayTriangulation);let Vertex$1=class{constructor(t,s){assert&&assert(t instanceof Vector2),assert&&assert(t.isFinite()),assert&&assert(typeof s=="number"),this.point=t,this.index=s,this.sortedIndex=-1,this.constrainedVertices=[]}isArtificial(){return this.index<0}},Edge$1=class Mh{constructor(t,s){assert&&assert(t instanceof Vertex$1),assert&&assert(s instanceof Vertex$1),assert&&assert(t!==s,"Should be different vertices"),this.startVertex=t,this.endVertex=s,this.triangles=[],this.nextEdge=null,this.previousEdge=null,this.isConstrained=!1}isArtificial(){return this.startVertex.isArtificial()||this.endVertex.isArtificial()}connectAfter(t){assert&&assert(t instanceof Mh),assert&&assert(this.endVertex===t.startVertex),this.nextEdge=t,t.previousEdge=this}disconnectAfter(){this.nextEdge.previousEdge=null,this.nextEdge=null}addTriangle(t){assert&&assert(t instanceof Triangle),assert&&assert(this.triangles.length<=1),this.triangles.push(t)}removeTriangle(t){assert&&assert(t instanceof Triangle),assert&&assert(_.includes(this.triangles,t)),arrayRemove(this.triangles,t)}getSharedTriangle(t){assert&&assert(t instanceof Mh);for(let s=0;s<this.triangles.length;s++){const r=this.triangles[s];for(let o=0;o<t.triangles.length;o++)if(t.triangles[o]===r)return r}throw new Error("No common triangle")}getSharedVertex(t){return assert&&assert(t instanceof Mh),this.startVertex===t.startVertex||this.startVertex===t.endVertex?this.startVertex:(assert&&assert(this.endVertex===t.startVertex||this.endVertex===t.endVertex),this.endVertex)}getOtherVertex(t){return assert&&assert(t instanceof Vertex$1),assert&&assert(t===this.startVertex||t===this.endVertex),t===this.startVertex?this.endVertex:this.startVertex}getOtherTriangle(t){return assert&&assert(t instanceof Triangle),assert&&assert(this.triangles.length===2),this.triangles[0]===t?this.triangles[1]:this.triangles[0]}intersectsConstrainedEdge(t,s){return DotUtils.lineSegmentIntersection(t.point.x,t.point.y,s.point.x,s.point.y,this.startVertex.point.x,this.startVertex.point.y,this.endVertex.point.x,this.endVertex.point.y)}};class Triangle{constructor(t,s,r,o,n,l){assert&&assert(t instanceof Vertex$1),assert&&assert(s instanceof Vertex$1),assert&&assert(r instanceof Vertex$1),assert&&assert(o instanceof Edge$1),assert&&assert(n instanceof Edge$1),assert&&assert(l instanceof Edge$1),assert&&assert(t!==o.startVertex&&t!==o.endVertex,"Should be an opposite edge"),assert&&assert(s!==n.startVertex&&s!==n.endVertex,"Should be an opposite edge"),assert&&assert(r!==l.startVertex&&r!==l.endVertex,"Should be an opposite edge"),assert&&assert(t===n.startVertex||t===n.endVertex,"aVertex should be in bEdge"),assert&&assert(t===l.startVertex||t===l.endVertex,"aVertex should be in cEdge"),assert&&assert(s===o.startVertex||s===o.endVertex,"bVertex should be in aEdge"),assert&&assert(s===l.startVertex||s===l.endVertex,"bVertex should be in cEdge"),assert&&assert(r===o.startVertex||r===o.endVertex,"cVertex should be in aEdge"),assert&&assert(r===n.startVertex||r===n.endVertex,"cVertex should be in bEdge"),assert&&assert(DotUtils.triangleAreaSigned(t.point,s.point,r.point)>0,"Should be counterclockwise"),this.aVertex=t,this.bVertex=s,this.cVertex=r,this.aEdge=o,this.bEdge=n,this.cEdge=l,this.aEdge.addTriangle(this),this.bEdge.addTriangle(this),this.cEdge.addTriangle(this)}hasVertex(t){return this.aVertex===t||this.bVertex===t||this.cVertex===t}getVertexOppositeFromEdge(t){return assert&&assert(t instanceof Edge$1),assert&&assert(t===this.aEdge||t===this.bEdge||t===this.cEdge,"Should be an edge that is part of this triangle"),t===this.aEdge?this.aVertex:t===this.bEdge?this.bVertex:this.cVertex}getEdgeOppositeFromVertex(t){return assert&&assert(t instanceof Vertex$1),assert&&assert(t===this.aVertex||t===this.bVertex||t===this.cVertex,"Should be a vertex that is part of this triangle"),t===this.aVertex?this.aEdge:t===this.bVertex?this.bEdge:this.cEdge}getVertexBefore(t){return assert&&assert(t instanceof Vertex$1),assert&&assert(t===this.aVertex||t===this.bVertex||t===this.cVertex),t===this.aVertex?this.cVertex:t===this.bVertex?this.aVertex:this.bVertex}getVertexAfter(t){return assert&&assert(t instanceof Vertex$1),assert&&assert(t===this.aVertex||t===this.bVertex||t===this.cVertex),t===this.aVertex?this.bVertex:t===this.bVertex?this.cVertex:this.aVertex}getNonArtificialEdge(){return assert&&assert(this.aEdge.isArtificial()&&this.bEdge.isArtificial()&&!this.cEdge.isArtificial()||this.aEdge.isArtificial()&&!this.bEdge.isArtificial()&&this.cEdge.isArtificial()||!this.aEdge.isArtificial()&&this.bEdge.isArtificial()&&this.cEdge.isArtificial()||this.aEdge.isArtificial()&&this.bEdge.isArtificial()&&this.cEdge.isArtificial(),"At most one edge should be non-artificial"),this.aEdge.isArtificial()?this.bEdge.isArtificial()?this.cEdge.isArtificial()?null:this.cEdge:this.bEdge:this.aEdge}getNextEdge(t){if(assert&&assert(t===this.aEdge||t===this.bEdge||t===this.cEdge),this.aEdge===t)return this.bEdge;if(this.bEdge===t)return this.cEdge;if(this.cEdge===t)return this.aEdge;throw new Error("illegal edge")}getPreviousEdge(t){if(assert&&assert(t===this.aEdge||t===this.bEdge||t===this.cEdge),this.aEdge===t)return this.cEdge;if(this.bEdge===t)return this.aEdge;if(this.cEdge===t)return this.bEdge;throw new Error("illegal edge")}isArtificial(){return this.aVertex.isArtificial()||this.bVertex.isArtificial()||this.cVertex.isArtificial()}remove(){this.aEdge.removeTriangle(this),this.bEdge.removeTriangle(this),this.cEdge.removeTriangle(this)}}const STATE_SCHEMA={width:InfiniteNumberIO,height:InfiniteNumberIO},Ko=class Ko{constructor(t,s){this.width=t,this.height=s}toString(){return`[${this.width}w, ${this.height}h]`}set(t){return this.width=t.width,this.height=t.height,this}setWidth(t){return this.width=t,this}setHeight(t){return this.height=t,this}copy(t){return t?t.set(this):new Ko(this.width,this.height)}swapped(){return new Ko(this.height,this.width)}toBounds(t,s){return t=t!==void 0?t:0,s=s!==void 0?s:0,new Bounds2(t,s,this.width+t,this.height+s)}equals(t){return this.width===t.width&&this.height===t.height}toStateObject(){return{width:InfiniteNumberIO.toStateObject(this.width),height:InfiniteNumberIO.toStateObject(this.height)}}static fromStateObject(t){return new Ko(InfiniteNumberIO.fromStateObject(t.width),InfiniteNumberIO.fromStateObject(t.height))}};Ko.Dimension2IO=new IOType("Dimension2IO",{valueType:Ko,documentation:'A dimension with "width" and "height" members.',stateSchema:STATE_SCHEMA,toStateObject:t=>t.toStateObject(),fromStateObject:t=>Ko.fromStateObject(t)});let Dimension2=Ko;dot.register("Dimension2",Dimension2);const Il=class Il{constructor(t){this.seed=null,this.seedrandom=null,this.numberOfCalls=0;const s=optionize()({seed:null},t);this.setSeed(s.seed),Il.allRandomInstances.add(this)}dispose(){Il.allRandomInstances.delete(this)}getSeed(){return this.seed}nextBoolean(){return this.nextDouble()>=.5}nextInt(t){const s=this.nextDouble()*t;return Math.floor(s)}nextIntBetween(t,s){assert&&assert(Number.isInteger(t),`min must be an integer: ${t}`),assert&&assert(Number.isInteger(s),`max must be an integer: ${s}`);const r=s-t;return this.nextInt(r+1)+t}sample(t){assert&&assert(t.length>0,"Array should have at least 1 item.");const s=this.nextIntBetween(0,t.length-1);return t[s]}shuffle(t){let s=-1;const r=new Array(t.length);return _.forEach(t,o=>{const n=this.nextIntBetween(0,++s);r[s]=r[n],r[n]=o}),r}nextDouble(){return this.numberOfCalls++,this.seedrandom()}nextDoubleBetween(t,s){assert&&assert(t<s,"min must be < max");const r=t+this.nextDouble()*(s-t);return assert&&assert(r>=t&&r<s,`value out of range: ${r}`),r}nextGaussian(){return DotUtils.boxMullerTransform(0,1,this)}nextDoubleInRange(t){return t.min<t.max?this.nextDoubleBetween(t.min,t.max):t.min}nextPointInBounds(t){return new Vector2(this.nextDoubleBetween(t.minX,t.maxX),this.nextDoubleBetween(t.minY,t.maxY))}setSeed(t){typeof t=="number"?assert&&assert(Math.seedrandom,"If a seed is specified, then we must also have Math.seedrandom to use the seed."):t=Math.random(),this.seed=t,this.seedrandom=Math.seedrandom?new Math.seedrandom(`${t}`):()=>Math.random()}sampleProbabilities(t){const r=_.sum(t)*this.nextDouble();let o=0;for(let n=0;n<t.length;n++)if(o+=t[n],o>=r)return n;return assert&&assert(t[t.length-1]!==0,"if last weight is zero, should have selected something beforehand"),t.length-1}};Il.allRandomInstances=new Set;let Random=Il;dot.register("Random",Random);const dotRandom=new Random({seed:_.hasIn(window,"phet.chipper.queryParameters.randomSeed")?window.phet.chipper.queryParameters.randomSeed:null});dot.register("dotRandom",dotRandom);const ArrayType$4=window.Float64Array||Array;class LUDecomposition{constructor(t){let s,r,o;this.matrix=t,this.LU=t.getArrayCopy();const n=this.LU;this.m=t.getRowDimension();const l=this.m;this.n=t.getColumnDimension();const h=this.n;for(this.piv=new Uint32Array(l),s=0;s<l;s++)this.piv[s]=s;this.pivsign=1;const g=new ArrayType$4(l);for(r=0;r<h;r++){for(s=0;s<l;s++)g[s]=n[t.index(s,r)];for(s=0;s<l;s++){const A=Math.min(s,r);let S=0;for(o=0;o<A;o++){const O=t.index(s,o);S+=n[O]*g[o]}g[s]-=S,n[t.index(s,r)]=g[s]}let d=r;for(s=r+1;s<l;s++)Math.abs(g[s])>Math.abs(g[d])&&(d=s);if(d!==r){for(o=0;o<h;o++){const A=t.index(d,o),S=t.index(r,o),O=n[A];n[A]=n[S],n[S]=O}o=this.piv[d],this.piv[d]=this.piv[r],this.piv[r]=o,this.pivsign=-this.pivsign}if(r<l&&n[this.matrix.index(r,r)]!==0)for(s=r+1;s<l;s++)n[t.index(s,r)]/=n[t.index(r,r)]}}isNonsingular(){for(let t=0;t<this.n;t++){const s=this.matrix.index(t,t);if(this.LU[s]===0)return!1}return!0}getL(){const t=new Matrix$1(this.m,this.n);for(let s=0;s<this.m;s++)for(let r=0;r<this.n;r++)s>r?t.entries[t.index(s,r)]=this.LU[this.matrix.index(s,r)]:s===r?t.entries[t.index(s,r)]=1:t.entries[t.index(s,r)]=0;return t}getU(){const t=new Matrix$1(this.n,this.n);for(let s=0;s<this.n;s++)for(let r=0;r<this.n;r++)s<=r?t.entries[t.index(s,r)]=this.LU[this.matrix.index(s,r)]:t.entries[t.index(s,r)]=0;return t}getPivot(){const t=new Uint32Array(this.m);for(let s=0;s<this.m;s++)t[s]=this.piv[s];return t}getDoublePivot(){const t=new ArrayType$4(this.m);for(let s=0;s<this.m;s++)t[s]=this.piv[s];return t}det(){if(this.m!==this.n)throw new Error("Matrix must be square.");let t=this.pivsign;for(let s=0;s<this.n;s++)t*=this.LU[this.matrix.index(s,s)];return t}solve(t){let s,r,o;if(t.getRowDimension()!==this.m)throw new Error("Matrix row dimensions must agree.");if(!this.isNonsingular())throw new Error("Matrix is singular.");const n=t.getColumnDimension(),l=t.getArrayRowMatrix(this.piv,0,n-1);for(o=0;o<this.n;o++)for(s=o+1;s<this.n;s++)for(r=0;r<n;r++)l.entries[l.index(s,r)]-=l.entries[l.index(o,r)]*this.LU[this.matrix.index(s,o)];for(o=this.n-1;o>=0;o--){for(r=0;r<n;r++)l.entries[l.index(o,r)]/=this.LU[this.matrix.index(o,o)];for(s=0;s<o;s++)for(r=0;r<n;r++)l.entries[l.index(s,r)]-=l.entries[l.index(o,r)]*this.LU[this.matrix.index(s,o)]}return l}}dot.register("LUDecomposition",LUDecomposition);const ArrayType$3=window.Float64Array||Array;class QRDecomposition{constructor(t){this.matrix=t,this.QR=t.getArrayCopy();const s=this.QR;this.m=t.getRowDimension();const r=this.m;this.n=t.getColumnDimension();const o=this.n;this.Rdiag=new ArrayType$3(o);let n,l,h;for(h=0;h<o;h++){let g=0;for(n=h;n<r;n++)g=Matrix$1.hypot(g,s[this.matrix.index(n,h)]);if(g!==0){for(s[this.matrix.index(h,h)]<0&&(g=-g),n=h;n<r;n++)s[this.matrix.index(n,h)]/=g;for(s[this.matrix.index(h,h)]+=1,l=h+1;l<o;l++){let d=0;for(n=h;n<r;n++)d+=s[this.matrix.index(n,h)]*s[this.matrix.index(n,l)];for(d=-d/s[this.matrix.index(h,h)],n=h;n<r;n++)s[this.matrix.index(n,l)]+=d*s[this.matrix.index(n,h)]}}this.Rdiag[h]=-g}}isFullRank(){for(let t=0;t<this.n;t++)if(this.Rdiag[t]===0)return!1;return!0}getH(){const t=new Matrix$1(this.m,this.n);for(let s=0;s<this.m;s++)for(let r=0;r<this.n;r++)s>=r?t.entries[t.index(s,r)]=this.QR[this.matrix.index(s,r)]:t.entries[t.index(s,r)]=0;return t}getR(){const t=new Matrix$1(this.n,this.n);for(let s=0;s<this.n;s++)for(let r=0;r<this.n;r++)s<r?t.entries[t.index(s,r)]=this.QR[this.matrix.index(s,r)]:s===r?t.entries[t.index(s,r)]=this.Rdiag[s]:t.entries[t.index(s,r)]=0;return t}getQ(){let t,s,r;const o=new Matrix$1(this.m,this.n);for(r=this.n-1;r>=0;r--){for(t=0;t<this.m;t++)o.entries[o.index(t,r)]=0;for(o.entries[o.index(r,r)]=1,s=r;s<this.n;s++)if(this.QR[this.matrix.index(r,r)]!==0){let n=0;for(t=r;t<this.m;t++)n+=this.QR[this.matrix.index(t,r)]*o.entries[o.index(t,s)];for(n=-n/this.QR[this.matrix.index(r,r)],t=r;t<this.m;t++)o.entries[o.index(t,s)]+=n*this.QR[this.matrix.index(t,r)]}}return o}solve(t){if(t.getRowDimension()!==this.m)throw new Error("Matrix row dimensions must agree.");if(!this.isFullRank())throw new Error("Matrix is rank deficient.");let s,r,o;const n=t.getColumnDimension(),l=t.getArrayCopy();for(o=0;o<this.n;o++)for(r=0;r<n;r++){let h=0;for(s=o;s<this.m;s++)h+=this.QR[this.matrix.index(s,o)]*l[t.index(s,r)];for(h=-h/this.QR[this.matrix.index(o,o)],s=o;s<this.m;s++)l[t.index(s,r)]+=h*this.QR[this.matrix.index(s,o)]}for(o=this.n-1;o>=0;o--){for(r=0;r<n;r++)l[t.index(o,r)]/=this.Rdiag[o];for(s=0;s<o;s++)for(r=0;r<n;r++)l[t.index(s,r)]-=l[t.index(o,r)]*this.QR[this.matrix.index(s,o)]}return new Matrix$1(this.n,n,l,!0).getMatrix(0,this.n-1,0,n-1)}}dot.register("QRDecomposition",QRDecomposition);const ArrayType$2=window.Float64Array||Array;class SingularValueDecomposition{constructor(t){this.matrix=t;const s=t,r=s.getArrayCopy();this.m=s.getRowDimension(),this.n=s.getColumnDimension();const o=this.m,n=this.n,l=Math.min,h=Math.max,g=Math.pow,d=Math.abs,A=l(o,n);this.s=new ArrayType$2(l(o+1,n));const S=this.s;this.U=new ArrayType$2(o*A);const O=this.U;this.V=new ArrayType$2(n*n);const I=this.V,W=new ArrayType$2(n),L=new ArrayType$2(o);let H,Y,Q,pe,de,fe,ye;const Ee=Matrix$1.hypot,Le=l(o-1,n),Z=h(0,l(n-2,o));for(Q=0;Q<h(Le,Z);Q++){if(Q<Le){for(S[Q]=0,H=Q;H<o;H++)S[Q]=Ee(S[Q],r[H*n+Q]);if(S[Q]!==0){for(r[Q*n+Q]<0&&(S[Q]=-S[Q]),H=Q;H<o;H++)r[H*n+Q]/=S[Q];r[Q*n+Q]+=1}S[Q]=-S[Q]}for(Y=Q+1;Y<n;Y++){if(Q<Le&&S[Q]!==0){for(pe=0,H=Q;H<o;H++)pe+=r[H*n+Q]*r[H*n+Y];for(pe=-pe/r[Q*n+Q],H=Q;H<o;H++)r[H*n+Y]+=pe*r[H*n+Q]}W[Y]=r[Q*n+Y]}if(Q<Le)for(H=Q;H<o;H++)O[H*A+Q]=r[H*n+Q];if(Q<Z){for(W[Q]=0,H=Q+1;H<n;H++)W[Q]=Ee(W[Q],W[H]);if(W[Q]!==0){for(W[Q+1]<0&&(W[Q]=-W[Q]),H=Q+1;H<n;H++)W[H]/=W[Q];W[Q+1]+=1}if(W[Q]=-W[Q],Q+1<o&&W[Q]!==0){for(H=Q+1;H<o;H++)L[H]=0;for(Y=Q+1;Y<n;Y++)for(H=Q+1;H<o;H++)L[H]+=W[Y]*r[H*n+Y];for(Y=Q+1;Y<n;Y++)for(pe=-W[Y]/W[Q+1],H=Q+1;H<o;H++)r[H*n+Y]+=pe*L[H]}for(H=Q+1;H<n;H++)I[H*n+Q]=W[H]}}let ne=l(n,o+1);Le<n&&(S[Le]=r[Le*n+Le]),o<ne&&(S[ne-1]=0),Z+1<ne&&(W[Z]=r[Z*n+ne-1]),W[ne-1]=0;{for(Y=Le;Y<A;Y++){for(H=0;H<o;H++)O[H*A+Y]=0;O[Y*A+Y]=1}for(Q=Le-1;Q>=0;Q--)if(S[Q]!==0){for(Y=Q+1;Y<A;Y++){for(pe=0,H=Q;H<o;H++)pe+=O[H*A+Q]*O[H*A+Y];for(pe=-pe/O[Q*A+Q],H=Q;H<o;H++)O[H*A+Y]+=pe*O[H*A+Q]}for(H=Q;H<o;H++)O[H*A+Q]=-O[H*A+Q];for(O[Q*A+Q]=1+O[Q*A+Q],H=0;H<Q-1;H++)O[H*A+Q]=0}else{for(H=0;H<o;H++)O[H*A+Q]=0;O[Q*A+Q]=1}}for(Q=n-1;Q>=0;Q--){if(Q<Z&&W[Q]!==0)for(Y=Q+1;Y<A;Y++){for(pe=0,H=Q+1;H<n;H++)pe+=I[H*n+Q]*I[H*n+Y];for(pe=-pe/I[(Q+1)*n+Q],H=Q+1;H<n;H++)I[H*n+Y]+=pe*I[H*n+Q]}for(H=0;H<n;H++)I[H*n+Q]=0;I[Q*n+Q]=1}const Ke=ne-1;let _t=0;const xe=g(2,-52),Ct=g(2,-966);for(;ne>0;){let zt;if(_t>500)break;for(Q=ne-2;Q>=-1&&Q!==-1;Q--)if(d(W[Q])<=Ct+xe*(d(S[Q])+d(S[Q+1]))){W[Q]=0;break}if(Q===ne-2)zt=4;else{let Je;for(Je=ne-1;Je>=Q&&Je!==Q;Je--)if(pe=(Je!==ne?d(W[Je]):0)+(Je!==Q+1?d(W[Je-1]):0),d(S[Je])<=Ct+xe*pe){S[Je]=0;break}Je===Q?zt=3:Je===ne-1?zt=1:(zt=2,Q=Je)}switch(Q++,zt){case 1:for(de=W[ne-2],W[ne-2]=0,Y=ne-2;Y>=Q;Y--)for(pe=Ee(S[Y],de),fe=S[Y]/pe,ye=de/pe,S[Y]=pe,Y!==Q&&(de=-ye*W[Y-1],W[Y-1]=fe*W[Y-1]),H=0;H<n;H++)pe=fe*I[H*n+Y]+ye*I[H*n+ne-1],I[H*n+ne-1]=-ye*I[H*n+Y]+fe*I[H*n+ne-1],I[H*n+Y]=pe;break;case 2:for(de=W[Q-1],W[Q-1]=0,Y=Q;Y<ne;Y++)for(pe=Ee(S[Y],de),fe=S[Y]/pe,ye=de/pe,S[Y]=pe,de=-ye*W[Y],W[Y]=fe*W[Y],H=0;H<o;H++)pe=fe*O[H*A+Y]+ye*O[H*A+Q-1],O[H*A+Q-1]=-ye*O[H*A+Y]+fe*O[H*A+Q-1],O[H*A+Y]=pe;break;case 3:{const Je=h(h(h(h(d(S[ne-1]),d(S[ne-2])),d(W[ne-2])),d(S[Q])),d(W[Q])),Et=S[ne-1]/Je,ht=S[ne-2]/Je,mt=W[ne-2]/Je,Nt=S[Q]/Je,Gt=W[Q]/Je,Mt=((ht+Et)*(ht-Et)+mt*mt)/2,jt=Et*mt*(Et*mt);let Ai=0;(Mt!==0||jt!==0)&&(Ai=Math.sqrt(Mt*Mt+jt),Mt<0&&(Ai=-Ai),Ai=jt/(Mt+Ai)),de=(Nt+Et)*(Nt-Et)+Ai;let oi=Nt*Gt;for(Y=Q;Y<ne-1;Y++){for(pe=Ee(de,oi),fe=de/pe,ye=oi/pe,Y!==Q&&(W[Y-1]=pe),de=fe*S[Y]+ye*W[Y],W[Y]=fe*W[Y]-ye*S[Y],oi=ye*S[Y+1],S[Y+1]=fe*S[Y+1],H=0;H<n;H++)pe=fe*I[H*n+Y]+ye*I[H*n+Y+1],I[H*n+Y+1]=-ye*I[H*n+Y]+fe*I[H*n+Y+1],I[H*n+Y]=pe;if(pe=Ee(de,oi),fe=de/pe,ye=oi/pe,S[Y]=pe,de=fe*W[Y]+ye*S[Y+1],S[Y+1]=-ye*W[Y]+fe*S[Y+1],oi=ye*W[Y+1],W[Y+1]=fe*W[Y+1],Y<o-1)for(H=0;H<o;H++)pe=fe*O[H*A+Y]+ye*O[H*A+Y+1],O[H*A+Y+1]=-ye*O[H*A+Y]+fe*O[H*A+Y+1],O[H*A+Y]=pe}W[ne-2]=de,_t=_t+1}break;case 4:{if(S[Q]<=0)for(S[Q]=S[Q]<0?-S[Q]:0,H=0;H<=Ke;H++)I[H*n+Q]=-I[H*n+Q];for(;Q<Ke&&!(S[Q]>=S[Q+1]);){if(pe=S[Q],S[Q]=S[Q+1],S[Q+1]=pe,Q<n-1)for(H=0;H<n;H++)pe=I[H*n+Q+1],I[H*n+Q+1]=I[H*n+Q],I[H*n+Q]=pe;if(Q<o-1)for(H=0;H<o;H++)pe=O[H*A+Q+1],O[H*A+Q+1]=O[H*A+Q],O[H*A+Q]=pe;Q++}_t=0,ne--}break;default:throw new Error(`invalid kase: ${zt}`)}}}getU(){return new Matrix$1(this.m,Math.min(this.m+1,this.n),this.U,!0)}getV(){return new Matrix$1(this.n,this.n,this.V,!0)}getSingularValues(){return this.s}getS(){const t=new Matrix$1(this.n,this.n);for(let s=0;s<this.n;s++){for(let r=0;r<this.n;r++)t.entries[t.index(s,r)]=0;t.entries[t.index(s,s)]=this.s[s]}return t}norm2(){return this.s[0]}cond(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}rank(){const t=Math.pow(2,-23),s=Math.max(this.m,this.n)*this.s[0]*t;let r=0;for(let o=0;o<this.s.length;o++)this.s[o]>s&&r++;return r}static pseudoinverse(t){const s=new SingularValueDecomposition(t),r=Matrix$1.diagonalMatrix(s.getSingularValues().map(o=>Math.abs(o)<1e-300?0:1/o));return s.getV().times(r).times(s.getU().transpose())}}dot.register("SingularValueDecomposition",SingularValueDecomposition);const ArrayType$1=window.Float64Array||Array;class Matrix{constructor(t,s,r,o){this.m=t,this.n=s;const n=t*s;this.size=n;let l;if(o)this.entries=r;else if(r||(r=0),this.entries=new ArrayType$1(n),isArray(r))for(assert&&assert(r.length===n),l=0;l<n;l++)this.entries[l]=r[l];else for(l=0;l<n;l++)this.entries[l]=r}copy(){const t=new Matrix(this.m,this.n);for(let s=0;s<this.size;s++)t.entries[s]=this.entries[s];return t}getArray(){return this.entries}getArrayCopy(){return new ArrayType$1(this.entries)}getRowDimension(){return this.m}getColumnDimension(){return this.n}index(t,s){return t*this.n+s}get(t,s){return this.entries[this.index(t,s)]}set(t,s,r){this.entries[this.index(t,s)]=r}getMatrix(t,s,r,o){const n=new Matrix(s-t+1,o-r+1);for(let l=t;l<=s;l++)for(let h=r;h<=o;h++)n.entries[n.index(l-t,h-r)]=this.entries[this.index(l,h)];return n}getArrayRowMatrix(t,s,r){const o=new Matrix(t.length,r-s+1);for(let n=0;n<t.length;n++)for(let l=s;l<=r;l++)o.entries[o.index(n,l-s)]=this.entries[this.index(t[n],l)];return o}transpose(t){t=t||new Matrix(this.n,this.m),assert&&assert(t.m===this.n),assert&&assert(t.n===this.m);for(let s=0;s<this.m;s++)for(let r=0;r<this.n;r++)t.entries[t.index(r,s)]=this.entries[this.index(s,r)];return t}norm1(){let t=0;for(let s=0;s<this.n;s++){let r=0;for(let o=0;o<this.m;o++)r+=Math.abs(this.entries[this.index(o,s)]);t=Math.max(t,r)}return t}norm2(){return new SingularValueDecomposition(this).norm2()}normInf(){let t=0;for(let s=0;s<this.m;s++){let r=0;for(let o=0;o<this.n;o++)r+=Math.abs(this.entries[this.index(s,o)]);t=Math.max(t,r)}return t}normF(){let t=0;for(let s=0;s<this.m;s++)for(let r=0;r<this.n;r++)t=Matrix.hypot(t,this.entries[this.index(s,r)]);return t}uminus(){const t=new Matrix(this.m,this.n);for(let s=0;s<this.m;s++)for(let r=0;r<this.n;r++)t.entries[t.index(s,r)]=-this.entries[this.index(s,r)];return t}plus(t){this.checkMatrixDimensions(t);const s=new Matrix(this.m,this.n);for(let r=0;r<this.m;r++)for(let o=0;o<this.n;o++){const n=s.index(r,o);s.entries[n]=this.entries[n]+t.entries[n]}return s}plusEquals(t){this.checkMatrixDimensions(t);for(let s=0;s<this.m;s++)for(let r=0;r<this.n;r++){const o=this.index(s,r);this.entries[o]=this.entries[o]+t.entries[o]}return this}blendEquals(t,s){this.checkMatrixDimensions(t);for(let r=0;r<this.m;r++)for(let o=0;o<this.n;o++){const n=this.index(r,o),l=this.entries[n],h=t.entries[n];this.entries[n]=l+(h-l)*s}return this}minus(t){this.checkMatrixDimensions(t);const s=new Matrix(this.m,this.n);for(let r=0;r<this.m;r++)for(let o=0;o<this.n;o++){const n=this.index(r,o);s.entries[n]=this.entries[n]-t.entries[n]}return s}minusEquals(t){this.checkMatrixDimensions(t);for(let s=0;s<this.m;s++)for(let r=0;r<this.n;r++){const o=this.index(s,r);this.entries[o]=this.entries[o]-t.entries[o]}return this}arrayTimes(t){this.checkMatrixDimensions(t);const s=new Matrix(this.m,this.n);for(let r=0;r<this.m;r++)for(let o=0;o<this.n;o++){const n=s.index(r,o);s.entries[n]=this.entries[n]*t.entries[n]}return s}arrayTimesEquals(t){this.checkMatrixDimensions(t);for(let s=0;s<this.m;s++)for(let r=0;r<this.n;r++){const o=this.index(s,r);this.entries[o]=this.entries[o]*t.entries[o]}return this}arrayRightDivide(t){this.checkMatrixDimensions(t);const s=new Matrix(this.m,this.n);for(let r=0;r<this.m;r++)for(let o=0;o<this.n;o++){const n=this.index(r,o);s.entries[n]=this.entries[n]/t.entries[n]}return s}arrayRightDivideEquals(t){this.checkMatrixDimensions(t);for(let s=0;s<this.m;s++)for(let r=0;r<this.n;r++){const o=this.index(s,r);this.entries[o]=this.entries[o]/t.entries[o]}return this}arrayLeftDivide(t){this.checkMatrixDimensions(t);const s=new Matrix(this.m,this.n);for(let r=0;r<this.m;r++)for(let o=0;o<this.n;o++){const n=this.index(r,o);s.entries[n]=t.entries[n]/this.entries[n]}return s}arrayLeftDivideEquals(t){this.checkMatrixDimensions(t);for(let s=0;s<this.m;s++)for(let r=0;r<this.n;r++){const o=this.index(s,r);this.entries[o]=t.entries[o]/this.entries[o]}return this}times(t){let s,r,o,n,l,h;if(t.isMatrix){if(h=t,h.m!==this.n)throw new Error("Matrix inner dimensions must agree.");s=new Matrix(this.m,h.n);const g=new ArrayType$1(this.n);for(o=0;o<h.n;o++){for(n=0;n<this.n;n++)g[n]=h.entries[h.index(n,o)];for(r=0;r<this.m;r++){for(l=0,n=0;n<this.n;n++)l+=this.entries[this.index(r,n)]*g[n];s.entries[s.index(r,o)]=l}}return s}else{for(l=t,s=new Matrix(this.m,this.n),r=0;r<this.m;r++)for(o=0;o<this.n;o++)s.entries[s.index(r,o)]=l*this.entries[this.index(r,o)];return s}}timesEquals(t){for(let s=0;s<this.m;s++)for(let r=0;r<this.n;r++){const o=this.index(s,r);this.entries[o]=t*this.entries[o]}return this}solve(t){return this.m===this.n?new LUDecomposition(this).solve(t):new QRDecomposition(this).solve(t)}solveTranspose(t){return this.transpose().solve(t.transpose())}inverse(){return this.solve(Matrix.identity(this.m,this.m))}det(){return new LUDecomposition(this).det()}rank(){return new SingularValueDecomposition(this).rank()}cond(){return new SingularValueDecomposition(this).cond()}trace(){let t=0;for(let s=0;s<Math.min(this.m,this.n);s++)t+=this.entries[this.index(s,s)];return t}checkMatrixDimensions(t){if(t.m!==this.m||t.n!==this.n)throw new Error("Matrix dimensions must agree.")}toString(){let t="";t+=`dim: ${this.getRowDimension()}x${this.getColumnDimension()}
`;for(let s=0;s<this.getRowDimension();s++){for(let r=0;r<this.getColumnDimension();r++)t+=`${this.get(s,r)} `;t+=`
`}return t}extractVector2(t){return assert&&assert(this.m===2),new Vector2(this.get(0,t),this.get(1,t))}extractVector3(t){return assert&&assert(this.m===3),new Vector3(this.get(0,t),this.get(1,t),this.get(2,t))}extractVector4(t){return assert&&assert(this.m===4),new Vector4(this.get(0,t),this.get(1,t),this.get(2,t),this.get(3,t))}setVectors3(t){const r=t.length;assert&&assert(this.m===3),assert&&assert(this.n===r);for(let o=0;o<r;o++){const n=t[o];this.entries[o]=n.x,this.entries[o+r]=n.y,this.entries[o+2*r]=n.z}return this}static hypot(t,s){let r;return Math.abs(t)>Math.abs(s)?(r=s/t,r=Math.abs(t)*Math.sqrt(1+r*r)):s!==0?(r=t/s,r=Math.abs(s)*Math.sqrt(1+r*r)):r=0,r}static identity(t,s){const r=new Matrix(t,s);for(let o=0;o<t;o++)for(let n=0;n<s;n++)r.entries[r.index(o,n)]=o===n?1:0;return r}static diagonalMatrix(t){const s=t.length,r=new Matrix(s,s);for(let o=0;o<s;o++)r.entries[r.index(o,o)]=t[o];return r}static rowVector2(t){return new Matrix(1,2,[t.x,t.y])}static rowVector3(t){return new Matrix(1,3,[t.x,t.y,t.z])}static rowVector4(t){return new Matrix(1,4,[t.x,t.y,t.z,t.w])}static rowVector(t){if(t.isVector2)return Matrix.rowVector2(t);if(t.isVector3)return Matrix.rowVector3(t);if(t.isVector4)return Matrix.rowVector4(t);throw new Error(`undetected type of vector: ${t.toString()}`)}static columnVector2(t){return new Matrix(2,1,[t.x,t.y])}static columnVector3(t){return new Matrix(3,1,[t.x,t.y,t.z])}static columnVector4(t){return new Matrix(4,1,[t.x,t.y,t.z,t.w])}static columnVector(t){if(t.isVector2)return Matrix.columnVector2(t);if(t.isVector3)return Matrix.columnVector3(t);if(t.isVector4)return Matrix.columnVector4(t);throw new Error(`undetected type of vector: ${t.toString()}`)}static fromVectors2(t){const r=t.length,o=new ArrayType$1(2*r);for(let n=0;n<r;n++){const l=t[n];o[n]=l.x,o[n+r]=l.y}return new Matrix(2,r,o,!0)}static fromVectors3(t){const r=t.length,o=new ArrayType$1(3*r);for(let n=0;n<r;n++){const l=t[n];o[n]=l.x,o[n+r]=l.y,o[n+2*r]=l.z}return new Matrix(3,r,o,!0)}static fromVectors4(t){const r=t.length,o=new ArrayType$1(4*r);for(let n=0;n<r;n++){const l=t[n];o[n]=l.x,o[n+r]=l.y,o[n+2*r]=l.z,o[n+3*r]=l.w}return new Matrix(4,r,o,!0)}}Matrix.prototype.isMatrix=!0;dot.register("Matrix",Matrix);const Matrix$1=Matrix,ArrayType=window.Float64Array||Array;class EigenvalueDecomposition{constructor(t){let s,r;const o=t.entries;this.n=t.getColumnDimension();const n=this.n;for(this.V=new ArrayType(n*n),this.d=new ArrayType(n),this.e=new ArrayType(n),this.issymmetric=!0,r=0;r<n&&this.issymmetric;r++)for(s=0;s<n&&this.issymmetric;s++)this.issymmetric=o[s*this.n+r]===o[r*this.n+s];if(this.issymmetric){for(s=0;s<n;s++)for(r=0;r<n;r++)this.V[s*this.n+r]=o[s*this.n+r];this.tred2(),this.tql2()}else{for(this.H=new ArrayType(n*n),this.ort=new ArrayType(n),r=0;r<n;r++)for(s=0;s<n;s++)this.H[s*this.n+r]=o[s*this.n+r];this.orthes(),this.hqr2()}}getV(){return this.V.copy()}getRealEigenvalues(){return this.d}getImagEigenvalues(){return this.e}getD(){const t=this.n,s=this.d,r=this.e,o=new Matrix$1(t,t),n=o.entries;for(let l=0;l<t;l++){for(let h=0;h<t;h++)n[l*this.n+h]=0;n[l*this.n+l]=s[l],r[l]>0?n[l*this.n+l+1]=r[l]:r[l]<0&&(n[l*this.n+l-1]=r[l])}return o}tred2(){const t=this.n,s=this.V,r=this.d,o=this.e;let n,l,h,g,d,A;for(l=0;l<t;l++)r[l]=s[(t-1)*t+l];for(n=t-1;n>0;n--){let S=0;for(A=0,h=0;h<n;h++)S=S+Math.abs(r[h]);if(S===0)for(o[n]=r[n-1],l=0;l<n;l++)r[l]=s[(n-1)*t+l],s[n*this.n+l]=0,s[l*this.n+n]=0;else{for(h=0;h<n;h++)r[h]/=S,A+=r[h]*r[h];for(g=r[n-1],d=Math.sqrt(A),g>0&&(d=-d),o[n]=S*d,A=A-g*d,r[n-1]=g-d,l=0;l<n;l++)o[l]=0;for(l=0;l<n;l++){for(g=r[l],s[l*this.n+n]=g,d=o[l]+s[l*t+l]*g,h=l+1;h<=n-1;h++)d+=s[h*t+l]*r[h],o[h]+=s[h*t+l]*g;o[l]=d}for(g=0,l=0;l<n;l++)o[l]/=A,g+=o[l]*r[l];const O=g/(A+A);for(l=0;l<n;l++)o[l]-=O*r[l];for(l=0;l<n;l++){for(g=r[l],d=o[l],h=l;h<=n-1;h++)s[h*t+l]-=g*o[h]+d*r[h];r[l]=s[(n-1)*t+l],s[n*this.n+l]=0}}r[n]=A}for(n=0;n<t-1;n++){if(s[(t-1)*t+n]=s[n*t+n],s[n*t+n]=1,A=r[n+1],A!==0){for(h=0;h<=n;h++)r[h]=s[h*t+(n+1)]/A;for(l=0;l<=n;l++){for(d=0,h=0;h<=n;h++)d+=s[h*t+(n+1)]*s[h*t+l];for(h=0;h<=n;h++)s[h*t+l]-=d*r[h]}}for(h=0;h<=n;h++)s[h*t+(n+1)]=0}for(l=0;l<t;l++)r[l]=s[(t-1)*t+l],s[(t-1)*t+l]=0;s[(t-1)*t+(t-1)]=1,o[0]=0}tql2(){const t=this.n,s=this.V,r=this.d,o=this.e;let n,l,h,g,d,A;for(n=1;n<t;n++)o[n-1]=o[n];o[t-1]=0;let S=0,O=0;const I=Math.pow(2,-52);for(g=0;g<t;g++){O=Math.max(O,Math.abs(r[g])+Math.abs(o[g]));let W=g;for(;W<t&&!(Math.abs(o[W])<=I*O);)W++;if(W>g)do{d=r[g],A=(r[g+1]-d)/(2*o[g]);let L=Matrix$1.hypot(A,1);A<0&&(L=-L),r[g]=o[g]/(A+L),r[g+1]=o[g]*(A+L);const H=r[g+1];let Y=d-r[g];for(n=g+2;n<t;n++)r[n]-=Y;S=S+Y,A=r[W];let Q=1,pe=Q,de=Q;const fe=o[g+1];let ye=0,Ee=0;for(n=W-1;n>=g;n--)for(de=pe,pe=Q,Ee=ye,d=Q*o[n],Y=Q*A,L=Matrix$1.hypot(A,o[n]),o[n+1]=ye*L,ye=o[n]/L,Q=A/L,A=Q*r[n]-ye*d,r[n+1]=Y+ye*(Q*d+ye*r[n]),h=0;h<t;h++)Y=s[h*t+(n+1)],s[h*t+(n+1)]=ye*s[h*t+n]+Q*Y,s[h*t+n]=Q*s[h*t+n]-ye*Y;A=-ye*Ee*de*fe*o[g]/H,o[g]=ye*A,r[g]=Q*A}while(Math.abs(o[g])>I*O);r[g]=r[g]+S,o[g]=0}for(n=0;n<t-1;n++){for(h=n,A=r[n],l=n+1;l<t;l++)r[l]<A&&(h=l,A=r[l]);if(h!==n)for(r[h]=r[n],r[n]=A,l=0;l<t;l++)A=s[l*this.n+n],s[l*this.n+n]=s[l*t+h],s[l*t+h]=A}}orthes(){const t=this.n,s=this.V,r=this.H,o=this.ort;let n,l,h,g,d;const A=0,S=t-1;for(h=A+1;h<=S-1;h++){let O=0;for(n=h;n<=S;n++)O=O+Math.abs(r[n*t+(h-1)]);if(O!==0){let I=0;for(n=S;n>=h;n--)o[n]=r[n*t+(h-1)]/O,I+=o[n]*o[n];for(d=Math.sqrt(I),o[h]>0&&(d=-d),I=I-o[h]*d,o[h]=o[h]-d,l=h;l<t;l++){for(g=0,n=S;n>=h;n--)g+=o[n]*r[n*this.n+l];for(g=g/I,n=h;n<=S;n++)r[n*this.n+l]-=g*o[n]}for(n=0;n<=S;n++){for(g=0,l=S;l>=h;l--)g+=o[l]*r[n*this.n+l];for(g=g/I,l=h;l<=S;l++)r[n*this.n+l]-=g*o[l]}o[h]=O*o[h],r[h*t+(h-1)]=O*d}}for(n=0;n<t;n++)for(l=0;l<t;l++)s[n*this.n+l]=n===l?1:0;for(h=S-1;h>=A+1;h--)if(r[h*t+(h-1)]!==0){for(n=h+1;n<=S;n++)o[n]=r[n*t+(h-1)];for(l=h;l<=S;l++){for(d=0,n=h;n<=S;n++)d+=o[n]*s[n*this.n+l];for(d=d/o[h]/r[h*t+(h-1)],n=h;n<=S;n++)s[n*this.n+l]+=d*o[n]}}}cdiv(t,s,r,o){let n,l;Math.abs(r)>Math.abs(o)?(n=o/r,l=r+n*o,this.cdivr=(t+n*s)/l,this.cdivi=(s-n*t)/l):(n=r/o,l=o+n*r,this.cdivr=(n*t+s)/l,this.cdivi=(n*s-t)/l)}hqr2(){let t;const s=this.V,r=this.d,o=this.e,n=this.H;let l,h,g,d,A,S;const O=this.n;t=O-1;const I=0,W=O-1,L=Math.pow(2,-52);let H=0,Y=0,Q=0,pe=0,de=0,fe=0,ye,Ee,Le,Z,ne=0;for(l=0;l<O;l++)for((l<I||l>W)&&(r[l]=n[l*t+l],o[l]=0),h=Math.max(l-1,0);h<O;h++)ne=ne+Math.abs(n[l*this.n+h]);for(S=0;t>=I;){for(d=t;d>I&&(de=Math.abs(n[(d-1)*t+(d-1)])+Math.abs(n[d*t+d]),de===0&&(de=ne),!(Math.abs(n[d*t+(d-1)])<L*de));)d--;if(d===t)n[t*t+t]=n[t*t+t]+H,r[t]=n[t*t+t],o[t]=0,t--,S=0;else if(d===t-1){if(Ee=n[t*t+t-1]*n[(t-1)*t+t],Y=(n[(t-1)*t+(t-1)]-n[t*t+t])/2,Q=Y*Y+Ee,fe=Math.sqrt(Math.abs(Q)),n[t*t+t]=n[t*t+t]+H,n[(t-1)*t+(t-1)]=n[(t-1)*t+(t-1)]+H,Le=n[t*t+t],Q>=0){for(Y>=0?fe=Y+fe:fe=Y-fe,r[t-1]=Le+fe,r[t]=r[t-1],fe!==0&&(r[t]=Le-Ee/fe),o[t-1]=0,o[t]=0,Le=n[t*t+t-1],de=Math.abs(Le)+Math.abs(fe),Y=Le/de,Q=fe/de,pe=Math.sqrt(Y*Y+Q*Q),Y=Y/pe,Q=Q/pe,h=t-1;h<O;h++)fe=n[(t-1)*t+h],n[(t-1)*t+h]=Q*fe+Y*n[t*t+h],n[t*t+h]=Q*n[t*t+h]-Y*fe;for(l=0;l<=t;l++)fe=n[l*t+t-1],n[l*t+t-1]=Q*fe+Y*n[l*t+t],n[l*t+t]=Q*n[l*t+t]-Y*fe;for(l=I;l<=W;l++)fe=s[l*t+t-1],s[l*t+t-1]=Q*fe+Y*s[l*t+t],s[l*t+t]=Q*s[l*t+t]-Y*fe}else r[t-1]=Le+Y,r[t]=Le+Y,o[t-1]=fe,o[t]=-fe;t=t-2,S=0}else{if(Le=n[t*t+t],Z=0,Ee=0,d<t&&(Z=n[(t-1)*t+(t-1)],Ee=n[t*t+t-1]*n[(t-1)*t+t]),S===10){for(H+=Le,l=I;l<=t;l++)n[l*t+l]-=Le;de=Math.abs(n[t*t+t-1])+Math.abs(n[(t-1)*t+t-2]),Le=Z=.75*de,Ee=-.4375*de*de}if(S===30&&(de=(Z-Le)/2,de=de*de+Ee,de>0)){for(de=Math.sqrt(de),Z<Le&&(de=-de),de=Le-Ee/((Z-Le)/2+de),l=I;l<=t;l++)n[l*t+l]-=de;H+=de,Le=Z=Ee=.964}for(S=S+1,A=t-2;A>=d&&(fe=n[A*t+A],pe=Le-fe,de=Z-fe,Y=(pe*de-Ee)/n[(A+1)*t+A]+n[A*t+A+1],Q=n[(A+1)*t+A+1]-fe-pe-de,pe=n[(A+2)*t+A+1],de=Math.abs(Y)+Math.abs(Q)+Math.abs(pe),Y=Y/de,Q=Q/de,pe=pe/de,!(A===d||Math.abs(n[A*t+(A-1)])*(Math.abs(Q)+Math.abs(pe))<L*(Math.abs(Y)*(Math.abs(n[(A-1)*t+A-1])+Math.abs(fe)+Math.abs(n[(A+1)*t+A+1])))));)A--;for(l=A+2;l<=t;l++)n[l*t+l-2]=0,l>A+2&&(n[l*t+l-3]=0);for(g=A;g<=t-1;g++){const Ke=g!==t-1;if(g!==A&&(Y=n[g*t+g-1],Q=n[(g+1)*t+g-1],pe=Ke?n[(g+2)*t+g-1]:0,Le=Math.abs(Y)+Math.abs(Q)+Math.abs(pe),Le!==0&&(Y=Y/Le,Q=Q/Le,pe=pe/Le)),Le===0)break;if(de=Math.sqrt(Y*Y+Q*Q+pe*pe),Y<0&&(de=-de),de!==0){for(g!==A?n[g*t+g-1]=-de*Le:d!==A&&(n[g*t+g-1]=-n[g*t+g-1]),Y=Y+de,Le=Y/de,Z=Q/de,fe=pe/de,Q=Q/Y,pe=pe/Y,h=g;h<O;h++)Y=n[g*t+h]+Q*n[(g+1)*t+h],Ke&&(Y=Y+pe*n[(g+2)*t+h],n[(g+2)*t+h]=n[(g+2)*t+h]-Y*fe),n[g*t+h]=n[g*t+h]-Y*Le,n[(g+1)*t+h]=n[(g+1)*t+h]-Y*Z;for(l=0;l<=Math.min(t,g+3);l++)Y=Le*n[l*t+g]+Z*n[l*t+g+1],Ke&&(Y=Y+fe*n[l*t+g+2],n[l*t+g+2]=n[l*t+g+2]-Y*pe),n[l*t+g]=n[l*t+g]-Y,n[l*t+g+1]=n[l*t+g+1]-Y*Q;for(l=I;l<=W;l++)Y=Le*s[l*t+g]+Z*s[l*t+g+1],Ke&&(Y=Y+fe*s[l*t+g+2],s[l*t+g+2]=s[l*t+g+2]-Y*pe),s[l*t+g]=s[l*t+g]-Y,s[l*t+g+1]=s[l*t+g+1]-Y*Q}}}}if(ne!==0){for(t=O-1;t>=0;t--)if(Y=r[t],Q=o[t],Q===0)for(d=t,n[t*t+t]=1,l=t-1;l>=0;l--){for(Ee=n[l*t+l]-Y,pe=0,h=d;h<=t;h++)pe=pe+n[l*this.n+h]*n[h*t+t];if(o[l]<0)fe=Ee,de=pe;else if(d=l,o[l]===0?Ee!==0?n[l*t+t]=-pe/Ee:n[l*t+t]=-pe/(L*ne):(Le=n[l*t+l+1],Z=n[(l+1)*t+l],Q=(r[l]-Y)*(r[l]-Y)+o[l]*o[l],ye=(Le*de-fe*pe)/Q,n[l*t+t]=ye,Math.abs(Le)>Math.abs(fe)?n[(l+1)*t+t]=(-pe-Ee*ye)/Le:n[(l+1)*t+t]=(-de-Z*ye)/fe),ye=Math.abs(n[l*t+t]),L*ye*ye>1)for(h=l;h<=t;h++)n[h*t+t]=n[h*t+t]/ye}else if(Q<0)for(d=t-1,Math.abs(n[t*t+t-1])>Math.abs(n[(t-1)*t+t])?(n[(t-1)*t+(t-1)]=Q/n[t*t+t-1],n[(t-1)*t+t]=-(n[t*t+t]-Y)/n[t*t+t-1]):(this.cdiv(0,-n[(t-1)*t+t],n[(t-1)*t+(t-1)]-Y,Q),n[(t-1)*t+(t-1)]=this.cdivr,n[(t-1)*t+t]=this.cdivi),n[t*t+t-1]=0,n[t*t+t]=1,l=t-2;l>=0;l--){let Ke,_t,xe,Ct;for(Ke=0,_t=0,h=d;h<=t;h++)Ke=Ke+n[l*this.n+h]*n[h*t+t-1],_t=_t+n[l*this.n+h]*n[h*t+t];if(Ee=n[l*t+l]-Y,o[l]<0)fe=Ee,pe=Ke,de=_t;else if(d=l,o[l]===0?(this.cdiv(-Ke,-_t,Ee,Q),n[l*t+t-1]=this.cdivr,n[l*t+t]=this.cdivi):(Le=n[l*t+l+1],Z=n[(l+1)*t+l],xe=(r[l]-Y)*(r[l]-Y)+o[l]*o[l]-Q*Q,Ct=(r[l]-Y)*2*Q,xe===0&&Ct===0&&(xe=L*ne*(Math.abs(Ee)+Math.abs(Q)+Math.abs(Le)+Math.abs(Z)+Math.abs(fe))),this.cdiv(Le*pe-fe*Ke+Q*_t,Le*de-fe*_t-Q*Ke,xe,Ct),n[l*t+t-1]=this.cdivr,n[l*t+t]=this.cdivi,Math.abs(Le)>Math.abs(fe)+Math.abs(Q)?(n[(l+1)*t+t-1]=(-Ke-Ee*n[l*t+t-1]+Q*n[l*t+t])/Le,n[(l+1)*t+t]=(-_t-Ee*n[l*t+t]-Q*n[l*t+t-1])/Le):(this.cdiv(-pe-Z*n[l*t+t-1],-de-Z*n[l*t+t],fe,Q),n[(l+1)*t+t-1]=this.cdivr,n[(l+1)*t+t]=this.cdivi)),ye=Math.max(Math.abs(n[l*t+t-1]),Math.abs(n[l*t+t])),L*ye*ye>1)for(h=l;h<=t;h++)n[h*t+t-1]=n[h*t+t-1]/ye,n[h*t+t]=n[h*t+t]/ye}for(l=0;l<O;l++)if(l<I||l>W)for(h=l;h<O;h++)s[l*this.n+h]=n[l*this.n+h];for(h=O-1;h>=I;h--)for(l=I;l<=W;l++){for(fe=0,g=I;g<=Math.min(h,W);g++)fe=fe+s[l*t+g]*n[g*t+h];s[l*this.n+h]=fe}}}}dot.register("EigenvalueDecomposition",EigenvalueDecomposition);class LinearFunction{constructor(t,s,r,o,n=!1){this.a1=t,this.a2=s,this.b1=r,this.b2=o,this.clamp=n}evaluate(t){return map$1(this.a1,this.a2,this.b1,this.b2,t,this.clamp)}inverse(t){return map$1(this.b1,this.b2,this.a1,this.a2,t,this.clamp)}}const map$1=(a,t,s,r,o,n)=>{let l=DotUtils.linear(a,t,s,r,o);if(n){const h=Math.max(s,r),g=Math.min(s,r);l=DotUtils.clamp(l,g,h)}return l};dot.register("LinearFunction",LinearFunction);class LUDecompositionDecimal{constructor(t,s){let r,o,n;this.matrix=t,this.LU=[],t.entries.forEach(A=>{this.LU.push(new s(A))});const l=this.LU;this.m=t.getRowDimension();const h=this.m;this.n=t.getColumnDimension();const g=this.n;for(this.piv=new Uint32Array(h),r=0;r<h;r++)this.piv[r]=r;this.pivsign=1;const d=new Array(h);for(o=0;o<g;o++){for(r=0;r<h;r++)d[r]=new s(l[t.index(r,o)]);for(r=0;r<h;r++){const S=Math.min(r,o);let O=new s(0);for(n=0;n<S;n++){const I=t.index(r,n),W=new s(l[I]),L=d[n];O=O.plus(W.times(L))}d[r]=d[r].minus(O),l[t.index(r,o)]=d[r]}let A=o;for(r=o+1;r<h;r++)d[r].abs()>d[A].abs()&&(A=r);if(A!==o){for(n=0;n<g;n++){const S=t.index(A,n),O=t.index(o,n),I=l[S];l[S]=l[O],l[O]=I}n=this.piv[A],this.piv[A]=this.piv[o],this.piv[o]=n,this.pivsign=-this.pivsign}if(o<h&&!l[this.matrix.index(o,o)].isZero())for(r=o+1;r<h;r++)l[t.index(r,o)]=l[t.index(r,o)].dividedBy(l[t.index(o,o)])}}isNonsingular(){for(let t=0;t<this.n;t++){const s=this.matrix.index(t,t);if(this.LU[s].isZero())return!1}return!0}solve(t,s){let r,o,n;if(t.getRowDimension()!==this.m)throw new Error("Matrix row dimensions must agree.");if(!this.isNonsingular())throw new Error("Matrix is singular.");const l=t.getColumnDimension(),h=t.getArrayRowMatrix(this.piv,0,l-1),g=[];for(h.entries.forEach(d=>g.push(new s(d))),n=0;n<this.n;n++)for(r=n+1;r<this.n;r++)for(o=0;o<l;o++)g[h.index(r,o)]=g[h.index(r,o)].minus(g[h.index(n,o)].times(this.LU[this.matrix.index(r,n)]));for(n=this.n-1;n>=0;n--){for(o=0;o<l;o++)g[h.index(n,o)]=g[h.index(n,o)].dividedBy(this.LU[this.matrix.index(n,n)]);for(r=0;r<n;r++)for(o=0;o<l;o++)g[h.index(r,o)]=g[h.index(r,o)].minus(g[h.index(n,o)].times(this.LU[this.matrix.index(r,n)]))}return h.entries=g.map(d=>d.toNumber()),h}}dot.register("LUDecompositionDecimal",LUDecompositionDecimal);const Vl=class Vl extends Map{constructor(t){super(t),Vl.caches.push(this)}static clearAll(){Vl.caches.forEach(t=>t.clear())}};Vl.caches=[];let IOTypeCache=Vl;tandemNamespace.register("IOTypeCache",IOTypeCache);const cache$b=new IOTypeCache,joinKeys=a=>a.join("|"),EnumerationIO=a=>{const t=a.enumeration;if(!cache$b.has(t)){const s=t.phetioDocumentation?` ${t.phetioDocumentation}`:"",r=t.keys,o=t.values,n=`EnumerationIO(${joinKeys(r)})`;assert&&assert(!Array.from(cache$b.values()).find(l=>l.typeName===n),"There was already another IOType with the same name: "+n),cache$b.set(t,new IOType(n,{validValues:o,documentation:`Possible values: ${r.join(", ")}.${s}`,toStateObject:l=>t.getKey(l),fromStateObject:l=>(assert&&assert(typeof l=="string","unsupported EnumerationIO value type, expected string"),assert&&assert(r.includes(l),`Unrecognized value: ${l}`),t.getValue(l)),stateSchema:StateSchema.asValue(`${joinKeys(r)}`,{isValidValue:l=>r.includes(l)})}))}return cache$b.get(t)};tandemNamespace.register("EnumerationIO",EnumerationIO);const cache$a=new IOTypeCache,ArrayIO=a=>(assert&&assert(!!a,"parameterType should be defined"),cache$a.has(a)||cache$a.set(a,new IOType(`ArrayIO<${a.typeName}>`,{valueType:Array,isValidValue:t=>_.every(t,s=>Validation.isValueValid(s,a.validator)),parameterTypes:[a],toStateObject:t=>t.map(a.toStateObject),fromStateObject:t=>t.map(a.fromStateObject),documentation:"PhET-iO Type for the built-in JS array type, with the element type specified.",stateSchema:StateSchema.asValue(`Array<${a.typeName}>`,{isValidValue:t=>_.every(t,s=>a.isStateObjectValid(s))})})),cache$a.get(a));tandemNamespace.register("ArrayIO",ArrayIO);const Float32Array$1=window.Float32Array||Array;class Matrix4{constructor(t,s,r,o,n,l,h,g,d,A,S,O,I,W,L,H,Y){this.entries=new Float32Array$1(16),this.type=Types.OTHER,this.rowMajor(t!==void 0?t:1,s!==void 0?s:0,r!==void 0?r:0,o!==void 0?o:0,n!==void 0?n:0,l!==void 0?l:1,h!==void 0?h:0,g!==void 0?g:0,d!==void 0?d:0,A!==void 0?A:0,S!==void 0?S:1,O!==void 0?O:0,I!==void 0?I:0,W!==void 0?W:0,L!==void 0?L:0,H!==void 0?H:1,Y)}rowMajor(t,s,r,o,n,l,h,g,d,A,S,O,I,W,L,H,Y){return this.entries[0]=t,this.entries[1]=n,this.entries[2]=d,this.entries[3]=I,this.entries[4]=s,this.entries[5]=l,this.entries[6]=A,this.entries[7]=W,this.entries[8]=r,this.entries[9]=h,this.entries[10]=S,this.entries[11]=L,this.entries[12]=o,this.entries[13]=g,this.entries[14]=O,this.entries[15]=H,this.type=Y===void 0?I===0&&W===0&&L===0&&H===1?Types.AFFINE:Types.OTHER:Y,this}columnMajor(t,s,r,o,n,l,h,g,d,A,S,O,I,W,L,H,Y){return this.rowMajor(t,n,d,I,s,l,A,W,r,h,S,L,o,g,O,H,Y)}set(t){return this.rowMajor(t.m00(),t.m01(),t.m02(),t.m03(),t.m10(),t.m11(),t.m12(),t.m13(),t.m20(),t.m21(),t.m22(),t.m23(),t.m30(),t.m31(),t.m32(),t.m33(),t.type)}m00(){return this.entries[0]}m01(){return this.entries[4]}m02(){return this.entries[8]}m03(){return this.entries[12]}m10(){return this.entries[1]}m11(){return this.entries[5]}m12(){return this.entries[9]}m13(){return this.entries[13]}m20(){return this.entries[2]}m21(){return this.entries[6]}m22(){return this.entries[10]}m23(){return this.entries[14]}m30(){return this.entries[3]}m31(){return this.entries[7]}m32(){return this.entries[11]}m33(){return this.entries[15]}isFinite(){return isFinite(this.m00())&&isFinite(this.m01())&&isFinite(this.m02())&&isFinite(this.m03())&&isFinite(this.m10())&&isFinite(this.m11())&&isFinite(this.m12())&&isFinite(this.m13())&&isFinite(this.m20())&&isFinite(this.m21())&&isFinite(this.m22())&&isFinite(this.m23())&&isFinite(this.m30())&&isFinite(this.m31())&&isFinite(this.m32())&&isFinite(this.m33())}getTranslation(){return new Vector3(this.m03(),this.m13(),this.m23())}get translation(){return this.getTranslation()}getScaleVector(){const t=this.m00()+this.m03(),s=this.m10()+this.m13(),r=this.m20()+this.m23(),o=this.m30()+this.m33(),n=this.m01()+this.m03(),l=this.m11()+this.m13(),h=this.m21()+this.m23(),g=this.m31()+this.m33(),d=this.m02()+this.m03(),A=this.m12()+this.m13(),S=this.m22()+this.m23(),O=this.m32()+this.m33();return new Vector3(Math.sqrt(t*t+s*s+r*r+o*o),Math.sqrt(n*n+l*l+h*h+g*g),Math.sqrt(d*d+A*A+S*S+O*O))}get scaleVector(){return this.getScaleVector()}getCSSTransform(){return`matrix3d(${this.entries[0].toFixed(20)},${this.entries[1].toFixed(20)},${this.entries[2].toFixed(20)},${this.entries[3].toFixed(20)},${this.entries[4].toFixed(20)},${this.entries[5].toFixed(20)},${this.entries[6].toFixed(20)},${this.entries[7].toFixed(20)},${this.entries[8].toFixed(20)},${this.entries[9].toFixed(20)},${this.entries[10].toFixed(20)},${this.entries[11].toFixed(20)},${this.entries[12].toFixed(20)},${this.entries[13].toFixed(20)},${this.entries[14].toFixed(20)},${this.entries[15].toFixed(20)})`}get cssTransform(){return this.getCSSTransform()}equals(t){return this.m00()===t.m00()&&this.m01()===t.m01()&&this.m02()===t.m02()&&this.m03()===t.m03()&&this.m10()===t.m10()&&this.m11()===t.m11()&&this.m12()===t.m12()&&this.m13()===t.m13()&&this.m20()===t.m20()&&this.m21()===t.m21()&&this.m22()===t.m22()&&this.m23()===t.m23()&&this.m30()===t.m30()&&this.m31()===t.m31()&&this.m32()===t.m32()&&this.m33()===t.m33()}equalsEpsilon(t,s){return Math.abs(this.m00()-t.m00())<s&&Math.abs(this.m01()-t.m01())<s&&Math.abs(this.m02()-t.m02())<s&&Math.abs(this.m03()-t.m03())<s&&Math.abs(this.m10()-t.m10())<s&&Math.abs(this.m11()-t.m11())<s&&Math.abs(this.m12()-t.m12())<s&&Math.abs(this.m13()-t.m13())<s&&Math.abs(this.m20()-t.m20())<s&&Math.abs(this.m21()-t.m21())<s&&Math.abs(this.m22()-t.m22())<s&&Math.abs(this.m23()-t.m23())<s&&Math.abs(this.m30()-t.m30())<s&&Math.abs(this.m31()-t.m31())<s&&Math.abs(this.m32()-t.m32())<s&&Math.abs(this.m33()-t.m33())<s}copy(){return new Matrix4(this.m00(),this.m01(),this.m02(),this.m03(),this.m10(),this.m11(),this.m12(),this.m13(),this.m20(),this.m21(),this.m22(),this.m23(),this.m30(),this.m31(),this.m32(),this.m33(),this.type)}plus(t){return new Matrix4(this.m00()+t.m00(),this.m01()+t.m01(),this.m02()+t.m02(),this.m03()+t.m03(),this.m10()+t.m10(),this.m11()+t.m11(),this.m12()+t.m12(),this.m13()+t.m13(),this.m20()+t.m20(),this.m21()+t.m21(),this.m22()+t.m22(),this.m23()+t.m23(),this.m30()+t.m30(),this.m31()+t.m31(),this.m32()+t.m32(),this.m33()+t.m33())}minus(t){return new Matrix4(this.m00()-t.m00(),this.m01()-t.m01(),this.m02()-t.m02(),this.m03()-t.m03(),this.m10()-t.m10(),this.m11()-t.m11(),this.m12()-t.m12(),this.m13()-t.m13(),this.m20()-t.m20(),this.m21()-t.m21(),this.m22()-t.m22(),this.m23()-t.m23(),this.m30()-t.m30(),this.m31()-t.m31(),this.m32()-t.m32(),this.m33()-t.m33())}transposed(){return new Matrix4(this.m00(),this.m10(),this.m20(),this.m30(),this.m01(),this.m11(),this.m21(),this.m31(),this.m02(),this.m12(),this.m22(),this.m32(),this.m03(),this.m13(),this.m23(),this.m33())}negated(){return new Matrix4(-this.m00(),-this.m01(),-this.m02(),-this.m03(),-this.m10(),-this.m11(),-this.m12(),-this.m13(),-this.m20(),-this.m21(),-this.m22(),-this.m23(),-this.m30(),-this.m31(),-this.m32(),-this.m33())}inverted(){let t;switch(this.type){case Types.IDENTITY:return this;case Types.TRANSLATION_3D:return new Matrix4(1,0,0,-this.m03(),0,1,0,-this.m13(),0,0,1,-this.m23(),0,0,0,1,Types.TRANSLATION_3D);case Types.SCALING:return new Matrix4(1/this.m00(),0,0,0,0,1/this.m11(),0,0,0,0,1/this.m22(),0,0,0,0,1/this.m33(),Types.SCALING);case Types.AFFINE:case Types.OTHER:if(t=this.getDeterminant(),t!==0)return new Matrix4((-this.m31()*this.m22()*this.m13()+this.m21()*this.m32()*this.m13()+this.m31()*this.m12()*this.m23()-this.m11()*this.m32()*this.m23()-this.m21()*this.m12()*this.m33()+this.m11()*this.m22()*this.m33())/t,(this.m31()*this.m22()*this.m03()-this.m21()*this.m32()*this.m03()-this.m31()*this.m02()*this.m23()+this.m01()*this.m32()*this.m23()+this.m21()*this.m02()*this.m33()-this.m01()*this.m22()*this.m33())/t,(-this.m31()*this.m12()*this.m03()+this.m11()*this.m32()*this.m03()+this.m31()*this.m02()*this.m13()-this.m01()*this.m32()*this.m13()-this.m11()*this.m02()*this.m33()+this.m01()*this.m12()*this.m33())/t,(this.m21()*this.m12()*this.m03()-this.m11()*this.m22()*this.m03()-this.m21()*this.m02()*this.m13()+this.m01()*this.m22()*this.m13()+this.m11()*this.m02()*this.m23()-this.m01()*this.m12()*this.m23())/t,(this.m30()*this.m22()*this.m13()-this.m20()*this.m32()*this.m13()-this.m30()*this.m12()*this.m23()+this.m10()*this.m32()*this.m23()+this.m20()*this.m12()*this.m33()-this.m10()*this.m22()*this.m33())/t,(-this.m30()*this.m22()*this.m03()+this.m20()*this.m32()*this.m03()+this.m30()*this.m02()*this.m23()-this.m00()*this.m32()*this.m23()-this.m20()*this.m02()*this.m33()+this.m00()*this.m22()*this.m33())/t,(this.m30()*this.m12()*this.m03()-this.m10()*this.m32()*this.m03()-this.m30()*this.m02()*this.m13()+this.m00()*this.m32()*this.m13()+this.m10()*this.m02()*this.m33()-this.m00()*this.m12()*this.m33())/t,(-this.m20()*this.m12()*this.m03()+this.m10()*this.m22()*this.m03()+this.m20()*this.m02()*this.m13()-this.m00()*this.m22()*this.m13()-this.m10()*this.m02()*this.m23()+this.m00()*this.m12()*this.m23())/t,(-this.m30()*this.m21()*this.m13()+this.m20()*this.m31()*this.m13()+this.m30()*this.m11()*this.m23()-this.m10()*this.m31()*this.m23()-this.m20()*this.m11()*this.m33()+this.m10()*this.m21()*this.m33())/t,(this.m30()*this.m21()*this.m03()-this.m20()*this.m31()*this.m03()-this.m30()*this.m01()*this.m23()+this.m00()*this.m31()*this.m23()+this.m20()*this.m01()*this.m33()-this.m00()*this.m21()*this.m33())/t,(-this.m30()*this.m11()*this.m03()+this.m10()*this.m31()*this.m03()+this.m30()*this.m01()*this.m13()-this.m00()*this.m31()*this.m13()-this.m10()*this.m01()*this.m33()+this.m00()*this.m11()*this.m33())/t,(this.m20()*this.m11()*this.m03()-this.m10()*this.m21()*this.m03()-this.m20()*this.m01()*this.m13()+this.m00()*this.m21()*this.m13()+this.m10()*this.m01()*this.m23()-this.m00()*this.m11()*this.m23())/t,(this.m30()*this.m21()*this.m12()-this.m20()*this.m31()*this.m12()-this.m30()*this.m11()*this.m22()+this.m10()*this.m31()*this.m22()+this.m20()*this.m11()*this.m32()-this.m10()*this.m21()*this.m32())/t,(-this.m30()*this.m21()*this.m02()+this.m20()*this.m31()*this.m02()+this.m30()*this.m01()*this.m22()-this.m00()*this.m31()*this.m22()-this.m20()*this.m01()*this.m32()+this.m00()*this.m21()*this.m32())/t,(this.m30()*this.m11()*this.m02()-this.m10()*this.m31()*this.m02()-this.m30()*this.m01()*this.m12()+this.m00()*this.m31()*this.m12()+this.m10()*this.m01()*this.m32()-this.m00()*this.m11()*this.m32())/t,(-this.m20()*this.m11()*this.m02()+this.m10()*this.m21()*this.m02()+this.m20()*this.m01()*this.m12()-this.m00()*this.m21()*this.m12()-this.m10()*this.m01()*this.m22()+this.m00()*this.m11()*this.m22())/t);throw new Error("Matrix could not be inverted, determinant === 0");default:throw new Error(`Matrix4.inverted with unknown type: ${this.type}`)}}timesMatrix(t){if(this.type===Types.IDENTITY||t.type===Types.IDENTITY)return this.type===Types.IDENTITY?t:this;if(this.type===t.type){if(this.type===Types.TRANSLATION_3D)return new Matrix4(1,0,0,this.m03()+t.m02(),0,1,0,this.m13()+t.m12(),0,0,1,this.m23()+t.m23(),0,0,0,1,Types.TRANSLATION_3D);if(this.type===Types.SCALING)return new Matrix4(this.m00()*t.m00(),0,0,0,0,this.m11()*t.m11(),0,0,0,0,this.m22()*t.m22(),0,0,0,0,1,Types.SCALING)}return this.type!==Types.OTHER&&t.type!==Types.OTHER?new Matrix4(this.m00()*t.m00()+this.m01()*t.m10()+this.m02()*t.m20(),this.m00()*t.m01()+this.m01()*t.m11()+this.m02()*t.m21(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02()*t.m22(),this.m00()*t.m03()+this.m01()*t.m13()+this.m02()*t.m23()+this.m03(),this.m10()*t.m00()+this.m11()*t.m10()+this.m12()*t.m20(),this.m10()*t.m01()+this.m11()*t.m11()+this.m12()*t.m21(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12()*t.m22(),this.m10()*t.m03()+this.m11()*t.m13()+this.m12()*t.m23()+this.m13(),this.m20()*t.m00()+this.m21()*t.m10()+this.m22()*t.m20(),this.m20()*t.m01()+this.m21()*t.m11()+this.m22()*t.m21(),this.m20()*t.m02()+this.m21()*t.m12()+this.m22()*t.m22(),this.m20()*t.m03()+this.m21()*t.m13()+this.m22()*t.m23()+this.m23(),0,0,0,1,Types.AFFINE):new Matrix4(this.m00()*t.m00()+this.m01()*t.m10()+this.m02()*t.m20()+this.m03()*t.m30(),this.m00()*t.m01()+this.m01()*t.m11()+this.m02()*t.m21()+this.m03()*t.m31(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02()*t.m22()+this.m03()*t.m32(),this.m00()*t.m03()+this.m01()*t.m13()+this.m02()*t.m23()+this.m03()*t.m33(),this.m10()*t.m00()+this.m11()*t.m10()+this.m12()*t.m20()+this.m13()*t.m30(),this.m10()*t.m01()+this.m11()*t.m11()+this.m12()*t.m21()+this.m13()*t.m31(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12()*t.m22()+this.m13()*t.m32(),this.m10()*t.m03()+this.m11()*t.m13()+this.m12()*t.m23()+this.m13()*t.m33(),this.m20()*t.m00()+this.m21()*t.m10()+this.m22()*t.m20()+this.m23()*t.m30(),this.m20()*t.m01()+this.m21()*t.m11()+this.m22()*t.m21()+this.m23()*t.m31(),this.m20()*t.m02()+this.m21()*t.m12()+this.m22()*t.m22()+this.m23()*t.m32(),this.m20()*t.m03()+this.m21()*t.m13()+this.m22()*t.m23()+this.m23()*t.m33(),this.m30()*t.m00()+this.m31()*t.m10()+this.m32()*t.m20()+this.m33()*t.m30(),this.m30()*t.m01()+this.m31()*t.m11()+this.m32()*t.m21()+this.m33()*t.m31(),this.m30()*t.m02()+this.m31()*t.m12()+this.m32()*t.m22()+this.m33()*t.m32(),this.m30()*t.m03()+this.m31()*t.m13()+this.m32()*t.m23()+this.m33()*t.m33())}timesVector4(t){const s=this.m00()*t.x+this.m01()*t.y+this.m02()*t.z+this.m03()*t.w,r=this.m10()*t.x+this.m11()*t.y+this.m12()*t.z+this.m13()*t.w,o=this.m20()*t.x+this.m21()*t.y+this.m22()*t.z+this.m23()*t.w,n=this.m30()*t.x+this.m31()*t.y+this.m32()*t.z+this.m33()*t.w;return new Vector4(s,r,o,n)}timesVector3(t){return this.timesVector4(t.toVector4()).toVector3()}timesTransposeVector4(t){const s=this.m00()*t.x+this.m10()*t.y+this.m20()*t.z+this.m30()*t.w,r=this.m01()*t.x+this.m11()*t.y+this.m21()*t.z+this.m31()*t.w,o=this.m02()*t.x+this.m12()*t.y+this.m22()*t.z+this.m32()*t.w,n=this.m03()*t.x+this.m13()*t.y+this.m23()*t.z+this.m33()*t.w;return new Vector4(s,r,o,n)}timesTransposeVector3(t){return this.timesTransposeVector4(t.toVector4()).toVector3()}timesRelativeVector3(t){const s=this.m00()*t.x+this.m10()*t.y+this.m20()*t.z,r=this.m01()*t.y+this.m11()*t.y+this.m21()*t.z,o=this.m02()*t.z+this.m12()*t.y+this.m22()*t.z;return new Vector3(s,r,o)}getDeterminant(){return this.m03()*this.m12()*this.m21()*this.m30()-this.m02()*this.m13()*this.m21()*this.m30()-this.m03()*this.m11()*this.m22()*this.m30()+this.m01()*this.m13()*this.m22()*this.m30()+this.m02()*this.m11()*this.m23()*this.m30()-this.m01()*this.m12()*this.m23()*this.m30()-this.m03()*this.m12()*this.m20()*this.m31()+this.m02()*this.m13()*this.m20()*this.m31()+this.m03()*this.m10()*this.m22()*this.m31()-this.m00()*this.m13()*this.m22()*this.m31()-this.m02()*this.m10()*this.m23()*this.m31()+this.m00()*this.m12()*this.m23()*this.m31()+this.m03()*this.m11()*this.m20()*this.m32()-this.m01()*this.m13()*this.m20()*this.m32()-this.m03()*this.m10()*this.m21()*this.m32()+this.m00()*this.m13()*this.m21()*this.m32()+this.m01()*this.m10()*this.m23()*this.m32()-this.m00()*this.m11()*this.m23()*this.m32()-this.m02()*this.m11()*this.m20()*this.m33()+this.m01()*this.m12()*this.m20()*this.m33()+this.m02()*this.m10()*this.m21()*this.m33()-this.m00()*this.m12()*this.m21()*this.m33()-this.m01()*this.m10()*this.m22()*this.m33()+this.m00()*this.m11()*this.m22()*this.m33()}get determinant(){return this.getDeterminant()}toString(){return`${this.m00()} ${this.m01()} ${this.m02()} ${this.m03()}
${this.m10()} ${this.m11()} ${this.m12()} ${this.m13()}
${this.m20()} ${this.m21()} ${this.m22()} ${this.m23()}
${this.m30()} ${this.m31()} ${this.m32()} ${this.m33()}`}makeImmutable(){return assert&&(this.rowMajor=()=>{throw new Error("Cannot modify immutable matrix")}),this}copyToArray(t){return t[0]=this.m00(),t[1]=this.m10(),t[2]=this.m20(),t[3]=this.m30(),t[4]=this.m01(),t[5]=this.m11(),t[6]=this.m21(),t[7]=this.m31(),t[8]=this.m02(),t[9]=this.m12(),t[10]=this.m22(),t[11]=this.m32(),t[12]=this.m03(),t[13]=this.m13(),t[14]=this.m23(),t[15]=this.m33(),t}static identity(){return new Matrix4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,Types.IDENTITY)}static translation(t,s,r){return new Matrix4(1,0,0,t,0,1,0,s,0,0,1,r,0,0,0,1,Types.TRANSLATION_3D)}static translationFromVector(t){return Matrix4.translation(t.x,t.y,t.z)}static scaling(t,s,r){return s=s===void 0?t:s,r=r===void 0?t:r,new Matrix4(t,0,0,0,0,s,0,0,0,0,r,0,0,0,0,1,Types.SCALING)}static rotationAxisAngle(t,s){const r=Math.cos(s),o=Math.sin(s),n=1-r;return new Matrix4(t.x*t.x*n+r,t.x*t.y*n-t.z*o,t.x*t.z*n+t.y*o,0,t.y*t.x*n+t.z*o,t.y*t.y*n+r,t.y*t.z*n-t.x*o,0,t.z*t.x*n-t.y*o,t.z*t.y*n+t.x*o,t.z*t.z*n+r,0,0,0,0,1,Types.AFFINE)}static rotationX(t){const s=Math.cos(t),r=Math.sin(t);return new Matrix4(1,0,0,0,0,s,-r,0,0,r,s,0,0,0,0,1,Types.AFFINE)}static rotationY(t){const s=Math.cos(t),r=Math.sin(t);return new Matrix4(s,0,r,0,0,1,0,0,-r,0,s,0,0,0,0,1,Types.AFFINE)}static rotationZ(t){const s=Math.cos(t),r=Math.sin(t);return new Matrix4(s,-r,0,0,r,s,0,0,0,0,1,0,0,0,0,1,Types.AFFINE)}static gluPerspective(t,s,r,o){const n=Math.cos(t)/Math.sin(t);return new Matrix4(n/s,0,0,0,0,n,0,0,0,0,(o+r)/(r-o),2*o*r/(r-o),0,0,-1,0)}}dot.register("Matrix4",Matrix4);const ar=class ar extends EnumerationValue{};gt(ar,"OTHER",new ar),gt(ar,"IDENTITY",new ar),gt(ar,"TRANSLATION_3D",new ar),gt(ar,"SCALING",new ar),gt(ar,"AFFINE",new ar),gt(ar,"enumeration",new Enumeration(ar));let Types=ar;Matrix4.Types=Types;Matrix4.IDENTITY=new Matrix4().makeImmutable();function toSVGNumber(a){return a.toFixed(20)}dot.register("toSVGNumber",toSVGNumber);const lr=class lr extends EnumerationValue{};lr.OTHER=new lr,lr.IDENTITY=new lr,lr.TRANSLATION_2D=new lr,lr.SCALING=new lr,lr.AFFINE=new lr,lr.enumeration=new Enumeration(lr);let Matrix3Type=lr;const hr=class hr{constructor(){assert&&assert(arguments.length===0,"Matrix3 constructor should not be called with any arguments.  Use m3()/Matrix3.identity()/etc."),this.entries=[1,0,0,0,1,0,0,0,1],this.type=Matrix3Type.IDENTITY}initialize(){return this}m00(){return this.entries[0]}m01(){return this.entries[3]}m02(){return this.entries[6]}m10(){return this.entries[1]}m11(){return this.entries[4]}m12(){return this.entries[7]}m20(){return this.entries[2]}m21(){return this.entries[5]}m22(){return this.entries[8]}isIdentity(){return this.type===Matrix3Type.IDENTITY||this.equals(hr.IDENTITY)}isFastIdentity(){return this.type===Matrix3Type.IDENTITY}isTranslation(){return this.type===Matrix3Type.TRANSLATION_2D||this.m00()===1&&this.m11()===1&&this.m22()===1&&this.m01()===0&&this.m10()===0&&this.m20()===0&&this.m21()===0}isAffine(){return this.type===Matrix3Type.AFFINE||this.m20()===0&&this.m21()===0&&this.m22()===1}isAligned(){return this.isAffine()&&this.m01()===0&&this.m10()===0}isAxisAligned(){return this.isAffine()&&(this.m01()===0&&this.m10()===0||this.m00()===0&&this.m11()===0)}isFinite(){return isFinite(this.m00())&&isFinite(this.m01())&&isFinite(this.m02())&&isFinite(this.m10())&&isFinite(this.m11())&&isFinite(this.m12())&&isFinite(this.m20())&&isFinite(this.m21())&&isFinite(this.m22())}getDeterminant(){return this.m00()*this.m11()*this.m22()+this.m01()*this.m12()*this.m20()+this.m02()*this.m10()*this.m21()-this.m02()*this.m11()*this.m20()-this.m01()*this.m10()*this.m22()-this.m00()*this.m12()*this.m21()}get determinant(){return this.getDeterminant()}getTranslation(){return new Vector2(this.m02(),this.m12())}get translation(){return this.getTranslation()}getScaleVector(){return new Vector2(Math.sqrt(this.m00()*this.m00()+this.m10()*this.m10()),Math.sqrt(this.m01()*this.m01()+this.m11()*this.m11()))}get scaleVector(){return this.getScaleVector()}getSignedScale(){return this.m00()*this.m11()-this.m10()*this.m01()}getRotation(){return Math.atan2(this.m10(),this.m00())}get rotation(){return this.getRotation()}toMatrix4(){return new Matrix4(this.m00(),this.m01(),this.m02(),0,this.m10(),this.m11(),this.m12(),0,this.m20(),this.m21(),this.m22(),0,0,0,0,1)}toAffineMatrix4(){return new Matrix4(this.m00(),this.m01(),0,this.m02(),this.m10(),this.m11(),0,this.m12(),0,0,1,0,0,0,0,1)}toString(){return`${this.m00()} ${this.m01()} ${this.m02()}
${this.m10()} ${this.m11()} ${this.m12()}
${this.m20()} ${this.m21()} ${this.m22()}`}toSVGMatrix(){const t=document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix();return t.a=this.m00(),t.b=this.m10(),t.c=this.m01(),t.d=this.m11(),t.e=this.m02(),t.f=this.m12(),t}getCSSTransform(){return`matrix(${this.entries[0].toFixed(20)},${this.entries[1].toFixed(20)},${this.entries[3].toFixed(20)},${this.entries[4].toFixed(20)},${this.entries[6].toFixed(20)},${this.entries[7].toFixed(20)})`}get cssTransform(){return this.getCSSTransform()}getSVGTransform(){switch(this.type){case Matrix3Type.IDENTITY:return"";case Matrix3Type.TRANSLATION_2D:return`translate(${toSVGNumber(this.entries[6])},${toSVGNumber(this.entries[7])})`;case Matrix3Type.SCALING:return`scale(${toSVGNumber(this.entries[0])}${this.entries[0]===this.entries[4]?"":`,${toSVGNumber(this.entries[4])}`})`;default:return`matrix(${toSVGNumber(this.entries[0])},${toSVGNumber(this.entries[1])},${toSVGNumber(this.entries[3])},${toSVGNumber(this.entries[4])},${toSVGNumber(this.entries[6])},${toSVGNumber(this.entries[7])})`}}get svgTransform(){return this.getSVGTransform()}getCSSTransformStyles(){const t=this.getCSSTransform();return{"-webkit-perspective":"1000","-webkit-backface-visibility":"hidden","-webkit-transform":`${t} translateZ(0)`,"-moz-transform":`${t} translateZ(0)`,"-ms-transform":t,"-o-transform":t,transform:t,"transform-origin":"top left","-ms-transform-origin":"top left"}}get cssTransformStyles(){return this.getCSSTransformStyles()}equals(t){return this.m00()===t.m00()&&this.m01()===t.m01()&&this.m02()===t.m02()&&this.m10()===t.m10()&&this.m11()===t.m11()&&this.m12()===t.m12()&&this.m20()===t.m20()&&this.m21()===t.m21()&&this.m22()===t.m22()}equalsEpsilon(t,s){return Math.abs(this.m00()-t.m00())<s&&Math.abs(this.m01()-t.m01())<s&&Math.abs(this.m02()-t.m02())<s&&Math.abs(this.m10()-t.m10())<s&&Math.abs(this.m11()-t.m11())<s&&Math.abs(this.m12()-t.m12())<s&&Math.abs(this.m20()-t.m20())<s&&Math.abs(this.m21()-t.m21())<s&&Math.abs(this.m22()-t.m22())<s}copy(){return m3(this.m00(),this.m01(),this.m02(),this.m10(),this.m11(),this.m12(),this.m20(),this.m21(),this.m22(),this.type)}plus(t){return m3(this.m00()+t.m00(),this.m01()+t.m01(),this.m02()+t.m02(),this.m10()+t.m10(),this.m11()+t.m11(),this.m12()+t.m12(),this.m20()+t.m20(),this.m21()+t.m21(),this.m22()+t.m22())}minus(t){return m3(this.m00()-t.m00(),this.m01()-t.m01(),this.m02()-t.m02(),this.m10()-t.m10(),this.m11()-t.m11(),this.m12()-t.m12(),this.m20()-t.m20(),this.m21()-t.m21(),this.m22()-t.m22())}transposed(){return m3(this.m00(),this.m10(),this.m20(),this.m01(),this.m11(),this.m21(),this.m02(),this.m12(),this.m22(),this.type===Matrix3Type.IDENTITY||this.type===Matrix3Type.SCALING?this.type:void 0)}negated(){return m3(-this.m00(),-this.m01(),-this.m02(),-this.m10(),-this.m11(),-this.m12(),-this.m20(),-this.m21(),-this.m22())}inverted(){let t;switch(this.type){case Matrix3Type.IDENTITY:return this;case Matrix3Type.TRANSLATION_2D:return m3(1,0,-this.m02(),0,1,-this.m12(),0,0,1,Matrix3Type.TRANSLATION_2D);case Matrix3Type.SCALING:return m3(1/this.m00(),0,0,0,1/this.m11(),0,0,0,1/this.m22(),Matrix3Type.SCALING);case Matrix3Type.AFFINE:if(t=this.getDeterminant(),t!==0)return m3((-this.m12()*this.m21()+this.m11()*this.m22())/t,(this.m02()*this.m21()-this.m01()*this.m22())/t,(-this.m02()*this.m11()+this.m01()*this.m12())/t,(this.m12()*this.m20()-this.m10()*this.m22())/t,(-this.m02()*this.m20()+this.m00()*this.m22())/t,(this.m02()*this.m10()-this.m00()*this.m12())/t,0,0,1,Matrix3Type.AFFINE);throw new Error("Matrix could not be inverted, determinant === 0");case Matrix3Type.OTHER:if(t=this.getDeterminant(),t!==0)return m3((-this.m12()*this.m21()+this.m11()*this.m22())/t,(this.m02()*this.m21()-this.m01()*this.m22())/t,(-this.m02()*this.m11()+this.m01()*this.m12())/t,(this.m12()*this.m20()-this.m10()*this.m22())/t,(-this.m02()*this.m20()+this.m00()*this.m22())/t,(this.m02()*this.m10()-this.m00()*this.m12())/t,(-this.m11()*this.m20()+this.m10()*this.m21())/t,(this.m01()*this.m20()-this.m00()*this.m21())/t,(-this.m01()*this.m10()+this.m00()*this.m11())/t,Matrix3Type.OTHER);throw new Error("Matrix could not be inverted, determinant === 0");default:throw new Error(`Matrix3.inverted with unknown type: ${this.type}`)}}timesMatrix(t){if(this.type===Matrix3Type.IDENTITY||t.type===Matrix3Type.IDENTITY)return this.type===Matrix3Type.IDENTITY?t:this;if(this.type===t.type){if(this.type===Matrix3Type.TRANSLATION_2D)return m3(1,0,this.m02()+t.m02(),0,1,this.m12()+t.m12(),0,0,1,Matrix3Type.TRANSLATION_2D);if(this.type===Matrix3Type.SCALING)return m3(this.m00()*t.m00(),0,0,0,this.m11()*t.m11(),0,0,0,1,Matrix3Type.SCALING)}return this.type!==Matrix3Type.OTHER&&t.type!==Matrix3Type.OTHER?m3(this.m00()*t.m00()+this.m01()*t.m10(),this.m00()*t.m01()+this.m01()*t.m11(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02(),this.m10()*t.m00()+this.m11()*t.m10(),this.m10()*t.m01()+this.m11()*t.m11(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12(),0,0,1,Matrix3Type.AFFINE):m3(this.m00()*t.m00()+this.m01()*t.m10()+this.m02()*t.m20(),this.m00()*t.m01()+this.m01()*t.m11()+this.m02()*t.m21(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02()*t.m22(),this.m10()*t.m00()+this.m11()*t.m10()+this.m12()*t.m20(),this.m10()*t.m01()+this.m11()*t.m11()+this.m12()*t.m21(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12()*t.m22(),this.m20()*t.m00()+this.m21()*t.m10()+this.m22()*t.m20(),this.m20()*t.m01()+this.m21()*t.m11()+this.m22()*t.m21(),this.m20()*t.m02()+this.m21()*t.m12()+this.m22()*t.m22())}timesVector2(t){const s=this.m00()*t.x+this.m01()*t.y+this.m02(),r=this.m10()*t.x+this.m11()*t.y+this.m12();return new Vector2(s,r)}timesVector3(t){const s=this.m00()*t.x+this.m01()*t.y+this.m02()*t.z,r=this.m10()*t.x+this.m11()*t.y+this.m12()*t.z,o=this.m20()*t.x+this.m21()*t.y+this.m22()*t.z;return new Vector3(s,r,o)}timesTransposeVector2(t){const s=this.m00()*t.x+this.m10()*t.y,r=this.m01()*t.x+this.m11()*t.y;return new Vector2(s,r)}timesRelativeVector2(t){const s=this.m00()*t.x+this.m01()*t.y,r=this.m10()*t.y+this.m11()*t.y;return new Vector2(s,r)}rowMajor(t,s,r,o,n,l,h,g,d,A){return this.entries[0]=t,this.entries[1]=o,this.entries[2]=h,this.entries[3]=s,this.entries[4]=n,this.entries[5]=g,this.entries[6]=r,this.entries[7]=l,this.entries[8]=d,this.type=A===void 0?h===0&&g===0&&d===1?Matrix3Type.AFFINE:Matrix3Type.OTHER:A,this}set(t){return this.rowMajor(t.m00(),t.m01(),t.m02(),t.m10(),t.m11(),t.m12(),t.m20(),t.m21(),t.m22(),t.type)}setArray(t){return this.rowMajor(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8])}set00(t){return this.entries[0]=t,this}set01(t){return this.entries[3]=t,this}set02(t){return this.entries[6]=t,this}set10(t){return this.entries[1]=t,this}set11(t){return this.entries[4]=t,this}set12(t){return this.entries[7]=t,this}set20(t){return this.entries[2]=t,this}set21(t){return this.entries[5]=t,this}set22(t){return this.entries[8]=t,this}makeImmutable(){return assert&&(this.rowMajor=()=>{throw new Error("Cannot modify immutable matrix")}),this}columnMajor(t,s,r,o,n,l,h,g,d,A){return this.rowMajor(t,o,h,s,n,g,r,l,d,A)}add(t){return this.rowMajor(this.m00()+t.m00(),this.m01()+t.m01(),this.m02()+t.m02(),this.m10()+t.m10(),this.m11()+t.m11(),this.m12()+t.m12(),this.m20()+t.m20(),this.m21()+t.m21(),this.m22()+t.m22())}subtract(t){return this.rowMajor(this.m00()-t.m00(),this.m01()-t.m01(),this.m02()-t.m02(),this.m10()-t.m10(),this.m11()-t.m11(),this.m12()-t.m12(),this.m20()-t.m20(),this.m21()-t.m21(),this.m22()-t.m22())}transpose(){return this.rowMajor(this.m00(),this.m10(),this.m20(),this.m01(),this.m11(),this.m21(),this.m02(),this.m12(),this.m22(),this.type===Matrix3Type.IDENTITY||this.type===Matrix3Type.SCALING?this.type:void 0)}negate(){return this.rowMajor(-this.m00(),-this.m01(),-this.m02(),-this.m10(),-this.m11(),-this.m12(),-this.m20(),-this.m21(),-this.m22())}invert(){let t;switch(this.type){case Matrix3Type.IDENTITY:return this;case Matrix3Type.TRANSLATION_2D:return this.rowMajor(1,0,-this.m02(),0,1,-this.m12(),0,0,1,Matrix3Type.TRANSLATION_2D);case Matrix3Type.SCALING:return this.rowMajor(1/this.m00(),0,0,0,1/this.m11(),0,0,0,1/this.m22(),Matrix3Type.SCALING);case Matrix3Type.AFFINE:if(t=this.getDeterminant(),t!==0)return this.rowMajor((-this.m12()*this.m21()+this.m11()*this.m22())/t,(this.m02()*this.m21()-this.m01()*this.m22())/t,(-this.m02()*this.m11()+this.m01()*this.m12())/t,(this.m12()*this.m20()-this.m10()*this.m22())/t,(-this.m02()*this.m20()+this.m00()*this.m22())/t,(this.m02()*this.m10()-this.m00()*this.m12())/t,0,0,1,Matrix3Type.AFFINE);throw new Error("Matrix could not be inverted, determinant === 0");case Matrix3Type.OTHER:if(t=this.getDeterminant(),t!==0)return this.rowMajor((-this.m12()*this.m21()+this.m11()*this.m22())/t,(this.m02()*this.m21()-this.m01()*this.m22())/t,(-this.m02()*this.m11()+this.m01()*this.m12())/t,(this.m12()*this.m20()-this.m10()*this.m22())/t,(-this.m02()*this.m20()+this.m00()*this.m22())/t,(this.m02()*this.m10()-this.m00()*this.m12())/t,(-this.m11()*this.m20()+this.m10()*this.m21())/t,(this.m01()*this.m20()-this.m00()*this.m21())/t,(-this.m01()*this.m10()+this.m00()*this.m11())/t,Matrix3Type.OTHER);throw new Error("Matrix could not be inverted, determinant === 0");default:throw new Error(`Matrix3.inverted with unknown type: ${this.type}`)}}multiplyMatrix(t){if(t.type===Matrix3Type.IDENTITY)return this;if(this.type===Matrix3Type.IDENTITY)return this.set(t);if(this.type===t.type){if(this.type===Matrix3Type.TRANSLATION_2D)return this.rowMajor(1,0,this.m02()+t.m02(),0,1,this.m12()+t.m12(),0,0,1,Matrix3Type.TRANSLATION_2D);if(this.type===Matrix3Type.SCALING)return this.rowMajor(this.m00()*t.m00(),0,0,0,this.m11()*t.m11(),0,0,0,1,Matrix3Type.SCALING)}return this.type!==Matrix3Type.OTHER&&t.type!==Matrix3Type.OTHER?this.rowMajor(this.m00()*t.m00()+this.m01()*t.m10(),this.m00()*t.m01()+this.m01()*t.m11(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02(),this.m10()*t.m00()+this.m11()*t.m10(),this.m10()*t.m01()+this.m11()*t.m11(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12(),0,0,1,Matrix3Type.AFFINE):this.rowMajor(this.m00()*t.m00()+this.m01()*t.m10()+this.m02()*t.m20(),this.m00()*t.m01()+this.m01()*t.m11()+this.m02()*t.m21(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02()*t.m22(),this.m10()*t.m00()+this.m11()*t.m10()+this.m12()*t.m20(),this.m10()*t.m01()+this.m11()*t.m11()+this.m12()*t.m21(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12()*t.m22(),this.m20()*t.m00()+this.m21()*t.m10()+this.m22()*t.m20(),this.m20()*t.m01()+this.m21()*t.m11()+this.m22()*t.m21(),this.m20()*t.m02()+this.m21()*t.m12()+this.m22()*t.m22())}prependTranslation(t,s){return this.set02(this.m02()+t),this.set12(this.m12()+s),this.type===Matrix3Type.IDENTITY||this.type===Matrix3Type.TRANSLATION_2D?this.type=Matrix3Type.TRANSLATION_2D:this.type===Matrix3Type.OTHER?this.type=Matrix3Type.OTHER:this.type=Matrix3Type.AFFINE,this}setToIdentity(){return this.rowMajor(1,0,0,0,1,0,0,0,1,Matrix3Type.IDENTITY)}setToTranslation(t,s){return this.rowMajor(1,0,t,0,1,s,0,0,1,Matrix3Type.TRANSLATION_2D)}setToScale(t,s){return s=s===void 0?t:s,this.rowMajor(t,0,0,0,s,0,0,0,1,Matrix3Type.SCALING)}setToAffine(t,s,r,o,n,l){return this.rowMajor(t,s,r,o,n,l,0,0,1,Matrix3Type.AFFINE)}setToRotationAxisAngle(t,s){let r=Math.cos(s),o=Math.sin(s);Math.abs(r)<1e-15&&(r=0),Math.abs(o)<1e-15&&(o=0);const n=1-r;return this.rowMajor(t.x*t.x*n+r,t.x*t.y*n-t.z*o,t.x*t.z*n+t.y*o,t.y*t.x*n+t.z*o,t.y*t.y*n+r,t.y*t.z*n-t.x*o,t.z*t.x*n-t.y*o,t.z*t.y*n+t.x*o,t.z*t.z*n+r,Matrix3Type.OTHER)}setToRotationX(t){let s=Math.cos(t),r=Math.sin(t);return Math.abs(s)<1e-15&&(s=0),Math.abs(r)<1e-15&&(r=0),this.rowMajor(1,0,0,0,s,-r,0,r,s,Matrix3Type.OTHER)}setToRotationY(t){let s=Math.cos(t),r=Math.sin(t);return Math.abs(s)<1e-15&&(s=0),Math.abs(r)<1e-15&&(r=0),this.rowMajor(s,0,r,0,1,0,-r,0,s,Matrix3Type.OTHER)}setToRotationZ(t){let s=Math.cos(t),r=Math.sin(t);return Math.abs(s)<1e-15&&(s=0),Math.abs(r)<1e-15&&(r=0),this.rowMajor(s,-r,0,r,s,0,0,0,1,Matrix3Type.AFFINE)}setToTranslationRotation(t,s,r){let o=Math.cos(r),n=Math.sin(r);return Math.abs(o)<1e-15&&(o=0),Math.abs(n)<1e-15&&(n=0),this.rowMajor(o,-n,t,n,o,s,0,0,1,Matrix3Type.AFFINE)}setToTranslationRotationPoint(t,s){return this.setToTranslationRotation(t.x,t.y,s)}setToSVGMatrix(t){return this.rowMajor(t.a,t.c,t.e,t.b,t.d,t.f,0,0,1,Matrix3Type.AFFINE)}setRotationAToB(t,s){const r=t,o=s,n=1e-4;let l=r.cross(o);const h=r.dot(o);if((h<0?-h:h)>1-n){let d=new Vector3(r.x>0?r.x:-r.x,r.y>0?r.y:-r.y,r.z>0?r.z:-r.z);d.x<d.y?d.x<d.z?d=Vector3.X_UNIT:d=Vector3.Z_UNIT:d.y<d.z?d=Vector3.Y_UNIT:d=Vector3.Z_UNIT;const A=d.minus(r);l=d.minus(o);const S=2/A.dot(A),O=2/l.dot(l),I=S*O*A.dot(l);return this.rowMajor(-S*A.x*A.x-O*l.x*l.x+I*l.x*A.x+1,-S*A.x*A.y-O*l.x*l.y+I*l.x*A.y,-S*A.x*A.z-O*l.x*l.z+I*l.x*A.z,-S*A.y*A.x-O*l.y*l.x+I*l.y*A.x,-S*A.y*A.y-O*l.y*l.y+I*l.y*A.y+1,-S*A.y*A.z-O*l.y*l.z+I*l.y*A.z,-S*A.z*A.x-O*l.z*l.x+I*l.z*A.x,-S*A.z*A.y-O*l.z*l.y+I*l.z*A.y,-S*A.z*A.z-O*l.z*l.z+I*l.z*A.z+1)}else{const d=1/(1+h),A=d*l.x,S=d*l.z,O=A*l.y,I=A*l.z,W=S*l.y;return this.rowMajor(h+A*l.x,O-l.z,I+l.y,O+l.z,h+d*l.y*l.y,W-l.x,I-l.y,W+l.x,h+S*l.z)}}multiplyVector2(t){return t.setXY(this.m00()*t.x+this.m01()*t.y+this.m02(),this.m10()*t.x+this.m11()*t.y+this.m12())}multiplyVector3(t){return t.setXYZ(this.m00()*t.x+this.m01()*t.y+this.m02()*t.z,this.m10()*t.x+this.m11()*t.y+this.m12()*t.z,this.m20()*t.x+this.m21()*t.y+this.m22()*t.z)}multiplyTransposeVector2(t){return t.setXY(this.m00()*t.x+this.m10()*t.y,this.m01()*t.x+this.m11()*t.y)}multiplyRelativeVector2(t){return t.setXY(this.m00()*t.x+this.m01()*t.y,this.m10()*t.y+this.m11()*t.y)}canvasSetTransform(t){t.setTransform(this.entries[0],this.entries[1],this.entries[3],this.entries[4],this.entries[6],this.entries[7])}canvasAppendTransform(t){this.type!==Matrix3Type.IDENTITY&&t.transform(this.entries[0],this.entries[1],this.entries[3],this.entries[4],this.entries[6],this.entries[7])}copyToArray(t){return t[0]=this.m00(),t[1]=this.m10(),t[2]=this.m20(),t[3]=this.m01(),t[4]=this.m11(),t[5]=this.m21(),t[6]=this.m02(),t[7]=this.m12(),t[8]=this.m22(),t}freeToPool(){hr.pool.freeToPool(this)}static identity(){return fromPool().setToIdentity()}static translation(t,s){return fromPool().setToTranslation(t,s)}static translationFromVector(t){return hr.translation(t.x,t.y)}static scaling(t,s){return fromPool().setToScale(t,s)}static scale(t,s){return hr.scaling(t,s)}static affine(t,s,r,o,n,l){return fromPool().setToAffine(t,s,r,o,n,l)}static rowMajor(t,s,r,o,n,l,h,g,d,A){return fromPool().rowMajor(t,s,r,o,n,l,h,g,d,A)}static rotationAxisAngle(t,s){return fromPool().setToRotationAxisAngle(t,s)}static rotationX(t){return fromPool().setToRotationX(t)}static rotationY(t){return fromPool().setToRotationY(t)}static rotationZ(t){return fromPool().setToRotationZ(t)}static translationRotation(t,s,r){return fromPool().setToTranslationRotation(t,s,r)}static rotation2(t){return fromPool().setToRotationZ(t)}static rotationAround(t,s,r){return hr.translation(s,r).timesMatrix(hr.rotation2(t)).timesMatrix(hr.translation(-s,-r))}static rotationAroundPoint(t,s){return hr.rotationAround(t,s.x,s.y)}static fromSVGMatrix(t){return fromPool().setToSVGMatrix(t)}static rotateAToB(t,s){return fromPool().setRotationAToB(t,s)}static translationTimesMatrix(t,s,r){let o;return r.type===Matrix3Type.IDENTITY||r.type===Matrix3Type.TRANSLATION_2D?m3(1,0,r.m02()+t,0,1,r.m12()+s,0,0,1,Matrix3Type.TRANSLATION_2D):(r.type===Matrix3Type.OTHER?o=Matrix3Type.OTHER:o=Matrix3Type.AFFINE,m3(r.m00(),r.m01(),r.m02()+t,r.m10(),r.m11(),r.m12()+s,r.m20(),r.m21(),r.m22(),o))}static toStateObject(t){return{entries:t.entries,type:t.type.name}}static fromStateObject(t){const s=hr.identity();return s.entries=t.entries,s.type=Matrix3Type.enumeration.getValue(t.type),s}};hr.pool=new Pool(hr,{initialize:hr.prototype.initialize,useDefaultConstruction:!0,maxSize:300});let Matrix3=hr;dot.register("Matrix3",Matrix3);const fromPool=Matrix3.pool.fetch.bind(Matrix3.pool),m3=(a,t,s,r,o,n,l,h,g,d)=>fromPool().rowMajor(a,t,s,r,o,n,l,h,g,d);dot.register("m3",m3);Matrix3.IDENTITY=Matrix3.identity().makeImmutable();Matrix3.X_REFLECTION=m3(-1,0,0,0,1,0,0,0,1,Matrix3Type.AFFINE).makeImmutable();Matrix3.Y_REFLECTION=m3(1,0,0,0,-1,0,0,0,1,Matrix3Type.AFFINE).makeImmutable();Matrix3.Matrix3IO=new IOType("Matrix3IO",{valueType:Matrix3,documentation:"A 3x3 matrix often used for holding transform data.",toStateObject:a=>Matrix3.toStateObject(a),fromStateObject:Matrix3.fromStateObject,stateSchema:{entries:ArrayIO(NumberIO),type:EnumerationIO(Matrix3Type)}});class OpenRange extends Range{constructor(t,s,r){r=merge({openMin:!0,openMax:!0},r),super(t,s),this.openMin=r.openMin,this.openMax=r.openMax,assert&&assert(this.openMin||this.openMax,"use Range type if min and max are inclusive"),assert&&assert(t<s,"must instantiate OpenRange with min strictly less than max")}setMin(t){assert&&assert(t<this._max,"min must be strictly less than max for OpenRange"),super.setMin(t)}setMax(t){assert&&assert(t>this._min,"max must be strictly greater than min for OpenRange"),super.setMax(t)}setMinMax(t,s){assert&&assert(t<s,"min must be strictly less than max in OpenRange"),super.setMinMax(t,s)}contains(t){return(this.openMin?t>this.min:t>=this.min)&&(this.openMax?t<this.max:t<=this.max)}containsRange(t){return(this.openMin?this.min<t.min:this.min<=t.min)&&(this.openMax?this.max>t.max:this.max>=t.max)}intersects(t){return(this.openMax?this.max>t.min:this.max>=t.min)&&(this.openMin?t.max>this.min:t.max>=this.min)}toString(){const t=this.openMin?"(":"[",s=this.openMax?")":"]";return`[Range ${t}min:${this.min} max:${this.max}${s}]`}constrainValue(t){return Math.min(Math.max(t,this.min),this.max)}equals(t){return t instanceof Range&&this.min===t.min&&this.max===t.max&&this.openMin===t.openMin&&this.openMax===t.openMax}}dot.register("OpenRange",OpenRange);class Permutation{constructor(t){this.indices=t}size(){return this.indices.length}apply(t){if(typeof t=="number")return this.indices[t];{if(t.length!==this.size())throw new Error(`Permutation length ${this.size()} not equal to list length ${t.length}`);const s=new Array(t.length);for(let r=0;r<t.length;r++)s[r]=t[this.indices[r]];return s}}inverted(){const t=new Array(this.size());for(let s=0;s<this.size();s++)t[this.indices[s]]=s;return new Permutation(t)}withIndicesPermuted(t){const s=[];return Permutation.forEachPermutation(t,r=>{const o=this.indices,n=o.slice(0);for(let l=0;l<t.length;l++)n[t[l]]=o[r[l]];s.push(new Permutation(n))}),s}toString(){return`P[${this.indices.join(", ")}]`}equals(t){return this.indices.length===t.indices.length&&_.isEqual(this.indices,t.indices)}static identity(t){assert&&assert(t>=0);const s=new Array(t);for(let r=0;r<t;r++)s[r]=r;return new Permutation(s)}static permutations(t){const s=[];return Permutation.forEachPermutation(DotUtils.rangeInclusive(0,t-1),r=>{s.push(new Permutation(r.slice()))}),s}static forEachPermutation(t,s){recursiveForEachPermutation(t,[],s)}static permutationsOf(t){const s=[];return Permutation.forEachPermutation(t,r=>{s.push(r.slice())}),s}}dot.register("Permutation",Permutation);function recursiveForEachPermutation(a,t,s){if(a.length===0)s(t);else for(let r=0;r<a.length;r++){const o=a[r],n=a.slice(0);n.splice(r,1);const l=t.slice(0);l.push(o),recursiveForEachPermutation(n,l,s)}}class PiecewiseLinearFunction{constructor(t){assert&&assert(t.length%2===0,"array length should be even"),assert&&assert(t.length>0,"array must have elements"),assert&&assert(Array.isArray(t),"array should be an array"),this.array=t}evaluate(t){return PiecewiseLinearFunction.evaluate(this.array,t)}static evaluate(t,s){let r=-1,o=Number.POSITIVE_INFINITY,n=-1,l=Number.POSITIVE_INFINITY;for(let S=0;S<t.length;S+=2){const O=t[S],I=s-O,W=Math.abs(I);if(O===s)return t[S+1];O<=s&&W<o&&(r=S,o=W),O>=s&&W<l&&(n=S,l=W)}assert&&assert(r>=0,"lower bound not found"),assert&&assert(n>=0,"upper bound not found");const h=t[r],g=t[r+1],d=t[n],A=t[n+1];return DotUtils.linear(h,d,g,A,s)}}dot.register("PiecewiseLinearFunction",PiecewiseLinearFunction);class Ray3{constructor(t,s){this.position=t,this.direction=s,assert&&assert(Math.abs(s.magnitude-1)<.01,"the direction must be a unit vector")}shifted(t){return new Ray3(this.pointAtDistance(t),this.direction)}pointAtDistance(t){return this.position.plus(this.direction.timesScalar(t))}distanceToPlane(t){return(t.distance-this.position.dot(t.normal))/this.direction.dot(t.normal)}toString(){return`${this.position.toString()} => ${this.direction.toString()}`}}dot.register("Ray3",Ray3);const Co=class Co{constructor(t,s){this.normal=t,this.distance=s,assert&&assert(Math.abs(t.magnitude-1)<.01,"the normal vector must be a unit vector")}intersectWithRay(t){return t.pointAtDistance(t.distanceToPlane(this))}static fromTriangle(t,s,r){const o=r.minus(t).cross(s.minus(t));return o.magnitude===0?null:(o.normalize(),new Co(o,o.dot(t)))}getIntersection(t){const s=this.normal.dot(t.normal),r=1-s*s;if(r===0)return null;const o=(this.distance-t.distance*s)/r,n=(t.distance-this.distance*s)/r;return new Ray3(this.normal.timesScalar(o).plus(t.normal.timesScalar(n)),this.normal.cross(t.normal).normalized())}};Co.XY=new Co(new Vector3(0,0,1),0),Co.XZ=new Co(new Vector3(0,1,0),0),Co.YZ=new Co(new Vector3(1,0,0),0);let Plane3=Co;dot.register("Plane3",Plane3);class Quaternion{constructor(t,s,r,o){this.setXYZW(t,s,r,o)}setXYZW(t,s,r,o){this.x=t!==void 0?t:0,this.y=s!==void 0?s:0,this.z=r!==void 0?r:0,this.w=o!==void 0?o:1}plus(t){return new Quaternion(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)}timesScalar(t){return new Quaternion(this.x*t,this.y*t,this.z*t,this.w*t)}timesQuaternion(t){return new Quaternion(this.x*t.w-this.z*t.y+this.y*t.z+this.w*t.x,-this.x*t.z+this.y*t.w+this.z*t.x+this.w*t.y,this.x*t.y-this.y*t.x+this.z*t.w+this.w*t.z,-this.x*t.x-this.y*t.y-this.z*t.z+this.w*t.w)}timesVector3(t){return t.magnitude===0?new Vector3(0,0,0):new Vector3(this.w*this.w*t.x+2*this.y*this.w*t.z-2*this.z*this.w*t.y+this.x*this.x*t.x+2*this.y*this.x*t.y+2*this.z*this.x*t.z-this.z*this.z*t.x-this.y*this.y*t.x,2*this.x*this.y*t.x+this.y*this.y*t.y+2*this.z*this.y*t.z+2*this.w*this.z*t.x-this.z*this.z*t.y+this.w*this.w*t.y-2*this.x*this.w*t.z-this.x*this.x*t.y,2*this.x*this.z*t.x+2*this.y*this.z*t.y+this.z*this.z*t.z-2*this.w*this.y*t.x-this.y*this.y*t.z+2*this.w*this.x*t.y-this.x*this.x*t.z+this.w*this.w*t.z)}getMagnitude(){return Math.sqrt(this.magnitudeSquared)}get magnitude(){return this.getMagnitude()}getMagnitudeSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}get magnitudeSquared(){return this.getMagnitudeSquared()}normalized(){const t=this.magnitude;return assert&&assert(t!==0,"Cannot normalize a zero-magnitude quaternion"),this.timesScalar(1/t)}negated(){return new Quaternion(-this.x,-this.y,-this.z,-this.w)}toRotationMatrix(){const t=this.magnitudeSquared,s=t===1?2:t>0?2/t:0,r=this.x*this.x*s,o=this.x*this.y*s,n=this.x*this.z*s,l=this.w*this.x*s,h=this.y*this.y*s,g=this.y*this.z*s,d=this.w*this.y*s,A=this.z*this.z*s,S=this.w*this.z*s;return Matrix3.pool.fetch().columnMajor(1-(h+A),o+S,n-d,o-S,1-(r+A),g+l,n+d,g-l,1-(r+h))}static fromEulerAngles(t,s,r){const o=Math.sin(r*.5),n=Math.cos(r*.5),l=Math.sin(s*.5),h=Math.cos(s*.5),g=Math.sin(t*.5),d=Math.cos(t*.5),A=h*n,S=l*o,O=h*o,I=l*n;return new Quaternion(A*g+S*d,I*d+O*g,O*d-I*g,A*d-S*g)}static fromRotationMatrix(t){const s=t.m00(),r=t.m01(),o=t.m02(),n=t.m10(),l=t.m11(),h=t.m12(),g=t.m20(),d=t.m21(),A=t.m22(),S=s+l+A;let O;return S>=0?(O=Math.sqrt(S+1),new Quaternion((d-h)*.5/O,(o-g)*.5/O,(n-r)*.5/O,.5*O)):s>l&&s>A?(O=Math.sqrt(1+s-l-A),new Quaternion(O*.5,(n+r)*.5/O,(o+g)*.5/O,(d-h)*.5/O)):l>A?(O=Math.sqrt(1+l-s-A),new Quaternion((n+r)*.5/O,O*.5,(d+h)*.5/O,(o-g)*.5/O)):(O=Math.sqrt(1+A-s-l),new Quaternion((o+g)*.5/O,(d+h)*.5/O,O*.5,(n-r)*.5/O))}static getRotationQuaternion(t,s){return Quaternion.fromRotationMatrix(Matrix3.rotateAToB(t,s))}static slerp(t,s,r){if(t.x===s.x&&t.y===s.y&&t.z===s.z&&t.w===s.w)return t;let o=t.x*s.x+t.y*s.y+t.z*s.z+t.w*s.w;o<0&&(s=s.negated(),o=-o);let n=1-r,l=r;if(1-o>.1){const h=Math.acos(o),g=1/Math.sin(h);n=Math.sin((1-r)*h)*g,l=Math.sin(r*h)*g}return new Quaternion(n*t.x+l*s.x,n*t.y+l*s.y,n*t.z+l*s.z,n*t.w+l*s.w)}}Quaternion.prototype.isQuaternion=!0;dot.register("Quaternion",Quaternion);Poolable.mixInto(Quaternion,{initialize:Quaternion.prototype.setXYZW});class RangeWithValue extends Range{constructor(t,s,r){super(t,s),assert&&assert(r!==void 0,"default value is required"),assert&&assert(r>=t&&r<=s,`defaultValue is out of range: ${r}`),this._defaultValue=r}getDefaultValue(){return this._defaultValue}get defaultValue(){return this.getDefaultValue()}setMin(t){assert&&assert(this._defaultValue>=t,`min must be <= defaultValue: ${t}`),super.setMin(t)}setMax(t){assert&&assert(this._defaultValue<=t,`max must be >= defaultValue: ${t}`),super.setMax(t)}setMinMax(t,s){return assert&&assert(this._defaultValue>=t,`min must be <= defaultValue: ${t}`),assert&&assert(this._defaultValue<=s,`max must be >= defaultValue: ${s}`),super.setMinMax(t,s)}toString(){return`[RangeWithValue (min:${this.min} max:${this.max} defaultValue:${this._defaultValue})]`}equals(t){return this.constructor===t.constructor&&this._defaultValue===t.defaultValue&&super.equals(t)}}dot.register("RangeWithValue",RangeWithValue);class Ray2{constructor(t,s){this.position=t,this.direction=s,assert&&assert(Math.abs(s.magnitude-1)<.01,"the direction must be a unit vector")}shifted(t){return new Ray2(this.pointAtDistance(t),this.direction)}pointAtDistance(t){return this.position.plus(this.direction.timesScalar(t))}toString(){return`${this.position.toString()} => ${this.direction.toString()}`}}dot.register("Ray2",Ray2);let Rectangle$1=class extends Bounds2{constructor(t,s,r,o){assert&&assert(o!==void 0,"Rectangle requires 4 parameters"),super(t,s,t+r,s+o)}};dot.register("Rectangle",Rectangle$1);class RunningAverage{constructor(t){assert&&assert(t>0,"window size must be positive"),this.windowSize=t,this.samples=new Array(t),this.sampleIndex=0,this.total=0,this.numSamples=0,this.clear()}clear(){this.total=0,this.numSamples=0;for(let t=0;t<this.windowSize;t++)this.samples[t]=0}getRunningAverage(){return this.total/this.numSamples}isSaturated(){return this.numSamples>=this.windowSize}updateRunningAverage(t){return assert&&assert(typeof t=="number"&&isFinite(t)),this.numSamples=Math.min(this.windowSize,this.numSamples+1),this.total-=this.samples[this.sampleIndex],assert&&assert(isFinite(this.total)),this.total+=t,assert&&assert(isFinite(this.total)),this.samples[this.sampleIndex]=t,this.sampleIndex=(this.sampleIndex+1)%this.windowSize,this.getRunningAverage()}}dot.register("RunningAverage",RunningAverage);class Sphere3{constructor(t,s){this.center=t,this.radius=s,assert&&assert(s>=0,"the radius of a sphere should be positive")}intersect(t,s){const r=t.direction,o=t.position,n=o.minus(this.center),l=r.dot(n),h=n.magnitudeSquared,g=4*l*l-4*(h-this.radius*this.radius);if(g<s)return null;const d=r.dot(this.center)-r.dot(o),A=Math.sqrt(g)/2,S=d-A,O=d+A;if(O<s)return null;const I=t.pointAtDistance(O),W=I.minus(this.center).normalized();if(S<s)return{distance:O,hitPoint:I,normal:W.negated(),fromOutside:!1};{const L=t.pointAtDistance(S),H=L.minus(this.center).normalized();return{distance:S,hitPoint:L,normal:H,fromOutside:!0}}}intersections(t,s){const r=t.direction,o=t.position,n=o.minus(this.center),l=r.dot(n),h=n.magnitudeSquared,g=4*l*l-4*(h-this.radius*this.radius);if(g<s)return[];const d=r.dot(this.center)-r.dot(o),A=Math.sqrt(g)/2,S=d-A,O=d+A;if(O<s)return[];const I=t.pointAtDistance(O),W=I.minus(this.center).normalized(),L=t.pointAtDistance(S),H=L.minus(this.center).normalized(),Y={distance:O,hitPoint:I,normal:W.negated(),fromOutside:!1},Q={distance:S,hitPoint:L,normal:H,fromOutside:!0};return S<s?[Y,Q]:[Q,Y]}}dot.register("Sphere3",Sphere3);const Stats$1={getPercentile(a,t){if(assert&&assert(Array.isArray(a)),assert&&a.forEach(o=>assert&&assert(typeof o=="number")),a.length===0)return null;a.sort((o,n)=>o-n);const s=t/100*a.length;let r=null;return Math.floor(s)===s?r=(a[s-1]+a[s])/2:r=a[Math.floor(s)],r},median(a){return Stats$1.getPercentile(a,50)},getBoxPlotValues(a){return assert&&assert(a.length>=4,"need at least 4 values to calculate quartiles"),{q1:Stats$1.getPercentile(a,25),median:Stats$1.getPercentile(a,50),q3:Stats$1.getPercentile(a,75)}},getBoxPlotLimits(a){assert&&assert(Array.isArray(a)),assert&&assert(a.length>=4,"need at least 4 values to calculate data limits"),assert&&a.forEach(n=>assert&&assert(typeof n=="number"));const t=Stats$1.getBoxPlotValues(a),s=t.q3-t.q1,r=t.q1-1.5*s,o=t.q3+1.5*s;return{lowerLimit:r,upperLimit:o}}};dot.register("Stats",Stats$1);const TOLERANCE=1e-6,approxEquals=(a,t)=>Math.abs(a-t)<=TOLERANCE;class Transform1{constructor(t,s,r){r=merge({domain:new Range(Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY),range:new Range(Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY)},r),this.evaluationFunction=t,this.inverseFunction=s,this.domain=r.domain,this.range=r.range}evaluate(t){assert&&assert(this.domain.contains(t),"Value out of domain");const s=this.evaluationFunction(t);return assert&&assert(approxEquals(this.inverseFunction(s),t)),s}inverse(t){assert&&assert(this.range.contains(t),"Value out of range");const s=this.inverseFunction(t);return assert&&assert(approxEquals(this.evaluationFunction(s),t)),s}}dot.register("Transform1",Transform1);const listenerOrder=_.hasIn(window,"phet.chipper.queryParameters")&&phet.chipper.queryParameters.listenerOrder,listenerLimit=_.hasIn(window,"phet.chipper.queryParameters")&&phet.chipper.queryParameters.listenerLimit;let random=null;if(listenerOrder&&listenerOrder.startsWith("random")){const a=listenerOrder.match(/random(?:%28|\()(\d+)(?:%29|\))/),t=a?Number(a[1]):dotRandom.nextInt(1e6);random=new Random({seed:t}),console.log("listenerOrder random seed: "+t)}let maxListenerCount=0;class TinyEmitter{constructor(t,s){t&&(this.onBeforeNotify=t),s&&(this.hasListenerOrderDependencies=s),this.listeners=new Set,this.emitContexts=[],assert&&(this.isDisposed=!1)}dispose(){this.removeAllListeners(),assert&&(this.isDisposed=!0)}emit(...t){if(assert&&assert(!this.isDisposed,"TinyEmitter.emit() should not be called if disposed."),this.onBeforeNotify&&this.onBeforeNotify.apply(null,t),assert&&listenerOrder&&listenerOrder!=="default"&&!this.hasListenerOrderDependencies){const s=Array.from(this.listeners),r=listenerOrder.startsWith("random")?random.shuffle(s):s.reverse();this.listeners=new Set(r)}if(this.listeners.size>0){const s={index:0};this.emitContexts.push(s);for(const r of this.listeners)if(r(...t),s.index++,s.listenerArray)break;if(s.listenerArray)for(let r=s.index;r<s.listenerArray.length;r++)s.listenerArray[r](...t);this.emitContexts.pop()}}addListener(t){assert&&assert(!this.isDisposed,"Cannot add a listener to a disposed TinyEmitter"),assert&&assert(!this.hasListener(t),"Cannot add the same listener twice"),this.guardListeners(),this.listeners.add(t),this.changeCount&&this.changeCount(1),assert&&listenerLimit&&isFinite(listenerLimit)&&maxListenerCount<this.listeners.size&&(maxListenerCount=this.listeners.size,console.log(`Max TinyEmitter listeners: ${maxListenerCount}`),assert(maxListenerCount<=listenerLimit,`listener count of ${maxListenerCount} above ?listenerLimit=${listenerLimit}`))}removeListener(t){assert&&!this.isDisposed&&assert(this.listeners.has(t),"tried to removeListener on something that wasn't a listener"),this.guardListeners(),this.listeners.delete(t),this.changeCount&&this.changeCount(-1)}removeAllListeners(){const t=this.listeners.size;this.guardListeners(),this.listeners.clear(),this.changeCount&&this.changeCount(-t)}guardListeners(){for(let t=this.emitContexts.length-1;t>=0&&!this.emitContexts[t].listenerArray;t--)this.emitContexts[t].listenerArray=Array.from(this.listeners)}hasListener(t){return assert&&assert(arguments.length===1,"Emitter.hasListener should be called with 1 argument"),this.listeners.has(t)}hasListeners(){return assert&&assert(arguments.length===0,"Emitter.hasListeners should be called without arguments"),this.listeners.size>0}getListenerCount(){return this.listeners.size}forEachListener(t){this.listeners.forEach(t)}}axon.register("TinyEmitter",TinyEmitter);const scratchMatrix$5=new Matrix3;class Transform3{constructor(t){this.matrix=Matrix3.IDENTITY.copy(),this.inverse=Matrix3.IDENTITY.copy(),this.matrixTransposed=Matrix3.IDENTITY.copy(),this.inverseTransposed=Matrix3.IDENTITY.copy(),this.inverseValid=!0,this.transposeValid=!0,this.inverseTransposeValid=!0,this.changeEmitter=new TinyEmitter,t&&this.setMatrix(t)}setMatrix(t){this.matrix.set(t),this.invalidate()}validateMatrix(t){assert&&assert(t instanceof Matrix3,"matrix was incorrect type"),assert&&assert(t.isFinite(),"matrix must be finite")}invalidate(){assert&&this.validateMatrix(this.matrix),this.inverseValid=!1,this.transposeValid=!1,this.inverseTransposeValid=!1,this.changeEmitter.emit()}prepend(t){assert&&this.validateMatrix(t),scratchMatrix$5.set(this.matrix),this.matrix.set(t),this.matrix.multiplyMatrix(scratchMatrix$5),this.invalidate()}prependTranslation(t,s){assert&&assert(typeof t=="number"&&typeof s=="number"&&isFinite(t)&&isFinite(s),"Attempted to prepend non-finite or non-number (x,y) to the transform"),this.matrix.prependTranslation(t,s),this.invalidate()}append(t){assert&&this.validateMatrix(t),this.matrix.multiplyMatrix(t),this.invalidate()}prependTransform(t){this.prepend(t.matrix)}appendTransform(t){this.append(t.matrix)}applyToCanvasContext(t){t.setTransform(this.matrix.m00(),this.matrix.m10(),this.matrix.m01(),this.matrix.m11(),this.matrix.m02(),this.matrix.m12())}copy(){const t=new Transform3(this.matrix);t.inverse=this.inverse,t.matrixTransposed=this.matrixTransposed,t.inverseTransposed=this.inverseTransposed,t.inverseValid=this.inverseValid,t.transposeValid=this.transposeValid,t.inverseTransposeValid=this.inverseTransposeValid}getMatrix(){return this.matrix}getInverse(){return this.inverseValid||(this.inverseValid=!0,this.inverse.set(this.matrix),this.inverse.invert()),this.inverse}getMatrixTransposed(){return this.transposeValid||(this.transposeValid=!0,this.matrixTransposed.set(this.matrix),this.matrixTransposed.transpose()),this.matrixTransposed}getInverseTransposed(){return this.inverseTransposeValid||(this.inverseTransposeValid=!0,this.inverseTransposed.set(this.getInverse()),this.inverseTransposed.transpose()),this.inverseTransposed}isIdentity(){return this.matrix.isFastIdentity()}isFinite(){return this.matrix.isFinite()}transformPosition2(t){return this.matrix.timesVector2(t)}transformDelta2(t){const s=this.getMatrix();return new Vector2(s.m00()*t.x+s.m01()*t.y,s.m10()*t.x+s.m11()*t.y)}transformNormal2(t){return this.getInverse().timesTransposeVector2(t).normalize()}transformX(t){const s=this.getMatrix();return assert&&assert(!s.m01(),"Transforming an X value with a rotation/shear is ill-defined"),s.m00()*t+s.m02()}transformY(t){const s=this.getMatrix();return assert&&assert(!s.m10(),"Transforming a Y value with a rotation/shear is ill-defined"),s.m11()*t+s.m12()}transformDeltaX(t){return this.getMatrix().m00()*t}transformDeltaY(t){return this.getMatrix().m11()*t}transformBounds2(t){return t.transformed(this.matrix)}transformShape(t){return t.transformed(this.matrix)}transformRay2(t){return new Ray2(this.transformPosition2(t.position),this.transformDelta2(t.direction).normalized())}inversePosition2(t){return this.getInverse().timesVector2(t)}inverseDelta2(t){const s=this.getInverse();return new Vector2(s.m00()*t.x+s.m01()*t.y,s.m10()*t.x+s.m11()*t.y)}inverseNormal2(t){return this.matrix.timesTransposeVector2(t).normalize()}inverseX(t){const s=this.getInverse();return assert&&assert(!s.m01(),"Inverting an X value with a rotation/shear is ill-defined"),s.m00()*t+s.m02()}inverseY(t){const s=this.getInverse();return assert&&assert(!s.m10(),"Inverting a Y value with a rotation/shear is ill-defined"),s.m11()*t+s.m12()}inverseDeltaX(t){const s=this.getInverse();return assert&&assert(!s.m01(),"Inverting an X value with a rotation/shear is ill-defined"),s.m00()*t}inverseDeltaY(t){const s=this.getInverse();return assert&&assert(!s.m10(),"Inverting a Y value with a rotation/shear is ill-defined"),s.m11()*t}inverseBounds2(t){return t.transformed(this.getInverse())}inverseShape(t){return t.transformed(this.getInverse())}inverseRay2(t){return new Ray2(this.inversePosition2(t.position),this.inverseDelta2(t.direction).normalized())}}dot.register("Transform3",Transform3);const scratchMatrix$4=new Matrix4;function checkMatrix(a){return a instanceof Matrix4&&a.isFinite()}class Transform4{constructor(t){this.matrix=Matrix4.IDENTITY.copy(),this.inverse=Matrix4.IDENTITY.copy(),this.matrixTransposed=Matrix4.IDENTITY.copy(),this.inverseTransposed=Matrix4.IDENTITY.copy(),this.inverseValid=!0,this.transposeValid=!0,this.inverseTransposeValid=!0,this.changeEmitter=new TinyEmitter,t&&this.setMatrix(t)}setMatrix(t){assert&&assert(checkMatrix(t),"Matrix has NaNs, non-finite values, or isn't a matrix!"),this.matrix.set(t),this.invalidate()}invalidate(){assert&&assert(this.matrix.isFinite()),this.inverseValid=!1,this.transposeValid=!1,this.inverseTransposeValid=!1,this.changeEmitter.emit()}prepend(t){assert&&assert(checkMatrix(t),"Matrix has NaNs, non-finite values, or isn't a matrix!"),scratchMatrix$4.set(this.matrix),this.matrix.set(t),this.matrix.multiplyMatrix(scratchMatrix$4),this.invalidate()}append(t){assert&&assert(checkMatrix(t),"Matrix has NaNs, non-finite values, or isn't a matrix!"),this.matrix.multiplyMatrix(t),this.invalidate()}prependTransform(t){this.prepend(t.matrix)}appendTransform(t){this.append(t.matrix)}applyToCanvasContext(t){t.setTransform(this.matrix.m00(),this.matrix.m10(),this.matrix.m01(),this.matrix.m11(),this.matrix.m03(),this.matrix.m13())}copy(){const t=new Transform4(this.matrix);t.inverse=this.inverse,t.matrixTransposed=this.matrixTransposed,t.inverseTransposed=this.inverseTransposed,t.inverseValid=this.inverseValid,t.transposeValid=this.transposeValid,t.inverseTransposeValid=this.inverseTransposeValid}getMatrix(){return this.matrix}getInverse(){return this.inverseValid||(this.inverseValid=!0,this.inverse.set(this.matrix),this.inverse.invert()),this.inverse}getMatrixTransposed(){return this.transposeValid||(this.transposeValid=!0,this.matrixTransposed.set(this.matrix),this.matrixTransposed.transpose()),this.matrixTransposed}getInverseTransposed(){return this.inverseTransposeValid||(this.inverseTransposeValid=!0,this.inverseTransposed.set(this.getInverse()),this.inverseTransposed.transpose()),this.inverseTransposed}isIdentity(){return this.matrix.type===Matrix4.Types.IDENTITY}isFinite(){return this.matrix.isFinite()}transformPosition3(t){return this.matrix.timesVector3(t)}transformDelta3(t){return this.matrix.timesRelativeVector3(t)}transformNormal3(t){return this.getInverse().timesTransposeVector3(t)}transformDeltaX(t){return this.transformDelta3(new Vector3(t,0,0)).x}transformDeltaY(t){return this.transformDelta3(new Vector3(0,t,0)).y}transformDeltaZ(t){return this.transformDelta3(new Vector3(0,0,t)).z}transformRay(t){return new Ray3(this.transformPosition3(t.position),this.transformPosition3(t.position.plus(t.direction)).minus(this.transformPosition3(t.position)))}inversePosition3(t){return this.getInverse().timesVector3(t)}inverseDelta3(t){return this.inversePosition3(t).minus(this.inversePosition3(Vector3.ZERO))}inverseNormal3(t){return this.matrix.timesTransposeVector3(t)}inverseDeltaX(t){return this.inverseDelta3(new Vector3(t,0,0)).x}inverseDeltaY(t){return this.inverseDelta3(new Vector3(0,t,0)).y}inverseDeltaZ(t){return this.inverseDelta3(new Vector3(0,0,t)).z}inverseRay(t){return new Ray3(this.inversePosition3(t.position),this.inversePosition3(t.position.plus(t.direction)).minus(this.inversePosition3(t.position)))}}dot.register("Transform4",Transform4);const qr=class qr{constructor(t){const s=t.slice();for(;s.length&&s[s.length-1]===0;)s.pop();this.coefficients=s}plus(t){const s=[];for(let r=0;r<Math.max(this.coefficients.length,t.coefficients.length);r++)s.push(this.getCoefficient(r)+t.getCoefficient(r));return new qr(s)}minus(t){const s=[];for(let r=0;r<Math.max(this.coefficients.length,t.coefficients.length);r++)s.push(this.getCoefficient(r)-t.getCoefficient(r));return new qr(s)}times(t){const s=[];for(;s.length<this.coefficients.length+t.coefficients.length-1;)s.push(0);for(let r=0;r<this.coefficients.length;r++)for(let o=0;o<t.coefficients.length;o++)s[r+o]+=this.getCoefficient(r)*t.getCoefficient(o);return new qr(s)}dividedBy(t){let s=new qr([]),r=this;const o=t.degree,n=t.coefficients[t.coefficients.length-1];for(;r.degree>=o;){const l=qr.singleCoefficient(r.getCoefficient(r.degree)/n,r.degree-o);s=s.plus(l),r=r.minus(l.times(t))}return{quotient:s,remainder:r}}gcd(t){let s=this,r=t;for(;!r.isZero();){const o=r;r=s.dividedBy(r).remainder,s=o}return s}equals(t){return this.coefficients.length===t.coefficients.length&&this.coefficients.every((s,r)=>s===t.coefficients[r])}getCoefficient(t){return t<this.coefficients.length?this.coefficients[t]:0}get degree(){return this.coefficients.length-1}isZero(){return this.coefficients.length===0}getMonicPolynomial(){if(this.isZero())return this;{const t=this.coefficients[this.coefficients.length-1];return new qr(this.coefficients.map(s=>s/t))}}evaluate(t){let s=this.coefficients[this.coefficients.length-1];for(let r=this.coefficients.length-2;r>=0;r--)s=s*t+this.coefficients[r];return s}evaluateComplex(t){let s=Complex.real(this.coefficients[this.coefficients.length-1]);for(let r=this.coefficients.length-2;r>=0;r--)s=s.times(t).plus(Complex.real(this.coefficients[r]));return s}getRoots(){if(this.isZero()||this.degree===0)return[];if(this.degree===1)return[Complex.real(-this.coefficients[0]/this.coefficients[1])];if(this.coefficients[0]===0){const t=new qr(this.coefficients.slice(1)).getRoots();return t.some(s=>s.equalsEpsilon(Complex.real(0),1e-10))||t.push(Complex.real(0)),t}else{if(this.degree===2)return Complex.solveQuadraticRoots(Complex.real(this.coefficients[2]),Complex.real(this.coefficients[1]),Complex.real(this.coefficients[0]));if(this.degree===3)return Complex.solveCubicRoots(Complex.real(this.coefficients[3]),Complex.real(this.coefficients[2]),Complex.real(this.coefficients[1]),Complex.real(this.coefficients[0]));{const t=new Matrix$1(this.degree,this.degree);for(let d=0;d<this.degree;d++)d<this.degree-1&&t.set(d+1,d,1),t.set(d,this.degree-1,-this.coefficients[d]/this.coefficients[this.degree]);console.log(t.toString());let s=t;const r=1e-13;for(let d=0;d<500;d++){const A=new QRDecomposition(s);if(s=A.getR().times(A.getQ()),d%10===0){let S=0;for(let O=0;O<this.degree;O++)for(let I=0;I<O;I++)S=Math.max(S,Math.abs(s.get(O,I)));if(S<r||d>1e3)break}}const o=_.range(0,this.degree).map(d=>Complex.real(s.get(d,d))),n=new EigenvalueDecomposition(t),l=n.getRealEigenvalues(),h=n.getImagEigenvalues(),g=_.range(0,this.degree).map(d=>new Complex(l[d],h[d]));return o||g}}}static singleCoefficient(t,s){const r=[];for(;r.length<s;)r.push(0);return r.push(t),new qr(r)}};qr.ZERO=new qr([]);let UnivariatePolynomial=qr;dot.register("UnivariatePolynomial",UnivariatePolynomial);class Timer extends TinyEmitter{setTimeout(t,s){let r=0;const o=n=>{r+=n,r*1e3>=s&&this.hasListener(o)&&(t(),this.removeListener(o))};return this.addListener(o),o}clearTimeout(t){this.hasListener(t)&&this.removeListener(t)}setInterval(t,s){let r=0;const o=n=>{for(r+=n;r*1e3>=s&&this.hasListener(o);)t(),r=r-s/1e3};return this.addListener(o),o}clearInterval(t){this.hasListener(t)&&this.removeListener(t)}runOnNextTick(t){this.setTimeout(t,0)}}axon.register("Timer",Timer);const animationFrameTimer=new Timer;axon.register("animationFrameTimer",animationFrameTimer);var _a;const ur=class ur extends EnumerationValue{};_a=TandemConstants.EVENT_TYPE_MODEL,ur.USER=new ur,ur[_a]=new ur,ur.WRAPPER=new ur,ur.OPT_OUT=new ur,ur.enumeration=new Enumeration(ur),ur.phetioType=EnumerationIO(ur);let EventType=ur;tandemNamespace.register("EventType",EventType);const packageJSON=_.hasIn(window,"phet.chipper.packageObject")?phet.chipper.packageObject:{name:"placeholder"},PHET_IO_ENABLED$1=_.hasIn(window,"phet.preloads.phetio"),PRINT_MISSING_TANDEMS=PHET_IO_ENABLED$1&&phet.preloads.phetio.queryParameters.phetioPrintMissingTandems,IS_VALIDATION_DEFAULT=_.hasIn(packageJSON,"phet.phet-io.validation")?!!packageJSON.phet["phet-io"].validation:!0,IS_VALIDATION_QUERY_PARAMETER_SPECIFIED=window.QueryStringMachine&&QueryStringMachine.containsKey("phetioValidation"),IS_VALIDATION_SPECIFIED=PHET_IO_ENABLED$1&&IS_VALIDATION_QUERY_PARAMETER_SPECIFIED?!!phet.preloads.phetio.queryParameters.phetioValidation:PHET_IO_ENABLED$1&&IS_VALIDATION_DEFAULT,VALIDATION=PHET_IO_ENABLED$1&&IS_VALIDATION_SPECIFIED&&!PRINT_MISSING_TANDEMS,UNALLOWED_TANDEM_NAMES=["pickableProperty","inputListener","dragHandler"],REQUIRED_TANDEM_NAME="requiredTandem",OPTIONAL_TANDEM_NAME="optionalTandem",FORBIDDEN_SUPPLIED_TANDEM_NAMES=[REQUIRED_TANDEM_NAME,OPTIONAL_TANDEM_NAME],TEST_TANDEM_NAME="test",INTER_TERM_SEPARATOR=phetio.PhetioIDUtils.INTER_TERM_SEPARATOR,DYNAMIC_ARCHETYPE_NAME=phetio.PhetioIDUtils.ARCHETYPE,missingTandems={required:[],optional:[]},phetioObjectListeners=[],launchListeners=[],bi=class bi{constructor(t,s,r){this.children={},this.isDisposed=!1,assert&&assert(t===null||t instanceof bi,"parentTandem should be null or Tandem"),assert&&assert(s!==bi.METADATA_KEY,"name cannot match Tandem.METADATA_KEY"),this.parentTandem=t,this.name=s,this.phetioID=this.parentTandem?window.phetio.PhetioIDUtils.append(this.parentTandem.phetioID,this.name):this.name;const o=optionize()({required:!0,supplied:!0,isValidTandemName:n=>bi.getRegexFromCharacterClass().test(n)},r);assert&&assert(o.isValidTandemName(s),`invalid tandem name: ${s}`),assert&&assert(!o.supplied||FORBIDDEN_SUPPLIED_TANDEM_NAMES.every(n=>!s.includes(n)),`forbidden supplied tandem name: ${s}. If a tandem is not supplied, its name should not be used to create a supplied tandem.`),this.children={},this.parentTandem&&(assert&&assert(!this.parentTandem.hasChild(s),`parent should not have child: ${s}`),this.parentTandem.addChild(s,this)),this.required=o.required,this.supplied=o.supplied}static getRegexFromCharacterClass(t=TandemConstants.BASE_TANDEM_CHARACTER_CLASS){return new RegExp(`^[${t}]+$`)}static onMissingTandem(t){if(PRINT_MISSING_TANDEMS&&!t.supplied){const s=bi.captureStackTrace();t.required?missingTandems.required.push({phetioID:t.phetioID,stack:s}):s.includes("Font")||missingTandems.optional.push({phetioID:t.phetioID,stack:s})}}static captureStackTrace(t=1/0){const s=Object.getOwnPropertyDescriptor(Error,"stackTraceLimit");if(s&&(s.writable||s.set&&typeof s.set=="function")){const o=Error.stackTraceLimit;Error.stackTraceLimit=t;const n=new Error().stack;return Error.stackTraceLimit=o,n}else return new Error().stack}addPhetioObject(t){if(PHET_IO_ENABLED$1){if(assert&&bi.VALIDATION&&assert(!(this.required&&!this.supplied),"Tandem was required but not supplied"),!this.required&&!this.supplied)return;if(!bi.launched)bi.bufferedPhetioObjects.push(t);else for(let s=0;s<phetioObjectListeners.length;s++)phetioObjectListeners[s].addPhetioObject(t)}}hasAncestor(t){return this.parentTandem===t||!!(this.parentTandem&&this.parentTandem.hasAncestor(t))}removePhetioObject(t){if(this.supplied){if(PHET_IO_ENABLED$1)if(!bi.launched)assert&&assert(bi.bufferedPhetioObjects.includes(t),"should contain item"),arrayRemove(bi.bufferedPhetioObjects,t);else for(let s=0;s<phetioObjectListeners.length;s++)phetioObjectListeners[s].removePhetioObject(t);t.tandem.dispose()}}getExtendedOptions(t){return merge({supplied:this.supplied,required:this.required},t)}createTandem(t,s){if(assert&&bi.VALIDATION&&assert(!UNALLOWED_TANDEM_NAMES.includes(t),"tandem name is not allowed: "+t),s=this.getExtendedOptions(s),this.hasChild(t)){const r=this.children[t];return assert&&assert(r.required===s.required),assert&&assert(r.supplied===s.supplied),r}else return new bi(this,t,s)}createTandem1Indexed(t,s,r){return this.createTandem(`${t}${s+1}`,r)}hasChild(t){return this.children.hasOwnProperty(t)}addChild(t,s){assert&&assert(!this.hasChild(t)),this.children[t]=s}iterateDescendants(t){for(const s in this.children)this.children.hasOwnProperty(s)&&(t(this.children[s]),this.children[s].iterateDescendants(t))}removeChild(t){assert&&assert(this.hasChild(t)),delete this.children[t]}dispose(){assert&&assert(!this.isDisposed,"already disposed"),this.parentTandem.removeChild(this.name),this.parentTandem=null,this.isDisposed=!0}getArchetypalPhetioID(){return window.phetio.PhetioIDUtils.getArchetypalPhetioID(this.phetioID)}createGroupTandem(t){return this.children[t]?this.children[t]:new GroupTandem(this,t)}equals(t){return this.phetioID===t.phetioID}static addPhetioObjectListener(t){phetioObjectListeners.push(t)}static launch(){for(assert&&assert(!bi.launched,"Tandem cannot be launched twice"),bi.launched=!0;launchListeners.length>0;)launchListeners.shift()();assert&&assert(launchListeners.length===0)}static unlaunch(){bi.launched=!1,bi.bufferedPhetioObjects.length=0,launchListeners.length=0}static addLaunchListener(t){assert&&assert(!bi.launched,"tandem has already been launched, cannot add listener for that hook."),launchListeners.push(t)}createTandemFromPhetioID(t){return this.createTandem(t.split(window.phetio.PhetioIDUtils.SEPARATOR).join(INTER_TERM_SEPARATOR),{isValidTandemName:s=>bi.getRegexFromCharacterClass(TandemConstants.BASE_DERIVED_TANDEM_CHARACTER_CLASS).test(s)})}static getStringsTandem(t=bi.ROOT.name){return bi.STRINGS.createTandem(t)}static getDerivedStringsTandem(t=bi.ROOT.name){return bi.getStringsTandem(t).createTandem("derivedStrings")}};bi.SCREEN_TANDEM_NAME_SUFFIX="Screen",bi.missingTandems=missingTandems,bi.PHET_IO_ENABLED=PHET_IO_ENABLED$1,bi.API_GENERATION=bi.PHET_IO_ENABLED&&(phet.preloads.phetio.queryParameters.phetioPrintAPI||phet.preloads.phetio.queryParameters.phetioCompareAPI),bi.VALIDATION=VALIDATION,bi.METADATA_KEY="_metadata",bi.DATA_KEY="_data",bi.launched=!1,bi.bufferedPhetioObjects=[],bi.RootTandem=class extends bi{createTandem(s,r){if(bi.VALIDATION){const o=s===window.phetio.PhetioIDUtils.GLOBAL_COMPONENT_NAME||s===REQUIRED_TANDEM_NAME||s===OPTIONAL_TANDEM_NAME||s===TEST_TANDEM_NAME||s===window.phetio.PhetioIDUtils.GENERAL_COMPONENT_NAME||_.endsWith(s,bi.SCREEN_TANDEM_NAME_SUFFIX);assert&&assert(o,`tandem name not allowed on root: "${s}"; perhaps try putting it under general or global`)}return super.createTandem(s,r)}},bi.ROOT=new bi.RootTandem(null,_.camelCase(packageJSON.name)),bi.GENERAL=bi.ROOT.createTandem(window.phetio.PhetioIDUtils.GENERAL_COMPONENT_NAME),bi.ROOT_TEST=bi.ROOT.createTandem(TEST_TANDEM_NAME),bi.GENERAL_MODEL=bi.GENERAL.createTandem(window.phetio.PhetioIDUtils.MODEL_COMPONENT_NAME),bi.GENERAL_VIEW=bi.GENERAL.createTandem(window.phetio.PhetioIDUtils.VIEW_COMPONENT_NAME),bi.GENERAL_CONTROLLER=bi.GENERAL.createTandem(window.phetio.PhetioIDUtils.CONTROLLER_COMPONENT_NAME),bi.GLOBAL=bi.ROOT.createTandem(window.phetio.PhetioIDUtils.GLOBAL_COMPONENT_NAME),bi.GLOBAL_MODEL=bi.GLOBAL.createTandem(window.phetio.PhetioIDUtils.MODEL_COMPONENT_NAME),bi.GLOBAL_VIEW=bi.GLOBAL.createTandem(window.phetio.PhetioIDUtils.VIEW_COMPONENT_NAME),bi.COLORS=bi.GLOBAL_VIEW.createTandem(window.phetio.PhetioIDUtils.COLORS_COMPONENT_NAME),bi.STRINGS=bi.GENERAL_MODEL.createTandem(window.phetio.PhetioIDUtils.STRINGS_COMPONENT_NAME),bi.OPTIONAL=bi.ROOT.createTandem(OPTIONAL_TANDEM_NAME,{required:!1,supplied:!1}),bi.OPT_OUT=bi.OPTIONAL,bi.REQUIRED=bi.ROOT.createTandem(REQUIRED_TANDEM_NAME,{required:VALIDATION||PRINT_MISSING_TANDEMS,supplied:!1}),bi.PREFERENCES=bi.GLOBAL_MODEL.createTandem("preferences"),bi.REGION_CULTURE_PORTRAYALS=bi.PREFERENCES.createTandem("regionAndCulturePortrayals");let Tandem=bi;Tandem.addLaunchListener(()=>{for(;Tandem.bufferedPhetioObjects.length>0;){const a=Tandem.bufferedPhetioObjects.shift();a.tandem.addPhetioObject(a)}assert&&assert(Tandem.bufferedPhetioObjects.length===0,"bufferedPhetioObjects should be empty")});class GroupTandem extends Tandem{constructor(t,s){super(t,s),this.groupName=s,this.groupMemberIndex=0}createNextTandem(){const t=this.parentTandem.createTandem(`${this.groupName}${this.groupMemberIndex}`);return this.groupMemberIndex++,t}}tandemNamespace.register("Tandem",Tandem);const ValueIO=new IOType("ValueIO",{isValidValue:_.stubTrue,supertype:IOType.ObjectIO,toStateObject:a=>a,fromStateObject:a=>a,stateSchema:StateSchema.asValue("*",{isValidValue:_.stubTrue})});tandemNamespace.register("ValueIO",ValueIO);const StringIO=new IOType("StringIO",{supertype:ValueIO,valueType:"string",documentation:"PhET-iO Type for Javascript's string primitive type",stateSchema:StateSchema.asValue("string",{valueType:"string"}),toStateObject:_.identity});tandemNamespace.register("StringIO",StringIO);const LinkedElementIO=new IOType("LinkedElementIO",{isValidValue:()=>!0,documentation:"A LinkedElement",toStateObject:a=>(assert&&Tandem.VALIDATION&&assert(a.element.isPhetioInstrumented(),"Linked elements must be instrumented"),{elementID:a.element.tandem.phetioID}),applyState:_.noop,stateSchema:{elementID:StringIO}});tandemNamespace.register("LinkedElementIO",LinkedElementIO);const KEYS_TO_CHECK=["phetioDynamicElement","phetioEventType","phetioIsArchetype","phetioPlayback","phetioReadOnly","phetioState","phetioTypeName"];class PhetioAPIValidation{constructor(){this.apiMismatches=[],this.simHasStarted=!1,this.enabled=!!assert&&Tandem.VALIDATION,this.everyPhetioType={}}onSimStarted(){this.enabled&&phet.joist.sim.allScreensCreated&&(this.validateOverridesFile(),this.validatePreferencesModel()),phet.preloads.phetio.queryParameters.phetioPrintAPIProblems&&this.apiMismatches&&console.log("PhET-iO API problems detected: ",this.apiMismatches),this.simHasStarted=!0}validatePreferencesModel(){Object.keys(phet.phetio.phetioEngine.phetioElementMap).filter(t=>t.includes(".preferencesModel.")).forEach(t=>{let s=phet.phetio.phetioEngine.phetioElementMap[t];for(;s instanceof LinkedElement;)s=s.element;assert&&assert(!s.phetioReadOnly,"preferences model and its descendants should be phetioReadOnly: false, key="+t),assert&&assert(s.phetioState===(s.phetioID.endsWith(".colorProfileProperty")||s.phetioID.endsWith(".audioEnabledProperty")||s.phetioID.endsWith(".localeProperty")||t.includes(".simulationModel.")),"most preferences should be phetioState: false, key="+t)})}onPhetioObjectRemoved(t){if(!this.enabled)return;const s=t.tandem.phetioID;t.phetioDynamicElement||this.assertAPIError({phetioID:s,ruleInViolation:"2. Any static, registered PhetioObject can never be deregistered."})}onPhetioObjectAdded(t){if(!this.enabled)return;const s=t.phetioType;this.everyPhetioType[s.typeName]||(this.everyPhetioType[s.typeName]=s),this.simHasStarted&&phet.axon.animationFrameTimer.runOnNextTick(()=>{if(!t.phetioDynamicElement)this.assertAPIError({phetioID:t.tandem.phetioID,ruleInViolation:"1. After startup, only dynamic instances prescribed by the baseline file can be registered."});else if(phet.preloads.phetio.createArchetypes&&!t.isDisposed){const o=t.tandem.getArchetypalPhetioID(),n=phet.phetio.phetioEngine.getPhetioElement(o).getMetadata();this.checkDynamicInstanceAgainstArchetype(t,n,"simulation archetype")}})}validateOverridesFile(){const t=phet.phetio.phetioEngine.getPhetioElementsBaseline();for(const s in window.phet.preloads.phetio.phetioElementsOverrides){const r=s.includes(DYNAMIC_ARCHETYPE_NAME);if(!phet.preloads.phetio.createArchetypes&&!t.hasOwnProperty(s))assert&&assert(r,`phetioID missing from the baseline that was not an archetype: ${s}`);else if(!t.hasOwnProperty(s))this.assertAPIError({phetioID:s,ruleInViolation:"3. Any schema entries in the overrides file must exist in the baseline file.",message:"phetioID expected in the baseline file but does not exist"});else{const o=window.phet.preloads.phetio.phetioElementsOverrides[s],n=t[s];Object.keys(o).length===0&&this.assertAPIError({phetioID:s,ruleInViolation:"4. Any schema entries in the overrides file must be different from its baseline counterpart.",message:"no metadata keys found for this override."});for(const l in o)n.hasOwnProperty(l)||this.assertAPIError({phetioID:s,ruleInViolation:"8. Any schema entries in the overrides file must be different from its baseline counterpart.",message:`phetioID metadata key not found in the baseline: ${l}`}),o[l]===n[l]&&this.assertAPIError({phetioID:s,ruleInViolation:"8. Any schema entries in the overrides file must be different from its baseline counterpart.",message:"phetioID metadata override value is the same as the corresponding metadata value in the baseline."})}}}assertAPIError(t){const s=t.phetioID?`${t.phetioID}:  ${t.ruleInViolation}`:`${t.ruleInViolation}`;this.apiMismatches.push(t),(this.simHasStarted||!phet.preloads.phetio.queryParameters.phetioPrintAPIProblems)&&assert&&assert(!1,`PhET-iO API error:
${s}`)}checkDynamicInstanceAgainstArchetype(t,s,r){const o=t.getMetadata();KEYS_TO_CHECK.forEach(n=>{n!=="phetioDynamicElement"&&n!=="phetioArchetypePhetioID"&&n!=="phetioIsArchetype"&&s[n]!==o[n]&&t.tandem&&this.assertAPIError({phetioID:t.tandem.phetioID,ruleInViolation:"5. Dynamic element metadata should match the archetype in the API.",source:r,message:`mismatched metadata: ${n}`})})}}const phetioAPIValidation=new PhetioAPIValidation;tandemNamespace.register("phetioAPIValidation",phetioAPIValidation);class Disposable{constructor(t){if(this._disposeEmitter=new TinyEmitter,this._isDisposable=!0,this._isDisposed=!1,t&&this.initializeDisposable(t),assert){const s=this.dispose;this.dispose=()=>{assert&&assert(!this._isDisposed,"This Disposable has already been disposed, and cannot be disposed again"),s.call(this),assert&&assert(this._isDisposed,"Disposable.dispose() call is missing from an overridden dispose method")}}}getDisposeEmitter(){return this._disposeEmitter}get disposeEmitter(){return this.getDisposeEmitter()}get isDisposed(){return this._isDisposed}get isDisposable(){return this._isDisposable}set isDisposable(t){this._isDisposable=t}initializeDisposable(t){t&&t.hasOwnProperty("isDisposable")&&(this._isDisposable=t.isDisposable)}dispose(){assert&&!this._isDisposable&&Disposable.assertNotDisposable(),assert&&assert(!this._isDisposed,"Disposable can only be disposed once"),this._disposeEmitter.emit(),this._disposeEmitter.dispose(),this._isDisposed=!0}static assertNotDisposable(){assert&&assert(!1,"dispose is not supported, exists for the lifetime of the sim")}}axon.register("Disposable",Disposable);const cr=class cr{static add(t,s){assert&&assert(!cr.map.has(t.phetioID),"TandemID already exists in the DescriptionRegistry"),cr.map.set(t.phetioID,s);const r=t.phetioID.split(".");let o=cr.root;for(let n=0;n<r.length;n++){const l=r[n];o[l]||(o[l]={}),o=o[l]}o._value=s,cr.addedEmitter.emit(t.phetioID,s)}static remove(t){const s=t.phetioID;if(cr.map.has(s)){cr.removedEmitter.emit(s,t),cr.map.delete(s);const r=s.split("."),o=[];let n=cr.root;for(let l=0;l<r.length;l++){const h=r[l];n&&(n=n[h],n&&o.push(n))}o.length===r.length&&delete n._value;for(let l=o.length-1;l>=0;l--){const h=o[l];h&&Object.keys(h).length===0&&delete o[l]}}else assert&&assert(!1,"PhetioObject not found in DescriptionRegistry")}};cr.root={},cr.map=new Map,cr.addedEmitter=new TinyEmitter,cr.removedEmitter=new TinyEmitter;let DescriptionRegistry=cr;tandemNamespace.register("DescriptionRegistry",DescriptionRegistry);const PHET_IO_ENABLED=Tandem.PHET_IO_ENABLED,IO_TYPE_VALIDATOR={valueType:IOType,validationMessage:"phetioType must be an IOType"},BOOLEAN_VALIDATOR$1={valueType:"boolean"},PHET_IO_DOCUMENTATION_VALIDATOR={valueType:"string",isValidValue:a=>!a.includes(`
`),validationMessage:"phetioDocumentation must be provided in the right format"},PHET_IO_EVENT_TYPE_VALIDATOR={valueType:EventType,validationMessage:"invalid phetioEventType"},OBJECT_VALIDATOR={valueType:[Object,null]},objectToPhetioID=a=>a.tandem.phetioID,SKIPPING_MESSAGE=-1;var md,yd,bd;const ENABLE_DESCRIPTION_REGISTRY=!!((bd=(yd=(md=window.phet)==null?void 0:md.chipper)==null?void 0:yd.queryParameters)!=null&&bd.supportsDescriptionPlugin),DEFAULTS={tandem:Tandem.OPTIONAL,descriptionTandem:Tandem.OPTIONAL,phetioType:IOType.ObjectIO,phetioDocumentation:TandemConstants.PHET_IO_OBJECT_METADATA_DEFAULTS.phetioDocumentation,phetioState:TandemConstants.PHET_IO_OBJECT_METADATA_DEFAULTS.phetioState,phetioReadOnly:TandemConstants.PHET_IO_OBJECT_METADATA_DEFAULTS.phetioReadOnly,phetioEventType:EventType.MODEL,phetioHighFrequency:TandemConstants.PHET_IO_OBJECT_METADATA_DEFAULTS.phetioHighFrequency,phetioPlayback:TandemConstants.PHET_IO_OBJECT_METADATA_DEFAULTS.phetioPlayback,phetioFeatured:TandemConstants.PHET_IO_OBJECT_METADATA_DEFAULTS.phetioFeatured,phetioDynamicElement:TandemConstants.PHET_IO_OBJECT_METADATA_DEFAULTS.phetioDynamicElement,phetioDesigned:TandemConstants.PHET_IO_OBJECT_METADATA_DEFAULTS.phetioDesigned,phetioEventMetadata:null,tandemNameSuffix:null};assert&&assert(EventType.phetioType.toStateObject(DEFAULTS.phetioEventType)===TandemConstants.PHET_IO_OBJECT_METADATA_DEFAULTS.phetioEventType,"phetioEventType must have the same default as the default metadata values.");const al=class al extends Disposable{constructor(t){super(),this.tandem=DEFAULTS.tandem,this.phetioID=this.tandem.phetioID,this.phetioObjectInitialized=!1,t&&this.initializePhetioObject({},t)}initializePhetioObject(t,s){if(assert&&assert(!t.hasOwnProperty("isDisposable"),"baseOptions should not contain isDisposable"),this.initializeDisposable(s),assert&&assert(s,"initializePhetioObject must be called with providedOptions"),s.tandem&&Tandem.onMissingTandem(s.tandem),assert&&Tandem.VALIDATION&&s.tandem&&s.tandem.required&&assert(s.tandem.supplied,"required tandems must be supplied"),ENABLE_DESCRIPTION_REGISTRY&&s.tandem&&s.tandem.supplied&&DescriptionRegistry.add(s.tandem,this),!(PHET_IO_ENABLED&&s.tandem&&s.tandem.supplied)){s.tandem&&(this.tandem=s.tandem,this.phetioID=this.tandem.phetioID);return}assert&&assert(!this.phetioObjectInitialized,"cannot initialize twice"),assert&&validate(s.tandem,{valueType:Tandem});const r=combineOptions({},DEFAULTS,t);let o=optionize()(r,s);assert&&validate(o.phetioType,IO_TYPE_VALIDATOR),assert&&validate(o.phetioState,merge({},BOOLEAN_VALIDATOR$1,{validationMessage:"phetioState must be a boolean"})),assert&&validate(o.phetioReadOnly,merge({},BOOLEAN_VALIDATOR$1,{validationMessage:"phetioReadOnly must be a boolean"})),assert&&validate(o.phetioEventType,PHET_IO_EVENT_TYPE_VALIDATOR),assert&&validate(o.phetioDocumentation,PHET_IO_DOCUMENTATION_VALIDATOR),assert&&validate(o.phetioHighFrequency,merge({},BOOLEAN_VALIDATOR$1,{validationMessage:"phetioHighFrequency must be a boolean"})),assert&&validate(o.phetioPlayback,merge({},BOOLEAN_VALIDATOR$1,{validationMessage:"phetioPlayback must be a boolean"})),assert&&validate(o.phetioFeatured,merge({},BOOLEAN_VALIDATOR$1,{validationMessage:"phetioFeatured must be a boolean"})),assert&&validate(o.phetioEventMetadata,merge({},OBJECT_VALIDATOR,{validationMessage:"object literal expected"})),assert&&validate(o.phetioDynamicElement,merge({},BOOLEAN_VALIDATOR$1,{validationMessage:"phetioDynamicElement must be a boolean"})),assert&&validate(o.phetioDesigned,merge({},BOOLEAN_VALIDATOR$1,{validationMessage:"phetioDesigned must be a boolean"})),assert&&assert(this.linkedElements!==null,"this means addLinkedElement was called before instrumentation of this PhetioObject"),this.phetioIsArchetype=!1,this.phetioBaselineMetadata=phetioAPIValidation.enabled||phet.preloads.phetio.queryParameters.phetioEmitAPIBaseline?this.getMetadata(merge({phetioIsArchetype:this.phetioIsArchetype,phetioArchetypePhetioID:this.phetioArchetypePhetioID},o)):null;const n=o.tandem.getArchetypalPhetioID();if(window.phet.preloads.phetio.phetioElementsOverrides){const l=window.phet.preloads.phetio.phetioElementsOverrides[n];l&&(o=optionize()(o,l))}if(this.tandem=o.tandem,this.phetioID=this.tandem.phetioID,this._phetioType=o.phetioType,this._phetioState=o.phetioState,this._phetioReadOnly=o.phetioReadOnly,this._phetioDocumentation=o.phetioDocumentation,this._phetioEventType=o.phetioEventType,this._phetioHighFrequency=o.phetioHighFrequency,this._phetioPlayback=o.phetioPlayback,this._phetioDynamicElement=o.phetioDynamicElement,this._phetioFeatured=o.phetioFeatured,this._phetioEventMetadata=o.phetioEventMetadata,this._phetioDesigned=o.phetioDesigned,this.phetioArchetypePhetioID=null,this.linkedElements=[],this.phetioNotifiedObjectCreated=!1,this.phetioMessageStack=[],this._phetioPlayback&&(this._phetioEventMetadata=this._phetioEventMetadata||{},assert&&assert(!this._phetioEventMetadata.hasOwnProperty("playback"),"phetioEventMetadata.playback should not already exist"),this._phetioEventMetadata.playback=!0),this.tandem.addPhetioObject(this),this.phetioObjectInitialized=!0,assert&&Tandem.VALIDATION&&this.isPhetioInstrumented()&&o.tandemNameSuffix){const l=Array.isArray(o.tandemNameSuffix)?o.tandemNameSuffix:[o.tandemNameSuffix],h=l.filter(g=>this.tandem.name.endsWith(g)||this.tandem.name.endsWith(al.swapCaseOfFirstCharacter(g)));assert&&assert(h.length>0,"Incorrect Tandem suffix, expected = "+l.join(", ")+". actual = "+this.tandem.phetioID)}}static swapCaseOfFirstCharacter(t){const s=t[0];return(s===s.toLowerCase()?s.toUpperCase():s.toLowerCase())+t.substring(1)}get phetioType(){return assert&&assert(PHET_IO_ENABLED&&this.isPhetioInstrumented(),"phetioType only accessible for instrumented objects in PhET-iO brand."),this._phetioType}get phetioState(){return assert&&assert(PHET_IO_ENABLED&&this.isPhetioInstrumented(),"phetioState only accessible for instrumented objects in PhET-iO brand."),this._phetioState}get phetioReadOnly(){return assert&&assert(PHET_IO_ENABLED&&this.isPhetioInstrumented(),"phetioReadOnly only accessible for instrumented objects in PhET-iO brand."),this._phetioReadOnly}get phetioDocumentation(){return assert&&assert(PHET_IO_ENABLED&&this.isPhetioInstrumented(),"phetioDocumentation only accessible for instrumented objects in PhET-iO brand."),this._phetioDocumentation}get phetioEventType(){return assert&&assert(PHET_IO_ENABLED&&this.isPhetioInstrumented(),"phetioEventType only accessible for instrumented objects in PhET-iO brand."),this._phetioEventType}get phetioHighFrequency(){return assert&&assert(PHET_IO_ENABLED&&this.isPhetioInstrumented(),"phetioHighFrequency only accessible for instrumented objects in PhET-iO brand."),this._phetioHighFrequency}get phetioPlayback(){return assert&&assert(PHET_IO_ENABLED&&this.isPhetioInstrumented(),"phetioPlayback only accessible for instrumented objects in PhET-iO brand."),this._phetioPlayback}get phetioDynamicElement(){return assert&&assert(PHET_IO_ENABLED&&this.isPhetioInstrumented(),"phetioDynamicElement only accessible for instrumented objects in PhET-iO brand."),this._phetioDynamicElement}get phetioFeatured(){return assert&&assert(PHET_IO_ENABLED&&this.isPhetioInstrumented(),"phetioFeatured only accessible for instrumented objects in PhET-iO brand."),this._phetioFeatured}get phetioEventMetadata(){return assert&&assert(PHET_IO_ENABLED&&this.isPhetioInstrumented(),"phetioEventMetadata only accessible for instrumented objects in PhET-iO brand."),this._phetioEventMetadata}get phetioDesigned(){return assert&&assert(PHET_IO_ENABLED&&this.isPhetioInstrumented(),"phetioDesigned only accessible for instrumented objects in PhET-iO brand."),this._phetioDesigned}phetioStartEvent(t,s){if(PHET_IO_ENABLED&&this.isPhetioInstrumented()){assert&&assertMutuallyExclusiveOptions(s,["data"],["getData"]);const r=optionize()({data:null,getData:null},s);if(assert&&assert(this.phetioObjectInitialized,"phetioObject should be initialized"),assert&&r.data&&assert(typeof r.data=="object"),assert&&r.getData&&assert(typeof r.getData=="function"),assert&&assert(arguments.length===1||arguments.length===2,"Prevent usage of incorrect signature"),!_.hasIn(window,"phet.phetio.dataStream")){this.phetioMessageStack.push(SKIPPING_MESSAGE);return}const o=this.phetioHighFrequency&&_.hasIn(window,"phet.preloads.phetio.queryParameters")&&!window.phet.preloads.phetio.queryParameters.phetioEmitHighFrequencyEvents&&!phet.phetio.dataStream.isEmittingLowFrequencyEvent(),n=!assert&&!_.hasIn(window,"phet.phetio.dataStream");if(o||this.phetioEventType===EventType.OPT_OUT||n){this.phetioMessageStack.push(SKIPPING_MESSAGE);return}const l=r.getData?r.getData():r.data;this.phetioMessageStack.push(phet.phetio.dataStream.start(this.phetioEventType,this.tandem.phetioID,this.phetioType,t,l,this.phetioEventMetadata,this.phetioHighFrequency)),this.phetioPlayback&&phet.phetio.dataStream.pushNonPlaybackable()}}phetioEndEvent(){if(PHET_IO_ENABLED&&this.isPhetioInstrumented()){assert&&assert(this.phetioMessageStack.length>0,"Must have messages to pop");const t=this.phetioMessageStack.pop();if(t===SKIPPING_MESSAGE)return;this.phetioPlayback&&phet.phetio.dataStream.popNonPlaybackable(),phet.phetio.dataStream.end(t)}}propagateDynamicFlagsToDescendants(){assert&&assert(Tandem.PHET_IO_ENABLED,"phet-io should be enabled"),assert&&assert(phet.phetio&&phet.phetio.phetioEngine,"Dynamic elements cannot be created statically before phetioEngine exists.");const t=phet.phetio.phetioEngine,s=Tandem.launched?[]:Tandem.bufferedPhetioObjects.map(objectToPhetioID);this.tandem.iterateDescendants(r=>{const o=r.phetioID;if(t.hasPhetioObject(o)||!Tandem.launched&&s.includes(o)){assert&&assert(this.isPhetioInstrumented());const n=t.hasPhetioObject(o)?t.getPhetioElement(o):Tandem.bufferedPhetioObjects[s.indexOf(o)];assert&&assert(n,"should have a phetioObject here"),n.phetioIsArchetype=this.phetioIsArchetype,n.setPhetioDynamicElement(this.phetioDynamicElement),n.phetioBaselineMetadata&&(n.phetioBaselineMetadata.phetioIsArchetype=this.phetioIsArchetype)}})}setPhetioDynamicElement(t){assert&&assert(!this.phetioNotifiedObjectCreated,"should not change dynamic element flags after notifying this PhetioObject's creation."),assert&&assert(this.isPhetioInstrumented()),this._phetioDynamicElement=this.phetioIsArchetype?!1:t,this.phetioArchetypePhetioID=t?this.tandem.getArchetypalPhetioID():null,this.phetioBaselineMetadata&&(this.phetioBaselineMetadata.phetioDynamicElement=this.phetioDynamicElement)}markDynamicElementArchetype(){assert&&assert(!this.phetioNotifiedObjectCreated,"should not change dynamic element flags after notifying this PhetioObject's creation."),this.phetioIsArchetype=!0,this.setPhetioDynamicElement(!1),this.phetioBaselineMetadata&&(this.phetioBaselineMetadata.phetioIsArchetype=this.phetioIsArchetype),Tandem.PHET_IO_ENABLED&&this.propagateDynamicFlagsToDescendants()}isPhetioInstrumented(){return this.tandem&&this.tandem.supplied}addLinkedElement(t,s){if(!this.isPhetioInstrumented()){this.linkedElements=null;return}if(PHET_IO_ENABLED&&t.isPhetioInstrumented()){const r=optionize()({phetioFeatured:this.phetioFeatured&&t.phetioFeatured},s);assert&&assert(Array.isArray(this.linkedElements),"linkedElements should be an array");let o=null;s&&s.tandem?o=s.tandem:s&&s.tandemName?o=this.tandem.createTandem(s.tandemName):!s&&t.tandem&&(o=this.tandem.createTandem(t.tandem.name)),o&&(r.tandem=o),this.linkedElements.push(new LinkedElement(t,r))}}removeLinkedElements(t){this.isPhetioInstrumented()&&this.linkedElements&&(assert&&assert(t.isPhetioInstrumented()),this.linkedElements.filter(r=>r.element===t).forEach(r=>{r.dispose(),arrayRemove(this.linkedElements,r)}))}onSimulationConstructionCompleted(){this.phetioBaselineMetadata=null}getPhetioMouseHitTarget(t=!1){if(assert&&assert(phet.tandem.phetioElementSelectionProperty.value!=="none","getPhetioMouseHitTarget should not be called when phetioElementSelectionProperty is none"),!t&&phet.tandem.phetioElementSelectionProperty.value==="linked"){const s=this.getCorrespondingLinkedElement();if(s!=="noCorrespondingLinkedElement")return s.getPhetioMouseHitTarget(!0);if(this.tandem.parentTandem){const r=phet.phetio.phetioEngine.phetioElementMap[this.tandem.parentTandem.phetioID];if(r){const o=r.getCorrespondingLinkedElement();if(o!=="noCorrespondingLinkedElement")return o.getPhetioMouseHitTarget(!0)}}}return phet.tandem.phetioElementSelectionProperty.value==="string"?"phetioNotSelectable":this.getPhetioMouseHitTargetSelf()}getPhetioMouseHitTargetSelf(){return this.isPhetioMouseHitSelectable()?this:"phetioNotSelectable"}isPhetioMouseHitSelectable(){const t=phet.tandem.phetioElementsDisplayProperty.value!=="featured"||this.isDisplayedInFeaturedTree();return this.isPhetioInstrumented()&&t}isDisplayedInFeaturedTree(){if(this.isPhetioInstrumented()&&this.phetioFeatured)return!0;let t=!1;return this.tandem.iterateDescendants(s=>{const r=phet.phetio.phetioEngine.phetioElementMap[s.phetioID];r&&r.isPhetioInstrumented()&&r.phetioFeatured&&(t=!0)}),t}getCorrespondingLinkedElement(){const t=Object.keys(this.tandem.children),s=[];t.forEach(n=>{const l=phetio.PhetioIDUtils.append(this.tandem.phetioID,n),h=phet.phetio.phetioEngine.phetioElementMap[l];h instanceof LinkedElement&&s.push(h)});const r=s.map(n=>phetio.PhetioIDUtils.getComponentName(n.phetioID));let o=null;if(s.length===1)o=s[0];else if(r.includes("property"))o=s[r.indexOf("property")];else if(r.includes("valueProperty"))o=s[r.indexOf("valueProperty")];else return"noCorrespondingLinkedElement";return assert&&assert(o,"phetioElement is needed"),o.element}dispose(){if(assert&&Tandem.PHET_IO_ENABLED&&this.tandem.supplied){const t=[];this.tandem.iterateDescendants(s=>{phet.phetio.phetioEngine.hasPhetioObject(s.phetioID)&&t.push(phet.phetio.phetioEngine.getPhetioElement(s.phetioID))}),animationFrameTimer.runOnNextTick(()=>{assert&&assert(!this.hasOwnProperty("phetioMessageStack")||this.phetioMessageStack.length===0,"phetioMessageStack should be clear"),t.forEach(s=>{assert&&assert(s.isDisposed,`All descendants must be disposed by the next frame: ${s.tandem.phetioID}`)})})}ENABLE_DESCRIPTION_REGISTRY&&this.tandem&&this.tandem.supplied&&DescriptionRegistry.remove(this),this.tandem.removePhetioObject(this),this.linkedElements&&(this.linkedElements.forEach(t=>t.dispose()),this.linkedElements.length=0),super.dispose()}getMetadata(t){t=t||this;const s={phetioTypeName:t.phetioType.typeName,phetioDocumentation:t.phetioDocumentation,phetioState:t.phetioState,phetioReadOnly:t.phetioReadOnly,phetioEventType:EventType.phetioType.toStateObject(t.phetioEventType),phetioHighFrequency:t.phetioHighFrequency,phetioPlayback:t.phetioPlayback,phetioDynamicElement:t.phetioDynamicElement,phetioIsArchetype:t.phetioIsArchetype,phetioFeatured:t.phetioFeatured,phetioDesigned:t.phetioDesigned};return t.phetioArchetypePhetioID&&(s.phetioArchetypePhetioID=t.phetioArchetypePhetioID),s}static create(t){return new al(t)}};al.DEFAULT_OPTIONS=DEFAULTS,al.METADATA_DOCUMENTATION=`Get metadata about the PhET-iO Element. This includes the following keys:<ul><li><strong>phetioTypeName:</strong> The name of the PhET-iO Type
</li><li><strong>phetioDocumentation:</strong> default - null. Useful notes about a PhET-iO Element, shown in the PhET-iO Studio Wrapper</li><li><strong>phetioState:</strong> default - true. When true, includes the PhET-iO Element in the PhET-iO state
</li><li><strong>phetioReadOnly:</strong> default - false. When true, you can only get values from the PhET-iO Element; no setting allowed.
</li><li><strong>phetioEventType:</strong> default - MODEL. The category of event that this element emits to the PhET-iO Data Stream.
</li><li><strong>phetioDynamicElement:</strong> default - false. If this element is a "dynamic element" that can be created and destroyed throughout the lifetime of the sim (as opposed to existing forever).
</li><li><strong>phetioIsArchetype:</strong> default - false. If this element is an archetype for a dynamic element.
</li><li><strong>phetioFeatured:</strong> default - false. If this is a featured PhET-iO Element.
</li><li><strong>phetioArchetypePhetioID:</strong> default - ''. If an applicable dynamic element, this is the phetioID of its archetype.
</li></ul>`;let PhetioObject=al;class LinkedElement extends PhetioObject{constructor(t,s){assert&&assert(!!t,"coreElement should be defined");const r=optionize()({phetioType:LinkedElementIO,phetioState:!0,phetioFeatured:t.phetioFeatured},s);assert&&assert(!r.hasOwnProperty("phetioReadOnly"),"phetioReadOnly set by LinkedElement"),r.phetioReadOnly=!0,super(r),this.element=t}}tandemNamespace.register("PhetioObject",PhetioObject);const cache$9=new IOTypeCache,FunctionIO=(a,t)=>{for(let r=0;r<t.length;r++)assert&&assert(t[r],"parameter type was not truthy");assert&&assert(a,"return type was not truthy");const s=`${a.typeName}.${t.map(r=>r.typeName).join(",")}`;if(!cache$9.has(s)){let r=t.map(n=>n.typeName).join(", ");r===""&&(r="none");const o=t.map(n=>n.typeName).join(",");cache$9.set(s,new IOType(`FunctionIO(${o})=>${a.typeName}`,{valueType:"function",isFunctionType:!0,parameterTypes:t.concat([a]),documentation:`Wrapper for the built-in JS function type.<br><strong>Arguments:</strong> ${r}<br><strong>Return Type:</strong> ${a.typeName}`}))}return cache$9.get(s)};tandemNamespace.register("FunctionIO",FunctionIO);const cache$8=new IOTypeCache,NullableIO=a=>(assert&&assert(a,"NullableIO needs parameterType"),cache$8.has(a)||cache$8.set(a,new IOType(`NullableIO<${a.typeName}>`,{documentation:"A PhET-iO Type adding support for null in addition to the behavior of its parameter.",isValidValue:t=>t===null||Validation.isValueValid(t,a.validator),parameterTypes:[a],toStateObject:t=>t===null?null:a.toStateObject(t),fromStateObject:t=>t===null?null:a.fromStateObject(t),stateSchema:StateSchema.asValue(`null|<${a.typeName}>`,{isValidValue:t=>t===null||a.isStateObjectValid(t)})})),cache$8.get(a));tandemNamespace.register("NullableIO",NullableIO);const VoidIO=new IOType("VoidIO",{isValidValue:()=>!0,documentation:"Type for which there is no instance, usually to mark functions without a return value",toStateObject:()=>{}});tandemNamespace.register("VoidIO",VoidIO);const Xo=class Xo extends EnumerationValue{};Xo.UNDEFER=new Xo,Xo.NOTIFY=new Xo,Xo.enumeration=new Enumeration(Xo);let PropertyStatePhase=Xo;axon.register("PropertyStatePhase",PropertyStatePhase);class PropertyStateHandler{constructor(){this.initialized=!1,this.phaseCallbackSets=new PhaseCallbackSets,this.undeferBeforeUndeferMapPair=new OrderDependencyMapPair(PropertyStatePhase.UNDEFER,PropertyStatePhase.UNDEFER),this.undeferBeforeNotifyMapPair=new OrderDependencyMapPair(PropertyStatePhase.UNDEFER,PropertyStatePhase.NOTIFY),this.notifyBeforeUndeferMapPair=new OrderDependencyMapPair(PropertyStatePhase.NOTIFY,PropertyStatePhase.UNDEFER),this.notifyBeforeNotifyMapPair=new OrderDependencyMapPair(PropertyStatePhase.NOTIFY,PropertyStatePhase.NOTIFY),this.mapPairs=[this.undeferBeforeUndeferMapPair,this.undeferBeforeNotifyMapPair,this.notifyBeforeUndeferMapPair,this.notifyBeforeNotifyMapPair]}initialize(t){assert&&assert(!this.initialized,"cannot initialize twice"),t.onBeforeApplyStateEmitter.addListener(s=>{if(s instanceof ReadOnlyProperty&&!s.isDeferred){s.setDeferred(!0);const r=s.tandem.phetioID,o=()=>{const n=s.setDeferred(!1);this.phaseCallbackSets.addNotifyPhaseCallback(new PhaseCallback(r,PropertyStatePhase.NOTIFY,n||_.noop))};this.phaseCallbackSets.addUndeferPhaseCallback(new PhaseCallback(r,PropertyStatePhase.UNDEFER,o))}}),t.undeferEmitter.addListener(s=>{this.undeferAndNotifyProperties(new Set(Object.keys(s)))}),t.isSettingStateProperty.lazyLink(s=>{assert&&!s&&assert(this.phaseCallbackSets.size===0,"PhaseCallbacks should have all been applied")}),this.initialized=!0}static validateInstrumentedProperty(t){assert&&Tandem.VALIDATION&&assert(t instanceof ReadOnlyProperty&&t.isPhetioInstrumented(),`must be an instrumented Property: ${t}`)}validatePropertyPhasePair(t,s){PropertyStateHandler.validateInstrumentedProperty(t)}getMapPairFromPhases(t,s){const r=this.mapPairs.filter(o=>t===o.beforePhase&&s===o.afterPhase);return assert&&assert(r.length===1,"one and only one map should match the provided phases"),r[0]}registerPhetioOrderDependency(t,s,r,o){Tandem.PHET_IO_ENABLED&&(this.validatePropertyPhasePair(t,s),this.validatePropertyPhasePair(r,o),assert&&t===r&&assert(s!==o,"cannot set same Property to same phase"),this.getMapPairFromPhases(s,o).addOrderDependency(t.tandem.phetioID,r.tandem.phetioID))}propertyInAnOrderDependency(t){return PropertyStateHandler.validateInstrumentedProperty(t),_.some(this.mapPairs,s=>s.usesPhetioID(t.tandem.phetioID))}unregisterOrderDependenciesForProperty(t){Tandem.PHET_IO_ENABLED&&(PropertyStateHandler.validateInstrumentedProperty(t),this.propertyInAnOrderDependency(t)&&(assert&&assert(this.propertyInAnOrderDependency(t),"Property must be registered in an order dependency to be unregistered"),this.mapPairs.forEach(s=>s.unregisterOrderDependenciesForProperty(t))))}undeferAndNotifyProperties(t){assert&&assert(this.initialized,"must be initialized before getting called");const s={};let r=0;for(;this.phaseCallbackSets.size>0;)r++,r>5e3&&this.errorInUndeferAndNotifyStep(s),this.attemptToApplyPhases(PropertyStatePhase.UNDEFER,s,t),this.attemptToApplyPhases(PropertyStatePhase.NOTIFY,s,t)}errorInUndeferAndNotifyStep(t){const s=[];this.phaseCallbackSets.forEach(l=>s.push(l.getTerm()));const r=[];this.mapPairs.forEach(l=>{const h=l.beforeMap;for(const[g,d]of h)d.forEach(A=>{const S=g+h.beforePhase,O=A+h.afterPhase;(s.includes(S)||s.includes(O))&&r.push({beforeTerm:S,afterTerm:O})})});let o="";console.log("still to be undeferred",this.phaseCallbackSets.undeferSet),console.log("still to be notified",this.phaseCallbackSets.notifySet),console.log("order dependencies that apply to the still todos",r),r.forEach(l=>{o+=`${l.beforeTerm}	${l.afterTerm}
`}),console.log(`

in graphable form:

`,o);const n="Impossible set state: from undeferAndNotifyProperties; ordering constraints cannot be satisfied";if(assert&&assert(!1,n),!assert)throw new Error(n)}getNumberOfOrderDependencies(){let t=0;return this.mapPairs.forEach(s=>{s.afterMap.forEach(r=>{t+=r.size})}),t}attemptToApplyPhases(t,s,r){const o=this.phaseCallbackSets.getSetFromPhase(t);for(const n of o)assert&&assert(n.phase===t,"phaseCallbackSet should only include callbacks for provided phase"),this.phetioIDCanApplyPhase(n.phetioID,t,s,r)&&(n.listener(),o.delete(n),s[n.getTerm()]=!0)}phetioIDCanApplyPhase(t,s,r,o){if(s===PropertyStatePhase.NOTIFY&&!r[t+PropertyStatePhase.UNDEFER])return!1;const n=[];this.mapPairs.forEach(l=>{l.afterPhase===s&&n.push(l.afterMap)});for(let l=0;l<n.length;l++){const h=n[l];if(!h.has(t))return!0;const g=h.get(t);assert&&assert(g,"must have this set");for(const d of g)if(!r[d+h.beforePhase]&&o.has(d)&&o.has(t))return!1}return!0}}class PhaseCallback{constructor(t,s,r=_.noop){this.phetioID=t,this.phase=s,this.listener=r}getTerm(){return this.phetioID+this.phase}}class OrderDependencyMapPair{constructor(t,s){this.beforeMap=new Map,this.beforeMap.beforePhase=t,this.beforeMap.afterPhase=s,this.afterMap=new Map,this.afterMap.beforePhase=t,this.afterMap.afterPhase=s,this.beforeMap.otherMap=this.afterMap,this.afterMap.otherMap=this.beforeMap,this.beforePhase=t,this.afterPhase=s}addOrderDependency(t,s){this.beforeMap.has(t)||this.beforeMap.set(t,new Set),this.beforeMap.get(t).add(s),this.afterMap.has(s)||this.afterMap.set(s,new Set),this.afterMap.get(s).add(t)}unregisterOrderDependenciesForProperty(t){const s=t.tandem.phetioID;[this.beforeMap,this.afterMap].forEach(r=>{r.has(s)&&r.get(s).forEach(o=>{const n=r.otherMap.get(o);n&&n.delete(s),n.size===0&&r.otherMap.delete(o)}),r.delete(s)}),assertSlow&&[this.beforeMap,this.afterMap].forEach(r=>{r.forEach((o,n)=>{assertSlow&&assertSlow(n!==s,"should not be a key"),assertSlow&&assertSlow(!o.has(s),"should not be in a value list")})})}usesPhetioID(t){return this.beforeMap.has(t)||this.afterMap.has(t)}}class PhaseCallbackSets{constructor(){this.undeferSet=new Set,this.notifySet=new Set}get size(){return this.undeferSet.size+this.notifySet.size}forEach(t){this.undeferSet.forEach(t),this.notifySet.forEach(t)}addUndeferPhaseCallback(t){this.undeferSet.add(t)}addNotifyPhaseCallback(t){this.notifySet.add(t)}getSetFromPhase(t){return t===PropertyStatePhase.NOTIFY?this.notifySet:this.undeferSet}}axon.register("PropertyStateHandler",PropertyStateHandler);const propertyStateHandlerSingleton=new PropertyStateHandler;axon.register("propertyStateHandlerSingleton",propertyStateHandlerSingleton);class TinyProperty extends TinyEmitter{constructor(t,s,r){super(s,r),this._value=t}get(){return this._value}get value(){return this.get()}set value(t){this.set(t)}set(t){if(!this.equalsValue(t)){const s=this._value;this.setPropertyValue(t),this.notifyListeners(s)}}setPropertyValue(t){this._value=t}equalsValue(t){return this.areValuesEqual(t,this._value)}areValuesEqual(t,s){if(this.useDeepEquality){const r=t,o=s;if(r&&o&&r.constructor===o.constructor)return assert&&assert(!!r.equals,"no equals function for 1st arg"),assert&&assert(!!o.equals,"no equals function for 2nd arg"),assert&&assert(r.equals(o)===o.equals(r),"incompatible equality checks"),r.equals(o)}return t===s}notifyListeners(t){this.emit(this._value,t,this)}link(t){this.addListener(t),t(this._value,null,this)}lazyLink(t){this.addListener(t)}unlink(t){this.removeListener(t)}unlinkAll(){this.removeAllListeners()}linkAttribute(t,s){const r=o=>{t[s]=o};return this.link(r),r}isSettable(){return!0}dispose(){this.unlinkAll(),super.dispose()}}axon.register("TinyProperty",TinyProperty);const units={values:["1/(cm*M)","%","A","AMU","atm","AU","AU^2","cm","cm^2","C","°","°C","F","°F","g","G","Hz","J","K","kg","kg/m^3","kg·m/s","km/s","kPa","L","L/s","m","m^3","m/s","m/s/s","m/s^2","mA","mm","mol","mol/L","mol/s","M","N","N/m","nm","nm/ps","N·s/m","Ω","Ω·cm","Pa·s","particles/ps","pm","pm/ps","pm/s","pm/s^2","pm^3","ps","radians","radians/s","radians/s^2","rpm","s","V","view-coordinates/s","W","Wb","years"],isValidUnits:function(a){return _.includes(units.values,a)}};axon.register("units",units);const isClearingPhetioDynamicElementsProperty=new TinyProperty(!1);tandemNamespace.register("isClearingPhetioDynamicElementsProperty",isClearingPhetioDynamicElementsProperty);const isPhetioStateEngineManagingPropertyValuesProperty=new TinyProperty(!1);tandemNamespace.register("isPhetioStateEngineManagingPropertyValuesProperty",isPhetioStateEngineManagingPropertyValuesProperty);const VALIDATE_OPTIONS_FALSE$2={validateValidator:!1};let globalId$9=0;const cache$7=new IOTypeCache,strictAxonDependencies=_.hasIn(window,"phet.chipper.queryParameters")&&phet.chipper.queryParameters.strictAxonDependencies&&phet.chipper.queryParameters.listenerOrder==="default",derivationStack=[],Ar=class Ar extends PhetioObject{constructor(t,s){const r=optionize()({units:null,reentrant:!1,hasListenerOrderDependencies:!1,tandemNameSuffix:["Property",DYNAMIC_ARCHETYPE_NAME],phetioOuterType:Ar.PropertyIO,phetioValueType:IOType.ObjectIO},s);assert&&r.units&&assert(units.isValidUnits(r.units),`invalid units: ${r.units}`),r.units&&(r.phetioEventMetadata=r.phetioEventMetadata||{},assert&&assert(!r.phetioEventMetadata.hasOwnProperty("units"),"units should be supplied by Property, not elsewhere"),r.phetioEventMetadata.units=r.units),assert&&s&&assert&&assert(!s.phetioType,"Set phetioType via phetioValueType"),r.phetioOuterType&&r.phetioValueType&&(r.phetioType=r.phetioOuterType(r.phetioValueType)),Validation.containsValidatorKey(r)||(r.isValidValue=()=>!0),super(r),this.id=globalId$9++,this.units=r.units,this.isPhetioInstrumented()&&(assert&&Tandem.VALIDATION&&assert(this.phetioType,`phetioType passed to Property must be specified. Tandem.phetioID: ${this.tandem.phetioID}`),assert&&Tandem.VALIDATION&&assert(r.phetioType.parameterTypes[0],`phetioType parameter type must be specified (only one). Tandem.phetioID: ${this.tandem.phetioID}`),assert&&assert(r.phetioValueType!==IOType.ObjectIO,"PhET-iO Properties must specify a phetioValueType: "+this.phetioID)),this.validValues=r.validValues,this.tinyProperty=new TinyProperty(t,null,r.hasListenerOrderDependencies),this.tinyProperty.useDeepEquality=r.valueComparisonStrategy&&r.valueComparisonStrategy==="equalsFunction",this.notifying=!1,this.reentrant=r.reentrant,this.isDeferred=!1,this.deferredValue=null,this.hasDeferredValue=!1,this.valueValidator=_.pick(r,Validation.VALIDATOR_KEYS),this.valueValidator.validationMessage=this.valueValidator.validationMessage||"Property value not valid",this.valueValidator.phetioType&&(assert&&assert(!!this.valueValidator.phetioType.parameterTypes[0],"unexpected number of parameters for Property"),this.valueValidator.phetioType=this.valueValidator.phetioType.parameterTypes[0]),assert&&(Validation.validateValidator(this.valueValidator),validate(t,this.valueValidator,VALIDATE_OPTIONS_FALSE$2))}isSettable(){return!1}get(){return assert&&strictAxonDependencies&&derivationStack.length>0&&(derivationStack[derivationStack.length-1].includes(this)||assert&&assert(!1,"accessed value outside of dependency tracking")),this.tinyProperty.get()}set(t){isPhetioStateEngineManagingPropertyValuesProperty.value&&!isClearingPhetioDynamicElementsProperty.value&&this.isPhetioInstrumented()&&this.phetioState&&this.isSettable()||this.unguardedSet(t)}unguardedSet(t){if(!this.isDisposed){if(this.isDeferred)this.deferredValue=t,this.hasDeferredValue=!0;else if(!this.equalsValue(t)){const s=this.get();this.setPropertyValue(t),this._notifyListeners(s)}}}setPropertyValue(t){this.tinyProperty.setPropertyValue(t)}equalsValue(t){return this.areValuesEqual(t,this.get())}areValuesEqual(t,s){return this.tinyProperty.areValuesEqual(t,s)}_notifyListeners(t){const s=this.get();assert&&validate(s,this.valueValidator,VALIDATE_OPTIONS_FALSE$2),Tandem.PHET_IO_ENABLED&&this.isPhetioInstrumented()&&this.phetioStartEvent(Ar.CHANGED_EVENT_NAME,{getData:()=>{const r=this.phetioType.parameterTypes[0];return{oldValue:NullableIO(r).toStateObject(t),newValue:r.toStateObject(s)}}}),assert&&assert(!this.notifying||this.reentrant,`reentry detected, value=${s}, oldValue=${t}`),this.notifying=!0,this.tinyProperty.emit(s,t,this),this.notifying=!1,Tandem.PHET_IO_ENABLED&&this.isPhetioInstrumented()&&this.phetioEndEvent()}notifyListenersStatic(){this._notifyListeners(null)}setDeferred(t){if(assert&&assert(!this.isDisposed,"cannot defer Property if already disposed."),t)assert&&assert(!this.isDeferred,"Property already deferred"),this.isDeferred=!0;else{assert&&assert(this.isDeferred,"Property wasn't deferred"),this.isDeferred=!1;const s=this.get();if(this.hasDeferredValue&&(this.setPropertyValue(this.deferredValue),this.hasDeferredValue=!1,this.deferredValue=null),!this.equalsValue(s))return()=>!this.isDisposed&&this._notifyListeners(s)}return null}get value(){return this.get()}set value(t){this.set(t)}addPhetioStateDependencies(t){assert&&assert(Array.isArray(t),"Array expected");for(let s=0;s<t.length;s++){const r=t[s];r instanceof Ar&&r.isPhetioInstrumented()&&this.isPhetioInstrumented()&&propertyStateHandlerSingleton.registerPhetioOrderDependency(r,PropertyStatePhase.UNDEFER,this,PropertyStatePhase.NOTIFY)}}link(t,s){s&&s.phetioDependencies&&this.addPhetioStateDependencies(s.phetioDependencies),this.tinyProperty.addListener(t),t(this.get(),null,this)}lazyLink(t,s){s&&s.phetioDependencies&&this.addPhetioStateDependencies(s.phetioDependencies),this.tinyProperty.lazyLink(t)}unlink(t){this.tinyProperty.unlink(t)}unlinkAll(){this.tinyProperty.unlinkAll()}linkAttribute(t,s){const r=o=>{t[s]=o};return this.link(r),r}toString(){return`Property#${this.id}{${this.get()}}`}debug(t){const s=r=>console.log(t,r);return this.link(s),s}isValueValid(t){return this.getValidationError(t)===null}getValidationError(t){return Validation.getValidationError(t,this.valueValidator,VALIDATE_OPTIONS_FALSE$2)}dispose(){this.isPhetioInstrumented()&&propertyStateHandlerSingleton.unregisterOrderDependenciesForProperty(this),super.dispose(),this.tinyProperty.dispose()}hasListener(t){return this.tinyProperty.hasListener(t)}getListenerCount(){return this.tinyProperty.getListenerCount()}forEachListener(t){this.tinyProperty.forEachListener(t)}hasListeners(){return assert&&assert(arguments.length===0,"Property.hasListeners should be called without arguments"),this.tinyProperty.hasListeners()}static PropertyIO(t){return assert&&assert(t,"PropertyIO needs parameterType"),cache$7.has(t)||cache$7.set(t,new IOType(`PropertyIO<${t.typeName}>`,{valueType:Ar,documentation:"Observable values that send out notifications when the value changes. This differs from the traditional listener pattern in that added listeners also receive a callback with the current value when the listeners are registered. This is a widely-used pattern in PhET-iO simulations.",methodOrder:["link","lazyLink"],events:[Ar.CHANGED_EVENT_NAME],parameterTypes:[t],toStateObject:s=>(assert&&assert(t.toStateObject,`toStateObject doesn't exist for ${t.typeName}`),{value:t.toStateObject(s.value),validValues:NullableIO(ArrayIO(t)).toStateObject(s.validValues===void 0?null:s.validValues),units:NullableIO(StringIO).toStateObject(s.units)}),applyState:(s,r)=>{const o=NullableIO(StringIO).fromStateObject(r.units);assert&&assert(s.units===o,"Property units do not match"),assert&&assert(s.isSettable(),"Property should be settable"),s.unguardedSet(t.fromStateObject(r.value)),r.validValues&&(s.validValues=r.validValues.map(n=>t.fromStateObject(n)))},stateSchema:{value:t,validValues:NullableIO(ArrayIO(t)),units:NullableIO(StringIO)},methods:{getValue:{returnType:t,parameterTypes:[],implementation:Ar.prototype.get,documentation:"Gets the current value."},getValidationError:{returnType:NullableIO(StringIO),parameterTypes:[t],implementation:Ar.prototype.getValidationError,documentation:"Checks to see if a proposed value is valid. Returns the first validation error, or null if the value is valid."},setValue:{returnType:VoidIO,parameterTypes:[t],implementation:function(s){this.set(s)},documentation:"Sets the value of the Property. If the value differs from the previous value, listeners are notified with the new value.",invocableForReadOnlyElements:!1},link:{returnType:VoidIO,parameterTypes:[FunctionIO(VoidIO,[t,NullableIO(t)])],implementation:Ar.prototype.link,documentation:"Adds a listener which will be called when the value changes. On registration, the listener is also called with the current value. The listener takes two arguments, the new value and the previous value."},lazyLink:{returnType:VoidIO,parameterTypes:[FunctionIO(VoidIO,[t,NullableIO(t)])],implementation:Ar.prototype.lazyLink,documentation:'Adds a listener which will be called when the value changes. This method is like "link", but without the current-value callback on registration. The listener takes two arguments, the new value and the previous value.'},unlink:{returnType:VoidIO,parameterTypes:[FunctionIO(VoidIO,[t])],implementation:Ar.prototype.unlink,documentation:"Removes a listener."}}})),cache$7.get(t)}getPhetioMouseHitTarget(t=!1){return phet.tandem.phetioElementSelectionProperty.value==="string"?this.getPhetioMouseHitTargetSelf():super.getPhetioMouseHitTarget(t)}};Ar.CHANGED_EVENT_NAME="changed";let ReadOnlyProperty=Ar;axon.register("ReadOnlyProperty",ReadOnlyProperty);class Property extends ReadOnlyProperty{constructor(t,s){super(t,s),this._initialValue=t}getInitialValue(){return this._initialValue}get initialValue(){return this.getInitialValue()}setInitialValue(t){this._initialValue=t}get value(){return super.value}set value(t){super.set(t)}reset(){this.set(this._initialValue)}set(t){super.set(t)}isSettable(){return!0}}axon.register("Property",Property);const VALID_NON_NAN$1={isValidValue:a=>!isNaN(a.x)&&!isNaN(a.y),validationMessage:"Vector2 x/y should not be NaN"};class Vector2Property extends Property{constructor(t,s){const r=optionize()({valueType:Vector2,validBounds:null,validators:[],phetioValueType:Vector2.Vector2IO},s);r.validators.push(VALID_NON_NAN$1),r.validBounds&&r.validators.push({validationMessage:"Vector2 is not within validBounds",isValidValue:o=>r.validBounds.containsPoint(o)}),super(t,r),this.validBounds=r.validBounds}}dot.register("Vector2Property",Vector2Property);const BooleanIO=new IOType("BooleanIO",{supertype:ValueIO,valueType:"boolean",documentation:"PhET-iO Type for Javascript's boolean primitive type",stateSchema:StateSchema.asValue("boolean",{valueType:"boolean"}),toStateObject:_.identity});tandemNamespace.register("BooleanIO",BooleanIO);class BooleanProperty extends Property{constructor(t,s){const r=optionize()({valueType:"boolean",phetioValueType:BooleanIO},s);super(t,r)}toggle(){this.value=!this.value}}axon.register("BooleanProperty",BooleanProperty);const stepTimer=new Timer;axon.register("stepTimer",stepTimer);class CallbackTimer{constructor(t){this.callbacks=[],this._delay=400,this._interval=100,this.delayID=null,this.intervalID=null,this.fired=!1,(t==null?void 0:t.delay)!==void 0&&(this.delay=t.delay),(t==null?void 0:t.interval)!==void 0&&(this.interval=t.interval),t!=null&&t.callback&&this.callbacks.push(t.callback)}isRunning(){return this.delayID!==null||this.intervalID!==null}start(){this.isRunning()||(this.fired=!1,this.delayID=stepTimer.setTimeout(()=>{this.delayID=null,this.intervalID=stepTimer.setInterval(()=>this.fire(),this.interval),this.fire()},this.delay))}stop(t){this.isRunning()&&(this.delayID&&(stepTimer.clearTimeout(this.delayID),this.delayID=null),this.intervalID&&(stepTimer.clearInterval(this.intervalID),this.intervalID=null),t&&!this.fired&&this.fire())}addCallback(t){this.callbacks.includes(t)||this.callbacks.push(t)}removeCallback(t){const s=this.callbacks.indexOf(t);s!==-1&&this.callbacks.splice(s,1)}fire(){const t=this.callbacks.slice(0);for(let s=0;s<t.length;s++)t[s]();this.fired=!0}set delay(t){assert&&assert(t>=0,`bad value for delay: ${t}`),this._delay=t}get delay(){return this._delay}set interval(t){assert&&assert(t>0,`bad value for interval: ${t}`),this._interval=t}get interval(){return this._interval}dispose(){this.stop(!1),this.callbacks.length=0}}axon.register("CallbackTimer",CallbackTimer);const VALIDATE_OPTIONS_FALSE$1={validateValidator:!1},EMPTY_ARRAY$1=[];assert&&Object.freeze(EMPTY_ARRAY$1);const PARAMETER_KEYS=["name","phetioType","phetioDocumentation","phetioPrivate"].concat(Validation.VALIDATOR_KEYS),paramToPhetioType=a=>a.phetioType,paramToName=a=>a.name;class PhetioDataHandler extends PhetioObject{constructor(t){var o;const s=optionize()({parameters:EMPTY_ARRAY$1,hasListenerOrderDependencies:!1,phetioPlayback:PhetioObject.DEFAULT_OPTIONS.phetioPlayback,phetioEventMetadata:PhetioObject.DEFAULT_OPTIONS.phetioEventMetadata,phetioDocumentation:""},t);assert&&PhetioDataHandler.validateParameters(s.parameters,!!((o=s.tandem)!=null&&o.supplied)),assert&&assert(s.phetioType===void 0,"PhetioDataHandler sets its own phetioType. Instead provide parameter phetioTypes through `options.parameters` with a phetioOuterType");const r=s.parameters.filter(paramToPhetioType);s.phetioType=s.phetioOuterType(r.map(paramToPhetioType)),s.phetioPlayback&&(s.phetioEventMetadata=s.phetioEventMetadata||{},assert&&assert(!s.phetioEventMetadata.hasOwnProperty("dataKeys"),"dataKeys should be supplied by PhetioDataHandler, not elsewhere"),s.phetioEventMetadata.dataKeys=s.parameters.map(paramToName)),s.phetioDocumentation=PhetioDataHandler.getPhetioDocumentation(s.phetioDocumentation,r),super(s),this.parameters=s.parameters}static validateParameters(t,s){validate(t,{valueType:Array});let r=!1;for(let o=0;o<t.length;o++){const n=t[o];assert&&assert(Object.getPrototypeOf(n)===Object.prototype,"Extra prototype on parameter object is a code smell"),r=r||n.phetioPrivate,assert&&r&&assert(n.phetioPrivate,"after first phetioPrivate parameter, all subsequent parameters must be phetioPrivate"),assert&&s&&Tandem.VALIDATION&&assert(n.phetioType||n.phetioPrivate,"instrumented Emitters must include phetioType for each parameter or be marked as `phetioPrivate`."),assert&&n.phetioType&&assert(n.name,"`name` is a required parameter for phet-io instrumented parameters."),assert&&assertMutuallyExclusiveOptions(n,["phetioPrivate"],["name","phetioType","phetioDocumentation"]),assert&&assert(_.intersection(Object.keys(n),Validation.VALIDATOR_KEYS).length>0,`validator must be specified for parameter ${o}`);for(const l in n)assert&&assert(PARAMETER_KEYS.includes(l),`unrecognized parameter key: ${l}`);assert&&Object.freeze(t[o]),Validation.validateValidator(n)}assert&&Object.freeze(t)}validateArguments(...t){assert&&assert(t.length===this.parameters.length,`Emitted unexpected number of args. Expected: ${this.parameters.length} and received ${t.length}`);for(let s=0;s<this.parameters.length;s++){const r=this.parameters[s];assert&&validate(t[s],r,VALIDATE_OPTIONS_FALSE$1),r.phetioType&&!r.valueType&&assert&&validate(t[s],r.phetioType.validator,VALIDATE_OPTIONS_FALSE$1)}}getValidationErrors(...t){return assert&&assert(t.length===this.parameters.length,`Emitted unexpected number of args. Expected: ${this.parameters.length} and received ${t.length}`),this.parameters.map((s,r)=>Validation.getValidationError(t[r],s,VALIDATE_OPTIONS_FALSE$1))}getPhetioData(...t){assert&&assert(Tandem.PHET_IO_ENABLED,"should only get phet-io data in phet-io brand");let s=null;if(this.parameters.length>0){s={};for(let r=0;r<this.parameters.length;r++){const o=this.parameters[r];o.phetioPrivate||(assert&&assert(o.name,"name required"),s[o.name]=o.phetioType.toStateObject(t[r]))}}return s}static getPhetioDocumentation(t,s){const r=o=>{const n=o.phetioDocumentation?` - ${o.phetioDocumentation}`:"";return`<li>${o.name}: ${o.phetioType.typeName}${n}</li>`};return t+(s.length===0?"<br>No parameters.":`<br>The parameters are:<br/><ol>${s.map(r).join("<br/>")}</ol>`)}}axon.register("PhetioDataHandler",PhetioDataHandler);const PHET_IO_STATE_DEFAULT$2=!1,Oa=class Oa extends PhetioDataHandler{constructor(t){const s=optionize()({phetioOuterType:Oa.EmitterIO,phetioState:PHET_IO_STATE_DEFAULT$2},t);super(s),this.tinyEmitter=new TinyEmitter(null,s.hasListenerOrderDependencies)}emit(...t){assert&&assert(this.tinyEmitter instanceof TinyEmitter,"Emitter should not emit until constructor complete"),assert&&this.validateArguments(...t),Tandem.PHET_IO_ENABLED&&this.isPhetioInstrumented()&&this.phetioStartEvent("emitted",{data:this.getPhetioData(...t)}),this.tinyEmitter.emit(...t),Tandem.PHET_IO_ENABLED&&this.isPhetioInstrumented()&&this.phetioEndEvent()}dispose(){this.tinyEmitter.dispose(),super.dispose()}addListener(t){this.tinyEmitter.addListener(t)}removeListener(t){this.tinyEmitter.removeListener(t)}removeAllListeners(){this.tinyEmitter.removeAllListeners()}hasListener(t){return this.tinyEmitter.hasListener(t)}hasListeners(){return this.tinyEmitter.hasListeners()}getListenerCount(){return this.tinyEmitter.getListenerCount()}debug(t){const s=(...r)=>console.log(t,...r);return this.addListener(s),s}};Oa.EmitterIO=t=>{const s=t.map(getTypeName$1).join(",");return cache$6.has(s)||cache$6.set(s,new IOType(`EmitterIO<${t.map(getTypeName$1).join(", ")}>`,{valueType:Oa,documentation:"Emits when an event occurs and calls added listeners.",parameterTypes:t,events:["emitted"],metadataDefaults:{phetioState:PHET_IO_STATE_DEFAULT$2},methods:{addListener:{returnType:VoidIO,parameterTypes:[FunctionIO(VoidIO,t)],implementation:Oa.prototype.addListener,documentation:"Adds a listener which will be called when the emitter emits."},removeListener:{returnType:VoidIO,parameterTypes:[FunctionIO(VoidIO,t)],implementation:Oa.prototype.removeListener,documentation:"Remove a listener."},emit:{returnType:VoidIO,parameterTypes:t,implementation:function(...r){this.emit(...r)},documentation:"Emits a single event to all listeners.",invocableForReadOnlyElements:!1},getValidationErrors:{returnType:ArrayIO(NullableIO(StringIO)),parameterTypes:t,implementation:function(...r){return this.getValidationErrors(...r)},documentation:"Checks to see if the proposed values are valid. Returns an array of length N where each element is an error (string) or null if the value is valid."}}})),cache$6.get(s)};let Emitter=Oa;const getTypeName$1=a=>a.typeName,cache$6=new IOTypeCache;axon.register("Emitter",Emitter);const VALID_INTEGER={valueType:"number",isValidValue:a=>a%1===0,validationMessage:"Should be a valid integer"},VALID_NON_NAN={isValidValue:a=>!isNaN(a),validationMessage:"Should not be NaN"},VALIDATE_OPTIONS_FALSE={validateValidator:!1},VALID_NUMBER_TYPES=["FloatingPoint","Integer"],RANGE_PROPERTY_TANDEM_NAME="rangeProperty",DEFAULT_RANGE=Range.EVERYTHING,PropertyIOImpl=Property.PropertyIO(NumberIO),Ol=class Ol extends Property{constructor(t,s){var d;assert&&s&&assertMutuallyExclusiveOptions(["range"],["validValues"]);const r=optionize()({numberType:"FloatingPoint",range:DEFAULT_RANGE,validators:[],phetioOuterType:()=>Ol.NumberPropertyIO},s);r.rangePropertyOptions=optionize()({phetioDocumentation:"Provides the range of possible values for the parent NumberPropertyIO",phetioValueType:Range.RangeIO,phetioReadOnly:!0,tandem:r.range!==DEFAULT_RANGE?(d=r.tandem)==null?void 0:d.createTandem(RANGE_PROPERTY_TANDEM_NAME):Tandem.OPT_OUT},r.rangePropertyOptions),assert&&Tandem.VALIDATION&&r.rangePropertyOptions.tandem&&r.rangePropertyOptions.tandem.supplied&&assert&&assert(r.rangePropertyOptions.tandem.name===RANGE_PROPERTY_TANDEM_NAME,`rangePropertyOptions.tandem.name must be ${RANGE_PROPERTY_TANDEM_NAME}: ${r.rangePropertyOptions.tandem.name}`),r.valueType="number",r.phetioValueType=NumberIO;const n=!(r.range&&r.range instanceof ReadOnlyProperty),l=r.range instanceof ReadOnlyProperty?r.range:new Property(r.range,r.rangePropertyOptions);r.validators.push(VALID_NON_NAN),r.numberType==="Integer"&&r.validators.push(VALID_INTEGER);let h=!1;r.validators.push({isValidValue:A=>l.value.contains(A),validationMessage:()=>`Number value ${h?this.value:t} must be within rangeProperty value: ${l.value}`}),super(t,r),h=!0,this.numberType=r.numberType,this.rangeProperty=l,assert&&Tandem.VALIDATION&&this.rangeProperty.isPhetioInstrumented()&&assert&&assert(this.isPhetioInstrumented(),"NumberProperty must be phet-io instrumented if the range is");const g=()=>{validate(this.value,this.valueValidator,VALIDATE_OPTIONS_FALSE)};if(assert&&this.rangeProperty.link(g),this.rangeProperty.addPhetioStateDependencies([this]),this.addPhetioStateDependencies([this.rangeProperty]),r.validValues&&this.validateNumberAndRangeProperty)for(let A=0;A<r.validValues.length;A++){const S=r.validValues[A];this.validateNumberAndRangeProperty(S)}this.disposeNumberProperty=()=>{n?this.rangeProperty.dispose():assert&&this.rangeProperty.unlink(g)},this.resetNumberProperty=()=>{n&&this.rangeProperty.reset()}}get range(){return this.rangeProperty.value}set range(t){this.rangeProperty.value=t}reset(){this.resetValueAndRange(),super.reset()}dispose(){this.disposeNumberProperty(),super.dispose()}setValueAndRange(t,s){assert&&assert(s.contains(t),`value ${t} is not in range [${s.min},${s.max}]`),this.setDeferred(!0),this.rangeProperty.setDeferred(!0),this.set(t),this.rangeProperty.set(s);const r=this.setDeferred(!1),o=this.rangeProperty.setDeferred(!1);r&&r(),o&&o()}resetValueAndRange(){this.setValueAndRange(this.initialValue,this.rangeProperty.initialValue)}toStateObject(){const t=PropertyIOImpl.toStateObject(this);t.numberType=this.numberType,t.range=Range.RangeIO.toStateObject(this.rangeProperty.value);const s=this.rangeProperty&&this.rangeProperty.isPhetioInstrumented();return t.rangePhetioID=s?this.rangeProperty.tandem.phetioID:null,t}};Ol.NumberPropertyIO=new IOType("NumberPropertyIO",{valueType:Ol,supertype:PropertyIOImpl,parameterTypes:[NumberIO],documentation:`Extends PropertyIO to add values for the numeric range ( min, max ) and numberType ( '${VALID_NUMBER_TYPES.join("' | '")}' )`,toStateObject:t=>t.toStateObject(),applyState:(t,s)=>{PropertyIOImpl.applyState(t,s)},stateSchema:{numberType:StringIO,range:Range.RangeIO,rangePhetioID:NullableIO(StringIO)}});let NumberProperty=Ol;axon.register("NumberProperty",NumberProperty);const isSettingPhetioStateProperty=new TinyProperty(!1);tandemNamespace.register("isSettingPhetioStateProperty",isSettingPhetioStateProperty);const createObservableArray=a=>{var d,A,S,O;assertMutuallyExclusiveOptions(a,["length"],["elements"]);const t=optionize()({hasListenerOrderDependencies:!1,length:0,elements:[],elementAddedEmitterOptions:{},elementRemovedEmitterOptions:{},lengthPropertyOptions:{}},a);let s=null;if(t.phetioType)assert&&assert(t.phetioType.typeName.startsWith("ObservableArrayIO")),s={name:"value",phetioType:t.phetioType.parameterTypes[0]};else if(Validation.getValidatorValidationError(t))s=merge({name:"value"},{isValidValue:_.stubTrue});else{const I=_.pick(t,Validation.VALIDATOR_KEYS);s=merge({name:"value"},I)}const r=new Emitter(combineOptions({tandem:(d=t.tandem)==null?void 0:d.createTandem("elementAddedEmitter"),parameters:[s],phetioReadOnly:!0,hasListenerOrderDependencies:t.hasListenerOrderDependencies},t.elementAddedEmitterOptions)),o=new Emitter(combineOptions({tandem:(A=t.tandem)==null?void 0:A.createTandem("elementRemovedEmitter"),parameters:[s],phetioReadOnly:!0,hasListenerOrderDependencies:t.hasListenerOrderDependencies},t.elementRemovedEmitterOptions)),n=new NumberProperty(0,combineOptions({numberType:"Integer",tandem:(S=t.tandem)==null?void 0:S.createTandem("lengthProperty"),phetioReadOnly:!0,hasListenerOrderDependencies:t.hasListenerOrderDependencies},t.lengthPropertyOptions)),l=[];assert&&r.addListener(()=>{isSettingPhetioStateProperty.value||assert&&assert(n.value===l.length,"lengthProperty out of sync while adding element")}),assert&&o.addListener(()=>{isSettingPhetioStateProperty.value||assert&&assert(n.value===l.length,"lengthProperty out of sync while removing element")});const h=new Proxy(l,{get:function(I,W,L){return assert&&assert(I===l,"array should match the targetArray"),methods.hasOwnProperty(W)?methods[W]:Reflect.get(I,W,L)},set:function(I,W,L){assert&&assert(I===l,"array should match the targetArray");const H=I[W];let Y=null;W==="length"&&(Y=I.slice(L));const Q=Reflect.set(I,W,L),pe=Number(W);return Number.isInteger(pe)&&pe>=0&&H!==L?(n.value=I.length,H!==void 0&&o.emit(I[W]),L!==void 0&&r.emit(L)):W==="length"&&(n.value=L,assert&&assert(Y,"removedElements should be defined for key===length"),Y&&Y.forEach(de=>o.emit(de))),Q},deleteProperty:function(I,W){assert&&assert(I===l,"array should match the targetArray");const L=Number(W);let H;Number.isInteger(L)&&L>=0&&(H=I[W]);const Y=Reflect.deleteProperty(I,W);return H!==void 0&&o.emit(H),Y}});h.targetArray=l,h.elementAddedEmitter=r,h.elementRemovedEmitter=o,h.lengthProperty=n;const g=()=>{t.length>=0&&(h.length=t.length),t.elements.length>0&&Array.prototype.push.apply(h,t.elements)};return g(),h.reset=()=>{h.length=0,g()},(O=t.tandem)!=null&&O.supplied&&(assert&&assert(t.phetioType),h.phetioElementType=t.phetioType.parameterTypes[0],h._observableArrayPhetioObject=new ObservableArrayPhetioObject(h,t)),h};class ObservableArrayPhetioObject extends PhetioObject{constructor(t,s){super(s),this.observableArray=t}}const methods={pop(...a){const t=this,s=t.targetArray.length,r=Array.prototype.pop.apply(t.targetArray,a);return t.lengthProperty.value=t.length,s>0&&t.elementRemovedEmitter.emit(r),r},shift(...a){const t=this,s=t.targetArray.length,r=Array.prototype.shift.apply(t.targetArray,a);return t.lengthProperty.value=t.length,s>0&&t.elementRemovedEmitter.emit(r),r},push(...a){const t=this,s=Array.prototype.push.apply(t.targetArray,a);t.lengthProperty.value=t.length;for(let r=0;r<arguments.length;r++)t.elementAddedEmitter.emit(a[r]);return s},unshift(...a){const t=this,s=Array.prototype.unshift.apply(t.targetArray,a);t.lengthProperty.value=t.length;for(let r=0;r<a.length;r++)t.elementAddedEmitter.emit(a[r]);return s},splice(...a){const t=this,s=Array.prototype.splice.apply(t.targetArray,a);t.lengthProperty.value=t.length;const r=s;for(let o=2;o<a.length;o++)t.elementAddedEmitter.emit(a[o]);return r.forEach(o=>t.elementRemovedEmitter.emit(o)),s},copyWithin(...a){const t=this,s=t.targetArray.slice(),r=Array.prototype.copyWithin.apply(t.targetArray,a);return reportDifference(s,t),r},fill(...a){const t=this,s=t.targetArray.slice(),r=Array.prototype.fill.apply(t.targetArray,a);return reportDifference(s,t),r},get:function(a){return this[a]},addItemAddedListener:function(a){this.elementAddedEmitter.addListener(a)},removeItemAddedListener:function(a){this.elementAddedEmitter.removeListener(a)},addItemRemovedListener:function(a){this.elementRemovedEmitter.addListener(a)},removeItemRemovedListener:function(a){this.elementRemovedEmitter.removeListener(a)},add:function(a){this.push(a)},addAll:function(a){this.push(...a)},remove:function(a){arrayRemove(this,a)},removeAll:function(a){a.forEach(t=>arrayRemove(this,t))},clear:function(){for(;this.length>0;)this.pop()},count:function(a){let t=0;for(let s=0;s<this.length;s++)a(this[s])&&t++;return t},find:function(a,t){return assert&&t!==void 0&&assert(typeof t=="number","fromIndex must be numeric, if provided"),assert&&typeof t=="number"&&assert(t>=0&&t<this.length,`fromIndex out of bounds: ${t}`),_.find(this,a,t)},shuffle:function(a){assert&&assert(a,"random must be supplied");const t=a.shuffle(this);this.targetArray.length=0,Array.prototype.push.apply(this.targetArray,t)},getArrayCopy:function(){return this.slice()},dispose:function(){const a=this;a.elementAddedEmitter.dispose(),a.elementRemovedEmitter.dispose(),a.lengthProperty.dispose(),a._observableArrayPhetioObject&&a._observableArrayPhetioObject.dispose()},toStateObject:function(){return{array:this.map(a=>this.phetioElementType.toStateObject(a))}},applyState:function(a){this.length=0;const t=a.array.map(s=>this.phetioElementType.fromStateObject(s));this.push(...t)}},reportDifference=(a,t)=>{const s=a,r=t.targetArray.slice();for(let o=0;o<s.length;o++){const n=s[o],l=r.indexOf(n);l>=0&&(s.splice(o,1),r.splice(l,1),o--)}s.forEach(o=>t.elementRemovedEmitter.emit(o)),r.forEach(o=>t.elementAddedEmitter.emit(o))},cache$5=new IOTypeCache,ObservableArrayIO=a=>(cache$5.has(a)||cache$5.set(a,new IOType(`ObservableArrayIO<${a.typeName}>`,{valueType:ObservableArrayPhetioObject,parameterTypes:[a],toStateObject:t=>t.observableArray.toStateObject(),applyState:(t,s)=>t.observableArray.applyState(s),stateSchema:{array:ArrayIO(a)}})),cache$5.get(a));createObservableArray.ObservableArrayIO=ObservableArrayIO;axon.register("createObservableArray",createObservableArray);const DERIVED_PROPERTY_IO_PREFIX="DerivedPropertyIO",strictAxonDependenciesGlobal=_.hasIn(window,"phet.chipper.queryParameters")&&phet.chipper.queryParameters.strictAxonDependencies;function getDerivedValue(a,t,s){assert&&strictAxonDependenciesGlobal&&a&&derivationStack.push(s);try{return t(...s.map(r=>r.get()))}finally{assert&&strictAxonDependenciesGlobal&&a&&derivationStack.pop()}}class DerivedProperty extends ReadOnlyProperty{constructor(t,s,r){const o=optionize()({phetioReadOnly:!0,phetioOuterType:DerivedProperty.DerivedPropertyIO,phetioLinkDependencies:!0,strictAxonDependencies:!0},r);assert&&assert(t.every(_.identity),"dependencies should all be truthy"),assert&&assert(t.length===_.uniq(t).length,"duplicate dependencies");const n=getDerivedValue(o.strictAxonDependencies,s,t);super(n,o),Tandem.VALIDATION&&this.isPhetioInstrumented()&&assert&&assert(this.phetioType.typeName.startsWith("DerivedPropertyIO"),"phetioType should be DerivedPropertyIO"),this.dependencies=t,this.derivation=s,this.strictAxonDependencies=o.strictAxonDependencies,this.derivedPropertyListener=this.getDerivedPropertyListener.bind(this),t.forEach(l=>{if(l.lazyLink(this.derivedPropertyListener),Tandem.PHET_IO_ENABLED&&this.isPhetioInstrumented()&&l instanceof PhetioObject&&l.isPhetioInstrumented()&&(l instanceof ReadOnlyProperty&&propertyStateHandlerSingleton.registerPhetioOrderDependency(l,PropertyStatePhase.UNDEFER,this,PropertyStatePhase.UNDEFER),o.tandem&&o.phetioLinkDependencies)){const h=o.tandem.createTandem("dependencies");this.addLinkedElement(l,{tandem:h.createTandemFromPhetioID(l.tandem.phetioID)})}})}hasDependency(t){return this.definedDependencies.includes(t)}get definedDependencies(){return assert&&assert(this.dependencies!==null,"Dependencies should be defined, has this Property been disposed?"),this.dependencies}getDerivedPropertyListener(){this.isDisposed||(this.isDeferred?this.hasDeferredValue=!0:super.set(getDerivedValue(this.strictAxonDependencies,this.derivation,this.definedDependencies)))}recomputeDerivation(){this.getDerivedPropertyListener()}dispose(){const t=this.definedDependencies;for(let s=0;s<t.length;s++){const r=t[s];r.hasListener(this.derivedPropertyListener)&&r.unlink(this.derivedPropertyListener)}this.dependencies=null,super.dispose()}setDeferred(t){return this.isDeferred&&!t&&(this.deferredValue=getDerivedValue(this.strictAxonDependencies,this.derivation,this.definedDependencies)),super.setDeferred(t)}static valueEquals(t,s,r){return new DerivedProperty([t,s],(o,n)=>o===n,r)}static valueEqualsConstant(t,s,r){return new DerivedProperty([t],o=>o===s,r)}static and(t,s){return assert&&assert(t.length>0,"must provide a dependency"),DerivedProperty.deriveAny(t,()=>_.reduce(t,andFunction,!0),s)}static or(t,s){return assert&&assert(t.length>0,"must provide a dependency"),DerivedProperty.deriveAny(t,()=>_.reduce(t,orFunction,!1),s)}static not(t,s){return new DerivedProperty([t],r=>!r,s)}static deriveAny(t,s,r){return new DerivedProperty(t,s,r)}}const andFunction=(a,t)=>a&&t.value,orFunction=(a,t)=>(assert&&assert(typeof t.value=="boolean","boolean value required"),a||t.value),cache$4=new IOTypeCache;DerivedProperty.DerivedPropertyIO=a=>(assert&&assert(a,"DerivedPropertyIO needs parameterType"),cache$4.has(a)||cache$4.set(a,new IOType(`${DERIVED_PROPERTY_IO_PREFIX}<${a.typeName}>`,{valueType:DerivedProperty,parameterTypes:[a],supertype:Property.PropertyIO(a),documentation:"Like PropertyIO, but not settable.  Instead it is derived from other DerivedPropertyIO or PropertyIO instances",applyState:_.noop,methods:{setValue:{returnType:VoidIO,parameterTypes:[a],implementation:DerivedProperty.prototype.set,documentation:"Errors out when you try to set a derived property.",invocableForReadOnlyElements:!1}}})),cache$4.get(a));class DerivedProperty1 extends DerivedProperty{}class DerivedProperty2 extends DerivedProperty{}class DerivedProperty4 extends DerivedProperty{}class DerivedProperty5 extends DerivedProperty{}axon.register("DerivedProperty",DerivedProperty);class DerivedStringProperty extends DerivedProperty{constructor(t,s,r){const o=optionize()({phetioFeatured:!0,phetioValueType:StringIO,tandemNameSuffix:"StringProperty"},r);super(t,s,o)}}axon.register("DerivedStringProperty",DerivedStringProperty);class DynamicProperty extends ReadOnlyProperty{constructor(t,s){const r=optionize()({bidirectional:!1,defaultValue:null,derive:_.identity,map:_.identity,inverseMap:_.identity},s),o=r.derive,n=r.map,l=r.inverseMap,h=typeof o=="function"?o:S=>S[o],g=typeof n=="function"?n:S=>S[n],d=typeof l=="function"?l:S=>S[l],A=t.value===null?g(r.defaultValue):g(h(t.value).value);super(A,r),this.lastPropertyPropertyValue=null,this.defaultValue=r.defaultValue,this.derive=h,this.map=g,this.inverseMap=d,this.bidirectional=r.bidirectional,this.valuePropertyProperty=t,this.isExternallyChanging=!1,this.propertyPropertyListener=this.onPropertyPropertyChange.bind(this),this.propertyListener=this.onPropertyChange.bind(this),t.link(this.propertyListener),r.bidirectional&&this.lazyLink(this.onSelfChange.bind(this))}onPropertyPropertyChange(t,s,r){this.bidirectional&&this.valuePropertyProperty.value!==null&&r&&this.derive(this.valuePropertyProperty.value)===r&&r.areValuesEqual(this.inverseMap(this.value),r.get())||super.set(this.map(t))}onPropertyChange(t,s){this.lastPropertyPropertyValue&&(this.derive(this.lastPropertyPropertyValue).unlink(this.propertyPropertyListener),this.lastPropertyPropertyValue=null),t?(this.derive(t).link(this.propertyPropertyListener),this.lastPropertyPropertyValue=t):this.onPropertyPropertyChange(this.defaultValue,null,null)}onSelfChange(t){if(assert&&assert(this.bidirectional),this.valuePropertyProperty.value!==null){const s=this.derive(this.valuePropertyProperty.value);this.areValuesEqual(t,this.map(s.value))||(s.value=this.inverseMap(t))}}dispose(){this.valuePropertyProperty.unlink(this.propertyListener),this.lastPropertyPropertyValue&&(this.derive(this.lastPropertyPropertyValue).unlink(this.propertyPropertyListener),this.lastPropertyPropertyValue=null),super.dispose()}reset(){assert&&assert(this.bidirectional,"Cannot reset a non-bidirectional DynamicProperty"),this.valuePropertyProperty.value!==null&&this.derive(this.valuePropertyProperty.value).reset()}set(t){assert&&assert(this.bidirectional,`Cannot set values directly to a non-bidirectional DynamicProperty, tried to set: ${t}`),this.isExternallyChanging=!0,super.set(t),this.isExternallyChanging=!1}get value(){return super.value}set value(t){this.set(t)}isSettable(){return super.isSettable()||this.bidirectional}}axon.register("DynamicProperty",DynamicProperty);const TANDEM_NAME="enabledProperty";class EnabledProperty extends BooleanProperty{constructor(t,s){const r=optionize()({phetioDocumentation:"Determines whether the element is enabled (true) or disabled (false).",phetioFeatured:!0,checkTandemName:!0},s);assert&&r&&r.tandem&&r.tandem.supplied&&r.checkTandemName&&assert&&assert(r.tandem.name===TANDEM_NAME,`EnabledProperty tandems should be named ${TANDEM_NAME}`),super(t,r)}static get TANDEM_NAME(){return TANDEM_NAME}}axon.register("EnabledProperty",EnabledProperty);const DEFAULT_OPTIONS$9={enabledProperty:null,enabled:!0,enabledPropertyOptions:null,phetioEnabledPropertyInstrumented:!0,tandem:PhetioObject.DEFAULT_OPTIONS.tandem};class EnabledComponent extends Disposable{constructor(t){const s=optionize3()({},DEFAULT_OPTIONS$9,t),r=!s.enabledProperty;assert&&s.enabledPropertyOptions&&assert(!(!s.phetioEnabledPropertyInstrumented&&s.enabledPropertyOptions.tandem),"incompatible options. Cannot specify phetioEnabledPropertyInstrumented opt out and a Tandem via enabledPropertyOptions."),super(s),this.enabledProperty=s.enabledProperty||new EnabledProperty(s.enabled,merge({tandem:s.phetioEnabledPropertyInstrumented?s.tandem.createTandem(EnabledProperty.TANDEM_NAME):Tandem.OPT_OUT},s.enabledPropertyOptions)),this.disposeEnabledComponent=()=>{r&&this.enabledProperty.dispose()}}setEnabled(t){assert&&assert(this.enabledProperty.isSettable(),"cannot set enabledProperty"),this.enabledProperty.value=t}set enabled(t){this.setEnabled(t)}get enabled(){return this.isEnabled()}isEnabled(){return this.enabledProperty.value}dispose(){this.disposeEnabledComponent(),super.dispose()}}axon.register("EnabledComponent",EnabledComponent);class EnumerationDeprecatedProperty extends Property{constructor(t,s,r){deprecationWarning("Use EnumerationProperty. EnumerationDeprecated should be exchanged for classes that extend EnumerationValue, see WilderEnumerationPatterns for examples."),assert&&assert(t instanceof EnumerationDeprecated,"likely you are using the new and improved Enumeration, better use EnumerationProperty too."),assert&&assert(t.VALUES.includes(s),`invalid initialValue: ${s}`),r&&(assert&&assert(!r.hasOwnProperty("isValidValue"),"EnumerationDeprecatedProperty does not support isValidValue"),assert&&assert(!r.hasOwnProperty("valueType"),"EnumerationDeprecatedProperty sets valueType"),assert&&assert(!r.hasOwnProperty("phetioType"),"EnumerationDeprecatedProperty sets phetioType")),r=merge({valueType:t,phetioValueType:EnumerationIO(t),validValues:t.VALUES},r),super(s,r),this.enumeration=t}}axon.register("EnumerationDeprecatedProperty",EnumerationDeprecatedProperty);class EnumerationProperty extends Property{constructor(t,s){const r=optionize()({enumeration:t.enumeration},s),o=optionize()({validValues:r.enumeration.values,phetioValueType:EnumerationIO({enumeration:r.enumeration})},r);super(t,o)}}axon.register("EnumerationProperty",EnumerationProperty);class MappedProperty extends DynamicProperty{constructor(t,s){super(new TinyProperty(t),s)}}axon.register("MappedProperty",MappedProperty);class Multilink{constructor(t,s,r){if(this.dependencies=t,assert&&assert(t.every(_.identity),"dependencies should all be truthy"),assert&&assert(t.length===_.uniq(t).length,"duplicate dependencies"),this.dependencyListeners=new Map,t.forEach(o=>{const n=()=>{if(!this.isDisposed){const l=t.map(h=>h.get());s(...l)}};this.dependencyListeners.set(o,n),o.lazyLink(n,{phetioDependencies:_.without(t,o)})}),!r){const o=t.map(n=>n.get());s(...o)}this.isDisposed=!1}get definedDependencies(){return assert&&assert(this.dependencies!==null,"Dependencies should be defined, has this Property been disposed?"),this.dependencies}dispose(){assert&&assert(this.dependencies,"A Multilink cannot be disposed twice.");const t=this.definedDependencies;for(let s=0;s<t.length;s++){const r=t[s],o=this.dependencyListeners.get(r);assert&&assert(o,"The listener should exist"),r.hasListener(o)&&r.unlink(o)}this.dependencies=null,this.dependencyListeners.clear(),this.isDisposed=!0}static multilink(t,s){return new Multilink(t,s,!1)}static multilinkAny(t,s){return new Multilink(t,s)}static lazyMultilink(t,s){return new Multilink(t,s,!0)}static lazyMultilinkAny(t,s){return new Multilink(t,s,!0)}static unmultilink(t){t.dispose()}}axon.register("Multilink",Multilink);const ObservableArrayDef={isObservableArray(a){return!!(Array.isArray(a)&&a.elementAddedEmitter&&a.elementRemovedEmitter&&a.lengthProperty)}};axon.register("ObservableArrayDef",ObservableArrayDef);function isTReadOnlyProperty(a){return a instanceof ReadOnlyProperty||a instanceof TinyProperty}const stringify=a=>`${a}`;class PatternStringProperty extends DerivedStringProperty{constructor(t,s,r){assert&&assert(!(s.tandem instanceof Tandem),"Did you intend to put tandem in providedOptions?");const o=optionize()({formatNames:[],decimalPlaces:null,phetioFeatured:!0,tandemNameSuffix:"StringProperty"},r),n=[t],l={},h=Object.keys(s);h.forEach(g=>{const d=s[g];isTReadOnlyProperty(d)&&n.push(d);let A=stringify;if(o.decimalPlaces!==null&&(typeof o.decimalPlaces=="number"||o.decimalPlaces[g]!==null)){const S=typeof o.decimalPlaces=="number"||o.decimalPlaces===null?o.decimalPlaces:o.decimalPlaces[g];assert&&assert(S!==null),A=O=>stringify(typeof O=="number"?DotUtils.toFixed(O,S):O)}o.maps&&o.maps.hasOwnProperty(g)?l[g]=S=>A(o.maps[g](S)):l[g]=A}),super(n,(...g)=>{const d=O=>{const I=n.indexOf(O);return I>=0?g[I]:O};let A=`${d(t)}`;o.formatNames.forEach((O,I)=>{A=A.replace(new RegExp(`\\{${I}\\}`,"g"),`{{${O}}}`)});const S=A.match(/\{\{[^{}]+\}\}/g)||[];for(let O=0;O<S.length;O++){const I=S[O],W=I.replace("{{","").replace("}}","");if(h.includes(W)){let L=d(s[W]);l[W]&&(L=l[W](L)),A=A.replace(I,`${L}`)}}return A},o)}}axon.register("PatternStringProperty",PatternStringProperty);class StringProperty extends Property{constructor(t,s){s&&(assert&&assert(!s.hasOwnProperty("valueType"),"StringProperty sets valueType"),assert&&assert(!s.hasOwnProperty("phetioType"),"StringProperty sets phetioType"));const r=optionize()({valueType:"string",phetioValueType:StringIO},s);super(t,r)}}axon.register("StringProperty",StringProperty);const cache$3=new IOTypeCache,StringUnionIO=a=>{if(assert&&assert(a,"StringUnionIO needs unionValues"),!cache$3.has(a)){const t=a.join(",");cache$3.set(a,new IOType(`StringUnionIO<${t}>`,{documentation:"A PhET-iO Type validating on specific string values.",isValidValue:s=>a.includes(s),toStateObject:_.identity,fromStateObject:_.identity,stateSchema:StateSchema.asValue(`StringUnionIO<${t}>`,{isValidValue:s=>a.includes(s)})}))}return cache$3.get(a)};tandemNamespace.register("StringUnionIO",StringUnionIO);class StringUnionProperty extends Property{constructor(t,s){const r=optionize()({phetioValueType:StringUnionIO(s.validValues)},s);super(t,r)}}axon.register("StringUnionProperty",StringUnionProperty);class TinyForwardingProperty extends TinyProperty{constructor(t,s,r){super(t,r),s&&(this.targetPropertyInstrumented=s),assert&&(this.phetioInitialized=!1)}setValueOrTargetProperty(t,s,r){if(isTReadOnlyProperty(r))this.setTargetProperty(r,t,s);else{const o=this.get();this.clearTargetProperty(),assert&&assert(!this.targetProperty,"just cleared"),this.setPropertyValue(r),this.areValuesEqual(o,r)||this.notifyListeners(o)}}setTargetProperty(t,s=null,r=null){if(assert&&s&&r===null&&this.targetPropertyInstrumented&&assert(!s.isPhetioInstrumented(),"tandemName must be provided for instrumented Nodes"),this.targetProperty===t)return s;const o=this.targetProperty&&this.targetProperty instanceof ReadOnlyProperty&&this.targetProperty.isPhetioInstrumented();assert&&o&&assert(t&&t instanceof ReadOnlyProperty&&t.isPhetioInstrumented(),"Cannot set swap out a PhET-iO instrumented targetProperty for an uninstrumented one");const n=this.targetProperty;this.ownedPhetioProperty&&t!==this.ownedPhetioProperty&&this.disposeOwnedPhetioProperty(),s&&r!==null&&s.updateLinkedElementForProperty(r,n,t);const l=this.get();return this.clearTargetProperty(),this.targetProperty=t,this.targetProperty?(assert&&assert(this.forwardingListener,"forwardingListener is not set yet"),this.targetProperty.lazyLink(this.forwardingListener),this.setPropertyValue(this.targetProperty.value)):this.setPropertyValue(l),this.areValuesEqual(l,this.get())||this.notifyListeners(l),s}clearTargetProperty(){this.forwardingListener=this.forwardingListener||this.onTargetPropertyChange.bind(this),this.targetProperty&&this.targetProperty.unlink(this.forwardingListener),this.targetProperty=null}onTargetPropertyChange(t){super.set(t)}set(t){return this.targetProperty?(assert&&assert(this.targetProperty.isSettable(),"targetProperty must be settable"),this.targetProperty.set(t)):super.set(t),this}setTargetPropertyInstrumented(t,s){return assert&&assert(!s.isPhetioInstrumented(),"this option only works if it is passed in before this Node is instrumented"),this.targetPropertyInstrumented=t,s}getTargetPropertyInstrumented(){return this.targetPropertyInstrumented||!1}initializePhetio(t,s,r){assert&&assert(!this.phetioInitialized,"already initialized"),assert&&assert(!this.ownedPhetioProperty,"Already created the ownedPhetioProperty"),!this.targetProperty&&this.targetPropertyInstrumented?(this.ownedPhetioProperty=r(),assert&&assert(this.ownedPhetioProperty instanceof Property,"The owned property should be an AXON/Property"),assert&&assert(this.ownedPhetioProperty instanceof ReadOnlyProperty&&this.ownedPhetioProperty.isPhetioInstrumented(),"The owned property should be PhET-iO instrumented"),this.setTargetProperty(this.ownedPhetioProperty,t,s)):this.targetProperty&&this.targetProperty instanceof ReadOnlyProperty&&this.targetProperty.isPhetioInstrumented()&&t.updateLinkedElementForProperty(s,null,this.targetProperty),assert&&(this.phetioInitialized=!0)}getTargetProperty(){return this.targetProperty||null}disposeOwnedPhetioProperty(){this.ownedPhetioProperty&&(this.ownedPhetioProperty.dispose(),delete this.ownedPhetioProperty)}dispose(){this.clearTargetProperty(),this.disposeOwnedPhetioProperty(),super.dispose()}}axon.register("TinyForwardingProperty",TinyForwardingProperty);class TinyOverrideProperty extends TinyProperty{constructor(t){super(t.value),this.isOverridden=!1,this._targetProperty=t,assert&&assert(!this.isOverridden,"Should not be overridden on startup"),this._targetListener=this.onTargetPropertyChange.bind(this),this._targetProperty.lazyLink(this._targetListener)}set targetProperty(t){this.setTargetProperty(t)}setTargetProperty(t){if(this.targetProperty===t)return;const s=this.value;this.isOverridden||this._targetProperty.unlink(this._targetListener),this._targetProperty=t,this.isOverridden||(this._targetProperty.lazyLink(this._targetListener),this.equalsValue(s)||this.notifyListeners(s))}clearOverride(){if(this.isOverridden){const t=this.value;this.isOverridden=!1,this._targetProperty.lazyLink(this._targetListener),this.equalsValue(t)||this.notifyListeners(t)}}get(){return this.isOverridden?this._value:this._targetProperty.value}set(t){this.isOverridden||(this._value=this._targetProperty.value),super.set(t)}setPropertyValue(t){this.isOverridden||(this.isOverridden=!0,this._targetProperty.unlink(this._targetListener)),super.setPropertyValue(t)}equalsValue(t){return this.areValuesEqual(t,this.value)}onTargetPropertyChange(t,s){this.isOverridden||this.notifyListeners(s)}notifyListeners(t){this.emit(this.value,t,this)}dispose(){this.isOverridden||this._targetProperty.unlink(this._targetListener),super.dispose()}}axon.register("TinyOverrideProperty",TinyOverrideProperty);class TinyStaticProperty extends TinyProperty{constructor(t,s){super(t),this.onAccessAttempt=s}get(){return this.onAccessAttempt(),super.get()}set(t){throw new Error("Cannot set a TinyStaticProperty value")}isSettable(){return!1}notifyListeners(t){this.emit(this.get(),t,this)}link(t){this.addListener(t),t(this.get(),null,this)}equalsValue(t){return this.areValuesEqual(t,this.get())}}axon.register("TinyStaticProperty",TinyStaticProperty);function isTRangedProperty(a){return(a instanceof ReadOnlyProperty||a instanceof TinyProperty)&&a.isSettable()&&!!a.range&&!!a.rangeProperty}class UnitConversionProperty extends MappedProperty{constructor(t,s){const r=l=>l*s.factor,o=l=>l/s.factor,n=optionize()({bidirectional:!0,map:r,inverseMap:o},s);super(t,n),this._property=t,this.rangeProperty=new Property(DEFAULT_RANGE),isTRangedProperty(t)&&(this._rangeListener=l=>{const h=r(l.min),g=r(l.max);this.rangeProperty.value=new Range(Math.min(h,g),Math.max(h,g))},t.rangeProperty.link(this._rangeListener))}get range(){return this.rangeProperty.value}set range(t){this.rangeProperty.value=t}dispose(){isTRangedProperty(this._property)&&this._property.rangeProperty.unlink(this._rangeListener),this.rangeProperty.dispose()}}axon.register("UnitConversionProperty",UnitConversionProperty);class VarianceNumberProperty extends NumberProperty{constructor(t,s,r){super(t,r),this.computeVariance=s}getRandomizedValue(){return this.computeVariance?this.computeVariance(super.get()):this.get()}}axon.register("VarianceNumberProperty",VarianceNumberProperty);window.sceneryLog=null;const scratchCanvas$1=document.createElement("canvas"),scratchContext$1=scratchCanvas$1.getContext("2d");let logPadding="";const scenery=new Namespace("scenery");scenery.register("scratchCanvas",scratchCanvas$1);scenery.register("scratchContext",scratchContext$1);function stringLogFunction(a){scenery.logString+=`${a.replace(/%c/g,"")}
`}function consoleLogFunction(...a){window.console&&window.console.log&&window.console.log(...Array.prototype.slice.call(a,0))}const logProperties={dirty:{name:"dirty",style:"color: #888;"},bounds:{name:"bounds",style:"color: #888;"},hitTest:{name:"hitTest",style:"color: #888;"},hitTestInternal:{name:"hitTestInternal",style:"color: #888;"},PerfCritical:{name:"Perf",style:"color: #f00;"},PerfMajor:{name:"Perf",style:"color: #aa0;"},PerfMinor:{name:"Perf",style:"color: #088;"},PerfVerbose:{name:"Perf",style:"color: #888;"},Cursor:{name:"Cursor",style:""},Stitch:{name:"Stitch",style:""},StitchDrawables:{name:"Stitch",style:""},GreedyStitcher:{name:"Greedy",style:"color: #088;"},GreedyVerbose:{name:"Greedy",style:"color: #888;"},RelativeTransform:{name:"RelativeTransform",style:"color: #606;"},BackboneDrawable:{name:"Backbone",style:"color: #a00;"},CanvasBlock:{name:"Canvas",style:""},WebGLBlock:{name:"WebGL",style:""},Display:{name:"Display",style:""},DOMBlock:{name:"DOM",style:""},Drawable:{name:"",style:""},FittedBlock:{name:"FittedBlock",style:""},Instance:{name:"Instance",style:""},InstanceTree:{name:"InstanceTree",style:""},ChangeInterval:{name:"ChangeInterval",style:"color: #0a0;"},SVGBlock:{name:"SVG",style:""},SVGGroup:{name:"SVGGroup",style:""},ImageSVGDrawable:{name:"ImageSVGDrawable",style:""},Paints:{name:"Paints",style:""},Filters:{name:"Filters",style:""},AlignBox:{name:"AlignBox",style:""},AlignGroup:{name:"AlignGroup",style:""},RichText:{name:"RichText",style:""},Sim:{name:"Sim",style:""},ParallelDOM:{name:"ParallelDOM",style:""},PDOMInstance:{name:"PDOMInstance",style:""},PDOMTree:{name:"PDOMTree",style:""},PDOMDisplaysInfo:{name:"PDOMDisplaysInfo",style:""},KeyboardFuzzer:{name:"KeyboardFuzzer",style:""},InputListener:{name:"InputListener",style:""},InputEvent:{name:"InputEvent",style:""},OnInput:{name:"OnInput",style:""},Pointer:{name:"Pointer",style:""},Input:{name:"Input",style:""},EventDispatch:{name:"EventDispatch",style:""},EventPath:{name:"EventPath",style:""}};extend(scenery,{logString:"",logFunction:function(...a){window.console&&window.console.log&&window.console.log(...Array.prototype.slice.call(a,0))},switchLogToConsole:function(){scenery.logFunction=consoleLogFunction},switchLogToString:function(){window.console&&window.console.log("switching to string log"),scenery.logFunction=stringLogFunction},enableIndividualLog:function(a){if(a==="stitch"){this.enableIndividualLog("Stitch"),this.enableIndividualLog("StitchDrawables"),this.enableIndividualLog("GreedyStitcher"),this.enableIndividualLog("GreedyVerbose");return}if(a==="perf"){this.enableIndividualLog("PerfCritical"),this.enableIndividualLog("PerfMajor"),this.enableIndividualLog("PerfMinor"),this.enableIndividualLog("PerfVerbose");return}if(a==="input"){this.enableIndividualLog("InputListener"),this.enableIndividualLog("InputEvent"),this.enableIndividualLog("OnInput"),this.enableIndividualLog("Pointer"),this.enableIndividualLog("Input"),this.enableIndividualLog("EventDispatch"),this.enableIndividualLog("EventPath");return}if(a==="a11y"||a==="pdom"){this.enableIndividualLog("ParallelDOM"),this.enableIndividualLog("PDOMInstance"),this.enableIndividualLog("PDOMTree"),this.enableIndividualLog("PDOMDisplaysInfo");return}a&&(assert&&assert(logProperties[a],`Unknown logger: ${a}, please use periods (.) to separate different log names`),window.sceneryLog[a]=window.sceneryLog[a]||function(t,s){const r=logProperties[a],o=r.name?`[${r.name}] `:"";scenery.logFunction(`%c${logPadding}%c${o}${t}`,"color: #ddd;",s||r.style)})},disableIndividualLog:function(a){a&&delete window.sceneryLog[a]},enableLogging:function(a){window.sceneryLog=function(t){scenery.logFunction(t)},window.sceneryLog.push=function(){logPadding+="| "},window.sceneryLog.pop=function(){logPadding=logPadding.slice(0,-2)},window.sceneryLog.getDepth=function(){return logPadding.length/2};for(let t=0;t<a.length;t++)this.enableIndividualLog(a[t])},disableLogging:function(){window.sceneryLog=null},isLoggingPerformance:function(){return window.sceneryLog.PerfCritical||window.sceneryLog.PerfMajor||window.sceneryLog.PerfMinor||window.sceneryLog.PerfVerbose}});const SceneryConstants={DISABLED_OPACITY:.45,DEFAULT_COLOR_PROFILE:"default",PROJECTOR_COLOR_PROFILE:"projector"};scenery.register("SceneryConstants",SceneryConstants);const clamp$1=DotUtils.clamp,linear=DotUtils.linear,rgbNumber="(-?\\d{1,3}%?)",aNumber="(\\d+|\\d*\\.\\d+)",rawNumber="(\\d{1,3})";function parseRGBNumber(a){let t=1;return a.endsWith("%")&&(t=2.55,a=a.slice(0,a.length-1)),DotUtils.roundSymmetric(Number(a)*t)}const as=class as{constructor(t,s,r,o){this.changeEmitter=new TinyEmitter,this.set(t,s,r,o)}copy(){return new as(this.r,this.g,this.b,this.a)}set(t,s,r,o){if(assert&&assert(t!==void 0,"Can't call Color.set( undefined )"),t===null)this.setRGBA(0,0,0,0);else if(typeof t=="string")this.setCSS(t);else if(t instanceof as)this.setRGBA(t.r,t.g,t.b,t.a);else if(r===void 0){assert&&assert(s===void 0||typeof s=="number");const n=t>>16&255,l=t>>8&255,h=t>>0&255,g=s===void 0?1:s;this.setRGBA(n,l,h,g)}else assert&&assert(o===void 0||typeof o=="number"),this.setRGBA(t,s,r,o===void 0?1:o);return this}getRed(){return this.r}get red(){return this.getRed()}set red(t){this.setRed(t)}setRed(t){return this.setRGBA(t,this.g,this.b,this.a)}getGreen(){return this.g}get green(){return this.getGreen()}set green(t){this.setGreen(t)}setGreen(t){return this.setRGBA(this.r,t,this.b,this.a)}getBlue(){return this.b}get blue(){return this.getBlue()}set blue(t){this.setBlue(t)}setBlue(t){return this.setRGBA(this.r,this.g,t,this.a)}getAlpha(){return this.a}get alpha(){return this.getAlpha()}set alpha(t){this.setAlpha(t)}setAlpha(t){return this.setRGBA(this.r,this.g,this.b,t)}setRGBA(t,s,r,o){return this.r=DotUtils.roundSymmetric(clamp$1(t,0,255)),this.g=DotUtils.roundSymmetric(clamp$1(s,0,255)),this.b=DotUtils.roundSymmetric(clamp$1(r,0,255)),this.a=clamp$1(o,0,1),this.updateColor(),this}blend(t,s){const o=Math.pow(this.r,2.4),n=Math.pow(t.r,2.4),l=Math.pow(this.g,2.4),h=Math.pow(t.g,2.4),g=Math.pow(this.b,2.4),d=Math.pow(t.b,2.4),A=Math.pow(o+(n-o)*s,1/2.4),S=Math.pow(l+(h-l)*s,1/2.4),O=Math.pow(g+(d-g)*s,1/2.4),I=this.a+(t.a-this.a)*s;return new as(A,S,O,I)}computeCSS(){if(this.a===1)return`rgb(${this.r},${this.g},${this.b})`;{let t=this.a.toFixed(20);for(;t.length>=2&&t.endsWith("0")&&t[t.length-2]!==".";)t=t.slice(0,t.length-1);const s=this.a===0||this.a===1?this.a:t;return`rgba(${this.r},${this.g},${this.b},${s})`}}toCSS(){return assert&&assert(this._css===this.computeCSS(),`CSS cached value is ${this._css}, but the computed value appears to be ${this.computeCSS()}`),this._css}setCSS(t){let s=!1;const r=as.preprocessCSS(t);for(let o=0;o<as.formatParsers.length;o++){const n=as.formatParsers[o],l=n.regexp.exec(r);if(l){n.apply(this,l),s=!0;break}}if(!s)throw new Error(`Color unable to parse color string: ${t}`);return this.updateColor(),this}toNumber(){return(this.r<<16)+(this.g<<8)+this.b}updateColor(){assert&&assert(!this.immutable,"Cannot modify an immutable color. Likely caused by trying to mutate a color after it was used for a node fill/stroke"),assert&&assert(typeof this.red=="number"&&typeof this.green=="number"&&typeof this.blue=="number"&&typeof this.alpha=="number",`Ensure color components are numeric: ${this.toString()}`),assert&&assert(isFinite(this.red)&&isFinite(this.green)&&isFinite(this.blue)&&isFinite(this.alpha),"Ensure color components are finite and not NaN"),assert&&assert(this.red>=0&&this.red<=255&&this.green>=0&&this.green<=255&&this.red>=0&&this.red<=255&&this.alpha>=0&&this.alpha<=1,`Ensure color components are in the proper ranges: ${this.toString()}`);const t=this._css;this._css=this.computeCSS(),t!==this._css&&this.changeEmitter.emit()}setImmutable(){return assert&&(this.immutable=!0),this}getCanvasStyle(){return this.toCSS()}setHSLA(t,s,r,o){t=t%360/360,s=clamp$1(s/100,0,1),r=clamp$1(r/100,0,1);let n;r<.5?n=r*(s+1):n=r+s-r*s;const l=r*2-n;return this.r=DotUtils.roundSymmetric(as.hueToRGB(l,n,t+1/3)*255),this.g=DotUtils.roundSymmetric(as.hueToRGB(l,n,t)*255),this.b=DotUtils.roundSymmetric(as.hueToRGB(l,n,t-1/3)*255),this.a=clamp$1(o,0,1),this.updateColor(),this}equals(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}withAlpha(t){return new as(this.r,this.g,this.b,t)}checkFactor(t){return assert&&assert(t===void 0||t>=0&&t<=1,`factor must be between 0 and 1: ${t}`),t===void 0?.7:t}brighterColor(t){t=this.checkFactor(t);const s=Math.min(255,Math.floor(this.r/t)),r=Math.min(255,Math.floor(this.g/t)),o=Math.min(255,Math.floor(this.b/t));return new as(s,r,o,this.a)}colorUtilsBrighter(t){t=this.checkFactor(t);const s=Math.min(255,this.getRed()+Math.floor(t*(255-this.getRed()))),r=Math.min(255,this.getGreen()+Math.floor(t*(255-this.getGreen()))),o=Math.min(255,this.getBlue()+Math.floor(t*(255-this.getBlue())));return new as(s,r,o,this.getAlpha())}darkerColor(t){t=this.checkFactor(t);const s=Math.max(0,Math.floor(t*this.r)),r=Math.max(0,Math.floor(t*this.g)),o=Math.max(0,Math.floor(t*this.b));return new as(s,r,o,this.a)}colorUtilsDarker(t){t=this.checkFactor(t);const s=Math.max(0,this.getRed()-Math.floor(t*this.getRed())),r=Math.max(0,this.getGreen()-Math.floor(t*this.getGreen())),o=Math.max(0,this.getBlue()-Math.floor(t*this.getBlue()));return new as(s,r,o,this.getAlpha())}colorUtilsBrightness(t){return t===0?this:t>0?this.colorUtilsBrighter(t):this.colorUtilsDarker(-t)}toString(){return`${this.constructor.name}[r:${this.r} g:${this.g} b:${this.b} a:${this.a}]`}toHexString(){let t=this.toNumber().toString(16);for(;t.length<6;)t=`0${t}`;return`#${t}`}toStateObject(){return{r:this.r,g:this.g,b:this.b,a:this.a}}static hueToRGB(t,s,r){return r<0&&(r=r+1),r>1&&(r=r-1),r*6<1?t+(s-t)*r*6:r*2<1?s:r*3<2?t+(s-t)*(2/3-r)*6:t}static toColor(t){return t===null?as.TRANSPARENT:t instanceof as?t:typeof t=="string"?new as(t):as.toColor(t.value)}static interpolateRGBA(t,s,r){if(r<0||r>1)throw new Error(`distance must be between 0 and 1: ${r}`);const o=Math.floor(linear(0,1,t.r,s.r,r)),n=Math.floor(linear(0,1,t.g,s.g,r)),l=Math.floor(linear(0,1,t.b,s.b,r)),h=linear(0,1,t.a,s.a,r);return new as(o,n,l,h)}static supersampleBlend(t){const r=t.map(O=>Math.pow(O.r/255,2.2)),o=t.map(O=>Math.pow(O.g/255,2.2)),n=t.map(O=>Math.pow(O.b/255,2.2)),l=t.map(O=>Math.pow(O.a,2.2)),h=_.sum(l);if(h===0)return new as(0,0,0,0);const g=_.sum(_.range(0,t.length).map(O=>r[O]*l[O]))/h,d=_.sum(_.range(0,t.length).map(O=>o[O]*l[O]))/h,A=_.sum(_.range(0,t.length).map(O=>n[O]*l[O]))/h,S=h/t.length;return new as(Math.floor(Math.pow(g,1/2.2)*255),Math.floor(Math.pow(d,1/2.2)*255),Math.floor(Math.pow(A,1/2.2)*255),Math.pow(S,1/2.2))}static fromStateObject(t){return new as(t.r,t.g,t.b,t.a)}static hsla(t,s,r,o){return new as(0,0,0,1).setHSLA(t,s,r,o)}static checkPaintString(t){if(assert)try{scratchColor$2.setCSS(t)}catch{assert(!1,`The CSS string is an invalid color: ${t}`)}}static checkPaint(t){typeof t=="string"?as.checkPaintString(t):isTReadOnlyProperty(t)&&typeof t.value=="string"&&as.checkPaintString(t.value)}static getLuminance(t){const s=as.toColor(t),r=s.red*.2126+s.green*.7152+s.blue*.0722;return assert&&assert(r>=0&&r<=255,`unexpected luminance: ${r}`),r}static toGrayscale(t){const s=as.getLuminance(t);return new as(s,s,s)}static isDarkColor(t,s=186){return assert&&assert(s>=0&&s<=255,"invalid luminanceThreshold"),as.getLuminance(t)<s}static isLightColor(t,s){return!as.isDarkColor(t,s)}static grayColor(t,s){return new as(t,t,t,s)}static preprocessCSS(t){let s=t.replace(/ /g,"").toLowerCase();const r=as.colorKeywords[s];return r&&(s=`#${r}`),s}static isCSSColorString(t){const s=as.preprocessCSS(t);for(let r=0;r<as.formatParsers.length;r++)if(as.formatParsers[r].regexp.exec(s))return!0;return!1}};as.formatParsers=[{regexp:/^transparent$/,apply:(t,s)=>{t.setRGBA(0,0,0,0)}},{regexp:/^#(\w{1})(\w{1})(\w{1})$/,apply:(t,s)=>{t.setRGBA(parseInt(s[1]+s[1],16),parseInt(s[2]+s[2],16),parseInt(s[3]+s[3],16),1)}},{regexp:/^#(\w{2})(\w{2})(\w{2})$/,apply:(t,s)=>{t.setRGBA(parseInt(s[1],16),parseInt(s[2],16),parseInt(s[3],16),1)}},{regexp:new RegExp(`^rgb\\(${rgbNumber},${rgbNumber},${rgbNumber}\\)$`),apply:(t,s)=>{t.setRGBA(parseRGBNumber(s[1]),parseRGBNumber(s[2]),parseRGBNumber(s[3]),1)}},{regexp:new RegExp(`^rgba\\(${rgbNumber},${rgbNumber},${rgbNumber},${aNumber}\\)$`),apply:(t,s)=>{t.setRGBA(parseRGBNumber(s[1]),parseRGBNumber(s[2]),parseRGBNumber(s[3]),Number(s[4]))}},{regexp:new RegExp(`^hsl\\(${rawNumber},${rawNumber}%,${rawNumber}%\\)$`),apply:(t,s)=>{t.setHSLA(Number(s[1]),Number(s[2]),Number(s[3]),1)}},{regexp:new RegExp(`^hsla\\(${rawNumber},${rawNumber}%,${rawNumber}%,${aNumber}\\)$`),apply:(t,s)=>{t.setHSLA(Number(s[1]),Number(s[2]),Number(s[3]),Number(s[4]))}}],as.basicColorKeywords={aqua:"00ffff",black:"000000",blue:"0000ff",fuchsia:"ff00ff",gray:"808080",green:"008000",lime:"00ff00",maroon:"800000",navy:"000080",olive:"808000",purple:"800080",red:"ff0000",silver:"c0c0c0",teal:"008080",white:"ffffff",yellow:"ffff00"},as.colorKeywords={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"778899",lightslategrey:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};let Color=as;scenery.register("Color",Color);Color.BLACK=Color.black=new Color(0,0,0).setImmutable();Color.BLUE=Color.blue=new Color(0,0,255).setImmutable();Color.CYAN=Color.cyan=new Color(0,255,255).setImmutable();Color.DARK_GRAY=Color.darkGray=new Color(64,64,64).setImmutable();Color.GRAY=Color.gray=new Color(128,128,128).setImmutable();Color.GREEN=Color.green=new Color(0,255,0).setImmutable();Color.LIGHT_GRAY=Color.lightGray=new Color(192,192,192).setImmutable();Color.MAGENTA=Color.magenta=new Color(255,0,255).setImmutable();Color.ORANGE=Color.orange=new Color(255,200,0).setImmutable();Color.PINK=Color.pink=new Color(255,175,175).setImmutable();Color.RED=Color.red=new Color(255,0,0).setImmutable();Color.WHITE=Color.white=new Color(255,255,255).setImmutable();Color.YELLOW=Color.yellow=new Color(255,255,0).setImmutable();Color.TRANSPARENT=Color.transparent=new Color(0,0,0,0).setImmutable();const scratchColor$2=new Color("blue");Color.ColorIO=new IOType("ColorIO",{valueType:Color,documentation:"A color, with rgba",toStateObject:a=>a.toStateObject(),fromStateObject:a=>new Color(a.r,a.g,a.b,a.a),stateSchema:{r:NumberIO,g:NumberIO,b:NumberIO,a:NumberIO}});const Features={};scenery.register("Features",Features);function supportsDataURLFormatOutput(a){try{const t=document.createElement("canvas");t.width=1,t.height=1;const s=t.getContext("2d");s.fillStyle="black",s.fillRect(0,0,1,1);const r=t.toDataURL([a]),o=`data:${a}`;return r.slice(0,o.length)===o}catch{return!1}}function supportsDataURLFormatOrigin(a,t){const s=document.createElement("canvas");s.width=1,s.height=1;const r=s.getContext("2d"),o=document.createElement("img");o.crossOrigin="Anonymous";const n=()=>{try{r.drawImage(o,0,0),s.toDataURL(),Features[a]=!0}catch{Features[a]=!1}};o.onload=n;try{o.src=t,o.complete&&n()}catch{Features[a]=!1}}Features.canvasPNGOutput=supportsDataURLFormatOutput("image/png");Features.canvasJPEGOutput=supportsDataURLFormatOutput("image/jpeg");Features.canvasGIFOutput=supportsDataURLFormatOutput("image/gif");Features.canvasICONOutput=supportsDataURLFormatOutput("image/x-icon");supportsDataURLFormatOrigin("canvasPNGInput","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQIW2NkYGD4DwABCQEBtxmN7wAAAABJRU5ErkJggg==");supportsDataURLFormatOrigin("canvasJPEGInput","data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAMCAgICAgMCAgIDAwMDBAYEBAQEBAgGBgUGCQgKCgkICQkKDA8MCgsOCwkJDRENDg8QEBEQCgwSExIQEw8QEBD/2wBDAQMDAwQDBAgEBAgQCwkLEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBD/wAARCAABAAEDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD8qqKKKAP/2Q==");supportsDataURLFormatOrigin("canvasSVGInput","data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIj8+DQo8c3ZnIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2aWV3cG9ydD0iMCAwIDEgMSIgd2lkdGg9IjEiIGhlaWdodD0iMSIgPg0KICA8cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMSIgaGVpZ2h0PSIxIiByeD0iMCIgcnk9IjAiIHN0eWxlPSJmaWxsOiBibGFjazsgc3Ryb2tlOiBub25lOyI+PC9yZWN0Pg0KPC9zdmc+DQo=");supportsDataURLFormatOrigin("canvasGIFInput","data:image/gif;base64,R0lGODlhAQABAJEAAAAAAP///////wAAACH5BAEAAAIALAAAAAABAAEAAAICRAEAOw==");const canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");Features.toDataURLHD=detectPrefix(canvas,"toDataURLHD");Features.createImageDataHD=detectPrefix(ctx,"createImageDataHD");Features.getImageDataHD=detectPrefix(ctx,"getImageDataHD");Features.putImageDataHD=detectPrefix(ctx,"putImageDataHD");Features.currentTransform=detectPrefix(ctx,"currentTransform");Features.canvasFilter=detectPrefix(ctx,"filter");const span=document.createElement("span"),div=document.createElement("div");Features.textStroke=detectPrefix(span.style,"textStroke");Features.textStrokeColor=detectPrefix(span.style,"textStrokeColor");Features.textStrokeWidth=detectPrefix(span.style,"textStrokeWidth");Features.transform=detectPrefix(div.style,"transform");Features.transformOrigin=detectPrefix(div.style,"transformOrigin");Features.backfaceVisibility=detectPrefix(div.style,"backfaceVisibility");Features.borderRadius=detectPrefix(div.style,"borderRadius");Features.userSelect=detectPrefix(div.style,"userSelect");Features.touchAction=detectPrefix(div.style,"touchAction");Features.touchCallout=detectPrefix(div.style,"touchCallout");Features.userDrag=detectPrefix(div.style,"userDrag");Features.tapHighlightColor=detectPrefix(div.style,"tapHighlightColor");Features.fontSmoothing=detectPrefix(div.style,"fontSmoothing");Features.requestAnimationFrame=detectPrefix(window,"requestAnimationFrame");Features.cancelAnimationFrame=detectPrefix(window,"cancelAnimationFrame");Features.setStyle=(a,t,s)=>{t!==void 0&&(a.style[t]=s)};Features.passive=!1;window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>{Features.passive=!0}}));const VALID_STYLES=["normal","italic","oblique"],VALID_VARIANTS=["normal","small-caps"],VALID_WEIGHTS=["normal","bold","bolder","lighter","100","200","300","400","500","600","700","800","900"],VALID_STRETCHES=["normal","ultra-condensed","extra-condensed","condensed","semi-condensed","semi-expanded","expanded","extra-expanded","ultra-expanded"],Hr=class Hr extends PhetioObject{constructor(t){assert&&assert(t===void 0||typeof t=="object"&&Object.getPrototypeOf(t)===Object.prototype,"options, if provided, should be a raw object");const s=optionize()({style:"normal",variant:"normal",weight:"normal",stretch:"normal",size:"10px",lineHeight:"normal",family:"sans-serif",phetioType:Hr.FontIO},t);assert&&assert(typeof s.weight=="string"||typeof s.weight=="number","Font weight should be specified as a string or number"),assert&&assert(typeof s.size=="string"||typeof s.size=="number","Font size should be specified as a string or number"),super(s),this._style=s.style,this._variant=s.variant,this._weight=`${s.weight}`,this._stretch=s.stretch,this._size=Hr.castSize(s.size),this._lineHeight=s.lineHeight,this._family=s.family,assert&&assert(typeof this._style=="string"&&_.includes(VALID_STYLES,this._style),'Font style must be one of "normal", "italic", or "oblique"'),assert&&assert(typeof this._variant=="string"&&_.includes(VALID_VARIANTS,this._variant),'Font variant must be "normal" or "small-caps"'),assert&&assert(typeof this._weight=="string"&&_.includes(VALID_WEIGHTS,this._weight),'Font weight must be one of "normal", "bold", "bolder", "lighter", "100", "200", "300", "400", "500", "600", "700", "800", or "900"'),assert&&assert(typeof this._stretch=="string"&&_.includes(VALID_STRETCHES,this._stretch),'Font stretch must be one of "normal", "ultra-condensed", "extra-condensed", "condensed", "semi-condensed", "semi-expanded", "expanded", "extra-expanded", or "ultra-expanded"'),assert&&assert(typeof this._size=="string"&&!_.includes(["0","1","2","3","4","5","6","7","8","9"],this._size[this._size.length-1]),"Font size must be either passed as a number (not a string, interpreted as px), or must contain a suffix for percentage, absolute or relative units, or an explicit size constant"),assert&&assert(typeof this._lineHeight=="string"),assert&&assert(typeof this._family=="string"),this._font=this.computeShorthand()}getFont(){return this._font}get font(){return this.getFont()}getStyle(){return this._style}get style(){return this.getStyle()}getVariant(){return this._variant}get variant(){return this.getVariant()}getWeight(){return this._weight}get weight(){return this.getWeight()}getStretch(){return this._stretch}get stretch(){return this.getStretch()}getSize(){return this._size}get size(){return this.getSize()}getNumericSize(){const t=this._size.match(/^(\d+)px$/);if(t)return Number(t[1]);const s=this._size.match(/^(\d+)pt$/);if(s)return .75*Number(s[1]);const r=this._size.match(/^(\d+)em$/);return r?Number(r[1])/16:12}get numericSize(){return this.getNumericSize()}getLineHeight(){return this._lineHeight}get lineHeight(){return this.getLineHeight()}getFamily(){return this._family}get family(){return this.getFamily()}copy(t){return new Hr(combineOptions({style:this._style,variant:this._variant,weight:this._weight,stretch:this._stretch,size:this._size,lineHeight:this._lineHeight,family:this._family},t))}computeShorthand(){let t="";return this._style!=="normal"&&(t+=`${this._style} `),this._variant!=="normal"&&(t+=`${this._variant} `),this._weight!=="normal"&&(t+=`${this._weight} `),this._stretch!=="normal"&&(t+=`${this._stretch} `),t+=this._size,this._lineHeight!=="normal"&&(t+=`/${this._lineHeight}`),t+=` ${this._family}`,t}toCSS(){return this.getFont()}static castSize(t){return typeof t=="number"?`${t}px`:t}static isFontStyle(t){return VALID_STYLES.includes(t)}static isFontVariant(t){return VALID_VARIANTS.includes(t)}static isFontWeight(t){return VALID_WEIGHTS.includes(t)}static isFontStretch(t){return VALID_STRETCHES.includes(t)}static fromCSS(t){const s={},r=_.filter(t.split(/[\x09\x0A\x0C\x0D\x20]/),o=>o.length>0);for(let o=0;o<r.length;o++){const n=r[o];if(n!=="normal")if(Hr.isFontStyle(n))assert&&assert(s.style===void 0,`Style cannot be applied twice. Already set to "${s.style}", attempt to replace with "${n}"`),s.style=n;else if(Hr.isFontVariant(n))assert&&assert(s.variant===void 0,`Variant cannot be applied twice. Already set to "${s.variant}", attempt to replace with "${n}"`),s.variant=n;else if(Hr.isFontWeight(n))assert&&assert(s.weight===void 0,`Weight cannot be applied twice. Already set to "${s.weight}", attempt to replace with "${n}"`),s.weight=n;else if(Hr.isFontStretch(n))assert&&assert(s.stretch===void 0,`Stretch cannot be applied twice. Already set to "${s.stretch}", attempt to replace with "${n}"`),s.stretch=n;else{const l=n.split(/\//);s.size=l[0],l[1]&&(s.lineHeight=l[1]),s.family=r.slice(o+1).join(" ");break}}return new Hr(s)}};Hr.DEFAULT=new Hr;let Font=Hr;scenery.register("Font",Font);Font.FontIO=new IOType("FontIO",{valueType:Font,documentation:"Font handling for text drawing. Options:<ul><li><strong>style:</strong> normal      &mdash; normal | italic | oblique </li><li><strong>variant:</strong> normal    &mdash; normal | small-caps </li><li><strong>weight:</strong> normal     &mdash; normal | bold | bolder | lighter | 100 | 200 | 300 | 400 | 500 | 600 | 700 | 800 | 900 </li><li><strong>stretch:</strong> normal    &mdash; normal | ultra-condensed | extra-condensed | condensed | semi-condensed | semi-expanded | expanded | extra-expanded | ultra-expanded </li><li><strong>size:</strong> 10px         &mdash; absolute-size | relative-size | length | percentage -- unitless number interpreted as px. absolute suffixes: cm, mm, in, pt, pc, px. relative suffixes: em, ex, ch, rem, vw, vh, vmin, vmax. </li><li><strong>lineHeight:</strong> normal &mdash; normal | number | length | percentage -- NOTE: Canvas spec forces line-height to normal </li><li><strong>family:</strong> sans-serif &mdash; comma-separated list of families, including generic families (serif, sans-serif, cursive, fantasy, monospace). ideally escape with double-quotes</li></ul>",toStateObject:a=>({style:a.getStyle(),variant:a.getVariant(),weight:a.getWeight(),stretch:a.getStretch(),size:a.getSize(),lineHeight:a.getLineHeight(),family:a.getFamily()}),fromStateObject(a){return new Font(a)},stateSchema:{style:StringIO,variant:StringIO,weight:StringIO,stretch:StringIO,size:StringIO,lineHeight:StringIO,family:StringIO}});const Renderer={};scenery.register("Renderer",Renderer);Renderer.numActiveRenderers=4;Renderer.bitsPerRenderer=5;Renderer.bitmaskRendererArea=255;Renderer.bitmaskCurrentRendererArea=15;Renderer.bitmaskLacksOffset=65536;Renderer.bitmaskLacksShift=16;Renderer.bitmaskNodeDefault=Renderer.bitmaskRendererArea;Renderer.bitmaskCanvas=1;Renderer.bitmaskSVG=2;Renderer.bitmaskDOM=4;Renderer.bitmaskWebGL=8;Renderer.bitmaskSingleCanvas=256;Renderer.bitmaskSingleSVG=512;Renderer.bitmaskNotPainted=4096;Renderer.bitmaskBoundsValid=8192;Renderer.bitmaskNoPDOM=16384;Renderer.bitmaskLacksCanvas=Renderer.bitmaskCanvas<<Renderer.bitmaskLacksShift;Renderer.bitmaskLacksSVG=Renderer.bitmaskSVG<<Renderer.bitmaskLacksShift;Renderer.bitmaskLacksDOM=Renderer.bitmaskDOM<<Renderer.bitmaskLacksShift;Renderer.bitmaskLacksWebGL=Renderer.bitmaskWebGL<<Renderer.bitmaskLacksShift;Renderer.isCanvas=function(a){return(a&Renderer.bitmaskCanvas)!==0};Renderer.isSVG=function(a){return(a&Renderer.bitmaskSVG)!==0};Renderer.isDOM=function(a){return(a&Renderer.bitmaskDOM)!==0};Renderer.isWebGL=function(a){return(a&Renderer.bitmaskWebGL)!==0};const rendererMap={canvas:Renderer.bitmaskCanvas,svg:Renderer.bitmaskSVG,dom:Renderer.bitmaskDOM,webgl:Renderer.bitmaskWebGL};Renderer.fromName=function(a){return rendererMap[a]};Renderer.stripBitmask=function(a){return a&Renderer.bitmaskRendererArea};Renderer.createOrderBitmask=function(a,t,s,r){return a=a||0,t=t||0,s=s||0,r=r||0,a|t<<5|s<<10|r<<15};Renderer.bitmaskOrder=function(a,t){return t>0&&(a=a>>5*t),a&Renderer.bitmaskCurrentRendererArea};Renderer.bitmaskOrderFirst=function(a){return a&Renderer.bitmaskCurrentRendererArea};Renderer.bitmaskOrderSecond=function(a){return a>>5&Renderer.bitmaskCurrentRendererArea};Renderer.bitmaskOrderThird=function(a){return a>>10&Renderer.bitmaskCurrentRendererArea};Renderer.bitmaskOrderFourth=function(a){return a>>15&Renderer.bitmaskCurrentRendererArea};Renderer.pushOrderBitmask=function(a,t){assert&&assert(typeof a=="number"),assert&&assert(typeof t=="number");let s=t;const r=Renderer.bitsPerRenderer*Renderer.numActiveRenderers;for(let o=0;o<=r;o+=Renderer.bitsPerRenderer){const n=a>>o&Renderer.bitmaskCurrentRendererArea;if(n===s)return a;if(n===0)return a=a|s<<o,a;if(a=a&~(Renderer.bitmaskCurrentRendererArea<<o),a=a|s<<o,s=n,s===t)return a}throw new Error("pushOrderBitmask overflow")};Renderer.createSelfDrawable=function(a,t,s,r){let o;if(Renderer.isCanvas(s))o=t.createCanvasDrawable(s,a);else if(Renderer.isSVG(s))o=t.createSVGDrawable(s,a);else if(Renderer.isDOM(s))o=t.createDOMDrawable(s,a);else if(Renderer.isWebGL(s))o=t.createWebGLDrawable(s,a);else throw new Error(`Unrecognized renderer: ${s}`);return assert&&_.each(t.drawableMarkFlags,n=>{const l=`markDirty${n[0].toUpperCase()}${n.slice(1)}`;assert(typeof o[l]=="function",`Did not find ${l}`)}),o.setFittable(r),o};Renderer.webglCustom=1;Renderer.webglTexturedTriangles=2;Renderer.webglVertexColorPolygons=3;const svgns="http://www.w3.org/2000/svg";scenery.register("svgns",svgns);const xlinkns="http://www.w3.org/1999/xlink";scenery.register("xlinkns",xlinkns);function p$2(a,t){return new Vector2(a,t)}const transformProperty=Features.transform,transformOriginProperty=Features.transformOrigin||"transformOrigin";let webglEnabled=!0,_extensionlessWebGLSupport;const Utils={prepareForTransform(a){a.style[transformOriginProperty]="top left"},applyPreparedTransform(a,t){t.style[transformProperty]=a.getCSSTransform()},setTransform(a,t){t.style[transformProperty]=a},unsetTransform(a){a.style[transformProperty]=""},polyfillRequestAnimationFrame(){(!window.requestAnimationFrame||!window.cancelAnimationFrame)&&(!Features.requestAnimationFrame||!Features.cancelAnimationFrame?(window.requestAnimationFrame=a=>{const t=Date.now();return window.setTimeout(()=>{a(Date.now()-t)},16)},window.cancelAnimationFrame=clearTimeout):(window.requestAnimationFrame=window[Features.requestAnimationFrame],window.cancelAnimationFrame=window[Features.cancelAnimationFrame]))},backingStorePixelRatio(a){return a.webkitBackingStorePixelRatio||a.mozBackingStorePixelRatio||a.msBackingStorePixelRatio||a.oBackingStorePixelRatio||a.backingStorePixelRatio||1},backingScale(a){if("devicePixelRatio"in window){const t=Utils.backingStorePixelRatio(a);return window.devicePixelRatio/t}return 1},supportsNativeCanvasFilter(){return!!Features.canvasFilter},supportsImageDataCanvasFilter(){return Utils.backingStorePixelRatio(scenery.scratchContext)===1},scanBounds(a,t,s){const r=_.map(_.range(t),()=>!1),o=_.map(_.range(t),()=>!1);for(let A=0;A<t;A++)for(let S=0;S<t;S++){const O=4*(S*t+A);(a.data[O]!==0||a.data[O+1]!==0||a.data[O+2]!==0||a.data[O+3]!==0)&&(r[A]=!0,o[S]=!0)}const n=_.indexOf(r,!0),l=_.lastIndexOf(r,!0),h=_.indexOf(o,!0),g=_.lastIndexOf(o,!0),d=t/16;return{minBounds:new Bounds2(n<1||n>=t-1?Number.POSITIVE_INFINITY:s.inversePosition2(p$2(n+1+d,0)).x,h<1||h>=t-1?Number.POSITIVE_INFINITY:s.inversePosition2(p$2(0,h+1+d)).y,l<1||l>=t-1?Number.NEGATIVE_INFINITY:s.inversePosition2(p$2(l-d,0)).x,g<1||g>=t-1?Number.NEGATIVE_INFINITY:s.inversePosition2(p$2(0,g-d)).y),maxBounds:new Bounds2(n<1||n>=t-1?Number.NEGATIVE_INFINITY:s.inversePosition2(p$2(n-1-d,0)).x,h<1||h>=t-1?Number.NEGATIVE_INFINITY:s.inversePosition2(p$2(0,h-1-d)).y,l<1||l>=t-1?Number.POSITIVE_INFINITY:s.inversePosition2(p$2(l+2+d,0)).x,g<1||g>=t-1?Number.POSITIVE_INFINITY:s.inversePosition2(p$2(0,g+2+d)).y)}},canvasAccurateBounds(a,t){const s=t&&t.precision?t.precision:.001,r=t&&t.resolution?t.resolution:128,o=t&&t.initialScale?t.initialScale:1/16;let n=Bounds2.NOTHING,l=Bounds2.EVERYTHING;const h=document.createElement("canvas");h.width=r,h.height=r;const g=h.getContext("2d");function d(Y){g.save(),Y.matrix.canvasSetTransform(g),a(g),g.restore();const Q=g.getImageData(0,0,r,r),pe=Utils.scanBounds(Q,r,Y);return g.clearRect(0,0,r,r),pe}function A(Y){const pe=(r-4)/(Y.maxX-Y.minX),de=(r-2*2)/(Y.maxY-Y.minY),fe=-pe*Y.minX+2,ye=-de*Y.minY+2;return new Transform3(Matrix3.translation(fe,ye).timesMatrix(Matrix3.scaling(pe,de)))}const S=new Transform3;S.append(Matrix3.translation(r/2,r/2)),S.append(Matrix3.scaling(o));const O=d(S);n=n.union(O.minBounds),l=l.intersection(O.maxBounds);let I,W,L;for(I=l.minY,W=l.maxY;isFinite(n.minX)&&isFinite(l.minX)&&Math.abs(n.minX-l.minX)>s&&(L=d(A(new Bounds2(l.minX,I,n.minX,W))),!(n.minX<=L.minBounds.minX&&l.minX>=L.maxBounds.minX));)n=n.withMinX(Math.min(n.minX,L.minBounds.minX)),l=l.withMinX(Math.max(l.minX,L.maxBounds.minX)),I=Math.max(I,L.maxBounds.minY),W=Math.min(W,L.maxBounds.maxY);for(I=l.minY,W=l.maxY;isFinite(n.maxX)&&isFinite(l.maxX)&&Math.abs(n.maxX-l.maxX)>s&&(L=d(A(new Bounds2(n.maxX,I,l.maxX,W))),!(n.maxX>=L.minBounds.maxX&&l.maxX<=L.maxBounds.maxX));)n=n.withMaxX(Math.max(n.maxX,L.minBounds.maxX)),l=l.withMaxX(Math.min(l.maxX,L.maxBounds.maxX)),I=Math.max(I,L.maxBounds.minY),W=Math.min(W,L.maxBounds.maxY);for(I=l.minX,W=l.maxX;isFinite(n.minY)&&isFinite(l.minY)&&Math.abs(n.minY-l.minY)>s&&(L=d(A(new Bounds2(I,l.minY,W,n.minY))),!(n.minY<=L.minBounds.minY&&l.minY>=L.maxBounds.minY));)n=n.withMinY(Math.min(n.minY,L.minBounds.minY)),l=l.withMinY(Math.max(l.minY,L.maxBounds.minY)),I=Math.max(I,L.maxBounds.minX),W=Math.min(W,L.maxBounds.maxX);for(I=l.minX,W=l.maxX;isFinite(n.maxY)&&isFinite(l.maxY)&&Math.abs(n.maxY-l.maxY)>s&&(L=d(A(new Bounds2(I,n.maxY,W,l.maxY))),!(n.maxY>=L.minBounds.maxY&&l.maxY<=L.maxBounds.maxY));)n=n.withMaxY(Math.max(n.maxY,L.minBounds.maxY)),l=l.withMaxY(Math.min(l.maxY,L.maxBounds.maxY)),I=Math.max(I,L.maxBounds.minX),W=Math.min(W,L.maxBounds.maxX);const H=new Bounds2(isFinite(n.minX)&&isFinite(l.minX)?(n.minX+l.minX)/2:Number.POSITIVE_INFINITY,isFinite(n.minY)&&isFinite(l.minY)?(n.minY+l.minY)/2:Number.POSITIVE_INFINITY,isFinite(n.maxX)&&isFinite(l.maxX)?(n.maxX+l.maxX)/2:Number.NEGATIVE_INFINITY,isFinite(n.maxY)&&isFinite(l.maxY)?(n.maxY+l.maxY)/2:Number.NEGATIVE_INFINITY);return H.minBounds=n,H.maxBounds=l,H.isConsistent=l.containsBounds(n),H.precision=Math.max(Math.abs(n.minX-l.minX),Math.abs(n.minY-l.minY),Math.abs(n.maxX-l.maxX),Math.abs(n.maxY-l.maxY)),H},toPowerOf2(a){let t=1;for(;t<a;)t*=2;return t},createShader(a,t,s){const r=a.createShader(s);return a.shaderSource(r,t),a.compileShader(r),a.getShaderParameter(r,a.COMPILE_STATUS)||(console.log("GLSL compile error:"),console.log(a.getShaderInfoLog(r)),console.log(t)),r},applyWebGLContextDefaults(a){a.clearColor(0,0,0,0),a.enable(a.BLEND),a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA)},setWebGLEnabled(a){webglEnabled=a},checkWebGLSupport(a){if(!webglEnabled)return!1;const t=document.createElement("canvas"),s={failIfMajorPerformanceCaveat:!0};try{const r=!!window.WebGLRenderingContext&&(t.getContext("webgl",s)||t.getContext("experimental-webgl",s));if(!r)return!1;if(a){for(let o=0;o<a.length;o++)if(r.getExtension(a[o])===null)return!1}return!0}catch{return!1}},checkIE11StencilSupport(){const a=document.createElement("canvas");try{const t=!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"));return t?(t.clearStencil(0),t.getError()===0):!1}catch{return!1}},get isWebGLSupported(){return _extensionlessWebGLSupport===void 0&&(_extensionlessWebGLSupport=Utils.checkWebGLSupport()),_extensionlessWebGLSupport},loseContext(a){const t=a.getExtension("WEBGL_lose_context");t&&(t.loseContext(),setTimeout(()=>{t.restoreContext()},1e3))},safariEmbeddingMarkWorkaround(a){if(platform.safari){const t=a.split("");let s="",r=!1;for(let o=0;o<t.length;o++){const n=t[o],l=n==="‪"||n==="‫"||n==="‬";r&&l&&(s+="​"),s+=n,r=l}return s}else return a}};scenery.register("Utils",Utils);const Rh=class Rh{constructor(t,s){this.display=t,this.trail=s}};Rh.FocusIO=new IOType("FocusIO",{valueType:Rh,documentation:"A PhET-iO Type for the instance in the simulation which currently has keyboard focus. FocusIO is serialized into and Object with key `focusedPhetioElement` that is a list of PhET-iO Elements, from parent-most to child-most corresponding to the PhET-iO Element that was instrumented.",toStateObject:t=>{const s=[];return t.trail.nodes.forEach((r,o)=>{r.isPhetioInstrumented()&&s.push(r.tandem.phetioID)}),{focusedPhetioElement:s}},stateSchema:{focusedPhetioElement:ArrayIO(StringIO)}});let Focus=Rh;scenery.register("Focus",Focus);const KEY_RIGHT_ARROW="ArrowRight",KEY_LEFT_ARROW="ArrowLeft",KEY_UP_ARROW="ArrowUp",KEY_DOWN_ARROW="ArrowDown",KEY_SHIFT_RIGHT="ShiftRight",KEY_SHIFT_LEFT="ShiftLeft",KEY_CONTROL_LEFT="ControlLeft",KEY_CONTROL_RIGHT="ControlRight",KEY_ALT_LEFT="AltLeft",KEY_ALT_RIGHT="AltRight",KEY_META_LEFT="MetaLeft",KEY_META_RIGHT="MetaRight",KEY_META_LEFT_FIREFOX="OSLeft",KEY_META_RIGHT_FIREFOX="OSRight",KEY_W="KeyW",KEY_A="KeyA",KEY_S="KeyS",KEY_D="KeyD",KEY_0="Digit0",KEY_1="Digit1",KEY_2="Digit2",KEY_3="Digit3",KEY_4="Digit4",KEY_5="Digit5",KEY_6="Digit6",KEY_7="Digit7",KEY_8="Digit8",KEY_9="Digit9",KEY_ALT="Alt",KEY_SHIFT="Shift",KEY_CONTROL="Control",ARROW_KEYS=[KEY_RIGHT_ARROW,KEY_LEFT_ARROW,KEY_UP_ARROW,KEY_DOWN_ARROW],WASD_KEYS=[KEY_W,KEY_S,KEY_A,KEY_D],NUMBER_KEYS=[KEY_0,KEY_1,KEY_2,KEY_3,KEY_4,KEY_5,KEY_6,KEY_7,KEY_8,KEY_9],SHIFT_KEYS=[KEY_SHIFT_LEFT,KEY_SHIFT_RIGHT],CONTROL_KEYS=[KEY_CONTROL_LEFT,KEY_CONTROL_RIGHT],ALT_KEYS=[KEY_ALT_LEFT,KEY_ALT_RIGHT],META_KEYS=[KEY_META_LEFT,KEY_META_RIGHT,KEY_META_LEFT_FIREFOX,KEY_META_RIGHT_FIREFOX],MODIFIER_KEYS=[KEY_ALT,KEY_CONTROL,KEY_SHIFT],MODIFIER_KEY_CODES=[KEY_ALT_LEFT,KEY_ALT_RIGHT,KEY_CONTROL_LEFT,KEY_CONTROL_RIGHT,KEY_SHIFT_LEFT,KEY_SHIFT_RIGHT,KEY_META_LEFT,KEY_META_RIGHT,KEY_META_LEFT_FIREFOX,KEY_META_RIGHT_FIREFOX],DOM_EVENT_VALIDATOR={valueType:Event},ALL_KEY_CODES=[],KeyboardUtils={KEY_SPACE:"Space",KEY_ENTER:"Enter",KEY_TAB:"Tab",KEY_RIGHT_ARROW,KEY_LEFT_ARROW,KEY_UP_ARROW,KEY_DOWN_ARROW,KEY_SHIFT_LEFT,KEY_SHIFT_RIGHT,KEY_ALT_LEFT,KEY_ALT_RIGHT,KEY_CONTROL_LEFT,KEY_CONTROL_RIGHT,KEY_META_LEFT,KEY_META_RIGHT,KEY_META_LEFT_FIREFOX,KEY_META_RIGHT_FIREFOX,KEY_SHIFT,KEY_ALT,KEY_CONTROL,KEY_ESCAPE:"Escape",KEY_DELETE:"Delete",KEY_BACKSPACE:"Backspace",KEY_PAGE_UP:"PageUp",KEY_PAGE_DOWN:"PageDown",KEY_END:"End",KEY_HOME:"Home",KEY_0,KEY_1,KEY_2,KEY_3,KEY_4,KEY_5,KEY_6,KEY_7,KEY_8,KEY_9,KEY_NUMPAD_0:"Numpad0",KEY_NUMPAD_1:"Numpad1",KEY_NUMPAD_2:"Numpad2",KEY_NUMPAD_3:"Numpad3",KEY_NUMPAD_4:"Numpad4",KEY_NUMPAD_5:"Numpad5",KEY_NUMPAD_6:"Numpad6",KEY_NUMPAD_7:"Numpad7",KEY_NUMPAD_8:"Numpad8",KEY_NUMPAD_9:"Numpad9",KEY_NUMPAD_DECIMAL:"NumpadDecimal",KEY_NUMPAD_PLUS:"NumpadAdd",KEY_NUMPAD_MINUS:"NumpadSubtract",KEY_A:"KeyA",KEY_B:"KeyB",KEY_C:"KeyC",KEY_D:"KeyD",KEY_E:"KeyE",KEY_F:"KeyF",KEY_G:"KeyG",KEY_H:"KeyH",KEY_I:"KeyI",KEY_J:"KeyJ",KEY_K:"KeyK",KEY_L:"KeyL",KEY_M:"KeyM",KEY_N:"KeyN",KEY_O:"KeyO",KEY_P:"KeyP",KEY_Q:"KeyQ",KEY_R:"KeyR",KEY_S:"KeyS",KEY_T:"KeyT",KEY_U:"KeyU",KEY_V:"KeyV",KEY_W:"KeyW",KEY_X:"KeyX",KEY_Y:"KeyY",KEY_Z:"KeyZ",KEY_EQUALS:"Equal",KEY_PLUS:"Equal",KEY_MINUS:"Minus",KEY_PERIOD:"Period",ARROW_KEYS,WASD_KEYS,MOVEMENT_KEYS:ARROW_KEYS.concat(WASD_KEYS),SHIFT_KEYS,CONTROL_KEYS,ALT_KEYS,META_KEYS,MODIFIER_KEY_CODES,MODIFIER_KEY_TO_CODE_MAP:new Map([[KEY_ALT,ALT_KEYS],[KEY_SHIFT,SHIFT_KEYS],[KEY_CONTROL,CONTROL_KEYS]]),isArrowKey(a){return KeyboardUtils.isAnyKeyEvent(a,ARROW_KEYS)},isRangeKey(a){return KeyboardUtils.isArrowKey(a)||KeyboardUtils.isAnyKeyEvent(a,[KeyboardUtils.KEY_PAGE_UP,KeyboardUtils.KEY_PAGE_DOWN,KeyboardUtils.KEY_HOME,KeyboardUtils.KEY_END])},isNumberKey(a){return KeyboardUtils.isAnyKeyEvent(a,NUMBER_KEYS)},getNumberFromCode(a){return KeyboardUtils.isNumberKey(a)&&a instanceof KeyboardEvent?Number(a.code.replace("Digit","")):null},isShiftKey(a){return KeyboardUtils.isAnyKeyEvent(a,SHIFT_KEYS)},isAltKey(a){return KeyboardUtils.isAnyKeyEvent(a,ALT_KEYS)},isControlKey(a){return KeyboardUtils.isAnyKeyEvent(a,CONTROL_KEYS)},isMetaKey(a){return KeyboardUtils.isAnyKeyEvent(a,META_KEYS)},isWASDKey(a){return KeyboardUtils.isAnyKeyEvent(a,WASD_KEYS)},isMovementKey(a){return KeyboardUtils.isAnyKeyEvent(a,KeyboardUtils.MOVEMENT_KEYS)},isAnyKeyEvent(a,t){validate(a,DOM_EVENT_VALIDATOR);const s=KeyboardUtils.getEventCode(a);return s?t.includes(s):!1},isKeyEvent(a,t){return KeyboardUtils.getEventCode(a)===t},getEventCode(a){let t=null;return a instanceof KeyboardEvent&&a.code&&(t=a.code,t.startsWith("Numpad")&&ALL_KEY_CODES.includes(a.key)&&(t=a.key)),t},isModifierKey(a){return MODIFIER_KEYS.includes(a)},ALL_KEYS:ALL_KEY_CODES};for(const a in KeyboardUtils)KeyboardUtils.hasOwnProperty(a)&&typeof KeyboardUtils[a]=="string"&&ALL_KEY_CODES.push(KeyboardUtils[a]);scenery.register("KeyboardUtils",KeyboardUtils);const EnglishStringToCodeMap={q:[KeyboardUtils.KEY_Q],w:[KeyboardUtils.KEY_W],e:[KeyboardUtils.KEY_E],r:[KeyboardUtils.KEY_R],t:[KeyboardUtils.KEY_T],y:[KeyboardUtils.KEY_Y],u:[KeyboardUtils.KEY_U],i:[KeyboardUtils.KEY_I],o:[KeyboardUtils.KEY_O],p:[KeyboardUtils.KEY_P],a:[KeyboardUtils.KEY_A],s:[KeyboardUtils.KEY_S],d:[KeyboardUtils.KEY_D],f:[KeyboardUtils.KEY_F],g:[KeyboardUtils.KEY_G],h:[KeyboardUtils.KEY_H],j:[KeyboardUtils.KEY_J],k:[KeyboardUtils.KEY_K],l:[KeyboardUtils.KEY_L],z:[KeyboardUtils.KEY_Z],x:[KeyboardUtils.KEY_X],c:[KeyboardUtils.KEY_C],v:[KeyboardUtils.KEY_V],b:[KeyboardUtils.KEY_B],n:[KeyboardUtils.KEY_N],m:[KeyboardUtils.KEY_M],0:[KeyboardUtils.KEY_0,KeyboardUtils.KEY_NUMPAD_0],1:[KeyboardUtils.KEY_1,KeyboardUtils.KEY_NUMPAD_1],2:[KeyboardUtils.KEY_2,KeyboardUtils.KEY_NUMPAD_2],3:[KeyboardUtils.KEY_3,KeyboardUtils.KEY_NUMPAD_3],4:[KeyboardUtils.KEY_4,KeyboardUtils.KEY_NUMPAD_4],5:[KeyboardUtils.KEY_5,KeyboardUtils.KEY_NUMPAD_5],6:[KeyboardUtils.KEY_6,KeyboardUtils.KEY_NUMPAD_6],7:[KeyboardUtils.KEY_7,KeyboardUtils.KEY_NUMPAD_7],8:[KeyboardUtils.KEY_8,KeyboardUtils.KEY_NUMPAD_8],9:[KeyboardUtils.KEY_9,KeyboardUtils.KEY_NUMPAD_9],enter:[KeyboardUtils.KEY_ENTER],tab:[KeyboardUtils.KEY_TAB],equals:[KeyboardUtils.KEY_EQUALS],plus:[KeyboardUtils.KEY_PLUS,KeyboardUtils.KEY_NUMPAD_PLUS],minus:[KeyboardUtils.KEY_MINUS,KeyboardUtils.KEY_NUMPAD_MINUS],period:[KeyboardUtils.KEY_PERIOD,KeyboardUtils.KEY_NUMPAD_DECIMAL],escape:[KeyboardUtils.KEY_ESCAPE],delete:[KeyboardUtils.KEY_DELETE],backspace:[KeyboardUtils.KEY_BACKSPACE],pageUp:[KeyboardUtils.KEY_PAGE_UP],pageDown:[KeyboardUtils.KEY_PAGE_DOWN],end:[KeyboardUtils.KEY_END],home:[KeyboardUtils.KEY_HOME],space:[KeyboardUtils.KEY_SPACE],arrowLeft:[KeyboardUtils.KEY_LEFT_ARROW],arrowRight:[KeyboardUtils.KEY_RIGHT_ARROW],arrowUp:[KeyboardUtils.KEY_UP_ARROW],arrowDown:[KeyboardUtils.KEY_DOWN_ARROW],ctrl:[KeyboardUtils.KEY_CONTROL_LEFT,KeyboardUtils.KEY_CONTROL_RIGHT],alt:[KeyboardUtils.KEY_ALT_LEFT,KeyboardUtils.KEY_ALT_RIGHT],shift:[KeyboardUtils.KEY_SHIFT_LEFT,KeyboardUtils.KEY_SHIFT_RIGHT]};scenery.register("EnglishStringToCodeMap",EnglishStringToCodeMap);const noExtraPrototype=a=>Object.getPrototypeOf(a)===Object.prototype,ObjectLiteralIO=new IOType("ObjectLiteralIO",{documentation:"PhET-iO Type for object literals",isValidValue:noExtraPrototype,supertype:ValueIO,stateSchema:StateSchema.asValue("object",{valueType:Object,isValidValue:noExtraPrototype}),toStateObject:_.identity});tandemNamespace.register("ObjectLiteralIO",ObjectLiteralIO);const EventIO=new IOType("EventIO",{valueType:window.Event,documentation:"A DOM Event",toStateObject:a=>Input.serializeDomEvent(a),fromStateObject:a=>Input.deserializeDomEvent(a),stateSchema:()=>({constructorName:StringIO,altKey:NullableIO(BooleanIO),button:NullableIO(NumberIO),charCode:NullableIO(NumberIO),clientX:NullableIO(NumberIO),clientY:NullableIO(NumberIO),code:NullableIO(StringIO),ctrlKey:NullableIO(BooleanIO),deltaMode:NullableIO(NumberIO),deltaX:NullableIO(NumberIO),deltaY:NullableIO(NumberIO),deltaZ:NullableIO(NumberIO),key:NullableIO(StringIO),keyCode:NullableIO(NumberIO),metaKey:NullableIO(BooleanIO),pageX:NullableIO(NumberIO),pageY:NullableIO(NumberIO),pointerId:NullableIO(NumberIO),pointerType:NullableIO(StringIO),scale:NullableIO(NumberIO),shiftKey:NullableIO(BooleanIO),target:NullableIO(ObjectLiteralIO),type:NullableIO(StringIO),relatedTarget:NullableIO(ObjectLiteralIO),which:NullableIO(NumberIO)})});scenery.register("EventIO",EventIO);const styleElement=document.createElement("style");styleElement.type="text/css";document.head.appendChild(styleElement);const stylesheet=document.styleSheets[document.styleSheets.length-1];assert&&assert(stylesheet.disabled===!1);const SceneryStyle={stylesheet,styleElement,addRule(a){this.stylesheet.insertRule(a,0)}};scenery.register("SceneryStyle",SceneryStyle);class CanvasContextWrapper{constructor(t,s){this.canvas=t,this.context=s,this.resetStyles()}resetStyles(){this.fillStyle=void 0,this.strokeStyle=void 0,this.lineWidth=void 0,this.lineCap=void 0,this.lineJoin=void 0,this.lineDash=void 0,this.lineDashOffset=void 0,this.miterLimit=void 0,this.font=void 0,this.direction=void 0}setDimensions(t,s){this.canvas.width=t,this.canvas.height=s,this.resetStyles()}setFillStyle(t){t&&isTReadOnlyProperty(t)&&(t=t.value),t&&t.getCanvasStyle&&(t=t.getCanvasStyle()),this.fillStyle!==t&&(this.fillStyle=t,this.context.fillStyle=t)}setStrokeStyle(t){t&&isTReadOnlyProperty(t)&&(t=t.value),t&&t.getCanvasStyle&&(t=t.getCanvasStyle()),this.strokeStyle!==t&&(this.strokeStyle=t,this.context.strokeStyle=t)}setLineWidth(t){this.lineWidth!==t&&(this.lineWidth=t,this.context.lineWidth=t)}setLineCap(t){this.lineCap!==t&&(this.lineCap=t,this.context.lineCap=t)}setLineJoin(t){this.lineJoin!==t&&(this.lineJoin=t,this.context.lineJoin=t)}setMiterLimit(t){assert&&assert(typeof t=="number"),this.miterLimit!==t&&(this.miterLimit=t,this.context.miterLimit=t)}setLineDash(t){assert&&assert(t!==void 0,"undefined line dash would cause hard-to-trace errors"),this.lineDash!==t&&(this.lineDash=t,this.context.setLineDash?this.context.setLineDash(t===null?[]:t):this.context.mozDash!==void 0?this.context.mozDash=t:this.context.webkitLineDash!==void 0&&(this.context.webkitLineDash=t||[]))}setLineDashOffset(t){this.lineDashOffset!==t&&(this.lineDashOffset=t,this.context.lineDashOffset!==void 0?this.context.lineDashOffset=t:this.context.webkitLineDashOffset!==void 0&&(this.context.webkitLineDashOffset=t))}setFont(t){this.font!==t&&(this.font=t,this.context.font=t)}setDirection(t){this.direction!==t&&(this.direction=t,this.context.direction=t)}}scenery.register("CanvasContextWrapper",CanvasContextWrapper);const exitFullscreenPropertyName=detectPrefix(document,"exitFullscreen")||detectPrefix(document,"cancelFullScreen"),fullscreenElementPropertyName=detectPrefix(document,"fullscreenElement")||detectPrefix(document,"fullScreenElement"),fullscreenEnabledPropertyName=detectPrefix(document,"fullscreenEnabled")||detectPrefix(document,"fullScreenEnabled");let fullscreenChangeEvent=detectPrefixEvent(document,"fullscreenchange");fullscreenChangeEvent==="msfullscreenchange"&&(fullscreenChangeEvent="MSFullscreenChange");const FullScreen={isFullScreen(){return!!document[fullscreenElementPropertyName]},isFullScreenEnabled(){return document[fullscreenEnabledPropertyName]&&!platform.safari7},enterFullScreen(a){const t=detectPrefix(document.body,"requestFullscreen")||detectPrefix(document.body,"requestFullScreen");a.domElement[t]&&a.domElement[t]()},exitFullScreen(){document[exitFullscreenPropertyName]&&document[exitFullscreenPropertyName]()},toggleFullScreen(a){FullScreen.isFullScreen()?FullScreen.exitFullScreen():FullScreen.enterFullScreen(a)},isFullScreenProperty:new Property(!1)};document.addEventListener(fullscreenChangeEvent,a=>{FullScreen.isFullScreenProperty.set(FullScreen.isFullScreen())});scenery.register("FullScreen",FullScreen);const FullScreen$1=FullScreen;class CountMap{constructor(t,s){this.create=t,this.destroy=s,this.map=new Map}increment(t,s=1){if(assert&&assert(typeof s=="number"),assert&&assert(s>=1),this.map.has(t))this.map.get(t).count+=s;else{const r=this.create(t),o=CountMapEntry.createFromPool(s,t,r);this.map.set(t,o)}}decrement(t,s=1){assert&&assert(typeof s=="number"),assert&&assert(s>=1);const r=this.map.get(t);r&&(r.count-=s,r.count<1&&(this.destroy(t,r.value),this.map.delete(t),r.dispose()))}get(t){return this.map.get(t).value}clear(){this.map.clear()}}class CountMapEntry{constructor(t,s,r){this.initialize(t,s,r)}initialize(t,s,r){this.count=t,this.key=s,this.value=r}dispose(){this.key=null,this.value=null,this.freeToPool()}}Poolable.mixInto(CountMapEntry,{initialize:CountMapEntry.prototype.initialize});scenery.register("CountMap",CountMap);class DisplayedProperty extends BooleanProperty{constructor(t,s){s=merge({display:null},s),super(!1,s),this.node=t,this.display=s.display,this.updateListener=this.updateValue.bind(this),this.changedInstanceListener=this.changedInstance.bind(this),t.changedInstanceEmitter.addListener(this.changedInstanceListener);const r=t.instances;for(let o=0;o<r.length;o++)this.changedInstance(r[o],!0)}updateValue(){this.value=this.node.wasVisuallyDisplayed(this.display)}changedInstance(t,s){s?t.visibleEmitter.addListener(this.updateListener):t.visibleEmitter.removeListener(this.updateListener),this.updateValue()}dispose(){const t=this.node.instances;for(let s=0;s<t.length;s++)this.changedInstance(t[s],!1);this.node.changedInstanceEmitter.removeListener(this.changedInstanceListener),super.dispose()}}scenery.register("DisplayedProperty",DisplayedProperty);class SceneImage{constructor(t){this.scene=t,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.img=document.createElement("img"),this.update()}update(t){this.scene.updateScene(),this.canvas.width=this.scene.getSceneWidth(),this.canvas.height=this.scene.getSceneHeight(),this.scene.renderToCanvas(this.canvas,this.context,()=>{const s=this.toDataURL();this.img.onload=()=>{t(),delete this.img.onload},this.img.src=s})}}scenery.register("SceneImage",SceneImage);var vd,_d,Sd,Ad,wd;const allowLinksProperty=new BooleanProperty(!((_d=(vd=window==null?void 0:window.phet)==null?void 0:vd.chipper)!=null&&_d.queryParameters)||((wd=(Ad=(Sd=window==null?void 0:window.phet)==null?void 0:Sd.chipper)==null?void 0:Ad.queryParameters)==null?void 0:wd.allowLinks),{tandem:Tandem.GENERAL_MODEL.createTandem("allowLinksProperty")});scenery.register("allowLinksProperty",allowLinksProperty);function openPopup(a,t=allowLinksProperty.value){const s=phet&&phet.chipper&&phet.chipper.isFuzzEnabled();if(t&&!s){const r=window.open(a,"_blank");r&&r.focus()}}scenery.register("openPopup",openPopup);const getLineBreakRanges=(a,t)=>{const s=optionize()({requiredOnly:!1},t),r=[],o=new LineBreaker(a);o[Symbol.iterator]=()=>({next(){const l=o.nextBreak();return l!==null?{value:l,done:!1}:{done:!0}}});let n=0;for(const l of o){const h=l.position;s.requiredOnly&&!l.required||(n!==h&&r.push(new Range(n,h)),n=l.position)}return n<a.length&&r.push(new Range(n,a.length)),r};scenery.register("getLineBreakRanges",getLineBreakRanges);const kite=new Namespace("kite"),lineLineIntersection=DotUtils.lineLineIntersection,DEFAULT_OPTIONS$8={lineWidth:1,lineCap:"butt",lineJoin:"miter",lineDash:[],lineDashOffset:0,miterLimit:10};class LineStyles{constructor(t){const s=merge({},DEFAULT_OPTIONS$8,t);this.lineWidth=s.lineWidth,this.lineCap=s.lineCap,this.lineJoin=s.lineJoin,this.lineDash=s.lineDash,this.lineDashOffset=s.lineDashOffset,this.miterLimit=s.miterLimit,assert&&assert(typeof this.lineWidth=="number",`lineWidth should be a number: ${this.lineWidth}`),assert&&assert(isFinite(this.lineWidth),`lineWidth should be a finite number: ${this.lineWidth}`),assert&&assert(this.lineWidth>=0,`lineWidth should be non-negative: ${this.lineWidth}`),assert&&assert(this.lineCap==="butt"||this.lineCap==="round"||this.lineCap==="square",`Invalid lineCap: ${this.lineCap}`),assert&&assert(this.lineJoin==="miter"||this.lineJoin==="round"||this.lineJoin==="bevel",`Invalid lineJoin: ${this.lineJoin}`),assert&&assert(Array.isArray(this.lineDash),`lineDash should be an array: ${this.lineDash}`),assert&&assert(_.every(this.lineDash,r=>typeof r=="number"&&isFinite(r)&&r>=0),`Every lineDash should be a non-negative finite number: ${this.lineDash}`),assert&&assert(typeof this.lineDashOffset=="number",`lineDashOffset should be a number: ${this.lineDashOffset}`),assert&&assert(isFinite(this.lineDashOffset),`lineDashOffset should be a finite number: ${this.lineDashOffset}`),assert&&assert(typeof this.miterLimit=="number",`miterLimit should be a number: ${this.miterLimit}`),assert&&assert(isFinite(this.miterLimit),`miterLimit should be a finite number: ${this.miterLimit}`)}equals(t){if(!(this.lineWidth===t.lineWidth&&this.lineCap===t.lineCap&&this.lineJoin===t.lineJoin&&this.miterLimit===t.miterLimit&&this.lineDashOffset===t.lineDashOffset))return!1;if(this.lineDash.length===t.lineDash.length){for(let r=0;r<this.lineDash.length;r++)if(this.lineDash[r]!==t.lineDash[r])return!1}else return!1;return!0}copy(){return new LineStyles({lineWidth:this.lineWidth,lineCap:this.lineCap,lineJoin:this.lineJoin,lineDash:this.lineDash,lineDashOffset:this.lineDashOffset,miterLimit:this.miterLimit})}leftJoin(t,s,r){s=s.normalized(),r=r.normalized();const o=t.plus(s.perpendicular.negated().times(this.lineWidth/2)),n=t.plus(r.perpendicular.negated().times(this.lineWidth/2)),l=o.equals(n)?[]:[new Line$1(o,n)];let h,g,d;if(s.perpendicular.dot(r)>1e-12)switch(this.lineJoin){case"round":return h=s.angle+Math.PI/2,g=r.angle+Math.PI/2,[new Arc(t,this.lineWidth/2,h,g,!0)];case"miter":if(d=s.angleBetween(r.negated()),1/Math.sin(d/2)<=this.miterLimit&&d<Math.PI-1e-5){const A=lineLineIntersection(o,o.plus(s),n,n.plus(r));return A?[new Line$1(o,A),new Line$1(A,n)]:[new Line$1(o,n)]}else return l;case"bevel":return l;default:throw new Error(`invalid lineJoin: ${this.lineJoin}`)}else return l}rightJoin(t,s,r){return this.leftJoin(t,r.negated(),s.negated())}cap(t,s){s=s.normalized();const r=t.plus(s.perpendicular.times(-this.lineWidth/2)),o=t.plus(s.perpendicular.times(this.lineWidth/2));let n,l,h,g,d,A;switch(this.lineCap){case"butt":return[new Line$1(r,o)];case"round":return n=s.angle,[new Arc(t,this.lineWidth/2,n+Math.PI/2,n-Math.PI/2,!0)];case"square":return l=s.perpendicular.negated().times(this.lineWidth/2),h=s.perpendicular.times(this.lineWidth/2),g=s.times(this.lineWidth/2),d=t.plus(l).plus(g),A=t.plus(h).plus(g),[new Line$1(r,d),new Line$1(d,A),new Line$1(A,o)];default:throw new Error(`invalid lineCap: ${this.lineCap}`)}}}kite.register("LineStyles",LineStyles);class Overlap{constructor(t,s){assert&&assert(isFinite(t)&&t!==0,"a should be a finite non-zero number"),assert&&assert(isFinite(s),"b should be a finite number"),this.a=t,this.b=s;let r=0,o=1,n=this.apply(r),l=this.apply(o);n>1&&(n=1,r=this.applyInverse(n)),n<0&&(n=0,r=this.applyInverse(n)),l>1&&(l=1,o=this.applyInverse(l)),l<0&&(l=0,o=this.applyInverse(l)),this.t0=r,this.t1=o,t>0?(this.qt0=n,this.qt1=l):(this.qt0=l,this.qt1=n),this.t0<0&&this.t0>-1e-8&&(this.t0=0),this.t0>1&&this.t0<1+1e-8&&(this.t0=1),this.t1<0&&this.t1>-1e-8&&(this.t1=0),this.t1>1&&this.t1<1+1e-8&&(this.t1=1),this.qt0<0&&this.qt0>-1e-8&&(this.qt0=0),this.qt0>1&&this.qt0<1+1e-8&&(this.qt0=1),this.qt1<0&&this.qt1>-1e-8&&(this.qt1=0),this.qt1>1&&this.qt1<1+1e-8&&(this.qt1=1),assert&&assert(this.t0>=0&&this.t0<=1,`t0 out of range: ${this.t0}`),assert&&assert(this.t1>=0&&this.t1<=1,`t1 out of range: ${this.t1}`),assert&&assert(this.qt0>=0&&this.qt0<=1,`qt0 out of range: ${this.qt0}`),assert&&assert(this.qt1>=0&&this.qt1<=1,`qt1 out of range: ${this.qt1}`)}apply(t){return this.a*t+this.b}applyInverse(t){return(t-this.b)/this.a}static createLinear(t,s,r,o){const n=(o-s)/(r-t);return new Overlap(n,s-t*n)}}kite.register("Overlap",Overlap);class RayIntersection{constructor(t,s,r,o,n){assert&&assert(isFinite(t)&&t>=0,"invalid distance"),assert&&assert(Math.abs(r.magnitude-1)<1e-7,"invalid normal"),assert&&assert(n>=-1e-10&&n<=1+1e-10,`t out of range: ${n}`),this.point=s,this.normal=r,this.distance=t,this.wind=o,this.t=DotUtils.clamp(n,0,1)}}kite.register("RayIntersection",RayIntersection);class SegmentIntersection{constructor(t,s,r){assert&&assert(s>=-1e-10&&s<=1+1e-10,"aT out of range"),assert&&assert(r>=-1e-10&&r<=1+1e-10,"bT out of range"),this.point=t,this.aT=DotUtils.clamp(s,0,1),this.bT=DotUtils.clamp(r,0,1)}getSwapped(){return new SegmentIntersection(this.point,this.bT,this.aT)}}kite.register("SegmentIntersection",SegmentIntersection);const svgNumber=a=>a.toFixed(20);kite.register("svgNumber",svgNumber);const getDet2=(a,t,s,r)=>a.times(r).minus(t.times(s)),getDeterminant=a=>{const t=a[0],s=a[1],r=a[2],o=a[3],n=a[4],l=a[5],h=a[6],g=a[7],d=a[8];return t.times(n).times(d).plus(s.times(l).times(h)).plus(r.times(o).times(g)).minus(r.times(n).times(h)).minus(s.times(o).times(d)).minus(t.times(l).times(g))},getAdjugateMatrix=a=>{const t=a[0],s=a[1],r=a[2],o=a[3],n=a[4],l=a[5],h=a[6],g=a[7],d=a[8];return[getDet2(n,l,g,d),getDet2(s,r,g,d).negate(),getDet2(s,r,n,l),getDet2(o,l,h,d).negate(),getDet2(t,r,h,d),getDet2(t,r,o,l).negate(),getDet2(o,n,h,g),getDet2(t,s,h,g).negate(),getDet2(t,s,o,n)]},getTranspose=a=>[a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]],getNonzeroRow=(a,t=!1)=>_.sortBy([a.slice(0,3),a.slice(3,6),a.slice(6,9)],s=>-(s[0].magnitude+s[1].magnitude+(t?s[2].magnitude:0)))[0],getNonzeroColumn=(a,t=!1)=>getNonzeroRow(getTranspose(a),t),getAntiSymmetricMatrix=a=>{const t=getAdjugateMatrix(a),s=getNonzeroRow(t);return[Complex.ZERO,s[2],s[1].negated(),s[2].negated(),Complex.ZERO,s[0],s[1],s[0].negated(),Complex.ZERO]},computeAlpha=(a,t)=>{const s=a[0],r=a[1],o=a[3],n=a[4],l=t[0],h=t[1],g=t[3],d=t[4],A=h.times(g).minus(l.times(d)),S=d.negated().times(s).plus(g.times(r)).plus(h.times(o)).minus(l.times(n)),O=r.times(o).minus(s.times(n)),I=Complex.solveQuadraticRoots(A,S,O);return I===null?null:I[0]},getRank1DegenerateConicMatrix=a=>{const t=getAntiSymmetricMatrix(a),s=computeAlpha(a,t);return s===null?a:[a[0].plus(s.times(t[0])),a[1].plus(s.times(t[1])),a[2].plus(s.times(t[2])),a[3].plus(s.times(t[3])),a[4].plus(s.times(t[4])),a[5].plus(s.times(t[5])),a[6].plus(s.times(t[6])),a[7].plus(s.times(t[7])),a[8].plus(s.times(t[8]))]},getRealIntersectionsForDegenerateConic=a=>{const t=[],s=a[0],r=a[1].times(Complex.real(2)),o=a[4],n=a[2].times(Complex.real(2)),l=a[5].times(Complex.real(2)),h=a[8];let g=[];const d=new Complex(-2.51653525696959,1.5292850284402),A=o,S=r.times(d).plus(l),O=s.times(d).times(d).plus(n.times(d)).plus(h),I=Complex.solveQuadraticRoots(A,S,O);if(I&&I.length>=2)g=[[d,I[0]],[d,I[1]]];else{const W=s,L=r.times(d).plus(n),H=o.times(d).times(d).plus(l.times(d)).plus(h),Y=Complex.solveQuadraticRoots(W,L,H);if(Y&&Y.length>=2)g=[[Y[0],d],[Y[1],d]];else if(I&&I.length===1)g=[[d,I[0]]];else if(Y&&Y.length===1)g=[[Y[0],d]];else throw new Error("Implement more advanced initialization to find two solutions")}return g.forEach(W=>{const L=W[0].real,H=W[1].real,Y=W[0].imaginary,Q=W[1].imaginary,pe=s.real,de=r.real,fe=o.real,ye=n.real,Ee=l.real,Le=s.imaginary,Z=r.imaginary,ne=o.imaginary,Ke=n.imaginary,_t=l.imaginary,xe=new Vector4(-2*Le*Y-Z*Q+ye+2*pe*L+de*H,-Z*Y-2*ne*Q+Ee+de*L+2*fe*H,-Ke-2*Y*pe-Q*de-2*Le*L-Z*H,-_t-Y*de-2*Q*fe-Z*L-2*ne*H),Ct=new Vector4(Ke+2*Y*pe+Q*de+2*Le*L+Z*H,_t+Y*de+2*Q*fe+Z*L+2*ne*H,-2*Le*Y-Z*Q+ye+2*pe*L+de*H,-Z*Y-2*ne*Q+Ee+de*L+2*fe*H),zt=new Vector4(6.1951068548253,-1.159268950386,.1602918829294,3.205818692048202),Je=new Vector4(-5.420628549296924,-15.2069583028685,.159590602048868,5.10688288040682),Et=(oi,ki)=>ki.timesScalar(oi.dot(ki)/ki.dot(ki)),ht=xe,mt=Ct.minus(Et(Ct,ht)),Nt=zt.minus(Et(zt,ht)).minus(Et(zt,mt)),Gt=Je.minus(Et(Je,ht)).minus(Et(Je,mt)).minus(Et(Je,Nt)),Mt=new Matrix$1(2,2,[Nt.z,Gt.z,Nt.w,Gt.w]),jt=new SingularValueDecomposition(Mt).getSingularValues();let Ai=null;if(Math.abs(Y)<1e-10&&Math.abs(Q)<1e-10)Ai=new Vector2(L,H);else{if(Math.abs(jt[1])>1e-10){const oi=Mt.solve(new Matrix$1(2,1,[-Y,-Q])).extractVector2(0);Ai=new Vector2(L+oi.x*Nt.z+oi.y*Gt.z,H+oi.x*Nt.w+oi.y*Gt.w)}else if(Math.abs(jt[0])>1e-10){const oi=Math.abs(Nt.z)+Math.abs(Nt.w)>Math.abs(Gt.z)+Math.abs(Gt.w)?Nt:Gt,ki=new Vector2(oi.z,oi.w),Li=new Vector2(Y,Q).dot(ki)/ki.dot(ki),Wi=new Vector4(L,H,Y,Q).minus(oi.timesScalar(Li));Math.abs(Wi.z)<1e-8&&Math.abs(Wi.w)<1e-8&&(Ai=new Vector2(Wi.x,Wi.y))}else Ai=null;if(Ai){if(Math.abs(jt[1])>1e-10)t.push(Ai);else if(Math.abs(jt[0])>1e-10){const oi=Math.abs(Nt.z)+Math.abs(Nt.w)>Math.abs(Gt.z)+Math.abs(Gt.w),ki=oi?Gt:Nt,Li=oi?Nt:Gt,Vi=Math.abs(Li.z)>Math.abs(Li.w)?ki.z/Li.z:ki.w/Li.w,qi=Li.timesScalar(Vi).minus(ki);t.push(new Ray2(Ai,new Vector2(qi.x,qi.y).normalized()))}}}}),t},getLinesForDegenerateConic=a=>{const t=getRank1DegenerateConicMatrix(a);return[getNonzeroRow(t),getNonzeroColumn(t)]},lineIntersect=(a,t)=>{const s=a[0],r=a[1],o=a[2],n=t[0],l=t[1],h=t[2],g=n.times(r).minus(s.times(l));if(g.equalsEpsilon(Complex.ZERO,1e-8))return null;{const d=l.times(o).minus(r.times(h)).dividedBy(g);let A;if(!r.equalsEpsilon(Complex.ZERO,1e-8))A=s.negated().times(d).minus(o).dividedBy(r);else if(!l.equalsEpsilon(Complex.ZERO,1e-8))A=n.negated().times(d).minus(h).dividedBy(l);else return null;return Math.abs(d.imaginary)<1e-8&&Math.abs(A.imaginary)<1e-8?new Vector2(d.real,A.real):null}},intersectConicMatrices=(a,t)=>{const s=a.m00(),r=a.m01(),o=a.m02(),n=a.m10(),l=a.m11(),h=a.m12(),g=a.m20(),d=a.m21(),A=a.m22(),S=t.m00(),O=t.m01(),I=t.m02(),W=t.m10(),L=t.m11(),H=t.m12(),Y=t.m20(),Q=t.m21(),pe=t.m22(),de=-o*l*g+r*h*g+o*n*d-s*h*d-r*n*A+s*l*A,fe=-n*A*O+n*d*I+o*d*W-r*A*W-o*g*L+s*A*L+r*g*H-s*d*H+o*n*Q+h*(-d*S+g*O+r*Y-s*Q)-r*n*pe+l*(A*S-g*I-o*Y+s*pe),ye=-A*O*W+d*I*W+A*S*L-g*I*L-d*S*H+g*O*H+h*O*Y-l*I*Y-o*L*Y+r*H*Y-h*S*Q+n*I*Q+o*W*Q-s*H*Q+l*S*pe-n*O*pe-r*W*pe+s*L*pe,Ee=-I*L*Y+O*H*Y+I*W*Q-S*H*Q-O*W*pe+S*L*pe,Le=Complex.solveCubicRoots(Complex.real(de),Complex.real(fe),Complex.real(ye),Complex.real(Ee));if(!Le||Le.length===0)return{degenerateConicMatrices:[],intersectionCollections:[],points:[],lines:[]};const ne=_.uniqWith(Le,(Ct,zt)=>Ct.equals(zt)).map(Ct=>[Complex.real(s).multiply(Ct).add(Complex.real(S)),Complex.real(r).multiply(Ct).add(Complex.real(O)),Complex.real(o).multiply(Ct).add(Complex.real(I)),Complex.real(n).multiply(Ct).add(Complex.real(W)),Complex.real(l).multiply(Ct).add(Complex.real(L)),Complex.real(h).multiply(Ct).add(Complex.real(H)),Complex.real(g).multiply(Ct).add(Complex.real(Y)),Complex.real(d).multiply(Ct).add(Complex.real(Q)),Complex.real(A).multiply(Ct).add(Complex.real(pe))]);console.log("determinant magnitudes",ne.map(Ct=>getDeterminant(Ct).magnitude));const Ke=[],_t=ne.map(getLinesForDegenerateConic);console.log(_t);const xe=ne.map(getRealIntersectionsForDegenerateConic);console.log(xe);for(let Ct=0;Ct<_t.length;Ct++){const zt=_t[Ct],Je=lineIntersect(zt[0],zt[1]);Je&&Ke.push(Je);for(let Et=Ct+1;Et<_t.length;Et++){const ht=_t[Et],mt=[lineIntersect(zt[0],ht[0]),lineIntersect(zt[0],ht[1]),lineIntersect(zt[1],ht[0]),lineIntersect(zt[1],ht[1])];for(let Nt=0;Nt<4;Nt++){const Gt=mt[Nt];Gt&&Ke.push(Gt)}}}return{points:Ke,degenerateConicMatrices:ne,lines:_.flatten(_t),intersectionCollections:xe}};kite.register("intersectConicMatrices",intersectConicMatrices);function quote(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}const result={parse:function(a,t){const s={svgPath:h,movetoDrawtoCommandGroups:g,movetoDrawtoCommandGroup:d,drawtoCommands:A,drawtoCommand:S,moveto:O,movetoArgumentSequence:I,closepath:W,lineto:L,linetoArgumentSequence:H,horizontalLineto:Y,horizontalLinetoArgumentSequence:Q,verticalLineto:pe,verticalLinetoArgumentSequence:de,curveto:fe,curvetoArgumentSequence:ye,curvetoArgument:Ee,smoothCurveto:Le,smoothCurvetoArgumentSequence:Z,smoothCurvetoArgument:ne,quadraticBezierCurveto:Ke,quadraticBezierCurvetoArgumentSequence:_t,quadraticBezierCurvetoArgument:xe,smoothQuadraticBezierCurveto:Ct,smoothQuadraticBezierCurvetoArgumentSequence:zt,ellipticalArc:Je,ellipticalArcArgumentSequence:Et,ellipticalArcArgument:ht,coordinatePair:mt,nonnegativeNumber:Nt,number:Gt,flag:Mt,commaWsp:jt,comma:Ai,floatingPointConstant:oi,fractionalConstant:ki,exponent:Li,sign:Wi,digitSequence:Vi,digit:qi,wsp:Kt};if(t!==void 0){if(s[t]===void 0)throw new Error("Invalid rule name: "+quote(t)+".")}else t="svgPath";let r=0,o=0,n=[];function l(K){r<o||(r>o&&(o=r,n=[]),n.push(K))}function h(){let K,He,We,it,et,Ie;for(et=r,Ie=r,K=[],He=Kt();He!==null;)K.push(He),He=Kt();if(K!==null)if(He=g(),He=He!==null?He:"",He!==null){for(We=[],it=Kt();it!==null;)We.push(it),it=Kt();We!==null?K=[K,He,We]:(K=null,r=Ie)}else K=null,r=Ie;else K=null,r=Ie;return K!==null&&(K=function(Ve,Me){return Me||[]}(et,K[1])),K===null&&(r=et),K}function g(){let K,He,We,it,et;if(it=r,et=r,K=d(),K!==null){for(He=[],We=Kt();We!==null;)He.push(We),We=Kt();He!==null?(We=g(),We!==null?K=[K,He,We]:(K=null,r=et)):(K=null,r=et)}else K=null,r=et;return K!==null&&(K=function(Ie,Ve,Me){return Ve.concat(Me)}(it,K[0],K[2])),K===null&&(r=it),K===null&&(it=r,K=d(),K!==null&&(K=function(Ie,Ve){return Ve}(it,K)),K===null&&(r=it)),K}function d(){let K,He,We,it,et;if(it=r,et=r,K=O(),K!==null){for(He=[],We=Kt();We!==null;)He.push(We),We=Kt();He!==null?(We=A(),We=We!==null?We:"",We!==null?K=[K,He,We]:(K=null,r=et)):(K=null,r=et)}else K=null,r=et;return K!==null&&(K=function(Ie,Ve,Me){return Me.length?Ve.concat(Me):Ve}(it,K[0],K[2])),K===null&&(r=it),K}function A(){let K,He,We,it,et;if(it=r,et=r,K=S(),K!==null){for(He=[],We=Kt();We!==null;)He.push(We),We=Kt();He!==null?(We=A(),We!==null?K=[K,He,We]:(K=null,r=et)):(K=null,r=et)}else K=null,r=et;return K!==null&&(K=function(Ie,Ve,Me){return Ve.concat(Me)}(it,K[0],K[2])),K===null&&(r=it),K===null&&(it=r,K=S(),K!==null&&(K=function(Ie,Ve){return Ve}(it,K)),K===null&&(r=it)),K}function S(){let K;return K=W(),K===null&&(K=L(),K===null&&(K=Y(),K===null&&(K=pe(),K===null&&(K=fe(),K===null&&(K=Le(),K===null&&(K=Ke(),K===null&&(K=Ct(),K===null&&(K=Je())))))))),K}function O(){let K,He,We,it,et;if(it=r,et=r,a.charCodeAt(r)===77?(K="M",r++):(K=null,l('"M"')),K!==null){for(He=[],We=Kt();We!==null;)He.push(We),We=Kt();He!==null?(We=I(),We!==null?K=[K,He,We]:(K=null,r=et)):(K=null,r=et)}else K=null,r=et;if(K!==null&&(K=function(Ie,Ve){return gs(Ve,!1)}(it,K[2])),K===null&&(r=it),K===null){if(it=r,et=r,a.charCodeAt(r)===109?(K="m",r++):(K=null,l('"m"')),K!==null){for(He=[],We=Kt();We!==null;)He.push(We),We=Kt();He!==null?(We=I(),We!==null?K=[K,He,We]:(K=null,r=et)):(K=null,r=et)}else K=null,r=et;K!==null&&(K=function(Ie,Ve){return gs(Ve,!0)}(it,K[2])),K===null&&(r=it)}return K}function I(){let K,He,We,it,et;return it=r,et=r,K=mt(),K!==null?(He=jt(),He=He!==null?He:"",He!==null?(We=H(),We!==null?K=[K,He,We]:(K=null,r=et)):(K=null,r=et)):(K=null,r=et),K!==null&&(K=function(Ie,Ve,Me){return[Ve].concat(Me)}(it,K[0],K[2])),K===null&&(r=it),K===null&&(it=r,K=mt(),K!==null&&(K=function(Ie,Ve){return[Ve]}(it,K)),K===null&&(r=it)),K}function W(){let K,He;return He=r,a.charCodeAt(r)===90?(K="Z",r++):(K=null,l('"Z"')),K===null&&(a.charCodeAt(r)===122?(K="z",r++):(K=null,l('"z"'))),K!==null&&(K=function(We,it){return{cmd:"close"}}()),K===null&&(r=He),K}function L(){let K,He,We,it,et;if(it=r,et=r,a.charCodeAt(r)===76?(K="L",r++):(K=null,l('"L"')),K!==null){for(He=[],We=Kt();We!==null;)He.push(We),We=Kt();He!==null?(We=H(),We!==null?K=[K,He,We]:(K=null,r=et)):(K=null,r=et)}else K=null,r=et;if(K!==null&&(K=function(Ie,Ve){return Ve.map(Me=>({cmd:"lineTo",args:[Me.x,Me.y]}))}(it,K[2])),K===null&&(r=it),K===null){if(it=r,et=r,a.charCodeAt(r)===108?(K="l",r++):(K=null,l('"l"')),K!==null){for(He=[],We=Kt();We!==null;)He.push(We),We=Kt();He!==null?(We=H(),We!==null?K=[K,He,We]:(K=null,r=et)):(K=null,r=et)}else K=null,r=et;K!==null&&(K=function(Ie,Ve){return Ve.map(Me=>({cmd:"lineToRelative",args:[Me.x,Me.y]}))}(it,K[2])),K===null&&(r=it)}return K}function H(){let K,He,We,it,et;return it=r,et=r,K=mt(),K!==null?(He=jt(),He=He!==null?He:"",He!==null?(We=H(),We!==null?K=[K,He,We]:(K=null,r=et)):(K=null,r=et)):(K=null,r=et),K!==null&&(K=function(Ie,Ve,Me){return[Ve].concat(Me)}(it,K[0],K[2])),K===null&&(r=it),K===null&&(it=r,K=mt(),K!==null&&(K=function(Ie,Ve){return[Ve]}(it,K)),K===null&&(r=it)),K}function Y(){let K,He,We,it,et;if(it=r,et=r,a.charCodeAt(r)===72?(K="H",r++):(K=null,l('"H"')),K!==null){for(He=[],We=Kt();We!==null;)He.push(We),We=Kt();He!==null?(We=Q(),We!==null?K=[K,He,We]:(K=null,r=et)):(K=null,r=et)}else K=null,r=et;if(K!==null&&(K=function(Ie,Ve){return Ve.map(Me=>({cmd:"horizontalLineTo",args:[Me]}))}(it,K[2])),K===null&&(r=it),K===null){if(it=r,et=r,a.charCodeAt(r)===104?(K="h",r++):(K=null,l('"h"')),K!==null){for(He=[],We=Kt();We!==null;)He.push(We),We=Kt();He!==null?(We=Q(),We!==null?K=[K,He,We]:(K=null,r=et)):(K=null,r=et)}else K=null,r=et;K!==null&&(K=function(Ie,Ve){return Ve.map(Me=>({cmd:"horizontalLineToRelative",args:[Me]}))}(it,K[2])),K===null&&(r=it)}return K}function Q(){let K,He,We,it,et;return it=r,et=r,K=Gt(),K!==null?(He=jt(),He=He!==null?He:"",He!==null?(We=Q(),We!==null?K=[K,He,We]:(K=null,r=et)):(K=null,r=et)):(K=null,r=et),K!==null&&(K=function(Ie,Ve,Me){return[Ve].concat(Me)}(it,K[0],K[2])),K===null&&(r=it),K===null&&(it=r,K=Gt(),K!==null&&(K=function(Ie,Ve){return[Ve]}(it,K)),K===null&&(r=it)),K}function pe(){let K,He,We,it,et;if(it=r,et=r,a.charCodeAt(r)===86?(K="V",r++):(K=null,l('"V"')),K!==null){for(He=[],We=Kt();We!==null;)He.push(We),We=Kt();He!==null?(We=de(),We!==null?K=[K,He,We]:(K=null,r=et)):(K=null,r=et)}else K=null,r=et;if(K!==null&&(K=function(Ie,Ve){return Ve.map(Me=>({cmd:"verticalLineTo",args:[Me]}))}(it,K[2])),K===null&&(r=it),K===null){if(it=r,et=r,a.charCodeAt(r)===118?(K="v",r++):(K=null,l('"v"')),K!==null){for(He=[],We=Kt();We!==null;)He.push(We),We=Kt();He!==null?(We=de(),We!==null?K=[K,He,We]:(K=null,r=et)):(K=null,r=et)}else K=null,r=et;K!==null&&(K=function(Ie,Ve){return Ve.map(Me=>({cmd:"verticalLineToRelative",args:[Me]}))}(it,K[2])),K===null&&(r=it)}return K}function de(){let K,He,We,it,et;return it=r,et=r,K=Gt(),K!==null?(He=jt(),He=He!==null?He:"",He!==null?(We=de(),We!==null?K=[K,He,We]:(K=null,r=et)):(K=null,r=et)):(K=null,r=et),K!==null&&(K=function(Ie,Ve,Me){return[Ve].concat(Me)}(it,K[0],K[2])),K===null&&(r=it),K===null&&(it=r,K=Gt(),K!==null&&(K=function(Ie,Ve){return[Ve]}(it,K)),K===null&&(r=it)),K}function fe(){let K,He,We,it,et;if(it=r,et=r,a.charCodeAt(r)===67?(K="C",r++):(K=null,l('"C"')),K!==null){for(He=[],We=Kt();We!==null;)He.push(We),We=Kt();He!==null?(We=ye(),We!==null?K=[K,He,We]:(K=null,r=et)):(K=null,r=et)}else K=null,r=et;if(K!==null&&(K=function(Ie,Ve){return Ve.map(Me=>({cmd:"cubicCurveTo",args:Me}))}(it,K[2])),K===null&&(r=it),K===null){if(it=r,et=r,a.charCodeAt(r)===99?(K="c",r++):(K=null,l('"c"')),K!==null){for(He=[],We=Kt();We!==null;)He.push(We),We=Kt();He!==null?(We=ye(),We!==null?K=[K,He,We]:(K=null,r=et)):(K=null,r=et)}else K=null,r=et;K!==null&&(K=function(Ie,Ve){return Ve.map(Me=>({cmd:"cubicCurveToRelative",args:Me}))}(it,K[2])),K===null&&(r=it)}return K}function ye(){let K,He,We,it,et;return it=r,et=r,K=Ee(),K!==null?(He=jt(),He=He!==null?He:"",He!==null?(We=ye(),We!==null?K=[K,He,We]:(K=null,r=et)):(K=null,r=et)):(K=null,r=et),K!==null&&(K=function(Ie,Ve,Me){return[Ve].concat(Me)}(it,K[0],K[2])),K===null&&(r=it),K===null&&(it=r,K=Ee(),K!==null&&(K=function(Ie,Ve){return[Ve]}(it,K)),K===null&&(r=it)),K}function Ee(){let K,He,We,it,et,Ie,Ve;return Ie=r,Ve=r,K=mt(),K!==null?(He=jt(),He=He!==null?He:"",He!==null?(We=mt(),We!==null?(it=jt(),it=it!==null?it:"",it!==null?(et=mt(),et!==null?K=[K,He,We,it,et]:(K=null,r=Ve)):(K=null,r=Ve)):(K=null,r=Ve)):(K=null,r=Ve)):(K=null,r=Ve),K!==null&&(K=function(Me,yt,u,y){return[yt.x,yt.y,u.x,u.y,y.x,y.y]}(Ie,K[0],K[2],K[4])),K===null&&(r=Ie),K}function Le(){let K,He,We,it,et;if(it=r,et=r,a.charCodeAt(r)===83?(K="S",r++):(K=null,l('"S"')),K!==null){for(He=[],We=Kt();We!==null;)He.push(We),We=Kt();He!==null?(We=Z(),We!==null?K=[K,He,We]:(K=null,r=et)):(K=null,r=et)}else K=null,r=et;if(K!==null&&(K=function(Ie,Ve){return Ve.map(Me=>({cmd:"smoothCubicCurveTo",args:Me}))}(it,K[2])),K===null&&(r=it),K===null){if(it=r,et=r,a.charCodeAt(r)===115?(K="s",r++):(K=null,l('"s"')),K!==null){for(He=[],We=Kt();We!==null;)He.push(We),We=Kt();He!==null?(We=Z(),We!==null?K=[K,He,We]:(K=null,r=et)):(K=null,r=et)}else K=null,r=et;K!==null&&(K=function(Ie,Ve){return Ve.map(Me=>({cmd:"smoothCubicCurveToRelative",args:Me}))}(it,K[2])),K===null&&(r=it)}return K}function Z(){let K,He,We,it,et;return it=r,et=r,K=ne(),K!==null?(He=jt(),He=He!==null?He:"",He!==null?(We=Z(),We!==null?K=[K,He,We]:(K=null,r=et)):(K=null,r=et)):(K=null,r=et),K!==null&&(K=function(Ie,Ve,Me){return[Ve].concat(Me)}(it,K[0],K[2])),K===null&&(r=it),K===null&&(it=r,K=ne(),K!==null&&(K=function(Ie,Ve){return[Ve]}(it,K)),K===null&&(r=it)),K}function ne(){let K,He,We,it,et;return it=r,et=r,K=mt(),K!==null?(He=jt(),He=He!==null?He:"",He!==null?(We=mt(),We!==null?K=[K,He,We]:(K=null,r=et)):(K=null,r=et)):(K=null,r=et),K!==null&&(K=function(Ie,Ve,Me){return[Ve.x,Ve.y,Me.x,Me.y]}(it,K[0],K[2])),K===null&&(r=it),K}function Ke(){let K,He,We,it,et;if(it=r,et=r,a.charCodeAt(r)===81?(K="Q",r++):(K=null,l('"Q"')),K!==null){for(He=[],We=Kt();We!==null;)He.push(We),We=Kt();He!==null?(We=_t(),We!==null?K=[K,He,We]:(K=null,r=et)):(K=null,r=et)}else K=null,r=et;if(K!==null&&(K=function(Ie,Ve){return Ve.map(Me=>({cmd:"quadraticCurveTo",args:Me}))}(it,K[2])),K===null&&(r=it),K===null){if(it=r,et=r,a.charCodeAt(r)===113?(K="q",r++):(K=null,l('"q"')),K!==null){for(He=[],We=Kt();We!==null;)He.push(We),We=Kt();He!==null?(We=_t(),We!==null?K=[K,He,We]:(K=null,r=et)):(K=null,r=et)}else K=null,r=et;K!==null&&(K=function(Ie,Ve){return Ve.map(Me=>({cmd:"quadraticCurveToRelative",args:Me}))}(it,K[2])),K===null&&(r=it)}return K}function _t(){let K,He,We,it,et;return it=r,et=r,K=xe(),K!==null?(He=jt(),He=He!==null?He:"",He!==null?(We=_t(),We!==null?K=[K,He,We]:(K=null,r=et)):(K=null,r=et)):(K=null,r=et),K!==null&&(K=function(Ie,Ve,Me){return[Ve].concat(Me)}(it,K[0],K[2])),K===null&&(r=it),K===null&&(it=r,K=xe(),K!==null&&(K=function(Ie,Ve){return[Ve]}(it,K)),K===null&&(r=it)),K}function xe(){let K,He,We,it,et;return it=r,et=r,K=mt(),K!==null?(He=jt(),He=He!==null?He:"",He!==null?(We=mt(),We!==null?K=[K,He,We]:(K=null,r=et)):(K=null,r=et)):(K=null,r=et),K!==null&&(K=function(Ie,Ve,Me){return[Ve.x,Ve.y,Me.x,Me.y]}(it,K[0],K[2])),K===null&&(r=it),K}function Ct(){let K,He,We,it,et;if(it=r,et=r,a.charCodeAt(r)===84?(K="T",r++):(K=null,l('"T"')),K!==null){for(He=[],We=Kt();We!==null;)He.push(We),We=Kt();He!==null?(We=zt(),We!==null?K=[K,He,We]:(K=null,r=et)):(K=null,r=et)}else K=null,r=et;if(K!==null&&(K=function(Ie,Ve){return Ve.map(Me=>({cmd:"smoothQuadraticCurveTo",args:[Me.x,Me.y]}))}(it,K[2])),K===null&&(r=it),K===null){if(it=r,et=r,a.charCodeAt(r)===116?(K="t",r++):(K=null,l('"t"')),K!==null){for(He=[],We=Kt();We!==null;)He.push(We),We=Kt();He!==null?(We=zt(),We!==null?K=[K,He,We]:(K=null,r=et)):(K=null,r=et)}else K=null,r=et;K!==null&&(K=function(Ie,Ve){return Ve.map(Me=>({cmd:"smoothQuadraticCurveToRelative",args:[Me.x,Me.y]}))}(it,K[2])),K===null&&(r=it)}return K}function zt(){let K,He,We,it,et;return it=r,et=r,K=mt(),K!==null?(He=jt(),He=He!==null?He:"",He!==null?(We=zt(),We!==null?K=[K,He,We]:(K=null,r=et)):(K=null,r=et)):(K=null,r=et),K!==null&&(K=function(Ie,Ve,Me){return[Ve].concat(Me)}(it,K[0],K[2])),K===null&&(r=it),K===null&&(it=r,K=mt(),K!==null&&(K=function(Ie,Ve){return[Ve]}(it,K)),K===null&&(r=it)),K}function Je(){let K,He,We,it,et;if(it=r,et=r,a.charCodeAt(r)===65?(K="A",r++):(K=null,l('"A"')),K!==null){for(He=[],We=Kt();We!==null;)He.push(We),We=Kt();He!==null?(We=Et(),We!==null?K=[K,He,We]:(K=null,r=et)):(K=null,r=et)}else K=null,r=et;if(K!==null&&(K=function(Ie,Ve){return Ve.map(Me=>(Me[2]*=Math.PI/180,{cmd:"ellipticalArcTo",args:Me}))}(it,K[2])),K===null&&(r=it),K===null){if(it=r,et=r,a.charCodeAt(r)===97?(K="a",r++):(K=null,l('"a"')),K!==null){for(He=[],We=Kt();We!==null;)He.push(We),We=Kt();He!==null?(We=Et(),We!==null?K=[K,He,We]:(K=null,r=et)):(K=null,r=et)}else K=null,r=et;K!==null&&(K=function(Ie,Ve){return Ve.map(Me=>(Me[2]*=Math.PI/180,{cmd:"ellipticalArcToRelative",args:Me}))}(it,K[2])),K===null&&(r=it)}return K}function Et(){let K,He,We,it,et;return it=r,et=r,K=ht(),K!==null?(He=jt(),He=He!==null?He:"",He!==null?(We=Et(),We!==null?K=[K,He,We]:(K=null,r=et)):(K=null,r=et)):(K=null,r=et),K!==null&&(K=function(Ie,Ve,Me){return[Ve].concat(Me)}(it,K[0],K[2])),K===null&&(r=it),K===null&&(it=r,K=ht(),K!==null&&(K=function(Ie,Ve){return[Ve]}(it,K)),K===null&&(r=it)),K}function ht(){let K,He,We,it,et,Ie,Ve,Me,yt,u,y,w,D;return w=r,D=r,K=Nt(),K!==null?(He=jt(),He=He!==null?He:"",He!==null?(We=Nt(),We!==null?(it=jt(),it=it!==null?it:"",it!==null?(et=Gt(),et!==null?(Ie=jt(),Ie!==null?(Ve=Mt(),Ve!==null?(Me=jt(),Me=Me!==null?Me:"",Me!==null?(yt=Mt(),yt!==null?(u=jt(),u=u!==null?u:"",u!==null?(y=mt(),y!==null?K=[K,He,We,it,et,Ie,Ve,Me,yt,u,y]:(K=null,r=D)):(K=null,r=D)):(K=null,r=D)):(K=null,r=D)):(K=null,r=D)):(K=null,r=D)):(K=null,r=D)):(K=null,r=D)):(K=null,r=D)):(K=null,r=D)):(K=null,r=D),K!==null&&(K=function(N,U,te,J,ie,ae,ve){return[U,te,J,ie,ae,ve.x,ve.y]}(w,K[0],K[2],K[4],K[6],K[8],K[10])),K===null&&(r=w),K}function mt(){let K,He,We,it,et;return it=r,et=r,K=Gt(),K!==null?(He=jt(),He=He!==null?He:"",He!==null?(We=Gt(),We!==null?K=[K,He,We]:(K=null,r=et)):(K=null,r=et)):(K=null,r=et),K!==null&&(K=function(Ie,Ve,Me){return{x:Ve,y:Me}}(it,K[0],K[2])),K===null&&(r=it),K}function Nt(){let K,He;return He=r,K=oi(),K!==null&&(K=function(We,it){return parseFloat(it)}(He,K)),K===null&&(r=He),K===null&&(He=r,K=Vi(),K!==null&&(K=function(We,it){return Number(it)}(He,K)),K===null&&(r=He)),K}function Gt(){let K,He,We,it;return We=r,it=r,K=Wi(),K=K!==null?K:"",K!==null?(He=oi(),He!==null?K=[K,He]:(K=null,r=it)):(K=null,r=it),K!==null&&(K=function(et,Ie,Ve){return parseFloat(Ie+Ve)}(We,K[0],K[1])),K===null&&(r=We),K===null&&(We=r,it=r,K=Wi(),K=K!==null?K:"",K!==null?(He=Vi(),He!==null?K=[K,He]:(K=null,r=it)):(K=null,r=it),K!==null&&(K=function(et,Ie,Ve){return Number(Ie+Ve)}(We,K[0],K[1])),K===null&&(r=We)),K}function Mt(){let K,He;return He=r,a.charCodeAt(r)===48?(K="0",r++):(K=null,l('"0"')),K!==null&&(K=function(We){return!1}()),K===null&&(r=He),K===null&&(He=r,a.charCodeAt(r)===49?(K="1",r++):(K=null,l('"1"')),K!==null&&(K=function(We){return!0}()),K===null&&(r=He)),K}function jt(){let K,He,We,it,et;if(et=r,He=Kt(),He!==null)for(K=[];He!==null;)K.push(He),He=Kt();else K=null;if(K!==null)if(He=Ai(),He=He!==null?He:"",He!==null){for(We=[],it=Kt();it!==null;)We.push(it),it=Kt();We!==null?K=[K,He,We]:(K=null,r=et)}else K=null,r=et;else K=null,r=et;if(K===null)if(et=r,K=Ai(),K!==null){for(He=[],We=Kt();We!==null;)He.push(We),We=Kt();He!==null?K=[K,He]:(K=null,r=et)}else K=null,r=et;return K}function Ai(){let K;return a.charCodeAt(r)===44?(K=",",r++):(K=null,l('","')),K}function oi(){let K,He,We,it;return We=r,it=r,K=ki(),K!==null?(He=Li(),He=He!==null?He:"",He!==null?K=[K,He]:(K=null,r=it)):(K=null,r=it),K!==null&&(K=function(et,Ie,Ve){return Ie+Ve}(We,K[0],K[1])),K===null&&(r=We),K===null&&(We=r,it=r,K=Vi(),K!==null?(He=Li(),He!==null?K=[K,He]:(K=null,r=it)):(K=null,r=it),K!==null&&(K=function(et,Ie,Ve){return Ie+Ve}(We,K[0],K[1])),K===null&&(r=We)),K}function ki(){let K,He,We,it,et;return it=r,et=r,K=Vi(),K=K!==null?K:"",K!==null?(a.charCodeAt(r)===46?(He=".",r++):(He=null,l('"."')),He!==null?(We=Vi(),We!==null?K=[K,He,We]:(K=null,r=et)):(K=null,r=et)):(K=null,r=et),K!==null&&(K=function(Ie,Ve,Me){return Ve+"."+Me}(it,K[0],K[2])),K===null&&(r=it),K===null&&(it=r,et=r,K=Vi(),K!==null?(a.charCodeAt(r)===46?(He=".",r++):(He=null,l('"."')),He!==null?K=[K,He]:(K=null,r=et)):(K=null,r=et),K!==null&&(K=function(Ie,Ve){return Ve}(it,K[0])),K===null&&(r=it)),K}function Li(){let K,He,We,it,et;return it=r,et=r,a.charCodeAt(r)===101?(K="e",r++):(K=null,l('"e"')),K===null&&(a.charCodeAt(r)===69?(K="E",r++):(K=null,l('"E"'))),K!==null?(He=Wi(),He=He!==null?He:"",He!==null?(We=Vi(),We!==null?K=[K,He,We]:(K=null,r=et)):(K=null,r=et)):(K=null,r=et),K!==null&&(K=function(Ie,Ve,Me,yt){return Ve+Me+yt}(it,K[0],K[1],K[2])),K===null&&(r=it),K}function Wi(){let K;return a.charCodeAt(r)===43?(K="+",r++):(K=null,l('"+"')),K===null&&(a.charCodeAt(r)===45?(K="-",r++):(K=null,l('"-"'))),K}function Vi(){let K,He,We,it;return We=r,it=r,K=qi(),K!==null?(He=Vi(),He!==null?K=[K,He]:(K=null,r=it)):(K=null,r=it),K!==null&&(K=function(et,Ie,Ve){return Ie+Ve}(We,K[0],K[1])),K===null&&(r=We),K===null&&(K=qi()),K}function qi(){let K;return/^[0-9]/.test(a.charAt(r))?(K=a.charAt(r),r++):(K=null,l("[0-9]")),K}function Kt(){let K;return a.charCodeAt(r)===32?(K=" ",r++):(K=null,l('" "')),K===null&&(a.charCodeAt(r)===9?(K="	",r++):(K=null,l('"\\t"')),K===null&&(a.charCodeAt(r)===13?(K="\r",r++):(K=null,l('"\\r"')),K===null&&(a.charCodeAt(r)===10?(K=`
`,r++):(K=null,l('"\\n"'))))),K}function zs(K){K.sort();let He=null;const We=[];for(let it=0;it<K.length;it++)K[it]!==He&&(We.push(K[it]),He=K[it]);return We}function ls(){let K=1,He=1,We=!1;for(let it=0;it<Math.max(r,o);it++){const et=a.charAt(it);et===`
`?(We||K++,He=1,We=!1):et==="\r"||et==="\u2028"||et==="\u2029"?(K++,He=1,We=!0):(He++,We=!1)}return{line:K,column:He}}function gs(K,He){const We=[{cmd:He?"moveToRelative":"moveTo",args:[K[0].x,K[0].y]}];if(K.length>1)for(let it=1;it<K.length;it++)We.push({cmd:He?"lineToRelative":"lineTo",args:[K[it].x,K[it].y]});return We}const Ws=s[t]();if(Ws===null||r!==a.length){const K=Math.max(r,o),He=K<a.length?a.charAt(K):null,We=ls();throw new this.SyntaxError(zs(n),He,K,We.line,We.column)}return Ws},toSource:function(){return this._source}};result.SyntaxError=function(a,t,s,r,o){function n(l,h){let g,d;switch(l.length){case 0:g="end of input";break;case 1:g=l[0];break;default:g=l.slice(0,l.length-1).join(", ")+" or "+l[l.length-1]}return d=h?quote(h):"end of input","Expected "+g+" but "+d+" found."}this.name="SyntaxError",this.expected=a,this.found=t,this.message=n(a,t),this.offset=s,this.line=r,this.column=o};result.SyntaxError.prototype=Error.prototype;kite.register("svgPath",result);const svgPath=kite.svgPath;class Segment{constructor(){this.invalidationEmitter=new TinyEmitter}areStrokedBoundsDilated(){return Math.abs(this.startTangent.x*this.startTangent.y)<1e-7&&Math.abs(this.endTangent.x*this.endTangent.y)<1e-7}getBoundsWithTransform(t){return this.transformed(t).getBounds()}slice(t,s){assert&&assert(t>=0&&t<=1&&s>=0&&s<=1,"Parametric value out of range"),assert&&assert(t<s);let r=this;return s<1&&(r=r.subdivided(s)[0]),t>0&&(r=r.subdivided(DotUtils.linear(0,s,0,1,t))[1]),r}subdivisions(t){let s=this;const r=[];for(let o=0;o<t.length;o++){const n=t[o],l=s.subdivided(n);assert&&assert(l.length===2),r.push(l[0]),s=l[1];for(let h=o+1;h<t.length;h++)t[h]=DotUtils.linear(n,1,0,1,t[h])}return r.push(s),r}subdividedIntoMonotone(){return this.subdivisions(this.getInteriorExtremaTs())}isSufficientlyFlat(t,s){const r=this.start,o=this.positionAt(.5),n=this.end;return Segment.isSufficientlyFlat(t,s,r,o,n)}getArcLength(t,s,r){if(t=t===void 0?1e-10:t,s=s===void 0?1e-8:s,r=r===void 0?15:r,r<=0||this.isSufficientlyFlat(t,s))return this.start.distance(this.end);{const o=this.subdivided(.5);return o[0].getArcLength(t,s,r-1)+o[1].getArcLength(t,s,r-1)}}getDashValues(t,s,r,o){assert&&assert(t.length>0,"Do not call with an empty dash array");const n=this,l=[];let h=0;const g=_.sum(t);s=s%g,s<0&&(s+=g);let d=0,A=0,S=!0;function O(){d=(d+1)%t.length,S=!S}for(;s>0;)s>=t[d]?(s-=t[d],O()):(A=s,s=0);const I=S;return function W(L,H,Y,Q,pe){const de=(L+H)/2,fe=n.positionAt(de);if(pe>14||Segment.isSufficientlyFlat(r,o,Y,fe,Q)){const ye=Y.distance(fe)+fe.distance(Q);h+=ye;let Ee=ye;for(;A+Ee>=t[d];){const Le=DotUtils.linear(0,ye,L,H,ye-Ee+t[d]-A);l.push(Le),Ee-=t[d]-A,A=0,O()}A=A+Ee}else W(L,de,Y,fe,pe+1),W(de,H,fe,Q,pe+1)}(0,1,this.start,this.end,0),{values:l,arcLength:h,initiallyInside:I}}toPiecewiseLinearSegments(t,s,r,o,n,l){s=s===void 0?t.minLevels:s,r=r===void 0?t.maxLevels:r,o=o||[];const h=t.pointMap||_.identity;n=n||h(this.start),l=l||h(this.end);const g=h(this.positionAt(.5));assert&&assert(s<=r),assert&&assert(t.distanceEpsilon===null||typeof t.distanceEpsilon=="number"),assert&&assert(t.curveEpsilon===null||typeof t.curveEpsilon=="number"),assert&&assert(!h||typeof h=="function");let d=r===0;if(!d&&s<=0&&(d=this.isSufficientlyFlat(t.distanceEpsilon===null||t.distanceEpsilon===void 0?Number.POSITIVE_INFINITY:t.distanceEpsilon,t.curveEpsilon===null||t.curveEpsilon===void 0?Number.POSITIVE_INFINITY:t.curveEpsilon)),d)o.push(new Line$1(n,l));else{const A=this.subdivided(.5);A[0].toPiecewiseLinearSegments(t,s-1,r-1,o,n,g),A[1].toPiecewiseLinearSegments(t,s-1,r-1,o,g,l)}return o}toPiecewiseLinearOrArcSegments(t){const s=optionize()({minLevels:2,maxLevels:7,curvatureThreshold:.02,errorThreshold:10,errorPoints:[.25,.75]},t),r=[];return this.toPiecewiseLinearOrArcRecursion(s,s.minLevels,s.maxLevels,r,0,1,this.positionAt(0),this.positionAt(1),this.curvatureAt(0),this.curvatureAt(1)),r}toPiecewiseLinearOrArcRecursion(t,s,r,o,n,l,h,g,d,A){const S=(n+l)/2,O=this.positionAt(S),I=this.curvatureAt(S);if(r<=0||s<=0&&Math.abs(d-I)+Math.abs(I-A)<t.curvatureThreshold*2){const W=Arc.createFromPoints(h,O,g);let L=!1;if(W instanceof Arc){const H=W.radius*W.radius;for(let Y=0;Y<t.errorPoints.length;Y++){const Q=t.errorPoints[Y],pe=this.positionAt(n*(1-Q)+l*Q);if(Math.abs(pe.distanceSquared(W.center)-H)>t.errorThreshold){L=!0;break}}}if(!L){o.push(W);return}}this.toPiecewiseLinearOrArcRecursion(t,s-1,r-1,o,n,S,h,O,d,I),this.toPiecewiseLinearOrArcRecursion(t,s-1,r-1,o,S,l,O,g,I,A)}toShape(){return new Shape$1([new Subpath$1([this])])}getClosestPoints(t){return Segment.closestToPoint([this],t,1e-7)}static closestToPoint(t,s,r){const o=r*r;let n=[],l=[],h=Number.POSITIVE_INFINITY,g=!1;for(_.each(t,d=>{if(d instanceof Line$1){const A=d.explicitClosestToPoint(s);_.each(A,S=>{S.distanceSquared<h?(l=[S],h=S.distanceSquared):S.distanceSquared===h&&l.push(S)})}else{const A=[0].concat(d.getInteriorExtremaTs()).concat([1]);for(let S=0;S<A.length-1;S++){const O=A[S],I=A[S+1],W=d.positionAt(O),L=d.positionAt(I),H=Bounds2.point(W).addPoint(L),Y=H.minimumDistanceToPointSquared(s);if(Y<=h){const Q=H.maximumDistanceToPointSquared(s);Q<h&&(h=Q,l=[]),n.push({ta:O,tb:I,pa:W,pb:L,segment:d,bounds:H,min:Y,max:Q})}}}});n.length&&!g;){const d=n;n=[],g=!0;for(const A of d){if(A.min>h)continue;g&&A.pa.distanceSquared(A.pb)>o&&(g=!1);const S=(A.ta+A.tb)/2,O=A.segment.positionAt(S),I=Bounds2.point(A.pa).addPoint(O),W=Bounds2.point(A.pb).addPoint(O),L=I.minimumDistanceToPointSquared(s),H=W.minimumDistanceToPointSquared(s);if(L<=h){const Y=I.maximumDistanceToPointSquared(s);Y<h&&(h=Y,l=[]),n.push({ta:A.ta,tb:S,pa:A.pa,pb:O,segment:A.segment,bounds:I,min:L,max:Y})}if(H<=h){const Y=W.maximumDistanceToPointSquared(s);Y<h&&(h=Y,l=[]),n.push({ta:S,tb:A.tb,pa:O,pb:A.pb,segment:A.segment,bounds:W,min:H,max:Y})}}}return _.each(n,d=>{const A=(d.ta+d.tb)/2,S=d.segment.positionAt(A);l.push({segment:d.segment,t:A,closestPoint:S,distanceSquared:s.distanceSquared(S)})}),l}static polynomialGetOverlapCubic(t,s,r,o,n,l,h,g){if(g===0)return Segment.polynomialGetOverlapQuadratic(t,s,r,n,l,h);const d=Math.sign(o/g)*Math.pow(Math.abs(o/g),1/3);if(d===0)return null;const A=(r-d*d*h)/(3*d*d*g);return{a:d,b:A}}static polynomialGetOverlapQuadratic(t,s,r,o,n,l){if(l===0)return Segment.polynomialGetOverlapLinear(t,s,o,n);if(r/l<0)return null;const g=Math.sqrt(r/l);if(g===0)return null;const d=(s-g*n)/(2*g*l);return{a:g,b:d}}static polynomialGetOverlapLinear(t,s,r,o){if(o===0)return t===r?!0:null;const n=s/o;if(n===0)return null;const l=(t-r)/o;return{a:n,b:l}}static intersect(t,s){if(Line$1&&t instanceof Line$1&&s instanceof Line$1)return Line$1.intersect(t,s);if(Line$1&&t instanceof Line$1)return Line$1.intersectOther(t,s);if(Line$1&&s instanceof Line$1)return Line$1.intersectOther(s,t).map(swapSegmentIntersection);if(Arc&&t instanceof Arc&&s instanceof Arc)return Arc.intersect(t,s);if(EllipticalArc&&t instanceof EllipticalArc&&s instanceof EllipticalArc)return EllipticalArc.intersect(t,s);if(Quadratic&&Cubic&&(t instanceof Quadratic||t instanceof Cubic)&&(s instanceof Quadratic||s instanceof Cubic)){const r=t instanceof Cubic?t:t.degreeElevated(),o=s instanceof Cubic?s:s.degreeElevated(),n=new paper.Curve(r.start.x,r.start.y,r.control1.x,r.control1.y,r.control2.x,r.control2.y,r.end.x,r.end.y),l=new paper.Curve(o.start.x,o.start.y,o.control1.x,o.control1.y,o.control2.x,o.control2.y,o.end.x,o.end.y);return n.getIntersections(l).map(g=>{const d=new Vector2(g.point.x,g.point.y);return new SegmentIntersection(d,g.time,g.intersection.time)})}else return BoundsIntersection.intersect(t,s)}static deserialize(t){return assert&&assert(t.type&&kite[t.type]&&kite[t.type].deserialize),kite[t.type].deserialize(t)}static isSufficientlyFlat(t,s,r,o,n){return!(DotUtils.distToSegmentSquared(o,r,n)/r.distanceSquared(n)>s||DotUtils.distToSegmentSquared(o,r,n)>t)}static filterClosestToPointResult(t){if(t.length===0)return[];const s=_.minBy(t,r=>r.distanceSquared).distanceSquared;return _.uniqWith(t.filter(r=>Math.abs(r.distanceSquared-s)<1e-11),(r,o)=>r.closestPoint.distanceSquared(o.closestPoint)<1e-11)}}kite.register("Segment",Segment);function swapSegmentIntersection(a){return a.getSwapped()}const scratchVector2$1=new Vector2(0,0);let Line$1=class Br extends Segment{constructor(t,s){super(),this._start=t,this._end=s,this.invalidate()}setStart(t){return assert&&assert(t.isFinite(),`Line start should be finite: ${t.toString()}`),this._start.equals(t)||(this._start=t,this.invalidate()),this}set start(t){this.setStart(t)}get start(){return this.getStart()}getStart(){return this._start}setEnd(t){return assert&&assert(t.isFinite(),`Line end should be finite: ${t.toString()}`),this._end.equals(t)||(this._end=t,this.invalidate()),this}set end(t){this.setEnd(t)}get end(){return this.getEnd()}getEnd(){return this._end}positionAt(t){return assert&&assert(t>=0,"positionAt t should be non-negative"),assert&&assert(t<=1,"positionAt t should be no greater than 1"),this._start.plus(this._end.minus(this._start).times(t))}tangentAt(t){return assert&&assert(t>=0,"tangentAt t should be non-negative"),assert&&assert(t<=1,"tangentAt t should be no greater than 1"),this.getStartTangent()}curvatureAt(t){return assert&&assert(t>=0,"curvatureAt t should be non-negative"),assert&&assert(t<=1,"curvatureAt t should be no greater than 1"),0}subdivided(t){if(assert&&assert(t>=0,"subdivided t should be non-negative"),assert&&assert(t<=1,"subdivided t should be no greater than 1"),t===0||t===1)return[this];const s=this.positionAt(t);return[new Br(this._start,s),new Br(s,this._end)]}invalidate(){assert&&assert(this._start instanceof Vector2,`Line start should be a Vector2: ${this._start}`),assert&&assert(this._start.isFinite(),`Line start should be finite: ${this._start.toString()}`),assert&&assert(this._end instanceof Vector2,`Line end should be a Vector2: ${this._end}`),assert&&assert(this._end.isFinite(),`Line end should be finite: ${this._end.toString()}`),this._tangent=null,this._bounds=null,this._svgPathFragment=null,this.invalidationEmitter.emit()}getStartTangent(){return this._tangent===null&&(this._tangent=this._end.minus(this._start).normalized()),this._tangent}get startTangent(){return this.getStartTangent()}getEndTangent(){return this.getStartTangent()}get endTangent(){return this.getEndTangent()}getBounds(){return this._bounds===null&&(this._bounds=Bounds2.NOTHING.copy().addPoint(this._start).addPoint(this._end)),this._bounds}get bounds(){return this.getBounds()}getBoundsWithTransform(t){const s=Bounds2.NOTHING.copy();return s.addPoint(t.multiplyVector2(scratchVector2$1.set(this._start))),s.addPoint(t.multiplyVector2(scratchVector2$1.set(this._end))),s}getNondegenerateSegments(){return this._start.equals(this._end)?[]:[this]}getSVGPathFragment(){let t;return assert&&(t=this._svgPathFragment,this._svgPathFragment=null),this._svgPathFragment||(this._svgPathFragment=`L ${svgNumber(this._end.x)} ${svgNumber(this._end.y)}`),assert&&t&&assert(t===this._svgPathFragment,"Quadratic line segment changed without invalidate()"),this._svgPathFragment}strokeLeft(t){const s=this.getEndTangent().perpendicular.negated().times(t/2);return[new Br(this._start.plus(s),this._end.plus(s))]}strokeRight(t){const s=this.getStartTangent().perpendicular.times(t/2);return[new Br(this._end.plus(s),this._start.plus(s))]}getInteriorExtremaTs(){return[]}intersection(t){const s=[],r=this._start,n=this._end.minus(r);if(n.magnitudeSquared===0)return s;const l=t.direction.y*n.x-t.direction.x*n.y;if(l===0)return s;const h=(t.direction.x*(r.y-t.position.y)-t.direction.y*(r.x-t.position.x))/l;if(h<0||h>=1)return s;const g=(n.x*(r.y-t.position.y)-n.y*(r.x-t.position.x))/l;if(g<1e-8)return s;const d=n.perpendicular,A=r.plus(n.times(h)),S=(d.dot(t.direction)>0?d.negated():d).normalized(),O=t.direction.perpendicular.dot(n)<0?1:-1;return s.push(new RayIntersection(g,A,S,O,h)),s}windingIntersection(t){const s=this.intersection(t);return s.length?s[0].wind:0}writeToContext(t){t.lineTo(this._end.x,this._end.y)}transformed(t){return new Br(t.timesVector2(this._start),t.timesVector2(this._end))}explicitClosestToPoint(t){const s=this._end.minus(this._start);let r=t.minus(this._start).dot(s)/s.magnitudeSquared;r=DotUtils.clamp(r,0,1);const o=this.positionAt(r);return[{segment:this,t:r,closestPoint:o,distanceSquared:t.distanceSquared(o)}]}getSignedAreaFragment(){return 1/2*(this._start.x*this._end.y-this._start.y*this._end.x)}reparameterized(t,s){return new Br(this.positionAt(s),this.positionAt(t+s))}reversed(){return new Br(this._end,this._start)}polarToCartesian(t){return this._start.x===this._end.x?[new Br(Vector2.createPolar(this._start.y,this._start.x),Vector2.createPolar(this._end.y,this._end.x))]:this._start.y===this._end.y?[new Arc(Vector2.ZERO,this._start.y,this._start.x,this._end.x,this._start.x>this._end.x)]:this.toPiecewiseLinearSegments(t)}getArcLength(){return this.start.distance(this.end)}toPiecewiseLinearOrArcSegments(){return[this]}serialize(){return{type:"Line",startX:this._start.x,startY:this._start.y,endX:this._end.x,endY:this._end.y}}getOverlaps(t,s=1e-6){return t instanceof Br?Br.getOverlaps(this,t):null}getClosestPoints(t){const s=this._end.minus(this._start),r=s.normalized(),o=t.minus(this._start).dot(r),n=DotUtils.clamp(o/s.magnitude,0,1),l=this.positionAt(n);return[{segment:this,t:n,closestPoint:l,distanceSquared:l.distanceSquared(t)}]}static deserialize(t){return assert&&assert(t.type==="Line"),new Br(new Vector2(t.startX,t.startY),new Vector2(t.endX,t.endY))}static getOverlaps(t,s,r=1e-6){const o=[],n=t._start.x,l=-1*t._start.x+t._end.x,h=t._start.y,g=-1*t._start.y+t._end.y,d=s._start.x,A=-1*s._start.x+s._end.x,S=s._start.y,O=-1*s._start.y+s._end.y,I=Math.abs(Math.max(t._start.x,t._end.x,s._start.x,s._end.x)-Math.min(t._start.x,t._end.x,s._start.x,s._end.x)),W=Math.abs(Math.max(t._start.y,t._end.y,s._start.y,s._end.y)-Math.min(t._start.y,t._end.y,s._start.y,s._end.y)),L=Segment.polynomialGetOverlapLinear(n,l,d,A),H=Segment.polynomialGetOverlapLinear(h,g,S,O);let Y;if(I>W?Y=L===null||L===!0?H:L:Y=H===null||H===!0?L:H,Y===null||Y===!0)return o;const Q=Y.a,pe=Y.b,de=d+pe*A-n,fe=Q*A-l,ye=S+pe*O-h,Ee=Q*O-g;if(Math.abs(de)>r||Math.abs(fe+de)>r||Math.abs(ye)>r||Math.abs(Ee+ye)>r)return o;const Le=pe,Z=Q+pe;return Le>1&&Z>1||Le<0&&Z<0?o:[new Overlap(Q,pe)]}static intersect(t,s){const r=DotUtils.lineSegmentIntersection(t.start.x,t.start.y,t.end.x,t.end.y,s.start.x,s.start.y,s.end.x,s.end.y);if(r!==null){const o=t.explicitClosestToPoint(r)[0].t,n=s.explicitClosestToPoint(r)[0].t;return[new SegmentIntersection(r,o,n)]}else return[]}static intersectOther(t,s){const r=t.end.minus(t.start),o=r.magnitude,n=new Ray2(t.start,r.normalize()),l=s.intersection(n),h=[];for(let g=0;g<l.length;g++){const d=l[g],A=d.distance/o;A>1e-8&&A<1-1e-8&&h.push(new SegmentIntersection(d.point,A,d.t))}return h}};kite.register("Line",Line$1);const solveQuadraticRootsReal$1=DotUtils.solveQuadraticRootsReal,arePointsCollinear$1=DotUtils.arePointsCollinear;function isBetween0And1$1(a){return a>=0&&a<=1}class Quadratic extends Segment{constructor(t,s,r){super(),this._start=t,this._control=s,this._end=r,this.invalidate()}setStart(t){return assert&&assert(t.isFinite(),`Quadratic start should be finite: ${t.toString()}`),this._start.equals(t)||(this._start=t,this.invalidate()),this}set start(t){this.setStart(t)}get start(){return this.getStart()}getStart(){return this._start}setControl(t){return assert&&assert(t.isFinite(),`Quadratic control should be finite: ${t.toString()}`),this._control.equals(t)||(this._control=t,this.invalidate()),this}set control(t){this.setControl(t)}get control(){return this.getControl()}getControl(){return this._control}setEnd(t){return assert&&assert(t.isFinite(),`Quadratic end should be finite: ${t.toString()}`),this._end.equals(t)||(this._end=t,this.invalidate()),this}set end(t){this.setEnd(t)}get end(){return this.getEnd()}getEnd(){return this._end}positionAt(t){assert&&assert(t>=0,"positionAt t should be non-negative"),assert&&assert(t<=1,"positionAt t should be no greater than 1");const s=1-t;return this._start.times(s*s).plus(this._control.times(2*s*t)).plus(this._end.times(t*t))}tangentAt(t){return assert&&assert(t>=0,"tangentAt t should be non-negative"),assert&&assert(t<=1,"tangentAt t should be no greater than 1"),this._control.minus(this._start).times(2*(1-t)).plus(this._end.minus(this._control).times(2*t))}curvatureAt(t){if(assert&&assert(t>=0,"curvatureAt t should be non-negative"),assert&&assert(t<=1,"curvatureAt t should be no greater than 1"),Math.abs(t-.5)>.5-1e-7){const r=t<.5,o=r?this._start:this._end,n=this._control,l=r?this._end:this._start,h=n.minus(o),g=h.magnitude;return(r?-1:1)*h.perpendicular.normalized().dot(l.minus(n))*(this.degree-1)/(this.degree*g*g)}else return this.subdivided(t)[0].curvatureAt(1)}subdivided(t){if(assert&&assert(t>=0,"subdivided t should be non-negative"),assert&&assert(t<=1,"subdivided t should be no greater than 1"),t===0||t===1)return[this];const s=this._start.blend(this._control,t),r=this._control.blend(this._end,t),o=s.blend(r,t);return[new Quadratic(this._start,s,o),new Quadratic(o,r,this._end)]}invalidate(){assert&&assert(this._start instanceof Vector2,`Quadratic start should be a Vector2: ${this._start}`),assert&&assert(this._start.isFinite(),`Quadratic start should be finite: ${this._start.toString()}`),assert&&assert(this._control instanceof Vector2,`Quadratic control should be a Vector2: ${this._control}`),assert&&assert(this._control.isFinite(),`Quadratic control should be finite: ${this._control.toString()}`),assert&&assert(this._end instanceof Vector2,`Quadratic end should be a Vector2: ${this._end}`),assert&&assert(this._end.isFinite(),`Quadratic end should be finite: ${this._end.toString()}`),this._startTangent=null,this._endTangent=null,this._tCriticalX=null,this._tCriticalY=null,this._bounds=null,this._svgPathFragment=null,this.invalidationEmitter.emit()}getStartTangent(){if(this._startTangent===null){const t=this._start.equals(this._control);this._startTangent=t?this._end.minus(this._start).normalized():this._control.minus(this._start).normalized()}return this._startTangent}get startTangent(){return this.getStartTangent()}getEndTangent(){if(this._endTangent===null){const t=this._end.equals(this._control);this._endTangent=t?this._end.minus(this._start).normalized():this._end.minus(this._control).normalized()}return this._endTangent}get endTangent(){return this.getEndTangent()}getTCriticalX(){return this._tCriticalX===null&&(this._tCriticalX=Quadratic.extremaT(this._start.x,this._control.x,this._end.x)),this._tCriticalX}get tCriticalX(){return this.getTCriticalX()}getTCriticalY(){return this._tCriticalY===null&&(this._tCriticalY=Quadratic.extremaT(this._start.y,this._control.y,this._end.y)),this._tCriticalY}get tCriticalY(){return this.getTCriticalY()}getNondegenerateSegments(){const t=this._start,s=this._control,r=this._end,o=t.equals(r),n=t.equals(s),l=t.equals(s);if(o&&n)return[];if(o){const h=this.positionAt(.5);return[new Line$1(t,h),new Line$1(h,r)]}else if(arePointsCollinear$1(t,s,r)){if(n||l)return[new Line$1(t,r)];const h=r.minus(t),g=s.minus(t).dot(h.normalized())/h.magnitude,d=Quadratic.extremaT(0,g,1);if(!isNaN(d)&&d>0&&d<1){const A=this.positionAt(d);return _.flatten([new Line$1(t,A).getNondegenerateSegments(),new Line$1(A,r).getNondegenerateSegments()])}else return[new Line$1(t,r)]}else return[this]}getBounds(){if(this._bounds===null){this._bounds=new Bounds2(Math.min(this._start.x,this._end.x),Math.min(this._start.y,this._end.y),Math.max(this._start.x,this._end.x),Math.max(this._start.y,this._end.y));const t=this.getTCriticalX(),s=this.getTCriticalY();!isNaN(t)&&t>0&&t<1&&(this._bounds=this._bounds.withPoint(this.positionAt(t))),!isNaN(s)&&s>0&&s<1&&(this._bounds=this._bounds.withPoint(this.positionAt(s)))}return this._bounds}get bounds(){return this.getBounds()}offsetTo(t,s){let r=[this];const o=5;for(let l=0;l<o;l++)r=_.flatten(_.map(r,h=>h.subdivided(.5)));let n=_.map(r,l=>l.approximateOffset(t));return s&&(n.reverse(),n=_.map(n,l=>l.reversed())),n}degreeElevated(){return new Cubic(this._start,this._start.plus(this._control.timesScalar(2)).dividedScalar(3),this._end.plus(this._control.timesScalar(2)).dividedScalar(3),this._end)}approximateOffset(t){return new Quadratic(this._start.plus((this._start.equals(this._control)?this._end.minus(this._start):this._control.minus(this._start)).perpendicular.normalized().times(t)),this._control.plus(this._end.minus(this._start).perpendicular.normalized().times(t)),this._end.plus((this._end.equals(this._control)?this._end.minus(this._start):this._end.minus(this._control)).perpendicular.normalized().times(t)))}getSVGPathFragment(){let t;return assert&&(t=this._svgPathFragment,this._svgPathFragment=null),this._svgPathFragment||(this._svgPathFragment=`Q ${svgNumber(this._control.x)} ${svgNumber(this._control.y)} ${svgNumber(this._end.x)} ${svgNumber(this._end.y)}`),assert&&t&&assert(t===this._svgPathFragment,"Quadratic line segment changed without invalidate()"),this._svgPathFragment}strokeLeft(t){return this.offsetTo(-t/2,!1)}strokeRight(t){return this.offsetTo(t/2,!0)}getInteriorExtremaTs(){const t=[],r=this.getTCriticalX(),o=this.getTCriticalY();return!isNaN(r)&&r>1e-10&&r<1-1e-10&&t.push(this.tCriticalX),!isNaN(o)&&o>1e-10&&o<1-1e-10&&t.push(this.tCriticalY),t.sort()}intersection(t){const s=[],r=Matrix3.rotation2(-t.direction.angle).timesMatrix(Matrix3.translation(-t.position.x,-t.position.y)),o=r.timesVector2(this._start),n=r.timesVector2(this._control),l=r.timesVector2(this._end),h=o.y-2*n.y+l.y,g=-2*o.y+2*n.y,d=o.y,A=solveQuadraticRootsReal$1(h,g,d);return _.each(A,S=>{if(S>=0&&S<=1){const O=this.positionAt(S),I=this.tangentAt(S).normalized(),W=I.perpendicular,L=O.minus(t.position);if(L.dot(t.direction)>0){const H=W.dot(t.direction)>0?W.negated():W,Y=t.direction.perpendicular.dot(I)<0?1:-1;s.push(new RayIntersection(L.magnitude,O,H,Y,S))}}}),s}windingIntersection(t){let s=0;const r=this.intersection(t);return _.each(r,o=>{s+=o.wind}),s}writeToContext(t){t.quadraticCurveTo(this._control.x,this._control.y,this._end.x,this._end.y)}transformed(t){return new Quadratic(t.timesVector2(this._start),t.timesVector2(this._control),t.timesVector2(this._end))}getSignedAreaFragment(){return 1/6*(this._start.x*(2*this._control.y+this._end.y)+this._control.x*(-2*this._start.y+2*this._end.y)+this._end.x*(-this._start.y-2*this._control.y))}reparameterized(t,s){const r=this._start.plus(this._end.plus(this._control.timesScalar(-2))),o=this._control.minus(this._start).timesScalar(2),n=this._start,l=r.timesScalar(t*t),h=r.timesScalar(t*s).timesScalar(2).plus(o.timesScalar(t)),g=r.timesScalar(s*s).plus(o.timesScalar(s)).plus(n);return new Quadratic(g,h.timesScalar(.5).plus(g),l.plus(h).plus(g))}reversed(){return new Quadratic(this._end,this._control,this._start)}serialize(){return{type:"Quadratic",startX:this._start.x,startY:this._start.y,controlX:this._control.x,controlY:this._control.y,endX:this._end.x,endY:this._end.y}}getOverlaps(t,s=1e-6){return t instanceof Quadratic?Quadratic.getOverlaps(this,t):null}static deserialize(t){return assert&&assert(t.type==="Quadratic"),new Quadratic(new Vector2(t.startX,t.startY),new Vector2(t.controlX,t.controlY),new Vector2(t.endX,t.endY))}static extremaT(t,s,r){const o=2*(r-2*s+t);return o!==0?-2*(s-t)/o:NaN}static getOverlaps(t,s,r=1e-6){const o=[],n=t._start.x,l=-2*t._start.x+2*t._control.x,h=t._start.x-2*t._control.x+t._end.x,g=t._start.y,d=-2*t._start.y+2*t._control.y,A=t._start.y-2*t._control.y+t._end.y,S=s._start.x,O=-2*s._start.x+2*s._control.x,I=s._start.x-2*s._control.x+s._end.x,W=s._start.y,L=-2*s._start.y+2*s._control.y,H=s._start.y-2*s._control.y+s._end.y,Y=Math.abs(Math.max(t._start.x,t._control.x,t._end.x,s._start.x,s._control.x,s._end.x)-Math.min(t._start.x,t._control.x,t._end.x,s._start.x,s._control.x,s._end.x)),Q=Math.abs(Math.max(t._start.y,t._control.y,t._end.y,s._start.y,s._control.y,s._end.y)-Math.min(t._start.y,t._control.y,t._end.y,s._start.y,s._control.y,s._end.y)),pe=Segment.polynomialGetOverlapQuadratic(n,l,h,S,O,I),de=Segment.polynomialGetOverlapQuadratic(g,d,A,W,L,H);let fe;if(Y>Q?fe=pe===null||pe===!0?de:pe:fe=de===null||de===!0?pe:de,fe===null||fe===!0)return o;const ye=fe.a,Ee=fe.b,Le=ye*ye,Z=Ee*Ee,ne=2*ye*Ee,Ke=S+Ee*O+Z*I-n,_t=ye*O+ne*I-l,xe=Le*I-h,Ct=W+Ee*L+Z*H-g,zt=ye*L+ne*H-d,Je=Le*H-A,Et=DotUtils.solveLinearRootsReal(2*xe,_t),ht=DotUtils.solveLinearRootsReal(2*Je,zt),mt=_.uniq([0,1].concat(Et?Et.filter(isBetween0And1$1):[])),Nt=_.uniq([0,1].concat(ht?ht.filter(isBetween0And1$1):[]));for(let jt=0;jt<mt.length;jt++){const Ai=mt[jt];if(Math.abs((xe*Ai+_t)*Ai+Ke)>r)return o}for(let jt=0;jt<Nt.length;jt++){const Ai=Nt[jt];if(Math.abs((Je*Ai+zt)*Ai+Ct)>r)return o}const Gt=Ee,Mt=ye+Ee;return Gt>1&&Mt>1||Gt<0&&Mt<0?o:[new Overlap(ye,Ee)]}}Quadratic.prototype.degree=2;kite.register("Quadratic",Quadratic);const solveQuadraticRootsReal=DotUtils.solveQuadraticRootsReal,solveCubicRootsReal=DotUtils.solveCubicRootsReal,arePointsCollinear=DotUtils.arePointsCollinear,scratchVector1=new Vector2(0,0),scratchVector2=new Vector2(0,0),scratchVector3=new Vector2(0,0);function isBetween0And1(a){return a>=0&&a<=1}class Cubic extends Segment{constructor(t,s,r,o){super(),this._start=t,this._control1=s,this._control2=r,this._end=o,this.invalidate()}setStart(t){return assert&&assert(t.isFinite(),`Cubic start should be finite: ${t.toString()}`),this._start.equals(t)||(this._start=t,this.invalidate()),this}set start(t){this.setStart(t)}get start(){return this.getStart()}getStart(){return this._start}setControl1(t){return assert&&assert(t.isFinite(),`Cubic control1 should be finite: ${t.toString()}`),this._control1.equals(t)||(this._control1=t,this.invalidate()),this}set control1(t){this.setControl1(t)}get control1(){return this.getControl1()}getControl1(){return this._control1}setControl2(t){return assert&&assert(t.isFinite(),`Cubic control2 should be finite: ${t.toString()}`),this._control2.equals(t)||(this._control2=t,this.invalidate()),this}set control2(t){this.setControl2(t)}get control2(){return this.getControl2()}getControl2(){return this._control2}setEnd(t){return assert&&assert(t.isFinite(),`Cubic end should be finite: ${t.toString()}`),this._end.equals(t)||(this._end=t,this.invalidate()),this}set end(t){this.setEnd(t)}get end(){return this.getEnd()}getEnd(){return this._end}positionAt(t){assert&&assert(t>=0,"positionAt t should be non-negative"),assert&&assert(t<=1,"positionAt t should be no greater than 1");const s=1-t,r=s*s*s,o=3*s*s*t,n=3*s*t*t,l=t*t*t;return new Vector2(this._start.x*r+this._control1.x*o+this._control2.x*n+this._end.x*l,this._start.y*r+this._control1.y*o+this._control2.y*n+this._end.y*l)}tangentAt(t){assert&&assert(t>=0,"tangentAt t should be non-negative"),assert&&assert(t<=1,"tangentAt t should be no greater than 1");const s=1-t;return new Vector2(0,0).set(this._start).multiplyScalar(-3*s*s).add(scratchVector1.set(this._control1).multiplyScalar(3*s*s-6*s*t)).add(scratchVector1.set(this._control2).multiplyScalar(6*s*t-3*t*t)).add(scratchVector1.set(this._end).multiplyScalar(3*t*t))}curvatureAt(t){if(assert&&assert(t>=0,"curvatureAt t should be non-negative"),assert&&assert(t<=1,"curvatureAt t should be no greater than 1"),Math.abs(t-.5)>.5-1e-7){const r=t<.5,o=r?this._start:this._end,n=r?this._control1:this._control2,l=r?this._control2:this._control1,h=n.minus(o),g=h.magnitude;return(r?-1:1)*h.perpendicular.normalized().dot(l.minus(n))*(this.degree-1)/(this.degree*g*g)}else return this.subdivided(t)[0].curvatureAt(1)}subdivided(t){if(assert&&assert(t>=0,"subdivided t should be non-negative"),assert&&assert(t<=1,"subdivided t should be no greater than 1"),t===0||t===1)return[this];const s=this._start.blend(this._control1,t),r=this._control2.blend(this._end,t),o=this._control1.blend(this._control2,t),n=s.blend(o,t),l=o.blend(r,t),h=n.blend(l,t);return[new Cubic(this._start,s,n,h),new Cubic(h,l,r,this._end)]}invalidate(){assert&&assert(this._start instanceof Vector2,`Cubic start should be a Vector2: ${this._start}`),assert&&assert(this._start.isFinite(),`Cubic start should be finite: ${this._start.toString()}`),assert&&assert(this._control1 instanceof Vector2,`Cubic control1 should be a Vector2: ${this._control1}`),assert&&assert(this._control1.isFinite(),`Cubic control1 should be finite: ${this._control1.toString()}`),assert&&assert(this._control2 instanceof Vector2,`Cubic control2 should be a Vector2: ${this._control2}`),assert&&assert(this._control2.isFinite(),`Cubic control2 should be finite: ${this._control2.toString()}`),assert&&assert(this._end instanceof Vector2,`Cubic end should be a Vector2: ${this._end}`),assert&&assert(this._end.isFinite(),`Cubic end should be finite: ${this._end.toString()}`),this._startTangent=null,this._endTangent=null,this._r=null,this._s=null,this._tCusp=null,this._tDeterminant=null,this._tInflection1=null,this._tInflection2=null,this._quadratics=null,this._xExtremaT=null,this._yExtremaT=null,this._bounds=null,this._svgPathFragment=null,this.invalidationEmitter.emit()}getStartTangent(){return this._startTangent===null&&(this._startTangent=this.tangentAt(0).normalized()),this._startTangent}get startTangent(){return this.getStartTangent()}getEndTangent(){return this._endTangent===null&&(this._endTangent=this.tangentAt(1).normalized()),this._endTangent}get endTangent(){return this.getEndTangent()}getR(){return this._r===null&&(this._r=this._control1.minus(this._start).normalized()),this._r}get r(){return this.getR()}getS(){return this._s===null&&(this._s=this.getR().perpendicular),this._s}get s(){return this.getS()}getTCusp(){return this._tCusp===null&&this.computeCuspInfo(),assert&&assert(this._tCusp!==null),this._tCusp}get tCusp(){return this.getTCusp()}getTDeterminant(){return this._tDeterminant===null&&this.computeCuspInfo(),assert&&assert(this._tDeterminant!==null),this._tDeterminant}get tDeterminant(){return this.getTDeterminant()}getTInflection1(){return this._tInflection1===null&&this.computeCuspInfo(),assert&&assert(this._tInflection1!==null),this._tInflection1}get tInflection1(){return this.getTInflection1()}getTInflection2(){return this._tInflection2===null&&this.computeCuspInfo(),assert&&assert(this._tInflection2!==null),this._tInflection2}get tInflection2(){return this.getTInflection2()}getQuadratics(){return this._quadratics===null&&this.computeCuspSegments(),assert&&assert(this._quadratics!==null),this._quadratics}getXExtremaT(){return this._xExtremaT===null&&(this._xExtremaT=Cubic.extremaT(this._start.x,this._control1.x,this._control2.x,this._end.x)),this._xExtremaT}get xExtremaT(){return this.getXExtremaT()}getYExtremaT(){return this._yExtremaT===null&&(this._yExtremaT=Cubic.extremaT(this._start.y,this._control1.y,this._control2.y,this._end.y)),this._yExtremaT}get yExtremaT(){return this.getYExtremaT()}getBounds(){return this._bounds===null&&(this._bounds=Bounds2.NOTHING,this._bounds=this._bounds.withPoint(this._start),this._bounds=this._bounds.withPoint(this._end),_.each(this.getXExtremaT(),t=>{t>=0&&t<=1&&(this._bounds=this._bounds.withPoint(this.positionAt(t)))}),_.each(this.getYExtremaT(),t=>{t>=0&&t<=1&&(this._bounds=this._bounds.withPoint(this.positionAt(t)))}),this.hasCusp()&&(this._bounds=this._bounds.withPoint(this.positionAt(this.getTCusp())))),this._bounds}get bounds(){return this.getBounds()}computeCuspInfo(){const t=this._start.times(-1).plus(this._control1.times(3)).plus(this._control2.times(-3)).plus(this._end),s=this._start.times(3).plus(this._control1.times(-6)).plus(this._control2.times(3)),r=this._start.times(-3).plus(this._control1.times(3)),o=t.perpendicular,n=s.perpendicular,l=o.dot(s);if(this._tCusp=-.5*(o.dot(r)/l),this._tDeterminant=this._tCusp*this._tCusp-1/3*(n.dot(r)/l),this._tDeterminant>=0){const h=Math.sqrt(this._tDeterminant);this._tInflection1=this._tCusp-h,this._tInflection2=this._tCusp+h}else this._tInflection1=NaN,this._tInflection2=NaN}computeCuspSegments(){if(this.hasCusp()){this._quadratics=[];const t=this.getTCusp();if(t===0)this._quadratics.push(new Quadratic(this.start,this.control2,this.end));else if(t===1)this._quadratics.push(new Quadratic(this.start,this.control1,this.end));else{const s=this.subdivided(t);this._quadratics.push(new Quadratic(s[0].start,s[0].control1,s[0].end)),this._quadratics.push(new Quadratic(s[1].start,s[1].control2,s[1].end))}}else this._quadratics=null}getNondegenerateSegments(){const t=this._start,s=this._control1,r=this._control2,o=this._end,n=this.degreeReduced(1e-9);if(t.equals(o)&&t.equals(s)&&t.equals(r))return[];if(this.hasCusp())return _.flatten(this.getQuadratics().map(l=>l.getNondegenerateSegments()));if(n)return n.getNondegenerateSegments();if(arePointsCollinear(t,s,o)&&arePointsCollinear(t,r,o)&&!t.equalsEpsilon(o,1e-7)){const l=this.getXExtremaT().concat(this.getYExtremaT()).sort().map(d=>this.positionAt(d)),h=[];let g=t;l.length&&(h.push(new Line$1(t,l[0])),g=l[0]);for(let d=1;d<l.length;d++)h.push(new Line$1(l[d-1],l[d])),g=l[d];return h.push(new Line$1(g,o)),_.flatten(h.map(d=>d.getNondegenerateSegments()))}else return[this]}hasCusp(){const t=this.getTCusp();return t>=0&&t<=1&&this.tangentAt(t).magnitude<1e-7}toRS(t){const s=t.minus(this._start);return new Vector2(s.dot(this.getR()),s.dot(this.getS()))}offsetTo(t,s){const o=[],n=[];for(let l=0;l<32;l++){let h=l/31;s&&(h=1-h),o.push(this.positionAt(h).plus(this.tangentAt(h).perpendicular.normalized().times(t))),l>0&&n.push(new Line$1(o[l-1],o[l]))}return n}getSVGPathFragment(){let t;return assert&&(t=this._svgPathFragment,this._svgPathFragment=null),this._svgPathFragment||(this._svgPathFragment=`C ${svgNumber(this._control1.x)} ${svgNumber(this._control1.y)} ${svgNumber(this._control2.x)} ${svgNumber(this._control2.y)} ${svgNumber(this._end.x)} ${svgNumber(this._end.y)}`),assert&&t&&assert(t===this._svgPathFragment,"Quadratic line segment changed without invalidate()"),this._svgPathFragment}strokeLeft(t){return this.offsetTo(-t/2,!1)}strokeRight(t){return this.offsetTo(t/2,!0)}getInteriorExtremaTs(){const t=this.getXExtremaT().concat(this.getYExtremaT()),s=[];return _.each(t,r=>{r>1e-10&&r<1-1e-10&&_.every(s,n=>Math.abs(r-n)>1e-10)&&s.push(r)}),s.sort()}intersection(t){const s=[],r=Matrix3.rotation2(-t.direction.angle).timesMatrix(Matrix3.translation(-t.position.x,-t.position.y)),o=r.timesVector2(this._start),n=r.timesVector2(this._control1),l=r.timesVector2(this._control2),h=r.timesVector2(this._end),g=-o.y+3*n.y-3*l.y+h.y,d=3*o.y-6*n.y+3*l.y,A=-3*o.y+3*n.y,S=o.y,O=solveCubicRootsReal(g,d,A,S);return _.each(O,I=>{if(I>=0&&I<=1){const W=this.positionAt(I),L=this.tangentAt(I).normalized(),H=L.perpendicular,Y=W.minus(t.position);if(Y.dot(t.direction)>0){const Q=H.dot(t.direction)>0?H.negated():H,pe=t.direction.perpendicular.dot(L)<0?1:-1;s.push(new RayIntersection(Y.magnitude,W,Q,pe,I))}}}),s}windingIntersection(t){let s=0;const r=this.intersection(t);return _.each(r,o=>{s+=o.wind}),s}writeToContext(t){t.bezierCurveTo(this._control1.x,this._control1.y,this._control2.x,this._control2.y,this._end.x,this._end.y)}transformed(t){return new Cubic(t.timesVector2(this._start),t.timesVector2(this._control1),t.timesVector2(this._control2),t.timesVector2(this._end))}degreeReduced(t){t=t||0;const s=scratchVector1.set(this._control1).multiplyScalar(3).subtract(this._start).divideScalar(2),r=scratchVector2.set(this._control2).multiplyScalar(3).subtract(this._end).divideScalar(2);return scratchVector3.set(s).subtract(r).magnitude<=t?new Quadratic(this._start,s.average(r),this._end):null}getSignedAreaFragment(){return 1/20*(this._start.x*(6*this._control1.y+3*this._control2.y+this._end.y)+this._control1.x*(-6*this._start.y+3*this._control2.y+3*this._end.y)+this._control2.x*(-3*this._start.y-3*this._control1.y+6*this._end.y)+this._end.x*(-this._start.y-3*this._control1.y-6*this._control2.y))}reversed(){return new Cubic(this._end,this._control2,this._control1,this._start)}getSelfIntersection(){const t=this.getInteriorExtremaTs(),s=[0].concat(t).concat([1]),r=this.subdivisions(t);if(r.length<3)return null;for(let o=0;o<r.length;o++){const n=r[o];for(let l=o+1;l<r.length;l++){const h=r[l],g=BoundsIntersection.intersect(n,h);if(assert&&assert(g.length<2),g.length){const d=g[0];if(d.aT>1e-7&&d.aT<1-1e-7&&d.bT>1e-7&&d.bT<1-1e-7){const A=s[o]+d.aT*(s[o+1]-s[o]),S=s[l]+d.bT*(s[l+1]-s[l]);return new SegmentIntersection(d.point,A,S)}}}}return null}serialize(){return{type:"Cubic",startX:this._start.x,startY:this._start.y,control1X:this._control1.x,control1Y:this._control1.y,control2X:this._control2.x,control2Y:this._control2.y,endX:this._end.x,endY:this._end.y}}getOverlaps(t,s=1e-6){return t instanceof Cubic?Cubic.getOverlaps(this,t):null}static deserialize(t){return assert&&assert(t.type==="Cubic"),new Cubic(new Vector2(t.startX,t.startY),new Vector2(t.control1X,t.control1Y),new Vector2(t.control2X,t.control2Y),new Vector2(t.endX,t.endY))}static extremaT(t,s,r,o){if(t===s&&t===r&&t===o)return[];const n=-3*t+9*s-9*r+3*o,l=6*t-12*s+6*r,h=-3*t+3*s;return _.filter(solveQuadraticRootsReal(n,l,h),isBetween0And1)}static getOverlaps(t,s,r=1e-6){const o=[],n=t._start.x,l=-3*t._start.x+3*t._control1.x,h=3*t._start.x-6*t._control1.x+3*t._control2.x,g=-1*t._start.x+3*t._control1.x-3*t._control2.x+t._end.x,d=t._start.y,A=-3*t._start.y+3*t._control1.y,S=3*t._start.y-6*t._control1.y+3*t._control2.y,O=-1*t._start.y+3*t._control1.y-3*t._control2.y+t._end.y,I=s._start.x,W=-3*s._start.x+3*s._control1.x,L=3*s._start.x-6*s._control1.x+3*s._control2.x,H=-1*s._start.x+3*s._control1.x-3*s._control2.x+s._end.x,Y=s._start.y,Q=-3*s._start.y+3*s._control1.y,pe=3*s._start.y-6*s._control1.y+3*s._control2.y,de=-1*s._start.y+3*s._control1.y-3*s._control2.y+s._end.y,fe=Math.abs(Math.max(t._start.x,t._control1.x,t._control2.x,t._end.x,t._start.x,t._control1.x,t._control2.x,t._end.x)-Math.min(t._start.x,t._control1.x,t._control2.x,t._end.x,t._start.x,t._control1.x,t._control2.x,t._end.x)),ye=Math.abs(Math.max(t._start.y,t._control1.y,t._control2.y,t._end.y,t._start.y,t._control1.y,t._control2.y,t._end.y)-Math.min(t._start.y,t._control1.y,t._control2.y,t._end.y,t._start.y,t._control1.y,t._control2.y,t._end.y)),Ee=Segment.polynomialGetOverlapCubic(n,l,h,g,I,W,L,H),Le=Segment.polynomialGetOverlapCubic(d,A,S,O,Y,Q,pe,de);let Z;if(fe>ye?Z=Ee===null||Ee===!0?Le:Ee:Z=Le===null||Le===!0?Ee:Le,Z===null||Z===!0)return o;const ne=Z.a,Ke=Z.b,_t=ne*ne,xe=ne*ne*ne,Ct=Ke*Ke,zt=Ke*Ke*Ke,Je=2*ne*Ke,Et=3*ne*Ct,ht=3*_t*Ke,mt=I+Ke*W+Ct*L+zt*H-n,Nt=ne*W+Je*L+Et*H-l,Gt=_t*L+ht*H-h,Mt=xe*H-g,jt=Y+Ke*Q+Ct*pe+zt*de-d,Ai=ne*Q+Je*pe+Et*de-A,oi=_t*pe+ht*de-S,ki=xe*de-O,Li=DotUtils.solveQuadraticRootsReal(3*Mt,2*Gt,Nt),Wi=DotUtils.solveQuadraticRootsReal(3*ki,2*oi,Ai),Vi=_.uniq([0,1].concat(Li!==null?Li.filter(isBetween0And1):[])),qi=_.uniq([0,1].concat(Wi!==null?Wi.filter(isBetween0And1):[]));for(let ls=0;ls<Vi.length;ls++){const gs=Vi[ls];if(Math.abs(((Mt*gs+Gt)*gs+Nt)*gs+mt)>r)return o}for(let ls=0;ls<qi.length;ls++){const gs=qi[ls];if(Math.abs(((ki*gs+oi)*gs+Ai)*gs+jt)>r)return o}const Kt=Ke,zs=ne+Ke;return Kt>1&&zs>1||Kt<0&&zs<0?o:[new Overlap(ne,Ke)]}}Cubic.prototype.degree=3;kite.register("Cubic",Cubic);const TWO_PI=Math.PI*2;class Arc extends Segment{constructor(t,s,r,o,n){super(),this._center=t,this._radius=s,this._startAngle=r,this._endAngle=o,this._anticlockwise=n,this.invalidate()}setCenter(t){return assert&&assert(t.isFinite(),`Arc center should be finite: ${t.toString()}`),this._center.equals(t)||(this._center=t,this.invalidate()),this}set center(t){this.setCenter(t)}get center(){return this.getCenter()}getCenter(){return this._center}setRadius(t){return assert&&assert(isFinite(t),`Arc radius should be a finite number: ${t}`),this._radius!==t&&(this._radius=t,this.invalidate()),this}set radius(t){this.setRadius(t)}get radius(){return this.getRadius()}getRadius(){return this._radius}setStartAngle(t){return assert&&assert(isFinite(t),`Arc startAngle should be a finite number: ${t}`),this._startAngle!==t&&(this._startAngle=t,this.invalidate()),this}set startAngle(t){this.setStartAngle(t)}get startAngle(){return this.getStartAngle()}getStartAngle(){return this._startAngle}setEndAngle(t){return assert&&assert(isFinite(t),`Arc endAngle should be a finite number: ${t}`),this._endAngle!==t&&(this._endAngle=t,this.invalidate()),this}set endAngle(t){this.setEndAngle(t)}get endAngle(){return this.getEndAngle()}getEndAngle(){return this._endAngle}setAnticlockwise(t){return this._anticlockwise!==t&&(this._anticlockwise=t,this.invalidate()),this}set anticlockwise(t){this.setAnticlockwise(t)}get anticlockwise(){return this.getAnticlockwise()}getAnticlockwise(){return this._anticlockwise}positionAt(t){return assert&&assert(t>=0,"positionAt t should be non-negative"),assert&&assert(t<=1,"positionAt t should be no greater than 1"),this.positionAtAngle(this.angleAt(t))}tangentAt(t){return assert&&assert(t>=0,"tangentAt t should be non-negative"),assert&&assert(t<=1,"tangentAt t should be no greater than 1"),this.tangentAtAngle(this.angleAt(t))}curvatureAt(t){return assert&&assert(t>=0,"curvatureAt t should be non-negative"),assert&&assert(t<=1,"curvatureAt t should be no greater than 1"),(this._anticlockwise?-1:1)/this._radius}subdivided(t){if(assert&&assert(t>=0,"subdivided t should be non-negative"),assert&&assert(t<=1,"subdivided t should be no greater than 1"),t===0||t===1)return[this];const s=this.angleAt(0),r=this.angleAt(t),o=this.angleAt(1);return[new Arc(this._center,this._radius,s,r,this._anticlockwise),new Arc(this._center,this._radius,r,o,this._anticlockwise)]}invalidate(){this._start=null,this._end=null,this._startTangent=null,this._endTangent=null,this._actualEndAngle=null,this._isFullPerimeter=null,this._angleDifference=null,this._bounds=null,this._svgPathFragment=null,assert&&assert(this._center instanceof Vector2,"Arc center should be a Vector2"),assert&&assert(this._center.isFinite(),"Arc center should be finite (not NaN or infinite)"),assert&&assert(typeof this._radius=="number",`Arc radius should be a number: ${this._radius}`),assert&&assert(isFinite(this._radius),`Arc radius should be a finite number: ${this._radius}`),assert&&assert(typeof this._startAngle=="number",`Arc startAngle should be a number: ${this._startAngle}`),assert&&assert(isFinite(this._startAngle),`Arc startAngle should be a finite number: ${this._startAngle}`),assert&&assert(typeof this._endAngle=="number",`Arc endAngle should be a number: ${this._endAngle}`),assert&&assert(isFinite(this._endAngle),`Arc endAngle should be a finite number: ${this._endAngle}`),assert&&assert(typeof this._anticlockwise=="boolean",`Arc anticlockwise should be a boolean: ${this._anticlockwise}`),this._radius<0&&(this._radius=-this._radius,this._startAngle+=Math.PI,this._endAngle+=Math.PI),assert&&assert(!(!this.anticlockwise&&this._endAngle-this._startAngle<=-Math.PI*2||this.anticlockwise&&this._startAngle-this._endAngle<=-Math.PI*2),"Not handling arcs with start/end angles that show differences in-between browser handling"),assert&&assert(!(!this.anticlockwise&&this._endAngle-this._startAngle>Math.PI*2||this.anticlockwise&&this._startAngle-this._endAngle>Math.PI*2),"Not handling arcs with start/end angles that show differences in-between browser handling"),this.invalidationEmitter.emit()}getStart(){return this._start===null&&(this._start=this.positionAtAngle(this._startAngle)),this._start}get start(){return this.getStart()}getEnd(){return this._end===null&&(this._end=this.positionAtAngle(this._endAngle)),this._end}get end(){return this.getEnd()}getStartTangent(){return this._startTangent===null&&(this._startTangent=this.tangentAtAngle(this._startAngle)),this._startTangent}get startTangent(){return this.getStartTangent()}getEndTangent(){return this._endTangent===null&&(this._endTangent=this.tangentAtAngle(this._endAngle)),this._endTangent}get endTangent(){return this.getEndTangent()}getActualEndAngle(){return this._actualEndAngle===null&&(this._actualEndAngle=Arc.computeActualEndAngle(this._startAngle,this._endAngle,this._anticlockwise)),this._actualEndAngle}get actualEndAngle(){return this.getActualEndAngle()}getIsFullPerimeter(){return this._isFullPerimeter===null&&(this._isFullPerimeter=!this._anticlockwise&&this._endAngle-this._startAngle>=Math.PI*2||this._anticlockwise&&this._startAngle-this._endAngle>=Math.PI*2),this._isFullPerimeter}get isFullPerimeter(){return this.getIsFullPerimeter()}getAngleDifference(){return this._angleDifference===null&&(this._angleDifference=this._anticlockwise?this._startAngle-this._endAngle:this._endAngle-this._startAngle,this._angleDifference<0&&(this._angleDifference+=Math.PI*2),assert&&assert(this._angleDifference>=0)),this._angleDifference}get angleDifference(){return this.getAngleDifference()}getBounds(){return this._bounds===null&&(this._bounds=Bounds2.NOTHING.copy().withPoint(this.getStart()).withPoint(this.getEnd()),this._startAngle!==this._endAngle&&(this.includeBoundsAtAngle(0),this.includeBoundsAtAngle(Math.PI/2),this.includeBoundsAtAngle(Math.PI),this.includeBoundsAtAngle(3*Math.PI/2))),this._bounds}get bounds(){return this.getBounds()}getNondegenerateSegments(){return this._radius<=0||this._startAngle===this._endAngle?[]:[this]}includeBoundsAtAngle(t){this.containsAngle(t)&&(this._bounds=this._bounds.withPoint(this._center.plus(Vector2.createPolar(this._radius,t))))}mapAngle(t){return Math.abs(DotUtils.moduloBetweenDown(t-this._startAngle,-Math.PI,Math.PI))<1e-8?this._startAngle:Math.abs(DotUtils.moduloBetweenDown(t-this.getActualEndAngle(),-Math.PI,Math.PI))<1e-8?this.getActualEndAngle():this._startAngle>this.getActualEndAngle()?DotUtils.moduloBetweenUp(t,this._startAngle-2*Math.PI,this._startAngle):DotUtils.moduloBetweenDown(t,this._startAngle,this._startAngle+2*Math.PI)}tAtAngle(t){const s=(this.mapAngle(t)-this._startAngle)/(this.getActualEndAngle()-this._startAngle);return assert&&assert(s>=0&&s<=1,`tAtAngle out of range: ${s}`),s}angleAt(t){return this._startAngle+(this.getActualEndAngle()-this._startAngle)*t}positionAtAngle(t){return this._center.plus(Vector2.createPolar(this._radius,t))}tangentAtAngle(t){const s=Vector2.createPolar(1,t);return this._anticlockwise?s.perpendicular:s.perpendicular.negated()}containsAngle(t){const s=this._anticlockwise?t-this._endAngle:t-this._startAngle;return DotUtils.moduloBetweenDown(s,0,Math.PI*2)<=this.angleDifference}getSVGPathFragment(){let t;if(assert&&(t=this._svgPathFragment,this._svgPathFragment=null),!this._svgPathFragment){const r=this._anticlockwise?"0":"1";let o;if(this.angleDifference<Math.PI*2-.01)o=this.angleDifference<Math.PI?"0":"1",this._svgPathFragment=`A ${svgNumber(this._radius)} ${svgNumber(this._radius)} 0 ${o} ${r} ${svgNumber(this.end.x)} ${svgNumber(this.end.y)}`;else{const n=(this._startAngle+this._endAngle)/2,l=this._center.plus(Vector2.createPolar(this._radius,n));o="0";const h=`A ${svgNumber(this._radius)} ${svgNumber(this._radius)} 0 ${o} ${r} ${svgNumber(l.x)} ${svgNumber(l.y)}`,g=`A ${svgNumber(this._radius)} ${svgNumber(this._radius)} 0 ${o} ${r} ${svgNumber(this.end.x)} ${svgNumber(this.end.y)}`;this._svgPathFragment=`${h} ${g}`}}return assert&&t&&assert(t===this._svgPathFragment,"Quadratic line segment changed without invalidate()"),this._svgPathFragment}strokeLeft(t){return[new Arc(this._center,this._radius+(this._anticlockwise?1:-1)*t/2,this._startAngle,this._endAngle,this._anticlockwise)]}strokeRight(t){return[new Arc(this._center,this._radius+(this._anticlockwise?-1:1)*t/2,this._endAngle,this._startAngle,!this._anticlockwise)]}getInteriorExtremaTs(){const t=[];return _.each([0,Math.PI/2,Math.PI,3*Math.PI/2],s=>{if(this.containsAngle(s)){const r=this.tAtAngle(s),o=1e-10;r>o&&r<1-o&&t.push(r)}}),t.sort()}intersection(t){const s=[],o=t.position.minus(this._center),n=t.direction.dot(o),l=o.magnitudeSquared,h=4*n*n-4*(l-this._radius*this._radius);if(h<0)return s;const g=t.direction.dot(this._center)-t.direction.dot(t.position),d=Math.sqrt(h)/2,A=g-d,S=g+d;if(S<0)return s;const O=t.pointAtDistance(S),I=O.minus(this._center).normalized(),W=I.angle;if(A<0)this.containsAngle(W)&&s.push(new RayIntersection(S,O,I.negated(),this._anticlockwise?-1:1,this.tAtAngle(W)));else{const L=t.pointAtDistance(A),H=L.minus(this._center).normalized(),Y=H.angle;this.containsAngle(Y)&&s.push(new RayIntersection(A,L,H,this._anticlockwise?1:-1,this.tAtAngle(Y))),this.containsAngle(W)&&s.push(new RayIntersection(S,O,I.negated(),this._anticlockwise?-1:1,this.tAtAngle(W)))}return s}windingIntersection(t){let s=0;const r=this.intersection(t);return _.each(r,o=>{s+=o.wind}),s}writeToContext(t){t.arc(this._center.x,this._center.y,this._radius,this._startAngle,this._endAngle,this._anticlockwise)}transformed(t){const s=t.timesVector2(Vector2.createPolar(1,this._startAngle)).minus(t.timesVector2(Vector2.ZERO)).angle;let r=t.timesVector2(Vector2.createPolar(1,this._endAngle)).minus(t.timesVector2(Vector2.ZERO)).angle;const o=t.getDeterminant()>=0?this._anticlockwise:!this._anticlockwise;Math.abs(this._endAngle-this._startAngle)===Math.PI*2&&(r=o?s-Math.PI*2:s+Math.PI*2);const n=t.getScaleVector();if(n.x!==n.y){const l=n.x*this._radius,h=n.y*this._radius;return new EllipticalArc(t.timesVector2(this._center),l,h,0,s,r,o)}else{const l=n.x*this._radius;return new Arc(t.timesVector2(this._center),l,s,r,o)}}getSignedAreaFragment(){const t=this._startAngle,s=this.getActualEndAngle();return .5*this._radius*(this._radius*(s-t)+this._center.x*(Math.sin(s)-Math.sin(t))-this._center.y*(Math.cos(s)-Math.cos(t)))}reversed(){return new Arc(this._center,this._radius,this._endAngle,this._startAngle,!this._anticlockwise)}getArcLength(){return this.getAngleDifference()*this._radius}toPiecewiseLinearOrArcSegments(){return[this]}serialize(){return{type:"Arc",centerX:this._center.x,centerY:this._center.y,radius:this._radius,startAngle:this._startAngle,endAngle:this._endAngle,anticlockwise:this._anticlockwise}}getOverlaps(t,s=1e-6){return t instanceof Arc?Arc.getOverlaps(this,t):null}getConicMatrix(){const t=this.center.x,s=this.center.y,r=1,o=0,n=1,l=-2*t,h=-2*s,g=t*t+s*s-this.radius*this.radius;return Matrix3.rowMajor(r,o/2,l/2,o/2,n,h/2,l/2,h/2,g)}static deserialize(t){return assert&&assert(t.type==="Arc"),new Arc(new Vector2(t.centerX,t.centerY),t.radius,t.startAngle,t.endAngle,t.anticlockwise)}static computeActualEndAngle(t,s,r){return r?t>s?s:t<s?s-2*Math.PI:t:t<s?s:t>s?s+Math.PI*2:t}static getPartialOverlap(t,s,r,o,n){assert&&assert(t>0&&t<=TWO_PI+1e-10),assert&&assert(s>=0&&s<TWO_PI+1e-10),assert&&assert(r>=0&&r<=TWO_PI+1e-10),assert&&assert(o>=0&&o<=1),assert&&assert(n>=0&&n<=1);const l=r<s,h=l?r:s,g=l?s:r,d=h,A=Math.min(t,g);return A<d+1e-8?[]:[Overlap.createLinear(DotUtils.clamp(DotUtils.linear(0,t,0,1,d),0,1),DotUtils.clamp(DotUtils.linear(s,r,o,n,d),0,1),DotUtils.clamp(DotUtils.linear(0,t,0,1,A),0,1),DotUtils.clamp(DotUtils.linear(s,r,o,n,A),0,1))]}static getAngularOverlaps(t,s,r,o){assert&&assert(isFinite(t)),assert&&assert(isFinite(s)),assert&&assert(isFinite(r)),assert&&assert(isFinite(o));let n=s-t;const l=n<0?-1:1;n*=l;const h=DotUtils.moduloBetweenDown(l*(r-t),0,TWO_PI),g=l*(o-r)+h;let d;return g<-1e-10?(d=-h/(g-h),Arc.getPartialOverlap(n,h,0,0,d).concat(Arc.getPartialOverlap(n,TWO_PI,g+TWO_PI,d,1))):g>TWO_PI+1e-10?(d=(TWO_PI-h)/(g-h),Arc.getPartialOverlap(n,h,TWO_PI,0,d).concat(Arc.getPartialOverlap(n,0,g-TWO_PI,d,1))):Arc.getPartialOverlap(n,h,g,0,1)}static getOverlaps(t,s){return t._center.distance(s._center)>1e-4||Math.abs(t._radius-s._radius)>1e-4?[]:Arc.getAngularOverlaps(t._startAngle,t.getActualEndAngle(),s._startAngle,s.getActualEndAngle())}static getCircleIntersectionPoint(t,s,r,o){assert&&assert(isFinite(s)&&s>=0),assert&&assert(isFinite(o)&&o>=0);const n=r.minus(t),l=n.magnitude;let h=[];if(!(l<1e-10||l>s+o+1e-10))if(l>s+o-1e-10)h=[t.blend(r,s/l)];else{const g=.5*(l*l-o*o+s*s)/l,d=l*l-o*o+s*s,A=4*l*l*s*s-d*d,S=t.blend(r,g/l);if(A>=1e-10){const O=Math.sqrt(A)/l/2,I=n.perpendicular.setMagnitude(O);h=[S.plus(I),S.minus(I)]}else A>-1e-10&&(h=[S])}return assert&&h.forEach(g=>{assert(Math.abs(g.distance(t)-s)<1e-8),assert(Math.abs(g.distance(r)-o)<1e-8)}),h}static intersect(t,s){const o=[];if(t._center.equalsEpsilon(s._center,1e-8)&&Math.abs(t._radius-s._radius)<1e-8){const n=t.positionAt(0),l=t.positionAt(1),h=s.positionAt(0),g=s.positionAt(1);n.equalsEpsilon(h,1e-8)&&o.push(new SegmentIntersection(n.average(h),0,0)),n.equalsEpsilon(g,1e-8)&&o.push(new SegmentIntersection(n.average(g),0,1)),l.equalsEpsilon(h,1e-8)&&o.push(new SegmentIntersection(l.average(h),1,0)),l.equalsEpsilon(g,1e-8)&&o.push(new SegmentIntersection(l.average(g),1,1))}else{const n=Arc.getCircleIntersectionPoint(t._center,t._radius,s._center,s._radius);for(let l=0;l<n.length;l++){const h=n[l],g=h.minus(t._center).angle,d=h.minus(s._center).angle;t.containsAngle(g)&&s.containsAngle(d)&&o.push(new SegmentIntersection(h,t.tAtAngle(g),s.tAtAngle(d)))}}return o}static createFromPoints(t,s,r){const o=DotUtils.circleCenterFromPoints(t,s,r);if(o===null)return new Line$1(t,r);{const n=t.minus(o),l=s.minus(o),h=r.minus(o),g=n.angle,d=l.angle,A=h.angle,S=(n.magnitude+l.magnitude+h.magnitude)/3,O=new Arc(o,S,g,A,!1);return O.containsAngle(d)?O:new Arc(o,S,g,A,!0)}}}kite.register("Arc",Arc);const toDegrees=DotUtils.toDegrees,unitCircleConicMatrix=Matrix3.rowMajor(1,0,0,0,1,0,0,0,-1);class EllipticalArc extends Segment{constructor(t,s,r,o,n,l,h){super(),this._center=t,this._radiusX=s,this._radiusY=r,this._rotation=o,this._startAngle=n,this._endAngle=l,this._anticlockwise=h,this.invalidate()}setCenter(t){return assert&&assert(t.isFinite(),`EllipticalArc center should be finite: ${t.toString()}`),this._center.equals(t)||(this._center=t,this.invalidate()),this}set center(t){this.setCenter(t)}get center(){return this.getCenter()}getCenter(){return this._center}setRadiusX(t){return assert&&assert(isFinite(t),`EllipticalArc radiusX should be a finite number: ${t}`),this._radiusX!==t&&(this._radiusX=t,this.invalidate()),this}set radiusX(t){this.setRadiusX(t)}get radiusX(){return this.getRadiusX()}getRadiusX(){return this._radiusX}setRadiusY(t){return assert&&assert(isFinite(t),`EllipticalArc radiusY should be a finite number: ${t}`),this._radiusY!==t&&(this._radiusY=t,this.invalidate()),this}set radiusY(t){this.setRadiusY(t)}get radiusY(){return this.getRadiusY()}getRadiusY(){return this._radiusY}setRotation(t){return assert&&assert(isFinite(t),`EllipticalArc rotation should be a finite number: ${t}`),this._rotation!==t&&(this._rotation=t,this.invalidate()),this}set rotation(t){this.setRotation(t)}get rotation(){return this.getRotation()}getRotation(){return this._rotation}setStartAngle(t){return assert&&assert(isFinite(t),`EllipticalArc startAngle should be a finite number: ${t}`),this._startAngle!==t&&(this._startAngle=t,this.invalidate()),this}set startAngle(t){this.setStartAngle(t)}get startAngle(){return this.getStartAngle()}getStartAngle(){return this._startAngle}setEndAngle(t){return assert&&assert(isFinite(t),`EllipticalArc endAngle should be a finite number: ${t}`),this._endAngle!==t&&(this._endAngle=t,this.invalidate()),this}set endAngle(t){this.setEndAngle(t)}get endAngle(){return this.getEndAngle()}getEndAngle(){return this._endAngle}setAnticlockwise(t){return this._anticlockwise!==t&&(this._anticlockwise=t,this.invalidate()),this}set anticlockwise(t){this.setAnticlockwise(t)}get anticlockwise(){return this.getAnticlockwise()}getAnticlockwise(){return this._anticlockwise}positionAt(t){return assert&&assert(t>=0,"positionAt t should be non-negative"),assert&&assert(t<=1,"positionAt t should be no greater than 1"),this.positionAtAngle(this.angleAt(t))}tangentAt(t){return assert&&assert(t>=0,"tangentAt t should be non-negative"),assert&&assert(t<=1,"tangentAt t should be no greater than 1"),this.tangentAtAngle(this.angleAt(t))}curvatureAt(t){assert&&assert(t>=0,"curvatureAt t should be non-negative"),assert&&assert(t<=1,"curvatureAt t should be no greater than 1");const s=this.angleAt(t),r=this._radiusX*Math.sin(s),o=this._radiusY*Math.cos(s),n=Math.pow(o*o+r*r,3/2);return(this._anticlockwise?-1:1)*this._radiusX*this._radiusY/n}subdivided(t){if(assert&&assert(t>=0,"subdivided t should be non-negative"),assert&&assert(t<=1,"subdivided t should be no greater than 1"),t===0||t===1)return[this];const s=this.angleAt(0),r=this.angleAt(t),o=this.angleAt(1);return[new EllipticalArc(this._center,this._radiusX,this._radiusY,this._rotation,s,r,this._anticlockwise),new EllipticalArc(this._center,this._radiusX,this._radiusY,this._rotation,r,o,this._anticlockwise)]}invalidate(){if(assert&&assert(this._center instanceof Vector2,"Arc center should be a Vector2"),assert&&assert(this._center.isFinite(),"Arc center should be finite (not NaN or infinite)"),assert&&assert(typeof this._radiusX=="number",`Arc radiusX should be a number: ${this._radiusX}`),assert&&assert(isFinite(this._radiusX),`Arc radiusX should be a finite number: ${this._radiusX}`),assert&&assert(typeof this._radiusY=="number",`Arc radiusY should be a number: ${this._radiusY}`),assert&&assert(isFinite(this._radiusY),`Arc radiusY should be a finite number: ${this._radiusY}`),assert&&assert(typeof this._rotation=="number",`Arc rotation should be a number: ${this._rotation}`),assert&&assert(isFinite(this._rotation),`Arc rotation should be a finite number: ${this._rotation}`),assert&&assert(typeof this._startAngle=="number",`Arc startAngle should be a number: ${this._startAngle}`),assert&&assert(isFinite(this._startAngle),`Arc startAngle should be a finite number: ${this._startAngle}`),assert&&assert(typeof this._endAngle=="number",`Arc endAngle should be a number: ${this._endAngle}`),assert&&assert(isFinite(this._endAngle),`Arc endAngle should be a finite number: ${this._endAngle}`),assert&&assert(typeof this._anticlockwise=="boolean",`Arc anticlockwise should be a boolean: ${this._anticlockwise}`),this._unitTransform=null,this._start=null,this._end=null,this._startTangent=null,this._endTangent=null,this._actualEndAngle=null,this._isFullPerimeter=null,this._angleDifference=null,this._unitArcSegment=null,this._bounds=null,this._svgPathFragment=null,this._radiusX<0&&(this._radiusX=-this._radiusX,this._startAngle=Math.PI-this._startAngle,this._endAngle=Math.PI-this._endAngle,this._anticlockwise=!this._anticlockwise),this._radiusY<0&&(this._radiusY=-this._radiusY,this._startAngle=-this._startAngle,this._endAngle=-this._endAngle,this._anticlockwise=!this._anticlockwise),this._radiusX<this._radiusY){this._rotation+=Math.PI/2,this._startAngle-=Math.PI/2,this._endAngle-=Math.PI/2;const t=this._radiusX;this._radiusX=this._radiusY,this._radiusY=t}if(this._radiusX<this._radiusY)throw new Error("Not verified to work if radiusX < radiusY");assert&&assert(!(!this._anticlockwise&&this._endAngle-this._startAngle<=-Math.PI*2||this._anticlockwise&&this._startAngle-this._endAngle<=-Math.PI*2),"Not handling elliptical arcs with start/end angles that show differences in-between browser handling"),assert&&assert(!(!this._anticlockwise&&this._endAngle-this._startAngle>Math.PI*2||this._anticlockwise&&this._startAngle-this._endAngle>Math.PI*2),"Not handling elliptical arcs with start/end angles that show differences in-between browser handling"),this.invalidationEmitter.emit()}getUnitTransform(){return this._unitTransform===null&&(this._unitTransform=EllipticalArc.computeUnitTransform(this._center,this._radiusX,this._radiusY,this._rotation)),this._unitTransform}get unitTransform(){return this.getUnitTransform()}getStart(){return this._start===null&&(this._start=this.positionAtAngle(this._startAngle)),this._start}get start(){return this.getStart()}getEnd(){return this._end===null&&(this._end=this.positionAtAngle(this._endAngle)),this._end}get end(){return this.getEnd()}getStartTangent(){return this._startTangent===null&&(this._startTangent=this.tangentAtAngle(this._startAngle)),this._startTangent}get startTangent(){return this.getStartTangent()}getEndTangent(){return this._endTangent===null&&(this._endTangent=this.tangentAtAngle(this._endAngle)),this._endTangent}get endTangent(){return this.getEndTangent()}getActualEndAngle(){return this._actualEndAngle===null&&(this._actualEndAngle=Arc.computeActualEndAngle(this._startAngle,this._endAngle,this._anticlockwise)),this._actualEndAngle}get actualEndAngle(){return this.getActualEndAngle()}getIsFullPerimeter(){return this._isFullPerimeter===null&&(this._isFullPerimeter=!this._anticlockwise&&this._endAngle-this._startAngle>=Math.PI*2||this._anticlockwise&&this._startAngle-this._endAngle>=Math.PI*2),this._isFullPerimeter}get isFullPerimeter(){return this.getIsFullPerimeter()}getAngleDifference(){return this._angleDifference===null&&(this._angleDifference=this._anticlockwise?this._startAngle-this._endAngle:this._endAngle-this._startAngle,this._angleDifference<0&&(this._angleDifference+=Math.PI*2),assert&&assert(this._angleDifference>=0)),this._angleDifference}get angleDifference(){return this.getAngleDifference()}getUnitArcSegment(){return this._unitArcSegment===null&&(this._unitArcSegment=new Arc(Vector2.ZERO,1,this._startAngle,this._endAngle,this._anticlockwise)),this._unitArcSegment}get unitArcSegment(){return this.getUnitArcSegment()}getBounds(){if(this._bounds===null&&(this._bounds=Bounds2.NOTHING.withPoint(this.getStart()).withPoint(this.getEnd()),this._startAngle!==this._endAngle)){const t=Math.atan(-(this._radiusY/this._radiusX)*Math.tan(this._rotation)),s=Math.atan(this._radiusY/this._radiusX/Math.tan(this._rotation));this.possibleExtremaAngles=[t,t+Math.PI,s,s+Math.PI],_.each(this.possibleExtremaAngles,this.includeBoundsAtAngle.bind(this))}return this._bounds}get bounds(){return this.getBounds()}getNondegenerateSegments(){if(this._radiusX<=0||this._radiusY<=0||this._startAngle===this._endAngle)return[];if(this._radiusX===this._radiusY){const t=this._startAngle+this._rotation;let s=this._endAngle+this._rotation;return Math.abs(this._endAngle-this._startAngle)===Math.PI*2&&(s=this._anticlockwise?t-Math.PI*2:t+Math.PI*2),[new Arc(this._center,this._radiusX,t,s,this._anticlockwise)]}else return[this]}includeBoundsAtAngle(t){this.unitArcSegment.containsAngle(t)&&(this._bounds=this._bounds.withPoint(this.positionAtAngle(t)))}mapAngle(t){return Math.abs(DotUtils.moduloBetweenDown(t-this._startAngle,-Math.PI,Math.PI))<1e-8?this._startAngle:Math.abs(DotUtils.moduloBetweenDown(t-this.getActualEndAngle(),-Math.PI,Math.PI))<1e-8?this.getActualEndAngle():this._startAngle>this.getActualEndAngle()?DotUtils.moduloBetweenUp(t,this._startAngle-2*Math.PI,this._startAngle):DotUtils.moduloBetweenDown(t,this._startAngle,this._startAngle+2*Math.PI)}tAtAngle(t){return(this.mapAngle(t)-this._startAngle)/(this.getActualEndAngle()-this._startAngle)}angleAt(t){return this._startAngle+(this.getActualEndAngle()-this._startAngle)*t}positionAtAngle(t){return this.getUnitTransform().transformPosition2(Vector2.createPolar(1,t))}tangentAtAngle(t){const s=this.getUnitTransform().transformNormal2(Vector2.createPolar(1,t));return this._anticlockwise?s.perpendicular:s.perpendicular.negated()}offsetTo(t,s){const o=[],n=[];for(let l=0;l<32;l++){let h=l/31;s&&(h=1-h);const g=this.angleAt(h);o.push(this.positionAtAngle(g).plus(this.tangentAtAngle(g).perpendicular.normalized().times(t))),l>0&&n.push(new Line$1(o[l-1],o[l]))}return n}getSVGPathFragment(){let t;if(assert&&(t=this._svgPathFragment,this._svgPathFragment=null),!this._svgPathFragment){const r=this._anticlockwise?"0":"1";let o;const n=toDegrees(this._rotation);if(this.getAngleDifference()<Math.PI*2-.01)o=this.getAngleDifference()<Math.PI?"0":"1",this._svgPathFragment=`A ${svgNumber(this._radiusX)} ${svgNumber(this._radiusY)} ${n} ${o} ${r} ${svgNumber(this.getEnd().x)} ${svgNumber(this.getEnd().y)}`;else{const l=(this._startAngle+this._endAngle)/2,h=this.positionAtAngle(l);o="0";const g=`A ${svgNumber(this._radiusX)} ${svgNumber(this._radiusY)} ${n} ${o} ${r} ${svgNumber(h.x)} ${svgNumber(h.y)}`,d=`A ${svgNumber(this._radiusX)} ${svgNumber(this._radiusY)} ${n} ${o} ${r} ${svgNumber(this.getEnd().x)} ${svgNumber(this.getEnd().y)}`;this._svgPathFragment=`${g} ${d}`}}return assert&&t&&assert(t===this._svgPathFragment,"Quadratic line segment changed without invalidate()"),this._svgPathFragment}strokeLeft(t){return this.offsetTo(-t/2,!1)}strokeRight(t){return this.offsetTo(t/2,!0)}getInteriorExtremaTs(){const t=[];return _.each(this.possibleExtremaAngles,s=>{if(this.unitArcSegment.containsAngle(s)){const r=this.tAtAngle(s),o=1e-10;r>o&&r<1-o&&t.push(r)}}),t.sort()}intersection(t){const s=this.getUnitTransform(),r=s.inverseRay2(t),o=this.getUnitArcSegment().intersection(r);return _.map(o,n=>{const l=s.transformPosition2(n.point),h=t.position.distance(l),g=s.inverseNormal2(n.normal);return new RayIntersection(h,l,g,n.wind,n.t)})}windingIntersection(t){const s=this.getUnitTransform().inverseRay2(t);return this.getUnitArcSegment().windingIntersection(s)}writeToContext(t){t.ellipse?t.ellipse(this._center.x,this._center.y,this._radiusX,this._radiusY,this._rotation,this._startAngle,this._endAngle,this._anticlockwise):(this.getUnitTransform().getMatrix().canvasAppendTransform(t),t.arc(0,0,1,this._startAngle,this._endAngle,this._anticlockwise),this.getUnitTransform().getInverse().canvasAppendTransform(t))}transformed(t){const s=t.timesVector2(Vector2.createPolar(this._radiusX,this._rotation)).minus(t.timesVector2(Vector2.ZERO)),r=t.timesVector2(Vector2.createPolar(this._radiusY,this._rotation+Math.PI/2)).minus(t.timesVector2(Vector2.ZERO)),o=s.angle,n=s.magnitude,l=r.magnitude,h=t.getDeterminant()<0,g=h?!this._anticlockwise:this._anticlockwise,d=h?-this._startAngle:this._startAngle;let A=h?-this._endAngle:this._endAngle;return Math.abs(this._endAngle-this._startAngle)===Math.PI*2&&(A=g?d-Math.PI*2:d+Math.PI*2),new EllipticalArc(t.timesVector2(this._center),n,l,o,d,A,g)}getSignedAreaFragment(){const t=this._startAngle,s=this.getActualEndAngle(),r=Math.sin(t),o=Math.sin(s),n=Math.cos(t),l=Math.cos(s);return .5*(this._radiusX*this._radiusY*(s-t)+Math.cos(this._rotation)*(this._radiusX*this._center.y*(n-l)+this._radiusY*this._center.x*(o-r))+Math.sin(this._rotation)*(this._radiusX*this._center.x*(l-n)+this._radiusY*this._center.y*(o-r)))}reversed(){return new EllipticalArc(this._center,this._radiusX,this._radiusY,this._rotation,this._endAngle,this._startAngle,!this._anticlockwise)}serialize(){return{type:"EllipticalArc",centerX:this._center.x,centerY:this._center.y,radiusX:this._radiusX,radiusY:this._radiusY,rotation:this._rotation,startAngle:this._startAngle,endAngle:this._endAngle,anticlockwise:this._anticlockwise}}getOverlaps(t,s=1e-6){return t instanceof EllipticalArc?EllipticalArc.getOverlaps(this,t):null}getConicMatrix(){const s=EllipticalArc.computeUnitMatrix(this._center,this._radiusX,this._radiusY,this._rotation).inverted();return s.transposed().multiplyMatrix(unitCircleConicMatrix).multiplyMatrix(s)}static deserialize(t){return assert&&assert(t.type==="EllipticalArc"),new EllipticalArc(new Vector2(t.centerX,t.centerY),t.radiusX,t.radiusY,t.rotation,t.startAngle,t.endAngle,t.anticlockwise)}static getOverlapType(t,s,r=1e-4){if(t._center.distance(s._center)<r){const o=Math.abs(t._radiusX-s._radiusX)<r&&Math.abs(t._radiusY-s._radiusY)<r,n=Math.abs(t._radiusX-s._radiusY)<r&&Math.abs(t._radiusY-s._radiusX)<r;if(o&&Math.abs(DotUtils.moduloBetweenDown(t._rotation-s._rotation+Math.PI/2,0,Math.PI)-Math.PI/2)<r)return EllipticalArcOverlapType.MATCHING_OVERLAP;if(n&&Math.abs(DotUtils.moduloBetweenDown(t._rotation-s._rotation,0,Math.PI)-Math.PI/2)<r)return EllipticalArcOverlapType.OPPOSITE_OVERLAP}return EllipticalArcOverlapType.NONE}static getOverlaps(t,s){return EllipticalArc.getOverlapType(t,s)===EllipticalArcOverlapType.NONE?[]:Arc.getAngularOverlaps(t._startAngle+t._rotation,t.getActualEndAngle()+t._rotation,s._startAngle+s._rotation,s.getActualEndAngle()+s._rotation)}static intersect(t,s,r=1e-10){if(EllipticalArc.getOverlapType(t,s,r)===EllipticalArcOverlapType.NONE)return BoundsIntersection.intersect(t,s);{const n=[],l=t.positionAt(0),h=t.positionAt(1),g=s.positionAt(0),d=s.positionAt(1);return l.equalsEpsilon(g,r)&&n.push(new SegmentIntersection(l.average(g),0,0)),l.equalsEpsilon(d,r)&&n.push(new SegmentIntersection(l.average(d),0,1)),h.equalsEpsilon(g,r)&&n.push(new SegmentIntersection(h.average(g),1,0)),h.equalsEpsilon(d,r)&&n.push(new SegmentIntersection(h.average(d),1,1)),n}}static computeUnitMatrix(t,s,r,o){return Matrix3.translationFromVector(t).timesMatrix(Matrix3.rotation2(o)).timesMatrix(Matrix3.scaling(s,r))}static computeUnitTransform(t,s,r,o){return new Transform3(EllipticalArc.computeUnitMatrix(t,s,r,o))}}const uo=class uo extends EnumerationValue{};uo.MATCHING_OVERLAP=new uo,uo.OPPOSITE_OVERLAP=new uo,uo.NONE=new uo,uo.enumeration=new Enumeration(uo);let EllipticalArcOverlapType=uo;kite.register("EllipticalArc",EllipticalArc);class Subpath{constructor(t,s,r){if(this.segments=[],this.invalidatedEmitter=new TinyEmitter,this._bounds=null,this._strokedSubpaths=null,this._strokedSubpathsComputed=!1,this._strokedStyles=null,this._invalidatingPoints=!1,this.points=s||(t&&t.length?_.map(t,o=>o.start).concat(t[t.length-1].end):[]),this.closed=!!r,this._invalidateListener=this.invalidate.bind(this),t)for(let o=0;o<t.length;o++)_.each(t[o].getNondegenerateSegments(),n=>{this.addSegmentDirectly(n)})}getBounds(){if(this._bounds===null){const t=Bounds2.NOTHING.copy();_.each(this.segments,s=>{t.includeBounds(s.getBounds())}),this._bounds=t}return this._bounds}get bounds(){return this.getBounds()}getArcLength(t,s,r){let o=0;for(let n=0;n<this.segments.length;n++)o+=this.segments[n].getArcLength(t,s,r);return o}copy(){return new Subpath(this.segments.slice(0),this.points.slice(0),this.closed)}invalidatePoints(){this._invalidatingPoints=!0;const t=this.segments.length;for(let s=0;s<t;s++)this.segments[s].invalidate();this._invalidatingPoints=!1,this.invalidate()}invalidate(){this._invalidatingPoints||(this._bounds=null,this._strokedSubpathsComputed=!1,this.invalidatedEmitter.emit())}addPoint(t){return this.points.push(t),this}addSegmentDirectly(t){return assert&&assert(t.start.isFinite(),"Segment start is infinite"),assert&&assert(t.end.isFinite(),"Segment end is infinite"),assert&&assert(t.startTangent.isFinite(),"Segment startTangent is infinite"),assert&&assert(t.endTangent.isFinite(),"Segment endTangent is infinite"),assert&&assert(t.bounds.isEmpty()||t.bounds.isFinite(),"Segment bounds is infinite and non-empty"),this.segments.push(t),t.invalidationEmitter.addListener(this._invalidateListener),this}addSegment(t){const r=t.getNondegenerateSegments().length;for(let o=0;o<r;o++)this.addSegmentDirectly(t);return this.invalidate(),this}addClosingSegment(){if(this.hasClosingSegment()){const t=this.getClosingSegment();this.addSegmentDirectly(t),this.invalidate(),this.addPoint(this.getFirstPoint()),this.closed=!0}}close(){this.closed=!0,this.addClosingSegment()}getLength(){return this.points.length}getFirstPoint(){return assert&&assert(this.points.length),_.first(this.points)}getLastPoint(){return assert&&assert(this.points.length),_.last(this.points)}getFirstSegment(){return assert&&assert(this.segments.length),_.first(this.segments)}getLastSegment(){return assert&&assert(this.segments.length),_.last(this.segments)}getFillSegments(){const t=this.segments.slice();return this.hasClosingSegment()&&t.push(this.getClosingSegment()),t}isDrawable(){return this.segments.length>0}isClosed(){return this.closed}hasClosingSegment(){return!this.getFirstPoint().equalsEpsilon(this.getLastPoint(),1e-9)}getClosingSegment(){return assert&&assert(this.hasClosingSegment(),"Implicit closing segment unnecessary on a fully closed path"),new Line$1(this.getLastPoint(),this.getFirstPoint())}getClosestPoints(t){return Segment.filterClosestToPointResult(_.flatten(this.segments.map(s=>s.getClosestPoints(t))))}writeToContext(t){if(this.isDrawable()){const s=this.getFirstSegment().start;t.moveTo(s.x,s.y);let r=this.segments.length;this.closed&&r>=2&&this.segments[r-1]instanceof Line$1&&r--;for(let o=0;o<r;o++)this.segments[o].writeToContext(t);this.closed&&t.closePath()}}toPiecewiseLinear(t){return assert&&assert(!t.pointMap,"For use with pointMap, please use nonlinearTransformed"),new Subpath(_.flatten(_.map(this.segments,s=>s.toPiecewiseLinearSegments(t))),void 0,this.closed)}transformed(t){return new Subpath(_.map(this.segments,s=>s.transformed(t)),_.map(this.points,s=>t.timesVector2(s)),this.closed)}nonlinearTransformed(t){return new Subpath(_.flatten(_.map(this.segments,s=>t.methodName&&s[t.methodName]?s[t.methodName](t):s.toPiecewiseLinearSegments(t))),void 0,this.closed)}getBoundsWithTransform(t){const s=Bounds2.NOTHING.copy(),r=this.segments.length;for(let o=0;o<r;o++)s.includeBounds(this.segments[o].getBoundsWithTransform(t));return s}offset(t){if(!this.isDrawable())return new Subpath([],void 0,this.closed);if(t===0)return new Subpath(this.segments.slice(),void 0,this.closed);let s;const r=this.segments.slice(),o=[];for(s=0;s<r.length;s++)o.push(r[s].strokeLeft(2*t));let n=[];for(s=0;s<r.length;s++){if(this.closed||s>0){const l=(s>0?s:r.length)-1,h=r[s].start,g=r[l].endTangent,d=r[s].startTangent,A=g.perpendicular.negated().times(t).angle,S=d.perpendicular.negated().times(t).angle,O=g.perpendicular.dot(d)>0;n.push(new Arc(h,Math.abs(t),A,S,O))}n=n.concat(o[s])}return new Subpath(n,void 0,this.closed)}stroked(t){if(!this.isDrawable())return[];if(t===void 0&&(t=new LineStyles),assert&&assert(!this._strokedSubpathsComputed||this._strokedStyles&&this._strokedSubpaths),this._strokedSubpathsComputed&&this._strokedStyles.equals(t))return this._strokedSubpaths;const s=t.lineWidth;let r,o=[],n=[];const l=this.getFirstSegment(),h=this.getLastSegment(),g=I=>{o=o.concat(I)},d=I=>{n=n.concat(I)},A=h.end.equals(l.start),S=A?null:new Line$1(this.segments[this.segments.length-1].end,this.segments[0].start);for(r=0;r<this.segments.length;r++)r>0&&g(t.leftJoin(this.segments[r].start,this.segments[r-1].endTangent,this.segments[r].startTangent)),g(this.segments[r].strokeLeft(s));for(r=this.segments.length-1;r>=0;r--)r<this.segments.length-1&&d(t.rightJoin(this.segments[r].end,this.segments[r].endTangent,this.segments[r+1].startTangent)),d(this.segments[r].strokeRight(s));let O;return this.closed?(A?(g(t.leftJoin(h.end,h.endTangent,l.startTangent)),d(t.rightJoin(h.end,h.endTangent,l.startTangent))):(g(t.leftJoin(S.start,h.endTangent,S.startTangent)),g(S.strokeLeft(s)),g(t.leftJoin(S.end,S.endTangent,l.startTangent)),d(t.rightJoin(S.end,S.endTangent,l.startTangent)),d(S.strokeRight(s)),d(t.rightJoin(S.start,h.endTangent,S.startTangent))),O=[new Subpath(o,void 0,!0),new Subpath(n,void 0,!0)]):O=[new Subpath(o.concat(t.cap(h.end,h.endTangent)).concat(n).concat(t.cap(l.start,l.startTangent.negated())),void 0,!0)],this._strokedSubpaths=O,this._strokedSubpathsComputed=!0,this._strokedStyles=t.copy(),O}dashed(t,s,r,o){const n=(g,d)=>{const A=g[g.length-1].concat(d[0]),S=g.slice(0,g.length-1).concat([A]).concat(d.slice(1));return assert&&assert(S.length===g.length+d.length-1),S},l=(g,d)=>{if(!g.hasRightFilled||!d.hasLeftFilled)return!1;const A=_.last(_.last(g.segmentArrays)),S=d.segmentArrays[0][0];return A.end.distance(S.start)<1e-5},h=[];for(let g=0;g<this.segments.length;g++){const d=this.segments[g],A=d.getDashValues(t,s,r,o);h.push(A),s+=A.arcLength;const S=[0].concat(A.values).concat([1]),O=A.initiallyInside;A.hasLeftFilled=O,A.hasRightFilled=S.length%2===0?O:!O,A.segmentArrays=[];for(let I=O?0:1;I<S.length-1;I+=2)S[I]!==S[I+1]&&A.segmentArrays.push([d.slice(S[I],S[I+1])])}for(let g=h.length-1;g>=1;g--){const d=h[g-1],A=h[g];l(d,A)&&h.splice(g-1,2,{segmentArrays:n(d.segmentArrays,A.segmentArrays),hasLeftFilled:d.hasLeftFilled,hasRightFilled:A.hasRightFilled})}if(h.length>1&&l(h[h.length-1],h[0])){const g=h.pop(),d=h.shift();h.push({segmentArrays:n(g.segmentArrays,d.segmentArrays),hasLeftFilled:g.hasLeftFilled,hasRightFilled:d.hasRightFilled})}return this.closed&&h.length===1&&h[0].segmentArrays.length===1&&h[0].hasLeftFilled&&h[0].hasRightFilled?[new Subpath(h[0].segmentArrays[0],void 0,!0)]:_.flatten(h.map(g=>g.segmentArrays)).map(g=>new Subpath(g))}serialize(){return{type:"Subpath",segments:this.segments.map(t=>t.serialize()),points:this.points.map(t=>({x:t.x,y:t.y})),closed:this.closed}}static deserialize(t){return assert&&assert(t.type==="Subpath"),new Subpath(t.segments.map(Segment.deserialize),t.points.map(s=>new Vector2(s.x,s.y)),t.closed)}}kite.register("Subpath",Subpath);const Subpath$1=Subpath,randomSource=Math.random,v=(a,t)=>new Vector2(a,t),weightedSplineVector=(a,t,s,r)=>s.copy().subtract(a).multiplyScalar((1-r)/6).add(t),ks=class ks{constructor(t,s){if(this.subpaths=[],this._invalidatingPoints=!1,this._immutable=!1,this.invalidatedEmitter=new TinyEmitter,this.lastQuadraticControlPoint=null,this.lastCubicControlPoint=null,this._bounds=s?s.copy():null,this.resetControlPoints(),this._invalidateListener=this.invalidate.bind(this),typeof t=="object")for(let r=0;r<t.length;r++)this.addSubpath(t[r]);t&&typeof t!="object"&&_.each(svgPath.parse(t),r=>{assert&&assert(ks.prototype[r.cmd]!==void 0,`method ${r.cmd} from parsed SVG does not exist`),this[r.cmd].apply(this,r.args)}),this.invalidate()}resetControlPoints(){this.lastQuadraticControlPoint=null,this.lastCubicControlPoint=null}setQuadraticControlPoint(t){this.lastQuadraticControlPoint=t,this.lastCubicControlPoint=null}setCubicControlPoint(t){this.lastQuadraticControlPoint=null,this.lastCubicControlPoint=t}moveTo(t,s){return assert&&assert(isFinite(t),`x must be a finite number: ${t}`),assert&&assert(isFinite(s),`y must be a finite number: ${s}`),this.moveToPoint(v(t,s))}moveToRelative(t,s){return assert&&assert(isFinite(t),`x must be a finite number: ${t}`),assert&&assert(isFinite(s),`y must be a finite number: ${s}`),this.moveToPointRelative(v(t,s))}moveToPointRelative(t){return this.moveToPoint(this.getRelativePoint().plus(t))}moveToPoint(t){return this.addSubpath(new Subpath$1().addPoint(t)),this.resetControlPoints(),this}lineTo(t,s){return assert&&assert(isFinite(t),`x must be a finite number: ${t}`),assert&&assert(isFinite(s),`y must be a finite number: ${s}`),this.lineToPoint(v(t,s))}lineToRelative(t,s){return assert&&assert(isFinite(t),`x must be a finite number: ${t}`),assert&&assert(isFinite(s),`y must be a finite number: ${s}`),this.lineToPointRelative(v(t,s))}lineToPointRelative(t){return this.lineToPoint(this.getRelativePoint().plus(t))}lineToPoint(t){if(this.hasSubpaths()){const s=this.getLastSubpath().getLastPoint(),r=t,o=new Line$1(s,r);this.getLastSubpath().addPoint(r),this.addSegmentAndBounds(o)}else this.ensure(t);return this.resetControlPoints(),this}horizontalLineTo(t){return this.lineTo(t,this.getRelativePoint().y)}horizontalLineToRelative(t){return this.lineToRelative(t,0)}verticalLineTo(t){return this.lineTo(this.getRelativePoint().x,t)}verticalLineToRelative(t){return this.lineToRelative(0,t)}zigZagTo(t,s,r,o,n){return this.zigZagToPoint(new Vector2(t,s),r,o,n)}zigZagToPoint(t,s,r,o){assert&&assert(Number.isInteger(r),`numberZigZags must be an integer: ${r}`),this.ensure(t);const n=this.getLastPoint(),l=t.minus(n),h=l.normalized(),g=h.perpendicular.times(s);let d;o?d=l.magnitude/(r+.5):d=l.magnitude/r;for(let A=0;A<r;A++){const S=h.times(A*d).plus(n),O=S.plus(h.times(d/4)).plus(g),I=S.plus(h.times(3*d/4)).minus(g);this.lineToPoint(O),this.lineToPoint(I)}if(o){const S=h.times(r*d).plus(n).plus(h.times(d/4)).plus(g);this.lineToPoint(S)}return this.lineToPoint(t)}quadraticCurveTo(t,s,r,o){return assert&&assert(isFinite(t),`cpx must be a finite number: ${t}`),assert&&assert(isFinite(s),`cpy must be a finite number: ${s}`),assert&&assert(isFinite(r),`x must be a finite number: ${r}`),assert&&assert(isFinite(o),`y must be a finite number: ${o}`),this.quadraticCurveToPoint(v(t,s),v(r,o))}quadraticCurveToRelative(t,s,r,o){return assert&&assert(isFinite(t),`cpx must be a finite number: ${t}`),assert&&assert(isFinite(s),`cpy must be a finite number: ${s}`),assert&&assert(isFinite(r),`x must be a finite number: ${r}`),assert&&assert(isFinite(o),`y must be a finite number: ${o}`),this.quadraticCurveToPointRelative(v(t,s),v(r,o))}quadraticCurveToPointRelative(t,s){const r=this.getRelativePoint();return this.quadraticCurveToPoint(r.plus(t),r.plus(s))}smoothQuadraticCurveTo(t,s){return assert&&assert(isFinite(t),`x must be a finite number: ${t}`),assert&&assert(isFinite(s),`y must be a finite number: ${s}`),this.quadraticCurveToPoint(this.getSmoothQuadraticControlPoint(),v(t,s))}smoothQuadraticCurveToRelative(t,s){return assert&&assert(isFinite(t),`x must be a finite number: ${t}`),assert&&assert(isFinite(s),`y must be a finite number: ${s}`),this.quadraticCurveToPoint(this.getSmoothQuadraticControlPoint(),v(t,s).plus(this.getRelativePoint()))}quadraticCurveToPoint(t,s){this.ensure(t);const r=this.getLastSubpath().getLastPoint(),o=new Quadratic(r,t,s);this.getLastSubpath().addPoint(s);const n=o.getNondegenerateSegments();return _.each(n,l=>{this.addSegmentAndBounds(l)}),this.setQuadraticControlPoint(t),this}cubicCurveTo(t,s,r,o,n,l){return assert&&assert(isFinite(t),`cp1x must be a finite number: ${t}`),assert&&assert(isFinite(s),`cp1y must be a finite number: ${s}`),assert&&assert(isFinite(r),`cp2x must be a finite number: ${r}`),assert&&assert(isFinite(o),`cp2y must be a finite number: ${o}`),assert&&assert(isFinite(n),`x must be a finite number: ${n}`),assert&&assert(isFinite(l),`y must be a finite number: ${l}`),this.cubicCurveToPoint(v(t,s),v(r,o),v(n,l))}cubicCurveToRelative(t,s,r,o,n,l){return assert&&assert(isFinite(t),`cp1x must be a finite number: ${t}`),assert&&assert(isFinite(s),`cp1y must be a finite number: ${s}`),assert&&assert(isFinite(r),`cp2x must be a finite number: ${r}`),assert&&assert(isFinite(o),`cp2y must be a finite number: ${o}`),assert&&assert(isFinite(n),`x must be a finite number: ${n}`),assert&&assert(isFinite(l),`y must be a finite number: ${l}`),this.cubicCurveToPointRelative(v(t,s),v(r,o),v(n,l))}cubicCurveToPointRelative(t,s,r){const o=this.getRelativePoint();return this.cubicCurveToPoint(o.plus(t),o.plus(s),o.plus(r))}smoothCubicCurveTo(t,s,r,o){return assert&&assert(isFinite(t),`cp2x must be a finite number: ${t}`),assert&&assert(isFinite(s),`cp2y must be a finite number: ${s}`),assert&&assert(isFinite(r),`x must be a finite number: ${r}`),assert&&assert(isFinite(o),`y must be a finite number: ${o}`),this.cubicCurveToPoint(this.getSmoothCubicControlPoint(),v(t,s),v(r,o))}smoothCubicCurveToRelative(t,s,r,o){return assert&&assert(isFinite(t),`cp2x must be a finite number: ${t}`),assert&&assert(isFinite(s),`cp2y must be a finite number: ${s}`),assert&&assert(isFinite(r),`x must be a finite number: ${r}`),assert&&assert(isFinite(o),`y must be a finite number: ${o}`),this.cubicCurveToPoint(this.getSmoothCubicControlPoint(),v(t,s).plus(this.getRelativePoint()),v(r,o).plus(this.getRelativePoint()))}cubicCurveToPoint(t,s,r){this.ensure(t);const o=this.getLastSubpath().getLastPoint(),l=new Cubic(o,t,s,r).getNondegenerateSegments();return _.each(l,h=>{this.addSegmentAndBounds(h)}),this.getLastSubpath().addPoint(r),this.setCubicControlPoint(s),this}arc(t,s,r,o,n,l){return assert&&assert(isFinite(t),`centerX must be a finite number: ${t}`),assert&&assert(isFinite(s),`centerY must be a finite number: ${s}`),this.arcPoint(v(t,s),r,o,n,l)}arcPoint(t,s,r,o,n){n===void 0&&(n=!1);const l=new Arc(t,s,r,o,n),h=l.getStart(),g=l.getEnd();return this.hasSubpaths()&&this.getLastSubpath().getLength()>0&&!h.equals(this.getLastSubpath().getLastPoint())&&this.addSegmentAndBounds(new Line$1(this.getLastSubpath().getLastPoint(),h)),this.hasSubpaths()||this.addSubpath(new Subpath$1),this.getLastSubpath().addPoint(h),this.getLastSubpath().addPoint(g),this.addSegmentAndBounds(l),this.resetControlPoints(),this}ellipticalArc(t,s,r,o,n,l,h,g){return assert&&assert(isFinite(t),`centerX must be a finite number: ${t}`),assert&&assert(isFinite(s),`centerY must be a finite number: ${s}`),this.ellipticalArcPoint(v(t,s),r,o,n,l,h,g)}ellipticalArcPoint(t,s,r,o,n,l,h){h===void 0&&(h=!1);const g=new EllipticalArc(t,s,r,o,n,l,h),d=g.start,A=g.end;return this.hasSubpaths()&&this.getLastSubpath().getLength()>0&&!d.equals(this.getLastSubpath().getLastPoint())&&this.addSegmentAndBounds(new Line$1(this.getLastSubpath().getLastPoint(),d)),this.hasSubpaths()||this.addSubpath(new Subpath$1),this.getLastSubpath().addPoint(d),this.getLastSubpath().addPoint(A),this.addSegmentAndBounds(g),this.resetControlPoints(),this}close(){if(this.hasSubpaths()){const t=this.getLastSubpath(),s=new Subpath$1;t.close(),this.addSubpath(s),s.addPoint(t.getFirstPoint())}return this.resetControlPoints(),this}newSubpath(){return this.addSubpath(new Subpath$1),this.resetControlPoints(),this}makeImmutable(){return this._immutable=!0,this.notifyInvalidationListeners(),this}isImmutable(){return this._immutable}ellipticalArcToRelative(t,s,r,o,n,l,h){const g=this.getRelativePoint();return this.ellipticalArcTo(t,s,r,o,n,l+g.x,h+g.y)}ellipticalArcTo(t,s,r,o,n,l,h){const g=new Vector2(l,h);this.ensure(g);const d=this.getLastSubpath().getLastPoint();this.getLastSubpath().addPoint(g),t<0&&(t*=-1),s<0&&(s*=-1);let A=t*t,S=s*s;const O=d.minus(g).dividedScalar(2).rotated(-r),I=O.x*O.x,W=O.y*O.y;let L=new Vector2(t*O.y/s,-s*O.x/t);const H=I/A+W/S;H>1&&(t*=Math.sqrt(H),s*=Math.sqrt(H),A=t*t,S=s*s,L=new Vector2(t*O.y/s,-s*O.x/t)),L.multiplyScalar(Math.sqrt(Math.max(0,(A*S-A*W-S*I)/(A*W+S*I)))),o===n&&L.multiplyScalar(-1);const Y=d.blend(g,.5).plus(L.rotated(r)),Q=(Z,ne)=>(Z.x*ne.y-Z.y*ne.x>0?1:-1)*Z.angleBetween(ne),pe=new Vector2((O.x-L.x)/t,(O.y-L.y)/s),de=new Vector2((-O.x-L.x)/t,(-O.y-L.y)/s),fe=Q(Vector2.X_UNIT,pe);let ye=Q(pe,de)%(Math.PI*2);!n&&ye>0&&(ye-=Math.PI*2),n&&ye<0&&(ye+=Math.PI*2);const Le=new EllipticalArc(Y,t,s,r,fe,fe+ye,!n).getNondegenerateSegments();return _.each(Le,Z=>{this.addSegmentAndBounds(Z)}),this}circle(t,s,r){if(typeof t=="object"){const o=t;return r=s,this.arcPoint(o,r,0,Math.PI*2,!1).close()}else return assert&&assert(isFinite(t),`centerX must be a finite number: ${t}`),assert&&assert(isFinite(s),`centerY must be a finite number: ${s}`),this.arcPoint(v(t,s),r,0,Math.PI*2,!1).close()}ellipse(t,s,r,o,n){if(typeof t=="object"){const l=t;return n=o,o=r,r=s,this.ellipticalArcPoint(l,r,o,n||0,0,Math.PI*2,!1).close()}else return assert&&assert(isFinite(t),`centerX must be a finite number: ${t}`),assert&&assert(isFinite(s),`centerY must be a finite number: ${s}`),this.ellipticalArcPoint(v(t,s),r,o,n||0,0,Math.PI*2,!1).close()}rect(t,s,r,o){assert&&assert(isFinite(t),`x must be a finite number: ${t}`),assert&&assert(isFinite(s),`y must be a finite number: ${s}`),assert&&assert(isFinite(r),`width must be a finite number: ${r}`),assert&&assert(isFinite(o),`height must be a finite number: ${o}`);const n=new Subpath$1;return this.addSubpath(n),n.addPoint(v(t,s)),n.addPoint(v(t+r,s)),n.addPoint(v(t+r,s+o)),n.addPoint(v(t,s+o)),this.addSegmentAndBounds(new Line$1(n.points[0],n.points[1])),this.addSegmentAndBounds(new Line$1(n.points[1],n.points[2])),this.addSegmentAndBounds(new Line$1(n.points[2],n.points[3])),n.close(),this.addSubpath(new Subpath$1),this.getLastSubpath().addPoint(v(t,s)),assert&&assert(!isNaN(this.bounds.getX())),this.resetControlPoints(),this}roundRect(t,s,r,o,n,l){const h=t+n,g=t+r-n,d=s+l,A=s+o-l;return n===l?this.arc(g,d,n,-Math.PI/2,0,!1).arc(g,A,n,0,Math.PI/2,!1).arc(h,A,n,Math.PI/2,Math.PI,!1).arc(h,d,n,Math.PI,Math.PI*3/2,!1).close():this.ellipticalArc(g,d,n,l,0,-Math.PI/2,0,!1).ellipticalArc(g,A,n,l,0,0,Math.PI/2,!1).ellipticalArc(h,A,n,l,0,Math.PI/2,Math.PI,!1).ellipticalArc(h,d,n,l,0,Math.PI,Math.PI*3/2,!1).close(),this}polygon(t){const s=t.length;if(s>0){this.moveToPoint(t[0]);for(let r=1;r<s;r++)this.lineToPoint(t[r])}return this.close()}cardinalSpline(t,s){const r=optionize()({tension:0,isClosedLineSegments:!1},s);assert&&assert(r.tension<1&&r.tension>-1," the tension goes from -1 to 1 ");const o=t.length,n=r.isClosedLineSegments?o:o-1;for(let l=0;l<n;l++){let h;l===0&&!r.isClosedLineSegments?h=[t[0],t[0],t[1],t[2]]:l===n-1&&!r.isClosedLineSegments?h=[t[l-1],t[l],t[l+1],t[l+1]]:h=[t[(l-1+o)%o],t[l%o],t[(l+1)%o],t[(l+2)%o]];const g=[h[1],weightedSplineVector(h[0],h[1],h[2],r.tension),weightedSplineVector(h[3],h[2],h[1],r.tension),h[2]];l===0&&(this.ensure(g[0]),this.getLastSubpath().addPoint(g[0])),this.cubicCurveToPoint(g[1],g[2],g[3])}return this}copy(){return new ks(_.map(this.subpaths,t=>t.copy()),this.bounds)}writeToContext(t){const s=this.subpaths.length;for(let r=0;r<s;r++)this.subpaths[r].writeToContext(t)}getSVGPath(){let t="";const s=this.subpaths.length;for(let r=0;r<s;r++){const o=this.subpaths[r];if(o.isDrawable()){const n=o.segments[0].start;t+=`M ${svgNumber(n.x)} ${svgNumber(n.y)} `;for(let l=0;l<o.segments.length;l++)t+=`${o.segments[l].getSVGPathFragment()} `;o.isClosed()&&(t+="Z ")}}return t}transformed(t){const s=_.map(this.subpaths,o=>o.transformed(t)),r=_.reduce(s,(o,n)=>o.union(n.bounds),Bounds2.NOTHING);return new ks(s,r)}nonlinearTransformed(t){const s=combineOptions({minLevels:0,maxLevels:7,distanceEpsilon:.16,curveEpsilon:t&&t.includeCurvature?.002:null},t),r=_.map(this.subpaths,n=>n.nonlinearTransformed(s)),o=_.reduce(r,(n,l)=>n.union(l.bounds),Bounds2.NOTHING);return new ks(r,o)}polarToCartesian(t){return this.nonlinearTransformed(combineOptions({pointMap:s=>Vector2.createPolar(s.y,s.x),methodName:"polarToCartesian"},t))}toPiecewiseLinear(t){return assert&&assert(!t||!t.pointMap,"No pointMap for toPiecewiseLinear allowed, since it could create non-linear segments"),assert&&assert(!t||!t.methodName,"No methodName for toPiecewiseLinear allowed, since it could create non-linear segments"),this.nonlinearTransformed(t)}containsPoint(t){const s=Vector2.X_UNIT.copy();let r=0;for(;r<5&&(r++,_.some(this.subpaths,n=>_.some(n.segments,l=>{const h=l.start.minus(t),g=h.magnitude;return g!==0?(h.divideScalar(g),h.subtract(s),h.magnitudeSquared<1e-9):!1})));)s.rotate(dotRandom.nextDouble());return this.windingIntersection(new Ray2(t,s))!==0}intersection(t){let s=[];const r=this.subpaths.length;for(let o=0;o<r;o++){const n=this.subpaths[o];if(n.isDrawable()){const l=n.segments.length;for(let h=0;h<l;h++){const g=n.segments[h];s=s.concat(g.intersection(t))}n.hasClosingSegment()&&(s=s.concat(n.getClosingSegment().intersection(t)))}}return _.sortBy(s,o=>o.distance)}interiorIntersectsLineSegment(t,s){const r=t.blend(s,.5);if(this.containsPoint(r))return!0;const o=s.minus(t),n=o.magnitude;if(n===0)return!1;o.normalize();const l=this.intersection(new Ray2(t,o));for(let h=0;h<l.length;h++)if(l[h].distance<=n)return!0;return!1}windingIntersection(t){let s=0;const r=this.subpaths.length;for(let o=0;o<r;o++){const n=this.subpaths[o];if(n.isDrawable()){const l=n.segments.length;for(let h=0;h<l;h++)s+=n.segments[h].windingIntersection(t);n.hasClosingSegment()&&(s+=n.getClosingSegment().windingIntersection(t))}}return s}intersectsBounds(t){if(this.bounds.intersection(t).equals(this.bounds))return!0;const s=new Ray2(new Vector2(t.minX,t.minY),new Vector2(1,0)),r=new Ray2(new Vector2(t.minX,t.minY),new Vector2(0,1)),o=new Ray2(new Vector2(t.maxX,t.maxY),new Vector2(-1,0)),n=new Ray2(new Vector2(t.maxX,t.maxY),new Vector2(0,-1));let l,h;const g=this.intersection(s).concat(this.intersection(o));for(h=0;h<g.length;h++)if(l=g[h].point,l.x>=t.minX&&l.x<=t.maxX)return!0;const d=this.intersection(r).concat(this.intersection(n));for(h=0;h<d.length;h++)if(l=d[h].point,l.y>=t.minY&&l.y<=t.maxY)return!0;return!1}getStrokedShape(t){let s=[];const r=Bounds2.NOTHING.copy();let o=this.subpaths.length;for(let n=0;n<o;n++){const h=this.subpaths[n].stroked(t);s=s.concat(h)}o=s.length;for(let n=0;n<o;n++)r.includeBounds(s[n].bounds);return new ks(s,r)}getOffsetShape(t){const s=[],r=Bounds2.NOTHING.copy();let o=this.subpaths.length;for(let n=0;n<o;n++)s.push(this.subpaths[n].offset(t));o=s.length;for(let n=0;n<o;n++)r.includeBounds(s[n].bounds);return new ks(s,r)}getDashedShape(t,s,r){const o=optionize()({distanceEpsilon:1e-10,curveEpsilon:1e-8},r);return new ks(_.flatten(this.subpaths.map(n=>n.dashed(t,s,o.distanceEpsilon,o.curveEpsilon))))}getBounds(){if(this._bounds===null){const t=Bounds2.NOTHING.copy();_.each(this.subpaths,s=>{t.includeBounds(s.getBounds())}),this._bounds=t}return this._bounds}get bounds(){return this.getBounds()}getStrokedBounds(t){let s=!0;for(let r=0;r<this.subpaths.length;r++){const o=this.subpaths[r];if(o.isDrawable()&&!o.isClosed()){s=!1;break}for(let n=0;n<o.segments.length;n++)if(!o.segments[n].areStrokedBoundsDilated()){s=!1;break}}if(s)return this.bounds.dilated(t.lineWidth/2);{const r=this.bounds.copy();for(let o=0;o<this.subpaths.length;o++){const n=this.subpaths[o].stroked(t);for(let l=0;l<n.length;l++)r.includeBounds(n[l].bounds)}return r}}getSimplifiedAreaShape(){return Graph$1.simplifyNonZero(this)}getBoundsWithTransform(t,s){const r=Bounds2.NOTHING.copy(),o=this.subpaths.length;for(let n=0;n<o;n++){const l=this.subpaths[n];r.includeBounds(l.getBoundsWithTransform(t))}return s&&r.includeBounds(this.getStrokedShape(s).getBoundsWithTransform(t)),r}getApproximateArea(t){const s=this.bounds.minX,r=this.bounds.minY,o=this.bounds.width,n=this.bounds.height,l=o*n;let h=0;const g=new Vector2(0,0);for(let d=0;d<t;d++)g.x=s+randomSource()*o,g.y=r+randomSource()*n,this.containsPoint(g)&&h++;return l*h/t}getNonoverlappingArea(){return Math.abs(_.sum(this.subpaths.map(t=>_.sum(t.getFillSegments().map(s=>s.getSignedAreaFragment())))))}getArea(){return this.getSimplifiedAreaShape().getNonoverlappingArea()}getApproximateCentroid(t){const s=this.bounds.minX,r=this.bounds.minY,o=this.bounds.width,n=this.bounds.height;let l=0;const h=new Vector2(0,0),g=new Vector2(0,0);for(let d=0;d<t;d++)g.x=s+randomSource()*o,g.y=r+randomSource()*n,this.containsPoint(g)&&(h.add(g),l++);return h.dividedScalar(l)}getClosestPoints(t){return Segment.filterClosestToPointResult(_.flatten(this.subpaths.map(s=>s.getClosestPoints(t))))}getClosestPoint(t){return this.getClosestPoints(t)[0].closestPoint}invalidatePoints(){this._invalidatingPoints=!0;const t=this.subpaths.length;for(let s=0;s<t;s++)this.subpaths[s].invalidatePoints();this._invalidatingPoints=!1,this.invalidate()}toString(){return`new phet.kite.Shape( '${this.getSVGPath()}' )`}invalidate(){assert&&assert(!this._immutable,"Attempt to modify an immutable Shape"),this._invalidatingPoints||(this._bounds=null,this.notifyInvalidationListeners())}notifyInvalidationListeners(){this.invalidatedEmitter.emit()}addSegmentAndBounds(t){this.getLastSubpath().addSegment(t),this.invalidate()}ensure(t){this.hasSubpaths()||(this.addSubpath(new Subpath$1),this.getLastSubpath().addPoint(t))}addSubpath(t){return this.subpaths.push(t),t.invalidatedEmitter.addListener(this._invalidateListener),this.invalidate(),this}hasSubpaths(){return this.subpaths.length>0}getLastSubpath(){return assert&&assert(this.hasSubpaths(),"We should have a subpath if this is called"),_.last(this.subpaths)}getLastPoint(){return assert&&assert(this.hasSubpaths(),"We should have a subpath if this is called"),assert&&assert(this.getLastSubpath().getLastPoint(),"We should have a last point"),this.getLastSubpath().getLastPoint()}getLastSegment(){if(!this.hasSubpaths())return null;const t=this.getLastSubpath();return t.isDrawable()?t.getLastSegment():null}getSmoothQuadraticControlPoint(){const t=this.getLastPoint();return this.lastQuadraticControlPoint?t.plus(t.minus(this.lastQuadraticControlPoint)):t}getSmoothCubicControlPoint(){const t=this.getLastPoint();return this.lastCubicControlPoint?t.plus(t.minus(this.lastCubicControlPoint)):t}getRelativePoint(){let t=Vector2.ZERO;if(this.hasSubpaths()){const s=this.getLastSubpath();s.points.length&&(t=s.getLastPoint())}return t}shapeUnion(t){return Graph$1.binaryResult(this,t,Graph$1.BINARY_NONZERO_UNION)}shapeIntersection(t){return Graph$1.binaryResult(this,t,Graph$1.BINARY_NONZERO_INTERSECTION)}shapeDifference(t){return Graph$1.binaryResult(this,t,Graph$1.BINARY_NONZERO_DIFFERENCE)}shapeXor(t){return Graph$1.binaryResult(this,t,Graph$1.BINARY_NONZERO_XOR)}shapeClip(t,s){return Graph$1.clipShape(t,this,s)}getArcLength(t,s,r){let o=0;for(let n=0;n<this.subpaths.length;n++)o+=this.subpaths[n].getArcLength(t,s,r);return o}serialize(){return{type:"Shape",subpaths:this.subpaths.map(t=>t.serialize())}}static deserialize(t){return assert&&assert(t.type==="Shape"),new ks(t.subpaths.map(Subpath$1.deserialize))}static rectangle(t,s,r,o){return new ks().rect(t,s,r,o)}static roundRect(t,s,r,o,n,l){return new ks().roundRect(t,s,r,o,n,l)}static roundedRectangleWithRadii(t,s,r,o,n){let l=n&&n.topLeft||0,h=n&&n.topRight||0,g=n&&n.bottomLeft||0,d=n&&n.bottomRight||0;assert&&assert(isFinite(t),"Non-finite x"),assert&&assert(isFinite(s),"Non-finite y"),assert&&assert(r>=0&&isFinite(r),"Negative or non-finite width"),assert&&assert(o>=0&&isFinite(o),"Negative or non-finite height"),assert&&assert(l>=0&&isFinite(l),"Invalid topLeft"),assert&&assert(h>=0&&isFinite(h),"Invalid topRight"),assert&&assert(g>=0&&isFinite(g),"Invalid bottomLeft"),assert&&assert(d>=0&&isFinite(d),"Invalid bottomRight");const A=l+h;A>r&&A>0&&(l=l/A*r,h=h/A*r);const S=g+d;S>r&&S>0&&(g=g/S*r,d=d/S*r);const O=l+g;O>o&&O>0&&(l=l/O*o,g=g/O*o);const I=h+d;I>o&&I>0&&(h=h/I*o,d=d/I*o),assert&&assert(l+h<=r,"Corner overlap on top edge"),assert&&assert(g+d<=r,"Corner overlap on bottom edge"),assert&&assert(l+g<=o,"Corner overlap on left edge"),assert&&assert(h+d<=o,"Corner overlap on right edge");const W=new ks,L=t+r,H=s+o;return d>0?W.arc(L-d,H-d,d,0,Math.PI/2,!1):W.moveTo(L,H),g>0?W.arc(t+g,H-g,g,Math.PI/2,Math.PI,!1):W.lineTo(t,H),l>0?W.arc(t+l,s+l,l,Math.PI,3*Math.PI/2,!1):W.lineTo(t,s),h>0?W.arc(L-h,s+h,h,3*Math.PI/2,2*Math.PI,!1):W.lineTo(L,s),W.close(),W}static boundsOffsetWithRadii(t,s,r){const o=t.withOffsets(s.left,s.top,s.right,s.bottom);return ks.roundedRectangleWithRadii(o.minX,o.minY,o.width,o.height,r)}static polygon(t){return new ks().polygon(t)}static bounds(t){return new ks().rect(t.minX,t.minY,t.maxX-t.minX,t.maxY-t.minY)}static lineSegment(t,s,r,o){return typeof t=="number"?new ks().moveTo(t,s).lineTo(r,o):new ks().moveToPoint(t).lineToPoint(s)}static regularPolygon(t,s){const r=new ks;return _.each(_.range(t),o=>{const n=Vector2.createPolar(s,2*Math.PI*o/t);o===0?r.moveToPoint(n):r.lineToPoint(n)}),r.close()}static circle(t,s,r){return s===void 0?new ks().circle(0,0,t):new ks().circle(t,s,r)}static ellipse(t,s,r,o,n){return o===void 0?new ks().ellipse(0,0,t,s,r):new ks().ellipse(t,s,r,o,n)}static arc(t,s,r,o,n,l){return new ks().arc(t,s,r,o,n,l)}static union(t){return Graph$1.unionNonZero(t)}static intersection(t){return Graph$1.intersectionNonZero(t)}static xor(t){return Graph$1.xorNonZero(t)}static segments(t,s){if(assert)for(let r=1;r<t.length;r++)assert(t[r-1].end.equalsEpsilon(t[r].start,1e-6),"Mismatched start/end");return new ks([new Subpath$1(t,void 0,!!s)])}};ks.rect=ks.rectangle,ks.roundRectangle=ks.roundRect;let Shape=ks;kite.register("Shape",Shape);const Shape$1=Shape;let globaId$5=0;const Ml=class Ml{constructor(t,s){this.id=++globaId$5,this.initialize(t,s)}initialize(t,s){return assert&&assert(t instanceof kite.Edge),assert&&assert(typeof s=="boolean"),this.edge=t,this.face=null,this.isReversed=s,this.signedAreaFragment=t.signedAreaFragment*(s?-1:1),this.startVertex=null,this.endVertex=null,this.sortVector=this.sortVector||new Vector2(0,0),this.data=null,this.updateReferences(),this}serialize(){return{type:"HalfEdge",id:this.id,edge:this.edge.id,face:this.face===null?null:this.face.id,isReversed:this.isReversed,signedAreaFragment:this.signedAreaFragment,startVertex:this.startVertex===null?null:this.startVertex.id,endVertex:this.endVertex===null?null:this.endVertex.id,sortVector:Vector2.Vector2IO.toStateObject(this.sortVector),data:this.data}}dispose(){this.edge=null,this.face=null,this.startVertex=null,this.endVertex=null,this.data=null,this.freeToPool()}getNext(t){for(let s=1;;s++){let r=this.endVertex.incidentHalfEdges.indexOf(this)-s;r<0&&(r+=this.endVertex.incidentHalfEdges.length);const o=this.endVertex.incidentHalfEdges[r].getReversed();if(!(t&&!t(o.edge)))return assert&&assert(this.endVertex===o.startVertex),o}}updateReferences(){this.startVertex=this.isReversed?this.edge.endVertex:this.edge.startVertex,this.endVertex=this.isReversed?this.edge.startVertex:this.edge.endVertex,assert&&assert(this.startVertex),assert&&assert(this.endVertex)}getEndTangent(){return this.isReversed?this.edge.segment.startTangent:this.edge.segment.endTangent.negated()}getEndCurvature(){return this.isReversed?-this.edge.segment.curvatureAt(0):this.edge.segment.curvatureAt(1)}getReversed(){return this.isReversed?this.edge.forwardHalf:this.edge.reversedHalf}getDirectionalSegment(){return this.isReversed?this.edge.segment.reversed():this.edge.segment}freeToPool(){Ml.pool.freeToPool(this)}};gt(Ml,"pool",new Pool(Ml));let HalfEdge=Ml;kite.register("HalfEdge",HalfEdge);let globaId$4=0;const ll=class ll{constructor(t){this.id=++globaId$4,this.initialize(t)}initialize(t){return assert&&assert(t instanceof Vector2),this.point=t,this.incidentHalfEdges=cleanArray(this.incidentHalfEdges),this.visited=!1,this.visitIndex=0,this.lowIndex=0,this.data=null,this.internalData={},this}serialize(){return{type:"Vertex",id:this.id,point:Vector2.Vector2IO.toStateObject(this.point),incidentHalfEdges:this.incidentHalfEdges.map(t=>t.id),visited:this.visited,visitIndex:this.visitIndex,lowIndex:this.lowIndex}}dispose(){this.point=Vector2.ZERO,cleanArray(this.incidentHalfEdges),this.freeToPool()}sortEdges(){const t=[];for(let o=0;o<this.incidentHalfEdges.length;o++){const n=this.incidentHalfEdges[o];t.push(n.sortVector.setXY(n.getEndTangent().angle,n.getEndCurvature()))}const s=-Math.PI+1e-4;let r=!1;for(;!r;){r=!0;for(let o=0;o<t.length;o++)t[o].x<s&&(r=!1);if(!r)for(let o=0;o<t.length;o++){const n=t[o];n.x-=1.62594024516,n.x<-Math.PI-1e-4&&(n.x+=Math.PI*2)}}this.incidentHalfEdges.sort(ll.edgeComparison)}static edgeComparison(t,s){const r=t.sortVector.x,o=s.sortVector.x;if(Math.abs(r-o)>1e-5||r!==o&&t.edge.segment instanceof Line$1&&s.edge.segment instanceof Line$1)return r<o?-1:1;{const n=t.sortVector.y,l=s.sortVector.y;if(Math.abs(n-l)>1e-5)return n<l?1:-1;{const g=t.getDirectionalSegment().subdivided(.999)[1].curvatureAt(0),d=s.getDirectionalSegment().subdivided(.999)[1].curvatureAt(0);return g<d?1:-1}}}freeToPool(){ll.pool.freeToPool(this)}};gt(ll,"pool",new Pool(ll));let Vertex=ll;kite.register("Vertex",Vertex);let globaId$3=0;const kl=class kl{constructor(t,s,r){this.id=++globaId$3,this.initialize(t,s,r)}initialize(t,s,r){return assert&&assert(t instanceof Segment),assert&&assert(s instanceof Vertex),assert&&assert(r instanceof Vertex),assert&&assert(t.start.distance(s.point)<.001),assert&&assert(t.end.distance(r.point)<.001),this.segment=t,this.startVertex=s,this.endVertex=r,this.signedAreaFragment=t.getSignedAreaFragment(),this.forwardHalf=HalfEdge.pool.create(this,!1),this.reversedHalf=HalfEdge.pool.create(this,!0),this.visited=!1,this.data=null,this.internalData={},this}serialize(){return{type:"Edge",id:this.id,segment:this.segment.serialize(),startVertex:this.startVertex===null?null:this.startVertex.id,endVertex:this.endVertex===null?null:this.endVertex.id,signedAreaFragment:this.signedAreaFragment,forwardHalf:this.forwardHalf.serialize(),reversedHalf:this.reversedHalf.serialize(),visited:this.visited,data:this.data}}dispose(){this.segment=null,this.startVertex=null,this.endVertex=null,this.forwardHalf.dispose(),this.reversedHalf.dispose(),this.forwardHalf=null,this.reversedHalf=null,this.data=null,this.freeToPool()}getOtherVertex(t){return assert&&assert(t===this.startVertex||t===this.endVertex),this.startVertex===t?this.endVertex:this.startVertex}updateReferences(){this.forwardHalf.updateReferences(),this.reversedHalf.updateReferences(),assert&&assert(!(this.segment instanceof Line$1)||this.startVertex!==this.endVertex,"No line segments for same vertices")}freeToPool(){kl.pool.freeToPool(this)}};gt(kl,"pool",new Pool(kl));let Edge=kl;kite.register("Edge",Edge);let globaId$2=0;const Rl=class Rl{constructor(t){this.id=++globaId$2,this.initialize(t)}initialize(t){return assert&&assert(t===null||t.isInner()),this.boundary=t,this.holes=cleanArray(this.holes),this.windingMap=null,this.filled=null,t&&this.addBoundaryFaceReferences(t),this}serialize(){return{type:"Face",id:this.id,boundary:this.boundary===null?null:this.boundary.id,holes:this.holes.map(t=>t.id),windingMap:this.windingMap,filled:this.filled}}dispose(){this.boundary=null,cleanArray(this.holes),this.windingMap=null,this.filled=null,this.freeToPool()}addBoundaryFaceReferences(t){for(let s=0;s<t.halfEdges.length;s++)assert&&assert(t.halfEdges[s].face===null),t.halfEdges[s].face=this}recursivelyAddHoles(t){assert&&assert(!t.isInner()),this.holes.push(t),this.addBoundaryFaceReferences(t);for(let s=0;s<t.childBoundaries.length;s++)this.recursivelyAddHoles(t.childBoundaries[s])}freeToPool(){Rl.pool.freeToPool(this)}};gt(Rl,"pool",new Pool(Rl));let Face=Rl;kite.register("Face",Face);let globaId$1=0;const Nl=class Nl{constructor(t,s){this.id=++globaId$1,this.initialize(t,s)}initialize(t,s){return assert&&assert(typeof t=="number"),assert&&assert(typeof s=="boolean"),this.shapeId=t,this.closed=s,this.halfEdges=cleanArray(this.halfEdges),this}serialize(){return{type:"Loop",id:this.id,shapeId:this.shapeId,closed:this.closed,halfEdges:this.halfEdges.map(t=>t.id)}}toSubpath(){const t=[];for(let s=0;s<this.halfEdges.length;s++)t.push(this.halfEdges[s].getDirectionalSegment());return new Subpath$1(t,void 0,this.closed)}dispose(){cleanArray(this.halfEdges),this.freeToPool()}freeToPool(){Nl.pool.freeToPool(this)}};gt(Nl,"pool",new Pool(Nl));let Loop=Nl;kite.register("Loop",Loop);let globaId=0;const Bl=class Bl{constructor(t){this.id=++globaId,this.initialize(t)}initialize(t){return this.halfEdges=t,this.signedArea=this.computeSignedArea(),this.bounds=this.computeBounds(),this.childBoundaries=cleanArray(this.childBoundaries),this}serialize(){return{type:"Boundary",id:this.id,halfEdges:this.halfEdges.map(t=>t.id),signedArea:this.signedArea,bounds:Bounds2.Bounds2IO.toStateObject(this.bounds),childBoundaries:this.childBoundaries.map(t=>t.id)}}dispose(){this.halfEdges=[],cleanArray(this.childBoundaries),this.freeToPool()}isInner(){return this.signedArea>0}computeSignedArea(){let t=0;for(let s=0;s<this.halfEdges.length;s++)t+=this.halfEdges[s].signedAreaFragment;return t}computeBounds(){const t=Bounds2.NOTHING.copy();for(let s=0;s<this.halfEdges.length;s++)t.includeBounds(this.halfEdges[s].edge.segment.getBounds());return t}computeExtremePoint(t){assert&&assert(this.halfEdges.length>0,"There is no extreme point if we have no edges");const s=[];for(let o=0;o<this.halfEdges.length;o++)s.push(this.halfEdges[o].edge.segment.transformed(t.getMatrix()));const r=Bounds2.NOTHING.copy();for(let o=0;o<s.length;o++)r.includeBounds(s[o].getBounds());for(let o=0;o<s.length;o++){const n=s[o];if(n.getBounds().top===r.top){let l=new Vector2(0,Number.POSITIVE_INFINITY);const h=[0,1].concat(n.getInteriorExtremaTs());for(let g=0;g<h.length;g++){const d=n.positionAt(h[g]);d.y<l.y&&(l=d)}return t.inversePosition2(l)}}throw new Error("Should not reach here if we have segments")}computeExtremeRay(t){const s=this.computeExtremePoint(t),r=t.inverseDelta2(new Vector2(0,-1)).normalized();return new Ray2(s.plus(r.timesScalar(1e-4)),r)}hasHalfEdge(t){for(let s=0;s<this.halfEdges.length;s++)if(this.halfEdges[s]===t)return!0;return!1}toSubpath(){const t=[];for(let s=0;s<this.halfEdges.length;s++)t.push(this.halfEdges[s].getDirectionalSegment());return new Subpath$1(t,null,!0)}freeToPool(){Bl.pool.freeToPool(this)}};gt(Bl,"pool",new Pool(Bl));let Boundary=Bl;kite.register("Boundary",Boundary);const An=class An{constructor(t,s,r,o,n,l,h,g,d,A){this.initialize(t,s,r,o,n,l,h,g,d,A)}initialize(t,s,r,o,n,l,h,g,d,A){return this.a=t,this.b=s,this.atMin=r,this.atMax=o,this.btMin=n,this.btMax=l,this.aMin=h,this.aMax=g,this.bMin=d,this.bMax=A,this}pushSubdivisions(t){const s=this,r=(s.atMax+s.atMin)/2,o=(s.btMax+s.btMin)/2;if(r===this.atMin||r===this.atMax||o===this.btMin||o===this.btMax){t.push(this);return}const n=s.a.positionAt(r),l=s.b.positionAt(o);An.boxIntersects(s.aMin,n,s.bMin,l)&&t.push(An.pool.create(s.a,s.b,s.atMin,r,s.btMin,o,s.aMin,n,s.bMin,l)),An.boxIntersects(n,s.aMax,s.bMin,l)&&t.push(An.pool.create(s.a,s.b,r,s.atMax,s.btMin,o,n,s.aMax,s.bMin,l)),An.boxIntersects(s.aMin,n,l,s.bMax)&&t.push(An.pool.create(s.a,s.b,s.atMin,r,o,s.btMax,s.aMin,n,l,s.bMax)),An.boxIntersects(n,s.aMax,l,s.bMax)&&t.push(An.pool.create(s.a,s.b,r,s.atMax,o,s.btMax,n,s.aMax,l,s.bMax)),this.freeToPool()}distance(t){const s=this.atMin-t.atMin,r=this.atMax-t.atMax,o=this.btMin-t.btMin,n=this.btMax-t.btMax;return s*s+r*r+o*o+n*n}clean(){this.a=null,this.b=null,this.aMin=null,this.aMax=null,this.bMin=null,this.bMax=null}static intersect(t,s){if(!t.bounds.intersectsBounds(s.bounds))return[];const r=An.getIntersectionRanges(t,s),o=[];for(let l=0;l<r.length;l++){const h=r[l];let g=!1;e:for(let d=0;d<o.length;d++){const A=o[d];for(let S=0;S<A.length;S++){const O=A[S];if(h.distance(O)<1e-13){A.push(h),g=!0;break e}}}g||o.push([h])}const n=[];for(let l=0;l<o.length;l++){const h=o[l];let g=0,d=0;for(let O=0;O<h.length;O++)g+=h[O].atMin+h[O].atMax,d+=h[O].btMin+h[O].btMax;g/=2*h.length,d/=2*h.length;const A=t.positionAt(g),S=s.positionAt(d);assert&&assert(A.distance(S)<1e-10),n.push(new SegmentIntersection(A.average(S),g,d))}for(let l=0;l<r.length;l++)r[l].freeToPool();return An.cleanPool(),n}static getIntersectionRanges(t,s){const r=t.getInteriorExtremaTs(),o=s.getInteriorExtremaTs(),n=_.zip([0].concat(r),r.concat([1])),l=_.zip([0].concat(o),o.concat([1]));let h=[];for(let g=0;g<n.length;g++)for(let d=0;d<l.length;d++){const A=n[g][0],S=n[g][1],O=l[d][0],I=l[d][1],W=t.positionAt(A),L=t.positionAt(S),H=s.positionAt(O),Y=s.positionAt(I);An.boxIntersects(W,L,H,Y)&&h.push(An.pool.create(t,s,A,S,O,I,W,L,H,Y))}for(let g=0;g<50;g++){const d=[];for(let A=h.length-1;A>=0;A--)h[A].pushSubdivisions(d);h=d}return h}static boxIntersects(t,s,r,o){const n=Math.max(Math.min(t.x,s.x),Math.min(r.x,o.x)),l=Math.max(Math.min(t.y,s.y),Math.min(r.y,o.y)),h=Math.min(Math.max(t.x,s.x),Math.max(r.x,o.x)),g=Math.min(Math.max(t.y,s.y),Math.max(r.y,o.y));return h-n>=0&&g-l>=0}static cleanPool(){An.pool.forEach(t=>t.clean())}freeToPool(){An.pool.freeToPool(this)}};An.pool=new Pool(An);let BoundsIntersection=An;kite.register("BoundsIntersection",BoundsIntersection);let globalId$8=1;const scratchArray=[];class SegmentTree{constructor(t=1e-6){this.rootNode=SegmentNode.pool.create(this,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY),this.rootNode.isBlack=!0,this.epsilon=t,this.items=new Set}query(t,s){const r=globalId$8++;return this.rootNode?this.rootNode.query(t,this.getMinX(t,this.epsilon),this.getMaxX(t,this.epsilon),r,s):!1}addItem(t){const s=this.getMinX(t,this.epsilon),r=this.getMaxX(t,this.epsilon);this.rootNode.split(s,this),this.rootNode.split(r,this),this.rootNode.addItem(t,s,r),this.items.add(t)}removeItem(t){this.rootNode.removeItem(t,this.getMinX(t,this.epsilon),this.getMaxX(t,this.epsilon)),this.items.delete(t)}audit(){this.rootNode.audit(this.epsilon,this.items,[])}toString(){let t=0,s="";return function r(o){s+=`${_.repeat("  ",t)}${o.toString()}
`,t++,o.hasChildren()&&(r(o.left),r(o.right)),t--}(this.rootNode),s}}const Ma=class Ma{constructor(t,s,r){this.items=[],this.initialize(t,s,r)}initialize(t,s,r){return this.min=s,this.max=r,this.splitValue=null,this.left=null,this.right=null,this.parent=null,this.tree=t,this.isBlack=!1,cleanArray(this.items),this}contains(t){return t>=this.min&&t<=this.max}hasChildren(){return this.splitValue!==null}query(t,s,r,o,n){var h,g;let l=!1;if(this.min<=r&&this.max>=s){for(let d=0;d<this.items.length;d++){const A=this.items[d];if((!((h=A.internalData)!=null&&h.segmentId)||((g=A.internalData)==null?void 0:g.segmentId)<o)&&(A.internalData.segmentId=o,l=n(A),l))return!0}this.hasChildren()&&(l||(l=this.left.query(t,s,r,o,n)),l||(l=this.right.query(t,s,r,o,n)))}return l}swapChild(t,s){assert&&assert(this.left===t||this.right===t),this.left===t?this.left=s:this.right=s}hasChild(t){return this.left===t||this.right===t}otherChild(t){return assert&&assert(this.hasChild(t)),this.left===t?this.right:this.left}leftRotate(t){if(assert&&assert(this.hasChildren()&&this.right.hasChildren()),this.right.hasChildren()){const s=this.right,r=this.left,o=s.left,n=s.right;s.parent=this.parent,this.parent?this.parent.swapChild(this,s):t.rootNode=s,this.parent=s,o.parent=this,s.left=this,this.left=r,this.right=o,this.max=o.max,this.splitValue=r.max,s.min=this.min,s.splitValue=this.max;const l=cleanArray(scratchArray);l.push(...this.items),cleanArray(this.items);for(let h=r.items.length-1;h>=0;h--){const g=r.items[h],d=o.items.indexOf(g);d>=0&&(r.items.splice(h,1),o.items.splice(d,1),this.items.push(g))}o.items.push(...s.items),n.items.push(...s.items),cleanArray(s.items),s.items.push(...l)}}rightRotate(t){assert&&assert(this.hasChildren()&&this.left.hasChildren());const s=this.left,r=this.right,o=s.left,n=s.right;s.parent=this.parent,this.parent?this.parent.swapChild(this,s):t.rootNode=s,this.parent=s,n.parent=this,s.right=this,this.left=n,this.right=r,this.min=n.min,this.splitValue=r.min,s.max=this.max,s.splitValue=this.min;const l=cleanArray(scratchArray);l.push(...this.items),cleanArray(this.items);for(let h=r.items.length-1;h>=0;h--){const g=r.items[h],d=n.items.indexOf(g);d>=0&&(r.items.splice(h,1),n.items.splice(d,1),this.items.push(g))}o.items.push(...s.items),n.items.push(...s.items),cleanArray(s.items),s.items.push(...l)}fixRedBlack(t){if(assert&&assert(!this.isBlack),!this.parent)this.isBlack=!0;else{const s=this.parent;if(!s.isBlack){const r=s.parent,o=r.otherChild(s);o.isBlack?s===r.left?this===s.right?(s.leftRotate(t),s.parent.isBlack=!0,s.parent.parent.isBlack=!1,s.parent.parent.rightRotate(t)):(s.isBlack=!0,r.isBlack=!1,r.rightRotate(t)):this===s.left?(s.rightRotate(t),s.parent.isBlack=!0,s.parent.parent.isBlack=!1,s.parent.parent.leftRotate(t)):(s.isBlack=!0,r.isBlack=!1,r.leftRotate(t)):(s.isBlack=!0,o.isBlack=!0,r.isBlack=!1,r.fixRedBlack(t))}}}split(t,s){if(assert&&assert(this.contains(t)),!(t===this.min||t===this.max))if(this.hasChildren())this.splitValue!==t&&(t>this.splitValue?this.right:this.left).split(t,s);else{this.splitValue=t;const r=Ma.pool.create(this.tree,this.min,t);r.parent=this,this.left=r;const o=Ma.pool.create(this.tree,t,this.max);if(o.parent=this,this.right=o,!this.isBlack&&this.parent){const n=this.parent,l=n.otherChild(this);l.isBlack?(this===n.left?(n.rightRotate(s),r.isBlack=!0):(n.leftRotate(s),o.isBlack=!0),this.fixRedBlack(s)):(this.isBlack=!0,l.isBlack=!0,n.isBlack=!1,n.fixRedBlack(s))}}}addItem(t,s,r){this.min>r||this.max<s||(this.min>=s&&this.max<=r?this.items.push(t):this.hasChildren()&&(this.left.addItem(t,s,r),this.right.addItem(t,s,r)))}removeItem(t,s,r){this.min>r||this.max<s||(this.min>=s&&this.max<=r?(assert&&assert(this.items.includes(t)),arrayRemove(this.items,t)):this.hasChildren()&&(this.left.removeItem(t,s,r),this.right.removeItem(t,s,r)))}audit(t,s,r=[]){if(assert){for(const o of r)assert(!this.items.includes(o));for(const o of this.items)assert(this.tree.getMinX(o,t)<=this.min),assert(this.tree.getMaxX(o,t)>=this.max);for(const o of r)this.tree.getMinX(o,t)<=this.min&&this.tree.getMaxX(o,t)>=this.max&&assert(s.has(o)||this.items.includes(o));if(assert(this.hasChildren()===(this.left!==null)),assert(this.hasChildren()===(this.right!==null)),assert(this.hasChildren()===(this.splitValue!==null)),assert(this.min<this.max),this.parent&&(assert(this.parent.hasChild(this)),assert(this.isBlack||this.parent.isBlack)),this.hasChildren()){assert(this.left.parent===this),assert(this.right.parent===this),assert(this.min===this.left.min),assert(this.max===this.right.max),assert(this.splitValue===this.left.max),assert(this.splitValue===this.right.min);for(const n of this.left.items)assert(!this.right.items.includes(n),"We shouldn't have two children with the same item");const o=[...r,...this.items];this.left.audit(t,s,o),this.right.audit(t,s,o)}}}toString(){return`[${this.min} ${this.max}] split:${this.splitValue} ${this.isBlack?"black":"red"} ${this.items}`}freeToPool(){Ma.pool.freeToPool(this)}};Ma.pool=new Pool(Ma);let SegmentNode=Ma;kite.register("SegmentTree",SegmentTree);class EdgeSegmentTree extends SegmentTree{getMinX(t,s){return t.segment.bounds.left-s}getMaxX(t,s){return t.segment.bounds.right+s}}kite.register("EdgeSegmentTree",EdgeSegmentTree);class VertexSegmentTree extends SegmentTree{getMinX(t,s){return t.point.x-s}getMaxX(t,s){return t.point.x+s}}kite.register("VertexSegmentTree",VertexSegmentTree);let bridgeId=0,globalId$7=0;const VERTEX_COLLAPSE_THRESHOLD_DISTANCE=1e-5,INTERSECTION_ENDPOINT_THRESHOLD_DISTANCE=.1*VERTEX_COLLAPSE_THRESHOLD_DISTANCE,SPLIT_ENDPOINT_THRESHOLD_DISTANCE=.01*VERTEX_COLLAPSE_THRESHOLD_DISTANCE,T_THRESHOLD=1e-6;class Graph{constructor(){this.vertices=[],this.edges=[],this.innerBoundaries=[],this.outerBoundaries=[],this.boundaries=[],this.shapeIds=[],this.loops=[],this.unboundedFace=Face.pool.create(null),this.faces=[this.unboundedFace]}serialize(){return{type:"Graph",vertices:this.vertices.map(t=>t.serialize()),edges:this.edges.map(t=>t.serialize()),boundaries:this.boundaries.map(t=>t.serialize()),innerBoundaries:this.innerBoundaries.map(t=>t.id),outerBoundaries:this.outerBoundaries.map(t=>t.id),shapeIds:this.shapeIds,loops:this.loops.map(t=>t.serialize()),unboundedFace:this.unboundedFace.id,faces:this.faces.map(t=>t.serialize())}}static deserialize(t){const s=new Graph,r={},o={},n={},l={},h={},g={};return s.vertices=t.vertices.map(d=>{const A=new Vertex(Vector2.Vector2IO.fromStateObject(d.point));return r[d.id]=A,A.visited=d.visited,A.visitIndex=d.visitIndex,A.lowIndex=d.lowIndex,A}),s.edges=t.edges.map(d=>{const A=new Edge(Segment.deserialize(d.segment),r[d.startVertex],r[d.endVertex]);o[d.id]=A,A.signedAreaFragment=d.signedAreaFragment;const S=(O,I)=>{n[I.id]=O,O.isReversed=I.isReversed,O.signedAreaFragment=I.signedAreaFragment,O.startVertex=r[I.startVertex.id],O.endVertex=r[I.endVertex.id],O.sortVector=Vector2.Vector2IO.fromStateObject(I.sortVector),O.data=I.data};return S(A.forwardHalf,d.forwardHalf),S(A.reversedHalf,d.reversedHalf),A.visited=d.visited,A.data=d.data,A}),t.vertices.forEach((d,A)=>{const S=s.vertices[A];S.incidentHalfEdges=d.incidentHalfEdges.map(O=>n[O])}),s.boundaries=t.boundaries.map(d=>{const A=Boundary.pool.create(d.halfEdges.map(S=>n[S]));return l[d.id]=A,A.signedArea=d.signedArea,A.bounds=Bounds2.Bounds2IO.fromStateObject(d.bounds),A}),t.boundaries.forEach((d,A)=>{const S=s.boundaries[A];S.childBoundaries=d.childBoundaries.map(O=>l[O])}),s.innerBoundaries=t.innerBoundaries.map(d=>l[d]),s.outerBoundaries=t.outerBoundaries.map(d=>l[d]),s.shapeIds=t.shapeIds,s.loops=t.loops.map(d=>{const A=new Loop(d.shapeId,d.closed);return h[d.id]=A,A.halfEdges=d.halfEdges.map(S=>n[S]),A}),s.faces=t.faces.map((d,A)=>{const S=A===0?s.unboundedFace:new Face(l[d.boundary]);return g[d.id]=S,S.holes=d.holes.map(O=>l[O]),S.windingMap=d.windingMap,S.filled=d.filled,S}),t.edges.forEach((d,A)=>{const S=s.edges[A];S.forwardHalf.face=d.forwardHalf.face===null?null:g[d.forwardHalf.face],S.reversedHalf.face=d.reversedHalf.face===null?null:g[d.reversedHalf.face]}),s}addShape(t,s,r){for(let o=0;o<s.subpaths.length;o++)this.addSubpath(t,s.subpaths[o],r)}addSubpath(t,s,r){if(assert&&assert(typeof t=="number"),assert&&assert(s instanceof Subpath$1),r=merge({ensureClosed:!0},r),this.shapeIds.indexOf(t)<0&&this.shapeIds.push(t),s.segments.length===0)return;const o=s.closed||r.ensureClosed,n=r.ensureClosed?s.getFillSegments():s.segments;let l;const h=[];for(l=0;l<n.length;l++){let d=l-1;d<0&&(d=n.length-1);let A=n[d].end;const S=n[l].start;!o&&l===0&&(A=S),S.equals(A)?h.push(Vertex.pool.create(S)):(assert&&assert(S.distance(A)<1e-5,"Inaccurate start/end points"),h.push(Vertex.pool.create(S.average(A))))}o||h.push(Vertex.pool.create(n[n.length-1].end));const g=Loop.pool.create(t,o);for(l=0;l<n.length;l++){let d=l+1;o&&d===n.length&&(d=0);const A=Edge.pool.create(n[l],h[l],h[d]);g.halfEdges.push(A.forwardHalf),this.addEdge(A)}this.loops.push(g),this.vertices.push(...h)}computeSimplifiedFaces(){this.eliminateOverlap(),this.eliminateSelfIntersection(),this.eliminateIntersection(),this.collapseVertices(),this.removeBridges(),this.removeLowOrderVertices(),this.orderVertexEdges(),this.extractFaces(),this.computeBoundaryTree(),this.computeWindingMap()}computeFaceInclusion(t){for(let s=0;s<this.faces.length;s++){const r=this.faces[s];r.filled=t(r.windingMap)}}createFilledSubGraph(){const t=new Graph,s={};for(let r=0;r<this.edges.length;r++){const o=this.edges[r];if(o.forwardHalf.face.filled!==o.reversedHalf.face.filled){if(!s[o.startVertex.id]){const h=Vertex.pool.create(o.startVertex.point);t.vertices.push(h),s[o.startVertex.id]=h}if(!s[o.endVertex.id]){const h=Vertex.pool.create(o.endVertex.point);t.vertices.push(h),s[o.endVertex.id]=h}const n=s[o.startVertex.id],l=s[o.endVertex.id];t.addEdge(Edge.pool.create(o.segment,n,l))}}return t.collapseAdjacentEdges(),t.orderVertexEdges(),t.extractFaces(),t.computeBoundaryTree(),t.fillAlternatingFaces(),t}facesToShape(){const t=[];for(let s=0;s<this.faces.length;s++){const r=this.faces[s];if(r.filled){t.push(r.boundary.toSubpath());for(let o=0;o<r.holes.length;o++)t.push(r.holes[o].toSubpath())}}return new kite.Shape(t)}dispose(){for(;this.boundaries.length;)this.boundaries.pop().dispose();for(cleanArray(this.innerBoundaries),cleanArray(this.outerBoundaries);this.loops.length;)this.loops.pop().dispose();for(;this.faces.length;)this.faces.pop().dispose();for(;this.vertices.length;)this.vertices.pop().dispose();for(;this.edges.length;)this.edges.pop().dispose()}addEdge(t){assert&&assert(t instanceof Edge),assert&&assert(!_.includes(t.startVertex.incidentHalfEdges,t.reversedHalf),"Should not already be connected"),assert&&assert(!_.includes(t.endVertex.incidentHalfEdges,t.forwardHalf),"Should not already be connected"),this.edges.push(t),t.startVertex.incidentHalfEdges.push(t.reversedHalf),t.endVertex.incidentHalfEdges.push(t.forwardHalf)}removeEdge(t){assert&&assert(t instanceof Edge),arrayRemove(this.edges,t),arrayRemove(t.startVertex.incidentHalfEdges,t.reversedHalf),arrayRemove(t.endVertex.incidentHalfEdges,t.forwardHalf)}replaceEdgeInLoops(t,s){const r=[];for(let o=0;o<s.length;o++)r.push(s[s.length-1-o].getReversed());for(let o=0;o<this.loops.length;o++){const n=this.loops[o];for(let l=n.halfEdges.length-1;l>=0;l--){const h=n.halfEdges[l];if(h.edge===t){const g=h===t.forwardHalf?s:r;Array.prototype.splice.apply(n.halfEdges,[l,1].concat(g))}}}}collapseAdjacentEdges(){let t=!0;for(;t;){t=!1;for(let s=0;s<this.vertices.length;s++){const r=this.vertices[s];if(r.incidentHalfEdges.length===2){const o=r.incidentHalfEdges[0].edge,n=r.incidentHalfEdges[1].edge;let l=o.segment,h=n.segment;const g=o.getOtherVertex(r),d=n.getOtherVertex(r);if(assert&&assert(this.loops.length===0),o.startVertex===r&&(l=l.reversed()),n.endVertex===r&&(h=h.reversed()),l instanceof Line$1&&h instanceof Line$1&&l.tangentAt(0).normalized().distance(h.tangentAt(0).normalized())<1e-6){this.removeEdge(o),this.removeEdge(n),o.dispose(),n.dispose(),arrayRemove(this.vertices,r),r.dispose();const A=new Line$1(g.point,d.point);this.addEdge(new Edge(A,g,d)),t=!0;break}}}}}eliminateOverlap(){const s=new window.FlatQueue,r=new EdgeSegmentTree(1e-4),o=globalId$7++,n=g=>{const d=g.segment.bounds;s.push({start:!0,edge:g},d.minY-1e-4),s.push({start:!1,edge:g},d.maxY+1e-4)},l=g=>{g.internalData.removedId=o};for(let g=0;g<this.edges.length;g++)n(this.edges[g]);const h=[];for(;s.length;){const g=s.pop(),d=g.edge;if(d.internalData.removedId!==o)if(g.start){let A=!1,S,O;if(r.query(d,I=>{const W=d.segment.getOverlaps(I.segment);if(W!==null&&W.length)for(let L=0;L<W.length;L++){const H=W[L];if(Math.abs(H.t1-H.t0)>1e-5&&Math.abs(H.qt1-H.qt0)>1e-5)return O=this.splitOverlap(d,I,H),A=!0,S=I,!0}return!1}),A){r.removeItem(S),l(S),l(d);for(let I=0;I<O.length;I++)n(O[I]);h.push(d),h.push(S)}else r.addItem(d)}else r.removeItem(d)}for(let g=0;g<h.length;g++)h[g].dispose()}splitOverlap(t,s,r){const o=[],n=t.segment,l=s.segment;this.removeEdge(t),this.removeEdge(s);let h=r.t0,g=r.t1,d=r.qt0,A=r.qt1;h<1e-5&&(h=0),g>1-1e-5&&(g=1),d<1e-5&&(d=0),A>1-1e-5&&(A=1);const S=h>0?n.subdivided(h)[0]:null,O=d>0?l.subdivided(d)[0]:null,I=g<1?n.subdivided(g)[1]:null,W=A<1?l.subdivided(A)[1]:null;let L=n;h>0&&(L=L.subdivided(h)[1]),g<1&&(L=L.subdivided(DotUtils.linear(h,1,0,1,g))[0]);let H;S&&O?(H=Vertex.pool.create(L.start),this.vertices.push(H)):S?H=r.a>0?s.startVertex:s.endVertex:H=t.startVertex;let Y;I&&W?(Y=Vertex.pool.create(L.end),this.vertices.push(Y)):I?Y=r.a>0?s.endVertex:s.startVertex:Y=t.endVertex;const Q=Edge.pool.create(L,H,Y);o.push(Q);let pe,de,fe,ye;S&&(pe=Edge.pool.create(S,t.startVertex,H),o.push(pe)),I&&(de=Edge.pool.create(I,Y,t.endVertex),o.push(de)),O&&(fe=Edge.pool.create(O,s.startVertex,r.a>0?H:Y),o.push(fe)),W&&(ye=Edge.pool.create(W,r.a>0?Y:H,s.endVertex),o.push(ye));for(let Ke=0;Ke<o.length;Ke++)this.addEdge(o[Ke]);const Ee=(S?[pe]:[]).concat([Q]).concat(I?[de]:[]),Le=(O?[fe]:[]).concat([Q]).concat(W?[ye]:[]),Z=[],ne=[];for(let Ke=0;Ke<Ee.length;Ke++)Z.push(Ee[Ke].forwardHalf);for(let Ke=0;Ke<Le.length;Ke++){const _t=Le[Ke]!==Q||r.a>0;ne.push(_t?Le[Ke].forwardHalf:Le[Ke].reversedHalf)}return this.replaceEdgeInLoops(t,Z),this.replaceEdgeInLoops(s,ne),o}eliminateSelfIntersection(){assert&&assert(this.boundaries.length===0,"Only handles simpler level primitive splitting right now");for(let t=this.edges.length-1;t>=0;t--){const s=this.edges[t],r=s.segment;if(r instanceof Cubic){const o=r.getSelfIntersection();if(o){assert&&assert(o.aT<o.bT);const n=r.subdivisions([o.aT,o.bT]),l=Vertex.pool.create(o.point);this.vertices.push(l);const h=Edge.pool.create(n[0],s.startVertex,l),g=Edge.pool.create(n[1],l,l),d=Edge.pool.create(n[2],l,s.endVertex);this.removeEdge(s),this.addEdge(h),this.addEdge(g),this.addEdge(d),this.replaceEdgeInLoops(s,[h.forwardHalf,g.forwardHalf,d.forwardHalf]),s.dispose()}}}}eliminateIntersection(){const s=new window.FlatQueue,r=new EdgeSegmentTree(1e-4),o=globalId$7++,n=g=>{const d=g.segment.bounds;s.push({start:!0,edge:g},d.minY-1e-4),s.push({start:!1,edge:g},d.maxY+1e-4)},l=g=>{g.internalData.removedId=o};for(let g=0;g<this.edges.length;g++)n(this.edges[g]);const h=[];for(;s.length;){const g=s.pop(),d=g.edge;if(d.internalData.removedId!==o)if(g.start){let A=!1,S,O,I;if(r.query(d,W=>{const L=d.segment,H=W.segment;let Y=Segment.intersect(L,H);if(Y=Y.filter(Q=>{const pe=Q.point;return Graph.isInternal(pe,Q.aT,L,INTERSECTION_ENDPOINT_THRESHOLD_DISTANCE,T_THRESHOLD)||Graph.isInternal(pe,Q.bT,H,INTERSECTION_ENDPOINT_THRESHOLD_DISTANCE,T_THRESHOLD)}),Y.length){const Q=Y[0],pe=this.simpleSplit(d,W,Q.aT,Q.bT,Q.point);if(pe)return A=!0,S=W,O=pe.addedEdges,I=pe.removedEdges,!0}return!1}),A){I.includes(d)?(l(d),h.push(d)):r.addItem(d),I.includes(S)&&(r.removeItem(S),l(S),h.push(S));for(let W=0;W<O.length;W++)n(O[W])}else r.addItem(d)}else r.removeItem(d)}for(let g=0;g<h.length;g++)h[g].dispose()}simpleSplit(t,s,r,o,n){const l=Graph.isInternal(n,r,t.segment,SPLIT_ENDPOINT_THRESHOLD_DISTANCE,T_THRESHOLD),h=Graph.isInternal(n,o,s.segment,SPLIT_ENDPOINT_THRESHOLD_DISTANCE,T_THRESHOLD);let g=null;l?h?(g=Vertex.pool.create(n),this.vertices.push(g)):g=o<.5?s.startVertex:s.endVertex:g=r<.5?t.startVertex:t.endVertex;let d=!1;const A=[],S=[];return l&&g!==t.startVertex&&g!==t.endVertex&&(A.push(...this.splitEdge(t,r,g)),S.push(t),d=!0),h&&g!==s.startVertex&&g!==s.endVertex&&(A.push(...this.splitEdge(s,o,g)),S.push(s),d=!0),d?{addedEdges:A,removedEdges:S}:null}splitEdge(t,s,r){assert&&assert(this.boundaries.length===0,"Only handles simpler level primitive splitting right now"),assert&&assert(t.startVertex!==r),assert&&assert(t.endVertex!==r);const o=t.segment.subdivided(s);assert&&assert(o.length===2);const n=Edge.pool.create(o[0],t.startVertex,r),l=Edge.pool.create(o[1],r,t.endVertex);return this.removeEdge(t),this.addEdge(n),this.addEdge(l),this.replaceEdgeInLoops(t,[n.forwardHalf,l.forwardHalf]),[n,l]}collapseVertices(){assert&&assert(_.every(this.edges,g=>_.includes(this.vertices,g.startVertex))),assert&&assert(_.every(this.edges,g=>_.includes(this.vertices,g.endVertex)));const t=10*VERTEX_COLLAPSE_THRESHOLD_DISTANCE,s=new window.FlatQueue,r=new VertexSegmentTree(t),o=globalId$7++,n=g=>{s.push({start:!0,vertex:g},g.point.y-t),s.push({start:!1,vertex:g},g.point.y+t)},l=g=>{g.internalData.removedId=o};for(let g=0;g<this.vertices.length;g++)n(this.vertices[g]);const h=[];for(;s.length;){const g=s.pop(),d=g.vertex;if(d.internalData.removedId!==o)if(g.start){let A=!1,S,O;if(r.query(d,I=>{const W=d.point.distance(I.point);if(W<VERTEX_COLLAPSE_THRESHOLD_DISTANCE){const L=Vertex.pool.create(W===0?d.point:d.point.average(I.point));this.vertices.push(L),arrayRemove(this.vertices,d),arrayRemove(this.vertices,I);for(let H=this.edges.length-1;H>=0;H--){const Y=this.edges[H],Q=Y.startVertex===d||Y.startVertex===I,pe=Y.endVertex===d||Y.endVertex===I;if(Q&&pe){if((Y.segment.bounds.width>1e-5||Y.segment.bounds.height>1e-5)&&(Y.segment instanceof Cubic||Y.segment instanceof Arc||Y.segment instanceof EllipticalArc)){const de=Edge.pool.create(Y.segment,L,L);this.addEdge(de),this.replaceEdgeInLoops(Y,[de.forwardHalf])}else this.replaceEdgeInLoops(Y,[]);this.removeEdge(Y),Y.dispose()}else Q?(Y.startVertex=L,L.incidentHalfEdges.push(Y.reversedHalf),Y.updateReferences()):pe&&(Y.endVertex=L,L.incidentHalfEdges.push(Y.forwardHalf),Y.updateReferences())}return O=[L],A=!0,S=I,!0}return!1}),A){r.removeItem(S),l(S),l(d);for(let I=0;I<O.length;I++)n(O[I]);h.push(d),h.push(S)}else r.addItem(d)}else r.removeItem(d)}for(let g=0;g<h.length;g++)h[g].dispose();assert&&assert(_.every(this.edges,g=>_.includes(this.vertices,g.startVertex))),assert&&assert(_.every(this.edges,g=>_.includes(this.vertices,g.endVertex)))}markBridges(t,s){s.visited=!0,s.visitIndex=s.lowIndex=bridgeId++;for(let r=0;r<s.incidentHalfEdges.length;r++){const o=s.incidentHalfEdges[r].edge,n=s.incidentHalfEdges[r].startVertex;n.visited?o.visited||(s.lowIndex=Math.min(s.lowIndex,n.visitIndex)):(o.visited=!0,n.parent=s,this.markBridges(t,n),s.lowIndex=Math.min(s.lowIndex,n.lowIndex),n.lowIndex>s.visitIndex&&t.push(o))}}removeBridges(){const t=[];for(let s=0;s<this.vertices.length;s++){const r=this.vertices[s];r.visited||this.markBridges(t,r)}for(let s=0;s<t.length;s++){const r=t[s];this.removeEdge(r),this.replaceEdgeInLoops(r,[]),r.dispose()}}removeLowOrderVertices(){assert&&assert(_.every(this.edges,s=>_.includes(this.vertices,s.startVertex))),assert&&assert(_.every(this.edges,s=>_.includes(this.vertices,s.endVertex)));let t=!0;for(;t;){t=!1;for(let s=this.vertices.length-1;s>=0;s--){const r=this.vertices[s];if(r.incidentHalfEdges.length<2){for(let o=0;o<r.incidentHalfEdges.length;o++){const n=r.incidentHalfEdges[o].edge;this.removeEdge(n),this.replaceEdgeInLoops(n,[]),n.dispose()}this.vertices.splice(s,1),r.dispose(),t=!0;break}}}assert&&assert(_.every(this.edges,s=>_.includes(this.vertices,s.startVertex))),assert&&assert(_.every(this.edges,s=>_.includes(this.vertices,s.endVertex)))}orderVertexEdges(){for(let t=0;t<this.vertices.length;t++)this.vertices[t].sortEdges()}extractFaces(){const t=[];for(let s=0;s<this.edges.length;s++)t.push(this.edges[s].forwardHalf),t.push(this.edges[s].reversedHalf);for(;t.length;){const s=[];let r=t[0];const o=r;for(;r&&(arrayRemove(t,r),s.push(r),r=r.getNext(),r!==o););const n=Boundary.pool.create(s);(n.signedArea>0?this.innerBoundaries:this.outerBoundaries).push(n),this.boundaries.push(n)}for(let s=0;s<this.innerBoundaries.length;s++)this.faces.push(Face.pool.create(this.innerBoundaries[s]))}computeBoundaryTree(){const t=[],s=new Transform3(Matrix3.rotation2(1.5729657));for(let r=0;r<this.outerBoundaries.length;r++){const o=this.outerBoundaries[r],n=o.computeExtremeRay(s);let l=null,h=Number.POSITIVE_INFINITY,g=!1;for(let d=0;d<this.edges.length;d++){const A=this.edges[d],S=A.segment.intersection(n);for(let O=0;O<S.length;O++){const I=S[O];I.distance<h&&(l=A,h=I.distance,g=I.wind)}}if(l===null)t.push(o);else{const A=g<0?l.reversedHalf:l.forwardHalf;this.getBoundaryOfHalfEdge(A).childBoundaries.push(o)}}t.forEach(this.unboundedFace.recursivelyAddHoles.bind(this.unboundedFace));for(let r=0;r<this.faces.length;r++){const o=this.faces[r];o.boundary!==null&&o.boundary.childBoundaries.forEach(o.recursivelyAddHoles.bind(o))}}computeWindingMap(){const t=this.edges.slice(),s={};for(let r=0;r<this.shapeIds.length;r++)s[this.shapeIds[r]]=0;for(this.unboundedFace.windingMap=s;t.length;)for(let r=t.length-1;r>=0;r--){const o=t[r],n=o.forwardHalf,l=o.reversedHalf,h=n.face,g=l.face;assert&&assert(h!==g);const d=h.windingMap!==null,A=g.windingMap!==null;if(d&&A){if(t.splice(r,1),assert)for(let S=0;S<this.shapeIds.length;S++){const O=this.shapeIds[S];assert(h.windingMap[O]-g.windingMap[O]===this.computeDifferential(o,O))}}else{if(!d&&!A)continue;{const S=d?h:g,O=d?g:h,I={};for(let W=0;W<this.shapeIds.length;W++){const L=this.shapeIds[W],H=this.computeDifferential(o,L);I[L]=S.windingMap[L]+H*(d?-1:1)}O.windingMap=I}}}}computeDifferential(t,s){let r=0;for(let o=0;o<this.loops.length;o++){const n=this.loops[o];if(assert&&assert(n.closed,"This is only defined to work for closed loops"),n.shapeId===s)for(let l=0;l<n.halfEdges.length;l++){const h=n.halfEdges[l];h===t.forwardHalf?r++:h===t.reversedHalf&&r--}}return r}fillAlternatingFaces(){let t=0;for(let s=0;s<this.faces.length;s++)this.faces[s].filled=null,t++;for(this.unboundedFace.filled=!1,t--;t;)for(let s=0;s<this.edges.length;s++){const r=this.edges[s],o=r.forwardHalf.face,n=r.reversedHalf.face,l=o.filled===null,h=n.filled===null;l&&!h?(o.filled=!n.filled,t--):!l&&h&&(n.filled=!o.filled,t--)}}getBoundaryOfHalfEdge(t){for(let s=0;s<this.boundaries.length;s++){const r=this.boundaries[s];if(r.hasHalfEdge(t))return r}throw new Error("Could not find boundary")}static isInternal(t,s,r,o,n){return s>n&&s<1-n&&t.distance(r.start)>o&&t.distance(r.end)>o}static BINARY_NONZERO_UNION(t){return t[0]!==0||t[1]!==0}static BINARY_NONZERO_INTERSECTION(t){return t[0]!==0&&t[1]!==0}static BINARY_NONZERO_DIFFERENCE(t){return t[0]!==0&&t[1]===0}static BINARY_NONZERO_XOR(t){return(t[0]!==0^t[1]!==0)===1}static binaryResult(t,s,r){const o=new Graph;o.addShape(0,t),o.addShape(1,s),o.computeSimplifiedFaces(),o.computeFaceInclusion(r);const n=o.createFilledSubGraph(),l=n.facesToShape();return o.dispose(),n.dispose(),l}static unionNonZero(t){const s=new Graph;for(let n=0;n<t.length;n++)s.addShape(n,t[n]);s.computeSimplifiedFaces(),s.computeFaceInclusion(n=>{for(let l=0;l<t.length;l++)if(n[l]!==0)return!0;return!1});const r=s.createFilledSubGraph(),o=r.facesToShape();return s.dispose(),r.dispose(),o}static intersectionNonZero(t){const s=new Graph;for(let n=0;n<t.length;n++)s.addShape(n,t[n]);s.computeSimplifiedFaces(),s.computeFaceInclusion(n=>{for(let l=0;l<t.length;l++)if(n[l]===0)return!1;return!0});const r=s.createFilledSubGraph(),o=r.facesToShape();return s.dispose(),r.dispose(),o}static xorNonZero(t){const s=new Graph;for(let n=0;n<t.length;n++)s.addShape(n,t[n]);s.computeSimplifiedFaces(),s.computeFaceInclusion(n=>{let l=!1;for(let h=0;h<t.length;h++)n[h]!==0&&(l=!l);return l});const r=s.createFilledSubGraph(),o=r.facesToShape();return s.dispose(),r.dispose(),o}static simplifyNonZero(t){const s=new Graph;s.addShape(0,t),s.computeSimplifiedFaces(),s.computeFaceInclusion(n=>n[0]!==0);const r=s.createFilledSubGraph(),o=r.facesToShape();return s.dispose(),r.dispose(),o}static clipShape(t,s,r){let o,n,l;r=merge({includeExterior:!1,includeBoundary:!0,includeInterior:!0},r);const d=Graph.simplifyNonZero(t),A=new Graph;for(A.addShape(0,s,{ensureClosed:!1}),A.addShape(1,d),A.eliminateOverlap(),A.eliminateSelfIntersection(),A.eliminateIntersection(),A.collapseVertices(),o=0;o<A.loops.length;o++)if(l=A.loops[o],l.shapeId===1)for(n=0;n<l.halfEdges.length;n++)l.halfEdges[n].edge.data=!0;const S=[];for(o=0;o<A.loops.length;o++)if(l=A.loops[o],l.shapeId===0){let O=[];for(n=0;n<l.halfEdges.length;n++){const I=l.halfEdges[n];(I.edge.data?r.includeBoundary:d.containsPoint(I.edge.segment.positionAt(.5))?r.includeInterior:r.includeExterior)?O.push(I.getDirectionalSegment()):O.length&&(S.push(new Subpath$1(O,void 0,l.closed)),O=[])}O.length&&S.push(new Subpath$1(O,void 0,l.closed))}return A.dispose(),new kite.Shape(S)}}kite.register("Graph",Graph);const Graph$1=Graph,scratchVector$1=new Vector2(0,0),scratchMatrix$3=Matrix3.IDENTITY.copy(),zr=class zr extends EnumerationValue{};zr.TRANSLATION=new zr,zr.TRANSLATION_AND_SCALE=new zr,zr.TRANSLATION_AND_ROTATION=new zr,zr.AFFINE=new zr,zr.enumeration=new Enumeration(zr,{phetioDocumentation:"Defines the available transform type for a SpriteInstance"});let SpriteInstanceTransformType=zr;const Fl=class Fl{constructor(){this.sprite=null,this.matrix=new Matrix3().setToAffine(1,0,0,0,1,0),this.transformType=SpriteInstanceTransformType.TRANSLATION,this.alpha=1}initialize(){return this}getShape(){return this.sprite?this.sprite.getShape().transformed(this.matrix):new Shape$1}containsPoint(t){if(!this.sprite)return!1;const s=scratchVector$1.set(t);return this.transformType===SpriteInstanceTransformType.AFFINE?scratchMatrix$3.set(this.matrix).invert().multiplyVector2(s):(s.x-=this.matrix.m02(),s.y-=this.matrix.m12(),this.transformType===SpriteInstanceTransformType.TRANSLATION_AND_SCALE?(s.x/=this.matrix.m00(),s.y/=this.matrix.m11()):this.transformType===SpriteInstanceTransformType.TRANSLATION_AND_ROTATION&&s.rotate(-this.matrix.rotation)),this.sprite.containsPoint(s)}freeToPool(){Fl.pool.freeToPool(this)}};Fl.pool=new Pool(Fl,{maxSize:1e3});let SpriteInstance=Fl;scenery.register("SpriteInstance",SpriteInstance);const MAX_DIMENSION=new Dimension2(1024,1024),GUTTER_SIZE=1,PADDING=1,qu=class qu{constructor(t){this.useMipmaps=t,this.gl=null,this.texture=null,this.bounds=new Bounds2(0,0,MAX_DIMENSION.width,MAX_DIMENSION.height),assert&&assert(this.bounds.minX===0&&this.bounds.minY===0,"Assumed constraint later on for transforms"),this.width=this.bounds.width,this.height=this.bounds.height,this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.context=this.canvas.getContext("2d"),this.binPacker=new BinPacker(this.bounds),this.dirty=!0,this.usedSprites=[],this.unusedSprites=[]}initializeContext(t){this.gl=t,this.createTexture()}createTexture(){const t=this.gl;assert&&assert(t),this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,this.useMipmaps?t.LINEAR_MIPMAP_LINEAR:t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.canvas),this.useMipmaps&&(t.hint(t.GENERATE_MIPMAP_HINT,t.NICEST),t.generateMipmap(t.TEXTURE_2D)),t.bindTexture(t.TEXTURE_2D,null),this.dirty=!1}updateTexture(){if(assert&&assert(this.gl,"SpriteSheet needs context to updateTexture()"),this.dirty){this.dirty=!1;const t=this.gl;assert&&assert(t),t.bindTexture(t.TEXTURE_2D,this.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.canvas),this.useMipmaps&&(t.hint(t.GENERATE_MIPMAP_HINT,t.NICEST),t.generateMipmap(t.TEXTURE_2D)),t.bindTexture(t.TEXTURE_2D,null)}}addImage(t,s,r){let o;for(o=0;o<this.usedSprites.length;o++){const l=this.usedSprites[o];if(l.image===t)return l.count++,l}for(o=0;o<this.unusedSprites.length;o++){const l=this.unusedSprites[o];if(l.image===t)return l.count++,assert&&assert(l.count===1,"Count should be exactly 1 after coming back from being unused"),this.unusedSprites.splice(o,1),this.usedSprites.push(l),l}let n;for(;!(n=this.binPacker.allocate(s+2*GUTTER_SIZE+PADDING,r+2*GUTTER_SIZE+PADDING))&&this.unusedSprites.length;){const l=this.unusedSprites.shift();this.dirty=!0;const h=l.bin.bounds;this.context.clearRect(h.x,h.y,h.width,h.height),this.binPacker.deallocate(l.bin)}if(n){const l=new Bounds2((n.bounds.minX+GUTTER_SIZE)/this.width,(n.bounds.minY+GUTTER_SIZE)/this.height,(n.bounds.maxX-GUTTER_SIZE-PADDING)/this.width,(n.bounds.maxY-GUTTER_SIZE-PADDING)/this.height),h=new Sprite$1(this,n,l,t,1);return this.copyImageWithGutter(t,s,r,n.bounds.x,n.bounds.y),this.dirty=!0,this.usedSprites.push(h),h}else return null}removeImage(t){let s,r;for(r=0;r<this.usedSprites.length;r++)if(this.usedSprites[r].image===t){s=this.usedSprites[r];break}assert&&assert(s,"Sprite not found for removeImage"),--s.count<=0&&(this.usedSprites.splice(r,1),this.unusedSprites.push(s))}containsImage(t){let s;for(s=0;s<this.usedSprites.length;s++)if(this.usedSprites[s].image===t)return!0;for(s=0;s<this.unusedSprites.length;s++)if(this.unusedSprites[s].image===t)return!0;return!1}copyImageWithGutter(t,s,r,o,n){assert&&assert(GUTTER_SIZE===1),this.copyImageRegion(t,1,1,0,0,o,n),this.copyImageRegion(t,1,1,s-1,0,o+1+s,n),this.copyImageRegion(t,1,1,s-1,r-1,o+1+s,n+1+r),this.copyImageRegion(t,1,1,0,r-1,o,n+1+r),this.copyImageRegion(t,s,1,0,0,o+1,n),this.copyImageRegion(t,s,1,0,r-1,o+1,n+1+r),this.copyImageRegion(t,1,r,0,0,o,n+1),this.copyImageRegion(t,1,r,s-1,0,o+1+s,n+1),this.context.drawImage(t,o+1,n+1)}copyImageRegion(t,s,r,o,n,l,h){this.context.drawImage(t,o,n,s,r,l,h,s,r)}};qu.MAX_DIMENSION=MAX_DIMENSION;let SpriteSheet=qu;scenery.register("SpriteSheet",SpriteSheet);let Sprite$1=class{constructor(t,s,r,o,n){this.spriteSheet=t,this.bin=s,this.uvBounds=r,this.image=o,this.count=n}};SpriteSheet.Sprite=Sprite$1;class ShaderProgram{constructor(t,s,r,o){const n=optionize()({attributes:[],uniforms:[]},o);this.vertexSource=s,this.fragmentSource=r,this.attributeNames=n.attributes,this.uniformNames=n.uniforms,this.initialize(t)}initialize(t){this.gl=t,this.used=!1,this.program=this.gl.createProgram(),this.vertexShader=Utils.createShader(this.gl,this.vertexSource,this.gl.VERTEX_SHADER),this.fragmentShader=Utils.createShader(this.gl,this.fragmentSource,this.gl.FRAGMENT_SHADER),this.gl.attachShader(this.program,this.vertexShader),this.gl.attachShader(this.program,this.fragmentShader),this.gl.linkProgram(this.program),this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS)||(console.log("GLSL link error:"),console.log(this.gl.getProgramInfoLog(this.program)),console.log("for vertex shader"),console.log(this.vertexSource),console.log("for fragment shader"),console.log(this.fragmentSource)),this.gl.deleteShader(this.vertexShader),this.gl.deleteShader(this.fragmentShader),this.uniformLocations={},this.attributeLocations={},this.activeAttributes={},_.each(this.attributeNames,s=>{this.attributeLocations[s]=this.gl.getAttribLocation(this.program,s),this.activeAttributes[s]=!0}),_.each(this.uniformNames,s=>{this.uniformLocations[s]=this.gl.getUniformLocation(this.program,s)}),this.isInitialized=!0}use(){this.used||(this.used=!0,this.gl.useProgram(this.program),_.each(this.attributeNames,t=>{this.activeAttributes[t]&&this.enableVertexAttribArray(t)}))}activateAttribute(t){this.activeAttributes[t]||(this.activeAttributes[t]=!0,this.used&&this.enableVertexAttribArray(t))}enableVertexAttribArray(t){this.gl.enableVertexAttribArray(this.attributeLocations[t])}unuse(){this.used&&(this.used=!1,_.each(this.attributeNames,t=>{this.activeAttributes[t]&&this.disableVertexAttribArray(t)}))}disableVertexAttribArray(t){this.gl.disableVertexAttribArray(this.attributeLocations[t])}deactivateAttribute(t){this.activeAttributes[t]&&(this.activeAttributes[t]=!1,this.used&&this.disableVertexAttribArray(t))}dispose(){this.gl.deleteProgram(this.program)}}scenery.register("ShaderProgram",ShaderProgram);class ColorProperty extends Property{constructor(t,s){s&&(assert&&assert(!s.hasOwnProperty("valueType"),"ColorProperty sets valueType"),assert&&assert(!s.hasOwnProperty("phetioType"),"ColorProperty sets phetioType"));const r=optionize()({valueType:Color,phetioValueType:Color.ColorIO},s);super(t,r)}}scenery.register("ColorProperty",ColorProperty);const TEXT_SIZE_CONTAINER_ID="sceneryTextSizeContainer",TEXT_SIZE_ELEMENT_ID="sceneryTextSizeElement";let svgTextSizeContainer,svgTextSizeElement;const hybridFontVerticalCache={};let deliveredWarning=!1;const TextBounds={approximateSVGBounds(a,t){if(assert&&assert(a instanceof Font,"Font required"),assert&&assert(typeof t=="string","renderedText required"),!svgTextSizeContainer.parentNode)if(document.body)document.body.appendChild(svgTextSizeContainer);else throw new Error("No document.body and trying to get approximate SVG bounds of a Text node");TextBounds.setSVGTextAttributes(svgTextSizeElement,a,t);const s=svgTextSizeElement.getBBox();return s.width===0&&s.height===0&&t.length>0?(deliveredWarning||(deliveredWarning=!0,console.log("WARNING: Guessing text bounds, is the simulation hidden? See https://github.com/phetsims/chipper/issues/768")),TextBounds.guessSVGBounds(a,t)):new Bounds2(s.x,s.y,s.x+s.width,s.y+s.height)},guessSVGBounds(a,t){const s=a.getNumericSize(),r=a.weight==="bold";return new Bounds2(0,-.9*s,(r?.435:.4)*s*t.length,.22*s)},accurateCanvasBounds(a){const t=scenery.scratchContext;t.font=a._font.toCSS(),t.direction="ltr";const s=t.measureText(a.renderedText);return new Bounds2(-s.actualBoundingBoxLeft,-s.actualBoundingBoxAscent,s.actualBoundingBoxRight,s.actualBoundingBoxDescent)},accurateCanvasBoundsFallback(a){const t=TextBounds.approximateSVGBounds(a._font,a.renderedText);if(!a.renderedText.length||t.width===0)return t;const s=Utils.canvasAccurateBounds(r=>{if(r.font=a._font.toCSS(),r.direction="ltr",r.fillText(a.renderedText,0,0),a.hasPaintableStroke()){const o=new CanvasContextWrapper(null,r);a.beforeCanvasStroke(o),r.strokeText(a.renderedText,0,0),a.afterCanvasStroke(o)}},{precision:.5,resolution:128,initialScale:32/Math.max(Math.abs(t.minX),Math.abs(t.minY),Math.abs(t.maxX),Math.abs(t.maxY))});return s.isFinite()?s:t},getVerticalBounds(a){assert&&assert(a instanceof Font,"Font required");const t=a.toCSS();let s=hybridFontVerticalCache[t];return s||(s=hybridFontVerticalCache[t]=TextBounds.approximateSVGBounds(a,"m")),s},approximateCanvasWidth(a,t){assert&&assert(a instanceof Font,"Font required"),assert&&assert(typeof t=="string","renderedText required");const s=scenery.scratchContext;return s.font=a.toCSS(),s.direction="ltr",s.measureText(t).width},approximateHybridBounds(a,t){assert&&assert(a instanceof Font,"Font required"),assert&&assert(typeof t=="string","renderedText required");const s=TextBounds.getVerticalBounds(a),r=TextBounds.approximateCanvasWidth(a,t);return new Bounds2(0,s.minY,r,s.maxY)},approximateDOMBounds(a,t){assert&&assert(a instanceof Font,"Font required");const s=1024,r=document.createElement("div");$(r).css({position:"absolute",left:0,top:0,padding:"0 !important",margin:"0 !important",display:"hidden"});const o=document.createElement("span");$(o).css("font",a.toCSS()),o.appendChild(t),o.setAttribute("direction","ltr");const n=document.createElement("div");$(n).css({"vertical-align":"baseline",display:"inline-block",width:0,height:`${s}px`,margin:"0 !important",padding:"0 !important"}),r.appendChild(o),r.appendChild(n),document.body.appendChild(r);const l=o.getBoundingClientRect(),h=r.getBoundingClientRect(),g=new Bounds2(l.left,l.top-s,l.right+1,l.bottom-s).shiftedXY(-h.left,-h.top);return document.body.removeChild(r),g},approximateImprovedDOMBounds(a,t){assert&&assert(a instanceof Font,"Font required");const s=document.createElement("div");s.style.display="inline-block",s.style.font=a.toCSS(),s.style.color="transparent",s.style.padding="0 !important",s.style.margin="0 !important",s.style.position="absolute",s.style.left="0",s.style.top="0",s.setAttribute("direction","ltr"),s.appendChild(t),document.body.appendChild(s);const r=new Bounds2(s.offsetLeft,s.offsetTop,s.offsetLeft+s.offsetWidth+1,s.offsetTop+s.offsetHeight+1);document.body.removeChild(s);const o=TextBounds.getVerticalBounds(a);return r.shiftedY(o.minY)},setSVGTextAttributes(a,t,s){assert&&assert(t instanceof Font,"Font required"),assert&&assert(typeof s=="string","renderedText required"),a.setAttribute("direction","ltr"),a.setAttribute("font-family",t.getFamily()),a.setAttribute("font-size",t.getSize()),a.setAttribute("font-style",t.getStyle()),a.setAttribute("font-weight",t.getWeight()),a.setAttribute("font-stretch",t.getStretch()),a.lastChild.nodeValue=s},initializeTextBounds(){svgTextSizeContainer=document.getElementById(TEXT_SIZE_CONTAINER_ID),svgTextSizeContainer||(svgTextSizeContainer=document.createElementNS(svgns,"svg"),svgTextSizeContainer.setAttribute("width","2"),svgTextSizeContainer.setAttribute("height","2"),svgTextSizeContainer.setAttribute("id",TEXT_SIZE_CONTAINER_ID),svgTextSizeContainer.setAttribute("style","visibility: hidden; pointer-events: none; position: absolute; left: -65535px; right: -65535px;")),svgTextSizeElement=document.getElementById(TEXT_SIZE_ELEMENT_ID),svgTextSizeElement||(svgTextSizeElement=document.createElementNS(svgns,"text"),svgTextSizeElement.appendChild(document.createTextNode("")),svgTextSizeElement.setAttribute("dominant-baseline","alphabetic"),svgTextSizeElement.setAttribute("text-rendering","geometricPrecision"),svgTextSizeElement.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),svgTextSizeElement.setAttribute("id",TEXT_SIZE_ELEMENT_ID),svgTextSizeContainer.appendChild(svgTextSizeElement))}};scenery.register("TextBounds",TextBounds);class PartialPDOMTrail{constructor(t,s,r){this.pdomInstance=t,this.trail=s,this.isRoot=r,this.isRoot=r,this.fullTrail=this.pdomInstance.trail.copy();for(let o=this.isRoot?0:1;o<this.trail.length;o++)this.fullTrail.addDescendant(this.trail.nodes[o])}}scenery.register("PartialPDOMTrail",PartialPDOMTrail);const SIBLING_CLASS_NAME="a11y-pdom-element",ROOT_CLASS_NAME="a11y-pdom-root",LIST_ITEM_CLASS_NAME="a11y-pdom-list-item";SceneryStyle.addRule(`.${SIBLING_CLASS_NAME}{position: fixed;pointer-events: none;top: 0px;left: 0px;transform-origin: left top 0px;border-width: 0px;border: 0px;padding: 1px 1px;margin: 0px;white-space: nowrap;outline: none;box-shadow:none;border-color:transparent;font-size: 1px;clip: rect(1px, 1px, 1px, 1px);}`);SceneryStyle.addRule(`.${ROOT_CLASS_NAME}{position: absolute;z-index: 1;opacity: 0.0001;}`);SceneryStyle.addRule(`.${LIST_ITEM_CLASS_NAME}{list-style: none;`);const PDOMSiblingStyle={SIBLING_CLASS_NAME,ROOT_CLASS_NAME,LIST_ITEM_CLASS_NAME};scenery.register("PDOMSiblingStyle",PDOMSiblingStyle);const PDOMSiblingStyle$1=PDOMSiblingStyle,NEXT$1="NEXT",PREVIOUS$1="PREVIOUS",INPUT_TAG$2="INPUT",LABEL_TAG$1="LABEL",BUTTON_TAG="BUTTON",TEXTAREA_TAG="TEXTAREA",SELECT_TAG="SELECT",OPTGROUP_TAG="OPTGROUP",DATALIST_TAG="DATALIST",OUTPUT_TAG="OUTPUT",DIV_TAG="DIV",A_TAG="A",AREA_TAG="AREA",P_TAG$1="P",IFRAME_TAG="IFRAME",BOLD_TAG="B",STRONG_TAG="STRONG",I_TAG="I",EM_TAG="EM",MARK_TAG="MARK",SMALL_TAG="SMALL",DEL_TAG="DEL",INS_TAG="INS",SUB_TAG="SUB",SUP_TAG="SUP",BR_TAG="BR",DEFAULT_FOCUSABLE_TAGS=[A_TAG,AREA_TAG,INPUT_TAG$2,SELECT_TAG,TEXTAREA_TAG,BUTTON_TAG,IFRAME_TAG],FORMATTING_TAGS=[BOLD_TAG,STRONG_TAG,I_TAG,EM_TAG,MARK_TAG,SMALL_TAG,DEL_TAG,INS_TAG,SUB_TAG,SUP_TAG,BR_TAG],ELEMENTS_WITHOUT_CLOSING_TAG=[INPUT_TAG$2],DOM_EVENTS=["focusin","focusout","input","change","click","keydown","keyup"],USER_GESTURE_EVENTS=["input","change","click","keydown","keyup"],BLOCKED_DOM_EVENTS=["touchstart","touchend","touchmove","touchcancel","mousedown","mouseup","mousemove","mouseover","mouseout","pointerdown","pointerup","pointermove","pointerover","pointerout","pointercancel","gotpointercapture","lostpointercapture"],ARIA_LABELLEDBY="aria-labelledby",ARIA_DESCRIBEDBY="aria-describedby",ARIA_ACTIVE_DESCENDANT="aria-activedescendant",DATA_FOCUSABLE="data-focusable",DATA_PDOM_UNIQUE_ID="data-unique-id",ASSOCIATION_ATTRIBUTES$1=[ARIA_LABELLEDBY,ARIA_DESCRIBEDBY,ARIA_ACTIVE_DESCENDANT];function getLinearDOMElements(a){const t=a.getElementsByTagName("*"),s=[];for(let r=0;r<t.length;r++)t[r].nodeType===Node.ELEMENT_NODE&&(s[r]=t[r]);return s}function isElementHidden(a){return a.hidden?!0:a===document.body?!1:isElementHidden(a.parentElement)}function getNextPreviousFocusable(a,t){const s=t||document.body,r=getLinearDOMElements(s),o=document.activeElement,n=r.indexOf(o),l=a===NEXT$1?1:-1;let h=n+l;for(;h<r.length&&h>=0;){const g=r[h];if(h+=l,PDOMUtils.isElementFocusable(g))return g}return o}function trimLeft(a){return a.replace(/^\s+/,"")}function tagNameSupportsContent(a){return!_.includes(ELEMENTS_WITHOUT_CLOSING_TAG,a.toUpperCase())}const PDOMUtils={unwrapStringProperty(a){const t=a===null?null:typeof a=="string"?a:a.value;return assert&&assert(t===null||typeof t=="string"),t},getNextFocusable(a){return getNextPreviousFocusable(NEXT$1,a)},getPreviousFocusable(a){return getNextPreviousFocusable(PREVIOUS$1,a)},getFirstFocusable(a){const t=a||document.body,s=getLinearDOMElements(t);let r=document.body,o=0;for(;o<s.length;){const n=s[o];if(o++,PDOMUtils.isElementFocusable(n)){r=n;break}}return r},getRandomFocusable(a){assert&&assert(a,"Random expected");const t=getLinearDOMElements(document.body),s=[];for(let r=0;r<t.length;r++)PDOMUtils.isElementFocusable(t[r])&&s.push(t[r]);return s[a.nextInt(s.length)]},unwrapProperty(a){return isTReadOnlyProperty(a)?a.value:a},containsFormattingTags(a){if(a===null)return!1;assert&&assert(typeof a=="string","unsupported type for textContent.");let t=0;const s=[],r=[];for(;t<a.length;){const l=a.indexOf("<",t),h=a.indexOf(">",t);l>-1&&(s.push(l),t=l+1),h>-1?(r.push(h),t=h+1):t++}if(s.length!==r.length||s.length===0)return!1;let o=!0;const n=a.toUpperCase();for(let l=0;l<s.length;l++){let h=n.substring(s[l]+1,r[l]);h=h.replace("/","");const g=trimLeft(h);h.length-g.length>0||_.includes(FORMATTING_TAGS,h)||(o=!1)}return o},setTextContent(a,t){if(assert&&assert(a instanceof Element),assert&&assert(t===null||typeof t=="string"),t===null)a.innerHTML="";else{const s=t.replaceAll("<br>","<br/>"),r=stripEmbeddingMarks(s);validate(r,Validation.STRING_WITHOUT_TEMPLATE_VARS_VALIDATOR),tagNameSupportsContent(a.tagName)&&(PDOMUtils.containsFormattingTags(r)?a.innerHTML=r:a.textContent=r)}},tagIsDefaultFocusable(a){return _.includes(DEFAULT_FOCUSABLE_TAGS,a.toUpperCase())},isElementFocusable(a){return!document.body.contains(a)||isElementHidden(a)||_.includes(FORMATTING_TAGS,a.tagName)?!1:a.getAttribute(DATA_FOCUSABLE)==="true"},tagNameSupportsContent(a){return tagNameSupportsContent(a)},removeElements(a,t){for(let s=0;s<t.length;s++){const r=t[s];assert&&assert(a.contains(r),"element does not contain child to be removed: ",r),a.removeChild(r)}},insertElements(a,t,s){assert&&assert(a instanceof window.Element),assert&&assert(Array.isArray(t));for(let r=0;r<t.length;r++){const o=t[r];a.insertBefore(o,s||null)}},createElement(a,t,s){s=merge({namespace:null,id:null},s);const r=s.namespace?document.createElementNS(s.namespace,a):document.createElement(a);return s.id&&(r.id=s.id),PDOMUtils.overrideFocusWithTabIndex(r,t),r.classList.add(PDOMSiblingStyle$1.SIBLING_CLASS_NAME),r},overrideFocusWithTabIndex(a,t){PDOMUtils.tagIsDefaultFocusable(a.tagName)!==t?a.tabIndex=t?0:-1:a.removeAttribute("tabindex"),a.setAttribute(DATA_FOCUSABLE,t)},TAGS:{INPUT:INPUT_TAG$2,LABEL:LABEL_TAG$1,BUTTON:BUTTON_TAG,TEXTAREA:TEXTAREA_TAG,SELECT:SELECT_TAG,OPTGROUP:OPTGROUP_TAG,DATALIST:DATALIST_TAG,OUTPUT:OUTPUT_TAG,DIV:DIV_TAG,A:A_TAG,P:P_TAG$1,B:BOLD_TAG,STRONG:STRONG_TAG,I:I_TAG,EM:EM_TAG,MARK:MARK_TAG,SMALL:SMALL_TAG,DEL:DEL_TAG,INS:INS_TAG,SUB:SUB_TAG,SUP:SUP_TAG},FORM_ELEMENTS:[INPUT_TAG$2,BUTTON_TAG,TEXTAREA_TAG,SELECT_TAG,OPTGROUP_TAG,DATALIST_TAG,OUTPUT_TAG,A_TAG],DEFAULT_CONTAINER_TAG_NAME:DIV_TAG,DEFAULT_DESCRIPTION_TAG_NAME:P_TAG$1,DEFAULT_LABEL_TAG_NAME:P_TAG$1,ASSOCIATION_ATTRIBUTES:ASSOCIATION_ATTRIBUTES$1,INPUT_TYPES_THAT_SUPPORT_CHECKED:["RADIO","CHECKBOX"],DOM_EVENTS,USER_GESTURE_EVENTS,BLOCKED_DOM_EVENTS,DATA_PDOM_UNIQUE_ID,PDOM_UNIQUE_ID_SEPARATOR:"-",DATA_EXCLUDE_FROM_INPUT:"data-exclude-from-input"};scenery.register("PDOMUtils",PDOMUtils);const PDOMUtils$1=PDOMUtils,initialProfileName=_.hasIn(window,"phet.chipper.queryParameters.colorProfile")?phet.chipper.queryParameters.colorProfile:SceneryConstants.DEFAULT_COLOR_PROFILE,colorProfiles$1=_.hasIn(window,"phet.chipper.colorProfiles")?phet.chipper.colorProfiles:[SceneryConstants.DEFAULT_COLOR_PROFILE],colorProfileProperty=new StringProperty(initialProfileName,{tandem:Tandem.GENERAL_VIEW.createTandem("colorProfileProperty"),phetioFeatured:!0,validValues:colorProfiles$1});scenery.register("colorProfileProperty",colorProfileProperty);const NAME_SEPARATOR=".",instances=[];class ProfileColorProperty extends ColorProperty{constructor(t,s,r,o){const n=optionize()({valueComparisonStrategy:"equalsFunction",tandemNameSuffix:["ColorProperty","FillProperty","StrokeProperty"]},o);if(r=_.mapValues(r,l=>Color.toColor(l).setImmutable()),assert&&assert(r.hasOwnProperty(SceneryConstants.DEFAULT_COLOR_PROFILE),"default color profile must be provided"),assert&&assert(!!r[SceneryConstants.DEFAULT_COLOR_PROFILE],"default color profile must be truthy"),super(Color.toColor(r[colorProfileProperty.value]||r[SceneryConstants.DEFAULT_COLOR_PROFILE]),n),this.colorProfileMap=r,colorProfileProperty.link(l=>{this.value=Color.toColor(this.colorProfileMap[l]||this.colorProfileMap[SceneryConstants.DEFAULT_COLOR_PROFILE])}),this.name=`${t.name}${NAME_SEPARATOR}${s}`,this.link(l=>{window.parent!==window&&window.parent.postMessage(JSON.stringify({type:"reportColor",name:this.name,value:l.toHexString(),alpha:l.getAlpha()}),"*")}),assert){const l=instances.filter(h=>h.name===this.name);assert&&assert(l.length===0,"cannot use the same name for two different ProfileColorProperty instances: "+name)}instances.push(this)}dispose(){arrayRemove(instances,this),super.dispose()}}window.addEventListener("message",a=>{let t;try{t=JSON.parse(a.data)}catch{}if(t&&t.type==="setColor")for(let s=0;s<instances.length;s++){const r=instances[s];r.name===t.name&&(r.colorProfileMap[colorProfileProperty.value]=new Color(t.value).withAlpha(t.alpha),r.value=Color.toColor(r.colorProfileMap[colorProfileProperty.value]))}});scenery.register("ProfileColorProperty",ProfileColorProperty);let globalId$6=1;class Paint{constructor(){this.id=`paint${globalId$6++}`,this.transformMatrix=null}setTransformMatrix(t){return this.transformMatrix!==t&&(this.transformMatrix=t),this}toString(){return this.id}}Paint.prototype.isPaint=!0;scenery.register("Paint",Paint);class Gradient extends Paint{constructor(){super(),assert&&assert(this.constructor.name!=="Gradient","Please create a LinearGradient or RadialGradient. Do not directly use the supertype Gradient."),this.stops=[],this.lastStopRatio=0,this.canvasGradient=null,this.colorStopsDirty=!1,this.lastColorStopValues=[]}addColorStop(t,s){if(assert&&assert(t>=0&&t<=1,"Ratio needs to be between 0,1 inclusively"),assert&&assert(s===null||typeof s=="string"||s instanceof Color||isTReadOnlyProperty(s)&&(s.value===null||typeof s.value=="string"||s.value instanceof Color),"Color should match the addColorStop type specification"),this.lastStopRatio>t)throw new Error("Color stops not specified in the order of increasing ratios");return this.lastStopRatio=t,this.stops.push({ratio:t,color:s}),this.lastColorStopValues.push(""),this}getSVGStops(){return this.stops}invalidateCanvasGradient(){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`Invalidated Canvas Gradient for #${this.id}`),this.colorStopsDirty=!0}haveCanvasColorStopsChanged(){if(this.lastColorStopValues===null)return!0;for(let t=0;t<this.stops.length;t++)if(Gradient.colorToString(this.stops[t].color)!==this.lastColorStopValues[t])return!0;return!1}getCanvasStyle(){if(!this.canvasGradient||this.colorStopsDirty&&this.haveCanvasColorStopsChanged()){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`Regenerating Canvas Gradient for #${this.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.colorStopsDirty=!1,cleanArray(this.lastColorStopValues),this.canvasGradient=this.createCanvasGradient();for(let t=0;t<this.stops.length;t++){const s=this.stops[t],r=Gradient.colorToString(s.color);this.canvasGradient.addColorStop(s.ratio,r),this.lastColorStopValues.push(r)}sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}return this.canvasGradient}static colorToString(t){return isTReadOnlyProperty(t)&&(t=t.value),t===null&&(t="transparent"),t instanceof Color&&(t=t.toCSS()),t}}Gradient.prototype.isGradient=!0;scenery.register("Gradient",Gradient);class LinearGradient extends Gradient{constructor(t,s,r,o){assert&&assert(isFinite(t)&&isFinite(s)&&isFinite(r)&&isFinite(o)),super(),this.start=new Vector2(t,s),this.end=new Vector2(r,o)}createCanvasGradient(){return scenery.scratchContext.createLinearGradient(this.start.x,this.start.y,this.end.x,this.end.y)}createSVGPaint(t){return SVGLinearGradient.pool.create(t,this)}toString(){let t=`new phet.scenery.LinearGradient( ${this.start.x}, ${this.start.y}, ${this.end.x}, ${this.end.y} )`;return _.each(this.stops,s=>{t+=`.addColorStop( ${s.ratio}, ${ColorDef$1.scenerySerialize(s.color)} )`}),t}}LinearGradient.prototype.isLinearGradient=!0;scenery.register("LinearGradient",LinearGradient);class RadialGradient extends Gradient{constructor(t,s,r,o,n,l){if(super(),this.start=new Vector2(t,s),this.end=new Vector2(o,n),platform.safari){const h=(t+o)/2,g=(s+n)/2;this.start.x=h,this.start.y=g,this.end.x=h,this.end.y=g}this.startRadius=r,this.endRadius=l,this.focalPoint=this.start.plus(this.end.minus(this.start).times(this.startRadius/(this.startRadius-this.endRadius))),this.startIsLarger=this.startRadius>this.endRadius,this.largePoint=this.startIsLarger?this.start:this.end,this.maxRadius=Math.max(this.startRadius,this.endRadius),this.minRadius=Math.min(this.startRadius,this.endRadius),this.startRadius>=this.endRadius?assert&&assert(this.focalPoint.minus(this.start).magnitude<=this.startRadius):assert&&assert(this.focalPoint.minus(this.end).magnitude<=this.endRadius)}createCanvasGradient(){return scenery.scratchContext.createRadialGradient(this.start.x,this.start.y,this.startRadius,this.end.x,this.end.y,this.endRadius)}createSVGPaint(t){return SVGRadialGradient.pool.create(t,this)}getSVGStops(){const t=this.startIsLarger,s=this.maxRadius,r=this.minRadius;function o(h,g,d,A,S){return d+(S-h)*(A-d)/(g-h)}function n(h){let g=t?1-h.ratio:h.ratio;return r>0&&(g=o(0,1,r/s,1,g)),{ratio:g,color:h.color}}const l=this.stops.map(n);return t&&l.reverse(),l}toString(){let t=`new phet.scenery.RadialGradient( ${this.start.x}, ${this.start.y}, ${this.startRadius}, ${this.end.x}, ${this.end.y}, ${this.endRadius} )`;return _.each(this.stops,s=>{t+=`.addColorStop( ${s.ratio}, ${ColorDef$1.scenerySerialize(s.color)} )`}),t}}RadialGradient.prototype.isRadialGradient=!0;scenery.register("RadialGradient",RadialGradient);class Pattern extends Paint{constructor(t){super(),this.image=t,this.canvasPattern=scenery.scratchContext.createPattern(t,"repeat")}getCanvasStyle(){return this.canvasPattern}createSVGPaint(t){return SVGPattern.pool.create(this)}toString(){return`new phet.scenery.Pattern( $( '<img src="${this.image.src}"/>' )[0] )`}}Pattern.prototype.isPattern=!0;scenery.register("Pattern",Pattern);class NodePattern extends Pattern{constructor(t,s,r,o,n,l,h=Matrix3.IDENTITY){assert&&assert(s>0&&Number.isInteger(s),"Resolution should be a positive integer"),assert&&assert(Number.isInteger(n)),assert&&assert(Number.isInteger(l));const g=document.createElement("img");function d(S,O,I,W,L){g.src=S.toDataURL()}new Node$2({scale:s,children:[t]}).toCanvas(d,-r*s,-o*s,n*s,l*s),super(g),this.setTransformMatrix(h.timesMatrix(Matrix3.scaling(1/s)))}}scenery.register("NodePattern",NodePattern);let globalId$5=1;class Filter{constructor(){this.id=`filter${globalId$5++}`,this.filterRegionPercentageIncrease=0}isDOMCompatible(){return!1}isSVGCompatible(){return!1}isCanvasCompatible(){return Features.canvasFilter?this.isDOMCompatible():!1}isWebGLCompatible(){return!1}toString(){return this.id}static applyColorMatrix(t,s,r,o){const n=document.createElementNS(svgns,"feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("values",t),n.setAttribute("in",r),n.setAttribute("color-interpolation-filters","sRGB"),o&&n.setAttribute("result",o),s.appendChild(n)}}scenery.register("Filter",Filter);const cache$2=new IOTypeCache,OrIO=a=>{assert&&assert(Array.isArray(a),"OrIO needs to be an array"),assert&&assert(a.length>1,"OrIO needs parameterTypes");const t=a.map(r=>r.typeName),s=t.join(",");if(!cache$2.has(s)){const r=o=>{for(let n=0;n<a.length;n++){const l=a[n];if(Validation.isValueValid(o,l.validator))return!0}return!1};cache$2.set(s,new IOType(`OrIO<${t.join(", ")}>`,{documentation:"A PhET-iO Type adding support for a composite type that can be any of its parameters.",parameterTypes:a,isValidValue:r,toStateObject:o=>{for(let n=0;n<a.length;n++){const l=a[n];if(Validation.isValueValid(o,l.validator))return{index:n,state:l.toStateObject(o)}}throw new Error("somehow the instance was not valid, we should not get here. Why was isValidValue not used before this step?")},fromStateObject:o=>(assert&&assert(o.hasOwnProperty("index"),"index required for deserialization"),assert&&assert(o.hasOwnProperty("state"),"state required for deserialization"),a[o.index].fromStateObject(o.state)),stateSchema:StateSchema.asValue(`${t.join("|")}`,{isValidValue:o=>typeof o.index=="number"?a[o.index].isStateObjectValid(o.state):!1})}))}return cache$2.get(s)};tandemNamespace.register("OrIO",OrIO);class CouldNotYetDeserializeError extends Error{constructor(){super("CouldNotYetDeserializeError")}}tandemNamespace.register("CouldNotYetDeserializeError",CouldNotYetDeserializeError);const cache$1=new IOTypeCache,ReferenceIO=a=>{assert&&assert(a,"ReferenceIO needs parameterType");const t=a;return cache$1.has(t)||(assert&&assert(typeof a.typeName=="string","type name should be a string"),cache$1.set(t,new IOType(`ReferenceIO<${a.typeName}>`,{isValidValue:s=>Validation.isValueValid(s,a.validator),documentation:"Uses reference identity for serializing and deserializing, and validates based on its parameter PhET-iO Type.",parameterTypes:[a],toStateObject(s){return{phetioID:s.tandem.phetioID}},stateSchema:{phetioID:StringIO},fromStateObject(s){if(assert&&assert(s&&typeof s.phetioID=="string","phetioID should be a string"),phet.phetio.phetioEngine.hasPhetioObject(s.phetioID))return phet.phetio.phetioEngine.getPhetioElement(s.phetioID);throw new CouldNotYetDeserializeError},applyState(s){assert&&assert(!1,`ReferenceIO is meant to be used as DataType serialization (see fromStateObject) for phetioID: ${s.tandem.phetioID}`)}}))),cache$1.get(t)};tandemNamespace.register("ReferenceIO",ReferenceIO);const ColorDef={isColorDef(a){return a===null||typeof a=="string"||a instanceof Color||isTReadOnlyProperty(a)&&(a.value===null||typeof a.value=="string"||a.value instanceof Color)},scenerySerialize(a){return a===null?"null":a instanceof Color?`'${a.toCSS()}'`:typeof a=="string"?`'${a}'`:ColorDef.scenerySerialize(a.value)},ColorDefIO:null};ColorDef.ColorDefIO=new IOType("ColorDefIO",{isValidValue:ColorDef.isColorDef,supertype:NullableIO(OrIO([StringIO,Color.ColorIO,ReferenceIO(Property.PropertyIO(NullableIO(OrIO([StringIO,Color.ColorIO]))))]))});scenery.register("ColorDef",ColorDef);const ColorDef$1=ColorDef,PaintDef={isPaintDef(a){return a===null||typeof a=="string"||a instanceof Color||a instanceof Paint||isTReadOnlyProperty(a)&&(a.value===null||typeof a.value=="string"||a.value instanceof Color)},toColor(a){if(typeof a=="string")return new Color(a);if(a instanceof Color)return a.copy();if(isTReadOnlyProperty(a))return PaintDef.toColor(a.value);if(a instanceof Gradient){let t=Color.TRANSPARENT;const s=0;return a.stops.forEach(r=>{t=t.blend(PaintDef.toColor(r.color),1/(s+1))}),t}return Color.TRANSPARENT}};scenery.register("PaintDef",PaintDef);const createGatedVisibleProperty=(a,t,s)=>DerivedProperty.and([a,new BooleanProperty(!0,combineOptions({tandem:t.createTandem("selfVisibleProperty"),phetioFeatured:!0},s))],{tandem:t.createTandem("visibleProperty"),phetioValueType:BooleanIO});scenery.register("createGatedVisibleProperty",createGatedVisibleProperty);const isImageDataSupported=Utils.supportsImageDataCanvasFilter(),useFakeGamma=platform.chromium;class ColorMatrixFilter extends Filter{constructor(t,s,r,o,n,l,h,g,d,A,S,O,I,W,L,H,Y,Q,pe,de){assert&&assert(isFinite(t),"m00 should be a finite number"),assert&&assert(isFinite(s),"m01 should be a finite number"),assert&&assert(isFinite(r),"m02 should be a finite number"),assert&&assert(isFinite(o),"m03 should be a finite number"),assert&&assert(isFinite(n),"m04 should be a finite number"),assert&&assert(isFinite(l),"m10 should be a finite number"),assert&&assert(isFinite(h),"m11 should be a finite number"),assert&&assert(isFinite(g),"m12 should be a finite number"),assert&&assert(isFinite(d),"m13 should be a finite number"),assert&&assert(isFinite(A),"m14 should be a finite number"),assert&&assert(isFinite(S),"m20 should be a finite number"),assert&&assert(isFinite(O),"m21 should be a finite number"),assert&&assert(isFinite(I),"m22 should be a finite number"),assert&&assert(isFinite(W),"m23 should be a finite number"),assert&&assert(isFinite(L),"m24 should be a finite number"),assert&&assert(isFinite(H),"m30 should be a finite number"),assert&&assert(isFinite(Y),"m31 should be a finite number"),assert&&assert(isFinite(Q),"m32 should be a finite number"),assert&&assert(isFinite(pe),"m33 should be a finite number"),assert&&assert(isFinite(de),"m34 should be a finite number"),super(),this.m00=t,this.m01=s,this.m02=r,this.m03=o,this.m04=n,this.m10=l,this.m11=h,this.m12=g,this.m13=d,this.m14=A,this.m20=S,this.m21=O,this.m22=I,this.m23=W,this.m24=L,this.m30=H,this.m31=Y,this.m32=Q,this.m33=pe,this.m34=de}applySVGFilter(t,s,r){Filter.applyColorMatrix(`${toSVGNumber(this.m00)} ${toSVGNumber(this.m01)} ${toSVGNumber(this.m02)} ${toSVGNumber(this.m03)} ${toSVGNumber(this.m04)} ${toSVGNumber(this.m10)} ${toSVGNumber(this.m11)} ${toSVGNumber(this.m12)} ${toSVGNumber(this.m13)} ${toSVGNumber(this.m14)} ${toSVGNumber(this.m20)} ${toSVGNumber(this.m21)} ${toSVGNumber(this.m22)} ${toSVGNumber(this.m23)} ${toSVGNumber(this.m24)} ${toSVGNumber(this.m30)} ${toSVGNumber(this.m31)} ${toSVGNumber(this.m32)} ${toSVGNumber(this.m33)} ${toSVGNumber(this.m34)}`,t,s,r)}applyCanvasFilter(t){const s=t.canvas.width,r=t.canvas.height,o=t.context.getImageData(0,0,s,r),n=s*r;for(let l=0;l<n;l++){const h=l*4;if(useFakeGamma){const d=Math.pow(o.data[h+0]/255,1.45),A=Math.pow(o.data[h+1]/255,1.45),S=Math.pow(o.data[h+2]/255,1.45),O=Math.pow(o.data[h+3]/255,1.45);o.data[h+0]=255*Math.pow(d*this.m00+A*this.m01+S*this.m02+O*this.m03+this.m04,1/1.45),o.data[h+1]=255*Math.pow(d*this.m10+A*this.m11+S*this.m12+O*this.m13+this.m14,1/1.45),o.data[h+2]=255*Math.pow(d*this.m20+A*this.m21+S*this.m22+O*this.m23+this.m24,1/1.45),o.data[h+3]=255*Math.pow(d*this.m30+A*this.m31+S*this.m32+O*this.m33+this.m34,1/1.45)}else{const g=o.data[h+0],d=o.data[h+1],A=o.data[h+2],S=o.data[h+3];o.data[h+0]=g*this.m00+d*this.m01+A*this.m02+S*this.m03+this.m04,o.data[h+1]=g*this.m10+d*this.m11+A*this.m12+S*this.m13+this.m14,o.data[h+2]=g*this.m20+d*this.m21+A*this.m22+S*this.m23+this.m24,o.data[h+3]=g*this.m30+d*this.m31+A*this.m32+S*this.m33+this.m34}}t.context.putImageData(o,0,0)}isSVGCompatible(){return!0}isCanvasCompatible(){return super.isCanvasCompatible()||isImageDataSupported}getCSSFilterString(){throw new Error("unimplemented")}}scenery.register("ColorMatrixFilter",ColorMatrixFilter);const Nh=class Nh extends ColorMatrixFilter{constructor(t){assert&&assert(isFinite(t),"Brightness amount should be finite"),assert&&assert(t>=0,"Brightness amount should be non-negative"),super(t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0),this.amount=t}getCSSFilterString(){return`brightness(${toSVGNumber(this.amount)})`}isDOMCompatible(){return!0}};Nh.BLACKEN=new Nh(0);let Brightness=Nh;scenery.register("Brightness",Brightness);const Bh=class Bh extends ColorMatrixFilter{constructor(t){assert&&assert(isFinite(t),"Contrast amount should be finite"),assert&&assert(t>=0,"Contrast amount should be non-negative"),super(t,0,0,0,-(.5*t)+.5,0,t,0,0,-(.5*t)+.5,0,0,t,0,-(.5*t)+.5,0,0,0,1,0),this.amount=t}getCSSFilterString(){return`contrast(${toSVGNumber(this.amount)})`}isDOMCompatible(){return!0}};Bh.GRAY=new Bh(0);let Contrast=Bh;scenery.register("Contrast",Contrast);class DropShadow extends Filter{constructor(t,s,r,o=15){assert&&assert(t.isFinite(),"DropShadow offset should be finite"),assert&&assert(isFinite(s),"DropShadow blurRadius should be finite"),assert&&assert(s>=0,"DropShadow blurRadius should be non-negative"),assert&&assert(ColorDef$1.isColorDef(r),"DropShadow color should be a ColorDef"),super(),this.offset=t,this.blurRadius=s,this.color=r,this.colorCSS=PaintDef.toColor(r).toCSS(),this.filterRegionPercentageIncrease=o}getCSSFilterString(){return`drop-shadow(${toSVGNumber(this.offset.x)}px ${toSVGNumber(this.offset.y)}px ${toSVGNumber(this.blurRadius)}px ${this.colorCSS})`}isDOMCompatible(){return!0}applyCanvasFilter(){throw new Error("unimplemented")}applySVGFilter(t,s,r){throw new Error("unimplemented")}}scenery.register("DropShadow",DropShadow);class GaussianBlur extends Filter{constructor(t,s=15){assert&&assert(isFinite(t),"GaussianBlur standardDeviation should be finite"),assert&&assert(t>=0,"GaussianBlur standardDeviation should be non-negative"),super(),this.standardDeviation=t,this.filterRegionPercentageIncrease=s}getCSSFilterString(){return`blur(${toSVGNumber(this.standardDeviation)}px)`}applySVGFilter(t,s,r){const o=document.createElementNS(svgns,"feGaussianBlur");o.setAttribute("stdDeviation",toSVGNumber(this.standardDeviation)),o.setAttribute("edgeMode","none"),t.appendChild(o),o.setAttribute("in",s),r&&o.setAttribute("result",r),t.appendChild(o)}isDOMCompatible(){return!0}isSVGCompatible(){return!0}applyCanvasFilter(t){throw new Error("unimplemented")}}scenery.register("GaussianBlur",GaussianBlur);const Fh=class Fh extends ColorMatrixFilter{constructor(t=1){assert&&assert(isFinite(t),"Grayscale amount should be finite"),assert&&assert(t>=0,"Grayscale amount should be non-negative"),assert&&assert(t<=1,"Grayscale amount should be no greater than 1");const s=1-t;super(.2126+.7874*s,.7152-.7152*s,.0722-.0722*s,0,0,.2126-.2126*s,.7152+.2848*s,.0722-.0722*s,0,0,.2126-.2126*s,.7152-.7152*s,.0722+.9278*s,0,0,0,0,0,1,0),this.amount=t}getCSSFilterString(){return`grayscale(${toSVGNumber(this.amount)})`}isDOMCompatible(){return!0}};Fh.FULL=new Fh(1);let Grayscale=Fh;scenery.register("Grayscale",Grayscale);class HueRotate extends ColorMatrixFilter{constructor(t){assert&&assert(isFinite(t),"HueRotate amount should be finite"),assert&&assert(t>=0,"HueRotate amount should be non-negative");const s=Math.cos(t),r=Math.sin(t);super(.213+.787*s-.213*r,.715-.715*s-.715*r,.072-.072*s+.928*r,0,0,.213-.213*s+.143*r,.715+.285*s+.14*r,.072-.072*s-.283*r,0,0,.213-.213*s-.787*r,.715-.715*s+.715*r,.072+.928*s+.072*r,0,0,0,0,0,1,0),this.amount=t}getCSSFilterString(){return`hue-rotate(${toSVGNumber(DotUtils.toDegrees(this.amount))}deg)`}isDOMCompatible(){return!0}}scenery.register("HueRotate",HueRotate);const qh=class qh extends Filter{constructor(t=1){assert&&assert(isFinite(t),"Invert amount should be finite"),assert&&assert(t>=0,"Invert amount should be non-negative"),assert&&assert(t<=1,"Invert amount should be no greater than 1"),super(),this.amount=t}getCSSFilterString(){return`invert(${toSVGNumber(this.amount)})`}isDOMCompatible(){return!0}applyCanvasFilter(t){throw new Error("unimplemented")}applySVGFilter(t,s,r){throw new Error("unimplemented")}};qh.FULL=new qh(1);let Invert=qh;scenery.register("Invert",Invert);class Opacity extends Filter{constructor(t){assert&&assert(isFinite(t),"Opacity amount should be finite"),assert&&assert(t>=0,"Opacity amount should be non-negative"),assert&&assert(t<=1,"Opacity amount should be no greater than 1"),super(),this.amount=t}getCSSFilterString(){return`opacity(${toSVGNumber(this.amount)})`}isDOMCompatible(){return!0}applyCanvasFilter(t){throw new Error("unimplemented")}applySVGFilter(t,s,r){throw new Error("unimplemented")}}scenery.register("Opacity",Opacity);class Saturate extends ColorMatrixFilter{constructor(t){assert&&assert(isFinite(t),"Saturate amount should be finite"),assert&&assert(t>=0,"Saturate amount should be non-negative"),super(.213+.787*t,.715-.715*t,.072-.072*t,0,0,.213-.213*t,.715-.285*t,.072-.072*t,0,0,.213-.213*t,.715-.715*t,.072-.928*t,0,0,0,0,0,1,0),this.amount=t}getCSSFilterString(){return`saturate(${toSVGNumber(this.amount)})`}isDOMCompatible(){return!0}}scenery.register("Saturate",Saturate);const Hh=class Hh extends ColorMatrixFilter{constructor(t=1){assert&&assert(isFinite(t),"Sepia amount should be finite"),assert&&assert(t>=0,"Sepia amount should be non-negative"),assert&&assert(t<=1,"Sepia amount should be at most 1"),super(.393+.607*(1-t),.769-.769*(1-t),.189-.189*(1-t),0,0,.349-.349*(1-t),.686+.314*(1-t),.168-.168*(1-t),0,0,.272-.272*(1-t),.534-.534*(1-t),.131+.869*(1-t),0,0,0,0,0,1,0),this.amount=t}getCSSFilterString(){return`sepia(${toSVGNumber(this.amount)})`}isDOMCompatible(){return!0}};Hh.FULL=new Hh(1);let Sepia=Hh;scenery.register("Sepia",Sepia);const INPUT_TAG$1=PDOMUtils$1.TAGS.INPUT,P_TAG=PDOMUtils$1.TAGS.P,DEFAULT_DESCRIPTION_TAG_NAME=P_TAG,DEFAULT_LABEL_TAG_NAME=P_TAG,DEFAULT_PDOM_HEADING_BEHAVIOR=(a,t,s)=>(t.labelTagName=`h${a.headingLevel}`,t.labelContent=s,t),unwrapProperty=a=>{const t=a===null?null:typeof a=="string"?a:a.value;return assert&&assert(t===null||typeof t=="string"),t},FORM_ELEMENTS=PDOMUtils$1.FORM_ELEMENTS,INPUT_TYPES_THAT_SUPPORT_CHECKED=PDOMUtils$1.INPUT_TYPES_THAT_SUPPORT_CHECKED,ASSOCIATION_ATTRIBUTES=PDOMUtils$1.ASSOCIATION_ATTRIBUTES,ACCESSIBILITY_OPTION_KEYS=["focusable","tagName","accessibleName","accessibleNameBehavior","helpText","helpTextBehavior","pdomHeading","pdomHeadingBehavior","containerTagName","containerAriaRole","innerContent","inputType","inputValue","pdomChecked","pdomNamespace","ariaLabel","ariaRole","ariaValueText","labelTagName","labelContent","appendLabel","descriptionTagName","descriptionContent","appendDescription","focusHighlight","focusHighlightLayerable","groupFocusHighlight","pdomVisible","pdomOrder","ariaLabelledbyAssociations","ariaDescribedbyAssociations","activeDescendantAssociations","focusPanTargetBoundsProperty","limitPanDirection","positionInPDOM","pdomTransformSourceNode"];class ParallelDOM extends PhetioObject{constructor(t){super(t),this._inputValue=null,this._labelContent=null,this._innerContent=null,this._descriptionContent=null,this._ariaLabel=null,this._hasAppliedAriaLabel=!1,this._ariaValueText=null,this._hasAppliedAriaValueText=!1,this._accessibleName=null,this._helpText=null,this._pdomHeading=null,this._onPDOMContentChangeListener=this.onPDOMContentChange.bind(this),this._onInputValueChangeListener=this.invalidatePeerInputValue.bind(this),this._onAriaLabelChangeListener=this.onAriaLabelChange.bind(this),this._onAriaValueTextChangeListener=this.onAriaValueTextChange.bind(this),this._onLabelContentChangeListener=this.invalidatePeerLabelSiblingContent.bind(this),this._onDescriptionContentChangeListener=this.invalidatePeerDescriptionSiblingContent.bind(this),this._onInnerContentChangeListener=this.onInnerContentPropertyChange.bind(this),this._tagName=null,this._containerTagName=null,this._labelTagName=null,this._descriptionTagName=null,this._inputType=null,this._pdomChecked=!1,this._appendLabel=!1,this._appendDescription=!1,this._pdomAttributes=[],this._pdomClasses=[],this._pdomNamespace=null,this._ariaRole=null,this._containerAriaRole=null,this._ariaLabelledbyAssociations=[],this._nodesThatAreAriaLabelledbyThisNode=[],this._ariaDescribedbyAssociations=[],this._nodesThatAreAriaDescribedbyThisNode=[],this._activeDescendantAssociations=[],this._nodesThatAreActiveDescendantToThisNode=[],this._focusableOverride=null,this._focusHighlight=null,this._focusHighlightLayerable=!1,this._groupFocusHighlight=!1,this._pdomVisible=!0,this._pdomOrder=null,this._pdomParent=null,this._pdomTransformSourceNode=null,this._focusPanTargetBoundsProperty=null,this._limitPanDirection=null,this._pdomDisplaysInfo=new PDOMDisplaysInfo(this),this._pdomInstances=[],this._positionInPDOM=!1,this.excludeLabelSiblingFromInput=!1,this._accessibleNameBehavior=ParallelDOM.BASIC_ACCESSIBLE_NAME_BEHAVIOR,this._helpTextBehavior=ParallelDOM.HELP_TEXT_AFTER_CONTENT,this._headingLevel=null,this._pdomHeadingBehavior=DEFAULT_PDOM_HEADING_BEHAVIOR,this.focusHighlightChangedEmitter=new TinyEmitter,this.pdomDisplaysEmitter=new TinyEmitter,this.pdomBoundInputEnabledListener=this.pdomInputEnabledListener.bind(this)}disposeParallelDOM(){isTReadOnlyProperty(this._accessibleName)&&!this._accessibleName.isDisposed&&(this._accessibleName.unlink(this._onPDOMContentChangeListener),this._accessibleName=null),isTReadOnlyProperty(this._helpText)&&!this._helpText.isDisposed&&(this._helpText.unlink(this._onPDOMContentChangeListener),this._helpText=null),isTReadOnlyProperty(this._pdomHeading)&&!this._pdomHeading.isDisposed&&(this._pdomHeading.unlink(this._onPDOMContentChangeListener),this._pdomHeading=null),isTReadOnlyProperty(this._inputValue)&&!this._inputValue.isDisposed&&(this._inputValue.unlink(this._onPDOMContentChangeListener),this._inputValue=null),isTReadOnlyProperty(this._ariaLabel)&&!this._ariaLabel.isDisposed&&this._ariaLabel.unlink(this._onAriaLabelChangeListener),isTReadOnlyProperty(this._ariaValueText)&&!this._ariaValueText.isDisposed&&this._ariaValueText.unlink(this._onAriaValueTextChangeListener),isTReadOnlyProperty(this._innerContent)&&!this._innerContent.isDisposed&&this._innerContent.unlink(this._onInnerContentChangeListener),isTReadOnlyProperty(this._labelContent)&&!this._labelContent.isDisposed&&this._labelContent.unlink(this._onLabelContentChangeListener),isTReadOnlyProperty(this._descriptionContent)&&!this._descriptionContent.isDisposed&&this._descriptionContent.unlink(this._onDescriptionContentChangeListener),this.inputEnabledProperty.unlink(this.pdomBoundInputEnabledListener),this.pdomOrder=null,this.setPDOMTransformSourceNode(null),this.setAriaLabelledbyAssociations([]),this.setAriaDescribedbyAssociations([]),this.setActiveDescendantAssociations([]),this.removePDOMAttributes()}pdomInputEnabledListener(t){this.setPDOMAttribute("aria-disabled",!t),this.setPDOMAttribute("onclick",t?"":"return false")}isFocused(){for(let t=0;t<this._pdomInstances.length;t++)if(this._pdomInstances[t].peer.isFocused())return!0;return!1}get focused(){return this.isFocused()}focus(){if(this._pdomInstances.length>0){assert&&assert(this.focusable,"trying to set focus on a node that is not focusable"),assert&&assert(this._pdomVisible,"trying to set focus on a node with invisible pdom content"),assert&&assert(this._pdomInstances.length===1,"focus() unsupported for Nodes using DAG, pdom content is not unique");const t=this._pdomInstances[0].peer;assert&&assert(t,"must have a peer to focus"),t.focus()}}blur(){if(this._pdomInstances.length>0){assert&&assert(this._pdomInstances.length===1,"blur() unsupported for Nodes using DAG, pdom content is not unique");const t=this._pdomInstances[0].peer;assert&&assert(t,"must have a peer to blur"),t.blur()}}pdomAudit(){this.hasPDOMContent&&assert&&(this._inputType&&assert(this._tagName.toUpperCase()===INPUT_TAG$1,"tagName must be INPUT to support inputType"),this._pdomChecked&&assert(this._tagName.toUpperCase()===INPUT_TAG$1,"tagName must be INPUT to support pdomChecked."),this._inputValue&&assert(this._tagName.toUpperCase()===INPUT_TAG$1,"tagName must be INPUT to support inputValue"),this._pdomChecked&&assert(INPUT_TYPES_THAT_SUPPORT_CHECKED.includes(this._inputType.toUpperCase()),`inputType does not support checked attribute: ${this._inputType}`),this._focusHighlightLayerable&&assert(this.focusHighlight instanceof Node$2,"focusHighlight must be Node if highlight is layerable"),this._tagName.toUpperCase()===INPUT_TAG$1&&assert(typeof this._inputType=="string"," inputType expected for input"),this.ariaRole==="application"&&assert(this.innerContent||this.accessibleName,"must have some innerContent or element will never be focusable in VoiceOver"));for(let t=0;t<this.children.length;t++)this.children[t].pdomAudit()}setAccessibleName(t){t!==this._accessibleName&&(isTReadOnlyProperty(this._accessibleName)&&!this._accessibleName.isDisposed&&this._accessibleName.unlink(this._onPDOMContentChangeListener),this._accessibleName=t,isTReadOnlyProperty(t)&&t.lazyLink(this._onPDOMContentChangeListener),this.onPDOMContentChange())}set accessibleName(t){this.setAccessibleName(t)}get accessibleName(){return this.getAccessibleName()}getAccessibleName(){return isTReadOnlyProperty(this._accessibleName)?this._accessibleName.value:this._accessibleName}removeFromPDOM(){assert&&assert(this._tagName!==null,"There is no pdom content to clear from the PDOM"),this.tagName=null}setAccessibleNameBehavior(t){this._accessibleNameBehavior!==t&&(this._accessibleNameBehavior=t,this.onPDOMContentChange())}set accessibleNameBehavior(t){this.setAccessibleNameBehavior(t)}get accessibleNameBehavior(){return this.getAccessibleNameBehavior()}getAccessibleNameBehavior(){return this._accessibleNameBehavior}setPDOMHeading(t){t!==this._pdomHeading&&(isTReadOnlyProperty(this._pdomHeading)&&!this._pdomHeading.isDisposed&&this._pdomHeading.unlink(this._onPDOMContentChangeListener),this._pdomHeading=t,isTReadOnlyProperty(t)&&t.lazyLink(this._onPDOMContentChangeListener),this.onPDOMContentChange())}set pdomHeading(t){this.setPDOMHeading(t)}get pdomHeading(){return this.getPDOMHeading()}getPDOMHeading(){return isTReadOnlyProperty(this._pdomHeading)?this._pdomHeading.value:this._pdomHeading}setPDOMHeadingBehavior(t){this._pdomHeadingBehavior!==t&&(this._pdomHeadingBehavior=t,this.onPDOMContentChange())}set pdomHeadingBehavior(t){this.setPDOMHeadingBehavior(t)}get pdomHeadingBehavior(){return this.getPDOMHeadingBehavior()}getPDOMHeadingBehavior(){return this._pdomHeadingBehavior}getHeadingLevel(){return this._headingLevel}get headingLevel(){return this.getHeadingLevel()}computeHeadingLevel(){if(!this._pdomParent)return this.pdomHeading?(this._headingLevel=1,1):0;if(this.pdomHeading){const t=this._pdomParent.computeHeadingLevel()+1;return this._headingLevel=t,t}else return this._pdomParent.computeHeadingLevel()}setHelpText(t){t!==this._helpText&&(isTReadOnlyProperty(this._helpText)&&!this._helpText.isDisposed&&this._helpText.unlink(this._onPDOMContentChangeListener),this._helpText=t,isTReadOnlyProperty(t)&&t.lazyLink(this._onPDOMContentChangeListener),this.onPDOMContentChange())}set helpText(t){this.setHelpText(t)}get helpText(){return this.getHelpText()}getHelpText(){return isTReadOnlyProperty(this._helpText)?this._helpText.value:this._helpText}setHelpTextBehavior(t){this._helpTextBehavior!==t&&(this._helpTextBehavior=t,this.onPDOMContentChange())}set helpTextBehavior(t){this.setHelpTextBehavior(t)}get helpTextBehavior(){return this.getHelpTextBehavior()}getHelpTextBehavior(){return this._helpTextBehavior}setTagName(t){assert&&assert(t===null||typeof t=="string"),t!==this._tagName&&(this._tagName=t,this.onPDOMContentChange())}set tagName(t){this.setTagName(t)}get tagName(){return this.getTagName()}getTagName(){return this._tagName}setLabelTagName(t){assert&&assert(t===null||typeof t=="string"),t!==this._labelTagName&&(this._labelTagName=t,this.onPDOMContentChange())}set labelTagName(t){this.setLabelTagName(t)}get labelTagName(){return this.getLabelTagName()}getLabelTagName(){return this._labelTagName}setDescriptionTagName(t){assert&&assert(t===null||typeof t=="string"),t!==this._descriptionTagName&&(this._descriptionTagName=t,this.onPDOMContentChange())}set descriptionTagName(t){this.setDescriptionTagName(t)}get descriptionTagName(){return this.getDescriptionTagName()}getDescriptionTagName(){return this._descriptionTagName}setInputType(t){if(assert&&assert(t===null||typeof t=="string"),assert&&this.tagName&&assert(this._tagName.toUpperCase()===INPUT_TAG$1,"tag name must be INPUT to support inputType"),t!==this._inputType){this._inputType=t;for(let s=0;s<this._pdomInstances.length;s++){const r=this._pdomInstances[s].peer;t===null?r.removeAttributeFromElement("type"):r.setAttributeToElement("type",t)}}}set inputType(t){this.setInputType(t)}get inputType(){return this.getInputType()}getInputType(){return this._inputType}setAppendLabel(t){this._appendLabel!==t&&(this._appendLabel=t,this.onPDOMContentChange())}set appendLabel(t){this.setAppendLabel(t)}get appendLabel(){return this.getAppendLabel()}getAppendLabel(){return this._appendLabel}setAppendDescription(t){this._appendDescription!==t&&(this._appendDescription=t,this.onPDOMContentChange())}set appendDescription(t){this.setAppendDescription(t)}get appendDescription(){return this.getAppendDescription()}getAppendDescription(){return this._appendDescription}setContainerTagName(t){assert&&assert(t===null||typeof t=="string",`invalid tagName argument: ${t}`),this._containerTagName!==t&&(this._containerTagName=t,this.onPDOMContentChange())}set containerTagName(t){this.setContainerTagName(t)}get containerTagName(){return this.getContainerTagName()}getContainerTagName(){return this._containerTagName}invalidatePeerLabelSiblingContent(){const t=this.labelContent;this._labelTagName||this.setLabelTagName(DEFAULT_LABEL_TAG_NAME);for(let s=0;s<this._pdomInstances.length;s++)this._pdomInstances[s].peer.setLabelSiblingContent(t)}setLabelContent(t){t!==this._labelContent&&(isTReadOnlyProperty(this._labelContent)&&!this._labelContent.isDisposed&&this._labelContent.unlink(this._onLabelContentChangeListener),this._labelContent=t,isTReadOnlyProperty(t)&&t.lazyLink(this._onLabelContentChangeListener),this.invalidatePeerLabelSiblingContent())}set labelContent(t){this.setLabelContent(t)}get labelContent(){return this.getLabelContent()}getLabelContent(){return unwrapProperty(this._labelContent)}onInnerContentPropertyChange(){const t=this.innerContent;for(let s=0;s<this._pdomInstances.length;s++)this._pdomInstances[s].peer.setPrimarySiblingContent(t)}setInnerContent(t){t!==this._innerContent&&(isTReadOnlyProperty(this._innerContent)&&!this._innerContent.isDisposed&&this._innerContent.unlink(this._onInnerContentChangeListener),this._innerContent=t,isTReadOnlyProperty(t)&&t.lazyLink(this._onInnerContentChangeListener),this.onInnerContentPropertyChange())}set innerContent(t){this.setInnerContent(t)}get innerContent(){return this.getInnerContent()}getInnerContent(){return unwrapProperty(this._innerContent)}invalidatePeerDescriptionSiblingContent(){const t=this.descriptionContent;this._descriptionTagName||this.setDescriptionTagName(DEFAULT_DESCRIPTION_TAG_NAME);for(let s=0;s<this._pdomInstances.length;s++)this._pdomInstances[s].peer.setDescriptionSiblingContent(t)}setDescriptionContent(t){t!==this._descriptionContent&&(isTReadOnlyProperty(this._descriptionContent)&&!this._descriptionContent.isDisposed&&this._descriptionContent.unlink(this._onDescriptionContentChangeListener),this._descriptionContent=t,isTReadOnlyProperty(t)&&t.lazyLink(this._onDescriptionContentChangeListener),this.invalidatePeerDescriptionSiblingContent())}set descriptionContent(t){this.setDescriptionContent(t)}get descriptionContent(){return this.getDescriptionContent()}getDescriptionContent(){return unwrapProperty(this._descriptionContent)}setAriaRole(t){assert&&assert(t===null||typeof t=="string"),this._ariaRole!==t&&(this._ariaRole=t,t!==null?this.setPDOMAttribute("role",t):this.removePDOMAttribute("role"))}set ariaRole(t){this.setAriaRole(t)}get ariaRole(){return this.getAriaRole()}getAriaRole(){return this._ariaRole}setContainerAriaRole(t){assert&&assert(t===null||typeof t=="string"),this._containerAriaRole!==t&&(this._containerAriaRole=t,t===null?this.removePDOMAttribute("role",{elementName:PDOMPeer$1.CONTAINER_PARENT}):this.setPDOMAttribute("role",t,{elementName:PDOMPeer$1.CONTAINER_PARENT}))}set containerAriaRole(t){this.setContainerAriaRole(t)}get containerAriaRole(){return this.getContainerAriaRole()}getContainerAriaRole(){return this._containerAriaRole}onAriaValueTextChange(){const t=this.ariaValueText;t===null?this._hasAppliedAriaLabel&&(this.removePDOMAttribute("aria-valuetext"),this._hasAppliedAriaLabel=!1):(this.setPDOMAttribute("aria-valuetext",t),this._hasAppliedAriaLabel=!0)}setAriaValueText(t){this._ariaValueText!==t&&(isTReadOnlyProperty(this._ariaValueText)&&!this._ariaValueText.isDisposed&&this._ariaValueText.unlink(this._onAriaValueTextChangeListener),this._ariaValueText=t,isTReadOnlyProperty(t)&&t.lazyLink(this._onAriaValueTextChangeListener),this.onAriaValueTextChange())}set ariaValueText(t){this.setAriaValueText(t)}get ariaValueText(){return this.getAriaValueText()}getAriaValueText(){return unwrapProperty(this._ariaValueText)}setPDOMNamespace(t){return assert&&assert(t===null||typeof t=="string"),this._pdomNamespace!==t&&(this._pdomNamespace=t,this.onPDOMContentChange()),this}set pdomNamespace(t){this.setPDOMNamespace(t)}get pdomNamespace(){return this.getPDOMNamespace()}getPDOMNamespace(){return this._pdomNamespace}onAriaLabelChange(){const t=this.ariaLabel;t===null?this._hasAppliedAriaLabel&&(this.removePDOMAttribute("aria-label"),this._hasAppliedAriaLabel=!1):(this.setPDOMAttribute("aria-label",t),this._hasAppliedAriaLabel=!0)}setAriaLabel(t){this._ariaLabel!==t&&(isTReadOnlyProperty(this._ariaLabel)&&!this._ariaLabel.isDisposed&&this._ariaLabel.unlink(this._onAriaLabelChangeListener),this._ariaLabel=t,isTReadOnlyProperty(t)&&t.lazyLink(this._onAriaLabelChangeListener),this.onAriaLabelChange())}set ariaLabel(t){this.setAriaLabel(t)}get ariaLabel(){return this.getAriaLabel()}getAriaLabel(){return unwrapProperty(this._ariaLabel)}setFocusHighlight(t){this._focusHighlight!==t&&(this._focusHighlight=t,this._focusHighlightLayerable&&(assert&&assert(t instanceof Node$2),t.visible=!1),this.focusHighlightChangedEmitter.emit())}set focusHighlight(t){this.setFocusHighlight(t)}get focusHighlight(){return this.getFocusHighlight()}getFocusHighlight(){return this._focusHighlight}setFocusHighlightLayerable(t){this._focusHighlightLayerable!==t&&(this._focusHighlightLayerable=t,this._focusHighlight&&(assert&&assert(this._focusHighlight instanceof Node$2),this._focusHighlight.visible=!1,this.focusHighlightChangedEmitter.emit()))}set focusHighlightLayerable(t){this.setFocusHighlightLayerable(t)}get focusHighlightLayerable(){return this.getFocusHighlightLayerable()}getFocusHighlightLayerable(){return this._focusHighlightLayerable}setGroupFocusHighlight(t){this._groupFocusHighlight=t}set groupFocusHighlight(t){this.setGroupFocusHighlight(t)}get groupFocusHighlight(){return this.getGroupFocusHighlight()}getGroupFocusHighlight(){return this._groupFocusHighlight}setAriaLabelledbyAssociations(t){let s,r;if(assert)for(assert(Array.isArray(t)),r=0;r<t.length;r++)s=t[r];if(t.length===0&&this._ariaLabelledbyAssociations.length===0)return;const o=[],n=[],l=[];for(arrayDifference(t,this._ariaLabelledbyAssociations,n,o,l),r=0;r<o.length;r++)s=o[r],this.removeAriaLabelledbyAssociation(s);for(assert&&assert(this._ariaLabelledbyAssociations.length===l.length,"Removing associations should not have triggered other association changes"),r=0;r<n.length;r++){const h=t[r];this.addAriaLabelledbyAssociation(h)}}set ariaLabelledbyAssociations(t){this.setAriaLabelledbyAssociations(t)}get ariaLabelledbyAssociations(){return this.getAriaLabelledbyAssociations()}getAriaLabelledbyAssociations(){return this._ariaLabelledbyAssociations}addAriaLabelledbyAssociation(t){this._ariaLabelledbyAssociations.push(t),t.otherNode._nodesThatAreAriaLabelledbyThisNode.push(this),this.updateAriaLabelledbyAssociationsInPeers()}removeAriaLabelledbyAssociation(t){assert&&assert(_.includes(this._ariaLabelledbyAssociations,t)),this._ariaLabelledbyAssociations.splice(_.indexOf(this._ariaLabelledbyAssociations,t),1)[0].otherNode.removeNodeThatIsAriaLabelledByThisNode(this),this.updateAriaLabelledbyAssociationsInPeers()}removeNodeThatIsAriaLabelledByThisNode(t){const s=_.indexOf(this._nodesThatAreAriaLabelledbyThisNode,t);assert&&assert(s>=0),this._nodesThatAreAriaLabelledbyThisNode.splice(s,1)}updateAriaLabelledbyAssociationsInPeers(){for(let t=0;t<this.pdomInstances.length;t++)this.pdomInstances[t].peer.onAriaLabelledbyAssociationChange()}updateOtherNodesAriaLabelledby(){for(let t=0;t<this._nodesThatAreAriaLabelledbyThisNode.length;t++)this._nodesThatAreAriaLabelledbyThisNode[t].updateAriaLabelledbyAssociationsInPeers()}getNodesThatAreAriaLabelledbyThisNode(){return this._nodesThatAreAriaLabelledbyThisNode}get nodesThatAreAriaLabelledbyThisNode(){return this.getNodesThatAreAriaLabelledbyThisNode()}setAriaDescribedbyAssociations(t){let s;if(assert){assert(Array.isArray(t));for(let h=0;h<t.length;h++)s=t[h]}if(t.length===0&&this._ariaDescribedbyAssociations.length===0)return;const r=[],o=[],n=[];let l;for(arrayDifference(t,this._ariaDescribedbyAssociations,o,r,n),l=0;l<r.length;l++)s=r[l],this.removeAriaDescribedbyAssociation(s);for(assert&&assert(this._ariaDescribedbyAssociations.length===n.length,"Removing associations should not have triggered other association changes"),l=0;l<o.length;l++){const h=t[l];this.addAriaDescribedbyAssociation(h)}}set ariaDescribedbyAssociations(t){this.setAriaDescribedbyAssociations(t)}get ariaDescribedbyAssociations(){return this.getAriaDescribedbyAssociations()}getAriaDescribedbyAssociations(){return this._ariaDescribedbyAssociations}addAriaDescribedbyAssociation(t){assert&&assert(!_.includes(this._ariaDescribedbyAssociations,t),"describedby association already registed"),this._ariaDescribedbyAssociations.push(t),t.otherNode._nodesThatAreAriaDescribedbyThisNode.push(this),this.updateAriaDescribedbyAssociationsInPeers()}hasAriaDescribedbyAssociation(t){return _.includes(this._ariaDescribedbyAssociations,t)}removeAriaDescribedbyAssociation(t){assert&&assert(_.includes(this._ariaDescribedbyAssociations,t)),this._ariaDescribedbyAssociations.splice(_.indexOf(this._ariaDescribedbyAssociations,t),1)[0].otherNode.removeNodeThatIsAriaDescribedByThisNode(this),this.updateAriaDescribedbyAssociationsInPeers()}removeNodeThatIsAriaDescribedByThisNode(t){const s=_.indexOf(this._nodesThatAreAriaDescribedbyThisNode,t);assert&&assert(s>=0),this._nodesThatAreAriaDescribedbyThisNode.splice(s,1)}updateAriaDescribedbyAssociationsInPeers(){for(let t=0;t<this.pdomInstances.length;t++)this.pdomInstances[t].peer.onAriaDescribedbyAssociationChange()}updateOtherNodesAriaDescribedby(){for(let t=0;t<this._nodesThatAreAriaDescribedbyThisNode.length;t++)this._nodesThatAreAriaDescribedbyThisNode[t].updateAriaDescribedbyAssociationsInPeers()}getNodesThatAreAriaDescribedbyThisNode(){return this._nodesThatAreAriaDescribedbyThisNode}get nodesThatAreAriaDescribedbyThisNode(){return this.getNodesThatAreAriaDescribedbyThisNode()}setActiveDescendantAssociations(t){let s;if(assert){assert(Array.isArray(t));for(let h=0;h<t.length;h++)s=t[h]}if(t.length===0&&this._activeDescendantAssociations.length===0)return;const r=[],o=[],n=[];let l;for(arrayDifference(t,this._activeDescendantAssociations,o,r,n),l=0;l<r.length;l++)s=r[l],this.removeActiveDescendantAssociation(s);for(assert&&assert(this._activeDescendantAssociations.length===n.length,"Removing associations should not have triggered other association changes"),l=0;l<o.length;l++){const h=t[l];this.addActiveDescendantAssociation(h)}}set activeDescendantAssociations(t){this.setActiveDescendantAssociations(t)}get activeDescendantAssociations(){return this.getActiveDescendantAssociations()}getActiveDescendantAssociations(){return this._activeDescendantAssociations}addActiveDescendantAssociation(t){this._activeDescendantAssociations.push(t),t.otherNode._nodesThatAreActiveDescendantToThisNode.push(this),this.updateActiveDescendantAssociationsInPeers()}removeActiveDescendantAssociation(t){assert&&assert(_.includes(this._activeDescendantAssociations,t)),this._activeDescendantAssociations.splice(_.indexOf(this._activeDescendantAssociations,t),1)[0].otherNode.removeNodeThatIsActiveDescendantThisNode(this),this.updateActiveDescendantAssociationsInPeers()}removeNodeThatIsActiveDescendantThisNode(t){const s=_.indexOf(this._nodesThatAreActiveDescendantToThisNode,t);assert&&assert(s>=0),this._nodesThatAreActiveDescendantToThisNode.splice(s,1)}updateActiveDescendantAssociationsInPeers(){for(let t=0;t<this.pdomInstances.length;t++)this.pdomInstances[t].peer.onActiveDescendantAssociationChange()}updateOtherNodesActiveDescendant(){for(let t=0;t<this._nodesThatAreActiveDescendantToThisNode.length;t++)this._nodesThatAreActiveDescendantToThisNode[t].updateActiveDescendantAssociationsInPeers()}getNodesThatAreActiveDescendantToThisNode(){return this._nodesThatAreActiveDescendantToThisNode}get nodesThatAreActiveDescendantToThisNode(){return this.getNodesThatAreActiveDescendantToThisNode()}setPDOMOrder(t){if(assert&&assert(Array.isArray(t)||t===null,`Array or null expected, received: ${t}`),assert&&t&&t.forEach((s,r)=>{assert&&assert(s===null||s instanceof Node$2,`Elements of pdomOrder should be either a Node or null. Element at index ${r} is: ${s}`)}),assert&&t&&assert(this.getTrails(s=>_.includes(t,s)).length===0,"pdomOrder should not include any ancestors or the node itself"),this._pdomOrder!==t){const s=this._pdomOrder;this._pdomOrder=t===null?null:t.slice(),PDOMTree$1.pdomOrderChange(this,s,t),this.rendererSummaryRefreshEmitter.emit()}}set pdomOrder(t){this.setPDOMOrder(t)}get pdomOrder(){return this.getPDOMOrder()}getPDOMOrder(){return this._pdomOrder?this._pdomOrder.slice(0):this._pdomOrder}hasPDOMOrder(){return this._pdomOrder!==null&&this._pdomOrder.length!==0&&(this._pdomOrder.length>1||this._pdomOrder[0]!==null)}getPDOMParent(){return this._pdomParent}get pdomParent(){return this.getPDOMParent()}getEffectiveChildren(){const t=[];for(let s=0;s<this._children.length;s++){const r=this._children[s];r._pdomParent||t.push(r)}if(this.hasPDOMOrder()){const s=this.pdomOrder.slice(),r=s.indexOf(null);return r>=0?(t.unshift(r,1),Array.prototype.splice.apply(s,t)):Array.prototype.push.apply(s,t),s}else return t}setPDOMVisible(t){this._pdomVisible!==t&&(this._pdomVisible=t,this._pdomDisplaysInfo.onPDOMVisibilityChange(t))}set pdomVisible(t){this.setPDOMVisible(t)}get pdomVisible(){return this.isPDOMVisible()}isPDOMVisible(){return this._pdomVisible}isPDOMDisplayed(){for(let t=0;t<this._pdomInstances.length;t++)if(this._pdomInstances[t].isGloballyVisible())return!0;return!1}get pdomDisplayed(){return this.isPDOMDisplayed()}invalidatePeerInputValue(){for(let t=0;t<this.pdomInstances.length;t++)this.pdomInstances[t].peer.onInputValueChange()}setInputValue(t){assert&&this._tagName&&assert(_.includes(FORM_ELEMENTS,this._tagName.toUpperCase()),"dom element must be a form element to support value"),t!==this._inputValue&&(isTReadOnlyProperty(this._inputValue)&&!this._inputValue.isDisposed&&this._inputValue.unlink(this._onPDOMContentChangeListener),this._inputValue=t,isTReadOnlyProperty(t)&&t.lazyLink(this._onPDOMContentChangeListener),this.invalidatePeerInputValue())}set inputValue(t){this.setInputValue(t)}get inputValue(){return this.getInputValue()}getInputValue(){let t;return isTReadOnlyProperty(this._inputValue)?t=this._inputValue.value:t=this._inputValue,t===null?null:""+t}setPDOMChecked(t){this._tagName&&assert&&assert(this._tagName.toUpperCase()===INPUT_TAG$1,"Cannot set checked on a non input tag."),this._inputType&&assert&&assert(INPUT_TYPES_THAT_SUPPORT_CHECKED.includes(this._inputType.toUpperCase()),`inputType does not support checked: ${this._inputType}`),this._pdomChecked!==t&&(this._pdomChecked=t,this.setPDOMAttribute("checked",t,{asProperty:!0}))}set pdomChecked(t){this.setPDOMChecked(t)}get pdomChecked(){return this.getPDOMChecked()}getPDOMChecked(){return this._pdomChecked}getPDOMAttributes(){return this._pdomAttributes.slice(0)}get pdomAttributes(){return this.getPDOMAttributes()}setPDOMAttribute(t,s,r){assert&&r&&assert(Object.getPrototypeOf(r)===Object.prototype,"Extra prototype on pdomAttribute options object is a code smell");const o=optionize()({namespace:null,asProperty:!1,elementName:PDOMPeer$1.PRIMARY_SIBLING},r);assert&&assert(!ASSOCIATION_ATTRIBUTES.includes(t),"setPDOMAttribute does not support association attributes");for(let l=0;l<this._pdomAttributes.length;l++){const h=this._pdomAttributes[l];h.attribute===t&&h.options.namespace===o.namespace&&h.options.elementName===o.elementName&&(h.options.asProperty===o.asProperty?this._pdomAttributes.splice(l,1):this.removePDOMAttribute(h.attribute,h.options))}let n=l=>{assert&&typeof l=="string"&&validate(l,Validation.STRING_WITHOUT_TEMPLATE_VARS_VALIDATOR);for(let h=0;h<this._pdomInstances.length;h++)this._pdomInstances[h].peer.setAttributeToElement(t,l,o)};isTReadOnlyProperty(s)?s.link(n):(n(s),n=null),this._pdomAttributes.push({attribute:t,value:s,listener:n,options:o})}removePDOMAttribute(t,s){assert&&s&&assert(Object.getPrototypeOf(s)===Object.prototype,"Extra prototype on pdomAttribute options object is a code smell");const r=optionize()({namespace:null,elementName:PDOMPeer$1.PRIMARY_SIBLING},s);let o=!1;for(let n=0;n<this._pdomAttributes.length;n++)if(this._pdomAttributes[n].attribute===t&&this._pdomAttributes[n].options.namespace===r.namespace&&this._pdomAttributes[n].options.elementName===r.elementName){const l=this._pdomAttributes[n];l.listener&&isTReadOnlyProperty(l.value)&&!l.value.isDisposed&&l.value.unlink(l.listener),this._pdomAttributes.splice(n,1),o=!0}assert&&assert(o,`Node does not have pdom attribute ${t}`);for(let n=0;n<this._pdomInstances.length;n++)this._pdomInstances[n].peer.removeAttributeFromElement(t,r)}removePDOMAttributes(){const t=this.getPDOMAttributes();for(let s=0;s<t.length;s++){const r=t[s].attribute;this.removePDOMAttribute(r)}}hasPDOMAttribute(t,s){assert&&s&&assert(Object.getPrototypeOf(s)===Object.prototype,"Extra prototype on pdomAttribute options object is a code smell");const r=optionize()({namespace:null,elementName:PDOMPeer$1.PRIMARY_SIBLING},s);let o=!1;for(let n=0;n<this._pdomAttributes.length;n++)this._pdomAttributes[n].attribute===t&&this._pdomAttributes[n].options.namespace===r.namespace&&this._pdomAttributes[n].options.elementName===r.elementName&&(o=!0);return o}setPDOMClass(t,s){const r=optionize()({elementName:PDOMPeer$1.PRIMARY_SIBLING},s);for(let o=0;o<this._pdomClasses.length;o++){const n=this._pdomClasses[o];if(n.className===t&&n.options.elementName===r.elementName)return}this._pdomClasses.push({className:t,options:r});for(let o=0;o<this._pdomInstances.length;o++)this._pdomInstances[o].peer.setClassToElement(t,r)}removePDOMClass(t,s){const r=optionize()({elementName:PDOMPeer$1.PRIMARY_SIBLING},s);let o=!1;for(let n=0;n<this._pdomClasses.length;n++)this._pdomClasses[n].className===t&&this._pdomClasses[n].options.elementName===r.elementName&&(this._pdomClasses.splice(n,1),o=!0);assert&&assert(o,`Node does not have pdom attribute ${t}`);for(let n=0;n<this._pdomClasses.length;n++)this.pdomInstances[n].peer.removeClassFromElement(t,r)}getPDOMClasses(){return this._pdomClasses.slice(0)}get pdomClasses(){return this.getPDOMClasses()}setFocusable(t){if(assert&&assert(t===null||typeof t=="boolean"),this._focusableOverride!==t){this._focusableOverride=t;for(let s=0;s<this._pdomInstances.length;s++)assert&&assert(this._pdomInstances[s].peer,"Peer required to set focusable."),this._pdomInstances[s].peer.setFocusable(this.focusable)}}set focusable(t){this.setFocusable(t)}get focusable(){return this.isFocusable()}isFocusable(){return this._focusableOverride!==null?this._focusableOverride:this._tagName===null?!1:PDOMUtils$1.tagIsDefaultFocusable(this._tagName)}setPDOMTransformSourceNode(t){this._pdomTransformSourceNode=t;for(let s=0;s<this._pdomInstances.length;s++)this._pdomInstances[s].peer.setPDOMTransformSourceNode(this._pdomTransformSourceNode)}set pdomTransformSourceNode(t){this.setPDOMTransformSourceNode(t)}get pdomTransformSourceNode(){return this.getPDOMTransformSourceNode()}getPDOMTransformSourceNode(){return this._pdomTransformSourceNode}setFocusPanTargetBoundsProperty(t){t!==this._focusPanTargetBoundsProperty&&(assert&&assert(!this._focusPanTargetBoundsProperty,"Cannot change focusPanTargetBoundsProperty after it is set."),this._focusPanTargetBoundsProperty=t)}getFocusPanTargetBoundsProperty(){return this._focusPanTargetBoundsProperty}set focusPanTargetBoundsProperty(t){this.setFocusPanTargetBoundsProperty(t)}get focusPanTargetBoundsProperty(){return this.getFocusPanTargetBoundsProperty()}setLimitPanDirection(t){this._limitPanDirection=t}getLimitPanDirection(){return this._limitPanDirection}set limitPanDirection(t){this.setLimitPanDirection(t)}get limitPanDirection(){return this.getLimitPanDirection()}setPositionInPDOM(t){this._positionInPDOM=t;for(let s=0;s<this._pdomInstances.length;s++)this._pdomInstances[s].peer.setPositionInPDOM(t)}set positionInPDOM(t){this.setPositionInPDOM(t)}get positionInPDOM(){return this.getPositionInPDOM()}getPositionInPDOM(){return this._positionInPDOM}setExcludeLabelSiblingFromInput(){this.excludeLabelSiblingFromInput=!0,this.onPDOMContentChange()}isInsidePhetioArchetype(t=this){if(t.isPhetioInstrumented())return t.phetioIsArchetype;for(let s=0;s<t.parents.length;s++)if(this.isInsidePhetioArchetype(t.parents[s]))return!0;return!1}alertDescriptionUtterance(t){if(isSettingPhetioStateProperty.value||Tandem.PHET_IO_ENABLED&&this.isInsidePhetioArchetype())return;const s=this.getConnectedDisplays();for(let r=0;r<s.length;r++){const o=s[r];o.isAccessible()&&o.descriptionUtteranceQueue.addToBack(t)}}forEachUtteranceQueue(t){const s=this.getConnectedDisplays();assert&&assert(s.length>0,"must be connected to a display to use UtteranceQueue features");for(let r=0;r<s.length;r++){const o=s[r];o.isAccessible()&&t(o.descriptionUtteranceQueue)}}getBaseOptions(){const t={};for(let s=0;s<ACCESSIBILITY_OPTION_KEYS.length;s++){const r=ACCESSIBILITY_OPTION_KEYS[s];t[r]=this[r]}return t}getNestedPDOMOrder(){const t=new Trail(this);let s=[];const r=[],o=[r];function n(l,h){let g=0;if(_.each(s,S=>{l===S&&g++}),g>1||g===1&&!h)return;if(l.hasPDOMContent){const S={trail:t.copy(),children:[]};o[o.length-1].push(S),o.push(S.children)}const d=l._pdomOrder===null?[]:l._pdomOrder;s=s.concat(d),_.each(d,S=>{_.each(l.getLeafTrailsTo(S),O=>{O.removeAncestor(),t.addDescendantTrail(O),n(S,!0),t.removeDescendantTrail(O)})});const A=l._children.length;for(let S=0;S<A;S++){const O=l._children[S];t.addDescendant(O,S),n(O,!1),t.removeDescendant()}_.each(d,()=>{s.pop()}),l.hasPDOMContent&&o.pop()}return n(this,!1),r}onPDOMContentChange(){PDOMTree$1.pdomContentChange(this),this.pdomHeading&&this.computeHeadingLevel(),this.rendererSummaryRefreshEmitter.emit()}get hasPDOMContent(){return!!this._tagName}onPDOMAddChild(t){sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.ParallelDOM(`onPDOMAddChild n#${t.id} (parent:n#${this.id})`),sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.push(),assert&&function(r){r._rendererSummary.hasNoPDOM()||r.pdomOrder&&assert(r.getTrails(o=>_.includes(r.pdomOrder,o)).length===0,"pdomOrder should not include any ancestors or the node itself")}(t),assert&&PDOMTree$1.auditNodeForPDOMCycles(this),this._pdomDisplaysInfo.onAddChild(t),PDOMTree$1.addChild(this,t),sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.pop()}onPDOMRemoveChild(t){sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.ParallelDOM(`onPDOMRemoveChild n#${t.id} (parent:n#${this.id})`),sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.push(),this._pdomDisplaysInfo.onRemoveChild(t),PDOMTree$1.removeChild(this,t),t.updateOtherNodesAriaLabelledby(),t.updateOtherNodesAriaDescribedby(),t.updateOtherNodesActiveDescendant(),sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.pop()}onPDOMReorderedChildren(){sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.ParallelDOM(`onPDOMReorderedChildren (parent:n#${this.id})`),sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.push(),PDOMTree$1.childrenOrderChange(this),sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.pop()}updateLinkedElementForProperty(t,s,r){if(assert&&assert(s!==r,"should not be called on same values"),this.isPhetioInstrumented()){s&&s instanceof ReadOnlyProperty&&s.isPhetioInstrumented()&&s instanceof PhetioObject&&this.removeLinkedElements(s);const o=this.tandem.createTandem(t);r&&r instanceof ReadOnlyProperty&&r.isPhetioInstrumented()&&r instanceof PhetioObject&&o!==r.tandem&&this.addLinkedElement(r,{tandemName:t})}}getPDOMInstances(){return this._pdomInstances}get pdomInstances(){return this.getPDOMInstances()}addPDOMInstance(t){this._pdomInstances.push(t)}removePDOMInstance(t){const s=_.indexOf(this._pdomInstances,t);assert&&assert(s!==-1,"Cannot remove a PDOMInstance from a Node if it was not there"),this._pdomInstances.splice(s,1)}static BASIC_ACCESSIBLE_NAME_BEHAVIOR(t,s,r){return t.tagName==="input"?(s.labelTagName="label",s.labelContent=r):PDOMUtils$1.tagNameSupportsContent(t.tagName)?s.innerContent=r:s.ariaLabel=r,s}static HELP_TEXT_BEFORE_CONTENT(t,s,r){return s.descriptionTagName=PDOMUtils$1.DEFAULT_DESCRIPTION_TAG_NAME,s.descriptionContent=r,s.appendDescription=!1,s}static HELP_TEXT_AFTER_CONTENT(t,s,r){return s.descriptionTagName=PDOMUtils$1.DEFAULT_DESCRIPTION_TAG_NAME,s.descriptionContent=r,s.appendDescription=!0,s}}scenery.register("ParallelDOM",ParallelDOM);let globalIdCounter$4=1;const scratchBounds2$1=Bounds2.NOTHING.copy(),scratchBounds2Extra=Bounds2.NOTHING.copy(),scratchMatrix3=new Matrix3,ENABLED_PROPERTY_TANDEM_NAME=EnabledProperty.TANDEM_NAME,VISIBLE_PROPERTY_TANDEM_NAME="visibleProperty",INPUT_ENABLED_PROPERTY_TANDEM_NAME="inputEnabledProperty",PHET_IO_STATE_DEFAULT$1=!1;let maxParentCount=0,maxChildCount=0;const REQUIRES_BOUNDS_OPTION_KEYS=["leftTop","centerTop","rightTop","leftCenter","center","rightCenter","leftBottom","centerBottom","rightBottom","left","right","top","bottom","centerX","centerY"],NODE_OPTION_KEYS=["children","cursor","phetioVisiblePropertyInstrumented","visibleProperty","visible","pickableProperty","pickable","phetioEnabledPropertyInstrumented","enabledProperty","enabled","phetioInputEnabledPropertyInstrumented","inputEnabledProperty","inputEnabled","inputListeners","opacity","disabledOpacity","filters","matrix","translation","x","y","rotation","scale","excludeInvisibleChildrenFromBounds","layoutOptions","localBounds","maxWidth","maxHeight","renderer","layerSplit","usesOpacity","cssTransform","excludeInvisible","webglScale","preventFit","mouseArea","touchArea","clipArea","transformBounds",...REQUIRES_BOUNDS_OPTION_KEYS],DEFAULT_OPTIONS$7={phetioVisiblePropertyInstrumented:!0,visible:!0,opacity:1,disabledOpacity:1,pickable:null,enabled:!0,phetioEnabledPropertyInstrumented:!1,inputEnabled:!0,phetioInputEnabledPropertyInstrumented:!1,clipArea:null,mouseArea:null,touchArea:null,cursor:null,transformBounds:!1,maxWidth:null,maxHeight:null,renderer:null,usesOpacity:!1,layerSplit:!1,cssTransform:!1,excludeInvisible:!1,webglScale:null,preventFit:!1},DEFAULT_INTERNAL_RENDERER=DEFAULT_OPTIONS$7.renderer===null?0:Renderer.fromName(DEFAULT_OPTIONS$7.renderer);var Vn;let Node$1=(Vn=class extends ParallelDOM{constructor(t){super(),this.parentAddedEmitter=new TinyEmitter,this.parentRemovedEmitter=new TinyEmitter,this._activeParentLayoutConstraint=null,this._id=globalIdCounter$4++,this._instances=[],this._rootedDisplays=[],this._drawables=[],this._visibleProperty=new TinyForwardingProperty(DEFAULT_OPTIONS$7.visible,DEFAULT_OPTIONS$7.phetioVisiblePropertyInstrumented,this.onVisiblePropertyChange.bind(this)),this.opacityProperty=new TinyProperty(DEFAULT_OPTIONS$7.opacity,this.onOpacityPropertyChange.bind(this)),this.disabledOpacityProperty=new TinyProperty(DEFAULT_OPTIONS$7.disabledOpacity,this.onDisabledOpacityPropertyChange.bind(this)),this._pickableProperty=new TinyForwardingProperty(DEFAULT_OPTIONS$7.pickable,!1,this.onPickablePropertyChange.bind(this)),this._enabledProperty=new TinyForwardingProperty(DEFAULT_OPTIONS$7.enabled,DEFAULT_OPTIONS$7.phetioEnabledPropertyInstrumented,this.onEnabledPropertyChange.bind(this)),this._inputEnabledProperty=new TinyForwardingProperty(DEFAULT_OPTIONS$7.inputEnabled,DEFAULT_OPTIONS$7.phetioInputEnabledPropertyInstrumented),this.clipAreaProperty=new TinyProperty(DEFAULT_OPTIONS$7.clipArea),this.voicingVisibleProperty=new TinyProperty(!0),this._mouseArea=DEFAULT_OPTIONS$7.mouseArea,this._touchArea=DEFAULT_OPTIONS$7.touchArea,this._cursor=DEFAULT_OPTIONS$7.cursor,this._children=[],this._parents=[],this._transformBounds=DEFAULT_OPTIONS$7.transformBounds,this._transform=new Transform3,this._transformListener=this.onTransformChange.bind(this),this._transform.changeEmitter.addListener(this._transformListener),this._maxWidth=DEFAULT_OPTIONS$7.maxWidth,this._maxHeight=DEFAULT_OPTIONS$7.maxHeight,this._appliedScaleFactor=1,this._inputListeners=[],this._renderer=DEFAULT_INTERNAL_RENDERER,this._usesOpacity=DEFAULT_OPTIONS$7.usesOpacity,this._layerSplit=DEFAULT_OPTIONS$7.layerSplit,this._cssTransform=DEFAULT_OPTIONS$7.cssTransform,this._excludeInvisible=DEFAULT_OPTIONS$7.excludeInvisible,this._webglScale=DEFAULT_OPTIONS$7.webglScale,this._preventFit=DEFAULT_OPTIONS$7.preventFit,this.inputEnabledProperty.lazyLink(this.pdomBoundInputEnabledListener);const s=this.onBoundsListenersAddedOrRemoved.bind(this),r=this.validateBounds.bind(this),o=this.validateSelfBounds.bind(this);this.boundsProperty=new TinyStaticProperty(Bounds2.NOTHING.copy(),r),this.boundsProperty.changeCount=s,this.localBoundsProperty=new TinyStaticProperty(Bounds2.NOTHING.copy(),r),this.localBoundsProperty.changeCount=s,this.childBoundsProperty=new TinyStaticProperty(Bounds2.NOTHING.copy(),r),this.childBoundsProperty.changeCount=s,this.selfBoundsProperty=new TinyStaticProperty(Bounds2.NOTHING.copy(),o),this._localBoundsOverridden=!1,this._excludeInvisibleChildrenFromBounds=!1,this._layoutOptions=null,this._boundsDirty=!0,this._localBoundsDirty=!0,this._selfBoundsDirty=!0,this._childBoundsDirty=!0,assert&&(this._originalBounds=this.boundsProperty._value,this._originalLocalBounds=this.localBoundsProperty._value,this._originalSelfBounds=this.selfBoundsProperty._value,this._originalChildBounds=this.childBoundsProperty._value),this._filters=[],this.childrenChangedEmitter=new TinyEmitter,this.childInsertedEmitter=new TinyEmitter,this.childRemovedEmitter=new TinyEmitter,this.childrenReorderedEmitter=new TinyEmitter,this.transformEmitter=new TinyEmitter,this.instanceRefreshEmitter=new TinyEmitter,this.rendererSummaryRefreshEmitter=new TinyEmitter,this.filterChangeEmitter=new TinyEmitter,this.changedInstanceEmitter=new TinyEmitter,this.layoutOptionsChangedEmitter=new TinyEmitter,this._rendererBitmask=Renderer.bitmaskNodeDefault,this._rendererSummary=new RendererSummary$1(this),this._boundsEventCount=0,this._boundsEventSelfCount=0,this._picker=new Picker(this),this._isGettingRemovedFromParent=!1,t&&this.mutate(t)}insertChild(t,s,r){var o,n,l,h;if(assert&&assert(s!=null,"insertChild cannot insert a null/undefined child"),assert&&assert(!_.includes(this._children,s),"Parent already contains child"),assert&&assert(s!==this,"Cannot add self as a child"),assert&&assert(s._parents!==null,"Tried to insert a disposed child node?"),assert&&assert(!s.isDisposed,"Tried to insert a disposed Node"),this._picker.onInsertChild(s),this.changeBoundsEventCount(s._boundsEventCount>0?1:0),this._rendererSummary.summaryChange(RendererSummary$1.bitmaskAll,s._rendererSummary.bitmask),s._parents.push(this),assert&&((n=(o=window.phet)==null?void 0:o.chipper)!=null&&n.queryParameters)&&isFinite(phet.chipper.queryParameters.parentLimit)){const g=s._parents.length;maxParentCount<g&&(maxParentCount=g,console.log(`Max Node parents: ${maxParentCount}`),assert(maxParentCount<=phet.chipper.queryParameters.parentLimit,`parent count of ${maxParentCount} above ?parentLimit=${phet.chipper.queryParameters.parentLimit}`))}if(this._children.splice(t,0,s),assert&&((h=(l=window.phet)==null?void 0:l.chipper)!=null&&h.queryParameters)&&isFinite(phet.chipper.queryParameters.childLimit)){const g=this._children.length;maxChildCount<g&&(maxChildCount=g,console.log(`Max Node children: ${maxChildCount}`),assert(maxChildCount<=phet.chipper.queryParameters.childLimit,`child count of ${maxChildCount} above ?childLimit=${phet.chipper.queryParameters.childLimit}`))}return s._rendererSummary.hasNoPDOM()||this.onPDOMAddChild(s),s.invalidateBounds(),this._boundsDirty=!0,this.childInsertedEmitter.emit(s,t),s.parentAddedEmitter.emit(this),!r&&this.childrenChangedEmitter.emit(),assertSlow&&this._picker.audit(),this}addChild(t,s){return this.insertChild(this._children.length,t,s),this}removeChild(t,s){assert&&assert(t&&t instanceof Vn,"Need to call node.removeChild() with a Node."),assert&&assert(this.hasChild(t),"Attempted to removeChild with a node that was not a child.");const r=_.indexOf(this._children,t);return this.removeChildWithIndex(t,r,s),this}removeChildAt(t,s){assert&&assert(t>=0),assert&&assert(t<this._children.length);const r=this._children[t];return this.removeChildWithIndex(r,t,s),this}removeChildWithIndex(t,s,r){assert&&assert(t&&t instanceof Vn,"Need to call node.removeChildWithIndex() with a Node."),assert&&assert(this.hasChild(t),"Attempted to removeChild with a node that was not a child."),assert&&assert(this._children[s]===t,"Incorrect index for removeChildWithIndex"),assert&&assert(t._parents!==null,"Tried to remove a disposed child node?");const o=_.indexOf(t._parents,this);t._isGettingRemovedFromParent=!0,t._rendererSummary.hasNoPDOM()||this.onPDOMRemoveChild(t),this._picker.onRemoveChild(t),this.changeBoundsEventCount(t._boundsEventCount>0?-1:0),this._rendererSummary.summaryChange(t._rendererSummary.bitmask,RendererSummary$1.bitmaskAll),t._parents.splice(o,1),this._children.splice(s,1),t._isGettingRemovedFromParent=!1,this.invalidateBounds(),this._childBoundsDirty=!0,this.childRemovedEmitter.emit(t,s),t.parentRemovedEmitter.emit(this),!r&&this.childrenChangedEmitter.emit(),assertSlow&&this._picker.audit()}moveChildToIndex(t,s){assert&&assert(this.hasChild(t),"Attempted to moveChildToIndex with a node that was not a child."),assert&&assert(s%1===0&&s>=0&&s<this._children.length,`Invalid index: ${s}`);const r=this.indexOfChild(t);return this._children[s]!==t&&(this._children.splice(r,1),this._children.splice(s,0,t),this._rendererSummary.hasNoPDOM()||this.onPDOMReorderedChildren(),this.childrenReorderedEmitter.emit(Math.min(r,s),Math.max(r,s)),this.childrenChangedEmitter.emit()),this}removeAllChildren(){return this.setChildren([]),this}setChildren(t){const s=[],r=[],o=[];let n;for(arrayDifference(t,this._children,r,s,o),n=s.length-1;n>=0;n--)this.removeChild(s[n],!0);assert&&assert(this._children.length===o.length,"Removing children should not have triggered other children changes");let l=-1,h=-1;for(n=0;n<o.length;n++){const d=o[n];this._children[n]!==d&&(this._children[n]=d,l===-1&&(l=n),h=n)}const g=l!==-1;if(g&&(this._rendererSummary.hasNoPDOM()||this.onPDOMReorderedChildren(),this.childrenReorderedEmitter.emit(l,h)),r.length){let d=0,A=r[d];for(n=0;n<t.length;n++)t[n]===A&&(this.insertChild(n,A,!0),A=r[++d])}if((s.length!==0||r.length!==0||g)&&this.childrenChangedEmitter.emit(),assert)for(let d=0;d<this._children.length;d++)assert(t[d]===this._children[d],"Incorrect child after setChildren, possibly a reentrancy issue");return this}set children(t){this.setChildren(t)}get children(){return this.getChildren()}getChildren(){return this._children.slice(0)}getChildrenCount(){return this._children.length}getParents(){return this._parents.slice(0)}get parents(){return this.getParents()}getParent(){return assert&&assert(this._parents.length<=1,"Cannot call getParent on a node with multiple parents"),this._parents.length?this._parents[0]:null}get parent(){return this.getParent()}getChildAt(t){return this._children[t]}indexOfParent(t){return _.indexOf(this._parents,t)}indexOfChild(t){return _.indexOf(this._children,t)}moveToFront(){return _.each(this.parents,t=>t.moveChildToFront(this)),this}moveChildToFront(t){return this.moveChildToIndex(t,this._children.length-1)}moveForward(){return this.parents.forEach(t=>t.moveChildForward(this)),this}moveChildForward(t){const s=this.indexOfChild(t);return s<this.getChildrenCount()-1&&this.moveChildToIndex(t,s+1),this}moveBackward(){return this.parents.forEach(t=>t.moveChildBackward(this)),this}moveChildBackward(t){const s=this.indexOfChild(t);return s>0&&this.moveChildToIndex(t,s-1),this}moveToBack(){return _.each(this.parents,t=>t.moveChildToBack(this)),this}moveChildToBack(t){return this.moveChildToIndex(t,0)}replaceChild(t,s){assert&&assert(this.hasChild(t),"Attempted to replace a node that was not a child.");const r=this.indexOfChild(t),o=t.focused;return this.removeChild(t,!0),this.insertChild(r,s,!0),this.childrenChangedEmitter.emit(),o&&s.focusable&&s.focus(),this}detach(){return _.each(this._parents.slice(0),t=>t.removeChild(this)),this}changeBoundsEventCount(t){if(t!==0){const s=this._boundsEventCount===0;this._boundsEventCount+=t,assert&&assert(this._boundsEventCount>=0,"subtree bounds event count should be guaranteed to be >= 0");const r=this._boundsEventCount===0;if(s!==r){const o=s?1:-1,n=this._parents.length;for(let l=0;l<n;l++)this._parents[l].changeBoundsEventCount(o)}}}validateSelfBounds(){if(this._selfBoundsDirty){const t=scratchBounds2$1.set(this.selfBoundsProperty._value),s=this.updateSelfBounds();return this._selfBoundsDirty=!1,s&&this.selfBoundsProperty.notifyListeners(t),!0}return!1}validateBounds(){sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds(`validateBounds #${this._id}`),sceneryLog&&sceneryLog.bounds&&sceneryLog.push();let t;const s=1e-13;let r=this.validateSelfBounds();const o=this.childBoundsProperty._value,n=this.localBoundsProperty._value,l=this.selfBoundsProperty._value,h=this.boundsProperty._value;if(this._childBoundsDirty){for(r=!0,sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds("childBounds dirty"),t=this._children.length;t--;){const d=this._children[t];d&&d.validateBounds()}const g=scratchBounds2$1.set(o);for(o.set(Bounds2.NOTHING),t=this._children.length;t--;){const d=this._children[t];(d&&!this._excludeInvisibleChildrenFromBounds||d.isVisible())&&o.includeBounds(d.bounds)}this._childBoundsDirty=!1,sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds(`childBounds: ${o}`),o.equals(g)||o.equalsEpsilon(g,s)||this.childBoundsProperty.notifyListeners(g)}if(this._localBoundsDirty){r=!0,sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds("localBounds dirty"),this._localBoundsDirty=!1;const g=scratchBounds2$1.set(n);if(!this._localBoundsOverridden){n.set(l).includeBounds(o);const d=this.clipArea;d&&n.constrainBounds(d.bounds)}sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds(`localBounds: ${n}`),(this._maxWidth!==null||this._maxHeight!==null)&&this.updateMaxDimension(n),n.equals(g)||(this._boundsDirty=!0,n.equalsEpsilon(g,s)||this.localBoundsProperty.notifyListeners(g))}if(this._boundsDirty){r=!0,sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds("bounds dirty"),this._boundsDirty=!1;const g=scratchBounds2$1.set(h);if(this._transformBounds&&!this._transform.getMatrix().isAxisAligned()){const d=scratchMatrix3.set(this.getMatrix());h.set(Bounds2.NOTHING),this._includeTransformedSubtreeBounds(d,h);const A=this.clipArea;A&&h.constrainBounds(A.getBoundsWithTransform(d))}else h.set(n),this.transformBoundsFromLocalToParent(h);if(sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds(`bounds: ${h}`),!h.equals(g)){for(t=this._parents.length;t--;)this._parents[t].invalidateBounds();h.equalsEpsilon(g,s)||this.boundsProperty.notifyListeners(g)}}return(this._childBoundsDirty||this._boundsDirty)&&(sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds("revalidation"),this.validateBounds()),assert&&(assert(this._originalBounds===this.boundsProperty._value,"Reference for bounds changed!"),assert(this._originalLocalBounds===this.localBoundsProperty._value,"Reference for localBounds changed!"),assert(this._originalSelfBounds===this.selfBoundsProperty._value,"Reference for selfBounds changed!"),assert(this._originalChildBounds===this.childBoundsProperty._value,"Reference for childBounds changed!")),assertSlow&&(()=>{const d=Bounds2.NOTHING.copy();_.each(this._children,I=>{(!this._excludeInvisibleChildrenFromBounds||I.isVisible())&&d.includeBounds(I.boundsProperty._value)});let A=this.selfBoundsProperty._value.union(d);const S=this.clipArea;S&&(A=A.intersection(S.bounds));const O=this.localToParentBounds(A);assertSlow&&assertSlow(this.childBoundsProperty._value.equalsEpsilon(d,1e-6),`Child bounds mismatch after validateBounds: ${this.childBoundsProperty._value.toString()}, expected: ${d.toString()}`),assertSlow&&assertSlow(this._localBoundsOverridden||this._transformBounds||this.boundsProperty._value.equalsEpsilon(O,1e-6),`Bounds mismatch after validateBounds: ${this.boundsProperty._value.toString()}, expected: ${O.toString()}. This could have happened if a bounds instance owned by a Node was directly mutated (e.g. bounds.erode())`)})(),sceneryLog&&sceneryLog.bounds&&sceneryLog.pop(),r}_includeTransformedSubtreeBounds(t,s){this.selfBounds.isEmpty()||s.includeBounds(this.getTransformedSelfBounds(t));const r=this._children.length;for(let o=0;o<r;o++){const n=this._children[o];t.multiplyMatrix(n._transform.getMatrix()),n._includeTransformedSubtreeBounds(t,s),t.multiplyMatrix(n._transform.getInverse())}return s}validateWatchedBounds(){for(;this.watchedBoundsScan(););}watchedBoundsScan(){if(this._boundsEventSelfCount!==0)return this.validateBounds();if(this._boundsEventCount>0&&this._childBoundsDirty){let t=!1;const s=this._children.length;for(let r=0;r<s;r++)t=this._children[r].watchedBoundsScan()||t;return t}else return!1}invalidateBounds(){this._boundsDirty=!0,this._localBoundsDirty=!0;let t=this._parents.length;for(;t--;)this._parents[t].invalidateChildBounds()}invalidateChildBounds(){if(!this._childBoundsDirty){this._childBoundsDirty=!0,this._localBoundsDirty=!0;let t=this._parents.length;for(;t--;)this._parents[t].invalidateChildBounds()}}invalidateSelf(t){assert&&assert(t===void 0||t instanceof Bounds2,"invalidateSelf's newSelfBounds, if provided, needs to be Bounds2");const s=this.selfBoundsProperty._value;if(!t)this._selfBoundsDirty=!0,this.invalidateBounds(),this._picker.onSelfBoundsDirty();else if(assert&&assert(t.isEmpty()||t.isFinite(),"Bounds must be empty or finite in invalidateSelf"),this._selfBoundsDirty=!1,!s.equals(t)){const r=scratchBounds2$1.set(s);this.invalidateBounds(),this._picker.onSelfBoundsDirty(),s.set(t),this.selfBoundsProperty.notifyListeners(r)}assertSlow&&this._picker.audit()}updateSelfBounds(){return assert&&assert(this.selfBoundsProperty._value.equals(Bounds2.NOTHING)),!1}hasChild(t){assert&&assert(t&&t instanceof Vn,"hasChild needs to be called with a Node");const s=_.includes(this._children,t);return assert&&assert(s===_.includes(t._parents,this),"child-parent reference should match parent-child reference"),s}getSelfShape(){return this.selfBounds.isEmpty()?new Shape$1:Shape$1.bounds(this.selfBounds)}getSelfBounds(){return this.selfBoundsProperty.value}get selfBounds(){return this.getSelfBounds()}getSafeSelfBounds(){return this.selfBoundsProperty.value}get safeSelfBounds(){return this.getSafeSelfBounds()}getChildBounds(){return this.childBoundsProperty.value}get childBounds(){return this.getChildBounds()}getLocalBounds(){return this.localBoundsProperty.value}get localBounds(){return this.getLocalBounds()}set localBounds(t){this.setLocalBounds(t)}get localBoundsOverridden(){return this._localBoundsOverridden}setLocalBounds(t){assert&&assert(t===null||t instanceof Bounds2,"localBounds override should be set to either null or a Bounds2"),assert&&assert(t===null||!isNaN(t.minX),"minX for localBounds should not be NaN"),assert&&assert(t===null||!isNaN(t.minY),"minY for localBounds should not be NaN"),assert&&assert(t===null||!isNaN(t.maxX),"maxX for localBounds should not be NaN"),assert&&assert(t===null||!isNaN(t.maxY),"maxY for localBounds should not be NaN");const s=this.localBoundsProperty._value,r=s.copy();if(t===null)this._localBoundsOverridden&&(this._localBoundsOverridden=!1,this.localBoundsProperty.notifyListeners(r),this.invalidateBounds());else{const o=!t.equals(s)||!this._localBoundsOverridden;o&&s.set(t),this._localBoundsOverridden||(this._localBoundsOverridden=!0),o&&(this.localBoundsProperty.notifyListeners(r),this.invalidateBounds())}return this}getTransformedSelfBounds(t){return this.selfBounds.transformed(t)}getTransformedSafeSelfBounds(t){return this.safeSelfBounds.transformed(t)}getSafeTransformedVisibleBounds(t){const s=(t||Matrix3.IDENTITY).timesMatrix(this.matrix),r=Bounds2.NOTHING.copy();if(this.visibleProperty.value&&(this.selfBounds.isEmpty()||r.includeBounds(this.getTransformedSafeSelfBounds(s)),this._children.length))for(let o=0;o<this._children.length;o++)r.includeBounds(this._children[o].getSafeTransformedVisibleBounds(s));return r}get safeTransformedVisibleBounds(){return this.getSafeTransformedVisibleBounds()}setTransformBounds(t){return this._transformBounds!==t&&(this._transformBounds=t,this.invalidateBounds()),this}set transformBounds(t){this.setTransformBounds(t)}get transformBounds(){return this.getTransformBounds()}getTransformBounds(){return this._transformBounds}getBounds(){return this.boundsProperty.value}get bounds(){return this.getBounds()}getVisibleLocalBounds(){const t=this.selfBounds.copy();let s=this._children.length;for(;s--;)t.includeBounds(this._children[s].getVisibleBounds());const r=this.clipArea;return r&&t.constrainBounds(r.bounds),assert&&assert(t.isFinite()||t.isEmpty(),"Visible bounds should not be infinite"),t}get visibleLocalBounds(){return this.getVisibleLocalBounds()}getVisibleBounds(){return this.isVisible()?this.getVisibleLocalBounds().transform(this.getMatrix()):Bounds2.NOTHING}get visibleBounds(){return this.getVisibleBounds()}hitTest(t,s,r){return assert&&assert(t.isFinite(),"The point should be a finite Vector2"),assert&&assert(s===void 0||typeof s=="boolean","If isMouse is provided, it should be a boolean"),assert&&assert(r===void 0||typeof r=="boolean","If isTouch is provided, it should be a boolean"),this._picker.hitTest(t,!!s,!!r)}trailUnderPointer(t){return t.point===null?null:this.hitTest(t.point,t instanceof Mouse,t.isTouchLike())}containsPoint(t){return this.hitTest(t)!==null}containsPointSelf(t){return this.selfBounds.containsPoint(t)}intersectsBoundsSelf(t){return this.selfBounds.intersectsBounds(t)}isPhetioMouseHittable(t){return this.pickable===!1&&!this.isAnyDescendantAPhetioMouseHitTarget()?!1:this.visible&&(this.clipArea===null||this.clipArea.containsPoint(this._transform.getInverse().timesVector2(t)))}isAnyDescendantAPhetioMouseHitTarget(){return this.getPhetioMouseHitTarget()!=="phetioNotSelectable"||_.some(this.children,t=>t.isAnyDescendantAPhetioMouseHitTarget())}getPhetioMouseHit(t){if(!this.isPhetioMouseHittable(t))return null;const s=this._transform.getInverse().timesVector2(t);let r=null;for(let o=this._children.length-1;o>=0;o--){const n=this._children[o].getPhetioMouseHit(s);if(n instanceof PhetioObject)return n;n==="phetioNotSelectable"&&(r=!0)}return r?this.getPhetioMouseHitTarget():this._mouseArea?this._mouseArea.containsPoint(s)?this.getPhetioMouseHitTarget():null:this.selfBounds.containsPoint(s)&&this.containsPointSelf(s)?this.getPhetioMouseHitTarget():null}isPainted(){return!1}areSelfBoundsValid(){return!0}hasParent(){return this._parents.length!==0}hasChildren(){return this._children.length>0}isChildIncludedInLayout(t){return t.bounds.isValid()&&(!this._excludeInvisibleChildrenFromBounds||t.visible)}walkDepthFirst(t){t(this);const s=this._children.length;for(let r=0;r<s;r++)this._children[r].walkDepthFirst(t)}addInputListener(t){return assert&&assert(!_.includes(this._inputListeners,t),"Input listener already registered on this Node"),assert&&assert(t!==null,"Input listener cannot be null"),assert&&assert(t!==void 0,"Input listener cannot be undefined"),_.includes(this._inputListeners,t)||(this._inputListeners.push(t),this._picker.onAddInputListener(),assertSlow&&this._picker.audit()),this}removeInputListener(t){const s=_.indexOf(this._inputListeners,t);return assert&&assert(this.isDisposed||s>=0,"Could not find input listener to remove"),s>=0&&(this._inputListeners.splice(s,1),this._picker.onRemoveInputListener(),assertSlow&&this._picker.audit()),this}hasInputListener(t){for(let s=0;s<this._inputListeners.length;s++)if(this._inputListeners[s]===t)return!0;return!1}interruptInput(){const t=this.inputListeners;for(let s=0;s<t.length;s++){const r=t[s];r.interrupt&&r.interrupt()}return this}interruptSubtreeInput(){this.interruptInput();const t=this._children.slice();for(let s=0;s<t.length;s++)t[s].interruptSubtreeInput();return this}translate(t,s,r){if(typeof t=="number"){if(assert&&assert(isFinite(t),"x should be a finite number"),assert&&assert(typeof s=="number"&&isFinite(s),"y should be a finite number"),Math.abs(t)<1e-12&&Math.abs(s)<1e-12)return;r?this.prependTranslation(t,s):this.appendMatrix(scratchMatrix3.setToTranslation(t,s))}else{const o=t;if(assert&&assert(o.isFinite(),"translation should be a finite Vector2 if not finite numbers"),!o.x&&!o.y)return;this.translate(o.x,o.y,s)}}scale(t,s,r){if(typeof t=="number")if(assert&&assert(isFinite(t),"scales should be finite"),s===void 0||typeof s=="boolean")this.scale(t,t,s);else{if(assert&&assert(isFinite(s),"scales should be finite numbers"),assert&&assert(r===void 0||typeof r=="boolean","If provided, prependInstead should be boolean"),t===1&&s===1)return;r?this.prependMatrix(Matrix3.scaling(t,s)):this.appendMatrix(Matrix3.scaling(t,s))}else{const o=t;assert&&assert(o.isFinite(),"scale should be a finite Vector2 if not a finite number"),this.scale(o.x,o.y,s)}}rotate(t,s){assert&&assert(isFinite(t),"angle should be a finite number"),assert&&assert(s===void 0||typeof s=="boolean"),t%(2*Math.PI)!==0&&(s?this.prependMatrix(Matrix3.rotation2(t)):this.appendMatrix(Matrix3.rotation2(t)))}rotateAround(t,s){assert&&assert(t.isFinite(),"point should be a finite Vector2"),assert&&assert(isFinite(s),"angle should be a finite number");let r=Matrix3.translation(-t.x,-t.y);return r=Matrix3.rotation2(s).timesMatrix(r),r=Matrix3.translation(t.x,t.y).timesMatrix(r),this.prependMatrix(r),this}setX(t){return assert&&assert(isFinite(t),"x should be a finite number"),this.translate(t-this.getX(),0,!0),this}set x(t){this.setX(t)}get x(){return this.getX()}getX(){return this._transform.getMatrix().m02()}setY(t){return assert&&assert(isFinite(t),"y should be a finite number"),this.translate(0,t-this.getY(),!0),this}set y(t){this.setY(t)}get y(){return this.getY()}getY(){return this._transform.getMatrix().m12()}setScaleMagnitude(t,s){const r=this.getScaleVector();return typeof t=="number"?(s===void 0&&(s=t),assert&&assert(isFinite(t),"setScaleMagnitude parameters should be finite numbers"),assert&&assert(isFinite(s),"setScaleMagnitude parameters should be finite numbers"),this.appendMatrix(Matrix3.scaling(t/r.x,s/r.y))):(assert&&assert(t.isFinite(),"first parameter should be a finite Vector2"),this.appendMatrix(Matrix3.scaling(t.x/r.x,t.y/r.y))),this}getScaleVector(){return this._transform.getMatrix().getScaleVector()}setRotation(t){return assert&&assert(isFinite(t),"rotation should be a finite number"),this.appendMatrix(scratchMatrix3.setToRotationZ(t-this.getRotation())),this}set rotation(t){this.setRotation(t)}get rotation(){return this.getRotation()}getRotation(){return this._transform.getMatrix().getRotation()}setTranslation(t,s){const r=this._transform.getMatrix(),o=r.m02(),n=r.m12();let l,h;return typeof t=="number"?(assert&&assert(isFinite(t),"Parameters to setTranslation should be finite numbers"),assert&&assert(s!==void 0&&isFinite(s),"Parameters to setTranslation should be finite numbers"),l=t-o,h=s-n):(assert&&assert(t.isFinite(),"Should be a finite Vector2"),l=t.x-o,h=t.y-n),this.translate(l,h,!0),this}set translation(t){this.setTranslation(t)}get translation(){return this.getTranslation()}getTranslation(){const t=this._transform.getMatrix();return new Vector2(t.m02(),t.m12())}appendMatrix(t){assert&&assert(t.isFinite(),"matrix should be a finite Matrix3"),assert&&assert(t.getDeterminant()!==0,"matrix should not map plane to a line or point"),this._transform.append(t)}prependMatrix(t){assert&&assert(t.isFinite(),"matrix should be a finite Matrix3"),assert&&assert(t.getDeterminant()!==0,"matrix should not map plane to a line or point"),this._transform.prepend(t)}prependTranslation(t,s){assert&&assert(isFinite(t),"x should be a finite number"),assert&&assert(isFinite(s),"y should be a finite number"),!(!t&&!s)&&this._transform.prependTranslation(t,s)}setMatrix(t){assert&&assert(t.isFinite(),"matrix should be a finite Matrix3"),assert&&assert(t.getDeterminant()!==0,"matrix should not map plane to a line or point"),this._transform.setMatrix(t)}set matrix(t){this.setMatrix(t)}get matrix(){return this.getMatrix()}getMatrix(){return this._transform.getMatrix()}getTransform(){return this._transform}get transform(){return this.getTransform()}resetTransform(){this.setMatrix(Matrix3.IDENTITY)}onTransformChange(){this.invalidateBounds(),this._picker.onTransformChange(),assertSlow&&this._picker.audit(),this.transformEmitter.emit()}onSummaryChange(t,s){this._pdomDisplaysInfo.onSummaryChange(t,s)}updateMaxDimension(t){assert&&this.auditMaxDimensions();const s=this._appliedScaleFactor;let r=1;if(this._maxWidth!==null){const n=t.width;n>this._maxWidth&&(r=Math.min(r,this._maxWidth/n))}if(this._maxHeight!==null){const n=t.height;n>this._maxHeight&&(r=Math.min(r,this._maxHeight/n))}const o=r/s;o!==1&&(this._appliedScaleFactor=r,this.scale(o))}auditMaxDimensions(){assert&&assert(this._maxWidth===null||!isWidthSizable(this)||this.preferredWidth===null||this._maxWidth>=this.preferredWidth-1e-7,"If maxWidth and preferredWidth are both non-null, maxWidth should NOT be smaller than the preferredWidth. If that happens, it would trigger an infinite loop"),assert&&assert(this._maxHeight===null||!isHeightSizable(this)||this.preferredHeight===null||this._maxHeight>=this.preferredHeight-1e-7,"If maxHeight and preferredHeight are both non-null, maxHeight should NOT be smaller than the preferredHeight. If that happens, it would trigger an infinite loop")}onMaxDimensionChange(t,s){t===null&&s!==null?(this.changeBoundsEventCount(1),this._boundsEventSelfCount++):t!==null&&s===null&&(this.changeBoundsEventCount(-1),this._boundsEventSelfCount--)}setMaxWidth(t){assert&&assert(t===null||typeof t=="number"&&t>0,"maxWidth should be null (no constraint) or a positive number"),this._maxWidth!==t&&(this.onMaxDimensionChange(this._maxWidth,t),this._maxWidth=t,this.updateMaxDimension(this.localBoundsProperty.value))}set maxWidth(t){this.setMaxWidth(t)}get maxWidth(){return this.getMaxWidth()}getMaxWidth(){return this._maxWidth}setMaxHeight(t){assert&&assert(t===null||typeof t=="number"&&t>0,"maxHeight should be null (no constraint) or a positive number"),this._maxHeight!==t&&(this.onMaxDimensionChange(this._maxHeight,t),this._maxHeight=t,this.updateMaxDimension(this.localBoundsProperty.value))}set maxHeight(t){this.setMaxHeight(t)}get maxHeight(){return this.getMaxHeight()}getMaxHeight(){return this._maxHeight}setLeft(t){const s=this.getLeft();return isFinite(s)&&this.translate(t-s,0,!0),this}set left(t){this.setLeft(t)}get left(){return this.getLeft()}getLeft(){return this.getBounds().minX}setRight(t){const s=this.getRight();return isFinite(s)&&this.translate(t-s,0,!0),this}set right(t){this.setRight(t)}get right(){return this.getRight()}getRight(){return this.getBounds().maxX}setCenterX(t){const s=this.getCenterX();return isFinite(s)&&this.translate(t-s,0,!0),this}set centerX(t){this.setCenterX(t)}get centerX(){return this.getCenterX()}getCenterX(){return this.getBounds().getCenterX()}setCenterY(t){const s=this.getCenterY();return isFinite(s)&&this.translate(0,t-s,!0),this}set centerY(t){this.setCenterY(t)}get centerY(){return this.getCenterY()}getCenterY(){return this.getBounds().getCenterY()}setTop(t){const s=this.getTop();return isFinite(s)&&this.translate(0,t-s,!0),this}set top(t){this.setTop(t)}get top(){return this.getTop()}getTop(){return this.getBounds().minY}setBottom(t){const s=this.getBottom();return isFinite(s)&&this.translate(0,t-s,!0),this}set bottom(t){this.setBottom(t)}get bottom(){return this.getBottom()}getBottom(){return this.getBounds().maxY}setLeftTop(t){assert&&assert(t.isFinite(),"leftTop should be a finite Vector2");const s=this.getLeftTop();return s.isFinite()&&this.translate(t.minus(s),!0),this}set leftTop(t){this.setLeftTop(t)}get leftTop(){return this.getLeftTop()}getLeftTop(){return this.getBounds().getLeftTop()}setCenterTop(t){assert&&assert(t.isFinite(),"centerTop should be a finite Vector2");const s=this.getCenterTop();return s.isFinite()&&this.translate(t.minus(s),!0),this}set centerTop(t){this.setCenterTop(t)}get centerTop(){return this.getCenterTop()}getCenterTop(){return this.getBounds().getCenterTop()}setRightTop(t){assert&&assert(t.isFinite(),"rightTop should be a finite Vector2");const s=this.getRightTop();return s.isFinite()&&this.translate(t.minus(s),!0),this}set rightTop(t){this.setRightTop(t)}get rightTop(){return this.getRightTop()}getRightTop(){return this.getBounds().getRightTop()}setLeftCenter(t){assert&&assert(t.isFinite(),"leftCenter should be a finite Vector2");const s=this.getLeftCenter();return s.isFinite()&&this.translate(t.minus(s),!0),this}set leftCenter(t){this.setLeftCenter(t)}get leftCenter(){return this.getLeftCenter()}getLeftCenter(){return this.getBounds().getLeftCenter()}setCenter(t){assert&&assert(t.isFinite(),"center should be a finite Vector2");const s=this.getCenter();return s.isFinite()&&this.translate(t.minus(s),!0),this}set center(t){this.setCenter(t)}get center(){return this.getCenter()}getCenter(){return this.getBounds().getCenter()}setRightCenter(t){assert&&assert(t.isFinite(),"rightCenter should be a finite Vector2");const s=this.getRightCenter();return s.isFinite()&&this.translate(t.minus(s),!0),this}set rightCenter(t){this.setRightCenter(t)}get rightCenter(){return this.getRightCenter()}getRightCenter(){return this.getBounds().getRightCenter()}setLeftBottom(t){assert&&assert(t.isFinite(),"leftBottom should be a finite Vector2");const s=this.getLeftBottom();return s.isFinite()&&this.translate(t.minus(s),!0),this}set leftBottom(t){this.setLeftBottom(t)}get leftBottom(){return this.getLeftBottom()}getLeftBottom(){return this.getBounds().getLeftBottom()}setCenterBottom(t){assert&&assert(t.isFinite(),"centerBottom should be a finite Vector2");const s=this.getCenterBottom();return s.isFinite()&&this.translate(t.minus(s),!0),this}set centerBottom(t){this.setCenterBottom(t)}get centerBottom(){return this.getCenterBottom()}getCenterBottom(){return this.getBounds().getCenterBottom()}setRightBottom(t){assert&&assert(t.isFinite(),"rightBottom should be a finite Vector2");const s=this.getRightBottom();return s.isFinite()&&this.translate(t.minus(s),!0),this}set rightBottom(t){this.setRightBottom(t)}get rightBottom(){return this.getRightBottom()}getRightBottom(){return this.getBounds().getRightBottom()}getWidth(){return this.getBounds().getWidth()}get width(){return this.getWidth()}getHeight(){return this.getBounds().getHeight()}get height(){return this.getHeight()}getLocalWidth(){return this.getLocalBounds().getWidth()}get localWidth(){return this.getLocalWidth()}getLocalHeight(){return this.getLocalBounds().getHeight()}get localHeight(){return this.getLocalHeight()}getLocalLeft(){return this.getLocalBounds().minX}get localLeft(){return this.getLocalLeft()}getLocalRight(){return this.getLocalBounds().maxX}get localRight(){return this.getLocalRight()}getLocalCenterX(){return this.getLocalBounds().getCenterX()}get localCenterX(){return this.getLocalCenterX()}getLocalCenterY(){return this.getLocalBounds().getCenterY()}get localCenterY(){return this.getLocalCenterY()}getLocalTop(){return this.getLocalBounds().minY}get localTop(){return this.getLocalTop()}getLocalBottom(){return this.getLocalBounds().maxY}get localBottom(){return this.getLocalBottom()}getLocalLeftTop(){return this.getLocalBounds().getLeftTop()}get localLeftTop(){return this.getLocalLeftTop()}getLocalCenterTop(){return this.getLocalBounds().getCenterTop()}get localCenterTop(){return this.getLocalCenterTop()}getLocalRightTop(){return this.getLocalBounds().getRightTop()}get localRightTop(){return this.getLocalRightTop()}getLocalLeftCenter(){return this.getLocalBounds().getLeftCenter()}get localLeftCenter(){return this.getLocalLeftCenter()}getLocalCenter(){return this.getLocalBounds().getCenter()}get localCenter(){return this.getLocalCenter()}getLocalRightCenter(){return this.getLocalBounds().getRightCenter()}get localRightCenter(){return this.getLocalRightCenter()}getLocalLeftBottom(){return this.getLocalBounds().getLeftBottom()}get localLeftBottom(){return this.getLocalLeftBottom()}getLocalCenterBottom(){return this.getLocalBounds().getCenterBottom()}get localCenterBottom(){return this.getLocalCenterBottom()}getLocalRightBottom(){return this.getLocalBounds().getRightBottom()}get localRightBottom(){return this.getLocalRightBottom()}getId(){return this._id}get id(){return this.getId()}onVisiblePropertyChange(t){this._picker.onVisibilityChange(),assertSlow&&this._picker.audit(),this._pdomDisplaysInfo.onVisibilityChange(t);for(let s=0;s<this._parents.length;s++){const r=this._parents[s];r._excludeInvisibleChildrenFromBounds&&r.invalidateChildBounds()}}setVisibleProperty(t){return this._visibleProperty.setTargetProperty(t,this,VISIBLE_PROPERTY_TANDEM_NAME)}set visibleProperty(t){this.setVisibleProperty(t)}get visibleProperty(){return this.getVisibleProperty()}getVisibleProperty(){return this._visibleProperty}setVisible(t){return this.visibleProperty.set(t),this}set visible(t){this.setVisible(t)}get visible(){return this.isVisible()}isVisible(){return this.visibleProperty.value}setPhetioVisiblePropertyInstrumented(t){return this._visibleProperty.setTargetPropertyInstrumented(t,this)}set phetioVisiblePropertyInstrumented(t){this.setPhetioVisiblePropertyInstrumented(t)}get phetioVisiblePropertyInstrumented(){return this.getPhetioVisiblePropertyInstrumented()}getPhetioVisiblePropertyInstrumented(){return this._visibleProperty.getTargetPropertyInstrumented()}swapVisibility(t){assert&&assert(this.visible!==t.visible);const s=this.visible?this:t,r=this.visible?t:this,o=s.focused;return s.visible=!1,r.visible=!0,o&&r.focusable&&r.focus(),this}setOpacity(t){if(assert&&assert(isFinite(t),"opacity should be a finite number"),t<0||t>1)throw new Error(`opacity out of range: ${t}`);this.opacityProperty.value=t}set opacity(t){this.setOpacity(t)}get opacity(){return this.getOpacity()}getOpacity(){return this.opacityProperty.value}setDisabledOpacity(t){if(assert&&assert(isFinite(t),"disabledOpacity should be a finite number"),t<0||t>1)throw new Error(`disabledOpacity out of range: ${t}`);return this.disabledOpacityProperty.value=t,this}set disabledOpacity(t){this.setDisabledOpacity(t)}get disabledOpacity(){return this.getDisabledOpacity()}getDisabledOpacity(){return this.disabledOpacityProperty.value}getEffectiveOpacity(){return this.opacityProperty.value*(this.enabledProperty.value?1:this.disabledOpacityProperty.value)}get effectiveOpacity(){return this.getEffectiveOpacity()}onOpacityPropertyChange(){this.filterChangeEmitter.emit()}onDisabledOpacityPropertyChange(){this._enabledProperty.value||this.filterChangeEmitter.emit()}setFilters(t){assert&&assert(Array.isArray(t),"filters should be an array"),assert&&assert(_.every(t,s=>s instanceof Filter),"filters should consist of Filter objects only"),this._filters.length=0,this._filters.push(...t),this.invalidateHint(),this.filterChangeEmitter.emit()}set filters(t){this.setFilters(t)}get filters(){return this.getFilters()}getFilters(){return this._filters.slice()}setPickableProperty(t){return this._pickableProperty.setTargetProperty(t,this,null)}set pickableProperty(t){this.setPickableProperty(t)}get pickableProperty(){return this.getPickableProperty()}getPickableProperty(){return this._pickableProperty}setPickable(t){return assert&&assert(t===null||typeof t=="boolean"),this._pickableProperty.set(t),this}set pickable(t){this.setPickable(t)}get pickable(){return this.isPickable()}isPickable(){return this._pickableProperty.value}onPickablePropertyChange(t,s){this._picker.onPickableChange(s,t),assertSlow&&this._picker.audit()}setEnabledProperty(t){return this._enabledProperty.setTargetProperty(t,this,ENABLED_PROPERTY_TANDEM_NAME)}set enabledProperty(t){this.setEnabledProperty(t)}get enabledProperty(){return this.getEnabledProperty()}getEnabledProperty(){return this._enabledProperty}setPhetioEnabledPropertyInstrumented(t){return this._enabledProperty.setTargetPropertyInstrumented(t,this)}set phetioEnabledPropertyInstrumented(t){this.setPhetioEnabledPropertyInstrumented(t)}get phetioEnabledPropertyInstrumented(){return this.getPhetioEnabledPropertyInstrumented()}getPhetioEnabledPropertyInstrumented(){return this._enabledProperty.getTargetPropertyInstrumented()}setEnabled(t){return assert&&assert(t===null||typeof t=="boolean"),this._enabledProperty.set(t),this}set enabled(t){this.setEnabled(t)}get enabled(){return this.isEnabled()}isEnabled(){return this._enabledProperty.value}onEnabledPropertyChange(t){!t&&this.interruptSubtreeInput(),this.inputEnabled=t,this.disabledOpacityProperty.value!==1&&this.filterChangeEmitter.emit()}setInputEnabledProperty(t){return this._inputEnabledProperty.setTargetProperty(t,this,INPUT_ENABLED_PROPERTY_TANDEM_NAME)}set inputEnabledProperty(t){this.setInputEnabledProperty(t)}get inputEnabledProperty(){return this.getInputEnabledProperty()}getInputEnabledProperty(){return this._inputEnabledProperty}setPhetioInputEnabledPropertyInstrumented(t){return this._inputEnabledProperty.setTargetPropertyInstrumented(t,this)}set phetioInputEnabledPropertyInstrumented(t){this.setPhetioInputEnabledPropertyInstrumented(t)}get phetioInputEnabledPropertyInstrumented(){return this.getPhetioInputEnabledPropertyInstrumented()}getPhetioInputEnabledPropertyInstrumented(){return this._inputEnabledProperty.getTargetPropertyInstrumented()}setInputEnabled(t){this.inputEnabledProperty.value=t}set inputEnabled(t){this.setInputEnabled(t)}get inputEnabled(){return this.isInputEnabled()}isInputEnabled(){return this.inputEnabledProperty.value}setInputListeners(t){for(assert&&assert(Array.isArray(t));this._inputListeners.length;)this.removeInputListener(this._inputListeners[0]);for(let s=0;s<t.length;s++)this.addInputListener(t[s]);return this}set inputListeners(t){this.setInputListeners(t)}get inputListeners(){return this.getInputListeners()}getInputListeners(){return this._inputListeners.slice(0)}setCursor(t){this._cursor=t==="auto"?null:t}set cursor(t){this.setCursor(t)}get cursor(){return this.getCursor()}getCursor(){return this._cursor}getEffectiveCursor(){if(this._cursor)return this._cursor;for(let t=0;t<this._inputListeners.length;t++){const s=this._inputListeners[t];if(s.cursor)return s.cursor}return null}setMouseArea(t){return assert&&assert(t===null||t instanceof Shape$1||t instanceof Bounds2,"mouseArea needs to be a phet.kite.Shape, phet.dot.Bounds2, or null"),this._mouseArea!==t&&(this._mouseArea=t,this._picker.onMouseAreaChange(),assertSlow&&this._picker.audit()),this}set mouseArea(t){this.setMouseArea(t)}get mouseArea(){return this.getMouseArea()}getMouseArea(){return this._mouseArea}setTouchArea(t){return assert&&assert(t===null||t instanceof Shape$1||t instanceof Bounds2,"touchArea needs to be a phet.kite.Shape, phet.dot.Bounds2, or null"),this._touchArea!==t&&(this._touchArea=t,this._picker.onTouchAreaChange(),assertSlow&&this._picker.audit()),this}set touchArea(t){this.setTouchArea(t)}get touchArea(){return this.getTouchArea()}getTouchArea(){return this._touchArea}setClipArea(t){assert&&assert(t===null||t instanceof Shape$1,"clipArea needs to be a phet.kite.Shape, or null"),this.clipArea!==t&&(this.clipAreaProperty.value=t,this.invalidateBounds(),this._picker.onClipAreaChange(),assertSlow&&this._picker.audit())}set clipArea(t){this.setClipArea(t)}get clipArea(){return this.getClipArea()}getClipArea(){return this.clipAreaProperty.value}hasClipArea(){return this.clipArea!==null}setRendererBitmask(t){assert&&assert(isFinite(t)),t!==this._rendererBitmask&&(this._rendererBitmask=t,this._rendererSummary.selfChange(),this.instanceRefreshEmitter.emit())}invalidateSupportedRenderers(){}invalidateHint(){this.rendererSummaryRefreshEmitter.emit(),this.instanceRefreshEmitter.emit()}setRenderer(t){assert&&assert(t===null||t==="canvas"||t==="svg"||t==="dom"||t==="webgl",'Renderer input should be null, or one of: "canvas", "svg", "dom" or "webgl".');let s=0;t==="canvas"?s=Renderer.bitmaskCanvas:t==="svg"?s=Renderer.bitmaskSVG:t==="dom"?s=Renderer.bitmaskDOM:t==="webgl"&&(s=Renderer.bitmaskWebGL),assert&&assert(t===null==(s===0),"We should only end up with no actual renderer if renderer is null"),this._renderer!==s&&(this._renderer=s,this.invalidateHint())}set renderer(t){this.setRenderer(t)}get renderer(){return this.getRenderer()}getRenderer(){return this._renderer===0?null:this._renderer===Renderer.bitmaskCanvas?"canvas":this._renderer===Renderer.bitmaskSVG?"svg":this._renderer===Renderer.bitmaskDOM?"dom":this._renderer===Renderer.bitmaskWebGL?"webgl":(assert&&assert(!1,"Seems to be an invalid renderer?"),null)}setLayerSplit(t){t!==this._layerSplit&&(this._layerSplit=t,this.invalidateHint())}set layerSplit(t){this.setLayerSplit(t)}get layerSplit(){return this.isLayerSplit()}isLayerSplit(){return this._layerSplit}setUsesOpacity(t){t!==this._usesOpacity&&(this._usesOpacity=t,this.invalidateHint())}set usesOpacity(t){this.setUsesOpacity(t)}get usesOpacity(){return this.getUsesOpacity()}getUsesOpacity(){return this._usesOpacity}setCSSTransform(t){t!==this._cssTransform&&(this._cssTransform=t,this.invalidateHint())}set cssTransform(t){this.setCSSTransform(t)}get cssTransform(){return this.isCSSTransformed()}isCSSTransformed(){return this._cssTransform}setExcludeInvisible(t){t!==this._excludeInvisible&&(this._excludeInvisible=t,this.invalidateHint())}set excludeInvisible(t){this.setExcludeInvisible(t)}get excludeInvisible(){return this.isExcludeInvisible()}isExcludeInvisible(){return this._excludeInvisible}setExcludeInvisibleChildrenFromBounds(t){t!==this._excludeInvisibleChildrenFromBounds&&(this._excludeInvisibleChildrenFromBounds=t,this.invalidateBounds())}set excludeInvisibleChildrenFromBounds(t){this.setExcludeInvisibleChildrenFromBounds(t)}get excludeInvisibleChildrenFromBounds(){return this.isExcludeInvisibleChildrenFromBounds()}isExcludeInvisibleChildrenFromBounds(){return this._excludeInvisibleChildrenFromBounds}setLayoutOptions(t){assert&&assert(t===null||typeof t=="object"&&Object.getPrototypeOf(t)===Object.prototype,"layoutOptions should be null or an plain options-style object"),t!==this._layoutOptions&&(this._layoutOptions=t,this.layoutOptionsChangedEmitter.emit())}set layoutOptions(t){this.setLayoutOptions(t)}get layoutOptions(){return this.getLayoutOptions()}getLayoutOptions(){return this._layoutOptions}mutateLayoutOptions(t){this.layoutOptions=optionize3()({},this.layoutOptions||{},t)}get widthSizable(){return!1}get heightSizable(){return!1}get extendsWidthSizable(){return!1}get extendsHeightSizable(){return!1}get extendsSizable(){return!1}setPreventFit(t){t!==this._preventFit&&(this._preventFit=t,this.invalidateHint())}set preventFit(t){this.setPreventFit(t)}get preventFit(){return this.isPreventFit()}isPreventFit(){return this._preventFit}setWebGLScale(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)),t!==this._webglScale&&(this._webglScale=t,this.invalidateHint())}set webglScale(t){this.setWebGLScale(t)}get webglScale(){return this.getWebGLScale()}getWebGLScale(){return this._webglScale}getUniqueTrail(t){if(t){const s=this.getTrails(t);return assert&&assert(s.length===1,`getUniqueTrail found ${s.length} matching trails for the predicate`),s[0]}else{const s=new Trail;let r=this;for(;r;)assert&&assert(r._parents.length<=1,`getUniqueTrail found a Node with ${r._parents.length} parents.`),s.addAncestor(r),r=r._parents[0];return s}}getUniqueTrailTo(t){return this.getUniqueTrail(s=>t===s)}getTrails(t){t=t||Vn.defaultTrailPredicate;const s=[],r=new Trail(this);return Trail.appendAncestorTrailsWithPredicate(s,r,t),s}getTrailsTo(t){return this.getTrails(s=>s===t)}getLeafTrails(t){t=t||Vn.defaultLeafTrailPredicate;const s=[],r=new Trail(this);return Trail.appendDescendantTrailsWithPredicate(s,r,t),s}getLeafTrailsTo(t){return this.getLeafTrails(s=>s===t)}getUniqueLeafTrail(t){const s=this.getLeafTrails(t);return assert&&assert(s.length===1,`getUniqueLeafTrail found ${s.length} matching trails for the predicate`),s[0]}getUniqueLeafTrailTo(t){return this.getUniqueLeafTrail(s=>s===t)}getConnectedNodes(){const t=[];let s=this._children.concat(this._parents).concat(this);for(;s.length;){const r=s.pop();_.includes(t,r)||(t.push(r),s=s.concat(r._children,r._parents))}return t}getSubtreeNodes(){const t=[];let s=this._children.concat(this);for(;s.length;){const r=s.pop();_.includes(t,r)||(t.push(r),s=s.concat(r._children))}return t}getTopologicallySortedNodes(){const t={},s=[],r=[];let o;_.each(this.getConnectedNodes(),l=>{t[l.id]={},_.each(l._children,h=>{t[l.id][h.id]=!0}),l.parents.length||s.push(l)});function n(l){delete t[o.id][l.id],_.every(t,h=>!h[l.id])&&s.push(l)}for(;s.length;)o=s.pop(),r.push(o),_.each(o._children,n);return assert&&assert(_.every(t,l=>_.every(l,h=>!1)),"circular reference check"),r}canAddChild(t){if(this===t||_.includes(this._children,t))return!1;const s={},r=[];let o;_.each(this.getConnectedNodes().concat(t.getConnectedNodes()),l=>{s[l.id]={},_.each(l._children,h=>{s[l.id][h.id]=!0}),!l.parents.length&&l!==t&&r.push(l)}),s[this.id][t.id]=!0;function n(l){delete s[o.id][l.id],_.every(s,h=>!h[l.id])&&r.push(l)}for(;r.length;)o=r.pop(),_.each(o._children,n),o===this&&n(t);return _.every(s,l=>_.every(l,h=>!1))}canvasPaintSelf(t,s){}renderToCanvasSelf(t,s){this.isPainted()&&this._rendererBitmask&Renderer.bitmaskCanvas&&this.canvasPaintSelf(t,s)}renderToCanvasSubtree(t,s){s=s||Matrix3.identity(),t.resetStyles(),this.renderToCanvasSelf(t,s);for(let r=0;r<this._children.length;r++){const o=this._children[r];if(o.isVisible()&&o.bounds.isValid()){const n=o.effectiveOpacity!==1||o.clipArea||o._filters.length;if(t.context.save(),s.multiplyMatrix(o._transform.getMatrix()),s.canvasSetTransform(t.context),n){const l=o.localBounds.transformed(s).dilate(4).roundOut().constrainBounds(scratchBounds2Extra.setMinMax(0,0,t.canvas.width,t.canvas.height));if(l.width>0&&l.height>0){const h=document.createElement("canvas");h.width=l.width,h.height=l.height;const g=h.getContext("2d"),d=new CanvasContextWrapper(h,g),A=s.copy().prependTranslation(-l.minX,-l.minY);A.canvasSetTransform(g),o.renderToCanvasSubtree(d,A),t.context.save(),o.clipArea&&(t.context.beginPath(),o.clipArea.writeToContext(t.context),t.context.clip()),t.context.setTransform(1,0,0,1,0,0),t.context.globalAlpha=o.effectiveOpacity;let S=!1;o._filters.length&&(Features.canvasFilter&&_.every(o._filters,O=>O.isDOMCompatible())?(t.context.filter=o._filters.map(O=>O.getCSSFilterString()).join(" "),S=!0):o._filters.forEach(O=>O.applyCanvasFilter(d))),t.context.drawImage(h,l.minX,l.minY),t.context.restore(),S&&(t.context.filter="none")}}else o.renderToCanvasSubtree(t,s);s.multiplyMatrix(o._transform.getInverse()),t.context.restore()}}}renderToCanvas(t,s,r,o){assert&&deprecationWarning("Node.renderToCanvas() is deprecated, please use Node.rasterized() instead"),t.width=t.width,o&&(s.fillStyle=o,s.fillRect(0,0,t.width,t.height));const n=new CanvasContextWrapper(t,s);this.renderToCanvasSubtree(n,Matrix3.identity()),r&&r()}toCanvas(t,s,r,o,n){assert&&assert(s===void 0||typeof s=="number","If provided, x should be a number"),assert&&assert(r===void 0||typeof r=="number","If provided, y should be a number"),assert&&assert(o===void 0||typeof o=="number"&&o>=0&&o%1===0,"If provided, width should be a non-negative integer"),assert&&assert(n===void 0||typeof n=="number"&&n>=0&&n%1===0,"If provided, height should be a non-negative integer");const l=2,h=this.getBounds().union(this.localToParentBounds(this.getSafeSelfBounds()));assert&&assert(!h.isEmpty()||s!==void 0&&r!==void 0&&o!==void 0&&n!==void 0,"Should not call toCanvas on a Node with empty bounds, unless all dimensions are provided"),s=s!==void 0?s:Math.ceil(l-h.minX),r=r!==void 0?r:Math.ceil(l-h.minY),o=o!==void 0?o:Math.ceil(h.getWidth()+2*l),n=n!==void 0?n:Math.ceil(h.getHeight()+2*l);const g=document.createElement("canvas");g.width=o,g.height=n;const d=g.getContext("2d");d.translate(s,r),this._transform.getMatrix().canvasAppendTransform(d);const A=new CanvasContextWrapper(g,d);this.renderToCanvasSubtree(A,Matrix3.translation(s,r).timesMatrix(this._transform.getMatrix())),t(g,s,r,o,n)}toDataURL(t,s,r,o,n){assert&&assert(s===void 0||typeof s=="number","If provided, x should be a number"),assert&&assert(r===void 0||typeof r=="number","If provided, y should be a number"),assert&&assert(o===void 0||typeof o=="number"&&o>=0&&o%1===0,"If provided, width should be a non-negative integer"),assert&&assert(n===void 0||typeof n=="number"&&n>=0&&n%1===0,"If provided, height should be a non-negative integer"),this.toCanvas((l,h,g,d,A)=>{t(l.toDataURL(),h,g,d,A)},s,r,o,n)}toImage(t,s,r,o,n){assert&&deprecationWarning("Node.toImage() is deprecated, please use Node.rasterized() instead"),assert&&assert(s===void 0||typeof s=="number","If provided, x should be a number"),assert&&assert(r===void 0||typeof r=="number","If provided, y should be a number"),assert&&assert(o===void 0||typeof o=="number"&&o>=0&&o%1===0,"If provided, width should be a non-negative integer"),assert&&assert(n===void 0||typeof n=="number"&&n>=0&&n%1===0,"If provided, height should be a non-negative integer"),this.toDataURL((l,h,g)=>{const d=document.createElement("img");d.onload=()=>{t(d,h,g);try{delete d.onload}catch{}},d.src=l},s,r,o,n)}toImageNodeAsynchronous(t,s,r,o,n){assert&&deprecationWarning("Node.toImageNodeAsyncrhonous() is deprecated, please use Node.rasterized() instead"),assert&&assert(s===void 0||typeof s=="number","If provided, x should be a number"),assert&&assert(r===void 0||typeof r=="number","If provided, y should be a number"),assert&&assert(o===void 0||typeof o=="number"&&o>=0&&o%1===0,"If provided, width should be a non-negative integer"),assert&&assert(n===void 0||typeof n=="number"&&n>=0&&n%1===0,"If provided, height should be a non-negative integer"),this.toImage((l,h,g)=>{t(new Vn({children:[new Image$1(l,{x:-h,y:-g})]}))},s,r,o,n)}toCanvasNodeSynchronous(t,s,r,o){assert&&deprecationWarning("Node.toCanvasNodeSynchronous() is deprecated, please use Node.rasterized() instead"),assert&&assert(t===void 0||typeof t=="number","If provided, x should be a number"),assert&&assert(s===void 0||typeof s=="number","If provided, y should be a number"),assert&&assert(r===void 0||typeof r=="number"&&r>=0&&r%1===0,"If provided, width should be a non-negative integer"),assert&&assert(o===void 0||typeof o=="number"&&o>=0&&o%1===0,"If provided, height should be a non-negative integer");let n=null;return this.toCanvas((l,h,g)=>{n=new Vn({children:[new Image$1(l,{x:-h,y:-g})]})},t,s,r,o),assert&&assert(n,"toCanvasNodeSynchronous requires that the node can be rendered only using Canvas"),n}toDataURLImageSynchronous(t,s,r,o){assert&&deprecationWarning("Node.toDataURLImageSychronous() is deprecated, please use Node.rasterized() instead"),assert&&assert(t===void 0||typeof t=="number","If provided, x should be a number"),assert&&assert(s===void 0||typeof s=="number","If provided, y should be a number"),assert&&assert(r===void 0||typeof r=="number"&&r>=0&&r%1===0,"If provided, width should be a non-negative integer"),assert&&assert(o===void 0||typeof o=="number"&&o>=0&&o%1===0,"If provided, height should be a non-negative integer");let n=null;return this.toDataURL((l,h,g,d,A)=>{n=new Image$1(l,{x:-h,y:-g,initialWidth:d,initialHeight:A})},t,s,r,o),assert&&assert(n,"toDataURL failed to return a result synchronously"),n}toDataURLNodeSynchronous(t,s,r,o){return assert&&deprecationWarning("Node.toDataURLNodeSynchronous() is deprecated, please use Node.rasterized() instead"),assert&&assert(t===void 0||typeof t=="number","If provided, x should be a number"),assert&&assert(s===void 0||typeof s=="number","If provided, y should be a number"),assert&&assert(r===void 0||typeof r=="number"&&r>=0&&r%1===0,"If provided, width should be a non-negative integer"),assert&&assert(o===void 0||typeof o=="number"&&o>=0&&o%1===0,"If provided, height should be a non-negative integer"),new Vn({children:[this.toDataURLImageSynchronous(t,s,r,o)]})}rasterized(t){const s=optionize()({resolution:1,sourceBounds:null,useTargetBounds:!0,wrap:!0,useCanvas:!1,imageOptions:{}},t),r=s.resolution,o=s.sourceBounds;assert&&(assert(typeof r=="number"&&r>0,"resolution should be a positive number"),assert(o===null||o instanceof Bounds2,"sourceBounds should be null or a Bounds2"),o&&(assert(o.isValid(),"sourceBounds should be valid (finite non-negative)"),assert(Number.isInteger(o.width),"sourceBounds.width should be an integer"),assert(Number.isInteger(o.height),"sourceBounds.height should be an integer")));const n=new Vn({scale:r,children:[this]});let l=o||this.getSafeTransformedVisibleBounds().dilated(2).roundedOut();r!==1&&(l=new Bounds2(r*l.minX,r*l.minY,r*l.maxX,r*l.maxY),l.width%1!==0&&(l.maxX+=1-l.width%1),l.height%1!==0&&(l.maxY+=1-l.height%1));let h=null;function g(A,S,O,I,W){const L=s.useCanvas?A:A.toDataURL();h=new Image$1(L,combineOptions({},s.imageOptions,{x:-S,y:-O,initialWidth:I,initialHeight:W})),h.scale(1/r,1/r,!0)}n.toCanvas(g,-l.minX,-l.minY,DotUtils.roundSymmetric(l.width),DotUtils.roundSymmetric(l.height)),assert&&assert(h,"The toCanvas should have executed synchronously"),n.dispose();let d=this.getVisibleBounds();if(o&&(d=o.intersection(d)),s.useTargetBounds&&(h.imageBounds=h.parentToLocalBounds(d)),s.wrap){const A=new Vn({children:[h]});return s.useTargetBounds&&(A.localBounds=d),A}else return s.useTargetBounds&&(h.localBounds=h.parentToLocalBounds(d)),h}createDOMDrawable(t,s){throw new Error("createDOMDrawable is abstract. The subtype should either override this method, or not support the DOM renderer")}createSVGDrawable(t,s){throw new Error("createSVGDrawable is abstract. The subtype should either override this method, or not support the DOM renderer")}createCanvasDrawable(t,s){throw new Error("createCanvasDrawable is abstract. The subtype should either override this method, or not support the DOM renderer")}createWebGLDrawable(t,s){throw new Error("createWebGLDrawable is abstract. The subtype should either override this method, or not support the DOM renderer")}getInstances(){return this._instances}get instances(){return this.getInstances()}addInstance(t){this._instances.push(t),this.changedInstanceEmitter.emit(t,!0)}removeInstance(t){const s=_.indexOf(this._instances,t);assert&&assert(s!==-1,"Cannot remove a Instance from a Node if it was not there"),this._instances.splice(s,1),this.changedInstanceEmitter.emit(t,!1)}wasVisuallyDisplayed(t){for(let s=0;s<this._instances.length;s++){const r=this._instances[s];if(r.visible&&(!t||r.display===t))return!0}return!1}getRootedDisplays(){return this._rootedDisplays}get rootedDisplays(){return this.getRootedDisplays()}addRootedDisplay(t){this._rootedDisplays.push(t),this._pdomDisplaysInfo.onAddedRootedDisplay(t)}removeRootedDisplay(t){const s=_.indexOf(this._rootedDisplays,t);assert&&assert(s!==-1,"Cannot remove a Display from a Node if it was not there"),this._rootedDisplays.splice(s,1),this._pdomDisplaysInfo.onRemovedRootedDisplay(t)}getRecursiveConnectedDisplays(t){this.rootedDisplays.length&&t.push(...this.rootedDisplays);for(let s=0;s<this._parents.length;s++)t.push(...this._parents[s].getRecursiveConnectedDisplays(t));return _.uniq(t)}getConnectedDisplays(){return _.uniq(this.getRecursiveConnectedDisplays([]))}localToParentPoint(t){return this._transform.transformPosition2(t)}localToParentBounds(t){return this._transform.transformBounds2(t)}parentToLocalPoint(t){return this._transform.inversePosition2(t)}parentToLocalBounds(t){return this._transform.inverseBounds2(t)}transformBoundsFromLocalToParent(t){return t.transform(this._transform.getMatrix())}transformBoundsFromParentToLocal(t){return t.transform(this._transform.getInverse())}getLocalToGlobalMatrix(){let t=this;const s=[];for(;t;)s.push(t._transform.getMatrix()),assert&&assert(t._parents[1]===void 0,"getLocalToGlobalMatrix unable to work for DAG"),t=t._parents[0];const r=Matrix3.identity();for(let o=s.length-1;o>=0;o--)r.multiplyMatrix(s[o]);return r}getUniqueTransform(){return new Transform3(this.getLocalToGlobalMatrix())}getGlobalToLocalMatrix(){return this.getLocalToGlobalMatrix().invert()}localToGlobalPoint(t){let s=this;const r=t.copy();for(;s;)s._transform.getMatrix().multiplyVector2(r),assert&&assert(s._parents[1]===void 0,"localToGlobalPoint unable to work for DAG"),s=s._parents[0];return r}globalToLocalPoint(t){let s=this;const r=[];for(;s;)r.push(s._transform),assert&&assert(s._parents[1]===void 0,"globalToLocalPoint unable to work for DAG"),s=s._parents[0];const o=t.copy();for(let n=r.length-1;n>=0;n--)r[n].getInverse().multiplyVector2(o);return o}localToGlobalBounds(t){return t.transformed(this.getLocalToGlobalMatrix())}globalToLocalBounds(t){return t.transformed(this.getGlobalToLocalMatrix())}parentToGlobalPoint(t){return assert&&assert(this.parents.length<=1,"parentToGlobalPoint unable to work for DAG"),this.parents.length?this.parents[0].localToGlobalPoint(t):t}parentToGlobalBounds(t){return assert&&assert(this.parents.length<=1,"parentToGlobalBounds unable to work for DAG"),this.parents.length?this.parents[0].localToGlobalBounds(t):t}globalToParentPoint(t){return assert&&assert(this.parents.length<=1,"globalToParentPoint unable to work for DAG"),this.parents.length?this.parents[0].globalToLocalPoint(t):t}globalToParentBounds(t){return assert&&assert(this.parents.length<=1,"globalToParentBounds unable to work for DAG"),this.parents.length?this.parents[0].globalToLocalBounds(t):t}getGlobalBounds(){return assert&&assert(this.parents.length<=1,"globalBounds unable to work for DAG"),this.parentToGlobalBounds(this.getBounds())}get globalBounds(){return this.getGlobalBounds()}boundsOf(t){return this.globalToLocalBounds(t.getGlobalBounds())}boundsTo(t){return t.globalToLocalBounds(this.getGlobalBounds())}attachDrawable(t){return this._drawables.push(t),this}detachDrawable(t){const s=_.indexOf(this._drawables,t);return assert&&assert(s>=0,"Invalid operation: trying to detach a non-referenced drawable"),this._drawables.splice(s,1),this}mutate(t){if(!t)return this;assert&&assert(Object.getPrototypeOf(t)===Object.prototype,"Extra prototype on Node options object is a code smell"),assert&&assert(_.filter(["translation","x","left","right","centerX","centerTop","rightTop","leftCenter","center","rightCenter","leftBottom","centerBottom","rightBottom"],r=>t[r]!==void 0).length<=1,`More than one mutation on this Node set the x component, check ${Object.keys(t).join(",")}`),assert&&assert(_.filter(["translation","y","top","bottom","centerY","centerTop","rightTop","leftCenter","center","rightCenter","leftBottom","centerBottom","rightBottom"],r=>t[r]!==void 0).length<=1,`More than one mutation on this Node set the y component, check ${Object.keys(t).join(",")}`),assert&&t.hasOwnProperty("enabled")&&t.hasOwnProperty("enabledProperty")&&assert&&assert(t.enabledProperty.value===t.enabled,"If both enabled and enabledProperty are provided, then values should match"),assert&&t.hasOwnProperty("inputEnabled")&&t.hasOwnProperty("inputEnabledProperty")&&assert&&assert(t.inputEnabledProperty.value===t.inputEnabled,"If both inputEnabled and inputEnabledProperty are provided, then values should match"),assert&&t.hasOwnProperty("visible")&&t.hasOwnProperty("visibleProperty")&&assert&&assert(t.visibleProperty.value===t.visible,"If both visible and visibleProperty are provided, then values should match"),assert&&t.hasOwnProperty("pickable")&&t.hasOwnProperty("pickableProperty")&&assert&&assert(t.pickableProperty.value===t.pickable,"If both pickable and pickableProperty are provided, then values should match");const s=this._mutatorKeys;for(let r=0;r<s.length;r++){const o=s[r];if(assert&&assert(!t.hasOwnProperty(o)||t[o]!==void 0,`Undefined not allowed for Node key: ${o}`),t[o]!==void 0){const n=Object.getOwnPropertyDescriptor(Vn.prototype,o);n&&typeof n.value=="function"?this[o](t[o]):this[o]=t[o]}}return this.initializePhetioObject(DEFAULT_PHET_IO_OBJECT_BASE_OPTIONS,t),this}initializePhetioObject(t,s){const r=this.isPhetioInstrumented();super.initializePhetioObject(t,s),Tandem.PHET_IO_ENABLED&&!r&&this.isPhetioInstrumented()&&(this._visibleProperty.initializePhetio(this,VISIBLE_PROPERTY_TANDEM_NAME,()=>new BooleanProperty(this.visible,combineOptions({phetioReadOnly:this.phetioReadOnly,tandem:this.tandem.createTandem(VISIBLE_PROPERTY_TANDEM_NAME),phetioDocumentation:"Controls whether the Node will be visible (and interactive)."},s.visiblePropertyOptions))),this._enabledProperty.initializePhetio(this,ENABLED_PROPERTY_TANDEM_NAME,()=>new EnabledProperty(this.enabled,combineOptions({phetioReadOnly:this.phetioReadOnly,phetioDocumentation:'Sets whether the node is enabled. This will set whether input is enabled for this Node and most often children as well. It will also control and toggle the "disabled look" of the node.',tandem:this.tandem.createTandem(ENABLED_PROPERTY_TANDEM_NAME)},s.enabledPropertyOptions))),this._inputEnabledProperty.initializePhetio(this,INPUT_ENABLED_PROPERTY_TANDEM_NAME,()=>new Property(this.inputEnabled,combineOptions({phetioReadOnly:this.phetioReadOnly,tandem:this.tandem.createTandem(INPUT_ENABLED_PROPERTY_TANDEM_NAME),phetioValueType:BooleanIO,phetioFeatured:!0,phetioDocumentation:"Sets whether the element will have input enabled, and hence be interactive."},s.inputEnabledPropertyOptions))))}setVoicingVisible(t){this.voicingVisibleProperty.value!==t&&(this.voicingVisibleProperty.value=t)}set voicingVisible(t){this.setVoicingVisible(t)}get voicingVisible(){return this.isVoicingVisible()}isVoicingVisible(){return this.voicingVisibleProperty.value}getDebugHTMLExtras(){return""}inspect(){localStorage.scenerySnapshot=JSON.stringify({type:"Subtree",rootNodeId:this.id,nodes:serializeConnectedNodes(this)})}toString(){return`${this.constructor.name}#${this.id}`}auditInstanceSubtreeForDisplay(t){if(assertSlow){const s=this._instances.length;for(let r=0;r<s;r++){const o=this._instances[r];o.display===t&&assertSlow(o.trail.isValid(),`Invalid trail on Instance: ${o.toString()} with trail ${o.trail.toString()}`)}this.children.forEach(r=>{r.auditInstanceSubtreeForDisplay(t)})}}onBoundsListenersAddedOrRemoved(t){this.changeBoundsEventCount(t),this._boundsEventSelfCount+=t}dispose(){this.disposeParallelDOM(),this.removeAllChildren(),this.detach(),this._inputEnabledProperty.dispose(),this._enabledProperty.dispose(),this._pickableProperty.dispose(),this._visibleProperty.dispose(),super.dispose()}disposeSubtree(){if(!this.isDisposed){const t=this.children;this.dispose();for(let s=0;s<t.length;s++)t[s].disposeSubtree()}}static defaultTrailPredicate(t){return t._parents.length===0}static defaultLeafTrailPredicate(t){return t._children.length===0}},Vn.REQUIRES_BOUNDS_OPTION_KEYS=REQUIRES_BOUNDS_OPTION_KEYS,Vn.DEFAULT_NODE_OPTIONS=DEFAULT_OPTIONS$7,Vn);Node$1.prototype._mutatorKeys=ACCESSIBILITY_OPTION_KEYS.concat(NODE_OPTION_KEYS);Node$1.prototype.drawableMarkFlags=[];scenery.register("Node",Node$1);Node$1.NodeIO=new IOType("NodeIO",{valueType:Node$1,documentation:"The base type for graphical and potentially interactive objects.",metadataDefaults:{phetioState:PHET_IO_STATE_DEFAULT$1}});const DEFAULT_PHET_IO_OBJECT_BASE_OPTIONS={phetioType:Node$1.NodeIO,phetioState:PHET_IO_STATE_DEFAULT$1},Node$2=Node$1;class Picker{constructor(t){this.node=t,this.selfPruned=!1,this.selfInclusive=!1,this.subtreePrunable=!0,this.subtreePickableCount=0,this.mouseInclusiveBounds=Bounds2.NOTHING.copy(),this.mouseExclusiveBounds=Bounds2.NOTHING.copy(),this.touchInclusiveBounds=Bounds2.NOTHING.copy(),this.touchExclusiveBounds=Bounds2.NOTHING.copy(),this.mouseInclusiveDirty=!0,this.mouseExclusiveDirty=!0,this.touchInclusiveDirty=!0,this.touchExclusiveDirty=!0,this.scratchVector=new Vector2(0,0)}hitTest(t,s,r){assert&&assert(t,"trailUnderPointer requires a point"),sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`-------------- ${this.node.constructor.name}#${this.node.id}`);const o=this.selfInclusive;return s?o?this.validateMouseInclusive():this.validateMouseExclusive():r?o?this.validateTouchInclusive():this.validateTouchExclusive():this.node.validateBounds(),this.recursiveHitTest(t,s,r,!1)}recursiveHitTest(t,s,r,o){if(o=o||this.selfInclusive,this.selfPruned||!o&&this.subtreePrunable)return sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`${this.node.constructor.name}#${this.node.id} pruned ${this.selfPruned?"(self)":"(subtree)"}`),null;let n;if(s?(n=o?this.mouseInclusiveBounds:this.mouseExclusiveBounds,assert&&assert(o?!this.mouseInclusiveDirty:!this.mouseExclusiveDirty)):r?(n=o?this.touchInclusiveBounds:this.touchExclusiveBounds,assert&&assert(o?!this.touchInclusiveDirty:!this.touchExclusiveDirty)):(n=this.node.bounds,assert&&assert(!this.node._boundsDirty)),!n.containsPoint(t))return sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`${this.node.constructor.name}#${this.node.id} pruned: ${s?"mouse":r?"touch":"regular"}`),null;const l=this.node._transform.getInverse().multiplyVector2(this.scratchVector.set(t)),h=this.node.clipArea;if(h!==null&&!h.containsPoint(l))return sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`${this.node.constructor.name}#${this.node.id} out of clip area`),null;sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`${this.node.constructor.name}#${this.node.id}`);for(let g=this.node._children.length-1;g>=0;g--){const d=this.node._children[g];sceneryLog&&sceneryLog.hitTest&&sceneryLog.push();const A=d._picker.recursiveHitTest(l,s,r,o);if(sceneryLog&&sceneryLog.hitTest&&sceneryLog.pop(),A)return A.addAncestor(this.node,g)}return s&&this.node._mouseArea?(sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`${this.node.constructor.name}#${this.node.id} mouse area hit`),this.node._mouseArea.containsPoint(l)?new Trail(this.node):null):r&&this.node._touchArea?(sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`${this.node.constructor.name}#${this.node.id} touch area hit`),this.node._touchArea.containsPoint(l)?new Trail(this.node):null):this.node.selfBounds.containsPoint(l)&&this.node.containsPointSelf(l)?(sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`${this.node.constructor.name}#${this.node.id} self hit`),new Trail(this.node)):null}invalidate(t,s){let r=!!s||!this.mouseInclusiveDirty||!this.touchInclusiveDirty;if(this.mouseInclusiveDirty=!0,this.touchInclusiveDirty=!0,t&&(r=r||!this.mouseExclusiveDirty||!this.touchExclusiveDirty,this.mouseExclusiveDirty=!0,this.touchExclusiveDirty=!0),!this.selfPruned&&r){const o=this.node._parents;for(let n=0;n<o.length;n++)o[n]._picker.invalidate(t||this.selfInclusive,!1)}}validateMouseInclusive(){if(!this.mouseInclusiveDirty)return;this.mouseInclusiveBounds.set(this.node.selfBounds);const t=this.node._children;for(let s=0;s<t.length;s++){const r=t[s]._picker;r.selfPruned||(r.validateMouseInclusive(),this.mouseInclusiveBounds.includeBounds(r.mouseInclusiveBounds))}this.applyAreasAndTransform(this.mouseInclusiveBounds,this.node._mouseArea),this.mouseInclusiveDirty=!1}validateMouseExclusive(){if(!this.mouseExclusiveDirty)return;this.mouseExclusiveBounds.set(this.node.selfBounds);const t=this.node._children;for(let s=0;s<t.length;s++){const r=t[s]._picker;r.subtreePrunable||(r.selfInclusive?(r.validateMouseInclusive(),this.mouseExclusiveBounds.includeBounds(r.mouseInclusiveBounds)):(r.validateMouseExclusive(),this.mouseExclusiveBounds.includeBounds(r.mouseExclusiveBounds)))}this.applyAreasAndTransform(this.mouseExclusiveBounds,this.node._mouseArea),this.mouseExclusiveDirty=!1}validateTouchInclusive(){if(!this.touchInclusiveDirty)return;this.touchInclusiveBounds.set(this.node.selfBounds);const t=this.node._children;for(let s=0;s<t.length;s++){const r=t[s]._picker;r.selfPruned||(r.validateTouchInclusive(),this.touchInclusiveBounds.includeBounds(r.touchInclusiveBounds))}this.applyAreasAndTransform(this.touchInclusiveBounds,this.node._touchArea),this.touchInclusiveDirty=!1}validateTouchExclusive(){if(!this.touchExclusiveDirty)return;this.touchExclusiveBounds.set(this.node.selfBounds);const t=this.node._children;for(let s=0;s<t.length;s++){const r=t[s]._picker;r.subtreePrunable||(r.selfInclusive?(r.validateTouchInclusive(),this.touchExclusiveBounds.includeBounds(r.touchInclusiveBounds)):(r.validateTouchExclusive(),this.touchExclusiveBounds.includeBounds(r.touchExclusiveBounds)))}this.applyAreasAndTransform(this.touchExclusiveBounds,this.node._touchArea),this.touchExclusiveDirty=!1}applyAreasAndTransform(t,s){s&&t.includeBounds(s instanceof Bounds2?s:s.bounds);const r=this.node.clipArea;if(r){const o=r.bounds;t.minX=Math.max(t.minX,o.minX),t.minY=Math.max(t.minY,o.minY),t.maxX=Math.min(t.maxX,o.maxX),t.maxY=Math.min(t.maxY,o.maxY)}this.node.transformBoundsFromLocalToParent(t)}onInsertChild(t){if(!t._picker.selfPruned){const s=t._picker.subtreePickableCount>0;s&&this.changePickableCount(1),this.invalidate(s,!0)}}onRemoveChild(t){if(!t._picker.selfPruned){const s=t._picker.subtreePickableCount>0;s&&this.changePickableCount(-1),this.invalidate(s,!0)}}onAddInputListener(){this.checkSelfInclusive(),this.checkSubtreePrunable(),this.changePickableCount(1),assertSlow&&this.audit()}onRemoveInputListener(){this.checkSelfInclusive(),this.checkSubtreePrunable(),this.changePickableCount(-1),assertSlow&&this.audit()}onPickableChange(t,s){this.checkSelfPruned(),this.checkSelfInclusive(),this.checkSubtreePrunable();const r=(t===!0?-1:0)+(s===!0?1:0);r&&this.changePickableCount(r),assertSlow&&this.audit()}onVisibilityChange(){this.checkSelfPruned(),this.checkSubtreePrunable()}onMouseAreaChange(){this.invalidate(!0)}onTouchAreaChange(){this.invalidate(!0)}onTransformChange(){this.invalidate(!0)}onSelfBoundsDirty(){this.invalidate(!0)}onClipAreaChange(){this.invalidate(!0)}checkSelfPruned(){const t=this.node.pickableProperty.value===!1||!this.node.isVisible();if(this.selfPruned!==t){this.selfPruned=t;const s=this.node._parents;for(let r=0;r<s.length;r++){const o=s[r]._picker;this.subtreePickableCount>0?(o.invalidate(!0,!0),o.changePickableCount(this.selfPruned?-1:1)):o.invalidate(!1,!0)}}}checkSelfInclusive(){const t=this.node.pickableProperty.value===!0||this.node._inputListeners.length>0;this.selfInclusive!==t&&(this.selfInclusive=t,this.invalidate(!0,!0))}checkSubtreePrunable(){const t=this.node.pickableProperty.value===!1||!this.node.isVisible()||this.node.pickableProperty.value!==!0&&this.subtreePickableCount===0;this.subtreePrunable!==t&&(this.subtreePrunable=t,this.invalidate(!0,!0))}changePickableCount(t){if(t===0)return;const s=this.subtreePickableCount===0;this.subtreePickableCount+=t;const r=this.subtreePickableCount===0;if(this.checkSubtreePrunable(),assert&&assert(this.subtreePickableCount>=0,"subtree pickable count should be guaranteed to be >= 0"),!this.selfPruned&&s!==r){const o=this.node._parents.length;for(let n=0;n<o;n++)this.node._parents[n]._picker.changePickableCount(s?1:-1)}}audit(){if(assertSlow){this.node._children.forEach(l=>{l._picker.audit()});const t=assertSlow,s=this.node.pickable===!1||!this.node.isVisible(),r=this.node.pickable===!0||this.node._inputListeners.length>0,o=this.node.pickable===!1||!this.node.isVisible()||this.node.pickable!==!0&&this.subtreePickableCount===0,n=this.node._inputListeners.length+(this.node.pickableProperty.value===!0?1:0)+_.filter(this.node._children,l=>!l._picker.selfPruned&&l._picker.subtreePickableCount>0).length;assertSlow(this.selfPruned===s,"selfPruned mismatch"),assertSlow(this.selfInclusive===r,"selfInclusive mismatch"),assertSlow(this.subtreePrunable===o,"subtreePrunable mismatch"),assertSlow(this.subtreePickableCount===n,"subtreePickableCount mismatch"),this.node._parents.forEach(l=>{const h=l._picker,g=this;h.mouseInclusiveDirty||t(g.selfPruned||!g.mouseInclusiveDirty),h.mouseExclusiveDirty||(g.selfInclusive?t(g.selfPruned||!g.mouseInclusiveDirty):t(g.selfPruned||g.subtreePrunable||!g.mouseExclusiveDirty)),h.touchInclusiveDirty||t(g.selfPruned||!g.touchInclusiveDirty),h.touchExclusiveDirty||(g.selfInclusive?t(g.selfPruned||!g.touchInclusiveDirty):t(g.selfPruned||g.subtreePrunable||!g.touchExclusiveDirty))})}}}scenery.register("Picker",Picker);const summaryBits=[Renderer.bitmaskCanvas,Renderer.bitmaskSVG,Renderer.bitmaskDOM,Renderer.bitmaskWebGL,Renderer.bitmaskSingleCanvas,Renderer.bitmaskSingleSVG,Renderer.bitmaskNotPainted,Renderer.bitmaskBoundsValid,Renderer.bitmaskNoPDOM,Renderer.bitmaskLacksCanvas,Renderer.bitmaskLacksSVG,Renderer.bitmaskLacksDOM,Renderer.bitmaskLacksWebGL],summaryBitIndices={};summaryBits.forEach((a,t)=>{summaryBitIndices[a]=t});const numSummaryBits=summaryBits.length;let bitmaskAll=0;for(let a=0;a<numSummaryBits;a++)bitmaskAll|=summaryBits[a];class RendererSummary{constructor(t){assert&&assert(t instanceof Node$2),assert&&assert(t._rendererBitmask===Renderer.bitmaskNodeDefault,"Node must have a default bitmask when creating a RendererSummary"),assert&&assert(t._children.length===0,"Node cannot have children when creating a RendererSummary"),this.node=t,this._counts=new Int16Array(numSummaryBits),this.bitmask=bitmaskAll,this.selfBitmask=RendererSummary.summaryBitmaskForNodeSelf(t),this.summaryChange(this.bitmask,this.selfBitmask);const s=this.selfChange.bind(this);this.node.filterChangeEmitter.addListener(s),this.node.clipAreaProperty.lazyLink(s),this.node.rendererSummaryRefreshEmitter.addListener(s)}summaryChange(t,s){assert&&this.audit();const r=t^s;let o=0,n=0;for(let l=0;l<numSummaryBits;l++){const h=summaryBits[l],g=summaryBitIndices[h];h&r&&(h&s?(this._counts[g]--,this._counts[g]===0&&(n|=h)):(this._counts[g]++,this._counts[g]===1&&(o|=h)))}if(o||n){const l=this.bitmask;assert&&assert(l!==void 0);for(let g=0;g<numSummaryBits;g++){const d=summaryBits[g];n&d&&(this.bitmask|=d),o&d&&(this.bitmask^=d,assert&&assert(!(this.bitmask&d),"Should be cleared, doing cheaper XOR assuming it already was set"))}this.node.instanceRefreshEmitter.emit(),this.node.onSummaryChange(l,this.bitmask);const h=this.node._parents.length;for(let g=0;g<h;g++)this.node._parents[g]._rendererSummary.summaryChange(o,n);assert&&assert(this.bitmask===this.computeBitmask(),"Sanity check")}assert&&this.audit()}selfChange(){const t=this.selfBitmask,s=RendererSummary.summaryBitmaskForNodeSelf(this.node);t!==s&&(this.summaryChange(t,s),this.selfBitmask=s)}computeBitmask(){let t=0;for(let s=0;s<numSummaryBits;s++)this._counts[s]===0&&(t|=summaryBits[s]);return t}isSubtreeFullyCompatible(t){return!!(t&this.bitmask)}isSubtreeContainingCompatible(t){return!(t<<Renderer.bitmaskLacksShift&this.bitmask)}isSingleCanvasSupported(){return!!(Renderer.bitmaskSingleCanvas&this.bitmask)}isSingleSVGSupported(){return!!(Renderer.bitmaskSingleSVG&this.bitmask)}isNotPainted(){return!!(Renderer.bitmaskNotPainted&this.bitmask)}hasNoPDOM(){return!!(Renderer.bitmaskNoPDOM&this.bitmask)}areBoundsValid(){return!!(Renderer.bitmaskBoundsValid&this.bitmask)}isSubtreeRenderedExclusivelySVG(t){if(!this.isSingleSVGSupported())return!1;for(let s=0;s<Renderer.numActiveRenderers;s++){const r=Renderer.bitmaskOrder(t,s);if(Renderer.bitmaskSVG&r)return!0;if(this.isSubtreeContainingCompatible(r))return!1}return!1}isSubtreeRenderedExclusivelyCanvas(t){if(!this.isSingleCanvasSupported())return!1;for(let s=0;s<Renderer.numActiveRenderers;s++){const r=Renderer.bitmaskOrder(t,s);if(Renderer.bitmaskCanvas&r)return!0;if(this.isSubtreeContainingCompatible(r))return!1}return!1}audit(){if(assert)for(let t=0;t<numSummaryBits;t++){const s=summaryBits[t],r=this._counts[t]===0,o=!!(this.bitmask&s);assert(r===o,"Bits should be set if count is zero")}}toString(){let t=RendererSummary.bitmaskToString(this.bitmask);for(let s=0;s<numSummaryBits;s++){const r=summaryBits[s],o=this._counts[s];o!==0&&(t+=` ${RendererSummary.bitToString(r)}:${o}`)}return t}static summaryBitmaskForNodeSelf(t){let s=t._rendererBitmask;t.isPainted()?s|=(t._rendererBitmask&Renderer.bitmaskCurrentRendererArea^Renderer.bitmaskCurrentRendererArea)<<Renderer.bitmaskLacksShift:s|=Renderer.bitmaskCurrentRendererArea<<Renderer.bitmaskLacksShift;const r=t._cssTransform||t._layerSplit,o=t._renderer;return!r&&Renderer.isSVG(t._rendererBitmask)&&(!o||Renderer.isSVG(o))&&(s|=Renderer.bitmaskSingleSVG),!r&&Renderer.isCanvas(t._rendererBitmask)&&(!o||Renderer.isCanvas(o))&&(s|=Renderer.bitmaskSingleCanvas),t.isPainted()||(s|=Renderer.bitmaskNotPainted),t.areSelfBoundsValid()&&(s|=Renderer.bitmaskBoundsValid),!t.hasPDOMContent&&!t.hasPDOMOrder()&&(s|=Renderer.bitmaskNoPDOM),s}static bitToString(t){return t===Renderer.bitmaskCanvas?"Canvas":t===Renderer.bitmaskSVG?"SVG":t===Renderer.bitmaskDOM?"DOM":t===Renderer.bitmaskWebGL?"WebGL":t===Renderer.bitmaskLacksCanvas?"(-Canvas)":t===Renderer.bitmaskLacksSVG?"(-SVG)":t===Renderer.bitmaskLacksDOM?"(-DOM)":t===Renderer.bitmaskLacksWebGL?"(-WebGL)":t===Renderer.bitmaskSingleCanvas?"SingleCanvas":t===Renderer.bitmaskSingleSVG?"SingleSVG":t===Renderer.bitmaskNotPainted?"NotPainted":t===Renderer.bitmaskBoundsValid?"BoundsValid":t===Renderer.bitmaskNoPDOM?"NotAccessible":"?"}static bitmaskToString(t){let s="";for(let r=0;r<numSummaryBits;r++){const o=summaryBits[r];t&o&&(s+=`${RendererSummary.bitToString(o)} `)}return s}}RendererSummary.bitmaskAll=bitmaskAll;scenery.register("RendererSummary",RendererSummary);const RendererSummary$1=RendererSummary;class PDOMDisplaysInfo{constructor(t){this.node=t,this.pdomDisplays=[]}onAddChild(t){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`onAddChild n#${t.id} (parent:n#${this.node.id})`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),t._pdomDisplaysInfo.canHavePDOMDisplays()&&t._pdomDisplaysInfo.addPDOMDisplays(this.pdomDisplays),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}onRemoveChild(t){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`onRemoveChild n#${t.id} (parent:n#${this.node.id})`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),t._pdomDisplaysInfo.canHavePDOMDisplays()&&t._pdomDisplaysInfo.removePDOMDisplays(this.pdomDisplays),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}onSummaryChange(t,s){if(sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`onSummaryChange n#${this.node.id} wasPDOM:${!(Renderer.bitmaskNoPDOM&t)}, isPDOM:${!(Renderer.bitmaskNoPDOM&s)}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),this.node.visible&&this.node.pdomVisible){const r=!(Renderer.bitmaskNoPDOM&t),o=!(Renderer.bitmaskNoPDOM&s);o&&!r&&this.addAllPDOMDisplays(),!o&&r&&this.removeAllPDOMDisplays()}sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}onVisibilityChange(t){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`onVisibilityChange n#${this.node.id} visible:${t}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),this.node.pdomVisible&&!this.node._rendererSummary.hasNoPDOM()&&(t?this.addAllPDOMDisplays():this.removeAllPDOMDisplays()),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}onPDOMVisibilityChange(t){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`onPDOMVisibilityChange n#${this.node.id} pdomVisible:${t}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),this.node.visible&&!this.node._rendererSummary.hasNoPDOM()&&(t?this.addAllPDOMDisplays():this.removeAllPDOMDisplays()),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}onAddedRootedDisplay(t){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`onAddedRootedDisplay n#${this.node.id}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),t._accessible&&this.canHavePDOMDisplays()&&this.addPDOMDisplays([t]),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}onRemovedRootedDisplay(t){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`onRemovedRootedDisplay n#${this.node.id}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),t._accessible&&this.canHavePDOMDisplays()&&this.removePDOMDisplays([t]),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}canHavePDOMDisplays(){return this.node.visible&&this.node.pdomVisible&&!this.node._rendererSummary.hasNoPDOM()}addAllPDOMDisplays(){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`addAllPDOMDisplays n#${this.node.id}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),assert&&assert(this.pdomDisplays.length===0,"Should be empty before adding everything"),assert&&assert(this.canHavePDOMDisplays(),"Should happen when we can store pdomDisplays");let t;const s=[];for(t=0;t<this.node._parents.length;t++)Array.prototype.push.apply(s,this.node._parents[t]._pdomDisplaysInfo.pdomDisplays);for(t=0;t<this.node._rootedDisplays.length;t++){const r=this.node._rootedDisplays[t];r._accessible&&s.push(r)}this.addPDOMDisplays(s),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}removeAllPDOMDisplays(){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`removeAllPDOMDisplays n#${this.node.id}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),assert&&assert(!this.canHavePDOMDisplays(),"Should happen when we cannot store pdomDisplays"),this.removePDOMDisplays(this.pdomDisplays.slice()),assert&&assert(this.pdomDisplays.length===0,"Should be empty after removing everything"),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}addPDOMDisplays(t){if(sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`addPDOMDisplays n#${this.node.id} numDisplays:${t.length}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),assert&&assert(Array.isArray(t)),t.length!==0){Array.prototype.push.apply(this.pdomDisplays,t);for(let s=0;s<this.node._children.length;s++)this.node._children[s]._pdomDisplaysInfo.canHavePDOMDisplays()&&this.node._children[s]._pdomDisplaysInfo.addPDOMDisplays(t);this.node.pdomDisplaysEmitter.emit()}sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}removePDOMDisplays(t){if(sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`removePDOMDisplays n#${this.node.id} numDisplays:${t.length}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),assert&&assert(Array.isArray(t)),assert&&assert(this.pdomDisplays.length>=t.length,"there should be at least as many PDOMDisplays as Displays"),t.length!==0){let s;for(s=t.length-1;s>=0;s--){const r=this.pdomDisplays.lastIndexOf(t[s]);assert&&assert(r>=0),this.pdomDisplays.splice(s,1)}for(s=0;s<this.node._children.length;s++){const r=this.node._children[s];r._pdomDisplaysInfo.canHavePDOMDisplays()&&!r._isGettingRemovedFromParent&&r._pdomDisplaysInfo.removePDOMDisplays(t)}this.node.pdomDisplaysEmitter.emit()}sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}}scenery.register("PDOMDisplaysInfo",PDOMDisplaysInfo);const CHANGE_POSITION_THRESHOLD$2=1e-9,WIDTH_SIZABLE_OPTION_KEYS=["preferredWidth","minimumWidth","localPreferredWidth","localMinimumWidth","widthSizable"],WidthSizable=memoize(a=>{const t=DelayedMutate$1("WidthSizable",WIDTH_SIZABLE_OPTION_KEYS,class extends a{constructor(...r){super(...r),this.preferredWidthProperty=new TinyProperty(null),this.minimumWidthProperty=new TinyProperty(null),this.localPreferredWidthProperty=new TinyProperty(null),this.localMinimumWidthProperty=new TinyProperty(null),this.isWidthResizableProperty=new TinyProperty(!0),this._preferredSizeChanging=!1,this._minimumSizeChanging=!1,this._preferredSizeChangeAttemptDuringLock=!1,this._minimumSizeChangeAttemptDuringLock=!1,this._updatePreferredWidthListener=this._updatePreferredWidth.bind(this),this._updateLocalPreferredWidthListener=this._updateLocalPreferredWidth.bind(this),this._updateMinimumWidthListener=this._updateMinimumWidth.bind(this),this._updateLocalMinimumWidthListener=this._updateLocalMinimumWidth.bind(this),this.preferredWidthProperty.lazyLink(this._updateLocalPreferredWidthListener),this.localPreferredWidthProperty.lazyLink(this._updatePreferredWidthListener),this.minimumWidthProperty.lazyLink(this._updateLocalMinimumWidthListener),this.localMinimumWidthProperty.lazyLink(this._updateMinimumWidthListener),this.transformEmitter.addListener(this._updateLocalPreferredWidthListener),this.transformEmitter.addListener(this._updateMinimumWidthListener)}get preferredWidth(){return assert&&assert(this.preferredWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),this.preferredWidthProperty.value}set preferredWidth(r){assert&&assert(this.preferredWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(r===null||typeof r=="number"&&isFinite(r)&&r>=0,"preferredWidth should be null or a non-negative finite number"),this.preferredWidthProperty.value=r}get localPreferredWidth(){return assert&&assert(this.localPreferredWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),this.localPreferredWidthProperty.value}set localPreferredWidth(r){assert&&assert(this.localPreferredWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(r===null||typeof r=="number"&&isFinite(r)&&r>=0,"localPreferredWidth should be null or a non-negative finite number"),this.localPreferredWidthProperty.value=r}get minimumWidth(){return assert&&assert(this.minimumWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),this.minimumWidthProperty.value}set minimumWidth(r){assert&&assert(this.minimumWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(r===null||typeof r=="number"&&isFinite(r)),this.minimumWidthProperty.value=r}get localMinimumWidth(){return assert&&assert(this.localMinimumWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),this.localMinimumWidthProperty.value}set localMinimumWidth(r){assert&&assert(this.localMinimumWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(r===null||typeof r=="number"&&isFinite(r)),this.localMinimumWidthProperty.value=r}get widthSizable(){return assert&&assert(this.isWidthResizableProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),this.isWidthResizableProperty.value}set widthSizable(r){assert&&assert(this.isWidthResizableProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),this.isWidthResizableProperty.value=r}get extendsWidthSizable(){return!0}validateLocalPreferredWidth(){if(assert){const r=this.localWidth,o=this.localMinimumWidth===null?r:this.localMinimumWidth,n=this.localPreferredWidth===null?o:this.localPreferredWidth;assert(n===r||Math.abs(n-r)<1e-7)}}_calculateLocalPreferredWidth(){return this.matrix.isAligned()&&this.preferredWidth!==null?Math.abs(this.transform.inverseDeltaX(this.preferredWidth)):null}_onReentrantPreferredWidth(){this._updateLocalPreferredWidthListener()}_updateLocalPreferredWidth(){if(assert&&this.auditMaxDimensions(),this._preferredSizeChanging)this._preferredSizeChangeAttemptDuringLock=!0;else{this._preferredSizeChanging=!0;do{this._preferredSizeChangeAttemptDuringLock=!1;const r=this._calculateLocalPreferredWidth();(this.localPreferredWidthProperty.value===null||r===null||Math.abs(this.localPreferredWidthProperty.value-r)>CHANGE_POSITION_THRESHOLD$2)&&(this.localPreferredWidthProperty.value=r)}while(this._preferredSizeChangeAttemptDuringLock);this._preferredSizeChanging=!1}}_calculatePreferredWidth(){return this.matrix.isAligned()&&this.localPreferredWidth!==null?Math.abs(this.transform.transformDeltaX(this.localPreferredWidth)):null}_updatePreferredWidth(){if(this._preferredSizeChanging)this._preferredSizeChangeAttemptDuringLock=!0;else{this._preferredSizeChanging=!0,this._preferredSizeChangeAttemptDuringLock=!1;const r=this._calculatePreferredWidth();(this.preferredWidthProperty.value===null||r===null||Math.abs(this.preferredWidthProperty.value-r)>CHANGE_POSITION_THRESHOLD$2)&&(this.preferredWidthProperty.value=r),this._preferredSizeChanging=!1,this._preferredSizeChangeAttemptDuringLock&&this._onReentrantPreferredWidth()}}_calculateLocalMinimumWidth(){return this.matrix.isAligned()&&this.minimumWidth!==null?Math.abs(this.transform.inverseDeltaX(this.minimumWidth)):null}_onReentrantLocalMinimumWidth(){this._updateMinimumWidthListener()}_updateLocalMinimumWidth(){if(this._minimumSizeChanging)this._minimumSizeChangeAttemptDuringLock=!0;else{this._minimumSizeChanging=!0;const r=this._calculateLocalMinimumWidth();this._minimumSizeChangeAttemptDuringLock=!1,(this.localMinimumWidthProperty.value===null||r===null||Math.abs(this.localMinimumWidthProperty.value-r)>CHANGE_POSITION_THRESHOLD$2)&&(this.localMinimumWidthProperty.value=r),this._minimumSizeChanging=!1,this._minimumSizeChangeAttemptDuringLock&&this._onReentrantLocalMinimumWidth()}}_calculateMinimumWidth(){return this.matrix.isAligned()&&this.localMinimumWidth!==null?Math.abs(this.transform.transformDeltaX(this.localMinimumWidth)):null}_updateMinimumWidth(){if(this._minimumSizeChanging)this._minimumSizeChangeAttemptDuringLock=!0;else{this._minimumSizeChanging=!0;do{this._minimumSizeChangeAttemptDuringLock=!1;const r=this._calculateMinimumWidth();(this.minimumWidthProperty.value===null||r===null||Math.abs(this.minimumWidthProperty.value-r)>CHANGE_POSITION_THRESHOLD$2)&&(this.minimumWidthProperty.value=r)}while(this._minimumSizeChangeAttemptDuringLock);this._minimumSizeChanging=!1}}mutate(r){return super.mutate(r)}});if(t.prototype._mutatorKeys){const s=t.prototype._mutatorKeys,r=WIDTH_SIZABLE_OPTION_KEYS,o=s.indexOf(REQUIRES_BOUNDS_OPTION_KEYS[0]);t.prototype._mutatorKeys=[...s.slice(0,o),...r,...s.slice(o)]}return t}),isWidthSizable=a=>a.widthSizable,extendsWidthSizable=a=>a.extendsWidthSizable;scenery.register("WidthSizable",WidthSizable);const CHANGE_POSITION_THRESHOLD$1=1e-9,HEIGHT_SIZABLE_OPTION_KEYS=["preferredHeight","minimumHeight","localPreferredHeight","localMinimumHeight","heightSizable"],HeightSizable=memoize(a=>{const t=DelayedMutate$1("HeightSizable",HEIGHT_SIZABLE_OPTION_KEYS,class extends a{constructor(...r){super(...r),this.preferredHeightProperty=new TinyProperty(null),this.minimumHeightProperty=new TinyProperty(null),this.localPreferredHeightProperty=new TinyProperty(null),this.localMinimumHeightProperty=new TinyProperty(null),this.isHeightResizableProperty=new TinyProperty(!0),this._preferredSizeChanging=!1,this._minimumSizeChanging=!1,this._preferredSizeChangeAttemptDuringLock=!1,this._minimumSizeChangeAttemptDuringLock=!1,this._updatePreferredHeightListener=this._updatePreferredHeight.bind(this),this._updateLocalPreferredHeightListener=this._updateLocalPreferredHeight.bind(this),this._updateMinimumHeightListener=this._updateMinimumHeight.bind(this),this._updateLocalMinimumHeightListener=this._updateLocalMinimumHeight.bind(this),this.preferredHeightProperty.lazyLink(this._updateLocalPreferredHeightListener),this.localPreferredHeightProperty.lazyLink(this._updatePreferredHeightListener),this.minimumHeightProperty.lazyLink(this._updateLocalMinimumHeightListener),this.localMinimumHeightProperty.lazyLink(this._updateMinimumHeightListener),this.transformEmitter.addListener(this._updateLocalPreferredHeightListener),this.transformEmitter.addListener(this._updateMinimumHeightListener)}get preferredHeight(){return assert&&assert(this.preferredHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),this.preferredHeightProperty.value}set preferredHeight(r){assert&&assert(this.preferredHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(r===null||typeof r=="number"&&isFinite(r)&&r>=0,"preferredHeight should be null or a non-negative finite number"),this.preferredHeightProperty.value=r}get localPreferredHeight(){return assert&&assert(this.localPreferredHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),this.localPreferredHeightProperty.value}set localPreferredHeight(r){assert&&assert(this.localPreferredHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(r===null||typeof r=="number"&&isFinite(r)&&r>=0,"localPreferredHeight should be null or a non-negative finite number"),this.localPreferredHeightProperty.value=r}get minimumHeight(){return assert&&assert(this.minimumHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),this.minimumHeightProperty.value}set minimumHeight(r){assert&&assert(this.minimumHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(r===null||typeof r=="number"&&isFinite(r)),this.minimumHeightProperty.value=r}get localMinimumHeight(){return assert&&assert(this.localMinimumHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),this.localMinimumHeightProperty.value}set localMinimumHeight(r){assert&&assert(this.localMinimumHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(r===null||typeof r=="number"&&isFinite(r)),this.localMinimumHeightProperty.value=r}get heightSizable(){return assert&&assert(this.isHeightResizableProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),this.isHeightResizableProperty.value}set heightSizable(r){assert&&assert(this.isHeightResizableProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),this.isHeightResizableProperty.value=r}get extendsHeightSizable(){return!0}validateLocalPreferredHeight(){if(assert){const r=this.localHeight,o=this.localMinimumHeight===null?r:this.localMinimumHeight,n=this.localPreferredHeight===null?o:this.localPreferredHeight;assert(n===r||Math.abs(n-r)<1e-7)}}_calculateLocalPreferredHeight(){return this.matrix.isAligned()&&this.preferredHeight!==null?Math.abs(this.transform.inverseDeltaY(this.preferredHeight)):null}_onReentrantPreferredHeight(){this._updateLocalPreferredHeightListener()}_updateLocalPreferredHeight(){if(assert&&this.auditMaxDimensions(),this._preferredSizeChanging)this._preferredSizeChangeAttemptDuringLock=!0;else{this._preferredSizeChanging=!0;do{this._preferredSizeChangeAttemptDuringLock=!1;const r=this._calculateLocalPreferredHeight();(this.localPreferredHeightProperty.value===null||r===null||Math.abs(this.localPreferredHeightProperty.value-r)>CHANGE_POSITION_THRESHOLD$1)&&(this.localPreferredHeightProperty.value=r)}while(this._preferredSizeChangeAttemptDuringLock);this._preferredSizeChanging=!1}}_calculatePreferredHeight(){return this.matrix.isAligned()&&this.localPreferredHeight!==null?Math.abs(this.transform.transformDeltaY(this.localPreferredHeight)):null}_updatePreferredHeight(){if(this._preferredSizeChanging)this._preferredSizeChangeAttemptDuringLock=!0;else{this._preferredSizeChanging=!0,this._preferredSizeChangeAttemptDuringLock=!1;const r=this._calculatePreferredHeight();(this.preferredHeightProperty.value===null||r===null||Math.abs(this.preferredHeightProperty.value-r)>CHANGE_POSITION_THRESHOLD$1)&&(this.preferredHeightProperty.value=r),this._preferredSizeChanging=!1,this._preferredSizeChangeAttemptDuringLock&&this._onReentrantPreferredHeight()}}_calculateLocalMinimumHeight(){return this.matrix.isAligned()&&this.minimumHeight!==null?Math.abs(this.transform.inverseDeltaY(this.minimumHeight)):null}_onReentrantLocalMinimumHeight(){this._updateMinimumHeight()}_updateLocalMinimumHeight(){if(this._minimumSizeChanging)this._minimumSizeChangeAttemptDuringLock=!0;else{this._minimumSizeChanging=!0,this._minimumSizeChangeAttemptDuringLock=!1;const r=this._calculateLocalMinimumHeight();(this.localMinimumHeightProperty.value===null||r===null||Math.abs(this.localMinimumHeightProperty.value-r)>CHANGE_POSITION_THRESHOLD$1)&&(this.localMinimumHeightProperty.value=r),this._minimumSizeChanging=!1,this._minimumSizeChangeAttemptDuringLock&&this._onReentrantLocalMinimumHeight()}}_calculateMinimumHeight(){return this.matrix.isAligned()&&this.localMinimumHeight!==null?Math.abs(this.transform.transformDeltaY(this.localMinimumHeight)):null}_updateMinimumHeight(){if(!this._minimumSizeChanging){this._minimumSizeChanging=!0;do{this._minimumSizeChangeAttemptDuringLock=!1;const r=this._calculateMinimumHeight();(this.minimumHeightProperty.value===null||r===null||Math.abs(this.minimumHeightProperty.value-r)>CHANGE_POSITION_THRESHOLD$1)&&(this.minimumHeightProperty.value=r)}while(this._minimumSizeChangeAttemptDuringLock);this._minimumSizeChanging=!1}}mutate(r){return super.mutate(r)}});if(t.prototype._mutatorKeys){const s=t.prototype._mutatorKeys,r=HEIGHT_SIZABLE_OPTION_KEYS,o=s.indexOf(REQUIRES_BOUNDS_OPTION_KEYS[0]);t.prototype._mutatorKeys=[...s.slice(0,o),...r,...s.slice(o)]}return t}),isHeightSizable=a=>a.heightSizable,extendsHeightSizable=a=>a.extendsHeightSizable;scenery.register("HeightSizable",HeightSizable);const SIZABLE_SELF_OPTION_KEYS=["preferredSize","minimumSize","localPreferredSize","localMinimumSize","sizable"],SIZABLE_OPTION_KEYS=["preferredSize","minimumSize","localPreferredSize","localMinimumSize","sizable",...WIDTH_SIZABLE_OPTION_KEYS,...HEIGHT_SIZABLE_OPTION_KEYS],Sizable=memoize(a=>{const t=WidthSizable(HeightSizable(a)),s=DelayedMutate$1("Sizable",SIZABLE_SELF_OPTION_KEYS,class extends t{constructor(...o){super(...o),this.preferredWidthProperty.lazyLink(this._updateLocalPreferredHeightListener),this.preferredHeightProperty.lazyLink(this._updateLocalPreferredWidthListener),this.localPreferredWidthProperty.lazyLink(this._updatePreferredHeightListener),this.localPreferredHeightProperty.lazyLink(this._updatePreferredWidthListener),this.minimumWidthProperty.lazyLink(this._updateLocalMinimumHeightListener),this.minimumHeightProperty.lazyLink(this._updateLocalMinimumWidthListener),this.localMinimumWidthProperty.lazyLink(this._updateMinimumHeightListener),this.localMinimumHeightProperty.lazyLink(this._updateMinimumWidthListener)}get preferredSize(){return assert&&assert(this.preferredWidth===null==(this.preferredHeight===null),"Cannot get a preferredSize when one of preferredWidth/preferredHeight is null"),this.preferredWidth===null||this.preferredHeight===null?null:new Dimension2(this.preferredWidth,this.preferredHeight)}set preferredSize(o){this.preferredWidth=o===null?null:o.width,this.preferredHeight=o===null?null:o.height}get localPreferredSize(){return assert&&assert(this.localPreferredWidth===null==(this.localPreferredHeight===null),"Cannot get a preferredSize when one of preferredWidth/preferredHeight is null"),this.localPreferredWidth===null||this.localPreferredHeight===null?null:new Dimension2(this.localPreferredWidth,this.localPreferredHeight)}set localPreferredSize(o){this.localPreferredWidth=o===null?null:o.width,this.localPreferredHeight=o===null?null:o.height}get minimumSize(){return assert&&assert(this.minimumWidth===null==(this.minimumHeight===null),"Cannot get a minimumSize when one of minimumWidth/minimumHeight is null"),this.minimumWidth===null||this.minimumHeight===null?null:new Dimension2(this.minimumWidth,this.minimumHeight)}set minimumSize(o){this.minimumWidth=o===null?null:o.width,this.minimumHeight=o===null?null:o.height}get localMinimumSize(){return assert&&assert(this.localMinimumWidth===null==(this.localMinimumHeight===null),"Cannot get a minimumSize when one of minimumWidth/minimumHeight is null"),this.localMinimumWidth===null||this.localMinimumHeight===null?null:new Dimension2(this.localMinimumWidth,this.localMinimumHeight)}set localMinimumSize(o){this.localMinimumWidth=o===null?null:o.width,this.localMinimumHeight=o===null?null:o.height}get sizable(){return assert&&assert(this.widthSizable===this.heightSizable,"widthSizable and heightSizable not the same, which is required for the sizable getter"),this.widthSizable}set sizable(o){this.widthSizable=o,this.heightSizable=o}get extendsSizable(){return!0}validateLocalPreferredSize(){assert&&(this.validateLocalPreferredWidth(),this.validateLocalPreferredHeight())}mutate(o){return assertMutuallyExclusiveOptions(o,["preferredSize"],["preferredWidth","preferredHeight"]),assertMutuallyExclusiveOptions(o,["localPreferredSize"],["localPreferredWidth","localPreferredHeight"]),assertMutuallyExclusiveOptions(o,["minimumSize"],["minimumWidth","minimumHeight"]),assertMutuallyExclusiveOptions(o,["localMinimumSize"],["localMinimumWidth","localMinimumHeight"]),assertMutuallyExclusiveOptions(o,["sizable"],["widthSizable","heightSizable"]),super.mutate(o)}_calculateLocalPreferredWidth(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.preferredWidth!==null)return Math.abs(this.transform.inverseDeltaX(this.preferredWidth))}else if(this.preferredHeight!==null)return Math.abs(this.transform.getInverse().m01()*this.preferredHeight)}return null}_calculateLocalPreferredHeight(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.preferredHeight!==null)return Math.abs(this.transform.inverseDeltaY(this.preferredHeight))}else if(this.preferredWidth!==null)return Math.abs(this.transform.getInverse().m10()*this.preferredWidth)}return null}_calculatePreferredWidth(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.localPreferredWidth!==null)return Math.abs(this.transform.transformDeltaX(this.localPreferredWidth))}else if(this.localPreferredHeight!==null)return Math.abs(this.transform.matrix.m01()*this.localPreferredHeight)}return null}_calculatePreferredHeight(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.localPreferredHeight!==null)return Math.abs(this.transform.transformDeltaY(this.localPreferredHeight))}else if(this.localPreferredWidth!==null)return Math.abs(this.transform.matrix.m10()*this.localPreferredWidth)}return null}_onReentrantLocalMinimumWidth(){this._updateMinimumWidthListener(),this._updateMinimumHeightListener()}_onReentrantLocalMinimumHeight(){this._updateMinimumWidthListener(),this._updateMinimumHeightListener()}_onReentrantPreferredWidth(){this._updateLocalPreferredWidthListener(),this._updateLocalPreferredHeightListener()}_onReentrantPreferredHeight(){this._updateLocalPreferredWidthListener(),this._updateLocalPreferredHeightListener()}_calculateLocalMinimumWidth(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.minimumWidth!==null)return Math.abs(this.transform.inverseDeltaX(this.minimumWidth))}else if(this.minimumHeight!==null)return Math.abs(this.transform.getInverse().m01()*this.minimumHeight)}return null}_calculateLocalMinimumHeight(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.minimumHeight!==null)return Math.abs(this.transform.inverseDeltaY(this.minimumHeight))}else if(this.minimumWidth!==null)return Math.abs(this.transform.getInverse().m10()*this.minimumWidth)}return null}_calculateMinimumWidth(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.localMinimumWidth!==null)return Math.abs(this.transform.transformDeltaX(this.localMinimumWidth))}else if(this.localMinimumHeight!==null)return Math.abs(this.transform.matrix.m01()*this.localMinimumHeight)}return null}_calculateMinimumHeight(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.localMinimumHeight!==null)return Math.abs(this.transform.transformDeltaY(this.localMinimumHeight))}else if(this.localMinimumWidth!==null)return Math.abs(this.transform.matrix.m10()*this.localMinimumWidth)}return null}});if(s.prototype._mutatorKeys){const r=s.prototype._mutatorKeys,o=SIZABLE_SELF_OPTION_KEYS,n=r.indexOf(REQUIRES_BOUNDS_OPTION_KEYS[0]);s.prototype._mutatorKeys=[...r.slice(0,n),...o,...r.slice(n)]}return s});scenery.register("Sizable",Sizable);const ID_SEPARATOR=PDOMUtils$1.PDOM_UNIQUE_ID_SEPARATOR;class Trail{constructor(t){if(assert&&(this.immutable=void 0),t instanceof Trail){const s=t;this.nodes=s.nodes.slice(0),this.length=s.length,this.uniqueId=s.uniqueId,this.indices=s.indices.slice(0);return}if(this.nodes=[],this.length=0,this.uniqueId="",this.indices=[],t)if(t instanceof Node$2){const s=t;this.addDescendant(s)}else{const s=t.length;for(let r=0;r<s;r++)this.addDescendant(t[r])}}copy(){return new Trail(this)}isPainted(){return this.lastNode().isPainted()}isValid(){this.reindex();const t=this.indices.length;for(let s=0;s<t;s++)if(this.indices[s]<0)return!1;return!0}isVisible(){let t=this.nodes.length;for(;t--;)if(!this.nodes[t].isVisible())return!1;return!0}isPDOMVisible(){let t=this.nodes.length;for(;t--;)if(!this.nodes[t].isVisible()||!this.nodes[t].isPDOMVisible())return!1;return!0}getOpacity(){let t=1,s=this.nodes.length;for(;s--;)t*=this.nodes[s].getOpacity();return t}isPickable(){return _.some(this.nodes,t=>t.pickable===!1||!t.visible)?!1:!!_.some(this.nodes,t=>t._inputListeners.length>0||t.pickableProperty.value===!0)}get(t){return t>=0?this.nodes[t]:this.nodes[this.nodes.length+t]}slice(t,s){return new Trail(this.nodes.slice(t,s))}subtrailTo(t,s=!1){return this.slice(0,_.indexOf(this.nodes,t)+(s?0:1))}isEmpty(){return this.nodes.length===0}getMatrixConcatenation(t,s){const r=Matrix3.identity(),o=this.nodes;for(let n=t;n<s;n++)r.multiplyMatrix(o[n].getMatrix());return r}getMatrix(){return this.getMatrixConcatenation(0,this.nodes.length)}getAncestorMatrix(){return this.getMatrixConcatenation(1,this.nodes.length)}getParentMatrix(){return this.getMatrixConcatenation(0,this.nodes.length-1)}getAncestorParentMatrix(){return this.getMatrixConcatenation(1,this.nodes.length-1)}getTransform(){return new Transform3(this.getMatrix())}getParentTransform(){return new Transform3(this.getParentMatrix())}addAncestor(t,s){if(assert&&assert(!this.immutable,"cannot modify an immutable Trail with addAncestor"),assert&&assert(t,"cannot add falsy value to a Trail"),this.nodes.length){const r=this.nodes[0];this.indices.unshift(s===void 0?_.indexOf(t._children,r):s)}return this.nodes.unshift(t),this.length++,this.uniqueId=this.uniqueId?t.id+ID_SEPARATOR+this.uniqueId:`${t.id}`,this}removeAncestor(){return assert&&assert(!this.immutable,"cannot modify an immutable Trail with removeAncestor"),assert&&assert(this.length>0,"cannot remove a Node from an empty trail"),this.nodes.shift(),this.indices.length&&this.indices.shift(),this.length--,this.updateUniqueId(),this}addDescendant(t,s){if(assert&&assert(!this.immutable,"cannot modify an immutable Trail with addDescendant"),assert&&assert(t,"cannot add falsy value to a Trail"),this.nodes.length){const r=this.lastNode();this.indices.push(s===void 0?_.indexOf(r._children,t):s)}return this.nodes.push(t),this.length++,this.uniqueId=this.uniqueId?this.uniqueId+ID_SEPARATOR+t.id:`${t.id}`,this}removeDescendant(){return assert&&assert(!this.immutable,"cannot modify an immutable Trail with removeDescendant"),assert&&assert(this.length>0,"cannot remove a Node from an empty trail"),this.nodes.pop(),this.indices.length&&this.indices.pop(),this.length--,this.updateUniqueId(),this}addDescendantTrail(t){const s=t.length;s&&this.addDescendant(t.nodes[0]);for(let r=1;r<s;r++)this.addDescendant(t.nodes[r],this.indices[r-1])}removeDescendantTrail(t){const s=t.length;for(let r=s-1;r>=0;r--)assert&&assert(this.lastNode()===t.nodes[r]),this.removeDescendant()}reindex(){const t=this.length;for(let s=1;s<t;s++){const r=this.indices[s-1],o=this.nodes[s-1];o._children[r]!==this.nodes[s]&&(this.indices[s-1]=_.indexOf(o._children,this.nodes[s]))}}setImmutable(){return assert&&(assert(this.immutable!==!1,"A trail cannot be made immutable after being flagged as mutable"),this.immutable=!0),this}setMutable(){return assert&&(assert(this.immutable!==!0,"A trail cannot be made mutable after being flagged as immutable"),this.immutable=!1),this}areIndicesValid(){for(let t=1;t<this.length;t++){const s=this.indices[t-1];if(this.nodes[t-1]._children[s]!==this.nodes[t])return!1}return!0}equals(t){if(this.length!==t.length)return!1;for(let s=0;s<this.nodes.length;s++)if(this.nodes[s]!==t.nodes[s])return!1;return!0}upToNode(t){const s=_.indexOf(this.nodes,t);return assert&&assert(s>=0,"Trail does not contain the node"),this.slice(0,_.indexOf(this.nodes,t)+1)}isExtensionOf(t,s){if(this.length<=t.length-(s?1:0))return!1;for(let r=0;r<t.nodes.length;r++)if(this.nodes[r]!==t.nodes[r])return!1;return!0}containsNode(t){return _.includes(this.nodes,t)}getTransformTo(t){return new Transform3(this.getMatrixTo(t))}getMatrixTo(t){this.reindex(),t.reindex();const s=this.getBranchIndexTo(t);let r,o=Matrix3.IDENTITY;for(r=this.length-1;r>=s;r--)o=this.nodes[r].getMatrix().timesMatrix(o);for(r=s;r<t.length;r++)o=t.nodes[r].getTransform().getInverse().timesMatrix(o);return o}getBranchIndexTo(t){assert&&assert(this.nodes[0]===t.nodes[0],"To get a branch index, the trails must have the same root");let s;const r=Math.min(this.length,t.length);for(s=0;s<r&&this.nodes[s]===t.nodes[s];s++);return s}getLastInputEnabledIndex(){let t=-1;for(let s=0;s<this.length&&this.nodes[s].inputEnabled;s++)t=s;return t}getCursorCheckIndex(){return this.getLastInputEnabledIndex()}nodeFromTop(t){return this.nodes[this.length-1-t]}lastNode(){return this.nodeFromTop(0)}rootNode(){return this.nodes[0]}previous(){if(this.nodes.length<=1)return null;const t=this.nodeFromTop(0),s=this.nodeFromTop(1),r=_.indexOf(s._children,t);assert&&assert(r!==-1);const o=this.nodes.slice(0,this.nodes.length-1);if(r===0)return new Trail(o);for(o.push(s._children[r-1]);o[o.length-1]._children.length!==0;){const n=o[o.length-1];o.push(n._children[n._children.length-1])}return new Trail(o)}previousPainted(){let t=this.previous();for(;t&&!t.isPainted();)t=t.previous();return t}next(){const t=this.nodes.slice(0),s=this.nodeFromTop(0);if(s._children.length>0)return t.push(s._children[0]),new Trail(t);{let r=this.nodes.length-1;for(;r>0;){const o=this.nodes[r],n=this.nodes[r-1];t.pop();const l=_.indexOf(n._children,o);if(l!==n._children.length-1)return t.push(n._children[l+1]),new Trail(t);r--}return null}}nextPainted(){let t=this.next();for(;t&&!t.isPainted();)t=t.next();return t}eachTrailUnder(t){new TrailPointer(this,!0).eachTrailBetween(new TrailPointer(this,!1),t)}compare(t){assert&&assert(!this.isEmpty(),"cannot compare with an empty trail"),assert&&assert(!t.isEmpty(),"cannot compare with an empty trail"),assert&&assert(this.nodes[0]===t.nodes[0],"for Trail comparison, trails must have the same root node"),assertSlow&&assertSlow(this.areIndicesValid(),`Trail.compare this.areIndicesValid() failed on ${this.toString()}`),assertSlow&&assertSlow(t.areIndicesValid(),`Trail.compare other.areIndicesValid() failed on ${t.toString()}`);const s=Math.min(this.nodes.length,t.nodes.length);for(let r=0;r<s;r++)if(this.nodes[r]!==t.nodes[r])return this.nodes[r-1].children.indexOf(this.nodes[r])<t.nodes[r-1].children.indexOf(t.nodes[r])?-1:1;return this.nodes.length<t.nodes.length?-1:this.nodes.length>t.nodes.length?1:0}isBefore(t){return this.compare(t)===-1}isAfter(t){return this.compare(t)===1}localToGlobalPoint(t){return this.getMatrix().timesVector2(t)}localToGlobalBounds(t){return t.transformed(this.getMatrix())}globalToLocalPoint(t){return this.getTransform().inversePosition2(t)}globalToLocalBounds(t){return this.getTransform().inverseBounds2(t)}parentToGlobalPoint(t){return this.getParentMatrix().timesVector2(t)}parentToGlobalBounds(t){return t.transformed(this.getParentMatrix())}globalToParentPoint(t){return this.getParentTransform().inversePosition2(t)}globalToParentBounds(t){return this.getParentTransform().inverseBounds2(t)}updateUniqueId(){let t="";const s=this.nodes.length;s>0&&(t+=this.nodes[0]._id);for(let r=1;r<s;r++)t+=ID_SEPARATOR+this.nodes[r]._id;this.uniqueId=t}getUniqueId(){if(assert){const t=this.uniqueId;this.updateUniqueId(),assert(t===this.uniqueId)}return this.uniqueId}toString(){return this.reindex(),this.length?`[Trail ${this.indices.join(".")} ${this.getUniqueId()}]`:"Empty Trail"}toPathString(){return _.map(this.nodes,t=>{let s=t.constructor.name;return s==="Node"&&(s="."),s}).join("/")}toDebugString(){return`${this.toString()} ${this.toPathString()}`}static eachPaintedTrailBetween(t,s,r,o,n){Trail.eachTrailBetween(t,s,l=>l.isPainted()?r(l):!1,o,n)}static eachTrailBetween(t,s,r,o,n){const l=t?new TrailPointer(t.copy(),!0):new TrailPointer(new Trail(n),!0),h=s?new TrailPointer(s.copy(),!0):new TrailPointer(new Trail(n),!1);o&&(l.nestedForwards(),h.nestedBackwards(),l.compareNested(h)===1)||l.depthFirstUntil(h,g=>g.isBefore?r(g.trail):!1,!1)}static branchIndex(t,s){assert&&assert(t.nodes[0]===s.nodes[0],"Branch changes require roots to be the same");let r;const o=Math.min(t.length,s.length);for(r=0;r<o&&t.nodes[r]===s.nodes[r];r++);return r}static sharedTrail(t,s){return t.slice(0,Trail.branchIndex(t,s))}static appendAncestorTrailsWithPredicate(t,s,r){const o=s.rootNode();r(o)&&t.push(s.copy());const n=o._parents.length;for(let l=0;l<n;l++){const h=o._parents[l];s.addAncestor(h),Trail.appendAncestorTrailsWithPredicate(t,s,r),s.removeAncestor()}}static appendDescendantTrailsWithPredicate(t,s,r){const o=s.lastNode();r(o)&&t.push(s.copy());const n=o._children.length;for(let l=0;l<n;l++){const h=o._children[l];s.addDescendant(h,l),Trail.appendDescendantTrailsWithPredicate(t,s,r),s.removeDescendant()}}static spannedSubtrees(t,s){}static fromUniqueId(t,s){const o=s.split(ID_SEPARATOR).map(g=>Number(g));let n=t;const l=o.shift(),h=[n];for(assert&&assert(l===t.id);o.length>0;){const g=o.shift(),A=(n.pdomOrder||[]).concat(n.children);for(let S=0;S<A.length;S++){if(A[S]!==null&&A[S].id===g){const O=A[S];h.push(O),n=O;break}assert&&assert(S!==A.length-1,"unable to find node from unique Trail id")}}return new Trail(h)}}scenery.register("Trail",Trail);class TrailPointer{constructor(t,s){this.trail=t,this.setBefore(s)}isActive(){return!!this.trail}copy(){return assert&&assert(this.isActive()),new TrailPointer(this.trail.copy(),this.isBefore)}setBefore(t){this.isBefore=t,this.isAfter=!t}getRenderSwappedPointer(){assert&&assert(this.isActive());const t=this,s=this.isBefore?t.trail.previous():t.trail.next();return s===null?null:new TrailPointer(s,!this.isBefore)}getRenderBeforePointer(){return this.isBefore?this:this.getRenderSwappedPointer()}getRenderAfterPointer(){return this.isAfter?this:this.getRenderSwappedPointer()}compareRender(t){assert&&assert(t!==null);const s=this.getRenderBeforePointer(),r=t.getRenderBeforePointer();return s!==null&&r!==null?(assert&&assert(s.isActive()&&r.isActive()),s.trail.compare(r.trail)):s===r?0:s===null?1:-1}compareNested(t){assert&&assert(t),assert&&assert(this.isActive()&&t.isActive());const s=this,r=t,o=s.trail.compare(r.trail);return o===0?this.isBefore===t.isBefore?0:this.isBefore?-1:1:s.trail.isExtensionOf(r.trail)?t.isBefore?1:-1:r.trail.isExtensionOf(s.trail)?this.isBefore?-1:1:o}equalsRender(t){return this.compareRender(t)===0}equalsNested(t){return this.compareNested(t)===0}hasTrail(){return!!this.trail}nestedForwards(){assert&&assert(this.isActive());const t=this;if(this.isBefore){const s=t.trail.lastNode()._children;s.length>0?t.trail.addDescendant(s[0],0):this.setBefore(!1)}else{if(t.trail.indices.length===0)return this.trail=null,null;{const s=t.trail.indices[t.trail.indices.length-1];t.trail.removeDescendant();const r=t.trail.lastNode()._children;r.length>s+1&&(t.trail.addDescendant(r[s+1],s+1),this.setBefore(!0))}}return this}nestedBackwards(){assert&&assert(this.isActive());const t=this;if(this.isBefore){if(t.trail.indices.length===0)return this.trail=null,null;{const s=t.trail.indices[t.trail.indices.length-1];t.trail.removeDescendant(),s-1>=0&&(t.trail.addDescendant(t.trail.lastNode()._children[s-1],s-1),this.setBefore(!1))}}else if(t.trail.lastNode()._children.length>0){const s=t.trail.lastNode()._children;t.trail.addDescendant(s[s.length-1],s.length-1)}else this.setBefore(!0);return this}eachNodeBetween(t,s){this.eachTrailBetween(t,r=>s(r.lastNode()))}eachTrailBetween(t,s){this.isBefore&&(assert&&assert(this.isActive()),s(this.trail)),this.depthFirstUntil(t,r=>r.isBefore?s(r.trail):!1,!0)}depthFirstUntil(t,s,r){assert&&assert(this.isActive()&&t.isActive());const o=this,n=t;assert&&assert(this.compareNested(t)<=(r?-1:0),"TrailPointer.depthFirstUntil pointers out of order, possibly in both meanings of the phrase!"),assert&&assert(o.trail.rootNode()===n.trail.rootNode(),"TrailPointer.depthFirstUntil takes pointers with the same root"),o.trail.reindex(),n.trail.reindex();const l=this.copy();l.trail.setMutable();let h=!0;for(;!l.equalsNested(t);){assert&&assert(l.compareNested(t)!==1,"skipped in depthFirstUntil");let g=!1;if(h?(r||(g=s(l)),h=!1):g=s(l),g&&l.isBefore){if(l.setBefore(!1),l.compareNested(t)===1)break}else l.nestedForwards()}r||s(l)}toString(){return assert&&assert(this.isActive()),`[${this.isBefore?"before":"after"} ${this.trail.toString().slice(1)}`}static compareNested(t,s,r,o){const n=t.compare(r);return n===0?s===o?0:s?-1:1:t.isExtensionOf(r)?o?1:-1:r.isExtensionOf(t)?s?-1:1:n}}scenery.register("TrailPointer",TrailPointer);class AncestorNodesProperty extends TinyProperty{constructor(t){super(new Set),this.node=t,this.listenedNodeSet=new Set,this.updateEmitter=new TinyEmitter,this._nodeUpdateListener=this.update.bind(this),this.addNodeListener(t),this.update()}areValuesEqual(t,s){return t.size===s.size&&_.every([...t],r=>s.has(r))}update(){const t=new Set;(function s(r){r.parents.forEach(n=>{t.add(n),s(n)})})(this.node),t.forEach(s=>{this.listenedNodeSet.has(s)||this.addNodeListener(s)}),this.listenedNodeSet.forEach(s=>{!t.has(s)&&s!==this.node&&this.removeNodeListener(s)}),this.value=t,this.updateEmitter.emit()}addNodeListener(t){this.listenedNodeSet.add(t),t.parentAddedEmitter.addListener(this._nodeUpdateListener),t.parentRemovedEmitter.addListener(this._nodeUpdateListener)}removeNodeListener(t){this.listenedNodeSet.delete(t),t.parentAddedEmitter.removeListener(this._nodeUpdateListener),t.parentRemovedEmitter.removeListener(this._nodeUpdateListener)}dispose(){this.listenedNodeSet.forEach(t=>this.removeNodeListener(t)),super.dispose()}}scenery.register("AncestorNodesProperty",AncestorNodesProperty);class TrailsBetweenProperty extends TinyProperty{constructor(t,s){super([]),this.listenedNodeSet=new Set,this.rootNode=t,this.leafNode=s,this._trailUpdateListener=this.update.bind(this),this.update()}update(){const t=[],s=new Set,r=new Trail(this.leafNode),o=this.rootNode;(function h(){const g=r.rootNode();s.add(g),g===o&&t.push(r.copy()),g.parents.forEach(d=>{r.addAncestor(d),h(),r.removeAncestor()})})(),s.forEach(h=>{this.listenedNodeSet.has(h)||this.addNodeListener(h)}),this.listenedNodeSet.forEach(h=>{s.has(h)||this.removeNodeListener(h)});const n=this.value;let l=n.length===t.length;if(l){for(let h=0;h<t.length;h++)if(!n[h].equals(t[h])){l=!1;break}}l||(this.value=t)}addNodeListener(t){this.listenedNodeSet.add(t),t.parentAddedEmitter.addListener(this._trailUpdateListener),t.parentRemovedEmitter.addListener(this._trailUpdateListener)}removeNodeListener(t){this.listenedNodeSet.delete(t),t.parentAddedEmitter.removeListener(this._trailUpdateListener),t.parentRemovedEmitter.removeListener(this._trailUpdateListener)}dispose(){this.listenedNodeSet.forEach(t=>this.removeNodeListener(t)),super.dispose()}}scenery.register("TrailsBetweenProperty",TrailsBetweenProperty);class MatrixBetweenProperty extends TinyProperty{constructor(t,s,r){const o=optionize()({fromCoordinateFrame:"local",toCoordinateFrame:"local"},r);super(Matrix3.IDENTITY),this.from=t,this.to=s,this.rootNode=null,this.fromTrail=null,this.toTrail=null,this.listenedNodeSet=new Set,this.fromCoordinateFrame=o.fromCoordinateFrame,this.toCoordinateFrame=o.toCoordinateFrame,this.useDeepEquality=!0,this.fromAncestorsProperty=new AncestorNodesProperty(t),this.toAncestorsProperty=new AncestorNodesProperty(s);const n=this.update.bind(this);this._nodeTransformListener=this.updateMatrix.bind(this),this.fromAncestorsProperty.updateEmitter.addListener(n),this.toAncestorsProperty.updateEmitter.addListener(n),this.update()}update(){const t=[...this.fromAncestorsProperty.value,this.from],s=[...this.toAncestorsProperty.value,this.to],r=t.filter(h=>s.includes(h));let o=!1;const n=r.filter(h=>{const g=t.filter(Y=>h.hasChild(Y)),d=s.filter(Y=>h.hasChild(Y)),A=[],S=[];arrayDifference(g,d,A,S,[]);const I=g.length>1||d.length>1,W=A.length||S.length;I&&W&&(o=!0);const L=A.length>0||this.from===h,H=S.length>0||this.to===h;return L&&H});!o&&n.length===1?(this.rootNode=n[0],this.fromTrail=this.from.getUniqueTrailTo(this.rootNode),this.toTrail=this.to.getUniqueTrailTo(this.rootNode)):(this.rootNode=null,this.fromTrail=null,this.toTrail=null);const l=new Set;this.fromTrail&&this.fromTrail.nodes.forEach(h=>l.add(h)),this.toTrail&&this.toTrail.nodes.forEach(h=>l.add(h)),l.forEach(h=>{this.listenedNodeSet.has(h)||this.addNodeListener(h)}),this.listenedNodeSet.forEach(h=>{!l.has(h)&&h!==this.from&&h!==this.to&&this.removeNodeListener(h)}),this.updateMatrix()}updateMatrix(){if(this.rootNode&&this.fromTrail&&this.toTrail){const t=this.fromTrail.nodes.length===1,s=this.toTrail.nodes.length===1,r=t&&this.fromCoordinateFrame==="parent"||s&&this.toCoordinateFrame==="parent",o=this.fromTrail.getMatrixConcatenation(r?0:1,this.fromTrail.nodes.length-(this.fromCoordinateFrame==="parent"?1:0)),n=this.toTrail.getMatrixConcatenation(r?0:1,this.toTrail.nodes.length-(this.toCoordinateFrame==="parent"?1:0));this.value=n.inverted().timesMatrix(o)}else this.value=null}addNodeListener(t){this.listenedNodeSet.add(t),t.transformEmitter.addListener(this._nodeTransformListener)}removeNodeListener(t){this.listenedNodeSet.delete(t),t.transformEmitter.removeListener(this._nodeTransformListener)}dispose(){this.fromAncestorsProperty.dispose(),this.toAncestorsProperty.dispose(),super.dispose()}}scenery.register("MatrixBetweenProperty",MatrixBetweenProperty);const isSafari5=platform.safari5,PAINTABLE_OPTION_KEYS=["fill","fillPickable","stroke","strokePickable","lineWidth","lineCap","lineJoin","miterLimit","lineDash","lineDashOffset","cachedPaints"],DEFAULT_OPTIONS$6={fill:null,fillPickable:!0,stroke:null,strokePickable:!1,lineWidth:DEFAULT_OPTIONS$8.lineWidth,lineCap:DEFAULT_OPTIONS$8.lineCap,lineJoin:DEFAULT_OPTIONS$8.lineJoin,lineDashOffset:DEFAULT_OPTIONS$8.lineDashOffset,miterLimit:DEFAULT_OPTIONS$8.miterLimit},PAINTABLE_DRAWABLE_MARK_FLAGS=["fill","stroke","lineWidth","lineOptions","cachedPaints"],Paintable=memoize(a=>(assert&&assert(_.includes(inheritance(a),Node$2),"Only Node subtypes should mix Paintable"),class extends a{constructor(...s){super(...s),assertHasProperties(this,["_drawables"]),this._fill=DEFAULT_OPTIONS$6.fill,this._fillPickable=DEFAULT_OPTIONS$6.fillPickable,this._stroke=DEFAULT_OPTIONS$6.stroke,this._strokePickable=DEFAULT_OPTIONS$6.strokePickable,this._cachedPaints=[],this._lineDrawingStyles=new LineStyles}setFill(s){return assert&&assert(PaintDef.isPaintDef(s),"Invalid fill type"),assert&&typeof s=="string"&&Color.checkPaintString(s),this._fill!==s&&(this._fill=s,this.invalidateFill()),this}set fill(s){this.setFill(s)}get fill(){return this.getFill()}getFill(){return this._fill}hasFill(){return this.getFillValue()!==null}getFillValue(){const s=this.getFill();return isTReadOnlyProperty(s)?s.get():s}get fillValue(){return this.getFillValue()}setStroke(s){if(assert&&assert(PaintDef.isPaintDef(s),"Invalid stroke type"),assert&&typeof s=="string"&&Color.checkPaintString(s),this._stroke!==s){if(this._stroke=s,assert&&s instanceof Paint&&s.transformMatrix){const r=s.transformMatrix.getScaleVector();assert(Math.abs(r.x-r.y)<1e-7,"You cannot specify a pattern or gradient to a stroke that does not have a symmetric scale.")}this.invalidateStroke()}return this}set stroke(s){this.setStroke(s)}get stroke(){return this.getStroke()}getStroke(){return this._stroke}hasStroke(){return this.getStrokeValue()!==null}hasPaintableStroke(){return this.hasStroke()&&this.getLineWidth()>0}getStrokeValue(){const s=this.getStroke();return isTReadOnlyProperty(s)?s.get():s}get strokeValue(){return this.getStrokeValue()}setFillPickable(s){return this._fillPickable!==s&&(this._fillPickable=s,this.invalidateFill()),this}set fillPickable(s){this.setFillPickable(s)}get fillPickable(){return this.isFillPickable()}isFillPickable(){return this._fillPickable}setStrokePickable(s){return this._strokePickable!==s&&(this._strokePickable=s,this.invalidateStroke()),this}set strokePickable(s){this.setStrokePickable(s)}get strokePickable(){return this.isStrokePickable()}isStrokePickable(){return this._strokePickable}setLineWidth(s){if(assert&&assert(s>=0,`lineWidth should be non-negative instead of ${s}`),this.getLineWidth()!==s){this._lineDrawingStyles.lineWidth=s,this.invalidateStroke();const r=this._drawables.length;for(let o=0;o<r;o++)this._drawables[o].markDirtyLineWidth()}return this}set lineWidth(s){this.setLineWidth(s)}get lineWidth(){return this.getLineWidth()}getLineWidth(){return this._lineDrawingStyles.lineWidth}setLineCap(s){if(assert&&assert(s==="butt"||s==="round"||s==="square",`lineCap should be one of "butt", "round" or "square", not ${s}`),this._lineDrawingStyles.lineCap!==s){this._lineDrawingStyles.lineCap=s,this.invalidateStroke();const r=this._drawables.length;for(let o=0;o<r;o++)this._drawables[o].markDirtyLineOptions()}return this}set lineCap(s){this.setLineCap(s)}get lineCap(){return this.getLineCap()}getLineCap(){return this._lineDrawingStyles.lineCap}setLineJoin(s){if(assert&&assert(s==="miter"||s==="round"||s==="bevel",`lineJoin should be one of "miter", "round" or "bevel", not ${s}`),this._lineDrawingStyles.lineJoin!==s){this._lineDrawingStyles.lineJoin=s,this.invalidateStroke();const r=this._drawables.length;for(let o=0;o<r;o++)this._drawables[o].markDirtyLineOptions()}return this}set lineJoin(s){this.setLineJoin(s)}get lineJoin(){return this.getLineJoin()}getLineJoin(){return this._lineDrawingStyles.lineJoin}setMiterLimit(s){if(assert&&assert(isFinite(s),"miterLimit should be a finite number"),this._lineDrawingStyles.miterLimit!==s){this._lineDrawingStyles.miterLimit=s,this.invalidateStroke();const r=this._drawables.length;for(let o=0;o<r;o++)this._drawables[o].markDirtyLineOptions()}return this}set miterLimit(s){this.setMiterLimit(s)}get miterLimit(){return this.getMiterLimit()}getMiterLimit(){return this._lineDrawingStyles.miterLimit}setLineDash(s){if(assert&&assert(Array.isArray(s)&&s.every(r=>typeof r=="number"&&isFinite(r)&&r>=0),"lineDash should be an array of finite non-negative numbers"),this._lineDrawingStyles.lineDash!==s){this._lineDrawingStyles.lineDash=s||[],this.invalidateStroke();const r=this._drawables.length;for(let o=0;o<r;o++)this._drawables[o].markDirtyLineOptions()}return this}set lineDash(s){this.setLineDash(s)}get lineDash(){return this.getLineDash()}getLineDash(){return this._lineDrawingStyles.lineDash}hasLineDash(){return!!this._lineDrawingStyles.lineDash.length}setLineDashOffset(s){if(assert&&assert(isFinite(s),`lineDashOffset should be a number, not ${s}`),this._lineDrawingStyles.lineDashOffset!==s){this._lineDrawingStyles.lineDashOffset=s,this.invalidateStroke();const r=this._drawables.length;for(let o=0;o<r;o++)this._drawables[o].markDirtyLineOptions()}return this}set lineDashOffset(s){this.setLineDashOffset(s)}get lineDashOffset(){return this.getLineDashOffset()}getLineDashOffset(){return this._lineDrawingStyles.lineDashOffset}setLineStyles(s){return this._lineDrawingStyles=s,this.invalidateStroke(),this}set lineStyles(s){this.setLineStyles(s)}get lineStyles(){return this.getLineStyles()}getLineStyles(){return this._lineDrawingStyles}setCachedPaints(s){this._cachedPaints=s.filter(o=>o instanceof Paint);const r=this._drawables.length;for(let o=0;o<r;o++)this._drawables[o].markDirtyCachedPaints();return this}set cachedPaints(s){this.setCachedPaints(s)}get cachedPaints(){return this.getCachedPaints()}getCachedPaints(){return this._cachedPaints}addCachedPaint(s){if(s instanceof Paint){this._cachedPaints.push(s);const r=this._drawables.length;for(let o=0;o<r;o++)this._drawables[o].markDirtyCachedPaints()}}removeCachedPaint(s){if(s instanceof Paint){assert&&assert(_.includes(this._cachedPaints,s)),arrayRemove(this._cachedPaints,s);const r=this._drawables.length;for(let o=0;o<r;o++)this._drawables[o].markDirtyCachedPaints()}}beforeCanvasFill(s){assert&&assert(this.getFillValue()!==null);const r=this.getFillValue();s.setFillStyle(r),r.transformMatrix&&(s.context.save(),r.transformMatrix.canvasAppendTransform(s.context))}afterCanvasFill(s){this.getFillValue().transformMatrix&&s.context.restore()}beforeCanvasStroke(s){const r=this.getStrokeValue();if(s.setStrokeStyle(this._stroke),s.setLineCap(this.getLineCap()),s.setLineJoin(this.getLineJoin()),r.transformMatrix){const o=r.transformMatrix.getScaleVector();assert&&assert(Math.abs(o.x-o.y)<1e-7,"You cannot specify a pattern or gradient to a stroke that does not have a symmetric scale.");const n=1/o.x;s.context.save(),r.transformMatrix.canvasAppendTransform(s.context),s.setLineWidth(this.getLineWidth()*n),s.setMiterLimit(this.getMiterLimit()*n),s.setLineDash(this.getLineDash().map(l=>l*n)),s.setLineDashOffset(this.getLineDashOffset()*n)}else s.setLineWidth(this.getLineWidth()),s.setMiterLimit(this.getMiterLimit()),s.setLineDash(this.getLineDash()),s.setLineDashOffset(this.getLineDashOffset())}afterCanvasStroke(s){this.getStrokeValue().transformMatrix&&s.context.restore()}getCSSFill(){const s=this.getFillValue();return s?s.toCSS?s.toCSS():s:"transparent"}getSimpleCSSStroke(){const s=this.getStrokeValue();return s?s.toCSS?s.toCSS():s:"transparent"}appendFillablePropString(s,r){return this._fill&&(r&&(r+=`,
`),typeof this.getFillValue()=="string"?r+=`${s}fill: '${this.getFillValue()}'`:r+=`${s}fill: ${this.getFillValue()}`),r}appendStrokablePropString(s,r){function o(n,l,h){r&&(r+=`,
`),!h&&typeof l=="string"?r+=`${s+n}: '${l}'`:r+=`${s+n}: ${l}`}if(this._stroke){const n=new LineStyles,l=this.getStrokeValue();typeof l=="string"?o("stroke",l):o("stroke",l?l.toString():"null",!0),_.each(["lineWidth","lineCap","miterLimit","lineJoin","lineDashOffset"],h=>{this[h]!==n[h]&&o(h,this[h])}),this.lineDash.length&&o("lineDash",JSON.stringify(this.lineDash),!0)}return r}getFillRendererBitmask(){let s=0;return isSafari5&&this._fill instanceof Gradient||(s|=Renderer.bitmaskSVG),s|=Renderer.bitmaskCanvas,this.hasFill()&&(this._fill instanceof Pattern||this._fill instanceof Gradient)||(s|=Renderer.bitmaskDOM,s|=Renderer.bitmaskWebGL),s}getStrokeRendererBitmask(){let s=0;return s|=Renderer.bitmaskCanvas,s|=Renderer.bitmaskSVG,this.hasStroke()||(s|=Renderer.bitmaskDOM,s|=Renderer.bitmaskWebGL),s}invalidateFill(){this.invalidateSupportedRenderers();const s=this._drawables.length;for(let r=0;r<s;r++)this._drawables[r].markDirtyFill()}invalidateStroke(){this.invalidateSupportedRenderers();const s=this._drawables.length;for(let r=0;r<s;r++)this._drawables[r].markDirtyStroke()}}));scenery.register("Paintable",Paintable);Paintable.DEFAULT_OPTIONS=DEFAULT_OPTIONS$6;const log2=Math.log2||function(a){return Math.log(a)/Math.LN2},DEFAULT_OPTIONS$5={imageOpacity:1,initialWidth:0,initialHeight:0,mipmap:!1,mipmapBias:0,mipmapInitialLevel:4,mipmapMaxLevel:5,hitTestPixels:!1};let scratchCanvas=null,scratchContext=null;const getScratchCanvas=()=>(scratchCanvas||(scratchCanvas=document.createElement("canvas")),scratchCanvas),getScratchContext=()=>(scratchContext||(scratchContext=getScratchCanvas().getContext("2d",{willReadFrequently:!0})),scratchContext),Imageable=a=>class extends a{constructor(...s){super(...s),this._imageProperty=new TinyForwardingProperty(null,!1,this.onImagePropertyChange.bind(this)),this._image=null,this._initialWidth=DEFAULT_OPTIONS$5.initialWidth,this._initialHeight=DEFAULT_OPTIONS$5.initialHeight,this._imageOpacity=DEFAULT_OPTIONS$5.imageOpacity,this._mipmap=DEFAULT_OPTIONS$5.mipmap,this._mipmapBias=DEFAULT_OPTIONS$5.mipmapBias,this._mipmapInitialLevel=DEFAULT_OPTIONS$5.mipmapInitialLevel,this._mipmapMaxLevel=DEFAULT_OPTIONS$5.mipmapMaxLevel,this._hitTestPixels=DEFAULT_OPTIONS$5.hitTestPixels,this._mipmapCanvases=[],this._mipmapURLs=[],this._mipmapData=null,this._imageLoadListener=this._onImageLoad.bind(this),this._imageLoadListenerAttached=!1,this._hitTestImageData=null,this.mipmapEmitter=new TinyEmitter}setImage(s){return assert&&assert(s,"image should be available"),this._imageProperty.value=s,this}set image(s){this.setImage(s)}get image(){return this.getImage()}getImage(){return assert&&assert(this._image!==null),this._image}onImagePropertyChange(s){assert&&assert(s,"image should be available");let r=this._image!==s;if(r&&typeof s=="string"&&this._image&&this._image instanceof HTMLImageElement&&s===this._image.src&&(r=!1),r&&s===this._mipmapData&&(r=!1),r){if(this._initialWidth=0,this._initialHeight=0,this._image&&this._imageLoadListenerAttached&&this._detachImageLoadListener(),this._mipmapData=null,typeof s=="string"){const o=s;s=document.createElement("img"),s.src=o}else Array.isArray(s)&&(this._mipmapData=s,s=s[0].img,this._mipmapInitialLevel=this._mipmapMaxLevel=this._mipmapData.length,this._mipmap=!0);this._image=s,this._image instanceof HTMLImageElement&&(!this._image.width||!this._image.height)&&this._attachImageLoadListener(),this.invalidateImage()}}setImageProperty(s){return this._imageProperty.setTargetProperty(s)}set imageProperty(s){this.setImageProperty(s)}get imageProperty(){return this.getImageProperty()}getImageProperty(){return this._imageProperty}invalidateImage(){this.invalidateMipmaps(),this._invalidateHitTestData()}setImageWithSize(s,r,o){return this.setImage(s),this.setInitialWidth(r),this.setInitialHeight(o),this}setImageOpacity(s){assert&&assert(isFinite(s)&&s>=0&&s<=1,`imageOpacity out of range: ${s}`),this._imageOpacity!==s&&(this._imageOpacity=s)}set imageOpacity(s){this.setImageOpacity(s)}get imageOpacity(){return this.getImageOpacity()}getImageOpacity(){return this._imageOpacity}setInitialWidth(s){return assert&&assert(s>=0&&s%1===0,"initialWidth should be a non-negative integer"),s!==this._initialWidth&&(this._initialWidth=s,this.invalidateImage()),this}set initialWidth(s){this.setInitialWidth(s)}get initialWidth(){return this.getInitialWidth()}getInitialWidth(){return this._initialWidth}setInitialHeight(s){return assert&&assert(s>=0&&s%1===0,"initialHeight should be a non-negative integer"),s!==this._initialHeight&&(this._initialHeight=s,this.invalidateImage()),this}set initialHeight(s){this.setInitialHeight(s)}get initialHeight(){return this.getInitialHeight()}getInitialHeight(){return this._initialHeight}setMipmap(s){return this._mipmap!==s&&(this._mipmap=s,this.invalidateMipmaps()),this}set mipmap(s){this.setMipmap(s)}get mipmap(){return this.isMipmap()}isMipmap(){return this._mipmap}setMipmapBias(s){return this._mipmapBias!==s&&(this._mipmapBias=s,this.invalidateMipmaps()),this}set mipmapBias(s){this.setMipmapBias(s)}get mipmapBias(){return this.getMipmapBias()}getMipmapBias(){return this._mipmapBias}setMipmapInitialLevel(s){return assert&&assert(s%1===0&&s>=0,"mipmapInitialLevel should be a non-negative integer"),this._mipmapInitialLevel!==s&&(this._mipmapInitialLevel=s,this.invalidateMipmaps()),this}set mipmapInitialLevel(s){this.setMipmapInitialLevel(s)}get mipmapInitialLevel(){return this.getMipmapInitialLevel()}getMipmapInitialLevel(){return this._mipmapInitialLevel}setMipmapMaxLevel(s){return assert&&assert(s%1===0&&s>=0,"mipmapMaxLevel should be a non-negative integer"),this._mipmapMaxLevel!==s&&(this._mipmapMaxLevel=s,this.invalidateMipmaps()),this}set mipmapMaxLevel(s){this.setMipmapMaxLevel(s)}get mipmapMaxLevel(){return this.getMipmapMaxLevel()}getMipmapMaxLevel(){return this._mipmapMaxLevel}setHitTestPixels(s){return this._hitTestPixels!==s&&(this._hitTestPixels=s,this._invalidateHitTestData()),this}set hitTestPixels(s){this.setHitTestPixels(s)}get hitTestPixels(){return this.getHitTestPixels()}getHitTestPixels(){return this._hitTestPixels}_constructNextMipmap(){const s=this._mipmapCanvases.length,r=this._mipmapCanvases[s-1];if(r.width*r.height>2){const o=document.createElement("canvas");if(o.width=Math.ceil(r.width/2),o.height=Math.ceil(r.height/2),o.width>0&&o.height>0){const n=o.getContext("2d");n.scale(.5,.5),n.drawImage(r,0,0),this._mipmapCanvases.push(o),this._mipmapURLs.push(o.toDataURL())}}}invalidateMipmaps(){if(cleanArray(this._mipmapCanvases),cleanArray(this._mipmapURLs),this._image&&this._mipmap)if(this._mipmapData)for(let s=0;s<this._mipmapData.length;s++){const r=this._mipmapData[s].url;this._mipmapURLs.push(r);const o=this._mipmapData[s].updateCanvas;o&&o(),this._mipmapCanvases.push(this._mipmapData[s].canvas)}else{const s=document.createElement("canvas");if(s.width=this.getImageWidth(),s.height=this.getImageHeight(),s.width&&s.height){s.getContext("2d").drawImage(this._image,0,0),this._mipmapCanvases.push(s),this._mipmapURLs.push(s.toDataURL());let o=0;for(;++o<this._mipmapInitialLevel;)this._constructNextMipmap()}}this.mipmapEmitter.emit()}getMipmapLevel(s,r=0){assert&&assert(this._mipmap,"Assumes mipmaps can be used");const o=Imageable.getApproximateMatrixScale(s)*(window.devicePixelRatio||1);return this.getMipmapLevelFromScale(o,r)}getMipmapLevelFromScale(s,r=0){if(assert&&assert(s>0,"scale should be a positive number"),s>=1)return 0;let o=log2(1/s);if(o=DotUtils.roundSymmetric(o+this._mipmapBias+r-.7),o<0&&(o=0),o>this._mipmapMaxLevel&&(o=this._mipmapMaxLevel),this.mipmap&&!this._mipmapCanvases[o]){let n=this._mipmapCanvases.length-1;for(;++n<=o;)this._constructNextMipmap();return Math.min(o,this._mipmapCanvases.length-1)}else return o}getMipmapCanvas(s){if(assert&&assert(s>=0&&s<this._mipmapCanvases.length&&s%1===0),this._mipmapData){const r=this._mipmapData[s]&&this._mipmapData[s].updateCanvas;r&&r()}return this._mipmapCanvases[s]}getMipmapURL(s){return assert&&assert(s>=0&&s<this._mipmapCanvases.length&&s%1===0),this._mipmapURLs[s]}hasMipmaps(){return this._mipmapCanvases.length>0}_invalidateHitTestData(){this._hitTestPixels&&this._image!==null&&(this._hitTestImageData=Imageable.getHitTestData(this._image,this.imageWidth,this.imageHeight))}getImageWidth(){if(this._image===null)return 0;const s=this._mipmapData?this._mipmapData[0].width:("naturalWidth"in this._image?this._image.naturalWidth:0)||this._image.width;return s===0?this._initialWidth:(assert&&assert(this._initialWidth===0||this._initialWidth===s,"Bad Image.initialWidth"),s)}get imageWidth(){return this.getImageWidth()}getImageHeight(){if(this._image===null)return 0;const s=this._mipmapData?this._mipmapData[0].height:("naturalHeight"in this._image?this._image.naturalHeight:0)||this._image.height;return s===0?this._initialHeight:(assert&&assert(this._initialHeight===0||this._initialHeight===s,"Bad Image.initialHeight"),s)}get imageHeight(){return this.getImageHeight()}getImageURL(){return assert&&assert(this._image instanceof HTMLImageElement,"Only supported for HTML image elements"),this._image.src}_attachImageLoadListener(){assert&&assert(!this._imageLoadListenerAttached,"Should only be attached to one thing at a time"),this.isDisposed||(this._image.addEventListener("load",this._imageLoadListener),this._imageLoadListenerAttached=!0)}_detachImageLoadListener(){assert&&assert(this._imageLoadListenerAttached,"Needs to be attached first to be detached."),this._image.removeEventListener("load",this._imageLoadListener),this._imageLoadListenerAttached=!1}_onImageLoad(){assert&&assert(this._imageLoadListenerAttached,"If _onImageLoad is firing, it should be attached"),this.invalidateImage(),this._detachImageLoadListener()}dispose(){this._image&&this._imageLoadListenerAttached&&this._detachImageLoadListener(),this._imageProperty.dispose(),super.dispose&&super.dispose()}};Imageable.getHitTestData=(a,t,s)=>{if(!("naturalWidth"in a&&a.naturalWidth||a.width)||!("naturalHeight"in a&&a.naturalHeight||a.height))return null;const r=getScratchCanvas(),o=getScratchContext();return r.width=t,r.height=s,o.drawImage(a,0,0),o.getImageData(0,0,t,s)};Imageable.testHitTestData=(a,t,s,r)=>{const o=DotUtils.clamp(Math.floor(r.x/t*a.width),0,a.width-1),n=DotUtils.clamp(Math.floor(r.y/s*a.height),0,a.height-1),l=4*(o+n*a.width)+3;return a.data[l]!==0};Imageable.hitTestDataToShape=(a,t,s)=>{const r=t/a.width,o=s/a.height,n=new Shape$1;let l=!1,h=0;for(let g=0;g<a.height;g++){for(let d=0;d<a.width;d++){const A=4*(d+g*a.width)+3;a.data[A]!==0?l||(l=!0,h=d):l&&(l=!1,n.rect(h*r,g*r,r*(d-h),o))}l&&(l=!1,n.rect(h*r,g*r,r*(a.width-h),o))}return n.getSimplifiedAreaShape()};Imageable.createSVGImage=(a,t,s)=>{assert&&assert(isFinite(t)&&t>=0&&t%1===0,"width should be a non-negative finite integer"),assert&&assert(isFinite(s)&&s>=0&&s%1===0,"height should be a non-negative finite integer");const r=document.createElementNS(svgns,"image");return r.setAttribute("x","0"),r.setAttribute("y","0"),r.setAttribute("width",`${t}px`),r.setAttribute("height",`${s}px`),r.setAttributeNS(xlinkns,"xlink:href",a),r};Imageable.createFastMipmapFromCanvas=a=>{const t=[],s=a.toDataURL(),r=new window.Image;r.src=s,t.push({img:r,url:s,width:a.width,height:a.height,canvas:a});let o=a;for(;o.width>=2&&o.height>=2;){const n=document.createElement("canvas");n.width=Math.ceil(o.width/2),n.height=Math.ceil(o.height/2);const l=n.getContext("2d");l.setTransform(.5,0,0,.5,0,0),l.drawImage(o,0,0);const h={width:n.width,height:n.height,canvas:n,url:n.toDataURL(),img:new window.Image};h.img.src=h.url,o=n,t.push(h)}return t};Imageable.getApproximateMatrixScale=a=>(Math.sqrt(a.m00()*a.m00()+a.m10()*a.m10())+Math.sqrt(a.m01()*a.m01()+a.m11()*a.m11()))/2;Imageable.CANVAS_MIPMAP_BIAS_ADJUSTMENT=.5;Imageable.DEFAULT_OPTIONS=DEFAULT_OPTIONS$5;scenery.register("Imageable",Imageable);const Imageable$1=Imageable,DelayedMutate=(a,t,s)=>{const r=`_${a}PendingOptions`,o=`_${a}IsConstructed`;return class extends s{constructor(...l){super(...l),this[o]=!0,this.mutate(this[r]),this[r]=void 0}mutate(l){return l&&!this[o]&&(this[r]=combineOptions(this[r]||{},_.pick(l,t)),l=_.omit(l,t)),super.mutate(l)}}};scenery.register("DelayedMutate",DelayedMutate);const DelayedMutate$1=DelayedMutate,IMAGE_OPTION_KEYS=["image","imageProperty","imageOpacity","imageBounds","initialWidth","initialHeight","mipmap","mipmapBias","mipmapInitialLevel","mipmapMaxLevel","hitTestPixels"];var rh;let Image$1=(rh=class extends Imageable$1(Node$2){constructor(t,s){const r={};isTReadOnlyProperty(t)?r.imageProperty=t:r.image=t;const o=optionize()(r,s);super(),this._imageBounds=null,this.mutate(o),this.invalidateSupportedRenderers()}invalidateImage(){this._image?this.invalidateSelf(this._imageBounds||new Bounds2(0,0,this.getImageWidth(),this.getImageHeight())):this.invalidateSelf(Bounds2.NOTHING);const t=this._drawables.length;for(let s=0;s<t;s++)this._drawables[s].markDirtyImage();super.invalidateImage(),this.invalidateSupportedRenderers()}invalidateSupportedRenderers(){let t=Renderer.bitmaskCanvas;this.getImageWidth()<=SpriteSheet.MAX_DIMENSION.width&&this.getImageHeight()<=SpriteSheet.MAX_DIMENSION.height&&(t|=Renderer.bitmaskWebGL),this._image instanceof HTMLCanvasElement||(t|=Renderer.bitmaskSVG|Renderer.bitmaskDOM),this.setRendererBitmask(t)}setImageOpacity(t){const s=this._imageOpacity!==t;if(super.setImageOpacity(t),s){const r=this._drawables.length;for(let o=0;o<r;o++)this._drawables[o].markDirtyImageOpacity()}}setImageBounds(t){this._imageBounds!==t&&(this._imageBounds=t,this.invalidateImage())}set imageBounds(t){this.setImageBounds(t)}get imageBounds(){return this._imageBounds}getImageBounds(){return this._imageBounds}isPainted(){return!0}canvasPaintSelf(t,s){ImageCanvasDrawable$1.prototype.paintCanvas(t,this,s)}createDOMDrawable(t,s){return ImageDOMDrawable$1.createFromPool(t,s)}createSVGDrawable(t,s){return ImageSVGDrawable$1.createFromPool(t,s)}createCanvasDrawable(t,s){return ImageCanvasDrawable$1.createFromPool(t,s)}createWebGLDrawable(t,s){return ImageWebGLDrawable$1.createFromPool(t,s)}containsPointSelf(t){const s=Node$2.prototype.containsPointSelf.call(this,t);return!s||!this._hitTestPixels||!this._hitTestImageData?s:Imageable$1.testHitTestData(this._hitTestImageData,this.imageWidth,this.imageHeight,t)}getSelfShape(){return this._hitTestPixels&&this._hitTestImageData?Imageable$1.hitTestDataToShape(this._hitTestImageData,this.imageWidth,this.imageHeight):Node$2.prototype.getSelfShape.call(this)}invalidateMipmaps(){const t=this._image&&this._mipmap&&!this._mipmapData;if(super.invalidateMipmaps(),t){const s=this._drawables.length;for(let r=0;r<s;r++)this._drawables[r].markDirtyMipmap()}}mutate(t){return super.mutate(t)}},rh.DEFAULT_IMAGE_OPTIONS=combineOptions({},Node$2.DEFAULT_NODE_OPTIONS,Imageable$1.DEFAULT_OPTIONS),rh);Image$1.prototype._mutatorKeys=[...IMAGE_OPTION_KEYS,...Node$2.prototype._mutatorKeys];Image$1.prototype.drawableMarkFlags=[...Node$2.prototype.drawableMarkFlags,"image","imageOpacity","mipmap"];Image$1.ImageIO=new IOType("ImageIO",{valueType:Image$1,supertype:Node$2.NodeIO,events:["changed"],methods:{setImage:{returnType:VoidIO,parameterTypes:[StringIO],implementation:function(a){const t=new window.Image;t.src=a,this.image=t},documentation:"Set the image from a base64 string",invocableForReadOnlyElements:!1}}});scenery.register("Image",Image$1);const PATH_OPTION_KEYS=["boundsMethod","shape","shapeProperty"],DEFAULT_OPTIONS$4={shape:null,boundsMethod:"accurate"},Hu=class Hu extends Paintable(Node$2){constructor(t,s){assert&&assert(s===void 0||Object.getPrototypeOf(s)===Object.prototype,"Extra prototype on Node options object is a code smell"),(t||s!=null&&s.shape)&&assert&&assert(!t||!(s!=null&&s.shape),"Do not define shape twice. Check constructor and providedOptions.");const r={boundsMethod:DEFAULT_OPTIONS$4.boundsMethod};isTReadOnlyProperty(t)?r.shapeProperty=t:r.shape=t;const o=optionize()(r,s);super(),this._shapeProperty=new TinyForwardingProperty(null,!1,this.onShapePropertyChange.bind(this)),this._shape=DEFAULT_OPTIONS$4.shape,this._strokedShape=null,this._boundsMethod=DEFAULT_OPTIONS$4.boundsMethod,this._invalidShapeListener=this.invalidateShape.bind(this),this._invalidShapeListenerAttached=!1,this.invalidateSupportedRenderers(),this.mutate(o)}setShape(t){return assert&&assert(t===null||typeof t=="string"||t instanceof Shape$1,"A path's shape should either be null, a string, or a Shape"),this._shapeProperty.value=t,this}set shape(t){this.setShape(t)}get shape(){return this.getShape()}getShape(){return this._shape}onShapePropertyChange(t){assert&&assert(t===null||typeof t=="string"||t instanceof Shape$1,"A path's shape should either be null, a string, or a Shape"),this._shape!==t&&(this._invalidShapeListenerAttached&&this.detachShapeListener(),typeof t=="string"&&(t=new Shape$1(t)),this._shape=t,this.invalidateShape(),this._shape&&!this._shape.isImmutable()&&this.attachShapeListener())}setShapeProperty(t){return this._shapeProperty.setTargetProperty(t)}set shapeProperty(t){this.setShapeProperty(t)}get shapeProperty(){return this.getShapeProperty()}getShapeProperty(){return this._shapeProperty}getStrokedShape(){return assert&&assert(this.hasShape(),"We cannot stroke a non-existing shape"),this._strokedShape||(this._strokedShape=this.getShape().getStrokedShape(this._lineDrawingStyles)),this._strokedShape}getPathRendererBitmask(){return Renderer.bitmaskCanvas|Renderer.bitmaskSVG}invalidateSupportedRenderers(){this.setRendererBitmask(this.getFillRendererBitmask()&this.getStrokeRendererBitmask()&this.getPathRendererBitmask())}invalidateShape(){this.invalidatePath();const t=this._drawables.length;for(let s=0;s<t;s++)this._drawables[s].markDirtyShape();this._invalidShapeListenerAttached&&this._shape&&this._shape.isImmutable()&&this.detachShapeListener()}invalidatePath(){this._strokedShape=null,this.invalidateSelf()}attachShapeListener(){assert&&assert(!this._invalidShapeListenerAttached,"We do not want to have two listeners attached!"),this.isDisposed||(this._shape.invalidatedEmitter.addListener(this._invalidShapeListener),this._invalidShapeListenerAttached=!0)}detachShapeListener(){assert&&assert(this._invalidShapeListenerAttached,"We cannot detach an unattached listener"),this._shape.invalidatedEmitter.removeListener(this._invalidShapeListener),this._invalidShapeListenerAttached=!1}updateSelfBounds(){const t=this.hasShape()?this.computeShapeBounds():Bounds2.NOTHING,s=!t.equals(this.selfBoundsProperty._value);return s&&this.selfBoundsProperty._value.set(t),s}setBoundsMethod(t){return assert&&assert(t==="accurate"||t==="unstroked"||t==="tightPadding"||t==="safePadding"||t==="none"),this._boundsMethod!==t&&(this._boundsMethod=t,this.invalidatePath(),this.rendererSummaryRefreshEmitter.emit()),this}set boundsMethod(t){this.setBoundsMethod(t)}get boundsMethod(){return this.getBoundsMethod()}getBoundsMethod(){return this._boundsMethod}computeShapeBounds(){const t=this.getShape();if(this._boundsMethod==="none"||!t)return Bounds2.NOTHING;if(!this.hasPaintableStroke()||this._boundsMethod==="unstroked")return t.bounds;if(this._boundsMethod==="accurate")return t.getStrokedBounds(this.getLineStyles());{let s;return this._boundsMethod==="safePadding"&&this.getLineJoin()==="miter"?s=this.getMiterLimit():this.getLineCap()==="square"?s=Math.SQRT2:s=1,t.bounds.dilated(s*this.getLineWidth()/2)}}areSelfBoundsValid(){return this._boundsMethod==="accurate"||this._boundsMethod==="safePadding"?!0:this._boundsMethod==="none"?!1:!this.hasStroke()}getTransformedSelfBounds(t){return assert&&assert(this.hasShape()),(this._stroke?this.getStrokedShape():this.getShape()).getBoundsWithTransform(t)}getTransformedSafeSelfBounds(t){return this.getTransformedSelfBounds(t)}invalidateStroke(){this.invalidatePath(),this.rendererSummaryRefreshEmitter.emit(),super.invalidateStroke()}hasShape(){return!!this._shape}canvasPaintSelf(t,s){PathCanvasDrawable$1.prototype.paintCanvas(t,this,s)}createSVGDrawable(t,s){return PathSVGDrawable$1.createFromPool(t,s)}createCanvasDrawable(t,s){return PathCanvasDrawable$1.createFromPool(t,s)}isPainted(){return!0}containsPointSelf(t){let s=!1;return this.hasShape()&&(this._fillPickable&&(s=this.getShape().containsPoint(t)),!s&&this._strokePickable&&(s=this.getStrokedShape().containsPoint(t))),s}getSelfShape(){return Shape$1.union([...this.hasShape()&&this._fillPickable?[this.getShape()]:[],...this.hasShape()&&this._strokePickable?[this.getStrokedShape()]:[]])}intersectsBoundsSelf(t){return this._shape?this._shape.intersectsBounds(t):!1}requiresSVGBoundsWorkaround(){if(!this._stroke||!(this._stroke instanceof Paint)||!this.hasShape())return!1;const t=this.computeShapeBounds();return t.width*t.height===0}getDebugHTMLExtras(){return this._shape?` (<span style="color: #88f" onclick="window.open( 'data:text/plain;charset=utf-8,' + encodeURIComponent( '${this._shape.getSVGPath()}' ) );">path</span>)`:""}dispose(){this._invalidShapeListenerAttached&&this.detachShapeListener(),this._shapeProperty.dispose(),super.dispose()}mutate(t){return super.mutate(t)}};Hu.DEFAULT_PATH_OPTIONS=combineOptions({},Node$2.DEFAULT_NODE_OPTIONS,DEFAULT_OPTIONS$4);let Path=Hu;Path.prototype._mutatorKeys=[...PAINTABLE_OPTION_KEYS,...PATH_OPTION_KEYS,...Node$2.prototype._mutatorKeys];Path.prototype.drawableMarkFlags=[...Node$2.prototype.drawableMarkFlags,...PAINTABLE_DRAWABLE_MARK_FLAGS,"shape"];scenery.register("Path",Path);const PhetioElementSelectionValues=["view","linked","string","none"],phetioElementSelectionProperty=new Property("none",{tandem:Tandem.GENERAL_VIEW.createTandem("phetioElementSelectionProperty"),phetioValueType:StringIO,validValues:PhetioElementSelectionValues,phetioState:!1,phetioDocumentation:'Specifies how PhET-iO Elements are being selected. "view": the target view element, "linked": the corresponding linked element of the view element (if there is one), "string": select only string elements in the sim, "none": no active selection.'});tandemNamespace.register("phetioElementSelectionProperty",phetioElementSelectionProperty);const STRING_PROPERTY_NAME="stringProperty",TEXT_OPTION_KEYS=["boundsMethod",STRING_PROPERTY_NAME,"string","font","fontWeight","fontFamily","fontStretch","fontStyle","fontSize"],useDOMAsFastBounds=window.navigator.userAgent.includes("like Gecko) Version/5")&&window.navigator.userAgent.includes("Safari/"),$r=class $r extends Paintable(Node$2){constructor(t,s){assert&&assert(s===void 0||Object.getPrototypeOf(s)===Object.prototype,"Extra prototype on Node options object is a code smell"),super(),this._stringProperty=new TinyForwardingProperty("",!0,this.onStringPropertyChange.bind(this)),this._font=Font.DEFAULT,this._boundsMethod="hybrid",this._isHTML=!1,this._cachedRenderedText=null;const r=extendDefined({fill:"#000000",tandemNameSuffix:"Text",phetioType:$r.TextIO,phetioVisiblePropertyInstrumented:!1},s);assert&&assert(!r.hasOwnProperty("string")&&!r.hasOwnProperty($r.STRING_PROPERTY_TANDEM_NAME),"provide string and stringProperty through constructor arg please"),typeof t=="string"||typeof t=="number"?r.string=t:r.stringProperty=t,this.mutate(r),this.invalidateSupportedRenderers()}mutate(t){return assert&&t&&t.hasOwnProperty("string")&&t.hasOwnProperty(STRING_PROPERTY_NAME)&&assert&&assert(t.stringProperty.value===t.string,"If both string and stringProperty are provided, then values should match"),super.mutate(t)}setString(t){return assert&&assert(t!=null,"String should be defined and non-null. Use the empty string if needed."),t=`${t}`,this._stringProperty.set(t),this}set string(t){this.setString(t)}get string(){return this.getString()}getString(){return this._stringProperty.value}getRenderedText(){return this._cachedRenderedText===null&&(this._cachedRenderedText=this.string.replace(" "," "),platform.edge&&(this._cachedRenderedText=$r.simplifyEmbeddingMarks(this._cachedRenderedText))),this._cachedRenderedText}get renderedText(){return this.getRenderedText()}onStringPropertyChange(){this._cachedRenderedText=null;const t=this._drawables.length;for(let s=0;s<t;s++)this._drawables[s].markDirtyText();this.invalidateText()}setStringProperty(t){return this._stringProperty.setTargetProperty(t,this,$r.STRING_PROPERTY_TANDEM_NAME)}set stringProperty(t){this.setStringProperty(t)}get stringProperty(){return this.getStringProperty()}getStringProperty(){return this._stringProperty}initializePhetioObject(t,s){const r=this.isPhetioInstrumented();super.initializePhetioObject(t,s),Tandem.PHET_IO_ENABLED&&!r&&this.isPhetioInstrumented()&&this._stringProperty.initializePhetio(this,$r.STRING_PROPERTY_TANDEM_NAME,()=>new StringProperty(this.string,combineOptions({phetioReadOnly:!0,tandem:this.tandem.createTandem($r.STRING_PROPERTY_TANDEM_NAME),phetioDocumentation:"Property for the displayed text"},s.stringPropertyOptions)))}getPhetioMouseHitTarget(t=!1){return phetioElementSelectionProperty.value==="string"?this.getStringPropertyPhetioMouseHitTarget(t):super.getPhetioMouseHitTarget(t)}getStringPropertyPhetioMouseHitTarget(t=!1){const s=this._stringProperty.getTargetProperty();return s instanceof PhetioObject?s.getPhetioMouseHitTarget(t):"phetioNotSelectable"}setBoundsMethod(t){if(assert&&assert(t==="fast"||t==="fastCanvas"||t==="accurate"||t==="hybrid","Unknown Text boundsMethod"),t!==this._boundsMethod){this._boundsMethod=t,this.invalidateSupportedRenderers();const s=this._drawables.length;for(let r=0;r<s;r++)this._drawables[r].markDirtyBounds();this.invalidateText(),this.rendererSummaryRefreshEmitter.emit()}return this}set boundsMethod(t){this.setBoundsMethod(t)}get boundsMethod(){return this.getBoundsMethod()}getBoundsMethod(){return this._boundsMethod}getTextRendererBitmask(){let t=0;return this._boundsMethod!=="fast"&&!this._isHTML&&(t|=Renderer.bitmaskCanvas),this._isHTML||(t|=Renderer.bitmaskSVG),t|=Renderer.bitmaskDOM,t}invalidateSupportedRenderers(){this.setRendererBitmask(this.getFillRendererBitmask()&this.getStrokeRendererBitmask()&this.getTextRendererBitmask())}invalidateText(){this.invalidateSelf();const t=this._drawables.length;for(let s=0;s<t;s++)this._drawables[s].markDirtyBounds();this.invalidateSupportedRenderers()}updateSelfBounds(){let t;this._isHTML||useDOMAsFastBounds&&this._boundsMethod!=="accurate"?t=TextBounds.approximateDOMBounds(this._font,this.getDOMTextNode()):this._boundsMethod==="hybrid"?t=TextBounds.approximateHybridBounds(this._font,this.renderedText):this._boundsMethod==="accurate"?t=TextBounds.accurateCanvasBounds(this):(assert&&assert(this._boundsMethod==="fast"||this._boundsMethod==="fastCanvas"),t=TextBounds.approximateSVGBounds(this._font,this.renderedText)),this.hasStroke()&&t.dilate(this.getLineWidth()/2);const s=!t.equals(this.selfBoundsProperty._value);return s&&this.selfBoundsProperty._value.set(t),s}invalidateStroke(){this.invalidateText(),super.invalidateStroke()}invalidateFill(){this.invalidateText(),super.invalidateFill()}canvasPaintSelf(t,s){TextCanvasDrawable$1.prototype.paintCanvas(t,this,s)}createDOMDrawable(t,s){return TextDOMDrawable$1.createFromPool(t,s)}createSVGDrawable(t,s){return TextSVGDrawable$1.createFromPool(t,s)}createCanvasDrawable(t,s){return TextCanvasDrawable$1.createFromPool(t,s)}getDOMTextNode(){if(this._isHTML){const t=document.createElement("span");return t.innerHTML=this.string,t}else return document.createTextNode(this.renderedText)}getSafeSelfBounds(){const s=this.getSelfBounds();return s.dilatedXY(1*s.width,1*s.height)}setFont(t){if(t!==(typeof t=="string"?this._font.toCSS():this._font)){this._font=typeof t=="string"?Font.fromCSS(t):t;const r=this._drawables.length;for(let o=0;o<r;o++)this._drawables[o].markDirtyFont();this.invalidateText()}return this}set font(t){this.setFont(t)}get font(){return this.getFont()}getFont(){return this._font.getFont()}setFontWeight(t){return this.setFont(this._font.copy({weight:t}))}set fontWeight(t){this.setFontWeight(t)}get fontWeight(){return this.getFontWeight()}getFontWeight(){return this._font.getWeight()}setFontFamily(t){return this.setFont(this._font.copy({family:t}))}set fontFamily(t){this.setFontFamily(t)}get fontFamily(){return this.getFontFamily()}getFontFamily(){return this._font.getFamily()}setFontStretch(t){return this.setFont(this._font.copy({stretch:t}))}set fontStretch(t){this.setFontStretch(t)}get fontStretch(){return this.getFontStretch()}getFontStretch(){return this._font.getStretch()}setFontStyle(t){return this.setFont(this._font.copy({style:t}))}set fontStyle(t){this.setFontStyle(t)}get fontStyle(){return this.getFontStyle()}getFontStyle(){return this._font.getStyle()}setFontSize(t){return this.setFont(this._font.copy({size:t}))}set fontSize(t){this.setFontSize(t)}get fontSize(){return this.getFontSize()}getFontSize(){return this._font.getSize()}isPainted(){return!0}areSelfBoundsValid(){return this._boundsMethod==="accurate"}getDebugHTMLExtras(){return` "${escapeHTML(this.renderedText)}"${this._isHTML?" (html)":""}`}dispose(){super.dispose(),this._stringProperty.dispose()}static embeddedDebugString(t){return t.replace(/\u202a/g,"[LTR]").replace(/\u202b/g,"[RTL]").replace(/\u202c/g,"[POP]")}static simplifyEmbeddingMarks(t){const s={dir:null,children:[],parent:null};let r=s;for(let d=0;d<t.length;d++){const A=t.charAt(d);if(A===LTR$1||A===RTL$1){const S={dir:A,children:[],parent:r};r.children.push(S),r=S}else A===POP$1?(assert&&assert(r.parent,`Bad nesting of embedding marks: ${$r.embeddedDebugString(t)}`),r=r.parent):r.children.push(A)}assert&&assert(r===s,`Bad nesting of embedding marks: ${$r.embeddedDebugString(t)}`);function o(d){for(let A=d.children.length-1;A>=0;A--){const S=d.children[A];typeof S!="string"&&d.dir===S.dir&&d.children.splice(A,1,...S.children)}}function n(d){d.children.length===1&&typeof d.children[0]!="string"&&d.children[0].dir&&(d.dir=d.children[0].dir,d.children=d.children[0].children)}function l(d){for(let A=d.children.length-1;A>=1;A--){const S=d.children[A-1],O=d.children[A];typeof O!="string"&&typeof S!="string"&&O.dir&&S.dir===O.dir&&(S.children=S.children.concat(O.children),d.children.splice(A,1),l(S))}}function h(d){if(typeof d!="string"){for(let A=0;A<d.children.length;A++)h(d.children[A]);n(d),o(d),l(d)}return d}function g(d){if(typeof d=="string")return d;const A=d.children.map(g).join("");return d.dir?`${d.dir+A}‬`:A}return g(h(s))}};$r.STRING_PROPERTY_NAME=STRING_PROPERTY_NAME,$r.STRING_PROPERTY_TANDEM_NAME=STRING_PROPERTY_NAME;let Text=$r;Text.prototype._mutatorKeys=[...PAINTABLE_OPTION_KEYS,...TEXT_OPTION_KEYS,...Node$2.prototype._mutatorKeys];Text.prototype.drawableMarkFlags=[...Node$2.prototype.drawableMarkFlags,...PAINTABLE_DRAWABLE_MARK_FLAGS,"text","font","bounds"];scenery.register("Text",Text);const LTR$1="‪",RTL$1="‫",POP$1="‬";TextBounds.initializeTextBounds();Text.TextIO=new IOType("TextIO",{valueType:Text,supertype:Node$2.NodeIO,documentation:"Text that is displayed in the simulation. TextIO has a nested PropertyIO.&lt;String&gt; for the current string value."});const CANVAS_NODE_OPTION_KEYS=["canvasBounds"];class CanvasNode extends Node$2{constructor(t){super(t),this.setRendererBitmask(Renderer.bitmaskCanvas)}setCanvasBounds(t){this.invalidateSelf(t)}set canvasBounds(t){this.setCanvasBounds(t)}get canvasBounds(){return this.getCanvasBounds()}getCanvasBounds(){return this.getSelfBounds()}isPainted(){return!0}invalidatePaint(){const t=this._drawables.length;for(let s=0;s<t;s++)this._drawables[s].markDirty()}canvasPaintSelf(t,s){this.paintCanvas(t.context)}containsPointSelf(t){return!1}getSelfShape(){return new Shape$1}createCanvasDrawable(t,s){return CanvasNodeDrawable$1.createFromPool(t,s)}mutate(t){return super.mutate(t)}}CanvasNode.prototype._mutatorKeys=CANVAS_NODE_OPTION_KEYS.concat(Node$2.prototype._mutatorKeys);scenery.register("CanvasNode",CanvasNode);const CIRCLE_OPTION_KEYS=["radius"];class Circle extends Path{constructor(t,s){super(null),this._radius=0,typeof t=="object"?(s=t,assert&&assert(s===void 0||Object.getPrototypeOf(s)===Object.prototype,"Extra prototype on Node options object is a code smell")):(assert&&assert(s===void 0||Object.getPrototypeOf(s)===Object.prototype,"Extra prototype on Node options object is a code smell"),s=extendDefined({radius:t},s)),this.mutate(s)}getStrokeRendererBitmask(){let t=super.getStrokeRendererBitmask();return this.hasStroke()&&!this.getStroke().isGradient&&!this.getStroke().isPattern&&this.getLineWidth()<=this.getRadius()&&(t|=Renderer.bitmaskDOM),t}getPathRendererBitmask(){return Renderer.bitmaskCanvas|Renderer.bitmaskSVG|(Features.borderRadius?Renderer.bitmaskDOM:0)}invalidateCircle(){assert&&assert(this._radius>=0,"A circle needs a non-negative radius"),this._shape=null,this.invalidatePath()}createCircleShape(){return Shape$1.circle(0,0,this._radius).makeImmutable()}intersectsBoundsSelf(t){let s=Math.abs(t.centerX),r=Math.abs(t.centerY);const o=t.maxX-s,n=t.maxY-r;return s>o+this._radius||r>n+this._radius?!1:s<=o||r<=n?!0:(s-=o,r-=n,s*s+r*r<=this._radius*this._radius)}canvasPaintSelf(t,s){CircleCanvasDrawable$1.prototype.paintCanvas(t,this,s)}createDOMDrawable(t,s){return CircleDOMDrawable$1.createFromPool(t,s)}createSVGDrawable(t,s){return CircleSVGDrawable$1.createFromPool(t,s)}createCanvasDrawable(t,s){return CircleCanvasDrawable$1.createFromPool(t,s)}setRadius(t){if(assert&&assert(t>=0,"A circle needs a non-negative radius"),assert&&assert(isFinite(t),"A circle needs a finite radius"),this._radius!==t){this._radius=t,this.invalidateCircle();const s=this._drawables.length;for(let r=0;r<s;r++)this._drawables[r].markDirtyRadius()}return this}set radius(t){this.setRadius(t)}get radius(){return this.getRadius()}getRadius(){return this._radius}computeShapeBounds(){let t=new Bounds2(-this._radius,-this._radius,this._radius,this._radius);return this._stroke&&(t=t.dilated(this.getLineWidth()/2)),t}containsPointSelf(t){const s=t.x*t.x+t.y*t.y;let r=!0,o;if(this._strokePickable){o=this.getLineWidth()/2;const n=this._radius+o;r=r&&s<=n*n}if(this._fillPickable)return this._strokePickable?r:s<=this._radius*this._radius;if(this._strokePickable){const n=this._radius-o;return r&&s>=n*n}else return!1}setShape(t){if(t!==null)throw new Error("Cannot set the shape of a Circle to something non-null");return this.invalidatePath(),this}getShape(){return this._shape||(this._shape=this.createCircleShape()),this._shape}hasShape(){return!0}setShapeProperty(t){if(t!==null)throw new Error("Cannot set the shapeProperty of a Circle to something non-null, it handles this itself");return this}mutate(t){return super.mutate(t)}}Circle.prototype._mutatorKeys=CIRCLE_OPTION_KEYS.concat(Path.prototype._mutatorKeys);Circle.prototype.drawableMarkFlags=Path.prototype.drawableMarkFlags.concat(["radius"]).filter(a=>a!=="shape");scenery.register("Circle",Circle);const DOM_OPTION_KEYS=["element","preventTransform"],isJQueryElement=a=>!!(a&&a.jquery);class DOM extends Node$2{constructor(t,s){assert&&assert(s===void 0||Object.getPrototypeOf(s)===Object.prototype,"Extra prototype on Node options object is a code smell"),assert&&assert(t instanceof window.Element||t.jquery,"DOM nodes need to be passed an HTML/DOM element or a jQuery selection like $( ... )"),isJQueryElement(t)&&(t=t[0],assert&&assert(t instanceof window.Element)),super(),this._container=document.createElement("div"),this._$container=$(this._container),this._$container.css("position","absolute"),this._$container.css("left",0),this._$container.css("top",0),this.invalidateDOMLock=!1,this._preventTransform=!1,s=extendDefined({element:t},s),this.mutate(s),this.setRendererBitmask(Renderer.bitmaskDOM)}calculateDOMBounds(){const t=$(this._element);return new Bounds2(0,0,t.width(),t.height())}invalidateDOM(){if(this.invalidateDOMLock)return;this.invalidateDOMLock=!0;const t=document.createElement("div");$(t).css({display:"hidden",padding:"0 !important",margin:"0 !important",position:"absolute",left:0,top:0,width:65535,height:65535}),this._container.removeChild(this._element),t.appendChild(this._element),document.body.appendChild(t);const s=this.calculateDOMBounds();this.invalidateSelf(s),this._$container.width(s.getWidth()),this._$container.height(s.getHeight()),document.body.removeChild(t),t.removeChild(this._element),this._container.appendChild(this._element),this.invalidateDOMLock=!1}createDOMDrawable(t,s){return DOMDrawable$1.createFromPool(t,s)}isPainted(){return!0}setElement(t){return assert&&assert(!this._element,"We should only ever attach one DOMElement to a DOM node"),this._element!==t&&(this._element&&this._container.removeChild(this._element),this._element=t,this._container.appendChild(this._element),this.invalidateDOM()),this}set element(t){this.setElement(t)}get element(){return this.getElement()}getElement(){return this._element}setPreventTransform(t){this._preventTransform!==t&&(this._preventTransform=t)}set preventTransform(t){this.setPreventTransform(t)}get preventTransform(){return this.isTransformPrevented()}isTransformPrevented(){return this._preventTransform}mutate(t){return super.mutate(t)}}DOM.prototype._mutatorKeys=DOM_OPTION_KEYS.concat(Node$2.prototype._mutatorKeys);scenery.register("DOM",DOM);const LINE_OPTION_KEYS=["p1","p2","x1","y1","x2","y2"];class Line extends Path{constructor(t,s,r,o,n){super(null),this._x1=0,this._y1=0,this._x2=0,this._y2=0,typeof t=="object"?t instanceof Vector2?(assert&&assert(r===void 0||typeof r=="object"),assert&&assert(r===void 0||Object.getPrototypeOf(r)===Object.prototype,"Extra prototype on Node options object is a code smell"),n=extendDefined({x1:t.x,y1:t.y,x2:s.x,y2:s.y,strokePickable:!0},r)):(assert&&assert(s===void 0),assert&&assert(t===void 0||Object.getPrototypeOf(t)===Object.prototype,"Extra prototype on Node options object is a code smell"),n=extendDefined({strokePickable:!0},t)):(assert&&assert(t!==void 0&&typeof s=="number"&&typeof r=="number"&&typeof o=="number"),assert&&assert(n===void 0||Object.getPrototypeOf(n)===Object.prototype,"Extra prototype on Node options object is a code smell"),n=extendDefined({x1:t,y1:s,x2:r,y2:o,strokePickable:!0},n)),this.mutate(n)}setLine(t,s,r,o){assert&&assert(t!==void 0&&s!==void 0&&r!==void 0&&o!==void 0,"parameters need to be defined"),this._x1=t,this._y1=s,this._x2=r,this._y2=o;const n=this._drawables.length;for(let l=0;l<n;l++)this._drawables[l].markDirtyLine();return this.invalidateLine(),this}setPoint1(t,s){typeof t=="number"?(assert&&assert(t!==void 0&&s!==void 0,"parameters need to be defined"),this._x1=t,this._y1=s):(assert&&assert(t.x!==void 0&&t.y!==void 0,"parameters need to be defined"),this._x1=t.x,this._y1=t.y);const r=this._drawables.length;for(let o=0;o<r;o++)this._drawables[o].markDirtyP1();return this.invalidateLine(),this}set p1(t){this.setPoint1(t)}get p1(){return new Vector2(this._x1,this._y1)}setPoint2(t,s){typeof t=="number"?(assert&&assert(t!==void 0&&s!==void 0,"parameters need to be defined"),this._x2=t,this._y2=s):(assert&&assert(t.x!==void 0&&t.y!==void 0,"parameters need to be defined"),this._x2=t.x,this._y2=t.y);const r=this._drawables.length;for(let o=0;o<r;o++)this._drawables[o].markDirtyP2();return this.invalidateLine(),this}set p2(t){this.setPoint2(t)}get p2(){return new Vector2(this._x2,this._y2)}setX1(t){if(this._x1!==t){this._x1=t;const s=this._drawables.length;for(let r=0;r<s;r++)this._drawables[r].markDirtyX1();this.invalidateLine()}return this}set x1(t){this.setX1(t)}get x1(){return this.getX1()}getX1(){return this._x1}setY1(t){if(this._y1!==t){this._y1=t;const s=this._drawables.length;for(let r=0;r<s;r++)this._drawables[r].markDirtyY1();this.invalidateLine()}return this}set y1(t){this.setY1(t)}get y1(){return this.getY1()}getY1(){return this._y1}setX2(t){if(this._x2!==t){this._x2=t;const s=this._drawables.length;for(let r=0;r<s;r++)this._drawables[r].markDirtyX2();this.invalidateLine()}return this}set x2(t){this.setX2(t)}get x2(){return this.getX2()}getX2(){return this._x2}setY2(t){if(this._y2!==t){this._y2=t;const s=this._drawables.length;for(let r=0;r<s;r++)this._drawables[r].markDirtyY2();this.invalidateLine()}return this}set y2(t){this.setY2(t)}get y2(){return this.getY2()}getY2(){return this._y2}createLineShape(){return Shape$1.lineSegment(this._x1,this._y1,this._x2,this._y2).makeImmutable()}invalidateLine(){assert&&assert(isFinite(this._x1),`A line needs to have a finite x1 (${this._x1})`),assert&&assert(isFinite(this._y1),`A line needs to have a finite y1 (${this._y1})`),assert&&assert(isFinite(this._x2),`A line needs to have a finite x2 (${this._x2})`),assert&&assert(isFinite(this._y2),`A line needs to have a finite y2 (${this._y2})`),this._shape=null,this.invalidatePath()}containsPointSelf(t){return this._strokePickable?super.containsPointSelf(t):!1}canvasPaintSelf(t,s){LineCanvasDrawable$1.prototype.paintCanvas(t,this,s)}computeShapeBounds(){if(this._stroke){const t=this.getLineCap(),s=this.getLineWidth()/2;if(t==="round")return new Bounds2(Math.min(this._x1,this._x2)-s,Math.min(this._y1,this._y2)-s,Math.max(this._x1,this._x2)+s,Math.max(this._y1,this._y2)+s);{const r=this._x2-this._x1,o=this._y2-this._y1,n=Math.sqrt(r*r+o*o);if(n===0)return new Bounds2(this._x1-s,this._y1-s,this._x2+s,this._y2+s);const l=s*r/n,h=s*o/n,g=Bounds2.NOTHING.copy();return t==="butt"?(g.addCoordinates(this._x1-h,this._y1+l),g.addCoordinates(this._x1+h,this._y1-l),g.addCoordinates(this._x2-h,this._y2+l),g.addCoordinates(this._x2+h,this._y2-l)):(assert&&assert(t==="square"),g.addCoordinates(this._x1-l-h,this._y1-h+l),g.addCoordinates(this._x1-l+h,this._y1-h-l),g.addCoordinates(this._x2+l-h,this._y2+h+l),g.addCoordinates(this._x2+l+h,this._y2+h-l)),g}}else{const t=Bounds2.NOTHING.copy();return t.addCoordinates(this._x1,this._y1),t.addCoordinates(this._x2,this._y2),t}}createSVGDrawable(t,s){return LineSVGDrawable$1.createFromPool(t,s)}createCanvasDrawable(t,s){return LineCanvasDrawable$1.createFromPool(t,s)}setShape(t){if(t!==null)throw new Error("Cannot set the shape of a Line to something non-null");return this.invalidatePath(),this}getShape(){return this._shape||(this._shape=this.createLineShape()),this._shape}hasShape(){return!0}setShapeProperty(t){if(t!==null)throw new Error("Cannot set the shapeProperty of a Line to something non-null, it handles this itself");return this}mutate(t){return super.mutate(t)}getFillRendererBitmask(){return Renderer.bitmaskCanvas|Renderer.bitmaskSVG|Renderer.bitmaskDOM|Renderer.bitmaskWebGL}}Line.prototype._mutatorKeys=LINE_OPTION_KEYS.concat(Path.prototype._mutatorKeys);Line.prototype.drawableMarkFlags=Path.prototype.drawableMarkFlags.concat(["line","p1","p2","x1","x2","y1","y2"]).filter(a=>a!=="shape");scenery.register("Line",Line);const RECTANGLE_OPTION_KEYS=["rectBounds","rectSize","rectX","rectY","rectWidth","rectHeight","cornerRadius","cornerXRadius","cornerYRadius"],SuperType$1=Sizable(Path);class Rectangle extends SuperType$1{constructor(t,s,r,o,n,l,h){const g={sizable:!1};super(null,g);let d={};this._rectX=0,this._rectY=0,this._rectWidth=0,this._rectHeight=0,this._cornerXRadius=0,this._cornerYRadius=0,typeof t=="object"?t instanceof Bounds2?typeof s!="number"?(assert&&assert(arguments.length===1||arguments.length===2,"new Rectangle( bounds, { ... } ) should only take one or two arguments"),assert&&assert(s===void 0||typeof s=="object","new Rectangle( bounds, { ... } ) second parameter should only ever be an options object"),assert&&assert(s===void 0||Object.getPrototypeOf(s)===Object.prototype,"Extra prototype on Node options object is a code smell"),assert&&s&&(assert(s.rectWidth===void 0,"Should not specify rectWidth in multiple ways"),assert(s.rectHeight===void 0,"Should not specify rectHeight in multiple ways"),assert(s.rectBounds===void 0,"Should not specify rectBounds in multiple ways")),d=combineOptions(d,{rectBounds:t},s)):(assert&&assert(arguments.length===3||arguments.length===4,"new Rectangle( bounds, cornerXRadius, cornerYRadius, { ... } ) should only take three or four arguments"),assert&&assert(o===void 0||typeof o=="object","new Rectangle( bounds, cornerXRadius, cornerYRadius, { ... } ) fourth parameter should only ever be an options object"),assert&&assert(o===void 0||Object.getPrototypeOf(o)===Object.prototype,"Extra prototype on Node options object is a code smell"),assert&&o&&(assert(o.rectWidth===void 0,"Should not specify rectWidth in multiple ways"),assert(o.rectHeight===void 0,"Should not specify rectHeight in multiple ways"),assert(o.rectBounds===void 0,"Should not specify rectBounds in multiple ways"),assert(o.cornerXRadius===void 0,"Should not specify cornerXRadius in multiple ways"),assert(o.cornerYRadius===void 0,"Should not specify cornerYRadius in multiple ways"),assert(o.cornerRadius===void 0,"Should not specify cornerRadius in multiple ways")),d=combineOptions(d,{rectBounds:t,cornerXRadius:s,cornerYRadius:r},o)):d=combineOptions(d,t):l===void 0?(assert&&assert(arguments.length===4||arguments.length===5,"new Rectangle( x, y, width, height, { ... } ) should only take four or five arguments"),assert&&assert(n===void 0||typeof n=="object","new Rectangle( x, y, width, height, { ... } ) fifth parameter should only ever be an options object"),assert&&assert(n===void 0||Object.getPrototypeOf(n)===Object.prototype,"Extra prototype on Node options object is a code smell"),assert&&n&&(assert(n.rectX===void 0,"Should not specify rectX in multiple ways"),assert(n.rectY===void 0,"Should not specify rectY in multiple ways"),assert(n.rectWidth===void 0,"Should not specify rectWidth in multiple ways"),assert(n.rectHeight===void 0,"Should not specify rectHeight in multiple ways"),assert(n.rectBounds===void 0,"Should not specify rectBounds in multiple ways")),d=combineOptions(d,{rectX:t,rectY:s,rectWidth:r,rectHeight:o},n)):(assert&&assert(arguments.length===6||arguments.length===7,"new Rectangle( x, y, width, height, cornerXRadius, cornerYRadius{ ... } ) should only take six or seven arguments"),assert&&assert(d===void 0||typeof d=="object","new Rectangle( x, y, width, height, cornerXRadius, cornerYRadius{ ... } ) seventh parameter should only ever be an options object"),assert&&assert(d===void 0||Object.getPrototypeOf(d)===Object.prototype,"Extra prototype on Node options object is a code smell"),assert&&h&&(assert(h.rectX===void 0,"Should not specify rectX in multiple ways"),assert(h.rectY===void 0,"Should not specify rectY in multiple ways"),assert(h.rectWidth===void 0,"Should not specify rectWidth in multiple ways"),assert(h.rectHeight===void 0,"Should not specify rectHeight in multiple ways"),assert(h.rectBounds===void 0,"Should not specify rectBounds in multiple ways"),assert(h.cornerXRadius===void 0,"Should not specify cornerXRadius in multiple ways"),assert(h.cornerYRadius===void 0,"Should not specify cornerYRadius in multiple ways"),assert(h.cornerRadius===void 0,"Should not specify cornerRadius in multiple ways")),d=combineOptions(d,{rectX:t,rectY:s,rectWidth:r,rectHeight:o,cornerXRadius:n,cornerYRadius:l},h)),this.localPreferredWidthProperty.lazyLink(this.updatePreferredSizes.bind(this)),this.localPreferredHeightProperty.lazyLink(this.updatePreferredSizes.bind(this)),this.localMinimumWidthProperty.lazyLink(this.updatePreferredSizes.bind(this)),this.localMinimumHeightProperty.lazyLink(this.updatePreferredSizes.bind(this)),this.mutate(d)}getMaximumArcSize(){return Math.min(this._rectWidth/2,this._rectHeight/2)}getStrokeRendererBitmask(){let t=super.getStrokeRendererBitmask();const s=this.getStroke();return s&&!(s instanceof Gradient)&&!(s instanceof Pattern)&&!this.hasLineDash()&&(this.getLineJoin()==="miter"||this.getLineJoin()==="round"&&Features.borderRadius)&&(t|=Renderer.bitmaskDOM),this.hasStroke()||(t|=Renderer.bitmaskWebGL),t}getPathRendererBitmask(){let t=Renderer.bitmaskCanvas|Renderer.bitmaskSVG;const s=this.getMaximumArcSize();return(!this.hasStroke()||this.getLineWidth()<=this._rectHeight&&this.getLineWidth()<=this._rectWidth)&&(!this.isRounded()||Features.borderRadius&&this._cornerXRadius===this._cornerYRadius)&&this._cornerYRadius<=s&&this._cornerXRadius<=s&&(t|=Renderer.bitmaskDOM),!this.hasStroke()&&!this.isRounded()&&(t|=Renderer.bitmaskWebGL),t}setRect(t,s,r,o,n,l){const h=n!==void 0,g=l!==void 0;if(assert&&assert(isFinite(t)&&isFinite(s)&&isFinite(r)&&isFinite(o),"x/y/width/height should be finite numbers"),assert&&assert(!h||isFinite(n)&&(!g||isFinite(l)),"Corner radii (if provided) should be finite numbers"),this._rectX===t&&this._rectY===s&&this._rectWidth===r&&this._rectHeight===o&&(!h||this._cornerXRadius===n)&&(!g||this._cornerYRadius===l))return this;this._rectX=t,this._rectY=s,this._rectWidth=r,this._rectHeight=o,this._cornerXRadius=h?n:this._cornerXRadius,this._cornerYRadius=g?l:this._cornerYRadius;const d=this._drawables.length;for(let A=0;A<d;A++)this._drawables[A].markDirtyRectangle();return this.invalidateRectangle(),this}setRectX(t){if(assert&&assert(isFinite(t),"rectX should be a finite number"),this._rectX!==t){this._rectX=t;const s=this._drawables.length;for(let r=0;r<s;r++)this._drawables[r].markDirtyX();this.invalidateRectangle()}return this}set rectX(t){this.setRectX(t)}get rectX(){return this.getRectX()}getRectX(){return this._rectX}setRectY(t){if(assert&&assert(isFinite(t),"rectY should be a finite number"),this._rectY!==t){this._rectY=t;const s=this._drawables.length;for(let r=0;r<s;r++)this._drawables[r].markDirtyY();this.invalidateRectangle()}return this}set rectY(t){this.setRectY(t)}get rectY(){return this.getRectY()}getRectY(){return this._rectY}setRectWidth(t){if(assert&&assert(isFinite(t),"rectWidth should be a finite number"),this._rectWidth!==t){this._rectWidth=t;const s=this._drawables.length;for(let r=0;r<s;r++)this._drawables[r].markDirtyWidth();this.invalidateRectangle()}return this}set rectWidth(t){this.setRectWidth(t)}get rectWidth(){return this.getRectWidth()}getRectWidth(){return this._rectWidth}setRectHeight(t){if(assert&&assert(isFinite(t),"rectHeight should be a finite number"),this._rectHeight!==t){this._rectHeight=t;const s=this._drawables.length;for(let r=0;r<s;r++)this._drawables[r].markDirtyHeight();this.invalidateRectangle()}return this}set rectHeight(t){this.setRectHeight(t)}get rectHeight(){return this.getRectHeight()}getRectHeight(){return this._rectHeight}setCornerXRadius(t){if(assert&&assert(isFinite(t),"cornerXRadius should be a finite number"),this._cornerXRadius!==t){this._cornerXRadius=t;const s=this._drawables.length;for(let r=0;r<s;r++)this._drawables[r].markDirtyCornerXRadius();this.invalidateRectangle()}return this}set cornerXRadius(t){this.setCornerXRadius(t)}get cornerXRadius(){return this.getCornerXRadius()}getCornerXRadius(){return this._cornerXRadius}setCornerYRadius(t){if(assert&&assert(isFinite(t),"cornerYRadius should be a finite number"),this._cornerYRadius!==t){this._cornerYRadius=t;const s=this._drawables.length;for(let r=0;r<s;r++)this._drawables[r].markDirtyCornerYRadius();this.invalidateRectangle()}return this}set cornerYRadius(t){this.setCornerYRadius(t)}get cornerYRadius(){return this.getCornerYRadius()}getCornerYRadius(){return this._cornerYRadius}setRectBounds(t){return this.setRect(t.x,t.y,t.width,t.height),this}set rectBounds(t){this.setRectBounds(t)}get rectBounds(){return this.getRectBounds()}getRectBounds(){return Bounds2.rect(this._rectX,this._rectY,this._rectWidth,this._rectHeight)}setRectSize(t){return this.setRectWidth(t.width),this.setRectHeight(t.height),this}set rectSize(t){this.setRectSize(t)}get rectSize(){return this.getRectSize()}getRectSize(){return new Dimension2(this._rectWidth,this._rectHeight)}setRectWidthFromRight(t){if(this._rectWidth!==t){const s=this._rectX+this._rectWidth;this.setRectWidth(t),this.setRectX(s-t)}return this}set rectWidthFromRight(t){this.setRectWidthFromRight(t)}get rectWidthFromRight(){return this.getRectWidth()}setRectHeightFromBottom(t){if(this._rectHeight!==t){const s=this._rectY+this._rectHeight;this.setRectHeight(t),this.setRectY(s-t)}return this}set rectHeightFromBottom(t){this.setRectHeightFromBottom(t)}get rectHeightFromBottom(){return this.getRectHeight()}isRounded(){return this._cornerXRadius!==0&&this._cornerYRadius!==0}computeShapeBounds(){let t=new Bounds2(this._rectX,this._rectY,this._rectX+this._rectWidth,this._rectY+this._rectHeight);return this._stroke&&(t=t.dilated(this.getLineWidth()/2)),t}createRectangleShape(){if(this.isRounded()){const t=Math.min(this._rectWidth/2,this._rectHeight/2);return Shape$1.roundRectangle(this._rectX,this._rectY,this._rectWidth,this._rectHeight,Math.min(t,this._cornerXRadius),Math.min(t,this._cornerYRadius)).makeImmutable()}else return Shape$1.rectangle(this._rectX,this._rectY,this._rectWidth,this._rectHeight).makeImmutable()}invalidateRectangle(){assert&&assert(isFinite(this._rectX),`A rectangle needs to have a finite x (${this._rectX})`),assert&&assert(isFinite(this._rectY),`A rectangle needs to have a finite y (${this._rectY})`),assert&&assert(this._rectWidth>=0&&isFinite(this._rectWidth),`A rectangle needs to have a non-negative finite width (${this._rectWidth})`),assert&&assert(this._rectHeight>=0&&isFinite(this._rectHeight),`A rectangle needs to have a non-negative finite height (${this._rectHeight})`),assert&&assert(this._cornerXRadius>=0&&isFinite(this._cornerXRadius),`A rectangle needs to have a non-negative finite arcWidth (${this._cornerXRadius})`),assert&&assert(this._cornerYRadius>=0&&isFinite(this._cornerYRadius),`A rectangle needs to have a non-negative finite arcHeight (${this._cornerYRadius})`),this._shape=null,this.invalidatePath(),this.invalidateSupportedRenderers()}updatePreferredSizes(){let t=this.localPreferredWidth,s=this.localPreferredHeight;t!==null&&(t=Math.max(t,this.localMinimumWidth||0)),s!==null&&(s=Math.max(s,this.localMinimumHeight||0)),t!==null&&(this.rectWidth=this.hasStroke()?t-this.lineWidth:t),s!==null&&(this.rectHeight=this.hasStroke()?s-this.lineWidth:s)}invalidateStroke(){super.invalidateStroke(),this.updatePreferredSizes()}containsPointSelf(t){const s=this._rectX,r=this._rectY,o=this._rectWidth,n=this._rectHeight,l=this._cornerXRadius,h=this._cornerYRadius,g=this.getLineWidth()/2;let d=!0;if(this._strokePickable){const A=this.isRounded();if(!A&&this.getLineJoin()==="bevel")return super.containsPointSelf(t);const S=this.getLineJoin()==="miter"&&!A;d=d&&Rectangle.intersects(s-g,r-g,o+2*g,n+2*g,S?0:l+g,S?0:h+g,t)}return this._fillPickable?this._strokePickable?d:Rectangle.intersects(s,r,o,n,l,h,t):this._strokePickable?d&&!Rectangle.intersects(s+g,r+g,o-2*g,n-2*g,l-g,h-g,t):!1}intersectsBoundsSelf(t){return!this.computeShapeBounds().intersection(t).isEmpty()}canvasPaintSelf(t,s){RectangleCanvasDrawable$1.prototype.paintCanvas(t,this,s)}createDOMDrawable(t,s){return RectangleDOMDrawable$1.createFromPool(t,s)}createSVGDrawable(t,s){return RectangleSVGDrawable$1.createFromPool(t,s)}createCanvasDrawable(t,s){return RectangleCanvasDrawable$1.createFromPool(t,s)}createWebGLDrawable(t,s){return RectangleWebGLDrawable$1.createFromPool(t,s)}setShape(t){if(t!==null)throw new Error("Cannot set the shape of a Rectangle to something non-null");return this.invalidatePath(),this}getShape(){return this._shape||(this._shape=this.createRectangleShape()),this._shape}hasShape(){return!0}setShapeProperty(t){if(t!==null)throw new Error("Cannot set the shapeProperty of a Rectangle to something non-null, it handles this itself");return this}setCornerRadius(t){return this.setCornerXRadius(t),this.setCornerYRadius(t),this}set cornerRadius(t){this.setCornerRadius(t)}get cornerRadius(){return this.getCornerRadius()}getCornerRadius(){return assert&&assert(this._cornerXRadius===this._cornerYRadius,"getCornerRadius() invalid if x/y radii are different"),this._cornerXRadius}mutate(t){return super.mutate(t)}static intersects(t,s,r,o,n,l,h){const g=h.x>=t&&h.x<=t+r&&h.y>=s&&h.y<=s+o;if(!g||n<=0||l<=0)return g;const d=Math.min(r/2,o/2);n=Math.min(d,n),l=Math.min(d,l);let A,S,O=!1;if(h.x<t+r/2?(A=t+n,O=O||h.x>=A):(A=t+r-n,O=O||h.x<=A),O||(h.y<s+o/2?(S=s+l,O=O||h.y>=S):(S=s+o-l,O=O||h.y<=S),O))return!0;let I=h.x-A,W=h.y-S;return I/=n,W/=l,I*=I,W*=W,I+W<=1}static rect(t,s,r,o,n){return new Rectangle(t,s,r,o,0,0,n)}static roundedRect(t,s,r,o,n,l,h){return new Rectangle(t,s,r,o,n,l,h)}static bounds(t,s){return new Rectangle(t.minX,t.minY,t.width,t.height,s)}static roundedBounds(t,s,r,o){return new Rectangle(t.minX,t.minY,t.width,t.height,s,r,o)}static dimension(t,s){return new Rectangle(0,0,t.width,t.height,0,0,s)}}Rectangle.prototype._mutatorKeys=[...RECTANGLE_OPTION_KEYS,...SuperType$1.prototype._mutatorKeys];Rectangle.prototype.drawableMarkFlags=Path.prototype.drawableMarkFlags.concat(["x","y","width","height","cornerXRadius","cornerYRadius"]).filter(a=>a!=="shape");scenery.register("Rectangle",Rectangle);class Sprites extends Node$2{constructor(t){const s=optionize()({sprites:[],spriteInstances:[],hitTestSprites:!1,renderer:"webgl"},t);super(),this._sprites=s.sprites,this._spriteInstances=s.spriteInstances,this._hitTestSprites=s.hitTestSprites,this.setRendererBitmask(Renderer.bitmaskCanvas|Renderer.bitmaskWebGL),this.mutate(s)}setCanvasBounds(t){this.invalidateSelf(t)}set canvasBounds(t){this.setCanvasBounds(t)}get canvasBounds(){return this.getCanvasBounds()}getCanvasBounds(){return this.getSelfBounds()}canvasPaintSelf(t,s){SpritesCanvasDrawable$1.prototype.paintCanvas(t,this,s)}createCanvasDrawable(t,s){return SpritesCanvasDrawable$1.createFromPool(t,s)}createWebGLDrawable(t,s){return SpritesWebGLDrawable$1.createFromPool(t,s)}containsPointSelf(t){return super.containsPointSelf(t)?this._hitTestSprites?!!this.getSpriteInstanceFromPoint(t):!0:!1}getSpriteInstanceFromPoint(t){for(let s=this._spriteInstances.length-1;s>=0;s--)if(this._spriteInstances[s].containsPoint(t))return this._spriteInstances[s];return null}getSelfShape(){return this._hitTestSprites?Shape$1.union(this._spriteInstances.map(t=>t.getShape())):Shape$1.bounds(this.selfBounds)}isPainted(){return!0}invalidatePaint(){const t=this._drawables.length;for(let s=0;s<t;s++)this._drawables[s].markDirty()}mutate(t){return super.mutate(t)}}Sprites.prototype._mutatorKeys=["canvasBounds"].concat(Node$2.prototype._mutatorKeys);scenery.register("Sprites",Sprites);const WEBGL_NODE_OPTION_KEYS=["canvasBounds"],zh=class zh extends Node$2{constructor(t,s){super(s),this.setRendererBitmask(Renderer.bitmaskWebGL),this.painterType=t}setCanvasBounds(t){return this.invalidateSelf(t),this}set canvasBounds(t){this.setCanvasBounds(t)}get canvasBounds(){return this.getCanvasBounds()}getCanvasBounds(){return this.getSelfBounds()}isPainted(){return!0}invalidatePaint(){const t=this._drawables.length;for(let s=0;s<t;s++)this._drawables[s].markDirty()}containsPointSelf(t){return!1}getSelfShape(){return new Shape$1}canvasPaintSelf(t,s){assert&&assert(!1,"unimplemented: canvasPaintSelf in WebGLNode")}renderToCanvasSelf(t,s){const r=t.canvas.width,o=t.canvas.height,n=document.createElement("canvas");n.width=r,n.height=o;const l={antialias:!0,preserveDrawingBuffer:!0},h=n.getContext("webgl",l)||n.getContext("experimental-webgl",l);Utils.applyWebGLContextDefaults(h);const g=new Matrix3().rowMajor(2/r,0,-1,0,-2/o,1,0,0,1);h.viewport(0,0,r,o);const d=this.painterType,A=new d(h,this);A.paint(s,g),A.dispose(),g.freeToPool(),h.flush(),t.context.setTransform(1,0,0,1,0,0),t.context.drawImage(n,0,0),t.context.restore()}createWebGLDrawable(t,s){return WebGLNodeDrawable$1.createFromPool(t,s)}mutate(t){return super.mutate(t)}};zh.PAINTED_NOTHING=0,zh.PAINTED_SOMETHING=1;let WebGLNode=zh;WebGLNode.prototype._mutatorKeys=WEBGL_NODE_OPTION_KEYS.concat(Node$2.prototype._mutatorKeys);scenery.register("WebGLNode",WebGLNode);class Plane extends Rectangle{constructor(t){super(-2e3,-2e3,6e3,6e3,t)}}scenery.register("Plane",Plane);const Leaf=memoize(a=>class extends a{constructor(...s){super(...s)}insertChild(s,r){throw new Error("Attempt to insert child into Leaf")}removeChildWithIndex(s,r){throw new Error("Attempt to remove child from Leaf")}});scenery.register("Leaf",Leaf);class Spacer extends Leaf(Node$2){constructor(t,s,r){assert&&assert(isFinite(t),"width should be a finite number"),assert&&assert(isFinite(s),"height should be a finite number"),super(),this.localBounds=new Bounds2(0,0,t,s),this.mutate(r)}}scenery.register("Spacer",Spacer);class HStrut extends Spacer{constructor(t,s){super(t,0,s)}}scenery.register("HStrut",HStrut);class VStrut extends Spacer{constructor(t,s){super(0,t,s)}}scenery.register("VStrut",VStrut);let globalIdCounter$3=1;const scratchVector=new Vector2(0,0);class SpriteImage extends Imageable$1(Object){constructor(t,s,r){assert&&assert(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement);const o={hitTestPixels:!1,pickable:!0};isTReadOnlyProperty(t)?o.imageProperty=t:o.image=t;const n=optionize()(o,r);super(),this.id=globalIdCounter$3++,this.offset=s,this.pickable=n.pickable,this.shape=null,this.imageData=null,isTReadOnlyProperty(t)?this.imageProperty=t:this.image=t,mutate(this,Object.keys(Imageable$1.DEFAULT_OPTIONS),n)}get width(){return this.imageWidth}get height(){return this.imageHeight}getShape(){if(!this.pickable)return new Shape$1;if(!this.shape){if(this.hitTestPixels)if(this.ensureImageData(),this.imageData)this.shape=Imageable$1.hitTestDataToShape(this.imageData,this.width,this.height);else return new Shape$1;else if(this.width&&this.height)this.shape=Shape$1.rect(0,0,this.width,this.height);else return new Shape$1;this.shape=this.shape.transformed(Matrix3.translation(-this.offset.x,-this.offset.y))}return this.shape}ensureImageData(){!this.imageData&&this.width&&this.height&&(this.imageData=Imageable$1.getHitTestData(this.image,this.width,this.height))}containsPoint(t){if(!this.pickable)return!1;const s=this.width,r=this.height;if(!s&&!r)return!1;const o=scratchVector.set(t).add(this.offset);return o.x<0||o.y<0||o.x>s||o.y>r?!1:this.hitTestPixels?(this.ensureImageData(),this.imageData?Imageable$1.testHitTestData(this.imageData,s,r,o):!1):!0}}scenery.register("SpriteImage",SpriteImage);class Sprite{constructor(t){this.imageProperty=new Property(t)}getShape(){return this.imageProperty.value.getShape()}containsPoint(t){return this.imageProperty.value.containsPoint(t)}}scenery.register("Sprite",Sprite);class PaintObserver{constructor(t){this.primary=null,this.changeCallback=t,this.notifyChangeCallback=this.notifyChanged.bind(this),this.updateSecondaryListener=this.updateSecondary.bind(this),this.secondaryPropertyCountsMap={}}setPrimary(t){t!==this.primary&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] primary update"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.detachPrimary(this.primary),this.primary=t,this.attachPrimary(t),this.notifyChangeCallback(),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop())}clean(){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] clean"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.detachPrimary(this.primary),this.primary=null,sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}updateSecondary(t,s,r){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] secondary update"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();const o=this.secondaryPropertyCountsMap[r.id];assert&&assert(o>0,"We should always be removing at least one reference");for(let n=0;n<o;n++)this.attachSecondary(t);this.notifyChangeCallback(),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}attachPrimary(t){if(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] attachPrimary"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),isTReadOnlyProperty(t))sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] add Property listener"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.secondaryLazyLinkProperty(t),this.attachSecondary(t.get()),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop();else if(t instanceof Color)sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] Color changed to immutable"),t.setImmutable();else if(t instanceof Gradient){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] add Gradient listeners"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();for(let s=0;s<t.stops.length;s++)this.attachPrimary(t.stops[s].color);sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}detachPrimary(t){if(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] detachPrimary"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),isTReadOnlyProperty(t))sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] remove Property listener"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.secondaryUnlinkProperty(t),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop();else if(t instanceof Gradient){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] remove Gradient listeners"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();for(let s=0;s<t.stops.length;s++)this.detachPrimary(t.stops[s].color);sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}attachSecondary(t){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] attachSecondary"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),t instanceof Color&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] Color set to immutable"),t.setImmutable()),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}notifyChanged(){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] changed"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.primary instanceof Gradient&&this.primary.invalidateCanvasGradient(),this.changeCallback(),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}secondaryLazyLinkProperty(t){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[PaintObserver] secondaryLazyLinkProperty ${t._id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();const s=t.id;this.secondaryPropertyCountsMap[s]?this.secondaryPropertyCountsMap[s]++:(this.secondaryPropertyCountsMap[s]=1,t.lazyLink(this.updateSecondaryListener)),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}secondaryUnlinkProperty(t){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[PaintObserver] secondaryUnlinkProperty ${t._id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();const s=t.id,r=--this.secondaryPropertyCountsMap[s];assert&&assert(r>=0,"We should have had a reference before"),r===0&&(delete this.secondaryPropertyCountsMap[s],t.isDisposed||t.unlink(this.updateSecondaryListener)),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}}scenery.register("PaintObserver",PaintObserver);class PaintColorProperty extends Property{constructor(t,s){const r=PaintDef.toColor(t),o=optionize()({luminanceFactor:0,valueComparisonStrategy:"equalsFunction"},s);super(r,o),this._paint=null,this._luminanceFactor=o.luminanceFactor,this._changeListener=this.invalidatePaint.bind(this),this._paintObserver=new PaintObserver(this._changeListener),this.setPaint(t)}setPaint(t){assert&&assert(PaintDef.isPaintDef(t)),this._paint=t,this._paintObserver.setPrimary(t)}set paint(t){this.setPaint(t)}get paint(){return this.getPaint()}getPaint(){return this._paint}setLuminanceFactor(t){assert&&assert(t>=-1&&t<=1),this.luminanceFactor!==t&&(this._luminanceFactor=t,this.invalidatePaint())}set luminanceFactor(t){this.setLuminanceFactor(t)}get luminanceFactor(){return this.getLuminanceFactor()}getLuminanceFactor(){return this._luminanceFactor}invalidatePaint(){this.value=PaintDef.toColor(this._paint).colorUtilsBrightness(this._luminanceFactor)}dispose(){this.paint=null,super.dispose()}}scenery.register("PaintColorProperty",PaintColorProperty);class PaintSVGState{constructor(){this.initialize()}initialize(){this.svgBlock=null,this.fillStyle="none",this.strokeStyle="none",this.fillPaint=null,this.strokePaint=null,this.updateBaseStyle(),this.strokeDetailStyle=""}dispose(){this.releaseFillPaint(),this.releaseStrokePaint()}releaseFillPaint(){this.fillPaint&&(this.svgBlock.decrementPaint(this.fillPaint),this.fillPaint=null)}releaseStrokePaint(){this.strokePaint&&(this.svgBlock.decrementPaint(this.strokePaint),this.strokePaint=null)}updateFill(t,s){assert&&assert(this.svgBlock===t);const r=paintToSVGStyle(s,t);s!==this.fillPaint&&(this.releaseFillPaint(),s&&s.isPaint&&(this.fillPaint=s,t.incrementPaint(s))),r!==this.fillStyle&&(this.fillStyle=r,this.updateBaseStyle())}updateStroke(t,s){assert&&assert(this.svgBlock===t);const r=paintToSVGStyle(s,t);s!==this.strokePaint&&(this.releaseStrokePaint(),s&&s.isPaint&&(this.strokePaint=s,t.incrementPaint(s))),r!==this.strokeStyle&&(this.strokeStyle=r,this.updateBaseStyle())}updateBaseStyle(){this.baseStyle=`fill: ${this.fillStyle}; stroke: ${this.strokeStyle};`}updateStrokeDetailStyle(t){let s="";const r=t.getLineWidth();r!==1&&(s+=`stroke-width: ${r};`);const o=t.getLineCap();o!=="butt"&&(s+=`stroke-linecap: ${o};`);const n=t.getLineJoin();n!=="miter"&&(s+=`stroke-linejoin: ${n};`);const l=t.getMiterLimit();s+=`stroke-miterlimit: ${l};`,t.hasLineDash()&&(s+=`stroke-dasharray: ${t.getLineDash().join(",")};`,s+=`stroke-dashoffset: ${t.getLineDashOffset()};`),this.strokeDetailStyle=s}updateSVGBlock(t){const s=this.svgBlock;s&&(this.fillPaint&&s.decrementPaint(this.fillPaint),this.strokePaint&&s.decrementPaint(this.strokePaint)),this.svgBlock=t,this.fillPaint&&t.incrementPaint(this.fillPaint),this.strokePaint&&t.incrementPaint(this.strokePaint)}}function paintToSVGStyle(a,t){return a?a.toCSS?a.toCSS():a.isPaint?`url(#${a.id}-${t?t.id:"noblock"})`:a:"none"}scenery.register("PaintSVGState",PaintSVGState);const scratchColor$1=new Color("transparent"),ql=class ql{constructor(t,s,r){this.lastColor=null,this.initialize(t,s,r)}isActiveSVGGradientStop(){return!!this.svgGradient}initialize(t,s,r){return sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] initialize: ${t.gradient.id} : ${s}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.svgGradient=t,this.color=r,this.ratio=s,this.svgElement=this.svgElement||document.createElementNS(svgns,"stop"),this.svgElement.setAttribute("offset",""+s),this.dirty=!0,this.update(),this.propertyListener=this.propertyListener||this.onPropertyChange.bind(this),this.colorListener=this.colorListener||this.markDirty.bind(this),isTReadOnlyProperty(r)?(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] adding Property listener: ${this.svgGradient.gradient.id} : ${this.ratio}`),r.lazyLink(this.propertyListener),r.value instanceof Color&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] adding Color listener: ${this.svgGradient.gradient.id} : ${this.ratio}`),r.value.changeEmitter.addListener(this.colorListener),this.lastColor=r.value)):r instanceof Color&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] adding Color listener: ${this.svgGradient.gradient.id} : ${this.ratio}`),r.changeEmitter.addListener(this.colorListener)),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop(),this}onPropertyChange(t,s){assert&&assert(this.isActiveSVGGradientStop());const r=this;this.lastColor!==null&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] removing Color listener: ${r.svgGradient.gradient.id} : ${this.ratio}`),this.lastColor.changeEmitter.removeListener(this.colorListener),this.lastColor=null),t instanceof Color&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] adding Color listener: ${r.svgGradient.gradient.id} : ${this.ratio}`),t.changeEmitter.addListener(this.colorListener),this.lastColor=t),this.markDirty()}markDirty(){assert&&assert(this.isActiveSVGGradientStop()),this.dirty=!0,this.svgGradient.markDirty()}update(){if(!this.dirty)return;this.dirty=!1,assert&&assert(this.isActiveSVGGradientStop());const t=this;sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] update: ${t.svgGradient.gradient.id} : ${this.ratio}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();let s=this.color;isTReadOnlyProperty(s)&&(s=s.value),s===null&&(s="transparent"),typeof s=="string"?scratchColor$1.setCSS(s):scratchColor$1.set(s);const r=`stop-opacity: ${scratchColor$1.a.toFixed(20)};`;scratchColor$1.alpha=1;const o=`stop-color: ${scratchColor$1.toCSS()};`;this.svgElement.setAttribute("style",`${o} ${r}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}dispose(){assert&&assert(this.isActiveSVGGradientStop());const t=this;sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] dispose: ${t.svgGradient.gradient.id} : ${this.ratio}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();const s=this.color;this.lastColor&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] removing Color listener: ${t.svgGradient.gradient.id} : ${this.ratio}`),this.lastColor.changeEmitter.removeListener(this.colorListener),this.lastColor=null),isTReadOnlyProperty(s)?(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] removing Property listener: ${t.svgGradient.gradient.id} : ${this.ratio}`),s.hasListener(this.propertyListener)&&s.unlink(this.propertyListener)):s instanceof Color&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] removing Color listener: ${t.svgGradient.gradient.id} : ${this.ratio}`),s.changeEmitter.removeListener(this.colorListener)),this.color=null,this.svgGradient=null,this.freeToPool(),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}freeToPool(){ql.pool.freeToPool(this)}};ql.pool=new Pool(ql);let SVGGradientStop=ql;scenery.register("SVGGradientStop",SVGGradientStop);class SVGGradient{constructor(t,s){this.initialize(t,s)}isActiveSVGGradient(){return!!this.svgBlock}initialize(t,s){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradient] initialize ${s.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.svgBlock=t,this.gradient=s;const r=this.definition!==void 0;this.definition=this.definition||this.createDefinition(),r||this.definition.setAttribute("gradientUnits","userSpaceOnUse"),s.transformMatrix?this.definition.setAttribute("gradientTransform",s.transformMatrix.getSVGTransform()):this.definition.removeAttribute("gradientTransform");const o=s.getSVGStops();this.stops=cleanArray(this.stops);for(let n=0;n<o.length;n++){const l=new SVGGradientStop(this,o[n].ratio,o[n].color);this.stops.push(l),this.definition.appendChild(l.svgElement)}this.dirty=!1,sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}markDirty(){if(!this.dirty){assert&&assert(this.isActiveSVGGradient());const t=this;sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradient] switched to dirty: ${this.gradient.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.dirty=!0,t.svgBlock.markDirtyGradient(this),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}}update(){if(this.dirty){this.dirty=!1,sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradient] update: ${this.gradient.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();for(let t=0;t<this.stops.length;t++)this.stops[t].update();sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}}dispose(){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradient] dispose ${this.gradient.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();for(let t=0;t<this.stops.length;t++){const s=this.stops[t];this.definition.removeChild(s.svgElement),s.dispose()}cleanArray(this.stops),this.svgBlock=null,this.gradient=null,this.freeToPool(),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}}scenery.register("SVGGradient",SVGGradient);const Hl=class Hl extends SVGGradient{constructor(t,s){super(t,s)}initialize(t,s){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGLinearGradient] initialize ${s.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),super.initialize(t,s);const r=s;return this.definition.setAttribute("x1",""+r.start.x),this.definition.setAttribute("y1",""+r.start.y),this.definition.setAttribute("x2",""+r.end.x),this.definition.setAttribute("y2",""+r.end.y),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop(),this}createDefinition(){return document.createElementNS(svgns,"linearGradient")}freeToPool(){Hl.pool.freeToPool(this)}};Hl.pool=new Pool(Hl);let SVGLinearGradient=Hl;scenery.register("SVGLinearGradient",SVGLinearGradient);const zl=class zl extends SVGGradient{constructor(t,s){super(t,s)}initialize(t,s){return sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGRadialGradient] initialize ${s.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),super.initialize(t,s),this.definition.setAttribute("cx",""+s.largePoint.x),this.definition.setAttribute("cy",""+s.largePoint.y),this.definition.setAttribute("r",""+s.maxRadius),this.definition.setAttribute("fx",""+s.focalPoint.x),this.definition.setAttribute("fy",""+s.focalPoint.y),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop(),this}createDefinition(){return document.createElementNS(svgns,"radialGradient")}freeToPool(){zl.pool.freeToPool(this)}};zl.pool=new Pool(zl);let SVGRadialGradient=zl;scenery.register("SVGRadialGradient",SVGRadialGradient);const $l=class $l{constructor(t){this.initialize(t)}initialize(t){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGPattern] initialize: ${t.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();const s=this.definition!==void 0;return this.definition=this.definition||document.createElementNS(svgns,"pattern"),s||(this.definition.setAttribute("patternUnits","userSpaceOnUse"),this.definition.setAttribute("patternContentUnits","userSpaceOnUse")),t.transformMatrix?this.definition.setAttribute("patternTransform",t.transformMatrix.getSVGTransform()):this.definition.removeAttribute("patternTransform"),this.definition.setAttribute("x","0"),this.definition.setAttribute("y","0"),this.definition.setAttribute("width",""+t.image.width),this.definition.setAttribute("height",""+t.image.height),this.imageElement=this.imageElement||document.createElementNS(svgns,"image"),this.imageElement.setAttribute("x","0"),this.imageElement.setAttribute("y","0"),this.imageElement.setAttribute("width",`${t.image.width}px`),this.imageElement.setAttribute("height",`${t.image.height}px`),this.imageElement.setAttributeNS(xlinkns,"xlink:href",t.image.src),s||this.definition.appendChild(this.imageElement),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop(),this}update(){}dispose(){this.freeToPool()}freeToPool(){$l.pool.freeToPool(this)}};$l.pool=new Pool($l);let SVGPattern=$l;scenery.register("SVGPattern",SVGPattern);class TransformTracker{constructor(t,s){this._matrices=null,this._dirtyIndex=0,this._listeners=[],this._nodeTransformListeners=[];const r=optionize()({isStatic:!1},s);this._isStatic=r.isStatic,this.trail=t,this._nodeTransformListeners=[];for(let o=1;o<this.trail.length;o++){const n=(l=>()=>{this.onTransformChange(l)})(o-1);this._nodeTransformListeners.push(n),t.nodes[o].transformEmitter.addListener(n)}}dispose(){for(let t=1;t<this.trail.length;t++){const s=this._nodeTransformListeners[t-1];this.trail.nodes[t].transformEmitter.hasListener(s)&&this.trail.nodes[t].transformEmitter.removeListener(s)}}addListener(t){this._listeners.push(t)}removeListener(t){const s=_.indexOf(this._listeners,t);assert&&assert(s>=0,"TransformTracker listener not found"),this._listeners.splice(s,1)}notifyListeners(){let t=this._listeners;this._isStatic||(t=t.slice());const s=t.length;for(let r=0;r<s;r++)t[r]()}onTransformChange(t){this._dirtyIndex=Math.min(this._dirtyIndex,t),this.notifyListeners()}getMatrix(){if(this._matrices===null){this._matrices=[];for(let s=1;s<this.trail.length;s++)this._matrices.push(new Matrix3)}if(this._matrices.length<=0)return Matrix3.IDENTITY;const t=this._matrices.length;for(let s=this._dirtyIndex;s<t;s++){const r=this.trail.nodes[s+1].matrix;s===0?this._matrices[s].set(r):(this._matrices[s].set(this._matrices[s-1]),this._matrices[s].multiplyMatrix(r))}return this._dirtyIndex=t,this._matrices[t-1]}get matrix(){return this.getMatrix()}}scenery.register("TransformTracker",TransformTracker);const TransformTracker$1=TransformTracker;class TrailVisibilityTracker{constructor(t,s){s=merge({isStatic:!1},s),this.isStatic=s.isStatic,this.trail=t,this._listeners=[],this.trailVisibleProperty=new TinyProperty(this.trail.isVisible()),this._nodeVisibilityListeners=[];for(let r=0;r<this.trail.length;r++){const o=()=>{this.trailVisibleProperty.set(t.isVisible())};this._nodeVisibilityListeners.push(o),t.nodes[r].visibleProperty.link(o)}this.boundTrailVisibilityChangedListener=this.onVisibilityChange.bind(this),this.trailVisibleProperty.link(this.boundTrailVisibilityChangedListener)}addListener(t){assert&&assert(typeof t=="function"),this._listeners.push(t)}removeListener(t){assert&&assert(typeof t=="function");const s=_.indexOf(this._listeners,t);assert&&assert(s>=0,"TrailVisibilityTracker listener not found"),this._listeners.splice(s,1)}dispose(){for(let t=0;t<this.trail.length;t++){const s=this._nodeVisibilityListeners[t];this.trail.nodes[t].visibleProperty.hasListener(s)&&this.trail.nodes[t].visibleProperty.removeListener(s)}this.trailVisibleProperty.unlink(this.boundTrailVisibilityChangedListener)}onVisibilityChange(){this.notifyListeners()}notifyListeners(){let t=this._listeners;this._isStatic||(t=t.slice());const s=t.length;for(let r=0;r<s;r++)t[r]()}}scenery.register("TrailVisibilityTracker",TrailVisibilityTracker);const AriaHasPopUpMutator={mutateNode(a,t){t?a.setPDOMAttribute("aria-haspopup",t):(assert&&assert(a.hasPDOMAttribute("aria-haspopup"),"Set aria-haspopup once before removing it."),a.removePDOMAttribute("aria-haspopup")),a.positionInPDOM=!!t}};scenery.register("AriaHasPopUpMutator",AriaHasPopUpMutator);class FocusableHeadingNode extends Node$2{constructor(t){const s=optionize()({headingLevel:1},t);super(s),this.tagName=`h${s.headingLevel}`,this.focusHighlight="invisible";const r={blur:()=>{this.focusable=!1}};this.addInputListener(r),this.disposeFocusableHeadingNode=()=>{this.removeInputListener(r)}}focus(){this.focusable=!0,super.focus()}dispose(){this.disposeFocusableHeadingNode(),super.dispose()}}scenery.register("FocusableHeadingNode",FocusableHeadingNode);const SPACE=" ",END_OF_DOCUMENT="End of Document",COMMA=",",LINE_WORD_LENGTH=15,NEXT="NEXT",PREVIOUS="PREVIOUS";class Cursor{constructor(t){const s=this;this.outputUtteranceProperty=new Property(new Utterance$1(document.title,"off")),this.linearDOM=this.getLinearDOMElements(t),this.activeElement=null,this.activeLine=null,this.letterPosition=0,this.positionInLine=0,this.wordPosition=0,this.observers=[],this.keyState={},document.addEventListener("keydown",r=>{this.keyState[r.keyCode]=!0;let o;const l=r.shiftKey?PREVIOUS:NEXT;if(this.linearDOM=this.getLinearDOMElements(t),this.updateLiveElementList(),!(this.activeElement&&this.activeElement.getAttribute("role")==="application")){if(this.keyState[40]&&!this.keyState[45])o=this.readNextPreviousLine(NEXT);else if(this.keyState[38]&&!this.keyState[45])o=this.readNextPreviousLine(PREVIOUS);else if(this.keyState[72]){const h=["H1","H2","H3","H4","H5","H6"];o=this.readNextPreviousHeading(h,l)}else this.keyState[9]||(this.keyState[39]&&!this.keyState[17]?o=this.readNextPreviousCharacter(NEXT):this.keyState[37]&&!this.keyState[17]?o=this.readNextPreviousCharacter(PREVIOUS):this.keyState[37]&&this.keyState[17]?o=this.readNextPreviousWord(PREVIOUS):this.keyState[39]&&this.keyState[17]?o=this.readNextPreviousWord(NEXT):this.keyState[45]&&this.keyState[38]?o=this.readActiveLine():this.keyState[49]?o=this.readNextPreviousHeading(["H1"],l):this.keyState[50]?o=this.readNextPreviousHeading(["H2"],l):this.keyState[51]?o=this.readNextPreviousHeading(["H3"],l):this.keyState[52]?o=this.readNextPreviousHeading(["H4"],l):this.keyState[53]?o=this.readNextPreviousHeading(["H5"],l):this.keyState[54]?o=this.readNextPreviousHeading(["H6"],l):this.keyState[70]?o=this.readNextPreviousFormElement(l):this.keyState[66]?o=this.readNextPreviousButton(l):this.keyState[76]?o=this.readNextPreviousList(l):this.keyState[73]?o=this.readNextPreviousListItem(l):this.keyState[45]&&this.keyState[40]&&this.readEntireDocument());this.activeElement&&this.isFocusable(this.activeElement)&&this.activeElement.focus(),o===SPACE&&(o="space"),o&&this.outputUtteranceProperty.set(new Utterance$1(o,"off"))}}),document.addEventListener("keyup",r=>{this.keyState[r.keyCode]=!1}),document.addEventListener("focusin",function(r){if(r.target!==s.activeElement){s.activeElement=r.target;const n=s.getAccessibleText(this.activeElement,!0);if(n){const l=s.activeElement.getAttribute("aria-live");s.outputUtteranceProperty.set(new Utterance$1(n,l))}}})}getLinearDOMElements(t){const s=t.getElementsByTagName("*"),r=[];for(let o=0;o<s.length;o++)s[o].nodeType===Node.ELEMENT_NODE&&(r[o]=s[o]);return r}getLiveRole(t){let s=null;return["log","status","alert","progressbar","marquee","timer","assertive","polite"].forEach(o=>{(t.getAttribute("aria-live")===o||t.getAttribute("role")===o)&&(s=o)}),s}getNextPreviousElement(t){this.activeElement||(this.activeElement=this.linearDOM[0]);const s=t==="NEXT"?1:-1,o=this.linearDOM.indexOf(this.activeElement)+s;return this.linearDOM[o]}getLabel(t){const s=document.getElementsByTagName("label");let r;return Array.prototype.forEach.call(s,o=>{o.getAttribute("for")&&(r=o)}),assert&&assert(r,"No label found for id"),r}getAccessibleText(t,s){let r="";if(!t)return END_OF_DOCUMENT;if(t.getAttribute("class")==="ScreenView"||t.tagName==="HEADER"||t.tagName==="SECTION"||t.tagName==="LABEL")return null;let o=t;for(;o.parentElement;){if(o.getAttribute("aria-hidden")||o.hidden)return null;o=o.parentElement}if(t.tagName==="P"&&(r+=t.textContent),t.tagName==="H1"&&(r+=`Heading Level 1, ${t.textContent}`),t.tagName==="H2"&&(r+=`Heading Level 2, ${t.textContent}`),t.tagName==="H3"&&(r+=`Heading Level 3, ${t.textContent}`),t.tagName==="UL"){const n=t.children.length;r+=`List with ${n} items`}if(t.tagName==="LI"&&(r+=`List Item: ${t.textContent}`),t.tagName==="BUTTON"){const n=" Button";if(t.getAttribute("aria-pressed")){let l=" toggle";const h=" pressed",g=" not";l+=n+COMMA,t.getAttribute("aria-pressed")==="true"?l+=h:l+=g+h,r+=t.textContent+COMMA+l}else r+=t.textContent+n}if(t.tagName==="INPUT"&&(t.type==="reset"&&(r+=`${t.getAttribute("value")} Button`),t.type==="checkbox")){const l=this.getLabel(t.id).textContent;if(t.getAttribute("role")==="switch"){const h=t.getAttribute("aria-checked");if(h){const g=h==="true"?"On":"Off";r+=`${l+COMMA+SPACE}switch${COMMA}${SPACE}${g}`}else assert&&assert(!1,"checkbox switch must have aria-checked attribute")}else{const h=t.checked?" Checked":" Not Checked";r+=`${t.textContent} Checkbox${h}`}}if(s){r.length>0&&(r+=COMMA);const n=t.getAttribute("aria-label");n&&(r+=SPACE+n+COMMA);const l=t.getAttribute("aria-labelledBy");if(l){const A=document.getElementById(l).textContent;r+=SPACE+A+COMMA}o=t;let h;for(;o.parentElement;)if(h=o.getAttribute("role"),h==="document"||h==="application"){r+=SPACE+h+COMMA;break}else o=o.parentElement;t.getAttribute("role")&&(h=t.getAttribute("role"),h==="button"&&(r+=`${SPACE}Button`)),t.draggable&&(r+=`${SPACE}draggable${COMMA}`),t.getAttribute("aria-grabbed")==="true"&&(r+=`${SPACE}grabbed${COMMA}`);const g=t.getAttribute("aria-describedby");if(g){const d=g.split(SPACE);let A,S;d.forEach(O=>{A=document.getElementById(O),S=A.textContent,r+=SPACE+S})}}return r[r.length-1]===","&&(r=r.slice(0,-1)),r}getNextPreviousElementWithPDOMContent(t){let s;for(;!s;)this.activeElement=this.getNextPreviousElement(t),s=this.getAccessibleText(this.activeElement,!1);return this.activeElement}getNextPreviousElementWithRole(t,s){let r=null;const o=s===NEXT?1:-1;this.activeElement||(this.activeElement=this.linearDOM[0]);let n=this.linearDOM.indexOf(this.activeElement)+o;for(;this.linearDOM[n];){for(let l=0;l<t.length;l++){const h=this.linearDOM[n].tagName,g=this.linearDOM[n].type,d=this.linearDOM[n].getAttribute("role"),A=t[l];if(h===A||d===A||g===A){r=this.linearDOM[n];break}}if(r)break;n+=o}return r}readNextPreviousLine(t){let s="";this.letterPosition=0,this.wordPosition=0,this.activeElement||(this.activeElement=this.getNextPreviousElementWithPDOMContent(t));let r=this.getAccessibleText(this.activeElement,!1).split(SPACE);if(t===PREVIOUS&&(this.positionInLine=this.positionInLine-2*LINE_WORD_LENGTH),!r[this.positionInLine]){this.positionInLine=0;const n=this.activeElement;this.activeElement=this.getNextPreviousElementWithPDOMContent(t),r=this.getAccessibleText(this.activeElement,!1).split(" "),this.activeElement||(this.activeElement=n)}const o=this.positionInLine+LINE_WORD_LENGTH;for(let n=this.positionInLine;n<o;n++)if(r[n])if(s+=r[n],this.positionInLine+=1,r[n+1])s+=SPACE;else{this.positionInLine+=LINE_WORD_LENGTH-this.positionInLine%LINE_WORD_LENGTH;break}return this.activeLine=s,s}readActiveLine(){let t="";this.activeLine||(this.activeLine=this.readNextPreviousLine(NEXT));const s=this.activeLine.split(SPACE);for(let r=0;r<LINE_WORD_LENGTH;r++)if(s[r])if(t+=s[r],s[r+1])t+=SPACE;else break;return t}readNextPreviousWord(t){this.activeLine||(this.activeLine=this.readNextPreviousLine(t));const s=this.activeLine.split(SPACE);let r,o;t===NEXT?(o=s.length,r=1):t===PREVIOUS&&(o=0,r=-2),this.wordPosition===o&&(this.activeLine=this.readNextPreviousLine(t));const n=s[this.wordPosition];return this.wordPosition+=r,n}readNextPreviousHeading(t,s){let r,o,n;for(;!r;)n=this.activeElement,o=this.getNextPreviousElementWithRole(t,s),this.activeElement=o,r=this.getAccessibleText(o);if(!o){this.activeElement=n;const l=s===NEXT?"more":"previous";if(t.length===1){const h=`No ${l} headings at `,g=t[0];return h+(g==="H1"?"Level 1":g==="H2"?"Level 2":g==="H3"?"Level 3":g==="H4"?"Level 4":g==="H5"?"Level 5":"Level 6")}return`No ${l} headings`}return this.activeElement=o,r}readNextPreviousButton(t){const s=["button","BUTTON","submit","reset"];let r,o,n;for(;!o;)n=this.activeElement,r=this.getNextPreviousElementWithRole(s,t),this.activeElement=r,o=this.getAccessibleText(r,!0);return r?(this.activeElement=r,o):(this.activeElement=n,`No ${t===NEXT?"more":"previous"} buttons`)}readNextPreviousFormElement(t){const s=["INPUT","BUTTON"],r=["button"],o=s.concat(r);let n,l,h;for(;!l;)h=this.activeElement,n=this.getNextPreviousElementWithRole(o,t),this.activeElement=n,l=this.getAccessibleText(n,!0);return l===END_OF_DOCUMENT?(this.activeElement=h,`No ${t===NEXT?"next":"previous"} form field`):(this.activeElement=n,l)}readNextPreviousListItem(t){this.activeElement||(this.activeElement=this.getNextPreviousElementWithPDOMContent(t));let s;const r=this.activeElement.parentElement;if(r.tagName==="UL"||r.tagName==="OL"){const o=t===NEXT?1:-1;let n=Array.prototype.indexOf.call(r.children,this.activeElement)+o;for(;r.children[n];){if(s=this.getAccessibleText(r.children[n]),s){this.activeElement=r.children[n];break}n+=o}s||(s=this.readNextPreviousList(t))}else s=this.readNextPreviousList(t);return s||`No ${t===NEXT?"more":"previous"} list items`}readNextPreviousList(t){this.activeElement||(this.activeElement=this.getNextPreviousElementWithPDOMContent(t));const s=this.activeElement.parentElement;let r;(s.tagName==="UL"||s.tagName==="OL")&&(r=this.activeElement,this.activeElement=s);const o=this.getNextPreviousElementWithRole(["UL","OL"],t);if(!o)return r&&(this.activeElement=r),`No ${t===NEXT?"more":"previous"} lists`;const n=this.getAccessibleText(o);let l="";const h=o.children[0];return h&&(l=this.getAccessibleText(h),this.activeElement=h),`${n}, ${l}`}readNextPreviousCharacter(t){this.activeLine||(this.activeLine=this.readNextPreviousLine(NEXT));let s,r,o;t===NEXT?(s=this.activeLine.length,r=1,o=0):t===PREVIOUS&&(s=2,r=-1,o=-2),this.letterPosition===s&&(this.activeLine=this.readNextPreviousLine(t),this.letterPosition=this.activeLine.length);const n=this.activeLine[this.letterPosition+o];return this.letterPosition+=r,n}updateLiveElementList(){for(let t=0;t<this.observers.length;t++)this.observers[t]&&this.observers[t].disconnect();this.observers=[];for(let t=0;t<this.linearDOM.length;t++){const s=this.linearDOM[t];if(this.getLiveRole(s)){const o=h=>{h.forEach(g=>{let d,A=g.target;for(;!d;)d=this.getLiveRole(A),A=A.parentElement;if(g.addedNodes[0]){const S=g.addedNodes[0].data;this.outputUtteranceProperty.set(new Utterance$1(S,d))}})},n=new MutationObserver(h=>{o(h)}),l={childList:!0,subtree:!0};n.observe(s,l),this.observers.push(n)}}}readEntireDocument(){const t="polite";let s=this.getAccessibleText(this.activeElement),r=this.activeElement;for(;s!==END_OF_DOCUMENT;)r=this.activeElement,s=this.readNextPreviousLine(NEXT),s===END_OF_DOCUMENT&&(this.activeElement=r),this.outputUtteranceProperty.set(new Utterance$1(s,t))}isFocusable(t){const s=["tabindex","BUTTON","INPUT"];let r=!1;return s.forEach(o=>{(t.getAttribute(o)||t.tagName===o)&&(r=!0)}),r}}scenery.register("Cursor",Cursor);let Utterance$1=class{constructor(t,s){this.text=t,this.liveRole=s}};class Reader{constructor(t){this.speakingStartedEmitter=new Emitter({parameters:[{valueType:Object}]}),this.speakingEndedEmitter=new Emitter({parameters:[{valueType:Object}]}),this.speaking=!1,this.politeUtterances=[];const s=navigator.userAgent,r=s.match(/Windows/),o=!!(s.match(/Version\/[5-9]\./)&&s.match(/Safari\//)&&s.match(/AppleWebKit/));window.speechSynthesis&&SpeechSynthesisUtterance&&window.speechSynthesis.speak?(this.synth=window.speechSynthesis,t.outputUtteranceProperty.link(n=>{const l=new SpeechSynthesisUtterance(n.text);l.addEventListener("start",g=>{this.speakingStartedEmitter.emit(n)}),l.addEventListener("end",g=>{this.speakingEndedEmitter.emit(n)});let h;if(this.synth.getVoices().forEach(g=>{g.default&&(h=g)}),l.voice=h,l.rate=1.2,n.liveRole==="assertive"||n.liveRole==="off"||!n.liveRole)this.politeUtterances=[],this.speaking=!0,r?(this.synth.pause(),this.synth.cancel(),this.synth.speak(l),this.synth.resume()):(this.synth.cancel(),this.synth.speak(l));else if(n.liveRole==="polite")if(o){this.politeUtterances.push(l);const g=()=>{this.speaking=!0;const d=this.politeUtterances.shift();d?this.synth.speak(d):this.speaking=!1};if(this.speaking)setTimeout(()=>{g()},2e3);else{this.synth.speak(l);const d=this.politeUtterances.indexOf(l);d>0&&this.politeUtterances.splice(d,1)}}else this.synth.speak(l)})):t.outputUtteranceProperty.link(()=>{this.speakingStartedEmitter.emit({text:"Sorry! Web Speech API not supported on this platform."})})}}scenery.register("Reader",Reader);const EMPTY_ARRAY=[],PHET_IO_STATE_DEFAULT=!1,Ul=class Ul extends PhetioDataHandler{constructor(t,s){var o;const r=optionize()({parameters:EMPTY_ARRAY,phetioOuterType:Ul.PhetioActionIO,phetioState:PHET_IO_STATE_DEFAULT,phetioReadOnly:PhetioObject.DEFAULT_OPTIONS.phetioReadOnly,phetioHighFrequency:PhetioObject.DEFAULT_OPTIONS.phetioHighFrequency,phetioEventType:PhetioObject.DEFAULT_OPTIONS.phetioEventType,phetioDocumentation:"A class that wraps a function, adding API to execute that function and data stream capture."},s);super(r),this.action=t,this.isExecutingCount=0,this.disposeOnExecuteCompletion=!1,this.executedEmitter=new Emitter({parameters:r.parameters,tandem:(o=r.tandem)==null?void 0:o.createTandem("executedEmitter"),hasListenerOrderDependencies:r.hasListenerOrderDependencies,phetioState:r.phetioState,phetioReadOnly:r.phetioReadOnly,phetioHighFrequency:r.phetioHighFrequency,phetioEventType:r.phetioEventType,phetioDocumentation:"Emitter that emits when this actions work is complete"}),this.disposePhetioAction=()=>{this.executedEmitter.dispose()}}execute(...t){assert&&assert(!this.isDisposed,"should not be called if disposed"),assert&&assert(!this.executedEmitter.isDisposed,"self should not be disposed"),this.isExecutingCount++,assert&&super.validateArguments(...t),Tandem.PHET_IO_ENABLED&&this.isPhetioInstrumented()&&this.phetioStartEvent("executed",{data:this.getPhetioData(...t)}),this.action.apply(null,t),this.executedEmitter.emit(...t),Tandem.PHET_IO_ENABLED&&this.isPhetioInstrumented()&&this.phetioEndEvent(),this.isExecutingCount--,this.disposeOnExecuteCompletion&&this.isExecutingCount===0&&(this.disposePhetioAction(),this.disposeOnExecuteCompletion=!1)}dispose(){this.isExecutingCount>0?this.disposeOnExecuteCompletion=!0:this.disposePhetioAction(),super.dispose()}};Ul.PhetioActionIO=t=>{const s=t.map(getTypeName).join(",");return cache.has(s)||cache.set(s,new IOType(`PhetioActionIO<${t.map(getTypeName).join(", ")}>`,{valueType:Ul,documentation:"Executes when an event occurs",events:["executed"],parameterTypes:t,metadataDefaults:{phetioState:PHET_IO_STATE_DEFAULT},methods:{execute:{returnType:VoidIO,parameterTypes:t,implementation:function(...r){this.execute(...r)},documentation:"Executes the function the PhetioAction is wrapping.",invocableForReadOnlyElements:!1},getValidationErrors:{returnType:ArrayIO(NullableIO(StringIO)),parameterTypes:t,implementation:function(...r){return this.getValidationErrors(...r)},documentation:"Checks to see if the proposed values are valid. Returns an array of length N where each element is an error (string) or null if the value is valid."}}})),cache.get(s)};let PhetioAction=Ul;const getTypeName=a=>a.typeName,cache=new IOTypeCache;tandemNamespace.register("PhetioAction",PhetioAction);const PhetioAction$1=PhetioAction;class KeyStateTracker{constructor(t){var r,o;this.keyState={},this._lastKeyDown=null,this.attachedToDocument=!1,this.documentKeyupListener=null,this.documentKeydownListener=null,this._enabled=!0,this.keydownEmitter=new Emitter({parameters:[{valueType:KeyboardEvent}]}),this.keyupEmitter=new Emitter({parameters:[{valueType:KeyboardEvent}]}),this.keydownUpdateAction=new PhetioAction$1(n=>{const l=KeyboardUtils.getEventCode(n);if(l){if(this.correctModifierKeys(n),assert&&!KeyboardUtils.isShiftKey(n)&&assert(n.shiftKey===this.shiftKeyDown,"shift key inconsistency between event and keyState."),assert&&!KeyboardUtils.isAltKey(n)&&assert(n.altKey===this.altKeyDown,"alt key inconsistency between event and keyState."),assert&&!KeyboardUtils.isControlKey(n)&&assert(n.ctrlKey===this.ctrlKeyDown,"ctrl key inconsistency between event and keyState."),!this.isKeyDown(l)){const h=KeyboardUtils.getEventCode(n);assert&&assert(h,"Could not find key from domEvent"),this.keyState[h]={keyDown:!0,key:h,timeDown:0}}this._lastKeyDown=l,this.keydownEmitter.emit(n)}},{phetioPlayback:!0,tandem:(r=t==null?void 0:t.tandem)==null?void 0:r.createTandem("keydownUpdateAction"),parameters:[{name:"event",phetioType:EventIO}],phetioEventType:EventType.USER,phetioDocumentation:"Action that executes whenever a keydown occurs from the input listeners this keyStateTracker adds (most likely to the document)."}),this.keyupUpdateAction=new PhetioAction$1(n=>{const l=KeyboardUtils.getEventCode(n);l&&(this.correctModifierKeys(n),this.isKeyDown(l)&&delete this.keyState[l],platform.mac&&KeyboardUtils.isMetaKey(n)&&this.clearState(),this.keyupEmitter.emit(n))},{phetioPlayback:!0,tandem:(o=t==null?void 0:t.tandem)==null?void 0:o.createTandem("keyupUpdateAction"),parameters:[{name:"event",phetioType:EventIO}],phetioEventType:EventType.USER,phetioDocumentation:"Action that executes whenever a keyup occurs from the input listeners this keyStateTracker adds (most likely to the document)."});const s=this.step.bind(this);stepTimer.addListener(s),this.disposeKeyStateTracker=()=>{stepTimer.removeListener(s),this.attachedToDocument&&this.detachFromDocument()}}keydownUpdate(t){this.enabled&&this.keydownUpdateAction.execute(t)}correctModifierKeys(t){const s=KeyboardUtils.getEventCode(t);assert&&assert(s,"key not found from domEvent"),t.shiftKey&&!KeyboardUtils.isShiftKey(t)&&!this.shiftKeyDown&&(this.keyState[KeyboardUtils.KEY_SHIFT_LEFT]={keyDown:!0,key:s,timeDown:0}),t.altKey&&!KeyboardUtils.isAltKey(t)&&!this.altKeyDown&&(this.keyState[KeyboardUtils.KEY_ALT_LEFT]={keyDown:!0,key:s,timeDown:0}),t.ctrlKey&&!KeyboardUtils.isControlKey(t)&&!this.ctrlKeyDown&&(this.keyState[KeyboardUtils.KEY_CONTROL_LEFT]={keyDown:!0,key:s,timeDown:0}),!t.shiftKey&&this.shiftKeyDown&&(delete this.keyState[KeyboardUtils.KEY_SHIFT_LEFT],delete this.keyState[KeyboardUtils.KEY_SHIFT_RIGHT]),!t.altKey&&this.altKeyDown&&(delete this.keyState[KeyboardUtils.KEY_ALT_LEFT],delete this.keyState[KeyboardUtils.KEY_ALT_RIGHT]),!t.ctrlKey&&this.ctrlKeyDown&&(delete this.keyState[KeyboardUtils.KEY_CONTROL_LEFT],delete this.keyState[KeyboardUtils.KEY_CONTROL_RIGHT])}keyupUpdate(t){this.enabled&&this.keyupUpdateAction.execute(t)}get movementKeysDown(){return this.isAnyKeyInListDown(KeyboardUtils.MOVEMENT_KEYS)}getLastKeyDown(){return this._lastKeyDown}isKeyDown(t){return this.keyState[t]?this.keyState[t].keyDown:!1}isAnyKeyInListDown(t){for(let s=0;s<t.length;s++)if(this.isKeyDown(t[s]))return!0;return!1}areKeysDown(t){for(let r=0;r<t.length;r++)if(!this.isKeyDown(t[r]))return!1;return!0}areKeysExclusivelyDown(t){const s=Object.keys(this.keyState);if(s.length!==t.length)return!1;let r=!0;for(let o=0;o<t.length;o++){const n=t[o];let l=[n];KeyboardUtils.isModifierKey(n)&&(l=KeyboardUtils.MODIFIER_KEY_TO_CODE_MAP.get(n)),_.intersection(s,l).length===0&&(r=!1)}return r}areKeysDownWithoutExtraModifiers(t){for(let s=0;s<KeyboardUtils.MODIFIER_KEY_CODES.length;s++){const r=KeyboardUtils.MODIFIER_KEY_CODES[s];if(this.isKeyDown(r)&&!t.includes(r))return!1}return this.areKeysDown(t)}keysAreDown(){return Object.keys(this.keyState).length>0}get enterKeyDown(){return this.isKeyDown(KeyboardUtils.KEY_ENTER)}get shiftKeyDown(){return this.isAnyKeyInListDown(KeyboardUtils.SHIFT_KEYS)}get altKeyDown(){return this.isAnyKeyInListDown(KeyboardUtils.ALT_KEYS)}get ctrlKeyDown(){return this.isAnyKeyInListDown(KeyboardUtils.CONTROL_KEYS)}timeDownForKey(t){return assert&&assert(this.isKeyDown(t),"cannot get timeDown on a key that is not pressed down"),this.keyState[t].timeDown}clearState(){this.keyState={}}step(t){if(this.keysAreDown()){const s=t*1e3;for(const r in this.keyState)this.keyState.hasOwnProperty(r)&&this.keyState[r].keyDown&&(this.keyState[r].timeDown+=s)}}attachToWindow(){assert&&assert(!this.attachedToDocument,"KeyStateTracker is already attached to document."),this.documentKeydownListener=s=>{this.keydownUpdate(s)},this.documentKeyupListener=s=>{this.keyupUpdate(s)};const t=()=>{window.addEventListener("keyup",this.documentKeyupListener,{capture:!0}),window.addEventListener("keydown",this.documentKeydownListener,{capture:!0}),this.attachedToDocument=!0};if(document)t();else{const s=()=>{t(),window.removeEventListener("load",s)};window.addEventListener("load",s)}}setEnabled(t){this._enabled!==t&&(this._enabled=t,!t&&this.clearState())}set enabled(t){this.setEnabled(t)}get enabled(){return this.isEnabled()}isEnabled(){return this._enabled}detachFromDocument(){assert&&assert(this.attachedToDocument,"KeyStateTracker is not attached to window."),assert&&assert(this.documentKeyupListener,"keyup listener was not created or attached to window"),assert&&assert(this.documentKeydownListener,"keydown listener was not created or attached to window."),window.removeEventListener("keyup",this.documentKeyupListener),window.removeEventListener("keydown",this.documentKeydownListener),this.documentKeyupListener=null,this.documentKeydownListener=null,this.attachedToDocument=!1}dispose(){this.disposeKeyStateTracker()}}scenery.register("KeyStateTracker",KeyStateTracker);class GlobalKeyStateTracker extends KeyStateTracker{constructor(t){super(t)}}const globalKeyStateTracker=new GlobalKeyStateTracker({tandem:Tandem.GENERAL_CONTROLLER.createTandem("keyStateTracker")});scenery.register("globalKeyStateTracker",globalKeyStateTracker);const globalKeyStateTracker$1=globalKeyStateTracker,INTERACTIVE_HIGHLIGHTING_OPTIONS=["interactiveHighlight","interactiveHighlightLayerable","interactiveHighlightEnabled"],InteractiveHighlighting=memoize(a=>{assert&&assert(!a._mixesInteractiveHighlighting,"InteractiveHighlighting is already added to this Type");const t=DelayedMutate$1("InteractiveHighlightingClass",INTERACTIVE_HIGHLIGHTING_OPTIONS,class extends a{constructor(...r){super(...r),this._pointer=null,this.displays={},this._interactiveHighlight=null,this._interactiveHighlightLayerable=!1,this._interactiveHighlightEnabled=!0,this.interactiveHighlightChangedEmitter=new TinyEmitter,this._isInteractiveHighlightActiveProperty=new TinyProperty(!1),this._activationListener={enter:this._onPointerEntered.bind(this),over:this._onPointerOver.bind(this),move:this._onPointerMove.bind(this),exit:this._onPointerExited.bind(this),down:this._onPointerDown.bind(this)},this._changedInstanceListener=this.onChangedInstance.bind(this),this.changedInstanceEmitter.addListener(this._changedInstanceListener),this._interactiveHighlightingEnabledListener=this._onInteractiveHighlightingEnabledChange.bind(this),this._boundPointerFocusClearedListener=this.handleLockedPointerFocusCleared.bind(this);const o=this._onPointerRelease.bind(this),n=this._onPointerCancel.bind(this);this._pointerListener={up:o,cancel:n,interrupt:n},this.isInteractiveHighlightActiveProperty=this._isInteractiveHighlightActiveProperty}get isInteractiveHighlighting(){return!0}static get _mixesInteractiveHighlighting(){return!0}setInteractiveHighlight(r){this._interactiveHighlight!==r&&(this._interactiveHighlight=r,this._interactiveHighlightLayerable&&(assert&&assert(r instanceof Node$2),r.visible=!1),this.interactiveHighlightChangedEmitter.emit())}set interactiveHighlight(r){this.setInteractiveHighlight(r)}get interactiveHighlight(){return this.getInteractiveHighlight()}getInteractiveHighlight(){return this._interactiveHighlight}setInteractiveHighlightLayerable(r){this._interactiveHighlightLayerable!==r&&(this._interactiveHighlightLayerable=r,this._interactiveHighlight&&(assert&&assert(this._interactiveHighlight instanceof Node$2),this._interactiveHighlight.visible=!1,this.interactiveHighlightChangedEmitter.emit()))}set interactiveHighlightLayerable(r){this.setInteractiveHighlightLayerable(r)}get interactiveHighlightLayerable(){return this.getInteractiveHighlightLayerable()}getInteractiveHighlightLayerable(){return this._interactiveHighlightLayerable}setInteractiveHighlightEnabled(r){this._interactiveHighlightEnabled=r;const o=Object.keys(this.displays);for(let n=0;n<o.length;n++){const l=this.displays[o[n]];this._interactiveHighlightingEnabledListener(l.focusManager.pointerHighlightsVisibleProperty.value)}}getInteractiveHighlightEnabled(){return this._interactiveHighlightEnabled}set interactiveHighlightEnabled(r){this.setInteractiveHighlightEnabled(r)}get interactiveHighlightEnabled(){return this.getInteractiveHighlightEnabled()}isInteractiveHighlightActivated(){let r=!1;const o=Object.keys(this.displays);for(let n=0;n<o.length;n++){const l=this.displays[o[n]];if(l.focusManager.pointerHighlightsVisibleProperty.value){const h=l.focusManager.pointerFocusProperty.value,g=l.focusManager.lockedPointerFocusProperty.value;if(g){if((g==null?void 0:g.trail.lastNode())===this){r=!0;break}}else if((h==null?void 0:h.trail.lastNode())===this){r=!0;break}}}return r}handleHighlightActiveChange(){this._isInteractiveHighlightActiveProperty.value=this.isInteractiveHighlightActivated()}dispose(){this.changedInstanceEmitter.removeListener(this._changedInstanceListener),this.hasInputListener(this._activationListener)&&this.removeInputListener(this._activationListener),this._pointer&&(this._pointer.removeInputListener(this._pointerListener),this._pointer=null);const r=Object.keys(this.displays);for(let o=0;o<r.length;o++){const n=this.displays[r[o]];this.onDisplayRemoved(n),delete this.displays[r[o]]}super.dispose&&super.dispose()}_onPointerOver(r){const o=r.trail.nodes.find(n=>n.groupFocusHighlight&&n.isInteractiveHighlighting);if(o){const n=r.trail.subtrailTo(o),l=Object.values(this.displays);for(let h=0;h<l.length;h++){const g=l[h];g.focusManager.pointerFocusProperty.value===null&&g.focusManager.pointerFocusProperty.set(new Focus(g,n))}}}_onPointerEntered(r){let o=!1;const n=Object.values(this.displays);for(let l=0;l<n.length;l++){const h=n[l];if(h.focusManager.pointerFocusProperty.value===null||!r.trail.equals(h.focusManager.pointerFocusProperty.value.trail)){const g=new Focus(h,r.trail);h.focusManager.pointerFocusProperty.set(g),h.focusManager.lockedPointerFocusProperty.value===null&&r.pointer.attachedListener&&(this.lockHighlight(g,h.focusManager),o=!0)}}o&&this.savePointer(r.pointer)}_onPointerMove(r){let o=!1;const n=Object.values(this.displays);for(let l=0;l<n.length;l++){const h=n[l],g=r.trail.subtrailTo(this);if((h.focusManager.pointerFocusProperty.value===null||!g.equals(h.focusManager.pointerFocusProperty.value.trail))&&!this.getDescendantsUseHighlighting(r.trail)){const d=new Focus(h,g);h.focusManager.pointerFocusProperty.set(d),h.focusManager.lockedPointerFocusProperty.value===null&&r.pointer.attachedListener&&(this.lockHighlight(d,h.focusManager),o=!0)}}o&&this.savePointer(r.pointer)}_onPointerExited(r){const o=Object.values(this.displays);for(let n=0;n<o.length;n++){const l=o[n];l.focusManager.pointerFocusProperty.set(null);const h=l.focusManager.lockedPointerFocusProperty.value;!r.trail.isPickable()&&(h===null||r.trail.containsNode(h.trail.lastNode()))&&this._onPointerRelease(r)}}_onPointerDown(r){if(this._pointer===null){let o=!1;const n=Object.values(this.displays);for(let l=0;l<n.length;l++){const h=n[l],g=h.focusManager.pointerFocusProperty.value,d=!!h.focusManager.lockedPointerFocusProperty.value;g&&!d&&(assert&&assert(!g.trail.lastNode().isDisposed,"Focus should not be set to a disposed Node"),this.lockHighlight(g,h.focusManager),o=!0)}o&&this.savePointer(r.pointer)}}onDisplayAdded(r){r.focusManager.pointerHighlightsVisibleProperty.hasListener(this._interactiveHighlightingEnabledListener)||r.focusManager.pointerHighlightsVisibleProperty.link(this._interactiveHighlightingEnabledListener)}onDisplayRemoved(r){r.focusManager.lockedPointerFocusProperty.hasListener(this._boundPointerFocusClearedListener)&&r.focusManager.lockedPointerFocusProperty.unlink(this._boundPointerFocusClearedListener),r.focusManager.pointerHighlightsVisibleProperty.unlink(this._interactiveHighlightingEnabledListener)}_onPointerRelease(r){const o=Object.values(this.displays);for(let n=0;n<o.length;n++){const l=o[n];l.focusManager.lockedPointerFocusProperty.value=null,l.focusManager.lockedPointerFocusProperty.hasListener(this._boundPointerFocusClearedListener)&&l.focusManager.lockedPointerFocusProperty.unlink(this._boundPointerFocusClearedListener)}this._pointer&&this._pointer.listeners.includes(this._pointerListener)&&(this._pointer.removeInputListener(this._pointerListener),this._pointer=null)}_onPointerCancel(r){const o=Object.values(this.displays);for(let n=0;n<o.length;n++)o[n].focusManager.pointerFocusProperty.set(null);this._onPointerRelease(r)}savePointer(r){assert&&assert(this._pointer===null,"It should be impossible to already have a Pointer before locking from touchSnag"),this._pointer=r,this._pointer.addInputListener(this._pointerListener)}lockHighlight(r,o){assert&&assert(this._pointer===null,"It should be impossible to already have a Pointer before locking from touchSnag"),o.lockedPointerFocusProperty.set(new Focus(r.display,r.trail.copy())),assert&&assert(!o.lockedPointerFocusProperty.hasListener(this._boundPointerFocusClearedListener),"this listener still on the lockedPointerFocusProperty indicates a memory leak"),o.lockedPointerFocusProperty.link(this._boundPointerFocusClearedListener)}handleLockedPointerFocusCleared(r){r===null&&this._onPointerRelease()}_onInteractiveHighlightingEnabledChange(r){const o=r&&this._interactiveHighlightEnabled,n=this.hasInputListener(this._activationListener);o&&!n?this.addInputListener(this._activationListener):!o&&n&&this.removeInputListener(this._activationListener),this.handleHighlightActiveChange()}onChangedInstance(r,o){assert&&assert(r.trail,"should have a trail"),assert&&assert(r.display,"should have a display");const n=r.trail.uniqueId;if(o){const l=r.display;this.displays[n]=l,this.onDisplayAdded(l)}else{assert&&assert(r.node,"should have a node");const l=this.displays[n];assert&&assert(l,`interactive highlighting does not have a Display for removed instance: ${n}`),r.node.instances.length===0&&this.onDisplayRemoved(l),delete this.displays[n]}}getDescendantsUseHighlighting(r){const o=r.nodes.indexOf(this),n=r.nodes.slice(o+1,r.nodes.length);let l=!1;for(let h=0;h<n.length;h++)if(n[h].isInteractiveHighlighting){l=!0;break}return l}mutate(r){return super.mutate(r)}});return t.prototype._mutatorKeys=INTERACTIVE_HIGHLIGHTING_OPTIONS.concat(t.prototype._mutatorKeys),assert&&assert(t.prototype._mutatorKeys.length===_.uniq(t.prototype._mutatorKeys).length,"duplicate mutator keys in InteractiveHighlighting"),t});scenery.register("InteractiveHighlighting",InteractiveHighlighting);class InteractiveHighlightingNode extends InteractiveHighlighting(Node$2){constructor(t){super(t)}}scenery.register("InteractiveHighlightingNode",InteractiveHighlightingNode);const localeInfoModule={aa:{name:"Afar",localizedName:"Afar",direction:"ltr"},ab:{name:"Abkhazian",localizedName:"Abkhazian",direction:"ltr"},ae:{name:"Avestan",localizedName:"Avestan",direction:"rtl"},af:{name:"Afrikaans",localizedName:"Afrikaans",direction:"ltr"},ak:{name:"Akan",localizedName:"Akan",direction:"ltr"},am:{name:"Amharic",localizedName:"Amharic",direction:"ltr"},an:{name:"Aragonese",localizedName:"Aragonese",direction:"ltr"},ar:{name:"Arabic",localizedName:"العربية",direction:"rtl"},ar_MA:{name:"Arabic, Morocco",localizedName:"العربية (المغرب)",direction:"rtl"},ar_SA:{name:"Arabic, Saudi Arabia",localizedName:"العربية (السعودية)",direction:"rtl"},as:{name:"Assamese",localizedName:"Assamese",direction:"ltr"},av:{name:"Avaric",localizedName:"Avaric",direction:"ltr"},ay:{name:"Aymara",localizedName:"Aymara",direction:"ltr"},az:{name:"Azerbaijani",localizedName:"Azerbaijani",direction:"ltr"},ba:{name:"Bashkir",localizedName:"Bashkir",direction:"ltr"},be:{name:"Belarusian",localizedName:"беларускі",direction:"ltr"},bg:{name:"Bulgarian",localizedName:"български",direction:"ltr"},bh:{name:"Bihari",localizedName:"Bihari",direction:"ltr"},bi:{name:"Bislama",localizedName:"Bislama",direction:"ltr"},bm:{name:"Bambara",localizedName:"Bambara",direction:"ltr"},bn:{name:"Bengali",localizedName:"Bengali",direction:"ltr"},bo:{name:"Tibetan",localizedName:"Tibetan",direction:"ltr"},br:{name:"Breton",localizedName:"Breton",direction:"ltr"},bs:{name:"Bosnian",localizedName:"Bosnian",direction:"ltr"},ca:{name:"Catalan",localizedName:"català",direction:"ltr"},ce:{name:"Chechen",localizedName:"Chechen",direction:"ltr"},ch:{name:"Chamorro",localizedName:"Chamorro",direction:"ltr"},co:{name:"Corsican",localizedName:"Corsican",direction:"ltr"},cr:{name:"Cree",localizedName:"Cree",direction:"ltr"},cs:{name:"Czech",localizedName:"čeština",direction:"ltr"},cu:{name:"Church Slavic",localizedName:"Church Slavic",direction:"ltr"},cv:{name:"Chuvash",localizedName:"Chuvash",direction:"ltr"},cy:{name:"Welsh",localizedName:"Welsh",direction:"ltr"},da:{name:"Danish",localizedName:"Dansk",direction:"ltr"},de:{name:"German",localizedName:"Deutsch",direction:"ltr"},dv:{name:"Divehi",localizedName:"Divehi",direction:"ltr"},dz:{name:"Dzongkha",localizedName:"Dzongkha",direction:"ltr"},ee:{name:"Ewe",localizedName:"Ewe",direction:"ltr"},el:{name:"Greek",localizedName:"Ελληνικά",direction:"ltr"},en:{name:"English",localizedName:"English",direction:"ltr"},en_CA:{name:"English, Canada",localizedName:"English (Canada)",direction:"ltr"},en_GB:{name:"English, United Kingdom",localizedName:"English (United Kingdom)",direction:"ltr"},eo:{name:"Esperanto",localizedName:"Esperanto",direction:"ltr"},es:{name:"Spanish",localizedName:"español",direction:"ltr"},es_CO:{name:"Spanish, Colombia",localizedName:"español (Colombia)",direction:"ltr"},es_CR:{name:"Spanish, Costa Rica",localizedName:"español (Costa Rica)",direction:"ltr"},es_ES:{name:"Spanish, Spain",localizedName:"español (España)",direction:"ltr"},es_MX:{name:"Spanish, Mexico",localizedName:"español (México)",direction:"ltr"},es_PE:{name:"Spanish, Peru",localizedName:"español (Perú)",direction:"ltr"},et:{name:"Estonian",localizedName:"Eesti",direction:"ltr"},eu:{name:"Basque",localizedName:"Basque",direction:"ltr"},fa:{name:"Persian",localizedName:"Persian",direction:"rtl"},ff:{name:"Fulah",localizedName:"Fulah",direction:"ltr"},fi:{name:"Finnish",localizedName:"suomi",direction:"ltr"},fj:{name:"Fijian",localizedName:"Fijian",direction:"ltr"},fo:{name:"Faroese",localizedName:"Faroese",direction:"ltr"},fr:{name:"French",localizedName:"français",direction:"ltr"},fu:{name:"Friulian",localizedName:"fu",direction:"ltr"},fy:{name:"Western Frisian",localizedName:"Frisian",direction:"ltr"},ga:{name:"Irish",localizedName:"Gaeilge",direction:"ltr"},gd:{name:"Scottish Gaelic",localizedName:"Scottish Gaelic",direction:"ltr"},gl:{name:"Galician",localizedName:"Gallegan",direction:"ltr"},gn:{name:"Guarani",localizedName:"Guarani",direction:"ltr"},gu:{name:"Gujarati",localizedName:"Gujarati",direction:"ltr"},gv:{name:"Manx",localizedName:"Manx",direction:"ltr"},ha:{name:"Hausa",localizedName:"Hausa",direction:"ltr"},hi:{name:"Hindi",localizedName:"हिंदी",direction:"ltr"},ho:{name:"Hiri Motu",localizedName:"Hiri Motu",direction:"ltr"},hr:{name:"Croatian",localizedName:"hrvatski",direction:"ltr"},ht:{name:"Haitian",localizedName:"Haitian",direction:"ltr"},hu:{name:"Hungarian",localizedName:"magyar",direction:"ltr"},hy:{name:"Armenian",localizedName:"Armenian",direction:"ltr"},hz:{name:"Herero",localizedName:"Herero",direction:"ltr"},ia:{name:"Interlingua",localizedName:"Interlingua",direction:"ltr"},ie:{name:"Interlingue",localizedName:"Interlingue",direction:"ltr"},ig:{name:"Igbo",localizedName:"Igbo",direction:"ltr"},ii:{name:"Sichuan Yi",localizedName:"Sichuan Yi",direction:"ltr"},ik:{name:"Inupiaq",localizedName:"Inupiaq",direction:"ltr"},in:{name:"Indonesian",localizedName:"Bahasa Indonesia",direction:"ltr"},io:{name:"Ido",localizedName:"Ido",direction:"ltr"},is:{name:"Icelandic",localizedName:"íslenska",direction:"ltr"},it:{name:"Italian",localizedName:"italiano",direction:"ltr"},iu:{name:"Inuktitut",localizedName:"Inuktitut",direction:"ltr"},iw:{name:"Hebrew",localizedName:"עברית",direction:"rtl"},ja:{name:"Japanese",localizedName:"日本語",direction:"ltr"},ji:{name:"Yiddish",localizedName:"Yiddish",direction:"ltr"},jv:{name:"Javanese",localizedName:"Javanese",direction:"ltr"},ka:{name:"Georgian",localizedName:"Georgian",direction:"ltr"},kg:{name:"Kongo",localizedName:"Kongo",direction:"ltr"},ki:{name:"Kikuyu",localizedName:"Kikuyu",direction:"ltr"},kj:{name:"Kwanyama",localizedName:"Kwanyama",direction:"ltr"},kk:{name:"Kazakh",localizedName:"Kazakh",direction:"ltr"},kl:{name:"Kalaallisut",localizedName:"Greenlandic",direction:"ltr"},km:{name:"Khmer",localizedName:"Khmer",direction:"ltr"},kn:{name:"Kannada",localizedName:"Kannada",direction:"ltr"},ko:{name:"Korean",localizedName:"한국어",direction:"ltr"},kr:{name:"Kanuri",localizedName:"Kanuri",direction:"ltr"},ks:{name:"Kashmiri",localizedName:"Kashmiri",direction:"ltr"},ku:{name:"Kurdish",localizedName:"Kurdish",direction:"ltr"},ku_TR:{name:"Kurdish, Turkey",localizedName:"Kurdish (Turkey)",direction:"ltr"},kv:{name:"Komi",localizedName:"Komi",direction:"ltr"},kw:{name:"Cornish",localizedName:"Cornish",direction:"ltr"},ky:{name:"Kirghiz",localizedName:"Kirghiz",direction:"ltr"},la:{name:"Latin",localizedName:"Latin",direction:"ltr"},lb:{name:"Luxembourgish",localizedName:"Luxembourgish",direction:"ltr"},lg:{name:"Ganda",localizedName:"Ganda",direction:"ltr"},li:{name:"Limburgish",localizedName:"Limburgish",direction:"ltr"},lk:{name:"Lakota",localizedName:"Lakota",direction:"ltr"},ln:{name:"Lingala",localizedName:"Lingala",direction:"ltr"},lo:{name:"Lao",localizedName:"Lao",direction:"ltr"},lt:{name:"Lithuanian",localizedName:"Lietuvių",direction:"ltr"},lu:{name:"Luba-Katanga",localizedName:"Luba-Katanga",direction:"ltr"},lv:{name:"Latvian",localizedName:"Latviešu",direction:"ltr"},mg:{name:"Malagasy",localizedName:"Malagasy",direction:"ltr"},mh:{name:"Marshallese",localizedName:"Marshallese",direction:"ltr"},mi:{name:"Maori",localizedName:"Maori",direction:"ltr"},mk:{name:"Macedonian",localizedName:"македонски",direction:"ltr"},ml:{name:"Malayalam",localizedName:"Malayalam",direction:"ltr"},mn:{name:"Mongolian",localizedName:"Mongolian",direction:"ltr"},mo:{name:"Moldavian",localizedName:"Moldavian",direction:"ltr"},mr:{name:"Marathi",localizedName:"Marathi",direction:"ltr"},ms:{name:"Malay",localizedName:"Bahasa Melayu",direction:"ltr"},mt:{name:"Maltese",localizedName:"Malti",direction:"ltr"},my:{name:"Burmese",localizedName:"Burmese",direction:"ltr"},na:{name:"Nauru",localizedName:"Nauru",direction:"ltr"},nb:{name:"Norwegian Bokmal",localizedName:"Norwegian Bokmål",direction:"ltr"},nd:{name:"North Ndebele",localizedName:"North Ndebele",direction:"ltr"},ne:{name:"Nepali",localizedName:"Nepali",direction:"ltr"},ng:{name:"Ndonga",localizedName:"Ndonga",direction:"ltr"},nl:{name:"Dutch",localizedName:"Nederlands",direction:"ltr"},nn:{name:"Norwegian Nynorsk",localizedName:"Norwegian Nynorsk",direction:"ltr"},nr:{name:"South Ndebele",localizedName:"South Ndebele",direction:"ltr"},nv:{name:"Navajo",localizedName:"Navajo",direction:"ltr"},ny:{name:"Chichewa",localizedName:"Nyanja",direction:"ltr"},oc:{name:"Occitan",localizedName:"Occitan",direction:"ltr"},oj:{name:"Ojibwa",localizedName:"Ojibwa",direction:"ltr"},om:{name:"Oromo",localizedName:"Oromo",direction:"ltr"},or:{name:"Oriya",localizedName:"Oriya",direction:"ltr"},os:{name:"Ossetian",localizedName:"Ossetian",direction:"ltr"},pa:{name:"Panjabi",localizedName:"Panjabi",direction:"ltr"},pi:{name:"Pali",localizedName:"Pali",direction:"ltr"},pl:{name:"Polish",localizedName:"polski",direction:"ltr"},ps:{name:"Pashto",localizedName:"Pushto",direction:"ltr"},pt:{name:"Portuguese",localizedName:"português",direction:"ltr"},pt_BR:{name:"Portuguese, Brazil",localizedName:"português (Brasil)",direction:"ltr"},qu:{name:"Quechua",localizedName:"Quechua",direction:"ltr"},rm:{name:"Raeto-Romance",localizedName:"Raeto-Romance",direction:"ltr"},rn:{name:"Kirundi",localizedName:"Rundi",direction:"ltr"},ro:{name:"Romanian",localizedName:"română",direction:"ltr"},ru:{name:"Russian",localizedName:"русский",direction:"ltr"},rw:{name:"Kinyarwanda",localizedName:"Kinyarwanda",direction:"ltr"},sa:{name:"Sanskrit",localizedName:"Sanskrit",direction:"ltr"},sc:{name:"Sardinian",localizedName:"Sardinian",direction:"ltr"},sd:{name:"Sindhi",localizedName:"Sindhi",direction:"ltr"},se:{name:"Northern Sami",localizedName:"Northern Sami",direction:"ltr"},sg:{name:"Sango",localizedName:"Sango",direction:"ltr"},sh:{name:"Serbo-Croatian",localizedName:"Serbo-Croatian",direction:"ltr"},si:{name:"Sinhalese",localizedName:"Sinhalese",direction:"ltr"},sk:{name:"Slovak",localizedName:"Slovenčina",direction:"ltr"},sl:{name:"Slovenian",localizedName:"Slovenščina",direction:"ltr"},sm:{name:"Samoan",localizedName:"Samoan",direction:"ltr"},sn:{name:"Shona",localizedName:"Shona",direction:"ltr"},so:{name:"Somali",localizedName:"Somali",direction:"ltr"},sq:{name:"Albanian",localizedName:"shqipe",direction:"ltr"},sr:{name:"Serbian",localizedName:"Српски",direction:"ltr"},ss:{name:"Swati",localizedName:"Swati",direction:"ltr"},st:{name:"Sotho",localizedName:"Southern Sotho",direction:"ltr"},su:{name:"Sundanese",localizedName:"Sundanese",direction:"ltr"},sv:{name:"Swedish",localizedName:"svenska",direction:"ltr"},sw:{name:"Swahili",localizedName:"Swahili",direction:"ltr"},ta:{name:"Tamil",localizedName:"Tamil",direction:"ltr"},te:{name:"Telugu",localizedName:"Telugu",direction:"ltr"},tg:{name:"Tajik",localizedName:"Tajik",direction:"ltr"},th:{name:"Thai",localizedName:"ไทย",direction:"ltr"},ti:{name:"Tigrinya",localizedName:"Tigrinya",direction:"ltr"},tk:{name:"Turkmen",localizedName:"Turkmen",direction:"ltr"},tl:{name:"Tagalog",localizedName:"Tagalog",direction:"ltr"},tn:{name:"Tswana",localizedName:"Tswana",direction:"ltr"},to:{name:"Tonga",localizedName:"Tonga",direction:"ltr"},tr:{name:"Turkish",localizedName:"Türkçe",direction:"ltr"},ts:{name:"Tsonga",localizedName:"Tsonga",direction:"ltr"},tt:{name:"Tatar",localizedName:"Tatar",direction:"ltr"},tw:{name:"Twi",localizedName:"Twi",direction:"ltr"},ty:{name:"Tahitian",localizedName:"Tahitian",direction:"ltr"},ug:{name:"Uighur",localizedName:"Uighur",direction:"ltr"},uk:{name:"Ukrainian",localizedName:"українська",direction:"ltr"},ur:{name:"Urdu",localizedName:"Urdu",direction:"rtl"},uz:{name:"Uzbek",localizedName:"Uzbek",direction:"ltr"},ve:{name:"Venda",localizedName:"Venda",direction:"ltr"},vi:{name:"Vietnamese",localizedName:"Tiếng Việt",direction:"ltr"},vo:{name:"Volapuk",localizedName:"Volapük",direction:"ltr"},wa:{name:"Walloon",localizedName:"Walloon",direction:"ltr"},wo:{name:"Wolof",localizedName:"Wolof",direction:"ltr"},xh:{name:"Xhosa",localizedName:"Xhosa",direction:"ltr"},yo:{name:"Yoruba",localizedName:"Yoruba",direction:"ltr"},za:{name:"Zhuang",localizedName:"Zhuang",direction:"ltr"},zh_CN:{name:"Chinese, Simplified",localizedName:"中文 (中国)",direction:"ltr"},zh_HK:{name:"Chinese, Hong Kong",localizedName:"中文 (香港)",direction:"ltr"},zh_TW:{name:"Chinese, Traditional",localizedName:"中文 (台灣)",direction:"ltr"},zu:{name:"Zulu",localizedName:"Zulu",direction:"ltr"}},phetcommon=new Namespace("phetcommon"),LTR="‪",RTL="‫",POP="‬",StringUtils={format:function(a){const t=arguments;return a.replace(/{(\d)}/g,(s,r)=>t[+r+1])},fillIn:function(a,t){a=a&&a.get?a.get():a,assert&&assert(typeof a=="string",`invalid template: ${a}`),assert&&assert(t&&typeof t=="object",`invalid values: ${t}`);let s=a;const r=a.match(/\{\{[^{}]+\}\}/g)||[];for(let o=0;o<r.length;o++){const n=r[o],l=n.replace("{{","").replace("}}","");if(t[l]!==void 0){const h=t[l]&&t[l].get?t[l].get():t[l];s=s.replace(n,h)}}return s},isEmbeddingMark:function(a){return a===LTR||a===RTL||a===POP},embeddedSlice:function(a,t,s){const r=[];let o;for(s===void 0&&(s=a.length),s<0&&(s+=a.length);t<a.length&&StringUtils.isEmbeddingMark(a.charAt(t));)t++;for(;s>=1&&StringUtils.isEmbeddingMark(a.charAt(s-1));)s--;if(t>=s||t>=a.length)return"";for(let O=0;O<t;O++)o=a.charAt(O),o===LTR||o===RTL?r.push(o):o===POP&&r.pop();let n=r.length,l=r.slice();const h=a.slice(t,s);for(let O=0;O<h.length;O++)o=h.charAt(O),o===LTR||o===RTL?r.push(o):o===POP&&(r.pop(),n=Math.min(r.length,n));let g=r;const d=Math.max(0,n-1);l=l.slice(d),g=g.slice(d);const A=l.join(""),S=g.join("").replace(/./g,POP);return A+h+S},embeddedSplit:function(a,t,s){if(t===void 0)return[a];let r=[],o,n=a;function l(){let g,d;if(t instanceof window.RegExp){const A=n.match(t);A?(g=A.index,d=A[0].length):g=-1}else assert&&assert(typeof t=="string"),g=n.indexOf(t),d=t.length;return{index:g,length:d}}let h=0;for(;(o=l()).index>=0;){r.push(StringUtils.embeddedSlice(a,h,h+o.index));const g=o.index+o.length;n=n.slice(g),h+=g}return r.push(StringUtils.embeddedSlice(a,h)),s!==void 0&&(assert&&assert(typeof s=="number"),r=_.first(r,s)),r},embeddedDebugString:function(a){return a.replace(/\u202a/g,"[LTR]").replace(/\u202b/g,"[RTL]").replace(/\u202c/g,"[POP]")},wrapLTR:function(a){return LTR+a+POP},wrapRTL:function(a){return RTL+a+POP},wrapDirection:function(a,t){return assert&&assert(t==="ltr"||t==="rtl"),t==="ltr"?StringUtils.wrapLTR(a):StringUtils.wrapRTL(a)},localeToLocalizedName:function(a){return assert&&assert(localeInfoModule[a],"locale needs to be a valid locale code defined in localeInfoModule"),StringUtils.wrapDirection(localeInfoModule[a].localizedName,localeInfoModule[a].direction)},capitalize(a){const t=a.search(/[A-Za-z0-9]/);if(t===-1)return a.slice(0);const s=t>0?a.slice(0,t):"",r=a.charAt(t).toUpperCase(),o=t+1<a.length?a.slice(t+1):"";return s+r+o}};phetcommon.register("StringUtils",StringUtils);const utteranceQueueNamespace=new Namespace("utteranceQueue"),NAME_KEY="NAME",OBJECT_KEY="OBJECT",CONTEXT_KEY="CONTEXT",HINT_KEY="HINT",DEFAULT_RESPONSE_PATTERNS={nameObjectContextHint:"{{NAME}}, {{OBJECT}}, {{CONTEXT}} {{HINT}}",nameObjectContext:"{{NAME}}, {{OBJECT}}, {{CONTEXT}}",nameObjectHint:"{{NAME}}, {{OBJECT}}, {{HINT}}",nameContextHint:"{{NAME}}, {{CONTEXT}} {{HINT}}",nameObject:"{{NAME}}, {{OBJECT}}",nameContext:"{{NAME}}, {{CONTEXT}}",nameHint:"{{NAME}}, {{HINT}}",name:"{{NAME}}",objectContextHint:"{{OBJECT}}, {{CONTEXT}} {{HINT}}",objectContext:"{{OBJECT}}, {{CONTEXT}}",objectHint:"{{OBJECT}}, {{HINT}}",contextHint:"{{CONTEXT}} {{HINT}}",object:"{{OBJECT}}",context:"{{CONTEXT}}",hint:"{{HINT}}"},$h=class $h{constructor(t){const s=optionize3()({},DEFAULT_RESPONSE_PATTERNS,t);this.nameObjectContextHint=s.nameObjectContextHint,this.nameObjectContext=s.nameObjectContext,this.nameObjectHint=s.nameObjectHint,this.nameContextHint=s.nameContextHint,this.nameObject=s.nameObject,this.nameContext=s.nameContext,this.nameHint=s.nameHint,this.name=s.name,this.objectContextHint=s.objectContextHint,this.objectContext=s.objectContext,this.objectHint=s.objectHint,this.contextHint=s.contextHint,this.object=s.object,this.context=s.context,this.hint=s.hint}getResponsePattern(t){const s=this[t];return assert&&assert(s,`no pattern string found for key ${t}`),s}static createPatternKey(t,s,r,o){let n="";return t&&(n=n.concat(NAME_KEY.concat("_"))),s&&(n=n.concat(OBJECT_KEY.concat("_"))),r&&(n=n.concat(CONTEXT_KEY.concat("_"))),o&&(n=n.concat(HINT_KEY.concat("_"))),_.camelCase(n)}};$h.DEFAULT_RESPONSE_PATTERNS=new $h;let ResponsePatternCollection=$h;utteranceQueueNamespace.register("ResponsePatternCollection",ResponsePatternCollection);const DEFAULT_OPTIONS$3={nameResponse:null,objectResponse:null,contextResponse:null,hintResponse:null,ignoreProperties:!1,responsePatternCollection:ResponsePatternCollection.DEFAULT_RESPONSE_PATTERNS},jo=class jo{constructor(t){const s=optionize3()({},DEFAULT_OPTIONS$3,t);assert&&assert(s.responsePatternCollection instanceof ResponsePatternCollection),this._nameResponse=s.nameResponse,this._objectResponse=s.objectResponse,this._contextResponse=s.contextResponse,this._hintResponse=s.hintResponse,this.ignoreProperties=s.ignoreProperties,this.responsePatternCollection=s.responsePatternCollection}getNameResponse(){return jo.getResponseText(this._nameResponse)}get nameResponse(){return this.getNameResponse()}set nameResponse(t){this.setNameResponse(t)}setNameResponse(t){this._nameResponse=t}getObjectResponse(){return jo.getResponseText(this._objectResponse)}get objectResponse(){return this.getObjectResponse()}set objectResponse(t){this.setObjectResponse(t)}setObjectResponse(t){this._objectResponse=t}getContextResponse(){return jo.getResponseText(this._contextResponse)}get contextResponse(){return this.getContextResponse()}set contextResponse(t){this.setContextResponse(t)}setContextResponse(t){this._contextResponse=t}getHintResponse(){return jo.getResponseText(this._hintResponse)}get hintResponse(){return this.getHintResponse()}set hintResponse(t){this.setHintResponse(t)}setHintResponse(t){this._hintResponse=t}static getResponseText(t){return isTReadOnlyProperty(t)?t.value:typeof t=="function"?t():t}copy(){return new jo(this.serialize())}serialize(){return{nameResponse:this.nameResponse,objectResponse:this.objectResponse,contextResponse:this.contextResponse,hintResponse:this.hintResponse,ignoreProperties:this.ignoreProperties,responsePatternCollection:this.responsePatternCollection}}};jo.DEFAULT_OPTIONS=DEFAULT_OPTIONS$3;let ResponsePacket=jo;utteranceQueueNamespace.register("ResponsePacket",ResponsePacket);class ResponseCollector extends PhetioObject{constructor(t){super(),this.nameResponsesEnabledProperty=new BooleanProperty(!0),this.objectResponsesEnabledProperty=new BooleanProperty(!1),this.contextResponsesEnabledProperty=new BooleanProperty(!1),this.hintResponsesEnabledProperty=new BooleanProperty(!1)}reset(){this.nameResponsesEnabledProperty.reset(),this.objectResponsesEnabledProperty.reset(),this.contextResponsesEnabledProperty.reset(),this.hintResponsesEnabledProperty.reset()}collectResponses(t){const s=optionize3()({},ResponsePacket.DEFAULT_OPTIONS,t);assert&&assert(s.responsePatternCollection instanceof ResponsePatternCollection);const r=!!(s.nameResponse&&(this.nameResponsesEnabledProperty.get()||s.ignoreProperties)),o=!!(s.objectResponse&&(this.objectResponsesEnabledProperty.get()||s.ignoreProperties)),n=!!(s.contextResponse&&(this.contextResponsesEnabledProperty.get()||s.ignoreProperties)),l=!!(s.hintResponse&&(this.hintResponsesEnabledProperty.get()||s.ignoreProperties)),h=ResponsePatternCollection.createPatternKey(r,o,n,l);let g="";if(h){const d=s.responsePatternCollection.getResponsePattern(h);g=StringUtils.fillIn(d,{NAME:s.nameResponse,OBJECT:s.objectResponse,CONTEXT:s.contextResponse,HINT:s.hintResponse})}return g}}const responseCollector=new ResponseCollector;utteranceQueueNamespace.register("responseCollector",responseCollector);const responseCollector$1=responseCollector,DEFAULT_PRIORITY=1;let globalIdCounter$2=1;const Ur=class Ur extends Disposable{constructor(t){const s=optionize()({alert:null,predicate:function(){return!0},canAnnounceProperties:[],descriptionCanAnnounceProperties:[],voicingCanAnnounceProperties:[],alertStableDelay:200,alertMaximumDelay:Number.MAX_VALUE,announcerOptions:{},priority:DEFAULT_PRIORITY},t);super(s),this.id=globalIdCounter$2++,this._alert=s.alert,this.predicate=s.predicate,this.canAnnounceProperty=new AnnouncingControlProperty({dependentProperties:s.canAnnounceProperties}),this.descriptionCanAnnounceProperty=new AnnouncingControlProperty({dependentProperties:s.descriptionCanAnnounceProperties}),this.voicingCanAnnounceProperty=new AnnouncingControlProperty({dependentProperties:s.voicingCanAnnounceProperties}),this.alertStableDelay=s.alertStableDelay,this.alertMaximumDelay=s.alertMaximumDelay,this.announcerOptions=s.announcerOptions,this.priorityProperty=new NumberProperty(s.priority),this.previousAlertText=null}static getAlertStringFromResponsePacket(t,s){const r=t.serialize();return s||(r.ignoreProperties=!0),responseCollector$1.collectResponses(r)}getAlertText(t=!1){const s=Ur.alertableToText(this._alert,t);return this.previousAlertText=s,s}getAlert(){return this._alert}get alert(){return this.getAlert()}set alert(t){this.setAlert(t)}setAlert(t){this._alert=t}setAlertStableDelay(t){this.alertStableDelay=t}toString(){return`Utterance_${this.id}#${this.getAlertText()}`}toStateObject(){return{alert:NullableIO(OrIO([StringIO,NumberIO])).toStateObject(this.getAlertText())}}reset(){this.previousAlertText=null}setCanAnnounceProperties(t){this.canAnnounceProperty.setDependentProperties(t)}set canAnnounceProperties(t){this.setCanAnnounceProperties(t)}get canAnnounceProperties(){return this.getCanAnnounceProperties()}getCanAnnounceProperties(){return this.canAnnounceProperty.getDependentProperties()}setDescriptionCanAnnounceProperties(t){this.descriptionCanAnnounceProperty.setDependentProperties(t)}set descriptionCanAnnounceProperties(t){this.setDescriptionCanAnnounceProperties(t)}get descriptionCanAnnounceProperties(){return this.getDescriptionCanAnnounceProperties()}getDescriptionCanAnnounceProperties(){return this.descriptionCanAnnounceProperty.getDependentProperties()}setVoicingCanAnnounceProperties(t){this.voicingCanAnnounceProperty.setDependentProperties(t)}set voicingCanAnnounceProperties(t){this.setVoicingCanAnnounceProperties(t)}get voicingCanAnnounceProperties(){return this.getVoicingCanAnnounceProperties()}getVoicingCanAnnounceProperties(){return this.voicingCanAnnounceProperty.getDependentProperties()}dispose(){this.canAnnounceProperty.dispose(),this.descriptionCanAnnounceProperty.dispose(),this.voicingCanAnnounceProperty.dispose(),this.priorityProperty.dispose(),super.dispose()}static alertableToText(t,s=!1){let r;if(typeof t=="function")r=t();else if(t instanceof ResponsePacket)r=Ur.getAlertStringFromResponsePacket(t,s);else{if(t instanceof Ur)return t.getAlertText(s);isTReadOnlyProperty(t)?r=t.value:r=t}return r}};Ur.TOP_PRIORITY=10,Ur.HIGH_PRIORITY=5,Ur.MEDIUM_PRIORITY=2,Ur.DEFAULT_PRIORITY=DEFAULT_PRIORITY,Ur.LOW_PRIORITY=0,Ur.UtteranceIO=new IOType("UtteranceIO",{valueType:Ur,documentation:"Announces text to a specific browser technology (like aria-live or web speech)",toStateObject:t=>t.toStateObject(),stateSchema:{alert:NullableIO(OrIO([StringIO,NumberIO]))}});let Utterance=Ur;class AnnouncingControlProperty extends DynamicProperty{constructor(t){const s=optionize()({dependentProperties:[]},t),r=new Property(new TinyProperty(!1));super(r),this._dependentProperties=[],this.implementationProperty=r,this.setDependentProperties(s.dependentProperties)}setDependentProperties(t){this.implementationProperty.value&&this.implementationProperty.value.dispose();const s=t.length===0?[new TinyProperty(!0)]:t;this.implementationProperty.value=DerivedProperty.and(s),this._dependentProperties=t}set dependentProperties(t){this.setDependentProperties(t)}get dependentProperties(){return this.getDependentProperties()}getDependentProperties(){return this._dependentProperties.slice(0)}dispose(){this.implementationProperty.dispose(),this._dependentProperties=[],super.dispose()}}utteranceQueueNamespace.register("Utterance",Utterance);const Gl=class Gl extends PhetioObject{constructor(t){var r;const s=optionize()({respectResponseCollectorProperties:!0,phetioType:Gl.AnnouncerIO,phetioState:!1},t);super(s),this.readyToAnnounce=!0,this.hasSpoken=!1,this.respectResponseCollectorProperties=s.respectResponseCollectorProperties,this.announcementCompleteEmitter=new Emitter({parameters:[{name:"utterance",phetioType:Utterance.UtteranceIO},{name:"text",phetioType:NullableIO(OrIO([StringIO,NumberIO]))}],tandem:(r=s.tandem)==null?void 0:r.createTandem("announcementCompleteEmitter"),phetioReadOnly:!0,phetioDocumentation:"The announcement that has just completed. The Utterance text could potentially differ from the exact text that was announced, so both are emitted. Use `text` for an exact match of what was announced."})}shouldUtteranceCancelOther(t,s){return s.priorityProperty.value<t.priorityProperty.value}onUtterancePriorityChange(t){}};Gl.AnnouncerIO=new IOType("AnnouncerIO",{valueType:Gl,documentation:"Announces text to a specific browser technology (like aria-live or web speech)"});let Announcer=Gl;utteranceQueueNamespace.register("Announcer",Announcer);const SpeechSynthesisParentPolyfill={initialize(){if(window.speechSynthesis||window.SpeechSynthesis||window.SpeechSynthesisUtterance)throw new Error("SpeechSynthesis is supported here, the polyfill should not overwrite it");assert&&assert(window.parent,"This polyfill requires a parent frame implementation of SpeechSynthesis."),window.SpeechSynthesis=window.parent.SpeechSynthesis,window.speechSynthesis=new window.parent.SpeechSynthesis,window.SpeechSynthesisUtterance=window.parent.SpeechSynthesisUtterance}};utteranceQueueNamespace.register("SpeechSynthesisParentPolyfill",SpeechSynthesisParentPolyfill);window.phet&&phet.chipper&&phet.chipper.queryParameters&&phet.chipper.queryParameters.speechSynthesisFromParent&&SpeechSynthesisParentPolyfill.initialize();const ENGINE_WAKE_INTERVAL=5e3,PENDING_UTTERANCE_DELAY=5e3,PAUSE_RESUME_WORKAROUND_INTERVAL=1e4,VOICING_UTTERANCE_INTERVAL=125,NOVELTY_VOICES=["Albert","Bad News","Bahh","Bells","Boing","Bubbles","Cellos","Good News","Jester","Organ","Superstar","Trinoids","Whisper","Wobble","Zarvox","Flo","Grandma","Grandpa","Junior"];let initializeCount=0;const voiceLangToSupportedLocale={cmn:"zh_CN",yue:"zh_HK","yue-HK":"zh_HK",yue_HK:"zh_HK","fil-PH":"tl",fil_PH:"tl"},UTTERANCE_OPTION_DEFAULTS={cancelSelf:!0,cancelOther:!0,voice:null};class SpeechSynthesisAnnouncer extends Announcer{constructor(t){var r,o,n,l;const s=optionize()({respectResponseCollectorProperties:!1,debug:!1},t);super(s),this.debug=s.debug,this.voiceProperty=new Property(null,{tandem:(r=s.tandem)==null?void 0:r.createTandem("voiceProperty"),phetioValueType:NullableIO(SpeechSynthesisVoiceIO),phetioState:!1,phetioReadOnly:!0,phetioDocumentation:"the voice that is currently voicing responses"}),this.voiceRateProperty=new NumberProperty(1,{range:new Range(.75,2),tandem:(o=s.tandem)==null?void 0:o.createTandem("voiceRateProperty"),phetioState:!1,phetioDocumentation:"changes the rate of the voicing-feature voice"}),this.voicePitchProperty=new NumberProperty(1,{range:new Range(.5,2),tandem:(n=s.tandem)==null?void 0:n.createTandem("voicePitchProperty"),phetioState:!1,phetioDocumentation:"changes the pitch of the voicing-feature voice"}),this.voiceVolumeProperty=new NumberProperty(1,{range:new Range(0,1)}),this.hasSpoken=!1,this.timeSinceWakingEngine=0,this.timeSincePauseResume=0,this.timeSincePendingUtterance=0,this.timeSinceUtteranceEnd=VOICING_UTTERANCE_INTERVAL,this.startSpeakingEmitter=new Emitter({parameters:[{valueType:"string"},{valueType:Utterance}]}),this.endSpeakingEmitter=new Emitter({parameters:[{valueType:"string"},{valueType:Utterance}]}),this.enabledComponentImplementation=new EnabledComponent({enabled:!1,tandem:s.tandem,enabledPropertyOptions:{phetioDocumentation:"toggles this controller of SpeechSynthesis on and off",phetioState:!1,phetioFeatured:!1}}),assert&&assert(this.enabledComponentImplementation.enabledProperty.isSettable(),"enabledProperty must be settable"),this.enabledProperty=this.enabledComponentImplementation.enabledProperty,this.mainWindowVoicingEnabledProperty=new BooleanProperty(!0,{tandem:(l=s.tandem)==null?void 0:l.createTandem("mainWindowVoicingEnabledProperty"),phetioState:!1,phetioDocumentation:"toggles the voicing feature on and off for the simulation screen (not the voicing preferences and toolbar controls)"}),this.voicingFullyEnabledProperty=DerivedProperty.and([this.enabledProperty,this.mainWindowVoicingEnabledProperty]),this._speechAllowedAndFullyEnabledProperty=new BooleanProperty(!1),this.speechAllowedAndFullyEnabledProperty=this._speechAllowedAndFullyEnabledProperty,this.synth=null,this.voicesProperty=new Property([]),this.speakingSpeechSynthesisUtteranceWrapper=null,this.isInitializedProperty=new BooleanProperty(!1),this.canSpeakProperty=null,this.boundHandleCanSpeakChange=this.handleCanSpeakChange.bind(this),this.boundHandleCanAnnounceChange=this.handleCanAnnounceChange.bind(this),this.debug&&(this.announcementCompleteEmitter.addListener((h,g)=>{console.log("announcement complete",g)}),this.startSpeakingEmitter.addListener(h=>{this.debug&&console.log("startSpeakingListener",h)}),this.endSpeakingEmitter.addListener(h=>{this.debug&&console.log("endSpeakingListener",h)}))}get initialized(){return this.isInitializedProperty.value}initialize(t,s){assert&&assert(!this.initialized,"can only be initialized once"),assert&&assert(SpeechSynthesisAnnouncer.isSpeechSynthesisSupported(),"trying to initialize speech, but speech is not supported on this platform."),assert&&assert(initializeCount===0,"Only one instance of SpeechSynthesisAnnouncer can be initialized at a time."),initializeCount++;const r=optionize()({speechAllowedProperty:new BooleanProperty(!0)},s);this.synth=window.speechSynthesis,this.canSpeakProperty=DerivedProperty.and([r.speechAllowedProperty,this.enabledProperty]),this.canSpeakProperty.link(this.boundHandleCanSpeakChange),Multilink.multilink([r.speechAllowedProperty,this.voicingFullyEnabledProperty],(l,h)=>{this._speechAllowedAndFullyEnabledProperty.value=l&&h});const o=this.getSynth();o.addEventListener&&o.addEventListener("voiceschanged",()=>{this.populateVoices()}),this.populateVoices();const n=()=>{this.timeSinceWakingEngine=ENGINE_WAKE_INTERVAL,t.removeListener(n)};t.addListener(n),stepTimer.addListener(this.step.bind(this)),this.isInitializedProperty.value=!0}step(t){t*=1e3;const s=this.getSynth();this.initialized&&s&&(this.hasSpoken||(this.hasSpoken=s.speaking),this.timeSinceUtteranceEnd=s.speaking?0:this.timeSinceUtteranceEnd+t,this.timeSincePendingUtterance=this.speakingSpeechSynthesisUtteranceWrapper&&!this.speakingSpeechSynthesisUtteranceWrapper.started?this.timeSincePendingUtterance+t:0,this.timeSincePendingUtterance>PENDING_UTTERANCE_DELAY&&(assert&&assert(this.speakingSpeechSynthesisUtteranceWrapper,"should have this.speakingSpeechSynthesisUtteranceWrapper"),this.handleSpeechSynthesisEnd(this.speakingSpeechSynthesisUtteranceWrapper.announceText,this.speakingSpeechSynthesisUtteranceWrapper),this.speakingSpeechSynthesisUtteranceWrapper=null,this.cancelSynth()),this.timeSinceUtteranceEnd>VOICING_UTTERANCE_INTERVAL&&!this.speakingSpeechSynthesisUtteranceWrapper&&(this.readyToAnnounce=!0),platform.chromium&&!platform.android&&this.voiceProperty.value&&!this.voiceProperty.value.localService&&(this.timeSincePauseResume=s.speaking?this.timeSincePauseResume+t:0,this.timeSincePauseResume>PAUSE_RESUME_WORKAROUND_INTERVAL&&(this.timeSincePauseResume=0,s.pause(),s.resume())),platform.chromeOS&&(this.timeSinceWakingEngine+=t,!s.speaking&&this.timeSinceWakingEngine>ENGINE_WAKE_INTERVAL&&(this.timeSinceWakingEngine=0,s.speak(new SpeechSynthesisUtterance(" ")))))}handleCanSpeakChange(t){t||this.cancel()}populateVoices(){const t=this.getSynth();t&&(this.voicesProperty.value=_.uniqBy(t.getVoices(),s=>s.name))}getPrioritizedVoices(){assert&&assert(this.initialized,"No voices available until the SpeechSynthesisAnnouncer is initialized"),assert&&assert(this.voicesProperty.value.length>0,"No voices available to provided a prioritized list.");const t=this.voicesProperty.value.slice(),s=_.filter(t,o=>!_.some(NOVELTY_VOICES,n=>o.name.includes(n))),r=o=>o.name.includes("Google")?-1:o.name.includes("Fred")?s.length:s.indexOf(o);return s.sort((o,n)=>r(o)-r(n))}getEnglishPrioritizedVoices(){return _.filter(this.getPrioritizedVoices(),t=>t.lang==="en-US"||t.lang==="en_US")}getPrioritizedVoicesForLocale(t){const s=t,r=t.replace("_","-");return _.filter(this.getPrioritizedVoices(),o=>{const n=voiceLangToSupportedLocale.hasOwnProperty(o.lang)?voiceLangToSupportedLocale[o.lang]:o.lang;let l=!1;return(n.includes("_")||n.includes("-"))&&(l=s===n.slice(0,2)),l||s===n||r===n})}announce(t,s){this.initialized&&this.canSpeakProperty&&this.canSpeakProperty.value?this.requestSpeech(t,s):this.handleAnnouncementFailure(s,t)}handleAnnouncementFailure(t,s){this.debug&&console.log("announcement failure",s),this.announcementCompleteEmitter.emit(t,s)}speakIgnoringEnabled(t){this.initialized&&(this.cancel(),this.requestSpeech(t.getAlertText(this.respectResponseCollectorProperties),t))}requestSpeech(t,s){if(assert&&assert(SpeechSynthesisAnnouncer.isSpeechSynthesisSupported(),"trying to speak with speechSynthesis, but it is not supported on this platform"),this.debug&&console.log("requestSpeech",t),!t){this.handleAnnouncementFailure(s,t);return}const r=optionize3()({},UTTERANCE_OPTION_DEFAULTS,s.announcerOptions),o=removeBrTags(stripEmbeddingMarks(t+""));validate(o,Validation.STRING_WITHOUT_TEMPLATE_VARS_VALIDATOR);const n=new SpeechSynthesisUtterance(o);n.voice=r.voice||this.voiceProperty.value,n.pitch=this.voicePitchProperty.value,n.rate=this.voiceRateProperty.value,n.volume=this.voiceVolumeProperty.value;const l=()=>{this.startSpeakingEmitter.emit(o,s),assert&&assert(this.speakingSpeechSynthesisUtteranceWrapper,"should have been set in requestSpeech"),this.speakingSpeechSynthesisUtteranceWrapper.started=!0,n.removeEventListener("start",l)},h=()=>{this.handleSpeechSynthesisEnd(o,g)},g=new SpeechSynthesisUtteranceWrapper(s,t,n,!1,h,l);assert&&assert(this.speakingSpeechSynthesisUtteranceWrapper===null,"Wrapper should be null, we should have received an end event to clear it before the next one."),this.speakingSpeechSynthesisUtteranceWrapper=g,n.addEventListener("start",l),n.addEventListener("end",h),n.addEventListener("error",h),this.readyToAnnounce=!1,this.timeSinceUtteranceEnd=0,s.canAnnounceProperty.link(this.boundHandleCanAnnounceChange),s.voicingCanAnnounceProperty.link(this.boundHandleCanAnnounceChange),this.getSynth().speak(n)}handleCanAnnounceChange(){this.speakingSpeechSynthesisUtteranceWrapper&&this.cancelUtteranceIfCanAnnounceFalse(this.speakingSpeechSynthesisUtteranceWrapper.utterance)}cancelUtteranceIfCanAnnounceFalse(t){(!t.canAnnounceProperty.value||!t.voicingCanAnnounceProperty.value)&&this.cancelUtterance(t)}handleSpeechSynthesisEnd(t,s){this.endSpeakingEmitter.emit(t,s.utterance),this.announcementCompleteEmitter.emit(s.utterance,s.speechSynthesisUtterance.text),s.speechSynthesisUtterance.removeEventListener("error",s.endListener),s.speechSynthesisUtterance.removeEventListener("end",s.endListener),s.speechSynthesisUtterance.removeEventListener("start",s.startListener);const r=s.utterance.canAnnounceProperty;r.hasListener(this.boundHandleCanAnnounceChange)&&r.unlink(this.boundHandleCanAnnounceChange);const o=s.utterance.voicingCanAnnounceProperty;o.hasListener(this.boundHandleCanAnnounceChange)&&o.unlink(this.boundHandleCanAnnounceChange),this.speakingSpeechSynthesisUtteranceWrapper=null}getSynth(){return assert&&assert(SpeechSynthesisAnnouncer.isSpeechSynthesisSupported(),"Trying to use SpeechSynthesis, but it is not supported on this platform."),this.synth}cancel(){this.initialized&&this.speakingSpeechSynthesisUtteranceWrapper&&this.cancelUtterance(this.speakingSpeechSynthesisUtteranceWrapper.utterance)}cancelUtterance(t){const s=this.speakingSpeechSynthesisUtteranceWrapper;s&&t===s.utterance&&(this.handleSpeechSynthesisEnd(s.announceText,s),this.cancelSynth())}shouldUtteranceCancelOther(t,s){const r=optionize3()({},UTTERANCE_OPTION_DEFAULTS,t.announcerOptions);let o;return s.priorityProperty.value!==t.priorityProperty.value?o=s.priorityProperty.value<t.priorityProperty.value:(o=r.cancelOther,s&&s===t&&(o=r.cancelSelf)),o}onUtterancePriorityChange(t){const s=this.speakingSpeechSynthesisUtteranceWrapper;s&&this.shouldUtteranceCancelOther(t,s.utterance)&&this.cancelUtterance(s.utterance)}cancelSynth(){assert&&assert(this.initialized,"must be initialized to use synth");const t=this.getSynth();t&&t.cancel()}static isSpeechSynthesisSupported(){return!!window.speechSynthesis&&!!window.SpeechSynthesisUtterance}}class SpeechSynthesisUtteranceWrapper{constructor(t,s,r,o,n,l){this.utterance=t,this.announceText=s,this.speechSynthesisUtterance=r,this.started=o,this.endListener=n,this.startListener=l}}function removeBrTags(a){return a.split("<br/>").join(" ").split("<br>").join(" ")}const SpeechSynthesisVoiceIO=new IOType("SpeechSynthesisVoiceIO",{isValidValue:a=>!0,toStateObject:a=>a.name});utteranceQueueNamespace.register("SpeechSynthesisAnnouncer",SpeechSynthesisAnnouncer);class VoicingManager extends SpeechSynthesisAnnouncer{constructor(t){const s=optionize()({respectResponseCollectorProperties:!0,phetioDocumentation:"Announcer that manages the voicing feature, providing audio responses via WebAudio."},t);super(s)}initialize(t,s){super.initialize(t,s),globalKeyStateTracker$1.keyupEmitter.addListener(r=>{KeyboardUtils.isControlKey(r)&&this.cancel()})}voicingSupportedForLocale(t){return t.startsWith("en")}}const voicingManager=new VoicingManager;scenery.register("voicingManager",voicingManager);const voicingManager$1=voicingManager,NUMBER_OF_ARIA_LIVE_ELEMENTS=4;let ariaLiveAnnouncerIndex=1;const Zo=class Zo extends EnumerationValue{constructor(t){super(),this.attributeString=t}};Zo.POLITE=new Zo("polite"),Zo.ASSERTIVE=new Zo("assertive"),Zo.enumeration=new Enumeration(Zo);let AriaLive=Zo;function createBatchOfPriorityLiveElements(a){const t=a.attributeString,s=document.createElement("div");for(let r=1;r<=NUMBER_OF_ARIA_LIVE_ELEMENTS;r++){const o=document.createElement("p");o.setAttribute("id",`elements-${ariaLiveAnnouncerIndex}-${t}-${r}`),o.setAttribute("aria-live",t),s.appendChild(o)}return s}const Wl=class Wl extends Announcer{constructor(t){const s=optionize()({respectResponseCollectorProperties:!1,lang:"en"},t);super(s),this.politeElementIndex=0,this.assertiveElementIndex=0,this.ariaLiveContainer=document.createElement("div"),this.ariaLiveContainer.setAttribute("lang",s.lang),this.ariaLiveContainer.setAttribute("id",`aria-live-elements-${ariaLiveAnnouncerIndex}`),this.ariaLiveContainer.setAttribute("style","position: absolute; left: 0px; top: 0px; width: 0px; height: 0px; clip: rect(0px 0px 0px 0px); pointer-events: none;");const r=createBatchOfPriorityLiveElements(AriaLive.POLITE),o=createBatchOfPriorityLiveElements(AriaLive.ASSERTIVE);this.ariaLiveContainer.appendChild(r),this.ariaLiveContainer.appendChild(o),this.politeElements=Array.from(r.children),this.assertiveElements=Array.from(o.children),ariaLiveAnnouncerIndex++}announce(t,s,r){const o=optionize()({ariaLivePriority:AriaLive.POLITE},r);if(this.hasSpoken=!0,t)if(o.ariaLivePriority===AriaLive.POLITE){const n=this.politeElements[this.politeElementIndex];this.updateLiveElement(n,t,s),this.politeElementIndex=(this.politeElementIndex+1)%this.politeElements.length}else if(o.ariaLivePriority===AriaLive.ASSERTIVE){const n=this.assertiveElements[this.assertiveElementIndex];this.updateLiveElement(n,t,s),this.assertiveElementIndex=(this.assertiveElementIndex+1)%this.assertiveElements.length}else assert&&assert(!1,"unsupported aria live prioirity");this.announcementCompleteEmitter.emit(s,t)}cancel(){}cancelUtterance(t){}updateLiveElement(t,s,r){t.textContent="",t.hidden=!1,this.readyToAnnounce=!1,stepTimer.setTimeout(()=>{r.predicate()?(PDOMUtils$1.setTextContent(t,s),stepTimer.setTimeout(()=>{platform.safari?t.hidden=!0:t.textContent="",this.readyToAnnounce=!0},Wl.ARIA_LIVE_DELAY)):this.readyToAnnounce=!0},0)}};Wl.ARIA_LIVE_DELAY=200,Wl.AriaLive=AriaLive;let AriaLiveAnnouncer=Wl;utteranceQueueNamespace.register("AriaLiveAnnouncer",AriaLiveAnnouncer);const AriaLiveAnnouncer$1=AriaLiveAnnouncer;class UtteranceWrapper{constructor(t){this.utterance=t,this.timeInQueue=0,this.stableTime=0,this.announcingUtterancePriorityListener=null}resetTimingVariables(){this.timeInQueue=0,this.stableTime=0}}utteranceQueueNamespace.register("UtteranceWrapper",UtteranceWrapper);class UtteranceQueue extends PhetioObject{constructor(t,s){const r=optionize()({debug:!1,initialize:!0,featureSpecificAnnouncingControlPropertyName:null},s);super(r),this.announcer=t,this._initialized=r.initialize,this.featureSpecificAnnouncingControlPropertyName=r.featureSpecificAnnouncingControlPropertyName,this.queue=[],this._muted=!1,this._enabled=!0,this.utteranceToPriorityListenerMap=new Map,this.announcingUtteranceWrapper=null,this.debug=r.debug,this.announcer.announcementCompleteEmitter.addListener(o=>{if(this.announcingUtteranceWrapper&&o===this.announcingUtteranceWrapper.utterance){assert&&assert(this.announcingUtteranceWrapper.announcingUtterancePriorityListener,"announcingUtterancePriorityListener should be set on this.announcingUtteranceWrapper");const n=this.announcingUtteranceWrapper.announcingUtterancePriorityListener;this.announcingUtteranceWrapper.utterance.priorityProperty.hasListener(n)&&(this.announcingUtteranceWrapper.utterance.priorityProperty.unlink(n),this.announcingUtteranceWrapper.announcingUtterancePriorityListener=null,this.announcingUtteranceWrapper=null)}}),this.stepQueueListener=null,this._initialized&&(this.stepQueueListener=this.stepQueue.bind(this),stepTimer.addListener(this.stepQueueListener))}get length(){return this.queue.length}addToBack(t){if(this.initializedAndEnabled)if(!this.announcer.hasSpoken)this.announceImmediately(t);else{const s=this.prepareUtterance(t);this.queue.push(s),this.debug&&console.log("addToBack"),this.addPriorityListenerAndPrioritizeQueue(s)}}addToFront(t){if(deprecationWarning("`addToFront()` has been deprecated because it is confusing, and most of the time doesn't do what is expected, because Utterances are announced based on time-in-queue first, and then position in the queue. It is recommended to use addToBack, and then timing variables on Utterances, or instead call queue.clear() before adding a more important alert to the queue."),!this.initializedAndEnabled)return;const s=this.prepareUtterance(t);this.queue.unshift(s)}addPriorityListenerAndPrioritizeQueue(t){assert&&assert(!this.utteranceToPriorityListenerMap.has(t.utterance),"About to add the priority listener twice and only one should exist on the Utterance. The listener should have been removed by removeOthersAndUpdateUtteranceWrapper.");const s=()=>{this.prioritizeUtterances(t)};t.utterance.priorityProperty.lazyLink(s),this.utteranceToPriorityListenerMap.set(t.utterance,s),this.prioritizeUtterances(t)}prepareUtterance(t){t instanceof Utterance||(t=new Utterance({alert:t}));const s=new UtteranceWrapper(t);return this.removeOthersAndUpdateUtteranceWrapper(s),s.stableTime=0,s}removeUtterance(t){const s=o=>o.utterance===t;assert&&assert(_.find(this.queue,s),"utterance to be removed not found in queue");const r=_.remove(this.queue,s);this.removePriorityListeners(r)}prioritizeUtterances(t){let s=this.queue.indexOf(t);const r=s>=0;let o;r?o=s-1:o=-1;for(let n=o;n>=0;n--){const l=this.queue[n];this.shouldUtteranceCancelOther(t.utterance,l.utterance)&&this.removeUtterance(l.utterance)}if(r){s=this.queue.indexOf(t),assert&&assert(s>-1,"utteranceWrapper is not in queue?");const n=this.queue[s+1];n&&this.shouldUtteranceCancelOther(n.utterance,t.utterance)&&this.removeUtterance(t.utterance)}this.queue.length>0&&this.announcer.onUtterancePriorityChange(this.queue[0].utterance)}shouldUtteranceCancelOther(t,s){return this.announcer.shouldUtteranceCancelOther(t,s)}removeOthersAndUpdateUtteranceWrapper(t){const s=[];for(let o=0;o<this.queue.length;o++){const n=this.queue[o];n.utterance===t.utterance&&s.push(n.timeInQueue)}s.length>=1&&(t.timeInQueue=Math.max(...s));const r=_.remove(this.queue,o=>o.utterance===t.utterance);this.removePriorityListeners(r)}get initializedAndEnabled(){return this._enabled&&this._initialized}getNextUtterance(){let t=null;for(let s=0;s<this.queue.length;s++){const r=this.queue[s];if(r.stableTime>r.utterance.alertStableDelay||r.timeInQueue>r.utterance.alertMaximumDelay){t=r;break}}return t}hasUtterance(t){for(let s=0;s<this.queue.length;s++){const r=this.queue[s];if(t===r.utterance)return!0}return!1}clear(){this.debug&&console.log("UttearnceQueue.clear()"),this.removePriorityListeners(this.queue),this.queue.length=0}cancelUtterance(t){this.announcer.cancelUtterance(t),this.hasUtterance(t)&&this.removeUtterance(t)}cancel(){this.debug&&console.log("UtteranceQueue.cancel()"),this.clear(),this.announcer.cancel()}removePriorityListeners(t){t.forEach(s=>this.removePriorityListener(s.utterance))}removePriorityListener(t){const s=this.utteranceToPriorityListenerMap.get(t);s&&(t.priorityProperty.unlink(s),this.utteranceToPriorityListenerMap.delete(t))}setMuted(t){this._muted=t}set muted(t){this.setMuted(t)}get muted(){return this.getMuted()}getMuted(){return this._muted}setEnabled(t){this._enabled=t}set enabled(t){this.setEnabled(t)}get enabled(){return this.isEnabled()}isEnabled(){return this._enabled}stepQueue(t){if(this._enabled&&(t*=1e3,this.queue.length>0)){for(let r=0;r<this.queue.length;r++){const o=this.queue[r];o.timeInQueue+=t,o.stableTime+=t}const s=this.getNextUtterance();s&&this.attemptToAnnounce(s)}}announceImmediately(t){if(this.initializedAndEnabled&&(this.debug&&console.log("announceImmediately"),t instanceof Utterance||(t=new Utterance({alert:t})),this.announcingUtteranceWrapper===null||this.announcer.shouldUtteranceCancelOther(t,this.announcingUtteranceWrapper.utterance))){const s=this.prepareUtterance(t);s.stableTime=Number.POSITIVE_INFINITY,s.timeInQueue=Number.POSITIVE_INFINITY,this.queue.unshift(s),this.addPriorityListenerAndPrioritizeQueue(s),this.queue.includes(s)&&this.attemptToAnnounce(s)}}attemptToAnnounce(t){const s=t.utterance;if(this.announcer.readyToAnnounce){const r=s.getAlertText(this.announcer.respectResponseCollectorProperties);this.debug&&console.log("ready to announce in attemptToAnnounce(): ",r);const o=!this.featureSpecificAnnouncingControlPropertyName||s[this.featureSpecificAnnouncingControlPropertyName].value,n=s.canAnnounceProperty.value&&s.predicate()&&o;!this._muted&&n&&r!==""?(assert&&assert(this.announcingUtteranceWrapper===null,"announcingUtteranceWrapper and its priorityProperty listener should have been disposed"),this.announcingUtteranceWrapper=t,this.announcingUtteranceWrapper.announcingUtterancePriorityListener=()=>{this.prioritizeUtterances(t)},t.utterance.priorityProperty.link(this.announcingUtteranceWrapper.announcingUtterancePriorityListener),this.debug&&console.log("announcing: ",r),this.announcer.announce(r,s,s.announcerOptions)):this.debug&&console.log("announcer readyToAnnounce but utterance cannot announce, will not be spoken: ",r),this.queue.includes(t)&&this.removeUtterance(t.utterance)}else this.debug&&console.log("announcer not readyToAnnounce")}dispose(){this._initialized&&(assert&&assert(this.stepQueueListener),stepTimer.removeListener(this.stepQueueListener)),super.dispose()}static fromFactory(){const t=new AriaLiveAnnouncer$1,s=new UtteranceQueue(t),r=t.ariaLiveContainer;document.body?document.body.appendChild(r):document.children[0].appendChild(r);let o=0;const n=l=>{const h=l-o;o=l,phet.axon.stepTimer.emit(h/1e3),window.requestAnimationFrame(n)};return window.requestAnimationFrame(n),s}}utteranceQueueNamespace.register("UtteranceQueue",UtteranceQueue);const UtteranceQueue$1=UtteranceQueue,voicingUtteranceQueue=new UtteranceQueue$1(voicingManager$1,{featureSpecificAnnouncingControlPropertyName:"voicingCanAnnounceProperty"});voicingUtteranceQueue.enabled=!1;scenery.register("voicingUtteranceQueue",voicingUtteranceQueue);function assertUtterance(a){if(!(a instanceof Utterance))throw new Error("utterance is not an Utterance")}class OwnedVoicingUtterance extends Utterance{constructor(t){super(t)}}const VOICING_OPTION_KEYS=["voicingNameResponse","voicingObjectResponse","voicingContextResponse","voicingHintResponse","voicingUtterance","voicingResponsePatternCollection","voicingIgnoreVoicingManagerProperties","voicingFocusListener"],Voicing=a=>{assert&&assert(_.includes(inheritance(a),Node$2),"Only Node subtypes should compose Voicing");const t=DelayedMutate$1("Voicing",VOICING_OPTION_KEYS,class Td extends InteractiveHighlighting(a){constructor(...r){super(...r),this._boundInstanceCanVoiceChangeListener=this.onInstanceCanVoiceChange.bind(this),this._voicingUtterance=null,Td.prototype.initialize.call(this)}initialize(...r){return super.initialize&&super.initialize(r),this._voicingCanSpeakProperty=new TinyProperty(!0),this._voicingResponsePacket=new ResponsePacket,this._voicingFocusListener=this.defaultFocusListener,this.setVoicingUtterance(new OwnedVoicingUtterance),this._voicingCanSpeakCount=0,this._boundInstancesChangedListener=this.addOrRemoveInstanceListeners.bind(this),this.changedInstanceEmitter.addListener(this._boundInstancesChangedListener),this._speakContentOnFocusListener={focus:o=>{this._voicingFocusListener&&this._voicingFocusListener(o)}},this.addInputListener(this._speakContentOnFocusListener),this}voicingSpeakFullResponse(r){const o=combineOptions({},r);o.hasOwnProperty("nameResponse")||(o.nameResponse=this._voicingResponsePacket.nameResponse),o.hasOwnProperty("objectResponse")||(o.objectResponse=this._voicingResponsePacket.objectResponse),o.hasOwnProperty("contextResponse")||(o.contextResponse=this._voicingResponsePacket.contextResponse),o.hasOwnProperty("hintResponse")||(o.hintResponse=this._voicingResponsePacket.hintResponse),this.collectAndSpeakResponse(o)}voicingSpeakResponse(r){const o=combineOptions({nameResponse:null,objectResponse:null,contextResponse:null,hintResponse:null},r);this.collectAndSpeakResponse(o)}voicingSpeakNameResponse(r){const o=combineOptions({},r);o.hasOwnProperty("nameResponse")||(o.nameResponse=this._voicingResponsePacket.nameResponse),this.collectAndSpeakResponse(o)}voicingSpeakObjectResponse(r){const o=combineOptions({},r);o.hasOwnProperty("objectResponse")||(o.objectResponse=this._voicingResponsePacket.objectResponse),this.collectAndSpeakResponse(o)}voicingSpeakContextResponse(r){const o=combineOptions({},r);o.hasOwnProperty("contextResponse")||(o.contextResponse=this._voicingResponsePacket.contextResponse),this.collectAndSpeakResponse(o)}voicingSpeakHintResponse(r){const o=combineOptions({},r);o.hasOwnProperty("hintResponse")||(o.hintResponse=this._voicingResponsePacket.hintResponse),this.collectAndSpeakResponse(o)}collectAndSpeakResponse(r){this.speakContent(this.collectResponse(r))}collectResponse(r){const o=combineOptions({ignoreProperties:this._voicingResponsePacket.ignoreProperties,responsePatternCollection:this._voicingResponsePacket.responsePatternCollection,utterance:this.voicingUtterance},r);let n=responseCollector$1.collectResponses(o);return o.utterance&&(o.utterance.alert=n,n=o.utterance),n}speakContent(r){const o=!Tandem.PHET_IO_ENABLED||!this.isInsidePhetioArchetype();r&&o&&voicingUtteranceQueue.addToBack(r)}setVoicingNameResponse(r){this._voicingResponsePacket.nameResponse=r}set voicingNameResponse(r){this.setVoicingNameResponse(r)}get voicingNameResponse(){return this.getVoicingNameResponse()}getVoicingNameResponse(){return this._voicingResponsePacket.nameResponse}setVoicingObjectResponse(r){this._voicingResponsePacket.objectResponse=r}set voicingObjectResponse(r){this.setVoicingObjectResponse(r)}get voicingObjectResponse(){return this.getVoicingObjectResponse()}getVoicingObjectResponse(){return this._voicingResponsePacket.objectResponse}setVoicingContextResponse(r){this._voicingResponsePacket.contextResponse=r}set voicingContextResponse(r){this.setVoicingContextResponse(r)}get voicingContextResponse(){return this.getVoicingContextResponse()}getVoicingContextResponse(){return this._voicingResponsePacket.contextResponse}setVoicingHintResponse(r){this._voicingResponsePacket.hintResponse=r}set voicingHintResponse(r){this.setVoicingHintResponse(r)}get voicingHintResponse(){return this.getVoicingHintResponse()}getVoicingHintResponse(){return this._voicingResponsePacket.hintResponse}setVoicingIgnoreVoicingManagerProperties(r){this._voicingResponsePacket.ignoreProperties=r}set voicingIgnoreVoicingManagerProperties(r){this.setVoicingIgnoreVoicingManagerProperties(r)}get voicingIgnoreVoicingManagerProperties(){return this.getVoicingIgnoreVoicingManagerProperties()}getVoicingIgnoreVoicingManagerProperties(){return this._voicingResponsePacket.ignoreProperties}setVoicingResponsePatternCollection(r){this._voicingResponsePacket.responsePatternCollection=r}set voicingResponsePatternCollection(r){this.setVoicingResponsePatternCollection(r)}get voicingResponsePatternCollection(){return this.getVoicingResponsePatternCollection()}getVoicingResponsePatternCollection(){return this._voicingResponsePacket.responsePatternCollection}setVoicingUtterance(r){this._voicingUtterance!==r&&(this._voicingUtterance&&this.cleanVoicingUtterance(),Voicing.registerUtteranceToVoicingNode(r,this),this._voicingUtterance=r)}set voicingUtterance(r){this.setVoicingUtterance(r)}get voicingUtterance(){return this.getVoicingUtterance()}getVoicingUtterance(){return assertUtterance(this._voicingUtterance),this._voicingUtterance}setVoicingFocusListener(r){this._voicingFocusListener=r}set voicingFocusListener(r){this.setVoicingFocusListener(r)}get voicingFocusListener(){return this.getVoicingFocusListener()}getVoicingFocusListener(){return this._voicingFocusListener}defaultFocusListener(){this.voicingSpeakFullResponse({contextResponse:null})}get isVoicing(){return!0}dispose(){this.removeInputListener(this._speakContentOnFocusListener),this.changedInstanceEmitter.removeListener(this._boundInstancesChangedListener),this._voicingUtterance&&(this.cleanVoicingUtterance(),this._voicingUtterance=null),super.dispose()}clean(){this.removeInputListener(this._speakContentOnFocusListener),this.changedInstanceEmitter.removeListener(this._boundInstancesChangedListener),this._voicingUtterance&&(this.cleanVoicingUtterance(),this._voicingUtterance=null),super.clean&&super.clean()}onInstanceCanVoiceChange(r){r?this._voicingCanSpeakCount++:this._voicingCanSpeakCount--,assert&&assert(this._voicingCanSpeakCount>=0,"the voicingCanSpeakCount should not go below zero"),assert&&assert(this._voicingCanSpeakCount<=this.instances.length,"The voicingCanSpeakCount cannot be greater than the number of Instances."),this._voicingCanSpeakProperty.value=this._voicingCanSpeakCount>0}handleInstancesChanged(r,o){r.visible&&r.voicingVisible&&(this._voicingCanSpeakCount=o?this._voicingCanSpeakCount+1:this._voicingCanSpeakCount-1),this._voicingCanSpeakProperty.value=this._voicingCanSpeakCount>0}addOrRemoveInstanceListeners(r,o){assert&&assert(r.canVoiceEmitter,"Instance must be initialized."),o?r.canVoiceEmitter.addListener(this._boundInstanceCanVoiceChangeListener):r.canVoiceEmitter.removeListener(this._boundInstanceCanVoiceChangeListener),this.handleInstancesChanged(r,o)}cleanVoicingUtterance(){assert&&assert(this._voicingUtterance,"A voicingUtterance must be available to clean."),this._voicingUtterance instanceof OwnedVoicingUtterance?this._voicingUtterance.dispose():this._voicingUtterance&&!this._voicingUtterance.isDisposed&&Voicing.unregisterUtteranceToVoicingNode(this._voicingUtterance,this)}mutate(r){return super.mutate(r)}});return t.prototype._mutatorKeys=VOICING_OPTION_KEYS.concat(t.prototype._mutatorKeys),assert&&assert(t.prototype._mutatorKeys.length===_.uniq(t.prototype._mutatorKeys).length,"duplicate mutator keys in Voicing"),t};Voicing.VOICING_OPTION_KEYS=VOICING_OPTION_KEYS;Voicing.alertUtterance=a=>{assert&&assert(a.voicingCanAnnounceProperties.length>0,"voicingCanAnnounceProperties required, this Utterance might not be connected to Node in the scene graph."),voicingUtteranceQueue.addToBack(a)};Voicing.registerUtteranceToVoicingNode=(a,t)=>{const s=a.voicingCanAnnounceProperties,r=t._voicingCanSpeakProperty;s.includes(r)||(a.voicingCanAnnounceProperties=s.concat([r]))};Voicing.unregisterUtteranceToVoicingNode=(a,t)=>{const s=a.voicingCanAnnounceProperties,r=t._voicingCanSpeakProperty,o=s.indexOf(r);assert&&assert(o>-1,"voicingNode.voicingCanSpeakProperty is not on the Utterance, was it not registered?"),a.voicingCanAnnounceProperties=s.splice(o,1)};Voicing.registerUtteranceToNode=(a,t)=>{const s=a.voicingCanAnnounceProperties;s.includes(t.visibleProperty)||(a.voicingCanAnnounceProperties=a.voicingCanAnnounceProperties.concat([t.visibleProperty])),s.includes(t.voicingVisibleProperty)||(a.voicingCanAnnounceProperties=a.voicingCanAnnounceProperties.concat([t.voicingVisibleProperty]))};Voicing.unregisterUtteranceToNode=(a,t)=>{const s=a.voicingCanAnnounceProperties;assert&&assert(s.includes(t.visibleProperty)&&s.includes(t.voicingVisibleProperty),"visibleProperty and voicingVisibleProperty were not on the Utterance, was it not registered to the node?");const r=s.indexOf(t.visibleProperty),n=s.splice(r,1).indexOf(t.voicingVisibleProperty),l=s.splice(n,1);a.voicingCanAnnounceProperties=l};scenery.register("Voicing",Voicing);class ReadingBlockUtterance extends Utterance{constructor(t,s){super(s),this.readingBlockFocus=t}}scenery.register("ReadingBlockUtterance",ReadingBlockUtterance);const ReadingBlockUtterance$1=ReadingBlockUtterance;class FocusDisplayedController{constructor(t){this.node=null,this.visibilityTracker=null,this.focusProperty=t,this.boundVisibilityListener=this.handleTrailVisibilityChange.bind(this),this.boundInstancesChangedListener=this.handleInstancesChange.bind(this),this.boundNodeDisposedListener=this.handleNodeDisposed.bind(this),this.boundFocusListener=this.handleFocusChange.bind(this),this.focusProperty.link(this.boundFocusListener)}handleFocusChange(t){this.removeDisplayedListeners(),t&&this.addDisplayedListeners(t)}handleTrailVisibilityChange(){this.visibilityTracker&&!this.visibilityTracker.trailVisibleProperty.value&&(this.focusProperty.value=null)}handleInstancesChange(t){t.node&&t.node.instances.length===0&&(this.focusProperty.value=null)}handleNodeDisposed(){this.focusProperty.value=null}addDisplayedListeners(t){assert&&assert(this.visibilityTracker===null,"creating a new TrailVisibilityTracker but the last one was not disposed"),assert&&assert(this.node===null,"Still a reference to the previously focused Node, possible memory leak"),this.visibilityTracker=new TrailVisibilityTracker(t.trail),this.visibilityTracker.addListener(this.boundVisibilityListener),this.node=t.trail.lastNode(),this.node.changedInstanceEmitter.addListener(this.boundInstancesChangedListener),this.node.disposeEmitter.addListener(this.boundNodeDisposedListener)}removeDisplayedListeners(){this.visibilityTracker&&(this.visibilityTracker.removeListener(this.boundVisibilityListener),this.visibilityTracker.dispose(),this.visibilityTracker=null),this.node&&(this.node.changedInstanceEmitter.removeListener(this.boundInstancesChangedListener),this.node.disposeEmitter.removeListener(this.boundNodeDisposedListener),this.node=null)}dispose(){this.removeDisplayedListeners(),this.focusProperty.unlink(this.boundFocusListener),this.node=null,this.visibilityTracker=null}}scenery.register("FocusDisplayedController",FocusDisplayedController);const FocusDisplayedController$1=FocusDisplayedController,Ds=class Ds{constructor(){this.pointerFocusProperty=new Property(null),this.readingBlockFocusProperty=new Property(null),this.lockedPointerFocusProperty=new Property(null),this.pdomFocusHighlightsVisibleProperty=new BooleanProperty(!0),this.interactiveHighlightsVisibleProperty=new BooleanProperty(!1),this.readingBlockHighlightsVisibleProperty=new BooleanProperty(!1),this.voicingFullyEnabledListener=t=>{this.readingBlockHighlightsVisibleProperty.value=t},voicingManager$1.voicingFullyEnabledProperty.link(this.voicingFullyEnabledListener),this.pointerHighlightsVisibleProperty=new DerivedProperty([this.interactiveHighlightsVisibleProperty,this.readingBlockHighlightsVisibleProperty],(t,s)=>t||s),this.readingBlockFocusController=new FocusDisplayedController$1(this.readingBlockFocusProperty),this.startSpeakingListener=(t,s)=>{this.readingBlockFocusProperty.value=s instanceof ReadingBlockUtterance$1?s.readingBlockFocus:null},voicingManager$1.startSpeakingEmitter.addListener(this.startSpeakingListener),this.endSpeakingListener=(t,s)=>{s instanceof ReadingBlockUtterance$1&&this.readingBlockFocusProperty.value&&(assert&&assert(s.readingBlockFocus,"should be non null focus"),s.readingBlockFocus.trail.equals(this.readingBlockFocusProperty.value.trail)&&(this.readingBlockFocusProperty.value=null))},voicingManager$1.endSpeakingEmitter.addListener(this.endSpeakingListener),this.pointerFocusDisplayedController=new FocusDisplayedController$1(this.pointerFocusProperty),this.lockedPointerFocusDisplayedController=new FocusDisplayedController$1(this.lockedPointerFocusProperty),[this.pointerFocusProperty,this.lockedPointerFocusProperty].forEach(t=>{t.link(this.onPointerFocusChange.bind(this))})}dispose(){this.pointerFocusProperty.dispose(),this.readingBlockFocusProperty.dispose(),this.lockedPointerFocusProperty.dispose(),this.pdomFocusHighlightsVisibleProperty.dispose(),this.interactiveHighlightsVisibleProperty.dispose(),this.readingBlockHighlightsVisibleProperty.dispose(),this.readingBlockFocusController.dispose(),this.pointerFocusDisplayedController.dispose(),this.pointerHighlightsVisibleProperty.dispose(),this.lockedPointerFocusDisplayedController.dispose(),voicingManager$1.startSpeakingEmitter.removeListener(this.startSpeakingListener),voicingManager$1.endSpeakingEmitter.removeListener(this.endSpeakingListener),voicingManager$1.voicingFullyEnabledProperty.unlink(this.voicingFullyEnabledListener)}static updatePDOMFocusFromEvent(t,s,r){if(assert&&assert(document.activeElement,"Must be called from focusin, therefore active elemetn expected"),r)for(let o=0;o<t.length;o++){const n=t[o],l=document.activeElement;if(n.isElementUnderPDOM(l)){const h=l.getAttribute(PDOMUtils$1.DATA_PDOM_UNIQUE_ID);assert&&assert(h,"Event target must have a unique ID on its data if it is in the PDOM.");const g=PDOMInstance$1.uniqueIdToTrail(n,h);assert&&assert(g,"We must have a trail since the target was under the PDOM.");const d=PDOMInstance$1.guessVisualTrail(g,n.rootNode);d.lastNode().focusable?Ds.pdomFocus=new Focus(n,d):(s.target.blur(),s.stopImmediatePropagation());break}}else for(let o=0;o<t.length;o++){const n=t[o],l=n._input.getRelatedTargetTrail(s);l&&l.lastNode().focusable?Ds.pdomFocus=new Focus(n,PDOMInstance$1.guessVisualTrail(l,n.rootNode)):Ds.pdomFocus=null}}onPointerFocusChange(t,s){const r=t==null?void 0:t.trail.lastNode();r&&r.isInteractiveHighlighting&&r.handleHighlightActiveChange();const o=s==null?void 0:s.trail.lastNode();o&&o.isInteractiveHighlighting&&o.handleHighlightActiveChange()}static set pdomFocus(t){if(Ds.pdomFocusProperty.value!==t){let s;Ds.pdomFocusProperty.value&&(s=Ds.pdomFocusedNode),Ds.pdomFocusProperty.value=t,s&&!t&&s.blur()}}static get pdomFocus(){return Ds.pdomFocusProperty.value}static getPDOMFocusedNode(){let t=null;const s=Ds.pdomFocusProperty.get();return s&&(t=s.trail.lastNode()),t}static get pdomFocusedNode(){return this.getPDOMFocusedNode()}static attachToWindow(){assert&&assert(!Ds.globallyAttached,"Can only be attached statically once."),Ds.attachedWindowFocusListener=()=>{Ds._windowHasFocusProperty.value=!0},Ds.attachedWindowBlurListener=()=>{Ds._windowHasFocusProperty.value=!1},window.addEventListener("focus",Ds.attachedWindowFocusListener),window.addEventListener("blur",Ds.attachedWindowBlurListener),Ds._windowHasFocusProperty.value=document.hasFocus(),Ds.globallyAttached=!0}static detachFromWindow(){window.removeEventListener("focus",Ds.attachedWindowFocusListener),window.removeEventListener("blur",Ds.attachedWindowBlurListener),Ds._windowHasFocusProperty.value=!1,Ds.globallyAttached=!1}};Ds.attachedWindowFocusListener=null,Ds.attachedWindowBlurListener=null,Ds.globallyAttached=!1,Ds.pdomFocusProperty=new Property(null,{tandem:Tandem.GENERAL_MODEL.createTandem("pdomFocusProperty"),phetioDocumentation:"Stores the current focus in the Parallel DOM, null if nothing has focus. This is not updated based on mouse or touch input, only keyboard and other alternative inputs. Note that this only applies to simulations that support alternative input.",phetioValueType:NullableIO(Focus.FocusIO),phetioState:!1,phetioFeatured:!0,phetioReadOnly:!0}),Ds._windowHasFocusProperty=new BooleanProperty(!1),Ds.windowHasFocusProperty=Ds._windowHasFocusProperty;let FocusManager=Ds;scenery.register("FocusManager",FocusManager);const OUTER_FOCUS_COLOR=new Color("rgba(212,19,106,0.5)"),INNER_FOCUS_COLOR=new Color("rgba(250,40,135,0.9)"),INNER_LIGHT_GROUP_FOCUS_COLOR=new Color("rgba(233,113,166,1.0)"),OUTER_LIGHT_GROUP_FOCUS_COLOR=new Color("rgba(233,113,166,1.0)"),INNER_DARK_GROUP_FOCUS_COLOR=new Color("rgba(159,15,80,1.0)"),OUTER_DARK_GROUP_FOCUS_COLOR=new Color("rgba(159,15,80,1.0)"),INNER_LINE_WIDTH_BASE=2.5,OUTER_LINE_WIDTH_BASE=4,GROUP_OUTER_LINE_WIDTH=2,GROUP_INNER_LINE_WIDTH=2,Rn=class Rn extends Path{constructor(t,s){const r=optionize()({outerStroke:OUTER_FOCUS_COLOR,innerStroke:INNER_FOCUS_COLOR,outerLineWidth:null,innerLineWidth:null,dashed:!1,transformSourceNode:null},s);super(t),this.highlightChangedEmitter=new Emitter,this._innerHighlightColor=r.innerStroke,this._outerHighlightColor=r.outerStroke;const o=_.pick(r,Object.keys(Path.DEFAULT_PATH_OPTIONS));this.innerLineWidth=r.innerLineWidth,this.outerLineWidth=r.outerLineWidth,this.transformSourceNode=r.transformSourceNode,r.stroke=r.outerStroke,this.mutate(r);const n=combineOptions({},o,{stroke:r.innerStroke});this.innerHighlightPath=new Path(t,n),this.addChild(this.innerHighlightPath),this.updateLineWidth(),r.dashed&&this.makeDashed(!0)}mutateWithInnerHighlight(t){super.mutate(t),this.innerHighlightPath&&this.innerHighlightPath.mutate(t),this.highlightChangedEmitter.emit()}makeDashed(t){const s=t?[7,7]:[];this.mutateWithInnerHighlight({lineDash:s})}setShape(t){return super.setShape(t),this.innerHighlightPath&&this.innerHighlightPath.setShape(t),this.highlightChangedEmitter&&this.highlightChangedEmitter.emit(),this}updateLineWidth(t){t=t||this,this.lineWidth=this.getOuterLineWidth(t),this.innerHighlightPath.lineWidth=this.getInnerLineWidth(t),this.highlightChangedEmitter.emit()}getOuterLineWidth(t){return this.outerLineWidth?this.outerLineWidth:Rn.getOuterLineWidthFromNode(t)}getInnerLineWidth(t){return this.innerLineWidth?this.innerLineWidth:Rn.getInnerLineWidthFromNode(t)}setInnerHighlightColor(t){this._innerHighlightColor=t,this.innerHighlightPath.setStroke(t),this.highlightChangedEmitter.emit()}set innerHighlightColor(t){this.setInnerHighlightColor(t)}get innerHighlightColor(){return this.getInnerHighlightColor()}getInnerHighlightColor(){return this._innerHighlightColor}setOuterHighlightColor(t){this._outerHighlightColor=t,this.setStroke(t),this.highlightChangedEmitter.emit()}set outerHighlightColor(t){this.setOuterHighlightColor(t)}get outerHighlightColor(){return this.getOuterHighlightColor()}getOuterHighlightColor(){return this._outerHighlightColor}getUniqueHighlightTrail(t){assert&&assert(this.transformSourceNode,"getUniqueHighlightTrail requires a transformSourceNode");const s=this.transformSourceNode;let r=null;if(s.instances.length<=1)r=s.getUniqueTrail();else{const o=s.getTrails().filter(n=>n.isExtensionOf(t,!0));assert&&assert(o.length===1,"No unique trail to highlight, either avoid DAG for transformSourceNode or don't use transformSourceNode with HighlightPath"),r=o[0]}return assert&&assert(r,"no unique Trail found for getUniqueHighlightTrail"),r}static getInnerLineWidthFromNode(t){return INNER_LINE_WIDTH_BASE/Rn.getWidthMagnitudeFromTransform(t)}static getOuterLineWidthFromNode(t){return OUTER_LINE_WIDTH_BASE/Rn.getWidthMagnitudeFromTransform(t)}static getWidthMagnitudeFromTransform(t){return t.transform.transformDelta2(Vector2.X_UNIT).magnitude}static getDilationCoefficient(t){return Rn.getOuterLineWidthFromNode(t)*(.5+.25)}static getGroupDilationCoefficient(t){return Rn.getOuterLineWidthFromNode(t)*(.5+1.4)}};Rn.OUTER_FOCUS_COLOR=OUTER_FOCUS_COLOR,Rn.INNER_FOCUS_COLOR=INNER_FOCUS_COLOR,Rn.INNER_LIGHT_GROUP_FOCUS_COLOR=INNER_LIGHT_GROUP_FOCUS_COLOR,Rn.OUTER_LIGHT_GROUP_FOCUS_COLOR=OUTER_LIGHT_GROUP_FOCUS_COLOR,Rn.INNER_DARK_GROUP_FOCUS_COLOR=INNER_DARK_GROUP_FOCUS_COLOR,Rn.OUTER_DARK_GROUP_FOCUS_COLOR=OUTER_DARK_GROUP_FOCUS_COLOR,Rn.GROUP_OUTER_LINE_WIDTH=GROUP_OUTER_LINE_WIDTH,Rn.GROUP_INNER_LINE_WIDTH=GROUP_INNER_LINE_WIDTH;let HighlightPath=Rn;scenery.register("HighlightPath",HighlightPath);const HighlightPath$1=HighlightPath;class GroupHighlightPath extends HighlightPath$1{constructor(t,s){const r=optionize()({outerStroke:HighlightPath$1.OUTER_LIGHT_GROUP_FOCUS_COLOR,innerStroke:HighlightPath$1.INNER_LIGHT_GROUP_FOCUS_COLOR,outerLineWidth:HighlightPath$1.GROUP_OUTER_LINE_WIDTH,innerLineWidth:HighlightPath$1.GROUP_INNER_LINE_WIDTH},s);super(t,r)}}scenery.register("GroupHighlightPath",GroupHighlightPath);class HighlightFromNode extends HighlightPath$1{constructor(t,s){const r=optionize()({useLocalBounds:!0,dilationCoefficient:null,useGroupDilation:!1},s);r.transformSourceNode=t,super(null,r),this.observedBoundsProperty=null,this.boundsListener=null,this.useLocalBounds=r.useLocalBounds,this.useGroupDilation=r.useGroupDilation,this.dilationCoefficient=r.dilationCoefficient,t&&this.setShapeFromNode(t)}setShapeFromNode(t){this.observedBoundsProperty&&(assert&&assert(this.boundsListener,"should be a listener if there is a previous focusHighlightNode"),this.observedBoundsProperty.unlink(this.boundsListener)),this.observedBoundsProperty=t.localBoundsProperty,this.boundsListener=s=>{if(!s.isFinite())return;let r=this.dilationCoefficient;this.dilationCoefficient===null&&(r=this.useGroupDilation?HighlightPath$1.getGroupDilationCoefficient(t):HighlightPath$1.getDilationCoefficient(t));const n=(this.useLocalBounds?t.getVisibleLocalBounds():t.getVisibleBounds()).dilated(r);this.updateLineWidthFromNode(t),this.setShape(Shape$1.bounds(n))},this.observedBoundsProperty.link(this.boundsListener)}updateLineWidthFromNode(t){this.lineWidth=this.getOuterLineWidth(t),this.innerHighlightPath.lineWidth=this.getInnerLineWidth(t)}}scenery.register("HighlightFromNode",HighlightFromNode);const HighlightFromNode$1=HighlightFromNode;class ReadingBlockHighlight extends HighlightFromNode$1{constructor(t,s){const r=optionize()({outerStroke:"grey",innerStroke:"black"},s);super(t,r)}}scenery.register("ReadingBlockHighlight",ReadingBlockHighlight);const READING_BLOCK_OPTION_KEYS=["readingBlockTagName","readingBlockNameResponse","readingBlockHintResponse","readingBlockResponsePatternCollection","readingBlockActiveHighlight"];function assertReadingBlockUtterance(a){a instanceof ReadingBlockUtterance$1||assert&&assert(!1,"utterance is not a ReadinBlockUtterance")}class OwnedReadingBlockUtterance extends ReadingBlockUtterance$1{constructor(t,s){super(t,s)}}const DEFAULT_CONTENT_HINT_PATTERN=new ResponsePatternCollection({nameHint:"{{NAME}}. {{HINT}}"}),ReadingBlock=memoize(a=>{const t=DelayedMutate$1("ReadingBlock",READING_BLOCK_OPTION_KEYS,class extends Voicing(a){constructor(...r){super(...r),this._readingBlockTagName="button",this._readingBlockDisabledTagName="p",this._readingBlockActiveHighlight=null,this.readingBlockActiveHighlightChangedEmitter=new TinyEmitter,this.readingBlockResponsePatternCollection=DEFAULT_CONTENT_HINT_PATTERN,this._localBoundsChangedListener=this._onLocalBoundsChanged.bind(this),this.localBoundsProperty.link(this._localBoundsChangedListener),this._readingBlockInputListener={focus:o=>this._speakReadingBlockContentListener(o),up:o=>this._speakReadingBlockContentListener(o),click:o=>this._speakReadingBlockContentListener(o)},this._readingBlockFocusableChangeListener=this._onReadingBlockFocusableChanged.bind(this),voicingManager$1.speechAllowedAndFullyEnabledProperty.link(this._readingBlockFocusableChangeListener),this.focusHighlight=new ReadingBlockHighlight(this),this.voicingUtterance=new OwnedReadingBlockUtterance(null)}get isReadingBlock(){return!0}setReadingBlockTagName(r){this._readingBlockTagName=r,this._onReadingBlockFocusableChanged(voicingManager$1.speechAllowedAndFullyEnabledProperty.value)}set readingBlockTagName(r){this.setReadingBlockTagName(r)}get readingBlockTagName(){return this.getReadingBlockTagName()}getReadingBlockTagName(){return this._readingBlockTagName}setReadingBlockNameResponse(r){this._voicingResponsePacket.nameResponse=r}set readingBlockNameResponse(r){this.setReadingBlockNameResponse(r)}get readingBlockNameResponse(){return this.getReadingBlockNameResponse()}getReadingBlockNameResponse(){return this._voicingResponsePacket.nameResponse}setReadingBlockHintResponse(r){this._voicingResponsePacket.hintResponse=r}set readingBlockHintResponse(r){this.setReadingBlockHintResponse(r)}get readingBlockHintResponse(){return this.getReadingBlockHintResponse()}getReadingBlockHintResponse(){return this._voicingResponsePacket.hintResponse}setReadingBlockResponsePatternCollection(r){this._voicingResponsePacket.responsePatternCollection=r}set readingBlockResponsePatternCollection(r){this.setReadingBlockResponsePatternCollection(r)}get readingBlockResponsePatternCollection(){return this.getReadingBlockResponsePatternCollection()}getReadingBlockResponsePatternCollection(){return this._voicingResponsePacket.responsePatternCollection}setVoicingUtterance(r){super.setVoicingUtterance(r)}set voicingUtterance(r){super.voicingUtterance=r}get voicingUtterance(){return this.getVoicingUtterance()}getVoicingUtterance(){const r=super.getVoicingUtterance();return assertReadingBlockUtterance(r),r}setVoicingNameResponse(){assert&&assert(!1,"ReadingBlocks only support setting the name response via readingBlockNameResponse")}getVoicingNameResponse(){assert&&assert(!1,"ReadingBlocks only support getting the name response via readingBlockNameResponse")}setVoicingObjectResponse(){assert&&assert(!1,"ReadingBlocks do not support setting object response")}getVoicingObjectResponse(){assert&&assert(!1,"ReadingBlocks do not support setting object response")}setVoicingContextResponse(){assert&&assert(!1,"ReadingBlocks do not support setting context response")}getVoicingContextResponse(){assert&&assert(!1,"ReadingBlocks do not support setting context response")}setVoicingHintResponse(){assert&&assert(!1,"ReadingBlocks only support setting the hint response via readingBlockHintResponse.")}getVoicingHintResponse(){assert&&assert(!1,"ReadingBlocks only support getting the hint response via readingBlockHintResponse.")}setVoicingResponsePatternCollection(){assert&&assert(!1,"ReadingBlocks only support setting the response patterns via readingBlockResponsePatternCollection.")}getVoicingResponsePatternCollection(){assert&&assert(!1,"ReadingBlocks only support getting the response patterns via readingBlockResponsePatternCollection.")}setReadingBlockActiveHighlight(r){this._readingBlockActiveHighlight!==r&&(this._readingBlockActiveHighlight=r,this.readingBlockActiveHighlightChangedEmitter.emit())}set readingBlockActiveHighlight(r){this.setReadingBlockActiveHighlight(r)}get readingBlockActiveHighlight(){return this._readingBlockActiveHighlight}getReadingBlockActiveHighlight(){return this._readingBlockActiveHighlight}isReadingBlockActivated(){let r=!1;const o=Object.keys(this.displays);for(let n=0;n<o.length;n++){const l=this.displays[o[n]].focusManager.readingBlockFocusProperty.value;if(l&&l.trail.lastNode()===this){r=!0;break}}return r}get readingBlockActivated(){return this.isReadingBlockActivated()}_onReadingBlockFocusableChanged(r){this.focusable=r,r?(this.tagName=this._readingBlockTagName,this.hasInputListener(this._readingBlockInputListener)||this.addInputListener(this._readingBlockInputListener)):(this.tagName=this._readingBlockDisabledTagName,this.hasInputListener(this._readingBlockInputListener)&&this.removeInputListener(this._readingBlockInputListener))}_onLocalBoundsChanged(r){this.mouseArea=r,this.touchArea=r}_speakReadingBlockContentListener(r){const o=this.getConnectedDisplays(),n=this.voicingUtterance,l=this.collectResponse({nameResponse:this.getReadingBlockNameResponse(),hintResponse:this.getReadingBlockHintResponse(),ignoreProperties:this.voicingIgnoreVoicingManagerProperties,responsePatternCollection:this._voicingResponsePacket.responsePatternCollection,utterance:n});if(l){for(let h=0;h<o.length;h++)if(!this.getDescendantsUseHighlighting(r.trail)){const g=r.trail.subtrailTo(this),d=PDOMInstance$1.guessVisualTrail(g,o[h].rootNode),A=new Focus(o[h],d);n.readingBlockFocus=A,this.speakContent(l)}}}cleanVoicingUtterance(){this._voicingUtterance instanceof OwnedReadingBlockUtterance&&this._voicingUtterance.dispose(),super.cleanVoicingUtterance()}dispose(){voicingManager$1.speechAllowedAndFullyEnabledProperty.unlink(this._readingBlockFocusableChangeListener),this.localBoundsProperty.unlink(this._localBoundsChangedListener),this.hasInputListener(this._readingBlockInputListener)&&this.removeInputListener(this._readingBlockInputListener),super.dispose()}mutate(r){return super.mutate(r)}});return t.prototype._mutatorKeys=READING_BLOCK_OPTION_KEYS.concat(t.prototype._mutatorKeys),assert&&assert(t.prototype._mutatorKeys.length===_.uniq(t.prototype._mutatorKeys).length,"x mutator keys in ReadingBlock"),t});scenery.register("ReadingBlock",ReadingBlock);const KeyboardZoomUtils={isPlatformMac:()=>_.includes(window.navigator.platform,"Mac"),getPlatformZoomMetaKey:()=>KeyboardZoomUtils.isPlatformMac()?"metaKey":"ctrlKey",isZoomCommand:(a,t)=>{const s=t?KeyboardUtils.KEY_EQUALS:KeyboardUtils.KEY_MINUS,r=KeyboardZoomUtils.getPlatformZoomMetaKey();return a[r]&&KeyboardUtils.isKeyEvent(a,s)},isZoomResetCommand:a=>{const t=KeyboardZoomUtils.getPlatformZoomMetaKey();return a[t]&&KeyboardUtils.isKeyEvent(a,KeyboardUtils.KEY_0)}};scenery.register("KeyboardZoomUtils",KeyboardZoomUtils);const keyboardTestingSchema={INPUT:[...KeyboardUtils.ARROW_KEYS,KeyboardUtils.KEY_PAGE_UP,KeyboardUtils.KEY_PAGE_DOWN,KeyboardUtils.KEY_HOME,KeyboardUtils.KEY_END,KeyboardUtils.KEY_ENTER,KeyboardUtils.KEY_SPACE],DIV:[...KeyboardUtils.ARROW_KEYS,...KeyboardUtils.WASD_KEYS],P:[KeyboardUtils.KEY_ESCAPE],BUTTON:[KeyboardUtils.KEY_ENTER,KeyboardUtils.KEY_SPACE]},ALL_KEYS=KeyboardUtils.ALL_KEYS,MAX_MS_KEY_HOLD_DOWN=100,NEXT_ELEMENT_THRESHOLD=.1,DO_KNOWN_KEYS_THRESHOLD=.6,CLICK_EVENT_THRESHOLD=DO_KNOWN_KEYS_THRESHOLD+.1,KEY_DOWN="keydown",KEY_UP="keyup";class KeyboardFuzzer{constructor(t,s){this.display=t,this.random=new Random({seed:s}),this.numberOfComponentsTested=10,this.keyupListeners=[],this.currentElement=null}chooseNextElement(){if(this.currentElement===null)this.currentElement=document.activeElement;else if(this.random.nextDouble()<NEXT_ELEMENT_THRESHOLD){sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.KeyboardFuzzer("choosing new element"),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.push(),this.clearListeners();const t=PDOMUtils$1.getRandomFocusable(this.random);t.focus(),this.currentElement=t,sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.pop()}}clearListeners(){this.keyupListeners.forEach(t=>{assert&&assert(typeof t.timeout=="function","should have an attached timeout"),stepTimer.clearTimeout(t.timeout),t(),assert&&assert(!this.keyupListeners.includes(t),"calling listener should remove itself from the keyupListeners.")})}triggerClickEvent(){sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.KeyboardFuzzer("triggering click"),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.push();const t=document.activeElement;t instanceof HTMLElement&&t.click(),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.pop()}triggerKeyDownUpEvents(t){sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.KeyboardFuzzer(`trigger keydown/up: ${t}`),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.push(),this.triggerDOMEvent(KEY_DOWN,t);const s=this.random.nextInt(MAX_MS_KEY_HOLD_DOWN),r=()=>{this.triggerDOMEvent(KEY_UP,t),this.keyupListeners.includes(r)&&this.keyupListeners.splice(this.keyupListeners.indexOf(r),1)};r.timeout=stepTimer.setTimeout(r,s===MAX_MS_KEY_HOLD_DOWN?2e3:s),this.keyupListeners.push(r),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.pop()}triggerRandomKeyDownUpEvents(t){const s=ALL_KEYS[Math.floor(this.random.nextDouble()*(ALL_KEYS.length-1))];sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.KeyboardFuzzer(`trigger random keydown/up: ${s}`),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.push(),this.triggerKeyDownUpEvents(s),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.pop()}fuzzBoardEvents(t){if(this.display&&this.display._input&&this.display._input.pdomPointer){const s=this.display._input.pdomPointer;s&&!s.blockTrustedEvents&&(s.blockTrustedEvents=!0)}for(let s=0;s<this.numberOfComponentsTested;s++){this.chooseNextElement();for(let r=0;r<t/this.numberOfComponentsTested;r++){sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.KeyboardFuzzer(`main loop, i=${r}`),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.push();const o=document.activeElement;if(o&&keyboardTestingSchema[o.tagName.toUpperCase()]){const n=this.random.nextDouble();if(n<DO_KNOWN_KEYS_THRESHOLD){const l=keyboardTestingSchema[o.tagName],h=this.random.sample(l);this.triggerKeyDownUpEvents(h)}else n<CLICK_EVENT_THRESHOLD?this.triggerClickEvent():this.triggerRandomKeyDownUpEvents(o)}else o&&this.triggerRandomKeyDownUpEvents(o);sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.pop()}}}triggerDOMEvent(t,s){if(document.activeElement){const r=new KeyboardEvent(t,{bubbles:!0,code:s,shiftKey:globalKeyStateTracker$1.shiftKeyDown,altKey:globalKeyStateTracker$1.altKeyDown,ctrlKey:globalKeyStateTracker$1.ctrlKeyDown});document.activeElement.dispatchEvent(r)}}}scenery.register("KeyboardFuzzer",KeyboardFuzzer);class GroupHighlightFromNode extends HighlightFromNode$1{constructor(t,s){const r=optionize()({outerStroke:HighlightPath$1.OUTER_LIGHT_GROUP_FOCUS_COLOR,innerStroke:HighlightPath$1.INNER_LIGHT_GROUP_FOCUS_COLOR,outerLineWidth:HighlightPath$1.GROUP_OUTER_LINE_WIDTH,innerLineWidth:HighlightPath$1.GROUP_INNER_LINE_WIDTH,useGroupDilation:!0},s);super(t,r)}}scenery.register("GroupHighlightFromNode",GroupHighlightFromNode);const ACTIVATED_HIGHLIGHT_COLOR="rgba(255,255,0,0.5)",zu=class zu extends HighlightFromNode$1{constructor(t,s){const r=optionize()({innerStroke:null,outerStroke:null,fill:ACTIVATED_HIGHLIGHT_COLOR},s);super(t,r)}};zu.ACTIVATED_HIGHLIGHT_COLOR=ACTIVATED_HIGHLIGHT_COLOR;let ActivatedReadingBlockHighlight=zu;scenery.register("ActivatedReadingBlockHighlight",ActivatedReadingBlockHighlight);const ActivatedReadingBlockHighlight$1=ActivatedReadingBlockHighlight,PRIMARY_SIBLING="PRIMARY_SIBLING",LABEL_SIBLING="LABEL_SIBLING",DESCRIPTION_SIBLING="DESCRIPTION_SIBLING",CONTAINER_PARENT="CONTAINER_PARENT",LABEL_TAG=PDOMUtils$1.TAGS.LABEL,INPUT_TAG=PDOMUtils$1.TAGS.INPUT,DISABLED_ATTRIBUTE_NAME="disabled",OBSERVER_CONFIG={attributes:!1,childList:!0,characterData:!0};let globalId$4=1;const scratchGlobalBounds=new Bounds2(0,0,0,0),scratchSiblingBounds=new Bounds2(0,0,0,0),globalNodeTranslationMatrix=new Matrix3,globalToClientScaleMatrix=new Matrix3,nodeScaleMagnitudeMatrix=new Matrix3;class PDOMPeer{constructor(t,s){this.initializePDOMPeer(t,s)}initializePDOMPeer(t,s){return s=merge({primarySibling:null},s),assert&&assert(!this.id||this.isDisposed,"If we previously existed, we need to have been disposed"),this.id=this.id||globalId$4++,this.pdomInstance=t,this.node=this.pdomInstance.node,this.display=t.display,this.trail=t.trail,this.visible=null,this.focusable=null,this._labelSibling=null,this._descriptionSibling=null,this._containerParent=null,this.topLevelElements=[],this.positionDirty=!1,this.forceReflowWorkaround=!1,this.childPositionDirty=!1,this.positionInPDOM=!1,this.mutationObserver=this.mutationObserver||new MutationObserver(this.invalidateCSSPositioning.bind(this,!1)),this.transformListener=this.transformListener||this.invalidateCSSPositioning.bind(this,!1),this.pdomInstance.transformTracker.addListener(this.transformListener),this._preservedDisabledValue=null,this.isDisposed=!1,this.pdomInstance.isRootInstance&&(this._primarySibling=s.primarySibling,this._primarySibling.classList.add(PDOMSiblingStyle$1.ROOT_CLASS_NAME),PDOMUtils$1.BLOCKED_DOM_EVENTS.forEach(r=>{this._primarySibling.addEventListener(r,o=>{o.stopPropagation()})})),this}update(t){let s=this.node.getBaseOptions();const r=[];this.node.accessibleName!==null&&(s=this.node.accessibleNameBehavior(this.node,s,this.node.accessibleName,r),assert&&assert(typeof s=="object","should return an object")),this.node.pdomHeading!==null&&(s=this.node.pdomHeadingBehavior(this.node,s,this.node.pdomHeading,r),assert&&assert(typeof s=="object","should return an object")),this.node.helpText!==null&&(s=this.node.helpTextBehavior(this.node,s,this.node.helpText,r),assert&&assert(typeof s=="object","should return an object")),this._primarySibling=createElement(s.tagName,this.node.focusable,{namespace:s.pdomNamespace}),s.containerTagName&&(this._containerParent=createElement(s.containerTagName,!1)),s.labelTagName&&(this._labelSibling=createElement(s.labelTagName,!1,{excludeFromInput:this.node.excludeLabelSiblingFromInput})),s.descriptionTagName&&(this._descriptionSibling=createElement(s.descriptionTagName,!1)),t&&this.updateIndicesStringAndElementIds(),this.orderElements(s),this.mutationObserver.disconnect(),this.mutationObserver.observe(this._primarySibling,OBSERVER_CONFIG),s.labelContent&&s.labelTagName!==null&&this.setLabelSiblingContent(s.labelContent),s.innerContent&&s.tagName!==null&&this.setPrimarySiblingContent(s.innerContent),s.descriptionContent&&s.descriptionTagName!==null&&this.setDescriptionSiblingContent(s.descriptionContent),s.tagName.toUpperCase()===INPUT_TAG&&s.inputType&&this.setAttributeToElement("type",s.inputType),s.labelTagName&&s.labelTagName.toUpperCase()===LABEL_TAG&&this.setAttributeToElement("for",this._primarySibling.id,{elementName:PDOMPeer.LABEL_SIBLING}),this.setFocusable(this.node.focusable),this.setPositionInPDOM(this.node.positionInPDOM),this.onAriaLabelledbyAssociationChange(),this.onAriaDescribedbyAssociationChange(),this.onActiveDescendantAssociationChange(),this.onAttributeChange(s),this.onClassChange(),this.onInputValueChange(),this.node.updateOtherNodesAriaLabelledby(),this.node.updateOtherNodesAriaDescribedby(),this.node.updateOtherNodesActiveDescendant(),r.forEach(o=>{assert&&assert(typeof o=="function"),o()})}orderElements(t){this._containerParent?(this._containerParent.insertBefore(this._primarySibling,this._containerParent.children[0]||null),this.topLevelElements=[this._containerParent]):this.topLevelElements=[this._labelSibling,this._descriptionSibling,this._primarySibling].filter(_.identity),this._labelSibling&&this.arrangeContentElement(this._labelSibling,t.appendLabel),this._descriptionSibling&&this.arrangeContentElement(this._descriptionSibling,t.appendDescription)}getPrimarySibling(){return this._primarySibling}get primarySibling(){return this.getPrimarySibling()}getLabelSibling(){return this._labelSibling}get labelSibling(){return this.getLabelSibling()}getDescriptionSibling(){return this._descriptionSibling}get descriptionSibling(){return this.getDescriptionSibling()}getContainerParent(){return this._containerParent}get containerParent(){return this.getContainerParent()}getTopLevelElementContainingPrimarySibling(){return this._containerParent||this._primarySibling}onAriaLabelledbyAssociationChange(){this.removeAttributeFromAllElements("aria-labelledby");for(let t=0;t<this.node.ariaLabelledbyAssociations.length;t++){const s=this.node.ariaLabelledbyAssociations[t];assert&&assert(s.otherNode.nodesThatAreAriaLabelledbyThisNode.indexOf(this.node)>=0,"unexpected otherNode"),this.setAssociationAttribute("aria-labelledby",s)}}onAriaDescribedbyAssociationChange(){this.removeAttributeFromAllElements("aria-describedby");for(let t=0;t<this.node.ariaDescribedbyAssociations.length;t++){const s=this.node.ariaDescribedbyAssociations[t];assert&&assert(s.otherNode.nodesThatAreAriaDescribedbyThisNode.indexOf(this.node)>=0,"unexpected otherNode"),this.setAssociationAttribute("aria-describedby",s)}}onActiveDescendantAssociationChange(){this.removeAttributeFromAllElements("aria-activedescendant");for(let t=0;t<this.node.activeDescendantAssociations.length;t++){const s=this.node.activeDescendantAssociations[t];assert&&assert(s.otherNode.nodesThatAreActiveDescendantToThisNode.indexOf(this.node)>=0,"unexpected otherNode"),this.setAssociationAttribute("aria-activedescendant",s)}}handleAttributeWithPDOMOption(t,s){typeof s=="string"?this.setAttributeToElement(t,s):this.removeAttributeFromElement(t)}onAttributeChange(t){for(let s=0;s<this.node.pdomAttributes.length;s++){const r=this.node.pdomAttributes[s];this.setAttributeToElement(r.attribute,r.value,r.options)}this.handleAttributeWithPDOMOption("aria-label",t.ariaLabel),this.handleAttributeWithPDOMOption("role",t.ariaRole)}onClassChange(){for(let t=0;t<this.node.pdomClasses.length;t++){const s=this.node.pdomClasses[t];this.setClassToElement(s.className,s.options)}}onInputValueChange(){if(assert&&assert(this.node.inputValue!==void 0,"use null to remove input value attribute"),this.node.inputValue===null)this.removeAttributeFromElement("value");else{const t=`${this.node.inputValue}`;this.setAttributeToElement("value",t,{asProperty:!0})}}getElementByName(t){if(t===PDOMPeer.PRIMARY_SIBLING)return this._primarySibling;if(t===PDOMPeer.LABEL_SIBLING)return this._labelSibling;if(t===PDOMPeer.DESCRIPTION_SIBLING)return this._descriptionSibling;if(t===PDOMPeer.CONTAINER_PARENT)return this._containerParent;throw new Error(`invalid elementName name: ${t}`)}setAttributeToElement(t,s,r){r=merge({namespace:null,asProperty:!1,elementName:PRIMARY_SIBLING,element:null},r);const o=r.element||this.getElementByName(r.elementName),n=PDOMUtils$1.unwrapProperty(s);let l=n;typeof n=="string"&&(l=stripEmbeddingMarks(n)),t===DISABLED_ATTRIBUTE_NAME&&!this.display.interactive&&(this._preservedDisabledValue=r.asProperty?l:!0),r.namespace?o.setAttributeNS(r.namespace,t,l):r.asProperty?o[t]=l:o.setAttribute(t,l)}removeAttributeFromElement(t,s){s=merge({namespace:null,elementName:PRIMARY_SIBLING,element:null},s);const r=s.element||this.getElementByName(s.elementName);s.namespace?r.removeAttributeNS(s.namespace,t):t===DISABLED_ATTRIBUTE_NAME&&!this.display.interactive?this._preservedDisabledValue=!1:r.removeAttribute(t)}removeAttributeFromAllElements(t){assert&&assert(t!==DISABLED_ATTRIBUTE_NAME,"this method does not currently support disabled, to make Display.interactive toggling easier to implement"),assert&&assert(typeof t=="string"),this._primarySibling&&this._primarySibling.removeAttribute(t),this._labelSibling&&this._labelSibling.removeAttribute(t),this._descriptionSibling&&this._descriptionSibling.removeAttribute(t),this._containerParent&&this._containerParent.removeAttribute(t)}setClassToElement(t,s){assert&&assert(typeof t=="string"),s=merge({elementName:PRIMARY_SIBLING},s),this.getElementByName(s.elementName).classList.add(t)}removeClassFromElement(t,s){assert&&assert(typeof t=="string"),s=merge({elementName:PRIMARY_SIBLING},s),this.getElementByName(s.elementName).classList.remove(t)}setAssociationAttribute(t,s){assert&&assert(PDOMUtils$1.ASSOCIATION_ATTRIBUTES.indexOf(t)>=0,`unsupported attribute for setting with association object: ${t}`);const r=s.otherNode.getPDOMInstances();if(r.length>0){const o=r[0];o===this.pdomInstance&&(o.peer=this),assert&&assert(o.peer,"peer should exist");const n=o.peer.getElementByName(s.otherElementName),l=this.getElementByName(s.thisElementName);if(l&&n){const h=l.getAttribute(t)||"";assert&&assert(typeof h=="string");const g=[h.trim(),n.id].join(" ").trim();this.setAttributeToElement(t,g,{elementName:s.thisElementName})}}}arrangeContentElement(t,s){if(this.topLevelElements[0]===this._containerParent)assert&&assert(this.topLevelElements.length===1),s?this._containerParent.appendChild(t):this._containerParent.insertBefore(t,this._primarySibling);else{arrayRemove(this.topLevelElements,t);const r=this.topLevelElements.indexOf(this._primarySibling),o=s?this.topLevelElements.length:r;this.topLevelElements.splice(o,0,t)}}isVisible(){if(assert){let t=0;this.topLevelElements.forEach(s=>{!s.hidden&&!s.hasAttribute("hidden")&&(t+=1)}),assert(this.visible?t===this.topLevelElements.length:t===0,"some of the peer's elements are visible and some are not")}return this.visible===null?!0:this.visible}setVisible(t){if(assert&&assert(typeof t=="boolean"),this.visible!==t){this.visible=t;for(let s=0;s<this.topLevelElements.length;s++){const r=this.topLevelElements[s];t?this.removeAttributeFromElement("hidden",{element:r}):this.setAttributeToElement("hidden","",{element:r})}this.invalidateCSSPositioning(platform.safari)}}isFocused(){const t=PDOMInstance$1.guessVisualTrail(this.trail,this.display.rootNode);return FocusManager.pdomFocusProperty.value&&FocusManager.pdomFocusProperty.value.trail.equals(t)}focus(){assert&&assert(this._primarySibling,"must have a primary sibling to focus"),FocusManager.windowHasFocusProperty.value&&this._primarySibling.focus()}blur(){assert&&assert(this._primarySibling,"must have a primary sibling to blur"),this._primarySibling.blur()}setFocusable(t){assert&&assert(typeof t=="boolean");const s=this.isFocused();this.focusable!==t&&(this.focusable=t,PDOMUtils$1.overrideFocusWithTabIndex(this.primarySibling,t),s&&!t&&this.blur(),this.invalidateCSSPositioning())}setLabelSiblingContent(t){assert&&assert(t===null||typeof t=="string","incorrect label content type"),this._labelSibling&&PDOMUtils$1.setTextContent(this._labelSibling,t)}setDescriptionSiblingContent(t){assert&&assert(t===null||typeof t=="string","incorrect description content type"),this._descriptionSibling&&PDOMUtils$1.setTextContent(this._descriptionSibling,t)}setPrimarySiblingContent(t){assert&&assert(t===null||typeof t=="string","incorrect inner content type"),assert&&assert(this.pdomInstance.children.length===0,"descendants exist with accessible content, innerContent cannot be used"),assert&&assert(PDOMUtils$1.tagNameSupportsContent(this._primarySibling.tagName),`tagName: ${this.node.tagName} does not support inner content`),this._primarySibling&&PDOMUtils$1.setTextContent(this._primarySibling,t)}setPDOMTransformSourceNode(t){this.pdomInstance.transformTracker.removeListener(this.transformListener),this.pdomInstance.updateTransformTracker(t),this.pdomInstance.transformTracker.addListener(this.transformListener),this.invalidateCSSPositioning()}setPositionInPDOM(t){this.positionInPDOM=t,this.invalidateCSSPositioning()}getElementId(t,s){return`display${this.display.id}-${t}-${s}`}updateIndicesStringAndElementIds(){const t=this.pdomInstance.getPDOMInstanceUniqueId();this._primarySibling&&(this._primarySibling.setAttribute(PDOMUtils$1.DATA_PDOM_UNIQUE_ID,t),this._primarySibling.id=this.getElementId("primary",t)),this._labelSibling&&(this._labelSibling.setAttribute(PDOMUtils$1.DATA_PDOM_UNIQUE_ID,t),this._labelSibling.id=this.getElementId("label",t)),this._descriptionSibling&&(this._descriptionSibling.setAttribute(PDOMUtils$1.DATA_PDOM_UNIQUE_ID,t),this._descriptionSibling.id=this.getElementId("description",t)),this._containerParent&&(this._containerParent.setAttribute(PDOMUtils$1.DATA_PDOM_UNIQUE_ID,t),this._containerParent.id=this.getElementId("container",t))}invalidateCSSPositioning(t=!1){if(!this.positionDirty){if(this.positionDirty=!0,t){this.forceReflowWorkaround=!0;for(let r=0;r<this.topLevelElements.length;r++)this.topLevelElements[r].style.display="none"}let s=this.pdomInstance.parent;for(;s;)s.peer.childPositionDirty=!0,s=s.parent}}positionElements(t){if(assert&&assert(this._primarySibling,"a primary sibling required to receive CSS positioning"),assert&&assert(this.positionDirty,"elements should only be repositioned if dirty"),t){const s=this.node.pdomTransformSourceNode||this.node;if(scratchGlobalBounds.set(s.localBounds),scratchGlobalBounds.isFinite()){scratchGlobalBounds.transform(this.pdomInstance.transformTracker.getMatrix());const r=this.display.bounds;if(r.intersectsBounds(scratchGlobalBounds)){scratchGlobalBounds.constrainBounds(r);let o=getClientDimensions(this._primarySibling),n=o.width,l=o.height;n>0&&l>0&&(scratchSiblingBounds.setMinMax(0,0,n,l),scratchSiblingBounds.transform(getCSSMatrix(n,l,scratchGlobalBounds)),setClientBounds(this._primarySibling,scratchSiblingBounds)),this.labelSibling&&(o=getClientDimensions(this._labelSibling),n=o.width,l=o.height,l>0&&n>0&&(scratchSiblingBounds.setMinMax(0,0,n,l),scratchSiblingBounds.transform(getCSSMatrix(n,l,scratchGlobalBounds)),setClientBounds(this._labelSibling,scratchSiblingBounds)))}}}else scratchSiblingBounds.set(PDOMPeer.OFFSCREEN_SIBLING_BOUNDS),setClientBounds(this._primarySibling,scratchSiblingBounds),this._labelSibling&&setClientBounds(this._labelSibling,scratchSiblingBounds);this.forceReflowWorkaround&&this.topLevelElements.forEach(s=>{s.style.display="",s.style.offsetHeight}),this.positionDirty=!1,this.forceReflowWorkaround=!1}updateSubtreePositioning(t=!1){this.childPositionDirty=!1;const s=this.positionInPDOM||t;this.positionDirty&&this.positionElements(s);for(let r=0;r<this.pdomInstance.children.length;r++){const o=this.pdomInstance.children[r].peer;(o.positionDirty||o.childPositionDirty)&&this.pdomInstance.children[r].peer.updateSubtreePositioning(s)}}recursiveDisable(t){t?(this._preservedDisabledValue=this._primarySibling.disabled,this._primarySibling.disabled=!0):this._primarySibling.disabled=this._preservedDisabledValue;for(let s=0;s<this.pdomInstance.children.length;s++)this.pdomInstance.children[s].peer.recursiveDisable(t)}dispose(){this.isDisposed=!0,this.blur(),this._primarySibling.removeEventListener("blur",this.blurEventListener),this._primarySibling.removeEventListener("focus",this.focusEventListener),this.pdomInstance.transformTracker.removeListener(this.transformListener),this.mutationObserver.disconnect(),this.pdomInstance=null,this.node=null,this.display=null,this.trail=null,this._primarySibling=null,this._labelSibling=null,this._descriptionSibling=null,this._containerParent=null,this.focusable=null,this.freeToPool()}}PDOMPeer.PRIMARY_SIBLING=PRIMARY_SIBLING;PDOMPeer.LABEL_SIBLING=LABEL_SIBLING;PDOMPeer.DESCRIPTION_SIBLING=DESCRIPTION_SIBLING;PDOMPeer.CONTAINER_PARENT=CONTAINER_PARENT;PDOMPeer.OFFSCREEN_SIBLING_BOUNDS=new Bounds2(0,0,1,1);scenery.register("PDOMPeer",PDOMPeer);Poolable.mixInto(PDOMPeer,{initialize:PDOMPeer.prototype.initializePDOMPeer});function createElement(a,t,s){s=merge({siblingName:null,excludeFromInput:!1},s);const r=PDOMUtils$1.createElement(a,t,s);return s.excludeFromInput&&r.setAttribute(PDOMUtils$1.DATA_EXCLUDE_FROM_INPUT,!0),r}function getCSSMatrix(a,t,s){return globalNodeTranslationMatrix.setToTranslation(s.minX,s.minY),globalToClientScaleMatrix.setToScale(s.width/a,s.height/t),globalNodeTranslationMatrix.multiplyMatrix(globalToClientScaleMatrix).multiplyMatrix(nodeScaleMagnitudeMatrix)}function getClientDimensions(a){let t=a.clientWidth,s=a.clientHeight;if(t===0&&s===0){const r=a.getBoundingClientRect();t=r.width,s=r.height}return{width:t,height:s}}function setClientBounds(a,t){a.style.top=`${t.top}px`,a.style.left=`${t.left}px`,a.style.width=`${t.width}px`,a.style.height=`${t.height}px`}const PDOMPeer$1=PDOMPeer,Qo=class Qo extends EnumerationValue{};Qo.INDICES=new Qo,Qo.TRAIL_ID=new Qo,Qo.enumeration=new Enumeration(Qo);let PDOMUniqueIdStrategy=Qo;const UNIQUE_ID_STRATEGY=PDOMUniqueIdStrategy.TRAIL_ID;let globalId$3=1;const Jo=class Jo{constructor(t,s,r){this.relativeNodes=[],this.relativeVisibilities=[],this.relativeListeners=[],this.transformTracker=null,this.initializePDOMInstance(t,s,r)}initializePDOMInstance(t,s,r){if(assert&&assert(!this.id||this.isDisposed,"If we previously existed, we need to have been disposed"),this.id=this.id||globalId$3++,this.parent=t,this.display=s,this.trail=r,this.isRootInstance=t===null,this.node=this.isRootInstance?null:r.lastNode(),this.children=cleanArray(this.children),this.node&&this.node.addPDOMInstance(this),this.invisibleCount=0,this.relativeNodes=[],this.relativeVisibilities=[],this.relativeListeners=[],this.transformTracker=null,this.updateTransformTracker(this.node?this.node.pdomTransformSourceNode:null),this.isDisposed=!1,this.isRootInstance){const o=document.createElement("div");this.peer=PDOMPeer$1.createFromPool(this,{primarySibling:o})}else{this.peer=PDOMPeer$1.createFromPool(this),this.peer.update(UNIQUE_ID_STRATEGY===PDOMUniqueIdStrategy.TRAIL_ID),assert&&assert(this.peer.primarySibling,"accessible peer must have a primarySibling upon completion of construction");const o=this.parent.trail;for(let n=o.length;n<r.length;n++){const l=r.nodes[n];this.relativeNodes.push(l);const h=l._pdomDisplaysInfo.pdomDisplays,g=_.includes(h,s);this.relativeVisibilities.push(g),g||this.invisibleCount++;const d=this.checkAccessibleDisplayVisibility.bind(this,n-o.length);l.pdomDisplaysEmitter.addListener(d),this.relativeListeners.push(d)}this.updateVisibility()}return sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`Initialized ${this.toString()}`),this}addConsecutiveInstances(t){sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`addConsecutiveInstances on ${this.toString()} with: ${t.map(r=>r.toString()).join(",")}`),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.push();const s=this.children.length>0;Array.prototype.push.apply(this.children,t);for(let r=0;r<t.length;r++)assert&&assert(!!this.peer.primarySibling,"Primary sibling must be defined to insert elements."),PDOMUtils$1.insertElements(this.peer.primarySibling,t[r].peer.topLevelElements);s&&this.sortChildren(),assert&&this.node&&(assert&&assert(this.node instanceof Node$2),this.children.length>0&&assert(!this.node.innerContent,`${this.children.length} child PDOMInstances present but this node has innerContent: ${this.node.innerContent}`)),UNIQUE_ID_STRATEGY===PDOMUniqueIdStrategy.INDICES&&this.updateDescendantPeerIds(t),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.pop()}removeInstancesForTrail(t){sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`removeInstancesForTrail on ${this.toString()} with trail ${t.toString()}`),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.push();for(let s=0;s<this.children.length;s++){const r=this.children[s],o=r.trail;let n=o.length<t.length;if(!n){for(let l=this.trail.length;l<t.length;l++)if(t.nodes[l]!==o.nodes[l]){n=!0;break}}n||(this.children.splice(s,1),r.dispose(),s-=1)}sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.pop()}removeAllChildren(){for(sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`removeAllChildren on ${this.toString()}`),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.push();this.children.length;)this.children.pop().dispose();sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.pop()}findChildWithTrail(t){for(let s=0;s<this.children.length;s++){const r=this.children[s];if(r.trail.equals(t))return r}return null}removeSubtree(t){sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`removeSubtree on ${this.toString()} with trail ${t.toString()}`),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.push();for(let s=this.children.length-1;s>=0;s--){const r=this.children[s];r.trail.isExtensionOf(t,!0)&&(sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`Remove parent: ${this.toString()}, child: ${r.toString()}`),this.children.splice(s,1),r.dispose())}sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.pop()}checkAccessibleDisplayVisibility(t){const s=_.includes(this.relativeNodes[t]._pdomDisplaysInfo.pdomDisplays,this.display),r=this.relativeVisibilities[t];if(s!==r){this.relativeVisibilities[t]=s;const o=this.invisibleCount===0;this.invisibleCount+=s?-1:1,assert&&assert(this.invisibleCount>=0&&this.invisibleCount<=this.relativeNodes.length),this.invisibleCount===0!==o&&this.updateVisibility()}}updateVisibility(){assert&&assert(!!this.peer,"Peer needs to be available on update visibility."),this.peer.setVisible(this.invisibleCount<=0),!this.peer.isVisible()&&FocusManager.pdomFocusedNode&&(assert&&assert(FocusManager.pdomFocusedNode.pdomInstances.length===1,"focusable Nodes do not support DAG, and should be connected with an instance if focused."),FocusManager.pdomFocusedNode.pdomInstances[0].trail.containsNode(this.node)&&(FocusManager.pdomFocus=null))}isGloballyVisible(){return assert&&assert(!!this.peer,"PDOMPeer needs to be available, has this PDOMInstance been disposed?"),this.peer.isVisible()?this.parent?this.parent.isGloballyVisible():!0:!1}getChildOrdering(t){const s=t.lastNode(),r=s.getEffectiveChildren();let o;const n=[];if(s.hasPDOMContent&&s!==this.node){const l=s.pdomInstances;e:for(o=0;o<l.length;o++){const h=l[o];if(h.parent===this){for(let g=0;g<t.length;g++)if(t.nodes[g]!==h.trail.nodes[g+h.trail.length-t.length])continue e;n.push(h)}}assert&&assert(n.length<=1,"If we select more than one this way, we have problems")}else for(o=0;o<r.length;o++)t.addDescendant(r[o],o),Array.prototype.push.apply(n,this.getChildOrdering(t)),t.removeDescendant();return n}sortChildren(){var h,g;assert&&assert(this.peer!==null,"peer required for sort");let t;this.isRootInstance?(assert&&assert(this.display!==null,"Display should be available for the root"),t=this.display.rootNode):(assert&&assert(this.node!==null,"Node should be defined, were we disposed?"),t=this.node);const s=this.getChildOrdering(new Trail(t));assert&&assert(s.length===this.children.length,"sorting should not change number of children"),this.children=s;const r=this.peer.primarySibling,o=((g=(h=FocusManager.pdomFocusedNode)==null?void 0:h.pdomInstances[0])==null?void 0:g.trail)||null;let n=r.childNodes.length-1;const l=o&&_.find(this.children,d=>o.containsNode(d.peer.node));if(l){const d=_.flatten(this.children.map(S=>S.peer.topLevelElements));if(!_.every(d,(S,O)=>r.children[O]===S)){const S=l.peer.getTopLevelElementContainingPrimarySibling(),O=d.indexOf(S);assert&&assert(O>=0);for(let I=0;I<O;I++)r.insertBefore(d[I],S);for(let I=O+1;I<d.length;I++)r.appendChild(d[I])}}else for(let d=this.children.length-1;d>=0;d--){const A=this.children[d].peer;for(let S=A.topLevelElements.length-1;S>=0;S--){const O=A.topLevelElements[S];r.childNodes[n]!==O&&r.insertBefore(O,r.childNodes[n+1]),n--}}if(assert){const d=_.flatten(this.children.map(A=>A.peer.topLevelElements));assert(_.every(d,(A,S)=>r.children[S]===A))}UNIQUE_ID_STRATEGY===PDOMUniqueIdStrategy.INDICES&&this.updateDescendantPeerIds(this.children)}updateTransformTracker(t){this.transformTracker&&this.transformTracker.dispose();let s=null;t?s=t.getUniqueTrail():s=Jo.guessVisualTrail(this.trail,this.display.rootNode),this.transformTracker=new TransformTracker$1(s)}getPDOMInstanceUniqueId(){if(UNIQUE_ID_STRATEGY===PDOMUniqueIdStrategy.INDICES){const t=[];let s=this;for(;s.parent;){const r=s.parent.children.indexOf(s);if(r===-1)return"STILL_BEING_CREATED"+dotRandom.nextDouble();t.unshift(r),s=s.parent}return t.join(PDOMUtils$1.PDOM_UNIQUE_ID_SEPARATOR)}else return assert&&assert(UNIQUE_ID_STRATEGY===PDOMUniqueIdStrategy.TRAIL_ID),this.trail.getUniqueId()}updateDescendantPeerIds(t){assert&&assert(UNIQUE_ID_STRATEGY===PDOMUniqueIdStrategy.INDICES,"method should not be used with uniqueId comes from TRAIL_ID");const s=Array.from(t);for(;s.length>0;){const r=s.shift();r.peer.updateIndicesStringAndElementIds(),s.push(...r.children)}}static uniqueIdToTrail(t,s){return UNIQUE_ID_STRATEGY===PDOMUniqueIdStrategy.INDICES?t.getTrailFromPDOMIndicesString(s):(assert&&assert(UNIQUE_ID_STRATEGY===PDOMUniqueIdStrategy.TRAIL_ID),Trail.fromUniqueId(t.rootNode,s))}dispose(){sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`Disposing ${this.toString()}`),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.push(),assert&&assert(!!this.peer,"PDOMPeer required, were we already disposed?");const t=this.peer;if(!this.isRootInstance){PDOMUtils$1.removeElements(this.parent.peer.primarySibling,t.topLevelElements);for(let s=0;s<this.relativeNodes.length;s++)this.relativeNodes[s].pdomDisplaysEmitter.removeListener(this.relativeListeners[s])}for(;this.children.length;)this.children.pop().dispose();t.dispose(),this.transformTracker.dispose(),this.transformTracker=null,this.node&&this.node.removePDOMInstance(this),this.relativeNodes=null,this.display=null,this.trail=null,this.node=null,this.peer=null,this.isDisposed=!0,this.freeToPool(),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.pop()}toString(){return`${this.id}#{${this.trail.toString()}}`}auditRoot(){if(!assert)return;const t=this.display.rootNode;assert(this.trail.length===0,"Should only call auditRoot() on the root PDOMInstance for a display");function s(r,o){assert&&assert(r.children.length===o.children.length,"Different number of children in accessible instance"),assert&&assert(r.node===o.node,"Node mismatch for PDOMInstance");for(let h=0;h<o.children.length;h++)s(r.children[h],o.children[h]);const n=o.isGloballyVisible();let l=!0;for(let h=0;h<o.trail.length;h++)if(o.trail.nodes[h].getTrailsTo(t).filter(A=>A.isPDOMVisible()).length===0){l=!1;break}assert&&assert(n===l,"Instance visibility mismatch")}s(Jo.createFakePDOMTree(t),this)}static guessVisualTrail(t,s){t.reindex();const r=t.indices.lastIndexOf(-1);if(r<0)return t;const o=r+1,l=t.nodes[o].getTrailsTo(s);if(l.length===0)return t;const h=l[0];for(let g=o+1;g<t.length;g++)h.addDescendant(t.nodes[g]);return assert&&assert(h.isValid(),`trail not valid: ${t.uniqueId}`),h}static createFakePDOMTree(t){function s(r){let o=_.flatten(r.getEffectiveChildren().map(s));return r.hasPDOMContent&&(o=[{node:r,children:o}]),o}return{node:null,children:s(t)}}freeToPool(){Jo.pool.freeToPool(this)}};Jo.pool=new Pool(Jo,{initialize:Jo.prototype.initializePDOMInstance});let PDOMInstance=Jo;scenery.register("PDOMInstance",PDOMInstance);const PDOMInstance$1=PDOMInstance,PDOMTree={addChild(a,t){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`addChild parent:n#${a._id}, child:n#${t._id}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),assert&&assert(a instanceof Node$2),assert&&assert(t instanceof Node$2),assert&&assert(!t._rendererSummary.hasNoPDOM());const s=PDOMTree.beforeOp();t._pdomParent||PDOMTree.addTree(a,t),PDOMTree.afterOp(s),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},removeChild(a,t){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`removeChild parent:n#${a._id}, child:n#${t._id}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),assert&&assert(a instanceof Node$2),assert&&assert(t instanceof Node$2),assert&&assert(!t._rendererSummary.hasNoPDOM());const s=PDOMTree.beforeOp();t._pdomParent||PDOMTree.removeTree(a,t),PDOMTree.afterOp(s),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},childrenOrderChange(a){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`childrenOrderChange node:n#${a._id}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),assert&&assert(a instanceof Node$2),assert&&assert(!a._rendererSummary.hasNoPDOM());const t=PDOMTree.beforeOp();PDOMTree.reorder(a),PDOMTree.afterOp(t),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},pdomOrderChange(a,t,s){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`pdomOrderChange n#${a._id}: ${PDOMTree.debugOrder(t)},${PDOMTree.debugOrder(s)}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),assert&&assert(a instanceof Node$2);const r=PDOMTree.beforeOp(),o=[],n=[];arrayDifference(t||[],s||[],o,n),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`removed: ${PDOMTree.debugOrder(o)}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`added: ${PDOMTree.debugOrder(n)}`);let l,h;if(assert){for(l=0;l<o;l++)assert(o[l]===null||o[l]._pdomParent===a,"Node should have had a pdomOrder");for(l=0;l<n;l++)assert(n[l]===null||n[l]._pdomParent===null,"Node is already specified in a pdomOrder")}const g=PDOMTree.findPDOMTrails(a);for(l=0;l<o.length;l++){const d=o[l];d&&(PDOMTree.removeTree(a,d,g),d._pdomParent=null)}for(l=0;l<n.length;l++){const d=n[l];if(d){const A=d._parents;for(h=0;h<A.length;h++)PDOMTree.removeTree(A[h],d);d._pdomParent=a}}for(l=0;l<o.length;l++){const d=o[l];if(d){const A=d._parents;for(h=0;h<A.length;h++)PDOMTree.addTree(A[h],d)}}for(l=0;l<n.length;l++){const d=n[l];d&&PDOMTree.addTree(a,d,g)}PDOMTree.reorder(a,g),PDOMTree.afterOp(r),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},pdomContentChange(a){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`pdomContentChange n#${a._id}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),assert&&assert(a instanceof Node$2);const t=PDOMTree.beforeOp();let s;const r=a._pdomParent?[a._pdomParent]:a._parents,o=[];for(s=0;s<r.length;s++){const n=r[s],l=PDOMTree.findPDOMTrails(n);o.push(l),PDOMTree.removeTree(n,a,l)}for(s=0;s<r.length;s++)PDOMTree.addTree(r[s],a,o[s]);for(s=0;s<a._rootedDisplays.length;s++){const n=a._rootedDisplays[s];n._accessible&&PDOMTree.rebuildInstanceTree(n._rootPDOMInstance)}PDOMTree.afterOp(t),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},rebuildInstanceTree(a){const t=a.display.rootNode;assert&&assert(t),a.removeAllChildren(),a.addConsecutiveInstances(PDOMTree.createTree(new Trail(t),a.display,a))},addTree(a,t,s){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`addTree parent:n#${a._id}, child:n#${t._id}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),assert&&PDOMTree.auditNodeForPDOMCycles(a),s=s||PDOMTree.findPDOMTrails(a);for(let r=0;r<s.length;r++){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`trail: ${s[r].trail.toString()} full:${s[r].fullTrail.toString()} for ${s[r].pdomInstance.toString()} root:${s[r].isRoot}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push();const o=s[r],n=o.pdomInstance;o.fullTrail.addDescendant(t);const l=PDOMTree.createTree(o.fullTrail,n.display,n);o.fullTrail.removeDescendant(t),n.addConsecutiveInstances(l),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()}sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},removeTree(a,t,s){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`removeTree parent:n#${a._id}, child:n#${t._id}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),s=s||PDOMTree.findPDOMTrails(a);for(let r=0;r<s.length;r++){const o=s[r];o.fullTrail.addDescendant(t),o.pdomInstance.removeInstancesForTrail(o.fullTrail),o.fullTrail.removeDescendant(t)}sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},reorder(a,t){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`reorder n#${a._id}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),t=t||PDOMTree.findPDOMTrails(a);for(let s=0;s<t.length;s++)t[s].pdomInstance.sortChildren();sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},createTree(a,t,s){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`createTree ${a.toString()} parent:${s?s.toString():"null"}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push();const r=a.lastNode(),o=r.getEffectiveChildren();sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`effectiveChildren: ${PDOMTree.debugOrder(o)}`);let n,l=!1;r.hasPDOMContent&&(n=s.findChildWithTrail(a),n?l=!0:n=PDOMInstance$1.pool.create(s,t,a.copy()),s=n);const h=[];for(let g=0;g<o.length;g++)a.addDescendant(o[g],g),Array.prototype.push.apply(h,PDOMTree.createTree(a,t,s)),a.removeDescendant();return n?(n.addConsecutiveInstances(h),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop(),l?[]:[n]):(sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop(),h)},beforeOp(){return BrowserEvents$1.blockFocusCallbacks=!0,FocusManager.pdomFocusedNode},afterOp(a){a&&a.focusable&&a.focus(),BrowserEvents$1.blockFocusCallbacks=!1},findPDOMTrails(a){const t=[];return PDOMTree.recursivePDOMTrailSearch(t,new Trail(a)),t},recursivePDOMTrailSearch(a,t){const s=t.rootNode();let r;if(s.hasPDOMContent){const l=s.pdomInstances;for(r=0;r<l.length;r++)a.push(new PartialPDOMTrail(l[r],t.copy(),!1));return}else{const l=s.rootedDisplays;for(r=0;r<l.length;r++){const h=l[r];h._accessible&&a.push(new PartialPDOMTrail(h._rootPDOMInstance,t.copy(),!0))}}const o=s._pdomParent?[s._pdomParent]:s._parents,n=o.length;for(r=0;r<n;r++){const l=o[r];t.addAncestor(l),PDOMTree.recursivePDOMTrailSearch(a,t),t.removeAncestor()}},auditPDOMDisplays(a){if(assertSlow)if(a._pdomDisplaysInfo.canHavePDOMDisplays()){let t;const s=[];for(t=0;t<a._parents.length;t++)Array.prototype.push.apply(s,a._parents[t]._pdomDisplaysInfo.pdomDisplays);for(t=0;t<a._rootedDisplays.length;t++){const n=a._rootedDisplays[t];n._accessible&&s.push(n)}const r=a._pdomDisplaysInfo.pdomDisplays.slice(),o=s.slice();for(assertSlow(r.length===o.length),t=0;t<o.length;t++)for(let n=0;n<r.length;n++)if(o[t]===r[n]){o.splice(t,1),r.splice(n,1),t--;break}assertSlow(r.length===0&&o.length===0,"Mismatch with accessible pdom displays")}else assertSlow(a._pdomDisplaysInfo.pdomDisplays.length===0,"Invisible/nonaccessible things should have no displays")},auditNodeForPDOMCycles(a){if(assert){const t=new Trail(a);(function s(){const r=t.rootNode();assert(t.length<=1||r!==a,`Accessible PDOM graph cycle detected. The combined scene-graph DAG with pdomOrder defining additional parent-child relationships should still be a DAG. Cycle detected with the trail: ${t.toString()} path: ${t.toPathString()}`);const o=r._parents.length;for(let n=0;n<o;n++){const l=r._parents[n];t.addAncestor(l),s(),t.removeAncestor()}r._pdomParent&&!r._pdomParent.hasChild(r)&&(t.addAncestor(r._pdomParent),s(),t.removeAncestor())})()}},debugOrder(a){return a===null?"null":`[${a.map(t=>t===null?"null":t._id).join(",")}]`}};scenery.register("PDOMTree",PDOMTree);const PDOMTree$1=PDOMTree;class PDOMFuzzer{constructor(t,s,r){assert&&assert(t>=2),r=r||null,this.nodeCount=t,this.logToConsole=s,this.nodes=_.range(0,t).map(()=>new Node$2),this.display=new Display(this.nodes[0]),this.random=new Random({seed:r}),this.actionsTaken=[]}step(){const t=this.random.sample(this.enumerateActions());if(this.logToConsole&&console.log(t.text),this.actionsTaken.push(t),t.execute(),this.display._rootPDOMInstance.auditRoot(),PDOMTree$1.auditPDOMDisplays(this.display.rootNode),this.logToConsole)for(let s=0;s<this.nodes.length;s++){const r=this.nodes[s];console.log(`${s}#${r.id} ${r.tagName} ch:${PDOMTree$1.debugOrder(r.children)} or:${PDOMTree$1.debugOrder(r.pdomOrder)} vis:${r.visible} avis:${r.pdomVisible}`)}}enumerateActions(){const t=[];return this.nodes.forEach(s=>{t.push({text:`#${s.id}.visible = ${!s.visible}`,execute:()=>{s.visible=!s.visible}}),t.push({text:`#${s.id}.pdomVisible = ${!s.pdomVisible}`,execute:()=>{s.pdomVisible=!s.pdomVisible}}),["span","div",null].forEach(r=>{s.tagName!==r&&t.push({text:`#${s.id}.tagName = ${r}`,execute:()=>{s.tagName=r}})}),this.powerSet(arrayDifference(this.nodes,[s]).concat([null])).forEach(r=>{Permutation.forEachPermutation(r,o=>{this.isPDOMOrderChangeLegal(s,o)&&t.push({text:`#${s.id}.pdomOrder = ${PDOMTree$1.debugOrder(o)}`,execute:()=>{s.pdomOrder=o}})})}),this.nodes.forEach(r=>{this.isAddChildLegal(s,r)&&_.range(0,s.children.length+1).forEach(o=>{t.push({text:`#${s.id}.insertChild(${o},#${r.id})`,execute:()=>{s.insertChild(o,r)}})}),s.hasChild(r)&&t.push({text:`#${s.id}.removeChild(#${r.id})`,execute:()=>{s.removeChild(r)}})})}),t}isAddChildLegal(t,s){return!t.hasChild(s)&&this.isAcyclic(t,s)}powerSet(t){if(t.length===0)return[[]];{const s=this.powerSet(t.slice(1));return s.concat(s.map(r=>[t[0]].concat(r)))}}isPDOMOrderChangeLegal(t,s){if(s===null&&(s=[]),s=s.filter(n=>n!==null),_.includes(s,t)||_.uniq(s).length<s.length)return!1;for(let n=0;n<s.length;n++)if(s[n]._pdomParent&&s[n]._pdomParent!==t)return!1;const r=(n,l)=>n===t?n.hasChild(l)||_.includes(s,l):n.hasChild(l)||!!n.pdomOrder&&_.includes(n.pdomOrder,l),o=t.children.concat(s);return _.every(o,n=>this.isAcyclic(t,n,r))}isAcyclic(t,s,r){if(t===s)return!1;const o=s.children.concat(s.pdomOrder).filter(n=>n!==null);for(;o.length;){const n=o.pop();if(n===t)return!1;r?this.nodes.forEach(l=>{r(n,l)&&o.push(l)}):(Array.prototype.push.apply(o,n.children),n.pdomOrder&&Array.prototype.push.apply(o,n.pdomOrder.filter(l=>l!==null)))}return!0}dispose(){this.display.dispose()}}scenery.register("PDOMFuzzer",PDOMFuzzer);const ea=class ea extends EnumerationValue{};ea.DRAG=new ea,ea.KEYBOARD_DRAG=new ea,ea.enumeration=new Enumeration(ea,{phetioDocumentation:"entries when signifying Intent of the pointer"});let Intent=ea;const Yl=class Yl{constructor(t,s){assert&&assert(t===null||t instanceof Vector2),assert&&assert(Object.getPrototypeOf(this)!==Yl.prototype,"Pointer is an abstract class"),this.point=t,this.type=s,this.trail=null,this.inputEnabledTrail=null,this.isDownProperty=new BooleanProperty(!1),this.attachedProperty=new BooleanProperty(!1),this._listeners=[],this._attachedListener=null,this._cursor=null,this.lastEventContext=null,this._intents=[],this._pointerCaptured=!1,this._listenerForDragReserve=null,this._listenerForKeyboardDragReserve=null}setCursor(t){return this._cursor=t,this}set cursor(t){this.setCursor(t)}get cursor(){return this.getCursor()}getCursor(){return this._cursor}getListeners(){return this._listeners.slice()}get listeners(){return this.getListeners()}addInputListener(t,s){sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`addInputListener to ${this.toString()} attach:${s}`),sceneryLog&&sceneryLog.Pointer&&sceneryLog.push(),assert&&assert(t,"A listener must be provided"),assert&&assert(s===void 0||typeof s=="boolean","If provided, the attach parameter should be a boolean value"),assert&&assert(!_.includes(this._listeners,t),"Attempted to add an input listener that was already added"),this._listeners.push(t),s&&(assert&&assert(t.interrupt,"Interrupt should exist on attached listeners"),this.attach(t)),sceneryLog&&sceneryLog.Pointer&&sceneryLog.pop()}removeInputListener(t){sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`removeInputListener to ${this.toString()}`),sceneryLog&&sceneryLog.Pointer&&sceneryLog.push(),assert&&assert(t,"A listener must be provided");const s=_.indexOf(this._listeners,t);assert&&assert(s!==-1,"Could not find the input listener to remove"),this.isAttached()&&t===this._attachedListener&&this.detach(t),this._listeners.splice(s,1),sceneryLog&&sceneryLog.Pointer&&sceneryLog.pop()}getAttachedListener(){return this._attachedListener}get attachedListener(){return this.getAttachedListener()}isAttached(){return this.attachedProperty.value}isTouchLike(){return!1}set isDown(t){this.isDownProperty.value=t}get isDown(){return this.isDownProperty.value}interruptAttached(){this.isAttached()&&this._attachedListener.interrupt()}interruptAll(){const t=this._listeners.slice();for(let s=0;s<t.length;s++){const r=t[s];r.interrupt&&r.interrupt()}}attach(t){sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`Attaching to ${this.toString()}`),assert&&assert(!this.isAttached(),"Attempted to attach to an already attached pointer"),this.attachedProperty.value=!0,this._attachedListener=t}updatePoint(t,s="event"){const r=this.hasPointChanged(t);return t&&sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`pointer ${s} at ${t.toString()}`),this.point=t,r}down(t){this.isDown=!0}up(t,s){return this.isDown=!1,this.updatePoint(t,"up")}cancel(t){return this.isDown=!1,this.updatePoint(t,"cancel")}detach(t){sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`Detaching from ${this.toString()}`),assert&&assert(this.isAttached(),"Cannot detach a listener if one is not attached"),assert&&assert(this._attachedListener===t,"Cannot detach a different listener"),this.attachedProperty.value=!1,this._attachedListener=null}hasPointChanged(t){return this.point!==t&&(!t||!this.point||!this.point.equals(t))}addIntent(t){assert&&assert(Intent.enumeration.includes(t),"trying to set unsupported intent for Pointer"),this._intents.includes(t)||this._intents.push(t),assert&&assert(this._intents.length<=Intent.enumeration.values.length,"to many Intents saved, memory leak likely")}removeIntent(t){if(assert&&assert(Intent.enumeration.includes(t),"trying to set unsupported intent for Pointer"),this._intents.includes(t)){const s=this._intents.indexOf(t);this._intents.splice(s,1)}}hasIntent(t){return this._intents.includes(t)}reserveForDrag(){if(!this._intents.includes(Intent.DRAG)){this.addIntent(Intent.DRAG);const t={up:s=>{this.removeIntent(Intent.DRAG),this.removeInputListener(this._listenerForDragReserve),this._listenerForDragReserve=null}};assert&&assert(this._listenerForDragReserve===null,"still a listener to reserve pointer, memory leak likely"),this._listenerForDragReserve=t,this.addInputListener(this._listenerForDragReserve)}}reserveForKeyboardDrag(){if(!this._intents.includes(Intent.KEYBOARD_DRAG)){this.addIntent(Intent.KEYBOARD_DRAG);const t={keyup:r=>s(),blur:r=>s()},s=()=>{this.removeIntent(Intent.KEYBOARD_DRAG),this.removeInputListener(this._listenerForKeyboardDragReserve),this._listenerForKeyboardDragReserve=null};assert&&assert(this._listenerForDragReserve===null,"still a listener on Pointer for reserve, memory leak likely"),this._listenerForKeyboardDragReserve=t,this.addInputListener(this._listenerForKeyboardDragReserve)}}onGotPointerCapture(){this._pointerCaptured=!0}onLostPointerCapture(){this._pointerCaptured&&this.interruptAll(),this._pointerCaptured=!1}dispose(){sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`Disposing ${this.toString()}`),this._listenerForDragReserve&&this._listeners.includes(this._listenerForDragReserve)&&this.removeInputListener(this._listenerForDragReserve),this._listenerForKeyboardDragReserve&&this._listeners.includes(this._listenerForKeyboardDragReserve)&&this.removeInputListener(this._listenerForKeyboardDragReserve),assert&&assert(this._attachedListener===null,"Attached listeners should be cleared before pointer disposal"),assert&&assert(this._listeners.length===0,"Should not have listeners when a pointer is disposed")}toString(){return`Pointer#${this.type}_at_${this.point}`}};Yl.PointerIO=new IOType("PointerIO",{valueType:Yl,toStateObject:t=>({point:t.point.toStateObject(),type:t.type}),stateSchema:{point:Vector2.Vector2IO,type:StringIO}});let Pointer=Yl;scenery.register("Pointer",Pointer);class Mouse extends Pointer{constructor(t){super(t,"mouse"),this.id=null,this.leftDown=!1,this.middleDown=!1,this.rightDown=!1,this.wheelDelta=new Vector3(0,0,0),this.wheelDeltaMode=0,sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`Created ${this.toString()}`)}down(t){switch(assert&&assert(t instanceof MouseEvent),t.button){case 0:this.leftDown=!0;break;case 1:this.middleDown=!0;break;case 2:this.rightDown=!0;break}return super.down(t)}up(t,s){switch(assert&&assert(s instanceof MouseEvent),s.button){case 0:this.leftDown=!1;break;case 1:this.middleDown=!1;break;case 2:this.rightDown=!1;break}return super.up(t,s)}move(t){const s=this.hasPointChanged(t);return t&&sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`mouse move at ${t.toString()}`),this.point=t,s}over(t){const s=this.hasPointChanged(t);return t&&sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`mouse over at ${t.toString()}`),this.point=t,s}out(t){const s=this.hasPointChanged(t);return t&&sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`mouse out at ${t.toString()}`),s}wheel(t){assert&&assert(t instanceof WheelEvent);const s=t;this.wheelDelta.setXYZ(s.deltaX,s.deltaY,s.deltaZ),this.wheelDeltaMode=s.deltaMode}toString(){return"Mouse"}}scenery.register("Mouse",Mouse);class Touch extends Pointer{constructor(t,s,r){super(s,"touch"),this.id=t,sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`Created ${this.toString()}`)}move(t){const s=this.hasPointChanged(t);return this.point=t,s}toString(){return`Touch#${this.id}`}isTouchLike(){return!0}}scenery.register("Touch",Touch);class Pen extends Pointer{constructor(t,s,r){super(s,"pen"),this.id=t,sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`Created ${this.toString()}`)}move(t){const s=this.hasPointChanged(t);return this.point=t,s}toString(){return`Pen#${this.id}`}isTouchLike(){return!0}}scenery.register("Pen",Pen);class PDOMPointer extends Pointer{constructor(t){super(Vector2.ZERO,"pdom"),this.display=t,this.initializeListeners(),this.blockTrustedEvents=!1,this.keydownTargetNode=null,sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`Created ${this.toString()}`)}initializeListeners(){this.addInputListener({focus:t=>{assert&&assert(this.trail,"trail should have been calculated for the focused node");const s=this.trail.lastNode();if(s.focusable){const r=PDOMInstance$1.guessVisualTrail(this.trail,this.display.rootNode);this.point=r.parentToGlobalPoint(s.center),isNaN(this.point.x)&&this.point.setXY(0,0)}},blur:t=>{this.trail=null,this.keydownTargetNode=null},keydown:t=>{this.blockTrustedEvents&&t.domEvent.isTrusted||(this.keydownTargetNode=t.target)},keyup:t=>{this.blockTrustedEvents&&t.domEvent.isTrusted||this.keydownTargetNode!==t.target&&t.abort()}})}updateTrail(t){return this.trail&&this.trail.equals(t)||(this.trail=t),this.trail}}scenery.register("PDOMPointer",PDOMPointer);class EventContext{constructor(t){this.domEvent=t,this.activeElement=document.activeElement}static createSynthetic(){return new EventContext(new window.Event("synthetic"))}}const EventContextIO=new IOType("EventContextIO",{valueType:EventContext,documentation:"A DOM event and its context",toStateObject:a=>({domEvent:Input.serializeDomEvent(a.domEvent)}),fromStateObject:a=>new EventContext(Input.deserializeDomEvent(a.domEvent)),stateSchema:()=>({domEvent:EventIO})});scenery.register("EventContext",EventContext);const Uh=class Uh{constructor(t,s,r,o){this.handled=!1,this.aborted=!1,this.trail=t,this.type=s,this.pointer=r,this.context=o,this.domEvent=o.domEvent,this.activeElement=o.activeElement,this.currentTarget=null,this.target=t.lastNode(),this.isPrimary=!(r instanceof Mouse)||!this.domEvent||this.domEvent.button===0,r.lastEventContext=o}handle(){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent("handled event"),this.handled=!0}abort(){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent("aborted event"),this.aborted=!0}isFromPDOM(){return this.pointer instanceof PDOMPointer}canStartPress(){return!this.pointer.isAttached()&&(!(this.pointer instanceof Mouse)||this.domEvent.button===0)}};Uh.SceneryEventIO=new IOType("SceneryEventIO",{valueType:Uh,documentation:'An event, with a "point" field',toStateObject:t=>({type:t.type,domEventType:NullableIO(EventIO).toStateObject(t.domEvent),point:t.pointer&&t.pointer.point?Vector2.Vector2IO.toStateObject(t.pointer.point):null}),stateSchema:{type:StringIO,domEventType:NullableIO(EventIO),point:NullableIO(Vector2.Vector2IO)}});let SceneryEvent=Uh;scenery.register("SceneryEvent",SceneryEvent);const ArrayIOPointerIO=ArrayIO(Pointer.PointerIO),domEventPropertiesToSerialize=["altKey","button","charCode","clientX","clientY","code","ctrlKey","deltaMode","deltaX","deltaY","deltaZ","key","keyCode","metaKey","pageX","pageY","pointerId","pointerType","scale","shiftKey","target","type","relatedTarget","which"],domEventPropertiesSetInConstructor=["deltaMode","deltaX","deltaY","deltaZ","altKey","button","charCode","clientX","clientY","code","ctrlKey","key","keyCode","metaKey","pageX","pageY","pointerId","pointerType","shiftKey","type","relatedTarget","which"],EVENT_KEY_VALUES_AS_ELEMENTS=["target","relatedTarget"],PDOM_UNPICKABLE_EVENTS=["focus","blur","focusin","focusout"],TARGET_SUBSTITUTE_KEY="targetSubstitute",PDOM_CLICK_DELAY=80,bs=class bs extends PhetioObject{constructor(t,s,r,o,n,l){var g,d,A,S,O,I,W,L,H,Y,Q,pe,de,fe,ye,Ee,Le,Z,ne,Ke,_t,xe,Ct,zt;const h=optionize()({phetioType:bs.InputIO,phetioDocumentation:"Central point for user input events, such as mouse, touch"},l);super(h),this.currentSceneryEvent=null,this.display=t,this.rootNode=t.rootNode,this.attachToWindow=s,this.batchDOMEvents=r,this.assumeFullWindow=o,this.passiveEvents=n,this.batchedEvents=[],this.pdomPointer=null,this.mouse=null,this.pointers=[],this.pointerAddedEmitter=new TinyEmitter,this.currentlyFiringEvents=!1,this.upTimeStamp=0,this.validatePointersAction=new PhetioAction$1(()=>{let Je=this.pointers.length;for(;Je--;){const Et=this.pointers[Je];Et.point&&Et!==this.pdomPointer&&this.branchChangeEvents(Et,Et.lastEventContext||EventContext.createSynthetic(),!1)}},{phetioPlayback:!0,tandem:(g=h.tandem)==null?void 0:g.createTandem("validatePointersAction"),phetioHighFrequency:!0}),this.mouseUpAction=new PhetioAction$1((Je,Et)=>{const ht=this.ensureMouse(Je);ht.id=null,this.upEvent(ht,Et,Je)},{phetioPlayback:!0,tandem:(d=h.tandem)==null?void 0:d.createTandem("mouseUpAction"),parameters:[{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when a mouse button is released."}),this.mouseDownAction=new PhetioAction$1((Je,Et,ht)=>{const mt=this.ensureMouse(Et);mt.id=Je,this.downEvent(mt,ht,Et)},{phetioPlayback:!0,tandem:(A=h.tandem)==null?void 0:A.createTandem("mouseDownAction"),parameters:[{name:"id",phetioType:NullableIO(NumberIO)},{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when a mouse button is pressed."}),this.mouseMoveAction=new PhetioAction$1((Je,Et)=>{const ht=this.ensureMouse(Je);ht.move(Je),this.moveEvent(ht,Et)},{phetioPlayback:!0,tandem:(S=h.tandem)==null?void 0:S.createTandem("mouseMoveAction"),parameters:[{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when the mouse is moved.",phetioHighFrequency:!0}),this.mouseOverAction=new PhetioAction$1((Je,Et)=>{this.ensureMouse(Je).over(Je)},{phetioPlayback:!0,tandem:(O=h.tandem)==null?void 0:O.createTandem("mouseOverAction"),parameters:[{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when the mouse is moved while on the sim."}),this.mouseOutAction=new PhetioAction$1((Je,Et)=>{this.ensureMouse(Je).out(Je)},{phetioPlayback:!0,tandem:(I=h.tandem)==null?void 0:I.createTandem("mouseOutAction"),parameters:[{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when the mouse moves out of the display."}),this.wheelScrollAction=new PhetioAction$1(Je=>{const Et=Je.domEvent,ht=this.ensureMouse(this.pointFromEvent(Et));if(ht.wheel(Et),ht.point){const mt=this.rootNode.trailUnderPointer(ht)||new Trail(this.rootNode);this.dispatchEvent(mt,"wheel",ht,Je,!0)}},{phetioPlayback:!0,tandem:(W=h.tandem)==null?void 0:W.createTandem("wheelScrollAction"),parameters:[{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when the mouse wheel scrolls.",phetioHighFrequency:!0}),this.touchStartAction=new PhetioAction$1((Je,Et,ht)=>{const mt=new Touch(Je,Et,ht.domEvent);this.addPointer(mt),this.downEvent(mt,ht,Et)},{phetioPlayback:!0,tandem:(L=h.tandem)==null?void 0:L.createTandem("touchStartAction"),parameters:[{name:"id",phetioType:NumberIO},{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when a touch begins."}),this.touchEndAction=new PhetioAction$1((Je,Et,ht)=>{const mt=this.findPointerById(Je);mt&&(assert&&assert(mt instanceof Touch),this.upEvent(mt,ht,Et),this.removePointer(mt))},{phetioPlayback:!0,tandem:(H=h.tandem)==null?void 0:H.createTandem("touchEndAction"),parameters:[{name:"id",phetioType:NumberIO},{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when a touch ends."}),this.touchMoveAction=new PhetioAction$1((Je,Et,ht)=>{const mt=this.findPointerById(Je);mt&&(assert&&assert(mt instanceof Touch),mt.move(Et),this.moveEvent(mt,ht))},{phetioPlayback:!0,tandem:(Y=h.tandem)==null?void 0:Y.createTandem("touchMoveAction"),parameters:[{name:"id",phetioType:NumberIO},{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when a touch moves.",phetioHighFrequency:!0}),this.touchCancelAction=new PhetioAction$1((Je,Et,ht)=>{const mt=this.findPointerById(Je);mt&&(assert&&assert(mt instanceof Touch),this.cancelEvent(mt,ht,Et),this.removePointer(mt))},{phetioPlayback:!0,tandem:(Q=h.tandem)==null?void 0:Q.createTandem("touchCancelAction"),parameters:[{name:"id",phetioType:NumberIO},{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when a touch is canceled."}),this.penStartAction=new PhetioAction$1((Je,Et,ht)=>{const mt=new Pen(Je,Et,ht.domEvent);this.addPointer(mt),this.downEvent(mt,ht,Et)},{phetioPlayback:!0,tandem:(pe=h.tandem)==null?void 0:pe.createTandem("penStartAction"),parameters:[{name:"id",phetioType:NumberIO},{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when a pen touches the screen."}),this.penEndAction=new PhetioAction$1((Je,Et,ht)=>{const mt=this.findPointerById(Je);mt&&(this.upEvent(mt,ht,Et),this.removePointer(mt))},{phetioPlayback:!0,tandem:(de=h.tandem)==null?void 0:de.createTandem("penEndAction"),parameters:[{name:"id",phetioType:NumberIO},{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when a pen is lifted."}),this.penMoveAction=new PhetioAction$1((Je,Et,ht)=>{const mt=this.findPointerById(Je);mt&&(mt.move(Et),this.moveEvent(mt,ht))},{phetioPlayback:!0,tandem:(fe=h.tandem)==null?void 0:fe.createTandem("penMoveAction"),parameters:[{name:"id",phetioType:NumberIO},{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when a pen is moved.",phetioHighFrequency:!0}),this.penCancelAction=new PhetioAction$1((Je,Et,ht)=>{const mt=this.findPointerById(Je);mt&&(this.cancelEvent(mt,ht,Et),this.removePointer(mt))},{phetioPlayback:!0,tandem:(ye=h.tandem)==null?void 0:ye.createTandem("penCancelAction"),parameters:[{name:"id",phetioType:NumberIO},{name:"point",phetioType:Vector2.Vector2IO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when a pen is canceled."}),this.gotPointerCaptureAction=new PhetioAction$1((Je,Et)=>{const ht=this.findPointerById(Je);ht&&ht.onGotPointerCapture()},{phetioPlayback:!0,tandem:(Ee=h.tandem)==null?void 0:Ee.createTandem("gotPointerCaptureAction"),parameters:[{name:"id",phetioType:NumberIO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when a pointer is captured (normally at the start of an interaction)",phetioHighFrequency:!0}),this.lostPointerCaptureAction=new PhetioAction$1((Je,Et)=>{const ht=this.findPointerById(Je);ht&&ht.onLostPointerCapture()},{phetioPlayback:!0,tandem:(Le=h.tandem)==null?void 0:Le.createTandem("lostPointerCaptureAction"),parameters:[{name:"id",phetioType:NumberIO},{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when a pointer loses its capture (normally at the end of an interaction)",phetioHighFrequency:!0}),this.focusinAction=new PhetioAction$1(Je=>{const Et=this.getPDOMEventTrail(Je.domEvent,"focusin");Et&&(sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`focusin(${bs.debugText(null,Je.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.dispatchPDOMEvent(Et,"focus",Je,!1),this.dispatchPDOMEvent(Et,"focusin",Je,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop())},{phetioPlayback:!0,tandem:(Z=h.tandem)==null?void 0:Z.createTandem("focusinAction"),parameters:[{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when the PDOM root gets the focusin DOM event."}),this.focusoutAction=new PhetioAction$1(Je=>{const Et=this.getPDOMEventTrail(Je.domEvent,"focusout");Et&&(sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`focusOut(${bs.debugText(null,Je.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.dispatchPDOMEvent(Et,"blur",Je,!1),this.dispatchPDOMEvent(Et,"focusout",Je,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop())},{phetioPlayback:!0,tandem:(ne=h.tandem)==null?void 0:ne.createTandem("focusoutAction"),parameters:[{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when the PDOM root gets the focusout DOM event."}),this.clickAction=new PhetioAction$1(Je=>{const Et=this.getPDOMEventTrail(Je.domEvent,"click");Et&&(sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`click(${bs.debugText(null,Je.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.dispatchPDOMEvent(Et,"click",Je,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop())},{phetioPlayback:!0,tandem:(Ke=h.tandem)==null?void 0:Ke.createTandem("clickAction"),parameters:[{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when the PDOM root gets the click DOM event."}),this.inputAction=new PhetioAction$1(Je=>{const Et=this.getPDOMEventTrail(Je.domEvent,"input");Et&&(sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`input(${bs.debugText(null,Je.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.dispatchPDOMEvent(Et,"input",Je,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop())},{phetioPlayback:!0,tandem:(_t=h.tandem)==null?void 0:_t.createTandem("inputAction"),parameters:[{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when the PDOM root gets the input DOM event."}),this.changeAction=new PhetioAction$1(Je=>{const Et=this.getPDOMEventTrail(Je.domEvent,"change");Et&&(sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`change(${bs.debugText(null,Je.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.dispatchPDOMEvent(Et,"change",Je,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop())},{phetioPlayback:!0,tandem:(xe=h.tandem)==null?void 0:xe.createTandem("changeAction"),parameters:[{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when the PDOM root gets the change DOM event."}),this.keydownAction=new PhetioAction$1(Je=>{sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`keydown(${bs.debugText(null,Je.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.dispatchGlobalEvent("globalkeydown",Je,!0);const Et=this.getPDOMEventTrail(Je.domEvent,"keydown");Et&&this.dispatchPDOMEvent(Et,"keydown",Je,!0),this.dispatchGlobalEvent("globalkeydown",Je,!1),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()},{phetioPlayback:!0,tandem:(Ct=h.tandem)==null?void 0:Ct.createTandem("keydownAction"),parameters:[{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when the PDOM root gets the keydown DOM event."}),this.keyupAction=new PhetioAction$1(Je=>{sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`keyup(${bs.debugText(null,Je.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.dispatchGlobalEvent("globalkeyup",Je,!0);const Et=this.getPDOMEventTrail(Je.domEvent,"keydown");Et&&this.dispatchPDOMEvent(Et,"keyup",Je,!0),this.dispatchGlobalEvent("globalkeyup",Je,!1),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()},{phetioPlayback:!0,tandem:(zt=h.tandem)==null?void 0:zt.createTandem("keyupAction"),parameters:[{name:"context",phetioType:EventContextIO}],phetioEventType:EventType.USER,phetioDocumentation:"Emits when the PDOM root gets the keyup DOM event."})}interruptPointers(t=null){_.each(this.pointers,s=>{s!==t&&s.interruptAll()})}batchEvent(t,s,r,o){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent("Input.batchEvent"),sceneryLog&&sceneryLog.InputEvent&&sceneryLog.push(),this.display.interactive&&(this.batchedEvents.push(BatchedDOMEvent.pool.create(t,s,r)),(o||!this.batchDOMEvents)&&this.fireBatchedEvents()),this.passiveEvents!==!0&&(r!==this.mouseDown||platform.edge)&&s!==BatchedDOMEventType.ALT_TYPE&&t.domEvent.preventDefault(),sceneryLog&&sceneryLog.InputEvent&&sceneryLog.pop()}fireBatchedEvents(){if(sceneryLog&&sceneryLog.InputEvent&&this.currentlyFiringEvents&&sceneryLog.InputEvent("REENTRANCE DETECTED"),!this.currentlyFiringEvents&&this.batchedEvents.length){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`Input.fireBatchedEvents length:${this.batchedEvents.length}`),sceneryLog&&sceneryLog.InputEvent&&sceneryLog.push(),this.currentlyFiringEvents=!0;const t=this.batchedEvents;for(let s=0;s<t.length;s++){const r=t[s];r.run(this),r.dispose()}cleanArray(t),this.currentlyFiringEvents=!1,sceneryLog&&sceneryLog.InputEvent&&sceneryLog.pop()}}clearBatchedEvents(){this.batchedEvents.length=0}validatePointers(){this.validatePointersAction.execute()}removeTemporaryPointers(){for(let t=this.pointers.length-1;t>=0;t--){const s=this.pointers[t];if(!(s instanceof Mouse)){this.pointers.splice(t,1);const r=s.trail||new Trail(this.rootNode);this.exitEvents(s,EventContext.createSynthetic(),r,0,!0)}}}connectListeners(){BrowserEvents$1.addDisplay(this.display,this.attachToWindow,this.passiveEvents)}disconnectListeners(){BrowserEvents$1.removeDisplay(this.display,this.attachToWindow,this.passiveEvents)}pointFromEvent(t){const s=Vector2.pool.create(t.clientX,t.clientY);if(!this.assumeFullWindow){const r=this.display.domElement.getBoundingClientRect();r.width>0&&r.height>0&&(s.subtractXY(r.left,r.top),(r.width!==this.display.width||r.height!==this.display.height)&&(s.x*=this.display.width/r.width,s.y*=this.display.height/r.height))}return s}addPointer(t){this.pointers.push(t),this.pointerAddedEmitter.emit(t)}removePointer(t){for(let s=this.pointers.length-1;s>=0;s--)this.pointers[s]===t&&this.pointers.splice(s,1);t.dispose()}findPointerById(t){let s=this.pointers.length;for(;s--;){const r=this.pointers[s];if(r.id===t)return r}return null}getPDOMEventTrail(t,s){if(!this.display.interactive)return null;const r=this.getTrailFromPDOMEvent(t);return r&&!(s==="click"&&_.some(r.nodes,n=>n.positionInPDOM)&&t.timeStamp-this.upTimeStamp<=PDOM_CLICK_DELAY)?r:null}initMouse(t){const s=new Mouse(t);return this.mouse=s,this.addPointer(s),s}ensureMouse(t){const s=this.mouse;return s||this.initMouse(t)}initPDOMPointer(){const t=new PDOMPointer(this.display);return this.pdomPointer=t,this.addPointer(t),t}ensurePDOMPointer(){const t=this.pdomPointer;return t||this.initPDOMPointer()}dispatchPDOMEvent(t,s,r,o){this.ensurePDOMPointer().updateTrail(t),PDOMUtils$1.USER_GESTURE_EVENTS.includes(s)&&Display.userGestureEmitter.emit();const n=r.domEvent;n.target&&n.target.hasAttribute(PDOMUtils$1.DATA_EXCLUDE_FROM_INPUT)||(t.isPickable()||PDOM_UNPICKABLE_EVENTS.includes(s)||(t=new Trail([])),assert&&assert(this.pdomPointer),this.dispatchEvent(t,s,this.pdomPointer,r,o))}dispatchGlobalEvent(t,s,r){this.ensurePDOMPointer(),assert&&assert(this.pdomPointer);const o=this.pdomPointer,n=new SceneryEvent(new Trail,t,o,s),l=h=>{if(!h.isDisposed&&h.isVisible()&&h.isInputEnabled()&&h.isPDOMVisible()){for(let g=h._children.length-1;g>=0;g--)l(h._children[g]);!n.aborted&&!n.handled&&(n.currentTarget=h,this.dispatchToListeners(o,h._inputListeners,t,n,r))}};l(this.rootNode)}getRelatedTargetTrail(t){const s=t.relatedTarget;if(s&&this.display.isElementUnderPDOM(s)){const r=t.relatedTarget;assert&&assert(r instanceof window.Element);const o=r.getAttribute(PDOMUtils$1.DATA_PDOM_UNIQUE_ID);return assert&&assert(o,"should not be null"),PDOMInstance$1.uniqueIdToTrail(this.display,o)}return null}getTrailFromPDOMEvent(t){if(assert&&assert(t.target||t[TARGET_SUBSTITUTE_KEY],"need a way to get the target"),!this.display._accessible)return null;if(t[TARGET_SUBSTITUTE_KEY]){const s=t[TARGET_SUBSTITUTE_KEY].getAttribute(PDOMUtils$1.DATA_PDOM_UNIQUE_ID);return PDOMInstance$1.uniqueIdToTrail(this.display,s)}else{const s=t.target;if(assert&&assert(s instanceof window.Element,"target is not an Element",s),s&&this.display.isElementUnderPDOM(s)){const r=s.getAttribute(PDOMUtils$1.DATA_PDOM_UNIQUE_ID);return assert&&assert(r,"should not be null"),PDOMInstance$1.uniqueIdToTrail(this.display,r)}}return null}mouseDown(t,s,r){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`mouseDown('${t}', ${bs.debugText(s,r.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.mouseDownAction.execute(t,s,r),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}mouseUp(t,s){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`mouseUp(${bs.debugText(t,s.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.mouseUpAction.execute(t,s),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}mouseMove(t,s){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`mouseMove(${bs.debugText(t,s.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.mouseMoveAction.execute(t,s),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}mouseOver(t,s){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`mouseOver(${bs.debugText(t,s.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.mouseOverAction.execute(t,s),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}mouseOut(t,s){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`mouseOut(${bs.debugText(t,s.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.mouseOutAction.execute(t,s),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}wheel(t){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`wheel(${bs.debugText(null,t.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.wheelScrollAction.execute(t),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}touchStart(t,s,r){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`touchStart('${t}',${bs.debugText(s,r.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.touchStartAction.execute(t,s,r),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}touchEnd(t,s,r){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`touchEnd('${t}',${bs.debugText(s,r.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.touchEndAction.execute(t,s,r),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}touchMove(t,s,r){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`touchMove('${t}',${bs.debugText(s,r.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.touchMoveAction.execute(t,s,r),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}touchCancel(t,s,r){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`touchCancel('${t}',${bs.debugText(s,r.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.touchCancelAction.execute(t,s,r),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}penStart(t,s,r){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`penStart('${t}',${bs.debugText(s,r.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.penStartAction.execute(t,s,r),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}penEnd(t,s,r){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`penEnd('${t}',${bs.debugText(s,r.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.penEndAction.execute(t,s,r),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}penMove(t,s,r){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`penMove('${t}',${bs.debugText(s,r.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.penMoveAction.execute(t,s,r),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}penCancel(t,s,r){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`penCancel('${t}',${bs.debugText(s,r.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.penCancelAction.execute(t,s,r),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}pointerDown(t,s,r,o){const n=this.attachToWindow?document.body:this.display.domElement;switch(n.setPointerCapture&&o.domEvent.pointerId&&n.setPointerCapture(o.domEvent.pointerId),s=this.handleUnknownPointerType(s,t),s){case"mouse":this.mouseDown(t,r,o);break;case"touch":this.touchStart(t,r,o);break;case"pen":this.penStart(t,r,o);break;default:if(assert)throw new Error(`Unknown pointer type: ${s}`)}}pointerUp(t,s,r,o){switch(this.upTimeStamp=o.domEvent.timeStamp,s=this.handleUnknownPointerType(s,t),s){case"mouse":this.mouseUp(r,o);break;case"touch":this.touchEnd(t,r,o);break;case"pen":this.penEnd(t,r,o);break;default:if(assert)throw new Error(`Unknown pointer type: ${s}`)}}pointerCancel(t,s,r,o){switch(s=this.handleUnknownPointerType(s,t),s){case"mouse":console&&console.log&&console.log("WARNING: Pointer mouse cancel was received");break;case"touch":this.touchCancel(t,r,o);break;case"pen":this.penCancel(t,r,o);break;default:console.log&&console.log(`Unknown pointer type: ${s}`)}}gotPointerCapture(t,s,r,o){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`gotPointerCapture('${t}',${bs.debugText(null,o.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.gotPointerCaptureAction.execute(t,o),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}lostPointerCapture(t,s,r,o){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`lostPointerCapture('${t}',${bs.debugText(null,o.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.lostPointerCaptureAction.execute(t,o),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}pointerMove(t,s,r,o){switch(s=this.handleUnknownPointerType(s,t),s){case"mouse":this.mouseMove(r,o);break;case"touch":this.touchMove(t,r,o);break;case"pen":this.penMove(t,r,o);break;default:console.log&&console.log(`Unknown pointer type: ${s}`)}}pointerOver(t,s,r,o){}pointerOut(t,s,r,o){}pointerEnter(t,s,r,o){}pointerLeave(t,s,r,o){}focusIn(t){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`focusIn('${bs.debugText(null,t.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.focusinAction.execute(t),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}focusOut(t){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`focusOut('${bs.debugText(null,t.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.focusoutAction.execute(t),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}input(t){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`input('${bs.debugText(null,t.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.inputAction.execute(t),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}change(t){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`change('${bs.debugText(null,t.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.changeAction.execute(t),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}click(t){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`click('${bs.debugText(null,t.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.clickAction.execute(t),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}keyDown(t){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`keyDown('${bs.debugText(null,t.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.keydownAction.execute(t),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}keyUp(t){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`keyUp('${bs.debugText(null,t.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.keyupAction.execute(t),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}handleUnknownPointerType(t,s){return t!==""?t:this.mouse&&this.mouse.id===s?"mouse":"touch"}getPointerTrail(t){return this.rootNode.trailUnderPointer(t)||new Trail(this.rootNode)}upEvent(t,s,r){if(this.display.isElementUnderPDOM(s.domEvent.target))return;const o=t.up(r,s.domEvent);sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`upEvent ${t.toString()} changed:${o}`),sceneryLog&&sceneryLog.Input&&sceneryLog.push();const n=this.branchChangeEvents(t,s,o);this.dispatchEvent(n,"up",t,s,!0),t.isTouchLike()&&this.exitEvents(t,s,n,0,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}downEvent(t,s,r){if(this.display.isElementUnderPDOM(s.domEvent.target))return;const o=t.updatePoint(r);sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`downEvent ${t.toString()} changed:${o}`),sceneryLog&&sceneryLog.Input&&sceneryLog.push();const n=this.branchChangeEvents(t,s,o);t.down(s.domEvent),this.dispatchEvent(n,"down",t,s,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}moveEvent(t,s){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`moveEvent ${t.toString()}`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.branchChangeEvents(t,s,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}cancelEvent(t,s,r){const o=t.cancel(r);sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`cancelEvent ${t.toString()} changed:${o}`),sceneryLog&&sceneryLog.Input&&sceneryLog.push();const n=this.branchChangeEvents(t,s,o);this.dispatchEvent(n,"cancel",t,s,!0),t.isTouchLike()&&this.exitEvents(t,s,n,0,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}branchChangeEvents(t,s,r){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`branchChangeEvents: ${t.toString()} sendMove:${r}`),sceneryLog&&sceneryLog.InputEvent&&sceneryLog.push();const o=this.getPointerTrail(t),n=o.slice(0,Math.min(o.nodes.length,o.getLastInputEnabledIndex()+1)),l=t.inputEnabledTrail||new Trail(this.rootNode),h=Trail.branchIndex(n,l),g=l.lastNode()!==n.lastNode();if(sceneryLog&&sceneryLog.InputEvent){const d=t.trail||new Trail(this.rootNode),A=Trail.branchIndex(o,d);(A!==o.length||A!==d.length)&&sceneryLog.InputEvent(`changed from ${d.toString()} to ${o.toString()}`)}return r&&this.dispatchEvent(o,"move",t,s,!0),this.exitEvents(t,s,l,h,g),this.enterEvents(t,s,n,h,g),t.trail=o,t.inputEnabledTrail=n,sceneryLog&&sceneryLog.InputEvent&&sceneryLog.pop(),o}enterEvents(t,s,r,o,n){n&&this.dispatchEvent(r,"over",t,s,!0,!0);for(let l=o;l<r.length;l++)this.dispatchEvent(r.slice(0,l+1),"enter",t,s,!1)}exitEvents(t,s,r,o,n){for(let l=r.length-1;l>=o;l--)this.dispatchEvent(r.slice(0,l+1),"exit",t,s,!1,!0);n&&this.dispatchEvent(r,"out",t,s,!0)}dispatchEvent(t,s,r,o,n,l=!1){sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.EventDispatch(`${s} trail:${t.toString()} pointer:${r.toString()} at ${r.point?r.point.toString():"null"}`),sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.push(),assert&&assert(t,"Falsy trail for dispatchEvent"),sceneryLog&&sceneryLog.EventPath&&sceneryLog.EventPath(`${s} ${t.toPathString()}`);const h=new SceneryEvent(t,s,r,o);this.currentSceneryEvent=h,this.dispatchToListeners(r,r.getListeners(),s,h),this.dispatchToTargets(t,s,r,h,n,l),this.dispatchToListeners(r,this.display.getInputListeners(),s,h),Display.inputListeners.length&&this.dispatchToListeners(r,Display.inputListeners.slice(),s,h),this.currentSceneryEvent=null,sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.pop()}dispatchToListeners(t,s,r,o,n=null){if(o.handled)return;const l=t.type+r;for(let h=0;h<s.length;h++){const g=s[h];(n===null||n===!!g.capture)&&(!o.aborted&&g[l]&&(sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.EventDispatch(l),sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.push(),g[l](o),sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.pop()),!o.aborted&&g[r]&&(sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.EventDispatch(r),sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.push(),g[r](o),sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.pop()))}}dispatchToTargets(t,s,r,o,n,l=!1){if(o.aborted||o.handled)return;const h=t.getLastInputEnabledIndex();for(let g=t.nodes.length-1;g>=0;n?g--:g=-1){const d=t.nodes[g],A=h<g;if(!(d.isDisposed||!l&&A)&&(o.currentTarget=d,this.dispatchToListeners(r,d.getInputListeners(),s,o),o.aborted||o.handled))return}}static serializeDomEvent(t){const s={constructorName:t.constructor.name};return domEventPropertiesToSerialize.forEach(r=>{const o=t[r];o==null?s[r]=null:o instanceof Element&&EVENT_KEY_VALUES_AS_ELEMENTS.includes(r)&&typeof o.getAttribute=="function"&&o.hasAttribute(PDOMUtils$1.DATA_PDOM_UNIQUE_ID)?s[r]={[PDOMUtils$1.DATA_PDOM_UNIQUE_ID]:o.getAttribute(PDOMUtils$1.DATA_PDOM_UNIQUE_ID),id:o.getAttribute("id")}:s[r]=typeof o=="object"?{}:JSON.parse(JSON.stringify(o))}),s}static deserializeDomEvent(t){const s=t.constructorName||"Event",r=_.pick(t,domEventPropertiesSetInConstructor);if(r.relatedTarget){const n=document.getElementById(r.relatedTarget.id);assert&&assert(n,"cannot deserialize event when related target is not in the DOM."),r.relatedTarget=n}const o=new window[s](s,r);for(const n in t)if(t.hasOwnProperty(n)&&!domEventPropertiesSetInConstructor.includes(n))if(n==="target"){if(assert){const l=t.target;l&&l.id&&assert(document.getElementById(l.id),"target should exist in the PDOM to support playback.")}o[TARGET_SUBSTITUTE_KEY]=_.clone(t[n])||{},o[TARGET_SUBSTITUTE_KEY].getAttribute=function(l){return this[l]}}else o[n]=t[n];return o}static debugText(t,s){let r=`${s.timeStamp} ${s.type}`;return t!==null&&(r=`${t.x},${t.y} ${r}`),r}static msPointerType(t){return t.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_TOUCH?"touch":t.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_PEN?"pen":t.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_MOUSE?"mouse":t.pointerType}};bs.InputIO=new IOType("InputIO",{valueType:bs,applyState:_.noop,toStateObject:t=>({pointers:ArrayIOPointerIO.toStateObject(t.pointers)}),stateSchema:{pointers:ArrayIOPointerIO}});let Input=bs;scenery.register("Input",Input);const Nn=class Nn extends EnumerationValue{};Nn.POINTER_TYPE=new Nn,Nn.MS_POINTER_TYPE=new Nn,Nn.TOUCH_TYPE=new Nn,Nn.MOUSE_TYPE=new Nn,Nn.WHEEL_TYPE=new Nn,Nn.ALT_TYPE=new Nn,Nn.enumeration=new Enumeration(Nn,{phetioDocumentation:"The type of batched event"});let BatchedDOMEventType=Nn;const Kl=class Kl{constructor(t,s,r){this.initialize(t,s,r)}initialize(t,s,r){return assert&&assert(t.domEvent,"for some reason, there is no DOM event?"),this.eventContext=t,this.type=s,this.callback=r,this}run(t){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent("Running batched event"),sceneryLog&&sceneryLog.InputEvent&&sceneryLog.push();const s=this.callback;if(t.validatePointers(),this.type===BatchedDOMEventType.POINTER_TYPE){const r=this.eventContext,o=r.domEvent;s.call(t,o.pointerId,o.pointerType,t.pointFromEvent(o),r)}else if(this.type===BatchedDOMEventType.MS_POINTER_TYPE){const r=this.eventContext,o=r.domEvent;s.call(t,o.pointerId,Input.msPointerType(o),t.pointFromEvent(o),r)}else if(this.type===BatchedDOMEventType.TOUCH_TYPE){const r=this.eventContext,o=r.domEvent;for(let n=0;n<o.changedTouches.length;n++){const l=o.changedTouches.item(n);s.call(t,l.identifier,t.pointFromEvent(l),r)}}else if(this.type===BatchedDOMEventType.MOUSE_TYPE){const r=this.eventContext,o=t.pointFromEvent(r.domEvent);s===t.mouseDown?s.call(t,null,o,r):s.call(t,o,r)}else if(this.type===BatchedDOMEventType.WHEEL_TYPE||this.type===BatchedDOMEventType.ALT_TYPE)s.call(t,this.eventContext);else throw new Error(`bad type value: ${this.type}`);sceneryLog&&sceneryLog.InputEvent&&sceneryLog.pop()}dispose(){this.eventContext=null,this.callback=null,this.freeToPool()}freeToPool(){Kl.pool.freeToPool(this)}};Kl.pool=new Pool(Kl);let BatchedDOMEvent=Kl;scenery.register("BatchedDOMEvent",BatchedDOMEvent);const noop=()=>{};let isGloballyAttached=!1;const BrowserEvents={blockFocusCallbacks:!1,addDisplay(a,t,s){assert&&assert(a instanceof Display),assert&&assert(typeof t=="boolean"),assert&&assert(!_.includes(this.attachedDisplays,a),"A display cannot be concurrently attached to events more than one time"),isGloballyAttached||(isGloballyAttached=!0,globalKeyStateTracker$1.attachToWindow(),FocusManager.attachToWindow()),this.attachedDisplays.push(a),t?this.attachedDisplays.length===1&&this.connectWindowListeners(s):this.addOrRemoveListeners(a.domElement,!0,s),a.domElement.addEventListener("wheel",this.onwheel,BrowserEvents.getEventOptions(s,!0))},removeDisplay(a,t,s){assert&&assert(a instanceof Display),assert&&assert(typeof t=="boolean"),assert&&assert(_.includes(this.attachedDisplays,a),"This display was not already attached to listen for window events"),arrayRemove(this.attachedDisplays,a),t?this.attachedDisplays.length===0&&this.disconnectWindowListeners(s):this.addOrRemoveListeners(a.domElement,!1,s),a.domElement.removeEventListener("wheel",this.onwheel,BrowserEvents.getEventOptions(s,!0))},getEventOptions(a,t){if(Features.passive&&a!==null){const r={passive:a};return t&&(r.capture=!1),assert&&assert(!r.capture,"Do not use capture without consulting globalKeyStateTracker, which expects have listeners called FIRST in keyboard-related cases."),r}else return!1},listenersAttachedToWindow:0,listenersAttachedToElement:0,attachedDisplays:[],canUsePointerEvents:!!(window.navigator&&window.navigator.pointerEnabled||window.PointerEvent)&&!platform.firefox,canUseMSPointerEvents:window.navigator&&window.navigator.msPointerEnabled,pointerListenerTypes:["pointerdown","pointerup","pointermove","pointerover","pointerout","pointercancel","gotpointercapture","lostpointercapture"],msPointerListenerTypes:["MSPointerDown","MSPointerUp","MSPointerMove","MSPointerOver","MSPointerOut","MSPointerCancel"],touchListenerTypes:["touchstart","touchend","touchmove","touchcancel"],mouseListenerTypes:["mousedown","mouseup","mousemove","mouseover","mouseout"],wheelListenerTypes:["wheel"],altListenerTypes:PDOMUtils$1.DOM_EVENTS,getNonWheelUsedTypes(){let a;return this.canUsePointerEvents?(sceneryLog&&sceneryLog.Input&&sceneryLog.Input("Detected pointer events support, using that instead of mouse/touch events"),a=this.pointerListenerTypes):this.canUseMSPointerEvents?(sceneryLog&&sceneryLog.Input&&sceneryLog.Input("Detected MS pointer events support, using that instead of mouse/touch events"),a=this.msPointerListenerTypes):(sceneryLog&&sceneryLog.Input&&sceneryLog.Input("No pointer events support detected, using mouse/touch events"),a=this.touchListenerTypes.concat(this.mouseListenerTypes)),a=a.concat(this.altListenerTypes),a},connectWindowListeners(a){this.addOrRemoveListeners(window,!0,a)},disconnectWindowListeners(a){this.addOrRemoveListeners(window,!1,a)},addOrRemoveListeners(a,t,s){assert&&assert(typeof t=="boolean"),assert&&assert(typeof s=="boolean"||s===null);const r=a===window;assert&&assert(!r||this.listenersAttachedToWindow>0==!t,"Do not add listeners to the window when already attached, or remove listeners when none are attached");const o=t?1:-1;r?this.listenersAttachedToWindow+=o:this.listenersAttachedToElement+=o,assert&&assert(this.listenersAttachedToWindow===0||this.listenersAttachedToElement===0,"Listeners should not be added both with addDisplayToWindow and addDisplayToElement. Use only one.");const n=t?"addEventListener":"removeEventListener",l=this.getNonWheelUsedTypes();for(let h=0;h<l.length;h++){const g=l[h];r&&document[n](g,noop,BrowserEvents.getEventOptions(s,!1));const d=this[`on${g}`];assert&&assert(!!d),a[n](g,d,BrowserEvents.getEventOptions(s,!0))}},batchWindowEvent(a,t,s,r){for(let o=0;o<this.attachedDisplays.length;o++){const l=this.attachedDisplays[o]._input;(!BrowserEvents.blockFocusCallbacks||s!=="focusIn"&&s!=="focusOut")&&l.batchEvent(a,t,l[s],r)}},onpointerdown:function(t){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("pointerdown"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push();const s=new EventContext(t);t.pointerType==="mouse"&&Display.userGestureEmitter.emit(),BrowserEvents.batchWindowEvent(s,BatchedDOMEventType.POINTER_TYPE,"pointerDown",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onpointerup:function(t){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("pointerup"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push();const s=new EventContext(t);Display.userGestureEmitter.emit(),BrowserEvents.batchWindowEvent(s,BatchedDOMEventType.POINTER_TYPE,"pointerUp",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onpointermove:function(t){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("pointermove"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(t),BatchedDOMEventType.POINTER_TYPE,"pointerMove",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onpointerover:function(t){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("pointerover"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(t),BatchedDOMEventType.POINTER_TYPE,"pointerOver",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onpointerout:function(t){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("pointerout"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(t),BatchedDOMEventType.POINTER_TYPE,"pointerOut",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onpointercancel:function(t){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("pointercancel"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(t),BatchedDOMEventType.POINTER_TYPE,"pointerCancel",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},ongotpointercapture:function(t){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("gotpointercapture"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(t),BatchedDOMEventType.POINTER_TYPE,"gotPointerCapture",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onlostpointercapture:function(t){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("lostpointercapture"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(t),BatchedDOMEventType.POINTER_TYPE,"lostPointerCapture",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onMSPointerDown:function(t){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("MSPointerDown"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(t),BatchedDOMEventType.MS_POINTER_TYPE,"pointerDown",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onMSPointerUp:function(t){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("MSPointerUp"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(t),BatchedDOMEventType.MS_POINTER_TYPE,"pointerUp",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onMSPointerMove:function(t){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("MSPointerMove"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(t),BatchedDOMEventType.MS_POINTER_TYPE,"pointerMove",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onMSPointerOver:function(t){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("MSPointerOver"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(t),BatchedDOMEventType.MS_POINTER_TYPE,"pointerOver",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onMSPointerOut:function(t){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("MSPointerOut"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(t),BatchedDOMEventType.MS_POINTER_TYPE,"pointerOut",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onMSPointerCancel:function(t){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("MSPointerCancel"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(t),BatchedDOMEventType.MS_POINTER_TYPE,"pointerCancel",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},ontouchstart:function(t){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("touchstart"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(t),BatchedDOMEventType.TOUCH_TYPE,"touchStart",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},ontouchend:function(t){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("touchend"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push();const s=new EventContext(t);Display.userGestureEmitter.emit(),BrowserEvents.batchWindowEvent(s,BatchedDOMEventType.TOUCH_TYPE,"touchEnd",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},ontouchmove:function(t){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("touchmove"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(t),BatchedDOMEventType.TOUCH_TYPE,"touchMove",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},ontouchcancel:function(t){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("touchcancel"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(t),BatchedDOMEventType.TOUCH_TYPE,"touchCancel",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onmousedown:function(t){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("mousedown"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push();const s=new EventContext(t);Display.userGestureEmitter.emit(),BrowserEvents.batchWindowEvent(s,BatchedDOMEventType.MOUSE_TYPE,"mouseDown",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onmouseup:function(t){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("mouseup"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push();const s=new EventContext(t);Display.userGestureEmitter.emit(),BrowserEvents.batchWindowEvent(s,BatchedDOMEventType.MOUSE_TYPE,"mouseUp",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onmousemove:function(t){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("mousemove"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(t),BatchedDOMEventType.MOUSE_TYPE,"mouseMove",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onmouseover:function(t){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("mouseover"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(t),BatchedDOMEventType.MOUSE_TYPE,"mouseOver",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onmouseout:function(t){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("mouseout"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(t),BatchedDOMEventType.MOUSE_TYPE,"mouseOut",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onwheel:function(t){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("wheel"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(t),BatchedDOMEventType.WHEEL_TYPE,"wheel",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onfocusin:function(t){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("focusin"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),FocusManager.updatePDOMFocusFromEvent(BrowserEvents.attachedDisplays,t,!0),BrowserEvents.batchWindowEvent(new EventContext(t),BatchedDOMEventType.ALT_TYPE,"focusIn",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onfocusout:function(t){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("focusout"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),FocusManager.updatePDOMFocusFromEvent(BrowserEvents.attachedDisplays,t,!1),BrowserEvents.batchWindowEvent(new EventContext(t),BatchedDOMEventType.ALT_TYPE,"focusOut",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},oninput:function(t){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("input"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(t),BatchedDOMEventType.ALT_TYPE,"input",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onchange:function(t){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("change"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(t),BatchedDOMEventType.ALT_TYPE,"change",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onclick:function(t){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("click"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(t),BatchedDOMEventType.ALT_TYPE,"click",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onkeydown:function(t){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("keydown"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(t),BatchedDOMEventType.ALT_TYPE,"keyDown",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onkeyup:function(t){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("keyup"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),BrowserEvents.batchWindowEvent(new EventContext(t),BatchedDOMEventType.ALT_TYPE,"keyUp",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()}};scenery.register("BrowserEvents",BrowserEvents);const BrowserEvents$1=BrowserEvents;class InputFuzzer{constructor(t,s){this.display=t,this.touches=[],this.nextTouchID=1,this.isMouseDown=!1,this.mousePosition=new Vector2(0,0),this.random=new Random({seed:s}),this.mouseToggleAction=()=>{this.mouseToggle()},this.mouseMoveAction=()=>{this.mouseMove()},this.touchStartAction=()=>{const r=this.createTouch(this.getRandomPosition());this.touchStart(r)},this.touchMoveAction=()=>{const r=this.random.sample(this.touches);this.touchMove(r)},this.touchEndAction=()=>{const r=this.random.sample(this.touches);this.touchEnd(r),this.removeTouch(r)},this.touchCancelAction=()=>{const r=this.random.sample(this.touches);this.touchCancel(r),this.removeTouch(r)}}fuzzEvents(t,s,r,o){for(assert&&assert(t>0,`averageEventCount must be positive: ${t}`),this.display._input.currentlyFiringEvents=!0;this.random.nextDouble()<1-1/(t+1);){const l=this.touches.length+(this.isMouseDown?1:0)<o,h=[];s&&(this.isMouseDown||l)&&(h.push(this.mouseToggleAction),h.push(this.mouseMoveAction)),r&&(l&&h.push(this.touchStartAction),this.touches.length&&(h.push(this.random.nextDouble()<.8?this.touchEndAction:this.touchCancelAction),h.push(this.touchMoveAction))),this.random.sample(h)()}this.display._input.currentlyFiringEvents=!1,this.display._input.fireBatchedEvents()}createTouchEvent(t,s){const r=this.display.domElement,o=s.map(n=>({identifier:n.id,target:r,clientX:n.position.x,clientY:n.position.y}));if(window.Touch!==void 0&&window.TouchEvent!==void 0&&window.Touch.length===1&&window.TouchEvent.length===1){const n=o.map(l=>new window.Touch(l));return new window.TouchEvent(t,{cancelable:!0,bubbles:!0,touches:n,targetTouches:[],changedTouches:n,shiftKey:!1})}else{const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!0,!0,{touches:o,targetTouches:[],changedTouches:o}),n}}getRandomPosition(){return new Vector2(Math.floor(this.random.nextDouble()*this.display.width),Math.floor(this.random.nextDouble()*this.display.height))}createTouch(t){const s={id:this.nextTouchID++,position:t};return this.touches.push(s),s}removeTouch(t){this.touches.splice(this.touches.indexOf(t),1)}touchStart(t){const s=this.createTouchEvent("touchstart",[t]);this.display._input.validatePointers(),this.display._input.touchStart(t.id,t.position,new EventContext(s))}touchMove(t){t.position=this.getRandomPosition();const s=this.createTouchEvent("touchmove",[t]);this.display._input.validatePointers(),this.display._input.touchMove(t.id,t.position,new EventContext(s))}touchEnd(t){const s=this.createTouchEvent("touchend",[t]);this.display._input.validatePointers(),this.display._input.touchEnd(t.id,t.position,new EventContext(s))}touchCancel(t){const s=this.createTouchEvent("touchcancel",[t]);this.display._input.validatePointers(),this.display._input.touchCancel(t.id,t.position,new EventContext(s))}mouseToggle(){const t=document.createEvent("MouseEvent");t.initMouseEvent(this.isMouseDown?"mouseup":"mousedown",!0,!0,window,1,this.mousePosition.x,this.mousePosition.y,this.mousePosition.x,this.mousePosition.y,!1,!1,!1,!1,0,null),this.display._input.validatePointers(),this.isMouseDown?(this.display._input.mouseUp(this.mousePosition,new EventContext(t)),this.isMouseDown=!1):(this.display._input.mouseDown(null,this.mousePosition,new EventContext(t)),this.isMouseDown=!0)}mouseMove(){this.mousePosition=this.getRandomPosition();const t=document.createEvent("MouseEvent");t.initMouseEvent("mousemove",!0,!0,window,0,this.mousePosition.x,this.mousePosition.y,this.mousePosition.x,this.mousePosition.y,!1,!1,!1,!1,0,null),this.display._input.validatePointers(),this.display._input.mouseMove(this.mousePosition,new EventContext(t))}}scenery.register("InputFuzzer",InputFuzzer);class DownUpListener extends PhetioObject{constructor(t){assert&&deprecationWarning("DownUpListener is deprecated, please use PressListener instead"),t=merge({mouseButton:0},t),super(t),this.options=t,this.isDown=!1,this.downCurrentTarget=null,this.downTrail=null,this.pointer=null,this.interrupted=!1,this.downListener={up:s=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`DownUpListener (pointer) up for ${this.downTrail.toString()}`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),assert&&assert(s.pointer===this.pointer),(!(s.pointer instanceof Mouse)||s.domEvent.button===this.options.mouseButton)&&this.buttonUp(s),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},interrupt:()=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`DownUpListener (pointer) interrupt for ${this.downTrail.toString()}`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.interrupt(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},cancel:s=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`DownUpListener (pointer) cancel for ${this.downTrail.toString()}`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),assert&&assert(s.pointer===this.pointer),this.buttonUp(s),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}}}buttonDown(t){this.isDown||t.pointer instanceof Mouse&&t.domEvent.button!==this.options.mouseButton||(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DownUpListener buttonDown"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),t.pointer.addInputListener(this.downListener),this.isDown=!0,this.downCurrentTarget=t.currentTarget,this.downTrail=t.trail.subtrailTo(t.currentTarget,!1),this.pointer=t.pointer,this.options.down&&this.options.down(t,this.downTrail),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop())}buttonUp(t){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DownUpListener buttonUp"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.isDown=!1,this.pointer.removeInputListener(this.downListener);const s=t.currentTarget;if(t.currentTarget=this.downCurrentTarget,this.options.upInside||this.options.upOutside){const o=t.trail.isExtensionOf(this.downTrail,!0)&&!this.interrupted;o&&this.options.upInside?this.options.upInside(t,this.downTrail):!o&&this.options.upOutside&&this.options.upOutside(t,this.downTrail)}this.options.up&&this.options.up(t,this.downTrail),t.currentTarget=s,sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}down(t){this.buttonDown(t)}interrupt(){if(this.isDown){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DownUpListener interrupt"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.interrupted=!0;const t=EventContext.createSynthetic(),s=new SceneryEvent(new Trail,"synthetic",this.pointer,t);s.currentTarget=this.downCurrentTarget,this.buttonUp(s),this.interrupted=!1,sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}}}scenery.register("DownUpListener",DownUpListener);class ButtonListener extends DownUpListener{constructor(t){assert&&deprecationWarning("ButtonListener is deprecated, please use FireListener instead"),t=merge({phetioType:ButtonListener.ButtonListenerIO,phetioState:!1,phetioEventType:EventType.USER},t),super({tandem:t.tandem,phetioType:t.phetioType,phetioState:t.phetioState,mouseButton:t.mouseButton||0,down:(s,r)=>{this.setButtonState(s,"down")},up:(s,r)=>{this.setButtonState(s,this._overCount>0?"over":"up")}}),this.buttonState="up",this._overCount=0,this._buttonOptions=t}setButtonState(t,s){if(s!==this.buttonState){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`ButtonListener state change to ${s} from ${this.buttonState} for ${this.downTrail?this.downTrail.toString():this.downTrail}`);const r=this.buttonState;this.buttonState=s,this._buttonOptions[s]&&(this.phetioStartEvent(s),this._buttonOptions[s](t,r),this.phetioEndEvent()),this._buttonOptions.fire&&this._overCount>0&&!this.interrupted&&(this._buttonOptions.fireOnDown?s==="down":r==="down")&&(this.phetioStartEvent("fire"),this._buttonOptions.fire(t),this.phetioEndEvent())}}enter(t){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`ButtonListener enter for ${this.downTrail?this.downTrail.toString():this.downTrail}`),this._overCount++,this._overCount===1&&this.setButtonState(t,this.isDown?"down":"over")}exit(t){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`ButtonListener exit for ${this.downTrail?this.downTrail.toString():this.downTrail}`),assert&&assert(this._overCount>0,"Exit events not matched by an enter"),this._overCount--,this._overCount===0&&this.setButtonState(t,this.isDown?"out":"up")}focus(t){this.enter(t)}blur(t){this.exit(t)}click(t){this.setButtonState(t,"down"),this.setButtonState(t,"up")}}scenery.register("ButtonListener",ButtonListener);ButtonListener.ButtonListenerIO=new IOType("ButtonListenerIO",{valueType:ButtonListener,documentation:"Button listener",events:["up","over","down","out","fire"]});class SimpleDragHandler extends PhetioObject{constructor(t){assert&&deprecationWarning("SimpleDragHandler is deprecated, please use DragListener instead"),t=merge({start:null,drag:null,end:null,translate:null,allowTouchSnag:!1,mouseButton:0,dragCursor:"pointer",attach:!0,tandem:Tandem.REQUIRED,phetioState:!1,phetioEventType:EventType.USER,phetioReadOnly:!0},t),super(),this.options=t,this.isDraggingProperty=new BooleanProperty(!1,{phetioReadOnly:t.phetioReadOnly,phetioState:!1,tandem:t.tandem.createTandem("isDraggingProperty"),phetioDocumentation:"Indicates whether the object is dragging"}),this.pointer=null,this.trail=null,this.transform=null,this.node=null,this.lastDragPoint=null,this.startTransformMatrix=null,this.mouseButton=void 0,this.interrupted=!1,this.lastInterruptedTouchLikePointer=null,this._attach=t.attach,this.dragStartAction=new PhetioAction$1((s,r)=>{this.dragging||(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("SimpleDragHandler startDrag"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this._attach&&(r.pointer.dragging=!0),r.pointer.cursor=this.options.dragCursor,r.pointer.addInputListener(this.dragListener,this.options.attach),r.pointer.reserveForDrag(),this.isDraggingProperty.set(!0),this.pointer=r.pointer,this.trail=r.trail.subtrailTo(r.currentTarget,!0),this.transform=this.trail.getTransform(),this.node=r.currentTarget,this.lastDragPoint=r.pointer.point,this.startTransformMatrix=r.currentTarget.getMatrix().copy(),this.mouseButton=r.pointer instanceof Mouse?r.domEvent.button:void 0,this.options.start&&this.options.start.call(null,r,this.trail),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop())},{tandem:t.tandem.createTandem("dragStartAction"),phetioReadOnly:t.phetioReadOnly,parameters:[{name:"point",phetioType:Vector2.Vector2IO,phetioDocumentation:"the position of the drag start in view coordinates"},{phetioPrivate:!0,valueType:[SceneryEvent,null]}]}),this.dragAction=new PhetioAction$1((s,r)=>{if(!this.dragging||this.isDisposed)return;const o=this.pointer.point.minus(this.lastDragPoint);if(o.magnitudeSquared===0)return;const n=this.transform.inverseDelta2(o);if(assert&&assert(r.pointer===this.pointer,"Wrong pointer in move"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`SimpleDragHandler (pointer) move for ${this.trail.toString()}`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.options.translate){const l=this.node.getMatrix().getTranslation();this.options.translate.call(null,{delta:n,oldPosition:l,position:l.plus(n)})}if(this.lastDragPoint=this.pointer.point,this.options.drag){const l=r.currentTarget;r.currentTarget=this.node,this.options.drag.call(null,r,this.trail),r.currentTarget=l}sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},{phetioHighFrequency:!0,phetioReadOnly:t.phetioReadOnly,tandem:t.tandem.createTandem("dragAction"),parameters:[{name:"point",phetioType:Vector2.Vector2IO,phetioDocumentation:"the position of the drag in view coordinates"},{phetioPrivate:!0,valueType:[SceneryEvent,null]}]}),this.dragEndAction=new PhetioAction$1((s,r)=>{this.dragging&&(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("SimpleDragHandler endDrag"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this._attach&&(this.pointer.dragging=!1),this.pointer.cursor=null,this.pointer.removeInputListener(this.dragListener),this.isDraggingProperty.set(!1),this.options.end&&this.options.end.call(null,r,this.trail),this.pointer=null,sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop())},{tandem:t.tandem.createTandem("dragEndAction"),phetioReadOnly:t.phetioReadOnly,parameters:[{name:"point",phetioType:Vector2.Vector2IO,phetioDocumentation:"the position of the drag end in view coordinates"},{phetioPrivate:!0,isValidValue:s=>s===null||s instanceof SceneryEvent||s.pointer&&s.currentTarget}]}),this.transformListener={transform:s=>{if(!this.trail.isExtensionOf(s.trail,!0))return;const r=s.trail.getMatrix(),o=this.transform.getMatrix();this.node.prependMatrix(r.inverted().timesMatrix(o)),this.transform.setMatrix(r)}},this.dragListener={up:s=>{if(!(!this.dragging||this.isDisposed)){if(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`SimpleDragHandler (pointer) up for ${this.trail.toString()}`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),assert&&assert(s.pointer===this.pointer,"Wrong pointer in up"),!(s.pointer instanceof Mouse)||s.domEvent.button===this.mouseButton){const r=s.currentTarget;s.currentTarget=this.node,this.endDrag(s),s.currentTarget=r}sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}},cancel:s=>{if(!this.dragging||this.isDisposed)return;sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`SimpleDragHandler (pointer) cancel for ${this.trail.toString()}`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),assert&&assert(s.pointer===this.pointer,"Wrong pointer in cancel");const r=s.currentTarget;s.currentTarget=this.node,this.endDrag(s),s.currentTarget=r,this.transform||this.node.setMatrix(this.startTransformMatrix),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},move:s=>{this.dragAction.execute(s.pointer.point,s)},interrupt:()=>{this.interrupt()}},this.initializePhetioObject({},t)}get dragging(){return this.isDraggingProperty.get()}set dragging(t){assert&&assert(!1,"illegal call to set dragging on SimpleDragHandler")}startDrag(t){this.dragStartAction.execute(t.pointer.point,t)}endDrag(t){this.dragEndAction.execute(t?t.pointer.point:Vector2.ZERO,t)}interrupt(){this.dragging&&(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("SimpleDragHandler interrupt"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.interrupted=!0,this.pointer&&this.pointer.isTouchLike()&&(this.lastInterruptedTouchLikePointer=this.pointer),this.endDrag({pointer:this.pointer,currentTarget:this.node}),this.interrupted=!1,sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop())}tryToSnag(t){t.pointer instanceof Mouse&&t.domEvent&&this.options.mouseButton!==t.domEvent.button&&this.options.mouseButton!==-1||this.isDisposed||!this.dragging&&(!t.pointer.dragging||!this._attach)&&t.pointer!==this.lastInterruptedTouchLikePointer&&t.canStartPress()&&this.startDrag(t)}tryTouchToSnag(t){this.options.allowTouchSnag&&(this.options.allowTouchSnag===!0||this.options.allowTouchSnag(t))&&this.tryToSnag(t)}down(t){this.tryToSnag(t)}touchenter(t){this.tryTouchToSnag(t)}touchmove(t){this.tryTouchToSnag(t)}dispose(){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("SimpleDragHandler dispose"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.dragging&&(this._attach&&(this.pointer.dragging=!1),this.pointer.cursor=null,this.pointer.removeInputListener(this.dragListener)),this.isDraggingProperty.dispose(),this.dragEndAction.dispose(),this.dragAction.dispose(),this.dragStartAction.dispose(),super.dispose(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}static createForwardingListener(t,s){return s=merge({allowTouchSnag:!1},s),{down:r=>{!r.pointer.dragging&&r.canStartPress()&&t(r)},touchenter:function(r){s.allowTouchSnag&&this.down(r)},touchmove:function(r){s.allowTouchSnag&&this.down(r)}}}}scenery.register("SimpleDragHandler",SimpleDragHandler);let globalID=0;const truePredicate=_.constant(!0),isPressedListener$1=a=>a.isPressed,$u=class $u extends EnabledComponent{constructor(t){const s=optionize()({press:_.noop,release:_.noop,targetNode:null,drag:_.noop,attach:!0,mouseButton:0,pressCursor:"pointer",useInputListenerCursor:!1,canStartPress:truePredicate,a11yLooksPressedInterval:100,collapseDragEvents:!1,phetioEnabledPropertyInstrumented:!1,tandem:Tandem.REQUIRED,phetioReadOnly:!0,phetioFeatured:PhetioObject.DEFAULT_OPTIONS.phetioFeatured},t);assert&&assert(typeof s.mouseButton=="number"&&s.mouseButton>=0&&s.mouseButton%1===0,"mouseButton should be a non-negative integer"),assert&&assert(s.pressCursor===null||typeof s.pressCursor=="string","pressCursor should either be a string or null"),assert&&assert(typeof s.press=="function","The press callback should be a function"),assert&&assert(typeof s.release=="function","The release callback should be a function"),assert&&assert(typeof s.drag=="function","The drag callback should be a function"),assert&&assert(s.targetNode===null||s.targetNode instanceof Node$2,"If provided, targetNode should be a Node"),assert&&assert(typeof s.attach=="boolean","attach should be a boolean"),assert&&assert(typeof s.a11yLooksPressedInterval=="number","a11yLooksPressedInterval should be a number"),super(s),this._id=globalID++,sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} construction`),this._mouseButton=s.mouseButton,this._a11yLooksPressedInterval=s.a11yLooksPressedInterval,this._pressCursor=s.pressCursor,this._pressListener=s.press,this._releaseListener=s.release,this._dragListener=s.drag,this._canStartPress=s.canStartPress,this._targetNode=s.targetNode,this._attach=s.attach,this._collapseDragEvents=s.collapseDragEvents,this.overPointers=createObservableArray(),this.isPressedProperty=new BooleanProperty(!1,{reentrant:!0}),this.isOverProperty=new BooleanProperty(!1),this.looksOverProperty=new BooleanProperty(!1),this.isHoveringProperty=new BooleanProperty(!1),this.isHighlightedProperty=new BooleanProperty(!1),this.isFocusedProperty=new BooleanProperty(!1),this.cursorProperty=new DerivedProperty([this.enabledProperty],r=>s.useInputListenerCursor&&r&&this._attach?this._pressCursor:null),this.pointer=null,this.pressedTrail=null,this.interrupted=!1,this._pendingCollapsedDragEvent=null,this._listeningToPointer=!1,this._isHoveringListener=this.invalidateHovering.bind(this),this._isHighlightedListener=this.invalidateHighlighted.bind(this),this.pdomClickingProperty=new BooleanProperty(!1),this.looksPressedProperty=DerivedProperty.or([this.pdomClickingProperty,this.isPressedProperty]),this._pdomClickingTimeoutListener=null,this._pointerListener={up:this.pointerUp.bind(this),cancel:this.pointerCancel.bind(this),move:this.pointerMove.bind(this),interrupt:this.pointerInterrupt.bind(this),listener:this},this._pressAction=new PhetioAction$1(this.onPress.bind(this),{tandem:s.tandem.createTandem("pressAction"),phetioDocumentation:"Executes whenever a press occurs. The first argument when executing can be used to convey info about the SceneryEvent.",phetioReadOnly:!0,phetioFeatured:s.phetioFeatured,phetioEventType:EventType.USER,parameters:[{name:"event",phetioType:SceneryEvent.SceneryEventIO},{phetioPrivate:!0,valueType:[Node$2,null]},{phetioPrivate:!0,valueType:["function",null]}]}),this._releaseAction=new PhetioAction$1(this.onRelease.bind(this),{parameters:[{name:"event",phetioType:NullableIO(SceneryEvent.SceneryEventIO)},{phetioPrivate:!0,valueType:["function",null]}],tandem:s.tandem.createTandem("releaseAction"),phetioDocumentation:"Executes whenever a release occurs.",phetioReadOnly:!0,phetioFeatured:s.phetioFeatured,phetioEventType:EventType.USER}),this.display=null,this.boundInvalidateOverListener=this.invalidateOver.bind(this),this.overPointers.lengthProperty.link(this.invalidateOver.bind(this)),this.isFocusedProperty.link(this.invalidateOver.bind(this)),this.overPointers.lengthProperty.link(this._isHoveringListener),this.isPressedProperty.link(this._isHoveringListener),this.overPointers.addItemAddedListener(r=>r.isDownProperty.link(this._isHoveringListener)),this.overPointers.addItemRemovedListener(r=>r.isDownProperty.unlink(this._isHoveringListener)),this.isHoveringProperty.link(this._isHighlightedListener),this.isPressedProperty.link(this._isHighlightedListener),this.enabledProperty.lazyLink(this.onEnabledPropertyChange.bind(this))}get isPressed(){return this.isPressedProperty.value}get cursor(){return this.cursorProperty.value}get attach(){return this._attach}get targetNode(){return this._targetNode}getCurrentTarget(){return assert&&assert(this.isPressed,"We have no currentTarget if we are not pressed"),this.pressedTrail.lastNode()}get currentTarget(){return this.getCurrentTarget()}canPress(t){return!!this.enabledProperty.value&&!this.isPressed&&this._canStartPress(t,this)&&(!(t.pointer instanceof Mouse)||t.domEvent.button===this._mouseButton)&&(!this._attach||!t.pointer.isAttached())}canClick(){return this.enabledProperty.value&&!this.isPressed&&this._canStartPress(null,this)}press(t,s,r){return assert&&assert(t,"An event is required"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} press`),this.canPress(t)?(this.flushCollapsedDrag(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} successful press`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this._pressAction.execute(t,s||null,r||null),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop(),!0):(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} could not press`),!1)}release(t,s){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} release`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.flushCollapsedDrag(),this._releaseAction.execute(t||null,s||null),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}drag(t){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} drag`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),assert&&assert(this.isPressed,"Can only drag while pressed"),this._dragListener(t,this),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}interrupt(){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} interrupt`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.pdomClickingProperty.value?(this.interrupted=!0,this._listeningToPointer?this.release():(this.isPressedProperty.value=!1,this._releaseListener(null,this)),stepTimer.hasListener(this._pdomClickingTimeoutListener)&&(stepTimer.clearTimeout(this._pdomClickingTimeoutListener),this.pdomClickingProperty.isDisposed||(this.pdomClickingProperty.value=!1))):this.isPressed&&(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} interrupting`),this.interrupted=!0,this.release()),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}clearOverPointers(){this.overPointers.clear()}step(){this.flushCollapsedDrag()}setCreatePanTargetBounds(t){this._pointerListener.createPanTargetBounds=t}set createPanTargetBounds(t){this.setCreatePanTargetBounds(t)}setCreatePanTargetBoundsFromTrail(t){assert&&assert(t.length>0,"trail has no Nodes to provide localBounds"),this.setCreatePanTargetBounds(()=>t.localToGlobalBounds(t.lastNode().localBounds))}set createPanTargetBoundsFromTrail(t){this.setCreatePanTargetBoundsFromTrail(t)}flushCollapsedDrag(){this._pendingCollapsedDragEvent&&this.drag(this._pendingCollapsedDragEvent),this._pendingCollapsedDragEvent=null}invalidateOver(){let t=!1;if(this._listeningToPointer)t=!1;else for(let s=0;s<this.overPointers.length;s++)if(this.overPointers.get(s).isAttached()){t=!0;break}this.isOverProperty.value=this.overPointers.length>0&&!t,this.looksOverProperty.value=this.isOverProperty.value||this.isFocusedProperty.value&&!!this.display&&this.display.focusManager.pdomFocusHighlightsVisibleProperty.value}invalidateHovering(){for(let t=0;t<this.overPointers.length;t++){const s=this.overPointers[t];if(!s.isDown||s===this.pointer){this.isHoveringProperty.value=!0;return}}this.isHoveringProperty.value=!1}invalidateHighlighted(){this.isHighlightedProperty.value=this.isHoveringProperty.value||this.isPressedProperty.value}onEnabledPropertyChange(t){!t&&this.interrupt()}onPress(t,s,r){assert&&assert(!this.isDisposed,"Should not press on a disposed listener");const o=s||this._targetNode;this.pointer=t.pointer,this.pressedTrail=o?o.getUniqueTrail():t.trail.subtrailTo(t.currentTarget,!1),this.interrupted=!1,this.pointer.addInputListener(this._pointerListener,this._attach),this._listeningToPointer=!0,this.pointer.cursor=this.pressedTrail.lastNode().getEffectiveCursor()||this._pressCursor,this.isPressedProperty.value=!0,this._pressListener(t,this),r&&r()}onRelease(t,s){assert&&assert(this.isPressed,"This listener is not pressed");const r=this;r.pointer.removeInputListener(this._pointerListener),this._listeningToPointer=!1,this.isPressedProperty.value=!1,this._releaseListener(t,this),s&&s(),r.pointer.cursor=null,this.pointer=null,this.pressedTrail=null}down(t){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} down`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.press(t),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}up(t){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} up`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.invalidateOver(),this.invalidateHovering(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}enter(t){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} enter`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.overPointers.push(t.pointer),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}move(t){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} move`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.invalidateOver(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}exit(t){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} exit`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.overPointers.includes(t.pointer)&&this.overPointers.remove(t.pointer),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}pointerUp(t){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} pointer up`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.isPressed&&(assert&&assert(t.pointer===this.pointer),this.release(t)),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}pointerCancel(t){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} pointer cancel`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.isPressed&&(assert&&assert(t.pointer===this.pointer),this.interrupt()),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}pointerMove(t){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} pointer move`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.isPressed&&(assert&&assert(t.pointer===this.pointer),this._collapseDragEvents?this._pendingCollapsedDragEvent=t:this.drag(t)),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}pointerInterrupt(){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} pointer interrupt`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.interrupt(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}click(t,s){return this.canClick()&&(this.interrupted=!1,this.pdomClickingProperty.value=!0,this.isFocusedProperty.value=!0,this.isPressedProperty.value=!0,this._pressListener(t,this),s&&s(),this.isPressedProperty.value=!1,this._releaseListener(t,this),stepTimer.clearTimeout(this._pdomClickingTimeoutListener),this._pdomClickingTimeoutListener=stepTimer.setTimeout(()=>{this.pdomClickingProperty.isDisposed||(this.pdomClickingProperty.value=!1)},this._a11yLooksPressedInterval)),!0}focus(t){const s=t.trail.rootNode().getRootedDisplays().filter(r=>r.isAccessible());assert&&assert(s.length===1,"cannot focus node with zero or multiple accessible displays attached"),this.display=s[0],this.display.focusManager.pdomFocusHighlightsVisibleProperty.hasListener(this.boundInvalidateOverListener)||this.display.focusManager.pdomFocusHighlightsVisibleProperty.link(this.boundInvalidateOverListener),this.isFocusedProperty.value=!0}blur(){this.display&&(this.display.focusManager.pdomFocusHighlightsVisibleProperty.hasListener(this.boundInvalidateOverListener)&&this.display.focusManager.pdomFocusHighlightsVisibleProperty.unlink(this.boundInvalidateOverListener),this.display=null),this.isFocusedProperty.value=!1}dispose(){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} dispose`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.overPointers.clear(),this._listeningToPointer&&isPressedListener$1(this)&&this.pointer.removeInputListener(this._pointerListener),this.isPressedProperty.isDisposed||(this.isPressedProperty.unlink(this._isHighlightedListener),this.isPressedProperty.unlink(this._isHoveringListener)),!this.isHoveringProperty.isDisposed&&this.isHoveringProperty.unlink(this._isHighlightedListener),this._pressAction.dispose(),this._releaseAction.dispose(),this.looksPressedProperty.dispose(),this.pdomClickingProperty.dispose(),this.cursorProperty.dispose(),this.isFocusedProperty.dispose(),this.isHighlightedProperty.dispose(),this.isHoveringProperty.dispose(),this.looksOverProperty.dispose(),this.isOverProperty.dispose(),this.isPressedProperty.dispose(),this.overPointers.dispose(),this.display&&(this.display.focusManager.pdomFocusHighlightsVisibleProperty.unlink(this.boundInvalidateOverListener),this.display=null),super.dispose(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}};$u.phetioAPI={pressAction:{phetioType:PhetioAction$1.PhetioActionIO([SceneryEvent.SceneryEventIO])},releaseAction:{phetioType:PhetioAction$1.PhetioActionIO([NullableIO(SceneryEvent.SceneryEventIO)])}};let PressListener=$u;scenery.register("PressListener",PressListener);class FireListener extends PressListener{constructor(t){const s=optionize()({fire:_.noop,fireOnDown:!1,fireOnHold:!1,fireOnHoldDelay:400,fireOnHoldInterval:100,tandem:Tandem.REQUIRED,phetioReadOnly:PhetioObject.DEFAULT_OPTIONS.phetioReadOnly},t);assert&&assert(typeof s.fire=="function","The fire callback should be a function"),assert&&assert(typeof s.fireOnDown=="boolean","fireOnDown should be a boolean"),super(s),this._fireOnDown=s.fireOnDown,this.firedEmitter=new Emitter({tandem:s.tandem.createTandem("firedEmitter"),phetioEventType:EventType.USER,phetioReadOnly:s.phetioReadOnly,phetioDocumentation:"Emits at the time that the listener fires",parameters:[{name:"event",phetioType:NullableIO(SceneryEvent.SceneryEventIO)}]}),this.firedEmitter.addListener(s.fire),s.fireOnHold&&(this._timer=new CallbackTimer({callback:this.fire.bind(this,null),delay:s.fireOnHoldDelay,interval:s.fireOnHoldInterval}))}fire(t){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("FireListener fire"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.firedEmitter.emit(t),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}press(t,s,r){return super.press(t,s,()=>{this._fireOnDown&&this.fire(t),this._timer&&this._timer.start(),r&&r()})}release(t,s){super.release(t,()=>{const r=!this._fireOnDown&&this.isHoveringProperty.value&&!this.interrupted;this._timer?this._timer.stop(r):r&&this.fire(t||null),s&&s()})}click(t,s){return super.click(t,()=>{this.interrupted||this.fire(t),s&&s()})}interrupt(){super.interrupt(),this._timer&&this._timer.stop(!1)}dispose(){this.firedEmitter.dispose(),this._timer&&this._timer.dispose(),super.dispose()}}scenery.register("FireListener",FireListener);const scratchVector2A=new Vector2(0,0),isPressedListener=a=>a.isPressed;class DragListener extends PressListener{constructor(t){const s=optionize()({positionProperty:null,start:null,end:null,transform:null,dragBoundsProperty:null,allowTouchSnag:!0,applyOffset:!0,useParentOffset:!1,trackAncestors:!1,translateNode:!1,mapPosition:null,offsetPosition:null,canClick:!1,tandem:Tandem.REQUIRED,phetioReadOnly:!0,phetioFeatured:PhetioObject.DEFAULT_OPTIONS.phetioFeatured},t);assert&&assert(!s.dragBounds,"options.dragBounds was removed in favor of options.dragBoundsProperty"),assert&&assert(!s.useParentOffset||s.positionProperty,"If useParentOffset is set, a positionProperty is required"),assert&&assert(!(s.mapPosition&&s.dragBoundsProperty),"Only one of mapPosition and dragBoundsProperty can be provided, as they handle mapping of the drag point"),super(s),this._allowTouchSnag=s.allowTouchSnag,this._applyOffset=s.applyOffset,this._useParentOffset=s.useParentOffset,this._trackAncestors=s.trackAncestors,this._translateNode=s.translateNode,this._transform=s.transform,this._positionProperty=s.positionProperty,this._mapPosition=s.mapPosition,this._offsetPosition=s.offsetPosition,this._dragBoundsProperty=s.dragBoundsProperty||new Property(null),this._start=s.start,this._end=s.end,this._canClick=s.canClick,this.isUserControlledProperty=this.isPressedProperty,this._globalPoint=new Vector2(0,0),this._localPoint=new Vector2(0,0),this._parentPoint=new Vector2(0,0),this._modelPoint=new Vector2(0,0),this._modelDelta=new Vector2(0,0),this._parentOffset=new Vector2(0,0),this._transformTracker=null,this._transformTrackerListener=this.ancestorTransformed.bind(this),this._lastInterruptedTouchLikePointer=null,this._dragAction=new PhetioAction$1(r=>{assert&&assert(isPressedListener(this));const n=this.pointer.point;n&&(this._globalPoint.equals(n)||this.reposition(n)),PressListener.prototype.drag.call(this,r)},{parameters:[{name:"event",phetioType:SceneryEvent.SceneryEventIO}],phetioFeatured:s.phetioFeatured,tandem:s.tandem.createTandem("dragAction"),phetioHighFrequency:!0,phetioDocumentation:"Emits whenever a drag occurs with an SceneryEventIO argument.",phetioReadOnly:s.phetioReadOnly,phetioEventType:EventType.USER})}press(t,s,r){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener press"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const o=super.press(t,s,()=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener successful press"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),assert&&assert(isPressedListener(this));const n=this;n.pointer.reserveForDrag(),this.attachTransformTracker(),assert&&assert(n.pointer.point!==null);const l=n.pointer.point,h=this.globalToParentPoint(this._localPoint.set(l));this._useParentOffset&&this.modelToParentPoint(this._parentOffset.set(this._positionProperty.value)).subtract(h),this.parentToLocalPoint(h),this.reposition(l),this._start&&this._start(t,n),r&&r(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()});return sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop(),o}release(t,s){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener release"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),super.release(t,()=>{this.detachTransformTracker(),this._end&&this._end(t||null,this),s&&s()}),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}canClick(){return super.canClick()&&this._canClick}click(t,s){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener click"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const r=super.click(t,()=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener successful press"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this._start&&this._start(t,this),s&&s(),this._end&&this._end(t,this),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()});return sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop(),r}drag(t){assert&&assert(isPressedListener(this));const r=this.pointer.point;!r||this._globalPoint.equals(r)||(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener drag"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this._dragAction.execute(t),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop())}tryTouchSnag(t){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener tryTouchSnag"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this._allowTouchSnag&&(!this.attach||!t.pointer.isAttached())&&this.press(t),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}getGlobalPoint(){return this._globalPoint.copy()}get globalPoint(){return this.getGlobalPoint()}getLocalPoint(){return this._localPoint.copy()}get localPoint(){return this.getLocalPoint()}getParentPoint(){return this._parentPoint.copy()}get parentPoint(){return this.getParentPoint()}getModelPoint(){return this._modelPoint.copy()}get modelPoint(){return this.getModelPoint()}getModelDelta(){return this._modelDelta.copy()}get modelDelta(){return this.getModelDelta()}globalToParentPoint(t){assert&&assert(isPressedListener(this));const s=this;let r;return assert&&(r=s.pressedTrail.globalToParentPoint(t)),s.pressedTrail.getParentTransform().getInverse().multiplyVector2(t),assert&&assert(t.equals(r)),t}parentToLocalPoint(t){assert&&assert(isPressedListener(this));const s=this;let r;return assert&&(r=s.pressedTrail.lastNode().parentToLocalPoint(t)),s.pressedTrail.lastNode().getTransform().getInverse().multiplyVector2(t),assert&&assert(t.equals(r)),t}localToParentPoint(t){assert&&assert(isPressedListener(this));const s=this;let r;return assert&&(r=s.pressedTrail.lastNode().localToParentPoint(t)),s.pressedTrail.lastNode().getMatrix().multiplyVector2(t),assert&&assert(t.equals(r)),t}parentToModelPoint(t){return this._transform&&(this._transform instanceof Transform3?this._transform:this._transform.value).getInverse().multiplyVector2(t),t}modelToParentPoint(t){return this._transform&&(this._transform instanceof Transform3?this._transform:this._transform.value).getMatrix().multiplyVector2(t),t}mapModelPoint(t){return this._mapPosition?this._mapPosition(t):this._dragBoundsProperty.value?this._dragBoundsProperty.value.closestPointTo(t):t}applyParentOffset(t){this._offsetPosition&&t.add(this._offsetPosition(t,this)),this._applyOffset&&(this._useParentOffset?t.add(this._parentOffset):(t.subtract(this.localToParentPoint(scratchVector2A.set(this._localPoint))),t.add(this.localToParentPoint(scratchVector2A.setXY(0,0)))))}reposition(t){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener reposition"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),assert&&assert(isPressedListener(this));const s=this;this._globalPoint.set(t),this.applyParentOffset(this.globalToParentPoint(this._parentPoint.set(t))),this._modelDelta.set(this._modelPoint).negate(),this._modelPoint.set(this.mapModelPoint(this.parentToModelPoint(scratchVector2A.set(this._parentPoint)))),this._modelDelta.add(this._modelPoint),this.modelToParentPoint(this._parentPoint.set(this._modelPoint)),this._translateNode&&(s.pressedTrail.lastNode().translation=this._parentPoint),this._positionProperty&&(this._positionProperty.value=this._modelPoint.copy()),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}touchenter(t){t.pointer.isDownProperty.value&&this.tryTouchSnag(t)}touchmove(t){this.tryTouchSnag(t)}ancestorTransformed(){assert&&assert(isPressedListener(this));const s=this.pointer.point;s&&this.reposition(s)}attachTransformTracker(){assert&&assert(isPressedListener(this));const t=this;this._trackAncestors&&(this._transformTracker=new TransformTracker$1(t.pressedTrail.copy().removeDescendant()),this._transformTracker.addListener(this._transformTrackerListener))}detachTransformTracker(){this._transformTracker&&(this._transformTracker.removeListener(this._transformTrackerListener),this._transformTracker.dispose(),this._transformTracker=null)}getDragBounds(){return this._dragBoundsProperty.value}get dragBounds(){return this.getDragBounds()}setTransform(t){this._transform=t}set transform(t){this.setTransform(t)}get transform(){return this.getTransform()}getTransform(){return this._transform}interrupt(){this.pointer&&this.pointer.isTouchLike()&&(this._lastInterruptedTouchLikePointer=this.pointer),super.interrupt()}canPress(t){return t.pointer===this._lastInterruptedTouchLikePointer?!1:super.canPress(t)}dispose(){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener dispose"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this._dragAction.dispose(),this.detachTransformTracker(),super.dispose(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}static createForwardingListener(t,s){const r=optionize()({allowTouchSnag:!0},s);return{down(o){o.canStartPress()&&t(o)},touchenter(o){r.allowTouchSnag&&this.down(o)},touchmove(o){r.allowTouchSnag&&this.down(o)}}}}scenery.register("DragListener",DragListener);class MultiListenerPress{constructor(t,s){this.pointer=t,this.trail=s,this.interrupted=!1,this.initialPoint=t.point,this.localPoint=null,this.recomputeLocalPoint()}recomputeLocalPoint(){this.localPoint=this.trail.globalToLocalPoint(this.pointer.point)}get targetPoint(){return this.trail.globalToParentPoint(this.pointer.point)}}scenery.register("MultiListenerPress",MultiListenerPress);const MOVE_INTERRUPT_MAGNITUDE=25;class MultiListener{constructor(t,s){const r=optionize()({mouseButton:0,pressCursor:"pointer",allowScale:!0,allowRotation:!0,allowMultitouchInterruption:!1,allowMoveInterruption:!0,minScale:1,maxScale:4,tandem:Tandem.REQUIRED},s);this._targetNode=t,this._minScale=r.minScale,this._maxScale=r.maxScale,this._mouseButton=r.mouseButton,this._pressCursor=r.pressCursor,this._allowScale=r.allowScale,this._allowRotation=r.allowRotation,this._allowMultitouchInterruption=r.allowMultitouchInterruption,this._allowMoveInterruption=r.allowMoveInterruption,this._presses=[],this._backgroundPresses=[],this.matrixProperty=new Property(t.matrix.copy(),{phetioValueType:Matrix3.Matrix3IO,tandem:r.tandem.createTandem("matrixProperty"),phetioReadOnly:!0}),this.matrixProperty.link(o=>{this._targetNode.matrix=o}),this._interrupted=!1,this._pressListener={move:o=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener pointer move"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const n=this.findPress(o.pointer);assert&&assert(n,"Press should be found for move event"),this.movePress(n),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},up:o=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener pointer up"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const n=this.findPress(o.pointer);assert&&assert(n,"Press should be found for up event"),this.removePress(n),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},cancel:o=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener pointer cancel"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const n=this.findPress(o.pointer);assert&&assert(n,"Press should be found for cancel event"),n.interrupted=!0,this.removePress(n),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},interrupt:()=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener pointer interrupt"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.interrupt(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}},this._backgroundListener={up:o=>{if(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener background up"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),!this._interrupted){const n=this.findBackgroundPress(o.pointer);assert&&assert(n,"Background press should be found for up event"),this.removeBackgroundPress(n)}sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},move:o=>{const n=this._backgroundPresses.filter(l=>!l.pointer.hasIntent(Intent.DRAG)&&l.initialPoint.distance(l.pointer.point)>MOVE_INTERRUPT_MAGNITUDE);(this.getCurrentScale()!==1||n.length>=2)&&(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener attached, interrupting for press"),n.forEach(l=>{this.removeBackgroundPress(l),this.interruptOtherListeners(l.pointer),this.addPress(l)}))},cancel:o=>{if(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener background cancel"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),!this._interrupted){const n=this.findBackgroundPress(o.pointer);assert&&assert(n,"Background press should be found for cancel event"),this.removeBackgroundPress(n)}sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},interrupt:()=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener background interrupt"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.interrupt(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}}}findPress(t){for(let s=0;s<this._presses.length;s++)if(this._presses[s].pointer===t)return this._presses[s];return null}findBackgroundPress(t){for(let s=0;s<this._backgroundPresses.length;s++)if(this._backgroundPresses[s].pointer===t)return this._backgroundPresses[s];return null}hasPress(t){return _.some(this._presses.concat(this._backgroundPresses),s=>s.pointer===t.pointer)}interruptOtherListeners(t){const s=t.getListeners();for(let r=0;r<s.length;r++){const o=s[r];o!==this._backgroundListener&&o.interrupt&&o.interrupt()}}down(t){if(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener down"),t.pointer instanceof Mouse&&t.domEvent instanceof MouseEvent&&t.domEvent.button!==this._mouseButton){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener abort: wrong mouse button");return}this._interrupted=!1;let s;_.includes(t.trail.nodes,this._targetNode)?s=t.trail.subtrailTo(this._targetNode,!1):s=this._targetNode.getUniqueTrailTo(t.target),assert&&assert(_.includes(s.nodes,this._targetNode),"targetNode must be in the Trail for Press"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const r=new MultiListenerPress(t.pointer,s);!this._allowMoveInterruption&&!this._allowMultitouchInterruption?t.pointer.isAttached()||(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener unattached, using press"),this.addPress(r)):(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener attached, adding background press"),this.addBackgroundPress(r)),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}addPress(t){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener addPress"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.hasPress(t)||(this._presses.push(t),t.pointer.cursor=this._pressCursor,t.pointer.addInputListener(this._pressListener,!0),this.recomputeLocals(),this.reposition()),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}movePress(t){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener movePress"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.reposition(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}removePress(t){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener removePress"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),t.pointer.removeInputListener(this._pressListener),t.pointer.cursor=null,arrayRemove(this._presses,t),this.recomputeLocals(),this.reposition(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}addBackgroundPress(t){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener addBackgroundPress"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.hasPress(t)||(this._backgroundPresses.push(t),t.pointer.addInputListener(this._backgroundListener,!1)),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}removeBackgroundPress(t){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener removeBackgroundPress"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),t.pointer.removeInputListener(this._backgroundListener),arrayRemove(this._backgroundPresses,t),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}reposition(){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener reposition"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.matrixProperty.set(this.computeMatrix()),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}recomputeLocals(){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener recomputeLocals"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();for(let t=0;t<this._presses.length;t++)this._presses[t].recomputeLocalPoint();sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}interrupt(){for(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener interrupt"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();this._presses.length;)this.removePress(this._presses[this._presses.length-1]);for(;this._backgroundPresses.length;)this.removeBackgroundPress(this._backgroundPresses[this._backgroundPresses.length-1]);this._interrupted=!0,sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}computeMatrix(){return this._presses.length===0?this._targetNode.getMatrix():this._presses.length===1?this.computeSinglePressMatrix():this._allowScale&&this._allowRotation?this.computeTranslationRotationScaleMatrix():this._allowScale?this.computeTranslationScaleMatrix():this._allowRotation?this.computeTranslationRotationMatrix():this.computeTranslationMatrix()}computeSinglePressMatrix(){const t=this._presses[0].targetPoint,s=this._presses[0].localPoint;assert&&assert(s,"localPoint is not defined on the Press?");const r=this._targetNode.localToParentPoint(s),o=t.minus(r);return Matrix3.translationFromVector(o).timesMatrix(this._targetNode.getMatrix())}computeTranslationMatrix(){const t=new Vector2(0,0);for(let s=0;s<this._presses.length;s++){t.add(this._presses[s].targetPoint);const r=this._presses[s].localPoint;assert&&assert(r,"localPoint is not defined on the Press?"),t.subtract(r)}return Matrix3.translationFromVector(t.dividedScalar(this._presses.length))}computeTranslationScaleMatrix(){const t=this._presses.map(A=>(assert&&assert(A.localPoint,"localPoint is not defined on the Press?"),A.localPoint)),s=this._presses.map(A=>A.targetPoint),r=new Vector2(0,0),o=new Vector2(0,0);t.forEach(A=>{r.add(A)}),s.forEach(A=>{o.add(A)}),r.divideScalar(this._presses.length),o.divideScalar(this._presses.length);let n=0,l=0;t.forEach(A=>{n+=A.distanceSquared(r)}),s.forEach(A=>{l+=A.distanceSquared(o)});let h=this.getCurrentScale();l!==0&&(h=this.limitScale(Math.sqrt(l/n)));const g=Matrix3.translation(o.x,o.y),d=Matrix3.translation(-r.x,-r.y);return g.timesMatrix(Matrix3.scaling(h)).timesMatrix(d)}limitScale(t){let s=Math.max(t,this._minScale);return s=Math.min(s,this._maxScale),s}computeTranslationRotationMatrix(){let t;const s=new Matrix$1(2,this._presses.length),r=new Matrix$1(2,this._presses.length),o=new Vector2(0,0),n=new Vector2(0,0);for(t=0;t<this._presses.length;t++){const S=this._presses[t].localPoint,O=this._presses[t].targetPoint;o.add(S),n.add(O),s.set(0,t,S.x),s.set(1,t,S.y),r.set(0,t,O.x),r.set(1,t,O.y)}for(o.divideScalar(this._presses.length),n.divideScalar(this._presses.length),t=0;t<this._presses.length;t++)s.set(0,t,s.get(0,t)-o.x),s.set(1,t,s.get(1,t)-o.y),r.set(0,t,r.get(0,t)-n.x),r.set(1,t,r.get(1,t)-n.y);const l=s.times(r.transpose()),h=new SingularValueDecomposition(l);let g=h.getV().times(h.getU().transpose());g.det()<0&&(g=h.getV().times(Matrix$1.diagonalMatrix([1,-1])).times(h.getU().transpose()));const d=new Matrix3().rowMajor(g.get(0,0),g.get(0,1),0,g.get(1,0),g.get(1,1),0,0,0,1),A=n.minus(d.timesVector2(o));return d.set02(A.x),d.set12(A.y),d}computeTranslationRotationScaleMatrix(){let t;const s=new Matrix$1(this._presses.length*2,4);for(t=0;t<this._presses.length;t++){const d=this._presses[t].localPoint;s.set(2*t+0,0,d.x),s.set(2*t+0,1,d.y),s.set(2*t+0,2,1),s.set(2*t+1,0,d.y),s.set(2*t+1,1,-d.x),s.set(2*t+1,3,1)}const r=new Matrix$1(this._presses.length*2,1);for(t=0;t<this._presses.length;t++){const d=this._presses[t].targetPoint;r.set(2*t+0,0,d.x),r.set(2*t+1,0,d.y)}const o=SingularValueDecomposition.pseudoinverse(s).times(r),n=o.get(0,0),l=o.get(1,0),h=o.get(2,0),g=o.get(3,0);return new Matrix3().rowMajor(n,l,h,-l,n,g,0,0,1)}getCurrentScale(){return this._targetNode.getScaleVector().x}resetTransform(){this._targetNode.resetTransform(),this.matrixProperty.set(this._targetNode.matrix.copy())}}scenery.register("MultiListener",MultiListener);class ModelViewTransform2 extends Transform3{modelToViewPosition(t){return this.transformPosition2(t)}modelToViewXY(t,s){return new Vector2(this.modelToViewX(t),this.modelToViewY(s))}modelToViewX(t){return this.matrix.m00()*t+this.matrix.m02()}modelToViewY(t){return this.matrix.m11()*t+this.matrix.m12()}modelToViewDelta(t){return this.transformDelta2(t)}modelToViewNormal(t){return this.transformNormal2(t)}modelToViewDeltaX(t){return this.transformDeltaX(t)}modelToViewDeltaY(t){return this.transformDeltaY(t)}modelToViewBounds(t){return this.transformBounds2(t)}modelToViewShape(t){return this.transformShape(t)}modelToViewRay(t){return this.transformRay2(t)}viewToModelPosition(t){return this.inversePosition2(t)}viewToModelXY(t,s){return new Vector2(this.viewToModelX(t),this.viewToModelY(s))}viewToModelX(t){const s=this.getInverse();return s.m00()*t+s.m02()}viewToModelY(t){const s=this.getInverse();return s.m11()*t+s.m12()}viewToModelDelta(t){return this.inverseDelta2(t)}viewToModelDeltaXY(t,s){return new Vector2(this.viewToModelDeltaX(t),this.viewToModelDeltaY(s))}viewToModelNormal(t){return this.inverseNormal2(t)}viewToModelDeltaX(t){return this.inverseDeltaX(t)}viewToModelDeltaY(t){return this.inverseDeltaY(t)}viewToModelBounds(t){return this.inverseBounds2(t)}viewToModelShape(t){return this.inverseShape(t)}viewToModelRay(t){return this.inverseRay2(t)}validateMatrix(t){super.validateMatrix(t),assert&&assert(t.isAligned(),"matrix must be aligned, ModelViewTransform2 does not support arbitrary rotations")}setToRectangleMapping(t,s){const r=s.width/t.width,o=s.x-r*t.x,n=s.height/t.height,l=s.y-n*t.y;return this.setMatrix(Matrix3.affine(r,0,o,0,n,l)),this}setToRectangleInvertedYMapping(t,s){const r=s.width/t.width,o=s.x-r*t.x,n=-s.height/t.height,l=s.y-n*t.getMaxY();return this.setMatrix(Matrix3.affine(r,0,o,0,n,l)),this}static createIdentity(){return new ModelViewTransform2(Matrix3.IDENTITY)}static createOffsetScaleMapping(t,s){return new ModelViewTransform2(Matrix3.affine(s,0,t.x,0,s,t.y))}static createOffsetXYScaleMapping(t,s,r){return new ModelViewTransform2(Matrix3.affine(s,0,t.x,0,r,t.y))}static createSinglePointXYScaleMapping(t,s,r,o){const n=s.x-t.x*r,l=s.y-t.y*o;return ModelViewTransform2.createOffsetXYScaleMapping(new Vector2(n,l),r,o)}static createSinglePointScaleMapping(t,s,r){return ModelViewTransform2.createSinglePointXYScaleMapping(t,s,r,r)}static createSinglePointScaleInvertedYMapping(t,s,r){return ModelViewTransform2.createSinglePointXYScaleMapping(t,s,r,-r)}static createRectangleMapping(t,s){return new ModelViewTransform2().setToRectangleMapping(t,s)}static createRectangleInvertedYMapping(t,s){return new ModelViewTransform2().setToRectangleInvertedYMapping(t,s)}}phetcommon.register("ModelViewTransform2",ModelViewTransform2);const SCRATCH_MATRIX=new Matrix3;class PanZoomListener extends MultiListener{constructor(t,s){var o;const r=optionize()({panBounds:Bounds2.NOTHING,targetBounds:null,targetScale:1,allowRotation:!1},s);super(t,r),this._panBounds=r.panBounds,this._targetBounds=r.targetBounds||t.globalBounds.copy(),this._targetScale=r.targetScale,this.sourceFramePanBoundsProperty=new Property(Tandem.API_GENERATION?new Bounds2(0,0,0,0):this._panBounds,{tandem:(o=r.tandem)==null?void 0:o.createTandem("sourceFramePanBoundsProperty"),phetioReadOnly:!0,phetioValueType:Bounds2.Bounds2IO}),this.sourceFramePanBoundsProperty.lazyLink(()=>{if(isSettingPhetioStateProperty.value){const n=ModelViewTransform2.createRectangleMapping(this.sourceFramePanBoundsProperty.get(),this._panBounds),l=this._targetNode.matrix.translation.componentMultiply(n.matrix.getScaleVector()),h=this.matrixProperty.get().getScaleVector();this.matrixProperty.set(Matrix3.translationFromVector(l).timesMatrix(Matrix3.scaling(h.x,h.y)))}},{phetioDependencies:[this.matrixProperty]})}correctReposition(){SCRATCH_MATRIX.set(this._targetNode.matrix);const t=this._targetBounds.transformed(this._targetNode.getMatrix());t.left>this._panBounds.left&&(this._targetNode.left=this._panBounds.left-(t.left-this._targetNode.left)),t.top>this._panBounds.top&&(this._targetNode.top=this._panBounds.top-(t.top-this._targetNode.top)),t.right<this._panBounds.right&&(this._targetNode.right=this._panBounds.right+(this._targetNode.right-t.right)),t.bottom<this._panBounds.bottom&&(this._targetNode.bottom=this._panBounds.bottom+(this._targetNode.bottom-t.bottom)),SCRATCH_MATRIX.equals(this._targetNode.matrix)||this.matrixProperty.set(this._targetNode.matrix.copy())}addPress(t){super.addPress(t);const r=this._targetBounds.transformed(this._targetNode.getMatrix()).equalsEpsilon(this._panBounds,1e-8);t.pointer.cursor=r?null:this._pressCursor}reposition(){super.reposition(),this.correctReposition()}resetTransform(){super.resetTransform(),this.correctReposition()}setPanBounds(t){this._panBounds=t,Tandem.API_GENERATION||this.sourceFramePanBoundsProperty.set(this._panBounds),this.correctReposition()}setTargetBounds(t){this._targetBounds=t,this.correctReposition()}setTargetScale(t){this._targetScale=t}getTargetBounds(){return this._targetBounds}}scenery.register("PanZoomListener",PanZoomListener);const MOVE_CURSOR="all-scroll",MAX_SCROLL_VELOCITY=150,MAX_TRANSLATION_SPEED=1e3,scratchTranslationVector=new Vector2(0,0),scratchScaleTargetVector=new Vector2(0,0),scratchVelocityVector=new Vector2(0,0),scratchBounds=new Bounds2(0,0,0,0);class AnimatedPanZoomListener extends PanZoomListener{constructor(t,s){const r=optionize()({tandem:Tandem.REQUIRED},s);super(t,r),this.trackpadGestureStartScale=1,this.animatingProperty=new BooleanProperty(!1),this._transformTracker=null,this._focusBoundsListener=null,this.sourcePosition=null,this.destinationPosition=null,this.sourceScale=this.getCurrentScale(),this.destinationScale=this.getCurrentScale(),this.scaleGestureTargetPosition=null,this.discreteScales=calculateDiscreteScales(this._minScale,this._maxScale),this.middlePress=null,this._dragBounds=null,this._transformedPanBounds=this._panBounds.transformed(this._targetNode.matrix.inverted()),this._draggingInDragBounds=!1,this._attachedPointers=[],this.boundsFinite=!1;let o=null,n=null;this.gestureStartAction=new PhetioAction$1(h=>{assert&&assert(h.pageX,"pageX required on DOMEvent"),assert&&assert(h.pageY,"pageY required on DOMEvent"),assert&&assert(h.scale,"scale required on DOMEvent"),h.preventDefault(),this.trackpadGestureStartScale=h.scale,this.scaleGestureTargetPosition=new Vector2(h.pageX,h.pageY)},{phetioPlayback:!0,tandem:r.tandem.createTandem("gestureStartAction"),parameters:[{name:"event",phetioType:EventIO}],phetioEventType:EventType.USER,phetioDocumentation:"Action that executes whenever a gesture starts on a trackpad in macOS Safari."}),this.gestureChangeAction=new PhetioAction$1(h=>{assert&&assert(h.scale,"scale required on DOMEvent"),h.preventDefault();const g=this.sourceScale+h.scale-this.trackpadGestureStartScale;this.setDestinationScale(g)},{phetioPlayback:!0,tandem:r.tandem.createTandem("gestureChangeAction"),parameters:[{name:"event",phetioType:EventIO}],phetioEventType:EventType.USER,phetioDocumentation:"Action that executes whenever a gesture changes on a trackpad in macOS Safari."}),platform.safari&&!platform.mobileSafari&&(o=this.handleGestureStartEvent.bind(this),n=this.handleGestureChangeEvent.bind(this),this.trackpadGestureStartScale=this.getCurrentScale(),window.addEventListener("gesturestart",o),window.addEventListener("gesturechange",n)),globalKeyStateTracker$1.keydownEmitter.addListener(this.windowKeydown.bind(this));const l=this.handleFocusChange.bind(this);FocusManager.pdomFocusProperty.link(l),this.sourceFramePanBoundsProperty.lazyLink(()=>{isSettingPhetioStateProperty.value&&(this.initializePositions(),this.sourceScale=this.getCurrentScale(),this.setDestinationScale(this.sourceScale))},{phetioDependencies:[this.matrixProperty]}),this.disposeAnimatedPanZoomListener=()=>{o&&window.removeEventListener("gesturestart",o),n&&window.removeEventListener("gestureChange",n),this.animatingProperty.dispose(),this._transformTracker&&this._transformTracker.dispose(),FocusManager.pdomFocusProperty.unlink(l)}}step(t){this.middlePress&&this.handleMiddlePress(t),this._attachedPointers.length>0&&this.getCurrentScale()>1&&(this._attachedPointers.length>0&&(this._attachedPointers=this._attachedPointers.filter(s=>s.attachedListener),assert&&assert(this._attachedPointers.length<=10,"Not clearing attachedPointers, there is probably a memory leak")),(this._draggingInDragBounds||this._attachedPointers.some(s=>s instanceof PDOMPointer))&&this.repositionDuringDrag()),this.animateToTargets(t)}down(t){super.down(t),this._dragBounds!==null&&t.pointer.hasIntent(Intent.DRAG)&&(this._attachedPointers.length===0&&(this._draggingInDragBounds=this._dragBounds.containsPoint(t.pointer.point)),t.pointer.attachedListener&&(this._attachedPointers.includes(t.pointer)||this._attachedPointers.push(t.pointer))),t.pointer.type==="mouse"&&t.pointer instanceof Mouse&&t.pointer.middleDown&&!this.middlePress?(this.middlePress=new MiddlePress(t.pointer,t.trail),t.pointer.cursor=MOVE_CURSOR):this.cancelMiddlePress()}cancelMiddlePress(){this.middlePress&&(this.middlePress.pointer.cursor=null,this.middlePress=null,this.stopInProgressAnimation())}movePress(t){this.middlePress||super.movePress(t)}move(t){if(this._attachedPointers.length>0&&this.getCurrentScale()>1)if(this._draggingInDragBounds){if(!this._attachedPointers.includes(t.pointer)){const s=this.hasDragIntent(t.pointer);t.currentTarget!==null&&s&&t.pointer.attachedListener&&this._attachedPointers.push(t.pointer)}}else this._dragBounds&&(this._draggingInDragBounds=this._dragBounds.containsPoint(t.pointer.point))}getTargetNodeDuringDrag(){if(this._attachedPointers.length>0){const t=this._attachedPointers[0].attachedListener;if(assert&&assert(t,"The attached Pointer is expected to have an attached listener."),t.listener instanceof PressListener||t.listener instanceof KeyboardDragListener$1){const s=t.listener;if(s.isPressed)return s.getCurrentTarget()}}return null}getGlobalBoundsToViewDuringDrag(){let t=null;if(this._attachedPointers.length>0){const s=this._attachedPointers[0].attachedListener;if(assert&&assert(s,"The attached Pointer is expected to have an attached listener."),s.createPanTargetBounds)t=s.createPanTargetBounds();else if(s.listener instanceof PressListener||s.listener instanceof KeyboardDragListener$1){const r=s.listener;if(r.isPressed){const o=r.getCurrentTarget();if(o.instances.length===1){const n=o.instances[0].trail;assert&&assert(n,"The target should be in one scene graph and have an instance with a trail."),t=n.parentToGlobalBounds(o.visibleBounds)}}}}return t}repositionDuringDrag(){const t=this.getGlobalBoundsToViewDuringDrag(),s=this.getTargetNodeDuringDrag();t&&this.keepBoundsInView(t,this._attachedPointers.some(r=>r instanceof PDOMPointer),s==null?void 0:s.limitPanDirection)}cancelPanningDuringDrag(t){if(t){const s=this._attachedPointers.indexOf(t.pointer);s>-1&&this._attachedPointers.splice(s,1)}else this._attachedPointers=[];this._draggingInDragBounds=!1}up(t){this.cancelPanningDuringDrag(t)}wheel(t){if(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener wheel"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),!this.middlePress){const s=new Wheel(t,this._targetScale);this.repositionFromWheel(s,t)}sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}windowKeydown(t){this.cancelMiddlePress();const s=_.get(window,"phet.joist.sim",null);if((!s||!s.display._accessible||!s.display.pdomRootElement.contains(t.target))&&(this.handleZoomCommands(t),KeyboardUtils.isArrowKey(t))){const r=new KeyPress(globalKeyStateTracker$1,this.getCurrentScale(),this._targetScale);this.repositionFromKeys(r)}}keydown(t){const s=t.domEvent;assert&&assert(s instanceof KeyboardEvent,"keydown event must be a KeyboardEvent"),this.cancelMiddlePress(),this.handleZoomCommands(s);const r=t.pointer.hasIntent(Intent.KEYBOARD_DRAG);if(KeyboardUtils.isArrowKey(s)&&!r){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener handle arrow key down"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const o=new KeyPress(globalKeyStateTracker$1,this.getCurrentScale(),this._targetScale);this.repositionFromKeys(o),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}}handleFocusChange(t,s){if(this._transformTracker&&(this._transformTracker.dispose(),this._transformTracker=null),s&&s.trail.lastNode()&&s.trail.lastNode().focusPanTargetBoundsProperty){const r=s.trail.lastNode().focusPanTargetBoundsProperty;assert&&assert(this._focusBoundsListener&&r.hasListener(this._focusBoundsListener),"Focus bounds listener should be linked to the previous Node"),r.unlink(this._focusBoundsListener),this._focusBoundsListener=null}if(t){const r=t.trail.lastNode();let o=t.trail;if(t.trail.containsNode(this._targetNode)){const l=t.trail.nodes.indexOf(this._targetNode),h=t.trail.nodes.length;o=t.trail.slice(l,h)}this._transformTracker=new TransformTracker$1(o);const n=()=>{if(this.getCurrentScale()>1){let l;if(r.focusPanTargetBoundsProperty){const h=r.focusPanTargetBoundsProperty.value;l=t.trail.localToGlobalBounds(h)}else l=t.trail.localToGlobalBounds(t.trail.lastNode().localBounds);this.keepBoundsInView(l,!0,r.limitPanDirection)}};this._transformTracker.addListener(n),r.focusPanTargetBoundsProperty&&(this._focusBoundsListener=n,r.focusPanTargetBoundsProperty.link(this._focusBoundsListener)),this.keepTrailInView(t.trail,r.limitPanDirection)}}handleZoomCommands(t){const s=KeyboardZoomUtils.isZoomCommand(t,!0),r=KeyboardZoomUtils.isZoomCommand(t,!1);if(s||r){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiPanZoomListener keyboard zoom in"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),t.preventDefault();const o=this.getNextDiscreteScale(s),n=new KeyPress(globalKeyStateTracker$1,o,this._targetScale);this.repositionFromKeys(n)}else KeyboardZoomUtils.isZoomResetCommand(t)&&(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener keyboard reset"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),t.preventDefault(),this.resetTransform(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop())}handleGestureStartEvent(t){this.gestureStartAction.execute(t)}handleGestureChangeEvent(t){this.gestureChangeAction.execute(t)}handleMiddlePress(t){const s=this.middlePress;assert&&assert(s,"MiddlePress must be defined to handle");const r=this.sourcePosition;if(assert&&assert(r,"sourcePosition must be defined to handle middle press, be sure to call initializePositions"),t>0){const n=s.pointer.point.minus(s.initialPoint),l=n.magnitude/100;l>0&&(n.setMagnitude(Math.min(l/t,MAX_SCROLL_VELOCITY*this._targetScale)),this.setDestinationPosition(r.plus(n)))}}translateScaleToTarget(t,s){const r=this._targetNode.globalToLocalPoint(t),o=this._targetNode.globalToParentPoint(t),n=Matrix3.translation(-r.x,-r.y),l=Matrix3.translation(o.x,o.y),h=this.limitScale(this.getCurrentScale()+s),g=l.timesMatrix(Matrix3.scaling(h)).timesMatrix(n);this.matrixProperty.set(g),this.correctReposition()}setTranslationScaleToTarget(t,s){const r=this._targetNode.globalToLocalPoint(t),o=this._targetNode.globalToParentPoint(t),n=Matrix3.translation(-r.x,-r.y),l=Matrix3.translation(o.x,o.y),h=this.limitScale(s),g=l.timesMatrix(Matrix3.scaling(h)).timesMatrix(n);this.matrixProperty.set(g),this.correctReposition()}translateDelta(t){const s=this._targetNode.globalToParentPoint(this._panBounds.center),r=s.plus(t);this.translateToTarget(r,s)}translateToTarget(t,s){const r=this._targetNode.globalToParentPoint(t),n=this._targetNode.globalToParentPoint(s).minus(r);this.matrixProperty.set(Matrix3.translationFromVector(n).timesMatrix(this._targetNode.getMatrix())),this.correctReposition()}repositionFromKeys(t){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener reposition from key press"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const s=this.sourcePosition;assert&&assert(s,"sourcePosition must be defined to handle key press, be sure to call initializePositions");const r=t.scale,o=this.getCurrentScale();r!==o?(this.setDestinationScale(r),this.scaleGestureTargetPosition=t.computeScaleTargetFromKeyPress()):t.translationVector.equals(Vector2.ZERO)||this.setDestinationPosition(s.plus(t.translationVector)),this.correctReposition(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}repositionFromWheel(t,s){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener reposition from wheel"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const r=s.domEvent;assert&&assert(r instanceof WheelEvent,"wheel event must be a WheelEvent");const o=this.sourcePosition;if(assert&&assert(o,"sourcePosition must be defined to handle wheel, be sure to call initializePositions"),r.preventDefault(),t.isCtrlKeyDown){const n=this.limitScale(this.getCurrentScale()+t.scaleDelta);this.scaleGestureTargetPosition=t.targetPoint,this.setDestinationScale(n)}else this.setDestinationPosition(o.plus(t.translationVector));this.correctReposition(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}correctReposition(){super.correctReposition(),this._panBounds.isFinite()&&(this._transformedPanBounds=this._panBounds.transformed(this._targetNode.matrix.inverted()),this.sourcePosition=this._transformedPanBounds.center,this.sourceScale=this.getCurrentScale())}addPress(t){super.addPress(t),this.stopInProgressAnimation()}removePress(t){super.removePress(t),this.middlePress&&(t.pointer.cursor=MOVE_CURSOR),this._presses.length===0&&this.stopInProgressAnimation()}interrupt(){this.cancelPanningDuringDrag(),this.cancelMiddlePress(),super.interrupt()}cancel(){this.interrupt()}hasDragIntent(t){return t.hasIntent(Intent.KEYBOARD_DRAG)||t.hasIntent(Intent.DRAG)}panToNode(t,s,r){assert&&assert(this._panBounds.isFinite(),"panBounds should be defined when panning."),this.keepBoundsInView(t.globalBounds,s,r)}keepBoundsInView(t,s,r){assert&&assert(this._panBounds.isFinite(),"panBounds should be defined when panning.");const o=this.sourcePosition;assert&&assert(o,"sourcePosition must be defined to handle keepBoundsInView, be sure to call initializePositions");const n=this._targetNode.globalToLocalBounds(t),l=new Vector2(0,0);let h=0,g=0,d=0,A=0;if(s)h=this._transformedPanBounds.centerX-n.centerX,g=this._transformedPanBounds.centerX-n.centerX,d=this._transformedPanBounds.centerY-n.centerY,A=this._transformedPanBounds.centerY-n.centerY;else if((r==="vertical"||n.width<this._transformedPanBounds.width)&&(r==="horizontal"||n.height<this._transformedPanBounds.height)){const I=150/this.getCurrentScale();h=this._transformedPanBounds.left-n.left+I,g=this._transformedPanBounds.right-n.right-I,d=this._transformedPanBounds.top-n.top+I,A=this._transformedPanBounds.bottom-n.bottom-I}r!=="vertical"&&(g<0&&(l.x=-g),h>0&&(l.x=-h)),r!=="horizontal"&&(A<0&&(l.y=-A),d>0&&(l.y=-d)),this.setDestinationPosition(o.plus(l))}keepTrailInView(t,s){if(this._panBounds.isFinite()&&t.lastNode().bounds.isFinite()){const r=t.localToGlobalBounds(t.lastNode().localBounds);this._panBounds.containsBounds(r)||this.keepBoundsInView(r,!0,s)}}animateToTargets(t){assert&&assert(this.boundsFinite,"initializePositions must be called at least once before animating");const s=this.sourcePosition;assert&&assert(s,"sourcePosition must be defined to animate, be sure to all initializePositions"),assert&&assert(s.isFinite(),"How can the source position not be a finite Vector2?");const r=this.destinationPosition;assert&&assert(r,"destinationPosition must be defined to animate, be sure to all initializePositions"),assert&&assert(r.isFinite(),"How can the destination position not be a finite Vector2?");const o=!r.equalsEpsilon(s,.1),n=!DotUtils.equalsEpsilon(this.sourceScale,this.destinationScale,.001);if(this.animatingProperty.value=o||n,this._presses.length===0||this.middlePress!==null){if(o){const l=r.minus(s);let h=l;l.magnitude!==0&&(h=l.normalized());const g=this.getTranslationSpeed(l.magnitude);scratchVelocityVector.setXY(g,g);const d=scratchVelocityVector.multiplyScalar(t),A=h.componentTimes(d);A.magnitude>l.magnitude&&A.set(l),assert&&assert(A.isFinite(),"Trying to translate with a non-finite Vector2"),this.translateDelta(A)}if(n){assert&&assert(this.scaleGestureTargetPosition,"there must be a scale target point");const l=this.destinationScale-this.sourceScale;let h=l*t*6;Math.abs(h)>Math.abs(l)&&(h=l),this.translateScaleToTarget(this.scaleGestureTargetPosition,h),this.setDestinationPosition(s)}else this.destinationScale!==this.sourceScale&&(assert&&assert(this.scaleGestureTargetPosition,"there must be a scale target point"),this.setTranslationScaleToTarget(this.scaleGestureTargetPosition,this.destinationScale),this.setDestinationPosition(s))}}stopInProgressAnimation(){this.boundsFinite&&this.sourcePosition&&(this.setDestinationScale(this.sourceScale),this.setDestinationPosition(this.sourcePosition))}initializePositions(){this.boundsFinite=this._transformedPanBounds.isFinite(),this.boundsFinite?(this.sourcePosition=this._transformedPanBounds.center,this.setDestinationPosition(this.sourcePosition)):(this.sourcePosition=null,this.destinationPosition=null)}setPanBounds(t){super.setPanBounds(t),this.initializePositions(),this._dragBounds=t.erodedXY(t.width*.1,t.height*.1),assert&&assert(this._dragBounds.hasNonzeroArea(),"drag bounds must have some width and height")}setTargetBounds(t){super.setTargetBounds(t),this.initializePositions()}setDestinationPosition(t){assert&&assert(this.boundsFinite,"bounds must be finite before setting destination positions"),assert&&assert(t.isFinite(),"provided destination position is not defined");const s=this.sourcePosition;assert&&assert(s,"sourcePosition must be defined to set destination position, be sure to call initializePositions"),scratchBounds.setMinMax(s.x-this._transformedPanBounds.left-this._panBounds.left,s.y-this._transformedPanBounds.top-this._panBounds.top,s.x+this._panBounds.right-this._transformedPanBounds.right,s.y+this._panBounds.bottom-this._transformedPanBounds.bottom),this.destinationPosition=scratchBounds.closestPointTo(t)}setDestinationScale(t){this.destinationScale=this.limitScale(t)}getTranslationSpeed(t){assert&&assert(t>=0,"distance for getTranslationSpeed should be a non-negative number");const s=t*this.getCurrentScale(),r=5,o=s*(1/(Math.pow(s,2)-Math.pow(r,2))+r);return Math.min(Math.abs(o),MAX_TRANSLATION_SPEED*this.getCurrentScale())}resetTransform(){super.resetTransform(),this.stopInProgressAnimation()}getNextDiscreteScale(t){const s=this.getCurrentScale();let r=null,o=Number.POSITIVE_INFINITY;for(let l=0;l<this.discreteScales.length;l++){const h=Math.abs(this.discreteScales[l]-s);h<o&&(o=h,r=l)}r=r,assert&&assert(r!==null,"nearestIndex should have been found");let n=t?r+1:r-1;return n=DotUtils.clamp(n,0,this.discreteScales.length-1),this.discreteScales[n]}dispose(){this.disposeAnimatedPanZoomListener()}}class KeyPress{constructor(t,s,r,o){const n=optionize()({translationMagnitude:80},o);let l=0;l+=t.isKeyDown(KeyboardUtils.KEY_RIGHT_ARROW)?1:0,l-=t.isKeyDown(KeyboardUtils.KEY_LEFT_ARROW)?1:0;let h=0;if(h+=t.isKeyDown(KeyboardUtils.KEY_DOWN_ARROW)?1:0,h-=t.isKeyDown(KeyboardUtils.KEY_UP_ARROW)?1:0,scratchTranslationVector.setXY(l,h),!scratchTranslationVector.equals(Vector2.ZERO)){const g=n.translationMagnitude*r;scratchTranslationVector.setMagnitude(g)}this.translationVector=scratchTranslationVector,this.scale=s}computeScaleTargetFromKeyPress(){scratchScaleTargetVector.setXY(0,0);const t=FocusManager.pdomFocusProperty.value;if(t){const s=t.trail,r=s.lastNode();r.bounds.isFinite()&&scratchScaleTargetVector.set(s.parentToGlobalPoint(r.center))}else{const s=PDOMUtils$1.getNextFocusable();if(s!==document.body){assert&&assert(document.body.contains(s),"focusable should be attached to the body");const r=s.offsetLeft+s.offsetWidth/2,o=s.offsetTop+s.offsetHeight/2;scratchScaleTargetVector.setXY(r,o)}}return assert&&assert(scratchScaleTargetVector.isFinite(),"target position not defined"),scratchScaleTargetVector}}class Wheel{constructor(t,s){const r=t.domEvent;assert&&assert(r instanceof WheelEvent,"SceneryEvent should have a DOMEvent from the wheel input"),this.isCtrlKeyDown=r.ctrlKey,this.scaleDelta=r.deltaY>0?-.5:.5,this.targetPoint=t.pointer.point;let o=r.deltaX*.5,n=r.deltaY*.5;r.deltaMode===window.WheelEvent.DOM_DELTA_LINE&&(o=o*25,n=n*25),this.translationVector=scratchTranslationVector.setXY(o*s,n*s)}}class MiddlePress{constructor(t,s){assert&&assert(t.type==="mouse","incorrect pointer type"),this.pointer=t,this.trail=s,this.initialPoint=t.point.copy()}}const calculateDiscreteScales=(a,t)=>{assert&&assert(a>=1,"min scales less than one are currently not supported");const s=8,r=[];for(let n=0;n<s;n++)r[n]=(t-a)/s*(n*n);const o=r[s-1];for(let n=0;n<r.length;n++)r[n]=a+r[n]*(t-a)/o;return r};scenery.register("AnimatedPanZoomListener",AnimatedPanZoomListener);class AnimatedPanZoomSingleton{constructor(){this._listener=null}initialize(t,s){this._listener=new AnimatedPanZoomListener(t,s)}dispose(){assert&&assert(this._listener,"No listener, call initialize first."),this._listener.dispose(),this._listener=null}get listener(){return assert&&assert(this._listener,"No listener, call initialize first."),this._listener}get initialized(){return!!this._listener}}const animatedPanZoomSingleton=new AnimatedPanZoomSingleton;scenery.register("animatedPanZoomSingleton",animatedPanZoomSingleton);class HandleDownlistener{down(t){t.handle()}}scenery.register("HandleDownlistener",HandleDownlistener);const KEYBOARD_DRAG_DIRECTION_KEY_MAP=new Map([["both",{left:[KeyboardUtils.KEY_A,KeyboardUtils.KEY_LEFT_ARROW],right:[KeyboardUtils.KEY_RIGHT_ARROW,KeyboardUtils.KEY_D],up:[KeyboardUtils.KEY_UP_ARROW,KeyboardUtils.KEY_W],down:[KeyboardUtils.KEY_DOWN_ARROW,KeyboardUtils.KEY_S]}],["leftRight",{left:[KeyboardUtils.KEY_A,KeyboardUtils.KEY_LEFT_ARROW,KeyboardUtils.KEY_DOWN_ARROW,KeyboardUtils.KEY_S],right:[KeyboardUtils.KEY_RIGHT_ARROW,KeyboardUtils.KEY_D,KeyboardUtils.KEY_UP_ARROW,KeyboardUtils.KEY_W],up:[],down:[]}],["upDown",{left:[],right:[],up:[KeyboardUtils.KEY_RIGHT_ARROW,KeyboardUtils.KEY_D,KeyboardUtils.KEY_UP_ARROW,KeyboardUtils.KEY_W],down:[KeyboardUtils.KEY_A,KeyboardUtils.KEY_LEFT_ARROW,KeyboardUtils.KEY_DOWN_ARROW,KeyboardUtils.KEY_S]}]]);class KeyboardDragListener extends EnabledComponent{constructor(t){assert&&assertMutuallyExclusiveOptions(t,["dragSpeed","shiftDragSpeed"],["dragDelta","shiftDragDelta"]),assert&&assertMutuallyExclusiveOptions(t,["mapPosition"],["dragBoundsProperty"]);const s=optionize()({dragDelta:10,shiftDragDelta:5,dragSpeed:0,shiftDragSpeed:0,keyboardDragDirection:"both",positionProperty:null,transform:null,dragBoundsProperty:null,mapPosition:null,start:null,drag:null,end:null,moveOnHoldDelay:0,moveOnHoldInterval:1e3/60,hotkeyHoldInterval:800,phetioEnabledPropertyInstrumented:!1,tandem:Tandem.REQUIRED,phetioReadOnly:!0},t);assert&&assert(s.shiftDragSpeed<=s.dragSpeed,"shiftDragSpeed should be less than or equal to shiftDragSpeed, it is intended to provide more fine-grained control"),assert&&assert(s.shiftDragDelta<=s.dragDelta,"shiftDragDelta should be less than or equal to dragDelta, it is intended to provide more fine-grained control"),super(s),this._start=s.start,this._drag=s.drag,this._end=s.end,this._dragBoundsProperty=s.dragBoundsProperty||new Property(null),this._mapPosition=s.mapPosition,this._transform=s.transform,this._positionProperty=s.positionProperty,this._dragSpeed=s.dragSpeed,this._shiftDragSpeed=s.shiftDragSpeed,this._dragDelta=s.dragDelta,this._shiftDragDelta=s.shiftDragDelta,this._moveOnHoldDelay=s.moveOnHoldDelay,this.moveOnHoldInterval=s.moveOnHoldInterval,this._hotkeyHoldInterval=s.hotkeyHoldInterval,this._keyboardDragDirection=s.keyboardDragDirection,this.isPressedProperty=new BooleanProperty(!1,{reentrant:!0}),this.keyState=[],this._hotkeys=[],this.currentHotkey=null,this.hotkeyDisablingDragging=!1,this.hotkeyHoldIntervalCounter=this._hotkeyHoldInterval,this.useDragSpeed=s.dragSpeed>0||s.shiftDragSpeed>0,this.moveOnHoldDelayCounter=0,this.moveOnHoldIntervalCounter=0,this.delayComplete=!1,this.dragStartAction=new PhetioAction$1(o=>{const n=KeyboardUtils.getEventCode(o.domEvent);if(assert&&assert(n,"How can we have a null key for KeyboardDragListener?"),!this.movementKeysDown&&KeyboardUtils.isMovementKey(o.domEvent)&&(assert&&assert(this._pointer===null,"We should have cleared the Pointer reference by now."),this._pointer=o.pointer,o.pointer.addInputListener(this._pointerListener,!0),this.isPressedProperty.value=!0),this.keyState.push({keyDown:!0,key:n,timeDown:0}),this._start&&this.movementKeysDown&&this._start(o),!this.useDragSpeed){const l=this.shiftKeyDown()?this._shiftDragDelta:this._dragDelta;this.updatePosition(l),this.moveOnHoldIntervalCounter=0}},{parameters:[{name:"event",phetioType:SceneryEvent.SceneryEventIO}],tandem:s.tandem.createTandem("dragStartAction"),phetioDocumentation:"Emits whenever a keyboard drag starts.",phetioReadOnly:s.phetioReadOnly,phetioEventType:EventType.USER}),this.dragEmitter=new Emitter({tandem:s.tandem.createTandem("dragEmitter"),phetioHighFrequency:!0,phetioDocumentation:"Emits whenever a keyboard drag occurs.",phetioReadOnly:s.phetioReadOnly,phetioEventType:EventType.USER}),this.dragEndAction=new PhetioAction$1(o=>{this.movementKeysDown||(assert&&assert(o.pointer===this._pointer,"How could the event Pointer be anything other than this PDOMPointer?"),this._pointer.removeInputListener(this._pointerListener),this._pointer=null,this.isPressedProperty.value=!1),this._end&&this._end(o)},{parameters:[{name:"event",phetioType:SceneryEvent.SceneryEventIO}],tandem:s.tandem.createTandem("dragEndAction"),phetioDocumentation:"Emits whenever a keyboard drag ends.",phetioReadOnly:s.phetioReadOnly,phetioEventType:EventType.USER});const r=this.step.bind(this);stepTimer.addListener(r),this.enabledProperty.lazyLink(this.onEnabledPropertyChange.bind(this)),this._pointerListener={listener:this,interrupt:this.interrupt.bind(this)},this._pointer=null,this._disposeKeyboardDragListener=()=>{stepTimer.removeListener(r),this.isPressedProperty.dispose()}}getDragBounds(){return this._dragBoundsProperty.value}get dragBounds(){return this.getDragBounds()}setTransform(t){this._transform=t}set transform(t){this.setTransform(t)}get transform(){return this.getTransform()}getTransform(){return this._transform}get dragSpeed(){return this._dragSpeed}set dragSpeed(t){this._dragSpeed=t}get shiftDragSpeed(){return this._shiftDragSpeed}set shiftDragSpeed(t){this._shiftDragSpeed=t}get dragDelta(){return this._dragDelta}set dragDelta(t){this._dragDelta=t}get shiftDragDelta(){return this._shiftDragDelta}set shiftDragDelta(t){this._shiftDragDelta=t}get moveOnHoldDelay(){return this._moveOnHoldDelay}set moveOnHoldDelay(t){this._moveOnHoldDelay=t}get moveOnHoldInterval(){return this._moveOnHoldInterval}set moveOnHoldInterval(t){assert&&assert(t>0,"if the moveOnHoldInterval is 0, then the dragging will be dependent on how often the dragListener is stepped"),this._moveOnHoldInterval=t}get hotkeyHoldInterval(){return this._hotkeyHoldInterval}set hotkeyHoldInterval(t){this._hotkeyHoldInterval=t}get isPressed(){return!!this._pointer}getCurrentTarget(){return assert&&assert(this.isPressed,"We have no currentTarget if we are not pressed"),assert&&assert(this._pointer&&this._pointer.trail,"Must have a Pointer with an active trail if we are pressed"),this._pointer.trail.lastNode()}onEnabledPropertyChange(t){!t&&this.interrupt()}keydown(t){const s=t.domEvent,r=KeyboardUtils.getEventCode(s);if(assert&&assert(r,"How can we have a null key from a keydown in KeyboardDragListener?"),!s.metaKey&&(KeyboardUtils.isMovementKey(s)&&s.preventDefault(),t.pointer.reserveForKeyboardDrag(),!this.keyInListDown([r]))){if(platform.safari&&KeyboardUtils.isArrowKey(s)&&this.keyInListDown([KeyboardUtils.KEY_RIGHT_ARROW,KeyboardUtils.KEY_LEFT_ARROW,KeyboardUtils.KEY_UP_ARROW,KeyboardUtils.KEY_DOWN_ARROW])){this.interrupt();return}this.canDrag(t)&&this.dragStartAction.execute(t)}}keyup(t){const s=t.domEvent,r=KeyboardUtils.getEventCode(s),o=this.movementKeysDown;r===KeyboardUtils.KEY_TAB&&s.shiftKey&&this.keyState.push({keyDown:!0,key:KeyboardUtils.KEY_SHIFT_LEFT,timeDown:0});for(let l=0;l<this.keyState.length;l++)r===this.keyState[l].key&&this.keyState.splice(l,1);const n=this.movementKeysDown;!n&&o!==n&&this.dragEndAction.execute(t),this.currentHotkey&&!this.allKeysInListDown(this.currentHotkey.keys)&&this.resetHotkeyState(),this.resetPressAndHold()}focusout(t){this.interrupt()}step(t){const s=t*1e3;if(this.keyState.length>0){for(let o=0;o<this.keyState.length;o++)this.keyState[o].keyDown&&(this.keyState[o].timeDown+=s);this.movementKeysDown&&(this.moveOnHoldDelayCounter+=s,this.moveOnHoldIntervalCounter+=s),this.currentHotkey&&(this.hotkeyHoldIntervalCounter+=s);let r=0;if(this.useDragSpeed){const n=(this.shiftKeyDown()?this._shiftDragSpeed:this._dragSpeed)/1e3;r=s*n}else{let o=!1;if(this.moveOnHoldDelayCounter>=this._moveOnHoldDelay&&!this.delayComplete&&(o=!0,this.delayComplete=!0,this.moveOnHoldIntervalCounter=0),this.delayComplete&&this.moveOnHoldIntervalCounter>=this._moveOnHoldInterval){o=!0;const n=this.moveOnHoldIntervalCounter-this._moveOnHoldInterval;this.moveOnHoldIntervalCounter=n}r=o?this.shiftKeyDown()?this._shiftDragDelta:this._dragDelta:0}r>0&&this.updatePosition(r)}}canDrag(t){const s=t.pointer.attachedListener;return this.enabledProperty.value&&(!s||s===this._pointerListener)}updateHotkeys(){for(let t=0;t<this._hotkeys.length;t++){const s=[],r=this._hotkeys[t].keys;for(let n=0;n<r.length;n++)for(let l=0;l<this.keyState.length;l++)this.keyState[l].key===r[n]&&s.push(this.keyState[l]);let o=s.length===1&&r.length===1;for(let n=0;n<s.length-1;n++)s[n+1]&&s[n].timeDown>s[n+1].timeDown&&(o=!0);o&&(this.currentHotkey=this._hotkeys[t],this.hotkeyHoldIntervalCounter>=this._hotkeyHoldInterval&&(this.hotkeyHoldIntervalCounter=0,this._hotkeys[t].callback()))}this.currentHotkey&&(this.keyInListDown(this.currentHotkey.keys)?this.hotkeyDisablingDragging=!0:(this.hotkeyDisablingDragging=!1,this.currentHotkey=null))}updatePosition(t){if(this.updateHotkeys(),!this.hotkeyDisablingDragging){let s=0,r=0;this.leftMovementKeysDown()&&(s-=t),this.rightMovementKeysDown()&&(s+=t),this.upMovementKeysDown()&&(r-=t),this.downMovementKeysDown()&&(r+=t);let o=new Vector2(s,r);if(!o.equals(Vector2.ZERO)){if(this._transform&&(o=(this._transform instanceof Transform3?this._transform:this._transform.value).inverseDelta2(o)),this._positionProperty){let n=this._positionProperty.value.plus(o);n=this.mapModelPoint(n),n.equals(this._positionProperty.value)||(this._positionProperty.value=n)}this._drag&&this._drag(o,this),this.dragEmitter.emit()}}}mapModelPoint(t){return this._mapPosition?this._mapPosition(t):this._dragBoundsProperty.value?this._dragBoundsProperty.value.closestPointTo(t):t}keyInListDown(t){let s=!1;for(let r=0;r<this.keyState.length;r++){if(this.keyState[r].keyDown){for(let o=0;o<t.length;o++)if(t[o]===this.keyState[r].key){s=!0;break}}if(s)break}return s}allKeysInListDown(t){assert&&assert(t.length>0,"You are testing to see if an empty list of keys is down?");let s=!0;for(let r=0;r<t.length;r++){const o=_.find(this.keyState,n=>n.key===t[r]);if(!o||!o.keyDown){s=!1;break}}return s}getKeyboardDragDirectionKeys(){const t=KEYBOARD_DRAG_DIRECTION_KEY_MAP.get(this._keyboardDragDirection);return assert&&assert(t,`No direction keys found in map for KeyboardDragDirection ${this._keyboardDragDirection}`),t}leftMovementKeysDown(){return this.keyInListDown(this.getKeyboardDragDirectionKeys().left)}rightMovementKeysDown(){return this.keyInListDown(this.getKeyboardDragDirectionKeys().right)}upMovementKeysDown(){return this.keyInListDown(this.getKeyboardDragDirectionKeys().up)}downMovementKeysDown(){return this.keyInListDown(this.getKeyboardDragDirectionKeys().down)}getMovementKeysDown(){return this.rightMovementKeysDown()||this.leftMovementKeysDown()||this.upMovementKeysDown()||this.downMovementKeysDown()}get movementKeysDown(){return this.getMovementKeysDown()}enterKeyDown(){return this.keyInListDown([KeyboardUtils.KEY_ENTER])}shiftKeyDown(){return this.keyInListDown(KeyboardUtils.SHIFT_KEYS)}addHotkey(t){this._hotkeys.push(t)}removeHotkey(t){assert&&assert(this._hotkeys.includes(t),"Trying to remove a hotkey that is not in the list of hotkeys.");const s=this._hotkeys.indexOf(t);this._hotkeys.splice(s,1)}setHotkeys(t){this._hotkeys=t.slice(0)}set hotkeys(t){this.setHotkeys(t)}removeAllHotkeys(){this._hotkeys=[]}resetPressAndHold(){this.delayComplete=!1,this.moveOnHoldDelayCounter=0,this.moveOnHoldIntervalCounter=0}resetHotkeyState(){this.currentHotkey=null,this.hotkeyHoldIntervalCounter=this._hotkeyHoldInterval,this.hotkeyDisablingDragging=!1}interrupt(){this.keyState=[],this.resetHotkeyState(),this.resetPressAndHold(),this._pointer&&(assert&&assert(this._pointer.listeners.includes(this._pointerListener),"A reference to the Pointer means it should have the pointerListener"),this._pointer.removeInputListener(this._pointerListener),this._pointer=null,this.isPressedProperty.value=!1,this._end&&this._end())}dispose(){this.interrupt(),this._disposeKeyboardDragListener(),super.dispose()}static isLeftMovementKey(t){return t===KeyboardUtils.KEY_A||t===KeyboardUtils.KEY_LEFT_ARROW}static isRightMovementKey(t){return t===KeyboardUtils.KEY_D||t===KeyboardUtils.KEY_RIGHT_ARROW}static isUpMovementKey(t){return t===KeyboardUtils.KEY_W||t===KeyboardUtils.KEY_UP_ARROW}static isDownMovementKey(t){return t===KeyboardUtils.KEY_S||t===KeyboardUtils.KEY_DOWN_ARROW}}scenery.register("KeyboardDragListener",KeyboardDragListener);const KeyboardDragListener$1=KeyboardDragListener;class KeyboardListener{constructor(t){const s=optionize()({callback:_.noop,cancel:_.noop,focus:_.noop,blur:_.noop,global:!1,capture:!1,handle:!1,abort:!1,listenerFireTrigger:"down",fireOnHold:!1,fireOnHoldDelay:400,fireOnHoldInterval:100},t);this._callback=s.callback,this._cancel=s.cancel,this._focus=s.focus,this._blur=s.blur,this._listenerFireTrigger=s.listenerFireTrigger,this._fireOnHold=s.fireOnHold,this._fireOnHoldDelay=s.fireOnHoldDelay,this._fireOnHoldInterval=s.fireOnHoldInterval,this._activeKeyGroups=[],this.keysDown=!1,this._global=s.global,this._handle=s.handle,this._abort=s.abort,this._keyGroups=this.convertKeysToKeyGroups(s.keys),this.listener=this,this.capture=s.capture,this._windowFocusListener=this.handleWindowFocusChange.bind(this),FocusManager.windowHasFocusProperty.link(this._windowFocusListener)}fireCallback(t,s){this._callback(t,s.naturalKeys,this)}handleKeyDown(t){(this._listenerFireTrigger==="down"||this._listenerFireTrigger==="both")&&this._keyGroups.forEach(s=>{this._activeKeyGroups.includes(s)||this.areKeysDownForListener(s)&&s.keys.includes(globalKeyStateTracker$1.getLastKeyDown())&&(this._activeKeyGroups.push(s),this.keysDown=!0,t.pointer.reserveForKeyboardDrag(),s.timer&&s.timer.start(),this.fireCallback(t,s))}),this.manageEvent(t)}handleKeyUp(t){if(this._activeKeyGroups.length>0&&this._activeKeyGroups.forEach((s,r)=>{this.areKeysDownForListener(s)||(s.timer&&s.timer.stop(!1),this._activeKeyGroups.splice(r,1))}),this._listenerFireTrigger==="up"||this._listenerFireTrigger==="both"){const s=KeyboardUtils.getEventCode(t.domEvent);s&&this._keyGroups.forEach(r=>{this.areModifierKeysDownForListener(r)&&r.keys.includes(s)&&(this.keysDown=!1,this.fireCallback(t,r))})}this.manageEvent(t)}getDownModifierKeys(t){const s=t.modifierKeys,r=[];return s.forEach(o=>{for(const n of o)if(globalKeyStateTracker$1.isKeyDown(n)){r.push(n);break}}),r}areKeysDownForListener(t){const s=this.getDownModifierKeys(t),r=s.length===t.modifierKeys.length,o=t.keys.find(n=>globalKeyStateTracker$1.isKeyDown(n));if(r&&o){const n=[...s,o];return globalKeyStateTracker$1.areKeysDownWithoutExtraModifiers(n)}else return!1}areModifierKeysDownForListener(t){const s=this.getDownModifierKeys(t);return s.length===t.modifierKeys.length?globalKeyStateTracker$1.areKeysDownWithoutExtraModifiers(s):!1}manageEvent(t){this._handle&&t.handle(),this._abort&&t.abort()}keydown(t){this._global||this.handleKeyDown(t)}keyup(t){this._global||this.handleKeyUp(t)}globalkeydown(t){this._global&&this.handleKeyDown(t)}globalkeyup(t){this._global&&this.handleKeyUp(t)}handleCancel(){this.clearActiveKeyGroups(),this._cancel(this)}handleWindowFocusChange(t){t||this.handleCancel()}cancel(){this.handleCancel()}interrupt(){this.handleCancel()}focusout(t){this.interrupt(),this._blur(this)}focusin(t){this._focus(this)}dispose(){this._keyGroups.forEach(t=>{t.timer&&t.timer.dispose()}),this._keyGroups.length=0,FocusManager.windowHasFocusProperty.unlink(this._windowFocusListener)}clearActiveKeyGroups(){this._activeKeyGroups.forEach(t=>{t.timer&&t.timer.stop(!1)}),this._activeKeyGroups.length=0}convertKeysToKeyGroups(t){return t.map(r=>{const o=r.split("+");assert&&assert(o.length>0,"no keys provided?");const n=o.slice(-1)[0],l=EnglishStringToCodeMap[n];assert&&assert(l,`Codes were not found, do you need to add it to EnglishStringToCodeMap? ${n}`);let h=[];o.length>1&&(h=o.slice(0,o.length-1).map(S=>{const O=EnglishStringToCodeMap[S];return assert&&assert(O,`Key not found, do you need to add it to EnglishStringToCodeMap? ${S}`),O}));const g=this._fireOnHold?new CallbackTimer({callback:()=>this.fireCallback(null,d),delay:this._fireOnHoldDelay,interval:this._fireOnHoldInterval}):null,d={keys:l,modifierKeys:h,naturalKeys:r,timer:g};return d})}static eventCodeToEnglishString(t){for(const s in EnglishStringToCodeMap)if(EnglishStringToCodeMap.hasOwnProperty(s)&&EnglishStringToCodeMap[s].includes(t))return s;return null}}scenery.register("KeyboardListener",KeyboardListener);const SpriteListenable=memoize(a=>(assert&&assert(_.includes(inheritance(a),PressListener),"Only PressListener subtypes should mix SpriteListenable"),class extends a{constructor(...t){super(...t),this.spriteInstance=null}press(t,s,r){if(this.isPressed)return!1;if(this.spriteInstance=null,t.currentTarget instanceof Sprites){const o=t.currentTarget;this.spriteInstance=o.getSpriteInstanceFromPoint(o.globalToLocalPoint(t.pointer.point))}return this.spriteInstance?super.press(t,s,r):!1}}));scenery.register("SpriteListenable",SpriteListenable);const PRESS_AND_HOLD_INTERVAL=.75,DOUBLE_TAP_INTERVAL=.6;class SwipeListener{constructor(t){this._pointer=null,this.downPoint=null,this.downEvent=null,this.enabled=!1,this.lastPoint=null,this.currentPoint=null,this.velocity=null,this.swipeDistance=null,this.firstUp=!1,this.timeSinceLastDown=0,this.downPointers=[],this.holdingTime=0,this.focusedNode=null,this.handleEventListener={down:s=>{s.handle(),s.abort(),this.handleDown(s)}},t.pointerAddedEmitter.addListener(s=>{this.enabled&&s.addInputListener(this.handleEventListener,!0)}),this._attachedPointerListener={up:s=>{this.focusedNode&&this.focusedNode.swipeEnd&&this.focusedNode.swipeEnd.bind(this.focusedNode)(s,this),this.focusedNode=null,this._pointer.removeInputListener(this._attachedPointerListener),this._pointer=null},move:s=>{this.focusedNode&&this.focusedNode.swipeMove&&this.focusedNode.swipeMove.bind(this.focusedNode)(s,this)},interrupt:s=>{this.focusedNode=null,this._pointer.removeInputListener(this._attachedPointerListener),this._pointer=null},cancel:s=>{this.focusedNode=null,this._pointer.removeInputListener(this._attachedPointerListener),this._pointer=null}},this._pointerListener={up:s=>{this.endSwipe(),this._pointer=null,this.swipeDistance=s.pointer.point.minus(this.downPoint);const r=this.swipeDistance.y,o=this.swipeDistance.x;if(Math.abs(o)>100&&Math.abs(r)<100)if(o>0){if(FocusManager.pdomFocusedNode&&FocusManager.pdomFocusedNode.innerContent==="Reset All")return;PDOMUtils$1.getNextFocusable(document.body).focus()}else PDOMUtils$1.getPreviousFocusable(document.body).focus();else if(this.firstUp){if(this.timeSinceLastDown<DOUBLE_TAP_INTERVAL){this.firstUp=!1,this.timeSinceLastDown=0;const n=document.getElementsByClassName("a11y-pdom-root")[0];n&&n.contains(s.activeElement)&&s.activeElement.click()}}else this.firstUp=!0},move:s=>{this.lastPoint=this.currentPoint,this.currentPoint=s.pointer.point},interrupt:()=>{this.interrupt()},cancel:()=>{this.interrupt()}},stepTimer.addListener(this.step.bind(this))}handleDown(t){t.pointer.addIntent(Intent.DRAG),this.downPointers.push(t.pointer),this.downPointers.length>1&&(this.downPointers.forEach(s=>s.removeIntent(Intent.DRAG)),t.pointer.removeIntent(Intent.DRAG)),assert&&assert(t.pointer.attachedProperty.get(),"should be attached to the handle listener"),t.pointer.removeInputListener(this.handleEventListener),this._pointer===null&&t.pointer.type==="touch"&&(this._pointer=t.pointer,t.pointer.addInputListener(this._pointerListener,!0),t.abort(),this.downEvent=t,this.downPoint=t.pointer.point,this.currentPoint=this.downPoint.copy(),this.previousPoint=this.currentPoint.copy())}up(t){const s=this.downPointers.indexOf(t.pointer);s>-1&&this.downPointers.splice(s,1)}step(t){if(this.firstUp&&(this.timeSinceLastDown+=t,this.timeSinceLastDown>DOUBLE_TAP_INTERVAL&&(this.firstUp=!1,this.timeSinceLastDown=0)),this._pointer&&!this._pointer.listeners.includes(this._attachedPointerListener))if(this.holdingTime>PRESS_AND_HOLD_INTERVAL){const s=FocusManager.pdomFocusedNode;s&&(this._pointer.removeInputListener(this._pointerListener),this.holdingTime=0,this.focusedNode=s,this._pointer.addInputListener(this._attachedPointerListener,!0),this.focusedNode.swipeStart&&this.focusedNode.swipeStart(this.downEvent,this),this.downEvent=null)}else this.holdingTime+=t;this.lastPoint!==null&&this.currentPoint!==null&&(this.velocity=this.lastPoint.minus(this.currentPoint).dividedScalar(t))}endSwipe(){this.holdingTime=0,this._pointer&&this._pointer.listeners.includes(this._pointerListener)&&this._pointer.removeInputListener(this._pointerListener)}detachPointerListener(){this._pointer.detach(this._attachedPointerListener)}interrupt(){this.endSwipe(),this._pointer=null,this.downEvent=null}}scenery.register("SwipeListener",SwipeListener);const LayoutOrientationValues=["horizontal","vertical"],HorizontalLayoutAlignValues=["left","right","center","origin"],VerticalLayoutAlignValues=["top","bottom","center","origin"],dr=class dr extends EnumerationValue{constructor(t,s,r=Number.POSITIVE_INFINITY){super(),this.horizontal=t,this.vertical=s,this.padRatio=r}static getAllowedAligns(t){return[...t===Orientation.HORIZONTAL?HorizontalLayoutAlignValues:VerticalLayoutAlignValues,null]}static alignToInternal(t,s){return t===Orientation.HORIZONTAL?dr.horizontalAlignToInternal(s):dr.verticalAlignToInternal(s)}static horizontalAlignToInternal(t){return t===null?null:(assert&&assert(horizontalAlignMap[t]),horizontalAlignMap[t])}static verticalAlignToInternal(t){return t===null?null:(assert&&assert(verticalAlignMap[t]),verticalAlignMap[t])}static internalToAlign(t,s){return s===null?null:t===Orientation.HORIZONTAL?s.horizontal:s.vertical}};dr.START=new dr("left","top",0),dr.END=new dr("right","bottom",1),dr.CENTER=new dr("center","center",.5),dr.ORIGIN=new dr("origin","origin"),dr.enumeration=new Enumeration(dr,{phetioDocumentation:"Alignment for layout containers"});let LayoutAlign=dr;const horizontalAlignMap={left:LayoutAlign.START,right:LayoutAlign.END,center:LayoutAlign.CENTER,origin:LayoutAlign.ORIGIN},verticalAlignMap={top:LayoutAlign.START,bottom:LayoutAlign.END,center:LayoutAlign.CENTER,origin:LayoutAlign.ORIGIN};scenery.register("LayoutAlign",LayoutAlign);const HorizontalLayoutJustificationValues=["left","right","center","spaceBetween","spaceAround","spaceEvenly"],VerticalLayoutJustificationValues=["top","bottom","center","spaceBetween","spaceAround","spaceEvenly"],Bn=class Bn extends EnumerationValue{constructor(t,s,r){super(),this.spacingFunctionFactory=t,this.horizontal=s,this.vertical=r}static getAllowedJustificationValues(t){return t===Orientation.HORIZONTAL?HorizontalLayoutJustificationValues:VerticalLayoutJustificationValues}static justifyToInternal(t,s){return t===Orientation.HORIZONTAL?(assert&&assert(horizontalJustificationMap[s]),horizontalJustificationMap[s]):(assert&&assert(verticalJustificationMap[s]),verticalJustificationMap[s])}static internalToJustify(t,s){return t===Orientation.HORIZONTAL?s.horizontal:s.vertical}};Bn.START=new Bn(()=>()=>0,"left","top"),Bn.END=new Bn(t=>s=>s===0?t:0,"right","bottom"),Bn.CENTER=new Bn(t=>s=>s===0?t/2:0,"center","center"),Bn.SPACE_BETWEEN=new Bn((t,s)=>r=>r!==0?t/(s-1):0,"spaceBetween","spaceBetween"),Bn.SPACE_AROUND=new Bn((t,s)=>r=>(r!==0?2:1)*t/(2*s),"spaceAround","spaceAround"),Bn.SPACE_EVENLY=new Bn((t,s)=>r=>t/(s+1),"spaceEvenly","spaceEvenly"),Bn.enumeration=new Enumeration(Bn,{phetioDocumentation:"Justify for layout containers"});let LayoutJustification=Bn;const horizontalJustificationMap={left:LayoutJustification.START,right:LayoutJustification.END,center:LayoutJustification.CENTER,spaceBetween:LayoutJustification.SPACE_BETWEEN,spaceAround:LayoutJustification.SPACE_AROUND,spaceEvenly:LayoutJustification.SPACE_EVENLY},verticalJustificationMap={top:LayoutJustification.START,bottom:LayoutJustification.END,center:LayoutJustification.CENTER,spaceBetween:LayoutJustification.SPACE_BETWEEN,spaceAround:LayoutJustification.SPACE_AROUND,spaceEvenly:LayoutJustification.SPACE_EVENLY};scenery.register("LayoutJustification",LayoutJustification);const DEFAULT_SEPARATOR_LAYOUT_OPTIONS={stretch:!0,isSeparator:!0};class Separator extends Line{constructor(t){super(optionize()({layoutOptions:DEFAULT_SEPARATOR_LAYOUT_OPTIONS,stroke:"rgb(100,100,100)"},t))}}scenery.register("Separator",Separator);class VSeparator extends HeightSizable(Separator){constructor(t){super(),this.localPreferredHeightProperty.link(s=>{s!==null&&(this.y2=s)}),this.mutate(t)}}scenery.register("VSeparator",VSeparator);class HSeparator extends WidthSizable(Separator){constructor(t){super(),this.localPreferredWidthProperty.link(s=>{s!==null&&(this.x2=s)}),this.mutate(t)}}scenery.register("HSeparator",HSeparator);const Xl=class Xl{constructor(t){this.initialize(t)}initialize(t){return this.trail=t,this}checkPreconditions(){assert&&assert(this.trail,"Should not be disposed"),assert&&assert(this.trail.getParentMatrix().isAxisAligned(),"Transforms with LayoutProxy need to be axis-aligned")}get node(){return assert&&this.checkPreconditions(),this.trail.lastNode()}get bounds(){return assert&&this.checkPreconditions(),this.trail.parentToGlobalBounds(this.node.bounds)}get visibleBounds(){return assert&&this.checkPreconditions(),this.trail.parentToGlobalBounds(this.node.visibleBounds)}get width(){return this.bounds.width}get height(){return this.bounds.height}get x(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformX(this.node.x)}set x(t){assert&&this.checkPreconditions(),this.node.x=this.trail.getParentTransform().inverseX(t)}get y(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformY(this.node.y)}set y(t){assert&&this.checkPreconditions(),this.node.y=this.trail.getParentTransform().inverseY(t)}get translation(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.translation)}set translation(t){assert&&this.checkPreconditions(),this.node.translation=this.trail.getParentTransform().inversePosition2(t)}get left(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformX(this.node.left)}set left(t){this.node.left=this.trail.getParentTransform().inverseX(t)}get right(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformX(this.node.right)}set right(t){assert&&this.checkPreconditions(),this.node.right=this.trail.getParentTransform().inverseX(t)}get centerX(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformX(this.node.centerX)}set centerX(t){assert&&this.checkPreconditions(),this.node.centerX=this.trail.getParentTransform().inverseX(t)}get top(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformY(this.node.top)}set top(t){assert&&this.checkPreconditions(),this.node.top=this.trail.getParentTransform().inverseY(t)}get bottom(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformY(this.node.bottom)}set bottom(t){assert&&this.checkPreconditions(),this.node.bottom=this.trail.getParentTransform().inverseY(t)}get centerY(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformY(this.node.centerY)}set centerY(t){assert&&this.checkPreconditions(),this.node.centerY=this.trail.getParentTransform().inverseY(t)}get leftTop(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.leftTop)}set leftTop(t){assert&&this.checkPreconditions(),this.node.leftTop=this.trail.getParentTransform().inversePosition2(t)}get centerTop(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.centerTop)}set centerTop(t){assert&&this.checkPreconditions(),this.node.centerTop=this.trail.getParentTransform().inversePosition2(t)}get rightTop(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.rightTop)}set rightTop(t){assert&&this.checkPreconditions(),this.node.rightTop=this.trail.getParentTransform().inversePosition2(t)}get leftCenter(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.leftCenter)}set leftCenter(t){assert&&this.checkPreconditions(),this.node.leftCenter=this.trail.getParentTransform().inversePosition2(t)}get center(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.center)}set center(t){assert&&this.checkPreconditions(),this.node.center=this.trail.getParentTransform().inversePosition2(t)}get rightCenter(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.rightCenter)}set rightCenter(t){assert&&this.checkPreconditions(),this.node.rightCenter=this.trail.getParentTransform().inversePosition2(t)}get leftBottom(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.leftBottom)}set leftBottom(t){assert&&this.checkPreconditions(),this.node.leftBottom=this.trail.getParentTransform().inversePosition2(t)}get centerBottom(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.centerBottom)}set centerBottom(t){assert&&this.checkPreconditions(),this.node.centerBottom=this.trail.getParentTransform().inversePosition2(t)}get rightBottom(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.rightBottom)}set rightBottom(t){assert&&this.checkPreconditions(),this.node.rightBottom=this.trail.getParentTransform().inversePosition2(t)}get widthSizable(){return this.node.widthSizable}get heightSizable(){return this.node.heightSizable}get preferredWidth(){assert&&this.checkPreconditions(),assert&&assert(isWidthSizable(this.node));const t=this.node.preferredWidth;return t===null?null:Math.abs(this.trail.getParentTransform().transformDeltaX(t))}set preferredWidth(t){assert&&this.checkPreconditions(),assert&&assert(isWidthSizable(this.node)),this.node.preferredWidth=t===null?null:Math.abs(this.trail.getParentTransform().inverseDeltaX(t))}get preferredHeight(){assert&&this.checkPreconditions(),assert&&assert(isHeightSizable(this.node));const t=this.node.preferredHeight;return t===null?null:Math.abs(this.trail.getParentTransform().transformDeltaY(t))}set preferredHeight(t){assert&&this.checkPreconditions(),assert&&assert(isHeightSizable(this.node)),this.node.preferredHeight=t===null?null:Math.abs(this.trail.getParentTransform().inverseDeltaY(t))}get minimumWidth(){assert&&this.checkPreconditions();const t=isWidthSizable(this.node)?this.node.minimumWidth||0:this.node.width;return Math.abs(this.trail.getParentTransform().transformDeltaX(t))}get minimumHeight(){assert&&this.checkPreconditions();const t=isHeightSizable(this.node)?this.node.minimumHeight||0:this.node.height;return Math.abs(this.trail.getParentTransform().transformDeltaY(t))}getMinimum(t){return t===Orientation.HORIZONTAL?this.minimumWidth:this.minimumHeight}get maxWidth(){return assert&&this.checkPreconditions(),this.node.maxWidth===null?null:Math.abs(this.trail.getParentTransform().transformDeltaX(this.node.maxWidth))}set maxWidth(t){assert&&this.checkPreconditions(),this.node.maxWidth=t===null?null:Math.abs(this.trail.getParentTransform().inverseDeltaX(t))}get maxHeight(){return assert&&this.checkPreconditions(),this.node.maxHeight===null?null:Math.abs(this.trail.getParentTransform().transformDeltaY(this.node.maxHeight))}set maxHeight(t){assert&&this.checkPreconditions(),this.node.maxHeight=t===null?null:Math.abs(this.trail.getParentTransform().inverseDeltaY(t))}getMax(t){return t===Orientation.HORIZONTAL?this.maxWidth:this.maxHeight}get visible(){return this.node.visible}set visible(t){this.node.visible=t}dispose(){this.trail=null,this.freeToPool()}freeToPool(){Xl.pool.freeToPool(this)}};Xl.pool=new Pool(Xl,{maxSize:1e3});let LayoutProxy=Xl;scenery.register("LayoutProxy",LayoutProxy);class LayoutProxyProperty extends DerivedProperty1{constructor(t,s,r){const o=new TrailsBetweenProperty(t,s);super([o],l=>l.length===1?LayoutProxy.pool.create(l[0].copy().removeAncestor()):null),this.transformTracker=null,this.trailsBetweenProperty=o,this.lazyLink((l,h)=>{h&&h.dispose()});const n=r==null?void 0:r.onTransformChange;n&&this.link(l=>{this.transformTracker&&(this.transformTracker.dispose(),this.transformTracker=null),l&&(this.transformTracker=new TransformTracker$1(l.trail.copy().addAncestor(t)),this.transformTracker.addListener(n))})}dispose(){this.trailsBetweenProperty.dispose(),this.transformTracker&&this.transformTracker.dispose(),super.dispose()}}scenery.register("LayoutProxyProperty",LayoutProxyProperty);class LayoutConstraint{constructor(t){this._layoutLockCount=0,this._layoutAttemptDuringLock=!1,this._enabled=!0,this._listenedNodes=new Set,this.finishedLayoutEmitter=new TinyEmitter,this.ancestorNode=t,this._updateLayoutListener=this.updateLayoutAutomatically.bind(this)}addNode(t,s=!0){assert&&assert(!this._listenedNodes.has(t)),assert&&assert(!s||!t._activeParentLayoutConstraint,"This node is already managed by a layout container - make sure to wrap it in a Node if DAG, removing it from an old layout container, etc."),s&&(t._activeParentLayoutConstraint=this),t.boundsProperty.lazyLink(this._updateLayoutListener),t.visibleProperty.lazyLink(this._updateLayoutListener),extendsWidthSizable(t)&&(t.minimumWidthProperty.lazyLink(this._updateLayoutListener),t.isWidthResizableProperty.lazyLink(this._updateLayoutListener)),extendsHeightSizable(t)&&(t.minimumHeightProperty.lazyLink(this._updateLayoutListener),t.isHeightResizableProperty.lazyLink(this._updateLayoutListener)),this._listenedNodes.add(t)}removeNode(t){assert&&assert(this._listenedNodes.has(t)),t._activeParentLayoutConstraint===this&&(t._activeParentLayoutConstraint=null),t.boundsProperty.unlink(this._updateLayoutListener),t.visibleProperty.unlink(this._updateLayoutListener),extendsWidthSizable(t)&&(t.minimumWidthProperty.unlink(this._updateLayoutListener),t.isWidthResizableProperty.unlink(this._updateLayoutListener)),extendsHeightSizable(t)&&(t.minimumHeightProperty.unlink(this._updateLayoutListener),t.isHeightResizableProperty.unlink(this._updateLayoutListener)),this._listenedNodes.delete(t)}layout(){}get isLocked(){return this._layoutLockCount>0}lock(){this._layoutLockCount++}unlock(){this._layoutLockCount--}validateLocalPreferredWidth(t){assert&&t.localBounds.isFinite()&&!this._layoutAttemptDuringLock&&t.validateLocalPreferredWidth()}validateLocalPreferredHeight(t){assert&&t.localBounds.isFinite()&&!this._layoutAttemptDuringLock&&t.validateLocalPreferredHeight()}validateLocalPreferredSize(t){assert&&t.localBounds.isFinite()&&!this._layoutAttemptDuringLock&&t.validateLocalPreferredSize()}updateLayout(){let t=0;if(this.isLocked)assert&&t++,assert&&assert(++t<500,"Likely infinite loop detected, are we triggering layout within the layout?"),this._layoutAttemptDuringLock=!0;else{this.lock();do this._layoutAttemptDuringLock=!1,this.layout();while(this._layoutAttemptDuringLock);this.unlock()}}updateLayoutAutomatically(){this._enabled&&this.updateLayout()}createLayoutProxy(t){const s=t.getTrails(r=>r===this.ancestorNode);return s.length===1?LayoutProxy.pool.create(s[0].removeAncestor()):null}get enabled(){return this._enabled}set enabled(t){this._enabled!==t&&(this._enabled=t,this.updateLayoutAutomatically())}dispose(){const t=[...this._listenedNodes.keys()];for(let s=0;s<t.length;s++)this.removeNode(t[s]);this.finishedLayoutEmitter.dispose()}}scenery.register("LayoutConstraint",LayoutConstraint);class LayoutCell{constructor(t,s,r){r?(this.layoutProxyProperty=null,this._proxy=r):(this._proxy=null,this.layoutProxyProperty=new LayoutProxyProperty(t.ancestorNode,s,{onTransformChange:()=>t.updateLayoutAutomatically()}),this.layoutProxyProperty.link(o=>{this._proxy=o,t.updateLayoutAutomatically()})),this._constraint=t,this._node=s,this.layoutOptionsListener=this.onLayoutOptionsChange.bind(this),this.node.layoutOptionsChangedEmitter.addListener(this.layoutOptionsListener)}onLayoutOptionsChange(){}get node(){return this._node}isConnected(){return this._proxy!==null}get proxy(){return assert&&assert(this._proxy),this._proxy}isSizable(t){return t===Orientation.HORIZONTAL?this.proxy.widthSizable:this.proxy.heightSizable}dispose(){this.layoutProxyProperty&&this.layoutProxyProperty.dispose(),this.node.layoutOptionsChangedEmitter.removeListener(this.layoutOptionsListener)}}scenery.register("LayoutCell",LayoutCell);class MarginLayoutCell extends LayoutCell{constructor(t,s,r){super(t,s,r),this.preferredSizeSet=new OrientationPair(!1,!1),this.lastAvailableBounds=Bounds2.NOTHING.copy(),this.lastUsedBounds=Bounds2.NOTHING.copy(),this._marginConstraint=t}reposition(t,s,r,o,n,l){const h=o&&this.isSizable(t)?s:this.getMinimumSize(t);if(assert){const d=t===Orientation.HORIZONTAL?this.node.maxWidth:this.node.maxHeight;assert(!this.isSizable(t)||d===null||Math.abs(d-h)>-1e-9,`Tried to set a preferred size ${h} larger than the specified max${t===Orientation.HORIZONTAL?"Width":"Height"} of ${d}. Ideally, try to avoid putting a maxWidth/maxHeight on a width/height-sizable Node (one that will resize to fit its preferred size) inside a layout container, particularly one that will try to expand the Node past its maximum size.`)}this.attemptPreferredSize(t,h),l===LayoutAlign.ORIGIN?this.positionOrigin(t,r+n):this.positionStart(t,r+(s-this.getCellBounds()[t.size])*l.padRatio);const g=this.getCellBounds();return assert&&assert(g.isFinite()),this.lastAvailableBounds[t.minCoordinate]=r,this.lastAvailableBounds[t.maxCoordinate]=r+s,this.lastUsedBounds.set(g),g}get effectiveLeftMargin(){return this._leftMargin!==null?this._leftMargin:this._marginConstraint._leftMargin}get effectiveRightMargin(){return this._rightMargin!==null?this._rightMargin:this._marginConstraint._rightMargin}get effectiveTopMargin(){return this._topMargin!==null?this._topMargin:this._marginConstraint._topMargin}get effectiveBottomMargin(){return this._bottomMargin!==null?this._bottomMargin:this._marginConstraint._bottomMargin}getEffectiveMinMargin(t){return t===Orientation.HORIZONTAL?this.effectiveLeftMargin:this.effectiveTopMargin}getEffectiveMaxMargin(t){return t===Orientation.HORIZONTAL?this.effectiveRightMargin:this.effectiveBottomMargin}get effectiveMinContentWidth(){return this._minContentWidth!==null?this._minContentWidth:this._marginConstraint._minContentWidth}get effectiveMinContentHeight(){return this._minContentHeight!==null?this._minContentHeight:this._marginConstraint._minContentHeight}getEffectiveMinContent(t){return t===Orientation.HORIZONTAL?this.effectiveMinContentWidth:this.effectiveMinContentHeight}get effectiveMaxContentWidth(){return this._maxContentWidth!==null?this._maxContentWidth:this._marginConstraint._maxContentWidth}get effectiveMaxContentHeight(){return this._maxContentHeight!==null?this._maxContentHeight:this._marginConstraint._maxContentHeight}getEffectiveMaxContent(t){return t===Orientation.HORIZONTAL?this.effectiveMaxContentWidth:this.effectiveMaxContentHeight}getMinimumSize(t){return this.getEffectiveMinMargin(t)+Math.max(this.proxy.getMinimum(t),this.getEffectiveMinContent(t)||0)+this.getEffectiveMaxMargin(t)}getMaximumSize(t){return this.getEffectiveMinMargin(t)+(this.getEffectiveMaxContent(t)||Number.POSITIVE_INFINITY)+this.getEffectiveMaxMargin(t)}attemptPreferredSize(t,s){if(this.proxy[t.sizable]){const r=this.getMinimumSize(t),o=this.getMaximumSize(t);assert&&assert(isFinite(r)),assert&&assert(o>=r),s=DotUtils.clamp(s,r,o);let n=s-this.getEffectiveMinMargin(t)-this.getEffectiveMaxMargin(t);const l=this.proxy.getMax(t);l!==null&&(n=Math.min(l,n)),this._marginConstraint.setProxyPreferredSize(t,this.proxy,n),this.preferredSizeSet.set(t,!0)}}unsetPreferredSize(t){this.proxy[t.sizable]&&this._marginConstraint.setProxyPreferredSize(t,this.proxy,null)}positionStart(t,s){const r=this.getEffectiveMinMargin(t)+s;this._marginConstraint.setProxyMinSide(t,this.proxy,r)}positionOrigin(t,s){this._marginConstraint.setProxyOrigin(t,this.proxy,s)}getOriginBounds(){return this.getCellBounds().shiftedXY(-this.proxy.x,-this.proxy.y)}getCellBounds(){return this.proxy.bounds.withOffsets(this.effectiveLeftMargin,this.effectiveTopMargin,this.effectiveRightMargin,this.effectiveBottomMargin)}dispose(){Orientation.enumeration.values.forEach(t=>{this.preferredSizeSet.get(t)&&this.unsetPreferredSize(t)}),super.dispose()}static createHelperNode(t,s,r){const o=new Node$2,n=.4,l=Shape$1.union(t.map(I=>Shape$1.bounds(I.lastAvailableBounds))),h=Shape$1.union(t.map(I=>Shape$1.bounds(I.lastUsedBounds))),g=Shape$1.union(t.map(I=>Shape$1.bounds(I.proxy.bounds))),d=Shape$1.bounds(s).shapeDifference(l),A=l.shapeDifference(h),S=h.shapeDifference(g),O=(I,W,L)=>{const H=new Text(I,{font:new Font({size:6,family:"monospace"}),fill:W}),Y=Rectangle.bounds(H.bounds,{fill:L,children:[H]});return new NodePattern(Y,4,Math.floor(Y.left),Math.ceil(Y.top+1),Math.floor(Y.width),Math.floor(Y.height-2),Matrix3.rotation2(-Math.PI/4))};return o.addChild(new Path(d,{fill:O("spacing","#000","#fff"),opacity:.6})),o.addChild(new Path(A,{fill:O("empty","#aaa","#000"),opacity:.6})),o.addChild(new Path(S,{fill:O("margin","#600","#f00"),opacity:.6})),o.addChild(Rectangle.bounds(s,{stroke:"white",lineDash:[2,2],lineDashOffset:2,lineWidth:n})),o.addChild(Rectangle.bounds(s,{stroke:"black",lineDash:[2,2],lineWidth:n})),t.forEach(I=>{o.addChild(Rectangle.bounds(I.getCellBounds(),{stroke:"rgba(0,255,0,1)",lineWidth:n}))}),t.forEach(I=>{o.addChild(Rectangle.bounds(I.proxy.bounds,{stroke:"rgba(255,0,0,1)",lineWidth:n}))}),t.forEach(I=>{const W=I.getCellBounds(),L=new PressListener({tandem:Tandem.OPT_OUT});o.addChild(Rectangle.bounds(W,{inputListeners:[L]}));let H=r(I);I.effectiveLeftMargin&&(H+=`leftMargin: ${I.effectiveLeftMargin}
`),I.effectiveRightMargin&&(H+=`rightMargin: ${I.effectiveRightMargin}
`),I.effectiveTopMargin&&(H+=`topMargin: ${I.effectiveTopMargin}
`),I.effectiveBottomMargin&&(H+=`bottomMargin: ${I.effectiveBottomMargin}
`),I.effectiveMinContentWidth&&(H+=`minContentWidth: ${I.effectiveMinContentWidth}
`),I.effectiveMinContentHeight&&(H+=`minContentHeight: ${I.effectiveMinContentHeight}
`),I.effectiveMaxContentWidth&&(H+=`maxContentWidth: ${I.effectiveMaxContentWidth}
`),I.effectiveMaxContentHeight&&(H+=`maxContentHeight: ${I.effectiveMaxContentHeight}
`),H+=`layoutOptions: ${JSON.stringify(I.node.layoutOptions,null,2).replace(/ /g,"&nbsp;")}
`;const Y=new RichText(H.trim().replace(/\n/g,"<br>"),{font:new Font({size:12})}),Q=Rectangle.bounds(Y.bounds.dilated(3),{fill:"rgba(255,255,255,0.8)",children:[Y],leftTop:W.leftTop});o.addChild(Q),L.isOverProperty.link(pe=>{Q.visible=pe})}),o}}scenery.register("MarginLayoutCell",MarginLayoutCell);const LAYOUT_NODE_OPTION_KEYS=["resize","layoutOrigin"];class LayoutNode extends Sizable(Node$2){constructor(t){super(t),this.layoutOriginProperty=new Vector2Property(Vector2.ZERO)}linkLayoutBounds(){this._constraint.layoutBoundsProperty.link(t=>{this.localBounds=t})}setExcludeInvisibleChildrenFromBounds(t){super.setExcludeInvisibleChildrenFromBounds(t),this._constraint.excludeInvisible=t}setChildren(t){if(this.constraint.isLocked)return super.setChildren(t);const s=this.getChildren();return this.constraint.lock(),super.setChildren(t),this.constraint.unlock(),_.isEqual(s,t)||this.constraint.updateLayoutAutomatically(),this}updateLayout(){this._constraint.updateLayout()}get resize(){return this._constraint.enabled}set resize(t){this._constraint.enabled=t}get layoutOrigin(){return this.layoutOriginProperty.value}set layoutOrigin(t){this.layoutOriginProperty.value=t}get constraint(){return this._constraint}dispose(){this._constraint.dispose(),super.dispose()}}scenery.register("LayoutNode",LayoutNode);class LayoutLine{initializeLayoutLine(){this.min=0,this.max=Number.POSITIVE_INFINITY,this.minOrigin=Number.POSITIVE_INFINITY,this.maxOrigin=Number.NEGATIVE_INFINITY,this.size=0,this.position=0}hasOrigin(){return isFinite(this.minOrigin)&&isFinite(this.maxOrigin)}}scenery.register("LayoutLine",LayoutLine);const CHANGE_POSITION_THRESHOLD=1e-9;class NodeLayoutConstraint extends LayoutConstraint{constructor(t,s){const r=optionize()({preferredWidthProperty:new TinyProperty(null),preferredHeightProperty:new TinyProperty(null),minimumWidthProperty:new TinyProperty(null),minimumHeightProperty:new TinyProperty(null),layoutOriginProperty:new TinyProperty(Vector2.ZERO)},s);super(t),this._excludeInvisible=!0,this.layoutBoundsProperty=new Property(Bounds2.NOTHING,{valueComparisonStrategy:"equalsFunction"}),this.preferredWidthProperty=r.preferredWidthProperty,this.preferredHeightProperty=r.preferredHeightProperty,this.minimumWidthProperty=r.minimumWidthProperty,this.minimumHeightProperty=r.minimumHeightProperty,this.layoutOriginProperty=r.layoutOriginProperty,this.preferredWidthProperty.lazyLink(this._updateLayoutListener),this.preferredHeightProperty.lazyLink(this._updateLayoutListener),this.layoutOriginProperty.lazyLink(this._updateLayoutListener)}filterLayoutCells(t){return assert&&assert(_.every(t,s=>!s.node.isDisposed),"A cell's node should not be disposed when layout happens"),t.filter(s=>s.isConnected()&&s.proxy.bounds.isValid()&&(!this.excludeInvisible||s.node.visible))}get excludeInvisible(){return this._excludeInvisible}set excludeInvisible(t){this._excludeInvisible!==t&&(this._excludeInvisible=t,this.updateLayoutAutomatically())}setProxyPreferredSize(t,s,r){s[t.preferredSize]=r}setProxyMinSide(t,s,r){Math.abs(s[t.minSide]-r)>CHANGE_POSITION_THRESHOLD&&(s[t.minSide]=r)}setProxyOrigin(t,s,r){Math.abs(s[t.coordinate]-r)>CHANGE_POSITION_THRESHOLD&&(s[t.coordinate]=r)}dispose(){this.preferredWidthProperty.unlink(this._updateLayoutListener),this.preferredHeightProperty.unlink(this._updateLayoutListener),this.layoutOriginProperty.unlink(this._updateLayoutListener),super.dispose()}}scenery.register("NodeLayoutConstraint",NodeLayoutConstraint);const MARGIN_LAYOUT_CONFIGURABLE_OPTION_KEYS=["margin","xMargin","yMargin","leftMargin","rightMargin","topMargin","bottomMargin","minContentWidth","minContentHeight","maxContentWidth","maxContentHeight"],MarginLayoutConfigurable=memoize(a=>class extends a{constructor(...s){super(...s),this._leftMargin=null,this._rightMargin=null,this._topMargin=null,this._bottomMargin=null,this._minContentWidth=null,this._minContentHeight=null,this._maxContentWidth=null,this._maxContentHeight=null,this.changedEmitter=new TinyEmitter}mutateConfigurable(s){assertMutuallyExclusiveOptions(s,["margin"],["xMargin","yMargin"]),assertMutuallyExclusiveOptions(s,["xMargin"],["leftMargin","rightMargin"]),assertMutuallyExclusiveOptions(s,["yMargin"],["topMargin","bottomMargin"])}setConfigToBaseDefault(){this._leftMargin=0,this._rightMargin=0,this._topMargin=0,this._bottomMargin=0,this._minContentWidth=null,this._minContentHeight=null,this._maxContentWidth=null,this._maxContentHeight=null,this.changedEmitter.emit()}setConfigToInherit(){this._leftMargin=null,this._rightMargin=null,this._topMargin=null,this._bottomMargin=null,this._minContentWidth=null,this._minContentHeight=null,this._maxContentWidth=null,this._maxContentHeight=null,this.changedEmitter.emit()}get leftMargin(){return this._leftMargin}set leftMargin(s){assert&&assert(s===null||typeof s=="number"&&isFinite(s)),this._leftMargin!==s&&(this._leftMargin=s,this.changedEmitter.emit())}get rightMargin(){return this._rightMargin}set rightMargin(s){assert&&assert(s===null||typeof s=="number"&&isFinite(s)),this._rightMargin!==s&&(this._rightMargin=s,this.changedEmitter.emit())}get topMargin(){return this._topMargin}set topMargin(s){assert&&assert(s===null||typeof s=="number"&&isFinite(s)),this._topMargin!==s&&(this._topMargin=s,this.changedEmitter.emit())}get bottomMargin(){return this._bottomMargin}set bottomMargin(s){assert&&assert(s===null||typeof s=="number"&&isFinite(s)),this._bottomMargin!==s&&(this._bottomMargin=s,this.changedEmitter.emit())}get xMargin(){return assert&&assert(this._leftMargin===this._rightMargin),this._leftMargin}set xMargin(s){assert&&assert(s===null||typeof s=="number"&&isFinite(s)),(this._leftMargin!==s||this._rightMargin!==s)&&(this._leftMargin=s,this._rightMargin=s,this.changedEmitter.emit())}get yMargin(){return assert&&assert(this._topMargin===this._bottomMargin),this._topMargin}set yMargin(s){assert&&assert(s===null||typeof s=="number"&&isFinite(s)),(this._topMargin!==s||this._bottomMargin!==s)&&(this._topMargin=s,this._bottomMargin=s,this.changedEmitter.emit())}get margin(){return assert&&assert(this._leftMargin===this._rightMargin&&this._leftMargin===this._topMargin&&this._leftMargin===this._bottomMargin),this._topMargin}set margin(s){assert&&assert(s===null||typeof s=="number"&&isFinite(s)),(this._leftMargin!==s||this._rightMargin!==s||this._topMargin!==s||this._bottomMargin!==s)&&(this._leftMargin=s,this._rightMargin=s,this._topMargin=s,this._bottomMargin=s,this.changedEmitter.emit())}get minContentWidth(){return this._minContentWidth}set minContentWidth(s){this._minContentWidth!==s&&(this._minContentWidth=s,this.changedEmitter.emit())}get minContentHeight(){return this._minContentHeight}set minContentHeight(s){this._minContentHeight!==s&&(this._minContentHeight=s,this.changedEmitter.emit())}get maxContentWidth(){return this._maxContentWidth}set maxContentWidth(s){this._maxContentWidth!==s&&(this._maxContentWidth=s,this.changedEmitter.emit())}get maxContentHeight(){return this._maxContentHeight}set maxContentHeight(s){this._maxContentHeight!==s&&(this._maxContentHeight=s,this.changedEmitter.emit())}});scenery.register("MarginLayoutConfigurable",MarginLayoutConfigurable);const FLOW_CONFIGURABLE_OPTION_KEYS=["orientation","align","stretch","grow"].concat(MARGIN_LAYOUT_CONFIGURABLE_OPTION_KEYS),FlowConfigurable=memoize(a=>class extends MarginLayoutConfigurable(a){constructor(...s){super(...s),this._orientation=Orientation.HORIZONTAL,this._align=null,this._stretch=null,this._grow=null,this.orientationChangedEmitter=new TinyEmitter}mutateConfigurable(s){super.mutateConfigurable(s),mutate(this,FLOW_CONFIGURABLE_OPTION_KEYS,s)}setConfigToBaseDefault(){this._align=LayoutAlign.CENTER,this._stretch=!1,this._grow=0,super.setConfigToBaseDefault()}setConfigToInherit(){this._align=null,this._stretch=null,this._grow=null,super.setConfigToInherit()}get orientation(){return this._orientation===Orientation.HORIZONTAL?"horizontal":"vertical"}set orientation(s){assert&&assert(s==="horizontal"||s==="vertical");const r=s==="horizontal"?Orientation.HORIZONTAL:Orientation.VERTICAL;this._orientation!==r&&(this._orientation=r,this.orientationChangedEmitter.emit(),this.changedEmitter.emit())}get align(){const s=LayoutAlign.internalToAlign(this._orientation,this._align);return assert&&assert(s===null||typeof s=="string"),s}set align(s){assert&&assert(LayoutAlign.getAllowedAligns(this._orientation.opposite).includes(s),`align ${s} not supported, with the orientation ${this._orientation}, the valid values are ${LayoutAlign.getAllowedAligns(this._orientation.opposite)}`);const r=LayoutAlign.alignToInternal(this._orientation.opposite,s);assert&&assert(r===null||r instanceof LayoutAlign),this._align!==r&&(this._align=r,this.changedEmitter.emit())}get stretch(){return this._stretch}set stretch(s){this._stretch!==s&&(this._stretch=s,this.changedEmitter.emit())}get grow(){return this._grow}set grow(s){assert&&assert(s===null||typeof s=="number"&&isFinite(s)&&s>=0),this._grow!==s&&(this._grow=s,this.changedEmitter.emit())}});scenery.register("FlowConfigurable",FlowConfigurable);const FLOW_CELL_KEYS=[...FLOW_CONFIGURABLE_OPTION_KEYS,"isSeparator"];class FlowCell extends FlowConfigurable(MarginLayoutCell){constructor(t,s,r){super(t,s,r),this.size=0,this._isSeparator=!1,this.flowConstraint=t,this.orientation=t.orientation,this.onLayoutOptionsChange()}get effectiveAlign(){return this._align!==null?this._align:this.flowConstraint._align}get effectiveStretch(){return this._stretch!==null?this._stretch:this.flowConstraint._stretch}get effectiveGrow(){return this._grow!==null?this._grow:this.flowConstraint._grow}onLayoutOptionsChange(){this.node.layoutOptions&&this.setOptions(this.node.layoutOptions),super.onLayoutOptionsChange()}setOptions(t){const s=optionize()({isSeparator:!1},t);assert&&Object.keys(s).forEach(r=>{assert&&assert(FLOW_CELL_KEYS.includes(r),`Cannot provide key ${r} to a FlowCell's layoutOptions. Perhaps this is a Grid-style layout option?`)}),this._isSeparator=s.isSeparator,this.setConfigToInherit(),this.mutateConfigurable(s)}}scenery.register("FlowCell",FlowCell);const jl=class jl extends LayoutLine{constructor(t,s){super(),this.initialize(t,s)}initialize(t,s){return this.orientation=t,this.cells=s,this.initializeLayoutLine(),this}getMinimumSize(t){return(this.cells.length-1)*t+_.sum(this.cells.map(s=>s.getMinimumSize(this.orientation)))}freeToPool(){jl.pool.freeToPool(this)}clean(){this.cells.length=0,this.freeToPool()}};jl.pool=new Pool(jl,{defaultArguments:[Orientation.HORIZONTAL,[]]});let FlowLine=jl;scenery.register("FlowLine",FlowLine);const FLOW_CONSTRAINT_OPTION_KEYS=[...FLOW_CONFIGURABLE_OPTION_KEYS,"spacing","lineSpacing","justify","justifyLines","wrap","excludeInvisible"];class FlowConstraint extends FlowConfigurable(NodeLayoutConstraint){constructor(t,s){super(t,s),this.cells=[],this._justify=LayoutJustification.SPACE_BETWEEN,this._justifyLines=null,this._wrap=!1,this._spacing=0,this._lineSpacing=0,this.displayedCells=[],this.setConfigToBaseDefault(),this.mutateConfigurable(s),mutate(this,FLOW_CONSTRAINT_OPTION_KEYS,s),this.changedEmitter.addListener(this._updateLayoutListener),this.orientationChangedEmitter.addListener(()=>this.cells.forEach(r=>{r.orientation=this.orientation}))}updateSeparatorVisibility(){let t=0;for(;t<this.cells.length;t++){const r=this.cells[t];if(r._isSeparator)r.node.visible=!1;else if(r.node.visible)break}let s=!1;for(let r=this.cells.length-1;r>t;r--){const o=this.cells[r];o._isSeparator?(o.node.visible=s,s=!1):o.node.visible&&(s=!0)}}layout(){super.layout();const t=this._orientation,s=this._orientation.opposite;this.updateSeparatorVisibility();const r=this.filterLayoutCells(this.cells);if(this.displayedCells=r,!r.length){this.layoutBoundsProperty.value=Bounds2.NOTHING,this.minimumWidthProperty.value=null,this.minimumHeightProperty.value=null;return}let o=this.getPreferredProperty(t).value;const n=this.getPreferredProperty(s).value,l=Math.max(...r.map(ye=>ye.getMinimumSize(t)||0));l>(o||Number.POSITIVE_INFINITY)&&(o=l);const h=[];if(this.wrap){let ye=[],Ee=o||Number.POSITIVE_INFINITY;for(;r.length;){const Le=r.shift(),Z=Le.getMinimumSize(t);ye.length===0?(ye.push(Le),Ee-=Z):this.spacing+Z<=Ee+1e-7?(ye.push(Le),Ee-=this.spacing+Z):(h.push(FlowLine.pool.create(t,ye)),Ee=o||Number.POSITIVE_INFINITY,ye=[Le],Ee-=Z)}ye.length&&h.push(FlowLine.pool.create(t,ye))}else h.push(FlowLine.pool.create(t,r));h.forEach(ye=>{ye.cells.forEach(Ee=>{if(ye.min=Math.max(ye.min,Ee.getMinimumSize(s)),ye.max=Math.min(ye.max,Ee.getMaximumSize(s)),Ee.effectiveAlign===LayoutAlign.ORIGIN){const Le=Ee.getOriginBounds();ye.minOrigin=Math.min(Le[s.minCoordinate],ye.minOrigin),ye.maxOrigin=Math.max(Le[s.maxCoordinate],ye.maxOrigin)}}),isFinite(ye.minOrigin)&&isFinite(ye.maxOrigin)?ye.size=Math.max(ye.min,ye.maxOrigin-ye.minOrigin):ye.size=ye.min});const g=Math.max(...h.map(ye=>ye.getMinimumSize(this.spacing))),d=_.sum(h.map(ye=>ye.size))+(h.length-1)*this.lineSpacing,A=this.wrap?l:g,S=Math.max(g,o||0),O=Math.max(d,n||0),I=this.layoutOriginProperty.value[t.coordinate],W=this.layoutOriginProperty.value[t.opposite.coordinate];h.forEach(ye=>{const Ee=_.sum(ye.cells.map(xe=>xe.getMinimumSize(t))),Le=this.spacing*(ye.cells.length-1);let Z=S-Ee-Le;ye.cells.forEach(xe=>{xe.size=xe.getMinimumSize(t)});let ne;for(;Z>1e-7&&(ne=ye.cells.filter(xe=>xe.effectiveGrow!==0&&xe.size<xe.getMaximumSize(t)-1e-7)).length;){const xe=_.sum(ne.map(zt=>zt.effectiveGrow)),Ct=Math.min(Math.min(...ne.map(zt=>(zt.getMaximumSize(t)-zt.size)/zt.effectiveGrow)),Z/xe);assert&&assert(Ct>1e-11),ne.forEach(zt=>{zt.size+=Ct*zt.effectiveGrow}),Z-=Ct*xe}ye.cells.forEach(xe=>xe.attemptPreferredSize(t,xe.size));const Ke=this._justify.spacingFunctionFactory(Z,ye.cells.length);let _t=I;ye.cells.forEach((xe,Ct)=>{_t+=Ke(Ct),Ct>0&&(_t+=this.spacing),xe.positionStart(t,_t),xe.lastAvailableBounds[t.minCoordinate]=_t,xe.lastAvailableBounds[t.maxCoordinate]=_t+xe.size,_t+=xe.size,assert&&assert(this.spacing>=0||xe.size>=-this.spacing-1e-7,"Negative spacing more than a cell's size causes issues with layout")})});const L=O-d,H=(h[0].hasOrigin()?h[0].minOrigin:0)+W;let Y=H;if(this._justifyLines===null)h.forEach(ye=>{ye.size+=L/h.length}),h.forEach(ye=>{ye.position=Y,Y+=ye.size+this.lineSpacing});else{const ye=this._justifyLines.spacingFunctionFactory(L,h.length);h.forEach((Ee,Le)=>{Y+=ye(Le),Ee.position=Y,Y+=Ee.size+this.lineSpacing})}h.forEach(ye=>ye.cells.forEach(Ee=>{Ee.reposition(s,ye.size,ye.position,Ee.effectiveStretch,-ye.minOrigin,Ee.effectiveAlign)}));const Q=I,pe=I+S,de=H,fe=H+O;this.layoutBoundsProperty.value=Bounds2.oriented(t,Q,de,pe,fe),this.minimumWidthProperty.value=t===Orientation.HORIZONTAL?A:d,this.minimumHeightProperty.value=t===Orientation.HORIZONTAL?d:A,this.finishedLayoutEmitter.emit(),h.forEach(ye=>ye.clean())}get justify(){const t=LayoutJustification.internalToJustify(this._orientation,this._justify);return assert&&assert(LayoutJustification.getAllowedJustificationValues(this._orientation).includes(t)),t}set justify(t){assert&&assert(LayoutJustification.getAllowedJustificationValues(this._orientation).includes(t),`justify ${t} not supported, with the orientation ${this._orientation}, the valid values are ${LayoutJustification.getAllowedJustificationValues(this._orientation)}`);const s=LayoutJustification.justifyToInternal(this._orientation,t);this._justify!==s&&(this._justify=s,this.updateLayoutAutomatically())}get justifyLines(){if(this._justifyLines===null)return null;{const t=LayoutJustification.internalToJustify(this._orientation,this._justifyLines);return assert&&assert(LayoutJustification.getAllowedJustificationValues(this._orientation).includes(t)),t}}set justifyLines(t){assert&&assert(t===null||LayoutJustification.getAllowedJustificationValues(this._orientation.opposite).includes(t),`justify ${t} not supported, with the orientation ${this._orientation.opposite}, the valid values are ${LayoutJustification.getAllowedJustificationValues(this._orientation.opposite)} or null`);const s=t===null?null:LayoutJustification.justifyToInternal(this._orientation.opposite,t);assert&&assert(s===null||s instanceof LayoutJustification),this._justifyLines!==s&&(this._justifyLines=s,this.updateLayoutAutomatically())}get wrap(){return this._wrap}set wrap(t){this._wrap!==t&&(this._wrap=t,this.updateLayoutAutomatically())}get spacing(){return this._spacing}set spacing(t){assert&&assert(isFinite(t)),this._spacing!==t&&(this._spacing=t,this.updateLayoutAutomatically())}get lineSpacing(){return this._lineSpacing}set lineSpacing(t){assert&&assert(isFinite(t)),this._lineSpacing!==t&&(this._lineSpacing=t,this.updateLayoutAutomatically())}insertCell(t,s){assert&&assert(t>=0),assert&&assert(t<=this.cells.length),assert&&assert(!_.includes(this.cells,s)),s.orientation=this.orientation,this.cells.splice(t,0,s),this.addNode(s.node),s.changedEmitter.addListener(this._updateLayoutListener),this.updateLayoutAutomatically()}removeCell(t){assert&&assert(_.includes(this.cells,t)),arrayRemove(this.cells,t),this.removeNode(t.node),t.changedEmitter.removeListener(this._updateLayoutListener),this.updateLayoutAutomatically()}reorderCells(t,s,r){this.cells.splice(s,r-s+1,...t),this.updateLayoutAutomatically()}getPreferredProperty(t){return t===Orientation.HORIZONTAL?this.preferredWidthProperty:this.preferredHeightProperty}dispose(){this.lock(),this.cells.forEach(t=>this.removeCell(t)),this.displayedCells=[],super.dispose(),this.unlock()}static create(t,s){return new FlowConstraint(t,s)}}scenery.register("FlowConstraint",FlowConstraint);const FLOWBOX_OPTION_KEYS=[...LAYOUT_NODE_OPTION_KEYS,...FLOW_CONSTRAINT_OPTION_KEYS.filter(a=>a!=="excludeInvisible")],DEFAULT_OPTIONS$2={orientation:"horizontal",spacing:0,align:"center",stretch:!1},Uu=class Uu extends LayoutNode{constructor(t){const s=optionize()({excludeInvisibleChildrenFromBounds:!0,resize:!0,disabledOpacity:SceneryConstants.DISABLED_OPACITY},t);super(),this._cellMap=new Map,this._constraint=new FlowConstraint(this,{preferredWidthProperty:this.localPreferredWidthProperty,preferredHeightProperty:this.localPreferredHeightProperty,minimumWidthProperty:this.localMinimumWidthProperty,minimumHeightProperty:this.localMinimumHeightProperty,layoutOriginProperty:this.layoutOriginProperty,orientation:DEFAULT_OPTIONS$2.orientation,spacing:DEFAULT_OPTIONS$2.spacing,align:DEFAULT_OPTIONS$2.align,stretch:DEFAULT_OPTIONS$2.stretch,excludeInvisible:!1}),this.onChildInserted=this.onFlowBoxChildInserted.bind(this),this.onChildRemoved=this.onFlowBoxChildRemoved.bind(this),this.onChildrenReordered=this.onFlowBoxChildrenReordered.bind(this),this.onChildrenChanged=this.onFlowBoxChildrenChanged.bind(this),this.childInsertedEmitter.addListener(this.onChildInserted),this.childRemovedEmitter.addListener(this.onChildRemoved),this.childrenReorderedEmitter.addListener(this.onChildrenReordered),this.childrenChangedEmitter.addListener(this.onChildrenChanged);const r=_.omit(s,REQUIRES_BOUNDS_OPTION_KEYS),o=_.pick(s,REQUIRES_BOUNDS_OPTION_KEYS);this._constraint.lock(),this.mutate(r),this._constraint.unlock(),this._constraint.updateLayout(),this.mutate(o),this.linkLayoutBounds()}onFlowBoxChildInserted(t,s){const r=new FlowCell(this._constraint,t,this._constraint.createLayoutProxy(t));this._cellMap.set(t,r),this._constraint.insertCell(s,r)}onFlowBoxChildRemoved(t){const s=this._cellMap.get(t);assert&&assert(s),this._cellMap.delete(t),this._constraint.removeCell(s),s.dispose()}onFlowBoxChildrenReordered(t,s){this._constraint.reorderCells(this._children.slice(t,s+1).map(r=>this._cellMap.get(r)),t,s)}onFlowBoxChildrenChanged(){this._constraint.updateLayoutAutomatically()}getCell(t){const s=this._cellMap.get(t);return assert&&assert(s),s}get orientation(){return this._constraint.orientation}set orientation(t){this._constraint.orientation=t}get spacing(){return this._constraint.spacing}set spacing(t){this._constraint.spacing=t}get lineSpacing(){return this._constraint.lineSpacing}set lineSpacing(t){this._constraint.lineSpacing=t}get justify(){return this._constraint.justify}set justify(t){this._constraint.justify=t}get justifyLines(){return this._constraint.justifyLines}set justifyLines(t){this._constraint.justifyLines=t}get wrap(){return this._constraint.wrap}set wrap(t){this._constraint.wrap=t}get align(){return assert&&assert(typeof this._constraint.align=="string"),this._constraint.align}set align(t){this._constraint.align=t}get stretch(){return assert&&assert(typeof this._constraint.stretch=="boolean"),this._constraint.stretch}set stretch(t){this._constraint.stretch=t}get grow(){return this._constraint.grow}set grow(t){this._constraint.grow=t}get margin(){return this._constraint.margin}set margin(t){this._constraint.margin=t}get xMargin(){return this._constraint.xMargin}set xMargin(t){this._constraint.xMargin=t}get yMargin(){return this._constraint.yMargin}set yMargin(t){this._constraint.yMargin=t}get leftMargin(){return this._constraint.leftMargin}set leftMargin(t){this._constraint.leftMargin=t}get rightMargin(){return this._constraint.rightMargin}set rightMargin(t){this._constraint.rightMargin=t}get topMargin(){return this._constraint.topMargin}set topMargin(t){this._constraint.topMargin=t}get bottomMargin(){return this._constraint.bottomMargin}set bottomMargin(t){this._constraint.bottomMargin=t}get minContentWidth(){return this._constraint.minContentWidth}set minContentWidth(t){this._constraint.minContentWidth=t}get minContentHeight(){return this._constraint.minContentHeight}set minContentHeight(t){this._constraint.minContentHeight=t}get maxContentWidth(){return this._constraint.maxContentWidth}set maxContentWidth(t){this._constraint.maxContentWidth=t}get maxContentHeight(){return this._constraint.maxContentHeight}set maxContentHeight(t){this._constraint.maxContentHeight=t}dispose(){this._constraint.lock(),this.childInsertedEmitter.removeListener(this.onChildInserted),this.childRemovedEmitter.removeListener(this.onChildRemoved),this.childrenReorderedEmitter.removeListener(this.onChildrenReordered),this.childrenChangedEmitter.removeListener(this.onChildrenChanged);for(const t of this._cellMap.values())t.dispose();super.dispose()}setOrientation(t){return this.orientation=t,this}getOrientation(){return this.orientation}setSpacing(t){return this.spacing=t,this}getSpacing(){return this.spacing}setAlign(t){return this.align=t,this}getAlign(){return this.align}setResize(t){return this.resize=t,this}isResize(){return this.resize}getHelperNode(){return MarginLayoutCell.createHelperNode(this.constraint.displayedCells,this.constraint.layoutBoundsProperty.value,s=>{let r="";const o=Orientation.fromLayoutOrientation(s.orientation);return r+=`align: ${LayoutAlign.internalToAlign(o,s.effectiveAlign)}
`,r+=`stretch: ${s.effectiveStretch}
`,r+=`grow: ${s.effectiveGrow}
`,r})}mutate(t){return super.mutate(t)}};Uu.DEFAULT_FLOW_BOX_OPTIONS=DEFAULT_OPTIONS$2;let FlowBox=Uu;FlowBox.prototype._mutatorKeys=[...SIZABLE_OPTION_KEYS,...FLOWBOX_OPTION_KEYS,...Node$2.prototype._mutatorKeys];scenery.register("FlowBox",FlowBox);const GRID_CONFIGURABLE_OPTION_KEYS=["xAlign","yAlign","stretch","xStretch","yStretch","grow","xGrow","yGrow"].concat(MARGIN_LAYOUT_CONFIGURABLE_OPTION_KEYS),GridConfigurable=memoize(a=>class extends MarginLayoutConfigurable(a){constructor(...s){super(...s),this._xAlign=null,this._yAlign=null,this._xStretch=null,this._yStretch=null,this._xGrow=null,this._yGrow=null}mutateConfigurable(s){super.mutateConfigurable(s),assertMutuallyExclusiveOptions(s,["stretch"],["xStretch","yStretch"]),assertMutuallyExclusiveOptions(s,["grow"],["xGrow","yGrow"]),mutate(this,GRID_CONFIGURABLE_OPTION_KEYS,s)}setConfigToBaseDefault(){this._xAlign=LayoutAlign.CENTER,this._yAlign=LayoutAlign.CENTER,this._xStretch=!1,this._yStretch=!1,this._xGrow=0,this._yGrow=0,super.setConfigToBaseDefault()}setConfigToInherit(){this._xAlign=null,this._yAlign=null,this._xStretch=null,this._yStretch=null,this._xGrow=null,this._yGrow=null,super.setConfigToInherit()}get xAlign(){const s=this._xAlign===null?null:this._xAlign.horizontal;return assert&&assert(s===null||typeof s=="string"),s}set xAlign(s){assert&&assert(s===null||HorizontalLayoutAlignValues.includes(s),`align ${s} not supported, the valid values are ${HorizontalLayoutAlignValues} or null`);const r=LayoutAlign.horizontalAlignToInternal(s);assert&&assert(r===null||r instanceof LayoutAlign),this._xAlign!==r&&(this._xAlign=r,this.changedEmitter.emit())}get yAlign(){const s=this._yAlign===null?null:this._yAlign.vertical;return assert&&assert(s===null||typeof s=="string"),s}set yAlign(s){assert&&assert(s===null||VerticalLayoutAlignValues.includes(s),`align ${s} not supported, the valid values are ${VerticalLayoutAlignValues} or null`);const r=LayoutAlign.verticalAlignToInternal(s);assert&&assert(r===null||r instanceof LayoutAlign),this._yAlign!==r&&(this._yAlign=r,this.changedEmitter.emit())}get grow(){return assert&&assert(this._xGrow===this._yGrow),this._xGrow}set grow(s){assert&&assert(s===null||typeof s=="number"&&isFinite(s)&&s>=0),(this._xGrow!==s||this._yGrow!==s)&&(this._xGrow=s,this._yGrow=s,this.changedEmitter.emit())}get xGrow(){return this._xGrow}set xGrow(s){assert&&assert(s===null||typeof s=="number"&&isFinite(s)&&s>=0),this._xGrow!==s&&(this._xGrow=s,this.changedEmitter.emit())}get yGrow(){return this._yGrow}set yGrow(s){assert&&assert(s===null||typeof s=="number"&&isFinite(s)&&s>=0),this._yGrow!==s&&(this._yGrow=s,this.changedEmitter.emit())}get stretch(){return assert&&assert(this._xStretch===this._yStretch),this._xStretch}set stretch(s){assert&&assert(s===null||typeof s=="boolean"),(this._xStretch!==s||this._yStretch!==s)&&(this._xStretch=s,this._yStretch=s,this.changedEmitter.emit())}get xStretch(){return this._xStretch}set xStretch(s){assert&&assert(s===null||typeof s=="boolean"),this._xStretch!==s&&(this._xStretch=s,this.changedEmitter.emit())}get yStretch(){return this._yStretch}set yStretch(s){assert&&assert(s===null||typeof s=="boolean"),this._yStretch!==s&&(this._yStretch=s,this.changedEmitter.emit())}});scenery.register("GridConfigurable",GridConfigurable);const GRID_CELL_KEYS=[...GRID_CONFIGURABLE_OPTION_KEYS,"row","column","horizontalSpan","verticalSpan"];class GridCell extends GridConfigurable(MarginLayoutCell){constructor(t,s,r){super(t,s,r),this.gridConstraint=t,this.setOptions(s.layoutOptions),this.onLayoutOptionsChange()}get effectiveXAlign(){return this._xAlign!==null?this._xAlign:this.gridConstraint._xAlign}get effectiveYAlign(){return this._yAlign!==null?this._yAlign:this.gridConstraint._yAlign}getEffectiveAlign(t){return t===Orientation.HORIZONTAL?this.effectiveXAlign:this.effectiveYAlign}get effectiveXGrow(){return this._xGrow!==null?this._xGrow:this.gridConstraint._xGrow}get effectiveYGrow(){return this._yGrow!==null?this._yGrow:this.gridConstraint._yGrow}getEffectiveGrow(t){return t===Orientation.HORIZONTAL?this.effectiveXGrow:this.effectiveYGrow}get effectiveXStretch(){return this._xStretch!==null?this._xStretch:this.gridConstraint._xStretch}get effectiveYStretch(){return this._yStretch!==null?this._yStretch:this.gridConstraint._yStretch}getEffectiveStretch(t){return t===Orientation.HORIZONTAL?this.effectiveXStretch:this.effectiveYStretch}onLayoutOptionsChange(){this.setOptions(this.node.layoutOptions),super.onLayoutOptionsChange()}setOptions(t){const s=optionize()({column:0,row:0,horizontalSpan:1,verticalSpan:1},t);assert&&Object.keys(s).forEach(r=>{assert&&assert(GRID_CELL_KEYS.includes(r),`Cannot provide key ${r} to a GridCell's layoutOptions. Perhaps this is a Flow-style layout option?`)}),assert&&assert(typeof s.column=="number"&&Number.isInteger(s.column)&&isFinite(s.column)&&s.column>=0),assert&&assert(typeof s.row=="number"&&Number.isInteger(s.row)&&isFinite(s.row)&&s.row>=0),assert&&assert(typeof s.horizontalSpan=="number"&&Number.isInteger(s.horizontalSpan)&&isFinite(s.horizontalSpan)&&s.horizontalSpan>=1),assert&&assert(typeof s.verticalSpan=="number"&&Number.isInteger(s.verticalSpan)&&isFinite(s.verticalSpan)&&s.verticalSpan>=1),this.setConfigToInherit(),this.position=new OrientationPair(s.column,s.row),this.size=new OrientationPair(s.horizontalSpan,s.verticalSpan),this.mutateConfigurable(s)}containsIndex(t,s){const r=this.position.get(t),o=this.size.get(t);return s>=r&&s<r+o}containsRow(t){return this.containsIndex(Orientation.VERTICAL,t)}containsColumn(t){return this.containsIndex(Orientation.HORIZONTAL,t)}getIndices(t){const s=this.position.get(t),r=this.size.get(t);return _.range(s,s+r)}}scenery.register("GridCell",GridCell);const Zl=class Zl extends LayoutLine{constructor(t,s,r){super(),this.initialize(t,s,r)}initialize(t,s,r){return this.index=t,this.cells=s,this.grow=r,this.initializeLayoutLine(),this}freeToPool(){Zl.pool.freeToPool(this)}clean(){this.cells.length=0,this.freeToPool()}};Zl.pool=new Pool(Zl,{defaultArguments:[0,[],0]});let GridLine=Zl;scenery.register("GridLine",GridLine);const GRID_CONSTRAINT_OPTION_KEYS=[...GRID_CONFIGURABLE_OPTION_KEYS,"excludeInvisible","spacing","xSpacing","ySpacing"];class GridConstraint extends GridConfigurable(NodeLayoutConstraint){constructor(t,s){super(t,s),this.cells=new Set,this.displayedCells=[],this.displayedLines=new OrientationPair(new Map,new Map),this._spacing=new OrientationPair(0,0),this.setConfigToBaseDefault(),this.mutateConfigurable(s),mutate(this,GRID_CONSTRAINT_OPTION_KEYS,s),this.changedEmitter.addListener(this._updateLayoutListener)}layout(){super.layout();const t=this.filterLayoutCells([...this.cells]);if(this.displayedCells=t,!t.length){this.layoutBoundsProperty.value=Bounds2.NOTHING,this.minimumWidthProperty.value=null,this.minimumHeightProperty.value=null,this.displayedLines.forEach(n=>n.clear());return}const s=new OrientationPair(0,0),r=new OrientationPair(this.preferredWidthProperty.value,this.preferredHeightProperty.value),o=new Bounds2(0,0,0,0);[Orientation.HORIZONTAL,Orientation.VERTICAL].forEach(n=>{const l=this._spacing.get(n),h=this.displayedLines.get(n);h.forEach(H=>H.clean()),h.clear();const d=_.sortedUniq(_.sortBy(_.flatten(t.map(H=>H.getIndices(n))))).map(H=>{const Y=_.filter(t,de=>de.containsIndex(n,H)),Q=Math.max(...Y.map(de=>de.getEffectiveGrow(n))),pe=GridLine.pool.create(H,Y,Q);return h.set(H,pe),pe}),A=d.slice(0,-1).map(H=>typeof l=="number"?l:l[H.index]);t.forEach(H=>{if(H.size.get(n)===1){const Y=h.get(H.position.get(n));if(Y.min=Math.max(Y.min,H.getMinimumSize(n)),Y.max=Math.min(Y.max,H.getMaximumSize(n)),H.getEffectiveAlign(n)===LayoutAlign.ORIGIN){const Q=H.getOriginBounds();Y.minOrigin=Math.min(Q[n.minCoordinate],Y.minOrigin),Y.maxOrigin=Math.max(Q[n.maxCoordinate],Y.maxOrigin)}}}),t.forEach(H=>{if(H.size.get(n)>1){assert&&assert(H.getEffectiveAlign(n)!==LayoutAlign.ORIGIN,"origin alignment cannot be specified for cells that span >1 width or height");const Y=H.getIndices(n).map(de=>h.get(de)),Q=_.sum(Y.map(de=>de.min)),pe=H.getMinimumSize(n);if(pe>Q){const de=(pe-Q)/Y.length;Y.forEach(fe=>{fe.min+=de})}}}),d.forEach(H=>{H.hasOrigin()?H.size=Math.max(H.min,H.maxOrigin-H.minOrigin):H.size=H.min});const S=_.sum(d.map(H=>H.size))+_.sum(A);s.set(n,S);const O=Math.max(S,r.get(n)||0);let I=O-S,W;for(;I>1e-7&&(W=d.filter(H=>H.grow>0&&H.size<H.max-1e-7)).length;){const H=_.sum(W.map(Q=>Q.grow)),Y=Math.min(Math.min(...W.map(Q=>(Q.max-Q.size)/Q.grow)),I/H);assert&&assert(Y>1e-11),W.forEach(Q=>{Q.size+=Y*Q.grow}),I-=Y*H}const L=(d[0].hasOrigin()?d[0].minOrigin:0)+this.layoutOriginProperty.value[n.coordinate];o[n.minCoordinate]=L,o[n.maxCoordinate]=L+O,d.forEach((H,Y)=>{const Q=_.sum(d.slice(0,Y).map(de=>de.size)),pe=_.sum(A.slice(0,Y));H.position=L+Q+pe}),t.forEach(H=>{const Y=H.position.get(n),Q=H.size.get(n),pe=Y+Q-1,de=H.getIndices(n).map(ne=>h.get(ne)),fe=h.get(Y);let ye=0;Y!==pe&&d.slice(0,-1).forEach((ne,Ke)=>{ne.index>=Y&&ne.index<pe&&(ye+=A[Ke])});const Ee=_.sum(de.map(ne=>ne.size))+ye,Le=fe.position,Z=H.reposition(n,Ee,Le,H.getEffectiveStretch(n),-fe.minOrigin,H.getEffectiveAlign(n));o[n.minCoordinate]=Math.min(o[n.minCoordinate],Z[n.minCoordinate]),o[n.maxCoordinate]=Math.max(o[n.maxCoordinate],Z[n.maxCoordinate])})}),this.layoutBoundsProperty.value=o,this.minimumWidthProperty.value=s.horizontal,this.minimumHeightProperty.value=s.vertical,this.finishedLayoutEmitter.emit()}get spacing(){return assert&&assert(this.xSpacing===this.ySpacing),this.xSpacing}set spacing(t){assert&&assert(typeof t=="number"&&isFinite(t)&&t>=0||Array.isArray(t)&&_.every(t,s=>typeof s=="number"&&isFinite(s)&&s>=0)),(this._spacing.get(Orientation.HORIZONTAL)!==t||this._spacing.get(Orientation.VERTICAL)!==t)&&(this._spacing.set(Orientation.HORIZONTAL,t),this._spacing.set(Orientation.VERTICAL,t),this.updateLayoutAutomatically())}get xSpacing(){return this._spacing.get(Orientation.HORIZONTAL)}set xSpacing(t){assert&&assert(typeof t=="number"&&isFinite(t)&&t>=0||Array.isArray(t)&&_.every(t,s=>typeof s=="number"&&isFinite(s)&&s>=0)),this._spacing.get(Orientation.HORIZONTAL)!==t&&(this._spacing.set(Orientation.HORIZONTAL,t),this.updateLayoutAutomatically())}get ySpacing(){return this._spacing.get(Orientation.VERTICAL)}set ySpacing(t){assert&&assert(typeof t=="number"&&isFinite(t)&&t>=0||Array.isArray(t)&&_.every(t,s=>typeof s=="number"&&isFinite(s)&&s>=0)),this._spacing.get(Orientation.VERTICAL)!==t&&(this._spacing.set(Orientation.VERTICAL,t),this.updateLayoutAutomatically())}addCell(t){assert&&assert(!this.cells.has(t)),this.cells.add(t),this.addNode(t.node),t.changedEmitter.addListener(this._updateLayoutListener),this.updateLayoutAutomatically()}removeCell(t){assert&&assert(this.cells.has(t)),this.cells.delete(t),this.removeNode(t.node),t.changedEmitter.removeListener(this._updateLayoutListener),this.updateLayoutAutomatically()}dispose(){this.lock(),[...this.cells].forEach(t=>this.removeCell(t)),this.displayedLines.forEach(t=>t.clear()),this.displayedCells=[],super.dispose(),this.unlock()}getIndices(t){const s=[];return this.cells.forEach(r=>{s.push(...r.getIndices(t))}),_.sortedUniq(_.sortBy(s))}getCell(t,s){return _.find([...this.cells],r=>r.containsRow(t)&&r.containsColumn(s))||null}getCellFromNode(t){return _.find([...this.cells],s=>s.node===t)||null}getCells(t,s){return _.filter([...this.cells],r=>r.containsIndex(t,s))}static create(t,s){return new GridConstraint(t,s)}}scenery.register("GridConstraint",GridConstraint);const GRIDBOX_OPTION_KEYS=[...LAYOUT_NODE_OPTION_KEYS,...GRID_CONSTRAINT_OPTION_KEYS.filter(a=>a!=="excludeInvisible"),"rows","columns","autoRows","autoColumns"];class GridBox extends LayoutNode{constructor(t){const s=optionize()({excludeInvisibleChildrenFromBounds:!0,resize:!0},t);super(),this._cellMap=new Map,this._autoRows=null,this._autoColumns=null,this._autoLockCount=0,this._constraint=new GridConstraint(this,{preferredWidthProperty:this.localPreferredWidthProperty,preferredHeightProperty:this.localPreferredHeightProperty,minimumWidthProperty:this.localMinimumWidthProperty,minimumHeightProperty:this.localMinimumHeightProperty,layoutOriginProperty:this.layoutOriginProperty,excludeInvisible:!1}),this.onChildInserted=this.onGridBoxChildInserted.bind(this),this.onChildRemoved=this.onGridBoxChildRemoved.bind(this),this.onChildVisibilityToggled=this.updateAllAutoLines.bind(this),this.childInsertedEmitter.addListener(this.onChildInserted),this.childRemovedEmitter.addListener(this.onChildRemoved);const r=_.omit(s,REQUIRES_BOUNDS_OPTION_KEYS),o=_.pick(s,REQUIRES_BOUNDS_OPTION_KEYS);this._constraint.lock(),this.mutate(r),this._constraint.unlock(),this._constraint.updateLayout(),this.mutate(o),this.linkLayoutBounds()}setLines(t,s){const r=[];for(let o=0;o<s.length;o++){const n=s[o];for(let l=0;l<n.length;l++){const h=n[l];h!==null&&(r.push(h),h.mutateLayoutOptions({[t.line]:o,[t.opposite.line]:l}))}}this.children=r}getLines(t){const s=[];for(const r of this._cellMap.values()){const o=r.position.get(t),n=r.position.get(t.opposite);for(;s.length<o+1;)s.push([]);for(;s[o].length<n+1;)s[o].push(null);s[o][n]=r.node}return s}set rows(t){this.setLines(Orientation.VERTICAL,t)}get rows(){return this.getLines(Orientation.VERTICAL)}set columns(t){this.setLines(Orientation.HORIZONTAL,t)}get columns(){return this.getLines(Orientation.HORIZONTAL)}getNodeAt(t,s){const r=this.constraint.getCell(t,s);return r?r.node:null}getRowOfNode(t){return assert&&assert(this.children.includes(t)),this.constraint.getCellFromNode(t).position.vertical}getColumnOfNode(t){return assert&&assert(this.children.includes(t)),this.constraint.getCellFromNode(t).position.horizontal}getNodesInRow(t){return this.constraint.getCells(Orientation.VERTICAL,t).map(s=>s.node)}getNodesInColumn(t){return this.constraint.getCells(Orientation.HORIZONTAL,t).map(s=>s.node)}addRow(t){return this.rows=[...this.rows,t],this}addColumn(t){return this.columns=[...this.columns,t],this}insertRow(t,s){return this.rows=[...this.rows.slice(0,t),s,...this.rows.slice(t)],this}insertColumn(t,s){return this.columns=[...this.columns.slice(0,t),s,...this.columns.slice(t)],this}removeRow(t){return this.rows=[...this.rows.slice(0,t),...this.rows.slice(t+1)],this}removeColumn(t){return this.columns=[...this.columns.slice(0,t),...this.columns.slice(t+1)],this}set autoRows(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)&&t>=1),this._autoRows!==t&&(this._autoRows=t,this.updateAutoRows())}get autoRows(){return this._autoRows}set autoColumns(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)&&t>=1),this._autoColumns!==t&&(this._autoColumns=t,this.updateAutoColumns())}get autoColumns(){return this._autoColumns}updateAutoLines(t,s){if(s!==null&&this._autoLockCount===0){let r=0;this.constraint.lock(),this.children.filter(o=>o.bounds.isValid()&&(!this._constraint.excludeInvisible||o.visible)).forEach((o,n)=>{const l=n%s,h=Math.floor(n/s);(!o.layoutOptions||o.layoutOptions[t.line]!==l||o.layoutOptions[t.opposite.line]!==h||o.layoutOptions.horizontalSpan!==1||o.layoutOptions.verticalSpan!==1)&&(r++,o.mutateLayoutOptions({[t.line]:n%s,[t.opposite.line]:Math.floor(n/s),horizontalSpan:1,verticalSpan:1}))}),this.constraint.unlock(),r>0&&this.constraint.updateLayoutAutomatically()}}updateAutoRows(){this.updateAutoLines(Orientation.VERTICAL,this.autoRows)}updateAutoColumns(){this.updateAutoLines(Orientation.HORIZONTAL,this.autoColumns)}updateAllAutoLines(){assert&&assert(this._autoRows===null||this._autoColumns===null,"autoRows and autoColumns should not both be set when updating children"),this.updateAutoRows(),this.updateAutoColumns()}setChildren(t){const s=this.getChildren();return this._autoLockCount++,super.setChildren(t),this._autoLockCount--,_.isEqual(s,t)||this.updateAllAutoLines(),this}onGridBoxChildInserted(t,s){t.visibleProperty.lazyLink(this.onChildVisibilityToggled);const r=new GridCell(this._constraint,t,this._constraint.createLayoutProxy(t));this._cellMap.set(t,r),this._constraint.addCell(r),this.updateAllAutoLines()}onGridBoxChildRemoved(t){const s=this._cellMap.get(t);assert&&assert(s),this._cellMap.delete(t),this._constraint.removeCell(s),s.dispose(),this.updateAllAutoLines(),t.visibleProperty.unlink(this.onChildVisibilityToggled)}mutate(t){return assertMutuallyExclusiveOptions(t,["rows"],["columns"],["children","autoRows","autoColumns"]),t&&assert&&assert(typeof t.autoRows!="number"||typeof t.autoColumns!="number","autoRows and autoColumns should not be specified both as non-null at the same time"),super.mutate(t)}get spacing(){return this._constraint.spacing}set spacing(t){this._constraint.spacing=t}get xSpacing(){return this._constraint.xSpacing}set xSpacing(t){this._constraint.xSpacing=t}get ySpacing(){return this._constraint.ySpacing}set ySpacing(t){this._constraint.ySpacing=t}get xAlign(){return this._constraint.xAlign}set xAlign(t){this._constraint.xAlign=t}get yAlign(){return this._constraint.yAlign}set yAlign(t){this._constraint.yAlign=t}get grow(){return this._constraint.grow}set grow(t){this._constraint.grow=t}get xGrow(){return this._constraint.xGrow}set xGrow(t){this._constraint.xGrow=t}get yGrow(){return this._constraint.yGrow}set yGrow(t){this._constraint.yGrow=t}get stretch(){return this._constraint.stretch}set stretch(t){this._constraint.stretch=t}get xStretch(){return this._constraint.xStretch}set xStretch(t){this._constraint.xStretch=t}get yStretch(){return this._constraint.yStretch}set yStretch(t){this._constraint.yStretch=t}get margin(){return this._constraint.margin}set margin(t){this._constraint.margin=t}get xMargin(){return this._constraint.xMargin}set xMargin(t){this._constraint.xMargin=t}get yMargin(){return this._constraint.yMargin}set yMargin(t){this._constraint.yMargin=t}get leftMargin(){return this._constraint.leftMargin}set leftMargin(t){this._constraint.leftMargin=t}get rightMargin(){return this._constraint.rightMargin}set rightMargin(t){this._constraint.rightMargin=t}get topMargin(){return this._constraint.topMargin}set topMargin(t){this._constraint.topMargin=t}get bottomMargin(){return this._constraint.bottomMargin}set bottomMargin(t){this._constraint.bottomMargin=t}get minContentWidth(){return this._constraint.minContentWidth}set minContentWidth(t){this._constraint.minContentWidth=t}get minContentHeight(){return this._constraint.minContentHeight}set minContentHeight(t){this._constraint.minContentHeight=t}get maxContentWidth(){return this._constraint.maxContentWidth}set maxContentWidth(t){this._constraint.maxContentWidth=t}get maxContentHeight(){return this._constraint.maxContentHeight}set maxContentHeight(t){this._constraint.maxContentHeight=t}setExcludeInvisibleChildrenFromBounds(t){super.setExcludeInvisibleChildrenFromBounds(t),this.updateAllAutoLines()}dispose(){this._constraint.lock(),this.childInsertedEmitter.removeListener(this.onChildInserted),this.childRemovedEmitter.removeListener(this.onChildRemoved);for(const t of this._cellMap.values())t.dispose(),t.node.visibleProperty.unlink(this.onChildVisibilityToggled);super.dispose()}getHelperNode(){return MarginLayoutCell.createHelperNode(this.constraint.displayedCells,this.constraint.layoutBoundsProperty.value,s=>{let r="";return r+=`row: ${s.position.vertical}
`,r+=`column: ${s.position.horizontal}
`,s.size.horizontal>1&&(r+=`horizontalSpan: ${s.size.horizontal}
`),s.size.vertical>1&&(r+=`verticalSpan: ${s.size.vertical}
`),r+=`xAlign: ${LayoutAlign.internalToAlign(Orientation.HORIZONTAL,s.effectiveXAlign)}
`,r+=`yAlign: ${LayoutAlign.internalToAlign(Orientation.VERTICAL,s.effectiveYAlign)}
`,r+=`xStretch: ${s.effectiveXStretch}
`,r+=`yStretch: ${s.effectiveYStretch}
`,r+=`xGrow: ${s.effectiveXGrow}
`,r+=`yGrow: ${s.effectiveYGrow}
`,r})}}GridBox.prototype._mutatorKeys=[...SIZABLE_OPTION_KEYS,...GRIDBOX_OPTION_KEYS,...Node$2.prototype._mutatorKeys];scenery.register("GridBox",GridBox);class GridBackgroundNode extends Node$2{constructor(t,s){assertMutuallyExclusiveOptions(s,["createCellBackground"],["fill","stroke"]);const r=n=>Rectangle.bounds(n.lastAvailableBounds,{fill:o.fill,stroke:o.stroke}),o=optionize()({fill:"white",stroke:"black",createCellBackground:r},s);super(),this.constraint=t,this.createCellBackground=o.createCellBackground,this.layoutListener=this.update.bind(this),this.constraint.finishedLayoutEmitter.addListener(this.layoutListener),this.update(),this.mutate(o)}update(){this.children=this.constraint.displayedCells.map(this.createCellBackground).filter(_.identity)}dispose(){this.constraint.finishedLayoutEmitter.removeListener(this.layoutListener),super.dispose()}}scenery.register("GridBackgroundNode",GridBackgroundNode);class ManualConstraint extends LayoutConstraint{constructor(t,s,r){assert&&assert(Array.isArray(s)&&_.every(s,o=>o instanceof Node$2)),super(t),this.lock(),this.nodes=s,this.cells=s.map(o=>new LayoutCell(this,o,null)),this.layoutCallback=r,this.nodes.forEach(o=>this.addNode(o,!1)),this.unlock(),this.updateLayout()}layout(){if(super.layout(),assert&&assert(_.every(this.nodes,s=>!s.isDisposed)),!_.some(this.cells,s=>!s.isConnected())){const s=this.cells.map(r=>r.proxy);this.layoutCallback.apply(null,s),this.finishedLayoutEmitter.emit()}}dispose(){this.cells.forEach(t=>t.dispose()),super.dispose()}static create(t,s,r){return new ManualConstraint(t,s,r)}}scenery.register("ManualConstraint",ManualConstraint);class RelaxedManualConstraint extends LayoutConstraint{constructor(t,s,r){assert&&assert(Array.isArray(s)&&_.every(s,o=>o instanceof Node$2)),super(t),this.lock(),this.nodes=s,this.cells=s.map(o=>new LayoutCell(this,o,null)),this.layoutCallback=r,this.nodes.forEach(o=>this.addNode(o,!1)),this.unlock(),this.updateLayout()}layout(){super.layout(),assert&&assert(_.every(this.nodes,s=>!s.isDisposed));const t=this.cells.map(s=>s.isConnected()?s.proxy:null);this.layoutCallback.apply(null,t),this.finishedLayoutEmitter.emit()}dispose(){this.cells.forEach(t=>t.dispose()),super.dispose()}static create(t,s,r){return new RelaxedManualConstraint(t,s,r)}}scenery.register("RelaxedManualConstraint",RelaxedManualConstraint);const ALIGNMENT_CONTAINER_OPTION_KEYS=["alignBounds","xAlign","yAlign","margin","xMargin","yMargin","leftMargin","rightMargin","topMargin","bottomMargin","group"],AlignBoxXAlignValues=["left","center","right","stretch"],AlignBoxYAlignValues=["top","center","bottom","stretch"],SuperType=Sizable(Node$2);class AlignBox extends SuperType{constructor(t,s){const r=optionize()({children:[t]},s),o={sizable:!1};super(o),this._xSet=!1,this._ySet=!1,this._contentBoundsListener=_.noop,assert&&assert(r===void 0||Object.getPrototypeOf(r)===Object.prototype,"Extra prototype on Node options object is a code smell"),this._content=t,this._alignBounds=null,this._xAlign="center",this._yAlign="center",this._leftMargin=0,this._rightMargin=0,this._topMargin=0,this._bottomMargin=0,this._group=null,this._contentBoundsListener=this.invalidateAlignment.bind(this),this._alignBoundsProperty=null,this._alignBoundsPropertyListener=_.noop,assertMutuallyExclusiveOptions(r,["alignBounds"],["alignBoundsProperty"]),s!=null&&s.alignBoundsProperty&&(this._alignBoundsProperty=s.alignBoundsProperty,r.alignBounds=this._alignBoundsProperty.value,this._alignBoundsPropertyListener=n=>{this.alignBounds=n},this._alignBoundsProperty.lazyLink(this._alignBoundsPropertyListener)),this.localBounds=new Bounds2(0,0,0,0),this.constraint=new AlignBoxConstraint(this,t),this._content.boundsProperty.link(this._contentBoundsListener),this.mutate(r),Multilink.multilink([this.localPreferredWidthProperty,this.localPreferredHeightProperty],(n,l)=>{if(n!==null||l!==null){const h=this._alignBounds||new Bounds2(0,0,0,0);n&&(h.minX=0,h.maxX=n,this._xSet=!0),l&&(h.minY=0,h.maxY=l,this._ySet=!0),this._alignBounds=h,this.constraint.updateLayout()}})}invalidateAlignment(){sceneryLog&&sceneryLog.AlignBox&&sceneryLog.AlignBox(`AlignBox#${this.id} invalidateAlignment`),sceneryLog&&sceneryLog.AlignBox&&sceneryLog.push(),this._group&&this._group.onAlignBoxResized(this),this.constraint.updateLayout(),sceneryLog&&sceneryLog.AlignBox&&sceneryLog.pop()}setAlignBounds(t){return assert&&assert(t===null||t instanceof Bounds2&&!t.isEmpty()&&t.isFinite(),"alignBounds should be a non-empty finite Bounds2"),this._xSet=!0,this._ySet=!0,this._alignBounds!==t&&(!t||!this._alignBounds||!t.equals(this._alignBounds))&&(this._alignBounds=t,this.constraint.updateLayout()),this}set alignBounds(t){this.setAlignBounds(t)}get alignBounds(){return this.getAlignBounds()}getAlignBounds(){return this._alignBounds}setGroup(t){return assert&&assert(t===null||t instanceof AlignGroup,"group should be an AlignGroup"),this._group!==t&&(this._group&&this._group.removeAlignBox(this),this._group=t,this._group&&this._group.addAlignBox(this)),this}set group(t){this.setGroup(t)}get group(){return this.getGroup()}getGroup(){return this._group}setXAlign(t){return assert&&assert(AlignBoxXAlignValues.includes(t),`xAlign should be one of: ${AlignBoxXAlignValues}`),this._xAlign!==t&&(this._xAlign=t,this.invalidateAlignment()),this}set xAlign(t){this.setXAlign(t)}get xAlign(){return this.getXAlign()}getXAlign(){return this._xAlign}setYAlign(t){return assert&&assert(AlignBoxYAlignValues.includes(t),`xAlign should be one of: ${AlignBoxYAlignValues}`),this._yAlign!==t&&(this._yAlign=t,this.invalidateAlignment()),this}set yAlign(t){this.setYAlign(t)}get yAlign(){return this.getYAlign()}getYAlign(){return this._yAlign}setMargin(t){return assert&&assert(isFinite(t)&&t>=0,"margin should be a finite non-negative number"),(this._leftMargin!==t||this._rightMargin!==t||this._topMargin!==t||this._bottomMargin!==t)&&(this._leftMargin=this._rightMargin=this._topMargin=this._bottomMargin=t,this.invalidateAlignment()),this}set margin(t){this.setMargin(t)}get margin(){return this.getMargin()}getMargin(){return assert&&assert(this._leftMargin===this._rightMargin&&this._leftMargin===this._topMargin&&this._leftMargin===this._bottomMargin,"Getting margin does not have a unique result if the left and right margins are different"),this._leftMargin}setXMargin(t){return assert&&assert(isFinite(t)&&t>=0,"xMargin should be a finite non-negative number"),(this._leftMargin!==t||this._rightMargin!==t)&&(this._leftMargin=this._rightMargin=t,this.invalidateAlignment()),this}set xMargin(t){this.setXMargin(t)}get xMargin(){return this.getXMargin()}getXMargin(){return assert&&assert(this._leftMargin===this._rightMargin,"Getting xMargin does not have a unique result if the left and right margins are different"),this._leftMargin}setYMargin(t){return assert&&assert(isFinite(t)&&t>=0,"yMargin should be a finite non-negative number"),(this._topMargin!==t||this._bottomMargin!==t)&&(this._topMargin=this._bottomMargin=t,this.invalidateAlignment()),this}set yMargin(t){this.setYMargin(t)}get yMargin(){return this.getYMargin()}getYMargin(){return assert&&assert(this._topMargin===this._bottomMargin,"Getting yMargin does not have a unique result if the top and bottom margins are different"),this._topMargin}setLeftMargin(t){return assert&&assert(isFinite(t)&&t>=0,"leftMargin should be a finite non-negative number"),this._leftMargin!==t&&(this._leftMargin=t,this.invalidateAlignment()),this}set leftMargin(t){this.setLeftMargin(t)}get leftMargin(){return this.getLeftMargin()}getLeftMargin(){return this._leftMargin}setRightMargin(t){return assert&&assert(isFinite(t)&&t>=0,"rightMargin should be a finite non-negative number"),this._rightMargin!==t&&(this._rightMargin=t,this.invalidateAlignment()),this}set rightMargin(t){this.setRightMargin(t)}get rightMargin(){return this.getRightMargin()}getRightMargin(){return this._rightMargin}setTopMargin(t){return assert&&assert(isFinite(t)&&t>=0,"topMargin should be a finite non-negative number"),this._topMargin!==t&&(this._topMargin=t,this.invalidateAlignment()),this}set topMargin(t){this.setTopMargin(t)}get topMargin(){return this.getTopMargin()}getTopMargin(){return this._topMargin}setBottomMargin(t){return assert&&assert(isFinite(t)&&t>=0,"bottomMargin should be a finite non-negative number"),this._bottomMargin!==t&&(this._bottomMargin=t,this.invalidateAlignment()),this}set bottomMargin(t){this.setBottomMargin(t)}get bottomMargin(){return this.getBottomMargin()}getBottomMargin(){return this._bottomMargin}getContent(){return this._content}get content(){return this.getContent()}getContentBounds(){sceneryLog&&sceneryLog.AlignBox&&sceneryLog.AlignBox(`AlignBox#${this.id} getContentBounds`),sceneryLog&&sceneryLog.AlignBox&&sceneryLog.push();const t=this._content.bounds;return sceneryLog&&sceneryLog.AlignBox&&sceneryLog.pop(),new Bounds2(t.left-this._leftMargin,t.top-this._topMargin,t.right+this._rightMargin,t.bottom+this._bottomMargin)}setAdjustedLocalBounds(t){if(this._xSet&&this._ySet)this.localBounds=t;else if(this._xSet){const s=this.getContentBounds();this.localBounds=new Bounds2(t.minX,s.minY,t.maxX,s.maxY)}else if(this._ySet){const s=this.getContentBounds();this.localBounds=new Bounds2(s.minX,t.minY,s.maxX,t.maxY)}else this.localBounds=this.getContentBounds()}dispose(){this._alignBoundsProperty&&this._alignBoundsProperty.unlink(this._alignBoundsPropertyListener),this._content.boundsProperty.unlink(this._contentBoundsListener),this._content=new Node$2,this.group=null,this.constraint.dispose(),super.dispose()}mutate(t){return super.mutate(t)}}class AlignBoxConstraint extends LayoutConstraint{constructor(t,s){super(t),this.alignBox=t,this.content=s,this.addNode(s),t.isWidthResizableProperty.lazyLink(this._updateLayoutListener),t.isHeightResizableProperty.lazyLink(this._updateLayoutListener)}updateProperty(t,s){const r=this.content[t],o=this.alignBox.localBounds[t]+s;Math.abs(r-o)>1e-5&&(this.content[t]=o)}layout(){super.layout();const t=this.alignBox,s=this.content;if(sceneryLog&&sceneryLog.AlignBox&&sceneryLog.AlignBox(`AlignBoxConstraint#${this.alignBox.id} layout`),sceneryLog&&sceneryLog.AlignBox&&sceneryLog.push(),!s.bounds.isValid())return;const r=t.leftMargin+t.rightMargin,o=t.topMargin+t.bottomMargin;if(t.alignBounds!==null)t.setAdjustedLocalBounds(t.alignBounds);else{const h=s.width+r,g=s.height+o;t.setAdjustedLocalBounds(new Bounds2(0,0,h,g))}const n=isFinite(s.width)?(isWidthSizable(s)?s.minimumWidth||0:s.width)+r:null,l=isFinite(s.height)?(isHeightSizable(s)?s.minimumHeight||0:s.height)+o:null;s.localBounds.isEmpty()||(t.xAlign==="center"?this.updateProperty("centerX",(t.leftMargin-t.rightMargin)/2):t.xAlign==="left"?this.updateProperty("left",t.leftMargin):t.xAlign==="right"?this.updateProperty("right",-t.rightMargin):t.xAlign==="stretch"?(assert&&assert(isWidthSizable(s),"xAlign:stretch can only be used if WidthSizable is mixed into the content"),s.preferredWidth=t.localWidth-t.leftMargin-t.rightMargin,this.updateProperty("left",t.leftMargin)):assert&&assert(`Bad xAlign: ${t.xAlign}`),t.yAlign==="center"?this.updateProperty("centerY",(t.topMargin-t.bottomMargin)/2):t.yAlign==="top"?this.updateProperty("top",t.topMargin):t.yAlign==="bottom"?this.updateProperty("bottom",-t.bottomMargin):t.yAlign==="stretch"?(assert&&assert(isHeightSizable(s),"yAlign:stretch can only be used if HeightSizable is mixed into the content"),s.preferredHeight=t.localHeight-t.topMargin-t.bottomMargin,this.updateProperty("top",t.topMargin)):assert&&assert(`Bad yAlign: ${t.yAlign}`)),sceneryLog&&sceneryLog.AlignBox&&sceneryLog.pop(),t.localMinimumWidth=t.widthSizable?n:t.localWidth,t.localMinimumHeight=t.heightSizable?l:t.localHeight}}AlignBox.prototype._mutatorKeys=ALIGNMENT_CONTAINER_OPTION_KEYS.concat(SuperType.prototype._mutatorKeys);scenery.register("AlignBox",AlignBox);let globalId$2=1;const DEFAULT_OPTIONS$1={matchHorizontal:!0,matchVertical:!0};class AlignGroup extends Disposable{constructor(t){assert&&assert(t===void 0||Object.getPrototypeOf(t)===Object.prototype,"Extra prototype on options object is a code smell");const s=optionize3()({},DEFAULT_OPTIONS$1,t);assert&&assert(typeof s.matchHorizontal=="boolean"),assert&&assert(typeof s.matchVertical=="boolean"),super(s),this._alignBoxes=[],this._matchHorizontal=s.matchHorizontal,this._matchVertical=s.matchVertical,this._resizeLock=!1,this._maxWidthProperty=new NumberProperty(0),this._maxHeightProperty=new NumberProperty(0),this.id=globalId$2++}getMaxWidth(){return this._maxWidthProperty.value}get maxWidth(){return this.getMaxWidth()}getMaxWidthProperty(){return this._maxWidthProperty}get maxWidthProperty(){return this.getMaxWidthProperty()}getMaxHeight(){return this._maxHeightProperty.value}get maxHeight(){return this.getMaxHeight()}getMaxHeightProperty(){return this._maxHeightProperty}get maxHeightProperty(){return this.getMaxHeightProperty()}getMaxSizeProperty(t){return t===Orientation.HORIZONTAL?this._maxWidthProperty:this._maxHeightProperty}createBox(t,s){return new AlignBox(t,combineOptions({group:this},s))}setMatchHorizontal(t){return this._matchHorizontal!==t&&(this._matchHorizontal=t,this.updateLayout()),this}set matchHorizontal(t){this.setMatchHorizontal(t)}get matchHorizontal(){return this.getMatchHorizontal()}getMatchHorizontal(){return this._matchHorizontal}setMatchVertical(t){return this._matchVertical!==t&&(this._matchVertical=t,this.updateLayout()),this}set matchVertical(t){this.setMatchVertical(t)}get matchVertical(){return this.getMatchVertical()}getMatchVertical(){return this._matchVertical}updateLayout(){if(this._resizeLock)return;this._resizeLock=!0,sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.AlignGroup(`AlignGroup#${this.id} updateLayout`),sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.push(),sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.AlignGroup("AlignGroup computing maximum dimension"),sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.push();let t=0,s=0;for(let r=0;r<this._alignBoxes.length;r++){const n=this._alignBoxes[r].getContentBounds();n.isEmpty()||!n.isFinite()||(t=Math.max(t,n.width),s=Math.max(s,n.height))}if(sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.pop(),sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.AlignGroup("AlignGroup applying to boxes"),sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.push(),this._maxWidthProperty.value=t,this._maxHeightProperty.value=s,t>0&&s>0)for(let r=0;r<this._alignBoxes.length;r++)this.setBoxBounds(this._alignBoxes[r],t,s);sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.pop(),sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.pop(),this._resizeLock=!1}setBoxBounds(t,s,r){let o;if(this._matchVertical&&this._matchHorizontal)o=new Bounds2(0,0,s,r);else{const n=t.getContentBounds();this._matchVertical?o=new Bounds2(0,0,isFinite(n.width)?n.width:s,r):this._matchHorizontal?o=new Bounds2(0,0,s,isFinite(n.height)?n.height:r):o=n}t.alignBounds=o}onAlignBoxResized(t){this.updateLayout()}addAlignBox(t){this._alignBoxes.push(t),this.updateLayout()}removeAlignBox(t){arrayRemove(this._alignBoxes,t),this.updateLayout()}dispose(){for(let t=this._alignBoxes.length-1;t>=0;t--)this._alignBoxes[t].dispose();super.dispose()}}scenery.register("AlignGroup",AlignGroup);class HBox extends FlowBox{constructor(t){assert&&assert(!t||!t.orientation,"HBox sets orientation"),super(optionize()({orientation:"horizontal"},t))}onFlowBoxChildInserted(t,s){assert&&assert(!(t instanceof HSeparator),"HSeparator should not be used in an HBox. Use VSeparator instead"),super.onFlowBoxChildInserted(t,s)}mutate(t){return super.mutate(t)}}scenery.register("HBox",HBox);class VBox extends FlowBox{constructor(t){assert&&assert(!t||!t.orientation,"VBox sets orientation"),super(optionize()({orientation:"vertical"},t))}onFlowBoxChildInserted(t,s){assert&&assert(!(t instanceof VSeparator),"VSeparator should not be used in an VBox. Use HSeparator instead"),super.onFlowBoxChildInserted(t,s)}mutate(t){return super.mutate(t)}}scenery.register("VBox",VBox);const isHimalayaElementNode=a=>a.type.toLowerCase()==="element",isHimalayaTextNode=a=>a.type.toLowerCase()==="text",RichTextUtils={scratchText:new Text(""),himalayaGetAttribute(a,t){if(!t)return null;const s=_.find(t.attributes,r=>r.key===a);return s&&s.value||null},himalayaStyleStringToMap(a){const t=a.split(";"),s={};return t.forEach(r=>{if(r.length>0){const o=r.split(":");assert&&assert(o.length===2,"too many colons"),s[o[0].trim()]=o[1].trim()}}),s}};scenery.register("RichTextUtils",RichTextUtils);const RichTextCleanable=memoize(a=>(assert&&assert(_.includes(inheritance(a),Node$2),"Only Node subtypes should mix Paintable"),class extends a{get isCleanable(){return!0}clean(){const s=this;for(let r=s._children.length-1;r>=0;r--){const o=s._children[r];o.isCleanable&&(s.removeChild(o),o.clean())}s.matrix=Matrix3.IDENTITY,s.freeToPool()}}));scenery.register("RichTextCleanable",RichTextCleanable);const Ql=class Ql extends RichTextCleanable(Node$2){constructor(t){super(),this.initialize(t)}initialize(t){return this.localBounds=new Bounds2(0,0,0,t),this}freeToPool(){Ql.pool.freeToPool(this)}};Ql.pool=new Pool(Ql);let RichTextVerticalSpacer=Ql;scenery.register("RichTextVerticalSpacer",RichTextVerticalSpacer);const Jl=class Jl extends RichTextCleanable(Node$2){constructor(t){super(),this.initialize(t)}initialize(t){return this.isLTR=t,this.leftSpacing=0,this.rightSpacing=0,this}addElement(t){const s=this.children.length>0,r=t.width>0,o=t.getScaleVector().x,n=t.leftSpacing*o,l=t.rightSpacing*o;if(!s&&!r)return sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText("No child or element, ignoring"),!1;if(s)if(!r)sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`No element, adding spacing, ltr:${this.isLTR}, spacing: ${n+l}`),this.isLTR?this.rightSpacing+=n+l:this.leftSpacing+=n+l;else return this.isLTR?(sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`LTR add ${this.rightSpacing} + ${n}`),t.left=this.localRight+this.rightSpacing+n,this.rightSpacing=l):(sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`RTL add ${this.leftSpacing} + ${l}`),t.right=this.localLeft-this.leftSpacing-l,this.leftSpacing=n),this.addChild(t),!0;else return sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`First child, ltr:${this.isLTR}, spacing: ${this.isLTR?l:n}`),this.isLTR?(t.left=0,this.leftSpacing=n,this.rightSpacing=l):(t.right=0,this.leftSpacing=n,this.rightSpacing=l),this.addChild(t),!0;return!1}addExtraBeforeSpacing(t){this.isLTR?this.leftSpacing+=t:this.rightSpacing+=t}freeToPool(){Jl.pool.freeToPool(this)}};Jl.pool=new Pool(Jl);let RichTextElement=Jl;scenery.register("RichTextElement",RichTextElement);const eh=class eh extends RichTextCleanable(Text){constructor(t,s,r,o,n,l,h){super(""),this.initialize(t,s,r,o,n,l,h)}initialize(t,s,r,o,n,l,h){let g="";for(;t.startsWith(" ");)g+=" ",t=t.slice(1);let d="";for(;t.endsWith(" ");)d=" ",t=t.slice(0,t.length-1);this.string=RichText.contentToString(t,s),this.boundsMethod=o,this.font=r,this.fill=n,this.stroke=l,this.lineWidth=h;const A=g.length?RichTextUtils.scratchText.setString(g).setFont(r).width:0,S=d.length?RichTextUtils.scratchText.setString(d).setFont(r).width:0;return this.leftSpacing=s?A:S,this.rightSpacing=s?S:A,this}clean(){super.clean(),this.fill=null,this.stroke=null}fitsIn(t,s,r){return this.width+(s?r?this.leftSpacing:this.rightSpacing:0)<=t}freeToPool(){eh.pool.freeToPool(this)}};eh.pool=new Pool(eh);let RichTextLeaf=eh;scenery.register("RichTextLeaf",RichTextLeaf);const th=class th extends RichTextCleanable(Node$2){constructor(t){super(),this.leftSpacing=0,this.rightSpacing=0,this.initialize(t)}initialize(t){return this.addChild(t),this}clean(){super.clean(),this.removeAllChildren()}fitsIn(t){return this.width<=t}freeToPool(){th.pool.freeToPool(this)}};th.pool=new Pool(th);let RichTextNode=th;scenery.register("RichTextNode",RichTextNode);const ih=class ih extends Voicing(RichTextCleanable(Node$2)){constructor(t,s){super(),this.fireListener=null,this.accessibleInputListener=null,this.allowLinksListener=null,this.initialize(t,s,!1),this.mutate({cursor:"pointer",tagName:"a"})}initialize(t,s,r=!0){return r&&super.initialize(),this.innerContent=t,this.voicingNameResponse=t,typeof s=="function"?(this.fireListener=new FireListener({fire:s,tandem:Tandem.OPT_OUT}),this.addInputListener(this.fireListener),this.setPDOMAttribute("href","#"),this.setPDOMAttribute("target","_self"),this.accessibleInputListener={click:o=>{o.domEvent&&o.domEvent.preventDefault(),s()}},this.addInputListener(this.accessibleInputListener)):(this.fireListener=new FireListener({fire:o=>{o.isFromPDOM()&&o.domEvent.preventDefault(),self._linkEventsHandled&&o.handle(),openPopup(s)},tandem:Tandem.OPT_OUT}),this.addInputListener(this.fireListener),this.setPDOMAttribute("href",s),this.setPDOMAttribute("target","_blank"),this.allowLinksListener=o=>{this.visible=o},allowLinksProperty.link(this.allowLinksListener)),this}clean(){super.clean(),this.fireListener&&(this.removeInputListener(this.fireListener),this.fireListener.dispose()),this.fireListener=null,this.accessibleInputListener&&(this.removeInputListener(this.accessibleInputListener),this.accessibleInputListener=null),this.allowLinksListener&&(allowLinksProperty.unlink(this.allowLinksListener),this.allowLinksListener=null)}freeToPool(){ih.pool.freeToPool(this)}};ih.pool=new Pool(ih);let RichTextLink=ih;scenery.register("RichTextLink",RichTextLink);const himalayaVar=himalaya;assert&&assert(himalayaVar,"himalaya dependency needed for RichText.");const RICH_TEXT_OPTION_KEYS=["boundsMethod","font","fill","stroke","lineWidth","subScale","subXSpacing","subYOffset","supScale","supXSpacing","supYOffset","capHeightScale","underlineLineWidth","underlineHeightScale","strikethroughLineWidth","strikethroughHeightScale","linkFill","linkEventsHandled","links","nodes","replaceNewlines","align","leading","lineWrap",Text.STRING_PROPERTY_NAME,"string"],isStringTest=window.QueryStringMachine&&QueryStringMachine.containsKey("stringTest"),DEFAULT_FONT$1=new Font({size:20}),ACCESSIBLE_TAGS=["b","strong","i","em","sub","sup","u","s"],LineBreakState={COMPLETE:"COMPLETE",INCOMPLETE:"INCOMPLETE",NONE:"NONE"},usedLinks=[],usedNodes=[],FONT_STYLE_MAP={"font-family":"family","font-size":"size","font-stretch":"stretch","font-style":"style","font-variant":"variant","font-weight":"weight","line-height":"lineHeight"},FONT_STYLE_KEYS=Object.keys(FONT_STYLE_MAP),STYLE_KEYS=["color"].concat(FONT_STYLE_KEYS),Gr=class Gr extends WidthSizable(Node$2){constructor(t,s){const r=optionize()({fill:"#000000",tandemNameSuffix:"Text",phetioType:Gr.RichTextIO,phetioVisiblePropertyInstrumented:!1},s);typeof t=="string"||typeof t=="number"?r.string=t:r.stringProperty=t,super(),this._font=DEFAULT_FONT$1,this._boundsMethod="hybrid",this._fill="#000000",this._stroke=null,this._lineWidth=1,this._subScale=.75,this._subXSpacing=0,this._subYOffset=0,this._supScale=.75,this._supXSpacing=0,this._supYOffset=0,this._capHeightScale=.75,this._underlineLineWidth=1,this._underlineHeightScale=.15,this._strikethroughLineWidth=1,this._strikethroughHeightScale=.3,this._linkFill="rgb(27,0,241)",this._linkEventsHandled=!1,this._links={},this._nodes={},this._replaceNewlines=!1,this._align="left",this._leading=0,this._lineWrap=null,this._linkItems=[],this._hasAddedLeafToLine=!1,this.needPendingMinimumWidth=!1,this.pendingMinimumWidth=0,this._stringProperty=new TinyForwardingProperty("",!0,this.onStringPropertyChange.bind(this)),this.lineContainer=new Node$2({}),this.addChild(this.lineContainer),this.rebuildRichText(),this.localPreferredWidthProperty.lazyLink(()=>this.rebuildRichText()),this.mutate(r)}onStringPropertyChange(){this.rebuildRichText()}setStringProperty(t){return this._stringProperty.setTargetProperty(t,this,Gr.STRING_PROPERTY_TANDEM_NAME)}set stringProperty(t){this.setStringProperty(t)}get stringProperty(){return this.getStringProperty()}getStringProperty(){return this._stringProperty}getPhetioMouseHitTarget(t=!1){return phetioElementSelectionProperty.value==="string"?this.getStringPropertyPhetioMouseHitTarget(t):super.getPhetioMouseHitTarget(t)}getStringPropertyPhetioMouseHitTarget(t=!1){const s=this._stringProperty.getTargetProperty();return s instanceof PhetioObject?s.getPhetioMouseHitTarget(t):"phetioNotSelectable"}initializePhetioObject(t,s){const r=optionize()({},s),o=this.isPhetioInstrumented();super.initializePhetioObject(t,r),Tandem.PHET_IO_ENABLED&&!o&&this.isPhetioInstrumented()&&this._stringProperty.initializePhetio(this,Gr.STRING_PROPERTY_TANDEM_NAME,()=>new StringProperty(this.string,combineOptions({phetioReadOnly:!0,tandem:this.tandem.createTandem(Gr.STRING_PROPERTY_TANDEM_NAME),phetioDocumentation:"Property for the displayed text"},r.stringPropertyOptions)))}rebuildRichText(){assert&&cleanArray(usedLinks),assert&&cleanArray(usedNodes);const t=this._lineWrap==="stretch";this.widthSizable=t,this.pendingMinimumWidth=0,this.needPendingMinimumWidth=t;const s=this._lineWrap==="stretch"?this.localPreferredWidth:this._lineWrap;if(this.freeChildrenToPool(),this.string===""){this.appendEmptyLeaf();return}sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`RichText#${this.id} rebuild`),sceneryLog&&sceneryLog.RichText&&sceneryLog.push();let r=this.string.replace(/\u202a/g,'<span dir="ltr">').replace(/\u202b/g,'<span dir="rtl">').replace(/\u202c/g,"</span>");this._replaceNewlines&&(r=r.replace(/\n/g,"<br>"));let o;try{o=himalayaVar.parse(r)}catch{o=himalayaVar.parse("INVALID TRANSLATION")}this._linkItems.length=0;const n=s===null?Number.POSITIVE_INFINITY:s,l=!0;let h=RichTextElement.pool.create(l);for(this._hasAddedLeafToLine=!1;o.length;){const g=o[0],d=h.bounds.isValid()?h.width:0,A=this.appendElement(h,g,this._font,this._fill,l,n-d,1);sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`lineBreakState: ${A}`),A!==LineBreakState.NONE&&(h.bounds.isValid()?(sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText("Adding line due to lineBreak"),this.appendLine(h)):this.appendLine(RichTextVerticalSpacer.pool.create(RichTextUtils.scratchText.setString("X").setFont(this._font).height)),h=RichTextElement.pool.create(l),this._hasAddedLeafToLine=!1),A!==LineBreakState.INCOMPLETE&&(sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText("Finished root element"),o.splice(0,1))}for(h.bounds.isValid()&&(sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText("Adding final line"),this.appendLine(h)),this.lineContainer.getChildrenCount()===0&&this.appendEmptyLeaf(),this.alignLines();this._linkItems.length;)(()=>{const g=this._linkItems[0].element,d=this._linkItems[0].href;let A;const S=[];for(A=this._linkItems.length-1;A>=0;A--){const I=this._linkItems[A];I.element===g&&(S.push(I.node),this._linkItems.splice(A,1))}const O=RichTextLink.pool.create(g.innerContent,d);for(this.lineContainer.addChild(O),A=0;A<S.length;A++){const I=S[A],W=I.getUniqueTrailTo(this.lineContainer).getMatrix();I.detach(),I.matrix=W,O.addChild(I)}})();this._linkItems.length=0,assert&&(this._links&&this._links!==!0&&Object.keys(this._links).forEach(g=>{assert&&allowLinksProperty.value&&!isStringTest&&assert(usedLinks.includes(g),`Unused RichText link: ${g}`)}),this._nodes&&Object.keys(this._nodes).forEach(g=>{assert&&allowLinksProperty.value&&!isStringTest&&assert(usedNodes.includes(g),`Unused RichText node: ${g}`)})),this.localMinimumWidth=t?this.pendingMinimumWidth:this.localBounds.width,sceneryLog&&sceneryLog.RichText&&sceneryLog.pop()}freeChildrenToPool(){for(;this.lineContainer._children.length;){const t=this.lineContainer._children[this.lineContainer._children.length-1];this.lineContainer.removeChild(t),t.clean()}}dispose(){this.freeChildrenToPool(),super.dispose(),this._stringProperty.dispose()}appendLine(t){this.lineContainer.bounds.isValid()&&(t.top=this.lineContainer.bottom+this._leading,t.left=0),this.lineContainer.addChild(t)}appendEmptyLeaf(){assert&&assert(this.lineContainer.getChildrenCount()===0),this.appendLine(RichTextLeaf.pool.create("",!0,this._font,this._boundsMethod,this._fill,this._stroke,this._lineWidth))}alignLines(){const t=this._align==="center"?"centerX":this._align,s=this.lineContainer[t];for(let r=0;r<this.lineContainer.getChildrenCount();r++)this.lineContainer.getChildAt(r)[t]=s}appendElement(t,s,r,o,n,l,h){let g=LineBreakState.NONE,d;const A=n?t.rightSpacing:t.leftSpacing,S=l-A;if(isHimalayaTextNode(s)){if(sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`appending leaf: ${s.content}`),sceneryLog&&sceneryLog.RichText&&sceneryLog.push(),d=RichTextLeaf.pool.create(s.content,n,r,this._boundsMethod,o,this._stroke,this._lineWidth),this.needPendingMinimumWidth&&(this.pendingMinimumWidth=Math.max(this.pendingMinimumWidth,Math.max(...getLineBreakRanges(s.content).map(O=>{const I=s.content.slice(O.min,O.max),W=RichTextLeaf.pool.create(I,n,r,this._boundsMethod,o,this._stroke,this._lineWidth),L=W.width*h;return W.dispose(),L})))),!d.fitsIn(S,this._hasAddedLeafToLine,n)){const O=getLineBreakRanges(s.content),I=W=>W.length===0?"":s.content.slice(W[0].min,W[W.length-1].max);if(sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`Overflow leafAdded:${this._hasAddedLeafToLine}, words: ${O.length}`),this._hasAddedLeafToLine||O.length>1){sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText("Skipping words");const W=[];let L=!1;for(W.unshift(O.pop());O.length;)if(d.clean(),d=RichTextLeaf.pool.create(I(O),n,r,this._boundsMethod,o,this._stroke,this._lineWidth),!d.fitsIn(S,this._hasAddedLeafToLine,n)&&(this._hasAddedLeafToLine||O.length>1))sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`Skipping word ${I([O[O.length-1]])}`),W.unshift(O.pop());else{sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`Success with ${I(O)}`),L=!0;break}if(L)g=LineBreakState.INCOMPLETE,s.content=I(W),sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`Remaining content: ${s.content}`);else return d.clean(),LineBreakState.INCOMPLETE}}this._hasAddedLeafToLine=!0,sceneryLog&&sceneryLog.RichText&&sceneryLog.pop()}else if(isHimalayaElementNode(s)){if(s.tagName==="br")return sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText("manual line break"),LineBreakState.COMPLETE;if(s.tagName==="span"){const W=RichTextUtils.himalayaGetAttribute("dir",s);W&&(assert&&assert(W==="ltr"||W==="rtl","Span dir attributes should be ltr or rtl."),n=W==="ltr")}if(s.tagName==="node"){const W=RichTextUtils.himalayaGetAttribute("id",s),L=W&&this._nodes[W]||null;if(assert&&assert(L,W?`Could not find a matching item in RichText's nodes for ${W}. It should be provided in the nodes option`:"No id attribute provided for a given <node> element"),L){if(assert&&usedNodes.push(W),d=RichTextNode.pool.create(L),this._hasAddedLeafToLine&&!d.fitsIn(S))return d.clean(),LineBreakState.INCOMPLETE;const H=RichTextUtils.himalayaGetAttribute("align",s);if(H==="center"||H==="top"||H==="bottom"){const Y=RichTextUtils.scratchText.setString("Test").setFont(r).bounds;H==="center"?d.centerY=Y.centerY:H==="top"?d.top=Y.top:H==="bottom"&&(d.bottom=Y.bottom)}}else return g;this._hasAddedLeafToLine=!0}else d=RichTextElement.pool.create(n);sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText("appending element"),sceneryLog&&sceneryLog.RichText&&sceneryLog.push();const O=RichTextUtils.himalayaGetAttribute("style",s);if(O){const W=RichTextUtils.himalayaStyleStringToMap(O);assert&&Object.keys(W).forEach(H=>{assert(_.includes(STYLE_KEYS,H),"See supported style CSS keys")}),W.color&&(o=new Color(W.color));const L={};for(let H=0;H<FONT_STYLE_KEYS.length;H++){const Y=FONT_STYLE_KEYS[H];W[Y]&&(L[FONT_STYLE_MAP[Y]]=W[Y])}r=(typeof r=="string"?Font.fromCSS(r):r).copy(L)}if(s.tagName==="a"){let W=RichTextUtils.himalayaGetAttribute("href",s);const L=W;if(W!==null&&this._links!==!0)if(W.startsWith("{{")&&W.indexOf("}}")===W.length-2){const H=W.slice(2,-2);W=this._links[H],assert&&usedLinks.push(H)}else W=null;assert&&assert(W,`Could not find a matching item in RichText's links for ${L}. It should be provided in the links option, or links should be turned to true (to allow the string to create its own urls`),W&&(this._linkFill!==null&&(o=this._linkFill),s.innerContent||(s.innerContent=Gr.himalayaElementToAccessibleString(s,n)),this._linkItems.push({element:s,node:d,href:W}))}else s.tagName==="b"||s.tagName==="strong"?r=(typeof r=="string"?Font.fromCSS(r):r).copy({weight:"bold"}):s.tagName==="i"||s.tagName==="em"?r=(typeof r=="string"?Font.fromCSS(r):r).copy({style:"italic"}):s.tagName==="sub"?(d.scale(this._subScale),d.addExtraBeforeSpacing(this._subXSpacing),d.y+=this._subYOffset):s.tagName==="sup"&&(d.scale(this._supScale),d.addExtraBeforeSpacing(this._supXSpacing),d.y+=this._supYOffset);const I=d.getScaleVector().x;if(s.tagName!=="node"){for(;g===LineBreakState.NONE&&s.children.length;){const W=d.bounds.isValid()?d.width:0,L=s.children[0];g=this.appendElement(d,L,r,o,n,l/I,h*I),g!==LineBreakState.INCOMPLETE&&s.children.splice(0,1);const H=d.bounds.isValid()?d.width:0;l+=W-H}g===LineBreakState.COMPLETE&&s.children.length&&(g=LineBreakState.INCOMPLETE)}if(s.tagName==="sub")isFinite(d.height)&&(d.centerY=0);else if(s.tagName==="sup")isFinite(d.height)&&(d.centerY=RichTextUtils.scratchText.setString("X").setFont(r).top*this._capHeightScale);else if(s.tagName==="u"){const W=-d.top*this._underlineHeightScale;isFinite(d.top)&&d.addChild(new Line(d.localLeft,W,d.localRight,W,{stroke:o,lineWidth:this._underlineLineWidth}))}else if(s.tagName==="s"){const W=d.top*this._strikethroughHeightScale;isFinite(d.top)&&d.addChild(new Line(d.localLeft,W,d.localRight,W,{stroke:o,lineWidth:this._strikethroughLineWidth}))}sceneryLog&&sceneryLog.RichText&&sceneryLog.pop()}return d&&(t.addElement(d)||(this._linkItems=this._linkItems.filter(I=>I.node!==d),d.clean())),g}setString(t){return assert&&assert(t!=null,"String should be defined and non-null. Use the empty string if needed."),t=`${t}`,this._stringProperty.set(t),this}set string(t){this.setString(t)}get string(){return this.getString()}getString(){return this._stringProperty.value}setBoundsMethod(t){return assert&&assert(t==="fast"||t==="fastCanvas"||t==="accurate"||t==="hybrid","Unknown Text boundsMethod"),t!==this._boundsMethod&&(this._boundsMethod=t,this.rebuildRichText()),this}set boundsMethod(t){this.setBoundsMethod(t)}get boundsMethod(){return this.getBoundsMethod()}getBoundsMethod(){return this._boundsMethod}setFont(t){return this._font!==t&&(this._font=t,this.rebuildRichText()),this}set font(t){this.setFont(t)}get font(){return this.getFont()}getFont(){return this._font}setFill(t){return this._fill!==t&&(this._fill=t,this.rebuildRichText()),this}set fill(t){this.setFill(t)}get fill(){return this.getFill()}getFill(){return this._fill}setStroke(t){return this._stroke!==t&&(this._stroke=t,this.rebuildRichText()),this}set stroke(t){this.setStroke(t)}get stroke(){return this.getStroke()}getStroke(){return this._stroke}setLineWidth(t){return this._lineWidth!==t&&(this._lineWidth=t,this.rebuildRichText()),this}set lineWidth(t){this.setLineWidth(t)}get lineWidth(){return this.getLineWidth()}getLineWidth(){return this._lineWidth}setSubScale(t){return assert&&assert(isFinite(t)&&t>0),this._subScale!==t&&(this._subScale=t,this.rebuildRichText()),this}set subScale(t){this.setSubScale(t)}get subScale(){return this.getSubScale()}getSubScale(){return this._subScale}setSubXSpacing(t){return assert&&assert(isFinite(t)),this._subXSpacing!==t&&(this._subXSpacing=t,this.rebuildRichText()),this}set subXSpacing(t){this.setSubXSpacing(t)}get subXSpacing(){return this.getSubXSpacing()}getSubXSpacing(){return this._subXSpacing}setSubYOffset(t){return assert&&assert(isFinite(t)),this._subYOffset!==t&&(this._subYOffset=t,this.rebuildRichText()),this}set subYOffset(t){this.setSubYOffset(t)}get subYOffset(){return this.getSubYOffset()}getSubYOffset(){return this._subYOffset}setSupScale(t){return assert&&assert(isFinite(t)&&t>0),this._supScale!==t&&(this._supScale=t,this.rebuildRichText()),this}set supScale(t){this.setSupScale(t)}get supScale(){return this.getSupScale()}getSupScale(){return this._supScale}setSupXSpacing(t){return assert&&assert(isFinite(t)),this._supXSpacing!==t&&(this._supXSpacing=t,this.rebuildRichText()),this}set supXSpacing(t){this.setSupXSpacing(t)}get supXSpacing(){return this.getSupXSpacing()}getSupXSpacing(){return this._supXSpacing}setSupYOffset(t){return assert&&assert(isFinite(t)),this._supYOffset!==t&&(this._supYOffset=t,this.rebuildRichText()),this}set supYOffset(t){this.setSupYOffset(t)}get supYOffset(){return this.getSupYOffset()}getSupYOffset(){return this._supYOffset}setCapHeightScale(t){return assert&&assert(isFinite(t)&&t>0),this._capHeightScale!==t&&(this._capHeightScale=t,this.rebuildRichText()),this}set capHeightScale(t){this.setCapHeightScale(t)}get capHeightScale(){return this.getCapHeightScale()}getCapHeightScale(){return this._capHeightScale}setUnderlineLineWidth(t){return assert&&assert(isFinite(t)&&t>0),this._underlineLineWidth!==t&&(this._underlineLineWidth=t,this.rebuildRichText()),this}set underlineLineWidth(t){this.setUnderlineLineWidth(t)}get underlineLineWidth(){return this.getUnderlineLineWidth()}getUnderlineLineWidth(){return this._underlineLineWidth}setUnderlineHeightScale(t){return assert&&assert(isFinite(t)&&t>0),this._underlineHeightScale!==t&&(this._underlineHeightScale=t,this.rebuildRichText()),this}set underlineHeightScale(t){this.setUnderlineHeightScale(t)}get underlineHeightScale(){return this.getUnderlineHeightScale()}getUnderlineHeightScale(){return this._underlineHeightScale}setStrikethroughLineWidth(t){return assert&&assert(isFinite(t)&&t>0),this._strikethroughLineWidth!==t&&(this._strikethroughLineWidth=t,this.rebuildRichText()),this}set strikethroughLineWidth(t){this.setStrikethroughLineWidth(t)}get strikethroughLineWidth(){return this.getStrikethroughLineWidth()}getStrikethroughLineWidth(){return this._strikethroughLineWidth}setStrikethroughHeightScale(t){return assert&&assert(isFinite(t)&&t>0),this._strikethroughHeightScale!==t&&(this._strikethroughHeightScale=t,this.rebuildRichText()),this}set strikethroughHeightScale(t){this.setStrikethroughHeightScale(t)}get strikethroughHeightScale(){return this.getStrikethroughHeightScale()}getStrikethroughHeightScale(){return this._strikethroughHeightScale}setLinkFill(t){return this._linkFill!==t&&(this._linkFill=t,this.rebuildRichText()),this}set linkFill(t){this.setLinkFill(t)}get linkFill(){return this.getLinkFill()}getLinkFill(){return this._linkFill}setLinkEventsHandled(t){return this._linkEventsHandled!==t&&(this._linkEventsHandled=t,this.rebuildRichText()),this}set linkEventsHandled(t){this.setLinkEventsHandled(t)}get linkEventsHandled(){return this.getLinkEventsHandled()}getLinkEventsHandled(){return this._linkEventsHandled}setLinks(t){return assert&&assert(t===!0||Object.getPrototypeOf(t)===Object.prototype),this._links!==t&&(this._links=t,this.rebuildRichText()),this}getLinks(){return this._links}set links(t){this.setLinks(t)}get links(){return this.getLinks()}setNodes(t){return assert&&assert(Object.getPrototypeOf(t)===Object.prototype),this._nodes!==t&&(this._nodes=t,this.rebuildRichText()),this}getNodes(){return this._nodes}set nodes(t){this.setNodes(t)}get nodes(){return this.getNodes()}setReplaceNewlines(t){return this._replaceNewlines!==t&&(this._replaceNewlines=t,this.rebuildRichText()),this}set replaceNewlines(t){this.setReplaceNewlines(t)}get replaceNewlines(){return this.getReplaceNewlines()}getReplaceNewlines(){return this._replaceNewlines}setAlign(t){return assert&&assert(t==="left"||t==="center"||t==="right"),this._align!==t&&(this._align=t,this.rebuildRichText()),this}set align(t){this.setAlign(t)}get align(){return this.getAlign()}getAlign(){return this._align}setLeading(t){return assert&&assert(isFinite(t)),this._leading!==t&&(this._leading=t,this.rebuildRichText()),this}set leading(t){this.setLeading(t)}get leading(){return this.getLeading()}getLeading(){return this._leading}setLineWrap(t){return assert&&assert(t===null||t==="stretch"||isFinite(t)&&t>0),this._lineWrap!==t&&(this._lineWrap=t,this.rebuildRichText()),this}set lineWrap(t){this.setLineWrap(t)}get lineWrap(){return this.getLineWrap()}getLineWrap(){return this._lineWrap}mutate(t){return assert&&t&&t.hasOwnProperty("string")&&t.hasOwnProperty(Text.STRING_PROPERTY_NAME)&&t.stringProperty&&assert&&assert(t.stringProperty.value===t.string,"If both string and stringProperty are provided, then values should match"),super.mutate(t)}static stringWithFont(t,s){return`<span style='font-style: ${s.style};font-variant: ${s.variant};font-weight: ${s.weight};font-stretch: ${s.stretch};font-size: ${s.size};font-family: ${s.family};line-height: ${s.lineHeight};'>${t}</span>`}static himalayaElementToString(t,s){if(isHimalayaTextNode(t))return Gr.contentToString(t.content,s);if(isHimalayaElementNode(t)){const r=RichTextUtils.himalayaGetAttribute("dir",t);return t.tagName==="span"&&r&&(s=r==="ltr"),t.children.map(o=>Gr.himalayaElementToString(o,s)).join("")}else return""}static himalayaElementToAccessibleString(t,s){if(isHimalayaTextNode(t))return Gr.contentToString(t.content,s);if(isHimalayaElementNode(t)){const r=RichTextUtils.himalayaGetAttribute("dir",t);t.tagName==="span"&&r&&(s=r==="ltr");const o=t.children.map(n=>Gr.himalayaElementToAccessibleString(n,s)).join("");return _.includes(ACCESSIBLE_TAGS,t.tagName)?`<${t.tagName}>${o}</${t.tagName}>`:o}else return""}static contentToString(t,s){const r=he.decode(t);return s?`‪${r}‬`:`‫${r}‬`}};Gr.STRING_PROPERTY_TANDEM_NAME=Text.STRING_PROPERTY_TANDEM_NAME;let RichText=Gr;RichText.prototype._mutatorKeys=RICH_TEXT_OPTION_KEYS.concat(Node$2.prototype._mutatorKeys);scenery.register("RichText",RichText);RichText.RichTextIO=new IOType("RichTextIO",{valueType:RichText,supertype:Node$2.NodeIO,documentation:"The PhET-iO Type for the scenery RichText node"});class VoicingText extends ReadingBlock(Text){constructor(t,s){const r=optionize()({readingBlockNameResponse:t,tagName:"p",innerContent:t},s);super(t),this.focusHighlight=new ReadingBlockHighlight(this),this.mutate(r)}}scenery.register("VoicingText",VoicingText);class VoicingRichText extends ReadingBlock(RichText){constructor(t,s){const r=optionize()({readingBlockNameResponse:t,innerContent:t,readingBlockTagName:"button"},s);super(t,r),this.focusHighlight=new ReadingBlockHighlight(this)}}scenery.register("VoicingRichText",VoicingRichText);const scenerySerialize=a=>{if(a instanceof Vector2)return{type:"Vector2",x:a.x,y:a.y};if(a instanceof Matrix3)return{type:"Matrix3",m00:a.m00(),m01:a.m01(),m02:a.m02(),m10:a.m10(),m11:a.m11(),m12:a.m12(),m20:a.m20(),m21:a.m21(),m22:a.m22()};if(a instanceof Bounds2){const t=a;return{type:"Bounds2",maxX:t.maxX,maxY:t.maxY,minX:t.minX,minY:t.minY}}else{if(a instanceof Shape$1)return{type:"Shape",path:a.getSVGPath()};if(Array.isArray(a))return{type:"Array",value:a.map(scenerySerialize)};if(a instanceof Color)return{type:"Color",red:a.red,green:a.green,blue:a.blue,alpha:a.alpha};if(a instanceof ReadOnlyProperty)return{type:"Property",value:scenerySerialize(a.value)};if(a instanceof TinyProperty)return{type:"TinyProperty",value:scenerySerialize(a.value)};if(Paint&&a instanceof Paint){const t={};return a.transformMatrix&&(t.transformMatrix=scenerySerialize(a.transformMatrix)),Gradient&&(a instanceof RadialGradient||a instanceof LinearGradient)&&(t.stops=a.stops.map(s=>({ratio:s.ratio,stop:scenerySerialize(s.color)})),t.start=scenerySerialize(a.start),t.end=scenerySerialize(a.end),LinearGradient&&a instanceof LinearGradient?t.type="LinearGradient":RadialGradient&&a instanceof RadialGradient&&(t.type="RadialGradient",t.startRadius=a.startRadius,t.endRadius=a.endRadius)),Pattern&&a instanceof Pattern&&(t.type="Pattern",t.url=a.image.src),t}else if(a instanceof Node$2){const t=a,s={},r={};["visible","opacity","disabledOpacity","pickable","inputEnabled","cursor","transformBounds","renderer","usesOpacity","layerSplit","cssTransform","excludeInvisible","webglScale","preventFit"].forEach(n=>{t[n]!==Node$2.DEFAULT_NODE_OPTIONS[n]&&(s[n]=t[n])}),["tagName","innerContent","accessibleName","helpText"].forEach(n=>{t[n]!==null&&(s[n]=t[n])}),["maxWidth","maxHeight","clipArea","mouseArea","touchArea"].forEach(n=>{t[n]!==Node$2.DEFAULT_NODE_OPTIONS[n]&&(r[n]=scenerySerialize(t[n]))}),t.matrix.isIdentity()||(r.matrix=scenerySerialize(t.matrix)),t._localBoundsOverridden&&(r.localBounds=scenerySerialize(t.localBounds)),r.children=t.children.map(n=>n.id),r.hasInputListeners=t.inputListeners.length>0;const o={id:t.id,type:"Node",types:inheritance(t.constructor).map(n=>n.name).filter(n=>n&&n!=="Object"&&n!=="Node"),name:t.constructor.name,options:s,setup:r};if(Path&&t instanceof Path&&(o.type="Path",r.path=scenerySerialize(t.shape),t.boundsMethod!==Path.DEFAULT_PATH_OPTIONS.boundsMethod&&(s.boundsMethod=t.boundsMethod)),Circle&&t instanceof Circle&&(o.type="Circle",s.radius=t.radius),Line&&t instanceof Line&&(o.type="Line",s.x1=t.x1,s.y1=t.y1,s.x2=t.x2,s.y2=t.y2),Rectangle&&t instanceof Rectangle&&(o.type="Rectangle",s.rectX=t.rectX,s.rectY=t.rectY,s.rectWidth=t.rectWidth,s.rectHeight=t.rectHeight,s.cornerXRadius=t.cornerXRadius,s.cornerYRadius=t.cornerYRadius),Text&&t instanceof Text&&(o.type="Text",t.boundsMethod!=="hybrid"&&(s.boundsMethod=t.boundsMethod),s.string=t.string,s.font=t.font),Image$1&&t instanceof Image$1&&(o.type="Image",["imageOpacity","initialWidth","initialHeight","mipmapBias","mipmapInitialLevel","mipmapMaxLevel"].forEach(n=>{t[n]!==Image$1.DEFAULT_IMAGE_OPTIONS[n]&&(s[n]=t[n])}),r.width=t.imageWidth,r.height=t.imageHeight,t._mipmapData?(r.imageType="mipmapData",r.mipmapData=t._mipmapData.map(n=>({url:n.url,width:n.width,height:n.height}))):(t._mipmap&&(r.generateMipmaps=!0),t._image instanceof HTMLImageElement?(r.imageType="image",r.src=t._image.src):t._image instanceof HTMLCanvasElement&&(r.imageType="canvas",r.src=t._image.toDataURL()))),CanvasNode&&t instanceof CanvasNode||WebGLNode&&t instanceof WebGLNode){o.type=CanvasNode&&t instanceof CanvasNode?"CanvasNode":"WebGLNode",r.canvasBounds=scenerySerialize(t.canvasBounds);const n=1,l=document.createElement("canvas");l.width=Math.ceil(t.canvasBounds.width*n),l.height=Math.ceil(t.canvasBounds.height*n);const h=l.getContext("2d"),g=new CanvasContextWrapper(l,h),d=Matrix3.scale(1/n);g.context.setTransform(n,0,0,n,-t.canvasBounds.left,-t.canvasBounds.top),t.renderToCanvasSelf(g,d),r.url=l.toDataURL(),r.scale=n,r.offset=scenerySerialize(t.canvasBounds.leftTop)}return DOM&&t instanceof DOM&&(o.type="DOM",o.element=new window.XMLSerializer().serializeToString(t.element),t.element instanceof window.HTMLCanvasElement&&(o.dataURL=t.element.toDataURL()),s.preventTransform=t.preventTransform),(Path&&t instanceof Path||Text&&t instanceof Text)&&(["fillPickable","strokePickable","lineWidth","lineCap","lineJoin","lineDashOffset","miterLimit"].forEach(n=>{t[n]!==DEFAULT_OPTIONS$6[n]&&(s[n]=t[n])}),t.fill!==DEFAULT_OPTIONS$6.fill&&(r.fill=scenerySerialize(t.fill)),t.stroke!==DEFAULT_OPTIONS$6.stroke&&(r.stroke=scenerySerialize(t.stroke)),t.lineDash.length&&(r.lineDash=scenerySerialize(t.lineDash))),o}else return a instanceof Display?{type:"Display",width:a.width,height:a.height,backgroundColor:scenerySerialize(a.backgroundColor),tree:{type:"Subtree",rootNodeId:a.rootNode.id,nodes:serializeConnectedNodes(a.rootNode)}}:{type:"value",value:a}}},serializeConnectedNodes=a=>a.getSubtreeNodes().map(scenerySerialize);scenery.register("scenerySerialize",scenerySerialize);const sceneryDeserialize=a=>{const t=["Node","Path","Circle","Line","Rectangle","Text","Image","CanvasNode","WebGLNode","DOM"];if(a.type==="Vector2")return new Vector2(a.x,a.y);if(a.type==="Matrix3")return new Matrix3().rowMajor(a.m00,a.m01,a.m02,a.m10,a.m11,a.m12,a.m20,a.m21,a.m22);if(a.type==="Bounds2")return new Bounds2(a.minX,a.minY,a.maxX,a.maxY);if(a.type==="Shape")return new Shape$1(a.path);if(a.type==="Array")return a.value.map(sceneryDeserialize);if(a.type==="Color")return new Color(a.red,a.green,a.blue,a.alpha);if(a.type==="Property")return new Property(sceneryDeserialize(a.value));if(a.type==="TinyProperty")return new TinyProperty(sceneryDeserialize(a.value));if(a.type==="Pattern"||a.type==="LinearGradient"||a.type==="RadialGradient"){let s;if(a.type==="Pattern"){const r=new window.Image;r.src=a.url,s=new Pattern(r)}else{const r=sceneryDeserialize(a.start),o=sceneryDeserialize(a.end);a.type==="LinearGradient"?s=new LinearGradient(r.x,r.y,o.x,o.y):a.type==="RadialGradient"&&(s=new RadialGradient(r.x,r.y,a.startRadius,o.x,o.y,a.endRadius)),a.stops.forEach(n=>{s.addColorStop(n.ratio,sceneryDeserialize(n.stop))})}return a.transformMatrix&&s.setTransformMatrix(sceneryDeserialize(a.transformMatrix)),s}else if(_.includes(t,a.type)){let s;const r=a.setup;if(a.type==="Node")s=new Node$2;else if(a.type==="Path")s=new Path(sceneryDeserialize(r.path));else if(a.type==="Circle")s=new Circle({});else if(a.type==="Line")s=new Line({});else if(a.type==="Rectangle")s=new Rectangle({});else if(a.type==="Text")s=new Text("");else if(a.type==="Image"){if(r.imageType==="image"||r.imageType==="canvas")s=new Image$1(r.src),r.generateMipmaps&&(s.mipmap=!0);else if(r.imageType==="mipmapData"){const o=r.mipmapData.map(n=>{const l={width:n.width,height:n.height,url:n.url};l.img=new window.Image,l.img.src=n.url,l.canvas=document.createElement("canvas"),l.canvas.width=n.width,l.canvas.height=n.height;const h=l.canvas.getContext("2d");return l.updateCanvas=function(){l.img.complete&&(typeof l.img.naturalWidth>"u"||l.img.naturalWidth>0)&&(h.drawImage(l.img,0,0),delete l.updateCanvas)},l});s=new Image$1(o)}s.initialWidth=r.width,s.initialHeight=r.height}else if(a.type==="CanvasNode"||a.type==="WebGLNode")s=new Node$2({children:[new Image$1(r.url,{translation:sceneryDeserialize(r.offset),scale:1/r.scale})]});else if(a.type==="DOM"){const o=document.createElement("div");o.innerHTML=a.element;const n=o.childNodes[0];if(o.removeChild(n),a.dataURL){const l=new window.Image;l.onload=()=>{n.getContext("2d").drawImage(l,0,0)},l.src=a.dataURL}s=new DOM(n)}return r.clipArea&&(s.clipArea=sceneryDeserialize(r.clipArea)),r.mouseArea&&(s.mouseArea=sceneryDeserialize(r.mouseArea)),r.touchArea&&(s.touchArea=sceneryDeserialize(r.touchArea)),r.matrix&&(s.matrix=sceneryDeserialize(r.matrix)),r.localBounds&&(s.localBounds=sceneryDeserialize(r.localBounds)),r.fill&&(s.fill=sceneryDeserialize(r.fill)),r.stroke&&(s.stroke=sceneryDeserialize(r.stroke)),r.lineDash&&(s.lineDash=sceneryDeserialize(r.lineDash)),s.mutate(a.options),s._serialization=a,s}else if(a.type==="Subtree"){const s={},r=a.nodes.map(sceneryDeserialize);return r.forEach(o=>{s[o._serialization.id]=o}),r.forEach(o=>{o._serialization.setup.children.forEach(n=>{o.addChild(s[n])})}),s[a.rootNodeId]}else return a.type==="value"?a.value:null};scenery.register("sceneryDeserialize",sceneryDeserialize);const sceneryCopy=a=>sceneryDeserialize(scenerySerialize(a));scenery.register("sceneryCopy",sceneryCopy);let globalId$1=1;class Drawable{initialize(t){return assert&&assert(!this.id||this.isDisposed,"If we previously existed, we need to have been disposed"),this.id=this.id||globalId$1++,sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`[${this.constructor.name}*] initialize ${this.toString()}`),this.clean(),this.renderer=t,this.dirty=!0,this.isDisposed=!1,this.linksDirty=!1,this.visibleProperty=new TinyProperty(!0),this.fittableProperty=new TinyProperty(!0),this}clean(){this.parentDrawable=null,this.backbone=null,this.pendingParentDrawable=null,this.pendingBackbone=null,this.pendingAddition=!1,this.pendingRemoval=!1,assert&&assert(!this.previousDrawable&&!this.nextDrawable,"By cleaning (disposal or fresh creation), we should have disconnected from the linked list"),this.previousDrawable=null,this.nextDrawable=null,this.oldPreviousDrawable=null,this.oldNextDrawable=null,this.visibleProperty&&this.visibleProperty.removeAllListeners(),this.fittableProperty&&this.fittableProperty.removeAllListeners()}update(){let t=!1;return this.dirty&&!this.isDisposed&&(this.dirty=!1,t=!0),t}setVisible(t){this.visibleProperty.value=t}set visible(t){this.setVisible(t)}isVisible(){return this.visibleProperty.value}get visible(){return this.isVisible()}setFittable(t){this.fittableProperty.value=t}set fittable(t){this.setFittable(t)}isFittable(){return this.fittableProperty.value}get fittable(){return this.isFittable()}setBlockBackbone(t){sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`[${this.constructor.name}*] setBlockBackbone ${this.toString()} with ${t.toString()}`),assert&&assert(this instanceof Block$1),this.parentDrawable=t,this.backbone=t,this.pendingParentDrawable=t,this.pendingBackbone=t,this.pendingAddition=!1,this.pendingRemoval=!1}notePendingAddition(t,s,r){sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`[${this.constructor.name}*] notePendingAddition ${this.toString()} with ${s.toString()}, ${r?r.toString():"-"}`),assert&&assert(r!==void 0,"backbone can be either null or a backbone"),assert&&assert(s instanceof Block$1),this.pendingParentDrawable=s,this.pendingBackbone=r,this.pendingAddition=!0,this.pendingRemoval||t.markDrawableChangedBlock(this)}notePendingRemoval(t){sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`[${this.constructor.name}*] notePendingRemoval ${this.toString()}`),this.pendingRemoval=!0,this.pendingAddition||t.markDrawableChangedBlock(this)}notePendingMove(t,s){sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`[${this.constructor.name}*] notePendingMove ${this.toString()} with ${s.toString()}`),assert&&assert(s instanceof Block$1),this.pendingParentDrawable=s,(!this.pendingRemoval||!this.pendingAddition)&&t.markDrawableChangedBlock(this),this.pendingAddition=!0,this.pendingRemoval=!0}updateBlock(){sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`[${this.constructor.name}*] updateBlock ${this.toString()} with add:${this.pendingAddition} remove:${this.pendingRemoval} old:${this.parentDrawable?this.parentDrawable.toString():"-"} new:${this.pendingParentDrawable?this.pendingParentDrawable.toString():"-"}`),sceneryLog&&sceneryLog.Drawable&&sceneryLog.push();let t=!1;return(this.pendingRemoval||this.pendingAddition)&&(t=!this.pendingRemoval||!this.pendingAddition||this.parentDrawable!==this.pendingParentDrawable||this.backbone!==this.pendingBackbone,t?(this.pendingRemoval&&(sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`removing from ${this.parentDrawable.toString()}`),this.parentDrawable.removeDrawable(this),this.pendingAddition||(this.pendingParentDrawable=null,this.pendingBackbone=null)),this.parentDrawable=this.pendingParentDrawable,this.backbone=this.pendingBackbone,this.pendingAddition&&(sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`adding to ${this.parentDrawable.toString()}`),this.parentDrawable.addDrawable(this))):(sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable("unchanged"),this.pendingAddition&&Renderer.isCanvas(this.renderer)&&this.parentDrawable.onPotentiallyMovedDrawable(this)),this.pendingAddition=!1,this.pendingRemoval=!1),sceneryLog&&sceneryLog.Drawable&&sceneryLog.pop(),t}updateLinks(){this.oldNextDrawable=this.nextDrawable,this.oldPreviousDrawable=this.previousDrawable,this.linksDirty=!1}markDirty(){this.dirty||(this.dirty=!0,this.parentDrawable&&this.parentDrawable.markDirtyDrawable(this))}markLinksDirty(t){this.linksDirty||(this.linksDirty=!0,t.markDrawableForLinksUpdate(this))}markForDisposal(t){Drawable.disconnectBefore(this,t),Drawable.disconnectAfter(this,t),t.markDrawableForDisposal(this)}disposeImmediately(t){Drawable.disconnectBefore(this,t),Drawable.disconnectAfter(this,t),this.dispose()}dispose(){assert&&assert(!this.isDisposed,"We should not re-dispose drawables"),sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`[${this.constructor.name}*] dispose ${this.toString()}`),sceneryLog&&sceneryLog.Drawable&&sceneryLog.push(),this.clean(),this.isDisposed=!0,this.freeToPool(),sceneryLog&&sceneryLog.Drawable&&sceneryLog.pop()}audit(t,s,r){assertSlow&&(assertSlow&&assertSlow(!this.isDisposed,"If we are being audited, we assume we are in the drawable display tree, and we should not be marked as disposed"),assertSlow&&assertSlow(this.renderer,"Should not have a 0 (no) renderer"),assertSlow&&assertSlow(!this.backbone||this.parentDrawable,"If we have a backbone reference, we must have a parentDrawable (our block)"),t||(assertSlow&&assertSlow(!this.pendingAddition),assertSlow&&assertSlow(!this.pendingRemoval),assertSlow&&assertSlow(this.parentDrawable===this.pendingParentDrawable,"Assure our parent and pending parent match, if we have updated blocks"),assertSlow&&assertSlow(this.backbone===this.pendingBackbone,"Assure our backbone and pending backbone match, if we have updated blocks")),s||(assertSlow&&assertSlow(this.oldPreviousDrawable===this.previousDrawable,"Pending linked-list references should be cleared by now"),assertSlow&&assertSlow(this.oldNextDrawable===this.nextDrawable,"Pending linked-list references should be cleared by now"),assertSlow&&assertSlow(!this.linksDirty,"Links dirty flag should be clean")),r||assertSlow&&assertSlow(!this.dirty,"Should not be dirty at this phase, if we are in the drawable display tree"))}toString(){return`${this.constructor.name}#${this.id}`}toDetailedString(){return this.toString()}static connectDrawables(t,s,r){t.nextDrawable!==s&&(t.nextDrawable&&(t.nextDrawable.markLinksDirty(r),t.nextDrawable.previousDrawable=null),s.previousDrawable&&(s.previousDrawable.markLinksDirty(r),s.previousDrawable.nextDrawable=null),t.nextDrawable=s,s.previousDrawable=t,t.markLinksDirty(r),s.markLinksDirty(r))}static disconnectBefore(t,s){t.previousDrawable&&(t.markLinksDirty(s),t.previousDrawable.markLinksDirty(s),t.previousDrawable.nextDrawable=null,t.previousDrawable=null)}static disconnectAfter(t,s){t.nextDrawable&&(t.markLinksDirty(s),t.nextDrawable.markLinksDirty(s),t.nextDrawable.previousDrawable=null,t.nextDrawable=null)}static listToArray(t,s){const r=[];for(let o=t;r.push(o),o!==s;o=o.nextDrawable);return r}static oldListToArray(t,s){const r=[];for(let o=t;r.push(o),o!==s;o=o.oldNextDrawable);return r}}scenery.register("Drawable",Drawable);class SelfDrawable extends Drawable{constructor(t,s){assert&&assert(typeof t=="number"),assert&&assert(s),super(),this.initialize(t,s)}initialize(t,s){return super.initialize(t),this.drawableVisibilityListener=this.drawableVisibilityListener||this.updateSelfVisibility.bind(this),this.instance=s,this.node=s.trail.lastNode(),this.node.attachDrawable(this),this.instance.selfVisibleEmitter.addListener(this.drawableVisibilityListener),this.updateSelfVisibility(),this}dispose(){this.instance.selfVisibleEmitter.removeListener(this.drawableVisibilityListener),this.node.detachDrawable(this),this.instance=null,this.node=null,super.dispose()}updateSelfVisibility(){this.visible=this.instance.selfVisible}toDetailedString(){return`${this.toString()} (${this.instance.trail.toPathString()})`}}scenery.register("SelfDrawable",SelfDrawable);const PaintableStatelessDrawable=memoize(a=>(assert&&assert(_.includes(inheritance(a),SelfDrawable)),class extends a{initialize(t,s,...r){super.initialize(t,s,...r),this.fillCallback=this.fillCallback||this.markDirtyFill.bind(this),this.strokeCallback=this.strokeCallback||this.markDirtyStroke.bind(this),this.fillObserver=this.fillObserver||new PaintObserver(this.fillCallback),this.strokeObserver=this.strokeObserver||new PaintObserver(this.strokeCallback),this.fillObserver.setPrimary(s.node._fill),this.strokeObserver.setPrimary(s.node._stroke)}dispose(){this.fillObserver.clean(),this.strokeObserver.clean(),super.dispose()}markDirtyFill(){assert&&Color.checkPaint(this.instance.node._fill),this.markPaintDirty(),this.fillObserver.setPrimary(this.instance.node._fill)}markDirtyStroke(){assert&&Color.checkPaint(this.instance.node._stroke),this.markPaintDirty(),this.strokeObserver.setPrimary(this.instance.node._stroke)}markDirtyLineWidth(){this.markPaintDirty()}markDirtyLineOptions(){this.markPaintDirty()}markDirtyCachedPaints(){this.markPaintDirty()}}));scenery.register("PaintableStatelessDrawable",PaintableStatelessDrawable);const PaintableStatelessDrawable$1=PaintableStatelessDrawable,PaintableStatefulDrawable=memoize(a=>(assert&&assert(_.includes(inheritance(a),SelfDrawable)),class extends a{initialize(t,s,...r){super.initialize(t,s,...r),this.dirtyFill=!0,this.hadStroke=!1,this.dirtyStroke=!0,this.dirtyLineWidth=!0,this.dirtyLineOptions=!0,this.dirtyCachedPaints=!0,this.lastCachedPaints=[],this.fillCallback=this.fillCallback||this.markDirtyFill.bind(this),this.strokeCallback=this.strokeCallback||this.markDirtyStroke.bind(this),this.fillObserver=this.fillObserver||new PaintObserver(this.fillCallback),this.strokeObserver=this.strokeObserver||new PaintObserver(this.strokeCallback),this.fillObserver.setPrimary(s.node._fill),this.strokeObserver.setPrimary(s.node._stroke)}cleanPaintableState(){this.dirtyFill=!1,this.dirtyStroke=!1,this.dirtyLineWidth=!1,this.dirtyLineOptions=!1,this.dirtyCachedPaints=!1,this.hadStroke=this.node.getStroke()!==null}dispose(){super.dispose(),this.fillObserver.clean(),this.strokeObserver.clean()}markDirtyFill(){assert&&Color.checkPaint(this.instance.node._fill),this.dirtyFill=!0,this.markPaintDirty(),this.fillObserver.setPrimary(this.instance.node._fill)}markDirtyStroke(){assert&&Color.checkPaint(this.instance.node._stroke),this.dirtyStroke=!0,this.markPaintDirty(),this.strokeObserver.setPrimary(this.instance.node._stroke)}markDirtyLineWidth(){this.dirtyLineWidth=!0,this.markPaintDirty()}markDirtyLineOptions(){this.dirtyLineOptions=!0,this.markPaintDirty()}markDirtyCachedPaints(){this.dirtyCachedPaints=!0,this.markPaintDirty()}}));scenery.register("PaintableStatefulDrawable",PaintableStatefulDrawable);class CanvasSelfDrawable extends SelfDrawable{initialize(t,s){super.initialize(t,s),this.transformListener=this.transformListener||this.markTransformDirty.bind(this),s.relativeTransform.addListener(this.transformListener),s.relativeTransform.addPrecompute()}markTransformDirty(){this.markDirty()}markPaintDirty(){this.markDirty()}updateSelfVisibility(){super.updateSelfVisibility(),this.markDirty()}dispose(){this.instance.relativeTransform.removeListener(this.transformListener),this.instance.relativeTransform.removePrecompute(),super.dispose()}}scenery.register("CanvasSelfDrawable",CanvasSelfDrawable);class DOMSelfDrawable extends SelfDrawable{initialize(t,s){return super.initialize(t,s),this.transformListener=this.transformListener||this.markTransformDirty.bind(this),this.markTransformDirty(),this.visibilityDirty=!0,s.relativeTransform.addListener(this.transformListener),s.relativeTransform.addPrecompute(),this}markTransformDirty(){this.transformDirty=!0,this.markDirty()}getTransformMatrix(){return this.instance.relativeTransform.validate(),this.instance.relativeTransform.matrix}update(){return super.update()?(this.updateDOM(),this.visibilityDirty&&(this.visibilityDirty=!1,this.domElement.style.visibility=this.visible?"":"hidden"),this.cleanPaintableState&&this.cleanPaintableState(),!0):!1}updateDOM(){}updateSelfVisibility(){super.updateSelfVisibility(),this.visibilityDirty||(this.visibilityDirty=!0,this.markDirty())}dispose(){this.instance.relativeTransform.removeListener(this.transformListener),this.instance.relativeTransform.removePrecompute(),super.dispose()}}scenery.register("DOMSelfDrawable",DOMSelfDrawable);class SVGSelfDrawable extends SelfDrawable{initialize(t,s,r,o){return assert&&assert(typeof r=="boolean"),assert&&assert(typeof o=="boolean"),super.initialize(t,s),this.usesPaint=r,this.keepElements=o,this.svgElement=null,this.svgBlock=null,this.usesPaint&&(this.paintState?this.paintState.initialize():this.paintState=new PaintSVGState),this}update(){return super.update()?(this.updateSVG(),!0):!1}updateSVG(){if(this.paintDirty&&this.updateSVGSelf(this.node,this.svgElement),this.usesPaint&&this.dirtyCachedPaints){const t=this.node._cachedPaints.slice();let s,r;for(s=0;s<t.length;s++){const o=t[s];let n=!0;for(r=0;r<this.lastCachedPaints.length;r++)if(o===this.lastCachedPaints[r]){n=!1;break}n&&this.svgBlock.incrementPaint(o)}for(s=0;s<this.lastCachedPaints.length;s++){const o=this.lastCachedPaints[s];let n=!0;for(r=0;r<t.length;r++)if(o===t[r]){n=!1;break}n&&this.svgBlock.decrementPaint(o)}this.lastCachedPaints=t}this.setToCleanState()}updateFillStrokeStyle(t){if(!this.usesPaint)return;this.dirtyFill&&this.paintState.updateFill(this.svgBlock,this.node.getFillValue()),this.dirtyStroke&&this.paintState.updateStroke(this.svgBlock,this.node.getStrokeValue());const s=this.dirtyLineWidth||this.dirtyLineOptions;s&&this.paintState.updateStrokeDetailStyle(this.node),(this.dirtyFill||this.dirtyStroke||s)&&t.setAttribute("style",this.paintState.baseStyle+this.paintState.strokeDetailStyle),this.cleanPaintableState()}updateSVGBlock(t){const s=this.svgBlock;if(this.usesPaint&&s)for(let r=0;r<this.lastCachedPaints.length;r++)s.decrementPaint(this.lastCachedPaints[r]);if(this.svgBlock=t,this.usesPaint)for(let r=0;r<this.lastCachedPaints.length;r++)t.incrementPaint(this.lastCachedPaints[r]);this.updateDefsSelf&&this.updateDefsSelf(t),this.usesPaint&&this.paintState.updateSVGBlock(t),this.usesPaint&&this.markDirtyFill(),this.usesPaint&&this.markDirtyStroke()}dispose(){this.keepElements||(this.svgElement=null),this.updateDefsSelf&&this.updateDefsSelf(null),this.usesPaint&&this.paintState.dispose(),this.defs=null,this.svgBlock=null,super.dispose()}}scenery.register("SVGSelfDrawable",SVGSelfDrawable);class WebGLSelfDrawable extends SelfDrawable{initialize(t,s){return super.initialize(t,s),this.transformListener=this.transformListener||this.markTransformDirty.bind(this),s.relativeTransform.addListener(this.transformListener),s.relativeTransform.addPrecompute(),this}markTransformDirty(){this.markDirty()}updateSelfVisibility(){super.updateSelfVisibility(),this.markDirty()}dispose(){this.instance.relativeTransform.removeListener(this.transformListener),this.instance.relativeTransform.removePrecompute(),super.dispose()}}scenery.register("WebGLSelfDrawable",WebGLSelfDrawable);const CircleStatefulDrawable=memoize(a=>(assert&&assert(_.includes(inheritance(a),SelfDrawable)),class extends PaintableStatefulDrawable(a){initialize(t,s,...r){super.initialize(t,s,...r),this.paintDirty=!0,this.dirtyRadius=!0}markPaintDirty(){this.paintDirty=!0,this.markDirty()}markDirtyRadius(){this.dirtyRadius=!0,this.markPaintDirty()}setToCleanState(){this.paintDirty=!1,this.dirtyRadius=!1}}));scenery.register("CircleStatefulDrawable",CircleStatefulDrawable);const ImageStatefulDrawable=memoize(a=>(assert&&assert(_.includes(inheritance(a),SelfDrawable)),class extends a{initialize(t,s,...r){super.initialize(t,s,...r),this.paintDirty=!0,this.dirtyImage=!0,this.dirtyImageOpacity=!0,this.dirtyMipmap=!0}markPaintDirty(){this.paintDirty=!0,this.markDirty()}markDirtyImage(){this.dirtyImage=!0,this.markPaintDirty()}markDirtyImageOpacity(){this.dirtyImageOpacity=!0,this.markPaintDirty()}markDirtyMipmap(){this.dirtyMipmap=!0,this.markPaintDirty()}setToCleanState(){this.paintDirty=!1,this.dirtyImage=!1,this.dirtyImageOpacity=!1,this.dirtyMipmap=!1}}));scenery.register("ImageStatefulDrawable",ImageStatefulDrawable);const ImageStatefulDrawable$1=ImageStatefulDrawable,LineStatelessDrawable=memoize(a=>(assert&&assert(_.includes(inheritance(a),SelfDrawable)),class extends PaintableStatelessDrawable$1(a){initialize(t,s,...r){super.initialize(t,s,...r),this.paintDirty=!0}markPaintDirty(){this.paintDirty=!0,this.markDirty()}markDirtyLine(){this.markPaintDirty()}markDirtyP1(){this.markPaintDirty()}markDirtyP2(){this.markPaintDirty()}markDirtyX1(){this.markPaintDirty()}markDirtyY1(){this.markPaintDirty()}markDirtyX2(){this.markPaintDirty()}markDirtyY2(){this.markPaintDirty()}}));scenery.register("LineStatelessDrawable",LineStatelessDrawable);const LineStatefulDrawable=memoize(a=>(assert&&assert(_.includes(inheritance(a),SelfDrawable)),class extends PaintableStatefulDrawable(a){initialize(t,s,...r){super.initialize(t,s,...r),this.paintDirty=!0,this.dirtyX1=!0,this.dirtyY1=!0,this.dirtyX2=!0,this.dirtyY2=!0}markPaintDirty(){this.paintDirty=!0,this.markDirty()}markDirtyLine(){this.dirtyX1=!0,this.dirtyY1=!0,this.dirtyX2=!0,this.dirtyY2=!0,this.markPaintDirty()}markDirtyP1(){this.dirtyX1=!0,this.dirtyY1=!0,this.markPaintDirty()}markDirtyP2(){this.dirtyX2=!0,this.dirtyY2=!0,this.markPaintDirty()}markDirtyX1(){this.dirtyX1=!0,this.markPaintDirty()}markDirtyY1(){this.dirtyY1=!0,this.markPaintDirty()}markDirtyX2(){this.dirtyX2=!0,this.markPaintDirty()}markDirtyY2(){this.dirtyY2=!0,this.markPaintDirty()}setToCleanState(){this.paintDirty=!1,this.dirtyX1=!1,this.dirtyY1=!1,this.dirtyX2=!1,this.dirtyY2=!1}}));scenery.register("LineStatefulDrawable",LineStatefulDrawable);const PathStatefulDrawable=memoize(a=>(assert&&assert(_.includes(inheritance(a),SelfDrawable)),class extends PaintableStatefulDrawable(a){initialize(t,s,...r){super.initialize(t,s,...r),this.paintDirty=!0,this.dirtyShape=!0}markPaintDirty(){this.paintDirty=!0,this.markDirty()}markDirtyShape(){this.dirtyShape=!0,this.markPaintDirty()}setToCleanState(){this.paintDirty=!1,this.dirtyShape=!1}}));scenery.register("PathStatefulDrawable",PathStatefulDrawable);const PathStatefulDrawable$1=PathStatefulDrawable,RectangleStatefulDrawable=memoize(a=>(assert&&assert(_.includes(inheritance(a),SelfDrawable)),class extends PaintableStatefulDrawable(a){initialize(t,s,...r){super.initialize(t,s,...r),this.paintDirty=!0,this.dirtyX=!0,this.dirtyY=!0,this.dirtyWidth=!0,this.dirtyHeight=!0,this.dirtyCornerXRadius=!0,this.dirtyCornerYRadius=!0}markPaintDirty(){this.paintDirty=!0,this.markDirty()}markDirtyRectangle(){this.dirtyX=!0,this.dirtyY=!0,this.dirtyWidth=!0,this.dirtyHeight=!0,this.dirtyCornerXRadius=!0,this.dirtyCornerYRadius=!0,this.markPaintDirty()}markDirtyX(){this.dirtyX=!0,this.markPaintDirty()}markDirtyY(){this.dirtyY=!0,this.markPaintDirty()}markDirtyWidth(){this.dirtyWidth=!0,this.markPaintDirty()}markDirtyHeight(){this.dirtyHeight=!0,this.markPaintDirty()}markDirtyCornerXRadius(){this.dirtyCornerXRadius=!0,this.markPaintDirty()}markDirtyCornerYRadius(){this.dirtyCornerYRadius=!0,this.markPaintDirty()}setToCleanState(){this.paintDirty=!1,this.dirtyX=!1,this.dirtyY=!1,this.dirtyWidth=!1,this.dirtyHeight=!1,this.dirtyCornerXRadius=!1,this.dirtyCornerYRadius=!1}}));scenery.register("RectangleStatefulDrawable",RectangleStatefulDrawable);const TextStatefulDrawable=memoize(a=>(assert&&assert(_.includes(inheritance(a),SelfDrawable)),class extends PaintableStatefulDrawable(a){initialize(t,s,...r){super.initialize(t,s,...r),this.paintDirty=!0,this.dirtyText=!0,this.dirtyFont=!0,this.dirtyBounds=!0}markPaintDirty(){this.paintDirty=!0,this.markDirty()}markDirtyText(){this.dirtyText=!0,this.markPaintDirty()}markDirtyFont(){this.dirtyFont=!0,this.markPaintDirty()}markDirtyBounds(){this.dirtyBounds=!0,this.markPaintDirty()}setToCleanState(){this.paintDirty=!1,this.dirtyText=!1,this.dirtyFont=!1,this.dirtyBounds=!1}}));scenery.register("TextStatefulDrawable",TextStatefulDrawable);const TextStatefulDrawable$1=TextStatefulDrawable,emptyArray=[];class CanvasNodeDrawable extends CanvasSelfDrawable{paintCanvas(t,s,r){if(assert&&assert(!s.selfBounds.isEmpty(),`CanvasNode should not be used with an empty canvasBounds. Please set canvasBounds (or use setCanvasBounds()) on ${s.constructor.name}`),!s.selfBounds.isEmpty()){const o=t.context;o.save(),o.fillStyle="black",o.strokeStyle="black",o.lineWidth=1,o.lineCap="butt",o.lineJoin="miter",o.lineDash=emptyArray,o.lineDashOffset=0,o.miterLimit=10,s.paintCanvas(o),o.restore()}}}scenery.register("CanvasNodeDrawable",CanvasNodeDrawable);Poolable.mixInto(CanvasNodeDrawable);const CanvasNodeDrawable$1=CanvasNodeDrawable;class CircleCanvasDrawable extends PaintableStatelessDrawable$1(CanvasSelfDrawable){paintCanvas(t,s,r){assert&&assert(s instanceof Node$2);const o=t.context;o.beginPath(),o.arc(0,0,s._radius,0,Math.PI*2,!1),o.closePath(),s.hasFill()&&(s.beforeCanvasFill(t),o.fill(),s.afterCanvasFill(t)),s.hasPaintableStroke()&&(s.beforeCanvasStroke(t),o.stroke(),s.afterCanvasStroke(t))}markDirtyRadius(){this.markPaintDirty()}dispose(){super.dispose()}}scenery.register("CircleCanvasDrawable",CircleCanvasDrawable);Poolable.mixInto(CircleCanvasDrawable);const CircleCanvasDrawable$1=CircleCanvasDrawable;class CircleDOMDrawable extends CircleStatefulDrawable(DOMSelfDrawable){constructor(t,s){super(t,s),Utils.prepareForTransform(this.domElement)}initialize(t,s){if(super.initialize(t,s),this.matrix=this.matrix||Matrix3.pool.fetch(),!this.fillElement||!this.strokeElement){const r=document.createElement("div");this.fillElement=r;const o=document.createElement("div");this.strokeElement=o,r.style.display="block",r.style.position="absolute",r.style.left="0",r.style.top="0",r.style.pointerEvents="none",o.style.display="block",o.style.position="absolute",o.style.left="0",o.style.top="0",o.style.pointerEvents="none",r.appendChild(o)}this.domElement=this.fillElement}updateDOM(){const t=this.node,s=this.fillElement,r=this.strokeElement;if(this.paintDirty&&(this.dirtyRadius&&(s.style.width=`${2*t._radius}px`,s.style.height=`${2*t._radius}px`,s.style[Features.borderRadius]=`${t._radius}px`),this.dirtyFill&&(s.style.backgroundColor=t.getCSSFill()),this.dirtyStroke&&(t.hasStroke()?r.style.borderStyle="solid":r.style.borderStyle="none"),t.hasStroke())){const o=!this.hadStroke;(o||this.dirtyLineWidth||this.dirtyRadius)&&(r.style.width=`${2*t._radius-t.getLineWidth()}px`,r.style.height=`${2*t._radius-t.getLineWidth()}px`,r.style[Features.borderRadius]=`${t._radius+t.getLineWidth()/2}px`),(o||this.dirtyLineWidth)&&(r.style.left=`${-t.getLineWidth()/2}px`,r.style.top=`${-t.getLineWidth()/2}px`,r.style.borderWidth=`${t.getLineWidth()}px`),(o||this.dirtyStroke)&&(r.style.borderColor=t.getSimpleCSSStroke())}if(this.transformDirty||this.dirtyRadius){this.matrix.set(this.getTransformMatrix());const o=Matrix3.translation(-t._radius,-t._radius);this.matrix.multiplyMatrix(o),o.freeToPool(),Utils.applyPreparedTransform(this.matrix,this.fillElement)}this.setToCleanState(),this.cleanPaintableState(),this.transformDirty=!1}dispose(){super.dispose()}}scenery.register("CircleDOMDrawable",CircleDOMDrawable);Poolable.mixInto(CircleDOMDrawable);const CircleDOMDrawable$1=CircleDOMDrawable,keepSVGCircleElements=!0;class CircleSVGDrawable extends CircleStatefulDrawable(SVGSelfDrawable){initialize(t,s){super.initialize(t,s,!0,keepSVGCircleElements),this.svgElement=this.svgElement||document.createElementNS(svgns,"circle")}updateSVGSelf(){const t=this.svgElement;this.dirtyRadius&&t.setAttribute("r",this.node._radius),this.updateFillStrokeStyle(t)}}scenery.register("CircleSVGDrawable",CircleSVGDrawable);Poolable.mixInto(CircleSVGDrawable);const CircleSVGDrawable$1=CircleSVGDrawable;class DOMDrawable extends DOMSelfDrawable{constructor(t,s){super(t,s),Utils.prepareForTransform(this.domElement)}initialize(t,s){super.initialize(t,s),this.domElement=this.node._container}updateDOM(){this.transformDirty&&!this.node._preventTransform&&Utils.applyPreparedTransform(this.getTransformMatrix(),this.domElement),this.transformDirty=!1}dispose(){super.dispose(),this.domElement=null}}scenery.register("DOMDrawable",DOMDrawable);Poolable.mixInto(DOMDrawable);const DOMDrawable$1=DOMDrawable;class ImageCanvasDrawable extends CanvasSelfDrawable{paintCanvas(t,s,r){const o=s._imageOpacity!==1;if(s._image&&s._image.width!==0&&s._image.height!==0){if(o&&(t.context.save(),t.context.globalAlpha*=s._imageOpacity),s._mipmap&&s.hasMipmaps()){const n=s.getMipmapLevel(r,Imageable$1.CANVAS_MIPMAP_BIAS_ADJUSTMENT),l=s.getMipmapCanvas(n),h=Math.pow(2,n);t.context.drawImage(l,0,0,l.width*h,l.height*h)}else t.context.drawImage(s._image,0,0);o&&t.context.restore()}}markDirtyImage(){this.markPaintDirty()}markDirtyMipmap(){this.markPaintDirty()}markDirtyImageOpacity(){this.markPaintDirty()}}scenery.register("ImageCanvasDrawable",ImageCanvasDrawable);Poolable.mixInto(ImageCanvasDrawable);const ImageCanvasDrawable$1=ImageCanvasDrawable;class ImageDOMDrawable extends ImageStatefulDrawable$1(DOMSelfDrawable){constructor(t,s){super(t,s),Utils.prepareForTransform(this.domElement)}initialize(t,s){super.initialize(t,s),this.domElement||(this.domElement=document.createElement("img"),this.domElement.style.display="block",this.domElement.style.position="absolute",this.domElement.style.pointerEvents="none",this.domElement.style.left="0",this.domElement.style.top="0"),this.hasOpacity=!1}updateDOM(){const t=this.node,s=this.domElement;this.paintDirty&&this.dirtyImage&&(s.src=t._image?t._image.src:"//:0"),this.dirtyImageOpacity&&(t._imageOpacity===1?this.hasOpacity&&(this.hasOpacity=!1,s.style.opacity=""):(this.hasOpacity=!0,s.style.opacity=t._imageOpacity)),this.transformDirty&&Utils.applyPreparedTransform(this.getTransformMatrix(),this.domElement),this.setToCleanState(),this.transformDirty=!1}dispose(){super.dispose()}}scenery.register("ImageDOMDrawable",ImageDOMDrawable);Poolable.mixInto(ImageDOMDrawable);const ImageDOMDrawable$1=ImageDOMDrawable,keepSVGImageElements=!0;class ImageSVGDrawable extends ImageStatefulDrawable$1(SVGSelfDrawable){initialize(t,s){super.initialize(t,s,!1,keepSVGImageElements),sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} initialized for ${s.toString()}`),this.svgElement=this.svgElement||document.createElementNS(svgns,"image"),this.svgElement.setAttribute("x","0"),this.svgElement.setAttribute("y","0"),this.hasOpacity=!1,this.usingMipmap=!1,this.mipmapLevel=-1,this._mipmapTransformListener=this._mipmapTransformListener||this.onMipmapTransform.bind(this),this._mipmapListener=this._mipmapListener||this.onMipmap.bind(this),this.node.mipmapEmitter.addListener(this._mipmapListener),this.updateMipmapStatus(s.node._mipmap)}updateSVGSelf(){const t=this.svgElement;this.dirtyImage?(sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Updating dirty image`),this.node._image?this.updateURL(t,!0):(t.setAttribute("width","0"),t.setAttribute("height","0"),t.setAttributeNS(xlinkns,"xlink:href","//:0"))):this.dirtyMipmap&&this.node._image&&(sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Updating dirty mipmap`),this.updateURL(t,!1)),this.dirtyImageOpacity&&(this.node._imageOpacity===1?this.hasOpacity&&(this.hasOpacity=!1,t.removeAttribute("opacity")):(this.hasOpacity=!0,t.setAttribute("opacity",this.node._imageOpacity)))}updateURL(t,s){let r=-1;if(this.node._mipmap&&(r=this.node.getMipmapLevel(this.instance.relativeTransform.matrix),sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Mipmap level: ${r}`)),!(!s&&r===this.mipmapLevel))if(this.mipmapLevel>=0&&r===-1&&t.removeAttribute("transform"),this.mipmapLevel=r,this.node._mipmap&&this.node.hasMipmaps()){sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Setting image URL to mipmap level ${r}`);const o=this.node.getMipmapURL(r),n=this.node.getMipmapCanvas(r);t.setAttribute("width",`${n.width}px`),t.setAttribute("height",`${n.height}px`),t.setAttribute("transform",`scale(${Math.pow(2,r).toFixed(20)})`),t.setAttributeNS(xlinkns,"xlink:href",o)}else sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Setting image URL`),t.setAttribute("width",`${this.node.getImageWidth()}px`),t.setAttribute("height",`${this.node.getImageHeight()}px`),t.setAttributeNS(xlinkns,"xlink:href",this.node.getImageURL())}updateMipmapStatus(t){this.usingMipmap!==t&&(this.usingMipmap=t,t?(sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Adding mipmap compute/listener needs`),this.instance.relativeTransform.addListener(this._mipmapTransformListener),this.instance.relativeTransform.addPrecompute()):(sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Removing mipmap compute/listener needs`),this.instance.relativeTransform.removeListener(this._mipmapTransformListener),this.instance.relativeTransform.removePrecompute()),this.markDirtyMipmap())}onMipmap(){this.markDirtyMipmap(),this.updateMipmapStatus(this.node._mipmap)}onMipmapTransform(){sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Transform dirties mipmap`),this.markDirtyMipmap()}dispose(){sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} disposing`),this.updateMipmapStatus(!1),this.node.mipmapEmitter.removeListener(this._mipmapListener),super.dispose()}}scenery.register("ImageSVGDrawable",ImageSVGDrawable);Poolable.mixInto(ImageSVGDrawable);const ImageSVGDrawable$1=ImageSVGDrawable,WEBGL_COMPONENTS=5,VERTEX_0_OFFSET=WEBGL_COMPONENTS*0,VERTEX_1_OFFSET=WEBGL_COMPONENTS*1,VERTEX_2_OFFSET=WEBGL_COMPONENTS*2,VERTEX_3_OFFSET=WEBGL_COMPONENTS*3,VERTEX_4_OFFSET=WEBGL_COMPONENTS*4,VERTEX_5_OFFSET=WEBGL_COMPONENTS*5,VERTEX_X_OFFSET=0,VERTEX_Y_OFFSET=1,VERTEX_U_OFFSET=2,VERTEX_V_OFFSET=3,VERTEX_A_OFFSET=4;class ImageWebGLDrawable extends ImageStatefulDrawable$1(WebGLSelfDrawable){initialize(t,s){super.initialize(t,s),this.vertexArray=this.vertexArray||new Float32Array(WEBGL_COMPONENTS*6),this.upperLeft=new Vector2(0,0),this.lowerLeft=new Vector2(0,0),this.upperRight=new Vector2(0,0),this.lowerRight=new Vector2(0,0),this.xyDirty=!0,this.uvDirty=!0,this.updatedOnce=!1,this.sprite=null}onAddToBlock(t){this.webglBlock=t,this.markDirty(),this.reserveSprite()}onRemoveFromBlock(t){this.unreserveSprite()}reserveSprite(){if(this.sprite){if(this.sprite.image===this.node._image)return;this.unreserveSprite()}const t=this.node.getImageWidth(),s=this.node.getImageHeight();this.sprite=t>0&&s>0?this.webglBlock.addSpriteSheetImage(this.node._image,t,s):null,this.xyDirty=!0,this.uvDirty=!0}unreserveSprite(){this.sprite&&this.webglBlock.removeSpriteSheetImage(this.sprite),this.sprite=null}markTransformDirty(){this.xyDirty=!0,super.markTransformDirty()}markPaintDirty(){this.xyDirty=!0,this.uvDirty=!0,this.markDirty()}update(){if(!super.update()||(this.reserveSprite(),(this.dirtyImageOpacity||!this.updatedOnce)&&(this.vertexArray[VERTEX_0_OFFSET+VERTEX_A_OFFSET]=this.node._imageOpacity,this.vertexArray[VERTEX_1_OFFSET+VERTEX_A_OFFSET]=this.node._imageOpacity,this.vertexArray[VERTEX_2_OFFSET+VERTEX_A_OFFSET]=this.node._imageOpacity,this.vertexArray[VERTEX_3_OFFSET+VERTEX_A_OFFSET]=this.node._imageOpacity,this.vertexArray[VERTEX_4_OFFSET+VERTEX_A_OFFSET]=this.node._imageOpacity,this.vertexArray[VERTEX_5_OFFSET+VERTEX_A_OFFSET]=this.node._imageOpacity),this.updatedOnce=!0,!this.sprite))return!1;if(this.uvDirty){this.uvDirty=!1;const t=this.sprite.uvBounds;this.vertexArray[VERTEX_0_OFFSET+VERTEX_U_OFFSET]=t.minX,this.vertexArray[VERTEX_0_OFFSET+VERTEX_V_OFFSET]=t.minY,this.vertexArray[VERTEX_1_OFFSET+VERTEX_U_OFFSET]=t.minX,this.vertexArray[VERTEX_1_OFFSET+VERTEX_V_OFFSET]=t.maxY,this.vertexArray[VERTEX_2_OFFSET+VERTEX_U_OFFSET]=t.maxX,this.vertexArray[VERTEX_2_OFFSET+VERTEX_V_OFFSET]=t.minY,this.vertexArray[VERTEX_3_OFFSET+VERTEX_U_OFFSET]=t.maxX,this.vertexArray[VERTEX_3_OFFSET+VERTEX_V_OFFSET]=t.minY,this.vertexArray[VERTEX_4_OFFSET+VERTEX_U_OFFSET]=t.minX,this.vertexArray[VERTEX_4_OFFSET+VERTEX_V_OFFSET]=t.maxY,this.vertexArray[VERTEX_5_OFFSET+VERTEX_U_OFFSET]=t.maxX,this.vertexArray[VERTEX_5_OFFSET+VERTEX_V_OFFSET]=t.maxY}if(this.xyDirty){this.xyDirty=!1;const t=this.node.getImageWidth(),s=this.node.getImageHeight(),r=this.instance.relativeTransform.matrix;r.multiplyVector2(this.upperLeft.setXY(0,0)),r.multiplyVector2(this.lowerLeft.setXY(0,s)),r.multiplyVector2(this.upperRight.setXY(t,0)),r.multiplyVector2(this.lowerRight.setXY(t,s)),this.vertexArray[VERTEX_0_OFFSET+VERTEX_X_OFFSET]=this.upperLeft.x,this.vertexArray[VERTEX_0_OFFSET+VERTEX_Y_OFFSET]=this.upperLeft.y,this.vertexArray[VERTEX_1_OFFSET+VERTEX_X_OFFSET]=this.lowerLeft.x,this.vertexArray[VERTEX_1_OFFSET+VERTEX_Y_OFFSET]=this.lowerLeft.y,this.vertexArray[VERTEX_2_OFFSET+VERTEX_X_OFFSET]=this.upperRight.x,this.vertexArray[VERTEX_2_OFFSET+VERTEX_Y_OFFSET]=this.upperRight.y,this.vertexArray[VERTEX_3_OFFSET+VERTEX_X_OFFSET]=this.upperRight.x,this.vertexArray[VERTEX_3_OFFSET+VERTEX_Y_OFFSET]=this.upperRight.y,this.vertexArray[VERTEX_4_OFFSET+VERTEX_X_OFFSET]=this.lowerLeft.x,this.vertexArray[VERTEX_4_OFFSET+VERTEX_Y_OFFSET]=this.lowerLeft.y,this.vertexArray[VERTEX_5_OFFSET+VERTEX_X_OFFSET]=this.lowerRight.x,this.vertexArray[VERTEX_5_OFFSET+VERTEX_Y_OFFSET]=this.lowerRight.y}return!0}}ImageWebGLDrawable.prototype.webglRenderer=Renderer.webglTexturedTriangles;scenery.register("ImageWebGLDrawable",ImageWebGLDrawable);Poolable.mixInto(ImageWebGLDrawable);const ImageWebGLDrawable$1=ImageWebGLDrawable;class LineCanvasDrawable extends LineStatelessDrawable(CanvasSelfDrawable){paintCanvas(t,s,r){assert&&assert(s instanceof Node$2);const o=t.context;o.beginPath(),o.moveTo(s.x1,s.y1),o.lineTo(s.x2,s.y2),s.hasPaintableStroke()&&(s.beforeCanvasStroke(t),o.stroke(),s.afterCanvasStroke(t))}}scenery.register("LineCanvasDrawable",LineCanvasDrawable);Poolable.mixInto(LineCanvasDrawable);const LineCanvasDrawable$1=LineCanvasDrawable,keepSVGLineElements=!0;class LineSVGDrawable extends LineStatefulDrawable(SVGSelfDrawable){initialize(t,s){super.initialize(t,s,!0,keepSVGLineElements),this.svgElement=this.svgElement||document.createElementNS(svgns,"line")}updateSVGSelf(){const t=this.svgElement;this.dirtyX1&&t.setAttribute("x1",this.node.x1),this.dirtyY1&&t.setAttribute("y1",this.node.y1),this.dirtyX2&&t.setAttribute("x2",this.node.x2),this.dirtyY2&&t.setAttribute("y2",this.node.y2),this.updateFillStrokeStyle(t)}}scenery.register("LineSVGDrawable",LineSVGDrawable);Poolable.mixInto(LineSVGDrawable);const LineSVGDrawable$1=LineSVGDrawable;class PathCanvasDrawable extends PaintableStatelessDrawable$1(CanvasSelfDrawable){paintCanvas(t,s,r){const o=t.context;s.hasShape()&&(o.beginPath(),s._shape.writeToContext(o),s.hasFill()&&(s.beforeCanvasFill(t),o.fill(),s.afterCanvasFill(t)),s.hasPaintableStroke()&&(s.beforeCanvasStroke(t),o.stroke(),s.afterCanvasStroke(t)))}markDirtyShape(){this.markPaintDirty()}}scenery.register("PathCanvasDrawable",PathCanvasDrawable);Poolable.mixInto(PathCanvasDrawable);const PathCanvasDrawable$1=PathCanvasDrawable,keepSVGPathElements=!0;class PathSVGDrawable extends PathStatefulDrawable$1(SVGSelfDrawable){initialize(t,s){super.initialize(t,s,!0,keepSVGPathElements),this.svgElement=this.svgElement||document.createElementNS(svgns,"path")}updateSVGSelf(){assert&&assert(!this.node.requiresSVGBoundsWorkaround(),"No workaround for https://github.com/phetsims/scenery/issues/196 is provided at this time, please add an epsilon");const t=this.svgElement;if(this.dirtyShape){let s=this.node.hasShape()?this.node._shape.getSVGPath():"";s||(s="M0 0"),t.setAttribute("d",`${s}${platform.safari?" M0 0":""}`)}this.updateFillStrokeStyle(t)}}scenery.register("PathSVGDrawable",PathSVGDrawable);Poolable.mixInto(PathSVGDrawable);const PathSVGDrawable$1=PathSVGDrawable;class RectangleCanvasDrawable extends PaintableStatelessDrawable$1(CanvasSelfDrawable){writeRectangularPath(t,s){t.beginPath(),t.moveTo(s._rectX,s._rectY),t.lineTo(s._rectX+s._rectWidth,s._rectY),t.lineTo(s._rectX+s._rectWidth,s._rectY+s._rectHeight),t.lineTo(s._rectX,s._rectY+s._rectHeight),t.closePath()}paintCanvas(t,s,r){const o=t.context;if(s.isRounded()){o.beginPath();const n=s.getMaximumArcSize(),l=Math.min(s._cornerXRadius,n),h=Math.min(s._cornerYRadius,n),g=s._rectX+l,d=s._rectX+s._rectWidth-l,A=s._rectY+h,S=s._rectY+s._rectHeight-h;l===h?(o.arc(d,A,l,-Math.PI/2,0,!1),o.arc(d,S,l,0,Math.PI/2,!1),o.arc(g,S,l,Math.PI/2,Math.PI,!1),o.arc(g,A,l,Math.PI,Math.PI*3/2,!1)):(o.ellipse(d,A,l,h,0,-Math.PI/2,0,!1),o.ellipse(d,S,l,h,0,0,Math.PI/2,!1),o.ellipse(g,S,l,h,0,Math.PI/2,Math.PI,!1),o.ellipse(g,A,l,h,0,Math.PI,Math.PI*3/2,!1)),o.closePath(),s.hasFill()&&(s.beforeCanvasFill(t),o.fill(),s.afterCanvasFill(t)),s.hasPaintableStroke()&&(s.beforeCanvasStroke(t),o.stroke(),s.afterCanvasStroke(t))}else s.hasFill()&&(s.getFillValue().transformMatrix?(this.writeRectangularPath(o,s),s.beforeCanvasFill(t),o.fill(),s.afterCanvasFill(t)):(s.beforeCanvasFill(t),o.fillRect(s._rectX,s._rectY,s._rectWidth,s._rectHeight),s.afterCanvasFill(t))),s.hasPaintableStroke()&&(s.getStrokeValue().transformMatrix?(this.writeRectangularPath(o,s),s.beforeCanvasStroke(t),o.stroke(),s.afterCanvasStroke(t)):(s.beforeCanvasStroke(t),o.strokeRect(s._rectX,s._rectY,s._rectWidth,s._rectHeight),s.afterCanvasStroke(t)))}markDirtyRectangle(){this.markPaintDirty()}markDirtyX(){this.markDirtyRectangle()}markDirtyY(){this.markDirtyRectangle()}markDirtyWidth(){this.markDirtyRectangle()}markDirtyHeight(){this.markDirtyRectangle()}markDirtyCornerXRadius(){this.markDirtyRectangle()}markDirtyCornerYRadius(){this.markDirtyRectangle()}}scenery.register("RectangleCanvasDrawable",RectangleCanvasDrawable);Poolable.mixInto(RectangleCanvasDrawable);const RectangleCanvasDrawable$1=RectangleCanvasDrawable,scratchMatrix$2=Matrix3.pool.fetch();class RectangleDOMDrawable extends RectangleStatefulDrawable(DOMSelfDrawable){constructor(t,s){super(t,s),Utils.prepareForTransform(this.domElement)}initialize(t,s){if(super.initialize(t,s),!this.fillElement||!this.strokeElement){const r=document.createElement("div");this.fillElement=r,r.style.display="block",r.style.position="absolute",r.style.left="0",r.style.top="0",r.style.pointerEvents="none";const o=document.createElement("div");this.strokeElement=o,o.style.display="block",o.style.position="absolute",o.style.left="0",o.style.top="0",o.style.pointerEvents="none",r.appendChild(o)}this.domElement=this.fillElement}updateDOM(){const t=this.node,s=this.fillElement,r=this.strokeElement;if(this.paintDirty){const o=Math.min(t._cornerXRadius,t._cornerYRadius),n=this.dirtyCornerXRadius||this.dirtyCornerYRadius;if(this.dirtyWidth&&(s.style.width=`${t._rectWidth}px`),this.dirtyHeight&&(s.style.height=`${t._rectHeight}px`),n&&(s.style[Features.borderRadius]=`${o}px`),this.dirtyFill&&(s.style.backgroundColor=t.getCSSFill()),this.dirtyStroke&&(t.hasStroke()?r.style.borderStyle="solid":r.style.borderStyle="none"),t.hasStroke()){const l=!this.hadStroke;(l||this.dirtyWidth||this.dirtyLineWidth)&&(r.style.width=`${t._rectWidth-t.getLineWidth()}px`),(l||this.dirtyHeight||this.dirtyLineWidth)&&(r.style.height=`${t._rectHeight-t.getLineWidth()}px`),(l||this.dirtyLineWidth)&&(r.style.left=`${-t.getLineWidth()/2}px`,r.style.top=`${-t.getLineWidth()/2}px`,r.style.borderWidth=`${t.getLineWidth()}px`),(l||this.dirtyStroke)&&(r.style.borderColor=t.getSimpleCSSStroke()),(l||n||this.dirtyLineWidth||this.dirtyLineOptions)&&(r.style[Features.borderRadius]=t.isRounded()||t.getLineJoin()==="round"?`${o+t.getLineWidth()/2}px`:"0")}}if(this.transformDirty||this.dirtyX||this.dirtyY){scratchMatrix$2.set(this.getTransformMatrix());const o=Matrix3.translation(t._rectX,t._rectY);scratchMatrix$2.multiplyMatrix(o),o.freeToPool(),Utils.applyPreparedTransform(scratchMatrix$2,this.fillElement)}this.setToCleanState(),this.cleanPaintableState(),this.transformDirty=!1}dispose(){super.dispose()}}scenery.register("RectangleDOMDrawable",RectangleDOMDrawable);Poolable.mixInto(RectangleDOMDrawable);const RectangleDOMDrawable$1=RectangleDOMDrawable,keepSVGRectangleElements=!0;class RectangleSVGDrawable extends RectangleStatefulDrawable(SVGSelfDrawable){initialize(t,s){super.initialize(t,s,!0,keepSVGRectangleElements),this.lastArcW=-1,this.lastArcH=-1,this.svgElement=this.svgElement||document.createElementNS(svgns,"rect")}updateSVGSelf(){const t=this.svgElement;if(this.dirtyX&&t.setAttribute("x",this.node._rectX),this.dirtyY&&t.setAttribute("y",this.node._rectY),this.dirtyWidth&&t.setAttribute("width",this.node._rectWidth),this.dirtyHeight&&t.setAttribute("height",this.node._rectHeight),this.dirtyCornerXRadius||this.dirtyCornerYRadius||this.dirtyWidth||this.dirtyHeight){let s=0,r=0;if(this.node.isRounded()){const o=this.node.getMaximumArcSize();s=Math.min(this.node._cornerXRadius,o),r=Math.min(this.node._cornerYRadius,o)}s!==this.lastArcW&&(this.lastArcW=s,t.setAttribute("rx",s)),r!==this.lastArcH&&(this.lastArcH=r,t.setAttribute("ry",r))}this.updateFillStrokeStyle(t)}}scenery.register("RectangleSVGDrawable",RectangleSVGDrawable);Poolable.mixInto(RectangleSVGDrawable);const RectangleSVGDrawable$1=RectangleSVGDrawable,scratchColor=new Color("transparent");class RectangleWebGLDrawable extends RectangleStatefulDrawable(WebGLSelfDrawable){initialize(t,s){super.initialize(t,s),this.vertexArray||(this.vertexArray=new Float32Array(6*6)),this.upperLeft=new Vector2(0,0),this.lowerLeft=new Vector2(0,0),this.upperRight=new Vector2(0,0),this.lowerRight=new Vector2(0,0),this.transformDirty=!0,this.includeVertices=!0}onAddToBlock(t){this.webglBlock=t,this.markDirty()}onRemoveFromBlock(t){}markTransformDirty(){this.transformDirty=!0,super.markTransformDirty()}update(){if(!super.update())return!1;if(this.dirtyFill&&(this.includeVertices=this.node.hasFill(),this.includeVertices)){const t=isTReadOnlyProperty(this.node.fill)?this.node.fill.value:this.node.fill,s=scratchColor.set(t),r=s.red/255,o=s.green/255,n=s.blue/255,l=s.alpha;for(let h=0;h<6;h++){const g=h*6;this.vertexArray[2+g]=r,this.vertexArray[3+g]=o,this.vertexArray[4+g]=n,this.vertexArray[5+g]=l}}if(this.transformDirty||this.dirtyX||this.dirtyY||this.dirtyWidth||this.dirtyHeight){this.transformDirty=!1;const t=this.node._rectX,s=this.node._rectY,r=this.node._rectWidth,o=this.node._rectHeight,n=this.instance.relativeTransform.matrix;n.multiplyVector2(this.upperLeft.setXY(t,s)),n.multiplyVector2(this.lowerLeft.setXY(t,s+o)),n.multiplyVector2(this.upperRight.setXY(t+r,s)),n.multiplyVector2(this.lowerRight.setXY(t+r,s+o)),this.vertexArray[0]=this.upperLeft.x,this.vertexArray[1]=this.upperLeft.y,this.vertexArray[6]=this.lowerLeft.x,this.vertexArray[7]=this.lowerLeft.y,this.vertexArray[12]=this.upperRight.x,this.vertexArray[13]=this.upperRight.y,this.vertexArray[18]=this.upperRight.x,this.vertexArray[19]=this.upperRight.y,this.vertexArray[24]=this.lowerLeft.x,this.vertexArray[25]=this.lowerLeft.y,this.vertexArray[30]=this.lowerRight.x,this.vertexArray[31]=this.lowerRight.y}return this.setToCleanState(),this.cleanPaintableState(),!0}}RectangleWebGLDrawable.prototype.webglRenderer=Renderer.webglVertexColorPolygons;scenery.register("RectangleWebGLDrawable",RectangleWebGLDrawable);Poolable.mixInto(RectangleWebGLDrawable);const RectangleWebGLDrawable$1=RectangleWebGLDrawable;class SpritesCanvasDrawable extends CanvasSelfDrawable{paintCanvas(t,s,r){assert&&assert(s instanceof Node$2);const o=Imageable$1.getApproximateMatrixScale(r)*(window.devicePixelRatio||1),n=s._spriteInstances.length;for(let l=0;l<n;l++){const h=s._spriteInstances[l],g=h.sprite.imageProperty.value,d=h.alpha!==1||g.imageOpacity!==1,A=g._mipmap&&g.hasMipmaps();if(d&&(t.context.save(),t.context.globalAlpha*=h.alpha*g.imageOpacity),h.transformType===SpriteInstanceTransformType.TRANSLATION&&r.isTranslation())if(A){const S=g.getMipmapLevelFromScale(o,Imageable$1.CANVAS_MIPMAP_BIAS_ADJUSTMENT),O=g.getMipmapCanvas(S),I=Math.pow(2,S);t.context.drawImage(O,h.matrix.m02()-g.offset.x,h.matrix.m12()-g.offset.y,O.width*I,O.height*I)}else t.context.drawImage(g.image,h.matrix.m02()-g.offset.x,h.matrix.m12()-g.offset.y);else{if(t.context.save(),h.matrix.canvasAppendTransform(t.context),A){const S=g.getMipmapLevelFromScale(o*Imageable$1.getApproximateMatrixScale(h.matrix),Imageable$1.CANVAS_MIPMAP_BIAS_ADJUSTMENT),O=g.getMipmapCanvas(S),I=Math.pow(2,S);t.context.drawImage(O,-g.offset.x,-g.offset.y,O.width*I,O.height*I)}else t.context.drawImage(g.image,-g.offset.x,-g.offset.y);t.context.restore()}d&&t.context.restore()}}}scenery.register("SpritesCanvasDrawable",SpritesCanvasDrawable);Poolable.mixInto(SpritesCanvasDrawable);const SpritesCanvasDrawable$1=SpritesCanvasDrawable,COMPONENTS=5,FLOAT_QUANTITY=COMPONENTS*6,upperLeft=new Vector2(0,0),lowerLeft=new Vector2(0,0),upperRight=new Vector2(0,0),lowerRight=new Vector2(0,0);class SpritesWebGLDrawable extends WebGLSelfDrawable{initialize(t,s){super.initialize(t,s),this.contextChangeListener=this.onWebGLContextChange.bind(this),this.spriteSheet=new SpriteSheet(!0),this.spriteImageUVMap={},this.vertexArray=new Float32Array(128*FLOAT_QUANTITY),this.transformMatrixArray=new Float32Array(9),this.spriteChangeListener=this.onSpriteChange.bind(this),this.node._sprites.forEach(r=>{r.imageProperty.lazyLink(this.spriteChangeListener),this.addSpriteImage(r.imageProperty.value)}),this.hasDrawn=!1}addSpriteImage(t){this.spriteImageUVMap[t.id]=this.spriteSheet.addImage(t.image,t.image.width,t.image.height).uvBounds}removeSpriteImage(t){this.spriteSheet.removeImage(t.image),delete this.spriteImageUVMap[t.id]}onSpriteChange(t,s){this.removeSpriteImage(s),this.addSpriteImage(t)}setup(){const t=this.webGLBlock.gl;this.spriteSheet.initializeContext(t),this.shaderProgram=new ShaderProgram(t,["attribute vec2 aVertex;","attribute vec2 aTextureCoord;","attribute float aAlpha;","varying vec2 vTextureCoord;","varying float vAlpha;","uniform mat3 uProjectionMatrix;","uniform mat3 uTransformMatrix;","void main() {","  vTextureCoord = aTextureCoord;","  vAlpha = aAlpha;","  vec3 ndc = uProjectionMatrix * ( uTransformMatrix * vec3( aVertex, 1.0 ) );","  gl_Position = vec4( ndc.xy, 0.0, 1.0 );","}"].join(`
`),["precision mediump float;","varying vec2 vTextureCoord;","varying float vAlpha;","uniform sampler2D uTexture;","void main() {","  vec4 color = texture2D( uTexture, vTextureCoord, -0.7 );","  color.a *= vAlpha;","  gl_FragColor = color;","}"].join(`
`),{attributes:["aVertex","aTextureCoord","aAlpha"],uniforms:["uTexture","uProjectionMatrix","uTransformMatrix"]}),this.vertexBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertexArray,t.DYNAMIC_DRAW)}onWebGLContextChange(){this.setup()}onAddToBlock(t){this.webGLBlock=t,this.setup(),t.glChangedEmitter.addListener(this.contextChangeListener)}onRemoveFromBlock(t){t.glChangedEmitter.removeListener(this.contextChangeListener)}draw(){const t=this.node._spriteInstances.length;if(t===0)return 0;this.spriteSheet.updateTexture(),this.shaderProgram.use();let s=0,r=!1;for(;FLOAT_QUANTITY*t>this.vertexArray.length;)this.vertexArray=new Float32Array(this.vertexArray.length*2),r=!0;for(let h=0;h<t;h++){const g=this.node._spriteInstances[h],d=g.sprite.imageProperty.value,A=g.alpha*d.imageOpacity,S=this.spriteImageUVMap[d.id],O=g.matrix,I=d.offset,W=d.image.width,L=d.image.height;O.multiplyVector2(upperLeft.setXY(-I.x,-I.y)),O.multiplyVector2(lowerLeft.setXY(-I.x,L-I.y)),O.multiplyVector2(upperRight.setXY(W-I.x,-I.y)),O.multiplyVector2(lowerRight.setXY(W-I.x,L-I.y)),this.vertexArray[s+0]=upperLeft.x,this.vertexArray[s+1]=upperLeft.y,this.vertexArray[s+2]=S.minX,this.vertexArray[s+3]=S.minY,this.vertexArray[s+4]=A,this.vertexArray[s+5]=lowerLeft.x,this.vertexArray[s+6]=lowerLeft.y,this.vertexArray[s+7]=S.minX,this.vertexArray[s+8]=S.maxY,this.vertexArray[s+9]=A,this.vertexArray[s+10]=upperRight.x,this.vertexArray[s+11]=upperRight.y,this.vertexArray[s+12]=S.maxX,this.vertexArray[s+13]=S.minY,this.vertexArray[s+14]=A,this.vertexArray[s+15]=upperRight.x,this.vertexArray[s+16]=upperRight.y,this.vertexArray[s+17]=S.maxX,this.vertexArray[s+18]=S.minY,this.vertexArray[s+19]=A,this.vertexArray[s+20]=lowerLeft.x,this.vertexArray[s+21]=lowerLeft.y,this.vertexArray[s+22]=S.minX,this.vertexArray[s+23]=S.maxY,this.vertexArray[s+24]=A,this.vertexArray[s+25]=lowerRight.x,this.vertexArray[s+26]=lowerRight.y,this.vertexArray[s+27]=S.maxX,this.vertexArray[s+28]=S.maxY,this.vertexArray[s+29]=A,s+=FLOAT_QUANTITY}const o=this.webGLBlock.gl;o.uniformMatrix3fv(this.shaderProgram.uniformLocations.uProjectionMatrix,!1,this.webGLBlock.projectionMatrixArray),this.instance.relativeTransform.matrix.copyToArray(this.transformMatrixArray),o.uniformMatrix3fv(this.shaderProgram.uniformLocations.uTransformMatrix,!1,this.transformMatrixArray),o.bindBuffer(o.ARRAY_BUFFER,this.vertexBuffer),r?o.bufferData(o.ARRAY_BUFFER,this.vertexArray,o.DYNAMIC_DRAW):o.bufferSubData(o.ARRAY_BUFFER,0,this.vertexArray.subarray(0,s));const n=Float32Array.BYTES_PER_ELEMENT,l=COMPONENTS*n;return o.vertexAttribPointer(this.shaderProgram.attributeLocations.aVertex,2,o.FLOAT,!1,l,0*n),o.vertexAttribPointer(this.shaderProgram.attributeLocations.aTextureCoord,2,o.FLOAT,!1,l,2*n),o.vertexAttribPointer(this.shaderProgram.attributeLocations.aAlpha,1,o.FLOAT,!1,l,4*n),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,this.spriteSheet.texture),o.uniform1i(this.shaderProgram.uniformLocations.uTexture,0),o.drawArrays(o.TRIANGLES,0,s/COMPONENTS),o.bindTexture(o.TEXTURE_2D,null),this.shaderProgram.unuse(),!this.hasDrawn&&platform.safari&&animationFrameTimer.setTimeout(()=>this.markDirty(),0),this.hasDrawn=!0,1}dispose(){this.node._sprites.forEach(t=>{t.imageProperty.unlink(this.spriteChangeListener)}),this.webGLBlock&&(this.webGLBlock=null),super.dispose()}markPaintDirty(){this.markDirty()}}SpritesWebGLDrawable.prototype.webglRenderer=Renderer.webglCustom;scenery.register("SpritesWebGLDrawable",SpritesWebGLDrawable);Poolable.mixInto(SpritesWebGLDrawable);const SpritesWebGLDrawable$1=SpritesWebGLDrawable;class TextCanvasDrawable extends PaintableStatelessDrawable$1(CanvasSelfDrawable){paintCanvas(t,s,r){const o=t.context;(s.hasFill()||s.hasPaintableStroke())&&(t.setFont(s._font.getFont()),t.setDirection("ltr")),s.hasFill()&&(s.beforeCanvasFill(t),o.fillText(s.renderedText,0,0),s.afterCanvasFill(t)),s.hasPaintableStroke()&&(s.beforeCanvasStroke(t),o.strokeText(s.renderedText,0,0),s.afterCanvasStroke(t))}markDirtyText(){this.markPaintDirty()}markDirtyFont(){this.markPaintDirty()}markDirtyBounds(){this.markPaintDirty()}}scenery.register("TextCanvasDrawable",TextCanvasDrawable);Poolable.mixInto(TextCanvasDrawable);const TextCanvasDrawable$1=TextCanvasDrawable,scratchMatrix$1=Matrix3.pool.fetch();class TextDOMDrawable extends TextStatefulDrawable$1(DOMSelfDrawable){constructor(t,s){super(t,s),Utils.prepareForTransform(this.domElement)}initialize(t,s){super.initialize(t,s),this.domElement||(this.domElement=document.createElement("div"),this.domElement.style.display="block",this.domElement.style.position="absolute",this.domElement.style.pointerEvents="none",this.domElement.style.left="0",this.domElement.style.top="0",this.domElement.setAttribute("dir","ltr"))}updateDOM(){const t=this.node,s=this.domElement;if(this.paintDirty&&(this.dirtyFont&&(s.style.font=t.getFont()),this.dirtyStroke&&(s.style.color=t.getCSSFill()),this.dirtyBounds&&(s.style.width=`${t.getSelfBounds().width}px`,s.style.height=`${t.getSelfBounds().height}px`),this.dirtyText&&(s.textContent=t.renderedText)),this.transformDirty||this.dirtyText||this.dirtyFont||this.dirtyBounds){const r=t.getSelfBounds().minY;scratchMatrix$1.set(this.getTransformMatrix());const o=Matrix3.translation(0,r);scratchMatrix$1.multiplyMatrix(o),o.freeToPool(),Utils.applyPreparedTransform(scratchMatrix$1,s)}this.setToCleanState(),this.cleanPaintableState(),this.transformDirty=!1}dispose(){super.dispose()}}scenery.register("TextDOMDrawable",TextDOMDrawable);Poolable.mixInto(TextDOMDrawable);const TextDOMDrawable$1=TextDOMDrawable,keepSVGTextElements=!0,useSVGTextLengthAdjustments=!platform.edge,useTransparentSVGTextWorkaround=platform.safari;class TextSVGDrawable extends TextStatefulDrawable$1(SVGSelfDrawable){initialize(t,s){if(super.initialize(t,s,!0,keepSVGTextElements),this.hasLength=!1,!this.svgElement){const r=document.createElementNS(svgns,"text");if(this.text=r,useTransparentSVGTextWorkaround){const o=document.createElementNS(svgns,"g");o.appendChild(r),this.svgElement=o,this.workaroundRect=document.createElementNS(svgns,"rect"),this.workaroundRect.setAttribute("fill","transparent"),o.appendChild(this.workaroundRect)}else this.svgElement=r;r.appendChild(document.createTextNode("")),r.setAttribute("dominant-baseline","alphabetic"),r.setAttribute("text-rendering","geometricPrecision"),r.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),r.setAttribute("direction","ltr")}}updateSVGSelf(){const t=this.text;if(this.dirtyFont&&(t.setAttribute("font-family",this.node._font.getFamily()),t.setAttribute("font-size",this.node._font.getSize()),t.setAttribute("font-style",this.node._font.getStyle()),t.setAttribute("font-weight",this.node._font.getWeight()),t.setAttribute("font-stretch",this.node._font.getStretch())),this.dirtyText&&(t.lastChild.nodeValue=Utils.safariEmbeddingMarkWorkaround(this.node.renderedText)),this.dirtyBounds&&useSVGTextLengthAdjustments&&(this.node._boundsMethod!=="accurate"&&isFinite(this.node.selfBounds.width)?(this.hasLength||(this.hasLength=!0,t.setAttribute("lengthAdjust","spacingAndGlyphs")),t.setAttribute("textLength",this.node.selfBounds.width)):this.hasLength&&(this.hasLength=!1,t.removeAttribute("lengthAdjust"),t.removeAttribute("textLength")),useTransparentSVGTextWorkaround)){const o=this.node.selfBounds.width*.2,n=this.node.selfBounds.height*.2;this.workaroundRect.setAttribute("x",this.node.selfBounds.minX-o),this.workaroundRect.setAttribute("y",this.node.selfBounds.minY-n),this.workaroundRect.setAttribute("width",this.node.selfBounds.width+2*o),this.workaroundRect.setAttribute("height",this.node.selfBounds.height+2*n)}this.updateFillStrokeStyle(t)}}scenery.register("TextSVGDrawable",TextSVGDrawable);Poolable.mixInto(TextSVGDrawable);const TextSVGDrawable$1=TextSVGDrawable;class WebGLNodeDrawable extends WebGLSelfDrawable{initialize(t,s){super.initialize(t,s),this.contextChangeListener=this.contextChangeListener||this.onWebGLContextChange.bind(this),this.painter=null}createPainter(){const t=this.node.painterType;return new t(this.webGLBlock.gl,this.node)}onWebGLContextChange(){this.painter=this.createPainter()}onAddToBlock(t){this.webGLBlock=t,this.painter=this.createPainter(),t.glChangedEmitter.addListener(this.contextChangeListener)}onRemoveFromBlock(t){t.glChangedEmitter.removeListener(this.contextChangeListener)}draw(){const t=this.instance.relativeTransform.matrix,s=this.painter.paint(t,this.webGLBlock.projectionMatrix);return assert&&assert(s===WebGLNode.PAINTED_SOMETHING||s===WebGLNode.PAINTED_NOTHING),assert&&assert(WebGLNode.PAINTED_NOTHING===0&&WebGLNode.PAINTED_SOMETHING===1,"Ensure we can pass the value through directly to indicate whether draw calls were made"),s}dispose(){this.painter.dispose(),this.painter=null,this.webGLBlock&&(this.webGLBlock=null),super.dispose()}markPaintDirty(){this.markDirty()}get shaderAttributes(){return this.node.shaderAttributes}}WebGLNodeDrawable.prototype.webglRenderer=Renderer.webglCustom;scenery.register("WebGLNodeDrawable",WebGLNodeDrawable);Poolable.mixInto(WebGLNodeDrawable);const WebGLNodeDrawable$1=WebGLNodeDrawable;class InlineCanvasCacheDrawable extends Drawable{constructor(t,s){super(),this.initialize(t,s)}initialize(t,s){super.initialize(t),this.instance=s}stitch(t,s,r,o){}}scenery.register("InlineCanvasCacheDrawable",InlineCanvasCacheDrawable);class SharedCanvasCacheDrawable extends Drawable{constructor(t,s,r,o){super(),this.initialize(t,s,r,o)}initialize(t,s,r,o){super.initialize(s),this.instance=r,this.sharedInstance=o}}scenery.register("SharedCanvasCacheDrawable",SharedCanvasCacheDrawable);class RelativeTransform{constructor(t){this.instance=t}initialize(t,s){return this.display=t,this.trail=s,this.node=s&&s.lastNode(),this.transformDirty=!0,this.nodeTransformListener=this.nodeTransformListener||this.onNodeTransformDirty.bind(this),this.matrix=this.matrix||Matrix3.identity(),this.relativeSelfDirty=!0,this.relativeChildrenListenersCount=0,this.relativePrecomputeCount=0,this.relativeChildrenPrecomputeCount=0,this.relativeFrameId=-1,this.relativeChildDirtyFrame=t?t._frameId:0,this.relativeTransformListeners=cleanArray(this.relativeTransformListeners),this}get parent(){return this.instance.parent?this.instance.parent.relativeTransform:null}addInstance(t){t.stateless?(assert&&assert(!t.relativeTransform.hasAncestorListenerNeed(),"We only track changes properly if stateless instances do not have needs"),assert&&assert(!t.relativeTransform.hasAncestorComputeNeed(),"We only track changes properly if stateless instances do not have needs")):(t.relativeTransform.hasAncestorListenerNeed()&&this.incrementTransformListenerChildren(),t.relativeTransform.hasAncestorComputeNeed()&&this.incrementTransformPrecomputeChildren()),t.relativeTransform.forceMarkTransformDirty()}removeInstance(t){t.relativeTransform.hasAncestorListenerNeed()&&this.decrementTransformListenerChildren(),t.relativeTransform.hasAncestorComputeNeed()&&this.decrementTransformPrecomputeChildren()}attachNodeListeners(){this.node.transformEmitter.addListener(this.nodeTransformListener)}detachNodeListeners(){this.node.transformEmitter.removeListener(this.nodeTransformListener)}hasDescendantListenerNeed(){return this.instance.isTransformed?this.relativeChildrenListenersCount>0:this.relativeChildrenListenersCount>0||this.relativeTransformListeners.length>0}hasAncestorListenerNeed(){return this.instance.isTransformed?this.relativeTransformListeners.length>0:this.relativeChildrenListenersCount>0||this.relativeTransformListeners.length>0}hasSelfListenerNeed(){return this.relativeTransformListeners.length>0}incrementTransformListenerChildren(){const t=this.hasAncestorListenerNeed();this.relativeChildrenListenersCount++,t!==this.hasAncestorListenerNeed()&&(assert&&assert(!this.instance.isTransformed,"Should not be a change in need if we have the isTransformed flag"),this.parent&&this.parent.incrementTransformListenerChildren())}decrementTransformListenerChildren(){const t=this.hasAncestorListenerNeed();this.relativeChildrenListenersCount--,t!==this.hasAncestorListenerNeed()&&(assert&&assert(!this.instance.isTransformed,"Should not be a change in need if we have the isTransformed flag"),this.parent&&this.parent.decrementTransformListenerChildren())}addListener(t){const s=this.hasAncestorListenerNeed();this.relativeTransformListeners.push(t),s!==this.hasAncestorListenerNeed()&&(this.parent&&this.parent.incrementTransformListenerChildren(),this.hasAncestorComputeNeed()||this.forceMarkTransformDirty())}removeListener(t){const s=this.hasAncestorListenerNeed();this.relativeTransformListeners.splice(_.indexOf(this.relativeTransformListeners,t),1),s!==this.hasAncestorListenerNeed()&&this.parent&&this.parent.decrementTransformListenerChildren()}hasDescendantComputeNeed(){return this.instance.isTransformed?this.relativeChildrenPrecomputeCount>0:this.relativeChildrenPrecomputeCount>0||this.relativePrecomputeCount>0}hasAncestorComputeNeed(){return this.instance.isTransformed?this.relativePrecomputeCount>0:this.relativeChildrenPrecomputeCount>0||this.relativePrecomputeCount>0}hasSelfComputeNeed(){return this.relativePrecomputeCount>0}incrementTransformPrecomputeChildren(){const t=this.hasAncestorComputeNeed();this.relativeChildrenPrecomputeCount++,t!==this.hasAncestorComputeNeed()&&(assert&&assert(!this.instance.isTransformed,"Should not be a change in need if we have the isTransformed flag"),this.parent&&this.parent.incrementTransformPrecomputeChildren())}decrementTransformPrecomputeChildren(){const t=this.hasAncestorComputeNeed();this.relativeChildrenPrecomputeCount--,t!==this.hasAncestorComputeNeed()&&(assert&&assert(!this.instance.isTransformed,"Should not be a change in need if we have the isTransformed flag"),this.parent&&this.parent.decrementTransformPrecomputeChildren())}addPrecompute(){const t=this.hasAncestorComputeNeed();this.relativePrecomputeCount++,t!==this.hasAncestorComputeNeed()&&(this.parent&&this.parent.incrementTransformPrecomputeChildren(),this.hasAncestorListenerNeed()||this.forceMarkTransformDirty())}removePrecompute(){const t=this.hasAncestorComputeNeed();this.relativePrecomputeCount--,t!==this.hasAncestorComputeNeed()&&this.parent&&this.parent.decrementTransformPrecomputeChildren()}onNodeTransformDirty(){this.transformDirty||this.forceMarkTransformDirty()}forceMarkTransformDirty(){this.transformDirty=!0,this.relativeSelfDirty=!0;const t=this.display._frameId;let s=this.instance.parent;for(;s&&s.relativeTransform.relativeChildDirtyFrame!==t;){const r=s.parent,o=s.isTransformed;if(s.relativeTransform.relativeChildDirtyFrame=t,r===null){this.display.markTransformRootDirty(s,o);break}else if(o){this.display.markTransformRootDirty(s,!0);break}s=r}}computeRelativeTransform(){const t=this.node.getMatrix();this.instance.parent&&!this.instance.parent.isTransformed?(this.matrix.set(this.parent.matrix),this.matrix.multiplyMatrix(t)):this.matrix.set(t),this.relativeFrameId=this.display._frameId,this.relativeSelfDirty=!1}isValidationNotNeeded(){return this.hasAncestorComputeNeed()||this.relativeFrameId===this.display._frameId}validate(){if(!this.isValidationNotNeeded()&&(this.instance.parent&&!this.instance.parent.isTransformed&&this.parent.validate(),this.relativeSelfDirty)){this.computeRelativeTransform();const t=this.instance.children.length;for(let s=0;s<t;s++)this.instance.children[s].relativeTransform.relativeSelfDirty=!0}}updateTransformListenersAndCompute(t,s,r,o){sceneryLog&&sceneryLog.RelativeTransform&&sceneryLog.RelativeTransform(`update/compute: ${this.toString()} ${t} => ${s}${o?" passTransform":""}`),sceneryLog&&sceneryLog.RelativeTransform&&sceneryLog.push();let n,l;if(o)for(n=this.instance.children.length,l=0;l<n;l++)this.instance.children[l].relativeTransform.updateTransformListenersAndCompute(!1,!1,r,!1);else{const h=t||this.relativeSelfDirty,g=h||this.relativeChildDirtyFrame===r,d=this.hasDescendantComputeNeed(),A=this.hasDescendantListenerNeed(),S=this.hasSelfComputeNeed(),O=this.hasSelfListenerNeed();if(!d&&h&&!s&&(this.relativeSelfDirty=!0),!g||!d&&!A&&!S&&!O){sceneryLog&&sceneryLog.RelativeTransform&&sceneryLog.pop();return}if(h&&(d||S)&&this.computeRelativeTransform(),this.transformDirty&&(this.transformDirty=!1),this.notifyRelativeTransformListeners(),!this.instance.isTransformed||o){const I=h&&!(d||S);for(n=this.instance.children.length,l=0;l<n;l++)this.instance.children[l].relativeTransform.updateTransformListenersAndCompute(h,I,r,!1)}}sceneryLog&&sceneryLog.RelativeTransform&&sceneryLog.pop()}notifyRelativeTransformListeners(){const t=this.relativeTransformListeners.length;for(let s=0;s<t;s++)this.relativeTransformListeners[s]()}audit(t,s){function r(n){const l=Matrix3.pool.fetch(),h=n.node.getMatrix();return n.parent?n.parent.isTransformed?l.set(h):(l.set(r(n.parent)),l.multiplyMatrix(h)):l.set(Matrix3.IDENTITY),l}function o(n){return s&&n.isValidationNotNeeded()?!1:n.relativeSelfDirty||n.parent&&o(n.parent)}if(assertSlow){let n=0,l=0;for(let h=0;h<this.instance.children.length;h++){const g=this.instance.children[h];g.relativeTransform.hasAncestorListenerNeed()&&n++,g.relativeTransform.hasAncestorComputeNeed()&&l++}if(assertSlow(n===this.relativeChildrenListenersCount,"Relative listener count invariant"),assertSlow(l===this.relativeChildrenPrecomputeCount,"Relative precompute count invariant"),assertSlow(!this.parent||this.instance.isTransformed||this.relativeChildDirtyFrame!==t||this.parent.relativeChildDirtyFrame===t,"If we have a parent, we need to hold the invariant this.relativeChildDirtyFrame => parent.relativeChildDirtyFrame"),!s&&!o(this)){const h=r(this);assertSlow(h.equals(this.matrix),"If there is no relativeSelfDirty flag set here or in our ancestors, our matrix should be up-to-date")}}}}scenery.register("RelativeTransform",RelativeTransform);class ChangeInterval{constructor(t,s){this.initialize(t,s)}initialize(t,s){assert&&assert(t===null||t instanceof Drawable,"drawableBefore can either be null to indicate that there is no un-changed drawable before our changes, or it can reference an un-changed drawable"),assert&&assert(s===null||s instanceof Drawable,"drawableAfter can either be null to indicate that there is no un-changed drawable after our changes, or it can reference an un-changed drawable"),this.nextChangeInterval=null,this.drawableBefore=t,this.drawableAfter=s,this.collapsedEmpty=!1}dispose(){this.nextChangeInterval=null,this.drawableBefore=null,this.drawableAfter=null,this.freeToPool()}constrict(){let t=!1;if(this.isEmpty())return!0;for(;this.drawableBefore&&this.drawableBefore.nextDrawable===this.drawableBefore.oldNextDrawable;)if(this.drawableBefore=this.drawableBefore.nextDrawable,t=!0,this.drawableBefore||(assert&&assert(!this.drawableAfter),this.collapsedEmpty=!0),this.isEmpty())return!0;for(;this.drawableAfter&&this.drawableAfter.previousDrawable===this.drawableAfter.oldPreviousDrawable;)if(this.drawableAfter=this.drawableAfter.previousDrawable,t=!0,this.drawableAfter||(assert&&assert(!this.drawableBefore),this.collapsedEmpty=!0),this.isEmpty())return!0;return t}isEmpty(){return this.collapsedEmpty||this.drawableBefore!==null&&this.drawableBefore===this.drawableAfter}getOldInternalDrawableCount(t,s){const r=this.drawableBefore?this.drawableBefore.oldNextDrawable:t,o=this.drawableAfter;let n=0;for(let l=r;l!==o;l=l.oldNextDrawable)n++;return n}getNewInternalDrawableCount(t,s){const r=this.drawableBefore?this.drawableBefore.nextDrawable:t,o=this.drawableAfter;let n=0;for(let l=r;l!==o;l=l.nextDrawable)n++;return n}static newForDisplay(t,s,r){const o=ChangeInterval.createFromPool(t,s);return r.markChangeIntervalToDispose(o),o}}scenery.register("ChangeInterval",ChangeInterval);Poolable.mixInto(ChangeInterval);class Fittability{constructor(t){this.instance=t}initialize(t,s){return this.display=t,this.trail=s,this.node=s&&s.lastNode(),this.selfFittable=!!s&&this.isSelfFitSupported(),this.ancestorsFittable=this.selfFittable,this.subtreeUnfittableCount=this.selfFittable?0:1,this.subtreeFittabilityChangeEmitter=this.subtreeFittabilityChangeEmitter||new TinyEmitter,this}get parent(){return this.instance.parent?this.instance.parent.fittability:null}checkSelfFittability(){const t=this.isSelfFitSupported();this.selfFittable!==t&&this.updateSelfFittable()}isSelfFitSupported(){return this.display._allowLayerFitting&&!this.node.isPreventFit()}markSubtreeFittable(){if(!this.selfFittable)return;this.ancestorsFittable=!0;const t=this.instance.children;for(let s=0;s<t.length;s++)t[s].fittability.markSubtreeFittable();this.instance.updateDrawableFittability(!0)}markSubtreeUnfittable(){if(!this.ancestorsFittable)return;this.ancestorsFittable=!1;const t=this.instance.children;for(let s=0;s<t.length;s++)t[s].fittability.markSubtreeUnfittable();this.instance.updateDrawableFittability(!1)}updateSelfFittable(){const t=this.isSelfFitSupported();assert&&assert(this.selfFittable!==t),this.selfFittable=t,this.selfFittable&&(!this.parent||this.parent.ancestorsFittable)?this.markSubtreeFittable():this.selfFittable||this.markSubtreeUnfittable(),this.selfFittable?this.decrementSubtreeUnfittableCount():this.incrementSubtreeUnfittableCount()}incrementSubtreeUnfittableCount(){this.subtreeUnfittableCount++,this.subtreeUnfittableCount===1&&(this.parent&&this.parent.incrementSubtreeUnfittableCount(),this.subtreeFittabilityChangeEmitter.emit())}decrementSubtreeUnfittableCount(){this.subtreeUnfittableCount--,this.subtreeUnfittableCount===0&&(this.parent&&this.parent.decrementSubtreeUnfittableCount(),this.subtreeFittabilityChangeEmitter.emit())}onInsert(t){this.ancestorsFittable||t.markSubtreeUnfittable(),t.subtreeUnfittableCount>0&&this.incrementSubtreeUnfittableCount()}onRemove(t){this.ancestorsFittable||t.markSubtreeFittable(),t.subtreeUnfittableCount>0&&this.decrementSubtreeUnfittableCount()}audit(){if(assertSlow){assertSlow(this.selfFittable===this.isSelfFitSupported(),"selfFittable diverged from isSelfFitSupported()"),assertSlow(this.ancestorsFittable===((this.parent?this.parent.ancestorsFittable:!0)&&this.selfFittable),"Our ancestorsFittable should be false if our parent or our self is not fittable.");let t=0;this.selfFittable||t++,_.each(this.instance.children,s=>{s.fittability.subtreeUnfittableCount>0&&t++}),assertSlow(this.subtreeUnfittableCount===t,"Incorrect subtreeUnfittableCount")}}}scenery.register("Fittability",Fittability);let globalId=1,clipGlobalId=1;class SVGGroup{constructor(t,s,r){this.id=`group${globalId++}`,this.initialize(t,s,r)}initialize(t,s,r){sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`initializing ${this.toString()}`),this.block=t,this.instance=s,this.node=s.trail.lastNode(),this.parent=r,this.children=cleanArray(this.children),this.hasSelfDrawable=!1,this.selfDrawable=null,this.dirty=!0,this.willApplyTransforms=this.block.transformRootInstance.trail.nodes.length<this.instance.trail.nodes.length,this.willApplyFilters=this.block.filterRootInstance.trail.nodes.length<this.instance.trail.nodes.length,this.transformDirty=!0,this.hasTransform=this.hasTransform!==void 0?this.hasTransform:!1,this.transformDirtyListener=this.transformDirtyListener||this.markTransformDirty.bind(this),this.willApplyTransforms&&this.node.transformEmitter.addListener(this.transformDirtyListener),this.filterDirty=!0,this.visibilityDirty=!0,this.clipDirty=!0,this.filterElement=this.filterElement||null,this.hasOpacity=this.hasOpacity!==void 0?this.hasOpacity:!1,this.hasFilter=!1,this.clipDefinition=this.clipDefinition!==void 0?this.clipDefinition:null,this.clipPath=this.clipPath!==void 0?this.clipPath:null,this.filterChangeListener=this.filterChangeListener||this.onFilterChange.bind(this),this.visibilityDirtyListener=this.visibilityDirtyListener||this.onVisibleChange.bind(this),this.clipDirtyListener=this.clipDirtyListener||this.onClipChange.bind(this),this.node.visibleProperty.lazyLink(this.visibilityDirtyListener),this.willApplyFilters&&this.node.filterChangeEmitter.addListener(this.filterChangeListener),this.node.clipAreaProperty.lazyLink(this.clipDirtyListener),this.orderDirty=!0,this.orderDirtyListener=this.orderDirtyListener||this.markOrderDirty.bind(this),this.node.childrenChangedEmitter.addListener(this.orderDirtyListener),this.svgGroup||(this.svgGroup=document.createElementNS(svgns,"g")),this.instance.addSVGGroup(this),this.block.markDirtyGroup(this)}addSelfDrawable(t){this.selfDrawable=t,this.svgGroup.insertBefore(t.svgElement,this.children.length?this.children[0].svgGroup:null),this.hasSelfDrawable=!0}removeSelfDrawable(t){this.hasSelfDrawable=!1,this.svgGroup.removeChild(t.svgElement),this.selfDrawable=null}addChildGroup(t){this.markOrderDirty(),t.parent=this,this.children.push(t),this.svgGroup.appendChild(t.svgGroup)}removeChildGroup(t){this.markOrderDirty(),t.parent=null,this.children.splice(_.indexOf(this.children,t),1),this.svgGroup.removeChild(t.svgGroup)}markDirty(){this.dirty||(this.dirty=!0,this.block.markDirtyGroup(this))}markOrderDirty(){this.orderDirty||(this.orderDirty=!0,this.markDirty())}markTransformDirty(){this.transformDirty||(this.transformDirty=!0,this.markDirty())}onFilterChange(){this.filterDirty||(this.filterDirty=!0,this.markDirty())}onVisibleChange(){this.visibilityDirty||(this.visibilityDirty=!0,this.markDirty())}onClipChange(){this.clipDirty||(this.clipDirty=!0,this.markDirty())}update(){if(sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`update: ${this.toString()}`),!this.block)return;sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.push();const t=this.svgGroup;if(this.dirty=!1,this.transformDirty&&(this.transformDirty=!1,sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`transform update: ${this.toString()}`),this.willApplyTransforms?this.node.transform.isIdentity()?this.hasTransform&&(this.hasTransform=!1,t.removeAttribute("transform")):(this.hasTransform=!0,t.setAttribute("transform",this.node.transform.getMatrix().getSVGTransform())):this.hasTransform&&(this.hasTransform=!1,t.removeAttribute("transform"))),this.visibilityDirty&&(this.visibilityDirty=!1,sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`visibility update: ${this.toString()}`),t.style.display=this.node.isVisible()?"":"none"),this.filterDirty){this.filterDirty=!1,sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`filter update: ${this.toString()}`);const s=this.node.effectiveOpacity;this.willApplyFilters&&s!==1?(this.hasOpacity=!0,t.setAttribute("opacity",s)):this.hasOpacity&&(this.hasOpacity=!1,t.removeAttribute("opacity"));const r=this.willApplyFilters&&this.node._filters.length,o=`filter-${this.id}`;if(r){for(this.filterElement||(this.filterElement=document.createElementNS(svgns,"filter"),this.filterElement.setAttribute("id",o));this.filterElement.firstChild;)this.filterElement.removeChild(this.filterElement.lastChild);let n=50,l="SourceGraphic";const h=this.node._filters.length;for(let A=0;A<h;A++){const S=this.node._filters[A],O=A===h-1?void 0:`e${A}`;S.applySVGFilter(this.filterElement,l,O),n+=S.filterRegionPercentageIncrease,l=O}const g=`-${toSVGNumber(n)}%`,d=`${toSVGNumber(2*n+100)}%`;this.filterElement.setAttribute("x",g),this.filterElement.setAttribute("y",g),this.filterElement.setAttribute("width",d),this.filterElement.setAttribute("height",d)}r&&(this.hasFilter||this.block.defs.appendChild(this.filterElement),t.setAttribute("filter",`url(#${o})`),this.hasFilter=!0),this.hasFilter&&!r&&(t.removeAttribute("filter"),this.hasFilter=!1,this.block.defs.removeChild(this.filterElement))}if(this.clipDirty)if(this.clipDirty=!1,sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`clip update: ${this.toString()}`),this.node.clipArea){if(!this.clipDefinition){const s=`clip${clipGlobalId++}`;this.clipDefinition=document.createElementNS(svgns,"clipPath"),this.clipDefinition.setAttribute("id",s),this.clipDefinition.setAttribute("clipPathUnits","userSpaceOnUse"),this.block.defs.appendChild(this.clipDefinition),this.clipPath=document.createElementNS(svgns,"path"),this.clipDefinition.appendChild(this.clipPath),t.setAttribute("clip-path",`url(#${s})`)}this.clipPath.setAttribute("d",this.node.clipArea.getSVGPath())}else this.clipDefinition&&(t.removeAttribute("clip-path"),this.block.defs.removeChild(this.clipDefinition),this.clipDefinition=null,this.clipPath=null);if(this.orderDirty){this.orderDirty=!1,sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`order update: ${this.toString()}`),sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.push();let s=this.children.length-1;const r=this.instance.children;for(let o=r.length-1;o>=0;o--){const n=r[o].lookupSVGGroup(this.block);if(n){if(this.children[s]!==n){sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`group out of order: ${s} for ${n.toString()}`),t.insertBefore(n.svgGroup,s+1>=this.children.length?null:this.children[s+1].svgGroup);const l=_.indexOf(this.children,n);assert&&assert(l<s,"The item we are moving backwards to location [idx] should not have an index greater than that"),this.children.splice(l,1),this.children.splice(s,0,n)}else sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`group in place: ${s} for ${n.toString()}`);s--}}sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.pop()}sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.pop()}isReleasable(){return!this.hasSelfDrawable&&!this.children.length&&this.parent}dispose(){sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`dispose ${this.toString()}`),sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.push(),assert&&assert(this.children.length===0,"Should be empty by now"),this.hasFilter&&(this.svgGroup.removeAttribute("filter"),this.hasFilter=!1,this.block.defs.removeChild(this.filterElement)),this.willApplyTransforms&&this.node.transformEmitter.removeListener(this.transformDirtyListener),this.node.visibleProperty.unlink(this.visibilityDirtyListener),this.willApplyFilters&&this.node.filterChangeEmitter.removeListener(this.filterChangeListener),this.node.clipAreaProperty.unlink(this.clipDirtyListener),this.node.childrenChangedEmitter.removeListener(this.orderDirtyListener),this.instance.active&&this.instance.removeSVGGroup(this),this.clipDefinition&&(this.svgGroup.removeAttribute("clip-path"),this.block.defs.removeChild(this.clipDefinition),this.clipDefinition=null,this.clipPath=null),this.parent=null,this.block=null,this.instance=null,this.node=null,cleanArray(this.children),this.selfDrawable=null,this.freeToPool(),sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.pop()}toString(){return`SVGGroup:${this.block.toString()}_${this.instance.toString()}`}static addDrawable(t,s){assert&&assert(s.instance,"Instance is required for a drawable to be grouped correctly in SVG"),SVGGroup.ensureGroupsToInstance(t,s.instance).addSelfDrawable(s)}static removeDrawable(t,s){s.instance.lookupSVGGroup(t).removeSelfDrawable(s),SVGGroup.releaseGroupsToInstance(t,s.instance)}static ensureGroupsToInstance(t,s){let r=s.lookupSVGGroup(t);if(!r){assert&&assert(s!==t.rootGroup.instance,"Making sure we do not walk past our rootGroup");const o=SVGGroup.ensureGroupsToInstance(t,s.parent);r=SVGGroup.createFromPool(t,s,o),o.addChildGroup(r)}return r}static releaseGroupsToInstance(t,s){const r=s.lookupSVGGroup(t);if(r.isReleasable()){const o=r.parent;o.removeChildGroup(r),SVGGroup.releaseGroupsToInstance(t,o.instance),r.dispose()}}}scenery.register("SVGGroup",SVGGroup);Poolable.mixInto(SVGGroup);class Block extends Drawable{initialize(t,s){assert&&assert(!t._isDisposing,"Should not create a block for a Display that is being disposed of"),assert&&assert(!t._isDisposed,"Should not create a block for a disposed Display"),super.initialize(s),this.display=t,this.drawableCount=0,this.used=!0,this.firstDrawable=null,this.lastDrawable=null,this.pendingFirstDrawable=null,this.pendingLastDrawable=null,this.previousBlock=null,this.nextBlock=null,this.zIndex=0,assertSlow&&(this.drawableList=cleanArray(this.drawableList))}dispose(){assert&&assert(this.drawableCount===0,"There should be no drawables on a block when it is disposed"),this.display=null,this.firstDrawable=null,this.lastDrawable=null,this.pendingFirstDrawable=null,this.pendingLastDrawable=null,this.previousBlock=null,this.nextBlock=null,assertSlow&&cleanArray(this.drawableList),super.dispose()}addDrawable(t){if(this.drawableCount++,this.markDirtyDrawable(t),assertSlow){const s=_.indexOf(this.drawableList,t);assertSlow&&assertSlow(s===-1,"Drawable should not be added when it has not been removed"),this.drawableList.push(t),assertSlow&&assertSlow(this.drawableCount===this.drawableList.length,"Count sanity check, to make sure our assertions are not buggy")}}removeDrawable(t){if(this.drawableCount--,this.markDirty(),assertSlow){const s=_.indexOf(this.drawableList,t);assertSlow&&assertSlow(s!==-1,"Drawable should be already added when it is removed"),this.drawableList.splice(s,1),assertSlow&&assertSlow(this.drawableCount===this.drawableList.length,"Count sanity check, to make sure our assertions are not buggy")}}onIntervalChange(t,s){}updateInterval(){(this.pendingFirstDrawable!==this.firstDrawable||this.pendingLastDrawable!==this.lastDrawable)&&(this.onIntervalChange(this.pendingFirstDrawable,this.pendingLastDrawable),this.firstDrawable=this.pendingFirstDrawable,this.lastDrawable=this.pendingLastDrawable)}notifyInterval(t,s){this.pendingFirstDrawable=t,this.pendingLastDrawable=s,this.updateInterval()}audit(t,s,r){if(assertSlow){super.audit(t,s,r);let o=0;if(!s){for(let n=this.firstDrawable;n!==null&&(n.audit(t,s,r),o++,n!==this.lastDrawable);n=n.nextDrawable);if(!t){assertSlow&&assertSlow(o===this.drawableCount,"drawableCount should match"),assertSlow&&assertSlow(this.firstDrawable===this.pendingFirstDrawable,"No pending first drawable"),assertSlow&&assertSlow(this.lastDrawable===this.pendingLastDrawable,"No pending last drawable");for(let n=this.firstDrawable;n!==null&&(assertSlow&&assertSlow(n.renderer===this.renderer,"Renderers should match"),assertSlow&&assertSlow(n.parentDrawable===this,"This block should be this drawable's parent"),assertSlow&&assertSlow(_.indexOf(this.drawableList,n)>=0),n!==this.lastDrawable);n=n.nextDrawable);}}}}}scenery.register("Block",Block);const Block$1=Block,scratchBounds2=Bounds2.NOTHING.copy();class FittedBlock extends Block$1{initialize(t,s,r,o){return super.initialize(t,s),this.transformRootInstance=r,assert&&assert(typeof r.isDisplayRoot=="boolean"),this.canBeFullDisplay=r.isDisplayRoot,assert&&assert(o===FittedBlock.FULL_DISPLAY||o===FittedBlock.COMMON_ANCESTOR),this.preferredFit=o,this.fit=o,this.dirtyFit=!0,this.commonFitInstance=null,this.fitBounds=Bounds2.NOTHING.copy(),this.oldFitBounds=Bounds2.NOTHING.copy(),this.unfittableDrawableCount=0,this.dirtyFitListener=this.dirtyFitListener||this.markDirtyFit.bind(this),this.fittableListener=this.fittableListener||this.onFittabilityChange.bind(this),this.display.sizeProperty.lazyLink(this.dirtyFitListener),this}setFit(t){!this.canBeFullDisplay&&t===FittedBlock.FULL_DISPLAY&&(t=FittedBlock.COMMON_ANCESTOR),this.fit!==t&&(this.fit=t,this.markDirtyFit(),this.oldFitBounds.set(Bounds2.NOTHING),t===FittedBlock.COMMON_ANCESTOR&&this.removeCommonFitInstance())}markDirtyFit(){sceneryLog&&sceneryLog.dirty&&sceneryLog.dirty(`markDirtyFit on FittedBlock#${this.id}`),this.dirtyFit=!0,this.markDirty()}updateFit(){if(assert&&assert(this.fit===FittedBlock.FULL_DISPLAY||this.fit===FittedBlock.COMMON_ANCESTOR,"Unsupported fit"),!(!this.dirtyFit&&this.fit===FittedBlock.FULL_DISPLAY))if(sceneryLog&&sceneryLog.FittedBlock&&sceneryLog.FittedBlock(`updateFit #${this.id}`),this.dirtyFit=!1,this.fit===FittedBlock.COMMON_ANCESTOR&&this.commonFitInstance===null&&this.addCommonFitInstance(this.computeCommonAncestorInstance()),this.fit===FittedBlock.COMMON_ANCESTOR&&this.commonFitInstance.fittability.subtreeUnfittableCount>0&&this.canBeFullDisplay&&(this.oldFitBounds.set(Bounds2.NOTHING),this.fit=FittedBlock.FULL_DISPLAY),this.fit===FittedBlock.FULL_DISPLAY)this.fitBounds.set(Bounds2.NOTHING),this.setSizeFullDisplay();else if(this.fit===FittedBlock.COMMON_ANCESTOR){assert&&assert(this.commonFitInstance.trail.length>=this.transformRootInstance.trail.length),this.fitBounds.set(this.commonFitInstance.node.getLocalBounds());let t=this.commonFitInstance;for(;t!==this.transformRootInstance;)this.fitBounds.transform(t.node.getMatrix()),t=t.parent;this.fitBounds.roundOut(),this.fitBounds.dilate(4),this.transformRootInstance.isDisplayRoot&&(scratchBounds2.setMinMax(0,0,this.display.width,this.display.height),this.fitBounds.constrainBounds(scratchBounds2)),this.fitBounds.isValid()||this.fitBounds.setMinMax(0,0,0,0),this.fitBounds.equals(this.oldFitBounds)||(this.oldFitBounds.set(this.fitBounds),this.setSizeFitBounds())}else throw new Error("unknown fit")}setSizeFullDisplay(){}setSizeFitBounds(){}addCommonFitInstance(t){assert&&assert(this.commonFitInstance===null),t&&(this.commonFitInstance=t,this.commonFitInstance.fittability.subtreeFittabilityChangeEmitter.addListener(this.dirtyFitListener))}removeCommonFitInstance(){this.commonFitInstance&&(this.commonFitInstance.fittability.subtreeFittabilityChangeEmitter.removeListener(this.dirtyFitListener),this.commonFitInstance=null)}dispose(){sceneryLog&&sceneryLog.FittedBlock&&sceneryLog.FittedBlock(`dispose #${this.id}`),this.display.sizeProperty.unlink(this.dirtyFitListener),this.removeCommonFitInstance(),this.transformRootInstance=null,super.dispose()}addDrawable(t){super.addDrawable(t),t.fittableProperty.lazyLink(this.fittableListener),t.fittable||this.incrementUnfittable()}removeDrawable(t){super.removeDrawable(t),t.fittableProperty.unlink(this.fittableListener),t.fittable||this.decrementUnfittable()}onFittabilityChange(t){t?this.decrementUnfittable():this.incrementUnfittable()}incrementUnfittable(){this.unfittableDrawableCount++,this.unfittableDrawableCount===1&&this.checkFitConstraints()}decrementUnfittable(){this.unfittableDrawableCount--,this.unfittableDrawableCount===0&&this.checkFitConstraints()}checkFitConstraints(){this.unfittableDrawableCount>0&&this.canBeFullDisplay?this.setFit(FittedBlock.FULL_DISPLAY):this.setFit(this.preferredFit)}computeCommonAncestorInstance(){assert&&assert(this.firstDrawable.instance&&this.lastDrawable.instance,"For common-ancestor fits, we need the first and last drawables to have direct instance references");let t=this.firstDrawable.instance,s=this.lastDrawable.instance;const r=Math.min(t.trail.length,s.trail.length);for(;t.trail.length>r;)t=t.parent;for(;s.trail.length>r;)s=s.parent;for(;t!==s;)t=t.parent,s=s.parent;const o=t;return assert&&assert(o.trail.length>=this.transformRootInstance.trail.length),o}onIntervalChange(t,s){sceneryLog&&sceneryLog.FittedBlock&&sceneryLog.FittedBlock(`#${this.id}.onIntervalChange ${t.toString()} to ${s.toString()}`),super.onIntervalChange(t,s),this.fit===FittedBlock.COMMON_ANCESTOR&&(this.removeCommonFitInstance(),this.markDirtyFit())}}scenery.register("FittedBlock",FittedBlock);FittedBlock.FULL_DISPLAY=1;FittedBlock.COMMON_ANCESTOR=2;FittedBlock.fitString={1:"fullDisplay",2:"commonAncestor"};const FittedBlock$1=FittedBlock,scratchMatrix=new Matrix3,scratchMatrix2=new Matrix3;class CanvasBlock extends FittedBlock$1{constructor(t,s,r,o){super(),this.initialize(t,s,r,o)}initialize(t,s,r,o){super.initialize(t,s,r,FittedBlock$1.COMMON_ANCESTOR),this.filterRootInstance=o,this.dirtyDrawables=cleanArray(this.dirtyDrawables),this.domElement||(this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.left="0",this.canvas.style.top="0",this.canvas.style.pointerEvents="none",this.canvasId=this.canvas.id=`scenery-canvas${this.id}`,this.context=this.canvas.getContext("2d"),this.context.save(),this.context.miterLimit=20,this.context.miterLimit=10,this.wrapper=new CanvasContextWrapper(this.canvas,this.context),this.domElement=this.canvas,this.wrapperStack=[this.wrapper]),this.wrapperStackIndex=0,this.filterListenerCountMap=this.filterListenerCountMap||{},Utils.prepareForTransform(this.canvas),Utils.unsetTransform(this.canvas),this.canvasDrawOffset=new Vector2(0,0),this.currentDrawable=null,this.clipDirty=!0,this.clipCount=0,this.backingScale=s&Renderer.bitmaskCanvasLowResolution?1:Utils.backingScale(this.context),this.clipDirtyListener=this.markDirty.bind(this),this.opacityDirtyListener=this.markDirty.bind(this),sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`initialized #${this.id}`)}setSizeFullDisplay(){const t=this.display.getSize();this.canvas.width=t.width*this.backingScale,this.canvas.height=t.height*this.backingScale,this.canvas.style.width=`${t.width}px`,this.canvas.style.height=`${t.height}px`,this.wrapper.resetStyles(),this.canvasDrawOffset.setXY(0,0),Utils.unsetTransform(this.canvas)}setSizeFitBounds(){const t=this.fitBounds.minX,s=this.fitBounds.minY;this.canvasDrawOffset.setXY(-t,-s),Utils.setTransform(`matrix(1,0,0,1,${t},${s})`,this.canvas),this.canvas.width=this.fitBounds.width*this.backingScale,this.canvas.height=this.fitBounds.height*this.backingScale,this.canvas.style.width=`${this.fitBounds.width}px`,this.canvas.style.height=`${this.fitBounds.height}px`,this.wrapper.resetStyles()}update(){if(!super.update())return!1;for(sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`update #${this.id}`),sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.push();this.dirtyDrawables.length;)this.dirtyDrawables.pop().update();this.updateFit(),this.context.restore(),this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.save(),this.wrapper.resetStyles(),this.currentDrawable=null;for(let t=this.firstDrawable;t!==null&&(this.renderDrawable(t),t!==this.lastDrawable);t=t.nextDrawable);return this.currentDrawable&&this.walkDown(this.currentDrawable.instance.trail,0),assert&&assert(this.clipCount===0,"clipCount should be zero after walking back down"),sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.pop(),!0}applyClip(t){this.clipDirty=!1,sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`Apply clip ${t.instance.trail.toDebugString()}`),sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.push();const s=this.wrapperStack[this.wrapperStackIndex],r=s.context;if(r.restore(),r.save(),s.resetStyles(),this.clipCount){const n=t.instance.trail;scratchMatrix.rowMajor(this.backingScale,0,this.canvasDrawOffset.x*this.backingScale,0,this.backingScale,this.canvasDrawOffset.y*this.backingScale,0,0,1),scratchMatrix2.set(this.transformRootInstance.trail.getMatrix()).invert(),scratchMatrix2.multiplyMatrix(scratchMatrix).canvasSetTransform(r);for(let l=0;l<n.length;l++){const h=n.nodes[l];h.getMatrix().canvasAppendTransform(r),h.hasClipArea()&&(r.beginPath(),h.clipArea.writeToContext(r),r.clip())}}sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.pop()}pushWrapper(){if(this.wrapperStackIndex++,this.clipDirty=!0,this.wrapperStackIndex===this.wrapperStack.length){const r=document.createElement("canvas"),o=r.getContext("2d");o.save(),this.wrapperStack.push(new CanvasContextWrapper(r,o))}const t=this.wrapperStack[this.wrapperStackIndex],s=t.context;t.setDimensions(this.canvas.width,this.canvas.height),s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,this.canvas.width,this.canvas.height)}popWrapper(){this.wrapperStackIndex--,this.clipDirty=!0}walkDown(t,s){const r=this.filterRootInstance.trail.length-1;for(let o=t.length-1;o>=s;o--){const n=t.nodes[o];if(n.hasClipArea()&&(sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`Pop clip ${t.subtrailTo(n).toDebugString()}`),this.clipCount--,this.clipDirty=!0),o>r){if(n._filters.length){sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`Pop filters ${t.subtrailTo(n).toDebugString()}`);const l=this.wrapperStack[this.wrapperStackIndex],h=this.wrapperStack[this.wrapperStackIndex-1];this.popWrapper(),h.context.setTransform(1,0,0,1,0,0);const g=n._filters;let d=Features.canvasFilter;for(let A=0;A<g.length;A++)d=d&&g[A].isDOMCompatible();if(d){let A="";for(let S=0;S<g.length;S++)A+=`${A?" ":""}${g[S].getCSSFilterString()}`;h.context.filter=A,h.context.drawImage(l.canvas,0,0),h.context.filter="none"}else{for(let A=0;A<g.length;A++)g[A].applyCanvasFilter(l);h.context.drawImage(l.canvas,0,0)}}if(n.getEffectiveOpacity()!==1){sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`Pop opacity ${t.subtrailTo(n).toDebugString()}`);const l=this.wrapperStack[this.wrapperStackIndex],h=this.wrapperStack[this.wrapperStackIndex-1];this.popWrapper(),h.context.setTransform(1,0,0,1,0,0),h.context.globalAlpha=n.getEffectiveOpacity(),h.context.drawImage(l.canvas,0,0),h.context.globalAlpha=1}}}}walkUp(t,s){const r=this.filterRootInstance.trail.length-1;for(let o=s;o<t.length;o++){const n=t.nodes[o];o>r&&(n.getEffectiveOpacity()!==1&&(sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`Push opacity ${t.subtrailTo(n).toDebugString()}`),this.pushWrapper()),n._filters.length&&(sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`Push filters ${t.subtrailTo(n).toDebugString()}`),this.pushWrapper())),n.hasClipArea()&&(sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`Push clip ${t.subtrailTo(n).toDebugString()}`),this.clipCount++,this.clipDirty=!0)}}renderDrawable(t){if(!t.visible||this.canvas.width===0||this.canvas.height===0)return;sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`renderDrawable #${t.id} ${t.instance.trail.toDebugString()}`),sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.push();const s=this.currentDrawable?t.instance.getBranchIndexTo(this.currentDrawable.instance):0;this.currentDrawable&&this.walkDown(this.currentDrawable.instance.trail,s),this.walkUp(t.instance.trail,s);const r=this.wrapperStack[this.wrapperStackIndex],o=r.context;this.clipDirty&&this.applyClip(t),assert&&assert(t.instance.relativeTransform.isValidationNotNeeded());const n=t.instance.relativeTransform.matrix;o.setTransform(this.backingScale,0,0,this.backingScale,this.canvasDrawOffset.x*this.backingScale,this.canvasDrawOffset.y*this.backingScale),t.instance!==this.transformRootInstance&&n.canvasAppendTransform(o),t.paintCanvas(r,t.instance.node,t.instance.relativeTransform.matrix),this.currentDrawable=t,sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.pop()}dispose(){sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`dispose #${this.id}`),this.transformRootInstance=null,cleanArray(this.dirtyDrawables),this.canvas.width=0,this.canvas.height=0,super.dispose()}markDirtyDrawable(t){sceneryLog&&sceneryLog.dirty&&sceneryLog.dirty(`markDirtyDrawable on CanvasBlock#${this.id} with ${t.toString()}`),assert&&assert(t),assert&&this.display.ensureNotPainting(),this.dirtyDrawables.push(t),this.markDirty()}addDrawable(t){sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`#${this.id}.addDrawable ${t.toString()}`),super.addDrawable(t);for(let s=t.instance;s&&s!==this.filterRootInstance;s=s.parent){const r=s.node;this.filterListenerCountMap[r.id]?this.filterListenerCountMap[r.id]++:(this.filterListenerCountMap[r.id]=1,r.filterChangeEmitter.addListener(this.opacityDirtyListener),r.clipAreaProperty.lazyLink(this.clipDirtyListener))}}removeDrawable(t){sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`#${this.id}.removeDrawable ${t.toString()}`);for(let s=t.instance;s&&s!==this.filterRootInstance;s=s.parent){const r=s.node;assert&&assert(this.filterListenerCountMap[r.id]>0),this.filterListenerCountMap[r.id]--,this.filterListenerCountMap[r.id]===0&&(delete this.filterListenerCountMap[r.id],r.clipAreaProperty.unlink(this.clipDirtyListener),r.filterChangeEmitter.removeListener(this.opacityDirtyListener))}super.removeDrawable(t)}onIntervalChange(t,s){sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`#${this.id}.onIntervalChange ${t.toString()} to ${s.toString()}`),super.onIntervalChange(t,s),this.markDirty()}onPotentiallyMovedDrawable(t){sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`#${this.id}.onPotentiallyMovedDrawable ${t.toString()}`),sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.push(),assert&&assert(t.parentDrawable===this),t.markDirty(),sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.pop()}toString(){return`CanvasBlock#${this.id}-${FittedBlock$1.fitString[this.fit]}`}}scenery.register("CanvasBlock",CanvasBlock);Poolable.mixInto(CanvasBlock);const CanvasBlock$1=CanvasBlock;class DOMBlock extends Block$1{constructor(t,s){super(),this.initialize(t,s)}initialize(t,s){return super.initialize(t,s.renderer),this.domDrawable=s,this.domElement=s.domElement,this}update(){return super.update()?(this.domDrawable.update(),!0):!1}dispose(){this.domDrawable=null,this.domElement=null,super.dispose()}markDirtyDrawable(t){this.markDirty()}addDrawable(t){sceneryLog&&sceneryLog.DOMBlock&&sceneryLog.DOMBlock(`#${this.id}.addDrawable ${t.toString()}`),assert&&assert(this.domDrawable===t,"DOMBlock should only be used with one drawable for now (the one it was initialized with)"),super.addDrawable(t)}removeDrawable(t){sceneryLog&&sceneryLog.DOMBlock&&sceneryLog.DOMBlock(`#${this.id}.removeDrawable ${t.toString()}`),assert&&assert(this.domDrawable===t,"DOMBlock should only be used with one drawable for now (the one it was initialized with)"),super.removeDrawable(t)}}scenery.register("DOMBlock",DOMBlock);Poolable.mixInto(DOMBlock);const DOMBlock$1=DOMBlock;class SVGBlock extends FittedBlock$1{constructor(t,s,r,o){super(),this.initialize(t,s,r,o)}initialize(t,s,r,o){super.initialize(t,s,r,FittedBlock$1.COMMON_ANCESTOR),this.filterRootInstance=o,this.dirtyGradients=cleanArray(this.dirtyGradients),this.dirtyGroups=cleanArray(this.dirtyGroups),this.dirtyDrawables=cleanArray(this.dirtyDrawables),this.paintCountMap=this.paintCountMap||new CountMap(this.onAddPaint.bind(this),this.onRemovePaint.bind(this)),this.areReferencesReduced=!0,this.domElement||(this.svg=document.createElementNS(svgns,"svg"),this.svg.style.position="absolute",this.svg.style.left="0",this.svg.style.top="0",this.svg.setAttribute("focusable",!1),this.svg.style["pointer-events"]="none",this.defs=document.createElementNS(svgns,"defs"),this.svg.appendChild(this.defs),this.baseTransformGroup=document.createElementNS(svgns,"g"),this.svg.appendChild(this.baseTransformGroup),this.domElement=this.svg),this.forceRefreshListener=()=>{if(!this.workaroundRect){const d=document.createElementNS(svgns,"g");this.svg.appendChild(d),this.workaroundRect=document.createElementNS(svgns,"rect"),this.workaroundRect.setAttribute("width","0"),this.workaroundRect.setAttribute("height","0"),this.workaroundRect.setAttribute("fill","none"),d.appendChild(this.workaroundRect)}const l=dotRandom.nextIntBetween(0,255),h=dotRandom.nextIntBetween(0,255),g=dotRandom.nextIntBetween(0,255);this.workaroundRect.setAttribute("fill",`rgba(${l},${h},${g},0.02)`)},this.display._refreshSVGEmitter.addListener(this.forceRefreshListener),Utils.prepareForTransform(this.svg),Utils.unsetTransform(this.svg),this.baseTransformGroup.setAttribute("transform","");const n=r.trail.nodes.length>o.trail.nodes.length?o:r;return this.rootGroup=SVGGroup.createFromPool(this,n,null),this.baseTransformGroup.appendChild(this.rootGroup.svgGroup),sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`initialized #${this.id}`),this}onAddPaint(t){const s=t.createSVGPaint(this);return s.definition.setAttribute("id",`${t.id}-${this.id}`),this.defs.appendChild(s.definition),s}onRemovePaint(t,s){this.defs.removeChild(s.definition),s.dispose()}incrementPaint(t){assert&&assert(t.isPaint),sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`incrementPaint ${this} ${t}`),this.paintCountMap.increment(t)}decrementPaint(t){assert&&assert(t.isPaint),sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`decrementPaint ${this} ${t}`),this.paintCountMap.decrement(t)}markDirtyGradient(t){this.dirtyGradients.push(t),this.markDirty()}markDirtyGroup(t){this.dirtyGroups.push(t),this.markDirty(),this.areReferencesReduced&&this.display.markForReducedReferences(this),this.areReferencesReduced=!1}markDirtyDrawable(t){sceneryLog&&sceneryLog.dirty&&sceneryLog.dirty(`markDirtyDrawable on SVGBlock#${this.id} with ${t.toString()}`),this.dirtyDrawables.push(t),this.markDirty(),this.areReferencesReduced&&this.display.markForReducedReferences(this),this.areReferencesReduced=!1}setSizeFullDisplay(){sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`setSizeFullDisplay #${this.id}`),this.baseTransformGroup.removeAttribute("transform"),Utils.unsetTransform(this.svg);const t=this.display.getSize();this.svg.setAttribute("width",t.width),this.svg.setAttribute("height",t.height)}setSizeFitBounds(){sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`setSizeFitBounds #${this.id} with ${this.fitBounds.toString()}`);const t=this.fitBounds.minX,s=this.fitBounds.minY;assert&&assert(isFinite(t)&&isFinite(s),"Invalid SVG transform for SVGBlock"),assert&&assert(this.fitBounds.isValid(),"Invalid fitBounds"),this.baseTransformGroup.setAttribute("transform",`translate(${-t},${-s})`),Utils.setTransform(`matrix(1,0,0,1,${t},${s})`,this.svg),this.svg.setAttribute("width",this.fitBounds.width),this.svg.setAttribute("height",this.fitBounds.height)}update(){if(!super.update())return!1;for(sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`update #${this.id}`);this.dirtyGroups.length;){const t=this.dirtyGroups.pop();t.block===this&&t.update()}for(;this.dirtyGradients.length;)this.dirtyGradients.pop().update();for(;this.dirtyDrawables.length;){const t=this.dirtyDrawables.pop();t.parentDrawable===this&&t.update()}return this.areReferencesReduced=!0,this.updateFit(),!0}reduceReferences(){if(this.areReferencesReduced)return;let t=0,s=0;for(;t<this.dirtyGroups.length;){const r=this.dirtyGroups[t];r.block===this&&(s!==t&&(this.dirtyGroups[s]=r),s++),t++}for(;this.dirtyGroups.length>s;)this.dirtyGroups.pop();for(t=0,s=0;t<this.dirtyDrawables.length;){const r=this.dirtyDrawables[t];r.parentDrawable===this&&(s!==t&&(this.dirtyDrawables[s]=r),s++),t++}for(;this.dirtyDrawables.length>s;)this.dirtyDrawables.pop();this.areReferencesReduced=!0}dispose(){for(sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`dispose #${this.id}`),this.svg.setAttribute("width","0"),this.svg.setAttribute("height","0"),this.filterRootInstance=null,cleanArray(this.dirtyGradients),cleanArray(this.dirtyGroups),cleanArray(this.dirtyDrawables),this.paintCountMap.clear(),this.display._refreshSVGEmitter.removeListener(this.forceRefreshListener),this.baseTransformGroup.removeChild(this.rootGroup.svgGroup),this.rootGroup.dispose(),this.rootGroup=null;this.defs.childNodes.length;)this.defs.removeChild(this.defs.childNodes[0]);super.dispose()}addDrawable(t){sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`#${this.id}.addDrawable ${t.toString()}`),super.addDrawable(t),SVGGroup.addDrawable(this,t),t.updateSVGBlock(this)}removeDrawable(t){sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`#${this.id}.removeDrawable ${t.toString()}`),SVGGroup.removeDrawable(this,t),super.removeDrawable(t)}onIntervalChange(t,s){sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`#${this.id}.onIntervalChange ${t.toString()} to ${s.toString()}`),super.onIntervalChange(t,s)}toString(){return`SVGBlock#${this.id}-${FittedBlock$1.fitString[this.fit]}`}}scenery.register("SVGBlock",SVGBlock);Poolable.mixInto(SVGBlock);class WebGLBlock extends FittedBlock$1{constructor(t,s,r,o){super(),this.initialize(t,s,r,o)}initialize(t,s,r,o){return sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`initialize #${this.id}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push(),super.initialize(t,s,r,FittedBlock$1.FULL_DISPLAY),this.filterRootInstance=o,this.preserveDrawingBuffer=t._preserveDrawingBuffer,this.dirtyDrawables=cleanArray(this.dirtyDrawables),this.spriteSheets=this.spriteSheets||[],this.projectionMatrix=this.projectionMatrix||new Matrix3,this.projectionMatrixArray=new Float32Array(9),this.customProcessor=this.customProcessor||new CustomProcessor,this.vertexColorPolygonsProcessor=this.vertexColorPolygonsProcessor||new VertexColorPolygons(this.projectionMatrixArray),this.texturedTrianglesProcessor=this.texturedTrianglesProcessor||new TexturedTrianglesProcessor(this.projectionMatrixArray),this.glChangedEmitter=new TinyEmitter,this.isContextLost=!1,this.contextLostListener=this.onContextLoss.bind(this),this.contextRestoreListener=this.onContextRestoration.bind(this),this.domElement||(this.domElement=document.createElement("div"),this.domElement.className="webgl-container",this.domElement.style.position="absolute",this.domElement.style.left="0",this.domElement.style.top="0",this.rebuildCanvas()),this.gl.clear(this.gl.COLOR_BUFFER_BIT),Utils.prepareForTransform(this.canvas),Utils.unsetTransform(this.canvas),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop(),this}rebuildCanvas(){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`rebuildCanvas #${this.id}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push();const t=document.createElement("canvas"),s=this.getContextFromCanvas(t);assert&&assert(s||this.canvas,"We should have a WebGL context by now"),s&&(this.canvas&&(this.domElement.removeChild(this.canvas),this.canvas.removeEventListener("webglcontextlost",this.contextLostListener,!1),this.canvas.removeEventListener("webglcontextrestored",this.contextRestoreListener,!1)),this.canvas=t,this.canvas.style.pointerEvents="none",this.canvasId=this.canvas.id=`scenery-webgl${this.id}`,this.canvas.addEventListener("webglcontextlost",this.contextLostListener,!1),this.canvas.addEventListener("webglcontextrestored",this.contextRestoreListener,!1),this.domElement.appendChild(this.canvas),this.setupContext(s)),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop()}setupContext(t){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`setupContext #${this.id}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push(),assert&&assert(t,"Should have an actual context if this is called"),this.isContextLost=!1,this.gl=t,this.backingScale=Utils.backingScale(this.gl),this.display._allowBackingScaleAntialiasing&&t.getParameter(t.SAMPLES)===0&&(this.backingScale*=2),this.originalBackingScale=this.backingScale,Utils.applyWebGLContextDefaults(this.gl),this.markDirty(),this.dirtyFit=!0,this.customProcessor.initializeContext(this.gl),this.vertexColorPolygonsProcessor.initializeContext(this.gl),this.texturedTrianglesProcessor.initializeContext(this.gl);for(let s=0;s<this.spriteSheets.length;s++)this.spriteSheets[s].initializeContext(this.gl);this.glChangedEmitter.emit(),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop()}delayedRebuildCanvas(){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`Delaying rebuilding of Canvas #${this.id}`);const t=this;window.setTimeout(function(){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`Executing delayed rebuilding #${this.id}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push(),t.rebuildCanvas(),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop()})}onContextLoss(t){this.isContextLost||(sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`Context lost #${this.id}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push(),this.isContextLost=!0,t.preventDefault(),this.canvas.style.display="none",this.markDirty(),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop())}onContextRestoration(t){if(this.isContextLost){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`Context restored #${this.id}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push();const s=this.getContextFromCanvas(this.canvas);assert&&assert(s,"We were told the context was restored, so this should work"),this.setupContext(s),this.canvas.style.display="",sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop()}}getContextFromCanvas(t){const s={antialias:!0,preserveDrawingBuffer:this.preserveDrawingBuffer};return t.getContext("webgl",s)||t.getContext("experimental-webgl",s)}setSizeFullDisplay(){const t=this.display.getSize();this.canvas.width=Math.ceil(t.width*this.backingScale),this.canvas.height=Math.ceil(t.height*this.backingScale),this.canvas.style.width=`${t.width}px`,this.canvas.style.height=`${t.height}px`}setSizeFitBounds(){throw new Error("setSizeFitBounds unimplemented for WebGLBlock")}update(){if(!super.update())return!1;sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`update #${this.id}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push();const t=this.gl;for(this.isContextLost&&this.display._aggressiveContextRecreation&&this.delayedRebuildCanvas();this.dirtyDrawables.length;)this.dirtyDrawables.pop().update();const s=this.spriteSheets.length;for(let n=0;n<s;n++)this.spriteSheets[n].updateTexture();this.firstDrawable&&this.firstDrawable===this.lastDrawable&&this.firstDrawable.node&&this.firstDrawable.node._webglScale!==null&&this.backingScale!==this.originalBackingScale*this.firstDrawable.node._webglScale&&(this.backingScale=this.originalBackingScale*this.firstDrawable.node._webglScale,this.dirtyFit=!0),this.updateFit(),this.projectionMatrix.rowMajor(2/this.display.width,0,-1,0,-2/this.display.height,1,0,0,1),this.projectionMatrix.copyToArray(this.projectionMatrixArray),this.preserveDrawingBuffer&&t.clear(t.COLOR_BUFFER_BIT),t.viewport(0,0,this.canvas.width,this.canvas.height);let r=null,o=0;for(let n=this.firstDrawable;n!==null;n=n.nextDrawable){if(n.visible){let l=null;n.webglRenderer===Renderer.webglTexturedTriangles?l=this.texturedTrianglesProcessor:n.webglRenderer===Renderer.webglCustom?l=this.customProcessor:n.webglRenderer===Renderer.webglVertexColorPolygons&&(l=this.vertexColorPolygonsProcessor),assert&&assert(l),l!==r&&(r&&(o+=r.deactivate()),r=l,r.activate()),r.processDrawable(n)}if(n===this.lastDrawable)break}return r&&(o+=r.deactivate()),o===0&&!this.preserveDrawingBuffer&&t.clear(t.COLOR_BUFFER_BIT),t.flush(),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop(),!0}dispose(){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`dispose #${this.id}`),cleanArray(this.dirtyDrawables),super.dispose()}markDirtyDrawable(t){sceneryLog&&sceneryLog.dirty&&sceneryLog.dirty(`markDirtyDrawable on WebGLBlock#${this.id} with ${t.toString()}`),assert&&assert(t),assert&&assert(!t.isDisposed),this.dirtyDrawables.push(t),this.markDirty()}addDrawable(t){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`#${this.id}.addDrawable ${t.toString()}`),super.addDrawable(t),t.onAddToBlock(this)}removeDrawable(t){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`#${this.id}.removeDrawable ${t.toString()}`);let s=0;for(;(s=this.dirtyDrawables.indexOf(t,s))>=0;)this.dirtyDrawables.splice(s,1);t.onRemoveFromBlock(this),super.removeDrawable(t)}addSpriteSheetImage(t,s,r){let o=null;const n=this.spriteSheets.length;for(let l=0;l<n&&(o=this.spriteSheets[l].addImage(t,s,r),!o);l++);if(!o){const l=new SpriteSheet(!0);if(o=l.addImage(t,s,r),l.initializeContext(this.gl),this.spriteSheets.push(l),!o)throw new Error("Attempt to load image that is too large for sprite sheets")}return o}removeSpriteSheetImage(t){t.spriteSheet.removeImage(t.image)}onIntervalChange(t,s){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`#${this.id}.onIntervalChange ${t.toString()} to ${s.toString()}`),super.onIntervalChange(t,s),this.markDirty()}onPotentiallyMovedDrawable(t){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`#${this.id}.onPotentiallyMovedDrawable ${t.toString()}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push(),assert&&assert(t.parentDrawable===this),this.markDirty(),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop()}toString(){return`WebGLBlock#${this.id}-${FittedBlock$1.fitString[this.fit]}`}}scenery.register("WebGLBlock",WebGLBlock);class Processor{activate(){}initializeContext(t){}processDrawable(t){}deactivate(){}}class CustomProcessor extends Processor{constructor(){super(),this.drawable=null}activate(){this.drawCount=0}processDrawable(t){assert&&assert(t.webglRenderer===Renderer.webglCustom),this.drawable=t,this.draw()}deactivate(){return this.drawCount}draw(){if(this.drawable){const t=this.drawable.draw();assert&&assert(typeof t=="number"),this.drawCount+=t,this.drawable=null}}}class VertexColorPolygons extends Processor{constructor(t){assert&&assert(t instanceof Float32Array),super(),this.projectionMatrixArray=t,this.lastArrayLength=128,this.vertexArray=new Float32Array(this.lastArrayLength)}initializeContext(t){assert&&assert(t,"Should be an actual context"),this.gl=t,this.shaderProgram=new ShaderProgram(t,["attribute vec2 aVertex;","attribute vec4 aColor;","varying vec4 vColor;","uniform mat3 uProjectionMatrix;","void main() {","  vColor = aColor;","  vec3 ndc = uProjectionMatrix * vec3( aVertex, 1.0 );","  gl_Position = vec4( ndc.xy, 0.0, 1.0 );","}"].join(`
`),["precision mediump float;","varying vec4 vColor;","void main() {","  gl_FragColor = vec4( vColor.rgb * vColor.a, vColor.a );","}"].join(`
`),{attributes:["aVertex","aColor"],uniforms:["uProjectionMatrix"]}),this.vertexBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertexArray,t.DYNAMIC_DRAW)}activate(){this.shaderProgram.use(),this.vertexArrayIndex=0,this.drawCount=0}processDrawable(t){if(t.includeVertices){const s=t.vertexArray;for(;s.length+this.vertexArrayIndex>this.vertexArray.length;){const r=new Float32Array(this.vertexArray.length*2);r.set(this.vertexArray),this.vertexArray=r}this.vertexArray.set(s,this.vertexArrayIndex),this.vertexArrayIndex+=s.length,this.drawCount++}}deactivate(){return this.drawCount&&this.draw(),this.shaderProgram.unuse(),this.drawCount}draw(){const t=this.gl;t.uniformMatrix3fv(this.shaderProgram.uniformLocations.uProjectionMatrix,!1,this.projectionMatrixArray),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray.length>this.lastArrayLength?t.bufferData(t.ARRAY_BUFFER,this.vertexArray,t.DYNAMIC_DRAW):t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray.subarray(0,this.vertexArrayIndex));const s=Float32Array.BYTES_PER_ELEMENT,r=6*s;t.vertexAttribPointer(this.shaderProgram.attributeLocations.aVertex,2,t.FLOAT,!1,r,0*s),t.vertexAttribPointer(this.shaderProgram.attributeLocations.aColor,4,t.FLOAT,!1,r,2*s),t.drawArrays(t.TRIANGLES,0,this.vertexArrayIndex/6),this.vertexArrayIndex=0}}class TexturedTrianglesProcessor extends Processor{constructor(t){assert&&assert(t instanceof Float32Array),super(),this.projectionMatrixArray=t,this.lastArrayLength=128,this.vertexArray=new Float32Array(this.lastArrayLength)}initializeContext(t){assert&&assert(t,"Should be an actual context"),this.gl=t,this.shaderProgram=new ShaderProgram(t,["attribute vec2 aVertex;","attribute vec2 aTextureCoord;","attribute float aAlpha;","varying vec2 vTextureCoord;","varying float vAlpha;","uniform mat3 uProjectionMatrix;","void main() {","  vTextureCoord = aTextureCoord;","  vAlpha = aAlpha;","  vec3 ndc = uProjectionMatrix * vec3( aVertex, 1.0 );","  gl_Position = vec4( ndc.xy, 0.0, 1.0 );","}"].join(`
`),["precision mediump float;","varying vec2 vTextureCoord;","varying float vAlpha;","uniform sampler2D uTexture;","void main() {","  vec4 color = texture2D( uTexture, vTextureCoord, -0.7 );","  color.a *= vAlpha;","  gl_FragColor = color;","}"].join(`
`),{attributes:["aVertex","aTextureCoord","aAlpha"],uniforms:["uTexture","uProjectionMatrix"]}),this.vertexBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertexArray,t.DYNAMIC_DRAW)}activate(){this.shaderProgram.use(),this.currentSpriteSheet=null,this.vertexArrayIndex=0,this.drawCount=0}processDrawable(t){if(!t.sprite)return;assert&&assert(t.webglRenderer===Renderer.webglTexturedTriangles),this.currentSpriteSheet&&t.sprite.spriteSheet!==this.currentSpriteSheet&&this.draw(),this.currentSpriteSheet=t.sprite.spriteSheet;const s=t.vertexArray;for(;s.length+this.vertexArrayIndex>this.vertexArray.length;){const r=new Float32Array(this.vertexArray.length*2);r.set(this.vertexArray),this.vertexArray=r}this.vertexArray.set(s,this.vertexArrayIndex),this.vertexArrayIndex+=s.length}deactivate(){return this.currentSpriteSheet&&this.draw(),this.shaderProgram.unuse(),this.drawCount}draw(){assert&&assert(this.currentSpriteSheet);const t=this.gl;t.uniformMatrix3fv(this.shaderProgram.uniformLocations.uProjectionMatrix,!1,this.projectionMatrixArray),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray.length>this.lastArrayLength?t.bufferData(t.ARRAY_BUFFER,this.vertexArray,t.DYNAMIC_DRAW):t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray.subarray(0,this.vertexArrayIndex));const s=5,r=Float32Array.BYTES_PER_ELEMENT,o=s*r;t.vertexAttribPointer(this.shaderProgram.attributeLocations.aVertex,2,t.FLOAT,!1,o,0*r),t.vertexAttribPointer(this.shaderProgram.attributeLocations.aTextureCoord,2,t.FLOAT,!1,o,2*r),t.vertexAttribPointer(this.shaderProgram.attributeLocations.aAlpha,1,t.FLOAT,!1,o,4*r),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.currentSpriteSheet.texture),t.uniform1i(this.shaderProgram.uniformLocations.uTexture,0),t.drawArrays(t.TRIANGLES,0,this.vertexArrayIndex/s),t.bindTexture(t.TEXTURE_2D,null),this.drawCount++,this.currentSpriteSheet=null,this.vertexArrayIndex=0}}Poolable.mixInto(WebGLBlock);const WebGLBlock$1=WebGLBlock;class Stitcher{initialize(t,s,r,o,n,l,h){assert&&assert(l&&h,"We are guaranteed at least one change interval"),assert&&assert(!s||s.previousDrawable===null,"End boundary of drawable linked list should link to null"),assert&&assert(!r||r.nextDrawable===null,"End boundary of drawable linked list should link to null"),sceneryLog&&sceneryLog.Stitch&&(sceneryLog.Stitch(`stitch ${t.toString()} first:${s?s.toString():"null"} last:${r?r.toString():"null"} oldFirst:${o?o.toString():"null"} oldLast:${n?n.toString():"null"}`),sceneryLog.push()),sceneryLog&&sceneryLog.StitchDrawables&&(sceneryLog.StitchDrawables("Before:"),sceneryLog.push(),Stitcher.debugDrawables(o,n,l,h,!1),sceneryLog.pop(),sceneryLog.StitchDrawables("After:"),sceneryLog.push(),Stitcher.debugDrawables(s,r,l,h,!0),sceneryLog.pop()),this.backbone=t,this.firstDrawable=s,this.lastDrawable=r,this.touchedBlocks=cleanArray(this.touchedBlocks),assertSlow&&(assertSlow(!this.initialized,"We should not be already initialized (clean should be called)"),this.initialized=!0,this.reindexed=!1,this.pendingAdditions=[],this.pendingRemovals=[],this.pendingMoves=[],this.createdBlocks=[],this.disposedBlocks=[],this.intervalsNotified=[],this.boundariesRecorded=!1,this.previousBlocks=t.blocks.slice(0))}clean(){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch("clean"),sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch("-----------------------------------"),assertSlow&&(this.auditStitch(),this.initialized=!1),this.backbone=null,this.firstDrawable=null,this.lastDrawable=null,sceneryLog&&sceneryLog.Stitch&&sceneryLog.pop()}recordBackboneBoundaries(){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`recording backbone boundaries: ${this.firstDrawable?this.firstDrawable.toString():"null"} to ${this.lastDrawable?this.lastDrawable.toString():"null"}`),this.backbone.previousFirstDrawable=this.firstDrawable,this.backbone.previousLastDrawable=this.lastDrawable,assertSlow&&(this.boundariesRecorded=!0)}notePendingAddition(t,s){assert&&assert(t.renderer===s.renderer),sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`pending add: ${t.toString()} to ${s.toString()}`),sceneryLog&&sceneryLog.Stitch&&sceneryLog.push(),t.notePendingAddition(this.backbone.display,s,this.backbone),assertSlow&&this.pendingAdditions.push({drawable:t,block:s}),sceneryLog&&sceneryLog.Stitch&&sceneryLog.pop()}notePendingMove(t,s){assert&&assert(t.renderer===s.renderer),sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`pending move: ${t.toString()} to ${s.toString()}`),sceneryLog&&sceneryLog.Stitch&&sceneryLog.push(),t.notePendingMove(this.backbone.display,s),assertSlow&&this.pendingMoves.push({drawable:t,block:s}),sceneryLog&&sceneryLog.Stitch&&sceneryLog.pop()}notePendingRemoval(t){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`pending remove: ${t.toString()}`),sceneryLog&&sceneryLog.Stitch&&sceneryLog.push(),t.notePendingRemoval(this.backbone.display),assertSlow&&this.pendingRemovals.push({drawable:t}),sceneryLog&&sceneryLog.Stitch&&sceneryLog.pop()}markBlockForDisposal(t){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`block for disposal: ${t.toString()}`),sceneryLog&&sceneryLog.Stitch&&sceneryLog.push(),t.domElement.parentNode===this.backbone.domElement&&this.backbone.domElement.removeChild(t.domElement),t.markForDisposal(this.backbone.display),assertSlow&&this.disposedBlocks.push({block:t}),sceneryLog&&sceneryLog.Stitch&&sceneryLog.pop()}removeAllBlocks(){for(sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`marking all blocks for disposal (count ${this.backbone.blocks.length})`),sceneryLog&&sceneryLog.Stitch&&sceneryLog.push();this.backbone.blocks.length;){const t=this.backbone.blocks[0];this.removeBlock(t),this.markBlockForDisposal(t)}sceneryLog&&sceneryLog.Stitch&&sceneryLog.pop()}notifyInterval(t,s,r){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`notify interval: ${t.toString()} ${s.toString()} to ${r.toString()}`),sceneryLog&&sceneryLog.Stitch&&sceneryLog.push(),t.notifyInterval(s,r),this.backbone.markDirtyDrawable(t),assertSlow&&this.intervalsNotified.push({block:t,firstDrawable:s,lastDrawable:r}),sceneryLog&&sceneryLog.Stitch&&sceneryLog.pop()}markBeforeBlock(t,s){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`marking block first drawable ${t.toString()} with ${s.toString()}`),t.pendingFirstDrawable=s,this.touchedBlocks.push(t)}markAfterBlock(t,s){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`marking block last drawable ${t.toString()} with ${s.toString()}`),t.pendingLastDrawable=s,this.touchedBlocks.push(t)}updateBlockIntervals(){for(;this.touchedBlocks.length;){const t=this.touchedBlocks.pop();t.used?(sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`update interval: ${t.toString()} ${t.pendingFirstDrawable.toString()} to ${t.pendingLastDrawable.toString()}`),t.updateInterval(),this.backbone.markDirtyDrawable(t),assertSlow&&this.intervalsNotified.push({block:t,firstDrawable:t.pendingFirstDrawable,lastDrawable:t.pendingLastDrawable})):sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`skipping update interval: ${t.toString()}, unused`)}}createBlock(t,s){const r=this.backbone;let o;if(Renderer.isCanvas(t))o=CanvasBlock$1.createFromPool(r.display,t,r.transformRootInstance,r.backboneInstance);else if(Renderer.isSVG(t))o=SVGBlock.createFromPool(r.display,t,r.transformRootInstance,r.backboneInstance);else if(Renderer.isDOM(t))o=DOMBlock$1.createFromPool(r.display,s);else if(Renderer.isWebGL(t))o=WebGLBlock$1.createFromPool(r.display,t,r.transformRootInstance,r.backboneInstance);else throw new Error(`unsupported renderer for createBlock: ${t}`);return sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`created block: ${o.toString()} with renderer: ${t} for drawable: ${s.toString()}`),o.setBlockBackbone(r),r.domElement.appendChild(o.domElement),r.isDisplayRoot&&o.domElement.setAttribute("aria-hidden",!0),r.markDirtyDrawable(o),assertSlow&&this.createdBlocks.push({block:o,renderer:t,drawable:s}),o}appendBlock(t){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`appending block: ${t.toString()}`),this.backbone.blocks.push(t),assertSlow&&(this.reindexed=!1)}removeBlock(t){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`removing block: ${t.toString()}`);const s=_.indexOf(this.backbone.blocks,t);assert&&assert(s>=0,`Cannot remove block, not attached: ${t.toString()}`),this.backbone.blocks.splice(s,1),assertSlow&&(this.reindexed=!1)}useNoBlocks(){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch("using no blocks"),cleanArray(this.backbone.blocks)}reindex(){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch("reindexing blocks"),this.backbone.reindexBlocks(),assertSlow&&(this.reindexed=!0)}auditStitch(){if(assertSlow){const t=this.backbone.blocks,s=this.previousBlocks;if(assertSlow(this.initialized,"We seem to have finished a stitch without proper initialization"),assertSlow(this.boundariesRecorded,"Our stitch API requires recordBackboneBoundaries() to be called before it is finished."),assertSlow(this.reindexed||t.length===0||s.length===t.length&&_.every(_.zip(s,t),r=>r[0]===r[1]),"Did not reindex on a block change where we are left with blocks"),_.each(this.createdBlocks,r=>{assertSlow(_.some(this.intervalsNotified,o=>r.block===o.block),`Created block does not seem to have an interval notified: ${r.block.toString()}`)}),_.each(this.disposedBlocks,r=>{assertSlow(!_.some(this.intervalsNotified,o=>r.block===o.block),`Removed block seems to have an interval notified: ${r.block.toString()}`)}),_.each(this.disposedBlocks,r=>{const o=r.block;_.each(Drawable.oldListToArray(o.firstDrawable,o.lastDrawable),n=>{assertSlow(_.some(this.pendingRemovals,l=>l.drawable===n)||_.some(this.pendingMoves,l=>l.drawable===n),`Drawable ${n.toString()} originally listed for disposed block ${o.toString()} does not seem to be marked for pending removal or move!`)})}),_.each(this.createdBlocks,r=>{const o=r.block;_.each(Drawable.listToArray(o.pendingFirstDrawable,o.pendingLastDrawable),n=>{assertSlow(_.some(this.pendingAdditions,l=>l.drawable===n&&l.block===o)||_.some(this.pendingMoves,l=>l.drawable===n&&l.block===o),`Drawable ${n.toString()} now listed for created block ${o.toString()} does not seem to be marked for pending addition or move!`)})}),_.each(this.disposedBlocks,r=>{const o=_.indexOf(t,r.block);assertSlow(o<0,`Disposed block ${r.block.toString()} still present at index ${o}`)}),_.each(this.createdBlocks,r=>{const o=_.indexOf(t,r.block);assertSlow(o>=0,`Created block ${r.block.toString()} is not in the blocks array`)}),_.each(t,r=>{assertSlow(r.used,"All current blocks should be marked as used")}),assertSlow(t.length-s.length===this.createdBlocks.length-this.disposedBlocks.length,`The count of unmodified blocks should be constant (equal differences):
created: ${_.map(this.createdBlocks,r=>r.block.id).join(",")}
disposed: ${_.map(this.disposedBlocks,r=>r.block.id).join(",")}
before: ${_.map(s,r=>r.id).join(",")}
after: ${_.map(t,r=>r.id).join(",")}`),assertSlow(this.touchedBlocks.length===0,"If we marked any blocks for changes, we should have called updateBlockIntervals"),t.length){assertSlow(this.backbone.previousFirstDrawable!==null&&this.backbone.previousLastDrawable!==null,"If we are left with at least one block, we must be tracking at least one drawable"),assertSlow(t[0].pendingFirstDrawable===this.backbone.previousFirstDrawable,"Our first drawable should match the first drawable of our first block"),assertSlow(t[t.length-1].pendingLastDrawable===this.backbone.previousLastDrawable,"Our last drawable should match the last drawable of our last block");for(let r=0;r<t.length-1;r++)assertSlow(t[r].pendingLastDrawable.nextDrawable===t[r+1].pendingFirstDrawable&&t[r].pendingLastDrawable===t[r+1].pendingFirstDrawable.previousDrawable,"Consecutive blocks should have boundary drawables that are also consecutive in the linked list")}else assertSlow(this.backbone.previousFirstDrawable===null&&this.backbone.previousLastDrawable===null,"If we are left with no blocks, it must mean we are tracking precisely zero drawables")}}static debugIntervals(t){if(sceneryLog&&sceneryLog.Stitch)for(let s=t;s!==null;s=s.nextChangeInterval)sceneryLog.Stitch(`  interval: ${s.isEmpty()?"(empty) ":""}${s.drawableBefore?s.drawableBefore.toString():"-"} to ${s.drawableAfter?s.drawableAfter.toString():"-"}`)}static debugDrawables(t,s,r,o,n){if(sceneryLog&&sceneryLog.StitchDrawables){if(t===null){sceneryLog.StitchDrawables("nothing","color: #666;");return}let l=r.drawableBefore===null,h=r;for(let g=t;;g=n?g.nextDrawable:g.oldNextDrawable){l&&g===h.drawableAfter&&(l=!1,h=h.nextChangeInterval);const d=`${g.renderer} ${!n&&g.parentDrawable?g.parentDrawable.toString():""} ${g.toDetailedString()}`;if(sceneryLog.StitchDrawables(d,l?n?"color: #0a0;":"color: #a00;":"color: #666"),!l&&h&&h.drawableBefore===g&&(l=!0),g===s)break}}}}scenery.register("Stitcher",Stitcher);function hasGapBetweenDrawables(a,t){return a.renderer!==t.renderer||Renderer.isDOM(a.renderer)||Renderer.isDOM(t.renderer)}function isOpenBefore(a){return a.previousDrawable!==null&&!hasGapBetweenDrawables(a.previousDrawable,a)}function isOpenAfter(a){return a.nextDrawable!==null&&!hasGapBetweenDrawables(a,a.nextDrawable)}function intervalHasNewInternalDrawables(a,t,s){return a.drawableBefore?a.drawableBefore.nextDrawable!==a.drawableAfter:a.drawableAfter?a.drawableAfter.previousDrawable!==a.drawableBefore:t!==null}function intervalHasOldInternalDrawables(a,t,s){return a.drawableBefore?a.drawableBefore.oldNextDrawable!==a.drawableAfter:a.drawableAfter?a.drawableAfter.oldPreviousDrawable!==a.drawableBefore:t!==null}function intervalHasOldInternalBlocks(a,t,s){const r=a.drawableBefore?a.drawableBefore.parentDrawable:null,o=a.drawableAfter?a.drawableAfter.parentDrawable:null;return r&&o&&r===o?!1:r?r.nextBlock!==o:o?o.previousBlock!==r:t!==null}function getLastCompatibleExternalDrawable(a){const t=a.drawableAfter;if(t){const s=t.renderer,r=a.nextChangeInterval?a.nextChangeInterval.drawableBefore.nextDrawable:null;let o=t;for(;;){const n=o.nextDrawable;if(n!==r&&n.renderer===s)o=n;else break}return o}else return null}class GreedyStitcher extends Stitcher{stitch(t,s,r,o,n,l,h){this.initialize(t,s,r,o,n,l,h),this.blockOrderChanged=!1,this.reusableBlocks=cleanArray(this.reusableBlocks),this.blockWasAdded=!1;let g;if(this.recordBackboneBoundaries(),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.GreedyStitcher("phase 1: old linked list"),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.push(),t.blocks.length){const d=t.blocks[0];for(t.blocks[t.blocks.length-1],g=l;g!==null;g=g.nextChangeInterval){if(assert&&assert(!g.isEmpty(),"We now guarantee that the intervals are non-empty"),intervalHasOldInternalDrawables(g,o)){const A=g.drawableBefore?g.drawableBefore.oldNextDrawable:o,S=g.drawableAfter?g.drawableAfter.oldPreviousDrawable:n;for(let O=A;this.notePendingRemoval(O),O!==S;O=O.oldNextDrawable);}if(intervalHasOldInternalBlocks(g,d)){const A=g.drawableBefore===null?t.blocks[0]:g.drawableBefore.parentDrawable.nextBlock,S=g.drawableAfter===null?t.blocks[t.blocks.length-1]:g.drawableAfter.parentDrawable.previousBlock;for(let O=A;this.unuseBlock(O),O!==S;O=O.nextBlock);}}}if(sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.pop(),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.GreedyStitcher("phase 2: new linked list"),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.push(),s)for(g=l;g!==null;g=g.nextChangeInterval)this.processInterval(t,g,s,r);sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.pop(),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.GreedyStitcher("phase 3: cleanup"),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.push(),this.removeUnusedBlocks(),this.updateBlockIntervals(),s===null?this.useNoBlocks():this.blockOrderChanged&&(this.processBlockLinkedList(t,s.pendingParentDrawable,r.pendingParentDrawable),this.reindex()),this.clean(),cleanArray(this.reusableBlocks),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.pop()}processInterval(t,s,r,o){if(assert&&assert(s instanceof ChangeInterval),assert&&assert(r instanceof Drawable,"We assume we have a non-null remaining section"),assert&&assert(o instanceof Drawable,"We assume we have a non-null remaining section"),assert&&assert(!s.isEmpty(),"We now guarantee that the intervals are non-empty"),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`interval: ${s.drawableBefore?s.drawableBefore.toString():"null"} to ${s.drawableAfter?s.drawableAfter.toString():"null"}`),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push(),intervalHasNewInternalDrawables(s,r)){let n=s.drawableBefore?s.drawableBefore.nextDrawable:r,l=null,h=null,g=!0;for(;;){const d=n.nextDrawable,A=d===s.drawableAfter;if(assert&&assert(d!==null||A,"If our nextDrawable is null, isLast must be true"),l||(l=n),h===null&&n.parentDrawable&&!n.parentDrawable.used&&n.backbone===t&&n.parentDrawable.parentDrawable===t&&(h=n.parentDrawable,sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`matching at ${n.toString()} with ${h}`)),(A||hasGapBetweenDrawables(n,d))&&(g&&this.processEdgeCases(s,isOpenBefore(l),isOpenAfter(n)),this.processSubBlock(s,l,n,h,g,A),l=null,h=null,g=!1),A)break;n=d}}else{if(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("no current internal drawables in interval"),s.drawableBefore&&s.drawableAfter){assert&&assert(s.drawableBefore.nextDrawable===s.drawableAfter);const n=!hasGapBetweenDrawables(s.drawableBefore,s.drawableAfter);this.processEdgeCases(s,n,n)}s.drawableBefore&&!isOpenAfter(s.drawableBefore)?(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("closed-after collapsed link:"),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push(),this.linkAfterDrawable(s.drawableBefore),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop()):s.drawableAfter&&!isOpenBefore(s.drawableAfter)&&(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("closed-before collapsed link:"),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push(),this.linkBeforeDrawable(s.drawableAfter),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop())}sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop()}processSubBlock(t,s,r,o,n,l){sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`sub-block: ${s.toString()} to ${r.toString()} ${o?`with matched: ${o.toString()}`:"with no match"}`),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push();const h=isOpenBefore(s),g=isOpenAfter(r);assert&&assert(!h||n,"openBefore implies isFirst"),assert&&assert(!g||l,"openAfter implies isLast"),assert&&assert(!h||!g||s.previousDrawable.pendingParentDrawable===r.nextDrawable.pendingParentDrawable,"If we would use both the before and after blocks, make sure any gluing "),h&&(o=s.previousDrawable.pendingParentDrawable,sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`combining into before block: ${o.toString()}`)),g&&(o=r.nextDrawable.pendingParentDrawable,sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`combining into after block: ${o.toString()}`)),o=this.ensureUsedBlock(o,s);for(let d=s;this.notePendingAddition(d,o),d!==r;d=d.nextDrawable);h||(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("closed-before link:"),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push(),this.linkBeforeDrawable(s),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop()),l&&!g&&(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("last closed-after link:"),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push(),this.linkAfterDrawable(r),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop()),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop()}processEdgeCases(t,s,r){if(t.drawableBefore!==null&&t.drawableAfter!==null){const o=t.drawableBefore.pendingParentDrawable,n=t.drawableAfter.pendingParentDrawable,l=t.nextChangeInterval&&t.nextChangeInterval.drawableAfter?t.nextChangeInterval.drawableAfter.pendingParentDrawable:null;o===n&&(this.blockWasAdded=!0),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`edge case: ${s?"open-before ":""}${r?"open-after ":""}${o.toString()} to ${n.toString()}`),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push();let h;s&&r?(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`glue using ${o.toString()}`),h=o):this.blockWasAdded||o===n?(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("split with fresh block"),h=this.createBlock(t.drawableAfter.renderer,t.drawableAfter),this.blockOrderChanged=!0):(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`split with same afterBlock ${n.toString()}`),h=n),n===h?(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("no externals change here (blockWasAdded => true)"),this.blockWasAdded=!0):(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("moving externals"),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push(),this.changeExternals(t,h),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop()),l!==n&&(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("end of afterBlock stretch"),this.blockWasAdded||(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`unusing ${n.toString()}`),this.unuseBlock(n)),this.blockWasAdded=!1),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop()}}changeExternals(t,s){const r=getLastCompatibleExternalDrawable(t);this.notePendingMoves(s,t.drawableAfter,r),(!t.nextChangeInterval||t.nextChangeInterval.drawableBefore!==r)&&this.linkAfterDrawable(r)}notePendingMoves(t,s,r){for(let o=s;assert&&assert(!o.pendingAddition&&!o.pendingRemoval,"Moved drawables should be thought of as unchanged, and thus have nothing pending yet"),this.notePendingMove(o,t),o!==r;o=o.nextDrawable);}ensureUsedBlock(t,s){return t?(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`using existing block: ${t.toString()}`),t.used||this.useBlock(t)):(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("searching for block"),t=this.getBlockForRenderer(s.renderer,s)),t}getBlockForRenderer(t,s){let r;if(!Renderer.isDOM(t))for(let o=this.reusableBlocks.length-1;o>=0;o--){const n=this.reusableBlocks[o];if(assert&&assert(!n.used),n.renderer===t){this.useBlockAtIndex(n,o),r=n;break}}return r||(r=this.createBlock(t,s)),this.blockOrderChanged=!0,r}unuseBlock(t){t.used?(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`unusing block: ${t.toString()}`),t.used=!1,this.reusableBlocks.push(t)):sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`not using already-unused block: ${t.toString()}`)}useBlock(t){this.useBlockAtIndex(t,_.indexOf(this.reusableBlocks,t))}useBlockAtIndex(t,s){sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`using reusable block: ${t.toString()} with renderer: ${t.renderer}`),assert&&assert(s>=0&&this.reusableBlocks[s]===t,`bad index for useBlockAtIndex: ${s}`),assert&&assert(!t.used,"Should be called on an unused (reusable) block"),this.reusableBlocks.splice(s,1),t.used=!0}removeUnusedBlocks(){for(sceneryLog&&sceneryLog.GreedyStitcher&&this.reusableBlocks.length&&sceneryLog.GreedyStitcher("removeUnusedBlocks"),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.push();this.reusableBlocks.length;){const t=this.reusableBlocks.pop();this.markBlockForDisposal(t),this.blockOrderChanged=!0}sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.pop()}linkBeforeDrawable(t){sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`link before ${t.toString()}`);const s=t.previousDrawable;this.linkBlocks(s?s.pendingParentDrawable:null,t.pendingParentDrawable,s,t)}linkAfterDrawable(t){sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`link after ${t.toString()}`);const s=t.nextDrawable;this.linkBlocks(t.pendingParentDrawable,s?s.pendingParentDrawable:null,t,s)}linkBlocks(t,s,r,o){sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.GreedyStitcher(`linking blocks: ${t?`${t.toString()} (${r.toString()})`:"null"} to ${s?`${s.toString()} (${o.toString()})`:"null"}`),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.push(),assert&&assert(t===null&&r===null||t instanceof Block$1&&r instanceof Drawable),assert&&assert(s===null&&o===null||s instanceof Block$1&&o instanceof Drawable),t&&(t.nextBlock!==s&&(this.blockOrderChanged=!0,t.nextBlock&&(t.nextBlock.previousBlock=null),t.nextBlock=s),this.markAfterBlock(t,r)),s&&(s.previousBlock!==t&&(this.blockOrderChanged=!0,s.previousBlock&&(s.previousBlock.nextBlock=null),s.previousBlock=t),this.markBeforeBlock(s,o)),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.pop()}processBlockLinkedList(t,s,r){for(;t.blocks.length;)t.blocks.pop();if(sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.GreedyStitcher(`processBlockLinkedList: ${s.toString()} to ${r.toString()}`),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.push(),s)for(let o=s;sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.GreedyStitcher(o.toString()),t.blocks.push(o),o!==r;o=o.nextBlock);sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.pop()}}scenery.register("GreedyStitcher",GreedyStitcher);class RebuildStitcher extends Stitcher{stitch(t,s,r,o,n,l,h){this.initialize(t,s,r,o,n,l,h);for(let S=t.previousFirstDrawable;S!==null&&(this.notePendingRemoval(S),S!==t.previousLastDrawable);S=S.oldNextDrawable);this.recordBackboneBoundaries(),this.removeAllBlocks();let g=null,d=0,A=null;for(let S=s;S!==null&&((!g||S.renderer!==d)&&(g&&this.notifyInterval(g,A,S.previousDrawable),d=S.renderer,g=this.createBlock(d,S),Renderer.isDOM(d)&&(d=0),this.appendBlock(g),A=S),this.notePendingAddition(S,g),S!==r);S=S.nextDrawable);g&&this.notifyInterval(g,A,r),this.reindex(),this.clean()}}scenery.register("RebuildStitcher",RebuildStitcher);class BackboneDrawable extends Drawable{constructor(t,s,r,o,n){super(),this.initialize(t,s,r,o,n)}initialize(t,s,r,o,n){if(super.initialize(o),this.display=t,this.backboneInstance=s,this.transformRootInstance=r,this.filterRootAncestorInstance=s.parent?s.parent.getFilterRootInstance():s,this.transformRootAncestorInstance=s.parent?s.parent.getTransformRootInstance():s,this.willApplyTransform=this.transformRootAncestorInstance!==this.transformRootInstance,this.willApplyFilters=this.filterRootAncestorInstance!==this.backboneInstance,this.transformListener=this.transformListener||this.markTransformDirty.bind(this),this.willApplyTransform&&(this.backboneInstance.relativeTransform.addListener(this.transformListener),this.backboneInstance.relativeTransform.addPrecompute()),this.backboneVisibilityListener=this.backboneVisibilityListener||this.updateBackboneVisibility.bind(this),this.backboneInstance.relativeVisibleEmitter.addListener(this.backboneVisibilityListener),this.updateBackboneVisibility(),this.visibilityDirty=!0,this.renderer=o,this.domElement=n?t.domElement:BackboneDrawable.createDivBackbone(),this.isDisplayRoot=n,this.dirtyDrawables=cleanArray(this.dirtyDrawables),Utils.prepareForTransform(this.domElement),this.watchedFilterNodes=cleanArray(this.watchedFilterNodes),this.filterDirty=!0,this.clipDirty=!0,this.filterDirtyListener=this.filterDirtyListener||this.onFilterDirty.bind(this),this.clipDirtyListener=this.clipDirtyListener||this.onClipDirty.bind(this),this.willApplyFilters){assert&&assert(this.filterRootAncestorInstance.trail.nodes.length<this.backboneInstance.trail.nodes.length,"Our backboneInstance should be deeper if we are applying filters");for(let l=this.backboneInstance;l!==this.filterRootAncestorInstance;l=l.parent){const h=l.node;this.watchedFilterNodes.push(h),h.filterChangeEmitter.addListener(this.filterDirtyListener),h.clipAreaProperty.lazyLink(this.clipDirtyListener)}}this.lastZIndex=0,this.blocks=this.blocks||[],this.previousFirstDrawable=null,this.previousLastDrawable=null,this.removedDrawables=!1,this.stitcher=this.stitcher||new GreedyStitcher,sceneryLog&&sceneryLog.BackboneDrawable&&sceneryLog.BackboneDrawable(`initialized ${this.toString()}`)}dispose(){for(sceneryLog&&sceneryLog.BackboneDrawable&&sceneryLog.BackboneDrawable(`dispose ${this.toString()}`),sceneryLog&&sceneryLog.BackboneDrawable&&sceneryLog.push();this.watchedFilterNodes.length;){const t=this.watchedFilterNodes.pop();t.filterChangeEmitter.removeListener(this.filterDirtyListener),t.clipAreaProperty.unlink(this.clipDirtyListener)}if(this.backboneInstance.relativeVisibleEmitter.removeListener(this.backboneVisibilityListener),!this.removedDrawables)for(let t=this.previousFirstDrawable;t!==null&&(t.parentDrawable.removeDrawable(t),t!==this.previousLastDrawable);t=t.nextDrawable);this.markBlocksForDisposal(),this.willApplyTransform&&(this.backboneInstance.relativeTransform.removeListener(this.transformListener),this.backboneInstance.relativeTransform.removePrecompute()),this.backboneInstance=null,this.transformRootInstance=null,this.filterRootAncestorInstance=null,this.transformRootAncestorInstance=null,cleanArray(this.dirtyDrawables),cleanArray(this.watchedFilterNodes),this.previousFirstDrawable=null,this.previousLastDrawable=null,super.dispose(),sceneryLog&&sceneryLog.BackboneDrawable&&sceneryLog.pop()}markBlocksForDisposal(){for(;this.blocks.length;){const t=this.blocks.pop();sceneryLog&&sceneryLog.BackboneDrawable&&sceneryLog.BackboneDrawable(`${this.toString()} removing block: ${t.toString()}`),t.domElement.parentNode===this.domElement&&this.domElement.removeChild(t.domElement),t.markForDisposal(this.display)}}updateBackboneVisibility(){this.visible=this.backboneInstance.relativeVisible,this.visibilityDirty||(this.visibilityDirty=!0,this.markDirty())}markForDisposal(t){for(let s=this.previousFirstDrawable;s!==null&&(s.notePendingRemoval(this.display),s!==this.previousLastDrawable);s=s.oldNextDrawable);this.removedDrawables=!0,super.markForDisposal(t)}markDirtyDrawable(t){assert&&this.display.ensureNotPainting(),this.dirtyDrawables.push(t),this.markDirty()}markTransformDirty(){assert&&assert(this.willApplyTransform,"Sanity check for willApplyTransform"),Utils.applyPreparedTransform(this.backboneInstance.relativeTransform.matrix,this.domElement)}onFilterDirty(){this.filterDirty||(this.filterDirty=!0,this.markDirty())}onClipDirty(){this.clipDirty||(this.clipDirty=!0,this.markDirty())}update(){if(!super.update())return!1;for(;this.dirtyDrawables.length;)this.dirtyDrawables.pop().update();if(this.filterDirty){this.filterDirty=!1;let t="";const s=this.watchedFilterNodes.length;for(let r=0;r<s;r++){const o=this.watchedFilterNodes[r],n=o.getEffectiveOpacity();for(let l=0;l<o._filters.length;l++)t+=`${t?" ":""}${o._filters[l].getCSSFilterString()}`;n!==1&&(t+=`${t?" ":""}opacity(${toSVGNumber(n)})`)}this.domElement.style.filter=t}return this.visibilityDirty&&(this.visibilityDirty=!1,this.domElement.style.display=this.visible?"":"none"),this.clipDirty&&(this.clipDirty=!1),!0}getFilterVisibility(){const t=this.watchedFilterNodes.length;for(let s=0;s<t;s++)if(!this.watchedFilterNodes[s].isVisible())return!1;return!0}getFilterClip(){return""}reindexBlocks(){let t=0;for(let s=0;s<this.blocks.length;s++){const r=this.blocks[s];if(r.zIndex<=t){const o=s+1<this.blocks.length&&this.blocks[s+1].zIndex-1>t?Math.ceil((t+this.blocks[s+1].zIndex)/2):t+20;r.domElement.style.zIndex=r.zIndex=o}t=r.zIndex,assert&&(assert(this.blocks[s].zIndex%1===0,"z-indices should be integers"),assert(this.blocks[s].zIndex>0,"z-indices should be greater than zero for our needs (see spec)"),s>0&&assert(this.blocks[s-1].zIndex<this.blocks[s].zIndex,"z-indices should be strictly increasing"))}this.lastZIndex=t+1}stitch(t,s,r,o){if(r===null||o===null){assert&&assert(r===null),assert&&assert(o===null);return}assert&&assert(o.nextChangeInterval===null,"This allows us to have less checks in the loop"),sceneryLog&&sceneryLog.Stitch&&(sceneryLog.Stitch(`Stitch intervals before constricting: ${this.toString()}`),sceneryLog.push(),Stitcher.debugIntervals(r),sceneryLog.pop());let n=null,l=r,h=!1;for(;l;)h=l.constrict()||h,l.isEmpty()?(assert&&assert(h),n&&(n.nextChangeInterval=l.nextChangeInterval)):(n||(r=l),n=l),l=l.nextChangeInterval;if(n){if(o=n,o.nextChangeInterval=null,sceneryLog&&sceneryLog.Stitch&&h&&(sceneryLog.Stitch(`Stitch intervals after constricting: ${this.toString()}`),sceneryLog.push(),Stitcher.debugIntervals(r),sceneryLog.pop()),sceneryLog&&scenery.isLoggingPerformance()){this.display.perfStitchCount++;let g=r;for(;g;)this.display.perfIntervalCount++,this.display.perfDrawableOldIntervalCount+=g.getOldInternalDrawableCount(this.previousFirstDrawable,this.previousLastDrawable),this.display.perfDrawableNewIntervalCount+=g.getNewInternalDrawableCount(t,s),g=g.nextChangeInterval}this.stitcher.stitch(this,t,s,this.previousFirstDrawable,this.previousLastDrawable,r,o)}}audit(t,s,r){if(assertSlow){super.audit(t,s,r),assertSlow&&assertSlow(this.backboneInstance.isBackbone,"We should reference an instance that requires a backbone"),assertSlow&&assertSlow(this.transformRootInstance.isTransformed,"Transform root should be transformed");for(let o=0;o<this.blocks.length;o++)this.blocks[o].audit(t,s,r)}}static createDivBackbone(){const t=document.createElement("div");return t.style.position="absolute",t.style.left="0",t.style.top="0",t.style.width="0",t.style.height="0",t}static repurposeBackboneContainer(t){return(t.style.position!=="relative"||t.style.position!=="absolute")&&(t.style.position="relative"),t.style.left="0",t.style.top="0",t}}scenery.register("BackboneDrawable",BackboneDrawable);Poolable.mixInto(BackboneDrawable);const BackboneDrawable$1=BackboneDrawable;class ShapeBasedOverlay{constructor(t,s,r){this.display=t,this.rootNode=s;const o=document.createElementNS(svgns,"svg");o.style.position="absolute",o.setAttribute("class",r),o.style.top="0",o.style.left="0",o.style["pointer-events"]="none",this.svg=o;function n(l,h){o.setAttribute("width",""+l),o.setAttribute("height",""+h),o.style.clip=`rect(0px,${l}px,${h}px,0px)`}t.sizeProperty.link(l=>{n(l.width,l.height)}),this.domElement=o}addShape(t,s,r){const o=document.createElementNS(svgns,"path");let n=t.getSVGPath();n||(n="M0 0"),n?o.setAttribute("d",n):o.hasAttribute("d")&&o.removeAttribute("d"),o.setAttribute("style",`fill: none; stroke: ${s}; stroke-dasharray: 5, 3; stroke-dashoffset: ${r?5:0}; stroke-width: 3;`),this.svg.appendChild(o)}update(){for(;this.svg.childNodes.length;)this.svg.removeChild(this.svg.childNodes[this.svg.childNodes.length-1]);this.addShapes()}dispose(){}}scenery.register("ShapeBasedOverlay",ShapeBasedOverlay);class CanvasNodeBoundsOverlay extends ShapeBasedOverlay{constructor(t,s){super(t,s,"canvasNodeBoundsOverlay")}addShapes(){new Trail(this.rootNode).eachTrailUnder(t=>{const s=t.lastNode();if(!s.isVisible())return!0;if(s instanceof CanvasNode&&t.isVisible()){const r=t.getTransform();this.addShape(r.transformShape(Shape$1.bounds(s.selfBounds)),"rgba(0,255,0,0.8)",!0)}return!1})}}scenery.register("CanvasNodeBoundsOverlay",CanvasNodeBoundsOverlay);class FittedBlockBoundsOverlay extends ShapeBasedOverlay{constructor(t,s){super(t,s,"canvasNodeBoundsOverlay")}addShapes(){const t=this;function s(n,l){n.willApplyTransform&&(l=l.timesMatrix(n.backboneInstance.relativeTransform.matrix)),n.blocks.forEach(h=>{r(h,l)})}function r(n,l){if(n instanceof FittedBlock$1&&!n.fitBounds.isEmpty()&&t.addShape(Shape$1.bounds(n.fitBounds).transformed(l),"rgba(255,0,0,0.8)",!0),n.firstDrawable&&n.lastDrawable){for(let h=n.firstDrawable;h!==n.lastDrawable;h=h.nextDrawable)o(h,l);o(n.lastDrawable,l)}}function o(n,l){n instanceof BackboneDrawable$1&&s(n,l)}s(this.display.rootBackbone,Matrix3.IDENTITY)}}scenery.register("FittedBlockBoundsOverlay",FittedBlockBoundsOverlay);let outerHighlightColor=HighlightPath$1.OUTER_FOCUS_COLOR,innerHighlightColor=HighlightPath$1.INNER_FOCUS_COLOR,innerGroupHighlightColor=HighlightPath$1.INNER_LIGHT_GROUP_FOCUS_COLOR,outerGroupHighlightColor=HighlightPath$1.OUTER_LIGHT_GROUP_FOCUS_COLOR;class HighlightOverlay{constructor(t,s,r){this.trail=null,this.node=null,this.activeHighlight=null,this.mode=null,this.groupMode=null,this.groupHighlightNode=null,this.transformTracker=null,this.groupTransformTracker=null,this.nodeModeHighlight=null,this.nodeModeHighlightLayered=!1,this.transformDirty=!0,this.highlightNode=new Node$2,this.readingBlockHighlightNode=new Node$2,this.addedReadingBlockHighlight=null,this.activeReadingBlockNode=null,this.readingBlockTrail=null,this.readingBlockTransformDirty=!0,this.readingBlockTransformTracker=null;const o=optionize()({pdomFocusHighlightsVisibleProperty:new BooleanProperty(!0),interactiveHighlightsVisibleProperty:new BooleanProperty(!1),readingBlockHighlightsVisibleProperty:new BooleanProperty(!1)},r);this.display=t,this.focusRootNode=s,this.focusRootNode.addChild(this.highlightNode),this.focusRootNode.addChild(this.readingBlockHighlightNode),this.pdomFocusHighlightsVisibleProperty=o.pdomFocusHighlightsVisibleProperty,this.interactiveHighlightsVisibleProperty=o.interactiveHighlightsVisibleProperty,this.readingBlockHighlightsVisibleProperty=o.readingBlockHighlightsVisibleProperty,this.focusDisplay=new Display(this.focusRootNode,{allowWebGL:t.isWebGLAllowed(),allowCSSHacks:!1,accessibility:!1,interactive:!1,allowLayerFitting:!0}),this.domElement=this.focusDisplay.domElement,this.domElement.style.pointerEvents="none",this.shapeFocusHighlightPath=new HighlightPath$1(null),this.boundsFocusHighlightPath=new HighlightFromNode$1(null,{useLocalBounds:!0}),this.highlightNode.addChild(this.shapeFocusHighlightPath),this.highlightNode.addChild(this.boundsFocusHighlightPath),this.groupFocusHighlightPath=new HighlightFromNode$1(null,{useLocalBounds:!0,useGroupDilation:!0,outerLineWidth:HighlightPath$1.GROUP_OUTER_LINE_WIDTH,innerLineWidth:HighlightPath$1.GROUP_INNER_LINE_WIDTH,innerStroke:HighlightPath$1.OUTER_FOCUS_COLOR}),this.groupFocusHighlightParent=new Node$2({children:[this.groupFocusHighlightPath]}),this.focusRootNode.addChild(this.groupFocusHighlightParent),this.readingBlockHighlightPath=new ActivatedReadingBlockHighlight$1(null),this.readingBlockHighlightNode.addChild(this.readingBlockHighlightPath),this.boundsListener=this.onBoundsChange.bind(this),this.transformListener=this.onTransformChange.bind(this),this.domFocusListener=this.onFocusChange.bind(this),this.readingBlockTransformListener=this.onReadingBlockTransformChange.bind(this),this.focusHighlightListener=this.onFocusHighlightChange.bind(this),this.interactiveHighlightListener=this.onInteractiveHighlightChange.bind(this),this.focusHighlightsVisibleListener=this.onFocusHighlightsVisibleChange.bind(this),this.voicingHighlightsVisibleListener=this.onVoicingHighlightsVisibleChange.bind(this),this.pointerFocusListener=this.onPointerFocusChange.bind(this),this.lockedPointerFocusListener=this.onLockedPointerFocusChange.bind(this),this.readingBlockFocusListener=this.onReadingBlockFocusChange.bind(this),this.readingBlockHighlightChangeListener=this.onReadingBlockHighlightChange.bind(this),FocusManager.pdomFocusProperty.link(this.domFocusListener),t.focusManager.pointerFocusProperty.link(this.pointerFocusListener),t.focusManager.readingBlockFocusProperty.link(this.readingBlockFocusListener),t.focusManager.lockedPointerFocusProperty.link(this.lockedPointerFocusListener),this.pdomFocusHighlightsVisibleProperty.link(this.focusHighlightsVisibleListener),this.interactiveHighlightsVisibleProperty.link(this.voicingHighlightsVisibleListener)}dispose(){this.hasHighlight()&&this.deactivateHighlight(),FocusManager.pdomFocusProperty.unlink(this.domFocusListener),this.pdomFocusHighlightsVisibleProperty.unlink(this.focusHighlightsVisibleListener),this.interactiveHighlightsVisibleProperty.unlink(this.voicingHighlightsVisibleListener),this.display.focusManager.pointerFocusProperty.unlink(this.pointerFocusListener),this.display.focusManager.readingBlockFocusProperty.unlink(this.readingBlockFocusListener),this.focusDisplay.dispose()}hasHighlight(){return!!this.trail}hasReadingBlockHighlight(){return!!this.readingBlockTrail}activateHighlight(t,s,r,o,n){this.trail=t,this.node=s;const l=r;this.activeHighlight=l;let h=t;if(l==="invisible")this.mode="invisible";else if(l instanceof Shape$1)this.mode="shape",this.shapeFocusHighlightPath.visible=!0,this.shapeFocusHighlightPath.setShape(l);else if(l instanceof Node$2){if(this.mode="node",l instanceof HighlightPath$1){const g=l;assert&&assert(l.shape!==null,"The shape of the Node highlight should be set by now. Does it have bounds?"),g.transformSourceNode&&(h=l.getUniqueHighlightTrail(this.trail))}this.nodeModeHighlight=l,o?(this.nodeModeHighlightLayered=!0,this.nodeModeHighlight.visible=n.get()):(this.nodeModeHighlight.visible=!0,this.highlightNode.addChild(this.nodeModeHighlight))}else this.mode="bounds",this.boundsFocusHighlightPath.setShapeFromNode(this.node),this.boundsFocusHighlightPath.visible=!0,this.node.localBoundsProperty.lazyLink(this.boundsListener),this.onBoundsChange();this.transformTracker=new TransformTracker$1(h,{isStatic:!0}),this.transformTracker.addListener(this.transformListener),this.activateGroupHighlights(),this.updateHighlightColors(),this.transformDirty=!0}activateFocusHighlight(t,s){this.activateHighlight(t,s,s.focusHighlight,s.focusHighlightLayerable,this.pdomFocusHighlightsVisibleProperty),s.focusHighlightChangedEmitter.addListener(this.focusHighlightListener)}activateInteractiveHighlight(t,s){this.activateHighlight(t,s,s.interactiveHighlight||s.focusHighlight,s.interactiveHighlightLayerable,this.interactiveHighlightsVisibleProperty),assert&&assert(s.isInteractiveHighlighting,"Node does not support any kind of interactive highlighting."),s.interactiveHighlightChangedEmitter.addListener(this.interactiveHighlightListener),s.focusHighlightChangedEmitter.addListener(this.interactiveHighlightListener)}activateReadingBlockHighlight(t){this.readingBlockTrail=t;const s=t.lastNode();assert&&assert(s.isReadingBlock,"should not activate a reading block highlight for a Node that is not a ReadingBlock"),this.activeReadingBlockNode=s;const r=this.activeReadingBlockNode.readingBlockActiveHighlight;this.addedReadingBlockHighlight=r,r==="invisible"||(r instanceof Shape$1?(this.readingBlockHighlightPath.setShape(r),this.readingBlockHighlightPath.visible=!0):r instanceof Node$2?this.readingBlockHighlightNode.addChild(r):(this.readingBlockHighlightPath.setShapeFromNode(this.activeReadingBlockNode),this.readingBlockHighlightPath.visible=!0)),this.readingBlockTransformTracker=new TransformTracker$1(this.readingBlockTrail,{isStatic:!0}),this.readingBlockTransformTracker.addListener(this.readingBlockTransformListener),this.activeReadingBlockNode.readingBlockActiveHighlightChangedEmitter.addListener(this.readingBlockHighlightChangeListener),this.readingBlockTransformDirty=!0}deactivateReadingBlockHighlight(){this.readingBlockHighlightPath.visible=!1,this.addedReadingBlockHighlight instanceof Node$2&&this.readingBlockHighlightNode.removeChild(this.addedReadingBlockHighlight),assert&&assert(this.readingBlockTransformTracker,"How can we deactivate the TransformTracker if it wasnt assigned.");const t=this.readingBlockTransformTracker;t.removeListener(this.readingBlockTransformListener),t.dispose(),this.readingBlockTransformTracker=null,assert&&assert(this.activeReadingBlockNode,"How can we deactivate the activeReadingBlockNode if it wasnt assigned."),this.activeReadingBlockNode.readingBlockActiveHighlightChangedEmitter.removeListener(this.readingBlockHighlightChangeListener),this.activeReadingBlockNode=null,this.readingBlockTrail=null,this.addedReadingBlockHighlight=null}deactivateHighlight(){assert&&assert(this.node,"Need an active Node to deactivate highlights");const t=this.node;if(this.mode==="shape")this.shapeFocusHighlightPath.visible=!1;else if(this.mode==="node"){assert&&assert(this.nodeModeHighlight,"How can we deactivate if nodeModeHighlight is not assigned");const r=this.nodeModeHighlight;this.nodeModeHighlightLayered?this.nodeModeHighlightLayered=!1:this.highlightNode.removeChild(r),r.visible=!1,this.nodeModeHighlight=null}else this.mode==="bounds"&&(this.boundsFocusHighlightPath.visible=!1,t.localBoundsProperty.unlink(this.boundsListener));t.focusHighlightChangedEmitter.hasListener(this.focusHighlightListener)&&t.focusHighlightChangedEmitter.removeListener(this.focusHighlightListener);const s=t;s.isInteractiveHighlighting&&(s.interactiveHighlightChangedEmitter.hasListener(this.interactiveHighlightListener)&&s.interactiveHighlightChangedEmitter.removeListener(this.interactiveHighlightListener),s.focusHighlightChangedEmitter.hasListener(this.interactiveHighlightListener)&&s.focusHighlightChangedEmitter.removeListener(this.interactiveHighlightListener)),this.deactivateGroupHighlights(),this.trail=null,this.node=null,this.mode=null,this.activeHighlight=null,this.transformTracker.removeListener(this.transformListener),this.transformTracker.dispose(),this.transformTracker=null}activateGroupHighlights(){assert&&assert(this.trail,"must have an active trail to activate group highlights");const t=this.trail;for(let s=0;s<t.length;s++){const r=t.nodes[s],o=r.groupFocusHighlight;if(o){const n=t.upToNode(r);this.groupTransformTracker=new TransformTracker$1(n),this.groupTransformTracker.addListener(this.transformListener),typeof o=="boolean"?(this.groupFocusHighlightPath.setShapeFromNode(r),this.groupFocusHighlightPath.visible=!0,this.groupHighlightNode=this.groupFocusHighlightPath,this.groupMode="bounds"):o instanceof Node$2&&(this.groupHighlightNode=o,this.groupFocusHighlightParent.addChild(o),this.groupMode="node");break}}}updateHighlightColors(){this.mode==="shape"?(this.shapeFocusHighlightPath.innerHighlightColor!==HighlightOverlay.getInnerHighlightColor()&&this.shapeFocusHighlightPath.setInnerHighlightColor(HighlightOverlay.getInnerHighlightColor()),this.shapeFocusHighlightPath.outerHighlightColor!==HighlightOverlay.getOuterHighlightColor()&&this.shapeFocusHighlightPath.setOuterHighlightColor(HighlightOverlay.getOuterHighlightColor())):this.mode==="bounds"&&(this.boundsFocusHighlightPath.innerHighlightColor!==HighlightOverlay.getInnerHighlightColor()&&this.boundsFocusHighlightPath.setInnerHighlightColor(HighlightOverlay.getInnerHighlightColor()),this.boundsFocusHighlightPath.outerHighlightColor!==HighlightOverlay.getOuterHighlightColor()&&this.boundsFocusHighlightPath.setOuterHighlightColor(HighlightOverlay.getOuterHighlightColor())),this.groupMode&&(this.groupFocusHighlightPath.innerHighlightColor!==HighlightOverlay.getInnerGroupHighlightColor()&&this.groupFocusHighlightPath.setInnerHighlightColor(HighlightOverlay.getInnerGroupHighlightColor()),this.groupFocusHighlightPath.outerHighlightColor!==HighlightOverlay.getOuterGroupHighlightColor()&&this.groupFocusHighlightPath.setOuterHighlightColor(HighlightOverlay.getOuterGroupHighlightColor()))}deactivateGroupHighlights(){this.groupMode&&(this.groupMode==="bounds"?this.groupFocusHighlightPath.visible=!1:this.groupMode==="node"&&(assert&&assert(this.groupHighlightNode,"Need a groupHighlightNode to deactivate this mode"),this.groupFocusHighlightParent.removeChild(this.groupHighlightNode)),this.groupMode=null,this.groupHighlightNode=null,assert&&assert(this.groupTransformTracker,"Need a groupTransformTracker to dispose"),this.groupTransformTracker.removeListener(this.transformListener),this.groupTransformTracker.dispose(),this.groupTransformTracker=null)}afterTransform(){this.mode==="shape"?this.shapeFocusHighlightPath.updateLineWidth():this.mode==="bounds"?this.boundsFocusHighlightPath.updateLineWidth():this.mode==="node"&&this.activeHighlight instanceof HighlightPath$1&&this.activeHighlight.updateLineWidth&&(assert&&assert(this.node,"Need an active Node to update line width"),this.activeHighlight.updateLineWidth(this.node))}onTransformChange(){this.transformDirty=!0}onReadingBlockTransformChange(){this.readingBlockTransformDirty=!0}onBoundsChange(){assert&&assert(this.node,"Must have an active node when bounds are changing"),this.boundsFocusHighlightPath.setShapeFromNode(this.node)}onFocusChange(t){const s=t&&t.display===this.display?t.trail:null;if(this.hasHighlight()&&this.deactivateHighlight(),s&&this.pdomFocusHighlightsVisibleProperty.value){const r=s.lastNode();this.activateFocusHighlight(s,r)}else this.display.focusManager.pointerFocusProperty.value&&this.interactiveHighlightsVisibleProperty.value&&this.updateInteractiveHighlight(this.display.focusManager.pointerFocusProperty.value)}onPointerFocusChange(t){!this.display.focusManager.lockedPointerFocusProperty.value&&!this.display.focusManager.pdomFocusHighlightsVisibleProperty.value&&this.updateInteractiveHighlight(t)}updateInteractiveHighlight(t){const s=t&&t.display===this.display?t.trail:null;this.hasHighlight()&&this.deactivateHighlight();let r=!1;if(s&&!this.display.focusManager.pdomFocusHighlightsVisibleProperty.value){const o=s.lastNode();(o.isReadingBlock&&this.readingBlockHighlightsVisibleProperty.value||!o.isReadingBlock&&this.interactiveHighlightsVisibleProperty.value)&&(this.activateInteractiveHighlight(s,o),r=!0)}!r&&FocusManager.pdomFocus&&this.pdomFocusHighlightsVisibleProperty.value&&this.onFocusChange(FocusManager.pdomFocus)}onLockedPointerFocusChange(t){this.updateInteractiveHighlight(t||this.display.focusManager.pointerFocusProperty.value)}onReadingBlockFocusChange(t){this.hasReadingBlockHighlight()&&this.deactivateReadingBlockHighlight();const s=t&&t.display===this.display?t.trail:null;s&&this.activateReadingBlockHighlight(s)}onFocusHighlightChange(){assert&&assert(this.node&&this.node.focused,"update should only be necessary if node already has focus"),this.onFocusChange(FocusManager.pdomFocus)}onInteractiveHighlightChange(){if(assert){const t=this.node,s=this.display.focusManager.lockedPointerFocusProperty.value;assert(t||s&&s.trail.lastNode()===this.node,"Update should only be necessary if Node is activated with a Pointer or pointer focus is locked during interaction")}this.updateInteractiveHighlight(this.display.focusManager.lockedPointerFocusProperty.value||this.display.focusManager.pointerFocusProperty.value)}onReadingBlockHighlightChange(){assert&&assert(this.activeReadingBlockNode,"Update should only be necessary when there is an active ReadingBlock Node"),assert&&assert(this.activeReadingBlockNode.readingBlockActivated,"Update should only be necessary while the ReadingBlock is activated"),this.onReadingBlockFocusChange(this.display.focusManager.readingBlockFocusProperty.value)}onFocusHighlightsVisibleChange(){this.onFocusChange(FocusManager.pdomFocus)}onVoicingHighlightsVisibleChange(){this.onPointerFocusChange(this.display.focusManager.pointerFocusProperty.value)}update(){this.hasHighlight()&&this.transformDirty&&(this.transformDirty=!1,assert&&assert(this.transformTracker,"The transformTracker must be available on update if transform is dirty"),this.highlightNode.setMatrix(this.transformTracker.matrix),this.groupHighlightNode&&(assert&&assert(this.groupTransformTracker,"The groupTransformTracker must be available on update if transform is dirty"),this.groupHighlightNode.setMatrix(this.groupTransformTracker.matrix)),this.afterTransform()),this.hasReadingBlockHighlight()&&this.readingBlockTransformDirty&&(this.readingBlockTransformDirty=!1,assert&&assert(this.readingBlockTransformTracker,"The groupTransformTracker must be available on update if transform is dirty"),this.readingBlockHighlightNode.setMatrix(this.readingBlockTransformTracker.matrix)),this.display.size.equals(this.focusDisplay.size)||this.focusDisplay.setWidthHeight(this.display.width,this.display.height),this.focusDisplay.updateDisplay()}static setInnerHighlightColor(t){innerHighlightColor=t}static getInnerHighlightColor(){return innerHighlightColor}static setOuterHilightColor(t){outerHighlightColor=t}static getOuterHighlightColor(){return outerHighlightColor}static setInnerGroupHighlightColor(t){innerGroupHighlightColor=t}static getInnerGroupHighlightColor(){return innerGroupHighlightColor}static setOuterGroupHighlightColor(t){outerGroupHighlightColor=t}static getOuterGroupHighlightColor(){return outerGroupHighlightColor}}scenery.register("HighlightOverlay",HighlightOverlay);class HitAreaOverlay extends ShapeBasedOverlay{constructor(t,s){super(t,s,"hitAreaOverlay")}addShapes(){new Trail(this.rootNode).eachTrailUnder(t=>{const s=t.lastNode();if(!s.isVisible()||s.pickable===!1)return!0;if(s.inputListeners.length&&t.isVisible()){const r=HitAreaOverlay.getLocalMouseShape(s),o=HitAreaOverlay.getLocalTouchShape(s),n=t.getMatrix();r.bounds.isEmpty()||this.addShape(r.transformed(n),"rgba(0,0,255,0.8)",!0),o.bounds.isEmpty()||this.addShape(o.transformed(n),"rgba(255,0,0,0.8)",!1)}return!1})}static getLocalMouseShape(t){let s=Shape$1.union([t.mouseArea?t.mouseArea instanceof Shape$1?t.mouseArea:Shape$1.bounds(t.mouseArea):t.getSelfShape(),...t.children.filter(r=>t.visible&&t.pickable!==!1).map(r=>HitAreaOverlay.getLocalMouseShape(r).transformed(r.matrix))]);return t.hasClipArea()&&(s=s.shapeIntersection(t.clipArea)),s}static getLocalTouchShape(t){let s=Shape$1.union([t.touchArea?t.touchArea instanceof Shape$1?t.touchArea:Shape$1.bounds(t.touchArea):t.getSelfShape(),...t.children.filter(r=>t.visible&&t.pickable!==!1).map(r=>HitAreaOverlay.getLocalTouchShape(r).transformed(r.matrix))]);return t.hasClipArea()&&(s=s.shapeIntersection(t.clipArea)),s}}scenery.register("HitAreaOverlay",HitAreaOverlay);class PointerAreaOverlay extends ShapeBasedOverlay{constructor(t,s){super(t,s,"mouseTouchAreaOverlay")}addShapes(){new Trail(this.rootNode).eachTrailUnder(t=>{const s=t.lastNode();if(!s.isVisible())return!0;if((s.mouseArea||s.touchArea)&&t.isVisible()){const r=t.getTransform();s.mouseArea&&this.addShape(r.transformShape(s.mouseArea instanceof Bounds2?Shape$1.bounds(s.mouseArea):s.mouseArea),"rgba(0,0,255,0.8)",!0),s.touchArea&&this.addShape(r.transformShape(s.touchArea instanceof Bounds2?Shape$1.bounds(s.touchArea):s.touchArea),"rgba(255,0,0,0.8)",!1)}return!1})}}scenery.register("PointerAreaOverlay",PointerAreaOverlay);class PointerOverlay{constructor(t,s){this.display=t,this.rootNode=s,this.pointerSVGContainer=document.createElement("div"),this.pointerSVGContainer.style.position="absolute",this.pointerSVGContainer.style.top="0",this.pointerSVGContainer.style.left="0",this.pointerSVGContainer.style["pointer-events"]="none";const r=10,o=1,n=(r+o/2)*2,l=n/2;t.sizeProperty.lazyLink(g=>{this.pointerSVGContainer.setAttribute("width",""+g.width),this.pointerSVGContainer.setAttribute("height",""+g.height),this.pointerSVGContainer.style.clip=`rect(0px,${g.width}px,${g.height}px,0px)`});const h=Matrix3.IDENTITY.copy();this.pointerAdded=g=>{const d=document.createElementNS(svgns,"svg");d.style.position="absolute",d.style.top="0",d.style.left="0",d.style["pointer-events"]="none",Utils.prepareForTransform(d),d.setAttribute("width",""+n),d.setAttribute("height",""+n);const A=document.createElementNS(svgns,"circle");A.setAttribute("cx",""+(r+o/2)),A.setAttribute("cy",""+(r+o/2)),A.setAttribute("r",""+r),A.setAttribute("style","fill:black;"),A.setAttribute("style","stroke:white;"),A.setAttribute("opacity","0.4");const S=W=>Utils.applyPreparedTransform(h.setToTranslation(W.x-l,W.y-l),d),O=()=>{g.isTouchLike()&&(this.pointerSVGContainer.removeChild(d),g.removeInputListener(I))},I={move:()=>{g.point&&S(g.point)},up:O,cancel:O,focus:()=>{g instanceof PDOMPointer&&g.point&&(S(g.point),this.pointerSVGContainer.appendChild(d))},blur:()=>{this.pointerSVGContainer.contains(d)&&this.pointerSVGContainer.removeChild(d)}};g.addInputListener(I),I.move(),d.appendChild(A),this.pointerSVGContainer.appendChild(d)},t._input.pointerAddedEmitter.addListener(this.pointerAdded),t._input&&t._input.mouse&&this.pointerAdded(t._input.mouse),this.domElement=this.pointerSVGContainer}dispose(){this.display._input.pointerAddedEmitter.removeListener(this.pointerAdded)}update(){}}scenery.register("PointerOverlay",PointerOverlay);let globalIdCounter$1=1;const defaultPreferredRenderers=Renderer.createOrderBitmask(Renderer.bitmaskSVG,Renderer.bitmaskCanvas,Renderer.bitmaskDOM,Renderer.bitmaskWebGL);class Instance{constructor(t,s,r,o){gt(this,"display",null);this.active=!1,this.initialize(t,s,r,o)}initialize(t,s,r,o){return assert&&assert(!this.active,"We should never try to initialize an already active object"),s.setImmutable(),this.id=this.id||globalIdCounter$1++,this.isWebGLSupported=t.isWebGLAllowed()&&Utils.isWebGLSupported,this.relativeTransform=this.relativeTransform||new RelativeTransform(this),this.fittability=this.fittability||new Fittability(this),this.visible=!0,this.relativeVisible=!0,this.selfVisible=!0,this.visibilityDirty=!0,this.childVisibilityDirty=!0,this.voicingVisible=!0,this.branchIndexMap=this.branchIndexMap||{},this.branchIndexReferences=cleanArray(this.branchIndexReferences),this.addRemoveCounter=0,this.stitchChangeFrame=t._frameId,this.stitchChangeBefore=0,this.stitchChangeAfter=0,this.stitchChangeOnChildren=0,this.stitchChangeIncluded=!1,this.childInsertedListener=this.childInsertedListener||this.onChildInserted.bind(this),this.childRemovedListener=this.childRemovedListener||this.onChildRemoved.bind(this),this.childrenReorderedListener=this.childrenReorderedListener||this.onChildrenReordered.bind(this),this.visibilityListener=this.visibilityListener||this.onVisibilityChange.bind(this),this.markRenderStateDirtyListener=this.markRenderStateDirtyListener||this.markRenderStateDirty.bind(this),this.visibleEmitter=new TinyEmitter,this.relativeVisibleEmitter=new TinyEmitter,this.selfVisibleEmitter=new TinyEmitter,this.canVoiceEmitter=new TinyEmitter,this.cleanInstance(t,s),this.node.addInstance(this),this.externalReferenceCount=0,this.stateless=!0,this.isDisplayRoot=r,this.isSharedCanvasCacheRoot=o,this.preferredRenderers=0,this.isUnderCanvasCache=o,this.isBackbone=!1,this.isTransformed=!1,this.isVisibilityApplied=!1,this.isInstanceCanvasCache=!1,this.isSharedCanvasCachePlaceholder=!1,this.isSharedCanvasCacheSelf=o,this.selfRenderer=0,this.groupRenderer=0,this.sharedCacheRenderer=0,this.renderStateDirtyFrame=t._frameId,this.skipPruningFrame=t._frameId,sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`initialized ${this.toString()}`),this.active=!0,this}cleanInstance(t,s){this.display=t,this.trail=s,this.node=s?s.lastNode():null,this.parent=null,this.oldParent=null,this.children=cleanArray(this.children),this.sharedCacheInstance=null,this.relativeTransform.initialize(t,s),this.fittability.initialize(t,s),this.instanceRemovalCheckList=cleanArray(this.instanceRemovalCheckList),this.selfDrawable=null,this.groupDrawable=null,this.sharedCacheDrawable=null,this.firstDrawable=null,this.lastDrawable=null,this.firstInnerDrawable=null,this.lastInnerDrawable=null,this.svgGroups=cleanArray(this.svgGroups),this.cleanSyncTreeResults()}cleanSyncTreeResults(){this.beforeStableIndex=this.children.length,this.afterStableIndex=-1,this.firstChangeInterval=null,this.lastChangeInterval=null,this.incompatibleStateChange=!1,this.groupChanged=!1,this.cascadingStateChange=!1,this.anyStateChange=!1}updateRenderingState(){sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`updateRenderingState ${this.toString()}${this.stateless?" (stateless)":""}`),sceneryLog&&sceneryLog.Instance&&sceneryLog.push(),sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`old: ${this.getStateString()}`);const t=this.isBackbone,s=this.isTransformed,r=this.isVisibilityApplied,o=this.isInstanceCanvasCache,n=this.isSharedCanvasCacheSelf,l=this.isSharedCanvasCachePlaceholder,h=this.isUnderCanvasCache,g=this.selfRenderer,d=this.groupRenderer,A=this.sharedCacheRenderer,S=this.preferredRenderers;this.isBackbone=!1,this.isTransformed=!1,this.isVisibilityApplied=!1,this.isInstanceCanvasCache=!1,this.isSharedCanvasCacheSelf=!1,this.isSharedCanvasCachePlaceholder=!1,this.selfRenderer=0,this.groupRenderer=0,this.sharedCacheRenderer=0;const O=this.node;this.isUnderCanvasCache=this.isSharedCanvasCacheRoot||(this.parent?this.parent.isUnderCanvasCache||this.parent.isInstanceCanvasCache||this.parent.isSharedCanvasCacheSelf:!1),this.preferredRenderers=this.parent?this.parent.preferredRenderers:defaultPreferredRenderers,O._renderer&&(this.preferredRenderers=Renderer.pushOrderBitmask(this.preferredRenderers,O._renderer));const I=this.node.hasClipArea(),W=this.node.effectiveOpacity!==1||O._usesOpacity||this.node._filters.length>0;let L=!1,H=!1;if(W)for(let fe=0;fe<this.node._filters.length;fe++){const ye=this.node._filters[fe];ye.isSVGCompatible()||(L=!0),ye.isCanvasCompatible()||(H=!0)}const Y=O._cssTransform||O._layerSplit,Q=this.isDisplayRoot||!this.isUnderCanvasCache&&Y,pe=!Q&&(W||I)&&(!L&&this.node._rendererSummary.isSubtreeRenderedExclusivelySVG(this.preferredRenderers)||!H&&this.node._rendererSummary.isSubtreeRenderedExclusivelyCanvas(this.preferredRenderers));if((pe?!1:Q||W||I)?(this.isBackbone=!0,this.isVisibilityApplied=!0,this.isTransformed=this.isDisplayRoot||!!O._cssTransform,this.groupRenderer=Renderer.bitmaskDOM):!pe&&(W||I||O._canvasCache)&&(assert&&assert(this.node._rendererSummary.isSingleCanvasSupported(),`Node canvasCache provided, but not all node contents can be rendered with Canvas under ${this.node.constructor.name}`),O._singleCache?this.isSharedCanvasCacheRoot?(this.isSharedCanvasCacheSelf=!0,this.sharedCacheRenderer=this.isWebGLSupported?Renderer.bitmaskWebGL:Renderer.bitmaskCanvas):(assert&&assert(this.node._rendererSummary.areBoundsValid(),`Node singleCache provided, but not all node contents have valid bounds under ${this.node.constructor.name}`),this.isSharedCanvasCachePlaceholder=!0):(this.isInstanceCanvasCache=!0,this.isUnderCanvasCache=!0,this.groupRenderer=this.isWebGLSupported?Renderer.bitmaskWebGL:Renderer.bitmaskCanvas)),this.node.isPainted())if(this.isUnderCanvasCache)this.selfRenderer=Renderer.bitmaskCanvas;else{let fe=this.node._rendererBitmask;if(!this.isWebGLSupported){const ye=Renderer.bitmaskWebGL;fe=fe^fe&ye}this.selfRenderer=fe&Renderer.bitmaskOrder(this.preferredRenderers,0)||fe&Renderer.bitmaskOrder(this.preferredRenderers,1)||fe&Renderer.bitmaskOrder(this.preferredRenderers,2)||fe&Renderer.bitmaskOrder(this.preferredRenderers,3)||fe&Renderer.bitmaskSVG||fe&Renderer.bitmaskCanvas||fe&Renderer.bitmaskDOM||fe&Renderer.bitmaskWebGL||0,assert&&assert(this.selfRenderer,"setSelfRenderer failure?")}this.groupChanged=t!==this.isBackbone||o!==this.isInstanceCanvasCache||n!==this.isSharedCanvasCacheSelf,this.cascadingStateChange=h!==this.isUnderCanvasCache||S!==this.preferredRenderers,this.incompatibleStateChange=this.isTransformed!==s||this.isSharedCanvasCachePlaceholder!==l,this.anyStateChange=this.groupChanged||this.cascadingStateChange||this.incompatibleStateChange||g!==this.selfRenderer||d!==this.groupRenderer||A!==this.sharedCacheRenderer,r!==this.isVisibilityApplied&&(this.visibilityDirty=!0,this.parent&&this.parent.markChildVisibilityDirty()),this.fittability.checkSelfFittability(),sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`new: ${this.getStateString()}`),sceneryLog&&sceneryLog.Instance&&sceneryLog.pop()}getStateString(){return`${`S[ ${this.isDisplayRoot?"displayRoot ":""}${this.isBackbone?"backbone ":""}${this.isInstanceCanvasCache?"instanceCache ":""}${this.isSharedCanvasCachePlaceholder?"sharedCachePlaceholder ":""}${this.isSharedCanvasCacheSelf?"sharedCacheSelf ":""}${this.isTransformed?"TR ":""}${this.isVisibilityApplied?"VIS ":""}${this.selfRenderer?this.selfRenderer.toString(16):"-"},${this.groupRenderer?this.groupRenderer.toString(16):"-"},${this.sharedCacheRenderer?this.sharedCacheRenderer.toString(16):"-"} `}]`}baseSyncTree(){assert&&assert(this.isDisplayRoot,"baseSyncTree() should only be called on the root instance"),sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`-------- START baseSyncTree ${this.toString()} --------`),this.syncTree(),sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`-------- END baseSyncTree ${this.toString()} --------`),this.cleanSyncTreeResults()}syncTree(){sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`syncTree ${this.toString()} ${this.getStateString()}${this.stateless?" (stateless)":""}`),sceneryLog&&sceneryLog.Instance&&sceneryLog.push(),sceneryLog&&scenery.isLoggingPerformance()&&this.display.perfSyncTreeCount++,assert&&assert(!this.parent||!this.parent.stateless,"We should not have a stateless parent instance");const t=this.stateless;if(t||this.parent&&this.parent.cascadingStateChange||this.renderStateDirtyFrame===this.display._frameId?this.updateRenderingState():assertSlow&&(this.updateRenderingState(),assertSlow(!this.anyStateChange)),!t&&this.incompatibleStateChange)return sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`incompatible instance ${this.toString()} ${this.getStateString()}, aborting`),sceneryLog&&sceneryLog.Instance&&sceneryLog.pop(),!1;if(this.stateless=!1,assert&&assert(!t||this.children.length===0,"We should not have child instances on an instance without state"),t&&(this.isTransformed&&this.display.markTransformRootDirty(this,!0),this.attachNodeListeners()),this.isSharedCanvasCachePlaceholder)this.sharedSyncTree();else if(t||this.skipPruningFrame===this.display._frameId||this.anyStateChange){this.prepareChildInstances(t);const s=this.firstDrawable,r=this.lastDrawable,o=this.firstInnerDrawable,n=this.lastInnerDrawable,l=this.updateSelfDrawable();this.localSyncTree(l),assertSlow&&this.auditChangeIntervals(o,n,this.firstInnerDrawable,this.lastInnerDrawable),this.groupSyncTree(t),assertSlow&&this.auditChangeIntervals(s,r,this.firstDrawable,this.lastDrawable)}else sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance("pruned");return sceneryLog&&sceneryLog.Instance&&sceneryLog.pop(),!0}localSyncTree(t){const s=this.display._frameId;let r=this.selfDrawable,o=r;assert&&assert(this.firstChangeInterval===null&&this.lastChangeInterval===null,"sanity checks that cleanSyncTreeResults were called");let n=null;t&&(sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.ChangeInterval("self"),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.push(),n=ChangeInterval.newForDisplay(null,null,this.display),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.pop());let l=n,h=t?null:this.selfDrawable;for(let g=0;g<this.children.length;g++){let d=this.children[g];d.syncTree()||(d=this.updateIncompatibleChildInstance(d,g),d.syncTree());const S=d.shouldIncludeInParentDrawables();S&&d.firstDrawable&&(o?Drawable.connectDrawables(o,d.firstDrawable,this.display):r=d.firstDrawable,o=d.lastDrawable),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.ChangeInterval(`changes for ${d.toString()} in ${this.toString()}`),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.push();const O=d.stitchChangeIncluded,I=S;d.stitchChangeIncluded=I,sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.ChangeInterval(`included: ${O} => ${I}`),d.stitchChangeFrame===s?(sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.ChangeInterval("stitchChangeFrame full change interval"),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.push(),d.firstChangeInterval=d.lastChangeInterval=ChangeInterval.newForDisplay(null,null,this.display),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.pop()):assert&&assert(O===I,"If we do not have stitchChangeFrame activated, our inclusion should not have changed");const W=d.firstChangeInterval;let L=l&&l.drawableAfter===null;const H=W&&W.drawableBefore===null;if(d.stitchChangeBefore===s&&!L&&!H){sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.ChangeInterval("bridge"),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.push();const Q=ChangeInterval.newForDisplay(h,null,this.display);l&&(l.nextChangeInterval=Q),l=Q,n=n||l,L=!0,sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.pop()}if((O||I)&&(L?W?W.drawableBefore===null?(l.drawableAfter=W.drawableAfter,l.nextChangeInterval=W.nextChangeInterval,l=d.lastChangeInterval===W?l:d.lastChangeInterval):(l.drawableAfter=d.firstDrawable,l.nextChangeInterval=W,l=d.lastChangeInterval):l.drawableAfter=d.firstDrawable:W&&(n=n||W,W.drawableBefore===null&&(assert&&assert(!l||h,"If we have a current change interval, we should be guaranteed a non-null lastUnchangedDrawable"),W.drawableBefore=h),l&&(l.nextChangeInterval=W),l=d.lastChangeInterval),h=l&&l.drawableAfter===null?null:d.lastDrawable?d.lastDrawable:h),g===this.children.length-1&&d.stitchChangeAfter===s&&!(l&&l.drawableAfter===null)){const Q=ChangeInterval.newForDisplay(h,null,this.display);l&&(l.nextChangeInterval=Q),l=Q,n=n||l}d.cleanSyncTreeResults(),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.pop()}if(assert&&assert(!!n==!!l,"Presence of first and current change intervals should be equal"),!n&&this.stitchChangeOnChildren===this.display._frameId&&this.children.length===0&&(n=l=ChangeInterval.newForDisplay(null,null,this.display)),this.firstChangeInterval=n,this.lastChangeInterval=l,this.firstDrawable=this.firstInnerDrawable=r,this.lastDrawable=this.lastInnerDrawable=o,assertSlow){let g=null;for(let A=0;A<this.children.length;A++)if(this.children[A].shouldIncludeInParentDrawables()&&this.children[A].firstDrawable){g=this.children[A].firstDrawable;break}this.selfDrawable&&(g=this.selfDrawable);let d=this.selfDrawable;for(let A=this.children.length-1;A>=0;A--)if(this.children[A].shouldIncludeInParentDrawables()&&this.children[A].lastDrawable){d=this.children[A].lastDrawable;break}assertSlow(g===this.firstDrawable),assertSlow(d===this.lastDrawable)}}updateSelfDrawable(){if(this.node.isPainted()){const t=this.selfRenderer;if(!this.selfDrawable||!(this.selfDrawable.renderer&t&Renderer.bitmaskRendererArea))return this.selfDrawable&&(sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`replacing old drawable ${this.selfDrawable.toString()} with new renderer`),this.selfDrawable.markForDisposal(this.display)),this.selfDrawable=Renderer.createSelfDrawable(this,this.node,t,this.fittability.ancestorsFittable),assert&&assert(this.selfDrawable),!0}else assert&&assert(this.selfDrawable===null,"Non-painted nodes should not have a selfDrawable");return!1}updateIncompatibleChildInstance(t,s){if(sceneryLog&&scenery.isLoggingPerformance()){const o=t.getDescendantCount()+1;o>100?sceneryLog.PerfCritical&&sceneryLog.PerfCritical(`incompatible instance rebuild at ${this.trail.toPathString()}: ${o}`):o>40?sceneryLog.PerfMajor&&sceneryLog.PerfMajor(`incompatible instance rebuild at ${this.trail.toPathString()}: ${o}`):o>0&&sceneryLog.PerfMinor&&sceneryLog.PerfMinor(`incompatible instance rebuild at ${this.trail.toPathString()}: ${o}`)}this.display.markInstanceRootForDisposal(t);const r=Instance.createFromPool(this.display,this.trail.copy().addDescendant(t.node,s),!1,!1);return this.replaceInstanceWithIndex(t,r,s),r}groupSyncTree(t){const s=this.groupRenderer;assert&&assert((this.isBackbone?1:0)+(this.isInstanceCanvasCache?1:0)+(this.isSharedCanvasCacheSelf?1:0)==(s?1:0),"We should have precisely one of these flags set for us to have a groupRenderer");const r=!!s!=!!this.groupDrawable||!t&&this.groupChanged||this.groupDrawable&&this.groupDrawable.renderer!==s;r&&(this.groupDrawable&&(sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`replacing group drawable ${this.groupDrawable.toString()}`),this.groupDrawable.markForDisposal(this.display),this.groupDrawable=null),this.firstChangeInterval=this.lastChangeInterval=ChangeInterval.newForDisplay(null,null,this.display)),s&&(this.firstDrawable&&Drawable.disconnectBefore(this.firstDrawable,this.display),this.lastDrawable&&Drawable.disconnectAfter(this.lastDrawable,this.display),this.isBackbone?(r&&(this.groupDrawable=BackboneDrawable$1.createFromPool(this.display,this,this.getTransformRootInstance(),s,this.isDisplayRoot),this.isTransformed&&this.display.markTransformRootDirty(this,!0)),this.firstChangeInterval&&this.groupDrawable.stitch(this.firstDrawable,this.lastDrawable,this.firstChangeInterval,this.lastChangeInterval)):this.isInstanceCanvasCache?(r&&(this.groupDrawable=InlineCanvasCacheDrawable.createFromPool(s,this)),this.firstChangeInterval&&this.groupDrawable.stitch(this.firstDrawable,this.lastDrawable,this.firstChangeInterval,this.lastChangeInterval)):this.isSharedCanvasCacheSelf&&r&&(this.groupDrawable=CanvasBlock$1.createFromPool(s,this)),this.groupDrawable.setFittable(this.fittability.ancestorsFittable),this.firstDrawable=this.lastDrawable=this.groupDrawable),r?this.firstChangeInterval=this.lastChangeInterval=ChangeInterval.newForDisplay(null,null,this.display):s&&(this.firstChangeInterval=this.lastChangeInterval=null)}sharedSyncTree(){this.ensureSharedCacheInitialized();const t=this.sharedCacheRenderer;(!this.sharedCacheDrawable||this.sharedCacheDrawable.renderer!==t)&&(this.sharedCacheDrawable&&(sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`replacing shared cache drawable ${this.sharedCacheDrawable.toString()}`),this.sharedCacheDrawable.markForDisposal(this.display)),this.sharedCacheDrawable=new SharedCanvasCacheDrawable(this.trail,t,this,this.sharedCacheInstance),this.firstDrawable=this.sharedCacheDrawable,this.lastDrawable=this.sharedCacheDrawable,this.firstChangeInterval=this.lastChangeInterval=ChangeInterval.newForDisplay(null,null,this.display))}prepareChildInstances(t){for(;this.instanceRemovalCheckList.length;){const s=this.instanceRemovalCheckList.pop();s.addRemoveCounter===-1&&(s.addRemoveCounter=0,this.display.markInstanceRootForDisposal(s))}if(t)for(let s=0;s<this.node.children.length;s++){const r=this.node.children[s];this.appendInstance(Instance.createFromPool(this.display,this.trail.copy().addDescendant(r,s),!1,!1))}}ensureSharedCacheInitialized(){if(!this.sharedCacheInstance){const t=this.node.getId();this.sharedCacheInstance=this.display._sharedCanvasInstances[t],this.sharedCacheInstance||(this.sharedCacheInstance=Instance.createFromPool(this.display,new Trail(this.node),!1,!0),this.sharedCacheInstance.syncTree(),this.display._sharedCanvasInstances[t]=this.sharedCacheInstance,this.display.markTransformRootDirty(this.sharedCacheInstance,!0)),this.sharedCacheInstance.externalReferenceCount++,this.isTransformed&&this.display.markTransformRootDirty(this,!0)}}shouldIncludeInParentDrawables(){return this.node.isVisible()||!this.node.isExcludeInvisible()}findPreviousDrawable(t){for(let s=t-1;s>=0;s--){const r=this.children[s].lastDrawable;if(r!==null)return r}return null}findNextDrawable(t){const s=this.children.length;for(let r=t+1;r<s;r++){const o=this.children[r].firstDrawable;if(o!==null)return o}return null}appendInstance(t){this.insertInstance(t,this.children.length)}insertInstance(t,s){assert&&assert(t instanceof Instance),assert&&assert(s>=0&&s<=this.children.length,`Instance insertion bounds check for index ${s} with previous children length ${this.children.length}`),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.InstanceTree(`inserting ${t.toString()} into ${this.toString()}`),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.push(),t.stitchChangeFrame=this.display._frameId,this.stitchChangeOnChildren=this.display._frameId,this.children.splice(s,0,t),t.parent=this,t.oldParent=this,s<=this.beforeStableIndex&&(this.beforeStableIndex=s-1),s>this.afterStableIndex?this.afterStableIndex=s+1:this.afterStableIndex++,this.fittability.onInsert(t.fittability),this.relativeTransform.addInstance(t),this.markChildVisibilityDirty(),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.pop()}removeInstance(t){this.removeInstanceWithIndex(t,_.indexOf(this.children,t))}removeInstanceWithIndex(t,s){assert&&assert(t instanceof Instance),assert&&assert(s>=0&&s<this.children.length,`Instance removal bounds check for index ${s} with previous children length ${this.children.length}`),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.InstanceTree(`removing ${t.toString()} from ${this.toString()}`),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.push();const r=this.display._frameId;t.stitchChangeFrame=r,this.stitchChangeOnChildren=r,s-1>=0&&(this.children[s-1].stitchChangeAfter=r),s+1<this.children.length&&(this.children[s+1].stitchChangeBefore=r),this.children.splice(s,1),t.parent=null,t.oldParent=this,s<=this.beforeStableIndex&&(this.beforeStableIndex=s-1),s>=this.afterStableIndex?this.afterStableIndex=s:this.afterStableIndex--,this.fittability.onRemove(t.fittability),this.relativeTransform.removeInstance(t),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.pop()}replaceInstanceWithIndex(t,s,r){this.removeInstanceWithIndex(t,r),this.insertInstance(s,r)}reorderInstances(t,s){assert&&assert(typeof t=="number"),assert&&assert(typeof s=="number"),assert&&assert(t<=s),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.InstanceTree(`Reordering ${this.toString()}`),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.push();const r=this.display._frameId;this.children.splice(t,s-t+1);for(let o=t;o<=s;o++){const n=this.findChildInstanceOnNode(this.node._children[o]);this.children.splice(o,0,n),n.stitchChangeFrame=r,o>t&&(n.stitchChangeAfter=r),o<s&&(n.stitchChangeBefore=r)}this.stitchChangeOnChildren=r,this.beforeStableIndex=Math.min(this.beforeStableIndex,t-1),this.afterStableIndex=Math.max(this.afterStableIndex,s+1),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.pop()}findChildInstanceOnNode(t){const s=t.getInstances();for(let r=0;r<s.length;r++)if(s[r].oldParent===this)return s[r];return null}onChildInserted(t,s){sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`inserting child node ${t.constructor.name}#${t.id} into ${this.toString()}`),sceneryLog&&sceneryLog.Instance&&sceneryLog.push(),assert&&assert(!this.stateless,"If we are stateless, we should not receive these notifications");let r=this.findChildInstanceOnNode(t);r?(sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance("instance already exists"),r.addRemoveCounter+=1,assert&&assert(r.addRemoveCounter===0)):(sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance("creating stub instance"),sceneryLog&&sceneryLog.Instance&&sceneryLog.push(),r=Instance.createFromPool(this.display,this.trail.copy().addDescendant(t,s),!1,!1),sceneryLog&&sceneryLog.Instance&&sceneryLog.pop()),this.insertInstance(r,s),this.markSkipPruning(),sceneryLog&&sceneryLog.Instance&&sceneryLog.pop()}onChildRemoved(t,s){sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`removing child node ${t.constructor.name}#${t.id} from ${this.toString()}`),sceneryLog&&sceneryLog.Instance&&sceneryLog.push(),assert&&assert(!this.stateless,"If we are stateless, we should not receive these notifications"),assert&&assert(this.children[s].node===t,"Ensure that our instance matches up");const r=this.findChildInstanceOnNode(t);assert&&assert(r!==null,"We should always have a reference to a removed instance"),r.addRemoveCounter-=1,assert&&assert(r.addRemoveCounter===-1),this.instanceRemovalCheckList.push(r),this.removeInstanceWithIndex(r,s),this.markSkipPruning(),sceneryLog&&sceneryLog.Instance&&sceneryLog.pop()}onChildrenReordered(t,s){sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`reordering children for ${this.toString()}`),sceneryLog&&sceneryLog.Instance&&sceneryLog.push(),this.reorderInstances(t,s),this.markSkipPruning(),sceneryLog&&sceneryLog.Instance&&sceneryLog.pop()}onVisibilityChange(){assert&&assert(!this.stateless,"If we are stateless, we should not receive these notifications"),this.stitchChangeFrame=this.display._frameId,this.parent&&this.parent.markSkipPruning(),this.visibilityDirty=!0,this.parent&&this.parent.markChildVisibilityDirty()}onOpacityChange(){assert&&assert(!this.stateless,"If we are stateless, we should not receive these notifications"),this.markRenderStateDirty()}markChildVisibilityDirty(){this.childVisibilityDirty||(this.childVisibilityDirty=!0,this.parent&&this.parent.markChildVisibilityDirty())}updateDrawableFittability(t){this.selfDrawable&&this.selfDrawable.setFittable(t),this.groupDrawable&&this.groupDrawable.setFittable(t)}updateVisibility(t,s,r,o){this.visibilityDirty&&(o=!0);const n=this.node.isVisible(),l=this.visible,h=this.relativeVisible,g=this.selfVisible,d=this.node.voicingVisibleProperty.value,A=this.voicingVisible,S=l&&A;this.visible=t&&n,this.voicingVisible=s&&d,this.relativeVisible=r&&n,this.selfVisible=this.isVisibilityApplied?!0:this.relativeVisible;const O=this.children.length;for(let W=0;W<O;W++){const L=this.children[W];(o||L.visibilityDirty||L.childVisibilityDirty)&&L.updateVisibility(this.visible,this.voicingVisible,this.isVisibilityApplied?!0:this.relativeVisible,o)}this.visibilityDirty=!1,this.childVisibilityDirty=!1,this.visible!==l&&this.visibleEmitter.emit(),this.relativeVisible!==h&&this.relativeVisibleEmitter.emit(),this.selfVisible!==g&&this.selfVisibleEmitter.emit();const I=this.voicingVisible&&this.visible;I!==S&&this.canVoiceEmitter.emit(I)}getDescendantCount(){let t=this.children.length;for(let s=0;s<this.children.length;s++)t+=this.children[s].getDescendantCount();return t}addSVGGroup(t){this.svgGroups.push(t)}removeSVGGroup(t){arrayRemove(this.svgGroups,t)}lookupSVGGroup(t){const s=this.svgGroups.length;for(let r=0;r<s;r++){const o=this.svgGroups[r];if(o.block===t)return o}return null}getFilterRootInstance(){return this.isBackbone||this.isInstanceCanvasCache||!this.parent?this:this.parent.getFilterRootInstance()}getTransformRootInstance(){return this.isTransformed||!this.parent?this:this.parent.getTransformRootInstance()}getVisibilityRootInstance(){return this.isVisibilityApplied||!this.parent?this:this.parent.getVisibilityRootInstance()}attachNodeListeners(){this.relativeTransform.attachNodeListeners(),this.isSharedCanvasCachePlaceholder||(this.node.childInsertedEmitter.addListener(this.childInsertedListener),this.node.childRemovedEmitter.addListener(this.childRemovedListener),this.node.childrenReorderedEmitter.addListener(this.childrenReorderedListener),this.node.visibleProperty.lazyLink(this.visibilityListener),this.node.voicingVisibleProperty.lazyLink(this.visibilityListener),this.node.filterChangeEmitter.addListener(this.markRenderStateDirtyListener),this.node.clipAreaProperty.lazyLink(this.markRenderStateDirtyListener),this.node.instanceRefreshEmitter.addListener(this.markRenderStateDirtyListener))}detachNodeListeners(){this.relativeTransform.detachNodeListeners(),this.isSharedCanvasCachePlaceholder||(this.node.childInsertedEmitter.removeListener(this.childInsertedListener),this.node.childRemovedEmitter.removeListener(this.childRemovedListener),this.node.childrenReorderedEmitter.removeListener(this.childrenReorderedListener),this.node.visibleProperty.unlink(this.visibilityListener),this.node.voicingVisibleProperty.unlink(this.visibilityListener),this.node.filterChangeEmitter.removeListener(this.markRenderStateDirtyListener),this.node.clipAreaProperty.unlink(this.markRenderStateDirtyListener),this.node.instanceRefreshEmitter.removeListener(this.markRenderStateDirtyListener))}markRenderStateDirty(){this.renderStateDirtyFrame=this.display._frameId,this.parent&&this.parent.markSkipPruning()}markSkipPruning(){this.skipPruningFrame=this.display._frameId,this.parent&&this.parent.markSkipPruning()}getBranchIndexTo(t){const s=this.branchIndexMap[t.id];if(s!==void 0)return s;const r=this.trail.getBranchIndexTo(t.trail);return this.branchIndexMap[t.id]=r,t.branchIndexMap[this.id]=r,this.branchIndexReferences.push(t),t.branchIndexReferences.push(this),r}dispose(){for(sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`dispose ${this.toString()}`),sceneryLog&&sceneryLog.Instance&&sceneryLog.push(),assert&&assert(this.active,"Seems like we tried to dispose this Instance twice, it is not active"),this.active=!1;this.branchIndexReferences.length;){const s=this.branchIndexReferences.pop();delete this.branchIndexMap[s.id],delete s.branchIndexMap[this.id],arrayRemove(s.branchIndexReferences,this)}this.groupDrawable&&this.groupDrawable.disposeImmediately(this.display),this.sharedCacheDrawable&&this.sharedCacheDrawable.disposeImmediately(this.display),this.selfDrawable&&this.selfDrawable.disposeImmediately(this.display);const t=this.children.length;for(let s=0;s<t;s++)this.children[s].dispose();for(;this.instanceRemovalCheckList.length;){const s=this.instanceRemovalCheckList.pop();s.active&&s.dispose()}this.stateless||this.detachNodeListeners(),this.node.removeInstance(this),this.sharedCacheInstance&&(this.sharedCacheInstance.externalReferenceCount--,this.sharedCacheInstance.externalReferenceCount===0&&(delete this.display._sharedCanvasInstances[this.node.getId()],this.sharedCacheInstance.dispose())),this.cleanInstance(null,null),this.visibleEmitter.removeAllListeners(),this.relativeVisibleEmitter.removeAllListeners(),this.selfVisibleEmitter.removeAllListeners(),this.canVoiceEmitter.removeAllListeners(),this.freeToPool(),sceneryLog&&sceneryLog.Instance&&sceneryLog.pop()}audit(t,s){if(assertSlow){t===void 0&&(t=this.display._frameId),assertSlow(!this.stateless,"State is required for all display instances"),assertSlow(this.firstDrawable===null==(this.lastDrawable===null),"First/last drawables need to both be null or non-null"),assertSlow(!this.isBackbone&&!this.isSharedCanvasCachePlaceholder||this.groupDrawable,"If we are a backbone or shared cache, we need to have a groupDrawable reference"),assertSlow(!this.isSharedCanvasCachePlaceholder||!this.node.isPainted()||this.selfDrawable,"We need to have a selfDrawable if we are painted and not a shared cache"),assertSlow(!this.isTransformed&&!this.isCanvasCache||this.groupDrawable,"We need to have a groupDrawable if we are a backbone or any type of canvas cache"),assertSlow(!this.isSharedCanvasCachePlaceholder||this.sharedCacheDrawable,"We need to have a sharedCacheDrawable if we are a shared cache"),assertSlow(this.addRemoveCounter===0,"Our addRemoveCounter should always be 0 at the end of syncTree");for(let r=0;r<this.children.length;r++)this.children[r].audit(t,s);this.relativeTransform.audit(t,s),this.fittability.audit()}}auditVisibility(t){if(assertSlow){const s=t&&this.node.isVisible(),r=this.trail.isVisible();assertSlow(s===r,"Trail visibility failure"),assertSlow(s===this.visible,"Visible flag failure"),assertSlow(this.voicingVisible===_.reduce(this.trail.nodes,(o,n)=>o&&n.voicingVisibleProperty.value,!0),"When this Instance is voicingVisible: true, all Trail Nodes must also be voicingVisible: true");for(let o=0;o<this.children.length;o++)this.children[o].auditVisibility(s)}}auditChangeIntervals(t,s,r,o){if(t){let l=t;for(;l!==s;)l=l.oldNextDrawable}if(r){let l=r;for(;l!==o;)l=l.nextDrawable}function n(l,h){if(assertSlow)for(assertSlow(l!==null),assertSlow(h!==null);l!==h;)assertSlow(l.nextDrawable===l.oldNextDrawable,"Change interval mismatch"),l=l.nextDrawable}if(assertSlow){const l=this.firstChangeInterval,h=this.lastChangeInterval;if((!l||l.drawableBefore!==null)&&assertSlow(t===r,"If we have no changes, or our first change interval is not open, our firsts should be the same"),(!h||h.drawableAfter!==null)&&assertSlow(s===o,"If we have no changes, or our last change interval is not open, our lasts should be the same"),!l)assertSlow(!h,"We should not be missing only one change interval"),t&&n(t,s);else{assertSlow(h,"We should not be missing only one change interval"),l.drawableBefore!==null&&n(t,l.drawableBefore),h.drawableAfter!==null&&n(h.drawableAfter,s);let g=l;for(;g&&g.nextChangeInterval;){const d=g.nextChangeInterval;assertSlow(g.drawableAfter!==null),assertSlow(d.drawableBefore!==null),n(g.drawableAfter,d.drawableBefore),g=d}}}}toString(){return`${this.id}#${this.node?`${this.node.constructor.name?this.node.constructor.name:"?"}#${this.node.id}`:"-"}`}}scenery.register("Instance",Instance);Poolable.mixInto(Instance);const Instance$1=Instance;class SafariWorkaroundOverlay{constructor(t){this.display=t;const s=document.createElementNS(svgns,"svg");this.domElement=s,s.style.position="absolute",s.setAttribute("class","safari-workaround"),s.style.top="0",s.style.left="0",s.style["pointer-events"]="none",t.sizeProperty.link(r=>{s.setAttribute("width",""+r.width),s.setAttribute("height",""+r.height),s.style.clip=`rect(0px,${r.width}px,${r.height}px,0px)`}),this.rect=document.createElementNS(svgns,"rect"),s.appendChild(this.rect),this.update()}update(){const t=dotRandom.nextDouble();this.rect.setAttribute("x",""+t),this.rect.setAttribute("y",""+t),this.rect.setAttribute("style","fill: rgba(255,200,100,0); stroke: none;"),this.display.width&&this.rect.setAttribute("width",""+(this.display.width-t*2)),this.display.height&&this.rect.setAttribute("height",""+(this.display.height-t*2))}}scenery.register("SafariWorkaroundOverlay",SafariWorkaroundOverlay);const CUSTOM_CURSORS={"scenery-grab-pointer":["grab","-moz-grab","-webkit-grab","pointer"],"scenery-grabbing-pointer":["grabbing","-moz-grabbing","-webkit-grabbing","pointer"]};let globalIdCounter=1;const wr=class wr{constructor(t,s){this._refreshSVGEmitter=new Emitter,this._refreshSVGPending=!1,assert&&assert(t,"rootNode is a required parameter");const r=optionize()({width:s&&s.container&&s.container.clientWidth||640,height:s&&s.container&&s.container.clientHeight||480,allowCSSHacks:!0,allowSafariRedrawWorkaround:!1,allowSceneOverflow:!1,allowLayerFitting:!1,forceSVGRefresh:!1,defaultCursor:"default",backgroundColor:null,preserveDrawingBuffer:!1,allowWebGL:!0,accessibility:!0,supportsInteractiveHighlights:!1,interactive:!0,listenToOnlyElement:!1,batchDOMEvents:!1,assumeFullWindow:!1,aggressiveContextRecreation:!0,passiveEvents:platform.safari?!1:null,allowBackingScaleAntialiasing:!0},s);this.id=globalIdCounter++,this._accessible=r.accessibility,this._preserveDrawingBuffer=r.preserveDrawingBuffer,this._allowWebGL=r.allowWebGL,this._allowCSSHacks=r.allowCSSHacks,this._allowSceneOverflow=r.allowSceneOverflow,this._defaultCursor=r.defaultCursor,this.sizeProperty=new TinyProperty(new Dimension2(r.width,r.height)),this._currentSize=new Dimension2(-1,-1),this._rootNode=t,this._rootNode.addRootedDisplay(this),this._rootBackbone=null,this._domElement=r.container?BackboneDrawable$1.repurposeBackboneContainer(r.container):BackboneDrawable$1.createDivBackbone(),this._sharedCanvasInstances={},this._baseInstance=null,this._frameId=0,this._dirtyTransformRoots=[],this._dirtyTransformRootsWithoutPass=[],this._instanceRootsToDispose=[],this._reduceReferencesNeeded=[],this._drawablesToDispose=[],this._drawablesToChangeBlock=[],this._drawablesToUpdateLinks=[],this._changeIntervalsToDispose=[],this._lastCursor=null,this._currentBackgroundCSS=null,this._backgroundColor=null,this._requestAnimationFrameID=0,this._input=null,this._inputListeners=[],this._interactive=r.interactive,this._listenToOnlyElement=r.listenToOnlyElement,this._batchDOMEvents=r.batchDOMEvents,this._assumeFullWindow=r.assumeFullWindow,this._passiveEvents=r.passiveEvents,this._aggressiveContextRecreation=r.aggressiveContextRecreation,this._allowBackingScaleAntialiasing=r.allowBackingScaleAntialiasing,this._allowLayerFitting=r.allowLayerFitting,this._forceSVGRefresh=r.forceSVGRefresh,this._overlays=[],this._pointerOverlay=null,this._pointerAreaOverlay=null,this._hitAreaOverlay=null,this._canvasAreaBoundsOverlay=null,this._fittedBlockBoundsOverlay=null,assert&&(this._isPainting=!1,this._isDisposing=!1,this._isDisposed=!1),this.applyCSSHacks(),this.setBackgroundColor(r.backgroundColor);const o=new AriaLiveAnnouncer$1;if(this.descriptionUtteranceQueue=new UtteranceQueue$1(o,{initialize:this._accessible,featureSpecificAnnouncingControlPropertyName:"descriptionCanAnnounceProperty"}),platform.safari&&r.allowSafariRedrawWorkaround&&this.addOverlay(new SafariWorkaroundOverlay(this)),this.focusManager=new FocusManager,(this._accessible||r.supportsInteractiveHighlights)&&(this._focusRootNode=new Node$2,this._focusOverlay=new HighlightOverlay(this,this._focusRootNode,{pdomFocusHighlightsVisibleProperty:this.focusManager.pdomFocusHighlightsVisibleProperty,interactiveHighlightsVisibleProperty:this.focusManager.interactiveHighlightsVisibleProperty,readingBlockHighlightsVisibleProperty:this.focusManager.readingBlockHighlightsVisibleProperty}),this.addOverlay(this._focusOverlay)),this._accessible){this._rootPDOMInstance=PDOMInstance$1.pool.create(null,this,new Trail),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`Display root instance: ${this._rootPDOMInstance.toString()}`),PDOMTree$1.rebuildInstanceTree(this._rootPDOMInstance),assert&&assert(this._rootPDOMInstance.peer,"Peer should be created from createFromPool"),this._domElement.appendChild(this._rootPDOMInstance.peer.primarySibling);const n=o.ariaLiveContainer;this._domElement.appendChild(n),n.style[Features.userSelect]="none",this._boundHandleFullScreenNavigation=this.handleFullScreenNavigation.bind(this),globalKeyStateTracker$1.keydownEmitter.addListener(this._boundHandleFullScreenNavigation)}}getDOMElement(){return this._domElement}get domElement(){return this.getDOMElement()}updateDisplay(){sceneryLog&&scenery.isLoggingPerformance()&&(this.perfSyncTreeCount=0,this.perfStitchCount=0,this.perfIntervalCount=0,this.perfDrawableBlockChangeCount=0,this.perfDrawableOldIntervalCount=0,this.perfDrawableNewIntervalCount=0),assert&&wr.assertSubtreeDisposed(this._rootNode),sceneryLog&&sceneryLog.Display&&sceneryLog.Display(`updateDisplay frame ${this._frameId}`),sceneryLog&&sceneryLog.Display&&sceneryLog.push();const t=!!this._baseInstance;for(this._input&&this._input.validatePointers(),this._accessible&&this._rootPDOMInstance.peer.updateSubtreePositioning(),this._rootNode.validateWatchedBounds(),assertSlow&&this._accessible&&this._rootPDOMInstance.auditRoot(),assertSlow&&this._rootNode._picker.audit(),this._baseInstance=this._baseInstance||Instance$1.createFromPool(this,new Trail(this._rootNode),!0,!1),this._baseInstance.baseSyncTree(),t&&this.markTransformRootDirty(this._baseInstance,this._baseInstance.isTransformed);this._drawablesToUpdateLinks.length;)this._drawablesToUpdateLinks.pop().updateLinks();for(;this._changeIntervalsToDispose.length;)this._changeIntervalsToDispose.pop().dispose();for(this._rootBackbone=this._rootBackbone||this._baseInstance.groupDrawable,assert&&assert(this._rootBackbone,"We are guaranteed a root backbone as the groupDrawable on the base instance"),assert&&assert(this._rootBackbone===this._baseInstance.groupDrawable,"We don't want the base instance's groupDrawable to change"),assertSlow&&this._rootBackbone.audit(!0,!1,!0),sceneryLog&&sceneryLog.Display&&sceneryLog.Display("drawable block change phase"),sceneryLog&&sceneryLog.Display&&sceneryLog.push();this._drawablesToChangeBlock.length;){const s=this._drawablesToChangeBlock.pop().updateBlock();sceneryLog&&scenery.isLoggingPerformance()&&s&&this.perfDrawableBlockChangeCount++}for(sceneryLog&&sceneryLog.Display&&sceneryLog.pop(),assertSlow&&this._rootBackbone.audit(!1,!1,!0),assertSlow&&this._baseInstance.audit(this._frameId,!1),this.updateDirtyTransformRoots(),this._baseInstance.updateVisibility(!0,!0,!0,!1),assertSlow&&this._baseInstance.auditVisibility(!0),assertSlow&&this._baseInstance.audit(this._frameId,!0),sceneryLog&&sceneryLog.Display&&sceneryLog.Display("instance root disposal phase"),sceneryLog&&sceneryLog.Display&&sceneryLog.push();this._instanceRootsToDispose.length;)this._instanceRootsToDispose.pop().dispose();for(sceneryLog&&sceneryLog.Display&&sceneryLog.pop(),assertSlow&&this._rootNode.auditInstanceSubtreeForDisplay(this),sceneryLog&&sceneryLog.Display&&sceneryLog.Display("drawable disposal phase"),sceneryLog&&sceneryLog.Display&&sceneryLog.push();this._drawablesToDispose.length;)this._drawablesToDispose.pop().dispose();if(sceneryLog&&sceneryLog.Display&&sceneryLog.pop(),assertSlow&&this._baseInstance.audit(this._frameId,!1),assert&&(assert(!this._isPainting,"Display was already updating paint, may have thrown an error on the last update"),this._isPainting=!0),sceneryLog&&sceneryLog.Display&&sceneryLog.Display("repaint phase"),sceneryLog&&sceneryLog.Display&&sceneryLog.push(),this._rootBackbone.update(),sceneryLog&&sceneryLog.Display&&sceneryLog.pop(),assert&&(this._isPainting=!1),assertSlow&&this._rootBackbone.audit(!1,!1,!1),assertSlow&&this._baseInstance.audit(this._frameId,!1),this.updateCursor(),this.updateBackgroundColor(),this.updateSize(),this._overlays.length){let s=this._rootBackbone.lastZIndex;for(let r=0;r<this._overlays.length;r++){const o=this._overlays[r];o.domElement.style.zIndex=""+s++,o.update()}}for(;this._reduceReferencesNeeded.length;)this._reduceReferencesNeeded.pop().reduceReferences();if(this._frameId++,sceneryLog&&scenery.isLoggingPerformance()){const s=`syncTree count: ${this.perfSyncTreeCount}`;this.perfSyncTreeCount>500?sceneryLog.PerfCritical&&sceneryLog.PerfCritical(s):this.perfSyncTreeCount>100?sceneryLog.PerfMajor&&sceneryLog.PerfMajor(s):this.perfSyncTreeCount>20?sceneryLog.PerfMinor&&sceneryLog.PerfMinor(s):this.perfSyncTreeCount>0&&sceneryLog.PerfVerbose&&sceneryLog.PerfVerbose(s);const r=`drawable block changes: ${this.perfDrawableBlockChangeCount} for -${this.perfDrawableOldIntervalCount} +${this.perfDrawableNewIntervalCount}`;this.perfDrawableBlockChangeCount>200?sceneryLog.PerfCritical&&sceneryLog.PerfCritical(r):this.perfDrawableBlockChangeCount>60?sceneryLog.PerfMajor&&sceneryLog.PerfMajor(r):this.perfDrawableBlockChangeCount>10?sceneryLog.PerfMinor&&sceneryLog.PerfMinor(r):this.perfDrawableBlockChangeCount>0&&sceneryLog.PerfVerbose&&sceneryLog.PerfVerbose(r)}PDOMTree$1.auditPDOMDisplays(this.rootNode),(this._forceSVGRefresh||this._refreshSVGPending)&&(this._refreshSVGPending=!1,this.refreshSVG()),sceneryLog&&sceneryLog.Display&&sceneryLog.pop()}getPhetioElementAt(t){const s=this._rootNode.getPhetioMouseHit(t);return s==="phetioNotSelectable"?null:(s&&assert&&assert(s.isPhetioInstrumented(),"a PhetioMouseHit should be instrumented"),s)}updateSize(){let t=!1;this.size.width!==this._currentSize.width&&(t=!0,this._currentSize.width=this.size.width,this._domElement.style.width=`${this.size.width}px`),this.size.height!==this._currentSize.height&&(t=!0,this._currentSize.height=this.size.height,this._domElement.style.height=`${this.size.height}px`),t&&!this._allowSceneOverflow&&(this._domElement.style.clip=`rect(0px,${this.size.width}px,${this.size.height}px,0px)`)}isWebGLAllowed(){return this._allowWebGL}get webglAllowed(){return this.isWebGLAllowed()}getRootNode(){return this._rootNode}get rootNode(){return this.getRootNode()}getRootBackbone(){return assert&&assert(this._rootBackbone),this._rootBackbone}get rootBackbone(){return this.getRootBackbone()}getSize(){return this.sizeProperty.value}get size(){return this.getSize()}getBounds(){return this.size.toBounds()}get bounds(){return this.getBounds()}setSize(t){assert&&assert(t.width%1===0,"Display.width should be an integer"),assert&&assert(t.width>0,"Display.width should be greater than zero"),assert&&assert(t.height%1===0,"Display.height should be an integer"),assert&&assert(t.height>0,"Display.height should be greater than zero"),this.sizeProperty.value=t}setWidthHeight(t,s){this.setSize(new Dimension2(t,s))}getWidth(){return this.size.width}get width(){return this.getWidth()}set width(t){this.setWidth(t)}setWidth(t){return this.getWidth()!==t&&this.setSize(new Dimension2(t,this.getHeight())),this}getHeight(){return this.size.height}get height(){return this.getHeight()}set height(t){this.setHeight(t)}setHeight(t){return this.getHeight()!==t&&this.setSize(new Dimension2(this.getWidth(),t)),this}setBackgroundColor(t){return assert&&assert(t===null||typeof t=="string"||t instanceof Color),this._backgroundColor=t,this}set backgroundColor(t){this.setBackgroundColor(t)}get backgroundColor(){return this.getBackgroundColor()}getBackgroundColor(){return this._backgroundColor}get interactive(){return this._interactive}set interactive(t){this._accessible&&t!==this._interactive&&this._rootPDOMInstance.peer.recursiveDisable(!t),this._interactive=t,!this._interactive&&this._input&&(this._input.interruptPointers(),this._input.clearBatchedEvents(),this._input.removeTemporaryPointers(),this._rootNode.interruptSubtreeInput(),this.interruptInput())}addOverlay(t){this._overlays.push(t),this._domElement.appendChild(t.domElement),t.domElement.setAttribute("aria-hidden","true")}removeOverlay(t){this._domElement.removeChild(t.domElement),this._overlays.splice(_.indexOf(this._overlays,t),1)}getPDOMRootElement(){return this._accessible?this._rootPDOMInstance.peer.primarySibling:null}get pdomRootElement(){return this.getPDOMRootElement()}isAccessible(){return this._accessible}isElementUnderPDOM(t){return this._accessible&&this.pdomRootElement.contains(t)}handleFullScreenNavigation(t){if(assert&&assert(this.pdomRootElement,"There must be a PDOM to support keyboard navigation"),FullScreen$1.isFullScreen()&&KeyboardUtils.isKeyEvent(t,KeyboardUtils.KEY_TAB)){const s=this.pdomRootElement;(t.shiftKey?PDOMUtils$1.getPreviousFocusable(s||void 0):PDOMUtils$1.getNextFocusable(s||void 0))===t.target&&t.preventDefault()}}getUsedRenderersBitmask(){function t(s){let r=0;return _.each(s.blocks,o=>{o instanceof DOMBlock$1&&o.domDrawable instanceof BackboneDrawable$1?r=r|t(o.domDrawable):r=r|o.renderer}),r}return t(this._rootBackbone)&Renderer.bitmaskRendererArea}markTransformRootDirty(t,s){s?this._dirtyTransformRoots.push(t):this._dirtyTransformRootsWithoutPass.push(t)}updateDirtyTransformRoots(){for(sceneryLog&&sceneryLog.transformSystem&&sceneryLog.transformSystem("updateDirtyTransformRoots"),sceneryLog&&sceneryLog.transformSystem&&sceneryLog.push();this._dirtyTransformRoots.length;)this._dirtyTransformRoots.pop().relativeTransform.updateTransformListenersAndCompute(!1,!1,this._frameId,!0);for(;this._dirtyTransformRootsWithoutPass.length;)this._dirtyTransformRootsWithoutPass.pop().relativeTransform.updateTransformListenersAndCompute(!1,!1,this._frameId,!1);sceneryLog&&sceneryLog.transformSystem&&sceneryLog.pop()}markDrawableChangedBlock(t){sceneryLog&&sceneryLog.Display&&sceneryLog.Display(`markDrawableChangedBlock: ${t.toString()}`),this._drawablesToChangeBlock.push(t)}markForReducedReferences(t){assert&&assert(!!t.reduceReferences),this._reduceReferencesNeeded.push(t)}markInstanceRootForDisposal(t){sceneryLog&&sceneryLog.Display&&sceneryLog.Display(`markInstanceRootForDisposal: ${t.toString()}`),this._instanceRootsToDispose.push(t)}markDrawableForDisposal(t){sceneryLog&&sceneryLog.Display&&sceneryLog.Display(`markDrawableForDisposal: ${t.toString()}`),this._drawablesToDispose.push(t)}markDrawableForLinksUpdate(t){this._drawablesToUpdateLinks.push(t)}markChangeIntervalToDispose(t){this._changeIntervalsToDispose.push(t)}updateBackgroundColor(){assert&&assert(this._backgroundColor===null||typeof this._backgroundColor=="string"||this._backgroundColor instanceof Color);const t=this._backgroundColor===null?"":this._backgroundColor.toCSS?this._backgroundColor.toCSS():this._backgroundColor;t!==this._currentBackgroundCSS&&(this._currentBackgroundCSS=t,this._domElement.style.backgroundColor=t)}updateCursor(){if(this._input&&this._input.mouse&&this._input.mouse.point){if(this._input.mouse.cursor){sceneryLog&&sceneryLog.Cursor&&sceneryLog.Cursor(`set on pointer: ${this._input.mouse.cursor}`),this.setSceneCursor(this._input.mouse.cursor);return}const t=this._rootNode.trailUnderPointer(this._input.mouse);if(t)for(let s=t.getCursorCheckIndex();s>=0;s--){const r=t.nodes[s],o=r.getEffectiveCursor();if(o){sceneryLog&&sceneryLog.Cursor&&sceneryLog.Cursor(`${o} on ${r.constructor.name}#${r.id}`),this.setSceneCursor(o);return}}sceneryLog&&sceneryLog.Cursor&&sceneryLog.Cursor(`--- for ${t?t.toString():"(no hit)"}`)}this.setSceneCursor(this._defaultCursor)}setElementCursor(t){this._domElement.style.cursor=t,this._assumeFullWindow&&(document.body.style.cursor=t)}setSceneCursor(t){if(t!==this._lastCursor){this._lastCursor=t;const s=CUSTOM_CURSORS[t];if(s)for(let r=s.length-1;r>=0;r--)this.setElementCursor(s[r]);else this.setElementCursor(t)}}applyCSSHacks(){this._allowSceneOverflow||(this._domElement.style.overflow="hidden"),this._domElement.style.msTouchAction="none",Features.setStyle(this._domElement,Features.fontSmoothing,"antialiased"),this._allowCSSHacks&&(document.onselectstart=()=>!1,document.body.style.msContentZooming="none",Features.setStyle(this._domElement,Features.userDrag,"none"),Features.setStyle(this._domElement,Features.userSelect,"none"),Features.setStyle(this._domElement,Features.touchAction,"none"),Features.setStyle(this._domElement,Features.touchCallout,"none"),Features.setStyle(this._domElement,Features.tapHighlightColor,"rgba(0,0,0,0)"))}canvasDataURL(t){this.canvasSnapshot(s=>{t(s.toDataURL())})}canvasSnapshot(t){const s=document.createElement("canvas");s.width=this.size.width,s.height=this.size.height;const r=s.getContext("2d");this._rootNode.renderToCanvas(s,r,()=>{t(s,r.getImageData(0,0,s.width,s.height))},this.domElement.style.backgroundColor)}setPointerDisplayVisible(t){const s=!!this._pointerOverlay;t!==s&&(t?(this._pointerOverlay=new PointerOverlay(this,this._rootNode),this.addOverlay(this._pointerOverlay)):(this.removeOverlay(this._pointerOverlay),this._pointerOverlay.dispose(),this._pointerOverlay=null))}setPointerAreaDisplayVisible(t){const s=!!this._pointerAreaOverlay;t!==s&&(t?(this._pointerAreaOverlay=new PointerAreaOverlay(this,this._rootNode),this.addOverlay(this._pointerAreaOverlay)):(this.removeOverlay(this._pointerAreaOverlay),this._pointerAreaOverlay.dispose(),this._pointerAreaOverlay=null))}setHitAreaDisplayVisible(t){const s=!!this._hitAreaOverlay;t!==s&&(t?(this._hitAreaOverlay=new HitAreaOverlay(this,this._rootNode),this.addOverlay(this._hitAreaOverlay)):(this.removeOverlay(this._hitAreaOverlay),this._hitAreaOverlay.dispose(),this._hitAreaOverlay=null))}setCanvasNodeBoundsVisible(t){const s=!!this._canvasAreaBoundsOverlay;t!==s&&(t?(this._canvasAreaBoundsOverlay=new CanvasNodeBoundsOverlay(this,this._rootNode),this.addOverlay(this._canvasAreaBoundsOverlay)):(this.removeOverlay(this._canvasAreaBoundsOverlay),this._canvasAreaBoundsOverlay.dispose(),this._canvasAreaBoundsOverlay=null))}setFittedBlockBoundsVisible(t){const s=!!this._fittedBlockBoundsOverlay;t!==s&&(t?(this._fittedBlockBoundsOverlay=new FittedBlockBoundsOverlay(this,this._rootNode),this.addOverlay(this._fittedBlockBoundsOverlay)):(this.removeOverlay(this._fittedBlockBoundsOverlay),this._fittedBlockBoundsOverlay.dispose(),this._fittedBlockBoundsOverlay=null))}resizeOnWindowResize(){const t=()=>{this.setWidthHeight(window.innerWidth,window.innerHeight)};window.addEventListener("resize",t),t()}updateOnRequestAnimationFrame(t){let s=0,r=0;const o=this;(function n(){o._requestAnimationFrameID=window.requestAnimationFrame(n,o._domElement);const l=Date.now();s!==0&&(r=(l-s)/1e3),s=l,stepTimer.emit(r),t&&t(r),o.updateDisplay()})()}cancelUpdateOnRequestAnimationFrame(){window.cancelAnimationFrame(this._requestAnimationFrameID)}initializeEvents(t){assert&&assert(!this._input,"Events cannot be attached twice to a display (for now)");const s=new Input(this,!this._listenToOnlyElement,this._batchDOMEvents,this._assumeFullWindow,this._passiveEvents,t);this._input=s,s.connectListeners()}detachEvents(){assert&&assert(this._input,"detachEvents() should be called only when events are attached"),this._input.disconnectListeners(),this._input=null}addInputListener(t){return assert&&assert(!_.includes(this._inputListeners,t),"Input listener already registered on this Display"),_.includes(this._inputListeners,t)||this._inputListeners.push(t),this}removeInputListener(t){return assert&&assert(_.includes(this._inputListeners,t)),this._inputListeners.splice(_.indexOf(this._inputListeners,t),1),this}hasInputListener(t){for(let s=0;s<this._inputListeners.length;s++)if(this._inputListeners[s]===t)return!0;return!1}getInputListeners(){return this._inputListeners.slice(0)}get inputListeners(){return this.getInputListeners()}interruptInput(){const t=this.inputListeners;for(let s=0;s<t.length;s++){const r=t[s];r.interrupt&&r.interrupt()}return this}interruptPointers(){return this._input&&this._input.interruptPointers(),this}interruptOtherPointers(t=null){var s;return this._input&&this._input.interruptPointers(t||((s=this._input.currentSceneryEvent)==null?void 0:s.pointer)||null),this}ensureNotPainting(){assert&&assert(!this._isPainting,"This should not be run in the call tree of updateDisplay(). If you see this, it is likely that either the last updateDisplay() had a thrown error and it is trying to be run again (in which case, investigate that error), OR code was run/triggered from inside an updateDisplay() that has the potential to cause an infinite loop, e.g. CanvasNode paintCanvas() call manipulating another Node, or a bounds listener that Scenery missed.")}loseWebGLContexts(){(function t(s){s.blocks&&s.blocks.forEach(r=>{const o=r.gl;o&&Utils.loseContext(o);for(let n=r.firstDrawable;n!==null&&(t(n),n!==r.lastDrawable);n=n.nextDrawable);})})(this._rootBackbone)}inspect(){localStorage.scenerySnapshot=JSON.stringify(scenerySerialize(this))}getDebugHTML(){const t="font-weight: bold; font-size: 120%; margin-top: 5px;";let s=0,r="";r+=`<div style="${t}">Display (${this.id}) Summary</div>`,r+=`${this.size.toString()} frame:${this._frameId} input:${!!this._input} cursor:${this._lastCursor}<br/>`;function o(L){let H=1;for(let Y=0;Y<L.children.length;Y++)H+=o(L.children[Y]);return H}r+=`Nodes: ${o(this._rootNode)}<br/>`;function n(L){let H=1;for(let Y=0;Y<L.children.length;Y++)H+=n(L.children[Y]);return H}r+=this._baseInstance?`Instances: ${n(this._baseInstance)}<br/>`:"";function l(L){let H=1;if(L.blocks)_.each(L.blocks,Y=>{H+=l(Y)});else if(L.firstDrawable&&L.lastDrawable){for(let Y=L.firstDrawable;Y!==L.lastDrawable;Y=Y.nextDrawable)H+=l(Y);H+=l(L.lastDrawable)}return H}r+=this._rootBackbone?`Drawables: ${l(this._rootBackbone)}<br/>`:"";const h={};function g(L){const H=L.constructor.name;h[H]?h[H]++:h[H]=1}function d(L){let H=0;L.selfDrawable&&(g(L.selfDrawable),H++),L.groupDrawable&&(g(L.groupDrawable),H++),L.sharedCacheDrawable&&(g(L.sharedCacheDrawable),H++);for(let Y=0;Y<L.children.length;Y++)H+=d(L.children[Y]);return H}r+=this._baseInstance?`Retained Drawables: ${d(this._baseInstance)}<br/>`:"";for(const L in h)r+=`&nbsp;&nbsp;&nbsp;&nbsp;${L}: ${h[L]}<br/>`;function A(L){if(!L.firstDrawable||!L.lastDrawable)return"";const H=L.domDrawable&&L.domDrawable.blocks;let Y=`<div style="margin-left: ${s*20}px">`;if(Y+=L.toString(),H||(Y+=` (${L.drawableCount} drawables)`),Y+="</div>",s+=1,H)for(let Q=0;Q<L.domDrawable.blocks.length;Q++)Y+=A(L.domDrawable.blocks[Q]);return s-=1,Y}if(this._rootBackbone){r+=`<div style="${t}">Block Summary</div>`;for(let L=0;L<this._rootBackbone.blocks.length;L++)r+=A(this._rootBackbone.blocks[L])}function S(L){let H="";function Y(de){H+=` <span style="color: #008">${de}</span>`}const Q=L.node;H+=L.id,H+=` ${Q.constructor.name?Q.constructor.name:"?"}`,H+=` <span style="font-weight: ${Q.isPainted()?"bold":"normal"}">${Q.id}</span>`,H+=Q.getDebugHTMLExtras(),Q.visible||Y("invis"),L.visible||Y("I-invis"),L.relativeVisible||Y("I-rel-invis"),L.selfVisible||Y("I-self-invis"),L.fittability.ancestorsFittable||Y("nofit-ancestor"),L.fittability.selfFittable||Y("nofit-self"),Q.pickable===!0&&Y("pickable"),Q.pickable===!1&&Y("unpickable"),L.trail.isPickable()&&Y('<span style="color: #808">hits</span>'),Q.getEffectiveCursor()&&Y(`effectiveCursor:${Q.getEffectiveCursor()}`),Q.clipArea&&Y("clipArea"),Q.mouseArea&&Y("mouseArea"),Q.touchArea&&Y("touchArea"),Q.getInputListeners().length&&Y("inputListeners"),Q.getRenderer()&&Y(`renderer:${Q.getRenderer()}`),Q.isLayerSplit()&&Y("layerSplit"),Q.opacity<1&&Y(`opacity:${Q.opacity}`),Q.disabledOpacity<1&&Y(`disabledOpacity:${Q.disabledOpacity}`),Q._boundsEventCount>0&&Y(`<span style="color: #800">boundsListen:${Q._boundsEventCount}:${Q._boundsEventSelfCount}</span>`);let pe="";switch(Q.transform.getMatrix().type){case Matrix3Type.IDENTITY:pe="";break;case Matrix3Type.TRANSLATION_2D:pe="translated";break;case Matrix3Type.SCALING:pe="scale";break;case Matrix3Type.AFFINE:pe="affine";break;case Matrix3Type.OTHER:pe="other";break;default:throw new Error(`invalid matrix type: ${Q.transform.getMatrix().type}`)}return pe&&(H+=` <span style="color: #88f" title="${Q.transform.getMatrix().toString().replace(`
`,"&#10;")}">${pe}</span>`),H+=` <span style="color: #888">[Trail ${L.trail.indices.join(".")}]</span>`,H+=` <span style="color: #8c8">${Q._rendererSummary.bitmask.toString(16)}${Q._rendererBitmask!==Renderer.bitmaskNodeDefault?` (${Q._rendererBitmask.toString(16)})`:""}</span>`,H}function O(L){let H=L.toString();return L.visible&&(H=`<strong>${H}</strong>`),L.dirty&&(H+=L.dirty?' <span style="color: #c00;">[x]</span>':""),L.fittable||(H+=L.dirty?' <span style="color: #0c0;">[no-fit]</span>':""),H}function I(L){let H=`<div style="margin-left: ${s*20}px">`;function Y(Q,pe){H+=` <span style="color: #888">${Q}:${O(pe)}</span>`}H+=S(L),L.selfDrawable&&Y("self",L.selfDrawable),L.groupDrawable&&Y("group",L.groupDrawable),L.sharedCacheDrawable&&Y("sharedCache",L.sharedCacheDrawable),H+="</div>",r+=H,s+=1,_.each(L.children,Q=>{I(Q)}),s-=1}this._baseInstance&&(r+=`<div style="${t}">Root Instance Tree</div>`,I(this._baseInstance)),_.each(this._sharedCanvasInstances,L=>{r+=`<div style="${t}">Shared Canvas Instance Tree</div>`,I(L)});function W(L){let H=`<div style="margin-left: ${s*20}px">`;if(H+=O(L),L.instance?(H+=` <span style="color: #0a0;">(${L.instance.trail.toPathString()})</span>`,H+=`&nbsp;&nbsp;&nbsp;${S(L.instance)}`):L.backboneInstance&&(H+=` <span style="color: #a00;">(${L.backboneInstance.trail.toPathString()})</span>`,H+=`&nbsp;&nbsp;&nbsp;${S(L.backboneInstance)}`),H+="</div>",r+=H,L.blocks)s+=1,_.each(L.blocks,Y=>{W(Y)}),s-=1;else if(L.firstDrawable&&L.lastDrawable){s+=1;for(let Y=L.firstDrawable;Y!==L.lastDrawable;Y=Y.nextDrawable)W(Y);W(L.lastDrawable),s-=1}}return this._rootBackbone&&(r+='<div style="font-weight: bold;">Root Drawable Tree</div>',W(this._rootBackbone)),r}getDebugURI(){return`data:text/html;charset=utf-8,${encodeURIComponent(`<!DOCTYPE html><html lang="en"><head><title>Scenery Debug Snapshot</title></head><body style="font-size: 12px;">${this.getDebugHTML()}</body></html>`)}`}popupDebug(){window.open(this.getDebugURI())}iframeDebug(){const t=document.createElement("iframe");t.width=""+window.innerWidth,t.height=""+window.innerHeight,t.style.position="absolute",t.style.left="0",t.style.top="0",t.style.zIndex="10000",document.body.appendChild(t),t.contentWindow.document.open(),t.contentWindow.document.write(this.getDebugHTML()),t.contentWindow.document.close(),t.contentWindow.document.body.style.background="white";const s=document.createElement("button");s.style.position="absolute",s.style.top="0",s.style.right="0",s.style.zIndex="10001",document.body.appendChild(s),s.textContent="close",["pointerdown","click","touchdown"].forEach(r=>{s.addEventListener(r,()=>{document.body.removeChild(t),document.body.removeChild(s)},!0)})}getPDOMDebugHTML(){let t="";const s="font-weight: bold; font-size: 120%; margin-top: 5px;",r="&nbsp;&nbsp;&nbsp;&nbsp;";t+=`<div style="${s}">Accessible Instances</div><br>`,o(this._rootPDOMInstance,"");function o(g,d){t+=`${d+escapeHTML(`${g.isRootInstance?"":g.node.tagName} ${g.toString()}`)}<br>`,g.children.forEach(A=>{o(A,d+r)})}t+=`<br><div style="${s}">Parallel DOM</div><br>`;let n=this._rootPDOMInstance.peer.primarySibling.outerHTML;n=n.replace(/></g,`>
<`);const l=n.split(`
`);let h="";for(let g=0;g<l.length;g++){const d=l[g],A=d.startsWith("</");A&&(h=h.slice(r.length)),t+=`${h+escapeHTML(d)}<br>`,A||(h+=r)}return t}foreignObjectRasterization(t){const s={};let r=0;function o(W){W.id||(W.id=`unknown-canvas-${r++}`),s[W.id]=W.toDataURL()}function n(W){if(W instanceof BackboneDrawable$1)_.each(W.blocks,L=>{n(L)});else if(W instanceof Block$1&&W.firstDrawable&&W.lastDrawable){for(let L=W.firstDrawable;L!==W.lastDrawable;L=L.nextDrawable)n(L);n(W.lastDrawable),(W instanceof CanvasBlock$1||W instanceof WebGLBlock$1)&&W.canvas&&W.canvas instanceof window.HTMLCanvasElement&&o(W.canvas)}DOMDrawable$1&&W instanceof DOMDrawable$1&&(W.domElement instanceof window.HTMLCanvasElement&&o(W.domElement),Array.prototype.forEach.call(W.domElement.getElementsByTagName("canvas"),L=>{o(L)}))}n(this._rootBackbone);const l=document.implementation.createHTMLDocument("");l.documentElement.innerHTML=this.domElement.outerHTML,l.documentElement.setAttribute("xmlns",l.documentElement.namespaceURI),l.documentElement.appendChild(document.createElement("style")).innerHTML=`.${PDOMSiblingStyle$1.ROOT_CLASS_NAME} { display:none; } `;let h=l.documentElement.getElementsByTagName("canvas");h=Array.prototype.slice.call(h);for(let W=0;W<h.length;W++){const L=h[W],H=L.style.cssText,Y=l.createElement("img"),Q=s[L.id];assert&&assert(Q,"Must have missed a toDataURL() on a Canvas"),Y.src=Q,Y.setAttribute("style",H),L.parentNode.replaceChild(Y,L)}const g=this.width,d=this.height,A=()=>{wr.elementToSVGDataURL(l.documentElement,g,d,t)};let S=0,O=!1;const I=Array.prototype.slice.call(l.documentElement.getElementsByTagName("image"));for(let W=0;W<I.length;W++){const L=I[W],H=L.getAttribute("xlink:href");H.slice(0,5)!=="data:"&&(S++,O=!0,(()=>{const Y=new window.Image,Q=L;Y.onload=()=>{const pe=document.createElement("canvas");pe.width=Y.width,pe.height=Y.height,pe.getContext("2d").drawImage(Y,0,0),Q.setAttribute("xlink:href",pe.toDataURL()),--S===0&&A(),assert&&assert(S>=0)},Y.onerror=()=>{--S===0&&A(),assert&&assert(S>=0)},Y.src=H})())}O||A()}popupRasterization(){this.foreignObjectRasterization(t=>{t&&window.open(t)})}getTrailFromPDOMIndicesString(t){if(!this._rootPDOMInstance)return null;let s=this._rootPDOMInstance;const r=t.split(PDOMUtils$1.PDOM_UNIQUE_ID_SEPARATOR);for(let o=0;o<r.length;o++){const n=Number(r[o]);if(s=s.children[n],!s)return null}return s&&s.trail?s.trail:null}refreshSVG(){this._refreshSVGEmitter.emit()}refreshSVGOnNextFrame(){this._refreshSVGPending=!0}dispose(){assert&&(assert(!this._isDisposing),assert(!this._isDisposed),this._isDisposing=!0),this._input&&this.detachEvents(),this._rootNode.removeRootedDisplay(this),this._accessible&&(assert&&assert(this._boundHandleFullScreenNavigation,"_boundHandleFullScreenNavigation was not added to the keyStateTracker"),globalKeyStateTracker$1.keydownEmitter.removeListener(this._boundHandleFullScreenNavigation),this._rootPDOMInstance.dispose()),this._focusOverlay&&this._focusOverlay.dispose(),this.sizeProperty.dispose(),this._baseInstance&&this._baseInstance.dispose(),this.descriptionUtteranceQueue.dispose(),this.focusManager&&this.focusManager.dispose(),assert&&(this._isDisposing=!1,this._isDisposed=!0)}static elementToSVGDataURL(t,s,r,o){const n=document.createElement("canvas"),l=n.getContext("2d");n.width=s,n.height=r;const h=new window.XMLSerializer().serializeToString(t),g=`<svg xmlns="http://www.w3.org/2000/svg" width="${s}" height="${r}"><foreignObject width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml">${h}</div></foreignObject></svg>`,d=new window.Image;d.onload=()=>{l.drawImage(d,0,0),o(n.toDataURL())},d.onerror=()=>{o(null)};const A=new window.TextEncoderLite("utf-8").encode(g),S=window.fromByteArray(A);d.src=`data:image/svg+xml;base64,${S}`}static assertSubtreeDisposed(t){if(assert&&assert(!t.isDisposed,"Disposed nodes should not be included in a scene graph to display."),assert)for(let s=0;s<t.children.length;s++)wr.assertSubtreeDisposed(t.children[s])}static addInputListener(t){assert&&assert(!_.includes(wr.inputListeners,t),"Input listener already registered"),_.includes(wr.inputListeners,t)||wr.inputListeners.push(t)}static removeInputListener(t){assert&&assert(_.includes(wr.inputListeners,t)),wr.inputListeners.splice(_.indexOf(wr.inputListeners,t),1)}static interruptInput(){const t=wr.inputListeners.slice(0);for(let s=0;s<t.length;s++){const r=t[s];r.interrupt&&r.interrupt()}}};wr.INTERRUPT_OTHER_POINTERS=t=>{var s,r;(r=(s=phet==null?void 0:phet.joist)==null?void 0:s.display)==null||r.interruptOtherPointers(t==null?void 0:t.pointer)};let Display=wr;scenery.register("Display",Display);Display.userGestureEmitter=new Emitter;Display.inputListeners=[];const map={};let index=0;function moveForward(a){a._parents.forEach(t=>moveChild(t,a,1))}function moveBackward(a){a._parents.forEach(t=>moveChild(t,a,-1))}function unlinkIndex(a){const t=map[a];assert&&assert(this.parents.length===1,"IndexedNodeIO only supports nodes with a single parent"),this.parents[0].childrenChangedEmitter.removeListener(t),delete map[a]}function moveChild(a,t,s){let o=a.indexOfChild(t)+s;for(;o>0&&o<a.children.length&&!a.children[o].visible;)o+=s;o>=0&&o<a.children.length&&a.moveChildToIndex(t,o),a.onIndexedNodeIOChildMoved&&a.onIndexedNodeIOChildMoved(t)}const IndexedNodeIO=new IOType("IndexedNodeIO",{valueType:Node$2,documentation:"Node that can be moved forward/back by index, which specifies z-order and/or layout order",supertype:Node$2.NodeIO,toStateObject:a=>{const t={index:null};return a.parents[0]&&(assert&&assert(a.parents.length===1,"IndexedNodeIO only supports nodes with a single parent"),t.index=a.parents[0].indexOfChild(a)),t},applyState:(a,t)=>{const s=a.parents[0];if(s&&t.index){assert&&assert(a.parents.length===1,"IndexedNodeIO only supports nodes with a single parent");const r=s.children,o=s.indexOfChild(a);r[o]=r[t.index],r[t.index]=a,s.setChildren(r)}},stateSchema:{index:NullableIO(NumberIO)},methods:{linkIndex:{returnType:NumberIO,parameterTypes:[FunctionIO(VoidIO,[NumberIO])],documentation:"Following the PropertyIO.link pattern, subscribe for notifications when the index in the parent changes, and receive a callback with the current value.  The return value is a numeric ID for use with clearLinkIndex.",implementation:function(a){const t=()=>{assert&&assert(this.parents.length===1,"IndexedNodeIO only supports nodes with a single parent");const r=this.parents[0].indexOfChild(this);a(r)};assert&&assert(this.parents.length===1,"IndexedNodeIO only supports nodes with a single parent"),this.parents[0].childrenChangedEmitter.addListener(t),t();const s=index;return map[s]=t,index++,s}},unlinkIndex:{returnType:VoidIO,parameterTypes:[NumberIO],documentation:"Unlink a listener that has been added using linkIndex, by its numerical ID (like setTimeout/clearTimeout)",implementation:unlinkIndex},clearLinkIndex:{returnType:VoidIO,parameterTypes:[NumberIO],documentation:'Deprecated, see "unlinkIndex".',implementation:function(a){assert&&deprecationWarning("clearLinkIndex is deprecated, use unlinkIndex instead.",!0),unlinkIndex.call(this,a)}},moveForward:{returnType:VoidIO,parameterTypes:[],implementation:function(){return moveForward(this)},documentation:"Move this Node one index forward in each of its parents, skipping invisible Nodes. If the Node is already at the front, this is a no-op."},moveBackward:{returnType:VoidIO,parameterTypes:[],implementation:function(){return moveBackward(this)},documentation:"Move this Node one index backward in each of its parents, skipping invisible Nodes. If the Node is already at the back, this is a no-op."}}});scenery.register("IndexedNodeIO",IndexedNodeIO);class PhetioControlledVisibilityProperty extends DerivedProperty{constructor(t,s,r){r=merge({nodeTandem:Tandem.REQUIRED},r);const o=new BooleanProperty(!0,{tandem:r.nodeTandem.createTandem("visibleProperty")});super([o,...t],(n,...l)=>n&&s(...l))}}scenery.register("PhetioControlledVisibilityProperty",PhetioControlledVisibilityProperty);const SlitherQueryParameters=QueryStringMachine.getAll({p:{type:"string",defaultValue:""},debugScan:{type:"flag"},debugSleep:{type:"flag"},debugColors:{type:"flag"},showPointerAreas:{type:"flag"}});class LocalStorageProperty extends Property{constructor(t,s){super(s.deserialize(localStorage.getItem(t))),this.link(r=>{const o=s.serialize(r),n=r===s.deserialize(null),l=localStorage.getItem(t);n?l!==null&&localStorage.removeItem(t):l!==o&&localStorage.setItem(t,s.serialize(r))})}}class LocalStorageBooleanProperty extends LocalStorageProperty{constructor(t,s){super(t,{serialize:r=>r.toString(),deserialize:r=>r==="true"||r==="false"?r==="true":s})}}class LocalStorageNumberProperty extends LocalStorageProperty{constructor(t,s){super(t,{serialize:r=>r.toString(),deserialize:r=>r===null?s:parseFloat(r)})}}class LocalStorageEnumerationProperty extends LocalStorageProperty{constructor(t,s){super(t,{serialize:r=>r.name,deserialize:r=>r&&s.enumeration.getValue(r)||s})}}class LocalStorageStringProperty extends LocalStorageProperty{constructor(t,s){super(t,{serialize:r=>r,deserialize:r=>r||s})}}const ka=class ka{static registerDataURL(t,s,r){if(phet.chipper.queryParameters.binder){const o=`${t}/${s}`;ka.componentMap[o]=ka.componentMap[o]||[];try{r.toDataURL(n=>{ka.componentMap[o].push(n)})}catch{}}}static registerToolbox(t){phet.chipper.queryParameters.binder&&ka.registerDataURL("sun","ToolboxPattern",t)}};ka.componentMap={};let InstanceRegistry=ka;phetCore.register("InstanceRegistry",InstanceRegistry);const sun=new Namespace("sun"),base64SoundToByteArray=(a,t)=>{const s=t.replace(new RegExp("^.*,"),""),r=atob(s),o=new Uint8Array(r.length);for(let n=0;n<o.length;n++)o[n]=r.charCodeAt(n);return o},tambo=new Namespace("tambo");class WrappedAudioBuffer{constructor(){this.audioBufferProperty=new TinyProperty(null),assert&&this.audioBufferProperty.lazyLink((t,s)=>{assert&&assert(s===null&&t!==null,"The audio buffer can only be set once")})}}tambo.register("WrappedAudioBuffer",WrappedAudioBuffer);let phetAudioContext;window.AudioContext?phetAudioContext=new window.AudioContext:window.webkitAudioContext?phetAudioContext=new window.webkitAudioContext:(phetAudioContext={},console.error("error: this browser does not support Web Audio"));tambo.register("phetAudioContext",phetAudioContext);const phetAudioContext$1=phetAudioContext,soundURI$g="data:audio/mpeg;base64,//swxAAAA8ADNZQRgDGHni23MIAC1bbaiNgdgM+wEHBiogUAbxA4MT+////gh//8Mf4YzNI0kYiNYjDZaLJCYAZZgbhKQTNx5Vp34WpSu/bhLvzLYwWSHokUhx0EBR4FA/Mp8sOz3gcWfL9YqH7kKIkzd9fLvSkB201St7337UyHKf7X9Pf//Ue9/6irjy/l3s5gqCo1lPVlVSBj//syxAOACFB7hZyUgDEUCu008ZpKfZq0pMq3UhCDwXYfD+n5X+IUp5YiEYMB0CgRCwfQF0AmAUjAlZVJuE4ZaTbKK0AIJCxUAwrWLf////l1oFP9Yo2m1QI89G8bsISUXc8TjPs5pDlVUzUq1VJLFYcIlvdQS0P1lohZFx5hFpVDCPaSKlRsdgIslDzfeqxt8iVd+v6aClA3ydRso//7MsQDgAhYV13sGEqhEJFpcZMJqE0gGS8ZU3ekWmMRbO4kqZnMgAHAFiPmBRdQFgRZHZrTNwZcRTYLKU4qxy3ieKohBwSNif5UwYc4W/ywiEYAtIWoggTByJ+YPcFxgdYE5MVlD41ZJSYBdPF8gQIZtZPy/cZWxBR5Bm7WwZdGkolTRTQXLpSOcoUvf3in/dyBZwzRXAF3ieJEAxD/+zLEBAAIkJlXlYaAARIWb3MegACpLHqwdgk0mfJ913UT0LiL5W+nIh+DsKATQJ4F0E4PF8c7FxaaaCZ80SpqZbfX7J/99fN0p/Onf+zSaVmKSAKAgKAgMAAAAAEBCVMt4sfsyRdHO3PTH0SBFi4jhEgNBinEXeeDSKeby9zBMKun3/pKZ6L//H/6T/p/82bkkAyj/5m7WOWuRFpI//swxAOACDgvi7zDADEQkW289AoWMABHxkZCUEwfjodDiYmpiWw9NWjIAhJEFkFSo4GnxwiDsrBoGn/g0DT64Kgq9BUFQWBo3WFDf4B//ljZRUwaFSyREkApYqDmkM8qYgtylZx9ZL7knEF4rFKLgqfa4GHahJbD5q+ZdeybNpd1LOzqJVWdmJgs9uNUoK61I9Pf1runDP5da2kA//syxAQACHita6eYTzEMFSdkzAigHGL2uEMDLL6xtFmUuujunUP9ODzjFKbt2J5yt77uOmiJWXQ6GAbIjvu17WVn/dDEccwhLJLW6dXU/dcsEAvP8BAST22Qg8WJEX2Cxxs84/BnOt15rGZwVs2FEtKWVPRHZitdbuySkumtHlb0M/U5QwcQRYSLI91T/epbUqPPogEGy4Ldq0ABj//7MsQEgAfcrTesFG1owIRiqMyYmD9U8MBcisSsURTFgBykNZkSUjL+oDB8VGCT310AYfb2ZlVRgEvbASNp8ptD8y7lYYlvxtFsCgAAYAQABAzjzrwIrmT2cuLIZOOOhHHQELC2rOtlix709VXnYiej4dx2rz2Vd/xL6QQAAHCikADAVHicCJrfesiRcXCNaoKuuneW+r1dXxFDvZf/+zLEEQBFcCEJoLHi8JuFVvDMGGz/vqeWI50KHuGnJHLWAAQIl4qgkpSn8oGq1rUCoSk3UAhEYtCgKWWwwIDo////4sLVTEFNRTMuOTkuNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",soundByteArray$g=base64SoundToByteArray(phetAudioContext$1,soundURI$g),unlock$g=asyncLoader.createLock(soundURI$g),wrappedAudioBuffer$g=new WrappedAudioBuffer;let unlocked$g=!1;const safeUnlock$g=()=>{unlocked$g||(unlock$g(),unlocked$g=!0)},onDecodeSuccess$g=a=>{wrappedAudioBuffer$g.audioBufferProperty.value===null&&(wrappedAudioBuffer$g.audioBufferProperty.set(a),safeUnlock$g())},onDecodeError$g=a=>{console.warn("decode of audio data failed, using stubbed sound, error: "+a),wrappedAudioBuffer$g.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$g()},decodePromise$g=phetAudioContext$1.decodeAudioData(soundByteArray$g.buffer,onDecodeSuccess$g,onDecodeError$g);decodePromise$g&&decodePromise$g.then(a=>{wrappedAudioBuffer$g.audioBufferProperty.value===null&&(wrappedAudioBuffer$g.audioBufferProperty.set(a),safeUnlock$g())}).catch(a=>{console.warn("promise rejection caught for audio decode, error = "+a),safeUnlock$g()});const soundURI$f="data:audio/mpeg;base64,//twxAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAAvAAA6xgAFBQoKEBAVFRsbICAmJisrKzExNjY7O0FBRkZMTFFRV1dXXFxiYmdnbGxycnd3fX2CgoKIiI2Nk5OYmJ2do6OoqK6urrOzubm+vsTEycnOztTU2dnZ39/k5Orq7+/19fr6//8AAAA5TEFNRTMuOTlyAc0AAAAAAAAAABRgJAW0QgAAYAAAOsbaTGT/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/7cMQAAA7dBSqUMwACca6u+zCwACApgAAXXczyPLdxZhAGAydwQABDIj/xEZEREf+Lu7u7/u7ve0Rd3etERv//7EAGAydsYQhyCEf3va73/vdxEREREE78RGRBMmnYPg+DgIHC5QH3rB/EAIHCCgQBAoCDsEFAgCBQ5BAMS4P8Hwff8Tg+/Ln/wfw/dtCpCmhkRCphx5RJJZZeBkRuhKWvyydbusLOy2X0io3WgGaNyeDJBmxPyYwBMkkASVLJiZ9hJJ6AbpW4kk99nJJYE5sSUUDSD0v2Uxg7HWSUR3HErRtlPe9nmg/mKDjSLtiEPSe+7iuGG73WurKU76Uc2rl97P/53S1Zi7F7bTdrqiJq7Yyv/6/4uDVj3sbtRSKhqLrLWf///+W7VaNBODMAAAAAhEmcl8uCdsv/+3LECACSeTVr3PYAAgosbbjzDui0GmTRO96xrR6OSGLxYWzCh0mEDaIBVQ1xdHw5aTTq1RBj58yvaK7kDNUcale1G/E8611+6daha6+Nuve72X/mq1vX4PrMdWcrz6xDa5mtWNdU7m/T6NNo///rm27+dT9a+Zkd6fT/g32p4lBxRRZUUEZkSpCIsNCAtctr9kCSmrzv/66lVQ1EAAAYJYBOUKeF2LY8JcplQlohfTxvMumyOzxtvJFI2I1iV/2+b7RFSrZTO6aJ5MkgHPUtQkCaHAveIIOrPtb93Iau5+y1NzYL9Qj73xM3UbSGUWHvsqfnJ4icIKCqmRkXHi7Fv5s+RbK+5lfBfsWpgmsPoMiQNQhUGq3ftfu6lZEQCAAdhIBYSUm4Mg3UkuGF41iEbgUdPDc0Got2R//7cMQPANKRa2aHsMvSTarsuPYZuF8aBIK5DNG4yVq00SKu45iMbvD0hnRdGZTLhUOlQUHEQxZI0nUJm0eSI9baV9KuyiRjoJrc+33zekx8HOlcjZN4SRow5KvReT0TCBrN5PBctW1DG1BO3JGo6UyE3L+XmU8bx+21n2sOs5ISgSu9fP1RoRMsZ77pdCNCIABRCfq0cp2mW1JA00GjDcnVzET1hxp6vWITR2PwVqBRd95y4yfxk4HlFxmuHsEjwSERbPSaPrt1rjJUq8jTztuqiMIVvokgVZPpldExIjDdS9MOF3tn6v8gSijYMhZdMloS84Dyk4Lsoac1AqaTR5XfbyTuuj6NOqzp1t9l4VzLVkgtFz8qLkpm8bfVkTwqWRSIAENhDHdSKh8TFYPi2SliEOJphuJA5jj/+3LEDQDTVTNihj00Sj4o7Hj2GbhRwjFogi0oCEEKpXkDQ1XO4UdTsldrplPYETbDxQUMN2RoQRERZZJQlaICdRovjetIl4a1AypaO64eFzYtvYbaiI8RsJrwhKL8V0lctGLEIJwUhc2no1E10MGWlobJRcTJOnBVN9RTe8x5xQY8gEhGeivAD9Kj2clnP0/r/o7f29wRGQgQABBRd4DWoKRz9PqW7bVVK8wKpJGy86YXjydIg7IaYyTkMnA2HwkDgymWHRgeURnDAzUiQpfWJbqrP1doW7Dr9JpEmgU3ufBglsjOYkLEluXfsxgU5RIm/ko4vtOUFPCpwXcpak5aDGo/HwkcpnNSBxyquxpaphphuZesaERW8FTYmOECqEVujZJWxNWpYjUiAAAAABXCElsN96SxSHuec//7cMQKANBlN2XHsMvKbSrr0PSbWKeMk7RApAVSWnGtss2qvAuSCo2gVOx7aTWgRwdC5Q5XKyMtVNm2IZy4mpVmLH7NfyhaRF/heeJh3pNkpMM/k7aMTihApGZc84qJyHSjTrYzLy6ivnLwz22bTM7drVPZtI9MRR3bZ+9w9Ltel/97bnYuNAAL8LFCONVLkcZinWN2qQORCmlQaUCJT9lzChDkF0X1hSqptOVIxmM7Ucp0/MfyWQlmdLghBKmIp2aFZWM5lgbPoUhg7qxmN4ISJCKXSnqNpc0uRnPprEOYXgy87ih5UlaYQL6pqaJsUsnzp5QwpzOkSOOOTWFwVqakTZwqdaj2KXRFTV0GKh7T2vvbe5QVFDwHXHqlajd9StYlCSAANRqSAJBoRRGHkjA6TxyIA+vliCT/+3LEDICQrSthZhh6yjIkbDj2DmFDE0z2x0vQCQoOhJx8rFAdFDZ2vbJInVXPpSeDcrLjyPC8sAiemDcKFpMhF92taG4+42EiJE1ZhgSicTrsjfS9/CvbIyoCrYmm3DfNNQ5WB0Q10HLJAbJkFwxC0Fu297fNssCm8QbOdO/tV193CKZmBAABKAVIlF5gMAgpbT/O44z8TDeq2eC+HqA1C7E7YpD9EOHZWJJIXXwqFJafKkaZZdeUkUBCEIBI+mpPYiwjK2c+A8hbbZ0dDQQHEkFHoymLa2AxYcIEUMoBuw5KalXDCLHkaBMydjxmN66RnpVdXDBxME0gEChkjzuO1DfKKlQPTu/9v+13e7u5VEUxAAAABwSD4UiRyLeZiLMih9sA4dhKdcRRCU8+ndKQ1pBGhsvHg3XLlP/7cMQWAI6I0WXHsGvJ8J1sOPYNufuFPYo0x0kMlqhDiah7AJAjhyh6wSZ9Q0zW4Fmbk5MFHDKCNKlXyosaC+UZEVWjIBeXysepCx8o6Hnlw99Pcn/nX7xI527e12HMSMQAAAZLEqHHAhktVh7RELbDJhIhuNWyQT1CWJsxIgkxgwokafXGxUcZiPnYTBebWTDm1GtWn8BaUuo1jFYMPL70cz7M6bZigguUndXaEhoGsIBrC6rofIZiBDspucY46sX9muDoPBsWHSspVvxWp8tep+vi/Pr/m/+qqFZFYiAAAAAFC7hekzJyZZ3DPXJLYJ3K6EgEKRDJAQqAAJ2tQkaMlJ9g2bWUVh9pkiZPrkJGOEC3SpVdVtOL2GV3u3WQKxUQ9pnsyKV0M7o+w7uitfchFc62amXq9jP/+3LEL4COtVtl56RNwc+c7Dj2DXiqImdumXoN5G0qdM1vGNpcQB6SK3stfTuhmYAAAPYxDlISOM0FaYScQ9cogwD5parHpabmJ02cKWFaxEmHzXEWQt1XXoQrr0x03A6yYQuPFiCooDQoADMSKNeSiBcJiFTW14plS3IQzZZ+zGUNiJQcVUyQHrrYTEJwCgUMtvaA5BZxkUNHiDpl1/7aiHJDMQAAAAd0PM3hxAzRwnszI9aOm6rP1Cz4kVEYDTgqjaIxSeFa6JUTE6ZAduaEgJFEQuoH1BUmWcgLonJImk1UGSej060BEKzkSvd3FAAcKYvbC5EajkYJHJt4WhjhkSOtLMnpG+e25jF+2IKxowYeXkTMqCiBRrK62W9MqhmKAAAlC7K4mQvz7bDlZi3uLyY4Cd+ileIl4//7cMRNAM+1J1/HpG3B9CRruPYOKDIUIfKFNyE20aoQMRidQ1TMr1HkdQpAaPaAfR1PmVh0sVsqnUJ9E3dkSwIE7XIhHBDikLgQfUa4kGkJQI4T07WgYkhdNcrlx3ztI6+nclBGyChIsak0m6ooFiykFiMdR02XdDUkEAAAABeVhMT4Q4vBoI4zFeh5yKRRoxZKlFZsZV+6GOTYUBUxsbq1Y/JbetkNqurITwvQn7unrGKo455/2ob/hWM6m/K2g7uR0dnbOk2v8RIzo+5ZUvPe/S9PekVx4v+JhTFxvHYyLuI6bRf3RXMd8HLtv/2qZFQxEAAAOCSHcYCfVg9RYz3cy9lxVSZfsYrcVNAqJH2eCC4rDI4HlSx8aLoAxpoicsqREoYYPB4FugaOFJwZcsVvFP1FeGEMm4T/+3LEYYCPESNh57BtyeElq7z0jbmgrq+MIEqRqRSYi0mPhTPRjNVrXp8LJ+SQ8uW7/DMGDumQ+rrzR3ryX3O92v+RqUY0MwAAAAAXTpGONc3KF+OsOo/FKbx/CSJZsYlI6vpgfMqj4UJDFS9C8Q05xZm37dchmZyevLGlS+Yo6iReBS3DRDRkkBm3NIU8lPqUlznCtWw5w498j/rVjQodLFEpY1rC7gWEYiNlrmpnowi9zVTjPdR42UgAACocAoQwUWABDmfHKCVTQThKTl+iZsqrjmg4BabHZYSJEZZOmEq84Q0z7rCMJCwVIgoYBKhkXK2JiFtvV10kLS9eIdhiKnBNcLuLLowUygguW4sUxbD+VRDovWHHNhlL4Svqcj+ywIECwcC0ofQAkOe4oFBcAXFFrV6V3UgAAP/7cMR7gI6FC1/nsGvB+aSrNMSPCAAAACh+NZyMh+4OMvxbieLOobGtP3q+cbgq0+jm4oFc/aijNyMkGkdgNjokoSXTQ5hQyfUbgoRR+Tp3iWggNLiOswIR29Sco88ct9tesg2pEnxe5uFkt0rIjthHI7d5ffJGfpThc2KGVrJKHCa4Mh0gwadW0Ox2ZoSKdWiFIgAQAAAYYh+qQy04eTISpHduURoTsCseKRCxwOaNwnB3iTifm6Xpf0imclarQ2DoNG8EwhEVgqiMCIQkoTNBBkEonHkC0Jrn4QYWJ1nj0dUbWnFWP1q1zMbapdrVZxU0cjdpCeN5nbFOAudL+0i28rLiM3xqRC9deil6Vf5KkQAAAACqQFnRAnqCJiqy4G8eStQLU9OvMh+TI9hdvWQsZbRmEgcUdZP/+3LElACQAPNXp7DUgfEl6rj0juC4ZUW9LDp0h8wMzLz4SBJfRFw/LqZGl9PZhl15roRZOEmRzzRiqcGgOhSG7TFjGAELhQhp+wZO8opy+7Wf24GvfjvoN+j1NaDpKN6//W/krZAABdHpTpuiQp4hyKKihY2M6WQ3k1ROKM4TDhIyM2uZ1PDFYXaMoxKgfKwxORaRDBIOhQUDJVEDRWOChN7MkK8zk1KZiogKKBMFJ+MIkWHqAsFBaK78t0i8H81vTiNZlGLJTvGfdfXMaGYnd/x37uRfFW83arGaiQAAAAC8JgjCkghYAksA1BQODEenTYS1r4kkIWLzMxtUrFcFyUZDq4PJAsKmDQDOOCQyLlAkCpKZGCY4cHk1Dg+vZ5BsG2LQSyiQEtVdwKBnEA6pOJxxDZkLBcafFf/7cMSoAI8Qz1ensHTJ25rq9PSO0Uk1gFwouoNGCTmqoD8Exh5BdIsR+tygKKJMlXsjtLwikYAcLEd50jhPsnhNEWtnicDOl3E00+hhw4LopmBzOCEc6qG0zzSm6XpLQh4UTPImEJg8MS0hkkKR0Ulcw9cTASAOqjSRJExf3ErpIpmVeRkSbBRmOTz1B2M5oqAWLFA4SYYQ4DaH89IgQXFwkLIBc3HI6rs00gAAAAFOryeKsnirMxGiek0Ql+fUU7FMysiRcyoJqtNypOEXRXjaQtGNsK0hPGEbgllldVShrGD8qB6fLMb+EcGMGHcHAJ2IBQGqS0sEKFgJhGHxSCLmYs2LSlDez/YymmTqRfRDVX58Kg5d6wWY7kR6RY6aLNNZQCiMioe5H7en/mQAS40Er5PinS6cC+P/+3LEwgGPxMVVpiR2gdOZKnz2GsjhwQ9MHYTgvoKnBCyD502kiySOjElIzEpLlvLTxZaBCW4hOPpvJoTBPoopYxFwkOdaciroWFLOf58cz0FjdWNPysc1jQy8uzLnn/9SNtnAuGnBMyre8AHTUOgHRUAAC6DiPU6U+1dRIOOCnAaJaRbhAAuoMUTel4QUIkl4pqyNe9RhhpYl4HnQLUuSeQVGlAo5CQmK3FoKltViaMi7CawAUYhAg4FamyWCOQUNLYoPGWr5qSQWFRqPLvbxSxPmRR6Nny3nOliflHGcEYni+kGEMY6kFXZ8IFeP9NDlc0Y8O9tcTsYSyIRwJGk86QER2vD08MQ9KCZdCZPGDaSKA/cu9pYXYj9bXIENI6y9o4NPcU1iT3vmnIuax/nDff/Po1CgAAry5P/7cMTbAJBZK1OnsHSBp6arKPSNskz4ribKE6ihPw63Iv44UDcDMAJFkHTodUNEPAdCCbH50wVBaJoHS6tfNnj1QwWUg7A4TlBdKa094m+FF4hwIGpCllgVzyXPfB/5xRSkgdVnKd35HakP2fGdZHTctg71l8rn8QHbWwgrOVyO/mQzDerZKjQAAAAAABM9eRVBLx50xGtp3TKVDI5x3aRYRjdHLxkQ6ICkXWpFfS83aaYkikisVazNFb3+T9SeYk01sVmnYc/Jc9RpTJTRfiQK8F7wNDliTLEd2zMe66+3khD800PDu2DqgnE4ycaSkIRSUHA9PH/+qo82UlLxSue6k1BNMJySA2DFwYqAV9OY/77LTLIEAYVNAFhCNInLT1ie1//TqiUwAAFMQUuSCKk8WxHHMlUNUCP/+3LE9oCYMSE8rD2cSeKlKjT2DXksr0uY1l5Dz6NBANsQpUAN8fr5lTLY1OBf09EiLl4uVhxNNYfvSCqBIKNrnq/4UYB7IujT5ZFm1GS1L5p+JJG8aNPztXsM7lPi8zk+CXkED1sET0MFJSmKR0VsV1RW0AAAAAAAxaiRbws7h9PRJNE5IRMZrqdLSwqNCY7zsMbSSXAh4rAk3DgLk4KW6KNCACLvjpapUKQ8nSpqyBSpAFFF5JeoRL6XWXiStXwEFL01GXJmq3rzi0qcR+4BXPEbbt4qh+C0xFAfjkpMk5mcmYvkJQ8iMCcoAYMmSIRjAhWOLCcvbB9hzl5wlNWXKkZEWxmWtW05TbXxJ39x2XvHRyW00uTSNKMgRMGBIWhO1Ob79lgRYIAADqIDuXBLHxMTdsW1CEIdN//7cMTrgJO8/0OMMNxBx54p9PMPSJvncnmFXE9XlS3LBZkqH6HIQDEbA4IiYCa0nICQqjodFNgc1g5FQQkAUCQmLa98f1jR6bIS9EkRHx+sVCJAldbn5ENjene5nEdndlq1o3zPg0oD1LDQBipA293w1Sn7+ffVFCAAAAABSVtlf9ozdYDWi1t9ljtfa+67lLHhhTB2QcovsmKmY2MWSDui4GRFpV5LDMhFQAwaq5ZEasz1kTzhxy4Cxm5BiMEkxEVDrB1M05ujIYeS/guZWrAcANMvuc8VPberlwLNKzChQ+hNlBWNo5hldcTiHsoGTQ+2LmWbNvWRm9R1/kZ4iIbpXRQevcLC5bMcs94buQowHACycWDk3cUcthq+hn0alIABVChRZlL/1mupeoeC31IpqtcN9iJO1kz/+3DE9YCWRSs/TDE8AdgbaXT2GmBVw3wSqeCJHIwAFhBizUymLcPdvHpLGcoz1WcxznUQ0uqcRosJPhOSZui9EEjrtWFmGADAOKiAEoEpOGEzCiE6OFlYtSeuZWWkNPUkLMuWsnMdVJRmsm9Cz/WW3gdAQoWNkQeFEyb2mCrLjRp5xG3zy6F3dn9CcZKSAAAAAKhDzrFtPUQ8bo8VIWwpTiLYWBDxYdQS4rlGoAmsQvhjG+aZbi2LSfTwiitTiUbmPT9acVW8W0PRqNNJDj+YqJPQKCHdI2SHFrdJo4t1uHm7mTkbRHjmE1tLGE45+945jkNBcLNRBtSL7BYLsuYn8iuUMaMvItk1SIggAAArQIuxbbDmXq5bPALE3fdOXuU6DQGDReah0uK0mbhx1iZqaLM0IkiMYsLI//tyxPMBlO0lP0wkfIJBG+h1h6V4cYNomiQTDAXtdxT1RK0uBMYtUG+LCik8hiKiJh+/Tqpgv2ZthPLNxPEFLQI0cLOgiuR3LHyHRqZSpF2fGOxeb0GmNmfjVvaDbLsYgoFAmpJoWBsbJ/1QEkb3JC+mawAAAAHafPSpezA32dVgimyt8Ax9SlaLmoJVeMmIgJ8onr5bopuD1pyjRzMMRRSURbUoDFOOFhLKWO/jzu4FgM3RKcFV6l6SxbllKZSsixWwLGLxW5RA78RVxXIaLAr+rBLnSD2hmUK8PniaIxZHAj1EsiOHR9apWIcb6srmK56s2iskmlQcMMD06RkGTRZc0OkzHaLid5Unv7hNA0PFEEU1m//+pyEB9FhFuVIrgkAZIoQyBzJcnDgRBFog3i5lyQCxBIkssGr/+3DE6YCPxM9Lp6R6EjKfqHWHmphgYgAYAKkoshwlqHFYctOIiFYWlixFzrTnIaHAoTEE72EMTGlWA1ql6n1ornaUwBoKs8prshUdjjW2vxJx2VCwuKLZDYbBKapQmioKhGkkTlRs0SLgtUA0cTkMKtoVp9WSx2a+42wr72KNioRp0u57lmRbyM3mpeAAABDdV3N0jroMbWAYkwVwmgQaoo5a5Iw3RvFRCzCLD+paIrx8DnMZh4AYZKtssQQeQSoNpDUsKehnFIq9+XTQ5AkJepnqLcRT7kac9G3rEk7Hjfj4q3eZ41py6rUplWwuQJHno4oSDvamqj5cTZhIQItdM5G2VaM0NRpbejEmmSCASaJXyPFgupDoklAAY0TNLsbxQqRVheo4fKrBVp9uMn2t1fTW0ZUZR6JY//tyxPYBlLEdOSww3EJkoCcg/CXxMw1YoYIRnKjAvJAanTLXNYoiam+nujSnk1h5Wfp0RBYZQBqa3kWoHBW2w34jcaeEpYFpmEo9jSPpwXx9JZsSLDXeGiGfGSar52VE58vIFTz3uZWKVmr3CvK5lx9/5vCt6rrEFv5ysLmoYblhUkrJiwp1f0JgAAAAA9rkcf1w2qtFRXjUCs5eahgwuYw9ibRy5rAoKZkiBQJ/odHxELJXKVpMvWyw+CkV45Sx9wXheVqDQ1tNSQ+WO/rI36clp7cnWm2ZPyweKVH8m4Dzk9HGzQ+V5wnp7aaIlHGBK3kCOAhW5uRzFnICtUJhoHHRnY6QFE1DuNCZo4EBWpw6kqBJ5hix9n/6pCCwAo+DnR5GTAMuwXReB4OBlKcdCLXZ8EmVxciXiHv/+3DE6QGRmOk6zCTcQk+e5yT8MXhIDMAJBCRXgYgkBvH4iQkSbP5rRDsizeUBJA1IhDAQsQAnJDUUSFzWh3GgTk0yMVgOaijLAkw4ISBwkELHF0xKDRuI95AjgwymZj1p0Xh/iYpqrE9gwwyTGFbzbPQfW0v//s338y2mzAAAAAAAAKhwOo4svV7xnLNXFmlfOU3V4KJXMYZ4ny6yUaGyUTysLTlKEgh0SIa2+4qCuZfo0MGCv42JrrcXYgN22VqaP+qbrhNKUMb567iwEABEpLB+yPTTA/qEIygOZbIKNpVHZrPMTkjUyqMgklYW5cN2TqaJBkSBdoKkoiAzBwZNmW29oox6lf/sT8db78BkQECbNJ9O5j5f5CWFAsGa40lJBiy6HLuLwL6sgFgqDpVg7Cg4rIoqmSud//tyxOqBkijxOywkfEIaHGd09JtAEaPNwDjg5KHjdH/TyWO1pPt41B1g18K1LOCEpsJeQ6gqzpcMfTghxbCbqhWWZ1HALGhR6wsUmRK2ISomIhguqfgyOTDkZyMOP2RRIjxYvWvd24YygNSaWDTwVSQTtvZwoVlB3/1/99UQkEAAAAABXD4wrxOUqOiESyIWFTm2h5hkrVkQTVCUPHahKDXBLiwASAzBfIeW4hafJMQolTSfjSbRPnbc2lsEqYROB3vjnXzBQ2eMUl0fqmahCHf10ioIE8Jlm2+rMQSxRlIiMT6NKdqVGfNKoNDE3iVrg0HyqrPCT3kLLx6adjS52uYIe2XLkADc5pj7Ok/40duJerKCyAbtkCH9LFkfGTpsFt4oiqEFeZYoLUkqdAAcYkNRhrQs8QpLuCP/+3DE8QGSINE7rLDaQkycppWHp0IILRLtgYECs/VtRPUBVhSBR1WSlLARENtFTpfsyHsdZmnasqEwDKWCcnUfsJJJWOVSiZF5DOjj4g+YvjJEojFTRYmLkNNvgjRIzjMW2TBZ3SI4QZzyqOtYxSgFmElB9Cxq3BST+r/t/9v//7f3KkAAABKpXhehmDKWpOrBCCNbLD25IAA5JeFnyqSYKlykAKscM2ES2ZxIYA3ojQgmUBFQslcQAnJkpYvuz+Dy8qtLd0UG9SVf+NoC4mXaWsm85TkNZH49LYabE/J0yK9RoYzh8miCbhIbOSWFh8F2GkZUdnJsggwaMG2LaO2Q4n9WaxvNUVEANPSEhceWFgGhOw+Jm1sjqiv/6zQAbJmTjltgmlfqLttKWfQTCV2OS5sCxJeKkhER//tyxPCBkQTRPaew2gKIH6Yhh6dIY1K5S7SqUukVADwG+Xu+kSUWLgLAQe9q52LSSMrSd8cO2EjRBQ5keryxH91WoTqGbBjuG9HehKtdTHTCRQZZ+qLjqFZLGKnNks0uzqjS7WeeTZNgNITOBoERhguJU3JexPGOddv/7GuotdqqUAAAEhLEDUau3fYQn08Mbchqq+S8S+EIhge6W3En3jcyWoYoIkqDTMOIs010266Y40CtFpiuwcKnbG0rERErXdWIqZA9MmMAY4voxhpS5FZpx3wvGknKvH0Yb9hIeeaPP5WtdKIRlkxbYVJC6/BYyTMaPywtqzA7e+hSSLTNdvLTr3fDiA2DYIsSVQRsc4X/+P6P/X/WsRgHxZruqdOvUYEsUoUoK4a/2Rs4gRZEdXOwtIdK1FFWRDH/+3DE7YGTIOEyzD06AiEZpuWHpwhdqgzWl3kzyyzus2dBLxQNdqLLJCMpWGcpAjJVyoPcyjNJoGpUUROF+uXaMhaOSCLVKqXVS2srIUVBpVFIss1YhgjcdzCHK5RpySUzstgqEjAdCoItm3xMOPzpd1qd5IYY9PPf1/soGQDEC4kylI5g6DZfxYVVVDkj+v5C0HlYiy5JFSwdMkkAYmYKZCnzKwwyNC2XELV0taIQEQyA6cLXHeSQ9j4FjFsEfKI7QDQD4AigwkykBjj4F6+BZmiYxuPzyRKbLcTW7grPtrJgxrUJXPaUb3wRIkDAgtJj0IWRor3JwdPWMgpZIMiEDjSp4WFL63u9fqkGrr/k//Qj//v9SAGpJpXrqiVhWQvU/Tfu4z5fqsaGy/W5oc5YpUGURHQhU0CD//tyxO6BktDXMMy9mgIpmSalh6bQvck8YjGgARpNFqrBUf0aUbFWJRo8QFGFMG0U4YkFwoKUCDDJ2ns1WDbeGcgtQigVR/HsvjmtTJlNrkyREtOEWC5KdPGosNGw+dcussRqIlV1E5p3PGrc8oBkEUiJfsVuqKrFnYwvrk/p39JhAAAAAA5B8WnIp26jeIbL8X4tp52FQwyhRB62oLbLVLQIg7CJlHNL8u+yYvarenbElE3rV6rEvG3RNe677sLBrmiLymQAo9gbAicHRIAOOheGJOPicTyWjLY9GkViSzHEuaedhjxpv2tZqqUL2/ZYYb3mi4aYgzI3OufM0CooKKeZaQW8VIBI3UbUH86VqVGrIRYeoRp36Ekwi4mgYH0nPagyVVJB2GyQUz4OBMVVXcIFDnLZ48Kkm6j/+3DE8IGTDNcuLD02wjoa5hmGJ0B3k/0HJgBJAgg6raSdYNGt11ir2FZE1wCFcz/L3c1aLXkz0ci6aTLsJdLnUtlSwy+C5yPD6P9SPa+jIIgy+VwLDUoqah8ElmWhmBY2e0q9QXiRFGg2SagQnFmUfNEtIWyIZKi7gVOiOSSWUwshCzAwpdu1dL////6P/7scmh1WyAAAADL8UKg50wyM40JkTtqdv4ziUurAt+K0kchpkjvSmNwC66mrxJD5MzYRSAP6u1zk+8yjTlUKVglFl8xUM3LoRAtczJgaLNxea9/LBTH7ur7F9MSHDiQFIhFBG4mRCJQMDkq0KXZHNnn+Wq/s1+1qTYbcAAABRC5aPTDUELUZO0MkHQnNvJmQICRAhzkGZEvcQEEZnEQygAICMIU6S9LyN5Qt//tyxO8Bk4ULM00weMJpmiWVrCW4TTBU6CGpwt0pH0pmkvm+SgDuNKL/obtOVjRPXXTUbZFonwJl8nHpUWloukCivj4yYHtih1diJmOB2+uswmEMV1HH2S8lvvRy8OCxcIg2AX1pHjw4k0SeQz6Fippw/Dn3KnC67Tdm4hIf/9f/VQ6AAAAAAfSxZMHvTFFVkeEP0QVpwIwOCKJc0Qc0lA+pdhAIpiutIQmSSALdpUQh/VTJeSNO9H6BnzcxlSYFOofGA4SBJgK03GRAZ811W5f060sAMkA6dA3sJ5d5ecDofrV50vQzhdBnoTBldZW8EDauI6e9j+vjdKJfp1EI6Vyss1/Lwbjx9+fCb0GnPqOZjxUp3d+LtEyASiWUJj6r2cBfM6MJEYJMvRZSkS/S0YFa0XCYcCAhzmb/+3DE5gCOyM8/rDBywnWaJemcMXhqqOi0YskoEnetpli73RWNCGXqFMCXRhnOZhvGgOAcJMksXEN0B6DUHCXAuC2HRG0F0JCHgbITw8NojpgLCkmxgswuSPHeHJa5CuuUtaRZpeospZ2nuEwcLAlGnw44esUGSNHubs+z1+/V5r/p//boIAAAMgviR7GmPsCgVuF13WGs6fuhVpQXYPDDQHnGRQCj+0xORhoQJFRFBHddilLDxIwkdFxczQoEWHWqjcmqztlTV0VhkLupiIXsVdenjrrCWOFhJNDQrDqqPl5AdZEM9Pw9SRuPahlWEkmeTIkNCDpdkqud+lgAVmDilrzhwXsXbqSKquszs5b/t/Q7/+zoRoD0r0FhTqqq6BwLZWRR9pUGl+lqoDF5v5F1Gk/V1OUtJije//tyxO4Bkt0JL4wweoJEmeWZh6bIiIrRy4IcUtQxKMQ8lZBBZsofF36fhMRWJqMNILtzABHdbit9VzlNLljmPCSCy6OR4OBSD0+PlhiYSElWfhvZlzmlK6HpjSV3ml+WejrjEeRmf9S/OFdFgkOCdwGAjgIlJJhVtKg/eaiv/76vQ3/3chpVNbCIAAAALtguFlbgNzXI01jFmIMMYvHoW2zWIjmSg/AhBLCnu5BHCajKP5Frl6zlqc5vJyAqkSkDvZVYedRwsx2pIgTi9RB+UsRAgMyyJE9LbuxBQpY50+RyXbvdU9lrXK0yjzQUC4fCBGViANgiNAjiMQrp2BqKqDLXHzoEcxi20rndK6V6DCCQQAX5TVhgoBjFRUjRKV5LLq9gV1HXep+4eTHaSDDtgd9eK7EglMxpSXT/+3DE7IGSMMsszDDaQk8fJYmGD1DAtLgdKMElJwYbGUSrXJmK4hQvhlDZJKeaQUKWWXZfIay8dIlKRnHLxxsucHLBgwEZI4tozrslqIT/RSAOLDjC3IK45Qxh28m97U2C6HJC7ulLtFei3P21////WjMAAAM8GWeIgIjJ/o8ww4heVPtlrrP2zGWpf0DQ0dDUoaFAzzIoPyC2AyRHQKjL8WYFwoFV2LHpQq+gKSsibu6LuoOKcIijorK0WYZSIXOqWGC/sAM/fB/qTF1Ij2MUl80wGEMgpouUJIGlhWgWRJLyaPLIm4szrb867RoLhxihG46WRz3yNLp29CH0SqLz/+9yq9u293uXu3rtmKiRUABcQQUHKEOOEV8jjfHadBJGMOAo0+aCNhCZitAPmcxlKcarJOJMLARZ//tyxOuAkOjLNaw9DYIdmSYxh46Yc21SoeCAIYklQah9MyhSzBOzE90LOyj2JChS8O4tALVBCKk5LklZKNhFMXZWsfPGNt3LWxPN1JlOBnHSCQmfXTeB5VqQQAyNMKFwy+ksUE4hQvr18Jtt8w3/7fXVIAAAABZOQ0NmHJ+KJpqYl+mNsTYi1hzX1LJQCvEvgpEkGw5i7JRAYQ1Bigqk4D2RQjxAhdA5ghw/R4rAjCoV5LxSk6MwAiFUPSApl1iIyVPIsZJ2oNUPHJZlX1A+eSmHorDwrR9ddUgaYmiKIdXm5NmvjXi0BC44q8RFjp6lq0mktSNJtkriaBGQPAY8UmhK3yqmd02iRT9HJfFOYUnSolEqULEjXFV+yxsUrW1J0o2XO0w9VRwV/NhbZYBgEJZ204QmMghsJC3/+3DE9oCTmM8pDGUxQh2YZej0m0AWSYtqIXIMEbwQQKyrQDgisCwiSZMJsgnGklI9RBg0VY6HpNLLhdc+oBCYoNqZ8TMtdDFW2ool8jlsq0TYEgKAlh0eGggGQkFmDBcXWeU9DFXzGbU5RDprRqVdEtXli36r/YxaYy93iqoQADgxgjEkHRs9Vy3Bhyr2MKsd9+xCBgShTSnMgN1ZtxnwVuaCDrpnCyRojltBQRIloJUxE9Fyv67SGDc20TL6oUu9bCNbGYU1uHXhayylwDge0E6wxIjRHQTNfXiu/Gs+BxPkOjlUIw+CDbIjCrGgLB6FuUpzi1owfYuOvap6dYoWU//wuq9ISTrY1hbOMb9CqiSJaOekSAv0FCq2tASJUUSvYjEWAsTgGHlDlNLaw8pXiuAv8qVhqbzE//twxPYBk/DHKSw9MwJClmVlh6ZYQFcI8VTp/OpG1uLeVJF005k4j+VxVgvjhZiVsAKISYJAWQ7nzCaiFHupWZUsiHMy0qXiq4PiCFJkEjt3kIIJJvZawmFYjaoJNcTcepl30Idub0bUX/av7b3tvZq9vRjFvSmsWZqOtdKVFwAAAC+GBswXS0xoMKXZH1YoHdyGEefpCcNpK0AKeH2eaXQouopYEcXE0WKQNUbgx3NLFxQ5uOY51WRbYqjmV7IUBC1UolpQvBgWBA4QWYAEUBZ7zDKe9l2kjLU3YqelcuFZ8GySIiBM8KHwoeetrM4O0GDu57w3W1xKmvXx2VAetH/0f6DNASrU6VVTgZejyquXngJXzFCy6IZatH5vaEZIkiAlLQUod0BpJgCEIRBG1w1M1kFkkjjSmP/7csTvgdLY0SisMHpCMpYlIYea0Iv/DyhyewcCIDJRGSrHDUlcBsIA7H0WY8DvBwjhpxTHElkQsjYmg3eJyCvZVQSzZGfmRiZNS3p7jjwNCFAJHw2VKNUH3KFNLhixZjYCUmLlLIIxiVAd+95S3rAtirHsrJm4fmWaxVR1g8XsDzSQ0IAFygYSQQAAAC3GPZkNUfZCVolR2i5OnInLK1nQqFcdaGiUfiwMzC1ikFUayaXCi2RHdHZ0fTo9HAvIsQ6lcnBIWjlgxULgfFRBWMklCYp7MpW/RIs9UbLW82RyAKVCAc8qJcdFMnCmenQ+Paw6o62V6vo0LYxe3///97HD3lDFINv4KWERLmpgCpGGO0iHE5e4CqsAho0OoBcpTdhkAGBogAsMK8Q0hOtBR+mXlvRCJnN+Pt+y//twxPABkLi3LSw8y8KalqRFh7MABs6gDTCgCLTH1XSSFQG+UbnIKWCbtH34h1xo2+tyTROfAofFJ8+qbPQfE43stpuU+RpIH5P6omrxjurqrO6B72a879aHOtpX3ujZWGv3oy07tW/6rt70M/1vob9bpkZJ2ZtnMHV0RVRjoQzXtrV2EZY1ZAAAf8kG5C97ENLFZrGWmSl8I2zkvT7o6zmHpKVpThTNaFi6BykGOR3HbD9JUaKoQijjRgypHA6DzfN8rMpVI/ZWwDBAkCT8Fqob/OUlo0WAwmExskIzyDIxRMY1pBV4u/cozdZKSHL3mX81fvMaK+UzdX9P/p/WQByJhFtvXJnlLgYBJ5X66YYW2zhA4vBKZWgOLcK2sObRoRQZMVKMgaX6rv87adihSl7cWgNq/LclrP/7csTrgI8YtS+nsRSCrT+kBYSLiOkypZcCpGIBkZhoCpVO3/e9ypTKhQsL4+BMOJRPiwSVhaOy6eQ4rcbh+fczSI17PhrPdG7uLPD9aFtOisIm1YhUsHwihgVEAVMmyd7jpJGxdt69uwufyFg9Ghc64KZpyXB4wbAofNBUIJErKghAAAB+RsGKW8oRlBjFyLqWA8CbJdfD/WC5oBpJCSk1zqO00CUGIEfHAfBrKNQExYx6kKL8ZkmpWPLFYXiSTQZiKVIjMQzAMRGKCvIBuAOimCozhGzNrHHBuYOlh4hUTCpONOhmbYbLPuaPFnAqObVsba56EUdybdP7TOP1Z7R2oZFJ1RClxcSeyPyxnCZgnPDqAprQcJCUnU3Fy5SnQteIBgkjC6bUHxEhoTBEImM6CXbIpOpNMFBc//twxOwAjxyTLSw8y8KVmOQVhhtIsyXUkZKDzJKmFGKeCMgORdUwhoXhPhin9NCOs6mhwjL7NBUqjpNICktCR9qVBeI45VNy0kkQpeKlAwpohqVGRj2qfKvZVYGuVoPGgjx1bO+8ipF+00TFAC4TkhUKLeWvJJWB0ng2WEBYQB9tXAADSWDpPMspz1J6eqEJZD181SsBXm8XMt4S0XAPKAPIGcLGHGUQOVyHmaVS4nsuHi0ybUB54XBLTBLGpksSY5EeuaNx9FSFQe1ZJrafaNq6FDJBWWgCLiwGILpItQVVLjoJLwwIkjg/dNiul17XKy96/8tb0+0lvYNUXqCkgcRVHwuNuTNELgKtZF5gqVTdoLvN2WFWHTKcNl87BYypIVTBa8GM7RSFgA7SZUMVYIiaCKzGkkWgtf/7csTugZDoqycnsHZCdZXjxYea0KiK8F5N1WyrYxqVImP45TuytvpC8bYygueJAGORAjT5xhpRVsyQs42pbK58hNBs7Iqo5Wo96/2Lm3t823svuiq2339tPv7Itz9mty3+yr+y6LRybMhWySIDIDRR6hDCjNVZzmKqgKIUY4txRQIQAABmGGhQa7o3OLPbE1t34syZ62IM8THYZ2eeRgLEVfBUj7EARIHItiKRqEyp0xjDEwQ04mV0bxpMrkPlXlzQbSfaEM8y0hCvNHx2Cqgg0njVYE5RimKWio5SPDu7syK9tkSh95b8H9a0Rpa/svfP1odtszIm5mr9v/3+/e/1177EZUUkyFuTUhfS91KxJGQjkPHcQqhMLoYBgbF1VQmot5QQTgS7OZxY3hxHM9MYJo6pW8sSuLcQ//twxO6BkJipIsekegJ9QaNBhItIM6I7sw2E+B6z2iv1cuHSF7e2OguC09IMrlSzOLuR9L4z9q8PPrsSYTp3STB0WCrg+koYEx4Fg7Bxax7GLvexDh6+w1nuZ4s3/pdursotvHkxIoOpey8WELTWF1DwSQCkAAB2WoIuve9bdmRNuwqeWIxmGWDWp5sTb0K0ZQsLAMuhxkwc5kbkw/g9dmbYG9V+ddikaQ89iNNrFlmMQWHjrTpZRzEszuz1adt1Ll+Ynq3SEoT5lxs6UNDLDWWzqE8WymDEk5SAuuMZ3Si9uttab/9moiVevJS7+tudX70bcitalZHsy67qV5yPussiC70VWTRzUd1M62cEwKBUtblBrNWgP+1tQl4narNNVyvN1JM4KtSYivVLZG7SgIwJmy9FrU1LF//7csTugZLaCx8sPFFCABUkJPCPgIfaRLNS7bkSqLO0+Sm79Oa4y468Rgq3KYdfyhm7NemsS6Qclli6Ugo4kzkOHEqLJIjmuqsrKt2L2Stey/+pG7/s6IY3ZOm/TT99/29ao6K19DWUZLsc99W7677UI+dZsPbaskn29eWslcWmMJ1STmmSJ0+0JBQBwB3CHkuLkYgfxxjcliqBkTxxp0g2HNUGc0jyP5JCzIhFGOZLcpELlUrUizlq8W4D9FK05SiJ7EXcRjrZunzeDFhXbWa8sTVcS7vb2xXOtdjiNOCKX/zMn7aVHL/19cv6+//X/+XX6LI2IVjkbPidcstTLfBE8JtYiGx1hZoQICJyEbBDAExQNABVQfiPHQr3BdjFUyyPS2l+fGlHGKu08YB1IUecx0ql+qFtNJaF//twxPWAk3YHHSwMXIp9wSLBgRupz2LkWFpxMxTajVPlQNCEl9WGBXQWHN4keNmWka9N4pm0B7rd/XeM42bKsyEJ5Wj2Qv8lij8R8aczFLIZ9WFbzS8uFo//RYq+d5Kcpl/1Tm9O+hEthuQ0mwzMBDgi0yMaBhaIY6BGECAAM1AD0axcbKMx0y2rqj06TkI2eJ1KI51stxOT6Sb8cYt7YdKNRjgezqEpXzlHmhRoz9V6jxe4s81I6hdqSytcYVXKsDGuFSOYM6tsHL2ZFbbRdva57tVrUZ69bsjMZnfZ2borP9NNbc23b//66PYspVqWoCetmD97O2e4lnoih0WOTlvyWHR9HZzJWrbAZxZIkEokIABkBnEGUjMql+KczfNQ/lajC+mil2JZRqzOonJOn8yOSkXMW+lc2P/7csTqABEaAxinhH8KOMEjGPCP4Y6LXUkeeR+3xFE5xlqFAravpamcQa43q2fnMusZrrOs6yTTmVcfOf6nJfCRSs5VCgy/6bYnRCej+W//mL8Sy+VG8jKUGN8mzXrbq5VM2ukNPKd5kDppMw82z9TyYMCUi5pc0xGHKW5wjR11eGpY6tcWa0CV7NKhs7hBRKNiqtmVVmp+yKp3veu+pbCGtEzdXLx7FpPVgk4eUpxWqlmNZW+h+b06a6J61Wrb6tM07KRN+itqltdNfr+9nka6zGqqIxequWhh0wuVzzWj3GJpwgnUUnqjKNlAcP5aJcsyyKRQqsREy4ofIU6uaIzRUNKxgTmDY+ICBQKEmAELDTZX1WGYk2vJFnBSHuqkhycqwzWtTUfMCwsKm+utfk7/8J/538PPIQsw//twxPEAkroNFMeI3UIowWKk8Jvh4SvCGEn0WisTCEJh/PDFMJC89a/huGxz+W7GHr1NDcSFyzV+KuNXFYVIiIlgiFSMMwKqQOjoJPIhsDKAKoDQpgVJVRSdHQDIyh9g0KYgMIwZJlYkpECwrAlEIQRBE8iZlUxBTUUzLjk5LjNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUECAAACodnazoqLWqX+iqnqi/1RF+5Sy/LLSMjVlBAnQ/n//2Wkf/ZKR+Utl/VgoOOllIzWXsshl/y2X4stIyNWChgQdHlQyrauK2gtzXDef/7csTzAxK+DwwnlTuCM8GghICnaTzRor5hXS6b3kel6brXGab1bP+f7zMxym8dyTTivZGdwVSdUq8xxMvlKulOzuDkyqI0SfFCVBgHWmlUrW6G6ZmJhXTe8fuDNBSqTEFNRTMuOTkuM6qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//twxLqD0y4KxQEN+0gAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqg==",soundByteArray$f=base64SoundToByteArray(phetAudioContext$1,soundURI$f),unlock$f=asyncLoader.createLock(soundURI$f),wrappedAudioBuffer$f=new WrappedAudioBuffer;let unlocked$f=!1;const safeUnlock$f=()=>{unlocked$f||(unlock$f(),unlocked$f=!0)},onDecodeSuccess$f=a=>{wrappedAudioBuffer$f.audioBufferProperty.value===null&&(wrappedAudioBuffer$f.audioBufferProperty.set(a),safeUnlock$f())},onDecodeError$f=a=>{console.warn("decode of audio data failed, using stubbed sound, error: "+a),wrappedAudioBuffer$f.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$f()},decodePromise$f=phetAudioContext$1.decodeAudioData(soundByteArray$f.buffer,onDecodeSuccess$f,onDecodeError$f);decodePromise$f&&decodePromise$f.then(a=>{wrappedAudioBuffer$f.audioBufferProperty.value===null&&(wrappedAudioBuffer$f.audioBufferProperty.set(a),safeUnlock$f())}).catch(a=>{console.warn("promise rejection caught for audio decode, error = "+a),safeUnlock$f()});const monitoredAudioContexts=[],stateChangeListenerArrays=[],audioContextStateChangeMonitor={addStateChangeListener(a,t){let s=monitoredAudioContexts.indexOf(a),r;s===-1?(monitoredAudioContexts.push(a),s=monitoredAudioContexts.length-1,r=[],stateChangeListenerArrays.push(r),assert&&assert(!a.onstatechange,"a listener function is already registered for this context"),a.onstatechange=()=>{_.clone(r).forEach(o=>{o(a.state)})}):r=stateChangeListenerArrays[s],r.push(t)},removeStateChangeListener(a,t){const s=monitoredAudioContexts.indexOf(a);assert&&assert(s>=0,"audio context not found");const r=stateChangeListenerArrays[s],o=r.indexOf(t);assert&&assert(o>=0,"listener not found for specified audio context"),r.splice(o,1)},hasListener(a,t){let s=!1;const r=monitoredAudioContexts.indexOf(a);if(r>=0){const o=stateChangeListenerArrays[r];o&&(s=o.includes(t))}return s}};tambo.register("audioContextStateChangeMonitor",audioContextStateChangeMonitor);const soundConstants={DEFAULT_PARAM_CHANGE_TIME_CONSTANT:.015,DEFAULT_LINEAR_GAIN_CHANGE_TIME:.1,TWELFTH_ROOT_OF_TWO:Math.pow(2,1/12)};tambo.register("soundConstants",soundConstants);const ta=class ta extends EnumerationValue{};ta.BASIC=new ta,ta.EXTRA=new ta,ta.enumeration=new Enumeration(ta,{phetioDocumentation:"describes whether a sound is considered part of the basic or the extra sounds for the sim"});let SoundScope=ta;tambo.register("SoundScope",SoundScope);const AUDIO_DUCKING_LEVEL=.15,DEFAULT_REVERB_LEVEL=.02,LINEAR_GAIN_CHANGE_TIME=soundConstants.DEFAULT_LINEAR_GAIN_CHANGE_TIME;class SoundManager extends PhetioObject{constructor(t){var s,r,o,n;super({tandem:t,phetioState:!1,phetioDocumentation:"Controls the simulation's sound. For sims that do not support sound, this element and its children can be ignored."}),this.viewNodeDisplayedPropertyMap=new Map,this.enabledProperty=new BooleanProperty(((r=(s=phet==null?void 0:phet.chipper)==null?void 0:s.queryParameters)==null?void 0:r.supportsSound)||!1,{tandem:t==null?void 0:t.createTandem("enabledProperty"),phetioState:!1,phetioDocumentation:"Determines whether sound is enabled. Supported only if this sim supportsSound=true."}),this.extraSoundEnabledProperty=new BooleanProperty(((n=(o=phet==null?void 0:phet.chipper)==null?void 0:o.queryParameters)==null?void 0:n.extraSoundInitiallyEnabled)||!1,{tandem:t==null?void 0:t.createTandem("extraSoundEnabledProperty"),phetioState:!1,phetioDocumentation:"Determines whether extra sound is enabled. Extra sound is additional sounds that can serve to improve the learning experience for individuals with visual disabilities. Note that not all simulations that support sound also support extra sound. Also note that the value is irrelevant when enabledProperty is false."}),this.soundGeneratorInfoArray=[],this._mainOutputLevel=1,this._reverbLevel=DEFAULT_REVERB_LEVEL,this.gainNodesForCategories=new Map,this.duckingProperties=createObservableArray(),this.initialized=!1,this.soundGeneratorsAwaitingAdd=[],this.mainGainNode=null,this.duckingGainNode=null,this.convolver=null,this.reverbGainNode=null,this.dryGainNode=null}initialize(t,s,r,o,n,l){assert&&assert(!this.initialized,"can't initialize the sound manager more than once");const h=optionize()({categories:["sim-specific","user-interface"]},l);assert&&assert(h.categories.length===_.uniq(h.categories).length,"categories must be unique");const g=phetAudioContext$1.currentTime,d=phetAudioContext$1.createDynamicsCompressor();d.threshold.setValueAtTime(-6,g),d.knee.setValueAtTime(5,g),d.ratio.setValueAtTime(12,g),d.attack.setValueAtTime(0,g),d.release.setValueAtTime(.25,g),d.connect(phetAudioContext$1.destination),this.duckingGainNode=phetAudioContext$1.createGain(),this.duckingGainNode.connect(d),this.mainGainNode=phetAudioContext$1.createGain(),this.mainGainNode.connect(this.duckingGainNode),this.convolver=phetAudioContext$1.createConvolver();const A=H=>{H&&(this.convolver.buffer=H,wrappedAudioBuffer$f.audioBufferProperty.unlink(A))};wrappedAudioBuffer$f.audioBufferProperty.link(A),this.reverbGainNode=phetAudioContext$1.createGain(),this.reverbGainNode.connect(this.mainGainNode),this.reverbGainNode.gain.setValueAtTime(this._reverbLevel,phetAudioContext$1.currentTime),this.convolver.connect(this.reverbGainNode),this.dryGainNode=phetAudioContext$1.createGain(),this.dryGainNode.gain.setValueAtTime(1-this._reverbLevel,phetAudioContext$1.currentTime),this.dryGainNode.gain.linearRampToValueAtTime(1-this._reverbLevel,phetAudioContext$1.currentTime+LINEAR_GAIN_CHANGE_TIME),this.dryGainNode.connect(this.mainGainNode),assert&&assert(this.convolver!==null&&this.dryGainNode!==null,"some audio nodes have not been initialized"),h.categories.forEach(H=>{const Y=phetAudioContext$1.createGain();Y.connect(this.convolver),Y.connect(this.dryGainNode),this.gainNodesForCategories.set(H,Y)}),Multilink.multilink([this.enabledProperty,s,t,r,o,n],(H,Y,Q,pe,de,fe)=>{const Ee=H&&Y&&Q&&pe&&de&&!fe?this._mainOutputLevel:0;this.mainGainNode.gain.linearRampToValueAtTime(Ee,phetAudioContext$1.currentTime+LINEAR_GAIN_CHANGE_TIME)});const S=new BooleanProperty(!1),O=()=>{S.value=this.duckingProperties.reduce((H,Y)=>H||Y.value,!1)};S.lazyLink(H=>{var pe,de;assert&&assert(this.duckingGainNode,"ducking listener fired, but no ducking gain node exists");const Y=H?.05:.5,Q=phetAudioContext$1.currentTime;(pe=this.duckingGainNode)==null||pe.gain.cancelScheduledValues(Q),(de=this.duckingGainNode)==null||de.gain.setTargetAtTime(H?AUDIO_DUCKING_LEVEL:1,Q,Y)}),this.duckingProperties.addItemAddedListener(H=>{H.link(O);const Y=Q=>{Q===H&&(Q.unlink(O),this.duckingProperties.removeItemRemovedListener(Y))};this.duckingProperties.addItemRemovedListener(Y)});const I=()=>{window.removeEventListener("touchstart",W,!1),Display.userGestureEmitter.hasListener(W)&&Display.userGestureEmitter.removeListener(W)},W=()=>{phetAudioContext$1.state!=="running"?(phet.log&&phet.log(`audio context not running, attempting to resume, state = ${phetAudioContext$1.state}`),phetAudioContext$1.resume().then(()=>{phet.log&&phet.log(`resume appears to have succeeded, phetAudioContext.state = ${phetAudioContext$1.state}`),I()}).catch(H=>{const Y=`error when trying to resume audio context, err = ${H}`;console.error(Y),assert&&alert(Y)})):I()};window.addEventListener("touchstart",W,!1),Display.userGestureEmitter.addListener(W);let L=phetAudioContext$1.state;audioContextStateChangeMonitor.addStateChangeListener(phetAudioContext$1,H=>{phet.log&&phet.log(`audio context state changed, old state = ${L}, new state = ${H}, audio context time = ${phetAudioContext$1.currentTime}`),H!=="running"?(window.addEventListener("touchstart",W,!1),Display.userGestureEmitter.hasListener(W)||Display.userGestureEmitter.addListener(W)):console.log("AudioContext is now running."),L=H}),this.initialized=!0,this.soundGeneratorsAwaitingAdd.forEach(H=>{this.addSoundGenerator(H.soundGenerator,H.soundGeneratorAddOptions)}),this.soundGeneratorsAwaitingAdd.length=0}hasSoundGenerator(t){return _.some(this.soundGeneratorInfoArray,s=>s.soundGenerator===t)}addSoundGenerator(t,s){if(s===void 0&&(s={}),!this.initialized){this.soundGeneratorsAwaitingAdd.push({soundGenerator:t,soundGeneratorAddOptions:s});return}assert&&assert(this.convolver!==null&&this.dryGainNode!==null,"some audio nodes have not been initialized");const r=this.hasSoundGenerator(t);assert&&assert(!r,"can't add the same sound generator twice");const o=optionize()({sonificationLevel:SoundScope.BASIC,associatedViewNode:null,categoryName:null},s);assert&&assert(_.includes(_.values(SoundScope),o.sonificationLevel),`invalid value for sonification level: ${o.sonificationLevel}`),o.categoryName===null?(t.connect(this.convolver),t.connect(this.dryGainNode)):(assert&&assert(this.gainNodesForCategories.has(o.categoryName),`category does not exist : ${o.categoryName}`),t.connect(this.gainNodesForCategories.get(o.categoryName)));const n={soundGenerator:t,sonificationLevel:o.sonificationLevel};if(this.soundGeneratorInfoArray.push(n),t.addEnableControlProperty(this.enabledProperty),o.sonificationLevel===SoundScope.EXTRA&&t.addEnableControlProperty(this.extraSoundEnabledProperty),o.associatedViewNode){const l=new DisplayedProperty(o.associatedViewNode);t.addEnableControlProperty(l),this.viewNodeDisplayedPropertyMap.set(t,l)}}removeSoundGenerator(t){if(!this.initialized){const r=this.soundGeneratorsAwaitingAdd.filter(o=>o.soundGenerator===t);for(assert&&assert(r.length>0,"unable to remove sound generator - not found");r.length>0;)arrayRemove(this.soundGeneratorsAwaitingAdd,r[0]),r.shift();return}let s=null;for(let r=0;r<this.soundGeneratorInfoArray.length;r++)if(this.soundGeneratorInfoArray[r].soundGenerator===t){s=this.soundGeneratorInfoArray[r];break}assert&&assert(s,"unable to remove sound generator - not found"),t.isConnectedTo(this.convolver)&&t.disconnect(this.convolver),t.isConnectedTo(this.dryGainNode)&&t.disconnect(this.dryGainNode),this.gainNodesForCategories.forEach(r=>{t.isConnectedTo(r)&&t.disconnect(r)}),s&&this.soundGeneratorInfoArray.splice(this.soundGeneratorInfoArray.indexOf(s),1),this.viewNodeDisplayedPropertyMap.has(t)&&(this.viewNodeDisplayedPropertyMap.get(t).dispose(),this.viewNodeDisplayedPropertyMap.delete(t))}setMainOutputLevel(t){if(!this.initialized){console.warn("an attempt was made to set the main output level on an uninitialized sound manager, ignoring");return}assert&&assert(t>=0&&t<=1,`output level value out of range: ${t}`),this._mainOutputLevel=t,this.enabledProperty.value&&this.mainGainNode.gain.linearRampToValueAtTime(t,phetAudioContext$1.currentTime+LINEAR_GAIN_CHANGE_TIME)}set mainOutputLevel(t){this.setMainOutputLevel(t)}get mainOutputLevel(){return this.getMainOutputLevel()}getMainOutputLevel(){return this._mainOutputLevel}setOutputLevelForCategory(t,s){if(!this.initialized){console.warn("an attempt was made to set the output level for a sound category on an uninitialized sound manager, ignoring");return}assert&&assert(this.initialized,"output levels for categories cannot be added until initialization has been done"),assert&&assert(s>=0&&s<=1,`output level value out of range: ${s}`),assert&&assert(this.gainNodesForCategories.get(t),`no category with name = ${t}`);const r=this.gainNodesForCategories.get(t);r&&r.gain.setValueAtTime(s,phetAudioContext$1.currentTime)}addDuckingProperty(t){this.duckingProperties.add(t)}removeDuckingProperty(t){assert&&assert(this.duckingProperties.includes(t),"ducking Property not present"),this.duckingProperties.remove(t)}getOutputLevelForCategory(t){if(!this.initialized)return console.warn("an attempt was made to get the output level for a sound category on an uninitialized sound manager, returning 0"),0;const s=this.gainNodesForCategories.get(t);return assert&&assert(s,`no category with name = ${t}`),s.gain.value}setReverbLevel(t){if(!this.initialized){console.warn("an attempt was made to set the reverb level on an uninitialized sound manager, ignoring");return}if(t!==this._reverbLevel){assert&&assert(t>=0&&t<=1,`reverb value out of range: ${t}`);const s=phetAudioContext$1.currentTime;this.reverbGainNode.gain.linearRampToValueAtTime(t,s+LINEAR_GAIN_CHANGE_TIME),this.dryGainNode.gain.linearRampToValueAtTime(1-t,s+LINEAR_GAIN_CHANGE_TIME),this._reverbLevel=t}}set reverbLevel(t){this.setReverbLevel(t)}get reverbLevel(){return this.getReverbLevel()}getReverbLevel(){return this._reverbLevel}set enabled(t){this.enabledProperty.value=t}get enabled(){return this.enabledProperty.value}set sonificationLevel(t){this.extraSoundEnabledProperty.value=t===SoundScope.EXTRA}get sonificationLevel(){return this.extraSoundEnabledProperty.value?SoundScope.EXTRA:SoundScope.BASIC}logGain(t,s){}logMainGain(t){this.mainGainNode&&this.logGain(this.mainGainNode,t)}logReverbGain(t){this.reverbGainNode&&this.logGain(this.reverbGainNode,t)}}const soundManager=new SoundManager;tambo.register("soundManager",soundManager);const AUDIO_DATA_THRESHOLD=.05,SoundUtils={detectSoundBounds:a=>{const t=a.length,s=[],r=[];for(let n=0;n<a.numberOfChannels;n++){const l=a.getChannelData(n);s[n]=findSoundStartIndex(l,t,AUDIO_DATA_THRESHOLD),r[n]=findSoundEndIndex(l,t,AUDIO_DATA_THRESHOLD)}const o=a.sampleRate;return{soundStart:_.min(s)/o,soundEnd:_.max(r)/o}}},findSoundStartIndex=(a,t,s)=>{let r=0,o,n=!1;for(o=0;o<t-1&&!n;o++)a[o]>s&&a[o+1]>a[o]&&(r=o,n=!0);let l=0;for(n=!1,o=r;o>0&&!n;o--){const d=a[o];d<=0&&(l=d===0?o:o+1,n=!0)}let h=0,g=0;for(o=0;o<l;o++)h=Math.max(h,a[o]),g=Math.min(g,a[o]);return l},findSoundEndIndex=(a,t,s)=>{let r=t-1,o=!1,n;for(n=t-1;n>0&&!o;n--)a[n]<=-s&&a[n-1]<a[n]&&(r=n,o=!0);let l=r;for(o=!1,n=r;n<t-1&&!o;n++)a[n+1]>=0&&(l=n,o=!0);let h=0,g=0;for(n=l;n<t;n++)h=Math.max(h,a[n]),g=Math.min(g,a[n]);return l};tambo.register("SoundUtils",SoundUtils);const DEFAULT_TIME_CONSTANT=soundConstants.DEFAULT_PARAM_CHANGE_TIME_CONSTANT,notSettingPhetioStateProperty=DerivedProperty.not(isSettingPhetioStateProperty);class SoundGenerator extends Disposable{constructor(t){super();const s=optionize()({initialOutputLevel:1,audioContext:phetAudioContext$1,connectImmediately:!1,enableControlProperties:[],additionalAudioNodes:[],enabledDuringPhetioStateSetting:!1},t);this.audioContext=s.audioContext,this._outputLevel=s.initialOutputLevel,this.connectionList=[],this.enableControlProperties=createObservableArray(),this.fullyEnabledProperty=new BooleanProperty(!0);const r=()=>{this.fullyEnabledProperty.value=_.every(this.enableControlProperties,o=>o.value)};this.enableControlProperties.addItemAddedListener(o=>{o.link(r);const n=l=>{l===o&&(l.unlink(r),this.enableControlProperties.removeItemRemovedListener(n))};this.enableControlProperties.addItemRemovedListener(n)}),s.enableControlProperties.forEach(o=>{this.addEnableControlProperty(o)}),this.locallyEnabledProperty=new BooleanProperty(!0),this.addEnableControlProperty(this.locallyEnabledProperty),this.mainGainNode=this.audioContext.createGain(),this.mainGainNode.gain.setValueAtTime(this._outputLevel,this.audioContext.currentTime),s.connectImmediately&&this.mainGainNode.connect(this.audioContext.destination),this.fullyEnabledProperty.link(o=>{const n=o?0:this._outputLevel,l=o?this._outputLevel:0,h=this.audioContext.currentTime;this.mainGainNode.gain.setValueAtTime(n,h),this.mainGainNode.gain.linearRampToValueAtTime(l,this.audioContext.currentTime+soundConstants.DEFAULT_LINEAR_GAIN_CHANGE_TIME)}),this.soundSourceDestination=this.mainGainNode;for(let o=s.additionalAudioNodes.length-1;o>=0;o--){const n=s.additionalAudioNodes[o];n.connect(this.soundSourceDestination),this.soundSourceDestination=n}Tandem.PHET_IO_ENABLED&&!s.enabledDuringPhetioStateSetting&&this.addEnableControlProperty(notSettingPhetioStateProperty),this.disposeEmitter.addListener(()=>{this.enableControlProperties.clear()})}connect(t){this.mainGainNode.connect(t),this.connectionList.push(t)}disconnect(t){this.mainGainNode.disconnect(t),this.connectionList=_.without(this.connectionList,t)}isConnectedTo(t){return this.connectionList.includes(t)}setOutputLevel(t,s=DEFAULT_TIME_CONSTANT){if(t!==this._outputLevel){const r=this.audioContext.currentTime;this.fullyEnabledProperty.value&&(this.mainGainNode.gain.cancelScheduledValues(r),s===0?this.mainGainNode.gain.setValueAtTime(t,r):this.audioContext.state==="running"?this.mainGainNode.gain.setTargetAtTime(t,r,s):this.mainGainNode.gain.linearRampToValueAtTime(t,r+soundConstants.DEFAULT_LINEAR_GAIN_CHANGE_TIME)),this._outputLevel=t}}set outputLevel(t){this.setOutputLevel(t)}get outputLevel(){return this.getOutputLevel()}getOutputLevel(){return this._outputLevel}addEnableControlProperty(t){this.enableControlProperties.push(t)}removeEnableControlProperty(t){this.enableControlProperties.remove(t)}get locallyEnabled(){return this.locallyEnabledProperty.value}set locallyEnabled(t){this.locallyEnabledProperty.value=t}get fullyEnabled(){return this.fullyEnabledProperty.value}}tambo.register("SoundGenerator",SoundGenerator);const MAX_PLAY_DEFER_TIME=.2,DEFAULT_TC=soundConstants.DEFAULT_PARAM_CHANGE_TIME_CONSTANT,DEFAULT_STOP_DELAY=.1;class SoundClip extends SoundGenerator{constructor(t,s){const r=optionize()({loop:!1,trimSilence:!0,initialPlaybackRate:1,initiateWhenDisabled:!1,rateChangesAffectPlayingSounds:!0},s);if(super(r),this.wrappedAudioBuffer=t,this.loop=r.loop,this.rateChangesAffectPlayingSounds=r.rateChangesAffectPlayingSounds,this.initiateWhenDisabled=r.initiateWhenDisabled,this.soundStart=0,this.soundEnd=null,r.trimSilence){const o=n=>{if(n){const l=SoundUtils.detectSoundBounds(n);this.soundStart=l.soundStart,this.soundEnd=l.soundEnd,this.wrappedAudioBuffer.audioBufferProperty.unlink(o)}};this.wrappedAudioBuffer.audioBufferProperty.link(o)}this.activeBufferSources=[],this.localGainNode=this.audioContext.createGain(),this.localGainNode.connect(this.soundSourceDestination),this._playbackRate=r.initialPlaybackRate,this.isPlayingProperty=new BooleanProperty(!1),this.timeOfDeferredPlayRequest=Number.NEGATIVE_INFINITY,this.audioContextStateChangeListener=o=>{o==="running"&&((this.loop||(Date.now()-this.timeOfDeferredPlayRequest)/1e3<MAX_PLAY_DEFER_TIME)&&this.play(.1),audioContextStateChangeMonitor.removeStateChangeListener(this.audioContext,this.audioContextStateChangeListener))},this.fullyEnabledProperty.lazyLink(o=>{!this.loop&&!o&&this.stop()})}play(t=0){if(this.audioContext.state==="running"&&this.wrappedAudioBuffer.audioBufferProperty.value){const s=this.audioContext.currentTime;if(this.loop&&!this.isPlayingProperty.get()||!this.loop&&(this.fullyEnabled||this.initiateWhenDisabled)){const r=this.audioContext.createBufferSource();r.buffer=this.wrappedAudioBuffer.audioBufferProperty.value,r.loop=this.loop,r.loopStart=this.soundStart,this.soundEnd&&(r.loopEnd=this.soundEnd),this.localGainNode.gain.cancelScheduledValues(s),this.localGainNode.gain.setValueAtTime(1,s),r.connect(this.soundSourceDestination),this.activeBufferSources.push(r),this.loop||(r.onended=()=>{const o=this.activeBufferSources.indexOf(r);o>-1&&this.activeBufferSources.splice(o,1),this.isPlayingProperty.value=this.activeBufferSources.length>0}),r.playbackRate.setValueAtTime(this._playbackRate,s),r.start(s+t,this.soundStart),this.isPlayingProperty.value=!0}}else this.audioContext.state==="suspended"&&(this.timeOfDeferredPlayRequest=Date.now(),audioContextStateChangeMonitor.hasListener(this.audioContext,this.audioContextStateChangeListener)||audioContextStateChangeMonitor.addStateChangeListener(this.audioContext,this.audioContextStateChangeListener))}stop(t=DEFAULT_STOP_DELAY){const s=t>0?t/4.61:soundConstants.DEFAULT_PARAM_CHANGE_TIME_CONSTANT,r=this.audioContext.currentTime,o=r+t;this.localGainNode.gain.cancelScheduledValues(r),this.localGainNode.gain.setTargetAtTime(0,r,s),this.activeBufferSources.forEach(n=>{n.stop(o)}),this.activeBufferSources.length=0,this.isPlayingProperty.value=!1,audioContextStateChangeMonitor.hasListener(this.audioContext,this.audioContextStateChangeListener)&&audioContextStateChangeMonitor.removeStateChangeListener(this.audioContext,this.audioContextStateChangeListener)}setPlaybackRate(t,s=DEFAULT_TC){if(assert&&assert(t>0,"invalid playback rate: "+t),this.rateChangesAffectPlayingSounds){const r=this.audioContext.currentTime;this.activeBufferSources.forEach(o=>{o.playbackRate.cancelScheduledValues(r),o.playbackRate.setTargetAtTime(t,r,s)})}this._playbackRate=t}getPlaybackRate(){return this._playbackRate}get playbackRate(){return this.getPlaybackRate()}get isPlaying(){return this.isPlayingProperty.value}getNumberOfPlayingInstances(){return this.activeBufferSources.length}}tambo.register("SoundClip",SoundClip);class SoundClipPlayer{constructor(t,s){const r=optionize()({soundClipOptions:{},soundManagerOptions:{}},s);this._soundClip=new SoundClip(t,r.soundClipOptions),soundManager.addSoundGenerator(this._soundClip,r.soundManagerOptions)}play(){this._soundClip.play()}stop(){this._soundClip.stop()}getSoundClip(){return this._soundClip}}tambo.register("SoundClipPlayer",SoundClipPlayer);const switchToLeftSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$g,{soundClipOptions:{initialOutputLevel:.2},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("switchToLeftSoundPlayer",switchToLeftSoundPlayer);const soundURI$e="data:audio/mpeg;base64,//swxAAABQQDHVQRABFbki33MLACAFiANEhrgagQWfE6eUcJxwPv5wuD/ynh/aXfLvD/9HlwfD//EEEPD7ZhOAkFSjlaqEIiQQAEs4eiJWJc1P1YWHlShsUzcufWA094Hx1uq0G20l0OwMrP+XF59gcKx8JP77pO3m998s/Yw/nLVXnrrpQBsXJUFMLEnmlFmN/yDRSkA2wbEgAA//syxAQACKRzd7zHgAkGB+81hgxyg9V/KSvjePEM6MTwDABAfIScR33O56q5d4xqkH7v3jiaZMD6kY9sjxrY2dnb1HHfvNR/kWIABj/dYQ11+H0jIKJAJJKoO2kaXeWiJIkiSIKkCp6SSSRawEonOLl37VSoUBXLB1R4RArEQNHoKne/wVBU9wWDv4KhL8s9QNP/QiqohANaOyIgAP/7MsQEgAhwYVvmPMihFovqvMwtRAH6Ae14cRCJA0gkI0l3oAaVhTxL2UFGwRUl00mkOm7spnrNztCVjBca9pe1ZAAImV6HsdkkYbqCJBixaWQQZZKZsggAaovjuRz0ay4sAStsBa8qCRLYzJqRvdo6N8kxL5ulvc1t68seeejKSpp09k0Niw9j0xU7cwYDINIb9ZH0VZtohLZJIkj/+zLEA4AIWItlrCBPcRURrbawIAYAJxeV16k/ZdmXyuGXKtUDPLTyWvc8HhHuEmbDWxZs3a26Jzoe0n+dLpP9moqDULbjgomp6BR7tp47Kkb/Yy7HHGiQALQa4vBYdia742/8Tg6Ha/Yveot5iAggAUDAwPPgRG2IQAAAAjEAwP1yvoQIToEAAAQ5YPg+BwcOf+D4PhgAJtta7sOB//swxAOACHRxgbj0gAENjex3sIAAQAgIBAQABwvF95I9BqsaLjRfG8H8voXioPoFOTnP5fr6BAbTCiaJqU//xNPUyOwkrvuV+H0skfwwkh/8uGgaN7U4ykgBI0Wl0NRp9iTTuOtTP3h74fLq2RJI5YD4IhSIZoj1X1UVJEZr6+eMZdiQADi2WsYqaj6u1HKNo9Ta1BZ2GWfu2RpE//syxAOAyERfc6ekbHEFiy24x5gugCwNDM0QkIOIpArkSBqEiqI+lT4jPXA6p0BJyc7A/ueQIEDN8GVxZ0NRU6hwZWZ+u0vmJAcZH1s/fvWToCKjwqgrRCT5TA2SpWReMQaRbtiwvwoHGQwVTzCMlEnyNn9u7MLAVgshUNiq2C20CCygTEZw56WOpYszR3GtXoW6ht/2WRFEABIUbP/7MsQFgAjAk2OsvQGxFRLo9YYU3I5XmAGmX2GjdKVSyEyfEei2W4xByQeX12Jv+JSUCUNe3dQcxD//+rd/xZysTZIrIiZR7qJWtsem773JLgTX0uaaZAEhq87YWCLAk2QPRDsijCdQMyTfTUASGYWdhh0rvEmDrF/obq13lSbEnO6iu0XtJAY0AlnTooDLWLYz1nXalTIJHLdbYmT/+zLEA4AHVLVPoTyjMJ8D5egwvAIAa4iOYBvORuqckKIjmT0f3wGoJDpymlsoq0IgUcZlalKJoqD63behXSb3dH1aMG7tj51oii6lBlJ0AStbgiTFQn40KM3C3KpNO+tnib+WCg+IpL/ez9P/2v9tCgACxBbaTwBY2euQgIjICwBbIKp9DCz6zvsneDLl1hU6BTvZ5Wj+z/wVV9QI//swxBYABVwfGUM8wlB8giG0EIgOCIelakAcALdhRIwrRYRkcReWf6vb///KypL96vYV11222AVLFlA4Q0hOHgNAKIBOJRUqoJdlVUxBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//syxDSDwxQk0ISZIHgAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQ==",soundByteArray$e=base64SoundToByteArray(phetAudioContext$1,soundURI$e),unlock$e=asyncLoader.createLock(soundURI$e),wrappedAudioBuffer$e=new WrappedAudioBuffer;let unlocked$e=!1;const safeUnlock$e=()=>{unlocked$e||(unlock$e(),unlocked$e=!0)},onDecodeSuccess$e=a=>{wrappedAudioBuffer$e.audioBufferProperty.value===null&&(wrappedAudioBuffer$e.audioBufferProperty.set(a),safeUnlock$e())},onDecodeError$e=a=>{console.warn("decode of audio data failed, using stubbed sound, error: "+a),wrappedAudioBuffer$e.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$e()},decodePromise$e=phetAudioContext$1.decodeAudioData(soundByteArray$e.buffer,onDecodeSuccess$e,onDecodeError$e);decodePromise$e&&decodePromise$e.then(a=>{wrappedAudioBuffer$e.audioBufferProperty.value===null&&(wrappedAudioBuffer$e.audioBufferProperty.set(a),safeUnlock$e())}).catch(a=>{console.warn("promise rejection caught for audio decode, error = "+a),safeUnlock$e()});const switchToRightSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$e,{soundClipOptions:{initialOutputLevel:.2},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("switchToRightSoundPlayer",switchToRightSoundPlayer);const DEFAULT_SIZE=new Dimension2(60,30);class ToggleSwitch extends Voicing(Node$2){constructor(t,s,r,o){assert&&assertMutuallyExclusiveOptions(o,["a11yName"],["innerContent","voicingNameResponse"]);const n=optionize()({size:DEFAULT_SIZE,toggleWhileDragging:null,dragThreshold:3,toggleThreshold:1,thumbFill:null,thumbStroke:"black",thumbTouchAreaXDilation:8,thumbTouchAreaYDilation:8,thumbMouseAreaXDilation:0,thumbMouseAreaYDilation:0,trackFillLeft:null,trackFillRight:null,trackStroke:"black",cursor:"pointer",disabledOpacity:SceneryConstants.DISABLED_OPACITY,switchToLeftSoundPlayer,switchToRightSoundPlayer,tandem:Tandem.REQUIRED,tandemNameSuffix:"Switch",phetioEventType:EventType.USER,phetioReadOnly:PhetioObject.DEFAULT_OPTIONS.phetioReadOnly,visiblePropertyOptions:{phetioFeatured:!0},phetioEnabledPropertyInstrumented:!0,phetioFeatured:!0,tagName:"button",ariaRole:"switch",a11yName:null,leftValueContextResponse:null,rightValueContextResponse:null},o);let l=null;(!n.trackFillLeft||!n.trackFillRight)&&(l=new LinearGradient(0,0,0,n.size.height).addColorStop(0,"rgb( 40, 40, 40 )").addColorStop(1,"rgb( 200, 200, 200 )")),n.trackFillLeft=n.trackFillLeft||l,n.trackFillRight=n.trackFillRight||l,n.thumbFill=n.thumbFill||new LinearGradient(0,0,0,n.size.height).addColorStop(0,"white").addColorStop(1,"rgb( 200, 200, 200 )"),n.a11yName&&(n.voicingNameResponse=n.a11yName,n.innerContent=n.a11yName),super(),this.onInputEmitter=new Emitter;const h=n.size.height/2,g=new Rectangle(0,0,n.size.width,n.size.height,h,h,{stroke:n.trackStroke,fill:n.trackFillLeft});this.addChild(g);const d=new Rectangle(0,0,n.size.width,n.size.height,h,h,{stroke:n.trackStroke,fill:n.trackFillRight});this.addChild(d);const A=new Rectangle(0,0,.5*n.size.width,n.size.height,h,h,{fill:n.thumbFill,stroke:n.thumbStroke});this.addChild(A),(n.thumbTouchAreaXDilation||n.thumbTouchAreaYDilation)&&(A.touchArea=Shape$1.roundRect(-n.thumbTouchAreaXDilation,-n.thumbTouchAreaYDilation,.5*n.size.width+2*n.thumbTouchAreaXDilation,n.size.height+2*n.thumbTouchAreaYDilation,h,h)),(n.thumbMouseAreaXDilation||n.thumbMouseAreaYDilation)&&(A.mouseArea=Shape$1.roundRect(-n.thumbMouseAreaXDilation,-n.thumbMouseAreaYDilation,.5*n.size.width+2*n.thumbMouseAreaXDilation,n.size.height+2*n.thumbMouseAreaYDilation,h,h));const S=Q=>{const pe=g.lineWidth/2;Q===s?A.left=-pe:A.right=n.size.width+pe,d.rectWidth=A.right-pe,this.setPDOMAttribute("aria-pressed",Q!==s),this.setPDOMAttribute("aria-checked",Q!==s)};t.link(S);const O=n.dragThreshold*n.dragThreshold,I=new Vector2(0,0);let W=!1;const L=new PhetioAction$1(Q=>{t.value=Q,this.onInputEmitter.emit()},{parameters:[{validValues:[s,r],phetioPrivate:!0}],tandem:n.tandem.createTandem("toggleAction"),phetioDocumentation:"Occurs when the switch is toggled via user interaction",phetioReadOnly:n.phetioReadOnly,phetioEventType:EventType.USER});this.onInputEmitter.addListener(()=>{t.value===s?n.switchToLeftSoundPlayer.play():n.switchToRightSoundPlayer.play();const Q=t.value===r?n.rightValueContextResponse:n.leftValueContextResponse;Q&&(this.alertDescriptionUtterance(Q),this.voicingSpeakResponse({contextResponse:Utterance.alertableToText(Q)}))});const H=()=>A.centerX<g.centerX?s:r,Y=new DragListener({tandem:n.tandem.createTandem("dragListener"),canStartPress:Q=>Q&&(Q.type==="move"||Q.type==="enter")?_.includes(Q.trail.nodes,A):!0,start:()=>{I.setXY(0,0),W=!1},drag:(Q,pe)=>{I.add(pe.modelDelta),W=W||I.magnitudeSquared>O;const de=pe.getCurrentTarget().globalToLocalPoint(Q.pointer.point),fe=A.width/2,ye=g.lineWidth/2;A.centerX=DotUtils.clamp(de.x,fe-ye,n.size.width-fe+ye),d.rectWidth=A.right-ye;const Ee=de.x<(1-2*n.toggleThreshold)*fe||de.x>(-1+2*n.toggleThreshold)*fe+n.size.width,Le=H();(n.toggleWhileDragging===!0||Ee&&n.toggleWhileDragging===null)&&t.value!==Le&&L.execute(Le)},end:()=>{const Q=t.value===s?r:s,pe=W?H():Q;t.value!==pe&&L.execute(pe),S(pe)},canClick:!0});this.addInputListener(Y),this.mutate(n),this.addLinkedElement(t,{tandemName:"property"}),this.switchToLeftSoundPlayer=n.switchToLeftSoundPlayer,this.switchToRightSoundPlayer=n.switchToRightSoundPlayer,this.disposeToggleSwitch=()=>{g.dispose(),d.dispose(),t.unlink(S),L.dispose(),Y.dispose(),this.onInputEmitter.dispose()}}dispose(){this.disposeToggleSwitch(),super.dispose()}}sun.register("ToggleSwitch",ToggleSwitch);const DEFAULT_SET_LABEL_ENABLED=(a,t)=>{a.opacity=t?1:SceneryConstants.DISABLED_OPACITY};class ABSwitch extends HBox{constructor(t,s,r,o,n,l){var W,L;assert&&assert(r.tandem,"labelA must have a tandem"),assert&&assert(n.tandem,"labelB must have a tandem");const h=optionize()({toggleSwitchOptions:{enabledPropertyOptions:{phetioFeatured:!1}},setLabelEnabled:DEFAULT_SET_LABEL_ENABLED,centerOnSwitch:!1,cursor:"pointer",disabledOpacity:SceneryConstants.DISABLED_OPACITY,spacing:8,tandem:Tandem.REQUIRED,tandemNameSuffix:"Switch",visiblePropertyOptions:{phetioFeatured:!0},phetioEnabledPropertyInstrumented:!0},l),g=new ToggleSwitch(t,s,o,combineOptions({tandem:h.tandem.createTandem("toggleSwitch")},h.toggleSwitchOptions));let d=r,A=n;if(h.centerOnSwitch){const H=new AlignGroup;d=new AlignBox(r,{group:H,xAlign:"right"}),A=new AlignBox(n,{group:H,xAlign:"left"})}h.children=[d,g,A],super(h),this.onInputEmitter=new Emitter,this.property=t,this.valueA=s,this.valueB=o,this.labelA=r,this.labelB=n,this.toggleSwitch=g,this.setLabelEnabled=h.setLabelEnabled;const S=()=>this.updateLabelsEnabled();t.link(S);const O=new PressListener({release:()=>{const H=t.value;t.value=s,H!==s&&this.onInputEmitter.emit()},tandem:r.tandem.createTandem("pressListener")});r.addInputListener(O);const I=new PressListener({release:()=>{const H=t.value;t.value=o,H!==o&&this.onInputEmitter.emit()},tandem:n.tandem.createTandem("pressListener")});n.addInputListener(I),g.onInputEmitter.addListener(()=>this.onInputEmitter.emit()),this.onInputEmitter.addListener(()=>{t.value===o&&g.switchToRightSoundPlayer.play(),t.value===s&&g.switchToLeftSoundPlayer.play()}),this.disposeABSwitch=()=>{t.unlink(S),g.dispose(),this.onInputEmitter.dispose(),r.removeInputListener(O),n.removeInputListener(I),O.dispose(),I.dispose()},assert&&((L=(W=phet==null?void 0:phet.chipper)==null?void 0:W.queryParameters)!=null&&L.binder)&&InstanceRegistry.registerDataURL("sun","ABSwitch",this)}dispose(){this.disposeABSwitch(),super.dispose()}onEnabledPropertyChange(t){!t&&this.interruptSubtreeInput(),this.inputEnabled=t,this.toggleSwitch.enabled=t,this.updateLabelsEnabled()}updateLabelsEnabled(){this.setLabelEnabled(this.labelA,this.enabled&&this.property.value===this.valueA),this.setLabelEnabled(this.labelB,this.enabled&&this.property.value===this.valueB)}}sun.register("ABSwitch",ABSwitch);const soundURI$d="data:audio/mpeg;base64,//swxAAABSAbF7TAgDE5nqu/MHICAAAAcDYkDIEtmZ+0OAIDonAEAIOjgnenW/yhz/g+fh+CEocif//+c5RVQlRIdHdXcHffj/DYYCgBdaS6OzOU+xCNTd7EPI6nQ7mODNUkXlljx1AXgvbsgTi8z3+Z7a8aMfHP9uQFmXb1f/cmZM/9//sIhYP//sNqQJAgNJhWTyGAwFAoAATS//syxAeACW0Hgbi1EBESBuvjNGAAfDtZrw0MQaBPJj2MwQyJDLEhJZGoPjAvCMnP3dlJiAtJ8xr/PKk5hYV//3KDxif//6MYVcnt//+VFswo04EQAACAAC9YdezBqNoZHHQDlUSCuyZAkxazLI1qAeiR+JfccaBj1xti9B5JXrESzzBnSIgoXKxEzkQCos+pbPmxfwWXkwAAFm+93//7MsQDgAh4Z1G5gwABEY3y9x5iAuzlQAAAAAB2Wop4QsaAhgpWdRTKJsZcpp1XP57ykSikyYckLZ4Ty1TSs+HageepBZpVjXhgAMSIXXKmU65I0d/7dt7v7sNgMBwALVb09GkvHVk7fqBciIEitH44DchaeFCkbZVn3vi+3iz997uspO3MNCwv4nKHDdB/+gTro/8WA6oYAgMAeW//+zLEAwAIZH9bHaGAAQMgrTTxid9Ko07zWxQmamYZMUXJVhdXnyiL/VNVCqJJVOgImNStCjd9bH2ZjwZ/qQYUyG79QVWCpgKmMChqVd/4VIkkywFXa2uRpIAhLLU5m1VG6LimpHOKzIapjKZdQGJoCUbq7bMoVyt+j5W6t+WZ/r/KqPLMbv1Kxurf//8tBTuFZBUABV3GwiMDZuFj//swxAUCB4SDK0ywaICeAyN0wyROlYmGu6/rSDZ4E2kDhIFxZeHE1XJXBGqqqgLGqsZQ8m6ArsXr1fUvL1lChr+v/7fq//SC5HLZU2AEjwW0VUCig+dQNmTNmsUQ+tQt+EhX+skFfU3+n+u7/hV6TEFNRTMuOTkuNaqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq",soundByteArray$d=base64SoundToByteArray(phetAudioContext$1,soundURI$d),unlock$d=asyncLoader.createLock(soundURI$d),wrappedAudioBuffer$d=new WrappedAudioBuffer;let unlocked$d=!1;const safeUnlock$d=()=>{unlocked$d||(unlock$d(),unlocked$d=!0)},onDecodeSuccess$d=a=>{wrappedAudioBuffer$d.audioBufferProperty.value===null&&(wrappedAudioBuffer$d.audioBufferProperty.set(a),safeUnlock$d())},onDecodeError$d=a=>{console.warn("decode of audio data failed, using stubbed sound, error: "+a),wrappedAudioBuffer$d.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$d()},decodePromise$d=phetAudioContext$1.decodeAudioData(soundByteArray$d.buffer,onDecodeSuccess$d,onDecodeError$d);decodePromise$d&&decodePromise$d.then(a=>{wrappedAudioBuffer$d.audioBufferProperty.value===null&&(wrappedAudioBuffer$d.audioBufferProperty.set(a),safeUnlock$d())}).catch(a=>{console.warn("promise rejection caught for audio decode, error = "+a),safeUnlock$d()});const accordionBoxClosedSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$d,{soundClipOptions:{initialOutputLevel:.5},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("accordionBoxClosedSoundPlayer",accordionBoxClosedSoundPlayer);const soundURI$c="data:audio/mpeg;base64,//swxAAABsArNnTzABEnmTA3HoACAAIOAYznNNVnYDYAWAjClBSA3BwKB48VkSUAABBynBhYP5QMCc+T4JnwQcoH/6gff/Of/l4gAIJkjluslkskluuAAAkTmCV7K1w6pqz7VkryDnmQVVFCJY0HRFDgrNPT7QRsUHNV+KVNJRPtYt0/426/nj/Tv/sPVjjhtrzPbywAATqIdRsL//syxAOACHStW/2RACEMj6e2smAEqYAYhGmdJfGbQRJM6d5rUVhcXmZTOP9blIoBChWlL5hQoqBgpUdHqJ/1McBGpaGctDO3++hgIUqDV8QgqAAntdpnEwAD6ruLLBhIIEPkpGtP5xWnwVF2czcptv1Fgk0VRRGN9VJRU46pQrSVRX///853QKKZ0dz3cGnwCKBwcHYEIC0hEM5EMv/7MsQEAAiQXW+5hIAREZRslzKwACEMBgAAD9/MyuFW/l8vMAkS99TuX45zufo9JjH/gbUAtafz/MqCaqJP4IIAARGcawPpR8H3iefS7zg45qAIBFAAV1AtJXsx44xwqAZ24lKIsEc5bDMUuS6XnBEXQqAakxM3KX8vlruv28Pc++21X/p71t0ufET/PUOSB+v8FT3Fl3GALLrbdbr/+zLEA4AIWHtvuPWAEROSLXcegALRIIBAAAAIpME09Jpkm6HEpcYWjTFeQLCjn4NAjRM5fbfr4UULuXdO+HtlGqi0a/9EFQ66zxGCz/4GGlyg0HFHJZM7ZIAwEAAAErGUoi0JXI6UF+hiurPpjdxalUIbk1pRYWEUpY39w/BVt/p1i48ySduL+KRKEg8sPo/yoV/yLlIIpJIQSCOJ//swxAODxLAbO7xggDAAADSAAAAEweQCRznEiWHEqW49z3nuJf8Fbqzvw1+e6j3TPf/BakxBTUUzLjk5LjWqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq",soundByteArray$c=base64SoundToByteArray(phetAudioContext$1,soundURI$c),unlock$c=asyncLoader.createLock(soundURI$c),wrappedAudioBuffer$c=new WrappedAudioBuffer;let unlocked$c=!1;const safeUnlock$c=()=>{unlocked$c||(unlock$c(),unlocked$c=!0)},onDecodeSuccess$c=a=>{wrappedAudioBuffer$c.audioBufferProperty.value===null&&(wrappedAudioBuffer$c.audioBufferProperty.set(a),safeUnlock$c())},onDecodeError$c=a=>{console.warn("decode of audio data failed, using stubbed sound, error: "+a),wrappedAudioBuffer$c.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$c()},decodePromise$c=phetAudioContext$1.decodeAudioData(soundByteArray$c.buffer,onDecodeSuccess$c,onDecodeError$c);decodePromise$c&&decodePromise$c.then(a=>{wrappedAudioBuffer$c.audioBufferProperty.value===null&&(wrappedAudioBuffer$c.audioBufferProperty.set(a),safeUnlock$c())}).catch(a=>{console.warn("promise rejection caught for audio decode, error = "+a),safeUnlock$c()});const accordionBoxOpenedSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$c,{soundClipOptions:{initialOutputLevel:.5},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("accordionBoxOpenedSoundPlayer",accordionBoxOpenedSoundPlayer);function getGroupItemNodes(a,t){return a.map(s=>(assert&&assert(!s.node,"Use createNode instead of node"),s.createNode(t&&s.tandemName?t.createTandem(s.tandemName):Tandem.OPTIONAL)))}class ToggleNode extends Node$2{constructor(t,s,r){var h;const o=optionize()({alignChildren:ToggleNode.CENTER,unselectedChildrenSceneGraphStrategy:"included"},r),n=getGroupItemNodes(s,(h=o.tandem)==null?void 0:h.createTandem("elements"));o.children=n,o.alignChildren(o.children),super(o);const l=g=>{const d=[];for(let A=0;A<s.length;A++){const O=s[A].value===g;n[A].visible=O,O&&d.push(n[A])}assert&&assert(d.length===1,`Wrong number of matches: ${d.length}`),o.unselectedChildrenSceneGraphStrategy==="excluded"&&(this.children=d)};t.link(l),this.nodes=n,this.disposeToggleNode=function(){t.unlink(l),n.forEach(g=>g.dispose())}}dispose(){this.disposeToggleNode(),super.dispose()}static CENTER(t){for(let s=1;s<t.length;s++)t[s].center=t[0].center}static CENTER_X(t){for(let s=1;s<t.length;s++)t[s].centerX=t[0].centerX}static CENTER_Y(t){for(let s=1;s<t.length;s++)t[s].centerY=t[0].centerY}static LEFT(t){for(let s=1;s<t.length;s++)t[s].left=t[0].left}static BOTTOM(t){for(let s=1;s<t.length;s++)t[s].bottom=t[0].bottom}static CENTER_BOTTOM(t){for(let s=1;s<t.length;s++)t[s].centerBottom=t[0].centerBottom}static RIGHT(t){for(let s=1;s<t.length;s++)t[s].right=t[0].right}static NONE(t){}}sun.register("ToggleNode",ToggleNode);class BooleanToggleNode extends ToggleNode{constructor(t,s,r,o){super(t,[{value:!0,createNode:()=>s},{value:!1,createNode:()=>r}],o)}}sun.register("BooleanToggleNode",BooleanToggleNode);const soundURI$b="data:audio/mpeg;base64,//swxAAABdzxBVQRADFFHaWrNxAA6lqlJJEQAExvBGPAACkboRpPkaQjfnfz5z/zvk6HfzvO//6nzn/8n8Wo50RIcE5h04AwQBAIwAHAAGGKl44UnQFxrI7b6JARZgWfzRC7X2cjUCZG/TgeAfXziIB7AOgm3/Dlw5chhj/4aoJEnxOhr/+bkURTNP+37dN///zd5/WqMcFKOhHs//syxAMACFBlQBnXgAEQCuRbvLAAMh2cNcpzMDxDOxVSMlAjYsYOAlbMUQJ8hAkSABkLAPbGhQfrk7xotjWuYO3uc9FKLMWDXX39eK91WL8a4ARAYAYFAQZg2BpmMcTuZ9zx5rwEJFAZZgjA1mC8BuLASofGAOAMhs/U/GV40k0Dkso2K6Npbban/lI2Pnd6J3///t66ABTcYocjaf/7MsQDgAX8JTutseaw6RRnNZCJDkFdpsKMGTznDUOCFN3UBmSx0M4MasPlPO6Ar07embS//T/2f27SK//YUG03dpZI2oMaBN8MJA5tI6MkldtNZgLZ+dUe9LvQy6Odv9a9cr9VPRUaBtgq9EWmz6Xj3KZTzOv1ylUAC+0kk0oAEUn+I0HZ6jICCWahweFTlrz07qq2Ls9T3N/Xljr/+zLEEgAFSBMjQWBgUI8CIvA3vAbc1Vf//uoAABTglUoQoEElDJAFw2zpqMe6sqMzu59/9uvz32/t/onv/5FMQU1FMy45OS41VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//swxC8DwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",soundByteArray$b=base64SoundToByteArray(phetAudioContext$1,soundURI$b),unlock$b=asyncLoader.createLock(soundURI$b),wrappedAudioBuffer$b=new WrappedAudioBuffer;let unlocked$b=!1;const safeUnlock$b=()=>{unlocked$b||(unlock$b(),unlocked$b=!0)},onDecodeSuccess$b=a=>{wrappedAudioBuffer$b.audioBufferProperty.value===null&&(wrappedAudioBuffer$b.audioBufferProperty.set(a),safeUnlock$b())},onDecodeError$b=a=>{console.warn("decode of audio data failed, using stubbed sound, error: "+a),wrappedAudioBuffer$b.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$b()},decodePromise$b=phetAudioContext$1.decodeAudioData(soundByteArray$b.buffer,onDecodeSuccess$b,onDecodeError$b);decodePromise$b&&decodePromise$b.then(a=>{wrappedAudioBuffer$b.audioBufferProperty.value===null&&(wrappedAudioBuffer$b.audioBufferProperty.set(a),safeUnlock$b())}).catch(a=>{console.warn("promise rejection caught for audio decode, error = "+a),safeUnlock$b()});const toggleOffSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$b,{soundClipOptions:{initialOutputLevel:.7},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("toggleOffSoundPlayer",toggleOffSoundPlayer);const soundURI$a="data:audio/mpeg;base64,//swxAAAByAnDnWRADEZkyy3M0ALJQcEAMk013znpOVkWGNCg9vD4oJlTQcNxQBIJ0PxSUlJSCwfB8Hz+CAIAN/DH/gg78EHS7//9QIJSLq/wFHg+AwFAAAAAAfFvo6+SmoCLgXFVlJaBRlrks8EfgdfwNGNDIX1icAtgSPunkTDV42yCf+OWMmXBP4hJ/+RAZg8nmowgLA3CbIw//syxAOACDxjRhnXgAEOCqVnuqAERLIypm8wTCMyMagDMoYEAyRAAgCAQ9za/ELra7bNcNI9BMVmPx3pF7P7a/wstMTOL6//gwrwjSeVKioAAkqgEBggJpjMDZgiPBm+0xy7jJ482ppET4kOhhSHhg8CKMhgGASP09uliMpAaC+Gyqiiyjd9/QiJjzxL//////p9lUBqv86UKJp6wP/7MsQEgAWgKTMsbMLwvwUmdaCI3g146KXMwJVAHDYhAjvxQKf+SIBJPJWbIrZ/1aVs/k7Lf2//7QQilFbJGkVBjWeEsADYyEamuw0dNdmGxS1qmJCrAKrGJZ+TX/V+1zX0fitWyROXKQQiijI22kTAod9keTOhUgChZfu1VSXOv2ubHdG+h4jXu2fLMV00rQvomqNH8kAAAARGFj3/+zLEGgDFrBkvoeWAcKKCYxBngBYhtAWgNUjlVDuFH+de4qlT5ENEZ7/8t7K3cKjB1Q/kmOcRTEFNRTMuOTkuNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//swxDMDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",soundByteArray$a=base64SoundToByteArray(phetAudioContext$1,soundURI$a),unlock$a=asyncLoader.createLock(soundURI$a),wrappedAudioBuffer$a=new WrappedAudioBuffer;let unlocked$a=!1;const safeUnlock$a=()=>{unlocked$a||(unlock$a(),unlocked$a=!0)},onDecodeSuccess$a=a=>{wrappedAudioBuffer$a.audioBufferProperty.value===null&&(wrappedAudioBuffer$a.audioBufferProperty.set(a),safeUnlock$a())},onDecodeError$a=a=>{console.warn("decode of audio data failed, using stubbed sound, error: "+a),wrappedAudioBuffer$a.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$a()},decodePromise$a=phetAudioContext$1.decodeAudioData(soundByteArray$a.buffer,onDecodeSuccess$a,onDecodeError$a);decodePromise$a&&decodePromise$a.then(a=>{wrappedAudioBuffer$a.audioBufferProperty.value===null&&(wrappedAudioBuffer$a.audioBufferProperty.set(a),safeUnlock$a())}).catch(a=>{console.warn("promise rejection caught for audio decode, error = "+a),safeUnlock$a()});const toggleOnSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$a,{soundClipOptions:{initialOutputLevel:.7},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("toggleOnSoundPlayer",toggleOnSoundPlayer);const co=class co extends EnumerationValue{};co.IDLE=new co,co.OVER=new co,co.PRESSED=new co,co.enumeration=new Enumeration(co);let ButtonInteractionState=co;sun.register("ButtonInteractionState",ButtonInteractionState);const ColorConstants={LIGHT_BLUE:new Color(153,206,255),LIGHT_GRAY:new Color(220,220,220)},CONTRAST_FILTER=new Contrast(.7),BRIGHTNESS_FILTER=new Brightness(1.2);class ButtonNode extends Sizable(Voicing(Node$2)){constructor(t,s,r,o){var A;const n=optionize()({content:null,minUnstrokedWidth:null,minUnstrokedHeight:null,xMargin:10,yMargin:5,xAlign:"center",yAlign:"center",xContentOffset:0,yContentOffset:0,baseColor:ColorConstants.LIGHT_BLUE,cursor:"pointer",buttonAppearanceStrategy:ButtonNode.FlatAppearanceStrategy,buttonAppearanceStrategyOptions:{},contentAppearanceStrategy:null,contentAppearanceStrategyOptions:{},enabledAppearanceStrategy:(S,O,I,W)=>{I.filters=S?[]:[CONTRAST_FILTER,BRIGHTNESS_FILTER],W&&(W.filters=S?[]:[Grayscale.FULL],W.opacity=S?1:SceneryConstants.DISABLED_OPACITY)},disabledColor:ColorConstants.LIGHT_GRAY,aspectRatio:null,tagName:"button",tandemNameSuffix:"Button",visiblePropertyOptions:{phetioFeatured:!0},phetioEnabledPropertyInstrumented:!0},o);n.listenerOptions=combineOptions({tandem:(A=n.tandem)==null?void 0:A.createTandem("pressListener")},n.listenerOptions),assert&&n.enabledProperty&&assert(n.enabledProperty===t.enabledProperty,"if options.enabledProperty is provided, it must === buttonModel.enabledProperty"),n.enabledProperty=t.enabledProperty,assert&&assert(n.aspectRatio===null||isFinite(n.aspectRatio)&&n.aspectRatio>0,`ButtonNode aspectRatio should be a positive finite value if non-null. Instead received ${n.aspectRatio}.`),super(),this.buttonNodeConstraint=null,this.content=n.content,this.buttonModel=t,this._settableBaseColorProperty=new PaintColorProperty(n.baseColor),this._disabledColorProperty=new PaintColorProperty(n.disabledColor),this.baseColorProperty=new DerivedProperty([this._settableBaseColorProperty,this.enabledProperty,this._disabledColorProperty],(S,O,I)=>O?S:I),this._pressListener=t.createPressListener(n.listenerOptions),this.addInputListener(this._pressListener),assert&&assert(s.fill===null,"ButtonNode controls the fill for the buttonBackground"),s.fill=this.baseColorProperty,this.addChild(s);const l=new n.buttonAppearanceStrategy(s,r,this.baseColorProperty,n.buttonAppearanceStrategyOptions);let h;n.contentAppearanceStrategy&&n.content&&(h=new n.contentAppearanceStrategy(n.content,r,n.contentAppearanceStrategyOptions)),this.maxLineWidth=l.maxLineWidth;let g=null,d=null;if(n.content){const S=n.content;S.pickable=!1,this.buttonNodeConstraint=new ButtonNodeConstraint(this,{content:n.content,xMargin:n.xMargin,yMargin:n.yMargin,maxLineWidth:this.maxLineWidth,minUnstrokedWidth:n.minUnstrokedWidth,minUnstrokedHeight:n.minUnstrokedHeight,aspectRatio:n.aspectRatio}),this.layoutSizeProperty=this.buttonNodeConstraint.layoutSizeProperty,g=new AlignBox(S,{xAlign:n.xAlign,yAlign:n.yAlign,leftMargin:n.xMargin+n.xContentOffset,rightMargin:n.xMargin-n.xContentOffset,topMargin:n.yMargin+n.yContentOffset,bottomMargin:n.yMargin-n.yContentOffset}),d=Multilink.multilink([s.boundsProperty,this.layoutSizeProperty],(O,I)=>{g.alignBounds=Bounds2.point(O.center).dilatedXY(I.width/2,I.height/2)}),this.addChild(g)}else assert&&assert(n.minUnstrokedWidth!==null),assert&&assert(n.minUnstrokedHeight!==null),this.layoutSizeProperty=new TinyProperty(new Dimension2(n.minUnstrokedWidth+this.maxLineWidth,n.minUnstrokedHeight+this.maxLineWidth));this.mutate(n),this.enabledProperty.link(S=>n.enabledAppearanceStrategy(S,this,s,g)),this.disposeButtonNode=()=>{g&&g.dispose(),d&&d.dispose(),l.dispose&&l.dispose(),h&&h.dispose&&h.dispose(),this._pressListener.dispose(),this.baseColorProperty.dispose()}}dispose(){this.buttonNodeConstraint&&this.buttonNodeConstraint.dispose(),this.disposeButtonNode(),super.dispose()}setBaseColor(t){this._settableBaseColorProperty.paint=t}set baseColor(t){this.setBaseColor(t)}get baseColor(){return this.getBaseColor()}getBaseColor(){return this._settableBaseColorProperty.paint}pdomClick(){this._pressListener.click(null)}isPDOMClicking(){return this._pressListener.pdomClickingProperty.get()}}class FlatAppearanceStrategy{constructor(t,s,r,o){const n=new PaintColorProperty(r,{luminanceFactor:.4}),l=new PaintColorProperty(r,{luminanceFactor:-.4}),h=r,g=n,d=l,A=combineOptions({stroke:l},o),S=typeof A.lineWidth=="number"?A.lineWidth:1;t.stroke=A.stroke||l,t.lineWidth=S,this.maxLineWidth=t.hasStroke()?S:0,t.cachedPaints=[h,g,d];function O(I){switch(I){case ButtonInteractionState.IDLE:t.fill=h;break;case ButtonInteractionState.OVER:t.fill=g;break;case ButtonInteractionState.PRESSED:t.fill=d;break;default:throw new Error(`unsupported interactionState: ${I}`)}}s.link(O),this.disposeFlatAppearanceStrategy=()=>{s.hasListener(O)&&s.unlink(O),n.dispose(),l.dispose()}}dispose(){this.disposeFlatAppearanceStrategy()}}class ButtonNodeConstraint extends LayoutConstraint{constructor(t,s){super(t),this.layoutSizeProperty=new TinyProperty(new Dimension2(0,0)),this.isFirstLayout=!0,this.lastLocalPreferredWidth=0,this.lastLocalPreferredHeight=0,this.buttonNode=t,this.content=s.content,this.xMargin=s.xMargin,this.yMargin=s.yMargin,this.maxLineWidth=s.maxLineWidth,this.minUnstrokedWidth=s.minUnstrokedWidth,this.minUnstrokedHeight=s.minUnstrokedHeight,this.aspectRatio=s.aspectRatio,this.buttonNode.localPreferredWidthProperty.lazyLink(this._updateLayoutListener),this.buttonNode.localPreferredHeightProperty.lazyLink(this._updateLayoutListener),this.addNode(this.content,!1),this.layout()}layout(){super.layout();const t=this.buttonNode,s=this.content;let r=Math.max(this.isFirstLayout||t.widthSizable?(isWidthSizable(s)?s.minimumWidth||0:s.width)+this.xMargin*2:t.localMinimumWidth,this.minUnstrokedWidth===null?0:this.minUnstrokedWidth+this.maxLineWidth),o=Math.max(this.isFirstLayout||t.heightSizable?(isHeightSizable(s)?s.minimumHeight||0:s.height)+this.yMargin*2:t.localMinimumHeight,this.minUnstrokedHeight===null?0:this.minUnstrokedHeight+this.maxLineWidth);this.aspectRatio!==null&&(r<o*this.aspectRatio&&(r=o*this.aspectRatio),o<r/this.aspectRatio&&(o=r/this.aspectRatio)),this.lastLocalPreferredWidth=this.isFirstLayout||isWidthSizable(t)?Math.max(r,t.localPreferredWidth||0):this.lastLocalPreferredWidth,this.lastLocalPreferredHeight=this.isFirstLayout||isHeightSizable(t)?Math.max(o,t.localPreferredHeight||0):this.lastLocalPreferredHeight,this.isFirstLayout=!1,this.layoutSizeProperty.value=new Dimension2(this.lastLocalPreferredWidth,this.lastLocalPreferredHeight),t.localMinimumWidth=r,t.localMinimumHeight=o}dispose(){this.buttonNode.localPreferredWidthProperty.unlink(this._updateLayoutListener),this.buttonNode.localPreferredHeightProperty.unlink(this._updateLayoutListener),super.dispose()}}ButtonNode.FlatAppearanceStrategy=FlatAppearanceStrategy;sun.register("ButtonNode",ButtonNode);const VERTICAL_HIGHLIGHT_GRADIENT_LENGTH=7,HORIZONTAL_HIGHLIGHT_GRADIENT_LENGTH=7,SHADE_GRADIENT_LENGTH=3;class RectangularButton extends ButtonNode{constructor(t,s,r){const o=optionize()({size:null,minWidth:HORIZONTAL_HIGHLIGHT_GRADIENT_LENGTH+SHADE_GRADIENT_LENGTH,minHeight:VERTICAL_HIGHLIGHT_GRADIENT_LENGTH+SHADE_GRADIENT_LENGTH,xMargin:8,yMargin:5,touchAreaXDilation:0,touchAreaYDilation:0,mouseAreaXDilation:0,mouseAreaYDilation:0,touchAreaXShift:0,touchAreaYShift:0,mouseAreaXShift:0,mouseAreaYShift:0,stroke:null,lineWidth:.5,cornerRadius:4,leftTopCornerRadius:null,rightTopCornerRadius:null,leftBottomCornerRadius:null,rightBottomCornerRadius:null,buttonAppearanceStrategy:RectangularButton.ThreeDAppearanceStrategy},r);o.content||assert&&assert(o.size!==void 0,"button dimensions needed if no content is supplied."),o.size?(assert&&assert(o.xMargin<o.size.width,"xMargin cannot be larger than width"),assert&&assert(o.yMargin<o.size.height,"yMargin cannot be larger than height"),o.minUnstrokedWidth=o.size.width,o.minUnstrokedHeight=o.size.height):(o.minWidth!==void 0&&(o.minUnstrokedWidth=o.minWidth),o.minHeight!==void 0&&(o.minUnstrokedHeight=o.minHeight)),o.buttonAppearanceStrategyOptions||(o.buttonAppearanceStrategyOptions={stroke:o.stroke,lineWidth:o.lineWidth});let n,l;o.size?(n=o.size.width,l=o.size.height):(n=Math.max(o.content?o.content.width+o.xMargin*2:0,o.minWidth),l=Math.max(o.content?o.content.height+o.yMargin*2:0,o.minHeight));const h=new Path(createButtonShape(n,l,o));if(o.size&&o.content){const d=o.content,A=Math.min((o.size.width-o.xMargin*2)/d.width,(o.size.height-o.yMargin*2)/d.height);o.content=new Node$2({children:[d],scale:A})}super(t,h,s,o);let g=!0;Multilink.multilink([this.isWidthResizableProperty,this.isHeightResizableProperty,this.layoutSizeProperty],(d,A,S)=>{(d||A)&&(h.shape=createButtonShape(d?S.width-this.maxLineWidth:n,A?S.height-this.maxLineWidth:l,o),assert&&assert(!d||h.width<=S.width+1e-7,"button width cannot exceed layout width"),assert&&assert(!A||h.height<=S.height+1e-7,"button width cannot exceed layout height")),(g||d||A)&&(this.touchArea=h.localBounds.dilatedXY(o.touchAreaXDilation,o.touchAreaYDilation).shiftedXY(o.touchAreaXShift,o.touchAreaYShift),this.mouseArea=h.localBounds.dilatedXY(o.mouseAreaXDilation,o.mouseAreaYDilation).shiftedXY(o.mouseAreaXShift,o.mouseAreaYShift)),g=!1})}}function createButtonShape(a,t,s){const r=Math.min(a/2,t/2);return Shape$1.roundedRectangleWithRadii(0,0,a,t,{topLeft:Math.min(r,s.leftTopCornerRadius!==null?s.leftTopCornerRadius:s.cornerRadius),topRight:Math.min(r,s.rightTopCornerRadius!==null?s.rightTopCornerRadius:s.cornerRadius),bottomLeft:Math.min(r,s.leftBottomCornerRadius!==null?s.leftBottomCornerRadius:s.cornerRadius),bottomRight:Math.min(r,s.rightBottomCornerRadius!==null?s.rightBottomCornerRadius:s.cornerRadius)})}let ThreeDAppearanceStrategy$1=class{constructor(t,s,r,o){const n=o&&o.stroke?o.stroke:new PaintColorProperty(r,{luminanceFactor:-.4}),l=o&&o.lineWidth!==void 0?o.lineWidth:.5,h=optionize()({stroke:n,lineWidth:l,overStroke:n,overLineWidth:l,overFill:r,overButtonOpacity:1,selectedStroke:n,selectedLineWidth:l,selectedButtonOpacity:1,deselectedStroke:n,deselectedLineWidth:l,deselectedButtonOpacity:1},o),g=new PaintColorProperty(r,{luminanceFactor:.7}),d=new PaintColorProperty(r,{luminanceFactor:.5}),A=new PaintColorProperty(r,{luminanceFactor:.2}),S=new PaintColorProperty(r,{luminanceFactor:-.3}),O=new PaintColorProperty(r,{luminanceFactor:-.4}),I=new PaintColorProperty(r,{luminanceFactor:-.5}),W=new DerivedProperty([r],pe=>pe.withAlpha(0)),L=new Color(255,255,255,.7),H=new Path(null,{stroke:h.stroke,lineWidth:h.lineWidth,pickable:!1});t.addChild(H),this.maxLineWidth=typeof h.lineWidth=="number"?h.lineWidth:0;let Y;const Q=()=>{const pe=t.shape.bounds.width,de=t.shape.bounds.height;H.shape=t.shape,assert&&assert(pe>=HORIZONTAL_HIGHLIGHT_GRADIENT_LENGTH+SHADE_GRADIENT_LENGTH),assert&&assert(de>=VERTICAL_HIGHLIGHT_GRADIENT_LENGTH+SHADE_GRADIENT_LENGTH);const fe=Math.min(VERTICAL_HIGHLIGHT_GRADIENT_LENGTH/de,1),ye=Math.max(1-SHADE_GRADIENT_LENGTH/de,0),Ee=Math.min(HORIZONTAL_HIGHLIGHT_GRADIENT_LENGTH/pe,1),Le=Math.max(1-SHADE_GRADIENT_LENGTH/pe,0),Z=new LinearGradient(0,0,0,de).addColorStop(0,g).addColorStop(fe,r).addColorStop(ye,r).addColorStop(1,I),ne=new LinearGradient(0,0,pe,0).addColorStop(0,L).addColorStop(Ee,W).addColorStop(Le,W).addColorStop(1,I),Ke=new LinearGradient(0,0,0,de).addColorStop(0,g).addColorStop(fe,d).addColorStop(ye,d).addColorStop(1,I),_t=new LinearGradient(0,0,pe,0).addColorStop(0,L).addColorStop(Ee/2,new Color(255,255,255,0)).addColorStop(Le,W).addColorStop(1,S),xe=new LinearGradient(0,0,0,de).addColorStop(0,g).addColorStop(fe*.67,S).addColorStop(ye,A).addColorStop(1,I);t.cachedPaints=[Z,Ke,xe],H.cachedPaints=[ne,_t],Y&&s.unlink(Y),Y=Ct=>{switch(Ct){case ButtonInteractionState.IDLE:t.fill=Z,t.stroke=h.deselectedStroke,t.lineWidth=h.deselectedLineWidth,t.opacity=h.deselectedButtonOpacity,H.fill=ne,H.opacity=h.deselectedButtonOpacity;break;case ButtonInteractionState.OVER:t.fill=Ke,t.stroke=h.overStroke,t.lineWidth=h.overLineWidth,t.opacity=h.overButtonOpacity,H.fill=_t,H.opacity=h.overButtonOpacity;break;case ButtonInteractionState.PRESSED:t.fill=xe,t.stroke=h.selectedStroke,t.lineWidth=h.selectedLineWidth,t.opacity=h.selectedButtonOpacity,H.fill=_t,H.opacity=h.selectedButtonOpacity;break;default:throw new Error(`unsupported interactionState: ${Ct}`)}},s.link(Y)};t.selfBoundsProperty.link(Q),this.disposeThreeDAppearanceStrategy=()=>{t.selfBoundsProperty.unlink(Q),s.hasListener(Y)&&s.unlink(Y),g.dispose(),d.dispose(),A.dispose(),S.dispose(),O.dispose(),I.dispose(),W.dispose()}}dispose(){this.disposeThreeDAppearanceStrategy()}};RectangularButton.ThreeDAppearanceStrategy=ThreeDAppearanceStrategy$1;sun.register("RectangularButton",RectangularButton);class ToggleButtonInteractionStateProperty extends DerivedProperty2{constructor(t){super([t.looksOverProperty,t.looksPressedProperty],(s,r)=>s&&!r?ButtonInteractionState.OVER:r?ButtonInteractionState.PRESSED:ButtonInteractionState.IDLE,{valueType:ButtonInteractionState})}}sun.register("ToggleButtonInteractionStateProperty",ToggleButtonInteractionStateProperty);class ButtonModel extends EnabledComponent{constructor(t){const s=optionize()({startCallback:_.noop,endCallback:_.noop,tandem:Tandem.REQUIRED,phetioState:PhetioObject.DEFAULT_OPTIONS.phetioState,phetioReadOnly:PhetioObject.DEFAULT_OPTIONS.phetioReadOnly,phetioFeatured:PhetioObject.DEFAULT_OPTIONS.phetioFeatured},t);s.enabledPropertyOptions=combineOptions({phetioState:s.phetioState,phetioReadOnly:s.phetioReadOnly,phetioDocumentation:"When disabled, the button is grayed out and cannot be pressed",phetioFeatured:!0},s.enabledPropertyOptions),super(s),this.overProperty=new BooleanProperty(!1),this.downProperty=new BooleanProperty(!1,{reentrant:!0}),this.focusedProperty=new BooleanProperty(!1),this.looksPressedProperty=new BooleanProperty(!1),this.looksOverProperty=new BooleanProperty(!1),this.produceSoundEmitter=new Emitter,this.interrupted=!1,this.listeners=[],this.looksPressedMultilink=null,this.looksOverMultilink=null,this.downProperty.lazyLink(r=>{r?s.startCallback():s.endCallback(this.looksOverProperty.get())}),this.enabledProperty.link(r=>{if(!r)for(let o=0;o<this.listeners.length;o++){const n=this.listeners[o];n.interrupt&&n.interrupt()}}),this.disposeButtonModel=()=>{this.overProperty.dispose(),this.downProperty.dispose(),this.produceSoundEmitter.dispose(),this.looksPressedMultilink&&this.looksPressedMultilink.dispose(),this.looksOverMultilink&&this.looksOverMultilink.dispose(),this.listeners=[]}}dispose(){this.disposeButtonModel(),super.dispose()}createPressListener(t){t=combineOptions({canStartPress:()=>this.enabledProperty.value},t);const s=new PressListener(t);this.listeners.push(s),s.isPressedProperty.lazyLink(n=>{this.interrupted=s.interrupted,this.downProperty.set(n)}),s.isOverProperty.lazyLink(this.overProperty.set.bind(this.overProperty)),s.isFocusedProperty.lazyLink(this.focusedProperty.set.bind(this.focusedProperty)),this.looksPressedMultilink&&this.looksPressedMultilink.dispose(),this.looksOverMultilink&&this.looksOverMultilink.dispose();const r=this.listeners.map(n=>n.looksPressedProperty);r.push(this.downProperty),this.looksPressedMultilink=Multilink.multilinkAny(r,(...n)=>{this.looksPressedProperty.value=_.reduce(n,(l,h)=>l||h,!1)});const o=this.listeners.map(n=>n.looksOverProperty);return this.looksOverMultilink=Multilink.multilinkAny(o,(...n)=>{this.looksOverProperty.value=_.reduce(n,(l,h)=>l||h,!1)}),s}}sun.register("ButtonModel",ButtonModel);class ToggleButtonModel extends ButtonModel{constructor(t,s,r,o){const n=optionize()({tandem:Tandem.REQUIRED},o);super(n),this.valueOff=t,this.valueOn=s,this.valueProperty=r;const l=g=>{(this.overProperty.get()||this.focusedProperty.get())&&this.enabledProperty.get()&&!this.interrupted&&(g||this.toggle())};this.downProperty.link(l),this.toggledEmitter=new Emitter({tandem:n.tandem.createTandem("toggledEmitter"),phetioDocumentation:"Emits when the button is toggled",phetioEventType:EventType.USER});const h=()=>{assert&&assert(this.valueProperty.value===this.valueOff||this.valueProperty.value===this.valueOn,`unrecognized value: ${this.valueProperty.value}`),this.valueProperty.value=this.valueProperty.value===this.valueOff?this.valueOn:this.valueOff};this.toggledEmitter.addListener(h),this.disposeToggleButtonModel=()=>{this.downProperty.unlink(l),this.toggledEmitter.dispose()}}dispose(){this.disposeToggleButtonModel(),super.dispose()}toggle(){this.toggledEmitter.emit(),this.produceSoundEmitter.emit()}}sun.register("ToggleButtonModel",ToggleButtonModel);class RectangularToggleButton extends RectangularButton{constructor(t,s,r,o){const n=optionize()({valueOffSoundPlayer:toggleOffSoundPlayer,valueOnSoundPlayer:toggleOnSoundPlayer,tandem:Tandem.REQUIRED,phetioFeatured:!0},o),l=new ToggleButtonModel(s,r,t,n),h=new ToggleButtonInteractionStateProperty(l);super(l,h,n),this.addLinkedElement(t,{tandemName:"property"});const g=()=>{t.value===s?n.valueOffSoundPlayer.play():t.value===r&&n.valueOnSoundPlayer.play()};this.buttonModel.produceSoundEmitter.addListener(g),this.disposeRectangularToggleButton=()=>{this.buttonModel.produceSoundEmitter.removeListener(g),l.dispose()}}dispose(){this.disposeRectangularToggleButton(),super.dispose()}}sun.register("RectangularToggleButton",RectangularToggleButton);class BooleanRectangularToggleButton extends RectangularToggleButton{constructor(t,s,r,o){const n=new BooleanToggleNode(t,s,r),l=optionize()({content:n,tandem:Tandem.REQUIRED},o);super(t,!1,!0,l),this.disposeBooleanRectangularToggleButton=()=>{n.dispose()}}dispose(){this.disposeBooleanRectangularToggleButton(),super.dispose()}}sun.register("BooleanRectangularToggleButton",BooleanRectangularToggleButton);const SYMBOL_RELATIVE_WIDTH=.6,RELATIVE_X_MARGIN=(1-SYMBOL_RELATIVE_WIDTH)/2;class ExpandCollapseButton extends BooleanRectangularToggleButton{constructor(t,s){var O,I;const r=optionize()({sideLength:25,stroke:"black",touchAreaXDilation:5,touchAreaYDilation:5,tandem:Tandem.REQUIRED,tandemNameSuffix:"Button"},s);r.cornerRadius=.1*r.sideLength,r.xMargin=RELATIVE_X_MARGIN*r.sideLength,r.yMargin=r.xMargin,r.buttonAppearanceStrategy=ButtonNode.FlatAppearanceStrategy;const o=SYMBOL_RELATIVE_WIDTH*r.sideLength,l={lineWidth:.15*r.sideLength,stroke:"white",centerX:r.sideLength/2,centerY:r.sideLength/2,pickable:!1},h=new Shape$1().moveTo(o/2,0).lineTo(o/2,o).moveTo(0,o/2).lineTo(o,o/2),g=new Path(h,l),d=new Shape$1().moveTo(-o/2,0).lineTo(o/2,0),A=new Path(d,l);super(t,A,g,r);const S=W=>{this.baseColor=W?"rgb( 255, 85, 0 )":"rgb( 0, 179, 0 )",this.setPDOMAttribute("aria-expanded",W)};t.link(S),assert&&((I=(O=phet==null?void 0:phet.chipper)==null?void 0:O.queryParameters)!=null&&I.binder)&&InstanceRegistry.registerDataURL("sun","ExpandCollapseButton",this),this.disposeExpandCollapseButton=()=>{t.unlink(S)}}dispose(){this.disposeExpandCollapseButton(),super.dispose()}}sun.register("ExpandCollapseButton",ExpandCollapseButton);const Ra=class Ra extends Sizable(Node$2){constructor(t,s){var O,I;const r=optionize()({titleNode:null,expandedProperty:null,resize:!0,overrideTitleNodePickable:!0,allowContentToOverlapTitle:!1,cursor:"pointer",lineWidth:1,cornerRadius:10,stroke:"black",fill:"rgb( 238, 238, 238 )",minWidth:0,titleAlignX:"center",titleAlignY:"center",titleXMargin:10,titleYMargin:2,titleXSpacing:5,showTitleWhenExpanded:!0,useExpandedBoundsWhenCollapsed:!0,titleBarExpandCollapse:!0,buttonAlign:"left",buttonXMargin:4,buttonYMargin:2,contentAlign:"center",contentVerticalAlign:"center",contentXMargin:15,contentYMargin:8,contentXSpacing:5,contentYSpacing:8,expandedSoundPlayer:accordionBoxOpenedSoundPlayer,collapsedSoundPlayer:accordionBoxClosedSoundPlayer,tagName:"div",headingTagName:"h3",accessibleNameBehavior:Ra.ACCORDION_BOX_ACCESSIBLE_NAME_BEHAVIOR,voicingNameResponse:null,voicingObjectResponse:null,voicingContextResponse:null,voicingHintResponse:null,tandem:Tandem.REQUIRED,tandemNameSuffix:"AccordionBox",phetioType:Ra.AccordionBoxIO,phetioEventType:EventType.USER,visiblePropertyOptions:{phetioFeatured:!0},titleBarOptions:{fill:null,stroke:null}},s);r.expandCollapseButtonOptions=combineOptions({sideLength:16,cursor:r.cursor,valueOnSoundPlayer:r.expandedSoundPlayer,valueOffSoundPlayer:r.collapsedSoundPlayer,voicingNameResponse:r.voicingNameResponse,voicingObjectResponse:r.voicingObjectResponse,voicingContextResponse:r.voicingContextResponse,voicingHintResponse:r.voicingHintResponse,tandem:r.tandem.createTandem("expandCollapseButton")},r.expandCollapseButtonOptions),super(),this.expandedBoxOutline=null,this.collapsedBoxOutline=null;let o=r.titleNode;o||(o=new Text("",{tandem:r.tandem.createTandem("titleText")}),this.disposeEmitter.addListener(()=>o.dispose())),r.overrideTitleNodePickable&&(o.pickable=!1),this.expandedProperty=r.expandedProperty,this.expandedProperty||(this.expandedProperty=new BooleanProperty(!0,{tandem:r.tandem.createTandem("expandedProperty"),phetioFeatured:!0}),this.disposeEmitter.addListener(()=>this.expandedProperty.dispose())),this.expandCollapseButton=new ExpandCollapseButton(this.expandedProperty,r.expandCollapseButtonOptions),this.disposeEmitter.addListener(()=>this.expandCollapseButton.dispose());const n={fill:r.fill,cornerRadius:r.cornerRadius};this.expandedBox=new Rectangle(n),this.collapsedBox=new Rectangle(n),this.expandedTitleBar=new InteractiveHighlightPath(null,combineOptions({lineWidth:r.lineWidth,cursor:r.cursor},r.titleBarOptions)),this.expandedBox.addChild(this.expandedTitleBar),this.collapsedTitleBar=new InteractiveHighlightRectangle(combineOptions({cornerRadius:r.cornerRadius,cursor:r.cursor},r.titleBarOptions)),this.collapsedBox.addChild(this.collapsedTitleBar),this.disposeEmitter.addListener(()=>{this.collapsedTitleBar.dispose(),this.expandedTitleBar.dispose()}),r.titleBarExpandCollapse?this.collapsedTitleBar.addInputListener({down:()=>{this.expandCollapseButton.isEnabled()&&(this.phetioStartEvent("expanded"),this.expandedProperty.value=!0,r.expandedSoundPlayer.play(),this.phetioEndEvent())}}):(this.expandedTitleBar.interactiveHighlight="invisible",this.collapsedTitleBar.interactiveHighlight="invisible"),r.showTitleWhenExpanded&&r.titleBarExpandCollapse&&this.expandedTitleBar.addInputListener({down:()=>{this.expandCollapseButton.isEnabled()&&(this.phetioStartEvent("collapsed"),r.collapsedSoundPlayer.play(),this.expandedProperty.value=!1,this.phetioEndEvent())}});const l=()=>{const W=this.expandCollapseButton.visible&&this.expandCollapseButton.pickable;this.collapsedTitleBar.pickable=W,this.expandedTitleBar.pickable=W};if(this.expandCollapseButton.visibleProperty.lazyLink(l),this.expandCollapseButton.pickableProperty.lazyLink(l),this.expandCollapseButton.enabledProperty.link(W=>{const L=r.titleBarExpandCollapse&&W;this.collapsedTitleBar.cursor=L&&r.cursor||null,this.expandedTitleBar.cursor=L&&r.cursor||null}),this.expandCollapseButton.setFocusHighlight(new HighlightFromNode$1(this.expandedTitleBar)),this.expandedBox.addChild(t),r.stroke){const W={stroke:r.stroke,lineWidth:r.lineWidth,cornerRadius:r.cornerRadius,pickable:!1};this.expandedBoxOutline=new Rectangle(W),this.expandedBox.addChild(this.expandedBoxOutline),this.collapsedBoxOutline=new Rectangle(W),this.collapsedBox.addChild(this.collapsedBoxOutline)}const h=new Node$2({excludeInvisibleChildrenFromBounds:!r.useExpandedBoundsWhenCollapsed});this.addChild(h);const g=new Node$2({tagName:"div",ariaRole:"region",pdomOrder:[t],ariaLabelledbyAssociations:[{otherNode:this.expandCollapseButton,otherElementName:PDOMPeer$1.PRIMARY_SIBLING,thisElementName:PDOMPeer$1.PRIMARY_SIBLING}]}),d=new Node$2({tagName:r.headingTagName,pdomOrder:[this.expandCollapseButton]}),A=new Node$2({children:[d,g]});this.addChild(A),this.constraint=new AccordionBoxConstraint(this,t,h,this.expandedBox,this.collapsedBox,this.expandedTitleBar,this.collapsedTitleBar,this.expandedBoxOutline,this.collapsedBoxOutline,o,this.expandCollapseButton,r),this.constraint.updateLayout(),this.constraint.enabled=r.resize;const S=()=>{const W=this.expandedProperty.value;this.expandedBox.visible=W,this.collapsedBox.visible=!W,o.visible=W&&r.showTitleWhenExpanded||!W,A.setPDOMAttribute("aria-hidden",!W),this.expandCollapseButton.voicingSpeakFullResponse({hintResponse:null})};this.expandedProperty.link(S),this.disposeEmitter.addListener(()=>this.expandedProperty.unlink(S)),this.mutate(_.omit(r,"cursor")),this.resetAccordionBox=()=>{r.expandedProperty||this.expandedProperty.reset()},assert&&((I=(O=phet==null?void 0:phet.chipper)==null?void 0:O.queryParameters)!=null&&I.binder)&&InstanceRegistry.registerDataURL("sun","AccordionBox",this)}getCollapsedBoxHeight(){const t=this.constraint.lastCollapsedBoxHeight;return assert&&assert(t!==null),t}getExpandedBoxHeight(){const t=this.constraint.lastExpandedBoxHeight;return assert&&assert(t!==null),t}reset(){this.resetAccordionBox()}};Ra.AccordionBoxIO=new IOType("AccordionBoxIO",{valueType:Ra,supertype:Node$2.NodeIO,events:["expanded","collapsed"]}),Ra.ACCORDION_BOX_ACCESSIBLE_NAME_BEHAVIOR=(t,s,r,o)=>(o.push(()=>{t.expandCollapseButton.accessibleName=r}),s);let AccordionBox=Ra;class InteractiveHighlightPath extends InteractiveHighlighting(Path){}class InteractiveHighlightRectangle extends InteractiveHighlighting(Rectangle){}class AccordionBoxConstraint extends LayoutConstraint{constructor(t,s,r,o,n,l,h,g,d,A,S,O){super(t),this.accordionBox=t,this.contentNode=s,this.containerNode=r,this.expandedBox=o,this.collapsedBox=n,this.expandedTitleBar=l,this.collapsedTitleBar=h,this.expandedBoxOutline=g,this.collapsedBoxOutline=d,this.titleNode=A,this.expandCollapseButton=S,this.options=O,this.lastCollapsedBoxHeight=null,this.lastExpandedBoxHeight=null,this.accordionBox.localPreferredWidthProperty.lazyLink(this._updateLayoutListener),this.accordionBox.localPreferredHeightProperty.lazyLink(this._updateLayoutListener),this.accordionBox.expandedProperty.lazyLink(this._updateLayoutListener),this.addNode(s),this.addNode(A)}layout(){super.layout();const t=this.options;if(this.accordionBox.isChildIncludedInLayout(this.contentNode))this.containerNode.children=[this.expandedBox,this.collapsedBox,this.titleNode,this.expandCollapseButton];else{this.containerNode.children=[];return}const r=this.accordionBox.expandedProperty.value||t.useExpandedBoundsWhenCollapsed,o=t.stroke===null?0:t.lineWidth,n=this.createLayoutProxy(this.contentNode),l=this.createLayoutProxy(this.titleNode),h=n.minimumWidth,g=n.minimumHeight,d=l.minimumWidth,A=Math.max(this.expandCollapseButton.height+2*t.buttonYMargin,this.titleNode.height+2*t.titleYMargin),S=t.showTitleWhenExpanded?Math.max((t.allowContentToOverlapTitle?t.contentYMargin:A+t.contentYSpacing)+g+t.contentYMargin,A):Math.max(this.expandCollapseButton.height+2*t.buttonYMargin,g+2*t.contentYMargin);let O=Math.max(t.minWidth,t.buttonXMargin+this.expandCollapseButton.width+t.titleXSpacing+d+t.titleXMargin);t.titleAlignX==="center"&&(O=Math.max(O,(t.buttonXMargin+this.expandCollapseButton.width+t.titleXSpacing)*2+d),O=Math.max(O,t.titleXMargin*2+d)),t.showTitleWhenExpanded?O=Math.max(O,h+2*t.contentXMargin):O=Math.max(O,this.expandCollapseButton.width+h+t.buttonXMargin+t.contentXMargin+t.contentXSpacing);const I=O+o,W=(r?S:A)+o,L=Math.max(I,this.accordionBox.localPreferredWidth||0),H=Math.max(W,this.accordionBox.localPreferredHeight||0),Y=L-o,Q=H-o;this.lastCollapsedBoxHeight=A,r&&(this.lastExpandedBoxHeight=Q),this.collapsedBox.rectWidth=Y,this.collapsedBox.rectHeight=A;const pe=this.collapsedBox.selfBounds;if(this.collapsedTitleBar.rectWidth=Y,this.collapsedTitleBar.rectHeight=A,this.collapsedBoxOutline&&(this.collapsedBoxOutline.rectWidth=Y,this.collapsedBoxOutline.rectHeight=A),r){this.expandedBox.rectWidth=Y,this.expandedBox.rectHeight=Q;const ye=this.expandedBox.selfBounds;this.expandedBoxOutline&&(this.expandedBoxOutline.rectWidth=Y,this.expandedBoxOutline.rectHeight=Q),this.expandedTitleBar.shape=Shape$1.roundedRectangleWithRadii(0,0,Y,A,{topLeft:t.cornerRadius,topRight:t.cornerRadius});let Ee=ye.left+t.contentXMargin,Le=ye.right-t.contentXMargin;t.showTitleWhenExpanded||(t.buttonAlign==="left"?Ee+=this.expandCollapseButton.width+t.contentXSpacing:Le-=this.expandCollapseButton.width+t.contentXSpacing);const Z=Le-Ee,ne=Q-(t.showTitleWhenExpanded&&!t.allowContentToOverlapTitle?A+t.contentYMargin+t.contentYSpacing:2*t.contentYMargin);isWidthSizable(this.contentNode)&&this.accordionBox.localPreferredWidth!==null&&(this.contentNode.preferredWidth=Z),isHeightSizable(this.contentNode)&&this.accordionBox.localPreferredHeight!==null&&(this.contentNode.preferredHeight=ne),t.contentVerticalAlign==="top"?this.contentNode.top=ye.bottom-t.contentYMargin-ne:t.contentVerticalAlign==="bottom"?this.contentNode.bottom=ye.bottom-t.contentYMargin:this.contentNode.centerY=ye.bottom-t.contentYMargin-ne/2,t.contentAlign==="left"?this.contentNode.left=Ee:t.contentAlign==="right"?this.contentNode.right=Le:this.contentNode.centerX=(Ee+Le)/2}let de=pe.left+t.titleXMargin,fe=pe.right-t.titleXMargin;t.buttonAlign==="left"?(this.expandCollapseButton.left=pe.left+t.buttonXMargin,de=this.expandCollapseButton.right+t.titleXSpacing):(this.expandCollapseButton.right=pe.right-t.buttonXMargin,fe=this.expandCollapseButton.left-t.titleXSpacing),isWidthSizable(this.titleNode)&&(this.titleNode.preferredWidth=fe-de),t.titleAlignX==="left"?this.titleNode.left=de:t.titleAlignX==="right"?this.titleNode.right=fe:this.titleNode.centerX=pe.centerX,t.titleAlignY==="top"?(this.expandCollapseButton.top=this.collapsedBox.top+Math.max(t.buttonYMargin,t.titleYMargin),this.titleNode.top=this.expandCollapseButton.top):(this.expandCollapseButton.centerY=this.collapsedBox.centerY,this.titleNode.centerY=this.expandCollapseButton.centerY),n.dispose(),l.dispose(),this.accordionBox.localMinimumWidth=I,this.accordionBox.localMinimumHeight=W}dispose(){this.accordionBox.localPreferredWidthProperty.unlink(this._updateLayoutListener),this.accordionBox.localPreferredHeightProperty.unlink(this._updateLayoutListener),this.accordionBox.expandedProperty.unlink(this._updateLayoutListener),super.dispose()}}sun.register("AccordionBox",AccordionBox);const soundURI$9="data:audio/mpeg;base64,//tQxAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAAFAAAE5AAzMzMzMzMzMzMzMzMzMzMzMzMzZmZmZmZmZmZmZmZmZmZmZmZmZmaZmZmZmZmZmZmZmZmZmZmZmZmZmczMzMzMzMzMzMzMzMzMzMzMzMzM//////////////////////////8AAAA5TEFNRTMuOTlyAaUAAAAAAAAAABRAJAZmQgAAQAAABOTGvClKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/7UMQAAAjxrv+ggLoZGTXh9oJQAa222FG3ASABBG51MY/j4AAB4AYI3/H3//Pqd/zv0Jp/8//zn3n6Mmf/J7f//8jf+fOeeggHA4RXkGh8XEwHAMHD4udyCYuhAALhgJqWJAEDGMYxvHlyAHxc9P76dP//T/Rm//p+v9tvb0Tzr1XyfnelP/3b0//5vo86Mlm0dHQrscccRQg5oSYpziaiB52oQCkxnR6LQisRCEMhluyeqEhIiWMiSvQjhwDTCtCPyDkNrP+UsBTNwVsJGSD/+1LEFoAQMWtluYaQEWGP7H+wYAR9IvpDLBawV8OWbG5oShmbiVnh8GAU6ZIjnetMKuOcpmaSndX80HuS7puaIKq/6lvM36lIJf8+Zm6CFA0t3fV/91IOhPJ1GCH13q//5o6DJl9/F3ErtwAGRlJ26tx4H5gV4lzzrIqy8jTNBZl1Hep3doI2/x6AMOljV5/M4clzeagOVs4SmnmZk2fTyahylhxZ1R7/1HlnhEe4KgF3SISoKnviYs9T8sp4Ku5ICsAAg3RwNdct5GVqea2W4P/7UsQHgAuZRzrtmE8JO4qkaa4M4MXAzUcoyYPSsZe/D4w5DUicEmE/ziQka1VaLTh0y8+qp/UtRMpQoli5jYCz6St//RjTOrPXlI/KJaZ2RHX6mMrJqxfqVjPM/K/thi6pyAAPlyOxkEr9tPgR2ldNwBRI0383ZJR5NmIAG2zBZOw1tKaJR6jzjIxgTlVLjBgJmawwRo8JXAUYCz1gr/q+aVWur8tO+j4iUe////6ii3UCwZHQhxd93nYdy9H1MjPwThY/VGgQQLo200aOkCDF//tSxA+CCwg1HK3lIQHXlCPo97AIw8D44EBOcB8oGBIND4gcCBc+IFHC7wwUOA+oMiAaH1PDCw+mxbydxPV3/zjbCnci8p/9nIJTQYSH5vktZIAEdHIA5HkiS4k11MYsCUFS8QSbEVhJUnQlFpKIJNQhJJrBKEZ8kiKoJIkqToSj5KJJ6hiCTXCUJUZJEl45Ek9TCUfQkkyuSSbzS72V1mVruLnhMeBUsHREPDQiPA0VOiJwdKuBlR5Fqtbk3f///t8FdSogAuxJp2uAWhIWFmv/+1LEBgPGHADHoIhgIAAANIAAAATcLVLFRWKCwsLCyxUVFVf6xVmLCws1YqKior////2RVn/+LCwtTEFNRTMuOTkuM1VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQ==",soundByteArray$9=base64SoundToByteArray(phetAudioContext$1,soundURI$9),unlock$9=asyncLoader.createLock(soundURI$9),wrappedAudioBuffer$9=new WrappedAudioBuffer;let unlocked$9=!1;const safeUnlock$9=()=>{unlocked$9||(unlock$9(),unlocked$9=!0)},onDecodeSuccess$9=a=>{wrappedAudioBuffer$9.audioBufferProperty.value===null&&(wrappedAudioBuffer$9.audioBufferProperty.set(a),safeUnlock$9())},onDecodeError$9=a=>{console.warn("decode of audio data failed, using stubbed sound, error: "+a),wrappedAudioBuffer$9.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$9()},decodePromise$9=phetAudioContext$1.decodeAudioData(soundByteArray$9.buffer,onDecodeSuccess$9,onDecodeError$9);decodePromise$9&&decodePromise$9.then(a=>{wrappedAudioBuffer$9.audioBufferProperty.value===null&&(wrappedAudioBuffer$9.audioBufferProperty.set(a),safeUnlock$9())}).catch(a=>{console.warn("promise rejection caught for audio decode, error = "+a),safeUnlock$9()});class MultiSelectionSoundPlayerFactory{constructor(){this._basisSoundClip=null,this.soundPlayers=[]}getSoundClipInstance(){return this._basisSoundClip||(this._basisSoundClip=new SoundClip(wrappedAudioBuffer$9,{initialOutputLevel:.7,rateChangesAffectPlayingSounds:!1}),soundManager.addSoundGenerator(this._basisSoundClip,{categoryName:"user-interface"})),this._basisSoundClip}getSelectionSoundPlayer(t){if(!this.soundPlayers[t]){const s=Math.pow(2,-t/12);this.soundPlayers[t]=new FixedSpeedSoundClipPlayer(this.getSoundClipInstance(),s)}return this.soundPlayers[t]}}class FixedSpeedSoundClipPlayer{constructor(t,s){this.soundPlayer=t,this.playbackRate=s}play(){this.soundPlayer.setPlaybackRate(this.playbackRate),this.soundPlayer.play()}stop(){this.soundPlayer.stop()}}const multiSelectionSoundPlayerFactory=new MultiSelectionSoundPlayerFactory;tambo.register("multiSelectionSoundPlayerFactory",multiSelectionSoundPlayerFactory);const Gh=class Gh extends WidthSizable(Voicing(Node$2)){constructor(t,s,r,o){var de,fe;const n=optionize()({centerColor:"black",radius:Gh.DEFAULT_RADIUS,selectedColor:"rgb( 143, 197, 250 )",deselectedColor:"white",xSpacing:8,stroke:"black",soundPlayer:multiSelectionSoundPlayerFactory.getSelectionSoundPlayer(0),a11yNameAttribute:null,touchAreaXDilation:0,touchAreaYDilation:0,mouseAreaXDilation:0,mouseAreaYDilation:0,cursor:"pointer",disabledOpacity:SceneryConstants.DISABLED_OPACITY,tandem:Tandem.REQUIRED,tandemNameSuffix:"RadioButton",visiblePropertyOptions:{phetioFeatured:!0},phetioEnabledPropertyInstrumented:!0,tagName:"input",inputType:"radio",containerTagName:"li",labelTagName:"label",appendLabel:!0,appendDescription:!0},o);super(),this.onInputEmitter=new Emitter,this._isMouseAreaCustomized=!1,this._isTouchAreaCustomized=!1,this._isSettingAreas=!1,this.value=s;const l=new Node$2,h=new Circle(n.radius/3,{fill:n.centerColor}),g=new Circle(n.radius,{fill:n.selectedColor,stroke:n.stroke}),d=new Node$2({children:[g,h]});l.addChild(d);const A=new Node$2,S=new Circle(n.radius,{fill:n.deselectedColor,stroke:n.stroke});A.addChild(S);const O=new Node$2({children:[l,A],pickable:!1}),I=()=>{r.left=S.right+n.xSpacing,r.centerY=S.centerY};r.boundsProperty.link(I);const W=new Rectangle({});l.pickable=A.pickable=!1,r.pickable=!1,this.children=[O,r,W],this.constraint=new AquaRadioButtonConstraint(this,O,r,W,n),this.constraint.updateLayout();const L=ye=>{l.visible=ye===s,A.visible=!l.visible};t.link(L);const H=()=>{const ye=t.value;t.set(s),ye!==t.value&&this.onInputEmitter.emit()},Y=new FireListener({fire:H,tandem:n.tandem.createTandem("fireListener")});this.addInputListener(Y),this.onInputEmitter.addListener(()=>n.soundPlayer.play());const Q={change:H};this.addInputListener(Q),t.value===s&&this.setPDOMAttribute("checked","checked");const pe=ye=>{this.pdomChecked=ye===s};t.link(pe),n.a11yNameAttribute!==null&&this.setPDOMAttribute("name",n.a11yNameAttribute),this.mutate(n),this.disposeAquaRadioButton=()=>{this.constraint.dispose(),this.onInputEmitter.dispose(),this.removeInputListener(Y),this.removeInputListener(Q),t.unlink(pe),t.unlink(L),r.boundsProperty.hasListener(I)&&r.boundsProperty.unlink(I),Y.dispose()},assert&&((fe=(de=phet==null?void 0:phet.chipper)==null?void 0:de.queryParameters)!=null&&fe.binder)&&InstanceRegistry.registerDataURL("sun","AquaRadioButton",this)}dispose(){this.disposeAquaRadioButton(),super.dispose()}};Gh.DEFAULT_RADIUS=7;let AquaRadioButton=Gh;class AquaRadioButtonConstraint extends LayoutConstraint{constructor(t,s,r,o,n){super(t),this.radioButton=t,this.radioNode=s,this.content=r,this.rectangle=o,this.options=n,this.radioButton.localPreferredWidthProperty.lazyLink(this._updateLayoutListener),this.addNode(r)}layout(){super.layout();const t=this.createLayoutProxy(this.content),s=t.minimumWidth,r=this.radioNode.width+this.options.xSpacing+s,o=Math.max(r,this.radioButton.localPreferredWidth||0);isWidthSizable(this.content)&&(t.preferredWidth=o-this.radioNode.width-this.options.xSpacing),t.left=this.radioNode.right+this.options.xSpacing,t.centerY=this.radioNode.centerY,this.rectangle.rectBounds=this.radioNode.bounds.union(t.bounds).withMaxX(Math.max(this.radioNode.left+o,t.right)),this.radioButton._isSettingAreas=!0,this.radioButton._isTouchAreaCustomized||(this.radioButton.touchArea=this.radioButton.localBounds.dilatedXY(this.options.touchAreaXDilation,this.options.touchAreaYDilation)),this.radioButton._isMouseAreaCustomized||(this.radioButton.mouseArea=this.radioButton.localBounds.dilatedXY(this.options.mouseAreaXDilation,this.options.mouseAreaYDilation)),this.radioButton._isSettingAreas=!1,t.dispose(),this.radioButton.localMinimumWidth=r}dispose(){this.radioButton.localPreferredWidthProperty.unlink(this._updateLayoutListener),super.dispose()}}sun.register("AquaRadioButton",AquaRadioButton);let instanceCount$1=0;const CLASS_NAME$1="AquaRadioButtonGroup";class AquaRadioButtonGroup extends FlowBox{constructor(t,s,r){instanceCount$1++;const o=optionize()({touchAreaXDilation:0,touchAreaYDilation:0,mouseAreaXDilation:0,mouseAreaYDilation:0,orientation:"vertical",spacing:3,stretch:!0,disabledOpacity:SceneryConstants.DISABLED_OPACITY,tandem:Tandem.REQUIRED,tandemNameSuffix:"RadioButtonGroup",visiblePropertyOptions:{phetioFeatured:!0},phetioEnabledPropertyInstrumented:!0,phetioFeatured:!0,tagName:"ul",labelTagName:"h3",ariaRole:"radiogroup",groupFocusHighlight:!0},r),n=getGroupItemNodes(s,o.tandem);o.orientation==="vertical"&&(o.align=o.align||"left");const l=s.map((d,A)=>{assert&&assert(!d.tandem,"Cannot specify tandem any more");const S=n[A];return assert&&assert(!S.hasPDOMContent,"Accessibility is provided by AquaRadioButton and AquaRadioButtonGroupItem.labelContent. Additional PDOM content in the provided Node could break accessibility."),new AquaRadioButton(t,d.value,S,combineOptions({a11yNameAttribute:CLASS_NAME$1+instanceCount$1,labelContent:d.labelContent||null,soundPlayer:multiSelectionSoundPlayerFactory.getSelectionSoundPlayer(A),tandem:d.tandemName?o.tandem.createTandem(d.tandemName):o.tandem===Tandem.OPT_OUT?Tandem.OPT_OUT:Tandem.REQUIRED,touchAreaXDilation:o.orientation==="horizontal"?o.spacing/2:o.touchAreaXDilation,touchAreaYDilation:o.orientation==="vertical"?o.spacing/2:o.touchAreaYDilation,mouseAreaXDilation:o.orientation==="horizontal"?o.spacing/2:o.mouseAreaXDilation,mouseAreaYDilation:o.orientation==="vertical"?o.spacing/2:o.mouseAreaYDilation},o.radioButtonOptions,d.options))});o.children=l,super(o),this.onInputEmitter=new Emitter,this.addAriaLabelledbyAssociation({thisElementName:PDOMPeer$1.PRIMARY_SIBLING,otherNode:this,otherElementName:PDOMPeer$1.LABEL_SIBLING});const h=new KeyboardListener({keys:["arrowLeft","arrowRight","arrowUp","arrowDown"],callback:d=>{d&&d.pointer.reserveForKeyboardDrag()}});this.addInputListener(h);const g=this.onRadioButtonInput.bind(this);for(let d=0;d<l.length;d++)l[d].onInputEmitter.addListener(g);this.addLinkedElement(t,{tandemName:"property"}),this.disposeAquaRadioButtonGroup=()=>{this.removeInputListener(h),h.dispose(),l.forEach(d=>d.dispose()),this.onInputEmitter.dispose(),n.forEach(d=>d.dispose())},this.radioButtons=l}onRadioButtonInput(){this.onInputEmitter.emit()}dispose(){this.disposeAquaRadioButtonGroup(),super.dispose()}getButton(t){const s=_.find(this.radioButtons,r=>r.value===t);return assert&&assert(s,`no radio button found for value ${t}`),s}}sun.register("AquaRadioButtonGroup",AquaRadioButtonGroup);const soundURI$8="data:audio/mpeg;base64,//swxAAABlAhPLTAgDE1De+/HoACAH4CwkCAJDo5gDgPRksn2WLHOB8EHShd5cHwfBBwgBBOJw/UCAY/lAxWD/4DB9+CH/6XQjMTIIcYUIQPQIRAIBAACUIawkYq7IQ/BawVqEc7mTjD+OFygBAnHbHq7UkLJ8aCnnrZlPpg3IkRJBgPH/MCQCI985/yAnHAAhmv3lHuAgAgAxJF//syxAOACHQpa7zBAAD8EunxpI3HUCEZHQlA2EYuDsSjE5EkSQGhUDYDxOARLoiBmIgalVgq4qWeWBqsNYKywNO+p/sxFyKwVOlXRFDtZ0S86oQ0C2W+wBOmlaWuS6+BIqZMz+AYy3FuwBkKXM2idVoKlYwUd/oIGgsbLpEbaCsmIyZRtbw6TPwj+mYmGr8QqnGHBLo3LKAAxKabZ//7MsQGAAhsl1OsPMcxAo3mpbCaAvIuuQRmW4WNHhDBJnoBORIlh+I9dvGCTCKP0kzo7rHHTi87diQ2XqnRN77y8lnKUl8zf+X0Fu0iCDV/9AP7el8Cw8raZKqiYShe+6bzYk0zXmEuGnBDcQhyRzPeI4Jbsmj5OxzZVhSX9adVU4Kk9r9esE3etv+/6wUIg3Wm62nA3Ab0EIcLUQ7/+zLECABGICs9oemDMLwEZrQcvFYyDBCUCgUAwQCUSvgROof5poGn9O7o70P/X9P/T+360+lAhIJVtyuNDljXzM7Ek0fGUB/ltZQF8iD7dBcVTs00f31POqR0/V/q/pjEe1z3jyAAQRBHGmSBEEVK6QIYH2miQZKNfgCVtiH9vVLp+w7an/d0jdUx9VnqZIJSvFtsaUFKKFBVCzoe//swxBwABSAhLaDl4nCsA+a0fDyG3vbgKx5OhNXyuPYt7kJJSg9B6heqxP93q/9P6IwSQ8LbYIFBVUF85RwseJPX6+Q7qIq7f/8ayokh7P//V8oyAABbhbGEIBBhOJgEGTBx6KjUiosS54l6y0i3jOz/6f///RVMQU1FMy45OS41VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//syxDWABEQTMaCF4HCNAmL0EJgGVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQ==",soundByteArray$8=base64SoundToByteArray(phetAudioContext$1,soundURI$8),unlock$8=asyncLoader.createLock(soundURI$8),wrappedAudioBuffer$8=new WrappedAudioBuffer;let unlocked$8=!1;const safeUnlock$8=()=>{unlocked$8||(unlock$8(),unlocked$8=!0)},onDecodeSuccess$8=a=>{wrappedAudioBuffer$8.audioBufferProperty.value===null&&(wrappedAudioBuffer$8.audioBufferProperty.set(a),safeUnlock$8())},onDecodeError$8=a=>{console.warn("decode of audio data failed, using stubbed sound, error: "+a),wrappedAudioBuffer$8.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$8()},decodePromise$8=phetAudioContext$1.decodeAudioData(soundByteArray$8.buffer,onDecodeSuccess$8,onDecodeError$8);decodePromise$8&&decodePromise$8.then(a=>{wrappedAudioBuffer$8.audioBufferProperty.value===null&&(wrappedAudioBuffer$8.audioBufferProperty.set(a),safeUnlock$8())}).catch(a=>{console.warn("promise rejection caught for audio decode, error = "+a),safeUnlock$8()});const pushButtonSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$8,{soundClipOptions:{initialOutputLevel:.5},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("pushButtonSoundPlayer",pushButtonSoundPlayer);const twixt=new Namespace("twixt"),es=class es{constructor(t,s,r){this.value=t,this.derivative=s,this.secondDerivative=r}static polynomialEaseInValue(t,s){return assert&&assert(tIsValid(s),`invalid t: ${s}`),Math.pow(s,t)}static polynomialEaseOutValue(t,s){return assert&&assert(tIsValid(s),`invalid t: ${s}`),1-Math.pow(1-s,t)}static polynomialEaseInOutValue(t,s){return assert&&assert(tIsValid(s),`invalid t: ${s}`),s<=.5?.5*Math.pow(2*s,t):1-es.polynomialEaseInOutValue(t,1-s)}static polynomialEaseInDerivative(t,s){return assert&&assert(tIsValid(s),`invalid t: ${s}`),t*Math.pow(s,t-1)}static polynomialEaseOutDerivative(t,s){return assert&&assert(tIsValid(s),`invalid t: ${s}`),t*Math.pow(1-s,t-1)}static polynomialEaseInOutDerivative(t,s){return assert&&assert(tIsValid(s),`invalid t: ${s}`),s<=.5?Math.pow(2,t-1)*t*Math.pow(s,t-1):es.polynomialEaseInOutDerivative(t,1-s)}static polynomialEaseInSecondDerivative(t,s){return assert&&assert(tIsValid(s),`invalid t: ${s}`),(t-1)*t*Math.pow(s,t-2)}static polynomialEaseOutSecondDerivative(t,s){return assert&&assert(tIsValid(s),`invalid t: ${s}`),-(t-1)*t*Math.pow(1-s,t-2)}static polynomialEaseInOutSecondDerivative(t,s){return assert&&assert(tIsValid(s),`invalid t: ${s}`),s<=.5?Math.pow(2,t-1)*(t-1)*t*Math.pow(s,t-2):-es.polynomialEaseInOutSecondDerivative(t,1-s)}static polynomialEaseIn(t){return new es(es.polynomialEaseInValue.bind(null,t),es.polynomialEaseInDerivative.bind(null,t),es.polynomialEaseInSecondDerivative.bind(null,t))}static polynomialEaseOut(t){return new es(es.polynomialEaseOutValue.bind(null,t),es.polynomialEaseOutDerivative.bind(null,t),es.polynomialEaseOutSecondDerivative.bind(null,t))}static polynomialEaseInOut(t){return new es(es.polynomialEaseInOutValue.bind(null,t),es.polynomialEaseInOutDerivative.bind(null,t),es.polynomialEaseInOutSecondDerivative.bind(null,t))}};es.LINEAR=es.polynomialEaseIn(1),es.QUADRATIC_IN=es.polynomialEaseIn(2),es.QUADRATIC_OUT=es.polynomialEaseOut(2),es.QUADRATIC_IN_OUT=es.polynomialEaseInOut(2),es.CUBIC_IN=es.polynomialEaseIn(3),es.CUBIC_OUT=es.polynomialEaseOut(3),es.CUBIC_IN_OUT=es.polynomialEaseInOut(3),es.QUARTIC_IN=es.polynomialEaseIn(4),es.QUARTIC_OUT=es.polynomialEaseOut(4),es.QUARTIC_IN_OUT=es.polynomialEaseInOut(4),es.QUINTIC_IN=es.polynomialEaseIn(5),es.QUINTIC_OUT=es.polynomialEaseOut(5),es.QUINTIC_IN_OUT=es.polynomialEaseInOut(5);let Easing=es;function tIsValid(a){return typeof a=="number"&&isFinite(a)&&a>=0&&a<=1}twixt.register("Easing",Easing);class AnimationTarget{constructor(t){this.startingValue=null,this.endingValue=null;const s=optionize()({setValue:null,getValue:null,property:null,object:null,attribute:null,to:null,delta:null,speed:null,from:null,easing:Easing.CUBIC_IN_OUT,blend:AnimationTarget.DEFAULT_BLEND,distance:AnimationTarget.DEFAULT_DISTANCE,add:AnimationTarget.DEFAULT_ADD},t);assert&&assert(+(s.property!==null)+ +(s.object!==null)+ +(s.setValue!==null)==1,"Should have one (and only one) way of defining how to set the animated value. Use one of property/object/setValue"),assert&&assert(s.setValue===null||typeof s.setValue=="function","If setValue is provided, it should be a function."),assert&&assert(s.setValue===null||s.from!==null||typeof s.getValue=="function",'If setValue is provided and no "from" value is specified, then getValue needs to be a function.'),assert&&assert(s.to!==null||s.delta!==null,"Need something to animate to, use to/delta"),assert&&assert(s.property===null||isTReadOnlyProperty(s.property)&&s.property.isSettable(),"If property is provided, it should be a settable Property or TinyProperty"),assert&&assert(s.object===null||typeof s.object=="object"&&typeof s.attribute=="string","If object is provided, then object should be an object, and attribute should be a string."),assert&&assert(s.easing instanceof Easing,"The easing should be of type Easing"),assert&&assert(typeof s.blend=="function","The blend option should be a function"),assert&&assert(typeof s.distance=="function","The distance option should be a function"),assert&&assert(typeof s.add=="function","The add option should be a function"),s.object&&(assert&&assert(s.attribute!==null),s.setValue=AnimationTarget.OBJECT_SET(s.object,s.attribute),s.getValue=AnimationTarget.OBJECT_GET(s.object,s.attribute)),s.property&&(s.setValue=AnimationTarget.PROPERTY_SET(s.property),s.getValue=AnimationTarget.PROPERTY_GET(s.property)),assert&&assert(s.setValue!==null),this.getValue=s.getValue,this.setValue=s.setValue,this.easing=s.easing,this.from=s.from,this.to=s.to,this.delta=s.delta,this.speed=s.speed,this.blend=s.blend,this.distance=s.distance,this.add=s.add}static DEFAULT_BLEND(t,s,r){if(assert&&assert(isFinite(r)&&r>=0&&r<=1,`Invalid ratio: ${r}`),r===0)return t;if(r===1)return s;if(typeof t=="number"&&typeof s=="number")return t+(s-t)*r;if(typeof t=="object"&&typeof s=="object"&&typeof t.blend=="function")return t.blend(s,r);throw new Error(`Blending not supported for: ${JSON.stringify(t)}, ${JSON.stringify(s)}, pass in a blend option`)}static DEFAULT_DISTANCE(t,s){if(typeof t=="number"&&typeof s=="number")return Math.abs(t-s);if(typeof t=="object"&&typeof s=="object"&&typeof t.distance=="function")return t.distance(s);throw new Error(`Distance (required for speed) by default not supported for: ${JSON.stringify(t)}, ${JSON.stringify(s)}, pass in a distance option`)}static DEFAULT_ADD(t,s){if(typeof t=="number"&&typeof s=="number")return t+s;if(typeof t=="object"&&typeof s=="object"&&typeof t.plus=="function")return t.plus(s);throw new Error(`Addition (required for delta) by default not supported for: ${JSON.stringify(t)}, ${JSON.stringify(s)}, pass in an add option`)}static OBJECT_SET(t,s){return function(r){t[s]=r}}static OBJECT_GET(t,s){return function(){return t[s]}}static PROPERTY_SET(t){return function(s){t.value=s}}static PROPERTY_GET(t){return function(){return t.value}}computeStartEnd(){assert&&assert(this.to!==null||this.delta!==null),assert&&assert(this.from!==null||this.getValue!==null),this.startingValue=this.from!==null?this.from:this.getValue(),this.endingValue=this.to!==null?this.to:this.add(this.startingValue,this.delta)}update(t){assert&&assert(this.setValue!==null),assert&&assert(this.startingValue!==null),assert&&assert(this.endingValue!==null),this.setValue(this.blend(this.startingValue,this.endingValue,this.easing.value(t)))}hasPreferredDuration(){return this.speed!==null}getPreferredDuration(){return assert&&assert(this.startingValue!==null),assert&&assert(this.delta!==null),this.speed===null?null:this.speed*this.distance(this.startingValue,this.delta)}}twixt.register("AnimationTarget",AnimationTarget);class Animation extends Disposable{constructor(t){const s=optionize()({targets:null,duration:null,delay:0,stepEmitter:stepTimer},t);assert&&assert(+(s.property!==void 0)+ +(s.object!==void 0)+ +(s.setValue!==void 0)+ +(s.targets!==null)==1,"Should have one (and only one) way of defining how to set the animated value. Use one of property/object/setValue/targets"),assert&&assert(typeof s.delay=="number"&&isFinite(s.delay)&&s.delay>=0,"The delay should be a non-negative number."),assert&&assert(s.stepEmitter===null||s.stepEmitter instanceof Emitter||s.stepEmitter instanceof TinyEmitter,"stepEmitter must be null or an (Tiny)Emitter"),super(s),this.length=0,this.remainingDelay=0,this.remainingAnimation=0,this.runningProperty=new BooleanProperty(!1),this.animatingProperty=new BooleanProperty(!1),this.startEmitter=new Emitter,this.beginEmitter=new Emitter,this.finishEmitter=new Emitter({parameters:[{valueType:"number"}]}),this.stopEmitter=new Emitter,this.endedEmitter=new Emitter({hasListenerOrderDependencies:!0}),this.updateEmitter=new Emitter,this.targets=(s.targets===null?[s]:s.targets).map(o=>new AnimationTarget(o)),assert&&assert(+(s.duration!==null)+_.sum(_.map(this.targets,o=>o.hasPreferredDuration()?1:0))===1,"Exactly one duration/speed option should be used."),this.duration=s.duration,this.delay=s.delay;const r=s.stepEmitter;if(r){const o=this.step.bind(this);this.runningProperty.link(n=>{n&&!r.hasListener(o)?r.addListener(o):!n&&r.hasListener(o)&&r.removeListener(o)}),this.disposeEmitter.addListener(()=>{r.hasListener(o)&&r.removeListener(o)})}}start(t){return this.runningProperty.value?this:(this.remainingDelay=this.delay,this.runningProperty.value=!0,this.startEmitter.emit(),this.step(t!==void 0?t:0),this)}stop(){return this.runningProperty.value?(this.runningProperty.value=!1,this.stopEmitter.emit(),this.endedEmitter.emit(),this):this}step(t){if(!this.runningProperty.value)return this;if(!this.animatingProperty.value){if(this.remainingDelay-=t,t=-this.remainingDelay,this.remainingDelay>0)return this;this.length=this.duration;for(let r=0;r<this.targets.length;r++){const o=this.targets[r];o.computeStartEnd(),this.length===null&&(this.length=o.getPreferredDuration())}assert&&assert(this.length!==null,"After going through the targets, we should have a length by now"),this.remainingAnimation=this.length,this.animatingProperty.value=!0,this.beginEmitter.emit()}this.remainingAnimation-=t,t=-this.remainingAnimation,assert&&assert(this.length!==null);const s=this.length>0?DotUtils.clamp((this.length-this.remainingAnimation)/this.length,0,1):1;for(let r=0;r<this.targets.length;r++)this.targets[r].update(s);return this.updateEmitter.emit(),s===1&&(this.animatingProperty.value=!1,this.runningProperty.value=!1,this.finishEmitter.emit(t),this.endedEmitter.emit()),this}then(t){return this.finishEmitter.addListener(s=>t.start(s)),t}dispose(){this.runningProperty.dispose(),this.animatingProperty.dispose(),this.startEmitter.dispose(),this.beginEmitter.dispose(),this.finishEmitter.dispose(),this.stopEmitter.dispose(),this.endedEmitter.dispose(),this.updateEmitter.dispose(),super.dispose()}}twixt.register("Animation",Animation);class PushButtonInteractionStateProperty extends DerivedProperty4{constructor(t){super([t.focusedProperty,t.overProperty,t.looksOverProperty,t.looksPressedProperty],(s,r,o,n)=>o&&!n?ButtonInteractionState.OVER:(r||s)&&n?ButtonInteractionState.PRESSED:ButtonInteractionState.IDLE,{valueType:ButtonInteractionState})}}sun.register("PushButtonInteractionStateProperty",PushButtonInteractionStateProperty);class PushButtonModel extends ButtonModel{constructor(t){const s=optionize()({fireOnDown:!1,listener:null,interruptListener:null,fireOnHold:!1,fireOnHoldDelay:400,fireOnHoldInterval:100,tandem:Tandem.REQUIRED,phetioReadOnly:PhetioObject.DEFAULT_OPTIONS.phetioReadOnly},t);super(s),this.startEvent=null,this.isFiringProperty=new BooleanProperty(!1),this.firedEmitter=new Emitter({tandem:s.tandem.createTandem("firedEmitter"),phetioDocumentation:"Emits when the button is fired",phetioReadOnly:s.phetioReadOnly,phetioEventType:EventType.USER,hasListenerOrderDependencies:!0}),s.interruptListener&&this.firedEmitter.addListener(()=>{s.interruptListener(this.startEvent)}),s.listener!==null&&this.firedEmitter.addListener(s.listener),s.fireOnHold&&(this.timer=new CallbackTimer({callback:this.fire.bind(this),delay:s.fireOnHoldDelay,interval:s.fireOnHoldInterval}));const r=n=>{var l,h,g;if(n)this.enabledProperty.get()&&(this.startEvent=((g=(h=(l=phet==null?void 0:phet.joist)==null?void 0:l.display)==null?void 0:h._input)==null?void 0:g.currentSceneryEvent)||null,s.fireOnDown&&this.fire(),this.timer&&this.timer.start(),(s.fireOnDown||this.timer)&&this.produceSoundEmitter.emit());else{const d=!s.fireOnDown&&(this.overProperty.get()||this.focusedProperty.get())&&this.enabledProperty.get()&&!this.interrupted;this.timer?this.timer.stop(d):d&&(this.produceSoundEmitter.emit(),this.fire())}};this.downProperty.link(r);const o=n=>{!n&&this.timer&&this.timer.stop(!1)};this.enabledProperty.link(o),this.disposePushButtonModel=()=>{this.isFiringProperty.value=!1,this.isFiringProperty.dispose(),this.firedEmitter.dispose(),this.downProperty.unlink(r),this.enabledProperty.unlink(o),this.timer&&(this.timer.dispose(),this.timer=null)}}dispose(){this.disposePushButtonModel(),super.dispose()}addListener(t){this.firedEmitter.addListener(t)}removeListener(t){this.firedEmitter.removeListener(t)}fire(){assert&&assert(!this.isFiringProperty.value,"Cannot fire when already firing"),this.isFiringProperty.value=!0,this.firedEmitter.emit(),this.isFiringProperty.value=!1}}sun.register("PushButtonModel",PushButtonModel);class RectangularPushButton extends RectangularButton{constructor(t){var h,g;const s=optionize()({soundPlayer:pushButtonSoundPlayer,tandem:Tandem.REQUIRED},t),r=s.listener,o=_.omit(s,["listener"]),n=new PushButtonModel(o);super(n,new PushButtonInteractionStateProperty(n),o),this.pushButtonModel=n,r&&this.addListener(r);const l=()=>{s.soundPlayer.play()};n.produceSoundEmitter.addListener(l),this.disposeRectangularPushButton=function(){n.produceSoundEmitter.removeListener(l),n.dispose()},assert&&((g=(h=phet==null?void 0:phet.chipper)==null?void 0:h.queryParameters)!=null&&g.binder)&&InstanceRegistry.registerDataURL("sun","RectangularPushButton",this)}dispose(){super.dispose(),this.disposeRectangularPushButton()}addListener(t){this.pushButtonModel.addListener(t)}removeListener(t){this.pushButtonModel.removeListener(t)}}sun.register("RectangularPushButton",RectangularPushButton);const ANGLES={up:0,down:Math.PI,left:-Math.PI/2,right:Math.PI/2};class CarouselButton extends RectangularPushButton{constructor(t){const s=optionize()({arrowDirection:"up",arrowSize:new Dimension2(20,7),arrowPathOptions:{stroke:"black",lineWidth:3,lineCap:"round"},baseColor:"rgba( 200, 200, 200, 0.5 )",buttonAppearanceStrategy:ButtonNode.FlatAppearanceStrategy,cornerRadius:4},t);let r=null;s.stroke===void 0&&(r=new PaintColorProperty(s.baseColor,{luminanceFactor:-.8}),s.stroke=r),assert&&assert(ANGLES.hasOwnProperty(s.arrowDirection),`invalid direction: ${s.arrowDirection}`);let o=new Shape$1().moveTo(0,0).lineTo(s.arrowSize.width/2,-s.arrowSize.height).lineTo(s.arrowSize.width,0);o=o.transformed(Matrix3.rotation2(ANGLES[s.arrowDirection])),s.content=new Path(o,s.arrowPathOptions);const n=s.arrowDirection,l=s.cornerRadius;if(s.leftTopCornerRadius=n==="up"||n==="left"?l:0,s.rightTopCornerRadius=n==="up"||n==="right"?l:0,s.leftBottomCornerRadius=n==="down"||n==="left"?l:0,s.rightBottomCornerRadius=n==="down"||n==="right"?l:0,n==="up"||n==="down"){const h=s.mouseAreaYDilation/2||0,g=s.touchAreaYDilation/2||0;s.mouseAreaYDilation=h,s.touchAreaYDilation=g,s.mouseAreaYShift=n==="up"?-h:h,s.touchAreaYShift=n==="up"?-g:g}else{const h=s.mouseAreaXDilation/2||0,g=s.touchAreaXDilation/2||0;s.mouseAreaXDilation=h,s.touchAreaXDilation=g,s.mouseAreaXShift=n==="left"?-h:h,s.touchAreaXShift=n==="left"?-g:g}super(s),this.customStrokeProperty=r}dispose(){this.customStrokeProperty&&this.customStrokeProperty.dispose(),super.dispose()}}sun.register("CarouselButton",CarouselButton);const DEFAULT_ARROW_SIZE=new Dimension2(20,7);class Carousel extends Node$2{constructor(t,s){var fe,ye;let r=!1;const o=optionize()({orientation:"horizontal",fill:"white",stroke:"black",lineWidth:1,cornerRadius:4,defaultPageNumber:0,itemsPerPage:4,spacing:12,margin:6,alignBoxOptions:{phetioType:IndexedNodeIO,phetioState:!0,visiblePropertyOptions:{phetioFeatured:!0}},buttonOptions:{xMargin:5,yMargin:5,touchAreaXDilation:0,touchAreaYDilation:0,mouseAreaXDilation:0,mouseAreaYDilation:0,baseColor:"rgba( 200, 200, 200, 0.5 )",disabledColor:ColorConstants.LIGHT_GRAY,lineWidth:1,arrowPathOptions:{stroke:"black",lineWidth:3},arrowSize:DEFAULT_ARROW_SIZE,enabledPropertyOptions:{phetioReadOnly:!0,phetioFeatured:!1},soundPlayer:pushButtonSoundPlayer},separatorsVisible:!1,separatorOptions:{stroke:"rgb( 180, 180, 180 )",lineWidth:.5,pickable:!1},animationEnabled:!0,animationOptions:{duration:.4,stepEmitter:stepTimer,easing:Easing.CUBIC_IN_OUT},tandem:Tandem.OPTIONAL,visiblePropertyOptions:{phetioFeatured:!0}},s);super(),this.isAnimatingProperty=new BooleanProperty(!1),this.animationEnabled=o.animationEnabled,this.items=t,this.itemsPerPage=o.itemsPerPage,this.defaultPageNumber=o.defaultPageNumber;const n=Orientation.fromLayoutOrientation(o.orientation),l=new AlignGroup,h=o.tandem.createTandem("items");this.carouselItemNodes=getGroupItemNodes(t,h),this.alignBoxes=t.map((Ee,Le)=>l.createBox(this.carouselItemNodes[Le],combineOptions({tandem:Ee.tandemName?h.createTandem(Ee.tandemName):Tandem.OPTIONAL},o.alignBoxOptions,Ee.alignBoxOptions))),this.scrollingNode=new ScrollingFlowBox(this,{children:this.alignBoxes,orientation:o.orientation,spacing:o.spacing,[`${n.opposite.coordinate}Margin`]:o.margin}),this.visibleAlignBoxesProperty=DerivedProperty.deriveAny(this.alignBoxes.map(Ee=>Ee.visibleProperty),()=>this.getVisibleAlignBoxes()),this.scrollingNode.childrenReorderedEmitter.addListener(()=>this.visibleAlignBoxesProperty.recomputeDerivation());const g=combineOptions({cornerRadius:o.cornerRadius},o.buttonOptions);assert&&assert(o.spacing>=o.margin,"The spacing must be >= the margin, or you will see page 2 items at the end of page 1");const d=o.separatorsVisible?new Node$2({pickable:!1}):null,A=new Node$2({children:o.separatorsVisible?[d,this.scrollingNode]:[this.scrollingNode]}),S=Ee=>Math.max(Math.ceil(Ee.length/o.itemsPerPage),1);this.numberOfPagesProperty=new DerivedProperty([this.visibleAlignBoxesProperty],Ee=>S(Ee),{isValidValue:Ee=>Ee>0});const O=S(this.alignBoxes);assert&&assert(o.defaultPageNumber>=0&&o.defaultPageNumber<=this.numberOfPagesProperty.value-1,`defaultPageNumber is out of range: ${o.defaultPageNumber}`),this.pageNumberProperty=new NumberProperty(o.defaultPageNumber,{tandem:o.tandem.createTandem("pageNumberProperty"),numberType:"Integer",isValidValue:Ee=>Ee<this.numberOfPagesProperty.value&&Ee>=0,range:new Range(0,O-1),phetioFeatured:!0});const I=new DerivedProperty([this.numberOfPagesProperty],Ee=>Ee>1),W=new CarouselButton(combineOptions({arrowDirection:n===Orientation.HORIZONTAL?"right":"down",tandem:o.tandem.createTandem("nextButton"),listener:()=>this.pageNumberProperty.set(this.pageNumberProperty.get()+1),enabledProperty:new DerivedProperty([this.pageNumberProperty,this.numberOfPagesProperty],(Ee,Le)=>Ee<Le-1),visibleProperty:I},g)),L=new CarouselButton(combineOptions({arrowDirection:n===Orientation.HORIZONTAL?"left":"up",tandem:o.tandem.createTandem("previousButton"),listener:()=>this.pageNumberProperty.set(this.pageNumberProperty.get()-1),enabledProperty:new DerivedProperty([this.pageNumberProperty],Ee=>Ee>0),visibleProperty:I},g)),H=new Node$2({children:[A]}),Y=new Rectangle({cornerRadius:o.cornerRadius,fill:o.fill}),Q=new Rectangle({cornerRadius:o.cornerRadius,stroke:o.stroke,pickable:!1});this.carouselConstraint=new CarouselConstraint(this,Y,Q,H,L,W,A,this.alignBoxes,n,this.scrollingNode,this.itemsPerPage,o.margin,l,d,o.separatorOptions);let pe=null;const de=new Bounds2(0,0,0,0);Multilink.multilink([this.pageNumberProperty,A.localBoundsProperty],(Ee,Le)=>{if(Ee>=this.numberOfPagesProperty.value)return;pe&&pe.stop();const Z=this.visibleAlignBoxesProperty.value[Ee*o.itemsPerPage],ne=Z?-Z[n.minSide]+o.margin:0,Ke=de===null||!de.equals(Le);de.set(Le),this.animationEnabled&&!(isSettingPhetioStateProperty!=null&&isSettingPhetioStateProperty.value)&&r&&!Ke?(pe=new Animation(combineOptions({},o.animationOptions,{to:ne,getValue:()=>A[n.coordinate],setValue:_t=>{A[n.coordinate]=_t}})),pe.endedEmitter.addListener(()=>this.isAnimatingProperty.set(!1)),pe.start(),this.isAnimatingProperty.value=!0):A[n.coordinate]=ne}),this.visibleAlignBoxesProperty.link(()=>{this.pageNumberProperty.value=Math.min(this.pageNumberProperty.value,this.numberOfPagesProperty.value-1)}),o.children=[Y,H,W,L,Q],this.disposeCarousel=()=>{this.visibleAlignBoxesProperty.dispose(),this.pageNumberProperty.dispose(),this.alignBoxes.forEach(Ee=>{assert&&assert(Ee.children.length===1,"Carousel AlignBox instances should have only one child"),assert&&assert(this.carouselItemNodes.includes(Ee.children[0]),"Carousel AlignBox instances should wrap a content node"),Ee.dispose()}),this.scrollingNode.dispose(),this.carouselConstraint.dispose(),this.carouselItemNodes.forEach(Ee=>Ee.dispose())},this.mutate(o),r=!0,assert&&((ye=(fe=phet==null?void 0:phet.chipper)==null?void 0:fe.queryParameters)!=null&&ye.binder)&&InstanceRegistry.registerDataURL("sun","Carousel",this)}dispose(){this.disposeCarousel(),super.dispose()}reset(t=!1){const s=this.animationEnabled;this.animationEnabled=t,this.pageNumberProperty.value=Math.min(this.defaultPageNumber,this.numberOfPagesProperty.value-1),this.animationEnabled=s}scrollToItemVisibleIndex(t){this.pageNumberProperty.set(this.itemVisibleIndexToPageNumber(t))}scrollToItem(t){this.scrollToAlignBox(this.getAlignBoxForItem(t))}scrollToAlignBox(t){const s=this.visibleAlignBoxesProperty.value.indexOf(t);assert&&assert(s>=0,"item not present or visible"),s>=0&&this.scrollToItemVisibleIndex(s)}setItemVisible(t,s){this.getAlignBoxForItem(t).visible=s}getAlignBoxForItem(t){const s=this.alignBoxes[this.items.indexOf(t)];return assert&&assert(s,"item does not have corresponding alignBox"),s}getNodeForItem(t){const s=this.carouselItemNodes[this.items.indexOf(t)];return assert&&assert(s,"item does not have corresponding node"),s}itemVisibleIndexToPageNumber(t){return assert&&assert(t>=0&&t<this.items.length,`itemIndex out of range: ${t}`),Math.floor(t/this.itemsPerPage)}getVisibleAlignBoxes(){return _.sortBy(this.alignBoxes.filter(t=>t.visible),t=>this.scrollingNode.children.indexOf(t))}}class ScrollingFlowBox extends FlowBox{constructor(t,s){super(s),this.carousel=t}onIndexedNodeIOChildMoved(t){this.carousel.scrollToAlignBox(t)}}class CarouselConstraint extends LayoutConstraint{constructor(t,s,r,o,n,l,h,g,d,A,S,O,I,W,L){super(t),this.carousel=t,this.backgroundNode=s,this.foregroundNode=r,this.windowNode=o,this.previousButton=n,this.nextButton=l,this.scrollingNodeContainer=h,this.alignBoxes=g,this.orientation=d,this.scrollingNode=A,this.itemsPerPage=S,this.margin=O,this.alignGroup=I,this.separatorLayer=W,this.separatorOptions=L,[this.backgroundNode,this.foregroundNode,this.windowNode,this.previousButton,this.nextButton,this.scrollingNodeContainer,...this.alignBoxes].forEach(H=>this.addNode(H,!1)),this.separatorLayer&&this.scrollingNode.constraint.finishedLayoutEmitter.addListener(()=>{this.updateSeparators()}),this.updateLayout()}updateSeparators(){const t=this.carousel.getVisibleAlignBoxes(),s=t.length>=2?_.range(1,t.length):[];this.separatorLayer.children=s.map(r=>{const o=(t[r-1][this.orientation.maxSide]+t[r][this.orientation.minSide])/2;return new Separator(combineOptions({[`${this.orientation.coordinate}1`]:o,[`${this.orientation.coordinate}2`]:o,[`${this.orientation.opposite.coordinate}2`]:this.scrollingNode[this.orientation.opposite.size]},this.separatorOptions))})}computeClipArea(){const t=this.orientation,s=this.carousel.getVisibleAlignBoxes();if(s.length===0)return new Dimension2(0,0);{const r=s[this.itemsPerPage-1]||s[s.length-1],o=new Dimension2(r[t.maxSide]-s[0][t.minSide]+2*this.margin,this.scrollingNodeContainer.boundsProperty.value[t.opposite.size]);return this.orientation===Orientation.HORIZONTAL?o:o.swapped()}}getBackgroundDimension(){let t,s;if(this.orientation===Orientation.HORIZONTAL){const r=this.nextButton.visible?this.nextButton.width:0,o=this.previousButton.visible?this.previousButton.width:0;t=this.windowNode.width+r+o,s=this.windowNode.height}else{const r=this.nextButton.visible?this.nextButton.height:0,o=this.previousButton.visible?this.previousButton.height:0;t=this.windowNode.width,s=this.windowNode.height+r+o}return new Dimension2(t,s)}layout(){super.layout();const t=this.orientation,r=this.alignGroup.getMaxSizeProperty(t.opposite).value+2*this.margin;this.nextButton[t.opposite.preferredSize]=r,this.previousButton[t.opposite.preferredSize]=r,this.nextButton[t.opposite.centerCoordinate]=this.backgroundNode[t.opposite.centerCoordinate],this.previousButton[t.opposite.centerCoordinate]=this.backgroundNode[t.opposite.centerCoordinate],this.windowNode[t.opposite.centerCoordinate]=this.backgroundNode[t.opposite.centerCoordinate],this.previousButton[t.minSide]=this.backgroundNode[t.minSide],this.nextButton[t.maxSide]=this.backgroundNode[t.maxSide],this.windowNode[t.centerCoordinate]=this.backgroundNode[t.centerCoordinate];const o=this.computeClipArea().toBounds();this.windowNode.clipArea=Shape$1.bounds(o),this.windowNode.localBounds=o;const n=this.getBackgroundDimension();this.carousel.backgroundWidth=n.width,this.carousel.backgroundHeight=n.height;const l=n.toBounds();this.backgroundNode.rectBounds=l,this.foregroundNode.rectBounds=l,this.separatorLayer&&this.updateSeparators()}}sun.register("Carousel",Carousel);const SunConstants={VALUE_NAMED_PLACEHOLDER:"{{value}}",VALUE_NUMBERED_PLACEHOLDER:"{0}",SLIDER_VERTICAL_ROTATION:-Math.PI/2};sun.register("SunConstants",SunConstants);class NullSoundPlayer{play(){}stop(){}}const nullSoundPlayer=new NullSoundPlayer;tambo.register("nullSoundPlayer",nullSoundPlayer);const soundURI$7="data:audio/mpeg;base64,//swxAAAB5gnMzRhAAEHDWyDNLAAAAAaAQAu7tjAQAAABgMBgNNiBBAWD7ykMQf1g+D5/qBMHwfB/iAEPWCDv+o5wfPg+8EAQBMHz6gQB8Hwfsu2uWDrkw/a9xgUaMwFxxwCLsWS7MHN7VJki8fVT75eTqpn7/Xt1QxW//lJVbnfNuFRTzwrLn/5GVBnKMy/FVs5dTYABARKCMRm//syxAQACHBHWZ2kAAEJi+jxpg1Qlry2AYclVGyMwNoFJ29hqHqa1TRqRMCoetKstcqUzHBxQdCJmVcSJ/EQdEo0FXSoNLGkav/ljqPtEvjAoAE0zuEoM3lMJlLY3Uj65AMeMzQN6QWeLFdCcxLNFy4dBVXVfZ1L+gIki4KPQVBb4dERU6CrsFSoaLVHv/Ev9Hw4ANdAAG7VBBhVdP/7MsQFAAh8YybVowABG49vdx6AAm8ODBg8FDy9pmwIBsHPVGiPMueyERxZdIFnSpkzI8fezb+0z6OJVv7HHw7XBWdXwa6/y34l6sq7uitTjFTEgsFYrFQqFQDAGrQXMbpbb3ZGQWPWvTnyyeKKHgQ/nvlUf/u74oOHp/8v3R/dl/UcSXDz+kMBEHI0p5efiDJqb/64foFiBSWqB2r/+zLEA4AIVDlivZGAAQePKiWmDNhtwTYmBYyxnJdmZwmMtZ8ZjInEMMpo+VFWESqmhsWBoClhKKEhCW5UNPCsFVgqImyWS6KTAhEUrYoO7kaAWIJCwQzbgl5XrFBB27xoQwfnY6kozJtFz0SgICsWM3VIKWs6qr0tgI15/pQomHhblqjycRUCWe1dUOpxFOiJ/ooQC+IEEBlVdh0r//swxAUACGCjMy0kSsDoiCAA95gpQaBI041ceup5PSlsv5QNXMyixFLVkTXWpYUBYy/lEl4YCdWlLoZ//zGlKUBEhV0SiFT+us7WdBXqAbQ2hdxgDfH4RQsI+kgo2RnWVECiCa0TrUSNjalrUVVKyg0yapYqqVlRTNVLFf/2P/1qVadsTFKlitVMQU1FMy45OS4zVVVVVVVVVVVV",soundByteArray$7=base64SoundToByteArray(phetAudioContext$1,soundURI$7),unlock$7=asyncLoader.createLock(soundURI$7),wrappedAudioBuffer$7=new WrappedAudioBuffer;let unlocked$7=!1;const safeUnlock$7=()=>{unlocked$7||(unlock$7(),unlocked$7=!0)},onDecodeSuccess$7=a=>{wrappedAudioBuffer$7.audioBufferProperty.value===null&&(wrappedAudioBuffer$7.audioBufferProperty.set(a),safeUnlock$7())},onDecodeError$7=a=>{console.warn("decode of audio data failed, using stubbed sound, error: "+a),wrappedAudioBuffer$7.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$7()},decodePromise$7=phetAudioContext$1.decodeAudioData(soundByteArray$7.buffer,onDecodeSuccess$7,onDecodeError$7);decodePromise$7&&decodePromise$7.then(a=>{wrappedAudioBuffer$7.audioBufferProperty.value===null&&(wrappedAudioBuffer$7.audioBufferProperty.set(a),safeUnlock$7())}).catch(a=>{console.warn("promise rejection caught for audio decode, error = "+a),safeUnlock$7()});const generalCloseSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$7,{soundClipOptions:{initialOutputLevel:.4},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("generalCloseSoundPlayer",generalCloseSoundPlayer);const soundURI$6="data:audio/mpeg;base64,//swxAAABswbPzQxABEQFyzDMlAAAAGoGRIdz0AAARQAAAAAMCd5QEAxBA4sPlz/BAMfw+ooc8EA/EAYKAh/qBBYfwfD4jB/4nD98ZXetEKIxIqnuursF7pTGkY4dNYcaZhOjzgxDNndb75ggdCsIvV3qoeM9HIX215a6Hftuc5FhwFRhvuJuhxbMPp+ir0KlAaCTHVtZuCsLISS//syxAYACGhJXR2jABEVIGmw8YpieZwGg6y5/p6bf69uls4kMS9HVvrXl8hI5WPBY8FawqGh3PYlLA0HQm6ZHvUe/4UB4ChNzls1AZIAAxJNQMBOy4KAeSsL0QgRcxFInzpyhsQ6tvdvaM160ZnbY/2bY19dTlJVJmhrQpT/Vf0eVjfzG////6PMYzmtqJdg0WqADvRwaGDBgBO5T//7MsQFgAkEZSA1swABDRYvdx5QAhmAEZHdFc2HHLBy/LcmfqWvq1yftVsQSJAxzSi25i5w6qqvMy/cjgNSoKu2Q1LHp1S4NCJQsHfLUSINPxK6oxocyIhmMRkMhQAQBuyhLerW2u5zoV4af2nULcHzwOiPxQjFU/nvIyflMKARabfnQqGI/v/FAIV6UJnPAgAca//9NZUgFEnVWuP/+zLEA4AIVL1vnYQAEQkIajDMpMja7T9a7DL+uzSEg2RRajlNmUzFPCBtL7Uyoa/iVlabnj1+Pi9f61X5WuJ9V1XhkOmtYltLGPI1//8s/0PMAKmLuWQPy0Hrh0Uy4C5MCaWoC5bwOjrQpVOQIn9JNDksr2zEBLvAp3LCI8Is9BX1FTsS50j5Us8OCIqEg73ZZ9QByyIAiddlUPU0//swxAUCSEyXLMywatDDBOHA8zBIRfBtlFDU3P7EItHsWE51WgaTVpJLPMzOMYE1qUSth4pRSd1WkZLqqrnGPUobBm4oDUDHol//+rJBUlwL0rYuAoOSuFITEsfTp5a46IhKRBQ6FQkBQCWJESR0KhIeNASKGnsJgJCf///1VUxBTUUzLjk5LjNVVVVVVVVVVVVVVVVVVVVVVVVV",soundByteArray$6=base64SoundToByteArray(phetAudioContext$1,soundURI$6),unlock$6=asyncLoader.createLock(soundURI$6),wrappedAudioBuffer$6=new WrappedAudioBuffer;let unlocked$6=!1;const safeUnlock$6=()=>{unlocked$6||(unlock$6(),unlocked$6=!0)},onDecodeSuccess$6=a=>{wrappedAudioBuffer$6.audioBufferProperty.value===null&&(wrappedAudioBuffer$6.audioBufferProperty.set(a),safeUnlock$6())},onDecodeError$6=a=>{console.warn("decode of audio data failed, using stubbed sound, error: "+a),wrappedAudioBuffer$6.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$6()},decodePromise$6=phetAudioContext$1.decodeAudioData(soundByteArray$6.buffer,onDecodeSuccess$6,onDecodeError$6);decodePromise$6&&decodePromise$6.then(a=>{wrappedAudioBuffer$6.audioBufferProperty.value===null&&(wrappedAudioBuffer$6.audioBufferProperty.set(a),safeUnlock$6())}).catch(a=>{console.warn("promise rejection caught for audio decode, error = "+a),safeUnlock$6()});const generalOpenSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$6,{soundClipOptions:{initialOutputLevel:.4},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("generalOpenSoundPlayer",generalOpenSoundPlayer);class ComboBoxListItemNode extends Voicing(Node$2){constructor(t,s,r,o,n,l){const h=optionize()({cursor:"pointer",align:"left",xMargin:6,highlightFill:"rgb( 245, 245, 245 )",highlightCornerRadius:4,tagName:"li",focusable:!0,ariaRole:"option",positionInPDOM:!0,voicingFocusListener:()=>this.comboBoxListItemNodeVoicingFocusListener(),comboBoxVoicingNameResponsePattern:SunConstants.VALUE_NAMED_PLACEHOLDER,tandem:Tandem.REQUIRED,tandemNameSuffix:"Item",phetioType:IndexedNodeIO,phetioState:!0,visiblePropertyOptions:{phetioFeatured:!0}},l);h.comboBoxVoicingNameResponsePattern=h.comboBoxVoicingNameResponsePattern.get?h.comboBoxVoicingNameResponsePattern.get():h.comboBoxVoicingNameResponsePattern,assert&&assert(!!phet.chipper.queryParameters.stringTest||h.comboBoxVoicingNameResponsePattern.includes("{{value}}"),"value needs to be filled in");const g=new Rectangle({cornerRadius:h.highlightCornerRadius}),d=new Node$2({children:[s]}),A=Q=>{g.rectWidth=Q,d.maxWidth=Q};o.link(A);const S=Q=>{g.rectHeight=Q,d.maxHeight=Q};n.link(S);const O=()=>{h.align==="left"?d.left=g.left+h.xMargin:h.align==="right"?d.right=g.right-h.xMargin:d.centerX=g.centerX,d.centerY=g.centerY};d.boundsProperty.lazyLink(O),O(),h.children=[g,d],super(h),this._supplyOpenResponseOnNextFocus=!1;const I=new DerivedProperty([r],Q=>Q||""),W=typeof h.comboBoxVoicingNameResponsePattern=="string"?new Property(h.comboBoxVoicingNameResponsePattern):h.comboBoxVoicingNameResponsePattern,L=new PatternStringProperty(W,{value:I},{tandem:Tandem.OPT_OUT});this.voicingNameResponse=L;const H=Q=>{this.innerContent=Q,this.voicingObjectResponse=Q};r.link(H),this.item=t,this.localBoundsProperty.link(Q=>{this.focusHighlight=Shape$1.bounds(Q)});const Y=new PressListener({attach:!1,tandem:Tandem.OPT_OUT});this.addInputListener(Y),Y.looksOverProperty.link(Q=>{g.fill=Q?h.highlightFill:null}),this.disposeComboBoxListItemNode=()=>{Y.dispose(),L.dispose(),I.dispose(),r.unlink(H),o.unlink(A),n.unlink(S)}}supplyOpenResponseOnNextFocus(){this._supplyOpenResponseOnNextFocus=!0}dispose(){this.disposeComboBoxListItemNode(),super.dispose()}comboBoxListItemNodeVoicingFocusListener(){this.voicingSpeakFullResponse({nameResponse:this._supplyOpenResponseOnNextFocus?this.voicingNameResponse:null,objectResponse:this._supplyOpenResponseOnNextFocus?null:this.voicingObjectResponse,contextResponse:null,hintResponse:this._supplyOpenResponseOnNextFocus?this.voicingHintResponse:null}),this._supplyOpenResponseOnNextFocus=!1}}sun.register("ComboBoxListItemNode",ComboBoxListItemNode);const ALIGN_VALUES$3=["left","center","right"],DEFAULT_OPTIONS={fill:"white",stroke:"black",lineWidth:1,lineDash:[],xMargin:5,yMargin:5,cornerRadius:10,resize:!0,backgroundPickable:!0,excludeInvisibleChildrenFromBounds:!0,align:"left",minWidth:0,minHeight:0};assert&&Object.freeze(DEFAULT_OPTIONS);const Gu=class Gu extends Sizable(Node$2){constructor(t,s){const r=optionize3()({},DEFAULT_OPTIONS,s);assert&&assert(_.includes(ALIGN_VALUES$3,r.align),`invalid align: ${r.align}`),super(),this._content=t,this._backgroundContainer=new Node$2,this._background=new Rectangle(0,0,1,1,{lineWidth:r.lineWidth,pickable:r.backgroundPickable,lineDash:r.lineDash,cornerRadius:r.cornerRadius}),this.setStroke(r.stroke),this.setFill(r.fill),this.addChild(this._backgroundContainer),this.addChild(t),this.constraint=new PanelConstraint(this,r),this.constraint.updateLayout(),this.constraint.enabled=r.resize,this.mutate(r)}getStroke(){return this._background.stroke}get stroke(){return this.getStroke()}set stroke(t){this.setStroke(t)}setStroke(t){this._background.stroke=t,this.constraint&&this.constraint.updateLayoutAutomatically()}getFill(){return this._background.fill}get fill(){return this.getFill()}set fill(t){this.setFill(t)}setFill(t){this._background.fill=t}setExcludeInvisibleChildrenFromBounds(t){super.setExcludeInvisibleChildrenFromBounds(t),this.constraint.updateLayoutAutomatically()}};Gu.DEFAULT_PANEL_OPTIONS=DEFAULT_OPTIONS;let Panel=Gu;class PanelConstraint extends LayoutConstraint{constructor(t,s){super(t),this.panel=t,assert&&assert(typeof s.minWidth=="number","Panel minWidth should be a number"),assert&&assert(typeof s.xMargin=="number","Panel xMargin should be a number"),assert&&assert(typeof s.yMargin=="number","Panel yMargin should be a number"),assert&&assert(typeof s.lineWidth=="number","Panel lineWidth should be a number"),assert&&assert(ALIGN_VALUES$3.includes(s.align),`Panel align should be one of ${ALIGN_VALUES$3}`),this.minWidth=s.minWidth,this.minHeight=s.minHeight,this.xMargin=s.xMargin,this.yMargin=s.yMargin,this.lineWidth=s.lineWidth,this.align=s.align,this.panel.localPreferredWidthProperty.lazyLink(this._updateLayoutListener),this.panel.localPreferredHeightProperty.lazyLink(this._updateLayoutListener),this.addNode(t._content)}layout(){super.layout();const t=this.panel,s=t._content,r=t._background,o=t.stroke===null?0:this.lineWidth,n=t.isChildIncludedInLayout(s);if(t._backgroundContainer.children=n?[r]:[],!n){t.localMinimumWidth=null,t.localMinimumHeight=null;return}const l=isWidthSizable(s)&&s.minimumWidth!==null?s.minimumWidth:s.width,h=isHeightSizable(s)&&s.minimumHeight!==null?s.minimumHeight:s.height,g=Math.max(this.minWidth,l+2*this.xMargin)+o,d=Math.max(this.minHeight,h+2*this.yMargin)+o,A=Math.max(g,t.localPreferredWidth||0),S=Math.max(d,t.localPreferredHeight||0);isWidthSizable(s)&&t.localPreferredWidth!==null&&(s.preferredWidth=A-o-2*this.xMargin),isHeightSizable(s)&&t.localPreferredHeight!==null&&(s.preferredHeight=S-o-2*this.yMargin),r.setRect(0,0,A-o,S-o),this.align==="center"?s.center=r.center:this.align==="left"?(s.left=r.centerX-r.rectWidth/2+this.xMargin,s.centerY=r.centerY):(s.right=r.centerX+r.rectWidth/2-this.xMargin,s.centerY=r.centerY),t.localMinimumWidth=g,t.localMinimumHeight=d}dispose(){this.panel.localPreferredWidthProperty.unlink(this._updateLayoutListener),this.panel.localPreferredHeightProperty.unlink(this._updateLayoutListener),super.dispose()}}sun.register("Panel",Panel);class ComboBoxListBox extends Panel{constructor(t,s,r,o,n,l,h,g,d){assert&&assert(s.length>0,"empty list box is not supported");const A=optionize()({highlightFill:"rgb( 245, 245, 245 )",comboBoxListItemNodeOptions:{},xMargin:12,yMargin:8,backgroundPickable:!0,tagName:"ul",ariaRole:"listbox",groupFocusHighlight:!0,openedSoundPlayer:generalOpenSoundPlayer,closedNoChangeSoundPlayer:generalCloseSoundPlayer,visiblePropertyOptions:{phetioReadOnly:!0}},d);assert&&assert(A.xMargin>0&&A.yMargin>0,`margins must be > 0, xMargin=${A.xMargin}, yMargin=${A.yMargin}`);const S=new PhetioAction$1(ye=>{const Ee=ye.currentTarget;assert&&assert(Ee instanceof ComboBoxListItemNode,"expected a ComboBoxListItemNode"),this.selectionOnFireAction=Ee;const Le=t.value;l(),t.value=this.selectionOnFireAction.item.value,n(),this.voiceOnNewSelection(t.value,Le,Ee),ye.abort()},{parameters:[{phetioPrivate:!0,valueType:SceneryEvent}],tandem:g.createTandem("fireAction"),phetioEventType:EventType.USER}),O={up(ye){S.execute(ye)},keyup:ye=>{ye.domEvent&&KeyboardUtils.isAnyKeyEvent(ye.domEvent,[KeyboardUtils.KEY_ENTER,KeyboardUtils.KEY_SPACE])&&S.execute(ye)},click:ye=>{S.execute(ye)}},I=ComboBox.getMaxItemWidthProperty(r),W=ComboBox.getMaxItemHeightProperty(r),L=new DerivedProperty([I],ye=>ye+A.xMargin),H=new DerivedProperty([W],ye=>ye+A.yMargin),Y=[];s.forEach((ye,Ee)=>{const Le=o.get(ye.value);assert&&assert(Le);const Z=new ComboBoxListItemNode(ye,r[Ee],Le,L,H,combineOptions({align:A.align,highlightFill:A.highlightFill,highlightCornerRadius:A.cornerRadius,xMargin:.5*A.xMargin,tandem:ye.tandemName?g.createTandem(ye.tandemName):Tandem.OPTIONAL},A.comboBoxListItemNodeOptions,ye.comboBoxListItemNodeOptions));Y.push(Z),Z.addInputListener(O)});const Q=new VBox({spacing:0,excludeInvisibleChildrenFromBounds:!0,children:Y});super(Q,combineOptions({},A,{xMargin:A.xMargin/2,yMargin:A.yMargin/2})),this.content=Q,this.voiceOnSelectionNode=h,this.selectionOnFireAction=this.getListItemNode(t.value);const pe=s.map(ye=>multiSelectionSoundPlayerFactory.getSelectionSoundPlayer(s.indexOf(ye)));let de;this.visibleProperty.lazyLink(ye=>{if(ye)A.openedSoundPlayer.play(),de=this.getListItemNode(t.value);else if(assert&&assert(de,"no Node for when list box was opened"),de===this.selectionOnFireAction)A.closedNoChangeSoundPlayer.play();else{const Ee=this.selectionOnFireAction.item;if(Ee.soundPlayer)Ee.soundPlayer.play();else{const Le=this.getVisibleListItemNodes().indexOf(this.selectionOnFireAction);Le!==-1&&pe[Le].play()}}});const fe=new KeyboardListener({keys:["escape","tab","shift+tab","arrowUp","arrowDown","home","end"],callback:(ye,Ee)=>{const Le=ye;assert&&assert(Le,"event is required for this listener");const Z=this.getVisibleListItemNodes();if(Ee==="escape"||Ee==="tab"||Ee==="shift+tab")Le.abort(),n(),l();else if(Ee==="arrowUp"||Ee==="arrowDown"){const ne=Le.domEvent;assert&&assert(ne,"domEvent is required for this listener"),ne.preventDefault();const Ke=Ee==="arrowDown"?1:-1,_t=Z.indexOf(this.getFocusedItemNode());assert&&assert(_t>-1,"how could we receive keydown without a focused list item?");const xe=_t+Ke;Z[xe]&&Z[xe].focus(),Le.pointer.reserveForKeyboardDrag()}else Ee==="home"?Z[0].focus():Ee==="end"&&Z[Z.length-1].focus()}});this.addInputListener(fe),this.disposeComboBoxListBox=()=>{for(let ye=0;ye<Y.length;ye++)Y[ye].dispose();this.removeInputListener(fe),fe.dispose(),S.dispose(),I.dispose(),W.dispose()}}dispose(){this.disposeComboBoxListBox(),super.dispose()}setItemVisible(t,s){this.getListItemNode(t).visible=s}isItemVisible(t){return this.getListItemNode(t).visible}getAllListItemNodes(){return this.content.children}getVisibleListItemNodes(){return this.getAllListItemNodes().filter(t=>t.visible)}getListItemNode(t){const s=_.find(this.getAllListItemNodes(),r=>r.item.value===t);return assert&&assert(s,`no item found for value: ${t}`),assert&&assert(s instanceof ComboBoxListItemNode,"invalid listItemNode"),s}getFocusedItemNode(){const t=_.find(this.getAllListItemNodes(),s=>s.focused);return assert&&assert(t,"no item found that has focus"),assert&&assert(t instanceof ComboBoxListItemNode,"invalid listItemNode"),t}focusListItemNode(t){let s=this.getListItemNode(t);s.visible||(s=_.find(this.getAllListItemNodes(),r=>r.visible)),s&&(s.supplyOpenResponseOnNextFocus(),s.focus())}voiceOnNewSelection(t,s,r){const o={nameResponse:r.voicingNameResponse,objectResponse:null,contextResponse:r.voicingContextResponse,hintResponse:null};s===t&&(o.contextResponse=null),this.voiceOnSelectionNode.voicingSpeakResponse(o)}}sun.register("ComboBoxListBox",ComboBoxListBox);const LIST_POSITION_VALUES=["above","below"],ALIGN_VALUES$2=["left","right","center"],ITEM_TANDEM_NAME_SUFFIX="Item",ACCESSIBLE_NAME_BEHAVIOR$1=(a,t,s,r)=>(r.push(()=>{a.button.accessibleName=s}),t),HELP_TEXT_BEHAVIOR=(a,t,s,r)=>(r.push(()=>{a.button.helpText=s}),t),hl=class hl extends WidthSizable(Node$2){constructor(t,s,r,o){var g,d;assert&&assert(_.uniqBy(s,A=>A.value).length===s.length,"items must have unique values"),assert&&s.forEach(A=>{assert&&assert(!A.tandemName||A.tandemName.endsWith(ITEM_TANDEM_NAME_SUFFIX),`ComboBoxItem tandemName must end with '${ITEM_TANDEM_NAME_SUFFIX}': ${A.tandemName}`)}),assert&&assert(r.maxWidth===null,"ComboBox is responsible for scaling listBox. Setting maxWidth for listParent may result in buggy behavior.");const n=optionize()({align:"left",listPosition:"below",labelXSpacing:10,disabledOpacity:.5,cornerRadius:4,highlightFill:"rgb( 245, 245, 245 )",xMargin:12,yMargin:8,buttonFill:"white",buttonStroke:"black",buttonLineWidth:1,buttonTouchAreaXDilation:0,buttonTouchAreaYDilation:0,buttonMouseAreaXDilation:0,buttonMouseAreaYDilation:0,listFill:"white",listStroke:"black",listLineWidth:1,openedSoundPlayer:generalOpenSoundPlayer,closedNoChangeSoundPlayer:generalCloseSoundPlayer,tagName:"div",accessibleNameBehavior:ACCESSIBLE_NAME_BEHAVIOR$1,helpTextBehavior:HELP_TEXT_BEHAVIOR,comboBoxVoicingNameResponsePattern:SunConstants.VALUE_NAMED_PLACEHOLDER,comboBoxVoicingContextResponse:null,comboBoxVoicingHintResponse:null,tandem:Tandem.REQUIRED,tandemNameSuffix:"ComboBox",phetioType:hl.ComboBoxIO,phetioFeatured:!0,phetioEventType:EventType.USER,visiblePropertyOptions:{phetioFeatured:!0},phetioEnabledPropertyInstrumented:!0},o),l=getGroupItemNodes(s,n.tandem.createTandem("items"));assert&&l.forEach(A=>{assert&&assert(!A.hasPDOMContent,"Accessibility is provided by ComboBoxItemNode and ComboBoxItem.a11yLabel. Additional PDOM content in the provided Node could break accessibility.")}),assert&&assert(n.xMargin>0&&n.yMargin>0,`margins must be > 0, xMargin=${n.xMargin}, yMargin=${n.yMargin}`),assert&&assert(_.includes(LIST_POSITION_VALUES,n.listPosition),`invalid listPosition: ${n.listPosition}`),assert&&assert(_.includes(ALIGN_VALUES$2,n.align),`invalid align: ${n.align}`),super(),this.nodes=l,this.a11yNamePropertyMap=hl.getA11yNamePropertyMap(s),this.listPosition=n.listPosition,this.button=new ComboBoxButton(t,s,l,this.a11yNamePropertyMap,{align:n.align,arrowDirection:n.listPosition==="below"?"down":"up",cornerRadius:n.cornerRadius,xMargin:n.xMargin,yMargin:n.yMargin,baseColor:n.buttonFill,stroke:n.buttonStroke,lineWidth:n.buttonLineWidth,touchAreaXDilation:n.buttonTouchAreaXDilation,touchAreaYDilation:n.buttonTouchAreaYDilation,mouseAreaXDilation:n.buttonMouseAreaXDilation,mouseAreaYDilation:n.buttonMouseAreaYDilation,localPreferredWidthProperty:this.localPreferredWidthProperty,localMinimumWidthProperty:this.localMinimumWidthProperty,comboBoxVoicingNameResponsePattern:n.comboBoxVoicingNameResponsePattern,tandem:n.tandem.createTandem("button")}),this.addChild(this.button),this.listBox=new ComboBoxListBox(t,s,l,this.a11yNamePropertyMap,this.hideListBox.bind(this),()=>{this.button.blockNextVoicingFocusListener(),this.button.focus()},this.button,n.tandem.createTandem("listBox"),{align:n.align,highlightFill:n.highlightFill,xMargin:n.xMargin,yMargin:n.yMargin,cornerRadius:n.cornerRadius,fill:n.listFill,stroke:n.listStroke,lineWidth:n.listLineWidth,visible:!1,comboBoxListItemNodeOptions:{comboBoxVoicingNameResponsePattern:n.comboBoxVoicingNameResponsePattern,voicingContextResponse:n.comboBoxVoicingContextResponse,voicingHintResponse:n.comboBoxVoicingHintResponse},openedSoundPlayer:n.openedSoundPlayer,closedNoChangeSoundPlayer:n.closedNoChangeSoundPlayer,ariaLabelledbyAssociations:[{otherNode:this.button,otherElementName:PDOMPeer$1.LABEL_SIBLING,thisElementName:PDOMPeer$1.PRIMARY_SIBLING}]}),r.addChild(this.listBox),this.listParent=r;const h=new MatrixBetweenProperty(this.button,this.listParent,{fromCoordinateFrame:"parent",toCoordinateFrame:"local"});Multilink.multilink([h,this.button.localBoundsProperty,this.listBox.localBoundsProperty],A=>{this.scaleAndPositionListBox(A)}),this.opacityProperty.link(A=>{this.listBox.opacityProperty.value=A}),this.mutate(n),assert&&Tandem.VALIDATION&&this.isPhetioInstrumented()&&s.forEach(A=>{assert&&assert(A.tandemName!==null,`PhET-iO instrumented ComboBoxes require ComboBoxItems to have tandemName: ${A.value}`)}),this.button.addListener(()=>{this.listBox.visibleProperty.value=!this.listBox.visibleProperty.value,this.listBox.visibleProperty.value&&this.listBox.focusListItemNode(t.value)}),this.display=null,this.clickToDismissListener={down:A=>{(!phet.chipper.isFuzzEnabled()||dotRandom.nextDouble()<.005)&&(A.trail.containsNode(this.button)||A.trail.containsNode(this.listBox)||this.hideListBox())}},this.dismissWithFocusListener=A=>{A&&!A.trail.containsNode(this.listBox)&&this.hideListBox()},FocusManager.pdomFocusProperty.link(this.dismissWithFocusListener),this.listBox.visibleProperty.link(A=>{A?(this.scaleListBox(),this.listBox.moveToFront(),assert&&assert(!this.display,"unexpected display"),this.display=this.getUniqueTrail().rootNode().getRootedDisplays()[0],this.display.addInputListener(this.clickToDismissListener)):this.display&&this.display.hasInputListener(this.clickToDismissListener)&&(this.display.removeInputListener(this.clickToDismissListener),this.display=null)}),this.displayOnlyProperty=new BooleanProperty(!1,{tandem:n.tandem.createTandem("displayOnlyProperty"),phetioFeatured:!0,phetioDocumentation:"disables interaction with the ComboBox and makes it appear like a display that shows the current selection"}),this.displayOnlyProperty.link(A=>{this.hideListBox(),this.button.setDisplayOnly(A),this.pickable=!A}),this.addLinkedElement(t,{tandemName:"property"}),this.disposeComboBox=()=>{h.dispose(),this.display&&this.display.hasInputListener(this.clickToDismissListener)&&this.display.removeInputListener(this.clickToDismissListener),FocusManager.pdomFocusProperty.unlink(this.dismissWithFocusListener),this.displayOnlyProperty.dispose(),this.listBox.dispose(),this.button.dispose(),l.forEach(A=>A.dispose())},assert&&((d=(g=phet==null?void 0:phet.chipper)==null?void 0:g.queryParameters)!=null&&d.binder)&&InstanceRegistry.registerDataURL("sun","ComboBox",this)}dispose(){this.disposeComboBox(),super.dispose()}showListBox(){this.listBox.visibleProperty.value=!0}hideListBox(){this.listBox.visibleProperty.value=!1}scaleListBox(){if(!this.listBox.localBounds.isEmpty()){const t=this.button.localToGlobalBounds(this.button.localBounds).width/this.button.localBounds.width,s=this.listBox.localToGlobalBounds(this.listBox.localBounds).width/this.listBox.localBounds.width;this.listBox.scale(t/s)}}scaleAndPositionListBox(t){t&&(this.scaleListBox(),this.listPosition==="above"?this.listBox.leftBottom=t.timesVector2(this.button.leftTop):this.listBox.leftTop=t.timesVector2(this.button.leftBottom))}setItemVisible(t,s){this.listBox.setItemVisible(t,s)}isItemVisible(t){return this.listBox.isItemVisible(t)}static getMaxItemWidthProperty(t){const s=_.flatten(t.map(r=>{const o=[r.boundsProperty];return extendsWidthSizable(r)&&(o.push(r.isWidthResizableProperty),o.push(r.minimumWidthProperty)),o}));return DerivedProperty.deriveAny(s,()=>Math.max(...t.map(r=>isWidthSizable(r)?r.minimumWidth||0:r.width)),{strictAxonDependencies:!1})}static getMaxItemHeightProperty(t){const s=t.map(r=>r.boundsProperty);return DerivedProperty.deriveAny(s,()=>Math.max(...t.map(r=>r.height)),{strictAxonDependencies:!1})}static getA11yNamePropertyMap(t){const s=new Map;return t.forEach(r=>{let o;isTReadOnlyProperty(r.a11yName)?o=r.a11yName:typeof r.a11yName=="string"?o=new TinyProperty(r.a11yName):o=new TinyProperty(null),s.set(r.value,o)}),s}};hl.ComboBoxIO=new IOType("ComboBoxIO",{valueType:hl,documentation:"A combo box is composed of a push button and a listbox. The listbox contains items that represent choices. Pressing the button pops up the listbox. Selecting from an item in the listbox sets the value of an associated Property. The button shows the item that is currently selected.",supertype:Node$2.NodeIO,events:["listBoxShown","listBoxHidden"]});let ComboBox=hl;sun.register("ComboBox",ComboBox);const ALIGN_VALUES$1=["left","center","right"],ARROW_DIRECTION_VALUES=["up","down"],ACCESSIBLE_NAME_BEHAVIOR=(a,t,s)=>(t.labelTagName="p",t.labelContent=s,t);class ComboBoxButton extends RectangularPushButton{constructor(t,s,r,o,n){const l=optionize()({align:"left",arrowDirection:"down",arrowFill:"black",comboBoxVoicingNameResponsePattern:SunConstants.VALUE_NAMED_PLACEHOLDER,cursor:"pointer",baseColor:"white",buttonAppearanceStrategy:ButtonNode.FlatAppearanceStrategy,xMargin:12,yMargin:8,stroke:"black",lineWidth:1,soundPlayer:nullSoundPlayer,enabledPropertyOptions:{phetioFeatured:!1},visiblePropertyOptions:{phetioFeatured:!1},localPreferredWidthProperty:new TinyProperty(null),localMinimumWidthProperty:new TinyProperty(null),containerTagName:"div",accessibleNameBehavior:ACCESSIBLE_NAME_BEHAVIOR},n);assert&&assert(_.includes(ALIGN_VALUES$1,l.align),`invalid align: ${l.align}`),assert&&assert(_.includes(ARROW_DIRECTION_VALUES,l.arrowDirection),`invalid arrowDirection: ${l.arrowDirection}`);const h=l.xMargin,g=l.yMargin,d=ComboBox.getMaxItemWidthProperty(r),A=ComboBox.getMaxItemHeightProperty(r),S=new Path(null,{fill:l.arrowFill}),O=_.find(s,fe=>fe.value===t.value),I=s.indexOf(O),W=new Node$2({layoutOptions:{yMargin:g,grow:1,xAlign:l.align},children:[r[I]]}),L=new Line(0,0,0,0,{stroke:"black",lineWidth:l.lineWidth});l.content=new GridBox({rows:[[W,L,S]]}),Multilink.multilink([d,A],(fe,ye)=>{const Ee=ye+2*g,Le=Ee,Z=.35*Le,ne=2*Z*Math.sqrt(3)/3,Ke=h,_t=h-l.lineWidth/2,xe=-l.lineWidth/2,Ct=(zt,Je,Et)=>zt==="up"?new Shape$1().moveTo(0,Et).lineTo(Je/2,0).lineTo(Je,Et).close():new Shape$1().moveTo(0,0).lineTo(Je,0).lineTo(Je/2,Et).close();S.shape=Ct(l.arrowDirection,ne,Z),S.mutateLayoutOptions({minContentWidth:Le,minContentHeight:Le}),W.mutateLayoutOptions({minContentWidth:fe,minContentHeight:ye,leftMargin:Ke,rightMargin:_t}),L.y2=Ee,L.mutateLayoutOptions({rightMargin:xe})}),l.xMargin=0,l.yMargin=0,super(l),this.minimumWidthProperty.link(fe=>{l.localMinimumWidthProperty.value=fe});const H=fe=>{this.preferredWidth=fe};l.localPreferredWidthProperty.link(H),this._blockNextVoicingFocusListener=!1,this.voicingFocusListener=()=>{!this._blockNextVoicingFocusListener&&this.defaultFocusListener(),this._blockNextVoicingFocusListener=!1};let Y=null;const Q=new DerivedProperty([t],fe=>{const ye=_.find(s,Ee=>Ee.value===fe);return assert&&assert(ye,`no item found for value: ${fe}`),ye}),pe=new DerivedProperty([Q],fe=>r[s.indexOf(fe)]),de=new DynamicProperty(Q,{derive:fe=>o.get(fe.value)});pe.link(fe=>{W.removeAllChildren(),W.addChild(fe)}),de.link(fe=>{this.innerContent=fe;const ye=typeof l.comboBoxVoicingNameResponsePattern=="string"?new Property(l.comboBoxVoicingNameResponsePattern):l.comboBoxVoicingNameResponsePattern;Y&&Y.dispose(),this.voicingNameResponse=Y=new PatternStringProperty(ye,{value:fe||""},{tandem:Tandem.OPT_OUT})}),this.ariaLabelledbyAssociations=[{otherNode:this,otherElementName:PDOMPeer$1.LABEL_SIBLING,thisElementName:PDOMPeer$1.PRIMARY_SIBLING},{otherNode:this,otherElementName:PDOMPeer$1.PRIMARY_SIBLING,thisElementName:PDOMPeer$1.PRIMARY_SIBLING}],AriaHasPopUpMutator.mutateNode(this,"listbox"),this.disposeComboBoxButton=()=>{d.dispose(),A.dispose(),Q.dispose(),l.localPreferredWidthProperty.unlink(H),Y&&Y.dispose()},this.arrow=S,this.separatorLine=L}setDisplayOnly(t){this.arrow.visible=!t,this.separatorLine.visible=!t}blockNextVoicingFocusListener(){this._blockNextVoicingFocusListener=!0}dispose(){this.disposeComboBoxButton(),super.dispose()}}sun.register("ComboBoxButton",ComboBoxButton);class PageControl extends Node$2{constructor(t,s,r){const o=optionize()({interactive:!1,orientation:"horizontal",dotRadius:3,lineWidth:1,dotSpacing:10,dotTouchAreaDilation:4,dotMouseAreaDilation:4,currentPageFill:"black",currentPageStroke:null,pageFill:"rgb( 200, 200, 200 )",pageStroke:null,tandem:Tandem.REQUIRED,tandemNameSuffix:"PageControl",visiblePropertyOptions:{phetioFeatured:!0}},r);assert&&assert(LayoutOrientationValues.includes(o.orientation),`invalid orientation=${o.orientation}`);const n=new PressListener({press:S=>{S.currentTarget instanceof DotNode&&(t.value=S.currentTarget.pageNumber)},tandem:o.tandem.createTandem("pressListener")}),l={lineWidth:o.lineWidth,mouseArea:o.dotMouseAreaDilation===0?null:Shape$1.circle(0,0,o.dotRadius+o.dotMouseAreaDilation),touchArea:o.dotTouchAreaDilation===0?null:Shape$1.circle(0,0,o.dotRadius+o.dotTouchAreaDilation),boundsMethod:"unstroked",cursor:o.interactive?"pointer":null,inputListeners:o.interactive?[n]:[]},h=new FlowBox({orientation:o.orientation,spacing:o.dotSpacing});let g=[];h.boundsProperty.link(()=>{h.center=Vector2.ZERO});const d=S=>{g.forEach(O=>{O.fill=S===O.pageNumber?o.currentPageFill:o.pageFill,O.stroke=S===O.pageNumber?o.currentPageStroke:o.pageStroke})};t.link(d);const A=S=>{assert&&assert(S>=1),g=_.range(0,S).map(O=>new DotNode(O,o.dotRadius,l)),h.children=g,d(t.value)};s.link(A),o.children=[h],super(o),this.disposePageControl=()=>{n.dispose(),s.unlink(A),t.unlink(d)}}dispose(){this.disposePageControl(),super.dispose()}}class DotNode extends Circle{constructor(t,s,r){super(s,r),this.pageNumber=t}}sun.register("PageControl",PageControl);class CarouselComboBox extends WidthSizable(Node$2){constructor(t,s,r){const o=optionize()({itemNodeOptions:{align:"left",overColor:Color.grayColor(245),selectedColor:"yellow",xMargin:6,yMargin:2},carouselOptions:{buttonOptions:{arrowSize:new Dimension2(20,4)},orientation:"vertical",spacing:0,margin:0,itemsPerPage:15},pageControlOptions:{interactive:!0},buttonOptions:{arrowDirection:"down",baseColor:"rgb( 218, 236, 255 )",xMargin:6,yMargin:4},tandem:Tandem.OPTIONAL},r);assert&&assert(o.carouselOptions.orientation==="vertical","orientation must be vertical"),assert&&assert(o.buttonOptions.arrowDirection==="down","arrowDirection must be down"),o.carouselOptions.itemsPerPage=Math.min(o.carouselOptions.itemsPerPage,s.length),o.carouselOptions.tandem=o.carouselOptions.tandem||o.tandem.createTandem("carousel"),o.buttonOptions.tandem=o.buttonOptions.tandem||o.tandem.createTandem("button"),super(),this.a11yNamePropertyMap=ComboBox.getA11yNamePropertyMap(s);const n=new AlignGroup,l=getGroupItemNodes(s,o.tandem.createTandem("items")),h=_.map(s,(Y,Q)=>({createNode:()=>new CarouselItemNode(t,Y,l[Q],n,o.itemNodeOptions)}));assert&&assert(h.length===s.length,"expected a carouselItem for each comboBoxItem");const g=[],d=new Carousel(h,o.carouselOptions);g.push(d);let A=null;d.numberOfPagesProperty.value>1&&(A=new PageControl(d.pageNumberProperty,d.numberOfPagesProperty,combineOptions({orientation:o.carouselOptions.orientation},o.pageControlOptions)),g.push(A));const S=new HBox({spacing:4,children:g}),O=new ComboBoxButton(t,s,l,this.a11yNamePropertyMap,combineOptions({listener:()=>{S.visible=!S.visible},widthSizable:o.widthSizable,localPreferredWidthProperty:this.localPreferredWidthProperty,localMinimumWidthProperty:this.localMinimumWidthProperty},o.buttonOptions)),I=new VBox({spacing:0,align:"left",children:[O,S]});o.children=[I],this.mutate(o);const W=()=>{S.visible=!1};t.link(W);const L={down:Y=>{if(assert&&assert(d.visible,"this listener should be registered only when carousel is visible"),!phet.chipper.isFuzzEnabled()||dotRandom.nextDouble()<.25){const Q=Y.trail;!Q.containsNode(O)&&!Q.containsNode(d)&&(!A||!Q.containsNode(A))&&(S.visible=!1)}}};let H=null;S.visibleProperty.link(Y=>{Y?(assert&&assert(!H,"unexpected display"),H=this.getUniqueTrail().rootNode().getRootedDisplays()[0],H.addInputListener(L)):H&&H.hasInputListener(L)&&(H.removeInputListener(L),H=null)}),this.disposeCarouselComboBox=()=>{t.unlink(W),O.dispose(),A&&A.dispose(),d.dispose(),l.forEach(Y=>Y.dispose())}}dispose(){this.disposeCarouselComboBox(),super.dispose()}}class CarouselItemNode extends Node$2{constructor(t,s,r,o,n){const l=optionize()({align:"left",xMargin:6,yMargin:2,overColor:Color.grayColor(245),selectedColor:"yellow",tandem:Tandem.OPTIONAL},n),h=new AlignBox(r,{xAlign:l.align,group:o}),g=new Rectangle(0,0,1,1);h.boundsProperty.link(S=>{g.setRectBounds(S.dilatedXY(l.xMargin,l.yMargin))}),l.children=[g,h],super(l);const d=new PressListener({press:()=>{t.value=s.value},tandem:l.tandem.createTandem("pressListener")});this.addInputListener(d);const A=new Multilink([t,d.isOverProperty],(S,O)=>{S===s.value?g.fill=l.selectedColor:O?g.fill=l.overColor:g.fill="transparent"});this.disposeCarouselItemNode=()=>{A.dispose()}}dispose(){this.disposeCarouselItemNode(),super.dispose()}}sun.register("CarouselComboBox",CarouselComboBox);const checkEmptySolidShape=new Shape$1("M1120 1280h-832q-66 0 -113 -47t-47 -113v-832q0 -66 47 -113t113 -47h832q66 0 113 47t47 113v832q0 66 -47 113t-113 47zM1408 1120v-832q0 -119 -84.5 -203.5t-203.5 -84.5h-832q-119 0 -203.5 84.5t-84.5 203.5v832q0 119 84.5 203.5t203.5 84.5h832 q119 0 203.5 -84.5t84.5 -203.5z").makeImmutable(),checkSquareOSolidShape=new Shape$1("M1408 606v-318q0 -119 -84.5 -203.5t-203.5 -84.5h-832q-119 0 -203.5 84.5t-84.5 203.5v832q0 119 84.5 203.5t203.5 84.5h832q63 0 117 -25q15 -7 18 -23q3 -17 -9 -29l-49 -49q-10 -10 -23 -10q-3 0 -9 2q-23 6 -45 6h-832q-66 0 -113 -47t-47 -113v-832 q0 -66 47 -113t113 -47h832q66 0 113 47t47 113v254q0 13 9 22l64 64q10 10 23 10q6 0 12 -3q20 -8 20 -29zM1639 1095l-814 -814q-24 -24 -57 -24t-57 24l-430 430q-24 24 -24 57t24 57l110 110q24 24 57 24t57 -24l263 -263l647 647q24 24 57 24t57 -24l110 -110 q24 -24 24 -57t-24 -57z").makeImmutable(),soundURI$5="data:audio/mpeg;base64,//twxAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAARAAAWCgAPDw8PDx4eHh4eHi0tLS0tLTw8PDw8PEtLS0tLS1paWlpaWmlpaWlpaXh4eHh4eIeHh4eHlpaWlpaWpaWlpaWltLS0tLS0w8PDw8PD0tLS0tLS4eHh4eHh8PDw8PDw//////8AAAA3TEFNRTMuOThyAc0AAAAAAAAAABRgJAZTQgAAYAAAFgoMxGP1AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/7cMQAAA7gbOxVvYACW5Fntz3AA5QAAyAQIBEys3MtCTFFg5TGPm8D3KgDTJuEccMxAZkMFHzKy0ykhAROIho0JQOFfTbU8iRzFi4zYwMgBiUFMRDxoHLdpJtwSEMGBAMAKWRFL8swriCVA0i2X2oxYpIxKJZScr2+g+8oCBQ5//5cP////y4P/y4fgEAoFAoFArLYAAAAAAMDYCMx+k2DAeA6MFEIcGgkCIdk1vDGDNcO0Mt0zUwRA+DC3HiMGkE03THtDaEMoMFkBAwKgmzBaBoMAgB8+fQzksxMVigyANDAggAQJN9mcHA4kFpgsEJllrRoCrC05kkQjR0MTisME7eQcphFoRHX7nUoy4CvF0UrhPiwWUy2x/P/PDDn/jLuqAGAAwDcEMMCHBhjCbwtwwKoHpMM+Ev/+3LECwNSzIkWXf2ACj+QoEXu5SkzE0he0zdxYLM8SH/zF7hbcxLcKaMHFCGjA5wQ0wSoE1MK+B4zAZAMwwDwDJMATAJjAxgRc1J/MpODbWY3W8MeEjJxMAAiO5iZUAhUFAIqBAUiEh4OCQSGGHArEVNUyE8wYKmTDJZl8pVXx5IYtUr673fO8xs0t7Ptb8bKV8UnuCIwTR2DLDFMMHUaMyDhPDIsI8M4ME00OMfT/wfHOBoKcxZUYjP9nDXBIzYicDQuIjXdjAyITWM0DiVnjL4Gza8sjHUVTPsCDQw/wMRJhEBZiGHIYMQkLaKoVCMsAmkcYk5vHm0AIAwSGW2TdCGTMcMMCMLyVipZcplALqSm/DURt95nlTdZjvOYyWrK46xN9WogBoCswawJDJACtMW4KExLSlDBsP/7cMQKABFIgQI17gASa5Mjaz3QAE3NLvnQ3agRDJ+DSMbgYExaABTE4EHMFIM4wwBnzAWAVMBYMAwgwkjBjDYNAKwyiLzEKxPMXsGB80aSkKDAQoMWgYtinyYmCYwER4ElzUrDHIBWSrc/T4pDAoBCwVZK7mOFNL3Wh2NUzOn6m+548/kht9JTqojAAAAEgMQKAAAAAAMA8A4wNw8DAgA9MMUIcQhtmGeEGYMAu5gnAomMSHcYCYNBkVBSmS+F8YBgAgGBJMHEU0xtw/zDiLVMxpn4xFAlAGbDnGZJgUfrl2aOjomK8jJwUMhgGABhAFRgKCwUAAu8k437py0SDRp6lj8Bgoski0Ff+++iWkItSgfwrAOkgGWY5f//9ne//7luZoyn9dUFRgAAwIBIw5CYxaOMxUGsxfH/+3LECQNQPJcafd4AGmmS38XvaShMaMQ29Y4HAKZcCMZWigIzAMzxoCgAmHoLiMUTLISzNunD5V0TlJYNXoQzCHBY5jACC4TFgiporE9rpO005iSiseWg60bdWG2ove12Uw7EwqDm/fmUQfYtQ1TWX9eWHZbQWm53a2WrVWZlFN+rfqa0QwzxGjEDGKMJIO8x+AJDCjO1MnMPU5+nqzFkYHM2I20x3iHDBzC1MLsZsxoAeTD9CsMMos8zVDZTN7EePxtJIxYgyDGTB+MPIHowBgGTADBbMMwC8wdAHQgAQwVwPlFxQBAwLQIhICgSXHCUCJKDiKuU7VAVVa7EVuui/6eCOSJLoN/GpSyzj/3aWls7w7EMufvur0t//tfyepULAAMFIm0wPA7iZsMxzQnjI4CXMkIcc3s5sP/7cMQNA1L0jPxPeylKLhGfRe7lKDdTH5GhojDABOMIkYUwNAuTGYGZMKEnMw5RgzDsMvEZsZsuJMGB0IUYbAIphfgdGA+DCYBQfxg1gImBWBMEAOBYBwwDQDk+ESQCASVEjLWMJA2YUAyFiirR2rNnEhGJxRfAMVSYa/K2uxFLZyY9ALryyBa31mHYXsse6+il0QwGAzDEVK6Mc4xQ1IgzDF9B6Npko4yElYDF9IGMnoGwzaSlzxAXzJ51TMYUjdJ8DBIajEz7j4TjDtTFTBaNDKoJjJgVzEJnjFgLzHoWzDQMkaw4TjCgBWmR1ahgHmUObQZ8uBw7/U0NqvX+pi6cMMwCwctZS8lLVXbAUvfaFYaw18B8s95/3a1C+7SqDQADDyGiMrE1QybhITRuVZMKYroyWRTTQ3b/+3LEDQNTCH74T3tJQjOQHwXu5Si1MVYJYyuCnTBmGJMjAKYxKBBjIpHGMVQW4wSBIzHZFRMfdJYzSWXjBrIzMVMOowVQNDBMBfMGAIgGgSmB+AQYB4BKSpgOgCl60STAJAMSVLUGTUnWAwajZPLzVYFySQT3UkGQ6NCofaHDjAkvl+bVW7N37Eb21jAJBdgiffpIYRJMhhFhymNmUUYqY/ZjKjymScW8Y71jZoaoamSqPyY/g7ZnyZZqs8ZmwAx0bSJoXG5vMPJqs3p0j/Jw9JBnWLZq8XZiURphEEQADswVAYwFAQOBwFCwVgaYCAmFADBzYWVPRM3HVLKFzKN0gqUzemZ08y1KNesWma1u3LoakFNh3fx+zpihGmJDu/TVMLUYcyLB+zDTE/M1MgwxgQCTATHNNNW0U//7cMQMg9AYfPgPdylB/o+fQe7hKIkx/DKxKGMy0GoxzTkzcQUzPL00cgQxnZE2mVszgdQzBtM+2AUoKExLAIw9BowtB4w1AQwBBdwQCAxgcCaM4YBCYYkcYQhmxEb0NsmWO6CQ7cnlzmGVwfbmMrP37m5XO///yImYwX+swEB1zFWAWMc8awx9hSzC7C6MewRQ0GiZTadBbMQIRAwOwDTKlXTF1CTLoWjNlbjABMDFJpTCYtT8PIjhwBjDoOAcWhhEEBiCHBhKAwCBAKgqYCgQEAE10MAWSgU5QMG7DnqBsEbG9bNYam3/ksqrXI7d3nQ473nqxvWM8fyYgQolAAMEiHMj0fMTBTM7hoMvhYM9yoMQfQONUNMoiqMESlMJ8AIwfgbzBJBwMMUUUwjAUysDkwNhdDQWDAP/+3LEHgNPbHz+TvsJQeIP30nu4SgDEBEgBhMCgFkwEwEgMBaYAwBCsZWAQzoeAFh9oDBosWZZ0LTk0NOtK5evtb8vns4frSrDV6rhn3mX/zKODLkHIYMQCZgYhqmFwEcYzALBhAg4mG8CAYlrfxg7BhGKuICYF4LBiUM5g8BQMJEzID40bL0xKLYwMmw4t98yiHgzdD8CDkYIBekWYFgqVQAAoAMrCArac7zC5UWADFYMl8ifyiVpZWwyXwywCVyOzey1PX9V/z//1H/TAAAI4AAETSCErTTotzbsTzLs7TNkMzIS0D/pmDHkmTGkczAbByMI0DcwRwAjCZGUMH4AYwoAJjAVFvNh8TgwgASQIAgYHQMpgFgSIIjAXACFgCYeVgMAQBqILBBYAFpTPXTJwz0sdqHWvJOiSP/7cMQ2g0+4fPsu+wlB2Y+eye7hKIdobk7bu6z+13Udv///8x+mpDCjDRMUgCYwUwpDANDLMGcOowyg2jOzJmN+IQoxdAhzDyCdMICkARmmCgImaagmVALmeBoGE+hn+zWGW4/GFgpGG4qFA7jIXiwhLbXYyUKAfF0BSwCg46JXxma6jiKft27aeM5Fnpj1q9Pd/LDOknsP/907tSpADB2CLMPQNoxExQTBCD0MLUPlQwxUOHTr4OtMWsSQwjwjzEJI+AgbpgECSmL0IiYPIIphSAIjxVJu+FmmIeDMYRYOJhPgJGCMBmYB4EpgSAIgoBNEhpw4Ak7jJYAjTP0bAkOG4Dzjj+kISMEUfaki+/1hnhVxgrX//fsv+iBgajjmG8RwZrYgRjCClGBKOgYxwnZii/hmhECgY3z/+3LETgNPqHzuL3spQe2PnYXvYSgNZheg4GK8BOYSgNJhJCIGCQUAYCYMpgyBvmFccYamYOZgDBbhA8RMD4YKYFxgfgWkQDqJCMsFmAUAWrC2VlqYMsCswKppandmgl6WiSMtrfH8prP+5f2anP5//TUwVAaDD0CMMJweQwjQ9jAPBtMvkZk1ysPTdxSzMVkN4xXBYjFLFDHhJTC/BeMYkdUweAJTDKDOMWMc020wDDGGBYMJ8NgweQSUEBgTAamA6AqWRDACBYC0OAebm7ZaFbzgraK/MkcnCWwIl8pvUlUkoMovLcua7lE6L9/rGzQgwLhcTGACZMPoSwEAXmNoDKY/QtJpKfGH4mMuYdw4piNgkGMMBmsa8mOQmmd0OmT6tmD7PASyzt60jOIOzEgHjGAnzKYTTBEOwP/7cMRkA0/EfOgPewlJ4Y4che7hKaAxg2AZECwqApaCgaQLAE8CM5bM3BjTW4arsXJTj45+WRmmvYyigzx3qryX6TVVMAZAtjBIATMwaQB5MB7CmzBlwMgwVcG0MIsQsjIeQ9QwpA7zFxFcMJcBgw8QODBTBGMGoi4w5wlzDcDdMNgHQ06iITGJC2MCcAowBgYDBBAkMe3O4bQOeswgMSROo+8Rd52mMDQuRvhHbcWbq+dqhxm+WrEsAq7n7PIBgBhcmCsB8YaRRphEgWGMiEuYCojRn886GkoJEZ8l4ZoCQa8EmZokiYXg4ZrmwFx5MBQpMvnYP9XXMFCJMVQjMDCRDhKB4o/AEVAwQEGjoC+0AJZ9Whn4OGBTTfNq/EYmmFvf8vuV+3QKIrtLdaoABVmL0GMYzAsRkaD/+3LEeoJPGGLmD/tHCb2MHNnu5ODaGIuDSY9As5uSpwH1AV+BmHjCfE2M2ZQgyTyBgADSYxJWJiCCQmNgEEYgY6hjqo8GEoD2YAYNRg4BtGA4BKdKeCuwsPZ8ieX/WBLiIPqfGQCyVPWoTCI7C4S92FBjSfjcv48++FWulxdwaYAgAdGBYA0Bg+QY+YPOEsGBOAxpggAd6YPSpJmSmAyRgUoBYYH6ATmIKAeYeQmBhABYmVMFaYfQDJiiAxmLsPIZoiwZj+hhiEAwwIASxgA9WQwHgGFBEbEQCsAxhiKy5VXNhEKUAbzyCVU0AxqeszFypzeV+1lUxp/t1eoAQGKQAAwLgljEMBsMhsagwog9DDKAXBAThoRXkmn2R+YLwbhiKDKGPmKUYbAsZgeBOGLuPAYH4JZgdClGJv/7cMSYg87UbNwPe0cJ7o4bAf9hKeN4bVoJ5gtARGA+BwYAYGRg2gYGA2B4VAGwMA4UAByVWFyXtL+xAOqqsAlPplTVneeFaleIT1bDDLDWe/ufoMFUFgwDwxTAlClMAcW8xICNzCmCZM3pz86SyWjJYgzJQNjRiDTAoADJ0kzRIwTIIsTSAdzETNTQ7cjJADDNwLzDUJjAcIFTgLraA5zbN+2zTmVJjNTVmguE/uNS6XNBnPx3YuXbOG96rEXWOs//1f3p///7v0P6qgC4AFgSzBcDvMO8TIeJiBwPBgXhhGCO5QbAYRxi0J5ngVxhyaJkMDhh2HBieeIWGQzlCgwaOM/SmMz1A8xgDMAhMYWBSNZLRLxsK9a64KlrDKr0srbaUz+FmWtJbXH9739l1bm1ffH7f3JV3fv/+3LEsQBPmHDbL3sJQd4N2oHu4OD///X///fpIBBgLAWGCIHaYZgK5g5ATmCSC0YeIZBjkq5GU6LUZykMTGUYWjMYijEYIhcYFhIYNgSZDhKZBPMcfjuNBEUEEAhFUZJwSdMl9JaOKz5DjqhvcvHsVxjMbjCAqV6+9lyLbLv3a0X6ESHnjmkrTgX6ewW628bWpy6aAAAEIBKAAYVGgQJzEA7MHBAeERhQBG6YsEF4lDMeEoCAUYKgI6ZVAYEguZjC2ZGtMcWpghOAQLKNr1LwVPu2Wuurc61Zm1tOXWe/o1tDZJ5cXoLq47k/vbkMSqQ57UHqbUISVThclJqqsAa1V3dqUsXjENcTVSBUCQHmLDZKQCFtO+lwC+DVGKFZhA8Ck5ACX2THBAR54Dl4c+jQuNtZdZ7rPuOGX//7cMTJAk6AYtSvdwcB3graIe684Jd3Kc5TLcMqa1j+V2z++ZfljKYdvVqa/VlNNTWpkJR7VjzOVVd5NBQlGc8z5NIkUcNIozLbzkcqq84/8kUcf1PnK74dLEkq30DAFGtNIonJMclvNIy5wMFJGkUZk4lppFE4ldVr+qreaiclZEjO/scSJEtxTEFNRTMuOTguM6qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqCQACQKKEgQswmgpKTiyiyizTjSizDzDy2eLzc/ypo0osoCEihIoDEA5BDcqWco0FBgUUBgQsQLAzjSizDzDy2drzcqpo0ov/+3LE5QJOoF7PjnWHApQz1oW8mbkoso404so8w+GdnZ4tv//+7VNSUWUWUKEihIELECxAoSBFmHxcNebNGlFmnCRQkCFiBYkUJFAYgWIFgZRZRZh5h9VVVUUJppI1VUxBTUUzLjk4LjNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7cMS2A9IFejpDGM3IAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVU=",soundByteArray$5=base64SoundToByteArray(phetAudioContext$1,soundURI$5),unlock$5=asyncLoader.createLock(soundURI$5),wrappedAudioBuffer$5=new WrappedAudioBuffer;let unlocked$5=!1;const safeUnlock$5=()=>{unlocked$5||(unlock$5(),unlocked$5=!0)},onDecodeSuccess$5=a=>{wrappedAudioBuffer$5.audioBufferProperty.value===null&&(wrappedAudioBuffer$5.audioBufferProperty.set(a),safeUnlock$5())},onDecodeError$5=a=>{console.warn("decode of audio data failed, using stubbed sound, error: "+a),wrappedAudioBuffer$5.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$5()},decodePromise$5=phetAudioContext$1.decodeAudioData(soundByteArray$5.buffer,onDecodeSuccess$5,onDecodeError$5);decodePromise$5&&decodePromise$5.then(a=>{wrappedAudioBuffer$5.audioBufferProperty.value===null&&(wrappedAudioBuffer$5.audioBufferProperty.set(a),safeUnlock$5())}).catch(a=>{console.warn("promise rejection caught for audio decode, error = "+a),safeUnlock$5()});const checkboxCheckedSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$5,{soundClipOptions:{initialOutputLevel:.7},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("checkboxCheckedSoundPlayer",checkboxCheckedSoundPlayer);const soundURI$4="data:audio/mpeg;base64,//swxAAAB3BPLHWkgAEQCy03MPADAYAEAMYCIAZnV5vYJv2ZoxqgRhBhkBBkRJhwZa9g7/tbYe1+jC4beogQMZ4Z5zn7mgQQdxOH//////6SQAIzbNJJdtgAAAAAAHjcV2B1EBJLBB4wV9rCWp5eq0EHE43FpgLhkjdNEqGhFqhSQlQ4TwqZdZ7fN/Hm6YKiu/33NoUAACApAAAI//syxAOCSGxzQ123gDkDjCZJvLDmDQ0HhMRgBVEjBws2OIM9Cky1VU0REAhgK47nqWwHAkIYcB7ePHvXeo2cV1nG4uL6rjXjzXt951bbjQs/hQuyxEeFQaEGUgRohuYvQkhIfrBnlFyQoUla/qMye4qGxUqjhxTJIFPCOfamTewcOH2SkYCFVa21OLZrySygx+bV4B1xgBhA1DB0Bf/7MsQFAAfISyw1x4AxL4ssNzGAAigYRigH0YoI18mGQKOgZ+FY0UWnyRsLJgZYCShStOpdQYKdeV5/q9jbIDYPkLAYtiTETvrZLIYEb2u2uogAAAAAAhkChusjjbfkXleOGpiySKjhjUIlMla3JEsHQqgBs2ns50DIPtDIgjJE46JnUPRPPPOG5G8/yKxQADAZFTP1KgAAIX0AGkv/+zLEA4IIRJ9DPaUAMQuN5o2tmYqinck4ucZbhxEBHFls3WFfhr6dyvz3zgxEmEABChAREwQIwJRfc1jx6QHFWNNqQkrG5wvNNbdf1b//kxUACACHIGAlgmUgpccbebl+BkKCZXQyCAwpKkwRUzEk7AIAwgTBahUNNHisAuFoYmM12rXbbUJ2v5Cwa++fDf///+mgDERUoJgUemjg//swxAUDSExLJi3phxEQCmQBrbx0BkCOdSyG/xxiJyFwYUOAZiABRh0Zh64k8Pj7NAJTjWFStFgyvxBK5IhTLDstCt9Y/SAqpLqiYU1gRqYoIfCMbtwYtoG77YMaQdBGoPhoQOPIxjIsCrswBnOHTzqNAI9TIQEiAQc0oSX9JssKWBt5O9HJA8fEWBHxeXEQzXUAKsQAXwMjEM3O//syxAUCSDxVLM1lJzEbCWPFrmxBNqHM4RC+k5ZUzwUcEaSmKZZCdwJRBNZkJiwDdFN36YdSqdqUT6pYDZ5ScxSDVfZPSpL8M//b6NxDNtjDhTpxDmMDKQMMw1k08tNDTxrGMKLQxRDCMevDKlACBZi1WYsoiEOBwEwdI9e0vdBptNKZfgzJsVH29qtOpUET8k9v4mAAAExTEHgUKP/7MsQEggfQUyJNc0QA2AklmY2YpukjMG6N4KPFG4xmOjdBnIQqBgcbgGQGmcNGdaHtBQplqcsNdnbkroa0zXiUXxyr9wz/WF9usagQAkSHDHulGU3DjA44xIgQwADplHVAGUl7G/MbPAcXSMAgRGUSoN9OUp+zGuLf///V3//+ugKcCSTofFaj5oNcoyUgyJfAIDMwsQBGeEBQiGf/+zLEDgJHUD8UDOksQN6F39wxsAA60sBDGHr5bR5oZBEMkscKhnEIJPCh6j//////+n6AmBgKjhFZNEIgmCyGD2UQjAVEweC2peqxVyOIpL/WDXZ7cNcFTtQdJCEFQVGLPFgaUHJ6dhojDlVttOCJU4BB0qsXplV/tncqptv/p//+n//6abf////9QTTTTRVV9UEJK0kIixWmqoc///swxBiDxvgCi4CEYAgAADSAAAAE/1TTVEWK6UxBTUUzLjk5LjNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",soundByteArray$4=base64SoundToByteArray(phetAudioContext$1,soundURI$4),unlock$4=asyncLoader.createLock(soundURI$4),wrappedAudioBuffer$4=new WrappedAudioBuffer;let unlocked$4=!1;const safeUnlock$4=()=>{unlocked$4||(unlock$4(),unlocked$4=!0)},onDecodeSuccess$4=a=>{wrappedAudioBuffer$4.audioBufferProperty.value===null&&(wrappedAudioBuffer$4.audioBufferProperty.set(a),safeUnlock$4())},onDecodeError$4=a=>{console.warn("decode of audio data failed, using stubbed sound, error: "+a),wrappedAudioBuffer$4.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$4()},decodePromise$4=phetAudioContext$1.decodeAudioData(soundByteArray$4.buffer,onDecodeSuccess$4,onDecodeError$4);decodePromise$4&&decodePromise$4.then(a=>{wrappedAudioBuffer$4.audioBufferProperty.value===null&&(wrappedAudioBuffer$4.audioBufferProperty.set(a),safeUnlock$4())}).catch(a=>{console.warn("promise rejection caught for audio decode, error = "+a),safeUnlock$4()});const checkboxUncheckedSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$4,{soundClipOptions:{initialOutputLevel:.7},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("checkboxUncheckedSoundPlayer",checkboxUncheckedSoundPlayer);const BOOLEAN_VALIDATOR={valueType:"boolean"},SHAPE_MATRIX=m3(.025,0,0,0,-.025,0,0,0,1),uncheckedShape=checkEmptySolidShape.transformed(SHAPE_MATRIX),checkedShape=checkSquareOSolidShape.transformed(SHAPE_MATRIX);class Checkbox extends WidthSizable(Voicing(Node$2)){constructor(t,s,r){var S,O;const o=optionize()({spacing:5,boxWidth:21,checkboxColor:"black",checkboxColorBackground:"white",touchAreaXDilation:0,touchAreaYDilation:0,mouseAreaXDilation:0,mouseAreaYDilation:0,checkedSoundPlayer:checkboxCheckedSoundPlayer,uncheckedSoundPlayer:checkboxUncheckedSoundPlayer,phetioLinkProperty:!0,cursor:"pointer",disabledOpacity:SceneryConstants.DISABLED_OPACITY,tandem:Tandem.REQUIRED,tandemNameSuffix:"Checkbox",phetioEventType:EventType.USER,visiblePropertyOptions:{phetioFeatured:!0},phetioEnabledPropertyInstrumented:!0,phetioReadOnly:PhetioObject.DEFAULT_OPTIONS.phetioReadOnly,phetioFeatured:!0,tagName:"input",inputType:"checkbox",appendDescription:!0,voicingCheckedObjectResponse:null,voicingUncheckedObjectResponse:null,checkedContextResponse:null,uncheckedContextResponse:null,voiceNameResponseOnSelection:!0},r);super(),this._isMouseAreaCustomized=!1,this._isTouchAreaCustomized=!1,this._isSettingAreas=!1;const n=new PhetioAction$1(()=>{t.value=!t.value,validate(t.value,BOOLEAN_VALIDATOR),t.value?(o.checkedSoundPlayer.play(),o.checkedContextResponse&&this.alertDescriptionUtterance(o.checkedContextResponse),this.voicingSpeakResponse({nameResponse:o.voiceNameResponseOnSelection?this.voicingNameResponse:null,objectResponse:Utterance.alertableToText(o.voicingCheckedObjectResponse),contextResponse:Utterance.alertableToText(o.checkedContextResponse)})):(o.uncheckedSoundPlayer.play(),o.uncheckedContextResponse&&this.alertDescriptionUtterance(o.uncheckedContextResponse),this.voicingSpeakResponse({nameResponse:o.voiceNameResponseOnSelection?this.voicingNameResponse:null,objectResponse:Utterance.alertableToText(o.voicingUncheckedObjectResponse),contextResponse:Utterance.alertableToText(o.uncheckedContextResponse)}))},{parameters:[],tandem:o.tandem.createTandem("toggleAction"),phetioDocumentation:"Emits when user input causes the checkbox to toggle, emitting a single arg: the new boolean value of the checkbox state.",phetioReadOnly:!0,phetioEventType:EventType.USER});this.backgroundNode=new Rectangle(0,-o.boxWidth,o.boxWidth*.95,o.boxWidth*.95,o.boxWidth*.2,o.boxWidth*.2,{fill:o.checkboxColorBackground}),this.uncheckedNode=new Path(uncheckedShape,{fill:o.checkboxColor});const l=o.boxWidth/this.uncheckedNode.width;this.uncheckedNode.scale(l),this.checkedNode=new Path(checkedShape,{scale:l,fill:o.checkboxColor});const h=new Node$2({children:[this.backgroundNode,this.checkedNode,this.uncheckedNode]}),g=new Rectangle({});this.children=[h,s,g],this.constraint=new CheckboxConstraint(this,h,this.checkedNode,s,g,o),this.constraint.updateLayout(),s.pickable=!1,s.pdomVisible=!1;const d=new FireListener({fire:()=>n.execute(),tandem:o.tandem.createTandem("fireListener")});this.addInputListener(d);const A=I=>{this.checkedNode.visible=I,this.uncheckedNode.visible=!I,this.pdomChecked=I};t.link(A),this.mutate(o),this.setExcludeLabelSiblingFromInput(),o.phetioLinkProperty&&this.addLinkedElement(t,{tandemName:"property"}),assert&&((O=(S=phet==null?void 0:phet.chipper)==null?void 0:S.queryParameters)!=null&&O.binder)&&InstanceRegistry.registerDataURL("sun","Checkbox",this),this.disposeCheckbox=()=>{g.dispose(),this.backgroundNode.dispose(),this.uncheckedNode.dispose(),this.checkedNode.dispose(),h.dispose(),d.dispose(),t.hasListener(A)&&t.unlink(A),n.dispose()}}dispose(){this.constraint.dispose(),this.disposeCheckbox(),super.dispose()}setCheckboxColorBackground(t){this.backgroundNode.fill=t}set checkboxColorBackground(t){this.setCheckboxColorBackground(t)}get checkboxColorBackground(){return this.getCheckboxColorBackground()}getCheckboxColorBackground(){return this.backgroundNode.fill}setCheckboxColor(t){this.checkedNode.fill=this.uncheckedNode.fill=t}set checkboxColor(t){this.setCheckboxColor(t)}get checkboxColor(){return this.getCheckboxColor()}getCheckboxColor(){return this.checkedNode.fill}setMouseArea(t){return this._isSettingAreas||(this._isMouseAreaCustomized=!0),super.setMouseArea(t)}setTouchArea(t){return this._isSettingAreas||(this._isTouchAreaCustomized=!0),super.setTouchArea(t)}}class CheckboxConstraint extends LayoutConstraint{constructor(t,s,r,o,n,l){super(t),this.checkbox=t,this.checkboxNode=s,this.checkedNode=r,this.content=o,this.rectangle=n,this.options=l,this.checkbox.localPreferredWidthProperty.lazyLink(this._updateLayoutListener),this.addNode(o)}layout(){super.layout();const t=this.createLayoutProxy(this.content),s=t.minimumWidth,r=this.checkedNode.right-this.checkboxNode.left,o=r+this.options.spacing+s,n=Math.max(o,this.checkbox.localPreferredWidth||0);isWidthSizable(this.content)&&this.checkbox.localPreferredWidth!==null&&(t.preferredWidth=n-r-this.options.spacing),t.left=this.checkedNode.right+this.options.spacing,t.centerY=this.checkedNode.centerY,this.rectangle.rectBounds=this.checkboxNode.bounds.union(t.bounds).withMaxX(Math.max(this.checkboxNode.left+n,t.right)),this.checkbox._isSettingAreas=!0,this.checkbox._isTouchAreaCustomized||(this.checkbox.touchArea=this.checkbox.localBounds.dilatedXY(this.options.touchAreaXDilation,this.options.touchAreaYDilation)),this.checkbox._isMouseAreaCustomized||(this.checkbox.mouseArea=this.checkbox.localBounds.dilatedXY(this.options.mouseAreaXDilation,this.options.mouseAreaYDilation)),this.checkbox._isSettingAreas=!1,t.dispose(),this.checkbox.localMinimumWidth=o}dispose(){this.checkbox.localPreferredWidthProperty.unlink(this._updateLayoutListener),super.dispose()}}sun.register("Checkbox",Checkbox);class ClosestDragForwardingListener{constructor(t,s){this.touchThreshold=t,this.mouseThreshold=s,this.items=[]}addDraggableItem(t){this.items.push(t)}removeDraggableItem(t){const s=_.indexOf(this.items,t);assert&&assert(s>=0),this.items.splice(s,1)}down(t){if(t.target===t.currentTarget){let s=0;if(t.pointer.isTouchLike()&&(s=this.touchThreshold),t.pointer instanceof Mouse&&(s=this.mouseThreshold),s){let r=null,o=Number.POSITIVE_INFINITY;const n=t.pointer.point,l=this.items.length;for(let h=0;h<l;h++){const g=this.items[h],d=g.computeDistance(n);d<o&&(o=d,r=g)}r&&o<s&&r.startDrag(t)}}}}sun.register("ClosestDragForwardingListener",ClosestDragForwardingListener);const soundURI$3="data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA//tAwAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAAJAAAIpwB1dXV1dXV1dXV1dZmZmZmZmZmZmZmZt7e3t7e3t7e3t7fDw8PDw8PDw8PDw8/Pz8/Pz8/Pz8/P29vb29vb29vb29vn5+fn5+fn5+fn5/Pz8/Pz8/Pz8/Pz//////////////8AAAAATGF2YzU4LjU0AAAAAAAAAAAAAAAAJAaRAAAAAAAACKfAKvQnAAAAAAD/+9DEAAAOsE9AdZGAK8QbJPc/sEAAG+3c2nDeiOKI2kELTFZOe88bTlVNYoyijKIMQAuIoIxCHLCJXfiAAGBu7u7iwAAQAAAAPH/+hH//+Hh63//h///9Dw//wAHfmHh/+AAH/HDw//AAB2YeHh48AAAAARh4eHjwAAAABGHh4ePAAAAAEYeHh72AAAAAAgIGjKTaAgAAADF5zj41poBnMb3YuDrZ4lswWUT3NCZKkDBJA0IwPgKfMOfCCjBCwXEwfcFTMAZAMjBZAUkwToD3MJ5BHTAtQIwwN8BSIAB8wl6OBagd3mygBhQ4n2aSoGCCpjg+gjBRXLFBUc1FzFBNYIwECT6EgFQMwcYTWZjN8zetdqYr7OMFgASAmvSFbsCMnsyt5YaiLuxmtTc/Ln/zm//y5y5WusNhprzDsst/vn/////VpZTWppVVpaVWt/g0FQVEQVDSu75URBUFREDIKiK5SrP+FQVFAqCpYKgqIgqCoiCoBn+ANTNR9Qnf9QDAyCTMLwPkxiiMzLantMFUFgwBQFzBSBZMAwB1N9D5KowGweiYA8hABLigQAMtuqACgChABghQCoWEwjHHYoeynK7nyOIUWogYdzEPeXRdf/93EzSTPHHzdMvNVURcJrMu1Qn/yNHvOCiTPVcKZ4Jd9aABgZgAGFwCOYpoYBuSTunDGJWAjEDwXoedDHUcykRMOEDRvUyRGWss9DxDsKiq+hoGL/NJcyHaV/WqS10Lj8m4fUgtKwEoz9xzkxTEUiPXSxWZg8dR1MVNFsKnGcb1jVESp/JeehYdKA2B2gsgofDp8OxYwIUg8P0rqp1pfay9SxSMKU/20LvtQgAGPd/rRAMCcC4wNgWTA1E4MctvY19w9jCOB7NS+MOCMKOeAEiDu1gUDLJKSXk1ouM2Jk0RipZHIGzYkvmJZaBsU3Gzw4XvWPBcfkXD2A4lzobX9zU1HmDpxrnji+QYywuly9fWuBN5BIJLLDAbYIBQ4kHywjcRUZY8cHiRAigzC9VahyUolPqupX0+gABK//76tAAEIMMQgEzERTRNAOyvIyKAxHYtOHQKqAwZoGNMV2jipUhKanaYEuqXNAKDJEiQwRbUxSgD//twxOOCDkjjLH3kACIxlCNd7bC8SRNKXVYFRdFKV+4NWSKnVBQOlXSQdGLOhMNRFv8e7///9CeGqkxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqkxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqTEFNRTMuMTAwqqqqqqqqqqqqqqqqqv/7YMT2ABGQoRtPaYVhfw2i9cwkrKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqkxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqTEFNRTMuMTAwqqqqqv/7EMTWA8AAAf4AAAAgAAA0gAAABKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//sQxNYDwAABpAAAACAAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+xDE1gPAAAGkAAAAIAAANIAAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqv/7EMTWA8AAAaQAAAAgAAA0gAAABKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//sQxNYDwAABpAAAACAAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+xDE1gPAAAGkAAAAIAAANIAAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqg==",soundByteArray$3=base64SoundToByteArray(phetAudioContext$1,soundURI$3),unlock$3=asyncLoader.createLock(soundURI$3),wrappedAudioBuffer$3=new WrappedAudioBuffer;let unlocked$3=!1;const safeUnlock$3=()=>{unlocked$3||(unlock$3(),unlocked$3=!0)},onDecodeSuccess$3=a=>{wrappedAudioBuffer$3.audioBufferProperty.value===null&&(wrappedAudioBuffer$3.audioBufferProperty.set(a),safeUnlock$3())},onDecodeError$3=a=>{console.warn("decode of audio data failed, using stubbed sound, error: "+a),wrappedAudioBuffer$3.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$3()},decodePromise$3=phetAudioContext$1.decodeAudioData(soundByteArray$3.buffer,onDecodeSuccess$3,onDecodeError$3);decodePromise$3&&decodePromise$3.then(a=>{wrappedAudioBuffer$3.audioBufferProperty.value===null&&(wrappedAudioBuffer$3.audioBufferProperty.set(a),safeUnlock$3())}).catch(a=>{console.warn("promise rejection caught for audio decode, error = "+a),safeUnlock$3()});const soundURI$2="data:audio/mpeg;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAAEAAAE/QCbm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5vBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHB4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4P////////////////////////////////8AAAAUTEFNRTMuMTAwBJgAAAAAAAAAABUgJAXmQQABpAAABP2CPnqIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//ugxAAAAZABXJQAACjSBy/7MvJBlbA24AeHxx+Z+DJ48Acl/O7e/c+wAAAAAAAEggodS1KhDIMHY9Flj8OAaLhIDnqje9htgSxoj0q3Fksjnr007hUgBFiJkAAAAJRul9HpGarkErUNUSqvEO5RRnr0CYblhVBIAACITTDJN3xrY6pMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpcJoKAAAAAArSgBAzM3OFUFV0GH4AAagOAQ5P8ZoVVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//sgxNoAw8QpV9zxgCg6A+w4kAkEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7EMTlgMI4H1/EgQggMYHqUBQYBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//sQxNYDwAAB/gAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVU=",soundByteArray$2=base64SoundToByteArray(phetAudioContext$1,soundURI$2),unlock$2=asyncLoader.createLock(soundURI$2),wrappedAudioBuffer$2=new WrappedAudioBuffer;let unlocked$2=!1;const safeUnlock$2=()=>{unlocked$2||(unlock$2(),unlocked$2=!0)},onDecodeSuccess$2=a=>{wrappedAudioBuffer$2.audioBufferProperty.value===null&&(wrappedAudioBuffer$2.audioBufferProperty.set(a),safeUnlock$2())},onDecodeError$2=a=>{console.warn("decode of audio data failed, using stubbed sound, error: "+a),wrappedAudioBuffer$2.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$2()},decodePromise$2=phetAudioContext$1.decodeAudioData(soundByteArray$2.buffer,onDecodeSuccess$2,onDecodeError$2);decodePromise$2&&decodePromise$2.then(a=>{wrappedAudioBuffer$2.audioBufferProperty.value===null&&(wrappedAudioBuffer$2.audioBufferProperty.set(a),safeUnlock$2())}).catch(a=>{console.warn("promise rejection caught for audio decode, error = "+a),safeUnlock$2()});const generalBoundaryBoopSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$3,{soundClipOptions:{initialOutputLevel:.2},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("generalBoundaryBoopSoundPlayer",generalBoundaryBoopSoundPlayer);const generalSoftClickSoundPlayer=new SoundClipPlayer(wrappedAudioBuffer$2,{soundClipOptions:{initialOutputLevel:.2},soundManagerOptions:{categoryName:"user-interface"}});tambo.register("generalSoftClickSoundPlayer",generalSoftClickSoundPlayer);const DEFAULT_NUMBER_OF_MIDDLE_THRESHOLDS=5,DEFAULT_MIN_SOUND_PLAYER=new SoundClipPlayer(wrappedAudioBuffer$3,{soundClipOptions:{initialOutputLevel:.2,initialPlaybackRate:1/Math.pow(2,1/6)},soundManagerOptions:{categoryName:"user-interface"}}),DEFAULT_MIDDLE_MOVING_DOWN_SOUND_PLAYER=new SoundClipPlayer(wrappedAudioBuffer$2,{soundClipOptions:{initialOutputLevel:.2,initialPlaybackRate:1/Math.pow(2,1/6)},soundManagerOptions:{categoryName:"user-interface"}}),DEFAULT_VALUE_CONSTRAINT=a=>DotUtils.roundToInterval(a,1e-9),NO_PLAYBACK_RATE_CHANGE=()=>1,STUB_SOUND_PLAYER_FUNCTION=()=>{assert&&assert(!1,"Code error: This is a stubbed function and should never be invoked.")},Na=class Na extends Disposable{constructor(t,s){const r=optionize()({middleMovingUpSoundPlayer:generalSoftClickSoundPlayer,middleMovingDownSoundPlayer:DEFAULT_MIDDLE_MOVING_DOWN_SOUND_PLAYER,middleMovingUpPlaybackRateMapper:NO_PLAYBACK_RATE_CHANGE,middleMovingDownPlaybackRateMapper:NO_PLAYBACK_RATE_CHANGE,numberOfMiddleThresholds:null,interThresholdDelta:null,constrainValue:DEFAULT_VALUE_CONSTRAINT,minSoundPlayer:DEFAULT_MIN_SOUND_PLAYER,maxSoundPlayer:generalBoundaryBoopSoundPlayer,minimumInterMiddleSoundTime:.035},s);assert&&assert(r.minimumInterMiddleSoundTime>=0&&r.minimumInterMiddleSoundTime<1,`unreasonable value for minimumInterMiddleSoundTime: ${r.minimumInterMiddleSoundTime}`),assert&&assert(r.numberOfMiddleThresholds===null||r.interThresholdDelta===null,"cannot specify both the number of middle thresholds and the inter-threshold delta"),assert&&assert(r.numberOfMiddleThresholds===null||Number.isInteger(r.numberOfMiddleThresholds),"numberOfMiddleThresholds must be an integer if specified"),assert&&assert(r.middleMovingUpPlaybackRateMapper===NO_PLAYBACK_RATE_CHANGE||r.middleMovingUpSoundPlayer instanceof SoundClip,"a sound player that supports playback rate changes is required when a playback rate mapper is used"),assert&&assert(r.middleMovingDownPlaybackRateMapper===NO_PLAYBACK_RATE_CHANGE||r.middleMovingDownSoundPlayer instanceof SoundClip,"a sound player that supports playback rate changes is required when a playback rate mapper is used"),r.numberOfMiddleThresholds===null&&r.interThresholdDelta===null&&(r.numberOfMiddleThresholds=DEFAULT_NUMBER_OF_MIDDLE_THRESHOLDS),super(r),this.interThresholdDistance=DEFAULT_NUMBER_OF_MIDDLE_THRESHOLDS,this.valueRangeProperty=t instanceof Range?new TinyProperty(t):t,this.middleMovingUpSoundPlayer=r.middleMovingUpSoundPlayer,this.middleMovingDownSoundPlayer=r.middleMovingDownSoundPlayer,this.middleMovingUpPlaybackRateMapper=r.middleMovingUpPlaybackRateMapper,this.middleMovingDownPlaybackRateMapper=r.middleMovingDownPlaybackRateMapper,this.minSoundPlayer=r.minSoundPlayer,this.maxSoundPlayer=r.maxSoundPlayer,this.minimumInterMiddleSoundTime=r.minimumInterMiddleSoundTime,this.timeOfMostRecentMiddleSound=0,this.constrainValue=r.constrainValue;const o=n=>{r.numberOfMiddleThresholds!==null?this.interThresholdDistance=n.getLength()/(r.numberOfMiddleThresholds+1):r.interThresholdDelta!==null?this.interThresholdDistance=r.interThresholdDelta:(assert&&assert(!1,"should never get here, it is a logic error if we do"),this.interThresholdDistance=n.getLength()/2)};this.valueRangeProperty.link(o),this.disposeEmitter.addListener(()=>{this.valueRangeProperty.unlink(o)})}playSoundIfThresholdReached(t,s){if(t!==s){const r=this.constrainValue(t),o=this.constrainValue(s),n=this.getSurroundingThresholds(o),l=this.getSurroundingThresholds(r),h=n.length===1&&l.length===1&&Math.abs(n[0]-l[0])>this.interThresholdDistance||n.length===1&&l.length===2&&n[0]!==l[0]&&n[0]!==l[1]||n.length===2&&l.length===1&&l[0]!==n[0]&&l[0]!==n[1]||n.length===2&&l.length===2&&l[0]!==n[0],g=l.length===1&&(n.length===2||n[0]!==l[0]);(h||g||r===this.valueRangeProperty.value.min||r===this.valueRangeProperty.value.max)&&this.playSoundForValueChange(t,s)}}playSoundForValueChange(t,s){const r=this.constrainValue(t),o=this.constrainValue(s);if(r!==o||s!==t&&(t===this.valueRangeProperty.value.min||t===this.valueRangeProperty.value.max))if(t===this.valueRangeProperty.value.min&&this.minSoundPlayer!==Na.USE_MIDDLE_SOUND)this.minSoundPlayer.play();else if(t===this.valueRangeProperty.value.max&&this.maxSoundPlayer!==Na.USE_MIDDLE_SOUND)this.maxSoundPlayer.play();else{const n=phetAudioContext$1.currentTime;if(n-this.timeOfMostRecentMiddleSound>this.minimumInterMiddleSoundTime){let l,h;r>o?(l=this.middleMovingUpPlaybackRateMapper,h=this.middleMovingUpSoundPlayer):(l=this.middleMovingUpPlaybackRateMapper,h=this.middleMovingDownSoundPlayer),l!==NO_PLAYBACK_RATE_CHANGE&&h.setPlaybackRate(l(t)),h.play(),this.timeOfMostRecentMiddleSound=n}}}getSurroundingThresholds(t){const r=Math.floor(DotUtils.roundToInterval((t-this.valueRangeProperty.value.min)/this.interThresholdDistance,1e-7)),o=DotUtils.roundToInterval(r*this.interThresholdDistance+this.valueRangeProperty.value.min,1e-7),n=[o];if(o!==t){const l=Math.min(DotUtils.roundToInterval(o+this.interThresholdDistance,1e-7),this.valueRangeProperty.value.max);l>o&&n.push(l)}return n}};Na.NO_SOUND=new Na(new Range(0,1),{middleMovingUpSoundPlayer:nullSoundPlayer,minSoundPlayer:nullSoundPlayer,maxSoundPlayer:nullSoundPlayer}),Na.USE_MIDDLE_SOUND={play:STUB_SOUND_PLAYER_FUNCTION,stop:STUB_SOUND_PLAYER_FUNCTION};let ValueChangeSoundPlayer=Na;tambo.register("ValueChangeSoundPlayer",ValueChangeSoundPlayer);const DEFAULT_TAG_NAME="input",toString$2=a=>`${a}`,DEFAULT_VOICING_ON_END_RESPONSE_OPTIONS={withNameResponse:!1,withObjectResponse:!0,onlyOnValueChange:!0},ACCESSIBLE_VALUE_HANDLER_OPTIONS=["startInput","endInput","onInput","constrainValue","keyboardStep","shiftKeyboardStep","pageKeyboardStep","ariaOrientation","panTargetNode","roundToStepSize","a11yMapPDOMValue","a11yMapValue","a11yRepeatEqualValueText","a11yCreateAriaValueText","a11yCreateContextResponseAlert","contextResponsePerValueChangeDelay","contextResponseMaxDelay","a11yDependencies","voicingOnEndResponseOptions"],AccessibleValueHandler=(a,t)=>{const s=DelayedMutate$1("AccessibleValueHandler",ACCESSIBLE_VALUE_HANDLER_OPTIONS,class extends Voicing(a){constructor(...o){const n=o[t];assert&&assert(n,"providedOptions has required options"),assert&&assert(n.enabledRangeProperty,"enabledRangeProperty is a required option"),assert&&assert(n.valueProperty,"valueProperty is a required option"),assert&&n&&assert(!n.hasOwnProperty("tagName")||n.tagName===null,"AccessibleValueHandler sets its own tagName. Only provide tagName to clear accessible content from the PDOM"),assert&&n&&assert(!n.hasOwnProperty("inputType"),"AccessibleValueHandler sets its own inputType."),assert&&n&&n.roundToStepSize&&assert(n.keyboardStep,"rounding to keyboardStep, define appropriate keyboardStep to round to"),o[t]=optionize()({tagName:DEFAULT_TAG_NAME,inputType:"range"},n),super(...o),this._startInput=_.noop,this._onInput=_.noop,this._endInput=_.noop,this._constrainValue=_.identity,this._a11yMapValue=_.identity,this._panTargetNode=null,this._ariaOrientation=Orientation.HORIZONTAL,this._shiftKey=!1,this._a11yDependencies=[],this._oldValue=null,this._a11yCreateContextResponseAlert=null,this._contextResponseUtterance=new Utterance,this._timesValueTextChangedBeforeAlerting=0,this._contextResponsePerValueChangeDelay=700,this._contextResponseMaxDelay=1500,this._a11yInputHandled=!1,this._blockInput=!1,this._roundToStepSize=!1,this._rangeKeysDown={},this._a11yMapPDOMValue=_.identity,this._a11yCreateAriaValueText=toString$2,this._dependenciesMultilink=null,this._a11yRepeatEqualValueText=!0,this._timesChangedBeforeAlerting=0,this._voicingOnEndResponseOptions=DEFAULT_VOICING_ON_END_RESPONSE_OPTIONS,this._pdomPointer=null,assertHasProperties(this,["inputValue","setPDOMAttribute"]);const l=n.valueProperty,h=n.enabledRangeProperty;n.reverseAlternativeInput?this._valueProperty=new DynamicProperty(new Property(l),{bidirectional:!0,map:A=>h.value.max-A,inverseMap:A=>h.value.max-A}):this._valueProperty=l,this._enabledRangeProperty=h,this._a11yValueTextUpdateListener=this.invalidateAriaValueText.bind(this),this.keyboardStep=(h.get().max-h.get().min)/20,this.shiftKeyboardStep=(h.get().max-h.get().min)/100,this.pageKeyboardStep=(h.get().max-h.get().min)/10,this._valueOnStart=l.value,this.invalidateA11yDependencies();const g=this.invalidateEnabledRange.bind(this);this._enabledRangeProperty.link(g);const d=this.invalidateValueProperty.bind(this);this._valueProperty.link(d),this._pdomPointerListener={interrupt:()=>{this._onInteractionEnd(null)}},this._disposeAccessibleValueHandler=()=>{this._enabledRangeProperty.unlink(g),this._valueProperty.unlink(d),n.reverseAlternativeInput&&(assert&&assert(this._valueProperty instanceof DynamicProperty,"Only a DynamicProperty can be disposed, otherwise this is disposing a Property that AccessibleValueHandler does not have ownership over."),this._valueProperty.dispose()),this._dependenciesMultilink&&this._dependenciesMultilink.dispose(),this._panTargetNode=null,this._a11yDependencies=[]}}set startInput(o){this._startInput=o}get startInput(){return this._startInput}set onInput(o){this._onInput=o}get onInput(){return this._onInput}set endInput(o){this._endInput=o}get endInput(){return this._endInput}set constrainValue(o){this._constrainValue=o}get constrainValue(){return this._constrainValue}set panTargetNode(o){this._panTargetNode=o}get panTargetNode(){return this._panTargetNode}set roundToStepSize(o){this._roundToStepSize=o}get roundToStepSize(){return this._roundToStepSize}set a11yMapPDOMValue(o){this._a11yMapPDOMValue=o,this.invalidateEnabledRange(this._enabledRangeProperty.value),this.invalidateValueProperty(),this.invalidateAriaValueText()}get a11yMapPDOMValue(){return this._a11yMapPDOMValue}set a11yMapValue(o){this._a11yMapValue=o}get a11yMapValue(){return this._a11yMapValue}set a11yRepeatEqualValueText(o){this._a11yRepeatEqualValueText=o,this.invalidateAriaValueText()}get a11yRepeatEqualValueText(){return this._a11yRepeatEqualValueText}set a11yCreateAriaValueText(o){this._a11yCreateAriaValueText=o,this.invalidateAriaValueText()}get a11yCreateAriaValueText(){return this._a11yCreateAriaValueText}set a11yCreateContextResponseAlert(o){this._a11yCreateContextResponseAlert=o}get a11yCreateContextResponseAlert(){return this._a11yCreateContextResponseAlert}set contextResponsePerValueChangeDelay(o){this._contextResponsePerValueChangeDelay=o}get contextResponsePerValueChangeDelay(){return this._contextResponsePerValueChangeDelay}set contextResponseMaxDelay(o){this._contextResponseMaxDelay=o}get contextResponseMaxDelay(){return this._contextResponseMaxDelay}set voicingOnEndResponseOptions(o){this._voicingOnEndResponseOptions=o}get voicingOnEndResponseOptions(){return this._voicingOnEndResponseOptions}invalidateAriaValueText(){this._updateAriaValueText(this._oldValue),this._oldValue=this._valueProperty.value}invalidateEnabledRange(o){const n=this._getMappedValue(o.min),l=this._getMappedValue(o.max);this.setPDOMAttribute("min",n),this.setPDOMAttribute("max",l),this._updateSiblingStepAttribute()}invalidateValueProperty(){const o=this._getMappedValue();this.setPDOMAttribute("aria-valuenow",o),this.inputValue=o}invalidateA11yDependencies(){this._dependenciesMultilink&&this._dependenciesMultilink.dispose(),this._dependenciesMultilink=Multilink.multilinkAny(this._a11yDependencies.concat([this._valueProperty]),this._a11yValueTextUpdateListener)}setA11yDependencies(o){assert&&assert(!o.includes(this._valueProperty),"The value Property is already a dependency, and does not need to be added to this list"),this._a11yDependencies=o,this.invalidateA11yDependencies()}getA11yDependencies(){return this._a11yDependencies}set a11yDependencies(o){this.setA11yDependencies(o)}get a11yDependencies(){return this.getA11yDependencies()}_updateAriaValueText(o){const n=this._getMappedValue(),l=this._a11yCreateAriaValueText(n,this._valueProperty.value,o);let h=PDOMUtils$1.unwrapStringProperty(l);assert&&assert(typeof h=="string");const g=" ";this._a11yRepeatEqualValueText&&this.ariaValueText&&h===this.ariaValueText.replace(new RegExp(g,"g"),"")&&(h=this.ariaValueText+g),this.ariaValueText=h}alertContextResponse(){let o=!1;if(this._a11yCreateContextResponseAlert){const n=this._getMappedValue(),l=this._a11yCreateContextResponseAlert(n,this._valueProperty.value,this._valueOnStart);l&&(this._contextResponseUtterance.alert=l,this.forEachUtteranceQueue(h=>{o||(h.hasUtterance(this._contextResponseUtterance)?(o=!0,this._timesChangedBeforeAlerting++):this._timesChangedBeforeAlerting=1),this._contextResponseUtterance.alertStableDelay=Math.min(this._contextResponseMaxDelay,this._timesChangedBeforeAlerting*this._contextResponsePerValueChangeDelay),h.addToBack(this._contextResponseUtterance)}))}}reset(){this._a11yCreateAriaValueText.reset&&this._a11yCreateAriaValueText.reset(),this._a11yCreateContextResponseAlert&&this._a11yCreateContextResponseAlert.reset&&this._a11yCreateContextResponseAlert.reset(),this._timesChangedBeforeAlerting=0,this._updateAriaValueText(null)}_getMappedValue(o=this._valueProperty.value){return this._a11yMapPDOMValue(o)}getAccessibleValueHandlerInputListener(){return{keydown:this.handleKeyDown.bind(this),keyup:this.handleKeyUp.bind(this),input:this.handleInput.bind(this),change:this.handleChange.bind(this),blur:this.handleBlur.bind(this)}}handleKeyDown(o){const n=o.domEvent,l=KeyboardUtils.getEventCode(n);if(l&&(this._shiftKey=n.shiftKey,KeyboardUtils.isKeyEvent(n,KeyboardUtils.KEY_TAB)&&(this._blockInput=!0),this.enabledProperty.get()&&KeyboardUtils.isRangeKey(n)&&(n.preventDefault(),!n.metaKey))){o.pointer.reserveForKeyboardDrag();let h=!0;this._anyKeysDown()||this._onInteractionStart(o),this._rangeKeysDown[l]=!0;let g=this._valueProperty.get();if(KeyboardUtils.isAnyKeyEvent(n,[KeyboardUtils.KEY_END,KeyboardUtils.KEY_HOME]))l===KeyboardUtils.KEY_END?g=this._enabledRangeProperty.get().max:l===KeyboardUtils.KEY_HOME&&(g=this._enabledRangeProperty.get().min);else{let O;l===KeyboardUtils.KEY_PAGE_UP||l===KeyboardUtils.KEY_PAGE_DOWN?(O=this.pageKeyboardStep,l===KeyboardUtils.KEY_PAGE_UP?g=this._valueProperty.get()+O:l===KeyboardUtils.KEY_PAGE_DOWN&&(g=this._valueProperty.get()-O)):KeyboardUtils.isArrowKey(n)&&(O=n.shiftKey?this.shiftKeyboardStep:this.keyboardStep,h=!n.shiftKey,l===KeyboardUtils.KEY_RIGHT_ARROW||l===KeyboardUtils.KEY_UP_ARROW?g=this._valueProperty.get()+O:(l===KeyboardUtils.KEY_LEFT_ARROW||l===KeyboardUtils.KEY_DOWN_ARROW)&&(g=this._valueProperty.get()-O),this._roundToStepSize&&(g=roundValue(g,this._valueProperty.get(),O)))}const d=this._a11yMapValue(g,this._valueProperty.get());let A=d;h&&(A=this._constrainValue(d)),this._valueProperty.set(DotUtils.clamp(A,this._enabledRangeProperty.get().min,this._enabledRangeProperty.get().max)),this._onInput(o);const S=this._panTargetNode||this;animatedPanZoomSingleton.initialized&&animatedPanZoomSingleton.listener.panToNode(S,!0,S.limitPanDirection)}}handleKeyUp(o){const n=KeyboardUtils.getEventCode(o.domEvent);this._allKeysUp()||(KeyboardUtils.SHIFT_KEYS.includes(n)&&(this._shiftKey=!1),this.enabledProperty.get()&&KeyboardUtils.isRangeKey(o.domEvent)&&(this._rangeKeysDown[n]=!1,this._allKeysUp()&&this._onInteractionEnd(o)))}handleChange(o){this._a11yInputHandled||this.handleInput(o),this._a11yInputHandled=!1}handleInput(o){if(this.enabledProperty.get()&&!this._blockInput){this._a11yInputHandled=!0;let n=this._valueProperty.get();const l=parseFloat(o.domEvent.target.value),h=this._shiftKey?this.shiftKeyboardStep:this.keyboardStep,g=this._getMappedValue();this._onInteractionStart(o),l>g?n=this._valueProperty.get()+h:l<g&&(n=this._valueProperty.get()-h),this._roundToStepSize&&(n=roundValue(n,this._valueProperty.get(),h)),n=DotUtils.clamp(n,this._enabledRangeProperty.get().min,this._enabledRangeProperty.get().max),this._valueProperty.set(this._constrainValue(this._a11yMapValue(n,this._valueProperty.get()))),this._onInput(o),this._onInteractionEnd(o)}this._blockInput=!1}handleBlur(o){this._anyKeysDown()&&this._onInteractionEnd(o),this._shiftKey=!1,this._blockInput=!1,this._rangeKeysDown={}}_onInteractionStart(o){assert&&assert(!this._pdomPointer,"Pointer should have been cleared and detached on end or interrupt."),this._pdomPointer=o.pointer,assert&&assert(this._pdomPointer.attachedListener!==this._pdomPointerListener,"This pointer listener was never removed!"),this._pdomPointer.addInputListener(this._pdomPointerListener,!0),this._valueOnStart=this._valueProperty.value,this._startInput(o)}_onInteractionEnd(o){this._pdomPointer&&(this.alertContextResponse(),this.voicingOnEndResponse(this._valueOnStart),this._endInput(o),assert&&assert(this._pdomPointer.attachedListener===this._pdomPointerListener,"pointer listener should be attached"),this._pdomPointer.removeInputListener(this._pdomPointerListener),this._pdomPointer=null)}setKeyboardStep(o){assert&&assert(o>=0,"keyboard step must be non-negative"),this._keyboardStep=o}set keyboardStep(o){this.setKeyboardStep(o)}get keyboardStep(){return this.getKeyboardStep()}getKeyboardStep(){return this._keyboardStep}setShiftKeyboardStep(o){assert&&assert(o>=0,"shift keyboard step must be non-negative"),this._shiftKeyboardStep=o}set shiftKeyboardStep(o){this.setShiftKeyboardStep(o)}get shiftKeyboardStep(){return this.getShiftKeyboardStep()}getShiftKeyboardStep(){return this._shiftKeyboardStep}getShiftKeyDown(){return this._shiftKey}get shiftKeyDown(){return this.getShiftKeyDown()}setPageKeyboardStep(o){assert&&assert(o>=0,"page keyboard step must be non-negative"),this._pageKeyboardStep=o}set pageKeyboardStep(o){this.setPageKeyboardStep(o)}get pageKeyboardStep(){return this.getPageKeyboardStep()}getPageKeyboardStep(){return this._pageKeyboardStep}setAriaOrientation(o){this._ariaOrientation=o,this.setPDOMAttribute("aria-orientation",o.ariaOrientation)}set ariaOrientation(o){this.setAriaOrientation(o)}get ariaOrientation(){return this._ariaOrientation}getAriaOrientation(){return this._ariaOrientation}_allKeysUp(){return _.every(this._rangeKeysDown,o=>!o)}_anyKeysDown(){return!!_.find(this._rangeKeysDown,o=>o)}_updateSiblingStepAttribute(){let o="any";if(platform.mobileSafari){const n=Math.min(this.keyboardStep,this.shiftKeyboardStep,this.pageKeyboardStep);o=Math.pow(10,-DotUtils.numberOfDecimalPlaces(n));const l=this._getMappedValue(this._enabledRangeProperty.get().min),h=this._getMappedValue(this._enabledRangeProperty.get().max),g=h-l;o/g<1e-5&&(o=h/100,o=Number(o.toPrecision(8)))}this.setPDOMAttribute("step",o)}voicingOnEndResponse(o,n){const l=combineOptions({},this._voicingOnEndResponseOptions,n),h=o!==this._valueProperty.value,g=this._valueProperty.value===this._enabledRangeProperty.value.min||this._valueProperty.value===this._enabledRangeProperty.value.max,d=!!(l.withNameResponse&&this.voicingNameResponse)||!!(l.withObjectResponse&&this.voicingObjectResponse);(!l.onlyOnValueChange||g||h)&&d&&this.voicingSpeakFullResponse({nameResponse:l.withNameResponse?this.voicingNameResponse:null,objectResponse:l.withObjectResponse?this.voicingObjectResponse:null,hintResponse:null})}dispose(){this._disposeAccessibleValueHandler(),super.dispose()}});return s.prototype._mutatorKeys=ACCESSIBLE_VALUE_HANDLER_OPTIONS.concat(s.prototype._mutatorKeys),assert&&assert(s.prototype._mutatorKeys.length===_.uniq(s.prototype._mutatorKeys).length,"duplicate mutator keys in AccessibleValueHandler"),s};sun.register("AccessibleValueHandler",AccessibleValueHandler);const roundValue=function(a,t,s){let r=a;return s!==0&&(r=DotUtils.roundSymmetric(r/s)*s,r=correctRounding(r,t,s)),r},correctRounding=function(a,t,s){let r=a;const o=Math.abs(a-t),n=o>s,l=DotUtils.equalsEpsilon(o,s,1e-14);return n&&!l&&(r+=a>t?-s:s),r};AccessibleValueHandler.DEFAULT_TAG_NAME=DEFAULT_TAG_NAME;const ACCESSIBLE_SLIDER_OPTIONS=["startDrag","drag","endDrag"],AccessibleSlider=(a,t)=>{const s=DelayedMutate$1("AccessibleSlider",ACCESSIBLE_SLIDER_OPTIONS,class extends AccessibleValueHandler(a,t){constructor(...o){const n=o[t];assert&&n&&assert(Object.getPrototypeOf(n)===Object.prototype,"Extra prototype on AccessibleSlider options object is a code smell (or probably a bug)"),assert&&assert(n.startInput===void 0,"AccessibleSlider sets startInput through options.startDrag"),assert&&assert(n.endInput===void 0,"AccessibleSlider sets endInput through options.endDrag"),assert&&assert(n.onInput===void 0,"AccessibleSlider sets onInput through options.drag"),super(...o),this._startDrag=_.noop,this._drag=_.noop,this._endDrag=_.noop,assertHasProperties(this,["addInputListener","removeInputListener"]);const l=this.getAccessibleValueHandlerInputListener();this.addInputListener(l),this._disposeAccessibleSlider=()=>{this.removeInputListener(l)}}set startDrag(o){this._startDrag=o,this.startInput=o}get startDrag(){return this._startDrag}set drag(o){this._drag=o,this.onInput=o}get drag(){return this._drag}set endDrag(o){this._endDrag=o,this.endInput=o}get endDrag(){return this._endDrag}dispose(){this._disposeAccessibleSlider(),super.dispose()}});return s.prototype._mutatorKeys=ACCESSIBLE_SLIDER_OPTIONS.concat(s.prototype._mutatorKeys),assert&&assert(s.prototype._mutatorKeys.length===_.uniq(s.prototype._mutatorKeys).length,"duplicate mutator keys in AccessibleSlider"),s};sun.register("AccessibleSlider",AccessibleSlider);class SliderThumb extends Rectangle{constructor(t){const s=optionize()({size:new Dimension2(22,45),fillHighlighted:"rgb( 71, 207, 255 )",centerLineStroke:"white",fill:"rgb( 50, 145, 184 )",stroke:"black",lineWidth:1,tandem:Tandem.REQUIRED,tandemNameSuffix:"ThumbNode"},t);s.cornerRadius===void 0&&(s.cornerRadius=.25*s.size.width),s.cachedPaints=[s.fill,s.fillHighlighted],super(0,0,s.size.width,s.size.height,s);const r=Rectangle.bounds(this.bounds.dilated(5),{fill:"transparent",localBounds:this.bounds,pickable:!1});this.addChild(r);const o=3;this.addChild(new Path(Shape$1.lineSegment(s.size.width/2,o,s.size.width/2,s.size.height-o),{stroke:s.centerLineStroke}));const n=new PressListener({attach:!1,tandem:Tandem.OPT_OUT});n.isHighlightedProperty.link(l=>{this.fill=l?s.fillHighlighted:s.fill}),this.addInputListener(n)}}sun.register("SliderThumb",SliderThumb);class SliderTick{constructor(t,s,r,o,n,l,h,g,d){this.parent=t,this.value=s,this.label=r,this.labelXProperty=new DerivedProperty([d.valueToPositionProperty],S=>S.evaluate(s)),this.tickNode=new Node$2,t.addChild(this.tickNode);const A=new Path(new Shape$1().moveTo(0,d.top).lineTo(0,d.top-o),{stroke:n,lineWidth:l});this.labelXProperty.link(S=>{A.x=S}),this.tickNode.addChild(A),r&&(this.labelContainer=new Node$2({pickable:!1}),this.tickNode.addChild(this.labelContainer),this.labelContainer.addChild(r),g===Orientation.VERTICAL&&(this.labelContainer.rotation=-SunConstants.SLIDER_VERTICAL_ROTATION),this.labelManualConstraint=ManualConstraint.create(this.tickNode,[A,this.labelContainer],(S,O)=>{O.centerX=S.centerX,O.bottom=S.top-h.tickLabelSpacing}))}dispose(){this.parent.removeChild(this.tickNode),this.labelContainer&&this.labelContainer.dispose(),this.labelXProperty.dispose(),this.labelManualConstraint&&this.labelManualConstraint.dispose()}}sun.register("SliderTick",SliderTick);const DEFAULT_HORIZONTAL_TRACK_SIZE=new Dimension2(100,5),DEFAULT_HORIZONTAL_THUMB_SIZE=new Dimension2(17,34),Pr=class Pr extends Sizable(AccessibleSlider(Node$2,0)){constructor(t,s,r){var ye,Ee;assert&&assertMutuallyExclusiveOptions(r,["thumbNode"],["thumbSize","thumbFill","thumbFillHighlighted","thumbStroke","thumbLineWidth","thumbCenterLineStroke","thumbTouchAreaXDilation","thumbTouchAreaYDilation","thumbMouseAreaXDilation","thumbMouseAreaYDilation"]),assert&&assertMutuallyExclusiveOptions(r,["trackNode"],["trackSize","trackFillEnabled","trackFillDisabled","trackStroke","trackLineWidth","trackCornerRadius"]);const o=optionize()({orientation:Orientation.HORIZONTAL,trackNode:null,trackSize:null,trackFillEnabled:"white",trackFillDisabled:"gray",trackStroke:"black",trackLineWidth:1,trackCornerRadius:0,trackPickable:!0,thumbNode:null,thumbSize:null,thumbFill:"rgb(50,145,184)",thumbFillHighlighted:"rgb(71,207,255)",thumbStroke:"black",thumbLineWidth:1,thumbCenterLineStroke:"white",thumbTouchAreaXDilation:11,thumbTouchAreaYDilation:11,thumbMouseAreaXDilation:0,thumbMouseAreaYDilation:0,thumbYOffset:0,tickLabelSpacing:6,majorTickLength:25,majorTickStroke:"black",majorTickLineWidth:1,minorTickLength:10,minorTickStroke:"black",minorTickLineWidth:1,cursor:"pointer",startDrag:_.noop,drag:_.noop,endDrag:_.noop,constrainValue:_.identity,disabledOpacity:SceneryConstants.DISABLED_OPACITY,soundGenerator:Pr.DEFAULT_SOUND_GENERATOR,valueChangeSoundGeneratorOptions:{},phetioLinkedProperty:null,tandem:Tandem.REQUIRED,tandemNameSuffix:"Slider",phetioType:Pr.SliderIO,phetioFeatured:!0,visiblePropertyOptions:{phetioFeatured:!0},phetioEnabledPropertyInstrumented:!0},r),n=s instanceof Range?new TinyProperty(s):s;if(assert&&assert(o.soundGenerator===Pr.DEFAULT_SOUND_GENERATOR||_.isEmpty(o.valueChangeSoundGeneratorOptions),"options should only be supplied when using default sound generator"),o.soundGenerator===Pr.DEFAULT_SOUND_GENERATOR?o.soundGenerator=new ValueChangeSoundPlayer(n.value,o.valueChangeSoundGeneratorOptions||{}):o.soundGenerator===null&&(o.soundGenerator=ValueChangeSoundPlayer.NO_SOUND),o.soundGenerator!==ValueChangeSoundPlayer.NO_SOUND){let Le=t.value;const Z=o.drag;o.drag=ne=>{ne.isFromPDOM()?o.soundGenerator.playSoundForValueChange(t.value,Le):o.soundGenerator.playSoundIfThresholdReached(t.value,Le),Z(ne),Le=t.value}}o.orientation===Orientation.VERTICAL&&(o.trackSize&&(o.trackSize=o.trackSize.swapped()),o.thumbSize&&(o.thumbSize=o.thumbSize.swapped()),swapObjectKeys(o,"thumbTouchAreaXDilation","thumbTouchAreaYDilation"),swapObjectKeys(o,"thumbMouseAreaXDilation","thumbMouseAreaYDilation")),o.trackSize=o.trackSize||DEFAULT_HORIZONTAL_TRACK_SIZE,o.thumbSize=o.thumbSize||DEFAULT_HORIZONTAL_THUMB_SIZE;const l=o.tandem.createTandem(Pr.THUMB_NODE_TANDEM_NAME);Tandem.VALIDATION&&o.thumbNode&&assert&&assert(o.thumbNode.tandem.equals(l),`Passed-in thumbNode must have the correct tandem. Expected: ${l.phetioID}, actual: ${o.thumbNode.tandem.phetioID}`);const h=o.thumbNode||new SliderThumb({size:o.thumbSize,fill:o.thumbFill,fillHighlighted:o.thumbFillHighlighted,stroke:o.thumbStroke,lineWidth:o.thumbLineWidth,centerLineStroke:o.thumbCenterLineStroke,tandem:l}),g=!o.enabledRangeProperty,d=_.pick(o,Node$2.REQUIRES_BOUNDS_OPTION_KEYS),A=combineOptions({ariaOrientation:o.orientation,valueProperty:t,panTargetNode:h,enabledRangeProperty:o.enabledRangeProperty||(s instanceof Range?new Property(s,{valueType:Range,isValidValue:Le=>Le.min>=s.min&&Le.max<=s.max,tandem:o.tandem.createTandem("enabledRangeProperty"),phetioValueType:Range.RangeIO,phetioDocumentation:"Sliders support two ranges: the outer range which specifies the min and max of the track and the enabledRangeProperty, which determines how low and high the thumb can be dragged within the track."}):s)},o);super(A),this.ticks=createObservableArray(),this.proposedValue=null,this.orientation=A.orientation,this.enabledRangeProperty=A.enabledRangeProperty,this.tickOptions=_.pick(o,"tickLabelSpacing","majorTickLength","majorTickStroke","majorTickLineWidth","minorTickLength","minorTickStroke","minorTickLineWidth");const S=[];this.majorTicksParent=new Node$2,this.minorTicksParent=new Node$2,S.push(this.majorTicksParent),S.push(this.minorTicksParent);const O=o.tandem.createTandem(Pr.TRACK_NODE_TANDEM_NAME);Tandem.VALIDATION&&o.trackNode&&assert&&assert(o.trackNode.tandem.equals(O),`Passed-in trackNode must have the correct tandem. Expected: ${O.phetioID}, actual: ${o.trackNode.tandem.phetioID}`);const I=new Node$2;S.push(I),assert&&assert(A.trackSize,"trackSize should not be null"),this.track=o.trackNode||new DefaultSliderTrack(t,s,{size:A.trackSize,fillEnabled:A.trackFillEnabled,fillDisabled:A.trackFillDisabled,stroke:A.trackStroke,lineWidth:A.trackLineWidth,cornerRadius:A.trackCornerRadius,startDrag:A.startDrag,drag:A.drag,endDrag:A.endDrag,constrainValue:A.constrainValue,enabledRangeProperty:this.enabledRangeProperty,soundGenerator:o.soundGenerator,pickable:A.trackPickable,voicingOnEndResponse:this.voicingOnEndResponse.bind(this),tandem:O}),S.push(this.track),h.setCenterY(this.track.centerY+o.thumbYOffset),S.push(h);const W=new Node$2({children:S});o.orientation===Orientation.VERTICAL&&(W.rotation=SunConstants.SLIDER_VERTICAL_ROTATION),this.addChild(W),!o.thumbNode&&(o.thumbTouchAreaXDilation||o.thumbTouchAreaYDilation)&&(h.touchArea=h.localBounds.dilatedXY(o.thumbTouchAreaXDilation,o.thumbTouchAreaYDilation)),!o.thumbNode&&(o.thumbMouseAreaXDilation||o.thumbMouseAreaYDilation)&&(h.mouseArea=h.localBounds.dilatedXY(o.thumbMouseAreaXDilation,o.thumbMouseAreaYDilation));let L=0,H=t.value;const Y=new DragListener({tandem:h.tandem.createTandem("dragListener"),start:(Le,Z)=>{this.enabledProperty.get()&&(H=t.value,o.startDrag(Le),L=Z.pressedTrail.subtrailTo(W).getTransform().inversePosition2(Le.pointer.point).x-h.centerX)},drag:(Le,Z)=>{if(this.enabledProperty.get()){const Ke=Z.pressedTrail.subtrailTo(W).getTransform().inversePosition2(Le.pointer.point).x-L;this.proposedValue=this.track.valueToPositionProperty.value.inverse(Ke);const _t=this.enabledRangeProperty.get().constrainValue(this.proposedValue);t.set(o.constrainValue(_t)),o.drag(Le)}},end:Le=>{this.enabledProperty.get()&&(o.endDrag(Le),this.voicingOnEndResponse(H)),this.proposedValue=null}});h.addInputListener(Y),this.thumbDragListener=Y,this.trackDragListener=this.track.dragListener;const Q=Multilink.multilink([t,this.track.valueToPositionProperty],(Le,Z)=>{h.centerX=Z.evaluate(Le)}),pe=Le=>{if(!t.isPhetioInstrumented()||!isSettingPhetioStateProperty.value)if(this.proposedValue===null)t.set(DotUtils.clamp(t.value,Le.min,Le.max));else{const Z=DotUtils.clamp(this.proposedValue,Le.min,Le.max),ne=o.constrainValue(Z);t.set(ne)}};this.enabledRangeProperty.link(pe);const de=new SliderConstraint(this,this.track,h,W,o.orientation,I,this.ticks);this.disposeSlider=()=>{de.dispose(),h.dispose&&h.dispose(),this.track.dispose&&this.track.dispose(),g?this.enabledRangeProperty.dispose():this.enabledRangeProperty.unlink(pe),Q.dispose(),Y.dispose()},this.focusHighlight=new HighlightFromNode$1(h),assert&&Tandem.VALIDATION&&assert(!o.phetioLinkedProperty||o.phetioLinkedProperty.isPhetioInstrumented(),"If provided, phetioLinkedProperty should be PhET-iO instrumented");const fe=o.phetioLinkedProperty||(t instanceof ReadOnlyProperty?t:null);fe&&this.addLinkedElement(fe,{tandemName:"valueProperty"}),!g&&this.enabledRangeProperty instanceof ReadOnlyProperty&&this.addLinkedElement(this.enabledRangeProperty,{tandemName:"enabledRangeProperty"}),this.mutate(d),assert&&((Ee=(ye=phet==null?void 0:phet.chipper)==null?void 0:ye.queryParameters)!=null&&Ee.binder)&&InstanceRegistry.registerDataURL("sun","Slider",this)}get majorTicksVisible(){return this.getMajorTicksVisible()}set majorTicksVisible(t){this.setMajorTicksVisible(t)}get minorTicksVisible(){return this.getMinorTicksVisible()}set minorTicksVisible(t){this.setMinorTicksVisible(t)}dispose(){this.disposeSlider(),this.ticks.forEach(t=>{t.dispose()}),super.dispose()}addMajorTick(t,s){this.addTick(this.majorTicksParent,t,s,this.tickOptions.majorTickLength,this.tickOptions.majorTickStroke,this.tickOptions.majorTickLineWidth)}addMinorTick(t,s){this.addTick(this.minorTicksParent,t,s,this.tickOptions.minorTickLength,this.tickOptions.minorTickStroke,this.tickOptions.minorTickLineWidth)}addTick(t,s,r,o,n,l){this.ticks.push(new SliderTick(t,s,r,o,n,l,this.tickOptions,this.orientation,this.track))}setMajorTicksVisible(t){this.majorTicksParent.visible=t}getMajorTicksVisible(){return this.majorTicksParent.visible}setMinorTicksVisible(t){this.minorTicksParent.visible=t}getMinorTicksVisible(){return this.minorTicksParent.visible}};Pr.DEFAULT_SOUND_GENERATOR=new ValueChangeSoundPlayer(new Range(0,1)),Pr.THUMB_NODE_TANDEM_NAME="thumbNode",Pr.TRACK_NODE_TANDEM_NAME="trackNode",Pr.SliderIO=new IOType("SliderIO",{valueType:Pr,documentation:"A traditional slider component, with a knob and possibly tick marks",supertype:Node$2.NodeIO});let Slider=Pr;class SliderConstraint extends LayoutConstraint{constructor(t,s,r,o,n,l,h){super(t),this.slider=t,this.track=s,this.thumb=r,this.sliderPartsNode=o,this.orientation=n,this.trackSpacer=l,this.ticks=h,n===Orientation.HORIZONTAL?(t.heightSizable=!1,this.preferredProperty=this.slider.localPreferredWidthProperty):(t.widthSizable=!1,this.preferredProperty=this.slider.localPreferredHeightProperty),this.preferredProperty.lazyLink(this._updateLayoutListener),this.track.rangeProperty.lazyLink(this._updateLayoutListener),this.thumb.localBoundsProperty.lazyLink(this._updateLayoutListener);const g=d=>{d.tickNode.localBoundsProperty.lazyLink(this._updateLayoutListener),h.addItemRemovedListener(A=>{A===d&&A.tickNode.localBoundsProperty.hasListener(this._updateLayoutListener)&&d.tickNode.localBoundsProperty.unlink(this._updateLayoutListener)})};h.addItemAddedListener(g),this.addNode(s),this.layout(),this.disposeSliderConstraint=()=>{h.removeItemAddedListener(g),this.preferredProperty.unlink(this._updateLayoutListener),this.track.rangeProperty.unlink(this._updateLayoutListener),this.thumb.localBoundsProperty.unlink(this._updateLayoutListener)}}layout(){super.layout();const t=this.slider,s=this.track,r=this.thumb;this.trackSpacer.localBounds=s.localBounds.dilatedX(r.width/2),assert&&assert(s.minimumWidth!==null);const o=s.leftVisualOverflow+s.rightVisualOverflow,n=s.minimumWidth,l=n-o,h=O=>DotUtils.linear(s.rangeProperty.value.min,s.rangeProperty.value.max,0,1,O),g=-r.width/2-s.leftVisualOverflow,d=r.width/2-s.leftVisualOverflow,A=new Range(g,n+d);if(this.ticks.forEach(O=>{const I=l*h(O.value),W=O.tickNode.width/2;A.includeRange(new Range(-W,W).shifted(I))}),t.widthSizable&&this.preferredProperty.value!==null){const O=CompletePiecewiseLinearFunction.max(CompletePiecewiseLinearFunction.linear(1,d),...this.ticks.map(W=>{const L=h(W.value);return CompletePiecewiseLinearFunction.linear(L,W.tickNode.width/2-o*L)})).minus(CompletePiecewiseLinearFunction.min(CompletePiecewiseLinearFunction.constant(g),...this.ticks.map(W=>{const L=h(W.value);return CompletePiecewiseLinearFunction.linear(L,-W.tickNode.width/2-o*L)}))),I=O.withXValues([n-1,n,...O.points.map(W=>W.x).filter(W=>W>n+1e-10)]).inverted();s.preferredWidth=Math.max(n,I.evaluate(this.preferredProperty.value))}else s.preferredWidth=s.minimumWidth;const S=A.getLength();this.orientation===Orientation.HORIZONTAL?t.localMinimumWidth=S:t.localMinimumHeight=S}dispose(){this.disposeSliderConstraint(),super.dispose()}}sun.register("Slider",Slider);class SliderTrack extends WidthSizable(Node$2){constructor(t,s,r,o){super(),this.rangeProperty=r instanceof Range?new TinyProperty(r):r;const n=optionize()({size:new Dimension2(100,5),startDrag:_.noop,drag:_.noop,endDrag:_.noop,constrainValue:_.identity,enabledRangeProperty:this.rangeProperty,soundGenerator:Slider.DEFAULT_SOUND_GENERATOR,valueChangeSoundGeneratorOptions:{},voicingOnEndResponse:_.noop,leftVisualOverflow:0,rightVisualOverflow:0,tandem:Tandem.REQUIRED,tandemNameSuffix:"TrackNode"},o);n.soundGenerator===Slider.DEFAULT_SOUND_GENERATOR?n.soundGenerator=new ValueChangeSoundPlayer(this.rangeProperty.value,n.valueChangeSoundGeneratorOptions||{}):n.soundGenerator===null&&(n.soundGenerator=ValueChangeSoundPlayer.NO_SOUND),this.leftVisualOverflow=n.leftVisualOverflow,this.rightVisualOverflow=n.rightVisualOverflow,this.minimumSize=n.size,this.minimumWidth=this.minimumSize.width,this.internalWidthProperty=new DerivedProperty([this.localPreferredWidthProperty],g=>(g===null?this.minimumSize.width:Math.max(this.minimumSize.width,g))-n.leftVisualOverflow-n.rightVisualOverflow),this.sizeProperty=new DerivedProperty([this.internalWidthProperty],g=>new Dimension2(g,this.minimumSize.height)),this.valueToPositionProperty=new DerivedProperty([this.rangeProperty,this.internalWidthProperty],(g,d)=>new LinearFunction(g.min,g.max,0,d,!0));const l=(g,d)=>{const A=t.value,O=d.subtrailTo(this).getTransform().inversePosition2(g.pointer.point).x,I=this.valueToPositionProperty.value.inverse(O),W=n.enabledRangeProperty.value.constrainValue(I),L=n.constrainValue(W);t.set(L),g.type==="down"&&n.soundGenerator.playSoundIfThresholdReached(L,A)};this.addChild(s);let h=t.value;this.dragListener=new DragListener({tandem:n.tandem.createTandem("dragListener"),start:(g,d)=>{n.startDrag(g),h=t.value,l(g,d.pressedTrail)},drag:(g,d)=>{n.drag(g),l(g,d.pressedTrail)},end:g=>{n.endDrag(g),n.voicingOnEndResponse(h)}}),s.addInputListener(this.dragListener),this.mutate(n),this.disposeSliderTrack=()=>{s.removeInputListener(this.dragListener),this.dragListener.dispose()}}dispose(){this.disposeSliderTrack(),super.dispose()}}sun.register("SliderTrack",SliderTrack);class DefaultSliderTrack extends SliderTrack{constructor(t,s,r){const o=optionize()({fillEnabled:"white",fillDisabled:"gray",stroke:"black",lineWidth:1,cornerRadius:0},r),n=new Rectangle({fill:o.fillDisabled,stroke:o.stroke,lineWidth:o.lineWidth,cornerRadius:o.cornerRadius,cursor:"default",pickable:!1}),l=new Rectangle({fill:o.fillEnabled,stroke:o.stroke,lineWidth:o.lineWidth,cornerRadius:o.cornerRadius}),h=new Node$2({children:[n,l]});super(t,h,s,combineOptions({leftVisualOverflow:o.stroke!==null?o.lineWidth/2:0,rightVisualOverflow:o.stroke!==null?o.lineWidth/2:0},o));const g=Multilink.multilink([o.enabledRangeProperty,this.valueToPositionProperty,this.sizeProperty],(d,A,S)=>{const O=A.evaluate(d.min),I=A.evaluate(d.max);n.setRect(0,0,S.width,S.height),l.setRect(O,0,I-O,S.height)});this.disposeDefaultSliderTrack=()=>{g.dispose()}}dispose(){this.disposeDefaultSliderTrack(),super.dispose()}}sun.register("DefaultSliderTrack",DefaultSliderTrack);const sceneryPhet=new Namespace("sceneryPhet"),joist=new Namespace("joist"),FALLBACK_LOCALE$3="en",availableRuntimeLocales=_.sortBy(Object.keys(phet.chipper.strings),a=>StringUtils.localeToLocalizedName(a).toLowerCase()),isLocaleValid=a=>!!(a&&availableRuntimeLocales.includes(a)),partialLocale=typeof phet.chipper.locale=="string"?phet.chipper.locale.slice(0,2):void 0,validInitialLocale=isLocaleValid(phet.chipper.locale)?phet.chipper.locale:isLocaleValid(partialLocale)?partialLocale:FALLBACK_LOCALE$3;phet.chipper.locale=validInitialLocale;class LocaleProperty extends Property{unguardedSet(t){availableRuntimeLocales.includes(t)?super.unguardedSet(t):assert&&assert(!1,"Unsupported locale: "+t)}}const localeProperty=new LocaleProperty(validInitialLocale,{tandem:Tandem.GENERAL_MODEL.createTandem("localeProperty"),phetioFeatured:!0,phetioValueType:StringIO,validValues:availableRuntimeLocales,phetioDocumentation:"Specifies language currently displayed in the simulation"});var Pd,Ed;if((Ed=(Pd=phet==null?void 0:phet.chipper)==null?void 0:Pd.queryParameters)!=null&&Ed.keyboardLocaleSwitcher){const a=KeyboardUtils.KEY_I,t=KeyboardUtils.KEY_U;globalKeyStateTracker$1.keydownEmitter.addListener(s=>{const r=o=>{s.preventDefault();const l=(availableRuntimeLocales.indexOf(localeProperty.value)+o+availableRuntimeLocales.length)%availableRuntimeLocales.length;localeProperty.value=availableRuntimeLocales[l],console.log(localeProperty.value)};s.ctrlKey&&!s.shiftKey&&!s.metaKey&&!s.altKey&&(KeyboardUtils.isKeyEvent(s,a)?r(1):KeyboardUtils.isKeyEvent(s,t)&&r(-1))})}joist.register("localeProperty",localeProperty);const fallbackLocalesProperty=new Property([],{tandem:Tandem.GENERAL_MODEL.createTandem("fallbackLocalesProperty"),phetioDocumentation:'An ordered list of locales to "fall back" on when a translation is missing for the selected locale, for example: ["es", "de" ]. "en" will always be added to the end of this, because it has guaranteed full coverage of all translated keys.',phetioFeatured:!0,isValidValue:a=>_.every(a,t=>!!localeInfoModule[t]),phetioValueType:ArrayIO(StringIO)});joist.register("fallbackLocalesProperty",fallbackLocalesProperty);const FALLBACK_LOCALE$2="en",localeOrderProperty=new DerivedProperty([localeProperty,fallbackLocalesProperty],(a,t)=>{const s=[a],r=a.slice(0,2);a!==r&&!s.includes(r)&&s.push(r);for(let n=0;n<t.length;n++){const l=t[n];s.includes(l)||s.push(l)}s.includes(FALLBACK_LOCALE$2)||s.push(FALLBACK_LOCALE$2);const o=s.indexOf(FALLBACK_LOCALE$2);return assert&&assert(o>=0,`Required local in localeOrderProperty: ${FALLBACK_LOCALE$2}`),s.slice(0,o+1)});joist.register("localeOrderProperty",localeOrderProperty);const chipper=new Namespace("chipper");class LocalizedStringProperty extends DynamicProperty{constructor(t,s,r){const o=r&&typeof r.phetioReadOnly=="boolean"?r.phetioReadOnly:TandemConstants.PHET_IO_OBJECT_METADATA_DEFAULTS.phetioReadOnly,n=r&&typeof r.phetioFeatured=="boolean"?r.phetioFeatured:!0,l=r&&typeof r.phetioDocumentation=="string"?r.phetioDocumentation:TandemConstants.PHET_IO_OBJECT_METADATA_DEFAULTS.phetioDocumentation;super(localeProperty,{derive:h=>t.getLocaleSpecificProperty(h),bidirectional:!0,phetioValueType:StringIO,phetioState:!1,tandem:s,phetioFeatured:n,phetioReadOnly:o,phetioDocumentation:l}),this.localizedString=t}get stringKey(){return this.localizedString.stringKey}}chipper.register("LocalizedStringProperty",LocalizedStringProperty);const FALLBACK_LOCALE$1="en";class LocalizedString{constructor(t,s,r,o){this.stringKey=t,this.localePropertyMap=new Map,this.initialValues={},this.englishProperty=new TinyProperty(s),this.initialValues[FALLBACK_LOCALE$1]=s,this.localeOrderListener=this.onLocaleOrderChange.bind(this),localeOrderProperty.lazyLink(this.localeOrderListener),this.property=new LocalizedStringProperty(this,r,o),localizedStrings.push(this)}setInitialValue(t,s){this.initialValues[t]=s,this.getLocaleSpecificProperty(t).value=s}getStateDelta(){const t={};return this.usedLocales.forEach(s=>{const r=this.getRawStringValue(s);r!==null&&r!==this.initialValues[s]&&(t[s]=r)}),t}setStateDelta(t){Object.keys(t).forEach(s=>this.getLocaleSpecificProperty(s)),this.usedLocales.forEach(s=>{const r=this.getLocaleSpecificProperty(s),o=this.initialValues[s]!==void 0?this.initialValues[s]:null,n=t[s]!==void 0?t[s]:null;n===null?o===null?r.clearOverride():r.value=o:r.value=n})}getRawStringValue(t){const s=this.getLocaleSpecificProperty(t);return s instanceof TinyOverrideProperty?s.isOverridden?s.value:null:s.value}get usedLocales(){return[FALLBACK_LOCALE$1,...this.localePropertyMap.keys()]}onLocaleOrderChange(t){const s=[...this.usedLocales,...t];for(let r=s.length-1;r>=0;r--){const o=s[r],n=this.getLocaleSpecificProperty(o);n instanceof TinyOverrideProperty&&(n.targetProperty=this.getLocaleSpecificProperty(LocalizedString.getFallbackLocale(o)))}}getLocaleSpecificProperty(t){return t==="en"?this.englishProperty:(this.localePropertyMap.has(t)||this.localePropertyMap.set(t,new TinyOverrideProperty(this.getLocaleSpecificProperty(LocalizedString.getFallbackLocale(t)))),this.localePropertyMap.get(t))}static getFallbackLocale(t){if(t==="en")return"en";const s=localeOrderProperty.value,r=s.indexOf(t);return r>=0?(assert&&assert(s[s.length-1]==="en"),assert&&assert(r+1<s.length),s[r+1]):t.includes("_")?t.slice(0,2):"en"}dispose(){localeOrderProperty.unlink(this.localeOrderListener),this.property.dispose(),arrayRemove(localizedStrings,this)}restoreInitialValue(t){assert&&assert(typeof this.initialValues[t]=="string","initial value expected for",t),this.property.value=this.initialValues[t]}}chipper.register("LocalizedString",LocalizedString);const FALLBACK_LOCALE="en",localizedStrings=[];window.phet.chipper.localizedStrings=localizedStrings;window.phet.chipper.setAllStrings=a=>{localizedStrings.forEach(t=>{t.property.value=a})};const stringKeyToTandemName=a=>a.replace(/(?:[-_\s]\w)/g,t=>t[1].toUpperCase()),StringStateIOType=new IOType("StringStateIO",{valueType:PhetioObject,toStateObject:()=>{const a={};return localizedStrings.forEach(t=>{const s=t.getStateDelta();Object.keys(s).length>0&&(a[t.property.tandem.phetioID]=s)}),{data:a}},stateSchema:{data:ObjectLiteralIO},applyState:(a,t)=>{Object.keys(t.data).forEach(s=>{if(!localizedStrings.find(o=>o.property.tandem.phetioID===s))throw new CouldNotYetDeserializeError}),localizedStrings.forEach(s=>{s.setStateDelta(t.data[s.property.tandem.phetioID]||{})})}});PhetioObject.create({phetioType:StringStateIOType,tandem:Tandem.GENERAL_MODEL.createTandem("stringsState"),phetioDocumentation:"Strings that have changed from their initial values. Each string value is specific to the locale it changed in.",phetioState:!0});const getStringModule=a=>{assert&&assert(typeof phet.chipper.locale=="string","phet.chipper.locale should have been loaded by now"),assert&&assert(Object.keys(localeInfoModule).includes(phet.chipper.locale),"phet.chipper.locale should have been loaded by now"),assert&&assert(phet.chipper.strings,"phet.chipper.strings should have been loaded by now");const t=`${a}/`;let s=Object.keys(phet.chipper.strings[FALLBACK_LOCALE]).filter(o=>o.startsWith(t));phet.chipper.usedStringsEN&&(s=s.filter(o=>phet.chipper.usedStringsEN.hasOwnProperty(o)));const r={};return s.forEach(o=>{const l=o.slice(t.length).split("."),h=l[l.length-1],g=l.slice(0,l.length-1);let d=r,A=t;if(g.forEach((S,O)=>{A+=`${O>0?".":""}${S}`,assert&&assert(typeof d[S]!="string",`It is not allowed to have two different string keys where one is extended by adding a period (.) at the end of the other. The string key ${A} is extended by ${o} in this case, and should be changed.`),d[S]||(d[S]={}),d=d[S]}),assert&&assert(typeof d[h]!="object",`It is not allowed to have two different string keys where one is extended by adding a period (.) at the end of the other. The string key ${o} is extended by another key, something containing ${d[h]&&Object.keys(d[h])}.`),assert&&assert(!d[h],`We should not have defined this place in the object (${o}), otherwise it means a duplicated string key OR extended string key`),typeof d!="string"){let S=Tandem.STRINGS.createTandem(_.camelCase(a));for(let I=0;I<l.length;I++){let W=stringKeyToTandemName(l[I]);if(I===l.length-1){let L=W,H=0,Y=!0;for(;Y;)H++,L=`${W}${H===1?"":H}StringProperty`,Y=S.hasChild(L);W=L}S=S.createTandem(W)}S.phetioID.includes(".a11y.")&&(S=Tandem.OPT_OUT);const O=new LocalizedString(o,phet.chipper.mapString(phet.chipper.strings[FALLBACK_LOCALE][o]),S,phet.chipper.stringMetadata[o]);Object.keys(phet.chipper.strings).forEach(I=>{const W=phet.chipper.strings[I][o];typeof W=="string"&&W!==""&&O.setInitialValue(I,phet.chipper.mapString(W))}),d[`${h}StringProperty`]=O.property,O.property.link(I=>{d[h]=I})}}),r},SceneryPhetStrings=getStringModule("SCENERY_PHET");sceneryPhet.register("SceneryPhetStrings",SceneryPhetStrings);class PDOMSectionNode extends Node$2{constructor(t,s){super(optionize()({containerTagName:"section",tagName:"div",labelContent:t,labelTagName:"h2"},s))}}sceneryPhet.register("PDOMSectionNode",PDOMSectionNode);class ControlAreaNode extends PDOMSectionNode{constructor(t){super(SceneryPhetStrings.a11y.simSection.controlAreaStringProperty,t)}}sceneryPhet.register("ControlAreaNode",ControlAreaNode);class PlayAreaNode extends PDOMSectionNode{constructor(t){super(SceneryPhetStrings.a11y.simSection.playAreaStringProperty,t)}}sceneryPhet.register("PlayAreaNode",PlayAreaNode);class ScreenSummaryNode extends Node$2{constructor(){super(),this.openingSummaryNode=new Node$2({tagName:"p"});const t=new Node$2({tagName:"p",innerContent:SceneryPhetStrings.a11y.simSection.screenSummary.keyboardShortcutsHintStringProperty});this.addChild(this.openingSummaryNode),this.addChild(t),this.pdomOrder=[this.openingSummaryNode,null,t]}setIntroString(t,s,r){this.openingSummaryNode.innerContent=r&&s?StringUtils.fillIn(SceneryPhetStrings.a11y.simSection.screenSummary.multiScreenIntroStringProperty,{screen:s}):StringUtils.fillIn(SceneryPhetStrings.a11y.simSection.screenSummary.singleScreenIntroPatternStringProperty,{sim:t})}}sceneryPhet.register("ScreenSummaryNode",ScreenSummaryNode);const DEFAULT_LAYOUT_BOUNDS=new Bounds2(0,0,1024,618),ul=class ul extends Node$2{constructor(t){const s=optionize()({layoutBounds:DEFAULT_LAYOUT_BOUNDS.copy(),layerSplit:!0,excludeInvisible:!0,tandem:Tandem.REQUIRED,visiblePropertyOptions:{phetioState:!1,phetioReadOnly:!0},containerTagName:"article",tagName:"div",screenSummaryContent:null,includePDOMNodes:!0},t);super(s),this._screenSummaryContent=null,assert&&this.isPhetioInstrumented()&&assert&&assert(s.tandem.name==="view","tandem name should be view"),this.layoutBounds=s.layoutBounds,this.visibleBoundsProperty=new Property(s.layoutBounds),this.pdomTitleNode=new Node$2({tagName:"h1",focusHighlight:"invisible"}),this.pdomPlayAreaNode=new PlayAreaNode,this.pdomControlAreaNode=new ControlAreaNode,this.pdomScreenSummaryNode=new ScreenSummaryNode,s.screenSummaryContent&&this.setScreenSummaryContent(s.screenSummaryContent),this.visibleProperty.lazyLink(r=>{r?(assert&&assert(!this.pdomTitleNode.focusable,"about to set to be focusable"),this.pdomTitleNode.focusable=!0,this.pdomTitleNode.focus()):this.pdomTitleNode.focusable=!1}),this.pdomTitleNode.addInputListener({blur:()=>{this.pdomTitleNode.focusable=!1}}),this.pdomParentNode=new Node$2({children:s.includePDOMNodes?[this.pdomTitleNode,this.pdomScreenSummaryNode,this.pdomControlAreaNode,this.pdomPlayAreaNode]:[this.pdomTitleNode]}),this.addChild(this.pdomParentNode),this.pdomParentNode.pdomOrder=s.includePDOMNodes?[this.pdomTitleNode,this.pdomScreenSummaryNode,this.pdomPlayAreaNode,this.pdomControlAreaNode]:[this.pdomTitleNode]}setPDOMOrder(t){throw new Error("should not need to set accessible order on a ScreenView")}setChildren(t){return Node$2.prototype.setChildren.call(this,t),this.pdomParentNode&&!this.hasChild(this.pdomParentNode)&&(this.addChild(this.pdomParentNode),this.pdomParentNode.moveToBack()),this}getLayoutScale(t){return ul.getLayoutScale(this.layoutBounds,t)}layout(t,s){this.matrix=ul.getLayoutMatrix(this.layoutBounds,t,s),this.visibleBoundsProperty.value=this.parentToLocalBounds(t)}get screenSummaryContent(){return this._screenSummaryContent}set screenSummaryContent(t){this.setScreenSummaryContent(t)}setScreenSummaryContent(t){assert&&assert(t!==this._screenSummaryContent,"this is already the screen summary Node content"),this._screenSummaryContent&&this.pdomScreenSummaryNode.removeChild(this._screenSummaryContent),this._screenSummaryContent=t,t&&this.pdomScreenSummaryNode.addChild(t)}setScreenSummaryIntroAndTitle(t,s,r,o){this.pdomScreenSummaryNode.setIntroString(t,s,o),this.pdomTitleNode.innerContent=r}getVoicingOverviewContent(){throw new Error("The ScreenView should implement getVoicingOverviewContent if Voicing is enabled")}getVoicingDetailsContent(){throw new Error("The ScreenView should implement getVoicingDetailsContent when the Voicing feature is enabled.")}getVoicingHintContent(){throw new Error("The ScreenView should implement getVoicingHintContent when Voicing is enabled.")}interruptSubtreeInput(){var t,s,r;return(r=(s=(t=window.phet)==null?void 0:t.joist)==null?void 0:s.display)==null||r.interruptOtherPointers(),super.interruptSubtreeInput()}static getLayoutScale(t,s){return Math.min(s.width/t.width,s.height/t.height)}static getLayoutMatrix(t,s,r){const o=optionize()({verticalAlign:"center"},r),n=s.width,l=s.height,h=ul.getLayoutScale(t,s);let g=0,d=0;return h===n/t.width?(d=l/h-t.height,o.verticalAlign==="center"&&(d/=2)):h===l/t.height&&(g=(n/h-t.width)/2),Matrix3.rowMajor(h,0,g*h+s.left,0,h,d*h+s.top,0,0,1)}step(t){}};ul.DEFAULT_LAYOUT_BOUNDS=DEFAULT_LAYOUT_BOUNDS;let ScreenView=ul;joist.register("ScreenView",ScreenView);const DARK_GREEN=new Color(0,200,0),RED_COLORBLIND=new Color(255,85,0),GREEN_COLORBLIND=new Color(0,135,0),PHET_LOGO_BLUE=new Color(106,206,245),PHET_LOGO_YELLOW=new Color(254,225,5),PhetColorScheme={ACCELERATION:new Color(255,255,50),APPLIED_FORCE:new Color(236,153,55),BUTTON_YELLOW:PHET_LOGO_YELLOW,ELASTIC_POTENTIAL_ENERGY:new Color(0,204,255),FRICTION_FORCE:RED_COLORBLIND,GRAVITATIONAL_FORCE:new Color(50,130,215),GRAVITATIONAL_POTENTIAL_ENERGY:new Color(55,130,215),HEAT_THERMAL_ENERGY:RED_COLORBLIND,IMAGINARY_PART:new Color(153,51,102),KINETIC_ENERGY:new Color(30,200,45),MOMENTUM:new Color(50,50,255),NET_WORK:DARK_GREEN,NORMAL_FORCE:new Color(255,235,0),PHET_LOGO_BLUE,PHET_LOGO_YELLOW,POSITION:Color.BLUE,REAL_PART:new Color(255,153,0),RED_COLORBLIND,RESET_ALL_BUTTON_BASE_COLOR:new Color(247,151,34),GREEN_COLORBLIND,TOTAL_ENERGY:new Color(180,180,0),TOTAL_FORCE:DARK_GREEN,VELOCITY:new Color(50,255,50),WALL_FORCE:new Color(153,51,0),SCREEN_ICON_FRAME:"#dddddd"};sceneryPhet.register("PhetColorScheme",PhetColorScheme);class CloseButton extends RectangularPushButton{constructor(t){const s=optionize()({iconLength:16,pathOptions:{stroke:"white",lineWidth:2.5,lineCap:"round"},baseColor:PhetColorScheme.RED_COLORBLIND,xMargin:4,yMargin:4,innerContent:SceneryPhetStrings.a11y.closeStringProperty,voicingNameResponse:SceneryPhetStrings.a11y.closeStringProperty},t),r=new Shape$1().moveTo(-s.iconLength/2,-s.iconLength/2).lineTo(s.iconLength/2,s.iconLength/2).moveTo(s.iconLength/2,-s.iconLength/2).lineTo(-s.iconLength/2,s.iconLength/2);s.content=new Path(r,s.pathOptions),super(s)}}sceneryPhet.register("CloseButton",CloseButton);const DynamicMarkerIO=new IOType("DynamicMarkerIO",{supertype:IOType.ObjectIO,applyState:_.noop,toStateObject:()=>({}),isValidValue:_.stubTrue,documentation:"PhET-iO Type used as a place holder for dynamic elements to be created when set for state."});tandemNamespace.register("DynamicMarkerIO",DynamicMarkerIO);const Popupable=(a,t)=>class extends a{constructor(...s){var g;super(...s);const r=s[t]||{},o=s[s.length-1];assert&&assert(o!==void 0,"config object is required for Popupable.");const n=gracefulBind("phet.joist.sim.showPopup"),l=gracefulBind("phet.joist.sim.hidePopup"),h=optionize()({showPopup:n,hidePopup:l,isModal:!0,layoutBounds:null,focusOnShowNode:null,focusOnHideNode:null,disableModals:_.get(window,"phet.chipper.queryParameters.disableModals")||!1},r);assert&&assert(h.isModal,"Non-modal popups not currently supported"),this.layoutBounds=h.layoutBounds,this._focusOnShowNode=h.focusOnShowNode,this.disableModals=h.disableModals,this.isModal=h.isModal,this._focusOnHideNode=h.focusOnHideNode,this._nodeToFocusOnHide=null,this.popupParent=new PopupParentNode(this,{show:this.show.bind(this),hide:this.hide.bind(this),layout:this.layout.bind(this)}),this.isShowingProperty=new BooleanProperty(!1,{tandem:(g=h.tandem)==null?void 0:g.createTandem("isShowingProperty"),phetioReadOnly:!0,phetioFeatured:!0}),this.isShowingProperty.lazyLink(d=>{d?h.showPopup(this.popupParent,h.isModal):h.hidePopup(this.popupParent,h.isModal)})}layout(s){this.layoutBounds&&(this.popupParent.matrix=ScreenView.getLayoutMatrix(this.layoutBounds,s))}shouldShowPopup(){return!(this.isModal&&this.disableModals)}show(){this.shouldShowPopup()&&(this._nodeToFocusOnHide=this._focusOnHideNode||FocusManager.pdomFocusedNode,this.isShowingProperty.value=!0,this._focusOnShowNode&&this._focusOnShowNode.focusable&&this._focusOnShowNode.focus())}hide(){var s;this.interruptSubtreeInput(),this.isShowingProperty.value=!1,this._nodeToFocusOnHide&&this._nodeToFocusOnHide.focusable&&((s=this._nodeToFocusOnHide.instances[0])!=null&&s.visible)&&this._nodeToFocusOnHide.focus()}get focusOnHideNode(){return this._focusOnHideNode}dispose(){this.hide(),this.isShowingProperty.dispose(),super.dispose()}};class PopupParentNode extends Node$2{constructor(t,s){const r=optionize()({children:[t]},s);super(r),this.show=r.show,this.hide=r.hide,this.layout=r.layout}}sun.register("Popupable",Popupable);const SunStrings=getStringModule("SUN");sun.register("SunStrings",SunStrings);const sh=class sh extends Popupable(Panel,1){constructor(t,s){var W;const r=optionize()({xSpacing:10,ySpacing:10,topMargin:15,bottomMargin:15,leftMargin:null,maxWidthMargin:12,maxHeightMargin:12,closeButtonLength:18.2,closeButtonTopMargin:10,closeButtonRightMargin:10,title:null,titleAlign:"center",addAriaLabelledByFromTitle:!0,layoutStrategy:defaultLayoutStrategy,closeButtonListener:()=>this.hide(),closeButtonColor:"black",closeButtonTouchAreaXDilation:0,closeButtonTouchAreaYDilation:0,closeButtonMouseAreaXDilation:0,closeButtonMouseAreaYDilation:0,closeButtonVoicingDialogTitle:null,closeButtonLastInPDOM:!1,openedSoundPlayer:generalOpenSoundPlayer,closedSoundPlayer:generalCloseSoundPlayer,sim:getGlobal("phet.joist.sim"),showCallback:null,hideCallback:null,layoutBounds:ScreenView.DEFAULT_LAYOUT_BOUNDS,focusOnShowNode:null,cornerRadius:10,resize:!0,fill:"white",stroke:"black",backgroundPickable:!0,maxHeight:null,maxWidth:null,tandemNameSuffix:["Dialog",DYNAMIC_ARCHETYPE_NAME],phetioType:sh.DialogIO,phetioState:!0,phetioVisiblePropertyInstrumented:!1,tagName:"div",ariaRole:"dialog"},s);assert&&assert(r.sim,"sim must be provided, as Dialog needs a Sim instance"),assert&&assert(r.xMargin===void 0,"Dialog sets xMargin"),r.xMargin=0,assert&&assert(r.yMargin===void 0,"Dialog sets yMargin"),r.yMargin=0,r.leftMargin===null&&(r.leftMargin=r.xSpacing+r.closeButtonLength+r.closeButtonRightMargin),assert&&assert(r.maxHeight===null||typeof r.maxHeight=="number"),assert&&assert(r.maxWidth===null||typeof r.maxWidth=="number"),!r.maxWidth&&r.layoutBounds&&(r.maxWidth=applyDoubleMargin(r.layoutBounds.width,r.maxWidthMargin)),!r.maxHeight&&r.layoutBounds&&(r.maxHeight=applyDoubleMargin(r.layoutBounds.height,r.maxHeightMargin));const o=new Utterance({priority:Utterance.MEDIUM_PRIORITY,voicingCanAnnounceProperties:[voicingManager$1.voicingFullyEnabledProperty]}),n=new CloseButton({iconLength:r.closeButtonLength,baseColor:"transparent",buttonAppearanceStrategy:ButtonNode.FlatAppearanceStrategy,xMargin:0,yMargin:0,listener:()=>{n.voicingSpeakContextResponse({utterance:o}),r.closeButtonListener()},pathOptions:{stroke:r.closeButtonColor},tandem:(W=r.tandem)==null?void 0:W.createTandem("closeButton"),phetioState:!1,phetioVisiblePropertyInstrumented:!1,phetioEnabledPropertyInstrumented:!1,soundPlayer:nullSoundPlayer,tagName:"button",innerContent:SunStrings.a11y.closeStringProperty,voicingContextResponse:SunStrings.a11y.closedStringProperty});let l;if(r.closeButtonVoicingDialogTitle){const L=typeof r.closeButtonVoicingDialogTitle=="string"?new TinyProperty(r.closeButtonVoicingDialogTitle):r.closeButtonVoicingDialogTitle;l=n.voicingNameResponse=new PatternStringProperty(SunStrings.a11y.titleClosePatternStringProperty,{title:L},{tandem:Tandem.OPT_OUT})}n.touchArea=n.bounds.dilatedXY(r.closeButtonTouchAreaXDilation,r.closeButtonTouchAreaYDilation),n.mouseArea=n.bounds.dilatedXY(r.closeButtonMouseAreaXDilation,r.closeButtonMouseAreaYDilation);let h=[r.title,t];r.closeButtonLastInPDOM?h.push(n):h.unshift(n),h=h.filter(L=>L!=null),assert&&assert(h[0]),r.focusOnShowNode=r.focusOnShowNode?r.focusOnShowNode:h[0].focusable?h[0]:n,assert&&assert(r.focusOnShowNode instanceof Node$2,"should be non-null and defined"),assert&&assert(r.focusOnShowNode.focusable,"focusOnShowNode must be focusable.");const g=new VBox({children:r.title?[r.title,t]:[t],spacing:r.ySpacing,align:r.titleAlign}),d=new AlignBox(g,{topMargin:r.topMargin,bottomMargin:r.bottomMargin,leftMargin:r.leftMargin}),A=new AlignBox(n,{topMargin:r.closeButtonTopMargin,rightMargin:r.closeButtonRightMargin}),S=new HBox({children:[d,A],spacing:r.xSpacing,align:"top"});super(S,r),this.isShowingProperty.lazyLink(L=>{L?(r.openedSoundPlayer.play(),r.showCallback&&r.showCallback()):(r.closedSoundPlayer.play(),r.hideCallback&&r.hideCallback())}),this.sim=r.sim,this.closeButton=n;const O=Multilink.multilink([this.sim.boundsProperty,this.sim.screenBoundsProperty,this.sim.scaleProperty,this.sim.selectedScreenProperty,this.isShowingProperty,this.localBoundsProperty],(L,H,Y)=>{L&&H&&Y&&r.layoutStrategy(this,L,H,Y)});this.pdomOrder=h,r.title&&r.title.tagName&&r.addAriaLabelledByFromTitle&&this.addAriaLabelledbyAssociation({thisElementName:PDOMPeer$1.PRIMARY_SIBLING,otherNode:r.title,otherElementName:PDOMPeer$1.PRIMARY_SIBLING});const I=new KeyboardListener({keys:["escape","tab","shift+tab"],callback:(L,H)=>{assert&&assert(L&&L.domEvent,"event should be non-null and defined for this listener");const Y=L.domEvent;if(H==="escape")Y.preventDefault(),this.hide();else if((H==="tab"||H==="shift+tab")&&FullScreen$1.isFullScreen()){assert&&assert(FocusManager.pdomFocus);const Q=FocusManager.pdomFocus.trail.getUniqueId(),pe=PDOMUtils$1.getNextFocusable().id===Q,de=PDOMUtils$1.getPreviousFocusable().id===Q;pe&&de&&Y.preventDefault()}}});this.addInputListener(I),this.disposeDialog=()=>{O.dispose(),A.dispose(),this.removeInputListener(I),I.dispose(),l&&l.dispose(),n.dispose(),o.dispose(),g.dispose(),S.removeAllChildren(),S.detach()}}dispose(){this.disposeDialog(),super.dispose()}};sh.DialogIO=new IOType("DialogIO",{valueType:sh,supertype:DynamicMarkerIO});let Dialog=sh;function defaultLayoutStrategy(a,t,s,r){a.layoutBounds&&(a.center=a.layoutBounds.center)}function applyDoubleMargin(a,t){return a>t*2?a-t*2:a}sun.register("Dialog",Dialog);class HorizontalAquaRadioButtonGroup extends AquaRadioButtonGroup{constructor(t,s,r){super(t,s,optionize()({orientation:"horizontal"},r))}}sun.register("HorizontalAquaRadioButtonGroup",HorizontalAquaRadioButtonGroup);class HSlider extends Slider{constructor(t,s,r){var o,n;super(t,s,optionize()({orientation:Orientation.HORIZONTAL},r)),assert&&((n=(o=phet==null?void 0:phet.chipper)==null?void 0:o.queryParameters)!=null&&n.binder)&&InstanceRegistry.registerDataURL("sun","HSlider",this)}}sun.register("HSlider",HSlider);class MutableOptionsNode extends Node$2{constructor(t,s,r,o,n){super(),this.nodeProperty=new Property(null),this._constructInstance=()=>Reflect.construct(t,[...s,merge(_.mapValues(o,l=>l.value),r)]),this.multilink=Multilink.multilink(_.values(o),this.replaceCopy.bind(this)),this.mutate(n)}replaceCopy(){const t=this._constructInstance(),s=this.nodeProperty.value;this.nodeProperty.value=t,this.addChild(t),s&&(this.removeChild(s),this.disposeCopy(s))}disposeCopy(t){t.dispose&&t.dispose()}dispose(){this.multilink.dispose(),this.disposeCopy(this.nodeProperty.value),this.nodeProperty.dispose(),super.dispose()}}sun.register("MutableOptionsNode",MutableOptionsNode);const ACCESSIBLE_NUMBER_SPINNER_OPTIONS=["pdomTimerDelay","pdomTimerInterval"],AccessibleNumberSpinner=(a,t)=>{const s=DelayedMutate$1("AccessibleNumberSpinner",ACCESSIBLE_NUMBER_SPINNER_OPTIONS,class extends AccessibleValueHandler(a,t){constructor(...o){const n=o[t];assert&&n&&assert(Object.getPrototypeOf(n)===Object.prototype,"Extra prototype on AccessibleSlider options object is a code smell (or probably a bug)");const l=combineOptions({ariaOrientation:Orientation.VERTICAL},n);o[t]=l,super(...o),this._pdomTimerDelay=400,this._pdomTimerInterval=100,assertHasProperties(this,["addInputListener"]),this._callbackTimer=new CallbackTimer({delay:this._pdomTimerDelay,interval:this._pdomTimerInterval}),this.pdomIncrementDownEmitter=new Emitter({parameters:[{valueType:"boolean"}]}),this.pdomDecrementDownEmitter=new Emitter({parameters:[{valueType:"boolean"}]}),this.setPDOMAttribute("aria-roledescription",SunStrings.a11y.numberSpinnerRoleDescriptionStringProperty);let h=null,g=null;const d={keydown:A=>{if(this.enabledProperty.get()&&KeyboardUtils.isRangeKey(A.domEvent)){const S=A.domEvent;S.preventDefault(),S.metaKey||this._callbackTimer.isRunning()||(this._accessibleNumberSpinnerHandleKeyDown(A),h=this._accessibleNumberSpinnerHandleKeyDown.bind(this,A),g=S,this._callbackTimer.addCallback(h),this._callbackTimer.start())}},keyup:A=>{const S=KeyboardUtils.getEventCode(A.domEvent);KeyboardUtils.isRangeKey(A.domEvent)&&(g&&S===KeyboardUtils.getEventCode(g)&&(this._emitKeyState(A.domEvent,!1),this._callbackTimer.stop(!1),assert&&assert(h),this._callbackTimer.removeCallback(h),h=null,g=null),this.handleKeyUp(A))},blur:A=>{h&&(assert&&assert(g!==null,"key should be down if running downCallback"),this._emitKeyState(g,!1),this._callbackTimer.stop(!1),this._callbackTimer.removeCallback(h)),this.handleBlur(A)},input:this.handleInput.bind(this),change:this.handleChange.bind(this)};this.addInputListener(d),this._disposeAccessibleNumberSpinner=()=>{this._callbackTimer.dispose(),this.pdomIncrementDownEmitter.dispose(),this.pdomDecrementDownEmitter.dispose(),this.removeInputListener(d)}}set pdomTimerDelay(o){this._pdomTimerDelay=o,this._callbackTimer&&(this._callbackTimer.delay=o)}get pdomTimerDelay(){return this._pdomTimerDelay}set pdomTimerInterval(o){this._pdomTimerInterval=o,this._callbackTimer&&(this._callbackTimer.interval=o)}get pdomTimerInterval(){return this._pdomTimerInterval}_accessibleNumberSpinnerHandleKeyDown(o){assert&&assert(o.domEvent,"must have a domEvent"),this.handleKeyDown(o),this._emitKeyState(o.domEvent,!0)}_emitKeyState(o,n){validate(o,{valueType:Event}),KeyboardUtils.isAnyKeyEvent(o,[KeyboardUtils.KEY_UP_ARROW,KeyboardUtils.KEY_RIGHT_ARROW])?this.pdomIncrementDownEmitter.emit(n):KeyboardUtils.isAnyKeyEvent(o,[KeyboardUtils.KEY_DOWN_ARROW,KeyboardUtils.KEY_LEFT_ARROW])&&this.pdomDecrementDownEmitter.emit(n)}dispose(){this._disposeAccessibleNumberSpinner(),super.dispose()}});return s.prototype._mutatorKeys=ACCESSIBLE_NUMBER_SPINNER_OPTIONS.concat(s.prototype._mutatorKeys),assert&&assert(s.prototype._mutatorKeys.length===_.uniq(s.prototype._mutatorKeys).length,"duplicate mutator keys in AccessibleNumberSpinner"),s};sun.register("AccessibleNumberSpinner",AccessibleNumberSpinner);const sceneryPhetQueryParameters=QueryStringMachine.getAll({backgroundColor:{type:"string",defaultValue:"white"},fontFamily:{type:"string",defaultValue:"Arial"}});sceneryPhet.register("sceneryPhetQueryParameters",sceneryPhetQueryParameters);class PhetFont extends Font{constructor(t){assert&&assert(arguments.length===0||arguments.length===1,"Too many arguments");let s;typeof t=="number"||typeof t=="string"?s={size:t}:s=t||{},s=combineOptions({family:sceneryPhetQueryParameters.fontFamily},s),assert&&assert(s.family),s.family=[s.family,"sans-serif"].join(", "),super(s)}}sceneryPhet.register("PhetFont",PhetFont);const MathSymbols={PLUS:"+",MINUS:"−",TIMES:"×",DIVIDE:"÷",DOT:"⋅",UNARY_PLUS:"+",UNARY_MINUS:"-",EQUAL_TO:"=",NOT_EQUAL_TO:"≠",GREATER_THAN:">",LESS_THAN:"<",LESS_THAN_OR_EQUAL:"≤",GREATER_THAN_OR_EQUAL:"≥",PERCENT:"%",INFINITY:"∞",PI:"π",PLUS_MINUS:"±",THETA:"θ",NO_VALUE:"—",DEGREES:"°"};sceneryPhet.register("MathSymbols",MathSymbols);const ButtonStateValues=["up","down","over","out"];class NumberPicker extends AccessibleNumberSpinner(Node$2,0){constructor(t,s,r){var Nt,Gt;const o=optionize()({color:new Color(0,0,255),backgroundColor:"white",cornerRadius:6,xMargin:3,yMargin:3,decimalPlaces:0,font:new PhetFont(24),incrementFunction:Mt=>Mt+1,decrementFunction:Mt=>Mt-1,timerDelay:400,timerInterval:100,noValueString:MathSymbols.NO_VALUE,align:"center",touchAreaXDilation:10,touchAreaYDilation:10,mouseAreaXDilation:0,mouseAreaYDilation:5,backgroundStroke:"gray",backgroundLineWidth:.5,arrowHeight:6,arrowYSpacing:3,arrowStroke:"black",arrowLineWidth:.25,valueMaxWidth:null,onInput:_.noop,incrementEnabledFunction:(Mt,jt)=>Mt!=null&&Mt<jt.max,decrementEnabledFunction:(Mt,jt)=>Mt!=null&&Mt>jt.min,disabledOpacity:SceneryConstants.DISABLED_OPACITY,valueChangedSoundPlayer:generalSoftClickSoundPlayer,boundarySoundPlayer:generalBoundaryBoopSoundPlayer,cursor:"pointer",valueProperty:t,enabledRangeProperty:s,pageKeyboardStep:2,voicingObjectResponse:()=>t.value,tandem:Tandem.REQUIRED,tandemNameSuffix:"Picker",phetioReadOnly:PhetioObject.DEFAULT_OPTIONS.phetioReadOnly,visiblePropertyOptions:{phetioFeatured:!0},phetioEnabledPropertyInstrumented:!0,phetioFeatured:!0},r);o.formatValue||(o.formatValue=Mt=>DotUtils.toFixed(Mt,o.decimalPlaces));let n=null;o.pressedColor===void 0&&(n=new PaintColorProperty(o.color),o.pressedColor=new DerivedProperty([n],Mt=>Mt.darkerColor()));let l=t.value;const h=o.onInput;o.onInput=()=>{h(),t.value!==l&&(t.value===s.get().max||t.value===s.get().min?o.boundarySoundPlayer.play():o.valueChangedSoundPlayer.play()),l=t.value},assert&&assert(!o.keyboardStep,"NumberPicker sets its own keyboardStep"),assert&&assert(!o.shiftKeyboardStep,"NumberPicker sets its own shiftKeyboardStep");const g=o.incrementFunction(t.get())-t.get();o.keyboardStep=g,o.shiftKeyboardStep=g,o.pdomTimerDelay=o.timerDelay,o.pdomTimerInterval=o.timerInterval;const d=_.pick(o,Node$2.REQUIRES_BOUNDS_OPTION_KEYS);super(_.omit(o,Node$2.REQUIRES_BOUNDS_OPTION_KEYS));const A=new StringUnionProperty("up",{validValues:ButtonStateValues}),S=new StringUnionProperty("down",{validValues:ButtonStateValues}),O=new DerivedProperty([t,s],o.incrementEnabledFunction),I=new DerivedProperty([t,s],o.decrementEnabledFunction),W=new Text("",{font:o.font,pickable:!1});let L=s.get().min;const H=[];for(;L<=s.get().max;)H.push(L),L=o.incrementFunction(L),assert&&assert(H.length<5e5,"Don't infinite loop here");let Y=Math.max.apply(null,H.map(Mt=>(W.string=o.formatValue(Mt),W.width)));o.valueMaxWidth!==null&&(Y=Math.min(Y,o.valueMaxWidth));const Q=Y+2*o.xMargin,pe=W.height+2*o.yMargin,de=1,fe=o.cornerRadius;W.maxWidth=Y;const ye=new Path(new Shape$1().arc(fe,fe,fe,Math.PI,Math.PI*3/2,!1).arc(Q-fe,fe,fe,-Math.PI/2,0,!1).lineTo(Q,pe/2+de).lineTo(0,pe/2+de).close(),{pickable:!1}),Ee=new Path(new Shape$1().arc(Q-fe,pe-fe,fe,0,Math.PI/2,!1).arc(fe,pe-fe,fe,Math.PI/2,Math.PI,!1).lineTo(0,pe/2).lineTo(Q,pe/2).close(),{pickable:!1}),Le=new Rectangle(0,0,Q,pe,fe,fe,{pickable:!1,stroke:o.backgroundStroke,lineWidth:o.backgroundLineWidth}),Z=new Dimension2(.5*Q,o.arrowHeight),ne={stroke:o.arrowStroke,lineWidth:o.arrowLineWidth,pickable:!1};this.incrementArrow=new Path(new Shape$1().moveTo(Z.width/2,0).lineTo(Z.width,Z.height).lineTo(0,Z.height).close(),ne),this.incrementArrow.centerX=ye.centerX,this.incrementArrow.bottom=ye.top-o.arrowYSpacing,this.decrementArrow=new Path(new Shape$1().moveTo(Z.width/2,Z.height).lineTo(0,0).lineTo(Z.width,0).close(),ne),this.decrementArrow.centerX=Ee.centerX,this.decrementArrow.top=Ee.bottom+o.arrowYSpacing;const Ke=new Node$2({children:[ye,this.incrementArrow]});Ke.addChild(new Rectangle(Ke.localBounds));const _t=new Node$2({children:[Ee,this.decrementArrow]});_t.addChild(new Rectangle(_t.localBounds)),this.addChild(Ke),this.addChild(_t),this.addChild(Le),this.addChild(W),Ke.touchArea=Shape$1.rectangle(Ke.left-o.touchAreaXDilation/2,Ke.top-o.touchAreaYDilation,Ke.width+o.touchAreaXDilation,Ke.height+o.touchAreaYDilation),_t.touchArea=Shape$1.rectangle(_t.left-o.touchAreaXDilation/2,_t.top,_t.width+o.touchAreaXDilation,_t.height+o.touchAreaYDilation),Ke.mouseArea=Shape$1.rectangle(Ke.left-o.mouseAreaXDilation/2,Ke.top-o.mouseAreaYDilation,Ke.width+o.mouseAreaXDilation,Ke.height+o.mouseAreaYDilation),_t.mouseArea=Shape$1.rectangle(_t.left-o.mouseAreaXDilation/2,_t.top,_t.width+o.mouseAreaXDilation,_t.height+o.mouseAreaYDilation);const xe={up:o.color,over:o.color,down:o.pressedColor,out:o.color,disabled:"rgb(176,176,176)"},Ct=createVerticalGradient(o.color,o.backgroundColor,o.color,pe),zt=createVerticalGradient(o.pressedColor,o.backgroundColor,o.pressedColor,pe),Je={up:o.backgroundColor,over:Ct,down:zt,out:zt,disabled:o.backgroundColor},Et={fireOnHold:!0,fireOnHoldDelay:o.timerDelay,fireOnHoldInterval:o.timerInterval};this.incrementInputListener=new NumberPickerInputListener(A,combineOptions({tandem:o.tandem.createTandem("incrementInputListener"),fire:Mt=>{t.set(Math.min(o.incrementFunction(t.get()),s.get().max)),o.onInput(Mt),this.voicingSpeakFullResponse({nameResponse:null,hintResponse:null})}},Et)),Ke.addInputListener(this.incrementInputListener),this.decrementInputListener=new NumberPickerInputListener(S,combineOptions({tandem:o.tandem.createTandem("decrementInputListener"),fire:Mt=>{t.set(Math.max(o.decrementFunction(t.get()),s.get().min)),o.onInput(Mt),this.voicingSpeakFullResponse({nameResponse:null,hintResponse:null})}},Et)),_t.addInputListener(this.decrementInputListener),O.link(Mt=>{!Mt&&this.incrementInputListener.interrupt(),Ke.pickable=Mt}),I.link(Mt=>{!Mt&&this.decrementInputListener.interrupt(),_t.pickable=Mt});const ht=Mt=>{if(Mt==null)W.string=o.noValueString,W.x=(Q-W.width)/2;else if(W.string=o.formatValue(Mt),o.align==="center")W.centerX=ye.centerX;else if(o.align==="right")W.right=ye.right-o.xMargin;else if(o.align==="left")W.left=ye.left+o.xMargin;else throw new Error(`unsupported value for options.align: ${o.align}`);W.centerY=pe/2};t.link(ht),Multilink.multilink([A,O],(Mt,jt)=>{updateColors(Mt,jt,ye,this.incrementArrow,Je,xe)}),Multilink.multilink([S,I],(Mt,jt)=>{updateColors(Mt,jt,Ee,this.decrementArrow,Je,xe)});const mt=this.localBounds.dilated(HighlightPath$1.getDilationCoefficient(this));this.focusHighlight=new HighlightPath$1(Shape$1.roundedRectangleWithRadii(mt.minX,mt.minY,mt.width,mt.height,{topLeft:o.cornerRadius,topRight:o.cornerRadius,bottomLeft:o.cornerRadius,bottomRight:o.cornerRadius})),this.pdomIncrementDownEmitter.addListener(Mt=>{A.value=Mt?"down":"up"}),this.pdomDecrementDownEmitter.addListener(Mt=>{S.value=Mt?"down":"up"}),this.addLinkedElement(t,{tandemName:"valueProperty"}),this.mutate(d),this.disposeNumberPicker=()=>{n&&n.dispose(),O.dispose(),I.dispose(),t.hasListener(ht)&&t.unlink(ht)},assert&&((Gt=(Nt=phet==null?void 0:phet.chipper)==null?void 0:Nt.queryParameters)!=null&&Gt.binder)&&InstanceRegistry.registerDataURL("scenery-phet","NumberPicker",this)}static createIcon(t,s){const r=optionize()({highlightIncrement:!1,highlightDecrement:!1,range:new Range(t-1,t+1),numberPickerOptions:{pickable:!1,tandem:Tandem.OPT_OUT}},s),o=new NumberPicker(new NumberProperty(t),new Property(r.range),r.numberPickerOptions);return o.removeFromPDOM(),r.highlightDecrement&&(o.decrementInputListener.isOverProperty.value=!0),r.highlightIncrement&&(o.incrementInputListener.isOverProperty.value=!0),o}dispose(){this.disposeNumberPicker(),super.dispose()}setArrowsVisible(t){t||(this.incrementInputListener.interrupt(),this.decrementInputListener.interrupt()),this.incrementArrow.visible=t,this.decrementArrow.visible=t}}class NumberPickerInputListener extends FireListener{constructor(t,s){super(s),Multilink.multilink([this.isOverProperty,this.isPressedProperty],(r,o)=>{t.set(r&&!o?"over":r&&o?"down":!r&&!o?"up":"out")})}}function createVerticalGradient(a,t,s,r){return new LinearGradient(0,0,0,r).addColorStop(0,a).addColorStop(.5,t).addColorStop(1,s)}function updateColors(a,t,s,r,o,n){if(t)if(r.stroke="black",a==="up")s.fill=o.up,r.fill=n.up;else if(a==="over")s.fill=o.over,r.fill=n.over;else if(a==="down")s.fill=o.down,r.fill=n.down;else if(a==="out")s.fill=o.out,r.fill=n.out;else throw new Error(`unsupported buttonState: ${a}`);else s.fill=o.disabled,r.fill=n.disabled,r.stroke=n.disabled}sun.register("NumberPicker",NumberPicker);const DEFAULT_FONT=new PhetFont(20),ALIGN_VALUES=["center","left","right"],DEFAULT_DECIMAL_PLACES=0,nh=class nh extends Node$2{constructor(t,s,r){var de,fe,ye,Ee;const o=optionize()({align:"right",valuePattern:SunConstants.VALUE_NAMED_PLACEHOLDER,decimalPlaces:DEFAULT_DECIMAL_PLACES,numberFormatter:null,numberFormatterDependencies:[],useRichText:!1,useFullHeight:!1,textOptions:{font:DEFAULT_FONT,fill:"black",maxWidth:null,phetioReadOnly:!0},xMargin:8,yMargin:2,cornerRadius:0,backgroundFill:"white",backgroundStroke:"lightGray",backgroundLineWidth:1,backgroundLineDash:[],minBackgroundWidth:0,noValueString:MathSymbols.NO_VALUE,noValueAlign:null,noValuePattern:null,tandem:Tandem.OPT_OUT,phetioType:nh.NumberDisplayIO},r);if(assert){const Le=!!o.numberFormatter,Z=o.decimalPlaces!==DEFAULT_DECIMAL_PLACES,ne=o.valuePattern!==SunConstants.VALUE_NAMED_PLACEHOLDER,Ke=Z||ne;(Le||Ke)&&assert&&assert(Le!==Ke,"options.numberFormatter is mutually exclusive with options.valuePattern and options.decimalPlaces")}const n=new TinyProperty(o.numberFormatter?o.numberFormatter:Le=>o.decimalPlaces===null?`${Le}`:DotUtils.toFixed(Le,o.decimalPlaces));assert&&assert(!o.hasOwnProperty("unitsNode"),"unitsNode is not a supported option"),assert&&assert(_.includes(ALIGN_VALUES,o.align),`invalid align: ${o.align}`),o.noValueAlign||(o.noValueAlign=o.align),assert&&assert(_.includes(ALIGN_VALUES,o.noValueAlign),`invalid noValueAlign: ${o.noValueAlign}`),assert&&assert(o.textOptions,"did you accidentally set textOptions to null?");const l=Le=>Le.includes(SunConstants.VALUE_NUMBERED_PLACEHOLDER)?StringUtils.format(Le,SunConstants.VALUE_NAMED_PLACEHOLDER):Le,h=typeof o.valuePattern=="string"?new TinyProperty(l(o.valuePattern)):new DerivedProperty([o.valuePattern],l);assert&&assert(!!((fe=(de=phet==null?void 0:phet.chipper)==null?void 0:de.queryParameters)!=null&&fe.stringTest)||h.value.includes(SunConstants.VALUE_NAMED_PLACEHOLDER),`missing value placeholder in options.valuePattern: ${h.value}`),o.noValuePattern||(o.noValuePattern=new DerivedProperty([h],Le=>Le));const g=typeof o.noValuePattern=="string"?new TinyProperty(o.noValuePattern):o.noValuePattern;assert&&assert(!!((Ee=(ye=phet==null?void 0:phet.chipper)==null?void 0:ye.queryParameters)!=null&&Ee.stringTest)||g.value.includes(SunConstants.VALUE_NAMED_PLACEHOLDER),`missing value placeholder in options.noValuePattern: ${g.value}`);const d=DerivedProperty.deriveAny([n,...o.numberFormatterDependencies],()=>valueToString(s.min,o.noValueString,n.value)),A=DerivedProperty.deriveAny([n,...o.numberFormatterDependencies],()=>valueToString(s.max,o.noValueString,n.value)),S=new DerivedProperty([h,d,A],(Le,Z,ne)=>StringUtils.fillIn(Le,{value:Z.length>ne.length?Z:ne})),O=o.useRichText?RichText:Text,I=o.textOptions.tandem||o.tandem.createTandem("valueText"),W=DerivedProperty.deriveAny([t,g,h,n,...o.numberFormatterDependencies],()=>{const Le=t.value,Z=g.value,ne=h.value,Ke=n.value,_t=Le===null&&Z?Z:ne,xe=valueToString(Le,o.noValueString,Ke);return StringUtils.fillIn(_t,{value:xe})},{phetioFeatured:!0,phetioValueType:StringIO,tandemNameSuffix:"StringProperty",tandem:I.createTandem(Text.STRING_PROPERTY_TANDEM_NAME)}),L=combineOptions({tandem:I},o.textOptions,{maxWidth:null}),H=new O(W,L),Y=H.height,Q=new Rectangle({cornerRadius:o.cornerRadius,fill:o.backgroundFill,stroke:o.backgroundStroke,lineWidth:o.backgroundLineWidth,lineDash:o.backgroundLineDash});S.link(Le=>{const Z=new O(Le,_.omit(L,"tandem"));H.maxWidth=o.textOptions.maxWidth!==null?o.textOptions.maxWidth:Z.width!==0?Z.width:null,Z.maxWidth=H.maxWidth,Q.rectWidth=Math.max(o.minBackgroundWidth,Z.width+2*o.xMargin),Q.rectHeight=(o.useFullHeight?Y:Z.height)+2*o.yMargin});const pe=new Node$2({children:[H]});o.children=[Q,pe],super(),this.numberFormatterProperty=n,this.valueText=H,this.backgroundNode=Q,ManualConstraint.create(this,[pe,Q],(Le,Z)=>{const ne=t.value===null?o.noValueAlign:o.align,Ke=Z.centerY;ne==="center"?Le.center=new Vector2(Z.centerX,Ke):ne==="left"?Le.leftCenter=new Vector2(Z.left+o.xMargin,Ke):Le.rightCenter=new Vector2(Z.right-o.xMargin,Ke)}),this.mutate(o),this.disposeNumberDisplay=()=>{W.dispose(),h.dispose()}}dispose(){this.disposeNumberDisplay(),super.dispose()}setNumberFont(t){this.valueText.font=t}set numberFont(t){this.setNumberFont(t)}setNumberFill(t){this.valueText.fill=t}set numberFill(t){this.setNumberFill(t)}setBackgroundFill(t){this.backgroundNode.fill=t}set backgroundFill(t){this.setBackgroundFill(t)}get backgroundFill(){return this.getBackgroundFill()}getBackgroundFill(){return this.backgroundNode.fill}setBackgroundStroke(t){this.backgroundNode.stroke=t}set backgroundStroke(t){this.setBackgroundStroke(t)}getBackgroundWidth(){return this.backgroundNode.getRectWidth()}setBackgroundWidth(t){this.backgroundNode.setRectWidth(t)}get backgroundWidth(){return this.getBackgroundWidth()}set backgroundWidth(t){this.setBackgroundWidth(t)}};nh.NumberDisplayIO=new IOType("NumberDisplayIO",{valueType:nh,supertype:Node$2.NodeIO,documentation:"A numeric readout with a background"});let NumberDisplay=nh;sceneryPhet.register("NumberDisplay",NumberDisplay);const valueToString=(a,t,s)=>{let r=t;return a!==null&&(r=s(a)),r},DEFAULT_ARROW_HEIGHT=20;class ArrowButton extends RectangularPushButton{constructor(t,s,r){const o=optionize()({cursor:"pointer",baseColor:"white",stroke:"black",lineWidth:1,cornerRadius:4,xMargin:7,yMargin:5,touchAreaXDilation:7,touchAreaYDilation:7,arrowHeight:DEFAULT_ARROW_HEIGHT,arrowWidth:DEFAULT_ARROW_HEIGHT*Math.sqrt(3)/2,arrowFill:"black",arrowStroke:null,arrowLineWidth:1,numberOfArrows:1,arrowSpacing:-DEFAULT_ARROW_HEIGHT*.5,fireOnHold:!0,fireOnHoldDelay:400,fireOnHoldInterval:100,startCallback:_.noop,endCallback:_.noop},r);o.listener=s;const n=new Shape$1;for(let l=0;l<o.numberOfArrows;l++){const h=l*(o.arrowHeight+o.arrowSpacing);if(t==="up")n.moveTo(o.arrowHeight/2,h).lineTo(o.arrowHeight,o.arrowWidth+h).lineTo(0,o.arrowWidth+h).close();else if(t==="down")n.moveTo(0,h).lineTo(o.arrowHeight,h).lineTo(o.arrowHeight/2,o.arrowWidth+h).close();else if(t==="left")n.moveTo(h,o.arrowHeight/2).lineTo(o.arrowWidth+h,0).lineTo(o.arrowWidth+h,o.arrowHeight).close();else if(t==="right")n.moveTo(h,0).lineTo(o.arrowWidth+h,o.arrowHeight/2).lineTo(h,o.arrowHeight).close();else throw new Error(`unsupported direction: ${t}`)}o.content=new Path(n,{fill:o.arrowFill,stroke:o.arrowStroke,lineWidth:o.arrowLineWidth,pickable:!1}),super(o)}}sun.register("ArrowButton",ArrowButton);class NumberSpinner extends AccessibleNumberSpinner(Node$2,0){constructor(t,s,r){var pe,de;assert&&assert(s.value.contains(t.get()),`value ${t.get()} is out of range ${s.value.toString()}`);const o=optionize()({arrowsSoundPlayer:pushButtonSoundPlayer,arrowsPosition:"bothRight",arrowsScale:null,arrowButtonFill:"white",arrowButtonStroke:"black",arrowButtonLineWidth:1,deltaValue:1,xSpacing:5,ySpacing:3,numberDisplayOptions:{cornerRadius:5,backgroundStroke:"black"},touchAreaXDilation:0,touchAreaYDilation:0,mouseAreaXDilation:0,mouseAreaYDilation:0,valueProperty:t,enabledRangeProperty:s,disabledOpacity:SceneryConstants.DISABLED_OPACITY,interactiveHighlight:"invisible",tandem:Tandem.REQUIRED,tandemNameSuffix:"Spinner",phetioFeatured:!0,phetioEnabledPropertyInstrumented:!0},r),n=o.incrementFunction||(fe=>fe+o.deltaValue),l=o.decrementFunction||(fe=>fe-o.deltaValue),h=new NumberDisplay(t,s.value,combineOptions({tandem:o.tandem.createTandem("numberDisplay")},o.numberDisplayOptions)),g={baseColor:o.arrowButtonFill,stroke:o.arrowButtonStroke,lineWidth:o.arrowButtonLineWidth,focusable:!1,soundPlayer:o.arrowsSoundPlayer,enabledPropertyOptions:{phetioReadOnly:!0,phetioFeatured:!1}},d=new ArrowButton(o.arrowsPosition==="topBottom"||o.arrowsPosition==="bothRight"?"up":"right",()=>t.set(n(t.get())),combineOptions({tandem:o.tandem.createTandem("incrementButton")},g)),A=new ArrowButton(o.arrowsPosition==="topBottom"||o.arrowsPosition==="bothRight"?"down":"left",()=>t.set(l(t.get())),combineOptions({tandem:o.tandem.createTandem("decrementButton")},g));let S;S||(o.arrowsPosition==="leftRight"?S=h.height/d.height:o.arrowsPosition==="topBottom"?S=h.width/d.width:o.arrowsPosition==="bothRight"?S=(h.height/2-o.ySpacing/2)/d.height:S=(h.width/2-o.xSpacing/2)/d.width),o.arrowsScale&&(S=S*o.arrowsScale),d.setScaleMagnitude(S),A.setScaleMagnitude(S);const O=()=>{o.arrowsPosition==="leftRight"?(d.left=h.right+o.xSpacing,A.right=h.left-o.xSpacing,d.centerY=A.centerY=h.centerY):o.arrowsPosition==="topBottom"?(d.centerX=A.centerX=h.centerX,d.bottom=h.top-o.ySpacing,A.top=h.bottom+o.ySpacing):o.arrowsPosition==="bothRight"?(d.left=A.left=h.right+o.xSpacing,d.bottom=h.centerY-o.ySpacing/2,A.top=h.centerY+o.ySpacing/2):(d.left=h.centerX+o.xSpacing/2,A.right=h.centerX-o.xSpacing/2,d.top=A.top=h.bottom+o.ySpacing)};h.boundsProperty.link(()=>O()),(o.touchAreaXDilation||o.touchAreaYDilation)&&(d.touchArea=d.localBounds.dilatedXY(o.touchAreaXDilation,o.touchAreaYDilation),A.touchArea=A.localBounds.dilatedXY(o.touchAreaXDilation,o.touchAreaYDilation),o.arrowsPosition==="bothRight"?(d.touchArea=d.touchArea.shiftedY(-o.touchAreaYDilation),A.touchArea=A.touchArea.shiftedY(o.touchAreaYDilation)):o.arrowsPosition==="bothBottom"&&(d.touchArea=d.touchArea.shiftedX(o.touchAreaXDilation),A.touchArea=A.touchArea.shiftedX(-o.touchAreaXDilation))),(o.mouseAreaXDilation||o.mouseAreaYDilation)&&(d.mouseArea=d.localBounds.dilatedXY(o.mouseAreaXDilation,o.mouseAreaYDilation),A.mouseArea=A.localBounds.dilatedXY(o.mouseAreaXDilation,o.mouseAreaYDilation),o.arrowsPosition==="bothRight"?(d.mouseArea=d.mouseArea.shiftedY(-o.mouseAreaYDilation),A.mouseArea=A.mouseArea.shiftedY(o.mouseAreaYDilation)):o.arrowsPosition==="bothBottom"&&(d.mouseArea=d.mouseArea.shiftedX(o.mouseAreaXDilation),A.mouseArea=A.mouseArea.shiftedX(-o.mouseAreaXDilation))),o.children=[h,d,A],assert&&assert(o.keyboardStep===void 0,"NumberSpinner sets keyboardStep, it will be the same as deltaValue"),assert&&assert(o.shiftKeyboardStep===void 0,"NumberSpinner sets shiftKeyboardStep, it will be the same as deltaValue"),assert&&assert(o.pageKeyboardStep===void 0,"NumberSpinner sets pageKeyboardStep, it should not be used with NumberSpinner"),o.keyboardStep=0,o.shiftKeyboardStep=0,o.pageKeyboardStep=0;const I=_.pick(o,Node$2.REQUIRES_BOUNDS_OPTION_KEYS);super(_.omit(o,Node$2.REQUIRES_BOUNDS_OPTION_KEYS));const W=()=>{d.enabled=n(t.value)<=s.value.max,A.enabled=l(t.value)>=s.value.min},L=fe=>{assert&&assert(s.value.contains(fe),`value out of range: ${fe}`),W()};t.link(L);const H=fe=>{t.value=fe.constrainValue(t.value),W()};s.link(H);const Y=fe=>fe&&d.pdomClick(),Q=fe=>fe&&A.pdomClick();this.pdomIncrementDownEmitter.addListener(Y),this.pdomDecrementDownEmitter.addListener(Q),this.disposeNumberSpinner=()=>{h.dispose(),d.dispose(),A.dispose(),this.pdomIncrementDownEmitter.removeListener(Y),this.pdomDecrementDownEmitter.removeListener(Q),t.unlink(L),s.unlink(H)},this.mutate(I),this.numberDisplay=h,this.addLinkedElement(t,{tandemName:"property"}),assert&&((de=(pe=phet==null?void 0:phet.chipper)==null?void 0:pe.queryParameters)!=null&&de.binder)&&InstanceRegistry.registerDataURL("sun","NumberSpinner",this)}dispose(){this.disposeNumberSpinner(),super.dispose()}}sun.register("NumberSpinner",NumberSpinner);class OnOffSwitch extends ToggleSwitch{constructor(t,s){const r=optionize()({trackFillLeft:"white",trackFillRight:"rgb( 0, 200, 0 )"},s);super(t,!1,!0,r)}}sun.register("OnOffSwitch",OnOffSwitch);const soundURI$1="data:audio/mpeg;base64,//swxAAABognHnWRADEriei3OrACCEgYAPOkFXghY6uD++Piw3kA4B4y7hchMBxIxLKSksCwfB8Hw+7wfB8H3/E4P+GP/++D58AABoNsRiAAegAAAcAAwfGEzHKEwATU0FYIw6Dg+OLEOCqwYUAazcxYAwgAWZl5g4CTyjQM3o0EQLO/PjeedH/0g7/quk7v////9CoAAgKS3agA//syxAOACFhpYb2WADkFBWUpz2ROAUr4AUY00DNWPwkiueFpjWamdXncJm4WSUvPYHtdLyIybUkqNbEdOAeIJqJS89odMGRdRGULsKEKKu9sAAFgQA2oDCIoIgGYfBxqSpmFgSkaq7FxnJizGCsESGsoBS/52SlqFCkhXIYlBMPwLKiSRYVd1f///7f/lUfvy2gAAL45ZHAEVS5wEP/7MsQFgkd0HRVM9wJwooOhqMw8TrAOxggWZrdB4KswIKoWwjoMDKpkDpawRH8EDMvQbb5c2fQ5IXBwEGakBD9/3/5ub1lQm4/cLYHDTARtPRS+xTotNKqDqFAVBUFeVBUFU4lBYO8sDQNB3iIGqkxBTUUzLjk5LjWqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+zLEFwPAAAGkAAAAIAAANIAAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//swxFsDwAABpAAAACAAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//syxJ6DwAABpAAAACAAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqg==",soundByteArray$1=base64SoundToByteArray(phetAudioContext$1,soundURI$1),unlock$1=asyncLoader.createLock(soundURI$1),wrappedAudioBuffer$1=new WrappedAudioBuffer;let unlocked$1=!1;const safeUnlock$1=()=>{unlocked$1||(unlock$1(),unlocked$1=!0)},onDecodeSuccess$1=a=>{wrappedAudioBuffer$1.audioBufferProperty.value===null&&(wrappedAudioBuffer$1.audioBufferProperty.set(a),safeUnlock$1())},onDecodeError$1=a=>{console.warn("decode of audio data failed, using stubbed sound, error: "+a),wrappedAudioBuffer$1.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock$1()},decodePromise$1=phetAudioContext$1.decodeAudioData(soundByteArray$1.buffer,onDecodeSuccess$1,onDecodeError$1);decodePromise$1&&decodePromise$1.then(a=>{wrappedAudioBuffer$1.audioBufferProperty.value===null&&(wrappedAudioBuffer$1.audioBufferProperty.set(a),safeUnlock$1())}).catch(a=>{console.warn("promise rejection caught for audio decode, error = "+a),safeUnlock$1()});const soundURI="data:audio/mpeg;base64,//swxAAABpAhE1WQgDEChGf3OiJCAAAJRgWMA3lCIUyXzv3PfM52Qw9nimjE2HsTh+X09sHwQBB10u/y4e//+gEAQ5cP/u//4nAABASEQsFsvw9GFpIAMRiGNLEgMlRmNb+1MIjHNu4KFilyMxQYzAAc3e/P+566F6J7olttvvTZ9lv1/6++U+z1qgAJHLdLYAABaRtXAaLgn8Bq//syxAiAiaBvUb22ADjOA6MNz+wKcSQr2BxEgs/qJ0XkEPODBEPhEBEOh7HwdhJLwTjcKQmIaxUepm3yySi6sRnp0hr1J8lYfUroW0RJYrMlFAAMN5mqFGCchxplBCFCZuwLfmAFg8RsPKaZAGhqJlpCZMCBA+iTjFW///////Xb//1B2gACzEgggAM2IOQFMKEH4x1EgzS0KJMJgP/7MsQMAkZUGwtNe0BwqQNgNawkjoI6rU0xQyo8AgUADX4Q45so+ubX4c/Qr//w0AVA5axJGw1awwFk8Bk0bAWushk77jjeDg6Vcjgr38sDQNfUJZ3KgqCoK0xBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+zLEIYPAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//swxGWDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy45OS41VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//syxKkDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVMQU1FMy45OS41VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7MsS7g8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+zLEu4PAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//swxLwDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",soundByteArray=base64SoundToByteArray(phetAudioContext$1,soundURI),unlock=asyncLoader.createLock(soundURI),wrappedAudioBuffer=new WrappedAudioBuffer;let unlocked=!1;const safeUnlock=()=>{unlocked||(unlock(),unlocked=!0)},onDecodeSuccess=a=>{wrappedAudioBuffer.audioBufferProperty.value===null&&(wrappedAudioBuffer.audioBufferProperty.set(a),safeUnlock())},onDecodeError=a=>{console.warn("decode of audio data failed, using stubbed sound, error: "+a),wrappedAudioBuffer.audioBufferProperty.set(phetAudioContext$1.createBuffer(1,1,phetAudioContext$1.sampleRate)),safeUnlock()},decodePromise=phetAudioContext$1.decodeAudioData(soundByteArray.buffer,onDecodeSuccess,onDecodeError);decodePromise&&decodePromise.then(a=>{wrappedAudioBuffer.audioBufferProperty.value===null&&(wrappedAudioBuffer.audioBufferProperty.set(a),safeUnlock())}).catch(a=>{console.warn("promise rejection caught for audio decode, error = "+a),safeUnlock()});const DEFAULT_DRAG_CLIP_OPTIONS$1={initialOutputLevel:.4};class RichDragListener extends DragListener{constructor(t){const s=optionize()({grabSound:wrappedAudioBuffer$1,releaseSound:wrappedAudioBuffer,grabSoundClipOptions:DEFAULT_DRAG_CLIP_OPTIONS$1,releaseSoundClipOptions:DEFAULT_DRAG_CLIP_OPTIONS$1},t);let r;if(s.grabSound){r=new SoundClip(s.grabSound,s.grabSoundClipOptions),soundManager.addSoundGenerator(r);const n=s.start;s.start=(...l)=>{n&&n(...l),r.play()}}let o;if(s.releaseSound){o=new SoundClip(s.releaseSound,s.releaseSoundClipOptions),soundManager.addSoundGenerator(o);const n=s.end;s.end=(...l)=>{n&&n(...l),o.play()}}super(s),this.disposeEmitter.addListener(()=>{r&&(r.dispose(),soundManager.removeSoundGenerator(r)),o&&(o.dispose(),soundManager.removeSoundGenerator(o))})}}sun.register("RichDragListener",RichDragListener);const DEFAULT_DRAG_CLIP_OPTIONS={initialOutputLevel:.4};class RichKeyboardDragListener extends KeyboardDragListener$1{constructor(t){const s=optionize()({grabSound:wrappedAudioBuffer$1,releaseSound:wrappedAudioBuffer,grabSoundClipOptions:DEFAULT_DRAG_CLIP_OPTIONS,releaseSoundClipOptions:DEFAULT_DRAG_CLIP_OPTIONS},t);let r;if(s.grabSound){r=new SoundClip(s.grabSound,s.grabSoundClipOptions),soundManager.addSoundGenerator(r);const n=s.start;s.start=(...l)=>{n&&n(...l),r.play()}}let o;if(s.releaseSound){o=new SoundClip(s.releaseSound,s.releaseSoundClipOptions),soundManager.addSoundGenerator(o);const n=s.end;s.end=(...l)=>{n&&n(...l),o.play()}}super(s),this.disposeEmitter.addListener(()=>{r&&(r.dispose(),soundManager.removeSoundGenerator(r)),o&&(o.dispose(),soundManager.removeSoundGenerator(o))})}}sun.register("RichKeyboardDragListener",RichKeyboardDragListener);const sunQueryParameters=QueryStringMachine.getAll({backgroundColor:{type:"string",defaultValue:"white"},component:{type:"string",defaultValue:null},layout:{type:"string",defaultValue:"Width of multiple panels"}});sun.register("sunQueryParameters",sunQueryParameters);class VerticalAquaRadioButtonGroup extends AquaRadioButtonGroup{constructor(t,s,r){super(t,s,optionize()({orientation:"vertical",align:"left"},r))}}sun.register("VerticalAquaRadioButtonGroup",VerticalAquaRadioButtonGroup);class VerticalCheckboxGroup extends VBox{constructor(t,s){const r=optionize()({touchAreaXDilation:5,mouseAreaXDilation:5,spacing:10,align:"left",stretch:!0,tandem:Tandem.REQUIRED},s),o=getGroupItemNodes(t,r.tandem),n=[];r.children=[];for(let l=0;l<t.length;l++){const h=t[l],g=o[l];assert&&assert(!g.hasPDOMContent,"Accessibility is provided by Checkbox and VerticalCheckboxGroupItem.options. Additional PDOM content in the provided Node could break accessibility.");const d=r.spacing/2;assert&&assert(!h.tandem,"Cannot specify tandem on item, use tandemName instead");const A=new Checkbox(h.property,g,combineOptions({tandem:h.tandemName?r.tandem.createTandem(h.tandemName):Tandem.OPTIONAL,mouseAreaXDilation:r.mouseAreaXDilation,touchAreaXDilation:r.touchAreaXDilation,mouseAreaYDilation:d,touchAreaYDilation:d},r.checkboxOptions,h.options));n.push(A),r.children.push(A)}super(r),this.disposeVerticalCheckboxGroup=()=>{n.forEach(l=>l.dispose()),o.forEach(l=>l.dispose())}}dispose(){this.disposeVerticalCheckboxGroup(),super.dispose()}}sun.register("VerticalCheckboxGroup",VerticalCheckboxGroup);class VSlider extends Slider{constructor(t,s,r){var o,n;r=optionize()({orientation:Orientation.VERTICAL},r),super(t,s,r),assert&&((n=(o=phet==null?void 0:phet.chipper)==null?void 0:o.queryParameters)!=null&&n.binder)&&InstanceRegistry.registerDataURL("sun","VSlider",this)}}sun.register("VSlider",VSlider);class StickyToggleButtonInteractionStateProperty extends DerivedProperty5{constructor(t){super([t.focusedProperty,t.overProperty,t.looksOverProperty,t.looksPressedProperty,t.valueProperty],(s,r,o,n,l)=>{const h=l===t.valueDown;return o&&!(n||h)?ButtonInteractionState.OVER:(r||s)&&(n||h)||h?ButtonInteractionState.PRESSED:ButtonInteractionState.IDLE},{valueType:ButtonInteractionState})}}sun.register("StickyToggleButtonInteractionStateProperty",StickyToggleButtonInteractionStateProperty);class StickyToggleButtonModel extends ButtonModel{constructor(t,s,r,o){const n=optionize()({tandem:Tandem.REQUIRED},o);super(n),this.valueUp=t,this.valueDown=s,this.valueProperty=r,this.toggledEmitter=new Emitter({tandem:n.tandem.createTandem("toggledEmitter"),phetioDocumentation:"Emits when the button is toggled",phetioEventType:EventType.USER}),this.toggledEmitter.addListener(()=>{assert&&assert(this.valueProperty.value===this.valueUp||this.valueProperty.value===this.valueDown,`unrecognized value: ${this.valueProperty.value}`),this.valueProperty.value=this.valueProperty.value===this.valueUp?this.valueDown:this.valueUp}),this.pressedWhileDownProperty=new BooleanProperty(!1);const l=d=>{const A=this.overProperty.get()||this.focusedProperty.get();this.enabledProperty.get()&&A&&!this.interrupted&&(d&&r.value===t&&(this.toggle(),this.pressedWhileDownProperty.set(!1)),!d&&r.value===s&&(this.pressedWhileDownProperty.get()?this.toggle():this.pressedWhileDownProperty.set(!0))),!d&&!A&&this.pressedWhileDownProperty.set(!0)};this.downProperty.link(l);const h=d=>{this.downProperty.set(d===s)};r.link(h);const g=d=>{d&&this.pressedWhileDownProperty.set(!0)};this.enabledProperty.link(g),this.disposeToggleButtonModel=()=>{this.downProperty.unlink(l),this.enabledProperty.unlink(g),r.unlink(h),this.toggledEmitter.dispose()}}dispose(){this.disposeToggleButtonModel(),super.dispose()}toggle(){this.toggledEmitter.emit(),this.produceSoundEmitter.emit()}}sun.register("StickyToggleButtonModel",StickyToggleButtonModel);class RectangularStickyToggleButton extends RectangularButton{constructor(t,s,r,o){const n=new StickyToggleButtonModel(s,r,t,o),l=new StickyToggleButtonInteractionStateProperty(n);super(n,l,o),this.disposeRectangularStickyToggleButton=()=>{n.dispose()}}dispose(){this.disposeRectangularStickyToggleButton(),super.dispose()}}sun.register("RectangularStickyToggleButton",RectangularStickyToggleButton);class BooleanRectangularStickyToggleButton extends RectangularStickyToggleButton{constructor(t,s){super(t,!1,!0,s)}}sun.register("BooleanRectangularStickyToggleButton",BooleanRectangularStickyToggleButton);const HIGHLIGHT_GRADIENT_LENGTH=5;class RoundButton extends ButtonNode{constructor(t,s,r){const o=optionize()({radius:r&&r.content?null:30,lineWidth:.5,stroke:null,touchAreaDilation:0,mouseAreaDilation:0,touchAreaXShift:0,touchAreaYShift:0,mouseAreaXShift:0,mouseAreaYShift:0,aspectRatio:1,cursor:"pointer",xMargin:5,yMargin:5,buttonAppearanceStrategy:RoundButton.ThreeDAppearanceStrategy},r);o.content||assert&&assert(typeof o.radius=="number",`invalid radius: ${o.radius}`),o.radius&&(assert&&assert(o.xMargin<o.radius,"xMargin cannot be larger than radius"),assert&&assert(o.yMargin<o.radius,"yMargin cannot be larger than radius"),o.minUnstrokedWidth=o.radius*2,o.minUnstrokedHeight=o.radius*2),o.buttonAppearanceStrategyOptions||(o.buttonAppearanceStrategyOptions={stroke:o.stroke,lineWidth:o.lineWidth});const n=o.radius||Math.max(o.content.width+o.xMargin*2,o.content.height+o.yMargin*2)/2;if(o.content&&o.radius){const g=o.content,d=Math.min((o.radius-o.xMargin)*2/g.width,(o.radius-o.yMargin)*2/g.height);o.content=new Node$2({children:[g],scale:d})}const l=new Circle(n);super(t,l,s,o);const h=l.localBounds.width/2;this.touchArea=Shape$1.circle(o.touchAreaXShift,o.touchAreaYShift,h+o.touchAreaDilation),this.mouseArea=Shape$1.circle(o.mouseAreaXShift,o.mouseAreaYShift,h+o.mouseAreaDilation),this.focusHighlight=Shape$1.circle(0,0,h+5)}}class ThreeDAppearanceStrategy{constructor(t,s,r,o){const n=o&&o.stroke?o.stroke:new PaintColorProperty(r,{luminanceFactor:-.4}),l=o&&o.lineWidth!==void 0?o.lineWidth:.3,h=optionize()({stroke:n,lineWidth:l,overStroke:n,overLineWidth:l,overButtonOpacity:1,selectedStroke:n,selectedLineWidth:l,selectedButtonOpacity:1,deselectedStroke:n,deselectedLineWidth:l,deselectedButtonOpacity:1,overFill:r},o),g=new PaintColorProperty(r,{luminanceFactor:.8}),d=new PaintColorProperty(r,{luminanceFactor:.7}),A=new PaintColorProperty(r,{luminanceFactor:.3}),S=new PaintColorProperty(r,{luminanceFactor:-.1}),O=new PaintColorProperty(r,{luminanceFactor:-.2}),I=new PaintColorProperty(r,{luminanceFactor:-.4}),W=new PaintColorProperty(r,{luminanceFactor:-.5}),L=new DerivedProperty([r],Ke=>Ke.withAlpha(0)),H=t.width/2,Y=H-HIGHLIGHT_GRADIENT_LENGTH/2,Q=H+HIGHLIGHT_GRADIENT_LENGTH/2,pe=HIGHLIGHT_GRADIENT_LENGTH/2,de=new RadialGradient(pe,pe,Y,pe,pe,Q).addColorStop(0,r).addColorStop(1,d),fe=new RadialGradient(-pe,-pe,Y,-pe,-pe,Q).addColorStop(0,L).addColorStop(1,W),ye=new RadialGradient(pe,pe,Y,pe,pe,Q).addColorStop(0,A).addColorStop(1,g),Ee=new RadialGradient(-pe,-pe,Y,-pe,-pe,Q).addColorStop(0,L).addColorStop(1,W),Le=new RadialGradient(-pe,-pe,0,0,0,Q).addColorStop(0,S).addColorStop(.6,O).addColorStop(.8,r).addColorStop(1,g),Z=new Circle(H,{stroke:h.stroke?h.stroke:I,lineWidth:h.lineWidth,pickable:!1});t.addChild(Z),this.maxLineWidth=Z.hasStroke()&&h&&typeof h.lineWidth=="number"?h.lineWidth:0,t.cachedPaints=[de,ye,Le],Z.cachedPaints=[fe,Ee];function ne(Ke){switch(Ke){case ButtonInteractionState.IDLE:t.fill=de,t.stroke=h.deselectedStroke,t.lineWidth=h.deselectedLineWidth,t.opacity=h.deselectedButtonOpacity,Z.fill=fe,Z.opacity=h.deselectedButtonOpacity;break;case ButtonInteractionState.OVER:t.fill=ye,t.stroke=h.overStroke,t.lineWidth=h.overLineWidth,t.opacity=h.overButtonOpacity,Z.fill=Ee,Z.opacity=h.overButtonOpacity;break;case ButtonInteractionState.PRESSED:t.fill=Le,t.stroke=h.selectedStroke,t.lineWidth=h.selectedLineWidth,t.opacity=h.selectedButtonOpacity,Z.fill=Ee,Z.opacity=h.selectedButtonOpacity;break;default:throw new Error(`unsupported interactionState: ${Ke}`)}}s.link(ne),this.disposeThreeDAppearanceStrategy=()=>{s.hasListener(ne)&&s.unlink(ne),g.dispose(),d.dispose(),A.dispose(),S.dispose(),O.dispose(),I.dispose(),W.dispose(),L.dispose()}}dispose(){this.disposeThreeDAppearanceStrategy()}}RoundButton.ThreeDAppearanceStrategy=ThreeDAppearanceStrategy;sun.register("RoundButton",RoundButton);class RoundStickyToggleButton extends RoundButton{constructor(t,s,r,o){const n=optionize()({soundPlayer:pushButtonSoundPlayer,tandem:Tandem.REQUIRED},o),l=new StickyToggleButtonModel(s,r,t,n),h=new StickyToggleButtonInteractionStateProperty(l);super(l,h,n);const g=()=>n.soundPlayer.play();l.produceSoundEmitter.addListener(g);const d=A=>this.setPDOMAttribute("aria-pressed",t.value===r);t.link(d),this.disposeRoundStickyToggleButton=()=>{t.unlink(d),l.produceSoundEmitter.removeListener(g),l.dispose()}}dispose(){this.disposeRoundStickyToggleButton(),super.dispose()}}sun.register("RoundStickyToggleButton",RoundStickyToggleButton);class BooleanRoundStickyToggleButton extends RoundStickyToggleButton{constructor(t,s){super(t,!1,!0,s)}}sun.register("BooleanRoundStickyToggleButton",BooleanRoundStickyToggleButton);class RoundToggleButton extends RoundButton{constructor(t,s,r,o){const n=optionize()({valueOffSoundPlayer:toggleOffSoundPlayer,valueOnSoundPlayer:toggleOnSoundPlayer,tandem:Tandem.REQUIRED,phetioFeatured:!0},o),l=new ToggleButtonModel(s,r,t,n),h=new ToggleButtonInteractionStateProperty(l);super(l,h,n),this.addLinkedElement(t,{tandemName:"property"});const g=()=>{t.value===s?n.valueOffSoundPlayer.play():t.value===r&&n.valueOnSoundPlayer.play()};this.buttonModel.produceSoundEmitter.addListener(g),this.disposeRoundToggleButton=()=>{this.buttonModel.produceSoundEmitter.removeListener(g),l.dispose()}}dispose(){this.disposeRoundToggleButton(),super.dispose()}}sun.register("RoundToggleButton",RoundToggleButton);class BooleanRoundToggleButton extends RoundToggleButton{constructor(t,s,r,o){const n=optionize()({content:null,tandem:Tandem.REQUIRED},o),l=new BooleanToggleNode(t,s,r,{tandem:n.tandem.createTandem("toggleNode")});n.content=l,super(t,!1,!0,n),this.disposeBooleanRoundToggleButton=function(){l.dispose()}}dispose(){this.disposeBooleanRoundToggleButton(),super.dispose()}}sun.register("BooleanRoundToggleButton",BooleanRoundToggleButton);class MomentaryButtonInteractionStateProperty extends DerivedProperty2{constructor(t){super([t.looksOverProperty,t.looksPressedProperty],(s,r)=>s&&!r?ButtonInteractionState.OVER:r?ButtonInteractionState.PRESSED:ButtonInteractionState.IDLE,{valueType:ButtonInteractionState})}}sun.register("MomentaryButtonInteractionStateProperty",MomentaryButtonInteractionStateProperty);class MomentaryButtonModel extends ButtonModel{constructor(t,s,r,o){const n=optionize()({tandem:Tandem.REQUIRED,phetioReadOnly:PhetioObject.DEFAULT_OPTIONS.phetioReadOnly},o);super(n);const l=g=>{g?this.enabledProperty.get()&&r.set(s):r.set(t)};this.downProperty.lazyLink(l);const h=g=>{this.downProperty.set(g===s)};r.link(h),this.disposeMomentaryButtonModel=()=>{this.downProperty.unlink(l),r.unlink(h)}}dispose(){this.disposeMomentaryButtonModel(),super.dispose()}}sun.register("MomentaryButtonModel",MomentaryButtonModel);const Wr=class Wr extends EnumerationValue{};Wr.SELECTED=new Wr,Wr.DESELECTED=new Wr,Wr.OVER=new Wr,Wr.PRESSED=new Wr,Wr.enumeration=new Enumeration(Wr);let RadioButtonInteractionState=Wr;sun.register("RadioButtonInteractionState",RadioButtonInteractionState);class RadioButtonInteractionStateProperty extends DerivedProperty5{constructor(t,s,r){super([t.focusedProperty,t.overProperty,t.looksOverProperty,t.looksPressedProperty,s],(o,n,l,h,g)=>{const d=g===r;return l&&!(h||d)?RadioButtonInteractionState.OVER:(n||o)&&h?RadioButtonInteractionState.PRESSED:d?RadioButtonInteractionState.SELECTED:RadioButtonInteractionState.DESELECTED},{valueType:RadioButtonInteractionState})}}sun.register("RadioButtonInteractionStateProperty",RadioButtonInteractionStateProperty);class RectangularMomentaryButton extends RectangularButton{constructor(t,s,r,o){var h,g;const n=optionize()({tandem:Tandem.REQUIRED},o),l=new MomentaryButtonModel(s,r,t,n);super(l,new MomentaryButtonInteractionStateProperty(l),n),this.disposeRectangularMomentaryButton=()=>{l.dispose()},assert&&((g=(h=phet==null?void 0:phet.chipper)==null?void 0:h.queryParameters)!=null&&g.binder)&&InstanceRegistry.registerDataURL("sun","RectangularMomentaryButton",this)}dispose(){this.disposeRectangularMomentaryButton(),super.dispose()}}sun.register("RectangularMomentaryButton",RectangularMomentaryButton);const cl=class cl extends RectangularButton{constructor(t,s,r){const o=optionize()({soundPlayer:null,baseColor:ColorConstants.LIGHT_BLUE,buttonAppearanceStrategy:cl.FlatAppearanceStrategy,buttonAppearanceStrategyOptions:{overButtonOpacity:.8,overStroke:null,selectedStroke:Color.BLACK,selectedLineWidth:1.5,selectedButtonOpacity:1,deselectedStroke:new Color(50,50,50),deselectedLineWidth:1,deselectedButtonOpacity:.6},contentAppearanceStrategy:cl.ContentAppearanceStrategy,contentAppearanceStrategyOptions:{overContentOpacity:.8,selectedContentOpacity:1,deselectedContentOpacity:.6},tagName:"input",inputType:"radio",labelTagName:"label",containerTagName:"li",appendDescription:!0,appendLabel:!0,tandem:Tandem.REQUIRED,tandemNameSuffix:"RadioButton",phetioReadOnly:PhetioObject.DEFAULT_OPTIONS.phetioReadOnly},r),n=new ButtonModel({enabledPropertyOptions:o.enabledPropertyOptions,tandem:o.tandem,phetioEnabledPropertyInstrumented:o.phetioEnabledPropertyInstrumented}),l=new RadioButtonInteractionStateProperty(n,t,s);super(n,l,o),this.interactionStateProperty=l,t.value===s&&this.setPDOMAttribute("checked","checked");const h=A=>{this.pdomChecked=A===s};t.link(h),this.property=t,this.value=s,this.firedEmitter=new Emitter({tandem:o.tandem.createTandem("firedEmitter"),phetioDocumentation:"Emits when the radio button is pressed",phetioReadOnly:o.phetioReadOnly,phetioEventType:EventType.USER}),this.firedEmitter.addListener(()=>t.set(s)),n.downProperty.link(A=>{!A&&(n.overProperty.get()||n.focusedProperty.get())&&!n.interrupted&&(this.fire(),this.voicingSpeakFullResponse({hintResponse:null}))});const g=o.soundPlayer||pushButtonSoundPlayer,d=()=>{g.play()};n.produceSoundEmitter.addListener(d),this.disposeRectangularRadioButton=()=>{t.unlink(h),this.firedEmitter.dispose(),n.produceSoundEmitter.removeListener(d),n.dispose(),this.interactionStateProperty.dispose()}}dispose(){this.disposeRectangularRadioButton(),super.dispose()}fire(){this.buttonModel.enabledProperty.get()&&(this.firedEmitter.emit(),this.buttonModel.produceSoundEmitter.emit())}};cl.FlatAppearanceStrategy=class{constructor(s,r,o,n){const l=optionize()({stroke:o,lineWidth:1,deselectedButtonOpacity:1,deselectedLineWidth:1,deselectedStroke:"gray",overButtonOpacity:.8,overFill:null,overLineWidth:0,overStroke:null,selectedButtonOpacity:1,selectedLineWidth:1,selectedStroke:"black"},n),h=new PaintColorProperty(o,{luminanceFactor:-.4}),g=new PaintColorProperty(l.overFill||o,{luminanceFactor:n&&n.overFill?0:.4}),d=new PaintColorProperty(l.overStroke||l.deselectedStroke,{luminanceFactor:n&&n.overStroke?0:-.4});this.maxLineWidth=Math.max(l.selectedLineWidth,l.deselectedLineWidth,l.overLineWidth),s.cachedPaints=[o,g,h,d,l.selectedStroke,l.deselectedStroke];function A(S){switch(S){case RadioButtonInteractionState.SELECTED:s.fill=o,s.stroke=l.selectedStroke,s.lineWidth=l.selectedLineWidth,s.opacity=l.selectedButtonOpacity;break;case RadioButtonInteractionState.DESELECTED:s.fill=o,s.stroke=l.deselectedStroke,s.lineWidth=l.deselectedLineWidth,s.opacity=l.deselectedButtonOpacity;break;case RadioButtonInteractionState.OVER:s.fill=g,s.stroke=d,s.lineWidth=Math.max(l.overLineWidth,l.deselectedLineWidth),s.opacity=l.overButtonOpacity;break;case RadioButtonInteractionState.PRESSED:s.fill=h,s.stroke=l.deselectedStroke,s.lineWidth=l.deselectedLineWidth,s.opacity=l.selectedButtonOpacity;break;default:throw new Error(`unsupported interactionState: ${S}`)}}r.link(A),this.disposeFlatAppearanceStrategy=()=>{r.hasListener(A)&&r.unlink(A),d.dispose(),g.dispose(),h.dispose()}}dispose(){this.disposeFlatAppearanceStrategy()}},cl.ContentAppearanceStrategy=class{constructor(s,r,o){const n=optionize()({deselectedContentOpacity:1,overContentOpacity:1,selectedContentOpacity:1},o);function l(h){if(s!==null)switch(h){case RadioButtonInteractionState.DESELECTED:s.opacity=n.deselectedContentOpacity;break;case RadioButtonInteractionState.OVER:s.opacity=n.overContentOpacity;break;case RadioButtonInteractionState.SELECTED:s.opacity=n.selectedContentOpacity;break;case RadioButtonInteractionState.PRESSED:s.opacity=n.deselectedContentOpacity;break;default:throw new Error(`unsupported state: ${h}`)}}r.link(l),this.disposeContentAppearanceStrategy=()=>{r.hasListener(l)&&r.unlink(l)}}dispose(){this.disposeContentAppearanceStrategy()}};let RectangularRadioButton=cl;sun.register("RectangularRadioButton",RectangularRadioButton);let instanceCount=0;const CLASS_NAME="RectangularRadioButtonGroup";class RectangularRadioButtonGroup extends FlowBox{constructor(t,s,r){var W,L;assert&&assert(_.uniqBy(s,H=>H.value).length===s.length,"items must have unique values"),assert&&assert(_.find(s,H=>H.value===t.value),"one radio button must be associated with property.value");const o=optionize()({soundPlayers:null,labelAlign:"bottom",labelSpacing:0,a11yHighlightXDilation:0,a11yHighlightYDilation:0,touchAreaXDilation:0,touchAreaYDilation:0,mouseAreaXDilation:0,mouseAreaYDilation:0,radioButtonOptions:{baseColor:ColorConstants.LIGHT_BLUE,cornerRadius:4,xMargin:5,yMargin:5,xAlign:"center",yAlign:"center",buttonAppearanceStrategyOptions:{selectedStroke:"black",selectedLineWidth:1.5,selectedButtonOpacity:1,deselectedStroke:new Color(50,50,50),deselectedLineWidth:1,deselectedButtonOpacity:.6,overButtonOpacity:.8},contentAppearanceStrategy:RectangularRadioButton.ContentAppearanceStrategy,contentAppearanceStrategyOptions:{overContentOpacity:.8,selectedContentOpacity:1,deselectedContentOpacity:.6}},spacing:10,stretch:!0,orientation:"vertical",disabledOpacity:SceneryConstants.DISABLED_OPACITY,tandem:Tandem.REQUIRED,tandemNameSuffix:"ButtonGroup",visiblePropertyOptions:{phetioFeatured:!0},phetioEnabledPropertyInstrumented:!0,phetioFeatured:!0,tagName:"ul",labelTagName:"h3",ariaRole:"radiogroup",groupFocusHighlight:!0},r);assert&&assert(o.soundPlayers===null||o.soundPlayers.length===s.length,"If soundPlayers is provided, there must be one per radio button."),instanceCount++;const n=new Map,l=getGroupItemNodes(s,o.tandem);assert&&assert(_.every(l,H=>!H.hasPDOMContent),"Accessibility is provided by RectangularRadioButton and RectangularRadioButtonGroupItem.labelContent. Additional PDOM content in the provided Node could break accessibility.");const h=_.maxBy(l,H=>H.width).width,g=_.maxBy(l,H=>H.height).height,d=[],A=[],S=o.radioButtonOptions.xMargin,O=o.radioButtonOptions.yMargin;for(let H=0;H<s.length;H++){const Y=s[H],Q=l[H],pe=combineOptions({content:Q,minWidth:h+2*S,minHeight:g+2*O,soundPlayer:o.soundPlayers?o.soundPlayers[H]:multiSelectionSoundPlayerFactory.getSelectionSoundPlayer(H),tandem:Y.tandemName?o.tandem.createTandem(Y.tandemName):o.tandem===Tandem.OPT_OUT?Tandem.OPT_OUT:Tandem.REQUIRED,phetioDocumentation:Y.phetioDocumentation||"",touchAreaXDilation:o.orientation==="horizontal"?o.spacing/2:o.touchAreaXDilation,touchAreaYDilation:o.orientation==="vertical"?o.spacing/2:o.touchAreaYDilation,mouseAreaXDilation:o.orientation==="horizontal"?o.spacing/2:o.mouseAreaXDilation,mouseAreaYDilation:o.orientation==="vertical"?o.spacing/2:o.mouseAreaYDilation},o.radioButtonOptions,Y.options);Y.labelContent&&(pe.labelContent=Y.labelContent,pe.voicingNameResponse=Y.labelContent),Y.descriptionContent&&(pe.descriptionContent=Y.descriptionContent),Y.voicingContextResponse&&(pe.voicingContextResponse=Y.voicingContextResponse);const de=new RectangularRadioButton(t,Y.value,pe);n.set(Y.value,de),de.setPDOMAttribute("name",CLASS_NAME+instanceCount);let fe;if(Y.label){const ye=Y.label,Ee=o.labelAlign==="bottom"||o.labelAlign==="top"?"vertical":"horizontal",Le=o.labelAlign==="left"||o.labelAlign==="top"?[ye,de]:[de,ye];fe=new FlowBox({children:Le,spacing:o.labelSpacing,orientation:Ee}),ye.pickable=!1,o.radioButtonOptions.contentAppearanceStrategy&&A.push(new o.radioButtonOptions.contentAppearanceStrategy(ye,de.interactionStateProperty,o.radioButtonOptions.contentAppearanceStrategyOptions))}else fe=de;d.push(fe)}o.children=d,super(o),this.radioButtonMap=n,this.addAriaLabelledbyAssociation({thisElementName:PDOMPeer$1.PRIMARY_SIBLING,otherNode:this,otherElementName:PDOMPeer$1.LABEL_SIBLING});const I={keydown:H=>H.pointer.reserveForKeyboardDrag()};this.addInputListener(I),this.addLinkedElement(t,{tandemName:"property"}),this.disposeRadioButtonGroup=()=>{this.removeInputListener(I),d.forEach(H=>H.dispose()),A.forEach(H=>H.dispose&&H.dispose()),l.forEach(H=>H.dispose())},assert&&((L=(W=phet==null?void 0:phet.chipper)==null?void 0:W.queryParameters)!=null&&L.binder)&&InstanceRegistry.registerDataURL("sun","RectangularRadioButtonGroup",this)}getButtonForValue(t){const s=this.radioButtonMap.get(t);return assert&&assert(s,"No button found for value: "+t),s}dispose(){this.radioButtonMap.clear(),this.disposeRadioButtonGroup(),super.dispose()}}sun.register("RectangularRadioButtonGroup",RectangularRadioButtonGroup);class RoundMomentaryButton extends RoundButton{constructor(t,s,r,o){const n=optionize()({tandem:Tandem.REQUIRED},o),l=new MomentaryButtonModel(s,r,t,n);super(l,new MomentaryButtonInteractionStateProperty(l),n),this.disposeRoundMomentaryButton=()=>{l.dispose()}}dispose(){this.disposeRoundMomentaryButton(),super.dispose()}}sun.register("RoundMomentaryButton",RoundMomentaryButton);class RoundPushButton extends RoundButton{constructor(t){var h,g;const s=optionize()({soundPlayer:pushButtonSoundPlayer,tandem:Tandem.REQUIRED},t),r=s.listener,o=_.omit(s,["listener"]),n=new PushButtonModel(o);super(n,new PushButtonInteractionStateProperty(n),o),this.pushButtonModel=n,r&&this.addListener(r);const l=()=>{s.soundPlayer.play()};n.produceSoundEmitter.addListener(l),this.disposeRoundPushButton=()=>{n.produceSoundEmitter.removeListener(l),n.dispose()},assert&&((g=(h=phet==null?void 0:phet.chipper)==null?void 0:h.queryParameters)!=null&&g.binder)&&InstanceRegistry.registerDataURL("sun","RoundPushButton",this)}dispose(){super.dispose(),this.disposeRoundPushButton()}addListener(t){this.pushButtonModel.addListener(t)}removeListener(t){this.pushButtonModel.removeListener(t)}}sun.register("RoundPushButton",RoundPushButton);class TextPushButton extends RectangularPushButton{constructor(t,s){const r=optionize()({font:Font.DEFAULT,textFill:"black",maxTextWidth:null,tandem:Tandem.REQUIRED,innerContent:t},s),o=new Text(t,combineOptions({font:r.font,fill:r.textFill,maxWidth:r.maxTextWidth},r.textNodeOptions));r.content=o,super(r),this.disposeTextPushButton=()=>{o.dispose()}}dispose(){this.disposeTextPushButton(),super.dispose()}}sun.register("TextPushButton",TextPushButton);async function copyToClipboard(a){if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(a);else{const t=document.createElement("textarea");t.value=a,t.style.position="absolute",t.style.left="-999999px",document.body.prepend(t),t.select();try{document.execCommand("copy")}catch(s){console.error(s)}finally{t.remove()}}}const _$1=window._,parseNumber=(a,t)=>{if(typeof a=="number"){if(t===3)return{mode:"rgb",r:(a>>8&15|a>>4&240)/255,g:(a>>4&15|a&240)/255,b:(a&15|a<<4&240)/255};if(t===4)return{mode:"rgb",r:(a>>12&15|a>>8&240)/255,g:(a>>8&15|a>>4&240)/255,b:(a>>4&15|a&240)/255,alpha:(a&15|a<<4&240)/255};if(t===6)return{mode:"rgb",r:(a>>16&255)/255,g:(a>>8&255)/255,b:(a&255)/255};if(t===8)return{mode:"rgb",r:(a>>24&255)/255,g:(a>>16&255)/255,b:(a>>8&255)/255,alpha:(a&255)/255}}},named={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},named$1=named,parseNamed=a=>parseNumber(named$1[a.toLowerCase()],6),parseNamed$1=parseNamed,hex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,parseHex=a=>{let t;return(t=a.match(hex))?parseNumber(parseInt(t[1],16),t[1].length):void 0},parseHex$1=parseHex,num$1="([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)",per=`${num$1}%`,num_per=`(?:${num$1}%|${num$1})`,hue$1=`(?:${num$1}(deg|grad|rad|turn)|${num$1})`,c="\\s*,\\s*",rgb_num_old=new RegExp(`^rgba?\\(\\s*${num$1}${c}${num$1}${c}${num$1}\\s*(?:,\\s*${num_per}\\s*)?\\)$`),rgb_per_old=new RegExp(`^rgba?\\(\\s*${per}${c}${per}${c}${per}\\s*(?:,\\s*${num_per}\\s*)?\\)$`),parseRgbLegacy=a=>{let t={mode:"rgb"},s;if(s=a.match(rgb_num_old))s[1]!==void 0&&(t.r=s[1]/255),s[2]!==void 0&&(t.g=s[2]/255),s[3]!==void 0&&(t.b=s[3]/255);else if(s=a.match(rgb_per_old))s[1]!==void 0&&(t.r=s[1]/100),s[2]!==void 0&&(t.g=s[2]/100),s[3]!==void 0&&(t.b=s[3]/100);else return;return s[4]!==void 0?t.alpha=Math.max(0,Math.min(1,s[4]/100)):s[5]!==void 0&&(t.alpha=Math.max(0,Math.min(1,+s[5]))),t},parseRgbLegacy$1=parseRgbLegacy,prepare=(a,t)=>a===void 0?void 0:typeof a!="object"?parse(a):a.mode!==void 0?a:t?{...a,mode:t}:void 0,converter=(a="rgb")=>t=>(t=prepare(t,a))!==void 0?t.mode===a?t:converters[t.mode][a]?converters[t.mode][a](t):a==="rgb"?converters[t.mode].rgb(t):converters.rgb[a](converters[t.mode].rgb(t)):void 0,converters={},modes={},parsers=[],colorProfiles={},identity=a=>a,useMode=a=>(converters[a.mode]={...converters[a.mode],...a.toMode},Object.keys(a.fromMode||{}).forEach(t=>{converters[t]||(converters[t]={}),converters[t][a.mode]=a.fromMode[t]}),a.ranges||(a.ranges={}),a.difference||(a.difference={}),a.channels.forEach(t=>{if(a.ranges[t]===void 0&&(a.ranges[t]=[0,1]),!a.interpolate[t])throw new Error(`Missing interpolator for: ${t}`);typeof a.interpolate[t]=="function"&&(a.interpolate[t]={use:a.interpolate[t]}),a.interpolate[t].fixup||(a.interpolate[t].fixup=identity)}),modes[a.mode]=a,(a.parse||[]).forEach(t=>{useParser(t,a.mode)}),converter(a.mode)),getMode=a=>modes[a],useParser=(a,t)=>{if(typeof a=="string"){if(!t)throw new Error("'mode' required when 'parser' is a string");colorProfiles[a]=t}else typeof a=="function"&&parsers.indexOf(a)<0&&parsers.push(a)},IdentStartCodePoint=/[^\x00-\x7F]|[a-zA-Z_]/,IdentCodePoint=/[^\x00-\x7F]|[-\w]/,Tok={Function:"function",Ident:"ident",Number:"number",Percentage:"percentage",ParenClose:")",None:"none",Hue:"hue",Alpha:"alpha"};let _i=0;function is_num(a){let t=a[_i],s=a[_i+1];return t==="-"||t==="+"?/\d/.test(s)||s==="."&&/\d/.test(a[_i+2]):t==="."?/\d/.test(s):/\d/.test(t)}function is_ident(a){if(_i>=a.length)return!1;let t=a[_i];if(IdentStartCodePoint.test(t))return!0;if(t==="-"){if(a.length-_i<2)return!1;let s=a[_i+1];return!!(s==="-"||IdentStartCodePoint.test(s))}return!1}const huenits={deg:1,rad:180/Math.PI,grad:9/10,turn:360};function num(a){let t="";if((a[_i]==="-"||a[_i]==="+")&&(t+=a[_i++]),t+=digits(a),a[_i]==="."&&/\d/.test(a[_i+1])&&(t+=a[_i++]+digits(a)),(a[_i]==="e"||a[_i]==="E")&&((a[_i+1]==="-"||a[_i+1]==="+")&&/\d/.test(a[_i+2])?t+=a[_i++]+a[_i++]+digits(a):/\d/.test(a[_i+1])&&(t+=a[_i++]+digits(a))),is_ident(a)){let s=ident(a);return s==="deg"||s==="rad"||s==="turn"||s==="grad"?{type:Tok.Hue,value:t*huenits[s]}:void 0}return a[_i]==="%"?(_i++,{type:Tok.Percentage,value:+t}):{type:Tok.Number,value:+t}}function digits(a){let t="";for(;/\d/.test(a[_i]);)t+=a[_i++];return t}function ident(a){let t="";for(;_i<a.length&&IdentCodePoint.test(a[_i]);)t+=a[_i++];return t}function identlike(a){let t=ident(a);return a[_i]==="("?(_i++,{type:Tok.Function,value:t}):t==="none"?{type:Tok.None,value:void 0}:{type:Tok.Ident,value:t}}function tokenize(a=""){let t=a.trim(),s=[],r;for(_i=0;_i<t.length;){if(r=t[_i++],r===`
`||r==="	"||r===" "){for(;_i<t.length&&(t[_i]===`
`||t[_i]==="	"||t[_i]===" ");)_i++;continue}if(r===",")return;if(r===")"){s.push({type:Tok.ParenClose});continue}if(r==="+"){if(_i--,is_num(t)){s.push(num(t));continue}return}if(r==="-"){if(_i--,is_num(t)){s.push(num(t));continue}if(is_ident(t)){s.push({type:Tok.Ident,value:ident(t)});continue}return}if(r==="."){if(_i--,is_num(t)){s.push(num(t));continue}return}if(r==="/"){for(;_i<t.length&&(t[_i]===`
`||t[_i]==="	"||t[_i]===" ");)_i++;let o;if(is_num(t)&&(o=num(t),o.type!==Tok.Hue)){s.push({type:Tok.Alpha,value:o});continue}if(is_ident(t)&&ident(t)==="none"){s.push({type:Tok.Alpha,value:{type:Tok.None,value:void 0}});continue}return}if(/\d/.test(r)){_i--,s.push(num(t));continue}if(IdentStartCodePoint.test(r)){_i--,s.push(identlike(t));continue}return}return s}function parseColorSyntax(a){a._i=0;let t=a[a._i++];if(!t||t.type!==Tok.Function||t.value!=="color"||(t=a[a._i++],t.type!==Tok.Ident))return;const s=colorProfiles[t.value];if(!s)return;const r={mode:s},o=consumeCoords(a,!1);if(!o)return;const n=getMode(s).channels;for(let l=0,h,g;l<n.length;l++)h=o[l],g=n[l],h.type!==Tok.None&&(r[g]=h.type===Tok.Number?h.value:h.value/100,g==="alpha"&&(r[g]=Math.max(0,Math.min(1,r[g]))));return r}function consumeCoords(a,t){const s=[];let r;for(;a._i<a.length;){if(r=a[a._i++],r.type===Tok.None||r.type===Tok.Number||r.type===Tok.Alpha||r.type===Tok.Percentage||t&&r.type===Tok.Hue){s.push(r);continue}if(r.type===Tok.ParenClose){if(a._i<a.length)return;continue}return}if(!(s.length<3||s.length>4)){if(s.length===4){if(s[3].type!==Tok.Alpha)return;s[3]=s[3].value}return s.length===3&&s.push({type:Tok.None,value:void 0}),s.every(o=>o.type!==Tok.Alpha)?s:void 0}}function parseModernSyntax(a,t){a._i=0;let s=a[a._i++];if(!s||s.type!==Tok.Function)return;let r=consumeCoords(a,t);if(r)return r.unshift(s.value),r}const parse=a=>{if(typeof a!="string")return;const t=tokenize(a),s=t?parseModernSyntax(t,!0):void 0;let r,o=0,n=parsers.length;for(;o<n;)if((r=parsers[o++](a,s))!==void 0)return r;return t?parseColorSyntax(t):void 0};function parseRgb(a,t){if(!t||t[0]!=="rgb"&&t[0]!=="rgba")return;const s={mode:"rgb"},[,r,o,n,l]=t;if(!(r.type===Tok.Hue||o.type===Tok.Hue||n.type===Tok.Hue))return r.type!==Tok.None&&(s.r=r.type===Tok.Number?r.value/255:r.value/100),o.type!==Tok.None&&(s.g=o.type===Tok.Number?o.value/255:o.value/100),n.type!==Tok.None&&(s.b=n.type===Tok.Number?n.value/255:n.value/100),l.type!==Tok.None&&(s.alpha=Math.min(1,Math.max(0,l.type===Tok.Number?l.value:l.value/100))),s}const parseTransparent=a=>a==="transparent"?{mode:"rgb",r:0,g:0,b:0,alpha:0}:void 0,parseTransparent$1=parseTransparent,lerp=(a,t,s)=>a+s*(t-a),get_classes=a=>{let t=[];for(let s=0;s<a.length-1;s++){let r=a[s],o=a[s+1];r===void 0&&o===void 0?t.push(void 0):r!==void 0&&o!==void 0?t.push([r,o]):t.push(r!==void 0?[r,r]:[o,o])}return t},interpolatorPiecewise=a=>t=>{let s=get_classes(t);return r=>{let o=r*s.length,n=r>=1?s.length-1:Math.max(Math.floor(o),0),l=s[n];return l===void 0?void 0:a(l[0],l[1],o-n)}},interpolatorLinear=interpolatorPiecewise(lerp),fixupAlpha=a=>{let t=!1,s=a.map(r=>r!==void 0?(t=!0,r):1);return t?s:a},definition$r={mode:"rgb",channels:["r","g","b","alpha"],parse:[parseRgb,parseHex$1,parseRgbLegacy$1,parseNamed$1,parseTransparent$1,"srgb"],serialize:"srgb",interpolate:{r:interpolatorLinear,g:interpolatorLinear,b:interpolatorLinear,alpha:{use:interpolatorLinear,fixup:fixupAlpha}},gamut:!0,white:{r:1,g:1,b:1},black:{r:0,g:0,b:0}},modeRgb=definition$r,linearize$2=(a=0)=>Math.pow(Math.abs(a),563/256)*Math.sign(a),convertA98ToXyz65=a=>{let t=linearize$2(a.r),s=linearize$2(a.g),r=linearize$2(a.b),o={mode:"xyz65",x:.5766690429101305*t+.1855582379065463*s+.1882286462349947*r,y:.297344975250536*t+.6273635662554661*s+.0752914584939979*r,z:.0270313613864123*t+.0706888525358272*s+.9913375368376386*r};return a.alpha!==void 0&&(o.alpha=a.alpha),o},gamma$2=a=>Math.pow(Math.abs(a),256/563)*Math.sign(a),convertXyz65ToA98=({x:a,y:t,z:s,alpha:r})=>{a===void 0&&(a=0),t===void 0&&(t=0),s===void 0&&(s=0);let o={mode:"a98",r:gamma$2(a*2.0415879038107465-t*.5650069742788597-.3447313507783297*s),g:gamma$2(a*-.9692436362808798+t*1.8759675015077206+.0415550574071756*s),b:gamma$2(a*.0134442806320312-t*.1183623922310184+1.0151749943912058*s)};return r!==void 0&&(o.alpha=r),o},fn$3=(a=0)=>{const t=Math.abs(a);return t<=.04045?a/12.92:(Math.sign(a)||1)*Math.pow((t+.055)/1.055,2.4)},convertRgbToLrgb=({r:a,g:t,b:s,alpha:r})=>{let o={mode:"lrgb",r:fn$3(a),g:fn$3(t),b:fn$3(s)};return r!==void 0&&(o.alpha=r),o},convertRgbToXyz65=a=>{let{r:t,g:s,b:r,alpha:o}=convertRgbToLrgb(a),n={mode:"xyz65",x:.4123907992659593*t+.357584339383878*s+.1804807884018343*r,y:.2126390058715102*t+.715168678767756*s+.0721923153607337*r,z:.0193308187155918*t+.119194779794626*s+.9505321522496607*r};return o!==void 0&&(n.alpha=o),n},fn$2=(a=0)=>{const t=Math.abs(a);return t>.0031308?(Math.sign(a)||1)*(1.055*Math.pow(t,1/2.4)-.055):a*12.92},convertLrgbToRgb=({r:a,g:t,b:s,alpha:r},o="rgb")=>{let n={mode:o,r:fn$2(a),g:fn$2(t),b:fn$2(s)};return r!==void 0&&(n.alpha=r),n},convertXyz65ToRgb=({x:a,y:t,z:s,alpha:r})=>{a===void 0&&(a=0),t===void 0&&(t=0),s===void 0&&(s=0);let o=convertLrgbToRgb({r:a*3.2409699419045226-t*1.537383177570094-.4986107602930034*s,g:a*-.9692436362808796+t*1.8759675015077204+.0415550574071756*s,b:a*.0556300796969936-t*.2039769588889765+1.0569715142428784*s});return r!==void 0&&(o.alpha=r),o},definition$q={...modeRgb,mode:"a98",parse:["a98-rgb"],serialize:"a98-rgb",fromMode:{rgb:a=>convertXyz65ToA98(convertRgbToXyz65(a)),xyz65:convertXyz65ToA98},toMode:{rgb:a=>convertXyz65ToRgb(convertA98ToXyz65(a)),xyz65:convertA98ToXyz65}},modeA98=definition$q,normalizeHue=a=>(a=a%360)<0?a+360:a,hue=(a,t)=>a.map((s,r,o)=>{if(s===void 0)return s;let n=normalizeHue(s);return r===0||a[r-1]===void 0?n:t(n-normalizeHue(o[r-1]))}).reduce((s,r)=>!s.length||r===void 0||s[s.length-1]===void 0?(s.push(r),s):(s.push(r+s[s.length-1]),s),[]),fixupHueShorter=a=>hue(a,t=>Math.abs(t)<=180?t:t-360*Math.sign(t)),M=[-.14861,1.78277,-.29227,-.90649,1.97294,0],degToRad=Math.PI/180,radToDeg=180/Math.PI;let DE=M[3]*M[4],BE=M[1]*M[4],BCAD=M[1]*M[2]-M[0]*M[3];const convertRgbToCubehelix=({r:a,g:t,b:s,alpha:r})=>{a===void 0&&(a=0),t===void 0&&(t=0),s===void 0&&(s=0);let o=(BCAD*s+a*DE-t*BE)/(BCAD+DE-BE),n=s-o,l=(M[4]*(t-o)-M[2]*n)/M[3],h={mode:"cubehelix",l:o,s:o===0||o===1?void 0:Math.sqrt(n*n+l*l)/(M[4]*o*(1-o))};return h.s&&(h.h=Math.atan2(l,n)*radToDeg-120),r!==void 0&&(h.alpha=r),h},convertRgbToCubehelix$1=convertRgbToCubehelix,convertCubehelixToRgb=({h:a,s:t,l:s,alpha:r})=>{let o={mode:"rgb"};a=(a===void 0?0:a+120)*degToRad,s===void 0&&(s=0);let n=t===void 0?0:t*s*(1-s),l=Math.cos(a),h=Math.sin(a);return o.r=s+n*(M[0]*l+M[1]*h),o.g=s+n*(M[2]*l+M[3]*h),o.b=s+n*(M[4]*l+M[5]*h),r!==void 0&&(o.alpha=r),o},convertCubehelixToRgb$1=convertCubehelixToRgb,differenceHueSaturation=(a,t)=>{if(a.h===void 0||t.h===void 0||!a.s||!t.s)return 0;let s=normalizeHue(a.h),r=normalizeHue(t.h),o=Math.sin((r-s+360)/2*Math.PI/180);return 2*Math.sqrt(a.s*t.s)*o},differenceHueNaive=(a,t)=>{if(a.h===void 0||t.h===void 0)return 0;let s=normalizeHue(a.h),r=normalizeHue(t.h);return Math.abs(r-s)>180?s-(r-360*Math.sign(r-s)):r-s},differenceHueChroma=(a,t)=>{if(a.h===void 0||t.h===void 0||!a.c||!t.c)return 0;let s=normalizeHue(a.h),r=normalizeHue(t.h),o=Math.sin((r-s+360)/2*Math.PI/180);return 2*Math.sqrt(a.c*t.c)*o},differenceEuclidean=(a="rgb",t=[1,1,1,0])=>{let s=getMode(a),r=s.channels,o=s.difference,n=converter(a);return(l,h)=>{let g=n(l),d=n(h);return Math.sqrt(r.reduce((A,S,O)=>{let I=o[S]?o[S](g,d):g[S]-d[S];return A+(t[O]||0)*Math.pow(isNaN(I)?0:I,2)},0))}},averageAngle=a=>{let t=a.reduce((r,o)=>{if(o!==void 0){let n=o*Math.PI/180;r.sin+=Math.sin(n),r.cos+=Math.cos(n)}return r},{sin:0,cos:0}),s=Math.atan2(t.sin,t.cos)*180/Math.PI;return s<0?360+s:s},definition$p={mode:"cubehelix",channels:["h","s","l","alpha"],parse:["--cubehelix"],serialize:"--cubehelix",ranges:{h:[0,360],s:[0,4.614],l:[0,1]},fromMode:{rgb:convertRgbToCubehelix$1},toMode:{rgb:convertCubehelixToRgb$1},interpolate:{h:{use:interpolatorLinear,fixup:fixupHueShorter},s:interpolatorLinear,l:interpolatorLinear,alpha:{use:interpolatorLinear,fixup:fixupAlpha}},difference:{h:differenceHueSaturation},average:{h:averageAngle}},modeCubehelix=definition$p,convertLabToLch=({l:a,a:t,b:s,alpha:r},o="lch")=>{t===void 0&&(t=0),s===void 0&&(s=0);let n=Math.sqrt(t*t+s*s),l={mode:o,l:a,c:n};return n&&(l.h=normalizeHue(Math.atan2(s,t)*180/Math.PI)),r!==void 0&&(l.alpha=r),l},convertLchToLab=({l:a,c:t,h:s,alpha:r},o="lab")=>{s===void 0&&(s=0);let n={mode:o,l:a,a:t?t*Math.cos(s/180*Math.PI):0,b:t?t*Math.sin(s/180*Math.PI):0};return r!==void 0&&(n.alpha=r),n},k$1=Math.pow(29,3)/Math.pow(3,3),e$1=Math.pow(6,3)/Math.pow(29,3),D50={X:.3457/.3585,Y:1,Z:(1-.3457-.3585)/.3585},D65={X:.3127/.329,Y:1,Z:(1-.3127-.329)/.329};let fn$1=a=>Math.pow(a,3)>e$1?Math.pow(a,3):(116*a-16)/k$1;const convertLab65ToXyz65=({l:a,a:t,b:s,alpha:r})=>{a===void 0&&(a=0),t===void 0&&(t=0),s===void 0&&(s=0);let o=(a+16)/116,n=t/500+o,l=o-s/200,h={mode:"xyz65",x:fn$1(n)*D65.X,y:fn$1(o)*D65.Y,z:fn$1(l)*D65.Z};return r!==void 0&&(h.alpha=r),h},convertLab65ToXyz65$1=convertLab65ToXyz65,convertLab65ToRgb=a=>convertXyz65ToRgb(convertLab65ToXyz65$1(a)),f$1=a=>a>e$1?Math.cbrt(a):(k$1*a+16)/116,convertXyz65ToLab65=({x:a,y:t,z:s,alpha:r})=>{a===void 0&&(a=0),t===void 0&&(t=0),s===void 0&&(s=0);let o=f$1(a/D65.X),n=f$1(t/D65.Y),l=f$1(s/D65.Z),h={mode:"lab65",l:116*n-16,a:500*(o-n),b:200*(n-l)};return r!==void 0&&(h.alpha=r),h},convertRgbToLab65=a=>{let t=convertXyz65ToLab65(convertRgbToXyz65(a));return a.r===a.b&&a.b===a.g&&(t.a=t.b=0),t},kE=1,kCH=1,θ=26/180*Math.PI,cosθ=Math.cos(θ),sinθ=Math.sin(θ),factor=100/Math.log(139/100),convertDlchToLab65=({l:a,c:t,h:s,alpha:r})=>{a===void 0&&(a=0),t===void 0&&(t=0),s===void 0&&(s=0);let o={mode:"lab65",l:(Math.exp(a*kE/factor)-1)/.0039},n=(Math.exp(.0435*t*kCH*kE)-1)/.075,l=n*Math.cos(s/180*Math.PI-θ),h=n*Math.sin(s/180*Math.PI-θ);return o.a=l*cosθ-h/.83*sinθ,o.b=l*sinθ+h/.83*cosθ,r!==void 0&&(o.alpha=r),o},convertLab65ToDlch=({l:a,a:t,b:s,alpha:r})=>{a===void 0&&(a=0),t===void 0&&(t=0),s===void 0&&(s=0);let o=t*cosθ+s*sinθ,n=.83*(s*cosθ-t*sinθ),l=Math.sqrt(o*o+n*n),h={mode:"dlch",l:factor/kE*Math.log(1+.0039*a),c:Math.log(1+.075*l)/(.0435*kCH*kE)};return h.c&&(h.h=normalizeHue((Math.atan2(n,o)+θ)/Math.PI*180)),r!==void 0&&(h.alpha=r),h},convertDlabToLab65=a=>convertDlchToLab65(convertLabToLch(a,"dlch")),convertLab65ToDlab=a=>convertLchToLab(convertLab65ToDlch(a),"dlab"),definition$o={mode:"dlab",parse:["--din99o-lab"],serialize:"--din99o-lab",toMode:{lab65:convertDlabToLab65,rgb:a=>convertLab65ToRgb(convertDlabToLab65(a))},fromMode:{lab65:convertLab65ToDlab,rgb:a=>convertLab65ToDlab(convertRgbToLab65(a))},channels:["l","a","b","alpha"],ranges:{l:[0,100],a:[-40.09,45.501],b:[-40.469,44.344]},interpolate:{l:interpolatorLinear,a:interpolatorLinear,b:interpolatorLinear,alpha:{use:interpolatorLinear,fixup:fixupAlpha}}},modeDlab=definition$o,definition$n={mode:"dlch",parse:["--din99o-lch"],serialize:"--din99o-lch",toMode:{lab65:convertDlchToLab65,dlab:a=>convertLchToLab(a,"dlab"),rgb:a=>convertLab65ToRgb(convertDlchToLab65(a))},fromMode:{lab65:convertLab65ToDlch,dlab:a=>convertLabToLch(a,"dlch"),rgb:a=>convertLab65ToDlch(convertRgbToLab65(a))},channels:["l","c","h","alpha"],ranges:{l:[0,100],c:[0,51.484],h:[0,360]},interpolate:{l:interpolatorLinear,c:interpolatorLinear,h:{use:interpolatorLinear,fixup:fixupHueShorter},alpha:{use:interpolatorLinear,fixup:fixupAlpha}},difference:{h:differenceHueChroma},average:{h:averageAngle}},modeDlch=definition$n;function convertHsiToRgb({h:a,s:t,i:s,alpha:r}){a=normalizeHue(a!==void 0?a:0),t===void 0&&(t=0),s===void 0&&(s=0);let o=Math.abs(a/60%2-1),n;switch(Math.floor(a/60)){case 0:n={r:s*(1+t*(3/(2-o)-1)),g:s*(1+t*(3*(1-o)/(2-o)-1)),b:s*(1-t)};break;case 1:n={r:s*(1+t*(3*(1-o)/(2-o)-1)),g:s*(1+t*(3/(2-o)-1)),b:s*(1-t)};break;case 2:n={r:s*(1-t),g:s*(1+t*(3/(2-o)-1)),b:s*(1+t*(3*(1-o)/(2-o)-1))};break;case 3:n={r:s*(1-t),g:s*(1+t*(3*(1-o)/(2-o)-1)),b:s*(1+t*(3/(2-o)-1))};break;case 4:n={r:s*(1+t*(3*(1-o)/(2-o)-1)),g:s*(1-t),b:s*(1+t*(3/(2-o)-1))};break;case 5:n={r:s*(1+t*(3/(2-o)-1)),g:s*(1-t),b:s*(1+t*(3*(1-o)/(2-o)-1))};break;default:n={r:s*(1-t),g:s*(1-t),b:s*(1-t)}}return n.mode="rgb",r!==void 0&&(n.alpha=r),n}function convertRgbToHsi({r:a,g:t,b:s,alpha:r}){a===void 0&&(a=0),t===void 0&&(t=0),s===void 0&&(s=0);let o=Math.max(a,t,s),n=Math.min(a,t,s),l={mode:"hsi",s:a+t+s===0?0:1-3*n/(a+t+s),i:(a+t+s)/3};return o-n!==0&&(l.h=(o===a?(t-s)/(o-n)+(t<s)*6:o===t?(s-a)/(o-n)+2:(a-t)/(o-n)+4)*60),r!==void 0&&(l.alpha=r),l}const definition$m={mode:"hsi",toMode:{rgb:convertHsiToRgb},parse:["--hsi"],serialize:"--hsi",fromMode:{rgb:convertRgbToHsi},channels:["h","s","i","alpha"],ranges:{h:[0,360]},gamut:"rgb",interpolate:{h:{use:interpolatorLinear,fixup:fixupHueShorter},s:interpolatorLinear,i:interpolatorLinear,alpha:{use:interpolatorLinear,fixup:fixupAlpha}},difference:{h:differenceHueSaturation},average:{h:averageAngle}},modeHsi=definition$m;function convertHslToRgb({h:a,s:t,l:s,alpha:r}){a=normalizeHue(a!==void 0?a:0),t===void 0&&(t=0),s===void 0&&(s=0);let o=s+t*(s<.5?s:1-s),n=o-(o-s)*2*Math.abs(a/60%2-1),l;switch(Math.floor(a/60)){case 0:l={r:o,g:n,b:2*s-o};break;case 1:l={r:n,g:o,b:2*s-o};break;case 2:l={r:2*s-o,g:o,b:n};break;case 3:l={r:2*s-o,g:n,b:o};break;case 4:l={r:n,g:2*s-o,b:o};break;case 5:l={r:o,g:2*s-o,b:n};break;default:l={r:2*s-o,g:2*s-o,b:2*s-o}}return l.mode="rgb",r!==void 0&&(l.alpha=r),l}function convertRgbToHsl({r:a,g:t,b:s,alpha:r}){a===void 0&&(a=0),t===void 0&&(t=0),s===void 0&&(s=0);let o=Math.max(a,t,s),n=Math.min(a,t,s),l={mode:"hsl",s:o===n?0:(o-n)/(1-Math.abs(o+n-1)),l:.5*(o+n)};return o-n!==0&&(l.h=(o===a?(t-s)/(o-n)+(t<s)*6:o===t?(s-a)/(o-n)+2:(a-t)/(o-n)+4)*60),r!==void 0&&(l.alpha=r),l}const hueToDeg=(a,t)=>{switch(t){case"deg":return+a;case"rad":return a/Math.PI*180;case"grad":return a/10*9;case"turn":return a*360}},hsl_old=new RegExp(`^hsla?\\(\\s*${hue$1}${c}${per}${c}${per}\\s*(?:,\\s*${num_per}\\s*)?\\)$`),parseHslLegacy=a=>{let t=a.match(hsl_old);if(!t)return;let s={mode:"hsl"};return t[3]!==void 0?s.h=+t[3]:t[1]!==void 0&&t[2]!==void 0&&(s.h=hueToDeg(t[1],t[2])),t[4]!==void 0&&(s.s=Math.min(Math.max(0,t[4]/100),1)),t[5]!==void 0&&(s.l=Math.min(Math.max(0,t[5]/100),1)),t[6]!==void 0?s.alpha=Math.max(0,Math.min(1,t[6]/100)):t[7]!==void 0&&(s.alpha=Math.max(0,Math.min(1,+t[7]))),s},parseHslLegacy$1=parseHslLegacy;function parseHsl(a,t){if(!t||t[0]!=="hsl"&&t[0]!=="hsla")return;const s={mode:"hsl"},[,r,o,n,l]=t;if(r.type!==Tok.None){if(r.type===Tok.Percentage)return;s.h=r.value}if(o.type!==Tok.None){if(o.type===Tok.Hue)return;s.s=o.value/100}if(n.type!==Tok.None){if(n.type===Tok.Hue)return;s.l=n.value/100}return l.type!==Tok.None&&(s.alpha=Math.min(1,Math.max(0,l.type===Tok.Number?l.value:l.value/100))),s}const definition$l={mode:"hsl",toMode:{rgb:convertHslToRgb},fromMode:{rgb:convertRgbToHsl},channels:["h","s","l","alpha"],ranges:{h:[0,360]},gamut:"rgb",parse:[parseHsl,parseHslLegacy$1],serialize:a=>`hsl(${a.h!==void 0?a.h:"none"} ${a.s!==void 0?a.s*100+"%":"none"} ${a.l!==void 0?a.l*100+"%":"none"}${a.alpha<1?` / ${a.alpha}`:""})`,interpolate:{h:{use:interpolatorLinear,fixup:fixupHueShorter},s:interpolatorLinear,l:interpolatorLinear,alpha:{use:interpolatorLinear,fixup:fixupAlpha}},difference:{h:differenceHueSaturation},average:{h:averageAngle}},modeHsl=definition$l;function convertHsvToRgb({h:a,s:t,v:s,alpha:r}){a=normalizeHue(a!==void 0?a:0),t===void 0&&(t=0),s===void 0&&(s=0);let o=Math.abs(a/60%2-1),n;switch(Math.floor(a/60)){case 0:n={r:s,g:s*(1-t*o),b:s*(1-t)};break;case 1:n={r:s*(1-t*o),g:s,b:s*(1-t)};break;case 2:n={r:s*(1-t),g:s,b:s*(1-t*o)};break;case 3:n={r:s*(1-t),g:s*(1-t*o),b:s};break;case 4:n={r:s*(1-t*o),g:s*(1-t),b:s};break;case 5:n={r:s,g:s*(1-t),b:s*(1-t*o)};break;default:n={r:s*(1-t),g:s*(1-t),b:s*(1-t)}}return n.mode="rgb",r!==void 0&&(n.alpha=r),n}function convertRgbToHsv({r:a,g:t,b:s,alpha:r}){a===void 0&&(a=0),t===void 0&&(t=0),s===void 0&&(s=0);let o=Math.max(a,t,s),n=Math.min(a,t,s),l={mode:"hsv",s:o===0?0:1-n/o,v:o};return o-n!==0&&(l.h=(o===a?(t-s)/(o-n)+(t<s)*6:o===t?(s-a)/(o-n)+2:(a-t)/(o-n)+4)*60),r!==void 0&&(l.alpha=r),l}const definition$k={mode:"hsv",toMode:{rgb:convertHsvToRgb},parse:["--hsv"],serialize:"--hsv",fromMode:{rgb:convertRgbToHsv},channels:["h","s","v","alpha"],ranges:{h:[0,360]},gamut:"rgb",interpolate:{h:{use:interpolatorLinear,fixup:fixupHueShorter},s:interpolatorLinear,v:interpolatorLinear,alpha:{use:interpolatorLinear,fixup:fixupAlpha}},difference:{h:differenceHueSaturation},average:{h:averageAngle}},modeHsv=definition$k;function convertHwbToRgb({h:a,w:t,b:s,alpha:r}){if(t===void 0&&(t=0),s===void 0&&(s=0),t+s>1){let o=t+s;t/=o,s/=o}return convertHsvToRgb({h:a,s:s===1?1:1-t/(1-s),v:1-s,alpha:r})}function convertRgbToHwb(a){let t=convertRgbToHsv(a);if(t===void 0)return;let s=t.s!==void 0?t.s:0,r=t.v!==void 0?t.v:0,o={mode:"hwb",w:(1-s)*r,b:1-r};return t.h!==void 0&&(o.h=t.h),t.alpha!==void 0&&(o.alpha=t.alpha),o}function ParseHwb(a,t){if(!t||t[0]!=="hwb")return;const s={mode:"hwb"},[,r,o,n,l]=t;if(r.type!==Tok.None){if(r.type===Tok.Percentage)return;s.h=r.value}if(o.type!==Tok.None){if(o.type===Tok.Hue)return;s.w=o.value/100}if(n.type!==Tok.None){if(n.type===Tok.Hue)return;s.b=n.value/100}return l.type!==Tok.None&&(s.alpha=Math.min(1,Math.max(0,l.type===Tok.Number?l.value:l.value/100))),s}const definition$j={mode:"hwb",toMode:{rgb:convertHwbToRgb},fromMode:{rgb:convertRgbToHwb},channels:["h","w","b","alpha"],ranges:{h:[0,360]},gamut:"rgb",parse:[ParseHwb],serialize:a=>`hwb(${a.h!==void 0?a.h:"none"} ${a.w!==void 0?a.w*100+"%":"none"} ${a.b!==void 0?a.b*100+"%":"none"}${a.alpha<1?` / ${a.alpha}`:""})`,interpolate:{h:{use:interpolatorLinear,fixup:fixupHueShorter},w:interpolatorLinear,b:interpolatorLinear,alpha:{use:interpolatorLinear,fixup:fixupAlpha}},difference:{h:differenceHueNaive},average:{h:averageAngle}},modeHwb=definition$j,YW=203,M1=.1593017578125,M2=78.84375,C1=.8359375,C2=18.8515625,C3=18.6875;function transferPqDecode(a){if(a<0)return 0;const t=Math.pow(a,1/M2);return 1e4*Math.pow(Math.max(0,t-C1)/(C2-C3*t),1/M1)}function transferPqEncode(a){if(a<0)return 0;const t=Math.pow(a/1e4,M1);return Math.pow((C1+C2*t)/(1+C3*t),M2)}const toRel=a=>Math.max(a/YW,0),convertItpToXyz65=({i:a,t,p:s,alpha:r})=>{a===void 0&&(a=0),t===void 0&&(t=0),s===void 0&&(s=0);const o=transferPqDecode(a+.008609037037932761*t+.11102962500302593*s),n=transferPqDecode(a-.00860903703793275*t-.11102962500302599*s),l=transferPqDecode(a+.5600313357106791*t-.32062717498731885*s),h={mode:"xyz65",x:toRel(2.070152218389422*o-1.3263473389671556*n+.2066510476294051*l),y:toRel(.3647385209748074*o+.680566024947227*n-.0453045459220346*l),z:toRel(-.049747207535812*o-.0492609666966138*n+1.1880659249923042*l)};return r!==void 0&&(h.alpha=r),h},convertItpToXyz65$1=convertItpToXyz65,toAbs=(a=0)=>Math.max(a*YW,0),convertXyz65ToItp=({x:a,y:t,z:s,alpha:r})=>{const o=toAbs(a),n=toAbs(t),l=toAbs(s),h=transferPqEncode(.3592832590121217*o+.6976051147779502*n-.0358915932320289*l),g=transferPqEncode(-.1920808463704995*o+1.1004767970374323*n+.0753748658519118*l),d=transferPqEncode(.0070797844607477*o+.0748396662186366*n+.8433265453898765*l),A=.5*h+.5*g,S=1.61376953125*h-3.323486328125*g+1.709716796875*d,O=4.378173828125*h-4.24560546875*g-.132568359375*d,I={mode:"itp",i:A,t:S,p:O};return r!==void 0&&(I.alpha=r),I},definition$i={mode:"itp",channels:["i","t","p","alpha"],parse:["--ictcp"],serialize:"--ictcp",toMode:{xyz65:convertItpToXyz65$1,rgb:a=>convertXyz65ToRgb(convertItpToXyz65$1(a))},fromMode:{xyz65:convertXyz65ToItp,rgb:a=>convertXyz65ToItp(convertRgbToXyz65(a))},ranges:{i:[0,.581],t:[-.369,.272],p:[-.164,.331]},interpolate:{i:interpolatorLinear,t:interpolatorLinear,p:interpolatorLinear,alpha:{use:interpolatorLinear,fixup:fixupAlpha}}},modeItp=definition$i,p$1=134.03437499999998,d0$1=16295499532821565e-27,jabPqEncode=a=>{if(a<0)return 0;let t=Math.pow(a/1e4,M1);return Math.pow((C1+C2*t)/(1+C3*t),p$1)},abs=(a=0)=>Math.max(a*203,0),convertXyz65ToJab=({x:a,y:t,z:s,alpha:r})=>{a=abs(a),t=abs(t),s=abs(s);let o=1.15*a-.15*s,n=.66*t+.34*a,l=jabPqEncode(.41478972*o+.579999*n+.014648*s),h=jabPqEncode(-.20151*o+1.120649*n+.0531008*s),g=jabPqEncode(-.0166008*o+.2648*n+.6684799*s),d=(l+h)/2,A={mode:"jab",j:.44*d/(1-.56*d)-d0$1,a:3.524*l-4.066708*h+.542708*g,b:.199076*l+1.096799*h-1.295875*g};return r!==void 0&&(A.alpha=r),A},p=134.03437499999998,d0=16295499532821565e-27,jabPqDecode=a=>{if(a<0)return 0;let t=Math.pow(a,1/p);return 1e4*Math.pow((C1-t)/(C3*t-C2),1/M1)},rel=a=>a/203,convertJabToXyz65=({j:a,a:t,b:s,alpha:r})=>{a===void 0&&(a=0),t===void 0&&(t=0),s===void 0&&(s=0);let o=(a+d0)/(.44+.56*(a+d0)),n=jabPqDecode(o+.13860504*t+.058047316*s),l=jabPqDecode(o-.13860504*t-.058047316*s),h=jabPqDecode(o-.096019242*t-.8118919*s),g={mode:"xyz65",x:rel(1.661373024652174*n-.914523081304348*l+.23136208173913045*h),y:rel(-.3250758611844533*n+1.571847026732543*l-.21825383453227928*h),z:rel(-.090982811*n-.31272829*l+1.5227666*h)};return r!==void 0&&(g.alpha=r),g},convertJabToXyz65$1=convertJabToXyz65,convertRgbToJab=a=>{let t=convertXyz65ToJab(convertRgbToXyz65(a));return a.r===a.b&&a.b===a.g&&(t.a=t.b=0),t},convertRgbToJab$1=convertRgbToJab,convertJabToRgb=a=>convertXyz65ToRgb(convertJabToXyz65$1(a)),definition$h={mode:"jab",channels:["j","a","b","alpha"],parse:["--jzazbz"],serialize:"--jzazbz",fromMode:{rgb:convertRgbToJab$1,xyz65:convertXyz65ToJab},toMode:{rgb:convertJabToRgb,xyz65:convertJabToXyz65$1},ranges:{j:[0,.222],a:[-.109,.129],b:[-.185,.134]},interpolate:{j:interpolatorLinear,a:interpolatorLinear,b:interpolatorLinear,alpha:{use:interpolatorLinear,fixup:fixupAlpha}}},modeJab=definition$h,convertJabToJch=({j:a,a:t,b:s,alpha:r})=>{t===void 0&&(t=0),s===void 0&&(s=0);let o=Math.sqrt(t*t+s*s),n={mode:"jch",j:a,c:o};return o&&(n.h=normalizeHue(Math.atan2(s,t)*180/Math.PI)),r!==void 0&&(n.alpha=r),n},convertJchToJab=({j:a,c:t,h:s,alpha:r})=>{s===void 0&&(s=0);let o={mode:"jab",j:a,a:t?t*Math.cos(s/180*Math.PI):0,b:t?t*Math.sin(s/180*Math.PI):0};return r!==void 0&&(o.alpha=r),o},convertJchToJab$1=convertJchToJab,definition$g={mode:"jch",parse:["--jzczhz"],serialize:"--jzczhz",toMode:{jab:convertJchToJab$1,rgb:a=>convertJabToRgb(convertJchToJab$1(a))},fromMode:{rgb:a=>convertJabToJch(convertRgbToJab$1(a)),jab:convertJabToJch},channels:["j","c","h","alpha"],ranges:{j:[0,.221],c:[0,.19],h:[0,360]},interpolate:{h:{use:interpolatorLinear,fixup:fixupHueShorter},c:interpolatorLinear,j:interpolatorLinear,alpha:{use:interpolatorLinear,fixup:fixupAlpha}},difference:{h:differenceHueChroma},average:{h:averageAngle}},modeJch=definition$g,k=Math.pow(29,3)/Math.pow(3,3),e=Math.pow(6,3)/Math.pow(29,3);let fn=a=>Math.pow(a,3)>e?Math.pow(a,3):(116*a-16)/k;const convertLabToXyz50=({l:a,a:t,b:s,alpha:r})=>{a===void 0&&(a=0),t===void 0&&(t=0),s===void 0&&(s=0);let o=(a+16)/116,n=t/500+o,l=o-s/200,h={mode:"xyz50",x:fn(n)*D50.X,y:fn(o)*D50.Y,z:fn(l)*D50.Z};return r!==void 0&&(h.alpha=r),h},convertLabToXyz50$1=convertLabToXyz50,convertXyz50ToRgb=({x:a,y:t,z:s,alpha:r})=>{a===void 0&&(a=0),t===void 0&&(t=0),s===void 0&&(s=0);let o=convertLrgbToRgb({r:a*3.1341359569958707-t*1.6173863321612538-.4906619460083532*s,g:a*-.978795502912089+t*1.916254567259524+.03344273116131949*s,b:a*.07195537988411677-t*.2289768264158322+1.405386058324125*s});return r!==void 0&&(o.alpha=r),o},convertLabToRgb=a=>convertXyz50ToRgb(convertLabToXyz50$1(a)),convertRgbToXyz50=a=>{let{r:t,g:s,b:r,alpha:o}=convertRgbToLrgb(a),n={mode:"xyz50",x:.436065742824811*t+.3851514688337912*s+.14307845442264197*r,y:.22249319175623702*t+.7168870538238823*s+.06061979053616537*r,z:.013923904500943465*t+.09708128566574634*s+.7140993584005155*r};return o!==void 0&&(n.alpha=o),n},f=a=>a>e?Math.cbrt(a):(k*a+16)/116,convertXyz50ToLab=({x:a,y:t,z:s,alpha:r})=>{a===void 0&&(a=0),t===void 0&&(t=0),s===void 0&&(s=0);let o=f(a/D50.X),n=f(t/D50.Y),l=f(s/D50.Z),h={mode:"lab",l:116*n-16,a:500*(o-n),b:200*(n-l)};return r!==void 0&&(h.alpha=r),h},convertRgbToLab=a=>{let t=convertXyz50ToLab(convertRgbToXyz50(a));return a.r===a.b&&a.b===a.g&&(t.a=t.b=0),t},convertRgbToLab$1=convertRgbToLab;function parseLab(a,t){if(!t||t[0]!=="lab")return;const s={mode:"lab"},[,r,o,n,l]=t;if(!(r.type===Tok.Hue||o.type===Tok.Hue||n.type===Tok.Hue))return r.type!==Tok.None&&(s.l=Math.min(Math.max(0,r.value),100)),o.type!==Tok.None&&(s.a=o.type===Tok.Number?o.value:o.value*125/100),n.type!==Tok.None&&(s.b=n.type===Tok.Number?n.value:n.value*125/100),l.type!==Tok.None&&(s.alpha=Math.min(1,Math.max(0,l.type===Tok.Number?l.value:l.value/100))),s}const definition$f={mode:"lab",toMode:{xyz50:convertLabToXyz50$1,rgb:convertLabToRgb},fromMode:{xyz50:convertXyz50ToLab,rgb:convertRgbToLab$1},channels:["l","a","b","alpha"],ranges:{l:[0,100],a:[-100,100],b:[-100,100]},parse:[parseLab],serialize:a=>`lab(${a.l!==void 0?a.l:"none"} ${a.a!==void 0?a.a:"none"} ${a.b!==void 0?a.b:"none"}${a.alpha<1?` / ${a.alpha}`:""})`,interpolate:{l:interpolatorLinear,a:interpolatorLinear,b:interpolatorLinear,alpha:{use:interpolatorLinear,fixup:fixupAlpha}}},modeLab=definition$f,definition$e={...modeLab,mode:"lab65",parse:["--lab-d65"],serialize:"--lab-d65",toMode:{xyz65:convertLab65ToXyz65$1,rgb:convertLab65ToRgb},fromMode:{xyz65:convertXyz65ToLab65,rgb:convertRgbToLab65},ranges:{l:[0,100],a:[-86.182,98.234],b:[-107.86,94.477]}},modeLab65=definition$e;function parseLch(a,t){if(!t||t[0]!=="lch")return;const s={mode:"lch"},[,r,o,n,l]=t;if(r.type!==Tok.None){if(r.type===Tok.Hue)return;s.l=Math.min(Math.max(0,r.value),100)}if(o.type!==Tok.None&&(s.c=Math.max(0,o.type===Tok.Number?o.value:o.value*150/100)),n.type!==Tok.None){if(n.type===Tok.Percentage)return;s.h=n.value}return l.type!==Tok.None&&(s.alpha=Math.min(1,Math.max(0,l.type===Tok.Number?l.value:l.value/100))),s}const definition$d={mode:"lch",toMode:{lab:convertLchToLab,rgb:a=>convertLabToRgb(convertLchToLab(a))},fromMode:{rgb:a=>convertLabToLch(convertRgbToLab$1(a)),lab:convertLabToLch},channels:["l","c","h","alpha"],ranges:{l:[0,100],c:[0,150],h:[0,360]},parse:[parseLch],serialize:a=>`lch(${a.l!==void 0?a.l:"none"} ${a.c!==void 0?a.c:"none"} ${a.h!==void 0?a.h:"none"}${a.alpha<1?` / ${a.alpha}`:""})`,interpolate:{h:{use:interpolatorLinear,fixup:fixupHueShorter},c:interpolatorLinear,l:interpolatorLinear,alpha:{use:interpolatorLinear,fixup:fixupAlpha}},difference:{h:differenceHueChroma},average:{h:averageAngle}},modeLch=definition$d,definition$c={...modeLch,mode:"lch65",parse:["--lch-d65"],serialize:"--lch-d65",toMode:{lab65:a=>convertLchToLab(a,"lab65"),rgb:a=>convertLab65ToRgb(convertLchToLab(a,"lab65"))},fromMode:{rgb:a=>convertLabToLch(convertRgbToLab65(a),"lch65"),lab65:a=>convertLabToLch(a,"lch65")},ranges:{l:[0,100],c:[0,133.807],h:[0,360]}},modeLch65=definition$c,convertLuvToLchuv=({l:a,u:t,v:s,alpha:r})=>{t===void 0&&(t=0),s===void 0&&(s=0);let o=Math.sqrt(t*t+s*s),n={mode:"lchuv",l:a,c:o};return o&&(n.h=normalizeHue(Math.atan2(s,t)*180/Math.PI)),r!==void 0&&(n.alpha=r),n},convertLchuvToLuv=({l:a,c:t,h:s,alpha:r})=>{s===void 0&&(s=0);let o={mode:"luv",l:a,u:t?t*Math.cos(s/180*Math.PI):0,v:t?t*Math.sin(s/180*Math.PI):0};return r!==void 0&&(o.alpha=r),o},convertLchuvToLuv$1=convertLchuvToLuv,u_fn$1=(a,t,s)=>4*a/(a+15*t+3*s),v_fn$1=(a,t,s)=>9*t/(a+15*t+3*s),un$1=u_fn$1(D50.X,D50.Y,D50.Z),vn$1=v_fn$1(D50.X,D50.Y,D50.Z),l_fn=a=>a<=e?k*a:116*Math.cbrt(a)-16,convertXyz50ToLuv=({x:a,y:t,z:s,alpha:r})=>{a===void 0&&(a=0),t===void 0&&(t=0),s===void 0&&(s=0);let o=l_fn(t/D50.Y),n=u_fn$1(a,t,s),l=v_fn$1(a,t,s);!isFinite(n)||!isFinite(l)?o=n=l=0:(n=13*o*(n-un$1),l=13*o*(l-vn$1));let h={mode:"luv",l:o,u:n,v:l};return r!==void 0&&(h.alpha=r),h},u_fn=(a,t,s)=>4*a/(a+15*t+3*s),v_fn=(a,t,s)=>9*t/(a+15*t+3*s),un=u_fn(D50.X,D50.Y,D50.Z),vn=v_fn(D50.X,D50.Y,D50.Z),convertLuvToXyz50=({l:a,u:t,v:s,alpha:r})=>{if(a===void 0&&(a=0),a===0)return{mode:"xyz50",x:0,y:0,z:0};t===void 0&&(t=0),s===void 0&&(s=0);let o=t/(13*a)+un,n=s/(13*a)+vn,l=D50.Y*(a<=8?a/k:Math.pow((a+16)/116,3)),h=l*(9*o)/(4*n),g=l*(12-3*o-20*n)/(4*n),d={mode:"xyz50",x:h,y:l,z:g};return r!==void 0&&(d.alpha=r),d},convertLuvToXyz50$1=convertLuvToXyz50,convertRgbToLchuv=a=>convertLuvToLchuv(convertXyz50ToLuv(convertRgbToXyz50(a))),convertLchuvToRgb=a=>convertXyz50ToRgb(convertLuvToXyz50$1(convertLchuvToLuv$1(a))),definition$b={mode:"lchuv",toMode:{luv:convertLchuvToLuv$1,rgb:convertLchuvToRgb},fromMode:{rgb:convertRgbToLchuv,luv:convertLuvToLchuv},channels:["l","c","h","alpha"],parse:["--lchuv"],serialize:"--lchuv",ranges:{l:[0,100],c:[0,176.956],h:[0,360]},interpolate:{h:{use:interpolatorLinear,fixup:fixupHueShorter},c:interpolatorLinear,l:interpolatorLinear,alpha:{use:interpolatorLinear,fixup:fixupAlpha}},difference:{h:differenceHueChroma},average:{h:averageAngle}},modeLchuv=definition$b,definition$a={...modeRgb,mode:"lrgb",toMode:{rgb:convertLrgbToRgb},fromMode:{rgb:convertRgbToLrgb},parse:["srgb-linear"],serialize:"srgb-linear"},modeLrgb=definition$a,definition$9={mode:"luv",toMode:{xyz50:convertLuvToXyz50$1,rgb:a=>convertXyz50ToRgb(convertLuvToXyz50$1(a))},fromMode:{xyz50:convertXyz50ToLuv,rgb:a=>convertXyz50ToLuv(convertRgbToXyz50(a))},channels:["l","u","v","alpha"],parse:["--luv"],serialize:"--luv",ranges:{l:[0,100],u:[-84.936,175.042],v:[-125.882,87.243]},interpolate:{l:interpolatorLinear,u:interpolatorLinear,v:interpolatorLinear,alpha:{use:interpolatorLinear,fixup:fixupAlpha}}},modeLuv=definition$9,convertLrgbToOklab=({r:a,g:t,b:s,alpha:r})=>{a===void 0&&(a=0),t===void 0&&(t=0),s===void 0&&(s=0);let o=Math.cbrt(.41222147079999993*a+.5363325363*t+.0514459929*s),n=Math.cbrt(.2119034981999999*a+.6806995450999999*t+.1073969566*s),l=Math.cbrt(.08830246189999998*a+.2817188376*t+.6299787005000002*s),h={mode:"oklab",l:.2104542553*o+.793617785*n-.0040720468*l,a:1.9779984951*o-2.428592205*n+.4505937099*l,b:.0259040371*o+.7827717662*n-.808675766*l};return r!==void 0&&(h.alpha=r),h},convertRgbToOklab=a=>{let t=convertLrgbToOklab(convertRgbToLrgb(a));return a.r===a.b&&a.b===a.g&&(t.a=t.b=0),t},convertOklabToLrgb=({l:a,a:t,b:s,alpha:r})=>{a===void 0&&(a=0),t===void 0&&(t=0),s===void 0&&(s=0);let o=Math.pow(a*.9999999984505198+.39633779217376786*t+.2158037580607588*s,3),n=Math.pow(a*1.0000000088817609-.10556134232365635*t-.06385417477170591*s,3),l=Math.pow(a*1.0000000546724108-.08948418209496575*t-1.2914855378640917*s,3),h={mode:"lrgb",r:4.076741661347994*o-3.307711590408193*n+.230969928729428*l,g:-1.2684380040921763*o+2.6097574006633715*n-.3413193963102197*l,b:-.004196086541837188*o-.7034186144594493*n+1.7076147009309444*l};return r!==void 0&&(h.alpha=r),h},convertOklabToRgb=a=>convertLrgbToRgb(convertOklabToLrgb(a));function toe(a){const r=1.170873786407767;return .5*(r*a-.206+Math.sqrt((r*a-.206)*(r*a-.206)+4*.03*r*a))}function toe_inv(a){return(a*a+.206*a)/(1.170873786407767*(a+.03))}function compute_max_saturation(a,t){let s,r,o,n,l,h,g,d;-1.88170328*a-.80936493*t>1?(s=1.19086277,r=1.76576728,o=.59662641,n=.75515197,l=.56771245,h=4.0767416621,g=-3.3077115913,d=.2309699292):1.81444104*a-1.19445276*t>1?(s=.73956515,r=-.45954404,o=.08285427,n=.1254107,l=.14503204,h=-1.2684380046,g=2.6097574011,d=-.3413193965):(s=1.35733652,r=-.00915799,o=-1.1513021,n=-.50559606,l=.00692167,h=-.0041960863,g=-.7034186147,d=1.707614701);let A=s+r*a+o*t+n*a*a+l*a*t,S=.3963377774*a+.2158037573*t,O=-.1055613458*a-.0638541728*t,I=-.0894841775*a-1.291485548*t;{let W=1+A*S,L=1+A*O,H=1+A*I,Y=W*W*W,Q=L*L*L,pe=H*H*H,de=3*S*W*W,fe=3*O*L*L,ye=3*I*H*H,Ee=6*S*S*W,Le=6*O*O*L,Z=6*I*I*H,ne=h*Y+g*Q+d*pe,Ke=h*de+g*fe+d*ye,_t=h*Ee+g*Le+d*Z;A=A-ne*Ke/(Ke*Ke-.5*ne*_t)}return A}function find_cusp(a,t){let s=compute_max_saturation(a,t),r=convertOklabToLrgb({l:1,a:s*a,b:s*t}),o=Math.cbrt(1/Math.max(r.r,r.g,r.b)),n=o*s;return[o,n]}function find_gamut_intersection(a,t,s,r,o,n=null){n||(n=find_cusp(a,t));let l;if((s-o)*n[1]-(n[0]-o)*r<=0)l=n[1]*o/(r*n[0]+n[1]*(o-s));else{l=n[1]*(o-1)/(r*(n[0]-1)+n[1]*(o-s));{let h=s-o,g=r,d=.3963377774*a+.2158037573*t,A=-.1055613458*a-.0638541728*t,S=-.0894841775*a-1.291485548*t,O=h+g*d,I=h+g*A,W=h+g*S;{let L=o*(1-l)+l*s,H=l*r,Y=L+H*d,Q=L+H*A,pe=L+H*S,de=Y*Y*Y,fe=Q*Q*Q,ye=pe*pe*pe,Ee=3*O*Y*Y,Le=3*I*Q*Q,Z=3*W*pe*pe,ne=6*O*O*Y,Ke=6*I*I*Q,_t=6*W*W*pe,xe=4.0767416621*de-3.3077115913*fe+.2309699292*ye-1,Ct=4.0767416621*Ee-3.3077115913*Le+.2309699292*Z,zt=4.0767416621*ne-3.3077115913*Ke+.2309699292*_t,Je=Ct/(Ct*Ct-.5*xe*zt),Et=-xe*Je,ht=-1.2684380046*de+2.6097574011*fe-.3413193965*ye-1,mt=-1.2684380046*Ee+2.6097574011*Le-.3413193965*Z,Nt=-1.2684380046*ne+2.6097574011*Ke-.3413193965*_t,Gt=mt/(mt*mt-.5*ht*Nt),Mt=-ht*Gt,jt=-.0041960863*de-.7034186147*fe+1.707614701*ye-1,Ai=-.0041960863*Ee-.7034186147*Le+1.707614701*Z,oi=-.0041960863*ne-.7034186147*Ke+1.707614701*_t,ki=Ai/(Ai*Ai-.5*jt*oi),Li=-jt*ki;Et=Je>=0?Et:1e6,Mt=Gt>=0?Mt:1e6,Li=ki>=0?Li:1e6,l+=Math.min(Et,Math.min(Mt,Li))}}}return l}function get_ST_max(a,t,s=null){s||(s=find_cusp(a,t));let r=s[0],o=s[1];return[o/r,o/(1-r)]}function get_Cs(a,t,s){let r=find_cusp(t,s),o=find_gamut_intersection(t,s,a,1,a,r),n=get_ST_max(t,s,r),l=.11516993+1/(7.4477897+4.1590124*s+t*(-2.19557347+1.75198401*s+t*(-2.13704948-10.02301043*s+t*(-4.24894561+5.38770819*s+4.69891013*t)))),h=.11239642+1/(1.6132032-.68124379*s+t*(.40370612+.90148123*s+t*(-.27087943+.6122399*s+t*(.00299215-.45399568*s-.14661872*t)))),g=o/Math.min(a*n[0],(1-a)*n[1]),d=a*l,A=(1-a)*h,S=.9*g*Math.sqrt(Math.sqrt(1/(1/(d*d*d*d)+1/(A*A*A*A))));return d=a*.4,A=(1-a)*.8,[Math.sqrt(1/(1/(d*d)+1/(A*A))),S,o]}function convertOklabToOkhsl(a){const t=a.l!==void 0?a.l:0,s=a.a!==void 0?a.a:0,r=a.b!==void 0?a.b:0,o={mode:"okhsl",l:toe(t)};a.alpha!==void 0&&(o.alpha=a.alpha);let n=Math.sqrt(s*s+r*r);if(!n)return o.s=0,o;let[l,h,g]=get_Cs(t,s/n,r/n),d;if(n<h){let A=0,S=.8*l,O=1-S/h;d=(n-A)/(S+O*(n-A))*.8}else{let A=h,S=.2*h*h*1.25*1.25/l,O=1-S/(g-h);d=.8+.2*((n-A)/(S+O*(n-A)))}return d&&(o.s=d,o.h=normalizeHue(Math.atan2(r,s)*180/Math.PI)),o}function convertOkhslToOklab(a){let t=a.h!==void 0?a.h:0,s=a.s!==void 0?a.s:0,r=a.l!==void 0?a.l:0;const o={mode:"oklab",l:toe_inv(r)};if(a.alpha!==void 0&&(o.alpha=a.alpha),!s||r===1)return o.a=o.b=0,o;let n=Math.cos(t/180*Math.PI),l=Math.sin(t/180*Math.PI),[h,g,d]=get_Cs(o.l,n,l),A,S,O,I;s<.8?(A=1.25*s,S=0,O=.8*h,I=1-O/g):(A=5*(s-.8),S=g,O=.2*g*g*1.25*1.25/h,I=1-O/(d-g));let W=S+A*O/(1-I*A);return o.a=W*n,o.b=W*l,o}const modeOkhsl={...modeHsl,mode:"okhsl",channels:["h","s","l","alpha"],parse:["--okhsl"],serialize:"--okhsl",fromMode:{oklab:convertOklabToOkhsl,rgb:a=>convertOklabToOkhsl(convertRgbToOklab(a))},toMode:{oklab:convertOkhslToOklab,rgb:a=>convertOklabToRgb(convertOkhslToOklab(a))}},modeOkhsl$1=modeOkhsl;function convertOklabToOkhsv(a){let t=a.l!==void 0?a.l:0,s=a.a!==void 0?a.a:0,r=a.b!==void 0?a.b:0,o=Math.sqrt(s*s+r*r),n=o?s/o:1,l=o?r/o:1,[h,g]=get_ST_max(n,l),d=.5,A=1-d/h,S=g/(o+t*g),O=S*t,I=S*o,W=toe_inv(O),L=I*W/O,H=convertOklabToLrgb({l:W,a:n*L,b:l*L}),Y=Math.cbrt(1/Math.max(H.r,H.g,H.b,0));t=t/Y,o=o/Y*toe(t)/t,t=toe(t);const Q={mode:"okhsv",s:o?(d+g)*I/(g*d+g*A*I):0,v:t?t/O:0};return Q.s&&(Q.h=normalizeHue(Math.atan2(r,s)*180/Math.PI)),a.alpha!==void 0&&(Q.alpha=a.alpha),Q}function convertOkhsvToOklab(a){const t={mode:"oklab"};a.alpha!==void 0&&(t.alpha=a.alpha);const s=a.h!==void 0?a.h:0,r=a.s!==void 0?a.s:0,o=a.v!==void 0?a.v:0,n=Math.cos(s/180*Math.PI),l=Math.sin(s/180*Math.PI),[h,g]=get_ST_max(n,l),d=.5,A=1-d/h,S=1-r*d/(d+g-g*A*r),O=r*g*d/(d+g-g*A*r),I=toe_inv(S),W=O*I/S,L=convertOklabToLrgb({l:I,a:n*W,b:l*W}),H=Math.cbrt(1/Math.max(L.r,L.g,L.b,0)),Y=toe_inv(o*S),Q=O*Y/S;return t.l=Y*H,t.a=Q*n*H,t.b=Q*l*H,t}const modeOkhsv={...modeHsv,mode:"okhsv",channels:["h","s","v","alpha"],parse:["--okhsv"],serialize:"--okhsv",fromMode:{oklab:convertOklabToOkhsv,rgb:a=>convertOklabToOkhsv(convertRgbToOklab(a))},toMode:{oklab:convertOkhsvToOklab,rgb:a=>convertOklabToRgb(convertOkhsvToOklab(a))}},modeOkhsv$1=modeOkhsv;function parseOklab(a,t){if(!t||t[0]!=="oklab")return;const s={mode:"oklab"},[,r,o,n,l]=t;if(!(r.type===Tok.Hue||o.type===Tok.Hue||n.type===Tok.Hue))return r.type!==Tok.None&&(s.l=Math.min(Math.max(0,r.type===Tok.Number?r.value:r.value/100),1)),o.type!==Tok.None&&(s.a=o.type===Tok.Number?o.value:o.value*.4/100),n.type!==Tok.None&&(s.b=n.type===Tok.Number?n.value:n.value*.4/100),l.type!==Tok.None&&(s.alpha=Math.min(1,Math.max(0,l.type===Tok.Number?l.value:l.value/100))),s}const definition$8={...modeLab,mode:"oklab",toMode:{lrgb:convertOklabToLrgb,rgb:convertOklabToRgb},fromMode:{lrgb:convertLrgbToOklab,rgb:convertRgbToOklab},ranges:{l:[0,1],a:[-.4,.4],b:[-.4,.4]},parse:[parseOklab],serialize:a=>`oklab(${a.l!==void 0?a.l:"none"} ${a.a!==void 0?a.a:"none"} ${a.b!==void 0?a.b:"none"}${a.alpha<1?` / ${a.alpha}`:""})`},modeOklab=definition$8;function parseOklch(a,t){if(!t||t[0]!=="oklch")return;const s={mode:"oklch"},[,r,o,n,l]=t;if(r.type!==Tok.None){if(r.type===Tok.Hue)return;s.l=Math.min(Math.max(0,r.type===Tok.Number?r.value:r.value/100),1)}if(o.type!==Tok.None&&(s.c=Math.max(0,o.type===Tok.Number?o.value:o.value*.4/100)),n.type!==Tok.None){if(n.type===Tok.Percentage)return;s.h=n.value}return l.type!==Tok.None&&(s.alpha=Math.min(1,Math.max(0,l.type===Tok.Number?l.value:l.value/100))),s}const definition$7={...modeLch,mode:"oklch",toMode:{oklab:a=>convertLchToLab(a,"oklab"),rgb:a=>convertOklabToRgb(convertLchToLab(a,"oklab"))},fromMode:{rgb:a=>convertLabToLch(convertRgbToOklab(a),"oklch"),oklab:a=>convertLabToLch(a,"oklch")},parse:[parseOklch],serialize:a=>`oklch(${a.l!==void 0?a.l:"none"} ${a.c!==void 0?a.c:"none"} ${a.h!==void 0?a.h:"none"}${a.alpha<1?` / ${a.alpha}`:""})`,ranges:{l:[0,1],c:[0,.4],h:[0,360]}},modeOklch=definition$7,convertP3ToXyz65=a=>{let{r:t,g:s,b:r,alpha:o}=convertRgbToLrgb(a),n={mode:"xyz65",x:.486570948648216*t+.265667693169093*s+.1982172852343625*r,y:.2289745640697487*t+.6917385218365062*s+.079286914093745*r,z:0*t+.0451133818589026*s+1.043944368900976*r};return o!==void 0&&(n.alpha=o),n},convertXyz65ToP3=({x:a,y:t,z:s,alpha:r})=>{a===void 0&&(a=0),t===void 0&&(t=0),s===void 0&&(s=0);let o=convertLrgbToRgb({r:a*2.4934969119414263-t*.9313836179191242-.402710784450717*s,g:a*-.8294889695615749+t*1.7626640603183465+.0236246858419436*s,b:a*.0358458302437845-t*.0761723892680418+.9568845240076871*s},"p3");return r!==void 0&&(o.alpha=r),o},definition$6={...modeRgb,mode:"p3",parse:["display-p3"],serialize:"display-p3",fromMode:{rgb:a=>convertXyz65ToP3(convertRgbToXyz65(a)),xyz65:convertXyz65ToP3},toMode:{rgb:a=>convertXyz65ToRgb(convertP3ToXyz65(a)),xyz65:convertP3ToXyz65}},modeP3=definition$6,gamma$1=a=>{let t=Math.abs(a);return t>=1/512?Math.sign(a)*Math.pow(t,1/1.8):16*a},convertXyz50ToProphoto=({x:a,y:t,z:s,alpha:r})=>{a===void 0&&(a=0),t===void 0&&(t=0),s===void 0&&(s=0);let o={mode:"prophoto",r:gamma$1(a*1.3457868816471585-t*.2555720873797946-.0511018649755453*s),g:gamma$1(a*-.5446307051249019+t*1.5082477428451466+.0205274474364214*s),b:gamma$1(a*0+t*0+1.2119675456389452*s)};return r!==void 0&&(o.alpha=r),o},linearize$1=(a=0)=>{let t=Math.abs(a);return t>=16/512?Math.sign(a)*Math.pow(t,1.8):a/16},convertProphotoToXyz50=a=>{let t=linearize$1(a.r),s=linearize$1(a.g),r=linearize$1(a.b),o={mode:"xyz50",x:.7977666449006423*t+.1351812974005331*s+.0313477341283922*r,y:.2880748288194013*t+.7118352342418731*s+899369387256e-16*r,z:0*t+0*s+.8251046025104602*r};return a.alpha!==void 0&&(o.alpha=a.alpha),o},convertProphotoToXyz50$1=convertProphotoToXyz50,definition$5={...modeRgb,mode:"prophoto",parse:["prophoto-rgb"],serialize:"prophoto-rgb",fromMode:{xyz50:convertXyz50ToProphoto,rgb:a=>convertXyz50ToProphoto(convertRgbToXyz50(a))},toMode:{xyz50:convertProphotoToXyz50$1,rgb:a=>convertXyz50ToRgb(convertProphotoToXyz50$1(a))}},modeProphoto=definition$5,α$1=1.09929682680944,β$1=.018053968510807,gamma=a=>{const t=Math.abs(a);return t>β$1?(Math.sign(a)||1)*(α$1*Math.pow(t,.45)-(α$1-1)):4.5*a},convertXyz65ToRec2020=({x:a,y:t,z:s,alpha:r})=>{a===void 0&&(a=0),t===void 0&&(t=0),s===void 0&&(s=0);let o={mode:"rec2020",r:gamma(a*1.7166511879712683-t*.3556707837763925-.2533662813736599*s),g:gamma(a*-.6666843518324893+t*1.6164812366349395+.0157685458139111*s),b:gamma(a*.0176398574453108-t*.0427706132578085+.9421031212354739*s)};return r!==void 0&&(o.alpha=r),o},α=1.09929682680944,β=.018053968510807,linearize=(a=0)=>{let t=Math.abs(a);return t<β*4.5?a/4.5:(Math.sign(a)||1)*Math.pow((t+α-1)/α,1/.45)},convertRec2020ToXyz65=a=>{let t=linearize(a.r),s=linearize(a.g),r=linearize(a.b),o={mode:"xyz65",x:.6369580483012911*t+.1446169035862083*s+.1688809751641721*r,y:.262700212011267*t+.6779980715188708*s+.059301716469862*r,z:0*t+.0280726930490874*s+1.0609850577107909*r};return a.alpha!==void 0&&(o.alpha=a.alpha),o},convertRec2020ToXyz65$1=convertRec2020ToXyz65,definition$4={...modeRgb,mode:"rec2020",fromMode:{xyz65:convertXyz65ToRec2020,rgb:a=>convertXyz65ToRec2020(convertRgbToXyz65(a))},toMode:{xyz65:convertRec2020ToXyz65$1,rgb:a=>convertXyz65ToRgb(convertRec2020ToXyz65$1(a))},parse:["rec2020"],serialize:"rec2020"},modeRec2020=definition$4,bias=.0037930732552754493,bias_cbrt=Math.cbrt(bias),transfer$1=a=>Math.cbrt(a)-bias_cbrt,convertRgbToXyb=a=>{const{r:t,g:s,b:r,alpha:o}=convertRgbToLrgb(a),n=transfer$1(.3*t+.622*s+.078*r+bias),l=transfer$1(.23*t+.692*s+.078*r+bias),h=transfer$1(.2434226892454782*t+.2047674442449682*s+.5518098665095535*r+bias),g={mode:"xyb",x:(n-l)/2,y:(n+l)/2,b:h-(n+l)/2};return o!==void 0&&(g.alpha=o),g},convertRgbToXyb$1=convertRgbToXyb,transfer=a=>Math.pow(a+bias_cbrt,3),convertXybToRgb=({x:a,y:t,b:s,alpha:r})=>{a===void 0&&(a=0),t===void 0&&(t=0),s===void 0&&(s=0);const o=transfer(a+t)-bias,n=transfer(t-a)-bias,l=transfer(s+t)-bias,h=convertLrgbToRgb({r:11.031566904639861*o-9.866943908131562*n-.16462299650829934*l,g:-3.2541473810744237*o+4.418770377582723*n-.16462299650829934*l,b:-3.6588512867136815*o+2.7129230459360922*n+1.9459282407775895*l});return r!==void 0&&(h.alpha=r),h},convertXybToRgb$1=convertXybToRgb,definition$3={mode:"xyb",channels:["x","y","b","alpha"],parse:["--xyb"],serialize:"--xyb",toMode:{rgb:convertXybToRgb$1},fromMode:{rgb:convertRgbToXyb$1},ranges:{x:[-.0154,.0281],y:[0,.8453],b:[-.2778,.388]},interpolate:{x:interpolatorLinear,y:interpolatorLinear,b:interpolatorLinear,alpha:{use:interpolatorLinear,fixup:fixupAlpha}}},modeXyb=definition$3,definition$2={mode:"xyz50",parse:["xyz-d50"],serialize:"xyz-d50",toMode:{rgb:convertXyz50ToRgb,lab:convertXyz50ToLab},fromMode:{rgb:convertRgbToXyz50,lab:convertLabToXyz50$1},channels:["x","y","z","alpha"],ranges:{x:[0,.964],y:[0,.999],z:[0,.825]},interpolate:{x:interpolatorLinear,y:interpolatorLinear,z:interpolatorLinear,alpha:{use:interpolatorLinear,fixup:fixupAlpha}}},modeXyz50=definition$2,convertXyz65ToXyz50=a=>{let{x:t,y:s,z:r,alpha:o}=a;t===void 0&&(t=0),s===void 0&&(s=0),r===void 0&&(r=0);let n={mode:"xyz50",x:1.0479298208405488*t+.0229467933410191*s-.0501922295431356*r,y:.0296278156881593*t+.990434484573249*s-.0170738250293851*r,z:-.0092430581525912*t+.0150551448965779*s+.7518742899580008*r};return o!==void 0&&(n.alpha=o),n},convertXyz65ToXyz50$1=convertXyz65ToXyz50,convertXyz50ToXyz65=a=>{let{x:t,y:s,z:r,alpha:o}=a;t===void 0&&(t=0),s===void 0&&(s=0),r===void 0&&(r=0);let n={mode:"xyz65",x:.9554734527042182*t-.0230985368742614*s+.0632593086610217*r,y:-.0283697069632081*t+1.0099954580058226*s+.021041398966943*r,z:.0123140016883199*t-.0205076964334779*s+1.3303659366080753*r};return o!==void 0&&(n.alpha=o),n},convertXyz50ToXyz65$1=convertXyz50ToXyz65,definition$1={mode:"xyz65",toMode:{rgb:convertXyz65ToRgb,xyz50:convertXyz65ToXyz50$1},fromMode:{rgb:convertRgbToXyz65,xyz50:convertXyz50ToXyz65$1},ranges:{x:[0,.95],y:[0,1],z:[0,1.088]},channels:["x","y","z","alpha"],parse:["xyz","xyz-d65"],serialize:"xyz-d65",interpolate:{x:interpolatorLinear,y:interpolatorLinear,z:interpolatorLinear,alpha:{use:interpolatorLinear,fixup:fixupAlpha}}},modeXyz65=definition$1,convertRgbToYiq=({r:a,g:t,b:s,alpha:r})=>{a===void 0&&(a=0),t===void 0&&(t=0),s===void 0&&(s=0);const o={mode:"yiq",y:.29889531*a+.58662247*t+.11448223*s,i:.59597799*a-.2741761*t-.32180189*s,q:.21147017*a-.52261711*t+.31114694*s};return r!==void 0&&(o.alpha=r),o},convertRgbToYiq$1=convertRgbToYiq,convertYiqToRgb=({y:a,i:t,q:s,alpha:r})=>{a===void 0&&(a=0),t===void 0&&(t=0),s===void 0&&(s=0);const o={mode:"rgb",r:a+.95608445*t+.6208885*s,g:a-.27137664*t-.6486059*s,b:a-1.10561724*t+1.70250126*s};return r!==void 0&&(o.alpha=r),o},convertYiqToRgb$1=convertYiqToRgb,definition={mode:"yiq",toMode:{rgb:convertYiqToRgb$1},fromMode:{rgb:convertRgbToYiq$1},channels:["y","i","q","alpha"],parse:["--yiq"],serialize:"--yiq",ranges:{i:[-.595,.595],q:[-.522,.522]},interpolate:{y:interpolatorLinear,i:interpolatorLinear,q:interpolatorLinear,alpha:{use:interpolatorLinear,fixup:fixupAlpha}}},modeYiq=definition,clamp=a=>Math.max(0,Math.min(1,a||0)),fixup=a=>Math.round(clamp(a)*255),rgb$1=converter("rgb"),serializeHex=a=>{if(a===void 0)return;let t=fixup(a.r),s=fixup(a.g),r=fixup(a.b);return"#"+(1<<24|t<<16|s<<8|r).toString(16).slice(1)},formatHex=a=>serializeHex(rgb$1(a)),rgb=converter("rgb"),fixup_rgb=a=>{const t={mode:a.mode,r:Math.max(0,Math.min(a.r!==void 0?a.r:0,1)),g:Math.max(0,Math.min(a.g!==void 0?a.g:0,1)),b:Math.max(0,Math.min(a.b!==void 0?a.b:0,1))};return a.alpha!==void 0&&(t.alpha=a.alpha),t},to_displayable_srgb=a=>fixup_rgb(rgb(a)),inrange_rgb=a=>a!==void 0&&(a.r===void 0||a.r>=0&&a.r<=1)&&(a.g===void 0||a.g>=0&&a.g<=1)&&(a.b===void 0||a.b>=0&&a.b<=1);function displayable(a){return inrange_rgb(rgb(a))}function inGamut(a="rgb"){const{gamut:t}=getMode(a);if(!t)return r=>!0;const s=converter(typeof t=="string"?t:a);return r=>inrange_rgb(s(r))}function clampGamut(a="rgb"){const{gamut:t}=getMode(a);if(!t)return n=>prepare(n);const s=typeof t=="string"?t:a,r=converter(s),o=inGamut(s);return n=>{const l=prepare(n);if(!l)return;const h=r(l);if(o(h))return l;const g=fixup_rgb(h);return l.mode===g.mode?g:converter(l.mode)(g)}}function clampChroma(a,t="lch",s="rgb"){a=prepare(a);let r=s==="rgb"?displayable:inGamut(s),o=s==="rgb"?to_displayable_srgb:clampGamut(s);if(a===void 0||r(a))return a;let n=converter(a.mode);a=converter(t)(a);let l={...a,c:0};if(!r(l))return n(o(l));let h=0,g=a.c!==void 0?a.c:0,d=getMode(t).ranges.c,A=(d[1]-d[0])/Math.pow(2,13),S=l.c;for(;g-h>A;)l.c=h+(g-h)*.5,r(l)?(S=l.c,h=l.c):g=l.c;return n(r(l)?l:{...l,c:S})}function toGamut(a="rgb",t="oklch",s=differenceEuclidean("oklch"),r=.02){const o=converter(a),n=getMode(a);if(!n.gamut)return A=>o(A);const l=inGamut(a),h=clampGamut(a),g=converter(t),{ranges:d}=getMode(t);return A=>{if(A=prepare(A),A===void 0)return;const S={...g(A)};if(S.l===void 0&&(S.l=0),S.c===void 0&&(S.c=0),S.l>=d.l[1]){const H={...n.white,mode:a};return A.alpha!==void 0&&(H.alpha=A.alpha),H}if(S.l<=d.l[0]){const H={...n.black,mode:a};return A.alpha!==void 0&&(H.alpha=A.alpha),H}if(l(S))return o(S);let O=0,I=S.c,W=(d.c[1]-d.c[0])/4e3,L=h(S);for(;I-O>W;)S.c=(O+I)*.5,L=h(S),l(S)||s&&r>0&&s(S,L)<=r?O=S.c:I=S.c;return o(l(S)?S:L)}}useMode(modeA98);useMode(modeCubehelix);useMode(modeDlab);useMode(modeDlch);useMode(modeHsi);useMode(modeHsl);useMode(modeHsv);useMode(modeHwb);useMode(modeItp);useMode(modeJab);useMode(modeJch);useMode(modeLab);useMode(modeLab65);useMode(modeLch);useMode(modeLch65);useMode(modeLchuv);useMode(modeLrgb);useMode(modeLuv);useMode(modeOkhsl$1);useMode(modeOkhsv$1);useMode(modeOklab);useMode(modeOklch);useMode(modeP3);useMode(modeProphoto);useMode(modeRec2020);useMode(modeRgb);useMode(modeXyb);useMode(modeXyz50);useMode(modeXyz65);useMode(modeYiq);toGamut("rgb");const okhslConverter=converter("okhsl"),okhslToRGBString=(a,t,s)=>formatHex(clampChroma({mode:"okhsl",h:a,s:t,l:s},"oklch")),parseToOKHSL=a=>okhslConverter(parse(a)),mediaQueryList=window.matchMedia("(prefers-color-scheme: dark)"),isOSDarkModeProperty=new BooleanProperty(mediaQueryList.matches);mediaQueryList.addEventListener("change",a=>{isOSDarkModeProperty.value=a.matches});const themeColorPropertyNames=["navbarBackgroundColorProperty","navbarErrorBackgroundColorProperty","playAreaBackgroundColorProperty","playAreaLinearTopColorProperty","playAreaLinearMiddleColorProperty","playAreaLinearBottomColorProperty","playAreaRadialInsideColorProperty","playAreaRadialOutsideColorProperty","puzzleBackgroundColorProperty","puzzleBackgroundStrokeColorProperty","vertexColorProperty","xColorProperty","blackLineColorProperty","redLineColorProperty","whiteLineColorProperty","selectedFaceColorHighlightColorProperty","selectedSectorEditColorProperty","hoverHighlightColorProperty","simpleRegionTargetColorProperty","faceColorBasicTargetColorProperty","faceColorLightTargetColorProperty","faceColorDarkTargetColorProperty","faceColorOutsideColorProperty","faceColorInsideColorProperty","faceColorDefaultColorProperty","sectorOnlyOneColorProperty","sectorNotOneColorProperty","sectorNotZeroColorProperty","sectorNotTwoColorProperty","sectorOtherColorProperty","vertexStateLineProperty","vertexStateBackgroundProperty","vertexStateOutlineProperty","vertexStatePointProperty","faceValueColorProperty","faceValueCompletedColorProperty","faceValueErrorColorProperty","edgeWeirdColorProperty","uiForegroundColorProperty","uiBackgroundColorProperty","uiButtonForegroundProperty","uiButtonBaseColorProperty","uiButtonDisabledColorProperty","uiButtonSelectedStrokeColorProperty","uiButtonDeselectedStrokeColorProperty","barrierColorProperty","generateAddedFaceColorProperty","generateMinimizedFaceColorProperty"],themeLUTPropertyNames=["simpleRegionHueLUTProperty","faceColorBasicHueLUTProperty","faceColorLightHueLUTProperty","faceColorDarkHueLUTProperty"],themeFromProperty=a=>{const t={};for(const s of themeColorPropertyNames)t[s]=new DynamicProperty(a,{derive:s});for(const s of themeLUTPropertyNames)t[s]=new DynamicProperty(a,{derive:s});return t},getLUTProperty=a=>new DerivedProperty([a],t=>{const s=parseToOKHSL(t.toHexString()),r=t.alpha,o=s.h,n=l=>{let h=l-o;return h>180&&(h-=360),h<-180&&(h+=360),h*=1-r,h=Math.round(h),(h+o+360)%360};return _$1.range(0,360).map(l=>okhslToRGBString(n(l),s.s,s.l))}),addThemeLUT=a=>{const t={...a};return t.simpleRegionHueLUTProperty=getLUTProperty(a.simpleRegionTargetColorProperty),t.faceColorBasicHueLUTProperty=getLUTProperty(a.faceColorBasicTargetColorProperty),t.faceColorLightHueLUTProperty=getLUTProperty(a.faceColorLightTargetColorProperty),t.faceColorDarkHueLUTProperty=getLUTProperty(a.faceColorDarkTargetColorProperty),t},lightTheme=addThemeLUT({name:"Light",isEditable:!0,navbarBackgroundColorProperty:new PaintColorProperty("rgb(238,238,238)"),navbarErrorBackgroundColorProperty:new PaintColorProperty("rgb(218,107,91)"),playAreaBackgroundColorProperty:new PaintColorProperty("rgb(237,237,237)"),playAreaLinearTopColorProperty:new PaintColorProperty("rgba(0,0,0,0)"),playAreaLinearMiddleColorProperty:new PaintColorProperty("rgba(0,0,0,0)"),playAreaLinearBottomColorProperty:new PaintColorProperty("rgba(0,0,0,0)"),playAreaRadialInsideColorProperty:new PaintColorProperty("rgba(255,255,255,0)"),playAreaRadialOutsideColorProperty:new PaintColorProperty("rgba(173,199,210,0)"),puzzleBackgroundColorProperty:new PaintColorProperty("rgb(255,255,255)"),puzzleBackgroundStrokeColorProperty:new PaintColorProperty("rgb(179,179,179)"),vertexColorProperty:new PaintColorProperty("rgb(0,0,0)"),xColorProperty:new PaintColorProperty("rgb(255,0,0)"),blackLineColorProperty:new PaintColorProperty("rgb(64,64,64)"),redLineColorProperty:new PaintColorProperty("rgba(0,0,0,0.47999999999999998224)"),whiteLineColorProperty:new PaintColorProperty("rgb(153,153,153)"),selectedFaceColorHighlightColorProperty:new PaintColorProperty("rgba(0,0,0,0.5)"),selectedSectorEditColorProperty:new PaintColorProperty("rgba(0,0,0,0.80000000000000004441)"),hoverHighlightColorProperty:new PaintColorProperty("rgba(127,127,127,0.5999999999999999778)"),simpleRegionTargetColorProperty:new PaintColorProperty("rgba(79,140,238,0)"),faceColorBasicTargetColorProperty:new PaintColorProperty("rgba(240,214,214,0)"),faceColorLightTargetColorProperty:new PaintColorProperty("rgba(245,224,224,0)"),faceColorDarkTargetColorProperty:new PaintColorProperty("rgba(223,191,191,0)"),faceColorOutsideColorProperty:new PaintColorProperty("rgb(255,255,255)"),faceColorInsideColorProperty:new PaintColorProperty("rgb(214,214,214)"),faceColorDefaultColorProperty:new PaintColorProperty("rgb(237,237,237)"),sectorOnlyOneColorProperty:new PaintColorProperty("rgb(255,0,0)"),sectorNotOneColorProperty:new PaintColorProperty("rgb(0,153,204)"),sectorNotZeroColorProperty:new PaintColorProperty("rgb(0,163,0)"),sectorNotTwoColorProperty:new PaintColorProperty("rgb(236,124,19)"),sectorOtherColorProperty:new PaintColorProperty("rgb(182,26,255)"),vertexStateLineProperty:new PaintColorProperty("rgb(0,132,255)"),vertexStateBackgroundProperty:new PaintColorProperty("rgb(255,255,255)"),vertexStateOutlineProperty:new PaintColorProperty("rgb(120,120,120)"),vertexStatePointProperty:new PaintColorProperty("rgb(61,61,61)"),faceValueColorProperty:new PaintColorProperty("rgb(0,0,0)"),faceValueCompletedColorProperty:new PaintColorProperty("rgba(0,0,0,0.2000000000000000111)"),faceValueErrorColorProperty:new PaintColorProperty("rgb(255,0,0)"),edgeWeirdColorProperty:new PaintColorProperty("rgb(136,136,136)"),uiForegroundColorProperty:new PaintColorProperty("rgb(0,0,0)"),uiBackgroundColorProperty:new PaintColorProperty("rgb(255,255,255)"),uiButtonForegroundProperty:new PaintColorProperty("rgb(0,0,0)"),uiButtonBaseColorProperty:new PaintColorProperty("rgb(153,206,255)"),uiButtonDisabledColorProperty:new PaintColorProperty("rgb(220,220,220)"),uiButtonSelectedStrokeColorProperty:new PaintColorProperty("rgb(0,0,0)"),uiButtonDeselectedStrokeColorProperty:new PaintColorProperty("rgb(50,50,50)"),barrierColorProperty:new PaintColorProperty("rgba(127,127,127,0.69999999999999995559)"),generateAddedFaceColorProperty:new PaintColorProperty("rgb(216,184,241)"),generateMinimizedFaceColorProperty:new PaintColorProperty("rgb(173,200,244)")}),darkTheme=addThemeLUT({name:"Dark",isEditable:!0,navbarBackgroundColorProperty:new PaintColorProperty("rgb(17,17,17)"),navbarErrorBackgroundColorProperty:new PaintColorProperty("rgb(115,44,34)"),playAreaBackgroundColorProperty:new PaintColorProperty("rgb(51,51,51)"),playAreaLinearTopColorProperty:new PaintColorProperty("rgba(0,0,0,0)"),playAreaLinearMiddleColorProperty:new PaintColorProperty("rgba(0,0,0,0)"),playAreaLinearBottomColorProperty:new PaintColorProperty("rgba(0,0,0,0)"),playAreaRadialInsideColorProperty:new PaintColorProperty("rgba(66,66,66,0.30999999999999999778)"),playAreaRadialOutsideColorProperty:new PaintColorProperty("rgba(0,0,0,0.17999999999999999334)"),puzzleBackgroundColorProperty:new PaintColorProperty("rgb(13,13,13)"),puzzleBackgroundStrokeColorProperty:new PaintColorProperty("rgb(89,89,89)"),vertexColorProperty:new PaintColorProperty("rgb(119,119,119)"),xColorProperty:new PaintColorProperty("rgb(255,0,0)"),blackLineColorProperty:new PaintColorProperty("rgb(170,170,170)"),redLineColorProperty:new PaintColorProperty("rgba(255,255,255,0.27000000000000001776)"),whiteLineColorProperty:new PaintColorProperty("rgb(85,85,85)"),selectedFaceColorHighlightColorProperty:new PaintColorProperty("rgba(255,255,255,0.5)"),selectedSectorEditColorProperty:new PaintColorProperty("rgba(255,255,255,0.80000000000000004441)"),hoverHighlightColorProperty:new PaintColorProperty("rgba(127,127,127,0.5999999999999999778)"),simpleRegionTargetColorProperty:new PaintColorProperty("rgba(207,80,128,0)"),faceColorBasicTargetColorProperty:new PaintColorProperty("rgba(74,18,18,0)"),faceColorLightTargetColorProperty:new PaintColorProperty("rgba(101,43,40,0)"),faceColorDarkTargetColorProperty:new PaintColorProperty("rgba(74,18,18,0)"),faceColorOutsideColorProperty:new PaintColorProperty("rgb(13,13,13)"),faceColorInsideColorProperty:new PaintColorProperty("rgb(64,64,64)"),faceColorDefaultColorProperty:new PaintColorProperty("rgb(38,38,38)"),sectorOnlyOneColorProperty:new PaintColorProperty("rgb(255,0,0)"),sectorNotOneColorProperty:new PaintColorProperty("rgb(8,164,217)"),sectorNotZeroColorProperty:new PaintColorProperty("rgb(42,137,42)"),sectorNotTwoColorProperty:new PaintColorProperty("rgb(224,124,31)"),sectorOtherColorProperty:new PaintColorProperty("rgb(153,0,224)"),vertexStateLineProperty:new PaintColorProperty("rgb(255,119,41)"),vertexStateBackgroundProperty:new PaintColorProperty("rgb(0,0,0)"),vertexStateOutlineProperty:new PaintColorProperty("rgb(56,56,56)"),vertexStatePointProperty:new PaintColorProperty("rgb(209,209,209)"),faceValueColorProperty:new PaintColorProperty("rgb(204,204,204)"),faceValueCompletedColorProperty:new PaintColorProperty("rgba(217,217,217,0.14000000000000001332)"),faceValueErrorColorProperty:new PaintColorProperty("rgb(255,0,0)"),edgeWeirdColorProperty:new PaintColorProperty("rgb(136,136,136)"),uiForegroundColorProperty:new PaintColorProperty("rgb(204,204,204)"),uiBackgroundColorProperty:new PaintColorProperty("rgb(34,34,34)"),uiButtonForegroundProperty:new PaintColorProperty("rgb(0,0,0)"),uiButtonBaseColorProperty:new PaintColorProperty("rgb(206,119,67)"),uiButtonDisabledColorProperty:new PaintColorProperty("rgb(128,128,128)"),uiButtonSelectedStrokeColorProperty:new PaintColorProperty("rgb(255,255,255)"),uiButtonDeselectedStrokeColorProperty:new PaintColorProperty("rgb(200,200,200)"),barrierColorProperty:new PaintColorProperty("rgba(60,60,60,0.69999999999999995559)"),generateAddedFaceColorProperty:new PaintColorProperty("rgb(92,42,123)"),generateMinimizedFaceColorProperty:new PaintColorProperty("rgb(33,68,126)")}),fadeLightTheme=addThemeLUT({...lightTheme,name:"Fade Light",isEditable:!0,navbarBackgroundColorProperty:new PaintColorProperty("rgb(33,33,33)"),playAreaBackgroundColorProperty:new PaintColorProperty("rgb(204,204,204)"),playAreaLinearTopColorProperty:new PaintColorProperty("rgba(255,102,0,0.36999999999999999556)"),playAreaLinearMiddleColorProperty:new PaintColorProperty("rgba(255,0,200,0.3499999999999999778)"),playAreaLinearBottomColorProperty:new PaintColorProperty("rgba(0,17,255,0.34000000000000002442)"),playAreaRadialInsideColorProperty:new PaintColorProperty("rgba(255,255,255,0)"),playAreaRadialOutsideColorProperty:new PaintColorProperty("rgba(255,255,255,0.79000000000000003553)"),puzzleBackgroundStrokeColorProperty:new PaintColorProperty("rgb(148,148,148)")}),fadeDarkTheme=addThemeLUT({...darkTheme,name:"Fade Dark",isEditable:!0,navbarBackgroundColorProperty:new PaintColorProperty("rgb(17,17,17)"),playAreaBackgroundColorProperty:new PaintColorProperty("rgb(255,255,255)"),playAreaLinearTopColorProperty:new PaintColorProperty("rgba(255,102,0,0.64000000000000001332)"),playAreaLinearMiddleColorProperty:new PaintColorProperty("rgba(255,0,208,0.54000000000000003553)"),playAreaLinearBottomColorProperty:new PaintColorProperty("rgba(4,0,255,0.42999999999999999334)"),playAreaRadialInsideColorProperty:new PaintColorProperty("rgba(0,0,0,0.46999999999999997335)"),playAreaRadialOutsideColorProperty:new PaintColorProperty("rgb(0,0,0)"),puzzleBackgroundColorProperty:new PaintColorProperty("rgb(24,23,22)"),puzzleBackgroundStrokeColorProperty:new PaintColorProperty("rgb(92,51,40)"),whiteLineColorProperty:new PaintColorProperty("rgb(78,73,70)")}),autoTheme={name:"Auto",isEditable:!1,...themeFromProperty(new DerivedProperty([isOSDarkModeProperty],a=>a?darkTheme:lightTheme))},availableThemes=[lightTheme,darkTheme,autoTheme,fadeLightTheme,fadeDarkTheme],themeProperty=new LocalStorageProperty("theme",{serialize:a=>a.name,deserialize:a=>availableThemes.find(t=>t.name===a)??autoTheme}),themeToJS=a=>{const t={};return t.name=`'${a.name}'`,t.isEditable=`${a.isEditable}`,themeColorPropertyNames.forEach(s=>{t[s]=`new PaintColorProperty( '${a[s].value.toCSS()}' )`}),`{
${Object.keys(t).map(s=>`  ${s}: ${t[s]}`).join(`,
`)}
}`},popupColorEditor=a=>{const t=document.createElement("div");t.style.zoom="0.5",t.style.backgroundColor="rgba(127,127,127,0.3)";const s=document.createElement("button");s.textContent="Close",s.addEventListener("click",()=>{document.body.removeChild(t)}),t.appendChild(s);const r=document.createElement("div"),o=document.createElement("button");o.textContent="Toggle Visibility",o.addEventListener("click",()=>{r.style.display=r.style.display==="none"?"block":"none"}),t.appendChild(o);const n=document.createElement("button");n.textContent="Copy to Clipboard",n.addEventListener("click",()=>{copyToClipboard(themeToJS(a))}),t.appendChild(n),t.appendChild(r),Object.keys(a).forEach(l=>{const h=a[l];if(h instanceof PaintColorProperty){const g=document.createElement("div"),d=document.createElement("input");d.type="color",d.value=h.value.withAlpha(1).toHexString(),d.style.margin="1px",d.style.marginRight="10px";const A=h.value.alpha,S=document.createElement("input"),O=document.createElement("span");S.style.width="100px",S.type="range",S.min="0",S.max="1",S.step="0.01",S.value=`${A}`,S.style.marginRight="10px",O.innerText=A.toFixed(2);const I=()=>{const W=S.valueAsNumber;O.innerText=W.toFixed(2),h.value=new Color(d.value).withAlpha(W)};d.addEventListener("input",I),S.addEventListener("input",I),g.appendChild(d),g.appendChild(O),g.appendChild(S),g.appendChild(document.createTextNode(l)),r.appendChild(g)}}),document.body.appendChild(t),t.style.position="absolute",t.style.zIndex="100000"},currentTheme=themeFromProperty(themeProperty),rectangularButtonAppearanceStrategy=RectangularButton.FlatAppearanceStrategy,uiFontFamily=platform.firefox?"Arial, sans-serif":"Helvetica, Arial, sans-serif",controlBarFont=new Font({family:uiFontFamily,size:15}),uiFont=new Font({family:uiFontFamily,size:16}),uiHeaderFont=new Font({family:uiFontFamily,size:16,weight:"bold"}),puzzleFont=new Font({family:uiFontFamily,size:25}),generateButtonFont=new Font({family:uiFontFamily,size:25}),edgesVisibleProperty=new LocalStorageBooleanProperty("edgesVisibleProperty",!0),edgesHaveColorsProperty=new LocalStorageBooleanProperty("edgesHaveColorsProperty",!0),faceColorsVisibleProperty=new LocalStorageBooleanProperty("faceColorsVisibleProperty",!0),sectorsVisibleProperty=new LocalStorageBooleanProperty("sectorsVisibleProperty",!1),sectorsNextToEdgesVisibleProperty=new LocalStorageBooleanProperty("sectorsNextToEdgesVisibleProperty",!1),sectorsTrivialVisibleProperty=new LocalStorageBooleanProperty("sectorsTrivialVisibleProperty",!1),vertexStateVisibleProperty=new LocalStorageBooleanProperty("vertexStateVisibleProperty",!1),allVertexStateVisibleProperty=new LocalStorageBooleanProperty("allVertexStateVisibleProperty",!1),faceStateVisibleProperty=new LocalStorageBooleanProperty("faceStateVisibleProperty",!1),redLineVisibleProperty=new LocalStorageBooleanProperty("redLineVisibleProperty",!1),whiteLineVisibleProperty=new LocalStorageBooleanProperty("whiteLineVisibleProperty",!0),verticesVisibleProperty=new LocalStorageBooleanProperty("verticesVisibleProperty",!1),redXsVisibleProperty=new LocalStorageBooleanProperty("redXsVisibleProperty",!1),redXsAlignedProperty=new LocalStorageBooleanProperty("redXsAlignedProperty",!1),showHoverHighlightsProperty=new LocalStorageBooleanProperty("showHoverHighlightsProperty",!1),faceColorThresholdProperty=new LocalStorageNumberProperty("faceColorThresholdProperty",Number.POSITIVE_INFINITY),lineJoins=["miter","round","bevel"],joinedLinesJoinProperty=new LocalStorageStringProperty("joinedLinesJoinProperty","round"),lineCaps=["butt","round","square"],joinedLinesCapProperty=new LocalStorageStringProperty("joinedLinesCapProperty","round"),vertexStyles=["round","square"],vertexStyleProperty=new LocalStorageStringProperty("vertexStyleProperty","round"),redLineStyles=["full","gap","middle"],redLineStyleProperty=new LocalStorageStringProperty("redLineStyleProperty","middle"),faceValueStyles=["static","remaining","ratio"],faceValueStyleProperty=new LocalStorageStringProperty("faceValueStyleProperty","static"),smallVertexProperty=new LocalStorageBooleanProperty("smallVertexProperty",!0),controlBarMargin=5,assert$2=(a,...t)=>window.assert(a,...t),assertEnabled=()=>!!window.assert;class BaseVertex{constructor(t,s){gt(this,"incomingHalfEdges");gt(this,"outgoingHalfEdges");gt(this,"edges");gt(this,"faces");this.logicalCoordinates=t,this.viewCoordinates=s,assertEnabled()&&assert$2(t),assertEnabled()&&assert$2(s)}getHalfEdgeTo(t){const s=this.outgoingHalfEdges.find(r=>r.end===t);return assertEnabled()&&assert$2(s),s}getHalfEdgeFrom(t){const s=this.incomingHalfEdges.find(r=>r.start===t);return assertEnabled()&&assert$2(s),s}getEdgeTo(t){const s=this.edges.find(r=>r.start===t||r.end===t);return assertEnabled()&&assert$2(s),s}}class BaseFace{constructor(t,s){gt(this,"halfEdges");gt(this,"edges");gt(this,"vertices");this.logicalCoordinates=t,this.viewCoordinates=s,assertEnabled()&&assert$2(t),assertEnabled()&&assert$2(s)}}class BaseEdge{constructor(t,s){gt(this,"forwardHalf");gt(this,"reversedHalf");gt(this,"forwardFace");gt(this,"reversedFace");gt(this,"vertices");gt(this,"faces");this.start=t,this.end=s,assertEnabled()&&assert$2(t),assertEnabled()&&assert$2(s)}getOtherVertex(t){return assertEnabled()&&assert$2(t===this.start||t===this.end,"vertex must be one of the two vertices of this edge"),t===this.start?this.end:this.start}getOtherFace(t){return assertEnabled()&&assert$2(t===this.forwardFace||t===this.reversedFace,"face must be one of the two faces of this edge"),t===this.forwardFace?this.reversedFace:this.forwardFace}}class BaseHalfEdge{constructor(t,s,r){gt(this,"edge");gt(this,"reversed");gt(this,"next");gt(this,"previous");gt(this,"face",null);this.start=t,this.end=s,this.isReversed=r,assertEnabled()&&assert$2(t),assertEnabled()&&assert$2(s)}}const getSignedArea=a=>{let t=0;for(let s=0;s<a.length;s++){const r=a[s],o=a[(s+1)%a.length];t+=(o.x+r.x)*(o.y-r.y)}return .5*t},getArea=a=>Math.abs(getSignedArea(a)),getCentroid=a=>{const t=getSignedArea(a);if(t===0)return a.reduce((o,n)=>o.plus(n),new Vector2(0,0)).timesScalar(1/a.length);let s=0,r=0;for(let o=0;o<a.length;o++){const n=a[o],l=a[(o+1)%a.length],h=n.x*(2*n.y+l.y)+l.x*(n.y+2*l.y);s+=(n.x-l.x)*h,r+=(l.y-n.y)*h}return new Vector2(s,r).timesScalar(1/(6*t))},getSignedAreaDerivative=(a,t)=>{let s=0;for(let r=0;r<a.length;r++){const o=a[r],n=a[(r+1)%a.length],l=t[r],h=t[(r+1)%a.length];s+=(n.x+o.x)*(h.y-l.y)+(h.x-l.x)*(n.y-o.y)}return .5*s},rescaleProtoDescriptor=(a,t)=>{const s=a.faces.map(l=>getArea(l.vertices.map(h=>h.viewCoordinates))),r=t(s),o=a.vertices.map(l=>({logicalCoordinates:l.logicalCoordinates,viewCoordinates:l.viewCoordinates.timesScalar(r)})),n=new Map(o.map((l,h)=>[a.vertices[h],l]));return{vertices:o,faces:a.faces.map(l=>({logicalCoordinates:l.logicalCoordinates,vertices:l.vertices.map(h=>n.get(h))}))}},rescaleProtoDescriptorAverage=(a,t)=>rescaleProtoDescriptor(a,s=>Math.sqrt(t/(_$1.sum(s)/s.length))),rescaleProtoDescriptorMinimum=(a,t)=>rescaleProtoDescriptor(a,s=>Math.sqrt(t/Math.min(...s)));class EdgeIdentifier{constructor(t,s){this.start=t,this.end=s}isCanonicalHalfEdge(){return this.start.x<this.end.x||this.start.x===this.end.x&&this.start.y<this.end.y}}class EdgeIdentifierLookup{constructor(){gt(this,"identifiers",[]);gt(this,"canonicalIdentifiers",[]);gt(this,"map",new Map)}add(t,s){if(assertEnabled()&&assert$2(t.x!==s.x||t.y!==s.y),this.lookupAttempt(t,s)!==null)return;const r=(o,n)=>{let l;this.map.has(o)?l=this.map.get(o):(l=new Map,this.map.set(o,l));const h=new EdgeIdentifier(o,n);l.set(n,h),this.identifiers.push(h),h.isCanonicalHalfEdge()&&this.canonicalIdentifiers.push(h)};r(t,s),r(s,t)}getAdjacentLocations(t){const s=this.map.get(t);return s?Array.from(s.keys()):[]}lookupAttempt(t,s){const r=this.map.get(t);return r?r.get(s)??null:null}lookup(t,s){const r=this.lookupAttempt(t,s);return assertEnabled()&&assert$2(r),r}lookupCanonical(t,s){const r=this.lookup(t,s);return r.isCanonicalHalfEdge()?r:this.lookup(s,t)}}const createBoardDescriptor=a=>{const t=a.vertices;let s=a.faces;s=s.map(Q=>getSignedArea(Q.vertices.map(pe=>pe.viewCoordinates))>0?Q:{logicalCoordinates:Q.logicalCoordinates,vertices:Q.vertices.slice().reverse()});const r=new EdgeIdentifierLookup;s.forEach(Q=>{for(let pe=0;pe<Q.vertices.length;pe++){const de=Q.vertices[pe].logicalCoordinates,fe=Q.vertices[(pe+1)%Q.vertices.length].logicalCoordinates;r.add(de,fe)}});const o=new Map,n=new Map,l=new Map,h=new Map,g=Q=>o.get(Q)??null,d=Q=>n.get(Q)??null,A=(Q,pe)=>{const de=r.lookup(Q,pe);return h.get(de)??null},S=t.map(Q=>new BaseVertex(Q.logicalCoordinates,Q.viewCoordinates));S.forEach(Q=>o.set(Q.logicalCoordinates,Q));const O=s.map(Q=>new BaseFace(Q.logicalCoordinates,getCentroid(Q.vertices.map(pe=>pe.viewCoordinates))));O.forEach(Q=>n.set(Q.logicalCoordinates,Q));const I=r.canonicalIdentifiers.map(Q=>new BaseEdge(g(Q.start),g(Q.end)));I.forEach(Q=>l.set(r.lookupCanonical(Q.start.logicalCoordinates,Q.end.logicalCoordinates),Q));const W=r.identifiers.map(Q=>new BaseHalfEdge(g(Q.start),g(Q.end),!Q.isCanonicalHalfEdge()));W.forEach(Q=>h.set(r.lookup(Q.start.logicalCoordinates,Q.end.logicalCoordinates),Q)),I.forEach(Q=>{const pe=A(Q.start.logicalCoordinates,Q.end.logicalCoordinates),de=A(Q.end.logicalCoordinates,Q.start.logicalCoordinates);assertEnabled()&&assert$2(pe),assertEnabled()&&assert$2(de),pe.edge=Q,de.edge=Q,pe.reversed=de,de.reversed=pe,Q.forwardHalf=pe,Q.reversedHalf=de,Q.vertices=[Q.start,Q.end]}),s.forEach(Q=>{const pe=d(Q.logicalCoordinates),de=Q.vertices.map(Ee=>g(Ee.logicalCoordinates)),fe=[],ye=[];for(let Ee=0;Ee<de.length;Ee++){const Le=Q.vertices[Ee].logicalCoordinates,Z=Q.vertices[(Ee+1)%de.length].logicalCoordinates,ne=Q.vertices[(Ee+2)%de.length].logicalCoordinates,Ke=A(Le,Z);Ke.face=pe;const _t=A(Z,ne);Ke.next=_t,_t.previous=Ke,ye.push(Ke),fe.push(Ke.edge)}pe.halfEdges=ye,pe.edges=fe,pe.vertices=de}),W.forEach(Q=>{Q.face===void 0&&(Q.face=null)}),I.forEach(Q=>{Q.forwardFace=Q.forwardHalf.face,Q.reversedFace=Q.reversedHalf.face,Q.faces=[Q.forwardFace,Q.reversedFace].filter(pe=>pe!==null)});const L=new Set(W.filter(Q=>Q.face===null)),H=[],Y=[];for(;L.size;){const Q=L.values().next().value;L.delete(Q);const pe=ye=>{assertEnabled()&&assert$2(ye.face===null);const Ee=ye.end.logicalCoordinates,ne=r.getAdjacentLocations(Ee).filter(Ke=>Ke!==ye.start.logicalCoordinates).map(Ke=>A(Ee,Ke)).filter(Ke=>Ke.face===null);return assertEnabled()&&assert$2(ne.length===1),ne[0]},de=[Q];let fe=pe(Q);for(Q.next=fe,fe.previous=Q;fe!==Q;){de.push(fe),L.delete(fe);const ye=fe;fe=pe(fe),ye.next=fe,fe.previous=ye}getSignedArea(de.map(ye=>ye.start.viewCoordinates))<0?H.push(de):Y.push(de)}return assertEnabled()&&assert$2(H.length===1),S.forEach(Q=>{const pe=r.getAdjacentLocations(Q.logicalCoordinates),de=A(pe[0],Q.logicalCoordinates);let fe=de;const ye=[de];for(;fe.reversed.previous!==de;)assertEnabled()&&assert$2(fe.reversed.previous),fe=fe.reversed.previous,ye.push(fe);Q.incomingHalfEdges=ye,Q.outgoingHalfEdges=ye.map(Ee=>Ee.reversed),Q.edges=ye.map(Ee=>Ee.edge),Q.faces=ye.map(Ee=>Ee.face).filter(Ee=>Ee!==null)}),{edges:I,vertices:S,faces:O,halfEdges:W,outerBoundary:H[0],innerBoundaries:Y}};class CompositeSolver{constructor(t){this.solvers=t}get dirty(){return this.solvers.some(t=>t.dirty)}nextAction(){for(const t of this.solvers)if(t.dirty){const s=t.nextAction();if(s)return s}return null}clone(t){return new CompositeSolver(this.solvers.map(s=>s.clone(t)))}dispose(){this.solvers.forEach(t=>t.dispose())}}const po=class po extends EnumerationValue{};gt(po,"WHITE",new po),gt(po,"BLACK",new po),gt(po,"RED",new po),gt(po,"enumeration",new Enumeration(po));let EdgeState=po;const serializeHalfEdge=a=>({start:{x:a.start.logicalCoordinates.x,y:a.start.logicalCoordinates.y},end:{x:a.end.logicalCoordinates.x,y:a.end.logicalCoordinates.y}}),deserializeHalfEdge=(a,t)=>{const s=a.halfEdges.find(r=>r.start.logicalCoordinates.x===t.start.x&&r.start.logicalCoordinates.y===t.start.y&&r.end.logicalCoordinates.x===t.end.x&&r.end.logicalCoordinates.y===t.end.y);return assertEnabled()&&assert$2(s),s};class GeneralSimpleRegion{constructor(t,s,r=!1){gt(this,"edges");gt(this,"a");gt(this,"b");if(this.id=t,this.halfEdges=s,this.isSolved=r,this.a=s[0].start,this.b=s[s.length-1].end,this.edges=s.map(o=>o.edge),assertEnabled()){assert$2(s.length>0);for(let o=0;o<s.length-1;o++)assert$2(s[o].end===s[o+1].start)}}static deserializeSimpleRegion(t,s){return new GeneralSimpleRegion(s.id,s.halfEdges.map(r=>deserializeHalfEdge(t,r)),s.isSolved)}}const serializeEdge=a=>({start:{x:a.start.logicalCoordinates.x,y:a.start.logicalCoordinates.y},end:{x:a.end.logicalCoordinates.x,y:a.end.logicalCoordinates.y}}),deserializeEdge=(a,t)=>{const s=a.edges.find(r=>r.start.logicalCoordinates.x===t.start.x&&r.start.logicalCoordinates.y===t.start.y&&r.end.logicalCoordinates.x===t.end.x&&r.end.logicalCoordinates.y===t.end.y);return assertEnabled()&&assert$2(s),s},serializedSimpleRegion=a=>({id:a.id,halfEdges:a.halfEdges.map(serializeHalfEdge),isSolved:a.isSolved}),simpleRegionIsSolved=a=>{const t=a.getSimpleRegions();return t.length===1&&t[0].isSolved&&a.getWeirdEdges().length===0},serializeSimpleRegionData=a=>({type:"SimpleRegionData",simpleRegions:a.getSimpleRegions().map(serializedSimpleRegion),weirdEdges:a.getWeirdEdges().map(serializeEdge)});class GeneralSimpleRegionAction{constructor(t,s=new Set,r=new Set,o=new Set,n=new Set){this.board=t,this.addedRegions=s,this.removedRegions=r,this.addedWeirdEdges=o,this.removedWeirdEdges=n}apply(t){t.modifyRegions(this.addedRegions,this.removedRegions,this.addedWeirdEdges,this.removedWeirdEdges)}getUndo(t){return new GeneralSimpleRegionAction(this.board,this.removedRegions,this.addedRegions,this.removedWeirdEdges,this.addedWeirdEdges)}isEmpty(){return this.addedRegions.size===0&&this.removedRegions.size===0&&this.addedWeirdEdges.size===0&&this.removedWeirdEdges.size===0}serializeAction(){return{type:"GeneralSimpleRegionAction",addedRegions:Array.from(this.addedRegions).map(serializedSimpleRegion),removedRegions:Array.from(this.removedRegions).map(serializedSimpleRegion),addedWeirdEdges:Array.from(this.addedWeirdEdges).map(serializeEdge),removedWeirdEdges:Array.from(this.removedWeirdEdges).map(serializeEdge)}}static deserializeAction(t,s){return new GeneralSimpleRegionAction(t,new Set(s.addedRegions.map(r=>GeneralSimpleRegion.deserializeSimpleRegion(t,r))),new Set(s.removedRegions.map(r=>GeneralSimpleRegion.deserializeSimpleRegion(t,r))),new Set(s.addedWeirdEdges.map(r=>deserializeEdge(t,r))),new Set(s.removedWeirdEdges.map(r=>deserializeEdge(t,r))))}}class AnnotatedAction{constructor(t,s){this.action=t,this.annotation=s}apply(t){this.action.apply(t)}getUndo(t){return new AnnotatedAction(this.action.getUndo(t),this.annotation)}isEmpty(){return this.action.isEmpty()}serializeAction(){throw new Error("unimplemented")}static deserializeAction(t,s){throw new Error("unimplemented")}}const getSimpleRegionGlobalId=()=>dotRandom.nextInt(Number.MAX_SAFE_INTEGER);class SafeEdgeToSimpleRegionSolver{constructor(t,s){gt(this,"dirtyEdges",new Set);gt(this,"edgeListener");this.board=t,this.state=s,t.edges.forEach(r=>{this.dirtyEdges.add(r)}),this.edgeListener=(r,o)=>{this.dirtyEdges.add(r)},this.state.edgeStateChangedEmitter.addListener(this.edgeListener)}get dirty(){return this.dirtyEdges.size>0}nextAction(){if(!this.dirty)return null;const t=this.state.getSimpleRegions(),s=this.state.getWeirdEdges(),r=new Set,o=new Set;for(const O of this.dirtyEdges)this.state.getEdgeState(O)===EdgeState.BLACK?r.add(O):o.add(O);const n=new Set,l=new Set,h=new Set(t),g=new Set,d=new Set,A=new Set(s);for(const O of o)A.has(O)&&(A.delete(O),d.add(O));for(const O of r)A.has(O)&&r.delete(O),[...h].some(I=>I.halfEdges.some(W=>W.edge===O))&&r.delete(O);for(const O of t)if(O.halfEdges.some(I=>o.has(I.edge))){const I=[];let W=[];for(const L of O.halfEdges)o.has(L.edge)?W.length>0&&(I.push(W),W=[]):W.push(L);if(W.length>0&&I.push(W),l.add(O),h.delete(O),I.length){if(O.isSolved&&I.length>1){const H=I[0][0],Y=I[I.length-1][I[I.length-1].length-1];H.start===Y.end&&I[0].unshift(...I.pop())}const L=_$1.maxBy(I,H=>H.length);for(const H of I){const Y=new GeneralSimpleRegion(H===L?O.id:getSimpleRegionGlobalId(),H);n.add(Y),h.add(Y)}}}const S=O=>{const I=O.start,W=O.end,L=[...h].find(fe=>fe.a===I||fe.b===I)||null,H=[...h].find(fe=>fe.a===W||fe.b===W)||null,Y=I.edges.filter(fe=>this.state.getEdgeState(fe)===EdgeState.BLACK).length,Q=W.edges.filter(fe=>this.state.getEdgeState(fe)===EdgeState.BLACK).length;if(Y>2||Q>2)return!1;const pe=fe=>{h.add(fe),n.add(fe)},de=fe=>{h.delete(fe),n.has(fe)?n.delete(fe):l.add(fe)};if(L&&H)if(L===H)if(SafeEdgeToSimpleRegionSolver.isSolvedWithAddedEdge(this.board,this.state,L,O))de(L),pe(new GeneralSimpleRegion(L.id,SafeEdgeToSimpleRegionSolver.combineHalfEdgeArrays(L.halfEdges,[O.forwardHalf]),!0));else return!1;else{const fe=L.halfEdges.length>=H.halfEdges.length?L:H,ye=fe===L?H:L,Ee=new GeneralSimpleRegion(fe.id,SafeEdgeToSimpleRegionSolver.combineHalfEdgeArrays(fe.halfEdges,[O.forwardHalf],ye.halfEdges));de(fe),de(ye),pe(Ee)}else if(L){const fe=new GeneralSimpleRegion(L.id,SafeEdgeToSimpleRegionSolver.combineHalfEdgeArrays(L.halfEdges,[O.forwardHalf]));de(L),pe(fe)}else if(H){const fe=new GeneralSimpleRegion(H.id,SafeEdgeToSimpleRegionSolver.combineHalfEdgeArrays(H.halfEdges,[O.forwardHalf]));de(H),pe(fe)}else{const fe=new GeneralSimpleRegion(getSimpleRegionGlobalId(),[O.forwardHalf]);pe(fe)}return!0};for(const O of A)S(O)&&(d.add(O),A.delete(O));for(const O of r)S(O)||(g.add(O),A.add(O));return this.dirtyEdges.clear(),n.size||l.size||g.size||d.size?new AnnotatedAction(new GeneralSimpleRegionAction(this.board,n,l,g,d),{type:"SimpleRegions"}):null}clone(t){return new SafeEdgeToSimpleRegionSolver(this.board,t)}dispose(){this.state.edgeStateChangedEmitter.removeListener(this.edgeListener)}static isSolvedWithAddedEdge(t,s,r,o){if(o.start!==r.a&&o.start!==r.b||o.end!==r.a&&o.end!==r.b)return!1;const n=new Set(r.edges);n.add(o);for(const l of t.faces){const h=s.getFaceValue(l);if(h!==null&&l.edges.filter(d=>n.has(d)).length!==h)return!1}return!0}static combineHalfEdgeArrays(...t){if(t.length===0)return[];let s=[...t[0]];for(let r=1;r<t.length;r++){const o=t[r];if(o.length!==0)if(s[0].start===o[0].start)s=[...o.map(n=>n.reversed).reverse(),...s];else if(s[0].start===o[o.length-1].end)s=[...o,...s];else if(s[s.length-1].end===o[0].start)s=[...s,...o];else if(s[s.length-1].end===o[o.length-1].end)s=[...s,...o.map(n=>n.reversed).reverse()];else throw new Error("Cannot combine half edge arrays")}return s}}class InvalidStateError extends Error{constructor(t){super(t)}}class EdgeStateCycleAction{constructor(t,s=!0){this.edge=t,this.forward=s}apply(t){const s=t.getEdgeState(this.edge);s===EdgeState.WHITE?t.setEdgeState(this.edge,this.forward?EdgeState.BLACK:EdgeState.RED):s===EdgeState.BLACK?t.setEdgeState(this.edge,this.forward?EdgeState.RED:EdgeState.WHITE):t.setEdgeState(this.edge,this.forward?EdgeState.WHITE:EdgeState.BLACK)}getUndo(t){return new EdgeStateCycleAction(this.edge,!this.forward)}isEmpty(){return!1}serializeAction(){return{type:"EdgeStateCycleAction",edge:serializeEdge(this.edge),forward:this.forward}}static deserializeAction(t,s){return new EdgeStateCycleAction(deserializeEdge(t,s.edge),s.forward)}}class EdgeStateSetAction{constructor(t,s){this.edge=t,this.state=s}apply(t){t.setEdgeState(this.edge,this.state)}getUndo(t){const s=t.getEdgeState(this.edge);return new EdgeStateSetAction(this.edge,s)}isEmpty(){return!1}serializeAction(){return{type:"EdgeStateSetAction",edge:serializeEdge(this.edge),state:this.state.name}}static deserializeAction(t,s){return new EdgeStateSetAction(deserializeEdge(t,s.edge),EdgeState.enumeration.getValue(s.state))}}class GeneralEdgeStateAction{constructor(t,s=new Map){this.board=t,this.edgeStateMap=s}apply(t){for(const[s,r]of this.edgeStateMap)t.setEdgeState(s,r)}getUndo(t){const s=new Map;for(const r of this.edgeStateMap.keys())s.set(r,t.getEdgeState(r));return new GeneralEdgeStateAction(this.board,s)}isEmpty(){return this.edgeStateMap.size===0}serializeAction(){return{type:"GeneralEdgeAction",edges:Array.from(this.edgeStateMap.entries()).map(([t,s])=>({edge:serializeEdge(t),state:s.name}))}}static deserializeAction(t,s){return new GeneralEdgeStateAction(t,new Map(s.edges.map(r=>[deserializeEdge(t,r.edge),EdgeState.enumeration.getValue(r.state)])))}}const serializeFace=a=>({x:a.logicalCoordinates.x,y:a.logicalCoordinates.y}),deserializeFace=(a,t)=>{const s=a.faces.find(r=>r.logicalCoordinates.x===t.x&&r.logicalCoordinates.y===t.y);return assertEnabled()&&assert$2(s),s};class FaceValueSetAction{constructor(t,s){this.face=t,this.state=s}apply(t){t.setFaceValue(this.face,this.state)}getUndo(t){const s=t.getFaceValue(this.face);return new FaceValueSetAction(this.face,s)}isEmpty(){return!1}serializeAction(){return{type:"FaceValueSetAction",edge:serializeFace(this.face),state:this.state}}static deserializeAction(t,s){return new FaceValueSetAction(deserializeFace(t,s.edge),s.state)}}class GeneralFaceValueAction{constructor(t,s=new Map){this.board=t,this.faceValueMap=s}apply(t){for(const[s,r]of this.faceValueMap)t.setFaceValue(s,r)}getUndo(t){const s=new Map;for(const r of this.faceValueMap.keys())s.set(r,t.getFaceValue(r));return new GeneralFaceValueAction(this.board,s)}isEmpty(){return this.faceValueMap.size===0}serializeAction(){return{type:"GeneralFaceAction",faces:Array.from(this.faceValueMap.entries()).map(([t,s])=>({face:serializeFace(t),state:s}))}}static deserializeAction(t,s){return new GeneralFaceValueAction(t,new Map(s.faces.map(r=>[deserializeFace(t,r.face),r.state])))}}class NoOpAction{apply(t){}getUndo(t){return this}isEmpty(){return!0}serializeAction(){return{type:"NoOpAction"}}static deserializeAction(t,s){return new NoOpAction}}class CompleteAction{constructor(t,s,r,o,n,l,h){this.faceValueAction=t,this.edgeStateAction=s,this.simpleRegionAction=r,this.faceColorAction=o,this.sectorStateAction=n,this.vertexStateAction=l,this.faceStateAction=h}apply(t){this.faceValueAction.apply(t),this.edgeStateAction.apply(t),this.simpleRegionAction.apply(t),this.faceColorAction.apply(t),this.sectorStateAction.apply(t),this.vertexStateAction.apply(t),this.faceStateAction.apply(t)}getUndo(t){return new CompleteAction(this.faceValueAction.getUndo(t),this.edgeStateAction.getUndo(t),this.simpleRegionAction.getUndo(t),this.faceColorAction.getUndo(t),this.sectorStateAction.getUndo(t),this.vertexStateAction.getUndo(t),this.faceStateAction.getUndo(t))}isEmpty(){return this.faceValueAction.isEmpty()&&this.edgeStateAction.isEmpty()&&this.simpleRegionAction.isEmpty()&&this.faceColorAction.isEmpty()&&this.sectorStateAction.isEmpty()&&this.vertexStateAction.isEmpty()&&this.faceStateAction.isEmpty()}serializeAction(){return{type:"CompleteAction",faceValueAction:this.faceValueAction.serializeAction(),edgeStateAction:this.edgeStateAction.serializeAction(),simpleRegionAction:this.simpleRegionAction.serializeAction(),faceColorAction:this.faceColorAction.serializeAction(),sectorStateAction:this.sectorStateAction.serializeAction(),vertexStateAction:this.vertexStateAction.serializeAction(),faceStateAction:this.faceStateAction.serializeAction()}}static deserializeAction(t,s){return new CompleteAction(deserializeAction(t,s.faceStateAction),deserializeAction(t,s.edgeStateAction),deserializeAction(t,s.simpleRegionAction),deserializeAction(t,s.faceColorAction),deserializeAction(t,s.sectorStateAction),deserializeAction(t,s.vertexStateAction),deserializeAction(t,s.faceStateAction))}}const iterateSolver=(a,t)=>{let s=0;for(;a.dirty;){if(s++>1e5)throw new Error("Solver iteration limit exceeded? Looped?");const r=a.nextAction();r&&r.apply(t)}},iterateSolverAndDispose=(a,t)=>{try{iterateSolver(a,t)}finally{a.dispose()}},withSolverFactory=(a,t,s,r,o)=>{const n=a(t,s,o);r(),iterateSolverAndDispose(n,s)},iterateSolverFactory=(a,t,s,r)=>{withSolverFactory(a,t,s,()=>{},r)},serializeFaceValueData=(a,t)=>({type:"FaceValueData",faces:a.faces.filter(s=>t.getFaceValue(s)!==null).map(s=>({face:serializeFace(s),state:t.getFaceValue(s)}))});class GeneralFaceValueDelta extends GeneralFaceValueAction{constructor(s,r,o=new Map){super(s,o);gt(this,"faceValueChangedEmitter",new TinyEmitter);this.parentState=r}getFaceValue(s){return this.faceValueMap.has(s)?this.faceValueMap.get(s):this.parentState.getFaceValue(s)}setFaceValue(s,r){this.getFaceValue(s)!==r&&(this.faceValueMap.set(s,r),this.faceValueChangedEmitter.emit(s,r))}clone(){return new GeneralFaceValueDelta(this.board,this.parentState,new Map(this.faceValueMap))}createDelta(){return new GeneralFaceValueDelta(this.board,this,new Map)}serializeState(s){return serializeFaceValueData(s,this)}}class GeneralFaceValueData{constructor(t,s){gt(this,"faceValueChangedEmitter",new TinyEmitter);gt(this,"faceValueMap",new Map);this.board=t,t.faces.forEach(r=>{this.faceValueMap.set(r,s(r))})}getFaceValue(t){return assertEnabled()&&assert$2(this.faceValueMap.has(t)),this.faceValueMap.get(t)}setFaceValue(t,s){assertEnabled()&&assert$2(this.faceValueMap.has(t)),this.faceValueMap.get(t)!==s&&(this.faceValueMap.set(t,s),this.faceValueChangedEmitter.emit(t,s))}clone(){return new GeneralFaceValueData(this.board,t=>this.getFaceValue(t))}createDelta(){return new GeneralFaceValueDelta(this.board,this)}serializeState(t){return serializeFaceValueData(t,this)}static deserializeState(t,s){const r=new Map(s.faces.map(o=>[deserializeFace(t,o.face),o.state]));return new GeneralFaceValueData(t,o=>r.get(o)??null)}}const serializeEdgeStateData=(a,t)=>({type:"EdgeData",edges:a.edges.filter(s=>t.getEdgeState(s)!==EdgeState.WHITE).map(s=>({edge:serializeEdge(s),state:t.getEdgeState(s).name}))});class GeneralEdgeStateDelta extends GeneralEdgeStateAction{constructor(s,r,o=new Map){super(s,o);gt(this,"edgeStateChangedEmitter",new TinyEmitter);this.parentState=r}getEdgeState(s){return this.edgeStateMap.has(s)?this.edgeStateMap.get(s):this.parentState.getEdgeState(s)}setEdgeState(s,r){const o=this.getEdgeState(s);o!==r&&(this.edgeStateMap.set(s,r),this.edgeStateChangedEmitter.emit(s,r,o))}clone(){return new GeneralEdgeStateDelta(this.board,this.parentState,new Map(this.edgeStateMap))}createDelta(){return new GeneralEdgeStateDelta(this.board,this,new Map)}serializeState(s){return serializeEdgeStateData(s,this)}}class GeneralEdgeStateData{constructor(t,s){gt(this,"edgeStateChangedEmitter",new TinyEmitter);gt(this,"edgeStateMap",new Map);this.board=t,t.edges.forEach(r=>{this.edgeStateMap.set(r,s(r))})}getEdgeState(t){return assertEnabled()&&assert$2(this.edgeStateMap.has(t)),this.edgeStateMap.get(t)}setEdgeState(t,s){assertEnabled()&&assert$2(this.edgeStateMap.has(t));const r=this.edgeStateMap.get(t);r!==s&&(this.edgeStateMap.set(t,s),this.edgeStateChangedEmitter.emit(t,s,r))}clone(){return new GeneralEdgeStateData(this.board,t=>this.getEdgeState(t))}createDelta(){return new GeneralEdgeStateDelta(this.board,this)}serializeState(t){return serializeEdgeStateData(t,this)}static deserializeState(t,s){const r=new Map(s.edges.map(o=>[deserializeEdge(t,o.edge),EdgeState.enumeration.getValue(o.state)]));return new GeneralEdgeStateData(t,o=>r.get(o)??EdgeState.WHITE)}}class GeneralSimpleRegionDelta extends GeneralSimpleRegionAction{constructor(s,r,o=new Set,n=new Set,l=new Set,h=new Set){super(s,o,n,l,h);gt(this,"simpleRegionsChangedEmitter",new TinyEmitter);this.parentState=r}getSimpleRegions(){return[...this.parentState.getSimpleRegions().filter(s=>!this.removedRegions.has(s)),...this.addedRegions]}getSimpleRegionWithVertex(s){for(const r of this.getSimpleRegions())if(r.a===s||r.b===s)return r;return null}getSimpleRegionWithEdge(s){for(const r of this.getSimpleRegions())if(r.edges.includes(s))return r;return null}getSimpleRegionWithId(s){for(const r of this.getSimpleRegions())if(r.id===s)return r;return null}getWeirdEdges(){return[...this.parentState.getWeirdEdges().filter(s=>!this.removedWeirdEdges.has(s)),...this.addedWeirdEdges]}modifyRegions(s,r,o,n){for(const l of r)this.addedRegions.has(l)?this.addedRegions.delete(l):this.removedRegions.add(l);for(const l of s)this.addedRegions.add(l);for(const l of n)this.addedWeirdEdges.has(l)?this.addedWeirdEdges.delete(l):this.removedWeirdEdges.add(l);for(const l of o)this.addedWeirdEdges.add(l);this.simpleRegionsChangedEmitter.emit(s,r,o,n)}clone(){return new GeneralSimpleRegionDelta(this.board,this.parentState,new Set(this.addedRegions),new Set(this.removedRegions),new Set(this.addedWeirdEdges),new Set(this.removedWeirdEdges))}createDelta(){return new GeneralSimpleRegionDelta(this.board,this)}serializeState(s){return serializeSimpleRegionData(this)}}class GeneralSimpleRegionData{constructor(t,s,r){gt(this,"simpleRegionsChangedEmitter",new TinyEmitter);gt(this,"simpleRegions");gt(this,"weirdEdges");this.board=t,this.simpleRegions=new Set(s),this.weirdEdges=new Set(r)}getSimpleRegions(){return[...this.simpleRegions]}getSimpleRegionWithVertex(t){for(const s of this.simpleRegions)if(s.a===t||s.b===t)return s;return null}getSimpleRegionWithEdge(t){for(const s of this.simpleRegions)if(s.edges.includes(t))return s;return null}getSimpleRegionWithId(t){for(const s of this.simpleRegions)if(s.id===t)return s;return null}getWeirdEdges(){return[...this.weirdEdges]}modifyRegions(t,s,r,o){for(const n of s)this.simpleRegions.delete(n);for(const n of t)this.simpleRegions.add(n);for(const n of o)this.weirdEdges.delete(n);for(const n of r)this.weirdEdges.add(n);this.simpleRegionsChangedEmitter.emit(t,s,r,o)}clone(){return new GeneralSimpleRegionData(this.board,this.simpleRegions,this.weirdEdges)}createDelta(){return new GeneralSimpleRegionDelta(this.board,this)}serializeState(t){return serializeSimpleRegionData(this)}static deserializeState(t,s){return new GeneralSimpleRegionData(t,s.simpleRegions.map(r=>GeneralSimpleRegion.deserializeSimpleRegion(t,r)),s.weirdEdges.map(r=>deserializeEdge(t,r)))}}const fo=class fo extends EnumerationValue{};gt(fo,"OUTSIDE",new fo),gt(fo,"INSIDE",new fo),gt(fo,"UNDECIDED",new fo),gt(fo,"enumeration",new Enumeration(fo));let FaceColorState=fo;const serializeFaceColor=(a,t,s)=>({id:a.id,colorState:a.colorState.toString(),faces:t.map(serializeFace),oppositeFaceColorId:s}),serializeFaceColorData=a=>({type:"FaceColorData",colors:a.getFaceColors().map(t=>{var s;return serializeFaceColor(t,a.getFacesWithColor(t),((s=a.getOppositeFaceColor(t))==null?void 0:s.id)??null)}),invalidFaceColor:a.hasInvalidFaceColors()}),As=class As extends EnumerationValue{constructor(t,s,r,o){super(),this.zero=t,this.one=s,this.two=r,this.serializedValue=o}allows(t){return assertEnabled()&&assert$2(t===0||t===1||t===2),t===0&&this.zero||t===1&&this.one||t===2&&this.two}isSubsetOf(t){return(!this.zero||t.zero)&&(!this.one||t.one)&&(!this.two||t.two)}and(t){return As.getWithValue(this.zero&&t.zero,this.one&&t.one,this.two&&t.two)}or(t){return As.getWithValue(this.zero||t.zero,this.one||t.one,this.two||t.two)}withZero(t){return As.getWithValue(t,this.one,this.two)}withOne(t){return As.getWithValue(this.zero,t,this.two)}withTwo(t){return As.getWithValue(this.zero,this.one,t)}with(t){return assertEnabled()&&assert$2(t===0||t===1||t===2),As.getWithValue(t===0?!0:this.zero,t===1?!0:this.one,t===2?!0:this.two)}withAllowZero(){return this.withZero(!0)}withAllowOne(){return this.withOne(!0)}withAllowTwo(){return this.withTwo(!0)}withDisallowZero(){return this.withZero(!1)}withDisallowOne(){return this.withOne(!1)}withDisallowTwo(){return this.withTwo(!1)}serialize(){return this.serializedValue}static getWithValue(t,s,r){return As.enumeration.values.find(o=>o.zero===t&&o.one===s&&o.two===r)}static getOnly(t){return assertEnabled()&&assert$2(t===0||t===1||t===2),As.getWithValue(t===0,t===1,t===2)}static getNot(t){return assertEnabled()&&assert$2(t===0||t===1||t===2),As.getWithValue(t!==0,t!==1,t!==2)}static deserialize(t){const s=sectorStateMap.get(t);return assertEnabled()&&assert$2(s,`invalid serialized value: ${t}`),s}};gt(As,"NONE",new As(!1,!1,!1,0)),gt(As,"ONLY_ZERO",new As(!0,!1,!1,1)),gt(As,"ONLY_ONE",new As(!1,!0,!1,2)),gt(As,"ONLY_TWO",new As(!1,!1,!0,3)),gt(As,"NOT_ZERO",new As(!1,!0,!0,4)),gt(As,"NOT_ONE",new As(!0,!1,!0,5)),gt(As,"NOT_TWO",new As(!0,!0,!1,6)),gt(As,"ANY",new As(!0,!0,!0,7)),gt(As,"enumeration",new Enumeration(As)),gt(As,"trivialStates",[As.NONE,As.ONLY_ZERO,As.ONLY_TWO,As.ANY]);let SectorState=As;const sectorStateMap=new Map(SectorState.enumeration.values.map(a=>[a.serializedValue,a])),serializeSectorStateData=(a,t)=>({type:"SectorStateData",sectors:a.halfEdges.filter(s=>t.getSectorState(s)!==SectorState.ANY).map(s=>({sector:serializeHalfEdge(s),state:t.getSectorState(s).serialize()}))}),serializeVertex=a=>({x:a.logicalCoordinates.x,y:a.logicalCoordinates.y}),deserializeVertex=(a,t)=>{const s=a.vertices.find(r=>r.logicalCoordinates.x===t.x&&r.logicalCoordinates.y===t.y);return assertEnabled()&&assert$2(s),s},serializeVertexStateData=(a,t)=>({type:"VertexStateData",vertices:a.vertices.filter(s=>!t.getVertexState(s).isAny()).map(s=>({vertex:serializeVertex(s),state:t.getVertexState(s).serialize()}))}),serializeFaceStateData=(a,t)=>({type:"FaceStateData",faces:a.faces.map(s=>({face:serializeFace(s),state:t.getFaceState(s).serialize()}))}),serializeCompleteData=(a,t)=>({type:"CompleteData",faceValueData:serializeFaceValueData(a,t),edgeStateData:serializeEdgeStateData(a,t),simpleRegionData:serializeSimpleRegionData(t),faceColorData:serializeFaceColorData(t),sectorStateData:serializeSectorStateData(a,t),vertexStateData:serializeVertexStateData(a,t),faceStateData:serializeFaceStateData(a,t)});class CompleteDelta extends CompleteAction{constructor(s,r,o,n,l,h,g){super(s,r,o,n,l,h,g);gt(this,"anyStateChangedEmitter",new TinyEmitter);this.faceValueDelta=s,this.edgeStateDelta=r,this.simpleRegionDelta=o,this.faceColorDelta=n,this.sectorStateDelta=l,this.vertexStateDelta=h,this.faceStateDelta=g;const d=()=>this.anyStateChangedEmitter.emit();s.faceValueChangedEmitter.addListener(d),r.edgeStateChangedEmitter.addListener(d),o.simpleRegionsChangedEmitter.addListener(d),n.faceColorsChangedEmitter.addListener(d),l.sectorStateChangedEmitter.addListener(d),h.vertexStateChangedEmitter.addListener(d),g.faceStateChangedEmitter.addListener(d)}getFaceValue(s){return this.faceValueDelta.getFaceValue(s)}setFaceValue(s,r){this.faceValueDelta.setFaceValue(s,r)}get faceValueChangedEmitter(){return this.faceValueDelta.faceValueChangedEmitter}getEdgeState(s){return this.edgeStateDelta.getEdgeState(s)}setEdgeState(s,r){this.edgeStateDelta.setEdgeState(s,r)}get edgeStateChangedEmitter(){return this.edgeStateDelta.edgeStateChangedEmitter}getSimpleRegions(){return this.simpleRegionDelta.getSimpleRegions()}getSimpleRegionWithVertex(s){return this.simpleRegionDelta.getSimpleRegionWithVertex(s)}getSimpleRegionWithEdge(s){return this.simpleRegionDelta.getSimpleRegionWithEdge(s)}getSimpleRegionWithId(s){return this.simpleRegionDelta.getSimpleRegionWithId(s)}getWeirdEdges(){return this.simpleRegionDelta.getWeirdEdges()}modifyRegions(s,r,o,n){this.simpleRegionDelta.modifyRegions(s,r,o,n)}get simpleRegionsChangedEmitter(){return this.simpleRegionDelta.simpleRegionsChangedEmitter}getFaceColors(){return this.faceColorDelta.getFaceColors()}getInsideColor(){return this.faceColorDelta.getInsideColor()}getOutsideColor(){return this.faceColorDelta.getOutsideColor()}getFaceColor(s){return this.faceColorDelta.getFaceColor(s)}getFacesWithColor(s){return this.faceColorDelta.getFacesWithColor(s)}getFaceColorMap(){return this.faceColorDelta.getFaceColorMap()}getOppositeFaceColor(s){return this.faceColorDelta.getOppositeFaceColor(s)}hasInvalidFaceColors(){return this.faceColorDelta.hasInvalidFaceColors()}modifyFaceColors(s,r,o,n,l){this.faceColorDelta.modifyFaceColors(s,r,o,n,l)}get faceColorsChangedEmitter(){return this.faceColorDelta.faceColorsChangedEmitter}getSectorState(s){return this.sectorStateDelta.getSectorState(s)}setSectorState(s,r){this.sectorStateDelta.setSectorState(s,r)}get sectorStateChangedEmitter(){return this.sectorStateDelta.sectorStateChangedEmitter}getVertexState(s){return this.vertexStateDelta.getVertexState(s)}setVertexState(s,r){this.vertexStateDelta.setVertexState(s,r)}get vertexStateChangedEmitter(){return this.vertexStateDelta.vertexStateChangedEmitter}getFaceState(s){return this.faceStateDelta.getFaceState(s)}setFaceState(s,r){this.faceStateDelta.setFaceState(s,r)}get faceStateChangedEmitter(){return this.faceStateDelta.faceStateChangedEmitter}clone(){return new CompleteDelta(this.faceValueDelta.clone(),this.edgeStateDelta.clone(),this.simpleRegionDelta.clone(),this.faceColorDelta.clone(),this.sectorStateDelta.clone(),this.vertexStateDelta.clone(),this.faceStateDelta.clone())}createDelta(){return new CompleteDelta(this.faceValueDelta.createDelta(),this.edgeStateDelta.createDelta(),this.simpleRegionDelta.createDelta(),this.faceColorDelta.createDelta(),this.sectorStateDelta.createDelta(),this.vertexStateDelta.createDelta(),this.faceStateDelta.createDelta())}serializeState(s){return serializeCompleteData(s,this)}}class GeneralFaceColorAction{constructor(t,s,r,o,n,l){this.board=t,this.addedFaceColors=s,this.removedFaceColors=r,this.faceChangeMap=o,this.oppositeChangeMap=n,this.invalidFaceColor=l,assertEnabled()&&assert$2(r.size<=o.size)}apply(t){t.modifyFaceColors(this.addedFaceColors,this.removedFaceColors,this.faceChangeMap,this.oppositeChangeMap,this.invalidFaceColor)}getUndo(t){throw new Error("getUndo unimplemented in GeneralFaceColorAction")}isEmpty(){return this.addedFaceColors.size===0&&this.removedFaceColors.size===0&&this.faceChangeMap.size===0&&this.oppositeChangeMap.size===0}serializeAction(){throw new Error("serializeAction unimplemented in GeneralFaceColorAction")}static deserializeAction(t,s){throw new Error("deserializeAction unimplemented in GeneralFaceColorAction")}}class GeneralFaceColorDelta extends GeneralFaceColorAction{constructor(s,r,o=new Set,n=new Set,l=new Map,h=new Map,g=!1){super(s,o,n,l,h,g);gt(this,"faceColorsChangedEmitter",new TinyEmitter);this.parentState=r}getFaceColors(){return[...[...this.parentState.getFaceColors()].filter(s=>!this.removedFaceColors.has(s)),...this.addedFaceColors]}getInsideColor(){return this.parentState.getInsideColor()}getOutsideColor(){return this.parentState.getOutsideColor()}getFaceColor(s){return this.faceChangeMap.has(s)?this.faceChangeMap.get(s):this.parentState.getFaceColor(s)}getFacesWithColor(s){let r;this.addedFaceColors.has(s)?r=new Set:r=new Set(this.parentState.getFacesWithColor(s));for(const[o,n]of this.faceChangeMap.entries())n===s?r.add(o):r.has(o)&&r.delete(o);return[...r]}getFaceColorMap(){const s=new Map(this.parentState.getFaceColorMap());for(const[r,o]of this.faceChangeMap.entries())s.set(r,o);return s}getOppositeFaceColor(s){const r=this.oppositeChangeMap.get(s);return r!==void 0?r:this.parentState.getOppositeFaceColor(s)}hasInvalidFaceColors(){return this.invalidFaceColor||this.parentState.hasInvalidFaceColors()}modifyFaceColors(s,r,o,n,l){for(const d of s)this.addedFaceColors.add(d);for(const d of r)this.addedFaceColors.has(d)?this.addedFaceColors.delete(d):this.removedFaceColors.add(d);for(const[d,A]of o.entries())this.faceChangeMap.set(d,A);for(const[d,A]of n.entries())this.oppositeChangeMap.set(d,A);const h=new Set(r);for(const d of this.oppositeChangeMap.keys()){const A=this.oppositeChangeMap.get(d);A&&h.has(A)&&this.oppositeChangeMap.set(d,null)}const g=new Set(n.keys());this.invalidFaceColor=l,this.faceColorsChangedEmitter.emit(s,r,g,[...o.keys()])}clone(){return new GeneralFaceColorDelta(this.board,this.parentState,new Set(this.addedFaceColors),new Set(this.removedFaceColors),new Map(this.faceChangeMap),new Map(this.oppositeChangeMap),this.invalidFaceColor||this.parentState.hasInvalidFaceColors())}createDelta(){return new GeneralFaceColorDelta(this.board,this)}serializeState(s){return serializeFaceColorData(this)}}class GeneralFaceColor{constructor(t,s){this.id=t,this.colorState=s}}const getFaceColorGlobalId=()=>dotRandom.nextInt(Number.MAX_SAFE_INTEGER);class GeneralFaceColorData{constructor(t,s,r,o,n,l,h,g){gt(this,"faceColorsChangedEmitter",new TinyEmitter);gt(this,"faceColors");gt(this,"colorMap");gt(this,"colorInverseMap");gt(this,"oppositeColorMap");gt(this,"outsideColor");gt(this,"insideColor");gt(this,"invalidFaceColor");this.board=t,assertEnabled()&&assert$2(!s||h,"Provide all or none of the optional arguments"),this.outsideColor=l||new GeneralFaceColor(getFaceColorGlobalId(),FaceColorState.OUTSIDE),this.insideColor=h||new GeneralFaceColor(getFaceColorGlobalId(),FaceColorState.INSIDE),this.colorMap=new Map(r||[...t.faces].map(d=>[d,new GeneralFaceColor(getFaceColorGlobalId(),FaceColorState.UNDECIDED)])),this.faceColors=new Set(s||[this.outsideColor,this.insideColor,...t.faces.map(d=>this.colorMap.get(d))]),assertEnabled()&&assert$2(this.board.faces.every(d=>this.colorMap.has(d))),assertEnabled()&&assert$2(this.board.faces.every(d=>this.faceColors.has(this.colorMap.get(d)))),this.colorInverseMap=new Map(o?[...o.keys()].map(d=>[d,new Set([...o.get(d)])]):[...this.faceColors].map(d=>[d,new Set([...this.colorMap.keys()].filter(A=>this.colorMap.get(A)===d))])),this.oppositeColorMap=new Map(n||[[this.outsideColor,this.insideColor],[this.insideColor,this.outsideColor]]),this.invalidFaceColor=!!g}getFaceColors(){return[...this.faceColors]}getInsideColor(){return this.insideColor}getOutsideColor(){return this.outsideColor}getFaceColor(t){const s=this.colorMap.get(t);return assertEnabled()&&assert$2(s),s}getFacesWithColor(t){assertEnabled()&&assert$2(this.faceColors.has(t));const s=this.colorInverseMap.get(t);return assertEnabled()&&assert$2(s),[...s]}getFaceColorMap(){return new Map(this.colorMap)}getOppositeFaceColor(t){return this.oppositeColorMap.get(t)??null}hasInvalidFaceColors(){return this.invalidFaceColor}modifyFaceColors(t,s,r,o,n){for(const g of t)this.faceColors.add(g),this.colorInverseMap.set(g,new Set);for(const[g,d]of r.entries()){const A=this.colorMap.get(g);assertEnabled()&&assert$2(A),this.colorMap.set(g,d),this.colorInverseMap.get(A).delete(g),this.colorInverseMap.get(d).add(g)}for(const[g,d]of o.entries())this.oppositeColorMap.set(g,d),this.oppositeColorMap.set(d,g);const l=new Set;for(const g of s)l.add(g),this.faceColors.delete(g),this.colorInverseMap.delete(g),this.oppositeColorMap.delete(g);for(const g of this.faceColors)this.oppositeColorMap.has(g)&&l.has(this.oppositeColorMap.get(g))&&this.oppositeColorMap.delete(g);const h=new Set(o.keys());if(this.invalidFaceColor=n,assertEnabled()&&assert$2(this.board.faces.every(g=>this.colorMap.has(g))),assertEnabled()&&assert$2(this.board.faces.every(g=>this.faceColors.has(this.colorMap.get(g)))),assertEnabled()){const g=new Set(this.getFaceColors());for(const d of g){const A=this.getOppositeFaceColor(d);A&&!g.has(A)&&assert$2(!1,`opposite color ${A} of color ${d} is not in the set of colors`)}}this.faceColorsChangedEmitter.emit(t,s,h,[...r.keys()])}clone(){return new GeneralFaceColorData(this.board,this.faceColors,this.colorMap,this.colorInverseMap,this.oppositeColorMap,this.outsideColor,this.insideColor,this.invalidFaceColor)}createDelta(){return new GeneralFaceColorDelta(this.board,this)}serializeState(t){return serializeFaceColorData(this)}static deserializeState(t,s){const r=s.colors.map(d=>{const A=d.id,S=FaceColorState.enumeration.getValue(d.colorState);return assertEnabled()&&assert$2(S),new GeneralFaceColor(A,S)}),o=new Map,n=new Map,l=new Map;r.forEach((d,A)=>{const S=s.colors[A].faces.map(I=>deserializeFace(t,I));S.forEach(I=>o.set(I,d)),n.set(d,new Set(S));const O=s.colors[A].oppositeFaceColorId;if(O!==null){const I=r.find(W=>W.id===O);assertEnabled()&&assert$2(I),l.set(d,I)}});const h=r.find(d=>d.colorState===FaceColorState.OUTSIDE);assertEnabled()&&assert$2(h);const g=r.find(d=>d.colorState===FaceColorState.INSIDE);return assertEnabled()&&assert$2(g),new GeneralFaceColorData(t,new Set(r),o,n,l,h,g,s.invalidFaceColor)}}class GeneralSectorStateAction{constructor(t,s=new Map){this.board=t,this.sectorStateMap=s}apply(t){for(const[s,r]of this.sectorStateMap)t.setSectorState(s,r)}getUndo(t){const s=new Map;for(const r of this.sectorStateMap.keys())s.set(r,t.getSectorState(r));return new GeneralSectorStateAction(this.board,s)}isEmpty(){return this.sectorStateMap.size===0}serializeAction(){return{type:"GeneralSectorAction",sectors:Array.from(this.sectorStateMap.entries()).map(([t,s])=>({sector:serializeHalfEdge(t),state:s.serialize()}))}}static deserializeAction(t,s){return new GeneralSectorStateAction(t,new Map(s.sectors.map(r=>[deserializeHalfEdge(t,r.sector),SectorState.deserialize(r.state)])))}}class GeneralSectorStateDelta extends GeneralSectorStateAction{constructor(s,r,o=new Map){super(s,o);gt(this,"sectorStateChangedEmitter",new TinyEmitter);this.parentState=r}getSectorState(s){return this.sectorStateMap.has(s)?this.sectorStateMap.get(s):this.parentState.getSectorState(s)}setSectorState(s,r){const o=this.getSectorState(s);o!==r&&(this.sectorStateMap.set(s,r),this.sectorStateChangedEmitter.emit(s,r,o))}clone(){return new GeneralSectorStateDelta(this.board,this.parentState,new Map(this.sectorStateMap))}createDelta(){return new GeneralSectorStateDelta(this.board,this,new Map)}serializeState(s){return serializeSectorStateData(s,this)}}class GeneralSectorStateData{constructor(t,s=()=>SectorState.ANY){gt(this,"sectorStateChangedEmitter",new TinyEmitter);gt(this,"sectorStateMap",new Map);this.board=t,t.halfEdges.forEach(r=>{this.sectorStateMap.set(r,s(r))})}getSectorState(t){return assertEnabled()&&assert$2(this.sectorStateMap.has(t)),this.sectorStateMap.get(t)}setSectorState(t,s){assertEnabled()&&assert$2(this.sectorStateMap.has(t));const r=this.sectorStateMap.get(t);r!==s&&(this.sectorStateMap.set(t,s),this.sectorStateChangedEmitter.emit(t,s,r))}clone(){return new GeneralSectorStateData(this.board,t=>this.getSectorState(t))}createDelta(){return new GeneralSectorStateDelta(this.board,this)}serializeState(t){return serializeSectorStateData(t,this)}static deserializeState(t,s){const r=new Map(s.sectors.map(o=>[deserializeHalfEdge(t,o.sector),SectorState.deserialize(o.state)]));return new GeneralSectorStateData(t,o=>r.get(o)??SectorState.ANY)}}const getSectorsFromVertex=a=>a.incomingHalfEdges,getFaceOrderedSectorsFromVertex=a=>{let t=getSectorsFromVertex(a);return t=[...t.slice(1),t[0]],assertEnabled()&&assert$2(t[0].edge===a.edges[1]&&t[0].next.edge===a.edges[0]),t},packBooleanArray=a=>{const t=new Uint8Array(Math.ceil(a.length/8));for(let r=0;r<a.length;r++)a[r]&&(t[Math.floor(r/8)]|=1<<7-r%8);const s=btoa(String.fromCharCode(...t));if(assertEnabled()){const r=unpackBooleanArray(s,a.length);assert$2(a.length===r.length&&a.every((o,n)=>o===r[n]))}return s},unpackBooleanArray=(a,t)=>{const s=Uint8Array.from(atob(a),o=>o.charCodeAt(0)),r=[];for(let o=0;o<s.length*8;o++)r.push((s[Math.floor(o/8)]&1<<7-o%8)!==0);return r.slice(0,t)};class VertexState{constructor(t,s,r){gt(this,"order");gt(this,"possibilityCount");gt(this,"matrix");this.vertex=t,this.order=t.edges.length,s?this.matrix=s:this.matrix=_$1.range(0,VertexState.getMatrixSize(this.order)).map(()=>!0),r!==void 0?this.possibilityCount=r:this.possibilityCount=this.matrix.filter(o=>o).length,assertEnabled()&&assert$2(this.matrix.length===VertexState.getMatrixSize(this.order)),assertEnabled()&&assert$2(this.possibilityCount===this.matrix.filter(o=>o).length)}isAny(){return this.possibilityCount===VertexState.getMatrixSize(this.order)}isForced(){return this.possibilityCount===1}allowsEmpty(){return this.matrix[VertexState.getMatrixSize(this.order)-1]}allowsPair(t,s){return this.matrix[this.getPairIndex(t,s)]}getBinaryCombinationsAllowed(t,s){let r=this.allowsEmpty(),o=!1,n=!1,l=!1;for(const h of this.getAllowedPairs()){const g=h[0]===t||h[1]===t,d=h[0]===s||h[1]===s;g&&d?o=!0:g?n=!0:d?l=!0:r=!0}return{allowsNone:r,allowsBoth:o,allowsAOnly:n,allowsBOnly:l}}getAllowedPairs(){const t=[];let s=0;for(let r=0;r<this.order;r++)for(let o=r+1;o<this.order;o++)this.matrix[s++]&&t.push([this.vertex.edges[r],this.vertex.edges[o]]);return t}getFinalStatesOfEdge(t){const s=new Set;for(const r of this.getAllowedPairs())r[0]===t||r[1]===t?s.add(EdgeState.BLACK):s.add(EdgeState.RED);return this.allowsEmpty()&&s.add(EdgeState.RED),s}getPairIndex(t,s){const r=this.vertex.edges.indexOf(t),o=this.vertex.edges.indexOf(s),n=Math.min(r,o),l=Math.max(r,o);return VertexState.getIndex(n,l,this.order)}equals(t){return this.vertex===t.vertex&&this.matrix.every((s,r)=>s===t.matrix[r])}and(t){return assertEnabled()&&assert$2(this.vertex===t.vertex),new VertexState(this.vertex,this.matrix.map((s,r)=>s&&t.matrix[r]))}or(t){return assertEnabled()&&assert$2(this.vertex===t.vertex),new VertexState(this.vertex,this.matrix.map((s,r)=>s||t.matrix[r]))}isSubsetOf(t){return this.matrix.every((s,r)=>!s||t.matrix[r])}withEmpty(t){return new VertexState(this.vertex,this.matrix.slice(0,-1).concat(t))}withPair(t,s,r){const o=this.getPairIndex(t,s);return new VertexState(this.vertex,this.matrix.slice(0,o).concat(r,this.matrix.slice(o+1)))}serialize(){const t=packBooleanArray(this.matrix);return assertEnabled()&&assert$2(this.equals(VertexState.deserialize(this.vertex,t))),t}static getIndex(t,s,r){return t*(2*r-t-1)/2+(s-t-1)}static getMatrixSize(t){return t*(t-1)/2+1}static fromLookup(t,s,r){const o=t.edges.length,n=[];for(let l=0;l<o;l++)for(let h=l+1;h<o;h++)n.push(s(t.edges[l],t.edges[h]));return n.push(r),new VertexState(t,n)}static none(t){return VertexState.fromLookup(t,()=>!1,!1)}static any(t){return VertexState.fromLookup(t,()=>!0,!0)}static withOnlyEmpty(t){return VertexState.fromLookup(t,()=>!1,!0)}static withOnlyPair(t,s,r){return VertexState.fromLookup(t,(o,n)=>o===s&&n===r||o===r&&n===s,!1)}static withoutEmpty(t){return VertexState.fromLookup(t,()=>!0,!1)}static withoutPair(t,s,r){return VertexState.fromLookup(t,(o,n)=>o!==s&&o!==r||n!==s&&n!==r,!0)}static fromEdgeColorSectorData(t,s){const r=t.edges.length,o=[],n=t.edges.filter(L=>s.getEdgeState(L)===EdgeState.BLACK);if(n.length>2)return VertexState.none(t);if(n.length===2)return VertexState.withOnlyPair(t,n[0],n[1]);const l=n.length?n[0]:null,h=new Set(t.edges.filter(L=>s.getEdgeState(L)===EdgeState.RED));if(h.size===r)return VertexState.withOnlyEmpty(t);const g=getFaceOrderedSectorsFromVertex(t),d=g.map(L=>s.getSectorState(L)),A=d.every(L=>L.zero),S=g.map(L=>L.face?s.getFaceColor(L.face):s.getOutsideColor()),O=new Set(S),I=new Map([...O].map(L=>[L,s.getOppositeFaceColor(L)])),W=[...I.values()].every(L=>!L||!O.has(L));for(let L=0;L<r;L++){const H=t.edges[L];if(h.has(H)){for(let Y=L+1;Y<r;Y++)o.push(!1);continue}for(let Y=L+1;Y<r;Y++){let Q=!0;const pe=t.edges[Y];if(Q&&h.has(pe)&&(Q=!1),Q&&l&&H!==l&&pe!==l&&(Q=!1),Q&&(Q=Q&&d.every((de,fe)=>{const ye=g[fe];let Ee=0;return(H===ye.edge||H===ye.next.edge)&&Ee++,(pe===ye.edge||pe===ye.next.edge)&&Ee++,de.allows(Ee)})),Q){const de=S.slice(L,Y),fe=[...S.slice(Y),...S.slice(0,L)];de.some(ye=>fe.includes(ye))&&(Q=!1),Q&&de.some(ye=>{const Ee=I.get(ye);return Ee&&de.includes(Ee)})&&(Q=!1),Q&&fe.some(ye=>{const Ee=I.get(ye);return Ee&&fe.includes(Ee)})&&(Q=!1)}o.push(Q)}}return o.push(n.length===0&&A&&W),new VertexState(t,o)}static deserialize(t,s){return new VertexState(t,unpackBooleanArray(s,VertexState.getMatrixSize(t.edges.length)))}}class GeneralVertexStateAction{constructor(t,s=new Map){this.board=t,this.vertexStateMap=s}apply(t){for(const[s,r]of this.vertexStateMap)t.setVertexState(s,r)}getUndo(t){const s=new Map;for(const r of this.vertexStateMap.keys())s.set(r,t.getVertexState(r));return new GeneralVertexStateAction(this.board,s)}isEmpty(){return this.vertexStateMap.size===0}serializeAction(){return{type:"GeneralVertexAction",vertices:Array.from(this.vertexStateMap.entries()).map(([t,s])=>({vertex:serializeVertex(t),state:s.serialize()}))}}static deserializeAction(t,s){return new GeneralVertexStateAction(t,new Map(s.vertices.map(r=>[deserializeVertex(t,r.vertex),VertexState.deserialize(deserializeVertex(t,r.vertex),r.state)])))}}class GeneralVertexStateDelta extends GeneralVertexStateAction{constructor(s,r,o=new Map){super(s,o);gt(this,"vertexStateChangedEmitter",new TinyEmitter);this.parentState=r}getVertexState(s){return this.vertexStateMap.has(s)?this.vertexStateMap.get(s):this.parentState.getVertexState(s)}setVertexState(s,r){const o=this.getVertexState(s);o.equals(r)||(this.vertexStateMap.set(s,r),this.vertexStateChangedEmitter.emit(s,r,o))}clone(){return new GeneralVertexStateDelta(this.board,this.parentState,new Map(this.vertexStateMap))}createDelta(){return new GeneralVertexStateDelta(this.board,this,new Map)}serializeState(s){return serializeVertexStateData(s,this)}}class GeneralVertexStateData{constructor(t,s=VertexState.any){gt(this,"vertexStateChangedEmitter",new TinyEmitter);gt(this,"vertexStateMap",new Map);this.board=t,t.vertices.forEach(r=>{this.vertexStateMap.set(r,s(r))})}getVertexState(t){return assertEnabled()&&assert$2(this.vertexStateMap.has(t)),this.vertexStateMap.get(t)}setVertexState(t,s){assertEnabled()&&assert$2(this.vertexStateMap.has(t));const r=this.vertexStateMap.get(t);r.equals(s)||(this.vertexStateMap.set(t,s),this.vertexStateChangedEmitter.emit(t,s,r))}clone(){return new GeneralVertexStateData(this.board,t=>this.getVertexState(t))}createDelta(){return new GeneralVertexStateDelta(this.board,this)}serializeState(t){return serializeVertexStateData(t,this)}static deserializeState(t,s){const r=new Map(s.vertices.map(o=>{const n=deserializeVertex(t,o.vertex);return[n,VertexState.deserialize(n,o.state)]}));return new GeneralVertexStateData(t,o=>r.get(o)??VertexState.any(o))}}const lazyFactorials=[],getLazyFactorials=a=>{for(;lazyFactorials.length<=a;)lazyFactorials.push(lazyFactorials.length===0?1:lazyFactorials[lazyFactorials.length-1]*lazyFactorials.length);return lazyFactorials},getBinomialCoefficient=(a,t,s)=>s[a]/(s[t]*s[a-t]),getCombinationIndex=(a,t)=>{a=_$1.sortBy(a);const s=getLazyFactorials(t);let r=0;const o=a.length;for(let n=0;n<o;n++){const l=a[n-1]+1,h=a[n];for(let g=n==0?0:l;g<h;g++)r+=getBinomialCoefficient(t-g-1,o-n-1,s)}return r},getCombinationQuantity=(a,t)=>getBinomialCoefficient(a,t,getLazyFactorials(a)),getBinaryIndex=(a,t)=>{let s=0;for(let r=0;r<a.length;r++)s+=1<<t-a[r]-1;return s},getBinaryQuantity=a=>1<<a;class FaceState{constructor(t,s,r,o){gt(this,"order");gt(this,"possibilityCount");gt(this,"matrix");this.face=t,this.faceValue=s,this.order=t.edges.length,r?this.matrix=r:this.matrix=_$1.range(0,FaceState.getMatrixSize(this.order,this.faceValue)).map(()=>!0),o!==void 0?this.possibilityCount=o:this.possibilityCount=this.matrix.filter(n=>n).length,assertEnabled()&&assert$2(this.matrix.length===FaceState.getMatrixSize(this.order,this.faceValue)),assertEnabled()&&assert$2(this.possibilityCount===this.matrix.filter(n=>n).length)}isAny(){return this.possibilityCount===FaceState.getMatrixSize(this.order,this.faceValue)}isForced(){return this.possibilityCount===1}allowsEmpty(){return this.allowsBlackEdges([])}allowsBlackEdges(t){return this.matrix[this.getBlackEdgesIndex(t)]}getAllowedCombinations(){const t=[];return FaceState.forEachEdgeCombination(this.face.edges,this.faceValue,(s,r)=>{this.matrix[this.getIndexFromIndices(s)]&&t.push(r.slice())}),assertEnabled()&&assert$2(t.length===this.possibilityCount),t}getFinalStatesOfEdge(t){const s=new Set;for(const r of this.getAllowedCombinations())r.includes(t)?s.add(EdgeState.BLACK):s.add(EdgeState.RED);return this.allowsEmpty()&&s.add(EdgeState.RED),s}getBlackEdgesIndex(t){const s=t.map(r=>this.face.edges.indexOf(r));return assertEnabled()&&assert$2(s.every(r=>r>=0)),this.getIndexFromIndices(s)}getIndexFromIndices(t){return this.faceValue===null?getBinaryIndex(t,this.order):getCombinationIndex(t,this.order)}equals(t){return this.face===t.face&&this.matrix.every((s,r)=>s===t.matrix[r])}and(t){return assertEnabled()&&assert$2(this.face===t.face),new FaceState(this.face,this.faceValue,this.matrix.map((s,r)=>s&&t.matrix[r]))}or(t){return assertEnabled()&&assert$2(this.face===t.face),new FaceState(this.face,this.faceValue,this.matrix.map((s,r)=>s||t.matrix[r]))}isSubsetOf(t){return this.matrix.every((s,r)=>!s||t.matrix[r])}withBlackEdges(t,s){const r=this.getBlackEdgesIndex(t);return new FaceState(this.face,this.faceValue,this.matrix.slice(0,r).concat(s,this.matrix.slice(r+1)))}serialize(){if(this.isAny())return{faceValue:this.faceValue,matrix:"",isAny:!0};const t={faceValue:this.faceValue,matrix:packBooleanArray(this.matrix),isAny:!1};return assertEnabled()&&assert$2(this.equals(FaceState.deserialize(this.face,t))),t}static getMatrixSize(t,s){return s===null?getBinaryQuantity(t):getCombinationQuantity(t,s)}static forEachIndexCombination(t,s,r){let o=[];const n=()=>{if(s!==null){if(o.length===s){r(o);return}}else r(o);const l=o.length>0?o[o.length-1]+1:0;for(let h=l;h<t;h++)o.push(h),n(),o.pop()};n()}static forEachEdgeCombination(t,s,r){let o=[],n=[];const l=()=>{if(s!==null){if(o.length===s){r(o,n);return}}else r(o,n);const h=o.length>0?o[o.length-1]+1:0;for(let g=h;g<t.length;g++)o.push(g),n.push(t[g]),l(),o.pop(),n.pop()};l()}static fromLookup(t,s,r){const o=t.edges.length,n=new Array(FaceState.getMatrixSize(o,s)).fill(!1);return FaceState.forEachEdgeCombination(t.edges,s,(l,h)=>{if(r(h)){const d=s===null?getBinaryIndex(l,o):getCombinationIndex(l,o);n[d]=!0}}),new FaceState(t,s,n)}static none(t,s){const r=FaceState.getMatrixSize(t.edges.length,s),o=new Array(r).fill(!1);return new FaceState(t,s,o,0)}static any(t,s){const r=FaceState.getMatrixSize(t.edges.length,s),o=new Array(r).fill(!0);return new FaceState(t,s,o,r)}static withOnlyBlackEdges(t,s,r){const o=FaceState.getMatrixSize(t.edges.length,s),n=new Array(o).fill(!1),l=r.map(g=>t.edges.indexOf(g)),h=s===null?getBinaryIndex(l,t.edges.length):getCombinationIndex(l,t.edges.length);return n[h]=!0,new FaceState(t,s,n,1)}static withoutBlackEdges(t,s,r){const o=FaceState.getMatrixSize(t.edges.length,s),n=new Array(o).fill(!0),l=r.map(g=>t.edges.indexOf(g)),h=s===null?getBinaryIndex(l,t.edges.length):getCombinationIndex(l,t.edges.length);return n[h]=!1,new FaceState(t,s,n,o-1)}static fromVertexAndColorData(t,s,r){const n=t.vertices.map(A=>r.getVertexState(A)).map(A=>{const S=A.vertex.edges.filter(O=>O.faces.includes(t));return assertEnabled()&&assert$2(S.length===2),{edgeA:S[0],edgeB:S[1],...A.getBinaryCombinationsAllowed(S[0],S[1])}}),l=new Map(t.edges.map(A=>{const S=A.getOtherFace(t);return[A,S?r.getFaceColor(S):r.getOutsideColor()]})),h=r.getFaceColor(t),g=new Set([...l.values(),h]),d=new Map([...g].map(A=>[A,r.getOppositeFaceColor(A)]));return FaceState.fromLookup(t,r.getFaceValue(t),A=>{const S=new Set(A);for(const W of n){const L=S.has(W.edgeA),H=S.has(W.edgeB);if(L&&H&&!W.allowsBoth||L&&!H&&!W.allowsAOnly||!L&&H&&!W.allowsBOnly||!L&&!H&&!W.allowsNone)return!1}const O=new Set([h]),I=new Set;for(const W of t.edges){const L=l.get(W);assertEnabled()&&assert$2(L),S.has(W)?I.add(L):O.add(L)}for(const W of O){if(I.has(W))return!1;const L=d.get(W);if(L&&O.has(L))return!1}for(const W of I){const L=d.get(W);if(L&&I.has(L))return!1}if(S.size===t.edges.length){for(const W of s.faces)if(r.getFaceValue(W)!==null){for(const L of W.edges)if(!S.has(L))return!1}}return!0})}static deserialize(t,s){return s.isAny?FaceState.any(t,s.faceValue):new FaceState(t,s.faceValue,unpackBooleanArray(s.matrix,FaceState.getMatrixSize(t.edges.length,s.faceValue)))}}class GeneralFaceStateAction{constructor(t,s=new Map){this.board=t,this.faceStateMap=s}apply(t){for(const[s,r]of this.faceStateMap)t.setFaceState(s,r)}getUndo(t){const s=new Map;for(const r of this.faceStateMap.keys())s.set(r,t.getFaceState(r));return new GeneralFaceStateAction(this.board,s)}isEmpty(){return this.faceStateMap.size===0}serializeAction(){return{type:"GeneralFaceAction",faces:Array.from(this.faceStateMap.entries()).map(([t,s])=>({face:serializeFace(t),state:s.serialize()}))}}static deserializeAction(t,s){return new GeneralFaceStateAction(t,new Map(s.faces.map(r=>[deserializeFace(t,r.face),FaceState.deserialize(deserializeFace(t,r.face),r.state)])))}}class GeneralFaceStateDelta extends GeneralFaceStateAction{constructor(s,r,o=new Map){super(s,o);gt(this,"faceStateChangedEmitter",new TinyEmitter);this.parentState=r}getFaceState(s){return this.faceStateMap.has(s)?this.faceStateMap.get(s):this.parentState.getFaceState(s)}setFaceState(s,r){const o=this.getFaceState(s);o.equals(r)||(this.faceStateMap.set(s,r),this.faceStateChangedEmitter.emit(s,r,o))}clone(){return new GeneralFaceStateDelta(this.board,this.parentState,new Map(this.faceStateMap))}createDelta(){return new GeneralFaceStateDelta(this.board,this,new Map)}serializeState(s){return serializeFaceStateData(s,this)}}class GeneralFaceStateData{constructor(t,s){gt(this,"faceStateChangedEmitter",new TinyEmitter);gt(this,"faceStateMap",new Map);this.board=t,t.faces.forEach(r=>{this.faceStateMap.set(r,s(r))})}getFaceState(t){return assertEnabled()&&assert$2(this.faceStateMap.has(t)),this.faceStateMap.get(t)}setFaceState(t,s){assertEnabled()&&assert$2(this.faceStateMap.has(t));const r=this.faceStateMap.get(t);r.equals(s)||(this.faceStateMap.set(t,s),this.faceStateChangedEmitter.emit(t,s,r))}clone(){return new GeneralFaceStateData(this.board,t=>this.getFaceState(t))}createDelta(){return new GeneralFaceStateDelta(this.board,this)}serializeState(t){return serializeFaceStateData(t,this)}static deserializeState(t,s){const r=new Map(s.faces.map(o=>{const n=deserializeFace(t,o.face);return[n,FaceState.deserialize(n,o.state)]}));return new GeneralFaceStateData(t,o=>{const n=r.get(o);return assertEnabled()&&assert$2(n),n})}}class CompleteData{constructor(t,s,r,o,n,l,h){gt(this,"anyStateChangedEmitter",new TinyEmitter);this.faceValueData=t,this.edgeStateData=s,this.simpleRegionData=r,this.faceColorData=o,this.sectorStateData=n,this.vertexStateData=l,this.faceStateData=h;const g=()=>this.anyStateChangedEmitter.emit();t.faceValueChangedEmitter.addListener(g),s.edgeStateChangedEmitter.addListener(g),r.simpleRegionsChangedEmitter.addListener(g),o.faceColorsChangedEmitter.addListener(g),n.sectorStateChangedEmitter.addListener(g),l.vertexStateChangedEmitter.addListener(g),h.faceStateChangedEmitter.addListener(g)}static fromFacesEdges(t,s,r){const o=new GeneralFaceValueData(t,s);return new CompleteData(o,new GeneralEdgeStateData(t,r),new GeneralSimpleRegionData(t),new GeneralFaceColorData(t),new GeneralSectorStateData(t),new GeneralVertexStateData(t),new GeneralFaceStateData(t,n=>FaceState.any(n,o.getFaceValue(n))))}static fromFaces(t,s){return CompleteData.fromFacesEdges(t,s,()=>EdgeState.WHITE)}static fromFaceValueData(t,s){return CompleteData.fromFaces(t,r=>s.getFaceValue(r))}static empty(t){return CompleteData.fromFaces(t,()=>null)}static faceMapLookup(t){const s=new Map(Array.from(t.entries()).map(([r,o])=>[`${r.x},${r.y}`,o]));return r=>{const o=s.get(`${r.logicalCoordinates.x},${r.logicalCoordinates.y}`);return o!==void 0?o:null}}getFaceValue(t){return this.faceValueData.getFaceValue(t)}setFaceValue(t,s){this.faceValueData.setFaceValue(t,s)}get faceValueChangedEmitter(){return this.faceValueData.faceValueChangedEmitter}getEdgeState(t){return this.edgeStateData.getEdgeState(t)}setEdgeState(t,s){this.edgeStateData.setEdgeState(t,s)}get edgeStateChangedEmitter(){return this.edgeStateData.edgeStateChangedEmitter}getSimpleRegions(){return this.simpleRegionData.getSimpleRegions()}getSimpleRegionWithVertex(t){return this.simpleRegionData.getSimpleRegionWithVertex(t)}getSimpleRegionWithEdge(t){return this.simpleRegionData.getSimpleRegionWithEdge(t)}getSimpleRegionWithId(t){return this.simpleRegionData.getSimpleRegionWithId(t)}getWeirdEdges(){return this.simpleRegionData.getWeirdEdges()}modifyRegions(t,s,r,o){this.simpleRegionData.modifyRegions(t,s,r,o)}get simpleRegionsChangedEmitter(){return this.simpleRegionData.simpleRegionsChangedEmitter}getFaceColors(){return this.faceColorData.getFaceColors()}getInsideColor(){return this.faceColorData.getInsideColor()}getOutsideColor(){return this.faceColorData.getOutsideColor()}getFaceColor(t){return this.faceColorData.getFaceColor(t)}getFacesWithColor(t){return this.faceColorData.getFacesWithColor(t)}getFaceColorMap(){return this.faceColorData.getFaceColorMap()}getOppositeFaceColor(t){return this.faceColorData.getOppositeFaceColor(t)}hasInvalidFaceColors(){return this.faceColorData.hasInvalidFaceColors()}modifyFaceColors(t,s,r,o,n){this.faceColorData.modifyFaceColors(t,s,r,o,n)}get faceColorsChangedEmitter(){return this.faceColorData.faceColorsChangedEmitter}getSectorState(t){return this.sectorStateData.getSectorState(t)}setSectorState(t,s){this.sectorStateData.setSectorState(t,s)}get sectorStateChangedEmitter(){return this.sectorStateData.sectorStateChangedEmitter}getVertexState(t){return this.vertexStateData.getVertexState(t)}setVertexState(t,s){this.vertexStateData.setVertexState(t,s)}get vertexStateChangedEmitter(){return this.vertexStateData.vertexStateChangedEmitter}getFaceState(t){return this.faceStateData.getFaceState(t)}setFaceState(t,s){this.faceStateData.setFaceState(t,s)}get faceStateChangedEmitter(){return this.faceStateData.faceStateChangedEmitter}clone(){return new CompleteData(this.faceValueData.clone(),this.edgeStateData.clone(),this.simpleRegionData.clone(),this.faceColorData.clone(),this.sectorStateData.clone(),this.vertexStateData.clone(),this.faceStateData.clone())}createDelta(){return new CompleteDelta(this.faceValueData.createDelta(),this.edgeStateData.createDelta(),this.simpleRegionData.createDelta(),this.faceColorData.createDelta(),this.sectorStateData.createDelta(),this.vertexStateData.createDelta(),this.faceStateData.createDelta())}serializeState(t){return serializeCompleteData(t,this)}static deserializeState(t,s){const r=GeneralFaceValueData.deserializeState(t,s.faceValueData);return new CompleteData(r,GeneralEdgeStateData.deserializeState(t,s.edgeStateData),s.simpleRegionData?GeneralSimpleRegionData.deserializeState(t,s.simpleRegionData):new GeneralSimpleRegionData(t),s.faceColorData?GeneralFaceColorData.deserializeState(t,s.faceColorData):new GeneralFaceColorData(t),s.sectorStateData?GeneralSectorStateData.deserializeState(t,s.sectorStateData):new GeneralSectorStateData(t),s.vertexStateData?GeneralVertexStateData.deserializeState(t,s.vertexStateData):new GeneralVertexStateData(t),s.faceStateData?GeneralFaceStateData.deserializeState(t,s.faceStateData):new GeneralFaceStateData(t,o=>FaceState.any(o,r.getFaceValue(o))))}}const deserializeState=(a,t)=>{const s=t.type;if(s==="CompleteData")return CompleteData.deserializeState(a,t);if(s==="FaceValueData")return GeneralFaceValueData.deserializeState(a,t);if(s==="EdgeData")return GeneralEdgeStateData.deserializeState(a,t);if(s==="SimpleRegionData")return GeneralSimpleRegionData.deserializeState(a,t);throw new Error(`Unknown action type: ${s}, could not deserialize`)};class BaseBoard{constructor(t){gt(this,"edges");gt(this,"vertices");gt(this,"faces");gt(this,"halfEdges");gt(this,"outerBoundary");gt(this,"innerBoundaries");this.boardDescriptor=t,this.edges=t.edges,this.vertices=t.vertices,this.faces=t.faces,this.halfEdges=t.halfEdges,this.outerBoundary=t.outerBoundary,this.innerBoundaries=t.innerBoundaries}}const validateBoard=a=>{assertEnabled()&&(a.edges.forEach(t=>{const s=t.forwardHalf,r=t.reversedHalf;assert$2(s.edge===t),assert$2(r.edge===t),assert$2(!s.isReversed),assert$2(r.isReversed),assert$2(s.reversed===r),assert$2(r.reversed===s),assert$2(s.start===t.start),assert$2(s.end===t.end),assert$2(r.start===t.end),assert$2(r.end===t.start),assert$2(s.next.previous===s),assert$2(s.previous.next===s),assert$2(r.next.previous===r),assert$2(r.previous.next===r),assert$2(s.next!==s),assert$2(s.previous!==s),assert$2(r.next!==r),assert$2(r.previous!==r),assert$2(s.next.face===s.face),assert$2(s.previous.face===s.face),assert$2(r.next.face===r.face),assert$2(r.previous.face===r.face),assert$2(s.face===t.forwardFace),assert$2(r.face===t.reversedFace)}),a.vertices.forEach(t=>{t.incomingHalfEdges.forEach(o=>{assert$2(o.end===t)}),t.outgoingHalfEdges.forEach(o=>{assert$2(o.start===t)});const s=o=>t.incomingHalfEdges[(o+t.incomingHalfEdges.length)%t.incomingHalfEdges.length],r=o=>t.outgoingHalfEdges[(o+t.outgoingHalfEdges.length)%t.outgoingHalfEdges.length];_$1.range(0,t.incomingHalfEdges.length).forEach(o=>{const n=s(o),l=r(o);assert$2(n.reversed===l),assert$2(n.next===r(o-1)),assert$2(l.previous===s(o+1))}),t.edges.forEach(o=>{assert$2(o.start===t||o.end===t),assert$2(t.incomingHalfEdges.includes(o.forwardHalf)||t.outgoingHalfEdges.includes(o.forwardHalf)),assert$2(t.incomingHalfEdges.includes(o.reversedHalf)||t.outgoingHalfEdges.includes(o.reversedHalf)),o.forwardFace&&(assert$2(o.forwardFace.vertices.includes(t)),assert$2(t.faces.includes(o.forwardFace))),o.reversedFace&&(assert$2(o.reversedFace.vertices.includes(t)),assert$2(t.faces.includes(o.reversedFace)))}),t.faces.forEach(o=>{assert$2(o.vertices.includes(t))})}))};class SquareBoard extends BaseBoard{constructor(s,r){const o=[],n=new Map,l=(g,d)=>{const A=`${g},${d}`;if(!n.has(A)){const S={logicalCoordinates:new Vector2(g,d),viewCoordinates:new Vector2(g,d)};o.push(S),n.set(A,S)}return n.get(A)},h=_$1.range(0,r).flatMap(g=>_$1.range(0,s).map(d=>({logicalCoordinates:new Vector2(d,g),vertices:[l(d,g),l(d+1,g),l(d+1,g+1),l(d,g+1)]})));super(createBoardDescriptor({vertices:o,faces:h}));gt(this,"isSquare",!0);this.width=s,this.height=r,assertEnabled()&&validateBoard(this)}}class HexagonalBoard extends BaseBoard{constructor(s,r,o,n=0){let l,h;o?(l=new Vector2(Math.sqrt(3),0).timesScalar(r),h=new Vector2(Math.sqrt(3)/2,3/2).timesScalar(r)):(l=new Vector2(3/2,Math.sqrt(3)/2).timesScalar(r),h=new Vector2(0,Math.sqrt(3)).timesScalar(r));const g=[new Vector2(1,0),new Vector2(1,-1),new Vector2(0,-1),new Vector2(-1,0),new Vector2(-1,1),new Vector2(0,1)],d=_$1.range(0,6).map(H=>g[H].plus(g[(H+1)%6])),A=H=>d.map(Y=>Y.plus(H.timesScalar(3))),S=(H,Y)=>(Math.abs(H.x-Y.x)+Math.abs(H.x+H.y-Y.x-Y.y)+Math.abs(H.y-Y.y))/2,O=[];for(let H=-s;H<=s;H++)for(let Y=Math.max(-s,-H-s);Y<=Math.min(s,-H+s);Y++){const Q=new Vector2(H,Y);S(Q,new Vector2(0,0))>=n&&O.push(Q)}const W=_$1.uniqWith(O.flatMap(A),(H,Y)=>H.equals(Y)).map(H=>({logicalCoordinates:H,viewCoordinates:l.timesScalar(H.x).plus(h.timesScalar(H.y)).timesScalar(1/3)})),L=O.map(H=>({logicalCoordinates:H,vertices:A(H).map(Y=>{const Q=W.find(pe=>pe.logicalCoordinates.equals(Y));return assertEnabled()&&assert$2(Q),Q})}));super(createBoardDescriptor(rescaleProtoDescriptorAverage({vertices:W,faces:L},r)));gt(this,"isHexagonal",!0);this.radius=s,this.scale=r,this.isPointyTop=o,this.holeRadius=n,assertEnabled()&&validateBoard(this)}static enumeratePointyFaceCoordinates(s){const r=[];for(let o=-s;o<=s;o++)for(let n=Math.max(-s,-o-s);n<=Math.min(s,-o+s);n++)r.push(new Vector2(n,o));return r}}const serializeBoard=a=>a instanceof SquareBoard?{type:"SquareBoard",width:a.width,height:a.height}:a instanceof HexagonalBoard?{type:"HexagonalBoard",radius:a.radius,scale:a.scale,isPointyTop:a.isPointyTop,holeRadius:a.holeRadius}:{type:"BaseBoard",vertices:a.vertices.map(t=>({x:t.logicalCoordinates.x,y:t.logicalCoordinates.y,vx:t.viewCoordinates.x,vy:t.viewCoordinates.y})),faces:a.faces.map(t=>({x:t.logicalCoordinates.x,y:t.logicalCoordinates.y,vertices:t.vertices.map(s=>a.vertices.indexOf(s))}))},deserializeBoard=a=>{if(a.type==="BaseBoard"){const t=a.vertices.map(r=>({logicalCoordinates:new Vector2(r.x,r.y),viewCoordinates:new Vector2(r.vx,r.vy)})),s=a.faces.map(r=>({logicalCoordinates:new Vector2(r.x,r.y),vertices:r.vertices.map(o=>t[o])}));return new BaseBoard(createBoardDescriptor({vertices:t,faces:s}))}else{if(a.type==="SquareBoard")return new SquareBoard(a.width,a.height);if(a.type==="HexagonalBoard")return new HexagonalBoard(a.radius,a.scale,a.isPointyTop,a.holeRadius);throw new Error("Unknown board")}};class BasicPuzzle{constructor(t,s){gt(this,"stateProperty");this.board=t,this.stateProperty=new TinyProperty(s)}static fromSolvedPuzzle(t){return new BasicPuzzle(t.board,t.cleanState)}static loadDefaultPuzzle(){return BasicPuzzle.loadFromSimpleString("10x18 .3.1....1..032....0......3.1....02.3...02....3.1...........2011.01..01.......3...2302..........1102...3.......22..03.0322...........3.2....13...2.30....2.2......1....103..2....1.3.")}static loadFromSimpleString(t){const[s,r]=t.split(" "),[o,n]=s.split("x").map(g=>parseInt(g)),l=new SquareBoard(o,n),h=CompleteData.fromFaces(l,g=>{const d=g.logicalCoordinates.y*o+g.logicalCoordinates.x,A=r[d];return A==="."?null:parseInt(A)});return new BasicPuzzle(l,h)}static loadDeprecatedScalaString(t){if(!t.includes("!"))return BasicPuzzle.loadFromSimpleString(t);const s=1,r=2,o=4,n=8,[l,h]=t.split(" "),[g,d]=l.split("x").map(W=>parseInt(W)),A=new SquareBoard(g,d),S=W=>3*(W.logicalCoordinates.y*g+W.logicalCoordinates.x)+1,O=(W,L)=>{const H=S(W),Y=parseInt(h[H+1]),Q=parseInt(h[H+2]);return Y&L?EdgeState.BLACK:Q&L?EdgeState.RED:EdgeState.WHITE},I=CompleteData.fromFacesEdges(A,W=>{const L=h[S(W)];return L==="."?null:parseInt(L)},W=>{if((W.start.logicalCoordinates.x===W.end.logicalCoordinates.x?Orientation.VERTICAL:Orientation.HORIZONTAL)===Orientation.HORIZONTAL){const H=W.start.logicalCoordinates.x<W.end.logicalCoordinates.x?W.forwardFace:W.reversedFace,Y=W.start.logicalCoordinates.x<W.end.logicalCoordinates.x?W.reversedFace:W.forwardFace;return H?O(H,r):O(Y,n)}else{const H=W.start.logicalCoordinates.y<W.end.logicalCoordinates.y?W.reversedFace:W.forwardFace,Y=W.start.logicalCoordinates.y<W.end.logicalCoordinates.y?W.forwardFace:W.reversedFace;return H?O(H,s):O(Y,o)}});return new BasicPuzzle(A,I)}static loadPointyTopHexagonalString(t){assertEnabled()&&assert$2(t.startsWith("h")||t.startsWith("H"));const[s,r]=t.slice(1).split(" "),o=parseInt(s),n=new HexagonalBoard(o,Math.sqrt(3)/2,t.startsWith("h")),l=HexagonalBoard.enumeratePointyFaceCoordinates(o),h=new Map;for(let d=0;d<r.length;d++){const A=r[d];if(A===".")continue;const S=l[d];h.set(S,parseInt(A))}const g=CompleteData.fromFaces(n,CompleteData.faceMapLookup(h));return new BasicPuzzle(n,g)}}/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const Z_FIXED$1=4,Z_BINARY=0,Z_TEXT=1,Z_UNKNOWN$1=2;function zero$1(a){let t=a.length;for(;--t>=0;)a[t]=0}const STORED_BLOCK=0,STATIC_TREES=1,DYN_TREES=2,MIN_MATCH$1=3,MAX_MATCH$1=258,LENGTH_CODES$1=29,LITERALS$1=256,L_CODES$1=LITERALS$1+1+LENGTH_CODES$1,D_CODES$1=30,BL_CODES$1=19,HEAP_SIZE$1=2*L_CODES$1+1,MAX_BITS$1=15,Buf_size=16,MAX_BL_BITS=7,END_BLOCK=256,REP_3_6=16,REPZ_3_10=17,REPZ_11_138=18,extra_lbits=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),extra_dbits=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),extra_blbits=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),bl_order=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),DIST_CODE_LEN=512,static_ltree=new Array((L_CODES$1+2)*2);zero$1(static_ltree);const static_dtree=new Array(D_CODES$1*2);zero$1(static_dtree);const _dist_code=new Array(DIST_CODE_LEN);zero$1(_dist_code);const _length_code=new Array(MAX_MATCH$1-MIN_MATCH$1+1);zero$1(_length_code);const base_length=new Array(LENGTH_CODES$1);zero$1(base_length);const base_dist=new Array(D_CODES$1);zero$1(base_dist);function StaticTreeDesc(a,t,s,r,o){this.static_tree=a,this.extra_bits=t,this.extra_base=s,this.elems=r,this.max_length=o,this.has_stree=a&&a.length}let static_l_desc,static_d_desc,static_bl_desc;function TreeDesc(a,t){this.dyn_tree=a,this.max_code=0,this.stat_desc=t}const d_code=a=>a<256?_dist_code[a]:_dist_code[256+(a>>>7)],put_short=(a,t)=>{a.pending_buf[a.pending++]=t&255,a.pending_buf[a.pending++]=t>>>8&255},send_bits=(a,t,s)=>{a.bi_valid>Buf_size-s?(a.bi_buf|=t<<a.bi_valid&65535,put_short(a,a.bi_buf),a.bi_buf=t>>Buf_size-a.bi_valid,a.bi_valid+=s-Buf_size):(a.bi_buf|=t<<a.bi_valid&65535,a.bi_valid+=s)},send_code=(a,t,s)=>{send_bits(a,s[t*2],s[t*2+1])},bi_reverse=(a,t)=>{let s=0;do s|=a&1,a>>>=1,s<<=1;while(--t>0);return s>>>1},bi_flush=a=>{a.bi_valid===16?(put_short(a,a.bi_buf),a.bi_buf=0,a.bi_valid=0):a.bi_valid>=8&&(a.pending_buf[a.pending++]=a.bi_buf&255,a.bi_buf>>=8,a.bi_valid-=8)},gen_bitlen=(a,t)=>{const s=t.dyn_tree,r=t.max_code,o=t.stat_desc.static_tree,n=t.stat_desc.has_stree,l=t.stat_desc.extra_bits,h=t.stat_desc.extra_base,g=t.stat_desc.max_length;let d,A,S,O,I,W,L=0;for(O=0;O<=MAX_BITS$1;O++)a.bl_count[O]=0;for(s[a.heap[a.heap_max]*2+1]=0,d=a.heap_max+1;d<HEAP_SIZE$1;d++)A=a.heap[d],O=s[s[A*2+1]*2+1]+1,O>g&&(O=g,L++),s[A*2+1]=O,!(A>r)&&(a.bl_count[O]++,I=0,A>=h&&(I=l[A-h]),W=s[A*2],a.opt_len+=W*(O+I),n&&(a.static_len+=W*(o[A*2+1]+I)));if(L!==0){do{for(O=g-1;a.bl_count[O]===0;)O--;a.bl_count[O]--,a.bl_count[O+1]+=2,a.bl_count[g]--,L-=2}while(L>0);for(O=g;O!==0;O--)for(A=a.bl_count[O];A!==0;)S=a.heap[--d],!(S>r)&&(s[S*2+1]!==O&&(a.opt_len+=(O-s[S*2+1])*s[S*2],s[S*2+1]=O),A--)}},gen_codes=(a,t,s)=>{const r=new Array(MAX_BITS$1+1);let o=0,n,l;for(n=1;n<=MAX_BITS$1;n++)o=o+s[n-1]<<1,r[n]=o;for(l=0;l<=t;l++){let h=a[l*2+1];h!==0&&(a[l*2]=bi_reverse(r[h]++,h))}},tr_static_init=()=>{let a,t,s,r,o;const n=new Array(MAX_BITS$1+1);for(s=0,r=0;r<LENGTH_CODES$1-1;r++)for(base_length[r]=s,a=0;a<1<<extra_lbits[r];a++)_length_code[s++]=r;for(_length_code[s-1]=r,o=0,r=0;r<16;r++)for(base_dist[r]=o,a=0;a<1<<extra_dbits[r];a++)_dist_code[o++]=r;for(o>>=7;r<D_CODES$1;r++)for(base_dist[r]=o<<7,a=0;a<1<<extra_dbits[r]-7;a++)_dist_code[256+o++]=r;for(t=0;t<=MAX_BITS$1;t++)n[t]=0;for(a=0;a<=143;)static_ltree[a*2+1]=8,a++,n[8]++;for(;a<=255;)static_ltree[a*2+1]=9,a++,n[9]++;for(;a<=279;)static_ltree[a*2+1]=7,a++,n[7]++;for(;a<=287;)static_ltree[a*2+1]=8,a++,n[8]++;for(gen_codes(static_ltree,L_CODES$1+1,n),a=0;a<D_CODES$1;a++)static_dtree[a*2+1]=5,static_dtree[a*2]=bi_reverse(a,5);static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS$1+1,L_CODES$1,MAX_BITS$1),static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES$1,MAX_BITS$1),static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES$1,MAX_BL_BITS)},init_block=a=>{let t;for(t=0;t<L_CODES$1;t++)a.dyn_ltree[t*2]=0;for(t=0;t<D_CODES$1;t++)a.dyn_dtree[t*2]=0;for(t=0;t<BL_CODES$1;t++)a.bl_tree[t*2]=0;a.dyn_ltree[END_BLOCK*2]=1,a.opt_len=a.static_len=0,a.sym_next=a.matches=0},bi_windup=a=>{a.bi_valid>8?put_short(a,a.bi_buf):a.bi_valid>0&&(a.pending_buf[a.pending++]=a.bi_buf),a.bi_buf=0,a.bi_valid=0},smaller=(a,t,s,r)=>{const o=t*2,n=s*2;return a[o]<a[n]||a[o]===a[n]&&r[t]<=r[s]},pqdownheap=(a,t,s)=>{const r=a.heap[s];let o=s<<1;for(;o<=a.heap_len&&(o<a.heap_len&&smaller(t,a.heap[o+1],a.heap[o],a.depth)&&o++,!smaller(t,r,a.heap[o],a.depth));)a.heap[s]=a.heap[o],s=o,o<<=1;a.heap[s]=r},compress_block=(a,t,s)=>{let r,o,n=0,l,h;if(a.sym_next!==0)do r=a.pending_buf[a.sym_buf+n++]&255,r+=(a.pending_buf[a.sym_buf+n++]&255)<<8,o=a.pending_buf[a.sym_buf+n++],r===0?send_code(a,o,t):(l=_length_code[o],send_code(a,l+LITERALS$1+1,t),h=extra_lbits[l],h!==0&&(o-=base_length[l],send_bits(a,o,h)),r--,l=d_code(r),send_code(a,l,s),h=extra_dbits[l],h!==0&&(r-=base_dist[l],send_bits(a,r,h)));while(n<a.sym_next);send_code(a,END_BLOCK,t)},build_tree=(a,t)=>{const s=t.dyn_tree,r=t.stat_desc.static_tree,o=t.stat_desc.has_stree,n=t.stat_desc.elems;let l,h,g=-1,d;for(a.heap_len=0,a.heap_max=HEAP_SIZE$1,l=0;l<n;l++)s[l*2]!==0?(a.heap[++a.heap_len]=g=l,a.depth[l]=0):s[l*2+1]=0;for(;a.heap_len<2;)d=a.heap[++a.heap_len]=g<2?++g:0,s[d*2]=1,a.depth[d]=0,a.opt_len--,o&&(a.static_len-=r[d*2+1]);for(t.max_code=g,l=a.heap_len>>1;l>=1;l--)pqdownheap(a,s,l);d=n;do l=a.heap[1],a.heap[1]=a.heap[a.heap_len--],pqdownheap(a,s,1),h=a.heap[1],a.heap[--a.heap_max]=l,a.heap[--a.heap_max]=h,s[d*2]=s[l*2]+s[h*2],a.depth[d]=(a.depth[l]>=a.depth[h]?a.depth[l]:a.depth[h])+1,s[l*2+1]=s[h*2+1]=d,a.heap[1]=d++,pqdownheap(a,s,1);while(a.heap_len>=2);a.heap[--a.heap_max]=a.heap[1],gen_bitlen(a,t),gen_codes(s,g,a.bl_count)},scan_tree=(a,t,s)=>{let r,o=-1,n,l=t[0*2+1],h=0,g=7,d=4;for(l===0&&(g=138,d=3),t[(s+1)*2+1]=65535,r=0;r<=s;r++)n=l,l=t[(r+1)*2+1],!(++h<g&&n===l)&&(h<d?a.bl_tree[n*2]+=h:n!==0?(n!==o&&a.bl_tree[n*2]++,a.bl_tree[REP_3_6*2]++):h<=10?a.bl_tree[REPZ_3_10*2]++:a.bl_tree[REPZ_11_138*2]++,h=0,o=n,l===0?(g=138,d=3):n===l?(g=6,d=3):(g=7,d=4))},send_tree=(a,t,s)=>{let r,o=-1,n,l=t[0*2+1],h=0,g=7,d=4;for(l===0&&(g=138,d=3),r=0;r<=s;r++)if(n=l,l=t[(r+1)*2+1],!(++h<g&&n===l)){if(h<d)do send_code(a,n,a.bl_tree);while(--h!==0);else n!==0?(n!==o&&(send_code(a,n,a.bl_tree),h--),send_code(a,REP_3_6,a.bl_tree),send_bits(a,h-3,2)):h<=10?(send_code(a,REPZ_3_10,a.bl_tree),send_bits(a,h-3,3)):(send_code(a,REPZ_11_138,a.bl_tree),send_bits(a,h-11,7));h=0,o=n,l===0?(g=138,d=3):n===l?(g=6,d=3):(g=7,d=4)}},build_bl_tree=a=>{let t;for(scan_tree(a,a.dyn_ltree,a.l_desc.max_code),scan_tree(a,a.dyn_dtree,a.d_desc.max_code),build_tree(a,a.bl_desc),t=BL_CODES$1-1;t>=3&&a.bl_tree[bl_order[t]*2+1]===0;t--);return a.opt_len+=3*(t+1)+5+5+4,t},send_all_trees=(a,t,s,r)=>{let o;for(send_bits(a,t-257,5),send_bits(a,s-1,5),send_bits(a,r-4,4),o=0;o<r;o++)send_bits(a,a.bl_tree[bl_order[o]*2+1],3);send_tree(a,a.dyn_ltree,t-1),send_tree(a,a.dyn_dtree,s-1)},detect_data_type=a=>{let t=4093624447,s;for(s=0;s<=31;s++,t>>>=1)if(t&1&&a.dyn_ltree[s*2]!==0)return Z_BINARY;if(a.dyn_ltree[9*2]!==0||a.dyn_ltree[10*2]!==0||a.dyn_ltree[13*2]!==0)return Z_TEXT;for(s=32;s<LITERALS$1;s++)if(a.dyn_ltree[s*2]!==0)return Z_TEXT;return Z_BINARY};let static_init_done=!1;const _tr_init$1=a=>{static_init_done||(tr_static_init(),static_init_done=!0),a.l_desc=new TreeDesc(a.dyn_ltree,static_l_desc),a.d_desc=new TreeDesc(a.dyn_dtree,static_d_desc),a.bl_desc=new TreeDesc(a.bl_tree,static_bl_desc),a.bi_buf=0,a.bi_valid=0,init_block(a)},_tr_stored_block$1=(a,t,s,r)=>{send_bits(a,(STORED_BLOCK<<1)+(r?1:0),3),bi_windup(a),put_short(a,s),put_short(a,~s),s&&a.pending_buf.set(a.window.subarray(t,t+s),a.pending),a.pending+=s},_tr_align$1=a=>{send_bits(a,STATIC_TREES<<1,3),send_code(a,END_BLOCK,static_ltree),bi_flush(a)},_tr_flush_block$1=(a,t,s,r)=>{let o,n,l=0;a.level>0?(a.strm.data_type===Z_UNKNOWN$1&&(a.strm.data_type=detect_data_type(a)),build_tree(a,a.l_desc),build_tree(a,a.d_desc),l=build_bl_tree(a),o=a.opt_len+3+7>>>3,n=a.static_len+3+7>>>3,n<=o&&(o=n)):o=n=s+5,s+4<=o&&t!==-1?_tr_stored_block$1(a,t,s,r):a.strategy===Z_FIXED$1||n===o?(send_bits(a,(STATIC_TREES<<1)+(r?1:0),3),compress_block(a,static_ltree,static_dtree)):(send_bits(a,(DYN_TREES<<1)+(r?1:0),3),send_all_trees(a,a.l_desc.max_code+1,a.d_desc.max_code+1,l+1),compress_block(a,a.dyn_ltree,a.dyn_dtree)),init_block(a),r&&bi_windup(a)},_tr_tally$1=(a,t,s)=>(a.pending_buf[a.sym_buf+a.sym_next++]=t,a.pending_buf[a.sym_buf+a.sym_next++]=t>>8,a.pending_buf[a.sym_buf+a.sym_next++]=s,t===0?a.dyn_ltree[s*2]++:(a.matches++,t--,a.dyn_ltree[(_length_code[s]+LITERALS$1+1)*2]++,a.dyn_dtree[d_code(t)*2]++),a.sym_next===a.sym_end);var _tr_init_1=_tr_init$1,_tr_stored_block_1=_tr_stored_block$1,_tr_flush_block_1=_tr_flush_block$1,_tr_tally_1=_tr_tally$1,_tr_align_1=_tr_align$1,trees={_tr_init:_tr_init_1,_tr_stored_block:_tr_stored_block_1,_tr_flush_block:_tr_flush_block_1,_tr_tally:_tr_tally_1,_tr_align:_tr_align_1};const adler32=(a,t,s,r)=>{let o=a&65535|0,n=a>>>16&65535|0,l=0;for(;s!==0;){l=s>2e3?2e3:s,s-=l;do o=o+t[r++]|0,n=n+o|0;while(--l);o%=65521,n%=65521}return o|n<<16|0};var adler32_1=adler32;const makeTable=()=>{let a,t=[];for(var s=0;s<256;s++){a=s;for(var r=0;r<8;r++)a=a&1?3988292384^a>>>1:a>>>1;t[s]=a}return t},crcTable=new Uint32Array(makeTable()),crc32=(a,t,s,r)=>{const o=crcTable,n=r+s;a^=-1;for(let l=r;l<n;l++)a=a>>>8^o[(a^t[l])&255];return a^-1};var crc32_1=crc32,messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},constants$2={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init,_tr_stored_block,_tr_flush_block,_tr_tally,_tr_align}=trees,{Z_NO_FLUSH:Z_NO_FLUSH$2,Z_PARTIAL_FLUSH,Z_FULL_FLUSH:Z_FULL_FLUSH$1,Z_FINISH:Z_FINISH$3,Z_BLOCK:Z_BLOCK$1,Z_OK:Z_OK$3,Z_STREAM_END:Z_STREAM_END$3,Z_STREAM_ERROR:Z_STREAM_ERROR$2,Z_DATA_ERROR:Z_DATA_ERROR$2,Z_BUF_ERROR:Z_BUF_ERROR$1,Z_DEFAULT_COMPRESSION:Z_DEFAULT_COMPRESSION$1,Z_FILTERED,Z_HUFFMAN_ONLY,Z_RLE,Z_FIXED,Z_DEFAULT_STRATEGY:Z_DEFAULT_STRATEGY$1,Z_UNKNOWN,Z_DEFLATED:Z_DEFLATED$2}=constants$2,MAX_MEM_LEVEL=9,MAX_WBITS$1=15,DEF_MEM_LEVEL=8,LENGTH_CODES=29,LITERALS=256,L_CODES=LITERALS+1+LENGTH_CODES,D_CODES=30,BL_CODES=19,HEAP_SIZE=2*L_CODES+1,MAX_BITS=15,MIN_MATCH=3,MAX_MATCH=258,MIN_LOOKAHEAD=MAX_MATCH+MIN_MATCH+1,PRESET_DICT=32,INIT_STATE=42,GZIP_STATE=57,EXTRA_STATE=69,NAME_STATE=73,COMMENT_STATE=91,HCRC_STATE=103,BUSY_STATE=113,FINISH_STATE=666,BS_NEED_MORE=1,BS_BLOCK_DONE=2,BS_FINISH_STARTED=3,BS_FINISH_DONE=4,OS_CODE=3,err=(a,t)=>(a.msg=messages[t],t),rank=a=>a*2-(a>4?9:0),zero=a=>{let t=a.length;for(;--t>=0;)a[t]=0},slide_hash=a=>{let t,s,r,o=a.w_size;t=a.hash_size,r=t;do s=a.head[--r],a.head[r]=s>=o?s-o:0;while(--t);t=o,r=t;do s=a.prev[--r],a.prev[r]=s>=o?s-o:0;while(--t)};let HASH_ZLIB=(a,t,s)=>(t<<a.hash_shift^s)&a.hash_mask,HASH=HASH_ZLIB;const flush_pending=a=>{const t=a.state;let s=t.pending;s>a.avail_out&&(s=a.avail_out),s!==0&&(a.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+s),a.next_out),a.next_out+=s,t.pending_out+=s,a.total_out+=s,a.avail_out-=s,t.pending-=s,t.pending===0&&(t.pending_out=0))},flush_block_only=(a,t)=>{_tr_flush_block(a,a.block_start>=0?a.block_start:-1,a.strstart-a.block_start,t),a.block_start=a.strstart,flush_pending(a.strm)},put_byte=(a,t)=>{a.pending_buf[a.pending++]=t},putShortMSB=(a,t)=>{a.pending_buf[a.pending++]=t>>>8&255,a.pending_buf[a.pending++]=t&255},read_buf=(a,t,s,r)=>{let o=a.avail_in;return o>r&&(o=r),o===0?0:(a.avail_in-=o,t.set(a.input.subarray(a.next_in,a.next_in+o),s),a.state.wrap===1?a.adler=adler32_1(a.adler,t,o,s):a.state.wrap===2&&(a.adler=crc32_1(a.adler,t,o,s)),a.next_in+=o,a.total_in+=o,o)},longest_match=(a,t)=>{let s=a.max_chain_length,r=a.strstart,o,n,l=a.prev_length,h=a.nice_match;const g=a.strstart>a.w_size-MIN_LOOKAHEAD?a.strstart-(a.w_size-MIN_LOOKAHEAD):0,d=a.window,A=a.w_mask,S=a.prev,O=a.strstart+MAX_MATCH;let I=d[r+l-1],W=d[r+l];a.prev_length>=a.good_match&&(s>>=2),h>a.lookahead&&(h=a.lookahead);do if(o=t,!(d[o+l]!==W||d[o+l-1]!==I||d[o]!==d[r]||d[++o]!==d[r+1])){r+=2,o++;do;while(d[++r]===d[++o]&&d[++r]===d[++o]&&d[++r]===d[++o]&&d[++r]===d[++o]&&d[++r]===d[++o]&&d[++r]===d[++o]&&d[++r]===d[++o]&&d[++r]===d[++o]&&r<O);if(n=MAX_MATCH-(O-r),r=O-MAX_MATCH,n>l){if(a.match_start=t,l=n,n>=h)break;I=d[r+l-1],W=d[r+l]}}while((t=S[t&A])>g&&--s!==0);return l<=a.lookahead?l:a.lookahead},fill_window=a=>{const t=a.w_size;let s,r,o;do{if(r=a.window_size-a.lookahead-a.strstart,a.strstart>=t+(t-MIN_LOOKAHEAD)&&(a.window.set(a.window.subarray(t,t+t-r),0),a.match_start-=t,a.strstart-=t,a.block_start-=t,a.insert>a.strstart&&(a.insert=a.strstart),slide_hash(a),r+=t),a.strm.avail_in===0)break;if(s=read_buf(a.strm,a.window,a.strstart+a.lookahead,r),a.lookahead+=s,a.lookahead+a.insert>=MIN_MATCH)for(o=a.strstart-a.insert,a.ins_h=a.window[o],a.ins_h=HASH(a,a.ins_h,a.window[o+1]);a.insert&&(a.ins_h=HASH(a,a.ins_h,a.window[o+MIN_MATCH-1]),a.prev[o&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=o,o++,a.insert--,!(a.lookahead+a.insert<MIN_MATCH)););}while(a.lookahead<MIN_LOOKAHEAD&&a.strm.avail_in!==0)},deflate_stored=(a,t)=>{let s=a.pending_buf_size-5>a.w_size?a.w_size:a.pending_buf_size-5,r,o,n,l=0,h=a.strm.avail_in;do{if(r=65535,n=a.bi_valid+42>>3,a.strm.avail_out<n||(n=a.strm.avail_out-n,o=a.strstart-a.block_start,r>o+a.strm.avail_in&&(r=o+a.strm.avail_in),r>n&&(r=n),r<s&&(r===0&&t!==Z_FINISH$3||t===Z_NO_FLUSH$2||r!==o+a.strm.avail_in)))break;l=t===Z_FINISH$3&&r===o+a.strm.avail_in?1:0,_tr_stored_block(a,0,0,l),a.pending_buf[a.pending-4]=r,a.pending_buf[a.pending-3]=r>>8,a.pending_buf[a.pending-2]=~r,a.pending_buf[a.pending-1]=~r>>8,flush_pending(a.strm),o&&(o>r&&(o=r),a.strm.output.set(a.window.subarray(a.block_start,a.block_start+o),a.strm.next_out),a.strm.next_out+=o,a.strm.avail_out-=o,a.strm.total_out+=o,a.block_start+=o,r-=o),r&&(read_buf(a.strm,a.strm.output,a.strm.next_out,r),a.strm.next_out+=r,a.strm.avail_out-=r,a.strm.total_out+=r)}while(l===0);return h-=a.strm.avail_in,h&&(h>=a.w_size?(a.matches=2,a.window.set(a.strm.input.subarray(a.strm.next_in-a.w_size,a.strm.next_in),0),a.strstart=a.w_size,a.insert=a.strstart):(a.window_size-a.strstart<=h&&(a.strstart-=a.w_size,a.window.set(a.window.subarray(a.w_size,a.w_size+a.strstart),0),a.matches<2&&a.matches++,a.insert>a.strstart&&(a.insert=a.strstart)),a.window.set(a.strm.input.subarray(a.strm.next_in-h,a.strm.next_in),a.strstart),a.strstart+=h,a.insert+=h>a.w_size-a.insert?a.w_size-a.insert:h),a.block_start=a.strstart),a.high_water<a.strstart&&(a.high_water=a.strstart),l?BS_FINISH_DONE:t!==Z_NO_FLUSH$2&&t!==Z_FINISH$3&&a.strm.avail_in===0&&a.strstart===a.block_start?BS_BLOCK_DONE:(n=a.window_size-a.strstart,a.strm.avail_in>n&&a.block_start>=a.w_size&&(a.block_start-=a.w_size,a.strstart-=a.w_size,a.window.set(a.window.subarray(a.w_size,a.w_size+a.strstart),0),a.matches<2&&a.matches++,n+=a.w_size,a.insert>a.strstart&&(a.insert=a.strstart)),n>a.strm.avail_in&&(n=a.strm.avail_in),n&&(read_buf(a.strm,a.window,a.strstart,n),a.strstart+=n,a.insert+=n>a.w_size-a.insert?a.w_size-a.insert:n),a.high_water<a.strstart&&(a.high_water=a.strstart),n=a.bi_valid+42>>3,n=a.pending_buf_size-n>65535?65535:a.pending_buf_size-n,s=n>a.w_size?a.w_size:n,o=a.strstart-a.block_start,(o>=s||(o||t===Z_FINISH$3)&&t!==Z_NO_FLUSH$2&&a.strm.avail_in===0&&o<=n)&&(r=o>n?n:o,l=t===Z_FINISH$3&&a.strm.avail_in===0&&r===o?1:0,_tr_stored_block(a,a.block_start,r,l),a.block_start+=r,flush_pending(a.strm)),l?BS_FINISH_STARTED:BS_NEED_MORE)},deflate_fast=(a,t)=>{let s,r;for(;;){if(a.lookahead<MIN_LOOKAHEAD){if(fill_window(a),a.lookahead<MIN_LOOKAHEAD&&t===Z_NO_FLUSH$2)return BS_NEED_MORE;if(a.lookahead===0)break}if(s=0,a.lookahead>=MIN_MATCH&&(a.ins_h=HASH(a,a.ins_h,a.window[a.strstart+MIN_MATCH-1]),s=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),s!==0&&a.strstart-s<=a.w_size-MIN_LOOKAHEAD&&(a.match_length=longest_match(a,s)),a.match_length>=MIN_MATCH)if(r=_tr_tally(a,a.strstart-a.match_start,a.match_length-MIN_MATCH),a.lookahead-=a.match_length,a.match_length<=a.max_lazy_match&&a.lookahead>=MIN_MATCH){a.match_length--;do a.strstart++,a.ins_h=HASH(a,a.ins_h,a.window[a.strstart+MIN_MATCH-1]),s=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart;while(--a.match_length!==0);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=HASH(a,a.ins_h,a.window[a.strstart+1]);else r=_tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(r&&(flush_block_only(a,!1),a.strm.avail_out===0))return BS_NEED_MORE}return a.insert=a.strstart<MIN_MATCH-1?a.strstart:MIN_MATCH-1,t===Z_FINISH$3?(flush_block_only(a,!0),a.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):a.sym_next&&(flush_block_only(a,!1),a.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_slow=(a,t)=>{let s,r,o;for(;;){if(a.lookahead<MIN_LOOKAHEAD){if(fill_window(a),a.lookahead<MIN_LOOKAHEAD&&t===Z_NO_FLUSH$2)return BS_NEED_MORE;if(a.lookahead===0)break}if(s=0,a.lookahead>=MIN_MATCH&&(a.ins_h=HASH(a,a.ins_h,a.window[a.strstart+MIN_MATCH-1]),s=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),a.prev_length=a.match_length,a.prev_match=a.match_start,a.match_length=MIN_MATCH-1,s!==0&&a.prev_length<a.max_lazy_match&&a.strstart-s<=a.w_size-MIN_LOOKAHEAD&&(a.match_length=longest_match(a,s),a.match_length<=5&&(a.strategy===Z_FILTERED||a.match_length===MIN_MATCH&&a.strstart-a.match_start>4096)&&(a.match_length=MIN_MATCH-1)),a.prev_length>=MIN_MATCH&&a.match_length<=a.prev_length){o=a.strstart+a.lookahead-MIN_MATCH,r=_tr_tally(a,a.strstart-1-a.prev_match,a.prev_length-MIN_MATCH),a.lookahead-=a.prev_length-1,a.prev_length-=2;do++a.strstart<=o&&(a.ins_h=HASH(a,a.ins_h,a.window[a.strstart+MIN_MATCH-1]),s=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart);while(--a.prev_length!==0);if(a.match_available=0,a.match_length=MIN_MATCH-1,a.strstart++,r&&(flush_block_only(a,!1),a.strm.avail_out===0))return BS_NEED_MORE}else if(a.match_available){if(r=_tr_tally(a,0,a.window[a.strstart-1]),r&&flush_block_only(a,!1),a.strstart++,a.lookahead--,a.strm.avail_out===0)return BS_NEED_MORE}else a.match_available=1,a.strstart++,a.lookahead--}return a.match_available&&(r=_tr_tally(a,0,a.window[a.strstart-1]),a.match_available=0),a.insert=a.strstart<MIN_MATCH-1?a.strstart:MIN_MATCH-1,t===Z_FINISH$3?(flush_block_only(a,!0),a.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):a.sym_next&&(flush_block_only(a,!1),a.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_rle=(a,t)=>{let s,r,o,n;const l=a.window;for(;;){if(a.lookahead<=MAX_MATCH){if(fill_window(a),a.lookahead<=MAX_MATCH&&t===Z_NO_FLUSH$2)return BS_NEED_MORE;if(a.lookahead===0)break}if(a.match_length=0,a.lookahead>=MIN_MATCH&&a.strstart>0&&(o=a.strstart-1,r=l[o],r===l[++o]&&r===l[++o]&&r===l[++o])){n=a.strstart+MAX_MATCH;do;while(r===l[++o]&&r===l[++o]&&r===l[++o]&&r===l[++o]&&r===l[++o]&&r===l[++o]&&r===l[++o]&&r===l[++o]&&o<n);a.match_length=MAX_MATCH-(n-o),a.match_length>a.lookahead&&(a.match_length=a.lookahead)}if(a.match_length>=MIN_MATCH?(s=_tr_tally(a,1,a.match_length-MIN_MATCH),a.lookahead-=a.match_length,a.strstart+=a.match_length,a.match_length=0):(s=_tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++),s&&(flush_block_only(a,!1),a.strm.avail_out===0))return BS_NEED_MORE}return a.insert=0,t===Z_FINISH$3?(flush_block_only(a,!0),a.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):a.sym_next&&(flush_block_only(a,!1),a.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_huff=(a,t)=>{let s;for(;;){if(a.lookahead===0&&(fill_window(a),a.lookahead===0)){if(t===Z_NO_FLUSH$2)return BS_NEED_MORE;break}if(a.match_length=0,s=_tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++,s&&(flush_block_only(a,!1),a.strm.avail_out===0))return BS_NEED_MORE}return a.insert=0,t===Z_FINISH$3?(flush_block_only(a,!0),a.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):a.sym_next&&(flush_block_only(a,!1),a.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE};function Config(a,t,s,r,o){this.good_length=a,this.max_lazy=t,this.nice_length=s,this.max_chain=r,this.func=o}const configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)],lm_init=a=>{a.window_size=2*a.w_size,zero(a.head),a.max_lazy_match=configuration_table[a.level].max_lazy,a.good_match=configuration_table[a.level].good_length,a.nice_match=configuration_table[a.level].nice_length,a.max_chain_length=configuration_table[a.level].max_chain,a.strstart=0,a.block_start=0,a.lookahead=0,a.insert=0,a.match_length=a.prev_length=MIN_MATCH-1,a.match_available=0,a.ins_h=0};function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z_DEFLATED$2,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(HEAP_SIZE*2),this.dyn_dtree=new Uint16Array((2*D_CODES+1)*2),this.bl_tree=new Uint16Array((2*BL_CODES+1)*2),zero(this.dyn_ltree),zero(this.dyn_dtree),zero(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(MAX_BITS+1),this.heap=new Uint16Array(2*L_CODES+1),zero(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*L_CODES+1),zero(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const deflateStateCheck=a=>{if(!a)return 1;const t=a.state;return!t||t.strm!==a||t.status!==INIT_STATE&&t.status!==GZIP_STATE&&t.status!==EXTRA_STATE&&t.status!==NAME_STATE&&t.status!==COMMENT_STATE&&t.status!==HCRC_STATE&&t.status!==BUSY_STATE&&t.status!==FINISH_STATE?1:0},deflateResetKeep=a=>{if(deflateStateCheck(a))return err(a,Z_STREAM_ERROR$2);a.total_in=a.total_out=0,a.data_type=Z_UNKNOWN;const t=a.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?GZIP_STATE:t.wrap?INIT_STATE:BUSY_STATE,a.adler=t.wrap===2?0:1,t.last_flush=-2,_tr_init(t),Z_OK$3},deflateReset=a=>{const t=deflateResetKeep(a);return t===Z_OK$3&&lm_init(a.state),t},deflateSetHeader=(a,t)=>deflateStateCheck(a)||a.state.wrap!==2?Z_STREAM_ERROR$2:(a.state.gzhead=t,Z_OK$3),deflateInit2=(a,t,s,r,o,n)=>{if(!a)return Z_STREAM_ERROR$2;let l=1;if(t===Z_DEFAULT_COMPRESSION$1&&(t=6),r<0?(l=0,r=-r):r>15&&(l=2,r-=16),o<1||o>MAX_MEM_LEVEL||s!==Z_DEFLATED$2||r<8||r>15||t<0||t>9||n<0||n>Z_FIXED||r===8&&l!==1)return err(a,Z_STREAM_ERROR$2);r===8&&(r=9);const h=new DeflateState;return a.state=h,h.strm=a,h.status=INIT_STATE,h.wrap=l,h.gzhead=null,h.w_bits=r,h.w_size=1<<h.w_bits,h.w_mask=h.w_size-1,h.hash_bits=o+7,h.hash_size=1<<h.hash_bits,h.hash_mask=h.hash_size-1,h.hash_shift=~~((h.hash_bits+MIN_MATCH-1)/MIN_MATCH),h.window=new Uint8Array(h.w_size*2),h.head=new Uint16Array(h.hash_size),h.prev=new Uint16Array(h.w_size),h.lit_bufsize=1<<o+6,h.pending_buf_size=h.lit_bufsize*4,h.pending_buf=new Uint8Array(h.pending_buf_size),h.sym_buf=h.lit_bufsize,h.sym_end=(h.lit_bufsize-1)*3,h.level=t,h.strategy=n,h.method=s,deflateReset(a)},deflateInit=(a,t)=>deflateInit2(a,t,Z_DEFLATED$2,MAX_WBITS$1,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY$1),deflate$2=(a,t)=>{if(deflateStateCheck(a)||t>Z_BLOCK$1||t<0)return a?err(a,Z_STREAM_ERROR$2):Z_STREAM_ERROR$2;const s=a.state;if(!a.output||a.avail_in!==0&&!a.input||s.status===FINISH_STATE&&t!==Z_FINISH$3)return err(a,a.avail_out===0?Z_BUF_ERROR$1:Z_STREAM_ERROR$2);const r=s.last_flush;if(s.last_flush=t,s.pending!==0){if(flush_pending(a),a.avail_out===0)return s.last_flush=-1,Z_OK$3}else if(a.avail_in===0&&rank(t)<=rank(r)&&t!==Z_FINISH$3)return err(a,Z_BUF_ERROR$1);if(s.status===FINISH_STATE&&a.avail_in!==0)return err(a,Z_BUF_ERROR$1);if(s.status===INIT_STATE&&s.wrap===0&&(s.status=BUSY_STATE),s.status===INIT_STATE){let o=Z_DEFLATED$2+(s.w_bits-8<<4)<<8,n=-1;if(s.strategy>=Z_HUFFMAN_ONLY||s.level<2?n=0:s.level<6?n=1:s.level===6?n=2:n=3,o|=n<<6,s.strstart!==0&&(o|=PRESET_DICT),o+=31-o%31,putShortMSB(s,o),s.strstart!==0&&(putShortMSB(s,a.adler>>>16),putShortMSB(s,a.adler&65535)),a.adler=1,s.status=BUSY_STATE,flush_pending(a),s.pending!==0)return s.last_flush=-1,Z_OK$3}if(s.status===GZIP_STATE){if(a.adler=0,put_byte(s,31),put_byte(s,139),put_byte(s,8),s.gzhead)put_byte(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),put_byte(s,s.gzhead.time&255),put_byte(s,s.gzhead.time>>8&255),put_byte(s,s.gzhead.time>>16&255),put_byte(s,s.gzhead.time>>24&255),put_byte(s,s.level===9?2:s.strategy>=Z_HUFFMAN_ONLY||s.level<2?4:0),put_byte(s,s.gzhead.os&255),s.gzhead.extra&&s.gzhead.extra.length&&(put_byte(s,s.gzhead.extra.length&255),put_byte(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(a.adler=crc32_1(a.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=EXTRA_STATE;else if(put_byte(s,0),put_byte(s,0),put_byte(s,0),put_byte(s,0),put_byte(s,0),put_byte(s,s.level===9?2:s.strategy>=Z_HUFFMAN_ONLY||s.level<2?4:0),put_byte(s,OS_CODE),s.status=BUSY_STATE,flush_pending(a),s.pending!==0)return s.last_flush=-1,Z_OK$3}if(s.status===EXTRA_STATE){if(s.gzhead.extra){let o=s.pending,n=(s.gzhead.extra.length&65535)-s.gzindex;for(;s.pending+n>s.pending_buf_size;){let h=s.pending_buf_size-s.pending;if(s.pending_buf.set(s.gzhead.extra.subarray(s.gzindex,s.gzindex+h),s.pending),s.pending=s.pending_buf_size,s.gzhead.hcrc&&s.pending>o&&(a.adler=crc32_1(a.adler,s.pending_buf,s.pending-o,o)),s.gzindex+=h,flush_pending(a),s.pending!==0)return s.last_flush=-1,Z_OK$3;o=0,n-=h}let l=new Uint8Array(s.gzhead.extra);s.pending_buf.set(l.subarray(s.gzindex,s.gzindex+n),s.pending),s.pending+=n,s.gzhead.hcrc&&s.pending>o&&(a.adler=crc32_1(a.adler,s.pending_buf,s.pending-o,o)),s.gzindex=0}s.status=NAME_STATE}if(s.status===NAME_STATE){if(s.gzhead.name){let o=s.pending,n;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>o&&(a.adler=crc32_1(a.adler,s.pending_buf,s.pending-o,o)),flush_pending(a),s.pending!==0)return s.last_flush=-1,Z_OK$3;o=0}s.gzindex<s.gzhead.name.length?n=s.gzhead.name.charCodeAt(s.gzindex++)&255:n=0,put_byte(s,n)}while(n!==0);s.gzhead.hcrc&&s.pending>o&&(a.adler=crc32_1(a.adler,s.pending_buf,s.pending-o,o)),s.gzindex=0}s.status=COMMENT_STATE}if(s.status===COMMENT_STATE){if(s.gzhead.comment){let o=s.pending,n;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>o&&(a.adler=crc32_1(a.adler,s.pending_buf,s.pending-o,o)),flush_pending(a),s.pending!==0)return s.last_flush=-1,Z_OK$3;o=0}s.gzindex<s.gzhead.comment.length?n=s.gzhead.comment.charCodeAt(s.gzindex++)&255:n=0,put_byte(s,n)}while(n!==0);s.gzhead.hcrc&&s.pending>o&&(a.adler=crc32_1(a.adler,s.pending_buf,s.pending-o,o))}s.status=HCRC_STATE}if(s.status===HCRC_STATE){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size&&(flush_pending(a),s.pending!==0))return s.last_flush=-1,Z_OK$3;put_byte(s,a.adler&255),put_byte(s,a.adler>>8&255),a.adler=0}if(s.status=BUSY_STATE,flush_pending(a),s.pending!==0)return s.last_flush=-1,Z_OK$3}if(a.avail_in!==0||s.lookahead!==0||t!==Z_NO_FLUSH$2&&s.status!==FINISH_STATE){let o=s.level===0?deflate_stored(s,t):s.strategy===Z_HUFFMAN_ONLY?deflate_huff(s,t):s.strategy===Z_RLE?deflate_rle(s,t):configuration_table[s.level].func(s,t);if((o===BS_FINISH_STARTED||o===BS_FINISH_DONE)&&(s.status=FINISH_STATE),o===BS_NEED_MORE||o===BS_FINISH_STARTED)return a.avail_out===0&&(s.last_flush=-1),Z_OK$3;if(o===BS_BLOCK_DONE&&(t===Z_PARTIAL_FLUSH?_tr_align(s):t!==Z_BLOCK$1&&(_tr_stored_block(s,0,0,!1),t===Z_FULL_FLUSH$1&&(zero(s.head),s.lookahead===0&&(s.strstart=0,s.block_start=0,s.insert=0))),flush_pending(a),a.avail_out===0))return s.last_flush=-1,Z_OK$3}return t!==Z_FINISH$3?Z_OK$3:s.wrap<=0?Z_STREAM_END$3:(s.wrap===2?(put_byte(s,a.adler&255),put_byte(s,a.adler>>8&255),put_byte(s,a.adler>>16&255),put_byte(s,a.adler>>24&255),put_byte(s,a.total_in&255),put_byte(s,a.total_in>>8&255),put_byte(s,a.total_in>>16&255),put_byte(s,a.total_in>>24&255)):(putShortMSB(s,a.adler>>>16),putShortMSB(s,a.adler&65535)),flush_pending(a),s.wrap>0&&(s.wrap=-s.wrap),s.pending!==0?Z_OK$3:Z_STREAM_END$3)},deflateEnd=a=>{if(deflateStateCheck(a))return Z_STREAM_ERROR$2;const t=a.state.status;return a.state=null,t===BUSY_STATE?err(a,Z_DATA_ERROR$2):Z_OK$3},deflateSetDictionary=(a,t)=>{let s=t.length;if(deflateStateCheck(a))return Z_STREAM_ERROR$2;const r=a.state,o=r.wrap;if(o===2||o===1&&r.status!==INIT_STATE||r.lookahead)return Z_STREAM_ERROR$2;if(o===1&&(a.adler=adler32_1(a.adler,t,s,0)),r.wrap=0,s>=r.w_size){o===0&&(zero(r.head),r.strstart=0,r.block_start=0,r.insert=0);let g=new Uint8Array(r.w_size);g.set(t.subarray(s-r.w_size,s),0),t=g,s=r.w_size}const n=a.avail_in,l=a.next_in,h=a.input;for(a.avail_in=s,a.next_in=0,a.input=t,fill_window(r);r.lookahead>=MIN_MATCH;){let g=r.strstart,d=r.lookahead-(MIN_MATCH-1);do r.ins_h=HASH(r,r.ins_h,r.window[g+MIN_MATCH-1]),r.prev[g&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=g,g++;while(--d);r.strstart=g,r.lookahead=MIN_MATCH-1,fill_window(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=MIN_MATCH-1,r.match_available=0,a.next_in=l,a.input=h,a.avail_in=n,r.wrap=o,Z_OK$3};var deflateInit_1=deflateInit,deflateInit2_1=deflateInit2,deflateReset_1=deflateReset,deflateResetKeep_1=deflateResetKeep,deflateSetHeader_1=deflateSetHeader,deflate_2$1=deflate$2,deflateEnd_1=deflateEnd,deflateSetDictionary_1=deflateSetDictionary,deflateInfo="pako deflate (from Nodeca project)",deflate_1$2={deflateInit:deflateInit_1,deflateInit2:deflateInit2_1,deflateReset:deflateReset_1,deflateResetKeep:deflateResetKeep_1,deflateSetHeader:deflateSetHeader_1,deflate:deflate_2$1,deflateEnd:deflateEnd_1,deflateSetDictionary:deflateSetDictionary_1,deflateInfo};const _has=(a,t)=>Object.prototype.hasOwnProperty.call(a,t);var assign=function(a){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const s=t.shift();if(s){if(typeof s!="object")throw new TypeError(s+"must be non-object");for(const r in s)_has(s,r)&&(a[r]=s[r])}}return a},flattenChunks=a=>{let t=0;for(let r=0,o=a.length;r<o;r++)t+=a[r].length;const s=new Uint8Array(t);for(let r=0,o=0,n=a.length;r<n;r++){let l=a[r];s.set(l,o),o+=l.length}return s},common={assign,flattenChunks};let STR_APPLY_UIA_OK=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{STR_APPLY_UIA_OK=!1}const _utf8len=new Uint8Array(256);for(let a=0;a<256;a++)_utf8len[a]=a>=252?6:a>=248?5:a>=240?4:a>=224?3:a>=192?2:1;_utf8len[254]=_utf8len[254]=1;var string2buf=a=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(a);let t,s,r,o,n,l=a.length,h=0;for(o=0;o<l;o++)s=a.charCodeAt(o),(s&64512)===55296&&o+1<l&&(r=a.charCodeAt(o+1),(r&64512)===56320&&(s=65536+(s-55296<<10)+(r-56320),o++)),h+=s<128?1:s<2048?2:s<65536?3:4;for(t=new Uint8Array(h),n=0,o=0;n<h;o++)s=a.charCodeAt(o),(s&64512)===55296&&o+1<l&&(r=a.charCodeAt(o+1),(r&64512)===56320&&(s=65536+(s-55296<<10)+(r-56320),o++)),s<128?t[n++]=s:s<2048?(t[n++]=192|s>>>6,t[n++]=128|s&63):s<65536?(t[n++]=224|s>>>12,t[n++]=128|s>>>6&63,t[n++]=128|s&63):(t[n++]=240|s>>>18,t[n++]=128|s>>>12&63,t[n++]=128|s>>>6&63,t[n++]=128|s&63);return t};const buf2binstring=(a,t)=>{if(t<65534&&a.subarray&&STR_APPLY_UIA_OK)return String.fromCharCode.apply(null,a.length===t?a:a.subarray(0,t));let s="";for(let r=0;r<t;r++)s+=String.fromCharCode(a[r]);return s};var buf2string=(a,t)=>{const s=t||a.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(a.subarray(0,t));let r,o;const n=new Array(s*2);for(o=0,r=0;r<s;){let l=a[r++];if(l<128){n[o++]=l;continue}let h=_utf8len[l];if(h>4){n[o++]=65533,r+=h-1;continue}for(l&=h===2?31:h===3?15:7;h>1&&r<s;)l=l<<6|a[r++]&63,h--;if(h>1){n[o++]=65533;continue}l<65536?n[o++]=l:(l-=65536,n[o++]=55296|l>>10&1023,n[o++]=56320|l&1023)}return buf2binstring(n,o)},utf8border=(a,t)=>{t=t||a.length,t>a.length&&(t=a.length);let s=t-1;for(;s>=0&&(a[s]&192)===128;)s--;return s<0||s===0?t:s+_utf8len[a[s]]>t?s:t},strings={string2buf,buf2string,utf8border};function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var zstream=ZStream;const toString$1=Object.prototype.toString,{Z_NO_FLUSH:Z_NO_FLUSH$1,Z_SYNC_FLUSH,Z_FULL_FLUSH,Z_FINISH:Z_FINISH$2,Z_OK:Z_OK$2,Z_STREAM_END:Z_STREAM_END$2,Z_DEFAULT_COMPRESSION,Z_DEFAULT_STRATEGY,Z_DEFLATED:Z_DEFLATED$1}=constants$2;function Deflate$1(a){this.options=common.assign({level:Z_DEFAULT_COMPRESSION,method:Z_DEFLATED$1,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY},a||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let s=deflate_1$2.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(s!==Z_OK$2)throw new Error(messages[s]);if(t.header&&deflate_1$2.deflateSetHeader(this.strm,t.header),t.dictionary){let r;if(typeof t.dictionary=="string"?r=strings.string2buf(t.dictionary):toString$1.call(t.dictionary)==="[object ArrayBuffer]"?r=new Uint8Array(t.dictionary):r=t.dictionary,s=deflate_1$2.deflateSetDictionary(this.strm,r),s!==Z_OK$2)throw new Error(messages[s]);this._dict_set=!0}}Deflate$1.prototype.push=function(a,t){const s=this.strm,r=this.options.chunkSize;let o,n;if(this.ended)return!1;for(t===~~t?n=t:n=t===!0?Z_FINISH$2:Z_NO_FLUSH$1,typeof a=="string"?s.input=strings.string2buf(a):toString$1.call(a)==="[object ArrayBuffer]"?s.input=new Uint8Array(a):s.input=a,s.next_in=0,s.avail_in=s.input.length;;){if(s.avail_out===0&&(s.output=new Uint8Array(r),s.next_out=0,s.avail_out=r),(n===Z_SYNC_FLUSH||n===Z_FULL_FLUSH)&&s.avail_out<=6){this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;continue}if(o=deflate_1$2.deflate(s,n),o===Z_STREAM_END$2)return s.next_out>0&&this.onData(s.output.subarray(0,s.next_out)),o=deflate_1$2.deflateEnd(this.strm),this.onEnd(o),this.ended=!0,o===Z_OK$2;if(s.avail_out===0){this.onData(s.output);continue}if(n>0&&s.next_out>0){this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;continue}if(s.avail_in===0)break}return!0};Deflate$1.prototype.onData=function(a){this.chunks.push(a)};Deflate$1.prototype.onEnd=function(a){a===Z_OK$2&&(this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg};function deflate$1(a,t){const s=new Deflate$1(t);if(s.push(a,!0),s.err)throw s.msg||messages[s.err];return s.result}function deflateRaw$1(a,t){return t=t||{},t.raw=!0,deflate$1(a,t)}function gzip$1(a,t){return t=t||{},t.gzip=!0,deflate$1(a,t)}var Deflate_1$1=Deflate$1,deflate_2=deflate$1,deflateRaw_1$1=deflateRaw$1,gzip_1$1=gzip$1,constants$1=constants$2,deflate_1$1={Deflate:Deflate_1$1,deflate:deflate_2,deflateRaw:deflateRaw_1$1,gzip:gzip_1$1,constants:constants$1};const BAD$1=16209,TYPE$1=16191;var inffast=function(t,s){let r,o,n,l,h,g,d,A,S,O,I,W,L,H,Y,Q,pe,de,fe,ye,Ee,Le,Z,ne;const Ke=t.state;r=t.next_in,Z=t.input,o=r+(t.avail_in-5),n=t.next_out,ne=t.output,l=n-(s-t.avail_out),h=n+(t.avail_out-257),g=Ke.dmax,d=Ke.wsize,A=Ke.whave,S=Ke.wnext,O=Ke.window,I=Ke.hold,W=Ke.bits,L=Ke.lencode,H=Ke.distcode,Y=(1<<Ke.lenbits)-1,Q=(1<<Ke.distbits)-1;e:do{W<15&&(I+=Z[r++]<<W,W+=8,I+=Z[r++]<<W,W+=8),pe=L[I&Y];t:for(;;){if(de=pe>>>24,I>>>=de,W-=de,de=pe>>>16&255,de===0)ne[n++]=pe&65535;else if(de&16){fe=pe&65535,de&=15,de&&(W<de&&(I+=Z[r++]<<W,W+=8),fe+=I&(1<<de)-1,I>>>=de,W-=de),W<15&&(I+=Z[r++]<<W,W+=8,I+=Z[r++]<<W,W+=8),pe=H[I&Q];i:for(;;){if(de=pe>>>24,I>>>=de,W-=de,de=pe>>>16&255,de&16){if(ye=pe&65535,de&=15,W<de&&(I+=Z[r++]<<W,W+=8,W<de&&(I+=Z[r++]<<W,W+=8)),ye+=I&(1<<de)-1,ye>g){t.msg="invalid distance too far back",Ke.mode=BAD$1;break e}if(I>>>=de,W-=de,de=n-l,ye>de){if(de=ye-de,de>A&&Ke.sane){t.msg="invalid distance too far back",Ke.mode=BAD$1;break e}if(Ee=0,Le=O,S===0){if(Ee+=d-de,de<fe){fe-=de;do ne[n++]=O[Ee++];while(--de);Ee=n-ye,Le=ne}}else if(S<de){if(Ee+=d+S-de,de-=S,de<fe){fe-=de;do ne[n++]=O[Ee++];while(--de);if(Ee=0,S<fe){de=S,fe-=de;do ne[n++]=O[Ee++];while(--de);Ee=n-ye,Le=ne}}}else if(Ee+=S-de,de<fe){fe-=de;do ne[n++]=O[Ee++];while(--de);Ee=n-ye,Le=ne}for(;fe>2;)ne[n++]=Le[Ee++],ne[n++]=Le[Ee++],ne[n++]=Le[Ee++],fe-=3;fe&&(ne[n++]=Le[Ee++],fe>1&&(ne[n++]=Le[Ee++]))}else{Ee=n-ye;do ne[n++]=ne[Ee++],ne[n++]=ne[Ee++],ne[n++]=ne[Ee++],fe-=3;while(fe>2);fe&&(ne[n++]=ne[Ee++],fe>1&&(ne[n++]=ne[Ee++]))}}else if(de&64){t.msg="invalid distance code",Ke.mode=BAD$1;break e}else{pe=H[(pe&65535)+(I&(1<<de)-1)];continue i}break}}else if(de&64)if(de&32){Ke.mode=TYPE$1;break e}else{t.msg="invalid literal/length code",Ke.mode=BAD$1;break e}else{pe=L[(pe&65535)+(I&(1<<de)-1)];continue t}break}}while(r<o&&n<h);fe=W>>3,r-=fe,W-=fe<<3,I&=(1<<W)-1,t.next_in=r,t.next_out=n,t.avail_in=r<o?5+(o-r):5-(r-o),t.avail_out=n<h?257+(h-n):257-(n-h),Ke.hold=I,Ke.bits=W};const MAXBITS=15,ENOUGH_LENS$1=852,ENOUGH_DISTS$1=592,CODES$1=0,LENS$1=1,DISTS$1=2,lbase=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),lext=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),dbase=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),dext=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),inflate_table=(a,t,s,r,o,n,l,h)=>{const g=h.bits;let d=0,A=0,S=0,O=0,I=0,W=0,L=0,H=0,Y=0,Q=0,pe,de,fe,ye,Ee,Le=null,Z;const ne=new Uint16Array(MAXBITS+1),Ke=new Uint16Array(MAXBITS+1);let _t=null,xe,Ct,zt;for(d=0;d<=MAXBITS;d++)ne[d]=0;for(A=0;A<r;A++)ne[t[s+A]]++;for(I=g,O=MAXBITS;O>=1&&ne[O]===0;O--);if(I>O&&(I=O),O===0)return o[n++]=1<<24|64<<16|0,o[n++]=1<<24|64<<16|0,h.bits=1,0;for(S=1;S<O&&ne[S]===0;S++);for(I<S&&(I=S),H=1,d=1;d<=MAXBITS;d++)if(H<<=1,H-=ne[d],H<0)return-1;if(H>0&&(a===CODES$1||O!==1))return-1;for(Ke[1]=0,d=1;d<MAXBITS;d++)Ke[d+1]=Ke[d]+ne[d];for(A=0;A<r;A++)t[s+A]!==0&&(l[Ke[t[s+A]]++]=A);if(a===CODES$1?(Le=_t=l,Z=20):a===LENS$1?(Le=lbase,_t=lext,Z=257):(Le=dbase,_t=dext,Z=0),Q=0,A=0,d=S,Ee=n,W=I,L=0,fe=-1,Y=1<<I,ye=Y-1,a===LENS$1&&Y>ENOUGH_LENS$1||a===DISTS$1&&Y>ENOUGH_DISTS$1)return 1;for(;;){xe=d-L,l[A]+1<Z?(Ct=0,zt=l[A]):l[A]>=Z?(Ct=_t[l[A]-Z],zt=Le[l[A]-Z]):(Ct=96,zt=0),pe=1<<d-L,de=1<<W,S=de;do de-=pe,o[Ee+(Q>>L)+de]=xe<<24|Ct<<16|zt|0;while(de!==0);for(pe=1<<d-1;Q&pe;)pe>>=1;if(pe!==0?(Q&=pe-1,Q+=pe):Q=0,A++,--ne[d]===0){if(d===O)break;d=t[s+l[A]]}if(d>I&&(Q&ye)!==fe){for(L===0&&(L=I),Ee+=S,W=d-L,H=1<<W;W+L<O&&(H-=ne[W+L],!(H<=0));)W++,H<<=1;if(Y+=1<<W,a===LENS$1&&Y>ENOUGH_LENS$1||a===DISTS$1&&Y>ENOUGH_DISTS$1)return 1;fe=Q&ye,o[fe]=I<<24|W<<16|Ee-n|0}}return Q!==0&&(o[Ee+Q]=d-L<<24|64<<16|0),h.bits=I,0};var inftrees=inflate_table;const CODES=0,LENS=1,DISTS=2,{Z_FINISH:Z_FINISH$1,Z_BLOCK,Z_TREES,Z_OK:Z_OK$1,Z_STREAM_END:Z_STREAM_END$1,Z_NEED_DICT:Z_NEED_DICT$1,Z_STREAM_ERROR:Z_STREAM_ERROR$1,Z_DATA_ERROR:Z_DATA_ERROR$1,Z_MEM_ERROR:Z_MEM_ERROR$1,Z_BUF_ERROR,Z_DEFLATED}=constants$2,HEAD=16180,FLAGS=16181,TIME=16182,OS=16183,EXLEN=16184,EXTRA=16185,NAME=16186,COMMENT=16187,HCRC=16188,DICTID=16189,DICT=16190,TYPE=16191,TYPEDO=16192,STORED=16193,COPY_=16194,COPY=16195,TABLE=16196,LENLENS=16197,CODELENS=16198,LEN_=16199,LEN=16200,LENEXT=16201,DIST=16202,DISTEXT=16203,MATCH=16204,LIT=16205,CHECK=16206,LENGTH=16207,DONE=16208,BAD=16209,MEM=16210,SYNC=16211,ENOUGH_LENS=852,ENOUGH_DISTS=592,MAX_WBITS=15,DEF_WBITS=MAX_WBITS,zswap32=a=>(a>>>24&255)+(a>>>8&65280)+((a&65280)<<8)+((a&255)<<24);function InflateState(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const inflateStateCheck=a=>{if(!a)return 1;const t=a.state;return!t||t.strm!==a||t.mode<HEAD||t.mode>SYNC?1:0},inflateResetKeep=a=>{if(inflateStateCheck(a))return Z_STREAM_ERROR$1;const t=a.state;return a.total_in=a.total_out=t.total=0,a.msg="",t.wrap&&(a.adler=t.wrap&1),t.mode=HEAD,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(ENOUGH_LENS),t.distcode=t.distdyn=new Int32Array(ENOUGH_DISTS),t.sane=1,t.back=-1,Z_OK$1},inflateReset=a=>{if(inflateStateCheck(a))return Z_STREAM_ERROR$1;const t=a.state;return t.wsize=0,t.whave=0,t.wnext=0,inflateResetKeep(a)},inflateReset2=(a,t)=>{let s;if(inflateStateCheck(a))return Z_STREAM_ERROR$1;const r=a.state;return t<0?(s=0,t=-t):(s=(t>>4)+5,t<48&&(t&=15)),t&&(t<8||t>15)?Z_STREAM_ERROR$1:(r.window!==null&&r.wbits!==t&&(r.window=null),r.wrap=s,r.wbits=t,inflateReset(a))},inflateInit2=(a,t)=>{if(!a)return Z_STREAM_ERROR$1;const s=new InflateState;a.state=s,s.strm=a,s.window=null,s.mode=HEAD;const r=inflateReset2(a,t);return r!==Z_OK$1&&(a.state=null),r},inflateInit=a=>inflateInit2(a,DEF_WBITS);let virgin=!0,lenfix,distfix;const fixedtables=a=>{if(virgin){lenfix=new Int32Array(512),distfix=new Int32Array(32);let t=0;for(;t<144;)a.lens[t++]=8;for(;t<256;)a.lens[t++]=9;for(;t<280;)a.lens[t++]=7;for(;t<288;)a.lens[t++]=8;for(inftrees(LENS,a.lens,0,288,lenfix,0,a.work,{bits:9}),t=0;t<32;)a.lens[t++]=5;inftrees(DISTS,a.lens,0,32,distfix,0,a.work,{bits:5}),virgin=!1}a.lencode=lenfix,a.lenbits=9,a.distcode=distfix,a.distbits=5},updatewindow=(a,t,s,r)=>{let o;const n=a.state;return n.window===null&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new Uint8Array(n.wsize)),r>=n.wsize?(n.window.set(t.subarray(s-n.wsize,s),0),n.wnext=0,n.whave=n.wsize):(o=n.wsize-n.wnext,o>r&&(o=r),n.window.set(t.subarray(s-r,s-r+o),n.wnext),r-=o,r?(n.window.set(t.subarray(s-r,s),0),n.wnext=r,n.whave=n.wsize):(n.wnext+=o,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=o))),0},inflate$2=(a,t)=>{let s,r,o,n,l,h,g,d,A,S,O,I,W,L,H=0,Y,Q,pe,de,fe,ye,Ee,Le;const Z=new Uint8Array(4);let ne,Ke;const _t=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(inflateStateCheck(a)||!a.output||!a.input&&a.avail_in!==0)return Z_STREAM_ERROR$1;s=a.state,s.mode===TYPE&&(s.mode=TYPEDO),l=a.next_out,o=a.output,g=a.avail_out,n=a.next_in,r=a.input,h=a.avail_in,d=s.hold,A=s.bits,S=h,O=g,Le=Z_OK$1;e:for(;;)switch(s.mode){case HEAD:if(s.wrap===0){s.mode=TYPEDO;break}for(;A<16;){if(h===0)break e;h--,d+=r[n++]<<A,A+=8}if(s.wrap&2&&d===35615){s.wbits===0&&(s.wbits=15),s.check=0,Z[0]=d&255,Z[1]=d>>>8&255,s.check=crc32_1(s.check,Z,2,0),d=0,A=0,s.mode=FLAGS;break}if(s.head&&(s.head.done=!1),!(s.wrap&1)||(((d&255)<<8)+(d>>8))%31){a.msg="incorrect header check",s.mode=BAD;break}if((d&15)!==Z_DEFLATED){a.msg="unknown compression method",s.mode=BAD;break}if(d>>>=4,A-=4,Ee=(d&15)+8,s.wbits===0&&(s.wbits=Ee),Ee>15||Ee>s.wbits){a.msg="invalid window size",s.mode=BAD;break}s.dmax=1<<s.wbits,s.flags=0,a.adler=s.check=1,s.mode=d&512?DICTID:TYPE,d=0,A=0;break;case FLAGS:for(;A<16;){if(h===0)break e;h--,d+=r[n++]<<A,A+=8}if(s.flags=d,(s.flags&255)!==Z_DEFLATED){a.msg="unknown compression method",s.mode=BAD;break}if(s.flags&57344){a.msg="unknown header flags set",s.mode=BAD;break}s.head&&(s.head.text=d>>8&1),s.flags&512&&s.wrap&4&&(Z[0]=d&255,Z[1]=d>>>8&255,s.check=crc32_1(s.check,Z,2,0)),d=0,A=0,s.mode=TIME;case TIME:for(;A<32;){if(h===0)break e;h--,d+=r[n++]<<A,A+=8}s.head&&(s.head.time=d),s.flags&512&&s.wrap&4&&(Z[0]=d&255,Z[1]=d>>>8&255,Z[2]=d>>>16&255,Z[3]=d>>>24&255,s.check=crc32_1(s.check,Z,4,0)),d=0,A=0,s.mode=OS;case OS:for(;A<16;){if(h===0)break e;h--,d+=r[n++]<<A,A+=8}s.head&&(s.head.xflags=d&255,s.head.os=d>>8),s.flags&512&&s.wrap&4&&(Z[0]=d&255,Z[1]=d>>>8&255,s.check=crc32_1(s.check,Z,2,0)),d=0,A=0,s.mode=EXLEN;case EXLEN:if(s.flags&1024){for(;A<16;){if(h===0)break e;h--,d+=r[n++]<<A,A+=8}s.length=d,s.head&&(s.head.extra_len=d),s.flags&512&&s.wrap&4&&(Z[0]=d&255,Z[1]=d>>>8&255,s.check=crc32_1(s.check,Z,2,0)),d=0,A=0}else s.head&&(s.head.extra=null);s.mode=EXTRA;case EXTRA:if(s.flags&1024&&(I=s.length,I>h&&(I=h),I&&(s.head&&(Ee=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(r.subarray(n,n+I),Ee)),s.flags&512&&s.wrap&4&&(s.check=crc32_1(s.check,r,I,n)),h-=I,n+=I,s.length-=I),s.length))break e;s.length=0,s.mode=NAME;case NAME:if(s.flags&2048){if(h===0)break e;I=0;do Ee=r[n+I++],s.head&&Ee&&s.length<65536&&(s.head.name+=String.fromCharCode(Ee));while(Ee&&I<h);if(s.flags&512&&s.wrap&4&&(s.check=crc32_1(s.check,r,I,n)),h-=I,n+=I,Ee)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=COMMENT;case COMMENT:if(s.flags&4096){if(h===0)break e;I=0;do Ee=r[n+I++],s.head&&Ee&&s.length<65536&&(s.head.comment+=String.fromCharCode(Ee));while(Ee&&I<h);if(s.flags&512&&s.wrap&4&&(s.check=crc32_1(s.check,r,I,n)),h-=I,n+=I,Ee)break e}else s.head&&(s.head.comment=null);s.mode=HCRC;case HCRC:if(s.flags&512){for(;A<16;){if(h===0)break e;h--,d+=r[n++]<<A,A+=8}if(s.wrap&4&&d!==(s.check&65535)){a.msg="header crc mismatch",s.mode=BAD;break}d=0,A=0}s.head&&(s.head.hcrc=s.flags>>9&1,s.head.done=!0),a.adler=s.check=0,s.mode=TYPE;break;case DICTID:for(;A<32;){if(h===0)break e;h--,d+=r[n++]<<A,A+=8}a.adler=s.check=zswap32(d),d=0,A=0,s.mode=DICT;case DICT:if(s.havedict===0)return a.next_out=l,a.avail_out=g,a.next_in=n,a.avail_in=h,s.hold=d,s.bits=A,Z_NEED_DICT$1;a.adler=s.check=1,s.mode=TYPE;case TYPE:if(t===Z_BLOCK||t===Z_TREES)break e;case TYPEDO:if(s.last){d>>>=A&7,A-=A&7,s.mode=CHECK;break}for(;A<3;){if(h===0)break e;h--,d+=r[n++]<<A,A+=8}switch(s.last=d&1,d>>>=1,A-=1,d&3){case 0:s.mode=STORED;break;case 1:if(fixedtables(s),s.mode=LEN_,t===Z_TREES){d>>>=2,A-=2;break e}break;case 2:s.mode=TABLE;break;case 3:a.msg="invalid block type",s.mode=BAD}d>>>=2,A-=2;break;case STORED:for(d>>>=A&7,A-=A&7;A<32;){if(h===0)break e;h--,d+=r[n++]<<A,A+=8}if((d&65535)!==(d>>>16^65535)){a.msg="invalid stored block lengths",s.mode=BAD;break}if(s.length=d&65535,d=0,A=0,s.mode=COPY_,t===Z_TREES)break e;case COPY_:s.mode=COPY;case COPY:if(I=s.length,I){if(I>h&&(I=h),I>g&&(I=g),I===0)break e;o.set(r.subarray(n,n+I),l),h-=I,n+=I,g-=I,l+=I,s.length-=I;break}s.mode=TYPE;break;case TABLE:for(;A<14;){if(h===0)break e;h--,d+=r[n++]<<A,A+=8}if(s.nlen=(d&31)+257,d>>>=5,A-=5,s.ndist=(d&31)+1,d>>>=5,A-=5,s.ncode=(d&15)+4,d>>>=4,A-=4,s.nlen>286||s.ndist>30){a.msg="too many length or distance symbols",s.mode=BAD;break}s.have=0,s.mode=LENLENS;case LENLENS:for(;s.have<s.ncode;){for(;A<3;){if(h===0)break e;h--,d+=r[n++]<<A,A+=8}s.lens[_t[s.have++]]=d&7,d>>>=3,A-=3}for(;s.have<19;)s.lens[_t[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,ne={bits:s.lenbits},Le=inftrees(CODES,s.lens,0,19,s.lencode,0,s.work,ne),s.lenbits=ne.bits,Le){a.msg="invalid code lengths set",s.mode=BAD;break}s.have=0,s.mode=CODELENS;case CODELENS:for(;s.have<s.nlen+s.ndist;){for(;H=s.lencode[d&(1<<s.lenbits)-1],Y=H>>>24,Q=H>>>16&255,pe=H&65535,!(Y<=A);){if(h===0)break e;h--,d+=r[n++]<<A,A+=8}if(pe<16)d>>>=Y,A-=Y,s.lens[s.have++]=pe;else{if(pe===16){for(Ke=Y+2;A<Ke;){if(h===0)break e;h--,d+=r[n++]<<A,A+=8}if(d>>>=Y,A-=Y,s.have===0){a.msg="invalid bit length repeat",s.mode=BAD;break}Ee=s.lens[s.have-1],I=3+(d&3),d>>>=2,A-=2}else if(pe===17){for(Ke=Y+3;A<Ke;){if(h===0)break e;h--,d+=r[n++]<<A,A+=8}d>>>=Y,A-=Y,Ee=0,I=3+(d&7),d>>>=3,A-=3}else{for(Ke=Y+7;A<Ke;){if(h===0)break e;h--,d+=r[n++]<<A,A+=8}d>>>=Y,A-=Y,Ee=0,I=11+(d&127),d>>>=7,A-=7}if(s.have+I>s.nlen+s.ndist){a.msg="invalid bit length repeat",s.mode=BAD;break}for(;I--;)s.lens[s.have++]=Ee}}if(s.mode===BAD)break;if(s.lens[256]===0){a.msg="invalid code -- missing end-of-block",s.mode=BAD;break}if(s.lenbits=9,ne={bits:s.lenbits},Le=inftrees(LENS,s.lens,0,s.nlen,s.lencode,0,s.work,ne),s.lenbits=ne.bits,Le){a.msg="invalid literal/lengths set",s.mode=BAD;break}if(s.distbits=6,s.distcode=s.distdyn,ne={bits:s.distbits},Le=inftrees(DISTS,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,ne),s.distbits=ne.bits,Le){a.msg="invalid distances set",s.mode=BAD;break}if(s.mode=LEN_,t===Z_TREES)break e;case LEN_:s.mode=LEN;case LEN:if(h>=6&&g>=258){a.next_out=l,a.avail_out=g,a.next_in=n,a.avail_in=h,s.hold=d,s.bits=A,inffast(a,O),l=a.next_out,o=a.output,g=a.avail_out,n=a.next_in,r=a.input,h=a.avail_in,d=s.hold,A=s.bits,s.mode===TYPE&&(s.back=-1);break}for(s.back=0;H=s.lencode[d&(1<<s.lenbits)-1],Y=H>>>24,Q=H>>>16&255,pe=H&65535,!(Y<=A);){if(h===0)break e;h--,d+=r[n++]<<A,A+=8}if(Q&&!(Q&240)){for(de=Y,fe=Q,ye=pe;H=s.lencode[ye+((d&(1<<de+fe)-1)>>de)],Y=H>>>24,Q=H>>>16&255,pe=H&65535,!(de+Y<=A);){if(h===0)break e;h--,d+=r[n++]<<A,A+=8}d>>>=de,A-=de,s.back+=de}if(d>>>=Y,A-=Y,s.back+=Y,s.length=pe,Q===0){s.mode=LIT;break}if(Q&32){s.back=-1,s.mode=TYPE;break}if(Q&64){a.msg="invalid literal/length code",s.mode=BAD;break}s.extra=Q&15,s.mode=LENEXT;case LENEXT:if(s.extra){for(Ke=s.extra;A<Ke;){if(h===0)break e;h--,d+=r[n++]<<A,A+=8}s.length+=d&(1<<s.extra)-1,d>>>=s.extra,A-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=DIST;case DIST:for(;H=s.distcode[d&(1<<s.distbits)-1],Y=H>>>24,Q=H>>>16&255,pe=H&65535,!(Y<=A);){if(h===0)break e;h--,d+=r[n++]<<A,A+=8}if(!(Q&240)){for(de=Y,fe=Q,ye=pe;H=s.distcode[ye+((d&(1<<de+fe)-1)>>de)],Y=H>>>24,Q=H>>>16&255,pe=H&65535,!(de+Y<=A);){if(h===0)break e;h--,d+=r[n++]<<A,A+=8}d>>>=de,A-=de,s.back+=de}if(d>>>=Y,A-=Y,s.back+=Y,Q&64){a.msg="invalid distance code",s.mode=BAD;break}s.offset=pe,s.extra=Q&15,s.mode=DISTEXT;case DISTEXT:if(s.extra){for(Ke=s.extra;A<Ke;){if(h===0)break e;h--,d+=r[n++]<<A,A+=8}s.offset+=d&(1<<s.extra)-1,d>>>=s.extra,A-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){a.msg="invalid distance too far back",s.mode=BAD;break}s.mode=MATCH;case MATCH:if(g===0)break e;if(I=O-g,s.offset>I){if(I=s.offset-I,I>s.whave&&s.sane){a.msg="invalid distance too far back",s.mode=BAD;break}I>s.wnext?(I-=s.wnext,W=s.wsize-I):W=s.wnext-I,I>s.length&&(I=s.length),L=s.window}else L=o,W=l-s.offset,I=s.length;I>g&&(I=g),g-=I,s.length-=I;do o[l++]=L[W++];while(--I);s.length===0&&(s.mode=LEN);break;case LIT:if(g===0)break e;o[l++]=s.length,g--,s.mode=LEN;break;case CHECK:if(s.wrap){for(;A<32;){if(h===0)break e;h--,d|=r[n++]<<A,A+=8}if(O-=g,a.total_out+=O,s.total+=O,s.wrap&4&&O&&(a.adler=s.check=s.flags?crc32_1(s.check,o,O,l-O):adler32_1(s.check,o,O,l-O)),O=g,s.wrap&4&&(s.flags?d:zswap32(d))!==s.check){a.msg="incorrect data check",s.mode=BAD;break}d=0,A=0}s.mode=LENGTH;case LENGTH:if(s.wrap&&s.flags){for(;A<32;){if(h===0)break e;h--,d+=r[n++]<<A,A+=8}if(s.wrap&4&&d!==(s.total&4294967295)){a.msg="incorrect length check",s.mode=BAD;break}d=0,A=0}s.mode=DONE;case DONE:Le=Z_STREAM_END$1;break e;case BAD:Le=Z_DATA_ERROR$1;break e;case MEM:return Z_MEM_ERROR$1;case SYNC:default:return Z_STREAM_ERROR$1}return a.next_out=l,a.avail_out=g,a.next_in=n,a.avail_in=h,s.hold=d,s.bits=A,(s.wsize||O!==a.avail_out&&s.mode<BAD&&(s.mode<CHECK||t!==Z_FINISH$1))&&updatewindow(a,a.output,a.next_out,O-a.avail_out),S-=a.avail_in,O-=a.avail_out,a.total_in+=S,a.total_out+=O,s.total+=O,s.wrap&4&&O&&(a.adler=s.check=s.flags?crc32_1(s.check,o,O,a.next_out-O):adler32_1(s.check,o,O,a.next_out-O)),a.data_type=s.bits+(s.last?64:0)+(s.mode===TYPE?128:0)+(s.mode===LEN_||s.mode===COPY_?256:0),(S===0&&O===0||t===Z_FINISH$1)&&Le===Z_OK$1&&(Le=Z_BUF_ERROR),Le},inflateEnd=a=>{if(inflateStateCheck(a))return Z_STREAM_ERROR$1;let t=a.state;return t.window&&(t.window=null),a.state=null,Z_OK$1},inflateGetHeader=(a,t)=>{if(inflateStateCheck(a))return Z_STREAM_ERROR$1;const s=a.state;return s.wrap&2?(s.head=t,t.done=!1,Z_OK$1):Z_STREAM_ERROR$1},inflateSetDictionary=(a,t)=>{const s=t.length;let r,o,n;return inflateStateCheck(a)||(r=a.state,r.wrap!==0&&r.mode!==DICT)?Z_STREAM_ERROR$1:r.mode===DICT&&(o=1,o=adler32_1(o,t,s,0),o!==r.check)?Z_DATA_ERROR$1:(n=updatewindow(a,t,s,s),n?(r.mode=MEM,Z_MEM_ERROR$1):(r.havedict=1,Z_OK$1))};var inflateReset_1=inflateReset,inflateReset2_1=inflateReset2,inflateResetKeep_1=inflateResetKeep,inflateInit_1=inflateInit,inflateInit2_1=inflateInit2,inflate_2$1=inflate$2,inflateEnd_1=inflateEnd,inflateGetHeader_1=inflateGetHeader,inflateSetDictionary_1=inflateSetDictionary,inflateInfo="pako inflate (from Nodeca project)",inflate_1$2={inflateReset:inflateReset_1,inflateReset2:inflateReset2_1,inflateResetKeep:inflateResetKeep_1,inflateInit:inflateInit_1,inflateInit2:inflateInit2_1,inflate:inflate_2$1,inflateEnd:inflateEnd_1,inflateGetHeader:inflateGetHeader_1,inflateSetDictionary:inflateSetDictionary_1,inflateInfo};function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var gzheader=GZheader;const toString=Object.prototype.toString,{Z_NO_FLUSH,Z_FINISH,Z_OK,Z_STREAM_END,Z_NEED_DICT,Z_STREAM_ERROR,Z_DATA_ERROR,Z_MEM_ERROR}=constants$2;function Inflate$1(a){this.options=common.assign({chunkSize:1024*64,windowBits:15,to:""},a||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(a&&a.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let s=inflate_1$2.inflateInit2(this.strm,t.windowBits);if(s!==Z_OK)throw new Error(messages[s]);if(this.header=new gzheader,inflate_1$2.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=strings.string2buf(t.dictionary):toString.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(s=inflate_1$2.inflateSetDictionary(this.strm,t.dictionary),s!==Z_OK)))throw new Error(messages[s])}Inflate$1.prototype.push=function(a,t){const s=this.strm,r=this.options.chunkSize,o=this.options.dictionary;let n,l,h;if(this.ended)return!1;for(t===~~t?l=t:l=t===!0?Z_FINISH:Z_NO_FLUSH,toString.call(a)==="[object ArrayBuffer]"?s.input=new Uint8Array(a):s.input=a,s.next_in=0,s.avail_in=s.input.length;;){for(s.avail_out===0&&(s.output=new Uint8Array(r),s.next_out=0,s.avail_out=r),n=inflate_1$2.inflate(s,l),n===Z_NEED_DICT&&o&&(n=inflate_1$2.inflateSetDictionary(s,o),n===Z_OK?n=inflate_1$2.inflate(s,l):n===Z_DATA_ERROR&&(n=Z_NEED_DICT));s.avail_in>0&&n===Z_STREAM_END&&s.state.wrap>0&&a[s.next_in]!==0;)inflate_1$2.inflateReset(s),n=inflate_1$2.inflate(s,l);switch(n){case Z_STREAM_ERROR:case Z_DATA_ERROR:case Z_NEED_DICT:case Z_MEM_ERROR:return this.onEnd(n),this.ended=!0,!1}if(h=s.avail_out,s.next_out&&(s.avail_out===0||n===Z_STREAM_END))if(this.options.to==="string"){let g=strings.utf8border(s.output,s.next_out),d=s.next_out-g,A=strings.buf2string(s.output,g);s.next_out=d,s.avail_out=r-d,d&&s.output.set(s.output.subarray(g,g+d),0),this.onData(A)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(!(n===Z_OK&&h===0)){if(n===Z_STREAM_END)return n=inflate_1$2.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,!0;if(s.avail_in===0)break}}return!0};Inflate$1.prototype.onData=function(a){this.chunks.push(a)};Inflate$1.prototype.onEnd=function(a){a===Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg};function inflate$1(a,t){const s=new Inflate$1(t);if(s.push(a),s.err)throw s.msg||messages[s.err];return s.result}function inflateRaw$1(a,t){return t=t||{},t.raw=!0,inflate$1(a,t)}var Inflate_1$1=Inflate$1,inflate_2=inflate$1,inflateRaw_1$1=inflateRaw$1,ungzip$1=inflate$1,constants=constants$2,inflate_1$1={Inflate:Inflate_1$1,inflate:inflate_2,inflateRaw:inflateRaw_1$1,ungzip:ungzip$1,constants};const{Deflate,deflate,deflateRaw,gzip}=deflate_1$1,{Inflate,inflate,inflateRaw,ungzip}=inflate_1$1;var Deflate_1=Deflate,deflate_1=deflate,deflateRaw_1=deflateRaw,gzip_1=gzip,Inflate_1=Inflate,inflate_1=inflate,inflateRaw_1=inflateRaw,ungzip_1=ungzip,constants_1=constants$2,pako={Deflate:Deflate_1,deflate:deflate_1,deflateRaw:deflateRaw_1,gzip:gzip_1,Inflate:Inflate_1,inflate:inflate_1,inflateRaw:inflateRaw_1,ungzip:ungzip_1,constants:constants_1};const compressString=a=>{const t=new Uint8Array(a.split("").map(r=>r.charCodeAt(0))),s=pako.deflate(t);return btoa(String.fromCharCode.apply(null,[...s]))},decompressString=a=>{try{const t=new Uint8Array(atob(a).split("").map(r=>r.charCodeAt(0))),s=pako.inflate(t);return String.fromCharCode.apply(null,[...s])}catch{return null}},toPropertyPuzzle=a=>({board:a.board,stateProperty:new Property(a.state)}),serializePuzzle=a=>({version:1,board:serializeBoard(a.board),state:a.stateProperty.value.serializeState(a.board)}),deserializePuzzle=a=>{if(a.version!==1)throw new Error(`Unsupported puzzle version: ${a.version}`);const t=deserializeBoard(a.board),s=deserializeState(t,a.state);return new BasicPuzzle(t,s)},puzzleToCompressedString=a=>{const t=serializePuzzle(a);return compressString(JSON.stringify(t))},puzzleFromCompressedString=a=>{try{const t=JSON.parse(decompressString(a));return deserializePuzzle(t)}catch(t){return console.error(t),null}};var C_MINISAT;C_MINISAT=function(){var module={},require=function(){},process={argv:["node","minisat"],on:function(){},stdout:{write:function(a){console.log("MINISAT-out:",a.replace(/\n$/,""))}},stderr:{write:function(a){console.log("MINISAT-err:",a.replace(/\n$/,""))}}},Module;Module||(Module=(typeof Module<"u"?Module:null)||{});var moduleOverrides={};for(var key in Module)Module.hasOwnProperty(key)&&(moduleOverrides[key]=Module[key]);var ENVIRONMENT_IS_NODE=typeof process=="object"&&typeof require=="function",ENVIRONMENT_IS_WORKER=typeof importScripts=="function",ENVIRONMENT_IS_SHELL=!ENVIRONMENT_IS_NODE&&!ENVIRONMENT_IS_WORKER;if(ENVIRONMENT_IS_NODE){Module.print||(Module.print=function(t){process.stdout.write(t+`
`)}),Module.printErr||(Module.printErr=function(t){process.stderr.write(t+`
`)});var nodeFS=require(),nodePath=require();Module.read=function(t,s){t=nodePath.normalize(t);var r=nodeFS.readFileSync(t);return!r&&t!=nodePath.resolve(t)&&(t=path.join(__dirname,"..","src",t),r=nodeFS.readFileSync(t)),r&&!s&&(r=r.toString()),r},Module.readBinary=function(t){return Module.read(t,!0)},Module.load=function(t){globalEval(read(t))},process.argv.length>1?Module.thisProgram=process.argv[1].replace(/\\/g,"/"):Module.thisProgram="unknown-program",Module.arguments=process.argv.slice(2),typeof module<"u"&&(module.exports=Module),process.on("uncaughtException",function(a){if(!(a instanceof ExitStatus))throw a})}else if(ENVIRONMENT_IS_SHELL)Module.print||(Module.print=print),typeof printErr<"u"&&(Module.printErr=printErr),typeof read<"u"?Module.read=read:Module.read=function(){throw"no read() available (jsc?)"},Module.readBinary=function(t){if(typeof readbuffer=="function")return new Uint8Array(readbuffer(t));var s=read(t,"binary");return assert(typeof s=="object"),s},typeof scriptArgs<"u"?Module.arguments=scriptArgs:typeof arguments<"u"&&(Module.arguments=arguments),this.Module=Module;else if(ENVIRONMENT_IS_WORKER){if(Module.read=function(t){var s=new XMLHttpRequest;return s.open("GET",t,!1),s.send(null),s.responseText},typeof arguments<"u"&&(Module.arguments=arguments),typeof console<"u")Module.print||(Module.print=function(t){console.log(t)}),Module.printErr||(Module.printErr=function(t){console.log(t)});else{var TRY_USE_DUMP=!1;Module.print||(Module.print=TRY_USE_DUMP&&typeof dump<"u"?function(a){dump(a)}:function(a){})}Module.load=importScripts}else throw"Unknown runtime environment. Where are we?";function globalEval(a){eval.call(null,a)}!Module.load&&Module.read&&(Module.load=function(t){globalEval(Module.read(t))}),Module.print||(Module.print=function(){}),Module.printErr||(Module.printErr=Module.print),Module.arguments||(Module.arguments=[]),Module.thisProgram||(Module.thisProgram="./this.program"),Module.print=Module.print,Module.printErr=Module.printErr,Module.preRun=[],Module.postRun=[];for(var key in moduleOverrides)moduleOverrides.hasOwnProperty(key)&&(Module[key]=moduleOverrides[key]);var Runtime={setTempRet0:function(a){tempRet0=a},getTempRet0:function(){return tempRet0},stackSave:function(){return STACKTOP},stackRestore:function(a){STACKTOP=a},getNativeTypeSize:function(a){switch(a){case"i1":case"i8":return 1;case"i16":return 2;case"i32":return 4;case"i64":return 8;case"float":return 4;case"double":return 8;default:{if(a[a.length-1]==="*")return Runtime.QUANTUM_SIZE;if(a[0]==="i"){var t=parseInt(a.substr(1));return assert(t%8===0),t/8}else return 0}}},getNativeFieldSize:function(a){return Math.max(Runtime.getNativeTypeSize(a),Runtime.QUANTUM_SIZE)},STACK_ALIGN:16,getAlignSize:function(a,t,s){return!s&&(a=="i64"||a=="double")?8:a?Math.min(t||(a?Runtime.getNativeFieldSize(a):0),Runtime.QUANTUM_SIZE):Math.min(t,8)},dynCall:function(a,t,s){return s&&s.length?(s.splice||(s=Array.prototype.slice.call(s)),s.splice(0,0,t),Module["dynCall_"+a].apply(null,s)):Module["dynCall_"+a].call(null,t)},functionPointers:[],addFunction:function(a){for(var t=0;t<Runtime.functionPointers.length;t++)if(!Runtime.functionPointers[t])return Runtime.functionPointers[t]=a,2*(1+t);throw"Finished up all reserved function pointers. Use a higher value for RESERVED_FUNCTION_POINTERS."},removeFunction:function(a){Runtime.functionPointers[(a-2)/2]=null},getAsmConst:function(code,numArgs){Runtime.asmConstCache||(Runtime.asmConstCache={});var func=Runtime.asmConstCache[code];if(func)return func;for(var args=[],i=0;i<numArgs;i++)args.push("$"+i);var source=Pointer_stringify(code);source[0]==='"'&&(source.indexOf('"',1)===source.length-1?source=source.substr(1,source.length-2):abort("invalid EM_ASM input |"+source+"|. Please use EM_ASM(..code..) (no quotes) or EM_ASM({ ..code($0).. }, input) (to input values)"));try{var evalled=eval("(function(Module, FS) { return function("+args.join(",")+"){ "+source+" } })")(Module,typeof FS<"u"?FS:null)}catch(a){throw Module.printErr("error in executing inline EM_ASM code: "+a+` on: 

`+source+`

with args |`+args+"| (make sure to use the right one out of EM_ASM, EM_ASM_ARGS, etc.)"),a}return Runtime.asmConstCache[code]=evalled},warnOnce:function(a){Runtime.warnOnce.shown||(Runtime.warnOnce.shown={}),Runtime.warnOnce.shown[a]||(Runtime.warnOnce.shown[a]=1,Module.printErr(a))},funcWrappers:{},getFuncWrapper:function(a,t){assert(t),Runtime.funcWrappers[t]||(Runtime.funcWrappers[t]={});var s=Runtime.funcWrappers[t];return s[a]||(s[a]=function(){return Runtime.dynCall(t,a,arguments)}),s[a]},UTF8Processor:function(){var a=[],t=0;this.processCChar=function(s){if(s=s&255,a.length==0)return s&128?(a.push(s),(s&224)==192?t=1:(s&240)==224?t=2:t=3,""):String.fromCharCode(s);if(t&&(a.push(s),t--,t>0))return"";var r=a[0],o=a[1],n=a[2],l=a[3],h;if(a.length==2)h=String.fromCharCode((r&31)<<6|o&63);else if(a.length==3)h=String.fromCharCode((r&15)<<12|(o&63)<<6|n&63);else{var g=(r&7)<<18|(o&63)<<12|(n&63)<<6|l&63;h=String.fromCharCode(((g-65536)/1024|0)+55296,(g-65536)%1024+56320)}return a.length=0,h},this.processJSString=function(r){r=unescape(encodeURIComponent(r));for(var o=[],n=0;n<r.length;n++)o.push(r.charCodeAt(n));return o}},getCompilerSetting:function(a){throw"You must build with -s RETAIN_COMPILER_SETTINGS=1 for Runtime.getCompilerSetting or emscripten_get_compiler_setting to work"},stackAlloc:function(a){var t=STACKTOP;return STACKTOP=STACKTOP+a|0,STACKTOP=STACKTOP+15&-16,t},staticAlloc:function(a){var t=STATICTOP;return STATICTOP=STATICTOP+a|0,STATICTOP=STATICTOP+15&-16,t},dynamicAlloc:function(a){var t=DYNAMICTOP;return DYNAMICTOP=DYNAMICTOP+a|0,DYNAMICTOP=DYNAMICTOP+15&-16,DYNAMICTOP>=TOTAL_MEMORY&&enlargeMemory(),t},alignMemory:function(a,t){var s=a=Math.ceil(a/(t||16))*(t||16);return s},makeBigInt:function(a,t,s){var r=s?+(a>>>0)+ +(t>>>0)*4294967296:+(a>>>0)+ +(t|0)*4294967296;return r},GLOBAL_BASE:8,QUANTUM_SIZE:4,__dummy__:0};Module.Runtime=Runtime;var ABORT=!1,tempDouble,tempI64,tempRet0;function assert(a,t){a||abort("Assertion failed: "+t)}function getCFunc(ident){var func=Module["_"+ident];if(!func)try{func=eval("_"+ident)}catch(a){}return assert(func,"Cannot call unknown function "+ident+" (perhaps LLVM optimizations or closure removed it?)"),func}var cwrap,ccall;(function(){var JSfuncs={stackSave:function(){Runtime.stackSave()},stackRestore:function(){Runtime.stackRestore()},arrayToC:function(a){var t=Runtime.stackAlloc(a.length);return writeArrayToMemory(a,t),t},stringToC:function(a){var t=0;return a!=null&&a!==0&&(t=Runtime.stackAlloc((a.length<<2)+1),writeStringToMemory(a,t)),t}},toC={string:JSfuncs.stringToC,array:JSfuncs.arrayToC};ccall=function(t,s,r,o){var n=getCFunc(t),l=[],h=0;if(o)for(var g=0;g<o.length;g++){var d=toC[r[g]];d?(h===0&&(h=Runtime.stackSave()),l[g]=d(o[g])):l[g]=o[g]}var A=n.apply(null,l);return s==="string"&&(A=Pointer_stringify(A)),h!==0&&Runtime.stackRestore(h),A};var sourceRegex=/^function\s*\(([^)]*)\)\s*{\s*([^*]*?)[\s;]*(?:return\s*(.*?)[;\s]*)?}$/;function parseJSFunc(a){var t=a.toString().match(sourceRegex).slice(1);return{arguments:t[0],body:t[1],returnValue:t[2]}}var JSsource={};for(var fun in JSfuncs)JSfuncs.hasOwnProperty(fun)&&(JSsource[fun]=parseJSFunc(JSfuncs[fun]));cwrap=function cwrap(ident,returnType,argTypes){argTypes=argTypes||[];var cfunc=getCFunc(ident),numericArgs=argTypes.every(function(a){return a==="number"}),numericRet=returnType!=="string";if(numericRet&&numericArgs)return cfunc;var argNames=argTypes.map(function(a,t){return"$"+t}),funcstr="(function("+argNames.join(",")+") {",nargs=argTypes.length;if(!numericArgs){funcstr+="var stack = "+JSsource.stackSave.body+";";for(var i=0;i<nargs;i++){var arg=argNames[i],type=argTypes[i];if(type!=="number"){var convertCode=JSsource[type+"ToC"];funcstr+="var "+convertCode.arguments+" = "+arg+";",funcstr+=convertCode.body+";",funcstr+=arg+"="+convertCode.returnValue+";"}}}var cfuncname=parseJSFunc(function(){return cfunc}).returnValue;if(funcstr+="var ret = "+cfuncname+"("+argNames.join(",")+");",!numericRet){var strgfy=parseJSFunc(function(){return Pointer_stringify}).returnValue;funcstr+="ret = "+strgfy+"(ret);"}return numericArgs||(funcstr+=JSsource.stackRestore.body.replace("()","(stack)")+";"),funcstr+="return ret})",eval(funcstr)}})(),Module.cwrap=cwrap,Module.ccall=ccall;function setValue(a,t,s,r){switch(s=s||"i8",s.charAt(s.length-1)==="*"&&(s="i32"),s){case"i1":HEAP8[a>>0]=t;break;case"i8":HEAP8[a>>0]=t;break;case"i16":HEAP16[a>>1]=t;break;case"i32":HEAP32[a>>2]=t;break;case"i64":tempI64=[t>>>0,(tempDouble=t,+Math_abs(tempDouble)>=1?tempDouble>0?(Math_min(+Math_floor(tempDouble/4294967296),4294967295)|0)>>>0:~~+Math_ceil((tempDouble-+(~~tempDouble>>>0))/4294967296)>>>0:0)],HEAP32[a>>2]=tempI64[0],HEAP32[a+4>>2]=tempI64[1];break;case"float":HEAPF32[a>>2]=t;break;case"double":HEAPF64[a>>3]=t;break;default:abort("invalid type for setValue: "+s)}}Module.setValue=setValue;function getValue(a,t,s){switch(t=t||"i8",t.charAt(t.length-1)==="*"&&(t="i32"),t){case"i1":return HEAP8[a>>0];case"i8":return HEAP8[a>>0];case"i16":return HEAP16[a>>1];case"i32":return HEAP32[a>>2];case"i64":return HEAP32[a>>2];case"float":return HEAPF32[a>>2];case"double":return HEAPF64[a>>3];default:abort("invalid type for setValue: "+t)}return null}Module.getValue=getValue;var ALLOC_NORMAL=0,ALLOC_STACK=1,ALLOC_STATIC=2,ALLOC_DYNAMIC=3,ALLOC_NONE=4;Module.ALLOC_NORMAL=ALLOC_NORMAL,Module.ALLOC_STACK=ALLOC_STACK,Module.ALLOC_STATIC=ALLOC_STATIC,Module.ALLOC_DYNAMIC=ALLOC_DYNAMIC,Module.ALLOC_NONE=ALLOC_NONE;function allocate(a,t,s,r){var o,n;typeof a=="number"?(o=!0,n=a):(o=!1,n=a.length);var l=typeof t=="string"?t:null,h;if(s==ALLOC_NONE?h=r:h=[_malloc,Runtime.stackAlloc,Runtime.staticAlloc,Runtime.dynamicAlloc][s===void 0?ALLOC_STATIC:s](Math.max(n,l?1:t.length)),o){var r=h,g;for(assert((h&3)==0),g=h+(n&-4);r<g;r+=4)HEAP32[r>>2]=0;for(g=h+n;r<g;)HEAP8[r++>>0]=0;return h}if(l==="i8")return a.subarray||a.slice?HEAPU8.set(a,h):HEAPU8.set(new Uint8Array(a),h),h;for(var d=0,A,S,O;d<n;){var I=a[d];if(typeof I=="function"&&(I=Runtime.getFunctionIndex(I)),A=l||t[d],A===0){d++;continue}A=="i64"&&(A="i32"),setValue(h+d,I,A),O!==A&&(S=Runtime.getNativeTypeSize(A),O=A),d+=S}return h}Module.allocate=allocate;function Pointer_stringify(a,t){if(t===0||!a)return"";for(var s=!1,r,o=0;;){if(r=HEAPU8[a+o>>0],r>=128)s=!0;else if(r==0&&!t)break;if(o++,t&&o==t)break}t||(t=o);var n="";if(!s){for(var l=1024,h;t>0;)h=String.fromCharCode.apply(String,HEAPU8.subarray(a,a+Math.min(t,l))),n=n?n+h:h,a+=l,t-=l;return n}var g=new Runtime.UTF8Processor;for(o=0;o<t;o++)r=HEAPU8[a+o>>0],n+=g.processCChar(r);return n}Module.Pointer_stringify=Pointer_stringify;function UTF16ToString(a){for(var t=0,s="";;){var r=HEAP16[a+t*2>>1];if(r==0)return s;++t,s+=String.fromCharCode(r)}}Module.UTF16ToString=UTF16ToString;function stringToUTF16(a,t){for(var s=0;s<a.length;++s){var r=a.charCodeAt(s);HEAP16[t+s*2>>1]=r}HEAP16[t+a.length*2>>1]=0}Module.stringToUTF16=stringToUTF16;function UTF32ToString(a){for(var t=0,s="";;){var r=HEAP32[a+t*4>>2];if(r==0)return s;if(++t,r>=65536){var o=r-65536;s+=String.fromCharCode(55296|o>>10,56320|o&1023)}else s+=String.fromCharCode(r)}}Module.UTF32ToString=UTF32ToString;function stringToUTF32(a,t){for(var s=0,r=0;r<a.length;++r){var o=a.charCodeAt(r);if(o>=55296&&o<=57343){var n=a.charCodeAt(++r);o=65536+((o&1023)<<10)|n&1023}HEAP32[t+s*4>>2]=o,++s}HEAP32[t+s*4>>2]=0}Module.stringToUTF32=stringToUTF32;function demangle(a){var t=!!Module.___cxa_demangle;if(t)try{var s=_malloc(a.length);writeStringToMemory(a.substr(1),s);var r=_malloc(4),o=Module.___cxa_demangle(s,0,0,r);if(getValue(r,"i32")===0&&o)return Pointer_stringify(o)}catch{}finally{s&&_free(s),r&&_free(r),o&&_free(o)}var n=3,l={v:"void",b:"bool",c:"char",s:"short",i:"int",l:"long",f:"float",d:"double",w:"wchar_t",a:"signed char",h:"unsigned char",t:"unsigned short",j:"unsigned int",m:"unsigned long",x:"long long",y:"unsigned long long",z:"..."},h=[],g=!0;function d(){n++,a[n]==="K"&&n++;for(var O=[];a[n]!=="E";){if(a[n]==="S"){n++;var I=a.indexOf("_",n),W=a.substring(n,I)||0;O.push(h[W]||"?"),n=I+1;continue}if(a[n]==="C"){O.push(O[O.length-1]),n+=2;continue}var L=parseInt(a.substr(n)),H=L.toString().length;if(!L||!H){n--;break}var Y=a.substr(n+H,L);O.push(Y),h.push(Y),n+=H+L}return n++,O}function A(O,I,W){I=I||1/0;var L="",H=[];function Y(){return"("+H.join(", ")+")"}var Q;if(a[n]==="N"){if(Q=d().join("::"),I--,I===0)return O?[Q]:Q}else{(a[n]==="K"||g&&a[n]==="L")&&n++;var pe=parseInt(a.substr(n));if(pe){var de=pe.toString().length;Q=a.substr(n+de,pe),n+=de+pe}}if(g=!1,a[n]==="I"){n++;var fe=A(!0),ye=A(!0,1,!0);L+=ye[0]+" "+Q+"<"+fe.join(", ")+">"}else L=Q;e:for(;n<a.length&&I-- >0;){var Ee=a[n++];if(Ee in l)H.push(l[Ee]);else switch(Ee){case"P":H.push(A(!0,1,!0)[0]+"*");break;case"R":H.push(A(!0,1,!0)[0]+"&");break;case"L":{n++;var Le=a.indexOf("E",n),pe=Le-n;H.push(a.substr(n,pe)),n+=pe+2;break}case"A":{var pe=parseInt(a.substr(n));if(n+=pe.toString().length,a[n]!=="_")throw"?";n++,H.push(A(!0,1,!0)[0]+" ["+pe+"]");break}case"E":break e;default:L+="?"+Ee;break e}}return!W&&H.length===1&&H[0]==="void"&&(H=[]),O?(L&&H.push(L+"?"),H):L+Y()}var S=a;try{if(a=="Object._main"||a=="_main")return"main()";if(typeof a=="number"&&(a=Pointer_stringify(a)),a[0]!=="_"||a[1]!=="_"||a[2]!=="Z")return a;switch(a[3]){case"n":return"operator new()";case"d":return"operator delete()"}S=A()}catch{S+="?"}return S.indexOf("?")>=0&&!t&&Runtime.warnOnce("warning: a problem occurred in builtin C++ name demangling; build with  -s DEMANGLE_SUPPORT=1  to link in libcxxabi demangling"),S}function demangleAll(a){return a.replace(/__Z[\w\d_]+/g,function(t){var s=demangle(t);return t===s?t:t+" ["+s+"]"})}function jsStackTrace(){var a=new Error;if(!a.stack){try{throw new Error(0)}catch(t){a=t}if(!a.stack)return"(no stack trace available)"}return a.stack.toString()}function stackTrace(){return demangleAll(jsStackTrace())}Module.stackTrace=stackTrace;var PAGE_SIZE=4096;function alignMemoryPage(a){return a+4095&-4096}var HEAP,HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAPF64,STATIC_BASE=0,STATICTOP=0,STACK_BASE=0,STACKTOP=0,STACK_MAX=0,DYNAMIC_BASE=0,DYNAMICTOP=0;function enlargeMemory(){abort("Cannot enlarge memory arrays. Either (1) compile with -s TOTAL_MEMORY=X with X higher than the current value "+TOTAL_MEMORY+", (2) compile with ALLOW_MEMORY_GROWTH which adjusts the size at runtime but prevents some optimizations, or (3) set Module.TOTAL_MEMORY before the program runs.")}var TOTAL_STACK=Module.TOTAL_STACK||5242880,TOTAL_MEMORY=Module.TOTAL_MEMORY||67108864;Module.FAST_MEMORY;for(var totalMemory=64*1024;totalMemory<TOTAL_MEMORY||totalMemory<2*TOTAL_STACK;)totalMemory<16*1024*1024?totalMemory*=2:totalMemory+=16*1024*1024;totalMemory!==TOTAL_MEMORY&&(Module.printErr("increasing TOTAL_MEMORY to "+totalMemory+" to be compliant with the asm.js spec"),TOTAL_MEMORY=totalMemory),assert(typeof Int32Array<"u"&&typeof Float64Array<"u"&&!!new Int32Array(1).subarray&&!!new Int32Array(1).set,"JS engine does not provide full typed array support");var buffer=new ArrayBuffer(TOTAL_MEMORY);HEAP8=new Int8Array(buffer),HEAP16=new Int16Array(buffer),HEAP32=new Int32Array(buffer),HEAPU8=new Uint8Array(buffer),HEAPU16=new Uint16Array(buffer),HEAPU32=new Uint32Array(buffer),HEAPF32=new Float32Array(buffer),HEAPF64=new Float64Array(buffer),HEAP32[0]=255,assert(HEAPU8[0]===255&&HEAPU8[3]===0,"Typed arrays 2 must be run on a little-endian system"),Module.HEAP=HEAP,Module.buffer=buffer,Module.HEAP8=HEAP8,Module.HEAP16=HEAP16,Module.HEAP32=HEAP32,Module.HEAPU8=HEAPU8,Module.HEAPU16=HEAPU16,Module.HEAPU32=HEAPU32,Module.HEAPF32=HEAPF32,Module.HEAPF64=HEAPF64;function callRuntimeCallbacks(a){for(;a.length>0;){var t=a.shift();if(typeof t=="function"){t();continue}var s=t.func;typeof s=="number"?t.arg===void 0?Runtime.dynCall("v",s):Runtime.dynCall("vi",s,[t.arg]):s(t.arg===void 0?null:t.arg)}}var __ATPRERUN__=[],__ATINIT__=[],__ATMAIN__=[],__ATEXIT__=[],__ATPOSTRUN__=[],runtimeInitialized=!1;function preRun(){if(Module.preRun)for(typeof Module.preRun=="function"&&(Module.preRun=[Module.preRun]);Module.preRun.length;)addOnPreRun(Module.preRun.shift());callRuntimeCallbacks(__ATPRERUN__)}function ensureInitRuntime(){runtimeInitialized||(runtimeInitialized=!0,callRuntimeCallbacks(__ATINIT__))}function preMain(){callRuntimeCallbacks(__ATMAIN__)}function exitRuntime(){callRuntimeCallbacks(__ATEXIT__)}function postRun(){if(Module.postRun)for(typeof Module.postRun=="function"&&(Module.postRun=[Module.postRun]);Module.postRun.length;)addOnPostRun(Module.postRun.shift());callRuntimeCallbacks(__ATPOSTRUN__)}function addOnPreRun(a){__ATPRERUN__.unshift(a)}Module.addOnPreRun=Module.addOnPreRun=addOnPreRun;function addOnInit(a){__ATINIT__.unshift(a)}Module.addOnInit=Module.addOnInit=addOnInit;function addOnPreMain(a){__ATMAIN__.unshift(a)}Module.addOnPreMain=Module.addOnPreMain=addOnPreMain;function addOnExit(a){__ATEXIT__.unshift(a)}Module.addOnExit=Module.addOnExit=addOnExit;function addOnPostRun(a){__ATPOSTRUN__.unshift(a)}Module.addOnPostRun=Module.addOnPostRun=addOnPostRun;function intArrayFromString(a,t,s){var r=new Runtime.UTF8Processor().processJSString(a);return s&&(r.length=s),t||r.push(0),r}Module.intArrayFromString=intArrayFromString;function intArrayToString(a){for(var t=[],s=0;s<a.length;s++){var r=a[s];r>255&&(r&=255),t.push(String.fromCharCode(r))}return t.join("")}Module.intArrayToString=intArrayToString;function writeStringToMemory(a,t,s){for(var r=intArrayFromString(a,s),o=0;o<r.length;){var n=r[o];HEAP8[t+o>>0]=n,o=o+1}}Module.writeStringToMemory=writeStringToMemory;function writeArrayToMemory(a,t){for(var s=0;s<a.length;s++)HEAP8[t+s>>0]=a[s]}Module.writeArrayToMemory=writeArrayToMemory;function writeAsciiToMemory(a,t,s){for(var r=0;r<a.length;r++)HEAP8[t+r>>0]=a.charCodeAt(r);s||(HEAP8[t+a.length>>0]=0)}Module.writeAsciiToMemory=writeAsciiToMemory;function unSign(a,t,s){return a>=0?a:t<=32?2*Math.abs(1<<t-1)+a:Math.pow(2,t)+a}function reSign(a,t,s){if(a<=0)return a;var r=t<=32?Math.abs(1<<t-1):Math.pow(2,t-1);return a>=r&&(t<=32||a>r)&&(a=-2*r+a),a}(!Math.imul||Math.imul(4294967295,5)!==-5)&&(Math.imul=function a(t,s){var r=t>>>16,o=t&65535,n=s>>>16,l=s&65535;return o*l+(r*l+o*n<<16)|0}),Math.imul=Math.imul;var Math_abs=Math.abs,Math_ceil=Math.ceil,Math_floor=Math.floor,Math_pow=Math.pow,Math_min=Math.min,runDependencies=0,dependenciesFulfilled=null;function addRunDependency(a){runDependencies++,Module.monitorRunDependencies&&Module.monitorRunDependencies(runDependencies)}Module.addRunDependency=addRunDependency;function removeRunDependency(a){if(runDependencies--,Module.monitorRunDependencies&&Module.monitorRunDependencies(runDependencies),runDependencies==0&&dependenciesFulfilled){var t=dependenciesFulfilled;dependenciesFulfilled=null,t()}}Module.removeRunDependency=removeRunDependency,Module.preloadedImages={},Module.preloadedAudios={},STATIC_BASE=8,STATICTOP=STATIC_BASE+5664,__ATINIT__.push({func:function(){__GLOBAL__I_a()}},{func:function(){__GLOBAL__I_a127()}}),allocate([78,55,77,105,110,105,115,97,116,50,48,79,117,116,79,102,77,101,109,111,114,121,69,120,99,101,112,116,105,111,110,69,0,0,0,0,0,0,0,0,88,18,0,0,8,0,0,0,78,55,77,105,110,105,115,97,116,54,79,112,116,105,111,110,69,0,0,0,0,0,0,0,88,18,0,0,56,0,0,0,10,32,32,32,32,32,32,32,32,37,115,10,0,0,0,0,0,0,0,0,80,0,0,0,1,0,0,0,2,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,200,0,0,0,1,0,0,0,3,0,0,0,1,0,0,0,1,0,0,0,78,55,77,105,110,105,115,97,116,49,48,66,111,111,108,79,112,116,105,111,110,69,0,0,128,18,0,0,176,0,0,0,80,0,0,0,0,0,0,0,32,32,45,37,115,44,32,45,110,111,45,37,115,0,0,0,40,100,101,102,97,117,108,116,58,32,37,115,41,10,0,0,111,110,0,0,0,0,0,0,111,102,102,0,0,0,0,0,110,111,45,0,0,0,0,0,0,0,0,0,64,1,0,0,1,0,0,0,4,0,0,0,2,0,0,0,2,0,0,0,78,55,77,105,110,105,115,97,116,57,73,110,116,79,112,116,105,111,110,69,0,0,0,0,128,18,0,0,40,1,0,0,80,0,0,0,0,0,0,0,32,32,45,37,45,49,50,115,32,61,32,37,45,56,115,32,91,0,0,0,0,0,0,0,105,109,105,110,0,0,0,0,37,52,100,0,0,0,0,0,32,46,46,32,0,0,0,0,105,109,97,120,0,0,0,0,93,32,40,100,101,102,97,117,108,116,58,32,37,100,41,10,0,0,0,0,0,0,0,0,69,82,82,79,82,33,32,118,97,108,117,101,32,60,37,115,62,32,105,115,32,116,111,111,32,108,97,114,103,101,32,102,111,114,32,111,112,116,105,111,110,32,34,37,115,34,46,10,0,0,0,0,0,0,0,0,69,82,82,79,82,33,32,118,97,108,117,101,32,60,37,115,62,32,105,115,32,116,111,111,32,115,109,97,108,108,32,102,111,114,32,111,112,116,105,111,110,32,34,37,115,34,46,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,118,97,114,45,100,101,99,97,121,0,0,0,0,0,0,0,84,104,101,32,118,97,114,105,97,98,108,101,32,97,99,116,105,118,105,116,121,32,100,101,99,97,121,32,102,97,99,116,111,114,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,99,108,97,45,100,101,99,97,121,0,0,0,0,0,0,0,84,104,101,32,99,108,97,117,115,101,32,97,99,116,105,118,105,116,121,32,100,101,99,97,121,32,102,97,99,116,111,114,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,114,110,100,45,102,114,101,113,0,0,0,0,0,0,0,0,84,104,101,32,102,114,101,113,117,101,110,99,121,32,119,105,116,104,32,119,104,105,99,104,32,116,104,101,32,100,101,99,105,115,105,111,110,32,104,101,117,114,105,115,116,105,99,32,116,114,105,101,115,32,116,111,32,99,104,111,111,115,101,32,97,32,114,97,110,100,111,109,32,118,97,114,105,97,98,108,101,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,114,110,100,45,115,101,101,100,0,0,0,0,0,0,0,0,85,115,101,100,32,98,121,32,116,104,101,32,114,97,110,100,111,109,32,118,97,114,105,97,98,108,101,32,115,101,108,101,99,116,105,111,110,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,99,99,109,105,110,45,109,111,100,101,0,0,0,0,0,0,67,111,110,116,114,111,108,115,32,99,111,110,102,108,105,99,116,32,99,108,97,117,115,101,32,109,105,110,105,109,105,122,97,116,105,111,110,32,40,48,61,110,111,110,101,44,32,49,61,98,97,115,105,99,44,32,50,61,100,101,101,112,41,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,112,104,97,115,101,45,115,97,118,105,110,103,0,0,0,0,67,111,110,116,114,111,108,115,32,116,104,101,32,108,101,118,101,108,32,111,102,32,112,104,97,115,101,32,115,97,118,105,110,103,32,40,48,61,110,111,110,101,44,32,49,61,108,105,109,105,116,101,100,44,32,50,61,102,117,108,108,41,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,114,110,100,45,105,110,105,116,0,0,0,0,0,0,0,0,82,97,110,100,111,109,105,122,101,32,116,104,101,32,105,110,105,116,105,97,108,32,97,99,116,105,118,105,116,121,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,108,117,98,121,0,0,0,0,85,115,101,32,116,104,101,32,76,117,98,121,32,114,101,115,116,97,114,116,32,115,101,113,117,101,110,99,101,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,114,102,105,114,115,116,0,0,84,104,101,32,98,97,115,101,32,114,101,115,116,97,114,116,32,105,110,116,101,114,118,97,108,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,114,105,110,99,0,0,0,0,82,101,115,116,97,114,116,32,105,110,116,101,114,118,97,108,32,105,110,99,114,101,97,115,101,32,102,97,99,116,111,114,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,103,99,45,102,114,97,99,0,84,104,101,32,102,114,97,99,116,105,111,110,32,111,102,32,119,97,115,116,101,100,32,109,101,109,111,114,121,32,97,108,108,111,119,101,100,32,98,101,102,111,114,101,32,97,32,103,97,114,98,97,103,101,32,99,111,108,108,101,99,116,105,111,110,32,105,115,32,116,114,105,103,103,101,114,101,100,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,109,105,110,45,108,101,97,114,110,116,115,0,0,0,0,0,77,105,110,105,109,117,109,32,108,101,97,114,110,116,32,99,108,97,117,115,101,32,108,105,109,105,116,0,0,0,0,0,0,0,0,0,192,7,0,0,5,0,0,0,6,0,0,0,7,0,0,0,0,0,0,0,124,32,37,57,100,32,124,32,37,55,100,32,37,56,100,32,37,56,100,32,124,32,37,56,100,32,37,56,100,32,37,54,46,48,102,32,124,32,37,54,46,51,102,32,37,37,32,124,10,0,0,0,0,0,0,0,124,32,32,71,97,114,98,97,103,101,32,99,111,108,108,101,99,116,105,111,110,58,32,32,32,37,49,50,100,32,98,121,116,101,115,32,61,62,32,37,49,50,100,32,98,121,116,101,115,32,32,32,32,32,32,32,32,32,32,32,32,32,124,10,0,0,0,0,0,0,0,0,78,55,77,105,110,105,115,97,116,54,83,111,108,118,101,114,69,0,0,0,0,0,0,0,88,18,0,0,168,7,0,0,60,98,111,111,108,62,0,0,10,32,32,32,32,32,32,32,32,37,115,10,0,0,0,0,60,105,110,116,51,50,62,0,69,82,82,79,82,33,32,118,97,108,117,101,32,60,37,115,62,32,105,115,32,116,111,111,32,108,97,114,103,101,32,102,111,114,32,111,112,116,105,111,110,32,34,37,115,34,46,10,0,0,0,0,0,0,0,0,69,82,82,79,82,33,32,118,97,108,117,101,32,60,37,115,62,32,105,115,32,116,111,111,32,115,109,97,108,108,32,102,111,114,32,111,112,116,105,111,110,32,34,37,115,34,46,10,0,0,0,0,0,0,0,0,67,79,82,69,0,0,0,0,60,100,111,117,98,108,101,62,0,0,0,0,0,0,0,0,0,0,0,0,168,8,0,0,1,0,0,0,8,0,0,0,3,0,0,0,3,0,0,0,78,55,77,105,110,105,115,97,116,49,50,68,111,117,98,108,101,79,112,116,105,111,110,69,0,0,0,0,0,0,0,0,128,18,0,0,136,8,0,0,80,0,0,0,0,0,0,0,32,32,45,37,45,49,50,115,32,61,32,37,45,56,115,32,37,99,37,52,46,50,103,32,46,46,32,37,52,46,50,103,37,99,32,40,100,101,102,97,117,108,116,58,32,37,103,41,10,0,0,0,0,0,0,0,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,91,32,83,101,97,114,99,104,32,83,116,97,116,105,115,116,105,99,115,32,93,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,0,124,32,67,111,110,102,108,105,99,116,115,32,124,32,32,32,32,32,32,32,32,32,32,79,82,73,71,73,78,65,76,32,32,32,32,32,32,32,32,32,124,32,32,32,32,32,32,32,32,32,32,76,69,65,82,78,84,32,32,32,32,32,32,32,32,32,32,124,32,80,114,111,103,114,101,115,115,32,124,0,124,32,32,32,32,32,32,32,32,32,32,32,124,32,32,32,32,86,97,114,115,32,32,67,108,97,117,115,101,115,32,76,105,116,101,114,97,108,115,32,124,32,32,32,32,76,105,109,105,116,32,32,67,108,97,117,115,101,115,32,76,105,116,47,67,108,32,124,32,32,32,32,32,32,32,32,32,32,124,0,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,97,115,121,109,109,0,0,0,83,104,114,105,110,107,32,99,108,97,117,115,101,115,32,98,121,32,97,115,121,109,109,101,116,114,105,99,32,98,114,97,110,99,104,105,110,103,46,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,114,99,104,101,99,107,0,0,67,104,101,99,107,32,105,102,32,97,32,99,108,97,117,115,101,32,105,115,32,97,108,114,101,97,100,121,32,105,109,112,108,105,101,100,46,32,40,99,111,115,116,108,121,41,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,101,108,105,109,0,0,0,0,80,101,114,102,111,114,109,32,118,97,114,105,97,98,108,101,32,101,108,105,109,105,110,97,116,105,111,110,46,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,103,114,111,119,0,0,0,0,65,108,108,111,119,32,97,32,118,97,114,105,97,98,108,101,32,101,108,105,109,105,110,97,116,105,111,110,32,115,116,101,112,32,116,111,32,103,114,111,119,32,98,121,32,97,32,110,117,109,98,101,114,32,111,102,32,99,108,97,117,115,101,115,46,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,99,108,45,108,105,109,0,0,86,97,114,105,97,98,108,101,115,32,97,114,101,32,110,111,116,32,101,108,105,109,105,110,97,116,101,100,32,105,102,32,105,116,32,112,114,111,100,117,99,101,115,32,97,32,114,101,115,111,108,118,101,110,116,32,119,105,116,104,32,97,32,108,101,110,103,116,104,32,97,98,111,118,101,32,116,104,105,115,32,108,105,109,105,116,46,32,45,49,32,109,101,97,110,115,32,110,111,32,108,105,109,105,116,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,115,117,98,45,108,105,109,0,68,111,32,110,111,116,32,99,104,101,99,107,32,105,102,32,115,117,98,115,117,109,112,116,105,111,110,32,97,103,97,105,110,115,116,32,97,32,99,108,97,117,115,101,32,108,97,114,103,101,114,32,116,104,97,110,32,116,104,105,115,46,32,45,49,32,109,101,97,110,115,32,110,111,32,108,105,109,105,116,46,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,115,105,109,112,45,103,99,45,102,114,97,99,0,0,0,0,84,104,101,32,102,114,97,99,116,105,111,110,32,111,102,32,119,97,115,116,101,100,32,109,101,109,111,114,121,32,97,108,108,111,119,101,100,32,98,101,102,111,114,101,32,97,32,103,97,114,98,97,103,101,32,99,111,108,108,101,99,116,105,111,110,32,105,115,32,116,114,105,103,103,101,114,101,100,32,100,117,114,105,110,103,32,115,105,109,112,108,105,102,105,99,97,116,105,111,110,46,0,0,0,0,0,0,0,120,14,0,0,9,0,0,0,10,0,0,0,11,0,0,0,0,0,0,0,115,117,98,115,117,109,112,116,105,111,110,32,108,101,102,116,58,32,37,49,48,100,32,40,37,49,48,100,32,115,117,98,115,117,109,101,100,44,32,37,49,48,100,32,100,101,108,101,116,101,100,32,108,105,116,101,114,97,108,115,41,13,0,0,101,108,105,109,105,110,97,116,105,111,110,32,108,101,102,116,58,32,37,49,48,100,13,0,124,32,32,69,108,105,109,105,110,97,116,101,100,32,99,108,97,117,115,101,115,58,32,32,32,32,32,37,49,48,46,50,102,32,77,98,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,124,10,0,0,0,0,124,32,32,71,97,114,98,97,103,101,32,99,111,108,108,101,99,116,105,111,110,58,32,32,32,37,49,50,100,32,98,121,116,101,115,32,61,62,32,37,49,50,100,32,98,121,116,101,115,32,32,32,32,32,32,32,32,32,32,32,32,32,124,10,0,0,0,0,0,0,0,0,78,55,77,105,110,105,115,97,116,49,48,83,105,109,112,83,111,108,118,101,114,69,0,0,128,18,0,0,96,14,0,0,192,7,0,0,0,0,0,0,60,100,111,117,98,108,101,62,0,0,0,0,0,0,0,0,60,105,110,116,51,50,62,0,83,73,77,80,0,0,0,0,60,98,111,111,108,62,0,0,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,61,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,89,79,33,0,0,0,0,0,2,0,0,0,0,0,0,0,48,15,0,0,0,0,0,0,117,110,99,97,117,103,104,116,0,0,0,0,0,0,0,0,116,101,114,109,105,110,97,116,105,110,103,32,119,105,116,104,32,37,115,32,101,120,99,101,112,116,105,111,110,32,111,102,32,116,121,112,101,32,37,115,58,32,37,115,0,0,0,0,116,101,114,109,105,110,97,116,105,110,103,32,119,105,116,104,32,37,115,32,101,120,99,101,112,116,105,111,110,32,111,102,32,116,121,112,101,32,37,115,0,0,0,0,0,0,0,0,116,101,114,109,105,110,97,116,105,110,103,32,119,105,116,104,32,37,115,32,102,111,114,101,105,103,110,32,101,120,99,101,112,116,105,111,110,0,0,0,116,101,114,109,105,110,97,116,105,110,103,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,112,116,104,114,101,97,100,95,111,110,99,101,32,102,97,105,108,117,114,101,32,105,110,32,95,95,99,120,97,95,103,101,116,95,103,108,111,98,97,108,115,95,102,97,115,116,40,41,0,0,0,0,0,0,0,0,99,97,110,110,111,116,32,99,114,101,97,116,101,32,112,116,104,114,101,97,100,32,107,101,121,32,102,111,114,32,95,95,99,120,97,95,103,101,116,95,103,108,111,98,97,108,115,40,41,0,0,0,0,0,0,0,99,97,110,110,111,116,32,122,101,114,111,32,111,117,116,32,116,104,114,101,97,100,32,118,97,108,117,101,32,102,111,114,32,95,95,99,120,97,95,103,101,116,95,103,108,111,98,97,108,115,40,41,0,0,0,0,0,0,0,0,200,16,0,0,12,0,0,0,13,0,0,0,1,0,0,0,0,0,0,0,115,116,100,58,58,98,97,100,95,97,108,108,111,99,0,0,83,116,57,98,97,100,95,97,108,108,111,99,0,0,0,0,128,18,0,0,184,16,0,0,80,17,0,0,0,0,0,0,116,101,114,109,105,110,97,116,101,95,104,97,110,100,108,101,114,32,117,110,101,120,112,101,99,116,101,100,108,121,32,114,101,116,117,114,110,101,100,0,116,101,114,109,105,110,97,116,101,95,104,97,110,100,108,101,114,32,117,110,101,120,112,101,99,116,101,100,108,121,32,116,104,114,101,119,32,97,110,32,101,120,99,101,112,116,105,111,110,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,83,116,57,101,120,99,101,112,116,105,111,110,0,0,0,0,88,18,0,0,64,17,0,0,83,116,57,116,121,112,101,95,105,110,102,111,0,0,0,0,88,18,0,0,88,17,0,0,78,49,48,95,95,99,120,120,97,98,105,118,49,49,54,95,95,115,104,105,109,95,116,121,112,101,95,105,110,102,111,69,0,0,0,0,0,0,0,0,128,18,0,0,112,17,0,0,104,17,0,0,0,0,0,0,78,49,48,95,95,99,120,120,97,98,105,118,49,49,55,95,95,99,108,97,115,115,95,116,121,112,101,95,105,110,102,111,69,0,0,0,0,0,0,0,128,18,0,0,168,17,0,0,152,17,0,0,0,0,0,0,78,49,48,95,95,99,120,120,97,98,105,118,49,49,57,95,95,112,111,105,110,116,101,114,95,116,121,112,101,95,105,110,102,111,69,0,0,0,0,0,78,49,48,95,95,99,120,120,97,98,105,118,49,49,55,95,95,112,98,97,115,101,95,116,121,112,101,95,105,110,102,111,69,0,0,0,0,0,0,0,128,18,0,0,8,18,0,0,152,17,0,0,0,0,0,0,128,18,0,0,224,17,0,0,48,18,0,0,0,0,0,0,0,0,0,0,208,17,0,0,14,0,0,0,15,0,0,0,16,0,0,0,17,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,200,18,0,0,14,0,0,0,18,0,0,0,16,0,0,0,17,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,78,49,48,95,95,99,120,120,97,98,105,118,49,50,48,95,95,115,105,95,99,108,97,115,115,95,116,121,112,101,95,105,110,102,111,69,0,0,0,0,128,18,0,0,160,18,0,0,208,17,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,1,2,3,4,5,6,7,8,9,255,255,255,255,255,255,255,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,255,255,255,255,255,255,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0,0,0,0,0,0,0,1,2,4,7,3,6,5,0,0,0,0,0,0,0,0,105,110,102,105,110,105,116,121,0,0,0,0,0,0,0,0,110,97,110,0,0,0,0,0,95,112,137,0,255,9,47,15,10,0,0,0,100,0,0,0,232,3,0,0,16,39,0,0,160,134,1,0,64,66,15,0,128,150,152,0,0,225,245,5],"i8",ALLOC_NONE,Runtime.GLOBAL_BASE);var tempDoublePtr=Runtime.alignMemory(allocate(12,"i8",ALLOC_STATIC),8);assert(tempDoublePtr%8==0);function _atexit(a,t){__ATEXIT__.unshift({func:a,arg:t})}function ___cxa_atexit(){return _atexit.apply(null,arguments)}Module._i64Subtract=_i64Subtract;var ___errno_state=0;function ___setErrNo(a){return HEAP32[___errno_state>>2]=a,a}var ERRNO_CODES={EPERM:1,ENOENT:2,ESRCH:3,EINTR:4,EIO:5,ENXIO:6,E2BIG:7,ENOEXEC:8,EBADF:9,ECHILD:10,EAGAIN:11,EWOULDBLOCK:11,ENOMEM:12,EACCES:13,EFAULT:14,ENOTBLK:15,EBUSY:16,EEXIST:17,EXDEV:18,ENODEV:19,ENOTDIR:20,EISDIR:21,EINVAL:22,ENFILE:23,EMFILE:24,ENOTTY:25,ETXTBSY:26,EFBIG:27,ENOSPC:28,ESPIPE:29,EROFS:30,EMLINK:31,EPIPE:32,EDOM:33,ERANGE:34,ENOMSG:42,EIDRM:43,ECHRNG:44,EL2NSYNC:45,EL3HLT:46,EL3RST:47,ELNRNG:48,EUNATCH:49,ENOCSI:50,EL2HLT:51,EDEADLK:35,ENOLCK:37,EBADE:52,EBADR:53,EXFULL:54,ENOANO:55,EBADRQC:56,EBADSLT:57,EDEADLOCK:35,EBFONT:59,ENOSTR:60,ENODATA:61,ETIME:62,ENOSR:63,ENONET:64,ENOPKG:65,EREMOTE:66,ENOLINK:67,EADV:68,ESRMNT:69,ECOMM:70,EPROTO:71,EMULTIHOP:72,EDOTDOT:73,EBADMSG:74,ENOTUNIQ:76,EBADFD:77,EREMCHG:78,ELIBACC:79,ELIBBAD:80,ELIBSCN:81,ELIBMAX:82,ELIBEXEC:83,ENOSYS:38,ENOTEMPTY:39,ENAMETOOLONG:36,ELOOP:40,EOPNOTSUPP:95,EPFNOSUPPORT:96,ECONNRESET:104,ENOBUFS:105,EAFNOSUPPORT:97,EPROTOTYPE:91,ENOTSOCK:88,ENOPROTOOPT:92,ESHUTDOWN:108,ECONNREFUSED:111,EADDRINUSE:98,ECONNABORTED:103,ENETUNREACH:101,ENETDOWN:100,ETIMEDOUT:110,EHOSTDOWN:112,EHOSTUNREACH:113,EINPROGRESS:115,EALREADY:114,EDESTADDRREQ:89,EMSGSIZE:90,EPROTONOSUPPORT:93,ESOCKTNOSUPPORT:94,EADDRNOTAVAIL:99,ENETRESET:102,EISCONN:106,ENOTCONN:107,ETOOMANYREFS:109,EUSERS:87,EDQUOT:122,ESTALE:116,ENOTSUP:95,ENOMEDIUM:123,EILSEQ:84,EOVERFLOW:75,ECANCELED:125,ENOTRECOVERABLE:131,EOWNERDEAD:130,ESTRPIPE:86};function _sysconf(a){switch(a){case 30:return PAGE_SIZE;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 80:case 81:case 79:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:return 200809;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 75:return 16384;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:return typeof navigator=="object"&&navigator.hardwareConcurrency||1}return ___setErrNo(ERRNO_CODES.EINVAL),-1}function __ZSt18uncaught_exceptionv(){return!!__ZSt18uncaught_exceptionv.uncaught_exception}var EXCEPTIONS={last:0,caught:[],infos:{},deAdjust:function(a){if(!a||EXCEPTIONS.infos[a])return a;for(var t in EXCEPTIONS.infos){var s=EXCEPTIONS.infos[t];if(s.adjusted===a)return t}return a},addRef:function(a){if(a){var t=EXCEPTIONS.infos[a];t.refcount++}},decRef:function(a){if(a){var t=EXCEPTIONS.infos[a];assert(t.refcount>0),t.refcount--,t.refcount===0&&(t.destructor&&Runtime.dynCall("vi",t.destructor,[a]),delete EXCEPTIONS.infos[a],___cxa_free_exception(a))}},clearRef:function(a){if(a){var t=EXCEPTIONS.infos[a];t.refcount=0}}};function ___resumeException(a){throw EXCEPTIONS.last||(EXCEPTIONS.last=a),EXCEPTIONS.clearRef(EXCEPTIONS.deAdjust(a)),a+" - Exception catching is disabled, this exception cannot be caught. Compile with -s DISABLE_EXCEPTION_CATCHING=0 or DISABLE_EXCEPTION_CATCHING=2 to catch."}function ___cxa_find_matching_catch(){var a=EXCEPTIONS.last;if(!a)return asm.setTempRet0(0),0|0;var t=EXCEPTIONS.infos[a],s=t.type;if(!s)return asm.setTempRet0(0),a|0;var r=Array.prototype.slice.call(arguments);Module.___cxa_is_pointer_type(s),___cxa_find_matching_catch.buffer||(___cxa_find_matching_catch.buffer=_malloc(4)),HEAP32[___cxa_find_matching_catch.buffer>>2]=a,a=___cxa_find_matching_catch.buffer;for(var o=0;o<r.length;o++)if(r[o]&&Module.___cxa_can_catch(r[o],s,a))return a=HEAP32[a>>2],t.adjusted=a,asm.setTempRet0(r[o]),a|0;return a=HEAP32[a>>2],asm.setTempRet0(s),a|0}function ___cxa_throw(a,t,s){throw EXCEPTIONS.infos[a]={ptr:a,adjusted:a,type:t,destructor:s,refcount:0},EXCEPTIONS.last=a,"uncaught_exception"in __ZSt18uncaught_exceptionv?__ZSt18uncaught_exceptionv.uncaught_exception++:__ZSt18uncaught_exceptionv.uncaught_exception=1,a+" - Exception catching is disabled, this exception cannot be caught. Compile with -s DISABLE_EXCEPTION_CATCHING=0 or DISABLE_EXCEPTION_CATCHING=2 to catch."}Module._memset=_memset,Module._bitshift64Shl=_bitshift64Shl;function _abort(){Module.abort()}var FS=void 0,SOCKFS=void 0;function _send(a,t,s,r){var o=SOCKFS.getSocket(a);return o?_write(a,t,s):(___setErrNo(ERRNO_CODES.EBADF),-1)}function _pwrite(a,t,s,r){var o=FS.getStream(a);if(!o)return ___setErrNo(ERRNO_CODES.EBADF),-1;try{var n=HEAP8;return FS.write(o,n,t,s,r)}catch(l){return FS.handleFSError(l),-1}}function _write(a,t,s){var r=FS.getStream(a);if(!r)return ___setErrNo(ERRNO_CODES.EBADF),-1;try{var o=HEAP8;return FS.write(r,o,t,s)}catch(n){return FS.handleFSError(n),-1}}function _fileno(a){return a=FS.getStreamFromPtr(a),a?a.fd:-1}function _fwrite(a,t,s,r){var o=s*t;if(o==0)return 0;var n=_fileno(r),l=_write(n,a,o);if(l==-1){var h=FS.getStreamFromPtr(r);return h&&(h.error=!0),0}else return l/t|0}Module._strlen=_strlen;function __reallyNegative(a){return a<0||a===0&&1/a===-1/0}function __formatString(a,t){var s=a,r=0;function o(Gt){var Mt;return Gt==="double"?Mt=(HEAP32[tempDoublePtr>>2]=HEAP32[t+r>>2],HEAP32[tempDoublePtr+4>>2]=HEAP32[t+(r+4)>>2],+HEAPF64[tempDoublePtr>>3]):Gt=="i64"?Mt=[HEAP32[t+r>>2],HEAP32[t+(r+4)>>2]]:(Gt="i32",Mt=HEAP32[t+r>>2]),r+=Runtime.getNativeFieldSize(Gt),Mt}for(var n=[],l,h,g;;){var d=s;if(l=HEAP8[s>>0],l===0)break;if(h=HEAP8[s+1>>0],l==37){var A=!1,S=!1,O=!1,I=!1,W=!1;e:for(;;){switch(h){case 43:A=!0;break;case 45:S=!0;break;case 35:O=!0;break;case 48:if(I)break e;I=!0;break;case 32:W=!0;break;default:break e}s++,h=HEAP8[s+1>>0]}var L=0;if(h==42)L=o("i32"),s++,h=HEAP8[s+1>>0];else for(;h>=48&&h<=57;)L=L*10+(h-48),s++,h=HEAP8[s+1>>0];var H=!1,Y=-1;if(h==46){if(Y=0,H=!0,s++,h=HEAP8[s+1>>0],h==42)Y=o("i32"),s++;else for(;;){var Q=HEAP8[s+1>>0];if(Q<48||Q>57)break;Y=Y*10+(Q-48),s++}h=HEAP8[s+1>>0]}Y<0&&(Y=6,H=!1);var pe;switch(String.fromCharCode(h)){case"h":var de=HEAP8[s+2>>0];de==104?(s++,pe=1):pe=2;break;case"l":var de=HEAP8[s+2>>0];de==108?(s++,pe=8):pe=4;break;case"L":case"q":case"j":pe=8;break;case"z":case"t":case"I":pe=4;break;default:pe=null}switch(pe&&s++,h=HEAP8[s+1>>0],String.fromCharCode(h)){case"d":case"i":case"u":case"o":case"x":case"X":case"p":{var fe=h==100||h==105;pe=pe||4;var g=o("i"+pe*8),ye=g,Ee;if(pe==8&&(g=Runtime.makeBigInt(g[0],g[1],h==117)),pe<=4){var Le=Math.pow(256,pe)-1;g=(fe?reSign:unSign)(g&Le,pe*8)}var Z=Math.abs(g),ne="";if(h==100||h==105)pe==8&&i64Math?Ee=i64Math.stringify(ye[0],ye[1],null):Ee=reSign(g,8*pe).toString(10);else if(h==117)pe==8&&i64Math?Ee=i64Math.stringify(ye[0],ye[1],!0):Ee=unSign(g,8*pe).toString(10),g=Math.abs(g);else if(h==111)Ee=(O?"0":"")+Z.toString(8);else if(h==120||h==88){if(ne=O&&g!=0?"0x":"",pe==8&&i64Math)if(ye[1]){Ee=(ye[1]>>>0).toString(16);for(var Ke=(ye[0]>>>0).toString(16);Ke.length<8;)Ke="0"+Ke;Ee+=Ke}else Ee=(ye[0]>>>0).toString(16);else if(g<0){g=-g,Ee=(Z-1).toString(16);for(var _t=[],xe=0;xe<Ee.length;xe++)_t.push((15-parseInt(Ee[xe],16)).toString(16));for(Ee=_t.join("");Ee.length<pe*2;)Ee="f"+Ee}else Ee=Z.toString(16);h==88&&(ne=ne.toUpperCase(),Ee=Ee.toUpperCase())}else h==112&&(Z===0?Ee="(nil)":(ne="0x",Ee=Z.toString(16)));if(H)for(;Ee.length<Y;)Ee="0"+Ee;for(g>=0&&(A?ne="+"+ne:W&&(ne=" "+ne)),Ee.charAt(0)=="-"&&(ne="-"+ne,Ee=Ee.substr(1));ne.length+Ee.length<L;)S?Ee+=" ":I?Ee="0"+Ee:ne=" "+ne;Ee=ne+Ee,Ee.split("").forEach(function(Mt){n.push(Mt.charCodeAt(0))});break}case"f":case"F":case"e":case"E":case"g":case"G":{var g=o("double"),Ee;if(isNaN(g))Ee="nan",I=!1;else if(!isFinite(g))Ee=(g<0?"-":"")+"inf",I=!1;else{var Ct=!1,zt=Math.min(Y,20);if(h==103||h==71){Ct=!0,Y=Y||1;var Je=parseInt(g.toExponential(zt).split("e")[1],10);Y>Je&&Je>=-4?(h=(h==103?"f":"F").charCodeAt(0),Y-=Je+1):(h=(h==103?"e":"E").charCodeAt(0),Y--),zt=Math.min(Y,20)}h==101||h==69?(Ee=g.toExponential(zt),/[eE][-+]\d$/.test(Ee)&&(Ee=Ee.slice(0,-1)+"0"+Ee.slice(-1))):(h==102||h==70)&&(Ee=g.toFixed(zt),g===0&&__reallyNegative(g)&&(Ee="-"+Ee));var Et=Ee.split("e");if(Ct&&!O)for(;Et[0].length>1&&Et[0].indexOf(".")!=-1&&(Et[0].slice(-1)=="0"||Et[0].slice(-1)==".");)Et[0]=Et[0].slice(0,-1);else for(O&&Ee.indexOf(".")==-1&&(Et[0]+=".");Y>zt++;)Et[0]+="0";Ee=Et[0]+(Et.length>1?"e"+Et[1]:""),h==69&&(Ee=Ee.toUpperCase()),g>=0&&(A?Ee="+"+Ee:W&&(Ee=" "+Ee))}for(;Ee.length<L;)S?Ee+=" ":I&&(Ee[0]=="-"||Ee[0]=="+")?Ee=Ee[0]+"0"+Ee.slice(1):Ee=(I?"0":" ")+Ee;h<97&&(Ee=Ee.toUpperCase()),Ee.split("").forEach(function(jt){n.push(jt.charCodeAt(0))});break}case"s":{var ht=o("i8*"),mt=ht?_strlen(ht):6;if(H&&(mt=Math.min(mt,Y)),!S)for(;mt<L--;)n.push(32);if(ht)for(var xe=0;xe<mt;xe++)n.push(HEAPU8[ht++>>0]);else n=n.concat(intArrayFromString("(null)".substr(0,mt),!0));if(S)for(;mt<L--;)n.push(32);break}case"c":{for(S&&n.push(o("i8"));--L>0;)n.push(32);S||n.push(o("i8"));break}case"n":{var Nt=o("i32*");HEAP32[Nt>>2]=n.length;break}case"%":{n.push(l);break}default:for(var xe=d;xe<s+2;xe++)n.push(HEAP8[xe>>0])}s+=2}else n.push(l),s+=1}return n}function _fprintf(a,t,s){var r=__formatString(t,s),o=Runtime.stackSave(),n=_fwrite(allocate(r,"i8",ALLOC_STACK),1,r.length,a);return Runtime.stackRestore(o),n}function _printf(a,t){var s=__formatString(a,t),r=intArrayToString(s);return r[r.length-1]===`
`&&(r=r.substr(0,r.length-1)),Module.print(r),s.length}function _pthread_once(a,t){_pthread_once.seen||(_pthread_once.seen={}),!(a in _pthread_once.seen)&&(Runtime.dynCall("v",t),_pthread_once.seen[a]=1)}function _fputc(a,t){var s=unSign(a&255);HEAP8[_fputc.ret>>0]=s;var r=_fileno(t),o=_write(r,_fputc.ret,1);if(o==-1){var n=FS.getStreamFromPtr(t);return n&&(n.error=!0),-1}else return s}var PTHREAD_SPECIFIC={};function _pthread_getspecific(a){return PTHREAD_SPECIFIC[a]||0}Module._i64Add=_i64Add;function _fputs(a,t){var s=_fileno(t);return _write(s,a,_strlen(a))}allocate(1,"i32*",ALLOC_STATIC);function _puts(a){var t=Pointer_stringify(a),s=t.substr(0);return s[s.length-1]===`
`&&(s=s.substr(0,s.length-1)),Module.print(s),t.length}function _pthread_setspecific(a,t){return a in PTHREAD_SPECIFIC?(PTHREAD_SPECIFIC[a]=t,0):ERRNO_CODES.EINVAL}function __exit(a){Module.exit(a)}function _exit(a){__exit(a)}function _malloc(a){var t=Runtime.dynamicAlloc(a+8);return t+8&4294967288}Module._malloc=_malloc;function ___cxa_allocate_exception(a){return _malloc(a)}function _fmod(a,t){return a%t}function _fmodl(){return _fmod.apply(null,arguments)}Module._bitshift64Lshr=_bitshift64Lshr;function ___cxa_pure_virtual(){throw ABORT=!0,"Pure virtual function called!"}function _time(a){var t=Date.now()/1e3|0;return a&&(HEAP32[a>>2]=t),t}var PTHREAD_SPECIFIC_NEXT_KEY=1;function _pthread_key_create(a,t){return a==0?ERRNO_CODES.EINVAL:(HEAP32[a>>2]=PTHREAD_SPECIFIC_NEXT_KEY,PTHREAD_SPECIFIC[PTHREAD_SPECIFIC_NEXT_KEY]=0,PTHREAD_SPECIFIC_NEXT_KEY++,0)}function ___cxa_guard_acquire(a){return HEAP8[a>>0]?0:(HEAP8[a>>0]=1,1)}function ___cxa_guard_release(){}function _vfprintf(a,t,s){return _fprintf(a,t,HEAP32[s>>2])}function ___cxa_begin_catch(a){return __ZSt18uncaught_exceptionv.uncaught_exception--,EXCEPTIONS.caught.push(a),EXCEPTIONS.addRef(EXCEPTIONS.deAdjust(a)),a}function _emscripten_memcpy_big(a,t,s){return HEAPU8.set(HEAPU8.subarray(t,t+s),a),a}Module._memcpy=_memcpy;var _llvm_pow_f64=Math_pow;function _sbrk(a){var t=_sbrk;t.called||(DYNAMICTOP=alignMemoryPage(DYNAMICTOP),t.called=!0,assert(Runtime.dynamicAlloc),t.alloc=Runtime.dynamicAlloc,Runtime.dynamicAlloc=function(){abort("cannot dynamically allocate, sbrk now has control")});var s=DYNAMICTOP;return a!=0&&t.alloc(a),s}var _fabs=Math_abs;function ___errno_location(){return ___errno_state}function _copysign(a,t){return __reallyNegative(a)===__reallyNegative(t)?a:-a}function _copysignl(){return _copysign.apply(null,arguments)}var ___dso_handle=allocate(1,"i32*",ALLOC_STATIC),_stderr=allocate(1,"i32*",ALLOC_STATIC);___errno_state=Runtime.staticAlloc(4),HEAP32[___errno_state>>2]=0,_fputc.ret=allocate([0],"i8",ALLOC_STATIC),STACK_BASE=STACKTOP=Runtime.alignMemory(STATICTOP),STACK_MAX=STACK_BASE+TOTAL_STACK,DYNAMIC_BASE=DYNAMICTOP=Runtime.alignMemory(STACK_MAX),assert(DYNAMIC_BASE<TOTAL_MEMORY,"TOTAL_MEMORY not big enough for stack");var ctlz_i8=allocate([8,7,6,6,5,5,5,5,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"i8",ALLOC_DYNAMIC),cttz_i8=allocate([8,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,6,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,7,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,6,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0],"i8",ALLOC_DYNAMIC);function invoke_iiii(a,t,s,r){try{return Module.dynCall_iiii(a,t,s,r)}catch(o){if(typeof o!="number"&&o!=="longjmp")throw o;asm.setThrew(1,0)}}function invoke_viiiii(a,t,s,r,o,n){try{Module.dynCall_viiiii(a,t,s,r,o,n)}catch(l){if(typeof l!="number"&&l!=="longjmp")throw l;asm.setThrew(1,0)}}function invoke_vi(a,t){try{Module.dynCall_vi(a,t)}catch(s){if(typeof s!="number"&&s!=="longjmp")throw s;asm.setThrew(1,0)}}function invoke_vii(a,t,s){try{Module.dynCall_vii(a,t,s)}catch(r){if(typeof r!="number"&&r!=="longjmp")throw r;asm.setThrew(1,0)}}function invoke_ii(a,t){try{return Module.dynCall_ii(a,t)}catch(s){if(typeof s!="number"&&s!=="longjmp")throw s;asm.setThrew(1,0)}}function invoke_v(a){try{Module.dynCall_v(a)}catch(t){if(typeof t!="number"&&t!=="longjmp")throw t;asm.setThrew(1,0)}}function invoke_viiiiii(a,t,s,r,o,n,l){try{Module.dynCall_viiiiii(a,t,s,r,o,n,l)}catch(h){if(typeof h!="number"&&h!=="longjmp")throw h;asm.setThrew(1,0)}}function invoke_iii(a,t,s){try{return Module.dynCall_iii(a,t,s)}catch(r){if(typeof r!="number"&&r!=="longjmp")throw r;asm.setThrew(1,0)}}function invoke_viiii(a,t,s,r,o){try{Module.dynCall_viiii(a,t,s,r,o)}catch(n){if(typeof n!="number"&&n!=="longjmp")throw n;asm.setThrew(1,0)}}Module.asmGlobalArg={Math,Int8Array,Int16Array,Int32Array,Uint8Array,Uint16Array,Uint32Array,Float32Array,Float64Array},Module.asmLibraryArg={abort,assert,min:Math_min,invoke_iiii,invoke_viiiii,invoke_vi,invoke_vii,invoke_ii,invoke_v,invoke_viiiiii,invoke_iii,invoke_viiii,_fabs,_llvm_pow_f64,_send,_fmod,___cxa_guard_acquire,___setErrNo,_vfprintf,___cxa_allocate_exception,___cxa_find_matching_catch,___cxa_guard_release,_pwrite,__reallyNegative,_sbrk,___cxa_begin_catch,_emscripten_memcpy_big,_fileno,___resumeException,__ZSt18uncaught_exceptionv,_sysconf,_pthread_getspecific,_atexit,_pthread_once,_puts,_printf,_pthread_key_create,_write,___errno_location,_pthread_setspecific,___cxa_atexit,_copysign,_fputc,___cxa_throw,__exit,_copysignl,_abort,_fwrite,_time,_fprintf,__formatString,_fputs,_exit,___cxa_pure_virtual,_fmodl,STACKTOP,STACK_MAX,tempDoublePtr,ABORT,cttz_i8,ctlz_i8,NaN:NaN,Infinity:1/0,___dso_handle,_stderr};var asm=function(a,t,s){var r=new a.Int8Array(s),o=new a.Int16Array(s),n=new a.Int32Array(s),l=new a.Uint8Array(s),h=new a.Uint16Array(s),g=new a.Uint32Array(s),d=new a.Float32Array(s),A=new a.Float64Array(s),S=t.STACKTOP|0,O=t.STACK_MAX|0,I=t.tempDoublePtr|0,W=t.ABORT|0,L=t.cttz_i8|0,H=t.ctlz_i8|0,Y=t.___dso_handle|0,Q=t._stderr|0,pe=0,de=0,fe=0,ye=0,Ee=+t.NaN,Le=+t.Infinity,Z=0,ne=0,Ke=0,_t=0,xe=0,Ct=0,zt=0,Je=0,Et=0,ht=0,mt=0,Nt=0,Gt=0,Mt=0,jt=0,Ai=0,oi=0,ki=0,Li=0,Wi=a.Math.floor,Vi=a.Math.abs,qi=a.Math.sqrt,Kt=a.Math.pow,zs=a.Math.cos,ls=a.Math.sin,gs=a.Math.tan,Ws=a.Math.acos,K=a.Math.asin,He=a.Math.atan,We=a.Math.atan2,it=a.Math.exp,et=a.Math.log,Ie=a.Math.ceil,Ve=a.Math.imul,Me=t.abort,yt=t.assert,u=t.min,y=t.invoke_iiii,w=t.invoke_viiiii,D=t.invoke_vi,N=t.invoke_vii,U=t.invoke_ii,te=t.invoke_v,J=t.invoke_viiiiii,ie=t.invoke_iii,ae=t.invoke_viiii,ve=t._fabs,Se=t._llvm_pow_f64,be=t._send,ge=t._fmod,Ce=t.___cxa_guard_acquire,Ne=t.___setErrNo,qe=t._vfprintf,Ae=t.___cxa_allocate_exception,ke=t.___cxa_find_matching_catch,me=t.___cxa_guard_release,Te=t._pwrite,Re=t.__reallyNegative,Fe=t._sbrk,Ye=t.___cxa_begin_catch,je=t._emscripten_memcpy_big,Ze=t._fileno,tt=t.___resumeException,ut=t.__ZSt18uncaught_exceptionv,nt=t._sysconf,pt=t._pthread_getspecific,ft=t._atexit,wt=t._pthread_once,Tt=t._puts,Vt=t._printf,ni=t._pthread_key_create,ai=t._write,Ht=t.___errno_location,Ci=t._pthread_setspecific,Ti=t.___cxa_atexit,Pi=t._copysign,wi=t._fputc,Qt=t.___cxa_throw,Oi=t.__exit,ds=t._copysignl,Lt=t._abort,Qi=t._fwrite,Ki=t._time,Ri=t._fprintf,Xs=t.__formatString,on=t._fputs,Hs=t._exit,Bs=t.___cxa_pure_virtual,rs=t._fmodl,xs=0;function Pn(m){m=m|0;var T=0;return T=S,S=S+m|0,S=S+15&-16,T|0}function js(){return S|0}function Xn(m){m=m|0,S=m}function Er(m,T){m=m|0,T=T|0,pe||(pe=m,de=T)}function jn(m){m=m|0,r[I>>0]=r[m>>0],r[I+1>>0]=r[m+1>>0],r[I+2>>0]=r[m+2>>0],r[I+3>>0]=r[m+3>>0]}function pr(m){m=m|0,r[I>>0]=r[m>>0],r[I+1>>0]=r[m+1>>0],r[I+2>>0]=r[m+2>>0],r[I+3>>0]=r[m+3>>0],r[I+4>>0]=r[m+4>>0],r[I+5>>0]=r[m+5>>0],r[I+6>>0]=r[m+6>>0],r[I+7>>0]=r[m+7>>0]}function hn(m){m=m|0,ht=m}function En(){return ht|0}function Tr(m){m=m|0,Ye(m|0)|0,Ut()}function Tn(m){m=m|0}function Fs(m,T,x,C,B){m=m|0,T=T|0,x=x|0,C=C|0,B=B|0;var F=0;if(F=S,n[m>>2]=112,n[m+4>>2]=T,n[m+8>>2]=x,n[m+12>>2]=C,n[m+16>>2]=B,!(r[144]|0)&&Ce(144)|0&&(n[32]=0,n[33]=0,n[34]=0,Ti(19,128,Y|0)|0,me(144)),B=n[33]|0,(B|0)==(n[34]|0)&&(C=(B>>1)+2&-2,C=(C|0)<2?2:C,(C|0)>(2147483647-B|0)&&(T=Ae(1)|0,Qt(T|0,48,0)),x=n[32]|0,T=C+B|0,n[34]=T,T=vs(x,T<<2)|0,n[32]=T,!(T|0)&&(n[(Ht()|0)>>2]|0)==12&&(T=Ae(1)|0,Qt(T|0,48,0)),B=n[33]|0),n[33]=B+1,B=(n[32]|0)+(B<<2)|0,!B){S=F;return}n[B>>2]=m,S=F}function Ba(m){m=m|0;var T=0;T=S,ot(m),S=T}function Do(m){m=m|0;var T=0,x=0;if(T=S,x=n[m>>2]|0,!x){S=T;return}n[m+4>>2]=0,yi(x),n[m>>2]=0,n[m+8>>2]=0,S=T}function Fa(m){m=m|0;var T=0;T=S,ot(m),S=T}function ia(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0;if(x=S,(r[T>>0]|0)!=45)return G=0,S=x,G|0;for(C=T+1|0,B=110,R=C,G=0;;){if(F=G+1|0,(r[R>>0]|0)!=B<<24>>24){B=1;break}if(R=T+(G+2)|0,(F|0)==3){B=0,C=R;break}else B=r[264+F>>0]|0,G=F}return hh(C,n[m+4>>2]|0)|0?(G=0,S=x,G|0):(r[m+20>>0]=B,G=1,S=x,G|0)}function dl(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0;for(F=S,S=S+16|0,x=F,C=n[Q>>2]|0,B=m+4|0,R=n[B>>2]|0,n[x>>2]=R,n[x+4>>2]=R,Ri(C|0,216,x|0)|0,R=0;G=R>>>0<(32-((Sa(n[B>>2]|0)|0)<<1)|0)>>>0,wi(32,C|0)|0,G;)R=R+1|0;if(n[x>>2]=r[m+20>>0]|0?248:256,Ri(C|0,232,x|0)|0,!T){S=F;return}n[x>>2]=n[m+8>>2],Ri(C|0,88,x|0)|0,wi(10,C|0)|0,S=F}function qa(m){m=m|0;var T=0;T=S,ot(m),S=T}function xo(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0;if(x=S,S=S+16|0,F=x,B=x+8|0,(r[T>>0]|0)!=45)return X=0,S=x,X|0;ee=T+1|0,C=m+4|0,R=n[C>>2]|0,G=r[R>>0]|0;e:do if(G<<24>>24){for(z=0;;){if(X=z,z=z+1|0,(r[ee>>0]|0)!=G<<24>>24){m=0;break}if(G=r[R+z>>0]|0,ee=T+(X+2)|0,!(G<<24>>24))break e}return S=x,m|0}while(!1);return(r[ee>>0]|0)!=61||(T=ee+1|0,R=Xa(T,B,10)|0,!(n[B>>2]|0))?(X=0,S=x,X|0):((R|0)>(n[m+24>>2]|0)&&(X=n[Q>>2]|0,z=n[C>>2]|0,n[F>>2]=T,n[F+4>>2]=z,Ri(X|0,416,F|0)|0,Hs(1)),(R|0)<(n[m+20>>2]|0)&&(X=n[Q>>2]|0,z=n[C>>2]|0,n[F>>2]=T,n[F+4>>2]=z,Ri(X|0,472,F|0)|0,Hs(1)),n[m+28>>2]=R,X=1,S=x,X|0)}function sa(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0;if(x=S,S=S+16|0,C=x,B=n[Q>>2]|0,F=n[m+16>>2]|0,n[C>>2]=n[m+4>>2],n[C+4>>2]=F,Ri(B|0,336,C|0)|0,F=n[m+20>>2]|0,(F|0)==-2147483648?Qi(360,4,1,B|0)|0:(n[C>>2]=F,Ri(B|0,368,C|0)|0),Qi(376,4,1,B|0)|0,F=n[m+24>>2]|0,(F|0)==2147483647?Qi(384,4,1,B|0)|0:(n[C>>2]=F,Ri(B|0,368,C|0)|0),n[C>>2]=n[m+28>>2],Ri(B|0,392,C|0)|0,!T){S=x;return}n[C>>2]=n[m+8>>2],Ri(B|0,88,C|0)|0,wi(10,B|0)|0,S=x}function Jr(m){m=m|0;var T=0,x=0,C=0,B=0,F=0;B=S,n[m>>2]=1816,C=m+4|0,x=m+32|0,F=m+48|0,n[C+0>>2]=0,n[C+4>>2]=0,n[C+8>>2]=0,n[C+12>>2]=0,n[C+16>>2]=0,n[C+20>>2]=0,n[x+0>>2]=0,n[x+4>>2]=0,n[x+8>>2]=0,n[x+12>>2]=0,A[F>>3]=+A[75],A[m+56>>3]=+A[89],A[m+64>>3]=+A[103],A[m+72>>3]=+A[123],r[m+80>>0]=r[1364]|0,n[m+84>>2]=n[269],n[m+88>>2]=n[297],r[m+92>>0]=0,r[m+93>>0]=r[1292]|0,A[m+96>>3]=+A[204],n[m+104>>2]=n[439],n[m+108>>2]=n[359],A[m+112>>3]=+A[191],A[m+120>>3]=.3333333333333333,A[m+128>>3]=1.1,n[m+136>>2]=100,A[m+144>>3]=1.5,F=m+316|0,n[m+332>>2]=0,n[m+336>>2]=0,n[m+340>>2]=0,n[m+348>>2]=0,n[m+352>>2]=0,n[m+356>>2]=0,n[m+364>>2]=0,n[m+368>>2]=0,n[m+372>>2]=0,n[m+380>>2]=0,n[m+384>>2]=0,n[m+388>>2]=0,n[m+396>>2]=0,n[m+400>>2]=0,n[m+404>>2]=0,x=m+544|0,n[m+412>>2]=0,n[m+416>>2]=0,n[m+420>>2]=0,n[m+428>>2]=0,n[m+432>>2]=0,n[m+436>>2]=0,n[m+444>>2]=0,n[m+448>>2]=0,n[m+452>>2]=0,ja(m+152|0,0,176)|0,n[m+456>>2]=x,C=m+460|0,n[C+0>>2]=0,n[C+4>>2]=0,n[C+8>>2]=0,n[C+12>>2]=0,n[C+16>>2]=0,n[C+20>>2]=0,n[m+488>>2]=F,r[m+492>>0]=1,A[m+496>>3]=1,A[m+504>>3]=1,n[m+512>>2]=0,n[m+516>>2]=-1,F=m+520|0,C=m+536|0,n[F+0>>2]=0,n[F+4>>2]=0,n[F+8>>2]=0,n[F+12>>2]=0,r[C>>0]=1,C=m+540|0,n[C+0>>2]=0,n[C+4>>2]=0,n[C+8>>2]=0,n[C+12>>2]=0,n[C+16>>2]=0,Zi(x,1048576),r[m+560>>0]=0,x=m+604|0,C=m+664|0,F=m+564|0,T=F+36|0;do n[F>>2]=0,F=F+4|0;while((F|0)<(T|0));F=x+0|0,T=F+36|0;do n[F>>2]=0,F=F+4|0;while((F|0)<(T|0));F=m+680|0,n[C+0>>2]=-1,n[C+4>>2]=-1,n[C+8>>2]=-1,n[C+12>>2]=-1,r[F>>0]=0,S=B}function Io(m){m=m|0;var T=0;T=S,go(m),ot(m),S=T}function go(m){m=m|0;var T=0,x=0,C=0;if(T=S,n[m>>2]=1816,x=m+628|0,C=n[x>>2]|0,C&&(n[m+632>>2]=0,yi(C),n[x>>2]=0,n[m+636>>2]=0),x=m+616|0,C=n[x>>2]|0,C&&(n[m+620>>2]=0,yi(C),n[x>>2]=0,n[m+624>>2]=0),x=m+604|0,C=n[x>>2]|0,C&&(n[m+608>>2]=0,yi(C),n[x>>2]=0,n[m+612>>2]=0),x=m+588|0,C=n[x>>2]|0,C&&(n[m+592>>2]=0,yi(C),n[x>>2]=0,n[m+596>>2]=0),x=m+576|0,C=n[x>>2]|0,C&&(n[m+580>>2]=0,yi(C),n[x>>2]=0,n[m+584>>2]=0),x=m+564|0,C=n[x>>2]|0,C&&(n[m+568>>2]=0,yi(C),n[x>>2]=0,n[m+572>>2]=0),x=n[m+544>>2]|0,x&&yi(x),x=m+472|0,C=n[x>>2]|0,C&&(n[m+476>>2]=0,yi(C),n[x>>2]=0,n[m+480>>2]=0),x=m+460|0,C=n[x>>2]|0,C&&(n[m+464>>2]=0,yi(C),n[x>>2]=0,n[m+468>>2]=0),Ms(m+412|0),x=m+396|0,C=n[x>>2]|0,C&&(n[m+400>>2]=0,yi(C),n[x>>2]=0,n[m+404>>2]=0),x=m+380|0,C=n[x>>2]|0,C&&(n[m+384>>2]=0,yi(C),n[x>>2]=0,n[m+388>>2]=0),C=m+364|0,x=n[C>>2]|0,x&&(n[m+368>>2]=0,yi(x),n[C>>2]=0,n[m+372>>2]=0),x=m+348|0,C=n[x>>2]|0,C&&(n[m+352>>2]=0,yi(C),n[x>>2]=0,n[m+356>>2]=0),x=m+332|0,C=n[x>>2]|0,C&&(n[m+336>>2]=0,yi(C),n[x>>2]=0,n[m+340>>2]=0),x=m+316|0,C=n[x>>2]|0,C&&(n[m+320>>2]=0,yi(C),n[x>>2]=0,n[m+324>>2]=0),x=m+304|0,C=n[x>>2]|0,C&&(n[m+308>>2]=0,yi(C),n[x>>2]=0,n[m+312>>2]=0),x=m+292|0,C=n[x>>2]|0,C&&(n[m+296>>2]=0,yi(C),n[x>>2]=0,n[m+300>>2]=0),x=m+280|0,C=n[x>>2]|0,C&&(n[m+284>>2]=0,yi(C),n[x>>2]=0,n[m+288>>2]=0),x=m+268|0,C=n[x>>2]|0,C&&(n[m+272>>2]=0,yi(C),n[x>>2]=0,n[m+276>>2]=0),x=m+256|0,C=n[x>>2]|0,C&&(n[m+260>>2]=0,yi(C),n[x>>2]=0,n[m+264>>2]=0),x=m+32|0,C=n[x>>2]|0,C&&(n[m+36>>2]=0,yi(C),n[x>>2]=0,n[m+40>>2]=0),x=m+16|0,C=n[x>>2]|0,C&&(n[m+20>>2]=0,yi(C),n[x>>2]=0,n[m+24>>2]=0),C=m+4|0,x=n[C>>2]|0,!x){S=T;return}n[m+8>>2]=0,yi(x),n[C>>2]=0,n[m+12>>2]=0,S=T}function Vo(m,T,x){m=m|0,T=T|0,x=x|0;var C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0;if(C=S,S=S+16|0,R=C+4|0,F=C,B=m+580|0,ee=n[B>>2]|0,(ee|0)>0?(X=ee+-1|0,oe=n[(n[m+576>>2]|0)+(X<<2)>>2]|0,n[B>>2]=X,B=oe):(oe=m+540|0,B=n[oe>>2]|0,n[oe>>2]=B+1),ee=m+412|0,oe=B<<1,n[R>>2]=oe,On(ee,R),n[F>>2]=oe|1,On(ee,F),R=m+332|0,ee=r[544]|0,F=B+1|0,ps(R,F),r[(n[R>>2]|0)+B>>0]=ee,R=m+396|0,ee=m+400|0,(n[ee>>2]|0)<(F|0)){if(X=m+404|0,oe=n[X>>2]|0,(oe|0)<(F|0)&&(ue=B+2-oe&-2,z=(oe>>1)+2&-2,z=(ue|0)>(z|0)?ue:z,(z|0)>(2147483647-oe|0)&&(ue=Ae(1)|0,Qt(ue|0,48,0)),re=n[R>>2]|0,ue=z+oe|0,n[X>>2]=ue,ue=vs(re,ue<<3)|0,n[R>>2]=ue,!(ue|0)&&(n[(Ht()|0)>>2]|0)==12&&(re=Ae(1)|0,Qt(re|0,48,0))),X=n[ee>>2]|0,(X|0)<(F|0))do z=(n[R>>2]|0)+(X<<3)|0,z&&(re=z,n[re>>2]=0,n[re+4>>2]=0),X=X+1|0;while((X|0)!=(F|0));n[ee>>2]=F}if(ee=(n[R>>2]|0)+(B<<3)|0,n[ee>>2]=-1,n[ee+4>>2]=0,ee=m+316|0,r[m+93>>0]|0?(re=m+72|0,G=+A[re>>3]*1389796,G=G-+(~~(G/2147483647)|0)*2147483647,A[re>>3]=G,G=G/2147483647*1e-5):G=0,R=m+320|0,(n[R>>2]|0)<(F|0)){if(z=m+324|0,X=n[z>>2]|0,(X|0)<(F|0)&&(re=B+2-X&-2,oe=(X>>1)+2&-2,oe=(re|0)>(oe|0)?re:oe,(oe|0)>(2147483647-X|0)&&(re=Ae(1)|0,Qt(re|0,48,0)),ue=n[ee>>2]|0,re=oe+X|0,n[z>>2]=re,re=vs(ue,re<<3)|0,n[ee>>2]=re,!(re|0)&&(n[(Ht()|0)>>2]|0)==12&&(re=Ae(1)|0,Qt(re|0,48,0))),oe=n[R>>2]|0,(oe|0)<(F|0)){z=n[ee>>2]|0;do X=z+(oe<<3)|0,X&&(A[X>>3]=0),oe=oe+1|0;while((oe|0)!=(F|0))}n[R>>2]=F}if(A[(n[ee>>2]|0)+(B<<3)>>3]=G,hs(m+588|0,B,0),hs(m+348|0,B,1),R=m+364|0,T=r[T>>0]|0,ps(R,F),r[(n[R>>2]|0)+B>>0]=T,R=m+380|0,T=m+384|0,(n[T>>2]|0)<(F|0)){if(ee=m+388|0,X=n[ee>>2]|0,(X|0)<(F|0)&&(re=B+2-X&-2,z=(X>>1)+2&-2,z=(re|0)>(z|0)?re:z,(z|0)>(2147483647-X|0)&&(re=Ae(1)|0,Qt(re|0,48,0)),ue=n[R>>2]|0,re=z+X|0,n[ee>>2]=re,re=vs(ue,re)|0,n[R>>2]=re,!(re|0)&&(n[(Ht()|0)>>2]|0)==12&&(re=Ae(1)|0,Qt(re|0,48,0))),ee=n[T>>2]|0,(ee|0)<(F|0))do z=(n[R>>2]|0)+ee|0,z&&(r[z>>0]=0),ee=ee+1|0;while((ee|0)!=(F|0));n[T>>2]=F}return T=m+288|0,R=n[T>>2]|0,(R|0)<(F|0)&&(re=B+2-R&-2,F=(R>>1)+2&-2,F=(re|0)>(F|0)?re:F,(F|0)>(2147483647-R|0)&&(re=Ae(1)|0,Qt(re|0,48,0)),ue=m+280|0,oe=n[ue>>2]|0,re=F+R|0,n[T>>2]=re,re=vs(oe,re<<2)|0,n[ue>>2]=re,!(re|0)&&(n[(Ht()|0)>>2]|0)==12&&(re=Ae(1)|0,Qt(re|0,48,0))),F=m+380|0,T=(n[F>>2]|0)+B|0,R=(r[T>>0]|0)==0,x?R&&(re=m+200|0,ue=re,ue=ts(n[ue>>2]|0,n[ue+4>>2]|0,1,0)|0,n[re>>2]=ue,n[re+4>>2]=ht):R||(re=m+200|0,ue=re,ue=ts(n[ue>>2]|0,n[ue+4>>2]|0,-1,-1)|0,n[re>>2]=ue,n[re+4>>2]=ht),r[T>>0]=x&1,x=m+460|0,(n[m+476>>2]|0)>(B|0)&&(n[(n[m+472>>2]|0)+(B<<2)>>2]|0)>-1||!(r[(n[F>>2]|0)+B>>0]|0)?(S=C,B|0):(Ni(x,B),S=C,B|0)}function Ha(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0,we=0,_e=0,Be=0;if(x=S,S=S+16|0,R=x+1|0,F=x,C=m+492|0,!(r[C>>0]|0))return we=0,S=x,we|0;we=n[T>>2]|0,B=T+4|0,G=n[B>>2]|0,r[R+0>>0]=r[F+0>>0]|0,Is(we,G,R),G=n[B>>2]|0;e:do if((G|0)>0){for(R=m+332|0,F=r[528]|0,ee=0,z=0,oe=-2;;){if(we=n[T>>2]|0,X=n[we+(ee<<2)>>2]|0,re=l[(n[R>>2]|0)+(X>>1)>>0]|0,_e=re^X&1,ue=_e&255,Be=F&255,(X|0)==(oe^1|0)||ue<<24>>24==F<<24>>24&(Be>>>1^1)|Be&2&_e|0){m=1;break}if(_e=r[536]|0,Be=_e&255,(X|0)!=(oe|0)&&!((Be>>>1^1)&ue<<24>>24==_e<<24>>24|re&2&Be|0)?(n[we+(z<<2)>>2]=X,G=n[B>>2]|0,z=z+1|0):X=oe,ee=ee+1|0,(ee|0)<(G|0))oe=X;else break e}return S=x,m|0}else ee=0,z=0;while(!1);return F=ee-z|0,(F|0)>0&&(G=G-F|0,n[B>>2]=G),G?(G|0)==1?(_e=n[n[T>>2]>>2]|0,we=_e>>1,r[(n[m+332>>2]|0)+we>>0]=(_e&1^1)&255^1,Be=n[m+296>>2]|0,we=(n[m+396>>2]|0)+(we<<3)|0,n[we>>2]=-1,n[we+4>>2]=Be,we=m+284|0,Be=n[we>>2]|0,n[we>>2]=Be+1,n[(n[m+280>>2]|0)+(Be<<2)>>2]=_e,Be=(Cr(m)|0)==-1,r[C>>0]=Be&1,S=x,Be|0):(T=$s(m+544|0,T,0)|0,B=m+256|0,C=m+260|0,R=n[C>>2]|0,F=m+264|0,(R|0)==(n[F>>2]|0)&&(G=(R>>1)+2&-2,G=(G|0)<2?2:G,(G|0)>(2147483647-R|0)&&(Be=Ae(1)|0,Qt(Be|0,48,0)),_e=n[B>>2]|0,Be=G+R|0,n[F>>2]=Be,Be=vs(_e,Be<<2)|0,n[B>>2]=Be,!(Be|0)&&(n[(Ht()|0)>>2]|0)==12&&(Be=Ae(1)|0,Qt(Be|0,48,0)),R=n[C>>2]|0),n[C>>2]=R+1,C=(n[B>>2]|0)+(R<<2)|0,C&&(n[C>>2]=T),eo(m,T),Be=1,S=x,Be|0):(r[C>>0]=0,Be=0,S=x,Be|0)}function Lr(m,T,x){m=m|0,T=T|0,x=x|0;var C=0,B=0;C=n[T>>2]|0,T=C>>1,r[(n[m+332>>2]|0)+T>>0]=(C&1^1)&255^1,B=n[m+296>>2]|0,T=(n[m+396>>2]|0)+(T<<3)|0,n[T>>2]=x,n[T+4>>2]=B,x=m+284|0,T=n[x>>2]|0,n[x>>2]=T+1,n[(n[m+280>>2]|0)+(T<<2)>>2]=C}function Cr(m){m=m|0;var T=0,x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0,we=0,_e=0,Be=0,Xe=0,Qe=0,at=0,kt=0,hi=0,ri=0,dt=0,Yt=0,ii=0,qt=0,ei=0,Rt=0,$t=0,Ft=0,lt=0,di=0,vi=0,gi=0,Si=0,Fi=0;if(R=S,S=S+16|0,re=R,B=m+512|0,_e=n[B>>2]|0,ue=m+284|0,(_e|0)>=(n[ue>>2]|0))return vi=0,lt=0,Si=-1,gi=m+184|0,$t=gi,di=$t,di=n[di>>2]|0,$t=$t+4|0,$t=n[$t>>2]|0,$t=ts(di|0,$t|0,vi|0,lt|0)|0,di=ht,Ft=gi,n[Ft>>2]=$t,gi=gi+4|0,n[gi>>2]=di,gi=m+520|0,di=gi,Ft=di,Ft=n[Ft>>2]|0,di=di+4|0,di=n[di>>2]|0,lt=bn(Ft|0,di|0,vi|0,lt|0)|0,vi=ht,di=gi,n[di>>2]=lt,gi=gi+4|0,n[gi>>2]=vi,S=R,Si|0;X=m+280|0,F=m+428|0,C=m+412|0,G=m+332|0,ee=m+544|0,z=re+4|0,T=m+396|0,oe=m+296|0,x=m+456|0,hi=-1,we=0;do{if(n[B>>2]=_e+1,Qe=n[(n[X>>2]|0)+(_e<<2)>>2]|0,r[(n[F>>2]|0)+Qe>>0]|0){if(Be=n[C>>2]|0,_e=Be+(Qe*12|0)+4|0,kt=n[_e>>2]|0,(kt|0)>0){Be=Be+(Qe*12|0)|0,Xe=0,at=0;do dt=n[Be>>2]|0,ri=dt+(Xe<<3)|0,(n[(n[n[x>>2]>>2]|0)+(n[ri>>2]<<2)>>2]&3|0)!=1&&(gi=ri,Si=n[gi+4>>2]|0,kt=dt+(at<<3)|0,n[kt>>2]=n[gi>>2],n[kt+4>>2]=Si,kt=n[_e>>2]|0,at=at+1|0),Xe=Xe+1|0;while((Xe|0)<(kt|0))}else Xe=0,at=0;Be=Xe-at|0,(Be|0)>0&&(n[_e>>2]=kt-Be),r[(n[F>>2]|0)+Qe>>0]=0}_e=n[C>>2]|0,we=we+1|0,Be=n[_e+(Qe*12|0)>>2]|0,_e=_e+(Qe*12|0)+4|0,at=n[_e>>2]|0,Xe=Be+(at<<3)|0;e:do if(!at)Xe=Be,kt=Be;else for(Qe=Qe^1,at=(at<<3)+-1|0,dt=Be,kt=Be;;){for(;;){t:for(;;){if(Rt=n[dt+4>>2]|0,Si=l[(n[G>>2]|0)+(Rt>>1)>>0]^Rt&1,Ft=r[528]|0,$t=Ft&255,lt=$t&2,$t=$t>>>1^1,(Si&255)<<24>>24==Ft<<24>>24&$t|lt&Si){qt=19;break}if(ri=n[dt>>2]|0,qt=n[ee>>2]|0,ei=qt+(ri<<2)|0,Yt=qt+(ri+1<<2)|0,ii=n[Yt>>2]|0,(ii|0)==(Qe|0)&&(Si=qt+(ri+2<<2)|0,ii=n[Si>>2]|0,n[Yt>>2]=ii,n[Si>>2]=Qe),Yt=dt+8|0,n[re>>2]=ri,n[z>>2]=ii,(ii|0)!=(Rt|0)&&(Si=l[(n[G>>2]|0)+(ii>>1)>>0]^ii&1,((Si&255)<<24>>24==Ft<<24>>24&$t|lt&Si|0)!=0)){qt=27;break}if(lt=n[ei>>2]|0,lt>>>0<=95){qt=31;break}for($t=n[G>>2]|0,Ft=r[536]|0,Rt=Ft&255,Si=Rt&2,Rt=Rt>>>1^1,gi=2;di=ei+(gi<<2)+4|0,vi=n[di>>2]|0,Fi=l[$t+(vi>>1)>>0]^vi&1,gi=gi+1|0,!!((Fi&255)<<24>>24==Ft<<24>>24&Rt|Si&Fi);)if((gi|0)>=(lt>>>5|0)){qt=32;break t}if(Fi=qt+(ri+2<<2)|0,n[Fi>>2]=vi,n[di>>2]=Qe,Dr((n[C>>2]|0)+((n[Fi>>2]^1)*12|0)|0,re),(Yt|0)==(Xe|0))break e;dt=Yt}if((qt|0)==19?(qt=0,gi=dt,Si=n[gi+4>>2]|0,Fi=kt,n[Fi>>2]=n[gi>>2],n[Fi+4>>2]=Si,dt=dt+8|0,kt=kt+8|0):(qt|0)==27?(qt=0,Si=re,Fi=n[Si+4>>2]|0,dt=kt,n[dt>>2]=n[Si>>2],n[dt+4>>2]=Fi,dt=Yt,kt=kt+8|0):(qt|0)==31&&(Ft=r[536]|0,qt=32),(qt|0)==32){if(qt=kt+8|0,ei=re,$t=n[ei+4>>2]|0,Rt=kt,n[Rt>>2]=n[ei>>2],n[Rt+4>>2]=$t,Rt=ii>>1,$t=ii&1,ei=(n[G>>2]|0)+Rt|0,Fi=l[ei>>0]^$t,Si=Ft&255,(Fi&255)<<24>>24==Ft<<24>>24&(Si>>>1^1)|Si&2&Fi)break;r[ei>>0]=($t^1)&255^1,kt=n[oe>>2]|0,dt=(n[T>>2]|0)+(Rt<<3)|0,n[dt>>2]=ri,n[dt+4>>2]=kt,dt=n[ue>>2]|0,n[ue>>2]=dt+1,n[(n[X>>2]|0)+(dt<<2)>>2]=ii,dt=Yt,kt=qt}if((dt|0)==(Xe|0))break e}if(n[B>>2]=n[ue>>2],Yt>>>0<Xe>>>0){for(hi=(Be+(at-Yt)|0)>>>3;gi=Yt,Yt=Yt+8|0,Si=n[gi+4>>2]|0,Fi=qt,n[Fi>>2]=n[gi>>2],n[Fi+4>>2]=Si,!(Yt>>>0>=Xe>>>0);)qt=qt+8|0;dt=dt+(hi+2<<3)|0,kt=kt+(hi+2<<3)|0}else dt=Yt,kt=qt;if((dt|0)==(Xe|0)){hi=ri;break}else hi=ri}while(!1);Be=Xe-kt|0,(Be|0)>0&&(n[_e>>2]=(n[_e>>2]|0)-(Be>>3)),_e=n[B>>2]|0}while((_e|0)<(n[ue>>2]|0));return gi=we,di=((we|0)<0)<<31>>31,Fi=hi,Si=m+184|0,Ft=Si,vi=Ft,vi=n[vi>>2]|0,Ft=Ft+4|0,Ft=n[Ft>>2]|0,Ft=ts(vi|0,Ft|0,gi|0,di|0)|0,vi=ht,lt=Si,n[lt>>2]=Ft,Si=Si+4|0,n[Si>>2]=vi,Si=m+520|0,vi=Si,lt=vi,lt=n[lt>>2]|0,vi=vi+4|0,vi=n[vi>>2]|0,di=bn(lt|0,vi|0,gi|0,di|0)|0,gi=ht,vi=Si,n[vi>>2]=di,Si=Si+4|0,n[Si>>2]=gi,S=R,Fi|0}function eo(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0;if(x=S,S=S+16|0,ee=x+8|0,B=x,F=n[m+544>>2]|0,C=F+(T<<2)|0,R=F+(T+1<<2)|0,G=m+412|0,z=(n[G>>2]|0)+((n[R>>2]^1)*12|0)|0,F=F+(T+2<<2)|0,X=n[F>>2]|0,n[ee>>2]=T,n[ee+4>>2]=X,Dr(z,ee),F=(n[G>>2]|0)+((n[F>>2]^1)*12|0)|0,R=n[R>>2]|0,n[B>>2]=T,n[B+4>>2]=R,Dr(F,B),n[C>>2]&4){X=m+216|0,z=X,z=ts(n[z>>2]|0,n[z+4>>2]|0,1,0)|0,n[X>>2]=z,n[X+4>>2]=ht,X=m+232|0,z=X,z=ts((n[C>>2]|0)>>>5|0,0,n[z>>2]|0,n[z+4>>2]|0)|0,n[X>>2]=z,n[X+4>>2]=ht,S=x;return}else{X=m+208|0,z=X,z=ts(n[z>>2]|0,n[z+4>>2]|0,1,0)|0,n[X>>2]=z,n[X+4>>2]=ht,X=m+224|0,z=X,z=ts((n[C>>2]|0)>>>5|0,0,n[z>>2]|0,n[z+4>>2]|0)|0,n[X>>2]=z,n[X+4>>2]=ht,S=x;return}}function na(m,T,x){m=m|0,T=T|0,x=x|0;var C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0;if(B=S,S=S+16|0,ee=B+4|0,R=B,F=n[m+544>>2]|0,C=F+(T<<2)|0,G=n[F+(T+1<<2)>>2]^1,!x)n[ee>>2]=G,x=m+428|0,z=n[x>>2]|0,G=z+G|0,r[G>>0]|0||(r[G>>0]=1,Ys(m+444|0,ee),z=n[x>>2]|0),T=n[F+(T+2<<2)>>2]^1,n[R>>2]=T,T=z+T|0,r[T>>0]|0||(r[T>>0]=1,Ys(m+444|0,R));else{R=m+412|0,x=n[R>>2]|0,ee=x+(G*12|0)|0,F=F+(T+2<<2)|0,G=x+(G*12|0)+4|0,z=n[G>>2]|0;e:do if((z|0)>0)for(ue=n[ee>>2]|0,oe=0;;){if(X=oe+1|0,(n[ue+(oe<<3)>>2]|0)==(T|0)){X=oe;break e}if((X|0)<(z|0))oe=X;else break}else X=0;while(!1);if(z=z+-1|0,(X|0)<(z|0)){do x=n[ee>>2]|0,z=X,X=X+1|0,oe=x+(X<<3)|0,ue=n[oe+4>>2]|0,z=x+(z<<3)|0,n[z>>2]=n[oe>>2],n[z+4>>2]=ue,z=(n[G>>2]|0)+-1|0;while((X|0)<(z|0));x=n[R>>2]|0}n[G>>2]=z,R=n[F>>2]^1,F=x+(R*12|0)|0,R=x+(R*12|0)+4|0,G=n[R>>2]|0;e:do if((G|0)>0)for(x=n[F>>2]|0,z=0;;){if(ee=z+1|0,(n[x+(z<<3)>>2]|0)==(T|0)){ee=z;break e}if((ee|0)<(G|0))z=ee;else break}else ee=0;while(!1);if(T=G+-1|0,(ee|0)<(T|0))do X=n[F>>2]|0,T=ee,ee=ee+1|0,oe=X+(ee<<3)|0,ue=n[oe+4>>2]|0,T=X+(T<<3)|0,n[T>>2]=n[oe>>2],n[T+4>>2]=ue,T=(n[R>>2]|0)+-1|0;while((ee|0)<(T|0));n[R>>2]=T}if(n[C>>2]&4){ue=m+216|0,oe=ue,oe=ts(n[oe>>2]|0,n[oe+4>>2]|0,-1,-1)|0,n[ue>>2]=oe,n[ue+4>>2]=ht,ue=m+232|0,oe=ue,oe=bn(n[oe>>2]|0,n[oe+4>>2]|0,(n[C>>2]|0)>>>5|0,0)|0,n[ue>>2]=oe,n[ue+4>>2]=ht,S=B;return}else{ue=m+208|0,oe=ue,oe=ts(n[oe>>2]|0,n[oe+4>>2]|0,-1,-1)|0,n[ue>>2]=oe,n[ue+4>>2]=ht,ue=m+224|0,oe=ue,oe=bn(n[oe>>2]|0,n[oe+4>>2]|0,(n[C>>2]|0)>>>5|0,0)|0,n[ue>>2]=oe,n[ue+4>>2]=ht,S=B;return}}function to(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0;B=S,C=m+544|0,ee=n[C>>2]|0,x=ee+(T<<2)|0,na(m,T,0),ee=n[ee+(T+1<<2)>>2]|0,F=ee>>1,ee=(l[(n[m+332>>2]|0)+F>>0]|0)^ee&1,X=r[528]|0,z=X&255,(ee&255)<<24>>24==X<<24>>24&(z>>>1^1)|z&2&ee|0&&(R=(n[m+396>>2]|0)+(F<<3)|0,G=n[R>>2]|0,(G|0)!=-1)&&((n[C>>2]|0)+(G<<2)|0)==(x|0)&&(n[R>>2]=-1),n[x>>2]=n[x>>2]&-4|1,z=n[(n[C>>2]|0)+(T<<2)>>2]|0,X=m+556|0,n[X>>2]=((((z>>>3&1)+(z>>>5)<<2)+4|0)>>>2)+(n[X>>2]|0),S=B}function za(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0,ee=0;if(x=S,C=n[T>>2]|0,C>>>0<=31)return G=0,S=x,G|0;for(B=n[m+332>>2]|0,F=r[528]|0,R=F&255,G=R&2,R=R>>>1^1,m=0;;){if(ee=n[T+(m<<2)+4>>2]|0,ee=(l[B+(ee>>1)>>0]|0)^ee&1,m=m+1|0,(ee&255)<<24>>24==F<<24>>24&R|G&ee){C=1,T=5;break}if((m|0)>=(C>>>5|0)){C=0,T=5;break}}return(T|0)==5?(S=x,C|0):0}function Yr(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0,we=0,_e=0,Be=0,Xe=0;if(B=S,x=m+296|0,(n[x>>2]|0)<=(T|0)){S=B;return}if(C=m+284|0,_e=n[C>>2]|0,R=m+292|0,Be=n[R>>2]|0,Xe=n[Be+(T<<2)>>2]|0,(_e|0)>(Xe|0)){we=m+280|0,z=m+332|0,ee=m+88|0,G=m+348|0,X=m+460|0,ue=m+476|0,re=m+472|0,oe=m+380|0;do _e=_e+-1|0,Xe=n[(n[we>>2]|0)+(_e<<2)>>2]>>1,r[(n[z>>2]|0)+Xe>>0]=r[544]|0,Be=n[ee>>2]|0,(Be|0)<=1?(Be|0)==1&&(_e|0)>(n[(n[R>>2]|0)+((n[x>>2]|0)+-1<<2)>>2]|0)&&(F=7):F=7,(F|0)==7&&(F=0,r[(n[G>>2]|0)+Xe>>0]=n[(n[we>>2]|0)+(_e<<2)>>2]&1),(n[ue>>2]|0)>(Xe|0)&&(n[(n[re>>2]|0)+(Xe<<2)>>2]|0)>-1||(F=11),(F|0)==11&&(F=0,(r[(n[oe>>2]|0)+Xe>>0]|0)!=0)&&Ni(X,Xe),Be=n[R>>2]|0,Xe=n[Be+(T<<2)>>2]|0;while((_e|0)>(Xe|0));_e=n[C>>2]|0}if(n[m+512>>2]=Xe,m=n[Be+(T<<2)>>2]|0,(_e-m|0)>0&&(n[C>>2]=m),((n[x>>2]|0)-T|0)<=0){S=B;return}n[x>>2]=T,S=B}function pl(m){m=m|0;var T=0,x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0;for(T=S,C=m+72|0,ue=+A[C>>3]*1389796,ue=ue-+(~~(ue/2147483647)|0)*2147483647,A[C>>3]=ue,G=m+464|0,ue/2147483647<+A[m+64>>3]&&(ee=n[G>>2]|0,(ee|0)!=0)?(ue=ue*1389796,ue=ue-+(~~(ue/2147483647)|0)*2147483647,A[C>>3]=ue,ee=n[(n[m+460>>2]|0)+(~~(+(ee|0)*(ue/2147483647))<<2)>>2]|0,X=r[(n[m+332>>2]|0)+ee>>0]|0,z=r[544]|0,oe=z&255,(oe>>>1^1)&X<<24>>24==z<<24>>24|X&2&oe|0&&r[(n[m+380>>2]|0)+ee>>0]|0&&(oe=m+176|0,X=oe,X=ts(n[X>>2]|0,n[X+4>>2]|0,1,0)|0,n[oe>>2]=X,n[oe+4>>2]=ht)):ee=-1,z=m+460|0,oe=m+332|0,X=m+380|0;!((ee|0)!=-1&&(re=r[(n[oe>>2]|0)+ee>>0]|0,F=r[544]|0,x=F&255,B=x>>>1^1,(B&re<<24>>24==F<<24>>24|re&2&x|0)!=0)&&r[(n[X>>2]|0)+ee>>0]|0);){if(!(n[G>>2]|0)){x=-2,R=17;break}ee=pn(z)|0}return(R|0)==17?(S=T,x|0):(G=r[(n[m+364>>2]|0)+ee>>0]|0,R=G&255,B&G<<24>>24==F<<24>>24|x&2&R?r[m+92>>0]|0?(ue=+A[C>>3]*1389796,ue=ue-+(~~(ue/2147483647)|0)*2147483647,A[C>>3]=ue,re=ue/2147483647<.5|ee<<1,S=T,re|0):(re=(r[(n[m+348>>2]|0)+ee>>0]|0)!=0|ee<<1,S=T,re|0):(oe=r[528]|0,re=oe&255,re=((re>>>1^1)&G<<24>>24==oe<<24>>24|R&2&re|0)!=0|ee<<1,S=T,re|0))}function V(m,T,x,C){m=m|0,T=T|0,x=x|0,C=C|0;var B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0,we=0,_e=0,Be=0,Xe=0,Qe=0,at=0,kt=0,hi=0,ri=0,dt=0,Yt=0,ii=0,qt=0,ei=0,Rt=0,$t=0,Ft=0,lt=0,di=0,vi=0,gi=0,Si=0,Fi=0,Ts=0,pi=0,Us=0,os=0;B=S,S=S+16|0,X=B+8|0,we=B+4|0,ee=B,G=x+4|0,F=n[G>>2]|0,R=x+8|0,(F|0)==(n[R>>2]|0)&&(oe=(F>>1)+2&-2,oe=(oe|0)<2?2:oe,(oe|0)>(2147483647-F|0)&&(pi=Ae(1)|0,Qt(pi|0,48,0)),Ts=n[x>>2]|0,pi=oe+F|0,n[R>>2]=pi,pi=vs(Ts,pi<<2)|0,n[x>>2]=pi,!(pi|0)&&(n[(Ht()|0)>>2]|0)==12&&(pi=Ae(1)|0,Qt(pi|0,48,0)),F=n[G>>2]|0),R=(n[x>>2]|0)+(F<<2)|0,R&&(n[R>>2]=0,F=n[G>>2]|0),n[G>>2]=F+1,oe=m+544|0,ei=m+280|0,F=m+588|0,R=m+396|0,dt=m+504|0,ii=m+316|0,Yt=m+540|0,ri=m+476|0,hi=m+472|0,kt=m+460|0,at=m+488|0,Qe=m+296|0,Be=m+496|0,Xe=m+272|0,qt=m+268|0,$t=-2,Rt=(n[m+284>>2]|0)+-1|0,Ft=0;do{if(lt=n[oe>>2]|0,T=lt+(T<<2)|0,di=n[T>>2]|0,di&4|0&&(ue=+A[Be>>3],pi=T+(di>>>5<<2)+4|0,Us=ue+ +d[pi>>2],d[pi>>2]=Us,Us>1e20)){if(gi=n[Xe>>2]|0,(gi|0)>0){vi=n[qt>>2]|0,di=0;do pi=lt+(n[vi+(di<<2)>>2]<<2)|0,pi=pi+((n[pi>>2]|0)>>>5<<2)+4|0,d[pi>>2]=+d[pi>>2]*1e-20,di=di+1|0;while((di|0)!=(gi|0))}A[Be>>3]=ue*1e-20}if($t=($t|0)!=-2&1,$t>>>0<(n[T>>2]|0)>>>5>>>0)do{di=n[T+($t<<2)+4>>2]|0,n[we>>2]=di,di=di>>1,lt=(n[F>>2]|0)+di|0;do if(!(r[lt>>0]|0)&&(n[(n[R>>2]|0)+(di<<3)+4>>2]|0)>0){if(gi=n[ii>>2]|0,pi=gi+(di<<3)|0,Us=+A[dt>>3]+ +A[pi>>3],A[pi>>3]=Us,Us>1e100){if(Si=n[Yt>>2]|0,(Si|0)>0){vi=0;do pi=gi+(vi<<3)|0,A[pi>>3]=+A[pi>>3]*1e-100,vi=vi+1|0;while((vi|0)!=(Si|0))}A[dt>>3]=+A[dt>>3]*1e-100}if((n[ri>>2]|0)>(di|0)&&(_e=n[hi>>2]|0,re=n[_e+(di<<2)>>2]|0,(re|0)>-1)){vi=n[kt>>2]|0,gi=n[vi+(re<<2)>>2]|0;e:do if(!re)Ts=0;else for(pi=re;;){if(Ts=pi,pi=pi+-1>>1,Fi=vi+(pi<<2)|0,Si=n[Fi>>2]|0,os=n[n[at>>2]>>2]|0,!(+A[os+(gi<<3)>>3]>+A[os+(Si<<3)>>3]))break e;if(n[vi+(Ts<<2)>>2]=Si,n[_e+(n[Fi>>2]<<2)>>2]=Ts,!pi){Ts=0;break}}while(!1);n[vi+(Ts<<2)>>2]=gi,n[_e+(gi<<2)>>2]=Ts}if(r[lt>>0]=1,(n[(n[R>>2]|0)+(di<<3)+4>>2]|0)<(n[Qe>>2]|0)){Ys(x,we);break}else{Ft=Ft+1|0;break}}while(!1);$t=$t+1|0}while(($t|0)<((n[T>>2]|0)>>>5|0));T=n[ei>>2]|0,lt=n[F>>2]|0;do $t=Rt,Rt=Rt+-1|0,$t=n[T+($t<<2)>>2]|0,vi=$t>>1,di=lt+vi|0;while(!(r[di>>0]|0));T=n[(n[R>>2]|0)+(vi<<3)>>2]|0,r[di>>0]=0,Ft=Ft+-1|0}while((Ft|0)>0);if(n[n[x>>2]>>2]=$t^1,we=m+616|0,Be=n[we>>2]|0,re=m+620|0,Be?(n[re>>2]=0,Xe=0):Xe=n[re>>2]|0,_e=n[G>>2]|0,(Xe|0)<(_e|0)){at=m+624|0,Qe=n[at>>2]|0,(Qe|0)<(_e|0)&&(os=_e+1-Qe&-2,Xe=(Qe>>1)+2&-2,Xe=(os|0)>(Xe|0)?os:Xe,(Xe|0)>(2147483647-Qe|0)&&(os=Ae(1)|0,Qt(os|0,48,0)),os=Xe+Qe|0,n[at>>2]=os,Be=vs(Be,os<<2)|0,n[we>>2]=Be,!(Be|0)&&(n[(Ht()|0)>>2]|0)==12&&(os=Ae(1)|0,Qt(os|0,48,0))),Xe=n[re>>2]|0;e:do if((Xe|0)<(_e|0))for(;;){if(Be=Be+(Xe<<2)|0,Be&&(n[Be>>2]=0),Xe=Xe+1|0,(Xe|0)==(_e|0))break e;Be=n[we>>2]|0}while(!1);n[re>>2]=_e,_e=n[G>>2]|0}if((_e|0)>0){Xe=n[we>>2]|0,Be=n[x>>2]|0,Qe=0;do n[Xe+(Qe<<2)>>2]=n[Be+(Qe<<2)>>2],Qe=Qe+1|0,_e=n[G>>2]|0;while((Qe|0)<(_e|0))}if(Be=n[m+84>>2]|0,(Be|0)==1)if((_e|0)>1)for(ee=n[x>>2]|0,z=1,Be=1;;){_e=n[ee+(z<<2)>>2]|0,X=n[R>>2]|0,Xe=n[X+(_e>>1<<3)>>2]|0;e:do if((Xe|0)!=-1){if(Qe=(n[oe>>2]|0)+(Xe<<2)|0,at=n[Qe>>2]|0,at>>>0>63){for(Xe=n[F>>2]|0,kt=1;os=n[Qe+(kt<<2)+4>>2]>>1,!(!(r[Xe+os>>0]|0)&&(n[X+(os<<3)+4>>2]|0)>0);)if(kt=kt+1|0,(kt|0)>=(at>>>5|0))break e;n[ee+(Be<<2)>>2]=_e,Be=Be+1|0}}else n[ee+(Be<<2)>>2]=_e,Be=Be+1|0;while(!1);if(z=z+1|0,X=n[G>>2]|0,(z|0)>=(X|0)){ee=X;break}}else ee=_e,z=1,Be=1;else if((Be|0)==2)if((_e|0)>1){oe=1,Be=1;do Xe=n[x>>2]|0,_e=n[Xe+(oe<<2)>>2]|0,(n[(n[R>>2]|0)+(_e>>1<<3)>>2]|0)!=-1?(n[ee>>2]=_e,n[X+0>>2]=n[ee+0>>2],j(m,X)|0||(_e=n[x>>2]|0,Xe=_e,_e=n[_e+(oe<<2)>>2]|0,z=62)):z=62,(z|0)==62&&(z=0,n[Xe+(Be<<2)>>2]=_e,Be=Be+1|0),oe=oe+1|0,_e=n[G>>2]|0;while((oe|0)<(_e|0));ee=_e,z=oe}else ee=_e,z=1,Be=1;else ee=_e,z=_e,Be=_e;if(os=m+240|0,pi=os,pi=ts(n[pi>>2]|0,n[pi+4>>2]|0,ee|0,((ee|0)<0)<<31>>31|0)|0,n[os>>2]=pi,n[os+4>>2]=ht,z=z-Be|0,(z|0)>0&&(ee=ee-z|0,n[G>>2]=ee),os=m+248|0,pi=os,pi=ts(n[pi>>2]|0,n[pi+4>>2]|0,ee|0,((ee|0)<0)<<31>>31|0)|0,n[os>>2]=pi,n[os+4>>2]=ht,(ee|0)==1)x=0;else{if(x=n[x>>2]|0,(ee|0)>2){m=n[R>>2]|0,G=2,z=1;do z=(n[m+(n[x+(G<<2)>>2]>>1<<3)+4>>2]|0)>(n[m+(n[x+(z<<2)>>2]>>1<<3)+4>>2]|0)?G:z,G=G+1|0;while((G|0)<(ee|0))}else z=1;pi=x+(z<<2)|0,os=n[pi>>2]|0,x=x+4|0,n[pi>>2]=n[x>>2],n[x>>2]=os,x=n[(n[R>>2]|0)+(os>>1<<3)+4>>2]|0}if(n[C>>2]=x,(n[re>>2]|0)>0)C=0;else{S=B;return}do r[(n[F>>2]|0)+(n[(n[we>>2]|0)+(C<<2)>>2]>>1)>>0]=0,C=C+1|0;while((C|0)<(n[re>>2]|0));S=B}function j(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0,we=0,_e=0,Be=0,Xe=0;for(x=S,X=n[T>>2]|0,ee=m+396|0,re=n[ee>>2]|0,G=m+544|0,_e=(n[G>>2]|0)+(n[re+(X>>1<<3)>>2]<<2)|0,F=m+604|0,C=m+608|0,n[F>>2]|0&&(n[C>>2]=0),B=m+588|0,R=m+612|0,m=m+616|0,oe=1;;){if(oe>>>0<(n[_e>>2]|0)>>>5>>>0){if(we=n[_e+(oe<<2)+4>>2]|0,ue=we>>1,n[re+(ue<<3)+4>>2]|0&&(z=r[(n[B>>2]|0)+ue>>0]|0,(z+-1<<24>>24&255)>=2)){if(_e=n[C>>2]|0,Be=(_e|0)==(n[R>>2]|0),z<<24>>24==3||(n[re+(ue<<3)>>2]|0)==-1){G=8;break}if(Be){if(re=(_e>>1)+2&-2,re=(re|0)<2?2:re,(re|0)>(2147483647-_e|0)){G=24;break}if(Xe=n[F>>2]|0,Be=re+_e|0,n[R>>2]=Be,Be=vs(Xe,Be<<3)|0,n[F>>2]=Be,!(Be|0)&&(n[(Ht()|0)>>2]|0)==12){G=24;break}_e=n[C>>2]|0}n[C>>2]=_e+1,re=(n[F>>2]|0)+(_e<<3)|0,re&&(Xe=re,n[Xe>>2]=oe,n[Xe+4>>2]=X),n[T>>2]=we,_e=n[ee>>2]|0,X=we,re=_e,_e=(n[G>>2]|0)+(n[_e+(ue<<3)>>2]<<2)|0,oe=0}}else{if(X=(n[B>>2]|0)+(X>>1)|0,r[X>>0]|0||(r[X>>0]=2,Ys(m,T)),X=n[C>>2]|0,!X){C=1,G=34;break}Xe=X+-1|0,X=n[F>>2]|0,oe=n[X+(Xe<<3)>>2]|0,X=n[X+(Xe<<3)+4>>2]|0,n[T>>2]=X,re=n[ee>>2]|0,_e=(n[G>>2]|0)+(n[re+(X>>1<<3)>>2]<<2)|0,n[C>>2]=Xe}oe=oe+1|0}if((G|0)==8){if(Be&&(G=(_e>>1)+2&-2,G=(G|0)<2?2:G,(G|0)>(2147483647-_e|0)&&(Xe=Ae(1)|0,Qt(Xe|0,48,0)),Be=n[F>>2]|0,Xe=G+_e|0,n[R>>2]=Xe,Xe=vs(Be,Xe<<3)|0,n[F>>2]=Xe,!(Xe|0)&&(n[(Ht()|0)>>2]|0)==12&&(Xe=Ae(1)|0,Qt(Xe|0,48,0)),_e=n[C>>2]|0),R=_e+1|0,n[C>>2]=R,G=(n[F>>2]|0)+(_e<<3)|0,G&&(R=G,n[R>>2]=0,n[R+4>>2]=X,R=n[C>>2]|0),(R|0)>0)G=0;else return Xe=0,S=x,Xe|0;do ee=(n[B>>2]|0)+(n[(n[F>>2]|0)+(G<<3)+4>>2]>>1)|0,r[ee>>0]|0||(r[ee>>0]=3,Ys(m,(n[F>>2]|0)+(G<<3)+4|0),R=n[C>>2]|0),G=G+1|0;while((G|0)<(R|0));return C=0,S=x,C|0}else if((G|0)==24)Qt(Ae(1)|0,48,0);else if((G|0)==34)return S=x,C|0;return 0}function se(m,T,x){m=m|0,T=T|0,x=x|0;var C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0,we=0,_e=0,Be=0,Xe=0,Qe=0;if(R=S,S=S+32|0,F=R+16|0,B=R+12|0,G=R+8|0,C=R,X=x+20|0,ee=x+16|0,(n[X>>2]|0)>0){z=0;do r[(n[x>>2]|0)+(n[(n[ee>>2]|0)+(z<<2)>>2]|0)>>0]=0,z=z+1|0;while((z|0)<(n[X>>2]|0))}if(n[ee>>2]|0&&(n[X>>2]=0),z=n[T>>2]|0,n[G>>2]=z,n[B>>2]=z,n[F+0>>2]=n[B+0>>2],Zn(x,F,0),ee=(n[x>>2]|0)+z|0,r[ee>>0]|0||(r[ee>>0]=1,Ys(x+16|0,G)),!(n[m+296>>2]|0)){S=R;return}if(T=z>>1,oe=m+588|0,r[(n[oe>>2]|0)+T>>0]=1,ue=n[m+284>>2]|0,X=m+292|0,_e=n[n[X>>2]>>2]|0,(ue|0)>(_e|0)){G=m+280|0,ee=m+396|0,z=x+16|0,m=m+544|0;do if(ue=ue+-1|0,we=n[(n[G>>2]|0)+(ue<<2)>>2]|0,re=we>>1,r[(n[oe>>2]|0)+re>>0]|0){_e=n[ee>>2]|0,Be=n[_e+(re<<3)>>2]|0;e:do if((Be|0)==-1)we=we^1,n[C>>2]=we,n[B>>2]=we,n[F+0>>2]=n[B+0>>2],Zn(x,F,0),we=(n[x>>2]|0)+we|0,r[we>>0]|0||(r[we>>0]=1,Ys(z,C));else if(we=(n[m>>2]|0)+(Be<<2)|0,Be=n[we>>2]|0,Be>>>0>63)for(Xe=1;;){if(Qe=n[we+(Xe<<2)+4>>2]>>1,(n[_e+(Qe<<3)+4>>2]|0)>0&&(r[(n[oe>>2]|0)+Qe>>0]=1,Be=n[we>>2]|0),Xe=Xe+1|0,(Xe|0)>=(Be>>>5|0))break e;_e=n[ee>>2]|0}while(!1);r[(n[oe>>2]|0)+re>>0]=0,_e=n[n[X>>2]>>2]|0}while((ue|0)>(_e|0))}r[(n[oe>>2]|0)+T>>0]=0,S=R}function le(m){m=m|0;var T=0,x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0,we=0,_e=0,Be=0,Xe=0,Qe=0,at=0;if(x=S,S=S+16|0,z=x+4|0,we=x,T=m+272|0,Be=n[T>>2]|0,G=+A[m+496>>3]/+(Be|0),B=m+544|0,F=m+268|0,_e=n[F>>2]|0,n[we>>2]=B,n[z+0>>2]=n[we+0>>2],Qn(_e,Be,z),z=n[T>>2]|0,(z|0)>0){R=m+332|0,ee=m+396|0,X=0,_e=0;do{re=n[F>>2]|0,we=n[re+(X<<2)>>2]|0,Be=n[B>>2]|0,oe=Be+(we<<2)|0,ue=n[oe>>2]|0;do if(ue>>>0>95){if(Xe=n[Be+(we+1<<2)>>2]|0,Be=Xe>>1,Xe=(l[(n[R>>2]|0)+Be>>0]|0)^Xe&1,at=r[528]|0,Qe=at&255,(Xe&255)<<24>>24==at<<24>>24&(Qe>>>1^1)|Qe&2&Xe|0&&(at=n[(n[ee>>2]|0)+(Be<<3)>>2]|0,(at|0)!=-1&(at|0)==(we|0))){C=9;break}if((X|0)>=((z|0)/2|0|0)&&!(+d[oe+(ue>>>5<<2)+4>>2]<G)){C=9;break}to(m,we)}else C=9;while(!1);(C|0)==9&&(C=0,n[re+(_e<<2)>>2]=we,_e=_e+1|0),X=X+1|0,z=n[T>>2]|0}while((X|0)<(z|0))}else X=0,_e=0;if(C=X-_e|0,(C|0)>0&&(n[T>>2]=z-C),!(+((n[m+556>>2]|0)>>>0)>+A[m+96>>3]*+((n[m+548>>2]|0)>>>0))){S=x;return}vo[n[(n[m>>2]|0)+8>>2]&31](m),S=x}function Pe(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0,we=0,_e=0,Be=0,Xe=0,Qe=0,at=0;if(x=S,C=T+4|0,ee=n[C>>2]|0,(ee|0)>0){F=m+544|0,B=m+332|0,R=0,G=0;do{Be=n[T>>2]|0,oe=n[Be+(R<<2)>>2]|0,ee=(n[F>>2]|0)+(oe<<2)|0,X=n[ee>>2]|0;do if(X>>>0>31){Xe=n[B>>2]|0,re=r[528]|0,ue=re&255,Qe=ue&2,ue=ue>>>1^1,we=X>>>5,_e=0;do if(at=n[ee+(_e<<2)+4>>2]|0,at=(l[Xe+(at>>1)>>0]|0)^at&1,_e=_e+1|0,(at&255)<<24>>24==re<<24>>24&ue|Qe&at){z=7;break}while((_e|0)<(we|0));if((z|0)==7){z=0,to(m,oe);break}if(X>>>0>95){z=r[536]|0,ue=X>>>5,oe=2;do re=ee+(oe<<2)+4|0,at=n[re>>2]|0,at=(l[(n[B>>2]|0)+(at>>1)>>0]|0)^at&1,Qe=z&255,(at&255)<<24>>24==z<<24>>24&(Qe>>>1^1)|Qe&2&at&&(n[re>>2]=n[ee+(ue+-1<<2)+4>>2],X=n[ee>>2]|0,X&8&&(X=X>>>5,n[ee+(X+-1<<2)+4>>2]=n[ee+(X<<2)+4>>2],X=n[ee>>2]|0),X=X+-32|0,n[ee>>2]=X,oe=oe+-1|0),oe=oe+1|0,ue=X>>>5;while((oe|0)<(ue|0));oe=n[T>>2]|0,Be=oe,oe=n[oe+(R<<2)>>2]|0,z=16}else z=16}else z=16;while(!1);(z|0)==16&&(z=0,n[Be+(G<<2)>>2]=oe,G=G+1|0),R=R+1|0,ee=n[C>>2]|0}while((R|0)<(ee|0))}else R=0,G=0;if(T=R-G|0,(T|0)<=0){S=x;return}n[C>>2]=ee-T,S=x}function De(m){m=m|0;var T=0,x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0;if(B=S,S=S+16|0,x=B+4|0,F=B,n[x>>2]=0,T=x+4|0,n[T>>2]=0,C=x+8|0,n[C>>2]=0,n[F>>2]=0,R=m+540|0,X=n[R>>2]|0,(X|0)>0){ee=m+380|0,G=m+332|0,z=0;do r[(n[ee>>2]|0)+z>>0]|0&&(ue=r[(n[G>>2]|0)+z>>0]|0,re=r[544]|0,oe=re&255,((oe>>>1^1)&ue<<24>>24==re<<24>>24|ue&2&oe|0)!=0)&&(Xi(x,F),X=n[R>>2]|0),z=z+1|0,n[F>>2]=z;while((z|0)<(X|0))}if(cn(m+460|0,x),m=n[x>>2]|0,!m){S=B;return}n[T>>2]=0,yi(m),n[x>>2]=0,n[C>>2]=0,S=B}function $e(m){m=m|0;var T=0,x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0,we=0;if(T=S,C=m+492|0,r[C>>0]|0&&(Cr(m)|0)==-1){if(C=m+284|0,B=m+516|0,(n[C>>2]|0)==(n[B>>2]|0)||(F=m+520|0,we=F,re=n[we+4>>2]|0,(re|0)>0|(re|0)==0&(n[we>>2]|0)>>>0>0))return we=1,S=T,we|0;if(Pe(m,m+268|0),r[m+536>>0]|0){if(Pe(m,m+256|0),G=m+564|0,R=m+568|0,(n[R>>2]|0)>0){z=m+588|0,ee=0;do r[(n[z>>2]|0)+(n[(n[G>>2]|0)+(ee<<2)>>2]|0)>>0]=1,ee=ee+1|0;while((ee|0)<(n[R>>2]|0))}if(oe=n[C>>2]|0,(oe|0)>0){ee=n[m+280>>2]|0,z=n[m+588>>2]|0,ue=0,X=0;do re=n[ee+(ue<<2)>>2]|0,r[z+(re>>1)>>0]|0||(n[ee+(X<<2)>>2]=re,oe=n[C>>2]|0,X=X+1|0),ue=ue+1|0;while((ue|0)<(oe|0))}else ue=0,X=0;ee=ue-X|0,(ee|0)>0&&(oe=oe-ee|0,n[C>>2]=oe),n[m+512>>2]=oe;e:do if((n[R>>2]|0)>0){X=m+588|0,ee=0;do r[(n[X>>2]|0)+(n[(n[G>>2]|0)+(ee<<2)>>2]|0)>>0]=0,ee=ee+1|0,z=n[R>>2]|0;while((ee|0)<(z|0));if((z|0)>0){for(z=m+580|0,X=m+584|0,ee=m+576|0,oe=0;;){if(re=n[z>>2]|0,(re|0)==(n[X>>2]|0)){if(ue=(re>>1)+2&-2,ue=(ue|0)<2?2:ue,(ue|0)>(2147483647-re|0)){x=28;break}if(we=n[ee>>2]|0,ue=ue+re|0,n[X>>2]=ue,ue=vs(we,ue<<2)|0,n[ee>>2]=ue,!(ue|0)&&(n[(Ht()|0)>>2]|0)==12){x=28;break}re=n[z>>2]|0}else ue=n[ee>>2]|0;if(we=ue+(re<<2)|0,we&&(n[we>>2]=0,re=n[z>>2]|0),n[z>>2]=re+1,we=n[G>>2]|0,n[ue+(re<<2)>>2]=n[we+(oe<<2)>>2],oe=oe+1|0,(oe|0)>=(n[R>>2]|0))break e}(x|0)==28&&Qt(Ae(1)|0,48,0)}else x=21}else x=21;while(!1);(x|0)==21&&(we=n[G>>2]|0),we&&(n[R>>2]=0)}return+((n[m+556>>2]|0)>>>0)>+A[m+96>>3]*+((n[m+548>>2]|0)>>>0)&&vo[n[(n[m>>2]|0)+8>>2]&31](m),De(m),n[B>>2]=n[C>>2],re=m+224|0,we=m+232|0,re=ts(n[we>>2]|0,n[we+4>>2]|0,n[re>>2]|0,n[re+4>>2]|0)|0,we=F,n[we>>2]=re,n[we+4>>2]=ht,we=1,S=T,we|0}return r[C>>0]=0,we=0,S=T,we|0}function st(m,T,x){m=m|0,T=T|0,x=x|0;var C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0,we=0,_e=0,Be=0,Xe=0,Qe=0,at=0,kt=0,hi=0,ri=0,dt=0,Yt=0,ii=0,qt=0,ei=0,Rt=0,$t=0,Ft=0,lt=0,di=0,vi=0,gi=0,Si=0,Fi=0,Ts=0,pi=0,Us=0,os=0,Ho=0,mn=0,en=0,Zr=0,ws=0,tn=0,Ji=0,Gn=0,br=0,xn=0,Mi=0,Ns=0,Ks=0,So=0,Gs=0,wl=0,gh=0,el=0,Ca=0,sn=0,ro=0,_s=0,ci=0,ir=0;R=S,S=S+64|0,en=R,Yt=R+60|0,kt=R+56|0,C=R+44|0,Zr=R+40|0,n[C>>2]=0,F=C+4|0,n[F>>2]=0,B=C+8|0,n[B>>2]=0,lt=T+160|0,Ft=lt,Ft=ts(n[Ft>>2]|0,n[Ft+4>>2]|0,1,0)|0,n[lt>>2]=Ft,n[lt+4>>2]=ht,lt=(x|0)<0,Ft=T+680|0,$t=T+664|0,Rt=T+672|0,z=T+296|0,_e=T+272|0,G=T+284|0,qt=T+640|0,dt=T+308|0,ri=T+304|0,X=T+332|0,ii=T+292|0,tn=T+168|0,ue=T+396|0,we=T+280|0,ei=T+184|0,hi=T+192|0,re=T+48|0,Ts=T+504|0,Ho=T+56|0,ws=T+496|0,Ji=T+656|0,di=T+144|0,vi=T+648|0,gi=T+128|0,Si=T+44|0,Fi=T+200|0,pi=T+208|0,Us=T+224|0,os=T+216|0,oe=T+232|0,mn=T+540|0,ee=T+292|0,Be=T+544|0,Qe=T+276|0,Xe=T+268|0,at=T+268|0,Gn=0;e:for(;;){for(br=lt|(Gn|0)<(x|0);Mi=Cr(T)|0,(Mi|0)==-1;){if(!br){Mi=41;break e}if(r[Ft>>0]|0){Mi=41;break e}if(Mi=$t,Ns=n[Mi+4>>2]|0,(Ns|0)>=0&&(ci=hi,_s=n[ci+4>>2]|0,!(_s>>>0<Ns>>>0|((_s|0)==(Ns|0)?(n[ci>>2]|0)>>>0<(n[Mi>>2]|0)>>>0:0)))){Mi=41;break e}if(Mi=Rt,Ns=n[Mi+4>>2]|0,(Ns|0)>=0&&(ci=ei,_s=n[ci+4>>2]|0,!(_s>>>0<Ns>>>0|((_s|0)==(Ns|0)?(n[ci>>2]|0)>>>0<(n[Mi>>2]|0)>>>0:0)))){Mi=41;break e}if(!(n[z>>2]|0)&&!($e(T)|0)){Mi=50;break e}for(+((n[_e>>2]|0)-(n[G>>2]|0)|0)>=+A[qt>>3]&&le(T);;){if(Mi=n[z>>2]|0,(Mi|0)>=(n[dt>>2]|0)){Mi=59;break}if(Gs=n[(n[ri>>2]|0)+(Mi<<2)>>2]|0,Ns=l[(n[X>>2]|0)+(Gs>>1)>>0]|0,ci=Ns^Gs&1,Ks=ci&255,sn=r[528]|0,_s=sn&255,!(Ks<<24>>24==sn<<24>>24&(_s>>>1^1)|_s&2&ci)){Mi=56;break}n[Yt>>2]=n[G>>2],Xi(ii,Yt)}if((Mi|0)==56){if(Mi=0,_s=r[536]|0,ci=_s&255,(ci>>>1^1)&Ks<<24>>24==_s<<24>>24|Ns&2&ci){Mi=57;break e}(Gs|0)==-2&&(Mi=59)}if((Mi|0)==59&&(ci=tn,ci=ts(n[ci>>2]|0,n[ci+4>>2]|0,1,0)|0,Gs=tn,n[Gs>>2]=ci,n[Gs+4>>2]=ht,Gs=pl(T)|0,(Gs|0)==-2)){Mi=60;break e}n[en>>2]=n[G>>2],Xi(ii,en),ci=Gs>>1,r[(n[X>>2]|0)+ci>>0]=(Gs&1^1)&255^1,_s=n[z>>2]|0,ci=(n[ue>>2]|0)+(ci<<3)|0,n[ci>>2]=-1,n[ci+4>>2]=_s,ci=n[G>>2]|0,n[G>>2]=ci+1,n[(n[we>>2]|0)+(ci<<2)>>2]=Gs}if(_s=hi,_s=ts(n[_s>>2]|0,n[_s+4>>2]|0,1,0)|0,ci=hi,n[ci>>2]=_s,n[ci+4>>2]=ht,Gn=Gn+1|0,!(n[z>>2]|0)){Mi=5;break}if(n[C>>2]|0&&(n[F>>2]=0),V(T,Mi,C,kt),Yr(T,n[kt>>2]|0),(n[F>>2]|0)==1)_s=n[n[C>>2]>>2]|0,ci=_s>>1,r[(n[X>>2]|0)+ci>>0]=(_s&1^1)&255^1,sn=n[z>>2]|0,ci=(n[ue>>2]|0)+(ci<<3)|0,n[ci>>2]=-1,n[ci+4>>2]=sn,ci=n[G>>2]|0,n[G>>2]=ci+1,n[(n[we>>2]|0)+(ci<<2)>>2]=_s;else{if(br=$s(Be,C,1)|0,Mi=n[_e>>2]|0,(Mi|0)==(n[Qe>>2]|0)){if(Ns=(Mi>>1)+2&-2,Ns=(Ns|0)<2?2:Ns,(Ns|0)>(2147483647-Mi|0)){Mi=14;break}if(_s=n[Xe>>2]|0,ci=Ns+Mi|0,n[Qe>>2]=ci,ci=vs(_s,ci<<2)|0,n[Xe>>2]=ci,!(ci|0)&&(n[(Ht()|0)>>2]|0)==12){Mi=14;break}Mi=n[_e>>2]|0}if(n[_e>>2]=Mi+1,Mi=(n[Xe>>2]|0)+(Mi<<2)|0,Mi&&(n[Mi>>2]=br),eo(T,br),Ks=n[Be>>2]|0,ci=Ks+(br<<2)|0,xn=+A[ws>>3],ci=ci+((n[ci>>2]|0)>>>5<<2)+4|0,ir=xn+ +d[ci>>2],d[ci>>2]=ir,ir>1e20){if(Ns=n[_e>>2]|0,(Ns|0)>0){Mi=n[at>>2]|0,Gs=0;do ci=Ks+(n[Mi+(Gs<<2)>>2]<<2)|0,ci=ci+((n[ci>>2]|0)>>>5<<2)+4|0,d[ci>>2]=+d[ci>>2]*1e-20,Gs=Gs+1|0;while((Gs|0)!=(Ns|0))}A[ws>>3]=xn*1e-20}_s=n[n[C>>2]>>2]|0,ci=_s>>1,r[(n[X>>2]|0)+ci>>0]=(_s&1^1)&255^1,sn=n[z>>2]|0,ci=(n[ue>>2]|0)+(ci<<3)|0,n[ci>>2]=br,n[ci+4>>2]=sn,ci=n[G>>2]|0,n[G>>2]=ci+1,n[(n[we>>2]|0)+(ci<<2)>>2]=_s}if(A[Ts>>3]=1/+A[re>>3]*+A[Ts>>3],A[ws>>3]=1/+A[Ho>>3]*+A[ws>>3],ci=(n[Ji>>2]|0)+-1|0,n[Ji>>2]=ci,!ci&&(xn=+A[di>>3]*+A[vi>>3],A[vi>>3]=xn,n[Ji>>2]=~~xn,xn=+A[gi>>3]*+A[qt>>3],A[qt>>3]=xn,!((n[Si>>2]|0)<=0))){if(Mi=n[hi>>2]|0,br=n[Fi>>2]|0,Ca=n[z>>2]|0,Ca?Ns=n[ee>>2]|0:Ns=G,Ns=n[Ns>>2]|0,el=n[pi>>2]|0,gh=n[Us>>2]|0,wl=n[os>>2]|0,Gs=oe,Ks=n[Gs>>2]|0,Gs=n[Gs+4>>2]|0,So=+(n[mn>>2]|0),ro=1/So,(Ca|0)<0)ir=0;else for(sn=0,ir=0;sn?_s=n[(n[ee>>2]|0)+(sn+-1<<2)>>2]|0:_s=0,(sn|0)==(Ca|0)?ci=G:ci=(n[ee>>2]|0)+(sn<<2)|0,ir=ir+ +Kt(+ro,+ +(sn|0))*+((n[ci>>2]|0)-_s|0),(sn|0)!=(Ca|0);)sn=sn+1|0;n[en>>2]=Mi,n[en+4>>2]=br-Ns,n[en+8>>2]=el,n[en+12>>2]=gh,n[en+16>>2]=~~xn,n[en+20>>2]=wl,ci=en+24|0,A[I>>3]=(+(Ks>>>0)+4294967296*+(Gs>>>0))/+(wl|0),n[ci>>2]=n[I>>2],n[ci+4>>2]=n[I+4>>2],ci=en+32|0,A[I>>3]=ir/So*100,n[ci>>2]=n[I>>2],n[ci+4>>2]=n[I+4>>2],Vt(1832,en|0)|0}}if((Mi|0)==5)r[m>>0]=r[536]|0;else if((Mi|0)==14)Qt(Ae(1)|0,48,0);else if((Mi|0)==41){if(xn=+(n[mn>>2]|0),So=1/xn,X=n[z>>2]|0,(X|0)<0)ro=0;else for(z=0,ro=0;z?oe=n[(n[ee>>2]|0)+(z+-1<<2)>>2]|0:oe=0,(z|0)==(X|0)?ue=G:ue=(n[ee>>2]|0)+(z<<2)|0,ro=ro+ +Kt(+So,+ +(z|0))*+((n[ue>>2]|0)-oe|0),(z|0)!=(X|0);)z=z+1|0;A[T+528>>3]=ro/xn,Yr(T,0),r[m>>0]=r[544]|0}else(Mi|0)==50?r[m>>0]=r[536]|0:(Mi|0)==57?(n[Zr>>2]=Gs^1,ci=T+16|0,n[en+0>>2]=n[Zr+0>>2],se(T,en,ci),r[m>>0]=r[536]|0):(Mi|0)==60&&(r[m>>0]=r[528]|0);if(m=n[C>>2]|0,!m){S=R;return}n[F>>2]=0,yi(m),n[C>>2]=0,n[B>>2]=0,S=R}function At(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0,we=0,_e=0,Be=0,Xe=0,Qe=0,at=0,kt=0,hi=0,ri=0,dt=0;if(C=S,S=S+16|0,F=C,x=T+4|0,n[x>>2]|0&&(n[T+8>>2]=0),B=T+36|0,R=T+32|0,(n[B>>2]|0)>0){G=T+16|0,ee=0;do r[(n[G>>2]|0)+(n[(n[R>>2]|0)+(ee<<2)>>2]|0)>>0]=0,ee=ee+1|0;while((ee|0)<(n[B>>2]|0))}if(n[R>>2]|0&&(n[B>>2]=0),R=T+492|0,!(r[R>>0]|0)){r[m>>0]=r[536]|0,S=C;return}G=T+152|0,kt=G,kt=ts(n[kt>>2]|0,n[kt+4>>2]|0,1,0)|0,n[G>>2]=kt,n[G+4>>2]=ht,hi=+A[T+120>>3]*+(n[T+208>>2]|0),G=T+640|0,A[G>>3]=hi,Xe=+(n[T+104>>2]|0),hi<Xe&&(A[G>>3]=Xe),Qe=n[T+136>>2]|0,A[T+648>>3]=+(Qe|0),n[T+656>>2]=Qe,Qe=r[544]|0,G=T+44|0,(n[G>>2]|0)>0?(Tt(2288)|0,Tt(2368)|0,Tt(2448)|0,Tt(2528)|0,X=r[544]|0):X=Qe,z=T+192|0,ee=T+184|0,kt=X&255;e:do if((kt>>>1^1)&Qe<<24>>24==X<<24>>24|Qe&2&kt)for(ue=T+80|0,_e=T+112|0,oe=T+108|0,X=T+680|0,re=T+664|0,we=T+672|0,Be=0;;){if(Xe=+A[_e>>3],!(r[ue>>0]|0))Xe=+Kt(+Xe,+ +(Be|0));else{if(kt=Be+1|0,(Be|0)>0){at=0,Qe=1;do at=at+1|0,Qe=Qe<<1|1;while((Qe|0)<(kt|0));kt=Qe+-1|0}else at=0,kt=0;if((kt|0)!=(Be|0)){Qe=Be;do ri=kt>>1,at=at+-1|0,Qe=(Qe|0)%(ri|0)|0,kt=ri+-1|0;while((kt|0)!=(Qe|0))}Xe=+Kt(+Xe,+ +(at|0))}if(st(F,T,~~(Xe*+(n[oe>>2]|0))),Qe=r[F>>0]|0,r[X>>0]|0||(kt=re,at=n[kt+4>>2]|0,(at|0)>=0&&(ri=z,dt=n[ri+4>>2]|0,!(dt>>>0<at>>>0|((dt|0)==(at|0)?(n[ri>>2]|0)>>>0<(n[kt>>2]|0)>>>0:0))))||(kt=we,at=n[kt+4>>2]|0,(at|0)>=0&&(dt=ee,ri=n[dt+4>>2]|0,!(ri>>>0<at>>>0|((ri|0)==(at|0)?(n[dt>>2]|0)>>>0<(n[kt>>2]|0)>>>0:0)))))break e;if(ri=r[544]|0,dt=ri&255,(dt>>>1^1)&Qe<<24>>24==ri<<24>>24|Qe&2&dt)Be=Be+1|0;else break}while(!1);if((n[G>>2]|0)>0&&Tt(2528)|0,ri=r[528]|0,dt=ri&255,F=Qe&2,!((dt>>>1^1)&Qe<<24>>24==ri<<24>>24|F&dt))ri=r[536]|0,dt=ri&255,(dt>>>1^1)&Qe<<24>>24==ri<<24>>24|F&dt|0&&!(n[B>>2]|0)&&(r[R>>0]=0);else if(B=T+540|0,ps(x,n[B>>2]|0),(n[B>>2]|0)>0){F=T+332|0,R=0;do r[(n[x>>2]|0)+R>>0]=r[(n[F>>2]|0)+R>>0]|0,R=R+1|0;while((R|0)<(n[B>>2]|0))}Yr(T,0),r[m>>0]=Qe,S=C}function Dt(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0,we=0,_e=0,Be=0,Xe=0,Qe=0;if(x=S,B=m+412|0,fr(B),R=m+540|0,(n[R>>2]|0)>0){F=m+544|0,C=0;do{if(G=C<<1,z=n[B>>2]|0,ee=z+(G*12|0)+4|0,(n[ee>>2]|0)>0){oe=z+(G*12|0)|0,X=0;do we=(n[oe>>2]|0)+(X<<3)|0,z=n[we>>2]|0,ue=n[F>>2]|0,re=ue+(z<<2)|0,n[re>>2]&16?n[we>>2]=n[ue+(z+1<<2)>>2]:(_e=Zs(T,re)|0,n[we>>2]=_e,n[re>>2]=n[re>>2]|16,n[ue+(z+1<<2)>>2]=_e),X=X+1|0;while((X|0)<(n[ee>>2]|0));ee=n[B>>2]|0}else ee=z;if(z=G|1,G=ee+(z*12|0)+4|0,(n[G>>2]|0)>0){re=ee+(z*12|0)|0,ue=0;do ee=(n[re>>2]|0)+(ue<<3)|0,oe=n[ee>>2]|0,X=n[F>>2]|0,z=X+(oe<<2)|0,n[z>>2]&16?n[ee>>2]=n[X+(oe+1<<2)>>2]:(_e=Zs(T,z)|0,n[ee>>2]=_e,n[z>>2]=n[z>>2]|16,n[X+(oe+1<<2)>>2]=_e),ue=ue+1|0;while((ue|0)<(n[G>>2]|0))}C=C+1|0}while((C|0)<(n[R>>2]|0))}if(C=m+284|0,(n[C>>2]|0)>0){G=m+280|0,R=m+396|0,F=m+544|0,B=m+332|0,ee=0;do{re=n[R>>2]|0,oe=re+(n[(n[G>>2]|0)+(ee<<2)>>2]>>1<<3)|0,ue=n[oe>>2]|0;do if((ue|0)!=-1){if(_e=n[F>>2]|0,we=_e+(ue<<2)|0,X=(n[we>>2]&16|0)==0,X){if(Be=n[_e+(ue+1<<2)>>2]|0,z=Be>>1,Be=(l[(n[B>>2]|0)+z>>0]|0)^Be&1,Qe=r[528]|0,Xe=Qe&255,!((Be&255)<<24>>24==Qe<<24>>24&(Xe>>>1^1)|Xe&2&Be)||(Qe=n[re+(z<<3)>>2]|0,!((Qe|0)!=-1&(Qe|0)==(ue|0))))break;if(X){Qe=Zs(T,we)|0,n[oe>>2]=Qe,n[we>>2]=n[we>>2]|16,n[_e+(ue+1<<2)>>2]=Qe;break}}n[oe>>2]=n[_e+(ue+1<<2)>>2]}while(!1);ee=ee+1|0}while((ee|0)<(n[C>>2]|0))}if(C=m+272|0,z=n[C>>2]|0,(z|0)>0){F=m+268|0,B=m+544|0,ee=n[F>>2]|0,R=0,G=0;do oe=ee+(R<<2)|0,X=n[oe>>2]|0,re=n[B>>2]|0,ue=re+(X<<2)|0,we=n[ue>>2]|0,(we&3|0)!=1&&(we&16?(z=n[re+(X+1<<2)>>2]|0,n[oe>>2]=z):(z=Zs(T,ue)|0,n[oe>>2]=z,n[ue>>2]=n[ue>>2]|16,n[re+(X+1<<2)>>2]=z,z=n[F>>2]|0,ee=z,z=n[z+(R<<2)>>2]|0),n[ee+(G<<2)>>2]=z,z=n[C>>2]|0,G=G+1|0),R=R+1|0;while((R|0)<(z|0))}else R=0,G=0;if(B=R-G|0,(B|0)>0&&(n[C>>2]=z-B),C=m+260|0,ee=n[C>>2]|0,(ee|0)>0){B=m+256|0,m=m+544|0,G=n[B>>2]|0,F=0,R=0;do z=G+(F<<2)|0,oe=n[z>>2]|0,X=n[m>>2]|0,re=X+(oe<<2)|0,ue=n[re>>2]|0,(ue&3|0)!=1&&(ue&16?(ee=n[X+(oe+1<<2)>>2]|0,n[z>>2]=ee):(ee=Zs(T,re)|0,n[z>>2]=ee,n[re>>2]=n[re>>2]|16,n[X+(oe+1<<2)>>2]=ee,ee=n[B>>2]|0,G=ee,ee=n[ee+(F<<2)>>2]|0),n[G+(R<<2)>>2]=ee,ee=n[C>>2]|0,R=R+1|0),F=F+1|0;while((F|0)<(ee|0))}else F=0,R=0;if(T=F-R|0,(T|0)<=0){S=x;return}n[C>>2]=ee-T,S=x}function St(m){m=m|0;var T=0,x=0,C=0,B=0,F=0,R=0,G=0;B=S,S=S+32|0,R=B,T=B+8|0,x=m+548|0,C=m+556|0,F=(n[x>>2]|0)-(n[C>>2]|0)|0,n[T+0>>2]=0,n[T+4>>2]=0,n[T+8>>2]=0,n[T+12>>2]=0,Zi(T,F),F=T+16|0,r[F>>0]=0,Dt(m,T),(n[m+44>>2]|0)>1&&(G=n[T+4>>2]<<2,n[R>>2]=n[x>>2]<<2,n[R+4>>2]=G,Vt(1888,R|0)|0),r[m+560>>0]=r[F>>0]|0,F=m+544|0,R=n[F>>2]|0,R&&yi(R),n[F>>2]=n[T>>2],n[x>>2]=n[T+4>>2],n[m+552>>2]=n[T+8>>2],n[C>>2]=n[T+12>>2],S=B}function Jt(){var m=0,T=0,x=0;m=S,S=S+16|0,T=m,r[528]=0,r[536]=1,r[544]=2,Fs(552,608,624,2136,2144),n[138]=2168,A[72]=0,A[73]=1,r[592]=0,r[593]=0,o[297]=o[T+0>>1]|0,o[298]=o[T+2>>1]|0,o[299]=o[T+4>>1]|0,A[75]=.95,Fs(664,720,736,2136,2144),n[166]=2168,A[86]=0,A[87]=1,r[704]=0,r[705]=0,o[353]=o[T+0>>1]|0,o[354]=o[T+2>>1]|0,o[355]=o[T+4>>1]|0,A[89]=.999,Fs(776,832,848,2136,2144),n[194]=2168,A[100]=0,A[101]=1,r[816]=1,r[817]=1,o[409]=o[T+0>>1]|0,o[410]=o[T+2>>1]|0,o[411]=o[T+4>>1]|0,A[103]=0,Fs(936,992,1008,2136,2144),n[234]=2168,A[120]=0,A[121]=Le,r[976]=0,r[977]=0,o[489]=o[T+0>>1]|0,o[490]=o[T+2>>1]|0,o[491]=o[T+4>>1]|0,A[123]=91648253,Fs(1048,1080,1096,2136,2016),n[262]=280,x=1068,n[x>>2]=0,n[x+4>>2]=2,n[269]=2,Fs(1160,1192,1208,2136,2016),n[290]=280,x=1180,n[x>>2]=0,n[x+4>>2]=2,n[297]=2,Fs(1272,1296,1312,2136,1992),n[318]=160,r[1292]=0,Fs(1344,1368,1376,2136,1992),n[336]=160,r[1364]=1,Fs(1408,1440,1448,2136,2016),n[352]=280,x=1428,n[x>>2]=1,n[x+4>>2]=2147483647,n[359]=100,Fs(1480,1536,1544,2136,2144),n[370]=2168,A[188]=1,A[189]=Le,r[1520]=0,r[1521]=0,o[761]=o[T+0>>1]|0,o[762]=o[T+2>>1]|0,o[763]=o[T+4>>1]|0,A[191]=2,Fs(1584,1640,1648,2136,2144),n[396]=2168,A[201]=0,A[202]=Le,r[1624]=0,r[1625]=0,o[813]=o[T+0>>1]|0,o[814]=o[T+2>>1]|0,o[815]=o[T+4>>1]|0,A[204]=.2,Fs(1728,1760,1776,2136,2016),n[432]=280,T=1748,n[T>>2]=0,n[T+4>>2]=2147483647,n[439]=0,S=m}function ti(m){m=m|0;var T=0;T=S,ot(m),S=T}function fi(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0;if(x=S,S=S+16|0,F=x,B=x+8|0,(r[T>>0]|0)!=45)return X=0,S=x,X|0;ee=T+1|0,C=m+4|0,R=n[C>>2]|0,G=r[R>>0]|0;e:do if(G<<24>>24){for(z=0;;){if(X=z,z=z+1|0,(r[ee>>0]|0)!=G<<24>>24){m=0;break}if(G=r[R+z>>0]|0,ee=T+(X+2)|0,!(G<<24>>24))break e}return S=x,m|0}while(!1);return(r[ee>>0]|0)!=61||(R=ee+1|0,oe=+lh(R,B),!(n[B>>2]|0))?(X=0,S=x,X|0):(ue=+A[m+32>>3],oe>=ue&&(r[m+41>>0]|0)==0|oe!=ue&&(X=n[Q>>2]|0,z=n[C>>2]|0,n[F>>2]=R,n[F+4>>2]=z,Ri(X|0,2024,F|0)|0,Hs(1)),ue=+A[m+24>>3],oe<=ue&&(r[m+40>>0]|0)==0|oe!=ue&&(X=n[Q>>2]|0,z=n[C>>2]|0,n[F>>2]=R,n[F+4>>2]=z,Ri(X|0,2080,F|0)|0,Hs(1)),A[m+48>>3]=oe,X=1,S=x,X|0)}function zi(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0;if(x=S,S=S+48|0,C=x,B=n[Q>>2]|0,X=n[m+16>>2]|0,G=r[m+40>>0]|0?91:40,z=+A[m+24>>3],ee=+A[m+32>>3],F=r[m+41>>0]|0?93:41,R=+A[m+48>>3],n[C>>2]=n[m+4>>2],n[C+4>>2]=X,n[C+8>>2]=G,G=C+12|0,A[I>>3]=z,n[G>>2]=n[I>>2],n[G+4>>2]=n[I+4>>2],G=C+20|0,A[I>>3]=ee,n[G>>2]=n[I>>2],n[G+4>>2]=n[I+4>>2],n[C+28>>2]=F,F=C+32|0,A[I>>3]=R,n[F>>2]=n[I>>2],n[F+4>>2]=n[I+4>>2],Ri(B|0,2232,C|0)|0,!T){S=x;return}n[C>>2]=n[m+8>>2],Ri(B|0,2e3,C|0)|0,wi(10,B|0)|0,S=x}function Zi(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0;if(x=S,C=m+8|0,B=n[C>>2]|0,B>>>0<T>>>0)R=B;else{S=x;return}for(;!(R>>>0>=T>>>0);)if(R=((R>>>3)+2+(R>>>1)&-2)+R|0,n[C>>2]=R,R>>>0<=B>>>0){F=4;break}(F|0)==4&&Qt(Ae(1)|0,48,0),C=vs(n[m>>2]|0,R<<2)|0,!(C|0)&&(n[(Ht()|0)>>2]|0)==12&&Qt(Ae(1)|0,48,0),n[m>>2]=C,S=x}function Ms(m){m=m|0;var T=0,x=0,C=0,B=0,F=0,R=0,G=0;if(T=S,C=m+32|0,x=n[C>>2]|0,x&&(n[m+36>>2]=0,yi(x),n[C>>2]=0,n[m+40>>2]=0),C=m+16|0,x=n[C>>2]|0,x&&(n[m+20>>2]=0,yi(x),n[C>>2]=0,n[m+24>>2]=0),C=n[m>>2]|0,!C){S=T;return}if(x=m+4|0,F=n[x>>2]|0,(F|0)>0){B=0;do G=C+(B*12|0)|0,R=n[G>>2]|0,R&&(n[C+(B*12|0)+4>>2]=0,yi(R),n[G>>2]=0,n[C+(B*12|0)+8>>2]=0,C=n[m>>2]|0,F=n[x>>2]|0),B=B+1|0;while((B|0)<(F|0))}n[x>>2]=0,yi(C),n[m>>2]=0,n[m+8>>2]=0,S=T}function On(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0;if(B=S,S=S+16|0,C=B+4|0,x=B,z=n[T>>2]|0,R=z+1|0,F=m+4|0,(n[F>>2]|0)<(R|0)){if(ee=m+8|0,G=n[ee>>2]|0,(G|0)<(R|0)&&(X=z+2-G&-2,z=(G>>1)+2&-2,z=(X|0)>(z|0)?X:z,(z|0)>(2147483647-G|0)&&(X=Ae(1)|0,Qt(X|0,48,0)),oe=n[m>>2]|0,X=z+G|0,n[ee>>2]=X,X=vs(oe,X*12|0)|0,n[m>>2]=X,!(X|0)&&(n[(Ht()|0)>>2]|0)==12&&(oe=Ae(1)|0,Qt(oe|0,48,0))),ee=n[F>>2]|0,(ee|0)<(R|0)){G=n[m>>2]|0;do z=G+(ee*12|0)|0,z&&(n[z>>2]=0,n[G+(ee*12|0)+4>>2]=0,n[G+(ee*12|0)+8>>2]=0),ee=ee+1|0;while((ee|0)!=(R|0))}n[F>>2]=R,z=n[T>>2]|0}if(F=n[m>>2]|0,!(n[F+(z*12|0)>>2]|0)){X=z,oe=m+16|0,n[x>>2]=X,n[C+0>>2]=n[x+0>>2],Zn(oe,C,0),S=B;return}n[F+(z*12|0)+4>>2]=0,X=n[T>>2]|0,oe=m+16|0,n[x>>2]=X,n[C+0>>2]=n[x+0>>2],Zn(oe,C,0),S=B}function ps(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0,ee=0;if(C=S,x=m+4|0,(n[x>>2]|0)>=(T|0)){S=C;return}if(F=m+8|0,B=n[F>>2]|0,(B|0)<(T|0)&&(G=T+1-B&-2,R=(B>>1)+2&-2,R=(G|0)>(R|0)?G:R,(R|0)>(2147483647-B|0)&&(G=Ae(1)|0,Qt(G|0,48,0)),ee=n[m>>2]|0,G=R+B|0,n[F>>2]=G,G=vs(ee,G)|0,n[m>>2]=G,!(G|0)&&(n[(Ht()|0)>>2]|0)==12&&(ee=Ae(1)|0,Qt(ee|0,48,0))),B=n[x>>2]|0,(B|0)<(T|0)){m=n[m>>2]|0;do F=m+B|0,F&&(r[F>>0]=0),B=B+1|0;while((B|0)!=(T|0))}n[x>>2]=T,S=C}function hs(m,T,x){m=m|0,T=T|0,x=x|0;var C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0;if(F=S,B=T+1|0,C=m+4|0,(n[C>>2]|0)>=(B|0)){ee=n[m>>2]|0,ee=ee+T|0,r[ee>>0]=x,S=F;return}if(G=m+8|0,R=n[G>>2]|0,(R|0)<(B|0)&&(z=T+2-R&-2,ee=(R>>1)+2&-2,ee=(z|0)>(ee|0)?z:ee,(ee|0)>(2147483647-R|0)&&(z=Ae(1)|0,Qt(z|0,48,0)),X=n[m>>2]|0,z=ee+R|0,n[G>>2]=z,z=vs(X,z)|0,n[m>>2]=z,!(z|0)&&(n[(Ht()|0)>>2]|0)==12&&(X=Ae(1)|0,Qt(X|0,48,0))),R=n[C>>2]|0,(R|0)<(B|0))do G=(n[m>>2]|0)+R|0,G&&(r[G>>0]=0),R=R+1|0;while((R|0)!=(B|0));n[C>>2]=B,X=n[m>>2]|0,X=X+T|0,r[X>>0]=x,S=F}function Ni(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0;if(x=S,S=S+16|0,F=x,n[F>>2]=T,R=m+12|0,B=T+1|0,C=m+16|0,(n[C>>2]|0)<(B|0)&&(ee=m+20|0,G=n[ee>>2]|0,(G|0)<(B|0)&&(X=T+2-G&-2,z=(G>>1)+2&-2,z=(X|0)>(z|0)?X:z,(z|0)>(2147483647-G|0)&&(X=Ae(1)|0,Qt(X|0,48,0)),oe=n[R>>2]|0,X=z+G|0,n[ee>>2]=X,X=vs(oe,X<<2)|0,n[R>>2]=X,!(X|0)&&(n[(Ht()|0)>>2]|0)==12&&(oe=Ae(1)|0,Qt(oe|0,48,0))),G=n[C>>2]|0,(B|0)>(G|0)&&ja((n[R>>2]|0)+(G<<2)|0,-1,B-G<<2|0)|0,n[C>>2]=B),n[(n[R>>2]|0)+(T<<2)>>2]=n[m+4>>2],Xi(m,F),C=n[R>>2]|0,F=n[C+(T<<2)>>2]|0,T=n[m>>2]|0,B=n[T+(F<<2)>>2]|0,!F){X=0,oe=T+(X<<2)|0,n[oe>>2]=B,oe=C+(B<<2)|0,n[oe>>2]=X,S=x;return}for(m=m+28|0;;){if(R=F,F=F+-1>>1,G=T+(F<<2)|0,ee=n[G>>2]|0,oe=n[n[m>>2]>>2]|0,!(+A[oe+(B<<3)>>3]>+A[oe+(ee<<3)>>3])){m=14;break}if(n[T+(R<<2)>>2]=ee,n[C+(n[G>>2]<<2)>>2]=R,!F){R=0,m=14;break}}if((m|0)==14){oe=T+(R<<2)|0,n[oe>>2]=B,oe=C+(B<<2)|0,n[oe>>2]=R,S=x;return}}function Ys(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0;if(x=S,C=m+4|0,B=n[C>>2]|0,F=m+8|0,R=n[F>>2]|0,(B|0)==(R|0)&(R|0)<(B+1|0)?(R=(B>>1)+2&-2,R=(R|0)<2?2:R,(R|0)>(2147483647-B|0)&&(R=Ae(1)|0,Qt(R|0,48,0)),G=n[m>>2]|0,B=R+B|0,n[F>>2]=B,B=vs(G,B<<2)|0,n[m>>2]=B,!(B|0)&&(n[(Ht()|0)>>2]|0)==12&&(G=Ae(1)|0,Qt(G|0,48,0))):B=n[m>>2]|0,G=n[C>>2]|0,n[C>>2]=G+1,C=B+(G<<2)|0,!C){S=x;return}n[C>>2]=n[T>>2],S=x}function Xi(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0;if(x=S,C=m+4|0,B=n[C>>2]|0,F=m+8|0,R=n[F>>2]|0,(B|0)==(R|0)&(R|0)<(B+1|0)?(R=(B>>1)+2&-2,R=(R|0)<2?2:R,(R|0)>(2147483647-B|0)&&(R=Ae(1)|0,Qt(R|0,48,0)),G=n[m>>2]|0,B=R+B|0,n[F>>2]=B,B=vs(G,B<<2)|0,n[m>>2]=B,!(B|0)&&(n[(Ht()|0)>>2]|0)==12&&(G=Ae(1)|0,Qt(G|0,48,0))):B=n[m>>2]|0,G=n[C>>2]|0,n[C>>2]=G+1,C=B+(G<<2)|0,!C){S=x;return}n[C>>2]=n[T>>2],S=x}function Is(m,T,x){m=m|0,T=T|0,x=x|0;var C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0;if(x=S,S=S+16|0,C=x+2|0,F=x+1|0,B=x,(T|0)<16){if(B=T+-1|0,(B|0)>0)F=0;else{S=x;return}do{if(C=F,F=F+1|0,(F|0)<(T|0)){G=C,R=F;do G=(n[m+(R<<2)>>2]|0)<(n[m+(G<<2)>>2]|0)?R:G,R=R+1|0;while((R|0)!=(T|0))}else G=C;X=m+(C<<2)|0,oe=n[X>>2]|0,ue=m+(G<<2)|0,n[X>>2]=n[ue>>2],n[ue>>2]=oe}while((F|0)!=(B|0));S=x;return}for(R=n[m+(((T|0)/2|0)<<2)>>2]|0,z=-1,X=T;;){do z=z+1|0,ee=m+(z<<2)|0,G=n[ee>>2]|0;while((G|0)<(R|0));do X=X+-1|0,oe=m+(X<<2)|0,ue=n[oe>>2]|0;while((R|0)<(ue|0));if((z|0)>=(X|0))break;n[ee>>2]=ue,n[oe>>2]=G}r[C+0>>0]=r[F+0>>0]|0,Is(m,z,C),ue=T-z|0,r[C+0>>0]=r[B+0>>0]|0,Is(ee,ue,C),S=x}function $s(m,T,x){m=m|0,T=T|0,x=x|0;var C=0,B=0,F=0,R=0,G=0,ee=0;if(C=S,R=x&1,F=l[m+16>>0]|0|R,B=T+4|0,G=((F+(n[B>>2]|0)<<2)+4|0)>>>2,ee=m+4|0,Zi(m,G+(n[ee>>2]|0)|0),x=n[ee>>2]|0,G=G+x|0,n[ee>>2]=G,G>>>0<x>>>0&&Qt(Ae(1)|0,48,0),m=(n[m>>2]|0)+(x<<2)|0,!m)return S=C,x|0;if(F=F<<3|R<<2,n[m>>2]=n[m>>2]&-32|F,F=n[B>>2]<<5|F,n[m>>2]=F,(n[B>>2]|0)>0){F=n[T>>2]|0,T=0;do n[m+(T<<2)+4>>2]=n[F+(T<<2)>>2],T=T+1|0;while((T|0)<(n[B>>2]|0));F=n[m>>2]|0}if(!(F&8))return S=C,x|0;if(B=F>>>5,F&4)return d[m+(B<<2)+4>>2]=0,S=C,x|0;if(!B)B=0,F=0;else{F=0,T=0;do F=1<<((n[m+(T<<2)+4>>2]|0)>>>1&31)|F,T=T+1|0;while((T|0)<(B|0))}return n[m+(B<<2)+4>>2]=F,S=C,x|0}function Dr(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0;if(x=S,C=m+4|0,B=n[C>>2]|0,F=m+8|0,R=n[F>>2]|0,(B|0)==(R|0)&(R|0)<(B+1|0)?(R=(B>>1)+2&-2,R=(R|0)<2?2:R,(R|0)>(2147483647-B|0)&&(R=Ae(1)|0,Qt(R|0,48,0)),G=n[m>>2]|0,B=R+B|0,n[F>>2]=B,B=vs(G,B<<3)|0,n[m>>2]=B,!(B|0)&&(n[(Ht()|0)>>2]|0)==12&&(G=Ae(1)|0,Qt(G|0,48,0))):B=n[m>>2]|0,G=n[C>>2]|0,n[C>>2]=G+1,C=B+(G<<3)|0,!C){S=x;return}F=T,R=n[F+4>>2]|0,G=C,n[G>>2]=n[F>>2],n[G+4>>2]=R,S=x}function pn(m){m=m|0;var T=0,x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0,we=0,_e=0;if(T=S,x=n[m>>2]|0,B=n[x>>2]|0,G=m+4|0,oe=n[x+((n[G>>2]|0)+-1<<2)>>2]|0,n[x>>2]=oe,C=n[m+12>>2]|0,n[C+(oe<<2)>>2]=0,n[C+(B<<2)>>2]=-1,oe=(n[G>>2]|0)+-1|0,n[G>>2]=oe,(oe|0)<=1)return S=T,B|0;for(F=n[x>>2]|0,ee=m+28|0,m=0,z=1;X=(m<<1)+2|0,(X|0)<(oe|0)?(ue=n[x+(X<<2)>>2]|0,_e=n[x+(z<<2)>>2]|0,oe=n[n[ee>>2]>>2]|0,re=+A[oe+(ue<<3)>>3],we=+A[oe+(_e<<3)>>3],re>we||(ue=_e,re=we,R=6)):(oe=n[n[ee>>2]>>2]|0,R=n[x+(z<<2)>>2]|0,ue=R,re=+A[oe+(R<<3)>>3],R=6),(R|0)==6&&(R=0,X=z),re>+A[oe+(F<<3)>>3];)if(n[x+(m<<2)>>2]=ue,n[C+(ue<<2)>>2]=m,z=X<<1|1,oe=n[G>>2]|0,(z|0)>=(oe|0)){m=X;break}else m=X;return n[x+(m<<2)>>2]=F,n[C+(F<<2)>>2]=m,S=T,B|0}function Zn(m,T,x){m=m|0,T=T|0,x=x|0;var C=0,B=0,F=0,R=0,G=0,ee=0,z=0;if(C=S,G=n[T>>2]|0,T=G+1|0,B=m+4|0,(n[B>>2]|0)>=(T|0)){S=C;return}if(R=m+8|0,F=n[R>>2]|0,(F|0)<(T|0)&&(ee=G+2-F&-2,G=(F>>1)+2&-2,G=(ee|0)>(G|0)?ee:G,(G|0)>(2147483647-F|0)&&(ee=Ae(1)|0,Qt(ee|0,48,0)),z=n[m>>2]|0,ee=G+F|0,n[R>>2]=ee,ee=vs(z,ee)|0,n[m>>2]=ee,!(ee|0)&&(n[(Ht()|0)>>2]|0)==12&&(z=Ae(1)|0,Qt(z|0,48,0))),F=n[B>>2]|0,(F|0)<(T|0))do r[(n[m>>2]|0)+F>>0]=x,F=F+1|0;while((F|0)!=(T|0));n[B>>2]=T,S=C}function Qn(m,T,x){m=m|0,T=T|0,x=x|0;var C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0,we=0,_e=0,Be=0,Xe=0,Qe=0;if(C=S,S=S+16|0,F=C+8|0,B=C+4|0,R=C,(T|0)<16){if(B=T+-1|0,(B|0)<=0){S=C;return}F=n[x>>2]|0,x=0;do{if(R=x,x=x+1|0,(x|0)<(T|0)){G=n[F>>2]|0,z=R,ee=x;do X=G+(n[m+(ee<<2)>>2]<<2)|0,Xe=n[X>>2]|0,re=Xe>>>5,Xe>>>0>95&&(oe=G+(n[m+(z<<2)>>2]<<2)|0,ue=(n[oe>>2]|0)>>>5,(ue|0)==2?z=ee:z=+d[X+(re<<2)+4>>2]<+d[oe+(ue<<2)+4>>2]?ee:z),ee=ee+1|0;while((ee|0)!=(T|0))}else z=R;_e=m+(R<<2)|0,Be=n[_e>>2]|0,Xe=m+(z<<2)|0,n[_e>>2]=n[Xe>>2],n[Xe>>2]=Be}while((x|0)!=(B|0));S=C;return}for(G=n[m+(((T|0)/2|0)<<2)>>2]|0,re=-1,oe=T;;){Be=re+1|0,ue=m+(Be<<2)|0,Xe=n[ue>>2]|0,ee=n[x>>2]|0,z=n[ee>>2]|0,_e=z+(Xe<<2)|0,we=n[_e>>2]|0,re=z+(G<<2)|0,X=n[re>>2]|0;e:do if(we>>>0>95)for(;;){if(Qe=X>>>5,(Qe|0)!=2&&!(+d[_e+(we>>>5<<2)+4>>2]<+d[re+(Qe<<2)+4>>2])){re=Be;break e}if(Be=Be+1|0,ue=m+(Be<<2)|0,Xe=n[ue>>2]|0,_e=z+(Xe<<2)|0,we=n[_e>>2]|0,we>>>0<=95){re=Be;break}}else re=Be;while(!1);oe=oe+-1|0,_e=m+(oe<<2)|0,we=z+(G<<2)|0;e:do if(X>>>0>95)for(;;){if(Be=z+(n[_e>>2]<<2)|0,Qe=(n[Be>>2]|0)>>>5,(Qe|0)!=2&&!(+d[we+(X>>>5<<2)+4>>2]<+d[Be+(Qe<<2)+4>>2]))break e;Qe=oe+-1|0,_e=m+(Qe<<2)|0,oe=Qe}while(!1);if((re|0)>=(oe|0))break;n[ue>>2]=n[_e>>2],n[_e>>2]=Xe}n[B>>2]=ee,n[F+0>>2]=n[B+0>>2],Qn(m,re,F),Qe=T-re|0,n[R>>2]=ee,n[F+0>>2]=n[R+0>>2],Qn(ue,Qe,F),S=C}function cn(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0,we=0,_e=0;if(C=S,B=m+4|0,R=n[B>>2]|0,F=n[m>>2]|0,(R|0)>0){ee=n[m+12>>2]|0,G=0;do n[ee+(n[F+(G<<2)>>2]<<2)>>2]=-1,G=G+1|0,R=n[B>>2]|0;while((G|0)<(R|0))}if(F&&(n[B>>2]=0,R=0),F=T+4|0,(n[F>>2]|0)>0){G=m+12|0,R=0;do _e=(n[T>>2]|0)+(R<<2)|0,n[(n[G>>2]|0)+(n[_e>>2]<<2)>>2]=R,Xi(m,_e),R=R+1|0;while((R|0)<(n[F>>2]|0));R=n[B>>2]|0}if((R|0)<=1){S=C;return}for(F=n[m>>2]|0,T=m+28|0,m=m+12|0,oe=R,G=(R|0)/2|0;;){G=G+-1|0,R=n[F+(G<<2)>>2]|0,z=G<<1|1;e:do if((z|0)<(oe|0))for(ee=G;;){if(X=(ee<<1)+2|0,(X|0)<(oe|0)?(ue=n[F+(X<<2)>>2]|0,_e=n[F+(z<<2)>>2]|0,oe=n[n[T>>2]>>2]|0,re=+A[oe+(ue<<3)>>3],we=+A[oe+(_e<<3)>>3],re>we||(ue=_e,re=we,x=16)):(oe=n[n[T>>2]>>2]|0,x=n[F+(z<<2)>>2]|0,ue=x,re=+A[oe+(x<<3)>>3],x=16),(x|0)==16&&(x=0,X=z),!(re>+A[oe+(R<<3)>>3]))break e;if(n[F+(ee<<2)>>2]=ue,n[(n[m>>2]|0)+(ue<<2)>>2]=ee,z=X<<1|1,oe=n[B>>2]|0,(z|0)>=(oe|0)){ee=X;break}else ee=X}else ee=G;while(!1);if(n[F+(ee<<2)>>2]=R,n[(n[m>>2]|0)+(R<<2)>>2]=ee,(G|0)<=0)break;oe=n[B>>2]|0}S=C}function fr(m){m=m|0;var T=0,x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0,we=0,_e=0;if(x=S,T=m+36|0,ee=n[T>>2]|0,C=m+32|0,X=n[C>>2]|0,(ee|0)>0){F=m+16|0,B=m+44|0,R=0;do{if(G=X+(R<<2)|0,z=n[G>>2]|0,r[(n[F>>2]|0)+z>>0]|0){if(X=n[m>>2]|0,ee=X+(z*12|0)+4|0,ue=n[ee>>2]|0,(ue|0)>0){z=X+(z*12|0)|0,X=0,oe=0;do re=n[z>>2]|0,we=re+(X<<3)|0,(n[(n[n[B>>2]>>2]|0)+(n[we>>2]<<2)>>2]&3|0)!=1&&(_e=we,we=n[_e+4>>2]|0,ue=re+(oe<<3)|0,n[ue>>2]=n[_e>>2],n[ue+4>>2]=we,ue=n[ee>>2]|0,oe=oe+1|0),X=X+1|0;while((X|0)<(ue|0))}else X=0,oe=0;z=X-oe|0,(z|0)>0&&(n[ee>>2]=ue-z),r[(n[F>>2]|0)+(n[G>>2]|0)>>0]=0,ee=n[T>>2]|0,X=n[C>>2]|0}R=R+1|0}while((R|0)<(ee|0))}if(!X){S=x;return}n[T>>2]=0,S=x}function Zs(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0;if(C=S,F=n[T>>2]|0,B=F>>>2&1|(l[m+16>>0]|0),F=((B+(F>>>5)<<2)+4|0)>>>2,R=m+4|0,Zi(m,F+(n[R>>2]|0)|0),x=n[R>>2]|0,F=F+x|0,n[R>>2]=F,F>>>0<x>>>0&&Qt(Ae(1)|0,48,0),m=(n[m>>2]|0)+(x<<2)|0,!m)return S=C,x|0;if(B=n[T>>2]&-9|B<<3,n[m>>2]=B,(n[T>>2]|0)>>>0>31){B=0;do n[m+(B<<2)+4>>2]=n[T+(B<<2)+4>>2],B=B+1|0;while((B|0)<((n[T>>2]|0)>>>5|0));B=n[m>>2]|0}return B&8?(F=B>>>5,T=T+(F<<2)+4|0,B&4?(d[m+(F<<2)+4>>2]=+d[T>>2],S=C,x|0):(n[m+(F<<2)+4>>2]=n[T>>2],S=C,x|0)):(S=C,x|0)}function gr(m){m=m|0;var T=0,x=0,C=0,B=0,F=0,R=0;if(T=S,S=S+16|0,B=T,Jr(m),n[m>>2]=3424,n[m+684>>2]=n[719],n[m+688>>2]=n[747],n[m+692>>2]=n[785],A[m+696>>3]=+A[411],r[m+704>>0]=r[2652]|0,r[m+705>>0]=r[2724]|0,r[m+706>>0]=r[2804]|0,r[m+707>>0]=1,n[m+708>>2]=0,n[m+712>>2]=0,n[m+716>>2]=0,n[m+720>>2]=1,r[m+724>>0]=1,x=m+732|0,R=m+544|0,n[m+760>>2]=0,n[m+764>>2]=0,n[m+768>>2]=0,n[m+776>>2]=0,n[m+780>>2]=0,n[m+784>>2]=0,n[m+792>>2]=0,n[m+796>>2]=0,n[m+800>>2]=0,F=m+804|0,n[x+0>>2]=0,n[x+4>>2]=0,n[x+8>>2]=0,n[x+12>>2]=0,n[x+16>>2]=0,n[x+20>>2]=0,n[F>>2]=R,F=m+808|0,n[F>>2]=0,n[m+812>>2]=0,n[m+816>>2]=0,x=m+824|0,n[x+0>>2]=0,n[x+4>>2]=0,n[x+8>>2]=0,n[x+12>>2]=0,n[x+16>>2]=0,n[x+20>>2]=0,n[m+852>>2]=F,Xr(m+856|0,1),F=m+868|0,x=m+892|0,n[m+920>>2]=0,n[m+924>>2]=0,n[F+0>>2]=0,n[F+4>>2]=0,n[F+8>>2]=0,n[F+12>>2]=0,n[F+16>>2]=0,n[x+0>>2]=0,n[x+4>>2]=0,n[x+8>>2]=0,n[x+12>>2]=0,n[x+16>>2]=0,n[x+20>>2]=0,x=B+4|0,n[x>>2]=0,F=B+8|0,n[F>>2]=2,C=vs(0,8)|0,n[B>>2]=C,!(C|0)&&(n[(Ht()|0)>>2]|0)==12&&Qt(Ae(1)|0,48,0),n[C>>2]=-2,n[x>>2]=1,r[m+560>>0]=1,n[m+928>>2]=$s(R,B,0)|0,r[m+536>>0]=0,!C){S=T;return}n[x>>2]=0,yi(C),n[B>>2]=0,n[F>>2]=0,S=T}function gn(m){m=m|0;var T=0;T=S,xr(m),ot(m),S=T}function xr(m){m=m|0;var T=0,x=0,C=0;if(T=S,n[m>>2]=3424,x=m+904|0,C=n[x>>2]|0,C&&(n[m+908>>2]=0,yi(C),n[x>>2]=0,n[m+912>>2]=0),x=m+892|0,C=n[x>>2]|0,C&&(n[m+896>>2]=0,yi(C),n[x>>2]=0,n[m+900>>2]=0),x=m+876|0,C=n[x>>2]|0,C&&(n[m+880>>2]=0,yi(C),n[x>>2]=0,n[m+884>>2]=0),x=m+856|0,C=n[x>>2]|0,C&&(n[m+860>>2]=0,yi(C),n[x>>2]=0,n[m+864>>2]=0),C=m+836|0,x=n[C>>2]|0,x&&(n[m+840>>2]=0,yi(x),n[C>>2]=0,n[m+844>>2]=0),x=m+824|0,C=n[x>>2]|0,C&&(n[m+828>>2]=0,yi(C),n[x>>2]=0,n[m+832>>2]=0),x=m+808|0,C=n[x>>2]|0,C&&(n[m+812>>2]=0,yi(C),n[x>>2]=0,n[m+816>>2]=0),aa(m+760|0),x=m+744|0,C=n[x>>2]|0,C&&(n[m+748>>2]=0,yi(C),n[x>>2]=0,n[m+752>>2]=0),x=m+732|0,C=n[x>>2]|0,!C){go(m),S=T;return}n[m+736>>2]=0,yi(C),n[x>>2]=0,n[m+740>>2]=0,go(m),S=T}function dn(m,T,x){m=m|0,T=T|0,x=x|0;var C=0,B=0,F=0,R=0,G=0,ee=0;return C=S,S=S+32|0,F=C+12|0,G=C+8|0,ee=C+16|0,B=C+4|0,R=C,r[ee>>0]=r[T>>0]|0,r[F+0>>0]=r[ee+0>>0]|0,x=Vo(m,F,x)|0,n[G>>2]=x,hs(m+876|0,x,0),hs(m+904|0,x,0),r[m+724>>0]|0?(ee=m+808|0,T=x<<1,n[B>>2]=T,n[F+0>>2]=n[B+0>>2],la(ee,F,0),n[R>>2]=T|1,n[F+0>>2]=n[R+0>>2],la(ee,F,0),mr(m+760|0,G),hs(m+744|0,x,0),qn(m+824|0,x),S=C,x|0):(S=C,x|0)}function Ps(m,T,x,C){m=m|0,T=T|0,x=x|0,C=C|0;var B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0,we=0,_e=0,Be=0,Xe=0,Qe=0,at=0;if(R=S,S=S+32|0,B=R+4|0,re=R,oe=R+16|0,n[B>>2]=0,F=B+4|0,n[F>>2]=0,G=B+8|0,n[G>>2]=0,we=r[2608]|0,r[m>>0]=we,ee=T+724|0,x=(l[ee>>0]&(x&1)|0)!=0,x){if(Be=T+308|0,at=n[Be>>2]|0,(at|0)>0){_e=T+304|0,we=T+876|0,Xe=0;do Qe=n[(n[_e>>2]|0)+(Xe<<2)>>2]>>1,n[re>>2]=Qe,Qe=(n[we>>2]|0)+Qe|0,r[Qe>>0]|0||(r[Qe>>0]=1,Xi(B,re),at=n[Be>>2]|0),Xe=Xe+1|0;while((Xe|0)<(at|0))}re=(Ir(T,C)|0)&1^1,r[m>>0]=re,C=r[2608]|0}else C=we,re=we;if(at=C&255,(at>>>1^1)&re<<24>>24==C<<24>>24|at&2&(re&255)?(At(oe,T),re=r[oe>>0]|0,r[m>>0]=re):(n[T+44>>2]|0)>0&&Tt(3760)|0,Qe=r[2608]|0,at=Qe&255,(at>>>1^1)&re<<24>>24==Qe<<24>>24|at&2&(re&255)|0&&r[T+707>>0]|0&&(ue=(n[T+736>>2]|0)+-1|0,(ue|0)>0)){m=T+732|0,oe=T+4|0;do{C=n[m>>2]|0,Be=n[C+(ue<<2)>>2]|0,Xe=ue+-1|0,Qe=n[C+(Xe<<2)>>2]|0,ue=n[oe>>2]|0;e:do if((Be|0)>1)for(we=r[2616]|0,re=we&255,_e=re&2,re=re>>>1^1,at=Xe;;){if(Qe=l[ue+(Qe>>1)>>0]^Qe&1,Xe=Be+-1|0,!((Qe&255)<<24>>24==we<<24>>24&re|_e&Qe))break e;if(Be=at+-1|0,Qe=n[C+(Be<<2)>>2]|0,(Xe|0)>1)at=Be,Be=Xe;else{at=Be,Be=Xe,X=20;break}}else at=Xe,X=20;while(!1);(X|0)==20&&(X=0,r[ue+(Qe>>1)>>0]=(Qe&1^1)&255^1),ue=at-Be|0}while((ue|0)>0)}if(x&&(z=n[F>>2]|0,(z|0)>0)){X=n[B>>2]|0,x=T+876|0,oe=0;do m=n[X+(oe<<2)>>2]|0,r[(n[x>>2]|0)+m>>0]=0,r[ee>>0]|0&&Es(T,m),oe=oe+1|0;while((oe|0)<(z|0))}if(T=n[B>>2]|0,!T){S=R;return}n[F>>2]=0,yi(T),n[B>>2]=0,n[G>>2]=0,S=R}function Ir(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0,we=0,_e=0,Be=0,Xe=0,Qe=0,at=0,kt=0,hi=0,ri=0,dt=0,Yt=0,ii=0,qt=0,ei=0,Rt=0,$t=0,Ft=0;if(G=S,S=S+16|0,F=G,!($e(m)|0))return Rt=0,S=G,Rt|0;if(R=m+724|0,!(r[R>>0]|0))return Rt=1,S=G,Rt|0;Qe=m+924|0,Be=m+872|0,Xe=m+868|0,_e=m+860|0,ue=m+680|0,at=m+824|0,B=m+828|0,z=m+836|0,kt=m+904|0,hi=m+332|0,x=m+44|0,ri=m+704|0,Yt=m+706|0,ii=m+696|0,X=m+556|0,oe=m+548|0,dt=m+876|0,re=m+920|0,we=m+284|0;e:for(;!((n[Qe>>2]|0)<=0&&(n[re>>2]|0)>=(n[we>>2]|0)&&(n[B>>2]|0)<=0);){if(yo(m),ei=n[Be>>2]|0,Rt=n[Xe>>2]|0,qt=ei-Rt|0,(ei|0)<(Rt|0)&&(qt=(n[_e>>2]|0)+qt|0),(qt|0)<=0&&(n[re>>2]|0)>=(n[we>>2]|0)||(ee=11),(ee|0)==11&&(ee=0,!(ra(m,1)|0))){ee=12;break}if(Rt=n[B>>2]|0,r[ue>>0]|0){ee=15;break}if(Rt)qt=0;else continue;for(;;){if(Ft=n[at>>2]|0,ei=n[Ft>>2]|0,$t=n[Ft+(Rt+-1<<2)>>2]|0,n[Ft>>2]=$t,Rt=n[z>>2]|0,n[Rt+($t<<2)>>2]=0,n[Rt+(ei<<2)>>2]=-1,Rt=(n[B>>2]|0)+-1|0,n[B>>2]=Rt,(Rt|0)>1&&io(at,0),r[ue>>0]|0)continue e;if(!(r[(n[kt>>2]|0)+ei>>0]|0)&&($t=r[(n[hi>>2]|0)+ei>>0]|0,Rt=r[2624]|0,Ft=Rt&255,((Ft>>>1^1)&$t<<24>>24==Rt<<24>>24|$t&2&Ft|0)!=0)){if((n[x>>2]|0)>1&((qt|0)%100|0|0)==0&&(n[F>>2]=n[B>>2],Vt(3504,F|0)|0),r[ri>>0]|0){if(Ft=(n[dt>>2]|0)+ei|0,Rt=r[Ft>>0]|0,r[Ft>>0]=1,!(fl(m,ei)|0)){ee=29;break e}r[(n[dt>>2]|0)+ei>>0]=Rt<<24>>24!=0&1}if(r[Yt>>0]|0&&($t=r[(n[hi>>2]|0)+ei>>0]|0,Rt=r[2624]|0,Ft=Rt&255,((Ft>>>1^1)&$t<<24>>24==Rt<<24>>24|$t&2&Ft|0)!=0)&&!(r[(n[dt>>2]|0)+ei>>0]|0)&&!(Oo(m,ei)|0)){ee=35;break e}+((n[X>>2]|0)>>>0)>+A[ii>>3]*+((n[oe>>2]|0)>>>0)&&vo[n[(n[m>>2]|0)+8>>2]&31](m)}if(Rt=n[B>>2]|0,Rt)qt=qt+1|0;else continue e}}do if((ee|0)==12)r[m+492>>0]=0;else if((ee|0)==15){if(ue=n[m+824>>2]|0,(Rt|0)<=0){if(!ue)break}else{we=n[z>>2]|0,re=0;do n[we+(n[ue+(re<<2)>>2]<<2)>>2]=-1,re=re+1|0;while((re|0)<(n[B>>2]|0))}n[B>>2]=0}else((ee|0)==29||(ee|0)==35)&&(r[m+492>>0]=0);while(!1);if(!T)+((n[X>>2]|0)>>>0)>+A[m+96>>3]*+((n[oe>>2]|0)>>>0)&&vo[n[(n[m>>2]|0)+8>>2]&31](m);else{if(T=m+744|0,X=n[T>>2]|0,X&&(n[m+748>>2]=0,yi(X),n[T>>2]=0,n[m+752>>2]=0),Hn(m+760|0,1),T=m+808|0,X=n[T>>2]|0,X&&(n[m+812>>2]=0,yi(X),n[T>>2]=0,n[m+816>>2]=0),X=m+824|0,T=n[X>>2]|0,(n[B>>2]|0)<=0)T&&(ee=48);else{ee=n[z>>2]|0,z=0;do n[ee+(n[T+(z<<2)>>2]<<2)>>2]=-1,z=z+1|0;while((z|0)<(n[B>>2]|0));ee=48}(ee|0)==48&&(n[B>>2]=0,yi(T),n[X>>2]=0,n[m+832>>2]=0),yn(m+856|0,1),r[R>>0]=0,r[m+536>>0]=1,r[m+560>>0]=0,n[m+728>>2]=n[m+540>>2],De(m),vo[n[(n[m>>2]|0)+8>>2]&31](m)}return(n[x>>2]|0)>0&&(C=n[m+736>>2]|0,(C|0)>0)&&(A[I>>3]=+(C<<2>>>0)*95367431640625e-20,n[F>>2]=n[I>>2],n[F+4>>2]=n[I+4>>2],Vt(3528,F|0)|0),Ft=(r[m+492>>0]|0)!=0,S=G,Ft|0}function Fn(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0;if(x=S,S=S+16|0,B=x,R=m+256|0,G=m+260|0,F=n[G>>2]|0,r[m+705>>0]|0&&mo(m,T)|0)return ue=1,S=x,ue|0;if(!(Ha(m,T)|0))return ue=0,S=x,ue|0;if(!(r[m+724>>0]|0)||(T=n[G>>2]|0,(T|0)!=(F+1|0))||(ue=n[(n[R>>2]|0)+(T+-1<<2)>>2]|0,n[B>>2]=ue,z=(n[m+544>>2]|0)+(ue<<2)|0,yr(m+856|0,ue),(n[z>>2]|0)>>>0<=31))return ue=1,S=x,ue|0;ee=m+760|0,G=m+808|0,R=m+744|0,F=m+924|0,T=m+824|0,X=m+840|0,m=m+836|0,oe=0;do ue=z+(oe<<2)+4|0,zn((n[ee>>2]|0)+((n[ue>>2]>>1)*12|0)|0,B),re=(n[G>>2]|0)+(n[ue>>2]<<2)|0,n[re>>2]=(n[re>>2]|0)+1,r[(n[R>>2]|0)+(n[ue>>2]>>1)>>0]=1,n[F>>2]=(n[F>>2]|0)+1,ue=n[ue>>2]>>1,(n[X>>2]|0)>(ue|0)&&(C=n[(n[m>>2]|0)+(ue<<2)>>2]|0,(C|0)>-1)&&io(T,C),oe=oe+1|0;while((oe|0)<((n[z>>2]|0)>>>5|0));return C=1,S=x,C|0}function mo(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0,we=0;R=S,S=S+16|0,B=R+8|0,F=R+4|0,C=R,n[F>>2]=n[m+284>>2],Xi(m+292|0,F),F=T+4|0,ee=n[F>>2]|0;e:do if((ee|0)>0){for(x=m+332|0,G=0;z=n[(n[T>>2]|0)+(G<<2)>>2]|0,oe=l[(n[x>>2]|0)+(z>>1)>>0]|0,ue=oe^z&1,X=ue&255,we=r[2608]|0,re=we&255,!(X<<24>>24==we<<24>>24&(re>>>1^1)|re&2&ue);)if(re=r[2616]|0,we=re&255,(we>>>1^1)&X<<24>>24==re<<24>>24|oe&2&we||(n[C>>2]=z^1,n[B+0>>2]=n[C+0>>2],Lr(m,B,-1),ee=n[F>>2]|0),G=G+1|0,(G|0)>=(ee|0))break e;return Yr(m,0),we=1,S=R,we|0}while(!1);return we=(Cr(m)|0)!=-1,Yr(m,0),S=R,we|0}function Kr(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0;if(x=S,S=S+16|0,B=x,C=(n[m+544>>2]|0)+(T<<2)|0,!(r[m+724>>0]|0)){to(m,T),S=x;return}if((n[C>>2]|0)>>>0<=31){to(m,T),S=x;return}R=m+808|0,G=m+776|0,F=m+792|0,ee=0;do z=C+(ee<<2)+4|0,X=(n[R>>2]|0)+(n[z>>2]<<2)|0,n[X>>2]=(n[X>>2]|0)+-1,Es(m,n[z>>2]>>1),z=n[z>>2]>>1,n[B>>2]=z,z=(n[G>>2]|0)+z|0,r[z>>0]|0||(r[z>>0]=1,Xi(F,B)),ee=ee+1|0;while((ee|0)<((n[C>>2]|0)>>>5|0));to(m,T),S=x}function Ls(m,T,x){m=m|0,T=T|0,x=x|0;var C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0,we=0;if(C=S,S=S+16|0,F=C+4|0,B=C,G=n[m+544>>2]|0,R=G+(T<<2)|0,yr(m+856|0,T),(n[R>>2]&-32|0)==64){Kr(m,T),oe=n[x>>2]|0,x=n[R>>2]|0;e:do if(x>>>0>31)for(ee=x>>>5,z=0;;){if(X=z+1|0,(n[R+(z<<2)+4>>2]|0)==(oe|0)){X=z;break e}if((X|0)<(ee|0))z=X;else break}else ee=0,X=0;while(!1);if(z=ee+-1|0,(X|0)<(z|0))do x=X,X=X+1|0,n[R+(x<<2)+4>>2]=n[R+(X<<2)+4>>2],x=n[R>>2]|0,ee=x>>>5,z=ee+-1|0;while((X|0)<(z|0));if(x&8&&(n[R+(z<<2)+4>>2]=n[R+(ee<<2)+4>>2],x=n[R>>2]|0),ee=x+-32|0,n[R>>2]=ee,ee=ee>>>5,!ee)ee=0,x=0;else{x=0,z=0;do x=1<<((n[R+(z<<2)+4>>2]|0)>>>1&31)|x,z=z+1|0;while((z|0)<(ee|0))}n[R+(ee<<2)+4>>2]=x}else{na(m,T,1),x=n[x>>2]|0,z=n[R>>2]|0;e:do if(z>>>0>31)for(ee=z>>>5,X=0;;){if(oe=X+1|0,(n[R+(X<<2)+4>>2]|0)==(x|0)){oe=X;break e}if((oe|0)<(ee|0))X=oe;else break}else ee=0,oe=0;while(!1);if(X=ee+-1|0,(oe|0)<(X|0))do z=oe,oe=oe+1|0,n[R+(z<<2)+4>>2]=n[R+(oe<<2)+4>>2],z=n[R>>2]|0,ee=z>>>5,X=ee+-1|0;while((oe|0)<(X|0));if(z&8&&(n[R+(X<<2)+4>>2]=n[R+(ee<<2)+4>>2],z=n[R>>2]|0),X=z+-32|0,n[R>>2]=X,X=X>>>5,!X)X=0,ee=0;else{ee=0,z=0;do ee=1<<((n[R+(z<<2)+4>>2]|0)>>>1&31)|ee,z=z+1|0;while((z|0)<(X|0))}n[R+(X<<2)+4>>2]=ee,eo(m,T),ee=x>>1,z=n[m+760>>2]|0,X=z+(ee*12|0)|0,z=z+(ee*12|0)+4|0,oe=n[z>>2]|0;e:do if((oe|0)>0)for(we=n[X>>2]|0,ue=0;;){if(re=ue+1|0,(n[we+(ue<<2)>>2]|0)==(T|0))break e;if((re|0)<(oe|0))ue=re;else{ue=re;break}}else ue=0;while(!1);if(oe=oe+-1|0,(ue|0)<(oe|0)){X=n[X>>2]|0;do oe=ue,ue=ue+1|0,n[X+(oe<<2)>>2]=n[X+(ue<<2)>>2],oe=(n[z>>2]|0)+-1|0;while((ue|0)<(oe|0))}n[z>>2]=oe,we=(n[m+808>>2]|0)+(x<<2)|0,n[we>>2]=(n[we>>2]|0)+-1,Es(m,ee)}if((n[R>>2]&-32|0)!=32)return we=1,S=C,we|0;if(G=n[G+(T+1<<2)>>2]|0,R=l[(n[m+332>>2]|0)+(G>>1)>>0]|0,we=R^G&1,T=we&255,ue=r[2624]|0,re=ue&255,T<<24>>24==ue<<24>>24&(re>>>1^1)|re&2&we)n[B>>2]=G,n[F+0>>2]=n[B+0>>2],Lr(m,F,-1);else if(re=r[2616]|0,we=re&255,(we>>>1^1)&T<<24>>24==re<<24>>24|R&2&we)return we=0,S=C,we|0;return we=(Cr(m)|0)==-1,S=C,we|0}function Vr(m,T,x,C,B){m=m|0,T=T|0,x=x|0,C=C|0,B=B|0;var F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0;F=S,S=S+16|0,G=F+4|0,R=F,ue=m+708|0,n[ue>>2]=(n[ue>>2]|0)+1,n[B>>2]|0&&(n[B+4>>2]=0),ee=(n[T>>2]|0)>>>5>>>0<(n[x>>2]|0)>>>5>>>0,m=ee?x:T,T=ee?T:x,ee=n[T>>2]|0;e:do if(ee>>>0>31){x=0;t:for(;;){z=n[T+(x<<2)+4>>2]|0;i:do if((z>>1|0)!=(C|0)){X=n[m>>2]|0;s:do if(X>>>0>31){for(oe=0;ue=n[m+(oe<<2)+4>>2]|0,oe=oe+1|0,!((z^ue)>>>0<2);)if((oe|0)>=(X>>>5|0))break s;if((ue|0)==(z^1|0)){B=0;break t}else break i}while(!1);n[G>>2]=z,Ys(B,G),ee=n[T>>2]|0}while(!1);if(x=x+1|0,(x|0)>=(ee>>>5|0))break e}return S=F,B|0}while(!1);if(x=n[m>>2]|0,x>>>0<=31)return ue=1,S=F,ue|0;G=0;do T=n[m+(G<<2)+4>>2]|0,(T>>1|0)!=(C|0)&&(n[R>>2]=T,Ys(B,R),x=n[m>>2]|0),G=G+1|0;while((G|0)<(x>>>5|0));return B=1,S=F,B|0}function yo(m){m=m|0;var T=0,x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0,we=0,_e=0,Be=0,Xe=0,Qe=0,at=0;if(T=S,G=m+924|0,!(n[G>>2]|0)){S=T;return}for(F=m+856|0,x=m+872|0,C=m+868|0,R=m+860|0,B=m+544|0,ee=0;at=n[x>>2]|0,z=n[C>>2]|0,X=at-z|0,(at|0)<(z|0)&&(X=(n[R>>2]|0)+X|0),!((ee|0)>=(X|0));)X=(n[B>>2]|0)+(n[(n[F>>2]|0)+(((z+ee|0)%(n[R>>2]|0)|0)<<2)>>2]<<2)|0,z=n[X>>2]|0,z&3||(n[X>>2]=z&-4|2),ee=ee+1|0;if(ee=m+540|0,re=n[ee>>2]|0,(re|0)>0){X=m+744|0,oe=m+776|0,z=m+760|0,m=m+804|0,ue=0;do{if(r[(n[X>>2]|0)+ue>>0]|0){if(we=(n[oe>>2]|0)+ue|0,r[we>>0]|0){if(_e=n[z>>2]|0,re=_e+(ue*12|0)+4|0,Xe=n[re>>2]|0,(Xe|0)>0){_e=n[_e+(ue*12|0)>>2]|0,Qe=0,Be=0;do at=n[_e+(Qe<<2)>>2]|0,(n[(n[n[m>>2]>>2]|0)+(at<<2)>>2]&3|0)!=1&&(n[_e+(Be<<2)>>2]=at,Xe=n[re>>2]|0,Be=Be+1|0),Qe=Qe+1|0;while((Qe|0)<(Xe|0))}else Qe=0,Be=0;_e=Qe-Be|0,(_e|0)>0&&(n[re>>2]=Xe-_e),r[we>>0]=0}if(we=n[z>>2]|0,re=we+(ue*12|0)+4|0,Be=n[re>>2]|0,(Be|0)>0){we=we+(ue*12|0)|0,_e=0;do Xe=n[(n[we>>2]|0)+(_e<<2)>>2]|0,n[(n[B>>2]|0)+(Xe<<2)>>2]&3||(yr(F,Xe),Be=(n[B>>2]|0)+(n[(n[we>>2]|0)+(_e<<2)>>2]<<2)|0,n[Be>>2]=n[Be>>2]&-4|2,Be=n[re>>2]|0),_e=_e+1|0;while((_e|0)<(Be|0))}r[(n[X>>2]|0)+ue>>0]=0,re=n[ee>>2]|0}ue=ue+1|0}while((ue|0)<(re|0));ee=0}else ee=0;for(;at=n[x>>2]|0,z=n[C>>2]|0,X=at-z|0,(at|0)<(z|0)&&(X=(n[R>>2]|0)+X|0),!((ee|0)>=(X|0));)z=(n[B>>2]|0)+(n[(n[F>>2]|0)+(((z+ee|0)%(n[R>>2]|0)|0)<<2)>>2]<<2)|0,X=n[z>>2]|0,(X&3|0)==2&&(n[z>>2]=X&-4),ee=ee+1|0;n[G>>2]=0,S=T}function ra(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0,we=0,_e=0,Be=0,Xe=0,Qe=0,at=0,kt=0,hi=0,ri=0,dt=0,Yt=0,ii=0,qt=0,ei=0,Rt=0,$t=0,Ft=0,lt=0,di=0,vi=0,gi=0,Si=0,Fi=0,Ts=0,pi=0;x=S,S=S+16|0,z=x,kt=x+12|0,B=m+856|0,ee=m+872|0,re=m+868|0,R=m+860|0,Xe=m+680|0,C=m+920|0,F=m+284|0,Be=m+280|0,we=m+544|0,_e=m+928|0,oe=m+44|0,X=m+776|0,Qe=m+692|0,ue=m+804|0,G=m+760|0,ii=0,Rt=0,qt=0;e:for(;;){ei=n[re>>2]|0;do{if(dt=n[ee>>2]|0,Yt=(dt|0)<(ei|0),dt=dt-ei|0,Yt?$t=(n[R>>2]|0)+dt|0:$t=dt,($t|0)<=0&&(n[C>>2]|0)>=(n[F>>2]|0)){C=1,R=53;break e}if(r[Xe>>0]|0){R=8;break e}if(Yt&&(dt=(n[R>>2]|0)+dt|0),!(dt|0)&&(ri=n[C>>2]|0,(ri|0)<(n[F>>2]|0))){if(n[C>>2]=ri+1,n[(n[we>>2]|0)+((n[_e>>2]|0)+1<<2)>>2]=n[(n[Be>>2]|0)+(ri<<2)>>2],dt=(n[we>>2]|0)+(n[_e>>2]<<2)|0,Yt=(n[dt>>2]|0)>>>5,!Yt)Yt=0,$t=0;else{$t=0,ei=0;do $t=1<<((n[dt+(ei<<2)+4>>2]|0)>>>1&31)|$t,ei=ei+1|0;while((ei|0)<(Yt|0))}n[dt+(Yt<<2)+4>>2]=$t,yr(B,n[_e>>2]|0),ei=n[re>>2]|0}dt=n[(n[B>>2]|0)+(ei<<2)>>2]|0,ei=ei+1|0,di=n[R>>2]|0,ei=(ei|0)==(di|0)?0:ei,n[re>>2]=ei,$t=n[we>>2]|0,Yt=$t+(dt<<2)|0,lt=n[Yt>>2]|0}while(lt&3|0);if(T&&(n[oe>>2]|0)>1&&(Ft=ii+1|0,(ii|0)%1e3|0||(lt=n[ee>>2]|0,n[z>>2]=lt-ei+((lt|0)<(ei|0)?di:0),n[z+4>>2]=qt,n[z+8>>2]=Rt,Vt(3440,z|0)|0,lt=n[Yt>>2]|0),ii=Ft),ei=$t+(dt+1<<2)|0,$t=n[ei>>2]>>1,lt>>>0>63){Ft=n[G>>2]|0,lt=lt>>>5,di=1;do pi=n[Yt+(di<<2)+4>>2]>>1,$t=(n[Ft+(pi*12|0)+4>>2]|0)<(n[Ft+($t*12|0)+4>>2]|0)?pi:$t,di=di+1|0;while((di|0)<(lt|0))}if(lt=(n[X>>2]|0)+$t|0,r[lt>>0]|0){if(di=n[G>>2]|0,Ft=di+($t*12|0)+4|0,Si=n[Ft>>2]|0,(Si|0)>0){di=n[di+($t*12|0)>>2]|0,gi=0,vi=0;do Fi=n[di+(gi<<2)>>2]|0,(n[(n[n[ue>>2]>>2]|0)+(Fi<<2)>>2]&3|0)!=1&&(n[di+(vi<<2)>>2]=Fi,Si=n[Ft>>2]|0,vi=vi+1|0),gi=gi+1|0;while((gi|0)<(Si|0))}else gi=0,vi=0;di=gi-vi|0,(di|0)>0&&(n[Ft>>2]=Si-di),r[lt>>0]=0}if(lt=n[G>>2]|0,Ft=n[lt+($t*12|0)>>2]|0,lt=lt+($t*12|0)+4|0,(n[lt>>2]|0)>0)di=0;else continue;for(;;){if(Fi=n[Yt>>2]|0,Fi&3)continue e;vi=n[Ft+(di<<2)>>2]|0,gi=n[we>>2]|0,Ts=gi+(vi<<2)|0,Si=n[Ts>>2]|0;t:do if(!((Si&3|0)!=0|(vi|0)==(dt|0))&&(pi=n[Qe>>2]|0,hi=Si>>>5,(pi|0)==-1|(hi|0)<(pi|0))&&(at=Fi>>>5,hi>>>0>=at>>>0)&&!(n[Yt+(at<<2)+4>>2]&~n[Ts+(hi<<2)+4>>2]|0)){gi=gi+(vi+1<<2)|0;do if(Fi>>>0>31){if(Si>>>0>31)Ts=-2,Si=0;else break t;for(;;){Fi=n[ei+(Si<<2)>>2]|0;i:do if((Ts|0)==-2)for(pi=0;;){if(Ts=n[gi+(pi<<2)>>2]|0,(Fi|0)==(Ts|0)){Fi=-2;break i}if(pi=pi+1|0,(Fi|0)==(Ts^1|0))break i;if(pi>>>0>=hi>>>0)break t}else for(pi=0;;){if((Fi|0)==(n[gi+(pi<<2)>>2]|0)){Fi=Ts;break i}if(pi=pi+1|0,pi>>>0>=hi>>>0)break t}while(!1);if(Si=Si+1|0,Si>>>0>=at>>>0)break;Ts=Fi}if((Fi|0)==-2)break;if((Fi|0)==-1)break t;if(n[kt>>2]=Fi^1,n[z+0>>2]=n[kt+0>>2],!(Ls(m,vi,z)|0)){C=0,R=53;break e}Rt=Rt+1|0,di=(((Fi>>1|0)==($t|0))<<31>>31)+di|0;break t}while(!1);Kr(m,vi),qt=qt+1|0}while(!1);if(di=di+1|0,(di|0)>=(n[lt>>2]|0))continue e}}return(R|0)==8?(yn(B,0),n[C>>2]=n[F>>2],pi=1,S=x,pi|0):(R|0)==53?(S=x,C|0):0}function oa(m,T,x){m=m|0,T=T|0,x=x|0;var C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0,we=0,_e=0;if(B=S,S=S+16|0,C=B+12|0,ee=B+8|0,R=B+4|0,F=B,G=(n[m+544>>2]|0)+(x<<2)|0,n[G>>2]&3||za(m,G)|0)return re=1,S=B,re|0;if(n[ee>>2]=n[m+284>>2],Xi(m+292|0,ee),oe=n[G>>2]|0,oe>>>0>31){ee=m+332|0,z=0,X=-2;do ue=n[G+(z<<2)+4>>2]|0,re=ue>>1,(re|0)!=(T|0)&&(re=(l[(n[ee>>2]|0)+re>>0]|0)^ue&1,_e=r[2616]|0,we=_e&255,((re&255)<<24>>24==_e<<24>>24&(we>>>1^1)|we&2&re|0)==0)?(n[R>>2]=ue^1,n[C+0>>2]=n[R+0>>2],Lr(m,C,-1),oe=n[G>>2]|0):X=ue,z=z+1|0;while((z|0)<(oe>>>5|0))}else X=-2;return _e=(Cr(m)|0)==-1,Yr(m,0),!_e&&(_e=m+712|0,n[_e>>2]=(n[_e>>2]|0)+1,n[F>>2]=X,n[C+0>>2]=n[F+0>>2],!(Ls(m,x,C)|0))?(_e=0,S=B,_e|0):(_e=1,S=B,_e|0)}function fl(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0;if(x=S,F=(n[m+776>>2]|0)+T|0,C=m+760|0,r[F>>0]|0){if(G=n[C>>2]|0,B=G+(T*12|0)+4|0,X=n[B>>2]|0,(X|0)>0){R=m+804|0,G=n[G+(T*12|0)>>2]|0,z=0,ee=0;do oe=n[G+(z<<2)>>2]|0,(n[(n[n[R>>2]>>2]|0)+(oe<<2)>>2]&3|0)!=1&&(n[G+(ee<<2)>>2]=oe,X=n[B>>2]|0,ee=ee+1|0),z=z+1|0;while((z|0)<(X|0))}else z=0,ee=0;R=z-ee|0,(R|0)>0&&(n[B>>2]=X-R),r[F>>0]=0}if(B=n[C>>2]|0,X=r[(n[m+332>>2]|0)+T>>0]|0,z=r[2624]|0,oe=z&255,!((oe>>>1^1)&X<<24>>24==z<<24>>24|X&2&oe)||(C=B+(T*12|0)+4|0,F=n[C>>2]|0,!F))return oe=1,S=x,oe|0;e:do if((F|0)>0){for(B=B+(T*12|0)|0,F=0;;){if(!(oa(m,T,n[(n[B>>2]|0)+(F<<2)>>2]|0)|0)){m=0;break}if(F=F+1|0,(F|0)>=(n[C>>2]|0))break e}return S=x,m|0}while(!1);return oe=ra(m,0)|0,S=x,oe|0}function Oo(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0,we=0,_e=0,Be=0,Xe=0,Qe=0,at=0,kt=0,hi=0,ri=0,dt=0,Yt=0,ii=0,qt=0,ei=0,Rt=0,$t=0,Ft=0,lt=0,di=0,vi=0,gi=0,Si=0,Fi=0,Ts=0,pi=0,Us=0,os=0,Ho=0,mn=0,en=0,Zr=0,ws=0,tn=0,Ji=0;if(x=S,S=S+48|0,_e=x+36|0,we=x+32|0,Be=x+28|0,Xe=x+24|0,C=x+12|0,B=x,X=(n[m+776>>2]|0)+T|0,z=m+760|0,r[X>>0]|0){if(re=n[z>>2]|0,oe=re+(T*12|0)+4|0,hi=n[oe>>2]|0,(hi|0)>0){ue=m+804|0,re=n[re+(T*12|0)>>2]|0,at=0,Qe=0;do ri=n[re+(at<<2)>>2]|0,(n[(n[n[ue>>2]>>2]|0)+(ri<<2)>>2]&3|0)!=1&&(n[re+(Qe<<2)>>2]=ri,hi=n[oe>>2]|0,Qe=Qe+1|0),at=at+1|0;while((at|0)<(hi|0))}else at=0,Qe=0;ue=at-Qe|0,(ue|0)>0&&(n[oe>>2]=hi-ue),r[X>>0]=0}Qe=n[z>>2]|0,at=Qe+(T*12|0)|0,n[C>>2]=0,X=C+4|0,n[X>>2]=0,oe=C+8|0,n[oe>>2]=0,n[B>>2]=0,re=B+4|0,n[re>>2]=0,ue=B+8|0,n[ue>>2]=0,Qe=Qe+(T*12|0)+4|0;e:do if((n[Qe>>2]|0)>0){hi=m+544|0,Yt=T<<1,dt=0;do{ii=(n[at>>2]|0)+(dt<<2)|0,ei=(n[hi>>2]|0)+(n[ii>>2]<<2)|0,Ji=n[ei>>2]|0,ri=Ji>>>5;t:do if(Ji>>>0>31)for(Rt=0;;){if(qt=Rt+1|0,(n[ei+(Rt<<2)+4>>2]|0)==(Yt|0)){qt=Rt;break t}if((qt|0)<(ri|0))Rt=qt;else break}else qt=0;while(!1);zn((qt|0)<(ri|0)?C:B,ii),dt=dt+1|0,ri=n[Qe>>2]|0}while((dt|0)<(ri|0));if(hi=n[X>>2]|0,Yt=(hi|0)>0,Yt)for(ii=n[re>>2]|0,di=(ii|0)>0,lt=m+544|0,qt=n[C>>2]|0,dt=n[B>>2]|0,ei=m+708|0,Ft=m+684|0,$t=m+688|0,Ts=0,Rt=0;;){if(di){gi=qt+(Rt<<2)|0,vi=n[lt>>2]|0,Si=n[ei>>2]|0,Fi=0;do{os=vi+(n[gi>>2]<<2)|0,mn=vi+(n[dt+(Fi<<2)>>2]<<2)|0,Si=Si+1|0,n[ei>>2]=Si,pi=(n[os>>2]|0)>>>5>>>0<(n[mn>>2]|0)>>>5>>>0,Us=pi?mn:os,mn=pi?os:mn,os=Us+4|0,pi=mn+4|0,Us=n[Us>>2]|0,Ho=Us>>>5,Zr=Ho+-1|0,mn=n[mn>>2]|0;t:do if(mn>>>0>31)for(en=0;;){Ji=n[pi+(en<<2)>>2]|0;i:do if((Ji>>1|0)!=(T|0)){s:do if(Us>>>0>31){for(tn=0;ws=n[os+(tn<<2)>>2]|0,tn=tn+1|0,!((ws^Ji)>>>0<2);)if((tn|0)>=(Ho|0))break s;if((ws|0)==(Ji^1|0))break t;break i}while(!1);Zr=Zr+1|0}while(!1);if(en=en+1|0,(en|0)>=(mn>>>5|0)){kt=28;break}}else kt=28;while(!1);if((kt|0)==28){if(kt=0,(Ts|0)>=((n[Ft>>2]|0)+ri|0)){m=1;break e}if(Ji=n[$t>>2]|0,(Ji|0)!=-1&(Zr|0)>(Ji|0)){m=1;break e}else Ts=Ts+1|0}Fi=Fi+1|0}while((Fi|0)<(ii|0))}if(Rt=Rt+1|0,(Rt|0)>=(hi|0)){kt=32;break}}else Yt=0,kt=32}else hi=0,Yt=0,kt=32;while(!1);e:do if((kt|0)==32){if(r[(n[m+904>>2]|0)+T>>0]=1,ri=m+380|0,dt=(n[ri>>2]|0)+T|0,r[dt>>0]|0&&(Ji=m+200|0,tn=Ji,tn=ts(n[tn>>2]|0,n[tn+4>>2]|0,-1,-1)|0,n[Ji>>2]=tn,n[Ji+4>>2]=ht),r[dt>>0]=0,dt=m+460|0,(n[m+476>>2]|0)>(T|0)&&(n[(n[m+472>>2]|0)+(T<<2)>>2]|0)>-1||(kt=36),(kt|0)==36&&r[(n[ri>>2]|0)+T>>0]|0&&Ni(dt,T),kt=m+716|0,n[kt>>2]=(n[kt>>2]|0)+1,kt=n[re>>2]|0,(hi|0)>(kt|0)){if(dt=m+732|0,(kt|0)>0){Xe=m+544|0,Be=n[B>>2]|0,ei=m+736|0,qt=0;do{if(ii=(n[Xe>>2]|0)+(n[Be+(qt<<2)>>2]<<2)|0,ri=n[ei>>2]|0,(n[ii>>2]|0)>>>0>31){Rt=0,$t=-1;do Ji=ii+(Rt<<2)+4|0,n[_e>>2]=n[Ji>>2],zn(dt,_e),$t=(n[Ji>>2]>>1|0)==(T|0)?Rt+ri|0:$t,Rt=Rt+1|0;while((Rt|0)<((n[ii>>2]|0)>>>5|0))}else $t=-1;Ji=n[dt>>2]|0,ws=Ji+($t<<2)|0,tn=n[ws>>2]|0,Ji=Ji+(ri<<2)|0,n[ws>>2]=n[Ji>>2],n[Ji>>2]=tn,n[we>>2]=(n[ii>>2]|0)>>>5,zn(dt,we),qt=qt+1|0}while((qt|0)<(kt|0))}n[_e>>2]=T<<1,zn(dt,_e),n[we>>2]=1,zn(dt,we)}else{if(qt=m+732|0,Yt){Rt=m+544|0,ei=n[C>>2]|0,ri=m+736|0,$t=0;do{if(ii=(n[Rt>>2]|0)+(n[ei+($t<<2)>>2]<<2)|0,dt=n[ri>>2]|0,(n[ii>>2]|0)>>>0>31){Ft=0,lt=-1;do Ji=ii+(Ft<<2)+4|0,n[_e>>2]=n[Ji>>2],zn(qt,_e),lt=(n[Ji>>2]>>1|0)==(T|0)?Ft+dt|0:lt,Ft=Ft+1|0;while((Ft|0)<((n[ii>>2]|0)>>>5|0))}else lt=-1;Ji=n[qt>>2]|0,ws=Ji+(lt<<2)|0,tn=n[ws>>2]|0,Ji=Ji+(dt<<2)|0,n[ws>>2]=n[Ji>>2],n[Ji>>2]=tn,n[we>>2]=(n[ii>>2]|0)>>>5,zn(qt,we),$t=$t+1|0}while(($t|0)<(hi|0))}n[Be>>2]=T<<1|1,zn(qt,Be),n[Xe>>2]=1,zn(qt,Xe)}if((n[Qe>>2]|0)>0){we=0;do Kr(m,n[(n[at>>2]|0)+(we<<2)>>2]|0),we=we+1|0;while((we|0)<(n[Qe>>2]|0))}we=m+628|0;t:do if(Yt){if(_e=m+544|0,at=n[C>>2]|0,dt=n[B>>2]|0,(kt|0)>0)Qe=0;else for(we=0;;)if(we=we+1|0,(we|0)>=(hi|0))break t;do{Xe=at+(Qe<<2)|0,Be=0;do{if(Ji=n[_e>>2]|0,Vr(m,Ji+(n[Xe>>2]<<2)|0,Ji+(n[dt+(Be<<2)>>2]<<2)|0,T,we)|0&&!(Fn(m,we)|0)){m=0;break e}Be=Be+1|0}while((Be|0)<(kt|0));Qe=Qe+1|0}while((Qe|0)<(hi|0))}while(!1);we=n[z>>2]|0,z=we+(T*12|0)|0,_e=n[z>>2]|0,_e&&(n[we+(T*12|0)+4>>2]=0,yi(_e),n[z>>2]=0,n[we+(T*12|0)+8>>2]=0),z=m+412|0,T=T<<1,_e=n[z>>2]|0,we=_e+(T*12|0)+4|0,!(n[we>>2]|0)&&(ee=_e+(T*12|0)|0,G=n[ee>>2]|0,(G|0)!=0)&&(n[we>>2]=0,yi(G),n[ee>>2]=0,n[_e+(T*12|0)+8>>2]=0,_e=n[z>>2]|0),G=T|1,ee=_e+(G*12|0)+4|0,!(n[ee>>2]|0)&&(R=_e+(G*12|0)|0,F=n[R>>2]|0,(F|0)!=0)&&(n[ee>>2]=0,yi(F),n[R>>2]=0,n[_e+(G*12|0)+8>>2]=0),m=ra(m,0)|0,dt=n[B>>2]|0}while(!1);return dt&&(n[re>>2]=0,yi(dt),n[B>>2]=0,n[ue>>2]=0),B=n[C>>2]|0,B?(n[X>>2]=0,yi(B),n[C>>2]=0,n[oe>>2]=0,S=x,m|0):(S=x,m|0)}function gl(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0,we=0,_e=0,Be=0;if(x=S,!(r[m+724>>0]|0)){S=x;return}if(ee=m+540|0,(n[ee>>2]|0)>0){R=m+760|0,C=m+804|0,B=m+776|0,G=m+544|0,F=0;do{if(X=n[R>>2]|0,z=X+(F*12|0)+4|0,ue=n[z>>2]|0,(ue|0)>0){X=n[X+(F*12|0)>>2]|0,re=0,oe=0;do we=n[X+(re<<2)>>2]|0,(n[(n[n[C>>2]>>2]|0)+(we<<2)>>2]&3|0)!=1&&(n[X+(oe<<2)>>2]=we,ue=n[z>>2]|0,oe=oe+1|0),re=re+1|0;while((re|0)<(ue|0))}else re=0,oe=0;if(X=re-oe|0,(X|0)>0&&(n[z>>2]=ue-X),r[(n[B>>2]|0)+F>>0]=0,X=n[R>>2]|0,z=X+(F*12|0)+4|0,(n[z>>2]|0)>0){we=X+(F*12|0)|0,ue=0;do X=(n[we>>2]|0)+(ue<<2)|0,oe=n[X>>2]|0,re=n[G>>2]|0,_e=re+(oe<<2)|0,n[_e>>2]&16?n[X>>2]=n[re+(oe+1<<2)>>2]:(Be=Zs(T,_e)|0,n[X>>2]=Be,n[_e>>2]=n[_e>>2]|16,n[re+(oe+1<<2)>>2]=Be),ue=ue+1|0;while((ue|0)<(n[z>>2]|0))}F=F+1|0}while((F|0)<(n[ee>>2]|0))}C=m+856|0,Be=n[m+872>>2]|0,B=m+868|0,z=n[B>>2]|0,G=Be-z|0,(Be|0)<(z|0)&&(G=(n[m+860>>2]|0)+G|0);e:do if((G|0)>0)for(F=m+860|0,R=m+544|0;;){if(ee=n[(n[C>>2]|0)+(z<<2)>>2]|0,X=z+1|0,n[B>>2]=(X|0)==(n[F>>2]|0)?0:X,X=n[R>>2]|0,oe=X+(ee<<2)|0,z=n[oe>>2]|0,z&3||(z&16?ee=n[X+(ee+1<<2)>>2]|0:(Be=Zs(T,oe)|0,n[oe>>2]=n[oe>>2]|16,n[X+(ee+1<<2)>>2]=Be,ee=Be),yr(C,ee)),G=G+-1|0,(G|0)<=0)break e;z=n[B>>2]|0}else R=m+544|0;while(!1);if(m=m+928|0,C=n[m>>2]|0,F=n[R>>2]|0,B=F+(C<<2)|0,n[B>>2]&16){n[m>>2]=n[F+(C+1<<2)>>2],S=x;return}else{Be=Zs(T,B)|0,n[m>>2]=Be,n[B>>2]=n[B>>2]|16,n[F+(C+1<<2)>>2]=Be,S=x;return}}function $a(m){m=m|0;var T=0,x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0;F=S,S=S+32|0,ee=F,T=F+8|0,x=m+544|0,C=m+548|0,B=m+556|0,R=(n[C>>2]|0)-(n[B>>2]|0)|0,n[T+0>>2]=0,n[T+4>>2]=0,n[T+8>>2]=0,n[T+12>>2]=0,Zi(T,R),R=T+16|0,G=m+560|0,r[R>>0]=r[G>>0]|0,gl(m,T),Dt(m,T),(n[m+44>>2]|0)>1&&(z=n[T+4>>2]<<2,n[ee>>2]=n[C>>2]<<2,n[ee+4>>2]=z,Vt(3608,ee|0)|0),r[G>>0]=r[R>>0]|0,R=n[x>>2]|0,R&&yi(R),n[x>>2]=n[T>>2],n[C>>2]=n[T+4>>2],n[m+552>>2]=n[T+8>>2],n[B>>2]=n[T+12>>2],S=F}function Or(){var m=0,T=0,x=0;m=S,S=S+16|0,T=m,r[2608]=0,r[2616]=1,r[2624]=2,Fs(2632,2656,2664,3744,3752),n[658]=160,r[2652]=0,Fs(2704,2728,2736,3744,3752),n[676]=160,r[2724]=0,Fs(2784,2808,2816,3744,3752),n[696]=160,r[2804]=1,Fs(2848,2880,2888,3744,3736),n[712]=280,x=2868,n[x>>2]=-2147483648,n[x+4>>2]=2147483647,n[719]=0,Fs(2960,2992,3e3,3744,3736),n[740]=280,x=2980,n[x>>2]=-1,n[x+4>>2]=2147483647,n[747]=20,Fs(3112,3144,3152,3744,3736),n[778]=280,x=3132,n[x>>2]=-1,n[x+4>>2]=2147483647,n[785]=1e3,Fs(3240,3296,3312,3744,3720),n[810]=2168,A[408]=0,A[409]=Le,r[3280]=0,r[3281]=0,o[1641]=o[T+0>>1]|0,o[1642]=o[T+2>>1]|0,o[1643]=o[T+4>>1]|0,A[411]=.5,S=m}function Xr(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0;if(x=S,n[m>>2]=0,C=m+4|0,n[C>>2]=0,B=m+8|0,n[B>>2]=0,(T|0)<=0){S=x;return}if(F=T+1&-2,F=(F|0)>2?F:2,n[B>>2]=F,B=vs(0,F<<2)|0,n[m>>2]=B,!(B|0)&&(n[(Ht()|0)>>2]|0)==12&&Qt(Ae(1)|0,48,0),m=n[C>>2]|0,(m|0)<(T|0))do F=B+(m<<2)|0,F&&(n[F>>2]=0),m=m+1|0;while((m|0)!=(T|0));n[C>>2]=T,S=x}function aa(m){m=m|0;var T=0,x=0,C=0,B=0,F=0,R=0,G=0;if(T=S,C=m+32|0,x=n[C>>2]|0,x&&(n[m+36>>2]=0,yi(x),n[C>>2]=0,n[m+40>>2]=0),C=m+16|0,x=n[C>>2]|0,x&&(n[m+20>>2]=0,yi(x),n[C>>2]=0,n[m+24>>2]=0),C=n[m>>2]|0,!C){S=T;return}if(x=m+4|0,F=n[x>>2]|0,(F|0)>0){B=0;do G=C+(B*12|0)|0,R=n[G>>2]|0,R&&(n[C+(B*12|0)+4>>2]=0,yi(R),n[G>>2]=0,n[C+(B*12|0)+8>>2]=0,C=n[m>>2]|0,F=n[x>>2]|0),B=B+1|0;while((B|0)<(F|0))}n[x>>2]=0,yi(C),n[m>>2]=0,n[m+8>>2]=0,S=T}function la(m,T,x){m=m|0,T=T|0,x=x|0;var C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0;if(C=S,T=n[T>>2]|0,F=T+1|0,B=m+4|0,(n[B>>2]|0)>=(F|0)){ee=n[m>>2]|0,ee=ee+(T<<2)|0,n[ee>>2]=x,S=C;return}if(R=m+8|0,ee=n[R>>2]|0,(ee|0)<(F|0)&&(z=T+2-ee&-2,G=(ee>>1)+2&-2,G=(z|0)>(G|0)?z:G,(G|0)>(2147483647-ee|0)&&(z=Ae(1)|0,Qt(z|0,48,0)),X=n[m>>2]|0,z=G+ee|0,n[R>>2]=z,z=vs(X,z<<2)|0,n[m>>2]=z,!(z|0)&&(n[(Ht()|0)>>2]|0)==12&&(X=Ae(1)|0,Qt(X|0,48,0))),ee=n[B>>2]|0,(ee|0)<(F|0)){R=n[m>>2]|0;do G=R+(ee<<2)|0,G&&(n[G>>2]=0),ee=ee+1|0;while((ee|0)!=(F|0))}n[B>>2]=F,X=n[m>>2]|0,X=X+(T<<2)|0,n[X>>2]=x,S=C}function mr(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0;if(x=S,G=n[T>>2]|0,B=G+1|0,C=m+4|0,(n[C>>2]|0)<(B|0)){if(R=m+8|0,F=n[R>>2]|0,(F|0)<(B|0)&&(ee=G+2-F&-2,G=(F>>1)+2&-2,G=(ee|0)>(G|0)?ee:G,(G|0)>(2147483647-F|0)&&(ee=Ae(1)|0,Qt(ee|0,48,0)),z=n[m>>2]|0,ee=G+F|0,n[R>>2]=ee,ee=vs(z,ee*12|0)|0,n[m>>2]=ee,!(ee|0)&&(n[(Ht()|0)>>2]|0)==12&&(z=Ae(1)|0,Qt(z|0,48,0))),R=n[C>>2]|0,(R|0)<(B|0)){F=n[m>>2]|0;do G=F+(R*12|0)|0,G&&(n[G>>2]=0,n[F+(R*12|0)+4>>2]=0,n[F+(R*12|0)+8>>2]=0),R=R+1|0;while((R|0)!=(B|0))}n[C>>2]=B,F=n[T>>2]|0}else F=G;if(C=n[m>>2]|0,n[C+(F*12|0)>>2]|0&&(n[C+(F*12|0)+4>>2]=0,F=n[T>>2]|0),T=m+16|0,C=F+1|0,B=m+20|0,(n[B>>2]|0)>=(C|0)){S=x;return}if(R=m+24|0,m=n[R>>2]|0,(m|0)<(C|0)&&(z=F+2-m&-2,F=(m>>1)+2&-2,F=(z|0)>(F|0)?z:F,(F|0)>(2147483647-m|0)&&(z=Ae(1)|0,Qt(z|0,48,0)),ee=n[T>>2]|0,z=F+m|0,n[R>>2]=z,z=vs(ee,z)|0,n[T>>2]=z,!(z|0)&&(n[(Ht()|0)>>2]|0)==12&&(z=Ae(1)|0,Qt(z|0,48,0))),m=n[B>>2]|0,(m|0)<(C|0))do r[(n[T>>2]|0)+m>>0]=0,m=m+1|0;while((m|0)!=(C|0));n[B>>2]=C,S=x}function qn(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0,we=0,_e=0;if(x=S,S=S+16|0,F=x,n[F>>2]=T,B=m+12|0,C=T+1|0,R=m+16|0,(n[R>>2]|0)<(C|0)&&(ee=m+20|0,G=n[ee>>2]|0,(G|0)<(C|0)&&(X=T+2-G&-2,z=(G>>1)+2&-2,z=(X|0)>(z|0)?X:z,(z|0)>(2147483647-G|0)&&(X=Ae(1)|0,Qt(X|0,48,0)),oe=n[B>>2]|0,X=z+G|0,n[ee>>2]=X,X=vs(oe,X<<2)|0,n[B>>2]=X,!(X|0)&&(n[(Ht()|0)>>2]|0)==12&&(oe=Ae(1)|0,Qt(oe|0,48,0))),G=n[R>>2]|0,(C|0)>(G|0)&&ja((n[B>>2]|0)+(G<<2)|0,-1,C-G<<2|0)|0,n[R>>2]=C),n[(n[B>>2]|0)+(T<<2)>>2]=n[m+4>>2],Xi(m,F),C=n[B>>2]|0,G=n[C+(T<<2)>>2]|0,T=n[m>>2]|0,B=n[T+(G<<2)>>2]|0,!G){X=0,oe=T+(X<<2)|0,n[oe>>2]=B,oe=C+(B<<2)|0,n[oe>>2]=X,S=x;return}for(m=m+28|0,F=B<<1,R=F|1;;){if(X=G,G=G+-1>>1,z=T+(G<<2)|0,ee=n[z>>2]|0,_e=n[n[m>>2]>>2]|0,ue=n[_e+(F<<2)>>2]|0,we=n[_e+(R<<2)>>2]|0,ue=er(we|0,((we|0)<0)<<31>>31|0,ue|0,((ue|0)<0)<<31>>31|0)|0,we=ht,re=ee<<1,oe=n[_e+(re<<2)>>2]|0,re=n[_e+((re|1)<<2)>>2]|0,oe=er(re|0,((re|0)<0)<<31>>31|0,oe|0,((oe|0)<0)<<31>>31|0)|0,re=ht,!(we>>>0<re>>>0|(we|0)==(re|0)&ue>>>0<oe>>>0)){m=14;break}if(n[T+(X<<2)>>2]=ee,n[C+(n[z>>2]<<2)>>2]=X,!G){X=0,m=14;break}}if((m|0)==14){_e=T+(X<<2)|0,n[_e>>2]=B,_e=C+(B<<2)|0,n[_e>>2]=X,S=x;return}}function Es(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0,we=0,_e=0,Be=0,Xe=0;x=S,F=m+824|0,ee=(n[m+840>>2]|0)>(T|0),ee&&(n[(n[m+836>>2]|0)+(T<<2)>>2]|0)>-1?R=7:R=3;do if((R|0)==3){if(r[(n[m+876>>2]|0)+T>>0]|0){S=x;return}if(r[(n[m+904>>2]|0)+T>>0]|0){S=x;return}if(oe=r[(n[m+332>>2]|0)+T>>0]|0,X=r[2624]|0,ue=X&255,(ue>>>1^1)&oe<<24>>24==X<<24>>24|oe&2&ue)if(ee){R=7;break}else break;else{S=x;return}}while(!1);if((R|0)==7&&(C=n[m+836>>2]|0,B=C+(T<<2)|0,G=n[B>>2]|0,(G|0)>-1)){T=n[F>>2]|0,R=n[T+(G<<2)>>2]|0;e:do if(!G)oe=0;else for(ee=m+852|0,z=R<<1,m=z|1;;){if(oe=G,G=G+-1>>1,ue=T+(G<<2)|0,X=n[ue>>2]|0,Xe=n[n[ee>>2]>>2]|0,we=n[Xe+(z<<2)>>2]|0,Be=n[Xe+(m<<2)>>2]|0,we=er(Be|0,((Be|0)<0)<<31>>31|0,we|0,((we|0)<0)<<31>>31|0)|0,Be=ht,_e=X<<1,re=n[Xe+(_e<<2)>>2]|0,_e=n[Xe+((_e|1)<<2)>>2]|0,re=er(_e|0,((_e|0)<0)<<31>>31|0,re|0,((re|0)<0)<<31>>31|0)|0,_e=ht,!(Be>>>0<_e>>>0|(Be|0)==(_e|0)&we>>>0<re>>>0))break e;if(n[T+(oe<<2)>>2]=X,n[C+(n[ue>>2]<<2)>>2]=oe,!G){oe=0;break}}while(!1);n[T+(oe<<2)>>2]=R,n[C+(R<<2)>>2]=oe,io(F,n[B>>2]|0),S=x;return}qn(F,T),S=x}function io(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0,we=0,_e=0,Be=0,Xe=0,Qe=0;if(x=S,C=n[m>>2]|0,B=n[C+(T<<2)>>2]|0,X=T<<1|1,z=m+4|0,ue=n[z>>2]|0,(X|0)>=(ue|0)){re=T,we=m+12|0,ue=C+(re<<2)|0,n[ue>>2]=B,we=n[we>>2]|0,we=we+(B<<2)|0,n[we>>2]=re,S=x;return}for(R=m+28|0,ee=B<<1,G=ee|1,m=m+12|0;;){if(oe=(T<<1)+2|0,(oe|0)<(ue|0)?(re=n[C+(oe<<2)>>2]|0,we=n[C+(X<<2)>>2]|0,Qe=re<<1,ue=n[n[R>>2]>>2]|0,Be=n[ue+(Qe<<2)>>2]|0,Qe=n[ue+((Qe|1)<<2)>>2]|0,Be=er(Qe|0,((Qe|0)<0)<<31>>31|0,Be|0,((Be|0)<0)<<31>>31|0)|0,Qe=ht,Xe=we<<1,_e=n[ue+(Xe<<2)>>2]|0,Xe=n[ue+((Xe|1)<<2)>>2]|0,_e=er(Xe|0,((Xe|0)<0)<<31>>31|0,_e|0,((_e|0)<0)<<31>>31|0)|0,Xe=ht,Qe>>>0<Xe>>>0|(Qe|0)==(Xe|0)&Be>>>0<_e>>>0||(re=we,F=7)):(re=n[C+(X<<2)>>2]|0,ue=n[n[R>>2]>>2]|0,F=7),(F|0)==7&&(F=0,oe=X),_e=re<<1,Xe=n[ue+(_e<<2)>>2]|0,_e=n[ue+((_e|1)<<2)>>2]|0,Xe=er(_e|0,((_e|0)<0)<<31>>31|0,Xe|0,((Xe|0)<0)<<31>>31|0)|0,_e=ht,Qe=n[ue+(ee<<2)>>2]|0,Be=n[ue+(G<<2)>>2]|0,Qe=er(Be|0,((Be|0)<0)<<31>>31|0,Qe|0,((Qe|0)<0)<<31>>31|0)|0,Be=ht,!(_e>>>0<Be>>>0|(_e|0)==(Be|0)&Xe>>>0<Qe>>>0)){F=10;break}if(n[C+(T<<2)>>2]=re,n[(n[m>>2]|0)+(re<<2)>>2]=T,X=oe<<1|1,ue=n[z>>2]|0,(X|0)>=(ue|0)){T=oe,F=10;break}else T=oe}if((F|0)==10){Qe=C+(T<<2)|0,n[Qe>>2]=B,Qe=n[m>>2]|0,Qe=Qe+(B<<2)|0,n[Qe>>2]=T,S=x;return}}function Hn(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0,ee=0;if(x=S,R=n[m>>2]|0,R){C=m+4|0,B=n[C>>2]|0;e:do if((B|0)>0)for(F=0;;){if(G=R+(F*12|0)|0,ee=n[G>>2]|0,ee&&(n[R+(F*12|0)+4>>2]=0,yi(ee),n[G>>2]=0,n[R+(F*12|0)+8>>2]=0,B=n[C>>2]|0),F=F+1|0,(F|0)>=(B|0))break e;R=n[m>>2]|0}while(!1);n[C>>2]=0,T&&(yi(n[m>>2]|0),n[m>>2]=0,n[m+8>>2]=0)}if(C=m+16|0,B=n[C>>2]|0,B|0&&(n[m+20>>2]=0,T)&&(yi(B),n[C>>2]=0,n[m+24>>2]=0),B=m+32|0,C=n[B>>2]|0,!C){S=x;return}if(n[m+36>>2]=0,!T){S=x;return}yi(C),n[B>>2]=0,n[m+40>>2]=0,S=x}function yn(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0;if(C=S,B=n[m>>2]|0,x=m+4|0,B?(n[x>>2]=0,T&&(yi(B),n[m>>2]=0,n[m+8>>2]=0,B=0)):B=0,(n[x>>2]|0)>=1){R=m+16|0,n[R>>2]=0,R=m+12|0,n[R>>2]=0,S=C;return}if(R=m+8|0,F=n[R>>2]|0,(F|0)<1&&(G=2-F&-2,T=(F>>1)+2&-2,T=(G|0)>(T|0)?G:T,(T|0)>(2147483647-F|0)&&(G=Ae(1)|0,Qt(G|0,48,0)),G=T+F|0,n[R>>2]=G,B=vs(B,G<<2)|0,n[m>>2]=B,!(B|0)&&(n[(Ht()|0)>>2]|0)==12&&(G=Ae(1)|0,Qt(G|0,48,0))),T=n[x>>2]|0,(T|0)<1)for(;F=B+(T<<2)|0,F&&(n[F>>2]=0),T;)T=T+1|0;n[x>>2]=1,G=m+16|0,n[G>>2]=0,G=m+12|0,n[G>>2]=0,S=C}function yr(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0;if(C=S,S=S+16|0,x=C,B=m+16|0,G=n[B>>2]|0,n[B>>2]=G+1,n[(n[m>>2]|0)+(G<<2)>>2]=T,G=n[B>>2]|0,T=m+4|0,R=n[T>>2]|0,(G|0)==(R|0)&&(n[B>>2]=0,G=0),F=m+12|0,(n[F>>2]|0)!=(G|0)){S=C;return}if(Xr(x,(R*3|0)+1>>1),z=n[F>>2]|0,X=n[T>>2]|0,(z|0)<(X|0))for(G=n[m>>2]|0,ee=n[x>>2]|0,X=0;;)if(R=X+1|0,n[ee+(X<<2)>>2]=n[G+(z<<2)>>2],z=z+1|0,X=n[T>>2]|0,(z|0)>=(X|0)){ee=R;break}else X=R;else ee=0;if(R=n[m>>2]|0,(n[B>>2]|0)>0){for(G=n[x>>2]|0,z=0;n[G+(ee<<2)>>2]=n[R+(z<<2)>>2],z=z+1|0,!((z|0)>=(n[B>>2]|0));)ee=ee+1|0;X=n[T>>2]|0}n[F>>2]=0,n[B>>2]=X,R?(n[T>>2]=0,yi(R),n[m>>2]=0,B=m+8|0,n[B>>2]=0):B=m+8|0,n[m>>2]=n[x>>2],z=x+4|0,n[T>>2]=n[z>>2],X=x+8|0,n[B>>2]=n[X>>2],n[x>>2]=0,n[z>>2]=0,n[X>>2]=0,S=C}function zn(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0;if(x=S,C=m+4|0,B=n[C>>2]|0,F=m+8|0,R=n[F>>2]|0,(B|0)==(R|0)&(R|0)<(B+1|0)?(R=(B>>1)+2&-2,R=(R|0)<2?2:R,(R|0)>(2147483647-B|0)&&(R=Ae(1)|0,Qt(R|0,48,0)),G=n[m>>2]|0,B=R+B|0,n[F>>2]=B,B=vs(G,B<<2)|0,n[m>>2]=B,!(B|0)&&(n[(Ht()|0)>>2]|0)==12&&(G=Ae(1)|0,Qt(G|0,48,0))):B=n[m>>2]|0,G=n[C>>2]|0,n[C>>2]=G+1,C=B+(G<<2)|0,!C){S=x;return}n[C>>2]=n[T>>2],S=x}function Ln(){var m=0,T=0;return T=S,Tt(3864)|0,m=Ue(936)|0,gr(m),S=T,m|0}function ha(m){m=m|0;var T=0;if(T=S,!m){S=T;return}vo[n[(n[m>>2]|0)+4>>2]&31](m),S=T}function $n(){var m=0,T=0,x=0;m=S,S=S+16|0,T=m,x=Ue(936)|0,gr(x),n[964]=x,Ir(x,1)|0,x=n[964]|0,r[T+0>>0]=r[3840]|0,dn(x,T,1)|0,S=m}function Mo(m){m=m|0;var T=0,x=0,C=0;if(T=S,S=S+16|0,x=T,(n[962]|0)>=(m|0)){S=T;return}do C=n[964]|0,r[x+0>>0]=r[3840]|0,dn(C,x,1)|0,C=(n[962]|0)+1|0,n[962]=C;while((C|0)<(m|0));S=T}function ca(m){m=m|0;var T=0,x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0;if(B=S,S=S+32|0,F=B+16|0,x=B+4|0,R=B,n[x>>2]=0,C=x+4|0,n[C>>2]=0,T=x+8|0,n[T>>2]=0,G=n[m>>2]|0,G)do{if(ee=(G|0)<0?0-G|0:G,(n[962]|0)<(ee|0))do z=n[964]|0,r[F+0>>0]=r[3840]|0,dn(z,F,1)|0,z=(n[962]|0)+1|0,n[962]=z;while((z|0)<(ee|0));n[R>>2]=ee<<1|G>>>31,Ys(x,R),m=m+4|0,G=n[m>>2]|0}while(G|0);return R=n[964]|0,F=R+628|0,Ua(x,F),F=Fn(R,F)|0,R=n[x>>2]|0,R?(n[C>>2]=0,yi(R),n[x>>2]=0,n[T>>2]=0,S=B,F|0):(S=B,F|0)}function ko(){var m=0,T=0,x=0,C=0;return T=S,S=S+16|0,m=T,x=n[964]|0,C=x+664|0,n[C+0>>2]=-1,n[C+4>>2]=-1,n[C+8>>2]=-1,n[C+12>>2]=-1,n[x+304>>2]|0&&(n[x+308>>2]=0),Ps(m,x,1,0),S=T,(r[m>>0]|0)==0|0}function Ro(){return(n[(n[964]|0)+4>>2]|0)+1|0}function da(){return n[962]|0}function pa(m){m=m|0;var T=0,x=0,C=0,B=0,F=0,R=0;return T=S,S=S+32|0,F=T+16|0,C=T+4|0,R=T,n[C>>2]=0,x=C+4|0,n[x>>2]=0,B=C+8|0,n[B>>2]=0,n[R>>2]=m<<1,Ys(C,R),m=n[964]|0,R=m+664|0,n[R+0>>2]=-1,n[R+4>>2]=-1,n[R+8>>2]=-1,n[R+12>>2]=-1,Ua(C,m+304|0),Ps(F,m,1,0),m=(r[F>>0]|0)==0,F=n[C>>2]|0,F?(n[x>>2]=0,yi(F),n[C>>2]=0,n[B>>2]=0,S=T,m|0):(S=T,m|0)}function No(m){m=m|0;var T=0,x=0,C=0;T=S,S=S+16|0,C=T,x=n[964]|0,n[C>>2]=m<<1|1,m=x+628|0,n[m>>2]|0&&(n[x+632>>2]=0),Ys(m,C),Fn(x,m)|0,S=T}function Mr(){return n[(n[964]|0)+36>>2]|0}function fa(){return n[(n[964]|0)+32>>2]|0}function Ua(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0;if(x=S,R=n[T>>2]|0,C=T+4|0,R?(n[C>>2]=0,G=0):G=n[C>>2]|0,C=m+4|0,B=n[C>>2]|0,F=T+4|0,(G|0)<(B|0)){ee=T+8|0,G=n[ee>>2]|0,(G|0)<(B|0)&&(X=B+1-G&-2,z=(G>>1)+2&-2,z=(X|0)>(z|0)?X:z,(z|0)>(2147483647-G|0)&&(X=Ae(1)|0,Qt(X|0,48,0)),X=z+G|0,n[ee>>2]=X,R=vs(R,X<<2)|0,n[T>>2]=R,!(R|0)&&(n[(Ht()|0)>>2]|0)==12&&(X=Ae(1)|0,Qt(X|0,48,0))),G=n[F>>2]|0;e:do if((G|0)<(B|0))for(;;){if(R=R+(G<<2)|0,R&&(n[R>>2]=0),G=G+1|0,(G|0)==(B|0))break e;R=n[T>>2]|0}while(!1);n[F>>2]=B,B=n[C>>2]|0}if((B|0)<=0){S=x;return}T=n[T>>2]|0,m=n[m>>2]|0,B=0;do n[T+(B<<2)>>2]=n[m+(B<<2)>>2],B=B+1|0;while((B|0)<(n[C>>2]|0));S=x}function Cn(m,T){m=m|0,T=T|0;var x=0;x=S,S=S+16|0,n[x>>2]=T,T=n[Q>>2]|0,qe(T|0,m|0,x|0)|0,wi(10,T|0)|0,Lt()}function ga(){var m=0,T=0;if(m=S,S=S+16|0,wt(4064,3)|0)Cn(4072,m);else return T=pt(n[1014]|0)|0,S=m,T|0;return 0}function Ue(m){m=m|0;var T=0,x=0;if(T=S,m=m|0?m:1,x=ya(m)|0,x)return S=T,x|0;for(;;){if(x=ui()|0,!x){m=4;break}if(Sl[x&3](),x=ya(m)|0,x){m=5;break}}if((m|0)==4)x=Ae(4)|0,n[x>>2]=4248,Qt(x|0,4296,12);else if((m|0)==5)return S=T,x|0;return 0}function ot(m){m=m|0;var T=0;T=S,yi(m),S=T}function vt(m){m=m|0;var T=0;T=S,ot(m),S=T}function Bt(m){m=m|0}function xt(m){return m=m|0,4264}function Wt(m){m=m|0;var T=0;T=S,S=S+16|0,Sl[m&3](),Cn(4312,T)}function Ut(){var m=0,T=0;T=ga()|0,T|0&&(m=n[T>>2]|0,(m|0)!=0)&&(T=m+48|0,(n[T>>2]&-256|0)==1126902528?(n[T+4>>2]|0)==1129074247:0)&&Wt(n[m+12>>2]|0),T=n[968]|0,n[968]=T+0,Wt(T)}function ui(){var m=0;return m=n[1102]|0,n[1102]=m+0,m|0}function Di(m){m=m|0}function Yi(m){m=m|0}function Ui(m){m=m|0}function Bi(m){m=m|0}function ms(m){m=m|0}function ct(m){m=m|0;var T=0;T=S,ot(m),S=T}function Ot(m){m=m|0;var T=0;T=S,ot(m),S=T}function It(m,T,x){m=m|0,T=T|0,x=x|0;var C=0,B=0,F=0,R=0;if(C=S,S=S+64|0,B=C,(m|0)==(T|0))return R=1,S=C,R|0;if(!T||(T=Rs(T,4504,4560,0)|0,!T))return R=0,S=C,R|0;R=B+0|0,F=R+56|0;do n[R>>2]=0,R=R+4|0;while((R|0)<(F|0));return n[B>>2]=T,n[B+8>>2]=m,n[B+12>>2]=-1,n[B+48>>2]=1,Al[n[(n[T>>2]|0)+28>>2]&3](T,B,n[x>>2]|0,1),(n[B+24>>2]|0)!=1?(R=0,S=C,R|0):(n[x>>2]=n[B+16>>2],R=1,S=C,R|0)}function li(m,T,x,C){m=m|0,T=T|0,x=x|0,C=C|0;var B=0,F=0;if(m=S,B=T+16|0,F=n[B>>2]|0,!F){n[B>>2]=x,n[T+24>>2]=C,n[T+36>>2]=1,S=m;return}if((F|0)!=(x|0)){F=T+36|0,n[F>>2]=(n[F>>2]|0)+1,n[T+24>>2]=2,r[T+54>>0]=1,S=m;return}if(x=T+24|0,(n[x>>2]|0)!=2){S=m;return}n[x>>2]=C,S=m}function xi(m,T,x,C){m=m|0,T=T|0,x=x|0,C=C|0;var B=0;if(B=S,(n[T+8>>2]|0)!=(m|0)){S=B;return}li(0,T,x,C),S=B}function Ii(m,T,x,C){m=m|0,T=T|0,x=x|0,C=C|0;var B=0;if(B=S,(m|0)==(n[T+8>>2]|0)){li(0,T,x,C),S=B;return}else{m=n[m+8>>2]|0,Al[n[(n[m>>2]|0)+28>>2]&3](m,T,x,C),S=B;return}}function Rs(m,T,x,C){m=m|0,T=T|0,x=x|0,C=C|0;var B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0;B=S,S=S+64|0,F=B,R=n[m>>2]|0,G=m+(n[R+-8>>2]|0)|0,R=n[R+-4>>2]|0,n[F>>2]=x,n[F+4>>2]=m,n[F+8>>2]=T,n[F+12>>2]=C,z=F+16|0,X=F+20|0,T=F+24|0,ee=F+28|0,C=F+32|0,m=F+40|0,oe=(R|0)==(x|0),ue=z+0|0,x=ue+36|0;do n[ue>>2]=0,ue=ue+4|0;while((ue|0)<(x|0));return o[z+36>>1]=0,r[z+38>>0]=0,oe?(n[F+48>>2]=1,Ja[n[(n[R>>2]|0)+20>>2]&3](R,F,G,G,1,0),ue=(n[T>>2]|0)==1?G:0,S=B,ue|0):(_l[n[(n[R>>2]|0)+24>>2]&3](R,F,G,1,0),F=n[F+36>>2]|0,F?(F|0)==1?(n[T>>2]|0)!=1&&!((n[m>>2]|0)==0&(n[ee>>2]|0)==1&(n[C>>2]|0)==1)?(ue=0,S=B,ue|0):(ue=n[z>>2]|0,S=B,ue|0):(ue=0,S=B,ue|0):(ue=(n[m>>2]|0)==1&(n[ee>>2]|0)==1&(n[C>>2]|0)==1?n[X>>2]|0:0,S=B,ue|0))}function ys(m,T,x,C,B){m=m|0,T=T|0,x=x|0,C=C|0,B=B|0;var F=0;if(m=S,r[T+53>>0]=1,(n[T+4>>2]|0)!=(C|0)){S=m;return}if(r[T+52>>0]=1,C=T+16|0,F=n[C>>2]|0,!F){if(n[C>>2]=x,n[T+24>>2]=B,n[T+36>>2]=1,!((B|0)==1&&(n[T+48>>2]|0)==1)){S=m;return}r[T+54>>0]=1,S=m;return}if((F|0)!=(x|0)){F=T+36|0,n[F>>2]=(n[F>>2]|0)+1,r[T+54>>0]=1,S=m;return}if(x=T+24|0,C=n[x>>2]|0,(C|0)==2?n[x>>2]=B:B=C,!((B|0)==1&&(n[T+48>>2]|0)==1)){S=m;return}r[T+54>>0]=1,S=m}function ml(m,T,x,C,B){m=m|0,T=T|0,x=x|0,C=C|0,B=B|0;var F=0,R=0,G=0,ee=0,z=0;if(F=S,(m|0)==(n[T+8>>2]|0)){if((n[T+4>>2]|0)!=(x|0)){S=F;return}if(R=T+28|0,(n[R>>2]|0)==1){S=F;return}n[R>>2]=C,S=F;return}if((m|0)!=(n[T>>2]|0)){ee=n[m+8>>2]|0,_l[n[(n[ee>>2]|0)+24>>2]&3](ee,T,x,C,B),S=F;return}if((n[T+16>>2]|0)!=(x|0)&&(G=T+20|0,(n[G>>2]|0)!=(x|0))){if(n[T+32>>2]=C,C=T+44|0,(n[C>>2]|0)==4){S=F;return}ee=T+52|0,r[ee>>0]=0,z=T+53|0,r[z>>0]=0,m=n[m+8>>2]|0,Ja[n[(n[m>>2]|0)+20>>2]&3](m,T,x,x,1,B),r[z>>0]|0?r[ee>>0]|0||(m=1,R=13):(m=0,R=13);do if((R|0)==13){if(n[G>>2]=x,z=T+40|0,n[z>>2]=(n[z>>2]|0)+1,(n[T+36>>2]|0)==1&&(n[T+24>>2]|0)==2){if(r[T+54>>0]=1,m)break}else R=16;if((R|0)==16&&m)break;n[C>>2]=4,S=F;return}while(!1);n[C>>2]=3,S=F;return}if((C|0)!=1){S=F;return}n[T+32>>2]=1,S=F}function Wh(m,T,x,C,B){m=m|0,T=T|0,x=x|0,C=C|0,B=B|0;var F=0;if(B=S,(n[T+8>>2]|0)==(m|0)){if((n[T+4>>2]|0)!=(x|0)){S=B;return}if(T=T+28|0,(n[T>>2]|0)==1){S=B;return}n[T>>2]=C,S=B;return}if((n[T>>2]|0)!=(m|0)){S=B;return}if((n[T+16>>2]|0)!=(x|0)&&(F=T+20|0,(n[F>>2]|0)!=(x|0))){n[T+32>>2]=C,n[F>>2]=x,m=T+40|0,n[m>>2]=(n[m>>2]|0)+1,(n[T+36>>2]|0)==1&&(n[T+24>>2]|0)==2&&(r[T+54>>0]=1),n[T+44>>2]=4,S=B;return}if((C|0)!=1){S=B;return}n[T+32>>2]=1,S=B}function Jn(m,T,x,C,B,F){m=m|0,T=T|0,x=x|0,C=C|0,B=B|0,F=F|0;var R=0;if(R=S,(m|0)==(n[T+8>>2]|0)){ys(0,T,x,C,B),S=R;return}else{m=n[m+8>>2]|0,Ja[n[(n[m>>2]|0)+20>>2]&3](m,T,x,C,B,F),S=R;return}}function Ga(m,T,x,C,B,F){if(m=m|0,T=T|0,x=x|0,C=C|0,B=B|0,F=F|0,F=S,(n[T+8>>2]|0)!=(m|0)){S=F;return}ys(0,T,x,C,B),S=F}function Yh(m,T,x){m=m|0,T=T|0,x=x|0;var C=0,B=0;return C=S,S=S+16|0,B=C,n[B>>2]=n[x>>2],m=La[n[(n[m>>2]|0)+16>>2]&1](m,T,B)|0,T=m&1,m?(n[x>>2]=n[B>>2],S=C,T|0):(S=C,T|0)}function ma(m){m=m|0;var T=0;return T=S,m?m=(Rs(m,4504,4672,0)|0)!=0:m=0,S=T,m&1|0}function Wa(){var m=0,T=0,x=0,C=0,B=0;m=S,S=S+16|0,T=m,m=m+12|0,x=ga()|0,x||Cn(4040,T),x=n[x>>2]|0,x||Cn(4040,T),B=x+48|0,C=n[B>>2]|0,B=n[B+4>>2]|0,(C&-256|0)==1126902528&(B|0)==1129074247||(n[T>>2]=n[970],Cn(4e3,T)),(C|0)==1126902529&(B|0)==1129074247?C=n[x+44>>2]|0:C=x+80|0,n[m>>2]=C,B=n[x>>2]|0,x=n[B+4>>2]|0,La[n[(n[1108]|0)+16>>2]&1](4432,B,m)|0?(B=n[m>>2]|0,C=n[970]|0,B=fh[n[(n[B>>2]|0)+8>>2]&1](B)|0,n[T>>2]=C,n[T+4>>2]=x,n[T+8>>2]=B,Cn(3904,T)):(n[T>>2]=n[970],n[T+4>>2]=x,Cn(3952,T))}function Ya(){var m=0;if(m=S,S=S+16|0,ni(4056,20)|0)Cn(4128,m);else{S=m;return}}function qs(m){m=m|0;var T=0;if(T=S,S=S+16|0,yi(m),Ci(n[1014]|0,0)|0)Cn(4184,T);else{S=T;return}}function ya(m){m=m|0;var T=0,x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0,we=0,_e=0,Be=0,Xe=0,Qe=0,at=0,kt=0,hi=0,ri=0,dt=0,Yt=0,ii=0,qt=0,ei=0,Rt=0,$t=0,Ft=0,lt=0;T=S;do if(m>>>0<245){if(m>>>0<11?m=16:m=m+11&-8,hi=m>>>3,re=n[1206]|0,kt=re>>>hi,kt&3){F=(kt&1^1)+hi|0,B=F<<1,x=4864+(B<<2)|0,B=4864+(B+2<<2)|0,R=n[B>>2]|0,G=R+8|0,C=n[G>>2]|0;do if((x|0)!=(C|0))if(C>>>0<(n[1210]|0)>>>0&&Lt(),ee=C+12|0,(n[ee>>2]|0)==(R|0)){n[ee>>2]=x,n[B>>2]=C;break}else Lt();else n[1206]=re&~(1<<F);while(!1);return lt=F<<3,n[R+4>>2]=lt|3,lt=R+(lt|4)|0,n[lt>>2]=n[lt>>2]|1,lt=G,S=T,lt|0}if(at=n[1208]|0,m>>>0>at>>>0){if(kt){R=2<<hi,R=kt<<hi&(R|0-R),R=(R&0-R)+-1|0,x=R>>>12&16,R=R>>>x,G=R>>>5&8,R=R>>>G,B=R>>>2&4,R=R>>>B,F=R>>>1&2,R=R>>>F,C=R>>>1&1,C=(G|x|B|F|C)+(R>>>C)|0,R=C<<1,F=4864+(R<<2)|0,R=4864+(R+2<<2)|0,B=n[R>>2]|0,x=B+8|0,G=n[x>>2]|0;do if((F|0)!=(G|0))if(G>>>0<(n[1210]|0)>>>0&&Lt(),ee=G+12|0,(n[ee>>2]|0)==(B|0)){n[ee>>2]=F,n[R>>2]=G,Rt=n[1208]|0;break}else Lt();else n[1206]=re&~(1<<C),Rt=at;while(!1);return lt=C<<3,C=lt-m|0,n[B+4>>2]=m|3,F=B+m|0,n[B+(m|4)>>2]=C|1,n[B+lt>>2]=C,Rt&&(B=n[1211]|0,z=Rt>>>3,G=z<<1,R=4864+(G<<2)|0,ee=n[1206]|0,z=1<<z,ee&z?(G=4864+(G+2<<2)|0,ee=n[G>>2]|0,ee>>>0<(n[1210]|0)>>>0?Lt():(ei=G,qt=ee)):(n[1206]=ee|z,ei=4864+(G+2<<2)|0,qt=R),n[ei>>2]=B,n[qt+12>>2]=B,n[B+8>>2]=qt,n[B+12>>2]=R),n[1208]=C,n[1211]=F,lt=x,S=T,lt|0}if(re=n[1207]|0,re){for(x=(re&0-re)+-1|0,Ft=x>>>12&16,x=x>>>Ft,$t=x>>>5&8,x=x>>>$t,lt=x>>>2&4,x=x>>>lt,B=x>>>1&2,x=x>>>B,C=x>>>1&1,C=n[5128+(($t|Ft|lt|B|C)+(x>>>C)<<2)>>2]|0,x=(n[C+4>>2]&-8)-m|0,B=C;F=n[B+16>>2]|0,!(!F&&(F=n[B+20>>2]|0,!F));)B=(n[F+4>>2]&-8)-m|0,lt=B>>>0<x>>>0,x=lt?B:x,B=F,C=lt?F:C;R=n[1210]|0,C>>>0<R>>>0&&Lt(),B=C+m|0,C>>>0>=B>>>0&&Lt(),F=n[C+24>>2]|0,ee=n[C+12>>2]|0;do if((ee|0)==(C|0)){if(ee=C+20|0,G=n[ee>>2]|0,!G&&(ee=C+16|0,G=n[ee>>2]|0,!G)){ii=0;break}for(;;){if(z=G+20|0,X=n[z>>2]|0,X){G=X,ee=z;continue}if(z=G+16|0,X=n[z>>2]|0,X)G=X,ee=z;else break}if(ee>>>0<R>>>0)Lt();else{n[ee>>2]=0,ii=G;break}}else if(G=n[C+8>>2]|0,G>>>0<R>>>0&&Lt(),R=G+12|0,(n[R>>2]|0)!=(C|0)&&Lt(),z=ee+8|0,(n[z>>2]|0)==(C|0)){n[R>>2]=ee,n[z>>2]=G,ii=ee;break}else Lt();while(!1);do if(F){if(G=n[C+28>>2]|0,R=5128+(G<<2)|0,(C|0)==(n[R>>2]|0)){if(n[R>>2]=ii,!ii){n[1207]=n[1207]&~(1<<G);break}}else if(F>>>0<(n[1210]|0)>>>0&&Lt(),R=F+16|0,(n[R>>2]|0)==(C|0)?n[R>>2]=ii:n[F+20>>2]=ii,!ii)break;R=n[1210]|0,ii>>>0<R>>>0&&Lt(),n[ii+24>>2]=F,F=n[C+16>>2]|0;do if(F)if(F>>>0<R>>>0)Lt();else{n[ii+16>>2]=F,n[F+24>>2]=ii;break}while(!1);if(F=n[C+20>>2]|0,F)if(F>>>0<(n[1210]|0)>>>0)Lt();else{n[ii+20>>2]=F,n[F+24>>2]=ii;break}}while(!1);return x>>>0<16?(lt=x+m|0,n[C+4>>2]=lt|3,lt=C+(lt+4)|0,n[lt>>2]=n[lt>>2]|1):(n[C+4>>2]=m|3,n[C+(m|4)>>2]=x|1,n[C+(x+m)>>2]=x,R=n[1208]|0,R&&(F=n[1211]|0,ee=R>>>3,z=ee<<1,R=4864+(z<<2)|0,G=n[1206]|0,ee=1<<ee,G&ee?(G=4864+(z+2<<2)|0,ee=n[G>>2]|0,ee>>>0<(n[1210]|0)>>>0?Lt():(Yt=G,dt=ee)):(n[1206]=G|ee,Yt=4864+(z+2<<2)|0,dt=R),n[Yt>>2]=F,n[dt+12>>2]=F,n[F+8>>2]=dt,n[F+12>>2]=R),n[1208]=x,n[1211]=B),lt=C+8|0,S=T,lt|0}}}else if(m>>>0<=4294967231){if(dt=m+11|0,m=dt&-8,ii=n[1207]|0,ii){Yt=0-m|0,dt=dt>>>8,dt?m>>>0>16777215?qt=31:(Ft=(dt+1048320|0)>>>16&8,lt=dt<<Ft,$t=(lt+520192|0)>>>16&4,lt=lt<<$t,qt=(lt+245760|0)>>>16&2,qt=14-($t|Ft|qt)+(lt<<qt>>>15)|0,qt=m>>>(qt+7|0)&1|qt<<1):qt=0,ei=n[5128+(qt<<2)>>2]|0;e:do if(!ei)$t=0,dt=0;else for((qt|0)==31?dt=0:dt=25-(qt>>>1)|0,$t=0,Rt=m<<dt,dt=0;;){if(Ft=n[ei+4>>2]&-8,lt=Ft-m|0,lt>>>0<Yt>>>0)if((Ft|0)==(m|0)){Yt=lt,$t=ei,dt=ei;break e}else Yt=lt,dt=ei;if(lt=n[ei+20>>2]|0,ei=n[ei+(Rt>>>31<<2)+16>>2]|0,$t=(lt|0)==0|(lt|0)==(ei|0)?$t:lt,ei)Rt=Rt<<1;else break}while(!1);if(($t|0)==0&(dt|0)==0){if(lt=2<<qt,ii=ii&(lt|0-lt),!ii)break;lt=(ii&0-ii)+-1|0,ei=lt>>>12&16,lt=lt>>>ei,qt=lt>>>5&8,lt=lt>>>qt,Rt=lt>>>2&4,lt=lt>>>Rt,Ft=lt>>>1&2,lt=lt>>>Ft,$t=lt>>>1&1,$t=n[5128+((qt|ei|Rt|Ft|$t)+(lt>>>$t)<<2)>>2]|0}if($t)for(;;){if(lt=(n[$t+4>>2]&-8)-m|0,ii=lt>>>0<Yt>>>0,Yt=ii?lt:Yt,dt=ii?$t:dt,ii=n[$t+16>>2]|0,ii){$t=ii;continue}if($t=n[$t+20>>2]|0,!$t)break}if(dt|0&&Yt>>>0<((n[1208]|0)-m|0)>>>0){B=n[1210]|0,dt>>>0<B>>>0&&Lt(),x=dt+m|0,dt>>>0>=x>>>0&&Lt(),C=n[dt+24>>2]|0,F=n[dt+12>>2]|0;do if((F|0)==(dt|0)){if(R=dt+20|0,F=n[R>>2]|0,!F&&(R=dt+16|0,F=n[R>>2]|0,!F)){hi=0;break}for(;;){if(G=F+20|0,ee=n[G>>2]|0,ee){F=ee,R=G;continue}if(G=F+16|0,ee=n[G>>2]|0,ee)F=ee,R=G;else break}if(R>>>0<B>>>0)Lt();else{n[R>>2]=0,hi=F;break}}else if(R=n[dt+8>>2]|0,R>>>0<B>>>0&&Lt(),G=R+12|0,(n[G>>2]|0)!=(dt|0)&&Lt(),B=F+8|0,(n[B>>2]|0)==(dt|0)){n[G>>2]=F,n[B>>2]=R,hi=F;break}else Lt();while(!1);do if(C){if(B=n[dt+28>>2]|0,F=5128+(B<<2)|0,(dt|0)==(n[F>>2]|0)){if(n[F>>2]=hi,!hi){n[1207]=n[1207]&~(1<<B);break}}else if(C>>>0<(n[1210]|0)>>>0&&Lt(),B=C+16|0,(n[B>>2]|0)==(dt|0)?n[B>>2]=hi:n[C+20>>2]=hi,!hi)break;B=n[1210]|0,hi>>>0<B>>>0&&Lt(),n[hi+24>>2]=C,C=n[dt+16>>2]|0;do if(C)if(C>>>0<B>>>0)Lt();else{n[hi+16>>2]=C,n[C+24>>2]=hi;break}while(!1);if(C=n[dt+20>>2]|0,C)if(C>>>0<(n[1210]|0)>>>0)Lt();else{n[hi+20>>2]=C,n[C+24>>2]=hi;break}}while(!1);e:do if(Yt>>>0>=16){if(n[dt+4>>2]=m|3,n[dt+(m|4)>>2]=Yt|1,n[dt+(Yt+m)>>2]=Yt,B=Yt>>>3,Yt>>>0<256){R=B<<1,C=4864+(R<<2)|0,F=n[1206]|0,B=1<<B;do if(!(F&B))n[1206]=F|B,kt=4864+(R+2<<2)|0,at=C;else{if(B=4864+(R+2<<2)|0,F=n[B>>2]|0,F>>>0>=(n[1210]|0)>>>0){kt=B,at=F;break}Lt()}while(!1);n[kt>>2]=x,n[at+12>>2]=x,n[dt+(m+8)>>2]=at,n[dt+(m+12)>>2]=C;break}if(C=Yt>>>8,C?Yt>>>0>16777215?C=31:(Ft=(C+1048320|0)>>>16&8,lt=C<<Ft,$t=(lt+520192|0)>>>16&4,lt=lt<<$t,C=(lt+245760|0)>>>16&2,C=14-($t|Ft|C)+(lt<<C>>>15)|0,C=Yt>>>(C+7|0)&1|C<<1):C=0,B=5128+(C<<2)|0,n[dt+(m+28)>>2]=C,n[dt+(m+20)>>2]=0,n[dt+(m+16)>>2]=0,F=n[1207]|0,R=1<<C,!(F&R)){n[1207]=F|R,n[B>>2]=x,n[dt+(m+24)>>2]=B,n[dt+(m+12)>>2]=x,n[dt+(m+8)>>2]=x;break}R=n[B>>2]|0,(C|0)==31?C=0:C=25-(C>>>1)|0;t:do if((n[R+4>>2]&-8|0)!=(Yt|0)){for(C=Yt<<C;F=R+(C>>>31<<2)+16|0,B=n[F>>2]|0,!!B;)if((n[B+4>>2]&-8|0)==(Yt|0)){re=B;break t}else C=C<<1,R=B;if(F>>>0<(n[1210]|0)>>>0)Lt();else{n[F>>2]=x,n[dt+(m+24)>>2]=R,n[dt+(m+12)>>2]=x,n[dt+(m+8)>>2]=x;break e}}else re=R;while(!1);if(B=re+8|0,C=n[B>>2]|0,lt=n[1210]|0,re>>>0>=lt>>>0&C>>>0>=lt>>>0){n[C+12>>2]=x,n[B>>2]=x,n[dt+(m+8)>>2]=C,n[dt+(m+12)>>2]=re,n[dt+(m+24)>>2]=0;break}else Lt()}else lt=Yt+m|0,n[dt+4>>2]=lt|3,lt=dt+(lt+4)|0,n[lt>>2]=n[lt>>2]|1;while(!1);return lt=dt+8|0,S=T,lt|0}}}else m=-1;while(!1);if(re=n[1208]|0,re>>>0>=m>>>0)return C=re-m|0,x=n[1211]|0,C>>>0>15?(n[1211]=x+m,n[1208]=C,n[x+(m+4)>>2]=C|1,n[x+re>>2]=C,n[x+4>>2]=m|3):(n[1208]=0,n[1211]=0,n[x+4>>2]=re|3,lt=x+(re+4)|0,n[lt>>2]=n[lt>>2]|1),lt=x+8|0,S=T,lt|0;if(re=n[1209]|0,re>>>0>m>>>0)return Ft=re-m|0,n[1209]=Ft,lt=n[1212]|0,n[1212]=lt+m,n[lt+(m+4)>>2]=Ft|1,n[lt+4>>2]=m|3,lt=lt+8|0,S=T,lt|0;do if(!(n[1324]|0))if(re=nt(30)|0,re+-1&re)Lt();else{n[1326]=re,n[1325]=re,n[1327]=-1,n[1328]=-1,n[1329]=0,n[1317]=0,n[1324]=(Ki(0)|0)&-16^1431655768;break}while(!1);if(hi=m+48|0,re=n[1326]|0,kt=m+47|0,Yt=re+kt|0,re=0-re|0,at=Yt&re,at>>>0<=m>>>0||(dt=n[1316]|0,dt|0&&(Ft=n[1314]|0,lt=Ft+at|0,lt>>>0<=Ft>>>0|lt>>>0>dt>>>0)))return lt=0,S=T,lt|0;e:do if(n[1317]&4)dt=0,ue=198;else{ii=n[1212]|0;t:do if(ii){for(dt=5272;qt=n[dt>>2]|0,!(qt>>>0<=ii>>>0&&(ri=dt+4|0,(qt+(n[ri>>2]|0)|0)>>>0>ii>>>0));)if(dt=n[dt+8>>2]|0,!dt){ue=181;break t}dt?(Yt=Yt-(n[1209]|0)&re,Yt>>>0<2147483647?(re=Fe(Yt|0)|0,(re|0)==((n[dt>>2]|0)+(n[ri>>2]|0)|0)?(dt=Yt,ue=190):(dt=Yt,ue=191)):dt=0):ue=181}else ue=181;while(!1);do if((ue|0)==181)if(ri=Fe(0)|0,(ri|0)!=-1)if(Yt=ri,dt=n[1325]|0,re=dt+-1|0,re&Yt?dt=at-Yt+(re+Yt&0-dt)|0:dt=at,re=n[1314]|0,Yt=re+dt|0,dt>>>0>m>>>0&dt>>>0<2147483647){if(lt=n[1316]|0,lt|0&&Yt>>>0<=re>>>0|Yt>>>0>lt>>>0){dt=0;break}re=Fe(dt|0)|0,(re|0)==(ri|0)?(re=ri,ue=190):ue=191}else dt=0;else dt=0;while(!1);t:do if((ue|0)==190){if((re|0)!=-1){we=dt,ue=201;break e}}else if((ue|0)==191){ue=0-dt|0;do if((re|0)!=-1&dt>>>0<2147483647&hi>>>0>dt>>>0&&(Qe=n[1326]|0,Qe=kt-dt+Qe&0-Qe,Qe>>>0<2147483647))if((Fe(Qe|0)|0)==-1){Fe(ue|0)|0,dt=0;break t}else{dt=Qe+dt|0;break}while(!1);if((re|0)==-1)dt=0;else{we=dt,ue=201;break e}}while(!1);n[1317]=n[1317]|4,ue=198}while(!1);if((ue|0)==198&&at>>>0<2147483647&&(Xe=Fe(at|0)|0,Be=Fe(0)|0,(Xe|0)!=-1&(Be|0)!=-1&Xe>>>0<Be>>>0)&&(_e=Be-Xe|0,we=_e>>>0>(m+40|0)>>>0,we)&&(re=Xe,we=we?_e:dt,ue=201),(ue|0)==201){_e=(n[1314]|0)+we|0,n[1314]=_e,_e>>>0>(n[1315]|0)>>>0&&(n[1315]=_e),_e=n[1212]|0;e:do if(_e){for(Xe=5272;;){if(Be=n[Xe>>2]|0,at=Xe+4|0,kt=n[at>>2]|0,(re|0)==(Be+kt|0)){ue=213;break}if(Qe=n[Xe+8>>2]|0,Qe)Xe=Qe;else break}if((ue|0)==213&&!(n[Xe+12>>2]&8|0)&&_e>>>0>=Be>>>0&_e>>>0<re>>>0){n[at>>2]=kt+we,x=(n[1209]|0)+we|0,C=_e+8|0,C&7?C=0-C&7:C=0,lt=x-C|0,n[1212]=_e+C,n[1209]=lt,n[_e+(C+4)>>2]=lt|1,n[_e+(x+4)>>2]=40,n[1213]=n[1328];break}for(Be=n[1210]|0,re>>>0<Be>>>0&&(n[1210]=re,Be=re),at=re+we|0,Xe=5272;;){if((n[Xe>>2]|0)==(at|0)){ue=223;break}if(Qe=n[Xe+8>>2]|0,Qe)Xe=Qe;else break}if((ue|0)==223&&!(n[Xe+12>>2]&8|0)){n[Xe>>2]=re,R=Xe+4|0,n[R>>2]=(n[R>>2]|0)+we,R=re+8|0,R&7?R=0-R&7:R=0,G=re+(we+8)|0,G&7?oe=0-G&7:oe=0,ue=re+(oe+we)|0,ee=R+m|0,G=re+ee|0,X=ue-(re+R)-m|0,n[re+(R+4)>>2]=m|3;t:do if((ue|0)!=(_e|0)){if((ue|0)==(n[1211]|0)){lt=(n[1208]|0)+X|0,n[1208]=lt,n[1211]=G,n[re+(ee+4)>>2]=lt|1,n[re+(lt+ee)>>2]=lt;break}if(_e=we+4|0,Qe=n[re+(_e+oe)>>2]|0,(Qe&3|0)==1){m=Qe&-8,Xe=Qe>>>3;i:do if(Qe>>>0>=256){z=n[re+((oe|24)+we)>>2]|0,Xe=n[re+(we+12+oe)>>2]|0;do if((Xe|0)==(ue|0)){if(at=oe|16,Qe=re+(_e+at)|0,Xe=n[Qe>>2]|0,!Xe&&(Qe=re+(at+we)|0,Xe=n[Qe>>2]|0,!Xe)){F=0;break}for(;;){if(kt=Xe+20|0,at=n[kt>>2]|0,at){Xe=at,Qe=kt;continue}if(kt=Xe+16|0,at=n[kt>>2]|0,at)Xe=at,Qe=kt;else break}if(Qe>>>0<Be>>>0)Lt();else{n[Qe>>2]=0,F=Xe;break}}else if(Qe=n[re+((oe|8)+we)>>2]|0,Qe>>>0<Be>>>0&&Lt(),at=Qe+12|0,(n[at>>2]|0)!=(ue|0)&&Lt(),Be=Xe+8|0,(n[Be>>2]|0)==(ue|0)){n[at>>2]=Xe,n[Be>>2]=Qe,F=Xe;break}else Lt();while(!1);if(!z)break;Be=n[re+(we+28+oe)>>2]|0,Xe=5128+(Be<<2)|0;do if((ue|0)!=(n[Xe>>2]|0)){if(z>>>0<(n[1210]|0)>>>0&&Lt(),Be=z+16|0,(n[Be>>2]|0)==(ue|0)?n[Be>>2]=F:n[z+20>>2]=F,!F)break i}else{if(n[Xe>>2]=F,F)break;n[1207]=n[1207]&~(1<<Be);break i}while(!1);ue=n[1210]|0,F>>>0<ue>>>0&&Lt(),n[F+24>>2]=z,Be=oe|16,z=n[re+(Be+we)>>2]|0;do if(z)if(z>>>0<ue>>>0)Lt();else{n[F+16>>2]=z,n[z+24>>2]=F;break}while(!1);if(z=n[re+(_e+Be)>>2]|0,!z)break;if(z>>>0<(n[1210]|0)>>>0)Lt();else{n[F+20>>2]=z,n[z+24>>2]=F;break}}else{F=n[re+((oe|8)+we)>>2]|0,_e=n[re+(we+12+oe)>>2]|0,Qe=4864+(Xe<<1<<2)|0;do if((F|0)!=(Qe|0)){if(F>>>0<Be>>>0&&Lt(),(n[F+12>>2]|0)==(ue|0))break;Lt()}while(!1);if((_e|0)==(F|0)){n[1206]=n[1206]&~(1<<Xe);break}do if((_e|0)==(Qe|0))z=_e+8|0;else{if(_e>>>0<Be>>>0&&Lt(),Be=_e+8|0,(n[Be>>2]|0)==(ue|0)){z=Be;break}Lt()}while(!1);n[F+12>>2]=_e,n[z>>2]=F}while(!1);ue=re+((m|oe)+we)|0,X=m+X|0}if(F=ue+4|0,n[F>>2]=n[F>>2]&-2,n[re+(ee+4)>>2]=X|1,n[re+(X+ee)>>2]=X,F=X>>>3,X>>>0<256){z=F<<1,x=4864+(z<<2)|0,X=n[1206]|0,F=1<<F;do if(!(X&F))n[1206]=X|F,B=4864+(z+2<<2)|0,C=x;else{if(z=4864+(z+2<<2)|0,F=n[z>>2]|0,F>>>0>=(n[1210]|0)>>>0){B=z,C=F;break}Lt()}while(!1);n[B>>2]=G,n[C+12>>2]=G,n[re+(ee+8)>>2]=C,n[re+(ee+12)>>2]=x;break}C=X>>>8;do if(!C)C=0;else{if(X>>>0>16777215){C=31;break}Ft=(C+1048320|0)>>>16&8,lt=C<<Ft,$t=(lt+520192|0)>>>16&4,lt=lt<<$t,C=(lt+245760|0)>>>16&2,C=14-($t|Ft|C)+(lt<<C>>>15)|0,C=X>>>(C+7|0)&1|C<<1}while(!1);if(z=5128+(C<<2)|0,n[re+(ee+28)>>2]=C,n[re+(ee+20)>>2]=0,n[re+(ee+16)>>2]=0,F=n[1207]|0,B=1<<C,!(F&B)){n[1207]=F|B,n[z>>2]=G,n[re+(ee+24)>>2]=z,n[re+(ee+12)>>2]=G,n[re+(ee+8)>>2]=G;break}B=n[z>>2]|0,(C|0)==31?C=0:C=25-(C>>>1)|0;i:do if((n[B+4>>2]&-8|0)!=(X|0)){for(C=X<<C;F=B+(C>>>31<<2)+16|0,z=n[F>>2]|0,!!z;)if((n[z+4>>2]&-8|0)==(X|0)){x=z;break i}else C=C<<1,B=z;if(F>>>0<(n[1210]|0)>>>0)Lt();else{n[F>>2]=G,n[re+(ee+24)>>2]=B,n[re+(ee+12)>>2]=G,n[re+(ee+8)>>2]=G;break t}}else x=B;while(!1);if(C=x+8|0,B=n[C>>2]|0,lt=n[1210]|0,x>>>0>=lt>>>0&B>>>0>=lt>>>0){n[B+12>>2]=G,n[C>>2]=G,n[re+(ee+8)>>2]=B,n[re+(ee+12)>>2]=x,n[re+(ee+24)>>2]=0;break}else Lt()}else lt=(n[1209]|0)+X|0,n[1209]=lt,n[1212]=G,n[re+(ee+4)>>2]=lt|1;while(!1);return lt=re+(R|8)|0,S=T,lt|0}for(C=5272;x=n[C>>2]|0,!(x>>>0<=_e>>>0&&(oe=n[C+4>>2]|0,X=x+oe|0,X>>>0>_e>>>0));)C=n[C+8>>2]|0;if(C=x+(oe+-39)|0,C&7?C=0-C&7:C=0,x=x+(oe+-47+C)|0,x=x>>>0<(_e+16|0)>>>0?_e:x,C=x+8|0,B=re+8|0,B&7?B=0-B&7:B=0,lt=we+-40-B|0,n[1212]=re+B,n[1209]=lt,n[re+(B+4)>>2]=lt|1,n[re+(we+-36)>>2]=40,n[1213]=n[1328],n[x+4>>2]=27,n[C+0>>2]=n[1318],n[C+4>>2]=n[1319],n[C+8>>2]=n[1320],n[C+12>>2]=n[1321],n[1318]=re,n[1319]=we,n[1321]=0,n[1320]=C,C=x+28|0,n[C>>2]=7,(x+32|0)>>>0<X>>>0)do lt=C,C=C+4|0,n[C>>2]=7;while((lt+8|0)>>>0<X>>>0);if((x|0)!=(_e|0)){if(x=x-_e|0,C=_e+(x+4)|0,n[C>>2]=n[C>>2]&-2,n[_e+4>>2]=x|1,n[_e+x>>2]=x,C=x>>>3,x>>>0<256){B=C<<1,x=4864+(B<<2)|0,F=n[1206]|0,C=1<<C;do if(!(F&C))n[1206]=F|C,ee=4864+(B+2<<2)|0,G=x;else{if(B=4864+(B+2<<2)|0,C=n[B>>2]|0,C>>>0>=(n[1210]|0)>>>0){ee=B,G=C;break}Lt()}while(!1);n[ee>>2]=_e,n[G+12>>2]=_e,n[_e+8>>2]=G,n[_e+12>>2]=x;break}if(C=x>>>8,C?x>>>0>16777215?C=31:(Ft=(C+1048320|0)>>>16&8,lt=C<<Ft,$t=(lt+520192|0)>>>16&4,lt=lt<<$t,C=(lt+245760|0)>>>16&2,C=14-($t|Ft|C)+(lt<<C>>>15)|0,C=x>>>(C+7|0)&1|C<<1):C=0,G=5128+(C<<2)|0,n[_e+28>>2]=C,n[_e+20>>2]=0,n[_e+16>>2]=0,B=n[1207]|0,F=1<<C,!(B&F)){n[1207]=B|F,n[G>>2]=_e,n[_e+24>>2]=G,n[_e+12>>2]=_e,n[_e+8>>2]=_e;break}B=n[G>>2]|0,(C|0)==31?C=0:C=25-(C>>>1)|0;t:do if((n[B+4>>2]&-8|0)!=(x|0)){for(C=x<<C,G=B;B=G+(C>>>31<<2)+16|0,F=n[B>>2]|0,!!F;)if((n[F+4>>2]&-8|0)==(x|0)){R=F;break t}else C=C<<1,G=F;if(B>>>0<(n[1210]|0)>>>0)Lt();else{n[B>>2]=_e,n[_e+24>>2]=G,n[_e+12>>2]=_e,n[_e+8>>2]=_e;break e}}else R=B;while(!1);if(C=R+8|0,x=n[C>>2]|0,lt=n[1210]|0,R>>>0>=lt>>>0&x>>>0>=lt>>>0){n[x+12>>2]=_e,n[C>>2]=_e,n[_e+8>>2]=x,n[_e+12>>2]=R,n[_e+24>>2]=0;break}else Lt()}}else{lt=n[1210]|0,(lt|0)==0|re>>>0<lt>>>0&&(n[1210]=re),n[1318]=re,n[1319]=we,n[1321]=0,n[1215]=n[1324],n[1214]=-1,x=0;do lt=x<<1,Ft=4864+(lt<<2)|0,n[4864+(lt+3<<2)>>2]=Ft,n[4864+(lt+2<<2)>>2]=Ft,x=x+1|0;while((x|0)!=32);x=re+8|0,x&7?x=0-x&7:x=0,lt=we+-40-x|0,n[1212]=re+x,n[1209]=lt,n[re+(x+4)>>2]=lt|1,n[re+(we+-36)>>2]=40,n[1213]=n[1328]}while(!1);if(x=n[1209]|0,x>>>0>m>>>0)return Ft=x-m|0,n[1209]=Ft,lt=n[1212]|0,n[1212]=lt+m,n[lt+(m+4)>>2]=Ft|1,n[lt+4>>2]=m|3,lt=lt+8|0,S=T,lt|0}return n[(Ht()|0)>>2]=12,lt=0,S=T,lt|0}function yi(m){m=m|0;var T=0,x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0,we=0,_e=0,Be=0,Xe=0,Qe=0,at=0,kt=0;if(T=S,!m){S=T;return}we=m+-8|0,_e=n[1210]|0,we>>>0<_e>>>0&&Lt(),oe=n[m+-4>>2]|0,X=oe&3,(X|0)==1&&Lt(),G=oe&-8,R=m+(G+-8)|0;do if(oe&1)C=we,ue=G;else{if(Qe=n[we>>2]|0,!X){S=T;return}if(we=-8-Qe|0,oe=m+we|0,X=Qe+G|0,oe>>>0<_e>>>0&&Lt(),(oe|0)==(n[1211]|0)){if(C=m+(G+-4)|0,ue=n[C>>2]|0,(ue&3|0)!=3){C=oe,ue=X;break}n[1208]=X,n[C>>2]=ue&-2,n[m+(we+4)>>2]=X|1,n[R>>2]=X,S=T;return}if(Xe=Qe>>>3,Qe>>>0<256){if(C=n[m+(we+8)>>2]|0,ue=n[m+(we+12)>>2]|0,re=4864+(Xe<<1<<2)|0,(C|0)!=(re|0)&&(C>>>0<_e>>>0&&Lt(),(n[C+12>>2]|0)!=(oe|0)&&Lt()),(ue|0)==(C|0)){n[1206]=n[1206]&~(1<<Xe),C=oe,ue=X;break}(ue|0)!=(re|0)?(ue>>>0<_e>>>0&&Lt(),re=ue+8|0,(n[re>>2]|0)==(oe|0)?Be=re:Lt()):Be=ue+8|0,n[C+12>>2]=ue,n[Be>>2]=C,C=oe,ue=X;break}Be=n[m+(we+24)>>2]|0,Xe=n[m+(we+12)>>2]|0;do if((Xe|0)==(oe|0)){if(Qe=m+(we+20)|0,Xe=n[Qe>>2]|0,!Xe&&(Qe=m+(we+16)|0,Xe=n[Qe>>2]|0,!Xe)){re=0;break}for(;;){if(at=Xe+20|0,kt=n[at>>2]|0,kt){Xe=kt,Qe=at;continue}if(at=Xe+16|0,kt=n[at>>2]|0,kt)Xe=kt,Qe=at;else break}if(Qe>>>0<_e>>>0)Lt();else{n[Qe>>2]=0,re=Xe;break}}else if(Qe=n[m+(we+8)>>2]|0,Qe>>>0<_e>>>0&&Lt(),_e=Qe+12|0,(n[_e>>2]|0)!=(oe|0)&&Lt(),at=Xe+8|0,(n[at>>2]|0)==(oe|0)){n[_e>>2]=Xe,n[at>>2]=Qe,re=Xe;break}else Lt();while(!1);if(Be){if(_e=n[m+(we+28)>>2]|0,Xe=5128+(_e<<2)|0,(oe|0)==(n[Xe>>2]|0)){if(n[Xe>>2]=re,!re){n[1207]=n[1207]&~(1<<_e),C=oe,ue=X;break}}else if(Be>>>0<(n[1210]|0)>>>0&&Lt(),_e=Be+16|0,(n[_e>>2]|0)==(oe|0)?n[_e>>2]=re:n[Be+20>>2]=re,!re){C=oe,ue=X;break}_e=n[1210]|0,re>>>0<_e>>>0&&Lt(),n[re+24>>2]=Be,Be=n[m+(we+16)>>2]|0;do if(Be)if(Be>>>0<_e>>>0)Lt();else{n[re+16>>2]=Be,n[Be+24>>2]=re;break}while(!1);if(we=n[m+(we+20)>>2]|0,we)if(we>>>0<(n[1210]|0)>>>0)Lt();else{n[re+20>>2]=we,n[we+24>>2]=re,C=oe,ue=X;break}else C=oe,ue=X}else C=oe,ue=X}while(!1);if(C>>>0>=R>>>0&&Lt(),X=m+(G+-4)|0,oe=n[X>>2]|0,oe&1||Lt(),oe&2)n[X>>2]=oe&-2,n[C+4>>2]=ue|1,n[C+ue>>2]=ue;else{if((R|0)==(n[1212]|0)){if(kt=(n[1209]|0)+ue|0,n[1209]=kt,n[1212]=C,n[C+4>>2]=kt|1,(C|0)!=(n[1211]|0)){S=T;return}n[1211]=0,n[1208]=0,S=T;return}if((R|0)==(n[1211]|0)){kt=(n[1208]|0)+ue|0,n[1208]=kt,n[1211]=C,n[C+4>>2]=kt|1,n[C+kt>>2]=kt,S=T;return}ue=(oe&-8)+ue|0,X=oe>>>3;do if(oe>>>0>=256){z=n[m+(G+16)>>2]|0,X=n[m+(G|4)>>2]|0;do if((X|0)==(R|0)){if(oe=m+(G+12)|0,X=n[oe>>2]|0,!X&&(oe=m+(G+8)|0,X=n[oe>>2]|0,!X)){ee=0;break}for(;;){if(we=X+20|0,re=n[we>>2]|0,re){X=re,oe=we;continue}if(re=X+16|0,we=n[re>>2]|0,we)X=we,oe=re;else break}if(oe>>>0<(n[1210]|0)>>>0)Lt();else{n[oe>>2]=0,ee=X;break}}else if(oe=n[m+G>>2]|0,oe>>>0<(n[1210]|0)>>>0&&Lt(),re=oe+12|0,(n[re>>2]|0)!=(R|0)&&Lt(),we=X+8|0,(n[we>>2]|0)==(R|0)){n[re>>2]=X,n[we>>2]=oe,ee=X;break}else Lt();while(!1);if(z){if(X=n[m+(G+20)>>2]|0,oe=5128+(X<<2)|0,(R|0)==(n[oe>>2]|0)){if(n[oe>>2]=ee,!ee){n[1207]=n[1207]&~(1<<X);break}}else if(z>>>0<(n[1210]|0)>>>0&&Lt(),X=z+16|0,(n[X>>2]|0)==(R|0)?n[X>>2]=ee:n[z+20>>2]=ee,!ee)break;R=n[1210]|0,ee>>>0<R>>>0&&Lt(),n[ee+24>>2]=z,z=n[m+(G+8)>>2]|0;do if(z)if(z>>>0<R>>>0)Lt();else{n[ee+16>>2]=z,n[z+24>>2]=ee;break}while(!1);if(R=n[m+(G+12)>>2]|0,R)if(R>>>0<(n[1210]|0)>>>0)Lt();else{n[ee+20>>2]=R,n[R+24>>2]=ee;break}}}else{if(ee=n[m+G>>2]|0,G=n[m+(G|4)>>2]|0,m=4864+(X<<1<<2)|0,(ee|0)!=(m|0)&&(ee>>>0<(n[1210]|0)>>>0&&Lt(),(n[ee+12>>2]|0)!=(R|0)&&Lt()),(G|0)==(ee|0)){n[1206]=n[1206]&~(1<<X);break}(G|0)!=(m|0)?(G>>>0<(n[1210]|0)>>>0&&Lt(),m=G+8|0,(n[m>>2]|0)==(R|0)?z=m:Lt()):z=G+8|0,n[ee+12>>2]=G,n[z>>2]=ee}while(!1);if(n[C+4>>2]=ue|1,n[C+ue>>2]=ue,(C|0)==(n[1211]|0)){n[1208]=ue,S=T;return}}if(R=ue>>>3,ue>>>0<256){G=R<<1,x=4864+(G<<2)|0,ee=n[1206]|0,R=1<<R,ee&R?(G=4864+(G+2<<2)|0,R=n[G>>2]|0,R>>>0<(n[1210]|0)>>>0?Lt():(B=G,F=R)):(n[1206]=ee|R,B=4864+(G+2<<2)|0,F=x),n[B>>2]=C,n[F+12>>2]=C,n[C+8>>2]=F,n[C+12>>2]=x,S=T;return}B=ue>>>8,B?ue>>>0>16777215?B=31:(at=(B+1048320|0)>>>16&8,kt=B<<at,Qe=(kt+520192|0)>>>16&4,kt=kt<<Qe,B=(kt+245760|0)>>>16&2,B=14-(Qe|at|B)+(kt<<B>>>15)|0,B=ue>>>(B+7|0)&1|B<<1):B=0,F=5128+(B<<2)|0,n[C+28>>2]=B,n[C+20>>2]=0,n[C+16>>2]=0,G=n[1207]|0,R=1<<B;e:do if(G&R){F=n[F>>2]|0,(B|0)==31?B=0:B=25-(B>>>1)|0;t:do if((n[F+4>>2]&-8|0)!=(ue|0)){for(B=ue<<B;G=F+(B>>>31<<2)+16|0,R=n[G>>2]|0,!!R;)if((n[R+4>>2]&-8|0)==(ue|0)){x=R;break t}else B=B<<1,F=R;if(G>>>0<(n[1210]|0)>>>0)Lt();else{n[G>>2]=C,n[C+24>>2]=F,n[C+12>>2]=C,n[C+8>>2]=C;break e}}else x=F;while(!1);if(F=x+8|0,B=n[F>>2]|0,kt=n[1210]|0,x>>>0>=kt>>>0&B>>>0>=kt>>>0){n[B+12>>2]=C,n[F>>2]=C,n[C+8>>2]=B,n[C+12>>2]=x,n[C+24>>2]=0;break}else Lt()}else n[1207]=G|R,n[F>>2]=C,n[C+24>>2]=F,n[C+12>>2]=C,n[C+8>>2]=C;while(!1);if(kt=(n[1214]|0)+-1|0,n[1214]=kt,!kt)x=5280;else{S=T;return}for(;x=n[x>>2]|0,x;)x=x+8|0;n[1214]=-1,S=T}function vs(m,T){m=m|0,T=T|0;var x=0,C=0,B=0;x=S;do if(m){if(T>>>0>4294967231){n[(Ht()|0)>>2]=12,C=0;break}if(T>>>0<11?C=16:C=T+11&-8,C=ba(m+-8|0,C)|0,C){C=C+8|0;break}C=ya(T)|0,C?(B=n[m+-4>>2]|0,B=(B&-8)-(B&3|0?4:8)|0,ch(C|0,m|0,(B>>>0<T>>>0?B:T)|0)|0,yi(m)):C=0}else C=ya(T)|0;while(!1);return S=x,C|0}function oh(m){return m=m|0,(m|0)==32?m=1:m=(m+-9|0)>>>0<5,m&1|0}function Kh(m,T,x,C,B){m=m|0,T=T|0,x=x|0,C=C|0,B=B|0;var F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0,we=0,_e=0;if(F=S,T>>>0>36)return n[(Ht()|0)>>2]=22,we=0,_e=0,ht=we,S=F,_e|0;R=m+4|0,G=m+100|0;do ee=n[R>>2]|0,ee>>>0<(n[G>>2]|0)>>>0?(n[R>>2]=ee+1,X=l[ee>>0]|0):X=ss(m)|0;while(oh(X)|0);do if((X|0)==43|(X|0)==45)if(ee=((X|0)==45)<<31>>31,z=n[R>>2]|0,z>>>0<(n[G>>2]|0)>>>0){n[R>>2]=z+1,X=l[z>>0]|0;break}else{X=ss(m)|0;break}else ee=0;while(!1);z=(T|0)==0;do if((T&-17|0)==0&(X|0)==48){if(X=n[R>>2]|0,X>>>0<(n[G>>2]|0)>>>0?(n[R>>2]=X+1,X=l[X>>0]|0):X=ss(m)|0,(X|32|0)!=120)if(z){T=8,x=46;break}else{x=32;break}if(T=n[R>>2]|0,T>>>0<(n[G>>2]|0)>>>0?(n[R>>2]=T+1,X=l[T>>0]|0):X=ss(m)|0,(l[X+5321>>0]|0)>15)return C=(n[G>>2]|0)==0,C||(n[R>>2]=(n[R>>2]|0)+-1),x?C?(we=0,_e=0,ht=we,S=F,_e|0):(n[R>>2]=(n[R>>2]|0)+-1,we=0,_e=0,ht=we,S=F,_e|0):(Un(m,0),we=0,_e=0,ht=we,S=F,_e|0);T=16,x=46}else if(T=z?10:T,(l[X+5321>>0]|0)>>>0<T>>>0)x=32;else return n[G>>2]|0&&(n[R>>2]=(n[R>>2]|0)+-1),Un(m,0),n[(Ht()|0)>>2]=22,we=0,_e=0,ht=we,S=F,_e|0;while(!1);if((x|0)==32)if((T|0)==10){if(T=X+-48|0,T>>>0<10){z=0;do z=(z*10|0)+T|0,T=n[R>>2]|0,T>>>0<(n[G>>2]|0)>>>0?(n[R>>2]=T+1,X=l[T>>0]|0):X=ss(m)|0,T=X+-48|0;while(T>>>0<10&z>>>0<429496729);oe=0}else z=0,oe=0;if(T=X+-48|0,T>>>0<10){do{if(ue=er(z|0,oe|0,10,0)|0,re=ht,we=((T|0)<0)<<31>>31,_e=~we,re>>>0>_e>>>0|(re|0)==(_e|0)&ue>>>0>~T>>>0)break;z=ts(ue|0,re|0,T|0,we|0)|0,oe=ht,T=n[R>>2]|0,T>>>0<(n[G>>2]|0)>>>0?(n[R>>2]=T+1,X=l[T>>0]|0):X=ss(m)|0,T=X+-48|0}while(T>>>0<10&(oe>>>0<429496729|(oe|0)==429496729&z>>>0<2576980378));T>>>0<=9&&(T=10,x=72)}}else x=46;e:do if((x|0)==46){if(!(T+-1&T)){if(x=r[5584+((T*23|0)>>>5&7)>>0]|0,re=r[X+5321>>0]|0,z=re&255,z>>>0<T>>>0){X=z,z=0;do z=X|z<<x,X=n[R>>2]|0,X>>>0<(n[G>>2]|0)>>>0?(n[R>>2]=X+1,we=l[X>>0]|0):we=ss(m)|0,re=r[we+5321>>0]|0,X=re&255;while(X>>>0<T>>>0&z>>>0<134217728);oe=0}else oe=0,z=0,we=X;if(X=uh(-1,-1,x|0)|0,ue=ht,(re&255)>>>0>=T>>>0|(oe>>>0>ue>>>0|(oe|0)==(ue|0)&z>>>0>X>>>0)){X=we,x=72;break}for(;;)if(z=jr(z|0,oe|0,x|0)|0,oe=ht,z=re&255|z,re=n[R>>2]|0,re>>>0<(n[G>>2]|0)>>>0?(n[R>>2]=re+1,we=l[re>>0]|0):we=ss(m)|0,re=r[we+5321>>0]|0,(re&255)>>>0>=T>>>0|(oe>>>0>ue>>>0|(oe|0)==(ue|0)&z>>>0>X>>>0)){X=we,x=72;break e}}if(re=r[X+5321>>0]|0,x=re&255,x>>>0<T>>>0){z=0;do z=x+(Ve(z,T)|0)|0,x=n[R>>2]|0,x>>>0<(n[G>>2]|0)>>>0?(n[R>>2]=x+1,ue=l[x>>0]|0):ue=ss(m)|0,re=r[ue+5321>>0]|0,x=re&255;while(x>>>0<T>>>0&z>>>0<119304647);oe=0}else z=0,oe=0,ue=X;if((re&255)>>>0<T>>>0)for(x=bl(-1,-1,T|0,0)|0,X=ht;;){if(oe>>>0>X>>>0|(oe|0)==(X|0)&z>>>0>x>>>0){X=ue,x=72;break e}if(we=er(z|0,oe|0,T|0,0)|0,_e=ht,re=re&255,_e>>>0>4294967295|(_e|0)==-1&we>>>0>~re>>>0){X=ue,x=72;break e}if(z=ts(re|0,0,we|0,_e|0)|0,oe=ht,ue=n[R>>2]|0,ue>>>0<(n[G>>2]|0)>>>0?(n[R>>2]=ue+1,ue=l[ue>>0]|0):ue=ss(m)|0,re=r[ue+5321>>0]|0,(re&255)>>>0>=T>>>0){X=ue,x=72;break}}else X=ue,x=72}while(!1);if((x|0)==72&&(l[X+5321>>0]|0)>>>0<T>>>0){do x=n[R>>2]|0,x>>>0<(n[G>>2]|0)>>>0?(n[R>>2]=x+1,x=l[x>>0]|0):x=ss(m)|0;while((l[x+5321>>0]|0)>>>0<T>>>0);n[(Ht()|0)>>2]=34,oe=B,z=C}if(n[G>>2]|0&&(n[R>>2]=(n[R>>2]|0)+-1),!(oe>>>0<B>>>0|(oe|0)==(B|0)&z>>>0<C>>>0)){if(!((C&1|0)!=0|!1|(ee|0)!=0))return n[(Ht()|0)>>2]=34,_e=ts(C|0,B|0,-1,-1)|0,we=ht,ht=we,S=F,_e|0;if(oe>>>0>B>>>0|(oe|0)==(B|0)&z>>>0>C>>>0)return n[(Ht()|0)>>2]=34,we=B,_e=C,ht=we,S=F,_e|0}return _e=((ee|0)<0)<<31>>31,_e=bn(z^ee|0,oe^_e|0,ee|0,_e|0)|0,we=ht,ht=we,S=F,_e|0}function Xh(m,T,x){m=m|0,T=T|0,x=x|0;var C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0,we=0,_e=0,Be=0,Xe=0,Qe=0,at=0,kt=0,hi=0,ri=0,dt=0,Yt=0,ii=0,qt=0,ei=0,Rt=0,$t=0,Ft=0;if(C=S,S=S+512|0,R=C,!T)T=24,F=-149;else if((T|0)==2)T=53,F=-1074;else if((T|0)==1)T=53,F=-1074;else return Rt=0,S=C,+Rt;z=m+4|0,X=m+100|0;do B=n[z>>2]|0,B>>>0<(n[X>>2]|0)>>>0?(n[z>>2]=B+1,Be=l[B>>0]|0):Be=ss(m)|0;while(oh(Be)|0);do if((Be|0)==43|(Be|0)==45)if(B=1-(((Be|0)==45&1)<<1)|0,ee=n[z>>2]|0,ee>>>0<(n[X>>2]|0)>>>0){n[z>>2]=ee+1,Be=l[ee>>0]|0;break}else{Be=ss(m)|0;break}else B=1;while(!1);re=0;do{if((Be|32|0)!=(r[5600+re>>0]|0))break;do if(re>>>0<7)if(ee=n[z>>2]|0,ee>>>0<(n[X>>2]|0)>>>0){n[z>>2]=ee+1,Be=l[ee>>0]|0;break}else{Be=ss(m)|0;break}while(!1);re=re+1|0}while(re>>>0<8);do if((re|0)==3)oe=23;else if((re|0)!=8){if(ee=(x|0)!=0,re>>>0>3&ee){if((re|0)==8)break;oe=23;break}e:do if(!re){re=0;do{if((Be|32|0)!=(r[5616+re>>0]|0))break e;do if(re>>>0<2)if(we=n[z>>2]|0,we>>>0<(n[X>>2]|0)>>>0){n[z>>2]=we+1,Be=l[we>>0]|0;break}else{Be=ss(m)|0;break}while(!1);re=re+1|0}while(re>>>0<3)}while(!1);if(re)if((re|0)==3){if(T=n[z>>2]|0,T>>>0<(n[X>>2]|0)>>>0?(n[z>>2]=T+1,T=l[T>>0]|0):T=ss(m)|0,(T|0)==40)T=1;else return n[X>>2]|0?(n[z>>2]=(n[z>>2]|0)+-1,Ft=Ee,S=C,+Ft):(Ft=Ee,S=C,+Ft);for(;B=n[z>>2]|0,B>>>0<(n[X>>2]|0)>>>0?(n[z>>2]=B+1,B=l[B>>0]|0):B=ss(m)|0,!(!((B+-48|0)>>>0<10|(B+-65|0)>>>0<26)&&!((B+-97|0)>>>0<26|(B|0)==95));)T=T+1|0;if((B|0)==41)return Ft=Ee,S=C,+Ft;if(B=(n[X>>2]|0)==0,B||(n[z>>2]=(n[z>>2]|0)+-1),!ee)return n[(Ht()|0)>>2]=22,Un(m,0),Ft=0,S=C,+Ft;if((T|0)==0|B)return Ft=Ee,S=C,+Ft;do T=T+-1|0,n[z>>2]=(n[z>>2]|0)+-1;while(T|0);return ue=Ee,S=C,+ue}else return n[X>>2]|0&&(n[z>>2]=(n[z>>2]|0)+-1),n[(Ht()|0)>>2]=22,Un(m,0),Ft=0,S=C,+Ft;else{do if((Be|0)==48){if(ee=n[z>>2]|0,ee>>>0<(n[X>>2]|0)>>>0?(n[z>>2]=ee+1,ee=l[ee>>0]|0):ee=ss(m)|0,(ee|32|0)!=120){if(!(n[X>>2]|0)){Be=48;break}n[z>>2]=(n[z>>2]|0)+-1,Be=48;break}for(R=n[z>>2]|0,R>>>0<(n[X>>2]|0)>>>0?(n[z>>2]=R+1,at=l[R>>0]|0,Xe=0):(at=ss(m)|0,Xe=0);;){if((at|0)==46){oe=70;break}else if((at|0)!=48){R=0,ee=0,we=0,re=0,Be=0,Qe=0,ii=1,_e=0,ue=0;break}if(R=n[z>>2]|0,R>>>0<(n[X>>2]|0)>>>0){n[z>>2]=R+1,at=l[R>>0]|0,Xe=1;continue}else{at=ss(m)|0,Xe=1;continue}}if((oe|0)==70)if(R=n[z>>2]|0,R>>>0<(n[X>>2]|0)>>>0?(n[z>>2]=R+1,at=l[R>>0]|0):at=ss(m)|0,(at|0)==48){we=0,re=0;do R=n[z>>2]|0,R>>>0<(n[X>>2]|0)>>>0?(n[z>>2]=R+1,at=l[R>>0]|0):at=ss(m)|0,we=ts(we|0,re|0,-1,-1)|0,re=ht;while((at|0)==48);R=0,ee=0,Xe=1,Be=1,Qe=0,ii=1,_e=0,ue=0}else R=0,ee=0,we=0,re=0,Be=1,Qe=0,ii=1,_e=0,ue=0;e:for(;;){hi=at+-48|0;do if(hi>>>0>=10){if(kt=at|32,ri=(at|0)==46,!((kt+-97|0)>>>0<6|ri))break e;if(ri)if(Be){at=46;break e}else{we=ee,re=R,Be=1;break}else{hi=(at|0)>57?kt+-87|0:hi,oe=83;break}}else oe=83;while(!1);if((oe|0)==83){oe=0;do if((R|0)<0|(R|0)==0&ee>>>0<8)ei=ii,_e=hi+(_e<<4)|0;else{if((R|0)<0|(R|0)==0&ee>>>0<14){Rt=ii*.0625,ei=Rt,ue=ue+Rt*+(hi|0);break}(hi|0)==0|(Qe|0)!=0?ei=ii:(Qe=1,ei=ii,ue=ue+ii*.5)}while(!1);ee=ts(ee|0,R|0,1,0)|0,R=ht,Xe=1,ii=ei}if(at=n[z>>2]|0,at>>>0<(n[X>>2]|0)>>>0){n[z>>2]=at+1,at=l[at>>0]|0;continue}else{at=ss(m)|0;continue}}if(!Xe)return T=(n[X>>2]|0)==0,T||(n[z>>2]=(n[z>>2]|0)+-1),x?!T&&(G=n[z>>2]|0,n[z>>2]=G+-1,(Be|0)!=0)&&(n[z>>2]=G+-2):Un(m,0),Rt=+(B|0)*0,S=C,+Rt;if(oe=(Be|0)==0,G=oe?ee:we,oe=oe?R:re,(R|0)<0|(R|0)==0&ee>>>0<8)do _e=_e<<4,ee=ts(ee|0,R|0,1,0)|0,R=ht;while((R|0)<0|(R|0)==0&ee>>>0<8);do if((at|32|0)==112){if(ee=va(m,x)|0,R=ht,(ee|0)==0&(R|0)==-2147483648)if(x){if(!(n[X>>2]|0)){ee=0,R=0;break}n[z>>2]=(n[z>>2]|0)+-1,ee=0,R=0;break}else return Un(m,0),Rt=0,S=C,+Rt}else n[X>>2]|0?(n[z>>2]=(n[z>>2]|0)+-1,ee=0,R=0):(ee=0,R=0);while(!1);if(G=jr(G|0,oe|0,2)|0,G=ts(G|0,ht|0,-32,-1)|0,R=ts(G|0,ht|0,ee|0,R|0)|0,G=ht,!_e)return Rt=+(B|0)*0,S=C,+Rt;if((G|0)>0|(G|0)==0&R>>>0>(0-F|0)>>>0)return n[(Ht()|0)>>2]=34,Rt=+(B|0)*17976931348623157e292*17976931348623157e292,S=C,+Rt;if(qt=F+-106|0,Yt=((qt|0)<0)<<31>>31,(G|0)<(Yt|0)|(G|0)==(Yt|0)&R>>>0<qt>>>0)return n[(Ht()|0)>>2]=34,Rt=+(B|0)*22250738585072014e-324*22250738585072014e-324,S=C,+Rt;if((_e|0)>-1)do _e=_e<<1,ue>=.5?(ii=ue+-1,_e=_e|1):ii=ue,ue=ue+ii,R=ts(R|0,G|0,-1,-1)|0,G=ht;while((_e|0)>-1);return F=bn(32,0,F|0,((F|0)<0)<<31>>31|0)|0,F=ts(R|0,G|0,F|0,ht|0)|0,qt=ht,0>(qt|0)|(qt|0)==0&T>>>0>F>>>0?(F|0)<0?(T=0,oe=126):(T=F,oe=124):oe=124,(oe|0)==124&&((T|0)<53?oe=126:(F=T,ii=+(B|0),ei=0)),(oe|0)==126&&(ei=+(B|0),F=T,ii=ei,ei=+ds(+ +bo(1,84-T|0),+ei)),qt=(F|0)<32&ue!=0&(_e&1|0)==0,ue=ii*(qt?0:ue)+(ei+ii*+(((qt&1)+_e|0)>>>0))-ei,ue==0&&(n[(Ht()|0)>>2]=34),Rt=+yl(ue,R),S=C,+Rt}while(!1);for(ee=F+T|0,G=0-ee|0,hi=0;;){if((Be|0)==46){oe=137;break}else if((Be|0)!=48){dt=0,ri=0,kt=0;break}if(re=n[z>>2]|0,re>>>0<(n[X>>2]|0)>>>0){n[z>>2]=re+1,Be=l[re>>0]|0,hi=1;continue}else{Be=ss(m)|0,hi=1;continue}}if((oe|0)==137)if(oe=n[z>>2]|0,oe>>>0<(n[X>>2]|0)>>>0?(n[z>>2]=oe+1,Be=l[oe>>0]|0):Be=ss(m)|0,(Be|0)==48){dt=0,ri=0;do dt=ts(dt|0,ri|0,-1,-1)|0,ri=ht,oe=n[z>>2]|0,oe>>>0<(n[X>>2]|0)>>>0?(n[z>>2]=oe+1,Be=l[oe>>0]|0):Be=ss(m)|0;while((Be|0)==48);hi=1,kt=1}else dt=0,ri=0,kt=1;n[R>>2]=0,at=Be+-48|0,Yt=(Be|0)==46;e:do if(at>>>0<10|Yt){oe=R+496|0,Qe=0,Xe=0,_e=0,we=0,re=0;t:for(;;){do if(Yt)if(!kt)dt=Qe,ri=Xe,kt=1;else break t;else{if(Yt=ts(Qe|0,Xe|0,1,0)|0,Xe=ht,qt=(Be|0)!=48,(we|0)>=125){if(!qt){Qe=Yt;break}n[oe>>2]=n[oe>>2]|1,Qe=Yt;break}Qe=R+(we<<2)|0,_e&&(at=Be+-48+((n[Qe>>2]|0)*10|0)|0),n[Qe>>2]=at,_e=_e+1|0,at=(_e|0)==9,Qe=Yt,hi=1,_e=at?0:_e,we=(at&1)+we|0,re=qt?Yt:re}while(!1);if(Be=n[z>>2]|0,Be>>>0<(n[X>>2]|0)>>>0?(n[z>>2]=Be+1,Be=l[Be>>0]|0):Be=ss(m)|0,at=Be+-48|0,Yt=(Be|0)==46,!(at>>>0<10|Yt)){oe=160;break e}}at=(hi|0)!=0,oe=168}else Qe=0,Xe=0,_e=0,we=0,re=0,oe=160;while(!1);do if((oe|0)==160){if(at=(kt|0)==0,dt=at?Qe:dt,ri=at?Xe:ri,at=(hi|0)!=0,!(at&(Be|32|0)==101))if((Be|0)>-1){oe=168;break}else{oe=170;break}at=va(m,x)|0,Be=ht;do if((at|0)==0&(Be|0)==-2147483648)if(x){if(!(n[X>>2]|0)){at=0,Be=0;break}n[z>>2]=(n[z>>2]|0)+-1,at=0,Be=0;break}else return Un(m,0),Rt=0,S=C,+Rt;while(!1);m=ts(at|0,Be|0,dt|0,ri|0)|0,ri=ht}while(!1);if((oe|0)==168&&(n[X>>2]|0?(n[z>>2]=(n[z>>2]|0)+-1,at?m=dt:oe=171):oe=170),(oe|0)==170&&(at?m=dt:oe=171),(oe|0)==171)return n[(Ht()|0)>>2]=22,Un(m,0),Rt=0,S=C,+Rt;if(z=n[R>>2]|0,!z)return Rt=+(B|0)*0,S=C,+Rt;if((m|0)==(Qe|0)&(ri|0)==(Xe|0)&((Xe|0)<0|(Xe|0)==0&Qe>>>0<10)&&T>>>0>30|(z>>>T|0)==0)return Rt=+(B|0)*+(z>>>0),S=C,+Rt;if(qt=(F|0)/-2|0,Yt=((qt|0)<0)<<31>>31,(ri|0)>(Yt|0)|(ri|0)==(Yt|0)&m>>>0>qt>>>0)return n[(Ht()|0)>>2]=34,Rt=+(B|0)*17976931348623157e292*17976931348623157e292,S=C,+Rt;if(qt=F+-106|0,Yt=((qt|0)<0)<<31>>31,(ri|0)<(Yt|0)|(ri|0)==(Yt|0)&m>>>0<qt>>>0)return n[(Ht()|0)>>2]=34,Rt=+(B|0)*22250738585072014e-324*22250738585072014e-324,S=C,+Rt;if(_e){if((_e|0)<9){z=R+(we<<2)|0,X=n[z>>2]|0;do X=X*10|0,_e=_e+1|0;while((_e|0)!=9);n[z>>2]=X}we=we+1|0}if((re|0)<9&&(re|0)<=(m|0)&(m|0)<18){if((m|0)==9)return Rt=+(B|0)*+((n[R>>2]|0)>>>0),S=C,+Rt;if((m|0)<9)return Rt=+(B|0)*+((n[R>>2]|0)>>>0)/+(n[5632+(8-m<<2)>>2]|0),S=C,+Rt;if(qt=T+27+(Ve(m,-3)|0)|0,z=n[R>>2]|0,(qt|0)>30|(z>>>qt|0)==0)return Rt=+(B|0)*+(z>>>0)*+(n[5632+(m+-10<<2)>>2]|0),S=C,+Rt}if(z=(m|0)%9|0,!z)z=0,X=0;else{if(x=(m|0)>-1?z:z+9|0,oe=n[5632+(8-x<<2)>>2]|0,we){re=1e9/(oe|0)|0,z=0,X=0,_e=0;do dt=R+(_e<<2)|0,Yt=n[dt>>2]|0,qt=((Yt>>>0)/(oe>>>0)|0)+X|0,n[dt>>2]=qt,X=Ve((Yt>>>0)%(oe>>>0)|0,re)|0,Yt=_e,_e=_e+1|0,(Yt|0)==(z|0)&(qt|0)==0&&(z=_e&127,m=m+-9|0);while((_e|0)!=(we|0));X&&(n[R+(we<<2)>>2]=X,we=we+1|0)}else z=0,we=0;X=0,m=9-x+m|0}e:for(;;){if(x=R+(z<<2)|0,(m|0)<18)do{for(re=0,x=we+127|0;x=x&127,oe=R+(x<<2)|0,_e=jr(n[oe>>2]|0,0,29)|0,_e=ts(_e|0,ht|0,re|0,0)|0,re=ht,re>>>0>0|(re|0)==0&_e>>>0>1e9?(qt=bl(_e|0,re|0,1e9,0)|0,_e=Za(_e|0,re|0,1e9,0)|0,re=qt):re=0,n[oe>>2]=_e,oe=(x|0)==(z|0),(x|0)!=(we+127&127|0)|oe||(we=_e|0?we:x),!oe;)x=x+-1|0;X=X+-29|0}while(!(re|0));else{if((m|0)!=18)break;do{if((n[x>>2]|0)>>>0>=9007199){m=18;break e}for(re=0,oe=we+127|0;oe=oe&127,_e=R+(oe<<2)|0,Be=jr(n[_e>>2]|0,0,29)|0,Be=ts(Be|0,ht|0,re|0,0)|0,re=ht,re>>>0>0|(re|0)==0&Be>>>0>1e9?(qt=bl(Be|0,re|0,1e9,0)|0,Be=Za(Be|0,re|0,1e9,0)|0,re=qt):re=0,n[_e>>2]=Be,_e=(oe|0)==(z|0),(oe|0)!=(we+127&127|0)|_e||(we=Be|0?we:oe),!_e;)oe=oe+-1|0;X=X+-29|0}while(!(re|0))}z=z+127&127,(z|0)==(we|0)&&(qt=we+127&127,we=R+((we+126&127)<<2)|0,n[we>>2]=n[we>>2]|n[R+(qt<<2)>>2],we=qt),n[R+(z<<2)>>2]=re,m=m+9|0}e:for(;;){for(x=we+1&127,oe=R+((we+127&127)<<2)|0;;){for(_e=(m|0)==18,re=(m|0)>27?9:1;;){for(Be=0;;){if(Xe=Be+z&127,(Xe|0)==(we|0)){Be=2;break}if(Qe=n[R+(Xe<<2)>>2]|0,at=n[5624+(Be<<2)>>2]|0,Qe>>>0<at>>>0){Be=2;break}if(Xe=Be+1|0,Qe>>>0>at>>>0)break;if((Xe|0)<2)Be=Xe;else{Be=Xe;break}}if((Be|0)==2&_e)break e;if(X=re+X|0,(z|0)==(we|0))z=we;else break}_e=(1<<re)+-1|0,Be=1e9>>>re,Xe=z,Qe=0;do dt=R+(z<<2)|0,Yt=n[dt>>2]|0,qt=(Yt>>>re)+Qe|0,n[dt>>2]=qt,Qe=Ve(Yt&_e,Be)|0,qt=(z|0)==(Xe|0)&(qt|0)==0,z=z+1&127,m=qt?m+-9|0:m,Xe=qt?z:Xe;while((z|0)!=(we|0));if(!Qe){z=Xe;continue}if((x|0)!=(Xe|0))break;n[oe>>2]=n[oe>>2]|1,z=Xe}n[R+(we<<2)>>2]=Qe,z=Xe,we=x}m=z&127,(m|0)==(we|0)&&(n[R+(x+-1<<2)>>2]=0,we=x),ii=+((n[R+(m<<2)>>2]|0)>>>0),m=z+1&127,(m|0)==(we|0)&&(we=we+1&127,n[R+(we+-1<<2)>>2]=0),ue=+(B|0),ei=ue*(ii*1e9+ +((n[R+(m<<2)>>2]|0)>>>0)),B=X+53|0,F=B-F|0,(F|0)<(T|0)?(F|0)<0?(T=0,m=1,oe=244):(T=F,m=1,oe=243):(m=0,oe=243),(oe|0)==243&&((T|0)<53?oe=244:(ii=0,Rt=0)),(oe|0)==244&&(Ft=+ds(+ +bo(1,105-T|0),+ei),$t=+rs(+ei,+ +bo(1,53-T|0)),ii=Ft,Rt=$t,ei=Ft+(ei-$t)),x=z+2&127;do if((x|0)!=(we|0)){R=n[R+(x<<2)>>2]|0;do if(R>>>0>=5e8){if(R>>>0>5e8){Rt=ue*.75+Rt;break}if((z+3&127|0)==(we|0)){Rt=ue*.5+Rt;break}else{Rt=ue*.75+Rt;break}}else{if(!(R|0)&&(z+3&127|0)==(we|0))break;Rt=ue*.25+Rt}while(!1);if((53-T|0)<=1||+rs(+Rt,1)!=0)break;Rt=Rt+1}while(!1);ue=ei+Rt-ii;do if((B&2147483647|0)>(-2-ee|0)){if(+Vi(+ue)>=9007199254740992&&(m=(m|0)!=0&(T|0)==(F|0)?0:m,X=X+1|0,ue=ue*.5),(X+50|0)<=(G|0)&&!((m|0)!=0&Rt!=0))break;n[(Ht()|0)>>2]=34}while(!1);return Ft=+yl(ue,X),S=C,+Ft}}while(!1);if((oe|0)==23&&(T=(n[X>>2]|0)==0,T||(n[z>>2]=(n[z>>2]|0)+-1),!(re>>>0<4|(x|0)==0|T)))do n[z>>2]=(n[z>>2]|0)+-1,re=re+-1|0;while(re>>>0>3);return Ft=+(B|0)*Le,S=C,+Ft}function Un(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0;if(x=S,n[m+104>>2]=T,B=n[m+8>>2]|0,C=n[m+4>>2]|0,F=B-C|0,n[m+108>>2]=F,(T|0)!=0&(F|0)>(T|0)){n[m+100>>2]=C+T,S=x;return}else{n[m+100>>2]=B,S=x;return}}function ss(m){m=m|0;var T=0,x=0,C=0,B=0,F=0,R=0,G=0;return x=S,F=m+104|0,G=n[F>>2]|0,G|0&&(n[m+108>>2]|0)>=(G|0)||(R=3),(R|0)==3&&(T=ah(m)|0,(T|0)>=0)?(R=n[F>>2]|0,F=n[m+8>>2]|0,R|0&&(C=n[m+4>>2]|0,B=R-(n[m+108>>2]|0)+-1|0,(F-C|0)>(B|0))?n[m+100>>2]=C+B:n[m+100>>2]=F,C=n[m+4>>2]|0,F&&(G=m+108|0,n[G>>2]=F+1-C+(n[G>>2]|0)),m=C+-1|0,(l[m>>0]|0|0)==(T|0)?(G=T,S=x,G|0):(r[m>>0]=T,G=T,S=x,G|0)):(n[m+100>>2]=0,G=-1,S=x,G|0)}function bo(m,T){m=+m,T=T|0;var x=0,C=0;return x=S,(T|0)>1023?(m=m*898846567431158e293,C=T+-1023|0,(C|0)>1023?(T=T+-2046|0,T=(T|0)>1023?1023:T,m=m*898846567431158e293):T=C):(T|0)<-1022&&(m=m*22250738585072014e-324,C=T+1022|0,(C|0)<-1022?(T=T+2044|0,T=(T|0)<-1022?-1022:T,m=m*22250738585072014e-324):T=C),T=jr(T+1023|0,0,52)|0,C=ht,n[I>>2]=T,n[I+4>>2]=C,m=m*+A[I>>3],S=x,+m}function yl(m,T){m=+m,T=T|0;var x=0;return x=S,m=+bo(m,T),S=x,+m}function Ka(m){m=m|0;var T=0,x=0,C=0;return x=S,C=m+74|0,T=r[C>>0]|0,r[C>>0]=T+255|T,C=m+20|0,T=m+44|0,(n[C>>2]|0)>>>0>(n[T>>2]|0)>>>0&&La[n[m+36>>2]&1](m,0,0)|0,n[m+16>>2]=0,n[m+28>>2]=0,n[C>>2]=0,C=n[m>>2]|0,C&20?C&4?(n[m>>2]=C|32,C=-1,S=x,C|0):(C=-1,S=x,C|0):(C=n[T>>2]|0,n[m+8>>2]=C,n[m+4>>2]=C,C=0,S=x,C|0)}function ah(m){m=m|0;var T=0,x=0;return T=S,S=S+16|0,x=T,!(n[m+8>>2]|0)&&Ka(m)|0?m=-1:(La[n[m+32>>2]&1](m,x,1)|0)==1?m=l[x>>0]|0:m=-1,S=T,m|0}function lh(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0;x=S,S=S+112|0,C=x,R=C+0|0,F=R+112|0;do n[R>>2]=0,R=R+4|0;while((R|0)<(F|0));return F=C+4|0,n[F>>2]=m,R=C+8|0,n[R>>2]=-1,n[C+44>>2]=m,n[C+76>>2]=-1,Un(C,0),B=+Xh(C,1,1),C=(n[F>>2]|0)-(n[R>>2]|0)+(n[C+108>>2]|0)|0,T?(C&&(m=m+C|0),n[T>>2]=m,S=x,+B):(S=x,+B)}function Xa(m,T,x){m=m|0,T=T|0,x=x|0;var C=0,B=0,F=0;return C=S,S=S+112|0,F=C,n[F>>2]=0,B=F+4|0,n[B>>2]=m,n[F+44>>2]=m,(m|0)<0?n[F+8>>2]=-1:n[F+8>>2]=m+2147483647,n[F+76>>2]=-1,Un(F,0),x=Kh(F,x,1,-2147483648,0)|0,T?(n[T>>2]=m+((n[B>>2]|0)+(n[F+108>>2]|0)-(n[F+8>>2]|0)),S=C,x|0):(S=C,x|0)}function hh(m,T){m=m|0,T=T|0;var x=0,C=0,B=0;if(x=S,B=r[m>>0]|0,C=r[T>>0]|0,!(B<<24>>24)||B<<24>>24!=C<<24>>24)T=B;else{do m=m+1|0,T=T+1|0,B=r[m>>0]|0,C=r[T>>0]|0;while(!(!(B<<24>>24)||B<<24>>24!=C<<24>>24));T=B}return S=x,(T&255)-(C&255)|0}function ba(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0,we=0,_e=0;if(x=S,B=m+4|0,C=n[B>>2]|0,z=C&-8,G=m+z|0,X=n[1210]|0,R=C&3,(R|0)!=1&m>>>0>=X>>>0&m>>>0<G>>>0||Lt(),F=m+(z|4)|0,re=n[F>>2]|0,re&1||Lt(),!R)return T>>>0<256?(_e=0,S=x,_e|0):z>>>0>=(T+4|0)>>>0&&(z-T|0)>>>0<=n[1326]<<1>>>0?(_e=m,S=x,_e|0):(_e=0,S=x,_e|0);if(z>>>0>=T>>>0)return R=z-T|0,R>>>0<=15?(_e=m,S=x,_e|0):(n[B>>2]=C&1|T|2,n[m+(T+4)>>2]=R|3,n[F>>2]=n[F>>2]|1,so(m+T|0,R),_e=m,S=x,_e|0);if((G|0)==(n[1212]|0))return F=(n[1209]|0)+z|0,F>>>0<=T>>>0?(_e=0,S=x,_e|0):(_e=F-T|0,n[B>>2]=C&1|T|2,n[m+(T+4)>>2]=_e|1,n[1212]=m+T,n[1209]=_e,_e=m,S=x,_e|0);if((G|0)==(n[1211]|0))return R=(n[1208]|0)+z|0,R>>>0<T>>>0?(_e=0,S=x,_e|0):(F=R-T|0,F>>>0>15?(n[B>>2]=C&1|T|2,n[m+(T+4)>>2]=F|1,n[m+R>>2]=F,C=m+(R+4)|0,n[C>>2]=n[C>>2]&-2,C=m+T|0):(n[B>>2]=C&1|R|2,C=m+(R+4)|0,n[C>>2]=n[C>>2]|1,C=0,F=0),n[1208]=F,n[1211]=C,_e=m,S=x,_e|0);if(re&2||(F=(re&-8)+z|0,F>>>0<T>>>0))return _e=0,S=x,_e|0;R=F-T|0,ue=re>>>3;do if(re>>>0>=256){oe=n[m+(z+24)>>2]|0,ue=n[m+(z+12)>>2]|0;do if((ue|0)==(G|0)){if(re=m+(z+20)|0,ue=n[re>>2]|0,!ue&&(re=m+(z+16)|0,ue=n[re>>2]|0,!ue)){ee=0;break}for(;;){if(_e=ue+20|0,we=n[_e>>2]|0,we){ue=we,re=_e;continue}if(we=ue+16|0,_e=n[we>>2]|0,_e)ue=_e,re=we;else break}if(re>>>0<X>>>0)Lt();else{n[re>>2]=0,ee=ue;break}}else if(re=n[m+(z+8)>>2]|0,re>>>0<X>>>0&&Lt(),X=re+12|0,(n[X>>2]|0)!=(G|0)&&Lt(),we=ue+8|0,(n[we>>2]|0)==(G|0)){n[X>>2]=ue,n[we>>2]=re,ee=ue;break}else Lt();while(!1);if(oe){if(X=n[m+(z+28)>>2]|0,ue=5128+(X<<2)|0,(G|0)==(n[ue>>2]|0)){if(n[ue>>2]=ee,!ee){n[1207]=n[1207]&~(1<<X);break}}else if(oe>>>0<(n[1210]|0)>>>0&&Lt(),X=oe+16|0,(n[X>>2]|0)==(G|0)?n[X>>2]=ee:n[oe+20>>2]=ee,!ee)break;G=n[1210]|0,ee>>>0<G>>>0&&Lt(),n[ee+24>>2]=oe,X=n[m+(z+16)>>2]|0;do if(X)if(X>>>0<G>>>0)Lt();else{n[ee+16>>2]=X,n[X+24>>2]=ee;break}while(!1);if(G=n[m+(z+20)>>2]|0,G)if(G>>>0<(n[1210]|0)>>>0)Lt();else{n[ee+20>>2]=G,n[G+24>>2]=ee;break}}}else{if(ee=n[m+(z+8)>>2]|0,z=n[m+(z+12)>>2]|0,re=4864+(ue<<1<<2)|0,(ee|0)!=(re|0)&&(ee>>>0<X>>>0&&Lt(),(n[ee+12>>2]|0)!=(G|0)&&Lt()),(z|0)==(ee|0)){n[1206]=n[1206]&~(1<<ue);break}(z|0)!=(re|0)?(z>>>0<X>>>0&&Lt(),X=z+8|0,(n[X>>2]|0)==(G|0)?oe=X:Lt()):oe=z+8|0,n[ee+12>>2]=z,n[oe>>2]=ee}while(!1);return R>>>0<16?(n[B>>2]=F|C&1|2,_e=m+(F|4)|0,n[_e>>2]=n[_e>>2]|1,_e=m,S=x,_e|0):(n[B>>2]=C&1|T|2,n[m+(T+4)>>2]=R|3,_e=m+(F|4)|0,n[_e>>2]=n[_e>>2]|1,so(m+T|0,R),_e=m,S=x,_e|0)}function so(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0,we=0,_e=0,Be=0,Xe=0,Qe=0,at=0;x=S,R=m+T|0,z=n[m+4>>2]|0;do if(z&1)C=m,oe=T;else{if(re=n[m>>2]|0,!(z&3)){S=x;return}if(z=m+(0-re)|0,X=re+T|0,_e=n[1210]|0,z>>>0<_e>>>0&&Lt(),(z|0)==(n[1211]|0)){if(C=m+(T+4)|0,oe=n[C>>2]|0,(oe&3|0)!=3){C=z,oe=X;break}n[1208]=X,n[C>>2]=oe&-2,n[m+(4-re)>>2]=X|1,n[R>>2]=X,S=x;return}if(Be=re>>>3,re>>>0<256){if(C=n[m+(8-re)>>2]|0,oe=n[m+(12-re)>>2]|0,ue=4864+(Be<<1<<2)|0,(C|0)!=(ue|0)&&(C>>>0<_e>>>0&&Lt(),(n[C+12>>2]|0)!=(z|0)&&Lt()),(oe|0)==(C|0)){n[1206]=n[1206]&~(1<<Be),C=z,oe=X;break}(oe|0)!=(ue|0)?(oe>>>0<_e>>>0&&Lt(),ue=oe+8|0,(n[ue>>2]|0)==(z|0)?we=ue:Lt()):we=oe+8|0,n[C+12>>2]=oe,n[we>>2]=C,C=z,oe=X;break}we=n[m+(24-re)>>2]|0,Be=n[m+(12-re)>>2]|0;do if((Be|0)==(z|0)){if(Qe=16-re|0,Xe=m+(Qe+4)|0,Be=n[Xe>>2]|0,!Be&&(Xe=m+Qe|0,Be=n[Xe>>2]|0,!Be)){ue=0;break}for(;;){if(at=Be+20|0,Qe=n[at>>2]|0,Qe){Be=Qe,Xe=at;continue}if(Qe=Be+16|0,at=n[Qe>>2]|0,at)Be=at,Xe=Qe;else break}if(Xe>>>0<_e>>>0)Lt();else{n[Xe>>2]=0,ue=Be;break}}else if(Xe=n[m+(8-re)>>2]|0,Xe>>>0<_e>>>0&&Lt(),_e=Xe+12|0,(n[_e>>2]|0)!=(z|0)&&Lt(),Qe=Be+8|0,(n[Qe>>2]|0)==(z|0)){n[_e>>2]=Be,n[Qe>>2]=Xe,ue=Be;break}else Lt();while(!1);if(we){if(Be=n[m+(28-re)>>2]|0,_e=5128+(Be<<2)|0,(z|0)==(n[_e>>2]|0)){if(n[_e>>2]=ue,!ue){n[1207]=n[1207]&~(1<<Be),C=z,oe=X;break}}else if(we>>>0<(n[1210]|0)>>>0&&Lt(),_e=we+16|0,(n[_e>>2]|0)==(z|0)?n[_e>>2]=ue:n[we+20>>2]=ue,!ue){C=z,oe=X;break}_e=n[1210]|0,ue>>>0<_e>>>0&&Lt(),n[ue+24>>2]=we,re=16-re|0,we=n[m+re>>2]|0;do if(we)if(we>>>0<_e>>>0)Lt();else{n[ue+16>>2]=we,n[we+24>>2]=ue;break}while(!1);if(re=n[m+(re+4)>>2]|0,re)if(re>>>0<(n[1210]|0)>>>0)Lt();else{n[ue+20>>2]=re,n[re+24>>2]=ue,C=z,oe=X;break}else C=z,oe=X}else C=z,oe=X}while(!1);if(z=n[1210]|0,R>>>0<z>>>0&&Lt(),X=m+(T+4)|0,ue=n[X>>2]|0,ue&2)n[X>>2]=ue&-2,n[C+4>>2]=oe|1,n[C+oe>>2]=oe;else{if((R|0)==(n[1212]|0)){if(at=(n[1209]|0)+oe|0,n[1209]=at,n[1212]=C,n[C+4>>2]=at|1,(C|0)!=(n[1211]|0)){S=x;return}n[1211]=0,n[1208]=0,S=x;return}if((R|0)==(n[1211]|0)){at=(n[1208]|0)+oe|0,n[1208]=at,n[1211]=C,n[C+4>>2]=at|1,n[C+at>>2]=at,S=x;return}oe=(ue&-8)+oe|0,X=ue>>>3;do if(ue>>>0>=256){ee=n[m+(T+24)>>2]|0,ue=n[m+(T+12)>>2]|0;do if((ue|0)==(R|0)){if(ue=m+(T+20)|0,X=n[ue>>2]|0,!X&&(ue=m+(T+16)|0,X=n[ue>>2]|0,!X)){G=0;break}for(;;){if(re=X+20|0,we=n[re>>2]|0,we){X=we,ue=re;continue}if(we=X+16|0,re=n[we>>2]|0,re)X=re,ue=we;else break}if(ue>>>0<z>>>0)Lt();else{n[ue>>2]=0,G=X;break}}else if(X=n[m+(T+8)>>2]|0,X>>>0<z>>>0&&Lt(),re=X+12|0,(n[re>>2]|0)!=(R|0)&&Lt(),z=ue+8|0,(n[z>>2]|0)==(R|0)){n[re>>2]=ue,n[z>>2]=X,G=ue;break}else Lt();while(!1);if(ee){if(X=n[m+(T+28)>>2]|0,z=5128+(X<<2)|0,(R|0)==(n[z>>2]|0)){if(n[z>>2]=G,!G){n[1207]=n[1207]&~(1<<X);break}}else if(ee>>>0<(n[1210]|0)>>>0&&Lt(),z=ee+16|0,(n[z>>2]|0)==(R|0)?n[z>>2]=G:n[ee+20>>2]=G,!G)break;R=n[1210]|0,G>>>0<R>>>0&&Lt(),n[G+24>>2]=ee,ee=n[m+(T+16)>>2]|0;do if(ee)if(ee>>>0<R>>>0)Lt();else{n[G+16>>2]=ee,n[ee+24>>2]=G;break}while(!1);if(R=n[m+(T+20)>>2]|0,R)if(R>>>0<(n[1210]|0)>>>0)Lt();else{n[G+20>>2]=R,n[R+24>>2]=G;break}}}else{if(G=n[m+(T+8)>>2]|0,m=n[m+(T+12)>>2]|0,T=4864+(X<<1<<2)|0,(G|0)!=(T|0)&&(G>>>0<z>>>0&&Lt(),(n[G+12>>2]|0)!=(R|0)&&Lt()),(m|0)==(G|0)){n[1206]=n[1206]&~(1<<X);break}(m|0)!=(T|0)?(m>>>0<z>>>0&&Lt(),T=m+8|0,(n[T>>2]|0)==(R|0)?ee=T:Lt()):ee=m+8|0,n[G+12>>2]=m,n[ee>>2]=G}while(!1);if(n[C+4>>2]=oe|1,n[C+oe>>2]=oe,(C|0)==(n[1211]|0)){n[1208]=oe,S=x;return}}if(T=oe>>>3,oe>>>0<256){m=T<<1,R=4864+(m<<2)|0,G=n[1206]|0,T=1<<T,G&T?(m=4864+(m+2<<2)|0,G=n[m>>2]|0,G>>>0<(n[1210]|0)>>>0?Lt():(F=m,B=G)):(n[1206]=G|T,F=4864+(m+2<<2)|0,B=R),n[F>>2]=C,n[B+12>>2]=C,n[C+8>>2]=B,n[C+12>>2]=R,S=x;return}if(B=oe>>>8,B?oe>>>0>16777215?B=31:(Qe=(B+1048320|0)>>>16&8,at=B<<Qe,Xe=(at+520192|0)>>>16&4,at=at<<Xe,B=(at+245760|0)>>>16&2,B=14-(Xe|Qe|B)+(at<<B>>>15)|0,B=oe>>>(B+7|0)&1|B<<1):B=0,F=5128+(B<<2)|0,n[C+28>>2]=B,n[C+20>>2]=0,n[C+16>>2]=0,m=n[1207]|0,R=1<<B,!(m&R)){n[1207]=m|R,n[F>>2]=C,n[C+24>>2]=F,n[C+12>>2]=C,n[C+8>>2]=C,S=x;return}F=n[F>>2]|0,(B|0)==31?B=0:B=25-(B>>>1)|0;e:do if((n[F+4>>2]&-8|0)!=(oe|0)){for(B=oe<<B,m=F;R=m+(B>>>31<<2)+16|0,F=n[R>>2]|0,!!F;){if((n[F+4>>2]&-8|0)==(oe|0))break e;B=B<<1,m=F}R>>>0<(n[1210]|0)>>>0&&Lt(),n[R>>2]=C,n[C+24>>2]=m,n[C+12>>2]=C,n[C+8>>2]=C,S=x;return}while(!1);B=F+8|0,R=n[B>>2]|0,at=n[1210]|0,F>>>0>=at>>>0&R>>>0>=at>>>0||Lt(),n[R+12>>2]=C,n[B>>2]=C,n[C+8>>2]=R,n[C+12>>2]=F,n[C+24>>2]=0,S=x}function va(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0,R=0,G=0;if(x=S,B=m+4|0,F=n[B>>2]|0,C=m+100|0,F>>>0<(n[C>>2]|0)>>>0?(n[B>>2]=F+1,R=l[F>>0]|0):R=ss(m)|0,(R|0)==43|(R|0)==45?(G=n[B>>2]|0,F=(R|0)==45&1,G>>>0<(n[C>>2]|0)>>>0?(n[B>>2]=G+1,R=l[G>>0]|0):R=ss(m)|0,(R+-48|0)>>>0>9&(T|0)!=0&&n[C>>2]|0&&(n[B>>2]=(n[B>>2]|0)+-1)):F=0,(R+-48|0)>>>0>9)return n[C>>2]|0?(n[B>>2]=(n[B>>2]|0)+-1,R=-2147483648,G=0,ht=R,S=x,G|0):(R=-2147483648,G=0,ht=R,S=x,G|0);T=0;do T=R+-48+(T*10|0)|0,R=n[B>>2]|0,R>>>0<(n[C>>2]|0)>>>0?(n[B>>2]=R+1,R=l[R>>0]|0):R=ss(m)|0;while((R+-48|0)>>>0<10&(T|0)<214748364);if(G=((T|0)<0)<<31>>31,(R+-48|0)>>>0<10)do G=er(T|0,G|0,10,0)|0,T=ht,R=ts(R|0,((R|0)<0)<<31>>31|0,-48,-1)|0,T=ts(R|0,ht|0,G|0,T|0)|0,G=ht,R=n[B>>2]|0,R>>>0<(n[C>>2]|0)>>>0?(n[B>>2]=R+1,R=l[R>>0]|0):R=ss(m)|0;while((R+-48|0)>>>0<10&((G|0)<21474836|(G|0)==21474836&T>>>0<2061584302));if((R+-48|0)>>>0<10)do R=n[B>>2]|0,R>>>0<(n[C>>2]|0)>>>0?(n[B>>2]=R+1,R=l[R>>0]|0):R=ss(m)|0;while((R+-48|0)>>>0<10);return n[C>>2]|0&&(n[B>>2]=(n[B>>2]|0)+-1),B=(F|0)!=0,F=bn(0,0,T|0,G|0)|0,R=B?ht:G,G=B?F:T,ht=R,S=x,G|0}function jh(){}function bn(m,T,x,C){return m=m|0,T=T|0,x=x|0,C=C|0,T=T-C-(x>>>0>m>>>0|0)>>>0,ht=T,m-x>>>0|0|0}function ja(m,T,x){m=m|0,T=T|0,x=x|0;var C=0,B=0,F=0,R=0;if(C=m+x|0,(x|0)>=20){if(T=T&255,R=m&3,F=T|T<<8|T<<16|T<<24,B=C&-4,R)for(R=m+4-R|0;(m|0)<(R|0);)r[m>>0]=T,m=m+1|0;for(;(m|0)<(B|0);)n[m>>2]=F,m=m+4|0}for(;(m|0)<(C|0);)r[m>>0]=T,m=m+1|0;return m-x|0}function jr(m,T,x){return m=m|0,T=T|0,x=x|0,(x|0)<32?(ht=T<<x|(m&(1<<x)-1<<32-x)>>>32-x,m<<x):(ht=m<<x-32,0)}function Sa(m){m=m|0;var T=0;for(T=m;r[T>>0]|0;)T=T+1|0;return T-m|0}function ts(m,T,x,C){return m=m|0,T=T|0,x=x|0,C=C|0,x=m+x>>>0,ht=T+C+(x>>>0<m>>>0|0)>>>0,x|0|0}function uh(m,T,x){return m=m|0,T=T|0,x=x|0,(x|0)<32?(ht=T>>>x,m>>>x|(T&(1<<x)-1)<<32-x):(ht=0,T>>>x-32|0)}function ch(m,T,x){m=m|0,T=T|0,x=x|0;var C=0;if((x|0)>=4096)return je(m|0,T|0,x|0)|0;if(C=m|0,(m&3)==(T&3)){for(;m&3;){if(!x)return C|0;r[m>>0]=r[T>>0]|0,m=m+1|0,T=T+1|0,x=x-1|0}for(;(x|0)>=4;)n[m>>2]=n[T>>2],m=m+4|0,T=T+4|0,x=x-4|0}for(;(x|0)>0;)r[m>>0]=r[T>>0]|0,m=m+1|0,T=T+1|0,x=x-1|0;return C|0}function Wu(m,T,x){return m=m|0,T=T|0,x=x|0,(x|0)<32?(ht=T>>x,m>>>x|(T&(1<<x)-1)<<32-x):(ht=(T|0)<0?-1:0,T>>x-32|0)}function Bo(m){m=m|0;var T=0;return T=r[H+(m>>>24)>>0]|0,(T|0)<8?T|0:(T=r[H+(m>>16&255)>>0]|0,(T|0)<8?T+8|0:(T=r[H+(m>>8&255)>>0]|0,(T|0)<8?T+16|0:(r[H+(m&255)>>0]|0)+24|0))}function Js(m){m=m|0;var T=0;return T=r[L+(m&255)>>0]|0,(T|0)<8?T|0:(T=r[L+(m>>8&255)>>0]|0,(T|0)<8?T+8|0:(T=r[L+(m>>16&255)>>0]|0,(T|0)<8?T+16|0:(r[L+(m>>>24)>>0]|0)+24|0))}function _n(m,T){m=m|0,T=T|0;var x=0,C=0,B=0,F=0;return F=m&65535,C=T&65535,x=Ve(C,F)|0,B=m>>>16,C=(x>>>16)+(Ve(C,B)|0)|0,T=T>>>16,m=Ve(T,F)|0,ht=(C>>>16)+(Ve(T,B)|0)+(((C&65535)+m|0)>>>16)|0,C+m<<16|x&65535|0|0}function Yu(m,T,x,C){m=m|0,T=T|0,x=x|0,C=C|0;var B=0,F=0,R=0,G=0,ee=0,z=0;return z=T>>31|((T|0)<0?-1:0)<<1,ee=((T|0)<0?-1:0)>>31|((T|0)<0?-1:0)<<1,F=C>>31|((C|0)<0?-1:0)<<1,B=((C|0)<0?-1:0)>>31|((C|0)<0?-1:0)<<1,G=bn(z^m,ee^T,z,ee)|0,R=ht,T=F^z,m=B^ee,m=bn((no(G,R,bn(F^x,B^C,F,B)|0,ht,0)|0)^T,ht^m,T,m)|0,m|0}function Ku(m,T,x,C){m=m|0,T=T|0,x=x|0,C=C|0;var B=0,F=0,R=0,G=0,ee=0,z=0;return B=S,S=S+8|0,G=B|0,R=T>>31|((T|0)<0?-1:0)<<1,F=((T|0)<0?-1:0)>>31|((T|0)<0?-1:0)<<1,z=C>>31|((C|0)<0?-1:0)<<1,ee=((C|0)<0?-1:0)>>31|((C|0)<0?-1:0)<<1,T=bn(R^m,F^T,R,F)|0,m=ht,no(T,m,bn(z^x,ee^C,z,ee)|0,ht,G)|0,m=bn(n[G>>2]^R,n[G+4>>2]^F,R,F)|0,T=ht,S=B,ht=T,m|0}function er(m,T,x,C){m=m|0,T=T|0,x=x|0,C=C|0;var B=0,F=0;return B=m,F=x,m=_n(B,F)|0,x=ht,ht=(Ve(T,F)|0)+(Ve(C,B)|0)+x|x&0,m|0|0|0}function bl(m,T,x,C){return m=m|0,T=T|0,x=x|0,C=C|0,m=no(m,T,x,C,0)|0,m|0}function Za(m,T,x,C){m=m|0,T=T|0,x=x|0,C=C|0;var B=0,F=0;return F=S,S=S+8|0,B=F|0,no(m,T,x,C,B)|0,S=F,ht=n[B+4>>2]|0,n[B>>2]|0|0}function no(m,T,x,C,B){m=m|0,T=T|0,x=x|0,C=C|0,B=B|0;var F=0,R=0,G=0,ee=0,z=0,X=0,oe=0,ue=0,re=0,we=0;if(R=m,ee=T,G=ee,X=x,F=C,z=F,!G)return F=(B|0)!=0,z?F?(n[B>>2]=m|0,n[B+4>>2]=T&0,X=0,oe=0,ht=X,oe|0):(X=0,oe=0,ht=X,oe|0):(F&&(n[B>>2]=(R>>>0)%(X>>>0),n[B+4>>2]=0),z=0,oe=(R>>>0)/(X>>>0)>>>0,ht=z,oe|0);oe=(z|0)==0;do if(X){if(!oe){if(z=(Bo(z|0)|0)-(Bo(G|0)|0)|0,z>>>0<=31){oe=z+1|0,X=31-z|0,m=z-31>>31,ee=oe,T=R>>>(oe>>>0)&m|G<<X,m=G>>>(oe>>>0)&m,z=0,X=R<<X;break}return B?(n[B>>2]=m|0,n[B+4>>2]=ee|T&0,X=0,oe=0,ht=X,oe|0):(X=0,oe=0,ht=X,oe|0)}if(z=X-1|0,z&X){X=(Bo(X|0)|0)+33-(Bo(G|0)|0)|0,we=64-X|0,oe=32-X|0,ue=oe>>31,re=X-32|0,m=re>>31,ee=X,T=oe-1>>31&G>>>(re>>>0)|(G<<oe|R>>>(X>>>0))&m,m=m&G>>>(X>>>0),z=R<<we&ue,X=(G<<we|R>>>(re>>>0))&ue|R<<oe&X-33>>31;break}return B&&(n[B>>2]=z&R,n[B+4>>2]=0),(X|0)==1?(re=ee|T&0,we=m|0|0,ht=re,we|0):(we=Js(X|0)|0,re=G>>>(we>>>0)|0,we=G<<32-we|R>>>(we>>>0)|0,ht=re,we|0)}else{if(oe)return B&&(n[B>>2]=(G>>>0)%(X>>>0),n[B+4>>2]=0),re=0,we=(G>>>0)/(X>>>0)>>>0,ht=re,we|0;if(!R)return B&&(n[B>>2]=0,n[B+4>>2]=(G>>>0)%(z>>>0)),re=0,we=(G>>>0)/(z>>>0)>>>0,ht=re,we|0;if(X=z-1|0,!(X&z))return B&&(n[B>>2]=m|0,n[B+4>>2]=X&G|T&0),re=0,we=G>>>((Js(z|0)|0)>>>0),ht=re,we|0;if(z=(Bo(z|0)|0)-(Bo(G|0)|0)|0,z>>>0<=30){m=z+1|0,X=31-z|0,ee=m,T=G<<X|R>>>(m>>>0),m=G>>>(m>>>0),z=0,X=R<<X;break}return B?(n[B>>2]=m|0,n[B+4>>2]=ee|T&0,re=0,we=0,ht=re,we|0):(re=0,we=0,ht=re,we|0)}while(!1);if(!ee)F=X,C=0,G=0;else{R=x|0|0,F=F|C&0,C=ts(R,F,-1,-1)|0,x=ht,G=0;do oe=X,X=z>>>31|X<<1,z=G|z<<1,oe=T<<1|oe>>>31|0,ue=T>>>31|m<<1|0,bn(C,x,oe,ue)|0,we=ht,re=we>>31|((we|0)<0?-1:0)<<1,G=re&1,T=bn(oe,ue,re&R,(((we|0)<0?-1:0)>>31|((we|0)<0?-1:0)<<1)&F)|0,m=ht,ee=ee-1|0;while(ee|0);F=X,C=0}return R=0,B&&(n[B>>2]=T,n[B+4>>2]=m),re=(z|0)>>>31|(F|R)<<1|(R<<1|z>>>31)&0|C,we=(z<<1|0)&-2|G,ht=re,we|0}function vl(m,T,x,C){return m=m|0,T=T|0,x=x|0,C=C|0,La[m&1](T|0,x|0,C|0)|0}function Fo(m,T,x,C,B,F){m=m|0,T=T|0,x=x|0,C=C|0,B=B|0,F=F|0,_l[m&3](T|0,x|0,C|0,B|0,F|0)}function Aa(m,T){m=m|0,T=T|0,vo[m&31](T|0)}function wa(m,T,x){m=m|0,T=T|0,x=x|0,_o[m&3](T|0,x|0)}function Qa(m,T){return m=m|0,T=T|0,fh[m&1](T|0)|0}function Pa(m){m=m|0,Sl[m&3]()}function Zh(m,T,x,C,B,F,R){m=m|0,T=T|0,x=x|0,C=C|0,B=B|0,F=F|0,R=R|0,Ja[m&3](T|0,x|0,C|0,B|0,F|0,R|0)}function Qh(m,T,x){return m=m|0,T=T|0,x=x|0,tu[m&3](T|0,x|0)|0}function Jh(m,T,x,C,B){m=m|0,T=T|0,x=x|0,C=C|0,B=B|0,Al[m&3](T|0,x|0,C|0,B|0)}function eu(m,T,x){return m=m|0,T=T|0,x=x|0,Me(0),0}function dh(m,T,x,C,B){m=m|0,T=T|0,x=x|0,C=C|0,B=B|0,Me(1)}function Dn(m){m=m|0,Me(2)}function Ea(m,T){m=m|0,T=T|0,Me(3)}function ph(m){return m=m|0,Me(4),0}function ze(){Me(5)}function qo(){Bs()}function Ta(m,T,x,C,B,F){m=m|0,T=T|0,x=x|0,C=C|0,B=B|0,F=F|0,Me(6)}function tr(m,T){return m=m|0,T=T|0,Me(7),0}function us(m,T,x,C){m=m|0,T=T|0,x=x|0,C=C|0,Me(8)}var La=[eu,It],_l=[dh,Wh,ml,dh],vo=[Dn,Tn,Ba,Fa,qa,go,Io,St,ti,xr,gn,$a,Bt,vt,Ui,ct,Bi,ms,Ot,Do,qs,Dn,Dn,Dn,Dn,Dn,Dn,Dn,Dn,Dn,Dn,Dn],_o=[Ea,dl,sa,zi],fh=[ph,xt],Sl=[ze,qo,Wa,Ya],Ja=[Ta,Ga,Jn,Ta],tu=[tr,ia,xo,fi],Al=[us,xi,Ii,us];return{_yo:Ln,_strlen:Sa,_retireVar:No,_bitshift64Lshr:uh,_unyo:ha,_solve:ko,_bitshift64Shl:jr,_getSolution:Ro,___cxa_is_pointer_type:ma,_memset:ja,_getNumVars:da,_memcpy:ch,_getConflictClauseSize:Mr,_addClause:ca,_i64Subtract:bn,_createTheSolver:$n,_realloc:vs,_i64Add:ts,_solveAssuming:pa,___cxa_can_catch:Yh,_ensureVar:Mo,_getConflictClause:fa,_free:yi,_malloc:ya,__GLOBAL__I_a:Jt,__GLOBAL__I_a127:Or,runPostSets:jh,stackAlloc:Pn,stackSave:js,stackRestore:Xn,setThrew:Er,setTempRet0:hn,getTempRet0:En,dynCall_iiii:vl,dynCall_viiiii:Fo,dynCall_vi:Aa,dynCall_vii:wa,dynCall_ii:Qa,dynCall_v:Pa,dynCall_viiiiii:Zh,dynCall_iii:Qh,dynCall_viiii:Jh}}(Module.asmGlobalArg,Module.asmLibraryArg,buffer);Module._yo=asm._yo;var _strlen=Module._strlen=asm._strlen;Module._retireVar=asm._retireVar;var _bitshift64Lshr=Module._bitshift64Lshr=asm._bitshift64Lshr;Module._unyo=asm._unyo,Module._solve=asm._solve;var _bitshift64Shl=Module._bitshift64Shl=asm._bitshift64Shl;Module._getSolution=asm._getSolution,Module.___cxa_is_pointer_type=asm.___cxa_is_pointer_type;var _memset=Module._memset=asm._memset;Module._getNumVars=asm._getNumVars;var _memcpy=Module._memcpy=asm._memcpy;Module._getConflictClauseSize=asm._getConflictClauseSize,Module._addClause=asm._addClause;var _i64Subtract=Module._i64Subtract=asm._i64Subtract;Module._createTheSolver=asm._createTheSolver,Module._realloc=asm._realloc;var _i64Add=Module._i64Add=asm._i64Add;Module._solveAssuming=asm._solveAssuming,Module.___cxa_can_catch=asm.___cxa_can_catch,Module._ensureVar=asm._ensureVar,Module._getConflictClause=asm._getConflictClause;var _free=Module._free=asm._free,_malloc=Module._malloc=asm._malloc,__GLOBAL__I_a=Module.__GLOBAL__I_a=asm.__GLOBAL__I_a,__GLOBAL__I_a127=Module.__GLOBAL__I_a127=asm.__GLOBAL__I_a127;Module.runPostSets=asm.runPostSets,Module.dynCall_iiii=asm.dynCall_iiii,Module.dynCall_viiiii=asm.dynCall_viiiii,Module.dynCall_vi=asm.dynCall_vi,Module.dynCall_vii=asm.dynCall_vii,Module.dynCall_ii=asm.dynCall_ii,Module.dynCall_v=asm.dynCall_v,Module.dynCall_viiiiii=asm.dynCall_viiiiii,Module.dynCall_iii=asm.dynCall_iii,Module.dynCall_viiii=asm.dynCall_viiii,Runtime.stackAlloc=asm.stackAlloc,Runtime.stackSave=asm.stackSave,Runtime.stackRestore=asm.stackRestore,Runtime.setTempRet0=asm.setTempRet0,Runtime.getTempRet0=asm.getTempRet0;var i64Math=function(){var a={math:{}};a.math.Long=function(Ie,Ve){this.low_=Ie|0,this.high_=Ve|0},a.math.Long.IntCache_={},a.math.Long.fromInt=function(Ie){if(-128<=Ie&&Ie<128){var Ve=a.math.Long.IntCache_[Ie];if(Ve)return Ve}var Me=new a.math.Long(Ie|0,Ie<0?-1:0);return-128<=Ie&&Ie<128&&(a.math.Long.IntCache_[Ie]=Me),Me},a.math.Long.fromNumber=function(Ie){return isNaN(Ie)||!isFinite(Ie)?a.math.Long.ZERO:Ie<=-a.math.Long.TWO_PWR_63_DBL_?a.math.Long.MIN_VALUE:Ie+1>=a.math.Long.TWO_PWR_63_DBL_?a.math.Long.MAX_VALUE:Ie<0?a.math.Long.fromNumber(-Ie).negate():new a.math.Long(Ie%a.math.Long.TWO_PWR_32_DBL_|0,Ie/a.math.Long.TWO_PWR_32_DBL_|0)},a.math.Long.fromBits=function(Ie,Ve){return new a.math.Long(Ie,Ve)},a.math.Long.fromString=function(Ie,Ve){if(Ie.length==0)throw Error("number format error: empty string");var Me=Ve||10;if(Me<2||36<Me)throw Error("radix out of range: "+Me);if(Ie.charAt(0)=="-")return a.math.Long.fromString(Ie.substring(1),Me).negate();if(Ie.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+Ie);for(var yt=a.math.Long.fromNumber(Math.pow(Me,8)),u=a.math.Long.ZERO,y=0;y<Ie.length;y+=8){var w=Math.min(8,Ie.length-y),D=parseInt(Ie.substring(y,y+w),Me);if(w<8){var N=a.math.Long.fromNumber(Math.pow(Me,w));u=u.multiply(N).add(a.math.Long.fromNumber(D))}else u=u.multiply(yt),u=u.add(a.math.Long.fromNumber(D))}return u},a.math.Long.TWO_PWR_16_DBL_=65536,a.math.Long.TWO_PWR_24_DBL_=1<<24,a.math.Long.TWO_PWR_32_DBL_=a.math.Long.TWO_PWR_16_DBL_*a.math.Long.TWO_PWR_16_DBL_,a.math.Long.TWO_PWR_31_DBL_=a.math.Long.TWO_PWR_32_DBL_/2,a.math.Long.TWO_PWR_48_DBL_=a.math.Long.TWO_PWR_32_DBL_*a.math.Long.TWO_PWR_16_DBL_,a.math.Long.TWO_PWR_64_DBL_=a.math.Long.TWO_PWR_32_DBL_*a.math.Long.TWO_PWR_32_DBL_,a.math.Long.TWO_PWR_63_DBL_=a.math.Long.TWO_PWR_64_DBL_/2,a.math.Long.ZERO=a.math.Long.fromInt(0),a.math.Long.ONE=a.math.Long.fromInt(1),a.math.Long.NEG_ONE=a.math.Long.fromInt(-1),a.math.Long.MAX_VALUE=a.math.Long.fromBits(-1,2147483647),a.math.Long.MIN_VALUE=a.math.Long.fromBits(0,-2147483648),a.math.Long.TWO_PWR_24_=a.math.Long.fromInt(1<<24),a.math.Long.prototype.toInt=function(){return this.low_},a.math.Long.prototype.toNumber=function(){return this.high_*a.math.Long.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},a.math.Long.prototype.toString=function(Ie){var Ve=Ie||10;if(Ve<2||36<Ve)throw Error("radix out of range: "+Ve);if(this.isZero())return"0";if(this.isNegative())if(this.equals(a.math.Long.MIN_VALUE)){var Me=a.math.Long.fromNumber(Ve),yt=this.div(Me),y=yt.multiply(Me).subtract(this);return yt.toString(Ve)+y.toInt().toString(Ve)}else return"-"+this.negate().toString(Ve);for(var u=a.math.Long.fromNumber(Math.pow(Ve,6)),y=this,w="";;){var D=y.div(u),N=y.subtract(D.multiply(u)).toInt(),U=N.toString(Ve);if(y=D,y.isZero())return U+w;for(;U.length<6;)U="0"+U;w=""+U+w}},a.math.Long.prototype.getHighBits=function(){return this.high_},a.math.Long.prototype.getLowBits=function(){return this.low_},a.math.Long.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:a.math.Long.TWO_PWR_32_DBL_+this.low_},a.math.Long.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(a.math.Long.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var Ie=this.high_!=0?this.high_:this.low_,Ve=31;Ve>0&&!(Ie&1<<Ve);Ve--);return this.high_!=0?Ve+33:Ve+1},a.math.Long.prototype.isZero=function(){return this.high_==0&&this.low_==0},a.math.Long.prototype.isNegative=function(){return this.high_<0},a.math.Long.prototype.isOdd=function(){return(this.low_&1)==1},a.math.Long.prototype.equals=function(Ie){return this.high_==Ie.high_&&this.low_==Ie.low_},a.math.Long.prototype.notEquals=function(Ie){return this.high_!=Ie.high_||this.low_!=Ie.low_},a.math.Long.prototype.lessThan=function(Ie){return this.compare(Ie)<0},a.math.Long.prototype.lessThanOrEqual=function(Ie){return this.compare(Ie)<=0},a.math.Long.prototype.greaterThan=function(Ie){return this.compare(Ie)>0},a.math.Long.prototype.greaterThanOrEqual=function(Ie){return this.compare(Ie)>=0},a.math.Long.prototype.compare=function(Ie){if(this.equals(Ie))return 0;var Ve=this.isNegative(),Me=Ie.isNegative();return Ve&&!Me?-1:!Ve&&Me?1:this.subtract(Ie).isNegative()?-1:1},a.math.Long.prototype.negate=function(){return this.equals(a.math.Long.MIN_VALUE)?a.math.Long.MIN_VALUE:this.not().add(a.math.Long.ONE)},a.math.Long.prototype.add=function(Ie){var Ve=this.high_>>>16,Me=this.high_&65535,yt=this.low_>>>16,u=this.low_&65535,y=Ie.high_>>>16,w=Ie.high_&65535,D=Ie.low_>>>16,N=Ie.low_&65535,U=0,te=0,J=0,ie=0;return ie+=u+N,J+=ie>>>16,ie&=65535,J+=yt+D,te+=J>>>16,J&=65535,te+=Me+w,U+=te>>>16,te&=65535,U+=Ve+y,U&=65535,a.math.Long.fromBits(J<<16|ie,U<<16|te)},a.math.Long.prototype.subtract=function(Ie){return this.add(Ie.negate())},a.math.Long.prototype.multiply=function(Ie){if(this.isZero())return a.math.Long.ZERO;if(Ie.isZero())return a.math.Long.ZERO;if(this.equals(a.math.Long.MIN_VALUE))return Ie.isOdd()?a.math.Long.MIN_VALUE:a.math.Long.ZERO;if(Ie.equals(a.math.Long.MIN_VALUE))return this.isOdd()?a.math.Long.MIN_VALUE:a.math.Long.ZERO;if(this.isNegative())return Ie.isNegative()?this.negate().multiply(Ie.negate()):this.negate().multiply(Ie).negate();if(Ie.isNegative())return this.multiply(Ie.negate()).negate();if(this.lessThan(a.math.Long.TWO_PWR_24_)&&Ie.lessThan(a.math.Long.TWO_PWR_24_))return a.math.Long.fromNumber(this.toNumber()*Ie.toNumber());var Ve=this.high_>>>16,Me=this.high_&65535,yt=this.low_>>>16,u=this.low_&65535,y=Ie.high_>>>16,w=Ie.high_&65535,D=Ie.low_>>>16,N=Ie.low_&65535,U=0,te=0,J=0,ie=0;return ie+=u*N,J+=ie>>>16,ie&=65535,J+=yt*N,te+=J>>>16,J&=65535,J+=u*D,te+=J>>>16,J&=65535,te+=Me*N,U+=te>>>16,te&=65535,te+=yt*D,U+=te>>>16,te&=65535,te+=u*w,U+=te>>>16,te&=65535,U+=Ve*N+Me*D+yt*w+u*y,U&=65535,a.math.Long.fromBits(J<<16|ie,U<<16|te)},a.math.Long.prototype.div=function(Ie){if(Ie.isZero())throw Error("division by zero");if(this.isZero())return a.math.Long.ZERO;if(this.equals(a.math.Long.MIN_VALUE)){if(Ie.equals(a.math.Long.ONE)||Ie.equals(a.math.Long.NEG_ONE))return a.math.Long.MIN_VALUE;if(Ie.equals(a.math.Long.MIN_VALUE))return a.math.Long.ONE;var Ve=this.shiftRight(1),Me=Ve.div(Ie).shiftLeft(1);if(Me.equals(a.math.Long.ZERO))return Ie.isNegative()?a.math.Long.ONE:a.math.Long.NEG_ONE;var y=this.subtract(Ie.multiply(Me)),yt=Me.add(y.div(Ie));return yt}else if(Ie.equals(a.math.Long.MIN_VALUE))return a.math.Long.ZERO;if(this.isNegative())return Ie.isNegative()?this.negate().div(Ie.negate()):this.negate().div(Ie).negate();if(Ie.isNegative())return this.div(Ie.negate()).negate();for(var u=a.math.Long.ZERO,y=this;y.greaterThanOrEqual(Ie);){for(var Me=Math.max(1,Math.floor(y.toNumber()/Ie.toNumber())),w=Math.ceil(Math.log(Me)/Math.LN2),D=w<=48?1:Math.pow(2,w-48),N=a.math.Long.fromNumber(Me),U=N.multiply(Ie);U.isNegative()||U.greaterThan(y);)Me-=D,N=a.math.Long.fromNumber(Me),U=N.multiply(Ie);N.isZero()&&(N=a.math.Long.ONE),u=u.add(N),y=y.subtract(U)}return u},a.math.Long.prototype.modulo=function(Ie){return this.subtract(this.div(Ie).multiply(Ie))},a.math.Long.prototype.not=function(){return a.math.Long.fromBits(~this.low_,~this.high_)},a.math.Long.prototype.and=function(Ie){return a.math.Long.fromBits(this.low_&Ie.low_,this.high_&Ie.high_)},a.math.Long.prototype.or=function(Ie){return a.math.Long.fromBits(this.low_|Ie.low_,this.high_|Ie.high_)},a.math.Long.prototype.xor=function(Ie){return a.math.Long.fromBits(this.low_^Ie.low_,this.high_^Ie.high_)},a.math.Long.prototype.shiftLeft=function(Ie){if(Ie&=63,Ie==0)return this;var Ve=this.low_;if(Ie<32){var Me=this.high_;return a.math.Long.fromBits(Ve<<Ie,Me<<Ie|Ve>>>32-Ie)}else return a.math.Long.fromBits(0,Ve<<Ie-32)},a.math.Long.prototype.shiftRight=function(Ie){if(Ie&=63,Ie==0)return this;var Ve=this.high_;if(Ie<32){var Me=this.low_;return a.math.Long.fromBits(Me>>>Ie|Ve<<32-Ie,Ve>>Ie)}else return a.math.Long.fromBits(Ve>>Ie-32,Ve>=0?0:-1)},a.math.Long.prototype.shiftRightUnsigned=function(Ie){if(Ie&=63,Ie==0)return this;var Ve=this.high_;if(Ie<32){var Me=this.low_;return a.math.Long.fromBits(Me>>>Ie|Ve<<32-Ie,Ve>>>Ie)}else return Ie==32?a.math.Long.fromBits(Ve,0):a.math.Long.fromBits(Ve>>>Ie-32,0)};var t;function s(Ie,Ve,Me){Ie!=null&&(typeof Ie=="number"?this.fromNumber(Ie,Ve,Me):Ve==null&&typeof Ie!="string"?this.fromString(Ie,256):this.fromString(Ie,Ve))}function r(){return new s(null)}function o(Ie,Ve,Me,yt,u,y){for(;--y>=0;){var w=Ve*this[Ie++]+Me[yt]+u;u=Math.floor(w/67108864),Me[yt++]=w&67108863}return u}s.prototype.am=o,t=26,s.prototype.DB=t,s.prototype.DM=(1<<t)-1,s.prototype.DV=1<<t;var n=52;s.prototype.FV=Math.pow(2,n),s.prototype.F1=n-t,s.prototype.F2=2*t-n;var l="0123456789abcdefghijklmnopqrstuvwxyz",h=new Array,g,d;for(g=48,d=0;d<=9;++d)h[g++]=d;for(g=97,d=10;d<36;++d)h[g++]=d;for(g=65,d=10;d<36;++d)h[g++]=d;function A(Ie){return l.charAt(Ie)}function S(Ie,Ve){var Me=h[Ie.charCodeAt(Ve)];return Me??-1}function O(Ie){for(var Ve=this.t-1;Ve>=0;--Ve)Ie[Ve]=this[Ve];Ie.t=this.t,Ie.s=this.s}function I(Ie){this.t=1,this.s=Ie<0?-1:0,Ie>0?this[0]=Ie:Ie<-1?this[0]=Ie+DV:this.t=0}function W(Ie){var Ve=r();return Ve.fromInt(Ie),Ve}function L(Ie,Ve){var Me;if(Ve==16)Me=4;else if(Ve==8)Me=3;else if(Ve==256)Me=8;else if(Ve==2)Me=1;else if(Ve==32)Me=5;else if(Ve==4)Me=2;else{this.fromRadix(Ie,Ve);return}this.t=0,this.s=0;for(var yt=Ie.length,u=!1,y=0;--yt>=0;){var w=Me==8?Ie[yt]&255:S(Ie,yt);if(w<0){Ie.charAt(yt)=="-"&&(u=!0);continue}u=!1,y==0?this[this.t++]=w:y+Me>this.DB?(this[this.t-1]|=(w&(1<<this.DB-y)-1)<<y,this[this.t++]=w>>this.DB-y):this[this.t-1]|=w<<y,y+=Me,y>=this.DB&&(y-=this.DB)}Me==8&&Ie[0]&128&&(this.s=-1,y>0&&(this[this.t-1]|=(1<<this.DB-y)-1<<y)),this.clamp(),u&&s.ZERO.subTo(this,this)}function H(){for(var Ie=this.s&this.DM;this.t>0&&this[this.t-1]==Ie;)--this.t}function Y(Ie){if(this.s<0)return"-"+this.negate().toString(Ie);var Ve;if(Ie==16)Ve=4;else if(Ie==8)Ve=3;else if(Ie==2)Ve=1;else if(Ie==32)Ve=5;else if(Ie==4)Ve=2;else return this.toRadix(Ie);var Me=(1<<Ve)-1,yt,u=!1,y="",w=this.t,D=this.DB-w*this.DB%Ve;if(w-- >0)for(D<this.DB&&(yt=this[w]>>D)>0&&(u=!0,y=A(yt));w>=0;)D<Ve?(yt=(this[w]&(1<<D)-1)<<Ve-D,yt|=this[--w]>>(D+=this.DB-Ve)):(yt=this[w]>>(D-=Ve)&Me,D<=0&&(D+=this.DB,--w)),yt>0&&(u=!0),u&&(y+=A(yt));return u?y:"0"}function Q(){var Ie=r();return s.ZERO.subTo(this,Ie),Ie}function pe(){return this.s<0?this.negate():this}function de(Ie){var Ve=this.s-Ie.s;if(Ve!=0)return Ve;var Me=this.t;if(Ve=Me-Ie.t,Ve!=0)return this.s<0?-Ve:Ve;for(;--Me>=0;)if((Ve=this[Me]-Ie[Me])!=0)return Ve;return 0}function fe(Ie){var Ve=1,Me;return(Me=Ie>>>16)!=0&&(Ie=Me,Ve+=16),(Me=Ie>>8)!=0&&(Ie=Me,Ve+=8),(Me=Ie>>4)!=0&&(Ie=Me,Ve+=4),(Me=Ie>>2)!=0&&(Ie=Me,Ve+=2),(Me=Ie>>1)!=0&&(Ie=Me,Ve+=1),Ve}function ye(){return this.t<=0?0:this.DB*(this.t-1)+fe(this[this.t-1]^this.s&this.DM)}function Ee(Ie,Ve){var Me;for(Me=this.t-1;Me>=0;--Me)Ve[Me+Ie]=this[Me];for(Me=Ie-1;Me>=0;--Me)Ve[Me]=0;Ve.t=this.t+Ie,Ve.s=this.s}function Le(Ie,Ve){for(var Me=Ie;Me<this.t;++Me)Ve[Me-Ie]=this[Me];Ve.t=Math.max(this.t-Ie,0),Ve.s=this.s}function Z(Ie,Ve){var Me=Ie%this.DB,yt=this.DB-Me,u=(1<<yt)-1,y=Math.floor(Ie/this.DB),w=this.s<<Me&this.DM,D;for(D=this.t-1;D>=0;--D)Ve[D+y+1]=this[D]>>yt|w,w=(this[D]&u)<<Me;for(D=y-1;D>=0;--D)Ve[D]=0;Ve[y]=w,Ve.t=this.t+y+1,Ve.s=this.s,Ve.clamp()}function ne(Ie,Ve){Ve.s=this.s;var Me=Math.floor(Ie/this.DB);if(Me>=this.t){Ve.t=0;return}var yt=Ie%this.DB,u=this.DB-yt,y=(1<<yt)-1;Ve[0]=this[Me]>>yt;for(var w=Me+1;w<this.t;++w)Ve[w-Me-1]|=(this[w]&y)<<u,Ve[w-Me]=this[w]>>yt;yt>0&&(Ve[this.t-Me-1]|=(this.s&y)<<u),Ve.t=this.t-Me,Ve.clamp()}function Ke(Ie,Ve){for(var Me=0,yt=0,u=Math.min(Ie.t,this.t);Me<u;)yt+=this[Me]-Ie[Me],Ve[Me++]=yt&this.DM,yt>>=this.DB;if(Ie.t<this.t){for(yt-=Ie.s;Me<this.t;)yt+=this[Me],Ve[Me++]=yt&this.DM,yt>>=this.DB;yt+=this.s}else{for(yt+=this.s;Me<Ie.t;)yt-=Ie[Me],Ve[Me++]=yt&this.DM,yt>>=this.DB;yt-=Ie.s}Ve.s=yt<0?-1:0,yt<-1?Ve[Me++]=this.DV+yt:yt>0&&(Ve[Me++]=yt),Ve.t=Me,Ve.clamp()}function _t(Ie,Ve){var Me=this.abs(),yt=Ie.abs(),u=Me.t;for(Ve.t=u+yt.t;--u>=0;)Ve[u]=0;for(u=0;u<yt.t;++u)Ve[u+Me.t]=Me.am(0,yt[u],Ve,u,0,Me.t);Ve.s=0,Ve.clamp(),this.s!=Ie.s&&s.ZERO.subTo(Ve,Ve)}function xe(Ie){for(var Ve=this.abs(),Me=Ie.t=2*Ve.t;--Me>=0;)Ie[Me]=0;for(Me=0;Me<Ve.t-1;++Me){var yt=Ve.am(Me,Ve[Me],Ie,2*Me,0,1);(Ie[Me+Ve.t]+=Ve.am(Me+1,2*Ve[Me],Ie,2*Me+1,yt,Ve.t-Me-1))>=Ve.DV&&(Ie[Me+Ve.t]-=Ve.DV,Ie[Me+Ve.t+1]=1)}Ie.t>0&&(Ie[Ie.t-1]+=Ve.am(Me,Ve[Me],Ie,2*Me,0,1)),Ie.s=0,Ie.clamp()}function Ct(Ie,Ve,Me){var yt=Ie.abs();if(!(yt.t<=0)){var u=this.abs();if(u.t<yt.t){Ve!=null&&Ve.fromInt(0),Me!=null&&this.copyTo(Me);return}Me==null&&(Me=r());var y=r(),w=this.s,D=Ie.s,N=this.DB-fe(yt[yt.t-1]);N>0?(yt.lShiftTo(N,y),u.lShiftTo(N,Me)):(yt.copyTo(y),u.copyTo(Me));var U=y.t,te=y[U-1];if(te!=0){var J=te*(1<<this.F1)+(U>1?y[U-2]>>this.F2:0),ie=this.FV/J,ae=(1<<this.F1)/J,ve=1<<this.F2,Se=Me.t,be=Se-U,ge=Ve??r();for(y.dlShiftTo(be,ge),Me.compareTo(ge)>=0&&(Me[Me.t++]=1,Me.subTo(ge,Me)),s.ONE.dlShiftTo(U,ge),ge.subTo(y,y);y.t<U;)y[y.t++]=0;for(;--be>=0;){var Ce=Me[--Se]==te?this.DM:Math.floor(Me[Se]*ie+(Me[Se-1]+ve)*ae);if((Me[Se]+=y.am(0,Ce,Me,be,0,U))<Ce)for(y.dlShiftTo(be,ge),Me.subTo(ge,Me);Me[Se]<--Ce;)Me.subTo(ge,Me)}Ve!=null&&(Me.drShiftTo(U,Ve),w!=D&&s.ZERO.subTo(Ve,Ve)),Me.t=U,Me.clamp(),N>0&&Me.rShiftTo(N,Me),w<0&&s.ZERO.subTo(Me,Me)}}}function zt(Ie){var Ve=r();return this.abs().divRemTo(Ie,null,Ve),this.s<0&&Ve.compareTo(s.ZERO)>0&&Ie.subTo(Ve,Ve),Ve}function Je(Ie){this.m=Ie}function Et(Ie){return Ie.s<0||Ie.compareTo(this.m)>=0?Ie.mod(this.m):Ie}function ht(Ie){return Ie}function mt(Ie){Ie.divRemTo(this.m,null,Ie)}function Nt(Ie,Ve,Me){Ie.multiplyTo(Ve,Me),this.reduce(Me)}function Gt(Ie,Ve){Ie.squareTo(Ve),this.reduce(Ve)}Je.prototype.convert=Et,Je.prototype.revert=ht,Je.prototype.reduce=mt,Je.prototype.mulTo=Nt,Je.prototype.sqrTo=Gt;function Mt(){if(this.t<1)return 0;var Ie=this[0];if(!(Ie&1))return 0;var Ve=Ie&3;return Ve=Ve*(2-(Ie&15)*Ve)&15,Ve=Ve*(2-(Ie&255)*Ve)&255,Ve=Ve*(2-((Ie&65535)*Ve&65535))&65535,Ve=Ve*(2-Ie*Ve%this.DV)%this.DV,Ve>0?this.DV-Ve:-Ve}function jt(Ie){this.m=Ie,this.mp=Ie.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<Ie.DB-15)-1,this.mt2=2*Ie.t}function Ai(Ie){var Ve=r();return Ie.abs().dlShiftTo(this.m.t,Ve),Ve.divRemTo(this.m,null,Ve),Ie.s<0&&Ve.compareTo(s.ZERO)>0&&this.m.subTo(Ve,Ve),Ve}function oi(Ie){var Ve=r();return Ie.copyTo(Ve),this.reduce(Ve),Ve}function ki(Ie){for(;Ie.t<=this.mt2;)Ie[Ie.t++]=0;for(var Ve=0;Ve<this.m.t;++Ve){var Me=Ie[Ve]&32767,yt=Me*this.mpl+((Me*this.mph+(Ie[Ve]>>15)*this.mpl&this.um)<<15)&Ie.DM;for(Me=Ve+this.m.t,Ie[Me]+=this.m.am(0,yt,Ie,Ve,0,this.m.t);Ie[Me]>=Ie.DV;)Ie[Me]-=Ie.DV,Ie[++Me]++}Ie.clamp(),Ie.drShiftTo(this.m.t,Ie),Ie.compareTo(this.m)>=0&&Ie.subTo(this.m,Ie)}function Li(Ie,Ve){Ie.squareTo(Ve),this.reduce(Ve)}function Wi(Ie,Ve,Me){Ie.multiplyTo(Ve,Me),this.reduce(Me)}jt.prototype.convert=Ai,jt.prototype.revert=oi,jt.prototype.reduce=ki,jt.prototype.mulTo=Wi,jt.prototype.sqrTo=Li;function Vi(){return(this.t>0?this[0]&1:this.s)==0}function qi(Ie,Ve){if(Ie>4294967295||Ie<1)return s.ONE;var Me=r(),yt=r(),u=Ve.convert(this),y=fe(Ie)-1;for(u.copyTo(Me);--y>=0;)if(Ve.sqrTo(Me,yt),(Ie&1<<y)>0)Ve.mulTo(yt,u,Me);else{var w=Me;Me=yt,yt=w}return Ve.revert(Me)}function Kt(Ie,Ve){var Me;return Ie<256||Ve.isEven()?Me=new Je(Ve):Me=new jt(Ve),this.exp(Ie,Me)}s.prototype.copyTo=O,s.prototype.fromInt=I,s.prototype.fromString=L,s.prototype.clamp=H,s.prototype.dlShiftTo=Ee,s.prototype.drShiftTo=Le,s.prototype.lShiftTo=Z,s.prototype.rShiftTo=ne,s.prototype.subTo=Ke,s.prototype.multiplyTo=_t,s.prototype.squareTo=xe,s.prototype.divRemTo=Ct,s.prototype.invDigit=Mt,s.prototype.isEven=Vi,s.prototype.exp=qi,s.prototype.toString=Y,s.prototype.negate=Q,s.prototype.abs=pe,s.prototype.compareTo=de,s.prototype.bitLength=ye,s.prototype.mod=zt,s.prototype.modPowInt=Kt,s.ZERO=W(0),s.ONE=W(1);function zs(Ie,Ve){this.fromInt(0),Ve==null&&(Ve=10);for(var Me=this.chunkSize(Ve),yt=Math.pow(Ve,Me),u=!1,y=0,w=0,D=0;D<Ie.length;++D){var N=S(Ie,D);if(N<0){Ie.charAt(D)=="-"&&this.signum()==0&&(u=!0);continue}w=Ve*w+N,++y>=Me&&(this.dMultiply(yt),this.dAddOffset(w,0),y=0,w=0)}y>0&&(this.dMultiply(Math.pow(Ve,y)),this.dAddOffset(w,0)),u&&s.ZERO.subTo(this,this)}function ls(Ie){return Math.floor(Math.LN2*this.DB/Math.log(Ie))}function gs(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1}function Ws(Ie){this[this.t]=this.am(0,Ie-1,this,0,0,this.t),++this.t,this.clamp()}function K(Ie,Ve){if(Ie!=0){for(;this.t<=Ve;)this[this.t++]=0;for(this[Ve]+=Ie;this[Ve]>=this.DV;)this[Ve]-=this.DV,++Ve>=this.t&&(this[this.t++]=0),++this[Ve]}}function He(Ie){if(Ie==null&&(Ie=10),this.signum()==0||Ie<2||Ie>36)return"0";var Ve=this.chunkSize(Ie),Me=Math.pow(Ie,Ve),yt=W(Me),u=r(),y=r(),w="";for(this.divRemTo(yt,u,y);u.signum()>0;)w=(Me+y.intValue()).toString(Ie).substr(1)+w,u.divRemTo(yt,u,y);return y.intValue().toString(Ie)+w}function We(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function it(Ie,Ve){for(var Me=0,yt=0,u=Math.min(Ie.t,this.t);Me<u;)yt+=this[Me]+Ie[Me],Ve[Me++]=yt&this.DM,yt>>=this.DB;if(Ie.t<this.t){for(yt+=Ie.s;Me<this.t;)yt+=this[Me],Ve[Me++]=yt&this.DM,yt>>=this.DB;yt+=this.s}else{for(yt+=this.s;Me<Ie.t;)yt+=Ie[Me],Ve[Me++]=yt&this.DM,yt>>=this.DB;yt+=Ie.s}Ve.s=yt<0?-1:0,yt>0?Ve[Me++]=yt:yt<-1&&(Ve[Me++]=this.DV+yt),Ve.t=Me,Ve.clamp()}s.prototype.fromRadix=zs,s.prototype.chunkSize=ls,s.prototype.signum=gs,s.prototype.dMultiply=Ws,s.prototype.dAddOffset=K,s.prototype.toRadix=He,s.prototype.intValue=We,s.prototype.addTo=it;var et={abs:function(Ie,Ve){var Me=new a.math.Long(Ie,Ve),yt;Me.isNegative()?yt=Me.negate():yt=Me,HEAP32[tempDoublePtr>>2]=yt.low_,HEAP32[tempDoublePtr+4>>2]=yt.high_},ensureTemps:function(){et.ensuredTemps||(et.ensuredTemps=!0,et.two32=new s,et.two32.fromString("4294967296",10),et.two64=new s,et.two64.fromString("18446744073709551616",10),et.temp1=new s,et.temp2=new s)},lh2bignum:function(Ie,Ve){var Me=new s;Me.fromString(Ve.toString(),10);var yt=new s;Me.multiplyTo(et.two32,yt);var u=new s;u.fromString(Ie.toString(),10);var y=new s;return u.addTo(yt,y),y},stringify:function(Ie,Ve,Me){var yt=new a.math.Long(Ie,Ve).toString();if(Me&&yt[0]=="-"){et.ensureTemps();var u=new s;u.fromString(yt,10),yt=new s,et.two64.addTo(u,yt),yt=yt.toString(10)}return yt},fromString:function(Ie,Ve,Me,yt,u){et.ensureTemps();var y=new s;y.fromString(Ie,Ve);var w=new s;w.fromString(Me,10);var D=new s;if(D.fromString(yt,10),u&&y.compareTo(s.ZERO)<0){var N=new s;y.addTo(et.two64,N),y=N}var U=!1;y.compareTo(w)<0?(y=w,U=!0):y.compareTo(D)>0&&(y=D,U=!0);var te=a.math.Long.fromString(y.toString());if(HEAP32[tempDoublePtr>>2]=te.low_,HEAP32[tempDoublePtr+4>>2]=te.high_,U)throw"range error"}};return et}();function ExitStatus(a){this.name="ExitStatus",this.message="Program terminated with exit("+a+")",this.status=a}ExitStatus.prototype=new Error,ExitStatus.prototype.constructor=ExitStatus;var initialStackTop;dependenciesFulfilled=function a(){!Module.calledRun&&shouldRunNow&&run(),Module.calledRun||(dependenciesFulfilled=a)},Module.callMain=Module.callMain=function a(t){assert(runDependencies==0,"cannot call main when async dependencies remain! (listen on __ATMAIN__)"),assert(__ATPRERUN__.length==0,"cannot call main when preRun functions remain to be called"),t=t||[],ensureInitRuntime();var s=t.length+1;function r(){for(var h=0;h<3;h++)o.push(0)}var o=[allocate(intArrayFromString(Module.thisProgram),"i8",ALLOC_NORMAL)];r();for(var n=0;n<s-1;n=n+1)o.push(allocate(intArrayFromString(t[n]),"i8",ALLOC_NORMAL)),r();o.push(0),o=allocate(o,"i32",ALLOC_NORMAL),initialStackTop=STACKTOP;try{var l=Module._main(s,o,0);exit(l)}catch(h){if(h instanceof ExitStatus)return;if(h=="SimulateInfiniteLoop"){Module.noExitRuntime=!0;return}else throw h&&typeof h=="object"&&h.stack&&Module.printErr("exception thrown: "+[h,h.stack]),h}finally{}};function run(a){if(a=a||Module.arguments,runDependencies>0||(preRun(),runDependencies>0)||Module.calledRun)return;function t(){Module.calledRun||(Module.calledRun=!0,!ABORT&&(ensureInitRuntime(),preMain(),Module._main&&shouldRunNow&&Module.callMain(a),postRun()))}Module.setStatus?(Module.setStatus("Running..."),setTimeout(function(){setTimeout(function(){Module.setStatus("")},1),t()},1)):t()}Module.run=Module.run=run;function exit(a){if(!Module.noExitRuntime)throw ABORT=!0,STACKTOP=initialStackTop,exitRuntime(),ENVIRONMENT_IS_NODE?(process.stdout.once("drain",function(){process.exit(a)}),console.log(" "),setTimeout(function(){process.exit(a)},500)):ENVIRONMENT_IS_SHELL&&typeof quit=="function"&&quit(a),new ExitStatus(a)}Module.exit=Module.exit=exit;function abort(a){a&&(Module.print(a),Module.printErr(a)),ABORT=!0;var t=`
If this abort() is unexpected, build with -s ASSERTIONS=1 which can give more information.`;throw"abort() at "+stackTrace()+t}if(Module.abort=Module.abort=abort,Module.preInit)for(typeof Module.preInit=="function"&&(Module.preInit=[Module.preInit]);Module.preInit.length>0;)Module.preInit.pop()();var shouldRunNow=!0;Module.noInitialRun&&(shouldRunNow=!1),run();var origMalloc=Module._malloc,origFree=Module._free,MEMSTATS={totalMemory:Module.HEAPU8.length,heapUsed:0},MEMSTATS_DATA={pointerToSizeMap:{},getSizeOfPointer:function(a){return MEMSTATS_DATA.pointerToSizeMap[a]}};Module.MEMSTATS=MEMSTATS,Module.MEMSTATS_DATA=MEMSTATS_DATA;var hookedMalloc=function(a){var t=origMalloc(a);return t?(MEMSTATS.heapUsed+=a,MEMSTATS_DATA.pointerToSizeMap[t]=a,t):0},hookedFree=function(a){return a&&(MEMSTATS.heapUsed-=MEMSTATS_DATA.getSizeOfPointer(a)||0,delete MEMSTATS_DATA.pointerToSizeMap[a]),origFree(a)};return Module._malloc=hookedMalloc,Module._free=hookedFree,_malloc=hookedMalloc,_free=hookedFree,module.exports};const C_MINISAT$1=C_MINISAT;var MiniSat;MiniSat=function(){var a=this._C=C_MINISAT$1();this._native={getStackPointer:function(){return a.Runtime.stackSave()},setStackPointer:function(t){a.Runtime.stackRestore(t)},allocateBytes:function(t){return a.allocate(t,"i8",a.ALLOC_STACK)},pushString:function(t){return this.allocateBytes(a.intArrayFromString(t))},savingStack:function(t){var s=this.getStackPointer();try{return t(this,a)}finally{this.setStackPointer(s)}}},a._createTheSolver(),this._clauses=[]};MiniSat.prototype.ensureVar=function(a){this._C._ensureVar(a)};MiniSat.prototype.addClause=function(a){return this._clauses.push(a),this._native.savingStack(function(t,s){var r=s.allocate((a.length+1)*4,"i32",s.ALLOC_STACK);return _$1.each(a,function(o,n){s.setValue(r+n*4,o,"i32")}),s.setValue(r+a.length*4,0,"i32"),!!s._addClause(r)})};MiniSat.prototype.solve=function(){return!!this._C._solve()};MiniSat.prototype.solveAssuming=function(a){return!!this._C._solveAssuming(a)};MiniSat.prototype.getSolution=function(){for(var a=[null],t=this._C,s=t._getNumVars(),r=t._getSolution(),o=0;o<s;o++)a[o+1]=t.getValue(r+o,"i8")===0;return a};MiniSat.prototype.retireVar=function(a){this._C._retireVar(a)};MiniSat.prototype.getConflictClause=function(){for(var a=this._C,t=a._getConflictClauseSize(),s=a._getConflictClause(),r=[],o=0;o<t;o++){var n=a.getValue(s+o*4,"i32"),l=n>>>1,h=n&1?-1:1;r[o]=l*h}return r};const MiniSat$1=MiniSat;var Logic;Logic={};var withDescription=function(a,t){return t.description=a,t},lazyInstanceofTester=function(a,t,s){return withDescription(a,function(r){return r instanceof t[s]})};Logic.isNumTerm=withDescription("a NumTerm (non-zero integer)",function(a){return a===(a|0)&&a!==0});Logic.isNameTerm=withDescription("a NameTerm (string)",function(a){return typeof a=="string"&&!/^-*[0-9]*$/.test(a)});Logic.isTerm=withDescription("a Term (appropriate string or number)",function(a){return Logic.isNumTerm(a)||Logic.isNameTerm(a)});Logic.isWholeNumber=withDescription("a whole number (integer >= 0)",function(a){return a===(a|0)&&a>=0});Logic.isFormula=lazyInstanceofTester("a Formula",Logic,"Formula");Logic.isClause=lazyInstanceofTester("a Clause",Logic,"Clause");Logic.isBits=lazyInstanceofTester("a Bits",Logic,"Bits");Logic._isInteger=withDescription("an integer",function(a){return a===(a|0)});Logic._isFunction=withDescription("a Function",function(a){return typeof a=="function"});Logic._isString=withDescription("a String",function(a){return typeof a=="string"});Logic._isArrayWhere=function(a){var t="an array";return a.description&&(t+=" of "+a.description),withDescription(t,function(s){if(_$1.isArray(s)){for(var r=0;r<s.length;r++)if(!a(s[r]))return!1;return!0}else return!1})};Logic._isFormulaOrTerm=withDescription("a Formula or Term",function(a){return Logic.isFormula(a)||Logic.isTerm(a)});Logic._isFormulaOrTermOrBits=withDescription("a Formula, Term, or Bits",function(a){return Logic.isFormula(a)||Logic.isBits(a)||Logic.isTerm(a)});Logic._MiniSat=MiniSat$1;var isInteger=Logic._isInteger,isFunction=Logic._isFunction,isString=Logic._isString,isArrayWhere=Logic._isArrayWhere,isFormulaOrTerm=Logic._isFormulaOrTerm,isFormulaOrTermOrBits=Logic._isFormulaOrTermOrBits;Logic._assert=function(a,t,s){if(!t(a)){var r=typeof a=="string"?JSON.stringify(a):a;throw new Error(r+" is not "+(t.description||s))}};var assertNumArgs=function(a,t,s){if(a!==t)throw new Error("Expected "+t+" args in "+s+", got "+a)},assert$1=Logic._assert;Logic._assertIfEnabled=function(a,t,s){assert$1&&assert$1(a,t,s)};Logic.disablingAssertions=function(a){var t=assert$1;try{return assert$1=null,a()}finally{assert$1=t}};Logic._disablingTypeChecks=Logic.disablingAssertions;Logic.not=function(a){return assert$1&&assert$1(a,isFormulaOrTerm),a instanceof Logic.Formula?new Logic.NotFormula(a):typeof a=="number"?-a:a.charAt(0)==="-"?a.slice(1):"-"+a};Logic.NAME_FALSE="$F";Logic.NAME_TRUE="$T";Logic.NUM_FALSE=1;Logic.NUM_TRUE=2;Logic.TRUE=Logic.NAME_TRUE;Logic.FALSE=Logic.NAME_FALSE;Logic.Formula=function(){};Logic._defineFormula=function(a,t,s){assert$1&&assert$1(a,isFunction),assert$1&&assert$1(t,isString),a.prototype=new Logic.Formula,a.prototype.type=t,s&&_$1.extend(a.prototype,s)};Logic.Formula.prototype.generateClauses=function(a,t){throw new Error("Cannot generate this Formula; it must be expanded")};Logic.Formula._nextGuid=1;Logic.Formula.prototype._guid=null;Logic.Formula.prototype.guid=function(){return this._guid===null&&(this._guid=Logic.Formula._nextGuid++),this._guid};Logic.Clause=function(){var a=_$1.flatten(arguments);assert$1&&assert$1(a,isArrayWhere(Logic.isNumTerm)),this.terms=a};Logic.Clause.prototype.append=function(){return new Logic.Clause(this.terms.concat(_$1.flatten(arguments)))};var FormulaInfo=function(){this.varName=null,this.varNum=null,this.occursPositively=!1,this.occursNegatively=!1,this.isRequired=!1,this.isForbidden=!1};Logic.Termifier=function(a){this.solver=a};Logic.Termifier.prototype.clause=function(){var a=this,t=_$1.flatten(arguments);return assert$1&&assert$1(t,isArrayWhere(isFormulaOrTerm)),new Logic.Clause(_$1.map(t,function(s){return a.term(s)}))};Logic.Termifier.prototype.term=function(a){return this.solver._formulaToTerm(a)};Logic.Termifier.prototype.generate=function(a,t){return this.solver._generateFormula(a,t,this)};Logic.Solver=function(){var a=this;a.clauses=[],a._num2name=[null],a._name2num={};var t=a.getVarNum(Logic.NAME_FALSE,!1,!0),s=a.getVarNum(Logic.NAME_TRUE,!1,!0);if(t!==Logic.NUM_FALSE||s!==Logic.NUM_TRUE)throw new Error("Assertion failure: $T and $F have wrong numeric value");a._F_used=!1,a._T_used=!1,a.clauses.push(new Logic.Clause(-Logic.NUM_FALSE)),a.clauses.push(new Logic.Clause(Logic.NUM_TRUE)),a._formulaInfo={},a._nextFormulaNumByType={},a._ungeneratedFormulas={},a._numClausesAddedToMiniSat=0,a._unsat=!1,a._minisat=new MiniSat$1,a._termifier=new Logic.Termifier(a)};Logic.Solver.prototype.getVarNum=function(a,t,s){var r=" "+a;if(_$1.has(this._name2num,r))return this._name2num[r];if(t)return 0;if(a.charAt(0)==="$"&&!s)throw new Error("Only generated variable names can start with $");var o=this._num2name.length;return this._name2num[r]=o,this._num2name.push(a),o};Logic.Solver.prototype.getVarName=function(a){assert$1&&assert$1(a,isInteger);var t=this._num2name;if(a<1||a>=t.length)throw new Error("Bad variable num: "+a);return t[a]};Logic.Solver.prototype.toNumTerm=function(a,t){var s=this;if(assert$1&&assert$1(a,Logic.isTerm),typeof a=="number")return a;for(var r=!1;a.charAt(0)==="-";)a=a.slice(1),r=!r;var o=s.getVarNum(a,t);return o?r?-o:o:0};Logic.Solver.prototype.toNameTerm=function(a){var t=this;if(assert$1&&assert$1(a,Logic.isTerm),typeof a=="string"){for(;a.slice(0,2)==="--";)a=a.slice(2);return a}else{var s=!1;return a<0&&(s=!0,a=-a),a=t.getVarName(a),s&&(a="-"+a),a}};Logic.Solver.prototype._addClause=function(a,t,s){var r=this;assert$1&&assert$1(a,Logic.isClause);var o=null;t&&(o=t,assert$1&&assert$1(o,isArrayWhere(Logic.isNumTerm)));var n=!1,l=!1,h=a.terms.length;o&&(a=a.append(o));for(var g=0;g<a.terms.length;g++){var d=a.terms[g],A=d<0?-d:d;if(A===Logic.NUM_FALSE)n=!0;else if(A===Logic.NUM_TRUE)l=!0;else{if(A<1||A>=r._num2name.length)throw new Error("Bad variable number: "+A);g<h&&(s?s(d):r._useFormulaTerm(d))}}this._F_used=this._F_used||n,this._T_used=this._T_used||l,this.clauses.push(a)};Logic.Solver.prototype._useFormulaTerm=function(a,t){var s=this;assert$1&&assert$1(a,Logic.isNumTerm);var r=a<0?-a:a;if(_$1.has(s._ungeneratedFormulas,r)){var o=s._ungeneratedFormulas[r],n=s._getFormulaInfo(o),l=a>0,h=null,g;if(t?g=t:(h=[],g=function(O,I){h.push({clauses:O,extraTerms:I})}),l&&!n.occursPositively){n.occursPositively=!0;var d=s._generateFormula(!0,o);g(d,[-r])}else if(!l&&!n.occursNegatively){n.occursNegatively=!0;var d=s._generateFormula(!1,o);g(d,[r])}if(n.occursPositively&&n.occursNegatively&&delete s._ungeneratedFormulas[r],!!(h&&h.length))for(var A=function(O){s._useFormulaTerm(O,g)};h.length;){var S=h.pop();s._addClauses(S.clauses,S.extraTerms,A)}}};Logic.Solver.prototype._addClauses=function(a,t,s){assert$1&&assert$1(a,isArrayWhere(Logic.isClause));var r=this;_$1.each(a,function(o){r._addClause(o,t,s)})};Logic.Solver.prototype.require=function(){this._requireForbidImpl(!0,_$1.flatten(arguments))};Logic.Solver.prototype.forbid=function(){this._requireForbidImpl(!1,_$1.flatten(arguments))};Logic.Solver.prototype._requireForbidImpl=function(a,t){var s=this;assert$1&&assert$1(t,isArrayWhere(isFormulaOrTerm)),_$1.each(t,function(r){if(r instanceof Logic.NotFormula)s._requireForbidImpl(!a,[r.operand]);else if(r instanceof Logic.Formula){var o=s._getFormulaInfo(r);if(o.varNum!==null){var n=a?1:-1;s._addClause(new Logic.Clause(n*o.varNum))}else s._addClauses(s._generateFormula(a,r));a?o.isRequired=!0:o.isForbidden=!0}else s._addClauses(s._generateFormula(a,r))})};Logic.Solver.prototype._generateFormula=function(a,t,s){var r=this;if(assert$1&&assert$1(t,isFormulaOrTerm),t instanceof Logic.NotFormula)return r._generateFormula(!a,t.operand);if(t instanceof Logic.Formula){var o=r._getFormulaInfo(t);if(a&&o.isRequired||!a&&o.isForbidden)return[];if(a&&o.isForbidden||!a&&o.isRequired)return[new Logic.Clause];var n=t.generateClauses(a,s||r._termifier);return _$1.isArray(n)?n:[n]}else{var l=r.toNumTerm(t),h=a?1:-1;return l===h*Logic.NUM_TRUE||l===-h*Logic.NUM_FALSE?[]:l===h*Logic.NUM_FALSE||l===-h*Logic.NUM_TRUE?[new Logic.Clause]:[new Logic.Clause(h*l)]}};Logic.Solver.prototype._clauseData=function(){var a=_$1.map(this.clauses,"terms");return this._T_used||a.splice(1,1),this._F_used||a.splice(0,1),a};Logic.Solver.prototype._clauseStrings=function(){var a=this,t=a._clauseData();return _$1.map(t,function(s){return _$1.map(s,function(r){var o=a.toNameTerm(r);if(/\s/.test(o)){var n="";o.charAt(0)==="-"&&(n="-",o=o.slice(1)),o=n+'"'+o+'"'}return o}).join(" v ")})};Logic.Solver.prototype._getFormulaInfo=function(a,t){var s=this,r=a.guid();if(!s._formulaInfo[r]){if(t)return null;s._formulaInfo[r]=new FormulaInfo}return s._formulaInfo[r]};Logic.Solver.prototype._formulaToTerm=function(a){var t=this;if(_$1.isArray(a))return assert$1&&assert$1(a,isArrayWhere(isFormulaOrTerm)),_$1.map(a,_$1.bind(t._formulaToTerm,t));if(assert$1&&assert$1(a,isFormulaOrTerm),a instanceof Logic.NotFormula)return Logic.not(t._formulaToTerm(a.operand));if(a instanceof Logic.Formula){var s=this._getFormulaInfo(a);if(s.isRequired)return Logic.NUM_TRUE;if(s.isForbidden)return Logic.NUM_FALSE;if(s.varNum===null){var r=a.type;this._nextFormulaNumByType[r]||(this._nextFormulaNumByType[r]=1);var o=this._nextFormulaNumByType[r]++;s.varName="$"+a.type+o,s.varNum=this.getVarNum(s.varName,!1,!0),this._ungeneratedFormulas[s.varNum]=a}return s.varNum}else return t.toNumTerm(a)};Logic.or=function(){var a=_$1.flatten(arguments);return a.length===0?Logic.FALSE:a.length===1?(assert$1&&assert$1(a[0],isFormulaOrTerm),a[0]):new Logic.OrFormula(a)};Logic.OrFormula=function(a){assert$1&&assert$1(a,isArrayWhere(isFormulaOrTerm)),this.operands=a};Logic._defineFormula(Logic.OrFormula,"or",{generateClauses:function(a,t){if(a)return t.clause(this.operands);var s=[];return _$1.each(this.operands,function(r){s.push.apply(s,t.generate(!1,r))}),s}});Logic.NotFormula=function(a){assert$1&&assert$1(a,isFormulaOrTerm),this.operand=a};Logic._defineFormula(Logic.NotFormula,"not");Logic.and=function(){var a=_$1.flatten(arguments);return a.length===0?Logic.TRUE:a.length===1?(assert$1&&assert$1(a[0],isFormulaOrTerm),a[0]):new Logic.AndFormula(a)};Logic.AndFormula=function(a){assert$1&&assert$1(a,isArrayWhere(isFormulaOrTerm)),this.operands=a};Logic._defineFormula(Logic.AndFormula,"and",{generateClauses:function(a,t){if(a){var s=[];return _$1.each(this.operands,function(r){s.push.apply(s,t.generate(!0,r))}),s}else return t.clause(_$1.map(this.operands,Logic.not))}});var group=function(a,t){for(var s=[],r=0;r<a.length;r+=t)s.push(a.slice(r,r+t));return s};Logic.xor=function(){var a=_$1.flatten(arguments);return a.length===0?Logic.FALSE:a.length===1?(assert$1&&assert$1(a[0],isFormulaOrTerm),a[0]):new Logic.XorFormula(a)};Logic.XorFormula=function(a){assert$1&&assert$1(a,isArrayWhere(isFormulaOrTerm)),this.operands=a};Logic._defineFormula(Logic.XorFormula,"xor",{generateClauses:function(a,t){var s=this.operands,r=Logic.not;if(s.length>3)return t.generate(a,Logic.xor(_$1.map(group(this.operands,3),function(h){return Logic.xor(h)})));if(a){if(s.length===0)return t.clause();if(s.length===1)return t.clause(s[0]);if(s.length===2){var o=s[0],n=s[1];return[t.clause(o,n),t.clause(r(o),r(n))]}else if(s.length===3){var o=s[0],n=s[1],l=s[2];return[t.clause(o,n,l),t.clause(o,r(n),r(l)),t.clause(r(o),n,r(l)),t.clause(r(o),r(n),l)]}}else{if(s.length===0)return[];if(s.length===1)return t.clause(r(s[0]));if(s.length===2){var o=s[0],n=s[1];return[t.clause(o,r(n)),t.clause(r(o),n)]}else if(s.length===3){var o=s[0],n=s[1],l=s[2];return[t.clause(r(o),r(n),r(l)),t.clause(r(o),n,l),t.clause(o,r(n),l),t.clause(o,n,r(l))]}}}});Logic.atMostOne=function(){var a=_$1.flatten(arguments);return a.length<=1?Logic.TRUE:new Logic.AtMostOneFormula(a)};Logic.AtMostOneFormula=function(a){assert$1&&assert$1(a,isArrayWhere(isFormulaOrTerm)),this.operands=a};Logic._defineFormula(Logic.AtMostOneFormula,"atMostOne",{generateClauses:function(a,t){var s=this.operands,r=Logic.not;if(s.length<=1)return[];if(s.length===2)return t.generate(a,Logic.not(Logic.and(s)));if(a&&s.length===3){for(var o=[],n=0;n<s.length;n++)for(var l=n+1;l<s.length;l++)o.push(t.clause(r(s[n]),r(s[l])));return o}else if(!a&&s.length===3){var h=s[0],g=s[1],d=s[2];return[t.clause(h,g),t.clause(h,d),t.clause(g,d)]}else{var A=group(s,3),S=_$1.map(A,function(I){return Logic.or(I)});A[A.length-1].length<2&&A.pop();var O=_$1.map(A,function(I){return Logic.atMostOne(I)});return t.generate(a,Logic.and(Logic.atMostOne(S),O))}}});Logic.implies=function(a,t){return assert$1&&assertNumArgs(arguments.length,2,"Logic.implies"),new Logic.ImpliesFormula(a,t)};Logic.ImpliesFormula=function(a,t){assert$1&&assert$1(a,isFormulaOrTerm),assert$1&&assert$1(t,isFormulaOrTerm),assert$1&&assertNumArgs(arguments.length,2,"Logic.implies"),this.A=a,this.B=t};Logic._defineFormula(Logic.ImpliesFormula,"implies",{generateClauses:function(a,t){return t.generate(a,Logic.or(Logic.not(this.A),this.B))}});Logic.equiv=function(a,t){return assert$1&&assertNumArgs(arguments.length,2,"Logic.equiv"),new Logic.EquivFormula(a,t)};Logic.EquivFormula=function(a,t){assert$1&&assert$1(a,isFormulaOrTerm),assert$1&&assert$1(t,isFormulaOrTerm),assert$1&&assertNumArgs(arguments.length,2,"Logic.equiv"),this.A=a,this.B=t};Logic._defineFormula(Logic.EquivFormula,"equiv",{generateClauses:function(a,t){return t.generate(!a,Logic.xor(this.A,this.B))}});Logic.exactlyOne=function(){var a=_$1.flatten(arguments);return a.length===0?Logic.FALSE:a.length===1?(assert$1&&assert$1(a[0],isFormulaOrTerm),a[0]):new Logic.ExactlyOneFormula(a)};Logic.ExactlyOneFormula=function(a){assert$1&&assert$1(a,isArrayWhere(isFormulaOrTerm)),this.operands=a};Logic._defineFormula(Logic.ExactlyOneFormula,"exactlyOne",{generateClauses:function(a,t){var s=this.operands;return s.length<3?t.generate(a,Logic.xor(s)):t.generate(a,Logic.and(Logic.atMostOne(s),Logic.or(s)))}});Logic.Bits=function(a){assert$1&&assert$1(a,isArrayWhere(isFormulaOrTerm)),this.bits=a};Logic.constantBits=function(a){assert$1&&assert$1(a,Logic.isWholeNumber);for(var t=[];a;)t.push(a&1?Logic.TRUE:Logic.FALSE),a>>>=1;return new Logic.Bits(t)};Logic.variableBits=function(a,t){assert$1&&assert$1(t,Logic.isWholeNumber);for(var s=[],r=0;r<t;r++)s.push(a+"$"+r);return new Logic.Bits(s)};Logic.lessThanOrEqual=function(a,t){return new Logic.LessThanOrEqualFormula(a,t)};Logic.LessThanOrEqualFormula=function(a,t){assert$1&&assert$1(a,Logic.isBits),assert$1&&assert$1(t,Logic.isBits),assert$1&&assertNumArgs(arguments.length,2,"Bits comparison function"),this.bits1=a,this.bits2=t};var genLTE=function(a,t,s,r){var o=[],n=a.bits.slice(),l=t.bits.slice();if(r&&!t.bits.length)return s.clause();for(;n.length>l.length;){var h=n.pop();o.push(s.clause(Logic.not(h)))}for(var g=_$1.map(l,function(A,S){return S<n.length?Logic.xor(n[S],A):A}),d=n.length-1;d>=0;d--)o.push(s.clause(g.slice(d+1),Logic.not(n[d]),l[d]));return r&&o.push.apply(o,s.generate(!0,Logic.or(g))),o};Logic._defineFormula(Logic.LessThanOrEqualFormula,"lte",{generateClauses:function(a,t){return a?genLTE(this.bits1,this.bits2,t,!1):genLTE(this.bits2,this.bits1,t,!0)}});Logic.lessThan=function(a,t){return new Logic.LessThanFormula(a,t)};Logic.LessThanFormula=function(a,t){assert$1&&assert$1(a,Logic.isBits),assert$1&&assert$1(t,Logic.isBits),assert$1&&assertNumArgs(arguments.length,2,"Bits comparison function"),this.bits1=a,this.bits2=t};Logic._defineFormula(Logic.LessThanFormula,"lt",{generateClauses:function(a,t){return a?genLTE(this.bits1,this.bits2,t,!0):genLTE(this.bits2,this.bits1,t,!1)}});Logic.greaterThan=function(a,t){return Logic.lessThan(t,a)};Logic.greaterThanOrEqual=function(a,t){return Logic.lessThanOrEqual(t,a)};Logic.equalBits=function(a,t){return new Logic.EqualBitsFormula(a,t)};Logic.EqualBitsFormula=function(a,t){assert$1&&assert$1(a,Logic.isBits),assert$1&&assert$1(t,Logic.isBits),assert$1&&assertNumArgs(arguments.length,2,"Logic.equalBits"),this.bits1=a,this.bits2=t};Logic._defineFormula(Logic.EqualBitsFormula,"equalBits",{generateClauses:function(a,t){for(var s=this.bits1.bits,r=this.bits2.bits,o=Math.max(s.length,r.length),n=[],l=0;l<o;l++)l>=s.length?n.push(Logic.not(r[l])):l>=r.length?n.push(Logic.not(s[l])):n.push(Logic.equiv(s[l],r[l]));return t.generate(a,Logic.and(n))}});Logic.HalfAdderSum=function(a,t){assert$1&&assert$1(a,isFormulaOrTerm),assert$1&&assert$1(t,isFormulaOrTerm),assert$1&&assertNumArgs(arguments.length,2,"Logic.HalfAdderSum"),this.a=a,this.b=t};Logic._defineFormula(Logic.HalfAdderSum,"hsum",{generateClauses:function(a,t){return t.generate(a,Logic.xor(this.a,this.b))}});Logic.HalfAdderCarry=function(a,t){assert$1&&assert$1(a,isFormulaOrTerm),assert$1&&assert$1(t,isFormulaOrTerm),assert$1&&assertNumArgs(arguments.length,2,"Logic.HalfAdderCarry"),this.a=a,this.b=t};Logic._defineFormula(Logic.HalfAdderCarry,"hcarry",{generateClauses:function(a,t){return t.generate(a,Logic.and(this.a,this.b))}});Logic.FullAdderSum=function(a,t,s){assert$1&&assert$1(a,isFormulaOrTerm),assert$1&&assert$1(t,isFormulaOrTerm),assert$1&&assert$1(s,isFormulaOrTerm),assert$1&&assertNumArgs(arguments.length,3,"Logic.FullAdderSum"),this.a=a,this.b=t,this.c=s};Logic._defineFormula(Logic.FullAdderSum,"fsum",{generateClauses:function(a,t){return t.generate(a,Logic.xor(this.a,this.b,this.c))}});Logic.FullAdderCarry=function(a,t,s){assert$1&&assert$1(a,isFormulaOrTerm),assert$1&&assert$1(t,isFormulaOrTerm),assert$1&&assert$1(s,isFormulaOrTerm),assert$1&&assertNumArgs(arguments.length,3,"Logic.FullAdderCarry"),this.a=a,this.b=t,this.c=s};Logic._defineFormula(Logic.FullAdderCarry,"fcarry",{generateClauses:function(a,t){return t.generate(!a,Logic.atMostOne(this.a,this.b,this.c))}});var binaryWeightedSum=function(a){assert$1&&assert$1(a,isArrayWhere(isArrayWhere(isFormulaOrTerm)));for(var t=_$1.map(a,_$1.clone),s=0,r=[];s<t.length;){var o=t[s];if(!o.length)r.push(Logic.FALSE),s++;else if(o.length===1)r.push(o[0]),s++;else if(o.length===2){var n=new Logic.HalfAdderSum(o[0],o[1]),l=new Logic.HalfAdderCarry(o[0],o[1]);o.length=0,o.push(n),pushToNth(t,s+1,l)}else{var h=o.pop(),g=o.pop(),d=o.pop(),n=new Logic.FullAdderSum(d,g,h),l=new Logic.FullAdderCarry(d,g,h);o.push(n),pushToNth(t,s+1,l)}}return r},pushToNth=function(a,t,s){for(;t>=a.length;)a.push([]);a[t].push(s)},checkWeightedSumArgs=function(a,t){if(assert$1&&assert$1(a,isArrayWhere(isFormulaOrTerm)),typeof t=="number")assert$1&&assert$1(t,Logic.isWholeNumber);else if(assert$1&&assert$1(t,isArrayWhere(Logic.isWholeNumber)),a.length!==t.length)throw new Error("Formula array and weight array must be same length; they are "+a.length+" and "+t.length)};Logic.weightedSum=function(a,t){if(checkWeightedSumArgs(a,t),a.length===0)return new Logic.Bits([]);typeof t=="number"&&(t=_$1.map(a,function(){return t}));var s=[];return _$1.each(a,function(r,o){for(var n=t[o],l=0;n;)n&1&&pushToNth(s,l,r),n>>>=1,l++}),new Logic.Bits(binaryWeightedSum(s))};Logic.sum=function(){var a=_$1.flatten(arguments);assert$1&&assert$1(a,isArrayWhere(isFormulaOrTermOrBits));var t=[];return _$1.each(a,function(s){s instanceof Logic.Bits?_$1.each(s.bits,function(r,o){pushToNth(t,o,r)}):pushToNth(t,0,s)}),new Logic.Bits(binaryWeightedSum(t))};Logic.Solver.prototype.solve=function(a){var t=this;if(a!==void 0&&!(a>=1))throw new Error("_assumpVar must be a variable number");if(t._unsat)return null;for(;t._numClausesAddedToMiniSat<t.clauses.length;){var s=t._numClausesAddedToMiniSat,r=t.clauses[s].terms;assert$1&&assert$1(r,isArrayWhere(Logic.isNumTerm));var o=t._minisat.addClause(r);if(t._numClausesAddedToMiniSat++,!o)return t._unsat=!0,null}assert$1&&assert$1(this._num2name.length-1,Logic.isWholeNumber),t._minisat.ensureVar(this._num2name.length-1);var o=a?t._minisat.solveAssuming(a):t._minisat.solve();return o?new Logic.Solution(t,t._minisat.getSolution()):(a||(t._unsat=!0),null)};Logic.Solver.prototype.solveAssuming=function(a){assert$1&&assert$1(a,isFormulaOrTerm);var t=new Logic.Assumption(a),s=this._formulaToTerm(t);if(!(typeof s=="number"&&s>0))throw new Error("Assertion failure: not a positive numeric term");this._useFormulaTerm(s);var r=this.solve(s);return this._minisat.retireVar(s),r};Logic.Assumption=function(a){assert$1&&assert$1(a,isFormulaOrTerm),this.formula=a};Logic._defineFormula(Logic.Assumption,"assump",{generateClauses:function(a,t){return a?t.clause(this.formula):t.clause(Logic.not(this.formula))}});Logic.Solution=function(a,t){var s=this;s._solver=a,s._assignment=t,s._ungeneratedFormulas=_$1.clone(a._ungeneratedFormulas),s._formulaValueCache={},s._termifier=new Logic.Termifier(s._solver),s._termifier.term=function(r){return s.evaluate(r)?Logic.NUM_TRUE:Logic.NUM_FALSE},s._ignoreUnknownVariables=!1};Logic.Solution.prototype.ignoreUnknownVariables=function(){this._ignoreUnknownVariables=!0};Logic.Solution.prototype.getMap=function(){for(var a=this._solver,t=this._assignment,s={},r=1;r<t.length;r++){var o=a.getVarName(r);o&&o.charAt(0)!=="$"&&(s[o]=t[r])}return s};Logic.Solution.prototype.getTrueVars=function(){for(var a=this._solver,t=this._assignment,s=[],r=1;r<t.length;r++)if(t[r]){var o=a.getVarName(r);o&&o.charAt(0)!=="$"&&s.push(o)}return s.sort(),s};Logic.Solution.prototype.getFormula=function(){for(var a=this._solver,t=this._assignment,s=[],r=1;r<t.length;r++){var o=a.getVarName(r);o&&o.charAt(0)!=="$"&&s.push(t[r]?r:-r)}return Logic.and(s)};Logic.Solution.prototype.evaluate=function(a){var t=this;if(assert$1&&assert$1(a,isFormulaOrTermOrBits),a instanceof Logic.Bits){var s=0;return _$1.each(a.bits,function(L,H){t.evaluate(L)&&(s+=1<<H)}),s}var r=t._solver,o=t._ignoreUnknownVariables,n=t._assignment,l=a;if(l instanceof Logic.NotFormula)return!t.evaluate(l.operand);if(l instanceof Logic.Formula){var h=t._formulaValueCache[l.guid()];if(typeof h=="boolean")return h;var g,d=r._getFormulaInfo(l,!0);if(d&&d.varNum&&d.varNum<n.length&&!_$1.has(t._ungeneratedFormulas,d.varNum))g=n[d.varNum];else var A=r._generateFormula(!0,l,t._termifier),g=_$1.some(A,function(H){return _$1.any(H.terms,function(Y){return t.evaluate(Y)})});return t._formulaValueCache[l.guid()]=g,g}else{var S=r.toNumTerm(l,!0);if(!S){if(o)return!1;var O=String(l).replace(/^-*/,"");throw new Error("No such variable: "+O)}var I=S,W=!1;if(S<0&&(I=-I,W=!0),I<1||I>=n.length){var O=I;if(I>=1&&I<r._num2name.length&&(O=r._num2name[I]),o)return!1;throw new Error("Variable not part of solution: "+O)}var s=n[I];return W&&(s=!s),s}};Logic.Solution.prototype.getWeightedSum=function(a,t){checkWeightedSumArgs(a,t);var s=0;if(typeof t=="number")for(var r=0;r<a.length;r++)s+=t*(this.evaluate(a[r])?1:0);else for(var r=0;r<a.length;r++)s+=t[r]*(this.evaluate(a[r])?1:0);return s};var getNonZeroWeightedTerms=function(a,t){if(typeof t=="number")return t?a:[];for(var s=[],r=0;r<a.length;r++)t[r]&&s.push(a[r]);return s},minMaxWS=function(a,t,s,r,o,n){var l=t,h=l.getWeightedSum(s,r),g=o&&o.formula,d=g||Logic.weightedSum(s,r),A=o&&o.progress,S=o&&o.strategy,O=null;if(n&&h>0){A&&A("trying",0);var I=null;O=getNonZeroWeightedTerms(s,r);var I=a.solveAssuming(Logic.not(Logic.or(O)));I&&(l=I,h=0)}if(n&&S==="bottom-up")for(var W=1;W<h;W++){A&&A("trying",W);var L=Logic.equalBits(d,Logic.constantBits(W)),H=a.solveAssuming(L);if(H){l=H,h=W;break}}else{if(S&&S!=="default")throw new Error("Bad strategy: "+S);S="default"}if(S==="default")for(;!n||h>0;){A&&A("improving",h);var Y=(n?Logic.lessThan:Logic.greaterThan)(d,Logic.constantBits(h)),H=a.solveAssuming(Y);if(!H)break;a.require(Y),l=H,h=l.getWeightedSum(s,r)}return n&&h===0?(O||(O=getNonZeroWeightedTerms(s,r)),a.forbid(O)):a.require(Logic.equalBits(d,Logic.constantBits(h))),A&&A("finished",h),l};Logic.Solver.prototype.minimizeWeightedSum=function(a,t,s,r){return minMaxWS(this,a,t,s,r,!0)};Logic.Solver.prototype.maximizeWeightedSum=function(a,t,s,r){return minMaxWS(this,a,t,s,r,!1)};const Logic$1=Logic;class MultipleSolutionsError extends Error{constructor(t){super("Multiple solutions found"),this.solutionEdges=t}}class MaximumSolverIterationsError extends Error{constructor(){super("Too many iterations!")}}const getSolvedPuzzle=(a,t,s)=>{const r=t.clone();for(const o of s)r.setEdgeState(o,EdgeState.BLACK);return finalStateSolve(a,r),{board:a,cleanState:t,solvedState:r,blackEdges:new Set(s)}},getSolvablePropertyPuzzle=(a,t)=>{try{if(simpleRegionIsSolved(t))return{board:a,stateProperty:new Property(t),solution:getSolvedPuzzle(a,t,[])};const s=satSolve(a,t,{maxIterations:1e4,failOnMultipleSolutions:!0});if(s.length!==1)return null;const r=s[0],o=t.clone();for(const n of r)o.setEdgeState(n,EdgeState.BLACK);return finalStateSolve(a,o),assertEnabled()&&assert$2(simpleRegionIsSolved(o)),{board:a,stateProperty:new Property(t),solution:getSolvedPuzzle(a,t,r)}}catch(s){if(s instanceof MultipleSolutionsError)return null;throw s}},satSolve=(a,t,s)=>{const r=a.edges.filter(Le=>t.getEdgeState(Le)===EdgeState.BLACK),o=a.edges.filter(Le=>t.getEdgeState(Le)===EdgeState.WHITE);assertEnabled()&&assert$2(o.length,"Need to have at least some undefined edges to use solver");const n=new Set(o),l=new Map(o.map((Le,Z)=>[Le,`edge${Z+1}`])),h=new Map(o.map((Le,Z)=>[`edge${Z+1}`,Le])),g=new Logic$1.Solver,d=Le=>{const Z=l.get(Le);return assertEnabled()&&assert$2(Z!==void 0,"Edge not found!"),Z},A=Le=>`-${d(Le)}`,S=Le=>{for(const Z of Le)g.require(Logic$1.not(d(Z)))},O=Le=>{g.require(Logic$1.or(...Le.map(d)))},I=Le=>{g.require(Logic$1.or(...Le.map(A)))},W=(Le,Z)=>{Z>0&&(O(Le),Combination.forEachCombination(Le,ne=>{ne.length===Le.length-Z+1&&g.require(Logic$1.not(Logic$1.and(...ne.map(A))))}))},L=(Le,Z)=>{Combination.forEachCombination(Le,ne=>{ne.length===Z+1&&g.require(Logic$1.or(...ne.map(A)))})},H=Le=>{g.require(Logic$1.not(Logic$1.exactlyOne(...Le.map(d))))},Y=Le=>{L(Le,2),H(Le)},Q=(Le,Z)=>{Z===0?S(Le):(W(Le,Z),L(Le,Z))};O(o);for(const Le of a.vertices){let Z=0,ne=0,Ke=[];for(const _t of Le.edges){const xe=t.getEdgeState(_t);xe===EdgeState.BLACK?Z++:xe===EdgeState.WHITE&&(ne++,Ke.push(_t))}ne!==0&&(Z===0?Y(Ke):Z===1?Q(Ke,1):S(Ke))}let pe=!1;for(const Le of a.faces){const Z=t.getFaceValue(Le);if(Z===null)continue;pe=!0;let ne=0,Ke=0,_t=[];for(const Ct of Le.edges){const zt=t.getEdgeState(Ct);zt===EdgeState.BLACK?ne++:zt===EdgeState.WHITE&&(Ke++,_t.push(Ct))}if(Ke===0)continue;const xe=Math.max(Z-ne,0);Q(_t,xe)}assertEnabled()&&assert$2(pe,"No faces with values!");const de=()=>{let Le=null;return Logic$1.disablingAssertions(()=>{Le=g.solve()}),Le?Le.getTrueVars().map(ne=>h.get(ne)):null};let fe=0;const ye=()=>{const Le=de();if(Le===null)return{touchingValueLoops:[],nonTouchingValueLoops:[]};const Z=new Set([...Le,...r]),ne=[],Ke=[];for(;Z.size;){const _t=Z.values().next().value,xe=[];let Ct=_t.end,zt=_t,Je=!1;for(;zt;)Z.delete(zt),xe.push(zt),Je=Je||zt.faces.some(Et=>t.getFaceValue(Et)!==null),zt=Ct.edges.find(Et=>Z.has(Et))??null,zt&&(Ct=zt.getOtherVertex(Ct));assertEnabled()&&assert$2(xe[0].vertices.some(Et=>xe[xe.length-1].vertices.includes(Et)),"Loop is not a loop!"),(Je?ne:Ke).push(xe)}return{touchingValueLoops:ne,nonTouchingValueLoops:Ke}},Ee=[];for(;;){const Le=ye();if(!Le.touchingValueLoops.length)break;if(Le.touchingValueLoops.length===1&&(Ee.push(Le.touchingValueLoops[0]),Ee.length>1&&s.failOnMultipleSolutions))throw new MultipleSolutionsError(Ee);const Z=[...Le.touchingValueLoops,...Le.nonTouchingValueLoops];for(const ne of Z)I(ne.filter(Ke=>n.has(Ke)));if(fe++,fe>s.maxIterations)throw new MaximumSolverIterationsError}return Ee};class EdgeStateValidator{constructor(t,s,r){gt(this,"edgeStateChangedEmitter",new TinyEmitter);this.board=t,this.currentState=s,this.solvedState=r}getEdgeState(t){return this.currentState.getEdgeState(t)}setEdgeState(t,s){if(assertEnabled()&&assert$2(this.board.edges.includes(t)),s!==EdgeState.WHITE){const r=this.solvedState.getEdgeState(t);if(s!==r)throw new InvalidStateError(`Attempt to make edge ${s} when it should be ${r}`)}}clone(){return this}createDelta(){return this}serializeState(t){throw new Error("unimplemented")}}class FaceColorValidator{constructor(t,s,r){gt(this,"faceColorsChangedEmitter",new TinyEmitter);this.board=t,this.currentState=s,this.solvedState=r}getFaceColors(){return this.currentState.getFaceColors()}getInsideColor(){return this.currentState.getInsideColor()}getOutsideColor(){return this.currentState.getOutsideColor()}getFaceColor(t){return this.currentState.getFaceColor(t)}getFacesWithColor(t){return this.currentState.getFacesWithColor(t)}getFaceColorMap(){return this.currentState.getFaceColorMap()}getOppositeFaceColor(t){return this.currentState.getOppositeFaceColor(t)}hasInvalidFaceColors(){return this.currentState.hasInvalidFaceColors()}modifyFaceColors(t,s,r,o,n){if(n)throw new InvalidStateError("invalid face color?");const l=new Set([...r.values(),...o.keys(),...r.values()]),h=new Map(this.currentState.getFaceColorMap());for(const A of r.keys())h.set(A,r.get(A));const g=A=>o.has(A)?o.get(A):[...t].includes(A)?this.currentState.getOppositeFaceColor(A):null,d=new Map;for(const A of h.keys()){const S=h.get(A);d.has(S)||d.set(S,new Set([A])),d.get(S).add(A)}for(const A of l){const S=d.get(A);if(!S)continue;const O=[...S];assertEnabled()&&assert$2(O.length>0);const I=this.solvedState.getFaceColor(O[0]);for(const L of O)if(this.solvedState.getFaceColor(L)!==I)throw new InvalidStateError("invalid face color");const W=g(A);if(W){let L;if(W.colorState===FaceColorState.INSIDE?L=this.solvedState.getInsideColor():W.colorState===FaceColorState.OUTSIDE?L=this.solvedState.getOutsideColor():L=this.solvedState.getFaceColor([...d.get(W)][0]),I===L)throw new InvalidStateError("opposite colors are the same")}}}clone(){return this}createDelta(){return this}serializeState(t){throw new Error("unimplemented")}}class SimpleRegionValidator{constructor(t,s,r){gt(this,"simpleRegionsChangedEmitter",new TinyEmitter);this.board=t,this.currentState=s,this.solvedState=r}getSimpleRegions(){return this.currentState.getSimpleRegions()}getSimpleRegionWithVertex(t){return this.currentState.getSimpleRegionWithVertex(t)}getSimpleRegionWithEdge(t){return this.currentState.getSimpleRegionWithEdge(t)}getSimpleRegionWithId(t){return this.currentState.getSimpleRegionWithId(t)}getWeirdEdges(){return this.currentState.getWeirdEdges()}modifyRegions(t,s,r,o){if([...r].length)throw new InvalidStateError("weird edges added")}clone(){return this}createDelta(){return this}serializeState(t){throw new Error("unimplemented")}}class FaceValueValidator{constructor(t,s,r){gt(this,"faceValueChangedEmitter",new TinyEmitter);this.board=t,this.currentState=s,this.solvedState=r}getFaceValue(t){return this.currentState.getFaceValue(t)}setFaceValue(t,s){if(this.solvedState.getFaceValue(t)!==s)throw new InvalidStateError("invalid face state")}clone(){return this}createDelta(){return this}serializeState(t){throw new Error("unimplemented")}}class SectorStateValidator{constructor(t,s,r){gt(this,"sectorStateChangedEmitter",new TinyEmitter);this.board=t,this.currentState=s,this.solvedState=r}getSectorState(t){return this.currentState.getSectorState(t)}setSectorState(t,s){assertEnabled()&&assert$2(this.board.halfEdges.includes(t));const r=this.solvedState.getSectorState(t);if(!r.isSubsetOf(s))throw new InvalidStateError(`Attempt to make sector ${s} when it should be ${r}`)}clone(){return this}createDelta(){return this}serializeState(t){throw new Error("unimplemented")}}class VertexStateValidator{constructor(t,s,r){gt(this,"vertexStateChangedEmitter",new TinyEmitter);this.board=t,this.currentState=s,this.solvedState=r}getVertexState(t){return this.currentState.getVertexState(t)}setVertexState(t,s){assertEnabled()&&assert$2(this.board.vertices.includes(t));const r=this.solvedState.getVertexState(t);if(!r.isSubsetOf(s))throw new InvalidStateError(`Attempt to make vertex ${s} when it should be ${r}`);const o=this.currentState.getVertexState(t);if(!s.isSubsetOf(o))throw new InvalidStateError("Do not generalize vertex state")}clone(){return this}createDelta(){return this}serializeState(t){throw new Error("unimplemented")}}class FaceStateValidator{constructor(t,s,r){gt(this,"faceStateChangedEmitter",new TinyEmitter);this.board=t,this.currentState=s,this.solvedState=r}getFaceState(t){return this.currentState.getFaceState(t)}setFaceState(t,s){assertEnabled()&&assert$2(this.board.faces.includes(t));const r=this.solvedState.getFaceState(t);if(!r.isSubsetOf(s))throw new InvalidStateError(`Attempt to make face ${s} when it should be ${r}`);const o=this.currentState.getFaceState(t);if(!s.isSubsetOf(o))throw new InvalidStateError("Do not generalize face state")}clone(){return this}createDelta(){return this}serializeState(t){throw new Error("unimplemented")}}class CompleteValidator{constructor(t,s,r){gt(this,"anyStateChangedEmitter",new TinyEmitter);gt(this,"edgeStateValidator");gt(this,"faceValueValidator");gt(this,"simpleRegionDataValidator");gt(this,"faceColorValidator");gt(this,"sectorStateValidator");gt(this,"vertexStateValidator");gt(this,"faceStateValidator");assertEnabled()&&assert$2(t),assertEnabled()&&assert$2(r),this.edgeStateValidator=new EdgeStateValidator(t,s,r),this.faceValueValidator=new FaceValueValidator(t,s,r),this.simpleRegionDataValidator=new SimpleRegionValidator(t,s,r),this.faceColorValidator=new FaceColorValidator(t,s,r),this.sectorStateValidator=new SectorStateValidator(t,s,r),this.vertexStateValidator=new VertexStateValidator(t,s,r),this.faceStateValidator=new FaceStateValidator(t,s,r)}getFaceValue(t){return this.faceValueValidator.getFaceValue(t)}setFaceValue(t,s){this.faceValueValidator.setFaceValue(t,s)}get faceValueChangedEmitter(){return this.faceValueValidator.faceValueChangedEmitter}getEdgeState(t){return this.edgeStateValidator.getEdgeState(t)}setEdgeState(t,s){this.edgeStateValidator.setEdgeState(t,s)}get edgeStateChangedEmitter(){return this.edgeStateValidator.edgeStateChangedEmitter}getSimpleRegions(){return this.simpleRegionDataValidator.getSimpleRegions()}getSimpleRegionWithVertex(t){return this.simpleRegionDataValidator.getSimpleRegionWithVertex(t)}getSimpleRegionWithEdge(t){return this.simpleRegionDataValidator.getSimpleRegionWithEdge(t)}getSimpleRegionWithId(t){return this.simpleRegionDataValidator.getSimpleRegionWithId(t)}getWeirdEdges(){return this.simpleRegionDataValidator.getWeirdEdges()}modifyRegions(t,s,r,o){this.simpleRegionDataValidator.modifyRegions(t,s,r,o)}get simpleRegionsChangedEmitter(){return this.simpleRegionDataValidator.simpleRegionsChangedEmitter}getFaceColors(){return this.faceColorValidator.getFaceColors()}getInsideColor(){return this.faceColorValidator.getInsideColor()}getOutsideColor(){return this.faceColorValidator.getOutsideColor()}getFaceColor(t){return this.faceColorValidator.getFaceColor(t)}getFacesWithColor(t){return this.faceColorValidator.getFacesWithColor(t)}getFaceColorMap(){return this.faceColorValidator.getFaceColorMap()}getOppositeFaceColor(t){return this.faceColorValidator.getOppositeFaceColor(t)}hasInvalidFaceColors(){return this.faceColorValidator.hasInvalidFaceColors()}modifyFaceColors(t,s,r,o,n){this.faceColorValidator.modifyFaceColors(t,s,r,o,n)}get faceColorsChangedEmitter(){return this.faceColorValidator.faceColorsChangedEmitter}getSectorState(t){return this.sectorStateValidator.getSectorState(t)}setSectorState(t,s){this.sectorStateValidator.setSectorState(t,s)}get sectorStateChangedEmitter(){return this.sectorStateValidator.sectorStateChangedEmitter}getVertexState(t){return this.vertexStateValidator.getVertexState(t)}setVertexState(t,s){this.vertexStateValidator.setVertexState(t,s)}get vertexStateChangedEmitter(){return this.vertexStateValidator.vertexStateChangedEmitter}getFaceState(t){return this.faceStateValidator.getFaceState(t)}setFaceState(t,s){this.faceStateValidator.setFaceState(t,s)}get faceStateChangedEmitter(){return this.faceStateValidator.faceStateChangedEmitter}clone(){return this}createDelta(){return this}serializeState(t){throw new Error("unimplemented")}}const annotationSetsEdgeState=a=>a.type==="ForcedLine"||a.type==="AlmostEmptyToRed"||a.type==="JointToRed"||a.type==="FaceSatisfied"||a.type==="FaceAntiSatisfied"||a.type==="ForcedSolveLoop"||a.type==="PrematureForcedLoop"||a.type==="CompletingEdgesAfterSolve"||a.type==="FaceColorToBlack"||a.type==="FaceColorToRed"||a.type==="FaceColorNoTrivialLoop"||a.type==="FaceColorMatchToRed"||a.type==="FaceColorMatchToBlack"||a.type==="DoubleMinusOneFaces"||a.type==="ForcedSector"||a.type==="VertexStateToEdge"||a.type==="FaceStateToEdge",annotationSetsFaceColor=a=>a.type==="InvalidFaceColoring"||a.type==="GeneralFaceColoring"||a.type==="FaceColoringBlackEdge"||a.type==="FaceColoringRedEdge"||a.type==="FaceColorBalance"||a.type==="VertexStateToSameFaceColor"||a.type==="VertexStateToOppositeFaceColor"||a.type==="FaceStateToSameFaceColor"||a.type==="FaceStateToOppositeFaceColor",annotationSetsSectorState=a=>a.type==="SingleEdgeToSector"||a.type==="DoubleEdgeToSector"||a.type==="StaticFaceSectors"||a.type==="VertexStateToSector"||a.type==="FaceStateToSector",annotationSetsVertexState=a=>a.type==="VertexState"||a.type==="FaceStateToVertexState",annotationSetsFaceState=a=>a.type==="FaceState",isAnnotationDisplayedForStyle=(a,t)=>!!(annotationSetsEdgeState(a)||t.faceColorsVisibleProperty.value&&isFinite(t.faceColorThresholdProperty.value)&&annotationSetsFaceColor(a)||t.sectorsVisibleProperty.value&&annotationSetsSectorState(a)||t.vertexStateVisibleProperty.value&&annotationSetsVertexState(a)||t.faceStateVisibleProperty.value&&annotationSetsFaceState(a)),wn=class wn extends EnumerationValue{constructor(t,s,r){super(),this.fromWhite=t,this.fromBlack=s,this.fromRed=r}apply(t){return t===EdgeState.WHITE?this.fromWhite:t===EdgeState.BLACK?this.fromBlack:this.fromRed}};gt(wn,"CYCLE",new wn(EdgeState.BLACK,EdgeState.RED,EdgeState.WHITE)),gt(wn,"REVERSE_CYCLE",new wn(EdgeState.RED,EdgeState.WHITE,EdgeState.BLACK)),gt(wn,"WHITE_SET",new wn(EdgeState.WHITE,EdgeState.WHITE,EdgeState.WHITE)),gt(wn,"BLACK_SET",new wn(EdgeState.BLACK,EdgeState.BLACK,EdgeState.BLACK)),gt(wn,"RED_SET",new wn(EdgeState.RED,EdgeState.RED,EdgeState.RED)),gt(wn,"BLACK_TOGGLE",new wn(EdgeState.BLACK,EdgeState.WHITE,EdgeState.BLACK)),gt(wn,"RED_TOGGLE",new wn(EdgeState.RED,EdgeState.RED,EdgeState.WHITE)),gt(wn,"enumeration",new Enumeration(wn));let EdgePressStyle=wn;const pressStyle0Property=new LocalStorageEnumerationProperty("pressStyle0",EdgePressStyle.CYCLE),pressStyle1Property=new LocalStorageEnumerationProperty("pressStyle1",EdgePressStyle.WHITE_SET),pressStyle2Property=new LocalStorageEnumerationProperty("pressStyle2",EdgePressStyle.REVERSE_CYCLE),getPressStyle=a=>{switch(a){case 0:return pressStyle0Property.value;case 1:return pressStyle1Property.value;case 2:return pressStyle2Property.value}},getFaceColorPointer=(a,t)=>{if(t.colorState===FaceColorState.OUTSIDE)return{type:"absolute",isOutside:!0};if(t.colorState===FaceColorState.INSIDE)return{type:"absolute",isOutside:!1};{const s=[...a.getFacesWithColor(t)][0];return assertEnabled()&&assert$2(s),{type:"face",face:s}}},dereferenceFaceColorPointer=(a,t)=>t.type==="face"?a.getFaceColor(t.face):t.isOutside?a.getOutsideColor():a.getInsideColor();class FaceColorMakeSameAction{constructor(t,s){this.a=t,this.b=s,assertEnabled()&&assert$2(t),assertEnabled()&&assert$2(s)}apply(t){const s=dereferenceFaceColorPointer(t,this.a),r=dereferenceFaceColorPointer(t,this.b);if(s===r)return;const o=t.getOppositeFaceColor(s),n=t.getOppositeFaceColor(r);if(assertEnabled()){const O=new Set(t.getFaceColors());assert$2(O.has(s)),assert$2(O.has(r)),o&&assert$2(O.has(o)),n&&assert$2(O.has(n))}if(o&&o===r||n&&n===s){t.modifyFaceColors([],[],new Map,new Map,!0);return}const l=[],h=new Map,g=new Map,d=FaceColorMakeSameAction.combineFaces(s,r,t,l,h),A=o&&n?FaceColorMakeSameAction.combineFaces(o,n,t,l,h):o||n;d===s&&A===o||d===r&&A===n||(g.set(d,A),A&&g.set(A,d)),t.modifyFaceColors([],l,h,g,!1)}getUndo(t){throw new Error("getUndo unimplemented in FaceColorMakeSameAction")}isEmpty(){return!1}serializeAction(){throw new Error("serializeAction unimplemented in FaceColorMakeSameAction")}static deserializeAction(t,s){throw new Error("deserializeAction unimplemented in FaceColorMakeSameAction")}static combineFaces(t,s,r,o,n){let l=null;if(t.colorState!==FaceColorState.UNDECIDED)l=s;else if(s.colorState!==FaceColorState.UNDECIDED)l=t;else{const g=r.getFacesWithColor(t),d=r.getFacesWithColor(s);l=g.length>d.length?s:t}const h=l===t?s:t;o.push(l);for(const g of r.getFacesWithColor(l))n.set(g,h);return h}}class FaceColorMakeOppositeAction{constructor(t,s){this.a=t,this.b=s,assertEnabled()&&assert$2(t),assertEnabled()&&assert$2(s)}apply(t){const s=dereferenceFaceColorPointer(t,this.a),r=dereferenceFaceColorPointer(t,this.b);if(s===r){t.modifyFaceColors([],[],new Map,new Map,!0);return}const o=t.getOppositeFaceColor(s),n=t.getOppositeFaceColor(r);if(assertEnabled()){const S=new Set(t.getFaceColors());assert$2(S.has(s)),assert$2(S.has(r)),o&&assert$2(S.has(o)),n&&assert$2(S.has(n))}if(o&&o===r||n&&n===s)return;if(o&&o===n){t.modifyFaceColors([],[],new Map,new Map,!0);return}const l=[],h=new Map,g=new Map,d=n?FaceColorMakeSameAction.combineFaces(s,n,t,l,h):s,A=o?FaceColorMakeSameAction.combineFaces(r,o,t,l,h):r;g.set(d,A),g.set(A,d),t.modifyFaceColors([],l,h,g,!1)}getUndo(t){throw new Error("getUndo unimplemented in FaceColorMakeOppositeAction")}isEmpty(){return!1}serializeAction(){throw new Error("serializeAction unimplemented in FaceColorMakeOppositeAction")}static deserializeAction(t,s){throw new Error("deserializeAction unimplemented in FaceColorMakeOppositeAction")}}class SectorStateSetAction{constructor(t,s){this.sector=t,this.state=s}apply(t){t.setSectorState(this.sector,this.state)}getUndo(t){const s=t.getSectorState(this.sector);return new SectorStateSetAction(this.sector,s)}isEmpty(){return!1}serializeAction(){return{type:"SectorStateSetAction",sector:serializeHalfEdge(this.sector),state:this.state.serialize()}}static deserializeAction(t,s){return new SectorStateSetAction(deserializeHalfEdge(t,s.sector),SectorState.deserialize(s.state))}}const uiHintUsesBuiltInSolveProperty=new LocalStorageBooleanProperty("uiHintUsesBuiltInSolve",!1),showUndoRedoAllProperty=new LocalStorageBooleanProperty("showUndoRedoAllProperty",!1);class PuzzleModel extends Disposable{constructor(s,r=currentPuzzleStyle){super();gt(this,"stack");gt(this,"stackLengthProperty",new NumberProperty(0));gt(this,"stackPositionProperty",new NumberProperty(0));gt(this,"undoPossibleProperty");gt(this,"redoPossibleProperty");gt(this,"currentSnapshotProperty");gt(this,"hasErrorProperty");gt(this,"isSolvedProperty");gt(this,"pendingHintActionProperty",new Property(null));gt(this,"displayedAnnotationProperty");gt(this,"pendingActionFaceColorProperty",new Property(null));gt(this,"pendingActionSectorProperty",new Property(null));gt(this,"hoverEdgeProperty",new Property(null));gt(this,"hoverFaceProperty",new Property(!1));gt(this,"hoverSectorProperty",new Property(null));gt(this,"hoverHighlightProperty");gt(this,"selectedFaceColorHighlightProperty");gt(this,"selectedSectorEditProperty");gt(this,"autoSolverFactoryProperty");this.puzzle=s,this.style=r,this.autoSolverFactoryProperty=new DerivedProperty([autoSolveEnabledProperty,r.safeSolverFactoryProperty,r.autoSolverFactoryProperty],(l,h,g)=>l?g:h),this.displayedAnnotationProperty=new DerivedProperty([this.pendingHintActionProperty],l=>l?l.annotation:null);const o=()=>{this.pendingActionFaceColorProperty.value=null,this.pendingActionSectorProperty.value=null};this.stackPositionProperty.lazyLink(o),editModeProperty.lazyLink(o),this.disposeEmitter.addListener(()=>editModeProperty.unlink(o)),this.selectedFaceColorHighlightProperty=new DerivedProperty([s.stateProperty,editModeProperty,this.pendingActionFaceColorProperty],(l,h,g)=>{if((h===EditMode.FACE_COLOR_MATCH||h===EditMode.FACE_COLOR_OPPOSITE)&&g){const d=l.getFacesWithColor(g.color);return{faceColor:g.color,face:g.face,faces:d}}return null}),this.disposeEmitter.addListener(()=>this.selectedFaceColorHighlightProperty.dispose()),this.selectedSectorEditProperty=new DerivedProperty([s.stateProperty,editModeProperty,this.pendingActionSectorProperty],(l,h,g)=>h===EditMode.SECTOR_STATE&&g?{sector:g,currentState:l.getSectorState(g)}:null),this.disposeEmitter.addListener(()=>this.selectedSectorEditProperty.dispose()),this.hoverHighlightProperty=new DerivedProperty([s.stateProperty,editModeProperty,this.hoverEdgeProperty,this.hoverFaceProperty,this.hoverSectorProperty,showHoverHighlightsProperty],(l,h,g,d,A,S)=>{if(h===EditMode.EDGE_STATE||h===EditMode.EDGE_STATE_REVERSED)if(g&&S){const O=l.getEdgeState(g),I=this.getNewEdgeState(O,h===EditMode.EDGE_STATE_REVERSED?2:0);return{type:"edge-state",edge:g,simpleRegion:O===EdgeState.BLACK?l.getSimpleRegionWithEdge(g):null,potentialEdgeState:I}}else return null;else if(h===EditMode.FACE_COLOR_MATCH||h===EditMode.FACE_COLOR_OPPOSITE)if(d!==!1&&S){const O=d?this.puzzle.stateProperty.value.getFaceColor(d):this.puzzle.stateProperty.value.getOutsideColor(),I=this.puzzle.stateProperty.value.getFacesWithColor(O);return{type:"face-color",faceColor:O,face:d,faces:I}}else return null;else return h===EditMode.SECTOR_STATE&&A&&S?{type:"sector",sector:A}:null}),this.disposeEmitter.addListener(()=>this.hoverHighlightProperty.dispose());{const l=s.stateProperty.value.clone();safeSolveWithFactory(s.board,l,this.style.safeSolverFactoryProperty.value),s.stateProperty.value=l}this.stack=[new PuzzleSnapshot(this.puzzle.board,null,s.stateProperty.value)],this.stackLengthProperty.value=1,this.currentSnapshotProperty=new DerivedProperty([this.stackLengthProperty,this.stackPositionProperty],()=>this.stack[this.stackPositionProperty.value]),this.hasErrorProperty=new DerivedProperty([this.currentSnapshotProperty],l=>l.errorDetected),this.isSolvedProperty=new DerivedProperty([this.currentSnapshotProperty],l=>{if(l.state.getWeirdEdges().length||l.state.hasInvalidFaceColors())return!1;const h=l.state.getSimpleRegions();return h.length===1&&h[0].isSolved}),this.addAutoSolveDelta(),this.updateState(),this.undoPossibleProperty=new DerivedProperty([this.stackPositionProperty],l=>l>0),this.redoPossibleProperty=new DerivedProperty([this.stackPositionProperty,this.stackLengthProperty],(l,h)=>l<h-1);const n=()=>this.onAutoSolveChange();this.autoSolverFactoryProperty.lazyLink(n),this.style.safeSolverFactoryProperty.lazyLink(n),this.disposeEmitter.addListener(()=>{this.autoSolverFactoryProperty.unlink(n),this.style.safeSolverFactoryProperty.unlink(n)})}updateState(){this.pendingHintActionProperty.value=null,this.puzzle.stateProperty.value=this.stack[this.stackPositionProperty.value].state,setTimeout(()=>{localStorage.setItem("puzzleString",puzzleToCompressedString(this.puzzle))},0)}wipeStackTop(){for(;this.stack.length>this.stackPositionProperty.value+1;)this.stack.pop();this.stackLengthProperty.value=this.stack.length}pushTransitionAtCurrentPosition(s){this.wipeStackTop(),this.stack.push(s),this.stackLengthProperty.value=this.stack.length,this.stackPositionProperty.value++}applyUserActionToStack(s,r){const o=(r==null?void 0:r.forceDirty)||s instanceof UserLoadPuzzleAutoSolveAction,l=this.stack[this.stackPositionProperty.value].state;let h=!1;const g=new CompleteValidator(this.puzzle.board,l,this.puzzle.solution.solvedState);try{s.apply(g)}catch{h=!0}let d=l.createDelta();try{if(withSolverFactory(this.autoSolverFactoryProperty.value,this.puzzle.board,d,()=>{s.apply(d)},o),r!=null&&r.checkAutoSolve&&!(r!=null&&r.checkAutoSolve(d)))throw new InvalidStateError("Auto-solver did not respect user action")}catch(S){if(h=!0,S instanceof InvalidStateError)console.log("error"),d=l.createDelta(),withSolverFactory(this.style.safeSolverFactoryProperty.value,this.puzzle.board,d,()=>{s.apply(d)},o);else throw S}const A=l.clone();d.apply(A),this.pushTransitionAtCurrentPosition(new PuzzleSnapshot(this.puzzle.board,s,A,h))}addAutoSolveDelta(){const s=this.puzzle.stateProperty.value.createDelta();try{if(iterateSolverFactory(this.autoSolverFactoryProperty.value,this.puzzle.board,s,!0),!s.isEmpty()){const r=this.puzzle.stateProperty.value.clone();s.apply(r),this.pushTransitionAtCurrentPosition(new PuzzleSnapshot(this.puzzle.board,new UserLoadPuzzleAutoSolveAction,r))}}catch(r){if(!(r instanceof InvalidStateError))throw r}}onAutoSolveChange(){const s=this.stack[this.stackPositionProperty.value];s.action&&this.stackPositionProperty.value--,this.applyUserActionToStack(s.action||new UserLoadPuzzleAutoSolveAction,{forceDirty:!0}),this.updateState()}onUserUndo(){this.stackPositionProperty.value>0&&(this.stackPositionProperty.value--,this.updateState())}onUserRedo(){this.stackPositionProperty.value<this.stackLengthProperty.value-1&&(this.stackPositionProperty.value++,this.updateState())}onUserUndoAll(){this.stackPositionProperty.value>0&&(this.stackPositionProperty.value=0,this.updateState())}onUserRedoAll(){this.stackPositionProperty.value<this.stackLengthProperty.value-1&&(this.stackPositionProperty.value=this.stackLengthProperty.value-1,this.updateState())}onUserEscape(){this.pendingActionFaceColorProperty.value=null,this.pendingActionSectorProperty.value=null}getNewEdgeState(s,r){const o=editModeProperty.value===EditMode.EDGE_STATE_REVERSED;return getPressStyle(o?2-r:r).apply(s)}onUserEdgePress(s,r){const o=this.puzzle.stateProperty.value.getEdgeState(s),n=this.getNewEdgeState(o,r);if(o!==n){const l=this.stack[this.stackPositionProperty.value];l.action&&l.action instanceof EdgeStateSetAction&&l.action.edge===s&&this.stackPositionProperty.value--;const h=new EdgeStateSetAction(s,n);this.applyUserActionToStack(h,{checkAutoSolve:g=>g.getEdgeState(s)===n}),this.updateState()}}onUserFacePress(s,r){let o=editModeProperty.value===EditMode.FACE_COLOR_MATCH;r===2&&(o=!o);const n=s?this.puzzle.stateProperty.value.getFaceColor(s):this.puzzle.stateProperty.value.getOutsideColor(),l=this.pendingActionFaceColorProperty.value;if(l){if(s!==l.face){const h=l.color;h!==n&&(o?this.applyUserActionToStack(new FaceColorMakeSameAction(getFaceColorPointer(this.puzzle.stateProperty.value,n),getFaceColorPointer(this.puzzle.stateProperty.value,h))):this.applyUserActionToStack(new FaceColorMakeOppositeAction(getFaceColorPointer(this.puzzle.stateProperty.value,n),getFaceColorPointer(this.puzzle.stateProperty.value,h))))}this.pendingActionFaceColorProperty.value=null,this.updateState()}else this.pendingActionFaceColorProperty.value={face:s,color:n}}onUserSectorPress(s,r){this.pendingActionSectorProperty.value=s}onUserSectorSet(s,r){this.applyUserActionToStack(new SectorStateSetAction(s,r)),this.pendingActionSectorProperty.value=null,this.updateState()}onUserEdgeHover(s,r){r?this.hoverEdgeProperty.value=s:this.hoverEdgeProperty.value=null}onUserFaceHover(s,r){r?this.hoverFaceProperty.value=s:this.hoverFaceProperty.value=!1}onUserSectorHover(s,r){r?this.hoverSectorProperty.value=s:this.hoverSectorProperty.value=null}onUserRequestSolve(){const s=this.puzzle.stateProperty.value;if(!simpleRegionIsSolved(s))if(uiHintUsesBuiltInSolveProperty.value){const r=s.clone();iterateSolverFactory(standardSolverFactory,this.puzzle.board,r,!0),this.pushTransitionAtCurrentPosition(new PuzzleSnapshot(this.puzzle.board,new UserRequestSolveAction,r,!1)),this.updateState()}else{const r=satSolve(this.puzzle.board,this.puzzle.stateProperty.value,{maxIterations:1e4,failOnMultipleSolutions:!0});if(r.length===1){const o=this.puzzle.stateProperty.value.clone();r[0].forEach(n=>{o.setEdgeState(n,EdgeState.BLACK)}),safeSolveWithFactory(this.puzzle.board,o,this.style.safeSolverFactoryProperty.value),this.pushTransitionAtCurrentPosition(new PuzzleSnapshot(this.puzzle.board,new UserRequestSolveAction,o,!1)),this.updateState()}else r.length===0?console.log("No solution found"):console.log("Multiple solution found?!?")}}onUserRequestHint(){if(this.pendingHintActionProperty.value){const s=this.pendingHintActionProperty.value;this.pendingHintActionProperty.value=null,this.applyUserActionToStack(new UserPuzzleHintApplyAction(s)),this.updateState()}else{const s=this.puzzle.stateProperty.value.clone(),r=standardSolverFactory(this.puzzle.board,s);try{let o=r.nextAction();for(;o;){const n=new CompleteValidator(this.puzzle.board,s,this.puzzle.solution.solvedState);let l=!0;try{o.apply(n)}catch(h){if(h instanceof InvalidStateError)l=!1;else throw h}if(l||console.error("invalid action",o),isAnnotationDisplayedForStyle(o.annotation,this.style)){this.pendingHintActionProperty.value=o;break}else o.apply(s),o=r.nextAction()}}catch(o){if(o instanceof InvalidStateError)console.error(o);else throw o}}}}class UserLoadPuzzleAutoSolveAction extends NoOpAction{constructor(){super(...arguments);gt(this,"isUserLoadPuzzleAutoSolveAction",!0)}serializeAction(){return{type:"UserLoadPuzzleAutoSolveAction"}}static deserializeAction(s,r){return new UserLoadPuzzleAutoSolveAction}}class UserRequestSolveAction extends NoOpAction{constructor(){super(...arguments);gt(this,"isUserRequestSolveAction",!0)}serializeAction(){return{type:"UserRequestSolveAction"}}static deserializeAction(s,r){return new UserRequestSolveAction}}class UserPuzzleHintApplyAction{constructor(t){this.hintAction=t}get annotation(){return this.hintAction.annotation}apply(t){this.hintAction.apply(t)}getUndo(t){throw new Error("unimplemented")}isEmpty(){return this.hintAction.isEmpty()}serializeAction(){throw new Error("unimplemented")}static deserializeAction(t,s){throw new Error("unimplemented")}}class PuzzleSnapshot{constructor(t,s,r,o=!1){this.board=t,this.action=s,this.state=r,this.errorDetected=o}}const deserializeAction=(a,t)=>{const s=t.type;if(s==="CompositeAction")return CompositeAction.deserializeAction(a,t);if(s==="CompleteAction")return CompleteAction.deserializeAction(a,t);if(s==="EdgeStateCycleAction")return EdgeStateCycleAction.deserializeAction(a,t);if(s==="EdgeStateSetAction")return EdgeStateSetAction.deserializeAction(a,t);if(s==="GeneralEdgeAction")return GeneralEdgeStateAction.deserializeAction(a,t);if(s==="FaceValueSetAction")return FaceValueSetAction.deserializeAction(a,t);if(s==="GeneralFaceAction")return GeneralFaceValueAction.deserializeAction(a,t);if(s==="GeneralSimpleRegionAction")return GeneralSimpleRegionAction.deserializeAction(a,t);if(s==="NoOpAction")return NoOpAction.deserializeAction(a,t);if(s==="UserLoadPuzzleAutoSolveAction")return UserLoadPuzzleAutoSolveAction.deserializeAction(a,t);if(s==="UserRequestSolveAction")return UserRequestSolveAction.deserializeAction(a,t);throw new Error(`Unknown action type: ${s}, could not deserialize`)};class CompositeAction{constructor(t){this.actions=t}apply(t){for(let s=0;s<this.actions.length;s++)this.actions[s].apply(t)}getUndo(t){return new CompositeAction(this.actions.map(s=>s.getUndo(t)).reverse())}isEmpty(){return this.actions.some(t=>!t.isEmpty())}serializeAction(){return{type:"CompositeAction",actions:this.actions.map(t=>t.serializeAction())}}static deserializeAction(t,s){return new CompositeAction(s.actions.map(r=>deserializeAction(t,r)))}}class SimpleVertexSolver{constructor(t,s,r,o){gt(this,"dirtyVertices",[]);gt(this,"edgeListener");this.board=t,this.state=s,this.options=r,o?this.dirtyVertices.push(...o):this.dirtyVertices.push(...t.vertices),this.edgeListener=(n,l)=>{this.dirtyVertices.push(...n.vertices)},this.state.edgeStateChangedEmitter.addListener(this.edgeListener)}get dirty(){return this.dirtyVertices.length>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyVertices.length;){const t=this.dirtyVertices.pop(),s=t.edges;let r=0,o=0;if(s.forEach(n=>{const l=this.state.getEdgeState(n);return l===EdgeState.BLACK?r++:l===EdgeState.WHITE&&o++,l}),r>2)throw new InvalidStateError("Too many black edges on vertex");if(r===1&&o===0)throw new InvalidStateError("Nowhere for the single edge to go");if(o>0){if(this.options.solveJointToRed&&r===2){const n=s.filter(h=>this.state.getEdgeState(h)===EdgeState.WHITE),l=s.filter(h=>this.state.getEdgeState(h)===EdgeState.BLACK);return assertEnabled()&&assert$2(l.length===2),new AnnotatedAction(new CompositeAction(n.map(h=>new EdgeStateSetAction(h,EdgeState.RED))),{type:"JointToRed",vertex:t,whiteEdges:n,blackEdges:l})}else if(this.options.solveForcedLineToBlack&&r===1&&o===1){const n=s.find(h=>this.state.getEdgeState(h)===EdgeState.WHITE),l=s.find(h=>this.state.getEdgeState(h)===EdgeState.BLACK);return assertEnabled()&&assert$2(n),assertEnabled()&&assert$2(l),new AnnotatedAction(new EdgeStateSetAction(n,EdgeState.BLACK),{type:"ForcedLine",vertex:t,blackEdge:l,whiteEdge:n,redEdges:s.filter(h=>this.state.getEdgeState(h)===EdgeState.RED)})}else if(this.options.solveAlmostEmptyToRed&&r===0&&o===1){const n=s.find(l=>this.state.getEdgeState(l)===EdgeState.WHITE);return assertEnabled()&&assert$2(n),new AnnotatedAction(new EdgeStateSetAction(n,EdgeState.RED),{type:"AlmostEmptyToRed",vertex:t,whiteEdge:n,redEdges:s.filter(l=>this.state.getEdgeState(l)===EdgeState.RED)})}}}return null}clone(t){return new SimpleVertexSolver(this.board,t,this.options,this.dirtyVertices)}dispose(){this.state.edgeStateChangedEmitter.removeListener(this.edgeListener)}}class SimpleFaceSolver{constructor(t,s,r,o){gt(this,"dirtyFaces",[]);gt(this,"faceListener");gt(this,"edgeListener");this.board=t,this.state=s,this.options=r,o?this.dirtyFaces.push(...o):this.dirtyFaces.push(...t.faces.filter(n=>s.getFaceValue(n)!==null)),this.faceListener=(n,l)=>{this.dirtyFaces.push(n)},this.edgeListener=(n,l)=>{this.dirtyFaces.push(...n.faces)},this.state.faceValueChangedEmitter.addListener(this.faceListener),this.state.edgeStateChangedEmitter.addListener(this.edgeListener)}get dirty(){return this.dirtyFaces.length>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyFaces.length;){const t=this.dirtyFaces.pop(),s=this.state.getFaceValue(t);if(s!==null){const r=t.edges;let o=0,n=0,l=0;if(r.forEach(h=>{const g=this.state.getEdgeState(h);return g===EdgeState.BLACK?o++:g===EdgeState.RED?n++:l++,g}),o>s)throw new InvalidStateError("Too many black edges on face");if(n>t.edges.length-s)throw new InvalidStateError("Too many red edges on face");if(l>0){if(this.options.solveToRed&&o===s){const h=r.filter(d=>this.state.getEdgeState(d)===EdgeState.WHITE),g=r.filter(d=>this.state.getEdgeState(d)===EdgeState.BLACK);return new AnnotatedAction(new CompositeAction(h.map(d=>new EdgeStateSetAction(d,EdgeState.RED))),{type:"FaceSatisfied",face:t,whiteEdges:h,blackEdges:g})}else if(this.options.solveToBlack&&n===t.edges.length-s){const h=r.filter(d=>this.state.getEdgeState(d)===EdgeState.WHITE),g=r.filter(d=>this.state.getEdgeState(d)===EdgeState.RED);return new AnnotatedAction(new CompositeAction(h.map(d=>new EdgeStateSetAction(d,EdgeState.BLACK))),{type:"FaceAntiSatisfied",face:t,whiteEdges:h,redEdges:g})}}}}return null}clone(t){return new SimpleFaceSolver(this.board,t,this.options,this.dirtyFaces)}dispose(){this.state.faceValueChangedEmitter.removeListener(this.faceListener),this.state.edgeStateChangedEmitter.removeListener(this.edgeListener)}}class SimpleLoopSolver{constructor(t,s,r,o){gt(this,"dirtySimpleRegions");gt(this,"hasDirtyWeirdEdges",!1);gt(this,"simpleRegionListener");gt(this,"edgeListener");this.board=t,this.state=s,this.options=r,o?this.dirtySimpleRegions=new Set(o):this.dirtySimpleRegions=new Set(s.getSimpleRegions()),this.simpleRegionListener=(n,l,h,g)=>{for(const d of l)this.dirtySimpleRegions.delete(d);for(const d of n)this.dirtySimpleRegions.add(d);this.hasDirtyWeirdEdges=s.getWeirdEdges().length>0},this.state.simpleRegionsChangedEmitter.addListener(this.simpleRegionListener),this.edgeListener=(n,l,h)=>{if(l===EdgeState.RED){const g=this.state.getSimpleRegions(),d=A=>{let S=A,O=null,I=0;do{if(I++>1e4)throw new Error("infinite loop detected");const W=S.edges.filter(Y=>this.state.getEdgeState(Y)===EdgeState.BLACK);if(W.length===1){for(const Y of g)(Y.a===S||Y.b===S)&&this.dirtySimpleRegions.add(Y);break}if(W.length!==0)break;const L=S.edges.filter(Y=>this.state.getEdgeState(Y)===EdgeState.WHITE);if(L.length!==2)break;const H=L[0].getOtherVertex(S)===O?L[1]:L[0];O=S,S=H.getOtherVertex(S)}while(S!==A)};d(n.start),d(n.end)}},this.state.edgeStateChangedEmitter.addListener(this.edgeListener)}get dirty(){return this.dirtySimpleRegions.size>0||this.hasDirtyWeirdEdges}nextAction(){if(!this.dirty)return null;if(this.state.getWeirdEdges().length)throw new InvalidStateError("has weird edges");const t=this.options.resolveAllRegions?new Set(this.state.getSimpleRegions()):this.dirtySimpleRegions;for(;t.size>0;){const s=t.values().next().value;if(!s.isSolved){const r=s.a,o=s.b,n=s.halfEdges[0].edge;for(const l of r.edges){if(l===n||this.state.getEdgeState(l)===EdgeState.RED)continue;const h=[l];let g=l,d=l.getOtherVertex(r);for(;d!==o;){let A=!1;const S=d.edges.filter(O=>{if(O===g)return!1;const I=this.state.getEdgeState(O);return I===EdgeState.BLACK&&(A=!0),I===EdgeState.WHITE});if(S.length!==1||A)break;g=S[0],h.push(g),d=g.getOtherVertex(d)}if(d===o){if(this.isSolvedWithAddedEdges(s,h)){if(this.options.solveToBlack)return new AnnotatedAction(new CompositeAction(h.map(A=>new EdgeStateSetAction(A,EdgeState.BLACK))),{type:"ForcedSolveLoop",a:r,b:o,regionEdges:s.edges,pathEdges:h})}else if(this.options.solveToRed)return new AnnotatedAction(new CompositeAction(h.map(A=>new EdgeStateSetAction(A,EdgeState.RED))),{type:"PrematureForcedLoop",a:r,b:o,regionEdges:s.edges,pathEdges:h})}}}t.delete(s)}return null}isSolvedWithAddedEdges(t,s){const r=new Set(t.edges);for(const o of s)r.add(o);for(const o of this.board.faces){const n=this.state.getFaceValue(o);if(n!==null&&o.edges.filter(h=>r.has(h)).length!==n)return!1}return!0}clone(t){return new SimpleLoopSolver(this.board,t,this.options,this.dirtySimpleRegions)}dispose(){this.state.simpleRegionsChangedEmitter.removeListener(this.simpleRegionListener),this.state.edgeStateChangedEmitter.removeListener(this.edgeListener)}}class FaceColorInvalidAction{constructor(){}apply(t){t.modifyFaceColors([],[],new Map,new Map,!0)}getUndo(t){throw new Error("getUndo unimplemented in FaceColorInvalidAction")}isEmpty(){return!1}serializeAction(){throw new Error("serializeAction unimplemented in FaceColorInvalidAction")}static deserializeAction(t,s){throw new Error("deserializeAction unimplemented in FaceColorInvalidAction")}}class SafeEdgeToFaceColorSolver{constructor(t,s){gt(this,"hadEdgeAdjusted",!1);gt(this,"dirtyEdges",new Set);gt(this,"edgeListener");this.board=t,this.state=s,t.edges.forEach(r=>this.dirtyEdges.add(r)),this.edgeListener=(r,o,n)=>{this.dirtyEdges.add(r),this.hadEdgeAdjusted=this.hadEdgeAdjusted||n!==EdgeState.WHITE},this.state.edgeStateChangedEmitter.addListener(this.edgeListener)}get dirty(){return this.dirtyEdges.size>0||this.hadEdgeAdjusted}nextAction(){var s;if(!this.dirty)return null;if(this.hadEdgeAdjusted||this.state.hasInvalidFaceColors()){this.hadEdgeAdjusted=!1,this.dirtyEdges.clear();const r=new Map,o=new ProtoFaceColor(FaceColorState.OUTSIDE,new Set),n=new ProtoFaceColor(FaceColorState.INSIDE,new Set);o.opposite=n,n.opposite=o;const l=new Set([o,n,...this.board.faces.map(pe=>{const de=new ProtoFaceColor(FaceColorState.UNDECIDED,new Set([pe]));return r.set(pe,de),de})]);let h=!1;const g=pe=>{if(pe===null)return o;const de=r.get(pe);return assertEnabled()&&assert$2(de),de},d=(pe,de)=>{if(de===o||de===n)return d(de,pe);assertEnabled()&&assert$2(pe!==de);for(const fe of de.faces)pe.faces.add(fe),r.set(fe,pe);return de.faces.clear(),l.delete(de),pe},A=(pe,de)=>{if(assertEnabled()&&assert$2(l.has(pe)&&l.has(de)),pe===de)return;const fe=pe.opposite,ye=de.opposite;if(fe&&fe===de){h=!0;return}if(ye&&ye===pe){h=!0;return}const Ee=d(pe,de),Le=fe&&ye?d(fe,ye):fe||ye;Ee.opposite=Le,Le&&(Le.opposite=Ee)},S=(pe,de)=>{if(assertEnabled()&&assert$2(l.has(pe)&&l.has(de)),pe===de){h=!0;return}if(pe.opposite&&pe.opposite===de)return;const fe=pe.opposite,ye=de.opposite;if(fe&&fe===ye){h=!0;return}const Ee=ye?d(pe,ye):pe,Le=fe?d(de,fe):de;Ee.opposite=Le,Le.opposite=Ee};for(const pe of this.board.edges){if(h)break;const de=this.state.getEdgeState(pe);if(de!==EdgeState.WHITE){const fe=g(pe.forwardFace),ye=g(pe.reversedFace);de===EdgeState.BLACK?S(fe,ye):de===EdgeState.RED&&A(fe,ye)}}if(assertEnabled()){const pe=new Set(this.board.faces);for(const de of l)for(const fe of de.faces)pe.delete(fe);assert$2(pe.size===0)}if(h)return new AnnotatedAction(new FaceColorInvalidAction,{type:"InvalidFaceColoring"});const O=new Set(this.state.getFaceColors()),I=new Set,W=new Map,L=(pe,de)=>{assertEnabled()&&assert$2(O.has(pe)),assertEnabled()&&assert$2(de.faceColor===null),O.delete(pe),de.faceColor=pe};L(this.state.getOutsideColor(),o),L(this.state.getInsideColor(),n);for(const pe of l){if(!pe.faceColor){const fe=new Set([...pe.faces].map(Le=>this.state.getFaceColor(Le)));let ye=null,Ee=0;for(const Le of fe){if(!O.has(Le))continue;const Z=this.state.getFacesWithColor(Le);Z.some(ne=>!pe.faces.has(ne))||Z.length>Ee&&(ye=Le,Ee=Z.length)}if(ye)L(ye,pe);else{const Le=new GeneralFaceColor(getFaceColorGlobalId(),FaceColorState.UNDECIDED);I.add(Le),pe.faceColor=Le}}const de=pe.faceColor;assertEnabled()&&assert$2(de),pe.faces.forEach(fe=>{this.state.getFaceColor(fe)!==de&&W.set(fe,de)})}const H=new Set(O),Y=new Map;for(const pe of l){const de=pe.faceColor,fe=((s=pe.opposite)==null?void 0:s.faceColor)??null;let ye=I.has(de);ye||(ye=this.state.getOppositeFaceColor(de)!==fe),ye&&Y.set(de,fe)}return I.size>0||H.size>0||W.size>0||Y.size>0||this.state.hasInvalidFaceColors()?new AnnotatedAction(new GeneralFaceColorAction(this.board,I,H,W,Y,!1),{type:"GeneralFaceColoring"}):null}else for(;this.dirtyEdges.size;){const r=this.dirtyEdges.values().next().value;this.dirtyEdges.delete(r);const o=this.state.getEdgeState(r);if(o!==EdgeState.WHITE){const n=r.forwardFace?this.state.getFaceColor(r.forwardFace):this.state.getOutsideColor(),l=r.reversedFace?this.state.getFaceColor(r.reversedFace):this.state.getOutsideColor();if(o===EdgeState.BLACK){if(this.state.getOppositeFaceColor(n)!==l)return new AnnotatedAction(new FaceColorMakeOppositeAction(getFaceColorPointer(this.state,n),getFaceColorPointer(this.state,l)),{type:"FaceColoringBlackEdge",edge:r})}else if(o===EdgeState.RED&&n!==l)return new AnnotatedAction(new FaceColorMakeSameAction(getFaceColorPointer(this.state,n),getFaceColorPointer(this.state,l)),{type:"FaceColoringRedEdge",edge:r})}}return null}clone(t){return new SafeEdgeToFaceColorSolver(this.board,t)}dispose(){this.state.edgeStateChangedEmitter.removeListener(this.edgeListener)}}class ProtoFaceColor{constructor(t,s){gt(this,"opposite",null);gt(this,"faceColor",null);this.colorState=t,this.faces=s}}class SimpleFaceColorSolver{constructor(t,s,r,o){gt(this,"dirtyEdges",new Set);gt(this,"faceColorListener");this.board=t,this.state=s,this.options=r,o?this.dirtyEdges=new Set(o):this.dirtyEdges=new Set(t.edges),this.faceColorListener=(n,l,h,g)=>{for(const d of g)for(const A of d.edges)this.dirtyEdges.add(A);for(const d of h){const A=this.state.getFacesWithColor(d);for(const S of A)for(const O of S.edges)this.dirtyEdges.add(O)}},this.state.faceColorsChangedEmitter.addListener(this.faceColorListener)}get dirty(){return this.dirtyEdges.size>0}nextAction(){if(!this.dirty)return null;if(this.state.hasInvalidFaceColors())throw new InvalidStateError("Has invalid face colors");for(;this.dirtyEdges.size>0;){const t=this.dirtyEdges.values().next().value;if(this.state.getEdgeState(t)===EdgeState.WHITE){const r=t.forwardFace?this.state.getFaceColor(t.forwardFace):this.state.getOutsideColor(),o=t.reversedFace?this.state.getFaceColor(t.reversedFace):this.state.getOutsideColor(),n=r===o,l=this.state.getOppositeFaceColor(r)===o;if(this.options.solveToBlack&&l)return new AnnotatedAction(new EdgeStateSetAction(t,EdgeState.BLACK),{type:"FaceColorToBlack",edge:t});if(this.options.solveToRed&&n)return new AnnotatedAction(new EdgeStateSetAction(t,EdgeState.RED),{type:"FaceColorToRed",edge:t})}this.dirtyEdges.delete(t)}return null}clone(t){return new SimpleFaceColorSolver(this.board,t,this.options,this.dirtyEdges)}dispose(){this.state.faceColorsChangedEmitter.removeListener(this.faceColorListener)}}class SafeSolvedEdgeSolver{constructor(t,s){gt(this,"hasDirtySimpleRegions",!0);gt(this,"simpleRegionListener");this.board=t,this.state=s,this.simpleRegionListener=()=>{this.hasDirtySimpleRegions=!0},this.state.simpleRegionsChangedEmitter.addListener(this.simpleRegionListener)}get dirty(){return this.hasDirtySimpleRegions}nextAction(){if(!this.dirty)return null;if(simpleRegionIsSolved(this.state)){const t=this.board.edges.filter(s=>this.state.getEdgeState(s)===EdgeState.WHITE);if(t.length)return new AnnotatedAction(new CompositeAction(t.map(s=>new EdgeStateSetAction(s,EdgeState.RED))),{type:"CompletingEdgesAfterSolve",whiteEdges:t})}return this.hasDirtySimpleRegions=!1,null}clone(t){return new SafeSolvedEdgeSolver(this.board,t)}dispose(){this.state.simpleRegionsChangedEmitter.removeListener(this.simpleRegionListener)}}class FaceColorParitySolver{constructor(t,s,r,o){gt(this,"dirtyFaces",new Set);gt(this,"edgeListener");gt(this,"faceColorListener");this.board=t,this.state=s,this.options=r,o?this.dirtyFaces=new Set(o):this.dirtyFaces=new Set(t.faces),this.faceColorListener=(n,l,h,g)=>{const d=A=>{this.dirtyFaces.add(A);for(const S of A.edges){const O=S.getOtherFace(A);O&&this.dirtyFaces.add(O)}};for(const A of g)d(A);for(const A of[...n,...h]){const S=this.state.getFacesWithColor(A);for(const O of S)d(O)}},this.state.faceColorsChangedEmitter.addListener(this.faceColorListener),this.edgeListener=(n,l)=>{for(const h of n.faces)this.dirtyFaces.add(h)},this.state.edgeStateChangedEmitter.addListener(this.edgeListener)}get dirty(){return this.dirtyFaces.size>0}nextAction(){if(!this.dirty)return null;if(this.state.hasInvalidFaceColors())throw new InvalidStateError("Has invalid face colors");for(;this.dirtyFaces.size>0;){const t=this.dirtyFaces.values().next().value,s=o=>{const n=o.getOtherFace(t),l=n?this.state.getFaceColor(n):this.state.getOutsideColor();return new Side(l,o)},r=t.edges.filter(o=>this.state.getEdgeState(o)===EdgeState.WHITE).map(s);if(r.length){const o=this.state.getFaceValue(t);if(o===null){const n=r[0].color;if(t.edges.map(s).every(g=>g.color===n)&&this.options.solveToRed){const g=t.edges.map(A=>A.getOtherFace(t)).filter(A=>A!==null);if(this.board.faces.some(A=>A!==t&&this.state.getFaceValue(A)!==null&&!g.includes(A)))return new AnnotatedAction(new CompositeAction(r.map(A=>new EdgeStateSetAction(A.edge,EdgeState.RED))),{type:"FaceColorNoTrivialLoop",face:t})}}else{const n=t.edges.filter(g=>this.state.getEdgeState(g)===EdgeState.BLACK).length,l=(g,d,A)=>{let S=[];for(const ye of d){const Ee=ye.color;let Le=!1;for(const Z of S)if(Z.mainColor===Ee){Z.mainColorSides.add(ye),Le=!0;break}else if(Z.oppositeColor===Ee){Z.oppositeColorSides.add(ye),Le=!0;break}if(!Le){const Z=this.state.getOppositeFaceColor(Ee),ne=new DualColorCount(Ee,Z,0,0);S.push(ne),ne.mainColorSides.add(ye)}}S=_$1.sortBy(S,ye=>-ye.size);const I=_$1.sortBy(S.flatMap(ye=>{const Ee=[new SingleColorCount(ye.mainColor,ye.mainCount,ye.mainColorSides)];return ye.oppositeColor&&ye.oppositeColorSides.size&&Ee.push(new SingleColorCount(ye.oppositeColor,ye.oppositeCount,ye.oppositeColorSides)),Ee}),ye=>-ye.size)[0],W=I.size,L=g,H=d.length-L,Y=Math.max(L,H),Q=W>L,pe=W>H,de=W===Y;if(Q&&pe)throw new InvalidStateError("Too many adjacent faces with the same color");const fe=()=>{const ye=Ee=>[Ee[0].map(Le=>Le.edge),Ee[1].map(Le=>Le.edge)];return{face:t,remainingValue:g,availableSideCount:d.length,balancedPairs:A.map(ye)}};if(Q&&this.options.solveToRed)return new AnnotatedAction(new CompositeAction([...I.sides].map(ye=>new EdgeStateSetAction(ye.edge,EdgeState.RED))),{type:"FaceColorMatchToRed",matchingEdges:[...I.sides].map(ye=>ye.edge),...fe()});if(pe&&this.options.solveToBlack)return new AnnotatedAction(new CompositeAction([...I.sides].map(ye=>new EdgeStateSetAction(ye.edge,EdgeState.BLACK))),{type:"FaceColorMatchToBlack",matchingEdges:[...I.sides].map(ye=>ye.edge),...fe()});if(de&&this.options.solveColors){const ye=I.color,Ee=d.filter(Z=>Z.color!==ye),Le=_$1.uniq(Ee.map(Z=>Z.color)).filter(Z=>Z!==this.state.getOppositeFaceColor(ye));if(Le.length)return assertEnabled()&&assert$2(Le.every(Z=>this.state.getFaceColors().includes(Z))),new AnnotatedAction(new CompositeAction(Le.map(Z=>new FaceColorMakeOppositeAction(getFaceColorPointer(this.state,ye),getFaceColorPointer(this.state,Z)))),{type:"FaceColorBalance",matchingEdges:[...I.sides].map(Z=>Z.edge),oppositeEdges:[...Ee].map(Z=>Z.edge),...fe()})}if(this.options.allowPartialReduction)for(const ye of S){if(ye.size<1)continue;const Ee=[...ye.mainColorSides].slice(0,ye.size),Le=[...ye.oppositeColorSides].slice(0,ye.size),Z=d.filter(ne=>!Ee.includes(ne)&&!Le.includes(ne));if(Z.length){const ne=l(L-ye.size,Z,A.concat([[Ee,Le]]));if(ne)return ne}}return null},h=l(o-n,r,[]);if(h)return h}}this.dirtyFaces.delete(t)}return null}clone(t){return new FaceColorParitySolver(this.board,t,this.options,this.dirtyFaces)}dispose(){this.state.faceColorsChangedEmitter.removeListener(this.faceColorListener),this.state.edgeStateChangedEmitter.removeListener(this.edgeListener)}}class Side{constructor(t,s){this.color=t,this.edge=s}}class DualColorCount{constructor(t,s,r,o){gt(this,"mainColorSides",new Set);gt(this,"oppositeColorSides",new Set);this.mainColor=t,this.oppositeColor=s,this.mainCount=r,this.oppositeCount=o}get size(){return Math.min(this.mainColorSides.size,this.oppositeColorSides.size)}}class SingleColorCount{constructor(t,s,r){this.color=t,this.count=s,this.sides=r}get size(){return this.sides.size}}const faceAdjacentFaces=a=>{const t=[];for(const s of a.edges){const r=s.getOtherFace(a);r&&t.push(r)}return t},edgeHasVertex=(a,t)=>a.start===t||a.end===t;class StaticDoubleMinusOneFacesSolver{constructor(t,s,r){gt(this,"dirtyFaces");gt(this,"faceListener");this.board=t,this.state=s,r?this.dirtyFaces=new Set(r):this.dirtyFaces=new Set(t.faces),this.faceListener=(o,n)=>{this.dirtyFaces.add(o);for(const l of faceAdjacentFaces(o))this.dirtyFaces.add(l)},this.state.faceValueChangedEmitter.addListener(this.faceListener)}get dirty(){return this.dirtyFaces.size>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyFaces.size;){const t=this.dirtyFaces.values().next().value,s=this.state.getFaceValue(t),r=t.edges.length;if(s===r-1)for(const o of t.edges){const n=o.getOtherFace(t);if(n){const l=this.state.getFaceValue(n),h=n.edges.length;if(l===h-1){const g=new Set([...faceAdjacentFaces(t),...faceAdjacentFaces(n)]);if(this.board.faces.some(d=>(this.state.getFaceValue(d)??0)>0&&!g.has(d))){const d=H=>!edgeHasVertex(H,o.start)&&!edgeHasVertex(H,o.end),A=t.edges.filter(d),S=n.edges.filter(d),O=H=>!H.faces.some(Y=>Y===t||Y===n),I=[...o.start.edges.filter(O),...o.end.edges.filter(O)],W=[o,...A,...S].filter(H=>this.state.getEdgeState(H)!==EdgeState.BLACK),L=I.filter(H=>this.state.getEdgeState(H)!==EdgeState.RED);if(W.length||L.length)return new AnnotatedAction(new CompositeAction([...W.map(H=>new EdgeStateSetAction(H,EdgeState.BLACK)),...L.map(H=>new EdgeStateSetAction(H,EdgeState.RED))]),{type:"DoubleMinusOneFaces",faces:[t,n],toBlackEdges:W,toRedEdges:L})}}}}this.dirtyFaces.delete(t)}return null}clone(t){return new StaticDoubleMinusOneFacesSolver(this.board,t,this.dirtyFaces)}dispose(){this.state.faceValueChangedEmitter.removeListener(this.faceListener)}}class SafeEdgeToSectorSolver{constructor(t,s){gt(this,"dirtySectors",new Set);gt(this,"edgeListener");this.board=t,this.state=s,t.halfEdges.forEach(r=>this.dirtySectors.add(r)),this.edgeListener=(r,o,n)=>{this.dirtySectors.add(r.forwardHalf),this.dirtySectors.add(r.forwardHalf.previous),this.dirtySectors.add(r.reversedHalf),this.dirtySectors.add(r.reversedHalf.previous)},this.state.edgeStateChangedEmitter.addListener(this.edgeListener)}get dirty(){return this.dirtySectors.size>0}nextAction(){if(!this.dirty)return null;for(;this.dirtySectors.size;){const t=this.dirtySectors.values().next().value;this.dirtySectors.delete(t);const s=t.edge,r=t.next.edge,o=this.state.getEdgeState(s),n=this.state.getEdgeState(r),l=this.state.getSectorState(t);let h=l;const g=(o===EdgeState.WHITE?1:0)+(n===EdgeState.WHITE?1:0),d=(o===EdgeState.BLACK?1:0)+(n===EdgeState.BLACK?1:0),A=(o===EdgeState.RED?1:0)+(n===EdgeState.RED?1:0);if(g===0?h=SectorState.getOnly(d):g===1&&(d&&h.zero&&(h=h.withDisallowZero()),A&&h.two&&(h=h.withDisallowTwo())),h!==l)return new AnnotatedAction(new SectorStateSetAction(t,h),{type:g===1?"SingleEdgeToSector":"DoubleEdgeToSector",sector:t,beforeState:l,afterState:h})}return null}clone(t){return new SafeEdgeToSectorSolver(this.board,t)}dispose(){this.state.edgeStateChangedEmitter.removeListener(this.edgeListener)}}class SimpleSectorSolver{constructor(t,s,r){gt(this,"dirtySectors");gt(this,"edgeListener");gt(this,"sectorListener");this.board=t,this.state=s,r?this.dirtySectors=new Set(r):this.dirtySectors=new Set(t.halfEdges),this.edgeListener=(o,n,l)=>{this.dirtySectors.add(o.forwardHalf),this.dirtySectors.add(o.forwardHalf.previous),this.dirtySectors.add(o.reversedHalf),this.dirtySectors.add(o.reversedHalf.previous)},this.state.edgeStateChangedEmitter.addListener(this.edgeListener),this.sectorListener=(o,n,l)=>{this.dirtySectors.add(o)},this.state.sectorStateChangedEmitter.addListener(this.sectorListener)}get dirty(){return this.dirtySectors.size>0}nextAction(){if(!this.dirty)return null;for(;this.dirtySectors.size;){const t=this.dirtySectors.values().next().value;this.dirtySectors.delete(t);const s=t.edge,r=t.next.edge,o=this.state.getSectorState(t);if(o===SectorState.NONE)throw new InvalidStateError(`invalid sector state: ${o}`);const n=this.state.getEdgeState(s),l=this.state.getEdgeState(r),h=(n===EdgeState.WHITE?1:0)+(l===EdgeState.WHITE?1:0),g=(n===EdgeState.BLACK?1:0)+(l===EdgeState.BLACK?1:0),d=(A,S)=>new AnnotatedAction(new CompositeAction([...A.map(O=>new EdgeStateSetAction(O,EdgeState.BLACK)),...S.map(O=>new EdgeStateSetAction(O,EdgeState.RED))]),{type:"ForcedSector",sector:t,sectorState:o,toRedEdges:S,toBlackEdges:A});if(h===0){if(!o.allows(g))throw new InvalidStateError(`invalid state: ${o} with ${g} black edges with no white`)}else if(h===1){const A=o.allows(g),S=o.allows(g+1);if(!A&&!S)throw new InvalidStateError(`invalid state: ${o} with ${g} black edges and 1 white`);if(A&&!S)return d([],[n===EdgeState.WHITE?s:r]);if(S&&!A)return d([n===EdgeState.WHITE?s:r],[])}else if(h===2){if(o===SectorState.ONLY_ZERO)return d([],[s,r]);if(o===SectorState.ONLY_TWO)return d([s,r],[])}else throw new InvalidStateError(`invalid white count: ${h}`)}return null}clone(t){return new SimpleSectorSolver(this.board,t,this.dirtySectors)}dispose(){this.state.edgeStateChangedEmitter.removeListener(this.edgeListener),this.state.sectorStateChangedEmitter.removeListener(this.sectorListener)}}class StaticSectorSolver{constructor(t,s,r){gt(this,"dirtyFaces");gt(this,"faceListener");this.board=t,this.state=s,r?this.dirtyFaces=new Set(r):this.dirtyFaces=new Set(t.faces),this.faceListener=(o,n)=>{this.dirtyFaces.add(o);for(const l of faceAdjacentFaces(o))this.dirtyFaces.add(l)},this.state.faceValueChangedEmitter.addListener(this.faceListener)}get dirty(){return this.dirtyFaces.size>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyFaces.size;){const t=this.dirtyFaces.values().next().value,s=this.state.getFaceValue(t),r=t.edges.length;let o=null;if(s===0?o=SectorState.ONLY_ZERO:s===1?o=SectorState.NOT_TWO:s===r-1?o=SectorState.NOT_ZERO:s===r&&(o=SectorState.ONLY_TWO),o){const n=t.halfEdges,l=[],h=[];for(const g of n){const d=this.state.getSectorState(g),A=d.and(o);if(A===SectorState.NONE)throw new InvalidStateError(`invalid sector state: ${d}`);d!==A&&(l.push(new SectorStateSetAction(g,A)),h.push(g))}if(l.length)return new AnnotatedAction(new CompositeAction(l),{type:"StaticFaceSectors",face:t,sectors:h})}this.dirtyFaces.delete(t)}return null}clone(t){return new StaticSectorSolver(this.board,t,this.dirtyFaces)}dispose(){this.state.faceValueChangedEmitter.removeListener(this.faceListener)}}class VertexStateSetAction{constructor(t,s){this.vertex=t,this.state=s}apply(t){t.setVertexState(this.vertex,this.state)}getUndo(t){const s=t.getVertexState(this.vertex);return new VertexStateSetAction(this.vertex,s)}isEmpty(){return!1}serializeAction(){return{type:"VertexStateSetAction",vertex:serializeVertex(this.vertex),state:this.state.serialize()}}static deserializeAction(t,s){const r=deserializeVertex(t,s.vertex);return new VertexStateSetAction(r,VertexState.deserialize(r,s.state))}}class SafeEdgeSectorColorToVertexSolver{constructor(t,s){gt(this,"dirtyVertices",new Set);gt(this,"edgeListener");gt(this,"sectorListener");gt(this,"faceColorListener");this.board=t,this.state=s,t.vertices.forEach(r=>this.dirtyVertices.add(r)),this.edgeListener=(r,o,n)=>{this.dirtyVertices.add(r.start),this.dirtyVertices.add(r.end)},this.state.edgeStateChangedEmitter.addListener(this.edgeListener),this.sectorListener=(r,o,n)=>{this.dirtyVertices.add(r.end)},this.state.sectorStateChangedEmitter.addListener(this.sectorListener),this.faceColorListener=(r,o,n,l)=>{for(const h of l)for(const g of h.vertices)this.dirtyVertices.add(g);for(const h of n){const g=this.state.getFacesWithColor(h);for(const d of g)for(const A of d.vertices)this.dirtyVertices.add(A)}},this.state.faceColorsChangedEmitter.addListener(this.faceColorListener)}get dirty(){return this.dirtyVertices.size>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyVertices.size;){const t=this.dirtyVertices.values().next().value;this.dirtyVertices.delete(t);const s=this.state.getVertexState(t),r=VertexState.fromEdgeColorSectorData(t,this.state).and(s);if(!s.equals(r))return new AnnotatedAction(new VertexStateSetAction(t,r),{type:"VertexState",vertex:t,beforeState:s,afterState:r})}return null}clone(t){return new SafeEdgeSectorColorToVertexSolver(this.board,t)}dispose(){this.state.edgeStateChangedEmitter.removeListener(this.edgeListener),this.state.sectorStateChangedEmitter.removeListener(this.sectorListener),this.state.faceColorsChangedEmitter.removeListener(this.faceColorListener)}}class VertexToEdgeSolver{constructor(t,s,r,o){gt(this,"dirtyVertices",[]);gt(this,"vertexListener");this.board=t,this.state=s,this.options=r,o?this.dirtyVertices.push(...o):this.dirtyVertices.push(...t.vertices),this.vertexListener=n=>{this.dirtyVertices.push(n)},this.state.vertexStateChangedEmitter.addListener(this.vertexListener)}get dirty(){return this.dirtyVertices.length>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyVertices.length;){const t=this.dirtyVertices.pop(),s=this.state.getVertexState(t);if(s.possibilityCount===0)throw new InvalidStateError("Vertex has no possibilities");const r=[],o=[];for(const n of t.edges)if(this.state.getEdgeState(n)===EdgeState.WHITE){const h=s.getFinalStatesOfEdge(n);if(h.size===1){const g=[...h][0];g===EdgeState.RED&&this.options.solveToRed&&r.push(n),g===EdgeState.BLACK&&this.options.solveToBlack&&o.push(n)}}if(r.length||o.length)return new AnnotatedAction(new CompositeAction([...r.map(n=>new EdgeStateSetAction(n,EdgeState.RED)),...o.map(n=>new EdgeStateSetAction(n,EdgeState.BLACK))]),{type:"VertexStateToEdge",vertex:t,toRedEdges:r,toBlackEdges:o})}return null}clone(t){return new VertexToEdgeSolver(this.board,t,this.options,this.dirtyVertices)}dispose(){this.state.vertexStateChangedEmitter.removeListener(this.vertexListener)}}class VertexToSectorSolver{constructor(t,s,r){gt(this,"dirtyVertices",[]);gt(this,"vertexListener");this.board=t,this.state=s,r?this.dirtyVertices.push(...r):this.dirtyVertices.push(...t.vertices),this.vertexListener=o=>{this.dirtyVertices.push(o)},this.state.vertexStateChangedEmitter.addListener(this.vertexListener)}get dirty(){return this.dirtyVertices.length>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyVertices.length;){const t=this.dirtyVertices.pop(),s=this.state.getVertexState(t);if(s.possibilityCount===0)throw new InvalidStateError("Vertex has no possibilities");const r=getSectorsFromVertex(t),o=r.map(d=>this.state.getSectorState(d)),n=r.map(d=>SectorState.NONE);for(const d of s.getAllowedPairs())for(let A=0;A<r.length;A++){const S=r[A],O=S.edge,I=S.next.edge,W=d[0],L=d[1],H=(O===W||O===L?1:0)+(I===W||I===L?1:0);n[A]=n[A].with(H)}if(s.allowsEmpty())for(let d=0;d<r.length;d++)n[d]=n[d].withZero(!0);for(let d=0;d<r.length;d++)n[d]=n[d].and(o[d]);for(const d of n)if(d===SectorState.NONE)throw new InvalidStateError("Sector has no possibilities");const l=[],h=[],g=[];for(let d=0;d<r.length;d++)o[d]!==n[d]&&(l.push(r[d]),h.push(o[d]),g.push(n[d]));if(l.length)return new AnnotatedAction(new CompositeAction(l.map((d,A)=>new SectorStateSetAction(d,g[A]))),{type:"VertexStateToSector",vertex:t,sectors:l,beforeStates:h,afterStates:g})}return null}clone(t){return new VertexToSectorSolver(this.board,t,this.dirtyVertices)}dispose(){this.state.vertexStateChangedEmitter.removeListener(this.vertexListener)}}class VertexToFaceColorSolver{constructor(t,s,r){gt(this,"dirtyVertices",[]);gt(this,"vertexListener");this.board=t,this.state=s,r?this.dirtyVertices.push(...r):this.dirtyVertices.push(...t.vertices),this.vertexListener=o=>{this.dirtyVertices.push(o)},this.state.vertexStateChangedEmitter.addListener(this.vertexListener)}get dirty(){return this.dirtyVertices.length>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyVertices.length;){const t=this.dirtyVertices[this.dirtyVertices.length-1],s=this.state.getVertexState(t);if(s.possibilityCount===0)throw new InvalidStateError("Vertex has no possibilities");const o=getFaceOrderedSectorsFromVertex(t).map(h=>h.face?this.state.getFaceColor(h.face):this.state.getOutsideColor()),n=new Set(o);if(n.size!==1){const h=new Map([...n].map(d=>[d,new Map([...n].map(A=>[A,!1]))])),g=new Map([...n].map(d=>[d,new Map([...n].map(A=>[A,!1]))]));for(const d of s.getAllowedPairs()){const A=t.edges.indexOf(d[0]),S=t.edges.indexOf(d[1]),O=Math.min(A,S),I=Math.max(A,S),W=o.slice(O,I),L=[...o.slice(I),...o.slice(0,O)],H=Y=>{for(let Q=0;Q<Y.length;Q++)for(let pe=Q+1;pe<Y.length;pe++)h.get(Y[Q]).set(Y[pe],!0),h.get(Y[pe]).set(Y[Q],!0)};H(W),H(L);for(const Y of W)for(const Q of L)Y!==Q&&(g.get(Y).set(Q,!0),g.get(Q).set(Y,!0))}for(const d of n)for(const A of n){if(d===A)continue;const S=s.allowsEmpty()||h.get(d).get(A),O=g.get(d).get(A);if(S&&!O)return new AnnotatedAction(new FaceColorMakeSameAction(getFaceColorPointer(this.state,d),getFaceColorPointer(this.state,A)),{type:"VertexStateToSameFaceColor",vertex:t,facesA:t.faces.filter(I=>this.state.getFaceColor(I)===d),facesB:t.faces.filter(I=>this.state.getFaceColor(I)===A)});if(O&&!S&&this.state.getOppositeFaceColor(d)!==A)return new AnnotatedAction(new FaceColorMakeOppositeAction(getFaceColorPointer(this.state,d),getFaceColorPointer(this.state,A)),{type:"VertexStateToOppositeFaceColor",vertex:t,facesA:t.faces.filter(I=>this.state.getFaceColor(I)===d),facesB:t.faces.filter(I=>this.state.getFaceColor(I)===A)})}}const l=this.dirtyVertices.pop();assertEnabled()&&assert$2(l===t)}return null}clone(t){return new VertexToFaceColorSolver(this.board,t,this.dirtyVertices)}dispose(){this.state.vertexStateChangedEmitter.removeListener(this.vertexListener)}}class FaceStateSetAction{constructor(t,s){this.face=t,this.state=s}apply(t){t.setFaceState(this.face,this.state)}getUndo(t){const s=t.getFaceState(this.face);return new FaceStateSetAction(this.face,s)}isEmpty(){return!1}serializeAction(){return{type:"FaceStateSetAction",face:serializeFace(this.face),state:this.state.serialize()}}static deserializeAction(t,s){const r=deserializeFace(t,s.face);return new FaceStateSetAction(r,FaceState.deserialize(r,s.state))}}class VertexColorToFaceSolver{constructor(t,s,r){gt(this,"dirtyFaces");gt(this,"faceValueListener");gt(this,"vertexStateListener");gt(this,"faceColorListener");this.board=t,this.state=s,r?this.dirtyFaces=new Set(r):this.dirtyFaces=new Set(t.faces.filter(o=>s.getFaceValue(o)!==null)),this.faceValueListener=(o,n)=>{this.dirtyFaces.add(o)},this.state.faceValueChangedEmitter.addListener(this.faceValueListener),this.vertexStateListener=o=>{for(const n of o.faces)this.dirtyFaces.add(n)},this.state.vertexStateChangedEmitter.addListener(this.vertexStateListener),this.faceColorListener=(o,n,l,h)=>{const g=d=>{this.dirtyFaces.add(d);for(const A of d.edges){const S=A.getOtherFace(d);S&&this.dirtyFaces.add(S)}};for(const d of h)g(d);for(const d of[...o,...l]){const A=this.state.getFacesWithColor(d);for(const S of A)g(S)}},this.state.faceColorsChangedEmitter.addListener(this.faceColorListener)}get dirty(){return this.dirtyFaces.size>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyFaces.size;){const t=this.dirtyFaces.values().next().value;this.dirtyFaces.delete(t);const s=this.state.getFaceState(t),r=FaceState.fromVertexAndColorData(t,this.board,this.state).and(s);if(!s.equals(r))return new AnnotatedAction(new FaceStateSetAction(t,r),{type:"FaceState",face:t,beforeState:s,afterState:r})}return null}clone(t){return new VertexColorToFaceSolver(this.board,t)}dispose(){this.state.faceValueChangedEmitter.removeListener(this.faceValueListener),this.state.vertexStateChangedEmitter.removeListener(this.vertexStateListener),this.state.faceColorsChangedEmitter.removeListener(this.faceColorListener)}}class FaceToEdgeSolver{constructor(t,s,r,o){gt(this,"dirtyFaces",[]);gt(this,"vertexListener");this.board=t,this.state=s,this.options=r,o?this.dirtyFaces.push(...o):this.dirtyFaces.push(...t.faces),this.vertexListener=n=>{this.dirtyFaces.push(n)},this.state.faceStateChangedEmitter.addListener(this.vertexListener)}get dirty(){return this.dirtyFaces.length>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyFaces.length;){const t=this.dirtyFaces.pop(),s=this.state.getFaceState(t);if(s.possibilityCount===0)throw new InvalidStateError("Face has no possibilities");const r=[],o=[];for(const n of t.edges)if(this.state.getEdgeState(n)===EdgeState.WHITE){const h=s.getFinalStatesOfEdge(n);if(h.size===1){const g=[...h][0];g===EdgeState.RED&&this.options.solveToRed&&r.push(n),g===EdgeState.BLACK&&this.options.solveToBlack&&o.push(n)}}if(r.length||o.length)return new AnnotatedAction(new CompositeAction([...r.map(n=>new EdgeStateSetAction(n,EdgeState.RED)),...o.map(n=>new EdgeStateSetAction(n,EdgeState.BLACK))]),{type:"FaceStateToEdge",face:t,toRedEdges:r,toBlackEdges:o})}return null}clone(t){return new FaceToEdgeSolver(this.board,t,this.options,this.dirtyFaces)}dispose(){this.state.faceStateChangedEmitter.removeListener(this.vertexListener)}}class FaceToSectorSolver{constructor(t,s,r){gt(this,"dirtyFaces",[]);gt(this,"faceListener");this.board=t,this.state=s,r?this.dirtyFaces.push(...r):this.dirtyFaces.push(...t.faces),this.faceListener=o=>{this.dirtyFaces.push(o)},this.state.faceStateChangedEmitter.addListener(this.faceListener)}get dirty(){return this.dirtyFaces.length>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyFaces.length;){const t=this.dirtyFaces.pop(),s=this.state.getFaceState(t);if(s.possibilityCount===0)throw new InvalidStateError("Face has no possibilities");const r=t.halfEdges,o=r.map(d=>this.state.getSectorState(d)),n=r.map(d=>SectorState.NONE);for(const d of s.getAllowedCombinations())for(let A=0;A<r.length;A++){const S=r[A],O=S.edge,I=S.next.edge,W=(d.includes(O)?1:0)+(d.includes(I)?1:0);n[A]=n[A].with(W)}for(let d=0;d<r.length;d++)n[d]=n[d].and(o[d]);for(const d of n)if(d===SectorState.NONE)throw new InvalidStateError("Sector has no possibilities");const l=[],h=[],g=[];for(let d=0;d<r.length;d++)o[d]!==n[d]&&(l.push(r[d]),h.push(o[d]),g.push(n[d]));if(l.length)return new AnnotatedAction(new CompositeAction(l.map((d,A)=>new SectorStateSetAction(d,g[A]))),{type:"FaceStateToSector",face:t,sectors:l,beforeStates:h,afterStates:g})}return null}clone(t){return new FaceToSectorSolver(this.board,t,this.dirtyFaces)}dispose(){this.state.faceStateChangedEmitter.removeListener(this.faceListener)}}class FaceToFaceColorSolver{constructor(t,s,r){gt(this,"dirtyFaces",[]);gt(this,"faceListener");this.board=t,this.state=s,r?this.dirtyFaces.push(...r):this.dirtyFaces.push(...t.faces),this.faceListener=o=>{this.dirtyFaces.push(o)},this.state.faceStateChangedEmitter.addListener(this.faceListener)}get dirty(){return this.dirtyFaces.length>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyFaces.length;){const t=this.dirtyFaces[this.dirtyFaces.length-1],s=this.state.getFaceState(t);if(s.possibilityCount===0)throw new InvalidStateError("Face has no possibilities");const r=new Map(t.edges.map(g=>{const d=g.getOtherFace(t);return[g,d?this.state.getFaceColor(d):this.state.getOutsideColor()]})),o=[t,...t.edges.map(g=>g.getOtherFace(t)).filter(_$1.identity)],n=this.state.getFaceColor(t),l=new Set([...r.values(),n]);if(l.size!==1){const g=new Map([...l].map(A=>[A,new Map([...l].map(S=>[S,!1]))])),d=new Map([...l].map(A=>[A,new Map([...l].map(S=>[S,!1]))]));for(const A of s.getAllowedCombinations()){const S=new Set([n]),O=new Set;for(const W of t.edges)A.includes(W)?O.add(r.get(W)):S.add(r.get(W));const I=W=>{for(let L=0;L<W.length;L++)for(let H=L+1;H<W.length;H++)g.get(W[L]).set(W[H],!0),g.get(W[H]).set(W[L],!0)};I([...S]),I([...O]);for(const W of S)for(const L of O)W!==L&&(d.get(W).set(L,!0),d.get(L).set(W,!0))}for(const A of l)for(const S of l){if(A===S)continue;const O=g.get(A).get(S),I=d.get(A).get(S);if(O&&!I)return new AnnotatedAction(new FaceColorMakeSameAction(getFaceColorPointer(this.state,A),getFaceColorPointer(this.state,S)),{type:"FaceStateToSameFaceColor",face:t,facesA:o.filter(W=>this.state.getFaceColor(W)===A),facesB:o.filter(W=>this.state.getFaceColor(W)===S)});if(I&&!O&&this.state.getOppositeFaceColor(A)!==S)return new AnnotatedAction(new FaceColorMakeOppositeAction(getFaceColorPointer(this.state,A),getFaceColorPointer(this.state,S)),{type:"FaceStateToOppositeFaceColor",face:t,facesA:o.filter(W=>this.state.getFaceColor(W)===A),facesB:o.filter(W=>this.state.getFaceColor(W)===S)})}}const h=this.dirtyFaces.pop();assertEnabled()&&assert$2(h===t)}return null}clone(t){return new FaceToFaceColorSolver(this.board,t,this.dirtyFaces)}dispose(){this.state.faceStateChangedEmitter.removeListener(this.faceListener)}}class FaceToVertexSolver{constructor(t,s,r){gt(this,"dirtyFaces",[]);gt(this,"faceListener");this.board=t,this.state=s,r?this.dirtyFaces.push(...r):this.dirtyFaces.push(...t.faces),this.faceListener=o=>{this.dirtyFaces.push(o)},this.state.faceStateChangedEmitter.addListener(this.faceListener)}get dirty(){return this.dirtyFaces.length>0}nextAction(){if(!this.dirty)return null;for(;this.dirtyFaces.length;){const t=this.dirtyFaces.pop(),s=this.state.getFaceState(t);if(s.possibilityCount===0)throw new InvalidStateError("Face has no possibilities");const r=t.vertices.map(h=>this.state.getVertexState(h)),o=r.map(h=>{const g=h.vertex.edges.filter(d=>d.faces.includes(t));return assertEnabled()&&assert$2(g.length===2),{vertex:h.vertex,vertexState:h,edgeA:g[0],edgeB:g[1],...h.getBinaryCombinationsAllowed(g[0],g[1])}}),n=o.map(h=>({vertex:h.vertex,vertexState:h.vertexState,edgeA:h.edgeA,edgeB:h.edgeB,allowsNone:!1,allowsBoth:!1,allowsAOnly:!1,allowsBOnly:!1}));for(const h of s.getAllowedCombinations())for(const g of n){const d=h.includes(g.edgeA),A=h.includes(g.edgeB);d&&A&&(g.allowsBoth=!0),d&&!A&&(g.allowsAOnly=!0),!d&&A&&(g.allowsBOnly=!0),!d&&!A&&(g.allowsNone=!0)}const l=[];for(let h=0;h<n.length;h++){const g=o[h],d=n[h];if(d.allowsBoth&&(d.allowsBoth=g.allowsBoth),d.allowsAOnly&&(d.allowsAOnly=g.allowsAOnly),d.allowsBOnly&&(d.allowsBOnly=g.allowsBOnly),d.allowsNone&&(d.allowsNone=g.allowsNone),d.allowsBoth!==g.allowsBoth||d.allowsAOnly!==g.allowsAOnly||d.allowsBOnly!==g.allowsBOnly||d.allowsNone!==g.allowsNone){const A=g.vertexState,S=VertexState.fromLookup(g.vertex,(O,I)=>{if(!A.allowsPair(O,I))return!1;const L=O===d.edgeA||I===d.edgeA,H=O===d.edgeB||I===d.edgeB;if(L&&H)return d.allowsBoth;if(L&&!H)return d.allowsAOnly;if(!L&&H)return d.allowsBOnly;if(!L&&!H)return d.allowsNone;throw new Error("Unreachable")},A.allowsEmpty()&&d.allowsNone);assertEnabled()&&assert$2(S.isSubsetOf(A)),A.equals(S)||l.push(S)}}if(l.length)return new AnnotatedAction(new CompositeAction(l.map(h=>new VertexStateSetAction(h.vertex,h))),{type:"FaceStateToVertexState",face:t,vertices:l.map(h=>h.vertex),beforeStates:l.map(h=>r.find(g=>g.vertex===h.vertex)),afterStates:l})}return null}clone(t){return new FaceToVertexSolver(this.board,t,this.dirtyFaces)}dispose(){this.state.faceStateChangedEmitter.removeListener(this.faceListener)}}const autoSolveEnabledProperty=new LocalStorageBooleanProperty("autoSolveEnabledProperty",!0),autoSolveToBlackProperty=new LocalStorageBooleanProperty("autoSolveToBlackProperty",!1),autoSolveSimpleLoopsProperty=new LocalStorageBooleanProperty("autoSolveSimpleLoopsProperty",!1),autoSolveSimpleVertexJointToRedProperty=new LocalStorageBooleanProperty("autoSolveSimpleVertexJointToRedProperty",!0),autoSolveSimpleVertexForcedLineToBlackProperty=new LocalStorageBooleanProperty("autoSolveSimpleVertexForcedLineToBlackProperty",!0),autoSolveSimpleVertexAlmostEmptyToRedProperty=new LocalStorageBooleanProperty("autoSolveSimpleVertexAlmostEmptyToRedProperty",!0),autoSolveSimpleFaceToRedProperty=new LocalStorageBooleanProperty("autoSolveSimpleFaceToRedProperty",!0),autoSolveSimpleFaceToBlackProperty=new LocalStorageBooleanProperty("autoSolveSimpleFaceToBlackProperty",!0),autoSolveSimpleLoopToRedProperty=new LocalStorageBooleanProperty("autoSolveSimpleLoopToRedProperty",!0),autoSolveSimpleLoopToBlackProperty=new LocalStorageBooleanProperty("autoSolveSimpleLoopToBlackProperty",!1),autoSolveDoubleMinusOneFacesProperty=new LocalStorageBooleanProperty("autoSolveDoubleMinusOneFacesProperty",!1),autoSolveStaticFaceSectorProperty=new LocalStorageBooleanProperty("autoSolveStaticFaceSectorProperty",!0),autoSolveSimpleSectorProperty=new LocalStorageBooleanProperty("autoSolveSimpleSectorProperty",!1),autoSolveVertexToRedEdgeProperty=new LocalStorageBooleanProperty("autoSolveVertexToRedEdgeProperty",!1),autoSolveVertexToBlackEdgeProperty=new LocalStorageBooleanProperty("autoSolveVertexToBlackEdgeProperty",!1),autoSolveVertexToSectorsProperty=new LocalStorageBooleanProperty("autoSolveVertexToSectorsProperty",!1),autoSolveVertexToFaceColorProperty=new LocalStorageBooleanProperty("autoSolveVertexToFaceColorProperty",!1),autoSolveFaceColorToRedProperty=new LocalStorageBooleanProperty("autoSolveFaceColorToRedProperty",!1),autoSolveFaceColorToBlackProperty=new LocalStorageBooleanProperty("autoSolveFaceColorToBlackProperty",!1),autoSolveFaceColorParityToRedProperty=new LocalStorageBooleanProperty("autoSolveFaceColorParityToRedProperty",!1),autoSolveFaceColorParityToBlackProperty=new LocalStorageBooleanProperty("autoSolveFaceColorParityToBlackProperty",!1),autoSolveFaceColorParityColorsProperty=new LocalStorageBooleanProperty("autoSolveFaceColorParityColorsProperty",!1),autoSolveFaceColorParityPartialReductionProperty=new LocalStorageBooleanProperty("autoSolveFaceColorParityPartialReductionProperty",!1),autoSolveVertexColorToFaceProperty=new LocalStorageBooleanProperty("autoSolveVertexColorToFaceProperty",!1),autoSolveFaceToRedProperty=new LocalStorageBooleanProperty("autoSolveFaceToRedProperty",!1),autoSolveFaceToBlackProperty=new LocalStorageBooleanProperty("autoSolveFaceToBlackProperty",!1),autoSolveFaceToSectorsProperty=new LocalStorageBooleanProperty("autoSolveFaceToSectorsProperty",!1),autoSolveFaceToFaceColorsProperty=new LocalStorageBooleanProperty("autoSolveFaceToFaceColorsProperty",!1),autoSolveFaceToVertexProperty=new LocalStorageBooleanProperty("autoSolveFaceToVertexProperty",!1),safeSolverFactory=(a,t,s)=>new CompositeSolver([new SafeEdgeToSimpleRegionSolver(a,t),new SafeSolvedEdgeSolver(a,t),new SafeEdgeToFaceColorSolver(a,t),new SafeEdgeToSectorSolver(a,t),new SafeEdgeSectorColorToVertexSolver(a,t)]),getSafeSolverFactory=(a,t,s,r)=>(o,n,l)=>{const h=[new SafeEdgeToSimpleRegionSolver(o,n),new SafeSolvedEdgeSolver(o,n)];return(a||t||s||r)&&(h.push(new SafeEdgeToFaceColorSolver(o,n)),(t||s||r)&&(h.push(new SafeEdgeToSectorSolver(o,n)),(s||r)&&(h.push(new SafeEdgeSectorColorToVertexSolver(o,n)),r&&h.push(new VertexColorToFaceSolver(o,n))))),new CompositeSolver(h)},safeSolve=(a,t)=>{iterateSolverFactory(safeSolverFactory,a,t,!0)},safeSolveWithFactory=(a,t,s)=>{iterateSolverFactory(s,a,t,!0)},finalStateSolverFactory=(a,t,s)=>new CompositeSolver([safeSolverFactory(a,t),new VertexColorToFaceSolver(a,t)]),finalStateSolve=(a,t)=>{iterateSolverFactory(finalStateSolverFactory,a,t,!0)},autoSolverFactoryProperty=new DerivedProperty([autoSolveSimpleVertexJointToRedProperty,autoSolveSimpleVertexForcedLineToBlackProperty,autoSolveSimpleVertexAlmostEmptyToRedProperty,autoSolveSimpleFaceToRedProperty,autoSolveSimpleFaceToBlackProperty,autoSolveSimpleLoopToRedProperty,autoSolveSimpleLoopToBlackProperty,autoSolveDoubleMinusOneFacesProperty,autoSolveStaticFaceSectorProperty,autoSolveSimpleSectorProperty,autoSolveVertexToRedEdgeProperty,autoSolveVertexToBlackEdgeProperty,autoSolveVertexToSectorsProperty,autoSolveVertexToFaceColorProperty,autoSolveFaceColorToRedProperty,autoSolveFaceColorToBlackProperty,autoSolveFaceColorParityToRedProperty,autoSolveFaceColorParityToBlackProperty,autoSolveFaceColorParityColorsProperty,autoSolveFaceColorParityPartialReductionProperty,autoSolveVertexColorToFaceProperty,autoSolveFaceToRedProperty,autoSolveFaceToBlackProperty,autoSolveFaceToSectorsProperty,autoSolveFaceToFaceColorsProperty,autoSolveFaceToVertexProperty],(a,t,s,r,o,n,l,h,g,d,A,S,O,I,W,L,H,Y,Q,pe,de,fe,ye,Ee,Le,Z)=>(ne,Ke,_t)=>new CompositeSolver([...a||t||s?[new SimpleVertexSolver(ne,Ke,{solveJointToRed:a,solveForcedLineToBlack:t,solveAlmostEmptyToRed:s},_t?void 0:[])]:[],...r||o?[new SimpleFaceSolver(ne,Ke,{solveToRed:r,solveToBlack:o},_t?void 0:[])]:[],...h?[new StaticDoubleMinusOneFacesSolver(ne,Ke,_t?void 0:[])]:[],safeSolverFactory(ne,Ke),...g?[new StaticSectorSolver(ne,Ke,_t?void 0:[])]:[],...d?[new SimpleSectorSolver(ne,Ke,_t?void 0:[])]:[],...n||l?[new SimpleLoopSolver(ne,Ke,{solveToRed:n,solveToBlack:l,resolveAllRegions:!1},_t?void 0:[])]:[],...A||S?[new VertexToEdgeSolver(ne,Ke,{solveToRed:A,solveToBlack:S},_t?void 0:[])]:[],...O?[new VertexToSectorSolver(ne,Ke,_t?void 0:[])]:[],...W||L?[new SimpleFaceColorSolver(ne,Ke,{solveToRed:W,solveToBlack:L},_t?void 0:[])]:[],...H||Y||Q?[new FaceColorParitySolver(ne,Ke,{solveToRed:H,solveToBlack:Y,solveColors:Q,allowPartialReduction:pe},_t?void 0:[])]:[],...I?[new VertexToFaceColorSolver(ne,Ke,_t?void 0:[])]:[],...de?[new VertexColorToFaceSolver(ne,Ke,_t?void 0:[])]:[],...fe||ye?[new FaceToEdgeSolver(ne,Ke,{solveToRed:fe,solveToBlack:ye},_t?void 0:[])]:[],...Ee?[new FaceToSectorSolver(ne,Ke,_t?void 0:[])]:[],...Le?[new FaceToFaceColorSolver(ne,Ke,_t?void 0:[])]:[],...Z?[new FaceToVertexSolver(ne,Ke,_t?void 0:[])]:[]])),standardSolverFactory=(a,t,s)=>new CompositeSolver([new SafeEdgeToSimpleRegionSolver(a,t),new SafeSolvedEdgeSolver(a,t),new SafeEdgeToFaceColorSolver(a,t),new SimpleVertexSolver(a,t,{solveJointToRed:!0,solveForcedLineToBlack:!0,solveAlmostEmptyToRed:!0}),new SimpleFaceSolver(a,t,{solveToRed:!0,solveToBlack:!0}),new SimpleLoopSolver(a,t,{solveToRed:!0,solveToBlack:!0,resolveAllRegions:!1}),new StaticDoubleMinusOneFacesSolver(a,t),new SafeEdgeToSectorSolver(a,t),new StaticSectorSolver(a,t),new SimpleSectorSolver(a,t),new SafeEdgeSectorColorToVertexSolver(a,t),new VertexToEdgeSolver(a,t,{solveToRed:!0,solveToBlack:!0}),new VertexToSectorSolver(a,t),new SimpleFaceColorSolver(a,t,{solveToRed:!0,solveToBlack:!0}),new FaceColorParitySolver(a,t,{solveToRed:!0,solveToBlack:!0,solveColors:!0,allowPartialReduction:!0}),new VertexToFaceColorSolver(a,t),new VertexColorToFaceSolver(a,t),new FaceToEdgeSolver(a,t,{solveToRed:!0,solveToBlack:!0}),new FaceToSectorSolver(a,t),new FaceToFaceColorSolver(a,t),new FaceToVertexSolver(a,t)]),customPuzzleStyle={edgesVisibleProperty,edgesHaveColorsProperty,faceColorsVisibleProperty,faceColorThresholdProperty,sectorsVisibleProperty,sectorsNextToEdgesVisibleProperty,sectorsTrivialVisibleProperty,vertexStateVisibleProperty,allVertexStateVisibleProperty,faceStateVisibleProperty,whiteLineVisibleProperty,redLineVisibleProperty,verticesVisibleProperty,smallVertexProperty,redXsVisibleProperty,redXsAlignedProperty,faceValueStyleProperty,redLineStyleProperty,vertexStyleProperty,joinedLinesJoinProperty,joinedLinesCapProperty,safeSolverFactoryProperty:new DerivedProperty([faceColorsVisibleProperty,sectorsVisibleProperty,vertexStateVisibleProperty,faceStateVisibleProperty],(a,t,s,r)=>getSafeSolverFactory(a,t,s,r)),autoSolverFactoryProperty,theme:currentTheme},getPartialPuzzleStyle=(a,t,s,r,o)=>{const n=getSafeSolverFactory(a,t,s,r);return{faceColorsVisibleProperty:new BooleanProperty(a),sectorsVisibleProperty:new BooleanProperty(t),vertexStateVisibleProperty:new BooleanProperty(s),faceStateVisibleProperty:new BooleanProperty(r),safeSolverFactoryProperty:new Property(n),autoSolverFactoryProperty:o?new DerivedProperty([o],l=>(h,g,d)=>new CompositeSolver([n(h,g,d),l(h,g,d)])):new Property(n)}},basicSolverFactoryProperty=new DerivedProperty([autoSolveToBlackProperty,autoSolveSimpleLoopsProperty],(a,t)=>(s,r,o)=>new CompositeSolver([new SimpleVertexSolver(s,r,{solveJointToRed:!0,solveForcedLineToBlack:a,solveAlmostEmptyToRed:!0},o?void 0:[]),new SimpleFaceSolver(s,r,{solveToRed:!0,solveToBlack:a},o?void 0:[]),...t?[new SimpleLoopSolver(s,r,{solveToRed:!0,solveToBlack:a,resolveAllRegions:!1},o?void 0:[])]:[]])),sectorSolverFactoryProperty=new DerivedProperty([basicSolverFactoryProperty],a=>(t,s,r)=>new CompositeSolver([a(t,s,r),new StaticSectorSolver(t,s,r?void 0:[])])),basicLinesPuzzleStyle={...getPartialPuzzleStyle(!0,!1,!1,!1,basicSolverFactoryProperty),theme:currentTheme,edgesVisibleProperty:new TinyProperty(!0),edgesHaveColorsProperty:new TinyProperty(!0),faceColorThresholdProperty:new TinyProperty(Number.POSITIVE_INFINITY),sectorsNextToEdgesVisibleProperty:new TinyProperty(!1),sectorsTrivialVisibleProperty:new TinyProperty(!1),allVertexStateVisibleProperty:new TinyProperty(!1),whiteLineVisibleProperty:new TinyProperty(!0),redLineVisibleProperty,verticesVisibleProperty:new TinyProperty(!1),smallVertexProperty:new TinyProperty(!1),redXsVisibleProperty:new TinyProperty(!1),redXsAlignedProperty:new TinyProperty(!1),faceValueStyleProperty,redLineStyleProperty:new TinyProperty("middle"),vertexStyleProperty:new TinyProperty("round"),joinedLinesJoinProperty:new TinyProperty("round"),joinedLinesCapProperty:new TinyProperty("round")},basicFaceColoringPuzzleStyle={...getPartialPuzzleStyle(!0,!1,!1,!1,basicSolverFactoryProperty),theme:currentTheme,edgesVisibleProperty:new TinyProperty(!0),edgesHaveColorsProperty:new TinyProperty(!1),faceColorThresholdProperty:new TinyProperty(2),sectorsNextToEdgesVisibleProperty:new TinyProperty(!1),sectorsTrivialVisibleProperty:new TinyProperty(!1),allVertexStateVisibleProperty:new TinyProperty(!1),whiteLineVisibleProperty:new TinyProperty(!0),redLineVisibleProperty,verticesVisibleProperty:new TinyProperty(!1),smallVertexProperty:new TinyProperty(!1),redXsVisibleProperty:new TinyProperty(!1),redXsAlignedProperty:new TinyProperty(!1),faceValueStyleProperty,redLineStyleProperty:new TinyProperty("middle"),vertexStyleProperty:new TinyProperty("round"),joinedLinesJoinProperty:new TinyProperty("round"),joinedLinesCapProperty:new TinyProperty("round")},pureFaceColorPuzzleStyle={...getPartialPuzzleStyle(!0,!1,!1,!1,new Property((a,t,s)=>new CompositeSolver([new SimpleFaceColorSolver(a,t,{solveToRed:!0,solveToBlack:!0},s?void 0:[])]))),theme:currentTheme,edgesVisibleProperty:new TinyProperty(!1),edgesHaveColorsProperty:new TinyProperty(!1),faceColorThresholdProperty:new TinyProperty(2),sectorsNextToEdgesVisibleProperty:new TinyProperty(!1),sectorsTrivialVisibleProperty:new TinyProperty(!1),allVertexStateVisibleProperty:new TinyProperty(!1),whiteLineVisibleProperty:new TinyProperty(!1),redLineVisibleProperty,verticesVisibleProperty:new TinyProperty(!1),smallVertexProperty:new TinyProperty(!1),redXsVisibleProperty:new TinyProperty(!1),redXsAlignedProperty:new TinyProperty(!1),faceValueStyleProperty,redLineStyleProperty:new TinyProperty("middle"),vertexStyleProperty:new TinyProperty("round"),joinedLinesJoinProperty:new TinyProperty("round"),joinedLinesCapProperty:new TinyProperty("round")},classicPuzzleStyle={...getPartialPuzzleStyle(!1,!1,!1,!1,basicSolverFactoryProperty),theme:currentTheme,edgesVisibleProperty:new TinyProperty(!0),edgesHaveColorsProperty:new TinyProperty(!1),faceColorThresholdProperty:new TinyProperty(Number.POSITIVE_INFINITY),sectorsNextToEdgesVisibleProperty:new TinyProperty(!1),sectorsTrivialVisibleProperty:new TinyProperty(!1),allVertexStateVisibleProperty:new TinyProperty(!1),whiteLineVisibleProperty:new TinyProperty(!1),redLineVisibleProperty,verticesVisibleProperty:new TinyProperty(!0),smallVertexProperty:new TinyProperty(!1),redXsVisibleProperty:new TinyProperty(!0),redXsAlignedProperty:new TinyProperty(!1),faceValueStyleProperty,redLineStyleProperty:new TinyProperty("middle"),vertexStyleProperty:new TinyProperty("square"),joinedLinesJoinProperty:new TinyProperty("miter"),joinedLinesCapProperty:new TinyProperty("square")},basicSectorsPuzzleStyle={...getPartialPuzzleStyle(!0,!0,!1,!1,sectorSolverFactoryProperty),theme:currentTheme,edgesVisibleProperty:new TinyProperty(!0),edgesHaveColorsProperty:new TinyProperty(!0),faceColorThresholdProperty:new TinyProperty(Number.POSITIVE_INFINITY),sectorsNextToEdgesVisibleProperty:new TinyProperty(!1),sectorsTrivialVisibleProperty:new TinyProperty(!1),allVertexStateVisibleProperty:new TinyProperty(!1),whiteLineVisibleProperty:new TinyProperty(!0),redLineVisibleProperty,verticesVisibleProperty:new TinyProperty(!1),smallVertexProperty:new TinyProperty(!1),redXsVisibleProperty:new TinyProperty(!1),redXsAlignedProperty:new TinyProperty(!1),faceValueStyleProperty,redLineStyleProperty:new TinyProperty("middle"),vertexStyleProperty:new TinyProperty("round"),joinedLinesJoinProperty:new TinyProperty("round"),joinedLinesCapProperty:new TinyProperty("round")},sectorsWithColorsPuzzleStyle={...getPartialPuzzleStyle(!0,!0,!1,!1,sectorSolverFactoryProperty),theme:currentTheme,edgesVisibleProperty:new TinyProperty(!0),edgesHaveColorsProperty:new TinyProperty(!1),faceColorThresholdProperty:new TinyProperty(2),sectorsNextToEdgesVisibleProperty:new TinyProperty(!1),sectorsTrivialVisibleProperty:new TinyProperty(!1),allVertexStateVisibleProperty:new TinyProperty(!1),whiteLineVisibleProperty:new TinyProperty(!0),redLineVisibleProperty,verticesVisibleProperty:new TinyProperty(!1),smallVertexProperty:new TinyProperty(!1),redXsVisibleProperty:new TinyProperty(!1),redXsAlignedProperty:new TinyProperty(!1),faceValueStyleProperty,redLineStyleProperty:new TinyProperty("middle"),vertexStyleProperty:new TinyProperty("round"),joinedLinesJoinProperty:new TinyProperty("round"),joinedLinesCapProperty:new TinyProperty("round")},vertexStatePuzzleStyle={...getPartialPuzzleStyle(!0,!1,!0,!1,basicSolverFactoryProperty),theme:currentTheme,edgesVisibleProperty:new TinyProperty(!0),edgesHaveColorsProperty:new TinyProperty(!1),faceColorThresholdProperty:new TinyProperty(2),sectorsNextToEdgesVisibleProperty:new TinyProperty(!1),sectorsTrivialVisibleProperty:new TinyProperty(!1),allVertexStateVisibleProperty:new TinyProperty(!1),whiteLineVisibleProperty:new TinyProperty(!0),redLineVisibleProperty,verticesVisibleProperty:new TinyProperty(!1),smallVertexProperty:new TinyProperty(!1),redXsVisibleProperty:new TinyProperty(!1),redXsAlignedProperty:new TinyProperty(!1),faceValueStyleProperty,redLineStyleProperty:new TinyProperty("middle"),vertexStyleProperty:new TinyProperty("round"),joinedLinesJoinProperty:new TinyProperty("round"),joinedLinesCapProperty:new TinyProperty("round")},faceStatePuzzleStyle={...getPartialPuzzleStyle(!0,!1,!1,!0,basicSolverFactoryProperty),theme:currentTheme,edgesVisibleProperty:new TinyProperty(!0),edgesHaveColorsProperty:new TinyProperty(!1),faceColorThresholdProperty:new TinyProperty(2),sectorsNextToEdgesVisibleProperty:new TinyProperty(!1),sectorsTrivialVisibleProperty:new TinyProperty(!1),allVertexStateVisibleProperty:new TinyProperty(!1),whiteLineVisibleProperty:new TinyProperty(!0),redLineVisibleProperty,verticesVisibleProperty:new TinyProperty(!1),smallVertexProperty:new TinyProperty(!1),redXsVisibleProperty:new TinyProperty(!1),redXsAlignedProperty:new TinyProperty(!1),faceValueStyleProperty,redLineStyleProperty:new TinyProperty("middle"),vertexStyleProperty:new TinyProperty("round"),joinedLinesJoinProperty:new TinyProperty("round"),joinedLinesCapProperty:new TinyProperty("round")},puzzleStyleMap={basicLines:basicLinesPuzzleStyle,basicFaceColoring:basicFaceColoringPuzzleStyle,pureFaceColor:pureFaceColorPuzzleStyle,classic:classicPuzzleStyle,basicSectors:basicSectorsPuzzleStyle,sectorsWithColors:sectorsWithColorsPuzzleStyle,vertexState:vertexStatePuzzleStyle,faceState:faceStatePuzzleStyle,custom:customPuzzleStyle},defaultPuzzleStyle=basicLinesPuzzleStyle,puzzleStyleFromProperty=a=>({edgesVisibleProperty:new DynamicProperty(a,{derive:"edgesVisibleProperty"}),edgesHaveColorsProperty:new DynamicProperty(a,{derive:"edgesHaveColorsProperty"}),faceColorsVisibleProperty:new DynamicProperty(a,{derive:"faceColorsVisibleProperty"}),faceColorThresholdProperty:new DynamicProperty(a,{derive:"faceColorThresholdProperty"}),sectorsVisibleProperty:new DynamicProperty(a,{derive:"sectorsVisibleProperty"}),sectorsNextToEdgesVisibleProperty:new DynamicProperty(a,{derive:"sectorsNextToEdgesVisibleProperty"}),sectorsTrivialVisibleProperty:new DynamicProperty(a,{derive:"sectorsTrivialVisibleProperty"}),vertexStateVisibleProperty:new DynamicProperty(a,{derive:"vertexStateVisibleProperty"}),allVertexStateVisibleProperty:new DynamicProperty(a,{derive:"allVertexStateVisibleProperty"}),faceStateVisibleProperty:new DynamicProperty(a,{derive:"faceStateVisibleProperty"}),whiteLineVisibleProperty:new DynamicProperty(a,{derive:"whiteLineVisibleProperty"}),redLineVisibleProperty:new DynamicProperty(a,{derive:"redLineVisibleProperty"}),verticesVisibleProperty:new DynamicProperty(a,{derive:"verticesVisibleProperty"}),smallVertexProperty:new DynamicProperty(a,{derive:"smallVertexProperty"}),redXsVisibleProperty:new DynamicProperty(a,{derive:"redXsVisibleProperty"}),redXsAlignedProperty:new DynamicProperty(a,{derive:"redXsAlignedProperty"}),faceValueStyleProperty:new DynamicProperty(a,{derive:"faceValueStyleProperty"}),redLineStyleProperty:new DynamicProperty(a,{derive:"redLineStyleProperty"}),vertexStyleProperty:new DynamicProperty(a,{derive:"vertexStyleProperty"}),joinedLinesJoinProperty:new DynamicProperty(a,{derive:"joinedLinesJoinProperty"}),joinedLinesCapProperty:new DynamicProperty(a,{derive:"joinedLinesCapProperty"}),safeSolverFactoryProperty:new DynamicProperty(a,{derive:"safeSolverFactoryProperty"}),autoSolverFactoryProperty:new DynamicProperty(a,{derive:"autoSolverFactoryProperty"}),theme:themeFromProperty(new DerivedProperty([a],t=>t.theme))}),puzzleStyleProperty=new LocalStorageProperty("puzzleStyle",{serialize:a=>Object.keys(puzzleStyleMap).find(t=>puzzleStyleMap[t]===a),deserialize:a=>a?puzzleStyleMap[a]??defaultPuzzleStyle:defaultPuzzleStyle}),currentPuzzleStyle=puzzleStyleFromProperty(puzzleStyleProperty),showPuzzleStyleProperty=new LocalStorageBooleanProperty("showPuzzleStyleProperty",!1),rn=class rn extends EnumerationValue{constructor(t){super(),this.isEnabledProperty=t}};gt(rn,"EDGE_STATE",new rn(new BooleanProperty(!0))),gt(rn,"EDGE_STATE_REVERSED",new rn(new BooleanProperty(!0))),gt(rn,"FACE_COLOR_MATCH",new rn(currentPuzzleStyle.faceColorsVisibleProperty)),gt(rn,"FACE_COLOR_OPPOSITE",new rn(currentPuzzleStyle.faceColorsVisibleProperty)),gt(rn,"SECTOR_STATE",new rn(currentPuzzleStyle.sectorsVisibleProperty)),gt(rn,"VERTEX_STATE",new rn(currentPuzzleStyle.vertexStateVisibleProperty)),gt(rn,"FACE_STATE",new rn(currentPuzzleStyle.faceStateVisibleProperty)),gt(rn,"FACE_VALUE",new rn(new BooleanProperty(!1))),gt(rn,"DELETE_FACE",new rn(new BooleanProperty(!1))),gt(rn,"enumeration",new Enumeration(rn));let EditMode=rn;const editModeProperty=new LocalStorageEnumerationProperty("editModeProperty",EditMode.EDGE_STATE);let listenedMode=null;const onEditModeEnabledChange=a=>{a||(editModeProperty.value=EditMode.EDGE_STATE)};editModeProperty.link(a=>{listenedMode&&listenedMode.isEnabledProperty.unlink(onEditModeEnabledChange),listenedMode=a,a.isEnabledProperty.link(onEditModeEnabledChange)});const tryToSetEditMode=a=>{a.isEnabledProperty.value&&(editModeProperty.value=a)},isEdgeEditModeProperty=new DerivedProperty([editModeProperty],a=>a===EditMode.EDGE_STATE||a===EditMode.EDGE_STATE_REVERSED),isFaceColorEditModeProperty=new DerivedProperty([editModeProperty],a=>a===EditMode.FACE_COLOR_MATCH||a===EditMode.FACE_COLOR_OPPOSITE),isSectorEditModeProperty=new DerivedProperty([editModeProperty],a=>a===EditMode.SECTOR_STATE),isVertexEditModeProperty=new DerivedProperty([editModeProperty],a=>a===EditMode.VERTEX_STATE),isFaceEditModeProperty=new DerivedProperty([editModeProperty,isFaceColorEditModeProperty],(a,t)=>t||a===EditMode.FACE_STATE||a===EditMode.FACE_VALUE||a===EditMode.DELETE_FACE),getCoordinateClusteredMap=(a,t)=>{const s=_$1.sortBy(a),r=[];let o=[];for(let l=0;l<s.length;l++){const h=s[l];o.length===0||Math.abs(o[o.length-1]-h)<=t?o.push(h):(r.push(o),o=[h])}o.length>0&&r.push(o);const n=new Map;return r.forEach(l=>{const h=_$1.sum(l)/l.length;l.forEach(g=>n.set(g,h))}),n};export{puzzleFromCompressedString as $,AnimatedPanZoomListener as A,BaseBoard as B,CompleteData as C,DotUtils as D,EdgeState as E,uiFont as F,HSeparator as G,HBox as H,Image$1 as I,dotRandom as J,DynamicProperty as K,Line as L,Matrix$1 as M,Node$2 as N,rectangularButtonAppearanceStrategy as O,Path as P,TextPushButton as Q,Rectangle as R,SingularValueDecomposition as S,Text as T,controlBarFont as U,Vector2 as V,RectangularPushButton as W,showUndoRedoAllProperty as X,controlBarMargin as Y,SlitherQueryParameters as Z,_$1 as _,assertEnabled as a,isVertexEditModeProperty as a$,getSolvablePropertyPuzzle as a0,PuzzleModel as a1,Panel as a2,RectangularRadioButtonGroup as a3,editModeProperty as a4,EditMode as a5,DerivedProperty as a6,TinyProperty as a7,vertexStatePuzzleStyle as a8,faceStatePuzzleStyle as a9,Orientation as aA,satSolve as aB,MultipleSolutionsError as aC,InvalidStateError as aD,HexagonalBoard as aE,finalStateSolve as aF,standardSolverFactory as aG,simpleRegionIsSolved as aH,CompleteValidator as aI,FireListener as aJ,isFaceColorEditModeProperty as aK,LineStyles as aL,Graph$1 as aM,puzzleFont as aN,arrayDifference as aO,EnumerationValue as aP,Enumeration as aQ,FaceColorState as aR,Color as aS,SectorState as aT,Circle as aU,VertexState as aV,GridBox as aW,showHoverHighlightsProperty as aX,isFaceEditModeProperty as aY,isSectorEditModeProperty as aZ,isEdgeEditModeProperty as a_,puzzleStyleProperty as aa,basicLinesPuzzleStyle as ab,basicFaceColoringPuzzleStyle as ac,pureFaceColorPuzzleStyle as ad,classicPuzzleStyle as ae,basicSectorsPuzzleStyle as af,sectorsWithColorsPuzzleStyle as ag,customPuzzleStyle as ah,Display as ai,Property as aj,AlignBox as ak,showPuzzleStyleProperty as al,ManualConstraint as am,tryToSetEditMode as an,platform as ao,StringProperty as ap,Font as aq,NumberProperty as ar,PatternStringProperty as as,getAugmentedNamespace as at,commonjsGlobal as au,getDefaultExportFromCjs as av,optionize3 as aw,ConvexHull2 as ax,getCoordinateClusteredMap as ay,SquareBoard as az,assert$2 as b,autoSolveFaceToBlackProperty as b$,LocalStorageBooleanProperty as b0,BaseHalfEdge as b1,BaseEdge as b2,BaseFace as b3,BaseVertex as b4,sceneryPhet as b5,InstanceRegistry as b6,Dimension2 as b7,stepTimer as b8,PressListener as b9,KeyboardListener as bA,Checkbox as bB,VerticalAquaRadioButtonGroup as bC,uiHeaderFont as bD,OnOffSwitch as bE,autoSolveSimpleVertexJointToRedProperty as bF,autoSolveSimpleVertexForcedLineToBlackProperty as bG,autoSolveSimpleVertexAlmostEmptyToRedProperty as bH,autoSolveSimpleFaceToRedProperty as bI,autoSolveSimpleFaceToBlackProperty as bJ,autoSolveSimpleLoopToRedProperty as bK,autoSolveSimpleLoopToBlackProperty as bL,autoSolveDoubleMinusOneFacesProperty as bM,autoSolveStaticFaceSectorProperty as bN,autoSolveSimpleSectorProperty as bO,autoSolveVertexToRedEdgeProperty as bP,autoSolveVertexToBlackEdgeProperty as bQ,autoSolveVertexToSectorsProperty as bR,autoSolveVertexToFaceColorProperty as bS,autoSolveFaceColorToRedProperty as bT,autoSolveFaceColorToBlackProperty as bU,autoSolveFaceColorParityToRedProperty as bV,autoSolveFaceColorParityToBlackProperty as bW,autoSolveFaceColorParityColorsProperty as bX,autoSolveFaceColorParityPartialReductionProperty as bY,autoSolveVertexColorToFaceProperty as bZ,autoSolveFaceToRedProperty as b_,Animation as ba,Easing as bb,PaintColorProperty as bc,ColorDef$1 as bd,StringUtils as be,DerivedStringProperty as bf,Tandem as bg,ValueChangeSoundPlayer as bh,Range as bi,WidthSizable as bj,PhetFont as bk,Slider as bl,NumberDisplay as bm,ArrowButton as bn,nullSoundPlayer as bo,isWidthSizable as bp,extendsWidthSizable as bq,IOType as br,base64SoundToByteArray as bs,asyncLoader as bt,WrappedAudioBuffer as bu,phetAudioContext$1 as bv,SoundClipPlayer as bw,tambo as bx,BooleanRoundToggleButton as by,SceneryPhetStrings as bz,combineOptions as c,autoSolveFaceToSectorsProperty as c0,autoSolveFaceToFaceColorsProperty as c1,availableThemes as c2,themeProperty as c3,popupColorEditor as c4,edgesVisibleProperty as c5,edgesHaveColorsProperty as c6,faceColorsVisibleProperty as c7,sectorsVisibleProperty as c8,sectorsNextToEdgesVisibleProperty as c9,rescaleProtoDescriptorMinimum as cA,getSolvedPuzzle as cB,MaximumSolverIterationsError as cC,iterateSolverFactory as cD,LocalStorageEnumerationProperty as cE,AquaRadioButtonGroup as cF,LocalStorageProperty as cG,TinyEmitter as cH,generateButtonFont as cI,sectorsTrivialVisibleProperty as ca,vertexStateVisibleProperty as cb,allVertexStateVisibleProperty as cc,faceStateVisibleProperty as cd,whiteLineVisibleProperty as ce,redLineVisibleProperty as cf,verticesVisibleProperty as cg,smallVertexProperty as ch,redXsVisibleProperty as ci,redXsAlignedProperty as cj,autoSolveEnabledProperty as ck,autoSolveToBlackProperty as cl,autoSolveSimpleLoopsProperty as cm,uiHintUsesBuiltInSolveProperty as cn,lineJoins as co,joinedLinesJoinProperty as cp,lineCaps as cq,joinedLinesCapProperty as cr,vertexStyles as cs,vertexStyleProperty as ct,redLineStyles as cu,redLineStyleProperty as cv,faceValueStyles as cw,faceValueStyleProperty as cx,faceColorThresholdProperty as cy,createBoardDescriptor as cz,arrayRemove as d,getSignedArea as e,currentTheme as f,getCentroid as g,getSignedAreaDerivative as h,Matrix3 as i,Sizable as j,optionize as k,Multilink as l,currentPuzzleStyle as m,Bounds2 as n,okhslToRGBString as o,LinearGradient as p,RadialGradient as q,Shape$1 as r,safeSolve as s,toPropertyPuzzle as t,BooleanProperty as u,validateBoard as v,VBox as w,BasicPuzzle as x,puzzleToCompressedString as y,copyToClipboard as z};
