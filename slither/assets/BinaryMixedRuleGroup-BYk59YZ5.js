import{B as h,a as d,b as u}from"./BinaryRuleCollection-BKRM-FAV.js";import{_ as c}from"./createBoardDescriptor-DQiPBFka.js";class s{constructor(e,t){this.collection=e,this.mixedData=t}get size(){return this.collection.size}getRule(e){return this.collection.getRule(e,this.isRuleIndexHighlander(e))}isRuleIndexHighlander(e){return(this.mixedData[Math.floor(e/4)]&1<<2*(e%4))!==0}isRuleIndexFallback(e){return(this.mixedData[Math.floor(e/4)]&1<<2*(e%4)+1)!==0}withOnlyHighlander(){return this.filterIndex(e=>this.isRuleIndexHighlander(e))}withoutHighlander(){return this.filterIndex(e=>!this.isRuleIndexHighlander(e))}withoutFallback(){return this.filterIndex(e=>!this.isRuleIndexFallback(e))}withPatternBoardFilter(e){return this.filterIndex(t=>e(this.getRule(t).patternBoard))}withRuleIndices(e){const t=h.empty(),a=new Uint8Array(this.mixedData.length);let i=0;const n=(l,r,o)=>{t.addRule(l),a[Math.floor(i/4)]|=(r?1:0)<<2*(i%4),a[Math.floor(i/4)]|=(o?1:0)<<2*(i%4)+1,i++};for(let l=0;l<e.length;l++){const r=e[l];n(this.getRule(r),this.isRuleIndexHighlander(r),this.isRuleIndexFallback(r))}return new s(t,a)}filterIndex(e){return this.withRuleIndices(c.range(0,this.size).filter(e))}sortedIndex(e){return this.withRuleIndices(c.sortBy(c.range(0,this.size),t=>e(t)))}sortedDefault(){return this.sortedIndex(e=>{let t=this.getRule(e).getInputDifficultyScoreB();return this.isRuleIndexFallback(e)&&(t+=1e3),t})}serialize(){return{collection:this.collection.serialize(),mixedData:d(this.mixedData)}}static deserialize(e){const t=u(e.mixedData);if(t)return new s(h.deserialize(e.collection),t);throw new Error("could not read mixedData")}static fromGroup(e){const t=h.empty(),a=new Uint8Array(Math.ceil(e.size/4));let i=0;const n=(l,r,o)=>{t.addRule(l),a[Math.floor(i/4)]|=(r?1:0)<<2*(i%4),a[Math.floor(i/4)]|=(o?1:0)<<2*(i%4)+1,i++};return e.mainCollection&&e.mainCollection.forEachRule(l=>n(l,!1,!1)),e.highlanderCollection&&e.highlanderCollection.forEachRule(l=>n(l,!0,!1)),e.fallbackCollection&&e.fallbackCollection.forEachRule(l=>n(l,!1,!0)),e.highlanderFallbackCollection&&e.highlanderFallbackCollection.forEachRule(l=>n(l,!0,!0)),new s(t,a)}}export{s as B};
