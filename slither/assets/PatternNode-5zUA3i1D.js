import{o as _}from"./Vector2Property-DCXaH-JP.js";import{N as M,P as f,m as U,T as C}from"./PhetioControlledVisibilityProperty-sdyDHryr.js";import{a as $,b as B,S as l,g as A}from"./createBoardDescriptor-DQiPBFka.js";import{P as m,O as F}from"./Theme-Bnv1SKXL.js";import{d as ee,a as I,b as R,S as oe,c as Q,F as V,B as N,R as Z}from"./FaceColorDualFeature-CyAHgR8K.js";class le extends M{constructor(c,O,n,X){const P=_()({showQuestionMarks:!0,labels:!1},X),h=O.getFeaturesArray();$()&&B(n,"planarPatternMap should be defined");const i=new M({scale:30}),W=new l;c.faces.forEach(e=>{if(e.isExit&&e.edges.length<2)return;const o=n.faceMap.get(e);W.polygon(o)}),i.addChild(new f(W,{fill:"#000"}));const g=[255,160,20,96,70,230,0],D=g.map(()=>new l),H=g.map(()=>new l);h.filter(e=>e instanceof ee).forEach((e,o)=>{e.primaryFaces.forEach(t=>{const s=n.faceMap.get(t);D[o%g.length].polygon(s)}),e.secondaryFaces.forEach(t=>{const s=n.faceMap.get(t);H[o%g.length].polygon(s)})}),D.forEach((e,o)=>{e.bounds.isFinite()&&i.addChild(new f(e,{fill:m.faceColorLightHueLUTProperty.value[g[o]]}))}),H.forEach((e,o)=>{e.bounds.isFinite()&&i.addChild(new f(e,{fill:m.faceColorDarkHueLUTProperty.value[g[o]]}))}),c.sectors.forEach(e=>{const o=h.filter(t=>(t instanceof I||t instanceof R||t instanceof oe||t instanceof Q)&&t.sector===e);if(o.length){const t=o.some(E=>E instanceof Q),s=o.some(E=>E instanceof I),r=o.some(E=>E instanceof R),a=t,w=s,z=!a&&r,Y=!a&&!w,j=!a&&!z,q=a?m.sectorOnlyOneColorProperty:w?m.sectorNotOneColorProperty:z?m.sectorNotTwoColorProperty:m.sectorNotZeroColorProperty,v=n.sectorMap.get(e),G=v[0],d=v[1],J=v[2],L=G.minus(d),K=J.minus(d),b=L.normalized(),p=L.angle;let x=K.angle;x<p&&(x+=2*Math.PI);let k;const u=.25;j?k=new l().moveToPoint(b.timesScalar(u-.03).plus(d)).arcPoint(d,u-.03,p,x,!0).moveToPoint(b.timesScalar(u+.03).plus(d)).arcPoint(d,u+.03,p,x,!0).makeImmutable():k=new l().moveToPoint(b.timesScalar(u).plus(d)).arcPoint(d,u,p,x,!0).makeImmutable(),i.addChild(new f(k,{stroke:q,lineWidth:.02,lineDash:Y?[.03,.03]:[]}))}});const y=new l;c.edges.forEach(e=>{if(e.isExit)return;const o=n.edgeMap.get(e);y.moveToPoint(o[0]),y.lineToPoint(o[1])}),i.addChild(new f(y,{stroke:"rgba(255,255,255,0.2)",lineWidth:.01})),c.vertices.forEach(e=>{const o=e.isExit;i.addChild(new U(o?.06:.04,{center:n.vertexMap.get(e),lineWidth:.02,stroke:"rgba(255,255,255,0.2)",fill:o?"#222":"rgba(255,255,255,0.2)"}))}),c.faces.forEach(e=>{if(e.isExit){const o=h.find(t=>t instanceof V&&t.face===e)??null;if(o&&o.value===null){const t=n.faceMap.get(e),s=l.polygon(t);i.addChild(new f(s,{stroke:"#666",lineWidth:.05,lineDash:[.05,.05]}))}}else{const o=h.find(t=>t instanceof V&&t.face===e)??null;if(!o||o.value!==null){const t=o?o.value.toString():P.showQuestionMarks?"?":"";if(t.length){const s=n.faceMap.get(e),r=A(s),a=new C(t,{font:F,centerX:r.x,centerY:r.y,fill:o?"rgba(255,255,255,0.8)":"rgba(255,255,255,0.2)",maxWidth:.9,maxHeight:.9});i.addChild(a)}}}}),c.edges.forEach(e=>{if(e.isExit){const o=h.filter(s=>(s instanceof N||s instanceof Z)&&s.edge===e),t=e.exitVertex;o.forEach(s=>{const r=s instanceof N;i.addChild(new U(.12,{center:n.vertexMap.get(t),lineWidth:.03,stroke:r?"#000":"#f00"}))})}});const S=new l;c.edges.forEach(e=>{if(!e.isExit&&h.filter(t=>t instanceof Z&&t.edge===e).length){const t=n.edgeMap.get(e);S.moveToPoint(t[0]),S.lineToPoint(t[1])}}),i.addChild(new f(S,{stroke:"#f00",lineWidth:.05,lineCap:"round"}));const T=new l;c.edges.forEach(e=>{if(!e.isExit&&h.filter(t=>t instanceof N&&t.edge===e).length){const t=n.edgeMap.get(e);T.moveToPoint(t[0]),T.lineToPoint(t[1])}}),i.addChild(new f(T,{stroke:"#fff",lineWidth:.1,lineCap:"round"})),P.labels&&(c.edges.forEach(e=>{if(!e.isExit){const o=n.edgeMap.get(e),t=o[0].average(o[1]);i.addChild(new C(e.index,{font:F,center:t,fill:"#fa0",maxWidth:.4,maxHeight:.4}))}}),c.faces.forEach(e=>{const o=e.isExit,t=n.faceMap.get(e);let s=A(t);if(o){const r=s.minus(e.edges[0].vertices.map(a=>n.vertexMap.get(a)).reduce((a,w)=>a.plus(w)).timesScalar(.5));s=s.plus(r.timesScalar(1.5))}i.addChild(new C(e.index,{font:F,center:s,fill:o?"#0ff":"#0f0",maxWidth:.4,maxHeight:.4}))}),c.vertices.forEach(e=>{const o=n.vertexMap.get(e);i.addChild(new C(e.index,{font:F,center:o,fill:"#fff",maxWidth:.4,maxHeight:.4}))})),super({children:[i]}),this.patternBoard=c,this.featureSet=O,this.planarPatternMap=n}}export{le as P};
