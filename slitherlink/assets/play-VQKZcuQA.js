var eo=Object.defineProperty;var to=(d,o,e)=>o in d?eo(d,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[o]=e;var I=(d,o,e)=>(to(d,typeof o!="symbol"?o+"":o,e),e);import{o as Q,c as X,a as z,V as ee,D as de,M as We,S as oo,b as Ft,P as rt,B as Te,d as Ze,T as ie,E as no,e as ro,f as ve}from"./UnivariatePolynomial-CzQEP6td.js";import{s as so}from"./scanURL-ByjeZ2ZP.js";import{B as ao,a as io,b as lo,c as co,d as uo,e as F,f as x,g as Ue,h as we,_ as pe,i as Qe,j as po,S as M,P as ho,k as go}from"./patternBoards-DKw4bfen.js";import{N,L as $e,T as V,S as fo,R as O,A as wo,M as st,a as yo,b as mo,c as ze,V as D,H as R,P as K,s as ht,d as ce,e as Co,G as gt,B as Oe,f as ft,g as je,I as wt,h as se,i as yt,j as Po,D as vo,k as So,l as Nt}from"./PhetioControlledVisibilityProperty-Bd0APyjs.js";import{L as Lt,P as be,C as bo,V as Eo,T as Ae,O as ko,R as Fo,M as No,a as Lo,b as xo,c as ue,B as ye,d as Io}from"./TextPushButton-7XBbkz6j.js";import{S as Me}from"./SlitherQueryParameters-CPKtzX1-.js";import{P as he,s as Se,i as Bo,h as zo,f as at,U as A,p as xt,j as It,k as Bt,l as zt,m as At,n as Tt,o as Ot,v as _e,q as et,r as Mt,V as Ao,F as To,t as Oo,u as Mo,w as Rt,x as Ro,y as Ho,S as Ge,z as Ht,A as Vt,B as tt,C as Vo,D as qo,G as Do,H as ae,I as qt,J as Wo,K as G,L as it,M as Uo}from"./DisplayEmbedding-DTA4pXmv.js";import{A as Go,p as xe,g as Xo,a as Jo,i as Yo,w as Ko}from"./polygonGenerators-BdaimXjn.js";import{E as ne,C as Dt,B as le,s as Zo}from"./BasicPuzzle-BMlBNSWn.js";import{c as g,o as Qo,u as Y,a as ot,r as ge,t as $o,b as me,d as mt,e as jo,p as _o,f as Ct,g as en,h as tn,s as Xe,i as on,j as nn,v as Pt,k as rn,m as sn,w as an,n as vt,q as ln,x as cn,y as dn,z as un,A as pn,B as hn,C as gn,D as fn,E as wn,F as yn,G as mn,H as Cn,I as Pn,J as vn,K as Sn,L as bn,M as Je,N as En,O as Ye}from"./Theme-B6xro5rz.js";import{A as kn,N as Ie,S as Fn}from"./SpinningIndicatorNode-oq9bMnoF.js";import{a as Nn,b as Ln,c as xn,d as In,e as Bn,f as zn,g as An,h as Tn,i as On,j as Mn,k as Rn,l as Hn,m as Vn,n as qn,o as Dn,p as Wn,q as Un,r as Gn,s as Xn,t as Jn,u as Yn,v as Kn,w as Zn,x as Qn,y as $n,z as Ke,A as jn,B as _n,C as er,D as tr,E as nt}from"./SATSolver-1D3my44Q.js";import{p as Wt}from"./puzzleFromCompressedString-CcXM77VO.js";import{U as or}from"./UIAquaRadioButtonGroup-CYVJNPsW.js";import"./PatternRule-BPSy1pyf.js";import"./PatternBoardSolver-DIAz22yg.js";class nr extends N{constructor(o,e){const t=Q()({focusNodeCallback:()=>{}},e),n=new he(o.puzzle,{edgePressListener:(s,a)=>{o.onUserEdgePress(s,a)},facePressListener:(s,a)=>{o.onUserFacePress(s,a)},sectorPressListener:(s,a)=>{o.onUserSectorPress(s,a)},sectorSetListener:(s,a)=>{o.onUserSectorSet(s,a)},selectedFaceColorHighlightProperty:o.selectedFaceColorHighlightProperty,selectedSectorEditProperty:o.selectedSectorEditProperty,style:o.style,delayEdgeInteractionEmitter:o.edgeAutoSolvedEmitter});super(X({children:[n]},t)),this.puzzleModel=o,this.disposeEmitter.addListener(()=>n.dispose());let r=null;const l=s=>{if(n.clearAnnotationNodes(),r&&(r.dispose(),r=null),s){const a=new Go(o.puzzle.board,s,o.style,n.getBackgroundBounds());n.addAnnotationNode(a),r=a,t.focusNodeCallback(a)}};this.disposeEmitter.addListener(()=>{r&&(r.dispose(),r=null)}),o.displayedAnnotationProperty.link(l),this.disposeEmitter.addListener(()=>o.displayedAnnotationProperty.unlink(l))}}const lt=new Lt("showLayoutTestProperty",!1);class Be extends ao{constructor(o,e,t){super(o,e,t)}}class St extends io{constructor(e,t){super(e,t);I(this,"originalEdges",new Set)}}class bt extends lo{constructor(e,t){super(e.copy(),t.copy());I(this,"originalFace",null)}}class rr extends co{constructor(o,e){super(o.copy(),e.copy())}}class Et{constructor(o,e){this.faces=o,this.boundaryHalfEdges=e}}class sr{constructor(o,e,t){this.faces=o,this.boundaryHalfEdges=e,this.boundarySegments=t}}class ar extends uo{constructor(e,t){const n=new Map,r=new Map,l=new Map,s=new Map,a=new Map,p=new Map,f=new Map,u=new Map,m=h=>{const y=n.get(h);return F()&&x(y),y},S=h=>{const y=r.get(h);return F()&&x(y),y},C=h=>{const y=l.get(h);return F()&&x(y),y},w=h=>{const y=s.get(h);return F()&&x(y),y},b=h=>{const y=a.get(h);return F()&&x(y),y},i=h=>{const y=p.get(h);return F()&&x(y),y},c=h=>{const y=f.get(h);return F()&&x(y),y},E=h=>{const y=u.get(h);return F()&&x(y),y},P=e.vertices.map(h=>{const y=new rr(h.logicalCoordinates,h.viewCoordinates);return n.set(h,y),a.set(y,h),y}),v=e.faces.map(h=>{const y=new bt(h.logicalCoordinates,h.viewCoordinates);return r.set(h,y),p.set(y,h),y.originalFace=h,y}),k=[],B=e.edges.map(h=>{const y=n.get(h.start),j=n.get(h.end);F()&&x(y),F()&&x(j);const _=new St(y,j);_.originalEdges.add(h),l.set(h,_),f.set(_,h);const T=new Be(y,j,!1);s.set(h.forwardHalf,T),u.set(T,h.forwardHalf),k.push(T);const H=new Be(j,y,!0);return s.set(h.reversedHalf,H),u.set(H,h.reversedHalf),k.push(H),_});P.forEach(h=>{const y=b(h);h.incomingHalfEdges=y.incomingHalfEdges.map(w),h.outgoingHalfEdges=y.outgoingHalfEdges.map(w),h.edges=y.edges.map(C),h.faces=y.faces.map(S)}),v.forEach(h=>{const y=i(h);h.halfEdges=y.halfEdges.map(w),h.edges=y.edges.map(C),h.vertices=y.vertices.map(m)}),B.forEach(h=>{const y=c(h);h.forwardHalf=w(y.forwardHalf),h.reversedHalf=w(y.reversedHalf),h.forwardFace=y.forwardFace?S(y.forwardFace):null,h.reversedFace=y.reversedFace?S(y.reversedFace):null,h.vertices=y.vertices.map(m),h.faces=y.faces.map(S)}),k.forEach(h=>{const y=E(h);h.edge=C(y.edge),h.reversed=w(y.reversed),h.next=w(y.next),h.previous=w(y.previous),h.face=y.face?S(y.face):null});super({edges:B,vertices:P,faces:v,halfEdges:k,outerBoundary:e.outerBoundary.map(w),innerBoundaries:e.innerBoundaries.map(h=>h.map(w))});I(this,"edgeStateMap",new Map);I(this,"faceValueMap",new Map);this.originalBoard=e,this.originalState=t,B.forEach(h=>{this.edgeStateMap.set(h,t.getEdgeState(c(h)))}),v.forEach(h=>{this.faceValueMap.set(h,t.getFaceValue(i(h)))}),F()&&Ue(this)}getFaceValue(e){const t=this.faceValueMap.get(e);return F()&&x(t!==void 0),t}getEdgeState(e){const t=this.edgeStateMap.get(e);return F()&&x(t!==void 0),t}clearSatisfiedFaces(){this.faces.forEach(e=>{const t=this.getFaceValue(e);if(t===null)return;let n=0,r=0;e.edges.forEach(l=>{const s=this.getEdgeState(l);s===ne.WHITE?n++:s===ne.BLACK&&r++}),n===0&&r===t&&this.faceValueMap.set(e,null)})}removeDeadRedEdges(){const e=new Set(this.edges.filter(s=>this.getEdgeState(s)===ne.RED&&s.faces.every(a=>a===null||this.getFaceValue(a)===null))),t=new Set(this.vertices.filter(s=>s.edges.every(a=>e.has(a)))),n=new Set(this.faces.filter(s=>s.edges.some(a=>e.has(a)))),r=[],l=new Set(n);for(;l.size;){const s=l.values().next().value;l.delete(s);const a=[s];let p=!1;for(let i=0;i<a.length;i++){const c=a[i];c.edges.forEach(E=>{e.has(E)&&[E.forwardFace,E.reversedFace].forEach(P=>{if(P!==c){if(P===null){p=!0;return}l.has(P)&&(l.delete(P),a.push(P))}})})}const f=new Set(a.flatMap(i=>i.halfEdges)),u=new Set(a.flatMap(i=>i.halfEdges.map(c=>c.reversed))),m=new Set([...f].filter(i=>!u.has(i))),S=i=>{let c=i.next;for(;c!==i&&!m.has(c);)c=c.reversed.next;return F()&&x(c!==i),c},C=m.values().next().value,w=[C];let b=S(C);for(;b!==C;)w.push(b),b=S(b);if(F()&&x(w.length===m.size),p){const i=[];for(let c=0;c<w.length;c++){const E=w[c],P=w[(c+w.length-1)%w.length];if(F()&&x(P.end===E.start),!e.has(E.edge)&&e.has(P.edge)){const v=[E];for(let k=c+1;;k++){const B=w[k%w.length];if(e.has(B.edge))break;v.push(B)}i.push(v)}}r.push(new sr(a,w,i))}else r.push(new Et(a,w))}r.forEach(s=>{if(s instanceof Et){const a=s.boundaryHalfEdges.map(u=>u.start),p=s.boundaryHalfEdges.map(u=>u.edge),f=new bt(we(a.map(u=>u.viewCoordinates)),we(a.map(u=>u.logicalCoordinates)));this.faces.push(f),this.faceValueMap.set(f,null),f.halfEdges=s.boundaryHalfEdges,f.edges=p,f.vertices=a;for(let u=0;u<s.boundaryHalfEdges.length;u++){const m=s.boundaryHalfEdges[u],S=m.face;m.face=f;const C=m.edge;m.isReversed?C.reversedFace=f:C.forwardFace=f,F()&&x(S),S&&z(C.faces,S),C.faces.push(f)}}else s.boundarySegments.forEach(a=>{a.forEach(p=>{const f=p.edge,u=p.face;u&&(p.face=null,z(f.faces,u)),p.isReversed?f.reversedFace=null:f.forwardFace=null})})}),e.forEach(s=>{z(this.edges,s),z(this.halfEdges,s.forwardHalf),z(this.halfEdges,s.reversedHalf)}),t.forEach(s=>{z(this.vertices,s)}),n.forEach(s=>{z(this.faces,s)}),this.vertices.forEach(s=>{s.edges=s.edges.filter(a=>!e.has(a)),s.incomingHalfEdges=s.incomingHalfEdges.filter(a=>!e.has(a.edge)),s.outgoingHalfEdges=s.outgoingHalfEdges.filter(a=>!e.has(a.edge)),s.faces=s.incomingHalfEdges.map(a=>a.face).filter(a=>a!==null);for(let a=0;a<s.incomingHalfEdges.length;a++){const p=s.outgoingHalfEdges[a],f=s.incomingHalfEdges[(a+1)%s.incomingHalfEdges.length];f.next=p,p.previous=f}}),F()&&Ue(this)}removeSimpleForced(){this.vertices.slice().forEach(e=>{if(e.edges.length!==2||pe.uniq(e.edges.flatMap(E=>E.faces)).some(E=>this.getFaceValue(E)!==null))return;const n=e.edges[0],r=e.edges[1],l=this.getEdgeState(n),s=this.getEdgeState(r);if(l!==s)return;const a=n.getOtherVertex(e),p=r.getOtherVertex(e);if(a===p)return;const f=n.forwardHalf.end===e?n.forwardHalf:n.reversedHalf,u=n.forwardHalf.end===e?n.reversedHalf:n.forwardHalf,m=r.forwardHalf.start===e?r.forwardHalf:r.reversedHalf,S=r.forwardHalf.start===e?r.reversedHalf:r.forwardHalf,C=f.face,w=u.face,b=new St(a,p);n.originalEdges.forEach(E=>b.originalEdges.add(E)),r.originalEdges.forEach(E=>b.originalEdges.add(E)),this.edgeStateMap.set(b,l),this.edges.push(b);const i=new Be(a,p,!1);this.halfEdges.push(i);const c=new Be(p,a,!0);if(this.halfEdges.push(c),b.forwardHalf=i,b.reversedHalf=c,b.forwardFace=C,b.reversedFace=w,b.vertices=[a,p],b.faces=[C,w].filter(E=>E!==null),i.edge=b,i.reversed=c,i.next=m.next,i.previous=f.previous,i.face=C,c.edge=b,c.reversed=i,c.next=u.next,c.previous=S.previous,c.face=w,C){const E=C.halfEdges.indexOf(f),P=C.edges.indexOf(n);F()&&x(E!==-1),F()&&x(P!==-1),C.halfEdges[E]=i,z(C.halfEdges,m),C.edges[P]=b,z(C.edges,r),z(C.vertices,e)}if(w){const E=w.halfEdges.indexOf(S),P=w.edges.indexOf(r);F()&&x(E!==-1),F()&&x(P!==-1),w.halfEdges[E]=c,z(w.halfEdges,u),w.edges[P]=b,z(w.edges,n),z(w.vertices,e)}{const E=a.incomingHalfEdges.indexOf(u),P=a.outgoingHalfEdges.indexOf(f),v=a.edges.indexOf(n);F()&&x(E!==-1),F()&&x(P!==-1),F()&&x(v!==-1),a.incomingHalfEdges[E]=c,a.outgoingHalfEdges[P]=i,a.edges[v]=b}{const E=p.incomingHalfEdges.indexOf(m),P=p.outgoingHalfEdges.indexOf(S),v=p.edges.indexOf(r);F()&&x(E!==-1),F()&&x(P!==-1),F()&&x(v!==-1),p.incomingHalfEdges[E]=i,p.outgoingHalfEdges[P]=c,p.edges[v]=b}i.previous.next=i,i.next.previous=i,c.previous.next=c,c.next.previous=c,z(this.edges,n),z(this.edges,r),z(this.halfEdges,n.forwardHalf),z(this.halfEdges,n.reversedHalf),z(this.halfEdges,r.forwardHalf),z(this.halfEdges,r.reversedHalf),z(this.vertices,e)}),F()&&Ue(this)}simplify(){this.clearSatisfiedFaces(),this.removeDeadRedEdges(),this.removeSimpleForced()}fixOuterBoundary(){const e=new Set(this.halfEdges.filter(r=>r.face===null)),t=[],n=[];for(;e.size;){const r=e.values().next().value;e.delete(r);const l=[r];let s=r.next;for(;s!==r;)l.push(s),e.delete(s),s=s.next;Qe(l.map(a=>a.start.viewCoordinates))<0?t.push(l):n.push(l)}F()&&x(t.length===1),this.outerBoundary.length=0,this.outerBoundary.push(...t[0]),this.innerBoundaries.length=0,this.innerBoundaries.push(...n)}getCompleteState(){this.fixOuterBoundary();const e=Dt.fromFacesEdges(this,t=>this.getFaceValue(t),t=>this.getEdgeState(t));return Se(this,e),e}getCompletePuzzle(){return{board:this,state:this.getCompleteState()}}getSignedArea(){let e=0;return this.faces.forEach(t=>{e+=Qe(t.vertices.map(n=>n.viewCoordinates))}),e}getCentroid(){let e=0,t=0,n=0;return this.halfEdges.forEach(r=>{if(r.face===null){const l=r.end.viewCoordinates,s=r.start.viewCoordinates;e+=(s.x+l.x)*(s.y-l.y);const a=l.x*(2*l.y+s.y)+s.x*(l.y+2*s.y);t+=(l.x-s.x)*a,n+=(s.y-l.y)*a}}),e*=.5,new ee(t,n).timesScalar(1/(6*e))}applyDerivative(e){this.vertices.forEach(t=>{const n=e.derivatives.get(t);F()&&x(n),F()&&x(n.isFinite()),t.viewCoordinates.add(n)}),this.fixFaceCoordinates()}fixFaceCoordinates(){this.faces.forEach(e=>{e.viewCoordinates.set(we(e.halfEdges.map(t=>t.start.viewCoordinates)))})}getDebugNode(){const e=new N;return this.edges.forEach(t=>{const n=t.start.viewCoordinates,r=t.end.viewCoordinates;let l,s;const a=this.edgeStateMap.get(t);a===ne.WHITE?(l=g.blackLineColorProperty,s=.02):a===ne.BLACK?(l=Qo(Math.random()*360,.7,.55),s=.1):(l=null,s=.02),e.addChild(new $e(n,r,{stroke:l,lineWidth:s,lineCap:"round"}))}),this.faces.forEach(t=>{const n=this.faceValueMap.get(t)??null;n!==null&&e.addChild(new V(n,{maxWidth:.9,maxHeight:.9,center:t.viewCoordinates,fill:g.faceValueColorProperty}))}),e}}class U{constructor(o,e){this.layoutPuzzle=o,this.derivatives=e}plus(o){const e=new Map;return this.derivatives.forEach((t,n)=>{e.set(n,t.plus(o.derivatives.get(n)))}),new U(this.layoutPuzzle,e)}minus(o){const e=new Map;return this.derivatives.forEach((t,n)=>{e.set(n,t.minus(o.derivatives.get(n)))}),new U(this.layoutPuzzle,e)}timesScalar(o){const e=new Map;return this.derivatives.forEach((t,n)=>{e.set(n,t.timesScalar(o))}),new U(this.layoutPuzzle,e)}getMaxMagnitude(){let o=0;return this.derivatives.forEach(e=>{o=Math.max(o,e.getMagnitude())}),o}getAreaCorrectedDerivative(){let o=this;for(let e=0;e<5;e++)o=o.getAreaCorrectedDerivativeOnce();return o}getAreaCorrectedDerivativeOnce(){return this.plus(U.getAreaScaledDeltas(this.layoutPuzzle,-this.getAreaDerivative()/this.layoutPuzzle.getSignedArea()))}getAreaDerivative(){let o=0;return this.layoutPuzzle.faces.forEach(e=>{o+=po(e.vertices.map(t=>t.viewCoordinates),e.vertices.map(t=>this.derivatives.get(t)))}),o}getDebugNode(){const o=new N;return this.layoutPuzzle.vertices.forEach(e=>{const t=this.derivatives.get(e),n=e.viewCoordinates,r=new kn(n.x,n.y,n.x+t.x,n.y+t.y,{lineWidth:.01,headHeight:.05,headWidth:.05,tailWidth:.005,fill:"green",stroke:"green"});o.addChild(r)}),o}static getAreaScaledDeltas(o,e){const t=o.getCentroid(),n=new Map;return o.vertices.forEach(r=>{const l=r.viewCoordinates.minus(t).timesScalar(e);F()&&x(l.isFinite()),n.set(r,l)}),new U(o,n)}static getHookesAttraction(o,e,t){const n=new Map;return o.vertices.forEach(r=>{n.set(r,ee.ZERO.copy())}),o.edges.forEach(r=>{const l=r.start.viewCoordinates,a=r.end.viewCoordinates.minus(l),p=a.getMagnitude(),f=a.timesScalar((p-e)*t/p);F()&&x(f.isFinite()),n.get(r.start).add(f),n.get(r.end).subtract(f)}),new U(o,n)}static getRegularPolygonDeltas(o,e,t,n){const r=new Map;o.vertices.forEach(s=>{r.set(s,ee.ZERO.copy())});const l=s=>e/(2*Math.sin(Math.PI/s));return o.faces.forEach(s=>{if(s.vertices.length<3)return;const a=.2,p=.3,f=s.vertices.map(P=>P.viewCoordinates);let u=0;const m=Qe(f);m<0?u=1:m<a&&(u=Math.max(u,(a-m)/a));for(let P=0;P<f.length&&!(u>=1);P++){const v=P,k=(P+1)%f.length,B=f[v],h=f[k];for(let y=P+2;y<f.length-(P===0?1:0)&&!(u>=1);y++){const j=y%f.length,_=(y+1)%f.length,T=f[j],H=f[_];if(de.lineSegmentIntersection(B.x,B.y,h.x,h.y,T.x,T.y,H.x,H.y))F()&&x(f.length>=4),u=1;else{const Fe=Math.min(de.distToSegment(B,T,H),de.distToSegment(h,T,H),de.distToSegment(T,B,h),de.distToSegment(H,B,h));Fe<p&&(u=Math.max(u,(p-Fe)/p))}}}if(u===0&&t&&o.getFaceValue(s)===null)return;const S=we(f);F()&&x(S.isFinite());const C=l(f.length),w=f.map(P=>P.minus(S)),b=f.map((P,v)=>ee.createPolar(C,2*Math.PI*v/f.length)),i=U.getLeastSquares(w,b),c=n+(2-n)*u,E=f.map((P,v)=>i[v].minus(w[v]).timesScalar(c));s.vertices.forEach((P,v)=>{const k=E[v];F()&&x(k.isFinite()),r.get(P).add(k)})}),new U(o,r)}static getBarycentricDeltas(o){const e=new Map;return o.vertices.forEach(t=>{const n=t.edges.map(s=>s.getOtherVertex(t)),r=new ee(0,0);n.forEach(s=>r.add(s.viewCoordinates)),r.multiplyScalar(1/n.length);const l=r.subtract(t.viewCoordinates);F()&&x(l.isFinite()),e.set(t,l)}),new U(o,e)}static getAngularDeltas(o,e){const t=new Map;return o.vertices.forEach(n=>{t.set(n,ee.ZERO.copy())}),o.vertices.forEach(n=>{const r=n.edges.map(w=>w.getOtherVertex(n));let l=pe.sortBy(r,w=>w.viewCoordinates.minus(n.viewCoordinates).getAngle());if(l[0]!==r[0]){const w=l.indexOf(r[0]);l=[...l.slice(w),...l.slice(0,w)]}const s=pe.range(0,r.length).every(w=>l[w]===r[w]),a=r.map(w=>w.viewCoordinates.minus(n.viewCoordinates).normalized()),p=U.getUnitLeastSquares(a),f=Math.max(...pe.range(0,r.length).map(w=>p[w].dot(p[(w+1)%r.length]))),u=Math.max(...pe.range(0,r.length).map(w=>a[w].dot(a[(w+1)%r.length]))),m=(w,b)=>b<=.5?.5*Math.pow(2*b,w):1-m(w,1-b),S=s?de.linear(f,1,0,1,u):1,C=.75;if(S>C){const w=(S-C)/(1-C),b=m(2,w),i=new ee(0,0);for(let c=0;c<r.length;c++){const E=r[c],P=a[c],v=p[c],k=v.minus(P.timesScalar(v.dot(P))).timesScalar(b*e);i.add(k),F()&&x(k.isFinite()),t.get(E).add(k)}i.multiplyScalar(1/r.length);for(const c of r)F()&&x(i),t.get(c).subtract(i)}}),new U(o,t)}static getUnitLeastSquares(o){const e=o.length,t=pe.range(0,e).map(n=>ee.createPolar(1,2*Math.PI*n/e));return U.getLeastSquares(o,t)}static getLeastSquares(o,e){const t=o.length,n=new We(2,t,[...e.map(f=>f.x),...e.map(f=>f.y)]),r=new We(2,t,[...o.map(f=>f.x),...o.map(f=>f.y)]),l=n.times(r.transpose()),s=new oo(l);let a=s.getV().times(s.getU().transpose());a.det()<0&&(a=s.getV().times(We.diagonalMatrix([1,-1])).times(s.getU().transpose()));const p=new Ft().rowMajor(a.get(0,0),a.get(0,1),0,a.get(1,0),a.get(1,1),0,0,0,1);return e.map(f=>{const u=p.timesVector2(f);return F()&&x(u.isFinite()),u})}}const ir=d=>({board:d.board,stateProperty:new rt(d.state)});class lr extends N{constructor(o,e){const t=new N;let n=null;const r=()=>{const s=o.puzzle.board,a=o.puzzle.stateProperty.value;if(a.getSimpleRegions().some(b=>b.isSolved))return;const p=new ar(s,a);p.simplify();const f=()=>U.getAngularDeltas(p,.2).plus(U.getHookesAttraction(p,1,.1)).plus(U.getRegularPolygonDeltas(p,1,!0,.2));let u=.3;for(let b=0;b<40;b++){b%10===0&&(u*=.95);let i=f();{let c=i.getMaxMagnitude(),E=u;u*c>1.5&&(E=1.5/c),i=i.timesScalar(E)}if(p.applyDerivative(i),i.getMaxMagnitude()<.015)break}const m=p.getCompletePuzzle();n&&n.dispose();const S=new he(ir(m),{edgePressListener:(b,i)=>{const c=b.originalEdges;c&&o.onUserEdgePress(c.values().next().value,i)},facePressListener:(b,i)=>{if(b===null)o.onUserFacePress(null,i);else{const c=b.originalFace;c&&o.onUserFacePress(c,i)}}});n=S;const C=new N({children:[S]}),w=600;C.scale(Math.min(w/C.width,w/C.height)),C.left=20,C.top=130,t.children=[C]},l=()=>{t.children=[],r()};o.puzzle.stateProperty.link(l),super(X({children:[t]},e)),this.puzzleModel=o,this.disposeEmitter.addListener(()=>o.puzzle.stateProperty.unlink(l)),this.disposeEmitter.addListener(()=>t.dispose()),this.disposeEmitter.addListener(()=>n&&n.dispose())}}class Ut extends fo(N){constructor(e,t=at,n){const r=Q()({topological:!1},n);super(r);I(this,"backgroundRect");I(this,"facePressRect");I(this,"rectangularGradientRect");I(this,"circularGradientRect");I(this,"puzzleWrapper");I(this,"puzzleNode",null);I(this,"zoomListener");this.puzzleModelProperty=e,this.style=t,this.backgroundRect=new O({fill:t.theme.playAreaBackgroundColorProperty,pickable:!0}),this.facePressRect=new O({fill:null,pickableProperty:Bo}),zo(null,this.facePressRect,(s,a)=>{var p;(p=e.value)==null||p.onUserFacePress(s,a)}),this.rectangularGradientRect=new O({pickable:!1}),this.circularGradientRect=new O({pickable:!1}),this.puzzleWrapper=new N({children:[this.backgroundRect,this.facePressRect,this.rectangularGradientRect,this.circularGradientRect]}),this.zoomListener=new wo(this.puzzleWrapper,{maxScale:10}),this.addInputListener(this.zoomListener),this.addChild(this.puzzleWrapper);const l=this.updateLayout.bind(this);this.localPreferredWidthProperty.lazyLink(l),this.localPreferredHeightProperty.lazyLink(l),r.topological&&this.puzzleWrapper.localBoundsProperty.lazyLink(l),st.multilink([e,lt],(s,a)=>{this.puzzleNode&&(this.puzzleNode.dispose(),this.puzzleNode=null),s&&(r.topological?a&&(this.puzzleNode=new lr(s)):this.puzzleNode=new nr(s,{focusNodeCallback:p=>{this.zoomListener.panToNode(p,!0)}}),this.puzzleNode&&(this.updatePuzzleNodeLayout(this.puzzleNode),this.puzzleWrapper.children=[this.backgroundRect,this.facePressRect,this.rectangularGradientRect,this.circularGradientRect,this.puzzleNode])),this.zoomListener.resetTransform(),this.updateLayout()})}step(e){this.zoomListener.step(2*e)}updateLayout(){const e=this.localPreferredWidth,t=this.localPreferredHeight;if(e!==null&&(this.backgroundRect.rectWidth=e,this.facePressRect.rectWidth=e,this.rectangularGradientRect.rectWidth=e,this.circularGradientRect.rectWidth=e),t!==null&&(this.backgroundRect.rectHeight=t,this.facePressRect.rectHeight=t,this.rectangularGradientRect.rectHeight=t,this.circularGradientRect.rectHeight=t),this.puzzleNode&&this.updatePuzzleNodeLayout(this.puzzleNode),e!==null&&t!==null&&e>0&&t>0){const n=new Te(0,0,e,t),r=n.center,l=r.getMagnitude();this.rectangularGradientRect.fill=new yo(0,0,0,t).addColorStop(0,this.style.theme.playAreaLinearTopColorProperty).addColorStop(.5,this.style.theme.playAreaLinearMiddleColorProperty).addColorStop(1,this.style.theme.playAreaLinearBottomColorProperty),this.circularGradientRect.fill=new mo(r.x,r.y,l,r.x,r.y,0).addColorStop(0,this.style.theme.playAreaRadialOutsideColorProperty).addColorStop(1,this.style.theme.playAreaRadialInsideColorProperty),this.clipArea=M.bounds(n),this.zoomListener.setTargetBounds(n),this.zoomListener.setPanBounds(n)}else{const n=new Te(0,0,5,5);this.zoomListener.setTargetBounds(n),this.zoomListener.setPanBounds(n)}}updatePuzzleNodeLayout(e){const t=this.localPreferredWidth,n=this.localPreferredHeight;if(t!==null&&n!==null&&t>0&&n>0){const l=t-40,s=n-20*2;if(e.localBounds.isValid()){const a=e.localBounds.width,p=e.localBounds.height,f=Math.min(l/a,s/p);e.setScaleMagnitude(f),e.center=new ee(t/2,n/2)}}}}class Re extends N{constructor(o,e,t){const n=Q()({allowBarrierClickToHide:!0,panelOptions:{xMargin:15,yMargin:15,fill:g.uiBackgroundColorProperty,stroke:g.uiForegroundColorProperty}},t);super(),this.content=o,this.viewContext=e;const r=new O({fill:g.barrierColorProperty});this.addChild(r),e.layoutBoundsProperty.link(s=>{r.rectBounds=s}),n.allowBarrierClickToHide&&r.addInputListener({down:()=>{this.hide()}});const l=new be(o,n.panelOptions);e.layoutBoundsProperty.link(s=>{l.maxWidth=s.width*.9,l.maxHeight=s.height*.9}),this.addChild(new ze(l,{alignBoundsProperty:e.layoutBoundsProperty,yAlign:"top",topMargin:50}))}show(){this.viewContext.glassPane.hasChild(this)||(this.reset(),this.viewContext.glassPane.addChild(this))}hide(){this.viewContext.glassPane.hasChild(this)&&this.viewContext.glassPane.removeChild(this)}reset(){}}class L extends bo{constructor(o,e,t){const n=Q()({advanced:!1,accessibleName:o,checkboxColor:g.uiForegroundColorProperty,checkboxColorBackground:g.uiBackgroundColorProperty},t),r=new V(o,{font:Y,fill:g.uiForegroundColorProperty});n.advanced&&(n.visibleProperty=q),n.boxWidth=r.height,super(e,r,n)}}const Z=(d,o,e,t)=>{const n=new Eo(o,e,{spacing:8,radioButtonOptions:{selectedColor:g.uiButtonBaseColorProperty,deselectedColor:g.uiBackgroundColorProperty,stroke:g.uiForegroundColorProperty}}),r=Q()({stretch:!0,align:"left",spacing:10,children:[new V(d,{font:ot,fill:g.uiForegroundColorProperty}),n]},t);return new D(r)};class te extends Ae{constructor(o,e){const t=Q()({advanced:!1,textFill:g.uiButtonForegroundProperty,baseColor:g.uiButtonBaseColorProperty,xMargin:5,yMargin:5,font:Y,buttonAppearanceStrategy:ge},e);t.advanced&&(t.visibleProperty=q),super(o,t)}}class cr extends R{constructor(o,e,t,n){const r=Q()({advanced:!1,onOffSwitchOptions:{size:new Ze(40,20),trackFillLeft:g.uiButtonDisabledColorProperty,trackFillRight:g.uiButtonBaseColorProperty,accessibleName:e},spacing:10},n),l=new ko(o,r.onOffSwitchOptions);r.children=[t,l],r.advanced&&(r.visibleProperty=q),super(r)}}class W extends cr{constructor(o,e,t){const n=Q()({textOptions:{}},t),r=new A(e,n.textOptions);super(o,e,r,n)}}class Gt extends Fo{constructor(o,e,t){super(o,e,X({orientation:"horizontal",touchAreaYDilation:5,radioButtonOptions:{baseColor:g.uiButtonBaseColorProperty,disabledColor:g.uiButtonDisabledColorProperty,xMargin:8*1.3,yMargin:5*1.3,buttonAppearanceStrategyOptions:{selectedStroke:g.uiButtonSelectedStrokeColorProperty,deselectedStroke:g.uiButtonDeselectedStrokeColorProperty}}},t))}}const dr=new M("M1024 640q0 106 -75 181t-181 75t-181 -75t-75 -181t75 -181t181 -75t181 75t75 181zM1536 749v-222q0 -12 -8 -23t-20 -13l-185 -28q-19 -54 -39 -91q35 -50 107 -138q10 -12 10 -25t-9 -23q-27 -37 -99 -108t-94 -71q-12 0 -26 9l-138 108q-44 -23 -91 -38q-16 -136 -29 -186q-7 -28 -36 -28h-222q-14 0 -24.5 8.5t-11.5 21.5l-28 184q-49 16 -90 37l-141 -107q-10 -9 -25 -9q-14 0 -25 11q-126 114 -165 168q-7 10 -7 23q0 12 8 23q15 21 51 66.5t54 70.5q-27 50 -41 99l-183 27q-13 2 -21 12.5t-8 23.5v222q0 12 8 23t19 13l186 28q14 46 39 92q-40 57 -107 138q-10 12 -10 24q0 10 9 23q26 36 98.5 107.5t94.5 71.5q13 0 26 -10l138 -107q44 23 91 38q16 136 29 186q7 28 36 28h222q14 0 24.5 -8.5t11.5 -21.5l28 -184q49 -16 90 -37l142 107q9 9 24 9q13 0 25 -10q129 -119 165 -170q7 -8 7 -22q0 -12 -8 -23q-15 -21 -51 -66.5t-54 -70.5q26 -50 41 -98l183 -28q13 -2 21 -12.5t8 -23.5z").makeImmutable(),ur=new M("M979 1395q19 19 32 13t13 -32v-1472q0 -26 -13 -32t-32 13l-710 710q-9 9 -13 19v-678q0 -26 -19 -45t-45 -19h-128q-26 0 -45 19t-19 45v1408q0 26 19 45t45 19h128q26 0 45 -19t19 -45v-678q4 10 13 19z").makeImmutable(),pr=new M("M45 -115q-19 -19 -32 -13t-13 32v1472q0 26 13 32t32 -13l710 -710q9 -9 13 -19v678q0 26 19 45t45 19h128q26 0 45 -19t19 -45v-1408q0 -26 -19 -45t-45 -19h-128q-26 0 -45 19t-19 45v678q-4 -10 -13 -19z").makeImmutable(),hr=new M("M1619 1395q19 19 32 13t13 -32v-1472q0 -26 -13 -32t-32 13l-710 710q-9 9 -13 19v-710q0 -26 -13 -32t-32 13l-710 710q-19 19 -19 45t19 45l710 710q19 19 32 13t13 -32v-710q4 10 13 19z").makeImmutable(),gr=new M("M45 -115q-19 -19 -32 -13t-13 32v1472q0 26 13 32t32 -13l710 -710q9 -9 13 -19v710q0 26 13 32t32 -13l710 -710q19 -19 19 -45t-19 -45l-710 -710q-19 -19 -32 -13t-13 32v710q-4 -10 -13 -19z").makeImmutable(),fr=new M("M503.691 189.836L327.687 37.851C312.281 24.546 288 35.347 288 56.015v80.053C127.371 137.907 0 170.1 0 322.326c0 61.441 39.581 122.309 83.333 154.132 13.653 9.931 33.111-2.533 28.077-18.631C66.066 312.814 132.917 274.316 288 272.085V360c0 20.7 24.3 31.453 39.687 18.164l176.004-152c11.071-9.562 11.086-26.753 0-36.328z").makeImmutable(),wr=new M("M363 0l91 91l-235 235l-91 -91v-107h128v-128h107zM886 928q0 22 -22 22q-10 0 -17 -7l-542 -542q-7 -7 -7 -17q0 -22 22 -22q10 0 17 7l542 542q7 7 7 17zM832 1120l416 -416l-832 -832h-416v416zM1515 1024q0 -53 -37 -90l-166 -166l-416 416l166 165q36 38 90 38q53 0 91 -38l235 -234q37 -39 37 -91z").makeImmutable(),re=(d,o)=>new K(d,X({maxWidth:20,maxHeight:20,fill:"black"},o));class Ee{constructor(o,e){I(this,"timerListener",null);I(this,"tooltipNode",null);this.viewContext=o,this.tooltipTextOverride=e}showTooltip(o,e,t){if(!this.tooltipNode){this.tooltipNode=new be(new V(o,{font:$o}),{cornerRadius:1,xMargin:2,yMargin:2});const n=this.viewContext.glassPane.globalToLocalPoint(t.point);this.tooltipNode.leftTop=n.plusXY(0,this.viewContext.glassPane.getUniqueTransform().transformDeltaY(20)),this.tooltipNode.bottom>this.viewContext.layoutBoundsProperty.value.bottom&&(this.tooltipNode.bottom=n.y-2),this.tooltipNode.left<this.viewContext.layoutBoundsProperty.value.left&&(this.tooltipNode.left=this.viewContext.layoutBoundsProperty.value.left+2),this.tooltipNode.right>this.viewContext.layoutBoundsProperty.value.right&&(this.tooltipNode.right=this.viewContext.layoutBoundsProperty.value.right-2),this.viewContext.glassPane.addChild(this.tooltipNode)}}hideTooltip(){this.tooltipNode&&(this.tooltipNode.dispose(),this.tooltipNode=null)}clearListener(){this.timerListener&&(ht.clearTimeout(this.timerListener),this.timerListener=null)}enter(o){const e=o.currentTarget,t=this.tooltipTextOverride??(e==null?void 0:e.labelContent)??(e==null?void 0:e.accessibleName),n=o.pointer;e&&t&&this.timerListener===null&&(this.timerListener=ht.setTimeout(()=>{this.showTooltip(t,e,n)},200))}exit(o){this.clearListener(),this.hideTooltip()}dispose(){this.clearListener(),this.hideTooltip()}}class He extends Gt{constructor(o){const{basicLinesIcon:e,basicFaceColoringIcon:t,pureFaceColoringIcon:n,classicIcon:r,basicSectorsIcon:l,sectorsWithColorsIcon:s,vertexStateIcon:a,faceStateIcon:p,customIcon:f}=He.getIcons(),u=new Ee(o);super(xt,[{value:It,createNode:()=>r,labelContent:"Classic",options:{}},{value:Bt,createNode:()=>e,labelContent:"Lines",options:{}},{value:zt,createNode:()=>t,labelContent:"Lines and Colors",options:{}},{value:At,createNode:()=>n,labelContent:"Colors",options:{}},{value:Tt,createNode:()=>l,labelContent:"Sectors",options:{visibleProperty:q}},{value:Ot,createNode:()=>s,labelContent:"Sectors and Colors",options:{visibleProperty:q}},{value:_e,createNode:()=>a,labelContent:"Vertex State",options:{visibleProperty:q}},{value:et,createNode:()=>p,labelContent:"Face State",options:{visibleProperty:q}},{value:Mt,createNode:()=>f,labelContent:"Custom",options:{visibleProperty:q}}]),this.children.forEach(m=>m.addInputListener(u)),o.layoutBoundsProperty.link(m=>{this.maxWidth=Math.max(1,m.width-2*me)})}static getIcons(){const o=new O(0,0,15,15,{stroke:g.whiteLineColorProperty,fill:g.faceColorDefaultColorProperty}),e=new O(0,0,15,15,{stroke:g.whiteLineColorProperty,fill:new ce([g.faceColorBasicTargetColorProperty],v=>v.withAlpha(1))}),t=new K(new M().moveTo(0,15).lineTo(0,0).lineTo(15,0).makeImmutable(),{stroke:new ce([g.simpleRegionTargetColorProperty],v=>v.withAlpha(1)),lineWidth:4,lineCap:"round",lineJoin:"round"}),n=new K(new M().moveTo(0,15).lineTo(0,0).lineTo(15,0).makeImmutable(),{stroke:g.blackLineColorProperty,lineWidth:4,lineCap:"round",lineJoin:"round"}),r=new K(new M().arc(0,0,9,0,Math.PI/2,!1),{stroke:g.sectorOnlyOneColorProperty}),l=new N({children:[o,t]}),s=new N({children:[e,n]}),a=new N({children:[new O(0,0,15,15,{fill:g.uiForegroundColorProperty})]}),p=3,f=new M().moveTo(-p,-p).lineTo(p,p).moveTo(-p,p).lineTo(p,-p),u=new N({children:[new O(0,0,15,15,{fill:g.puzzleBackgroundColorProperty}),new K(new M().moveTo(0,15).lineTo(0,0).lineTo(15,0).makeImmutable(),{stroke:g.blackLineColorProperty,lineWidth:3,lineCap:"square",lineJoin:"miter"}),new K(f,{stroke:g.xColorProperty,lineWidth:2,x:15,y:7.5})]}),m=new N({children:[o,r,t]}),S=new N({children:[e,r,n]}),C=Wt("eJytV11v2jAU/S9+9oOvv4PUh7VQqS+dNtZK08RDVlwUjQIiKWuF8t9nJw2JjWGJygtKfE7OuR/Oxdmjndnm2XqFRoDR73W6naPRHhXvG4NG6DrNzXW1hh2vyJ5Mjka/9ugNjQhG79Xvrr7ZubsSdzCoMYhh1MPAw5in6WO8xmhMU3iY/5ysMRZ7TnmY/5z24qQelnhx+hgQL5gABM8xAP3SMB/0axOAfnECUHierJxh9JxG+9k2mmDAFLPZhxJEKIA5Fpg2FBqhcCyxwqKhsAiFWRuNk4bCIxRqbWxVdcMREY6wPra4QBqSjJAS62SLDIe0VISknZctKBwy07HkSWVnA+Oz0hJRXqSF6bxAN+uXzdIUZpwWKaoL/pguX+v7lnbrrXcb464csW1Q61Lt1A5BhAQWEFRIoAFBHyu4rMx8YaZuIQh7Ytc/InYUF3FVhMwl/d0s7FgJnpiGkM+uFDD6a7LtfNJRdCHerJfrbaRu7TpGT+66Llxm5xiTIhESGNdaccnZB2Fa54a+PvyY3o0nnXpb7/Vms86zwhyk76yQ1QBOOFeESZ0w5cqWRdYDg7v7nvphoI0+EEEJIcIaJIoyCPQf7seTG+swRvF3uTzlt3pdLhsPRmXCtdAEEkpUfw8Y4KEp1ZpwpaWQjBHR14MOyQMEkTQhYK2EpL092AAPxaRilJKEckbFUb9PevAhHoqDtG2XTNreJ737IYb0I1ECqOBCJMDtzu3rIQd4cHBdUEwntlCgeuehhtTKblhCpSB2byXWp6+H7uNhwWy1S5fZ/ICh0XO6zI2bceap+DAKR1yANNzavL52dDtht8XRaDerubcGZTuMpUv7nABEBOgQARoRYEMEWESADBEQEQHVEeD/rUGsimKIgoq1AQbFEGsEkE+nMTAK/vkoookMqibEOmpD60q4v3h3qjJvsRfqMUCCT5H6wVNnJPTty9UVckFGeNDh5Wd4tMNji9M81lNPdPXO8FSHx8/l0U2YniNCX0Xel9jNZVERmwNbrJe33nrfg+6+PThX546XtNhmloh+OkM7pvMvq/dmNgdHWjgr5gZ9R6/VKravR1L0clLsclL8clJHHxCeFOutIy8X0tEniydFe+scfdmcTO1PbE/NyrL8B0eOKVk=");F()&&x(C);const w=new Ao(C.board.vertices[5],C.stateProperty,{..._e,allVertexStateVisibleProperty:new ie(!0)}),b=new N({children:[w],scale:60}),i=new To(C.board.faces[5],C.stateProperty,et),c=new N({children:[i],scale:30}),E=re(wr,{fill:g.uiForegroundColorProperty,matrix:new Ft().rowMajor(.75,0,0,0,-.75,0,0,0,1)}),P=new Co;return{basicLinesIcon:P.createBox(l),basicFaceColoringIcon:P.createBox(s),pureFaceColoringIcon:P.createBox(a),classicIcon:P.createBox(u),basicSectorsIcon:P.createBox(m),sectorsWithColorsIcon:P.createBox(S),vertexStateIcon:P.createBox(b),faceStateIcon:P.createBox(c),customIcon:P.createBox(E)}}}const q=new Lt("advancedSettingsVisibleProperty",!1);class yr extends Re{constructor(o){const e=new Ee(o),t=new D({stretch:!0,align:"left",spacing:8,children:[new V("Solve After Every Move",{font:ot,fill:g.uiForegroundColorProperty}),new gt({xAlign:"left",yAlign:"top",xSpacing:20,ySpacing:8,columns:[[new L("Vertex Joint X",Nn),new L("Vertex Forced Line",Ln),new L("Vertex Forced X",xn),new L("Completed Face X",In),new L("Completed Face Lines",Bn),new L("Simple Loop X",zn),new L("Simple Loop Lines",An),new L("Double Minus One Faces",Tn),new L("1/N-1 Sectors",On),new L("Simple Sectors",Mn),new L("Vertex X",Rn),new L("Vertex Lines",Hn),new L("Vertex Sectors",Vn),new L("Vertex Faces",qn)],[new L("Color X",Dn),new L("Color Lines",Wn),new L("Color Parity X",Un),new L("Color Parity Lines",Gn),new L("Color Parity Colors",Xn),new L("Color Parity Partial",Jn),new L("Vertex/Color To Face",Yn),new L("Face X",Kn),new L("Face Lines",Zn),new L("Face Sectors",Qn),new L("Face Color",$n)]]})]}),n=Z("Theme",jo,mt.map(i=>({value:i,createNode:()=>new V(i.name,{font:Y,fill:g.uiForegroundColorProperty}),a11yName:i.name}))),r=new D({spacing:15,stretch:!0,visible:Me.debugColors,children:mt.filter(i=>i.isEditable).map(i=>new te(`Edit ${i.name} Theme`,{listener:()=>{_o(i)}}))}),l=new D({stretch:!0,align:"left",spacing:8,children:[new V("Puzzle Display",{font:ot,fill:g.uiForegroundColorProperty}),new gt({xAlign:"left",yAlign:"top",xSpacing:20,ySpacing:8,columns:[[new L("Lines Visible",Ct),new L("Color Lines",en,{enabledProperty:Ct,layoutOptions:{leftMargin:20}}),new L("Face Colors Visible",tn),new L("Sectors Visible",Xe),new L("Sectors Next to Edges",on,{advanced:!0,enabledProperty:Xe,layoutOptions:{leftMargin:20}}),new L("Trivial Sectors",nn,{advanced:!0,enabledProperty:Xe,layoutOptions:{leftMargin:20}}),new L("Vertex State",Pt),new L("All Vertex State",rn,{advanced:!0,enabledProperty:Pt,layoutOptions:{leftMargin:20}}),new L("Face State",sn,{advanced:!0})],[new L("Possible Line Visible",an),new L("Impossible Line Visible",vt),new L("Vertices Visible",ln),new L("Vertices Small",cn),new L("Red X Visible",dn),new L("Red X Aligned",un)]]}),new R({spacing:20,visibleProperty:q,children:[Z("Line Join",hn,pn.map(i=>({value:i,createNode:()=>new V(i,{font:Y,fill:g.uiForegroundColorProperty}),labelContent:i}))),Z("Line Cap",fn,gn.map(i=>({value:i,createNode:()=>new V(i,{font:Y,fill:g.uiForegroundColorProperty}),labelContent:i}))),Z("Vertex Style",yn,wn.map(i=>({value:i,createNode:()=>new V(i,{font:Y,fill:g.uiForegroundColorProperty}),labelContent:i}))),Z("Impossible Line Style",Cn,mn.map(i=>({value:i,createNode:()=>new V(i,{font:Y,fill:g.uiForegroundColorProperty}),labelContent:i}))),Z("Face Value Style",vn,Pn.map(i=>({value:i,createNode:()=>new V(i,{font:Y,fill:g.uiForegroundColorProperty}),labelContent:i})))]})]}),s=Z("Face Color Threshold",Sn,[{value:1,createNode:()=>new A("Show All"),labelContent:"Show All"},{value:2,createNode:()=>new A("2+"),labelContent:"2+"},{value:3,createNode:()=>new A("3+"),labelContent:"3+"},{value:5,createNode:()=>new A("5+"),labelContent:"5+"},{value:10,createNode:()=>new A("10+"),labelContent:"10+"},{value:Number.POSITIVE_INFINITY,createNode:()=>new A("Only Outside"),labelContent:"Only Outside"}]),a=new D({spacing:8,align:"left",stretch:!0,children:[new W(Ke,"Auto-Solve"),new W(jn,"Add Lines",{layoutOptions:{leftMargin:20},enabledProperty:Ke}),new W(_n,"Simple Loops",{layoutOptions:{leftMargin:20},enabledProperty:Ke}),new A("Highlights"),new W(Oo,"Dim Completed Numbers",{layoutOptions:{leftMargin:20}}),new W(Mo,"Highlight Incorrect Numbers",{layoutOptions:{leftMargin:20}}),new W(Rt,"Highlight Incorrect Moves",{layoutOptions:{leftMargin:20}}),new W(Ro,"Highlight Intersecting Lines",{layoutOptions:{leftMargin:20}}),new W(new No(Ho,{bidirectional:!0,map:i=>i===Ge.CYCLIC,inverseMap:i=>i?Ge.CYCLIC:Ge.TOGGLE}),"Cycle Between States"),new W(Ht,"Show View Style Controls"),new W(vt,"Show Impossible Lines"),new W(Vt,"Show Elapsed Time"),new W(tt,"Show Undo-All / Redo-All",{advanced:!0}),new W(lt,"Show Layout Test",{advanced:!0}),new W(Vo,"Solve Uses Built-In",{advanced:!0})]}),p=new Oe(!1),f=ce.and([q,p]),u=He.getIcons(),m=(i,c)=>new R({spacing:5,children:[new A(c),i]}),S=Z("View Style",xt,[{value:It,createNode:()=>m(u.classicIcon,"Classic"),labelContent:"Classic"},{value:Bt,createNode:()=>m(u.basicLinesIcon,"Lines"),labelContent:"Lines"},{value:zt,createNode:()=>m(u.basicFaceColoringIcon,"Lines and Colors"),labelContent:"Lines and Colors"},{value:At,createNode:()=>m(u.pureFaceColoringIcon,"Colors"),labelContent:"Colors"},{value:Tt,createNode:()=>m(u.basicSectorsIcon,"Sectors"),labelContent:"Sectors",options:{visibleProperty:q}},{value:Ot,createNode:()=>m(u.sectorsWithColorsIcon,"Sectors and Colors"),labelContent:"Sectors and Colors",options:{visibleProperty:q}},{value:_e,createNode:()=>m(u.vertexStateIcon,"Vertex State"),labelContent:"Vertex State",options:{visibleProperty:q}},{value:et,createNode:()=>m(u.faceStateIcon,"Face State"),labelContent:"Face State",options:{visibleProperty:q}},{value:Mt,createNode:()=>m(u.customIcon,"Custom"),labelContent:"Custom",options:{visibleProperty:q}}]),C=new W(p,"Show Custom Options",{advanced:!0}),w=new D({spacing:20,align:"left",children:[new R({spacing:20,children:[t,s]}),l],visibleProperty:f}),b=new te("Reload to Defaults",{accessibleName:"Clear all settings/data, and reload the page",listener:()=>{localStorage.clear(),self.location.reload()},advanced:!0});b.addInputListener(e),super(new D({spacing:20,align:"left",stretch:!0,children:[a,new R({align:"top",spacing:30,children:[S,n,r]}),C,w,b,new W(q,"Show Advanced Settings")]}),o)}}class mr extends Re{constructor(e){const t=new Oe(!1),n=new te("Copy URL",{accessibleName:"Copy Shareable URL to Clipboard",listener:()=>{if(this.puzzle){const r=location.protocol+"//"+location.host+location.pathname;let l=this.puzzle;this.includeStateProperty.value||(l=new le(l.board,Dt.fromFaceValueData(l.board,l.stateProperty.value)));const s=qo(l);bn(r+"?p="+encodeURIComponent(s))}}});n.addInputListener(new Ee(e));super(new D({spacing:20,align:"left",stretch:!0,children:[n,new L("Include Solve Progress",t)]}),e);I(this,"includeStateProperty");I(this,"puzzle",null);this.includeStateProperty=t}setPuzzle(e){this.puzzle=e}reset(){super.reset(),this.includeStateProperty.reset()}}const oe=class oe extends no{constructor(o){super(),this.canSolve=o}};I(oe,"STANDARD",new oe((o,e)=>(e=e.clone(),er(Do,o,e,!0),Zo(e)))),I(oe,"NO_LIMIT",new oe(()=>!0)),I(oe,"enumeration",new ro(oe));let Ce=oe;const kt=new Lo("canSolveDifficulty",Ce.STANDARD),Cr=d=>{const o=d.cleanState.clone();for(const e of d.board.faces)o.getFaceValue(e)===null&&o.setFaceValue(e,e.edges.filter(t=>d.blackEdges.has(t)).length);return tr(d.board,o,d.blackEdges)};class Pr extends R{constructor(o,e){const t=new xo("polygonGeneratorProperty",{serialize:i=>i.name,deserialize:i=>xe.find(c=>c.name===i)??xe[0]}),n=localStorage.getItem("polygonGeneratorParameters")?JSON.parse(localStorage.getItem("polygonGeneratorParameters")):null;let r=!1;const l=Z("Patterns",t,xe.map(i=>({value:i,createNode:()=>new V(i.name,{font:Y,fill:g.uiForegroundColorProperty}),labelContent:i.name})),{layoutOptions:{align:"top",grow:0},justify:"top"}),s=new R({spacing:10,align:"center",layoutOptions:{grow:0},grow:1}),a=new R({spacing:10,align:"center",layoutOptions:{grow:0},children:[new A("Solver Difficulty"),new or(kt,[{value:Ce.STANDARD,createNode:()=>new A("Standard"),labelContent:"Standard"},{value:Ce.NO_LIMIT,createNode:()=>new A("No Limit"),labelContent:"No Limit"}],{orientation:"horizontal",align:"center",spacing:30})]}),p=new R({spacing:10,align:"center",justify:"spaceEvenly",layoutOptions:{grow:0}}),f=new N,u=new N,m=new ve;m.addListener(()=>{u.children=[]});const S=new N({children:[f,u]}),C=(i,c)=>{const E=i.generate(c),P=new M;E.forEach(v=>P.polygon(v)),f.children=[new K(P,{fill:g.puzzleBackgroundColorProperty,stroke:g.blackLineColorProperty,lineWidth:.05})],m.emit()};C(xe[0],{width:5,height:5}),t.link(i=>{p.children.forEach(v=>v.dispose()),s.children.forEach(v=>v.dispose());const c={},E=v=>n&&!r&&v in n?n[v]:i.defaultParameterValues[v],P=()=>{localStorage.setItem("polygonGeneratorParameters",JSON.stringify(c)),C(i,c)};for(const[v,k]of Object.entries(i.parameters))if(k.type==="integer"){const B=new ft(E(v));B.link(h=>{c[v]=h,P()}),p.addChild(new Ie(k.label,B,k.range,{layoutFunction:Ie.createLayoutFunction4(),titleNodeOptions:{font:Y,fill:g.uiForegroundColorProperty},sliderOptions:{trackSize:new Ze(100,5),labelTagName:"label",keyboardStep:1,labelContent:k.label},arrowButtonOptions:{touchAreaXDilation:5,touchAreaYDilation:25},numberDisplayOptions:{decimalPlaces:0},delta:1,visibleProperty:k.advanced?q:null}))}else if(k.type==="float"){const B=new ft(E(v));B.link(h=>{c[v]=h,P()}),p.addChild(new Ie(k.label,B,k.range,{layoutFunction:Ie.createLayoutFunction4(),titleNodeOptions:{font:Y,fill:g.uiForegroundColorProperty},sliderOptions:{trackSize:new Ze(100,5),labelTagName:"label",keyboardStep:.1,labelContent:k.label},numberDisplayOptions:{decimalPlaces:2},delta:.01,visibleProperty:k.advanced?q:null}))}else if(k.type==="boolean"){const B=new Oe(E(v));B.link(h=>{c[v]=h,P()}),p.addChild(new L(k.label,B,{advanced:k.advanced}))}else if(k.type==="choice"){const B=new rt(E(v));B.link(h=>{c[v]=h,P()}),p.addChild(Z(k.label,B,k.choices.map(h=>({value:h.value,createNode:()=>new V(h.label,{font:Y,fill:g.uiForegroundColorProperty}),labelContent:h.label}))))}r=!0,s.addChild(new te("Generate",{font:Je,layoutOptions:{align:"center"},listener:async()=>{m.emit();const v=i.generate(c),k=new ho(v,i.scale??1),B=new ie(!1),h=()=>{B.value=!0};m.addListener(h);const y=new ve,j=new ve,_=new ve;_.addListener(()=>{u.children=[]}),y.addListener((T,H)=>{u.addChild(new K(M.polygon(v[T]),{fill:g.generateAddedFaceColorProperty,stroke:g.blackLineColorProperty,lineWidth:.05})),H!==null&&u.addChild(new V(`${H}`,{font:Je,fill:g.faceValueColorProperty,maxWidth:.9,maxHeight:.9,center:we(v[T])}))}),j.addListener((T,H)=>{u.addChild(new K(M.polygon(v[T]),{fill:g.generateMinimizedFaceColorProperty,stroke:g.blackLineColorProperty,lineWidth:.05})),H!==null&&u.addChild(new V(`${H}`,{font:Je,fill:g.faceValueColorProperty,maxWidth:.9,maxHeight:.9,center:we(v[T])}))});try{const T=kt.value,H=T.canSolve,Fe=async()=>await Xo(k,B,y),ut=async()=>{let De=await Fe();if(T===Ce.NO_LIMIT)return De;{const _t=k.faces.filter(Le=>De.cleanState.getFaceValue(Le)===null),pt=Cr(De);return _t.forEach(Le=>{y.emit(k.faces.indexOf(Le),pt.cleanState.getFaceValue(Le))}),pt}};let Ne=await ut();for(;!H(Ne.board,Ne.cleanState.clone());)_.emit(),Ne=await ut();const jt=await Jo(Ne,H,B,j);Yo(17,B),B.value||(u.children=[],b.loadPuzzle(le.fromSolvedPuzzle(jt)))}catch{}m.hasListener(h)&&m.removeListener(h)}}))});const w=new O({fill:g.playAreaBackgroundColorProperty,sizable:!0,layoutOptions:{grow:1},children:[S]});st.multilink([w.localPreferredWidthProperty,w.localPreferredHeightProperty,S.localBoundsProperty],(i,c,E)=>{if(i!==null&&c!==null&&E.isFinite()){const v=i-30,k=c-2*15,B=Math.min(v/E.width,k/E.height);S.setScaleMagnitude(B),S.centerX=i/2,S.centerY=c/2}});const b=Q()({spacing:10,stretch:!0,children:[l,new D({spacing:10,stretch:!0,layoutOptions:{grow:1},children:[w,s,new je,a,new je,p]})]},e);super(b)}}const vr="#444",Sr="#fa0",br="#888",Er="#fff",kr="#f00",Fr="#ff0",Nr="#ff0",Lr="#0f0",xr="#0ff",Ir="#0af",Br="#f0f";class zr extends Re{constructor(e){const t=new R({children:[new V("Loading image...",{font:Y,fill:g.uiForegroundColorProperty})]}),n=new N({children:[t]});super(n,e);I(this,"scanContentNode");I(this,"imageContainer");I(this,"solutionContainer");I(this,"blackImageLayer");I(this,"originalImageLayer");I(this,"thresholdImageLayer");I(this,"contourLayer");I(this,"puzzle",null);I(this,"rootContour",null);I(this,"contours",[]);I(this,"contourNodeMap",new Map);this.scanContentNode=n,this.blackImageLayer=new N,this.originalImageLayer=new N({visible:!1}),this.thresholdImageLayer=new N({visible:!1}),this.contourLayer=new N,this.imageContainer=new N({children:[this.blackImageLayer,this.originalImageLayer,this.thresholdImageLayer,this.contourLayer]}),this.solutionContainer=new N}getScanOptions(){return{originalImageCallback:e=>this.onOriginalImage(e),thresholdedImageCallback:e=>this.onThresholdedImage(e),rootContourCallback:e=>this.onRootContour(e),widestSubtreeCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeWidestContour()},dotContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeDotContour()},lineContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeLineContour()},zeroOuterContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeZeroOuterContour()},zeroInnerContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeZeroInnerContour()},oneContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeOneContour()},twoContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeTwoContour()},threeContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeThreeContour()},xContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeXContour()},unknownContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeUnknownContour()},debugImageCallback:e=>{},puzzleCallback:e=>this.onPuzzle(e),solutionsCallback:e=>this.onSolutions(e)}}onOriginalImage(e){this.originalImageLayer.addChild(new wt(e)),this.blackImageLayer.addChild(O.bounds(this.originalImageLayer.bounds,{fill:"black"})),this.scanContentNode.children=[new D({spacing:10,children:[this.imageContainer,this.solutionContainer]})]}onThresholdedImage(e){this.thresholdImageLayer.addChild(new wt(e))}onRootContour(e){this.rootContour=e,this.contours=e.getDescendantContours();for(const t of this.contours){const n=new Ar(t);this.contourNodeMap.set(t,n),this.contourLayer.addChild(n)}}onPuzzle(e){this.puzzle=e}onSolutions(e){if(e.length===1)this.hide();else{const t=this.puzzle;F()&&x(t);const n=t.board;if(e.length===0){Se(n,t.stateProperty.value);const r=new he(t,{scale:20});this.solutionContainer.children=[new D({spacing:10,children:[new A("No Solutions Found"),r]})]}else{const r=new le(n,t.stateProperty.value.clone()),l=new le(n,t.stateProperty.value.clone()),s=new le(n,t.stateProperty.value.clone());e[0].forEach(u=>r.stateProperty.value.setEdgeState(u,ne.BLACK)),e[1].forEach(u=>l.stateProperty.value.setEdgeState(u,ne.BLACK)),n.edges.forEach(u=>{r.stateProperty.value.getEdgeState(u)!==l.stateProperty.value.getEdgeState(u)&&s.stateProperty.value.setEdgeState(u,ne.BLACK)}),Se(n,r.stateProperty.value),Se(n,l.stateProperty.value),Se(n,s.stateProperty.value);const a=new he(r,{scale:10}),p=new he(l,{scale:10}),f=new he(s,{scale:10});this.solutionContainer.children=[new D({spacing:10,children:[new A("Multiple Solutions Found"),new R({spacing:10,children:[new D({spacing:10,children:[a,new A("Solution A")]}),new D({spacing:10,children:[p,new A("Solution B")]}),new D({spacing:10,children:[f,new A("Difference")]})]})]})]}}}}class Ar extends N{constructor(e){const t=new K(e.shape,{stroke:vr});super({children:[t]});I(this,"path");this.contour=e,this.path=t}makeWidestContour(){this.path.stroke=Sr}makeDotContour(){this.path.stroke=br}makeLineContour(){this.path.stroke=Er}makeXContour(){this.path.stroke=kr}makeZeroOuterContour(){this.path.stroke=Fr}makeZeroInnerContour(){this.path.stroke=Nr}makeOneContour(){this.path.stroke=Lr}makeTwoContour(){this.path.stroke=xr}makeThreeContour(){this.path.stroke=Ir}makeUnknownContour(){this.path.stroke=Br}}class Tr extends Re{constructor(o,e){super(new D({spacing:20,align:"left",stretch:!0,children:[new N({children:[new Pr(o,{loadPuzzle:t=>{this.hide(),e.loadPuzzle(t)},preferredWidth:700,preferredHeight:300})]}),new je,new R({spacing:15,grow:1,children:[new te("Load String",{listener:()=>{this.hide();const t=prompt("Enter puzzle string");t&&e.loadPuzzle(le.loadDeprecatedScalaString(t))}}),new te("Load Image (Rectangular Only)",{listener:()=>{this.hide();const t=document.createElement("input");t.type="file",t.onchange=n=>{const r=n.target.files[0];var l=new FileReader;l.readAsDataURL(r),l.onloadend=async()=>{const s=l.result,a=new zr(o);a.show();const p=await so(s,a.getScanOptions());e.loadPuzzle(p)}},t.click()}})]})]}),o)}}class Or extends V{constructor(o,e){const t=Q()({font:En,fill:g.timerColorProperty},e),n=60,r=60*n,l=24*r,s=new ce([o],a=>{a=Math.ceil(a);const p=Math.floor(a/l);a-=p*l;const f=Math.floor(a/r);a-=f*r;const u=Math.floor(a/n);a-=u*n;const m=a,S=f<10?`0${f}`:`${f}`,C=u<10?`0${u}`:`${u}`,w=m<10?`0${m}`:`${m}`;return p?`${p}d ${S}:${C}:${w}`:f?`${S}:${C}:${w}`:`${C}:${w}`});super(s,t),this.timerProperty=o,this.disposeEmitter.addListener(()=>{s.dispose()})}}class Mr extends R{constructor(o,e,t){const n=new Ee(e),r=new ie(!1),l=new ie(0),s=new ie(ae.NOT_FOUND),a=new se(o,{derive:c=>c?c.undoPossibleProperty:r}),p=new se(o,{derive:c=>c?c.redoPossibleProperty:r}),f=new se(o,{derive:c=>c?c.isSolvedProperty:r}),u=new se(o,{derive:c=>c?c.timeElapsedProperty:l}),m=new se(o,{derive:c=>c?c.hintStateProperty:s}),S=new ce([f],c=>!c);let C=null,w=null,b=null;const i={buttonAppearanceStrategy:ge,baseColor:g.uiButtonBaseColorProperty,disabledColor:g.uiButtonDisabledColorProperty,xMargin:8*1.3,yMargin:5*1.3,mouseAreaXDilation:5,mouseAreaYDilation:5,touchAreaXDilation:5,touchAreaYDilation:5};super({spacing:10,stretch:!0,children:[new Ae("New",X({},i,{accessibleName:"New",listener:()=>{C=C||new Tr(e,{loadPuzzle:t.loadPuzzle}),C.show()},textFill:g.uiButtonForegroundProperty,baseColor:g.uiButtonBaseColorProperty,xMargin:5,yMargin:5,font:Ye,buttonAppearanceStrategy:ge})),new ue(X({},i,{accessibleName:"Undo All",content:re(hr),listener:()=>{o.value&&o.value.onUserUndoAll()},enabledProperty:a,visibleProperty:tt})),new ue(X({},i,{accessibleName:"Undo",content:re(ur),listener:()=>{o.value&&o.value.onUserUndo()},enabledProperty:a,fireOnHold:!0})),new Or(u,{visibleProperty:Vt}),new ue(X({},i,{accessibleName:"Redo",content:re(pr),listener:()=>{o.value&&o.value.onUserRedo()},enabledProperty:p,fireOnHold:!0})),new ue(X({},i,{accessibleName:"Redo All",content:re(gr),listener:()=>{o.value&&o.value.onUserRedoAll()},enabledProperty:p,visibleProperty:tt})),new ue(X({},i,{accessibleName:"Settings",content:re(dr),listener:()=>{b=b||new yr(e),b.show()}})),new ue(X({},i,{accessibleName:"Share",content:re(fr),listener:()=>{const c=o.value;c&&(w=w||new mr(e),w.setPuzzle(c.puzzle),w.show())}})),new Ae("Solve",X({},i,{accessibleName:"Solve",listener:()=>{o.value&&o.value.onUserRequestSolve()},enabledProperty:S,textFill:g.uiButtonForegroundProperty,baseColor:g.uiButtonBaseColorProperty,xMargin:5,yMargin:5,font:Ye,buttonAppearanceStrategy:ge})),new Ae("Hint",X({},i,{accessibleName:"Hint",listener:()=>{o.value&&o.value.onUserRequestHint()},enabledProperty:new ce([S,m],(c,E)=>c&&E===ae.DEFAULT),textFill:g.uiButtonForegroundProperty,baseColor:g.uiButtonBaseColorProperty,xMargin:5,yMargin:5,font:Ye,buttonAppearanceStrategy:ge}))]}),this.puzzleModelProperty=o,this.children.forEach(c=>c.addInputListener(n)),e.layoutBoundsProperty.link(c=>{this.maxWidth=Math.max(1,c.width-2*me)})}}const ke=new N,Xt=new N,Rr=()=>{const d=Me.p||localStorage.getItem("puzzleString"),o=le.loadDefaultPuzzle();let e=null,t=0;try{let n=o;if(d){const r=Wt(d);if(r){n=r;const l=localStorage.getItem("timeElapsedProperty");t=l?JSON.parse(l):0}}e=nt(n.board,n.stateProperty.value)}catch(n){console.error(n)}return e||(e=nt(o.board,o.stateProperty.value)),F()&&x(e),new qt(e,{initialTimeElapsed:t})},Hr=g.uiForegroundColorProperty,Vr=new ce([g.uiForegroundColorProperty],d=>d.withAlpha(.15));class qr extends N{constructor(o,e,t,n){super({});const r=new Fn({diameter:20,activeColor:Hr,inactiveColor:Vr});this.disposeEmitter.addListener(()=>r.dispose());const l={xMargin:5,yMargin:5,fill:g.uiBackgroundColorProperty,stroke:g.uiForegroundColorProperty},s=new be(new R({spacing:10,children:[new N({children:[r]}),new A("Loading Hint Solver...")]}),l),a=new R({spacing:10,children:[new be(new R({spacing:10,children:[new N({children:[r]}),new A("Searching for Hint...")]}),l),new te("Cancel",{listener:n})]}),p=new R({spacing:10,children:[new te("Apply Hint",{listener:t}),new te("Hide Hint",{listener:n})]}),f=new be(new A("No Hint Found"),l);f.pickable=!1;const u=S=>{this.children=[...S===ae.LOADING?[s]:[],...S===ae.SEARCHING?[a]:[],...S===ae.FOUND?[p]:[],...S===ae.NOT_FOUND?[f]:[]]};e.link(u),this.disposeEmitter.addListener(()=>e.unlink(u));const m=S=>{r.step(S)};o.stepEmitter.addListener(m),this.disposeEmitter.addListener(()=>o.stepEmitter.removeListener(m))}}class Dr{constructor(o,e,t,n){I(this,"maxLineWidth");I(this,"disposeFlatAppearanceStrategy");const r=new yt(t,{luminanceFactor:-.3}),l=new yt(t,{luminanceFactor:-.6}),s=r,a=l,p=X({stroke:l},n),f=1.5;o.stroke=p.stroke||l,o.lineWidth=f,this.maxLineWidth=1.5,o.cachedPaints=[t,s,a];function u(m){let S=1,C=1;switch(m){case ye.IDLE:o.fill=t,o.stroke=r,S=.3;break;case ye.OVER:o.fill=t,o.stroke=r,S=.5;break;case ye.PRESSED:o.fill=t,o.stroke=g.uiButtonSelectedStrokeColorProperty,C=1.5;break;default:throw new Error(`unsupported interactionState: ${m}`)}o.opacity=S,o.lineWidth=C}e.link(u),this.disposeFlatAppearanceStrategy=()=>{e.hasListener(u)&&e.unlink(u),r.dispose(),l.dispose()}}dispose(){this.disposeFlatAppearanceStrategy()}}class Wr{constructor(o,e,t){I(this,"dispose");function n(r){let l=1;switch(r){case ye.IDLE:l=.6;break;case ye.OVER:break;case ye.PRESSED:break;default:throw new Error(`unsupported interactionState: ${r}`)}o.opacity=l}e.link(n),this.dispose=()=>{e.hasListener(n)&&e.unlink(n)}}}class Ur extends R{constructor(o){const e=new $e(0,0,15,0,{stroke:g.uiButtonForegroundProperty,lineWidth:4,lineCap:"round"}),t=6,n=new M().moveTo(-t,-t).lineTo(t,t).moveTo(-t,t).lineTo(t,-t),r=new K(n,{stroke:g.uiButtonForegroundProperty,lineWidth:2}),l=new N({children:[new O(0,0,14,14,{stroke:g.uiButtonForegroundProperty,fill:g.uiButtonFaceOutsideColorProperty})]}),s=new N({children:[new O(0,0,14,14,{stroke:g.uiButtonForegroundProperty,fill:g.uiButtonFaceInsideColorProperty})]}),a=new N({children:[new O(0,0,7,7,{stroke:g.uiButtonForegroundProperty,fill:g.uiForegroundColorProperty}),new O(7,7,7,7,{stroke:g.uiButtonForegroundProperty,fill:g.uiForegroundColorProperty})]}),p=new N({children:[new O(0,0,7,7,{stroke:g.uiButtonForegroundProperty,fill:g.uiForegroundColorProperty}),new O(7,7,7,7,{stroke:g.uiButtonForegroundProperty,fill:g.uiBackgroundColorProperty})]}),f=new N({children:[new K(new M().moveTo(0,14).lineTo(0,0).lineTo(14,0),{stroke:g.uiButtonForegroundProperty}),new K(new M().arc(0,0,7,0,Math.PI/2,!1),{stroke:g.uiButtonForegroundProperty})]}),u=17,m=6,S=7,C=2,w=S/Math.sqrt(2),b=new N({children:[new N({rotation:-Math.PI/4,children:[new O(0,0,u,S,{stroke:g.uiButtonForegroundProperty,fill:g.uiButtonInvertedForegroundProperty,cornerRadius:C}),new O(m,0,u-m,S,{fill:g.uiButtonForegroundProperty,cornerRadius:C})]}),new $e(w,w-.5,w+12,w-.5,{stroke:g.uiButtonForegroundProperty,lineDash:[5,1,3,1,2]})]}),i=new Ee(o),c=k=>new N({scale:1.3,children:[k]}),E=new Gt(Wo,[{value:G.EDGE_STATE,labelContent:"Edge Edit Mode",createNode:()=>c(e),options:{visibleProperty:G.EDGE_STATE.isEnabledProperty}},{value:G.EDGE_STATE_REVERSED,labelContent:"Edge Reversed Edit Mode",createNode:()=>c(r),options:{visibleProperty:G.EDGE_STATE_REVERSED.isEnabledProperty}},{value:G.FACE_COLOR_INSIDE,labelContent:"Face Color Inside Edit Mode",createNode:()=>c(s),options:{visibleProperty:G.FACE_COLOR_INSIDE.isEnabledProperty}},{value:G.FACE_COLOR_OUTSIDE,labelContent:"Face Color Outside Edit Mode",createNode:()=>c(l),options:{visibleProperty:G.FACE_COLOR_OUTSIDE.isEnabledProperty}},{value:G.FACE_COLOR_MATCH,labelContent:"Face Color Match Edit Mode",createNode:()=>c(a),options:{visibleProperty:G.FACE_COLOR_MATCH.isEnabledProperty}},{value:G.FACE_COLOR_OPPOSITE,labelContent:"Face Color Opposite Edit Mode",createNode:()=>c(p),options:{visibleProperty:G.FACE_COLOR_OPPOSITE.isEnabledProperty}},{value:G.SECTOR_STATE,labelContent:"Sector Edit Mode",createNode:()=>c(f),options:{visibleProperty:G.SECTOR_STATE.isEnabledProperty}}],{spacing:15,layoutOptions:{grow:1}});E.children.forEach(k=>k.addInputListener(i));const P={buttonAppearanceStrategy:ge,baseColor:g.uiButtonBaseColorProperty,disabledColor:g.uiButtonDisabledColorProperty,mouseAreaXDilation:5,mouseAreaYDilation:5,touchAreaXDilation:5,touchAreaYDilation:5},v=new Io(it,X({},P,{accessibleName:"Eraser Mode (Toggle)",content:c(b),buttonAppearanceStrategy:Dr,contentAppearanceStrategy:Wr}));v.addInputListener(i),super({spacing:13,stretch:!0,children:[E,new Po,v]}),o.layoutBoundsProperty.link(k=>{this.maxWidth=Math.max(1,k.width-2*me)})}}class Gr{constructor(o,e,t){this.layoutBoundsProperty=o,this.glassPane=e,this.stepEmitter=t}}self.assertions;const Xr=new N({renderer:"svg",children:[ke]}),Pe=new vo(Xr,{allowWebGL:!0,allowBackingScaleAntialiasing:!0,allowSceneOverflow:!1,accessibility:!0,backgroundColor:"#eee",assumeFullWindow:!0,listenToOnlyElement:Me.debugColors});document.body.appendChild(Pe.domElement);Pe.setPointerAreaDisplayVisible(Me.showPointerAreas);self.oncontextmenu=d=>d.preventDefault();const ct=new rt(new Te(0,0,self.innerWidth,self.innerHeight)),J=new ie(Rr()),Jt=new Ut(J,at,{layoutOptions:{stretch:!0,grow:1}}),Yt=new Ut(J,at,{layoutOptions:{stretch:!0,grow:1},topological:!0,visibleProperty:lt}),Jr=new Oe(!1),Yr=new se(J,{derive:d=>d?d.hasErrorProperty:Jr}),Kr=new se(J,{derive:d=>d?d.hintStateProperty:new ie(ae.DEFAULT)});st.multilink([Yr,Rt,g.navbarBackgroundColorProperty,g.navbarErrorBackgroundColorProperty],(d,o,e,t)=>{Pe.backgroundColor=d&&o?t:e});const Kt=new ve,Ve=new Gr(ct,Xt,Kt),Zt=new Mr(J,Ve,{loadPuzzle:d=>{const o=nt(d.board,d.stateProperty.value);o&&(J.value=new qt(o))}}),Zr=new Ur(Ve),Qr=new He(Ve),Qt=new qr(Ve,Kr,()=>{var d;(d=J.value)==null||d.onUserApplyHint()},()=>{var d;(d=J.value)==null||d.onUserClearHint()}),fe=new D({stretch:!0,children:[new ze(Zt,{margin:me}),new R({grow:1,stretch:!0,layoutOptions:{grow:1},children:[Jt,Yt]}),new ze(Qr,{margin:me,visibleProperty:Ht}),new ze(Zr,{margin:me})]});ct.lazyLink(d=>{fe.preferredWidth=d.width,fe.preferredHeight=d.height,fe.x=d.left,fe.y=d.top});ke.addChild(fe);ke.addChild(Qt);ke.addChild(Xt);So.create(ke,[Zt,Qt],(d,o)=>{o.centerTop=d.centerBottom.plusXY(0,5)});Pe.initializeEvents();let dt=!0;const $t=()=>{dt=!1;const d=new Te(0,0,self.innerWidth,self.innerHeight);Pe.setWidthHeight(d.width,d.height),ct.value=d,go.mobileSafari&&self.scrollTo(0,0)},qe=()=>{dt=!0};$(self).resize(qe);self.addEventListener("resize",qe);self.addEventListener("orientationchange",qe);self.visualViewport&&self.visualViewport.addEventListener("resize",qe);$t();Pe.updateOnRequestAnimationFrame(d=>{var o;Ko(),dt&&$t(),fe.validateBounds(),Jt.step(d),Yt.step(d),(o=J.value)==null||o.step(d),Kt.emit(d)});document.addEventListener("keydown",d=>{var o,e,t,n;if(d.ctrlKey||d.metaKey)d.key==="z"&&(d.shiftKey?(o=J.value)==null||o.onUserRedo():(e=J.value)==null||e.onUserUndo()),d.key==="y"&&((t=J.value)==null||t.onUserRedo());else if(["1","2","3","4","5","6","7","8","9"].includes(d.key)){const r=Number.parseInt(d.key,10)-1,l=G.enumeration.values.filter(s=>s.isEnabledProperty.value);r<l.length&&Uo(l[r])}else d.key==="Escape"&&((n=J.value)==null||n.onUserEscape())});Nt.keydownEmitter.addListener(d=>{d.key==="e"&&(it.value=!0)});Nt.keyupEmitter.addListener(d=>{d.key==="e"&&(it.value=!1)});J.lazyLink((d,o)=>{o&&o.dispose()});
