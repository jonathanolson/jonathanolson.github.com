var S=Object.defineProperty;var q=(d,t,s)=>t in d?S(d,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):d[t]=s;var i=(d,t,s)=>(q(d,typeof t!="symbol"?t+"":t,s),s);import"./Vector2Property-95p6aBvi.js";import{N as x,h as B,V as I,d as j}from"./PhetioControlledVisibilityProperty-Dfpbwmh8.js";import{t as M,p as G,u as P}from"./patternBoards-DyfRjV5l.js";import{P as H}from"./PlanarMappedPatternBoardNode-BrLugRV5.js";import{P as $,g as W}from"./PatternBoardSolver-D30pPXgS.js";import"./getCoordinateClusteredMap-DnTHDDo2.js";import"./getPeriodicTilingGenerator-BAI_tkyR.js";import"./Theme-D8pnKvi2.js";import"./TextPushButton-B9SU16pf.js";import"./logic-solver-DfLyjx-d.js";import"./operations-CXBIDRbn.js";var l=(d=>(d[d.TRUE=0]="TRUE",d[d.FALSE=1]="FALSE",d[d.UNDEF=2]="UNDEF",d))(l||{});(d=>{function t(n){switch(n){case 0:return 0;case 1:return 1;case 2:return 2;default:throw new Error("IllegalArgumentException: value")}}d.valueOf=t;function s(n){return n?0:1}d.valueOfBoolean=s;const e=[[1,0],[0,1],[2,2]];function a(n,u){return e[n][u?1:0]}d.xor=a;const r=[[0,1,2],[1,1,1],[2,1,2]];function h(n,u){return r[n][u]}d.and=h;const o=[[0,0,0],[0,1,2],[0,2,2]];function w(n,u){return o[n][u]}d.or=w})(l||(l={}));class y{constructor(t,s){i(this,"cref");i(this,"blocker");this.cref=t,this.blocker=s}equals(t){if(!(t instanceof y))return!1;const s=t;return this.cref.equals(s.cref)}toString(){return`Watcher(${this.cref}, ${this.blocker})`}}class O{constructor(t,s){i(this,"data",null);i(this,"sz",0);i(this,"defaultObject");i(this,"defaultValue");this.defaultObject=this.create(),this.defaultValue=this.value(this.defaultObject),t!==void 0&&s!==void 0?this.growTo(t,s):t!==void 0&&this.growTo(t)}size(){return this.sz}shrink(t){if(t>this.sz)throw new Error("nelems");for(let s=0;s<t;++s)this.data[--this.sz]=this.defaultValue}shrink_(t){if(t>this.sz)throw new Error("nelems");this.sz-=t}get capacity(){return this.data===null?0:this.data.length}push(t){this.sz===this.capacity&&(this.capacity=this.sz+1),this.data[this.sz++]=t===void 0?this.defaultValue:this.value(t)}push_(t){if(this.sz>=this.capacity)throw new Error("Index out of bounds");this.data[this.sz++]=this.value(t)}pop(){if(this.sz<=0)throw new Error("Index out of bounds");this.sz--}last(){return this.create(this.data[this.sz-1])}get(t){return this.create(this.data[t])}set(t,s){return this.data[t]=this.value(s),s}copyTo(t){t.clear(),t.growTo(this.sz),!(this.sz<=0)&&this.data.slice(0,this.sz).forEach((s,e)=>t.data[e]=s)}moveTo(t){t.clear(!0),t.data=this.data,t.sz=this.sz,this.data=null,this.sz=0}static imax(t,s){const e=s-t>>31;return(t&e)+(s&~e)}set capacity(t){const s=this.capacity;if(s>=t)return;const e=O.imax(t-s+1&-2,(s>>1)+2&-2),a=new Array(s+e).fill(this.defaultValue);this.data!==null&&this.data.slice(0,this.sz).forEach((r,h)=>a[h]=r),this.data=a}growTo(t,s){if(s===void 0)this.growTo(t,this.defaultObject);else{if(this.sz>=t)return;this.capacity=t;for(let e=this.sz;e<t;e++)this.data[e]=this.value(s);this.sz=t}}clear(t=!1){this.data!==null&&(this.sz=0,t&&(this.data=null))}toString(){const t=[];t.push("[");let s="";for(let e=0;e<this.sz;++e)t.push(s+this.toStringValue(this.data[e])),s=", ";return t.push("]"),t.join("")}quickSort(t,s){if(t<=s){const e=this.data[(t+s)/2];let a=t,r=s;for(;a<=r;){for(;this.compare(this.data[a],e)<0;)a++;for(;this.compare(this.data[r],e)>0;)r--;if(a<=r){const h=this.data[a];this.data[a]=this.data[r],this.data[r]=h,a++,r--}}this.quickSort(t,r),this.quickSort(a,s)}}sort(){this.data!==null&&this.quickSort(0,this.sz-1)}remove(t){let s=0;for(;s<this.data.length&&this.data[s]!==this.value(t);s++);if(s>=this.data.length)throw new Error("t");for(;s<this.data.length-1;s++)this.data[s]=this.data[s+1];this.pop()}[Symbol.iterator](){let t=0;return{next:()=>t<this.sz?{done:!1,value:this.create(this.data[t++])}:{done:!0,value:void 0}}}}const p=class p{constructor(t){i(this,"x");this.x=t}compareTo(t){return this.x-t.x}equals(t){return this.compareTo(t)===0}static valueOf(t){switch(t){case p.UNDEF_VALUE:return p.UNDEF;case p.ERROR_VALUE:return p.ERROR}for(let s=p.cache.length;s<=t;++s)p.cache.push(new p(s));return p.cache[t]}static valueOfVar(t,s){if(t<0)throw new Error("variable");return p.valueOf(t+t+(s?1:0))}not(){return p.valueOf(this.x^1)}xor(t){return p.valueOf(this.x^(t?1:0))}sign(){return(this.x&1)===1}var(){return this.x>>>1}value(){return this.x}toString(){switch(this.x){case p.UNDEF_VALUE:return"UNDEF";case p.ERROR_VALUE:return"ERROR"}return`Lit(${this.var()}, ${this.sign()})`}};i(p,"UNDEF_VALUE",-2),i(p,"ERROR_VALUE",-1),i(p,"cache",[]),i(p,"UNDEF",new p(p.UNDEF_VALUE)),i(p,"ERROR",new p(p.ERROR_VALUE));let g=p;class z extends O{constructor(t,s){if(typeof t=="number")s!==void 0?super(t,s):super(t);else if(Array.isArray(t)){super();for(const e of t)this.push(e)}else super()}create(t){return t===void 0?g.UNDEF:g.valueOf(t)}value(t){return t.value()}compare(t,s){return t-s}toStringValue(t){return g.valueOf(t).toString()}}const L=class L extends z{constructor(s,e,a){super();i(this,"_mark");i(this,"_learnt");i(this,"_has_extra");i(this,"_act");i(this,"_abs");this._mark=0,this._learnt=a,this._has_extra=e;for(let r=0;r<s.size();++r)this.push(s.get(r));this._has_extra&&(this._learnt?this._act=0:this.calcAbstraction())}equals(s){return this===s}calcAbstraction(){if(!this._has_extra)throw new Error("has_extra is false");let s=0;for(let e=0;e<this.size();++e)s|=1<<(this.get(e).var()&31);this._abs=s}learnt(){return this._learnt}has_extra(){return this._has_extra}mark(s){if(s===void 0)return this._mark;this._mark=s}reloced(){return!1}relocation(){throw new Error("UnsupportedOperationException")}relocate(s){throw new Error("UnsupportedOperationException")}get activity(){if(!this._has_extra)throw new Error("has_extra is false");return this._act}set activity(s){this._act=s}abstraction(){if(!this._has_extra)throw new Error("has_extra is false");return this._abs}subsumes(s){if(this._learnt||s._learnt)throw new Error("learnt is true");if(!this._has_extra||s._has_extra)throw new Error("has_extra is false");if(s.size()<this.size()||this._abs&~s._abs)return g.ERROR;let e=g.UNDEF;t:for(let a=0;a<this.size();a++){const r=this.get(a);for(let h=0;h<s.size();h++){const o=s.get(h);if(r.equals(o))continue t;if(e.equals(g.UNDEF)&&r.equals(o.not())){e=r;continue t}}return g.ERROR}return e}strengthen(s){this.remove(s),this.calcAbstraction()}};i(L,"CRef_Undef",new L(new z,!1,!1));let v=L;class F{constructor(t,s){i(this,"reason");i(this,"level");this.reason=t,this.level=s}equals(t){return this===t}static mkVarData(t,s){return new F(t,s)}}class V extends O{constructor(t,s){typeof t=="number"?s!==void 0?super(t,s):super(t):super()}create(t){return t===void 0?l.UNDEF:l.valueOf(t)}value(t){return t}compare(t,s){return t-s}toStringValue(t){return l[t].toString()}}class U{constructor(t,s){i(this,"data",null);i(this,"sz",0);t!==void 0&&s!==void 0?this.growTo(t,s):t!==void 0&&this.growTo(t)}static imax(t,s){const e=s-t>>31;return(t&e)+(s&~e)}equals(t){return this===t}size(){return this.sz}shrink(t){if(t>this.sz)throw new Error("nelems");for(let s=0;s<t;++s)this.data[--this.sz]=null}shrink_(t){if(t>this.sz)throw new Error("nelems");this.sz-=t}push(t){this.sz===this.capacity&&(this.capacity=this.sz+1),this.data[this.sz++]=t===void 0?null:t}pop(){if(this.sz<=0)throw new Error("Index out of bounds");this.sz--}last(){return this.data[this.sz-1]}get(t){return this.data[t]}set(t,s){return this.data[t]=s}copyTo(t){t.clear(),t.growTo(this.sz),!(this.sz<=0)&&this.data.slice(0,this.sz).forEach((s,e)=>t.data[e]=s)}moveTo(t){t.clear(!0),t.data=this.data,t.sz=this.sz,this.data=null,this.sz=0}get capacity(){return this.data===null?0:this.data.length}set capacity(t){const s=this.capacity;if(s>=t)return;const e=U.imax(t-s+1&-2,(s>>1)+2&-2),a=new Array(s+e);this.data!==null&&this.data.slice(0,this.sz).forEach((r,h)=>a[h]=r),this.data=a}growTo(t,s){if(!(this.sz>=t)){this.capacity=t;for(let e=this.sz;e<t;e++)this.data[e]=s===void 0?null:s;this.sz=t}}clear(t=!1){this.data!==null&&(this.sz=0,t&&(this.data=null))}toString(){const t=[];t.push("[");let s="";for(let e=0;e<this.data.length;++e)t.push(s+this.data[e]),s=", ";return t.push("]"),t.join("")}sort(t){this.sz<=1||this.data.sort(t)}remove(t){let s=0;for(;s<this.data.length&&!this.data[s].equals(t);s++);if(s>=this.data.length)throw new Error("t");for(;s<this.data.length-1;s++)this.data[s]=this.data[s+1];this.pop()}[Symbol.iterator](){let t=0;return{next:()=>t<this.sz?{done:!1,value:this.data[t++]}:{done:!0,value:void 0}}}}class m{constructor(t,s){i(this,"data",null);i(this,"sz",0);t!==void 0&&s!==void 0?this.growTo(t,s):t!==void 0&&this.growTo(t)}size(){return this.sz}shrink(t){this.shrink_(t)}shrink_(t){if(t>this.sz)throw new Error("nelems");this.sz-=t}get capacity(){return this.data===null?0:this.data.length}push(t){this.sz===this.capacity&&(this.capacity=this.sz+1),this.data[this.sz++]=t===void 0?0:t}pop(){if(this.sz<=0)throw new Error("Index out of bounds");this.sz--}last(){return this.data[this.sz-1]}get(t){if(t>=this.sz)throw new Error("index");return this.data[t]}set(t,s){if(t>=this.sz)throw new Error("index");return this.data[t]=s}copyTo(t){t.clear(),t.growTo(this.sz),!(this.sz<=0)&&this.data.slice(0,this.sz).forEach((s,e)=>t.data[e]=s)}moveTo(t){t.clear(!0),t.data=this.data,t.sz=this.sz,this.data=null,this.sz=0}static imax(t,s){const e=s-t>>31;return(t&e)+(s&~e)}set capacity(t){const s=this.capacity;if(s>=t)return;const e=m.imax(t-s+1&-2,(s>>1)+2&-2),a=new Array(s+e).fill(0);this.data!==null&&this.data.slice(0,this.sz).forEach((r,h)=>a[h]=r),this.data=a}growTo(t,s=0){if(!(this.sz>=t)){this.capacity=t;for(let e=this.sz;e<t;e++)this.data[e]=s;this.sz=t}}clear(t=!1){this.data!==null&&(this.sz=0,t&&(this.data=null))}}class Y{constructor(){i(this,"occs",new U);i(this,"dirty",new m);i(this,"dirties",new z)}init(t){const s=t.value()+1;for(let e=this.occs.size();e<s;++e)this.occs.push(new U);this.dirty.growTo(s,0)}get(t){return this.occs.get(t.value())}set(t,s){return this.occs.set(t.value(),s)}lookup(t){return this.dirty.get(t.value())!==0&&this.clean(t),this.occs.get(t.value())}smudge(t){this.dirty.get(t.value())===0&&(this.dirty.set(t.value(),1),this.dirties.push(t))}clear(){this.occs.clear(),this.dirty.clear(),this.dirties.clear()}cleanAll(){for(let t=0;t<this.dirties.size();t++)this.dirty.get(this.dirties.get(t).value())!==0&&this.clean(this.dirties.get(t));this.dirties.clear()}deleted(t){return t.cref.mark()===1}clean(t){const s=this.occs.get(t.value());let e=0,a=0;for(e=0;e<s.size();e++)this.deleted(s.get(e))||s.set(a++,s.get(e));s.shrink(e-a),this.dirty.set(t.value(),0)}toString(){return`OccLists(occs=${this.occs}, dirty=${this.dirty}, dirties=${this.dirties})`}}class k{constructor(t,s){i(this,"data",null);i(this,"sz",0);t!==void 0&&s!==void 0?this.growTo(t,s):t!==void 0&&this.growTo(t)}size(){return this.sz}shrink(t){this.shrink_(t)}shrink_(t){if(t>this.sz)throw new Error("nelems");this.sz-=t}get capacity(){return this.data===null?0:this.data.length}push(t){this.sz===this.capacity&&(this.capacity=this.sz+1),this.data[this.sz++]=t===void 0?!1:t}pop(){if(this.sz<=0)throw new Error("Index out of bounds");this.sz--}last(){return this.data[this.sz-1]}get(t){if(t>=this.sz)throw new Error("index");return this.data[t]}set(t,s){if(t>=this.sz)throw new Error("index");return this.data[t]=s}copyTo(t){t.clear(),t.growTo(this.sz),!(this.sz<=0)&&this.data.slice(0,this.sz).forEach((s,e)=>t.data[e]=s)}moveTo(t){t.clear(!0),t.data=this.data,t.sz=this.sz,this.data=null,this.sz=0}static imax(t,s){const e=s-t>>31;return(t&e)+(s&~e)}set capacity(t){const s=this.capacity;if(s>=t)return;const e=k.imax(t-s+1&-2,(s>>1)+2&-2),a=new Array(s+e).fill(!1);this.data!==null&&this.data.slice(0,this.sz).forEach((r,h)=>a[h]=r),this.data=a}growTo(t,s){if(!(this.sz>=t)){this.capacity=t;for(let e=this.sz;e<t;e++)this.data[e]=s===void 0?!1:s;this.sz=t}}clear(t=!1){this.data!==null&&(this.sz=0,t&&(this.data=null))}}class A{constructor(t){i(this,"lt");i(this,"heap",new m);i(this,"indices",new m);this.lt=t}static left(t){return t*2+1}static right(t){return(t+1)*2}static parent(t){return t-1>>1}percolateUp(t){const s=this.heap.get(t);let e=A.parent(t);for(;t!==0&&this.lt.call(s,this.heap.get(e));)this.heap.set(t,this.heap.get(e)),this.indices.set(this.heap.get(e),t),t=e,e=A.parent(e);this.heap.set(t,s),this.indices.set(s,t)}percolateDown(t){const s=this.heap.get(t);for(;A.left(t)<this.heap.size();){const e=A.left(t),a=A.right(t),r=a<this.heap.size()&&this.lt.call(this.heap.get(a),this.heap.get(e))?a:e;if(!this.lt.call(this.heap.get(r),s))break;this.heap.set(t,this.heap.get(r)),this.indices.set(this.heap.get(t),t),t=r}this.heap.set(t,s),this.indices.set(s,t)}size(){return this.heap.size()}empty(){return this.heap.size()===0}inHeap(t){return t<this.indices.size()&&this.indices.get(t)>=0}get(t){if(t>=this.heap.size())throw new Error("IndexOutOfBoundsException: index");return this.heap.get(t)}decrease(t){if(!this.inHeap(t))throw new Error("IllegalArgumentException: n");this.percolateUp(this.indices.get(t))}increase(t){if(!this.inHeap(t))throw new Error("IllegalArgumentException: n");this.percolateDown(this.indices.get(t))}update(t){this.inHeap(t)?(this.percolateUp(this.indices.get(t)),this.percolateDown(this.indices.get(t))):this.insert(t)}insert(t){if(this.indices.growTo(t+1,-1),this.inHeap(t))throw new Error("IllegalArgumentException: n");this.indices.set(t,this.heap.size()),this.heap.push(t),this.percolateUp(this.indices.get(t))}removeMin(){const t=this.heap.get(0);return this.heap.set(0,this.heap.last()),this.indices.set(this.heap.get(0),0),this.indices.set(t,-1),this.heap.pop(),this.heap.size()>1&&this.percolateDown(0),t}build(t){for(let s=0;s<this.heap.size();s++)this.indices.set(this.heap.get(s),-1);this.heap.clear();for(let s=0;s<t.size();s++)this.indices.set(t.get(s),s),this.heap.push(t.get(s));for(let s=this.heap.size()/2-1;s>=0;s--)this.percolateDown(s)}clear(){for(let t=0;t<this.heap.size();t++)this.indices.set(this.heap.get(t),-1);this.heap.clear()}}class Q{constructor(t){i(this,"activity");this.activity=t}call(t,s){return this.activity.get(t)>this.activity.get(s)}}const E=class E{constructor(t){i(this,"_value");this._value=t}equals(t){return this===t}value(){return this._value}static valueOf(t){if(t===E.UNDEF_VALUE)return E.UNDEF;for(;E.cache.length<=t;)E.cache.push(new E(E.cache.length));return E.cache[t]}toString(){return`Var${this._value}`}};i(E,"UNDEF_VALUE",-1),i(E,"UNDEF",new E(E.UNDEF_VALUE)),i(E,"cache",[]);let f=E;const c=class c{constructor(){i(this,"model",new V);i(this,"conflict",new z);i(this,"verbosity");i(this,"var_decay");i(this,"clause_decay");i(this,"random_var_freq");i(this,"random_seed");i(this,"luby_restart");i(this,"ccmin_mode");i(this,"phase_saving");i(this,"rnd_pol");i(this,"rnd_init_act");i(this,"garbage_frac");i(this,"restart_first");i(this,"restart_inc");i(this,"learntsize_factor");i(this,"learntsize_inc");i(this,"learntsize_adjust_start_confl");i(this,"learntsize_adjust_inc");i(this,"solves");i(this,"starts");i(this,"decisions");i(this,"rnd_decisions");i(this,"propagations");i(this,"conflicts");i(this,"dec_vars");i(this,"clauses_literals");i(this,"learnts_literals");i(this,"max_literals");i(this,"tot_literals");i(this,"_ok");i(this,"_clauses",new U);i(this,"_learnts",new U);i(this,"_cla_inc");i(this,"_activity",new m);i(this,"_var_inc");i(this,"_watches");i(this,"_assigns",new V);i(this,"_polarity",new k);i(this,"_decision",new k);i(this,"_trail",new z);i(this,"_trail_lim",new m);i(this,"_vardata",new U);i(this,"_qhead");i(this,"_simpDB_assigns");i(this,"_simpDB_props");i(this,"_assumptions",new z);i(this,"_order_heap");i(this,"_progress_estimate");i(this,"_remove_satisfied");i(this,"_seen",new k);i(this,"_analyze_stack",new z);i(this,"_analyze_toclear",new z);i(this,"_add_tmp",new z);i(this,"_max_learnts");i(this,"_learntsize_adjust_confl");i(this,"_learntsize_adjust_cnt");i(this,"_conflict_budget");i(this,"_propagation_budget");i(this,"_asynch_interrupt");this.verbosity=c.VERBOSITY_DEFAULT,this.var_decay=c.VAR_DECAY_DEFAULT,this.clause_decay=c.CLAUSE_DECAY_DEFAULT,this.random_var_freq=c.RANDOM_VAR_FREQ_DEFAULT,this.random_seed=c.RANDOM_SEED_DEFAULT,this.luby_restart=c.LUBY_RESTART_DEFAULT,this.ccmin_mode=c.CCMIN_MODE_DEFAULT,this.phase_saving=c.PHASE_SAVING_DEFAULT,this.rnd_pol=!1,this.rnd_init_act=c.RND_INIT_ACT_DEFAULT,this.garbage_frac=c.GARBAGE_FRAC_DEFAULT,this.restart_first=c.RESTART_FIRST_DEFAULT,this.restart_inc=c.RESTART_INC_DEFAULT,this.learntsize_factor=1/3,this.learntsize_inc=1.1,this.learntsize_adjust_start_confl=100,this.learntsize_adjust_inc=1.5,this._ok=!0,this._cla_inc=1,this._var_inc=1,this._watches=new Y,this._qhead=0,this._simpDB_assigns=-1,this._simpDB_props=0,this._order_heap=new A(new Q(this._activity)),this._progress_estimate=0,this._remove_satisfied=!0,this._conflict_budget=-1,this._propagation_budget=-1,this._asynch_interrupt=!1}static printf(t,...s){console.log(t,...s)}clauses(){return this._clauses}drand(){this.random_seed*=1389796;const t=Math.floor(this.random_seed/2147483647);return this.random_seed-=t*2147483647,this.random_seed/2147483647}irand(t){return Math.floor(this.drand()*t)}reason(t){return this._vardata.get(t.value()).reason}level(t){return this._vardata.get(t).level}insertVarOrder(t){!this._order_heap.inHeap(t.value())&&this._decision.get(t.value())&&this._order_heap.insert(t.value())}varDecayActivity(){this._var_inc*=1/this.var_decay}varBumpActivity(t,s){if(s===void 0)this.varBumpActivity(t,this._var_inc);else{const e=t.value();if(this._activity.set(e,this._activity.get(e)+s)>1e100){for(let a=0;a<this.nVars();a++)this._activity.set(a,this._activity.get(a)*1e-100);this._var_inc*=1e-100}this._order_heap.inHeap(e)&&this._order_heap.decrease(e)}}claDecayActivity(){this._cla_inc*=1/this.clause_decay}claBumpActivity(t){if(t.activity=t.activity+this._cla_inc,t.activity>1e20){for(let s=0;s<this._learnts.size();s++){const e=this._learnts.get(s);e.activity=e.activity*1e-20}this._cla_inc*=1e-20}}checkGarbage(){}enqueue(t,s){return this.valueLit(t)!==l.UNDEF?this.valueLit(t)!==l.FALSE:(this.uncheckedEnqueue(t,s),!0)}addClause(t){return this.addClause_(t)}locked(t){const s=this.reason(f.valueOf(t.get(0).var()));return this.valueLit(t.get(0))===l.TRUE&&s!==v.CRef_Undef&&s.equals(t)}newDecisionLevel(){this._trail_lim.push(this._trail.size())}decisionLevel(){return this._trail_lim.size()}abstractLevel(t){return 1<<(this.level(t)&31)}valueVar(t){return this._assigns.get(t.value())}valueLit(t){return l.xor(this._assigns.get(t.var()),t.sign())}modelValueVar(t){return this.model.get(t.value())}modelValueLit(t){return l.xor(this.model.get(t.var()),t.sign())}nAssigns(){return this._trail.size()}nClauses(){return this._clauses.size()}nLearnts(){return this._learnts.size()}nVars(){return this._vardata.size()}nFreeVars(){return this.dec_vars-(this._trail_lim.size()===0?this._trail.size():this._trail_lim.get(0))}setPolarity(t,s){this._polarity.set(t.value(),s)}setDecisionVar(t,s){const e=t.value();s&&!this._decision.get(e)?this.dec_vars++:!s&&this._decision.get(e)&&this.dec_vars--,this._decision.set(e,s),this.insertVarOrder(t)}setConfBudget(t){this._conflict_budget=this.conflicts+t}setPropBudget(t){this._propagation_budget=this.propagations+t}interrupt(){this._asynch_interrupt=!0}clearInterrupt(){this._asynch_interrupt=!1}budgetOff(){this._conflict_budget=this._propagation_budget=-1}withinBudget(){return!this._asynch_interrupt&&(this._conflict_budget<0||this.conflicts<this._conflict_budget)&&(this._propagation_budget<0||this.propagations<this._propagation_budget)}solve(){return this.budgetOff(),this._assumptions.clear(),this.solve_()===l.TRUE}solve1(t){return this.budgetOff(),this._assumptions.clear(),this._assumptions.push(t),this.solve_()===l.TRUE}solve2(t,s){return this.budgetOff(),this._assumptions.clear(),this._assumptions.push(t),this._assumptions.push(s),this.solve_()===l.TRUE}solve3(t,s,e){return this.budgetOff(),this._assumptions.clear(),this._assumptions.push(t),this._assumptions.push(s),this._assumptions.push(e),this.solve_()===l.TRUE}solveWithAssumptions(t){return this.budgetOff(),t.copyTo(this._assumptions),this.solve_()===l.TRUE}solveLimited(t){return t.copyTo(this._assumptions),this.solve_()}okay(){return this._ok}newVar(t,s){if(t===void 0)return this.newVar(!0,!0);if(s===void 0)return this.newVar(t,!0);{const e=this.nVars(),a=f.valueOf(e);return this._watches.init(g.valueOfVar(e,!1)),this._watches.init(g.valueOfVar(e,!0)),this._assigns.push(l.UNDEF),this._vardata.push(F.mkVarData(v.CRef_Undef,0)),this._activity.push(this.rnd_init_act?this.drand()*1e-5:0),this._seen.push(!1),this._polarity.push(t),this._decision.push(!1),this._trail.capacity=e+1,this.setDecisionVar(a,s),a}}addEmptyClause(){return this._add_tmp.clear(),this.addClause_(this._add_tmp)}addClause1(t){return this._add_tmp.clear(),this._add_tmp.push(t),this.addClause_(this._add_tmp)}addClause2(t,s){return this._add_tmp.clear(),this._add_tmp.push(t),this._add_tmp.push(s),this.addClause_(this._add_tmp)}addClause3(t,s,e){return this._add_tmp.clear(),this._add_tmp.push(t),this._add_tmp.push(s),this._add_tmp.push(e),this.addClause_(this._add_tmp)}addClauseFromArray(t){this._add_tmp.clear();for(const s of t){if(s===0)throw new Error("all vars must not be zero");this._add_tmp.push(g.valueOfVar(Math.abs(s)-1,s<0))}return this.addClause_(this._add_tmp)}addClause_(t){if(this.decisionLevel()!==0)throw new Error(`decisionLevel() = ${this.decisionLevel()}`);if(!this._ok)return!1;t.sort();let s,e,a;for(e=a=0,s=g.UNDEF;e<t.size();e++){const r=t.get(e).var();for(;r>=this.nVars();)this.newVar();if(this.valueLit(t.get(e))===l.TRUE||t.get(e).equals(s.not()))return!0;this.valueLit(t.get(e))!==l.FALSE&&!t.get(e).equals(s)&&t.set(a++,s=t.get(e))}if(t.shrink(e-a),t.size()===0)return this._ok=!1;if(t.size()===1)return this.uncheckedEnqueueSimple(t.get(0)),this._ok=this.propagate()===v.CRef_Undef;{const r=new v(t,!1,!1);this._clauses.push(r),this.attachClause(r)}return!0}attachClause(t){if(t.size()<=1)throw new Error("cr");this._watches.get(t.get(0).not()).push(new y(t,t.get(1))),this._watches.get(t.get(1).not()).push(new y(t,t.get(0))),t.learnt()?this.learnts_literals+=t.size():this.clauses_literals+=t.size()}detachClause(t,s){if(t.size()<=1)throw new Error("cr");s?(this._watches.get(t.get(0).not()).remove(new y(t,t.get(1))),this._watches.get(t.get(1).not()).remove(new y(t,t.get(0)))):(this._watches.smudge(t.get(0).not()),this._watches.smudge(t.get(1).not())),t.learnt()?this.learnts_literals-=t.size():this.clauses_literals-=t.size()}detachClauseSimple(t){this.detachClause(t,!1)}removeClause(t){this.detachClauseSimple(t),this.locked(t)&&(this._vardata.get(t.get(0).var()).reason=v.CRef_Undef),t.mark(1)}satisfied(t){for(let s=0;s<t.size();s++)if(this.valueLit(t.get(s))===l.TRUE)return!0;return!1}cancelUntil(t){if(this.decisionLevel()>t){for(let s=this._trail.size()-1;s>=this._trail_lim.get(t);s--){const e=this._trail.get(s).var();this._assigns.set(e,l.UNDEF),(this.phase_saving>1||this.phase_saving===1&&s>this._trail_lim.last())&&this._polarity.set(e,this._trail.get(s).sign()),this.insertVarOrder(f.valueOf(e))}this._qhead=this._trail_lim.get(t),this._trail.shrink(this._trail.size()-this._trail_lim.get(t)),this._trail_lim.shrink(this._trail_lim.size()-t)}}pickBranchLit(){let t=f.UNDEF;for(this.drand()<this.random_var_freq&&!this._order_heap.empty()&&(t=f.valueOf(this._order_heap.get(this.irand(this._order_heap.size()))),this.valueVar(t)===l.UNDEF&&this._decision.get(t.value())&&this.rnd_decisions++);t.equals(f.UNDEF)||this.valueVar(t)!==l.UNDEF||!this._decision.get(t.value());)if(this._order_heap.empty()){t=f.UNDEF;break}else t=f.valueOf(this._order_heap.removeMin());return t.equals(f.UNDEF)?g.UNDEF:g.valueOfVar(t.value(),this.rnd_pol?this.drand()<.5:this._polarity.get(t.value()))}analyze(t,s,e){let a=0,r=g.UNDEF;s.push(g.UNDEF);let h=this._trail.size()-1;do{const n=t;n.learnt()&&this.claBumpActivity(n);for(let u=r.equals(g.UNDEF)?0:1;u<n.size();u++){const _=n.get(u);!this._seen.get(_.var())&&this.level(_.var())>0&&(this.varBumpActivity(f.valueOf(_.var())),this._seen.set(_.var(),!0),this.level(_.var())>=this.decisionLevel()?a++:s.push(_))}for(;!this._seen.get(this._trail.get(h--).var()););r=this._trail.get(h+1),t=this.reason(f.valueOf(r.var())),this._seen.set(r.var(),!1),a--}while(a>0);s.set(0,r.not());let o,w;if(s.copyTo(this._analyze_toclear),this.ccmin_mode===2){let n=0;for(o=1;o<s.size();o++)n|=this.abstractLevel(s.get(o).var());for(o=w=1;o<s.size();o++)(this.reason(f.valueOf(s.get(o).var()))===v.CRef_Undef||!this.litRedundant(s.get(o),n))&&s.set(w++,s.get(o))}else if(this.ccmin_mode===1)for(o=w=1;o<s.size();o++){const n=f.valueOf(s.get(o).var());if(this.reason(n)===v.CRef_Undef)s.set(w++,s.get(o));else{const u=this.reason(f.valueOf(s.get(o).var()));for(let _=1;_<u.size();_++)if(!this._seen.get(u.get(_).var())&&this.level(u.get(_).var())>0){s.set(w++,s.get(o));break}}}else o=w=s.size();if(this.max_literals+=s.size(),s.shrink(o-w),this.tot_literals+=s.size(),s.size()===1)e=0;else{let n=1;for(let _=2;_<s.size();_++)this.level(s.get(_).var())>this.level(s.get(n).var())&&(n=_);const u=s.get(n);s.set(n,s.get(1)),s.set(1,u),e=this.level(u.var())}for(let n=0;n<this._analyze_toclear.size();n++)this._seen.set(this._analyze_toclear.get(n).var(),!1);return e}litRedundant(t,s){this._analyze_stack.clear(),this._analyze_stack.push(t);const e=this._analyze_toclear.size();for(;this._analyze_stack.size()>0;){const a=this.reason(f.valueOf(this._analyze_stack.last().var()));this._analyze_stack.pop();for(let r=1;r<a.size();r++){const h=a.get(r);if(!this._seen.get(h.var())&&this.level(h.var())>0)if(this.reason(f.valueOf(h.var()))!==v.CRef_Undef&&this.abstractLevel(h.var())&s)this._seen.set(h.var(),!0),this._analyze_stack.push(h),this._analyze_toclear.push(h);else{for(let o=e;o<this._analyze_toclear.size();o++)this._seen.set(this._analyze_toclear.get(o).var(),!1);return this._analyze_toclear.shrink(this._analyze_toclear.size()-e),!1}}}return!0}analyzeFinal(t,s){if(s.clear(),s.push(t),this.decisionLevel()!==0){this._seen.set(t.var(),!0);for(let e=this._trail.size()-1;e>=this._trail_lim.get(0);e--){const a=f.valueOf(this._trail.get(e).var());if(this._seen.get(a.value())){if(this.reason(a)===v.CRef_Undef)this.level(a.value())>0&&s.push(this._trail.get(e).not());else{const r=this.reason(a);for(let h=1;h<r.size();h++)this.level(r.get(h).var())>0&&this._seen.set(r.get(h).var(),!0)}this._seen.set(a.value(),!1)}}this._seen.set(t.var(),!1)}}uncheckedEnqueue(t,s){if(this.valueLit(t)!==l.UNDEF)throw new Error("p");this._assigns.set(t.var(),l.valueOf(t.sign()?0:1)),this._vardata.set(t.var(),F.mkVarData(s,this.decisionLevel())),this._trail.push_(t)}uncheckedEnqueueSimple(t){this.uncheckedEnqueue(t,v.CRef_Undef)}propagate(){let t=v.CRef_Undef,s=0;for(this._watches.cleanAll();this._qhead<this._trail.size();){const e=this._trail.get(this._qhead++),a=this._watches.get(e);s++;let r=0,h=0,o=a.size();for(;r<o;){const w=a.get(r).blocker;if(this.valueLit(w)===l.TRUE){a.set(h++,a.get(r++));continue}const n=a.get(r).cref,u=e.not();n.get(0).equals(u)&&(n.set(0,n.get(1)),n.set(1,u)),r++;const _=n.get(0),D=new y(n,_);if(!_.equals(w)&&this.valueLit(_)===l.TRUE){a.set(h++,D);continue}for(let T=2;T<n.size();T++){const N=n.get(T);if(this.valueLit(N)!==l.FALSE){n.set(1,N),n.set(T,u),this._watches.get(n.get(1).not()).push(D);break}}if(a.set(h++,D),this.valueLit(_)===l.FALSE)for(t=n,this._qhead=this._trail.size();r<o;)a.set(h++,a.get(r++));else this.uncheckedEnqueue(_,n)}a.shrink(r-h)}return this.propagations+=s,this._simpDB_props-=s,t}reduceDB(){let t,s;const e=this._cla_inc/this._learnts.size();for(this._learnts.sort((a,r)=>a.size()>2&&(r.size()===2||a.activity<r.activity)?-1:r.size()>2&&(a.size()===2||r.activity<a.activity)?1:0),t=s=0;t<this._learnts.size();t++){const a=this._learnts.get(t);a.size()>2&&!this.locked(a)&&(t<this._learnts.size()/2||a.activity<e)?this.removeClause(this._learnts.get(t)):this._learnts.set(s++,this._learnts.get(t))}this._learnts.shrink(t-s),this.checkGarbage()}removeSatisfied(t){let s,e;for(s=e=0;s<t.size();s++){const a=t.get(s);this.satisfied(a)?this.removeClause(t.get(s)):t.set(e++,t.get(s))}t.shrink(s-e)}rebuildOrderHeap(){const t=new m;for(let s=0;s<this.nVars();s++)this._decision.get(s)&&this.valueVar(f.valueOf(s))===l.UNDEF&&t.push(s);this._order_heap.build(t)}simplify(){if(this.decisionLevel()!==0)throw new Error("decisionLevel() != 0");return!this._ok||this.propagate()!==v.CRef_Undef?this._ok=!1:(this.nAssigns()===this._simpDB_assigns||this._simpDB_props>0||(this.removeSatisfied(this._learnts),this._remove_satisfied&&this.removeSatisfied(this._clauses),this.checkGarbage(),this.rebuildOrderHeap(),this._simpDB_assigns=this.nAssigns(),this._simpDB_props=this.clauses_literals+this.learnts_literals),!0)}search(t){if(!this._ok)throw new Error("!ok");let s=0,e=0;const a=new z;for(this.starts++;;){const r=this.propagate();if(r!==v.CRef_Undef){if(this.conflicts++,e++,this.decisionLevel()===0)return l.FALSE;if(a.clear(),s=this.analyze(r,a,s),this.cancelUntil(s),a.size()===1)this.uncheckedEnqueueSimple(a.get(0));else{const h=new v(a,!0,!0);this._learnts.push(h),this.attachClause(h),this.claBumpActivity(h),this.uncheckedEnqueue(a.get(0),h)}this.varDecayActivity(),this.claDecayActivity(),--this._learntsize_adjust_cnt===0&&(this._learntsize_adjust_confl*=this.learntsize_adjust_inc,this._learntsize_adjust_cnt=this._learntsize_adjust_confl,this._max_learnts*=this.learntsize_inc,this.verbosity>=1&&c.printf("| %9d | %7d %8d %8d | %8d %8d %6.0f | %6.3f %% |",this.conflicts,this.dec_vars-(this._trail_lim.size()===0?this._trail.size():this._trail_lim.get(0)),this.nClauses(),this.clauses_literals,this._max_learnts,this.nLearnts(),this.learnts_literals/this.nLearnts(),this.progressEstimate()*100))}else{if(t>=0&&e>=t||!this.withinBudget())return this._progress_estimate=this.progressEstimate(),this.cancelUntil(0),l.UNDEF;if(this.decisionLevel()===0&&!this.simplify())return l.FALSE;this._learnts.size()-this.nAssigns()>=this._max_learnts&&this.reduceDB();let h=g.UNDEF;for(;this.decisionLevel()<this._assumptions.size();){const o=this._assumptions.get(this.decisionLevel());if(this.valueLit(o)===l.TRUE)this.newDecisionLevel();else{if(this.valueLit(o)===l.FALSE)return this.analyzeFinal(o.not(),this.conflict),l.FALSE;h=o;break}}if(h.equals(g.UNDEF)&&(this.decisions++,h=this.pickBranchLit(),h.equals(g.UNDEF)))return l.TRUE;this.newDecisionLevel(),this.uncheckedEnqueueSimple(h)}}}progressEstimate(){let t=0;const s=1/this.nVars();for(let e=0;e<=this.decisionLevel();e++){const a=e===0?0:this._trail_lim.get(e-1),r=e===this.decisionLevel()?this._trail.size():this._trail_lim.get(e);t+=Math.pow(s,e)*(r-a)}return t/this.nVars()}static luby(t,s){let e,a;for(e=1,a=0;e<s+1;a++,e=2*e+1);for(;e-1!==s;)e=e-1>>1,a--,s=s%e;return Math.pow(t,a)}solve_(){if(this.model.clear(),this.conflict.clear(),!this._ok)return l.FALSE;this.solves++,this._max_learnts=this.nClauses()*this.learntsize_factor,this._learntsize_adjust_confl=this.learntsize_adjust_start_confl,this._learntsize_adjust_cnt=this._learntsize_adjust_confl;let t=l.UNDEF;this.verbosity>=1&&(c.printf("============================[ Search Statistics ]=============================="),c.printf("| Conflicts |          ORIGINAL         |          LEARNT          | Progress |"),c.printf("|           |    Vars  Clauses Literals |    Limit  Clauses Lit/Cl |          |"),c.printf("==============================================================================="));let s=0;for(;t===l.UNDEF;){const e=this.luby_restart?c.luby(this.restart_inc,s):Math.pow(this.restart_inc,s);if(t=this.search(e*this.restart_first),!this.withinBudget())break;s++}if(this.verbosity>=1&&c.printf("==============================================================================="),t===l.TRUE){this.model.growTo(this.nVars());for(let e=0;e<this.nVars();e++)this.model.set(e,this.valueVar(f.valueOf(e)))}else t===l.FALSE&&this.conflict.size()===0&&(this._ok=!1);return this.cancelUntil(0),t}static mapVar(t,s,e){return(s.size()<=t||s.get(t)===f.UNDEF)&&(s.growTo(t+1,f.UNDEF),s.set(t,f.valueOf(e[0]++))),s.get(t)}realocAll(t){}garbageCollect(){}static parse_DIMACS_main(t,s){const e=t.split(`
`);let a=0,r=0,h=0;const o=new z;for(const w of e){const n=w.trim().split(/\s+/);if(n.length===0)continue;let u=n.shift();if(u!==void 0&&u!=="c")if(u==="p"){if(u=n.shift(),u!=="cnf")throw new Error("PARSE ERROR! 'cnf' expected after 'p'");a=parseInt(n.shift(),10),r=parseInt(n.shift(),10)}else{for(++h,o.clear();;){const _=parseInt(u,10);if(_===0)break;const D=Math.abs(_)-1;for(;D>=s.nVars();)s.newVar();if(o.push(g.valueOfVar(D,_<0)),u=n.shift(),u===void 0)break}s.addClause_(o)}}if(a!==s.nVars())throw new Error("WARNING! DIMACS header mismatch: wrong number of variables.");if(h!==r)throw new Error("WARNING! DIMACS header mismatch: wrong number of clauses.")}};i(c,"VERBOSITY_DEFAULT",0),i(c,"VAR_DECAY_DEFAULT",.95),i(c,"CLAUSE_DECAY_DEFAULT",.999),i(c,"RANDOM_VAR_FREQ_DEFAULT",0),i(c,"RANDOM_SEED_DEFAULT",91648253),i(c,"CCMIN_MODE_DEFAULT",2),i(c,"PHASE_SAVING_DEFAULT",2),i(c,"RND_INIT_ACT_DEFAULT",!1),i(c,"LUBY_RESTART_DEFAULT",!0),i(c,"RESTART_FIRST_DEFAULT",100),i(c,"RESTART_INC_DEFAULT",2),i(c,"GARBAGE_FRAC_DEFAULT",.2);let C=c;window.assertions.enableAssert();const R=new x,X=new x({renderer:"svg",children:[R]}),b=new B(X,{allowWebGL:!0,allowBackingScaleAntialiasing:!0,allowSceneOverflow:!1});document.body.appendChild(b.domElement);b.setWidthHeight(window.innerWidth,window.innerHeight);console.log("test");(async()=>{const d=new I({x:10,y:10,align:"left"});R.addChild(d);const t=h=>{d.addChild(new j(h,{margin:5}))},s=M[0][0];t(new H({patternBoard:s,planarPatternMap:G.get(s)},{labels:!0}));{const h=P[0][0];console.log($.getSolutions(h,[])),console.log(W(h))}const e=new C;[[1,2,3],[-1,-2],[-1,-3],[-2,-3],[4,5,6],[-4,-5],[-4,-6],[-5,-6],[7,8,9],[-7,-8],[-7,-9],[-8,-9],[10,11,12],[-10,-11],[-10,-12],[-11,-12],[-1,-7],[-2,-8],[-3,-9],[-4,-10],[-5,-11],[-6,-12],[-4,-7],[-5,-8],[-6,-9],[-7,-10],[-8,-11],[-9,-12],[-1,-4],[-2,-5],[-3,-6]].forEach(h=>e.addClauseFromArray(h));const r=e.solve();console.log("isSat",r),console.log(e.model.data);debugger;R.bounds.isValid()&&(b.setWidthHeight(Math.ceil(R.right+10),Math.ceil(R.bottom+10)),b.updateDisplay())})();
