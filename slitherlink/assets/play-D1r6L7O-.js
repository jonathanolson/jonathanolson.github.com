var To=Object.defineProperty;var Mo=(l,n,e)=>n in l?To(l,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[n]=e;var L=(l,n,e)=>Mo(l,typeof n!="symbol"?n+"":n,e);import{c as K,o as se,D as Ot,T as Ee,M as rt,E as Ro,a as Ho,b as He,P as Dt,V as le,d as ke,e as pt,S as Vo,f as W,B as st}from"./Vector2Property-CFyCN_2h.js";import{s as Do}from"./scanURL-BwyBdSd2.js";import{S as T,P as Y,N as I,R as G,A as ot,T as X,s as Zt,H as M,a as Le,b as co,V as q,G as Kt,B as qt,c as Qt,M as it,d as Bt,I as jt,e as $t,f as qo,L as At,g as Uo,h as Ie,i as Wo,j as Go,k as Xo,l as Yo,m as Jo,n as Zo,D as Ko,o as Qo,p as at}from"./PhetioControlledVisibilityProperty-thEXBwUY.js";import{L as uo,P as De,C as jo,T as nt,O as $o,R as _o,V as en,M as tn,a as on,b as nn,c as he,B as Be,d as rn}from"./localStorage-BTLIWA27.js";import{B as sn,a as an,b as ln,c as cn,d as k,e as N,_ as ve,P as dn,g as Ae,f as un,h as zt,i as pn,j as ht,k as hn}from"./patternBoards-DzVBPT7g.js";import{S as lt}from"./SlitherQueryParameters-CLuuf2TR.js";import{f as po,U as V,p as ho,h as go,i as fo,j as wo,k as mo,l as yo,s as me,m as Co,v as Tt,n as Mt,o as So,V as gn,F as fn,q as wn,r as mn,t as Rt,u as yn,w as Cn,S as gt,x as vo,y as Po,z as Ht,A as Sn,B as vn,C as Ve,P as Ne,D as Pn,G as Q,H as Ut,I as xe,J as fe,K as bn,L as Pe,M as En,N as Fn,O as Ln,Q as Wt,R as kn}from"./DisplayEmbedding-0vgCuFSa.js";import{g as Vt,a as In,b as Nn,c as xn,d as On,e as Bn,f as An,h as zn,i as Tn,j as Mn,k as Rn,l as Hn,m as Vn,n as Dn,o as qn,p as Un,q as Wn,r as Gn,s as Xn,t as Yn,u as Jn,v as Zn,w as Kn,x as Qn,y as jn,z as $n,A as ft,B as _n,C as er,I as pe,D as Ye,E as wt,F as mt,S as yt,G as Ct,H as St,J as vt,K as tr}from"./SATSolver-BXmuhJOp.js";import{B as Fe,E as ee,a as or,S as Je,F as nr,b as rr,A as sr,C as ar,s as Pt,c as bt,d as bo}from"./BasicPuzzle-Bt7fJ87M.js";import{p as Eo}from"./puzzleFromCompressedString-CvP5oBF8.js";import{g as ir,a as lr,i as cr,A as dr,w as ur}from"./AnnotationNode-7eyds_Jc.js";import{c as h,t as pr,u as _,r as be,a as ze,b as ce,d as _t,e as hr,p as gr,f as eo,g as fr,h as wr,s as Et,i as mr,j as yr,v as to,k as Cr,m as Sr,w as vr,n as oo,o as Pr,q as br,x as Er,y as Fr,z as Lr,A as kr,B as Ir,C as Nr,D as xr,E as Or,F as Br,G as Ar,H as zr,I as Tr,J as Mr,K as Ft,L as Rr,M as Hr,N as Vr,O as Lt,P as Dr}from"./Theme-CG_JTTcq.js";import{g as kt,a as no,b as qr,U as Ur}from"./generalEdgeSectorMixedGroup-DNrs6cTU.js";import{N as Ze,S as Wr,A as Gr}from"./SpinningIndicatorNode-CK4xca7k.js";import{p as Ke}from"./polygonGenerators-B6WeaZhu.js";import{B as Qe,R as It,b as je,c as $e,d as _e,S as et,e as Nt,a as xt}from"./PatternRule-B98-ERhf.js";import"./PatternBoardSolver-DIArGw3P.js";import"./BinaryMixedRuleGroup-C6v4agP5.js";import"./BinaryRuleCollection-CpgpJAWO.js";import"./GenericRichSolution-dcEeS49P.js";const Gt=new uo("showLayoutTestProperty",!1);class tt extends sn{constructor(n,e,t){super(n,e,t)}}class ro extends an{constructor(e,t){super(e,t);L(this,"originalEdges",new Set)}}class so extends ln{constructor(e,t){super(e.copy(),t.copy());L(this,"originalFace",null)}}class Xr extends cn{constructor(n,e){super(n.copy(),e.copy())}}class ao{constructor(n,e){this.faces=n,this.boundaryHalfEdges=e}}class Yr{constructor(n,e,t){this.faces=n,this.boundaryHalfEdges=e,this.boundarySegments=t}}const Jr=()=>{const l=lt.p||localStorage.getItem("puzzleString"),n=Fe.loadDefaultPuzzle();let e=null,t=0;try{let o=n;if(l){const r=Eo(l);if(r){o=r;const a=localStorage.getItem("timeElapsedProperty");t=a?JSON.parse(a):0}}e=Vt(o.board,o.stateProperty.value)}catch(o){console.error(o)}return e||(e=Vt(n.board,n.stateProperty.value)),k()&&N(e),new po(e,{initialTimeElapsed:t})},Zr=new T("M1024 640q0 106 -75 181t-181 75t-181 -75t-75 -181t75 -181t181 -75t181 75t75 181zM1536 749v-222q0 -12 -8 -23t-20 -13l-185 -28q-19 -54 -39 -91q35 -50 107 -138q10 -12 10 -25t-9 -23q-27 -37 -99 -108t-94 -71q-12 0 -26 9l-138 108q-44 -23 -91 -38q-16 -136 -29 -186q-7 -28 -36 -28h-222q-14 0 -24.5 8.5t-11.5 21.5l-28 184q-49 16 -90 37l-141 -107q-10 -9 -25 -9q-14 0 -25 11q-126 114 -165 168q-7 10 -7 23q0 12 8 23q15 21 51 66.5t54 70.5q-27 50 -41 99l-183 27q-13 2 -21 12.5t-8 23.5v222q0 12 8 23t19 13l186 28q14 46 39 92q-40 57 -107 138q-10 12 -10 24q0 10 9 23q26 36 98.5 107.5t94.5 71.5q13 0 26 -10l138 -107q44 23 91 38q16 136 29 186q7 28 36 28h222q14 0 24.5 -8.5t11.5 -21.5l28 -184q49 -16 90 -37l142 107q9 9 24 9q13 0 25 -10q129 -119 165 -170q7 -8 7 -22q0 -12 -8 -23q-15 -21 -51 -66.5t-54 -70.5q26 -50 41 -98l183 -28q13 -2 21 -12.5t8 -23.5z").makeImmutable(),Kr=new T("M979 1395q19 19 32 13t13 -32v-1472q0 -26 -13 -32t-32 13l-710 710q-9 9 -13 19v-678q0 -26 -19 -45t-45 -19h-128q-26 0 -45 19t-19 45v1408q0 26 19 45t45 19h128q26 0 45 -19t19 -45v-678q4 10 13 19z").makeImmutable(),Qr=new T("M45 -115q-19 -19 -32 -13t-13 32v1472q0 26 13 32t32 -13l710 -710q9 -9 13 -19v678q0 26 19 45t45 19h128q26 0 45 -19t19 -45v-1408q0 -26 -19 -45t-45 -19h-128q-26 0 -45 19t-19 45v678q-4 -10 -13 -19z").makeImmutable(),jr=new T("M1619 1395q19 19 32 13t13 -32v-1472q0 -26 -13 -32t-32 13l-710 710q-9 9 -13 19v-710q0 -26 -13 -32t-32 13l-710 710q-19 19 -19 45t19 45l710 710q19 19 32 13t13 -32v-710q4 10 13 19z").makeImmutable(),$r=new T("M45 -115q-19 -19 -32 -13t-13 32v1472q0 26 13 32t32 -13l710 -710q9 -9 13 -19v710q0 26 13 32t32 -13l710 -710q19 -19 19 -45t-19 -45l-710 -710q-19 -19 -32 -13t-13 32v710q-4 -10 -13 -19z").makeImmutable();new T("M503.691 189.836L327.687 37.851C312.281 24.546 288 35.347 288 56.015v80.053C127.371 137.907 0 170.1 0 322.326c0 61.441 39.581 122.309 83.333 154.132 13.653 9.931 33.111-2.533 28.077-18.631C66.066 312.814 132.917 274.316 288 272.085V360c0 20.7 24.3 31.453 39.687 18.164l176.004-152c11.071-9.562 11.086-26.753 0-36.328z").makeImmutable();const Fo=new T("M363 0l91 91l-235 235l-91 -91v-107h128v-128h107zM886 928q0 22 -22 22q-10 0 -17 -7l-542 -542q-7 -7 -7 -17q0 -22 22 -22q10 0 17 7l542 542q7 7 7 17zM832 1120l416 -416l-832 -832h-416v416zM1515 1024q0 -53 -37 -90l-166 -166l-416 416l166 165q36 38 90 38q53 0 91 -38l235 -234q37 -39 37 -91z").makeImmutable(),_r=new T("M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 448c-110.532 0-200-89.431-200-200 0-110.495 89.472-200 200-200 110.491 0 200 89.471 200 200 0 110.53-89.431 200-200 200zm107.244-255.2c0 67.052-72.421 68.084-72.421 92.863V300c0 6.627-5.373 12-12 12h-45.647c-6.627 0-12-5.373-12-12v-8.659c0-35.745 27.1-50.034 47.579-61.516 17.561-9.845 28.324-16.541 28.324-29.579 0-17.246-21.999-28.693-39.784-28.693-23.189 0-33.894 10.977-48.942 29.969-4.057 5.12-11.46 6.071-16.666 2.124l-27.824-21.098c-5.107-3.872-6.251-11.066-2.644-16.363C184.846 131.491 214.94 112 261.794 112c49.071 0 101.45 38.304 101.45 88.8zM298 368c0 23.159-18.841 42-42 42s-42-18.841-42-42 18.841-42 42-42 42 18.841 42 42z").makeImmutable(),es=new T("M352.201 425.775l-79.196 79.196c-9.373 9.373-24.568 9.373-33.941 0l-79.196-79.196c-15.119-15.119-4.411-40.971 16.971-40.97h51.162L228 284H127.196v51.162c0 21.382-25.851 32.09-40.971 16.971L7.029 272.937c-9.373-9.373-9.373-24.569 0-33.941L86.225 159.8c15.119-15.119 40.971-4.411 40.971 16.971V228H228V127.196h-51.23c-21.382 0-32.09-25.851-16.971-40.971l79.196-79.196c9.373-9.373 24.568-9.373 33.941 0l79.196 79.196c15.119 15.119 4.411 40.971-16.971 40.971h-51.162V228h100.804v-51.162c0-21.382 25.851-32.09 40.97-16.971l79.196 79.196c9.373 9.373 9.373 24.569 0 33.941L425.773 352.2c-15.119 15.119-40.971 4.411-40.97-16.971V284H284v100.804h51.23c21.382 0 32.09 25.851 16.971 40.971z").makeImmutable(),ge=(l,n)=>new Y(l,K({maxWidth:20,maxHeight:20,fill:"black"},n));class qe extends I{constructor(n,e,t){const o=se()({allowBarrierClickToHide:!0,panelOptions:{xMargin:15,yMargin:15,fill:h.uiBackgroundColorProperty,stroke:h.uiForegroundColorProperty}},t);super(),this.content=n,this.viewContext=e;const r=new G({fill:h.barrierColorProperty});this.addChild(r),e.layoutBoundsProperty.link(s=>{r.rectBounds=s}),o.allowBarrierClickToHide&&r.addInputListener({down:()=>{this.hide()}});const a=new De(n,o.panelOptions);e.layoutBoundsProperty.link(s=>{a.maxWidth=s.width*.9,a.maxHeight=s.height*.9}),this.addChild(new ot(a,{alignBoundsProperty:e.layoutBoundsProperty,yAlign:"top",topMargin:50}))}show(){this.viewContext.glassPane.hasChild(this)||(this.reset(),this.viewContext.glassPane.addChild(this))}hide(){this.viewContext.glassPane.hasChild(this)&&this.viewContext.glassPane.removeChild(this)}reset(){}}class Ue{constructor(n,e){L(this,"timerListener",null);L(this,"tooltipNode",null);this.viewContext=n,this.tooltipTextOverride=e}showTooltip(n,e,t){if(!this.tooltipNode){this.tooltipNode=new De(new X(n,{font:pr}),{cornerRadius:1,xMargin:2,yMargin:2});const o=this.viewContext.glassPane.globalToLocalPoint(t.point);this.tooltipNode.leftTop=o.plusXY(0,this.viewContext.glassPane.getUniqueTransform().transformDeltaY(20)),this.tooltipNode.bottom>this.viewContext.layoutBoundsProperty.value.bottom&&(this.tooltipNode.bottom=o.y-2),this.tooltipNode.left<this.viewContext.layoutBoundsProperty.value.left&&(this.tooltipNode.left=this.viewContext.layoutBoundsProperty.value.left+2),this.tooltipNode.right>this.viewContext.layoutBoundsProperty.value.right&&(this.tooltipNode.right=this.viewContext.layoutBoundsProperty.value.right-2),this.viewContext.glassPane.addChild(this.tooltipNode)}}hideTooltip(){this.tooltipNode&&(this.tooltipNode.dispose(),this.tooltipNode=null)}clearListener(){this.timerListener&&(Zt.clearTimeout(this.timerListener),this.timerListener=null)}enter(n){const e=n.currentTarget,t=n.pointer;if(e&&this.timerListener===null){const o=()=>{const r=this.tooltipTextOverride??(e==null?void 0:e.labelContent)??(e==null?void 0:e.accessibleName);if(r){this.showTooltip(r,e,t);let a=this.tooltipNode;const s=()=>{this.tooltipNode===a&&(this.hideTooltip(),o())};e.rendererSummaryRefreshEmitter.addListener(s),a.disposeEmitter.addListener(()=>{e.rendererSummaryRefreshEmitter.removeListener(s)})}};this.timerListener=Zt.setTimeout(()=>{o()},200)}}exit(n){this.clearListener(),this.hideTooltip()}dispose(){this.clearListener(),this.hideTooltip()}}class x extends jo{constructor(n,e,t){const o=se()({advanced:!1,accessibleName:n,checkboxColor:h.uiForegroundColorProperty,checkboxColorBackground:h.uiBackgroundColorProperty},t),r=new X(n,{font:_,fill:h.uiForegroundColorProperty});o.advanced&&(o.visibleProperty=j),o.boxWidth=r.height,super(e,r,o)}}class ue extends nt{constructor(n,e){const t=se()({advanced:!1,textFill:h.uiButtonForegroundProperty,baseColor:h.uiButtonBaseColorProperty,xMargin:5,yMargin:5,font:_,buttonAppearanceStrategy:be},e);t.advanced&&(t.visibleProperty=j),super(n,t)}}class ts extends M{constructor(n,e,t,o){const r=se()({advanced:!1,onOffSwitchOptions:{size:new Ot(40,20),trackFillLeft:h.uiButtonDisabledColorProperty,trackFillRight:h.uiButtonBaseColorProperty,accessibleName:e},spacing:10},o),a=new $o(n,r.onOffSwitchOptions);r.children=[t,a],r.advanced&&(r.visibleProperty=j),super(r)}}class J extends ts{constructor(n,e,t){const o=se()({textOptions:{}},t),r=new V(e,o.textOptions);super(n,e,r,o)}}class Lo extends _o{constructor(n,e,t){super(n,e,K({orientation:"horizontal",touchAreaYDilation:5,radioButtonOptions:{baseColor:h.uiButtonBaseColorProperty,disabledColor:h.uiButtonDisabledColorProperty,xMargin:8*1.3,yMargin:5*1.3,buttonAppearanceStrategyOptions:{selectedStroke:h.uiButtonSelectedStrokeColorProperty,deselectedStroke:h.uiButtonDeselectedStrokeColorProperty}}},t))}}class We extends Lo{constructor(n){const{basicLinesIcon:e,basicFaceColoringIcon:t,pureFaceColoringIcon:o,classicIcon:r,basicSectorsIcon:a,sectorsWithColorsIcon:s,vertexStateIcon:i,faceStateIcon:p,customIcon:c}=We.getIcons(),u=new Ue(n);super(ho,[{value:go,createNode:()=>r,labelContent:"Classic",options:{}},{value:fo,createNode:()=>e,labelContent:"Lines",options:{}},{value:wo,createNode:()=>t,labelContent:"Lines and Colors",options:{}},{value:mo,createNode:()=>o,labelContent:"Colors",options:{}},{value:yo,createNode:()=>a,labelContent:"Sectors",options:{visibleProperty:me}},{value:Co,createNode:()=>s,labelContent:"Sectors and Colors",options:{visibleProperty:me}},{value:Tt,createNode:()=>i,labelContent:"Vertex State",options:{visibleProperty:j}},{value:Mt,createNode:()=>p,labelContent:"Face State",options:{visibleProperty:j}},{value:So,createNode:()=>c,labelContent:"Custom",options:{visibleProperty:j}}]),this.children.forEach(v=>v.addInputListener(u)),n.layoutBoundsProperty.link(v=>{this.maxWidth=Math.max(1,v.width-2*ze)})}static getIcons(){const n=new G(0,0,15,15,{stroke:h.whiteLineColorProperty,fill:h.faceColorDefaultColorProperty}),e=new G(0,0,15,15,{stroke:h.whiteLineColorProperty,fill:new Le([h.faceColorBasicTargetColorProperty],P=>P.withAlpha(1))}),t=new Y(new T().moveTo(0,15).lineTo(0,0).lineTo(15,0).makeImmutable(),{stroke:new Le([h.simpleRegionTargetColorProperty],P=>P.withAlpha(1)),lineWidth:4,lineCap:"round",lineJoin:"round"}),o=new Y(new T().moveTo(0,15).lineTo(0,0).lineTo(15,0).makeImmutable(),{stroke:h.blackLineColorProperty,lineWidth:4,lineCap:"round",lineJoin:"round"}),r=new Y(new T().arc(0,0,9,0,Math.PI/2,!1),{stroke:h.sectorOnlyOneColorProperty}),a=new I({children:[n,t]}),s=new I({children:[e,o]}),i=new I({children:[new G(0,0,15,15,{fill:h.uiForegroundColorProperty})]}),p=3,c=new T().moveTo(-p,-p).lineTo(p,p).moveTo(-p,p).lineTo(p,-p),u=new I({children:[new G(0,0,15,15,{fill:h.puzzleBackgroundColorProperty}),new Y(new T().moveTo(0,15).lineTo(0,0).lineTo(15,0).makeImmutable(),{stroke:h.blackLineColorProperty,lineWidth:3,lineCap:"square",lineJoin:"miter"}),new Y(c,{stroke:h.xColorProperty,lineWidth:2,x:15,y:7.5})]}),v=new I({children:[n,r,t]}),E=new I({children:[e,r,o]}),b=Eo("eJytV11v2jAU/S9+9oOvv4PUh7VQqS+dNtZK08RDVlwUjQIiKWuF8t9nJw2JjWGJygtKfE7OuR/Oxdmjndnm2XqFRoDR73W6naPRHhXvG4NG6DrNzXW1hh2vyJ5Mjka/9ugNjQhG79Xvrr7ZubsSdzCoMYhh1MPAw5in6WO8xmhMU3iY/5ysMRZ7TnmY/5z24qQelnhx+hgQL5gABM8xAP3SMB/0axOAfnECUHierJxh9JxG+9k2mmDAFLPZhxJEKIA5Fpg2FBqhcCyxwqKhsAiFWRuNk4bCIxRqbWxVdcMREY6wPra4QBqSjJAS62SLDIe0VISknZctKBwy07HkSWVnA+Oz0hJRXqSF6bxAN+uXzdIUZpwWKaoL/pguX+v7lnbrrXcb464csW1Q61Lt1A5BhAQWEFRIoAFBHyu4rMx8YaZuIQh7Ytc/InYUF3FVhMwl/d0s7FgJnpiGkM+uFDD6a7LtfNJRdCHerJfrbaRu7TpGT+66Llxm5xiTIhESGNdaccnZB2Fa54a+PvyY3o0nnXpb7/Vms86zwhyk76yQ1QBOOFeESZ0w5cqWRdYDg7v7nvphoI0+EEEJIcIaJIoyCPQf7seTG+swRvF3uTzlt3pdLhsPRmXCtdAEEkpUfw8Y4KEp1ZpwpaWQjBHR14MOyQMEkTQhYK2EpL092AAPxaRilJKEckbFUb9PevAhHoqDtG2XTNreJ737IYb0I1ECqOBCJMDtzu3rIQd4cHBdUEwntlCgeuehhtTKblhCpSB2byXWp6+H7uNhwWy1S5fZ/ICh0XO6zI2bceap+DAKR1yANNzavL52dDtht8XRaDerubcGZTuMpUv7nABEBOgQARoRYEMEWESADBEQEQHVEeD/rUGsimKIgoq1AQbFEGsEkE+nMTAK/vkoookMqibEOmpD60q4v3h3qjJvsRfqMUCCT5H6wVNnJPTty9UVckFGeNDh5Wd4tMNji9M81lNPdPXO8FSHx8/l0U2YniNCX0Xel9jNZVERmwNbrJe33nrfg+6+PThX546XtNhmloh+OkM7pvMvq/dmNgdHWjgr5gZ9R6/VKravR1L0clLsclL8clJHHxCeFOutIy8X0tEniydFe+scfdmcTO1PbE/NyrL8B0eOKVk=");k()&&N(b);const m=new gn(b.board.vertices[5],b.stateProperty,{...Tt,allVertexStateVisibleProperty:new Ee(!0)}),F=new I({children:[m],scale:60}),d=new fn(b.board.faces[5],b.stateProperty,Mt),g=new I({children:[d],scale:30}),C=ge(Fo,{fill:h.uiForegroundColorProperty,matrix:new rt().rowMajor(.75,0,0,0,-.75,0,0,0,1)}),f=new co;return{basicLinesIcon:f.createBox(a),basicFaceColoringIcon:f.createBox(s),pureFaceColoringIcon:f.createBox(i),classicIcon:f.createBox(u),basicSectorsIcon:f.createBox(v),sectorsWithColorsIcon:f.createBox(E),vertexStateIcon:f.createBox(F),faceStateIcon:f.createBox(g),customIcon:f.createBox(C)}}}const ie=(l,n,e,t)=>{const o=new en(n,e,{spacing:8,radioButtonOptions:{selectedColor:h.uiButtonBaseColorProperty,deselectedColor:h.uiBackgroundColorProperty,stroke:h.uiForegroundColorProperty}}),r=se()({stretch:!0,align:"left",spacing:10,children:[new X(l,{font:ce,fill:h.uiForegroundColorProperty}),o]},t);return new q(r)},j=new uo("advancedSettingsVisibleProperty",!1);class os extends qe{constructor(n){const e=new Ue(n),t=new q({stretch:!0,align:"left",spacing:8,children:[new X("Solve After Every Move",{font:ce,fill:h.uiForegroundColorProperty}),new Kt({xAlign:"left",yAlign:"top",xSpacing:20,ySpacing:8,columns:[[new x("Vertex Joint X",In),new x("Vertex Forced Line",Nn),new x("Vertex Forced X",xn),new x("Completed Face X",On),new x("Completed Face Lines",Bn),new x("Simple Loop X",An),new x("Simple Loop Lines",zn),new x("Double Minus One Faces",Tn),new x("1/N-1 Sectors",Mn),new x("Simple Sectors",Rn),new x("Vertex X",Hn),new x("Vertex Lines",Vn),new x("Vertex Sectors",Dn),new x("Vertex Faces",qn)],[new x("Color X",Un),new x("Color Lines",Wn),new x("Color Parity X",Gn),new x("Color Parity Lines",Xn),new x("Color Parity Colors",Yn),new x("Color Parity Partial",Jn),new x("Vertex/Color To Face",Zn),new x("Face X",Kn),new x("Face Lines",Qn),new x("Face Sectors",jn),new x("Face Color",$n)]]})]}),o=ie("Theme",hr,_t.map(d=>({value:d,createNode:()=>new X(d.name,{font:_,fill:h.uiForegroundColorProperty}),a11yName:d.name}))),r=new q({spacing:15,stretch:!0,visible:lt.debugColors,children:_t.filter(d=>d.isEditable).map(d=>new ue(`Edit ${d.name} Theme`,{listener:()=>{gr(d)}}))}),a=new q({stretch:!0,align:"left",spacing:8,children:[new X("Puzzle Display",{font:ce,fill:h.uiForegroundColorProperty}),new Kt({xAlign:"left",yAlign:"top",xSpacing:20,ySpacing:8,columns:[[new x("Lines Visible",eo),new x("Color Lines",fr,{enabledProperty:eo,layoutOptions:{leftMargin:20}}),new x("Face Colors Visible",wr),new x("Sectors Visible",Et),new x("Sectors Next to Edges",mr,{advanced:!0,enabledProperty:Et,layoutOptions:{leftMargin:20}}),new x("Trivial Sectors",yr,{advanced:!0,enabledProperty:Et,layoutOptions:{leftMargin:20}}),new x("Vertex State",to),new x("All Vertex State",Cr,{advanced:!0,enabledProperty:to,layoutOptions:{leftMargin:20}}),new x("Face State",Sr,{advanced:!0})],[new x("Possible Line Visible",vr),new x("Impossible Line Visible",oo),new x("Vertices Visible",Pr),new x("Vertices Small",br),new x("Red X Visible",Er),new x("Red X Aligned",Fr)]]}),new M({spacing:20,visibleProperty:j,children:[ie("Line Join",kr,Lr.map(d=>({value:d,createNode:()=>new X(d,{font:_,fill:h.uiForegroundColorProperty}),labelContent:d}))),ie("Line Cap",Nr,Ir.map(d=>({value:d,createNode:()=>new X(d,{font:_,fill:h.uiForegroundColorProperty}),labelContent:d}))),ie("Vertex Style",Or,xr.map(d=>({value:d,createNode:()=>new X(d,{font:_,fill:h.uiForegroundColorProperty}),labelContent:d}))),ie("Impossible Line Style",Ar,Br.map(d=>({value:d,createNode:()=>new X(d,{font:_,fill:h.uiForegroundColorProperty}),labelContent:d}))),ie("Face Value Style",Tr,zr.map(d=>({value:d,createNode:()=>new X(d,{font:_,fill:h.uiForegroundColorProperty}),labelContent:d})))]})]}),s=ie("Face Color Threshold",Mr,[{value:1,createNode:()=>new V("Show All"),labelContent:"Show All"},{value:2,createNode:()=>new V("2+"),labelContent:"2+"},{value:3,createNode:()=>new V("3+"),labelContent:"3+"},{value:5,createNode:()=>new V("5+"),labelContent:"5+"},{value:10,createNode:()=>new V("10+"),labelContent:"10+"},{value:Number.POSITIVE_INFINITY,createNode:()=>new V("Only Outside"),labelContent:"Only Outside"}]),i=new q({spacing:8,align:"left",stretch:!0,children:[new J(ft,"Auto-Solve"),new J(_n,"Add Lines",{layoutOptions:{leftMargin:20},enabledProperty:ft}),new J(er,"Simple Loops",{layoutOptions:{leftMargin:20},enabledProperty:ft}),new V("Highlights"),new J(wn,"Dim Completed Numbers",{layoutOptions:{leftMargin:20}}),new J(mn,"Highlight Incorrect Numbers",{layoutOptions:{leftMargin:20}}),new J(Rt,"Highlight Incorrect Moves",{layoutOptions:{leftMargin:20}}),new J(yn,"Highlight Intersecting Lines",{layoutOptions:{leftMargin:20}}),new J(new tn(Cn,{bidirectional:!0,map:d=>d===gt.CYCLIC,inverseMap:d=>d?gt.CYCLIC:gt.TOGGLE}),"Cycle Between States"),new J(vo,"Show View Style Controls"),new J(oo,"Show Impossible Lines"),new J(Po,"Show Elapsed Time"),new J(me,"Enable Sector View Styles"),new J(Ht,"Show Undo-All / Redo-All",{advanced:!0}),new J(Gt,"Show Layout Test",{advanced:!0}),new J(Sn,"Solve Uses Built-In",{advanced:!0})]}),p=new qt(!1),c=Le.and([j,p]),u=We.getIcons(),v=(d,g)=>new M({spacing:5,children:[new V(g),d]}),E=ie("View Style",ho,[{value:go,createNode:()=>v(u.classicIcon,"Classic"),labelContent:"Classic"},{value:fo,createNode:()=>v(u.basicLinesIcon,"Lines"),labelContent:"Lines"},{value:wo,createNode:()=>v(u.basicFaceColoringIcon,"Lines and Colors"),labelContent:"Lines and Colors"},{value:mo,createNode:()=>v(u.pureFaceColoringIcon,"Colors"),labelContent:"Colors"},{value:yo,createNode:()=>v(u.basicSectorsIcon,"Sectors"),labelContent:"Sectors",options:{visibleProperty:me}},{value:Co,createNode:()=>v(u.sectorsWithColorsIcon,"Sectors and Colors"),labelContent:"Sectors and Colors",options:{visibleProperty:me}},{value:Tt,createNode:()=>v(u.vertexStateIcon,"Vertex State"),labelContent:"Vertex State",options:{visibleProperty:j}},{value:Mt,createNode:()=>v(u.faceStateIcon,"Face State"),labelContent:"Face State",options:{visibleProperty:j}},{value:So,createNode:()=>v(u.customIcon,"Custom"),labelContent:"Custom",options:{visibleProperty:j}}]),b=new J(p,"Show Custom Options",{advanced:!0}),m=new q({spacing:20,align:"left",children:[new M({spacing:20,children:[t,s]}),a],visibleProperty:c}),F=new ue("Reload to Defaults",{accessibleName:"Clear all settings/data, and reload the page",listener:()=>{localStorage.clear(),self.location.reload()},advanced:!0});F.addInputListener(e),super(new q({spacing:20,align:"left",stretch:!0,children:[i,new M({align:"top",spacing:30,children:[E,o,r]}),b,m,F,new J(j,"Show Advanced Settings")]}),n)}}const ns=(l,n)=>{const e=new Set(l.faces.filter(a=>{const s=n.getFaceValue(a);return s!==null&&s!==0}));if(e.size===0)return 0;const t=new Set,o=new Set([[...e][0]]);let r=0;for(;o.size;){r+=1;const a=[...o];o.clear();for(const s of a)t.add(s);for(const s of a)for(const i of s.vertices)for(const p of i.faces)t.has(p)||o.add(p)}return r};class rs{constructor(n,e){L(this,"faceValues",[]);L(this,"faceColors",[]);L(this,"oppositeFaceColors",[]);L(this,"redEdgeValues",[]);L(this,"blackEdgeValues",[]);L(this,"sectorNotZeroValues",[]);L(this,"sectorNotOneValues",[]);L(this,"sectorNotTwoValues",[]);L(this,"sectorOnlyOneValues",[]);this.boardPatternBoard=n,this.inputData=e;for(const t of n.faces){const o=n.getFace(t);o?this.faceValues.push(e.getFaceValue(o)):this.faceValues.push(null);const r=o?e.getFaceColor(o):e.getOutsideColor(),a=e.getOppositeFaceColor(r);this.faceColors.push(r),this.oppositeFaceColors.push(a)}for(const t of n.edges){const o=n.getEdge(t);k()&&N(o);const r=e.getEdgeState(o);this.redEdgeValues.push(r===ee.RED),this.blackEdgeValues.push(r===ee.BLACK)}for(const t of n.sectors){const o=n.getSector(t);k()&&N(o);const r=e.getSectorState(o);this.sectorNotZeroValues.push(!r.zero),this.sectorNotOneValues.push(!r.one),this.sectorNotTwoValues.push(!r.two),this.sectorOnlyOneValues.push(!r.zero&&r.one&&!r.two)}}}const ss=(l,n,e,t,o)=>{const r=e.inputFeatureSet.getFeaturesArray(),a=e.outputFeatureSet.getFeaturesArray(),s=[],i=new Set,p=new Set,c=new Set;for(const y of a)if(y instanceof Qe||y instanceof It){const R=y instanceof Qe,A=l.getEdge(y.edge),ne=n.getEdgeState(A);if(ne===ee.WHITE)s.push(new or(A,R?ee.BLACK:ee.RED)),i.add(A);else if(ne===ee.BLACK!==R)throw new pe("Edge is not in the correct state")}else if(y instanceof je||y instanceof $e||y instanceof _e||y instanceof et){const R=l.getSector(y.sector),A=n.getSectorState(R);if(y instanceof je){if(A.zero){if(!A.one&&!A.two)throw new pe("Sector cannot be made impossible");s.push(new Je(R,A.withDisallowZero())),p.add(R)}}else if(y instanceof $e){if(A.one){if(!A.zero&&!A.two)throw new pe("Sector cannot be made impossible");s.push(new Je(R,A.withDisallowOne())),p.add(R)}}else if(y instanceof _e){if(A.two){if(!A.zero&&!A.one)throw new pe("Sector cannot be made impossible");s.push(new Je(R,A.withDisallowTwo())),p.add(R)}}else if(y instanceof et&&(A.zero||A.two)){if(!A.one)throw new pe("Sector cannot be made impossible");s.push(new Je(R,A.withDisallowZero().withDisallowTwo())),p.add(R)}}else if(y instanceof Nt){const R=H=>ve.uniq(H.map(ye=>{const Ce=l.getFace(ye);return Ce?n.getFaceColor(Ce):n.getOutsideColor()})),A=R(y.primaryFaces),ne=R(y.secondaryFaces),Me=A.map(H=>n.getOppositeFaceColor(H)),Xe=ne.map(H=>n.getOppositeFaceColor(H));for(const H of A){if(ne.includes(H))throw new pe("Cannot make primary and secondary colors the same");if(Me.includes(H))throw new pe("Cannot make primary and opposite colors the same")}for(const H of ne)if(Xe.includes(H))throw new pe("Cannot make secondary and opposite colors the same");const Re=(H,ye)=>{[...y.allFaces].forEach(Ce=>{const Se=l.getFace(Ce),Jt=Se?n.getFaceColor(Se):n.getOutsideColor();Se&&(Jt===H||Jt===ye)&&c.add(Se)})};for(const H of[A,ne])if(H.length>1)for(let ye=1;ye<H.length;ye++){const Ce=H[0],Se=H[ye];s.push(new nr(Ye(n,Ce),Ye(n,Se))),Re(Ce,Se)}ne.length&&A[0]!==Xe[0]&&(s.push(new rr(Ye(n,A[0]),Ye(n,ne[0]))),Re(A[0],ne[0]))}else k()&&N(y instanceof xt);const u=r.filter(y=>y instanceof xt).map(y=>({face:l.getFace(y.face),value:y.value})),v=a.filter(y=>y instanceof xt).map(y=>({face:l.getFace(y.face),value:y.value})),E=r.filter(y=>y instanceof Qe).map(y=>l.getEdge(y.edge)),b=a.filter(y=>y instanceof Qe).map(y=>l.getEdge(y.edge)),m=r.filter(y=>y instanceof It).map(y=>l.getEdge(y.edge)),F=a.filter(y=>y instanceof It).map(y=>l.getEdge(y.edge)),d=r.filter(y=>y instanceof je).map(y=>l.getSector(y.sector)),g=a.filter(y=>y instanceof je).map(y=>l.getSector(y.sector)),C=r.filter(y=>y instanceof $e).map(y=>l.getSector(y.sector)),f=a.filter(y=>y instanceof $e).map(y=>l.getSector(y.sector)),P=r.filter(y=>y instanceof _e).map(y=>l.getSector(y.sector)),O=a.filter(y=>y instanceof _e).map(y=>l.getSector(y.sector)),B=r.filter(y=>y instanceof et).map(y=>l.getSector(y.sector)),w=a.filter(y=>y instanceof et).map(y=>l.getSector(y.sector)),S=r.filter(y=>y instanceof Nt),ae=a.filter(y=>y instanceof Nt),oe=y=>({primaryFaces:y.primaryFaces.map(R=>l.getFace(R)),secondaryFaces:y.secondaryFaces.map(R=>l.getFace(R))}),D=S.map(oe),U=ae.map(oe);return new sr(new ar(s),{type:"Pattern",rule:t,embedding:o,boardPatternBoard:l,input:{faceValues:u,blackEdges:E,redEdges:m,sectorsNotZero:d,sectorsNotOne:C,sectorsNotTwo:P,sectorsOnlyOne:B,faceColorDuals:D},output:{faceValues:v,blackEdges:b,redEdges:F,sectorsNotZero:g,sectorsNotOne:f,sectorsNotTwo:O,sectorsOnlyOne:w,faceColorDuals:U},affectedEdges:i,affectedSectors:p,affectedFaces:c},l.board)};class de{constructor(n,e,t,o,r=0){L(this,"nextIndex");L(this,"dirtyListener");L(this,"quickSpanningCount");this.board=n,this.boardPatternBoard=e,this.state=t,this.binaryRuleCollection=o,this.quickSpanningCount=ns(n,t),this.nextIndex=r,this.dirtyListener=()=>{this.nextIndex=0},this.state.faceValueChangedEmitter.addListener(this.dirtyListener),this.state.edgeStateChangedEmitter.addListener(this.dirtyListener),this.state.sectorStateChangedEmitter.addListener(this.dirtyListener),this.state.faceColorsChangedEmitter.addListener(this.dirtyListener)}get dirty(){return this.nextIndex<this.binaryRuleCollection.size}nextAction(){if(!this.dirty)return null;const n=new rs(this.boardPatternBoard,this.state),e=this.binaryRuleCollection.findNextActionableEmbeddedRuleFromData(n.boardPatternBoard,n,this.nextIndex);return e?(this.nextIndex=e.ruleIndex+1,ss(this.boardPatternBoard,this.state,e.embeddedRule,e.rule,e.embedding)):(this.nextIndex=this.binaryRuleCollection.size,null)}clone(n){return new de(this.board,this.boardPatternBoard,n,this.binaryRuleCollection,this.nextIndex)}dispose(){this.state.faceValueChangedEmitter.removeListener(this.dirtyListener),this.state.edgeStateChangedEmitter.removeListener(this.dirtyListener),this.state.sectorStateChangedEmitter.removeListener(this.dirtyListener),this.state.faceColorsChangedEmitter.removeListener(this.dirtyListener)}static fromGroup(n,e,t,o,r=o.size){return k()&&N(r<=o.size),new de(n,e,t,{size:r,findNextActionableEmbeddedRuleFromData:(a,s,i=0)=>o.collection.findNextActionableEmbeddedRuleFromData(a,s,i,p=>o.isRuleIndexHighlander(p),r)})}}const re=class re extends Ro{constructor(n){super(),this.canSolve=n}};L(re,"EASY",new re((n,e)=>(e=e.clone(),wt((t,o,r)=>{const a=bt.get(t);return new mt([new yt(t,o),new Ct(t,o),new St(t,o),new vt(t,o,{solveToRed:!0,solveToBlack:!0,resolveAllRegions:!1}),de.fromGroup(t,a,o,kt,120)])},n,e,!0),Pt(e)))),L(re,"MEDIUM",new re((n,e)=>(e=e.clone(),wt((t,o,r)=>{const a=bt.get(t);return new mt([new yt(t,o),new Ct(t,o),new St(t,o),new vt(t,o,{solveToRed:!0,solveToBlack:!0,resolveAllRegions:!1}),de.fromGroup(t,a,o,no,50),de.fromGroup(t,a,o,kt,360)])},n,e,!0),Pt(e)))),L(re,"HARD",new re((n,e)=>(e=e.clone(),wt((t,o,r)=>{const a=bt.get(t);return new mt([new yt(t,o),new Ct(t,o),new St(t,o),new vt(t,o,{solveToRed:!0,solveToBlack:!0,resolveAllRegions:!1}),vn(t,o),de.fromGroup(t,a,o,qr,600),de.fromGroup(t,a,o,no,100),de.fromGroup(t,a,o,kt,1e3)])},n,e,!0),Pt(e)))),L(re,"NO_LIMIT",new re(()=>!0)),L(re,"enumeration",new Ho(re));let we=re;const io=new on("canSolveDifficulty",we.EASY),as=l=>{const n=l.cleanState.clone();for(const e of l.board.faces)n.getFaceValue(e)===null&&n.setFaceValue(e,e.edges.filter(t=>l.blackEdges.has(t)).length);return tr(l.board,n,l.blackEdges)};class is extends M{constructor(n,e){const t=new nn("polygonGeneratorProperty",{serialize:d=>d.name,deserialize:d=>Ke.find(g=>g.name===d)??Ke[0]}),o=localStorage.getItem("polygonGeneratorParameters")?JSON.parse(localStorage.getItem("polygonGeneratorParameters")):null;let r=!1;const a=ie("Patterns",t,Ke.map(d=>({value:d,createNode:()=>new X(d.name,{font:_,fill:h.uiForegroundColorProperty}),labelContent:d.name})),{layoutOptions:{align:"top",grow:0},justify:"top"}),s=new M({spacing:10,align:"center",layoutOptions:{grow:0},grow:1}),i=new M({spacing:10,align:"center",layoutOptions:{grow:0},children:[new V("Difficulty"),new Ur(io,[{value:we.EASY,createNode:()=>new V("Easy"),labelContent:"Easy"},{value:we.MEDIUM,createNode:()=>new V("Medium"),labelContent:"Medium"},{value:we.HARD,createNode:()=>new V("Hard"),labelContent:"Hard"},{value:we.NO_LIMIT,createNode:()=>new V("No Limit"),labelContent:"No Limit"}],{orientation:"horizontal",align:"center",spacing:30})]}),p=new M({spacing:10,align:"center",justify:"spaceEvenly",layoutOptions:{grow:0}}),c=new I,u=new I,v=new He;v.addListener(()=>{u.children=[]});const E=new I({children:[c,u]}),b=(d,g)=>{const C=d.generate(g),f=new T;C.forEach(P=>f.polygon(P)),c.children=[new Y(f,{fill:h.puzzleBackgroundColorProperty,stroke:h.blackLineColorProperty,lineWidth:.05})],v.emit()};b(Ke[0],{width:5,height:5}),t.link(d=>{p.children.forEach(P=>P.dispose()),s.children.forEach(P=>P.dispose());const g={},C=P=>o&&!r&&P in o?o[P]:d.defaultParameterValues[P],f=()=>{localStorage.setItem("polygonGeneratorParameters",JSON.stringify(g)),b(d,g)};for(const[P,O]of Object.entries(d.parameters))if(O.type==="integer"){const B=new Qt(C(P));B.link(w=>{g[P]=w,f()}),p.addChild(new Ze(O.label,B,O.range,{layoutFunction:Ze.createLayoutFunction4(),titleNodeOptions:{font:_,fill:h.uiForegroundColorProperty},sliderOptions:{trackSize:new Ot(100,5),labelTagName:"label",keyboardStep:1,labelContent:O.label},arrowButtonOptions:{touchAreaXDilation:5,touchAreaYDilation:25},numberDisplayOptions:{decimalPlaces:0},delta:1,visibleProperty:O.advanced?j:null}))}else if(O.type==="float"){const B=new Qt(C(P));B.link(w=>{g[P]=w,f()}),p.addChild(new Ze(O.label,B,O.range,{layoutFunction:Ze.createLayoutFunction4(),titleNodeOptions:{font:_,fill:h.uiForegroundColorProperty},sliderOptions:{trackSize:new Ot(100,5),labelTagName:"label",keyboardStep:.1,labelContent:O.label},numberDisplayOptions:{decimalPlaces:2},delta:.01,visibleProperty:O.advanced?j:null}))}else if(O.type==="boolean"){const B=new qt(C(P));B.link(w=>{g[P]=w,f()}),p.addChild(new x(O.label,B,{advanced:O.advanced}))}else if(O.type==="choice"){const B=new Dt(C(P));B.link(w=>{g[P]=w,f()}),p.addChild(ie(O.label,B,O.choices.map(w=>({value:w.value,createNode:()=>new X(w.label,{font:_,fill:h.uiForegroundColorProperty}),labelContent:w.label}))))}r=!0,s.addChild(new ue("Generate",{font:Ft,layoutOptions:{align:"center"},listener:async()=>{v.emit();const P=d.generate(g),O=dn.get(d,g),B=new Ee(!1),w=()=>{B.value=!0};v.addListener(w);const S=new He,ae=new He,oe=new He;oe.addListener(()=>{u.children=[]}),S.addListener((D,U)=>{u.addChild(new Y(T.polygon(P[D]),{fill:h.generateAddedFaceColorProperty,stroke:h.blackLineColorProperty,lineWidth:.05})),U!==null&&u.addChild(new X(`${U}`,{font:Ft,fill:h.faceValueColorProperty,maxWidth:.9,maxHeight:.9,center:Ae(P[D])}))}),ae.addListener((D,U)=>{u.addChild(new Y(T.polygon(P[D]),{fill:h.generateMinimizedFaceColorProperty,stroke:h.blackLineColorProperty,lineWidth:.05})),U!==null&&u.addChild(new X(`${U}`,{font:Ft,fill:h.faceValueColorProperty,maxWidth:.9,maxHeight:.9,center:Ae(P[D])}))});try{const D=io.value,U=D.canSolve,y=async()=>await ir(O,B,S),R=async()=>{let Me=await y();if(D===we.NO_LIMIT)return Me;{const Xe=O.faces.filter(H=>Me.cleanState.getFaceValue(H)===null),Re=as(Me);return Xe.forEach(H=>{S.emit(O.faces.indexOf(H),Re.cleanState.getFaceValue(H))}),Re}};let A=await R();for(;!U(A.board,A.cleanState.clone());)oe.emit(),A=await R();const ne=await lr(A,U,B,ae);cr(17,B),B.value||(u.children=[],F.loadPuzzle(Fe.fromSolvedPuzzle(ne)))}catch{}v.hasListener(w)&&v.removeListener(w)}}))});const m=new G({fill:h.playAreaBackgroundColorProperty,sizable:!0,layoutOptions:{grow:1},children:[E]});it.multilink([m.localPreferredWidthProperty,m.localPreferredHeightProperty,E.localBoundsProperty],(d,g,C)=>{if(d!==null&&g!==null&&C.isFinite()){const P=d-30,O=g-2*15,B=Math.min(P/C.width,O/C.height);B>0&&(E.setScaleMagnitude(B),E.centerX=d/2,E.centerY=g/2)}});const F=se()({spacing:10,stretch:!0,children:[a,new q({spacing:10,stretch:!0,layoutOptions:{grow:1},children:[m,s,new Bt,i,new Bt,p]})]},e);super(F)}}const ls="#444",cs="#fa0",ds="#888",us="#fff",ps="#f00",hs="#ff0",gs="#ff0",fs="#0f0",ws="#0ff",ms="#0af",ys="#f0f";class Cs extends qe{constructor(e){const t=new M({children:[new X("Loading image...",{font:_,fill:h.uiForegroundColorProperty})]}),o=new I({children:[t]});super(o,e);L(this,"scanContentNode");L(this,"imageContainer");L(this,"solutionContainer");L(this,"blackImageLayer");L(this,"originalImageLayer");L(this,"thresholdImageLayer");L(this,"contourLayer");L(this,"puzzle",null);L(this,"rootContour",null);L(this,"contours",[]);L(this,"contourNodeMap",new Map);this.scanContentNode=o,this.blackImageLayer=new I,this.originalImageLayer=new I({visible:!1}),this.thresholdImageLayer=new I({visible:!1}),this.contourLayer=new I,this.imageContainer=new I({children:[this.blackImageLayer,this.originalImageLayer,this.thresholdImageLayer,this.contourLayer]}),this.solutionContainer=new I}getScanOptions(){return{originalImageCallback:e=>this.onOriginalImage(e),thresholdedImageCallback:e=>this.onThresholdedImage(e),rootContourCallback:e=>this.onRootContour(e),widestSubtreeCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeWidestContour()},dotContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeDotContour()},lineContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeLineContour()},zeroOuterContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeZeroOuterContour()},zeroInnerContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeZeroInnerContour()},oneContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeOneContour()},twoContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeTwoContour()},threeContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeThreeContour()},xContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeXContour()},unknownContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeUnknownContour()},debugImageCallback:e=>{},puzzleCallback:e=>this.onPuzzle(e),solutionsCallback:e=>this.onSolutions(e)}}onOriginalImage(e){this.originalImageLayer.addChild(new jt(e)),this.blackImageLayer.addChild(G.bounds(this.originalImageLayer.bounds,{fill:"black"})),this.scanContentNode.children=[new q({spacing:10,children:[this.imageContainer,this.solutionContainer]})]}onThresholdedImage(e){this.thresholdImageLayer.addChild(new jt(e))}onRootContour(e){this.rootContour=e,this.contours=e.getDescendantContours();for(const t of this.contours){const o=new Ss(t);this.contourNodeMap.set(t,o),this.contourLayer.addChild(o)}}onPuzzle(e){this.puzzle=e}onSolutions(e){if(e.length===1)this.hide();else{const t=this.puzzle;k()&&N(t);const o=t.board;if(e.length===0){Ve(o,t.stateProperty.value);const r=new Ne(t,{scale:20});this.solutionContainer.children=[new q({spacing:10,children:[new V("No Solutions Found"),r]})]}else{const r=new Fe(o,t.stateProperty.value.clone()),a=new Fe(o,t.stateProperty.value.clone()),s=new Fe(o,t.stateProperty.value.clone());e[0].forEach(u=>r.stateProperty.value.setEdgeState(u,ee.BLACK)),e[1].forEach(u=>a.stateProperty.value.setEdgeState(u,ee.BLACK)),o.edges.forEach(u=>{r.stateProperty.value.getEdgeState(u)!==a.stateProperty.value.getEdgeState(u)&&s.stateProperty.value.setEdgeState(u,ee.BLACK)}),Ve(o,r.stateProperty.value),Ve(o,a.stateProperty.value),Ve(o,s.stateProperty.value);const i=new Ne(r,{scale:10}),p=new Ne(a,{scale:10}),c=new Ne(s,{scale:10});this.solutionContainer.children=[new q({spacing:10,children:[new V("Multiple Solutions Found"),new M({spacing:10,children:[new q({spacing:10,children:[i,new V("Solution A")]}),new q({spacing:10,children:[p,new V("Solution B")]}),new q({spacing:10,children:[c,new V("Difference")]})]})]})]}}}}class Ss extends I{constructor(e){const t=new Y(e.shape,{stroke:ls});super({children:[t]});L(this,"path");this.contour=e,this.path=t}makeWidestContour(){this.path.stroke=cs}makeDotContour(){this.path.stroke=ds}makeLineContour(){this.path.stroke=us}makeXContour(){this.path.stroke=ps}makeZeroOuterContour(){this.path.stroke=hs}makeZeroInnerContour(){this.path.stroke=gs}makeOneContour(){this.path.stroke=fs}makeTwoContour(){this.path.stroke=ws}makeThreeContour(){this.path.stroke=ms}makeUnknownContour(){this.path.stroke=ys}}class vs extends qe{constructor(n,e){super(new q({spacing:20,align:"left",stretch:!0,children:[new I({children:[new is(n,{loadPuzzle:t=>{this.hide(),e.loadPuzzle(t)},preferredWidth:700,preferredHeight:300})]}),new Bt,new M({spacing:15,grow:1,children:[new ue("Load String",{listener:()=>{this.hide();const t=prompt("Enter puzzle string");t&&e.loadPuzzle(Fe.loadDeprecatedScalaString(t))}}),new ue("Load Image (Rectangular Only)",{listener:()=>{this.hide();const t=document.createElement("input");t.type="file",t.onchange=o=>{const r=o.target.files[0];var a=new FileReader;a.readAsDataURL(r),a.onloadend=async()=>{const s=a.result,i=new Cs(n);i.show();const p=await Do(s,i.getScanOptions());e.loadPuzzle(p)}},t.click()}})]})]}),n)}}class Ps extends he{constructor(n){const e=se()({advanced:!1,baseColor:h.uiButtonBaseColorProperty,xMargin:5,yMargin:5,buttonAppearanceStrategy:be},n);e.advanced&&(e.visibleProperty=j),super(e)}}class bs{constructor(n,e,t,o){L(this,"maxLineWidth");L(this,"disposeFlatAppearanceStrategy");const r=new $t(t,{luminanceFactor:-.3}),a=new $t(t,{luminanceFactor:-.6}),s=r,i=a,p=K({stroke:a},o),c=1.5;n.stroke=p.stroke||a,n.lineWidth=c,this.maxLineWidth=1.5,n.cachedPaints=[t,s,i];function u(v){let E=1,b=1;switch(v){case Be.IDLE:n.fill=t,n.stroke=r,E=.3;break;case Be.OVER:n.fill=t,n.stroke=r,E=.5;break;case Be.PRESSED:n.fill=t,n.stroke=h.uiButtonSelectedStrokeColorProperty,b=1.5;break;default:throw new Error(`unsupported interactionState: ${v}`)}n.opacity=E,n.lineWidth=b}e.link(u),this.disposeFlatAppearanceStrategy=()=>{e.hasListener(u)&&e.unlink(u),r.dispose(),a.dispose()}}dispose(){this.disposeFlatAppearanceStrategy()}}class Es{constructor(n,e,t){L(this,"dispose");function o(r){let a=1;switch(r){case Be.IDLE:a=.6;break;case Be.OVER:break;case Be.PRESSED:break;default:throw new Error(`unsupported interactionState: ${r}`)}n.opacity=a}e.link(o),this.dispose=()=>{e.hasListener(o)&&e.unlink(o)}}}class ct extends M{constructor(n){const e=new Ue(n),t=P=>new I({scale:1.3,children:[P]}),{edgeIcon:o,edgeReversedIcon:r,faceColorInsideIcon:a,faceColorOutsideIcon:s,faceColorMatchIcon:i,faceColorOppositeIcon:p,sectorIcon:c,eraserIcon:u,panIcon:v,dragIcon:E}=ct.getIcons(),b=new Lo(Pn,[{value:Q.EDGE_STATE,labelContent:"Edge Edit Mode",createNode:()=>t(o),options:{visibleProperty:Q.EDGE_STATE.isEnabledProperty}},{value:Q.EDGE_STATE_REVERSED,labelContent:"Edge Reversed Edit Mode",createNode:()=>t(r),options:{visibleProperty:Q.EDGE_STATE_REVERSED.isEnabledProperty}},{value:Q.FACE_COLOR_INSIDE,labelContent:"Face Color Inside Edit Mode",createNode:()=>t(a),options:{visibleProperty:Q.FACE_COLOR_INSIDE.isEnabledProperty}},{value:Q.FACE_COLOR_OUTSIDE,labelContent:"Face Color Outside Edit Mode",createNode:()=>t(s),options:{visibleProperty:Q.FACE_COLOR_OUTSIDE.isEnabledProperty}},{value:Q.FACE_COLOR_MATCH,labelContent:"Face Color Match Edit Mode",createNode:()=>t(i),options:{visibleProperty:Q.FACE_COLOR_MATCH.isEnabledProperty}},{value:Q.FACE_COLOR_OPPOSITE,labelContent:"Face Color Opposite Edit Mode",createNode:()=>t(p),options:{visibleProperty:Q.FACE_COLOR_OPPOSITE.isEnabledProperty}},{value:Q.SECTOR_STATE,labelContent:"Sector Edit Mode",createNode:()=>t(c),options:{visibleProperty:Q.SECTOR_STATE.isEnabledProperty}}],{spacing:15,layoutOptions:{grow:1}});b.children.forEach(P=>P.addInputListener(e));const m={buttonAppearanceStrategy:be,baseColor:h.uiButtonBaseColorProperty,disabledColor:h.uiButtonDisabledColorProperty,mouseAreaXDilation:5,mouseAreaYDilation:5,touchAreaXDilation:5,touchAreaYDilation:5},F=new rn(Ut,K({},m,{accessibleName:"Eraser Mode (Toggle)",content:t(u),buttonAppearanceStrategy:bs,contentAppearanceStrategy:Es}));F.addInputListener(e);const d=t(v),g=t(E),C=new I;xe.link(P=>{C.children=[P===fe.PAN_ONLY?d:g]});const f=new Ps({content:C,listener:()=>{xe.value=xe.value===fe.PAN_ONLY?fe.DRAG_ONLY:fe.PAN_ONLY}});xe.link(P=>{f.accessibleName=P===fe.PAN_ONLY?"Pan Mode (toggle)":"Drag Input Mode (toggle)"}),f.addInputListener(e),super({spacing:13,stretch:!0,children:[b,new qo,F,f]}),n.layoutBoundsProperty.link(P=>{this.maxWidth=Math.max(1,P.width-2*ze)})}static getIcons(){const n=new At(0,0,15,0,{stroke:h.uiButtonForegroundProperty,lineWidth:4,lineCap:"round"}),e=6,t=new T().moveTo(-e,-e).lineTo(e,e).moveTo(-e,e).lineTo(e,-e),o=new Y(t,{stroke:h.uiButtonForegroundProperty,lineWidth:2}),r=new I({children:[new G(0,0,14,14,{stroke:h.uiButtonForegroundProperty,fill:h.uiButtonFaceOutsideColorProperty})]}),a=new I({children:[new G(0,0,14,14,{stroke:h.uiButtonForegroundProperty,fill:h.uiButtonFaceInsideColorProperty})]}),s=new I({children:[new G(0,0,7,7,{stroke:h.uiButtonForegroundProperty,fill:h.uiForegroundColorProperty}),new G(7,7,7,7,{stroke:h.uiButtonForegroundProperty,fill:h.uiForegroundColorProperty})]}),i=new I({children:[new G(0,0,7,7,{stroke:h.uiButtonForegroundProperty,fill:h.uiForegroundColorProperty}),new G(7,7,7,7,{stroke:h.uiButtonForegroundProperty,fill:h.uiBackgroundColorProperty})]}),p=new I({children:[new Y(new T().moveTo(0,14).lineTo(0,0).lineTo(14,0),{stroke:h.uiButtonForegroundProperty}),new Y(new T().arc(0,0,7,0,Math.PI/2,!1),{stroke:h.uiButtonForegroundProperty})]}),c=17,u=6,v=7,E=2,b=v/Math.sqrt(2),m=new I({children:[new I({rotation:-Math.PI/4,children:[new G(0,0,c,v,{stroke:h.uiButtonForegroundProperty,fill:h.uiButtonInvertedForegroundProperty,cornerRadius:E}),new G(u,0,c-u,v,{fill:h.uiButtonForegroundProperty,cornerRadius:E})]}),new At(b,b-.5,b+12,b-.5,{stroke:h.uiButtonForegroundProperty,lineDash:[5,1,3,1,2]})]}),F=new Y(es.transformed(rt.rotationZ(Math.PI/4)),{fill:h.uiButtonForegroundProperty,maxWidth:14,maxHeight:14}),d=new I({children:[new Y(Fo,{fill:h.uiButtonForegroundProperty,matrix:rt.Y_REFLECTION,maxWidth:14,maxHeight:14}),new Y(new T().moveTo(0,1.5).lineTo(12,1.5),{stroke:h.uiButtonForegroundProperty,lineDash:[9,1,2]})]}),g=new co;return{edgeIcon:g.createBox(n),edgeReversedIcon:g.createBox(o),faceColorInsideIcon:g.createBox(a),faceColorOutsideIcon:g.createBox(r),faceColorMatchIcon:g.createBox(s),faceColorOppositeIcon:g.createBox(i),sectorIcon:g.createBox(p),eraserIcon:g.createBox(m),panIcon:g.createBox(F),dragIcon:g.createBox(d)}}}class z extends Uo{constructor(n,e){const t=se()({font:_,fill:h.uiForegroundColorProperty,linkFill:h.uiLinkColorProperty},e);super(n,t)}}class Fs extends qe{constructor(n){self.phet.chipper.isFuzzEnabled=()=>!1;const e=ct.getIcons(),t=We.getIcons(),o=a=>new I({children:[G.bounds(a.bounds.dilated(3),{fill:h.uiButtonBaseColorProperty,stroke:h.uiButtonSelectedStrokeColorProperty,cornerRadius:3}),a]}),r=650;super(new q({spacing:10,align:"left",children:[new z("Slitherlink",{font:ce}),new z("Slitherlink is a logic puzzle where you draw a <strong>single continuous loop</strong> on a grid. The goal is to connect dots without crossing or overlapping, creating a loop that adheres to specific rules based on the numbers in some cells.",{lineWrap:r}),new q({spacing:2,align:"left",children:[new z("The loop must satisfy the following rules:"),new z("The loop cannot cross or touch itself.",{layoutOptions:{leftMargin:20}}),new z("Each numbered cell must have exactly that number of sides in the loop.",{layoutOptions:{leftMargin:20}})]}),new z("Solving",{font:ce}),new z('<a href="{{solvingGuide}}">See the Solving Guide</a>',{font:Rr,links:{solvingGuide:"./"},layoutOptions:{align:"center"}}),new z("Edit Modes",{font:ce}),new q({spacing:5,align:"left",children:[new z('<node id="edge" align="center"/> + click/tap adds a line, <node id="x" align="center"/> marks where lines are impossible',{lineWrap:r,nodes:{edge:o(e.edgeIcon),x:o(e.edgeReversedIcon)}}),new z('<node id="inside" align="center"/> + click/tap marks with the inside color, <node id="outside" align="center"/> marks with the outside color',{lineWrap:r,nodes:{inside:o(e.faceColorInsideIcon),outside:o(e.faceColorOutsideIcon)}}),new z('<node id="same" align="center"/> + click/tap on 1st cell + click/tap on 2nd to match colors, <node id="opposite" align="center"/> marks opposite colors',{lineWrap:r,nodes:{same:o(e.faceColorMatchIcon),opposite:o(e.faceColorOppositeIcon)}}),new M({spacing:10,children:[o(e.sectorIcon),new z(" + click/tap to pop up a selector, then select the sector color (see solving guide)")],visibleProperty:me})]}),new z("The number keys (1-9) can switch between edit modes. E will activate the eraser when pressed."),new z("The line/X and inside/outside color controls will cycle through the states (e.g. blank => line => X => blank) by default, but can be changed to toggle (e.g. blank => line, line => blank, X => line) in settings.",{lineWrap:r}),new z("Modifiers",{font:ce}),new z(`With erase (<node id="erase" align="center"/>) toggled on, edit modes will instead erase lines/X's/colors.`,{lineWrap:r,nodes:{erase:o(e.eraserIcon)}}),new z('Pan mode (<node id="pan" align="center"/>) will treat dragging as panning the view, while drag-edit mode (<node id="drag" align="center"/>) will allow setting the state of many lines/cells with one dragged press.',{lineWrap:r,nodes:{pan:o(e.panIcon),drag:o(e.dragIcon)}}),new z('Right-click or shift-click will activate the "opposite" mode (e.g. in line mode, shift-click will set an X). This will work for <node id="edge" align="center"/> / <node id="x" align="center"/>, <node id="inside" align="center"/> / <node id="outside" align="center"/>, and the final click for <node id="same" align="center"/> / <node id="opposite" align="center"/>.',{lineWrap:r,nodes:{edge:o(e.edgeIcon),x:o(e.edgeReversedIcon),inside:o(e.faceColorInsideIcon),outside:o(e.faceColorOutsideIcon),same:o(e.faceColorMatchIcon),opposite:o(e.faceColorOppositeIcon)}}),new z("View Styles",{font:ce}),new q({spacing:5,align:"left",children:[new M({spacing:10,children:[o(t.classicIcon),new z("Classic Slitherlink style, just lines/X's.")]}),new M({spacing:10,children:[o(t.basicLinesIcon),new z(`Cleaner lines (missing lines are X's, thin lines are "blank"), inside/outside colors`)]}),new M({spacing:10,children:[o(t.basicFaceColoringIcon),new z("Cleaner with face coloring (lighter/darker color pairs are inside/outside or outside/inside)")]}),new M({spacing:10,children:[o(t.pureFaceColoringIcon),new z("Similar to above, but without showing lines at all")]}),new M({spacing:10,children:[o(t.basicSectorsIcon),new z("Cleaner lines, with sectors (see the solving guide)")],visibleProperty:me}),new M({spacing:10,children:[o(t.sectorsWithColorsIcon),new z("Cleaner lines with colors and sectors (see the solving guide)")],visibleProperty:me})]}),new z("About / Contact",{font:ce}),new z('My name is Jonathan Olson, and I created this Slitherlink interface to explore the limits of solving techniques and to provide a seamless experience on both desktop and mobile. I value your feedback and would love to hear any questions, comments, or suggestions. Please reach out to me at <a href="{{email}}">jonathan.olson@colorado.edu</a>.',{lineWrap:r,links:{email:"mailto:jonathan.olson@colorado.edu"}})]}),n)}}class Ls extends qe{constructor(e){const t=new qt(!1),o=new ue("Copy URL",{accessibleName:"Copy Shareable URL to Clipboard",listener:()=>{if(this.puzzle){const r=location.protocol+"//"+location.host+location.pathname;let a=this.puzzle;this.includeStateProperty.value||(a=new Fe(a.board,bo.fromFaceValueData(a.board,a.stateProperty.value)));const s=bn(a);Hr(r+"?p="+encodeURIComponent(s))}}});o.addInputListener(new Ue(e));super(new q({spacing:20,align:"left",stretch:!0,children:[o,new x("Include Solve Progress",t)]}),e);L(this,"includeStateProperty");L(this,"puzzle",null);this.includeStateProperty=t}setPuzzle(e){this.puzzle=e}reset(){super.reset(),this.includeStateProperty.reset()}}class ks extends X{constructor(n,e){const t=se()({font:Vr,fill:h.timerColorProperty},e),o=60,r=60*o,a=24*r,s=new Le([n],i=>{i=Math.ceil(i);const p=Math.floor(i/a);i-=p*a;const c=Math.floor(i/r);i-=c*r;const u=Math.floor(i/o);i-=u*o;const v=i,E=c<10?`0${c}`:`${c}`,b=u<10?`0${u}`:`${u}`,m=v<10?`0${v}`:`${v}`;return p?`${p}d ${E}:${b}:${m}`:c?`${E}:${b}:${m}`:`${b}:${m}`});super(s,t),this.timerProperty=n,this.disposeEmitter.addListener(()=>{s.dispose()})}}class Is extends M{constructor(n,e,t){const o=new Ue(e),r=new T("M37.75,20.25 C38.6681734,20.25 39.4211923,20.9571103 39.4941988,21.8564728 L39.5,22 L39.5,36.25 C39.5,39.3517853 37.0439828,41.879937 33.9705557,41.9958479 L33.75,42 L14.25,42 C11.1482147,42 8.62006299,39.5439828 8.50415208,36.4705557 L8.5,36.25 L8.5,22 C8.5,21.0335017 9.28350169,20.25 10.25,20.25 C11.1681734,20.25 11.9211923,20.9571103 11.9941988,21.8564728 L12,22 L12,36.25 C12,37.440864 12.9251616,38.4156449 14.0959512,38.4948092 L14.25,38.5 L33.75,38.5 C34.940864,38.5 35.9156449,37.5748384 35.9948092,36.4040488 L36,36.25 L36,22 C36,21.0335017 36.7835017,20.25 37.75,20.25 Z M23.4989075,6.26787884 L23.6477793,6.25297693 L23.6477793,6.25297693 L23.8225053,6.25140103 L23.8225053,6.25140103 L23.9770074,6.26441014 L23.9770074,6.26441014 L24.1549097,6.29667263 L24.1549097,6.29667263 L24.223898,6.31492315 L24.223898,6.31492315 C24.4192207,6.36884271 24.6069182,6.4577966 24.7773762,6.58126437 L24.8968901,6.67628678 L24.8968901,6.67628678 L24.989825,6.76256313 L32.7679996,14.5407377 C33.4514171,15.2241552 33.4514171,16.3321939 32.7679996,17.0156115 C32.1247831,17.6588279 31.1054316,17.6966642 30.4179639,17.1291203 L30.2931259,17.0156115 L25.5,12.222 L25.5,31.5 C25.5,32.4181734 24.7928897,33.1711923 23.8935272,33.2441988 L23.75,33.25 C22.8318266,33.25 22.0788077,32.5428897 22.0058012,31.6435272 L22,31.5 L22,12.226 L17.2116504,17.0156115 C16.5684339,17.6588279 15.5490824,17.6966642 14.8616148,17.1291203 L14.7367767,17.0156115 C14.0935602,16.372395 14.055724,15.3530435 14.6232679,14.6655758 L14.7367767,14.5407377 L22.488804,6.78678454 C22.5446792,6.72871358 22.6045271,6.67449255 22.6679103,6.62455868 L22.7812362,6.54379243 L22.7812362,6.54379243 C22.8189499,6.51724 22.858413,6.49312256 22.8988638,6.47056335 L22.9176605,6.46138558 C23.0947495,6.36422067 23.2909216,6.29776289 23.4989075,6.26787884 Z"),a=new Ee(!1),s=new Ee(0),i=new Ee(Pe.NOT_FOUND),p=new Ie(n,{derive:f=>f?f.undoPossibleProperty:a}),c=new Ie(n,{derive:f=>f?f.redoPossibleProperty:a}),u=new Ie(n,{derive:f=>f?f.isSolvedProperty:a}),v=new Ie(n,{derive:f=>f?f.timeElapsedProperty:s}),E=new Ie(n,{derive:f=>f?f.hintStateProperty:i}),b=new Le([u],f=>!f);let m=null,F=null,d=null,g=null;const C={buttonAppearanceStrategy:be,baseColor:h.uiButtonBaseColorProperty,disabledColor:h.uiButtonDisabledColorProperty,xMargin:8*1.3,yMargin:5*1.3,mouseAreaXDilation:5,mouseAreaYDilation:5,touchAreaXDilation:5,touchAreaYDilation:5};super({spacing:10,stretch:!0,children:[new nt("New",K({},C,{accessibleName:"New",listener:()=>{m=m||new vs(e,{loadPuzzle:t.loadPuzzle}),m.show()},textFill:h.uiButtonForegroundProperty,baseColor:h.uiButtonBaseColorProperty,xMargin:5,yMargin:5,font:Lt,buttonAppearanceStrategy:be})),new he(K({},C,{accessibleName:"Undo All",content:ge(jr),listener:()=>{n.value&&n.value.onUserUndoAll()},enabledProperty:p,visibleProperty:Ht})),new he(K({},C,{accessibleName:"Undo",content:ge(Kr),listener:()=>{n.value&&n.value.onUserUndo()},enabledProperty:p,fireOnHold:!0})),new ks(v,{visibleProperty:Po}),new he(K({},C,{accessibleName:"Redo",content:ge(Qr),listener:()=>{n.value&&n.value.onUserRedo()},enabledProperty:c,fireOnHold:!0})),new he(K({},C,{accessibleName:"Redo All",content:ge($r),listener:()=>{n.value&&n.value.onUserRedoAll()},enabledProperty:c,visibleProperty:Ht})),new he(K({},C,{accessibleName:"Settings",content:ge(Zr),listener:()=>{d=d||new os(e),d.show()}})),new he(K({},C,{accessibleName:"Share",content:ge(r),listener:()=>{const f=n.value;f&&(F=F||new Ls(e),F.setPuzzle(f.puzzle),F.show())}})),new nt("Solve",K({},C,{accessibleName:"Solve",listener:()=>{n.value&&n.value.onUserRequestSolve()},enabledProperty:b,textFill:h.uiButtonForegroundProperty,baseColor:h.uiButtonBaseColorProperty,xMargin:5,yMargin:5,font:Lt,buttonAppearanceStrategy:be})),new nt("Hint",K({},C,{accessibleName:"Hint",listener:()=>{n.value&&n.value.onUserRequestHint()},enabledProperty:new Le([b,E],(f,P)=>f&&P===Pe.DEFAULT),textFill:h.uiButtonForegroundProperty,baseColor:h.uiButtonBaseColorProperty,xMargin:5,yMargin:5,font:Lt,buttonAppearanceStrategy:be})),new he(K({},C,{accessibleName:"Help",content:ge(_r),listener:()=>{g=g||new Fs(e),g.show()}}))]}),this.puzzleModelProperty=n,this.children.forEach(f=>f.addInputListener(o)),e.layoutBoundsProperty.link(f=>{this.maxWidth=Math.max(1,f.width-2*ze)})}}const Ns=h.uiForegroundColorProperty,xs=new Le([h.uiForegroundColorProperty],l=>l.withAlpha(.15));class Os extends I{constructor(n,e,t,o){super({});const r=new Wr({diameter:20,activeColor:Ns,inactiveColor:xs});this.disposeEmitter.addListener(()=>r.dispose());const a={xMargin:5,yMargin:5,fill:h.uiBackgroundColorProperty,stroke:h.uiForegroundColorProperty},s=new De(new M({spacing:10,children:[new I({children:[r]}),new V("Loading Hint Solver...")]}),a),i=new M({spacing:10,children:[new De(new M({spacing:10,children:[new I({children:[r]}),new V("Searching for Hint...")]}),a),new ue("Cancel",{listener:o})]}),p=new M({spacing:10,children:[new ue("Apply Hint",{listener:t}),new ue("Hide Hint",{listener:o})]}),c=new De(new V("No Hint Found"),a);c.pickable=!1;const u=E=>{this.children=[...E===Pe.LOADING?[s]:[],...E===Pe.SEARCHING?[i]:[],...E===Pe.FOUND?[p]:[],...E===Pe.NOT_FOUND?[c]:[]]};e.link(u),this.disposeEmitter.addListener(()=>e.unlink(u));const v=E=>{r.step(E)};n.stepEmitter.addListener(v),this.disposeEmitter.addListener(()=>n.stepEmitter.removeListener(v))}}class Bs extends I{constructor(n,e){const t=[],o=[],r=p=>{const c=p.getStrokedShape(new Go({lineWidth:.3,lineCap:"round",lineJoin:"round"}));t.push(...c.subpaths)},a=p=>{const c=p.getOffsetShape(-.1);o.push(...c.subpaths)},s=p=>{r(new T().moveToPoint(p.start.viewCoordinates).lineToPoint(p.end.viewCoordinates))},i=p=>{p.edges.every(c=>!e.incorrectEdges.has(c))&&a(T.polygon(p.vertices.map(c=>c.viewCoordinates)))};e.incorrectEdges.forEach(s),e.incorrectFaces.forEach(i),super({children:[new Y(new T(t),{fill:h.incorrectEdgeColorProperty}),new Y(new T(o),{fill:h.incorrectFaceColorProperty})],pickable:!1,filters:[new Wo(.1)]})}}class As extends I{constructor(e,t){const o=se()({focusNodeCallback:()=>{}},t),r=new Ne(e.puzzle,{edgePressListener:(c,u)=>e.onUserEdgePress(c,u),onEdgeDragStart:(c,u)=>e.onUserEdgeDragStart(c,u),onEdgeDrag:(c,u)=>e.onUserEdgeDrag(c,u),onEdgeDragEnd:()=>e.onUserEdgeDragEnd(),facePressListener:(c,u)=>e.onUserFacePress(c,u),onFaceDragStart:(c,u)=>e.onUserFaceDragStart(c,u),onFaceDrag:(c,u)=>e.onUserFaceDrag(c,u),onFaceDragEnd:()=>e.onUserFaceDragEnd(),sectorPressListener:(c,u)=>e.onUserSectorPress(c,u),sectorSetListener:(c,u)=>e.onUserSectorSet(c,u),selectedFaceColorHighlightProperty:e.selectedFaceColorHighlightProperty,selectedSectorEditProperty:e.selectedSectorEditProperty,style:e.style,delayEdgeInteractionEmitter:e.edgeAutoSolvedEmitter}),a=new I;super(K({children:[r,a]},o));L(this,"puzzleNode");this.puzzleModel=e,this.puzzleNode=r,this.disposeEmitter.addListener(()=>r.dispose());let s=null;const i=c=>{if(r.clearAnnotationNodes(),s&&(s.dispose(),s=null),c){const u=new dr(e.puzzle.board,c,e.style,r.getBackgroundBounds());r.addAnnotationNode(u),s=u,o.focusNodeCallback(u)}};this.disposeEmitter.addListener(()=>{s&&(s.dispose(),s=null)}),e.displayedAnnotationProperty.link(i),this.disposeEmitter.addListener(()=>e.displayedAnnotationProperty.unlink(i));const p=it.multilink([Rt,e.correctnessStateProperty],(c,u)=>{const v=()=>{a.children.forEach(E=>E.dispose())};c&&!u.isCorrect()?setTimeout(()=>{if(Rt.value&&u===e.correctnessStateProperty.value){const E=new Bs(e.puzzle.board,u);v(),a.children=[E],console.log("showing error")}},Math.ceil(En.value*1e3)):v()});this.disposeEmitter.addListener(()=>p.dispose())}}class Z{constructor(n,e){this.layoutPuzzle=n,this.derivatives=e}plus(n){const e=new Map;return this.derivatives.forEach((t,o)=>{e.set(o,t.plus(n.derivatives.get(o)))}),new Z(this.layoutPuzzle,e)}minus(n){const e=new Map;return this.derivatives.forEach((t,o)=>{e.set(o,t.minus(n.derivatives.get(o)))}),new Z(this.layoutPuzzle,e)}timesScalar(n){const e=new Map;return this.derivatives.forEach((t,o)=>{e.set(o,t.timesScalar(n))}),new Z(this.layoutPuzzle,e)}getMaxMagnitude(){let n=0;return this.derivatives.forEach(e=>{n=Math.max(n,e.getMagnitude())}),n}getAreaCorrectedDerivative(){let n=this;for(let e=0;e<5;e++)n=n.getAreaCorrectedDerivativeOnce();return n}getAreaCorrectedDerivativeOnce(){return this.plus(Z.getAreaScaledDeltas(this.layoutPuzzle,-this.getAreaDerivative()/this.layoutPuzzle.getSignedArea()))}getAreaDerivative(){let n=0;return this.layoutPuzzle.faces.forEach(e=>{n+=un(e.vertices.map(t=>t.viewCoordinates),e.vertices.map(t=>this.derivatives.get(t)))}),n}getDebugNode(){const n=new I;return this.layoutPuzzle.vertices.forEach(e=>{const t=this.derivatives.get(e),o=e.viewCoordinates,r=new Gr(o.x,o.y,o.x+t.x,o.y+t.y,{lineWidth:.01,headHeight:.05,headWidth:.05,tailWidth:.005,fill:"green",stroke:"green"});n.addChild(r)}),n}static getAreaScaledDeltas(n,e){const t=n.getCentroid(),o=new Map;return n.vertices.forEach(r=>{const a=r.viewCoordinates.minus(t).timesScalar(e);k()&&N(a.isFinite()),o.set(r,a)}),new Z(n,o)}static getHookesAttraction(n,e,t){const o=new Map;return n.vertices.forEach(r=>{o.set(r,le.ZERO.copy())}),n.edges.forEach(r=>{const a=r.start.viewCoordinates,i=r.end.viewCoordinates.minus(a),p=i.getMagnitude(),c=i.timesScalar((p-e)*t/p);k()&&N(c.isFinite()),o.get(r.start).add(c),o.get(r.end).subtract(c)}),new Z(n,o)}static getRegularPolygonDeltas(n,e,t,o){const r=new Map;n.vertices.forEach(s=>{r.set(s,le.ZERO.copy())});const a=s=>e/(2*Math.sin(Math.PI/s));return n.faces.forEach(s=>{if(s.vertices.length<3)return;const i=.2,p=.3,c=s.vertices.map(f=>f.viewCoordinates);let u=0;const v=zt(c);v<0?u=1:v<i&&(u=Math.max(u,(i-v)/i));for(let f=0;f<c.length&&!(u>=1);f++){const P=f,O=(f+1)%c.length,B=c[P],w=c[O];for(let S=f+2;S<c.length-(f===0?1:0)&&!(u>=1);S++){const ae=S%c.length,oe=(S+1)%c.length,D=c[ae],U=c[oe];if(ke.lineSegmentIntersection(B.x,B.y,w.x,w.y,D.x,D.y,U.x,U.y))k()&&N(c.length>=4),u=1;else{const y=Math.min(ke.distToSegment(B,D,U),ke.distToSegment(w,D,U),ke.distToSegment(D,B,w),ke.distToSegment(U,B,w));y<p&&(u=Math.max(u,(p-y)/p))}}}if(u===0&&t&&n.getFaceValue(s)===null)return;const E=Ae(c);k()&&N(E.isFinite());const b=a(c.length),m=c.map(f=>f.minus(E)),F=c.map((f,P)=>le.createPolar(b,2*Math.PI*P/c.length)),d=Z.getLeastSquares(m,F),g=o+(2-o)*u,C=c.map((f,P)=>d[P].minus(m[P]).timesScalar(g));s.vertices.forEach((f,P)=>{const O=C[P];k()&&N(O.isFinite()),r.get(f).add(O)})}),new Z(n,r)}static getBarycentricDeltas(n){const e=new Map;return n.vertices.forEach(t=>{const o=t.edges.map(s=>s.getOtherVertex(t)),r=new le(0,0);o.forEach(s=>r.add(s.viewCoordinates)),r.multiplyScalar(1/o.length);const a=r.subtract(t.viewCoordinates);k()&&N(a.isFinite()),e.set(t,a)}),new Z(n,e)}static getAngularDeltas(n,e){const t=new Map;return n.vertices.forEach(o=>{t.set(o,le.ZERO.copy())}),n.vertices.forEach(o=>{const r=o.edges.map(m=>m.getOtherVertex(o));let a=ve.sortBy(r,m=>m.viewCoordinates.minus(o.viewCoordinates).getAngle());if(a[0]!==r[0]){const m=a.indexOf(r[0]);a=[...a.slice(m),...a.slice(0,m)]}const s=ve.range(0,r.length).every(m=>a[m]===r[m]),i=r.map(m=>m.viewCoordinates.minus(o.viewCoordinates).normalized()),p=Z.getUnitLeastSquares(i),c=Math.max(...ve.range(0,r.length).map(m=>p[m].dot(p[(m+1)%r.length]))),u=Math.max(...ve.range(0,r.length).map(m=>i[m].dot(i[(m+1)%r.length]))),v=(m,F)=>F<=.5?.5*Math.pow(2*F,m):1-v(m,1-F),E=s?ke.linear(c,1,0,1,u):1,b=.75;if(E>b){const m=(E-b)/(1-b),F=v(2,m),d=new le(0,0);for(let g=0;g<r.length;g++){const C=r[g],f=i[g],P=p[g],O=P.minus(f.timesScalar(P.dot(f))).timesScalar(F*e);d.add(O),k()&&N(O.isFinite()),t.get(C).add(O)}d.multiplyScalar(1/r.length);for(const g of r)k()&&N(d),t.get(g).subtract(d)}}),new Z(n,t)}static getUnitLeastSquares(n){const e=n.length,t=ve.range(0,e).map(o=>le.createPolar(1,2*Math.PI*o/e));return Z.getLeastSquares(n,t)}static getLeastSquares(n,e){const t=n.length,o=new pt(2,t,[...e.map(c=>c.x),...e.map(c=>c.y)]),r=new pt(2,t,[...n.map(c=>c.x),...n.map(c=>c.y)]),a=o.times(r.transpose()),s=new Vo(a);let i=s.getV().times(s.getU().transpose());i.det()<0&&(i=s.getV().times(pt.diagonalMatrix([1,-1])).times(s.getU().transpose()));const p=new rt().rowMajor(i.get(0,0),i.get(0,1),0,i.get(1,0),i.get(1,1),0,0,0,1);return e.map(c=>{const u=p.timesVector2(c);return k()&&N(u.isFinite()),u})}}class zs extends pn{constructor(e,t){const o=new Map,r=new Map,a=new Map,s=new Map,i=new Map,p=new Map,c=new Map,u=new Map,v=w=>{const S=o.get(w);return k()&&N(S),S},E=w=>{const S=r.get(w);return k()&&N(S),S},b=w=>{const S=a.get(w);return k()&&N(S),S},m=w=>{const S=s.get(w);return k()&&N(S),S},F=w=>{const S=i.get(w);return k()&&N(S),S},d=w=>{const S=p.get(w);return k()&&N(S),S},g=w=>{const S=c.get(w);return k()&&N(S),S},C=w=>{const S=u.get(w);return k()&&N(S),S},f=e.vertices.map(w=>{const S=new Xr(w.logicalCoordinates,w.viewCoordinates);return o.set(w,S),i.set(S,w),S}),P=e.faces.map(w=>{const S=new so(w.logicalCoordinates,w.viewCoordinates);return r.set(w,S),p.set(S,w),S.originalFace=w,S}),O=[],B=e.edges.map(w=>{const S=o.get(w.start),ae=o.get(w.end);k()&&N(S),k()&&N(ae);const oe=new ro(S,ae);oe.originalEdges.add(w),a.set(w,oe),c.set(oe,w);const D=new tt(S,ae,!1);s.set(w.forwardHalf,D),u.set(D,w.forwardHalf),O.push(D);const U=new tt(ae,S,!0);return s.set(w.reversedHalf,U),u.set(U,w.reversedHalf),O.push(U),oe});f.forEach(w=>{const S=F(w);w.incomingHalfEdges=S.incomingHalfEdges.map(m),w.outgoingHalfEdges=S.outgoingHalfEdges.map(m),w.edges=S.edges.map(b),w.faces=S.faces.map(E)}),P.forEach(w=>{const S=d(w);w.halfEdges=S.halfEdges.map(m),w.edges=S.edges.map(b),w.vertices=S.vertices.map(v)}),B.forEach(w=>{const S=g(w);w.forwardHalf=m(S.forwardHalf),w.reversedHalf=m(S.reversedHalf),w.forwardFace=S.forwardFace?E(S.forwardFace):null,w.reversedFace=S.reversedFace?E(S.reversedFace):null,w.vertices=S.vertices.map(v),w.faces=S.faces.map(E)}),O.forEach(w=>{const S=C(w);w.edge=b(S.edge),w.reversed=m(S.reversed),w.next=m(S.next),w.previous=m(S.previous),w.face=S.face?E(S.face):null});super({edges:B,vertices:f,faces:P,halfEdges:O,outerBoundary:e.outerBoundary.map(m),innerBoundaries:e.innerBoundaries.map(w=>w.map(m))});L(this,"edgeStateMap",new Map);L(this,"faceValueMap",new Map);this.originalBoard=e,this.originalState=t,B.forEach(w=>{this.edgeStateMap.set(w,t.getEdgeState(g(w)))}),P.forEach(w=>{this.faceValueMap.set(w,t.getFaceValue(d(w)))}),k()&&ht(this)}getFaceValue(e){const t=this.faceValueMap.get(e);return k()&&N(t!==void 0),t}getEdgeState(e){const t=this.edgeStateMap.get(e);return k()&&N(t!==void 0),t}clearSatisfiedFaces(){this.faces.forEach(e=>{const t=this.getFaceValue(e);if(t===null)return;let o=0,r=0;e.edges.forEach(a=>{const s=this.getEdgeState(a);s===ee.WHITE?o++:s===ee.BLACK&&r++}),o===0&&r===t&&this.faceValueMap.set(e,null)})}removeDeadRedEdges(){const e=new Set(this.edges.filter(s=>this.getEdgeState(s)===ee.RED&&s.faces.every(i=>i===null||this.getFaceValue(i)===null))),t=new Set(this.vertices.filter(s=>s.edges.every(i=>e.has(i)))),o=new Set(this.faces.filter(s=>s.edges.some(i=>e.has(i)))),r=[],a=new Set(o);for(;a.size;){const s=a.values().next().value;a.delete(s);const i=[s];let p=!1;for(let d=0;d<i.length;d++){const g=i[d];g.edges.forEach(C=>{e.has(C)&&[C.forwardFace,C.reversedFace].forEach(f=>{if(f!==g){if(f===null){p=!0;return}a.has(f)&&(a.delete(f),i.push(f))}})})}const c=new Set(i.flatMap(d=>d.halfEdges)),u=new Set(i.flatMap(d=>d.halfEdges.map(g=>g.reversed))),v=new Set([...c].filter(d=>!u.has(d))),E=d=>{let g=d.next;for(;g!==d&&!v.has(g);)g=g.reversed.next;return k()&&N(g!==d),g},b=v.values().next().value,m=[b];let F=E(b);for(;F!==b;)m.push(F),F=E(F);if(k()&&N(m.length===v.size),p){const d=[];for(let g=0;g<m.length;g++){const C=m[g],f=m[(g+m.length-1)%m.length];if(k()&&N(f.end===C.start),!e.has(C.edge)&&e.has(f.edge)){const P=[C];for(let O=g+1;;O++){const B=m[O%m.length];if(e.has(B.edge))break;P.push(B)}d.push(P)}}r.push(new Yr(i,m,d))}else r.push(new ao(i,m))}r.forEach(s=>{if(s instanceof ao){const i=s.boundaryHalfEdges.map(u=>u.start),p=s.boundaryHalfEdges.map(u=>u.edge),c=new so(Ae(i.map(u=>u.viewCoordinates)),Ae(i.map(u=>u.logicalCoordinates)));this.faces.push(c),this.faceValueMap.set(c,null),c.halfEdges=s.boundaryHalfEdges,c.edges=p,c.vertices=i;for(let u=0;u<s.boundaryHalfEdges.length;u++){const v=s.boundaryHalfEdges[u],E=v.face;v.face=c;const b=v.edge;v.isReversed?b.reversedFace=c:b.forwardFace=c,k()&&N(E),E&&W(b.faces,E),b.faces.push(c)}}else s.boundarySegments.forEach(i=>{i.forEach(p=>{const c=p.edge,u=p.face;u&&(p.face=null,W(c.faces,u)),p.isReversed?c.reversedFace=null:c.forwardFace=null})})}),e.forEach(s=>{W(this.edges,s),W(this.halfEdges,s.forwardHalf),W(this.halfEdges,s.reversedHalf)}),t.forEach(s=>{W(this.vertices,s)}),o.forEach(s=>{W(this.faces,s)}),this.vertices.forEach(s=>{s.edges=s.edges.filter(i=>!e.has(i)),s.incomingHalfEdges=s.incomingHalfEdges.filter(i=>!e.has(i.edge)),s.outgoingHalfEdges=s.outgoingHalfEdges.filter(i=>!e.has(i.edge)),s.faces=s.incomingHalfEdges.map(i=>i.face).filter(i=>i!==null);for(let i=0;i<s.incomingHalfEdges.length;i++){const p=s.outgoingHalfEdges[i],c=s.incomingHalfEdges[(i+1)%s.incomingHalfEdges.length];c.next=p,p.previous=c}}),k()&&ht(this)}removeSimpleForced(){this.vertices.slice().forEach(e=>{if(e.edges.length!==2||ve.uniq(e.edges.flatMap(C=>C.faces)).some(C=>this.getFaceValue(C)!==null))return;const o=e.edges[0],r=e.edges[1],a=this.getEdgeState(o),s=this.getEdgeState(r);if(a!==s)return;const i=o.getOtherVertex(e),p=r.getOtherVertex(e);if(i===p)return;const c=o.forwardHalf.end===e?o.forwardHalf:o.reversedHalf,u=o.forwardHalf.end===e?o.reversedHalf:o.forwardHalf,v=r.forwardHalf.start===e?r.forwardHalf:r.reversedHalf,E=r.forwardHalf.start===e?r.reversedHalf:r.forwardHalf,b=c.face,m=u.face,F=new ro(i,p);o.originalEdges.forEach(C=>F.originalEdges.add(C)),r.originalEdges.forEach(C=>F.originalEdges.add(C)),this.edgeStateMap.set(F,a),this.edges.push(F);const d=new tt(i,p,!1);this.halfEdges.push(d);const g=new tt(p,i,!0);if(this.halfEdges.push(g),F.forwardHalf=d,F.reversedHalf=g,F.forwardFace=b,F.reversedFace=m,F.vertices=[i,p],F.faces=[b,m].filter(C=>C!==null),d.edge=F,d.reversed=g,d.next=v.next,d.previous=c.previous,d.face=b,g.edge=F,g.reversed=d,g.next=u.next,g.previous=E.previous,g.face=m,b){const C=b.halfEdges.indexOf(c),f=b.edges.indexOf(o);k()&&N(C!==-1),k()&&N(f!==-1),b.halfEdges[C]=d,W(b.halfEdges,v),b.edges[f]=F,W(b.edges,r),W(b.vertices,e)}if(m){const C=m.halfEdges.indexOf(E),f=m.edges.indexOf(r);k()&&N(C!==-1),k()&&N(f!==-1),m.halfEdges[C]=g,W(m.halfEdges,u),m.edges[f]=F,W(m.edges,o),W(m.vertices,e)}{const C=i.incomingHalfEdges.indexOf(u),f=i.outgoingHalfEdges.indexOf(c),P=i.edges.indexOf(o);k()&&N(C!==-1),k()&&N(f!==-1),k()&&N(P!==-1),i.incomingHalfEdges[C]=g,i.outgoingHalfEdges[f]=d,i.edges[P]=F}{const C=p.incomingHalfEdges.indexOf(v),f=p.outgoingHalfEdges.indexOf(E),P=p.edges.indexOf(r);k()&&N(C!==-1),k()&&N(f!==-1),k()&&N(P!==-1),p.incomingHalfEdges[C]=d,p.outgoingHalfEdges[f]=g,p.edges[P]=F}d.previous.next=d,d.next.previous=d,g.previous.next=g,g.next.previous=g,W(this.edges,o),W(this.edges,r),W(this.halfEdges,o.forwardHalf),W(this.halfEdges,o.reversedHalf),W(this.halfEdges,r.forwardHalf),W(this.halfEdges,r.reversedHalf),W(this.vertices,e)}),k()&&ht(this)}simplify(){this.clearSatisfiedFaces(),this.removeDeadRedEdges(),this.removeSimpleForced()}fixOuterBoundary(){const e=new Set(this.halfEdges.filter(r=>r.face===null)),t=[],o=[];for(;e.size;){const r=e.values().next().value;e.delete(r);const a=[r];let s=r.next;for(;s!==r;)a.push(s),e.delete(s),s=s.next;zt(a.map(i=>i.start.viewCoordinates))<0?t.push(a):o.push(a)}k()&&N(t.length===1),this.outerBoundary.length=0,this.outerBoundary.push(...t[0]),this.innerBoundaries.length=0,this.innerBoundaries.push(...o)}getCompleteState(){this.fixOuterBoundary();const e=bo.fromFacesEdges(this,t=>this.getFaceValue(t),t=>this.getEdgeState(t));return Ve(this,e),e}getCompletePuzzle(){return{board:this,state:this.getCompleteState()}}getSignedArea(){let e=0;return this.faces.forEach(t=>{e+=zt(t.vertices.map(o=>o.viewCoordinates))}),e}getCentroid(){let e=0,t=0,o=0;return this.halfEdges.forEach(r=>{if(r.face===null){const a=r.end.viewCoordinates,s=r.start.viewCoordinates;e+=(s.x+a.x)*(s.y-a.y);const i=a.x*(2*a.y+s.y)+s.x*(a.y+2*s.y);t+=(a.x-s.x)*i,o+=(s.y-a.y)*i}}),e*=.5,new le(t,o).timesScalar(1/(6*e))}applyDerivative(e){this.vertices.forEach(t=>{const o=e.derivatives.get(t);k()&&N(o),k()&&N(o.isFinite()),t.viewCoordinates.add(o)}),this.fixFaceCoordinates()}fixFaceCoordinates(){this.faces.forEach(e=>{e.viewCoordinates.set(Ae(e.halfEdges.map(t=>t.start.viewCoordinates)))})}getDebugNode(){const e=new I;return this.edges.forEach(t=>{const o=t.start.viewCoordinates,r=t.end.viewCoordinates;let a,s;const i=this.edgeStateMap.get(t);i===ee.WHITE?(a=h.blackLineColorProperty,s=.02):i===ee.BLACK?(a=Dr(Math.random()*360,.7,.55),s=.1):(a=null,s=.02),e.addChild(new At(o,r,{stroke:a,lineWidth:s,lineCap:"round"}))}),this.faces.forEach(t=>{const o=this.faceValueMap.get(t)??null;o!==null&&e.addChild(new X(o,{maxWidth:.9,maxHeight:.9,center:t.viewCoordinates,fill:h.faceValueColorProperty}))}),e}}const Ts=l=>({board:l.board,stateProperty:new Dt(l.state)});class Ms extends I{constructor(e,t){const o=new I;let r=null;const a=()=>{const i=e.puzzle.board,p=e.puzzle.stateProperty.value;if(p.getSimpleRegions().some(d=>d.isSolved))return;const c=new zs(i,p);c.simplify();const u=()=>Z.getAngularDeltas(c,.2).plus(Z.getHookesAttraction(c,1,.1)).plus(Z.getRegularPolygonDeltas(c,1,!0,.2));let v=.3;for(let d=0;d<40;d++){d%10===0&&(v*=.95);let g=u();{let C=g.getMaxMagnitude(),f=v;v*C>1.5&&(f=1.5/C),g=g.timesScalar(f)}if(c.applyDerivative(g),g.getMaxMagnitude()<.015)break}const E=c.getCompletePuzzle();r&&r.dispose();const b=new Ne(Ts(E),{edgePressListener:(d,g)=>{const C=d.originalEdges;C&&e.onUserEdgePress(C.values().next().value,g)},facePressListener:(d,g)=>{if(d===null)e.onUserFacePress(null,g);else{const C=d.originalFace;C&&e.onUserFacePress(C,g)}}});this.puzzleNode=b,r=b;const m=new I({children:[b]}),F=600;m.scale(Math.min(F/m.width,F/m.height)),m.left=20,m.top=130,o.children=[m]},s=()=>{o.children=[],a()};e.puzzle.stateProperty.link(s);super(K({children:[o]},t));L(this,"puzzleNode");this.puzzleModel=e,this.disposeEmitter.addListener(()=>e.puzzle.stateProperty.unlink(s)),this.disposeEmitter.addListener(()=>o.dispose()),this.disposeEmitter.addListener(()=>r&&r.dispose())}}class ko extends Xo(I){constructor(e,t=Wt,o){const r=se()({topological:!1},o);super(r);L(this,"backgroundRect");L(this,"facePressRect");L(this,"rectangularGradientRect");L(this,"circularGradientRect");L(this,"puzzleWrapper");L(this,"puzzleNode",null);L(this,"zoomListener");this.puzzleModelProperty=e,this.style=t,this.backgroundRect=new G({fill:t.theme.playAreaBackgroundColorProperty,pickable:!0}),this.facePressRect=new G({fill:null,pickableProperty:Fn}),Ln(this.facePressRect,s=>{var i;(i=e.value)==null||i.onUserFacePress(null,s)},s=>{var i;(i=this.puzzleNode)==null||i.puzzleNode.onFaceBackgroundDragStart(s)}),this.rectangularGradientRect=new G({pickable:!1}),this.circularGradientRect=new G({pickable:!1}),this.puzzleWrapper=new I({children:[this.backgroundRect,this.facePressRect,this.rectangularGradientRect,this.circularGradientRect]}),this.zoomListener=new Yo(this.puzzleWrapper,{maxScale:10}),this.addInputListener(this.zoomListener),this.addChild(this.puzzleWrapper);const a=this.updateLayout.bind(this);this.localPreferredWidthProperty.lazyLink(a),this.localPreferredHeightProperty.lazyLink(a),r.topological&&this.puzzleWrapper.localBoundsProperty.lazyLink(a),it.multilink([e,Gt],(s,i)=>{this.puzzleNode&&(this.puzzleNode.dispose(),this.puzzleNode=null),s&&(r.topological?i&&(this.puzzleNode=new Ms(s)):this.puzzleNode=new As(s,{focusNodeCallback:p=>{this.zoomListener.panToNode(p,!0)}}),this.puzzleNode&&(this.updatePuzzleNodeLayout(this.puzzleNode),this.puzzleWrapper.children=[this.backgroundRect,this.facePressRect,this.rectangularGradientRect,this.circularGradientRect,this.puzzleNode])),this.zoomListener.resetTransform(),this.updateLayout()})}step(e){this.zoomListener.step(2*e)}updateLayout(){const e=this.localPreferredWidth,t=this.localPreferredHeight;if(e!==null&&(this.backgroundRect.rectWidth=e,this.facePressRect.rectWidth=e,this.rectangularGradientRect.rectWidth=e,this.circularGradientRect.rectWidth=e),t!==null&&(this.backgroundRect.rectHeight=t,this.facePressRect.rectHeight=t,this.rectangularGradientRect.rectHeight=t,this.circularGradientRect.rectHeight=t),this.puzzleNode&&this.updatePuzzleNodeLayout(this.puzzleNode),e!==null&&t!==null&&e>0&&t>0){const o=new st(0,0,e,t),r=o.center,a=r.getMagnitude();this.rectangularGradientRect.fill=new Jo(0,0,0,t).addColorStop(0,this.style.theme.playAreaLinearTopColorProperty).addColorStop(.5,this.style.theme.playAreaLinearMiddleColorProperty).addColorStop(1,this.style.theme.playAreaLinearBottomColorProperty),this.circularGradientRect.fill=new Zo(r.x,r.y,a,r.x,r.y,0).addColorStop(0,this.style.theme.playAreaRadialOutsideColorProperty).addColorStop(1,this.style.theme.playAreaRadialInsideColorProperty),this.clipArea=T.bounds(o),this.zoomListener.setTargetBounds(o),this.zoomListener.setPanBounds(o)}else{const o=new st(0,0,5,5);this.zoomListener.setTargetBounds(o),this.zoomListener.setPanBounds(o)}}updatePuzzleNodeLayout(e){const t=this.localPreferredWidth,o=this.localPreferredHeight;if(t!==null&&o!==null&&t>0&&o>0){const a=t-40,s=o-20*2;if(e.localBounds.isValid()){const i=e.localBounds.width,p=e.localBounds.height,c=Math.min(a/i,s/p);e.setScaleMagnitude(c),e.center=new le(t/2,o/2)}}}}class Rs{constructor(n,e,t){this.layoutBoundsProperty=n,this.glassPane=e,this.stepEmitter=t}}const Io=new I,Ge=new I;self.assertions;const Hs=new I({renderer:"svg",children:[Ge]}),Te=new Ko(Hs,{allowWebGL:!0,allowBackingScaleAntialiasing:!0,allowSceneOverflow:!1,accessibility:!0,backgroundColor:"#eee",assumeFullWindow:!0,listenToOnlyElement:lt.debugColors});document.body.appendChild(Te.domElement);Te.setPointerAreaDisplayVisible(lt.showPointerAreas);self.oncontextmenu=l=>l.preventDefault();const Xt=new Dt(new st(0,0,self.innerWidth,self.innerHeight)),te=new Ee(Jr()),No=new ko(te,Wt,{layoutOptions:{stretch:!0,grow:1}}),xo=new ko(te,Wt,{layoutOptions:{stretch:!0,grow:1},topological:!0,visibleProperty:Gt}),Vs=new Ie(te,{derive:l=>l?l.hintStateProperty:new Ee(Pe.DEFAULT)});it.multilink([h.navbarBackgroundColorProperty],l=>{Te.backgroundColor=l});const Oo=new He,dt=new Rs(Xt,Io,Oo),Bo=new Is(te,dt,{loadPuzzle:l=>{const n=Vt(l.board,l.stateProperty.value);n&&(te.value=new po(n))}}),Ds=new ct(dt),qs=new We(dt),Ao=new Os(dt,Vs,()=>{var l;(l=te.value)==null||l.onUserApplyHint()},()=>{var l;(l=te.value)==null||l.onUserClearHint()}),Oe=new q({stretch:!0,children:[new ot(Bo,{margin:ze}),new M({grow:1,stretch:!0,layoutOptions:{grow:1},children:[No,xo]}),new ot(qs,{margin:ze,visibleProperty:vo}),new ot(Ds,{margin:ze})]});Xt.lazyLink(l=>{Oe.preferredWidth=l.width,Oe.preferredHeight=l.height,Oe.x=l.left,Oe.y=l.top});Ge.addChild(Oe);Ge.addChild(Ao);Ge.addChild(Io);Qo.create(Ge,[Bo,Ao],(l,n)=>{n.centerTop=l.centerBottom.plusXY(0,5)});Te.initializeEvents();let Yt=!0;const zo=()=>{Yt=!1;const l=new st(0,0,self.innerWidth,self.innerHeight);Te.setWidthHeight(l.width,l.height),Xt.value=l,hn.mobileSafari&&self.scrollTo(0,0)},ut=()=>{Yt=!0};$(self).resize(ut);self.addEventListener("resize",ut);self.addEventListener("orientationchange",ut);self.visualViewport&&self.visualViewport.addEventListener("resize",ut);zo();Te.updateOnRequestAnimationFrame(l=>{var n;ur(),Yt&&zo(),Oe.validateBounds(),No.step(l),xo.step(l),(n=te.value)==null||n.step(l),Oo.emit(l)});document.addEventListener("keydown",l=>{var n,e,t,o;if(l.ctrlKey||l.metaKey)l.key==="z"&&(l.shiftKey?(n=te.value)==null||n.onUserRedo():(e=te.value)==null||e.onUserUndo()),l.key==="y"&&((t=te.value)==null||t.onUserRedo());else if(["1","2","3","4","5","6","7","8","9"].includes(l.key)){const r=Number.parseInt(l.key,10)-1,a=Q.enumeration.values.filter(s=>s.isEnabledProperty.value);r<a.length&&kn(a[r])}else l.key==="Escape"&&((o=te.value)==null||o.onUserEscape())});at.keydownEmitter.addListener(l=>{l.key==="e"&&(Ut.value=!0)});at.keyupEmitter.addListener(l=>{l.key==="e"&&(Ut.value=!1)});let lo=!1;at.keyDownStateChangedEmitter.addListener(()=>{const l=at.isEnglishKeyDown("space");l!==lo&&(lo=l,xe.value=xe.value===fe.PAN_ONLY?fe.DRAG_ONLY:fe.PAN_ONLY)});te.lazyLink((l,n)=>{n&&n.dispose()});
