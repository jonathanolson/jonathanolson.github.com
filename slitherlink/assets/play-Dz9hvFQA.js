var $t=Object.defineProperty;var _t=(l,o,e)=>o in l?$t(l,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[o]=e;var z=(l,o,e)=>(_t(l,typeof o!="symbol"?o+"":o,e),e);import{o as Q,c as X,a as I,V as te,D as ue,M as Ue,S as eo,b as Et,P as nt,B as Ae,d as Ye,T as le,E as to,e as oo,f as ve}from"./UnivariatePolynomial-CzQEP6td.js";import{s as no}from"./scanURL-Dd3F3Jkc.js";import{B as ro,a as so,b as ao,c as io,d as lo,e as k,f as N,g as We,h as ye,_ as he,i as Ze,j as co,S as O,P as uo,k as po}from"./patternBoards-7WmHeiIn.js";import{N as L,L as Qe,T as V,S as ho,R as D,A as go,M as rt,a as fo,b as wo,c as Ie,V as U,H as R,P as Y,s as pt,d as de,e as yo,G as ht,B as Me,f as gt,g as je,I as ft,h as ae,D as mo,i as Po,j as kt}from"./PhetioControlledVisibilityProperty-C87s29LU.js";import{L as Ft,P as be,C as Co,V as vo,T as Te,O as So,R as bo,a as Eo,b as ko,c as pe,B as Fo}from"./TextPushButton-B0wSyc3V.js";import{S as Oe}from"./SlitherQueryParameters-CBL8UsTw.js";import{P as ge,s as Se,i as No,h as Lo,f as st,U as T,p as Nt,j as Lt,k as xt,l as Bt,m as zt,n as It,o as Tt,v as $e,q as _e,r as At,V as xo,F as Bo,t as zo,u as Io,w as Mt,x as To,y as Ot,z as Rt,A as et,B as Ao,C as Mo,D as Oo,H as ie,G as Ht,I as Ro,J as M,K as at,L as ee}from"./DisplayEmbedding-BBo8Vgn-.js";import{A as Ho,p as xe,g as Vo,a as qo,i as Do,w as Uo}from"./polygonGenerators-DAiqVQxD.js";import{E as re,C as Vt,B as ce,s as Wo}from"./BasicPuzzle-B1djSMlq.js";import{c as f,o as Go,u as K,a as tt,r as fe,t as Xo,b as me,d as wt,e as Jo,p as Ko,f as yt,g as Yo,h as Zo,s as Ge,i as Qo,j as jo,v as mt,k as $o,m as _o,w as en,n as Pt,q as tn,x as on,y as nn,z as rn,A as sn,B as an,C as ln,D as cn,E as dn,F as un,G as pn,H as hn,I as gn,J as fn,K as wn,L as yn,M as Xe,N as mn,O as Je}from"./Theme-CMAJrJpo.js";import{A as Pn,N as Be,S as Cn}from"./SpinningIndicatorNode-Cnu8VvuS.js";import{a as vn,b as Sn,c as bn,d as En,e as kn,f as Fn,g as Nn,h as Ln,i as xn,j as Bn,k as zn,l as In,m as Tn,n as An,o as Mn,p as On,q as Rn,r as Hn,s as Vn,t as qn,u as Dn,v as Un,w as Wn,x as Gn,y as Xn,z as Ke,A as Jn,B as Kn,C as Yn,D as Zn,E as ot}from"./SATSolver-CcH7PLXT.js";import{p as qt}from"./puzzleFromCompressedString-CFPrevsw.js";import{U as Qn}from"./UIAquaRadioButtonGroup-BPqnSB9n.js";import"./compression-L63-wCoo.js";import"./PatternRule-DJzvheEf.js";import"./PatternBoardSolver-D5oFTW2t.js";class jn extends L{constructor(o,e){const t=Q()({focusNodeCallback:()=>{}},e),n=new ge(o.puzzle,{edgePressListener:(s,a)=>{o.onUserEdgePress(s,a)},facePressListener:(s,a)=>{o.onUserFacePress(s,a)},sectorPressListener:(s,a)=>{o.onUserSectorPress(s,a)},sectorSetListener:(s,a)=>{o.onUserSectorSet(s,a)},selectedFaceColorHighlightProperty:o.selectedFaceColorHighlightProperty,selectedSectorEditProperty:o.selectedSectorEditProperty,style:o.style,delayEdgeInteractionEmitter:o.edgeAutoSolvedEmitter});super(X({children:[n]},t)),this.puzzleModel=o,this.disposeEmitter.addListener(()=>n.dispose());let r=null;const c=s=>{if(n.clearAnnotationNodes(),r&&(r.dispose(),r=null),s){const a=new Ho(o.puzzle.board,s,o.style,n.getBackgroundBounds());n.addAnnotationNode(a),r=a,t.focusNodeCallback(a)}};this.disposeEmitter.addListener(()=>{r&&(r.dispose(),r=null)}),o.displayedAnnotationProperty.link(c),this.disposeEmitter.addListener(()=>o.displayedAnnotationProperty.unlink(c))}}const it=new Ft("showLayoutTestProperty",!1);class ze extends ro{constructor(o,e,t){super(o,e,t)}}class Ct extends so{constructor(e,t){super(e,t);z(this,"originalEdges",new Set)}}class vt extends ao{constructor(e,t){super(e.copy(),t.copy());z(this,"originalFace",null)}}class $n extends io{constructor(o,e){super(o.copy(),e.copy())}}class St{constructor(o,e){this.faces=o,this.boundaryHalfEdges=e}}class _n{constructor(o,e,t){this.faces=o,this.boundaryHalfEdges=e,this.boundarySegments=t}}class er extends lo{constructor(e,t){const n=new Map,r=new Map,c=new Map,s=new Map,a=new Map,p=new Map,g=new Map,h=new Map,C=u=>{const y=n.get(u);return k()&&N(y),y},E=u=>{const y=r.get(u);return k()&&N(y),y},v=u=>{const y=c.get(u);return k()&&N(y),y},w=u=>{const y=s.get(u);return k()&&N(y),y},P=u=>{const y=a.get(u);return k()&&N(y),y},i=u=>{const y=p.get(u);return k()&&N(y),y},d=u=>{const y=g.get(u);return k()&&N(y),y},b=u=>{const y=h.get(u);return k()&&N(y),y},m=e.vertices.map(u=>{const y=new $n(u.logicalCoordinates,u.viewCoordinates);return n.set(u,y),a.set(y,u),y}),S=e.faces.map(u=>{const y=new vt(u.logicalCoordinates,u.viewCoordinates);return r.set(u,y),p.set(y,u),y.originalFace=u,y}),x=[],B=e.edges.map(u=>{const y=n.get(u.start),j=n.get(u.end);k()&&N(y),k()&&N(j);const _=new Ct(y,j);_.originalEdges.add(u),c.set(u,_),g.set(_,u);const A=new ze(y,j,!1);s.set(u.forwardHalf,A),h.set(A,u.forwardHalf),x.push(A);const H=new ze(j,y,!0);return s.set(u.reversedHalf,H),h.set(H,u.reversedHalf),x.push(H),_});m.forEach(u=>{const y=P(u);u.incomingHalfEdges=y.incomingHalfEdges.map(w),u.outgoingHalfEdges=y.outgoingHalfEdges.map(w),u.edges=y.edges.map(v),u.faces=y.faces.map(E)}),S.forEach(u=>{const y=i(u);u.halfEdges=y.halfEdges.map(w),u.edges=y.edges.map(v),u.vertices=y.vertices.map(C)}),B.forEach(u=>{const y=d(u);u.forwardHalf=w(y.forwardHalf),u.reversedHalf=w(y.reversedHalf),u.forwardFace=y.forwardFace?E(y.forwardFace):null,u.reversedFace=y.reversedFace?E(y.reversedFace):null,u.vertices=y.vertices.map(C),u.faces=y.faces.map(E)}),x.forEach(u=>{const y=b(u);u.edge=v(y.edge),u.reversed=w(y.reversed),u.next=w(y.next),u.previous=w(y.previous),u.face=y.face?E(y.face):null});super({edges:B,vertices:m,faces:S,halfEdges:x,outerBoundary:e.outerBoundary.map(w),innerBoundaries:e.innerBoundaries.map(u=>u.map(w))});z(this,"edgeStateMap",new Map);z(this,"faceValueMap",new Map);this.originalBoard=e,this.originalState=t,B.forEach(u=>{this.edgeStateMap.set(u,t.getEdgeState(d(u)))}),S.forEach(u=>{this.faceValueMap.set(u,t.getFaceValue(i(u)))}),k()&&We(this)}getFaceValue(e){const t=this.faceValueMap.get(e);return k()&&N(t!==void 0),t}getEdgeState(e){const t=this.edgeStateMap.get(e);return k()&&N(t!==void 0),t}clearSatisfiedFaces(){this.faces.forEach(e=>{const t=this.getFaceValue(e);if(t===null)return;let n=0,r=0;e.edges.forEach(c=>{const s=this.getEdgeState(c);s===re.WHITE?n++:s===re.BLACK&&r++}),n===0&&r===t&&this.faceValueMap.set(e,null)})}removeDeadRedEdges(){const e=new Set(this.edges.filter(s=>this.getEdgeState(s)===re.RED&&s.faces.every(a=>a===null||this.getFaceValue(a)===null))),t=new Set(this.vertices.filter(s=>s.edges.every(a=>e.has(a)))),n=new Set(this.faces.filter(s=>s.edges.some(a=>e.has(a)))),r=[],c=new Set(n);for(;c.size;){const s=c.values().next().value;c.delete(s);const a=[s];let p=!1;for(let i=0;i<a.length;i++){const d=a[i];d.edges.forEach(b=>{e.has(b)&&[b.forwardFace,b.reversedFace].forEach(m=>{if(m!==d){if(m===null){p=!0;return}c.has(m)&&(c.delete(m),a.push(m))}})})}const g=new Set(a.flatMap(i=>i.halfEdges)),h=new Set(a.flatMap(i=>i.halfEdges.map(d=>d.reversed))),C=new Set([...g].filter(i=>!h.has(i))),E=i=>{let d=i.next;for(;d!==i&&!C.has(d);)d=d.reversed.next;return k()&&N(d!==i),d},v=C.values().next().value,w=[v];let P=E(v);for(;P!==v;)w.push(P),P=E(P);if(k()&&N(w.length===C.size),p){const i=[];for(let d=0;d<w.length;d++){const b=w[d],m=w[(d+w.length-1)%w.length];if(k()&&N(m.end===b.start),!e.has(b.edge)&&e.has(m.edge)){const S=[b];for(let x=d+1;;x++){const B=w[x%w.length];if(e.has(B.edge))break;S.push(B)}i.push(S)}}r.push(new _n(a,w,i))}else r.push(new St(a,w))}r.forEach(s=>{if(s instanceof St){const a=s.boundaryHalfEdges.map(h=>h.start),p=s.boundaryHalfEdges.map(h=>h.edge),g=new vt(ye(a.map(h=>h.viewCoordinates)),ye(a.map(h=>h.logicalCoordinates)));this.faces.push(g),this.faceValueMap.set(g,null),g.halfEdges=s.boundaryHalfEdges,g.edges=p,g.vertices=a;for(let h=0;h<s.boundaryHalfEdges.length;h++){const C=s.boundaryHalfEdges[h],E=C.face;C.face=g;const v=C.edge;C.isReversed?v.reversedFace=g:v.forwardFace=g,k()&&N(E),E&&I(v.faces,E),v.faces.push(g)}}else s.boundarySegments.forEach(a=>{a.forEach(p=>{const g=p.edge,h=p.face;h&&(p.face=null,I(g.faces,h)),p.isReversed?g.reversedFace=null:g.forwardFace=null})})}),e.forEach(s=>{I(this.edges,s),I(this.halfEdges,s.forwardHalf),I(this.halfEdges,s.reversedHalf)}),t.forEach(s=>{I(this.vertices,s)}),n.forEach(s=>{I(this.faces,s)}),this.vertices.forEach(s=>{s.edges=s.edges.filter(a=>!e.has(a)),s.incomingHalfEdges=s.incomingHalfEdges.filter(a=>!e.has(a.edge)),s.outgoingHalfEdges=s.outgoingHalfEdges.filter(a=>!e.has(a.edge)),s.faces=s.incomingHalfEdges.map(a=>a.face).filter(a=>a!==null);for(let a=0;a<s.incomingHalfEdges.length;a++){const p=s.outgoingHalfEdges[a],g=s.incomingHalfEdges[(a+1)%s.incomingHalfEdges.length];g.next=p,p.previous=g}}),k()&&We(this)}removeSimpleForced(){this.vertices.slice().forEach(e=>{if(e.edges.length!==2||he.uniq(e.edges.flatMap(b=>b.faces)).some(b=>this.getFaceValue(b)!==null))return;const n=e.edges[0],r=e.edges[1],c=this.getEdgeState(n),s=this.getEdgeState(r);if(c!==s)return;const a=n.getOtherVertex(e),p=r.getOtherVertex(e);if(a===p)return;const g=n.forwardHalf.end===e?n.forwardHalf:n.reversedHalf,h=n.forwardHalf.end===e?n.reversedHalf:n.forwardHalf,C=r.forwardHalf.start===e?r.forwardHalf:r.reversedHalf,E=r.forwardHalf.start===e?r.reversedHalf:r.forwardHalf,v=g.face,w=h.face,P=new Ct(a,p);n.originalEdges.forEach(b=>P.originalEdges.add(b)),r.originalEdges.forEach(b=>P.originalEdges.add(b)),this.edgeStateMap.set(P,c),this.edges.push(P);const i=new ze(a,p,!1);this.halfEdges.push(i);const d=new ze(p,a,!0);if(this.halfEdges.push(d),P.forwardHalf=i,P.reversedHalf=d,P.forwardFace=v,P.reversedFace=w,P.vertices=[a,p],P.faces=[v,w].filter(b=>b!==null),i.edge=P,i.reversed=d,i.next=C.next,i.previous=g.previous,i.face=v,d.edge=P,d.reversed=i,d.next=h.next,d.previous=E.previous,d.face=w,v){const b=v.halfEdges.indexOf(g),m=v.edges.indexOf(n);k()&&N(b!==-1),k()&&N(m!==-1),v.halfEdges[b]=i,I(v.halfEdges,C),v.edges[m]=P,I(v.edges,r),I(v.vertices,e)}if(w){const b=w.halfEdges.indexOf(E),m=w.edges.indexOf(r);k()&&N(b!==-1),k()&&N(m!==-1),w.halfEdges[b]=d,I(w.halfEdges,h),w.edges[m]=P,I(w.edges,n),I(w.vertices,e)}{const b=a.incomingHalfEdges.indexOf(h),m=a.outgoingHalfEdges.indexOf(g),S=a.edges.indexOf(n);k()&&N(b!==-1),k()&&N(m!==-1),k()&&N(S!==-1),a.incomingHalfEdges[b]=d,a.outgoingHalfEdges[m]=i,a.edges[S]=P}{const b=p.incomingHalfEdges.indexOf(C),m=p.outgoingHalfEdges.indexOf(E),S=p.edges.indexOf(r);k()&&N(b!==-1),k()&&N(m!==-1),k()&&N(S!==-1),p.incomingHalfEdges[b]=i,p.outgoingHalfEdges[m]=d,p.edges[S]=P}i.previous.next=i,i.next.previous=i,d.previous.next=d,d.next.previous=d,I(this.edges,n),I(this.edges,r),I(this.halfEdges,n.forwardHalf),I(this.halfEdges,n.reversedHalf),I(this.halfEdges,r.forwardHalf),I(this.halfEdges,r.reversedHalf),I(this.vertices,e)}),k()&&We(this)}simplify(){this.clearSatisfiedFaces(),this.removeDeadRedEdges(),this.removeSimpleForced()}fixOuterBoundary(){const e=new Set(this.halfEdges.filter(r=>r.face===null)),t=[],n=[];for(;e.size;){const r=e.values().next().value;e.delete(r);const c=[r];let s=r.next;for(;s!==r;)c.push(s),e.delete(s),s=s.next;Ze(c.map(a=>a.start.viewCoordinates))<0?t.push(c):n.push(c)}k()&&N(t.length===1),this.outerBoundary.length=0,this.outerBoundary.push(...t[0]),this.innerBoundaries.length=0,this.innerBoundaries.push(...n)}getCompleteState(){this.fixOuterBoundary();const e=Vt.fromFacesEdges(this,t=>this.getFaceValue(t),t=>this.getEdgeState(t));return Se(this,e),e}getCompletePuzzle(){return{board:this,state:this.getCompleteState()}}getSignedArea(){let e=0;return this.faces.forEach(t=>{e+=Ze(t.vertices.map(n=>n.viewCoordinates))}),e}getCentroid(){let e=0,t=0,n=0;return this.halfEdges.forEach(r=>{if(r.face===null){const c=r.end.viewCoordinates,s=r.start.viewCoordinates;e+=(s.x+c.x)*(s.y-c.y);const a=c.x*(2*c.y+s.y)+s.x*(c.y+2*s.y);t+=(c.x-s.x)*a,n+=(s.y-c.y)*a}}),e*=.5,new te(t,n).timesScalar(1/(6*e))}applyDerivative(e){this.vertices.forEach(t=>{const n=e.derivatives.get(t);k()&&N(n),k()&&N(n.isFinite()),t.viewCoordinates.add(n)}),this.fixFaceCoordinates()}fixFaceCoordinates(){this.faces.forEach(e=>{e.viewCoordinates.set(ye(e.halfEdges.map(t=>t.start.viewCoordinates)))})}getDebugNode(){const e=new L;return this.edges.forEach(t=>{const n=t.start.viewCoordinates,r=t.end.viewCoordinates;let c,s;const a=this.edgeStateMap.get(t);a===re.WHITE?(c=f.blackLineColorProperty,s=.02):a===re.BLACK?(c=Go(Math.random()*360,.7,.55),s=.1):(c=null,s=.02),e.addChild(new Qe(n,r,{stroke:c,lineWidth:s,lineCap:"round"}))}),this.faces.forEach(t=>{const n=this.faceValueMap.get(t)??null;n!==null&&e.addChild(new V(n,{maxWidth:.9,maxHeight:.9,center:t.viewCoordinates,fill:f.faceValueColorProperty}))}),e}}class W{constructor(o,e){this.layoutPuzzle=o,this.derivatives=e}plus(o){const e=new Map;return this.derivatives.forEach((t,n)=>{e.set(n,t.plus(o.derivatives.get(n)))}),new W(this.layoutPuzzle,e)}minus(o){const e=new Map;return this.derivatives.forEach((t,n)=>{e.set(n,t.minus(o.derivatives.get(n)))}),new W(this.layoutPuzzle,e)}timesScalar(o){const e=new Map;return this.derivatives.forEach((t,n)=>{e.set(n,t.timesScalar(o))}),new W(this.layoutPuzzle,e)}getMaxMagnitude(){let o=0;return this.derivatives.forEach(e=>{o=Math.max(o,e.getMagnitude())}),o}getAreaCorrectedDerivative(){let o=this;for(let e=0;e<5;e++)o=o.getAreaCorrectedDerivativeOnce();return o}getAreaCorrectedDerivativeOnce(){return this.plus(W.getAreaScaledDeltas(this.layoutPuzzle,-this.getAreaDerivative()/this.layoutPuzzle.getSignedArea()))}getAreaDerivative(){let o=0;return this.layoutPuzzle.faces.forEach(e=>{o+=co(e.vertices.map(t=>t.viewCoordinates),e.vertices.map(t=>this.derivatives.get(t)))}),o}getDebugNode(){const o=new L;return this.layoutPuzzle.vertices.forEach(e=>{const t=this.derivatives.get(e),n=e.viewCoordinates,r=new Pn(n.x,n.y,n.x+t.x,n.y+t.y,{lineWidth:.01,headHeight:.05,headWidth:.05,tailWidth:.005,fill:"green",stroke:"green"});o.addChild(r)}),o}static getAreaScaledDeltas(o,e){const t=o.getCentroid(),n=new Map;return o.vertices.forEach(r=>{const c=r.viewCoordinates.minus(t).timesScalar(e);k()&&N(c.isFinite()),n.set(r,c)}),new W(o,n)}static getHookesAttraction(o,e,t){const n=new Map;return o.vertices.forEach(r=>{n.set(r,te.ZERO.copy())}),o.edges.forEach(r=>{const c=r.start.viewCoordinates,a=r.end.viewCoordinates.minus(c),p=a.getMagnitude(),g=a.timesScalar((p-e)*t/p);k()&&N(g.isFinite()),n.get(r.start).add(g),n.get(r.end).subtract(g)}),new W(o,n)}static getRegularPolygonDeltas(o,e,t,n){const r=new Map;o.vertices.forEach(s=>{r.set(s,te.ZERO.copy())});const c=s=>e/(2*Math.sin(Math.PI/s));return o.faces.forEach(s=>{if(s.vertices.length<3)return;const a=.2,p=.3,g=s.vertices.map(m=>m.viewCoordinates);let h=0;const C=Ze(g);C<0?h=1:C<a&&(h=Math.max(h,(a-C)/a));for(let m=0;m<g.length&&!(h>=1);m++){const S=m,x=(m+1)%g.length,B=g[S],u=g[x];for(let y=m+2;y<g.length-(m===0?1:0)&&!(h>=1);y++){const j=y%g.length,_=(y+1)%g.length,A=g[j],H=g[_];if(ue.lineSegmentIntersection(B.x,B.y,u.x,u.y,A.x,A.y,H.x,H.y))k()&&N(g.length>=4),h=1;else{const Fe=Math.min(ue.distToSegment(B,A,H),ue.distToSegment(u,A,H),ue.distToSegment(A,B,u),ue.distToSegment(H,B,u));Fe<p&&(h=Math.max(h,(p-Fe)/p))}}}if(h===0&&t&&o.getFaceValue(s)===null)return;const E=ye(g);k()&&N(E.isFinite());const v=c(g.length),w=g.map(m=>m.minus(E)),P=g.map((m,S)=>te.createPolar(v,2*Math.PI*S/g.length)),i=W.getLeastSquares(w,P),d=n+(2-n)*h,b=g.map((m,S)=>i[S].minus(w[S]).timesScalar(d));s.vertices.forEach((m,S)=>{const x=b[S];k()&&N(x.isFinite()),r.get(m).add(x)})}),new W(o,r)}static getBarycentricDeltas(o){const e=new Map;return o.vertices.forEach(t=>{const n=t.edges.map(s=>s.getOtherVertex(t)),r=new te(0,0);n.forEach(s=>r.add(s.viewCoordinates)),r.multiplyScalar(1/n.length);const c=r.subtract(t.viewCoordinates);k()&&N(c.isFinite()),e.set(t,c)}),new W(o,e)}static getAngularDeltas(o,e){const t=new Map;return o.vertices.forEach(n=>{t.set(n,te.ZERO.copy())}),o.vertices.forEach(n=>{const r=n.edges.map(w=>w.getOtherVertex(n));let c=he.sortBy(r,w=>w.viewCoordinates.minus(n.viewCoordinates).getAngle());if(c[0]!==r[0]){const w=c.indexOf(r[0]);c=[...c.slice(w),...c.slice(0,w)]}const s=he.range(0,r.length).every(w=>c[w]===r[w]),a=r.map(w=>w.viewCoordinates.minus(n.viewCoordinates).normalized()),p=W.getUnitLeastSquares(a),g=Math.max(...he.range(0,r.length).map(w=>p[w].dot(p[(w+1)%r.length]))),h=Math.max(...he.range(0,r.length).map(w=>a[w].dot(a[(w+1)%r.length]))),C=(w,P)=>P<=.5?.5*Math.pow(2*P,w):1-C(w,1-P),E=s?ue.linear(g,1,0,1,h):1,v=.75;if(E>v){const w=(E-v)/(1-v),P=C(2,w),i=new te(0,0);for(let d=0;d<r.length;d++){const b=r[d],m=a[d],S=p[d],x=S.minus(m.timesScalar(S.dot(m))).timesScalar(P*e);i.add(x),k()&&N(x.isFinite()),t.get(b).add(x)}i.multiplyScalar(1/r.length);for(const d of r)k()&&N(i),t.get(d).subtract(i)}}),new W(o,t)}static getUnitLeastSquares(o){const e=o.length,t=he.range(0,e).map(n=>te.createPolar(1,2*Math.PI*n/e));return W.getLeastSquares(o,t)}static getLeastSquares(o,e){const t=o.length,n=new Ue(2,t,[...e.map(g=>g.x),...e.map(g=>g.y)]),r=new Ue(2,t,[...o.map(g=>g.x),...o.map(g=>g.y)]),c=n.times(r.transpose()),s=new eo(c);let a=s.getV().times(s.getU().transpose());a.det()<0&&(a=s.getV().times(Ue.diagonalMatrix([1,-1])).times(s.getU().transpose()));const p=new Et().rowMajor(a.get(0,0),a.get(0,1),0,a.get(1,0),a.get(1,1),0,0,0,1);return e.map(g=>{const h=p.timesVector2(g);return k()&&N(h.isFinite()),h})}}const tr=l=>({board:l.board,stateProperty:new nt(l.state)});class or extends L{constructor(o,e){const t=new L;let n=null;const r=()=>{const s=o.puzzle.board,a=o.puzzle.stateProperty.value;if(a.getSimpleRegions().some(P=>P.isSolved))return;const p=new er(s,a);p.simplify();const g=()=>W.getAngularDeltas(p,.2).plus(W.getHookesAttraction(p,1,.1)).plus(W.getRegularPolygonDeltas(p,1,!0,.2));let h=.3;for(let P=0;P<40;P++){P%10===0&&(h*=.95);let i=g();{let d=i.getMaxMagnitude(),b=h;h*d>1.5&&(b=1.5/d),i=i.timesScalar(b)}if(p.applyDerivative(i),i.getMaxMagnitude()<.015)break}const C=p.getCompletePuzzle();n&&n.dispose();const E=new ge(tr(C),{edgePressListener:(P,i)=>{const d=P.originalEdges;d&&o.onUserEdgePress(d.values().next().value,i)},facePressListener:(P,i)=>{if(P===null)o.onUserFacePress(null,i);else{const d=P.originalFace;d&&o.onUserFacePress(d,i)}}});n=E;const v=new L({children:[E]}),w=600;v.scale(Math.min(w/v.width,w/v.height)),v.left=20,v.top=130,t.children=[v]},c=()=>{t.children=[],r()};o.puzzle.stateProperty.link(c),super(X({children:[t]},e)),this.puzzleModel=o,this.disposeEmitter.addListener(()=>o.puzzle.stateProperty.unlink(c)),this.disposeEmitter.addListener(()=>t.dispose()),this.disposeEmitter.addListener(()=>n&&n.dispose())}}class Dt extends ho(L){constructor(e,t=st,n){const r=Q()({topological:!1},n);super(r);z(this,"backgroundRect");z(this,"facePressRect");z(this,"rectangularGradientRect");z(this,"circularGradientRect");z(this,"puzzleWrapper");z(this,"puzzleNode",null);z(this,"zoomListener");this.puzzleModelProperty=e,this.style=t,this.backgroundRect=new D({fill:t.theme.playAreaBackgroundColorProperty,pickable:!0}),this.facePressRect=new D({fill:null,pickableProperty:No}),Lo(null,this.facePressRect,(s,a)=>{var p;(p=e.value)==null||p.onUserFacePress(s,a)}),this.rectangularGradientRect=new D({pickable:!1}),this.circularGradientRect=new D({pickable:!1}),this.puzzleWrapper=new L({children:[this.backgroundRect,this.facePressRect,this.rectangularGradientRect,this.circularGradientRect]}),this.zoomListener=new go(this.puzzleWrapper,{maxScale:10}),this.addInputListener(this.zoomListener),this.addChild(this.puzzleWrapper);const c=this.updateLayout.bind(this);this.localPreferredWidthProperty.lazyLink(c),this.localPreferredHeightProperty.lazyLink(c),r.topological&&this.puzzleWrapper.localBoundsProperty.lazyLink(c),rt.multilink([e,it],(s,a)=>{this.puzzleNode&&(this.puzzleNode.dispose(),this.puzzleNode=null),s&&(r.topological?a&&(this.puzzleNode=new or(s)):this.puzzleNode=new jn(s,{focusNodeCallback:p=>{this.zoomListener.panToNode(p,!0)}}),this.puzzleNode&&(this.updatePuzzleNodeLayout(this.puzzleNode),this.puzzleWrapper.children=[this.backgroundRect,this.facePressRect,this.rectangularGradientRect,this.circularGradientRect,this.puzzleNode])),this.zoomListener.resetTransform(),this.updateLayout()})}step(e){this.zoomListener.step(2*e)}updateLayout(){const e=this.localPreferredWidth,t=this.localPreferredHeight;if(e!==null&&(this.backgroundRect.rectWidth=e,this.facePressRect.rectWidth=e,this.rectangularGradientRect.rectWidth=e,this.circularGradientRect.rectWidth=e),t!==null&&(this.backgroundRect.rectHeight=t,this.facePressRect.rectHeight=t,this.rectangularGradientRect.rectHeight=t,this.circularGradientRect.rectHeight=t),this.puzzleNode&&this.updatePuzzleNodeLayout(this.puzzleNode),e!==null&&t!==null&&e>0&&t>0){const n=new Ae(0,0,e,t),r=n.center,c=r.getMagnitude();this.rectangularGradientRect.fill=new fo(0,0,0,t).addColorStop(0,this.style.theme.playAreaLinearTopColorProperty).addColorStop(.5,this.style.theme.playAreaLinearMiddleColorProperty).addColorStop(1,this.style.theme.playAreaLinearBottomColorProperty),this.circularGradientRect.fill=new wo(r.x,r.y,c,r.x,r.y,0).addColorStop(0,this.style.theme.playAreaRadialOutsideColorProperty).addColorStop(1,this.style.theme.playAreaRadialInsideColorProperty),this.clipArea=O.bounds(n),this.zoomListener.setTargetBounds(n),this.zoomListener.setPanBounds(n)}else{const n=new Ae(0,0,5,5);this.zoomListener.setTargetBounds(n),this.zoomListener.setPanBounds(n)}}updatePuzzleNodeLayout(e){const t=this.localPreferredWidth,n=this.localPreferredHeight;if(t!==null&&n!==null&&t>0&&n>0){const c=t-40,s=n-20*2;if(e.localBounds.isValid()){const a=e.localBounds.width,p=e.localBounds.height,g=Math.min(c/a,s/p);e.setScaleMagnitude(g),e.center=new te(t/2,n/2)}}}}class Re extends L{constructor(o,e,t){const n=Q()({allowBarrierClickToHide:!0,panelOptions:{xMargin:15,yMargin:15,fill:f.uiBackgroundColorProperty,stroke:f.uiForegroundColorProperty}},t);super(),this.content=o,this.viewContext=e;const r=new D({fill:f.barrierColorProperty});this.addChild(r),e.layoutBoundsProperty.link(s=>{r.rectBounds=s}),n.allowBarrierClickToHide&&r.addInputListener({down:()=>{this.hide()}});const c=new be(o,n.panelOptions);e.layoutBoundsProperty.link(s=>{c.maxWidth=s.width*.9,c.maxHeight=s.height*.9}),this.addChild(new Ie(c,{alignBoundsProperty:e.layoutBoundsProperty,yAlign:"top",topMargin:50}))}show(){this.viewContext.glassPane.hasChild(this)||(this.reset(),this.viewContext.glassPane.addChild(this))}hide(){this.viewContext.glassPane.hasChild(this)&&this.viewContext.glassPane.removeChild(this)}reset(){}}class F extends Co{constructor(o,e,t){const n=Q()({advanced:!1,accessibleName:o,checkboxColor:f.uiForegroundColorProperty,checkboxColorBackground:f.uiBackgroundColorProperty},t),r=new V(o,{font:K,fill:f.uiForegroundColorProperty});n.advanced&&(n.visibleProperty=q),n.boxWidth=r.height,super(e,r,n)}}const Z=(l,o,e,t)=>{const n=new vo(o,e,{spacing:8,radioButtonOptions:{selectedColor:f.uiButtonBaseColorProperty,deselectedColor:f.uiBackgroundColorProperty,stroke:f.uiForegroundColorProperty}}),r=Q()({stretch:!0,align:"left",spacing:10,children:[new V(l,{font:tt,fill:f.uiForegroundColorProperty}),n]},t);return new U(r)};class oe extends Te{constructor(o,e){const t=Q()({advanced:!1,textFill:f.uiButtonForegroundProperty,baseColor:f.uiButtonBaseColorProperty,xMargin:5,yMargin:5,font:K,buttonAppearanceStrategy:fe},e);t.advanced&&(t.visibleProperty=q),super(o,t)}}class nr extends R{constructor(o,e,t,n){const r=Q()({advanced:!1,onOffSwitchOptions:{size:new Ye(40,20),trackFillLeft:f.uiButtonDisabledColorProperty,trackFillRight:f.uiButtonBaseColorProperty,accessibleName:e},spacing:10},n),c=new So(o,r.onOffSwitchOptions);r.children=[t,c],r.advanced&&(r.visibleProperty=q),super(r)}}class G extends nr{constructor(o,e,t){const n=Q()({textOptions:{}},t),r=new T(e,n.textOptions);super(o,e,r,n)}}class Ut extends bo{constructor(o,e,t){super(o,e,X({orientation:"horizontal",touchAreaYDilation:5,radioButtonOptions:{baseColor:f.uiButtonBaseColorProperty,disabledColor:f.uiButtonDisabledColorProperty,xMargin:8*1.3,yMargin:5*1.3,buttonAppearanceStrategyOptions:{selectedStroke:f.uiButtonSelectedStrokeColorProperty,deselectedStroke:f.uiButtonDeselectedStrokeColorProperty}}},t))}}const rr=new O("M1024 640q0 106 -75 181t-181 75t-181 -75t-75 -181t75 -181t181 -75t181 75t75 181zM1536 749v-222q0 -12 -8 -23t-20 -13l-185 -28q-19 -54 -39 -91q35 -50 107 -138q10 -12 10 -25t-9 -23q-27 -37 -99 -108t-94 -71q-12 0 -26 9l-138 108q-44 -23 -91 -38q-16 -136 -29 -186q-7 -28 -36 -28h-222q-14 0 -24.5 8.5t-11.5 21.5l-28 184q-49 16 -90 37l-141 -107q-10 -9 -25 -9q-14 0 -25 11q-126 114 -165 168q-7 10 -7 23q0 12 8 23q15 21 51 66.5t54 70.5q-27 50 -41 99l-183 27q-13 2 -21 12.5t-8 23.5v222q0 12 8 23t19 13l186 28q14 46 39 92q-40 57 -107 138q-10 12 -10 24q0 10 9 23q26 36 98.5 107.5t94.5 71.5q13 0 26 -10l138 -107q44 23 91 38q16 136 29 186q7 28 36 28h222q14 0 24.5 -8.5t11.5 -21.5l28 -184q49 -16 90 -37l142 107q9 9 24 9q13 0 25 -10q129 -119 165 -170q7 -8 7 -22q0 -12 -8 -23q-15 -21 -51 -66.5t-54 -70.5q26 -50 41 -98l183 -28q13 -2 21 -12.5t8 -23.5z").makeImmutable(),sr=new O("M979 1395q19 19 32 13t13 -32v-1472q0 -26 -13 -32t-32 13l-710 710q-9 9 -13 19v-678q0 -26 -19 -45t-45 -19h-128q-26 0 -45 19t-19 45v1408q0 26 19 45t45 19h128q26 0 45 -19t19 -45v-678q4 10 13 19z").makeImmutable(),ar=new O("M45 -115q-19 -19 -32 -13t-13 32v1472q0 26 13 32t32 -13l710 -710q9 -9 13 -19v678q0 26 19 45t45 19h128q26 0 45 -19t19 -45v-1408q0 -26 -19 -45t-45 -19h-128q-26 0 -45 19t-19 45v678q-4 -10 -13 -19z").makeImmutable(),ir=new O("M1619 1395q19 19 32 13t13 -32v-1472q0 -26 -13 -32t-32 13l-710 710q-9 9 -13 19v-710q0 -26 -13 -32t-32 13l-710 710q-19 19 -19 45t19 45l710 710q19 19 32 13t13 -32v-710q4 10 13 19z").makeImmutable(),lr=new O("M45 -115q-19 -19 -32 -13t-13 32v1472q0 26 13 32t32 -13l710 -710q9 -9 13 -19v710q0 26 13 32t32 -13l710 -710q19 -19 19 -45t-19 -45l-710 -710q-19 -19 -32 -13t-13 32v710q-4 -10 -13 -19z").makeImmutable(),cr=new O("M503.691 189.836L327.687 37.851C312.281 24.546 288 35.347 288 56.015v80.053C127.371 137.907 0 170.1 0 322.326c0 61.441 39.581 122.309 83.333 154.132 13.653 9.931 33.111-2.533 28.077-18.631C66.066 312.814 132.917 274.316 288 272.085V360c0 20.7 24.3 31.453 39.687 18.164l176.004-152c11.071-9.562 11.086-26.753 0-36.328z").makeImmutable(),dr=new O("M363 0l91 91l-235 235l-91 -91v-107h128v-128h107zM886 928q0 22 -22 22q-10 0 -17 -7l-542 -542q-7 -7 -7 -17q0 -22 22 -22q10 0 17 7l542 542q7 7 7 17zM832 1120l416 -416l-832 -832h-416v416zM1515 1024q0 -53 -37 -90l-166 -166l-416 416l166 165q36 38 90 38q53 0 91 -38l235 -234q37 -39 37 -91z").makeImmutable(),se=(l,o)=>new Y(l,X({maxWidth:20,maxHeight:20,fill:"black"},o));class Ee{constructor(o,e){z(this,"timerListener",null);z(this,"tooltipNode",null);this.viewContext=o,this.tooltipTextOverride=e}showTooltip(o,e,t){if(!this.tooltipNode){this.tooltipNode=new be(new V(o,{font:Xo}),{cornerRadius:1,xMargin:2,yMargin:2});const n=this.viewContext.glassPane.globalToLocalPoint(t.point);this.tooltipNode.leftTop=n.plusXY(0,this.viewContext.glassPane.getUniqueTransform().transformDeltaY(20)),this.tooltipNode.bottom>this.viewContext.layoutBoundsProperty.value.bottom&&(this.tooltipNode.bottom=n.y-2),this.tooltipNode.left<this.viewContext.layoutBoundsProperty.value.left&&(this.tooltipNode.left=this.viewContext.layoutBoundsProperty.value.left+2),this.tooltipNode.right>this.viewContext.layoutBoundsProperty.value.right&&(this.tooltipNode.right=this.viewContext.layoutBoundsProperty.value.right-2),this.viewContext.glassPane.addChild(this.tooltipNode)}}hideTooltip(){this.tooltipNode&&(this.tooltipNode.dispose(),this.tooltipNode=null)}clearListener(){this.timerListener&&(pt.clearTimeout(this.timerListener),this.timerListener=null)}enter(o){const e=o.currentTarget,t=this.tooltipTextOverride??(e==null?void 0:e.labelContent)??(e==null?void 0:e.accessibleName),n=o.pointer;e&&t&&this.timerListener===null&&(this.timerListener=pt.setTimeout(()=>{this.showTooltip(t,e,n)},200))}exit(o){this.clearListener(),this.hideTooltip()}dispose(){this.clearListener(),this.hideTooltip()}}class He extends Ut{constructor(o){const{basicLinesIcon:e,basicFaceColoringIcon:t,pureFaceColoringIcon:n,classicIcon:r,basicSectorsIcon:c,sectorsWithColorsIcon:s,vertexStateIcon:a,faceStateIcon:p,customIcon:g}=He.getIcons(),h=new Ee(o);super(Nt,[{value:Lt,createNode:()=>r,labelContent:"Classic",options:{}},{value:xt,createNode:()=>e,labelContent:"Lines",options:{}},{value:Bt,createNode:()=>t,labelContent:"Lines and Colors",options:{}},{value:zt,createNode:()=>n,labelContent:"Colors",options:{}},{value:It,createNode:()=>c,labelContent:"Sectors",options:{visibleProperty:q}},{value:Tt,createNode:()=>s,labelContent:"Sectors and Colors",options:{visibleProperty:q}},{value:$e,createNode:()=>a,labelContent:"Vertex State",options:{visibleProperty:q}},{value:_e,createNode:()=>p,labelContent:"Face State",options:{visibleProperty:q}},{value:At,createNode:()=>g,labelContent:"Custom",options:{visibleProperty:q}}]),this.children.forEach(C=>C.addInputListener(h)),o.layoutBoundsProperty.link(C=>{this.maxWidth=Math.max(1,C.width-2*me)})}static getIcons(){const o=new D(0,0,15,15,{stroke:f.whiteLineColorProperty,fill:f.faceColorDefaultColorProperty}),e=new D(0,0,15,15,{stroke:f.whiteLineColorProperty,fill:new de([f.faceColorBasicTargetColorProperty],S=>S.withAlpha(1))}),t=new Y(new O().moveTo(0,15).lineTo(0,0).lineTo(15,0).makeImmutable(),{stroke:new de([f.simpleRegionTargetColorProperty],S=>S.withAlpha(1)),lineWidth:4,lineCap:"round",lineJoin:"round"}),n=new Y(new O().moveTo(0,15).lineTo(0,0).lineTo(15,0).makeImmutable(),{stroke:f.blackLineColorProperty,lineWidth:4,lineCap:"round",lineJoin:"round"}),r=new Y(new O().arc(0,0,9,0,Math.PI/2,!1),{stroke:f.sectorOnlyOneColorProperty}),c=new L({children:[o,t]}),s=new L({children:[e,n]}),a=new L({children:[new D(0,0,15,15,{fill:f.uiForegroundColorProperty})]}),p=3,g=new O().moveTo(-p,-p).lineTo(p,p).moveTo(-p,p).lineTo(p,-p),h=new L({children:[new D(0,0,15,15,{fill:f.puzzleBackgroundColorProperty}),new Y(new O().moveTo(0,15).lineTo(0,0).lineTo(15,0).makeImmutable(),{stroke:f.blackLineColorProperty,lineWidth:3,lineCap:"square",lineJoin:"miter"}),new Y(g,{stroke:f.xColorProperty,lineWidth:2,x:15,y:7.5})]}),C=new L({children:[o,r,t]}),E=new L({children:[e,r,n]}),v=qt("eJytV11v2jAU/S9+9oOvv4PUh7VQqS+dNtZK08RDVlwUjQIiKWuF8t9nJw2JjWGJygtKfE7OuR/Oxdmjndnm2XqFRoDR73W6naPRHhXvG4NG6DrNzXW1hh2vyJ5Mjka/9ugNjQhG79Xvrr7ZubsSdzCoMYhh1MPAw5in6WO8xmhMU3iY/5ysMRZ7TnmY/5z24qQelnhx+hgQL5gABM8xAP3SMB/0axOAfnECUHierJxh9JxG+9k2mmDAFLPZhxJEKIA5Fpg2FBqhcCyxwqKhsAiFWRuNk4bCIxRqbWxVdcMREY6wPra4QBqSjJAS62SLDIe0VISknZctKBwy07HkSWVnA+Oz0hJRXqSF6bxAN+uXzdIUZpwWKaoL/pguX+v7lnbrrXcb464csW1Q61Lt1A5BhAQWEFRIoAFBHyu4rMx8YaZuIQh7Ytc/InYUF3FVhMwl/d0s7FgJnpiGkM+uFDD6a7LtfNJRdCHerJfrbaRu7TpGT+66Llxm5xiTIhESGNdaccnZB2Fa54a+PvyY3o0nnXpb7/Vms86zwhyk76yQ1QBOOFeESZ0w5cqWRdYDg7v7nvphoI0+EEEJIcIaJIoyCPQf7seTG+swRvF3uTzlt3pdLhsPRmXCtdAEEkpUfw8Y4KEp1ZpwpaWQjBHR14MOyQMEkTQhYK2EpL092AAPxaRilJKEckbFUb9PevAhHoqDtG2XTNreJ737IYb0I1ECqOBCJMDtzu3rIQd4cHBdUEwntlCgeuehhtTKblhCpSB2byXWp6+H7uNhwWy1S5fZ/ICh0XO6zI2bceap+DAKR1yANNzavL52dDtht8XRaDerubcGZTuMpUv7nABEBOgQARoRYEMEWESADBEQEQHVEeD/rUGsimKIgoq1AQbFEGsEkE+nMTAK/vkoookMqibEOmpD60q4v3h3qjJvsRfqMUCCT5H6wVNnJPTty9UVckFGeNDh5Wd4tMNji9M81lNPdPXO8FSHx8/l0U2YniNCX0Xel9jNZVERmwNbrJe33nrfg+6+PThX546XtNhmloh+OkM7pvMvq/dmNgdHWjgr5gZ9R6/VKravR1L0clLsclL8clJHHxCeFOutIy8X0tEniydFe+scfdmcTO1PbE/NyrL8B0eOKVk=");k()&&N(v);const w=new xo(v.board.vertices[5],v.stateProperty,{...$e,allVertexStateVisibleProperty:new le(!0)}),P=new L({children:[w],scale:60}),i=new Bo(v.board.faces[5],v.stateProperty,_e),d=new L({children:[i],scale:30}),b=se(dr,{fill:f.uiForegroundColorProperty,matrix:new Et().rowMajor(.75,0,0,0,-.75,0,0,0,1)}),m=new yo;return{basicLinesIcon:m.createBox(c),basicFaceColoringIcon:m.createBox(s),pureFaceColoringIcon:m.createBox(a),classicIcon:m.createBox(h),basicSectorsIcon:m.createBox(C),sectorsWithColorsIcon:m.createBox(E),vertexStateIcon:m.createBox(P),faceStateIcon:m.createBox(d),customIcon:m.createBox(b)}}}const q=new Ft("advancedSettingsVisibleProperty",!1);class ur extends Re{constructor(o){const e=new Ee(o),t=new U({stretch:!0,align:"left",spacing:8,children:[new V("Solve After Every Move",{font:tt,fill:f.uiForegroundColorProperty}),new ht({xAlign:"left",yAlign:"top",xSpacing:20,ySpacing:8,columns:[[new F("Vertex Joint X",vn),new F("Vertex Forced Line",Sn),new F("Vertex Forced X",bn),new F("Completed Face X",En),new F("Completed Face Lines",kn),new F("Simple Loop X",Fn),new F("Simple Loop Lines",Nn),new F("Double Minus One Faces",Ln),new F("1/N-1 Sectors",xn),new F("Simple Sectors",Bn),new F("Vertex X",zn),new F("Vertex Lines",In),new F("Vertex Sectors",Tn),new F("Vertex Faces",An)],[new F("Color X",Mn),new F("Color Lines",On),new F("Color Parity X",Rn),new F("Color Parity Lines",Hn),new F("Color Parity Colors",Vn),new F("Color Parity Partial",qn),new F("Vertex/Color To Face",Dn),new F("Face X",Un),new F("Face Lines",Wn),new F("Face Sectors",Gn),new F("Face Color",Xn)]]})]}),n=Z("Theme",Jo,wt.map(i=>({value:i,createNode:()=>new V(i.name,{font:K,fill:f.uiForegroundColorProperty}),a11yName:i.name}))),r=new U({spacing:15,stretch:!0,visible:Oe.debugColors,children:wt.filter(i=>i.isEditable).map(i=>new oe(`Edit ${i.name} Theme`,{listener:()=>{Ko(i)}}))}),c=new U({stretch:!0,align:"left",spacing:8,children:[new V("Puzzle Display",{font:tt,fill:f.uiForegroundColorProperty}),new ht({xAlign:"left",yAlign:"top",xSpacing:20,ySpacing:8,columns:[[new F("Lines Visible",yt),new F("Color Lines",Yo,{enabledProperty:yt,layoutOptions:{leftMargin:20}}),new F("Face Colors Visible",Zo),new F("Sectors Visible",Ge),new F("Sectors Next to Edges",Qo,{advanced:!0,enabledProperty:Ge,layoutOptions:{leftMargin:20}}),new F("Trivial Sectors",jo,{advanced:!0,enabledProperty:Ge,layoutOptions:{leftMargin:20}}),new F("Vertex State",mt),new F("All Vertex State",$o,{advanced:!0,enabledProperty:mt,layoutOptions:{leftMargin:20}}),new F("Face State",_o,{advanced:!0})],[new F("Possible Line Visible",en),new F("Impossible Line Visible",Pt),new F("Vertices Visible",tn),new F("Vertices Small",on),new F("Red X Visible",nn),new F("Red X Aligned",rn)]]}),new R({spacing:20,visibleProperty:q,children:[Z("Line Join",an,sn.map(i=>({value:i,createNode:()=>new V(i,{font:K,fill:f.uiForegroundColorProperty}),labelContent:i}))),Z("Line Cap",cn,ln.map(i=>({value:i,createNode:()=>new V(i,{font:K,fill:f.uiForegroundColorProperty}),labelContent:i}))),Z("Vertex Style",un,dn.map(i=>({value:i,createNode:()=>new V(i,{font:K,fill:f.uiForegroundColorProperty}),labelContent:i}))),Z("Impossible Line Style",hn,pn.map(i=>({value:i,createNode:()=>new V(i,{font:K,fill:f.uiForegroundColorProperty}),labelContent:i}))),Z("Face Value Style",fn,gn.map(i=>({value:i,createNode:()=>new V(i,{font:K,fill:f.uiForegroundColorProperty}),labelContent:i})))]})]}),s=Z("Face Color Threshold",wn,[{value:1,createNode:()=>new T("Show All"),labelContent:"Show All"},{value:2,createNode:()=>new T("2+"),labelContent:"2+"},{value:3,createNode:()=>new T("3+"),labelContent:"3+"},{value:5,createNode:()=>new T("5+"),labelContent:"5+"},{value:10,createNode:()=>new T("10+"),labelContent:"10+"},{value:Number.POSITIVE_INFINITY,createNode:()=>new T("Only Outside"),labelContent:"Only Outside"}]),a=new U({spacing:8,align:"left",stretch:!0,children:[new G(Ke,"Auto-Solve"),new G(Jn,"Add Lines",{layoutOptions:{leftMargin:20},enabledProperty:Ke}),new G(Kn,"Simple Loops",{layoutOptions:{leftMargin:20},enabledProperty:Ke}),new T("Highlights"),new G(zo,"Dim Completed Numbers",{layoutOptions:{leftMargin:20}}),new G(Io,"Highlight Incorrect Numbers",{layoutOptions:{leftMargin:20}}),new G(Mt,"Highlight Incorrect Moves",{layoutOptions:{leftMargin:20}}),new G(To,"Highlight Intersecting Lines",{layoutOptions:{leftMargin:20}}),new G(Ot,"Show View Style Controls"),new G(Pt,"Show Impossible Lines"),new G(Rt,"Show Elapsed Time"),new G(et,"Show Undo-All / Redo-All",{advanced:!0}),new G(it,"Show Layout Test",{advanced:!0}),new G(Ao,"Solve Uses Built-In",{advanced:!0})]}),p=new Me(!1),g=de.and([q,p]),h=He.getIcons(),C=(i,d)=>new R({spacing:5,children:[new T(d),i]}),E=Z("View Style",Nt,[{value:Lt,createNode:()=>C(h.classicIcon,"Classic"),labelContent:"Classic"},{value:xt,createNode:()=>C(h.basicLinesIcon,"Lines"),labelContent:"Lines"},{value:Bt,createNode:()=>C(h.basicFaceColoringIcon,"Lines and Colors"),labelContent:"Lines and Colors"},{value:zt,createNode:()=>C(h.pureFaceColoringIcon,"Colors"),labelContent:"Colors"},{value:It,createNode:()=>C(h.basicSectorsIcon,"Sectors"),labelContent:"Sectors",options:{visibleProperty:q}},{value:Tt,createNode:()=>C(h.sectorsWithColorsIcon,"Sectors and Colors"),labelContent:"Sectors and Colors",options:{visibleProperty:q}},{value:$e,createNode:()=>C(h.vertexStateIcon,"Vertex State"),labelContent:"Vertex State",options:{visibleProperty:q}},{value:_e,createNode:()=>C(h.faceStateIcon,"Face State"),labelContent:"Face State",options:{visibleProperty:q}},{value:At,createNode:()=>C(h.customIcon,"Custom"),labelContent:"Custom",options:{visibleProperty:q}}]),v=new G(p,"Show Custom Options",{advanced:!0}),w=new U({spacing:20,align:"left",children:[new R({spacing:20,children:[t,s]}),c],visibleProperty:g}),P=new oe("Reload to Defaults",{accessibleName:"Clear all settings/data, and reload the page",listener:()=>{localStorage.clear(),self.location.reload()},advanced:!0});P.addInputListener(e),super(new U({spacing:20,align:"left",stretch:!0,children:[a,new R({align:"top",spacing:30,children:[E,n,r]}),v,w,P,new G(q,"Show Advanced Settings")]}),o)}}class pr extends Re{constructor(e){const t=new Me(!1),n=new oe("Copy URL",{accessibleName:"Copy Shareable URL to Clipboard",listener:()=>{if(this.puzzle){const r=location.protocol+"//"+location.host+location.pathname;let c=this.puzzle;this.includeStateProperty.value||(c=new ce(c.board,Vt.fromFaceValueData(c.board,c.stateProperty.value)));const s=Mo(c);yn(r+"?p="+encodeURIComponent(s))}}});n.addInputListener(new Ee(e));super(new U({spacing:20,align:"left",stretch:!0,children:[n,new F("Include Solve Progress",t)]}),e);z(this,"includeStateProperty");z(this,"puzzle",null);this.includeStateProperty=t}setPuzzle(e){this.puzzle=e}reset(){super.reset(),this.includeStateProperty.reset()}}const ne=class ne extends to{constructor(o){super(),this.canSolve=o}};z(ne,"STANDARD",new ne((o,e)=>(e=e.clone(),Yn(Oo,o,e,!0),Wo(e)))),z(ne,"NO_LIMIT",new ne(()=>!0)),z(ne,"enumeration",new oo(ne));let Pe=ne;const bt=new Eo("canSolveDifficulty",Pe.STANDARD),hr=l=>{const o=l.cleanState.clone();for(const e of l.board.faces)o.getFaceValue(e)===null&&o.setFaceValue(e,e.edges.filter(t=>l.blackEdges.has(t)).length);return Zn(l.board,o,l.blackEdges)};class gr extends R{constructor(o,e){const t=new ko("polygonGeneratorProperty",{serialize:i=>i.name,deserialize:i=>xe.find(d=>d.name===i)??xe[0]}),n=localStorage.getItem("polygonGeneratorParameters")?JSON.parse(localStorage.getItem("polygonGeneratorParameters")):null;let r=!1;const c=Z("Patterns",t,xe.map(i=>({value:i,createNode:()=>new V(i.name,{font:K,fill:f.uiForegroundColorProperty}),labelContent:i.name})),{layoutOptions:{align:"top",grow:0},justify:"top"}),s=new R({spacing:10,align:"center",layoutOptions:{grow:0},grow:1}),a=new R({spacing:10,align:"center",layoutOptions:{grow:0},children:[new T("Solver Difficulty"),new Qn(bt,[{value:Pe.STANDARD,createNode:()=>new T("Standard"),labelContent:"Standard"},{value:Pe.NO_LIMIT,createNode:()=>new T("No Limit"),labelContent:"No Limit"}],{orientation:"horizontal",align:"center",spacing:30})]}),p=new R({spacing:10,align:"center",justify:"spaceEvenly",layoutOptions:{grow:0}}),g=new L,h=new L,C=new ve;C.addListener(()=>{h.children=[]});const E=new L({children:[g,h]}),v=(i,d)=>{const b=i.generate(d),m=new O;b.forEach(S=>m.polygon(S)),g.children=[new Y(m,{fill:f.puzzleBackgroundColorProperty,stroke:f.blackLineColorProperty,lineWidth:.05})],C.emit()};v(xe[0],{width:5,height:5}),t.link(i=>{p.children.forEach(S=>S.dispose()),s.children.forEach(S=>S.dispose());const d={},b=S=>n&&!r&&S in n?n[S]:i.defaultParameterValues[S],m=()=>{localStorage.setItem("polygonGeneratorParameters",JSON.stringify(d)),v(i,d)};for(const[S,x]of Object.entries(i.parameters))if(x.type==="integer"){const B=new gt(b(S));B.link(u=>{d[S]=u,m()}),p.addChild(new Be(x.label,B,x.range,{layoutFunction:Be.createLayoutFunction4(),titleNodeOptions:{font:K,fill:f.uiForegroundColorProperty},sliderOptions:{trackSize:new Ye(100,5),labelTagName:"label",keyboardStep:1,labelContent:x.label},arrowButtonOptions:{touchAreaXDilation:5,touchAreaYDilation:25},numberDisplayOptions:{decimalPlaces:0},delta:1,visibleProperty:x.advanced?q:null}))}else if(x.type==="float"){const B=new gt(b(S));B.link(u=>{d[S]=u,m()}),p.addChild(new Be(x.label,B,x.range,{layoutFunction:Be.createLayoutFunction4(),titleNodeOptions:{font:K,fill:f.uiForegroundColorProperty},sliderOptions:{trackSize:new Ye(100,5),labelTagName:"label",keyboardStep:.1,labelContent:x.label},numberDisplayOptions:{decimalPlaces:2},delta:.01,visibleProperty:x.advanced?q:null}))}else if(x.type==="boolean"){const B=new Me(b(S));B.link(u=>{d[S]=u,m()}),p.addChild(new F(x.label,B,{advanced:x.advanced}))}else if(x.type==="choice"){const B=new nt(b(S));B.link(u=>{d[S]=u,m()}),p.addChild(Z(x.label,B,x.choices.map(u=>({value:u.value,createNode:()=>new V(u.label,{font:K,fill:f.uiForegroundColorProperty}),labelContent:u.label}))))}r=!0,s.addChild(new oe("Generate",{font:Xe,layoutOptions:{align:"center"},listener:async()=>{C.emit();const S=i.generate(d),x=new uo(S,i.scale??1),B=new le(!1),u=()=>{B.value=!0};C.addListener(u);const y=new ve,j=new ve,_=new ve;_.addListener(()=>{h.children=[]}),y.addListener((A,H)=>{h.addChild(new Y(O.polygon(S[A]),{fill:f.generateAddedFaceColorProperty,stroke:f.blackLineColorProperty,lineWidth:.05})),H!==null&&h.addChild(new V(`${H}`,{font:Xe,fill:f.faceValueColorProperty,maxWidth:.9,maxHeight:.9,center:ye(S[A])}))}),j.addListener((A,H)=>{h.addChild(new Y(O.polygon(S[A]),{fill:f.generateMinimizedFaceColorProperty,stroke:f.blackLineColorProperty,lineWidth:.05})),H!==null&&h.addChild(new V(`${H}`,{font:Xe,fill:f.faceValueColorProperty,maxWidth:.9,maxHeight:.9,center:ye(S[A])}))});try{const A=bt.value,H=A.canSolve,Fe=async()=>await Vo(x,B,y),dt=async()=>{let De=await Fe();if(A===Pe.NO_LIMIT)return De;{const jt=x.faces.filter(Le=>De.cleanState.getFaceValue(Le)===null),ut=hr(De);return jt.forEach(Le=>{y.emit(x.faces.indexOf(Le),ut.cleanState.getFaceValue(Le))}),ut}};let Ne=await dt();for(;!H(Ne.board,Ne.cleanState.clone());)_.emit(),Ne=await dt();const Qt=await qo(Ne,H,B,j);Do(17,B),B.value||(h.children=[],P.loadPuzzle(ce.fromSolvedPuzzle(Qt)))}catch{}C.hasListener(u)&&C.removeListener(u)}}))});const w=new D({fill:f.playAreaBackgroundColorProperty,sizable:!0,layoutOptions:{grow:1},children:[E]});rt.multilink([w.localPreferredWidthProperty,w.localPreferredHeightProperty,E.localBoundsProperty],(i,d,b)=>{if(i!==null&&d!==null&&b.isFinite()){const S=i-30,x=d-2*15,B=Math.min(S/b.width,x/b.height);E.setScaleMagnitude(B),E.centerX=i/2,E.centerY=d/2}});const P=Q()({spacing:10,stretch:!0,children:[c,new U({spacing:10,stretch:!0,layoutOptions:{grow:1},children:[w,s,new je,a,new je,p]})]},e);super(P)}}const fr="#444",wr="#fa0",yr="#888",mr="#fff",Pr="#f00",Cr="#ff0",vr="#ff0",Sr="#0f0",br="#0ff",Er="#0af",kr="#f0f";class Fr extends Re{constructor(e){const t=new R({children:[new V("Loading image...",{font:K,fill:f.uiForegroundColorProperty})]}),n=new L({children:[t]});super(n,e);z(this,"scanContentNode");z(this,"imageContainer");z(this,"solutionContainer");z(this,"blackImageLayer");z(this,"originalImageLayer");z(this,"thresholdImageLayer");z(this,"contourLayer");z(this,"puzzle",null);z(this,"rootContour",null);z(this,"contours",[]);z(this,"contourNodeMap",new Map);this.scanContentNode=n,this.blackImageLayer=new L,this.originalImageLayer=new L({visible:!1}),this.thresholdImageLayer=new L({visible:!1}),this.contourLayer=new L,this.imageContainer=new L({children:[this.blackImageLayer,this.originalImageLayer,this.thresholdImageLayer,this.contourLayer]}),this.solutionContainer=new L}getScanOptions(){return{originalImageCallback:e=>this.onOriginalImage(e),thresholdedImageCallback:e=>this.onThresholdedImage(e),rootContourCallback:e=>this.onRootContour(e),widestSubtreeCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeWidestContour()},dotContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeDotContour()},lineContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeLineContour()},zeroOuterContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeZeroOuterContour()},zeroInnerContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeZeroInnerContour()},oneContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeOneContour()},twoContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeTwoContour()},threeContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeThreeContour()},xContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeXContour()},unknownContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeUnknownContour()},debugImageCallback:e=>{},puzzleCallback:e=>this.onPuzzle(e),solutionsCallback:e=>this.onSolutions(e)}}onOriginalImage(e){this.originalImageLayer.addChild(new ft(e)),this.blackImageLayer.addChild(D.bounds(this.originalImageLayer.bounds,{fill:"black"})),this.scanContentNode.children=[new U({spacing:10,children:[this.imageContainer,this.solutionContainer]})]}onThresholdedImage(e){this.thresholdImageLayer.addChild(new ft(e))}onRootContour(e){this.rootContour=e,this.contours=e.getDescendantContours();for(const t of this.contours){const n=new Nr(t);this.contourNodeMap.set(t,n),this.contourLayer.addChild(n)}}onPuzzle(e){this.puzzle=e}onSolutions(e){if(e.length===1)this.hide();else{const t=this.puzzle;k()&&N(t);const n=t.board;if(e.length===0){Se(n,t.stateProperty.value);const r=new ge(t,{scale:20});this.solutionContainer.children=[new U({spacing:10,children:[new T("No Solutions Found"),r]})]}else{const r=new ce(n,t.stateProperty.value.clone()),c=new ce(n,t.stateProperty.value.clone()),s=new ce(n,t.stateProperty.value.clone());e[0].forEach(h=>r.stateProperty.value.setEdgeState(h,re.BLACK)),e[1].forEach(h=>c.stateProperty.value.setEdgeState(h,re.BLACK)),n.edges.forEach(h=>{r.stateProperty.value.getEdgeState(h)!==c.stateProperty.value.getEdgeState(h)&&s.stateProperty.value.setEdgeState(h,re.BLACK)}),Se(n,r.stateProperty.value),Se(n,c.stateProperty.value),Se(n,s.stateProperty.value);const a=new ge(r,{scale:10}),p=new ge(c,{scale:10}),g=new ge(s,{scale:10});this.solutionContainer.children=[new U({spacing:10,children:[new T("Multiple Solutions Found"),new R({spacing:10,children:[new U({spacing:10,children:[a,new T("Solution A")]}),new U({spacing:10,children:[p,new T("Solution B")]}),new U({spacing:10,children:[g,new T("Difference")]})]})]})]}}}}class Nr extends L{constructor(e){const t=new Y(e.shape,{stroke:fr});super({children:[t]});z(this,"path");this.contour=e,this.path=t}makeWidestContour(){this.path.stroke=wr}makeDotContour(){this.path.stroke=yr}makeLineContour(){this.path.stroke=mr}makeXContour(){this.path.stroke=Pr}makeZeroOuterContour(){this.path.stroke=Cr}makeZeroInnerContour(){this.path.stroke=vr}makeOneContour(){this.path.stroke=Sr}makeTwoContour(){this.path.stroke=br}makeThreeContour(){this.path.stroke=Er}makeUnknownContour(){this.path.stroke=kr}}class Lr extends Re{constructor(o,e){super(new U({spacing:20,align:"left",stretch:!0,children:[new L({children:[new gr(o,{loadPuzzle:t=>{this.hide(),e.loadPuzzle(t)},preferredWidth:700,preferredHeight:300})]}),new je,new R({spacing:15,grow:1,children:[new oe("Load String",{listener:()=>{this.hide();const t=prompt("Enter puzzle string");t&&e.loadPuzzle(ce.loadDeprecatedScalaString(t))}}),new oe("Load Image (Rectangular Only)",{listener:()=>{this.hide();const t=document.createElement("input");t.type="file",t.onchange=n=>{const r=n.target.files[0];var c=new FileReader;c.readAsDataURL(r),c.onloadend=async()=>{const s=c.result,a=new Fr(o);a.show();const p=await no(s,a.getScanOptions());e.loadPuzzle(p)}},t.click()}})]})]}),o)}}class xr extends V{constructor(o,e){const t=Q()({font:mn,fill:f.uiForegroundColorProperty},e),n=60,r=60*n,c=24*r,s=new de([o],a=>{a=Math.ceil(a);const p=Math.floor(a/c);a-=p*c;const g=Math.floor(a/r);a-=g*r;const h=Math.floor(a/n);a-=h*n;const C=a,E=g<10?`0${g}`:`${g}`,v=h<10?`0${h}`:`${h}`,w=C<10?`0${C}`:`${C}`;return p?`${p}d ${E}:${v}:${w}`:g?`${E}:${v}:${w}`:`${v}:${w}`});super(s,t),this.timerProperty=o,this.disposeEmitter.addListener(()=>{s.dispose()})}}class Br extends R{constructor(o,e,t){const n=new Ee(e),r=new le(!1),c=new le(0),s=new le(ie.NOT_FOUND),a=new ae(o,{derive:d=>d?d.undoPossibleProperty:r}),p=new ae(o,{derive:d=>d?d.redoPossibleProperty:r}),g=new ae(o,{derive:d=>d?d.isSolvedProperty:r}),h=new ae(o,{derive:d=>d?d.timeElapsedProperty:c}),C=new ae(o,{derive:d=>d?d.hintStateProperty:s}),E=new de([g],d=>!d);let v=null,w=null,P=null;const i={buttonAppearanceStrategy:fe,baseColor:f.uiButtonBaseColorProperty,disabledColor:f.uiButtonDisabledColorProperty,xMargin:8*1.3,yMargin:5*1.3,mouseAreaXDilation:5,mouseAreaYDilation:5,touchAreaXDilation:5,touchAreaYDilation:5};super({spacing:10,stretch:!0,children:[new Te("New",X({},i,{accessibleName:"New",listener:()=>{v=v||new Lr(e,{loadPuzzle:t.loadPuzzle}),v.show()},textFill:f.uiButtonForegroundProperty,baseColor:f.uiButtonBaseColorProperty,xMargin:5,yMargin:5,font:Je,buttonAppearanceStrategy:fe})),new pe(X({},i,{accessibleName:"Undo All",content:se(ir),listener:()=>{o.value&&o.value.onUserUndoAll()},enabledProperty:a,visibleProperty:et})),new pe(X({},i,{accessibleName:"Undo",content:se(sr),listener:()=>{o.value&&o.value.onUserUndo()},enabledProperty:a,fireOnHold:!0})),new xr(h,{visibleProperty:Rt}),new pe(X({},i,{accessibleName:"Redo",content:se(ar),listener:()=>{o.value&&o.value.onUserRedo()},enabledProperty:p,fireOnHold:!0})),new pe(X({},i,{accessibleName:"Redo All",content:se(lr),listener:()=>{o.value&&o.value.onUserRedoAll()},enabledProperty:p,visibleProperty:et})),new pe(X({},i,{accessibleName:"Settings",content:se(rr),listener:()=>{P=P||new ur(e),P.show()}})),new pe(X({},i,{accessibleName:"Share",content:se(cr),listener:()=>{const d=o.value;d&&(w=w||new pr(e),w.setPuzzle(d.puzzle),w.show())}})),new Te("Solve",X({},i,{accessibleName:"Solve",listener:()=>{o.value&&o.value.onUserRequestSolve()},enabledProperty:E,textFill:f.uiButtonForegroundProperty,baseColor:f.uiButtonBaseColorProperty,xMargin:5,yMargin:5,font:Je,buttonAppearanceStrategy:fe})),new Te("Hint",X({},i,{accessibleName:"Hint",listener:()=>{o.value&&o.value.onUserRequestHint()},enabledProperty:new de([E,C],(d,b)=>d&&b===ie.DEFAULT),textFill:f.uiButtonForegroundProperty,baseColor:f.uiButtonBaseColorProperty,xMargin:5,yMargin:5,font:Je,buttonAppearanceStrategy:fe}))]}),this.puzzleModelProperty=o,this.children.forEach(d=>d.addInputListener(n)),e.layoutBoundsProperty.link(d=>{this.maxWidth=Math.max(1,d.width-2*me)})}}const ke=new L,Wt=new L,zr=()=>{const l=Oe.p||localStorage.getItem("puzzleString"),o=ce.loadDefaultPuzzle();let e=null,t=0;try{let n=o;if(l){const r=qt(l);if(r){n=r;const c=localStorage.getItem("timeElapsedProperty");t=c?JSON.parse(c):0}}e=ot(n.board,n.stateProperty.value)}catch(n){console.error(n)}return e||(e=ot(o.board,o.stateProperty.value)),k()&&N(e),new Ht(e,{initialTimeElapsed:t})},Ir=f.uiForegroundColorProperty,Tr=new de([f.uiForegroundColorProperty],l=>l.withAlpha(.15));class Ar extends L{constructor(o,e,t,n){super({});const r=new Cn({diameter:20,activeColor:Ir,inactiveColor:Tr});this.disposeEmitter.addListener(()=>r.dispose());const c={xMargin:5,yMargin:5,fill:f.uiBackgroundColorProperty,stroke:f.uiForegroundColorProperty},s=new be(new R({spacing:10,children:[new L({children:[r]}),new T("Loading Hint Solver...")]}),c),a=new R({spacing:10,children:[new be(new R({spacing:10,children:[new L({children:[r]}),new T("Searching for Hint...")]}),c),new oe("Cancel",{listener:n})]}),p=new R({spacing:10,children:[new oe("Apply Hint",{listener:t}),new oe("Hide Hint",{listener:n})]}),g=new be(new T("No Hint Found"),c);g.pickable=!1;const h=E=>{this.children=[...E===ie.LOADING?[s]:[],...E===ie.SEARCHING?[a]:[],...E===ie.FOUND?[p]:[],...E===ie.NOT_FOUND?[g]:[]]};e.link(h),this.disposeEmitter.addListener(()=>e.unlink(h));const C=E=>{r.step(E)};o.stepEmitter.addListener(C),this.disposeEmitter.addListener(()=>o.stepEmitter.removeListener(C))}}class Mr extends R{constructor(o){const e=new Qe(0,0,15,0,{stroke:f.uiButtonForegroundProperty,lineWidth:4,lineCap:"round"}),t=6,n=new O().moveTo(-t,-t).lineTo(t,t).moveTo(-t,t).lineTo(t,-t),r=new Y(n,{stroke:f.uiButtonForegroundProperty,lineWidth:2}),c=new L({children:[new D(0,0,7,7,{stroke:f.uiButtonForegroundProperty,fill:f.uiForegroundColorProperty}),new D(7,7,7,7,{stroke:f.uiButtonForegroundProperty,fill:f.uiForegroundColorProperty})]}),s=new L({children:[new D(0,0,7,7,{stroke:f.uiButtonForegroundProperty,fill:f.uiForegroundColorProperty}),new D(7,7,7,7,{stroke:f.uiButtonForegroundProperty,fill:f.uiBackgroundColorProperty})]}),a=new L({children:[new Y(new O().moveTo(0,14).lineTo(0,0).lineTo(14,0),{stroke:f.uiButtonForegroundProperty}),new Y(new O().arc(0,0,7,0,Math.PI/2,!1),{stroke:f.uiButtonForegroundProperty})]}),p=17,g=6,h=7,C=2,E=h/Math.sqrt(2),v=new L({children:[new L({rotation:-Math.PI/4,children:[new D(0,0,p,h,{stroke:f.uiButtonForegroundProperty,fill:f.uiButtonInvertedForegroundProperty,cornerRadius:C}),new D(g,0,p-g,h,{fill:f.uiButtonForegroundProperty,cornerRadius:C})]}),new Qe(E,E-.5,E+12,E-.5,{stroke:f.uiButtonForegroundProperty,lineDash:[5,1,3,1,2]})]}),w=new Ee(o),P=m=>new L({scale:1.3,children:[m]}),i=new Ut(Ro,[{value:M.EDGE_STATE,labelContent:"Edge Edit Mode",createNode:()=>P(e),options:{visibleProperty:M.EDGE_STATE.isEnabledProperty}},{value:M.EDGE_STATE_REVERSED,labelContent:"Edge Reversed Edit Mode",createNode:()=>P(r),options:{visibleProperty:M.EDGE_STATE_REVERSED.isEnabledProperty}},{value:M.FACE_COLOR_MATCH,labelContent:"Face Color Match Edit Mode",createNode:()=>P(c),options:{visibleProperty:M.FACE_COLOR_MATCH.isEnabledProperty}},{value:M.FACE_COLOR_OPPOSITE,labelContent:"Face Color Opposite Edit Mode",createNode:()=>P(s),options:{visibleProperty:M.FACE_COLOR_OPPOSITE.isEnabledProperty}},{value:M.SECTOR_STATE,labelContent:"Sector Edit Mode",createNode:()=>P(a),options:{visibleProperty:M.SECTOR_STATE.isEnabledProperty}}],{spacing:15,layoutOptions:{grow:1}});i.children.forEach(m=>m.addInputListener(w));const d={buttonAppearanceStrategy:fe,baseColor:f.uiButtonBaseColorProperty,disabledColor:f.uiButtonDisabledColorProperty,mouseAreaXDilation:5,mouseAreaYDilation:5,touchAreaXDilation:5,touchAreaYDilation:5};new Fo(at,X({},d,{accessibleName:"Eraser Mode (Toggle)",content:P(v)})).addInputListener(w),super({spacing:13,stretch:!0,children:[i]}),o.layoutBoundsProperty.link(m=>{this.maxWidth=Math.max(1,m.width-2*me)})}}class Or{constructor(o,e,t){this.layoutBoundsProperty=o,this.glassPane=e,this.stepEmitter=t}}self.assertions;const Rr=new L({renderer:"svg",children:[ke]}),Ce=new mo(Rr,{allowWebGL:!0,allowBackingScaleAntialiasing:!0,allowSceneOverflow:!1,accessibility:!0,backgroundColor:"#eee",assumeFullWindow:!0,listenToOnlyElement:Oe.debugColors});document.body.appendChild(Ce.domElement);Ce.setPointerAreaDisplayVisible(Oe.showPointerAreas);self.oncontextmenu=l=>l.preventDefault();const lt=new nt(new Ae(0,0,self.innerWidth,self.innerHeight)),J=new le(zr()),Gt=new Dt(J,st,{layoutOptions:{stretch:!0,grow:1}}),Xt=new Dt(J,st,{layoutOptions:{stretch:!0,grow:1},topological:!0,visibleProperty:it}),Hr=new Me(!1),Vr=new ae(J,{derive:l=>l?l.hasErrorProperty:Hr}),qr=new ae(J,{derive:l=>l?l.hintStateProperty:new le(ie.DEFAULT)});rt.multilink([Vr,Mt,f.navbarBackgroundColorProperty,f.navbarErrorBackgroundColorProperty],(l,o,e,t)=>{Ce.backgroundColor=l&&o?t:e});const Jt=new ve,Ve=new Or(lt,Wt,Jt),Kt=new Br(J,Ve,{loadPuzzle:l=>{const o=ot(l.board,l.stateProperty.value);o&&(J.value=new Ht(o))}}),Dr=new Mr(Ve),Ur=new He(Ve),Yt=new Ar(Ve,qr,()=>{var l;(l=J.value)==null||l.onUserApplyHint()},()=>{var l;(l=J.value)==null||l.onUserClearHint()}),we=new U({stretch:!0,children:[new Ie(Kt,{margin:me}),new R({grow:1,stretch:!0,layoutOptions:{grow:1},children:[Gt,Xt]}),new Ie(Ur,{margin:me,visibleProperty:Ot}),new Ie(Dr,{margin:me})]});lt.lazyLink(l=>{we.preferredWidth=l.width,we.preferredHeight=l.height,we.x=l.left,we.y=l.top});ke.addChild(we);ke.addChild(Yt);ke.addChild(Wt);Po.create(ke,[Kt,Yt],(l,o)=>{o.centerTop=l.centerBottom.plusXY(0,5)});Ce.initializeEvents();let ct=!0;const Zt=()=>{ct=!1;const l=new Ae(0,0,self.innerWidth,self.innerHeight);Ce.setWidthHeight(l.width,l.height),lt.value=l,po.mobileSafari&&self.scrollTo(0,0)},qe=()=>{ct=!0};$(self).resize(qe);self.addEventListener("resize",qe);self.addEventListener("orientationchange",qe);self.visualViewport&&self.visualViewport.addEventListener("resize",qe);Zt();Ce.updateOnRequestAnimationFrame(l=>{var o;Uo(),ct&&Zt(),we.validateBounds(),Gt.step(l),Xt.step(l),(o=J.value)==null||o.step(l),Jt.emit(l)});document.addEventListener("keydown",l=>{var o,e,t,n;l.ctrlKey||l.metaKey?(l.key==="z"&&(l.shiftKey?(o=J.value)==null||o.onUserRedo():(e=J.value)==null||e.onUserUndo()),l.key==="y"&&((t=J.value)==null||t.onUserRedo())):l.key==="1"?ee(M.EDGE_STATE):l.key==="2"?ee(M.EDGE_STATE_REVERSED):l.key==="3"?ee(M.FACE_COLOR_MATCH):l.key==="4"?ee(M.FACE_COLOR_OPPOSITE):l.key==="5"?ee(M.SECTOR_STATE):l.key==="6"?ee(M.VERTEX_STATE):l.key==="7"?ee(M.FACE_STATE):l.key==="8"?ee(M.FACE_VALUE):l.key==="9"?ee(M.DELETE_FACE):l.key==="Escape"&&((n=J.value)==null||n.onUserEscape())});kt.keydownEmitter.addListener(l=>{l.key==="e"&&(at.value=!0)});kt.keyupEmitter.addListener(l=>{l.key==="e"&&(at.value=!1)});J.lazyLink((l,o)=>{o&&o.dispose()});
