import{o as O,a as Q}from"./UnivariatePolynomial-1rLpyqfN.js";import{N as F,V as x,e as m,H as f,T as N,D as G}from"./PhetioControlledVisibilityProperty-CzTgKbkx.js";import{P as K}from"./PatternRule-Bgza_EDD.js";import{P as U}from"./TextPushButton-Coq2A-51.js";import{p as X}from"./patternBoards-CVo-HFgJ.js";import{e as P,f as R,_}from"./getCoordinateClusteredMap-Bd_wM-c0.js";import{P as $}from"./PatternRuleNode-BIxdgGZq.js";import{P as W}from"./PatternBoardSolver-vRQRWARQ.js";import{F as v}from"./FeatureSet-RmLjQa6B.js";import{I as J,F as z,B as Y,R as Z}from"./SectorOnlyOneFeature-B1Nn5A2g.js";import{B as ee,R as te}from"./RichSolution-CJDHZecA.js";import{H as M}from"./Highlander-BB6x0e65.js";import{P as B}from"./PatternNode-Dqp5oWZV.js";import{g as ae,e as ie,E as ne}from"./DisplayEmbedding-DY121lQN.js";import{D,g as T}from"./getBestDisplayEmbedding-CAcmD-wd.js";import{l as oe,N as re}from"./Theme-DMXUyWiP.js";import"./getPeriodicTilingGenerator-zRiID_iR.js";import"./ShadedSphereNode-uuPU3yfJ.js";import"./logic-solver-DfsVuGQ5.js";import"./operations-BMyV0DHx.js";import"./BasicPuzzle-DGsxIJRd.js";import"./autoSolver-D0maTTyV.js";import"./BoardPatternBoard-C6phJJV1.js";const A=.5,se=ae(oe),le=ie(re);class de extends F{constructor(t,I){const p=O()({layoutWidth:1e3},I),c=new x({x:10,y:10,align:"left"}),V=d=>{c.addChild(new m(d,{margin:5}))},n=t.patternBoard,h=X.get(n);P()&&R(h);const g=(d,u=20)=>{c.addChild(new m(new N(d,{font:"bold 20px Arial",fill:"#ccc",tagName:"h1"}),{topMargin:u}))};g(`Generic Rule${t.highlander?" (Highlander)":""}`,0),V(new $(t,h,{scale:1.5}));{const d=W.getSolutions(n,t.inputFeatureSet.getFeaturesArray()),u=i=>{const o=v.empty(n);return t.inputFeatureSet.getFeaturesArray().forEach(a=>{a instanceof z&&o.addFeature(a)}),n.edges.forEach(a=>{a.isExit||(i.includes(a)?o.addBlackEdge(a):o.addRedEdge(a))}),o};if(t.highlander){const i=new ee(n,{solveEdges:!0,solveSectors:!1,solveFaceColors:!1}),a=W.getSolutions(n,t.inputFeatureSet.getHighlanderFeaturesArray()).map(e=>new te(n,i,e,!0)),l=M.filterWithFeatureSet(a,t.inputFeatureSet).filter(e=>e.isCompatibleWithFeatureSet(t.inputFeatureSet)),C=d.slice();l.forEach(e=>{const r=C.find(s=>s.length===e.solution.length&&s.every(L=>e.solutionSet.has(L)));P()&&R(r),Q(C,r)});const y=new Map;a.forEach(e=>{const r=M.getHighlanderKeyWithFeatureSet(e,t.inputFeatureSet);y.has(r)?y.get(r).push(e):y.set(r,[e])});const H=_.sortBy([...y.values()],e=>-e.length),j=H.filter(e=>e.length>1),q=H.filter(e=>e.length===1).map(e=>e[0]),k=[];q.forEach(e=>{const r=t.inputFeatureSet.clone();try{e.solution.forEach(s=>{r.addBlackEdge(s)}),n.edges.forEach(s=>{e.solutionSet.has(s)||r.addRedEdge(s)}),k.push(e)}catch(s){if(!(s instanceof J))throw s}}),g("Valid Solutions"),c.addChild(new m(new f({spacing:5,wrap:!0,justify:"left",lineSpacing:30,preferredWidth:p.layoutWidth,children:[...k.map(e=>new B(n,u(e.solution),h,{scale:A}))]}),{margin:5})),g("Highlander Duplicates (Invalid)"),c.addChild(new m(new f({spacing:40,wrap:!0,justify:"left",lineSpacing:30,preferredWidth:p.layoutWidth,children:j.map(e=>new f({spacing:5,children:[...e.map(r=>new B(n,u(r.solution),h,{scale:A}))]}))}),{margin:5}))}else{const o=W.getSolutions(n,t.inputFeatureSet.getFeaturesArray()).map(l=>v.fromSolution(n,l)),a=[],b=[];for(const l of o)t.outputFeatureSet.isCompatibleWith(l)?a.push(l):b.push(l);P()&&R(b.length===0),g("Valid Solutions"),c.addChild(new m(new f({spacing:5,wrap:!0,justify:"left",lineSpacing:30,preferredWidth:p.layoutWidth,children:[...a.map(l=>new B(n,l,h,{scale:A}))]}),{margin:5}))}}{const d=(i,o,a)=>new x({spacing:10,children:[new N(i,{font:"16px Arial",fill:"#ccc"}),new ne(t,o,{cursor:"pointer",scale:30,style:a})]}),u=D.enumeration.values.map(i=>{const o=T(t.patternBoard,i);return o?d(i.displayName,o,le):null}).filter(i=>!!i);{const i=T(t.patternBoard,D.SQUARE);i&&t.inputFeatureSet.getFeaturesArray().every(a=>a instanceof z||a instanceof Y||a instanceof Z)&&u.unshift(d("Classic Square",i,se))}g("Example Embeddings"),c.addChild(new F({layoutOptions:{topMargin:20},children:[new f({spacing:30,align:"top",wrap:!0,justify:"left",lineSpacing:30,preferredWidth:p.layoutWidth,children:u})]}))}p.children=[new U(c,{fill:"#333",stroke:null})],super(p),this.rule=t}}window.assertions.enableAssert();const ce=QueryStringMachine.getAll({r:{type:"string",defaultValue:"square-1-0/AQcODxARIib/ExkbIRwe/w=="}}),S=new F,ue=new F({renderer:"svg",children:[S]}),w=new G(ue,{allowWebGL:!0,allowBackingScaleAntialiasing:!0,allowSceneOverflow:!1});document.body.appendChild(w.domElement);w.setWidthHeight(window.innerWidth,window.innerHeight);console.log("test");(async()=>{const E=K.fromBinaryIdentifier(ce.r);if(console.log(E.serialize()),S.addChild(new de(E,{left:10,top:10})),S.bounds.isValid()){w.setWidthHeight(Math.ceil(S.right+10),Math.ceil(S.bottom+10)),w.updateDisplay();const t=new window.XMLSerializer().serializeToString(w.getRootBackbone().blocks[0].domElement);console.log(t)}})();
