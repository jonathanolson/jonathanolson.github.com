var gb=Object.defineProperty;var pb=(h,e,t)=>e in h?gb(h,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[e]=t;var br=(h,e,t)=>pb(h,typeof e!="symbol"?e+"":e,t);import{I as Ai,W as Tf,x as Uu,w as Wr,p as zs,P as wi,o as st,X as fb,Y as yn,A as Hi,J as Or,n as ai,F as us,b as ri,Z as rn,_ as nu,$ as Tl,a0 as Ft,v as ao,q as Ti,R as rr,a1 as Ut,y as an,T as Nt,t as ds,c as _i,f as is,a2 as mb,a3 as Tg,l as Yu,j as or,N as Mh,d as ct,a4 as ii,e as sa,S as ru,V as Pe,a5 as yo,a6 as ir,B as $e,M as Ze,E as Ur,a as Yr,a7 as Ks,k as Ba,a8 as qi,h as yb,a9 as bb,aa as di,ab as _b,D as In,ac as ni,r as xn,ad as Xs,G as si,ae as Ku,af as vb,ag as Lb,O as _t,ah as Pb,ai as Sb,aj as bo}from"./Vector2Property-CFyCN_2h.js";import{at as vt,au as Ci,k as Ui,av as wb,aw as qu,a4 as da,ax as ns,am as Cb,ay as Fa,az as au,aA as xl,aB as oa}from"./patternBoards-DzVBPT7g.js";const Dr=new Ai("BooleanIO",{supertype:Tf,valueType:"boolean",documentation:"PhET-iO Type for Javascript's boolean primitive type",stateSchema:Uu.asValue("boolean",{valueType:"boolean"}),toStateObject:_.identity});Wr.register("BooleanIO",Dr);class ci extends wi{constructor(e,t){const i=st()({valueType:"boolean",phetioValueType:Dr},t);super(e,i)}toggle(){this.value=!this.value}}zs.register("BooleanProperty",ci);const Wi=new fb;zs.register("stepTimer",Wi);class Rh{constructor(e){this.callbacks=[],this._delay=400,this._interval=100,this.delayID=null,this.intervalID=null,this.fired=!1,(e==null?void 0:e.delay)!==void 0&&(this.delay=e.delay),(e==null?void 0:e.interval)!==void 0&&(this.interval=e.interval),e!=null&&e.callback&&this.callbacks.push(e.callback)}isRunning(){return this.delayID!==null||this.intervalID!==null}start(){this.isRunning()||(this.fired=!1,this.delayID=Wi.setTimeout(()=>{this.delayID=null,this.intervalID=Wi.setInterval(()=>this.fire(),this.interval),this.fire()},this.delay))}stop(e){this.isRunning()&&(this.delayID&&(Wi.clearTimeout(this.delayID),this.delayID=null),this.intervalID&&(Wi.clearInterval(this.intervalID),this.intervalID=null),e&&!this.fired&&this.fire())}addCallback(e){this.callbacks.includes(e)||this.callbacks.push(e)}removeCallback(e){const t=this.callbacks.indexOf(e);t!==-1&&this.callbacks.splice(t,1)}fire(){const e=this.callbacks.slice(0);for(let t=0;t<e.length;t++)e[t]();this.fired=!0}set delay(e){assert&&assert(e>=0,`bad value for delay: ${e}`),this._delay=e}get delay(){return this._delay}set interval(e){assert&&assert(e>0,`bad value for interval: ${e}`),this._interval=e}get interval(){return this._interval}dispose(){this.stop(!1),this.callbacks.length=0}}zs.register("CallbackTimer",Rh);const pc={validateValidator:!1},xf=[];assert&&Object.freeze(xf);const Tb=["name","phetioType","phetioDocumentation","phetioPrivate"].concat(yn.VALIDATOR_KEYS),xg=h=>h.phetioType,xb=h=>h.name;class Xa extends Hi{constructor(e){var s;const t=st()({parameters:xf,hasListenerOrderDependencies:!1,phetioPlayback:Hi.DEFAULT_OPTIONS.phetioPlayback,phetioEventMetadata:Hi.DEFAULT_OPTIONS.phetioEventMetadata,phetioDocumentation:""},e);assert&&Xa.validateParameters(t.parameters,!!((s=t.tandem)!=null&&s.supplied)),assert&&assert(t.phetioType===void 0,"PhetioDataHandler sets its own phetioType. Instead provide parameter phetioTypes through `options.parameters` with a phetioOuterType");const i=t.parameters.filter(xg);t.phetioType=t.phetioOuterType(i.map(xg)),t.phetioPlayback&&(t.phetioEventMetadata=t.phetioEventMetadata||{},assert&&assert(!t.phetioEventMetadata.hasOwnProperty("dataKeys"),"dataKeys should be supplied by PhetioDataHandler, not elsewhere"),t.phetioEventMetadata.dataKeys=t.parameters.map(xb)),t.phetioDocumentation=Xa.getPhetioDocumentation(t.phetioDocumentation,i),super(t),this.parameters=t.parameters}static validateParameters(e,t){Or(e,{valueType:Array});let i=!1;for(let s=0;s<e.length;s++){const n=e[s];assert&&assert(Object.getPrototypeOf(n)===Object.prototype,"Extra prototype on parameter object is a code smell"),i=i||n.phetioPrivate,assert&&i&&assert(n.phetioPrivate,"after first phetioPrivate parameter, all subsequent parameters must be phetioPrivate"),assert&&t&&ai.VALIDATION&&assert(n.phetioType||n.phetioPrivate,"instrumented Emitters must include phetioType for each parameter or be marked as `phetioPrivate`."),assert&&n.phetioType&&assert(n.name,"`name` is a required parameter for phet-io instrumented parameters."),assert&&us(n,["phetioPrivate"],["name","phetioType","phetioDocumentation"]),assert&&assert(_.intersection(Object.keys(n),yn.VALIDATOR_KEYS).length>0,`validator must be specified for parameter ${s}`);for(const o in n)assert&&assert(Tb.includes(o),`unrecognized parameter key: ${o}`);assert&&Object.freeze(e[s]),yn.validateValidator(n)}assert&&Object.freeze(e)}validateArguments(...e){assert&&assert(e.length===this.parameters.length,`Emitted unexpected number of args. Expected: ${this.parameters.length} and received ${e.length}`);for(let t=0;t<this.parameters.length;t++){const i=this.parameters[t];assert&&Or(e[t],i,pc),i.phetioType&&!i.valueType&&assert&&Or(e[t],i.phetioType.validator,pc)}}getValidationErrors(...e){return assert&&assert(e.length===this.parameters.length,`Emitted unexpected number of args. Expected: ${this.parameters.length} and received ${e.length}`),this.parameters.map((t,i)=>yn.getValidationError(e[i],t,pc))}getPhetioData(...e){assert&&assert(ai.PHET_IO_ENABLED,"should only get phet-io data in phet-io brand");let t=null;if(this.parameters.length>0){t={};for(let i=0;i<this.parameters.length;i++){const s=this.parameters[i];s.phetioPrivate||(assert&&assert(s.name,"name required"),t[s.name]=s.phetioType.toStateObject(e[i]))}}return t}static getPhetioDocumentation(e,t){const i=s=>{const n=s.phetioDocumentation?` - ${s.phetioDocumentation}`:"";return`<li>${s.name}: ${s.phetioType.typeName}${n}</li>`};return e+(t.length===0?"<br>No parameters.":`<br>The parameters are:<br/><ol>${t.map(i).join("<br/>")}</ol>`)}}zs.register("PhetioDataHandler",Xa);const Ig=!1,ra=class ra extends Xa{constructor(e){const t=st()({reentrantNotificationStrategy:"stack",phetioOuterType:ra.EmitterIO,phetioState:Ig},e);super(t),this.tinyEmitter=new ri(null,t.hasListenerOrderDependencies,t.reentrantNotificationStrategy)}emit(...e){assert&&assert(this.tinyEmitter instanceof ri,"Emitter should not emit until constructor complete"),assert&&this.validateArguments(...e),ai.PHET_IO_ENABLED&&this.isPhetioInstrumented()&&this.phetioStartEvent("emitted",{data:this.getPhetioData(...e)}),this.tinyEmitter.emit(...e),ai.PHET_IO_ENABLED&&this.isPhetioInstrumented()&&this.phetioEndEvent()}dispose(){this.tinyEmitter.dispose(),super.dispose()}addListener(e){this.tinyEmitter.addListener(e)}removeListener(e){this.tinyEmitter.removeListener(e)}removeAllListeners(){this.tinyEmitter.removeAllListeners()}hasListener(e){return this.tinyEmitter.hasListener(e)}hasListeners(){return this.tinyEmitter.hasListeners()}getListenerCount(){return this.tinyEmitter.getListenerCount()}debug(e){const t=(...i)=>console.log(e,...i);return this.addListener(t),t}};ra.EmitterIO=e=>{const t=e.map(Dg).join(",");return fc.has(t)||fc.set(t,new Ai(`EmitterIO<${e.map(Dg).join(", ")}>`,{valueType:ra,documentation:"Emits when an event occurs and calls added listeners.",parameterTypes:e,events:["emitted"],metadataDefaults:{phetioState:Ig},methods:{addListener:{returnType:rn,parameterTypes:[nu(rn,e)],implementation:ra.prototype.addListener,documentation:"Adds a listener which will be called when the emitter emits."},removeListener:{returnType:rn,parameterTypes:[nu(rn,e)],implementation:ra.prototype.removeListener,documentation:"Remove a listener."},emit:{returnType:rn,parameterTypes:e,implementation:function(...i){this.emit(...i)},documentation:"Emits a single event to all listeners.",invocableForReadOnlyElements:!1},getValidationErrors:{returnType:Tl(Ft(Ti)),parameterTypes:e,implementation:function(...i){return this.getValidationErrors(...i)},documentation:"Checks to see if the proposed values are valid. Returns an array of length N where each element is an error (string) or null if the value is valid."}}})),fc.get(t)};let _s=ra;const Dg=h=>h.typeName,fc=new ao;zs.register("Emitter",_s);const Ib={valueType:"number",isValidValue:h=>h%1===0,validationMessage:"Should be a valid integer"},Db={isValidValue:h=>!isNaN(h),validationMessage:"Should not be NaN"},Ab={validateValidator:!1},Eb=["FloatingPoint","Integer"],mc="rangeProperty",Ag=rr.EVERYTHING,Eg=wi.PropertyIO(Ut),Wo=class Wo extends wi{constructor(e,t){var f;assert&&t&&us(["range"],["validValues"]);const i=st()({numberType:"FloatingPoint",range:Ag,validators:[],phetioOuterType:()=>Wo.NumberPropertyIO},t);i.rangePropertyOptions=st()({phetioDocumentation:"Provides the range of possible values for the parent NumberPropertyIO",phetioValueType:rr.RangeIO,phetioReadOnly:!0,tandem:i.range!==Ag?(f=i.tandem)==null?void 0:f.createTandem(mc):ai.OPT_OUT},i.rangePropertyOptions),assert&&ai.VALIDATION&&i.rangePropertyOptions.tandem&&i.rangePropertyOptions.tandem.supplied&&assert&&assert(i.rangePropertyOptions.tandem.name===mc,`rangePropertyOptions.tandem.name must be ${mc}: ${i.rangePropertyOptions.tandem.name}`),i.valueType="number",i.phetioValueType=Ut;const n=!(i.range&&i.range instanceof an),o=i.range instanceof an?i.range:new wi(i.range,i.rangePropertyOptions);i.validators.push(Db),i.numberType==="Integer"&&i.validators.push(Ib);let c=!1;i.validators.push({isValidValue:w=>o.value.contains(w),validationMessage:()=>`Number value ${c?this.value:e} must be within rangeProperty value: ${o.value}`}),super(e,i),c=!0,this.numberType=i.numberType,this.rangeProperty=o,assert&&ai.VALIDATION&&this.rangeProperty.isPhetioInstrumented()&&assert&&assert(this.isPhetioInstrumented(),"NumberProperty must be phet-io instrumented if the range is");const p=()=>{Or(this.value,this.valueValidator,Ab)};if(assert&&this.rangeProperty.link(p),this.rangeProperty.addPhetioStateDependencies([this]),this.addPhetioStateDependencies([this.rangeProperty]),i.validValues&&this.validateNumberAndRangeProperty)for(let w=0;w<i.validValues.length;w++){const O=i.validValues[w];this.validateNumberAndRangeProperty(O)}this.disposeNumberProperty=()=>{n?this.rangeProperty.dispose():assert&&this.rangeProperty.unlink(p)},this.resetNumberProperty=()=>{n&&this.rangeProperty.reset()}}get range(){return this.rangeProperty.value}set range(e){this.rangeProperty.value=e}reset(){this.resetValueAndRange(),super.reset()}dispose(){this.disposeNumberProperty(),super.dispose()}setValueAndRange(e,t){assert&&assert(t.contains(e),`value ${e} is not in range [${t.min},${t.max}]`),this.setDeferred(!0),this.rangeProperty.setDeferred(!0),this.set(e),this.rangeProperty.set(t);const i=this.setDeferred(!1),s=this.rangeProperty.setDeferred(!1);i&&i(),s&&s()}resetValueAndRange(){this.setValueAndRange(this.initialValue,this.rangeProperty.initialValue)}toStateObject(){const e=super.toStateObject();return _.assignIn({numberType:this.numberType,range:rr.RangeIO.toStateObject(this.rangeProperty.value),rangePhetioID:this.rangeProperty&&this.rangeProperty.isPhetioInstrumented()?this.rangeProperty.tandem.phetioID:null},e)}};Wo.NumberPropertyIO=new Ai("NumberPropertyIO",{valueType:Wo,supertype:Eg,parameterTypes:[Ut],documentation:`Extends PropertyIO to add values for the numeric range ( min, max ) and numberType ( '${Eb.join("' | '")}' )`,toStateObject:e=>e.toStateObject(),applyState:(e,t)=>{Eg.applyState(e,t)},stateSchema:{numberType:Ti,range:rr.RangeIO,rangePhetioID:Ft(Ti)}});let Wn=Wo;zs.register("NumberProperty",Wn);const kb=new Nt(!1),ja=kb;Wr.register("isSettingPhetioStateProperty",ja);const Xu=h=>{var O,T,z,U;us(h,["length"],["elements"]);const e=st()({hasListenerOrderDependencies:!1,length:0,elements:[],elementAddedEmitterOptions:{},elementRemovedEmitterOptions:{},lengthPropertyOptions:{}},h);let t=null;if(e.phetioType)assert&&assert(e.phetioType.typeName.startsWith("ObservableArrayIO")),t={name:"value",phetioType:e.phetioType.parameterTypes[0]};else if(yn.getValidatorValidationError(e))t=ds({name:"value"},{isValidValue:_.stubTrue});else{const m=_.pick(e,yn.VALIDATOR_KEYS);t=ds({name:"value"},m)}const i=new _s(_i({tandem:(O=e.tandem)==null?void 0:O.createTandem("elementAddedEmitter"),parameters:[t],phetioReadOnly:!0,hasListenerOrderDependencies:e.hasListenerOrderDependencies},e.elementAddedEmitterOptions)),s=new _s(_i({tandem:(T=e.tandem)==null?void 0:T.createTandem("elementRemovedEmitter"),parameters:[t],phetioReadOnly:!0,hasListenerOrderDependencies:e.hasListenerOrderDependencies},e.elementRemovedEmitterOptions)),n=new Wn(0,_i({numberType:"Integer",tandem:(z=e.tandem)==null?void 0:z.createTandem("lengthProperty"),phetioReadOnly:!0,hasListenerOrderDependencies:e.hasListenerOrderDependencies},e.lengthPropertyOptions)),o=[];assert&&i.addListener(()=>{ja.value||assert&&assert(n.value===o.length,"lengthProperty out of sync while adding element")}),assert&&s.addListener(()=>{ja.value||assert&&assert(n.value===o.length,"lengthProperty out of sync while removing element")});const c=[],p=(m,Y)=>{f.notificationsDeferred?f.deferredActions.push(()=>m.emit(Y)):m.emit(Y)},f=new Proxy(o,{get:function(m,Y,j){return assert&&assert(m===o,"array should match the targetArray"),kg.hasOwnProperty(Y)?kg[Y]:Reflect.get(m,Y,j)},set:function(m,Y,j){assert&&assert(m===o,"array should match the targetArray");const le=m[Y];let xe=null;Y==="length"&&(xe=m.slice(j));const ce=Reflect.set(m,Y,j),ne=Number(Y);return Number.isInteger(ne)&&ne>=0&&le!==j?(n.value=m.length,le!==void 0&&p(s,m[Y]),j!==void 0&&p(i,j)):Y==="length"&&(n.value=j,assert&&assert(xe,"removedElements should be defined for key===length"),xe&&xe.forEach(me=>p(s,me))),ce},deleteProperty:function(m,Y){assert&&assert(m===o,"array should match the targetArray");const j=Number(Y);let le;Number.isInteger(j)&&j>=0&&(le=m[Y]);const xe=Reflect.deleteProperty(m,Y);return le!==void 0&&p(s,le),xe}});f.targetArray=o,f.notificationsDeferred=!1,f.emitNotification=p,f.deferredActions=c,f.elementAddedEmitter=i,f.elementRemovedEmitter=s,f.lengthProperty=n;const w=()=>{e.length>=0&&(f.length=e.length),e.elements.length>0&&Array.prototype.push.apply(f,e.elements)};if(w(),f.reset=()=>{f.length=0,w()},(U=e.tandem)!=null&&U.supplied&&(assert&&assert(e.phetioType),f.phetioElementType=e.phetioType.parameterTypes[0],f._observableArrayPhetioObject=new If(f,e),ai.PHET_IO_ENABLED)){assert&&assert(_.hasIn(self,"phet.phetio.phetioEngine.phetioStateEngine"),"PhET-iO Instrumented ObservableArrays must be created once phetioEngine has been constructed");const m=phet.phetio.phetioEngine.phetioStateEngine;m.clearDynamicElementsEmitter.addListener((Y,j)=>{var le;(le=f._observableArrayPhetioObject)!=null&&le.tandem.hasAncestor(j)&&(f.length=0,f.setNotificationsDeferred(!0))}),m.undeferEmitter.addListener(()=>{f.notificationsDeferred&&f.setNotificationsDeferred(!1)}),m.addSetStateHelper(()=>f.deferredActions.length>0?(f.deferredActions.shift()(),!0):!1)}return f};class If extends Hi{constructor(e,t){super(t),this.observableArray=e}}const kg={pop(...h){const e=this,t=e.targetArray.length,i=Array.prototype.pop.apply(e.targetArray,h);return e.lengthProperty.value=e.length,t>0&&e.emitNotification(e.elementRemovedEmitter,i),i},shift(...h){const e=this,t=e.targetArray.length,i=Array.prototype.shift.apply(e.targetArray,h);return e.lengthProperty.value=e.length,t>0&&e.emitNotification(e.elementRemovedEmitter,i),i},push(...h){const e=this,t=Array.prototype.push.apply(e.targetArray,h);e.lengthProperty.value=e.length;for(let i=0;i<arguments.length;i++)e.emitNotification(e.elementAddedEmitter,h[i]);return t},unshift(...h){const e=this,t=Array.prototype.unshift.apply(e.targetArray,h);e.lengthProperty.value=e.length;for(let i=0;i<h.length;i++)e.emitNotification(e.elementAddedEmitter,h[i]);return t},splice(...h){const e=this,t=Array.prototype.splice.apply(e.targetArray,h);e.lengthProperty.value=e.length;const i=t;for(let s=2;s<h.length;s++)e.emitNotification(e.elementAddedEmitter,h[s]);return i.forEach(s=>e.emitNotification(e.elementRemovedEmitter,s)),t},copyWithin(...h){const e=this,t=e.targetArray.slice(),i=Array.prototype.copyWithin.apply(e.targetArray,h);return Og(t,e),i},fill(...h){const e=this,t=e.targetArray.slice(),i=Array.prototype.fill.apply(e.targetArray,h);return Og(t,e),i},get:function(h){return this[h]},addItemAddedListener:function(h){this.elementAddedEmitter.addListener(h)},removeItemAddedListener:function(h){this.elementAddedEmitter.removeListener(h)},addItemRemovedListener:function(h){this.elementRemovedEmitter.addListener(h)},removeItemRemovedListener:function(h){this.elementRemovedEmitter.removeListener(h)},add:function(h){this.push(h)},addAll:function(h){this.push(...h)},remove:function(h){is(this,h)},removeAll:function(h){h.forEach(e=>is(this,e))},clear:function(){for(;this.length>0;)this.pop()},count:function(h){let e=0;for(let t=0;t<this.length;t++)h(this[t])&&e++;return e},find:function(h,e){return assert&&e!==void 0&&assert(typeof e=="number","fromIndex must be numeric, if provided"),assert&&typeof e=="number"&&assert(e>=0&&e<this.length,`fromIndex out of bounds: ${e}`),_.find(this,h,e)},shuffle:function(h){assert&&assert(h,"random must be supplied");const e=h.shuffle(this);this.targetArray.length=0,Array.prototype.push.apply(this.targetArray,e)},getArrayCopy:function(){return this.slice()},dispose:function(){const h=this;h.elementAddedEmitter.dispose(),h.elementRemovedEmitter.dispose(),h.lengthProperty.dispose(),h._observableArrayPhetioObject&&h._observableArrayPhetioObject.dispose()},toStateObject:function(){return{array:this.map(h=>this.phetioElementType.toStateObject(h))}},applyState:function(h){assert&&assert(this.length===0,"ObservableArrays should be cleared at the beginning of state setting."),this.length=0;const e=h.array.map(t=>this.phetioElementType.fromStateObject(t));this.push(...e)},setNotificationsDeferred:function(h){if(!h)for(;this.deferredActions.length>0;)this.deferredActions.shift()();this.notificationsDeferred=h}},Og=(h,e)=>{const t=h,i=e.targetArray.slice();for(let s=0;s<t.length;s++){const n=t[s],o=i.indexOf(n);o>=0&&(t.splice(s,1),i.splice(o,1),s--)}t.forEach(s=>e.emitNotification(e.elementRemovedEmitter,s)),i.forEach(s=>e.emitNotification(e.elementAddedEmitter,s))},yc=new ao,Ob=h=>(yc.has(h)||yc.set(h,new Ai(`ObservableArrayIO<${h.typeName}>`,{valueType:If,parameterTypes:[h],toStateObject:e=>e.observableArray.toStateObject(),applyState:(e,t)=>e.observableArray.applyState(t),stateSchema:{array:Tl(h)}})),yc.get(h));Xu.ObservableArrayIO=Ob;zs.register("createObservableArray",Xu);const Mb="DerivedPropertyIO";function bc(h,e){return h(...e.map(t=>t.get()))}class Si extends an{constructor(e,t,i){const s=st()({phetioReadOnly:!0,phetioOuterType:Si.DerivedPropertyIO,phetioLinkDependencies:!0},i);assert&&assert(e.every(_.identity),"dependencies should all be truthy"),assert&&assert(e.length===_.uniq(e).length,"duplicate dependencies");const n=bc(t,e);super(n,s),ai.VALIDATION&&this.isPhetioInstrumented()&&assert&&assert(this.phetioType.typeName.startsWith("DerivedPropertyIO"),"phetioType should be DerivedPropertyIO"),this.dependencies=e,this.derivation=t,this.derivedPropertyListener=this.getDerivedPropertyListener.bind(this),e.forEach(o=>{if(o.lazyLink(this.derivedPropertyListener),ai.PHET_IO_ENABLED&&this.isPhetioInstrumented()&&o instanceof Hi&&o.isPhetioInstrumented()&&(o instanceof an&&mb.registerPhetioOrderDependency(o,Tg.UNDEFER,this,Tg.UNDEFER),s.tandem&&s.phetioLinkDependencies)){const c=s.tandem.createTandem("dependencies");this.addLinkedElement(o,{tandem:c.createTandemFromPhetioID(o.tandem.phetioID)})}})}hasDependency(e){return this.definedDependencies.includes(e)}get definedDependencies(){return assert&&assert(this.dependencies!==null,"Dependencies should be defined, has this Property been disposed?"),this.dependencies}getDerivedPropertyListener(){this.isDisposed||(this.isDeferred?this.hasDeferredValue=!0:super.set(bc(this.derivation,this.definedDependencies)))}recomputeDerivation(){this.getDerivedPropertyListener()}dispose(){const e=this.definedDependencies;for(let t=0;t<e.length;t++){const i=e[t];i.hasListener(this.derivedPropertyListener)&&i.unlink(this.derivedPropertyListener)}this.dependencies=null,super.dispose()}setDeferred(e){return this.isDeferred&&!e&&(this.deferredValue=bc(this.derivation,this.definedDependencies)),super.setDeferred(e)}static valueEquals(e,t,i){return new Si([e,t],(s,n)=>s===n,i)}static valueEqualsConstant(e,t,i){return new Si([e],s=>s===t,i)}static and(e,t){return assert&&assert(e.length>0,"must provide a dependency"),Si.deriveAny(e,()=>_.reduce(e,Rb,!0),t)}static or(e,t){return assert&&assert(e.length>0,"must provide a dependency"),Si.deriveAny(e,()=>_.reduce(e,Nb,!1),t)}static multiply(e,t){return assert&&assert(e.length>0,"must provide a dependency"),Si.deriveAny(e,()=>_.reduce(e,Bb,1),t)}static add(e,t){return assert&&assert(e.length>0,"must provide a dependency"),Si.deriveAny(e,()=>_.reduce(e,Fb,0),t)}static not(e,t){return new Si([e],i=>!i,t)}static deriveAny(e,t,i){return new Si(e,t,i)}}const Rb=(h,e)=>h&&e.value,Nb=(h,e)=>(assert&&assert(typeof e.value=="boolean","boolean value required"),h||e.value),Bb=(h,e)=>(assert&&assert(typeof e.value=="number","number value required"),h*e.value),Fb=(h,e)=>(assert&&assert(typeof e.value=="number","number value required"),h+e.value),_c=new ao;Si.DerivedPropertyIO=h=>(assert&&assert(h,"DerivedPropertyIO needs parameterType"),_c.has(h)||_c.set(h,new Ai(`${Mb}<${h.typeName}>`,{valueType:Si,parameterTypes:[h],supertype:wi.PropertyIO(h),documentation:"Like PropertyIO, but not settable.  Instead it is derived from other DerivedPropertyIO or PropertyIO instances",applyState:_.noop,methods:{setValue:{returnType:rn,parameterTypes:[h],implementation:Si.prototype.set,documentation:"Errors out when you try to set a derived property.",invocableForReadOnlyElements:!1}}})),_c.get(h));class Df extends Si{}class VP extends Si{}class zP extends Si{}class $P extends Si{}zs.register("DerivedProperty",Si);class Af extends an{constructor(e,t){const i=st()({bidirectional:!1,defaultValue:null,derive:_.identity,map:_.identity,inverseMap:_.identity},t),s=i.derive,n=i.map,o=i.inverseMap,c=typeof s=="function"?s:O=>O[s],p=typeof n=="function"?n:O=>O[n],f=typeof o=="function"?o:O=>O[o],w=e.value===null?p(i.defaultValue):p(c(e.value).value);super(w,i),this.defaultValue=i.defaultValue,this.derive=c,this.map=p,this.inverseMap=f,this.bidirectional=i.bidirectional,this.valuePropertyProperty=e,this.isExternallyChanging=!1,this.propertyPropertyListener=this.onPropertyPropertyChange.bind(this),this.propertyListener=this.onPropertyChange.bind(this),e.link(this.propertyListener),i.bidirectional&&this.lazyLink(this.onSelfChange.bind(this))}onPropertyPropertyChange(e,t,i){this.bidirectional&&this.valuePropertyProperty.value!==null&&i&&this.derive(this.valuePropertyProperty.value)===i&&i.areValuesEqual(this.inverseMap(this.value),i.get())||super.set(this.map(e))}onPropertyChange(e,t){t&&this.derive(t).unlink(this.propertyPropertyListener),e?this.derive(e).link(this.propertyPropertyListener):this.onPropertyPropertyChange(this.defaultValue,null,null)}onSelfChange(e){if(assert&&assert(this.bidirectional),this.valuePropertyProperty.value!==null){const t=this.derive(this.valuePropertyProperty.value);this.areValuesEqual(e,this.map(t.value))||(t.value=this.inverseMap(e))}}dispose(){this.valuePropertyProperty.unlink(this.propertyListener),this.valuePropertyProperty.value!==null&&this.derive(this.valuePropertyProperty.value).unlink(this.propertyPropertyListener),super.dispose()}reset(){assert&&assert(this.bidirectional,"Cannot reset a non-bidirectional DynamicProperty"),this.valuePropertyProperty.value!==null&&this.derive(this.valuePropertyProperty.value).reset()}set(e){assert&&assert(this.bidirectional,`Cannot set values directly to a non-bidirectional DynamicProperty, tried to set: ${e}${this.isPhetioInstrumented()?" for "+this.phetioID:""}`),this.isExternallyChanging=!0,super.set(e),this.isExternallyChanging=!1}get value(){return super.value}set value(e){this.set(e)}isSettable(){return super.isSettable()||this.bidirectional}}zs.register("DynamicProperty",Af);const vc="enabledProperty";class pl extends ci{constructor(e,t){const i=st()({phetioDocumentation:"Determines whether the element is enabled (true) or disabled (false).",phetioFeatured:!0,checkTandemName:!0},t);assert&&i&&i.tandem&&i.tandem.supplied&&i.checkTandemName&&assert&&assert(i.tandem.name===vc,`EnabledProperty tandems should be named ${vc}`),super(e,i)}static get TANDEM_NAME(){return vc}}zs.register("EnabledProperty",pl);const Hb={enabledProperty:null,enabled:!0,enabledPropertyOptions:null,phetioEnabledPropertyInstrumented:!0,tandem:Hi.DEFAULT_OPTIONS.tandem};class Il extends Yu{constructor(e){const t=or()({},Hb,e),i=!t.enabledProperty;assert&&t.enabledPropertyOptions&&assert(!(!t.phetioEnabledPropertyInstrumented&&t.enabledPropertyOptions.tandem),"incompatible options. Cannot specify phetioEnabledPropertyInstrumented opt out and a Tandem via enabledPropertyOptions."),super(t),this.enabledProperty=t.enabledProperty||new pl(t.enabled,ds({tandem:t.phetioEnabledPropertyInstrumented?t.tandem.createTandem(pl.TANDEM_NAME):ai.OPT_OUT},t.enabledPropertyOptions)),this.disposeEnabledComponent=()=>{i&&this.enabledProperty.dispose()}}setEnabled(e){assert&&assert(this.enabledProperty.isSettable(),"cannot set enabledProperty"),this.enabledProperty.value=e}set enabled(e){this.setEnabled(e)}get enabled(){return this.isEnabled()}isEnabled(){return this.enabledProperty.value}dispose(){this.disposeEnabledComponent(),super.dispose()}}zs.register("EnabledComponent",Il);class Ar{constructor(e,t,i){if(this.dependencies=e,assert&&assert(e.every(_.identity),"dependencies should all be truthy"),assert&&assert(e.length===_.uniq(e).length,"duplicate dependencies"),this.dependencyListeners=new Map,e.forEach(s=>{const n=()=>{if(!this.isDisposed){const o=e.map(c=>c.get());t(...o)}};this.dependencyListeners.set(s,n),s.lazyLink(n,{phetioDependencies:_.without(e,s)})}),!i){const s=e.map(n=>n.get());t(...s)}this.isDisposed=!1}get definedDependencies(){return assert&&assert(this.dependencies!==null,"Dependencies should be defined, has this Property been disposed?"),this.dependencies}dispose(){assert&&assert(this.dependencies,"A Multilink cannot be disposed twice.");const e=this.definedDependencies;for(let t=0;t<e.length;t++){const i=e[t],s=this.dependencyListeners.get(i);assert&&assert(s,"The listener should exist"),i.hasListener(s)&&i.unlink(s)}this.dependencies=null,this.dependencyListeners.clear(),this.isDisposed=!0}static multilink(e,t){return new Ar(e,t,!1)}static multilinkAny(e,t){return new Ar(e,t)}static lazyMultilink(e,t){return new Ar(e,t,!0)}static lazyMultilinkAny(e,t){return new Ar(e,t,!0)}static unmultilink(e){e.dispose()}}zs.register("Multilink",Ar);function ft(h){return h instanceof an||h instanceof Nt}class Nh extends wi{constructor(e,t){t&&(assert&&assert(!t.hasOwnProperty("valueType"),"StringProperty sets valueType"),assert&&assert(!t.hasOwnProperty("phetioType"),"StringProperty sets phetioType"));const i=st()({valueType:"string",phetioValueType:Ti},t);super(e,i)}}zs.register("StringProperty",Nh);class $n extends Nt{constructor(e,t=!1,i){super(e,i),t&&(this.targetPropertyInstrumented=t),assert&&(this.phetioInitialized=!1)}setValueOrTargetProperty(e,t,i){if(ft(i))this.setTargetProperty(i,e,t);else{const s=this.get();this.clearTargetProperty(),assert&&assert(!this.targetProperty,"just cleared"),this.setPropertyValue(i),this.areValuesEqual(s,i)||this.notifyListeners(s)}}setTargetProperty(e,t=null,i=null){if(assert&&t&&i===null&&this.targetPropertyInstrumented&&assert(!t.isPhetioInstrumented(),"tandemName must be provided for instrumented Nodes"),this.targetProperty===e)return t;const s=this.targetProperty&&this.targetProperty instanceof an&&this.targetProperty.isPhetioInstrumented();assert&&s&&assert(e&&e instanceof an&&e.isPhetioInstrumented(),"Cannot set swap out a PhET-iO instrumented targetProperty for an uninstrumented one");const n=this.targetProperty;this.ownedPhetioProperty&&e!==this.ownedPhetioProperty&&this.disposeOwnedPhetioProperty(),t&&i!==null&&t.updateLinkedElementForProperty(i,n,e);const o=this.get();return this.clearTargetProperty(),this.targetProperty=e,this.targetProperty?(assert&&assert(this.forwardingListener,"forwardingListener is not set yet"),this.targetProperty.lazyLink(this.forwardingListener),this.setPropertyValue(this.targetProperty.value)):this.setPropertyValue(o),this.areValuesEqual(o,this.get())||this.notifyListeners(o),t}clearTargetProperty(){this.forwardingListener=this.forwardingListener||this.onTargetPropertyChange.bind(this),this.targetProperty&&this.targetProperty.unlink(this.forwardingListener),this.targetProperty=null}onTargetPropertyChange(e){super.set(e)}set(e){return this.targetProperty?(assert&&assert(this.targetProperty.isSettable(),"targetProperty must be settable"),this.targetProperty.set(e)):super.set(e),this}setTargetPropertyInstrumented(e,t){return assert&&assert(!t.isPhetioInstrumented(),"this option only works if it is passed in before this Node is instrumented"),this.targetPropertyInstrumented=e,t}getTargetPropertyInstrumented(){return this.targetPropertyInstrumented||!1}initializePhetio(e,t,i){assert&&assert(!this.phetioInitialized,"already initialized"),assert&&assert(!this.ownedPhetioProperty,"Already created the ownedPhetioProperty"),!this.targetProperty&&this.targetPropertyInstrumented?(this.ownedPhetioProperty=i(),assert&&assert(this.ownedPhetioProperty instanceof wi,"The owned property should be an AXON/Property"),assert&&assert(this.ownedPhetioProperty instanceof an&&this.ownedPhetioProperty.isPhetioInstrumented(),"The owned property should be PhET-iO instrumented"),this.setTargetProperty(this.ownedPhetioProperty,e,t)):this.targetProperty&&this.targetProperty instanceof an&&this.targetProperty.isPhetioInstrumented()&&e.updateLinkedElementForProperty(t,null,this.targetProperty),assert&&(this.phetioInitialized=!0)}getTargetProperty(){return this.targetProperty||null}disposeOwnedPhetioProperty(){this.ownedPhetioProperty&&(this.ownedPhetioProperty.dispose(),delete this.ownedPhetioProperty)}dispose(){this.clearTargetProperty(),this.disposeOwnedPhetioProperty(),super.dispose()}}zs.register("TinyForwardingProperty",$n);class Ho extends Nt{constructor(e,t){super(e),this.onAccessAttempt=t}get(){return this.onAccessAttempt(),super.get()}set(e){throw new Error("Cannot set a TinyStaticProperty value")}isSettable(){return!1}notifyListeners(e){this.emit(this.get(),e,this)}link(e){this.addListener(e),e(this.get(),null,this)}equalsValue(e){return this.areValuesEqual(e,this.get())}}zs.register("TinyStaticProperty",Ho);const ui=new Mh("kite"),Vb=ct.lineLineIntersection,Ma={lineWidth:1,lineCap:"butt",lineJoin:"miter",lineDash:[],lineDashOffset:0,miterLimit:10};class Qa{constructor(e){const t=ds({},Ma,e);this.lineWidth=t.lineWidth,this.lineCap=t.lineCap,this.lineJoin=t.lineJoin,this.lineDash=t.lineDash,this.lineDashOffset=t.lineDashOffset,this.miterLimit=t.miterLimit,assert&&assert(typeof this.lineWidth=="number",`lineWidth should be a number: ${this.lineWidth}`),assert&&assert(isFinite(this.lineWidth),`lineWidth should be a finite number: ${this.lineWidth}`),assert&&assert(this.lineWidth>=0,`lineWidth should be non-negative: ${this.lineWidth}`),assert&&assert(this.lineCap==="butt"||this.lineCap==="round"||this.lineCap==="square",`Invalid lineCap: ${this.lineCap}`),assert&&assert(this.lineJoin==="miter"||this.lineJoin==="round"||this.lineJoin==="bevel",`Invalid lineJoin: ${this.lineJoin}`),assert&&assert(Array.isArray(this.lineDash),`lineDash should be an array: ${this.lineDash}`),assert&&assert(_.every(this.lineDash,i=>typeof i=="number"&&isFinite(i)&&i>=0),`Every lineDash should be a non-negative finite number: ${this.lineDash}`),assert&&assert(typeof this.lineDashOffset=="number",`lineDashOffset should be a number: ${this.lineDashOffset}`),assert&&assert(isFinite(this.lineDashOffset),`lineDashOffset should be a finite number: ${this.lineDashOffset}`),assert&&assert(typeof this.miterLimit=="number",`miterLimit should be a number: ${this.miterLimit}`),assert&&assert(isFinite(this.miterLimit),`miterLimit should be a finite number: ${this.miterLimit}`)}equals(e){if(!(this.lineWidth===e.lineWidth&&this.lineCap===e.lineCap&&this.lineJoin===e.lineJoin&&this.miterLimit===e.miterLimit&&this.lineDashOffset===e.lineDashOffset))return!1;if(this.lineDash.length===e.lineDash.length){for(let i=0;i<this.lineDash.length;i++)if(this.lineDash[i]!==e.lineDash[i])return!1}else return!1;return!0}copy(){return new Qa({lineWidth:this.lineWidth,lineCap:this.lineCap,lineJoin:this.lineJoin,lineDash:this.lineDash,lineDashOffset:this.lineDashOffset,miterLimit:this.miterLimit})}leftJoin(e,t,i){t=t.normalized(),i=i.normalized();const s=e.plus(t.perpendicular.negated().times(this.lineWidth/2)),n=e.plus(i.perpendicular.negated().times(this.lineWidth/2)),o=s.equals(n)?[]:[new Ct(s,n)];let c,p,f;if(t.perpendicular.dot(i)>1e-12)switch(this.lineJoin){case"round":return c=t.angle+Math.PI/2,p=i.angle+Math.PI/2,[new Zt(e,this.lineWidth/2,c,p,!0)];case"miter":if(f=t.angleBetween(i.negated()),1/Math.sin(f/2)<=this.miterLimit&&f<Math.PI-1e-5){const w=Vb(s,s.plus(t),n,n.plus(i));return w?[new Ct(s,w),new Ct(w,n)]:[new Ct(s,n)]}else return o;case"bevel":return o;default:throw new Error(`invalid lineJoin: ${this.lineJoin}`)}else return o}rightJoin(e,t,i){return this.leftJoin(e,i.negated(),t.negated())}cap(e,t){t=t.normalized();const i=e.plus(t.perpendicular.times(-this.lineWidth/2)),s=e.plus(t.perpendicular.times(this.lineWidth/2));let n,o,c,p,f,w;switch(this.lineCap){case"butt":return[new Ct(i,s)];case"round":return n=t.angle,[new Zt(e,this.lineWidth/2,n+Math.PI/2,n-Math.PI/2,!0)];case"square":return o=t.perpendicular.negated().times(this.lineWidth/2),c=t.perpendicular.times(this.lineWidth/2),p=t.times(this.lineWidth/2),f=e.plus(o).plus(p),w=e.plus(c).plus(p),[new Ct(i,f),new Ct(f,w),new Ct(w,s)];default:throw new Error(`invalid lineCap: ${this.lineCap}`)}}}ui.register("LineStyles",Qa);class ya{constructor(e,t){assert&&assert(isFinite(e)&&e!==0,"a should be a finite non-zero number"),assert&&assert(isFinite(t),"b should be a finite number"),this.a=e,this.b=t;let i=0,s=1,n=this.apply(i),o=this.apply(s);n>1&&(n=1,i=this.applyInverse(n)),n<0&&(n=0,i=this.applyInverse(n)),o>1&&(o=1,s=this.applyInverse(o)),o<0&&(o=0,s=this.applyInverse(o)),this.t0=i,this.t1=s,e>0?(this.qt0=n,this.qt1=o):(this.qt0=o,this.qt1=n),this.t0<0&&this.t0>-1e-8&&(this.t0=0),this.t0>1&&this.t0<1+1e-8&&(this.t0=1),this.t1<0&&this.t1>-1e-8&&(this.t1=0),this.t1>1&&this.t1<1+1e-8&&(this.t1=1),this.qt0<0&&this.qt0>-1e-8&&(this.qt0=0),this.qt0>1&&this.qt0<1+1e-8&&(this.qt0=1),this.qt1<0&&this.qt1>-1e-8&&(this.qt1=0),this.qt1>1&&this.qt1<1+1e-8&&(this.qt1=1),assert&&assert(this.t0>=0&&this.t0<=1,`t0 out of range: ${this.t0}`),assert&&assert(this.t1>=0&&this.t1<=1,`t1 out of range: ${this.t1}`),assert&&assert(this.qt0>=0&&this.qt0<=1,`qt0 out of range: ${this.qt0}`),assert&&assert(this.qt1>=0&&this.qt1<=1,`qt1 out of range: ${this.qt1}`)}apply(e){return this.a*e+this.b}applyInverse(e){return(e-this.b)/this.a}static createLinear(e,t,i,s){const n=(s-t)/(i-e);return new ya(n,t-e*n)}}ui.register("Overlap",ya);class Mr{constructor(e,t,i,s,n){assert&&assert(isFinite(e)&&e>=0,"invalid distance"),assert&&assert(Math.abs(i.magnitude-1)<1e-7,"invalid normal"),assert&&assert(n>=-1e-10&&n<=1+1e-10,`t out of range: ${n}`),this.point=t,this.normal=i,this.distance=e,this.wind=s,this.t=ct.clamp(n,0,1)}}ui.register("RayIntersection",Mr);class vs{constructor(e,t,i){assert&&assert(t>=-1e-10&&t<=1+1e-10,"aT out of range"),assert&&assert(i>=-1e-10&&i<=1+1e-10,"bT out of range"),this.point=e,this.aT=ct.clamp(t,0,1),this.bT=ct.clamp(i,0,1)}getSwapped(){return new vs(this.point,this.bT,this.aT)}}ui.register("SegmentIntersection",vs);const Xt=h=>h.toFixed(20);ui.register("svgNumber",Xt);const jn=(h,e,t,i)=>h.times(i).minus(e.times(t)),zb=h=>{const e=h[0],t=h[1],i=h[2],s=h[3],n=h[4],o=h[5],c=h[6],p=h[7],f=h[8];return e.times(n).times(f).plus(t.times(o).times(c)).plus(i.times(s).times(p)).minus(i.times(n).times(c)).minus(t.times(s).times(f)).minus(e.times(o).times(p))},$b=h=>{const e=h[0],t=h[1],i=h[2],s=h[3],n=h[4],o=h[5],c=h[6],p=h[7],f=h[8];return[jn(n,o,p,f),jn(t,i,p,f).negate(),jn(t,i,n,o),jn(s,o,c,f).negate(),jn(e,i,c,f),jn(e,i,s,o).negate(),jn(s,n,c,p),jn(e,t,c,p).negate(),jn(e,t,s,n)]},Gb=h=>[h[0],h[3],h[6],h[1],h[4],h[7],h[2],h[5],h[8]],ju=(h,e=!1)=>_.sortBy([h.slice(0,3),h.slice(3,6),h.slice(6,9)],t=>-(t[0].magnitude+t[1].magnitude+(e?t[2].magnitude:0)))[0],Wb=(h,e=!1)=>ju(Gb(h),e),Ub=h=>{const e=$b(h),t=ju(e);return[ii.ZERO,t[2],t[1].negated(),t[2].negated(),ii.ZERO,t[0],t[1],t[0].negated(),ii.ZERO]},Yb=(h,e)=>{const t=h[0],i=h[1],s=h[3],n=h[4],o=e[0],c=e[1],p=e[3],f=e[4],w=c.times(p).minus(o.times(f)),O=f.negated().times(t).plus(p.times(i)).plus(c.times(s)).minus(o.times(n)),T=i.times(s).minus(t.times(n)),z=ii.solveQuadraticRoots(w,O,T);return z===null?null:z[0]},Kb=h=>{const e=Ub(h),t=Yb(h,e);return t===null?h:[h[0].plus(t.times(e[0])),h[1].plus(t.times(e[1])),h[2].plus(t.times(e[2])),h[3].plus(t.times(e[3])),h[4].plus(t.times(e[4])),h[5].plus(t.times(e[5])),h[6].plus(t.times(e[6])),h[7].plus(t.times(e[7])),h[8].plus(t.times(e[8]))]},qb=h=>{const e=[],t=h[0],i=h[1].times(ii.real(2)),s=h[4],n=h[2].times(ii.real(2)),o=h[5].times(ii.real(2)),c=h[8];let p=[];const f=new ii(-2.51653525696959,1.5292850284402),w=s,O=i.times(f).plus(o),T=t.times(f).times(f).plus(n.times(f)).plus(c),z=ii.solveQuadraticRoots(w,O,T);if(z&&z.length>=2)p=[[f,z[0]],[f,z[1]]];else{const U=t,m=i.times(f).plus(n),Y=s.times(f).times(f).plus(o.times(f)).plus(c),j=ii.solveQuadraticRoots(U,m,Y);if(j&&j.length>=2)p=[[j[0],f],[j[1],f]];else if(z&&z.length===1)p=[[f,z[0]]];else if(j&&j.length===1)p=[[j[0],f]];else throw new Error("Implement more advanced initialization to find two solutions")}return p.forEach(U=>{const m=U[0].real,Y=U[1].real,j=U[0].imaginary,le=U[1].imaginary,xe=t.real,ce=i.real,ne=s.real,me=n.real,Fe=o.real,we=t.imaginary,He=i.imaginary,Me=s.imaginary,ze=n.imaginary,Je=o.imaginary,Ee=new yo(-2*we*j-He*le+me+2*xe*m+ce*Y,-He*j-2*Me*le+Fe+ce*m+2*ne*Y,-ze-2*j*xe-le*ce-2*we*m-He*Y,-Je-j*ce-2*le*ne-He*m-2*Me*Y),rt=new yo(ze+2*j*xe+le*ce+2*we*m+He*Y,Je+j*ce+2*le*ne+He*m+2*Me*Y,-2*we*j-He*le+me+2*xe*m+ce*Y,-He*j-2*Me*le+Fe+ce*m+2*ne*Y),Ie=new yo(6.1951068548253,-1.159268950386,.1602918829294,3.205818692048202),Re=new yo(-5.420628549296924,-15.2069583028685,.159590602048868,5.10688288040682),We=(Vt,hi)=>hi.timesScalar(Vt.dot(hi)/hi.dot(hi)),Ve=Ee,Qe=rt.minus(We(rt,Ve)),Ot=Ie.minus(We(Ie,Ve)).minus(We(Ie,Qe)),Tt=Re.minus(We(Re,Ve)).minus(We(Re,Qe)).minus(We(Re,Ot)),ot=new sa(2,2,[Ot.z,Tt.z,Ot.w,Tt.w]),gt=new ru(ot).getSingularValues();let Lt=null;if(Math.abs(j)<1e-10&&Math.abs(le)<1e-10)Lt=new Pe(m,Y);else{if(Math.abs(gt[1])>1e-10){const Vt=ot.solve(new sa(2,1,[-j,-le])).extractVector2(0);Lt=new Pe(m+Vt.x*Ot.z+Vt.y*Tt.z,Y+Vt.x*Ot.w+Vt.y*Tt.w)}else if(Math.abs(gt[0])>1e-10){const Vt=Math.abs(Ot.z)+Math.abs(Ot.w)>Math.abs(Tt.z)+Math.abs(Tt.w)?Ot:Tt,hi=new Pe(Vt.z,Vt.w),Oi=new Pe(j,le).dot(hi)/hi.dot(hi),St=new yo(m,Y,j,le).minus(Vt.timesScalar(Oi));Math.abs(St.z)<1e-8&&Math.abs(St.w)<1e-8&&(Lt=new Pe(St.x,St.y))}else Lt=null;if(Lt){if(Math.abs(gt[1])>1e-10)e.push(Lt);else if(Math.abs(gt[0])>1e-10){const Vt=Math.abs(Ot.z)+Math.abs(Ot.w)>Math.abs(Tt.z)+Math.abs(Tt.w),hi=Vt?Tt:Ot,Oi=Vt?Ot:Tt,Ht=Math.abs(Oi.z)>Math.abs(Oi.w)?hi.z/Oi.z:hi.w/Oi.w,jt=Oi.timesScalar(Ht).minus(hi);e.push(new ir(Lt,new Pe(jt.x,jt.y).normalized()))}}}}),e},Xb=h=>{const e=Kb(h);return[ju(e),Wb(e)]},_o=(h,e)=>{const t=h[0],i=h[1],s=h[2],n=e[0],o=e[1],c=e[2],p=n.times(i).minus(t.times(o));if(p.equalsEpsilon(ii.ZERO,1e-8))return null;{const f=o.times(s).minus(i.times(c)).dividedBy(p);let w;if(!i.equalsEpsilon(ii.ZERO,1e-8))w=t.negated().times(f).minus(s).dividedBy(i);else if(!o.equalsEpsilon(ii.ZERO,1e-8))w=n.negated().times(f).minus(c).dividedBy(o);else return null;return Math.abs(f.imaginary)<1e-8&&Math.abs(w.imaginary)<1e-8?new Pe(f.real,w.real):null}},jb=(h,e)=>{const t=h.m00(),i=h.m01(),s=h.m02(),n=h.m10(),o=h.m11(),c=h.m12(),p=h.m20(),f=h.m21(),w=h.m22(),O=e.m00(),T=e.m01(),z=e.m02(),U=e.m10(),m=e.m11(),Y=e.m12(),j=e.m20(),le=e.m21(),xe=e.m22(),ce=-s*o*p+i*c*p+s*n*f-t*c*f-i*n*w+t*o*w,ne=-n*w*T+n*f*z+s*f*U-i*w*U-s*p*m+t*w*m+i*p*Y-t*f*Y+s*n*le+c*(-f*O+p*T+i*j-t*le)-i*n*xe+o*(w*O-p*z-s*j+t*xe),me=-w*T*U+f*z*U+w*O*m-p*z*m-f*O*Y+p*T*Y+c*T*j-o*z*j-s*m*j+i*Y*j-c*O*le+n*z*le+s*U*le-t*Y*le+o*O*xe-n*T*xe-i*U*xe+t*m*xe,Fe=-z*m*j+T*Y*j+z*U*le-O*Y*le-T*U*xe+O*m*xe,we=ii.solveCubicRoots(ii.real(ce),ii.real(ne),ii.real(me),ii.real(Fe));if(!we||we.length===0)return{degenerateConicMatrices:[],intersectionCollections:[],points:[],lines:[]};const Me=_.uniqWith(we,(rt,Ie)=>rt.equals(Ie)).map(rt=>[ii.real(t).multiply(rt).add(ii.real(O)),ii.real(i).multiply(rt).add(ii.real(T)),ii.real(s).multiply(rt).add(ii.real(z)),ii.real(n).multiply(rt).add(ii.real(U)),ii.real(o).multiply(rt).add(ii.real(m)),ii.real(c).multiply(rt).add(ii.real(Y)),ii.real(p).multiply(rt).add(ii.real(j)),ii.real(f).multiply(rt).add(ii.real(le)),ii.real(w).multiply(rt).add(ii.real(xe))]);console.log("determinant magnitudes",Me.map(rt=>zb(rt).magnitude));const ze=[],Je=Me.map(Xb);console.log(Je);const Ee=Me.map(qb);console.log(Ee);for(let rt=0;rt<Je.length;rt++){const Ie=Je[rt],Re=_o(Ie[0],Ie[1]);Re&&ze.push(Re);for(let We=rt+1;We<Je.length;We++){const Ve=Je[We],Qe=[_o(Ie[0],Ve[0]),_o(Ie[0],Ve[1]),_o(Ie[1],Ve[0]),_o(Ie[1],Ve[1])];for(let Ot=0;Ot<4;Ot++){const Tt=Qe[Ot];Tt&&ze.push(Tt)}}}return{points:ze,degenerateConicMatrices:Me,lines:_.flatten(Je),intersectionCollections:Ee}};ui.register("intersectConicMatrices",jb);function Ef(h){return'"'+h.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}const Qu={parse:function(h,e){const t={svgPath:c,movetoDrawtoCommandGroups:p,movetoDrawtoCommandGroup:f,drawtoCommands:w,drawtoCommand:O,moveto:T,movetoArgumentSequence:z,closepath:U,lineto:m,linetoArgumentSequence:Y,horizontalLineto:j,horizontalLinetoArgumentSequence:le,verticalLineto:xe,verticalLinetoArgumentSequence:ce,curveto:ne,curvetoArgumentSequence:me,curvetoArgument:Fe,smoothCurveto:we,smoothCurvetoArgumentSequence:He,smoothCurvetoArgument:Me,quadraticBezierCurveto:ze,quadraticBezierCurvetoArgumentSequence:Je,quadraticBezierCurvetoArgument:Ee,smoothQuadraticBezierCurveto:rt,smoothQuadraticBezierCurvetoArgumentSequence:Ie,ellipticalArc:Re,ellipticalArcArgumentSequence:We,ellipticalArcArgument:Ve,coordinatePair:Qe,nonnegativeNumber:Ot,number:Tt,flag:ot,commaWsp:gt,comma:Lt,floatingPointConstant:Vt,fractionalConstant:hi,exponent:Oi,sign:St,digitSequence:Ht,digit:jt,wsp:lt};if(e!==void 0){if(t[e]===void 0)throw new Error("Invalid rule name: "+Ef(e)+".")}else e="svgPath";let i=0,s=0,n=[];function o(b){i<s||(i>s&&(s=i,n=[]),n.push(b))}function c(){let b,J,ie,re,ye,Xe;for(ye=i,Xe=i,b=[],J=lt();J!==null;)b.push(J),J=lt();if(b!==null)if(J=p(),J=J!==null?J:"",J!==null){for(ie=[],re=lt();re!==null;)ie.push(re),re=lt();ie!==null?b=[b,J,ie]:(b=null,i=Xe)}else b=null,i=Xe;else b=null,i=Xe;return b!==null&&(b=function(Ne,Be){return Be||[]}(ye,b[1])),b===null&&(i=ye),b}function p(){let b,J,ie,re,ye;if(re=i,ye=i,b=f(),b!==null){for(J=[],ie=lt();ie!==null;)J.push(ie),ie=lt();J!==null?(ie=p(),ie!==null?b=[b,J,ie]:(b=null,i=ye)):(b=null,i=ye)}else b=null,i=ye;return b!==null&&(b=function(Xe,Ne,Be){return Ne.concat(Be)}(re,b[0],b[2])),b===null&&(i=re),b===null&&(re=i,b=f(),b!==null&&(b=function(Xe,Ne){return Ne}(re,b)),b===null&&(i=re)),b}function f(){let b,J,ie,re,ye;if(re=i,ye=i,b=T(),b!==null){for(J=[],ie=lt();ie!==null;)J.push(ie),ie=lt();J!==null?(ie=w(),ie=ie!==null?ie:"",ie!==null?b=[b,J,ie]:(b=null,i=ye)):(b=null,i=ye)}else b=null,i=ye;return b!==null&&(b=function(Xe,Ne,Be){return Be.length?Ne.concat(Be):Ne}(re,b[0],b[2])),b===null&&(i=re),b}function w(){let b,J,ie,re,ye;if(re=i,ye=i,b=O(),b!==null){for(J=[],ie=lt();ie!==null;)J.push(ie),ie=lt();J!==null?(ie=w(),ie!==null?b=[b,J,ie]:(b=null,i=ye)):(b=null,i=ye)}else b=null,i=ye;return b!==null&&(b=function(Xe,Ne,Be){return Ne.concat(Be)}(re,b[0],b[2])),b===null&&(i=re),b===null&&(re=i,b=O(),b!==null&&(b=function(Xe,Ne){return Ne}(re,b)),b===null&&(i=re)),b}function O(){let b;return b=U(),b===null&&(b=m(),b===null&&(b=j(),b===null&&(b=xe(),b===null&&(b=ne(),b===null&&(b=we(),b===null&&(b=ze(),b===null&&(b=rt(),b===null&&(b=Re())))))))),b}function T(){let b,J,ie,re,ye;if(re=i,ye=i,h.charCodeAt(i)===77?(b="M",i++):(b=null,o('"M"')),b!==null){for(J=[],ie=lt();ie!==null;)J.push(ie),ie=lt();J!==null?(ie=z(),ie!==null?b=[b,J,ie]:(b=null,i=ye)):(b=null,i=ye)}else b=null,i=ye;if(b!==null&&(b=function(Xe,Ne){return ps(Ne,!1)}(re,b[2])),b===null&&(i=re),b===null){if(re=i,ye=i,h.charCodeAt(i)===109?(b="m",i++):(b=null,o('"m"')),b!==null){for(J=[],ie=lt();ie!==null;)J.push(ie),ie=lt();J!==null?(ie=z(),ie!==null?b=[b,J,ie]:(b=null,i=ye)):(b=null,i=ye)}else b=null,i=ye;b!==null&&(b=function(Xe,Ne){return ps(Ne,!0)}(re,b[2])),b===null&&(i=re)}return b}function z(){let b,J,ie,re,ye;return re=i,ye=i,b=Qe(),b!==null?(J=gt(),J=J!==null?J:"",J!==null?(ie=Y(),ie!==null?b=[b,J,ie]:(b=null,i=ye)):(b=null,i=ye)):(b=null,i=ye),b!==null&&(b=function(Xe,Ne,Be){return[Ne].concat(Be)}(re,b[0],b[2])),b===null&&(i=re),b===null&&(re=i,b=Qe(),b!==null&&(b=function(Xe,Ne){return[Ne]}(re,b)),b===null&&(i=re)),b}function U(){let b,J;return J=i,h.charCodeAt(i)===90?(b="Z",i++):(b=null,o('"Z"')),b===null&&(h.charCodeAt(i)===122?(b="z",i++):(b=null,o('"z"'))),b!==null&&(b=function(ie,re){return{cmd:"close"}}()),b===null&&(i=J),b}function m(){let b,J,ie,re,ye;if(re=i,ye=i,h.charCodeAt(i)===76?(b="L",i++):(b=null,o('"L"')),b!==null){for(J=[],ie=lt();ie!==null;)J.push(ie),ie=lt();J!==null?(ie=Y(),ie!==null?b=[b,J,ie]:(b=null,i=ye)):(b=null,i=ye)}else b=null,i=ye;if(b!==null&&(b=function(Xe,Ne){return Ne.map(Be=>({cmd:"lineTo",args:[Be.x,Be.y]}))}(re,b[2])),b===null&&(i=re),b===null){if(re=i,ye=i,h.charCodeAt(i)===108?(b="l",i++):(b=null,o('"l"')),b!==null){for(J=[],ie=lt();ie!==null;)J.push(ie),ie=lt();J!==null?(ie=Y(),ie!==null?b=[b,J,ie]:(b=null,i=ye)):(b=null,i=ye)}else b=null,i=ye;b!==null&&(b=function(Xe,Ne){return Ne.map(Be=>({cmd:"lineToRelative",args:[Be.x,Be.y]}))}(re,b[2])),b===null&&(i=re)}return b}function Y(){let b,J,ie,re,ye;return re=i,ye=i,b=Qe(),b!==null?(J=gt(),J=J!==null?J:"",J!==null?(ie=Y(),ie!==null?b=[b,J,ie]:(b=null,i=ye)):(b=null,i=ye)):(b=null,i=ye),b!==null&&(b=function(Xe,Ne,Be){return[Ne].concat(Be)}(re,b[0],b[2])),b===null&&(i=re),b===null&&(re=i,b=Qe(),b!==null&&(b=function(Xe,Ne){return[Ne]}(re,b)),b===null&&(i=re)),b}function j(){let b,J,ie,re,ye;if(re=i,ye=i,h.charCodeAt(i)===72?(b="H",i++):(b=null,o('"H"')),b!==null){for(J=[],ie=lt();ie!==null;)J.push(ie),ie=lt();J!==null?(ie=le(),ie!==null?b=[b,J,ie]:(b=null,i=ye)):(b=null,i=ye)}else b=null,i=ye;if(b!==null&&(b=function(Xe,Ne){return Ne.map(Be=>({cmd:"horizontalLineTo",args:[Be]}))}(re,b[2])),b===null&&(i=re),b===null){if(re=i,ye=i,h.charCodeAt(i)===104?(b="h",i++):(b=null,o('"h"')),b!==null){for(J=[],ie=lt();ie!==null;)J.push(ie),ie=lt();J!==null?(ie=le(),ie!==null?b=[b,J,ie]:(b=null,i=ye)):(b=null,i=ye)}else b=null,i=ye;b!==null&&(b=function(Xe,Ne){return Ne.map(Be=>({cmd:"horizontalLineToRelative",args:[Be]}))}(re,b[2])),b===null&&(i=re)}return b}function le(){let b,J,ie,re,ye;return re=i,ye=i,b=Tt(),b!==null?(J=gt(),J=J!==null?J:"",J!==null?(ie=le(),ie!==null?b=[b,J,ie]:(b=null,i=ye)):(b=null,i=ye)):(b=null,i=ye),b!==null&&(b=function(Xe,Ne,Be){return[Ne].concat(Be)}(re,b[0],b[2])),b===null&&(i=re),b===null&&(re=i,b=Tt(),b!==null&&(b=function(Xe,Ne){return[Ne]}(re,b)),b===null&&(i=re)),b}function xe(){let b,J,ie,re,ye;if(re=i,ye=i,h.charCodeAt(i)===86?(b="V",i++):(b=null,o('"V"')),b!==null){for(J=[],ie=lt();ie!==null;)J.push(ie),ie=lt();J!==null?(ie=ce(),ie!==null?b=[b,J,ie]:(b=null,i=ye)):(b=null,i=ye)}else b=null,i=ye;if(b!==null&&(b=function(Xe,Ne){return Ne.map(Be=>({cmd:"verticalLineTo",args:[Be]}))}(re,b[2])),b===null&&(i=re),b===null){if(re=i,ye=i,h.charCodeAt(i)===118?(b="v",i++):(b=null,o('"v"')),b!==null){for(J=[],ie=lt();ie!==null;)J.push(ie),ie=lt();J!==null?(ie=ce(),ie!==null?b=[b,J,ie]:(b=null,i=ye)):(b=null,i=ye)}else b=null,i=ye;b!==null&&(b=function(Xe,Ne){return Ne.map(Be=>({cmd:"verticalLineToRelative",args:[Be]}))}(re,b[2])),b===null&&(i=re)}return b}function ce(){let b,J,ie,re,ye;return re=i,ye=i,b=Tt(),b!==null?(J=gt(),J=J!==null?J:"",J!==null?(ie=ce(),ie!==null?b=[b,J,ie]:(b=null,i=ye)):(b=null,i=ye)):(b=null,i=ye),b!==null&&(b=function(Xe,Ne,Be){return[Ne].concat(Be)}(re,b[0],b[2])),b===null&&(i=re),b===null&&(re=i,b=Tt(),b!==null&&(b=function(Xe,Ne){return[Ne]}(re,b)),b===null&&(i=re)),b}function ne(){let b,J,ie,re,ye;if(re=i,ye=i,h.charCodeAt(i)===67?(b="C",i++):(b=null,o('"C"')),b!==null){for(J=[],ie=lt();ie!==null;)J.push(ie),ie=lt();J!==null?(ie=me(),ie!==null?b=[b,J,ie]:(b=null,i=ye)):(b=null,i=ye)}else b=null,i=ye;if(b!==null&&(b=function(Xe,Ne){return Ne.map(Be=>({cmd:"cubicCurveTo",args:Be}))}(re,b[2])),b===null&&(i=re),b===null){if(re=i,ye=i,h.charCodeAt(i)===99?(b="c",i++):(b=null,o('"c"')),b!==null){for(J=[],ie=lt();ie!==null;)J.push(ie),ie=lt();J!==null?(ie=me(),ie!==null?b=[b,J,ie]:(b=null,i=ye)):(b=null,i=ye)}else b=null,i=ye;b!==null&&(b=function(Xe,Ne){return Ne.map(Be=>({cmd:"cubicCurveToRelative",args:Be}))}(re,b[2])),b===null&&(i=re)}return b}function me(){let b,J,ie,re,ye;return re=i,ye=i,b=Fe(),b!==null?(J=gt(),J=J!==null?J:"",J!==null?(ie=me(),ie!==null?b=[b,J,ie]:(b=null,i=ye)):(b=null,i=ye)):(b=null,i=ye),b!==null&&(b=function(Xe,Ne,Be){return[Ne].concat(Be)}(re,b[0],b[2])),b===null&&(i=re),b===null&&(re=i,b=Fe(),b!==null&&(b=function(Xe,Ne){return[Ne]}(re,b)),b===null&&(i=re)),b}function Fe(){let b,J,ie,re,ye,Xe,Ne;return Xe=i,Ne=i,b=Qe(),b!==null?(J=gt(),J=J!==null?J:"",J!==null?(ie=Qe(),ie!==null?(re=gt(),re=re!==null?re:"",re!==null?(ye=Qe(),ye!==null?b=[b,J,ie,re,ye]:(b=null,i=Ne)):(b=null,i=Ne)):(b=null,i=Ne)):(b=null,i=Ne)):(b=null,i=Ne),b!==null&&(b=function(Be,r,a,l){return[r.x,r.y,a.x,a.y,l.x,l.y]}(Xe,b[0],b[2],b[4])),b===null&&(i=Xe),b}function we(){let b,J,ie,re,ye;if(re=i,ye=i,h.charCodeAt(i)===83?(b="S",i++):(b=null,o('"S"')),b!==null){for(J=[],ie=lt();ie!==null;)J.push(ie),ie=lt();J!==null?(ie=He(),ie!==null?b=[b,J,ie]:(b=null,i=ye)):(b=null,i=ye)}else b=null,i=ye;if(b!==null&&(b=function(Xe,Ne){return Ne.map(Be=>({cmd:"smoothCubicCurveTo",args:Be}))}(re,b[2])),b===null&&(i=re),b===null){if(re=i,ye=i,h.charCodeAt(i)===115?(b="s",i++):(b=null,o('"s"')),b!==null){for(J=[],ie=lt();ie!==null;)J.push(ie),ie=lt();J!==null?(ie=He(),ie!==null?b=[b,J,ie]:(b=null,i=ye)):(b=null,i=ye)}else b=null,i=ye;b!==null&&(b=function(Xe,Ne){return Ne.map(Be=>({cmd:"smoothCubicCurveToRelative",args:Be}))}(re,b[2])),b===null&&(i=re)}return b}function He(){let b,J,ie,re,ye;return re=i,ye=i,b=Me(),b!==null?(J=gt(),J=J!==null?J:"",J!==null?(ie=He(),ie!==null?b=[b,J,ie]:(b=null,i=ye)):(b=null,i=ye)):(b=null,i=ye),b!==null&&(b=function(Xe,Ne,Be){return[Ne].concat(Be)}(re,b[0],b[2])),b===null&&(i=re),b===null&&(re=i,b=Me(),b!==null&&(b=function(Xe,Ne){return[Ne]}(re,b)),b===null&&(i=re)),b}function Me(){let b,J,ie,re,ye;return re=i,ye=i,b=Qe(),b!==null?(J=gt(),J=J!==null?J:"",J!==null?(ie=Qe(),ie!==null?b=[b,J,ie]:(b=null,i=ye)):(b=null,i=ye)):(b=null,i=ye),b!==null&&(b=function(Xe,Ne,Be){return[Ne.x,Ne.y,Be.x,Be.y]}(re,b[0],b[2])),b===null&&(i=re),b}function ze(){let b,J,ie,re,ye;if(re=i,ye=i,h.charCodeAt(i)===81?(b="Q",i++):(b=null,o('"Q"')),b!==null){for(J=[],ie=lt();ie!==null;)J.push(ie),ie=lt();J!==null?(ie=Je(),ie!==null?b=[b,J,ie]:(b=null,i=ye)):(b=null,i=ye)}else b=null,i=ye;if(b!==null&&(b=function(Xe,Ne){return Ne.map(Be=>({cmd:"quadraticCurveTo",args:Be}))}(re,b[2])),b===null&&(i=re),b===null){if(re=i,ye=i,h.charCodeAt(i)===113?(b="q",i++):(b=null,o('"q"')),b!==null){for(J=[],ie=lt();ie!==null;)J.push(ie),ie=lt();J!==null?(ie=Je(),ie!==null?b=[b,J,ie]:(b=null,i=ye)):(b=null,i=ye)}else b=null,i=ye;b!==null&&(b=function(Xe,Ne){return Ne.map(Be=>({cmd:"quadraticCurveToRelative",args:Be}))}(re,b[2])),b===null&&(i=re)}return b}function Je(){let b,J,ie,re,ye;return re=i,ye=i,b=Ee(),b!==null?(J=gt(),J=J!==null?J:"",J!==null?(ie=Je(),ie!==null?b=[b,J,ie]:(b=null,i=ye)):(b=null,i=ye)):(b=null,i=ye),b!==null&&(b=function(Xe,Ne,Be){return[Ne].concat(Be)}(re,b[0],b[2])),b===null&&(i=re),b===null&&(re=i,b=Ee(),b!==null&&(b=function(Xe,Ne){return[Ne]}(re,b)),b===null&&(i=re)),b}function Ee(){let b,J,ie,re,ye;return re=i,ye=i,b=Qe(),b!==null?(J=gt(),J=J!==null?J:"",J!==null?(ie=Qe(),ie!==null?b=[b,J,ie]:(b=null,i=ye)):(b=null,i=ye)):(b=null,i=ye),b!==null&&(b=function(Xe,Ne,Be){return[Ne.x,Ne.y,Be.x,Be.y]}(re,b[0],b[2])),b===null&&(i=re),b}function rt(){let b,J,ie,re,ye;if(re=i,ye=i,h.charCodeAt(i)===84?(b="T",i++):(b=null,o('"T"')),b!==null){for(J=[],ie=lt();ie!==null;)J.push(ie),ie=lt();J!==null?(ie=Ie(),ie!==null?b=[b,J,ie]:(b=null,i=ye)):(b=null,i=ye)}else b=null,i=ye;if(b!==null&&(b=function(Xe,Ne){return Ne.map(Be=>({cmd:"smoothQuadraticCurveTo",args:[Be.x,Be.y]}))}(re,b[2])),b===null&&(i=re),b===null){if(re=i,ye=i,h.charCodeAt(i)===116?(b="t",i++):(b=null,o('"t"')),b!==null){for(J=[],ie=lt();ie!==null;)J.push(ie),ie=lt();J!==null?(ie=Ie(),ie!==null?b=[b,J,ie]:(b=null,i=ye)):(b=null,i=ye)}else b=null,i=ye;b!==null&&(b=function(Xe,Ne){return Ne.map(Be=>({cmd:"smoothQuadraticCurveToRelative",args:[Be.x,Be.y]}))}(re,b[2])),b===null&&(i=re)}return b}function Ie(){let b,J,ie,re,ye;return re=i,ye=i,b=Qe(),b!==null?(J=gt(),J=J!==null?J:"",J!==null?(ie=Ie(),ie!==null?b=[b,J,ie]:(b=null,i=ye)):(b=null,i=ye)):(b=null,i=ye),b!==null&&(b=function(Xe,Ne,Be){return[Ne].concat(Be)}(re,b[0],b[2])),b===null&&(i=re),b===null&&(re=i,b=Qe(),b!==null&&(b=function(Xe,Ne){return[Ne]}(re,b)),b===null&&(i=re)),b}function Re(){let b,J,ie,re,ye;if(re=i,ye=i,h.charCodeAt(i)===65?(b="A",i++):(b=null,o('"A"')),b!==null){for(J=[],ie=lt();ie!==null;)J.push(ie),ie=lt();J!==null?(ie=We(),ie!==null?b=[b,J,ie]:(b=null,i=ye)):(b=null,i=ye)}else b=null,i=ye;if(b!==null&&(b=function(Xe,Ne){return Ne.map(Be=>(Be[2]*=Math.PI/180,{cmd:"ellipticalArcTo",args:Be}))}(re,b[2])),b===null&&(i=re),b===null){if(re=i,ye=i,h.charCodeAt(i)===97?(b="a",i++):(b=null,o('"a"')),b!==null){for(J=[],ie=lt();ie!==null;)J.push(ie),ie=lt();J!==null?(ie=We(),ie!==null?b=[b,J,ie]:(b=null,i=ye)):(b=null,i=ye)}else b=null,i=ye;b!==null&&(b=function(Xe,Ne){return Ne.map(Be=>(Be[2]*=Math.PI/180,{cmd:"ellipticalArcToRelative",args:Be}))}(re,b[2])),b===null&&(i=re)}return b}function We(){let b,J,ie,re,ye;return re=i,ye=i,b=Ve(),b!==null?(J=gt(),J=J!==null?J:"",J!==null?(ie=We(),ie!==null?b=[b,J,ie]:(b=null,i=ye)):(b=null,i=ye)):(b=null,i=ye),b!==null&&(b=function(Xe,Ne,Be){return[Ne].concat(Be)}(re,b[0],b[2])),b===null&&(i=re),b===null&&(re=i,b=Ve(),b!==null&&(b=function(Xe,Ne){return[Ne]}(re,b)),b===null&&(i=re)),b}function Ve(){let b,J,ie,re,ye,Xe,Ne,Be,r,a,l,u,g;return u=i,g=i,b=Ot(),b!==null?(J=gt(),J=J!==null?J:"",J!==null?(ie=Ot(),ie!==null?(re=gt(),re=re!==null?re:"",re!==null?(ye=Tt(),ye!==null?(Xe=gt(),Xe!==null?(Ne=ot(),Ne!==null?(Be=gt(),Be=Be!==null?Be:"",Be!==null?(r=ot(),r!==null?(a=gt(),a=a!==null?a:"",a!==null?(l=Qe(),l!==null?b=[b,J,ie,re,ye,Xe,Ne,Be,r,a,l]:(b=null,i=g)):(b=null,i=g)):(b=null,i=g)):(b=null,i=g)):(b=null,i=g)):(b=null,i=g)):(b=null,i=g)):(b=null,i=g)):(b=null,i=g)):(b=null,i=g)):(b=null,i=g),b!==null&&(b=function(y,P,L,C,x,k,M){return[P,L,C,x,k,M.x,M.y]}(u,b[0],b[2],b[4],b[6],b[8],b[10])),b===null&&(i=u),b}function Qe(){let b,J,ie,re,ye;return re=i,ye=i,b=Tt(),b!==null?(J=gt(),J=J!==null?J:"",J!==null?(ie=Tt(),ie!==null?b=[b,J,ie]:(b=null,i=ye)):(b=null,i=ye)):(b=null,i=ye),b!==null&&(b=function(Xe,Ne,Be){return{x:Ne,y:Be}}(re,b[0],b[2])),b===null&&(i=re),b}function Ot(){let b,J;return J=i,b=Vt(),b!==null&&(b=function(ie,re){return parseFloat(re)}(J,b)),b===null&&(i=J),b===null&&(J=i,b=Ht(),b!==null&&(b=function(ie,re){return Number(re)}(J,b)),b===null&&(i=J)),b}function Tt(){let b,J,ie,re;return ie=i,re=i,b=St(),b=b!==null?b:"",b!==null?(J=Vt(),J!==null?b=[b,J]:(b=null,i=re)):(b=null,i=re),b!==null&&(b=function(ye,Xe,Ne){return parseFloat(Xe+Ne)}(ie,b[0],b[1])),b===null&&(i=ie),b===null&&(ie=i,re=i,b=St(),b=b!==null?b:"",b!==null?(J=Ht(),J!==null?b=[b,J]:(b=null,i=re)):(b=null,i=re),b!==null&&(b=function(ye,Xe,Ne){return Number(Xe+Ne)}(ie,b[0],b[1])),b===null&&(i=ie)),b}function ot(){let b,J;return J=i,h.charCodeAt(i)===48?(b="0",i++):(b=null,o('"0"')),b!==null&&(b=function(ie){return!1}()),b===null&&(i=J),b===null&&(J=i,h.charCodeAt(i)===49?(b="1",i++):(b=null,o('"1"')),b!==null&&(b=function(ie){return!0}()),b===null&&(i=J)),b}function gt(){let b,J,ie,re,ye;if(ye=i,J=lt(),J!==null)for(b=[];J!==null;)b.push(J),J=lt();else b=null;if(b!==null)if(J=Lt(),J=J!==null?J:"",J!==null){for(ie=[],re=lt();re!==null;)ie.push(re),re=lt();ie!==null?b=[b,J,ie]:(b=null,i=ye)}else b=null,i=ye;else b=null,i=ye;if(b===null)if(ye=i,b=Lt(),b!==null){for(J=[],ie=lt();ie!==null;)J.push(ie),ie=lt();J!==null?b=[b,J]:(b=null,i=ye)}else b=null,i=ye;return b}function Lt(){let b;return h.charCodeAt(i)===44?(b=",",i++):(b=null,o('","')),b}function Vt(){let b,J,ie,re;return ie=i,re=i,b=hi(),b!==null?(J=Oi(),J=J!==null?J:"",J!==null?b=[b,J]:(b=null,i=re)):(b=null,i=re),b!==null&&(b=function(ye,Xe,Ne){return Xe+Ne}(ie,b[0],b[1])),b===null&&(i=ie),b===null&&(ie=i,re=i,b=Ht(),b!==null?(J=Oi(),J!==null?b=[b,J]:(b=null,i=re)):(b=null,i=re),b!==null&&(b=function(ye,Xe,Ne){return Xe+Ne}(ie,b[0],b[1])),b===null&&(i=ie)),b}function hi(){let b,J,ie,re,ye;return re=i,ye=i,b=Ht(),b=b!==null?b:"",b!==null?(h.charCodeAt(i)===46?(J=".",i++):(J=null,o('"."')),J!==null?(ie=Ht(),ie!==null?b=[b,J,ie]:(b=null,i=ye)):(b=null,i=ye)):(b=null,i=ye),b!==null&&(b=function(Xe,Ne,Be){return Ne+"."+Be}(re,b[0],b[2])),b===null&&(i=re),b===null&&(re=i,ye=i,b=Ht(),b!==null?(h.charCodeAt(i)===46?(J=".",i++):(J=null,o('"."')),J!==null?b=[b,J]:(b=null,i=ye)):(b=null,i=ye),b!==null&&(b=function(Xe,Ne){return Ne}(re,b[0])),b===null&&(i=re)),b}function Oi(){let b,J,ie,re,ye;return re=i,ye=i,h.charCodeAt(i)===101?(b="e",i++):(b=null,o('"e"')),b===null&&(h.charCodeAt(i)===69?(b="E",i++):(b=null,o('"E"'))),b!==null?(J=St(),J=J!==null?J:"",J!==null?(ie=Ht(),ie!==null?b=[b,J,ie]:(b=null,i=ye)):(b=null,i=ye)):(b=null,i=ye),b!==null&&(b=function(Xe,Ne,Be,r){return Ne+Be+r}(re,b[0],b[1],b[2])),b===null&&(i=re),b}function St(){let b;return h.charCodeAt(i)===43?(b="+",i++):(b=null,o('"+"')),b===null&&(h.charCodeAt(i)===45?(b="-",i++):(b=null,o('"-"'))),b}function Ht(){let b,J,ie,re;return ie=i,re=i,b=jt(),b!==null?(J=Ht(),J!==null?b=[b,J]:(b=null,i=re)):(b=null,i=re),b!==null&&(b=function(ye,Xe,Ne){return Xe+Ne}(ie,b[0],b[1])),b===null&&(i=ie),b===null&&(b=jt()),b}function jt(){let b;return/^[0-9]/.test(h.charAt(i))?(b=h.charAt(i),i++):(b=null,o("[0-9]")),b}function lt(){let b;return h.charCodeAt(i)===32?(b=" ",i++):(b=null,o('" "')),b===null&&(h.charCodeAt(i)===9?(b="	",i++):(b=null,o('"\\t"')),b===null&&(h.charCodeAt(i)===13?(b="\r",i++):(b=null,o('"\\r"')),b===null&&(h.charCodeAt(i)===10?(b=`
`,i++):(b=null,o('"\\n"'))))),b}function Rs(b){b.sort();let J=null;const ie=[];for(let re=0;re<b.length;re++)b[re]!==J&&(ie.push(b[re]),J=b[re]);return ie}function Ns(){let b=1,J=1,ie=!1;for(let re=0;re<Math.max(i,s);re++){const ye=h.charAt(re);ye===`
`?(ie||b++,J=1,ie=!1):ye==="\r"||ye==="\u2028"||ye==="\u2029"?(b++,J=1,ie=!0):(J++,ie=!1)}return{line:b,column:J}}function ps(b,J){const ie=[{cmd:J?"moveToRelative":"moveTo",args:[b[0].x,b[0].y]}];if(b.length>1)for(let re=1;re<b.length;re++)ie.push({cmd:J?"lineToRelative":"lineTo",args:[b[re].x,b[re].y]});return ie}const Kr=t[e]();if(Kr===null||i!==h.length){const b=Math.max(i,s),J=b<h.length?h.charAt(b):null,ie=Ns();throw new this.SyntaxError(Rs(n),J,b,ie.line,ie.column)}return Kr},toSource:function(){return this._source}};Qu.SyntaxError=function(h,e,t,i,s){function n(o,c){let p,f;switch(o.length){case 0:p="end of input";break;case 1:p=o[0];break;default:p=o.slice(0,o.length-1).join(", ")+" or "+o[o.length-1]}return f=c?Ef(c):"end of input","Expected "+p+" but "+f+" found."}this.name="SyntaxError",this.expected=h,this.found=e,this.message=n(h,e),this.offset=t,this.line=i,this.column=s};Qu.SyntaxError.prototype=Error.prototype;ui.register("svgPath",Qu);const Qb=ui.svgPath;class Gi{constructor(){this.invalidationEmitter=new ri}areStrokedBoundsDilated(){return Math.abs(this.startTangent.x*this.startTangent.y)<1e-7&&Math.abs(this.endTangent.x*this.endTangent.y)<1e-7}getBoundsWithTransform(e){return this.transformed(e).getBounds()}slice(e,t){assert&&assert(e>=0&&e<=1&&t>=0&&t<=1,"Parametric value out of range"),assert&&assert(e<t);let i=this;return t<1&&(i=i.subdivided(t)[0]),e>0&&(i=i.subdivided(ct.linear(0,t,0,1,e))[1]),i}subdivisions(e){let t=this;const i=[];for(let s=0;s<e.length;s++){const n=e[s],o=t.subdivided(n);assert&&assert(o.length===2),i.push(o[0]),t=o[1];for(let c=s+1;c<e.length;c++)e[c]=ct.linear(n,1,0,1,e[c])}return i.push(t),i}subdividedIntoMonotone(){return this.subdivisions(this.getInteriorExtremaTs())}isSufficientlyFlat(e,t){const i=this.start,s=this.positionAt(.5),n=this.end;return Gi.isSufficientlyFlat(e,t,i,s,n)}getArcLength(e,t,i){if(e=e===void 0?1e-10:e,t=t===void 0?1e-8:t,i=i===void 0?15:i,i<=0||this.isSufficientlyFlat(e,t))return this.start.distance(this.end);{const s=this.subdivided(.5);return s[0].getArcLength(e,t,i-1)+s[1].getArcLength(e,t,i-1)}}getDashValues(e,t,i,s){assert&&assert(e.length>0,"Do not call with an empty dash array");const n=this,o=[];let c=0;const p=_.sum(e);t=t%p,t<0&&(t+=p);let f=0,w=0,O=!0;function T(){f=(f+1)%e.length,O=!O}for(;t>0;)t>=e[f]?(t-=e[f],T()):(w=t,t=0);const z=O;return function U(m,Y,j,le,xe){const ce=(m+Y)/2,ne=n.positionAt(ce);if(xe>14||Gi.isSufficientlyFlat(i,s,j,ne,le)){const me=j.distance(ne)+ne.distance(le);c+=me;let Fe=me;for(;w+Fe>=e[f];){const we=ct.linear(0,me,m,Y,me-Fe+e[f]-w);o.push(we),Fe-=e[f]-w,w=0,T()}w=w+Fe}else U(m,ce,j,ne,xe+1),U(ce,Y,ne,le,xe+1)}(0,1,this.start,this.end,0),{values:o,arcLength:c,initiallyInside:z}}toPiecewiseLinearSegments(e,t,i,s,n,o){t=t===void 0?e.minLevels:t,i=i===void 0?e.maxLevels:i,s=s||[];const c=e.pointMap||_.identity;n=n||c(this.start),o=o||c(this.end);const p=c(this.positionAt(.5));assert&&assert(t<=i),assert&&assert(e.distanceEpsilon===null||typeof e.distanceEpsilon=="number"),assert&&assert(e.curveEpsilon===null||typeof e.curveEpsilon=="number"),assert&&assert(!c||typeof c=="function");let f=i===0;if(!f&&t<=0&&(f=this.isSufficientlyFlat(e.distanceEpsilon===null||e.distanceEpsilon===void 0?Number.POSITIVE_INFINITY:e.distanceEpsilon,e.curveEpsilon===null||e.curveEpsilon===void 0?Number.POSITIVE_INFINITY:e.curveEpsilon)),f)s.push(new Ct(n,o));else{const w=this.subdivided(.5);w[0].toPiecewiseLinearSegments(e,t-1,i-1,s,n,p),w[1].toPiecewiseLinearSegments(e,t-1,i-1,s,p,o)}return s}toPiecewiseLinearOrArcSegments(e){const t=st()({minLevels:2,maxLevels:7,curvatureThreshold:.02,errorThreshold:10,errorPoints:[.25,.75]},e),i=[];return this.toPiecewiseLinearOrArcRecursion(t,t.minLevels,t.maxLevels,i,0,1,this.positionAt(0),this.positionAt(1),this.curvatureAt(0),this.curvatureAt(1)),i}toPiecewiseLinearOrArcRecursion(e,t,i,s,n,o,c,p,f,w){const O=(n+o)/2,T=this.positionAt(O),z=this.curvatureAt(O);if(i<=0||t<=0&&Math.abs(f-z)+Math.abs(z-w)<e.curvatureThreshold*2){const U=Zt.createFromPoints(c,T,p);let m=!1;if(U instanceof Zt){const Y=U.radius*U.radius;for(let j=0;j<e.errorPoints.length;j++){const le=e.errorPoints[j],xe=this.positionAt(n*(1-le)+o*le);if(Math.abs(xe.distanceSquared(U.center)-Y)>e.errorThreshold){m=!0;break}}}if(!m){s.push(U);return}}this.toPiecewiseLinearOrArcRecursion(e,t-1,i-1,s,n,O,c,T,f,z),this.toPiecewiseLinearOrArcRecursion(e,t-1,i-1,s,O,o,T,p,z,w)}toShape(){return new kt([new ks([this])])}getClosestPoints(e){return Gi.closestToPoint([this],e,1e-7)}static closestToPoint(e,t,i){const s=i*i;let n=[],o=[],c=Number.POSITIVE_INFINITY,p=!1;for(_.each(e,f=>{if(f instanceof Ct){const w=f.explicitClosestToPoint(t);_.each(w,O=>{O.distanceSquared<c?(o=[O],c=O.distanceSquared):O.distanceSquared===c&&o.push(O)})}else{const w=[0].concat(f.getInteriorExtremaTs()).concat([1]);for(let O=0;O<w.length-1;O++){const T=w[O],z=w[O+1],U=f.positionAt(T),m=f.positionAt(z),Y=$e.point(U).addPoint(m),j=Y.minimumDistanceToPointSquared(t);if(j<=c){const le=Y.maximumDistanceToPointSquared(t);le<c&&(c=le,o=[]),n.push({ta:T,tb:z,pa:U,pb:m,segment:f,bounds:Y,min:j,max:le})}}}});n.length&&!p;){const f=n;n=[],p=!0;for(const w of f){if(w.min>c)continue;p&&w.pa.distanceSquared(w.pb)>s&&(p=!1);const O=(w.ta+w.tb)/2,T=w.segment.positionAt(O),z=$e.point(w.pa).addPoint(T),U=$e.point(w.pb).addPoint(T),m=z.minimumDistanceToPointSquared(t),Y=U.minimumDistanceToPointSquared(t);if(m<=c){const j=z.maximumDistanceToPointSquared(t);j<c&&(c=j,o=[]),n.push({ta:w.ta,tb:O,pa:w.pa,pb:T,segment:w.segment,bounds:z,min:m,max:j})}if(Y<=c){const j=U.maximumDistanceToPointSquared(t);j<c&&(c=j,o=[]),n.push({ta:O,tb:w.tb,pa:T,pb:w.pb,segment:w.segment,bounds:U,min:Y,max:j})}}}return _.each(n,f=>{const w=(f.ta+f.tb)/2,O=f.segment.positionAt(w);o.push({segment:f.segment,t:w,closestPoint:O,distanceSquared:t.distanceSquared(O)})}),o}static polynomialGetOverlapCubic(e,t,i,s,n,o,c,p){if(p===0)return Gi.polynomialGetOverlapQuadratic(e,t,i,n,o,c);const f=Math.sign(s/p)*Math.pow(Math.abs(s/p),1/3);if(f===0)return null;const w=(i-f*f*c)/(3*f*f*p);return{a:f,b:w}}static polynomialGetOverlapQuadratic(e,t,i,s,n,o){if(o===0)return Gi.polynomialGetOverlapLinear(e,t,s,n);if(i/o<0)return null;const p=Math.sqrt(i/o);if(p===0)return null;const f=(t-p*n)/(2*p*o);return{a:p,b:f}}static polynomialGetOverlapLinear(e,t,i,s){if(s===0)return e===i?!0:null;const n=t/s;if(n===0)return null;const o=(e-i)/s;return{a:n,b:o}}static intersect(e,t){if(Ct&&e instanceof Ct&&t instanceof Ct)return Ct.intersect(e,t);if(Ct&&e instanceof Ct)return Ct.intersectOther(e,t);if(Ct&&t instanceof Ct)return Ct.intersectOther(t,e).map(Zb);if(Zt&&e instanceof Zt&&t instanceof Zt)return Zt.intersect(e,t);if(Qi&&e instanceof Qi&&t instanceof Qi)return Qi.intersect(e,t);if(zi&&ts&&(e instanceof zi||e instanceof ts)&&(t instanceof zi||t instanceof ts)){const i=e instanceof ts?e:e.degreeElevated(),s=t instanceof ts?t:t.degreeElevated(),n=new paper.Curve(i.start.x,i.start.y,i.control1.x,i.control1.y,i.control2.x,i.control2.y,i.end.x,i.end.y),o=new paper.Curve(s.start.x,s.start.y,s.control1.x,s.control1.y,s.control2.x,s.control2.y,s.end.x,s.end.y);return n.getIntersections(o).map(p=>{const f=new Pe(p.point.x,p.point.y);return new vs(f,p.time,p.intersection.time)})}else return Za.intersect(e,t)}static deserialize(e){return assert&&assert(e.type&&ui[e.type]&&ui[e.type].deserialize),ui[e.type].deserialize(e)}static isSufficientlyFlat(e,t,i,s,n){return!(ct.distToSegmentSquared(s,i,n)/i.distanceSquared(n)>t||ct.distToSegmentSquared(s,i,n)>e)}static filterClosestToPointResult(e){if(e.length===0)return[];const t=_.minBy(e,i=>i.distanceSquared).distanceSquared;return _.uniqWith(e.filter(i=>Math.abs(i.distanceSquared-t)<1e-11),(i,s)=>i.closestPoint.distanceSquared(s.closestPoint)<1e-11)}}ui.register("Segment",Gi);function Zb(h){return h.getSwapped()}const Mg=new Pe(0,0);let Ct=class hn extends Gi{constructor(e,t){super(),this._start=e,this._end=t,this.invalidate()}setStart(e){return assert&&assert(e.isFinite(),`Line start should be finite: ${e.toString()}`),this._start.equals(e)||(this._start=e,this.invalidate()),this}set start(e){this.setStart(e)}get start(){return this.getStart()}getStart(){return this._start}setEnd(e){return assert&&assert(e.isFinite(),`Line end should be finite: ${e.toString()}`),this._end.equals(e)||(this._end=e,this.invalidate()),this}set end(e){this.setEnd(e)}get end(){return this.getEnd()}getEnd(){return this._end}positionAt(e){return assert&&assert(e>=0,"positionAt t should be non-negative"),assert&&assert(e<=1,"positionAt t should be no greater than 1"),this._start.plus(this._end.minus(this._start).times(e))}tangentAt(e){return assert&&assert(e>=0,"tangentAt t should be non-negative"),assert&&assert(e<=1,"tangentAt t should be no greater than 1"),this.getStartTangent()}curvatureAt(e){return assert&&assert(e>=0,"curvatureAt t should be non-negative"),assert&&assert(e<=1,"curvatureAt t should be no greater than 1"),0}subdivided(e){if(assert&&assert(e>=0,"subdivided t should be non-negative"),assert&&assert(e<=1,"subdivided t should be no greater than 1"),e===0||e===1)return[this];const t=this.positionAt(e);return[new hn(this._start,t),new hn(t,this._end)]}invalidate(){assert&&assert(this._start instanceof Pe,`Line start should be a Vector2: ${this._start}`),assert&&assert(this._start.isFinite(),`Line start should be finite: ${this._start.toString()}`),assert&&assert(this._end instanceof Pe,`Line end should be a Vector2: ${this._end}`),assert&&assert(this._end.isFinite(),`Line end should be finite: ${this._end.toString()}`),this._tangent=null,this._bounds=null,this._svgPathFragment=null,this.invalidationEmitter.emit()}getStartTangent(){return this._tangent===null&&(this._tangent=this._end.minus(this._start).normalized()),this._tangent}get startTangent(){return this.getStartTangent()}getEndTangent(){return this.getStartTangent()}get endTangent(){return this.getEndTangent()}getBounds(){return this._bounds===null&&(this._bounds=$e.NOTHING.copy().addPoint(this._start).addPoint(this._end)),this._bounds}get bounds(){return this.getBounds()}getBoundsWithTransform(e){const t=$e.NOTHING.copy();return t.addPoint(e.multiplyVector2(Mg.set(this._start))),t.addPoint(e.multiplyVector2(Mg.set(this._end))),t}getNondegenerateSegments(){return this._start.equals(this._end)?[]:[this]}getSVGPathFragment(){let e;return assert&&(e=this._svgPathFragment,this._svgPathFragment=null),this._svgPathFragment||(this._svgPathFragment=`L ${Xt(this._end.x)} ${Xt(this._end.y)}`),assert&&e&&assert(e===this._svgPathFragment,"Quadratic line segment changed without invalidate()"),this._svgPathFragment}strokeLeft(e){const t=this.getEndTangent().perpendicular.negated().times(e/2);return[new hn(this._start.plus(t),this._end.plus(t))]}strokeRight(e){const t=this.getStartTangent().perpendicular.times(e/2);return[new hn(this._end.plus(t),this._start.plus(t))]}getInteriorExtremaTs(){return[]}intersection(e){const t=[],i=this._start,n=this._end.minus(i);if(n.magnitudeSquared===0)return t;const o=e.direction.y*n.x-e.direction.x*n.y;if(o===0)return t;const c=(e.direction.x*(i.y-e.position.y)-e.direction.y*(i.x-e.position.x))/o;if(c<0||c>=1)return t;const p=(n.x*(i.y-e.position.y)-n.y*(i.x-e.position.x))/o;if(p<1e-8)return t;const f=n.perpendicular,w=i.plus(n.times(c)),O=(f.dot(e.direction)>0?f.negated():f).normalized(),T=e.direction.perpendicular.dot(n)<0?1:-1;return t.push(new Mr(p,w,O,T,c)),t}windingIntersection(e){const t=this.intersection(e);return t.length?t[0].wind:0}writeToContext(e){e.lineTo(this._end.x,this._end.y)}transformed(e){return new hn(e.timesVector2(this._start),e.timesVector2(this._end))}explicitClosestToPoint(e){const t=this._end.minus(this._start);let i=e.minus(this._start).dot(t)/t.magnitudeSquared;i=ct.clamp(i,0,1);const s=this.positionAt(i);return[{segment:this,t:i,closestPoint:s,distanceSquared:e.distanceSquared(s)}]}getSignedAreaFragment(){return 1/2*(this._start.x*this._end.y-this._start.y*this._end.x)}reparameterized(e,t){return new hn(this.positionAt(t),this.positionAt(e+t))}reversed(){return new hn(this._end,this._start)}polarToCartesian(e){return this._start.x===this._end.x?[new hn(Pe.createPolar(this._start.y,this._start.x),Pe.createPolar(this._end.y,this._end.x))]:this._start.y===this._end.y?[new Zt(Pe.ZERO,this._start.y,this._start.x,this._end.x,this._start.x>this._end.x)]:this.toPiecewiseLinearSegments(e)}getArcLength(){return this.start.distance(this.end)}toPiecewiseLinearOrArcSegments(){return[this]}serialize(){return{type:"Line",startX:this._start.x,startY:this._start.y,endX:this._end.x,endY:this._end.y}}getOverlaps(e,t=1e-6){return e instanceof hn?hn.getOverlaps(this,e):null}getClosestPoints(e){const t=this._end.minus(this._start),i=t.normalized(),s=e.minus(this._start).dot(i),n=ct.clamp(s/t.magnitude,0,1),o=this.positionAt(n);return[{segment:this,t:n,closestPoint:o,distanceSquared:o.distanceSquared(e)}]}static deserialize(e){return assert&&assert(e.type==="Line"),new hn(new Pe(e.startX,e.startY),new Pe(e.endX,e.endY))}static getOverlaps(e,t,i=1e-6){const s=[],n=e._start.x,o=-1*e._start.x+e._end.x,c=e._start.y,p=-1*e._start.y+e._end.y,f=t._start.x,w=-1*t._start.x+t._end.x,O=t._start.y,T=-1*t._start.y+t._end.y,z=Math.abs(Math.max(e._start.x,e._end.x,t._start.x,t._end.x)-Math.min(e._start.x,e._end.x,t._start.x,t._end.x)),U=Math.abs(Math.max(e._start.y,e._end.y,t._start.y,t._end.y)-Math.min(e._start.y,e._end.y,t._start.y,t._end.y)),m=Gi.polynomialGetOverlapLinear(n,o,f,w),Y=Gi.polynomialGetOverlapLinear(c,p,O,T);let j;if(z>U?j=m===null||m===!0?Y:m:j=Y===null||Y===!0?m:Y,j===null||j===!0)return s;const le=j.a,xe=j.b,ce=f+xe*w-n,ne=le*w-o,me=O+xe*T-c,Fe=le*T-p;if(Math.abs(ce)>i||Math.abs(ne+ce)>i||Math.abs(me)>i||Math.abs(Fe+me)>i)return s;const we=xe,He=le+xe;return we>1&&He>1||we<0&&He<0?s:[new ya(le,xe)]}static intersect(e,t){const i=ct.lineSegmentIntersection(e.start.x,e.start.y,e.end.x,e.end.y,t.start.x,t.start.y,t.end.x,t.end.y);if(i!==null){const s=e.explicitClosestToPoint(i)[0].t,n=t.explicitClosestToPoint(i)[0].t;return[new vs(i,s,n)]}else return[]}static intersectOther(e,t){const i=e.end.minus(e.start),s=i.magnitude,n=new ir(e.start,i.normalize()),o=t.intersection(n),c=[];for(let p=0;p<o.length;p++){const f=o[p],w=f.distance/s;w>1e-8&&w<1-1e-8&&c.push(new vs(f.point,w,f.t))}return c}};ui.register("Line",Ct);const Jb=ct.solveQuadraticRootsReal,e_=ct.arePointsCollinear;function Rg(h){return h>=0&&h<=1}class zi extends Gi{constructor(e,t,i){super(),this._start=e,this._control=t,this._end=i,this.invalidate()}setStart(e){return assert&&assert(e.isFinite(),`Quadratic start should be finite: ${e.toString()}`),this._start.equals(e)||(this._start=e,this.invalidate()),this}set start(e){this.setStart(e)}get start(){return this.getStart()}getStart(){return this._start}setControl(e){return assert&&assert(e.isFinite(),`Quadratic control should be finite: ${e.toString()}`),this._control.equals(e)||(this._control=e,this.invalidate()),this}set control(e){this.setControl(e)}get control(){return this.getControl()}getControl(){return this._control}setEnd(e){return assert&&assert(e.isFinite(),`Quadratic end should be finite: ${e.toString()}`),this._end.equals(e)||(this._end=e,this.invalidate()),this}set end(e){this.setEnd(e)}get end(){return this.getEnd()}getEnd(){return this._end}positionAt(e){assert&&assert(e>=0,"positionAt t should be non-negative"),assert&&assert(e<=1,"positionAt t should be no greater than 1");const t=1-e;return this._start.times(t*t).plus(this._control.times(2*t*e)).plus(this._end.times(e*e))}tangentAt(e){return assert&&assert(e>=0,"tangentAt t should be non-negative"),assert&&assert(e<=1,"tangentAt t should be no greater than 1"),this._control.minus(this._start).times(2*(1-e)).plus(this._end.minus(this._control).times(2*e))}curvatureAt(e){if(assert&&assert(e>=0,"curvatureAt t should be non-negative"),assert&&assert(e<=1,"curvatureAt t should be no greater than 1"),Math.abs(e-.5)>.5-1e-7){const i=e<.5,s=i?this._start:this._end,n=this._control,o=i?this._end:this._start,c=n.minus(s),p=c.magnitude;return(i?-1:1)*c.perpendicular.normalized().dot(o.minus(n))*(this.degree-1)/(this.degree*p*p)}else return this.subdivided(e)[0].curvatureAt(1)}subdivided(e){if(assert&&assert(e>=0,"subdivided t should be non-negative"),assert&&assert(e<=1,"subdivided t should be no greater than 1"),e===0||e===1)return[this];const t=this._start.blend(this._control,e),i=this._control.blend(this._end,e),s=t.blend(i,e);return[new zi(this._start,t,s),new zi(s,i,this._end)]}invalidate(){assert&&assert(this._start instanceof Pe,`Quadratic start should be a Vector2: ${this._start}`),assert&&assert(this._start.isFinite(),`Quadratic start should be finite: ${this._start.toString()}`),assert&&assert(this._control instanceof Pe,`Quadratic control should be a Vector2: ${this._control}`),assert&&assert(this._control.isFinite(),`Quadratic control should be finite: ${this._control.toString()}`),assert&&assert(this._end instanceof Pe,`Quadratic end should be a Vector2: ${this._end}`),assert&&assert(this._end.isFinite(),`Quadratic end should be finite: ${this._end.toString()}`),this._startTangent=null,this._endTangent=null,this._tCriticalX=null,this._tCriticalY=null,this._bounds=null,this._svgPathFragment=null,this.invalidationEmitter.emit()}getStartTangent(){if(this._startTangent===null){const e=this._start.equals(this._control);this._startTangent=e?this._end.minus(this._start).normalized():this._control.minus(this._start).normalized()}return this._startTangent}get startTangent(){return this.getStartTangent()}getEndTangent(){if(this._endTangent===null){const e=this._end.equals(this._control);this._endTangent=e?this._end.minus(this._start).normalized():this._end.minus(this._control).normalized()}return this._endTangent}get endTangent(){return this.getEndTangent()}getTCriticalX(){return this._tCriticalX===null&&(this._tCriticalX=zi.extremaT(this._start.x,this._control.x,this._end.x)),this._tCriticalX}get tCriticalX(){return this.getTCriticalX()}getTCriticalY(){return this._tCriticalY===null&&(this._tCriticalY=zi.extremaT(this._start.y,this._control.y,this._end.y)),this._tCriticalY}get tCriticalY(){return this.getTCriticalY()}getNondegenerateSegments(){const e=this._start,t=this._control,i=this._end,s=e.equals(i),n=e.equals(t),o=e.equals(t);if(s&&n)return[];if(s){const c=this.positionAt(.5);return[new Ct(e,c),new Ct(c,i)]}else if(e_(e,t,i)){if(n||o)return[new Ct(e,i)];const c=i.minus(e),p=t.minus(e).dot(c.normalized())/c.magnitude,f=zi.extremaT(0,p,1);if(!isNaN(f)&&f>0&&f<1){const w=this.positionAt(f);return _.flatten([new Ct(e,w).getNondegenerateSegments(),new Ct(w,i).getNondegenerateSegments()])}else return[new Ct(e,i)]}else return[this]}getBounds(){if(this._bounds===null){this._bounds=new $e(Math.min(this._start.x,this._end.x),Math.min(this._start.y,this._end.y),Math.max(this._start.x,this._end.x),Math.max(this._start.y,this._end.y));const e=this.getTCriticalX(),t=this.getTCriticalY();!isNaN(e)&&e>0&&e<1&&(this._bounds=this._bounds.withPoint(this.positionAt(e))),!isNaN(t)&&t>0&&t<1&&(this._bounds=this._bounds.withPoint(this.positionAt(t)))}return this._bounds}get bounds(){return this.getBounds()}offsetTo(e,t){let i=[this];const s=5;for(let o=0;o<s;o++)i=_.flatten(_.map(i,c=>c.subdivided(.5)));let n=_.map(i,o=>o.approximateOffset(e));return t&&(n.reverse(),n=_.map(n,o=>o.reversed())),n}degreeElevated(){return new ts(this._start,this._start.plus(this._control.timesScalar(2)).dividedScalar(3),this._end.plus(this._control.timesScalar(2)).dividedScalar(3),this._end)}approximateOffset(e){return new zi(this._start.plus((this._start.equals(this._control)?this._end.minus(this._start):this._control.minus(this._start)).perpendicular.normalized().times(e)),this._control.plus(this._end.minus(this._start).perpendicular.normalized().times(e)),this._end.plus((this._end.equals(this._control)?this._end.minus(this._start):this._end.minus(this._control)).perpendicular.normalized().times(e)))}getSVGPathFragment(){let e;return assert&&(e=this._svgPathFragment,this._svgPathFragment=null),this._svgPathFragment||(this._svgPathFragment=`Q ${Xt(this._control.x)} ${Xt(this._control.y)} ${Xt(this._end.x)} ${Xt(this._end.y)}`),assert&&e&&assert(e===this._svgPathFragment,"Quadratic line segment changed without invalidate()"),this._svgPathFragment}strokeLeft(e){return this.offsetTo(-e/2,!1)}strokeRight(e){return this.offsetTo(e/2,!0)}getInteriorExtremaTs(){const e=[],i=this.getTCriticalX(),s=this.getTCriticalY();return!isNaN(i)&&i>1e-10&&i<1-1e-10&&e.push(this.tCriticalX),!isNaN(s)&&s>1e-10&&s<1-1e-10&&e.push(this.tCriticalY),e.sort()}intersection(e){const t=[],i=Ze.rotation2(-e.direction.angle).timesMatrix(Ze.translation(-e.position.x,-e.position.y)),s=i.timesVector2(this._start),n=i.timesVector2(this._control),o=i.timesVector2(this._end),c=s.y-2*n.y+o.y,p=-2*s.y+2*n.y,f=s.y,w=Jb(c,p,f);return _.each(w,O=>{if(O>=0&&O<=1){const T=this.positionAt(O),z=this.tangentAt(O).normalized(),U=z.perpendicular,m=T.minus(e.position);if(m.dot(e.direction)>0){const Y=U.dot(e.direction)>0?U.negated():U,j=e.direction.perpendicular.dot(z)<0?1:-1;t.push(new Mr(m.magnitude,T,Y,j,O))}}}),t}windingIntersection(e){let t=0;const i=this.intersection(e);return _.each(i,s=>{t+=s.wind}),t}writeToContext(e){e.quadraticCurveTo(this._control.x,this._control.y,this._end.x,this._end.y)}transformed(e){return new zi(e.timesVector2(this._start),e.timesVector2(this._control),e.timesVector2(this._end))}getSignedAreaFragment(){return 1/6*(this._start.x*(2*this._control.y+this._end.y)+this._control.x*(-2*this._start.y+2*this._end.y)+this._end.x*(-this._start.y-2*this._control.y))}reparameterized(e,t){const i=this._start.plus(this._end.plus(this._control.timesScalar(-2))),s=this._control.minus(this._start).timesScalar(2),n=this._start,o=i.timesScalar(e*e),c=i.timesScalar(e*t).timesScalar(2).plus(s.timesScalar(e)),p=i.timesScalar(t*t).plus(s.timesScalar(t)).plus(n);return new zi(p,c.timesScalar(.5).plus(p),o.plus(c).plus(p))}reversed(){return new zi(this._end,this._control,this._start)}serialize(){return{type:"Quadratic",startX:this._start.x,startY:this._start.y,controlX:this._control.x,controlY:this._control.y,endX:this._end.x,endY:this._end.y}}getOverlaps(e,t=1e-6){return e instanceof zi?zi.getOverlaps(this,e):null}static deserialize(e){return assert&&assert(e.type==="Quadratic"),new zi(new Pe(e.startX,e.startY),new Pe(e.controlX,e.controlY),new Pe(e.endX,e.endY))}static extremaT(e,t,i){const s=2*(i-2*t+e);return s!==0?-2*(t-e)/s:NaN}static getOverlaps(e,t,i=1e-6){const s=[],n=e._start.x,o=-2*e._start.x+2*e._control.x,c=e._start.x-2*e._control.x+e._end.x,p=e._start.y,f=-2*e._start.y+2*e._control.y,w=e._start.y-2*e._control.y+e._end.y,O=t._start.x,T=-2*t._start.x+2*t._control.x,z=t._start.x-2*t._control.x+t._end.x,U=t._start.y,m=-2*t._start.y+2*t._control.y,Y=t._start.y-2*t._control.y+t._end.y,j=Math.abs(Math.max(e._start.x,e._control.x,e._end.x,t._start.x,t._control.x,t._end.x)-Math.min(e._start.x,e._control.x,e._end.x,t._start.x,t._control.x,t._end.x)),le=Math.abs(Math.max(e._start.y,e._control.y,e._end.y,t._start.y,t._control.y,t._end.y)-Math.min(e._start.y,e._control.y,e._end.y,t._start.y,t._control.y,t._end.y)),xe=Gi.polynomialGetOverlapQuadratic(n,o,c,O,T,z),ce=Gi.polynomialGetOverlapQuadratic(p,f,w,U,m,Y);let ne;if(j>le?ne=xe===null||xe===!0?ce:xe:ne=ce===null||ce===!0?xe:ce,ne===null||ne===!0)return s;const me=ne.a,Fe=ne.b,we=me*me,He=Fe*Fe,Me=2*me*Fe,ze=O+Fe*T+He*z-n,Je=me*T+Me*z-o,Ee=we*z-c,rt=U+Fe*m+He*Y-p,Ie=me*m+Me*Y-f,Re=we*Y-w,We=ct.solveLinearRootsReal(2*Ee,Je),Ve=ct.solveLinearRootsReal(2*Re,Ie),Qe=_.uniq([0,1].concat(We?We.filter(Rg):[])),Ot=_.uniq([0,1].concat(Ve?Ve.filter(Rg):[]));for(let gt=0;gt<Qe.length;gt++){const Lt=Qe[gt];if(Math.abs((Ee*Lt+Je)*Lt+ze)>i)return s}for(let gt=0;gt<Ot.length;gt++){const Lt=Ot[gt];if(Math.abs((Re*Lt+Ie)*Lt+rt)>i)return s}const Tt=Fe,ot=me+Fe;return Tt>1&&ot>1||Tt<0&&ot<0?s:[new ya(me,Fe)]}}zi.prototype.degree=2;ui.register("Quadratic",zi);const t_=ct.solveQuadraticRootsReal,i_=ct.solveCubicRootsReal,Ng=ct.arePointsCollinear,Gl=new Pe(0,0),s_=new Pe(0,0),n_=new Pe(0,0);function Lc(h){return h>=0&&h<=1}class ts extends Gi{constructor(e,t,i,s){super(),this._start=e,this._control1=t,this._control2=i,this._end=s,this.invalidate()}setStart(e){return assert&&assert(e.isFinite(),`Cubic start should be finite: ${e.toString()}`),this._start.equals(e)||(this._start=e,this.invalidate()),this}set start(e){this.setStart(e)}get start(){return this.getStart()}getStart(){return this._start}setControl1(e){return assert&&assert(e.isFinite(),`Cubic control1 should be finite: ${e.toString()}`),this._control1.equals(e)||(this._control1=e,this.invalidate()),this}set control1(e){this.setControl1(e)}get control1(){return this.getControl1()}getControl1(){return this._control1}setControl2(e){return assert&&assert(e.isFinite(),`Cubic control2 should be finite: ${e.toString()}`),this._control2.equals(e)||(this._control2=e,this.invalidate()),this}set control2(e){this.setControl2(e)}get control2(){return this.getControl2()}getControl2(){return this._control2}setEnd(e){return assert&&assert(e.isFinite(),`Cubic end should be finite: ${e.toString()}`),this._end.equals(e)||(this._end=e,this.invalidate()),this}set end(e){this.setEnd(e)}get end(){return this.getEnd()}getEnd(){return this._end}positionAt(e){assert&&assert(e>=0,"positionAt t should be non-negative"),assert&&assert(e<=1,"positionAt t should be no greater than 1");const t=1-e,i=t*t*t,s=3*t*t*e,n=3*t*e*e,o=e*e*e;return new Pe(this._start.x*i+this._control1.x*s+this._control2.x*n+this._end.x*o,this._start.y*i+this._control1.y*s+this._control2.y*n+this._end.y*o)}tangentAt(e){assert&&assert(e>=0,"tangentAt t should be non-negative"),assert&&assert(e<=1,"tangentAt t should be no greater than 1");const t=1-e;return new Pe(0,0).set(this._start).multiplyScalar(-3*t*t).add(Gl.set(this._control1).multiplyScalar(3*t*t-6*t*e)).add(Gl.set(this._control2).multiplyScalar(6*t*e-3*e*e)).add(Gl.set(this._end).multiplyScalar(3*e*e))}curvatureAt(e){if(assert&&assert(e>=0,"curvatureAt t should be non-negative"),assert&&assert(e<=1,"curvatureAt t should be no greater than 1"),Math.abs(e-.5)>.5-1e-7){const i=e<.5,s=i?this._start:this._end,n=i?this._control1:this._control2,o=i?this._control2:this._control1,c=n.minus(s),p=c.magnitude;return(i?-1:1)*c.perpendicular.normalized().dot(o.minus(n))*(this.degree-1)/(this.degree*p*p)}else return this.subdivided(e)[0].curvatureAt(1)}subdivided(e){if(assert&&assert(e>=0,"subdivided t should be non-negative"),assert&&assert(e<=1,"subdivided t should be no greater than 1"),e===0||e===1)return[this];const t=this._start.blend(this._control1,e),i=this._control2.blend(this._end,e),s=this._control1.blend(this._control2,e),n=t.blend(s,e),o=s.blend(i,e),c=n.blend(o,e);return[new ts(this._start,t,n,c),new ts(c,o,i,this._end)]}invalidate(){assert&&assert(this._start instanceof Pe,`Cubic start should be a Vector2: ${this._start}`),assert&&assert(this._start.isFinite(),`Cubic start should be finite: ${this._start.toString()}`),assert&&assert(this._control1 instanceof Pe,`Cubic control1 should be a Vector2: ${this._control1}`),assert&&assert(this._control1.isFinite(),`Cubic control1 should be finite: ${this._control1.toString()}`),assert&&assert(this._control2 instanceof Pe,`Cubic control2 should be a Vector2: ${this._control2}`),assert&&assert(this._control2.isFinite(),`Cubic control2 should be finite: ${this._control2.toString()}`),assert&&assert(this._end instanceof Pe,`Cubic end should be a Vector2: ${this._end}`),assert&&assert(this._end.isFinite(),`Cubic end should be finite: ${this._end.toString()}`),this._startTangent=null,this._endTangent=null,this._r=null,this._s=null,this._tCusp=null,this._tDeterminant=null,this._tInflection1=null,this._tInflection2=null,this._quadratics=null,this._xExtremaT=null,this._yExtremaT=null,this._bounds=null,this._svgPathFragment=null,this.invalidationEmitter.emit()}getStartTangent(){return this._startTangent===null&&(this._startTangent=this.tangentAt(0).normalized()),this._startTangent}get startTangent(){return this.getStartTangent()}getEndTangent(){return this._endTangent===null&&(this._endTangent=this.tangentAt(1).normalized()),this._endTangent}get endTangent(){return this.getEndTangent()}getR(){return this._r===null&&(this._r=this._control1.minus(this._start).normalized()),this._r}get r(){return this.getR()}getS(){return this._s===null&&(this._s=this.getR().perpendicular),this._s}get s(){return this.getS()}getTCusp(){return this._tCusp===null&&this.computeCuspInfo(),assert&&assert(this._tCusp!==null),this._tCusp}get tCusp(){return this.getTCusp()}getTDeterminant(){return this._tDeterminant===null&&this.computeCuspInfo(),assert&&assert(this._tDeterminant!==null),this._tDeterminant}get tDeterminant(){return this.getTDeterminant()}getTInflection1(){return this._tInflection1===null&&this.computeCuspInfo(),assert&&assert(this._tInflection1!==null),this._tInflection1}get tInflection1(){return this.getTInflection1()}getTInflection2(){return this._tInflection2===null&&this.computeCuspInfo(),assert&&assert(this._tInflection2!==null),this._tInflection2}get tInflection2(){return this.getTInflection2()}getQuadratics(){return this._quadratics===null&&this.computeCuspSegments(),assert&&assert(this._quadratics!==null),this._quadratics}getXExtremaT(){return this._xExtremaT===null&&(this._xExtremaT=ts.extremaT(this._start.x,this._control1.x,this._control2.x,this._end.x)),this._xExtremaT}get xExtremaT(){return this.getXExtremaT()}getYExtremaT(){return this._yExtremaT===null&&(this._yExtremaT=ts.extremaT(this._start.y,this._control1.y,this._control2.y,this._end.y)),this._yExtremaT}get yExtremaT(){return this.getYExtremaT()}getBounds(){return this._bounds===null&&(this._bounds=$e.NOTHING,this._bounds=this._bounds.withPoint(this._start),this._bounds=this._bounds.withPoint(this._end),_.each(this.getXExtremaT(),e=>{e>=0&&e<=1&&(this._bounds=this._bounds.withPoint(this.positionAt(e)))}),_.each(this.getYExtremaT(),e=>{e>=0&&e<=1&&(this._bounds=this._bounds.withPoint(this.positionAt(e)))}),this.hasCusp()&&(this._bounds=this._bounds.withPoint(this.positionAt(this.getTCusp())))),this._bounds}get bounds(){return this.getBounds()}computeCuspInfo(){const e=this._start.times(-1).plus(this._control1.times(3)).plus(this._control2.times(-3)).plus(this._end),t=this._start.times(3).plus(this._control1.times(-6)).plus(this._control2.times(3)),i=this._start.times(-3).plus(this._control1.times(3)),s=e.perpendicular,n=t.perpendicular,o=s.dot(t);if(this._tCusp=-.5*(s.dot(i)/o),this._tDeterminant=this._tCusp*this._tCusp-1/3*(n.dot(i)/o),this._tDeterminant>=0){const c=Math.sqrt(this._tDeterminant);this._tInflection1=this._tCusp-c,this._tInflection2=this._tCusp+c}else this._tInflection1=NaN,this._tInflection2=NaN}computeCuspSegments(){if(this.hasCusp()){this._quadratics=[];const e=this.getTCusp();if(e===0)this._quadratics.push(new zi(this.start,this.control2,this.end));else if(e===1)this._quadratics.push(new zi(this.start,this.control1,this.end));else{const t=this.subdivided(e);this._quadratics.push(new zi(t[0].start,t[0].control1,t[0].end)),this._quadratics.push(new zi(t[1].start,t[1].control2,t[1].end))}}else this._quadratics=null}getNondegenerateSegments(){const e=this._start,t=this._control1,i=this._control2,s=this._end,n=this.degreeReduced(1e-9);if(e.equals(s)&&e.equals(t)&&e.equals(i))return[];if(this.hasCusp())return _.flatten(this.getQuadratics().map(o=>o.getNondegenerateSegments()));if(n)return n.getNondegenerateSegments();if(Ng(e,t,s)&&Ng(e,i,s)&&!e.equalsEpsilon(s,1e-7)){const o=this.getXExtremaT().concat(this.getYExtremaT()).sort().map(f=>this.positionAt(f)),c=[];let p=e;o.length&&(c.push(new Ct(e,o[0])),p=o[0]);for(let f=1;f<o.length;f++)c.push(new Ct(o[f-1],o[f])),p=o[f];return c.push(new Ct(p,s)),_.flatten(c.map(f=>f.getNondegenerateSegments()))}else return[this]}hasCusp(){const e=this.getTCusp();return e>=0&&e<=1&&this.tangentAt(e).magnitude<1e-7}toRS(e){const t=e.minus(this._start);return new Pe(t.dot(this.getR()),t.dot(this.getS()))}offsetTo(e,t){const s=[],n=[];for(let o=0;o<32;o++){let c=o/31;t&&(c=1-c),s.push(this.positionAt(c).plus(this.tangentAt(c).perpendicular.normalized().times(e))),o>0&&n.push(new Ct(s[o-1],s[o]))}return n}getSVGPathFragment(){let e;return assert&&(e=this._svgPathFragment,this._svgPathFragment=null),this._svgPathFragment||(this._svgPathFragment=`C ${Xt(this._control1.x)} ${Xt(this._control1.y)} ${Xt(this._control2.x)} ${Xt(this._control2.y)} ${Xt(this._end.x)} ${Xt(this._end.y)}`),assert&&e&&assert(e===this._svgPathFragment,"Quadratic line segment changed without invalidate()"),this._svgPathFragment}strokeLeft(e){return this.offsetTo(-e/2,!1)}strokeRight(e){return this.offsetTo(e/2,!0)}getInteriorExtremaTs(){const e=this.getXExtremaT().concat(this.getYExtremaT()),t=[];return _.each(e,i=>{i>1e-10&&i<1-1e-10&&_.every(t,n=>Math.abs(i-n)>1e-10)&&t.push(i)}),t.sort()}intersection(e){const t=[],i=Ze.rotation2(-e.direction.angle).timesMatrix(Ze.translation(-e.position.x,-e.position.y)),s=i.timesVector2(this._start),n=i.timesVector2(this._control1),o=i.timesVector2(this._control2),c=i.timesVector2(this._end),p=-s.y+3*n.y-3*o.y+c.y,f=3*s.y-6*n.y+3*o.y,w=-3*s.y+3*n.y,O=s.y,T=i_(p,f,w,O);return _.each(T,z=>{if(z>=0&&z<=1){const U=this.positionAt(z),m=this.tangentAt(z).normalized(),Y=m.perpendicular,j=U.minus(e.position);if(j.dot(e.direction)>0){const le=Y.dot(e.direction)>0?Y.negated():Y,xe=e.direction.perpendicular.dot(m)<0?1:-1;t.push(new Mr(j.magnitude,U,le,xe,z))}}}),t}windingIntersection(e){let t=0;const i=this.intersection(e);return _.each(i,s=>{t+=s.wind}),t}writeToContext(e){e.bezierCurveTo(this._control1.x,this._control1.y,this._control2.x,this._control2.y,this._end.x,this._end.y)}transformed(e){return new ts(e.timesVector2(this._start),e.timesVector2(this._control1),e.timesVector2(this._control2),e.timesVector2(this._end))}degreeReduced(e){e=e||0;const t=Gl.set(this._control1).multiplyScalar(3).subtract(this._start).divideScalar(2),i=s_.set(this._control2).multiplyScalar(3).subtract(this._end).divideScalar(2);return n_.set(t).subtract(i).magnitude<=e?new zi(this._start,t.average(i),this._end):null}getSignedAreaFragment(){return 1/20*(this._start.x*(6*this._control1.y+3*this._control2.y+this._end.y)+this._control1.x*(-6*this._start.y+3*this._control2.y+3*this._end.y)+this._control2.x*(-3*this._start.y-3*this._control1.y+6*this._end.y)+this._end.x*(-this._start.y-3*this._control1.y-6*this._control2.y))}reversed(){return new ts(this._end,this._control2,this._control1,this._start)}getSelfIntersection(){const e=this.getInteriorExtremaTs(),t=[0].concat(e).concat([1]),i=this.subdivisions(e);if(i.length<3)return null;for(let s=0;s<i.length;s++){const n=i[s];for(let o=s+1;o<i.length;o++){const c=i[o],p=Za.intersect(n,c);if(assert&&assert(p.length<2),p.length){const f=p[0];if(f.aT>1e-7&&f.aT<1-1e-7&&f.bT>1e-7&&f.bT<1-1e-7){const w=t[s]+f.aT*(t[s+1]-t[s]),O=t[o]+f.bT*(t[o+1]-t[o]);return new vs(f.point,w,O)}}}}return null}serialize(){return{type:"Cubic",startX:this._start.x,startY:this._start.y,control1X:this._control1.x,control1Y:this._control1.y,control2X:this._control2.x,control2Y:this._control2.y,endX:this._end.x,endY:this._end.y}}getOverlaps(e,t=1e-6){return e instanceof ts?ts.getOverlaps(this,e):null}static deserialize(e){return assert&&assert(e.type==="Cubic"),new ts(new Pe(e.startX,e.startY),new Pe(e.control1X,e.control1Y),new Pe(e.control2X,e.control2Y),new Pe(e.endX,e.endY))}static extremaT(e,t,i,s){if(e===t&&e===i&&e===s)return[];const n=-3*e+9*t-9*i+3*s,o=6*e-12*t+6*i,c=-3*e+3*t;return _.filter(t_(n,o,c),Lc)}static getOverlaps(e,t,i=1e-6){const s=[],n=e._start.x,o=-3*e._start.x+3*e._control1.x,c=3*e._start.x-6*e._control1.x+3*e._control2.x,p=-1*e._start.x+3*e._control1.x-3*e._control2.x+e._end.x,f=e._start.y,w=-3*e._start.y+3*e._control1.y,O=3*e._start.y-6*e._control1.y+3*e._control2.y,T=-1*e._start.y+3*e._control1.y-3*e._control2.y+e._end.y,z=t._start.x,U=-3*t._start.x+3*t._control1.x,m=3*t._start.x-6*t._control1.x+3*t._control2.x,Y=-1*t._start.x+3*t._control1.x-3*t._control2.x+t._end.x,j=t._start.y,le=-3*t._start.y+3*t._control1.y,xe=3*t._start.y-6*t._control1.y+3*t._control2.y,ce=-1*t._start.y+3*t._control1.y-3*t._control2.y+t._end.y,ne=Math.abs(Math.max(e._start.x,e._control1.x,e._control2.x,e._end.x,e._start.x,e._control1.x,e._control2.x,e._end.x)-Math.min(e._start.x,e._control1.x,e._control2.x,e._end.x,e._start.x,e._control1.x,e._control2.x,e._end.x)),me=Math.abs(Math.max(e._start.y,e._control1.y,e._control2.y,e._end.y,e._start.y,e._control1.y,e._control2.y,e._end.y)-Math.min(e._start.y,e._control1.y,e._control2.y,e._end.y,e._start.y,e._control1.y,e._control2.y,e._end.y)),Fe=Gi.polynomialGetOverlapCubic(n,o,c,p,z,U,m,Y),we=Gi.polynomialGetOverlapCubic(f,w,O,T,j,le,xe,ce);let He;if(ne>me?He=Fe===null||Fe===!0?we:Fe:He=we===null||we===!0?Fe:we,He===null||He===!0)return s;const Me=He.a,ze=He.b,Je=Me*Me,Ee=Me*Me*Me,rt=ze*ze,Ie=ze*ze*ze,Re=2*Me*ze,We=3*Me*rt,Ve=3*Je*ze,Qe=z+ze*U+rt*m+Ie*Y-n,Ot=Me*U+Re*m+We*Y-o,Tt=Je*m+Ve*Y-c,ot=Ee*Y-p,gt=j+ze*le+rt*xe+Ie*ce-f,Lt=Me*le+Re*xe+We*ce-w,Vt=Je*xe+Ve*ce-O,hi=Ee*ce-T,Oi=ct.solveQuadraticRootsReal(3*ot,2*Tt,Ot),St=ct.solveQuadraticRootsReal(3*hi,2*Vt,Lt),Ht=_.uniq([0,1].concat(Oi!==null?Oi.filter(Lc):[])),jt=_.uniq([0,1].concat(St!==null?St.filter(Lc):[]));for(let Ns=0;Ns<Ht.length;Ns++){const ps=Ht[Ns];if(Math.abs(((ot*ps+Tt)*ps+Ot)*ps+Qe)>i)return s}for(let Ns=0;Ns<jt.length;Ns++){const ps=jt[Ns];if(Math.abs(((hi*ps+Vt)*ps+Lt)*ps+gt)>i)return s}const lt=ze,Rs=Me+ze;return lt>1&&Rs>1||lt<0&&Rs<0?s:[new ya(Me,ze)]}}ts.prototype.degree=3;ui.register("Cubic",ts);const Rn=Math.PI*2;class Zt extends Gi{constructor(e,t,i,s,n){super(),this._center=e,this._radius=t,this._startAngle=i,this._endAngle=s,this._anticlockwise=n,this.invalidate()}setCenter(e){return assert&&assert(e.isFinite(),`Arc center should be finite: ${e.toString()}`),this._center.equals(e)||(this._center=e,this.invalidate()),this}set center(e){this.setCenter(e)}get center(){return this.getCenter()}getCenter(){return this._center}setRadius(e){return assert&&assert(isFinite(e),`Arc radius should be a finite number: ${e}`),this._radius!==e&&(this._radius=e,this.invalidate()),this}set radius(e){this.setRadius(e)}get radius(){return this.getRadius()}getRadius(){return this._radius}setStartAngle(e){return assert&&assert(isFinite(e),`Arc startAngle should be a finite number: ${e}`),this._startAngle!==e&&(this._startAngle=e,this.invalidate()),this}set startAngle(e){this.setStartAngle(e)}get startAngle(){return this.getStartAngle()}getStartAngle(){return this._startAngle}setEndAngle(e){return assert&&assert(isFinite(e),`Arc endAngle should be a finite number: ${e}`),this._endAngle!==e&&(this._endAngle=e,this.invalidate()),this}set endAngle(e){this.setEndAngle(e)}get endAngle(){return this.getEndAngle()}getEndAngle(){return this._endAngle}setAnticlockwise(e){return this._anticlockwise!==e&&(this._anticlockwise=e,this.invalidate()),this}set anticlockwise(e){this.setAnticlockwise(e)}get anticlockwise(){return this.getAnticlockwise()}getAnticlockwise(){return this._anticlockwise}positionAt(e){return assert&&assert(e>=0,"positionAt t should be non-negative"),assert&&assert(e<=1,"positionAt t should be no greater than 1"),this.positionAtAngle(this.angleAt(e))}tangentAt(e){return assert&&assert(e>=0,"tangentAt t should be non-negative"),assert&&assert(e<=1,"tangentAt t should be no greater than 1"),this.tangentAtAngle(this.angleAt(e))}curvatureAt(e){return assert&&assert(e>=0,"curvatureAt t should be non-negative"),assert&&assert(e<=1,"curvatureAt t should be no greater than 1"),(this._anticlockwise?-1:1)/this._radius}subdivided(e){if(assert&&assert(e>=0,"subdivided t should be non-negative"),assert&&assert(e<=1,"subdivided t should be no greater than 1"),e===0||e===1)return[this];const t=this.angleAt(0),i=this.angleAt(e),s=this.angleAt(1);return[new Zt(this._center,this._radius,t,i,this._anticlockwise),new Zt(this._center,this._radius,i,s,this._anticlockwise)]}invalidate(){this._start=null,this._end=null,this._startTangent=null,this._endTangent=null,this._actualEndAngle=null,this._isFullPerimeter=null,this._angleDifference=null,this._bounds=null,this._svgPathFragment=null,assert&&assert(this._center instanceof Pe,"Arc center should be a Vector2"),assert&&assert(this._center.isFinite(),"Arc center should be finite (not NaN or infinite)"),assert&&assert(typeof this._radius=="number",`Arc radius should be a number: ${this._radius}`),assert&&assert(isFinite(this._radius),`Arc radius should be a finite number: ${this._radius}`),assert&&assert(typeof this._startAngle=="number",`Arc startAngle should be a number: ${this._startAngle}`),assert&&assert(isFinite(this._startAngle),`Arc startAngle should be a finite number: ${this._startAngle}`),assert&&assert(typeof this._endAngle=="number",`Arc endAngle should be a number: ${this._endAngle}`),assert&&assert(isFinite(this._endAngle),`Arc endAngle should be a finite number: ${this._endAngle}`),assert&&assert(typeof this._anticlockwise=="boolean",`Arc anticlockwise should be a boolean: ${this._anticlockwise}`),this._radius<0&&(this._radius=-this._radius,this._startAngle+=Math.PI,this._endAngle+=Math.PI),assert&&assert(!(!this.anticlockwise&&this._endAngle-this._startAngle<=-Math.PI*2||this.anticlockwise&&this._startAngle-this._endAngle<=-Math.PI*2),"Not handling arcs with start/end angles that show differences in-between browser handling"),assert&&assert(!(!this.anticlockwise&&this._endAngle-this._startAngle>Math.PI*2||this.anticlockwise&&this._startAngle-this._endAngle>Math.PI*2),"Not handling arcs with start/end angles that show differences in-between browser handling"),this.invalidationEmitter.emit()}getStart(){return this._start===null&&(this._start=this.positionAtAngle(this._startAngle)),this._start}get start(){return this.getStart()}getEnd(){return this._end===null&&(this._end=this.positionAtAngle(this._endAngle)),this._end}get end(){return this.getEnd()}getStartTangent(){return this._startTangent===null&&(this._startTangent=this.tangentAtAngle(this._startAngle)),this._startTangent}get startTangent(){return this.getStartTangent()}getEndTangent(){return this._endTangent===null&&(this._endTangent=this.tangentAtAngle(this._endAngle)),this._endTangent}get endTangent(){return this.getEndTangent()}getActualEndAngle(){return this._actualEndAngle===null&&(this._actualEndAngle=Zt.computeActualEndAngle(this._startAngle,this._endAngle,this._anticlockwise)),this._actualEndAngle}get actualEndAngle(){return this.getActualEndAngle()}getIsFullPerimeter(){return this._isFullPerimeter===null&&(this._isFullPerimeter=!this._anticlockwise&&this._endAngle-this._startAngle>=Math.PI*2||this._anticlockwise&&this._startAngle-this._endAngle>=Math.PI*2),this._isFullPerimeter}get isFullPerimeter(){return this.getIsFullPerimeter()}getAngleDifference(){return this._angleDifference===null&&(this._angleDifference=this._anticlockwise?this._startAngle-this._endAngle:this._endAngle-this._startAngle,this._angleDifference<0&&(this._angleDifference+=Math.PI*2),assert&&assert(this._angleDifference>=0)),this._angleDifference}get angleDifference(){return this.getAngleDifference()}getBounds(){return this._bounds===null&&(this._bounds=$e.NOTHING.copy().withPoint(this.getStart()).withPoint(this.getEnd()),this._startAngle!==this._endAngle&&(this.includeBoundsAtAngle(0),this.includeBoundsAtAngle(Math.PI/2),this.includeBoundsAtAngle(Math.PI),this.includeBoundsAtAngle(3*Math.PI/2))),this._bounds}get bounds(){return this.getBounds()}getNondegenerateSegments(){return this._radius<=0||this._startAngle===this._endAngle?[]:[this]}includeBoundsAtAngle(e){this.containsAngle(e)&&(this._bounds=this._bounds.withPoint(this._center.plus(Pe.createPolar(this._radius,e))))}mapAngle(e){return Math.abs(ct.moduloBetweenDown(e-this._startAngle,-Math.PI,Math.PI))<1e-8?this._startAngle:Math.abs(ct.moduloBetweenDown(e-this.getActualEndAngle(),-Math.PI,Math.PI))<1e-8?this.getActualEndAngle():this._startAngle>this.getActualEndAngle()?ct.moduloBetweenUp(e,this._startAngle-2*Math.PI,this._startAngle):ct.moduloBetweenDown(e,this._startAngle,this._startAngle+2*Math.PI)}tAtAngle(e){const t=(this.mapAngle(e)-this._startAngle)/(this.getActualEndAngle()-this._startAngle);return assert&&assert(t>=0&&t<=1,`tAtAngle out of range: ${t}`),t}angleAt(e){return this._startAngle+(this.getActualEndAngle()-this._startAngle)*e}positionAtAngle(e){return this._center.plus(Pe.createPolar(this._radius,e))}tangentAtAngle(e){const t=Pe.createPolar(1,e);return this._anticlockwise?t.perpendicular:t.perpendicular.negated()}containsAngle(e){const t=this._anticlockwise?e-this._endAngle:e-this._startAngle;return ct.moduloBetweenDown(t,0,Math.PI*2)<=this.angleDifference}getSVGPathFragment(){let e;if(assert&&(e=this._svgPathFragment,this._svgPathFragment=null),!this._svgPathFragment){const i=this._anticlockwise?"0":"1";let s;if(this.angleDifference<Math.PI*2-.01)s=this.angleDifference<Math.PI?"0":"1",this._svgPathFragment=`A ${Xt(this._radius)} ${Xt(this._radius)} 0 ${s} ${i} ${Xt(this.end.x)} ${Xt(this.end.y)}`;else{const n=(this._startAngle+this._endAngle)/2,o=this._center.plus(Pe.createPolar(this._radius,n));s="0";const c=`A ${Xt(this._radius)} ${Xt(this._radius)} 0 ${s} ${i} ${Xt(o.x)} ${Xt(o.y)}`,p=`A ${Xt(this._radius)} ${Xt(this._radius)} 0 ${s} ${i} ${Xt(this.end.x)} ${Xt(this.end.y)}`;this._svgPathFragment=`${c} ${p}`}}return assert&&e&&assert(e===this._svgPathFragment,"Quadratic line segment changed without invalidate()"),this._svgPathFragment}strokeLeft(e){return[new Zt(this._center,this._radius+(this._anticlockwise?1:-1)*e/2,this._startAngle,this._endAngle,this._anticlockwise)]}strokeRight(e){return[new Zt(this._center,this._radius+(this._anticlockwise?-1:1)*e/2,this._endAngle,this._startAngle,!this._anticlockwise)]}getInteriorExtremaTs(){const e=[];return _.each([0,Math.PI/2,Math.PI,3*Math.PI/2],t=>{if(this.containsAngle(t)){const i=this.tAtAngle(t),s=1e-10;i>s&&i<1-s&&e.push(i)}}),e.sort()}intersection(e){const t=[],s=e.position.minus(this._center),n=e.direction.dot(s),o=s.magnitudeSquared,c=4*n*n-4*(o-this._radius*this._radius);if(c<0)return t;const p=e.direction.dot(this._center)-e.direction.dot(e.position),f=Math.sqrt(c)/2,w=p-f,O=p+f;if(O<0)return t;const T=e.pointAtDistance(O),z=T.minus(this._center).normalized(),U=z.angle;if(w<0)this.containsAngle(U)&&t.push(new Mr(O,T,z.negated(),this._anticlockwise?-1:1,this.tAtAngle(U)));else{const m=e.pointAtDistance(w),Y=m.minus(this._center).normalized(),j=Y.angle;this.containsAngle(j)&&t.push(new Mr(w,m,Y,this._anticlockwise?1:-1,this.tAtAngle(j))),this.containsAngle(U)&&t.push(new Mr(O,T,z.negated(),this._anticlockwise?-1:1,this.tAtAngle(U)))}return t}windingIntersection(e){let t=0;const i=this.intersection(e);return _.each(i,s=>{t+=s.wind}),t}writeToContext(e){e.arc(this._center.x,this._center.y,this._radius,this._startAngle,this._endAngle,this._anticlockwise)}transformed(e){const t=e.timesVector2(Pe.createPolar(1,this._startAngle)).minus(e.timesVector2(Pe.ZERO)).angle;let i=e.timesVector2(Pe.createPolar(1,this._endAngle)).minus(e.timesVector2(Pe.ZERO)).angle;const s=e.getDeterminant()>=0?this._anticlockwise:!this._anticlockwise;Math.abs(this._endAngle-this._startAngle)===Math.PI*2&&(i=s?t-Math.PI*2:t+Math.PI*2);const n=e.getScaleVector();if(n.x!==n.y){const o=n.x*this._radius,c=n.y*this._radius;return new Qi(e.timesVector2(this._center),o,c,0,t,i,s)}else{const o=n.x*this._radius;return new Zt(e.timesVector2(this._center),o,t,i,s)}}getSignedAreaFragment(){const e=this._startAngle,t=this.getActualEndAngle();return .5*this._radius*(this._radius*(t-e)+this._center.x*(Math.sin(t)-Math.sin(e))-this._center.y*(Math.cos(t)-Math.cos(e)))}reversed(){return new Zt(this._center,this._radius,this._endAngle,this._startAngle,!this._anticlockwise)}getArcLength(){return this.getAngleDifference()*this._radius}toPiecewiseLinearOrArcSegments(){return[this]}serialize(){return{type:"Arc",centerX:this._center.x,centerY:this._center.y,radius:this._radius,startAngle:this._startAngle,endAngle:this._endAngle,anticlockwise:this._anticlockwise}}getOverlaps(e,t=1e-6){return e instanceof Zt?Zt.getOverlaps(this,e):null}getConicMatrix(){const e=this.center.x,t=this.center.y,i=1,s=0,n=1,o=-2*e,c=-2*t,p=e*e+t*t-this.radius*this.radius;return Ze.rowMajor(i,s/2,o/2,s/2,n,c/2,o/2,c/2,p)}static deserialize(e){return assert&&assert(e.type==="Arc"),new Zt(new Pe(e.centerX,e.centerY),e.radius,e.startAngle,e.endAngle,e.anticlockwise)}static computeActualEndAngle(e,t,i){return i?e>t?t:e<t?t-2*Math.PI:e:e<t?t:e>t?t+Math.PI*2:e}static getPartialOverlap(e,t,i,s,n){assert&&assert(e>0&&e<=Rn+1e-10),assert&&assert(t>=0&&t<Rn+1e-10),assert&&assert(i>=0&&i<=Rn+1e-10),assert&&assert(s>=0&&s<=1),assert&&assert(n>=0&&n<=1);const o=i<t,c=o?i:t,p=o?t:i,f=c,w=Math.min(e,p);return w<f+1e-8?[]:[ya.createLinear(ct.clamp(ct.linear(0,e,0,1,f),0,1),ct.clamp(ct.linear(t,i,s,n,f),0,1),ct.clamp(ct.linear(0,e,0,1,w),0,1),ct.clamp(ct.linear(t,i,s,n,w),0,1))]}static getAngularOverlaps(e,t,i,s){assert&&assert(isFinite(e)),assert&&assert(isFinite(t)),assert&&assert(isFinite(i)),assert&&assert(isFinite(s));let n=t-e;const o=n<0?-1:1;n*=o;const c=ct.moduloBetweenDown(o*(i-e),0,Rn),p=o*(s-i)+c;let f;return p<-1e-10?(f=-c/(p-c),Zt.getPartialOverlap(n,c,0,0,f).concat(Zt.getPartialOverlap(n,Rn,p+Rn,f,1))):p>Rn+1e-10?(f=(Rn-c)/(p-c),Zt.getPartialOverlap(n,c,Rn,0,f).concat(Zt.getPartialOverlap(n,0,p-Rn,f,1))):Zt.getPartialOverlap(n,c,p,0,1)}static getOverlaps(e,t){return e._center.distance(t._center)>1e-4||Math.abs(e._radius-t._radius)>1e-4?[]:Zt.getAngularOverlaps(e._startAngle,e.getActualEndAngle(),t._startAngle,t.getActualEndAngle())}static getCircleIntersectionPoint(e,t,i,s){assert&&assert(isFinite(t)&&t>=0),assert&&assert(isFinite(s)&&s>=0);const n=i.minus(e),o=n.magnitude;let c=[];if(!(o<1e-10||o>t+s+1e-10))if(o>t+s-1e-10)c=[e.blend(i,t/o)];else{const p=.5*(o*o-s*s+t*t)/o,f=o*o-s*s+t*t,w=4*o*o*t*t-f*f,O=e.blend(i,p/o);if(w>=1e-10){const T=Math.sqrt(w)/o/2,z=n.perpendicular.setMagnitude(T);c=[O.plus(z),O.minus(z)]}else w>-1e-10&&(c=[O])}return assert&&c.forEach(p=>{assert(Math.abs(p.distance(e)-t)<1e-8),assert(Math.abs(p.distance(i)-s)<1e-8)}),c}static intersect(e,t){const s=[];if(e._center.equalsEpsilon(t._center,1e-7)&&Math.abs(e._radius-t._radius)<1e-7){const n=e.positionAt(0),o=e.positionAt(1),c=t.positionAt(0),p=t.positionAt(1);n.equalsEpsilon(c,1e-7)&&s.push(new vs(n.average(c),0,0)),n.equalsEpsilon(p,1e-7)&&s.push(new vs(n.average(p),0,1)),o.equalsEpsilon(c,1e-7)&&s.push(new vs(o.average(c),1,0)),o.equalsEpsilon(p,1e-7)&&s.push(new vs(o.average(p),1,1))}else{const n=Zt.getCircleIntersectionPoint(e._center,e._radius,t._center,t._radius);for(let o=0;o<n.length;o++){const c=n[o],p=c.minus(e._center).angle,f=c.minus(t._center).angle;e.containsAngle(p)&&t.containsAngle(f)&&s.push(new vs(c,e.tAtAngle(p),t.tAtAngle(f)))}}return s}static createFromPoints(e,t,i){const s=ct.circleCenterFromPoints(e,t,i);if(s===null)return new Ct(e,i);{const n=e.minus(s),o=t.minus(s),c=i.minus(s),p=n.angle,f=o.angle,w=c.angle,O=(n.magnitude+o.magnitude+c.magnitude)/3,T=new Zt(s,O,p,w,!1);return T.containsAngle(f)?T:new Zt(s,O,p,w,!0)}}}ui.register("Arc",Zt);const r_=ct.toDegrees,a_=Ze.rowMajor(1,0,0,0,1,0,0,0,-1);class Qi extends Gi{constructor(e,t,i,s,n,o,c){super(),this._center=e,this._radiusX=t,this._radiusY=i,this._rotation=s,this._startAngle=n,this._endAngle=o,this._anticlockwise=c,this.invalidate()}setCenter(e){return assert&&assert(e.isFinite(),`EllipticalArc center should be finite: ${e.toString()}`),this._center.equals(e)||(this._center=e,this.invalidate()),this}set center(e){this.setCenter(e)}get center(){return this.getCenter()}getCenter(){return this._center}setRadiusX(e){return assert&&assert(isFinite(e),`EllipticalArc radiusX should be a finite number: ${e}`),this._radiusX!==e&&(this._radiusX=e,this.invalidate()),this}set radiusX(e){this.setRadiusX(e)}get radiusX(){return this.getRadiusX()}getRadiusX(){return this._radiusX}setRadiusY(e){return assert&&assert(isFinite(e),`EllipticalArc radiusY should be a finite number: ${e}`),this._radiusY!==e&&(this._radiusY=e,this.invalidate()),this}set radiusY(e){this.setRadiusY(e)}get radiusY(){return this.getRadiusY()}getRadiusY(){return this._radiusY}setRotation(e){return assert&&assert(isFinite(e),`EllipticalArc rotation should be a finite number: ${e}`),this._rotation!==e&&(this._rotation=e,this.invalidate()),this}set rotation(e){this.setRotation(e)}get rotation(){return this.getRotation()}getRotation(){return this._rotation}setStartAngle(e){return assert&&assert(isFinite(e),`EllipticalArc startAngle should be a finite number: ${e}`),this._startAngle!==e&&(this._startAngle=e,this.invalidate()),this}set startAngle(e){this.setStartAngle(e)}get startAngle(){return this.getStartAngle()}getStartAngle(){return this._startAngle}setEndAngle(e){return assert&&assert(isFinite(e),`EllipticalArc endAngle should be a finite number: ${e}`),this._endAngle!==e&&(this._endAngle=e,this.invalidate()),this}set endAngle(e){this.setEndAngle(e)}get endAngle(){return this.getEndAngle()}getEndAngle(){return this._endAngle}setAnticlockwise(e){return this._anticlockwise!==e&&(this._anticlockwise=e,this.invalidate()),this}set anticlockwise(e){this.setAnticlockwise(e)}get anticlockwise(){return this.getAnticlockwise()}getAnticlockwise(){return this._anticlockwise}positionAt(e){return assert&&assert(e>=0,"positionAt t should be non-negative"),assert&&assert(e<=1,"positionAt t should be no greater than 1"),this.positionAtAngle(this.angleAt(e))}tangentAt(e){return assert&&assert(e>=0,"tangentAt t should be non-negative"),assert&&assert(e<=1,"tangentAt t should be no greater than 1"),this.tangentAtAngle(this.angleAt(e))}curvatureAt(e){assert&&assert(e>=0,"curvatureAt t should be non-negative"),assert&&assert(e<=1,"curvatureAt t should be no greater than 1");const t=this.angleAt(e),i=this._radiusX*Math.sin(t),s=this._radiusY*Math.cos(t),n=Math.pow(s*s+i*i,3/2);return(this._anticlockwise?-1:1)*this._radiusX*this._radiusY/n}subdivided(e){if(assert&&assert(e>=0,"subdivided t should be non-negative"),assert&&assert(e<=1,"subdivided t should be no greater than 1"),e===0||e===1)return[this];const t=this.angleAt(0),i=this.angleAt(e),s=this.angleAt(1);return[new Qi(this._center,this._radiusX,this._radiusY,this._rotation,t,i,this._anticlockwise),new Qi(this._center,this._radiusX,this._radiusY,this._rotation,i,s,this._anticlockwise)]}invalidate(){if(assert&&assert(this._center instanceof Pe,"Arc center should be a Vector2"),assert&&assert(this._center.isFinite(),"Arc center should be finite (not NaN or infinite)"),assert&&assert(typeof this._radiusX=="number",`Arc radiusX should be a number: ${this._radiusX}`),assert&&assert(isFinite(this._radiusX),`Arc radiusX should be a finite number: ${this._radiusX}`),assert&&assert(typeof this._radiusY=="number",`Arc radiusY should be a number: ${this._radiusY}`),assert&&assert(isFinite(this._radiusY),`Arc radiusY should be a finite number: ${this._radiusY}`),assert&&assert(typeof this._rotation=="number",`Arc rotation should be a number: ${this._rotation}`),assert&&assert(isFinite(this._rotation),`Arc rotation should be a finite number: ${this._rotation}`),assert&&assert(typeof this._startAngle=="number",`Arc startAngle should be a number: ${this._startAngle}`),assert&&assert(isFinite(this._startAngle),`Arc startAngle should be a finite number: ${this._startAngle}`),assert&&assert(typeof this._endAngle=="number",`Arc endAngle should be a number: ${this._endAngle}`),assert&&assert(isFinite(this._endAngle),`Arc endAngle should be a finite number: ${this._endAngle}`),assert&&assert(typeof this._anticlockwise=="boolean",`Arc anticlockwise should be a boolean: ${this._anticlockwise}`),this._unitTransform=null,this._start=null,this._end=null,this._startTangent=null,this._endTangent=null,this._actualEndAngle=null,this._isFullPerimeter=null,this._angleDifference=null,this._unitArcSegment=null,this._bounds=null,this._svgPathFragment=null,this._radiusX<0&&(this._radiusX=-this._radiusX,this._startAngle=Math.PI-this._startAngle,this._endAngle=Math.PI-this._endAngle,this._anticlockwise=!this._anticlockwise),this._radiusY<0&&(this._radiusY=-this._radiusY,this._startAngle=-this._startAngle,this._endAngle=-this._endAngle,this._anticlockwise=!this._anticlockwise),this._radiusX<this._radiusY){this._rotation+=Math.PI/2,this._startAngle-=Math.PI/2,this._endAngle-=Math.PI/2;const e=this._radiusX;this._radiusX=this._radiusY,this._radiusY=e}if(this._radiusX<this._radiusY)throw new Error("Not verified to work if radiusX < radiusY");assert&&assert(!(!this._anticlockwise&&this._endAngle-this._startAngle<=-Math.PI*2||this._anticlockwise&&this._startAngle-this._endAngle<=-Math.PI*2),"Not handling elliptical arcs with start/end angles that show differences in-between browser handling"),assert&&assert(!(!this._anticlockwise&&this._endAngle-this._startAngle>Math.PI*2||this._anticlockwise&&this._startAngle-this._endAngle>Math.PI*2),"Not handling elliptical arcs with start/end angles that show differences in-between browser handling"),this.invalidationEmitter.emit()}getUnitTransform(){return this._unitTransform===null&&(this._unitTransform=Qi.computeUnitTransform(this._center,this._radiusX,this._radiusY,this._rotation)),this._unitTransform}get unitTransform(){return this.getUnitTransform()}getStart(){return this._start===null&&(this._start=this.positionAtAngle(this._startAngle)),this._start}get start(){return this.getStart()}getEnd(){return this._end===null&&(this._end=this.positionAtAngle(this._endAngle)),this._end}get end(){return this.getEnd()}getStartTangent(){return this._startTangent===null&&(this._startTangent=this.tangentAtAngle(this._startAngle)),this._startTangent}get startTangent(){return this.getStartTangent()}getEndTangent(){return this._endTangent===null&&(this._endTangent=this.tangentAtAngle(this._endAngle)),this._endTangent}get endTangent(){return this.getEndTangent()}getActualEndAngle(){return this._actualEndAngle===null&&(this._actualEndAngle=Zt.computeActualEndAngle(this._startAngle,this._endAngle,this._anticlockwise)),this._actualEndAngle}get actualEndAngle(){return this.getActualEndAngle()}getIsFullPerimeter(){return this._isFullPerimeter===null&&(this._isFullPerimeter=!this._anticlockwise&&this._endAngle-this._startAngle>=Math.PI*2||this._anticlockwise&&this._startAngle-this._endAngle>=Math.PI*2),this._isFullPerimeter}get isFullPerimeter(){return this.getIsFullPerimeter()}getAngleDifference(){return this._angleDifference===null&&(this._angleDifference=this._anticlockwise?this._startAngle-this._endAngle:this._endAngle-this._startAngle,this._angleDifference<0&&(this._angleDifference+=Math.PI*2),assert&&assert(this._angleDifference>=0)),this._angleDifference}get angleDifference(){return this.getAngleDifference()}getUnitArcSegment(){return this._unitArcSegment===null&&(this._unitArcSegment=new Zt(Pe.ZERO,1,this._startAngle,this._endAngle,this._anticlockwise)),this._unitArcSegment}get unitArcSegment(){return this.getUnitArcSegment()}getBounds(){if(this._bounds===null&&(this._bounds=$e.NOTHING.withPoint(this.getStart()).withPoint(this.getEnd()),this._startAngle!==this._endAngle)){const e=Math.atan(-(this._radiusY/this._radiusX)*Math.tan(this._rotation)),t=Math.atan(this._radiusY/this._radiusX/Math.tan(this._rotation));this.possibleExtremaAngles=[e,e+Math.PI,t,t+Math.PI],_.each(this.possibleExtremaAngles,this.includeBoundsAtAngle.bind(this))}return this._bounds}get bounds(){return this.getBounds()}getNondegenerateSegments(){if(this._radiusX<=0||this._radiusY<=0||this._startAngle===this._endAngle)return[];if(this._radiusX===this._radiusY){const e=this._startAngle+this._rotation;let t=this._endAngle+this._rotation;return Math.abs(this._endAngle-this._startAngle)===Math.PI*2&&(t=this._anticlockwise?e-Math.PI*2:e+Math.PI*2),[new Zt(this._center,this._radiusX,e,t,this._anticlockwise)]}else return[this]}includeBoundsAtAngle(e){this.unitArcSegment.containsAngle(e)&&(this._bounds=this._bounds.withPoint(this.positionAtAngle(e)))}mapAngle(e){return Math.abs(ct.moduloBetweenDown(e-this._startAngle,-Math.PI,Math.PI))<1e-8?this._startAngle:Math.abs(ct.moduloBetweenDown(e-this.getActualEndAngle(),-Math.PI,Math.PI))<1e-8?this.getActualEndAngle():this._startAngle>this.getActualEndAngle()?ct.moduloBetweenUp(e,this._startAngle-2*Math.PI,this._startAngle):ct.moduloBetweenDown(e,this._startAngle,this._startAngle+2*Math.PI)}tAtAngle(e){return(this.mapAngle(e)-this._startAngle)/(this.getActualEndAngle()-this._startAngle)}angleAt(e){return this._startAngle+(this.getActualEndAngle()-this._startAngle)*e}positionAtAngle(e){return this.getUnitTransform().transformPosition2(Pe.createPolar(1,e))}tangentAtAngle(e){const t=this.getUnitTransform().transformNormal2(Pe.createPolar(1,e));return this._anticlockwise?t.perpendicular:t.perpendicular.negated()}offsetTo(e,t){const s=[],n=[];for(let o=0;o<32;o++){let c=o/31;t&&(c=1-c);const p=this.angleAt(c);s.push(this.positionAtAngle(p).plus(this.tangentAtAngle(p).perpendicular.normalized().times(e))),o>0&&n.push(new Ct(s[o-1],s[o]))}return n}getSVGPathFragment(){let e;if(assert&&(e=this._svgPathFragment,this._svgPathFragment=null),!this._svgPathFragment){const i=this._anticlockwise?"0":"1";let s;const n=r_(this._rotation);if(this.getAngleDifference()<Math.PI*2-.01)s=this.getAngleDifference()<Math.PI?"0":"1",this._svgPathFragment=`A ${Xt(this._radiusX)} ${Xt(this._radiusY)} ${n} ${s} ${i} ${Xt(this.getEnd().x)} ${Xt(this.getEnd().y)}`;else{const o=(this._startAngle+this._endAngle)/2,c=this.positionAtAngle(o);s="0";const p=`A ${Xt(this._radiusX)} ${Xt(this._radiusY)} ${n} ${s} ${i} ${Xt(c.x)} ${Xt(c.y)}`,f=`A ${Xt(this._radiusX)} ${Xt(this._radiusY)} ${n} ${s} ${i} ${Xt(this.getEnd().x)} ${Xt(this.getEnd().y)}`;this._svgPathFragment=`${p} ${f}`}}return assert&&e&&assert(e===this._svgPathFragment,"Quadratic line segment changed without invalidate()"),this._svgPathFragment}strokeLeft(e){return this.offsetTo(-e/2,!1)}strokeRight(e){return this.offsetTo(e/2,!0)}getInteriorExtremaTs(){const e=[];return _.each(this.possibleExtremaAngles,t=>{if(this.unitArcSegment.containsAngle(t)){const i=this.tAtAngle(t),s=1e-10;i>s&&i<1-s&&e.push(i)}}),e.sort()}intersection(e){const t=this.getUnitTransform(),i=t.inverseRay2(e),s=this.getUnitArcSegment().intersection(i);return _.map(s,n=>{const o=t.transformPosition2(n.point),c=e.position.distance(o),p=t.inverseNormal2(n.normal);return new Mr(c,o,p,n.wind,n.t)})}windingIntersection(e){const t=this.getUnitTransform().inverseRay2(e);return this.getUnitArcSegment().windingIntersection(t)}writeToContext(e){e.ellipse?e.ellipse(this._center.x,this._center.y,this._radiusX,this._radiusY,this._rotation,this._startAngle,this._endAngle,this._anticlockwise):(this.getUnitTransform().getMatrix().canvasAppendTransform(e),e.arc(0,0,1,this._startAngle,this._endAngle,this._anticlockwise),this.getUnitTransform().getInverse().canvasAppendTransform(e))}transformed(e){const t=e.timesVector2(Pe.createPolar(this._radiusX,this._rotation)).minus(e.timesVector2(Pe.ZERO)),i=e.timesVector2(Pe.createPolar(this._radiusY,this._rotation+Math.PI/2)).minus(e.timesVector2(Pe.ZERO)),s=t.angle,n=t.magnitude,o=i.magnitude,c=e.getDeterminant()<0,p=c?!this._anticlockwise:this._anticlockwise,f=c?-this._startAngle:this._startAngle;let w=c?-this._endAngle:this._endAngle;return Math.abs(this._endAngle-this._startAngle)===Math.PI*2&&(w=p?f-Math.PI*2:f+Math.PI*2),new Qi(e.timesVector2(this._center),n,o,s,f,w,p)}getSignedAreaFragment(){const e=this._startAngle,t=this.getActualEndAngle(),i=Math.sin(e),s=Math.sin(t),n=Math.cos(e),o=Math.cos(t);return .5*(this._radiusX*this._radiusY*(t-e)+Math.cos(this._rotation)*(this._radiusX*this._center.y*(n-o)+this._radiusY*this._center.x*(s-i))+Math.sin(this._rotation)*(this._radiusX*this._center.x*(o-n)+this._radiusY*this._center.y*(s-i)))}reversed(){return new Qi(this._center,this._radiusX,this._radiusY,this._rotation,this._endAngle,this._startAngle,!this._anticlockwise)}serialize(){return{type:"EllipticalArc",centerX:this._center.x,centerY:this._center.y,radiusX:this._radiusX,radiusY:this._radiusY,rotation:this._rotation,startAngle:this._startAngle,endAngle:this._endAngle,anticlockwise:this._anticlockwise}}getOverlaps(e,t=1e-6){return e instanceof Qi?Qi.getOverlaps(this,e):null}getConicMatrix(){const t=Qi.computeUnitMatrix(this._center,this._radiusX,this._radiusY,this._rotation).inverted();return t.transposed().multiplyMatrix(a_).multiplyMatrix(t)}static deserialize(e){return assert&&assert(e.type==="EllipticalArc"),new Qi(new Pe(e.centerX,e.centerY),e.radiusX,e.radiusY,e.rotation,e.startAngle,e.endAngle,e.anticlockwise)}static getOverlapType(e,t,i=1e-4){if(e._center.distance(t._center)<i){const s=Math.abs(e._radiusX-t._radiusX)<i&&Math.abs(e._radiusY-t._radiusY)<i,n=Math.abs(e._radiusX-t._radiusY)<i&&Math.abs(e._radiusY-t._radiusX)<i;if(s&&Math.abs(ct.moduloBetweenDown(e._rotation-t._rotation+Math.PI/2,0,Math.PI)-Math.PI/2)<i)return na.MATCHING_OVERLAP;if(n&&Math.abs(ct.moduloBetweenDown(e._rotation-t._rotation,0,Math.PI)-Math.PI/2)<i)return na.OPPOSITE_OVERLAP}return na.NONE}static getOverlaps(e,t){return Qi.getOverlapType(e,t)===na.NONE?[]:Zt.getAngularOverlaps(e._startAngle+e._rotation,e.getActualEndAngle()+e._rotation,t._startAngle+t._rotation,t.getActualEndAngle()+t._rotation)}static intersect(e,t,i=1e-10){if(Qi.getOverlapType(e,t,i)===na.NONE)return Za.intersect(e,t);{const n=[],o=e.positionAt(0),c=e.positionAt(1),p=t.positionAt(0),f=t.positionAt(1);return o.equalsEpsilon(p,i)&&n.push(new vs(o.average(p),0,0)),o.equalsEpsilon(f,i)&&n.push(new vs(o.average(f),0,1)),c.equalsEpsilon(p,i)&&n.push(new vs(c.average(p),1,0)),c.equalsEpsilon(f,i)&&n.push(new vs(c.average(f),1,1)),n}}static computeUnitMatrix(e,t,i,s){return Ze.translationFromVector(e).timesMatrix(Ze.rotation2(s)).timesMatrix(Ze.scaling(t,i))}static computeUnitTransform(e,t,i,s){return new Ks(Qi.computeUnitMatrix(e,t,i,s))}}const Fn=class Fn extends Ur{};Fn.MATCHING_OVERLAP=new Fn,Fn.OPPOSITE_OVERLAP=new Fn,Fn.NONE=new Fn,Fn.enumeration=new Yr(Fn);let na=Fn;ui.register("EllipticalArc",Qi);class Ds{constructor(e,t,i){if(this.segments=[],this.invalidatedEmitter=new ri,this._bounds=null,this._strokedSubpaths=null,this._strokedSubpathsComputed=!1,this._strokedStyles=null,this._invalidatingPoints=!1,this.points=t||(e&&e.length?_.map(e,s=>s.start).concat(e[e.length-1].end):[]),this.closed=!!i,this._invalidateListener=this.invalidate.bind(this),e)for(let s=0;s<e.length;s++)_.each(e[s].getNondegenerateSegments(),n=>{this.addSegmentDirectly(n)})}getBounds(){if(this._bounds===null){const e=$e.NOTHING.copy();_.each(this.segments,t=>{e.includeBounds(t.getBounds())}),this._bounds=e}return this._bounds}get bounds(){return this.getBounds()}getArcLength(e,t,i){let s=0;for(let n=0;n<this.segments.length;n++)s+=this.segments[n].getArcLength(e,t,i);return s}copy(){return new Ds(this.segments.slice(0),this.points.slice(0),this.closed)}invalidatePoints(){this._invalidatingPoints=!0;const e=this.segments.length;for(let t=0;t<e;t++)this.segments[t].invalidate();this._invalidatingPoints=!1,this.invalidate()}invalidate(){this._invalidatingPoints||(this._bounds=null,this._strokedSubpathsComputed=!1,this.invalidatedEmitter.emit())}addPoint(e){return this.points.push(e),this}addSegmentDirectly(e){return assert&&assert(e.start.isFinite(),"Segment start is infinite"),assert&&assert(e.end.isFinite(),"Segment end is infinite"),assert&&assert(e.startTangent.isFinite(),"Segment startTangent is infinite"),assert&&assert(e.endTangent.isFinite(),"Segment endTangent is infinite"),assert&&assert(e.bounds.isEmpty()||e.bounds.isFinite(),"Segment bounds is infinite and non-empty"),this.segments.push(e),e.invalidationEmitter.addListener(this._invalidateListener),this}addSegment(e){const i=e.getNondegenerateSegments().length;for(let s=0;s<i;s++)this.addSegmentDirectly(e);return this.invalidate(),this}addClosingSegment(){if(this.hasClosingSegment()){const e=this.getClosingSegment();this.addSegmentDirectly(e),this.invalidate(),this.addPoint(this.getFirstPoint()),this.closed=!0}}close(){this.closed=!0,this.addClosingSegment()}getLength(){return this.points.length}getFirstPoint(){return assert&&assert(this.points.length),_.first(this.points)}getLastPoint(){return assert&&assert(this.points.length),_.last(this.points)}getFirstSegment(){return assert&&assert(this.segments.length),_.first(this.segments)}getLastSegment(){return assert&&assert(this.segments.length),_.last(this.segments)}getFillSegments(){const e=this.segments.slice();return this.hasClosingSegment()&&e.push(this.getClosingSegment()),e}isDrawable(){return this.segments.length>0}isClosed(){return this.closed}hasClosingSegment(){return!this.getFirstPoint().equalsEpsilon(this.getLastPoint(),1e-9)}getClosingSegment(){return assert&&assert(this.hasClosingSegment(),"Implicit closing segment unnecessary on a fully closed path"),new Ct(this.getLastPoint(),this.getFirstPoint())}getClosestPoints(e){return Gi.filterClosestToPointResult(_.flatten(this.segments.map(t=>t.getClosestPoints(e))))}writeToContext(e){if(this.isDrawable()){const t=this.getFirstSegment().start;e.moveTo(t.x,t.y);let i=this.segments.length;this.closed&&i>=2&&this.segments[i-1]instanceof Ct&&i--;for(let s=0;s<i;s++)this.segments[s].writeToContext(e);this.closed&&e.closePath()}}toPiecewiseLinear(e){return assert&&assert(!e.pointMap,"For use with pointMap, please use nonlinearTransformed"),new Ds(_.flatten(_.map(this.segments,t=>t.toPiecewiseLinearSegments(e))),void 0,this.closed)}transformed(e){return new Ds(_.map(this.segments,t=>t.transformed(e)),_.map(this.points,t=>e.timesVector2(t)),this.closed)}nonlinearTransformed(e){return new Ds(_.flatten(_.map(this.segments,t=>e.methodName&&t[e.methodName]?t[e.methodName](e):t.toPiecewiseLinearSegments(e))),void 0,this.closed)}getBoundsWithTransform(e){const t=$e.NOTHING.copy(),i=this.segments.length;for(let s=0;s<i;s++)t.includeBounds(this.segments[s].getBoundsWithTransform(e));return t}offset(e){if(!this.isDrawable())return new Ds([],void 0,this.closed);if(e===0)return new Ds(this.segments.slice(),void 0,this.closed);let t;const i=this.segments.slice(),s=[];for(t=0;t<i.length;t++)s.push(i[t].strokeLeft(2*e));let n=[];for(t=0;t<i.length;t++){if(this.closed||t>0){const o=(t>0?t:i.length)-1,c=i[t].start,p=i[o].endTangent,f=i[t].startTangent,w=p.perpendicular.negated().times(e).angle,O=f.perpendicular.negated().times(e).angle,T=p.perpendicular.dot(f)>0;n.push(new Zt(c,Math.abs(e),w,O,T))}n=n.concat(s[t])}return new Ds(n,void 0,this.closed)}stroked(e){if(!this.isDrawable())return[];if(e===void 0&&(e=new Qa),assert&&assert(!this._strokedSubpathsComputed||this._strokedStyles&&this._strokedSubpaths),this._strokedSubpathsComputed&&this._strokedStyles.equals(e))return this._strokedSubpaths;const t=e.lineWidth;let i,s=[],n=[];const o=this.getFirstSegment(),c=this.getLastSegment(),p=z=>{s=s.concat(z)},f=z=>{n=n.concat(z)},w=c.end.equals(o.start),O=w?null:new Ct(this.segments[this.segments.length-1].end,this.segments[0].start);for(i=0;i<this.segments.length;i++)i>0&&p(e.leftJoin(this.segments[i].start,this.segments[i-1].endTangent,this.segments[i].startTangent)),p(this.segments[i].strokeLeft(t));for(i=this.segments.length-1;i>=0;i--)i<this.segments.length-1&&f(e.rightJoin(this.segments[i].end,this.segments[i].endTangent,this.segments[i+1].startTangent)),f(this.segments[i].strokeRight(t));let T;return this.closed?(w?(p(e.leftJoin(c.end,c.endTangent,o.startTangent)),f(e.rightJoin(c.end,c.endTangent,o.startTangent))):(p(e.leftJoin(O.start,c.endTangent,O.startTangent)),p(O.strokeLeft(t)),p(e.leftJoin(O.end,O.endTangent,o.startTangent)),f(e.rightJoin(O.end,O.endTangent,o.startTangent)),f(O.strokeRight(t)),f(e.rightJoin(O.start,c.endTangent,O.startTangent))),T=[new Ds(s,void 0,!0),new Ds(n,void 0,!0)]):T=[new Ds(s.concat(e.cap(c.end,c.endTangent)).concat(n).concat(e.cap(o.start,o.startTangent.negated())),void 0,!0)],this._strokedSubpaths=T,this._strokedSubpathsComputed=!0,this._strokedStyles=e.copy(),T}dashed(e,t,i,s){const n=(p,f)=>{const w=p[p.length-1].concat(f[0]),O=p.slice(0,p.length-1).concat([w]).concat(f.slice(1));return assert&&assert(O.length===p.length+f.length-1),O},o=(p,f)=>{if(!p.hasRightFilled||!f.hasLeftFilled)return!1;const w=_.last(_.last(p.segmentArrays)),O=f.segmentArrays[0][0];return w.end.distance(O.start)<1e-5},c=[];for(let p=0;p<this.segments.length;p++){const f=this.segments[p],w=f.getDashValues(e,t,i,s);c.push(w),t+=w.arcLength;const O=[0].concat(w.values).concat([1]),T=w.initiallyInside;w.hasLeftFilled=T,w.hasRightFilled=O.length%2===0?T:!T,w.segmentArrays=[];for(let z=T?0:1;z<O.length-1;z+=2)O[z]!==O[z+1]&&w.segmentArrays.push([f.slice(O[z],O[z+1])])}for(let p=c.length-1;p>=1;p--){const f=c[p-1],w=c[p];o(f,w)&&c.splice(p-1,2,{segmentArrays:n(f.segmentArrays,w.segmentArrays),hasLeftFilled:f.hasLeftFilled,hasRightFilled:w.hasRightFilled})}if(c.length>1&&o(c[c.length-1],c[0])){const p=c.pop(),f=c.shift();c.push({segmentArrays:n(p.segmentArrays,f.segmentArrays),hasLeftFilled:p.hasLeftFilled,hasRightFilled:f.hasRightFilled})}return this.closed&&c.length===1&&c[0].segmentArrays.length===1&&c[0].hasLeftFilled&&c[0].hasRightFilled?[new Ds(c[0].segmentArrays[0],void 0,!0)]:_.flatten(c.map(p=>p.segmentArrays)).map(p=>new Ds(p))}serialize(){return{type:"Subpath",segments:this.segments.map(e=>e.serialize()),points:this.points.map(e=>({x:e.x,y:e.y})),closed:this.closed}}static deserialize(e){return assert&&assert(e.type==="Subpath"),new Ds(e.segments.map(Gi.deserialize),e.points.map(t=>new Pe(t.x,t.y)),e.closed)}}ui.register("Subpath",Ds);const ks=Ds,Wl=Math.random,Li=(h,e)=>new Pe(h,e),Bg=(h,e,t,i)=>t.copy().subtract(h).multiplyScalar((1-i)/6).add(e),Pi=class Pi{constructor(e,t){if(this.subpaths=[],this._invalidatingPoints=!1,this._immutable=!1,this.invalidatedEmitter=new ri,this.lastQuadraticControlPoint=null,this.lastCubicControlPoint=null,this._bounds=t?t.copy():null,this.resetControlPoints(),this._invalidateListener=this.invalidate.bind(this),typeof e=="object")for(let i=0;i<e.length;i++)this.addSubpath(e[i]);e&&typeof e!="object"&&_.each(Qb.parse(e),i=>{assert&&assert(Pi.prototype[i.cmd]!==void 0,`method ${i.cmd} from parsed SVG does not exist`),this[i.cmd].apply(this,i.args)}),this.invalidate()}resetControlPoints(){this.lastQuadraticControlPoint=null,this.lastCubicControlPoint=null}setQuadraticControlPoint(e){this.lastQuadraticControlPoint=e,this.lastCubicControlPoint=null}setCubicControlPoint(e){this.lastQuadraticControlPoint=null,this.lastCubicControlPoint=e}moveTo(e,t){return assert&&assert(isFinite(e),`x must be a finite number: ${e}`),assert&&assert(isFinite(t),`y must be a finite number: ${t}`),this.moveToPoint(Li(e,t))}moveToRelative(e,t){return assert&&assert(isFinite(e),`x must be a finite number: ${e}`),assert&&assert(isFinite(t),`y must be a finite number: ${t}`),this.moveToPointRelative(Li(e,t))}moveToPointRelative(e){return this.moveToPoint(this.getRelativePoint().plus(e))}moveToPoint(e){return this.addSubpath(new ks().addPoint(e)),this.resetControlPoints(),this}lineTo(e,t){return assert&&assert(isFinite(e),`x must be a finite number: ${e}`),assert&&assert(isFinite(t),`y must be a finite number: ${t}`),this.lineToPoint(Li(e,t))}lineToRelative(e,t){return assert&&assert(isFinite(e),`x must be a finite number: ${e}`),assert&&assert(isFinite(t),`y must be a finite number: ${t}`),this.lineToPointRelative(Li(e,t))}lineToPointRelative(e){return this.lineToPoint(this.getRelativePoint().plus(e))}lineToPoint(e){if(this.hasSubpaths()){const t=this.getLastSubpath().getLastPoint(),i=e,s=new Ct(t,i);this.getLastSubpath().addPoint(i),this.addSegmentAndBounds(s)}else this.ensure(e);return this.resetControlPoints(),this}horizontalLineTo(e){return this.lineTo(e,this.getRelativePoint().y)}horizontalLineToRelative(e){return this.lineToRelative(e,0)}verticalLineTo(e){return this.lineTo(this.getRelativePoint().x,e)}verticalLineToRelative(e){return this.lineToRelative(0,e)}zigZagTo(e,t,i,s,n){return this.zigZagToPoint(new Pe(e,t),i,s,n)}zigZagToPoint(e,t,i,s){assert&&assert(Number.isInteger(i),`numberZigZags must be an integer: ${i}`),this.ensure(e);const n=this.getLastPoint(),o=e.minus(n),c=o.normalized(),p=c.perpendicular.times(t);let f;s?f=o.magnitude/(i+.5):f=o.magnitude/i;for(let w=0;w<i;w++){const O=c.times(w*f).plus(n),T=O.plus(c.times(f/4)).plus(p),z=O.plus(c.times(3*f/4)).minus(p);this.lineToPoint(T),this.lineToPoint(z)}if(s){const O=c.times(i*f).plus(n).plus(c.times(f/4)).plus(p);this.lineToPoint(O)}return this.lineToPoint(e)}quadraticCurveTo(e,t,i,s){return assert&&assert(isFinite(e),`cpx must be a finite number: ${e}`),assert&&assert(isFinite(t),`cpy must be a finite number: ${t}`),assert&&assert(isFinite(i),`x must be a finite number: ${i}`),assert&&assert(isFinite(s),`y must be a finite number: ${s}`),this.quadraticCurveToPoint(Li(e,t),Li(i,s))}quadraticCurveToRelative(e,t,i,s){return assert&&assert(isFinite(e),`cpx must be a finite number: ${e}`),assert&&assert(isFinite(t),`cpy must be a finite number: ${t}`),assert&&assert(isFinite(i),`x must be a finite number: ${i}`),assert&&assert(isFinite(s),`y must be a finite number: ${s}`),this.quadraticCurveToPointRelative(Li(e,t),Li(i,s))}quadraticCurveToPointRelative(e,t){const i=this.getRelativePoint();return this.quadraticCurveToPoint(i.plus(e),i.plus(t))}smoothQuadraticCurveTo(e,t){return assert&&assert(isFinite(e),`x must be a finite number: ${e}`),assert&&assert(isFinite(t),`y must be a finite number: ${t}`),this.quadraticCurveToPoint(this.getSmoothQuadraticControlPoint(),Li(e,t))}smoothQuadraticCurveToRelative(e,t){return assert&&assert(isFinite(e),`x must be a finite number: ${e}`),assert&&assert(isFinite(t),`y must be a finite number: ${t}`),this.quadraticCurveToPoint(this.getSmoothQuadraticControlPoint(),Li(e,t).plus(this.getRelativePoint()))}quadraticCurveToPoint(e,t){this.ensure(e);const i=this.getLastSubpath().getLastPoint(),s=new zi(i,e,t);this.getLastSubpath().addPoint(t);const n=s.getNondegenerateSegments();return _.each(n,o=>{this.addSegmentAndBounds(o)}),this.setQuadraticControlPoint(e),this}cubicCurveTo(e,t,i,s,n,o){return assert&&assert(isFinite(e),`cp1x must be a finite number: ${e}`),assert&&assert(isFinite(t),`cp1y must be a finite number: ${t}`),assert&&assert(isFinite(i),`cp2x must be a finite number: ${i}`),assert&&assert(isFinite(s),`cp2y must be a finite number: ${s}`),assert&&assert(isFinite(n),`x must be a finite number: ${n}`),assert&&assert(isFinite(o),`y must be a finite number: ${o}`),this.cubicCurveToPoint(Li(e,t),Li(i,s),Li(n,o))}cubicCurveToRelative(e,t,i,s,n,o){return assert&&assert(isFinite(e),`cp1x must be a finite number: ${e}`),assert&&assert(isFinite(t),`cp1y must be a finite number: ${t}`),assert&&assert(isFinite(i),`cp2x must be a finite number: ${i}`),assert&&assert(isFinite(s),`cp2y must be a finite number: ${s}`),assert&&assert(isFinite(n),`x must be a finite number: ${n}`),assert&&assert(isFinite(o),`y must be a finite number: ${o}`),this.cubicCurveToPointRelative(Li(e,t),Li(i,s),Li(n,o))}cubicCurveToPointRelative(e,t,i){const s=this.getRelativePoint();return this.cubicCurveToPoint(s.plus(e),s.plus(t),s.plus(i))}smoothCubicCurveTo(e,t,i,s){return assert&&assert(isFinite(e),`cp2x must be a finite number: ${e}`),assert&&assert(isFinite(t),`cp2y must be a finite number: ${t}`),assert&&assert(isFinite(i),`x must be a finite number: ${i}`),assert&&assert(isFinite(s),`y must be a finite number: ${s}`),this.cubicCurveToPoint(this.getSmoothCubicControlPoint(),Li(e,t),Li(i,s))}smoothCubicCurveToRelative(e,t,i,s){return assert&&assert(isFinite(e),`cp2x must be a finite number: ${e}`),assert&&assert(isFinite(t),`cp2y must be a finite number: ${t}`),assert&&assert(isFinite(i),`x must be a finite number: ${i}`),assert&&assert(isFinite(s),`y must be a finite number: ${s}`),this.cubicCurveToPoint(this.getSmoothCubicControlPoint(),Li(e,t).plus(this.getRelativePoint()),Li(i,s).plus(this.getRelativePoint()))}cubicCurveToPoint(e,t,i){this.ensure(e);const s=this.getLastSubpath().getLastPoint(),o=new ts(s,e,t,i).getNondegenerateSegments();return _.each(o,c=>{this.addSegmentAndBounds(c)}),this.getLastSubpath().addPoint(i),this.setCubicControlPoint(t),this}arc(e,t,i,s,n,o){return assert&&assert(isFinite(e),`centerX must be a finite number: ${e}`),assert&&assert(isFinite(t),`centerY must be a finite number: ${t}`),this.arcPoint(Li(e,t),i,s,n,o)}arcPoint(e,t,i,s,n){n===void 0&&(n=!1);const o=new Zt(e,t,i,s,n),c=o.getStart(),p=o.getEnd();return this.hasSubpaths()&&this.getLastSubpath().getLength()>0&&!c.equals(this.getLastSubpath().getLastPoint())&&this.addSegmentAndBounds(new Ct(this.getLastSubpath().getLastPoint(),c)),this.hasSubpaths()||this.addSubpath(new ks),this.getLastSubpath().addPoint(c),this.getLastSubpath().addPoint(p),this.addSegmentAndBounds(o),this.resetControlPoints(),this}ellipticalArc(e,t,i,s,n,o,c,p){return assert&&assert(isFinite(e),`centerX must be a finite number: ${e}`),assert&&assert(isFinite(t),`centerY must be a finite number: ${t}`),this.ellipticalArcPoint(Li(e,t),i,s,n,o,c,p)}ellipticalArcPoint(e,t,i,s,n,o,c){c===void 0&&(c=!1);const p=new Qi(e,t,i,s,n,o,c),f=p.start,w=p.end;return this.hasSubpaths()&&this.getLastSubpath().getLength()>0&&!f.equals(this.getLastSubpath().getLastPoint())&&this.addSegmentAndBounds(new Ct(this.getLastSubpath().getLastPoint(),f)),this.hasSubpaths()||this.addSubpath(new ks),this.getLastSubpath().addPoint(f),this.getLastSubpath().addPoint(w),this.addSegmentAndBounds(p),this.resetControlPoints(),this}close(){if(this.hasSubpaths()){const e=this.getLastSubpath(),t=new ks;e.close(),this.addSubpath(t),t.addPoint(e.getFirstPoint())}return this.resetControlPoints(),this}newSubpath(){return this.addSubpath(new ks),this.resetControlPoints(),this}makeImmutable(){return this._immutable=!0,this.notifyInvalidationListeners(),this}isImmutable(){return this._immutable}ellipticalArcToRelative(e,t,i,s,n,o,c){const p=this.getRelativePoint();return this.ellipticalArcTo(e,t,i,s,n,o+p.x,c+p.y)}ellipticalArcTo(e,t,i,s,n,o,c){const p=new Pe(o,c);this.ensure(p);const f=this.getLastSubpath().getLastPoint();this.getLastSubpath().addPoint(p),e<0&&(e*=-1),t<0&&(t*=-1);let w=e*e,O=t*t;const T=f.minus(p).dividedScalar(2).rotated(-i),z=T.x*T.x,U=T.y*T.y;let m=new Pe(e*T.y/t,-t*T.x/e);const Y=z/w+U/O;Y>1&&(e*=Math.sqrt(Y),t*=Math.sqrt(Y),w=e*e,O=t*t,m=new Pe(e*T.y/t,-t*T.x/e)),m.multiplyScalar(Math.sqrt(Math.max(0,(w*O-w*U-O*z)/(w*U+O*z)))),s===n&&m.multiplyScalar(-1);const j=f.blend(p,.5).plus(m.rotated(i)),le=(He,Me)=>(He.x*Me.y-He.y*Me.x>0?1:-1)*He.angleBetween(Me),xe=new Pe((T.x-m.x)/e,(T.y-m.y)/t),ce=new Pe((-T.x-m.x)/e,(-T.y-m.y)/t),ne=le(Pe.X_UNIT,xe);let me=le(xe,ce)%(Math.PI*2);!n&&me>0&&(me-=Math.PI*2),n&&me<0&&(me+=Math.PI*2);const we=new Qi(j,e,t,i,ne,ne+me,!n).getNondegenerateSegments();return _.each(we,He=>{this.addSegmentAndBounds(He)}),this}circle(e,t,i){if(typeof e=="object"){const s=e;return i=t,this.arcPoint(s,i,0,Math.PI*2,!1).close()}else return assert&&assert(isFinite(e),`centerX must be a finite number: ${e}`),assert&&assert(isFinite(t),`centerY must be a finite number: ${t}`),this.arcPoint(Li(e,t),i,0,Math.PI*2,!1).close()}ellipse(e,t,i,s,n){if(typeof e=="object"){const o=e;return n=s,s=i,i=t,this.ellipticalArcPoint(o,i,s,n||0,0,Math.PI*2,!1).close()}else return assert&&assert(isFinite(e),`centerX must be a finite number: ${e}`),assert&&assert(isFinite(t),`centerY must be a finite number: ${t}`),this.ellipticalArcPoint(Li(e,t),i,s,n||0,0,Math.PI*2,!1).close()}rect(e,t,i,s){assert&&assert(isFinite(e),`x must be a finite number: ${e}`),assert&&assert(isFinite(t),`y must be a finite number: ${t}`),assert&&assert(isFinite(i),`width must be a finite number: ${i}`),assert&&assert(isFinite(s),`height must be a finite number: ${s}`);const n=new ks;return this.addSubpath(n),n.addPoint(Li(e,t)),n.addPoint(Li(e+i,t)),n.addPoint(Li(e+i,t+s)),n.addPoint(Li(e,t+s)),this.addSegmentAndBounds(new Ct(n.points[0],n.points[1])),this.addSegmentAndBounds(new Ct(n.points[1],n.points[2])),this.addSegmentAndBounds(new Ct(n.points[2],n.points[3])),n.close(),this.addSubpath(new ks),this.getLastSubpath().addPoint(Li(e,t)),assert&&assert(!isNaN(this.bounds.getX())),this.resetControlPoints(),this}roundRect(e,t,i,s,n,o){const c=e+n,p=e+i-n,f=t+o,w=t+s-o;return n===o?this.arc(p,f,n,-Math.PI/2,0,!1).arc(p,w,n,0,Math.PI/2,!1).arc(c,w,n,Math.PI/2,Math.PI,!1).arc(c,f,n,Math.PI,Math.PI*3/2,!1).close():this.ellipticalArc(p,f,n,o,0,-Math.PI/2,0,!1).ellipticalArc(p,w,n,o,0,0,Math.PI/2,!1).ellipticalArc(c,w,n,o,0,Math.PI/2,Math.PI,!1).ellipticalArc(c,f,n,o,0,Math.PI,Math.PI*3/2,!1).close(),this}polygon(e){const t=e.length;if(t>0){this.moveToPoint(e[0]);for(let i=1;i<t;i++)this.lineToPoint(e[i])}return this.close()}cardinalSpline(e,t){const i=st()({tension:0,isClosedLineSegments:!1},t);assert&&assert(i.tension<1&&i.tension>-1," the tension goes from -1 to 1 ");const s=e.length,n=i.isClosedLineSegments?s:s-1;for(let o=0;o<n;o++){let c;o===0&&!i.isClosedLineSegments?c=[e[0],e[0],e[1],e[2]]:o===n-1&&!i.isClosedLineSegments?c=[e[o-1],e[o],e[o+1],e[o+1]]:c=[e[(o-1+s)%s],e[o%s],e[(o+1)%s],e[(o+2)%s]];const p=[c[1],Bg(c[0],c[1],c[2],i.tension),Bg(c[3],c[2],c[1],i.tension),c[2]];o===0&&(this.ensure(p[0]),this.getLastSubpath().addPoint(p[0])),this.cubicCurveToPoint(p[1],p[2],p[3])}return this}copy(){return new Pi(_.map(this.subpaths,e=>e.copy()),this.bounds)}writeToContext(e){const t=this.subpaths.length;for(let i=0;i<t;i++)this.subpaths[i].writeToContext(e)}getSVGPath(){let e="";const t=this.subpaths.length;for(let i=0;i<t;i++){const s=this.subpaths[i];if(s.isDrawable()){const n=s.segments[0].start;e+=`M ${Xt(n.x)} ${Xt(n.y)} `;for(let o=0;o<s.segments.length;o++)e+=`${s.segments[o].getSVGPathFragment()} `;s.isClosed()&&(e+="Z ")}}return e}transformed(e){const t=_.map(this.subpaths,s=>s.transformed(e)),i=_.reduce(t,(s,n)=>s.union(n.bounds),$e.NOTHING);return new Pi(t,i)}nonlinearTransformed(e){const t=_i({minLevels:0,maxLevels:7,distanceEpsilon:.16,curveEpsilon:e&&e.includeCurvature?.002:null},e),i=_.map(this.subpaths,n=>n.nonlinearTransformed(t)),s=_.reduce(i,(n,o)=>n.union(o.bounds),$e.NOTHING);return new Pi(i,s)}polarToCartesian(e){return this.nonlinearTransformed(_i({pointMap:t=>Pe.createPolar(t.y,t.x),methodName:"polarToCartesian"},e))}toPiecewiseLinear(e){return assert&&assert(!e||!e.pointMap,"No pointMap for toPiecewiseLinear allowed, since it could create non-linear segments"),assert&&assert(!e||!e.methodName,"No methodName for toPiecewiseLinear allowed, since it could create non-linear segments"),this.nonlinearTransformed(e)}containsPoint(e){const t=Pe.X_UNIT.copy();let i=0;for(;i<5&&(i++,_.some(this.subpaths,n=>_.some(n.segments,o=>{const c=o.start.minus(e),p=c.magnitude;return p!==0?(c.divideScalar(p),c.subtract(t),c.magnitudeSquared<1e-9):!1})));)t.rotate(Ba.nextDouble());return this.windingIntersection(new ir(e,t))!==0}intersection(e){let t=[];const i=this.subpaths.length;for(let s=0;s<i;s++){const n=this.subpaths[s];if(n.isDrawable()){const o=n.segments.length;for(let c=0;c<o;c++){const p=n.segments[c];t=t.concat(p.intersection(e))}n.hasClosingSegment()&&(t=t.concat(n.getClosingSegment().intersection(e)))}}return _.sortBy(t,s=>s.distance)}interiorIntersectsLineSegment(e,t){const i=e.blend(t,.5);if(this.containsPoint(i))return!0;const s=t.minus(e),n=s.magnitude;if(n===0)return!1;s.normalize();const o=this.intersection(new ir(e,s));for(let c=0;c<o.length;c++)if(o[c].distance<=n)return!0;return!1}windingIntersection(e){let t=0;const i=this.subpaths.length;for(let s=0;s<i;s++){const n=this.subpaths[s];if(n.isDrawable()){const o=n.segments.length;for(let c=0;c<o;c++)t+=n.segments[c].windingIntersection(e);n.hasClosingSegment()&&(t+=n.getClosingSegment().windingIntersection(e))}}return t}intersectsBounds(e){if(this.bounds.intersection(e).equals(this.bounds))return!0;const t=new ir(new Pe(e.minX,e.minY),new Pe(1,0)),i=new ir(new Pe(e.minX,e.minY),new Pe(0,1)),s=new ir(new Pe(e.maxX,e.maxY),new Pe(-1,0)),n=new ir(new Pe(e.maxX,e.maxY),new Pe(0,-1));let o,c;const p=this.intersection(t).concat(this.intersection(s));for(c=0;c<p.length;c++)if(o=p[c].point,o.x>=e.minX&&o.x<=e.maxX)return!0;const f=this.intersection(i).concat(this.intersection(n));for(c=0;c<f.length;c++)if(o=f[c].point,o.y>=e.minY&&o.y<=e.maxY)return!0;return!1}getStrokedShape(e){let t=[];const i=$e.NOTHING.copy();let s=this.subpaths.length;for(let n=0;n<s;n++){const c=this.subpaths[n].stroked(e);t=t.concat(c)}s=t.length;for(let n=0;n<s;n++)i.includeBounds(t[n].bounds);return new Pi(t,i)}getOffsetShape(e){const t=[],i=$e.NOTHING.copy();let s=this.subpaths.length;for(let n=0;n<s;n++)t.push(this.subpaths[n].offset(e));s=t.length;for(let n=0;n<s;n++)i.includeBounds(t[n].bounds);return new Pi(t,i)}getDashedShape(e,t,i){const s=st()({distanceEpsilon:1e-10,curveEpsilon:1e-8},i);return new Pi(_.flatten(this.subpaths.map(n=>n.dashed(e,t,s.distanceEpsilon,s.curveEpsilon))))}getBounds(){if(this._bounds===null){const e=$e.NOTHING.copy();_.each(this.subpaths,t=>{e.includeBounds(t.getBounds())}),this._bounds=e}return this._bounds}get bounds(){return this.getBounds()}getStrokedBounds(e){let t=!0;for(let i=0;i<this.subpaths.length;i++){const s=this.subpaths[i];if(s.isDrawable()&&!s.isClosed()){t=!1;break}for(let n=0;n<s.segments.length;n++)if(!s.segments[n].areStrokedBoundsDilated()){t=!1;break}}if(t)return this.bounds.dilated(e.lineWidth/2);{const i=this.bounds.copy();for(let s=0;s<this.subpaths.length;s++){const n=this.subpaths[s].stroked(e);for(let o=0;o<n.length;o++)i.includeBounds(n[o].bounds)}return i}}getSimplifiedAreaShape(){return en.simplifyNonZero(this)}getBoundsWithTransform(e,t){const i=$e.NOTHING.copy(),s=this.subpaths.length;for(let n=0;n<s;n++){const o=this.subpaths[n];i.includeBounds(o.getBoundsWithTransform(e))}return t&&i.includeBounds(this.getStrokedShape(t).getBoundsWithTransform(e)),i}getApproximateArea(e){const t=this.bounds.minX,i=this.bounds.minY,s=this.bounds.width,n=this.bounds.height,o=s*n;let c=0;const p=new Pe(0,0);for(let f=0;f<e;f++)p.x=t+Wl()*s,p.y=i+Wl()*n,this.containsPoint(p)&&c++;return o*c/e}getNonoverlappingArea(){return Math.abs(_.sum(this.subpaths.map(e=>_.sum(e.getFillSegments().map(t=>t.getSignedAreaFragment())))))}getArea(){return this.getSimplifiedAreaShape().getNonoverlappingArea()}getApproximateCentroid(e){const t=this.bounds.minX,i=this.bounds.minY,s=this.bounds.width,n=this.bounds.height;let o=0;const c=new Pe(0,0),p=new Pe(0,0);for(let f=0;f<e;f++)p.x=t+Wl()*s,p.y=i+Wl()*n,this.containsPoint(p)&&(c.add(p),o++);return c.dividedScalar(o)}getClosestPoints(e){return Gi.filterClosestToPointResult(_.flatten(this.subpaths.map(t=>t.getClosestPoints(e))))}getClosestPoint(e){return this.getClosestPoints(e)[0].closestPoint}invalidatePoints(){this._invalidatingPoints=!0;const e=this.subpaths.length;for(let t=0;t<e;t++)this.subpaths[t].invalidatePoints();this._invalidatingPoints=!1,this.invalidate()}toString(){return`new phet.kite.Shape( '${this.getSVGPath()}' )`}invalidate(){assert&&assert(!this._immutable,"Attempt to modify an immutable Shape"),this._invalidatingPoints||(this._bounds=null,this.notifyInvalidationListeners())}notifyInvalidationListeners(){this.invalidatedEmitter.emit()}addSegmentAndBounds(e){this.getLastSubpath().addSegment(e),this.invalidate()}ensure(e){this.hasSubpaths()||(this.addSubpath(new ks),this.getLastSubpath().addPoint(e))}addSubpath(e){return this.subpaths.push(e),e.invalidatedEmitter.addListener(this._invalidateListener),this.invalidate(),this}hasSubpaths(){return this.subpaths.length>0}getLastSubpath(){return assert&&assert(this.hasSubpaths(),"We should have a subpath if this is called"),_.last(this.subpaths)}getLastPoint(){return assert&&assert(this.hasSubpaths(),"We should have a subpath if this is called"),assert&&assert(this.getLastSubpath().getLastPoint(),"We should have a last point"),this.getLastSubpath().getLastPoint()}getLastSegment(){if(!this.hasSubpaths())return null;const e=this.getLastSubpath();return e.isDrawable()?e.getLastSegment():null}getSmoothQuadraticControlPoint(){const e=this.getLastPoint();return this.lastQuadraticControlPoint?e.plus(e.minus(this.lastQuadraticControlPoint)):e}getSmoothCubicControlPoint(){const e=this.getLastPoint();return this.lastCubicControlPoint?e.plus(e.minus(this.lastCubicControlPoint)):e}getRelativePoint(){let e=Pe.ZERO;if(this.hasSubpaths()){const t=this.getLastSubpath();t.points.length&&(e=t.getLastPoint())}return e}shapeUnion(e){return en.binaryResult(this,e,en.BINARY_NONZERO_UNION)}shapeIntersection(e){return en.binaryResult(this,e,en.BINARY_NONZERO_INTERSECTION)}shapeDifference(e){return en.binaryResult(this,e,en.BINARY_NONZERO_DIFFERENCE)}shapeXor(e){return en.binaryResult(this,e,en.BINARY_NONZERO_XOR)}shapeClip(e,t){return en.clipShape(e,this,t)}getArcLength(e,t,i){let s=0;for(let n=0;n<this.subpaths.length;n++)s+=this.subpaths[n].getArcLength(e,t,i);return s}serialize(){return{type:"Shape",subpaths:this.subpaths.map(e=>e.serialize())}}static deserialize(e){return assert&&assert(e.type==="Shape"),new Pi(e.subpaths.map(ks.deserialize))}static rectangle(e,t,i,s){return new Pi().rect(e,t,i,s)}static roundRect(e,t,i,s,n,o){return new Pi().roundRect(e,t,i,s,n,o)}static roundedRectangleWithRadii(e,t,i,s,n){let o=n&&n.topLeft||0,c=n&&n.topRight||0,p=n&&n.bottomLeft||0,f=n&&n.bottomRight||0;assert&&assert(isFinite(e),"Non-finite x"),assert&&assert(isFinite(t),"Non-finite y"),assert&&assert(i>=0&&isFinite(i),"Negative or non-finite width"),assert&&assert(s>=0&&isFinite(s),"Negative or non-finite height"),assert&&assert(o>=0&&isFinite(o),"Invalid topLeft"),assert&&assert(c>=0&&isFinite(c),"Invalid topRight"),assert&&assert(p>=0&&isFinite(p),"Invalid bottomLeft"),assert&&assert(f>=0&&isFinite(f),"Invalid bottomRight");const w=o+c;w>i&&w>0&&(o=o/w*i,c=c/w*i);const O=p+f;O>i&&O>0&&(p=p/O*i,f=f/O*i);const T=o+p;T>s&&T>0&&(o=o/T*s,p=p/T*s);const z=c+f;z>s&&z>0&&(c=c/z*s,f=f/z*s),assert&&assert(o+c<=i,"Corner overlap on top edge"),assert&&assert(p+f<=i,"Corner overlap on bottom edge"),assert&&assert(o+p<=s,"Corner overlap on left edge"),assert&&assert(c+f<=s,"Corner overlap on right edge");const U=new Pi,m=e+i,Y=t+s;return f>0?U.arc(m-f,Y-f,f,0,Math.PI/2,!1):U.moveTo(m,Y),p>0?U.arc(e+p,Y-p,p,Math.PI/2,Math.PI,!1):U.lineTo(e,Y),o>0?U.arc(e+o,t+o,o,Math.PI,3*Math.PI/2,!1):U.lineTo(e,t),c>0?U.arc(m-c,t+c,c,3*Math.PI/2,2*Math.PI,!1):U.lineTo(m,t),U.close(),U}static boundsOffsetWithRadii(e,t,i){const s=e.withOffsets(t.left,t.top,t.right,t.bottom);return Pi.roundedRectangleWithRadii(s.minX,s.minY,s.width,s.height,i)}static polygon(e){return new Pi().polygon(e)}static bounds(e){return new Pi().rect(e.minX,e.minY,e.maxX-e.minX,e.maxY-e.minY)}static lineSegment(e,t,i,s){return typeof e=="number"?new Pi().moveTo(e,t).lineTo(i,s):new Pi().moveToPoint(e).lineToPoint(t)}static regularPolygon(e,t){const i=new Pi;return _.each(_.range(e),s=>{const n=Pe.createPolar(t,2*Math.PI*s/e);s===0?i.moveToPoint(n):i.lineToPoint(n)}),i.close()}static circle(e,t,i){return t===void 0?new Pi().circle(0,0,e):new Pi().circle(e,t,i)}static ellipse(e,t,i,s,n){return s===void 0?new Pi().ellipse(0,0,e,t,i):new Pi().ellipse(e,t,i,s,n)}static arc(e,t,i,s,n,o){return new Pi().arc(e,t,i,s,n,o)}static union(e){return en.unionNonZero(e)}static intersection(e){return en.intersectionNonZero(e)}static xor(e){return en.xorNonZero(e)}static segments(e,t){if(assert)for(let i=1;i<e.length;i++)assert(e[i-1].end.equalsEpsilon(e[i].start,1e-6),"Mismatched start/end");return new Pi([new ks(e,void 0,!!t)])}};Pi.rect=Pi.rectangle,Pi.roundRectangle=Pi.roundRect;let rh=Pi;ui.register("Shape",rh);const kt=rh;let o_=0;const Uo=class Uo{constructor(e,t){this.id=++o_,this.initialize(e,t)}initialize(e,t){return assert&&assert(e instanceof ui.Edge),assert&&assert(typeof t=="boolean"),this.edge=e,this.face=null,this.isReversed=t,this.signedAreaFragment=e.signedAreaFragment*(t?-1:1),this.startVertex=null,this.endVertex=null,this.sortVector=this.sortVector||new Pe(0,0),this.data=null,this.updateReferences(),this}serialize(){return{type:"HalfEdge",id:this.id,edge:this.edge.id,face:this.face===null?null:this.face.id,isReversed:this.isReversed,signedAreaFragment:this.signedAreaFragment,startVertex:this.startVertex===null?null:this.startVertex.id,endVertex:this.endVertex===null?null:this.endVertex.id,sortVector:Pe.Vector2IO.toStateObject(this.sortVector),data:this.data}}dispose(){this.edge=null,this.face=null,this.startVertex=null,this.endVertex=null,this.data=null,this.freeToPool()}getNext(e){for(let t=1;;t++){let i=this.endVertex.incidentHalfEdges.indexOf(this)-t;i<0&&(i+=this.endVertex.incidentHalfEdges.length);const s=this.endVertex.incidentHalfEdges[i].getReversed();if(!(e&&!e(s.edge)))return assert&&assert(this.endVertex===s.startVertex),s}}updateReferences(){this.startVertex=this.isReversed?this.edge.endVertex:this.edge.startVertex,this.endVertex=this.isReversed?this.edge.startVertex:this.edge.endVertex,assert&&assert(this.startVertex),assert&&assert(this.endVertex)}getEndTangent(){return this.isReversed?this.edge.segment.startTangent:this.edge.segment.endTangent.negated()}getEndCurvature(){return this.isReversed?-this.edge.segment.curvatureAt(0):this.edge.segment.curvatureAt(1)}getReversed(){return this.isReversed?this.edge.forwardHalf:this.edge.reversedHalf}getDirectionalSegment(){return this.isReversed?this.edge.segment.reversed():this.edge.segment}freeToPool(){Uo.pool.freeToPool(this)}};br(Uo,"pool",new qi(Uo));let fl=Uo;ui.register("HalfEdge",fl);let l_=0;const Na=class Na{constructor(e){this.id=++l_,this.initialize(e)}initialize(e){return assert&&assert(e instanceof Pe),this.point=e,this.incidentHalfEdges=vt(this.incidentHalfEdges),this.visited=!1,this.visitIndex=0,this.lowIndex=0,this.data=null,this.internalData={},this}serialize(){return{type:"Vertex",id:this.id,point:Pe.Vector2IO.toStateObject(this.point),incidentHalfEdges:this.incidentHalfEdges.map(e=>e.id),visited:this.visited,visitIndex:this.visitIndex,lowIndex:this.lowIndex}}dispose(){this.point=Pe.ZERO,vt(this.incidentHalfEdges),this.freeToPool()}sortEdges(){const e=[];for(let s=0;s<this.incidentHalfEdges.length;s++){const n=this.incidentHalfEdges[s];e.push(n.sortVector.setXY(n.getEndTangent().angle,n.getEndCurvature()))}const t=-Math.PI+1e-4;let i=!1;for(;!i;){i=!0;for(let s=0;s<e.length;s++)e[s].x<t&&(i=!1);if(!i)for(let s=0;s<e.length;s++){const n=e[s];n.x-=1.62594024516,n.x<-Math.PI-1e-4&&(n.x+=Math.PI*2)}}this.incidentHalfEdges.sort(Na.edgeComparison)}static edgeComparison(e,t){const i=e.sortVector.x,s=t.sortVector.x;if(Math.abs(i-s)>1e-5||i!==s&&e.edge.segment instanceof Ct&&t.edge.segment instanceof Ct)return i<s?-1:1;{const n=e.sortVector.y,o=t.sortVector.y;if(Math.abs(n-o)>1e-5)return n<o?1:-1;{const p=e.getDirectionalSegment().subdivided(.999)[1].curvatureAt(0),f=t.getDirectionalSegment().subdivided(.999)[1].curvatureAt(0);return p<f?1:-1}}}freeToPool(){Na.pool.freeToPool(this)}};br(Na,"pool",new qi(Na));let Es=Na;ui.register("Vertex",Es);let h_=0;const Yo=class Yo{constructor(e,t,i){this.id=++h_,this.initialize(e,t,i)}initialize(e,t,i){return assert&&assert(e instanceof Gi),assert&&assert(t instanceof Es),assert&&assert(i instanceof Es),assert&&assert(e.start.distance(t.point)<.001),assert&&assert(e.end.distance(i.point)<.001),this.segment=e,this.startVertex=t,this.endVertex=i,this.signedAreaFragment=e.getSignedAreaFragment(),this.forwardHalf=fl.pool.create(this,!1),this.reversedHalf=fl.pool.create(this,!0),this.visited=!1,this.data=null,this.internalData={},this}serialize(){return{type:"Edge",id:this.id,segment:this.segment.serialize(),startVertex:this.startVertex===null?null:this.startVertex.id,endVertex:this.endVertex===null?null:this.endVertex.id,signedAreaFragment:this.signedAreaFragment,forwardHalf:this.forwardHalf.serialize(),reversedHalf:this.reversedHalf.serialize(),visited:this.visited,data:this.data}}dispose(){this.segment=null,this.startVertex=null,this.endVertex=null,this.forwardHalf.dispose(),this.reversedHalf.dispose(),this.forwardHalf=null,this.reversedHalf=null,this.data=null,this.freeToPool()}getOtherVertex(e){return assert&&assert(e===this.startVertex||e===this.endVertex),this.startVertex===e?this.endVertex:this.startVertex}updateReferences(){this.forwardHalf.updateReferences(),this.reversedHalf.updateReferences(),assert&&assert(!(this.segment instanceof Ct)||this.startVertex!==this.endVertex,"No line segments for same vertices")}freeToPool(){Yo.pool.freeToPool(this)}};br(Yo,"pool",new qi(Yo));let ls=Yo;ui.register("Edge",ls);let c_=0;const Ko=class Ko{constructor(e){this.id=++c_,this.initialize(e)}initialize(e){return assert&&assert(e===null||e.isInner()),this.boundary=e,this.holes=vt(this.holes),this.windingMap=null,this.filled=null,e&&this.addBoundaryFaceReferences(e),this}serialize(){return{type:"Face",id:this.id,boundary:this.boundary===null?null:this.boundary.id,holes:this.holes.map(e=>e.id),windingMap:this.windingMap,filled:this.filled}}dispose(){this.boundary=null,vt(this.holes),this.windingMap=null,this.filled=null,this.freeToPool()}addBoundaryFaceReferences(e){for(let t=0;t<e.halfEdges.length;t++)assert&&assert(e.halfEdges[t].face===null),e.halfEdges[t].face=this}recursivelyAddHoles(e){assert&&assert(!e.isInner()),this.holes.push(e),this.addBoundaryFaceReferences(e);for(let t=0;t<e.childBoundaries.length;t++)this.recursivelyAddHoles(e.childBoundaries[t])}freeToPool(){Ko.pool.freeToPool(this)}};br(Ko,"pool",new qi(Ko));let Ha=Ko;ui.register("Face",Ha);let u_=0;const qo=class qo{constructor(e,t){this.id=++u_,this.initialize(e,t)}initialize(e,t){return assert&&assert(typeof e=="number"),assert&&assert(typeof t=="boolean"),this.shapeId=e,this.closed=t,this.halfEdges=vt(this.halfEdges),this}serialize(){return{type:"Loop",id:this.id,shapeId:this.shapeId,closed:this.closed,halfEdges:this.halfEdges.map(e=>e.id)}}toSubpath(){const e=[];for(let t=0;t<this.halfEdges.length;t++)e.push(this.halfEdges[t].getDirectionalSegment());return new ks(e,void 0,this.closed)}dispose(){vt(this.halfEdges),this.freeToPool()}freeToPool(){qo.pool.freeToPool(this)}};br(qo,"pool",new qi(qo));let ml=qo;ui.register("Loop",ml);let d_=0;const Xo=class Xo{constructor(e){this.id=++d_,this.initialize(e)}initialize(e){return this.halfEdges=e,this.signedArea=this.computeSignedArea(),this.bounds=this.computeBounds(),this.childBoundaries=vt(this.childBoundaries),this}serialize(){return{type:"Boundary",id:this.id,halfEdges:this.halfEdges.map(e=>e.id),signedArea:this.signedArea,bounds:$e.Bounds2IO.toStateObject(this.bounds),childBoundaries:this.childBoundaries.map(e=>e.id)}}dispose(){this.halfEdges=[],vt(this.childBoundaries),this.freeToPool()}isInner(){return this.signedArea>0}computeSignedArea(){let e=0;for(let t=0;t<this.halfEdges.length;t++)e+=this.halfEdges[t].signedAreaFragment;return e}computeBounds(){const e=$e.NOTHING.copy();for(let t=0;t<this.halfEdges.length;t++)e.includeBounds(this.halfEdges[t].edge.segment.getBounds());return e}computeExtremePoint(e){assert&&assert(this.halfEdges.length>0,"There is no extreme point if we have no edges");const t=[];for(let s=0;s<this.halfEdges.length;s++)t.push(this.halfEdges[s].edge.segment.transformed(e.getMatrix()));const i=$e.NOTHING.copy();for(let s=0;s<t.length;s++)i.includeBounds(t[s].getBounds());for(let s=0;s<t.length;s++){const n=t[s];if(n.getBounds().top===i.top){let o=new Pe(0,Number.POSITIVE_INFINITY);const c=[0,1].concat(n.getInteriorExtremaTs());for(let p=0;p<c.length;p++){const f=n.positionAt(c[p]);f.y<o.y&&(o=f)}return e.inversePosition2(o)}}throw new Error("Should not reach here if we have segments")}computeExtremeRay(e){const t=this.computeExtremePoint(e),i=e.inverseDelta2(new Pe(0,-1)).normalized();return new ir(t.plus(i.timesScalar(1e-4)),i)}hasHalfEdge(e){for(let t=0;t<this.halfEdges.length;t++)if(this.halfEdges[t]===e)return!0;return!1}toSubpath(){const e=[];for(let t=0;t<this.halfEdges.length;t++)e.push(this.halfEdges[t].getDirectionalSegment());return new ks(e,null,!0)}freeToPool(){Xo.pool.freeToPool(this)}};br(Xo,"pool",new qi(Xo));let yl=Xo;ui.register("Boundary",yl);const ys=class ys{constructor(e,t,i,s,n,o,c,p,f,w){this.initialize(e,t,i,s,n,o,c,p,f,w)}initialize(e,t,i,s,n,o,c,p,f,w){return this.a=e,this.b=t,this.atMin=i,this.atMax=s,this.btMin=n,this.btMax=o,this.aMin=c,this.aMax=p,this.bMin=f,this.bMax=w,this}pushSubdivisions(e){const t=this,i=(t.atMax+t.atMin)/2,s=(t.btMax+t.btMin)/2;if(i===this.atMin||i===this.atMax||s===this.btMin||s===this.btMax){e.push(this);return}const n=t.a.positionAt(i),o=t.b.positionAt(s);ys.boxIntersects(t.aMin,n,t.bMin,o)&&e.push(ys.pool.create(t.a,t.b,t.atMin,i,t.btMin,s,t.aMin,n,t.bMin,o)),ys.boxIntersects(n,t.aMax,t.bMin,o)&&e.push(ys.pool.create(t.a,t.b,i,t.atMax,t.btMin,s,n,t.aMax,t.bMin,o)),ys.boxIntersects(t.aMin,n,o,t.bMax)&&e.push(ys.pool.create(t.a,t.b,t.atMin,i,s,t.btMax,t.aMin,n,o,t.bMax)),ys.boxIntersects(n,t.aMax,o,t.bMax)&&e.push(ys.pool.create(t.a,t.b,i,t.atMax,s,t.btMax,n,t.aMax,o,t.bMax)),this.freeToPool()}distance(e){const t=this.atMin-e.atMin,i=this.atMax-e.atMax,s=this.btMin-e.btMin,n=this.btMax-e.btMax;return t*t+i*i+s*s+n*n}clean(){this.a=null,this.b=null,this.aMin=null,this.aMax=null,this.bMin=null,this.bMax=null}static intersect(e,t){if(!e.bounds.intersectsBounds(t.bounds))return[];const i=ys.getIntersectionRanges(e,t),s=[];for(let o=0;o<i.length;o++){const c=i[o];let p=!1;e:for(let f=0;f<s.length;f++){const w=s[f];for(let O=0;O<w.length;O++){const T=w[O];if(c.distance(T)<1e-13){w.push(c),p=!0;break e}}}p||s.push([c])}const n=[];for(let o=0;o<s.length;o++){const c=s[o];let p=0,f=0;for(let T=0;T<c.length;T++)p+=c[T].atMin+c[T].atMax,f+=c[T].btMin+c[T].btMax;p/=2*c.length,f/=2*c.length;const w=e.positionAt(p),O=t.positionAt(f);assert&&assert(w.distance(O)<1e-10),n.push(new vs(w.average(O),p,f))}for(let o=0;o<i.length;o++)i[o].freeToPool();return ys.cleanPool(),n}static getIntersectionRanges(e,t){const i=e.getInteriorExtremaTs(),s=t.getInteriorExtremaTs(),n=_.zip([0].concat(i),i.concat([1])),o=_.zip([0].concat(s),s.concat([1]));let c=[];for(let p=0;p<n.length;p++)for(let f=0;f<o.length;f++){const w=n[p][0],O=n[p][1],T=o[f][0],z=o[f][1],U=e.positionAt(w),m=e.positionAt(O),Y=t.positionAt(T),j=t.positionAt(z);ys.boxIntersects(U,m,Y,j)&&c.push(ys.pool.create(e,t,w,O,T,z,U,m,Y,j))}for(let p=0;p<50;p++){const f=[];for(let w=c.length-1;w>=0;w--)c[w].pushSubdivisions(f);c=f}return c}static boxIntersects(e,t,i,s){const n=Math.max(Math.min(e.x,t.x),Math.min(i.x,s.x)),o=Math.max(Math.min(e.y,t.y),Math.min(i.y,s.y)),c=Math.min(Math.max(e.x,t.x),Math.max(i.x,s.x)),p=Math.min(Math.max(e.y,t.y),Math.max(i.y,s.y));return c-n>=0&&p-o>=0}static cleanPool(){ys.pool.forEach(e=>e.clean())}freeToPool(){ys.pool.freeToPool(this)}};ys.pool=new qi(ys);let Za=ys;ui.register("BoundsIntersection",Za);let g_=1;const Fg=[];class Zu{constructor(e=1e-6){this.rootNode=ou.pool.create(this,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY),this.rootNode.isBlack=!0,this.epsilon=e,this.items=new Set}query(e,t){const i=g_++;return this.rootNode?this.rootNode.query(e,this.getMinX(e,this.epsilon),this.getMaxX(e,this.epsilon),i,t):!1}addItem(e){const t=this.getMinX(e,this.epsilon),i=this.getMaxX(e,this.epsilon);this.rootNode.split(t,this),this.rootNode.split(i,this),this.rootNode.addItem(e,t,i),this.items.add(e)}removeItem(e){this.rootNode.removeItem(e,this.getMinX(e,this.epsilon),this.getMaxX(e,this.epsilon)),this.items.delete(e)}audit(){this.rootNode.audit(this.epsilon,this.items,[])}toString(){let e=0,t="";return function i(s){t+=`${_.repeat("  ",e)}${s.toString()}
`,e++,s.hasChildren()&&(i(s.left),i(s.right)),e--}(this.rootNode),t}}const aa=class aa{constructor(e,t,i){this.items=[],this.initialize(e,t,i)}initialize(e,t,i){return this.min=t,this.max=i,this.splitValue=null,this.left=null,this.right=null,this.parent=null,this.tree=e,this.isBlack=!1,vt(this.items),this}contains(e){return e>=this.min&&e<=this.max}hasChildren(){return this.splitValue!==null}query(e,t,i,s,n){var c,p;let o=!1;if(this.min<=i&&this.max>=t){for(let f=0;f<this.items.length;f++){const w=this.items[f];if((!((c=w.internalData)!=null&&c.segmentId)||((p=w.internalData)==null?void 0:p.segmentId)<s)&&(w.internalData.segmentId=s,o=n(w),o))return!0}this.hasChildren()&&(o||(o=this.left.query(e,t,i,s,n)),o||(o=this.right.query(e,t,i,s,n)))}return o}swapChild(e,t){assert&&assert(this.left===e||this.right===e),this.left===e?this.left=t:this.right=t}hasChild(e){return this.left===e||this.right===e}otherChild(e){return assert&&assert(this.hasChild(e)),this.left===e?this.right:this.left}leftRotate(e){if(assert&&assert(this.hasChildren()&&this.right.hasChildren()),this.right.hasChildren()){const t=this.right,i=this.left,s=t.left,n=t.right;t.parent=this.parent,this.parent?this.parent.swapChild(this,t):e.rootNode=t,this.parent=t,s.parent=this,t.left=this,this.left=i,this.right=s,this.max=s.max,this.splitValue=i.max,t.min=this.min,t.splitValue=this.max;const o=vt(Fg);o.push(...this.items),vt(this.items);for(let c=i.items.length-1;c>=0;c--){const p=i.items[c],f=s.items.indexOf(p);f>=0&&(i.items.splice(c,1),s.items.splice(f,1),this.items.push(p))}s.items.push(...t.items),n.items.push(...t.items),vt(t.items),t.items.push(...o)}}rightRotate(e){assert&&assert(this.hasChildren()&&this.left.hasChildren());const t=this.left,i=this.right,s=t.left,n=t.right;t.parent=this.parent,this.parent?this.parent.swapChild(this,t):e.rootNode=t,this.parent=t,n.parent=this,t.right=this,this.left=n,this.right=i,this.min=n.min,this.splitValue=i.min,t.max=this.max,t.splitValue=this.min;const o=vt(Fg);o.push(...this.items),vt(this.items);for(let c=i.items.length-1;c>=0;c--){const p=i.items[c],f=n.items.indexOf(p);f>=0&&(i.items.splice(c,1),n.items.splice(f,1),this.items.push(p))}s.items.push(...t.items),n.items.push(...t.items),vt(t.items),t.items.push(...o)}fixRedBlack(e){if(assert&&assert(!this.isBlack),!this.parent)this.isBlack=!0;else{const t=this.parent;if(!t.isBlack){const i=t.parent,s=i.otherChild(t);s.isBlack?t===i.left?this===t.right?(t.leftRotate(e),t.parent.isBlack=!0,t.parent.parent.isBlack=!1,t.parent.parent.rightRotate(e)):(t.isBlack=!0,i.isBlack=!1,i.rightRotate(e)):this===t.left?(t.rightRotate(e),t.parent.isBlack=!0,t.parent.parent.isBlack=!1,t.parent.parent.leftRotate(e)):(t.isBlack=!0,i.isBlack=!1,i.leftRotate(e)):(t.isBlack=!0,s.isBlack=!0,i.isBlack=!1,i.fixRedBlack(e))}}}split(e,t){if(assert&&assert(this.contains(e)),!(e===this.min||e===this.max))if(this.hasChildren())this.splitValue!==e&&(e>this.splitValue?this.right:this.left).split(e,t);else{this.splitValue=e;const i=aa.pool.create(this.tree,this.min,e);i.parent=this,this.left=i;const s=aa.pool.create(this.tree,e,this.max);if(s.parent=this,this.right=s,!this.isBlack&&this.parent){const n=this.parent,o=n.otherChild(this);o.isBlack?(this===n.left?(n.rightRotate(t),i.isBlack=!0):(n.leftRotate(t),s.isBlack=!0),this.fixRedBlack(t)):(this.isBlack=!0,o.isBlack=!0,n.isBlack=!1,n.fixRedBlack(t))}}}addItem(e,t,i){this.min>i||this.max<t||(this.min>=t&&this.max<=i?this.items.push(e):this.hasChildren()&&(this.left.addItem(e,t,i),this.right.addItem(e,t,i)))}removeItem(e,t,i){this.min>i||this.max<t||(this.min>=t&&this.max<=i?(assert&&assert(this.items.includes(e)),is(this.items,e)):this.hasChildren()&&(this.left.removeItem(e,t,i),this.right.removeItem(e,t,i)))}audit(e,t,i=[]){if(assert){for(const s of i)assert(!this.items.includes(s));for(const s of this.items)assert(this.tree.getMinX(s,e)<=this.min),assert(this.tree.getMaxX(s,e)>=this.max);for(const s of i)this.tree.getMinX(s,e)<=this.min&&this.tree.getMaxX(s,e)>=this.max&&assert(t.has(s)||this.items.includes(s));if(assert(this.hasChildren()===(this.left!==null)),assert(this.hasChildren()===(this.right!==null)),assert(this.hasChildren()===(this.splitValue!==null)),assert(this.min<this.max),this.parent&&(assert(this.parent.hasChild(this)),assert(this.isBlack||this.parent.isBlack)),this.hasChildren()){assert(this.left.parent===this),assert(this.right.parent===this),assert(this.min===this.left.min),assert(this.max===this.right.max),assert(this.splitValue===this.left.max),assert(this.splitValue===this.right.min);for(const n of this.left.items)assert(!this.right.items.includes(n),"We shouldn't have two children with the same item");const s=[...i,...this.items];this.left.audit(e,t,s),this.right.audit(e,t,s)}}}toString(){return`[${this.min} ${this.max}] split:${this.splitValue} ${this.isBlack?"black":"red"} ${this.items}`}freeToPool(){aa.pool.freeToPool(this)}};aa.pool=new qi(aa);let ou=aa;ui.register("SegmentTree",Zu);class lu extends Zu{getMinX(e,t){return e.segment.bounds.left-t}getMaxX(e,t){return e.segment.bounds.right+t}}ui.register("EdgeSegmentTree",lu);class kf extends Zu{getMinX(e,t){return e.point.x-t}getMaxX(e,t){return e.point.x+t}}ui.register("VertexSegmentTree",kf);let p_=0,Pc=0;const ah=1e-5,Hg=.1*ah,Vg=.01*ah,Ul=1e-6;class As{constructor(){this.vertices=[],this.edges=[],this.innerBoundaries=[],this.outerBoundaries=[],this.boundaries=[],this.shapeIds=[],this.loops=[],this.unboundedFace=Ha.pool.create(null),this.faces=[this.unboundedFace]}serialize(){return{type:"Graph",vertices:this.vertices.map(e=>e.serialize()),edges:this.edges.map(e=>e.serialize()),boundaries:this.boundaries.map(e=>e.serialize()),innerBoundaries:this.innerBoundaries.map(e=>e.id),outerBoundaries:this.outerBoundaries.map(e=>e.id),shapeIds:this.shapeIds,loops:this.loops.map(e=>e.serialize()),unboundedFace:this.unboundedFace.id,faces:this.faces.map(e=>e.serialize())}}static deserialize(e){const t=new As,i={},s={},n={},o={},c={},p={};return t.vertices=e.vertices.map(f=>{const w=new Es(Pe.Vector2IO.fromStateObject(f.point));return i[f.id]=w,w.visited=f.visited,w.visitIndex=f.visitIndex,w.lowIndex=f.lowIndex,w}),t.edges=e.edges.map(f=>{const w=new ls(Gi.deserialize(f.segment),i[f.startVertex],i[f.endVertex]);s[f.id]=w,w.signedAreaFragment=f.signedAreaFragment;const O=(T,z)=>{n[z.id]=T,T.isReversed=z.isReversed,T.signedAreaFragment=z.signedAreaFragment,T.startVertex=i[z.startVertex.id],T.endVertex=i[z.endVertex.id],T.sortVector=Pe.Vector2IO.fromStateObject(z.sortVector),T.data=z.data};return O(w.forwardHalf,f.forwardHalf),O(w.reversedHalf,f.reversedHalf),w.visited=f.visited,w.data=f.data,w}),e.vertices.forEach((f,w)=>{const O=t.vertices[w];O.incidentHalfEdges=f.incidentHalfEdges.map(T=>n[T])}),t.boundaries=e.boundaries.map(f=>{const w=yl.pool.create(f.halfEdges.map(O=>n[O]));return o[f.id]=w,w.signedArea=f.signedArea,w.bounds=$e.Bounds2IO.fromStateObject(f.bounds),w}),e.boundaries.forEach((f,w)=>{const O=t.boundaries[w];O.childBoundaries=f.childBoundaries.map(T=>o[T])}),t.innerBoundaries=e.innerBoundaries.map(f=>o[f]),t.outerBoundaries=e.outerBoundaries.map(f=>o[f]),t.shapeIds=e.shapeIds,t.loops=e.loops.map(f=>{const w=new ml(f.shapeId,f.closed);return c[f.id]=w,w.halfEdges=f.halfEdges.map(O=>n[O]),w}),t.faces=e.faces.map((f,w)=>{const O=w===0?t.unboundedFace:new Ha(o[f.boundary]);return p[f.id]=O,O.holes=f.holes.map(T=>o[T]),O.windingMap=f.windingMap,O.filled=f.filled,O}),e.edges.forEach((f,w)=>{const O=t.edges[w];O.forwardHalf.face=f.forwardHalf.face===null?null:p[f.forwardHalf.face],O.reversedHalf.face=f.reversedHalf.face===null?null:p[f.reversedHalf.face]}),t}addShape(e,t,i){for(let s=0;s<t.subpaths.length;s++)this.addSubpath(e,t.subpaths[s],i)}addSubpath(e,t,i){if(assert&&assert(typeof e=="number"),assert&&assert(t instanceof ks),i=ds({ensureClosed:!0},i),this.shapeIds.indexOf(e)<0&&this.shapeIds.push(e),t.segments.length===0)return;const s=t.closed||i.ensureClosed,n=i.ensureClosed?t.getFillSegments():t.segments;let o;const c=[];for(o=0;o<n.length;o++){let f=o-1;f<0&&(f=n.length-1);let w=n[f].end;const O=n[o].start;!s&&o===0&&(w=O),O.equals(w)?c.push(Es.pool.create(O)):(assert&&assert(O.distance(w)<1e-5,"Inaccurate start/end points"),c.push(Es.pool.create(O.average(w))))}s||c.push(Es.pool.create(n[n.length-1].end));const p=ml.pool.create(e,s);for(o=0;o<n.length;o++){let f=o+1;s&&f===n.length&&(f=0);const w=ls.pool.create(n[o],c[o],c[f]);p.halfEdges.push(w.forwardHalf),this.addEdge(w)}this.loops.push(p),this.vertices.push(...c)}computeSimplifiedFaces(){this.eliminateOverlap(),this.eliminateSelfIntersection(),this.eliminateIntersection(),this.collapseVertices(),this.removeBridges(),this.removeLowOrderVertices(),this.orderVertexEdges(),this.extractFaces(),this.computeBoundaryTree(),this.computeWindingMap()}computeFaceInclusion(e){for(let t=0;t<this.faces.length;t++){const i=this.faces[t];i.filled=e(i.windingMap)}}createFilledSubGraph(){const e=new As,t={};for(let i=0;i<this.edges.length;i++){const s=this.edges[i];if(s.forwardHalf.face.filled!==s.reversedHalf.face.filled){if(!t[s.startVertex.id]){const c=Es.pool.create(s.startVertex.point);e.vertices.push(c),t[s.startVertex.id]=c}if(!t[s.endVertex.id]){const c=Es.pool.create(s.endVertex.point);e.vertices.push(c),t[s.endVertex.id]=c}const n=t[s.startVertex.id],o=t[s.endVertex.id];e.addEdge(ls.pool.create(s.segment,n,o))}}return e.collapseAdjacentEdges(),e.orderVertexEdges(),e.extractFaces(),e.computeBoundaryTree(),e.fillAlternatingFaces(),e}facesToShape(){const e=[];for(let t=0;t<this.faces.length;t++){const i=this.faces[t];if(i.filled){e.push(i.boundary.toSubpath());for(let s=0;s<i.holes.length;s++)e.push(i.holes[s].toSubpath())}}return new ui.Shape(e)}dispose(){for(;this.boundaries.length;)this.boundaries.pop().dispose();for(vt(this.innerBoundaries),vt(this.outerBoundaries);this.loops.length;)this.loops.pop().dispose();for(;this.faces.length;)this.faces.pop().dispose();for(;this.vertices.length;)this.vertices.pop().dispose();for(;this.edges.length;)this.edges.pop().dispose()}addEdge(e){assert&&assert(e instanceof ls),assert&&assert(!_.includes(e.startVertex.incidentHalfEdges,e.reversedHalf),"Should not already be connected"),assert&&assert(!_.includes(e.endVertex.incidentHalfEdges,e.forwardHalf),"Should not already be connected"),this.edges.push(e),e.startVertex.incidentHalfEdges.push(e.reversedHalf),e.endVertex.incidentHalfEdges.push(e.forwardHalf)}removeEdge(e){assert&&assert(e instanceof ls),is(this.edges,e),is(e.startVertex.incidentHalfEdges,e.reversedHalf),is(e.endVertex.incidentHalfEdges,e.forwardHalf)}replaceEdgeInLoops(e,t){const i=[];for(let s=0;s<t.length;s++)i.push(t[t.length-1-s].getReversed());for(let s=0;s<this.loops.length;s++){const n=this.loops[s];for(let o=n.halfEdges.length-1;o>=0;o--){const c=n.halfEdges[o];if(c.edge===e){const p=c===e.forwardHalf?t:i;Array.prototype.splice.apply(n.halfEdges,[o,1].concat(p))}}}}collapseAdjacentEdges(){let e=!0;for(;e;){e=!1;for(let t=0;t<this.vertices.length;t++){const i=this.vertices[t];if(i.incidentHalfEdges.length===2){const s=i.incidentHalfEdges[0].edge,n=i.incidentHalfEdges[1].edge;let o=s.segment,c=n.segment;const p=s.getOtherVertex(i),f=n.getOtherVertex(i);if(assert&&assert(this.loops.length===0),s.startVertex===i&&(o=o.reversed()),n.endVertex===i&&(c=c.reversed()),o instanceof Ct&&c instanceof Ct&&o.tangentAt(0).normalized().distance(c.tangentAt(0).normalized())<1e-6){this.removeEdge(s),this.removeEdge(n),s.dispose(),n.dispose(),is(this.vertices,i),i.dispose();const w=new Ct(p.point,f.point);this.addEdge(new ls(w,p,f)),e=!0;break}}}}}eliminateOverlap(){const t=new self.FlatQueue,i=new lu(1e-4),s=Pc++,n=p=>{const f=p.segment.bounds;t.push({start:!0,edge:p},f.minY-1e-4),t.push({start:!1,edge:p},f.maxY+1e-4)},o=p=>{p.internalData.removedId=s};for(let p=0;p<this.edges.length;p++)n(this.edges[p]);const c=[];for(;t.length;){const p=t.pop(),f=p.edge;if(f.internalData.removedId!==s)if(p.start){let w=!1,O,T;if(i.query(f,z=>{const U=f.segment.getOverlaps(z.segment);if(U!==null&&U.length)for(let m=0;m<U.length;m++){const Y=U[m];if(Math.abs(Y.t1-Y.t0)>1e-5&&Math.abs(Y.qt1-Y.qt0)>1e-5)return T=this.splitOverlap(f,z,Y),w=!0,O=z,!0}return!1}),w){i.removeItem(O),o(O),o(f);for(let z=0;z<T.length;z++)n(T[z]);c.push(f),c.push(O)}else i.addItem(f)}else i.removeItem(f)}for(let p=0;p<c.length;p++)c[p].dispose()}splitOverlap(e,t,i){const s=[],n=e.segment,o=t.segment;this.removeEdge(e),this.removeEdge(t);let c=i.t0,p=i.t1,f=i.qt0,w=i.qt1;c<1e-5&&(c=0),p>1-1e-5&&(p=1),f<1e-5&&(f=0),w>1-1e-5&&(w=1);const O=c>0?n.subdivided(c)[0]:null,T=f>0?o.subdivided(f)[0]:null,z=p<1?n.subdivided(p)[1]:null,U=w<1?o.subdivided(w)[1]:null;let m=n;c>0&&(m=m.subdivided(c)[1]),p<1&&(m=m.subdivided(ct.linear(c,1,0,1,p))[0]);let Y;O&&T?(Y=Es.pool.create(m.start),this.vertices.push(Y)):O?Y=i.a>0?t.startVertex:t.endVertex:Y=e.startVertex;let j;z&&U?(j=Es.pool.create(m.end),this.vertices.push(j)):z?j=i.a>0?t.endVertex:t.startVertex:j=e.endVertex;const le=ls.pool.create(m,Y,j);s.push(le);let xe,ce,ne,me;O&&(xe=ls.pool.create(O,e.startVertex,Y),s.push(xe)),z&&(ce=ls.pool.create(z,j,e.endVertex),s.push(ce)),T&&(ne=ls.pool.create(T,t.startVertex,i.a>0?Y:j),s.push(ne)),U&&(me=ls.pool.create(U,i.a>0?j:Y,t.endVertex),s.push(me));for(let ze=0;ze<s.length;ze++)this.addEdge(s[ze]);const Fe=(O?[xe]:[]).concat([le]).concat(z?[ce]:[]),we=(T?[ne]:[]).concat([le]).concat(U?[me]:[]),He=[],Me=[];for(let ze=0;ze<Fe.length;ze++)He.push(Fe[ze].forwardHalf);for(let ze=0;ze<we.length;ze++){const Je=we[ze]!==le||i.a>0;Me.push(Je?we[ze].forwardHalf:we[ze].reversedHalf)}return this.replaceEdgeInLoops(e,He),this.replaceEdgeInLoops(t,Me),s}eliminateSelfIntersection(){assert&&assert(this.boundaries.length===0,"Only handles simpler level primitive splitting right now");for(let e=this.edges.length-1;e>=0;e--){const t=this.edges[e],i=t.segment;if(i instanceof ts){const s=i.getSelfIntersection();if(s){assert&&assert(s.aT<s.bT);const n=i.subdivisions([s.aT,s.bT]),o=Es.pool.create(s.point);this.vertices.push(o);const c=ls.pool.create(n[0],t.startVertex,o),p=ls.pool.create(n[1],o,o),f=ls.pool.create(n[2],o,t.endVertex);this.removeEdge(t),this.addEdge(c),this.addEdge(p),this.addEdge(f),this.replaceEdgeInLoops(t,[c.forwardHalf,p.forwardHalf,f.forwardHalf]),t.dispose()}}}}eliminateIntersection(){const t=new self.FlatQueue,i=new lu(1e-4),s=Pc++,n=p=>{const f=p.segment.bounds;t.push({start:!0,edge:p},f.minY-1e-4),t.push({start:!1,edge:p},f.maxY+1e-4)},o=p=>{p.internalData.removedId=s};for(let p=0;p<this.edges.length;p++)n(this.edges[p]);const c=[];for(;t.length;){const p=t.pop(),f=p.edge;if(f.internalData.removedId!==s)if(p.start){let w=!1,O,T,z;if(i.query(f,U=>{const m=f.segment,Y=U.segment;let j=Gi.intersect(m,Y);if(j=j.filter(le=>{const xe=le.point;return As.isInternal(xe,le.aT,m,Hg,Ul)||As.isInternal(xe,le.bT,Y,Hg,Ul)}),j.length){const le=j[0],xe=this.simpleSplit(f,U,le.aT,le.bT,le.point);if(xe)return w=!0,O=U,T=xe.addedEdges,z=xe.removedEdges,!0}return!1}),w){z.includes(f)?(o(f),c.push(f)):i.addItem(f),z.includes(O)&&(i.removeItem(O),o(O),c.push(O));for(let U=0;U<T.length;U++)n(T[U])}else i.addItem(f)}else i.removeItem(f)}for(let p=0;p<c.length;p++)c[p].dispose()}simpleSplit(e,t,i,s,n){const o=As.isInternal(n,i,e.segment,Vg,Ul),c=As.isInternal(n,s,t.segment,Vg,Ul);let p=null;o?c?(p=Es.pool.create(n),this.vertices.push(p)):p=s<.5?t.startVertex:t.endVertex:p=i<.5?e.startVertex:e.endVertex;let f=!1;const w=[],O=[];return o&&p!==e.startVertex&&p!==e.endVertex&&(w.push(...this.splitEdge(e,i,p)),O.push(e),f=!0),c&&p!==t.startVertex&&p!==t.endVertex&&(w.push(...this.splitEdge(t,s,p)),O.push(t),f=!0),f?{addedEdges:w,removedEdges:O}:null}splitEdge(e,t,i){assert&&assert(this.boundaries.length===0,"Only handles simpler level primitive splitting right now"),assert&&assert(e.startVertex!==i),assert&&assert(e.endVertex!==i);const s=e.segment.subdivided(t);assert&&assert(s.length===2);const n=ls.pool.create(s[0],e.startVertex,i),o=ls.pool.create(s[1],i,e.endVertex);return this.removeEdge(e),this.addEdge(n),this.addEdge(o),this.replaceEdgeInLoops(e,[n.forwardHalf,o.forwardHalf]),[n,o]}collapseVertices(){assert&&assert(_.every(this.edges,p=>_.includes(this.vertices,p.startVertex))),assert&&assert(_.every(this.edges,p=>_.includes(this.vertices,p.endVertex)));const e=10*ah,t=new self.FlatQueue,i=new kf(e),s=Pc++,n=p=>{t.push({start:!0,vertex:p},p.point.y-e),t.push({start:!1,vertex:p},p.point.y+e)},o=p=>{p.internalData.removedId=s};for(let p=0;p<this.vertices.length;p++)n(this.vertices[p]);const c=[];for(;t.length;){const p=t.pop(),f=p.vertex;if(f.internalData.removedId!==s)if(p.start){let w=!1,O,T;if(i.query(f,z=>{const U=f.point.distance(z.point);if(U<ah){const m=Es.pool.create(U===0?f.point:f.point.average(z.point));this.vertices.push(m),is(this.vertices,f),is(this.vertices,z);for(let Y=this.edges.length-1;Y>=0;Y--){const j=this.edges[Y],le=j.startVertex===f||j.startVertex===z,xe=j.endVertex===f||j.endVertex===z;if(le&&xe){if((j.segment.bounds.width>1e-5||j.segment.bounds.height>1e-5)&&(j.segment instanceof ts||j.segment instanceof Zt||j.segment instanceof Qi)){const ce=ls.pool.create(j.segment,m,m);this.addEdge(ce),this.replaceEdgeInLoops(j,[ce.forwardHalf])}else this.replaceEdgeInLoops(j,[]);this.removeEdge(j),j.dispose()}else le?(j.startVertex=m,m.incidentHalfEdges.push(j.reversedHalf),j.updateReferences()):xe&&(j.endVertex=m,m.incidentHalfEdges.push(j.forwardHalf),j.updateReferences())}return T=[m],w=!0,O=z,!0}return!1}),w){i.removeItem(O),o(O),o(f);for(let z=0;z<T.length;z++)n(T[z]);c.push(f),c.push(O)}else i.addItem(f)}else i.removeItem(f)}for(let p=0;p<c.length;p++)c[p].dispose();assert&&assert(_.every(this.edges,p=>_.includes(this.vertices,p.startVertex))),assert&&assert(_.every(this.edges,p=>_.includes(this.vertices,p.endVertex)))}markBridges(e,t){t.visited=!0,t.visitIndex=t.lowIndex=p_++;for(let i=0;i<t.incidentHalfEdges.length;i++){const s=t.incidentHalfEdges[i].edge,n=t.incidentHalfEdges[i].startVertex;n.visited?s.visited||(t.lowIndex=Math.min(t.lowIndex,n.visitIndex)):(s.visited=!0,n.parent=t,this.markBridges(e,n),t.lowIndex=Math.min(t.lowIndex,n.lowIndex),n.lowIndex>t.visitIndex&&e.push(s))}}removeBridges(){const e=[];for(let t=0;t<this.vertices.length;t++){const i=this.vertices[t];i.visited||this.markBridges(e,i)}for(let t=0;t<e.length;t++){const i=e[t];this.removeEdge(i),this.replaceEdgeInLoops(i,[]),i.dispose()}}removeLowOrderVertices(){assert&&assert(_.every(this.edges,t=>_.includes(this.vertices,t.startVertex))),assert&&assert(_.every(this.edges,t=>_.includes(this.vertices,t.endVertex)));let e=!0;for(;e;){e=!1;for(let t=this.vertices.length-1;t>=0;t--){const i=this.vertices[t];if(i.incidentHalfEdges.length<2){for(let s=0;s<i.incidentHalfEdges.length;s++){const n=i.incidentHalfEdges[s].edge;this.removeEdge(n),this.replaceEdgeInLoops(n,[]),n.dispose()}this.vertices.splice(t,1),i.dispose(),e=!0;break}}}assert&&assert(_.every(this.edges,t=>_.includes(this.vertices,t.startVertex))),assert&&assert(_.every(this.edges,t=>_.includes(this.vertices,t.endVertex)))}orderVertexEdges(){for(let e=0;e<this.vertices.length;e++)this.vertices[e].sortEdges()}extractFaces(){const e=[];for(let t=0;t<this.edges.length;t++)e.push(this.edges[t].forwardHalf),e.push(this.edges[t].reversedHalf);for(;e.length;){const t=[];let i=e[0];const s=i;for(;i&&(is(e,i),t.push(i),i=i.getNext(),i!==s););const n=yl.pool.create(t);(n.signedArea>0?this.innerBoundaries:this.outerBoundaries).push(n),this.boundaries.push(n)}for(let t=0;t<this.innerBoundaries.length;t++)this.faces.push(Ha.pool.create(this.innerBoundaries[t]))}computeBoundaryTree(){const e=[],t=new Ks(Ze.rotation2(1.5729657));for(let i=0;i<this.outerBoundaries.length;i++){const s=this.outerBoundaries[i],n=s.computeExtremeRay(t);let o=null,c=Number.POSITIVE_INFINITY,p=!1;for(let f=0;f<this.edges.length;f++){const w=this.edges[f],O=w.segment.intersection(n);for(let T=0;T<O.length;T++){const z=O[T];z.distance<c&&(o=w,c=z.distance,p=z.wind)}}if(o===null)e.push(s);else{const w=p<0?o.reversedHalf:o.forwardHalf;this.getBoundaryOfHalfEdge(w).childBoundaries.push(s)}}e.forEach(this.unboundedFace.recursivelyAddHoles.bind(this.unboundedFace));for(let i=0;i<this.faces.length;i++){const s=this.faces[i];s.boundary!==null&&s.boundary.childBoundaries.forEach(s.recursivelyAddHoles.bind(s))}}computeWindingMap(){const e=this.edges.slice(),t={};for(let i=0;i<this.shapeIds.length;i++)t[this.shapeIds[i]]=0;for(this.unboundedFace.windingMap=t;e.length;)for(let i=e.length-1;i>=0;i--){const s=e[i],n=s.forwardHalf,o=s.reversedHalf,c=n.face,p=o.face;assert&&assert(c!==p);const f=c.windingMap!==null,w=p.windingMap!==null;if(f&&w){if(e.splice(i,1),assert)for(let O=0;O<this.shapeIds.length;O++){const T=this.shapeIds[O];assert(c.windingMap[T]-p.windingMap[T]===this.computeDifferential(s,T))}}else{if(!f&&!w)continue;{const O=f?c:p,T=f?p:c,z={};for(let U=0;U<this.shapeIds.length;U++){const m=this.shapeIds[U],Y=this.computeDifferential(s,m);z[m]=O.windingMap[m]+Y*(f?-1:1)}T.windingMap=z}}}}computeDifferential(e,t){let i=0;for(let s=0;s<this.loops.length;s++){const n=this.loops[s];if(assert&&assert(n.closed,"This is only defined to work for closed loops"),n.shapeId===t)for(let o=0;o<n.halfEdges.length;o++){const c=n.halfEdges[o];c===e.forwardHalf?i++:c===e.reversedHalf&&i--}}return i}fillAlternatingFaces(){let e=0;for(let t=0;t<this.faces.length;t++)this.faces[t].filled=null,e++;for(this.unboundedFace.filled=!1,e--;e;)for(let t=0;t<this.edges.length;t++){const i=this.edges[t],s=i.forwardHalf.face,n=i.reversedHalf.face,o=s.filled===null,c=n.filled===null;o&&!c?(s.filled=!n.filled,e--):!o&&c&&(n.filled=!s.filled,e--)}}getBoundaryOfHalfEdge(e){for(let t=0;t<this.boundaries.length;t++){const i=this.boundaries[t];if(i.hasHalfEdge(e))return i}throw new Error("Could not find boundary")}static isInternal(e,t,i,s,n){return t>n&&t<1-n&&e.distance(i.start)>s&&e.distance(i.end)>s}static BINARY_NONZERO_UNION(e){return e[0]!==0||e[1]!==0}static BINARY_NONZERO_INTERSECTION(e){return e[0]!==0&&e[1]!==0}static BINARY_NONZERO_DIFFERENCE(e){return e[0]!==0&&e[1]===0}static BINARY_NONZERO_XOR(e){return(e[0]!==0^e[1]!==0)===1}static binaryResult(e,t,i){const s=new As;s.addShape(0,e),s.addShape(1,t),s.computeSimplifiedFaces(),s.computeFaceInclusion(i);const n=s.createFilledSubGraph(),o=n.facesToShape();return s.dispose(),n.dispose(),o}static unionNonZero(e){const t=new As;for(let n=0;n<e.length;n++)t.addShape(n,e[n]);t.computeSimplifiedFaces(),t.computeFaceInclusion(n=>{for(let o=0;o<e.length;o++)if(n[o]!==0)return!0;return!1});const i=t.createFilledSubGraph(),s=i.facesToShape();return t.dispose(),i.dispose(),s}static intersectionNonZero(e){const t=new As;for(let n=0;n<e.length;n++)t.addShape(n,e[n]);t.computeSimplifiedFaces(),t.computeFaceInclusion(n=>{for(let o=0;o<e.length;o++)if(n[o]===0)return!1;return!0});const i=t.createFilledSubGraph(),s=i.facesToShape();return t.dispose(),i.dispose(),s}static xorNonZero(e){const t=new As;for(let n=0;n<e.length;n++)t.addShape(n,e[n]);t.computeSimplifiedFaces(),t.computeFaceInclusion(n=>{let o=!1;for(let c=0;c<e.length;c++)n[c]!==0&&(o=!o);return o});const i=t.createFilledSubGraph(),s=i.facesToShape();return t.dispose(),i.dispose(),s}static simplifyNonZero(e){const t=new As;t.addShape(0,e),t.computeSimplifiedFaces(),t.computeFaceInclusion(n=>n[0]!==0);const i=t.createFilledSubGraph(),s=i.facesToShape();return t.dispose(),i.dispose(),s}static clipShape(e,t,i){let s,n,o;i=ds({includeExterior:!1,includeBoundary:!0,includeInterior:!0},i);const f=As.simplifyNonZero(e),w=new As;for(w.addShape(0,t,{ensureClosed:!1}),w.addShape(1,f),w.eliminateOverlap(),w.eliminateSelfIntersection(),w.eliminateIntersection(),w.collapseVertices(),s=0;s<w.loops.length;s++)if(o=w.loops[s],o.shapeId===1)for(n=0;n<o.halfEdges.length;n++)o.halfEdges[n].edge.data=!0;const O=[];for(s=0;s<w.loops.length;s++)if(o=w.loops[s],o.shapeId===0){let T=[];for(n=0;n<o.halfEdges.length;n++){const z=o.halfEdges[n];(z.edge.data?i.includeBoundary:f.containsPoint(z.edge.segment.positionAt(.5))?i.includeInterior:i.includeExterior)?T.push(z.getDirectionalSegment()):T.length&&(O.push(new ks(T,void 0,o.closed)),T=[])}T.length&&O.push(new ks(T,void 0,o.closed))}return w.dispose(),new ui.Shape(O)}}ui.register("Graph",As);const en=As;/*!
 * jQuery JavaScript Library v2.1.0
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright 2005, 2014 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2014-01-23T21:10Z
 */(function(h){(function(e,t){self.$=e.document?t(e,!0):function(i){if(!i.document)throw new Error("jQuery requires a self with a document");return t(i)}})(typeof self<"u"?self:yb,function(e,t){var i=[],s=i.slice,n=i.concat,o=i.push,c=i.indexOf,p={},f=p.toString,w=p.hasOwnProperty,O="".trim,T={},z=e.document,U="2.1.0",m=function(d,v){return new m.fn.init(d,v)},Y=/^-ms-/,j=/-([\da-z])/gi,le=function(d,v){return v.toUpperCase()};m.fn=m.prototype={jquery:U,constructor:m,selector:"",length:0,toArray:function(){return s.call(this)},get:function(d){return d!=null?d<0?this[d+this.length]:this[d]:s.call(this)},pushStack:function(d){var v=m.merge(this.constructor(),d);return v.prevObject=this,v.context=this.context,v},each:function(d,v){return m.each(this,d,v)},map:function(d){return this.pushStack(m.map(this,function(v,S){return d.call(v,S,v)}))},slice:function(){return this.pushStack(s.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(d){var v=this.length,S=+d+(d<0?v:0);return this.pushStack(S>=0&&S<v?[this[S]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:o,sort:i.sort,splice:i.splice},m.extend=m.fn.extend=function(){var d,v,S,I,R,H,X=arguments[0]||{},oe=1,Le=arguments.length,ke=!1;for(typeof X=="boolean"&&(ke=X,X=arguments[oe]||{},oe++),typeof X!="object"&&!m.isFunction(X)&&(X={}),oe===Le&&(X=this,oe--);oe<Le;oe++)if((d=arguments[oe])!=null)for(v in d)S=X[v],I=d[v],X!==I&&(ke&&I&&(m.isPlainObject(I)||(R=m.isArray(I)))?(R?(R=!1,H=S&&m.isArray(S)?S:[]):H=S&&m.isPlainObject(S)?S:{},X[v]=m.extend(ke,H,I)):I!==void 0&&(X[v]=I));return X},m.extend({expando:"jQuery"+(U+Math.random()).replace(/\D/g,""),isReady:!0,error:function(d){throw new Error(d)},noop:function(){},isFunction:function(d){return m.type(d)==="function"},isArray:Array.isArray,isWindow:function(d){return d!=null&&d===d.window},isNumeric:function(d){return d-parseFloat(d)>=0},isPlainObject:function(d){if(m.type(d)!=="object"||d.nodeType||m.isWindow(d))return!1;try{if(d.constructor&&!w.call(d.constructor.prototype,"isPrototypeOf"))return!1}catch{return!1}return!0},isEmptyObject:function(d){var v;for(v in d)return!1;return!0},type:function(d){return d==null?d+"":typeof d=="object"||typeof d=="function"?p[f.call(d)]||"object":typeof d},globalEval:function(d){var v,S=eval;d=m.trim(d),d&&(d.indexOf("use strict")===1?(v=z.createElement("script"),v.text=d,z.head.appendChild(v).parentNode.removeChild(v)):S(d))},camelCase:function(d){return d.replace(Y,"ms-").replace(j,le)},nodeName:function(d,v){return d.nodeName&&d.nodeName.toLowerCase()===v.toLowerCase()},each:function(d,v,S){var I,R=0,H=d.length,X=xe(d);if(S){if(X)for(;R<H&&(I=v.apply(d[R],S),I!==!1);R++);else for(R in d)if(I=v.apply(d[R],S),I===!1)break}else if(X)for(;R<H&&(I=v.call(d[R],R,d[R]),I!==!1);R++);else for(R in d)if(I=v.call(d[R],R,d[R]),I===!1)break;return d},trim:function(d){return d==null?"":O.call(d)},makeArray:function(d,v){var S=v||[];return d!=null&&(xe(Object(d))?m.merge(S,typeof d=="string"?[d]:d):o.call(S,d)),S},inArray:function(d,v,S){return v==null?-1:c.call(v,d,S)},merge:function(d,v){for(var S=+v.length,I=0,R=d.length;I<S;I++)d[R++]=v[I];return d.length=R,d},grep:function(d,v,S){for(var I,R=[],H=0,X=d.length,oe=!S;H<X;H++)I=!v(d[H],H),I!==oe&&R.push(d[H]);return R},map:function(d,v,S){var I,R=0,H=d.length,X=xe(d),oe=[];if(X)for(;R<H;R++)I=v(d[R],R,S),I!=null&&oe.push(I);else for(R in d)I=v(d[R],R,S),I!=null&&oe.push(I);return n.apply([],oe)},guid:1,proxy:function(d,v){var S,I,R;if(typeof v=="string"&&(S=d[v],v=d,d=S),!!m.isFunction(d))return I=s.call(arguments,2),R=function(){return d.apply(v||this,I.concat(s.call(arguments)))},R.guid=d.guid=d.guid||m.guid++,R},now:Date.now,support:T}),m.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(d,v){p["[object "+v+"]"]=v.toLowerCase()});function xe(d){var v=d.length,S=m.type(d);return S==="function"||m.isWindow(d)?!1:d.nodeType===1&&v?!0:S==="array"||v===0||typeof v=="number"&&v>0&&v-1 in d}var ce=function(d){var v,S,I,R,H,X,oe,Le,ke,De,Ye,Ke,at,At,ti,Mi,Mn,pi="sizzle"+-new Date,$s=d.document,Et=0,La=0,fi=oc(),ji=oc(),gr=oc(),go=function(Q,pe){return Q===pe&&(ke=!0),0},Gs="undefined",Pa=1<<31,jr={}.hasOwnProperty,Bs=[],pr=Bs.pop,ln=Bs.push,fr=Bs.push,Lg=Bs.slice,Qr=Bs.indexOf||function(Q){for(var pe=0,_e=this.length;pe<_e;pe++)if(this[pe]===Q)return pe;return-1},nc="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",xi="[\\x20\\t\\r\\n\\f]",Sa="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",Pg=Sa.replace("w","w#"),Sg="\\["+xi+"*("+Sa+")"+xi+"*(?:([*^$|!~]?=)"+xi+`*(?:(['"])((?:\\\\.|[^\\\\])*?)\\3|(`+Pg+")|)|)"+xi+"*\\]",rc=":("+Sa+`)(?:\\(((['"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|`+Sg.replace(3,8)+")*)|.*)\\)|)",Fl=new RegExp("^"+xi+"+|((?:^|[^\\\\])(?:\\\\.)*)"+xi+"+$","g"),Jy=new RegExp("^"+xi+"*,"+xi+"*"),eb=new RegExp("^"+xi+"*([>+~]|"+xi+")"+xi+"*"),tb=new RegExp("="+xi+`*([^\\]'"]*?)`+xi+"*\\]","g"),ib=new RegExp(rc),sb=new RegExp("^"+Pg+"$"),Hl={ID:new RegExp("^#("+Sa+")"),CLASS:new RegExp("^\\.("+Sa+")"),TAG:new RegExp("^("+Sa.replace("w","w*")+")"),ATTR:new RegExp("^"+Sg),PSEUDO:new RegExp("^"+rc),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+xi+"*(even|odd|(([+-]|)(\\d*)n|)"+xi+"*(?:([+-]|)"+xi+"*(\\d+)|))"+xi+"*\\)|)","i"),bool:new RegExp("^(?:"+nc+")$","i"),needsContext:new RegExp("^"+xi+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+xi+"*((?:-\\d)?\\d*)"+xi+"*\\)|)(?=[^-]|$)","i")},nb=/^(?:input|select|textarea|button)$/i,rb=/^h\d$/i,po=/^[^{]+\{\s*\[native \w/,ab=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ac=/[+~]/,ob=/'|\\/g,mr=new RegExp("\\\\([\\da-f]{1,6}"+xi+"?|("+xi+")|.)","ig"),yr=function(Q,pe,_e){var Oe="0x"+pe-65536;return Oe!==Oe||_e?pe:Oe<0?String.fromCharCode(Oe+65536):String.fromCharCode(Oe>>10|55296,Oe&1023|56320)};try{fr.apply(Bs=Lg.call($s.childNodes),$s.childNodes),Bs[$s.childNodes.length].nodeType}catch{fr={apply:Bs.length?function(pe,_e){ln.apply(pe,Lg.call(_e))}:function(pe,_e){for(var Oe=pe.length,Te=0;pe[Oe++]=_e[Te++];);pe.length=Oe-1}}}function Vi(Q,pe,_e,Oe){var Te,Ge,Ue,nt,mt,Rt,Mt,Pt,ki,Qt;if((pe?pe.ownerDocument||pe:$s)!==Ye&&De(pe),pe=pe||Ye,_e=_e||[],!Q||typeof Q!="string")return _e;if((nt=pe.nodeType)!==1&&nt!==9)return[];if(at&&!Oe){if(Te=ab.exec(Q))if(Ue=Te[1]){if(nt===9)if(Ge=pe.getElementById(Ue),Ge&&Ge.parentNode){if(Ge.id===Ue)return _e.push(Ge),_e}else return _e;else if(pe.ownerDocument&&(Ge=pe.ownerDocument.getElementById(Ue))&&Mn(pe,Ge)&&Ge.id===Ue)return _e.push(Ge),_e}else{if(Te[2])return fr.apply(_e,pe.getElementsByTagName(Q)),_e;if((Ue=Te[3])&&S.getElementsByClassName&&pe.getElementsByClassName)return fr.apply(_e,pe.getElementsByClassName(Ue)),_e}if(S.qsa&&(!At||!At.test(Q))){if(Pt=Mt=pi,ki=pe,Qt=nt===9&&Q,nt===1&&pe.nodeName.toLowerCase()!=="object"){for(Rt=Vl(Q),(Mt=pe.getAttribute("id"))?Pt=Mt.replace(ob,"\\$&"):pe.setAttribute("id",Pt),Pt="[id='"+Pt+"'] ",mt=Rt.length;mt--;)Rt[mt]=Pt+zl(Rt[mt]);ki=ac.test(Q)&&hc(pe.parentNode)||pe,Qt=Rt.join(",")}if(Qt)try{return fr.apply(_e,ki.querySelectorAll(Qt)),_e}catch{}finally{Mt||pe.removeAttribute("id")}}}return db(Q.replace(Fl,"$1"),pe,_e,Oe)}function oc(){var Q=[];function pe(_e,Oe){return Q.push(_e+" ")>I.cacheLength&&delete pe[Q.shift()],pe[_e+" "]=Oe}return pe}function Ln(Q){return Q[pi]=!0,Q}function Pn(Q){var pe=Ye.createElement("div");try{return!!Q(pe)}catch{return!1}finally{pe.parentNode&&pe.parentNode.removeChild(pe),pe=null}}function lc(Q,pe){for(var _e=Q.split("|"),Oe=Q.length;Oe--;)I.attrHandle[_e[Oe]]=pe}function wg(Q,pe){var _e=pe&&Q,Oe=_e&&Q.nodeType===1&&pe.nodeType===1&&(~pe.sourceIndex||Pa)-(~Q.sourceIndex||Pa);if(Oe)return Oe;if(_e){for(;_e=_e.nextSibling;)if(_e===pe)return-1}return Q?1:-1}function lb(Q){return function(pe){var _e=pe.nodeName.toLowerCase();return _e==="input"&&pe.type===Q}}function hb(Q){return function(pe){var _e=pe.nodeName.toLowerCase();return(_e==="input"||_e==="button")&&pe.type===Q}}function Zr(Q){return Ln(function(pe){return pe=+pe,Ln(function(_e,Oe){for(var Te,Ge=Q([],_e.length,pe),Ue=Ge.length;Ue--;)_e[Te=Ge[Ue]]&&(_e[Te]=!(Oe[Te]=_e[Te]))})})}function hc(Q){return Q&&typeof Q.getElementsByTagName!==Gs&&Q}S=Vi.support={},H=Vi.isXML=function(Q){var pe=Q&&(Q.ownerDocument||Q).documentElement;return pe?pe.nodeName!=="HTML":!1},De=Vi.setDocument=function(Q){var pe,_e=Q?Q.ownerDocument||Q:$s,Oe=_e.defaultView;return _e===Ye||_e.nodeType!==9||!_e.documentElement?Ye:(Ye=_e,Ke=_e.documentElement,at=!H(_e),Oe&&Oe!==Oe.top&&(Oe.addEventListener?Oe.addEventListener("unload",function(){De()},!1):Oe.attachEvent&&Oe.attachEvent("onunload",function(){De()})),S.attributes=Pn(function(Te){return Te.className="i",!Te.getAttribute("className")}),S.getElementsByTagName=Pn(function(Te){return Te.appendChild(_e.createComment("")),!Te.getElementsByTagName("*").length}),S.getElementsByClassName=po.test(_e.getElementsByClassName)&&Pn(function(Te){return Te.innerHTML="<div class='a'></div><div class='a i'></div>",Te.firstChild.className="i",Te.getElementsByClassName("i").length===2}),S.getById=Pn(function(Te){return Ke.appendChild(Te).id=pi,!_e.getElementsByName||!_e.getElementsByName(pi).length}),S.getById?(I.find.ID=function(Te,Ge){if(typeof Ge.getElementById!==Gs&&at){var Ue=Ge.getElementById(Te);return Ue&&Ue.parentNode?[Ue]:[]}},I.filter.ID=function(Te){var Ge=Te.replace(mr,yr);return function(Ue){return Ue.getAttribute("id")===Ge}}):(delete I.find.ID,I.filter.ID=function(Te){var Ge=Te.replace(mr,yr);return function(Ue){var nt=typeof Ue.getAttributeNode!==Gs&&Ue.getAttributeNode("id");return nt&&nt.value===Ge}}),I.find.TAG=S.getElementsByTagName?function(Te,Ge){if(typeof Ge.getElementsByTagName!==Gs)return Ge.getElementsByTagName(Te)}:function(Te,Ge){var Ue,nt=[],mt=0,Rt=Ge.getElementsByTagName(Te);if(Te==="*"){for(;Ue=Rt[mt++];)Ue.nodeType===1&&nt.push(Ue);return nt}return Rt},I.find.CLASS=S.getElementsByClassName&&function(Te,Ge){if(typeof Ge.getElementsByClassName!==Gs&&at)return Ge.getElementsByClassName(Te)},ti=[],At=[],(S.qsa=po.test(_e.querySelectorAll))&&(Pn(function(Te){Te.innerHTML="<select t=''><option selected=''></option></select>",Te.querySelectorAll("[t^='']").length&&At.push("[*^$]="+xi+`*(?:''|"")`),Te.querySelectorAll("[selected]").length||At.push("\\["+xi+"*(?:value|"+nc+")"),Te.querySelectorAll(":checked").length||At.push(":checked")}),Pn(function(Te){var Ge=_e.createElement("input");Ge.setAttribute("type","hidden"),Te.appendChild(Ge).setAttribute("name","D"),Te.querySelectorAll("[name=d]").length&&At.push("name"+xi+"*[*^$|!~]?="),Te.querySelectorAll(":enabled").length||At.push(":enabled",":disabled"),Te.querySelectorAll("*,:x"),At.push(",.*:")})),(S.matchesSelector=po.test(Mi=Ke.webkitMatchesSelector||Ke.mozMatchesSelector||Ke.oMatchesSelector||Ke.msMatchesSelector))&&Pn(function(Te){S.disconnectedMatch=Mi.call(Te,"div"),Mi.call(Te,"[s!='']:x"),ti.push("!=",rc)}),At=At.length&&new RegExp(At.join("|")),ti=ti.length&&new RegExp(ti.join("|")),pe=po.test(Ke.compareDocumentPosition),Mn=pe||po.test(Ke.contains)?function(Te,Ge){var Ue=Te.nodeType===9?Te.documentElement:Te,nt=Ge&&Ge.parentNode;return Te===nt||!!(nt&&nt.nodeType===1&&(Ue.contains?Ue.contains(nt):Te.compareDocumentPosition&&Te.compareDocumentPosition(nt)&16))}:function(Te,Ge){if(Ge){for(;Ge=Ge.parentNode;)if(Ge===Te)return!0}return!1},go=pe?function(Te,Ge){if(Te===Ge)return ke=!0,0;var Ue=!Te.compareDocumentPosition-!Ge.compareDocumentPosition;return Ue||(Ue=(Te.ownerDocument||Te)===(Ge.ownerDocument||Ge)?Te.compareDocumentPosition(Ge):1,Ue&1||!S.sortDetached&&Ge.compareDocumentPosition(Te)===Ue?Te===_e||Te.ownerDocument===$s&&Mn($s,Te)?-1:Ge===_e||Ge.ownerDocument===$s&&Mn($s,Ge)?1:Le?Qr.call(Le,Te)-Qr.call(Le,Ge):0:Ue&4?-1:1)}:function(Te,Ge){if(Te===Ge)return ke=!0,0;var Ue,nt=0,mt=Te.parentNode,Rt=Ge.parentNode,Mt=[Te],Pt=[Ge];if(!mt||!Rt)return Te===_e?-1:Ge===_e?1:mt?-1:Rt?1:Le?Qr.call(Le,Te)-Qr.call(Le,Ge):0;if(mt===Rt)return wg(Te,Ge);for(Ue=Te;Ue=Ue.parentNode;)Mt.unshift(Ue);for(Ue=Ge;Ue=Ue.parentNode;)Pt.unshift(Ue);for(;Mt[nt]===Pt[nt];)nt++;return nt?wg(Mt[nt],Pt[nt]):Mt[nt]===$s?-1:Pt[nt]===$s?1:0},_e)},Vi.matches=function(Q,pe){return Vi(Q,null,null,pe)},Vi.matchesSelector=function(Q,pe){if((Q.ownerDocument||Q)!==Ye&&De(Q),pe=pe.replace(tb,"='$1']"),S.matchesSelector&&at&&(!ti||!ti.test(pe))&&(!At||!At.test(pe)))try{var _e=Mi.call(Q,pe);if(_e||S.disconnectedMatch||Q.document&&Q.document.nodeType!==11)return _e}catch{}return Vi(pe,Ye,null,[Q]).length>0},Vi.contains=function(Q,pe){return(Q.ownerDocument||Q)!==Ye&&De(Q),Mn(Q,pe)},Vi.attr=function(Q,pe){(Q.ownerDocument||Q)!==Ye&&De(Q);var _e=I.attrHandle[pe.toLowerCase()],Oe=_e&&jr.call(I.attrHandle,pe.toLowerCase())?_e(Q,pe,!at):void 0;return Oe!==void 0?Oe:S.attributes||!at?Q.getAttribute(pe):(Oe=Q.getAttributeNode(pe))&&Oe.specified?Oe.value:null},Vi.error=function(Q){throw new Error("Syntax error, unrecognized expression: "+Q)},Vi.uniqueSort=function(Q){var pe,_e=[],Oe=0,Te=0;if(ke=!S.detectDuplicates,Le=!S.sortStable&&Q.slice(0),Q.sort(go),ke){for(;pe=Q[Te++];)pe===Q[Te]&&(Oe=_e.push(Te));for(;Oe--;)Q.splice(_e[Oe],1)}return Le=null,Q},R=Vi.getText=function(Q){var pe,_e="",Oe=0,Te=Q.nodeType;if(Te){if(Te===1||Te===9||Te===11){if(typeof Q.textContent=="string")return Q.textContent;for(Q=Q.firstChild;Q;Q=Q.nextSibling)_e+=R(Q)}else if(Te===3||Te===4)return Q.nodeValue}else for(;pe=Q[Oe++];)_e+=R(pe);return _e},I=Vi.selectors={cacheLength:50,createPseudo:Ln,match:Hl,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(Q){return Q[1]=Q[1].replace(mr,yr),Q[3]=(Q[4]||Q[5]||"").replace(mr,yr),Q[2]==="~="&&(Q[3]=" "+Q[3]+" "),Q.slice(0,4)},CHILD:function(Q){return Q[1]=Q[1].toLowerCase(),Q[1].slice(0,3)==="nth"?(Q[3]||Vi.error(Q[0]),Q[4]=+(Q[4]?Q[5]+(Q[6]||1):2*(Q[3]==="even"||Q[3]==="odd")),Q[5]=+(Q[7]+Q[8]||Q[3]==="odd")):Q[3]&&Vi.error(Q[0]),Q},PSEUDO:function(Q){var pe,_e=!Q[5]&&Q[2];return Hl.CHILD.test(Q[0])?null:(Q[3]&&Q[4]!==void 0?Q[2]=Q[4]:_e&&ib.test(_e)&&(pe=Vl(_e,!0))&&(pe=_e.indexOf(")",_e.length-pe)-_e.length)&&(Q[0]=Q[0].slice(0,pe),Q[2]=_e.slice(0,pe)),Q.slice(0,3))}},filter:{TAG:function(Q){var pe=Q.replace(mr,yr).toLowerCase();return Q==="*"?function(){return!0}:function(_e){return _e.nodeName&&_e.nodeName.toLowerCase()===pe}},CLASS:function(Q){var pe=fi[Q+" "];return pe||(pe=new RegExp("(^|"+xi+")"+Q+"("+xi+"|$)"))&&fi(Q,function(_e){return pe.test(typeof _e.className=="string"&&_e.className||typeof _e.getAttribute!==Gs&&_e.getAttribute("class")||"")})},ATTR:function(Q,pe,_e){return function(Oe){var Te=Vi.attr(Oe,Q);return Te==null?pe==="!=":pe?(Te+="",pe==="="?Te===_e:pe==="!="?Te!==_e:pe==="^="?_e&&Te.indexOf(_e)===0:pe==="*="?_e&&Te.indexOf(_e)>-1:pe==="$="?_e&&Te.slice(-_e.length)===_e:pe==="~="?(" "+Te+" ").indexOf(_e)>-1:pe==="|="?Te===_e||Te.slice(0,_e.length+1)===_e+"-":!1):!0}},CHILD:function(Q,pe,_e,Oe,Te){var Ge=Q.slice(0,3)!=="nth",Ue=Q.slice(-4)!=="last",nt=pe==="of-type";return Oe===1&&Te===0?function(mt){return!!mt.parentNode}:function(mt,Rt,Mt){var Pt,ki,Qt,Ii,Ss,ws,Js=Ge!==Ue?"nextSibling":"previousSibling",Ri=mt.parentNode,fo=nt&&mt.nodeName.toLowerCase(),mo=!Mt&&!nt;if(Ri){if(Ge){for(;Js;){for(Qt=mt;Qt=Qt[Js];)if(nt?Qt.nodeName.toLowerCase()===fo:Qt.nodeType===1)return!1;ws=Js=Q==="only"&&!ws&&"nextSibling"}return!0}if(ws=[Ue?Ri.firstChild:Ri.lastChild],Ue&&mo){for(ki=Ri[pi]||(Ri[pi]={}),Pt=ki[Q]||[],Ss=Pt[0]===Et&&Pt[1],Ii=Pt[0]===Et&&Pt[2],Qt=Ss&&Ri.childNodes[Ss];Qt=++Ss&&Qt&&Qt[Js]||(Ii=Ss=0)||ws.pop();)if(Qt.nodeType===1&&++Ii&&Qt===mt){ki[Q]=[Et,Ss,Ii];break}}else if(mo&&(Pt=(mt[pi]||(mt[pi]={}))[Q])&&Pt[0]===Et)Ii=Pt[1];else for(;(Qt=++Ss&&Qt&&Qt[Js]||(Ii=Ss=0)||ws.pop())&&!((nt?Qt.nodeName.toLowerCase()===fo:Qt.nodeType===1)&&++Ii&&(mo&&((Qt[pi]||(Qt[pi]={}))[Q]=[Et,Ii]),Qt===mt)););return Ii-=Te,Ii===Oe||Ii%Oe===0&&Ii/Oe>=0}}},PSEUDO:function(Q,pe){var _e,Oe=I.pseudos[Q]||I.setFilters[Q.toLowerCase()]||Vi.error("unsupported pseudo: "+Q);return Oe[pi]?Oe(pe):Oe.length>1?(_e=[Q,Q,"",pe],I.setFilters.hasOwnProperty(Q.toLowerCase())?Ln(function(Te,Ge){for(var Ue,nt=Oe(Te,pe),mt=nt.length;mt--;)Ue=Qr.call(Te,nt[mt]),Te[Ue]=!(Ge[Ue]=nt[mt])}):function(Te){return Oe(Te,0,_e)}):Oe}},pseudos:{not:Ln(function(Q){var pe=[],_e=[],Oe=X(Q.replace(Fl,"$1"));return Oe[pi]?Ln(function(Te,Ge,Ue,nt){for(var mt,Rt=Oe(Te,null,nt,[]),Mt=Te.length;Mt--;)(mt=Rt[Mt])&&(Te[Mt]=!(Ge[Mt]=mt))}):function(Te,Ge,Ue){return pe[0]=Te,Oe(pe,null,Ue,_e),!_e.pop()}}),has:Ln(function(Q){return function(pe){return Vi(Q,pe).length>0}}),contains:Ln(function(Q){return function(pe){return(pe.textContent||pe.innerText||R(pe)).indexOf(Q)>-1}}),lang:Ln(function(Q){return sb.test(Q||"")||Vi.error("unsupported lang: "+Q),Q=Q.replace(mr,yr).toLowerCase(),function(pe){var _e;do if(_e=at?pe.lang:pe.getAttribute("xml:lang")||pe.getAttribute("lang"))return _e=_e.toLowerCase(),_e===Q||_e.indexOf(Q+"-")===0;while((pe=pe.parentNode)&&pe.nodeType===1);return!1}}),target:function(Q){var pe=d.location&&d.location.hash;return pe&&pe.slice(1)===Q.id},root:function(Q){return Q===Ke},focus:function(Q){return Q===Ye.activeElement&&(!Ye.hasFocus||Ye.hasFocus())&&!!(Q.type||Q.href||~Q.tabIndex)},enabled:function(Q){return Q.disabled===!1},disabled:function(Q){return Q.disabled===!0},checked:function(Q){var pe=Q.nodeName.toLowerCase();return pe==="input"&&!!Q.checked||pe==="option"&&!!Q.selected},selected:function(Q){return Q.parentNode&&Q.parentNode.selectedIndex,Q.selected===!0},empty:function(Q){for(Q=Q.firstChild;Q;Q=Q.nextSibling)if(Q.nodeType<6)return!1;return!0},parent:function(Q){return!I.pseudos.empty(Q)},header:function(Q){return rb.test(Q.nodeName)},input:function(Q){return nb.test(Q.nodeName)},button:function(Q){var pe=Q.nodeName.toLowerCase();return pe==="input"&&Q.type==="button"||pe==="button"},text:function(Q){var pe;return Q.nodeName.toLowerCase()==="input"&&Q.type==="text"&&((pe=Q.getAttribute("type"))==null||pe.toLowerCase()==="text")},first:Zr(function(){return[0]}),last:Zr(function(Q,pe){return[pe-1]}),eq:Zr(function(Q,pe,_e){return[_e<0?_e+pe:_e]}),even:Zr(function(Q,pe){for(var _e=0;_e<pe;_e+=2)Q.push(_e);return Q}),odd:Zr(function(Q,pe){for(var _e=1;_e<pe;_e+=2)Q.push(_e);return Q}),lt:Zr(function(Q,pe,_e){for(var Oe=_e<0?_e+pe:_e;--Oe>=0;)Q.push(Oe);return Q}),gt:Zr(function(Q,pe,_e){for(var Oe=_e<0?_e+pe:_e;++Oe<pe;)Q.push(Oe);return Q})}},I.pseudos.nth=I.pseudos.eq;for(v in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})I.pseudos[v]=lb(v);for(v in{submit:!0,reset:!0})I.pseudos[v]=hb(v);function Cg(){}Cg.prototype=I.filters=I.pseudos,I.setFilters=new Cg;function Vl(Q,pe){var _e,Oe,Te,Ge,Ue,nt,mt,Rt=ji[Q+" "];if(Rt)return pe?0:Rt.slice(0);for(Ue=Q,nt=[],mt=I.preFilter;Ue;){(!_e||(Oe=Jy.exec(Ue)))&&(Oe&&(Ue=Ue.slice(Oe[0].length)||Ue),nt.push(Te=[])),_e=!1,(Oe=eb.exec(Ue))&&(_e=Oe.shift(),Te.push({value:_e,type:Oe[0].replace(Fl," ")}),Ue=Ue.slice(_e.length));for(Ge in I.filter)(Oe=Hl[Ge].exec(Ue))&&(!mt[Ge]||(Oe=mt[Ge](Oe)))&&(_e=Oe.shift(),Te.push({value:_e,type:Ge,matches:Oe}),Ue=Ue.slice(_e.length));if(!_e)break}return pe?Ue.length:Ue?Vi.error(Q):ji(Q,nt).slice(0)}function zl(Q){for(var pe=0,_e=Q.length,Oe="";pe<_e;pe++)Oe+=Q[pe].value;return Oe}function cc(Q,pe,_e){var Oe=pe.dir,Te=_e&&Oe==="parentNode",Ge=La++;return pe.first?function(Ue,nt,mt){for(;Ue=Ue[Oe];)if(Ue.nodeType===1||Te)return Q(Ue,nt,mt)}:function(Ue,nt,mt){var Rt,Mt,Pt=[Et,Ge];if(mt){for(;Ue=Ue[Oe];)if((Ue.nodeType===1||Te)&&Q(Ue,nt,mt))return!0}else for(;Ue=Ue[Oe];)if(Ue.nodeType===1||Te){if(Mt=Ue[pi]||(Ue[pi]={}),(Rt=Mt[Oe])&&Rt[0]===Et&&Rt[1]===Ge)return Pt[2]=Rt[2];if(Mt[Oe]=Pt,Pt[2]=Q(Ue,nt,mt))return!0}}}function uc(Q){return Q.length>1?function(pe,_e,Oe){for(var Te=Q.length;Te--;)if(!Q[Te](pe,_e,Oe))return!1;return!0}:Q[0]}function $l(Q,pe,_e,Oe,Te){for(var Ge,Ue=[],nt=0,mt=Q.length,Rt=pe!=null;nt<mt;nt++)(Ge=Q[nt])&&(!_e||_e(Ge,Oe,Te))&&(Ue.push(Ge),Rt&&pe.push(nt));return Ue}function dc(Q,pe,_e,Oe,Te,Ge){return Oe&&!Oe[pi]&&(Oe=dc(Oe)),Te&&!Te[pi]&&(Te=dc(Te,Ge)),Ln(function(Ue,nt,mt,Rt){var Mt,Pt,ki,Qt=[],Ii=[],Ss=nt.length,ws=Ue||ub(pe||"*",mt.nodeType?[mt]:mt,[]),Js=Q&&(Ue||!pe)?$l(ws,Qt,Q,mt,Rt):ws,Ri=_e?Te||(Ue?Q:Ss||Oe)?[]:nt:Js;if(_e&&_e(Js,Ri,mt,Rt),Oe)for(Mt=$l(Ri,Ii),Oe(Mt,[],mt,Rt),Pt=Mt.length;Pt--;)(ki=Mt[Pt])&&(Ri[Ii[Pt]]=!(Js[Ii[Pt]]=ki));if(Ue){if(Te||Q){if(Te){for(Mt=[],Pt=Ri.length;Pt--;)(ki=Ri[Pt])&&Mt.push(Js[Pt]=ki);Te(null,Ri=[],Mt,Rt)}for(Pt=Ri.length;Pt--;)(ki=Ri[Pt])&&(Mt=Te?Qr.call(Ue,ki):Qt[Pt])>-1&&(Ue[Mt]=!(nt[Mt]=ki))}}else Ri=$l(Ri===nt?Ri.splice(Ss,Ri.length):Ri),Te?Te(null,nt,Ri,Rt):fr.apply(nt,Ri)})}function gc(Q){for(var pe,_e,Oe,Te=Q.length,Ge=I.relative[Q[0].type],Ue=Ge||I.relative[" "],nt=Ge?1:0,mt=cc(function(Pt){return Pt===pe},Ue,!0),Rt=cc(function(Pt){return Qr.call(pe,Pt)>-1},Ue,!0),Mt=[function(Pt,ki,Qt){return!Ge&&(Qt||ki!==oe)||((pe=ki).nodeType?mt(Pt,ki,Qt):Rt(Pt,ki,Qt))}];nt<Te;nt++)if(_e=I.relative[Q[nt].type])Mt=[cc(uc(Mt),_e)];else{if(_e=I.filter[Q[nt].type].apply(null,Q[nt].matches),_e[pi]){for(Oe=++nt;Oe<Te&&!I.relative[Q[Oe].type];Oe++);return dc(nt>1&&uc(Mt),nt>1&&zl(Q.slice(0,nt-1).concat({value:Q[nt-2].type===" "?"*":""})).replace(Fl,"$1"),_e,nt<Oe&&gc(Q.slice(nt,Oe)),Oe<Te&&gc(Q=Q.slice(Oe)),Oe<Te&&zl(Q))}Mt.push(_e)}return uc(Mt)}function cb(Q,pe){var _e=pe.length>0,Oe=Q.length>0,Te=function(Ge,Ue,nt,mt,Rt){var Mt,Pt,ki,Qt=0,Ii="0",Ss=Ge&&[],ws=[],Js=oe,Ri=Ge||Oe&&I.find.TAG("*",Rt),fo=Et+=Js==null?1:Math.random()||.1,mo=Ri.length;for(Rt&&(oe=Ue!==Ye&&Ue);Ii!==mo&&(Mt=Ri[Ii])!=null;Ii++){if(Oe&&Mt){for(Pt=0;ki=Q[Pt++];)if(ki(Mt,Ue,nt)){mt.push(Mt);break}Rt&&(Et=fo)}_e&&((Mt=!ki&&Mt)&&Qt--,Ge&&Ss.push(Mt))}if(Qt+=Ii,_e&&Ii!==Qt){for(Pt=0;ki=pe[Pt++];)ki(Ss,ws,Ue,nt);if(Ge){if(Qt>0)for(;Ii--;)Ss[Ii]||ws[Ii]||(ws[Ii]=pr.call(mt));ws=$l(ws)}fr.apply(mt,ws),Rt&&!Ge&&ws.length>0&&Qt+pe.length>1&&Vi.uniqueSort(mt)}return Rt&&(Et=fo,oe=Js),Ss};return _e?Ln(Te):Te}X=Vi.compile=function(Q,pe){var _e,Oe=[],Te=[],Ge=gr[Q+" "];if(!Ge){for(pe||(pe=Vl(Q)),_e=pe.length;_e--;)Ge=gc(pe[_e]),Ge[pi]?Oe.push(Ge):Te.push(Ge);Ge=gr(Q,cb(Te,Oe))}return Ge};function ub(Q,pe,_e){for(var Oe=0,Te=pe.length;Oe<Te;Oe++)Vi(Q,pe[Oe],_e);return _e}function db(Q,pe,_e,Oe){var Te,Ge,Ue,nt,mt,Rt=Vl(Q);if(!Oe&&Rt.length===1){if(Ge=Rt[0]=Rt[0].slice(0),Ge.length>2&&(Ue=Ge[0]).type==="ID"&&S.getById&&pe.nodeType===9&&at&&I.relative[Ge[1].type]){if(pe=(I.find.ID(Ue.matches[0].replace(mr,yr),pe)||[])[0],!pe)return _e;Q=Q.slice(Ge.shift().value.length)}for(Te=Hl.needsContext.test(Q)?0:Ge.length;Te--&&(Ue=Ge[Te],!I.relative[nt=Ue.type]);)if((mt=I.find[nt])&&(Oe=mt(Ue.matches[0].replace(mr,yr),ac.test(Ge[0].type)&&hc(pe.parentNode)||pe))){if(Ge.splice(Te,1),Q=Oe.length&&zl(Ge),!Q)return fr.apply(_e,Oe),_e;break}}return X(Q,Rt)(Oe,pe,!at,_e,ac.test(Q)&&hc(pe.parentNode)||pe),_e}return S.sortStable=pi.split("").sort(go).join("")===pi,S.detectDuplicates=!!ke,De(),S.sortDetached=Pn(function(Q){return Q.compareDocumentPosition(Ye.createElement("div"))&1}),Pn(function(Q){return Q.innerHTML="<a href='#'></a>",Q.firstChild.getAttribute("href")==="#"})||lc("type|href|height|width",function(Q,pe,_e){if(!_e)return Q.getAttribute(pe,pe.toLowerCase()==="type"?1:2)}),(!S.attributes||!Pn(function(Q){return Q.innerHTML="<input/>",Q.firstChild.setAttribute("value",""),Q.firstChild.getAttribute("value")===""}))&&lc("value",function(Q,pe,_e){if(!_e&&Q.nodeName.toLowerCase()==="input")return Q.defaultValue}),Pn(function(Q){return Q.getAttribute("disabled")==null})||lc(nc,function(Q,pe,_e){var Oe;if(!_e)return Q[pe]===!0?pe.toLowerCase():(Oe=Q.getAttributeNode(pe))&&Oe.specified?Oe.value:null}),Vi}(e);m.find=ce,m.expr=ce.selectors,m.expr[":"]=m.expr.pseudos,m.unique=ce.uniqueSort,m.text=ce.getText,m.isXMLDoc=ce.isXML,m.contains=ce.contains;var ne=m.expr.match.needsContext,me=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,Fe=/^.[^:#\[\.,]*$/;function we(d,v,S){if(m.isFunction(v))return m.grep(d,function(I,R){return!!v.call(I,R,I)!==S});if(v.nodeType)return m.grep(d,function(I){return I===v!==S});if(typeof v=="string"){if(Fe.test(v))return m.filter(v,d,S);v=m.filter(v,d)}return m.grep(d,function(I){return c.call(v,I)>=0!==S})}m.filter=function(d,v,S){var I=v[0];return S&&(d=":not("+d+")"),v.length===1&&I.nodeType===1?m.find.matchesSelector(I,d)?[I]:[]:m.find.matches(d,m.grep(v,function(R){return R.nodeType===1}))},m.fn.extend({find:function(d){var v,S=this.length,I=[],R=this;if(typeof d!="string")return this.pushStack(m(d).filter(function(){for(v=0;v<S;v++)if(m.contains(R[v],this))return!0}));for(v=0;v<S;v++)m.find(d,R[v],I);return I=this.pushStack(S>1?m.unique(I):I),I.selector=this.selector?this.selector+" "+d:d,I},filter:function(d){return this.pushStack(we(this,d||[],!1))},not:function(d){return this.pushStack(we(this,d||[],!0))},is:function(d){return!!we(this,typeof d=="string"&&ne.test(d)?m(d):d||[],!1).length}});var He,Me=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,ze=m.fn.init=function(d,v){var S,I;if(!d)return this;if(typeof d=="string")if(d[0]==="<"&&d[d.length-1]===">"&&d.length>=3?S=[null,d,null]:S=Me.exec(d),S&&(S[1]||!v))if(S[1]){if(v=v instanceof m?v[0]:v,m.merge(this,m.parseHTML(S[1],v&&v.nodeType?v.ownerDocument||v:z,!0)),me.test(S[1])&&m.isPlainObject(v))for(S in v)m.isFunction(this[S])?this[S](v[S]):this.attr(S,v[S]);return this}else return I=z.getElementById(S[2]),I&&I.parentNode&&(this.length=1,this[0]=I),this.context=z,this.selector=d,this;else return!v||v.jquery?(v||He).find(d):this.constructor(v).find(d);else{if(d.nodeType)return this.context=this[0]=d,this.length=1,this;if(m.isFunction(d))return typeof He.ready<"u"?He.ready(d):d(m)}return d.selector!==void 0&&(this.selector=d.selector,this.context=d.context),m.makeArray(d,this)};ze.prototype=m.fn,He=m(z);var Je=/^(?:parents|prev(?:Until|All))/,Ee={children:!0,contents:!0,next:!0,prev:!0};m.extend({dir:function(d,v,S){for(var I=[],R=S!==void 0;(d=d[v])&&d.nodeType!==9;)if(d.nodeType===1){if(R&&m(d).is(S))break;I.push(d)}return I},sibling:function(d,v){for(var S=[];d;d=d.nextSibling)d.nodeType===1&&d!==v&&S.push(d);return S}}),m.fn.extend({has:function(d){var v=m(d,this),S=v.length;return this.filter(function(){for(var I=0;I<S;I++)if(m.contains(this,v[I]))return!0})},closest:function(d,v){for(var S,I=0,R=this.length,H=[],X=ne.test(d)||typeof d!="string"?m(d,v||this.context):0;I<R;I++)for(S=this[I];S&&S!==v;S=S.parentNode)if(S.nodeType<11&&(X?X.index(S)>-1:S.nodeType===1&&m.find.matchesSelector(S,d))){H.push(S);break}return this.pushStack(H.length>1?m.unique(H):H)},index:function(d){return d?typeof d=="string"?c.call(m(d),this[0]):c.call(this,d.jquery?d[0]:d):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(d,v){return this.pushStack(m.unique(m.merge(this.get(),m(d,v))))},addBack:function(d){return this.add(d==null?this.prevObject:this.prevObject.filter(d))}});function rt(d,v){for(;(d=d[v])&&d.nodeType!==1;);return d}m.each({parent:function(d){var v=d.parentNode;return v&&v.nodeType!==11?v:null},parents:function(d){return m.dir(d,"parentNode")},parentsUntil:function(d,v,S){return m.dir(d,"parentNode",S)},next:function(d){return rt(d,"nextSibling")},prev:function(d){return rt(d,"previousSibling")},nextAll:function(d){return m.dir(d,"nextSibling")},prevAll:function(d){return m.dir(d,"previousSibling")},nextUntil:function(d,v,S){return m.dir(d,"nextSibling",S)},prevUntil:function(d,v,S){return m.dir(d,"previousSibling",S)},siblings:function(d){return m.sibling((d.parentNode||{}).firstChild,d)},children:function(d){return m.sibling(d.firstChild)},contents:function(d){return d.contentDocument||m.merge([],d.childNodes)}},function(d,v){m.fn[d]=function(S,I){var R=m.map(this,v,S);return d.slice(-5)!=="Until"&&(I=S),I&&typeof I=="string"&&(R=m.filter(I,R)),this.length>1&&(Ee[d]||m.unique(R),Je.test(d)&&R.reverse()),this.pushStack(R)}});var Ie=/\S+/g,Re={};function We(d){var v=Re[d]={};return m.each(d.match(Ie)||[],function(S,I){v[I]=!0}),v}m.Callbacks=function(d){d=typeof d=="string"?Re[d]||We(d):m.extend({},d);var v,S,I,R,H,X,oe=[],Le=!d.once&&[],ke=function(Ye){for(v=d.memory&&Ye,S=!0,X=R||0,R=0,H=oe.length,I=!0;oe&&X<H;X++)if(oe[X].apply(Ye[0],Ye[1])===!1&&d.stopOnFalse){v=!1;break}I=!1,oe&&(Le?Le.length&&ke(Le.shift()):v?oe=[]:De.disable())},De={add:function(){if(oe){var Ye=oe.length;(function Ke(at){m.each(at,function(At,ti){var Mi=m.type(ti);Mi==="function"?(!d.unique||!De.has(ti))&&oe.push(ti):ti&&ti.length&&Mi!=="string"&&Ke(ti)})})(arguments),I?H=oe.length:v&&(R=Ye,ke(v))}return this},remove:function(){return oe&&m.each(arguments,function(Ye,Ke){for(var at;(at=m.inArray(Ke,oe,at))>-1;)oe.splice(at,1),I&&(at<=H&&H--,at<=X&&X--)}),this},has:function(Ye){return Ye?m.inArray(Ye,oe)>-1:!!(oe&&oe.length)},empty:function(){return oe=[],H=0,this},disable:function(){return oe=Le=v=void 0,this},disabled:function(){return!oe},lock:function(){return Le=void 0,v||De.disable(),this},locked:function(){return!Le},fireWith:function(Ye,Ke){return oe&&(!S||Le)&&(Ke=Ke||[],Ke=[Ye,Ke.slice?Ke.slice():Ke],I?Le.push(Ke):ke(Ke)),this},fire:function(){return De.fireWith(this,arguments),this},fired:function(){return!!S}};return De},m.extend({Deferred:function(d){var v=[["resolve","done",m.Callbacks("once memory"),"resolved"],["reject","fail",m.Callbacks("once memory"),"rejected"],["notify","progress",m.Callbacks("memory")]],S="pending",I={state:function(){return S},always:function(){return R.done(arguments).fail(arguments),this},then:function(){var H=arguments;return m.Deferred(function(X){m.each(v,function(oe,Le){var ke=m.isFunction(H[oe])&&H[oe];R[Le[1]](function(){var De=ke&&ke.apply(this,arguments);De&&m.isFunction(De.promise)?De.promise().done(X.resolve).fail(X.reject).progress(X.notify):X[Le[0]+"With"](this===I?X.promise():this,ke?[De]:arguments)})}),H=null}).promise()},promise:function(H){return H!=null?m.extend(H,I):I}},R={};return I.pipe=I.then,m.each(v,function(H,X){var oe=X[2],Le=X[3];I[X[1]]=oe.add,Le&&oe.add(function(){S=Le},v[H^1][2].disable,v[2][2].lock),R[X[0]]=function(){return R[X[0]+"With"](this===R?I:this,arguments),this},R[X[0]+"With"]=oe.fireWith}),I.promise(R),d&&d.call(R,R),R},when:function(d){var v=0,S=s.call(arguments),I=S.length,R=I!==1||d&&m.isFunction(d.promise)?I:0,H=R===1?d:m.Deferred(),X=function(De,Ye,Ke){return function(at){Ye[De]=this,Ke[De]=arguments.length>1?s.call(arguments):at,Ke===oe?H.notifyWith(Ye,Ke):--R||H.resolveWith(Ye,Ke)}},oe,Le,ke;if(I>1)for(oe=new Array(I),Le=new Array(I),ke=new Array(I);v<I;v++)S[v]&&m.isFunction(S[v].promise)?S[v].promise().done(X(v,ke,S)).fail(H.reject).progress(X(v,Le,oe)):--R;return R||H.resolveWith(ke,S),H.promise()}});var Ve;m.fn.ready=function(d){return m.ready.promise().done(d),this},m.extend({isReady:!1,readyWait:1,holdReady:function(d){d?m.readyWait++:m.ready(!0)},ready:function(d){(d===!0?--m.readyWait:m.isReady)||(m.isReady=!0,!(d!==!0&&--m.readyWait>0)&&(Ve.resolveWith(z,[m]),m.fn.trigger&&m(z).trigger("ready").off("ready")))}});function Qe(){z.removeEventListener("DOMContentLoaded",Qe,!1),e.removeEventListener("load",Qe,!1),m.ready()}m.ready.promise=function(d){return Ve||(Ve=m.Deferred(),z.readyState==="complete"?setTimeout(m.ready):(z.addEventListener("DOMContentLoaded",Qe,!1),e.addEventListener("load",Qe,!1))),Ve.promise(d)},m.ready.promise();var Ot=m.access=function(d,v,S,I,R,H,X){var oe=0,Le=d.length,ke=S==null;if(m.type(S)==="object"){R=!0;for(oe in S)m.access(d,v,oe,S[oe],!0,H,X)}else if(I!==void 0&&(R=!0,m.isFunction(I)||(X=!0),ke&&(X?(v.call(d,I),v=null):(ke=v,v=function(De,Ye,Ke){return ke.call(m(De),Ke)})),v))for(;oe<Le;oe++)v(d[oe],S,X?I:I.call(d[oe],oe,v(d[oe],S)));return R?d:ke?v.call(d):Le?v(d[0],S):H};m.acceptData=function(d){return d.nodeType===1||d.nodeType===9||!+d.nodeType};function Tt(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=m.expando+Math.random()}Tt.uid=1,Tt.accepts=m.acceptData,Tt.prototype={key:function(d){if(!Tt.accepts(d))return 0;var v={},S=d[this.expando];if(!S){S=Tt.uid++;try{v[this.expando]={value:S},Object.defineProperties(d,v)}catch{v[this.expando]=S,m.extend(d,v)}}return this.cache[S]||(this.cache[S]={}),S},set:function(d,v,S){var I,R=this.key(d),H=this.cache[R];if(typeof v=="string")H[v]=S;else if(m.isEmptyObject(H))m.extend(this.cache[R],v);else for(I in v)H[I]=v[I];return H},get:function(d,v){var S=this.cache[this.key(d)];return v===void 0?S:S[v]},access:function(d,v,S){var I;return v===void 0||v&&typeof v=="string"&&S===void 0?(I=this.get(d,v),I!==void 0?I:this.get(d,m.camelCase(v))):(this.set(d,v,S),S!==void 0?S:v)},remove:function(d,v){var S,I,R,H=this.key(d),X=this.cache[H];if(v===void 0)this.cache[H]={};else for(m.isArray(v)?I=v.concat(v.map(m.camelCase)):(R=m.camelCase(v),v in X?I=[v,R]:(I=R,I=I in X?[I]:I.match(Ie)||[])),S=I.length;S--;)delete X[I[S]]},hasData:function(d){return!m.isEmptyObject(this.cache[d[this.expando]]||{})},discard:function(d){d[this.expando]&&delete this.cache[d[this.expando]]}};var ot=new Tt,gt=new Tt,Lt=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Vt=/([A-Z])/g;function hi(d,v,S){var I;if(S===void 0&&d.nodeType===1)if(I="data-"+v.replace(Vt,"-$1").toLowerCase(),S=d.getAttribute(I),typeof S=="string"){try{S=S==="true"?!0:S==="false"?!1:S==="null"?null:+S+""===S?+S:Lt.test(S)?m.parseJSON(S):S}catch{}gt.set(d,v,S)}else S=void 0;return S}m.extend({hasData:function(d){return gt.hasData(d)||ot.hasData(d)},data:function(d,v,S){return gt.access(d,v,S)},removeData:function(d,v){gt.remove(d,v)},_data:function(d,v,S){return ot.access(d,v,S)},_removeData:function(d,v){ot.remove(d,v)}}),m.fn.extend({data:function(d,v){var S,I,R,H=this[0],X=H&&H.attributes;if(d===void 0){if(this.length&&(R=gt.get(H),H.nodeType===1&&!ot.get(H,"hasDataAttrs"))){for(S=X.length;S--;)I=X[S].name,I.indexOf("data-")===0&&(I=m.camelCase(I.slice(5)),hi(H,I,R[I]));ot.set(H,"hasDataAttrs",!0)}return R}return typeof d=="object"?this.each(function(){gt.set(this,d)}):Ot(this,function(oe){var Le,ke=m.camelCase(d);if(H&&oe===void 0)return Le=gt.get(H,d),Le!==void 0||(Le=gt.get(H,ke),Le!==void 0)||(Le=hi(H,ke,void 0),Le!==void 0)?Le:void 0;this.each(function(){var De=gt.get(this,ke);gt.set(this,ke,oe),d.indexOf("-")!==-1&&De!==void 0&&gt.set(this,d,oe)})},null,v,arguments.length>1,null,!0)},removeData:function(d){return this.each(function(){gt.remove(this,d)})}}),m.extend({queue:function(d,v,S){var I;if(d)return v=(v||"fx")+"queue",I=ot.get(d,v),S&&(!I||m.isArray(S)?I=ot.access(d,v,m.makeArray(S)):I.push(S)),I||[]},dequeue:function(d,v){v=v||"fx";var S=m.queue(d,v),I=S.length,R=S.shift(),H=m._queueHooks(d,v),X=function(){m.dequeue(d,v)};R==="inprogress"&&(R=S.shift(),I--),R&&(v==="fx"&&S.unshift("inprogress"),delete H.stop,R.call(d,X,H)),!I&&H&&H.empty.fire()},_queueHooks:function(d,v){var S=v+"queueHooks";return ot.get(d,S)||ot.access(d,S,{empty:m.Callbacks("once memory").add(function(){ot.remove(d,[v+"queue",S])})})}}),m.fn.extend({queue:function(d,v){var S=2;return typeof d!="string"&&(v=d,d="fx",S--),arguments.length<S?m.queue(this[0],d):v===void 0?this:this.each(function(){var I=m.queue(this,d,v);m._queueHooks(this,d),d==="fx"&&I[0]!=="inprogress"&&m.dequeue(this,d)})},dequeue:function(d){return this.each(function(){m.dequeue(this,d)})},clearQueue:function(d){return this.queue(d||"fx",[])},promise:function(d,v){var S,I=1,R=m.Deferred(),H=this,X=this.length,oe=function(){--I||R.resolveWith(H,[H])};for(typeof d!="string"&&(v=d,d=void 0),d=d||"fx";X--;)S=ot.get(H[X],d+"queueHooks"),S&&S.empty&&(I++,S.empty.add(oe));return oe(),R.promise(v)}});var Oi=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,St=["Top","Right","Bottom","Left"],Ht=function(d,v){return d=v||d,m.css(d,"display")==="none"||!m.contains(d.ownerDocument,d)},jt=/^(?:checkbox|radio)$/i;(function(){var d=z.createDocumentFragment(),v=d.appendChild(z.createElement("div"));v.innerHTML="<input type='radio' checked='checked' name='t'/>",T.checkClone=v.cloneNode(!0).cloneNode(!0).lastChild.checked,v.innerHTML="<textarea>x</textarea>",T.noCloneChecked=!!v.cloneNode(!0).lastChild.defaultValue})();var lt="undefined";T.focusinBubbles="onfocusin"in e;var Rs=/^key/,Ns=/^(?:mouse|contextmenu)|click/,ps=/^(?:focusinfocus|focusoutblur)$/,Kr=/^([^.]*)(?:\.(.+)|)$/;function b(){return!0}function J(){return!1}function ie(){try{return z.activeElement}catch{}}m.event={global:{},add:function(d,v,S,I,R){var H,X,oe,Le,ke,De,Ye,Ke,at,At,ti,Mi=ot.get(d);if(Mi)for(S.handler&&(H=S,S=H.handler,R=H.selector),S.guid||(S.guid=m.guid++),(Le=Mi.events)||(Le=Mi.events={}),(X=Mi.handle)||(X=Mi.handle=function(Mn){return typeof m!==lt&&m.event.triggered!==Mn.type?m.event.dispatch.apply(d,arguments):void 0}),v=(v||"").match(Ie)||[""],ke=v.length;ke--;)oe=Kr.exec(v[ke])||[],at=ti=oe[1],At=(oe[2]||"").split(".").sort(),at&&(Ye=m.event.special[at]||{},at=(R?Ye.delegateType:Ye.bindType)||at,Ye=m.event.special[at]||{},De=m.extend({type:at,origType:ti,data:I,handler:S,guid:S.guid,selector:R,needsContext:R&&m.expr.match.needsContext.test(R),namespace:At.join(".")},H),(Ke=Le[at])||(Ke=Le[at]=[],Ke.delegateCount=0,(!Ye.setup||Ye.setup.call(d,I,At,X)===!1)&&d.addEventListener&&d.addEventListener(at,X,!1)),Ye.add&&(Ye.add.call(d,De),De.handler.guid||(De.handler.guid=S.guid)),R?Ke.splice(Ke.delegateCount++,0,De):Ke.push(De),m.event.global[at]=!0)},remove:function(d,v,S,I,R){var H,X,oe,Le,ke,De,Ye,Ke,at,At,ti,Mi=ot.hasData(d)&&ot.get(d);if(!(!Mi||!(Le=Mi.events))){for(v=(v||"").match(Ie)||[""],ke=v.length;ke--;){if(oe=Kr.exec(v[ke])||[],at=ti=oe[1],At=(oe[2]||"").split(".").sort(),!at){for(at in Le)m.event.remove(d,at+v[ke],S,I,!0);continue}for(Ye=m.event.special[at]||{},at=(I?Ye.delegateType:Ye.bindType)||at,Ke=Le[at]||[],oe=oe[2]&&new RegExp("(^|\\.)"+At.join("\\.(?:.*\\.|)")+"(\\.|$)"),X=H=Ke.length;H--;)De=Ke[H],(R||ti===De.origType)&&(!S||S.guid===De.guid)&&(!oe||oe.test(De.namespace))&&(!I||I===De.selector||I==="**"&&De.selector)&&(Ke.splice(H,1),De.selector&&Ke.delegateCount--,Ye.remove&&Ye.remove.call(d,De));X&&!Ke.length&&((!Ye.teardown||Ye.teardown.call(d,At,Mi.handle)===!1)&&m.removeEvent(d,at,Mi.handle),delete Le[at])}m.isEmptyObject(Le)&&(delete Mi.handle,ot.remove(d,"events"))}},trigger:function(d,v,S,I){var R,H,X,oe,Le,ke,De,Ye=[S||z],Ke=w.call(d,"type")?d.type:d,at=w.call(d,"namespace")?d.namespace.split("."):[];if(H=X=S=S||z,!(S.nodeType===3||S.nodeType===8)&&!ps.test(Ke+m.event.triggered)&&(Ke.indexOf(".")>=0&&(at=Ke.split("."),Ke=at.shift(),at.sort()),Le=Ke.indexOf(":")<0&&"on"+Ke,d=d[m.expando]?d:new m.Event(Ke,typeof d=="object"&&d),d.isTrigger=I?2:3,d.namespace=at.join("."),d.namespace_re=d.namespace?new RegExp("(^|\\.)"+at.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,d.result=void 0,d.target||(d.target=S),v=v==null?[d]:m.makeArray(v,[d]),De=m.event.special[Ke]||{},!(!I&&De.trigger&&De.trigger.apply(S,v)===!1))){if(!I&&!De.noBubble&&!m.isWindow(S)){for(oe=De.delegateType||Ke,ps.test(oe+Ke)||(H=H.parentNode);H;H=H.parentNode)Ye.push(H),X=H;X===(S.ownerDocument||z)&&Ye.push(X.defaultView||X.parentWindow||e)}for(R=0;(H=Ye[R++])&&!d.isPropagationStopped();)d.type=R>1?oe:De.bindType||Ke,ke=(ot.get(H,"events")||{})[d.type]&&ot.get(H,"handle"),ke&&ke.apply(H,v),ke=Le&&H[Le],ke&&ke.apply&&m.acceptData(H)&&(d.result=ke.apply(H,v),d.result===!1&&d.preventDefault());return d.type=Ke,!I&&!d.isDefaultPrevented()&&(!De._default||De._default.apply(Ye.pop(),v)===!1)&&m.acceptData(S)&&Le&&m.isFunction(S[Ke])&&!m.isWindow(S)&&(X=S[Le],X&&(S[Le]=null),m.event.triggered=Ke,S[Ke](),m.event.triggered=void 0,X&&(S[Le]=X)),d.result}},dispatch:function(d){d=m.event.fix(d);var v,S,I,R,H,X=[],oe=s.call(arguments),Le=(ot.get(this,"events")||{})[d.type]||[],ke=m.event.special[d.type]||{};if(oe[0]=d,d.delegateTarget=this,!(ke.preDispatch&&ke.preDispatch.call(this,d)===!1)){for(X=m.event.handlers.call(this,d,Le),v=0;(R=X[v++])&&!d.isPropagationStopped();)for(d.currentTarget=R.elem,S=0;(H=R.handlers[S++])&&!d.isImmediatePropagationStopped();)(!d.namespace_re||d.namespace_re.test(H.namespace))&&(d.handleObj=H,d.data=H.data,I=((m.event.special[H.origType]||{}).handle||H.handler).apply(R.elem,oe),I!==void 0&&(d.result=I)===!1&&(d.preventDefault(),d.stopPropagation()));return ke.postDispatch&&ke.postDispatch.call(this,d),d.result}},handlers:function(d,v){var S,I,R,H,X=[],oe=v.delegateCount,Le=d.target;if(oe&&Le.nodeType&&(!d.button||d.type!=="click")){for(;Le!==this;Le=Le.parentNode||this)if(Le.disabled!==!0||d.type!=="click"){for(I=[],S=0;S<oe;S++)H=v[S],R=H.selector+" ",I[R]===void 0&&(I[R]=H.needsContext?m(R,this).index(Le)>=0:m.find(R,this,null,[Le]).length),I[R]&&I.push(H);I.length&&X.push({elem:Le,handlers:I})}}return oe<v.length&&X.push({elem:this,handlers:v.slice(oe)}),X},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(d,v){return d.which==null&&(d.which=v.charCode!=null?v.charCode:v.keyCode),d}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(d,v){var S,I,R,H=v.button;return d.pageX==null&&v.clientX!=null&&(S=d.target.ownerDocument||z,I=S.documentElement,R=S.body,d.pageX=v.clientX+(I&&I.scrollLeft||R&&R.scrollLeft||0)-(I&&I.clientLeft||R&&R.clientLeft||0),d.pageY=v.clientY+(I&&I.scrollTop||R&&R.scrollTop||0)-(I&&I.clientTop||R&&R.clientTop||0)),!d.which&&H!==void 0&&(d.which=H&1?1:H&2?3:H&4?2:0),d}},fix:function(d){if(d[m.expando])return d;var v,S,I,R=d.type,H=d,X=this.fixHooks[R];for(X||(this.fixHooks[R]=X=Ns.test(R)?this.mouseHooks:Rs.test(R)?this.keyHooks:{}),I=X.props?this.props.concat(X.props):this.props,d=new m.Event(H),v=I.length;v--;)S=I[v],d[S]=H[S];return d.target||(d.target=z),d.target.nodeType===3&&(d.target=d.target.parentNode),X.filter?X.filter(d,H):d},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==ie()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===ie()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if(this.type==="checkbox"&&this.click&&m.nodeName(this,"input"))return this.click(),!1},_default:function(d){return m.nodeName(d.target,"a")}},beforeunload:{postDispatch:function(d){d.result!==void 0&&(d.originalEvent.returnValue=d.result)}}},simulate:function(d,v,S,I){var R=m.extend(new m.Event,S,{type:d,isSimulated:!0,originalEvent:{}});I?m.event.trigger(R,null,v):m.event.dispatch.call(v,R),R.isDefaultPrevented()&&S.preventDefault()}},m.removeEvent=function(d,v,S){d.removeEventListener&&d.removeEventListener(v,S,!1)},m.Event=function(d,v){if(!(this instanceof m.Event))return new m.Event(d,v);d&&d.type?(this.originalEvent=d,this.type=d.type,this.isDefaultPrevented=d.defaultPrevented||d.defaultPrevented===void 0&&d.getPreventDefault&&d.getPreventDefault()?b:J):this.type=d,v&&m.extend(this,v),this.timeStamp=d&&d.timeStamp||m.now(),this[m.expando]=!0},m.Event.prototype={isDefaultPrevented:J,isPropagationStopped:J,isImmediatePropagationStopped:J,preventDefault:function(){var d=this.originalEvent;this.isDefaultPrevented=b,d&&d.preventDefault&&d.preventDefault()},stopPropagation:function(){var d=this.originalEvent;this.isPropagationStopped=b,d&&d.stopPropagation&&d.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=b,this.stopPropagation()}},m.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(d,v){m.event.special[d]={delegateType:v,bindType:v,handle:function(S){var I,R=this,H=S.relatedTarget,X=S.handleObj;return(!H||H!==R&&!m.contains(R,H))&&(S.type=X.origType,I=X.handler.apply(this,arguments),S.type=v),I}}}),T.focusinBubbles||m.each({focus:"focusin",blur:"focusout"},function(d,v){var S=function(I){m.event.simulate(v,I.target,m.event.fix(I),!0)};m.event.special[v]={setup:function(){var I=this.ownerDocument||this,R=ot.access(I,v);R||I.addEventListener(d,S,!0),ot.access(I,v,(R||0)+1)},teardown:function(){var I=this.ownerDocument||this,R=ot.access(I,v)-1;R?ot.access(I,v,R):(I.removeEventListener(d,S,!0),ot.remove(I,v))}}}),m.fn.extend({on:function(d,v,S,I,R){var H,X;if(typeof d=="object"){typeof v!="string"&&(S=S||v,v=void 0);for(X in d)this.on(X,v,S,d[X],R);return this}if(S==null&&I==null?(I=v,S=v=void 0):I==null&&(typeof v=="string"?(I=S,S=void 0):(I=S,S=v,v=void 0)),I===!1)I=J;else if(!I)return this;return R===1&&(H=I,I=function(oe){return m().off(oe),H.apply(this,arguments)},I.guid=H.guid||(H.guid=m.guid++)),this.each(function(){m.event.add(this,d,I,S,v)})},one:function(d,v,S,I){return this.on(d,v,S,I,1)},off:function(d,v,S){var I,R;if(d&&d.preventDefault&&d.handleObj)return I=d.handleObj,m(d.delegateTarget).off(I.namespace?I.origType+"."+I.namespace:I.origType,I.selector,I.handler),this;if(typeof d=="object"){for(R in d)this.off(R,v,d[R]);return this}return(v===!1||typeof v=="function")&&(S=v,v=void 0),S===!1&&(S=J),this.each(function(){m.event.remove(this,d,S,v)})},trigger:function(d,v){return this.each(function(){m.event.trigger(d,v,this)})},triggerHandler:function(d,v){var S=this[0];if(S)return m.event.trigger(d,v,S,!0)}});var re=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,ye=/<([\w:]+)/,Xe=/<|&#?\w+;/,Ne=/<(?:script|style|link)/i,Be=/checked\s*(?:[^=]|=\s*.checked.)/i,r=/^$|\/(?:java|ecma)script/i,a=/^true\/(.*)/,l=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,u={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};u.optgroup=u.option,u.tbody=u.tfoot=u.colgroup=u.caption=u.thead,u.th=u.td;function g(d,v){return m.nodeName(d,"table")&&m.nodeName(v.nodeType!==11?v:v.firstChild,"tr")?d.getElementsByTagName("tbody")[0]||d.appendChild(d.ownerDocument.createElement("tbody")):d}function y(d){return d.type=(d.getAttribute("type")!==null)+"/"+d.type,d}function P(d){var v=a.exec(d.type);return v?d.type=v[1]:d.removeAttribute("type"),d}function L(d,v){for(var S=0,I=d.length;S<I;S++)ot.set(d[S],"globalEval",!v||ot.get(v[S],"globalEval"))}function C(d,v){var S,I,R,H,X,oe,Le,ke;if(v.nodeType===1){if(ot.hasData(d)&&(H=ot.access(d),X=ot.set(v,H),ke=H.events,ke)){delete X.handle,X.events={};for(R in ke)for(S=0,I=ke[R].length;S<I;S++)m.event.add(v,R,ke[R][S])}gt.hasData(d)&&(oe=gt.access(d),Le=m.extend({},oe),gt.set(v,Le))}}function x(d,v){var S=d.getElementsByTagName?d.getElementsByTagName(v||"*"):d.querySelectorAll?d.querySelectorAll(v||"*"):[];return v===void 0||v&&m.nodeName(d,v)?m.merge([d],S):S}function k(d,v){var S=v.nodeName.toLowerCase();S==="input"&&jt.test(d.type)?v.checked=d.checked:(S==="input"||S==="textarea")&&(v.defaultValue=d.defaultValue)}m.extend({clone:function(d,v,S){var I,R,H,X,oe=d.cloneNode(!0),Le=m.contains(d.ownerDocument,d);if(!T.noCloneChecked&&(d.nodeType===1||d.nodeType===11)&&!m.isXMLDoc(d))for(X=x(oe),H=x(d),I=0,R=H.length;I<R;I++)k(H[I],X[I]);if(v)if(S)for(H=H||x(d),X=X||x(oe),I=0,R=H.length;I<R;I++)C(H[I],X[I]);else C(d,oe);return X=x(oe,"script"),X.length>0&&L(X,!Le&&x(d,"script")),oe},buildFragment:function(d,v,S,I){for(var R,H,X,oe,Le,ke,De=v.createDocumentFragment(),Ye=[],Ke=0,at=d.length;Ke<at;Ke++)if(R=d[Ke],R||R===0)if(m.type(R)==="object")m.merge(Ye,R.nodeType?[R]:R);else if(!Xe.test(R))Ye.push(v.createTextNode(R));else{for(H=H||De.appendChild(v.createElement("div")),X=(ye.exec(R)||["",""])[1].toLowerCase(),oe=u[X]||u._default,H.innerHTML=oe[1]+R.replace(re,"<$1></$2>")+oe[2],ke=oe[0];ke--;)H=H.lastChild;m.merge(Ye,H.childNodes),H=De.firstChild,H.textContent=""}for(De.textContent="",Ke=0;R=Ye[Ke++];)if(!(I&&m.inArray(R,I)!==-1)&&(Le=m.contains(R.ownerDocument,R),H=x(De.appendChild(R),"script"),Le&&L(H),S))for(ke=0;R=H[ke++];)r.test(R.type||"")&&S.push(R);return De},cleanData:function(d){for(var v,S,I,R,H,X,oe=m.event.special,Le=0;(S=d[Le])!==void 0;Le++){if(m.acceptData(S)&&(H=S[ot.expando],H&&(v=ot.cache[H]))){if(I=Object.keys(v.events||{}),I.length)for(X=0;(R=I[X])!==void 0;X++)oe[R]?m.event.remove(S,R):m.removeEvent(S,R,v.handle);ot.cache[H]&&delete ot.cache[H]}delete gt.cache[S[gt.expando]]}}}),m.fn.extend({text:function(d){return Ot(this,function(v){return v===void 0?m.text(this):this.empty().each(function(){(this.nodeType===1||this.nodeType===11||this.nodeType===9)&&(this.textContent=v)})},null,d,arguments.length)},append:function(){return this.domManip(arguments,function(d){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var v=g(this,d);v.appendChild(d)}})},prepend:function(){return this.domManip(arguments,function(d){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var v=g(this,d);v.insertBefore(d,v.firstChild)}})},before:function(){return this.domManip(arguments,function(d){this.parentNode&&this.parentNode.insertBefore(d,this)})},after:function(){return this.domManip(arguments,function(d){this.parentNode&&this.parentNode.insertBefore(d,this.nextSibling)})},remove:function(d,v){for(var S,I=d?m.filter(d,this):this,R=0;(S=I[R])!=null;R++)!v&&S.nodeType===1&&m.cleanData(x(S)),S.parentNode&&(v&&m.contains(S.ownerDocument,S)&&L(x(S,"script")),S.parentNode.removeChild(S));return this},empty:function(){for(var d,v=0;(d=this[v])!=null;v++)d.nodeType===1&&(m.cleanData(x(d,!1)),d.textContent="");return this},clone:function(d,v){return d=d??!1,v=v??d,this.map(function(){return m.clone(this,d,v)})},html:function(d){return Ot(this,function(v){var S=this[0]||{},I=0,R=this.length;if(v===void 0&&S.nodeType===1)return S.innerHTML;if(typeof v=="string"&&!Ne.test(v)&&!u[(ye.exec(v)||["",""])[1].toLowerCase()]){v=v.replace(re,"<$1></$2>");try{for(;I<R;I++)S=this[I]||{},S.nodeType===1&&(m.cleanData(x(S,!1)),S.innerHTML=v);S=0}catch{}}S&&this.empty().append(v)},null,d,arguments.length)},replaceWith:function(){var d=arguments[0];return this.domManip(arguments,function(v){d=this.parentNode,m.cleanData(x(this)),d&&d.replaceChild(v,this)}),d&&(d.length||d.nodeType)?this:this.remove()},detach:function(d){return this.remove(d,!0)},domManip:function(d,v){d=n.apply([],d);var S,I,R,H,X,oe,Le=0,ke=this.length,De=this,Ye=ke-1,Ke=d[0],at=m.isFunction(Ke);if(at||ke>1&&typeof Ke=="string"&&!T.checkClone&&Be.test(Ke))return this.each(function(At){var ti=De.eq(At);at&&(d[0]=Ke.call(this,At,ti.html())),ti.domManip(d,v)});if(ke&&(S=m.buildFragment(d,this[0].ownerDocument,!1,this),I=S.firstChild,S.childNodes.length===1&&(S=I),I)){for(R=m.map(x(S,"script"),y),H=R.length;Le<ke;Le++)X=S,Le!==Ye&&(X=m.clone(X,!0,!0),H&&m.merge(R,x(X,"script"))),v.call(this[Le],X,Le);if(H)for(oe=R[R.length-1].ownerDocument,m.map(R,P),Le=0;Le<H;Le++)X=R[Le],r.test(X.type||"")&&!ot.access(X,"globalEval")&&m.contains(oe,X)&&(X.src?m._evalUrl&&m._evalUrl(X.src):m.globalEval(X.textContent.replace(l,"")))}return this}}),m.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(d,v){m.fn[d]=function(S){for(var I,R=[],H=m(S),X=H.length-1,oe=0;oe<=X;oe++)I=oe===X?this:this.clone(!0),m(H[oe])[v](I),o.apply(R,I.get());return this.pushStack(R)}});var M,E={};function D(d,v){var S=m(v.createElement(d)).appendTo(v.body),I=e.getDefaultComputedStyle?e.getDefaultComputedStyle(S[0]).display:m.css(S[0],"display");return S.detach(),I}function B(d){var v=z,S=E[d];return S||(S=D(d,v),(S==="none"||!S)&&(M=(M||m("<iframe frameborder='0' width='0' height='0'/>")).appendTo(v.documentElement),v=M[0].contentDocument,v.write(),v.close(),S=D(d,v),M.detach()),E[d]=S),S}var W=/^margin/,q=new RegExp("^("+Oi+")(?!px)[a-z%]+$","i"),F=function(d){return d.ownerDocument.defaultView.getComputedStyle(d,null)};function V(d,v,S){var I,R,H,X,oe=d.style;return S=S||F(d),S&&(X=S.getPropertyValue(v)||S[v]),S&&(X===""&&!m.contains(d.ownerDocument,d)&&(X=m.style(d,v)),q.test(X)&&W.test(v)&&(I=oe.width,R=oe.minWidth,H=oe.maxWidth,oe.minWidth=oe.maxWidth=oe.width=X,X=S.width,oe.width=I,oe.minWidth=R,oe.maxWidth=H)),X!==void 0?X+"":X}function A(d,v){return{get:function(){if(d()){delete this.get;return}return(this.get=v).apply(this,arguments)}}}(function(){var d,v,S="padding:0;margin:0;border:0;display:block;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box",I=z.documentElement,R=z.createElement("div"),H=z.createElement("div");H.style.backgroundClip="content-box",H.cloneNode(!0).style.backgroundClip="",T.clearCloneStyle=H.style.backgroundClip==="content-box",R.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",R.appendChild(H);function X(){H.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%",I.appendChild(R);var oe=e.getComputedStyle(H,null);d=oe.top!=="1%",v=oe.width==="4px",I.removeChild(R)}e.getComputedStyle&&m.extend(T,{pixelPosition:function(){return X(),d},boxSizingReliable:function(){return v==null&&X(),v},reliableMarginRight:function(){var oe,Le=H.appendChild(z.createElement("div"));return Le.style.cssText=H.style.cssText=S,Le.style.marginRight=Le.style.width="0",H.style.width="1px",I.appendChild(R),oe=!parseFloat(e.getComputedStyle(Le,null).marginRight),I.removeChild(R),H.innerHTML="",oe}})})(),m.swap=function(d,v,S,I){var R,H,X={};for(H in v)X[H]=d.style[H],d.style[H]=v[H];R=S.apply(d,I||[]);for(H in v)d.style[H]=X[H];return R};var N=/^(none|table(?!-c[ea]).+)/,G=new RegExp("^("+Oi+")(.*)$","i"),K=new RegExp("^([+-])=("+Oi+")","i"),Z={position:"absolute",visibility:"hidden",display:"block"},ee={letterSpacing:0,fontWeight:400},se=["Webkit","O","Moz","ms"];function ae(d,v){if(v in d)return v;for(var S=v[0].toUpperCase()+v.slice(1),I=v,R=se.length;R--;)if(v=se[R]+S,v in d)return v;return I}function ge(d,v,S){var I=G.exec(v);return I?Math.max(0,I[1]-(S||0))+(I[2]||"px"):v}function ue(d,v,S,I,R){for(var H=S===(I?"border":"content")?4:v==="width"?1:0,X=0;H<4;H+=2)S==="margin"&&(X+=m.css(d,S+St[H],!0,R)),I?(S==="content"&&(X-=m.css(d,"padding"+St[H],!0,R)),S!=="margin"&&(X-=m.css(d,"border"+St[H]+"Width",!0,R))):(X+=m.css(d,"padding"+St[H],!0,R),S!=="padding"&&(X+=m.css(d,"border"+St[H]+"Width",!0,R)));return X}function fe(d,v,S){var I=!0,R=v==="width"?d.offsetWidth:d.offsetHeight,H=F(d),X=m.css(d,"boxSizing",!1,H)==="border-box";if(R<=0||R==null){if(R=V(d,v,H),(R<0||R==null)&&(R=d.style[v]),q.test(R))return R;I=X&&(T.boxSizingReliable()||R===d.style[v]),R=parseFloat(R)||0}return R+ue(d,v,S||(X?"border":"content"),I,H)+"px"}function be(d,v){for(var S,I,R,H=[],X=0,oe=d.length;X<oe;X++)I=d[X],I.style&&(H[X]=ot.get(I,"olddisplay"),S=I.style.display,v?(!H[X]&&S==="none"&&(I.style.display=""),I.style.display===""&&Ht(I)&&(H[X]=ot.access(I,"olddisplay",B(I.nodeName)))):H[X]||(R=Ht(I),(S&&S!=="none"||!R)&&ot.set(I,"olddisplay",R?S:m.css(I,"display"))));for(X=0;X<oe;X++)I=d[X],I.style&&(!v||I.style.display==="none"||I.style.display==="")&&(I.style.display=v?H[X]||"":"none");return d}m.extend({cssHooks:{opacity:{get:function(d,v){if(v){var S=V(d,"opacity");return S===""?"1":S}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(d,v,S,I){if(!(!d||d.nodeType===3||d.nodeType===8||!d.style)){var R,H,X,oe=m.camelCase(v),Le=d.style;if(v=m.cssProps[oe]||(m.cssProps[oe]=ae(Le,oe)),X=m.cssHooks[v]||m.cssHooks[oe],S!==void 0){if(H=typeof S,H==="string"&&(R=K.exec(S))&&(S=(R[1]+1)*R[2]+parseFloat(m.css(d,v)),H="number"),S==null||S!==S)return;H==="number"&&!m.cssNumber[oe]&&(S+="px"),!T.clearCloneStyle&&S===""&&v.indexOf("background")===0&&(Le[v]="inherit"),(!X||!("set"in X)||(S=X.set(d,S,I))!==void 0)&&(Le[v]="",Le[v]=S)}else return X&&"get"in X&&(R=X.get(d,!1,I))!==void 0?R:Le[v]}},css:function(d,v,S,I){var R,H,X,oe=m.camelCase(v);return v=m.cssProps[oe]||(m.cssProps[oe]=ae(d.style,oe)),X=m.cssHooks[v]||m.cssHooks[oe],X&&"get"in X&&(R=X.get(d,!0,S)),R===void 0&&(R=V(d,v,I)),R==="normal"&&v in ee&&(R=ee[v]),S===""||S?(H=parseFloat(R),S===!0||m.isNumeric(H)?H||0:R):R}}),m.each(["height","width"],function(d,v){m.cssHooks[v]={get:function(S,I,R){if(I)return S.offsetWidth===0&&N.test(m.css(S,"display"))?m.swap(S,Z,function(){return fe(S,v,R)}):fe(S,v,R)},set:function(S,I,R){var H=R&&F(S);return ge(S,I,R?ue(S,v,R,m.css(S,"boxSizing",!1,H)==="border-box",H):0)}}}),m.cssHooks.marginRight=A(T.reliableMarginRight,function(d,v){if(v)return m.swap(d,{display:"inline-block"},V,[d,"marginRight"])}),m.each({margin:"",padding:"",border:"Width"},function(d,v){m.cssHooks[d+v]={expand:function(S){for(var I=0,R={},H=typeof S=="string"?S.split(" "):[S];I<4;I++)R[d+St[I]+v]=H[I]||H[I-2]||H[0];return R}},W.test(d)||(m.cssHooks[d+v].set=ge)}),m.fn.extend({css:function(d,v){return Ot(this,function(S,I,R){var H,X,oe={},Le=0;if(m.isArray(I)){for(H=F(S),X=I.length;Le<X;Le++)oe[I[Le]]=m.css(S,I[Le],!1,H);return oe}return R!==void 0?m.style(S,I,R):m.css(S,I)},d,v,arguments.length>1)},show:function(){return be(this,!0)},hide:function(){return be(this)},toggle:function(d){return typeof d=="boolean"?d?this.show():this.hide():this.each(function(){Ht(this)?m(this).show():m(this).hide()})}});function ve(d,v,S,I,R){return new ve.prototype.init(d,v,S,I,R)}m.Tween=ve,ve.prototype={constructor:ve,init:function(d,v,S,I,R,H){this.elem=d,this.prop=S,this.easing=R||"swing",this.options=v,this.start=this.now=this.cur(),this.end=I,this.unit=H||(m.cssNumber[S]?"":"px")},cur:function(){var d=ve.propHooks[this.prop];return d&&d.get?d.get(this):ve.propHooks._default.get(this)},run:function(d){var v,S=ve.propHooks[this.prop];return this.options.duration?this.pos=v=m.easing[this.easing](d,this.options.duration*d,0,1,this.options.duration):this.pos=v=d,this.now=(this.end-this.start)*v+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),S&&S.set?S.set(this):ve.propHooks._default.set(this),this}},ve.prototype.init.prototype=ve.prototype,ve.propHooks={_default:{get:function(d){var v;return d.elem[d.prop]!=null&&(!d.elem.style||d.elem.style[d.prop]==null)?d.elem[d.prop]:(v=m.css(d.elem,d.prop,""),!v||v==="auto"?0:v)},set:function(d){m.fx.step[d.prop]?m.fx.step[d.prop](d):d.elem.style&&(d.elem.style[m.cssProps[d.prop]]!=null||m.cssHooks[d.prop])?m.style(d.elem,d.prop,d.now+d.unit):d.elem[d.prop]=d.now}}},ve.propHooks.scrollTop=ve.propHooks.scrollLeft={set:function(d){d.elem.nodeType&&d.elem.parentNode&&(d.elem[d.prop]=d.now)}},m.easing={linear:function(d){return d},swing:function(d){return .5-Math.cos(d*Math.PI)/2}},m.fx=ve.prototype.init,m.fx.step={};var Ce,Ae,je=/^(?:toggle|show|hide)$/,et=new RegExp("^(?:([+-])=|)("+Oi+")([a-z%]*)$","i"),it=/queueHooks$/,yt=[bt],dt={"*":[function(d,v){var S=this.createTween(d,v),I=S.cur(),R=et.exec(v),H=R&&R[3]||(m.cssNumber[d]?"":"px"),X=(m.cssNumber[d]||H!=="px"&&+I)&&et.exec(m.css(S.elem,d)),oe=1,Le=20;if(X&&X[3]!==H){H=H||X[3],R=R||[],X=+I||1;do oe=oe||".5",X=X/oe,m.style(S.elem,d,X+H);while(oe!==(oe=S.cur()/I)&&oe!==1&&--Le)}return R&&(X=S.start=+X||+I||0,S.unit=H,S.end=R[1]?X+(R[1]+1)*R[2]:+R[2]),S}]};function pt(){return setTimeout(function(){Ce=void 0}),Ce=m.now()}function ut(d,v){var S,I=0,R={height:d};for(v=v?1:0;I<4;I+=2-v)S=St[I],R["margin"+S]=R["padding"+S]=d;return v&&(R.opacity=R.width=d),R}function xt(d,v,S){for(var I,R=(dt[v]||[]).concat(dt["*"]),H=0,X=R.length;H<X;H++)if(I=R[H].call(S,v,d))return I}function bt(d,v,S){var I,R,H,X,oe,Le,ke,De=this,Ye={},Ke=d.style,at=d.nodeType&&Ht(d),At=ot.get(d,"fxshow");S.queue||(oe=m._queueHooks(d,"fx"),oe.unqueued==null&&(oe.unqueued=0,Le=oe.empty.fire,oe.empty.fire=function(){oe.unqueued||Le()}),oe.unqueued++,De.always(function(){De.always(function(){oe.unqueued--,m.queue(d,"fx").length||oe.empty.fire()})})),d.nodeType===1&&("height"in v||"width"in v)&&(S.overflow=[Ke.overflow,Ke.overflowX,Ke.overflowY],ke=m.css(d,"display"),ke==="none"&&(ke=B(d.nodeName)),ke==="inline"&&m.css(d,"float")==="none"&&(Ke.display="inline-block")),S.overflow&&(Ke.overflow="hidden",De.always(function(){Ke.overflow=S.overflow[0],Ke.overflowX=S.overflow[1],Ke.overflowY=S.overflow[2]}));for(I in v)if(R=v[I],je.exec(R)){if(delete v[I],H=H||R==="toggle",R===(at?"hide":"show"))if(R==="show"&&At&&At[I]!==void 0)at=!0;else continue;Ye[I]=At&&At[I]||m.style(d,I)}if(!m.isEmptyObject(Ye)){At?"hidden"in At&&(at=At.hidden):At=ot.access(d,"fxshow",{}),H&&(At.hidden=!at),at?m(d).show():De.done(function(){m(d).hide()}),De.done(function(){var ti;ot.remove(d,"fxshow");for(ti in Ye)m.style(d,ti,Ye[ti])});for(I in Ye)X=xt(at?At[I]:0,I,De),I in At||(At[I]=X.start,at&&(X.end=X.start,X.start=I==="width"||I==="height"?1:0))}}function gi(d,v){var S,I,R,H,X;for(S in d)if(I=m.camelCase(S),R=v[I],H=d[S],m.isArray(H)&&(R=H[1],H=d[S]=H[0]),S!==I&&(d[I]=H,delete d[S]),X=m.cssHooks[I],X&&"expand"in X){H=X.expand(H),delete d[I];for(S in H)S in d||(d[S]=H[S],v[S]=R)}else v[I]=R}function zt(d,v,S){var I,R,H=0,X=yt.length,oe=m.Deferred().always(function(){delete Le.elem}),Le=function(){if(R)return!1;for(var Ye=Ce||pt(),Ke=Math.max(0,ke.startTime+ke.duration-Ye),at=Ke/ke.duration||0,At=1-at,ti=0,Mi=ke.tweens.length;ti<Mi;ti++)ke.tweens[ti].run(At);return oe.notifyWith(d,[ke,At,Ke]),At<1&&Mi?Ke:(oe.resolveWith(d,[ke]),!1)},ke=oe.promise({elem:d,props:m.extend({},v),opts:m.extend(!0,{specialEasing:{}},S),originalProperties:v,originalOptions:S,startTime:Ce||pt(),duration:S.duration,tweens:[],createTween:function(Ye,Ke){var at=m.Tween(d,ke.opts,Ye,Ke,ke.opts.specialEasing[Ye]||ke.opts.easing);return ke.tweens.push(at),at},stop:function(Ye){var Ke=0,at=Ye?ke.tweens.length:0;if(R)return this;for(R=!0;Ke<at;Ke++)ke.tweens[Ke].run(1);return Ye?oe.resolveWith(d,[ke,Ye]):oe.rejectWith(d,[ke,Ye]),this}}),De=ke.props;for(gi(De,ke.opts.specialEasing);H<X;H++)if(I=yt[H].call(ke,d,De,ke.opts),I)return I;return m.map(De,xt,ke),m.isFunction(ke.opts.start)&&ke.opts.start.call(d,ke),m.fx.timer(m.extend(Le,{elem:d,anim:ke,queue:ke.opts.queue})),ke.progress(ke.opts.progress).done(ke.opts.done,ke.opts.complete).fail(ke.opts.fail).always(ke.opts.always)}m.Animation=m.extend(zt,{tweener:function(d,v){m.isFunction(d)?(v=d,d=["*"]):d=d.split(" ");for(var S,I=0,R=d.length;I<R;I++)S=d[I],dt[S]=dt[S]||[],dt[S].unshift(v)},prefilter:function(d,v){v?yt.unshift(d):yt.push(d)}}),m.speed=function(d,v,S){var I=d&&typeof d=="object"?m.extend({},d):{complete:S||!S&&v||m.isFunction(d)&&d,duration:d,easing:S&&v||v&&!m.isFunction(v)&&v};return I.duration=m.fx.off?0:typeof I.duration=="number"?I.duration:I.duration in m.fx.speeds?m.fx.speeds[I.duration]:m.fx.speeds._default,(I.queue==null||I.queue===!0)&&(I.queue="fx"),I.old=I.complete,I.complete=function(){m.isFunction(I.old)&&I.old.call(this),I.queue&&m.dequeue(this,I.queue)},I},m.fn.extend({fadeTo:function(d,v,S,I){return this.filter(Ht).css("opacity",0).show().end().animate({opacity:v},d,S,I)},animate:function(d,v,S,I){var R=m.isEmptyObject(d),H=m.speed(v,S,I),X=function(){var oe=zt(this,m.extend({},d),H);(R||ot.get(this,"finish"))&&oe.stop(!0)};return X.finish=X,R||H.queue===!1?this.each(X):this.queue(H.queue,X)},stop:function(d,v,S){var I=function(R){var H=R.stop;delete R.stop,H(S)};return typeof d!="string"&&(S=v,v=d,d=void 0),v&&d!==!1&&this.queue(d||"fx",[]),this.each(function(){var R=!0,H=d!=null&&d+"queueHooks",X=m.timers,oe=ot.get(this);if(H)oe[H]&&oe[H].stop&&I(oe[H]);else for(H in oe)oe[H]&&oe[H].stop&&it.test(H)&&I(oe[H]);for(H=X.length;H--;)X[H].elem===this&&(d==null||X[H].queue===d)&&(X[H].anim.stop(S),R=!1,X.splice(H,1));(R||!S)&&m.dequeue(this,d)})},finish:function(d){return d!==!1&&(d=d||"fx"),this.each(function(){var v,S=ot.get(this),I=S[d+"queue"],R=S[d+"queueHooks"],H=m.timers,X=I?I.length:0;for(S.finish=!0,m.queue(this,d,[]),R&&R.stop&&R.stop.call(this,!0),v=H.length;v--;)H[v].elem===this&&H[v].queue===d&&(H[v].anim.stop(!0),H.splice(v,1));for(v=0;v<X;v++)I[v]&&I[v].finish&&I[v].finish.call(this);delete S.finish})}}),m.each(["toggle","show","hide"],function(d,v){var S=m.fn[v];m.fn[v]=function(I,R,H){return I==null||typeof I=="boolean"?S.apply(this,arguments):this.animate(ut(v,!0),I,R,H)}}),m.each({slideDown:ut("show"),slideUp:ut("hide"),slideToggle:ut("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(d,v){m.fn[d]=function(S,I,R){return this.animate(v,S,I,R)}}),m.timers=[],m.fx.tick=function(){var d,v=0,S=m.timers;for(Ce=m.now();v<S.length;v++)d=S[v],!d()&&S[v]===d&&S.splice(v--,1);S.length||m.fx.stop(),Ce=void 0},m.fx.timer=function(d){m.timers.push(d),d()?m.fx.start():m.timers.pop()},m.fx.interval=13,m.fx.start=function(){Ae||(Ae=setInterval(m.fx.tick,m.fx.interval))},m.fx.stop=function(){clearInterval(Ae),Ae=null},m.fx.speeds={slow:600,fast:200,_default:400},m.fn.delay=function(d,v){return d=m.fx&&m.fx.speeds[d]||d,v=v||"fx",this.queue(v,function(S,I){var R=setTimeout(S,d);I.stop=function(){clearTimeout(R)}})},function(){var d=z.createElement("input"),v=z.createElement("select"),S=v.appendChild(z.createElement("option"));d.type="checkbox",T.checkOn=d.value!=="",T.optSelected=S.selected,v.disabled=!0,T.optDisabled=!S.disabled,d=z.createElement("input"),d.value="t",d.type="radio",T.radioValue=d.value==="t"}();var Jt,ei,Bt=m.expr.attrHandle;m.fn.extend({attr:function(d,v){return Ot(this,m.attr,d,v,arguments.length>1)},removeAttr:function(d){return this.each(function(){m.removeAttr(this,d)})}}),m.extend({attr:function(d,v,S){var I,R,H=d.nodeType;if(!(!d||H===3||H===8||H===2)){if(typeof d.getAttribute===lt)return m.prop(d,v,S);if((H!==1||!m.isXMLDoc(d))&&(v=v.toLowerCase(),I=m.attrHooks[v]||(m.expr.match.bool.test(v)?ei:Jt)),S!==void 0)if(S===null)m.removeAttr(d,v);else return I&&"set"in I&&(R=I.set(d,S,v))!==void 0?R:(d.setAttribute(v,S+""),S);else return I&&"get"in I&&(R=I.get(d,v))!==null?R:(R=m.find.attr(d,v),R??void 0)}},removeAttr:function(d,v){var S,I,R=0,H=v&&v.match(Ie);if(H&&d.nodeType===1)for(;S=H[R++];)I=m.propFix[S]||S,m.expr.match.bool.test(S)&&(d[I]=!1),d.removeAttribute(S)},attrHooks:{type:{set:function(d,v){if(!T.radioValue&&v==="radio"&&m.nodeName(d,"input")){var S=d.value;return d.setAttribute("type",v),S&&(d.value=S),v}}}}}),ei={set:function(d,v,S){return v===!1?m.removeAttr(d,S):d.setAttribute(S,S),S}},m.each(m.expr.match.bool.source.match(/\w+/g),function(d,v){var S=Bt[v]||m.find.attr;Bt[v]=function(I,R,H){var X,oe;return H||(oe=Bt[R],Bt[R]=X,X=S(I,R,H)!=null?R.toLowerCase():null,Bt[R]=oe),X}});var fs=/^(?:input|select|textarea|button)$/i;m.fn.extend({prop:function(d,v){return Ot(this,m.prop,d,v,arguments.length>1)},removeProp:function(d){return this.each(function(){delete this[m.propFix[d]||d]})}}),m.extend({propFix:{for:"htmlFor",class:"className"},prop:function(d,v,S){var I,R,H,X=d.nodeType;if(!(!d||X===3||X===8||X===2))return H=X!==1||!m.isXMLDoc(d),H&&(v=m.propFix[v]||v,R=m.propHooks[v]),S!==void 0?R&&"set"in R&&(I=R.set(d,S,v))!==void 0?I:d[v]=S:R&&"get"in R&&(I=R.get(d,v))!==null?I:d[v]},propHooks:{tabIndex:{get:function(d){return d.hasAttribute("tabindex")||fs.test(d.nodeName)||d.href?d.tabIndex:-1}}}}),T.optSelected||(m.propHooks.selected={get:function(d){var v=d.parentNode;return v&&v.parentNode&&v.parentNode.selectedIndex,null}}),m.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){m.propFix[this.toLowerCase()]=this});var rs=/[\t\r\n\f]/g;m.fn.extend({addClass:function(d){var v,S,I,R,H,X,oe=typeof d=="string"&&d,Le=0,ke=this.length;if(m.isFunction(d))return this.each(function(De){m(this).addClass(d.call(this,De,this.className))});if(oe){for(v=(d||"").match(Ie)||[];Le<ke;Le++)if(S=this[Le],I=S.nodeType===1&&(S.className?(" "+S.className+" ").replace(rs," "):" "),I){for(H=0;R=v[H++];)I.indexOf(" "+R+" ")<0&&(I+=R+" ");X=m.trim(I),S.className!==X&&(S.className=X)}}return this},removeClass:function(d){var v,S,I,R,H,X,oe=arguments.length===0||typeof d=="string"&&d,Le=0,ke=this.length;if(m.isFunction(d))return this.each(function(De){m(this).removeClass(d.call(this,De,this.className))});if(oe){for(v=(d||"").match(Ie)||[];Le<ke;Le++)if(S=this[Le],I=S.nodeType===1&&(S.className?(" "+S.className+" ").replace(rs," "):""),I){for(H=0;R=v[H++];)for(;I.indexOf(" "+R+" ")>=0;)I=I.replace(" "+R+" "," ");X=d?m.trim(I):"",S.className!==X&&(S.className=X)}}return this},toggleClass:function(d,v){var S=typeof d;return typeof v=="boolean"&&S==="string"?v?this.addClass(d):this.removeClass(d):m.isFunction(d)?this.each(function(I){m(this).toggleClass(d.call(this,I,this.className,v),v)}):this.each(function(){if(S==="string")for(var I,R=0,H=m(this),X=d.match(Ie)||[];I=X[R++];)H.hasClass(I)?H.removeClass(I):H.addClass(I);else(S===lt||S==="boolean")&&(this.className&&ot.set(this,"__className__",this.className),this.className=this.className||d===!1?"":ot.get(this,"__className__")||"")})},hasClass:function(d){for(var v=" "+d+" ",S=0,I=this.length;S<I;S++)if(this[S].nodeType===1&&(" "+this[S].className+" ").replace(rs," ").indexOf(v)>=0)return!0;return!1}});var Ps=/\r/g;m.fn.extend({val:function(d){var v,S,I,R=this[0];return arguments.length?(I=m.isFunction(d),this.each(function(H){var X;this.nodeType===1&&(I?X=d.call(this,H,m(this).val()):X=d,X==null?X="":typeof X=="number"?X+="":m.isArray(X)&&(X=m.map(X,function(oe){return oe==null?"":oe+""})),v=m.valHooks[this.type]||m.valHooks[this.nodeName.toLowerCase()],(!v||!("set"in v)||v.set(this,X,"value")===void 0)&&(this.value=X))})):R?(v=m.valHooks[R.type]||m.valHooks[R.nodeName.toLowerCase()],v&&"get"in v&&(S=v.get(R,"value"))!==void 0?S:(S=R.value,typeof S=="string"?S.replace(Ps,""):S??"")):void 0}}),m.extend({valHooks:{select:{get:function(d){for(var v,S,I=d.options,R=d.selectedIndex,H=d.type==="select-one"||R<0,X=H?null:[],oe=H?R+1:I.length,Le=R<0?oe:H?R:0;Le<oe;Le++)if(S=I[Le],(S.selected||Le===R)&&(T.optDisabled?!S.disabled:S.getAttribute("disabled")===null)&&(!S.parentNode.disabled||!m.nodeName(S.parentNode,"optgroup"))){if(v=m(S).val(),H)return v;X.push(v)}return X},set:function(d,v){for(var S,I,R=d.options,H=m.makeArray(v),X=R.length;X--;)I=R[X],(I.selected=m.inArray(m(I).val(),H)>=0)&&(S=!0);return S||(d.selectedIndex=-1),H}}}}),m.each(["radio","checkbox"],function(){m.valHooks[this]={set:function(d,v){if(m.isArray(v))return d.checked=m.inArray(m(d).val(),v)>=0}},T.checkOn||(m.valHooks[this].get=function(d){return d.getAttribute("value")===null?"on":d.value})}),m.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(d,v){m.fn[v]=function(S,I){return arguments.length>0?this.on(v,null,S,I):this.trigger(v)}}),m.fn.extend({hover:function(d,v){return this.mouseenter(d).mouseleave(v||d)},bind:function(d,v,S){return this.on(d,null,v,S)},unbind:function(d,v){return this.off(d,null,v)},delegate:function(d,v,S,I){return this.on(v,d,S,I)},undelegate:function(d,v,S){return arguments.length===1?this.off(d,"**"):this.off(v,d||"**",S)}});var Xi=m.now(),bi=/\?/;m.parseJSON=function(d){return JSON.parse(d+"")},m.parseXML=function(d){var v,S;if(!d||typeof d!="string")return null;try{S=new DOMParser,v=S.parseFromString(d,"text/xml")}catch{v=void 0}return(!v||v.getElementsByTagName("parsererror").length)&&m.error("Invalid XML: "+d),v};var Ei,as,ms=/#.*$/,_n=/([?&])_=[^&]*/,qr=/^(.*?):[ \t]*([^\r\n]*)$/mg,On=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Xn=/^(?:GET|HEAD)$/,Qs=/^\/\//,Zs=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Xr={},vn={},Nl="*/".concat("*");try{as=location.href}catch{as=z.createElement("a"),as.href="",as=as.href}Ei=Zs.exec(as.toLowerCase())||[];function pg(d){return function(v,S){typeof v!="string"&&(S=v,v="*");var I,R=0,H=v.toLowerCase().match(Ie)||[];if(m.isFunction(S))for(;I=H[R++];)I[0]==="+"?(I=I.slice(1)||"*",(d[I]=d[I]||[]).unshift(S)):(d[I]=d[I]||[]).push(S)}}function fg(d,v,S,I){var R={},H=d===vn;function X(oe){var Le;return R[oe]=!0,m.each(d[oe]||[],function(ke,De){var Ye=De(v,S,I);if(typeof Ye=="string"&&!H&&!R[Ye])return v.dataTypes.unshift(Ye),X(Ye),!1;if(H)return!(Le=Ye)}),Le}return X(v.dataTypes[0])||!R["*"]&&X("*")}function tc(d,v){var S,I,R=m.ajaxSettings.flatOptions||{};for(S in v)v[S]!==void 0&&((R[S]?d:I||(I={}))[S]=v[S]);return I&&m.extend(!0,d,I),d}function Gy(d,v,S){for(var I,R,H,X,oe=d.contents,Le=d.dataTypes;Le[0]==="*";)Le.shift(),I===void 0&&(I=d.mimeType||v.getResponseHeader("Content-Type"));if(I){for(R in oe)if(oe[R]&&oe[R].test(I)){Le.unshift(R);break}}if(Le[0]in S)H=Le[0];else{for(R in S){if(!Le[0]||d.converters[R+" "+Le[0]]){H=R;break}X||(X=R)}H=H||X}if(H)return H!==Le[0]&&Le.unshift(H),S[H]}function Wy(d,v,S,I){var R,H,X,oe,Le,ke={},De=d.dataTypes.slice();if(De[1])for(X in d.converters)ke[X.toLowerCase()]=d.converters[X];for(H=De.shift();H;)if(d.responseFields[H]&&(S[d.responseFields[H]]=v),!Le&&I&&d.dataFilter&&(v=d.dataFilter(v,d.dataType)),Le=H,H=De.shift(),H){if(H==="*")H=Le;else if(Le!=="*"&&Le!==H){if(X=ke[Le+" "+H]||ke["* "+H],!X){for(R in ke)if(oe=R.split(" "),oe[1]===H&&(X=ke[Le+" "+oe[0]]||ke["* "+oe[0]],X)){X===!0?X=ke[R]:ke[R]!==!0&&(H=oe[0],De.unshift(oe[1]));break}}if(X!==!0)if(X&&d.throws)v=X(v);else try{v=X(v)}catch(Ye){return{state:"parsererror",error:X?Ye:"No conversion from "+Le+" to "+H}}}}return{state:"success",data:v}}m.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:as,type:"GET",isLocal:On.test(Ei[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Nl,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":m.parseJSON,"text xml":m.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(d,v){return v?tc(tc(d,m.ajaxSettings),v):tc(m.ajaxSettings,d)},ajaxPrefilter:pg(Xr),ajaxTransport:pg(vn),ajax:function(d,v){typeof d=="object"&&(v=d,d=void 0),v=v||{};var S,I,R,H,X,oe,Le,ke,De=m.ajaxSetup({},v),Ye=De.context||De,Ke=De.context&&(Ye.nodeType||Ye.jquery)?m(Ye):m.event,at=m.Deferred(),At=m.Callbacks("once memory"),ti=De.statusCode||{},Mi={},Mn={},pi=0,$s="canceled",Et={readyState:0,getResponseHeader:function(fi){var ji;if(pi===2){if(!H)for(H={};ji=qr.exec(R);)H[ji[1].toLowerCase()]=ji[2];ji=H[fi.toLowerCase()]}return ji??null},getAllResponseHeaders:function(){return pi===2?R:null},setRequestHeader:function(fi,ji){var gr=fi.toLowerCase();return pi||(fi=Mn[gr]=Mn[gr]||fi,Mi[fi]=ji),this},overrideMimeType:function(fi){return pi||(De.mimeType=fi),this},statusCode:function(fi){var ji;if(fi)if(pi<2)for(ji in fi)ti[ji]=[ti[ji],fi[ji]];else Et.always(fi[Et.status]);return this},abort:function(fi){var ji=fi||$s;return S&&S.abort(ji),La(0,ji),this}};if(at.promise(Et).complete=At.add,Et.success=Et.done,Et.error=Et.fail,De.url=((d||De.url||as)+"").replace(ms,"").replace(Qs,Ei[1]+"//"),De.type=v.method||v.type||De.method||De.type,De.dataTypes=m.trim(De.dataType||"*").toLowerCase().match(Ie)||[""],De.crossDomain==null&&(oe=Zs.exec(De.url.toLowerCase()),De.crossDomain=!!(oe&&(oe[1]!==Ei[1]||oe[2]!==Ei[2]||(oe[3]||(oe[1]==="http:"?"80":"443"))!==(Ei[3]||(Ei[1]==="http:"?"80":"443"))))),De.data&&De.processData&&typeof De.data!="string"&&(De.data=m.param(De.data,De.traditional)),fg(Xr,De,v,Et),pi===2)return Et;Le=De.global,Le&&m.active++===0&&m.event.trigger("ajaxStart"),De.type=De.type.toUpperCase(),De.hasContent=!Xn.test(De.type),I=De.url,De.hasContent||(De.data&&(I=De.url+=(bi.test(I)?"&":"?")+De.data,delete De.data),De.cache===!1&&(De.url=_n.test(I)?I.replace(_n,"$1_="+Xi++):I+(bi.test(I)?"&":"?")+"_="+Xi++)),De.ifModified&&(m.lastModified[I]&&Et.setRequestHeader("If-Modified-Since",m.lastModified[I]),m.etag[I]&&Et.setRequestHeader("If-None-Match",m.etag[I])),(De.data&&De.hasContent&&De.contentType!==!1||v.contentType)&&Et.setRequestHeader("Content-Type",De.contentType),Et.setRequestHeader("Accept",De.dataTypes[0]&&De.accepts[De.dataTypes[0]]?De.accepts[De.dataTypes[0]]+(De.dataTypes[0]!=="*"?", "+Nl+"; q=0.01":""):De.accepts["*"]);for(ke in De.headers)Et.setRequestHeader(ke,De.headers[ke]);if(De.beforeSend&&(De.beforeSend.call(Ye,Et,De)===!1||pi===2))return Et.abort();$s="abort";for(ke in{success:1,error:1,complete:1})Et[ke](De[ke]);if(S=fg(vn,De,v,Et),!S)La(-1,"No Transport");else{Et.readyState=1,Le&&Ke.trigger("ajaxSend",[Et,De]),De.async&&De.timeout>0&&(X=setTimeout(function(){Et.abort("timeout")},De.timeout));try{pi=1,S.send(Mi,La)}catch(fi){if(pi<2)La(-1,fi);else throw fi}}function La(fi,ji,gr,go){var Gs,Pa,jr,Bs,pr,ln=ji;pi!==2&&(pi=2,X&&clearTimeout(X),S=void 0,R=go||"",Et.readyState=fi>0?4:0,Gs=fi>=200&&fi<300||fi===304,gr&&(Bs=Gy(De,Et,gr)),Bs=Wy(De,Bs,Et,Gs),Gs?(De.ifModified&&(pr=Et.getResponseHeader("Last-Modified"),pr&&(m.lastModified[I]=pr),pr=Et.getResponseHeader("etag"),pr&&(m.etag[I]=pr)),fi===204||De.type==="HEAD"?ln="nocontent":fi===304?ln="notmodified":(ln=Bs.state,Pa=Bs.data,jr=Bs.error,Gs=!jr)):(jr=ln,(fi||!ln)&&(ln="error",fi<0&&(fi=0))),Et.status=fi,Et.statusText=(ji||ln)+"",Gs?at.resolveWith(Ye,[Pa,ln,Et]):at.rejectWith(Ye,[Et,ln,jr]),Et.statusCode(ti),ti=void 0,Le&&Ke.trigger(Gs?"ajaxSuccess":"ajaxError",[Et,De,Gs?Pa:jr]),At.fireWith(Ye,[Et,ln]),Le&&(Ke.trigger("ajaxComplete",[Et,De]),--m.active||m.event.trigger("ajaxStop")))}return Et},getJSON:function(d,v,S){return m.get(d,v,S,"json")},getScript:function(d,v){return m.get(d,void 0,v,"script")}}),m.each(["get","post"],function(d,v){m[v]=function(S,I,R,H){return m.isFunction(I)&&(H=H||R,R=I,I=void 0),m.ajax({url:S,type:v,dataType:H,data:I,success:R})}}),m.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(d,v){m.fn[v]=function(S){return this.on(v,S)}}),m._evalUrl=function(d){return m.ajax({url:d,type:"GET",dataType:"script",async:!1,global:!1,throws:!0})},m.fn.extend({wrapAll:function(d){var v;return m.isFunction(d)?this.each(function(S){m(this).wrapAll(d.call(this,S))}):(this[0]&&(v=m(d,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&v.insertBefore(this[0]),v.map(function(){for(var S=this;S.firstElementChild;)S=S.firstElementChild;return S}).append(this)),this)},wrapInner:function(d){return m.isFunction(d)?this.each(function(v){m(this).wrapInner(d.call(this,v))}):this.each(function(){var v=m(this),S=v.contents();S.length?S.wrapAll(d):v.append(d)})},wrap:function(d){var v=m.isFunction(d);return this.each(function(S){m(this).wrapAll(v?d.call(this,S):d)})},unwrap:function(){return this.parent().each(function(){m.nodeName(this,"body")||m(this).replaceWith(this.childNodes)}).end()}}),m.expr.filters.hidden=function(d){return d.offsetWidth<=0&&d.offsetHeight<=0},m.expr.filters.visible=function(d){return!m.expr.filters.hidden(d)};var Uy=/%20/g,Yy=/\[\]$/,mg=/\r?\n/g,Ky=/^(?:submit|button|image|reset|file)$/i,qy=/^(?:input|select|textarea|keygen)/i;function ic(d,v,S,I){var R;if(m.isArray(v))m.each(v,function(H,X){S||Yy.test(d)?I(d,X):ic(d+"["+(typeof X=="object"?H:"")+"]",X,S,I)});else if(!S&&m.type(v)==="object")for(R in v)ic(d+"["+R+"]",v[R],S,I);else I(d,v)}m.param=function(d,v){var S,I=[],R=function(H,X){X=m.isFunction(X)?X():X??"",I[I.length]=encodeURIComponent(H)+"="+encodeURIComponent(X)};if(v===void 0&&(v=m.ajaxSettings&&m.ajaxSettings.traditional),m.isArray(d)||d.jquery&&!m.isPlainObject(d))m.each(d,function(){R(this.name,this.value)});else for(S in d)ic(S,d[S],v,R);return I.join("&").replace(Uy,"+")},m.fn.extend({serialize:function(){return m.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var d=m.prop(this,"elements");return d?m.makeArray(d):this}).filter(function(){var d=this.type;return this.name&&!m(this).is(":disabled")&&qy.test(this.nodeName)&&!Ky.test(d)&&(this.checked||!jt.test(d))}).map(function(d,v){var S=m(this).val();return S==null?null:m.isArray(S)?m.map(S,function(I){return{name:v.name,value:I.replace(mg,`\r
`)}}):{name:v.name,value:S.replace(mg,`\r
`)}}).get()}}),m.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch{}};var Xy=0,Bl={},jy={0:200,1223:204},uo=m.ajaxSettings.xhr();e.ActiveXObject&&m(e).on("unload",function(){for(var d in Bl)Bl[d]()}),T.cors=!!uo&&"withCredentials"in uo,T.ajax=uo=!!uo,m.ajaxTransport(function(d){var v;if(T.cors||uo&&!d.crossDomain)return{send:function(S,I){var R,H=d.xhr(),X=++Xy;if(H.open(d.type,d.url,d.async,d.username,d.password),d.xhrFields)for(R in d.xhrFields)H[R]=d.xhrFields[R];d.mimeType&&H.overrideMimeType&&H.overrideMimeType(d.mimeType),!d.crossDomain&&!S["X-Requested-With"]&&(S["X-Requested-With"]="XMLHttpRequest");for(R in S)H.setRequestHeader(R,S[R]);v=function(oe){return function(){v&&(delete Bl[X],v=H.onload=H.onerror=null,oe==="abort"?H.abort():oe==="error"?I(H.status,H.statusText):I(jy[H.status]||H.status,H.statusText,typeof H.responseText=="string"?{text:H.responseText}:void 0,H.getAllResponseHeaders()))}},H.onload=v(),H.onerror=v("error"),v=Bl[X]=v("abort"),H.send(d.hasContent&&d.data||null)},abort:function(){v&&v()}}}),m.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(d){return m.globalEval(d),d}}}),m.ajaxPrefilter("script",function(d){d.cache===void 0&&(d.cache=!1),d.crossDomain&&(d.type="GET")}),m.ajaxTransport("script",function(d){if(d.crossDomain){var v,S;return{send:function(I,R){v=m("<script>").prop({async:!0,charset:d.scriptCharset,src:d.url}).on("load error",S=function(H){v.remove(),S=null,H&&R(H.type==="error"?404:200,H.type)}),z.head.appendChild(v[0])},abort:function(){S&&S()}}}});var yg=[],sc=/(=)\?(?=&|$)|\?\?/;m.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var d=yg.pop()||m.expando+"_"+Xi++;return this[d]=!0,d}}),m.ajaxPrefilter("json jsonp",function(d,v,S){var I,R,H,X=d.jsonp!==!1&&(sc.test(d.url)?"url":typeof d.data=="string"&&!(d.contentType||"").indexOf("application/x-www-form-urlencoded")&&sc.test(d.data)&&"data");if(X||d.dataTypes[0]==="jsonp")return I=d.jsonpCallback=m.isFunction(d.jsonpCallback)?d.jsonpCallback():d.jsonpCallback,X?d[X]=d[X].replace(sc,"$1"+I):d.jsonp!==!1&&(d.url+=(bi.test(d.url)?"&":"?")+d.jsonp+"="+I),d.converters["script json"]=function(){return H||m.error(I+" was not called"),H[0]},d.dataTypes[0]="json",R=e[I],e[I]=function(){H=arguments},S.always(function(){e[I]=R,d[I]&&(d.jsonpCallback=v.jsonpCallback,yg.push(I)),H&&m.isFunction(R)&&R(H[0]),H=R=void 0}),"script"}),m.parseHTML=function(d,v,S){if(!d||typeof d!="string")return null;typeof v=="boolean"&&(S=v,v=!1),v=v||z;var I=me.exec(d),R=!S&&[];return I?[v.createElement(I[1])]:(I=m.buildFragment([d],v,R),R&&R.length&&m(R).remove(),m.merge([],I.childNodes))};var bg=m.fn.load;m.fn.load=function(d,v,S){if(typeof d!="string"&&bg)return bg.apply(this,arguments);var I,R,H,X=this,oe=d.indexOf(" ");return oe>=0&&(I=d.slice(oe),d=d.slice(0,oe)),m.isFunction(v)?(S=v,v=void 0):v&&typeof v=="object"&&(R="POST"),X.length>0&&m.ajax({url:d,type:R,dataType:"html",data:v}).done(function(Le){H=arguments,X.html(I?m("<div>").append(m.parseHTML(Le)).find(I):Le)}).complete(S&&function(Le,ke){X.each(S,H||[Le.responseText,ke,Le])}),this},m.expr.filters.animated=function(d){return m.grep(m.timers,function(v){return d===v.elem}).length};var _g=e.document.documentElement;function vg(d){return m.isWindow(d)?d:d.nodeType===9&&d.defaultView}m.offset={setOffset:function(d,v,S){var I,R,H,X,oe,Le,ke,De=m.css(d,"position"),Ye=m(d),Ke={};De==="static"&&(d.style.position="relative"),oe=Ye.offset(),H=m.css(d,"top"),Le=m.css(d,"left"),ke=(De==="absolute"||De==="fixed")&&(H+Le).indexOf("auto")>-1,ke?(I=Ye.position(),X=I.top,R=I.left):(X=parseFloat(H)||0,R=parseFloat(Le)||0),m.isFunction(v)&&(v=v.call(d,S,oe)),v.top!=null&&(Ke.top=v.top-oe.top+X),v.left!=null&&(Ke.left=v.left-oe.left+R),"using"in v?v.using.call(d,Ke):Ye.css(Ke)}},m.fn.extend({offset:function(d){if(arguments.length)return d===void 0?this:this.each(function(X){m.offset.setOffset(this,d,X)});var v,S,I=this[0],R={top:0,left:0},H=I&&I.ownerDocument;if(H)return v=H.documentElement,m.contains(v,I)?(typeof I.getBoundingClientRect!==lt&&(R=I.getBoundingClientRect()),S=vg(H),{top:R.top+S.pageYOffset-v.clientTop,left:R.left+S.pageXOffset-v.clientLeft}):R},position:function(){if(this[0]){var d,v,S=this[0],I={top:0,left:0};return m.css(S,"position")==="fixed"?v=S.getBoundingClientRect():(d=this.offsetParent(),v=this.offset(),m.nodeName(d[0],"html")||(I=d.offset()),I.top+=m.css(d[0],"borderTopWidth",!0),I.left+=m.css(d[0],"borderLeftWidth",!0)),{top:v.top-I.top-m.css(S,"marginTop",!0),left:v.left-I.left-m.css(S,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var d=this.offsetParent||_g;d&&!m.nodeName(d,"html")&&m.css(d,"position")==="static";)d=d.offsetParent;return d||_g})}}),m.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(d,v){var S=v==="pageYOffset";m.fn[d]=function(I){return Ot(this,function(R,H,X){var oe=vg(R);if(X===void 0)return oe?oe[v]:R[H];oe?oe.scrollTo(S?e.pageXOffset:X,S?X:e.pageYOffset):R[H]=X},d,I,arguments.length,null)}}),m.each(["top","left"],function(d,v){m.cssHooks[v]=A(T.pixelPosition,function(S,I){if(I)return I=V(S,v),q.test(I)?m(S).position()[v]+"px":I})}),m.each({Height:"height",Width:"width"},function(d,v){m.each({padding:"inner"+d,content:v,"":"outer"+d},function(S,I){m.fn[I]=function(R,H){var X=arguments.length&&(S||typeof R!="boolean"),oe=S||(R===!0||H===!0?"margin":"border");return Ot(this,function(Le,ke,De){var Ye;return m.isWindow(Le)?Le.document.documentElement["client"+d]:Le.nodeType===9?(Ye=Le.documentElement,Math.max(Le.body["scroll"+d],Ye["scroll"+d],Le.body["offset"+d],Ye["offset"+d],Ye["client"+d])):De===void 0?m.css(Le,ke,oe):m.style(Le,ke,De,oe)},v,X?R:void 0,X,null)}})}),m.fn.size=function(){return this.length},m.fn.andSelf=m.fn.addBack;var Qy=e.jQuery,Zy=e.$;return m.noConflict=function(d){return e.$===m&&(e.$=Zy),d&&e.jQuery===m&&(e.jQuery=Qy),m},typeof t===lt&&(e.jQuery=e.$=m),m})})();var f_={exports:{}};/*!
 * Paper.js v0.12.17 - The Swiss Army Knife of Vector Graphics Scripting.
 * http://paperjs.org/
 *
 * Copyright (c) 2011 - 2020, Jrg Lehni & Jonathan Puckey
 * http://juerglehni.com/ & https://puckey.studio/
 *
 * Distributed under the MIT license. See LICENSE file for details.
 *
 * All rights reserved.
 *
 * Date: Thu Nov 3 21:15:36 2022 +0100
 *
 ***
 *
 * Straps.js - Class inheritance library with support for bean-style accessors
 *
 * Copyright (c) 2006 - 2020 Jrg Lehni
 * http://juerglehni.com/
 *
 * Distributed under the MIT license.
 *
 ***
 *
 * Acorn.js
 * https://marijnhaverbeke.nl/acorn/
 *
 * Acorn is a tiny, fast JavaScript parser written in JavaScript,
 * created by Marijn Haverbeke and released under an MIT license.
 *
 */(function(h){(function(e,t){var i=e.document,s=new function(){var r=/^(statics|enumerable|beans|preserve)$/,a=[],l=a.slice,u=Object.create,g=Object.getOwnPropertyDescriptor,y=Object.defineProperty,P=a.forEach||function(E,D){for(var B=0,W=this.length;B<W;B++)E.call(D,this[B],B,this)},L=function(E,D){for(var B in this)this.hasOwnProperty(B)&&E.call(D,this[B],B,this)},C=Object.assign||function(E){for(var D=1,B=arguments.length;D<B;D++){var W=arguments[D];for(var q in W)W.hasOwnProperty(q)&&(E[q]=W[q])}return E},x=function(E,D,B){if(E){var W=g(E,"length");(W&&typeof W.value=="number"?P:L).call(E,D,B=B||E)}return B};function k(E,D,B,W,q){var F={};function V(Z,ee){ee=ee||(ee=g(D,Z))&&(ee.get?ee:ee.value),typeof ee=="string"&&ee[0]==="#"&&(ee=E[ee.substring(1)]||ee);var se=typeof ee=="function",ae=ee,ge=q||se&&!ee.base?ee&&ee.get?Z in E:E[Z]:null,ue;(!q||!ge)&&(se&&ge&&(ee.base=ge),se&&W!==!1&&(ue=Z.match(/^([gs]et|is)(([A-Z])(.*))$/))&&(F[ue[3].toLowerCase()+ue[4]]=ue[2]),(!ae||se||!ae.get||typeof ae.get!="function"||!M.isPlainObject(ae))&&(ae={value:ae,writable:!0}),(g(E,Z)||{configurable:!0}).configurable&&(ae.configurable=!0,ae.enumerable=B??!ue),y(E,Z,ae))}if(D){for(var A in D)D.hasOwnProperty(A)&&!r.test(A)&&V(A);for(var A in F){var N=F[A],G=E["set"+N],K=E["get"+N]||G&&E["is"+N];K&&(W===!0||K.length===0)&&V(A,{get:K,set:G})}}return E}function M(){for(var E=0,D=arguments.length;E<D;E++){var B=arguments[E];B&&C(this,B)}return this}return k(M,{inject:function(E){if(E){var D=E.statics===!0?E:E.statics,B=E.beans,W=E.preserve;D!==E&&k(this.prototype,E,E.enumerable,B,W),k(this,D,null,B,W)}for(var q=1,F=arguments.length;q<F;q++)this.inject(arguments[q]);return this},extend:function(){for(var E=this,D,B,W=0,q,F=arguments.length;W<F&&!(D&&B);W++)q=arguments[W],D=D||q.initialize,B=B||q.prototype;return D=D||function(){E.apply(this,arguments)},B=D.prototype=B||u(this.prototype),y(B,"constructor",{value:D,writable:!0,configurable:!0}),k(D,this),arguments.length&&this.inject.apply(D,arguments),D.base=E,D}}).inject({enumerable:!1,initialize:M,set:M,inject:function(){for(var E=0,D=arguments.length;E<D;E++){var B=arguments[E];B&&k(this,B,B.enumerable,B.beans,B.preserve)}return this},extend:function(){var E=u(this);return E.inject.apply(E,arguments)},each:function(E,D){return x(this,E,D)},clone:function(){return new this.constructor(this)},statics:{set:C,each:x,create:u,define:y,describe:g,clone:function(E){return C(new E.constructor,E)},isPlainObject:function(E){var D=E!=null&&E.constructor;return D&&(D===Object||D===M||D.name==="Object")},pick:function(E,D){return E!==t?E:D},slice:function(E,D,B){return l.call(E,D,B)}}})};e.paper=s,s.inject({enumerable:!1,toString:function(){return this._id!=null?(this._class||"Object")+(this._name?" '"+this._name+"'":" @"+this._id):"{ "+s.each(this,function(r,a){if(!/^_/.test(a)){var l=typeof r;this.push(a+": "+(l==="number"?f.instance.number(r):l==="string"?"'"+r+"'":r))}},[]).join(", ")+" }"},getClassName:function(){return this._class||""},importJSON:function(r){return s.importJSON(r,this)},exportJSON:function(r){return s.exportJSON(this,r)},toJSON:function(){return s.serialize(this)},set:function(r,a){return r&&s.filter(this,r,a,this._prioritize),this}},{beans:!1,statics:{exports:{},extend:function r(){var a=r.base.apply(this,arguments),l=a.prototype._class;return l&&!s.exports[l]&&(s.exports[l]=a),a},equals:function(r,a){if(r===a)return!0;if(r&&r.equals)return r.equals(a);if(a&&a.equals)return a.equals(r);if(r&&a&&typeof r=="object"&&typeof a=="object"){if(Array.isArray(r)&&Array.isArray(a)){var l=r.length;if(l!==a.length)return!1;for(;l--;)if(!s.equals(r[l],a[l]))return!1}else{var u=Object.keys(r),l=u.length;if(l!==Object.keys(a).length)return!1;for(;l--;){var g=u[l];if(!(a.hasOwnProperty(g)&&s.equals(r[g],a[g])))return!1}}return!0}return!1},read:function(r,a,l,u){if(this===s){var g=this.peek(r,a);return r.__index++,g}var y=this.prototype,P=y._readIndex,L=a||P&&r.__index||0,C=r.length,x=r[L];if(u=u||C-L,x instanceof this||l&&l.readNull&&x==null&&u<=1)return P&&(r.__index=L+1),x&&l&&l.clone?x.clone():x;if(x=s.create(y),P&&(x.__read=!0),x=x.initialize.apply(x,L>0||L+u<C?s.slice(r,L,L+u):r)||x,P){r.__index=L+x.__read;var k=x.__filtered;k&&(r.__filtered=k,x.__filtered=t),x.__read=t}return x},peek:function(r,a){return r[r.__index=a||r.__index||0]},remain:function(r){return r.length-(r.__index||0)},readList:function(r,a,l,u){for(var g=[],y,P=a||0,L=u?P+u:r.length,C=P;C<L;C++)g.push(Array.isArray(y=r[C])?this.read(y,0,l):this.read(r,C,l,1));return g},readNamed:function(r,a,l,u,g){var y=this.getNamed(r,a),P=y!==t;if(P){var L=r.__filtered;if(!L){var C=this.getSource(r);L=r.__filtered=s.create(C),L.__unfiltered=C}L[a]=t}return this.read(P?[y]:r,l,u,g)},readSupported:function(r,a){var l=this.getSource(r),u=this,g=!1;return l&&Object.keys(l).forEach(function(y){if(y in a){var P=u.readNamed(r,y);P!==t&&(a[y]=P),g=!0}}),g},getSource:function(r){var a=r.__source;if(a===t){var l=r.length===1&&r[0];a=r.__source=l&&s.isPlainObject(l)?l:null}return a},getNamed:function(r,a){var l=this.getSource(r);if(l)return a?l[a]:r.__filtered||l},hasNamed:function(r,a){return!!this.getNamed(r,a)},filter:function(r,a,l,u){var g;function y(k){if(!(l&&k in l)&&!(g&&k in g)){var M=a[k];M!==t&&(r[k]=M)}}if(u){for(var P={},L=0,C,x=u.length;L<x;L++)(C=u[L])in a&&(y(C),P[C]=!0);g=P}return Object.keys(a.__unfiltered||a).forEach(y),r},isPlainValue:function(r,a){return s.isPlainObject(r)||Array.isArray(r)||a&&typeof r=="string"},serialize:function(r,a,l,u){a=a||{};var g=!u,y;if(g&&(a.formatter=new f(a.precision),u={length:0,definitions:{},references:{},add:function(M,E){var D="#"+M._id,B=this.references[D];if(!B){this.length++;var W=E.call(M),q=M._class;q&&W[0]!==q&&W.unshift(q),this.definitions[D]=W,B=this.references[D]=[D]}return B}}),r&&r._serialize){y=r._serialize(a,u);var P=r._class;P&&!r._compactSerialize&&(g||!l)&&y[0]!==P&&y.unshift(P)}else if(Array.isArray(r)){y=[];for(var L=0,C=r.length;L<C;L++)y[L]=s.serialize(r[L],a,l,u)}else if(s.isPlainObject(r)){y={};for(var x=Object.keys(r),L=0,C=x.length;L<C;L++){var k=x[L];y[k]=s.serialize(r[k],a,l,u)}}else typeof r=="number"?y=a.formatter.number(r,a.precision):y=r;return g&&u.length>0?[["dictionary",u.definitions],y]:y},deserialize:function(r,a,l,u,g){var y=r,P=!l,L=P&&r&&r.length&&r[0][0]==="dictionary";if(l=l||{},Array.isArray(r)){var C=r[0],x=C==="dictionary";if(r.length==1&&/^#/.test(C))return l.dictionary[C];C=s.exports[C],y=[];for(var k=C?1:0,M=r.length;k<M;k++)y.push(s.deserialize(r[k],a,l,x,L));if(C){var E=y;a?y=a(C,E,P||g):y=new C(E)}}else if(s.isPlainObject(r)){y={},u&&(l.dictionary=y);for(var D in r)y[D]=s.deserialize(r[D],a,l)}return L?y[1]:y},exportJSON:function(r,a){var l=s.serialize(r,a);return a&&a.asString==!1?l:JSON.stringify(l)},importJSON:function(r,a){return s.deserialize(typeof r=="string"?JSON.parse(r):r,function(l,u,g){var y=g&&a&&a.constructor===l,P=y?a:s.create(l.prototype);if(u.length===1&&P instanceof ne&&(y||!(P instanceof Fe))){var L=u[0];s.isPlainObject(L)&&(L.insert=!1,y&&(u=u.concat([ne.INSERT])))}return(y?P.set:l).apply(P,u),y&&(a=null),P})},push:function(r,a){var l=a.length;if(l<4096)r.push.apply(r,a);else{var u=r.length;r.length+=l;for(var g=0;g<l;g++)r[u+g]=a[g]}return r},splice:function(r,a,l,u){var g=a&&a.length,y=l===t;l=y?r.length:l,l>r.length&&(l=r.length);for(var P=0;P<g;P++)a[P]._index=l+P;if(y)return s.push(r,a),[];var L=[l,u];a&&s.push(L,a);for(var C=r.splice.apply(r,L),P=0,x=C.length;P<x;P++)C[P]._index=t;for(var P=l+g,x=r.length;P<x;P++)r[P]._index=P;return C},capitalize:function(r){return r.replace(/\b[a-z]/g,function(a){return a.toUpperCase()})},camelize:function(r){return r.replace(/-(.)/g,function(a,l){return l.toUpperCase()})},hyphenate:function(r){return r.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var n={on:function(r,a){if(typeof r!="string")s.each(r,function(y,P){this.on(P,y)},this);else{var l=this._eventTypes,u=l&&l[r],g=this._callbacks=this._callbacks||{};g=g[r]=g[r]||[],g.indexOf(a)===-1&&(g.push(a),u&&u.install&&g.length===1&&u.install.call(this,r))}return this},off:function(r,a){if(typeof r!="string"){s.each(r,function(P,L){this.off(L,P)},this);return}var l=this._eventTypes,u=l&&l[r],g=this._callbacks&&this._callbacks[r],y;return g&&(!a||(y=g.indexOf(a))!==-1&&g.length===1?(u&&u.uninstall&&u.uninstall.call(this,r),delete this._callbacks[r]):y!==-1&&g.splice(y,1)),this},once:function(r,a){return this.on(r,function l(){a.apply(this,arguments),this.off(r,l)})},emit:function(r,a){var l=this._callbacks&&this._callbacks[r];if(!l)return!1;var u=s.slice(arguments,1),g=a&&a.target&&!a.currentTarget;l=l.slice(),g&&(a.currentTarget=this);for(var y=0,P=l.length;y<P;y++)if(l[y].apply(this,u)==!1){a&&a.stop&&a.stop();break}return g&&delete a.currentTarget,!0},responds:function(r){return!!(this._callbacks&&this._callbacks[r])},attach:"#on",detach:"#off",fire:"#emit",_installEvents:function(r){var a=this._eventTypes,l=this._callbacks,u=r?"install":"uninstall";if(a){for(var g in l)if(l[g].length>0){var y=a[g],P=y&&y[u];P&&P.call(this,g)}}},statics:{inject:function r(a){var l=a._events;if(l){var u={};s.each(l,function(g,y){var P=typeof g=="string",L=P?g:y,C=s.capitalize(L),x=L.substring(2).toLowerCase();u[x]=P?{}:g,L="_"+L,a["get"+C]=function(){return this[L]},a["set"+C]=function(k){var M=this[L];M&&this.off(x,M),k&&this.on(x,k),this[L]=k}}),a._eventTypes=u}return r.base.apply(this,arguments)}}},o=s.extend({_class:"PaperScope",initialize:function r(){Be=this,this.settings=new s({applyMatrix:!0,insertItems:!0,handleSize:4,hitTolerance:0}),this.project=null,this.projects=[],this.tools=[],this._id=r._id++,r._scopes[this._id]=this;var a=r.prototype;if(!this.support){var l=re.getContext(1,1)||{};a.support={nativeDash:"setLineDash"in l||"mozDash"in l,nativeBlendModes:ye.nativeModes},re.release(l)}if(!this.agent){var u=e.navigator.userAgent.toLowerCase(),g=(/(darwin|win|mac|linux|freebsd|sunos)/.exec(u)||[])[0],y=g==="darwin"?"mac":g,P=a.agent=a.browser={platform:y};y&&(P[y]=!0),u.replace(/(opera|chrome|safari|webkit|firefox|msie|trident|atom|node|jsdom)\/?\s*([.\d]+)(?:.*version\/([.\d]+))?(?:.*rv\:v?([.\d]+))?/g,function(L,C,x,k,M){if(!P.chrome){var E=C==="opera"?k:/^(node|trident)$/.test(C)?M:x;P.version=E,P.versionNumber=parseFloat(E),C={trident:"msie",jsdom:"node"}[C]||C,P.name=C,P[C]=!0}}),P.chrome&&delete P.webkit,P.atom&&delete P.chrome}},version:"0.12.17",getView:function(){var r=this.project;return r&&r._view},getPaper:function(){return this},execute:function(r,a){},install:function(r){var a=this;s.each(["project","view","tool"],function(u){s.define(r,u,{configurable:!0,get:function(){return a[u]}})});for(var l in this)!/^_/.test(l)&&this[l]&&(r[l]=this[l])},setup:function(r){return Be=this,this.project=new ce(r),this},createCanvas:function(r,a){return re.getCanvas(r,a)},activate:function(){Be=this},clear:function(){for(var r=this.projects,a=this.tools,l=r.length-1;l>=0;l--)r[l].remove();for(var l=a.length-1;l>=0;l--)a[l].remove()},remove:function(){this.clear(),delete o._scopes[this._id]},statics:new function(){function r(a){return a+="Attribute",function(l,u){return l[a](u)||l[a]("data-paper-"+u)}}return{_scopes:{},_id:0,get:function(a){return this._scopes[a]||null},getAttribute:r("get"),hasAttribute:r("has")}}}),c=s.extend(n,{initialize:function(r){this._scope=Be,this._index=this._scope[this._list].push(this)-1,(r||!this._scope[this._reference])&&this.activate()},activate:function(){if(!this._scope)return!1;var r=this._scope[this._reference];return r&&r!==this&&r.emit("deactivate"),this._scope[this._reference]=this,this.emit("activate",r),!0},isActive:function(){return this._scope[this._reference]===this},remove:function(){return this._index==null?!1:(s.splice(this._scope[this._list],null,this._index,1),this._scope[this._reference]==this&&(this._scope[this._reference]=null),this._scope=null,!0)},getView:function(){return this._scope.getView()}}),p={findItemBoundsCollisions:function(r,a,l){function u(P){for(var L=new Array(P.length),C=0;C<P.length;C++){var x=P[C].getBounds();L[C]=[x.left,x.top,x.right,x.bottom]}return L}var g=u(r),y=!a||a===r?g:u(a);return this.findBoundsCollisions(g,y,l||0)},findCurveBoundsCollisions:function(r,a,l,u){function g(E){for(var D=Math.min,B=Math.max,W=new Array(E.length),q=0;q<E.length;q++){var F=E[q];W[q]=[D(F[0],F[2],F[4],F[6]),D(F[1],F[3],F[5],F[7]),B(F[0],F[2],F[4],F[6]),B(F[1],F[3],F[5],F[7])]}return W}var y=g(r),P=!a||a===r?y:g(a);if(u){for(var L=this.findBoundsCollisions(y,P,l||0,!1,!0),C=this.findBoundsCollisions(y,P,l||0,!0,!0),x=[],k=0,M=L.length;k<M;k++)x[k]={hor:L[k],ver:C[k]};return x}return this.findBoundsCollisions(y,P,l||0)},findBoundsCollisions:function(r,a,l,u,g){var y=!a||r===a,P=y?r:r.concat(a),L=r.length,C=P.length;function x(et,it,yt){for(var dt=0,pt=et.length;dt<pt;){var ut=pt+dt>>>1;P[et[ut]][it]<yt?dt=ut+1:pt=ut}return dt-1}for(var k=u?1:0,M=k+2,E=u?0:1,D=E+2,B=new Array(C),W=0;W<C;W++)B[W]=W;B.sort(function(et,it){return P[et][k]-P[it][k]});for(var q=[],F=new Array(L),W=0;W<C;W++){var V=B[W],A=P[V],N=y?V:V-L,G=V<L,K=y||!G,Z=G?[]:null;if(q.length){var ee=x(q,M,A[k]-l)+1;if(q.splice(0,ee),y&&g){Z=Z.concat(q);for(var se=0;se<q.length;se++){var ae=q[se];F[ae].push(N)}}else for(var ge=A[D],ue=A[E],se=0;se<q.length;se++){var ae=q[se],fe=P[ae],be=ae<L,ve=y||ae>=L;(g||(G&&ve||K&&be)&&ge>=fe[E]-l&&ue<=fe[D]+l)&&(G&&ve&&Z.push(y?ae:ae-L),K&&be&&F[ae].push(N))}}if(G&&(r===a&&Z.push(V),F[V]=Z),q.length){var Ce=A[M],Ae=x(q,M,Ce);q.splice(Ae+1,0,V)}else q.push(V)}for(var W=0;W<F.length;W++){var je=F[W];je&&je.sort(function(it,yt){return it-yt})}return F}},f=s.extend({initialize:function(r){this.precision=s.pick(r,5),this.multiplier=Math.pow(10,this.precision)},number:function(r){return this.precision<16?Math.round(r*this.multiplier)/this.multiplier:r},pair:function(r,a,l){return this.number(r)+(l||",")+this.number(a)},point:function(r,a){return this.number(r.x)+(a||",")+this.number(r.y)},size:function(r,a){return this.number(r.width)+(a||",")+this.number(r.height)},rectangle:function(r,a){return this.point(r,a)+(a||",")+this.size(r,a)}});f.instance=new f;var w=new function(){var r=[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],a=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]],l=Math.abs,u=Math.sqrt,g=Math.pow,y=Math.log2||function(M){return Math.log(M)*Math.LOG2E},P=1e-12,L=112e-18;function C(M,E,D){return M<E?E:M>D?D:M}function x(M,E,D){function B(ee){var se=ee*134217729,ae=ee-se,ge=ae+se,ue=ee-ge;return[ge,ue]}var W=E*E-M*D,q=E*E+M*D;if(l(W)*3<q){var F=B(M),V=B(E),A=B(D),N=E*E,G=V[0]*V[0]-N+2*V[0]*V[1]+V[1]*V[1],K=M*D,Z=F[0]*A[0]-K+F[0]*A[1]+F[1]*A[0]+F[1]*A[1];W=N-K+(G-Z)}return W}function k(){var M=Math.max.apply(Math,arguments);return M&&(M<1e-8||M>1e8)?g(2,-Math.round(y(M))):0}return{EPSILON:P,MACHINE_EPSILON:L,CURVETIME_EPSILON:1e-8,GEOMETRIC_EPSILON:1e-7,TRIGONOMETRIC_EPSILON:1e-8,ANGULAR_EPSILON:1e-5,KAPPA:4*(u(2)-1)/3,isZero:function(M){return M>=-P&&M<=P},isMachineZero:function(M){return M>=-L&&M<=L},clamp:C,integrate:function(M,E,D,B){for(var W=r[B-2],q=a[B-2],F=(D-E)*.5,V=F+E,A=0,N=B+1>>1,G=B&1?q[A++]*M(V):0;A<N;){var K=F*W[A];G+=q[A++]*(M(V+K)+M(V-K))}return F*G},findRoot:function(M,E,D,B,W,q,F){for(var V=0;V<q;V++){var A=M(D),N=A/E(D),G=D-N;if(l(N)<F){D=G;break}A>0?(W=D,D=G<=B?(B+W)*.5:G):(B=D,D=G>=W?(B+W)*.5:G)}return C(D,B,W)},solveQuadratic:function(M,E,D,B,W,q){var F,V=1/0;if(l(M)<P){if(l(E)<P)return l(D)<P?-1:0;F=-D/E}else{E*=-.5;var A=x(M,E,D);if(A&&l(A)<L){var N=k(l(M),l(E),l(D));N&&(M*=N,E*=N,D*=N,A=x(M,E,D))}if(A>=-L){var G=A<0?0:u(A),K=E+(E<0?-G:G);K===0?(F=D/M,V=-F):(F=K/M,V=D/K)}}var Z=0,ee=W==null,se=W-P,ae=q+P;return isFinite(F)&&(ee||F>se&&F<ae)&&(B[Z++]=ee?F:C(F,W,q)),V!==F&&isFinite(V)&&(ee||V>se&&V<ae)&&(B[Z++]=ee?V:C(V,W,q)),Z},solveCubic:function(M,E,D,B,W,q,F){var V=k(l(M),l(E),l(D),l(B)),A,N,G,K,Z;V&&(M*=V,E*=V,D*=V,B*=V);function ee(Ae){A=Ae;var je=M*A;N=je+E,G=N*A+D,K=(je+N)*A+G,Z=G*A+B}if(l(M)<P)M=E,N=D,G=B,A=1/0;else if(l(B)<P)N=E,G=D,A=0;else{ee(-(E/M)/3);var se=Z/M,ae=g(l(se),1/3),ge=se<0?-1:1,ue=-K/M,fe=ue>0?1.324717957244746*Math.max(ae,u(ue)):ae,be=A-ge*fe;if(be!==A){do ee(be),be=K===0?A:A-Z/K/(1+L);while(ge*be>ge*A);l(M)*A*A>l(B/A)&&(G=-B/A,N=(G-D)/A)}}var ve=w.solveQuadratic(M,N,G,W,q,F),Ce=q==null;return isFinite(A)&&(ve===0||ve>0&&A!==W[0]&&A!==W[1])&&(Ce||A>q-P&&A<F+P)&&(W[ve++]=Ce?A:C(A,q,F)),ve}}},O={_id:1,_pools:{},get:function(r){if(r){var a=this._pools[r];return a||(a=this._pools[r]={_id:1}),a._id++}else return this._id++}},T=s.extend({_class:"Point",_readIndex:!0,initialize:function(a,l){var u=typeof a,g=this.__read,y=0;if(u==="number"){var P=typeof l=="number";this._set(a,P?l:a),g&&(y=P?2:1)}else if(u==="undefined"||a===null)this._set(0,0),g&&(y=a===null?1:0);else{var L=u==="string"?a.split(/[\s,]+/)||[]:a;y=1,Array.isArray(L)?this._set(+L[0],+(L.length>1?L[1]:L[0])):"x"in L?this._set(L.x||0,L.y||0):"width"in L?this._set(L.width||0,L.height||0):"angle"in L?(this._set(L.length||0,0),this.setAngle(L.angle||0)):(this._set(0,0),y=0)}return g&&(this.__read=y),this},set:"#initialize",_set:function(r,a){return this.x=r,this.y=a,this},equals:function(r){return this===r||r&&(this.x===r.x&&this.y===r.y||Array.isArray(r)&&this.x===r[0]&&this.y===r[1])||!1},clone:function(){return new T(this.x,this.y)},toString:function(){var r=f.instance;return"{ x: "+r.number(this.x)+", y: "+r.number(this.y)+" }"},_serialize:function(r){var a=r.formatter;return[a.number(this.x),a.number(this.y)]},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},setLength:function(r){if(this.isZero()){var a=this._angle||0;this._set(Math.cos(a)*r,Math.sin(a)*r)}else{var l=r/this.getLength();w.isZero(l)&&this.getAngle(),this._set(this.x*l,this.y*l)}},getAngle:function(){return this.getAngleInRadians.apply(this,arguments)*180/Math.PI},setAngle:function(r){this.setAngleInRadians.call(this,r*Math.PI/180)},getAngleInDegrees:"#getAngle",setAngleInDegrees:"#setAngle",getAngleInRadians:function(){if(arguments.length){var r=T.read(arguments),a=this.getLength()*r.getLength();if(w.isZero(a))return NaN;var l=this.dot(r)/a;return Math.acos(l<-1?-1:l>1?1:l)}else return this.isZero()?this._angle||0:this._angle=Math.atan2(this.y,this.x)},setAngleInRadians:function(r){if(this._angle=r,!this.isZero()){var a=this.getLength();this._set(Math.cos(r)*a,Math.sin(r)*a)}},getQuadrant:function(){return this.x>=0?this.y>=0?1:4:this.y>=0?2:3}},{beans:!1,getDirectedAngle:function(){var r=T.read(arguments);return Math.atan2(this.cross(r),this.dot(r))*180/Math.PI},getDistance:function(){var r=arguments,a=T.read(r),l=a.x-this.x,u=a.y-this.y,g=l*l+u*u,y=s.read(r);return y?g:Math.sqrt(g)},normalize:function(r){r===t&&(r=1);var a=this.getLength(),l=a!==0?r/a:0,u=new T(this.x*l,this.y*l);return l>=0&&(u._angle=this._angle),u},rotate:function(r,a){if(r===0)return this.clone();r=r*Math.PI/180;var l=a?this.subtract(a):this,u=Math.sin(r),g=Math.cos(r);return l=new T(l.x*g-l.y*u,l.x*u+l.y*g),a?l.add(a):l},transform:function(r){return r?r._transformPoint(this):this},add:function(){var r=T.read(arguments);return new T(this.x+r.x,this.y+r.y)},subtract:function(){var r=T.read(arguments);return new T(this.x-r.x,this.y-r.y)},multiply:function(){var r=T.read(arguments);return new T(this.x*r.x,this.y*r.y)},divide:function(){var r=T.read(arguments);return new T(this.x/r.x,this.y/r.y)},modulo:function(){var r=T.read(arguments);return new T(this.x%r.x,this.y%r.y)},negate:function(){return new T(-this.x,-this.y)},isInside:function(){return Y.read(arguments).contains(this)},isClose:function(){var r=arguments,a=T.read(r),l=s.read(r);return this.getDistance(a)<=l},isCollinear:function(){var r=T.read(arguments);return T.isCollinear(this.x,this.y,r.x,r.y)},isColinear:"#isCollinear",isOrthogonal:function(){var r=T.read(arguments);return T.isOrthogonal(this.x,this.y,r.x,r.y)},isZero:function(){var r=w.isZero;return r(this.x)&&r(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},isInQuadrant:function(r){return this.x*(r>1&&r<4?-1:1)>=0&&this.y*(r>2?-1:1)>=0},dot:function(){var r=T.read(arguments);return this.x*r.x+this.y*r.y},cross:function(){var r=T.read(arguments);return this.x*r.y-this.y*r.x},project:function(){var r=T.read(arguments),a=r.isZero()?0:this.dot(r)/r.dot(r);return new T(r.x*a,r.y*a)},statics:{min:function(){var r=arguments,a=T.read(r),l=T.read(r);return new T(Math.min(a.x,l.x),Math.min(a.y,l.y))},max:function(){var r=arguments,a=T.read(r),l=T.read(r);return new T(Math.max(a.x,l.x),Math.max(a.y,l.y))},random:function(){return new T(Math.random(),Math.random())},isCollinear:function(r,a,l,u){return Math.abs(r*u-a*l)<=Math.sqrt((r*r+a*a)*(l*l+u*u))*1e-8},isOrthogonal:function(r,a,l,u){return Math.abs(r*l+a*u)<=Math.sqrt((r*r+a*a)*(l*l+u*u))*1e-8}}},s.each(["round","ceil","floor","abs"],function(r){var a=Math[r];this[r]=function(){return new T(a(this.x),a(this.y))}},{})),z=T.extend({initialize:function(a,l,u,g){this._x=a,this._y=l,this._owner=u,this._setter=g},_set:function(r,a,l){return this._x=r,this._y=a,l||this._owner[this._setter](this),this},getX:function(){return this._x},setX:function(r){this._x=r,this._owner[this._setter](this)},getY:function(){return this._y},setY:function(r){this._y=r,this._owner[this._setter](this)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(r){this._owner._changeSelection(this._getSelection(),r)},_getSelection:function(){return this._setter==="setPosition"?4:0}}),U=s.extend({_class:"Size",_readIndex:!0,initialize:function(a,l){var u=typeof a,g=this.__read,y=0;if(u==="number"){var P=typeof l=="number";this._set(a,P?l:a),g&&(y=P?2:1)}else if(u==="undefined"||a===null)this._set(0,0),g&&(y=a===null?1:0);else{var L=u==="string"?a.split(/[\s,]+/)||[]:a;y=1,Array.isArray(L)?this._set(+L[0],+(L.length>1?L[1]:L[0])):"width"in L?this._set(L.width||0,L.height||0):"x"in L?this._set(L.x||0,L.y||0):(this._set(0,0),y=0)}return g&&(this.__read=y),this},set:"#initialize",_set:function(r,a){return this.width=r,this.height=a,this},equals:function(r){return r===this||r&&(this.width===r.width&&this.height===r.height||Array.isArray(r)&&this.width===r[0]&&this.height===r[1])||!1},clone:function(){return new U(this.width,this.height)},toString:function(){var r=f.instance;return"{ width: "+r.number(this.width)+", height: "+r.number(this.height)+" }"},_serialize:function(r){var a=r.formatter;return[a.number(this.width),a.number(this.height)]},add:function(){var r=U.read(arguments);return new U(this.width+r.width,this.height+r.height)},subtract:function(){var r=U.read(arguments);return new U(this.width-r.width,this.height-r.height)},multiply:function(){var r=U.read(arguments);return new U(this.width*r.width,this.height*r.height)},divide:function(){var r=U.read(arguments);return new U(this.width/r.width,this.height/r.height)},modulo:function(){var r=U.read(arguments);return new U(this.width%r.width,this.height%r.height)},negate:function(){return new U(-this.width,-this.height)},isZero:function(){var r=w.isZero;return r(this.width)&&r(this.height)},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{min:function(r,a){return new U(Math.min(r.width,a.width),Math.min(r.height,a.height))},max:function(r,a){return new U(Math.max(r.width,a.width),Math.max(r.height,a.height))},random:function(){return new U(Math.random(),Math.random())}}},s.each(["round","ceil","floor","abs"],function(r){var a=Math[r];this[r]=function(){return new U(a(this.width),a(this.height))}},{})),m=U.extend({initialize:function(a,l,u,g){this._width=a,this._height=l,this._owner=u,this._setter=g},_set:function(r,a,l){return this._width=r,this._height=a,l||this._owner[this._setter](this),this},getWidth:function(){return this._width},setWidth:function(r){this._width=r,this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(r){this._height=r,this._owner[this._setter](this)}}),Y=s.extend({_class:"Rectangle",_readIndex:!0,beans:!0,initialize:function(a,l,u,g){var y=arguments,P=typeof a,L;if(P==="number"?(this._set(a,l,u,g),L=4):P==="undefined"||a===null?(this._set(0,0,0,0),L=a===null?1:0):y.length===1&&(Array.isArray(a)?(this._set.apply(this,a),L=1):a.x!==t||a.width!==t?(this._set(a.x||0,a.y||0,a.width||0,a.height||0),L=1):a.from===t&&a.to===t&&(this._set(0,0,0,0),s.readSupported(y,this)&&(L=1))),L===t){var C=T.readNamed(y,"from"),x=s.peek(y),k=C.x,M=C.y,E,D;if(x&&x.x!==t||s.hasNamed(y,"to")){var B=T.readNamed(y,"to");E=B.x-k,D=B.y-M,E<0&&(k=B.x,E=-E),D<0&&(M=B.y,D=-D)}else{var W=U.read(y);E=W.width,D=W.height}this._set(k,M,E,D),L=y.__index}var q=y.__filtered;return q&&(this.__filtered=q),this.__read&&(this.__read=L),this},set:"#initialize",_set:function(r,a,l,u){return this.x=r,this.y=a,this.width=l,this.height=u,this},clone:function(){return new Y(this.x,this.y,this.width,this.height)},equals:function(r){var a=s.isPlainValue(r)?Y.read(arguments):r;return a===this||a&&this.x===a.x&&this.y===a.y&&this.width===a.width&&this.height===a.height||!1},toString:function(){var r=f.instance;return"{ x: "+r.number(this.x)+", y: "+r.number(this.y)+", width: "+r.number(this.width)+", height: "+r.number(this.height)+" }"},_serialize:function(r){var a=r.formatter;return[a.number(this.x),a.number(this.y),a.number(this.width),a.number(this.height)]},getPoint:function(r){var a=r?T:z;return new a(this.x,this.y,this,"setPoint")},setPoint:function(){var r=T.read(arguments);this.x=r.x,this.y=r.y},getSize:function(r){var a=r?U:m;return new a(this.width,this.height,this,"setSize")},_fw:1,_fh:1,setSize:function(){var r=U.read(arguments),a=this._sx,l=this._sy,u=r.width,g=r.height;a&&(this.x+=(this.width-u)*a),l&&(this.y+=(this.height-g)*l),this.width=u,this.height=g,this._fw=this._fh=1},getLeft:function(){return this.x},setLeft:function(r){if(!this._fw){var a=r-this.x;this.width-=this._sx===.5?a*2:a}this.x=r,this._sx=this._fw=0},getTop:function(){return this.y},setTop:function(r){if(!this._fh){var a=r-this.y;this.height-=this._sy===.5?a*2:a}this.y=r,this._sy=this._fh=0},getRight:function(){return this.x+this.width},setRight:function(r){if(!this._fw){var a=r-this.x;this.width=this._sx===.5?a*2:a}this.x=r-this.width,this._sx=1,this._fw=0},getBottom:function(){return this.y+this.height},setBottom:function(r){if(!this._fh){var a=r-this.y;this.height=this._sy===.5?a*2:a}this.y=r-this.height,this._sy=1,this._fh=0},getCenterX:function(){return this.x+this.width/2},setCenterX:function(r){this._fw||this._sx===.5?this.x=r-this.width/2:(this._sx&&(this.x+=(r-this.x)*2*this._sx),this.width=(r-this.x)*2),this._sx=.5,this._fw=0},getCenterY:function(){return this.y+this.height/2},setCenterY:function(r){this._fh||this._sy===.5?this.y=r-this.height/2:(this._sy&&(this.y+=(r-this.y)*2*this._sy),this.height=(r-this.y)*2),this._sy=.5,this._fh=0},getCenter:function(r){var a=r?T:z;return new a(this.getCenterX(),this.getCenterY(),this,"setCenter")},setCenter:function(){var r=T.read(arguments);return this.setCenterX(r.x),this.setCenterY(r.y),this},getArea:function(){return this.width*this.height},isEmpty:function(){return this.width===0||this.height===0},contains:function(r){return r&&r.width!==t||(Array.isArray(r)?r:arguments).length===4?this._containsRectangle(Y.read(arguments)):this._containsPoint(T.read(arguments))},_containsPoint:function(r){var a=r.x,l=r.y;return a>=this.x&&l>=this.y&&a<=this.x+this.width&&l<=this.y+this.height},_containsRectangle:function(r){var a=r.x,l=r.y;return a>=this.x&&l>=this.y&&a+r.width<=this.x+this.width&&l+r.height<=this.y+this.height},intersects:function(){var r=Y.read(arguments),a=s.read(arguments)||0;return r.x+r.width>this.x-a&&r.y+r.height>this.y-a&&r.x<this.x+this.width+a&&r.y<this.y+this.height+a},intersect:function(){var r=Y.read(arguments),a=Math.max(this.x,r.x),l=Math.max(this.y,r.y),u=Math.min(this.x+this.width,r.x+r.width),g=Math.min(this.y+this.height,r.y+r.height);return new Y(a,l,u-a,g-l)},unite:function(){var r=Y.read(arguments),a=Math.min(this.x,r.x),l=Math.min(this.y,r.y),u=Math.max(this.x+this.width,r.x+r.width),g=Math.max(this.y+this.height,r.y+r.height);return new Y(a,l,u-a,g-l)},include:function(){var r=T.read(arguments),a=Math.min(this.x,r.x),l=Math.min(this.y,r.y),u=Math.max(this.x+this.width,r.x),g=Math.max(this.y+this.height,r.y);return new Y(a,l,u-a,g-l)},expand:function(){var r=U.read(arguments),a=r.width,l=r.height;return new Y(this.x-a/2,this.y-l/2,this.width+a,this.height+l)},scale:function(r,a){return this.expand(this.width*r-this.width,this.height*(a===t?r:a)-this.height)}},s.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],function(r,a){var l=r.join(""),u=/^[RL]/.test(l);a>=4&&(r[1]+=u?"Y":"X");var g=r[u?0:1],y=r[u?1:0],P="get"+g,L="get"+y,C="set"+g,x="set"+y,k="get"+l,M="set"+l;this[k]=function(E){var D=E?T:z;return new D(this[P](),this[L](),this,M)},this[M]=function(){var E=T.read(arguments);this[C](E.x),this[x](E.y)}},{beans:!0})),j=Y.extend({initialize:function(a,l,u,g,y,P){this._set(a,l,u,g,!0),this._owner=y,this._setter=P},_set:function(r,a,l,u,g){return this._x=r,this._y=a,this._width=l,this._height=u,g||this._owner[this._setter](this),this}},new function(){var r=Y.prototype;return s.each(["x","y","width","height"],function(a){var l=s.capitalize(a),u="_"+a;this["get"+l]=function(){return this[u]},this["set"+l]=function(g){this[u]=g,this._dontNotify||this._owner[this._setter](this)}},s.each(["Point","Size","Center","Left","Top","Right","Bottom","CenterX","CenterY","TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],function(a){var l="set"+a;this[l]=function(){this._dontNotify=!0,r[l].apply(this,arguments),this._dontNotify=!1,this._owner[this._setter](this)}},{isSelected:function(){return!!(this._owner._selection&2)},setSelected:function(a){var l=this._owner;l._changeSelection&&l._changeSelection(2,a)}}))}),le=s.extend({_class:"Matrix",initialize:function r(a,l){var u=arguments,g=u.length,y=!0;if(g>=6?this._set.apply(this,u):g===1||g===2?a instanceof r?this._set(a._a,a._b,a._c,a._d,a._tx,a._ty,l):Array.isArray(a)?this._set.apply(this,l?a.concat([l]):a):y=!1:g?y=!1:this.reset(),!y)throw new Error("Unsupported matrix parameters");return this},set:"#initialize",_set:function(r,a,l,u,g,y,P){return this._a=r,this._b=a,this._c=l,this._d=u,this._tx=g,this._ty=y,P||this._changed(),this},_serialize:function(r,a){return s.serialize(this.getValues(),r,!0,a)},_changed:function(){var r=this._owner;r&&(r._applyMatrix?r.transform(null,!0):r._changed(25))},clone:function(){return new le(this._a,this._b,this._c,this._d,this._tx,this._ty)},equals:function(r){return r===this||r&&this._a===r._a&&this._b===r._b&&this._c===r._c&&this._d===r._d&&this._tx===r._tx&&this._ty===r._ty},toString:function(){var r=f.instance;return"[["+[r.number(this._a),r.number(this._c),r.number(this._tx)].join(", ")+"], ["+[r.number(this._b),r.number(this._d),r.number(this._ty)].join(", ")+"]]"},reset:function(r){return this._a=this._d=1,this._b=this._c=this._tx=this._ty=0,r||this._changed(),this},apply:function(r,a){var l=this._owner;return l?(l.transform(null,s.pick(r,!0),a),this.isIdentity()):!1},translate:function(){var r=T.read(arguments),a=r.x,l=r.y;return this._tx+=a*this._a+l*this._c,this._ty+=a*this._b+l*this._d,this._changed(),this},scale:function(){var r=arguments,a=T.read(r),l=T.read(r,0,{readNull:!0});return l&&this.translate(l),this._a*=a.x,this._b*=a.x,this._c*=a.y,this._d*=a.y,l&&this.translate(l.negate()),this._changed(),this},rotate:function(r){r*=Math.PI/180;var a=T.read(arguments,1),l=a.x,u=a.y,g=Math.cos(r),y=Math.sin(r),P=l-l*g+u*y,L=u-l*y-u*g,C=this._a,x=this._b,k=this._c,M=this._d;return this._a=g*C+y*k,this._b=g*x+y*M,this._c=-y*C+g*k,this._d=-y*x+g*M,this._tx+=P*C+L*k,this._ty+=P*x+L*M,this._changed(),this},shear:function(){var r=arguments,a=T.read(r),l=T.read(r,0,{readNull:!0});l&&this.translate(l);var u=this._a,g=this._b;return this._a+=a.y*this._c,this._b+=a.y*this._d,this._c+=a.x*u,this._d+=a.x*g,l&&this.translate(l.negate()),this._changed(),this},skew:function(){var r=arguments,a=T.read(r),l=T.read(r,0,{readNull:!0}),u=Math.PI/180,g=new T(Math.tan(a.x*u),Math.tan(a.y*u));return this.shear(g,l)},append:function(r,a){if(r){var l=this._a,u=this._b,g=this._c,y=this._d,P=r._a,L=r._c,C=r._b,x=r._d,k=r._tx,M=r._ty;this._a=P*l+C*g,this._c=L*l+x*g,this._b=P*u+C*y,this._d=L*u+x*y,this._tx+=k*l+M*g,this._ty+=k*u+M*y,a||this._changed()}return this},prepend:function(r,a){if(r){var l=this._a,u=this._b,g=this._c,y=this._d,P=this._tx,L=this._ty,C=r._a,x=r._c,k=r._b,M=r._d,E=r._tx,D=r._ty;this._a=C*l+x*u,this._c=C*g+x*y,this._b=k*l+M*u,this._d=k*g+M*y,this._tx=C*P+x*L+E,this._ty=k*P+M*L+D,a||this._changed()}return this},appended:function(r){return this.clone().append(r)},prepended:function(r){return this.clone().prepend(r)},invert:function(){var r=this._a,a=this._b,l=this._c,u=this._d,g=this._tx,y=this._ty,P=r*u-a*l,L=null;return P&&!isNaN(P)&&isFinite(g)&&isFinite(y)&&(this._a=u/P,this._b=-a/P,this._c=-l/P,this._d=r/P,this._tx=(l*y-u*g)/P,this._ty=(a*g-r*y)/P,L=this),L},inverted:function(){return this.clone().invert()},concatenate:"#append",preConcatenate:"#prepend",chain:"#appended",_shiftless:function(){return new le(this._a,this._b,this._c,this._d,0,0)},_orNullIfIdentity:function(){return this.isIdentity()?null:this},isIdentity:function(){return this._a===1&&this._b===0&&this._c===0&&this._d===1&&this._tx===0&&this._ty===0},isInvertible:function(){var r=this._a*this._d-this._c*this._b;return r&&!isNaN(r)&&isFinite(this._tx)&&isFinite(this._ty)},isSingular:function(){return!this.isInvertible()},transform:function(r,a,l){return arguments.length<3?this._transformPoint(T.read(arguments)):this._transformCoordinates(r,a,l)},_transformPoint:function(r,a,l){var u=r.x,g=r.y;return a||(a=new T),a._set(u*this._a+g*this._c+this._tx,u*this._b+g*this._d+this._ty,l)},_transformCoordinates:function(r,a,l){for(var u=0,g=2*l;u<g;u+=2){var y=r[u],P=r[u+1];a[u]=y*this._a+P*this._c+this._tx,a[u+1]=y*this._b+P*this._d+this._ty}return a},_transformCorners:function(r){var a=r.x,l=r.y,u=a+r.width,g=l+r.height,y=[a,l,u,l,u,g,a,g];return this._transformCoordinates(y,y,4)},_transformBounds:function(r,a,l){for(var u=this._transformCorners(r),g=u.slice(0,2),y=g.slice(),P=2;P<8;P++){var L=u[P],C=P&1;L<g[C]?g[C]=L:L>y[C]&&(y[C]=L)}return a||(a=new Y),a._set(g[0],g[1],y[0]-g[0],y[1]-g[1],l)},inverseTransform:function(){return this._inverseTransform(T.read(arguments))},_inverseTransform:function(r,a,l){var u=this._a,g=this._b,y=this._c,P=this._d,L=this._tx,C=this._ty,x=u*P-g*y,k=null;if(x&&!isNaN(x)&&isFinite(L)&&isFinite(C)){var M=r.x-this._tx,E=r.y-this._ty;a||(a=new T),k=a._set((M*P-E*y)/x,(E*u-M*g)/x,l)}return k},decompose:function(){var r=this._a,a=this._b,l=this._c,u=this._d,g=r*u-a*l,y=Math.sqrt,P=Math.atan2,L=180/Math.PI,C,x,k;if(r!==0||a!==0){var M=y(r*r+a*a);C=Math.acos(r/M)*(a>0?1:-1),x=[M,g/M],k=[P(r*l+a*u,M*M),0]}else if(l!==0||u!==0){var E=y(l*l+u*u);C=Math.asin(l/E)*(u>0?1:-1),x=[g/E,E],k=[0,P(r*l+a*u,E*E)]}else C=0,k=x=[0,0];return{translation:this.getTranslation(),rotation:C*L,scaling:new T(x),skewing:new T(k[0]*L,k[1]*L)}},getValues:function(){return[this._a,this._b,this._c,this._d,this._tx,this._ty]},getTranslation:function(){return new T(this._tx,this._ty)},getScaling:function(){return this.decompose().scaling},getRotation:function(){return this.decompose().rotation},applyToContext:function(r){this.isIdentity()||r.transform(this._a,this._b,this._c,this._d,this._tx,this._ty)}},s.each(["a","b","c","d","tx","ty"],function(r){var a=s.capitalize(r),l="_"+r;this["get"+a]=function(){return this[l]},this["set"+a]=function(u){this[l]=u,this._changed()}},{})),xe=s.extend({_class:"Line",initialize:function(a,l,u,g,y){var P=!1;arguments.length>=4?(this._px=a,this._py=l,this._vx=u,this._vy=g,P=y):(this._px=a.x,this._py=a.y,this._vx=l.x,this._vy=l.y,P=u),P||(this._vx-=this._px,this._vy-=this._py)},getPoint:function(){return new T(this._px,this._py)},getVector:function(){return new T(this._vx,this._vy)},getLength:function(){return this.getVector().getLength()},intersect:function(r,a){return xe.intersect(this._px,this._py,this._vx,this._vy,r._px,r._py,r._vx,r._vy,!0,a)},getSide:function(r,a){return xe.getSide(this._px,this._py,this._vx,this._vy,r.x,r.y,!0,a)},getDistance:function(r){return Math.abs(this.getSignedDistance(r))},getSignedDistance:function(r){return xe.getSignedDistance(this._px,this._py,this._vx,this._vy,r.x,r.y,!0)},isCollinear:function(r){return T.isCollinear(this._vx,this._vy,r._vx,r._vy)},isOrthogonal:function(r){return T.isOrthogonal(this._vx,this._vy,r._vx,r._vy)},statics:{intersect:function(r,a,l,u,g,y,P,L,C,x){C||(l-=r,u-=a,P-=g,L-=y);var k=l*L-u*P;if(!w.isMachineZero(k)){var M=r-g,E=a-y,D=(P*E-L*M)/k,B=(l*E-u*M)/k,W=1e-12,q=-W,F=1+W;if(x||q<D&&D<F&&q<B&&B<F)return x||(D=D<=0?0:D>=1?1:D),new T(r+D*l,a+D*u)}},getSide:function(r,a,l,u,g,y,P,L){P||(l-=r,u-=a);var C=g-r,x=y-a,k=C*u-x*l;return!L&&w.isMachineZero(k)&&(k=(C*l+C*l)/(l*l+u*u),k>=0&&k<=1&&(k=0)),k<0?-1:k>0?1:0},getSignedDistance:function(r,a,l,u,g,y,P){return P||(l-=r,u-=a),l===0?u>0?g-r:r-g:u===0?l<0?y-a:a-y:((g-r)*u-(y-a)*l)/(u>l?u*Math.sqrt(1+l*l/(u*u)):l*Math.sqrt(1+u*u/(l*l)))},getDistance:function(r,a,l,u,g,y,P){return Math.abs(xe.getSignedDistance(r,a,l,u,g,y,P))}}}),ce=c.extend({_class:"Project",_list:"projects",_reference:"project",_compactSerialize:!0,initialize:function(a){c.call(this,!0),this._children=[],this._namedChildren={},this._activeLayer=null,this._currentStyle=new Oi(null,null,this),this._view=jt.create(this,a||re.getCanvas(1,1)),this._selectionItems={},this._selectionCount=0,this._updateVersion=0},_serialize:function(r,a){return s.serialize(this._children,r,!0,a)},_changed:function(r,a){if(r&1){var l=this._view;l&&(l._needsUpdate=!0,!l._requested&&l._autoUpdate&&l.requestUpdate())}var u=this._changes;if(u&&a){var g=this._changesById,y=a._id,P=g[y];P?P.flags|=r:u.push(g[y]={item:a,flags:r})}},clear:function(){for(var r=this._children,a=r.length-1;a>=0;a--)r[a].remove()},isEmpty:function(){return!this._children.length},remove:function r(){return r.base.call(this)?(this._view&&this._view.remove(),!0):!1},getView:function(){return this._view},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(r){this._currentStyle.set(r)},getIndex:function(){return this._index},getOptions:function(){return this._scope.settings},getLayers:function(){return this._children},getActiveLayer:function(){return this._activeLayer||new Fe({project:this,insert:!0})},getSymbolDefinitions:function(){var r=[],a={};return this.getItems({class:Me,match:function(l){var u=l._definition,g=u._id;return a[g]||(a[g]=!0,r.push(u)),!1}}),r},getSymbols:"getSymbolDefinitions",getSelectedItems:function(){var r=this._selectionItems,a=[];for(var l in r){var u=r[l],g=u._selection;g&1&&u.isInserted()?a.push(u):g||this._updateSelection(u)}return a},_updateSelection:function(r){var a=r._id,l=this._selectionItems;r._selection?l[a]!==r&&(this._selectionCount++,l[a]=r):l[a]===r&&(this._selectionCount--,delete l[a])},selectAll:function(){for(var r=this._children,a=0,l=r.length;a<l;a++)r[a].setFullySelected(!0)},deselectAll:function(){var r=this._selectionItems;for(var a in r)r[a].setFullySelected(!1)},addLayer:function(r){return this.insertLayer(t,r)},insertLayer:function(r,a){if(a instanceof Fe){a._remove(!1,!0),s.splice(this._children,[a],r,0),a._setProject(this,!0);var l=a._name;l&&a.setName(l),this._changes&&a._changed(5),this._activeLayer||(this._activeLayer=a)}else a=null;return a},_insertItem:function(r,a,l){return a=this.insertLayer(r,a)||(this._activeLayer||this._insertItem(t,new Fe(ne.NO_INSERT),!0)).insertChild(r,a),l&&a.activate&&a.activate(),a},getItems:function(r){return ne._getItems(this,r)},getItem:function(r){return ne._getItems(this,r,null,null,!0)[0]||null},importJSON:function(r){this.activate();var a=this._activeLayer;return s.importJSON(r,a&&a.isEmpty()&&a)},removeOn:function(r){var a=this._removeSets;if(a){r==="mouseup"&&(a.mousedrag=null);var l=a[r];if(l){for(var u in l){var g=l[u];for(var y in a){var P=a[y];P&&P!=l&&delete P[g._id]}g.remove()}a[r]=null}}},draw:function(r,a,l){this._updateVersion++,r.save(),a.applyToContext(r);for(var u=this._children,g=new s({offset:new T(0,0),pixelRatio:l,viewMatrix:a.isIdentity()?null:a,matrices:[new le],updateMatrix:!0}),y=0,P=u.length;y<P;y++)u[y].draw(r,g);if(r.restore(),this._selectionCount>0){r.save(),r.strokeWidth=1;var L=this._selectionItems,C=this._scope.settings.handleSize,x=this._updateVersion;for(var k in L)L[k]._drawSelection(r,a,C,L,x);r.restore()}}}),ne=s.extend(n,{statics:{extend:function r(a){return a._serializeFields&&(a._serializeFields=s.set({},this.prototype._serializeFields,a._serializeFields)),r.base.apply(this,arguments)},INSERT:{insert:!0},NO_INSERT:{insert:!1}},_class:"Item",_name:null,_applyMatrix:!0,_canApplyMatrix:!0,_canScaleStroke:!1,_pivot:null,_visible:!0,_blendMode:"normal",_opacity:1,_locked:!1,_guide:!1,_clipMask:!1,_selection:0,_selectBounds:!0,_selectChildren:!1,_serializeFields:{name:null,applyMatrix:null,matrix:new le,pivot:null,visible:!0,blendMode:"normal",opacity:1,locked:!1,guide:!1,clipMask:!1,selected:!1,data:{}},_prioritize:["applyMatrix"]},new function(){var r=["onMouseDown","onMouseUp","onMouseDrag","onClick","onDoubleClick","onMouseMove","onMouseEnter","onMouseLeave"];return s.each(r,function(a){this._events[a]={install:function(l){this.getView()._countItemEvent(l,1)},uninstall:function(l){this.getView()._countItemEvent(l,-1)}}},{_events:{onFrame:{install:function(){this.getView()._animateItem(this,!0)},uninstall:function(){this.getView()._animateItem(this,!1)}},onLoad:{},onError:{}},statics:{_itemHandlers:r}})},{initialize:function(){},_initialize:function(r,a){var l=r&&s.isPlainObject(r),u=l&&r.internal===!0,g=this._matrix=new le,y=l&&r.project||Be.project,P=Be.settings;return this._id=u?null:O.get(),this._parent=this._index=null,this._applyMatrix=this._canApplyMatrix&&P.applyMatrix,a&&g.translate(a),g._owner=this,this._style=new Oi(y._currentStyle,this,y),u||l&&r.insert==!1||!P.insertItems&&!(l&&r.insert==!0)?this._setProject(y):(l&&r.parent||y)._insertItem(t,this,!0),l&&r!==ne.NO_INSERT&&r!==ne.INSERT&&this.set(r,{internal:!0,insert:!0,project:!0,parent:!0}),l},_serialize:function(r,a){var l={},u=this;function g(y){for(var P in y){var L=u[P];s.equals(L,P==="leading"?y.fontSize*1.2:y[P])||(l[P]=s.serialize(L,r,P!=="data",a))}}return g(this._serializeFields),this instanceof me||g(this._style._defaults),[this._class,l]},_changed:function(r){var a=this._symbol,l=this._parent||a,u=this._project;r&8&&(this._bounds=this._position=this._decomposed=t),r&16&&(this._globalMatrix=t),l&&r&72&&ne._clearBoundsCache(l),r&2&&ne._clearBoundsCache(this),u&&u._changed(r,this),a&&a._changed(r)},getId:function(){return this._id},getName:function(){return this._name},setName:function(r){if(this._name&&this._removeNamed(),r===+r+"")throw new Error("Names consisting only of numbers are not supported.");var a=this._getOwner();if(r&&a){var l=a._children,u=a._namedChildren;(u[r]=u[r]||[]).push(this),r in l||(l[r]=this)}this._name=r||t,this._changed(256)},getStyle:function(){return this._style},setStyle:function(r){this.getStyle().set(r)}},s.each(["locked","visible","blendMode","opacity","guide"],function(r){var a=s.capitalize(r),l="_"+r,u={locked:256,visible:265};this["get"+a]=function(){return this[l]},this["set"+a]=function(g){g!=this[l]&&(this[l]=g,this._changed(u[r]||257))}},{}),{beans:!0,getSelection:function(){return this._selection},setSelection:function(r){if(r!==this._selection){this._selection=r;var a=this._project;a&&(a._updateSelection(this),this._changed(257))}},_changeSelection:function(r,a){var l=this._selection;this.setSelection(a?l|r:l&~r)},isSelected:function(){if(this._selectChildren){for(var r=this._children,a=0,l=r.length;a<l;a++)if(r[a].isSelected())return!0}return!!(this._selection&1)},setSelected:function(r){if(this._selectChildren)for(var a=this._children,l=0,u=a.length;l<u;l++)a[l].setSelected(r);this._changeSelection(1,r)},isFullySelected:function(){var r=this._children,a=!!(this._selection&1);if(r&&a){for(var l=0,u=r.length;l<u;l++)if(!r[l].isFullySelected())return!1;return!0}return a},setFullySelected:function(r){var a=this._children;if(a)for(var l=0,u=a.length;l<u;l++)a[l].setFullySelected(r);this._changeSelection(1,r)},isClipMask:function(){return this._clipMask},setClipMask:function(r){this._clipMask!=(r=!!r)&&(this._clipMask=r,r&&(this.setFillColor(null),this.setStrokeColor(null)),this._changed(257),this._parent&&this._parent._changed(2048))},getData:function(){return this._data||(this._data={}),this._data},setData:function(r){this._data=r},getPosition:function(r){var a=r?T:z,l=this._position||(this._position=this._getPositionFromBounds());return new a(l.x,l.y,this,"setPosition")},setPosition:function(){this.translate(T.read(arguments).subtract(this.getPosition(!0)))},_getPositionFromBounds:function(r){return this._pivot?this._matrix._transformPoint(this._pivot):(r||this.getBounds()).getCenter(!0)},getPivot:function(){var r=this._pivot;return r?new z(r.x,r.y,this,"setPivot"):null},setPivot:function(){this._pivot=T.read(arguments,0,{clone:!0,readNull:!0}),this._position=t}},s.each({getStrokeBounds:{stroke:!0},getHandleBounds:{handle:!0},getInternalBounds:{internal:!0}},function(r,a){this[a]=function(l){return this.getBounds(l,r)}},{beans:!0,getBounds:function(r,a){var l=a||r instanceof le,u=s.set({},l?a:r,this._boundsOptions);(!u.stroke||this.getStrokeScaling())&&(u.cacheItem=this);var g=this._getCachedBounds(l&&r,u).rect;return arguments.length?g:new j(g.x,g.y,g.width,g.height,this,"setBounds")},setBounds:function(){var r=Y.read(arguments),a=this.getBounds(),l=this._matrix,u=new le,g=r.getCenter();u.translate(g),(r.width!=a.width||r.height!=a.height)&&(l.isInvertible()||(l.set(l._backup||new le().translate(l.getTranslation())),a=this.getBounds()),u.scale(a.width!==0?r.width/a.width:0,a.height!==0?r.height/a.height:0)),g=a.getCenter(),u.translate(-g.x,-g.y),this.transform(u)},_getBounds:function(r,a){var l=this._children;return!l||!l.length?new Y:(ne._updateBoundsCache(this,a.cacheItem),ne._getBounds(l,r,a))},_getBoundsCacheKey:function(r,a){return[r.stroke?1:0,r.handle?1:0,a?1:0].join("")},_getCachedBounds:function(r,a,l){r=r&&r._orNullIfIdentity();var u=a.internal&&!l,g=a.cacheItem,y=u?null:this._matrix._orNullIfIdentity(),P=g&&(!r||r.equals(y))&&this._getBoundsCacheKey(a,u),L=this._bounds;if(ne._updateBoundsCache(this._parent||this._symbol,g),P&&L&&P in L){var C=L[P];return{rect:C.rect.clone(),nonscaling:C.nonscaling}}var x=this._getBounds(r||y,a),k=x.rect||x,M=this._style,E=x.nonscaling||M.hasStroke()&&!M.getStrokeScaling();if(P){L||(this._bounds=L={});var C=L[P]={rect:k.clone(),nonscaling:E,internal:u}}return{rect:k,nonscaling:E}},_getStrokeMatrix:function(r,a){var l=this.getStrokeScaling()?null:a&&a.internal?this:this._parent||this._symbol&&this._symbol._item,u=l?l.getViewMatrix().invert():r;return u&&u._shiftless()},statics:{_updateBoundsCache:function(r,a){if(r&&a){var l=a._id,u=r._boundsCache=r._boundsCache||{ids:{},list:[]};u.ids[l]||(u.list.push(a),u.ids[l]=a)}},_clearBoundsCache:function(r){var a=r._boundsCache;if(a){r._bounds=r._position=r._boundsCache=t;for(var l=0,u=a.list,g=u.length;l<g;l++){var y=u[l];y!==r&&(y._bounds=y._position=t,y._boundsCache&&ne._clearBoundsCache(y))}}},_getBounds:function(r,a,l){var u=1/0,g=-u,y=u,P=g,L=!1;l=l||{};for(var C=0,x=r.length;C<x;C++){var k=r[C];if(k._visible&&!k.isEmpty(!0)){var M=k._getCachedBounds(a&&a.appended(k._matrix),l,!0),E=M.rect;u=Math.min(E.x,u),y=Math.min(E.y,y),g=Math.max(E.x+E.width,g),P=Math.max(E.y+E.height,P),M.nonscaling&&(L=!0)}}return{rect:isFinite(u)?new Y(u,y,g-u,P-y):new Y,nonscaling:L}}}}),{beans:!0,_decompose:function(){return this._applyMatrix?null:this._decomposed||(this._decomposed=this._matrix.decompose())},getRotation:function(){var r=this._decompose();return r?r.rotation:0},setRotation:function(r){var a=this.getRotation();if(a!=null&&r!=null){var l=this._decomposed;this.rotate(r-a),l&&(l.rotation=r,this._decomposed=l)}},getScaling:function(){var r=this._decompose(),a=r&&r.scaling;return new z(a?a.x:1,a?a.y:1,this,"setScaling")},setScaling:function(){var r=this.getScaling(),a=T.read(arguments,0,{clone:!0,readNull:!0});if(r&&a&&!r.equals(a)){var l=this.getRotation(),u=this._decomposed,g=new le,y=w.isZero;if(y(r.x)||y(r.y))g.translate(u.translation),l&&g.rotate(l),g.scale(a.x,a.y),this._matrix.set(g);else{var P=this.getPosition(!0);g.translate(P),l&&g.rotate(l),g.scale(a.x/r.x,a.y/r.y),l&&g.rotate(-l),g.translate(P.negate()),this.transform(g)}u&&(u.scaling=a,this._decomposed=u)}},getMatrix:function(){return this._matrix},setMatrix:function(){var r=this._matrix;r.set.apply(r,arguments)},getGlobalMatrix:function(r){var a=this._globalMatrix;if(a)for(var l=this._parent,u=[];l;){if(!l._globalMatrix){a=null;for(var g=0,y=u.length;g<y;g++)u[g]._globalMatrix=null;break}u.push(l),l=l._parent}if(!a){a=this._globalMatrix=this._matrix.clone();var l=this._parent;l&&a.prepend(l.getGlobalMatrix(!0))}return r?a:a.clone()},getViewMatrix:function(){return this.getGlobalMatrix().prepend(this.getView()._matrix)},getApplyMatrix:function(){return this._applyMatrix},setApplyMatrix:function(r){(this._applyMatrix=this._canApplyMatrix&&!!r)&&this.transform(null,!0)},getTransformContent:"#getApplyMatrix",setTransformContent:"#setApplyMatrix"},{getProject:function(){return this._project},_setProject:function(r,a){if(this._project!==r){this._project&&this._installEvents(!1),this._project=r;for(var l=this._children,u=0,g=l&&l.length;u<g;u++)l[u]._setProject(r);a=!0}a&&this._installEvents(!0)},getView:function(){return this._project._view},_installEvents:function r(a){r.base.call(this,a);for(var l=this._children,u=0,g=l&&l.length;u<g;u++)l[u]._installEvents(a)},getLayer:function(){for(var r=this;r=r._parent;)if(r instanceof Fe)return r;return null},getParent:function(){return this._parent},setParent:function(r){return r.addChild(this)},_getOwner:"#getParent",getChildren:function(){return this._children},setChildren:function(r){this.removeChildren(),this.addChildren(r)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){var r=this._getOwner();return r&&r._children[this._index+1]||null},getPreviousSibling:function(){var r=this._getOwner();return r&&r._children[this._index-1]||null},getIndex:function(){return this._index},equals:function(r){return r===this||r&&this._class===r._class&&this._style.equals(r._style)&&this._matrix.equals(r._matrix)&&this._locked===r._locked&&this._visible===r._visible&&this._blendMode===r._blendMode&&this._opacity===r._opacity&&this._clipMask===r._clipMask&&this._guide===r._guide&&this._equals(r)||!1},_equals:function(r){return s.equals(this._children,r._children)},clone:function(r){var a=new this.constructor(ne.NO_INSERT),l=this._children,u=s.pick(r?r.insert:t,r===t||r===!0),g=s.pick(r?r.deep:t,!0);l&&a.copyAttributes(this),(!l||g)&&a.copyContent(this),l||a.copyAttributes(this),u&&a.insertAbove(this);var y=this._name,P=this._parent;if(y&&P){for(var l=P._children,L=y,C=1;l[y];)y=L+" "+C++;y!==L&&a.setName(y)}return a},copyContent:function(r){for(var a=r._children,l=0,u=a&&a.length;l<u;l++)this.addChild(a[l].clone(!1),!0)},copyAttributes:function(r,a){this.setStyle(r._style);for(var l=["_locked","_visible","_blendMode","_opacity","_clipMask","_guide"],u=0,g=l.length;u<g;u++){var y=l[u];r.hasOwnProperty(y)&&(this[y]=r[y])}a||this._matrix.set(r._matrix,!0),this.setApplyMatrix(r._applyMatrix),this.setPivot(r._pivot),this.setSelection(r._selection);var P=r._data,L=r._name;this._data=P?s.clone(P):null,L&&this.setName(L)},rasterize:function(r,a){var l,u,g;s.isPlainObject(r)?(l=r.resolution,u=r.insert,g=r.raster):(l=r,u=a),g||(g=new He(ne.NO_INSERT));var y=this.getStrokeBounds(),P=(l||this.getView().getResolution())/72,L=y.getTopLeft().floor(),C=y.getBottomRight().ceil(),x=new U(C.subtract(L)),k=x.multiply(P);if(g.setSize(k,!0),!k.isZero()){var M=g.getContext(!0),E=new le().scale(P).translate(L.negate());M.save(),E.applyToContext(M),this.draw(M,new s({matrices:[E]})),M.restore()}return g._matrix.set(new le().translate(L.add(x.divide(2))).scale(1/P)),(u===t||u)&&g.insertAbove(this),g},contains:function(){var r=this._matrix;return r.isInvertible()&&!!this._contains(r._inverseTransform(T.read(arguments)))},_contains:function(r){var a=this._children;if(a){for(var l=a.length-1;l>=0;l--)if(a[l].contains(r))return!0;return!1}return r.isInside(this.getInternalBounds())},isInside:function(){return Y.read(arguments).contains(this.getBounds())},_asPathItem:function(){return new Ve.Rectangle({rectangle:this.getInternalBounds(),matrix:this._matrix,insert:!1})},intersects:function(r,a){return r instanceof ne?this._asPathItem().getIntersections(r._asPathItem(),null,a,!0).length>0:!1}},new function(){function r(){var u=arguments;return this._hitTest(T.read(u),Je.getOptions(u))}function a(){var u=arguments,g=T.read(u),y=Je.getOptions(u),P=[];return this._hitTest(g,new s({all:P},y)),P}function l(u,g,y,P){var L=this._children;if(L)for(var C=L.length-1;C>=0;C--){var x=L[C],k=x!==P&&x._hitTest(u,g,y);if(k&&!g.all)return k}return null}return ce.inject({hitTest:r,hitTestAll:a,_hitTest:l}),{hitTest:r,hitTestAll:a,_hitTestChildren:l}},{_hitTest:function(r,a,l){if(this._locked||!this._visible||this._guide&&!a.guides||this.isEmpty())return null;var u=this._matrix,g=l?l.appended(u):this.getGlobalMatrix().prepend(this.getView()._matrix),y=Math.max(a.tolerance,1e-12),P=a._tolerancePadding=new U(Ve._getStrokePadding(y,u._shiftless().invert()));if(r=u._inverseTransform(r),!r||!this._children&&!this.getBounds({internal:!0,stroke:!0,handle:!0}).expand(P.multiply(2))._containsPoint(r))return null;var L=!(a.guides&&!this._guide||a.selected&&!this.isSelected()||a.type&&a.type!==s.hyphenate(this._class)||a.class&&!(this instanceof a.class)),C=a.match,x=this,k,M;function E(A){return A&&C&&!C(A)&&(A=null),A&&a.all&&a.all.push(A),A}function D(A,N){var G=N?k["get"+N]():x.getPosition();if(r.subtract(G).divide(P).length<=1)return new Je(A,x,{name:N?s.hyphenate(N):A,point:G})}var B=a.position,W=a.center,q=a.bounds;if(L&&this._parent&&(B||W||q)){if((W||q)&&(k=this.getInternalBounds()),M=B&&D("position")||W&&D("center","Center"),!M&&q)for(var F=["TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],V=0;V<8&&!M;V++)M=D("bounds",F[V]);M=E(M)}return M||(M=this._hitTestChildren(r,a,g)||L&&E(this._hitTestSelf(r,a,g,this.getStrokeScaling()?null:g._shiftless().invert()))||null),M&&M.point&&(M.point=u.transform(M.point)),M},_hitTestSelf:function(r,a){if(a.fill&&this.hasFill()&&this._contains(r))return new Je("fill",this)},matches:function(r,a){function l(P,L){for(var C in P)if(P.hasOwnProperty(C)){var x=P[C],k=L[C];if(s.isPlainObject(x)&&s.isPlainObject(k)){if(!l(x,k))return!1}else if(!s.equals(x,k))return!1}return!0}var u=typeof r;if(u==="object"){for(var g in r)if(r.hasOwnProperty(g)&&!this.matches(g,r[g]))return!1;return!0}else{if(u==="function")return r(this);if(r==="match")return a(this);var y=/^(empty|editable)$/.test(r)?this["is"+s.capitalize(r)]():r==="type"?s.hyphenate(this._class):this[r];if(r==="class"){if(typeof a=="function")return this instanceof a;y=this._class}if(typeof a=="function")return!!a(y);if(a){if(a.test)return a.test(y);if(s.isPlainObject(a))return l(a,y)}return s.equals(y,a)}},getItems:function(r){return ne._getItems(this,r,this._matrix)},getItem:function(r){return ne._getItems(this,r,this._matrix,null,!0)[0]||null},statics:{_getItems:function r(a,l,u,g,y){if(!g){var P=typeof l=="object"&&l,L=P&&P.overlapping,C=P&&P.inside,x=L||C,E=x&&Y.read([x]);g={items:[],recursive:P&&P.recursive!==!1,inside:!!C,overlapping:!!L,rect:E,path:L&&new Ve.Rectangle({rectangle:E,insert:!1})},P&&(l=s.filter({},l,{recursive:!0,inside:!0,overlapping:!0}))}var k=a._children,M=g.items,E=g.rect;u=E&&(u||new le);for(var D=0,B=k&&k.length;D<B;D++){var W=k[D],q=u&&u.appended(W._matrix),F=!0;if(E){var x=W.getBounds(q);if(!E.intersects(x))continue;E.contains(x)||g.overlapping&&(x.contains(E)||g.path.intersects(W,q))||(F=!1)}if(F&&W.matches(l)&&(M.push(W),y)||(g.recursive!==!1&&r(W,l,q,g,y),y&&M.length>0))break}return M}}},{importJSON:function(r){var a=s.importJSON(r,this);return a!==this?this.addChild(a):a},addChild:function(r){return this.insertChild(t,r)},insertChild:function(r,a){var l=a?this.insertChildren(r,[a]):null;return l&&l[0]},addChildren:function(r){return this.insertChildren(this._children.length,r)},insertChildren:function(r,a){var l=this._children;if(l&&a&&a.length>0){a=s.slice(a);for(var u={},g=a.length-1;g>=0;g--){var y=a[g],P=y&&y._id;!y||u[P]?a.splice(g,1):(y._remove(!1,!0),u[P]=!0)}s.splice(l,a,r,0);for(var L=this._project,C=L._changes,g=0,x=a.length;g<x;g++){var y=a[g],k=y._name;y._parent=this,y._setProject(L,!0),k&&y.setName(k),C&&y._changed(5)}this._changed(11)}else a=null;return a},_insertItem:"#insertChild",_insertAt:function(r,a){var l=r&&r._getOwner(),u=r!==this&&l?this:null;return u&&(u._remove(!1,!0),l._insertItem(r._index+a,u)),u},insertAbove:function(r){return this._insertAt(r,1)},insertBelow:function(r){return this._insertAt(r,0)},sendToBack:function(){var r=this._getOwner();return r?r._insertItem(0,this):null},bringToFront:function(){var r=this._getOwner();return r?r._insertItem(t,this):null},appendTop:"#addChild",appendBottom:function(r){return this.insertChild(0,r)},moveAbove:"#insertAbove",moveBelow:"#insertBelow",addTo:function(r){return r._insertItem(t,this)},copyTo:function(r){return this.clone(!1).addTo(r)},reduce:function(r){var a=this._children;if(a&&a.length===1){var l=a[0].reduce(r);return this._parent?(l.insertAbove(this),this.remove()):l.remove(),l}return this},_removeNamed:function(){var r=this._getOwner();if(r){var a=r._children,l=r._namedChildren,u=this._name,g=l[u],y=g?g.indexOf(this):-1;y!==-1&&(a[u]==this&&delete a[u],g.splice(y,1),g.length?a[u]=g[0]:delete l[u])}},_remove:function(r,a){var l=this._getOwner(),u=this._project,g=this._index;return this._style&&this._style._dispose(),l?(this._name&&this._removeNamed(),g!=null&&(u._activeLayer===this&&(u._activeLayer=this.getNextSibling()||this.getPreviousSibling()),s.splice(l._children,null,g,1)),this._installEvents(!1),r&&u._changes&&this._changed(5),a&&l._changed(11,this),this._parent=null,!0):!1},remove:function(){return this._remove(!0,!0)},replaceWith:function(r){var a=r&&r.insertBelow(this);return a&&this.remove(),a},removeChildren:function(r,a){if(!this._children)return null;r=r||0,a=s.pick(a,this._children.length);for(var l=s.splice(this._children,null,r,a-r),u=l.length-1;u>=0;u--)l[u]._remove(!0,!1);return l.length>0&&this._changed(11),l},clear:"#removeChildren",reverseChildren:function(){if(this._children){this._children.reverse();for(var r=0,a=this._children.length;r<a;r++)this._children[r]._index=r;this._changed(11)}},isEmpty:function(r){var a=this._children,l=a?a.length:0;if(r){for(var u=0;u<l;u++)if(!a[u].isEmpty(r))return!1;return!0}return!l},isEditable:function(){for(var r=this;r;){if(!r._visible||r._locked)return!1;r=r._parent}return!0},hasFill:function(){return this.getStyle().hasFill()},hasStroke:function(){return this.getStyle().hasStroke()},hasShadow:function(){return this.getStyle().hasShadow()},_getOrder:function(r){function a(P){var L=[];do L.unshift(P);while(P=P._parent);return L}for(var l=a(this),u=a(r),g=0,y=Math.min(l.length,u.length);g<y;g++)if(l[g]!=u[g])return l[g]._index<u[g]._index?1:-1;return 0},hasChildren:function(){return this._children&&this._children.length>0},isInserted:function(){return this._parent?this._parent.isInserted():!1},isAbove:function(r){return this._getOrder(r)===-1},isBelow:function(r){return this._getOrder(r)===1},isParent:function(r){return this._parent===r},isChild:function(r){return r&&r._parent===this},isDescendant:function(r){for(var a=this;a=a._parent;)if(a===r)return!0;return!1},isAncestor:function(r){return r?r.isDescendant(this):!1},isSibling:function(r){return this._parent===r._parent},isGroupedWith:function(r){for(var a=this._parent;a;){if(a._parent&&/^(Group|Layer|CompoundPath)$/.test(a._class)&&r.isDescendant(a))return!0;a=a._parent}return!1}},s.each(["rotate","scale","shear","skew"],function(r){var a=r==="rotate";this[r]=function(){var l=arguments,u=(a?s:T).read(l),g=T.read(l,0,{readNull:!0});return this.transform(new le()[r](u,g||this.getPosition(!0)))}},{translate:function(){var r=new le;return this.transform(r.translate.apply(r,arguments))},transform:function(r,a,l){var u=this._matrix,g=r&&!r.isIdentity(),y=l&&this._canApplyMatrix||this._applyMatrix&&(g||!u.isIdentity()||a&&this._children);if(!g&&!y)return this;if(g){!r.isInvertible()&&u.isInvertible()&&(u._backup=u.getValues()),u.prepend(r,!0);var P=this._style,L=P.getFillColor(!0),C=P.getStrokeColor(!0);L&&L.transform(r),C&&C.transform(r)}if(y&&(y=this._transformContent(u,a,l))){var x=this._pivot;x&&u._transformPoint(x,x,!0),u.reset(!0),l&&this._canApplyMatrix&&(this._applyMatrix=!0)}var k=this._bounds,M=this._position;(g||y)&&this._changed(25);var E=g&&k&&r.decompose();if(E&&E.skewing.isZero()&&E.rotation%90===0){for(var D in k){var B=k[D];if(B.nonscaling)delete k[D];else if(y||!B.internal){var W=B.rect;r._transformBounds(W,W)}}this._bounds=k;var q=k[this._getBoundsCacheKey(this._boundsOptions||{})];q&&(this._position=this._getPositionFromBounds(q.rect))}else g&&M&&this._pivot&&(this._position=r._transformPoint(M,M));return this},_transformContent:function(r,a,l){var u=this._children;if(u){for(var g=0,y=u.length;g<y;g++)u[g].transform(r,a,l);return!0}},globalToLocal:function(){return this.getGlobalMatrix(!0)._inverseTransform(T.read(arguments))},localToGlobal:function(){return this.getGlobalMatrix(!0)._transformPoint(T.read(arguments))},parentToLocal:function(){return this._matrix._inverseTransform(T.read(arguments))},localToParent:function(){return this._matrix._transformPoint(T.read(arguments))},fitBounds:function(r,a){r=Y.read(arguments);var l=this.getBounds(),u=l.height/l.width,g=r.height/r.width,y=(a?u>g:u<g)?r.width/l.width:r.height/l.height,P=new Y(new T,new U(l.width*y,l.height*y));P.setCenter(r.getCenter()),this.setBounds(P)}}),{_setStyles:function(r,a,l){var u=this._style,g=this._matrix;if(u.hasFill()&&(r.fillStyle=u.getFillColor().toCanvasStyle(r,g)),u.hasStroke()){r.strokeStyle=u.getStrokeColor().toCanvasStyle(r,g),r.lineWidth=u.getStrokeWidth();var y=u.getStrokeJoin(),P=u.getStrokeCap(),L=u.getMiterLimit();if(y&&(r.lineJoin=y),P&&(r.lineCap=P),L&&(r.miterLimit=L),Be.support.nativeDash){var C=u.getDashArray(),x=u.getDashOffset();C&&C.length&&("setLineDash"in r?(r.setLineDash(C),r.lineDashOffset=x):(r.mozDash=C,r.mozDashOffset=x))}}if(u.hasShadow()){var k=a.pixelRatio||1,M=l._shiftless().prepend(new le().scale(k,k)),E=M.transform(new T(u.getShadowBlur(),0)),D=M.transform(this.getShadowOffset());r.shadowColor=u.getShadowColor().toCanvasStyle(r),r.shadowBlur=E.getLength(),r.shadowOffsetX=D.x,r.shadowOffsetY=D.y}},draw:function(r,a,l){if(this._updateVersion=this._project._updateVersion,!(!this._visible||this._opacity===0)){var u=a.matrices,g=a.viewMatrix,y=this._matrix,P=u[u.length-1].appended(y);if(P.isInvertible()){g=g?g.appended(P):P,u.push(P),a.updateMatrix&&(this._globalMatrix=P);var L=this._blendMode,C=w.clamp(this._opacity,0,1),x=L==="normal",k=ye.nativeModes[L],M=x&&C===1||a.dontStart||a.clip||(k||x&&C<1)&&this._canComposite(),E=a.pixelRatio||1,D,B,W;if(!M){var q=this.getStrokeBounds(g);if(!q.width||!q.height){u.pop();return}W=a.offset,B=a.offset=q.getTopLeft().floor(),D=r,r=re.getContext(q.getSize().ceil().add(1).multiply(E)),E!==1&&r.scale(E,E)}r.save();var F=l?l.appended(y):this._canScaleStroke&&!this.getStrokeScaling(!0)&&g,V=!M&&a.clipItem,A=!F||V;if(M?(r.globalAlpha=C,k&&(r.globalCompositeOperation=L)):A&&r.translate(-B.x,-B.y),A&&(M?y:g).applyToContext(r),V&&a.clipItem.draw(r,a.extend({clip:!0})),F){r.setTransform(E,0,0,E,0,0);var N=a.offset;N&&r.translate(-N.x,-N.y)}this._draw(r,a,g,F),r.restore(),u.pop(),a.clip&&!a.dontFinish&&r.clip(this.getFillRule()),M||(ye.process(L,r,D,C,B.subtract(W).multiply(E)),re.release(r),a.offset=W)}}},_isUpdated:function(r){var a=this._parent;if(a instanceof Qe)return a._isUpdated(r);var l=this._updateVersion===r;return!l&&a&&a._visible&&a._isUpdated(r)&&(this._updateVersion=r,l=!0),l},_drawSelection:function(r,a,l,u,g){var y=this._selection,P=y&1,L=y&2||P&&this._selectBounds,C=y&4;if(this._drawSelected||(P=!1),(P||L||C)&&this._isUpdated(g)){var x,k=this.getSelectedColor(!0)||(x=this.getLayer())&&x.getSelectedColor(!0),M=a.appended(this.getGlobalMatrix(!0)),E=l/2;if(r.strokeStyle=r.fillStyle=k?k.toCanvasStyle(r):"#009dec",P&&this._drawSelected(r,M,u),C){var D=this.getPosition(!0),B=this._parent,W=B?B.localToGlobal(D):D,q=W.x,F=W.y;r.beginPath(),r.arc(q,F,E,0,Math.PI*2,!0),r.stroke();for(var V=[[0,-1],[1,0],[0,1],[-1,0]],A=E,N=l+1,G=0;G<4;G++){var K=V[G],Z=K[0],ee=K[1];r.moveTo(q+Z*A,F+ee*A),r.lineTo(q+Z*N,F+ee*N),r.stroke()}}if(L){var se=M._transformCorners(this.getInternalBounds());r.beginPath();for(var G=0;G<8;G++)r[G?"lineTo":"moveTo"](se[G],se[++G]);r.closePath(),r.stroke();for(var G=0;G<8;G++)r.fillRect(se[G]-E,se[++G]-E,l,l)}}},_canComposite:function(){return!1}},s.each(["down","drag","up","move"],function(r){this["removeOn"+s.capitalize(r)]=function(){var a={};return a[r]=!0,this.removeOn(a)}},{removeOn:function(r){for(var a in r)if(r[a]){var l="mouse"+a,u=this._project,g=u._removeSets=u._removeSets||{};g[l]=g[l]||{},g[l][this._id]=this}return this}}),{tween:function(r,a,l){l||(l=a,a=r,r=null,l||(l=a,a=null));var u=l&&l.easing,g=l&&l.start,y=l!=null&&(typeof l=="number"?l:l.duration),P=new J(this,r,a,y,u,g);function L(C){P._handleFrame(C.time*1e3),P.running||this.off("frame",L)}return y&&this.on("frame",L),P},tweenTo:function(r,a){return this.tween(null,r,a)},tweenFrom:function(r,a){return this.tween(r,null,a)}}),me=ne.extend({_class:"Group",_selectBounds:!1,_selectChildren:!0,_serializeFields:{children:[]},initialize:function(a){this._children=[],this._namedChildren={},this._initialize(a)||this.addChildren(Array.isArray(a)?a:arguments)},_changed:function r(a){r.base.call(this,a),a&2050&&(this._clipItem=t)},_getClipItem:function(){var r=this._clipItem;if(r===t){r=null;for(var a=this._children,l=0,u=a.length;l<u;l++)if(a[l]._clipMask){r=a[l];break}this._clipItem=r}return r},isClipped:function(){return!!this._getClipItem()},setClipped:function(r){var a=this.getFirstChild();a&&a.setClipMask(r)},_getBounds:function r(a,l){var u=this._getClipItem();return u?u._getCachedBounds(u._matrix.prepended(a),s.set({},l,{stroke:!1})):r.base.call(this,a,l)},_hitTestChildren:function r(a,l,u){var g=this._getClipItem();return(!g||g.contains(a))&&r.base.call(this,a,l,u,g)},_draw:function(r,a){var l=a.clip,u=!l&&this._getClipItem();a=a.extend({clipItem:u,clip:!1}),l?(r.beginPath(),a.dontStart=a.dontFinish=!0):u&&u.draw(r,a.extend({clip:!0}));for(var g=this._children,y=0,P=g.length;y<P;y++){var L=g[y];L!==u&&L.draw(r,a)}}}),Fe=me.extend({_class:"Layer",initialize:function(){me.apply(this,arguments)},_getOwner:function(){return this._parent||this._index!=null&&this._project},isInserted:function r(){return this._parent?r.base.call(this):this._index!=null},activate:function(){this._project._activeLayer=this},_hitTestSelf:function(){}}),we=ne.extend({_class:"Shape",_applyMatrix:!1,_canApplyMatrix:!1,_canScaleStroke:!0,_serializeFields:{type:null,size:null,radius:null},initialize:function(a,l){this._initialize(a,l)},_equals:function(r){return this._type===r._type&&this._size.equals(r._size)&&s.equals(this._radius,r._radius)},copyContent:function(r){this.setType(r._type),this.setSize(r._size),this.setRadius(r._radius)},getType:function(){return this._type},setType:function(r){this._type=r},getShape:"#getType",setShape:"#setType",getSize:function(){var r=this._size;return new m(r.width,r.height,this,"setSize")},setSize:function(){var r=U.read(arguments);if(!this._size)this._size=r.clone();else if(!this._size.equals(r)){var a=this._type,l=r.width,u=r.height;a==="rectangle"?this._radius.set(U.min(this._radius,r.divide(2).abs())):a==="circle"?(l=u=(l+u)/2,this._radius=l/2):a==="ellipse"&&this._radius._set(l/2,u/2),this._size._set(l,u),this._changed(9)}},getRadius:function(){var r=this._radius;return this._type==="circle"?r:new m(r.width,r.height,this,"setRadius")},setRadius:function(r){var a=this._type;if(a==="circle"){if(r===this._radius)return;var l=r*2;this._radius=r,this._size._set(l,l)}else if(r=U.read(arguments),!this._radius)this._radius=r.clone();else{if(this._radius.equals(r))return;if(this._radius.set(r),a==="rectangle"){var l=U.max(this._size,r.multiply(2));this._size.set(l)}else a==="ellipse"&&this._size._set(r.width*2,r.height*2)}this._changed(9)},isEmpty:function(){return!1},toPath:function(r){var a=new Ve[s.capitalize(this._type)]({center:new T,size:this._size,radius:this._radius,insert:!1});return a.copyAttributes(this),Be.settings.applyMatrix&&a.setApplyMatrix(!0),(r===t||r)&&a.insertAbove(this),a},toShape:"#clone",_asPathItem:function(){return this.toPath(!1)},_draw:function(r,a,l,u){var g=this._style,y=g.hasFill(),P=g.hasStroke(),L=a.dontFinish||a.clip,C=!u;if(y||P||L){var x=this._type,k=this._radius,M=x==="circle";if(a.dontStart||r.beginPath(),C&&M)r.arc(0,0,k,0,Math.PI*2,!0);else{var E=M?k:k.width,D=M?k:k.height,B=this._size,W=B.width,q=B.height;if(C&&x==="rectangle"&&E===0&&D===0)r.rect(-W/2,-q/2,W,q);else{var F=W/2,V=q/2,A=1-.5522847498307936,N=E*A,G=D*A,K=[-F,-V+D,-F,-V+G,-F+N,-V,-F+E,-V,F-E,-V,F-N,-V,F,-V+G,F,-V+D,F,V-D,F,V-G,F-N,V,F-E,V,-F+E,V,-F+N,V,-F,V-G,-F,V-D];u&&u.transform(K,K,32),r.moveTo(K[0],K[1]),r.bezierCurveTo(K[2],K[3],K[4],K[5],K[6],K[7]),F!==E&&r.lineTo(K[8],K[9]),r.bezierCurveTo(K[10],K[11],K[12],K[13],K[14],K[15]),V!==D&&r.lineTo(K[16],K[17]),r.bezierCurveTo(K[18],K[19],K[20],K[21],K[22],K[23]),F!==E&&r.lineTo(K[24],K[25]),r.bezierCurveTo(K[26],K[27],K[28],K[29],K[30],K[31])}}r.closePath()}!L&&(y||P)&&(this._setStyles(r,a,l),y&&(r.fill(g.getFillRule()),r.shadowColor="rgba(0,0,0,0)"),P&&r.stroke())},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_getBounds:function(r,a){var l=new Y(this._size).setCenter(0,0),u=this._style,g=a.stroke&&u.hasStroke()&&u.getStrokeWidth();return r&&(l=r._transformBounds(l)),g?l.expand(Ve._getStrokePadding(g,this._getStrokeMatrix(r,a))):l}},new function(){function r(l,u,g){var y=l._radius;if(!y.isZero())for(var P=l._size.divide(2),L=1;L<=4;L++){var C=new T(L>1&&L<4?-1:1,L>2?-1:1),x=C.multiply(P),k=x.subtract(C.multiply(y)),M=new Y(g?x.add(C.multiply(g)):x,k);if(M.contains(u))return{point:k,quadrant:L}}}function a(l,u,g,y){var P=l.divide(u);return(!y||P.isInQuadrant(y))&&P.subtract(P.normalize()).multiply(u).divide(g).length<=1}return{_contains:function l(u){if(this._type==="rectangle"){var g=r(this,u);return g?u.subtract(g.point).divide(this._radius).getLength()<=1:l.base.call(this,u)}else return u.divide(this.size).getLength()<=.5},_hitTestSelf:function l(u,g,y,P){var L=!1,C=this._style,x=g.stroke&&C.hasStroke(),k=g.fill&&C.hasFill();if(x||k){var M=this._type,E=this._radius,D=x?C.getStrokeWidth()/2:0,B=g._tolerancePadding.add(Ve._getStrokePadding(D,!C.getStrokeScaling()&&P));if(M==="rectangle"){var W=B.multiply(2),q=r(this,u,W);if(q)L=a(u.subtract(q.point),E,B,q.quadrant);else{var F=new Y(this._size).setCenter(0,0),V=F.expand(W),A=F.expand(W.negate());L=V._containsPoint(u)&&!A._containsPoint(u)}}else L=a(u,E,B)}return L?new Je(x?"stroke":"fill",this):l.base.apply(this,arguments)}}},{statics:new function(){function r(a,l,u,g,y){var P=s.create(we.prototype);return P._type=a,P._size=u,P._radius=g,P._initialize(s.getNamed(y),l),P}return{Circle:function(){var a=arguments,l=T.readNamed(a,"center"),u=s.readNamed(a,"radius");return r("circle",l,new U(u*2),u,a)},Rectangle:function(){var a=arguments,l=Y.readNamed(a,"rectangle"),u=U.min(U.readNamed(a,"radius"),l.getSize(!0).divide(2));return r("rectangle",l.getCenter(!0),l.getSize(!0),u,a)},Ellipse:function(){var a=arguments,l=we._readEllipse(a),u=l.radius;return r("ellipse",l.center,u.multiply(2),u,a)},_readEllipse:function(a){var l,u;if(s.hasNamed(a,"radius"))l=T.readNamed(a,"center"),u=U.readNamed(a,"radius");else{var g=Y.readNamed(a,"rectangle");l=g.getCenter(!0),u=g.getSize(!0).divide(2)}return{center:l,radius:u}}}}}),He=ne.extend({_class:"Raster",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!1,handle:!1},_serializeFields:{crossOrigin:null,source:null},_prioritize:["crossOrigin"],_smoothing:"low",beans:!0,initialize:function(a,l){if(!this._initialize(a,l!==t&&T.read(arguments))){var u,g=typeof a,y=g==="string"?i.getElementById(a):g==="object"?a:null;if(y&&y!==ne.NO_INSERT){if(y.getContext||y.naturalHeight!=null)u=y;else if(y){var P=U.read(arguments);P.isZero()||(u=re.getCanvas(P))}}u?this.setImage(u):this.setSource(a)}this._size||(this._size=new U,this._loaded=!1)},_equals:function(r){return this.getSource()===r.getSource()},copyContent:function(r){var a=r._image,l=r._canvas;if(a)this._setImage(a);else if(l){var u=re.getCanvas(r._size);u.getContext("2d").drawImage(l,0,0),this._setImage(u)}this._crossOrigin=r._crossOrigin},getSize:function(){var r=this._size;return new m(r?r.width:0,r?r.height:0,this,"setSize")},setSize:function(r,a){var l=U.read(arguments);if(l.equals(this._size))a&&this.clear();else if(l.width>0&&l.height>0){var u=!a&&this.getElement();this._setImage(re.getCanvas(l)),u&&this.getContext(!0).drawImage(u,0,0,l.width,l.height)}else this._canvas&&re.release(this._canvas),this._size=l.clone()},getWidth:function(){return this._size?this._size.width:0},setWidth:function(r){this.setSize(r,this.getHeight())},getHeight:function(){return this._size?this._size.height:0},setHeight:function(r){this.setSize(this.getWidth(),r)},getLoaded:function(){return this._loaded},isEmpty:function(){var r=this._size;return!r||r.width===0&&r.height===0},getResolution:function(){var r=this._matrix,a=new T(0,0).transform(r),l=new T(1,0).transform(r).subtract(a),u=new T(0,1).transform(r).subtract(a);return new U(72/l.getLength(),72/u.getLength())},getPpi:"#getResolution",getImage:function(){return this._image},setImage:function(r){var a=this;function l(u){var g=a.getView(),y=u&&u.type||"load";g&&a.responds(y)&&(Be=g._scope,a.emit(y,new Rs(u)))}this._setImage(r),this._loaded?setTimeout(l,0):r&&Ht.add(r,{load:function(u){a._setImage(r),l(u)},error:l})},_setImage:function(r){this._canvas&&re.release(this._canvas),r&&r.getContext?(this._image=null,this._canvas=r,this._loaded=!0):(this._image=r,this._canvas=null,this._loaded=!!(r&&r.src&&r.complete)),this._size=new U(r?r.naturalWidth||r.width:0,r?r.naturalHeight||r.height:0),this._context=null,this._changed(1033)},getCanvas:function(){if(!this._canvas){var r=re.getContext(this._size);try{this._image&&r.drawImage(this._image,0,0),this._canvas=r.canvas}catch{re.release(r)}}return this._canvas},setCanvas:"#setImage",getContext:function(r){return this._context||(this._context=this.getCanvas().getContext("2d")),r&&(this._image=null,this._changed(1025)),this._context},setContext:function(r){this._context=r},getSource:function(){var r=this._image;return r&&r.src||this.toDataURL()},setSource:function(r){var a=new e.Image,l=this._crossOrigin;l&&(a.crossOrigin=l),r&&(a.src=r),this.setImage(a)},getCrossOrigin:function(){var r=this._image;return r&&r.crossOrigin||this._crossOrigin||""},setCrossOrigin:function(r){this._crossOrigin=r;var a=this._image;a&&(a.crossOrigin=r)},getSmoothing:function(){return this._smoothing},setSmoothing:function(r){this._smoothing=typeof r=="string"?r:r?"low":"off",this._changed(257)},getElement:function(){return this._canvas||this._loaded&&this._image}},{beans:!1,getSubCanvas:function(){var r=Y.read(arguments),a=re.getContext(r.getSize());return a.drawImage(this.getCanvas(),r.x,r.y,r.width,r.height,0,0,r.width,r.height),a.canvas},getSubRaster:function(){var r=Y.read(arguments),a=new He(ne.NO_INSERT);return a._setImage(this.getSubCanvas(r)),a.translate(r.getCenter().subtract(this.getSize().divide(2))),a._matrix.prepend(this._matrix),a.insertAbove(this),a},toDataURL:function(){var r=this._image,a=r&&r.src;if(/^data:/.test(a))return a;var l=this.getCanvas();return l?l.toDataURL.apply(l,arguments):null},drawImage:function(r){var a=T.read(arguments,1);this.getContext(!0).drawImage(r,a.x,a.y)},getAverageColor:function(r){var a,l;if(r?r instanceof We?(l=r,a=r.getBounds()):typeof r=="object"&&("width"in r?a=new Y(r):"x"in r&&(a=new Y(r.x-.5,r.y-.5,1,1))):a=this.getBounds(),!a)return null;var u=32,g=Math.min(a.width,u),y=Math.min(a.height,u),P=He._sampleContext;P?P.clearRect(0,0,u+1,u+1):P=He._sampleContext=re.getContext(new U(u)),P.save();var L=new le().scale(g/a.width,y/a.height).translate(-a.x,-a.y);L.applyToContext(P),l&&l.draw(P,new s({clip:!0,matrices:[L]})),this._matrix.applyToContext(P);var C=this.getElement(),x=this._size;C&&P.drawImage(C,-x.width/2,-x.height/2),P.restore();for(var k=P.getImageData(.5,.5,Math.ceil(g),Math.ceil(y)).data,M=[0,0,0],E=0,D=0,B=k.length;D<B;D+=4){var W=k[D+3];E+=W,W/=255,M[0]+=k[D]*W,M[1]+=k[D+1]*W,M[2]+=k[D+2]*W}for(var D=0;D<3;D++)M[D]/=E;return E?Lt.read(M):null},getPixel:function(){var r=T.read(arguments),a=this.getContext().getImageData(r.x,r.y,1,1).data;return new Lt("rgb",[a[0]/255,a[1]/255,a[2]/255],a[3]/255)},setPixel:function(){var r=arguments,a=T.read(r),l=Lt.read(r),u=l._convert("rgb"),g=l._alpha,y=this.getContext(!0),P=y.createImageData(1,1),L=P.data;L[0]=u[0]*255,L[1]=u[1]*255,L[2]=u[2]*255,L[3]=g!=null?g*255:255,y.putImageData(P,a.x,a.y)},clear:function(){var r=this._size;this.getContext(!0).clearRect(0,0,r.width+1,r.height+1)},createImageData:function(){var r=U.read(arguments);return this.getContext().createImageData(r.width,r.height)},getImageData:function(){var r=Y.read(arguments);return r.isEmpty()&&(r=new Y(this._size)),this.getContext().getImageData(r.x,r.y,r.width,r.height)},putImageData:function(r){var a=T.read(arguments,1);this.getContext(!0).putImageData(r,a.x,a.y)},setImageData:function(r){this.setSize(r),this.getContext(!0).putImageData(r,0,0)},_getBounds:function(r,a){var l=new Y(this._size).setCenter(0,0);return r?r._transformBounds(l):l},_hitTestSelf:function(r){if(this._contains(r)){var a=this;return new Je("pixel",a,{offset:r.add(a._size.divide(2)).round(),color:{get:function(){return a.getPixel(this.offset)}}})}},_draw:function(r,a,l){var u=this.getElement();if(u&&u.width>0&&u.height>0){r.globalAlpha=w.clamp(this._opacity,0,1),this._setStyles(r,a,l);var g=this._smoothing,y=g==="off";St.setPrefixed(r,y?"imageSmoothingEnabled":"imageSmoothingQuality",y?!1:g),r.drawImage(u,-this._size.width/2,-this._size.height/2)}},_canComposite:function(){return!0}}),Me=ne.extend({_class:"SymbolItem",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!0},_serializeFields:{symbol:null},initialize:function(a,l){this._initialize(a,l!==t&&T.read(arguments,1))||this.setDefinition(a instanceof ze?a:new ze(a))},_equals:function(r){return this._definition===r._definition},copyContent:function(r){this.setDefinition(r._definition)},getDefinition:function(){return this._definition},setDefinition:function(r){this._definition=r,this._changed(9)},getSymbol:"#getDefinition",setSymbol:"#setDefinition",isEmpty:function(){return this._definition._item.isEmpty()},_getBounds:function(r,a){var l=this._definition._item;return l._getCachedBounds(l._matrix.prepended(r),a)},_hitTestSelf:function(r,a,l){var u=a.extend({all:!1}),g=this._definition._item._hitTest(r,u,l);return g&&(g.item=this),g},_draw:function(r,a){this._definition._item.draw(r,a)}}),ze=s.extend({_class:"SymbolDefinition",initialize:function(a,l){this._id=O.get(),this.project=Be.project,a&&this.setItem(a,l)},_serialize:function(r,a){return a.add(this,function(){return s.serialize([this._class,this._item],r,!1,a)})},_changed:function(r){r&8&&ne._clearBoundsCache(this),r&1&&this.project._changed(r)},getItem:function(){return this._item},setItem:function(r,a){r._symbol&&(r=r.clone()),this._item&&(this._item._symbol=null),this._item=r,r.remove(),r.setSelected(!1),a||r.setPosition(new T),r._symbol=this,this._changed(9)},getDefinition:"#getItem",setDefinition:"#setItem",place:function(r){return new Me(this,r)},clone:function(){return new ze(this._item.clone(!1))},equals:function(r){return r===this||r&&this._item.equals(r._item)||!1}}),Je=s.extend({_class:"HitResult",initialize:function(a,l,u){this.type=a,this.item=l,u&&this.inject(u)},statics:{getOptions:function(r){var a=r&&s.read(r);return new s({type:null,tolerance:Be.settings.hitTolerance,fill:!a,stroke:!a,segments:!a,handles:!1,ends:!1,position:!1,center:!1,bounds:!1,guides:!1,selected:!1},a)}}}),Ee=s.extend({_class:"Segment",beans:!0,_selection:0,initialize:function(a,l,u,g,y,P){var L=arguments.length,C,x,k,M;L>0&&(a==null||typeof a=="object"?L===1&&a&&"point"in a?(C=a.point,x=a.handleIn,k=a.handleOut,M=a.selection):(C=a,x=l,k=u,M=g):(C=[a,l],x=u!==t?[u,g]:null,k=y!==t?[y,P]:null)),new rt(C,this,"_point"),new rt(x,this,"_handleIn"),new rt(k,this,"_handleOut"),M&&this.setSelection(M)},_serialize:function(r,a){var l=this._point,u=this._selection,g=u||this.hasHandles()?[l,this._handleIn,this._handleOut]:l;return u&&g.push(u),s.serialize(g,r,!0,a)},_changed:function(r){var a=this._path;if(a){var l=a._curves,u=this._index,g;l&&((!r||r===this._point||r===this._handleIn)&&(g=u>0?l[u-1]:a._closed?l[l.length-1]:null)&&g._changed(),(!r||r===this._point||r===this._handleOut)&&(g=l[u])&&g._changed()),a._changed(41)}},getPoint:function(){return this._point},setPoint:function(){this._point.set(T.read(arguments))},getHandleIn:function(){return this._handleIn},setHandleIn:function(){this._handleIn.set(T.read(arguments))},getHandleOut:function(){return this._handleOut},setHandleOut:function(){this._handleOut.set(T.read(arguments))},hasHandles:function(){return!this._handleIn.isZero()||!this._handleOut.isZero()},isSmooth:function(){var r=this._handleIn,a=this._handleOut;return!r.isZero()&&!a.isZero()&&r.isCollinear(a)},clearHandles:function(){this._handleIn._set(0,0),this._handleOut._set(0,0)},getSelection:function(){return this._selection},setSelection:function(r){var a=this._selection,l=this._path;this._selection=r=r||0,l&&r!==a&&(l._updateSelection(this,a,r),l._changed(257))},_changeSelection:function(r,a){var l=this._selection;this.setSelection(a?l|r:l&~r)},isSelected:function(){return!!(this._selection&7)},setSelected:function(r){this._changeSelection(7,r)},getIndex:function(){return this._index!==t?this._index:null},getPath:function(){return this._path||null},getCurve:function(){var r=this._path,a=this._index;return r?(a>0&&!r._closed&&a===r._segments.length-1&&a--,r.getCurves()[a]||null):null},getLocation:function(){var r=this.getCurve();return r?new Re(r,this===r._segment1?0:1):null},getNext:function(){var r=this._path&&this._path._segments;return r&&(r[this._index+1]||this._path._closed&&r[0])||null},smooth:function(r,a,l){var u=r||{},g=u.type,y=u.factor,P=this.getPrevious(),L=this.getNext(),C=(P||this)._point,x=this._point,k=(L||this)._point,M=C.getDistance(x),E=x.getDistance(k);if(!g||g==="catmull-rom"){var D=y===t?.5:y,B=Math.pow(M,D),W=B*B,q=Math.pow(E,D),F=q*q;if(!a&&P){var V=2*F+3*q*B+W,A=3*q*(q+B);this.setHandleIn(A!==0?new T((F*C._x+V*x._x-W*k._x)/A-x._x,(F*C._y+V*x._y-W*k._y)/A-x._y):new T)}if(!l&&L){var V=2*W+3*B*q+F,A=3*B*(B+q);this.setHandleOut(A!==0?new T((W*k._x+V*x._x-F*C._x)/A-x._x,(W*k._y+V*x._y-F*C._y)/A-x._y):new T)}}else if(g==="geometric"){if(P&&L){var N=C.subtract(k),G=y===t?.4:y,K=G*M/(M+E);a||this.setHandleIn(N.multiply(K)),l||this.setHandleOut(N.multiply(K-G))}}else throw new Error("Smoothing method '"+g+"' not supported.")},getPrevious:function(){var r=this._path&&this._path._segments;return r&&(r[this._index-1]||this._path._closed&&r[r.length-1])||null},isFirst:function(){return!this._index},isLast:function(){var r=this._path;return r&&this._index===r._segments.length-1||!1},reverse:function(){var r=this._handleIn,a=this._handleOut,l=r.clone();r.set(a),a.set(l)},reversed:function(){return new Ee(this._point,this._handleOut,this._handleIn)},remove:function(){return this._path?!!this._path.removeSegment(this._index):!1},clone:function(){return new Ee(this._point,this._handleIn,this._handleOut)},equals:function(r){return r===this||r&&this._class===r._class&&this._point.equals(r._point)&&this._handleIn.equals(r._handleIn)&&this._handleOut.equals(r._handleOut)||!1},toString:function(){var r=["point: "+this._point];return this._handleIn.isZero()||r.push("handleIn: "+this._handleIn),this._handleOut.isZero()||r.push("handleOut: "+this._handleOut),"{ "+r.join(", ")+" }"},transform:function(r){this._transformCoordinates(r,new Array(6),!0),this._changed()},interpolate:function(r,a,l){var u=1-l,g=l,y=r._point,P=a._point,L=r._handleIn,C=a._handleIn,x=a._handleOut,k=r._handleOut;this._point._set(u*y._x+g*P._x,u*y._y+g*P._y,!0),this._handleIn._set(u*L._x+g*C._x,u*L._y+g*C._y,!0),this._handleOut._set(u*k._x+g*x._x,u*k._y+g*x._y,!0),this._changed()},_transformCoordinates:function(r,a,l){var u=this._point,g=!l||!this._handleIn.isZero()?this._handleIn:null,y=!l||!this._handleOut.isZero()?this._handleOut:null,P=u._x,L=u._y,C=2;return a[0]=P,a[1]=L,g&&(a[C++]=g._x+P,a[C++]=g._y+L),y&&(a[C++]=y._x+P,a[C++]=y._y+L),r&&(r._transformCoordinates(a,a,C/2),P=a[0],L=a[1],l?(u._x=P,u._y=L,C=2,g&&(g._x=a[C++]-P,g._y=a[C++]-L),y&&(y._x=a[C++]-P,y._y=a[C++]-L)):(g||(a[C++]=P,a[C++]=L),y||(a[C++]=P,a[C++]=L))),a}}),rt=T.extend({initialize:function(a,l,u){var g,y,P;if(!a)g=y=0;else if((g=a[0])!==t)y=a[1];else{var L=a;(g=L.x)===t&&(L=T.read(arguments),g=L.x),y=L.y,P=L.selected}this._x=g,this._y=y,this._owner=l,l[u]=this,P&&this.setSelected(!0)},_set:function(r,a){return this._x=r,this._y=a,this._owner._changed(this),this},getX:function(){return this._x},setX:function(r){this._x=r,this._owner._changed(this)},getY:function(){return this._y},setY:function(r){this._y=r,this._owner._changed(this)},isZero:function(){var r=w.isZero;return r(this._x)&&r(this._y)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(r){this._owner._changeSelection(this._getSelection(),r)},_getSelection:function(){var r=this._owner;return this===r._point?1:this===r._handleIn?2:this===r._handleOut?4:0}}),Ie=s.extend({_class:"Curve",beans:!0,initialize:function(a,l,u,g,y,P,L,C){var x=arguments.length,k,M,E,D,B,W;x===3?(this._path=a,k=l,M=u):x?x===1?"segment1"in a?(k=new Ee(a.segment1),M=new Ee(a.segment2)):"point1"in a?(E=a.point1,B=a.handle1,W=a.handle2,D=a.point2):Array.isArray(a)&&(E=[a[0],a[1]],D=[a[6],a[7]],B=[a[2]-a[0],a[3]-a[1]],W=[a[4]-a[6],a[5]-a[7]]):x===2?(k=new Ee(a),M=new Ee(l)):x===4?(E=a,B=l,W=u,D=g):x===8&&(E=[a,l],D=[L,C],B=[u-a,g-l],W=[y-L,P-C]):(k=new Ee,M=new Ee),this._segment1=k||new Ee(E,null,B),this._segment2=M||new Ee(D,W,null)},_serialize:function(r,a){return s.serialize(this.hasHandles()?[this.getPoint1(),this.getHandle1(),this.getHandle2(),this.getPoint2()]:[this.getPoint1(),this.getPoint2()],r,!0,a)},_changed:function(){this._length=this._bounds=t},clone:function(){return new Ie(this._segment1,this._segment2)},toString:function(){var r=["point1: "+this._segment1._point];return this._segment1._handleOut.isZero()||r.push("handle1: "+this._segment1._handleOut),this._segment2._handleIn.isZero()||r.push("handle2: "+this._segment2._handleIn),r.push("point2: "+this._segment2._point),"{ "+r.join(", ")+" }"},classify:function(){return Ie.classify(this.getValues())},remove:function(){var r=!1;if(this._path){var a=this._segment2,l=a._handleOut;r=a.remove(),r&&this._segment1._handleOut.set(l)}return r},getPoint1:function(){return this._segment1._point},setPoint1:function(){this._segment1._point.set(T.read(arguments))},getPoint2:function(){return this._segment2._point},setPoint2:function(){this._segment2._point.set(T.read(arguments))},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(){this._segment1._handleOut.set(T.read(arguments))},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(){this._segment2._handleIn.set(T.read(arguments))},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var r=this._path&&this._path._curves;return r&&(r[this._segment1._index+1]||this._path._closed&&r[0])||null},getPrevious:function(){var r=this._path&&this._path._curves;return r&&(r[this._segment1._index-1]||this._path._closed&&r[r.length-1])||null},isFirst:function(){return!this._segment1._index},isLast:function(){var r=this._path;return r&&this._segment1._index===r._curves.length-1||!1},isSelected:function(){return this.getPoint1().isSelected()&&this.getHandle1().isSelected()&&this.getHandle2().isSelected()&&this.getPoint2().isSelected()},setSelected:function(r){this.getPoint1().setSelected(r),this.getHandle1().setSelected(r),this.getHandle2().setSelected(r),this.getPoint2().setSelected(r)},getValues:function(r){return Ie.getValues(this._segment1,this._segment2,r)},getPoints:function(){for(var r=this.getValues(),a=[],l=0;l<8;l+=2)a.push(new T(r[l],r[l+1]));return a}},{getLength:function(){return this._length==null&&(this._length=Ie.getLength(this.getValues(),0,1)),this._length},getArea:function(){return Ie.getArea(this.getValues())},getLine:function(){return new xe(this._segment1._point,this._segment2._point)},getPart:function(r,a){return new Ie(Ie.getPart(this.getValues(),r,a))},getPartLength:function(r,a){return Ie.getLength(this.getValues(),r,a)},divideAt:function(r){return this.divideAtTime(r&&r.curve===this?r.time:this.getTimeAt(r))},divideAtTime:function(r,a){var l=1e-8,u=1-l,g=null;if(r>=l&&r<=u){var y=Ie.subdivide(this.getValues(),r),P=y[0],L=y[1],C=a||this.hasHandles(),x=this._segment1,k=this._segment2,M=this._path;C&&(x._handleOut._set(P[2]-P[0],P[3]-P[1]),k._handleIn._set(L[4]-L[6],L[5]-L[7]));var E=P[6],D=P[7],B=new Ee(new T(E,D),C&&new T(P[4]-E,P[5]-D),C&&new T(L[2]-E,L[3]-D));M?(M.insert(x._index+1,B),g=this.getNext()):(this._segment2=B,this._changed(),g=new Ie(B,k))}return g},splitAt:function(r){var a=this._path;return a?a.splitAt(r):null},splitAtTime:function(r){return this.splitAt(this.getLocationAtTime(r))},divide:function(r,a){return this.divideAtTime(r===t?.5:a?r:this.getTimeAt(r))},split:function(r,a){return this.splitAtTime(r===t?.5:a?r:this.getTimeAt(r))},reversed:function(){return new Ie(this._segment2.reversed(),this._segment1.reversed())},clearHandles:function(){this._segment1._handleOut._set(0,0),this._segment2._handleIn._set(0,0)},statics:{getValues:function(r,a,l,u){var g=r._point,y=r._handleOut,P=a._handleIn,L=a._point,C=g.x,x=g.y,k=L.x,M=L.y,E=u?[C,x,C,x,k,M,k,M]:[C,x,C+y._x,x+y._y,k+P._x,M+P._y,k,M];return l&&l._transformCoordinates(E,E,4),E},subdivide:function(r,a){var l=r[0],u=r[1],g=r[2],y=r[3],P=r[4],L=r[5],C=r[6],x=r[7];a===t&&(a=.5);var k=1-a,M=k*l+a*g,E=k*u+a*y,D=k*g+a*P,B=k*y+a*L,W=k*P+a*C,q=k*L+a*x,F=k*M+a*D,V=k*E+a*B,A=k*D+a*W,N=k*B+a*q,G=k*F+a*A,K=k*V+a*N;return[[l,u,M,E,F,V,G,K],[G,K,A,N,W,q,C,x]]},getMonoCurves:function(r,a){var l=[],u=a?0:1,g=r[u+0],y=r[u+2],P=r[u+4],L=r[u+6];if(g>=y==y>=P&&y>=P==P>=L||Ie.isStraight(r))l.push(r);else{var C=3*(y-P)-g+L,x=2*(g+P)-4*y,k=y-g,M=1e-8,E=1-M,D=[],B=w.solveQuadratic(C,x,k,D,M,E);if(!B)l.push(r);else{D.sort();var W=D[0],q=Ie.subdivide(r,W);l.push(q[0]),B>1&&(W=(D[1]-W)/(1-W),q=Ie.subdivide(q[1],W),l.push(q[0])),l.push(q[1])}}return l},solveCubic:function(r,a,l,u,g,y){var P=r[a],L=r[a+2],C=r[a+4],x=r[a+6],k=0;if(!(P<l&&x<l&&L<l&&C<l||P>l&&x>l&&L>l&&C>l)){var M=3*(L-P),E=3*(C-L)-M,D=x-P-M-E;k=w.solveCubic(D,E,M,P-l,u,g,y)}return k},getTimeOf:function(r,a){var l=new T(r[0],r[1]),u=new T(r[6],r[7]),g=1e-12,y=1e-7,P=a.isClose(l,g)?0:a.isClose(u,g)?1:null;if(P===null)for(var L=[a.x,a.y],C=[],x=0;x<2;x++)for(var k=Ie.solveCubic(r,x,L[x],C,0,1),M=0;M<k;M++){var E=C[M];if(a.isClose(Ie.getPoint(r,E),y))return E}return a.isClose(l,y)?0:a.isClose(u,y)?1:null},getNearestTime:function(r,a){if(Ie.isStraight(r)){var l=r[0],u=r[1],g=r[6],y=r[7],P=g-l,L=y-u,C=P*P+L*L;if(C===0)return 0;var x=((a.x-l)*P+(a.y-u)*L)/C;return x<1e-12?0:x>.999999999999?1:Ie.getTimeOf(r,new T(l+x*P,u+x*L))}var k=100,M=1/0,E=0;function D(q){if(q>=0&&q<=1){var F=a.getDistance(Ie.getPoint(r,q),!0);if(F<M)return M=F,E=q,!0}}for(var B=0;B<=k;B++)D(B/k);for(var W=1/(k*2);W>1e-8;)!D(E-W)&&!D(E+W)&&(W/=2);return E},getPart:function(r,a,l){var u=a>l;if(u){var g=a;a=l,l=g}return a>0&&(r=Ie.subdivide(r,a)[1]),l<1&&(r=Ie.subdivide(r,(l-a)/(1-a))[0]),u?[r[6],r[7],r[4],r[5],r[2],r[3],r[0],r[1]]:r},isFlatEnough:function(r,a){var l=r[0],u=r[1],g=r[2],y=r[3],P=r[4],L=r[5],C=r[6],x=r[7],k=3*g-2*l-C,M=3*y-2*u-x,E=3*P-2*C-l,D=3*L-2*x-u;return Math.max(k*k,E*E)+Math.max(M*M,D*D)<=16*a*a},getArea:function(r){var a=r[0],l=r[1],u=r[2],g=r[3],y=r[4],P=r[5],L=r[6],C=r[7];return 3*((C-l)*(u+y)-(L-a)*(g+P)+g*(a-y)-u*(l-P)+C*(y+a/3)-L*(P+l/3))/20},getBounds:function(r){for(var a=r.slice(0,2),l=a.slice(),u=[0,0],g=0;g<2;g++)Ie._addBounds(r[g],r[g+2],r[g+4],r[g+6],g,0,a,l,u);return new Y(a[0],a[1],l[0]-a[0],l[1]-a[1])},_addBounds:function(r,a,l,u,g,y,P,L,C){function x(G,K){var Z=G-K,ee=G+K;Z<P[g]&&(P[g]=Z),ee>L[g]&&(L[g]=ee)}y/=2;var k=P[g]+y,M=L[g]-y;if(r<k||a<k||l<k||u<k||r>M||a>M||l>M||u>M)if(a<r!=a<u&&l<r!=l<u)x(r,0),x(u,0);else{var E=3*(a-l)-r+u,D=2*(r+l)-4*a,B=a-r,W=w.solveQuadratic(E,D,B,C),q=1e-8,F=1-q;x(u,0);for(var V=0;V<W;V++){var A=C[V],N=1-A;q<=A&&A<=F&&x(N*N*N*r+3*N*N*A*a+3*N*A*A*l+A*A*A*u,y)}}}}},s.each(["getBounds","getStrokeBounds","getHandleBounds"],function(r){this[r]=function(){this._bounds||(this._bounds={});var a=this._bounds[r];return a||(a=this._bounds[r]=Ve[r]([this._segment1,this._segment2],!1,this._path)),a.clone()}},{}),s.each({isStraight:function(r,a,l,u){if(a.isZero()&&l.isZero())return!0;var g=u.subtract(r);if(g.isZero())return!1;if(g.isCollinear(a)&&g.isCollinear(l)){var y=new xe(r,u),P=1e-7;if(y.getDistance(r.add(a))<P&&y.getDistance(u.add(l))<P){var L=g.dot(g),C=g.dot(a)/L,x=g.dot(l)/L;return C>=0&&C<=1&&x<=0&&x>=-1}}return!1},isLinear:function(r,a,l,u){var g=u.subtract(r).divide(3);return a.equals(g)&&l.negate().equals(g)}},function(r,a){this[a]=function(l){var u=this._segment1,g=this._segment2;return r(u._point,u._handleOut,g._handleIn,g._point,l)},this.statics[a]=function(l,u){var g=l[0],y=l[1],P=l[6],L=l[7];return r(new T(g,y),new T(l[2]-g,l[3]-y),new T(l[4]-P,l[5]-L),new T(P,L),u)}},{statics:{},hasHandles:function(){return!this._segment1._handleOut.isZero()||!this._segment2._handleIn.isZero()},hasLength:function(r){return(!this.getPoint1().equals(this.getPoint2())||this.hasHandles())&&this.getLength()>(r||0)},isCollinear:function(r){return r&&this.isStraight()&&r.isStraight()&&this.getLine().isCollinear(r.getLine())},isHorizontal:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).y)<1e-8},isVertical:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).x)<1e-8}}),{beans:!1,getLocationAt:function(r,a){return this.getLocationAtTime(a?r:this.getTimeAt(r))},getLocationAtTime:function(r){return r!=null&&r>=0&&r<=1?new Re(this,r):null},getTimeAt:function(r,a){return Ie.getTimeAt(this.getValues(),r,a)},getParameterAt:"#getTimeAt",getTimesWithTangent:function(){var r=T.read(arguments);return r.isZero()?[]:Ie.getTimesWithTangent(this.getValues(),r)},getOffsetAtTime:function(r){return this.getPartLength(0,r)},getLocationOf:function(){return this.getLocationAtTime(this.getTimeOf(T.read(arguments)))},getOffsetOf:function(){var r=this.getLocationOf.apply(this,arguments);return r?r.getOffset():null},getTimeOf:function(){return Ie.getTimeOf(this.getValues(),T.read(arguments))},getParameterOf:"#getTimeOf",getNearestLocation:function(){var r=T.read(arguments),a=this.getValues(),l=Ie.getNearestTime(a,r),u=Ie.getPoint(a,l);return new Re(this,l,u,null,r.getDistance(u))},getNearestPoint:function(){var r=this.getNearestLocation.apply(this,arguments);return r&&r.getPoint()}},new function(){var r=["getPoint","getTangent","getNormal","getWeightedTangent","getWeightedNormal","getCurvature"];return s.each(r,function(a){this[a+"At"]=function(l,u){var g=this.getValues();return Ie[a](g,u?l:Ie.getTimeAt(g,l))},this[a+"AtTime"]=function(l){return Ie[a](this.getValues(),l)}},{statics:{_evaluateMethods:r}})},new function(){function r(u){var g=u[0],y=u[1],P=u[2],L=u[3],C=u[4],x=u[5],k=u[6],M=u[7],E=9*(P-C)+3*(k-g),D=6*(g+C)-12*P,B=3*(P-g),W=9*(L-x)+3*(M-y),q=6*(y+x)-12*L,F=3*(L-y);return function(V){var A=(E*V+D)*V+B,N=(W*V+q)*V+F;return Math.sqrt(A*A+N*N)}}function a(u,g){return Math.max(2,Math.min(16,Math.ceil(Math.abs(g-u)*32)))}function l(u,g,y,P){if(g==null||g<0||g>1)return null;var L=u[0],C=u[1],x=u[2],k=u[3],M=u[4],E=u[5],D=u[6],B=u[7],W=w.isZero;W(x-L)&&W(k-C)&&(x=L,k=C),W(M-D)&&W(E-B)&&(M=D,E=B);var q=3*(x-L),F=3*(M-x)-q,V=D-L-q-F,A=3*(k-C),N=3*(E-k)-A,G=B-C-A-N,K,Z;if(y===0)K=g===0?L:g===1?D:((V*g+F)*g+q)*g+L,Z=g===0?C:g===1?B:((G*g+N)*g+A)*g+C;else{var ee=1e-8,se=1-ee;if(g<ee?(K=q,Z=A):g>se?(K=3*(D-M),Z=3*(B-E)):(K=(3*V*g+2*F)*g+q,Z=(3*G*g+2*N)*g+A),P){K===0&&Z===0&&(g<ee||g>se)&&(K=M-x,Z=E-k);var ae=Math.sqrt(K*K+Z*Z);ae&&(K/=ae,Z/=ae)}if(y===3){var M=6*V*g+2*F,E=6*G*g+2*N,ge=Math.pow(K*K+Z*Z,3/2);K=ge!==0?(K*E-Z*M)/ge:0,Z=0}}return y===2?new T(Z,-K):new T(K,Z)}return{statics:{classify:function(u){var g=u[0],y=u[1],P=u[2],L=u[3],C=u[4],x=u[5],k=u[6],M=u[7],E=g*(M-x)+y*(C-k)+k*x-M*C,D=P*(y-M)+L*(k-g)+g*M-y*k,B=C*(L-y)+x*(g-P)+P*y-L*g,W=3*B,q=W-D,F=q-D+E,V=Math.sqrt(F*F+q*q+W*W),A=V!==0?1/V:0,N=w.isZero,G="serpentine";F*=A,q*=A,W*=A;function K(ae,ge,ue){var fe=ge!==t,be=fe&&ge>0&&ge<1,ve=fe&&ue>0&&ue<1;return fe&&(!(be||ve)||ae==="loop"&&!(be&&ve))&&(ae="arch",be=ve=!1),{type:ae,roots:be||ve?be&&ve?ge<ue?[ge,ue]:[ue,ge]:[be?ge:ue]:null}}if(N(F))return N(q)?K(N(W)?"line":"quadratic"):K(G,W/(3*q));var Z=3*q*q-4*F*W;if(N(Z))return K("cusp",q/(2*F));var ee=Z>0?Math.sqrt(Z/3):Math.sqrt(-Z),se=2*F;return K(Z>0?G:"loop",(q+ee)/se,(q-ee)/se)},getLength:function(u,g,y,P){if(g===t&&(g=0),y===t&&(y=1),Ie.isStraight(u)){var L=u;y<1&&(L=Ie.subdivide(L,y)[0],g/=y),g>0&&(L=Ie.subdivide(L,g)[1]);var C=L[6]-L[0],x=L[7]-L[1];return Math.sqrt(C*C+x*x)}return w.integrate(P||r(u),g,y,a(g,y))},getTimeAt:function(u,g,y){if(y===t&&(y=g<0?1:0),g===0)return y;var P=Math.abs,L=1e-12,C=g>0,x=C?y:0,k=C?1:y,M=r(u),E=Ie.getLength(u,x,k,M),D=P(g)-E;if(P(D)<L)return C?k:x;if(D>L)return null;var B=g/E,W=0;function q(F){return W+=w.integrate(M,y,F,a(y,F)),y=F,W-g}return w.findRoot(q,M,y+B,x,k,32,1e-12)},getPoint:function(u,g){return l(u,g,0,!1)},getTangent:function(u,g){return l(u,g,1,!0)},getWeightedTangent:function(u,g){return l(u,g,1,!1)},getNormal:function(u,g){return l(u,g,2,!0)},getWeightedNormal:function(u,g){return l(u,g,2,!1)},getCurvature:function(u,g){return l(u,g,3,!1).x},getPeaks:function(u){var g=u[0],y=u[1],P=u[2],L=u[3],C=u[4],x=u[5],k=u[6],M=u[7],E=-g+3*P-3*C+k,D=3*g-6*P+3*C,B=-3*g+3*P,W=-y+3*L-3*x+M,q=3*y-6*L+3*x,F=-3*y+3*L,V=1e-8,A=1-V,N=[];return w.solveCubic(9*(E*E+W*W),9*(E*D+q*W),2*(D*D+q*q)+3*(B*E+F*W),B*D+q*F,N,V,A),N.sort()}}}},new function(){function r(D,B,W,q,F,V,A){var N=!A&&W.getPrevious()===F,G=!A&&W!==F&&W.getNext()===F,K=1e-8,Z=1-K;if(q!==null&&q>=(N?K:0)&&q<=(G?Z:1)&&V!==null&&V>=(G?K:0)&&V<=(N?Z:1)){var ee=new Re(W,q,null,A),se=new Re(F,V,null,A);ee._intersection=se,se._intersection=ee,(!B||B(ee))&&Re.insert(D,ee,!0)}}function a(D,B,W,q,F,V,A,N,G,K,Z,ee,se){if(++G>=4096||++N>=40)return G;var ae=1e-9,ge=B[0],ue=B[1],fe=B[6],be=B[7],ve=xe.getSignedDistance,Ce=ve(ge,ue,fe,be,B[2],B[3]),Ae=ve(ge,ue,fe,be,B[4],B[5]),je=Ce*Ae>0?3/4:4/9,et=je*Math.min(0,Ce,Ae),it=je*Math.max(0,Ce,Ae),yt=ve(ge,ue,fe,be,D[0],D[1]),dt=ve(ge,ue,fe,be,D[2],D[3]),pt=ve(ge,ue,fe,be,D[4],D[5]),ut=ve(ge,ue,fe,be,D[6],D[7]),xt=l(yt,dt,pt,ut),bt=xt[0],gi=xt[1],zt,Jt;if(Ce===0&&Ae===0&&yt===0&&dt===0&&pt===0&&ut===0||(zt=u(bt,gi,et,it))==null||(Jt=u(bt.reverse(),gi.reverse(),et,it))==null)return G;var ei=K+(Z-K)*zt,Bt=K+(Z-K)*Jt;if(Math.max(se-ee,Bt-ei)<ae){var fs=(ei+Bt)/2,rs=(ee+se)/2;r(F,V,A?q:W,A?rs:fs,A?W:q,A?fs:rs)}else{D=Ie.getPart(D,zt,Jt);var Ps=se-ee;if(Jt-zt>.8)if(Bt-ei>Ps){var Xi=Ie.subdivide(D,.5),fs=(ei+Bt)/2;G=a(B,Xi[0],q,W,F,V,!A,N,G,ee,se,ei,fs),G=a(B,Xi[1],q,W,F,V,!A,N,G,ee,se,fs,Bt)}else{var Xi=Ie.subdivide(B,.5),rs=(ee+se)/2;G=a(Xi[0],D,q,W,F,V,!A,N,G,ee,rs,ei,Bt),G=a(Xi[1],D,q,W,F,V,!A,N,G,rs,se,ei,Bt)}else Ps===0||Ps>=ae?G=a(B,D,q,W,F,V,!A,N,G,ee,se,ei,Bt):G=a(D,B,W,q,F,V,A,N,G,ei,Bt,ee,se)}return G}function l(D,B,W,q){var F=[0,D],V=[1/3,B],A=[2/3,W],N=[1,q],G=B-(2*D+q)/3,K=W-(D+2*q)/3,Z;if(G*K<0)Z=[[F,V,N],[F,A,N]];else{var ee=G/K;Z=[ee>=2?[F,V,N]:ee<=.5?[F,A,N]:[F,V,A,N],[F,N]]}return(G||K)<0?Z.reverse():Z}function u(D,B,W,q){return D[0][1]<W?g(D,!0,W):B[0][1]>q?g(B,!1,q):D[0][0]}function g(D,B,W){for(var q=D[0][0],F=D[0][1],V=1,A=D.length;V<A;V++){var N=D[V][0],G=D[V][1];if(B?G>=W:G<=W)return G===W?N:q+(W-F)*(N-q)/(G-F);q=N,F=G}return null}function y(D,B,W,q,F){var V=w.isZero;if(V(q)&&V(F)){var A=Ie.getTimeOf(D,new T(B,W));return A===null?[]:[A]}for(var N=Math.atan2(-F,q),G=Math.sin(N),K=Math.cos(N),Z=[],ee=[],se=0;se<8;se+=2){var ae=D[se]-B,ge=D[se+1]-W;Z.push(ae*K-ge*G,ae*G+ge*K)}return Ie.solveCubic(Z,1,0,ee,0,1),ee}function P(D,B,W,q,F,V,A){for(var N=B[0],G=B[1],K=B[6],Z=B[7],ee=y(D,N,G,K-N,Z-G),se=0,ae=ee.length;se<ae;se++){var ge=ee[se],ue=Ie.getPoint(D,ge),fe=Ie.getTimeOf(B,ue);fe!==null&&r(F,V,A?q:W,A?fe:ge,A?W:q,A?ge:fe)}}function L(D,B,W,q,F,V){var A=xe.intersect(D[0],D[1],D[6],D[7],B[0],B[1],B[6],B[7]);A&&r(F,V,W,Ie.getTimeOf(D,A),q,Ie.getTimeOf(B,A))}function C(D,B,W,q,F,V){var A=1e-12,N=Math.min,G=Math.max;if(G(D[0],D[2],D[4],D[6])+A>N(B[0],B[2],B[4],B[6])&&N(D[0],D[2],D[4],D[6])-A<G(B[0],B[2],B[4],B[6])&&G(D[1],D[3],D[5],D[7])+A>N(B[1],B[3],B[5],B[7])&&N(D[1],D[3],D[5],D[7])-A<G(B[1],B[3],B[5],B[7])){var K=M(D,B);if(K)for(var Z=0;Z<2;Z++){var ee=K[Z];r(F,V,W,ee[0],q,ee[1],!0)}else{var se=Ie.isStraight(D),ae=Ie.isStraight(B),ge=se&&ae,ue=se&&!ae,fe=F.length;if((ge?L:se||ae?P:a)(ue?B:D,ue?D:B,ue?q:W,ue?W:q,F,V,ue,0,0,0,1,0,1),!ge||F.length===fe)for(var Z=0;Z<4;Z++){var be=Z>>1,ve=Z&1,Ce=be*6,Ae=ve*6,je=new T(D[Ce],D[Ce+1]),et=new T(B[Ae],B[Ae+1]);je.isClose(et,A)&&r(F,V,W,be,q,ve)}}}return F}function x(D,B,W,q){var F=Ie.classify(D);if(F.type==="loop"){var V=F.roots;r(W,q,B,V[0],B,V[1])}return W}function k(D,B,W,q,F,V){var A=1e-7,N=!B;N&&(B=D);for(var G=D.length,K=B.length,Z=new Array(G),ee=N?Z:new Array(K),se=[],ae=0;ae<G;ae++)Z[ae]=D[ae].getValues(q);if(!N)for(var ae=0;ae<K;ae++)ee[ae]=B[ae].getValues(F);for(var ge=p.findCurveBoundsCollisions(Z,ee,A),ue=0;ue<G;ue++){var fe=D[ue],be=Z[ue];N&&x(be,fe,se,W);var ve=ge[ue];if(ve)for(var Ce=0;Ce<ve.length;Ce++){if(V&&se.length)return se;var Ae=ve[Ce];if(!N||Ae>ue){var je=B[Ae],et=ee[Ae];C(be,et,fe,je,se,W)}}}return se}function M(D,B){function W(ut){var xt=ut[6]-ut[0],bt=ut[7]-ut[1];return xt*xt+bt*bt}var q=Math.abs,F=xe.getDistance,V=1e-8,A=1e-7,N=Ie.isStraight(D),G=Ie.isStraight(B),K=N&&G,Z=W(D)<W(B),ee=Z?B:D,se=Z?D:B,ae=ee[0],ge=ee[1],ue=ee[6]-ae,fe=ee[7]-ge;if(F(ae,ge,ue,fe,se[0],se[1],!0)<A&&F(ae,ge,ue,fe,se[6],se[7],!0)<A)!K&&F(ae,ge,ue,fe,ee[2],ee[3],!0)<A&&F(ae,ge,ue,fe,ee[4],ee[5],!0)<A&&F(ae,ge,ue,fe,se[2],se[3],!0)<A&&F(ae,ge,ue,fe,se[4],se[5],!0)<A&&(N=G=K=!0);else if(K)return null;if(N^G)return null;for(var be=[D,B],ve=[],Ce=0;Ce<4&&ve.length<2;Ce++){var Ae=Ce&1,je=Ae^1,et=Ce>>1,it=Ie.getTimeOf(be[Ae],new T(be[je][et?6:0],be[je][et?7:1]));if(it!=null){var yt=Ae?[et,it]:[it,et];(!ve.length||q(yt[0]-ve[0][0])>V&&q(yt[1]-ve[0][1])>V)&&ve.push(yt)}if(Ce>2&&!ve.length)break}if(ve.length!==2)ve=null;else if(!K){var dt=Ie.getPart(D,ve[0][0],ve[1][0]),pt=Ie.getPart(B,ve[0][1],ve[1][1]);(q(pt[2]-dt[2])>A||q(pt[3]-dt[3])>A||q(pt[4]-dt[4])>A||q(pt[5]-dt[5])>A)&&(ve=null)}return ve}function E(D,B){var W=D[0],q=D[1],F=D[2],V=D[3],A=D[4],N=D[5],G=D[6],K=D[7],Z=B.normalize(),ee=Z.x,se=Z.y,ae=3*G-9*A+9*F-3*W,ge=3*K-9*N+9*V-3*q,ue=6*A-12*F+6*W,fe=6*N-12*V+6*q,be=3*F-3*W,ve=3*V-3*q,Ce=2*ae*se-2*ge*ee,Ae=[];if(Math.abs(Ce)<w.CURVETIME_EPSILON){var je=ae*ve-ge*be,Ce=ae*fe-ge*ue;if(Ce!=0){var et=-je/Ce;et>=0&&et<=1&&Ae.push(et)}}else{var it=(ue*ue-4*ae*be)*se*se+(-2*ue*fe+4*ge*be+4*ae*ve)*ee*se+(fe*fe-4*ge*ve)*ee*ee,yt=ue*se-fe*ee;if(it>=0&&Ce!=0){var dt=Math.sqrt(it),pt=-(yt+dt)/Ce,ut=(-yt+dt)/Ce;pt>=0&&pt<=1&&Ae.push(pt),ut>=0&&ut<=1&&Ae.push(ut)}}return Ae}return{getIntersections:function(D){var B=this.getValues(),W=D&&D!==this&&D.getValues();return W?C(B,W,this,D,[]):x(B,this,[])},statics:{getOverlaps:M,getIntersections:k,getCurveLineIntersections:y,getTimesWithTangent:E}}}),Re=s.extend({_class:"CurveLocation",initialize:function(a,l,u,g,y){if(l>=.99999999){var P=a.getNext();P&&(l=0,a=P)}this._setCurve(a),this._time=l,this._point=u||a.getPointAtTime(l),this._overlap=g,this._distance=y,this._intersection=this._next=this._previous=null},_setPath:function(r){this._path=r,this._version=r?r._version:0},_setCurve:function(r){this._setPath(r._path),this._curve=r,this._segment=null,this._segment1=r._segment1,this._segment2=r._segment2},_setSegment:function(r){var a=r.getCurve();a?this._setCurve(a):(this._setPath(r._path),this._segment1=r,this._segment2=null),this._segment=r,this._time=r===this._segment1?0:1,this._point=r._point.clone()},getSegment:function(){var r=this._segment;if(!r){var a=this.getCurve(),l=this.getTime();l===0?r=a._segment1:l===1?r=a._segment2:l!=null&&(r=a.getPartLength(0,l)<a.getPartLength(l,1)?a._segment1:a._segment2),this._segment=r}return r},getCurve:function(){var r=this._path,a=this;r&&r._version!==this._version&&(this._time=this._offset=this._curveOffset=this._curve=null);function l(u){var g=u&&u.getCurve();if(g&&(a._time=g.getTimeOf(a._point))!=null)return a._setCurve(g),g}return this._curve||l(this._segment)||l(this._segment1)||l(this._segment2.getPrevious())},getPath:function(){var r=this.getCurve();return r&&r._path},getIndex:function(){var r=this.getCurve();return r&&r.getIndex()},getTime:function(){var r=this.getCurve(),a=this._time;return r&&a==null?this._time=r.getTimeOf(this._point):a},getParameter:"#getTime",getPoint:function(){return this._point},getOffset:function(){var r=this._offset;if(r==null){r=0;var a=this.getPath(),l=this.getIndex();if(a&&l!=null)for(var u=a.getCurves(),g=0;g<l;g++)r+=u[g].getLength();this._offset=r+=this.getCurveOffset()}return r},getCurveOffset:function(){var r=this._curveOffset;if(r==null){var a=this.getCurve(),l=this.getTime();this._curveOffset=r=l!=null&&a&&a.getPartLength(0,l)}return r},getIntersection:function(){return this._intersection},getDistance:function(){return this._distance},divide:function(){var r=this.getCurve(),a=r&&r.divideAtTime(this.getTime());return a&&this._setSegment(a._segment1),a},split:function(){var r=this.getCurve(),a=r._path,l=r&&r.splitAtTime(this.getTime());return l&&this._setSegment(a.getLastSegment()),l},equals:function(r,a){var l=this===r;if(!l&&r instanceof Re){var u=this.getCurve(),g=r.getCurve(),y=u._path,P=g._path;if(y===P){var L=Math.abs,C=1e-7,x=L(this.getOffset()-r.getOffset()),k=!a&&this._intersection,M=!a&&r._intersection;l=(x<C||y&&L(y.getLength()-x)<C)&&(!k&&!M||k&&M&&k.equals(M,!0))}}return l},toString:function(){var r=[],a=this.getPoint(),l=f.instance;a&&r.push("point: "+a);var u=this.getIndex();u!=null&&r.push("index: "+u);var g=this.getTime();return g!=null&&r.push("time: "+l.number(g)),this._distance!=null&&r.push("distance: "+l.number(this._distance)),"{ "+r.join(", ")+" }"},isTouching:function(){var r=this._intersection;if(r&&this.getTangent().isCollinear(r.getTangent())){var a=this.getCurve(),l=r.getCurve();return!(a.isStraight()&&l.isStraight()&&a.getLine().intersect(l.getLine()))}return!1},isCrossing:function(){var r=this._intersection;if(!r)return!1;var a=this.getTime(),l=r.getTime(),u=1e-8,g=1-u,y=a>=u&&a<=g,P=l>=u&&l<=g;if(y&&P)return!this.isTouching();var L=this.getCurve(),C=L&&a<u?L.getPrevious():L,x=r.getCurve(),k=x&&l<u?x.getPrevious():x;if(a>g&&(L=L.getNext()),l>g&&(x=x.getNext()),!C||!L||!k||!x)return!1;var M=[];function E(ee,se){var ae=ee.getValues(),ge=Ie.classify(ae).roots||Ie.getPeaks(ae),ue=ge.length,fe=Ie.getLength(ae,se&&ue?ge[ue-1]:0,!se&&ue?ge[0]:1);M.push(ue?fe:fe/32)}function D(ee,se,ae){return se<ae?ee>se&&ee<ae:ee>se||ee<ae}y||(E(C,!0),E(L,!1)),P||(E(k,!0),E(x,!1));var B=this.getPoint(),W=Math.min.apply(Math,M),q=y?L.getTangentAtTime(a):L.getPointAt(W).subtract(B),F=y?q.negate():C.getPointAt(-W).subtract(B),V=P?x.getTangentAtTime(l):x.getPointAt(W).subtract(B),A=P?V.negate():k.getPointAt(-W).subtract(B),N=F.getAngle(),G=q.getAngle(),K=A.getAngle(),Z=V.getAngle();return!!(y?D(N,K,Z)^D(G,K,Z)&&D(N,Z,K)^D(G,Z,K):D(K,N,G)^D(Z,N,G)&&D(K,G,N)^D(Z,G,N))},hasOverlap:function(){return!!this._overlap}},s.each(Ie._evaluateMethods,function(r){var a=r+"At";this[r]=function(){var l=this.getCurve(),u=this.getTime();return u!=null&&l&&l[a](u,!0)}},{preserve:!0}),new function(){function r(a,l,u){var g=a.length,y=0,P=g-1;function L(B,W){for(var q=B+W;q>=-1&&q<=g;q+=W){var F=a[(q%g+g)%g];if(!l.getPoint().isClose(F.getPoint(),1e-7))break;if(l.equals(F))return F}return null}for(;y<=P;){var C=y+P>>>1,x=a[C],k;if(u&&(k=l.equals(x)?x:L(C,-1)||L(C,1)))return l._overlap&&(k._overlap=k._intersection._overlap=!0),k;var M=l.getPath(),E=x.getPath(),D=M!==E?M._id-E._id:l.getIndex()+l.getTime()-(x.getIndex()+x.getTime());D<0?P=C-1:y=C+1}return a.splice(y,0,l),l}return{statics:{insert:r,expand:function(a){for(var l=a.slice(),u=a.length-1;u>=0;u--)r(l,a[u]._intersection,!1);return l}}}}),We=ne.extend({_class:"PathItem",_selectBounds:!1,_canScaleStroke:!0,beans:!0,initialize:function(){},statics:{create:function(r){var a,l,u;if(s.isPlainObject(r)?(l=r.segments,a=r.pathData):Array.isArray(r)?l=r:typeof r=="string"&&(a=r),l){var g=l[0];u=g&&Array.isArray(g[0])}else a&&(u=(a.match(/m/gi)||[]).length>1||/z\s*\S+/i.test(a));var y=u?Qe:Ve;return new y(r)}},_asPathItem:function(){return this},isClockwise:function(){return this.getArea()>=0},setClockwise:function(r){this.isClockwise()!=(r=!!r)&&this.reverse()},setPathData:function(r){var a=r&&r.match(/[mlhvcsqtaz][^mlhvcsqtaz]*/ig),l,u=!1,g,y,P=new T,L=new T;function C(A,N){var G=+l[A];return u&&(G+=P[N]),G}function x(A){return new T(C(A,"x"),C(A+1,"y"))}this.clear();for(var k=0,M=a&&a.length;k<M;k++){var E=a[k],D=E[0],B=D.toLowerCase();l=E.match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g);var W=l&&l.length;switch(u=D===B,g==="z"&&!/[mz]/.test(B)&&this.moveTo(P),B){case"m":case"l":for(var q=B==="m",F=0;F<W;F+=2)this[q?"moveTo":"lineTo"](P=x(F)),q&&(L=P,q=!1);y=P;break;case"h":case"v":var V=B==="h"?"x":"y";P=P.clone();for(var F=0;F<W;F++)P[V]=C(F,V),this.lineTo(P);y=P;break;case"c":for(var F=0;F<W;F+=6)this.cubicCurveTo(x(F),y=x(F+2),P=x(F+4));break;case"s":for(var F=0;F<W;F+=4)this.cubicCurveTo(/[cs]/.test(g)?P.multiply(2).subtract(y):P,y=x(F),P=x(F+2)),g=B;break;case"q":for(var F=0;F<W;F+=4)this.quadraticCurveTo(y=x(F),P=x(F+2));break;case"t":for(var F=0;F<W;F+=2)this.quadraticCurveTo(y=/[qt]/.test(g)?P.multiply(2).subtract(y):P,P=x(F)),g=B;break;case"a":for(var F=0;F<W;F+=7)this.arcTo(P=x(F+5),new U(+l[F],+l[F+1]),+l[F+2],+l[F+4],+l[F+3]);break;case"z":this.closePath(1e-12),P=L;break}g=B}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_contains:function(r){var a=r.isInside(this.getBounds({internal:!0,handle:!0}))?this._getWinding(r):{};return a.onPath||!!(this.getFillRule()==="evenodd"?a.windingL&1||a.windingR&1:a.winding)},getIntersections:function(r,a,l,u){var g=this===r||!r,y=this._matrix._orNullIfIdentity(),P=g?y:(l||r._matrix)._orNullIfIdentity();return g||this.getBounds(y).intersects(r.getBounds(P),1e-12)?Ie.getIntersections(this.getCurves(),!g&&r.getCurves(),a,y,P,u):[]},getCrossings:function(r){return this.getIntersections(r,function(a){return a.isCrossing()})},getNearestLocation:function(){for(var r=T.read(arguments),a=this.getCurves(),l=1/0,u=null,g=0,y=a.length;g<y;g++){var P=a[g].getNearestLocation(r);P._distance<l&&(l=P._distance,u=P)}return u},getNearestPoint:function(){var r=this.getNearestLocation.apply(this,arguments);return r&&r.getPoint()},interpolate:function(r,a,l){var u=!this._children,g=u?"_segments":"_children",y=r[g],P=a[g],L=this[g];if(!y||!P||y.length!==P.length)throw new Error("Invalid operands in interpolate() call: "+r+", "+a);var C=L.length,x=P.length;if(C<x)for(var k=u?Ee:Ve,M=C;M<x;M++)this.add(new k);else C>x&&this[u?"removeSegments":"removeChildren"](x,C);for(var M=0;M<x;M++)L[M].interpolate(y[M],P[M],l);u&&(this.setClosed(r._closed),this._changed(9))},compare:function(r){var a=!1;if(r){var l=this._children||[this],u=r._children?r._children.slice():[r],g=l.length,y=u.length,P=[],L=0;a=!0;for(var C=p.findItemBoundsCollisions(l,u,w.GEOMETRIC_EPSILON),x=g-1;x>=0&&a;x--){var k=l[x];a=!1;var M=C[x];if(M)for(var E=M.length-1;E>=0&&!a;E--)k.compare(u[M[E]])&&(P[M[E]]||(P[M[E]]=!0,L++),a=!0)}a=a&&L===y}return a}}),Ve=We.extend({_class:"Path",_serializeFields:{segments:[],closed:!1},initialize:function(a){this._closed=!1,this._segments=[],this._version=0;var l=arguments,u=Array.isArray(a)?typeof a[0]=="object"?a:l:a&&a.size===t&&(a.x!==t||a.point!==t)?l:null;u&&u.length>0?this.setSegments(u):(this._curves=t,this._segmentSelection=0,!u&&typeof a=="string"&&(this.setPathData(a),a=null)),this._initialize(!u&&a)},_equals:function(r){return this._closed===r._closed&&s.equals(this._segments,r._segments)},copyContent:function(r){this.setSegments(r._segments),this._closed=r._closed},_changed:function r(a){if(r.base.call(this,a),a&8){if(this._length=this._area=t,a&32)this._version++;else if(this._curves)for(var l=0,u=this._curves.length;l<u;l++)this._curves[l]._changed()}else a&64&&(this._bounds=t)},getStyle:function(){var r=this._parent;return(r instanceof Qe?r:this)._style},getSegments:function(){return this._segments},setSegments:function(r){var a=this.isFullySelected(),l=r&&r.length;if(this._segments.length=0,this._segmentSelection=0,this._curves=t,l){var u=r[l-1];typeof u=="boolean"&&(this.setClosed(u),l--),this._add(Ee.readList(r,0,{},l))}a&&this.setFullySelected(!0)},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var r=this._curves,a=this._segments;if(!r){var l=this._countCurves();r=this._curves=new Array(l);for(var u=0;u<l;u++)r[u]=new Ie(this,a[u],a[u+1]||a[0])}return r},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var r=this.getCurves();return r[r.length-1]},isClosed:function(){return this._closed},setClosed:function(r){if(this._closed!=(r=!!r)){if(this._closed=r,this._curves){var a=this._curves.length=this._countCurves();r&&(this._curves[a-1]=new Ie(this,this._segments[a-1],this._segments[0]))}this._changed(41)}}},{beans:!0,getPathData:function(r,a){var l=this._segments,u=l.length,g=new f(a),y=new Array(6),P=!0,L,C,x,k,M,E,D,B,W=[];function q(V,A){if(V._transformCoordinates(r,y),L=y[0],C=y[1],P)W.push("M"+g.pair(L,C)),P=!1;else if(M=y[2],E=y[3],M===L&&E===C&&D===x&&B===k){if(!A){var N=L-x,G=C-k;W.push(N===0?"v"+g.number(G):G===0?"h"+g.number(N):"l"+g.pair(N,G))}}else W.push("c"+g.pair(D-x,B-k)+" "+g.pair(M-x,E-k)+" "+g.pair(L-x,C-k));x=L,k=C,D=y[4],B=y[5]}if(!u)return"";for(var F=0;F<u;F++)q(l[F]);return this._closed&&u>0&&(q(l[0],!0),W.push("z")),W.join("")},isEmpty:function(){return!this._segments.length},_transformContent:function(r){for(var a=this._segments,l=new Array(6),u=0,g=a.length;u<g;u++)a[u]._transformCoordinates(r,l,!0);return!0},_add:function(r,P){for(var l=this._segments,u=this._curves,g=r.length,y=P==null,P=y?l.length:P,L=0;L<g;L++){var C=r[L];C._path&&(C=r[L]=C.clone()),C._path=this,C._index=P+L,C._selection&&this._updateSelection(C,0,C._selection)}if(y)s.push(l,r);else{l.splice.apply(l,[P,0].concat(r));for(var L=P+g,x=l.length;L<x;L++)l[L]._index=L}if(u){var k=this._countCurves(),M=P>0&&P+g-1===k?P-1:P,E=M,D=Math.min(M+g,k);r._curves&&(u.splice.apply(u,[M,0].concat(r._curves)),E+=r._curves.length);for(var L=E;L<D;L++)u.splice(L,0,new Ie(this,null,null));this._adjustCurves(M,D)}return this._changed(41),r},_adjustCurves:function(r,a){for(var l=this._segments,u=this._curves,g,y=r;y<a;y++)g=u[y],g._path=this,g._segment1=l[y],g._segment2=l[y+1]||l[0],g._changed();(g=u[this._closed&&!r?l.length-1:r-1])&&(g._segment2=l[r]||l[0],g._changed()),(g=u[a])&&(g._segment1=l[a],g._changed())},_countCurves:function(){var r=this._segments.length;return!this._closed&&r>0?r-1:r},add:function(r){var a=arguments;return a.length>1&&typeof r!="number"?this._add(Ee.readList(a)):this._add([Ee.read(a)])[0]},insert:function(r,a){var l=arguments;return l.length>2&&typeof a!="number"?this._add(Ee.readList(l,1),r):this._add([Ee.read(l,1)],r)[0]},addSegment:function(){return this._add([Ee.read(arguments)])[0]},insertSegment:function(r){return this._add([Ee.read(arguments,1)],r)[0]},addSegments:function(r){return this._add(Ee.readList(r))},insertSegments:function(r,a){return this._add(Ee.readList(a),r)},removeSegment:function(r){return this.removeSegments(r,r+1)[0]||null},removeSegments:function(r,a,l){r=r||0,a=s.pick(a,this._segments.length);var u=this._segments,g=this._curves,y=u.length,P=u.splice(r,a-r),L=P.length;if(!L)return P;for(var C=0;C<L;C++){var x=P[C];x._selection&&this._updateSelection(x,x._selection,0),x._index=x._path=null}for(var C=r,k=u.length;C<k;C++)u[C]._index=C;if(g){for(var M=r>0&&a===y+(this._closed?1:0)?r-1:r,g=g.splice(M,L),C=g.length-1;C>=0;C--)g[C]._path=null;l&&(P._curves=g.slice(1)),this._adjustCurves(M,M)}return this._changed(41),P},clear:"#removeSegments",hasHandles:function(){for(var r=this._segments,a=0,l=r.length;a<l;a++)if(r[a].hasHandles())return!0;return!1},clearHandles:function(){for(var r=this._segments,a=0,l=r.length;a<l;a++)r[a].clearHandles()},getLength:function(){if(this._length==null){for(var r=this.getCurves(),a=0,l=0,u=r.length;l<u;l++)a+=r[l].getLength();this._length=a}return this._length},getArea:function(){var r=this._area;if(r==null){var a=this._segments,l=this._closed;r=0;for(var u=0,g=a.length;u<g;u++){var y=u+1===g;r+=Ie.getArea(Ie.getValues(a[u],a[y?0:u+1],null,y&&!l))}this._area=r}return r},isFullySelected:function(){var r=this._segments.length;return this.isSelected()&&r>0&&this._segmentSelection===r*7},setFullySelected:function(r){r&&this._selectSegments(!0),this.setSelected(r)},setSelection:function r(a){a&1||this._selectSegments(!1),r.base.call(this,a)},_selectSegments:function(r){var a=this._segments,l=a.length,u=r?7:0;this._segmentSelection=u*l;for(var g=0;g<l;g++)a[g]._selection=u},_updateSelection:function(r,a,l){r._selection=l;var u=this._segmentSelection+=l-a;u>0&&this.setSelected(!0)},divideAt:function(r){var a=this.getLocationAt(r),l;return a&&(l=a.getCurve().divideAt(a.getCurveOffset()))?l._segment1:null},splitAt:function(r){var a=this.getLocationAt(r),l=a&&a.index,u=a&&a.time,g=1e-8,y=1-g;u>y&&(l++,u=0);var P=this.getCurves();if(l>=0&&l<P.length){u>=g&&P[l++].divideAtTime(u);var L=this.removeSegments(l,this._segments.length,!0),C;return this._closed?(this.setClosed(!1),C=this):(C=new Ve(ne.NO_INSERT),C.insertAbove(this),C.copyAttributes(this)),C._add(L,0),this.addSegment(L[0]),C}return null},split:function(r,a){var l,u=a===t?r:(l=this.getCurves()[r])&&l.getLocationAtTime(a);return u!=null?this.splitAt(u):null},join:function(r,a){var l=a||0;if(r&&r!==this){var u=r._segments,g=this.getLastSegment(),y=r.getLastSegment();if(!y)return this;g&&g._point.isClose(y._point,l)&&r.reverse();var P=r.getFirstSegment();if(g&&g._point.isClose(P._point,l))g.setHandleOut(P._handleOut),this._add(u.slice(1));else{var L=this.getFirstSegment();L&&L._point.isClose(P._point,l)&&r.reverse(),y=r.getLastSegment(),L&&L._point.isClose(y._point,l)?(L.setHandleIn(y._handleIn),this._add(u.slice(0,u.length-1),0)):this._add(u.slice())}r._closed&&this._add([u[0]]),r.remove()}var C=this.getFirstSegment(),x=this.getLastSegment();return C!==x&&C._point.isClose(x._point,l)&&(C.setHandleIn(x._handleIn),x.remove(),this.setClosed(!0)),this},reduce:function(r){for(var a=this.getCurves(),l=r&&r.simplify,u=l?1e-7:0,g=a.length-1;g>=0;g--){var y=a[g];!y.hasHandles()&&(!y.hasLength(u)||l&&y.isCollinear(y.getNext()))&&y.remove()}return this},reverse:function(){this._segments.reverse();for(var r=0,a=this._segments.length;r<a;r++){var l=this._segments[r],u=l._handleIn;l._handleIn=l._handleOut,l._handleOut=u,l._index=r}this._curves=null,this._changed(9)},flatten:function(r){for(var a=new Ot(this,r||.25,256,!0),l=a.parts,u=l.length,g=[],y=0;y<u;y++)g.push(new Ee(l[y].curve.slice(0,2)));!this._closed&&u>0&&g.push(new Ee(l[u-1].curve.slice(6))),this.setSegments(g)},simplify:function(r){var a=new Tt(this).fit(r||2.5);return a&&this.setSegments(a),!!a},smooth:function(r){var a=this,l=r||{},u=l.type||"asymmetric",g=this._segments,y=g.length,P=this._closed;function L(bt,gi){var zt=bt&&bt.index;if(zt!=null){var Jt=bt.path;if(Jt&&Jt!==a)throw new Error(bt._class+" "+zt+" of "+Jt+" is not part of "+a);gi&&bt instanceof Ie&&zt++}else zt=typeof bt=="number"?bt:gi;return Math.min(zt<0&&P?zt%y:zt<0?zt+y:zt,y-1)}var C=P&&l.from===t&&l.to===t,x=L(l.from,0),k=L(l.to,y-1);if(x>k)if(P)x-=y;else{var M=x;x=k,k=M}if(/^(?:asymmetric|continuous)$/.test(u)){var E=u==="asymmetric",D=Math.min,B=k-x+1,W=B-1,q=C?D(B,4):1,F=q,V=q,A=[];if(P||(F=D(1,x),V=D(1,y-k-1)),W+=F+V,W<=1)return;for(var N=0,G=x-F;N<=W;N++,G++)A[N]=g[(G<0?G+y:G)%y]._point;for(var K=A[0]._x+2*A[1]._x,Z=A[0]._y+2*A[1]._y,ee=2,se=W-1,ae=[K],ge=[Z],ue=[ee],fe=[],be=[],N=1;N<W;N++){var ve=N<se,Ce=ve||E?1:2,Ae=ve?4:E?2:7,je=ve?4:E?3:8,et=ve?2:E?0:1,it=Ce/ee;ee=ue[N]=Ae-it,K=ae[N]=je*A[N]._x+et*A[N+1]._x-it*K,Z=ge[N]=je*A[N]._y+et*A[N+1]._y-it*Z}fe[se]=ae[se]/ue[se],be[se]=ge[se]/ue[se];for(var N=W-2;N>=0;N--)fe[N]=(ae[N]-fe[N+1])/ue[N],be[N]=(ge[N]-be[N+1])/ue[N];fe[W]=(3*A[W]._x-fe[se])/2,be[W]=(3*A[W]._y-be[se])/2;for(var N=F,yt=W-V,G=x;N<=yt;N++,G++){var dt=g[G<0?G+y:G],pt=dt._point,ut=fe[N]-pt._x,xt=be[N]-pt._y;(C||N<yt)&&dt.setHandleOut(ut,xt),(C||N>F)&&dt.setHandleIn(-ut,-xt)}}else for(var N=x;N<=k;N++)g[N<0?N+y:N].smooth(l,!C&&N===x,!C&&N===k)},toShape:function(r){if(!this._closed)return null;var a=this._segments,l,u,g,y;function P(E,D){var B=a[E],W=B.getNext(),q=a[D],F=q.getNext();return B._handleOut.isZero()&&W._handleIn.isZero()&&q._handleOut.isZero()&&F._handleIn.isZero()&&W._point.subtract(B._point).isCollinear(F._point.subtract(q._point))}function L(E){var D=a[E],B=D.getPrevious(),W=D.getNext();return B._handleOut.isZero()&&D._handleIn.isZero()&&D._handleOut.isZero()&&W._handleIn.isZero()&&D._point.subtract(B._point).isOrthogonal(W._point.subtract(D._point))}function C(E){var D=a[E],B=D.getNext(),W=D._handleOut,q=B._handleIn,F=.5522847498307936;if(W.isOrthogonal(q)){var V=D._point,A=B._point,N=new xe(V,W,!0).intersect(new xe(A,q,!0),!0);return N&&w.isZero(W.getLength()/N.subtract(V).getLength()-F)&&w.isZero(q.getLength()/N.subtract(A).getLength()-F)}return!1}function x(E,D){return a[E]._point.getDistance(a[D]._point)}if(!this.hasHandles()&&a.length===4&&P(0,2)&&P(1,3)&&L(1)?(l=we.Rectangle,u=new U(x(0,3),x(0,1)),y=a[1]._point.add(a[2]._point).divide(2)):a.length===8&&C(0)&&C(2)&&C(4)&&C(6)&&P(1,5)&&P(3,7)?(l=we.Rectangle,u=new U(x(1,6),x(0,3)),g=u.subtract(new U(x(0,7),x(1,2))).divide(2),y=a[3]._point.add(a[4]._point).divide(2)):a.length===4&&C(0)&&C(1)&&C(2)&&C(3)&&(w.isZero(x(0,2)-x(1,3))?(l=we.Circle,g=x(0,2)/2):(l=we.Ellipse,g=new U(x(2,0)/2,x(3,1)/2)),y=a[1]._point),l){var k=this.getPosition(!0),M=new l({center:k,size:u,radius:g,insert:!1});return M.copyAttributes(this,!0),M._matrix.prepend(this._matrix),M.rotate(y.subtract(k).getAngle()+90),(r===t||r)&&M.insertAbove(this),M}return null},toPath:"#clone",compare:function r(a){if(!a||a instanceof Qe)return r.base.call(this,a);var l=this.getCurves(),u=a.getCurves(),g=l.length,y=u.length;if(!g||!y)return g==y;for(var P=l[0].getValues(),L=[],C=0,x,k=0,M,E=0;E<y;E++){var q=u[E].getValues();L.push(q);var D=Ie.getOverlaps(P,q);if(D){x=!E&&D[0][0]>0?y-1:E,M=D[0][1];break}}for(var B=Math.abs,W=1e-8,q=L[x],F;P&&q;){var D=Ie.getOverlaps(P,q);if(D){var V=D[0][0];if(B(V-k)<W){k=D[1][0],k===1&&(P=++C<g?l[C].getValues():null,k=0);var A=D[0][1];if(B(A-M)<W){if(F||(F=[x,A]),M=D[1][1],M===1&&(++x>=y&&(x=0),q=L[x]||u[x].getValues(),M=0),!P)return F[0]===x&&F[1]===M;continue}}}break}return!1},_hitTestSelf:function(r,a,l,u){var g=this,y=this.getStyle(),P=this._segments,L=P.length,C=this._closed,x=a._tolerancePadding,k=x,M,E,D,B,W,q,F=a.stroke&&y.hasStroke(),V=a.fill&&y.hasFill(),A=a.curves,N=F?y.getStrokeWidth()/2:V&&a.tolerance>0||A?0:null;N!==null&&(N>0?(M=y.getStrokeJoin(),E=y.getStrokeCap(),D=y.getMiterLimit(),k=k.add(Ve._getStrokePadding(N,u))):M=E="round");function G(fe,be){return r.subtract(fe).divide(be).length<=1}function K(fe,be,ve){if(!a.selected||be.isSelected()){var Ce=fe._point;if(be!==Ce&&(be=be.add(Ce)),G(be,k))return new Je(ve,g,{segment:fe,point:be})}}function Z(fe,be){return(be||a.segments)&&K(fe,fe._point,"segment")||!be&&a.handles&&(K(fe,fe._handleIn,"handle-in")||K(fe,fe._handleOut,"handle-out"))}function ee(fe){B.add(fe)}function se(fe){var be=C||fe._index>0&&fe._index<L-1;if((be?M:E)==="round")return G(fe._point,k);if(B=new Ve({internal:!0,closed:!0}),be?fe.isSmooth()||Ve._addBevelJoin(fe,M,N,D,null,u,ee,!0):E==="square"&&Ve._addSquareCap(fe,E,N,null,u,ee,!0),!B.isEmpty()){var ve;return B.contains(r)||(ve=B.getNearestLocation(r))&&G(ve.getPoint(),x)}}if(a.ends&&!a.segments&&!C){if(q=Z(P[0],!0)||Z(P[L-1],!0))return q}else if(a.segments||a.handles){for(var ae=0;ae<L;ae++)if(q=Z(P[ae]))return q}if(N!==null){if(W=this.getNearestLocation(r),W){var ge=W.getTime();ge===0||ge===1&&L>1?se(W.getSegment())||(W=null):G(W.getPoint(),k)||(W=null)}if(!W&&M==="miter"&&L>1)for(var ae=0;ae<L;ae++){var ue=P[ae];if(r.getDistance(ue._point)<=D*N&&se(ue)){W=ue.getLocation();break}}}return!W&&V&&this._contains(r)||W&&!F&&!A?new Je("fill",this):W?new Je(F?"stroke":"curve",this,{location:W,point:W.getPoint()}):null}},s.each(Ie._evaluateMethods,function(r){this[r+"At"]=function(a){var l=this.getLocationAt(a);return l&&l[r]()}},{beans:!1,getLocationOf:function(){for(var r=T.read(arguments),a=this.getCurves(),l=0,u=a.length;l<u;l++){var g=a[l].getLocationOf(r);if(g)return g}return null},getOffsetOf:function(){var r=this.getLocationOf.apply(this,arguments);return r?r.getOffset():null},getLocationAt:function(r){if(typeof r=="number"){for(var a=this.getCurves(),l=0,u=0,g=a.length;u<g;u++){var y=l,P=a[u];if(l+=P.getLength(),l>r)return P.getLocationAt(r-y)}if(a.length>0&&r<=this.getLength())return new Re(a[a.length-1],1)}else if(r&&r.getPath&&r.getPath()===this)return r;return null},getOffsetsWithTangent:function(){var r=T.read(arguments);if(r.isZero())return[];for(var a=[],l=0,u=this.getCurves(),g=0,y=u.length;g<y;g++){for(var P=u[g],L=P.getTimesWithTangent(r),C=0,x=L.length;C<x;C++){var k=l+P.getOffsetAtTime(L[C]);a.indexOf(k)<0&&a.push(k)}l+=P.length}return a}}),new function(){function r(l,u,g,y){if(y<=0)return;var P=y/2,L=y-2,C=P-1,x=new Array(6),k,M;function E(V){var A=x[V],N=x[V+1];(k!=A||M!=N)&&(l.beginPath(),l.moveTo(k,M),l.lineTo(A,N),l.stroke(),l.beginPath(),l.arc(A,N,P,0,Math.PI*2,!0),l.fill())}for(var D=0,B=u.length;D<B;D++){var W=u[D],q=W._selection;if(W._transformCoordinates(g,x),k=x[0],M=x[1],q&2&&E(2),q&4&&E(4),l.fillRect(k-P,M-P,y,y),L>0&&!(q&1)){var F=l.fillStyle;l.fillStyle="#ffffff",l.fillRect(k-C,M-C,L,L),l.fillStyle=F}}}function a(l,u,g){var y=u._segments,P=y.length,L=new Array(6),C=!0,x,k,M,E,D,B,W,q;function F(A){if(g)A._transformCoordinates(g,L),x=L[0],k=L[1];else{var N=A._point;x=N._x,k=N._y}if(C)l.moveTo(x,k),C=!1;else{if(g)D=L[2],B=L[3];else{var G=A._handleIn;D=x+G._x,B=k+G._y}D===x&&B===k&&W===M&&q===E?l.lineTo(x,k):l.bezierCurveTo(W,q,D,B,x,k)}if(M=x,E=k,g)W=L[4],q=L[5];else{var G=A._handleOut;W=M+G._x,q=E+G._y}}for(var V=0;V<P;V++)F(y[V]);u._closed&&P>0&&F(y[0])}return{_draw:function(l,u,g,y){var P=u.dontStart,L=u.dontFinish||u.clip,C=this.getStyle(),x=C.hasFill(),k=C.hasStroke(),M=C.getDashArray(),E=!Be.support.nativeDash&&k&&M&&M.length;P||l.beginPath(),(x||k&&!E||L)&&(a(l,this,y),this._closed&&l.closePath());function D(A){return M[(A%E+E)%E]}if(!L&&(x||k)&&(this._setStyles(l,u,g),x&&(l.fill(C.getFillRule()),l.shadowColor="rgba(0,0,0,0)"),k)){if(E){P||l.beginPath();for(var B=new Ot(this,.25,32,!1,y),W=B.length,q=-C.getDashOffset(),F,V=0;q>0;)q-=D(V--)+D(V--);for(;q<W;)F=q+D(V++),(q>0||F>0)&&B.drawPart(l,Math.max(q,0),Math.max(F,0)),q=F+D(V++)}l.stroke()}},_drawSelected:function(l,u){l.beginPath(),a(l,this,u),l.stroke(),r(l,this._segments,u,Be.settings.handleSize)}}},new function(){function r(a){var l=a._segments;if(!l.length)throw new Error("Use a moveTo() command first");return l[l.length-1]}return{moveTo:function(){var a=this._segments;a.length===1&&this.removeSegment(0),a.length||this._add([new Ee(T.read(arguments))])},moveBy:function(){throw new Error("moveBy() is unsupported on Path items.")},lineTo:function(){this._add([new Ee(T.read(arguments))])},cubicCurveTo:function(){var a=arguments,l=T.read(a),u=T.read(a),g=T.read(a),y=r(this);y.setHandleOut(l.subtract(y._point)),this._add([new Ee(g,u.subtract(g))])},quadraticCurveTo:function(){var a=arguments,l=T.read(a),u=T.read(a),g=r(this)._point;this.cubicCurveTo(l.add(g.subtract(l).multiply(1/3)),l.add(u.subtract(l).multiply(1/3)),u)},curveTo:function(){var a=arguments,l=T.read(a),u=T.read(a),g=s.pick(s.read(a),.5),y=1-g,P=r(this)._point,L=l.subtract(P.multiply(y*y)).subtract(u.multiply(g*g)).divide(2*g*y);if(L.isNaN())throw new Error("Cannot put a curve through points with parameter = "+g);this.quadraticCurveTo(L,u)},arcTo:function(){var a=arguments,l=Math.abs,u=Math.sqrt,g=r(this),y=g._point,P=T.read(a),L,C=s.peek(a),x=s.pick(C,!0),k,M,E,D;if(typeof x=="boolean")var B=y.add(P).divide(2),L=B.add(B.subtract(y).rotate(x?-90:90));else if(s.remain(a)<=2)L=P,P=T.read(a);else if(!y.equals(P)){var W=U.read(a),q=w.isZero;if(q(W.width)||q(W.height))return this.lineTo(P);var F=s.read(a),x=!!s.read(a),V=!!s.read(a),B=y.add(P).divide(2),A=y.subtract(B).rotate(-F),N=A.x,G=A.y,K=l(W.width),Z=l(W.height),ee=K*K,se=Z*Z,ae=N*N,ge=G*G,ue=u(ae/ee+ge/se);if(ue>1&&(K*=ue,Z*=ue,ee=K*K,se=Z*Z),ue=(ee*se-ee*ge-se*ae)/(ee*ge+se*ae),l(ue)<1e-12&&(ue=0),ue<0)throw new Error("Cannot create an arc with the given arguments");k=new T(K*G/Z,-Z*N/K).multiply((V===x?-1:1)*u(ue)).rotate(F).add(B),D=new le().translate(k).rotate(F).scale(K,Z),E=D._inverseTransform(y),M=E.getDirectedAngle(D._inverseTransform(P)),!x&&M>0?M-=360:x&&M<0&&(M+=360)}if(L){var fe=new xe(y.add(L).divide(2),L.subtract(y).rotate(90),!0),be=new xe(L.add(P).divide(2),P.subtract(L).rotate(90),!0),ve=new xe(y,P),Ce=ve.getSide(L);if(k=fe.intersect(be,!0),!k){if(!Ce)return this.lineTo(P);throw new Error("Cannot create an arc with the given arguments")}E=y.subtract(k),M=E.getDirectedAngle(P.subtract(k));var Ae=ve.getSide(k,!0);Ae===0?M=Ce*l(M):Ce===Ae&&(M+=M<0?360:-360)}if(M){for(var je=1e-5,et=l(M),it=et>=360?4:Math.ceil((et-je)/90),yt=M/it,dt=yt*Math.PI/360,pt=4/3*Math.sin(dt)/(1+Math.cos(dt)),ut=[],xt=0;xt<=it;xt++){var A=P,bt=null;if(xt<it&&(bt=E.rotate(90).multiply(pt),D?(A=D._transformPoint(E),bt=D._transformPoint(E.add(bt)).subtract(A)):A=k.add(E)),!xt)g.setHandleOut(bt);else{var gi=E.rotate(-90).multiply(pt);D&&(gi=D._transformPoint(E.add(gi)).subtract(A)),ut.push(new Ee(A,gi,bt))}E=E.rotate(yt)}this._add(ut)}},lineBy:function(){var a=T.read(arguments),l=r(this)._point;this.lineTo(l.add(a))},curveBy:function(){var a=arguments,l=T.read(a),u=T.read(a),g=s.read(a),y=r(this)._point;this.curveTo(y.add(l),y.add(u),g)},cubicCurveBy:function(){var a=arguments,l=T.read(a),u=T.read(a),g=T.read(a),y=r(this)._point;this.cubicCurveTo(y.add(l),y.add(u),y.add(g))},quadraticCurveBy:function(){var a=arguments,l=T.read(a),u=T.read(a),g=r(this)._point;this.quadraticCurveTo(g.add(l),g.add(u))},arcBy:function(){var a=arguments,l=r(this)._point,u=l.add(T.read(a)),g=s.pick(s.peek(a),!0);typeof g=="boolean"?this.arcTo(u,g):this.arcTo(u,l.add(T.read(a)))},closePath:function(a){this.setClosed(!0),this.join(this,a)}}},{_getBounds:function(r,a){var l=a.handle?"getHandleBounds":a.stroke?"getStrokeBounds":"getBounds";return Ve[l](this._segments,this._closed,this,r,a)},statics:{getBounds:function(r,a,l,u,g,y){var P=r[0];if(!P)return new Y;var L=new Array(6),C=P._transformCoordinates(u,new Array(6)),x=C.slice(0,2),k=x.slice(),M=new Array(2);function E(W){W._transformCoordinates(u,L);for(var q=0;q<2;q++)Ie._addBounds(C[q],C[q+4],L[q+2],L[q],q,y?y[q]:0,x,k,M);var F=C;C=L,L=F}for(var D=1,B=r.length;D<B;D++)E(r[D]);return a&&E(P),new Y(x[0],x[1],k[0]-x[0],k[1]-x[1])},getStrokeBounds:function(r,a,l,u,g){var y=l.getStyle(),P=y.hasStroke(),L=y.getStrokeWidth(),C=P&&l._getStrokeMatrix(u,g),x=P&&Ve._getStrokePadding(L,C),k=Ve.getBounds(r,a,l,u,g,x);if(!P)return k;var M=L/2,E=y.getStrokeJoin(),D=y.getStrokeCap(),B=y.getMiterLimit(),W=new Y(new U(x));function q(K){k=k.include(K)}function F(K){k=k.unite(W.setCenter(K._point.transform(u)))}function V(K,Z){Z==="round"||K.isSmooth()?F(K):Ve._addBevelJoin(K,Z,M,B,u,C,q)}function A(K,Z){Z==="round"?F(K):Ve._addSquareCap(K,Z,M,u,C,q)}var N=r.length-(a?0:1);if(N>0){for(var G=1;G<N;G++)V(r[G],E);a?V(r[0],E):(A(r[0],D),A(r[r.length-1],D))}return k},_getStrokePadding:function(r,a){if(!a)return[r,r];var l=new T(r,0).transform(a),u=new T(0,r).transform(a),g=l.getAngleInRadians(),y=l.getLength(),P=u.getLength(),L=Math.sin(g),C=Math.cos(g),x=Math.tan(g),k=Math.atan2(P*x,y),M=Math.atan2(P,x*y);return[Math.abs(y*Math.cos(k)*C+P*Math.sin(k)*L),Math.abs(P*Math.sin(M)*C+y*Math.cos(M)*L)]},_addBevelJoin:function(r,a,l,u,g,y,P,L){var C=r.getCurve(),x=C.getPrevious(),k=C.getPoint1().transform(g),M=x.getNormalAtTime(1).multiply(l).transform(y),E=C.getNormalAtTime(0).multiply(l).transform(y),D=M.getDirectedAngle(E);if((D<0||D>=180)&&(M=M.negate(),E=E.negate()),L&&P(k),P(k.add(M)),a==="miter"){var B=new xe(k.add(M),new T(-M.y,M.x),!0).intersect(new xe(k.add(E),new T(-E.y,E.x),!0),!0);B&&k.getDistance(B)<=u*l&&P(B)}P(k.add(E))},_addSquareCap:function(r,a,l,u,g,y,P){var L=r._point.transform(u),C=r.getLocation(),x=C.getNormal().multiply(C.getTime()===0?l:-l).transform(g);a==="square"&&(P&&(y(L.subtract(x)),y(L.add(x))),L=L.add(x.rotate(-90))),y(L.add(x)),y(L.subtract(x))},getHandleBounds:function(r,a,l,u,g){var y=l.getStyle(),P=g.stroke&&y.hasStroke(),L,C;if(P){var x=l._getStrokeMatrix(u,g),k=y.getStrokeWidth()/2,M=k;y.getStrokeJoin()==="miter"&&(M=k*y.getMiterLimit()),y.getStrokeCap()==="square"&&(M=Math.max(M,k*Math.SQRT2)),L=Ve._getStrokePadding(k,x),C=Ve._getStrokePadding(M,x)}for(var E=new Array(6),D=1/0,B=-D,W=D,q=B,F=0,V=r.length;F<V;F++){var A=r[F];A._transformCoordinates(u,E);for(var N=0;N<6;N+=2){var G=N?L:C,K=G?G[0]:0,Z=G?G[1]:0,ee=E[N],se=E[N+1],ae=ee-K,ge=ee+K,ue=se-Z,fe=se+Z;ae<D&&(D=ae),ge>B&&(B=ge),ue<W&&(W=ue),fe>q&&(q=fe)}}return new Y(D,W,B-D,q-W)}}});Ve.inject({statics:new function(){var r=.5522847498307936,a=[new Ee([-1,0],[0,r],[0,-r]),new Ee([0,-1],[-r,0],[r,0]),new Ee([1,0],[0,-r],[0,r]),new Ee([0,1],[r,0],[-r,0])];function l(g,y,P){var L=s.getNamed(P),C=new Ve(L&&(L.insert==!0?ne.INSERT:L.insert==!1?ne.NO_INSERT:null));return C._add(g),C._closed=y,C.set(L,ne.INSERT)}function u(g,y,P){for(var L=new Array(4),C=0;C<4;C++){var x=a[C];L[C]=new Ee(x._point.multiply(y).add(g),x._handleIn.multiply(y),x._handleOut.multiply(y))}return l(L,!0,P)}return{Line:function(){var g=arguments;return l([new Ee(T.readNamed(g,"from")),new Ee(T.readNamed(g,"to"))],!1,g)},Circle:function(){var g=arguments,y=T.readNamed(g,"center"),P=s.readNamed(g,"radius");return u(y,new U(P),g)},Rectangle:function(){var g=arguments,y=Y.readNamed(g,"rectangle"),P=U.readNamed(g,"radius",0,{readNull:!0}),L=y.getBottomLeft(!0),C=y.getTopLeft(!0),x=y.getTopRight(!0),k=y.getBottomRight(!0),M;if(!P||P.isZero())M=[new Ee(L),new Ee(C),new Ee(x),new Ee(k)];else{P=U.min(P,y.getSize(!0).divide(2));var E=P.width,D=P.height,B=E*r,W=D*r;M=[new Ee(L.add(E,0),null,[-B,0]),new Ee(L.subtract(0,D),[0,W]),new Ee(C.add(0,D),null,[0,-W]),new Ee(C.add(E,0),[-B,0],null),new Ee(x.subtract(E,0),null,[B,0]),new Ee(x.add(0,D),[0,-W],null),new Ee(k.subtract(0,D),null,[0,W]),new Ee(k.subtract(E,0),[B,0])]}return l(M,!0,g)},RoundRectangle:"#Rectangle",Ellipse:function(){var g=arguments,y=we._readEllipse(g);return u(y.center,y.radius,g)},Oval:"#Ellipse",Arc:function(){var g=arguments,y=T.readNamed(g,"from"),P=T.readNamed(g,"through"),L=T.readNamed(g,"to"),C=s.getNamed(g),x=new Ve(C&&C.insert==!1&&ne.NO_INSERT);return x.moveTo(y),x.arcTo(P,L),x.set(C)},RegularPolygon:function(){for(var g=arguments,y=T.readNamed(g,"center"),P=s.readNamed(g,"sides"),L=s.readNamed(g,"radius"),C=360/P,x=P%3===0,k=new T(0,x?-L:L),M=x?-1:.5,E=new Array(P),D=0;D<P;D++)E[D]=new Ee(y.add(k.rotate((D+M)*C)));return l(E,!0,g)},Star:function(){for(var g=arguments,y=T.readNamed(g,"center"),P=s.readNamed(g,"points")*2,L=s.readNamed(g,"radius1"),C=s.readNamed(g,"radius2"),x=360/P,k=new T(0,-1),M=new Array(P),E=0;E<P;E++)M[E]=new Ee(y.add(k.rotate(x*E).multiply(E%2?C:L)));return l(M,!0,g)}}}});var Qe=We.extend({_class:"CompoundPath",_serializeFields:{children:[]},beans:!0,initialize:function(a){this._children=[],this._namedChildren={},this._initialize(a)||(typeof a=="string"?this.setPathData(a):this.addChildren(Array.isArray(a)?a:arguments))},insertChildren:function r(a,l){var u=l,g=u[0];g&&typeof g[0]=="number"&&(u=[u]);for(var y=l.length-1;y>=0;y--){var P=u[y];u===l&&!(P instanceof Ve)&&(u=s.slice(u)),Array.isArray(P)?u[y]=new Ve({segments:P,insert:!1}):P instanceof Qe&&(u.splice.apply(u,[y,1].concat(P.removeChildren())),P.remove())}return r.base.call(this,a,u)},reduce:function r(a){for(var l=this._children,u=l.length-1;u>=0;u--){var g=l[u].reduce(a);g.isEmpty()&&g.remove()}if(!l.length){var g=new Ve(ne.NO_INSERT);return g.copyAttributes(this),g.insertAbove(this),this.remove(),g}return r.base.call(this)},isClosed:function(){for(var r=this._children,a=0,l=r.length;a<l;a++)if(!r[a]._closed)return!1;return!0},setClosed:function(r){for(var a=this._children,l=0,u=a.length;l<u;l++)a[l].setClosed(r)},getFirstSegment:function(){var r=this.getFirstChild();return r&&r.getFirstSegment()},getLastSegment:function(){var r=this.getLastChild();return r&&r.getLastSegment()},getCurves:function(){for(var r=this._children,a=[],l=0,u=r.length;l<u;l++)s.push(a,r[l].getCurves());return a},getFirstCurve:function(){var r=this.getFirstChild();return r&&r.getFirstCurve()},getLastCurve:function(){var r=this.getLastChild();return r&&r.getLastCurve()},getArea:function(){for(var r=this._children,a=0,l=0,u=r.length;l<u;l++)a+=r[l].getArea();return a},getLength:function(){for(var r=this._children,a=0,l=0,u=r.length;l<u;l++)a+=r[l].getLength();return a},getPathData:function(r,a){for(var l=this._children,u=[],g=0,y=l.length;g<y;g++){var P=l[g],L=P._matrix;u.push(P.getPathData(r&&!L.isIdentity()?r.appended(L):r,a))}return u.join("")},_hitTestChildren:function r(a,l,u){return r.base.call(this,a,l.class===Ve||l.type==="path"?l:s.set({},l,{fill:!1}),u)},_draw:function(r,a,l,u){var g=this._children;if(g.length){a=a.extend({dontStart:!0,dontFinish:!0}),r.beginPath();for(var y=0,P=g.length;y<P;y++)g[y].draw(r,a,u);if(!a.clip){this._setStyles(r,a,l);var L=this._style;L.hasFill()&&(r.fill(L.getFillRule()),r.shadowColor="rgba(0,0,0,0)"),L.hasStroke()&&r.stroke()}}},_drawSelected:function(r,a,l){for(var u=this._children,g=0,y=u.length;g<y;g++){var P=u[g],L=P._matrix;l[P._id]||P._drawSelected(r,L.isIdentity()?a:a.appended(L))}}},new function(){function r(a,l){var u=a._children;if(l&&!u.length)throw new Error("Use a moveTo() command first");return u[u.length-1]}return s.each(["lineTo","cubicCurveTo","quadraticCurveTo","curveTo","arcTo","lineBy","cubicCurveBy","quadraticCurveBy","curveBy","arcBy"],function(a){this[a]=function(){var l=r(this,!0);l[a].apply(l,arguments)}},{moveTo:function(){var a=r(this),l=a&&a.isEmpty()?a:new Ve(ne.NO_INSERT);l!==a&&this.addChild(l),l.moveTo.apply(l,arguments)},moveBy:function(){var a=r(this,!0),l=a&&a.getLastSegment(),u=T.read(arguments);this.moveTo(l?u.add(l._point):u)},closePath:function(a){r(this,!0).closePath(a)}})},s.each(["reverse","flatten","simplify","smooth"],function(r){this[r]=function(a){for(var l=this._children,u,g=0,y=l.length;g<y;g++)u=l[g][r](a)||u;return u}},{}));We.inject(new function(){var r=Math.min,a=Math.max,l=Math.abs,u={unite:{1:!0,2:!0},intersect:{2:!0},subtract:{1:!0},exclude:{1:!0,"-1":!0}};function g(F){return F._children||[F]}function y(F,V){var A=F.clone(!1).reduce({simplify:!0}).transform(null,!0,!0);if(V){for(var N=g(A),G=0,K=N.length;G<K;G++){var F=N[G];!F._closed&&!F.isEmpty()&&(F.closePath(1e-12),F.getFirstSegment().setHandleIn(0,0),F.getLastSegment().setHandleOut(0,0))}A=A.resolveCrossings().reorient(A.getFillRule()==="nonzero",!0)}return A}function P(F,V,A,N,G){var K=new Qe(ne.NO_INSERT);return K.addChildren(F,!0),K=K.reduce({simplify:V}),G&&G.insert==!1||K.insertAbove(N&&A.isSibling(N)&&A.getIndex()<N.getIndex()?N:A),K.copyAttributes(A,!0),K}function L(F){return F.hasOverlap()||F.isCrossing()}function C(F,V,A,N){if(N&&(N.trace==!1||N.stroke)&&/^(subtract|intersect)$/.test(A))return x(F,V,A);var G=y(F,!0),K=V&&F!==V&&y(V,!0),Z=u[A];Z[A]=!0,K&&(Z.subtract||Z.exclude)^(K.isClockwise()^G.isClockwise())&&K.reverse();var ee=D(Re.expand(G.getIntersections(K,L))),se=g(G),ae=K&&g(K),ge=[],ue=[],fe;function be(bt){for(var gi=0,zt=bt.length;gi<zt;gi++){var Jt=bt[gi];s.push(ge,Jt._segments),s.push(ue,Jt.getCurves()),Jt._overlapsOnly=!0}}function ve(bt){for(var gi=[],zt=0,Jt=bt&&bt.length;zt<Jt;zt++)gi.push(ue[bt[zt]]);return gi}if(ee.length){be(se),ae&&be(ae);for(var Ce=new Array(ue.length),Ae=0,je=ue.length;Ae<je;Ae++)Ce[Ae]=ue[Ae].getValues();for(var et=p.findCurveBoundsCollisions(Ce,Ce,0,!0),it={},Ae=0;Ae<ue.length;Ae++){var yt=ue[Ae],dt=yt._path._id,pt=it[dt]=it[dt]||{};pt[yt.getIndex()]={hor:ve(et[Ae].hor),ver:ve(et[Ae].ver)}}for(var Ae=0,je=ee.length;Ae<je;Ae++)W(ee[Ae]._segment,G,K,it,Z);for(var Ae=0,je=ge.length;Ae<je;Ae++){var ut=ge[Ae],xt=ut._intersection;ut._winding||W(ut,G,K,it,Z),xt&&xt._overlap||(ut._path._overlapsOnly=!1)}fe=q(ge,Z)}else fe=E(ae?se.concat(ae):se.slice(),function(bt){return!!Z[bt]});return P(fe,!0,F,V,N)}function x(F,V,A){var N=y(F),G=y(V),K=N.getIntersections(G,L),Z=A==="subtract",ee=A==="divide",se={},ae=[];function ge(be){if(!se[be._id]&&(ee||G.contains(be.getPointAt(be.getLength()/2))^Z))return ae.unshift(be),se[be._id]=!0}for(var ue=K.length-1;ue>=0;ue--){var fe=K[ue].split();fe&&(ge(fe)&&fe.getFirstSegment().setHandleIn(0,0),N.getLastSegment().setHandleOut(0,0))}return ge(N),P(ae,!1,F,V)}function k(F,V){for(var A=F;A;){if(A===V)return;A=A._previous}for(;F._next&&F._next!==V;)F=F._next;if(!F._next){for(;V._previous;)V=V._previous;F._next=V,V._previous=F}}function M(F){for(var V=F.length-1;V>=0;V--)F[V].clearHandles()}function E(F,V,A){var N=F&&F.length;if(N){var G=s.each(F,function(et,it){this[et._id]={container:null,winding:et.isClockwise()?1:-1,index:it}},{}),K=F.slice().sort(function(et,it){return l(it.getArea())-l(et.getArea())}),Z=K[0],ee=p.findItemBoundsCollisions(K,null,w.GEOMETRIC_EPSILON);A==null&&(A=Z.isClockwise());for(var se=0;se<N;se++){var ae=K[se],ge=G[ae._id],ue=0,fe=ee[se];if(fe){for(var be=null,ve=fe.length-1;ve>=0;ve--)if(fe[ve]<se){be=be||ae.getInteriorPoint();var Ce=K[fe[ve]];if(Ce.contains(be)){var Ae=G[Ce._id];ue=Ae.winding,ge.winding+=ue,ge.container=Ae.exclude?Ae.container:Ce;break}}}if(V(ge.winding)===V(ue))ge.exclude=!0,F[ge.index]=null;else{var je=ge.container;ae.setClockwise(je?!je.isClockwise():A)}}}return F}function D(F,V,A){var N=V&&[],G=1e-8,K=1-G,Z=!1,ee=A||[],se=A&&{},ae,ge,ue;function fe(gi){return gi._path._id+"."+gi._segment1._index}for(var be=(A&&A.length)-1;be>=0;be--){var ve=A[be];ve._path&&(se[fe(ve)]=!0)}for(var be=F.length-1;be>=0;be--){var Ce=F[be],Ae=Ce._time,je=Ae,et=V&&!V(Ce),ve=Ce._curve,it;if(ve&&(ve!==ge?(Z=!ve.hasHandles()||se&&se[fe(ve)],ae=[],ue=null,ge=ve):ue>=G&&(Ae/=ue)),et){ae&&ae.push(Ce);continue}else V&&N.unshift(Ce);if(ue=je,Ae<G)it=ve._segment1;else if(Ae>K)it=ve._segment2;else{var yt=ve.divideAtTime(Ae,!0);Z&&ee.push(ve,yt),it=yt._segment1;for(var dt=ae.length-1;dt>=0;dt--){var pt=ae[dt];pt._time=(pt._time-Ae)/(1-Ae)}}Ce._setSegment(it);var ut=it._intersection,xt=Ce._intersection;if(ut){k(ut,xt);for(var bt=ut;bt;)k(bt._intersection,ut),bt=bt._next}else it._intersection=xt}return A||M(ee),N||F}function B(F,V,A,N,G){var K=Array.isArray(V)?V:V[A?"hor":"ver"],Z=A?1:0,ee=Z^1,se=[F.x,F.y],ae=se[Z],ge=se[ee],ue=1e-9,fe=1e-6,be=ae-ue,ve=ae+ue,Ce=0,Ae=0,je=0,et=0,it=!1,yt=!1,dt=1,pt=[],ut,xt;function bt(bi){var Ei=bi[ee+0],as=bi[ee+6];if(!(ge<r(Ei,as)||ge>a(Ei,as))){var ms=bi[Z+0],_n=bi[Z+2],qr=bi[Z+4],On=bi[Z+6];if(Ei===as){(ms<ve&&On>be||On<ve&&ms>be)&&(it=!0);return}var Xn=ge===Ei?0:ge===as||be>a(ms,_n,qr,On)||ve<r(ms,_n,qr,On)?1:Ie.solveCubic(bi,ee,ge,pt,0,1)>0?pt[0]:1,Qs=Xn===0?ms:Xn===1?On:Ie.getPoint(bi,Xn)[A?"y":"x"],Zs=Ei>as?1:-1,Xr=ut[ee]>ut[ee+6]?1:-1,vn=ut[Z+6];return ge!==Ei?(Qs<be?je+=Zs:Qs>ve?et+=Zs:it=!0,Qs>ae-fe&&Qs<ae+fe&&(dt/=2)):(Zs!==Xr?ms<be?je+=Zs:ms>ve&&(et+=Zs):ms!=vn&&(vn<ve&&Qs>ve?(et+=Zs,it=!0):vn>be&&Qs<be&&(je+=Zs,it=!0)),dt/=4),ut=bi,!G&&Qs>be&&Qs<ve&&Ie.getTangent(bi,Xn)[A?"x":"y"]===0&&B(F,V,!A,N,!0)}}function gi(bi){var Ei=bi[ee+0],as=bi[ee+2],ms=bi[ee+4],_n=bi[ee+6];if(ge<=a(Ei,as,ms,_n)&&ge>=r(Ei,as,ms,_n)){for(var qr=bi[Z+0],On=bi[Z+2],Xn=bi[Z+4],Qs=bi[Z+6],Zs=be>a(qr,On,Xn,Qs)||ve<r(qr,On,Xn,Qs)?[bi]:Ie.getMonoCurves(bi,A),Xr,vn=0,Nl=Zs.length;vn<Nl;vn++)if(Xr=bt(Zs[vn]))return Xr}}for(var zt=0,Jt=K.length;zt<Jt;zt++){var ei=K[zt],Bt=ei._path,fs=ei.getValues(),rs;if((!zt||K[zt-1]._path!==Bt)&&(ut=null,Bt._closed||(xt=Ie.getValues(Bt.getLastCurve().getSegment2(),ei.getSegment1(),null,!N),xt[ee]!==xt[ee+6]&&(ut=xt)),!ut)){ut=fs;for(var Ps=Bt.getLastCurve();Ps&&Ps!==ei;){var Xi=Ps.getValues();if(Xi[ee]!==Xi[ee+6]){ut=Xi;break}Ps=Ps.getPrevious()}}if(rs=gi(fs))return rs;if(zt+1===Jt||K[zt+1]._path!==Bt){if(xt&&(rs=gi(xt)))return rs;it&&!je&&!et&&(je=et=Bt.isClockwise(N)^A?1:-1),Ce+=je,Ae+=et,je=et=0,it&&(yt=!0,it=!1),xt=null}}return Ce=l(Ce),Ae=l(Ae),{winding:a(Ce,Ae),windingL:Ce,windingR:Ae,quality:dt,onPath:yt}}function W(F,V,A,N,G){var K=[],Z=F,ee=0,ue;do{var se=F.getCurve();if(se){var ae=se.getLength();K.push({segment:F,curve:se,length:ae}),ee+=ae}F=F.getNext()}while(F&&!F._intersection&&F!==Z);for(var ge=[.5,.25,.75],ue={winding:0,quality:-1},fe=.001,be=1-fe,ve=0;ve<ge.length&&ue.quality<.5;ve++)for(var ae=ee*ge[ve],Ce=0,Ae=K.length;Ce<Ae;Ce++){var je=K[Ce],et=je.length;if(ae<=et){var se=je.curve,it=se._path,yt=it._parent,dt=yt instanceof Qe?yt:it,pt=w.clamp(se.getTimeAt(ae),fe,be),ut=se.getPointAtTime(pt),xt=l(se.getTangentAtTime(pt).y)<Math.SQRT1_2,bt=null;if(G.subtract&&A){var gi=dt===V?A:V,zt=gi._getWinding(ut,xt,!0);if(dt===V&&zt.winding||dt===A&&!zt.winding){if(zt.quality<1)continue;bt={winding:0,quality:1}}}bt=bt||B(ut,N[it._id][se.getIndex()],xt,!0),bt.quality>ue.quality&&(ue=bt);break}ae-=et}for(var Ce=K.length-1;Ce>=0;Ce--)K[Ce].segment._winding=ue}function q(F,V){var A=[],N;function G(Jt){var ei;return!!(Jt&&!Jt._visited&&(!V||V[(ei=Jt._winding||{}).winding]&&!(V.unite&&ei.winding===2&&ei.windingL&&ei.windingR)))}function K(Jt){if(Jt){for(var ei=0,Bt=N.length;ei<Bt;ei++)if(Jt===N[ei])return!0}return!1}function Z(Jt){for(var ei=Jt._segments,Bt=0,fs=ei.length;Bt<fs;Bt++)ei[Bt]._visited=!0}function ee(Jt,ei){var Bt=Jt._intersection,fs=Bt,rs=[];ei&&(N=[Jt]);function Ps(Xi,bi){for(;Xi&&Xi!==bi;){var Ei=Xi._segment,as=Ei&&Ei._path;if(as){var ms=Ei.getNext()||as.getFirstSegment(),_n=ms._intersection;Ei!==Jt&&(K(Ei)||K(ms)||ms&&G(Ei)&&(G(ms)||_n&&G(_n._segment)))&&rs.push(Ei),ei&&N.push(Ei)}Xi=Xi._next}}if(Bt){for(Ps(Bt);Bt&&Bt._previous;)Bt=Bt._previous;Ps(Bt,fs)}return rs}F.sort(function(Jt,ei){var Bt=Jt._intersection,fs=ei._intersection,rs=!!(Bt&&Bt._overlap),Ps=!!(fs&&fs._overlap),Xi=Jt._path,bi=ei._path;return rs^Ps?rs?1:-1:!Bt^!fs?Bt?1:-1:Xi!==bi?Xi._id-bi._id:Jt._index-ei._index});for(var se=0,ae=F.length;se<ae;se++){var ge=F[se],ue=G(ge),fe=null,be=!1,ve=!0,Ce=[],Ae,je,et;if(ue&&ge._path._overlapsOnly){var it=ge._path,yt=ge._intersection._segment._path;it.compare(yt)&&(it.getArea()&&A.push(it.clone(!1)),Z(it),Z(yt),ue=!1)}for(;ue;){var dt=!fe,pt=ee(ge,dt),ut=pt.shift(),be=!dt&&(K(ge)||K(ut)),xt=!be&&ut;if(dt&&(fe=new Ve(ne.NO_INSERT),Ae=null),be){(ge.isFirst()||ge.isLast())&&(ve=ge._path._closed),ge._visited=!0;break}if(xt&&Ae&&(Ce.push(Ae),Ae=null),Ae||(xt&&pt.push(ge),Ae={start:fe._segments.length,crossings:pt,visited:je=[],handleIn:et}),xt&&(ge=ut),!G(ge)){fe.removeSegments(Ae.start);for(var bt=0,gi=je.length;bt<gi;bt++)je[bt]._visited=!1;je.length=0;do ge=Ae&&Ae.crossings.shift(),(!ge||!ge._path)&&(ge=null,Ae=Ce.pop(),Ae&&(je=Ae.visited,et=Ae.handleIn));while(Ae&&!G(ge));if(!ge)break}var zt=ge.getNext();fe.add(new Ee(ge._point,et,zt&&ge._handleOut)),ge._visited=!0,je.push(ge),ge=zt||ge._path.getFirstSegment(),et=zt&&zt._handleIn}be&&(ve&&(fe.getFirstSegment().setHandleIn(et),fe.setClosed(ve)),fe.getArea()!==0&&A.push(fe))}return A}return{_getWinding:function(F,V,A){return B(F,this.getCurves(),V,A)},unite:function(F,V){return C(this,F,"unite",V)},intersect:function(F,V){return C(this,F,"intersect",V)},subtract:function(F,V){return C(this,F,"subtract",V)},exclude:function(F,V){return C(this,F,"exclude",V)},divide:function(F,V){return V&&(V.trace==!1||V.stroke)?x(this,F,"divide"):P([this.subtract(F,V),this.intersect(F,V)],!0,this,F,V)},resolveCrossings:function(){var F=this._children,V=F||[this];function A(Ae,je){var et=Ae&&Ae._intersection;return et&&et._overlap&&et._path===je}var N=!1,G=!1,K=this.getIntersections(null,function(Ae){return Ae.hasOverlap()&&(N=!0)||Ae.isCrossing()&&(G=!0)}),Z=N&&G&&[];if(K=Re.expand(K),N)for(var ee=D(K,function(Ae){return Ae.hasOverlap()},Z),se=ee.length-1;se>=0;se--){var ae=ee[se],ge=ae._path,ue=ae._segment,fe=ue.getPrevious(),be=ue.getNext();A(fe,ge)&&A(be,ge)&&(ue.remove(),fe._handleOut._set(0,0),be._handleIn._set(0,0),fe!==ue&&!fe.getCurve().hasLength()&&(be._handleIn.set(fe._handleIn),fe.remove()))}G&&(D(K,N&&function(Ae){var je=Ae.getCurve(),et=Ae.getSegment(),it=Ae._intersection,yt=it._curve,dt=it._segment;if(je&&yt&&je._path&&yt._path)return!0;et&&(et._intersection=null),dt&&(dt._intersection=null)},Z),Z&&M(Z),V=q(s.each(V,function(Ae){s.push(this,Ae._segments)},[])));var ve=V.length,Ce;return ve>1&&F?(V!==F&&this.setChildren(V),Ce=this):ve===1&&!F&&(V[0]!==this&&this.setSegments(V[0].removeSegments()),Ce=this),Ce||(Ce=new Qe(ne.NO_INSERT),Ce.addChildren(V),Ce=Ce.reduce(),Ce.copyAttributes(this),this.replaceWith(Ce)),Ce},reorient:function(F,V){var A=this._children;return A&&A.length?this.setChildren(E(this.removeChildren(),function(N){return!!(F?N:N&1)},V)):V!==t&&this.setClockwise(V),this},getInteriorPoint:function(){var F=this.getBounds(),V=F.getCenter(!0);if(!this.contains(V)){for(var A=this.getCurves(),N=V.y,G=[],K=[],Z=0,ee=A.length;Z<ee;Z++){var se=A[Z].getValues(),ae=se[1],ge=se[3],ue=se[5],fe=se[7];if(N>=r(ae,ge,ue,fe)&&N<=a(ae,ge,ue,fe))for(var be=Ie.getMonoCurves(se),ve=0,Ce=be.length;ve<Ce;ve++){var Ae=be[ve],je=Ae[1],et=Ae[7];if(je!==et&&(N>=je&&N<=et||N>=et&&N<=je)){var it=N===je?Ae[0]:N===et?Ae[6]:Ie.solveCubic(Ae,1,N,K,0,1)===1?Ie.getPoint(Ae,K[0]).x:(Ae[0]+Ae[6])/2;G.push(it)}}}G.length>1&&(G.sort(function(yt,dt){return yt-dt}),V.x=(G[0]+G[1])/2)}return V}}});var Ot=s.extend({_class:"PathFlattener",initialize:function(r,a,l,u,g){var y=[],P=[],L=0,C=1/(l||32),x=r._segments,k=x[0],M;function E(q,F){var V=Ie.getValues(q,F,g);y.push(V),D(V,q._index,0,1)}function D(q,F,V,A){if(A-V>C&&!(u&&Ie.isStraight(q))&&!Ie.isFlatEnough(q,a||.25)){var N=Ie.subdivide(q,.5),G=(V+A)/2;D(N[0],F,V,G),D(N[1],F,G,A)}else{var K=q[6]-q[0],Z=q[7]-q[1],ee=Math.sqrt(K*K+Z*Z);ee>0&&(L+=ee,P.push({offset:L,curve:q,index:F,time:A}))}}for(var B=1,W=x.length;B<W;B++)M=x[B],E(k,M),k=M;r._closed&&E(M||k,x[0]),this.curves=y,this.parts=P,this.length=L,this.index=0},_get:function(r){for(var a=this.parts,l=a.length,u,g=this.index;u=g,!(!g||a[--g].offset<r););for(;u<l;u++){var y=a[u];if(y.offset>=r){this.index=u;var P=a[u-1],L=P&&P.index===y.index?P.time:0,C=P?P.offset:0;return{index:y.index,time:L+(y.time-L)*(r-C)/(y.offset-C)}}}return{index:a[l-1].index,time:1}},drawPart:function(r,a,l){for(var u=this._get(a),g=this._get(l),y=u.index,P=g.index;y<=P;y++){var L=Ie.getPart(this.curves[y],y===u.index?u.time:0,y===g.index?g.time:1);y===u.index&&r.moveTo(L[0],L[1]),r.bezierCurveTo.apply(r,L.slice(2))}}},s.each(Ie._evaluateMethods,function(r){this[r+"At"]=function(a){var l=this._get(a);return Ie[r](this.curves[l.index],l.time)}},{})),Tt=s.extend({initialize:function(r){for(var a=this.points=[],l=r._segments,u=r._closed,g=0,y,P=l.length;g<P;g++){var L=l[g].point;(!y||!y.equals(L))&&a.push(y=L.clone())}u&&(a.unshift(a[a.length-1]),a.push(a[1])),this.closed=u},fit:function(r){var a=this.points,l=a.length,u=null;return l>0&&(u=[new Ee(a[0])],l>1&&(this.fitCubic(u,r,0,l-1,a[1].subtract(a[0]),a[l-2].subtract(a[l-1])),this.closed&&(u.shift(),u.pop()))),u},fitCubic:function(r,a,l,u,g,y){var P=this.points;if(u-l===1){var L=P[l],C=P[u],x=L.getDistance(C)/3;this.addCurve(r,[L,L.add(g.normalize(x)),C.add(y.normalize(x)),C]);return}for(var k=this.chordLengthParameterize(l,u),M=Math.max(a,a*a),E,D=!0,B=0;B<=4;B++){var W=this.generateBezier(l,u,k,g,y),q=this.findMaxError(l,u,W,k);if(q.error<a&&D){this.addCurve(r,W);return}if(E=q.index,q.error>=M)break;D=this.reparameterize(l,u,k,W),M=q.error}var F=P[E-1].subtract(P[E+1]);this.fitCubic(r,a,l,E,g,F),this.fitCubic(r,a,E,u,F.negate(),y)},addCurve:function(r,a){var l=r[r.length-1];l.setHandleOut(a[1].subtract(a[0])),r.push(new Ee(a[3],a[2].subtract(a[3])))},generateBezier:function(r,a,l,u,g){for(var y=1e-12,P=Math.abs,L=this.points,C=L[r],x=L[a],k=[[0,0],[0,0]],M=[0,0],E=0,D=a-r+1;E<D;E++){var B=l[E],W=1-B,q=3*B*W,F=W*W*W,V=q*W,A=q*B,N=B*B*B,G=u.normalize(V),K=g.normalize(A),Z=L[r+E].subtract(C.multiply(F+V)).subtract(x.multiply(A+N));k[0][0]+=G.dot(G),k[0][1]+=G.dot(K),k[1][0]=k[0][1],k[1][1]+=K.dot(K),M[0]+=G.dot(Z),M[1]+=K.dot(Z)}var ee=k[0][0]*k[1][1]-k[1][0]*k[0][1],se,ae;if(P(ee)>y){var ge=k[0][0]*M[1]-k[1][0]*M[0],ue=M[0]*k[1][1]-M[1]*k[0][1];se=ue/ee,ae=ge/ee}else{var fe=k[0][0]+k[0][1],be=k[1][0]+k[1][1];se=ae=P(fe)>y?M[0]/fe:P(be)>y?M[1]/be:0}var ve=x.getDistance(C),Ce=y*ve,Ae,je;if(se<Ce||ae<Ce)se=ae=ve/3;else{var et=x.subtract(C);Ae=u.normalize(se),je=g.normalize(ae),Ae.dot(et)-je.dot(et)>ve*ve&&(se=ae=ve/3,Ae=je=null)}return[C,C.add(Ae||u.normalize(se)),x.add(je||g.normalize(ae)),x]},reparameterize:function(r,a,l,u){for(var g=r;g<=a;g++)l[g-r]=this.findRoot(u,this.points[g],l[g-r]);for(var g=1,y=l.length;g<y;g++)if(l[g]<=l[g-1])return!1;return!0},findRoot:function(r,a,l){for(var u=[],g=[],y=0;y<=2;y++)u[y]=r[y+1].subtract(r[y]).multiply(3);for(var y=0;y<=1;y++)g[y]=u[y+1].subtract(u[y]).multiply(2);var P=this.evaluate(3,r,l),L=this.evaluate(2,u,l),C=this.evaluate(1,g,l),x=P.subtract(a),k=L.dot(L)+x.dot(C);return w.isMachineZero(k)?l:l-x.dot(L)/k},evaluate:function(r,a,l){for(var u=a.slice(),g=1;g<=r;g++)for(var y=0;y<=r-g;y++)u[y]=u[y].multiply(1-l).add(u[y+1].multiply(l));return u[0]},chordLengthParameterize:function(r,a){for(var l=[0],u=r+1;u<=a;u++)l[u-r]=l[u-r-1]+this.points[u].getDistance(this.points[u-1]);for(var u=1,g=a-r;u<=g;u++)l[u]/=l[g];return l},findMaxError:function(r,a,l,u){for(var g=Math.floor((a-r+1)/2),y=0,P=r+1;P<a;P++){var L=this.evaluate(3,l,u[P-r]),C=L.subtract(this.points[P]),x=C.x*C.x+C.y*C.y;x>=y&&(y=x,g=P)}return{error:y,index:g}}}),ot=ne.extend({_class:"TextItem",_applyMatrix:!1,_canApplyMatrix:!1,_serializeFields:{content:null},_boundsOptions:{stroke:!1,handle:!1},initialize:function(a){this._content="",this._lines=[];var l=a&&s.isPlainObject(a)&&a.x===t&&a.y===t;this._initialize(l&&a,!l&&T.read(arguments))},_equals:function(r){return this._content===r._content},copyContent:function(r){this.setContent(r._content)},getContent:function(){return this._content},setContent:function(r){this._content=""+r,this._lines=this._content.split(/\r\n|\n|\r/mg),this._changed(521)},isEmpty:function(){return!this._content},getCharacterStyle:"#getStyle",setCharacterStyle:"#setStyle",getParagraphStyle:"#getStyle",setParagraphStyle:"#setStyle"}),gt=ot.extend({_class:"PointText",initialize:function(){ot.apply(this,arguments)},getPoint:function(){var r=this._matrix.getTranslation();return new z(r.x,r.y,this,"setPoint")},setPoint:function(){var r=T.read(arguments);this.translate(r.subtract(this._matrix.getTranslation()))},_draw:function(r,a,l){if(this._content){this._setStyles(r,a,l);var u=this._lines,g=this._style,y=g.hasFill(),P=g.hasStroke(),L=g.getLeading(),C=r.shadowColor;r.font=g.getFontStyle(),r.textAlign=g.getJustification();for(var x=0,k=u.length;x<k;x++){r.shadowColor=C;var M=u[x];y&&(r.fillText(M,0,0),r.shadowColor="rgba(0,0,0,0)"),P&&r.strokeText(M,0,0),r.translate(0,L)}}},_getBounds:function(r,a){var l=this._style,u=this._lines,g=u.length,y=l.getJustification(),P=l.getLeading(),L=this.getView().getTextWidth(l.getFontStyle(),u),C=0;y!=="left"&&(C-=L/(y==="center"?2:1));var x=new Y(C,g?-.75*P:0,L,g*P);return r?r._transformBounds(x,x):x}}),Lt=s.extend(new function(){var r={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"],gradient:["gradient","origin","destination","highlight"]},a={},l={transparent:[0,0,0,0]},u;function g(L){var C=L.match(/^#([\da-f]{2})([\da-f]{2})([\da-f]{2})([\da-f]{2})?$/i)||L.match(/^#([\da-f])([\da-f])([\da-f])([\da-f])?$/i),x="rgb",k;if(C){var M=C[4]?4:3;k=new Array(M);for(var E=0;E<M;E++){var D=C[E+1];k[E]=parseInt(D.length==1?D+D:D,16)/255}}else if(C=L.match(/^(rgb|hsl)a?\((.*)\)$/)){x=C[1],k=C[2].trim().split(/[,\s]+/g);for(var B=x==="hsl",E=0,W=Math.min(k.length,4);E<W;E++){var q=k[E],D=parseFloat(q);if(B)if(E===0){var F=q.match(/([a-z]*)$/)[1];D*={turn:360,rad:180/Math.PI,grad:.9}[F]||1}else E<3&&(D/=100);else E<3&&(D/=/%$/.test(q)?100:255);k[E]=D}}else{var V=l[L];if(!V)if(e){u||(u=re.getContext(1,1,{willReadFrequently:!0}),u.globalCompositeOperation="copy"),u.fillStyle="rgba(0,0,0,0)",u.fillStyle=L,u.fillRect(0,0,1,1);var A=u.getImageData(0,0,1,1).data;V=l[L]=[A[0]/255,A[1]/255,A[2]/255]}else V=[0,0,0];k=V.slice()}return[x,k]}var y=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],P={"rgb-hsb":function(L,C,x){var k=Math.max(L,C,x),M=Math.min(L,C,x),E=k-M,D=E===0?0:(k==L?(C-x)/E+(C<x?6:0):k==C?(x-L)/E+2:(L-C)/E+4)*60;return[D,k===0?0:E/k,k]},"hsb-rgb":function(L,C,x){L=(L/60%6+6)%6;var M=Math.floor(L),k=L-M,M=y[M],E=[x,x*(1-C),x*(1-C*k),x*(1-C*(1-k))];return[E[M[0]],E[M[1]],E[M[2]]]},"rgb-hsl":function(L,C,x){var k=Math.max(L,C,x),M=Math.min(L,C,x),E=k-M,D=E===0,B=D?0:(k==L?(C-x)/E+(C<x?6:0):k==C?(x-L)/E+2:(L-C)/E+4)*60,W=(k+M)/2,q=D?0:W<.5?E/(k+M):E/(2-k-M);return[B,q,W]},"hsl-rgb":function(L,C,x){if(L=(L/360%1+1)%1,C===0)return[x,x,x];for(var k=[L+1/3,L,L-1/3],M=x<.5?x*(1+C):x+C-x*C,E=2*x-M,D=[],B=0;B<3;B++){var W=k[B];W<0&&(W+=1),W>1&&(W-=1),D[B]=6*W<1?E+(M-E)*6*W:2*W<1?M:3*W<2?E+(M-E)*(2/3-W)*6:E}return D},"rgb-gray":function(L,C,x){return[L*.2989+C*.587+x*.114]},"gray-rgb":function(L){return[L,L,L]},"gray-hsb":function(L){return[0,0,L]},"gray-hsl":function(L){return[0,0,L]},"gradient-rgb":function(){return[]},"rgb-gradient":function(){return[]}};return s.each(r,function(L,C){a[C]=[],s.each(L,function(x,k){var M=s.capitalize(x),E=/^(hue|saturation)$/.test(x),D=a[C][k]=C==="gradient"?x==="gradient"?function(B){var W=this._components[0];return B=Vt.read(Array.isArray(B)?B:arguments,0,{readNull:!0}),W!==B&&(W&&W._removeOwner(this),B&&B._addOwner(this)),B}:function(){return T.read(arguments,0,{readNull:x==="highlight",clone:!0})}:function(B){return B==null||isNaN(B)?0:+B};this["get"+M]=function(){return this._type===C||E&&/^hs[bl]$/.test(this._type)?this._components[k]:this._convert(C)[k]},this["set"+M]=function(B){this._type!==C&&!(E&&/^hs[bl]$/.test(this._type))&&(this._components=this._convert(C),this._properties=r[C],this._type=C),this._components[k]=D.call(this,B),this._changed()}},this)},{_class:"Color",_readIndex:!0,initialize:function L(C){var x=arguments,k=this.__read,M=0,E,D,B,W;Array.isArray(C)&&(x=C,C=x[0]);var q=C!=null&&typeof C;if(q==="string"&&C in r&&(E=C,C=x[1],Array.isArray(C)?(D=C,B=x[2]):(k&&(M=1),x=s.slice(x,1),q=typeof C)),!D){if(W=q==="number"?x:q==="object"&&C.length!=null?C:null,W){E||(E=W.length>=3?"rgb":"gray");var F=r[E].length;B=W[F],k&&(M+=W===arguments?F+(B!=null?1:0):1),W.length>F&&(W=s.slice(W,0,F))}else if(q==="string"){var V=g(C);E=V[0],D=V[1],D.length===4&&(B=D[3],D.length--)}else if(q==="object")if(C.constructor===L){if(E=C._type,D=C._components.slice(),B=C._alpha,E==="gradient")for(var A=1,N=D.length;A<N;A++){var G=D[A];G&&(D[A]=G.clone())}}else if(C.constructor===Vt)E="gradient",W=x;else{E="hue"in C?"lightness"in C?"hsl":"hsb":"gradient"in C||"stops"in C||"radial"in C?"gradient":"gray"in C?"gray":"rgb";var K=r[E],Z=a[E];this._components=D=[];for(var A=0,N=K.length;A<N;A++){var ee=C[K[A]];ee==null&&!A&&E==="gradient"&&"stops"in C&&(ee={stops:C.stops,radial:C.radial}),ee=Z[A].call(this,ee),ee!=null&&(D[A]=ee)}B=C.alpha}k&&E&&(M=1)}if(this._type=E||"rgb",!D){this._components=D=[];for(var Z=a[this._type],A=0,N=Z.length;A<N;A++){var ee=Z[A].call(this,W&&W[A]);ee!=null&&(D[A]=ee)}}return this._components=D,this._properties=r[this._type],this._alpha=B,k&&(this.__read=M),this},set:"#initialize",_serialize:function(L,C){var x=this.getComponents();return s.serialize(/^(gray|rgb)$/.test(this._type)?x:[this._type].concat(x),L,!0,C)},_changed:function(){this._canvasStyle=null,this._owner&&(this._setter?this._owner[this._setter](this):this._owner._changed(129))},_convert:function(L){var C;return this._type===L?this._components.slice():(C=P[this._type+"-"+L])?C.apply(this,this._components):P["rgb-"+L].apply(this,P[this._type+"-rgb"].apply(this,this._components))},convert:function(L){return new Lt(L,this._convert(L),this._alpha)},getType:function(){return this._type},setType:function(L){this._components=this._convert(L),this._properties=r[L],this._type=L},getComponents:function(){var L=this._components.slice();return this._alpha!=null&&L.push(this._alpha),L},getAlpha:function(){return this._alpha!=null?this._alpha:1},setAlpha:function(L){this._alpha=L==null?null:Math.min(Math.max(L,0),1),this._changed()},hasAlpha:function(){return this._alpha!=null},equals:function(L){var C=s.isPlainValue(L,!0)?Lt.read(arguments):L;return C===this||C&&this._class===C._class&&this._type===C._type&&this.getAlpha()===C.getAlpha()&&s.equals(this._components,C._components)||!1},toString:function(){for(var L=this._properties,C=[],x=this._type==="gradient",k=f.instance,M=0,E=L.length;M<E;M++){var D=this._components[M];D!=null&&C.push(L[M]+": "+(x?D:k.number(D)))}return this._alpha!=null&&C.push("alpha: "+k.number(this._alpha)),"{ "+C.join(", ")+" }"},toCSS:function(L){var C=this._convert("rgb"),x=L||this._alpha==null?1:this._alpha;function k(M){return Math.round((M<0?0:M>1?1:M)*255)}return C=[k(C[0]),k(C[1]),k(C[2])],x<1&&C.push(x<0?0:x),L?"#"+((1<<24)+(C[0]<<16)+(C[1]<<8)+C[2]).toString(16).slice(1):(C.length==4?"rgba(":"rgb(")+C.join(",")+")"},toCanvasStyle:function(L,C){if(this._canvasStyle)return this._canvasStyle;if(this._type!=="gradient")return this._canvasStyle=this.toCSS();var x=this._components,k=x[0],M=k._stops,E=x[1],D=x[2],B=x[3],W=C&&C.inverted(),q;if(W&&(E=W._transformPoint(E),D=W._transformPoint(D),B&&(B=W._transformPoint(B))),k._radial){var F=D.getDistance(E);if(B){var V=B.subtract(E);V.getLength()>F&&(B=E.add(V.normalize(F-.1)))}var A=B||E;q=L.createRadialGradient(A.x,A.y,0,E.x,E.y,F)}else q=L.createLinearGradient(E.x,E.y,D.x,D.y);for(var N=0,G=M.length;N<G;N++){var K=M[N],Z=K._offset;q.addColorStop(Z??N/(G-1),K._color.toCanvasStyle())}return this._canvasStyle=q},transform:function(L){if(this._type==="gradient"){for(var C=this._components,x=1,k=C.length;x<k;x++){var M=C[x];L._transformPoint(M,M,!0)}this._changed()}},statics:{_types:r,random:function(){var L=Math.random;return new Lt(L(),L(),L())},_setOwner:function(L,C,x){return L&&(L._owner&&C&&L._owner!==C&&(L=L.clone()),!L._owner^!C&&(L._owner=C||null,L._setter=x||null)),L}}})},new function(){var r={add:function(a,l){return a+l},subtract:function(a,l){return a-l},multiply:function(a,l){return a*l},divide:function(a,l){return a/l}};return s.each(r,function(a,l){this[l]=function(u){u=Lt.read(arguments);for(var g=this._type,y=this._components,P=u._convert(g),L=0,C=y.length;L<C;L++)P[L]=a(y[L],P[L]);return new Lt(g,P,this._alpha!=null?a(this._alpha,u.getAlpha()):null)}},{})}),Vt=s.extend({_class:"Gradient",initialize:function(a,l){this._id=O.get(),a&&s.isPlainObject(a)&&(this.set(a),a=l=null),this._stops==null&&this.setStops(a||["white","black"]),this._radial==null&&this.setRadial(typeof l=="string"&&l==="radial"||l||!1)},_serialize:function(r,a){return a.add(this,function(){return s.serialize([this._stops,this._radial],r,!0,a)})},_changed:function(){for(var r=0,a=this._owners&&this._owners.length;r<a;r++)this._owners[r]._changed()},_addOwner:function(r){this._owners||(this._owners=[]),this._owners.push(r)},_removeOwner:function(r){var a=this._owners?this._owners.indexOf(r):-1;a!=-1&&(this._owners.splice(a,1),this._owners.length||(this._owners=t))},clone:function(){for(var r=[],a=0,l=this._stops.length;a<l;a++)r[a]=this._stops[a].clone();return new Vt(r,this._radial)},getStops:function(){return this._stops},setStops:function(r){if(r.length<2)throw new Error("Gradient stop list needs to contain at least two stops.");var a=this._stops;if(a)for(var l=0,u=a.length;l<u;l++)a[l]._owner=t;a=this._stops=hi.readList(r,0,{clone:!0});for(var l=0,u=a.length;l<u;l++)a[l]._owner=this;this._changed()},getRadial:function(){return this._radial},setRadial:function(r){this._radial=r,this._changed()},equals:function(r){if(r===this)return!0;if(r&&this._class===r._class){var a=this._stops,l=r._stops,u=a.length;if(u===l.length){for(var g=0;g<u;g++)if(!a[g].equals(l[g]))return!1;return!0}}return!1}}),hi=s.extend({_class:"GradientStop",initialize:function(a,l){var u=a,g=l;typeof a=="object"&&l===t&&(Array.isArray(a)&&typeof a[0]!="number"?(u=a[0],g=a[1]):("color"in a||"offset"in a||"rampPoint"in a)&&(u=a.color,g=a.offset||a.rampPoint||0)),this.setColor(u),this.setOffset(g)},clone:function(){return new hi(this._color.clone(),this._offset)},_serialize:function(r,a){var l=this._color,u=this._offset;return s.serialize(u==null?[l]:[l,u],r,!0,a)},_changed:function(){this._owner&&this._owner._changed(129)},getOffset:function(){return this._offset},setOffset:function(r){this._offset=r,this._changed()},getRampPoint:"#getOffset",setRampPoint:"#setOffset",getColor:function(){return this._color},setColor:function(){Lt._setOwner(this._color,null),this._color=Lt._setOwner(Lt.read(arguments,0),this,"setColor"),this._changed()},equals:function(r){return r===this||r&&this._class===r._class&&this._color.equals(r._color)&&this._offset==r._offset||!1}}),Oi=s.extend(new function(){var r={fillColor:null,fillRule:"nonzero",strokeColor:null,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",strokeScaling:!0,miterLimit:10,dashOffset:0,dashArray:[],shadowColor:null,shadowBlur:0,shadowOffset:new T,selectedColor:null},a=s.set({},r,{fontFamily:"sans-serif",fontWeight:"normal",fontSize:12,leading:null,justification:"left"}),l=s.set({},a,{fillColor:new Lt}),u={strokeWidth:193,strokeCap:193,strokeJoin:193,strokeScaling:201,miterLimit:193,fontFamily:9,fontWeight:9,fontSize:9,font:9,leading:9,justification:9},g={beans:!0},y={_class:"Style",beans:!0,initialize:function(L,C,x){this._values={},this._owner=C,this._project=C&&C._project||x||Be.project,this._defaults=!C||C instanceof me?a:C instanceof ot?l:r,L&&this.set(L)}};return s.each(a,function(P,L){var C=/Color$/.test(L),x=L==="shadowOffset",k=s.capitalize(L),M=u[L],E="set"+k,D="get"+k;y[E]=function(B){var W=this._owner,q=W&&W._children,F=q&&q.length>0&&!(W instanceof Qe);if(F)for(var V=0,A=q.length;V<A;V++)q[V]._style[E](B);if((L==="selectedColor"||!F)&&L in this._defaults){var N=this._values[L];N!==B&&(C&&(N&&(Lt._setOwner(N,null),N._canvasStyle=null),B&&B.constructor===Lt&&(B=Lt._setOwner(B,W,F&&E))),this._values[L]=B,W&&W._changed(M||129))}},y[D]=function(B){var W=this._owner,q=W&&W._children,F=q&&q.length>0&&!(W instanceof Qe),V;if(F&&!B)for(var A=0,N=q.length;A<N;A++){var G=q[A]._style[D]();if(!A)V=G;else if(!s.equals(V,G))return t}else if(L in this._defaults){var V=this._values[L];if(V===t)V=this._defaults[L],V&&V.clone&&(V=V.clone());else{var K=C?Lt:x?T:null;K&&!(V&&V.constructor===K)&&(this._values[L]=V=K.read([V],0,{readNull:!0,clone:!0}))}}return V&&C&&(V=Lt._setOwner(V,W,F&&E)),V},g[D]=function(B){return this._style[D](B)},g[E]=function(B){this._style[E](B)}}),s.each({Font:"FontFamily",WindingRule:"FillRule"},function(P,L){var C="get"+L,x="set"+L;y[C]=g[C]="#get"+P,y[x]=g[x]="#set"+P}),ne.inject(g),y},{set:function(r){var a=r instanceof Oi,l=a?r._values:r;if(l){for(var u in l)if(u in this._defaults){var g=l[u];this[u]=g&&a&&g.clone?g.clone():g}}},equals:function(r){function a(l,u,g){var y=l._values,P=u._values,L=u._defaults;for(var C in y){var x=y[C],k=P[C];if(!(g&&C in P)&&!s.equals(x,k===t?L[C]:k))return!1}return!0}return r===this||r&&this._class===r._class&&a(this,r)&&a(r,this,!0)||!1},_dispose:function(){var r;r=this.getFillColor(),r&&(r._canvasStyle=null),r=this.getStrokeColor(),r&&(r._canvasStyle=null),r=this.getShadowColor(),r&&(r._canvasStyle=null)},hasFill:function(){var r=this.getFillColor();return!!r&&r.alpha>0},hasStroke:function(){var r=this.getStrokeColor();return!!r&&r.alpha>0&&this.getStrokeWidth()>0},hasShadow:function(){var r=this.getShadowColor();return!!r&&r.alpha>0&&(this.getShadowBlur()>0||!this.getShadowOffset().isZero())},getView:function(){return this._project._view},getFontStyle:function(){var r=this.getFontSize();return this.getFontWeight()+" "+r+(/[a-z]/i.test(r+"")?" ":"px ")+this.getFontFamily()},getFont:"#getFontFamily",setFont:"#setFontFamily",getLeading:function r(){var a=r.base.call(this),l=this.getFontSize();return/pt|em|%|px/.test(l)&&(l=this.getView().getPixelSize(l)),a??l*1.2}}),St=new function(){function r(a,l,u,g){for(var y=["","webkit","moz","Moz","ms","o"],P=l[0].toUpperCase()+l.substring(1),L=0;L<6;L++){var C=y[L],x=C?C+P:l;if(x in a){if(u)a[x]=g;else return a[x];break}}}return{getStyles:function(a){var l=a&&a.nodeType!==9?a.ownerDocument:a,u=l&&l.defaultView;return u&&u.getComputedStyle(a,"")},getBounds:function(a,l){var u=a.ownerDocument,g=u.body,y=u.documentElement,P;try{P=a.getBoundingClientRect()}catch{P={left:0,top:0,width:0,height:0}}var L=P.left-(y.clientLeft||g.clientLeft||0),C=P.top-(y.clientTop||g.clientTop||0);if(!l){var x=u.defaultView;L+=x.pageXOffset||y.scrollLeft||g.scrollLeft,C+=x.pageYOffset||y.scrollTop||g.scrollTop}return new Y(L,C,P.width,P.height)},getViewportBounds:function(a){var l=a.ownerDocument,u=l.defaultView,g=l.documentElement;return new Y(0,0,u.innerWidth||g.clientWidth,u.innerHeight||g.clientHeight)},getOffset:function(a,l){return St.getBounds(a,l).getPoint()},getSize:function(a){return St.getBounds(a,!0).getSize()},isInvisible:function(a){return St.getSize(a).equals(new U(0,0))},isInView:function(a){return!St.isInvisible(a)&&St.getViewportBounds(a).intersects(St.getBounds(a,!0))},isInserted:function(a){return i.body.contains(a)},getPrefixed:function(a,l){return a&&r(a,l)},setPrefixed:function(a,l,u){if(typeof l=="object")for(var g in l)r(a,g,!0,l[g]);else r(a,l,!0,u)}}},Ht={add:function(r,a){if(r)for(var l in a)for(var u=a[l],g=l.split(/[\s,]+/g),y=0,P=g.length;y<P;y++){var L=g[y],C=r===i&&(L==="touchstart"||L==="touchmove")?{passive:!1}:!1;r.addEventListener(L,u,C)}},remove:function(r,a){if(r)for(var l in a)for(var u=a[l],g=l.split(/[\s,]+/g),y=0,P=g.length;y<P;y++)r.removeEventListener(g[y],u,!1)},getPoint:function(r){var a=r.targetTouches?r.targetTouches.length?r.targetTouches[0]:r.changedTouches[0]:r;return new T(a.pageX||a.clientX+i.documentElement.scrollLeft,a.pageY||a.clientY+i.documentElement.scrollTop)},getTarget:function(r){return r.target||r.srcElement},getRelatedTarget:function(r){return r.relatedTarget||r.toElement},getOffset:function(r,a){return Ht.getPoint(r).subtract(St.getOffset(a||Ht.getTarget(r)))}};Ht.requestAnimationFrame=new function(){var r=St.getPrefixed(e,"requestAnimationFrame"),a=!1,l=[],u;function g(){var y=l;l=[];for(var P=0,L=y.length;P<L;P++)y[P]();a=r&&l.length,a&&r(g)}return function(y){l.push(y),r?a||(r(g),a=!0):u||(u=setInterval(g,1e3/60))}};var jt=s.extend(n,{_class:"View",initialize:function r(a,l){function u(M){return l[M]||parseInt(l.getAttribute(M),10)}function g(){var M=St.getSize(l);return M.isNaN()||M.isZero()?new U(u("width"),u("height")):M}var y;if(window&&l){this._id=l.getAttribute("id"),this._id==null&&l.setAttribute("id",this._id="paper-view-"+r._id++),Ht.add(l,this._viewEvents);var P="none";if(St.setPrefixed(l.style,{userDrag:P,userSelect:P,touchCallout:P,contentZooming:P,tapHighlightColor:"rgba(0,0,0,0)"}),o.hasAttribute(l,"resize")){var L=this;Ht.add(e,this._windowEvents={resize:function(){L.setViewSize(g())}})}if(y=g(),o.hasAttribute(l,"stats")&&typeof Stats<"u"){this._stats=new Stats;var C=this._stats.domElement,x=C.style,k=St.getOffset(l);x.position="absolute",x.left=k.x+"px",x.top=k.y+"px",i.body.appendChild(C)}}else y=new U(l),l=null;this._project=a,this._scope=a._scope,this._element=l,this._pixelRatio||(this._pixelRatio=e&&e.devicePixelRatio||1),this._setElementSize(y.width,y.height),this._viewSize=y,r._views.push(this),r._viewsById[this._id]=this,(this._matrix=new le)._owner=this,r._focused||(r._focused=this),this._frameItems={},this._frameItemCount=0,this._itemEvents={native:{},virtual:{}},this._autoUpdate=!Be.agent.node,this._needsUpdate=!1},remove:function(){if(!this._project)return!1;jt._focused===this&&(jt._focused=null),jt._views.splice(jt._views.indexOf(this),1),delete jt._viewsById[this._id];var r=this._project;return r._view===this&&(r._view=null),Ht.remove(this._element,this._viewEvents),Ht.remove(e,this._windowEvents),this._element=this._project=null,this.off("frame"),this._animate=!1,this._frameItems={},!0},_events:s.each(ne._itemHandlers.concat(["onResize","onKeyDown","onKeyUp"]),function(r){this[r]={}},{onFrame:{install:function(){this.play()},uninstall:function(){this.pause()}}}),_animate:!1,_time:0,_count:0,getAutoUpdate:function(){return this._autoUpdate},setAutoUpdate:function(r){this._autoUpdate=r,r&&this.requestUpdate()},update:function(){},draw:function(){this.update()},requestUpdate:function(){if(!this._requested){var r=this;Ht.requestAnimationFrame(function(){if(r._requested=!1,r._animate){r.requestUpdate();var a=r._element;(!St.getPrefixed(i,"hidden")||o.getAttribute(a,"keepalive")==="true")&&St.isInView(a)&&r._handleFrame()}r._autoUpdate&&r.update()}),this._requested=!0}},play:function(){this._animate=!0,this.requestUpdate()},pause:function(){this._animate=!1},_handleFrame:function(){Be=this._scope;var r=Date.now()/1e3,a=this._last?r-this._last:0;this._last=r,this.emit("frame",new s({delta:a,time:this._time+=a,count:this._count++})),this._stats&&this._stats.update()},_animateItem:function(r,a){var l=this._frameItems;a?(l[r._id]={item:r,time:0,count:0},++this._frameItemCount===1&&this.on("frame",this._handleFrameItems)):(delete l[r._id],--this._frameItemCount===0&&this.off("frame",this._handleFrameItems))},_handleFrameItems:function(r){for(var a in this._frameItems){var l=this._frameItems[a];l.item.emit("frame",new s(r,{time:l.time+=r.delta,count:l.count++}))}},_changed:function(){this._project._changed(4097),this._bounds=this._decomposed=t},getElement:function(){return this._element},getPixelRatio:function(){return this._pixelRatio},getResolution:function(){return this._pixelRatio*72},getViewSize:function(){var r=this._viewSize;return new m(r.width,r.height,this,"setViewSize")},setViewSize:function(){var r=U.read(arguments),a=r.subtract(this._viewSize);a.isZero()||(this._setElementSize(r.width,r.height),this._viewSize.set(r),this._changed(),this.emit("resize",{size:r,delta:a}),this._autoUpdate&&this.update())},_setElementSize:function(r,a){var l=this._element;l&&(l.width!==r&&(l.width=r),l.height!==a&&(l.height=a))},getBounds:function(){return this._bounds||(this._bounds=this._matrix.inverted()._transformBounds(new Y(new T,this._viewSize))),this._bounds},getSize:function(){return this.getBounds().getSize()},isVisible:function(){return St.isInView(this._element)},isInserted:function(){return St.isInserted(this._element)},getPixelSize:function(r){var a=this._element,l;if(a){var u=a.parentNode,g=i.createElement("div");g.style.fontSize=r,u.appendChild(g),l=parseFloat(St.getStyles(g).fontSize),u.removeChild(g)}else l=parseFloat(l);return l},getTextWidth:function(r,a){return 0}},s.each(["rotate","scale","shear","skew"],function(r){var a=r==="rotate";this[r]=function(){var l=arguments,u=(a?s:T).read(l),g=T.read(l,0,{readNull:!0});return this.transform(new le()[r](u,g||this.getCenter(!0)))}},{_decompose:function(){return this._decomposed||(this._decomposed=this._matrix.decompose())},translate:function(){var r=new le;return this.transform(r.translate.apply(r,arguments))},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(){var r=T.read(arguments);this.translate(this.getCenter().subtract(r))},getZoom:function(){var r=this._decompose().scaling;return(r.x+r.y)/2},setZoom:function(r){this.transform(new le().scale(r/this.getZoom(),this.getCenter()))},getRotation:function(){return this._decompose().rotation},setRotation:function(r){var a=this.getRotation();a!=null&&r!=null&&this.rotate(r-a)},getScaling:function(){var r=this._decompose().scaling;return new z(r.x,r.y,this,"setScaling")},setScaling:function(){var r=this.getScaling(),a=T.read(arguments,0,{clone:!0,readNull:!0});r&&a&&this.scale(a.x/r.x,a.y/r.y)},getMatrix:function(){return this._matrix},setMatrix:function(){var r=this._matrix;r.set.apply(r,arguments)},transform:function(r){this._matrix.append(r)},scrollBy:function(){this.translate(T.read(arguments).negate())}}),{projectToView:function(){return this._matrix._transformPoint(T.read(arguments))},viewToProject:function(){return this._matrix._inverseTransform(T.read(arguments))},getEventPoint:function(r){return this.viewToProject(Ht.getOffset(r,this._element))}},{statics:{_views:[],_viewsById:{},_id:0,create:function(r,a){i&&typeof a=="string"&&(a=i.getElementById(a));var l=e?lt:jt;return new l(r,a)}}},new function(){if(!e)return;var r,a,l=!1,u=!1;function g(ue){var fe=Ht.getTarget(ue);return fe.getAttribute&&jt._viewsById[fe.getAttribute("id")]}function y(){var ue=jt._focused;if(!ue||!ue.isVisible()){for(var fe=0,be=jt._views.length;fe<be;fe++)if((ue=jt._views[fe]).isVisible()){jt._focused=a=ue;break}}}function P(ue,fe,be){ue._handleMouseEvent("mousemove",fe,be)}var L=e.navigator,C,x,k;L.pointerEnabled||L.msPointerEnabled?(C="pointerdown MSPointerDown",x="pointermove MSPointerMove",k="pointerup pointercancel MSPointerUp MSPointerCancel"):(C="touchstart",x="touchmove",k="touchend touchcancel","ontouchstart"in e&&L.userAgent.match(/mobile|tablet|ip(ad|hone|od)|android|silk/i)||(C+=" mousedown",x+=" mousemove",k+=" mouseup"));var M={},E={mouseout:function(ue){var fe=jt._focused,be=Ht.getRelatedTarget(ue);if(fe&&(!be||be.nodeName==="HTML")){var ve=Ht.getOffset(ue,fe._element),Ce=ve.x,Ae=Math.abs,je=Ae(Ce),et=1<<25,it=je-et;ve.x=Ae(it)<je?it*(Ce<0?-1:1):Ce,P(fe,ue,fe.viewToProject(ve))}},scroll:y};M[C]=function(ue){var fe=jt._focused=g(ue);l||(l=!0,fe._handleMouseEvent("mousedown",ue))},E[x]=function(ue){var fe=jt._focused;if(!u){var be=g(ue);be?fe!==be&&(fe&&P(fe,ue),r||(r=fe),fe=jt._focused=a=be):a&&a===fe&&(r&&!r.isInserted()&&(r=null),fe=jt._focused=r,r=null,y())}fe&&P(fe,ue)},E[C]=function(){u=!0},E[k]=function(ue){var fe=jt._focused;fe&&l&&fe._handleMouseEvent("mouseup",ue),u=l=!1},Ht.add(i,E),Ht.add(e,{load:y});var D=!1,B=!1,W={doubleclick:"click",mousedrag:"mousemove"},q=!1,F,V,A,N,G,K,Z,ee;function se(ue,fe,be,ve,Ce,Ae,je){var et=!1,it;function yt(dt,pt){if(dt.responds(pt)){if(it||(it=new Kr(pt,ve,Ce,fe||dt,Ae?Ce.subtract(Ae):null)),dt.emit(pt,it)&&(D=!0,it.prevented&&(B=!0),it.stopped))return et=!0}else{var ut=W[pt];if(ut)return yt(dt,ut)}}for(;ue&&ue!==je&&!yt(ue,be);)ue=ue._parent;return et}function ae(ue,fe,be,ve,Ce,Ae){return ue._project.removeOn(be),B=D=!1,G&&se(G,null,be,ve,Ce,Ae)||fe&&fe!==G&&!fe.isDescendant(G)&&se(fe,null,be==="mousedrag"?"mousemove":be,ve,Ce,Ae,G)||se(ue,G||fe||ue,be,ve,Ce,Ae)}var ge={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}};return{_viewEvents:M,_handleMouseEvent:function(ue,fe,be){var ve=this._itemEvents,Ce=ve.native[ue],Ae=ue==="mousemove",je=this._scope.tool,et=this;function it(gi){return ve.virtual[gi]||et.responds(gi)||je&&je.responds(gi)}Ae&&l&&it("mousedrag")&&(ue="mousedrag"),be||(be=this.getEventPoint(fe));var yt=this.getBounds().contains(be),dt=Ce&&yt&&et._project.hitTest(be,{tolerance:0,fill:!0,stroke:!0}),pt=dt&&dt.item||null,ut=!1,xt={};if(xt[ue.substr(5)]=!0,Ce&&pt!==N&&(N&&se(N,null,"mouseleave",fe,be),pt&&se(pt,null,"mouseenter",fe,be),N=pt),q^yt&&(se(this,null,yt?"mouseenter":"mouseleave",fe,be),ut=!0),(yt||xt.drag)&&!be.equals(V)&&(ae(this,pt,Ae?ue:"mousemove",fe,be,V),ut=!0),q=yt,xt.down&&yt||xt.up&&F){if(ae(this,pt,ue,fe,be,F),xt.down){if(ee=pt===K&&Date.now()-Z<300,A=K=pt,!B&&pt){for(var bt=pt;bt&&!bt.responds("mousedrag");)bt=bt._parent;bt&&(G=pt)}F=be}else xt.up&&(!B&&pt===A&&(Z=Date.now(),ae(this,pt,ee?"doubleclick":"click",fe,be,F),ee=!1),A=G=null);q=!1,ut=!0}V=be,ut&&je&&(D=je._handleMouseEvent(ue,fe,be,xt)||D),fe.cancelable!==!1&&(D&&!xt.move||xt.down&&it("mouseup"))&&fe.preventDefault()},_handleKeyEvent:function(ue,fe,be,ve){var Ce=this._scope,Ae=Ce.tool,je;function et(it){it.responds(ue)&&(Be=Ce,it.emit(ue,je=je||new Ns(ue,fe,be,ve)))}this.isVisible()&&(et(this),Ae&&Ae.responds(ue)&&et(Ae))},_countItemEvent:function(ue,fe){var be=this._itemEvents,ve=be.native,Ce=be.virtual;for(var Ae in ge)ve[Ae]=(ve[Ae]||0)+(ge[Ae][ue]||0)*fe;Ce[ue]=(Ce[ue]||0)+fe},statics:{updateFocus:y,_resetState:function(){l=u=D=q=!1,r=a=F=V=A=N=G=K=Z=ee=null}}}}),lt=jt.extend({_class:"CanvasView",initialize:function(a,l){if(!(l instanceof e.HTMLCanvasElement)){var u=U.read(arguments,1);if(u.isZero())throw new Error("Cannot create CanvasView with the provided argument: "+s.slice(arguments,1));l=re.getCanvas(u)}var g=this._context=l.getContext("2d");if(g.save(),this._pixelRatio=1,!/^off|false$/.test(o.getAttribute(l,"hidpi"))){var y=e.devicePixelRatio||1,P=St.getPrefixed(g,"backingStorePixelRatio")||1;this._pixelRatio=y/P}jt.call(this,a,l),this._needsUpdate=!0},remove:function r(){return this._context.restore(),r.base.call(this)},_setElementSize:function r(a,l){var u=this._pixelRatio;if(r.base.call(this,a*u,l*u),u!==1){var g=this._element,y=this._context;if(!o.hasAttribute(g,"resize")){var P=g.style;P.width=a+"px",P.height=l+"px"}y.restore(),y.save(),y.scale(u,u)}},getContext:function(){return this._context},getPixelSize:function r(a){var l=Be.agent,u;if(l&&l.firefox)u=r.base.call(this,a);else{var g=this._context,y=g.font;g.font=a+" serif",u=parseFloat(g.font),g.font=y}return u},getTextWidth:function(r,a){var l=this._context,u=l.font,g=0;l.font=r;for(var y=0,P=a.length;y<P;y++)g=Math.max(g,l.measureText(a[y]).width);return l.font=u,g},update:function(){if(!this._needsUpdate)return!1;var r=this._project,a=this._context,l=this._viewSize;return a.clearRect(0,0,l.width+1,l.height+1),r&&r.draw(a,this._matrix,this._pixelRatio),this._needsUpdate=!1,!0}}),Rs=s.extend({_class:"Event",initialize:function(a){this.event=a,this.type=a&&a.type},prevented:!1,stopped:!1,preventDefault:function(){this.prevented=!0,this.event.preventDefault()},stopPropagation:function(){this.stopped=!0,this.event.stopPropagation()},stop:function(){this.stopPropagation(),this.preventDefault()},getTimeStamp:function(){return this.event.timeStamp},getModifiers:function(){return ps.modifiers}}),Ns=Rs.extend({_class:"KeyEvent",initialize:function(a,l,u,g){this.type=a,this.event=l,this.key=u,this.character=g},toString:function(){return"{ type: '"+this.type+"', key: '"+this.key+"', character: '"+this.character+"', modifiers: "+this.getModifiers()+" }"}}),ps=new function(){var r={"	":"tab"," ":"space","\b":"backspace","":"delete",Spacebar:"space",Del:"delete",Win:"meta",Esc:"escape"},a={tab:"	",space:" ",enter:"\r"},l={},u={},g,y,P=new s({shift:!1,control:!1,alt:!1,meta:!1,capsLock:!1,space:!1}).inject({option:{get:function(){return this.alt}},command:{get:function(){var x=Be&&Be.agent;return x&&x.mac?this.meta:this.control}}});function L(x){var k=x.key||x.keyIdentifier;return k=/^U\+/.test(k)?String.fromCharCode(parseInt(k.substr(2),16)):/^Arrow[A-Z]/.test(k)?k.substr(5):k==="Unidentified"||k===t?String.fromCharCode(x.keyCode):k,r[k]||(k.length>1?s.hyphenate(k):k.toLowerCase())}function C(x,k,M,E){var D=jt._focused,B;if(l[k]=x,x?u[k]=M:delete u[k],k.length>1&&(B=s.camelize(k))in P){P[B]=x;var W=Be&&Be.agent;if(B==="meta"&&W&&W.mac)if(x)g={};else{for(var q in g)q in u&&C(!1,q,g[q],E);g=null}}else x&&g&&(g[k]=M);D&&D._handleKeyEvent(x?"keydown":"keyup",E,k,M)}return Ht.add(i,{keydown:function(x){var k=L(x),M=Be&&Be.agent;k.length>1||M&&M.chrome&&(x.altKey||M.mac&&x.metaKey||!M.mac&&x.ctrlKey)?C(!0,k,a[k]||(k.length>1?"":k),x):y=k},keypress:function(x){if(y){var k=L(x),M=x.charCode,E=M>=32?String.fromCharCode(M):k.length>1?"":k;k!==y&&(k=E.toLowerCase()),C(!0,k,E,x),y=null}},keyup:function(x){var k=L(x);k in u&&C(!1,k,u[k],x)}}),Ht.add(e,{blur:function(x){for(var k in u)C(!1,k,u[k],x)}}),{modifiers:P,isDown:function(x){return!!l[x]}}},Kr=Rs.extend({_class:"MouseEvent",initialize:function(a,l,u,g,y){this.type=a,this.event=l,this.point=u,this.target=g,this.delta=y},toString:function(){return"{ type: '"+this.type+"', point: "+this.point+", target: "+this.target+(this.delta?", delta: "+this.delta:"")+", modifiers: "+this.getModifiers()+" }"}}),b=Rs.extend({_class:"ToolEvent",_item:null,initialize:function(a,l,u){this.tool=a,this.type=l,this.event=u},_choosePoint:function(r,a){return r||(a?a.clone():null)},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(r){this._point=r},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(r){this._lastPoint=r},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(r){this._downPoint=r},getMiddlePoint:function(){return!this._middlePoint&&this.tool._lastPoint?this.tool._point.add(this.tool._lastPoint).divide(2):this._middlePoint},setMiddlePoint:function(r){this._middlePoint=r},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(r){this._delta=r},getCount:function(){return this.tool[/^mouse(down|up)$/.test(this.type)?"_downCount":"_moveCount"]},setCount:function(r){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=r},getItem:function(){if(!this._item){var r=this.tool._scope.project.hitTest(this.getPoint());if(r){for(var a=r.item,l=a._parent;/^(Group|CompoundPath)$/.test(l._class);)a=l,l=l._parent;this._item=a}}return this._item},setItem:function(r){this._item=r},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}});c.extend({_class:"Tool",_list:"tools",_reference:"tool",_events:["onMouseDown","onMouseUp","onMouseDrag","onMouseMove","onActivate","onDeactivate","onEditOptions","onKeyDown","onKeyUp"],initialize:function(a){c.call(this),this._moveCount=-1,this._downCount=-1,this.set(a)},getMinDistance:function(){return this._minDistance},setMinDistance:function(r){this._minDistance=r,r!=null&&this._maxDistance!=null&&r>this._maxDistance&&(this._maxDistance=r)},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(r){this._maxDistance=r,this._minDistance!=null&&r!=null&&r<this._minDistance&&(this._minDistance=r)},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(r){this._minDistance=this._maxDistance=r},_handleMouseEvent:function(r,a,l,u){Be=this._scope,u.drag&&!this.responds(r)&&(r="mousemove");var g=u.move||u.drag,y=this.responds(r),P=this.minDistance,L=this.maxDistance,C=!1,x=this;function k(E,D){var B=l,W=g?x._point:x._downPoint||B;if(g){if(x._moveCount>=0&&B.equals(W))return!1;if(W&&(E!=null||D!=null)){var q=B.subtract(W),F=q.getLength();if(F<(E||0))return!1;D&&(B=W.add(q.normalize(Math.min(F,D))))}x._moveCount++}return x._point=B,x._lastPoint=W||B,u.down&&(x._moveCount=-1,x._downPoint=B,x._downCount++),!0}function M(){y&&(C=x.emit(r,new b(x,r,a))||C)}if(u.down)k(),M();else if(u.up)k(null,L),M();else if(y)for(;k(P,L);)M();return C}});var J=s.extend(n,{_class:"Tween",statics:{easings:new s({linear:function(r){return r},easeInQuad:function(r){return r*r},easeOutQuad:function(r){return r*(2-r)},easeInOutQuad:function(r){return r<.5?2*r*r:-1+2*(2-r)*r},easeInCubic:function(r){return r*r*r},easeOutCubic:function(r){return--r*r*r+1},easeInOutCubic:function(r){return r<.5?4*r*r*r:(r-1)*(2*r-2)*(2*r-2)+1},easeInQuart:function(r){return r*r*r*r},easeOutQuart:function(r){return 1- --r*r*r*r},easeInOutQuart:function(r){return r<.5?8*r*r*r*r:1-8*--r*r*r*r},easeInQuint:function(r){return r*r*r*r*r},easeOutQuint:function(r){return 1+--r*r*r*r*r},easeInOutQuint:function(r){return r<.5?16*r*r*r*r*r:1+16*--r*r*r*r*r}})},initialize:function r(a,l,u,g,y,P){this.object=a;var L=typeof y,C=L==="function";this.type=C?L:L==="string"?y:"linear",this.easing=C?y:r.easings[this.type],this.duration=g,this.running=!1,this._then=null,this._startTime=null;var x=l||u;this._keys=x?Object.keys(x):[],this._parsedKeys=this._parseKeys(this._keys),this._from=x&&this._getState(l),this._to=x&&this._getState(u),P!==!1&&this.start()},then:function(r){return this._then=r,this},start:function(){return this._startTime=null,this.running=!0,this},stop:function(){return this.running=!1,this},update:function(r){if(this.running){r>=1&&(r=1,this.running=!1);for(var a=this.easing(r),l=this._keys,u=function(k){return typeof k=="function"?k(a,r):k},g=0,y=l&&l.length;g<y;g++){var P=l[g],L=u(this._from[P]),C=u(this._to[P]),x=L&&C&&L.__add&&C.__add?C.__subtract(L).__multiply(a).__add(L):(C-L)*a+L;this._setProperty(this._parsedKeys[P],x)}this.responds("update")&&this.emit("update",new s({progress:r,factor:a})),!this.running&&this._then&&this._then(this.object)}return this},_events:{onUpdate:{}},_handleFrame:function(r){var a=this._startTime,l=a?(r-a)/this.duration:0;a||(this._startTime=r),this.update(l)},_getState:function(r){for(var a=this._keys,l={},u=0,g=a.length;u<g;u++){var y=a[u],P=this._parsedKeys[y],L=this._getProperty(P),C;if(r){var x=this._resolveValue(L,r[y]);this._setProperty(P,x),C=this._getProperty(P),C=C&&C.clone?C.clone():C,this._setProperty(P,L)}else C=L&&L.clone?L.clone():L;l[y]=C}return l},_resolveValue:function(r,a){if(a){if(Array.isArray(a)&&a.length===2){var l=a[0];return l&&l.match&&l.match(/^[+\-\*\/]=/)?this._calculate(r,l[0],a[1]):a}else if(typeof a=="string"){var u=a.match(/^[+\-*/]=(.*)/);if(u){var g=JSON.parse(u[1].replace(/(['"])?([a-zA-Z0-9_]+)(['"])?:/g,'"$2": '));return this._calculate(r,a[0],g)}}}return a},_calculate:function(r,a,l){return Be.PaperScript.calculateBinary(r,a,l)},_parseKeys:function(r){for(var a={},l=0,u=r.length;l<u;l++){var g=r[l],y=g.replace(/\.([^.]*)/g,"/$1").replace(/\[['"]?([^'"\]]*)['"]?\]/g,"/$1");a[g]=y.split("/")}return a},_getProperty:function(r,a){for(var l=this.object,u=0,g=r.length-(a||0);u<g&&l;u++)l=l[r[u]];return l},_setProperty:function(r,a){var l=this._getProperty(r,1);l&&(l[r[r.length-1]]=a)}}),ie={request:function(r){var a=new e.XMLHttpRequest;return a.open((r.method||"get").toUpperCase(),r.url,s.pick(r.async,!0)),r.mimeType&&a.overrideMimeType(r.mimeType),a.onload=function(){var l=a.status;l===0||l===200?r.onLoad&&r.onLoad.call(a,a.responseText):a.onerror()},a.onerror=function(){var l=a.status,u='Could not load "'+r.url+'" (Status: '+l+")";if(r.onError)r.onError(u,l);else throw new Error(u)},a.send(null)}},re=s.exports.CanvasProvider={canvases:[],getCanvas:function(r,a,l){if(!e)return null;var u,g=!0;typeof r=="object"&&(a=r.height,r=r.width),this.canvases.length?u=this.canvases.pop():(u=i.createElement("canvas"),g=!1);var y=u.getContext("2d",l||{});if(!y)throw new Error("Canvas "+u+" is unable to provide a 2D context.");return u.width===r&&u.height===a?g&&y.clearRect(0,0,r+1,a+1):(u.width=r,u.height=a),y.save(),u},getContext:function(r,a,l){var u=this.getCanvas(r,a,l);return u?u.getContext("2d",l||{}):null},release:function(r){var a=r&&r.canvas?r.canvas:r;a&&a.getContext&&(a.getContext("2d").restore(),this.canvases.push(a))}},ye=new function(){var r=Math.min,a=Math.max,l=Math.abs,u,g,y,P,L,C,x,k,M,E,D;function B(G,K,Z){return .2989*G+.587*K+.114*Z}function W(G,K,Z,ae){var se=ae-B(G,K,Z);M=G+se,E=K+se,D=Z+se;var ae=B(M,E,D),ge=r(M,E,D),ue=a(M,E,D);if(ge<0){var fe=ae-ge;M=ae+(M-ae)*ae/fe,E=ae+(E-ae)*ae/fe,D=ae+(D-ae)*ae/fe}if(ue>255){var be=255-ae,ve=ue-ae;M=ae+(M-ae)*be/ve,E=ae+(E-ae)*be/ve,D=ae+(D-ae)*be/ve}}function q(G,K,Z){return a(G,K,Z)-r(G,K,Z)}function F(G,K,Z,ee){var se=[G,K,Z],ae=a(G,K,Z),ge=r(G,K,Z),ue;ge=ge===G?0:ge===K?1:2,ae=ae===G?0:ae===K?1:2,ue=r(ge,ae)===0?a(ge,ae)===1?2:1:0,se[ae]>se[ge]?(se[ue]=(se[ue]-se[ge])*ee/(se[ae]-se[ge]),se[ae]=ee):se[ue]=se[ae]=0,se[ge]=0,M=se[0],E=se[1],D=se[2]}var V={multiply:function(){M=L*u/255,E=C*g/255,D=x*y/255},screen:function(){M=L+u-L*u/255,E=C+g-C*g/255,D=x+y-x*y/255},overlay:function(){M=L<128?2*L*u/255:255-2*(255-L)*(255-u)/255,E=C<128?2*C*g/255:255-2*(255-C)*(255-g)/255,D=x<128?2*x*y/255:255-2*(255-x)*(255-y)/255},"soft-light":function(){var G=u*L/255;M=G+L*(255-(255-L)*(255-u)/255-G)/255,G=g*C/255,E=G+C*(255-(255-C)*(255-g)/255-G)/255,G=y*x/255,D=G+x*(255-(255-x)*(255-y)/255-G)/255},"hard-light":function(){M=u<128?2*u*L/255:255-2*(255-u)*(255-L)/255,E=g<128?2*g*C/255:255-2*(255-g)*(255-C)/255,D=y<128?2*y*x/255:255-2*(255-y)*(255-x)/255},"color-dodge":function(){M=L===0?0:u===255?255:r(255,255*L/(255-u)),E=C===0?0:g===255?255:r(255,255*C/(255-g)),D=x===0?0:y===255?255:r(255,255*x/(255-y))},"color-burn":function(){M=L===255?255:u===0?0:a(0,255-(255-L)*255/u),E=C===255?255:g===0?0:a(0,255-(255-C)*255/g),D=x===255?255:y===0?0:a(0,255-(255-x)*255/y)},darken:function(){M=L<u?L:u,E=C<g?C:g,D=x<y?x:y},lighten:function(){M=L>u?L:u,E=C>g?C:g,D=x>y?x:y},difference:function(){M=L-u,M<0&&(M=-M),E=C-g,E<0&&(E=-E),D=x-y,D<0&&(D=-D)},exclusion:function(){M=L+u*(255-L-L)/255,E=C+g*(255-C-C)/255,D=x+y*(255-x-x)/255},hue:function(){F(u,g,y,q(L,C,x)),W(M,E,D,B(L,C,x))},saturation:function(){F(L,C,x,q(u,g,y)),W(M,E,D,B(L,C,x))},luminosity:function(){W(L,C,x,B(u,g,y))},color:function(){W(u,g,y,B(L,C,x))},add:function(){M=r(L+u,255),E=r(C+g,255),D=r(x+y,255)},subtract:function(){M=a(L-u,0),E=a(C-g,0),D=a(x-y,0)},average:function(){M=(L+u)/2,E=(C+g)/2,D=(x+y)/2},negation:function(){M=255-l(255-u-L),E=255-l(255-g-C),D=255-l(255-y-x)}},A=this.nativeModes=s.each(["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","lighter","darker","copy","xor"],function(G){this[G]=!0},{}),N=re.getContext(1,1,{willReadFrequently:!0});N&&(s.each(V,function(G,K){var Z=K==="darken",ee=!1;N.save();try{N.fillStyle=Z?"#300":"#a00",N.fillRect(0,0,1,1),N.globalCompositeOperation=K,N.globalCompositeOperation===K&&(N.fillStyle=Z?"#a00":"#300",N.fillRect(0,0,1,1),ee=N.getImageData(0,0,1,1).data[0]!==Z?170:51)}catch{}N.restore(),A[K]=ee}),re.release(N)),this.process=function(G,K,Z,ee,se){var ae=K.canvas,ge=G==="normal";if(ge||A[G])Z.save(),Z.setTransform(1,0,0,1,0,0),Z.globalAlpha=ee,ge||(Z.globalCompositeOperation=G),Z.drawImage(ae,se.x,se.y),Z.restore();else{var ue=V[G];if(!ue)return;for(var fe=Z.getImageData(se.x,se.y,ae.width,ae.height),be=fe.data,ve=K.getImageData(0,0,ae.width,ae.height).data,Ce=0,Ae=be.length;Ce<Ae;Ce+=4){u=ve[Ce],L=be[Ce],g=ve[Ce+1],C=be[Ce+1],y=ve[Ce+2],x=be[Ce+2],P=ve[Ce+3],k=be[Ce+3],ue();var je=P*ee/255,et=1-je;be[Ce]=je*M+et*L,be[Ce+1]=je*E+et*C,be[Ce+2]=je*D+et*x,be[Ce+3]=P*ee+et*k}Z.putImageData(fe,se.x,se.y)}}},Xe=new function(){var r="http://www.w3.org/2000/svg",a="http://www.w3.org/2000/xmlns",l="http://www.w3.org/1999/xlink",u={href:l,xlink:a,xmlns:a+"/","xmlns:xlink":a+"/"};function g(L,C,x){return P(i.createElementNS(r,L),C,x)}function y(L,C){var x=u[C],k=x?L.getAttributeNS(x,C):L.getAttribute(C);return k==="null"?null:k}function P(L,C,x){for(var k in C){var M=C[k],E=u[k];typeof M=="number"&&x&&(M=x.number(M)),E?L.setAttributeNS(E,k,M):L.setAttribute(k,M)}return L}return{svg:r,xmlns:a,xlink:l,create:g,get:y,set:P}},Ne=s.each({fillColor:["fill","color"],fillRule:["fill-rule","string"],strokeColor:["stroke","color"],strokeWidth:["stroke-width","number"],strokeCap:["stroke-linecap","string"],strokeJoin:["stroke-linejoin","string"],strokeScaling:["vector-effect","lookup",{true:"none",false:"non-scaling-stroke"},function(r,a){return!a&&(r instanceof We||r instanceof we||r instanceof ot)}],miterLimit:["stroke-miterlimit","number"],dashArray:["stroke-dasharray","array"],dashOffset:["stroke-dashoffset","number"],fontFamily:["font-family","string"],fontWeight:["font-weight","string"],fontSize:["font-size","number"],justification:["text-anchor","lookup",{left:"start",center:"middle",right:"end"}],opacity:["opacity","number"],blendMode:["mix-blend-mode","style"]},function(r,a){var l=s.capitalize(a),u=r[2];this[a]={type:r[1],property:a,attribute:r[0],toSVG:u,fromSVG:u&&s.each(u,function(g,y){this[g]=y},{}),exportFilter:r[3],get:"get"+l,set:"set"+l}},{});new function(){var r;function a(V,A,N){var G=new s,K=V.getTranslation();if(A){var Z;V.isInvertible()?(V=V._shiftless(),Z=V._inverseTransform(K),K=null):Z=new T,G[N?"cx":"x"]=Z.x,G[N?"cy":"y"]=Z.y}if(!V.isIdentity()){var ee=V.decompose();if(ee){var se=[],ae=ee.rotation,ge=ee.scaling,ue=ee.skewing;K&&!K.isZero()&&se.push("translate("+r.point(K)+")"),ae&&se.push("rotate("+r.number(ae)+")"),(!w.isZero(ge.x-1)||!w.isZero(ge.y-1))&&se.push("scale("+r.point(ge)+")"),ue.x&&se.push("skewX("+r.number(ue.x)+")"),ue.y&&se.push("skewY("+r.number(ue.y)+")"),G.transform=se.join(" ")}else G.transform="matrix("+V.getValues().join(",")+")"}return G}function l(V,A){for(var N=a(V._matrix),G=V._children,K=Xe.create("g",N,r),Z=0,ee=G.length;Z<ee;Z++){var se=G[Z],ae=q(se,A);if(ae)if(se.isClipMask()){var ge=Xe.create("clipPath");ge.appendChild(ae),B(se,ge,"clip"),Xe.set(K,{"clip-path":"url(#"+ge.id+")"})}else K.appendChild(ae)}return K}function u(V,A){var N=a(V._matrix,!0),G=V.getSize(),K=V.getImage();return N.x-=G.width/2,N.y-=G.height/2,N.width=G.width,N.height=G.height,N.href=A.embedImages==!1&&K&&K.src||V.toDataURL(),Xe.create("image",N,r)}function g(V,A){var N=A.matchShapes;if(N){var G=V.toShape(!1);if(G)return y(G)}var K=V._segments,Z=K.length,ee,se=a(V._matrix);if(N&&Z>=2&&!V.hasHandles())if(Z>2){ee=V._closed?"polygon":"polyline";for(var ae=[],ge=0;ge<Z;ge++)ae.push(r.point(K[ge]._point));se.points=ae.join(" ")}else{ee="line";var ue=K[0]._point,fe=K[1]._point;se.set({x1:ue.x,y1:ue.y,x2:fe.x,y2:fe.y})}else ee="path",se.d=V.getPathData(null,A.precision);return Xe.create(ee,se,r)}function y(V){var A=V._type,N=V._radius,G=a(V._matrix,!0,A!=="rectangle");if(A==="rectangle"){A="rect";var K=V._size,Z=K.width,ee=K.height;G.x-=Z/2,G.y-=ee/2,G.width=Z,G.height=ee,N.isZero()&&(N=null)}return N&&(A==="circle"?G.r=N:(G.rx=N.width,G.ry=N.height)),Xe.create(A,G,r)}function P(V,A){var N=a(V._matrix),G=V.getPathData(null,A.precision);return G&&(N.d=G),Xe.create("path",N,r)}function L(V,A){var N=a(V._matrix,!0),G=V._definition,K=D(G,"symbol"),Z=G._item,ee=Z.getStrokeBounds();return K||(K=Xe.create("symbol",{viewBox:r.rectangle(ee)}),K.appendChild(q(Z,A)),B(G,K,"symbol")),N.href="#"+K.id,N.x+=ee.x,N.y+=ee.y,N.width=ee.width,N.height=ee.height,N.overflow="visible",Xe.create("use",N,r)}function C(V){var A=D(V,"color");if(!A){var N=V.getGradient(),G=N._radial,K=V.getOrigin(),Z=V.getDestination(),ee;if(G){ee={cx:K.x,cy:K.y,r:K.getDistance(Z)};var se=V.getHighlight();se&&(ee.fx=se.x,ee.fy=se.y)}else ee={x1:K.x,y1:K.y,x2:Z.x,y2:Z.y};ee.gradientUnits="userSpaceOnUse",A=Xe.create((G?"radial":"linear")+"Gradient",ee,r);for(var ae=N._stops,ge=0,ue=ae.length;ge<ue;ge++){var fe=ae[ge],be=fe._color,ve=be.getAlpha(),Ce=fe._offset;ee={offset:Ce??ge/(ue-1)},be&&(ee["stop-color"]=be.toCSS(!0)),ve<1&&(ee["stop-opacity"]=ve),A.appendChild(Xe.create("stop",ee,r))}B(V,A,"color")}return"url(#"+A.id+")"}function x(V){var A=Xe.create("text",a(V._matrix,!0),r);return A.textContent=V._content,A}var k={Group:l,Layer:l,Raster:u,Path:g,Shape:y,CompoundPath:P,SymbolItem:L,PointText:x};function M(V,A,N){var G={},K=!N&&V.getParent(),Z=[];return V._name!=null&&(G.id=V._name),s.each(Ne,function(ee){var se=ee.get,ae=ee.type,ge=V[se]();if(ee.exportFilter?ee.exportFilter(V,ge):!K||!s.equals(K[se](),ge)){if(ae==="color"&&ge!=null){var ue=ge.getAlpha();ue<1&&(G[ee.attribute+"-opacity"]=ue)}ae==="style"?Z.push(ee.attribute+": "+ge):G[ee.attribute]=ge==null?"none":ae==="color"?ge.gradient?C(ge):ge.toCSS(!0):ae==="array"?ge.join(","):ae==="lookup"?ee.toSVG[ge]:ge}}),Z.length&&(G.style=Z.join(";")),G.opacity===1&&delete G.opacity,V._visible||(G.visibility="hidden"),Xe.set(A,G,r)}var E;function D(V,A){return E||(E={ids:{},svgs:{}}),V&&E.svgs[A+"-"+(V._id||V.__id||(V.__id=O.get("svg")))]}function B(V,A,N){E||D();var G=E.ids[N]=(E.ids[N]||0)+1;A.id=N+"-"+G,E.svgs[N+"-"+(V._id||V.__id)]=A}function W(V,A){var N=V,G=null;if(E){N=V.nodeName.toLowerCase()==="svg"&&V;for(var K in E.svgs)G||(N||(N=Xe.create("svg"),N.appendChild(V)),G=N.insertBefore(Xe.create("defs"),N.firstChild)),G.appendChild(E.svgs[K]);E=null}return A.asString?new e.XMLSerializer().serializeToString(N):N}function q(V,A,N){var G=k[V._class],K=G&&G(V,A);if(K){var Z=A.onExport;Z&&(K=Z(V,K,A)||K);var ee=JSON.stringify(V._data);ee&&ee!=="{}"&&ee!=="null"&&K.setAttribute("data-paper-data",ee)}return K&&M(V,K,N)}function F(V){return V||(V={}),r=new f(V.precision),V}ne.inject({exportSVG:function(V){return V=F(V),W(q(this,V,!0),V)}}),ce.inject({exportSVG:function(V){V=F(V);var A=this._children,N=this.getView(),G=s.pick(V.bounds,"view"),K=V.matrix||G==="view"&&N._matrix,Z=K&&le.read([K]),ee=G==="view"?new Y([0,0],N.getViewSize()):G==="content"?ne._getBounds(A,Z,{stroke:!0}).rect:Y.read([G],0,{readNull:!0}),se={version:"1.1",xmlns:Xe.svg,"xmlns:xlink":Xe.xlink};ee&&(se.width=ee.width,se.height=ee.height,(ee.x||ee.x===0||ee.y||ee.y===0)&&(se.viewBox=r.rectangle(ee)));var ae=Xe.create("svg",se,r),ge=ae;Z&&!Z.isIdentity()&&(ge=ae.appendChild(Xe.create("g",a(Z),r)));for(var ue=0,fe=A.length;ue<fe;ue++)ge.appendChild(q(A[ue],V,!0));return W(ae,V)}})},new function(){var r={},a;function l(A,N,G,K,Z,ee){var se=Xe.get(A,N)||ee,ae=se==null?K?null:G?"":0:G?se:parseFloat(se);return/%\s*$/.test(se)?ae/100*(Z?1:a[/x|^width/.test(N)?"width":"height"]):ae}function u(A,N,G,K,Z,ee,se){return N=l(A,N||"x",!1,K,Z,ee),G=l(A,G||"y",!1,K,Z,se),K&&(N==null||G==null)?null:new T(N,G)}function g(A,N,G,K,Z){return N=l(A,N||"width",!1,K,Z),G=l(A,G||"height",!1,K,Z),K&&(N==null||G==null)?null:new U(N,G)}function y(A,N,G){return A==="none"?null:N==="number"?parseFloat(A):N==="array"?A?A.split(/[\s,]+/g).map(parseFloat):[]:N==="color"?q(A)||A:N==="lookup"?G[A]:A}function P(A,N,G,K){var Z=A.childNodes,ee=N==="clippath",se=N==="defs",ae=new me,ge=ae._project,ue=ge._currentStyle,fe=[];if(!ee&&!se&&(ae=W(ae,A,K),ge._currentStyle=ae._style.clone()),K)for(var be=A.querySelectorAll("defs"),ve=0,Ce=be.length;ve<Ce;ve++)F(be[ve],G,!1);for(var ve=0,Ce=Z.length;ve<Ce;ve++){var Ae=Z[ve],je;Ae.nodeType===1&&!/^defs$/i.test(Ae.nodeName)&&(je=F(Ae,G,!1))&&!(je instanceof ze)&&fe.push(je)}return ae.addChildren(fe),ee&&(ae=W(ae.reduce(),A,K)),ge._currentStyle=ue,(ee||se)&&(ae.remove(),ae=null),ae}function L(A,N){for(var G=A.getAttribute("points").match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g),K=[],Z=0,ee=G.length;Z<ee;Z+=2)K.push(new T(parseFloat(G[Z]),parseFloat(G[Z+1])));var se=new Ve(K);return N==="polygon"&&se.closePath(),se}function C(A){return We.create(A.getAttribute("d"))}function x(A,N){var G=(l(A,"href",!0)||"").substring(1),K=N==="radialgradient",Z;if(G)Z=r[G].getGradient(),Z._radial^K&&(Z=Z.clone(),Z._radial=K);else{for(var ee=A.childNodes,se=[],ae=0,ge=ee.length;ae<ge;ae++){var ue=ee[ae];ue.nodeType===1&&se.push(W(new hi,ue))}Z=new Vt(se,K)}var fe,be,ve,Ce=l(A,"gradientUnits",!0)!=="userSpaceOnUse";K?(fe=u(A,"cx","cy",!1,Ce,"50%","50%"),be=fe.add(l(A,"r",!1,!1,Ce,"50%"),0),ve=u(A,"fx","fy",!0,Ce)):(fe=u(A,"x1","y1",!1,Ce,"0%","0%"),be=u(A,"x2","y2",!1,Ce,"100%","0%"));var Ae=W(new Lt(Z,fe,be,ve),A);return Ae._scaleToBounds=Ce,null}var k={"#document":function(A,N,G,K){for(var Z=A.childNodes,ee=0,se=Z.length;ee<se;ee++){var ae=Z[ee];if(ae.nodeType===1)return F(ae,G,K)}},g:P,svg:P,clippath:P,polygon:L,polyline:L,path:C,lineargradient:x,radialgradient:x,image:function(A){var N=new He(l(A,"href",!0));return N.on("load",function(){var G=g(A);this.setSize(G);var K=u(A).add(G.divide(2));this._matrix.append(new le().translate(K))}),N},symbol:function(A,N,G,K){return new ze(P(A,N,G,K),!0)},defs:P,use:function(A){var N=(l(A,"href",!0)||"").substring(1),G=r[N],K=u(A);return G?G instanceof ze?G.place(K):G.clone().translate(K):null},circle:function(A){return new we.Circle(u(A,"cx","cy"),l(A,"r"))},ellipse:function(A){return new we.Ellipse({center:u(A,"cx","cy"),radius:g(A,"rx","ry")})},rect:function(A){return new we.Rectangle(new Y(u(A),g(A)),g(A,"rx","ry"))},line:function(A){return new Ve.Line(u(A,"x1","y1"),u(A,"x2","y2"))},text:function(A){var N=new gt(u(A).add(u(A,"dx","dy")));return N.setContent(A.textContent.trim()||""),N},switch:P};function M(A,N,G,K){if(A.transform){for(var Z=(K.getAttribute(G)||"").split(/\)\s*/g),ee=new le,se=0,ae=Z.length;se<ae;se++){var ge=Z[se];if(!ge)break;for(var ue=ge.split(/\(\s*/),fe=ue[0],be=ue[1].split(/[\s,]+/g),ve=0,Ce=be.length;ve<Ce;ve++)be[ve]=parseFloat(be[ve]);switch(fe){case"matrix":ee.append(new le(be[0],be[1],be[2],be[3],be[4],be[5]));break;case"rotate":ee.rotate(be[0],be[1]||0,be[2]||0);break;case"translate":ee.translate(be[0],be[1]||0);break;case"scale":ee.scale(be);break;case"skewX":ee.skew(be[0],0);break;case"skewY":ee.skew(0,be[0]);break}}A.transform(ee)}}function E(A,N,G){var K=G==="fill-opacity"?"getFillColor":"getStrokeColor",Z=A[K]&&A[K]();Z&&Z.setAlpha(parseFloat(N))}var D=s.set(s.each(Ne,function(A){this[A.attribute]=function(N,G){if(N[A.set]&&(N[A.set](y(G,A.type,A.fromSVG)),A.type==="color")){var K=N[A.get]();if(K&&K._scaleToBounds){var Z=N.getBounds();K.transform(new le().translate(Z.getPoint()).scale(Z.getSize()))}}}},{}),{id:function(A,N){r[N]=A,A.setName&&A.setName(N)},"clip-path":function(A,N){var G=q(N);if(G)if(G=G.clone(),G.setClipMask(!0),A instanceof me)A.insertChild(0,G);else return new me(G,A)},gradientTransform:M,transform:M,"fill-opacity":E,"stroke-opacity":E,visibility:function(A,N){A.setVisible&&A.setVisible(N==="visible")},display:function(A,N){A.setVisible&&A.setVisible(N!==null)},"stop-color":function(A,N){A.setColor&&A.setColor(N)},"stop-opacity":function(A,N){A._color&&A._color.setAlpha(parseFloat(N))},offset:function(A,N){if(A.setOffset){var G=N.match(/(.*)%$/);A.setOffset(G?G[1]/100:parseFloat(N))}},viewBox:function(A,N,G,K,Z){var ee=new Y(y(N,"array")),se=g(K,null,null,!0),ae,ge;if(A instanceof me){var ue=se?se.divide(ee.getSize()):1,ge=new le().scale(ue).translate(ee.getPoint().negate());ae=A}else A instanceof ze&&(se&&ee.setSize(se),ae=A._item);if(ae){if(B(K,"overflow",Z)!=="visible"){var fe=new we.Rectangle(ee);fe.setClipMask(!0),ae.addChild(fe)}ge&&ae.transform(ge)}}});function B(A,N,G){var K=A.attributes[N],Z=K&&K.value;if(!Z&&A.style){var ee=s.camelize(N);Z=A.style[ee],!Z&&G.node[ee]!==G.parent[ee]&&(Z=G.node[ee])}return Z?Z==="none"?null:Z:t}function W(A,N,G){var K=N.parentNode,Z={node:St.getStyles(N)||{},parent:!G&&!/^defs$/i.test(K.tagName)&&St.getStyles(K)||{}};return s.each(D,function(ee,se){var ae=B(N,se,Z);A=ae!==t&&ee(A,ae,se,N,Z)||A}),A}function q(A){var N=A&&A.match(/\((?:["'#]*)([^"')]+)/),G=N&&N[1],K=G&&r[window?G.replace(e.location.href.split("#")[0]+"#",""):G];return K&&K._scaleToBounds&&(K=K.clone(),K._scaleToBounds=!0),K}function F(A,N,G){var K=A.nodeName.toLowerCase(),Z=K!=="#document",ee=i.body,se,ae,ge;G&&Z&&(a=Be.getView().getSize(),a=g(A,null,null,!0)||a,se=Xe.create("svg",{style:"stroke-width: 1px; stroke-miterlimit: 10"}),ae=A.parentNode,ge=A.nextSibling,se.appendChild(A),ee.appendChild(se));var ue=Be.settings,fe=ue.applyMatrix,be=ue.insertItems;ue.applyMatrix=!1,ue.insertItems=!1;var ve=k[K],Ce=ve&&ve(A,K,N,G)||null;if(ue.insertItems=be,ue.applyMatrix=fe,Ce){Z&&!(Ce instanceof me)&&(Ce=W(Ce,A,G));var Ae=N.onImport,je=Z&&A.getAttribute("data-paper-data");Ae&&(Ce=Ae(A,Ce,N)||Ce),N.expandShapes&&Ce instanceof we&&(Ce.remove(),Ce=Ce.toPath()),je&&(Ce._data=JSON.parse(je))}return se&&(ee.removeChild(se),ae&&(ge?ae.insertBefore(A,ge):ae.appendChild(A))),G&&(r={},Ce&&s.pick(N.applyMatrix,fe)&&Ce.matrix.apply(!0,!0)),Ce}function V(A,N,G){if(!A)return null;N=typeof N=="function"?{onLoad:N}:N||{};var K=Be,Z=null;function ee(ue){try{var fe=typeof ue=="object"?ue:new e.DOMParser().parseFromString(ue.trim(),"image/svg+xml");if(!fe.nodeName)throw fe=null,new Error("Unsupported SVG source: "+A);Be=K,Z=F(fe,N,!0),(!N||N.insert!==!1)&&G._insertItem(t,Z);var be=N.onLoad;be&&be(Z,ue)}catch(ve){se(ve)}}function se(ue,fe){var be=N.onError;if(be)be(ue,fe);else throw new Error(ue)}if(typeof A=="string"&&!/^[\s\S]*</.test(A)){var ae=i.getElementById(A);ae?ee(ae):ie.request({url:A,async:!0,onLoad:ee,onError:se})}else if(typeof File<"u"&&A instanceof File){var ge=new FileReader;return ge.onload=function(){ee(ge.result)},ge.onerror=function(){se(ge.error)},ge.readAsText(A)}else ee(A);return Z}ne.inject({importSVG:function(A,N){return V(A,N,this)}}),ce.inject({importSVG:function(A,N){return this.activate(),V(A,N,this)}})};var Be=new(o.inject(s.exports,{Base:s,Numerical:w,Key:ps,DomEvent:Ht,DomElement:St,document:i,window,Symbol:ze,PlacedSymbol:Me}));return Be.agent.node,typeof t=="function"&&t.amd?t("paper",Be):h&&(h.exports=Be),Be}).call(self,typeof self=="object"?self:null)})(f_);var m_={exports:{}};(function(h){(function(e,t){typeof self.define=="function"&&self.define.amd?self.define([],t):h.exports?self.QueryStringMachine=t():e.QueryStringMachine=t()})(self,()=>{const e=",",t=()=>{try{return localStorage.getItem("phetTeamMember")==="true"}catch{return!1}},i=s=>s.length===0||s.indexOf("?")===0;return function(){const s=(ce,ne,me,Fe,we)=>{if(!ce)if(Fe.public)if(n.addWarning(ne,me,we),Fe.hasOwnProperty("defaultValue"))me=Fe.defaultValue;else{const He=xe[Fe.type];le(He.hasOwnProperty("defaultValue"),"Type must have a default value if the provided schema does not have one."),me=He.defaultValue}else le(ce,we);return me},n={warnings:[],get:function(ce,ne){return this.getForString(ce,ne,self.location.search)},getAll:function(ce){return this.getAllForString(ce,self.location.search)},getForString:function(ce,ne,me){if(!i(me))throw new Error(`Query strings should be either the empty string or start with a "?": ${me}`);const Fe=ne.private&&!t()?[]:o(ce,me);c(ce,ne);let we=w(ce,ne,Fe);ne.hasOwnProperty("validValues")?we=s(j(we,ne.validValues),ce,we,ne,`Invalid value supplied for key "${ce}": ${we} is not a member of valid values: ${ne.validValues.join(", ")}`):ne.hasOwnProperty("isValidValue")&&(we=s(ne.isValidValue(we),ce,we,ne,`Invalid value supplied for key "${ce}": ${we}`));let He=xe[ne.type].isValidValue(we);if(ne.type==="array"&&Array.isArray(we)){let Me=!0;for(let ze=0;ze<we.length;ze++){const Je=we[ze];if(!xe[ne.elementSchema.type].isValidValue(Je)){Me=!1;break}if(ne.elementSchema.hasOwnProperty("isValidValue")&&!ne.elementSchema.isValidValue(Je)){Me=!1;break}if(ne.elementSchema.hasOwnProperty("validValues")&&!j(Je,ne.elementSchema.validValues)){Me=!1;break}}He=He&&Me}return we=s(He,ce,we,ne,`Invalid value for type, key: ${ce}`),we},getAllForString:function(ce,ne){const me={};for(const Fe in ce)ce.hasOwnProperty(Fe)&&(me[Fe]=this.getForString(Fe,ce[Fe],ne));return me},containsKey:function(ce){return this.containsKeyForString(ce,self.location.search)},containsKeyForString:function(ce,ne){if(!i(ne))throw new Error(`Query strings should be either the empty string or start with a "?": ${ne}`);return o(ce,ne).length>0},deepEquals:function(ce,ne){if(typeof ce!=typeof ne)return!1;if(typeof ce=="string"||typeof ce=="number"||typeof ce=="boolean")return ce===ne;if(ce===null&&ne===null||ce===void 0&&ne===void 0)return!0;if(ce===null&&ne===void 0||ce===void 0&&ne===null)return!1;const me=Object.keys(ce),Fe=Object.keys(ne);if(me.length!==Fe.length)return!1;if(me.length===0)return ce===ne;for(let we=0;we<me.length;we++){if(me[we]!==Fe[we])return!1;const He=ce[me[we]],Me=ne[me[we]];if(!n.deepEquals(He,Me))return!1}return!0},removeKeyValuePair:function(ce,ne){if(assert&&assert(typeof ce=="string",`url should be string, but it was: ${typeof ce}`),assert&&assert(typeof ne=="string",`url should be string, but it was: ${typeof ne}`),assert&&assert(i(ce),"queryString should be length 0 or begin with ?"),assert&&assert(ne.length>0,"url should be a string with length > 0"),ce.indexOf("?")===0){const me=[],we=ce.substring(1).split("&");for(let He=0;He<we.length;He++){const Me=we[He],ze=Me.split("=");decodeURIComponent(ze[0])!==ne&&me.push(Me)}return me.length>0?`?${me.join("&")}`:""}else return ce},removeKeyValuePairs:function(ce,ne){for(let me=0;me<ne.length;me++)ce=this.removeKeyValuePair(ce,ne[me]);return ce},appendQueryString:function(ce,ne){if((ne.indexOf("?")===0||ne.indexOf("&")===0)&&(ne=ne.substring(1)),ne.length===0)return ce;const me=ce.indexOf("?")>=0?"&":"?";return ce+me+ne},appendQueryStringArray:function(ce,ne){for(let me=0;me<ne.length;me++)ce=this.appendQueryString(ce,ne[me]);return ce},getQueryString:function(ce){const ne=ce.indexOf("?");return ne>=0?ce.substring(ne):"?"},addWarning:function(ce,ne,me){console.warn(me),this.warnings.push({key:ce,value:ne,message:me})},hasWarning:function(ce){let ne=!1;for(let me=0;me<this.warnings.length&&!ne;me++)ne=this.warnings[me].key===ce;return ne},getQueryParametersFromString:function(ce){return ce.indexOf("?")===0?ce.substring(1).split("&"):[]},getSingleQueryParameterString:function(ce,ne){const me=this.getQueryString(ne),Fe=this.getQueryParametersFromString(me);for(let we=0;we<Fe.length;we++){const He=Fe[we],Me=He.split("=");if(decodeURIComponent(Me[0])===ce)return He}return null}},o=function(ce,ne){const me=[],Fe=ne.slice(1).split("&");for(let we=0;we<Fe.length;we++){const He=Fe[we].split("="),Me=He[0],ze=He.slice(1).join("=");Me===ce&&(ze?me.push(decodeURIComponent(ze)):me.push(null))}return me},c=function(ce,ne){le(ne.hasOwnProperty("type"),`type field is required for key: ${ce}`),le(xe.hasOwnProperty(ne.type),`invalid type: ${ne.type} for key: ${ce}`),ne.hasOwnProperty("parse")&&le(typeof ne.parse=="function",`parse must be a function for key: ${ce}`),le(!(ne.hasOwnProperty("validValues")&&ne.hasOwnProperty("isValidValue")),ne),ne.hasOwnProperty("validValues")&&le(Array.isArray(ne.validValues),`isValidValue must be an array for key: ${ce}`),ne.hasOwnProperty("isValidValue")&&le(typeof ne.isValidValue=="function",`isValidValue must be a function for key: ${ce}`),ne.hasOwnProperty("defaultValue")&&le(xe[ne.type].isValidValue(ne.defaultValue),`defaultValue incorrect type: ${ce}`),ne.hasOwnProperty("validValues")&&ne.validValues.forEach(me=>le(xe[ne.type].isValidValue(me),`validValue incorrect type for key: ${ce}`)),ne.hasOwnProperty("defaultValue")&&ne.hasOwnProperty("validValues")&&le(j(ne.defaultValue,ne.validValues),ne),ne.hasOwnProperty("public")&&ne.public&&ne.type!=="flag"&&le(ne.hasOwnProperty("defaultValue"),`defaultValue is required when public: true for key: ${ce}`),f(ce,ne,xe[ne.type].required,xe[ne.type].optional),xe[ne.type].validateSchema&&xe[ne.type].validateSchema(ce,ne)},p=function(ce,ne){ne.hasOwnProperty("separator")&&le(typeof ne.separator=="string"&&ne.separator.length===1,`invalid separator: ${ne.separator}, for key: ${ce}`),le(!ne.elementSchema.hasOwnProperty("public"),"Array elements should not declare public; it comes from the array schema itself."),c(`${ce}.element`,ne.elementSchema)},f=function(ce,ne,me,Fe){const we=Object.getOwnPropertyNames(ne);me.forEach(Me=>{le(we.indexOf(Me)!==-1,`missing required property: ${Me} for key: ${ce}`)});const He=me.concat(Fe);we.forEach(Me=>{le(Me==="type"||He.indexOf(Me)!==-1,`unsupported property: ${Me} for key: ${ce}`)})},w=function(ce,ne,me){let Fe;return le(me.length<=1,`query parameter cannot occur multiple times: ${ce}`),ne.type==="flag"?Fe=xe[ne.type].parse(ce,ne,me[0]):(le(me[0]!==void 0||ne.hasOwnProperty("defaultValue"),`missing required query parameter: ${ce}`),me[0]===void 0?Fe=ne.defaultValue:Fe=xe[ne.type].parse(ce,ne,me[0])),Fe},O=function(ce,ne,me){return me===null?!0:me===void 0?!1:me},T=function(ce,ne,me){return me==="true"?!0:me==="false"?!1:me},z=function(ce,ne,me){const Fe=Number(me);return me===null||isNaN(Fe)?me:Fe},U=function(ce,ne,me){return me},m=function(ce,ne,me){let Fe;return me===null?Fe=[]:Fe=me.split(ne.separator||e).map(we=>w(ce,ne.elementSchema,[we])),Fe},Y=function(ce,ne,me){return ne.parse(me)},j=function(ce,ne){let me=!1;for(let Fe=0;Fe<ne.length&&!me;Fe++)me=n.deepEquals(ne[Fe],ce);return me},le=function(ce,ne){if(!ce)throw console&&console.log&&console.log(ne),new Error(`Query String Machine Assertion failed: ${ne}`)},xe={flag:{required:[],optional:["private","public"],validateSchema:null,parse:O,isValidValue:ce=>ce===!0||ce===!1,defaultValue:!0},boolean:{required:[],optional:["defaultValue","private","public"],validateSchema:null,parse:T,isValidValue:ce=>ce===!0||ce===!1},number:{required:[],optional:["defaultValue","validValues","isValidValue","private","public"],validateSchema:null,parse:z,isValidValue:ce=>typeof ce=="number"&&!isNaN(ce)},string:{required:[],optional:["defaultValue","validValues","isValidValue","private","public"],validateSchema:null,parse:U,isValidValue:ce=>ce===null||typeof ce=="string"},array:{required:["elementSchema"],optional:["defaultValue","validValues","isValidValue","separator","validValues","private","public"],validateSchema:p,parse:m,isValidValue:ce=>Array.isArray(ce)||ce===null},custom:{required:["parse"],optional:["defaultValue","validValues","isValidValue","private","public"],validateSchema:null,parse:Y,isValidValue:ce=>!0}};return n}()})})(m_);function Yl(h){throw new Error('Could not dynamically require "'+h+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}(function(h,e){(function(t){self.himalaya=t()})(function(){return function(){function t(i,s,n){function o(f,w){if(!s[f]){if(!i[f]){var O=typeof Yl=="function"&&Yl;if(!w&&O)return O(f,!0);if(c)return c(f,!0);var T=new Error("Cannot find module '"+f+"'");throw T.code="MODULE_NOT_FOUND",T}var z=s[f]={exports:{}};i[f][0].call(z.exports,function(U){var m=i[f][1][U];return o(m||U)},z,z.exports,t,i,s,n)}return s[f].exports}for(var c=typeof Yl=="function"&&Yl,p=0;p<n.length;p++)o(n[p]);return o}return t}()({1:[function(t,i,s){var n=function(){var O="/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/compat.js",T="cde94accf38c67a096269c512dfb0f1bca69a38a",z=(function(){}).constructor,U=new z("return this")(),m="__coverage__",Y={path:"/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/compat.js",statementMap:{0:{start:{line:10,column:2},end:{line:10,column:72}},1:{start:{line:14,column:16},end:{line:14,column:62}},2:{start:{line:15,column:20},end:{line:15,column:56}},3:{start:{line:16,column:2},end:{line:16,column:48}},4:{start:{line:20,column:2},end:{line:20,column:56}},5:{start:{line:24,column:2},end:{line:24,column:42}},6:{start:{line:28,column:14},end:{line:28,column:26}},7:{start:{line:29,column:2},end:{line:29,column:29}},8:{start:{line:29,column:17},end:{line:29,column:29}},9:{start:{line:31,column:22},end:{line:31,column:34}},10:{start:{line:32,column:23},end:{line:32,column:47}},11:{start:{line:33,column:20},end:{line:33,column:70}},12:{start:{line:34,column:2},end:{line:38,column:3}},13:{start:{line:35,column:20},end:{line:35,column:40}},14:{start:{line:36,column:4},end:{line:36,column:46}},15:{start:{line:36,column:35},end:{line:36,column:46}},16:{start:{line:37,column:4},end:{line:37,column:55}},17:{start:{line:37,column:44},end:{line:37,column:55}},18:{start:{line:40,column:2},end:{line:40,column:14}}},fnMap:{0:{name:"startsWith",decl:{start:{line:9,column:16},end:{line:9,column:26}},loc:{start:{line:9,column:57},end:{line:11,column:1}},line:9},1:{name:"endsWith",decl:{start:{line:13,column:16},end:{line:13,column:24}},loc:{start:{line:13,column:55},end:{line:17,column:1}},line:13},2:{name:"stringIncludes",decl:{start:{line:19,column:16},end:{line:19,column:30}},loc:{start:{line:19,column:61},end:{line:21,column:1}},line:19},3:{name:"isRealNaN",decl:{start:{line:23,column:16},end:{line:23,column:25}},loc:{start:{line:23,column:30},end:{line:25,column:1}},line:23},4:{name:"arrayIncludes",decl:{start:{line:27,column:16},end:{line:27,column:29}},loc:{start:{line:27,column:63},end:{line:41,column:1}},line:27}},branchMap:{0:{loc:{start:{line:10,column:20},end:{line:10,column:33}},type:"binary-expr",locations:[{start:{line:10,column:20},end:{line:10,column:28}},{start:{line:10,column:32},end:{line:10,column:33}}],line:10},1:{loc:{start:{line:14,column:17},end:{line:14,column:39}},type:"binary-expr",locations:[{start:{line:14,column:17},end:{line:14,column:25}},{start:{line:14,column:29},end:{line:14,column:39}}],line:14},2:{loc:{start:{line:16,column:9},end:{line:16,column:48}},type:"binary-expr",locations:[{start:{line:16,column:9},end:{line:16,column:25}},{start:{line:16,column:29},end:{line:16,column:48}}],line:16},3:{loc:{start:{line:20,column:35},end:{line:20,column:48}},type:"binary-expr",locations:[{start:{line:20,column:35},end:{line:20,column:43}},{start:{line:20,column:47},end:{line:20,column:48}}],line:20},4:{loc:{start:{line:24,column:9},end:{line:24,column:42}},type:"binary-expr",locations:[{start:{line:24,column:9},end:{line:24,column:30}},{start:{line:24,column:34},end:{line:24,column:42}}],line:24},5:{loc:{start:{line:29,column:2},end:{line:29,column:29}},type:"if",locations:[{start:{line:29,column:2},end:{line:29,column:29}},{start:{line:29,column:2},end:{line:29,column:29}}],line:29},6:{loc:{start:{line:33,column:20},end:{line:33,column:70}},type:"cond-expr",locations:[{start:{line:33,column:39},end:{line:33,column:50}},{start:{line:33,column:53},end:{line:33,column:70}}],line:33},7:{loc:{start:{line:36,column:4},end:{line:36,column:46}},type:"if",locations:[{start:{line:36,column:4},end:{line:36,column:46}},{start:{line:36,column:4},end:{line:36,column:46}}],line:36},8:{loc:{start:{line:37,column:4},end:{line:37,column:55}},type:"if",locations:[{start:{line:37,column:4},end:{line:37,column:55}},{start:{line:37,column:4},end:{line:37,column:55}}],line:37},9:{loc:{start:{line:37,column:8},end:{line:37,column:42}},type:"binary-expr",locations:[{start:{line:37,column:8},end:{line:37,column:20}},{start:{line:37,column:24},end:{line:37,column:42}}],line:37}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0},f:{0:0,1:0,2:0,3:0,4:0},b:{0:[0,0],1:[0,0],2:[0,0],3:[0,0],4:[0,0],5:[0,0],6:[0,0],7:[0,0],8:[0,0],9:[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},j=U[m]||(U[m]={});return j[O]&&j[O].hash===T?j[O]:(Y.hash=T,j[O]=Y)}();Object.defineProperty(s,"__esModule",{value:!0}),s.startsWith=o,s.endsWith=c,s.stringIncludes=p,s.isRealNaN=f,s.arrayIncludes=w;function o(O,T,z){return n.f[0]++,n.s[0]++,O.substr((n.b[0][0]++,z||(n.b[0][1]++,0)),T.length)===T}function c(O,T,z){n.f[1]++;var U=(n.s[1]++,n.b[1][0]++,(z||(n.b[1][1]++,O.length))-T.length),m=(n.s[2]++,O.lastIndexOf(T,U));return n.s[3]++,n.b[2][0]++,m!==-1&&(n.b[2][1]++,m===U)}function p(O,T,z){return n.f[2]++,n.s[4]++,O.indexOf(T,(n.b[3][0]++,z||(n.b[3][1]++,0)))!==-1}function f(O){return n.f[3]++,n.s[5]++,n.b[4][0]++,typeof O=="number"&&(n.b[4][1]++,isNaN(O))}function w(O,T,z){n.f[4]++;var U=(n.s[6]++,O.length);if(n.s[7]++,U===0)return n.b[5][0]++,n.s[8]++,!1;n.b[5][1]++;var m=(n.s[9]++,z|0),Y=(n.s[10]++,f(T)),j=(n.s[11]++,m>=0?(n.b[6][0]++,m):(n.b[6][1]++,U+m));for(n.s[12]++;j<U;){var le=(n.s[13]++,O[j++]);if(n.s[14]++,le===T)return n.b[7][0]++,n.s[15]++,!0;if(n.b[7][1]++,n.s[16]++,n.b[9][0]++,Y&&(n.b[9][1]++,f(le)))return n.b[8][0]++,n.s[17]++,!0;n.b[8][1]++}return n.s[18]++,!1}},{}],2:[function(t,i,s){var n=function(){var w="/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/format.js",O="ef8c4d14fa58c2bce23a58bf5d7c370846a07329",T=(function(){}).constructor,z=new T("return this")(),U="__coverage__",m={path:"/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/format.js",statementMap:{0:{start:{line:2,column:14},end:{line:2,column:30}},1:{start:{line:3,column:2},end:{line:3,column:30}},2:{start:{line:3,column:18},end:{line:3,column:30}},3:{start:{line:4,column:2},end:{line:4,column:57}},4:{start:{line:8,column:14},end:{line:8,column:27}},5:{start:{line:9,column:14},end:{line:9,column:28}},6:{start:{line:10,column:23},end:{line:10,column:49}},7:{start:{line:11,column:2},end:{line:13,column:3}},8:{start:{line:12,column:4},end:{line:12,column:28}},9:{start:{line:14,column:2},end:{line:14,column:12}},10:{start:{line:18,column:2},end:{line:32,column:4}},11:{start:{line:19,column:17},end:{line:19,column:26}},12:{start:{line:20,column:23},end:{line:27,column:39}},13:{start:{line:28,column:4},end:{line:30,column:5}},14:{start:{line:29,column:6},end:{line:29,column:41}},15:{start:{line:31,column:4},end:{line:31,column:21}},16:{start:{line:36,column:2},end:{line:43,column:4}},17:{start:{line:37,column:18},end:{line:37,column:50}},18:{start:{line:38,column:16},end:{line:38,column:24}},19:{start:{line:39,column:18},end:{line:41,column:12}},20:{start:{line:42,column:4},end:{line:42,column:23}}},fnMap:{0:{name:"splitHead",decl:{start:{line:1,column:16},end:{line:1,column:25}},loc:{start:{line:1,column:37},end:{line:5,column:1}},line:1},1:{name:"unquote",decl:{start:{line:7,column:16},end:{line:7,column:23}},loc:{start:{line:7,column:30},end:{line:15,column:1}},line:7},2:{name:"format",decl:{start:{line:17,column:16},end:{line:17,column:22}},loc:{start:{line:17,column:40},end:{line:33,column:1}},line:17},3:{name:"(anonymous_3)",decl:{start:{line:18,column:19},end:{line:18,column:20}},loc:{start:{line:18,column:27},end:{line:32,column:3}},line:18},4:{name:"formatAttributes",decl:{start:{line:35,column:16},end:{line:35,column:32}},loc:{start:{line:35,column:46},end:{line:44,column:1}},line:35},5:{name:"(anonymous_5)",decl:{start:{line:36,column:24},end:{line:36,column:25}},loc:{start:{line:36,column:37},end:{line:43,column:3}},line:36}},branchMap:{0:{loc:{start:{line:3,column:2},end:{line:3,column:30}},type:"if",locations:[{start:{line:3,column:2},end:{line:3,column:30}},{start:{line:3,column:2},end:{line:3,column:30}}],line:3},1:{loc:{start:{line:10,column:23},end:{line:10,column:49}},type:"binary-expr",locations:[{start:{line:10,column:23},end:{line:10,column:34}},{start:{line:10,column:38},end:{line:10,column:49}}],line:10},2:{loc:{start:{line:11,column:2},end:{line:13,column:3}},type:"if",locations:[{start:{line:11,column:2},end:{line:13,column:3}},{start:{line:11,column:2},end:{line:13,column:3}}],line:11},3:{loc:{start:{line:11,column:6},end:{line:11,column:45}},type:"binary-expr",locations:[{start:{line:11,column:6},end:{line:11,column:18}},{start:{line:11,column:22},end:{line:11,column:45}}],line:11},4:{loc:{start:{line:20,column:23},end:{line:27,column:39}},type:"cond-expr",locations:[{start:{line:21,column:8},end:{line:26,column:7}},{start:{line:27,column:8},end:{line:27,column:39}}],line:20},5:{loc:{start:{line:28,column:4},end:{line:30,column:5}},type:"if",locations:[{start:{line:28,column:4},end:{line:30,column:5}},{start:{line:28,column:4},end:{line:30,column:5}}],line:28},6:{loc:{start:{line:39,column:18},end:{line:41,column:12}},type:"cond-expr",locations:[{start:{line:40,column:8},end:{line:40,column:25}},{start:{line:41,column:8},end:{line:41,column:12}}],line:39}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0},f:{0:0,1:0,2:0,3:0,4:0,5:0},b:{0:[0,0],1:[0,0],2:[0,0],3:[0,0],4:[0,0],5:[0,0],6:[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},Y=z[U]||(z[U]={});return Y[w]&&Y[w].hash===O?Y[w]:(m.hash=O,Y[w]=m)}();Object.defineProperty(s,"__esModule",{value:!0}),s.splitHead=o,s.unquote=c,s.format=p,s.formatAttributes=f;function o(w,O){n.f[0]++;var T=(n.s[0]++,w.indexOf(O));return n.s[1]++,T===-1?(n.b[0][0]++,n.s[2]++,[w]):(n.b[0][1]++,n.s[3]++,[w.slice(0,T),w.slice(T+O.length)])}function c(w){n.f[1]++;var O=(n.s[4]++,w.charAt(0)),T=(n.s[5]++,w.length-1),z=(n.s[6]++,n.b[1][0]++,O==='"'||(n.b[1][1]++,O==="'"));return n.s[7]++,n.b[3][0]++,z&&(n.b[3][1]++,O===w.charAt(T))?(n.b[2][0]++,n.s[8]++,w.slice(1,T)):(n.b[2][1]++,n.s[9]++,w)}function p(w,O){return n.f[2]++,n.s[10]++,w.map(function(T){n.f[3]++;var z=(n.s[11]++,T.type),U=(n.s[12]++,z==="element"?(n.b[4][0]++,{type:z,tagName:T.tagName.toLowerCase(),attributes:f(T.attributes),children:p(T.children,O)}):(n.b[4][1]++,{type:z,content:T.content}));return n.s[13]++,O.includePositions?(n.b[5][0]++,n.s[14]++,U.position=T.position):n.b[5][1]++,n.s[15]++,U})}function f(w){return n.f[4]++,n.s[16]++,w.map(function(O){n.f[5]++;var T=(n.s[17]++,o(O.trim(),"=")),z=(n.s[18]++,T[0]),U=(n.s[19]++,typeof T[1]=="string"?(n.b[6][0]++,c(T[1])):(n.b[6][1]++,null));return n.s[20]++,{key:z,value:U}})}},{}],3:[function(t,i,s){var n=function(){var j="/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/index.js",le="a91ca68b6320b199fa63e4cbd37dce6857e0c43d",xe=(function(){}).constructor,ce=new xe("return this")(),ne="__coverage__",me={path:"/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/index.js",statementMap:{0:{start:{line:12,column:29},end:{line:18,column:1}},1:{start:{line:21,column:17},end:{line:21,column:36}},2:{start:{line:22,column:16},end:{line:22,column:39}},3:{start:{line:23,column:2},end:{line:23,column:31}},4:{start:{line:27,column:2},end:{line:27,column:29}}},fnMap:{0:{name:"parse",decl:{start:{line:20,column:16},end:{line:20,column:21}},loc:{start:{line:20,column:53},end:{line:24,column:1}},line:20},1:{name:"stringify",decl:{start:{line:26,column:16},end:{line:26,column:25}},loc:{start:{line:26,column:57},end:{line:28,column:1}},line:26}},branchMap:{0:{loc:{start:{line:20,column:28},end:{line:20,column:51}},type:"default-arg",locations:[{start:{line:20,column:38},end:{line:20,column:51}}],line:20},1:{loc:{start:{line:26,column:32},end:{line:26,column:55}},type:"default-arg",locations:[{start:{line:26,column:42},end:{line:26,column:55}}],line:26}},s:{0:0,1:0,2:0,3:0,4:0},f:{0:0,1:0},b:{0:[0],1:[0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},Fe=ce[ne]||(ce[ne]={});return Fe[j]&&Fe[j].hash===le?Fe[j]:(me.hash=le,Fe[j]=me)}();Object.defineProperty(s,"__esModule",{value:!0}),s.parseDefaults=void 0,s.parse=m,s.stringify=Y;var o=t("./lexer"),c=z(o),p=t("./parser"),f=z(p),w=t("./format"),O=t("./stringify"),T=t("./tags");function z(j){return j&&j.__esModule?j:{default:j}}var U=s.parseDefaults=(n.s[0]++,{voidTags:T.voidTags,closingTags:T.closingTags,childlessTags:T.childlessTags,closingTagAncestorBreakers:T.closingTagAncestorBreakers,includePositions:!1});function m(j){var le=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(n.b[0][0]++,U);n.f[0]++;var xe=(n.s[1]++,(0,c.default)(j,le)),ce=(n.s[2]++,(0,f.default)(xe,le));return n.s[3]++,(0,w.format)(ce,le)}function Y(j){var le=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(n.b[1][0]++,U);return n.f[1]++,n.s[4]++,(0,O.toHTML)(j,le)}},{"./format":2,"./lexer":4,"./parser":5,"./stringify":6,"./tags":7}],4:[function(t,i,s){var n=function(){var we="/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/lexer.js",He="99f1269b85a36e02e6fcfa2eb5c9423a8a428848",Me=(function(){}).constructor,ze=new Me("return this")(),Je="__coverage__",Ee={path:"/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/lexer.js",statementMap:{0:{start:{line:9,column:16},end:{line:9,column:30}},1:{start:{line:10,column:14},end:{line:10,column:42}},2:{start:{line:11,column:2},end:{line:19,column:3}},3:{start:{line:12,column:17},end:{line:12,column:30}},4:{start:{line:13,column:4},end:{line:18,column:5}},5:{start:{line:14,column:6},end:{line:14,column:21}},6:{start:{line:15,column:6},end:{line:15,column:25}},7:{start:{line:17,column:6},end:{line:17,column:23}},8:{start:{line:23,column:14},end:{line:23,column:34}},9:{start:{line:24,column:2},end:{line:24,column:41}},10:{start:{line:28,column:2},end:{line:32,column:3}},11:{start:{line:36,column:2},end:{line:40,column:3}},12:{start:{line:44,column:16},end:{line:49,column:3}},13:{start:{line:50,column:2},end:{line:50,column:12}},14:{start:{line:51,column:2},end:{line:51,column:21}},15:{start:{line:55,column:42},end:{line:55,column:47}},16:{start:{line:56,column:14},end:{line:56,column:24}},17:{start:{line:57,column:2},end:{line:72,column:3}},18:{start:{line:58,column:18},end:{line:58,column:38}},19:{start:{line:59,column:4},end:{line:59,column:18}},20:{start:{line:60,column:4},end:{line:71,column:5}},21:{start:{line:61,column:24},end:{line:61,column:57}},22:{start:{line:62,column:6},end:{line:70,column:7}},23:{start:{line:63,column:8},end:{line:63,column:25}},24:{start:{line:65,column:24},end:{line:65,column:37}},25:{start:{line:66,column:24},end:{line:66,column:45}},26:{start:{line:67,column:8},end:{line:69,column:9}},27:{start:{line:68,column:10},end:{line:68,column:36}},28:{start:{line:75,column:21},end:{line:75,column:34}},29:{start:{line:77,column:2},end:{line:87,column:3}},30:{start:{line:78,column:20},end:{line:78,column:43}},31:{start:{line:79,column:4},end:{line:81,column:5}},32:{start:{line:80,column:6},end:{line:80,column:20}},33:{start:{line:82,column:17},end:{line:82,column:40}},34:{start:{line:83,column:4},end:{line:85,column:5}},35:{start:{line:84,column:6},end:{line:84,column:20}},36:{start:{line:86,column:4},end:{line:86,column:23}},37:{start:{line:91,column:15},end:{line:91,column:21}},38:{start:{line:92,column:26},end:{line:92,column:31}},39:{start:{line:93,column:16},end:{line:93,column:48}},40:{start:{line:94,column:2},end:{line:94,column:40}},41:{start:{line:94,column:34},end:{line:94,column:40}},42:{start:{line:95,column:2},end:{line:97,column:3}},43:{start:{line:96,column:4},end:{line:96,column:24}},44:{start:{line:99,column:16},end:{line:99,column:38}},45:{start:{line:100,column:18},end:{line:100,column:52}},46:{start:{line:101,column:2},end:{line:101,column:38}},47:{start:{line:102,column:14},end:{line:102,column:36}},48:{start:{line:103,column:2},end:{line:103,column:60}},49:{start:{line:107,column:26},end:{line:107,column:31}},50:{start:{line:108,column:16},end:{line:108,column:38}},51:{start:{line:109,column:2},end:{line:109,column:32}},52:{start:{line:110,column:19},end:{line:110,column:53}},53:{start:{line:111,column:19},end:{line:111,column:33}},54:{start:{line:112,column:2},end:{line:114,column:3}},55:{start:{line:113,column:4},end:{line:113,column:40}},56:{start:{line:116,column:18},end:{line:116,column:55}},57:{start:{line:117,column:2},end:{line:117,column:41}},58:{start:{line:118,column:2},end:{line:125,column:4}},59:{start:{line:129,column:26},end:{line:129,column:31}},60:{start:{line:131,column:23},end:{line:131,column:53}},61:{start:{line:132,column:18},end:{line:132,column:36}},62:{start:{line:133,column:18},end:{line:133,column:40}},63:{start:{line:134,column:4},end:{line:134,column:46}},64:{start:{line:135,column:4},end:{line:135,column:68}},65:{start:{line:137,column:18},end:{line:137,column:35}},66:{start:{line:138,column:2},end:{line:138,column:25}},67:{start:{line:140,column:22},end:{line:140,column:48}},68:{start:{line:141,column:18},end:{line:141,column:35}},69:{start:{line:142,column:4},end:{line:142,column:46}},70:{start:{line:143,column:16},end:{line:143,column:38}},71:{start:{line:144,column:4},end:{line:144,column:64}},72:{start:{line:146,column:2},end:{line:146,column:16}},73:{start:{line:150,column:19},end:{line:150,column:23}},74:{start:{line:152,column:2},end:{line:152,column:30}},75:{start:{line:156,column:26},end:{line:156,column:31}},76:{start:{line:157,column:14},end:{line:157,column:24}},77:{start:{line:158,column:14},end:{line:158,column:28}},78:{start:{line:159,column:2},end:{line:164,column:3}},79:{start:{line:160,column:17},end:{line:160,column:34}},80:{start:{line:161,column:22},end:{line:161,column:79}},81:{start:{line:162,column:4},end:{line:162,column:24}},82:{start:{line:162,column:19},end:{line:162,column:24}},83:{start:{line:163,column:4},end:{line:163,column:11}},84:{start:{line:166,column:12},end:{line:166,column:21}},85:{start:{line:167,column:2},end:{line:172,column:3}},86:{start:{line:168,column:17},end:{line:168,column:32}},87:{start:{line:169,column:22},end:{line:169,column:79}},88:{start:{line:170,column:4},end:{line:170,column:25}},89:{start:{line:170,column:20},end:{line:170,column:25}},90:{start:{line:171,column:4},end:{line:171,column:9}},91:{start:{line:174,column:2},end:{line:174,column:34}},92:{start:{line:175,column:18},end:{line:175,column:39}},93:{start:{line:176,column:2},end:{line:179,column:4}},94:{start:{line:180,column:2},end:{line:180,column:16}},95:{start:{line:184,column:34},end:{line:184,column:39}},96:{start:{line:185,column:15},end:{line:185,column:29}},97:{start:{line:186,column:14},end:{line:186,column:18}},98:{start:{line:187,column:18},end:{line:187,column:24}},99:{start:{line:188,column:16},end:{line:188,column:18}},100:{start:{line:189,column:14},end:{line:189,column:24}},101:{start:{line:190,column:2},end:{line:227,column:3}},102:{start:{line:191,column:17},end:{line:191,column:35}},103:{start:{line:192,column:4},end:{line:199,column:5}},104:{start:{line:193,column:25},end:{line:193,column:39}},105:{start:{line:194,column:6},end:{line:196,column:7}},106:{start:{line:195,column:8},end:{line:195,column:20}},107:{start:{line:197,column:6},end:{line:197,column:14}},108:{start:{line:198,column:6},end:{line:198,column:14}},109:{start:{line:201,column:21},end:{line:201,column:49}},110:{start:{line:202,column:4},end:{line:207,column:5}},111:{start:{line:203,column:6},end:{line:205,column:7}},112:{start:{line:204,column:8},end:{line:204,column:48}},113:{start:{line:206,column:6},end:{line:206,column:11}},114:{start:{line:209,column:22},end:{line:209,column:44}},115:{start:{line:210,column:4},end:{line:217,column:5}},116:{start:{line:211,column:6},end:{line:213,column:7}},117:{start:{line:212,column:8},end:{line:212,column:48}},118:{start:{line:214,column:6},end:{line:214,column:28}},119:{start:{line:215,column:6},end:{line:215,column:14}},120:{start:{line:216,column:6},end:{line:216,column:14}},121:{start:{line:219,column:25},end:{line:219,column:54}},122:{start:{line:220,column:4},end:{line:224,column:5}},123:{start:{line:221,column:6},end:{line:221,column:18}},124:{start:{line:222,column:6},end:{line:222,column:14}},125:{start:{line:223,column:6},end:{line:223,column:14}},126:{start:{line:226,column:4},end:{line:226,column:12}},127:{start:{line:228,column:2},end:{line:228,column:37}},128:{start:{line:230,column:15},end:{line:230,column:27}},129:{start:{line:231,column:15},end:{line:231,column:26}},130:{start:{line:232,column:2},end:{line:269,column:3}},131:{start:{line:233,column:17},end:{line:233,column:25}},132:{start:{line:234,column:22},end:{line:234,column:46}},133:{start:{line:235,column:4},end:{line:253,column:5}},134:{start:{line:236,column:25},end:{line:236,column:37}},135:{start:{line:237,column:6},end:{line:252,column:7}},136:{start:{line:238,column:8},end:{line:243,column:9}},137:{start:{line:239,column:26},end:{line:239,column:43}},138:{start:{line:240,column:10},end:{line:240,column:47}},139:{start:{line:241,column:10},end:{line:241,column:16}},140:{start:{line:242,column:10},end:{line:242,column:18}},141:{start:{line:244,column:26},end:{line:244,column:38}},142:{start:{line:245,column:8},end:{line:245,column:14}},143:{start:{line:246,column:8},end:{line:251,column:9}},144:{start:{line:247,column:26},end:{line:247,column:48}},145:{start:{line:248,column:10},end:{line:248,column:47}},146:{start:{line:249,column:10},end:{line:249,column:16}},147:{start:{line:250,column:10},end:{line:250,column:18}},148:{start:{line:254,column:4},end:{line:266,column:5}},149:{start:{line:255,column:25},end:{line:255,column:37}},150:{start:{line:256,column:6},end:{line:261,column:7}},151:{start:{line:257,column:24},end:{line:257,column:41}},152:{start:{line:258,column:8},end:{line:258,column:45}},153:{start:{line:259,column:8},end:{line:259,column:14}},154:{start:{line:260,column:8},end:{line:260,column:16}},155:{start:{line:263,column:22},end:{line:263,column:39}},156:{start:{line:264,column:6},end:{line:264,column:43}},157:{start:{line:265,column:6},end:{line:265,column:14}},158:{start:{line:268,column:4},end:{line:268,column:38}},159:{start:{line:272,column:13},end:{line:272,column:20}},160:{start:{line:275,column:34},end:{line:275,column:39}},161:{start:{line:276,column:22},end:{line:276,column:43}},162:{start:{line:277,column:14},end:{line:277,column:24}},163:{start:{line:278,column:14},end:{line:278,column:28}},164:{start:{line:279,column:2},end:{line:311,column:3}},165:{start:{line:280,column:20},end:{line:280,column:44}},166:{start:{line:281,column:4},end:{line:284,column:5}},167:{start:{line:282,column:6},end:{line:282,column:20}},168:{start:{line:283,column:6},end:{line:283,column:11}},169:{start:{line:286,column:29},end:{line:286,column:51}},170:{start:{line:287,column:4},end:{line:287,column:48}},171:{start:{line:288,column:21},end:{line:288,column:66}},172:{start:{line:289,column:17},end:{line:289,column:33}},173:{start:{line:290,column:4},end:{line:293,column:5}},174:{start:{line:291,column:6},end:{line:291,column:37}},175:{start:{line:292,column:6},end:{line:292,column:14}},176:{start:{line:295,column:4},end:{line:306,column:5}},177:{start:{line:296,column:24},end:{line:296,column:46}},178:{start:{line:297,column:6},end:{line:297,column:42}},179:{start:{line:298,column:6},end:{line:305,column:8}},180:{start:{line:308,column:4},end:{line:308,column:39}},181:{start:{line:309,column:4},end:{line:309,column:56}},182:{start:{line:310,column:4},end:{line:310,column:9}}},fnMap:{0:{name:"feedPosition",decl:{start:{line:8,column:16},end:{line:8,column:28}},loc:{start:{line:8,column:50},end:{line:20,column:1}},line:8},1:{name:"jumpPosition",decl:{start:{line:22,column:16},end:{line:22,column:28}},loc:{start:{line:22,column:50},end:{line:25,column:1}},line:22},2:{name:"makeInitialPosition",decl:{start:{line:27,column:16},end:{line:27,column:35}},loc:{start:{line:27,column:39},end:{line:33,column:1}},line:27},3:{name:"copyPosition",decl:{start:{line:35,column:16},end:{line:35,column:28}},loc:{start:{line:35,column:40},end:{line:41,column:1}},line:35},4:{name:"lexer",decl:{start:{line:43,column:24},end:{line:43,column:29}},loc:{start:{line:43,column:45},end:{line:52,column:1}},line:43},5:{name:"lex",decl:{start:{line:54,column:16},end:{line:54,column:19}},loc:{start:{line:54,column:28},end:{line:73,column:1}},line:54},6:{name:"findTextEnd",decl:{start:{line:76,column:16},end:{line:76,column:27}},loc:{start:{line:76,column:41},end:{line:88,column:1}},line:76},7:{name:"lexText",decl:{start:{line:90,column:16},end:{line:90,column:23}},loc:{start:{line:90,column:32},end:{line:104,column:1}},line:90},8:{name:"lexComment",decl:{start:{line:106,column:16},end:{line:106,column:26}},loc:{start:{line:106,column:35},end:{line:126,column:1}},line:106},9:{name:"lexTag",decl:{start:{line:128,column:16},end:{line:128,column:22}},loc:{start:{line:128,column:31},end:{line:147,column:1}},line:128},10:{name:"isWhitespaceChar",decl:{start:{line:151,column:16},end:{line:151,column:32}},loc:{start:{line:151,column:40},end:{line:153,column:1}},line:151},11:{name:"lexTagName",decl:{start:{line:155,column:16},end:{line:155,column:26}},loc:{start:{line:155,column:35},end:{line:181,column:1}},line:155},12:{name:"lexTagAttributes",decl:{start:{line:183,column:16},end:{line:183,column:32}},loc:{start:{line:183,column:41},end:{line:270,column:1}},line:183},13:{name:"lexSkipTag",decl:{start:{line:274,column:16},end:{line:274,column:26}},loc:{start:{line:274,column:44},end:{line:312,column:1}},line:274}},branchMap:{0:{loc:{start:{line:13,column:4},end:{line:18,column:5}},type:"if",locations:[{start:{line:13,column:4},end:{line:18,column:5}},{start:{line:13,column:4},end:{line:18,column:5}}],line:13},1:{loc:{start:{line:60,column:4},end:{line:71,column:5}},type:"if",locations:[{start:{line:60,column:4},end:{line:71,column:5}},{start:{line:60,column:4},end:{line:71,column:5}}],line:60},2:{loc:{start:{line:62,column:6},end:{line:70,column:7}},type:"if",locations:[{start:{line:62,column:6},end:{line:70,column:7}},{start:{line:62,column:6},end:{line:70,column:7}}],line:62},3:{loc:{start:{line:67,column:8},end:{line:69,column:9}},type:"if",locations:[{start:{line:67,column:8},end:{line:69,column:9}},{start:{line:67,column:8},end:{line:69,column:9}}],line:67},4:{loc:{start:{line:79,column:4},end:{line:81,column:5}},type:"if",locations:[{start:{line:79,column:4},end:{line:81,column:5}},{start:{line:79,column:4},end:{line:81,column:5}}],line:79},5:{loc:{start:{line:83,column:4},end:{line:85,column:5}},type:"if",locations:[{start:{line:83,column:4},end:{line:85,column:5}},{start:{line:83,column:4},end:{line:85,column:5}}],line:83},6:{loc:{start:{line:83,column:8},end:{line:83,column:63}},type:"binary-expr",locations:[{start:{line:83,column:8},end:{line:83,column:20}},{start:{line:83,column:24},end:{line:83,column:36}},{start:{line:83,column:40},end:{line:83,column:63}}],line:83},7:{loc:{start:{line:94,column:2},end:{line:94,column:40}},type:"if",locations:[{start:{line:94,column:2},end:{line:94,column:40}},{start:{line:94,column:2},end:{line:94,column:40}}],line:94},8:{loc:{start:{line:95,column:2},end:{line:97,column:3}},type:"if",locations:[{start:{line:95,column:2},end:{line:97,column:3}},{start:{line:95,column:2},end:{line:97,column:3}}],line:95},9:{loc:{start:{line:112,column:2},end:{line:114,column:3}},type:"if",locations:[{start:{line:112,column:2},end:{line:114,column:3}},{start:{line:112,column:2},end:{line:114,column:3}}],line:112},10:{loc:{start:{line:134,column:32},end:{line:134,column:45}},type:"cond-expr",locations:[{start:{line:134,column:40},end:{line:134,column:41}},{start:{line:134,column:44},end:{line:134,column:45}}],line:134},11:{loc:{start:{line:142,column:32},end:{line:142,column:45}},type:"cond-expr",locations:[{start:{line:142,column:40},end:{line:142,column:41}},{start:{line:142,column:44},end:{line:142,column:45}}],line:142},12:{loc:{start:{line:161,column:24},end:{line:161,column:78}},type:"binary-expr",locations:[{start:{line:161,column:24},end:{line:161,column:46}},{start:{line:161,column:50},end:{line:161,column:62}},{start:{line:161,column:66},end:{line:161,column:78}}],line:161},13:{loc:{start:{line:162,column:4},end:{line:162,column:24}},type:"if",locations:[{start:{line:162,column:4},end:{line:162,column:24}},{start:{line:162,column:4},end:{line:162,column:24}}],line:162},14:{loc:{start:{line:169,column:24},end:{line:169,column:78}},type:"binary-expr",locations:[{start:{line:169,column:24},end:{line:169,column:46}},{start:{line:169,column:50},end:{line:169,column:62}},{start:{line:169,column:66},end:{line:169,column:78}}],line:169},15:{loc:{start:{line:170,column:4},end:{line:170,column:25}},type:"if",locations:[{start:{line:170,column:4},end:{line:170,column:25}},{start:{line:170,column:4},end:{line:170,column:25}}],line:170},16:{loc:{start:{line:192,column:4},end:{line:199,column:5}},type:"if",locations:[{start:{line:192,column:4},end:{line:199,column:5}},{start:{line:192,column:4},end:{line:199,column:5}}],line:192},17:{loc:{start:{line:194,column:6},end:{line:196,column:7}},type:"if",locations:[{start:{line:194,column:6},end:{line:196,column:7}},{start:{line:194,column:6},end:{line:196,column:7}}],line:194},18:{loc:{start:{line:201,column:21},end:{line:201,column:49}},type:"binary-expr",locations:[{start:{line:201,column:21},end:{line:201,column:33}},{start:{line:201,column:37},end:{line:201,column:49}}],line:201},19:{loc:{start:{line:202,column:4},end:{line:207,column:5}},type:"if",locations:[{start:{line:202,column:4},end:{line:207,column:5}},{start:{line:202,column:4},end:{line:207,column:5}}],line:202},20:{loc:{start:{line:203,column:6},end:{line:205,column:7}},type:"if",locations:[{start:{line:203,column:6},end:{line:205,column:7}},{start:{line:203,column:6},end:{line:205,column:7}}],line:203},21:{loc:{start:{line:210,column:4},end:{line:217,column:5}},type:"if",locations:[{start:{line:210,column:4},end:{line:217,column:5}},{start:{line:210,column:4},end:{line:217,column:5}}],line:210},22:{loc:{start:{line:211,column:6},end:{line:213,column:7}},type:"if",locations:[{start:{line:211,column:6},end:{line:213,column:7}},{start:{line:211,column:6},end:{line:213,column:7}}],line:211},23:{loc:{start:{line:219,column:25},end:{line:219,column:54}},type:"binary-expr",locations:[{start:{line:219,column:25},end:{line:219,column:38}},{start:{line:219,column:42},end:{line:219,column:54}}],line:219},24:{loc:{start:{line:220,column:4},end:{line:224,column:5}},type:"if",locations:[{start:{line:220,column:4},end:{line:224,column:5}},{start:{line:220,column:4},end:{line:224,column:5}}],line:220},25:{loc:{start:{line:235,column:4},end:{line:253,column:5}},type:"if",locations:[{start:{line:235,column:4},end:{line:253,column:5}},{start:{line:235,column:4},end:{line:253,column:5}}],line:235},26:{loc:{start:{line:237,column:6},end:{line:252,column:7}},type:"if",locations:[{start:{line:237,column:6},end:{line:252,column:7}},{start:{line:237,column:6},end:{line:252,column:7}}],line:237},27:{loc:{start:{line:237,column:10},end:{line:237,column:51}},type:"binary-expr",locations:[{start:{line:237,column:10},end:{line:237,column:20}},{start:{line:237,column:24},end:{line:237,column:51}}],line:237},28:{loc:{start:{line:238,column:8},end:{line:243,column:9}},type:"if",locations:[{start:{line:238,column:8},end:{line:243,column:9}},{start:{line:238,column:8},end:{line:243,column:9}}],line:238},29:{loc:{start:{line:246,column:8},end:{line:251,column:9}},type:"if",locations:[{start:{line:246,column:8},end:{line:251,column:9}},{start:{line:246,column:8},end:{line:251,column:9}}],line:246},30:{loc:{start:{line:254,column:4},end:{line:266,column:5}},type:"if",locations:[{start:{line:254,column:4},end:{line:266,column:5}},{start:{line:254,column:4},end:{line:266,column:5}}],line:254},31:{loc:{start:{line:256,column:6},end:{line:261,column:7}},type:"if",locations:[{start:{line:256,column:6},end:{line:261,column:7}},{start:{line:256,column:6},end:{line:261,column:7}}],line:256},32:{loc:{start:{line:256,column:10},end:{line:256,column:56}},type:"binary-expr",locations:[{start:{line:256,column:10},end:{line:256,column:20}},{start:{line:256,column:24},end:{line:256,column:56}}],line:256},33:{loc:{start:{line:281,column:4},end:{line:284,column:5}},type:"if",locations:[{start:{line:281,column:4},end:{line:284,column:5}},{start:{line:281,column:4},end:{line:284,column:5}}],line:281},34:{loc:{start:{line:290,column:4},end:{line:293,column:5}},type:"if",locations:[{start:{line:290,column:4},end:{line:293,column:5}},{start:{line:290,column:4},end:{line:293,column:5}}],line:290},35:{loc:{start:{line:295,column:4},end:{line:306,column:5}},type:"if",locations:[{start:{line:295,column:4},end:{line:306,column:5}},{start:{line:295,column:4},end:{line:306,column:5}}],line:295}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0,25:0,26:0,27:0,28:0,29:0,30:0,31:0,32:0,33:0,34:0,35:0,36:0,37:0,38:0,39:0,40:0,41:0,42:0,43:0,44:0,45:0,46:0,47:0,48:0,49:0,50:0,51:0,52:0,53:0,54:0,55:0,56:0,57:0,58:0,59:0,60:0,61:0,62:0,63:0,64:0,65:0,66:0,67:0,68:0,69:0,70:0,71:0,72:0,73:0,74:0,75:0,76:0,77:0,78:0,79:0,80:0,81:0,82:0,83:0,84:0,85:0,86:0,87:0,88:0,89:0,90:0,91:0,92:0,93:0,94:0,95:0,96:0,97:0,98:0,99:0,100:0,101:0,102:0,103:0,104:0,105:0,106:0,107:0,108:0,109:0,110:0,111:0,112:0,113:0,114:0,115:0,116:0,117:0,118:0,119:0,120:0,121:0,122:0,123:0,124:0,125:0,126:0,127:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:0,136:0,137:0,138:0,139:0,140:0,141:0,142:0,143:0,144:0,145:0,146:0,147:0,148:0,149:0,150:0,151:0,152:0,153:0,154:0,155:0,156:0,157:0,158:0,159:0,160:0,161:0,162:0,163:0,164:0,165:0,166:0,167:0,168:0,169:0,170:0,171:0,172:0,173:0,174:0,175:0,176:0,177:0,178:0,179:0,180:0,181:0,182:0},f:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0},b:{0:[0,0],1:[0,0],2:[0,0],3:[0,0],4:[0,0],5:[0,0],6:[0,0,0],7:[0,0],8:[0,0],9:[0,0],10:[0,0],11:[0,0],12:[0,0,0],13:[0,0],14:[0,0,0],15:[0,0],16:[0,0],17:[0,0],18:[0,0],19:[0,0],20:[0,0],21:[0,0],22:[0,0],23:[0,0],24:[0,0],25:[0,0],26:[0,0],27:[0,0],28:[0,0],29:[0,0],30:[0,0],31:[0,0],32:[0,0],33:[0,0],34:[0,0],35:[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},rt=ze[Je]||(ze[Je]={});return rt[we]&&rt[we].hash===He?rt[we]:(Ee.hash=He,rt[we]=Ee)}();Object.defineProperty(s,"__esModule",{value:!0}),s.feedPosition=c,s.jumpPosition=p,s.makeInitialPosition=f,s.copyPosition=w,s.default=O,s.lex=T,s.findTextEnd=U,s.lexText=m,s.lexComment=Y,s.lexTag=j,s.isWhitespaceChar=xe,s.lexTagName=ce,s.lexTagAttributes=ne,s.lexSkipTag=Fe;var o=t("./compat");function c(we,He,Me){n.f[0]++;var ze=(n.s[0]++,we.index),Je=(n.s[1]++,we.index=ze+Me);n.s[2]++;for(var Ee=ze;Ee<Je;Ee++){var rt=(n.s[3]++,He.charAt(Ee));n.s[4]++,rt===`
`?(n.b[0][0]++,n.s[5]++,we.line++,n.s[6]++,we.column=0):(n.b[0][1]++,n.s[7]++,we.column++)}}function p(we,He,Me){n.f[1]++;var ze=(n.s[8]++,Me-we.index);return n.s[9]++,c(we,He,ze)}function f(){return n.f[2]++,n.s[10]++,{index:0,column:0,line:0}}function w(we){return n.f[3]++,n.s[11]++,{index:we.index,line:we.line,column:we.column}}function O(we,He){n.f[4]++;var Me=(n.s[12]++,{str:we,options:He,position:f(),tokens:[]});return n.s[13]++,T(Me),n.s[14]++,Me.tokens}function T(we){n.f[5]++;var He=(n.s[15]++,we),Me=He.str,ze=He.options.childlessTags,Je=(n.s[16]++,Me.length);for(n.s[17]++;we.position.index<Je;){var Ee=(n.s[18]++,we.position.index);if(n.s[19]++,m(we),n.s[20]++,we.position.index===Ee){n.b[1][0]++;var rt=(n.s[21]++,(0,o.startsWith)(Me,"!--",Ee+1));if(n.s[22]++,rt)n.b[2][0]++,n.s[23]++,Y(we);else{n.b[2][1]++;var Ie=(n.s[24]++,j(we)),Re=(n.s[25]++,Ie.toLowerCase());n.s[26]++,(0,o.arrayIncludes)(ze,Re)?(n.b[3][0]++,n.s[27]++,Fe(Ie,we)):n.b[3][1]++}}else n.b[1][1]++}}var z=(n.s[28]++,/[A-Za-z0-9]/);function U(we,He){for(n.f[6]++,n.s[29]++;;){var Me=(n.s[30]++,we.indexOf("<",He));if(n.s[31]++,Me===-1)return n.b[4][0]++,n.s[32]++,Me;n.b[4][1]++;var ze=(n.s[33]++,we.charAt(Me+1));if(n.s[34]++,n.b[6][0]++,ze==="/"||(n.b[6][1]++,ze==="!")||(n.b[6][2]++,z.test(ze)))return n.b[5][0]++,n.s[35]++,Me;n.b[5][1]++,n.s[36]++,He=Me+1}}function m(we){n.f[7]++;var He=(n.s[37]++,"text"),Me=(n.s[38]++,we),ze=Me.str,Je=Me.position,Ee=(n.s[39]++,U(ze,Je.index));if(n.s[40]++,Ee===Je.index){n.b[7][0]++,n.s[41]++;return}else n.b[7][1]++;n.s[42]++,Ee===-1?(n.b[8][0]++,n.s[43]++,Ee=ze.length):n.b[8][1]++;var rt=(n.s[44]++,w(Je)),Ie=(n.s[45]++,ze.slice(Je.index,Ee));n.s[46]++,p(Je,ze,Ee);var Re=(n.s[47]++,w(Je));n.s[48]++,we.tokens.push({type:He,content:Ie,position:{start:rt,end:Re}})}function Y(we){n.f[8]++;var He=(n.s[49]++,we),Me=He.str,ze=He.position,Je=(n.s[50]++,w(ze));n.s[51]++,c(ze,Me,4);var Ee=(n.s[52]++,Me.indexOf("-->",ze.index)),rt=(n.s[53]++,Ee+3);n.s[54]++,Ee===-1?(n.b[9][0]++,n.s[55]++,Ee=rt=Me.length):n.b[9][1]++;var Ie=(n.s[56]++,Me.slice(ze.index,Ee));n.s[57]++,p(ze,Me,rt),n.s[58]++,we.tokens.push({type:"comment",content:Ie,position:{start:Je,end:w(ze)}})}function j(we){n.f[9]++;var He=(n.s[59]++,we),Me=He.str,ze=He.position;{var Je=(n.s[60]++,Me.charAt(ze.index+1)),Ee=(n.s[61]++,Je==="/"),rt=(n.s[62]++,w(ze));n.s[63]++,c(ze,Me,Ee?(n.b[10][0]++,2):(n.b[10][1]++,1)),n.s[64]++,we.tokens.push({type:"tag-start",close:Ee,position:{start:rt}})}var Ie=(n.s[65]++,ce(we));n.s[66]++,ne(we);{var Re=(n.s[67]++,Me.charAt(ze.index)),We=(n.s[68]++,Re==="/");n.s[69]++,c(ze,Me,We?(n.b[11][0]++,2):(n.b[11][1]++,1));var Ve=(n.s[70]++,w(ze));n.s[71]++,we.tokens.push({type:"tag-end",close:We,position:{end:Ve}})}return n.s[72]++,Ie}var le=(n.s[73]++,/\s/);function xe(we){return n.f[10]++,n.s[74]++,le.test(we)}function ce(we){n.f[11]++;var He=(n.s[75]++,we),Me=He.str,ze=He.position,Je=(n.s[76]++,Me.length),Ee=(n.s[77]++,ze.index);for(n.s[78]++;Ee<Je;){var rt=(n.s[79]++,Me.charAt(Ee)),Ie=(n.s[80]++,n.b[12][0]++,!(xe(rt)||(n.b[12][1]++,rt==="/")||(n.b[12][2]++,rt===">")));if(n.s[81]++,Ie){n.b[13][0]++,n.s[82]++;break}else n.b[13][1]++;n.s[83]++,Ee++}var Re=(n.s[84]++,Ee+1);for(n.s[85]++;Re<Je;){var We=(n.s[86]++,Me.charAt(Re)),Ve=(n.s[87]++,n.b[14][0]++,!(xe(We)||(n.b[14][1]++,We==="/")||(n.b[14][2]++,We===">")));if(n.s[88]++,Ve)n.b[15][1]++;else{n.b[15][0]++,n.s[89]++;break}n.s[90]++,Re++}n.s[91]++,p(ze,Me,Re);var Qe=(n.s[92]++,Me.slice(Ee,Re));return n.s[93]++,we.tokens.push({type:"tag",content:Qe}),n.s[94]++,Qe}function ne(we){n.f[12]++;var He=(n.s[95]++,we),Me=He.str,ze=He.position,Je=He.tokens,Ee=(n.s[96]++,ze.index),rt=(n.s[97]++,null),Ie=(n.s[98]++,Ee),Re=(n.s[99]++,[]),We=(n.s[100]++,Me.length);for(n.s[101]++;Ee<We;){var Ve=(n.s[102]++,Me.charAt(Ee));if(n.s[103]++,rt){n.b[16][0]++;var Qe=(n.s[104]++,Ve===rt);n.s[105]++,Qe?(n.b[17][0]++,n.s[106]++,rt=null):n.b[17][1]++,n.s[107]++,Ee++,n.s[108]++;continue}else n.b[16][1]++;var Ot=(n.s[109]++,n.b[18][0]++,Ve==="/"||(n.b[18][1]++,Ve===">"));if(n.s[110]++,Ot){n.b[19][0]++,n.s[111]++,Ee!==Ie?(n.b[20][0]++,n.s[112]++,Re.push(Me.slice(Ie,Ee))):n.b[20][1]++,n.s[113]++;break}else n.b[19][1]++;var Tt=(n.s[114]++,xe(Ve));if(n.s[115]++,Tt){n.b[21][0]++,n.s[116]++,Ee!==Ie?(n.b[22][0]++,n.s[117]++,Re.push(Me.slice(Ie,Ee))):n.b[22][1]++,n.s[118]++,Ie=Ee+1,n.s[119]++,Ee++,n.s[120]++;continue}else n.b[21][1]++;var ot=(n.s[121]++,n.b[23][0]++,Ve==="'"||(n.b[23][1]++,Ve==='"'));if(n.s[122]++,ot){n.b[24][0]++,n.s[123]++,rt=Ve,n.s[124]++,Ee++,n.s[125]++;continue}else n.b[24][1]++;n.s[126]++,Ee++}n.s[127]++,p(ze,Me,Ee);var gt=(n.s[128]++,Re.length),Lt=(n.s[129]++,"attribute");n.s[130]++;for(var Vt=0;Vt<gt;Vt++){var hi=(n.s[131]++,Re[Vt]),Oi=(n.s[132]++,hi.indexOf("=")===-1);if(n.s[133]++,Oi){n.b[25][0]++;var St=(n.s[134]++,Re[Vt+1]);if(n.s[135]++,n.b[27][0]++,St&&(n.b[27][1]++,(0,o.startsWith)(St,"="))){if(n.b[26][0]++,n.s[136]++,St.length>1){n.b[28][0]++;var Ht=(n.s[137]++,hi+St);n.s[138]++,Je.push({type:Lt,content:Ht}),n.s[139]++,Vt+=1,n.s[140]++;continue}else n.b[28][1]++;var jt=(n.s[141]++,Re[Vt+2]);if(n.s[142]++,Vt+=1,n.s[143]++,jt){n.b[29][0]++;var lt=(n.s[144]++,hi+"="+jt);n.s[145]++,Je.push({type:Lt,content:lt}),n.s[146]++,Vt+=1,n.s[147]++;continue}else n.b[29][1]++}else n.b[26][1]++}else n.b[25][1]++;if(n.s[148]++,(0,o.endsWith)(hi,"=")){n.b[30][0]++;var Rs=(n.s[149]++,Re[Vt+1]);if(n.s[150]++,n.b[32][0]++,Rs&&(n.b[32][1]++,!(0,o.stringIncludes)(Rs,"="))){n.b[31][0]++;var Ns=(n.s[151]++,hi+Rs);n.s[152]++,Je.push({type:Lt,content:Ns}),n.s[153]++,Vt+=1,n.s[154]++;continue}else n.b[31][1]++;var ps=(n.s[155]++,hi.slice(0,-1));n.s[156]++,Je.push({type:Lt,content:ps}),n.s[157]++;continue}else n.b[30][1]++;n.s[158]++,Je.push({type:Lt,content:hi})}}var me=(n.s[159]++,[].push);function Fe(we,He){n.f[13]++;var Me=(n.s[160]++,He),ze=Me.str,Je=Me.position,Ee=Me.tokens,rt=(n.s[161]++,we.toLowerCase()),Ie=(n.s[162]++,ze.length),Re=(n.s[163]++,Je.index);for(n.s[164]++;Re<Ie;){var We=(n.s[165]++,ze.indexOf("</",Re));if(n.s[166]++,We===-1){n.b[33][0]++,n.s[167]++,m(He),n.s[168]++;break}else n.b[33][1]++;var Ve=(n.s[169]++,w(Je));n.s[170]++,p(Ve,ze,We);var Qe=(n.s[171]++,{str:ze,position:Ve,tokens:[]}),Ot=(n.s[172]++,j(Qe));if(n.s[173]++,rt!==Ot.toLowerCase()){n.b[34][0]++,n.s[174]++,Re=Qe.position.index,n.s[175]++;continue}else n.b[34][1]++;if(n.s[176]++,We!==Je.index){n.b[35][0]++;var Tt=(n.s[177]++,w(Je));n.s[178]++,p(Je,ze,We),n.s[179]++,Ee.push({type:"text",content:ze.slice(Tt.index,We),position:{start:Tt,end:w(Je)}})}else n.b[35][1]++;n.s[180]++,me.apply(Ee,Qe.tokens),n.s[181]++,p(Je,ze,Qe.position.index),n.s[182]++;break}}},{"./compat":1}],5:[function(t,i,s){var n=function(){var O="/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/parser.js",T="10fb0478bb046c7059c47c8225586b7e30f48474",z=(function(){}).constructor,U=new z("return this")(),m="__coverage__",Y={path:"/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/parser.js",statementMap:{0:{start:{line:4,column:15},end:{line:4,column:44}},1:{start:{line:5,column:16},end:{line:5,column:59}},2:{start:{line:6,column:2},end:{line:6,column:14}},3:{start:{line:7,column:2},end:{line:7,column:22}},4:{start:{line:11,column:21},end:{line:11,column:39}},5:{start:{line:12,column:2},end:{line:24,column:3}},6:{start:{line:13,column:23},end:{line:13,column:39}},7:{start:{line:14,column:4},end:{line:23,column:5}},8:{start:{line:15,column:28},end:{line:15,column:55}},9:{start:{line:16,column:6},end:{line:18,column:7}},10:{start:{line:17,column:8},end:{line:17,column:13}},11:{start:{line:19,column:6},end:{line:21,column:7}},12:{start:{line:20,column:8},end:{line:20,column:19}},13:{start:{line:22,column:6},end:{line:22,column:20}},14:{start:{line:25,column:2},end:{line:25,column:14}},15:{start:{line:29,column:2},end:{line:29,column:45}},16:{start:{line:30,column:2},end:{line:32,column:3}},17:{start:{line:31,column:4},end:{line:31,column:47}},18:{start:{line:33,column:2},end:{line:33,column:25}},19:{start:{line:37,column:28},end:{line:37,column:33}},20:{start:{line:38,column:16},end:{line:38,column:21}},21:{start:{line:39,column:14},end:{line:39,column:46}},22:{start:{line:40,column:14},end:{line:40,column:27}},23:{start:{line:41,column:17},end:{line:41,column:22}},24:{start:{line:42,column:2},end:{line:132,column:3}},25:{start:{line:43,column:18},end:{line:43,column:32}},26:{start:{line:44,column:4},end:{line:48,column:5}},27:{start:{line:45,column:6},end:{line:45,column:23}},28:{start:{line:46,column:6},end:{line:46,column:14}},29:{start:{line:47,column:6},end:{line:47,column:14}},30:{start:{line:50,column:21},end:{line:50,column:37}},31:{start:{line:51,column:4},end:{line:51,column:12}},32:{start:{line:52,column:20},end:{line:52,column:50}},33:{start:{line:53,column:4},end:{line:73,column:5}},34:{start:{line:54,column:18},end:{line:54,column:30}},35:{start:{line:55,column:25},end:{line:55,column:30}},36:{start:{line:56,column:6},end:{line:61,column:7}},37:{start:{line:57,column:8},end:{line:60,column:9}},38:{start:{line:58,column:10},end:{line:58,column:29}},39:{start:{line:59,column:10},end:{line:59,column:15}},40:{start:{line:62,column:6},end:{line:66,column:7}},41:{start:{line:63,column:25},end:{line:63,column:39}},42:{start:{line:64,column:8},end:{line:64,column:46}},43:{start:{line:64,column:41},end:{line:64,column:46}},44:{start:{line:65,column:8},end:{line:65,column:16}},45:{start:{line:67,column:6},end:{line:72,column:7}},46:{start:{line:68,column:8},end:{line:68,column:88}},47:{start:{line:69,column:8},end:{line:69,column:13}},48:{start:{line:71,column:8},end:{line:71,column:16}},49:{start:{line:75,column:25},end:{line:75,column:68}},50:{start:{line:76,column:34},end:{line:76,column:46}},51:{start:{line:77,column:4},end:{line:80,column:5}},52:{start:{line:78,column:56},end:{line:78,column:63}},53:{start:{line:79,column:6},end:{line:79,column:77}},54:{start:{line:82,column:4},end:{line:95,column:5}},55:{start:{line:85,column:25},end:{line:85,column:41}},56:{start:{line:86,column:6},end:{line:94,column:7}},57:{start:{line:87,column:8},end:{line:92,column:9}},58:{start:{line:88,column:10},end:{line:88,column:86}},59:{start:{line:89,column:32},end:{line:89,column:48}},60:{start:{line:90,column:10},end:{line:90,column:47}},61:{start:{line:91,column:10},end:{line:91,column:15}},62:{start:{line:93,column:8},end:{line:93,column:39}},63:{start:{line:97,column:21},end:{line:97,column:23}},64:{start:{line:99,column:4},end:{line:104,column:5}},65:{start:{line:100,column:6},end:{line:100,column:32}},66:{start:{line:101,column:6},end:{line:101,column:45}},67:{start:{line:101,column:40},end:{line:101,column:45}},68:{start:{line:102,column:6},end:{line:102,column:40}},69:{start:{line:103,column:6},end:{line:103,column:14}},70:{start:{line:106,column:4},end:{line:106,column:12}},71:{start:{line:107,column:21},end:{line:107,column:23}},72:{start:{line:108,column:21},end:{line:111,column:5}},73:{start:{line:112,column:24},end:{line:118,column:5}},74:{start:{line:119,column:4},end:{line:119,column:27}},75:{start:{line:121,column:24},end:{line:121,column:86}},76:{start:{line:122,column:4},end:{line:131,column:5}},77:{start:{line:123,column:19},end:{line:123,column:60}},78:{start:{line:124,column:25},end:{line:124,column:57}},79:{start:{line:125,column:6},end:{line:125,column:23}},80:{start:{line:126,column:6},end:{line:126,column:32}},81:{start:{line:127,column:31},end:{line:127,column:52}},82:{start:{line:128,column:6},end:{line:130,column:7}},83:{start:{line:129,column:8},end:{line:129,column:66}},84:{start:{line:133,column:2},end:{line:133,column:23}}},fnMap:{0:{name:"parser",decl:{start:{line:3,column:24},end:{line:3,column:30}},loc:{start:{line:3,column:49},end:{line:8,column:1}},line:3},1:{name:"hasTerminalParent",decl:{start:{line:10,column:16},end:{line:10,column:33}},loc:{start:{line:10,column:62},end:{line:26,column:1}},line:10},2:{name:"rewindStack",decl:{start:{line:28,column:16},end:{line:28,column:27}},loc:{start:{line:28,column:81},end:{line:34,column:1}},line:28},3:{name:"parse",decl:{start:{line:36,column:16},end:{line:36,column:21}},loc:{start:{line:36,column:30},end:{line:134,column:1}},line:36}},branchMap:{0:{loc:{start:{line:12,column:2},end:{line:24,column:3}},type:"if",locations:[{start:{line:12,column:2},end:{line:24,column:3}},{start:{line:12,column:2},end:{line:24,column:3}}],line:12},1:{loc:{start:{line:16,column:6},end:{line:18,column:7}},type:"if",locations:[{start:{line:16,column:6},end:{line:18,column:7}},{start:{line:16,column:6},end:{line:18,column:7}}],line:16},2:{loc:{start:{line:19,column:6},end:{line:21,column:7}},type:"if",locations:[{start:{line:19,column:6},end:{line:21,column:7}},{start:{line:19,column:6},end:{line:21,column:7}}],line:19},3:{loc:{start:{line:44,column:4},end:{line:48,column:5}},type:"if",locations:[{start:{line:44,column:4},end:{line:48,column:5}},{start:{line:44,column:4},end:{line:48,column:5}}],line:44},4:{loc:{start:{line:53,column:4},end:{line:73,column:5}},type:"if",locations:[{start:{line:53,column:4},end:{line:73,column:5}},{start:{line:53,column:4},end:{line:73,column:5}}],line:53},5:{loc:{start:{line:57,column:8},end:{line:60,column:9}},type:"if",locations:[{start:{line:57,column:8},end:{line:60,column:9}},{start:{line:57,column:8},end:{line:60,column:9}}],line:57},6:{loc:{start:{line:64,column:8},end:{line:64,column:46}},type:"if",locations:[{start:{line:64,column:8},end:{line:64,column:46}},{start:{line:64,column:8},end:{line:64,column:46}}],line:64},7:{loc:{start:{line:67,column:6},end:{line:72,column:7}},type:"if",locations:[{start:{line:67,column:6},end:{line:72,column:7}},{start:{line:67,column:6},end:{line:72,column:7}}],line:67},8:{loc:{start:{line:77,column:4},end:{line:80,column:5}},type:"if",locations:[{start:{line:77,column:4},end:{line:80,column:5}},{start:{line:77,column:4},end:{line:80,column:5}}],line:77},9:{loc:{start:{line:82,column:4},end:{line:95,column:5}},type:"if",locations:[{start:{line:82,column:4},end:{line:95,column:5}},{start:{line:82,column:4},end:{line:95,column:5}}],line:82},10:{loc:{start:{line:87,column:8},end:{line:92,column:9}},type:"if",locations:[{start:{line:87,column:8},end:{line:92,column:9}},{start:{line:87,column:8},end:{line:92,column:9}}],line:87},11:{loc:{start:{line:101,column:6},end:{line:101,column:45}},type:"if",locations:[{start:{line:101,column:6},end:{line:101,column:45}},{start:{line:101,column:6},end:{line:101,column:45}}],line:101},12:{loc:{start:{line:121,column:26},end:{line:121,column:85}},type:"binary-expr",locations:[{start:{line:121,column:26},end:{line:121,column:41}},{start:{line:121,column:45},end:{line:121,column:85}}],line:121},13:{loc:{start:{line:122,column:4},end:{line:131,column:5}},type:"if",locations:[{start:{line:122,column:4},end:{line:131,column:5}},{start:{line:122,column:4},end:{line:131,column:5}}],line:122},14:{loc:{start:{line:128,column:6},end:{line:130,column:7}},type:"if",locations:[{start:{line:128,column:6},end:{line:130,column:7}},{start:{line:128,column:6},end:{line:130,column:7}}],line:128}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0,25:0,26:0,27:0,28:0,29:0,30:0,31:0,32:0,33:0,34:0,35:0,36:0,37:0,38:0,39:0,40:0,41:0,42:0,43:0,44:0,45:0,46:0,47:0,48:0,49:0,50:0,51:0,52:0,53:0,54:0,55:0,56:0,57:0,58:0,59:0,60:0,61:0,62:0,63:0,64:0,65:0,66:0,67:0,68:0,69:0,70:0,71:0,72:0,73:0,74:0,75:0,76:0,77:0,78:0,79:0,80:0,81:0,82:0,83:0,84:0},f:{0:0,1:0,2:0,3:0},b:{0:[0,0],1:[0,0],2:[0,0],3:[0,0],4:[0,0],5:[0,0],6:[0,0],7:[0,0],8:[0,0],9:[0,0],10:[0,0],11:[0,0],12:[0,0],13:[0,0],14:[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},j=U[m]||(U[m]={});return j[O]&&j[O].hash===T?j[O]:(Y.hash=T,j[O]=Y)}();Object.defineProperty(s,"__esModule",{value:!0}),s.default=c,s.hasTerminalParent=p,s.rewindStack=f,s.parse=w;var o=t("./compat");function c(O,T){n.f[0]++;var z=(n.s[0]++,{tagName:null,children:[]}),U=(n.s[1]++,{tokens:O,options:T,cursor:0,stack:[z]});return n.s[2]++,w(U),n.s[3]++,z.children}function p(O,T,z){n.f[1]++;var U=(n.s[4]++,z[O]);if(n.s[5]++,U){n.b[0][0]++;var m=(n.s[6]++,T.length-1);for(n.s[7]++;m>=0;){var Y=(n.s[8]++,T[m].tagName);if(n.s[9]++,Y===O){n.b[1][0]++,n.s[10]++;break}else n.b[1][1]++;if(n.s[11]++,(0,o.arrayIncludes)(U,Y))return n.b[2][0]++,n.s[12]++,!0;n.b[2][1]++,n.s[13]++,m--}}else n.b[0][1]++;return n.s[14]++,!1}function f(O,T,z,U){n.f[2]++,n.s[15]++,O[T].position.end=U,n.s[16]++;for(var m=T+1,Y=O.length;m<Y;m++)n.s[17]++,O[m].position.end=z;n.s[18]++,O.splice(T)}function w(O){n.f[3]++;var T=(n.s[19]++,O),z=T.tokens,U=T.options,m=(n.s[20]++,O),Y=m.stack,j=(n.s[21]++,Y[Y.length-1].children),le=(n.s[22]++,z.length),xe=(n.s[23]++,O),ce=xe.cursor;for(n.s[24]++;ce<le;){var ne=(n.s[25]++,z[ce]);if(n.s[26]++,ne.type!=="tag-start"){n.b[3][0]++,n.s[27]++,j.push(ne),n.s[28]++,ce++,n.s[29]++;continue}else n.b[3][1]++;var me=(n.s[30]++,z[++ce]);n.s[31]++,ce++;var Fe=(n.s[32]++,me.content.toLowerCase());if(n.s[33]++,ne.close){n.b[4][0]++;var we=(n.s[34]++,Y.length),He=(n.s[35]++,!1);for(n.s[36]++;--we>-1;)if(n.s[37]++,Y[we].tagName===Fe){n.b[5][0]++,n.s[38]++,He=!0,n.s[39]++;break}else n.b[5][1]++;for(n.s[40]++;ce<le;){var Me=(n.s[41]++,z[ce]);if(n.s[42]++,Me.type!=="tag-end"){n.b[6][0]++,n.s[43]++;break}else n.b[6][1]++;n.s[44]++,ce++}if(n.s[45]++,He){n.b[7][0]++,n.s[46]++,f(Y,we,ne.position.start,z[ce-1].position.end),n.s[47]++;break}else{n.b[7][1]++,n.s[48]++;continue}}else n.b[4][1]++;var ze=(n.s[49]++,(0,o.arrayIncludes)(U.closingTags,Fe)),Je=(n.s[50]++,ze);if(n.s[51]++,Je){n.b[8][0]++;var Ee=(n.s[52]++,U),rt=Ee.closingTagAncestorBreakers;n.s[53]++,Je=!p(Fe,Y,rt)}else n.b[8][1]++;if(n.s[54]++,Je){n.b[9][0]++;var Ie=(n.s[55]++,Y.length-1);for(n.s[56]++;Ie>0;){if(n.s[57]++,Fe===Y[Ie].tagName){n.b[10][0]++,n.s[58]++,f(Y,Ie,ne.position.start,ne.position.start);var Re=(n.s[59]++,Ie-1);n.s[60]++,j=Y[Re].children,n.s[61]++;break}else n.b[10][1]++;n.s[62]++,Ie=Ie-1}}else n.b[9][1]++;var We=(n.s[63]++,[]),Ve=void 0;for(n.s[64]++;ce<le;){if(n.s[65]++,Ve=z[ce],n.s[66]++,Ve.type==="tag-end"){n.b[11][0]++,n.s[67]++;break}else n.b[11][1]++;n.s[68]++,We.push(Ve.content),n.s[69]++,ce++}n.s[70]++,ce++;var Qe=(n.s[71]++,[]),Ot=(n.s[72]++,{start:ne.position.start,end:Ve.position.end}),Tt=(n.s[73]++,{type:"element",tagName:me.content,attributes:We,children:Qe,position:Ot});n.s[74]++,j.push(Tt);var ot=(n.s[75]++,n.b[12][0]++,!(Ve.close||(n.b[12][1]++,(0,o.arrayIncludes)(U.voidTags,Fe))));if(n.s[76]++,ot){n.b[13][0]++;var gt=(n.s[77]++,Y.push({tagName:Fe,children:Qe,position:Ot})),Lt=(n.s[78]++,{tokens:z,options:U,cursor:ce,stack:Y});n.s[79]++,w(Lt),n.s[80]++,ce=Lt.cursor;var Vt=(n.s[81]++,Y.length===gt);n.s[82]++,Vt?(n.b[14][0]++,n.s[83]++,Tt.position.end=z[ce-1].position.end):n.b[14][1]++}else n.b[13][1]++}n.s[84]++,O.cursor=ce}},{"./compat":1}],6:[function(t,i,s){var n=function(){var f="/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/stringify.js",w="4a6a4628f3d12bd91f868fee07f716c74df89307",O=(function(){}).constructor,T=new O("return this")(),z="__coverage__",U={path:"/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/stringify.js",statementMap:{0:{start:{line:4,column:2},end:{line:12,column:8}},1:{start:{line:5,column:25},end:{line:5,column:34}},2:{start:{line:6,column:4},end:{line:8,column:5}},3:{start:{line:7,column:6},end:{line:7,column:30}},4:{start:{line:9,column:24},end:{line:9,column:50}},5:{start:{line:10,column:18},end:{line:10,column:42}},6:{start:{line:11,column:4},end:{line:11,column:53}},7:{start:{line:16,column:2},end:{line:28,column:13}},8:{start:{line:17,column:4},end:{line:19,column:5}},9:{start:{line:18,column:6},end:{line:18,column:25}},10:{start:{line:20,column:4},end:{line:22,column:5}},11:{start:{line:21,column:6},end:{line:21,column:37}},12:{start:{line:23,column:44},end:{line:23,column:48}},13:{start:{line:24,column:26},end:{line:24,column:80}},14:{start:{line:25,column:4},end:{line:27,column:94}}},fnMap:{0:{name:"formatAttributes",decl:{start:{line:3,column:16},end:{line:3,column:32}},loc:{start:{line:3,column:46},end:{line:13,column:1}},line:3},1:{name:"(anonymous_1)",decl:{start:{line:4,column:27},end:{line:4,column:28}},loc:{start:{line:4,column:49},end:{line:12,column:3}},line:4},2:{name:"toHTML",decl:{start:{line:15,column:16},end:{line:15,column:22}},loc:{start:{line:15,column:39},end:{line:29,column:1}},line:15},3:{name:"(anonymous_3)",decl:{start:{line:16,column:18},end:{line:16,column:19}},loc:{start:{line:16,column:26},end:{line:28,column:3}},line:16}},branchMap:{0:{loc:{start:{line:6,column:4},end:{line:8,column:5}},type:"if",locations:[{start:{line:6,column:4},end:{line:8,column:5}},{start:{line:6,column:4},end:{line:8,column:5}}],line:6},1:{loc:{start:{line:10,column:18},end:{line:10,column:42}},type:"cond-expr",locations:[{start:{line:10,column:32},end:{line:10,column:35}},{start:{line:10,column:38},end:{line:10,column:42}}],line:10},2:{loc:{start:{line:17,column:4},end:{line:19,column:5}},type:"if",locations:[{start:{line:17,column:4},end:{line:19,column:5}},{start:{line:17,column:4},end:{line:19,column:5}}],line:17},3:{loc:{start:{line:20,column:4},end:{line:22,column:5}},type:"if",locations:[{start:{line:20,column:4},end:{line:22,column:5}},{start:{line:20,column:4},end:{line:22,column:5}}],line:20},4:{loc:{start:{line:25,column:11},end:{line:27,column:94}},type:"cond-expr",locations:[{start:{line:26,column:8},end:{line:26,column:53}},{start:{line:27,column:8},end:{line:27,column:94}}],line:25}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0},f:{0:0,1:0,2:0,3:0},b:{0:[0,0],1:[0,0],2:[0,0],3:[0,0],4:[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},m=T[z]||(T[z]={});return m[f]&&m[f].hash===w?m[f]:(U.hash=w,m[f]=U)}();Object.defineProperty(s,"__esModule",{value:!0}),s.formatAttributes=c,s.toHTML=p;var o=t("./compat");function c(f){return n.f[0]++,n.s[0]++,f.reduce(function(w,O){n.f[1]++;var T=(n.s[1]++,O),z=T.key,U=T.value;if(n.s[2]++,U===null)return n.b[0][0]++,n.s[3]++,w+" "+z;n.b[0][1]++;var m=(n.s[4]++,U.indexOf("'")!==-1),Y=(n.s[5]++,m?(n.b[1][0]++,'"'):(n.b[1][1]++,"'"));return n.s[6]++,w+" "+z+"="+Y+U+Y},"")}function p(f,w){return n.f[2]++,n.s[7]++,f.map(function(O){if(n.f[3]++,n.s[8]++,O.type==="text")return n.b[2][0]++,n.s[9]++,O.content;if(n.b[2][1]++,n.s[10]++,O.type==="comment")return n.b[3][0]++,n.s[11]++,"<!--"+O.content+"-->";n.b[3][1]++;var T=(n.s[12]++,O),z=T.tagName,U=T.attributes,m=T.children,Y=(n.s[13]++,(0,o.arrayIncludes)(w.voidTags,z.toLowerCase()));return n.s[14]++,Y?(n.b[4][0]++,"<"+z+c(U)+">"):(n.b[4][1]++,"<"+z+c(U)+">"+p(m,w)+"</"+z+">")}).join("")}s.default={toHTML:p}},{"./compat":1}],7:[function(t,i,s){var n=function(){var o="/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/tags.js",c="6039b9f65d15797c952509955976acf6930e65a4",p=(function(){}).constructor,f=new p("return this")(),w="__coverage__",O={path:"/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/tags.js",statementMap:{0:{start:{line:5,column:29},end:{line:5,column:60}},1:{start:{line:11,column:27},end:{line:14,column:1}},2:{start:{line:23,column:42},end:{line:32,column:1}},3:{start:{line:38,column:24},end:{line:42,column:1}}},fnMap:{},branchMap:{},s:{0:0,1:0,2:0,3:0},f:{},b:{},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},T=f[w]||(f[w]={});return T[o]&&T[o].hash===c?T[o]:(O.hash=c,T[o]=O)}();Object.defineProperty(s,"__esModule",{value:!0}),s.childlessTags=(n.s[0]++,["style","script","template"]),s.closingTags=(n.s[1]++,["html","head","body","p","dt","dd","li","option","thead","th","tbody","tr","td","tfoot","colgroup"]),s.closingTagAncestorBreakers=(n.s[2]++,{li:["ul","ol","menu"],dt:["dl"],dd:["dl"],tbody:["table"],thead:["table"],tfoot:["table"],tr:["table"],td:["table"]}),s.voidTags=(n.s[3]++,["!doctype","area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"])},{}]},{},[3])(3)})})();self.phet.chipper.packageObject={name:"scenery-lab-demo"};self.phet.chipper.stringRepos=[{repo:"joist",requirejsNamespace:"JOIST"},{repo:"scenery-phet",requirejsNamespace:"SCENERY_PHET"},{repo:"sun",requirejsNamespace:"SUN"},{repo:"tambo",requirejsNamespace:"TAMBO"},{repo:"vegas",requirejsNamespace:"VEGAS"}];self.phet.chipper.strings={en:{a11y:{numberSpinnerRoleDescription:{value:"number spinner"},close:{value:"Close"},closed:{value:"Closed"},titleClosePattern:{value:"{{title}}, Close."}}}};self.phet.chipper.localeData={en:{locale3:"eng",englishName:"English",localizedName:"English",direction:"ltr"}};self.sceneryLog=null;const Of=document.createElement("canvas"),y_=Of.getContext("2d");let vo="";const te=new Mh("scenery");te.register("scratchCanvas",Of);te.register("scratchContext",y_);function b_(h){te.logString+=`${h.replace(/%c/g,"")}
`}function __(...h){self.console&&self.console.log&&self.console.log(...Array.prototype.slice.call(h,0))}const zg={dirty:{name:"dirty",style:"color: #888;"},bounds:{name:"bounds",style:"color: #888;"},hitTest:{name:"hitTest",style:"color: #888;"},hitTestInternal:{name:"hitTestInternal",style:"color: #888;"},PerfCritical:{name:"Perf",style:"color: #f00;"},PerfMajor:{name:"Perf",style:"color: #aa0;"},PerfMinor:{name:"Perf",style:"color: #088;"},PerfVerbose:{name:"Perf",style:"color: #888;"},Cursor:{name:"Cursor",style:""},Stitch:{name:"Stitch",style:""},StitchDrawables:{name:"Stitch",style:""},GreedyStitcher:{name:"Greedy",style:"color: #088;"},GreedyVerbose:{name:"Greedy",style:"color: #888;"},RelativeTransform:{name:"RelativeTransform",style:"color: #606;"},BackboneDrawable:{name:"Backbone",style:"color: #a00;"},CanvasBlock:{name:"Canvas",style:""},WebGLBlock:{name:"WebGL",style:""},Display:{name:"Display",style:""},DOMBlock:{name:"DOM",style:""},Drawable:{name:"",style:""},FittedBlock:{name:"FittedBlock",style:""},Instance:{name:"Instance",style:""},InstanceTree:{name:"InstanceTree",style:""},ChangeInterval:{name:"ChangeInterval",style:"color: #0a0;"},SVGBlock:{name:"SVG",style:""},SVGGroup:{name:"SVGGroup",style:""},ImageSVGDrawable:{name:"ImageSVGDrawable",style:""},Paints:{name:"Paints",style:""},Filters:{name:"Filters",style:""},AlignBox:{name:"AlignBox",style:""},AlignGroup:{name:"AlignGroup",style:""},RichText:{name:"RichText",style:""},Sim:{name:"Sim",style:""},ParallelDOM:{name:"ParallelDOM",style:""},PDOMInstance:{name:"PDOMInstance",style:""},PDOMTree:{name:"PDOMTree",style:""},PDOMDisplaysInfo:{name:"PDOMDisplaysInfo",style:""},KeyboardFuzzer:{name:"KeyboardFuzzer",style:""},InputListener:{name:"InputListener",style:""},InputEvent:{name:"InputEvent",style:""},OnInput:{name:"OnInput",style:""},Pointer:{name:"Pointer",style:""},Input:{name:"Input",style:""},EventDispatch:{name:"EventDispatch",style:""},EventPath:{name:"EventPath",style:""}};bb(te,{logString:"",logFunction:function(...h){self.console&&self.console.log&&self.console.log(...Array.prototype.slice.call(h,0))},switchLogToConsole:function(){te.logFunction=__},switchLogToString:function(){self.console&&self.console.log("switching to string log"),te.logFunction=b_},enableIndividualLog:function(h){if(h==="stitch"){this.enableIndividualLog("Stitch"),this.enableIndividualLog("StitchDrawables"),this.enableIndividualLog("GreedyStitcher"),this.enableIndividualLog("GreedyVerbose");return}if(h==="perf"){this.enableIndividualLog("PerfCritical"),this.enableIndividualLog("PerfMajor"),this.enableIndividualLog("PerfMinor"),this.enableIndividualLog("PerfVerbose");return}if(h==="input"){this.enableIndividualLog("InputListener"),this.enableIndividualLog("InputEvent"),this.enableIndividualLog("OnInput"),this.enableIndividualLog("Pointer"),this.enableIndividualLog("Input"),this.enableIndividualLog("EventDispatch"),this.enableIndividualLog("EventPath");return}if(h==="a11y"||h==="pdom"){this.enableIndividualLog("ParallelDOM"),this.enableIndividualLog("PDOMInstance"),this.enableIndividualLog("PDOMTree"),this.enableIndividualLog("PDOMDisplaysInfo");return}h&&(assert&&assert(zg[h],`Unknown logger: ${h}, please use periods (.) to separate different log names`),self.sceneryLog[h]=self.sceneryLog[h]||function(e,t){const i=zg[h],s=i.name?`[${i.name}] `:"";te.logFunction(`%c${vo}%c${s}${e}`,"color: #ddd;",t||i.style)})},disableIndividualLog:function(h){h&&delete self.sceneryLog[h]},enableLogging:function(h){self.sceneryLog=function(e){te.logFunction(e)},self.sceneryLog.push=function(){vo+="| "},self.sceneryLog.pop=function(){vo=vo.slice(0,-2)},self.sceneryLog.getDepth=function(){return vo.length/2};for(let e=0;e<h.length;e++)this.enableIndividualLog(h[e])},disableLogging:function(){self.sceneryLog=null},isLoggingPerformance:function(){return self.sceneryLog.PerfCritical||self.sceneryLog.PerfMajor||self.sceneryLog.PerfMinor||self.sceneryLog.PerfVerbose}});const Er={DISABLED_OPACITY:.45,DEFAULT_COLOR_PROFILE:"default",PROJECTOR_COLOR_PROFILE:"projector"};te.register("SceneryConstants",Er);const Jr=ct.clamp,Kl=ct.linear,wa="(-?\\d{1,3}%?)",$g="(\\d+|\\d*\\.\\d+)",Ca="(\\d{1,3})";function Ta(h){let e=1;return h.endsWith("%")&&(e=2.55,h=h.slice(0,h.length-1)),ct.roundSymmetric(Number(h)*e)}const Gt=class Gt{constructor(e,t,i,s){this.changeEmitter=new ri,this.set(e,t,i,s)}copy(){return new Gt(this.r,this.g,this.b,this.a)}set(e,t,i,s){if(assert&&assert(e!==void 0,"Can't call Color.set( undefined )"),e===null)this.setRGBA(0,0,0,0);else if(typeof e=="string")this.setCSS(e);else if(e instanceof Gt)this.setRGBA(e.r,e.g,e.b,e.a);else if(i===void 0){assert&&assert(t===void 0||typeof t=="number");const n=e>>16&255,o=e>>8&255,c=e>>0&255,p=t===void 0?1:t;this.setRGBA(n,o,c,p)}else assert&&assert(s===void 0||typeof s=="number"),this.setRGBA(e,t,i,s===void 0?1:s);return this}getRed(){return this.r}get red(){return this.getRed()}set red(e){this.setRed(e)}setRed(e){return this.setRGBA(e,this.g,this.b,this.a)}getGreen(){return this.g}get green(){return this.getGreen()}set green(e){this.setGreen(e)}setGreen(e){return this.setRGBA(this.r,e,this.b,this.a)}getBlue(){return this.b}get blue(){return this.getBlue()}set blue(e){this.setBlue(e)}setBlue(e){return this.setRGBA(this.r,this.g,e,this.a)}getAlpha(){return this.a}get alpha(){return this.getAlpha()}set alpha(e){this.setAlpha(e)}setAlpha(e){return this.setRGBA(this.r,this.g,this.b,e)}setRGBA(e,t,i,s){return this.r=ct.roundSymmetric(Jr(e,0,255)),this.g=ct.roundSymmetric(Jr(t,0,255)),this.b=ct.roundSymmetric(Jr(i,0,255)),this.a=Jr(s,0,1),this.updateColor(),this}blend(e,t){const s=Math.pow(this.r,2.4),n=Math.pow(e.r,2.4),o=Math.pow(this.g,2.4),c=Math.pow(e.g,2.4),p=Math.pow(this.b,2.4),f=Math.pow(e.b,2.4),w=Math.pow(s+(n-s)*t,1/2.4),O=Math.pow(o+(c-o)*t,1/2.4),T=Math.pow(p+(f-p)*t,1/2.4),z=this.a+(e.a-this.a)*t;return new Gt(w,O,T,z)}computeCSS(){if(this.a===1)return`rgb(${this.r},${this.g},${this.b})`;{let e=this.a.toFixed(20);for(;e.length>=2&&e.endsWith("0")&&e[e.length-2]!==".";)e=e.slice(0,e.length-1);const t=this.a===0||this.a===1?this.a:e;return`rgba(${this.r},${this.g},${this.b},${t})`}}toCSS(){return assert&&assert(this._css===this.computeCSS(),`CSS cached value is ${this._css}, but the computed value appears to be ${this.computeCSS()}`),this._css}setCSS(e){let t=!1;const i=Gt.preprocessCSS(e);for(let s=0;s<Gt.formatParsers.length;s++){const n=Gt.formatParsers[s],o=n.regexp.exec(i);if(o){n.apply(this,o),t=!0;break}}if(!t)throw new Error(`Color unable to parse color string: ${e}`);return this.updateColor(),this}toNumber(){return(this.r<<16)+(this.g<<8)+this.b}updateColor(){assert&&assert(!this.immutable,"Cannot modify an immutable color. Likely caused by trying to mutate a color after it was used for a node fill/stroke"),assert&&assert(typeof this.red=="number"&&typeof this.green=="number"&&typeof this.blue=="number"&&typeof this.alpha=="number",`Ensure color components are numeric: ${this.toString()}`),assert&&assert(isFinite(this.red)&&isFinite(this.green)&&isFinite(this.blue)&&isFinite(this.alpha),"Ensure color components are finite and not NaN"),assert&&assert(this.red>=0&&this.red<=255&&this.green>=0&&this.green<=255&&this.red>=0&&this.red<=255&&this.alpha>=0&&this.alpha<=1,`Ensure color components are in the proper ranges: ${this.toString()}`);const e=this._css;this._css=this.computeCSS(),e!==this._css&&this.changeEmitter.emit()}setImmutable(){return assert&&(this.immutable=!0),this}getCanvasStyle(){return this.toCSS()}setHSLA(e,t,i,s){e=e%360/360,t=Jr(t/100,0,1),i=Jr(i/100,0,1);let n;i<.5?n=i*(t+1):n=i+t-i*t;const o=i*2-n;return this.r=ct.roundSymmetric(Gt.hueToRGB(o,n,e+1/3)*255),this.g=ct.roundSymmetric(Gt.hueToRGB(o,n,e)*255),this.b=ct.roundSymmetric(Gt.hueToRGB(o,n,e-1/3)*255),this.a=Jr(s,0,1),this.updateColor(),this}equals(e){return this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a}withAlpha(e){return new Gt(this.r,this.g,this.b,e)}checkFactor(e){return assert&&assert(e===void 0||e>=0&&e<=1,`factor must be between 0 and 1: ${e}`),e===void 0?.7:e}brighterColor(e){e=this.checkFactor(e);const t=Math.min(255,Math.floor(this.r/e)),i=Math.min(255,Math.floor(this.g/e)),s=Math.min(255,Math.floor(this.b/e));return new Gt(t,i,s,this.a)}colorUtilsBrighter(e){e=this.checkFactor(e);const t=Math.min(255,this.getRed()+Math.floor(e*(255-this.getRed()))),i=Math.min(255,this.getGreen()+Math.floor(e*(255-this.getGreen()))),s=Math.min(255,this.getBlue()+Math.floor(e*(255-this.getBlue())));return new Gt(t,i,s,this.getAlpha())}darkerColor(e){e=this.checkFactor(e);const t=Math.max(0,Math.floor(e*this.r)),i=Math.max(0,Math.floor(e*this.g)),s=Math.max(0,Math.floor(e*this.b));return new Gt(t,i,s,this.a)}colorUtilsDarker(e){e=this.checkFactor(e);const t=Math.max(0,this.getRed()-Math.floor(e*this.getRed())),i=Math.max(0,this.getGreen()-Math.floor(e*this.getGreen())),s=Math.max(0,this.getBlue()-Math.floor(e*this.getBlue()));return new Gt(t,i,s,this.getAlpha())}colorUtilsBrightness(e){return e===0?this:e>0?this.colorUtilsBrighter(e):this.colorUtilsDarker(-e)}toString(){return`${this.constructor.name}[r:${this.r} g:${this.g} b:${this.b} a:${this.a}]`}toHexString(){let e=this.toNumber().toString(16);for(;e.length<6;)e=`0${e}`;return`#${e}`}toStateObject(){return{r:this.r,g:this.g,b:this.b,a:this.a}}static hueToRGB(e,t,i){return i<0&&(i=i+1),i>1&&(i=i-1),i*6<1?e+(t-e)*i*6:i*2<1?t:i*3<2?e+(t-e)*(2/3-i)*6:e}static toColor(e){return e===null?Gt.TRANSPARENT:e instanceof Gt?e:typeof e=="string"?new Gt(e):Gt.toColor(e.value)}static interpolateRGBA(e,t,i){if(i<0||i>1)throw new Error(`distance must be between 0 and 1: ${i}`);const s=Math.floor(Kl(0,1,e.r,t.r,i)),n=Math.floor(Kl(0,1,e.g,t.g,i)),o=Math.floor(Kl(0,1,e.b,t.b,i)),c=Kl(0,1,e.a,t.a,i);return new Gt(s,n,o,c)}static supersampleBlend(e){const i=e.map(T=>Math.pow(T.r/255,2.2)),s=e.map(T=>Math.pow(T.g/255,2.2)),n=e.map(T=>Math.pow(T.b/255,2.2)),o=e.map(T=>Math.pow(T.a,2.2)),c=_.sum(o);if(c===0)return new Gt(0,0,0,0);const p=_.sum(_.range(0,e.length).map(T=>i[T]*o[T]))/c,f=_.sum(_.range(0,e.length).map(T=>s[T]*o[T]))/c,w=_.sum(_.range(0,e.length).map(T=>n[T]*o[T]))/c,O=c/e.length;return new Gt(Math.floor(Math.pow(p,1/2.2)*255),Math.floor(Math.pow(f,1/2.2)*255),Math.floor(Math.pow(w,1/2.2)*255),Math.pow(O,1/2.2))}static fromStateObject(e){return new Gt(e.r,e.g,e.b,e.a)}static hsla(e,t,i,s){return new Gt(0,0,0,1).setHSLA(e,t,i,s)}static checkPaintString(e){if(assert)try{v_.setCSS(e)}catch{assert(!1,`The CSS string is an invalid color: ${e}`)}}static checkPaint(e){typeof e=="string"?Gt.checkPaintString(e):ft(e)&&typeof e.value=="string"&&Gt.checkPaintString(e.value)}static getLuminance(e){const t=Gt.toColor(e),i=t.red*.2126+t.green*.7152+t.blue*.0722;return assert&&assert(i>=0&&i<=255,`unexpected luminance: ${i}`),i}static toGrayscale(e){const t=Gt.getLuminance(e);return new Gt(t,t,t)}static isDarkColor(e,t=186){return assert&&assert(t>=0&&t<=255,"invalid luminanceThreshold"),Gt.getLuminance(e)<t}static isLightColor(e,t){return!Gt.isDarkColor(e,t)}static grayColor(e,t){return new Gt(e,e,e,t)}static preprocessCSS(e){let t=e.replace(/ /g,"").toLowerCase();const i=Gt.colorKeywords[t];return i&&(t=`#${i}`),t}static isCSSColorString(e){const t=Gt.preprocessCSS(e);for(let i=0;i<Gt.formatParsers.length;i++)if(Gt.formatParsers[i].regexp.exec(t))return!0;return!1}};Gt.formatParsers=[{regexp:/^transparent$/,apply:(e,t)=>{e.setRGBA(0,0,0,0)}},{regexp:/^#(\w{1})(\w{1})(\w{1})$/,apply:(e,t)=>{e.setRGBA(parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),1)}},{regexp:/^#(\w{2})(\w{2})(\w{2})$/,apply:(e,t)=>{e.setRGBA(parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),1)}},{regexp:new RegExp(`^rgb\\(${wa},${wa},${wa}\\)$`),apply:(e,t)=>{e.setRGBA(Ta(t[1]),Ta(t[2]),Ta(t[3]),1)}},{regexp:new RegExp(`^rgba\\(${wa},${wa},${wa},${$g}\\)$`),apply:(e,t)=>{e.setRGBA(Ta(t[1]),Ta(t[2]),Ta(t[3]),Number(t[4]))}},{regexp:new RegExp(`^hsl\\(${Ca},${Ca}%,${Ca}%\\)$`),apply:(e,t)=>{e.setHSLA(Number(t[1]),Number(t[2]),Number(t[3]),1)}},{regexp:new RegExp(`^hsla\\(${Ca},${Ca}%,${Ca}%,${$g}\\)$`),apply:(e,t)=>{e.setHSLA(Number(t[1]),Number(t[2]),Number(t[3]),Number(t[4]))}}],Gt.basicColorKeywords={aqua:"00ffff",black:"000000",blue:"0000ff",fuchsia:"ff00ff",gray:"808080",green:"008000",lime:"00ff00",maroon:"800000",navy:"000080",olive:"808000",purple:"800080",red:"ff0000",silver:"c0c0c0",teal:"008080",white:"ffffff",yellow:"ffff00"},Gt.colorKeywords={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"778899",lightslategrey:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};let qe=Gt;te.register("Color",qe);qe.BLACK=qe.black=new qe(0,0,0).setImmutable();qe.BLUE=qe.blue=new qe(0,0,255).setImmutable();qe.CYAN=qe.cyan=new qe(0,255,255).setImmutable();qe.DARK_GRAY=qe.darkGray=new qe(64,64,64).setImmutable();qe.GRAY=qe.gray=new qe(128,128,128).setImmutable();qe.GREEN=qe.green=new qe(0,255,0).setImmutable();qe.LIGHT_GRAY=qe.lightGray=new qe(192,192,192).setImmutable();qe.MAGENTA=qe.magenta=new qe(255,0,255).setImmutable();qe.ORANGE=qe.orange=new qe(255,200,0).setImmutable();qe.PINK=qe.pink=new qe(255,175,175).setImmutable();qe.RED=qe.red=new qe(255,0,0).setImmutable();qe.WHITE=qe.white=new qe(255,255,255).setImmutable();qe.YELLOW=qe.yellow=new qe(255,255,0).setImmutable();qe.TRANSPARENT=qe.transparent=new qe(0,0,0,0).setImmutable();const v_=new qe("blue");qe.ColorIO=new Ai("ColorIO",{valueType:qe,documentation:"A color, with rgba",toStateObject:h=>h.toStateObject(),fromStateObject:h=>new qe(h.r,h.g,h.b,h.a),stateSchema:{r:Ut,g:Ut,b:Ut,a:Ut}});const ht={};te.register("Features",ht);function Bh(h){try{const e=document.createElement("canvas");e.width=1,e.height=1;const t=e.getContext("2d");t.fillStyle="black",t.fillRect(0,0,1,1);const i=e.toDataURL([h]),s=`data:${h}`;return i.slice(0,s.length)===s}catch{return!1}}function Fh(h,e){const t=document.createElement("canvas");t.width=1,t.height=1;const i=t.getContext("2d"),s=document.createElement("img");s.crossOrigin="Anonymous";const n=()=>{try{i.drawImage(s,0,0),t.toDataURL(),ht[h]=!0}catch{ht[h]=!1}};s.onload=n;try{s.src=e,s.complete&&n()}catch{ht[h]=!1}}ht.canvasPNGOutput=Bh("image/png");ht.canvasJPEGOutput=Bh("image/jpeg");ht.canvasGIFOutput=Bh("image/gif");ht.canvasICONOutput=Bh("image/x-icon");Fh("canvasPNGInput","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQIW2NkYGD4DwABCQEBtxmN7wAAAABJRU5ErkJggg==");Fh("canvasJPEGInput","data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAMCAgICAgMCAgIDAwMDBAYEBAQEBAgGBgUGCQgKCgkICQkKDA8MCgsOCwkJDRENDg8QEBEQCgwSExIQEw8QEBD/2wBDAQMDAwQDBAgEBAgQCwkLEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBD/wAARCAABAAEDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD8qqKKKAP/2Q==");Fh("canvasSVGInput","data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIj8+DQo8c3ZnIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2aWV3cG9ydD0iMCAwIDEgMSIgd2lkdGg9IjEiIGhlaWdodD0iMSIgPg0KICA8cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMSIgaGVpZ2h0PSIxIiByeD0iMCIgcnk9IjAiIHN0eWxlPSJmaWxsOiBibGFjazsgc3Ryb2tlOiBub25lOyI+PC9yZWN0Pg0KPC9zdmc+DQo=");Fh("canvasGIFInput","data:image/gif;base64,R0lGODlhAQABAJEAAAAAAP///////wAAACH5BAEAAAIALAAAAAABAAEAAAICRAEAOw==");const Mf=document.createElement("canvas"),Dl=Mf.getContext("2d");ht.toDataURLHD=Ci(Mf,"toDataURLHD");ht.createImageDataHD=Ci(Dl,"createImageDataHD");ht.getImageDataHD=Ci(Dl,"getImageDataHD");ht.putImageDataHD=Ci(Dl,"putImageDataHD");ht.currentTransform=Ci(Dl,"currentTransform");ht.canvasFilter=Ci(Dl,"filter");const Ju=document.createElement("span"),Kn=document.createElement("div");ht.textStroke=Ci(Ju.style,"textStroke");ht.textStrokeColor=Ci(Ju.style,"textStrokeColor");ht.textStrokeWidth=Ci(Ju.style,"textStrokeWidth");ht.transform=Ci(Kn.style,"transform");ht.transformOrigin=Ci(Kn.style,"transformOrigin");ht.backfaceVisibility=Ci(Kn.style,"backfaceVisibility");ht.borderRadius=Ci(Kn.style,"borderRadius");ht.userSelect=Ci(Kn.style,"userSelect");ht.touchAction=Ci(Kn.style,"touchAction");ht.touchCallout=Ci(Kn.style,"touchCallout");ht.userDrag=Ci(Kn.style,"userDrag");ht.tapHighlightColor=Ci(Kn.style,"tapHighlightColor");ht.fontSmoothing=Ci(Kn.style,"fontSmoothing");ht.requestAnimationFrame=Ci(self,"requestAnimationFrame");ht.cancelAnimationFrame=Ci(self,"cancelAnimationFrame");ht.setStyle=(h,e,t)=>{e!==void 0&&(h.style[e]=t)};ht.passive=!1;self.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>{ht.passive=!0}}));const Gg=["normal","italic","oblique"],Wg=["normal","small-caps"],Ug=["normal","bold","bolder","lighter","100","200","300","400","500","600","700","800","900"],Yg=["normal","ultra-condensed","extra-condensed","condensed","semi-condensed","semi-expanded","expanded","extra-expanded","ultra-expanded"],cn=class cn extends Hi{constructor(e){assert&&assert(e===void 0||typeof e=="object"&&Object.getPrototypeOf(e)===Object.prototype,"options, if provided, should be a raw object");const t=st()({style:"normal",variant:"normal",weight:"normal",stretch:"normal",size:"10px",lineHeight:"normal",family:"sans-serif",phetioType:cn.FontIO},e);assert&&assert(typeof t.weight=="string"||typeof t.weight=="number","Font weight should be specified as a string or number"),assert&&assert(typeof t.size=="string"||typeof t.size=="number","Font size should be specified as a string or number"),super(t),this._style=t.style,this._variant=t.variant,this._weight=`${t.weight}`,this._stretch=t.stretch,this._size=cn.castSize(t.size),this._lineHeight=t.lineHeight,this._family=t.family,assert&&assert(typeof this._style=="string"&&_.includes(Gg,this._style),'Font style must be one of "normal", "italic", or "oblique"'),assert&&assert(typeof this._variant=="string"&&_.includes(Wg,this._variant),'Font variant must be "normal" or "small-caps"'),assert&&assert(typeof this._weight=="string"&&_.includes(Ug,this._weight),'Font weight must be one of "normal", "bold", "bolder", "lighter", "100", "200", "300", "400", "500", "600", "700", "800", or "900"'),assert&&assert(typeof this._stretch=="string"&&_.includes(Yg,this._stretch),'Font stretch must be one of "normal", "ultra-condensed", "extra-condensed", "condensed", "semi-condensed", "semi-expanded", "expanded", "extra-expanded", or "ultra-expanded"'),assert&&assert(typeof this._size=="string"&&!_.includes(["0","1","2","3","4","5","6","7","8","9"],this._size[this._size.length-1]),"Font size must be either passed as a number (not a string, interpreted as px), or must contain a suffix for percentage, absolute or relative units, or an explicit size constant"),assert&&assert(typeof this._lineHeight=="string"),assert&&assert(typeof this._family=="string"),this._font=this.computeShorthand()}getFont(){return this._font}get font(){return this.getFont()}getStyle(){return this._style}get style(){return this.getStyle()}getVariant(){return this._variant}get variant(){return this.getVariant()}getWeight(){return this._weight}get weight(){return this.getWeight()}getStretch(){return this._stretch}get stretch(){return this.getStretch()}getSize(){return this._size}get size(){return this.getSize()}getNumericSize(){const e=this._size.match(/^(\d+)px$/);if(e)return Number(e[1]);const t=this._size.match(/^(\d+)pt$/);if(t)return .75*Number(t[1]);const i=this._size.match(/^(\d+)em$/);return i?Number(i[1])/16:12}get numericSize(){return this.getNumericSize()}getLineHeight(){return this._lineHeight}get lineHeight(){return this.getLineHeight()}getFamily(){return this._family}get family(){return this.getFamily()}copy(e){return new cn(_i({style:this._style,variant:this._variant,weight:this._weight,stretch:this._stretch,size:this._size,lineHeight:this._lineHeight,family:this._family},e))}computeShorthand(){let e="";return this._style!=="normal"&&(e+=`${this._style} `),this._variant!=="normal"&&(e+=`${this._variant} `),this._weight!=="normal"&&(e+=`${this._weight} `),this._stretch!=="normal"&&(e+=`${this._stretch} `),e+=this._size,this._lineHeight!=="normal"&&(e+=`/${this._lineHeight}`),e+=` ${this._family}`,e}toCSS(){return this.getFont()}static castSize(e){return typeof e=="number"?`${e}px`:e}static isFontStyle(e){return Gg.includes(e)}static isFontVariant(e){return Wg.includes(e)}static isFontWeight(e){return Ug.includes(e)}static isFontStretch(e){return Yg.includes(e)}static fromCSS(e){const t={},i=_.filter(e.split(/[\x09\x0A\x0C\x0D\x20]/),s=>s.length>0);for(let s=0;s<i.length;s++){const n=i[s];if(n!=="normal")if(cn.isFontStyle(n))assert&&assert(t.style===void 0,`Style cannot be applied twice. Already set to "${t.style}", attempt to replace with "${n}"`),t.style=n;else if(cn.isFontVariant(n))assert&&assert(t.variant===void 0,`Variant cannot be applied twice. Already set to "${t.variant}", attempt to replace with "${n}"`),t.variant=n;else if(cn.isFontWeight(n))assert&&assert(t.weight===void 0,`Weight cannot be applied twice. Already set to "${t.weight}", attempt to replace with "${n}"`),t.weight=n;else if(cn.isFontStretch(n))assert&&assert(t.stretch===void 0,`Stretch cannot be applied twice. Already set to "${t.stretch}", attempt to replace with "${n}"`),t.stretch=n;else{const o=n.split(/\//);t.size=o[0],o[1]&&(t.lineHeight=o[1]),t.family=i.slice(s+1).join(" ");break}}return new cn(t)}};cn.DEFAULT=new cn;let ss=cn;te.register("Font",ss);ss.FontIO=new Ai("FontIO",{valueType:ss,documentation:"Font handling for text drawing. Options:<ul><li><strong>style:</strong> normal      &mdash; normal | italic | oblique </li><li><strong>variant:</strong> normal    &mdash; normal | small-caps </li><li><strong>weight:</strong> normal     &mdash; normal | bold | bolder | lighter | 100 | 200 | 300 | 400 | 500 | 600 | 700 | 800 | 900 </li><li><strong>stretch:</strong> normal    &mdash; normal | ultra-condensed | extra-condensed | condensed | semi-condensed | semi-expanded | expanded | extra-expanded | ultra-expanded </li><li><strong>size:</strong> 10px         &mdash; absolute-size | relative-size | length | percentage -- unitless number interpreted as px. absolute suffixes: cm, mm, in, pt, pc, px. relative suffixes: em, ex, ch, rem, vw, vh, vmin, vmax. </li><li><strong>lineHeight:</strong> normal &mdash; normal | number | length | percentage -- NOTE: Canvas spec forces line-height to normal </li><li><strong>family:</strong> sans-serif &mdash; comma-separated list of families, including generic families (serif, sans-serif, cursive, fantasy, monospace). ideally escape with double-quotes</li></ul>",toStateObject:h=>({style:h.getStyle(),variant:h.getVariant(),weight:h.getWeight(),stretch:h.getStretch(),size:h.getSize(),lineHeight:h.getLineHeight(),family:h.getFamily()}),fromStateObject(h){return new ss(h)},stateSchema:{style:Ti,variant:Ti,weight:Ti,stretch:Ti,size:Ti,lineHeight:Ti,family:Ti}});const de={};te.register("Renderer",de);de.numActiveRenderers=4;de.bitsPerRenderer=5;de.bitmaskRendererArea=255;de.bitmaskCurrentRendererArea=15;de.bitmaskLacksOffset=65536;de.bitmaskLacksShift=16;de.bitmaskNodeDefault=de.bitmaskRendererArea;de.bitmaskCanvas=1;de.bitmaskSVG=2;de.bitmaskDOM=4;de.bitmaskWebGL=8;de.bitmaskSingleCanvas=256;de.bitmaskSingleSVG=512;de.bitmaskNotPainted=4096;de.bitmaskBoundsValid=8192;de.bitmaskNoPDOM=16384;de.bitmaskLacksCanvas=de.bitmaskCanvas<<de.bitmaskLacksShift;de.bitmaskLacksSVG=de.bitmaskSVG<<de.bitmaskLacksShift;de.bitmaskLacksDOM=de.bitmaskDOM<<de.bitmaskLacksShift;de.bitmaskLacksWebGL=de.bitmaskWebGL<<de.bitmaskLacksShift;de.isCanvas=function(h){return(h&de.bitmaskCanvas)!==0};de.isSVG=function(h){return(h&de.bitmaskSVG)!==0};de.isDOM=function(h){return(h&de.bitmaskDOM)!==0};de.isWebGL=function(h){return(h&de.bitmaskWebGL)!==0};const L_={canvas:de.bitmaskCanvas,svg:de.bitmaskSVG,dom:de.bitmaskDOM,webgl:de.bitmaskWebGL};de.fromName=function(h){return L_[h]};de.stripBitmask=function(h){return h&de.bitmaskRendererArea};de.createOrderBitmask=function(h,e,t,i){return h=h||0,e=e||0,t=t||0,i=i||0,h|e<<5|t<<10|i<<15};de.bitmaskOrder=function(h,e){return e>0&&(h=h>>5*e),h&de.bitmaskCurrentRendererArea};de.bitmaskOrderFirst=function(h){return h&de.bitmaskCurrentRendererArea};de.bitmaskOrderSecond=function(h){return h>>5&de.bitmaskCurrentRendererArea};de.bitmaskOrderThird=function(h){return h>>10&de.bitmaskCurrentRendererArea};de.bitmaskOrderFourth=function(h){return h>>15&de.bitmaskCurrentRendererArea};de.pushOrderBitmask=function(h,e){assert&&assert(typeof h=="number"),assert&&assert(typeof e=="number");let t=e;const i=de.bitsPerRenderer*de.numActiveRenderers;for(let s=0;s<=i;s+=de.bitsPerRenderer){const n=h>>s&de.bitmaskCurrentRendererArea;if(n===t)return h;if(n===0)return h=h|t<<s,h;if(h=h&~(de.bitmaskCurrentRendererArea<<s),h=h|t<<s,t=n,t===e)return h}throw new Error("pushOrderBitmask overflow")};de.createSelfDrawable=function(h,e,t,i){let s;if(de.isCanvas(t))s=e.createCanvasDrawable(t,h);else if(de.isSVG(t))s=e.createSVGDrawable(t,h);else if(de.isDOM(t))s=e.createDOMDrawable(t,h);else if(de.isWebGL(t))s=e.createWebGLDrawable(t,h);else throw new Error(`Unrecognized renderer: ${t}`);return assert&&_.each(e.drawableMarkFlags,n=>{const o=`markDirty${n[0].toUpperCase()}${n.slice(1)}`;assert(typeof s[o]=="function",`Did not find ${o}`)}),s.setFittable(i),s};de.webglCustom=1;de.webglTexturedTriangles=2;de.webglVertexColorPolygons=3;const li="http://www.w3.org/2000/svg";te.register("svgns",li);const Va="http://www.w3.org/1999/xlink";te.register("xlinkns",Va);function _r(h,e){return new Pe(h,e)}const Sc=ht.transform,P_=ht.transformOrigin||"transformOrigin";let Kg=!0,wc;const Yt={prepareForTransform(h){h.style[P_]="top left"},applyPreparedTransform(h,e){e.style[Sc]=h.getCSSTransform()},setTransform(h,e){e.style[Sc]=h},unsetTransform(h){h.style[Sc]=""},polyfillRequestAnimationFrame(){(!self.requestAnimationFrame||!self.cancelAnimationFrame)&&(!ht.requestAnimationFrame||!ht.cancelAnimationFrame?(self.requestAnimationFrame=h=>{const e=Date.now();return self.setTimeout(()=>{h(Date.now()-e)},16)},self.cancelAnimationFrame=clearTimeout):(self.requestAnimationFrame=self[ht.requestAnimationFrame],self.cancelAnimationFrame=self[ht.cancelAnimationFrame]))},backingStorePixelRatio(h){return h.webkitBackingStorePixelRatio||h.mozBackingStorePixelRatio||h.msBackingStorePixelRatio||h.oBackingStorePixelRatio||h.backingStorePixelRatio||1},backingScale(h){if("devicePixelRatio"in window){const e=Yt.backingStorePixelRatio(h);return self.devicePixelRatio/e}return 1},supportsNativeCanvasFilter(){return!!ht.canvasFilter},supportsImageDataCanvasFilter(){return Yt.backingStorePixelRatio(te.scratchContext)===1},scanBounds(h,e,t){const i=_.map(_.range(e),()=>!1),s=_.map(_.range(e),()=>!1);for(let w=0;w<e;w++)for(let O=0;O<e;O++){const T=4*(O*e+w);(h.data[T]!==0||h.data[T+1]!==0||h.data[T+2]!==0||h.data[T+3]!==0)&&(i[w]=!0,s[O]=!0)}const n=_.indexOf(i,!0),o=_.lastIndexOf(i,!0),c=_.indexOf(s,!0),p=_.lastIndexOf(s,!0),f=e/16;return{minBounds:new $e(n<1||n>=e-1?Number.POSITIVE_INFINITY:t.inversePosition2(_r(n+1+f,0)).x,c<1||c>=e-1?Number.POSITIVE_INFINITY:t.inversePosition2(_r(0,c+1+f)).y,o<1||o>=e-1?Number.NEGATIVE_INFINITY:t.inversePosition2(_r(o-f,0)).x,p<1||p>=e-1?Number.NEGATIVE_INFINITY:t.inversePosition2(_r(0,p-f)).y),maxBounds:new $e(n<1||n>=e-1?Number.NEGATIVE_INFINITY:t.inversePosition2(_r(n-1-f,0)).x,c<1||c>=e-1?Number.NEGATIVE_INFINITY:t.inversePosition2(_r(0,c-1-f)).y,o<1||o>=e-1?Number.POSITIVE_INFINITY:t.inversePosition2(_r(o+2+f,0)).x,p<1||p>=e-1?Number.POSITIVE_INFINITY:t.inversePosition2(_r(0,p+2+f)).y)}},canvasAccurateBounds(h,e){const t=e&&e.precision?e.precision:.001,i=e&&e.resolution?e.resolution:128,s=e&&e.initialScale?e.initialScale:1/16;let n=$e.NOTHING,o=$e.EVERYTHING;const c=document.createElement("canvas");c.width=i,c.height=i;const p=c.getContext("2d");function f(j){p.save(),j.matrix.canvasSetTransform(p),h(p),p.restore();const le=p.getImageData(0,0,i,i),xe=Yt.scanBounds(le,i,j);return p.clearRect(0,0,i,i),xe}function w(j){const xe=(i-4)/(j.maxX-j.minX),ce=(i-2*2)/(j.maxY-j.minY),ne=-xe*j.minX+2,me=-ce*j.minY+2;return new Ks(Ze.translation(ne,me).timesMatrix(Ze.scaling(xe,ce)))}const O=new Ks;O.append(Ze.translation(i/2,i/2)),O.append(Ze.scaling(s));const T=f(O);n=n.union(T.minBounds),o=o.intersection(T.maxBounds);let z,U,m;for(z=o.minY,U=o.maxY;isFinite(n.minX)&&isFinite(o.minX)&&Math.abs(n.minX-o.minX)>t&&(m=f(w(new $e(o.minX,z,n.minX,U))),!(n.minX<=m.minBounds.minX&&o.minX>=m.maxBounds.minX));)n=n.withMinX(Math.min(n.minX,m.minBounds.minX)),o=o.withMinX(Math.max(o.minX,m.maxBounds.minX)),z=Math.max(z,m.maxBounds.minY),U=Math.min(U,m.maxBounds.maxY);for(z=o.minY,U=o.maxY;isFinite(n.maxX)&&isFinite(o.maxX)&&Math.abs(n.maxX-o.maxX)>t&&(m=f(w(new $e(n.maxX,z,o.maxX,U))),!(n.maxX>=m.minBounds.maxX&&o.maxX<=m.maxBounds.maxX));)n=n.withMaxX(Math.max(n.maxX,m.minBounds.maxX)),o=o.withMaxX(Math.min(o.maxX,m.maxBounds.maxX)),z=Math.max(z,m.maxBounds.minY),U=Math.min(U,m.maxBounds.maxY);for(z=o.minX,U=o.maxX;isFinite(n.minY)&&isFinite(o.minY)&&Math.abs(n.minY-o.minY)>t&&(m=f(w(new $e(z,o.minY,U,n.minY))),!(n.minY<=m.minBounds.minY&&o.minY>=m.maxBounds.minY));)n=n.withMinY(Math.min(n.minY,m.minBounds.minY)),o=o.withMinY(Math.max(o.minY,m.maxBounds.minY)),z=Math.max(z,m.maxBounds.minX),U=Math.min(U,m.maxBounds.maxX);for(z=o.minX,U=o.maxX;isFinite(n.maxY)&&isFinite(o.maxY)&&Math.abs(n.maxY-o.maxY)>t&&(m=f(w(new $e(z,n.maxY,U,o.maxY))),!(n.maxY>=m.minBounds.maxY&&o.maxY<=m.maxBounds.maxY));)n=n.withMaxY(Math.max(n.maxY,m.minBounds.maxY)),o=o.withMaxY(Math.min(o.maxY,m.maxBounds.maxY)),z=Math.max(z,m.maxBounds.minX),U=Math.min(U,m.maxBounds.maxX);const Y=new $e(isFinite(n.minX)&&isFinite(o.minX)?(n.minX+o.minX)/2:Number.POSITIVE_INFINITY,isFinite(n.minY)&&isFinite(o.minY)?(n.minY+o.minY)/2:Number.POSITIVE_INFINITY,isFinite(n.maxX)&&isFinite(o.maxX)?(n.maxX+o.maxX)/2:Number.NEGATIVE_INFINITY,isFinite(n.maxY)&&isFinite(o.maxY)?(n.maxY+o.maxY)/2:Number.NEGATIVE_INFINITY);return Y.minBounds=n,Y.maxBounds=o,Y.isConsistent=o.containsBounds(n),Y.precision=Math.max(Math.abs(n.minX-o.minX),Math.abs(n.minY-o.minY),Math.abs(n.maxX-o.maxX),Math.abs(n.maxY-o.maxY)),Y},toPowerOf2(h){let e=1;for(;e<h;)e*=2;return e},createShader(h,e,t){const i=h.createShader(t);return h.shaderSource(i,e),h.compileShader(i),h.getShaderParameter(i,h.COMPILE_STATUS)||(console.log("GLSL compile error:"),console.log(h.getShaderInfoLog(i)),console.log(e)),i},applyWebGLContextDefaults(h){h.clearColor(0,0,0,0),h.enable(h.BLEND),h.blendFunc(h.ONE,h.ONE_MINUS_SRC_ALPHA)},setWebGLEnabled(h){Kg=h},checkWebGLSupport(h){if(!Kg)return!1;const e=document.createElement("canvas"),t={failIfMajorPerformanceCaveat:!0};try{const i=!!self.WebGLRenderingContext&&(e.getContext("webgl",t)||e.getContext("experimental-webgl",t));if(!i)return!1;if(h){for(let s=0;s<h.length;s++)if(i.getExtension(h[s])===null)return!1}return!0}catch{return!1}},checkIE11StencilSupport(){const h=document.createElement("canvas");try{const e=!!self.WebGLRenderingContext&&(h.getContext("webgl")||h.getContext("experimental-webgl"));return e?(e.clearStencil(0),e.getError()===0):!1}catch{return!1}},get isWebGLSupported(){return wc===void 0&&(wc=Yt.checkWebGLSupport()),wc},loseContext(h){const e=h.getExtension("WEBGL_lose_context");e&&(e.loseContext(),setTimeout(()=>{e.restoreContext()},1e3))},safariEmbeddingMarkWorkaround(h){if(Ui.safari){const e=h.split("");let t="",i=!1;for(let s=0;s<e.length;s++){const n=e[s],o=n===""||n===""||n==="";i&&o&&(t+=""),t+=n,i=o}return t}else return h}};te.register("Utils",Yt);const Ch=class Ch{constructor(e,t){this.display=e,this.trail=t}};Ch.FocusIO=new Ai("FocusIO",{valueType:Ch,documentation:"A PhET-iO Type for the instance in the simulation which currently has keyboard focus. FocusIO is serialized into and Object with key `focusedPhetioElement` that is a list of PhET-iO Elements, from parent-most to child-most corresponding to the PhET-iO Element that was instrumented.",toStateObject:e=>{const t=[];return e.trail.nodes.forEach((i,s)=>{i.isPhetioInstrumented()&&t.push(i.tandem.phetioID)}),{focusedPhetioElement:t}},stateSchema:{focusedPhetioElement:Tl(Ti)}});let An=Ch;te.register("Focus",An);const Rf="ArrowRight",Nf="ArrowLeft",Bf="ArrowUp",Ff="ArrowDown",ed="ShiftRight",td="ShiftLeft",id="ControlLeft",sd="ControlRight",nd="AltLeft",rd="AltRight",ad="MetaLeft",od="MetaRight",ld="OSLeft",hd="OSRight",S_="KeyW",w_="KeyA",C_="KeyS",T_="KeyD",Hf="Digit0",Vf="Digit1",zf="Digit2",$f="Digit3",Gf="Digit4",Wf="Digit5",Uf="Digit6",Yf="Digit7",Kf="Digit8",qf="Digit9",hu="Alt",cu="Shift",uu="Control",Cc=[Rf,Nf,Bf,Ff],Tc=[S_,C_,w_,T_],x_=[Hf,Vf,zf,$f,Gf,Wf,Uf,Yf,Kf,qf],xc=[td,ed],Ic=[id,sd],Dc=[nd,rd],qg=[ad,od,ld,hd],I_=[hu,uu,cu],D_=[nd,rd,id,sd,td,ed,ad,od,ld,hd],A_={valueType:Event},du=[],Se={KEY_SPACE:"Space",KEY_ENTER:"Enter",KEY_TAB:"Tab",KEY_RIGHT_ARROW:Rf,KEY_LEFT_ARROW:Nf,KEY_UP_ARROW:Bf,KEY_DOWN_ARROW:Ff,KEY_SHIFT_LEFT:td,KEY_SHIFT_RIGHT:ed,KEY_ALT_LEFT:nd,KEY_ALT_RIGHT:rd,KEY_CONTROL_LEFT:id,KEY_CONTROL_RIGHT:sd,KEY_META_LEFT:ad,KEY_META_RIGHT:od,KEY_META_LEFT_FIREFOX:ld,KEY_META_RIGHT_FIREFOX:hd,KEY_SHIFT:cu,KEY_ALT:hu,KEY_CONTROL:uu,KEY_ESCAPE:"Escape",KEY_DELETE:"Delete",KEY_BACKSPACE:"Backspace",KEY_PAGE_UP:"PageUp",KEY_PAGE_DOWN:"PageDown",KEY_END:"End",KEY_HOME:"Home",KEY_0:Hf,KEY_1:Vf,KEY_2:zf,KEY_3:$f,KEY_4:Gf,KEY_5:Wf,KEY_6:Uf,KEY_7:Yf,KEY_8:Kf,KEY_9:qf,KEY_NUMPAD_0:"Numpad0",KEY_NUMPAD_1:"Numpad1",KEY_NUMPAD_2:"Numpad2",KEY_NUMPAD_3:"Numpad3",KEY_NUMPAD_4:"Numpad4",KEY_NUMPAD_5:"Numpad5",KEY_NUMPAD_6:"Numpad6",KEY_NUMPAD_7:"Numpad7",KEY_NUMPAD_8:"Numpad8",KEY_NUMPAD_9:"Numpad9",KEY_NUMPAD_DECIMAL:"NumpadDecimal",KEY_NUMPAD_PLUS:"NumpadAdd",KEY_NUMPAD_MINUS:"NumpadSubtract",KEY_A:"KeyA",KEY_B:"KeyB",KEY_C:"KeyC",KEY_D:"KeyD",KEY_E:"KeyE",KEY_F:"KeyF",KEY_G:"KeyG",KEY_H:"KeyH",KEY_I:"KeyI",KEY_J:"KeyJ",KEY_K:"KeyK",KEY_L:"KeyL",KEY_M:"KeyM",KEY_N:"KeyN",KEY_O:"KeyO",KEY_P:"KeyP",KEY_Q:"KeyQ",KEY_R:"KeyR",KEY_S:"KeyS",KEY_T:"KeyT",KEY_U:"KeyU",KEY_V:"KeyV",KEY_W:"KeyW",KEY_X:"KeyX",KEY_Y:"KeyY",KEY_Z:"KeyZ",KEY_EQUALS:"Equal",KEY_PLUS:"Equal",KEY_MINUS:"Minus",KEY_PERIOD:"Period",ARROW_KEYS:Cc,WASD_KEYS:Tc,MOVEMENT_KEYS:Cc.concat(Tc),SHIFT_KEYS:xc,CONTROL_KEYS:Ic,ALT_KEYS:Dc,META_KEYS:qg,MODIFIER_KEY_CODES:D_,MODIFIER_KEY_TO_CODE_MAP:new Map([[hu,Dc],[cu,xc],[uu,Ic]]),isArrowKey(h){return Se.isAnyKeyEvent(h,Cc)},isRangeKey(h){return Se.isArrowKey(h)||Se.isAnyKeyEvent(h,[Se.KEY_PAGE_UP,Se.KEY_PAGE_DOWN,Se.KEY_HOME,Se.KEY_END])},isNumberKey(h){return Se.isAnyKeyEvent(h,x_)},getNumberFromCode(h){return Se.isNumberKey(h)&&h instanceof KeyboardEvent?Number(h.code.replace("Digit","")):null},isShiftKey(h){return Se.isAnyKeyEvent(h,xc)},isAltKey(h){return Se.isAnyKeyEvent(h,Dc)},isControlKey(h){return Se.isAnyKeyEvent(h,Ic)},isMetaKey(h){return Se.isAnyKeyEvent(h,qg)},isWASDKey(h){return Se.isAnyKeyEvent(h,Tc)},isMovementKey(h){return Se.isAnyKeyEvent(h,Se.MOVEMENT_KEYS)},isAnyKeyEvent(h,e){Or(h,A_);const t=Se.getEventCode(h);return t?e.includes(t):!1},isKeyEvent(h,e){return Se.getEventCode(h)===e},getEventCode(h){let e=null;return h instanceof KeyboardEvent&&h.code&&(e=h.code,e.startsWith("Numpad")&&du.includes(h.key)&&(e=h.key)),e},isModifierKey(h){return I_.includes(h)},ALL_KEYS:du};for(const h in Se)Se.hasOwnProperty(h)&&typeof Se[h]=="string"&&du.push(Se[h]);te.register("KeyboardUtils",Se);const za={q:[Se.KEY_Q],w:[Se.KEY_W],e:[Se.KEY_E],r:[Se.KEY_R],t:[Se.KEY_T],y:[Se.KEY_Y],u:[Se.KEY_U],i:[Se.KEY_I],o:[Se.KEY_O],p:[Se.KEY_P],a:[Se.KEY_A],s:[Se.KEY_S],d:[Se.KEY_D],f:[Se.KEY_F],g:[Se.KEY_G],h:[Se.KEY_H],j:[Se.KEY_J],k:[Se.KEY_K],l:[Se.KEY_L],z:[Se.KEY_Z],x:[Se.KEY_X],c:[Se.KEY_C],v:[Se.KEY_V],b:[Se.KEY_B],n:[Se.KEY_N],m:[Se.KEY_M],0:[Se.KEY_0,Se.KEY_NUMPAD_0],1:[Se.KEY_1,Se.KEY_NUMPAD_1],2:[Se.KEY_2,Se.KEY_NUMPAD_2],3:[Se.KEY_3,Se.KEY_NUMPAD_3],4:[Se.KEY_4,Se.KEY_NUMPAD_4],5:[Se.KEY_5,Se.KEY_NUMPAD_5],6:[Se.KEY_6,Se.KEY_NUMPAD_6],7:[Se.KEY_7,Se.KEY_NUMPAD_7],8:[Se.KEY_8,Se.KEY_NUMPAD_8],9:[Se.KEY_9,Se.KEY_NUMPAD_9],enter:[Se.KEY_ENTER],tab:[Se.KEY_TAB],equals:[Se.KEY_EQUALS],plus:[Se.KEY_PLUS,Se.KEY_NUMPAD_PLUS],minus:[Se.KEY_MINUS,Se.KEY_NUMPAD_MINUS],period:[Se.KEY_PERIOD,Se.KEY_NUMPAD_DECIMAL],escape:[Se.KEY_ESCAPE],delete:[Se.KEY_DELETE],backspace:[Se.KEY_BACKSPACE],pageUp:[Se.KEY_PAGE_UP],pageDown:[Se.KEY_PAGE_DOWN],end:[Se.KEY_END],home:[Se.KEY_HOME],space:[Se.KEY_SPACE],arrowLeft:[Se.KEY_LEFT_ARROW],arrowRight:[Se.KEY_RIGHT_ARROW],arrowUp:[Se.KEY_UP_ARROW],arrowDown:[Se.KEY_DOWN_ARROW],ctrl:Se.CONTROL_KEYS,alt:Se.ALT_KEYS,shift:Se.SHIFT_KEYS,meta:Se.META_KEYS};te.register("EnglishStringToCodeMap",za);const E_=["ctrl","alt","shift","meta"],Xf=h=>{for(const e in za)if(za.hasOwnProperty(e)&&za[e].includes(h))return e;return null},Xg=h=>Object.getPrototypeOf(h)===Object.prototype,gu=new Ai("ObjectLiteralIO",{documentation:"PhET-iO Type for object literals",isValidValue:Xg,supertype:Tf,stateSchema:Uu.asValue("object",{valueType:Object,isValidValue:Xg}),toStateObject:_.identity});Wr.register("ObjectLiteralIO",gu);const Br=new Ai("EventIO",{valueType:self.Event,documentation:"A DOM Event",toStateObject:h=>cr.serializeDomEvent(h),fromStateObject:h=>cr.deserializeDomEvent(h),stateSchema:()=>({constructorName:Ti,altKey:Ft(Dr),button:Ft(Ut),charCode:Ft(Ut),clientX:Ft(Ut),clientY:Ft(Ut),code:Ft(Ti),ctrlKey:Ft(Dr),deltaMode:Ft(Ut),deltaX:Ft(Ut),deltaY:Ft(Ut),deltaZ:Ft(Ut),key:Ft(Ti),keyCode:Ft(Ut),metaKey:Ft(Dr),pageX:Ft(Ut),pageY:Ft(Ut),pointerId:Ft(Ut),pointerType:Ft(Ti),scale:Ft(Ut),shiftKey:Ft(Dr),target:Ft(gu),type:Ft(Ti),relatedTarget:Ft(gu),which:Ft(Ut)})});te.register("EventIO",Br);const cd=document.createElement("style");cd.type="text/css";document.head.appendChild(cd);const jf=document.styleSheets[document.styleSheets.length-1];assert&&assert(jf.disabled===!1);const Hh={stylesheet:jf,styleElement:cd,addRule(h){this.stylesheet.insertRule(h,0)}};te.register("SceneryStyle",Hh);class Rr{constructor(e,t){this.canvas=e,this.context=t,this.resetStyles()}resetStyles(){this.fillStyle=void 0,this.strokeStyle=void 0,this.lineWidth=void 0,this.lineCap=void 0,this.lineJoin=void 0,this.lineDash=void 0,this.lineDashOffset=void 0,this.miterLimit=void 0,this.font=void 0,this.direction=void 0}setDimensions(e,t){this.canvas.width=e,this.canvas.height=t,this.resetStyles()}setFillStyle(e){e&&ft(e)&&(e=e.value),e&&e.getCanvasStyle&&(e=e.getCanvasStyle()),this.fillStyle!==e&&(this.fillStyle=e,this.context.fillStyle=e)}setStrokeStyle(e){e&&ft(e)&&(e=e.value),e&&e.getCanvasStyle&&(e=e.getCanvasStyle()),this.strokeStyle!==e&&(this.strokeStyle=e,this.context.strokeStyle=e)}setLineWidth(e){this.lineWidth!==e&&(this.lineWidth=e,this.context.lineWidth=e)}setLineCap(e){this.lineCap!==e&&(this.lineCap=e,this.context.lineCap=e)}setLineJoin(e){this.lineJoin!==e&&(this.lineJoin=e,this.context.lineJoin=e)}setMiterLimit(e){assert&&assert(typeof e=="number"),this.miterLimit!==e&&(this.miterLimit=e,this.context.miterLimit=e)}setLineDash(e){assert&&assert(e!==void 0,"undefined line dash would cause hard-to-trace errors"),this.lineDash!==e&&(this.lineDash=e,this.context.setLineDash?this.context.setLineDash(e===null?[]:e):this.context.mozDash!==void 0?this.context.mozDash=e:this.context.webkitLineDash!==void 0&&(this.context.webkitLineDash=e||[]))}setLineDashOffset(e){this.lineDashOffset!==e&&(this.lineDashOffset=e,this.context.lineDashOffset!==void 0?this.context.lineDashOffset=e:this.context.webkitLineDashOffset!==void 0&&(this.context.webkitLineDashOffset=e))}setFont(e){this.font!==e&&(this.font=e,this.context.font=e)}setDirection(e){this.direction!==e&&(this.direction=e,this.context.direction=e)}}te.register("CanvasContextWrapper",Rr);const jg=Ci(document,"exitFullscreen")||Ci(document,"cancelFullScreen"),k_=Ci(document,"fullscreenElement")||Ci(document,"fullScreenElement"),O_=Ci(document,"fullscreenEnabled")||Ci(document,"fullScreenEnabled");let pu=wb(document,"fullscreenchange");pu==="msfullscreenchange"&&(pu="MSFullscreenChange");const ga={isFullScreen(){return!!document[k_]},isFullScreenEnabled(){return document[O_]&&!Ui.safari7},enterFullScreen(h){const e=Ci(document.body,"requestFullscreen")||Ci(document.body,"requestFullScreen");h.domElement[e]&&h.domElement[e]()},exitFullScreen(){document[jg]&&document[jg]()},toggleFullScreen(h){ga.isFullScreen()?ga.exitFullScreen():ga.enterFullScreen(h)},isFullScreenProperty:new wi(!1)};document.addEventListener(pu,h=>{ga.isFullScreenProperty.set(ga.isFullScreen())});te.register("FullScreen",ga);const M_=ga;class Qf{constructor(e,t){this.create=e,this.destroy=t,this.map=new Map}increment(e,t=1){if(assert&&assert(typeof t=="number"),assert&&assert(t>=1),this.map.has(e))this.map.get(e).count+=t;else{const i=this.create(e),s=fu.createFromPool(t,e,i);this.map.set(e,s)}}decrement(e,t=1){assert&&assert(typeof t=="number"),assert&&assert(t>=1);const i=this.map.get(e);i&&(i.count-=t,i.count<1&&(this.destroy(e,i.value),this.map.delete(e),i.dispose()))}get(e){return this.map.get(e).value}clear(){this.map.clear()}}class fu{constructor(e,t,i){this.initialize(e,t,i)}initialize(e,t,i){this.count=e,this.key=t,this.value=i}dispose(){this.key=null,this.value=null,this.freeToPool()}}di.mixInto(fu,{initialize:fu.prototype.initialize});te.register("CountMap",Qf);class ud extends Nt{constructor(e,t){const i=st()({display:null,followPDOMOrder:!1,requireVisible:!0,requirePDOMVisible:!1,requireEnabled:!1,requireInputEnabled:!1},t);super([]),this.listenedNodeSet=new Set,this.node=e,this.display=i.display,this.followPDOMOrder=i.followPDOMOrder,this.requireVisible=i.requireVisible,this.requirePDOMVisible=i.requirePDOMVisible,this.requireEnabled=i.requireEnabled,this.requireInputEnabled=i.requireInputEnabled,this._trailUpdateListener=this.update.bind(this),this.update()}update(){const e=this.display,t=this.followPDOMOrder,i=this.requireVisible,s=this.requirePDOMVisible,n=this.requireEnabled,o=this.requireInputEnabled,c=[],p=new Set,f=new wt(this.node);(function T(){const z=f.rootNode();if(z.isDisposed||(p.add(z),i&&!z.visible||s&&!z.pdomVisible||n&&!z.enabled||o&&!z.inputEnabled))return;const U=z.getRootedDisplays();let m;e===null?m=U.length>0:e instanceof cs?m=U.includes(e):m=U.some(e),m&&c.push(f.copy()),(t&&z.pdomParent?[z.pdomParent]:z.parents).forEach(j=>{f.addAncestor(j),T(),f.removeAncestor()})})(),p.forEach(T=>{this.listenedNodeSet.has(T)||this.addNodeListener(T)}),this.listenedNodeSet.forEach(T=>{p.has(T)||this.removeNodeListener(T)});const w=this.value;let O=w.length===c.length;if(O){for(let T=0;T<c.length;T++)if(!w[T].equals(c[T])){O=!1;break}}O||(this.value=c)}addNodeListener(e){this.listenedNodeSet.add(e),e.parentAddedEmitter.addListener(this._trailUpdateListener),e.parentRemovedEmitter.addListener(this._trailUpdateListener),e.rootedDisplayChangedEmitter.addListener(this._trailUpdateListener),e.disposeEmitter.addListener(this._trailUpdateListener),this.followPDOMOrder&&e.pdomParentChangedEmitter.addListener(this._trailUpdateListener),this.requireVisible&&e.visibleProperty.lazyLink(this._trailUpdateListener),this.requirePDOMVisible&&e.pdomVisibleProperty.lazyLink(this._trailUpdateListener),this.requireEnabled&&e.enabledProperty.lazyLink(this._trailUpdateListener),this.requireInputEnabled&&e.inputEnabledProperty.lazyLink(this._trailUpdateListener)}removeNodeListener(e){this.listenedNodeSet.delete(e),e.parentAddedEmitter.removeListener(this._trailUpdateListener),e.parentRemovedEmitter.removeListener(this._trailUpdateListener),e.rootedDisplayChangedEmitter.removeListener(this._trailUpdateListener),e.disposeEmitter.removeListener(this._trailUpdateListener),this.followPDOMOrder&&e.pdomParentChangedEmitter.removeListener(this._trailUpdateListener),this.requireVisible&&e.visibleProperty.unlink(this._trailUpdateListener),this.requirePDOMVisible&&e.pdomVisibleProperty.unlink(this._trailUpdateListener),this.requireEnabled&&e.enabledProperty.unlink(this._trailUpdateListener),this.requireInputEnabled&&e.inputEnabledProperty.unlink(this._trailUpdateListener)}dispose(){this.listenedNodeSet.forEach(e=>this.removeNodeListener(e)),super.dispose()}}te.register("DisplayedTrailsProperty",ud);class R_ extends Df{constructor(e,t){const i=new ud(e,t);super([i],s=>s.length>0,t),this.displayedTrailsProperty=i}dispose(){this.displayedTrailsProperty.dispose(),super.dispose()}}te.register("DisplayedProperty",R_);class N_{constructor(e){this.scene=e,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.img=document.createElement("img"),this.update()}update(e){this.scene.updateScene(),this.canvas.width=this.scene.getSceneWidth(),this.canvas.height=this.scene.getSceneHeight(),this.scene.renderToCanvas(this.canvas,this.context,()=>{const t=this.toDataURL();this.img.onload=()=>{e(),delete this.img.onload},this.img.src=t})}}te.register("SceneImage",N_);var Lf,Pf,Sf,wf,Cf;const Ja=new ci(!((Pf=(Lf=self==null?void 0:self.phet)==null?void 0:Lf.chipper)!=null&&Pf.queryParameters)||((Cf=(wf=(Sf=self==null?void 0:self.phet)==null?void 0:Sf.chipper)==null?void 0:wf.queryParameters)==null?void 0:Cf.allowLinks),{tandem:ai.GENERAL_MODEL.createTandem("allowLinksProperty")});te.register("allowLinksProperty",Ja);function Zf(h,e=Ja.value){const t=phet&&phet.chipper&&phet.chipper.isFuzzEnabled();if(e&&!t){const i=self.open(h,"_blank");i&&i.focus()}}te.register("openPopup",Zf);const mu=(h,e)=>{const t=st()({requiredOnly:!1},e),i=[],s=new LineBreaker(h);s[Symbol.iterator]=()=>({next(){const o=s.nextBreak();return o!==null?{value:o,done:!1}:{done:!0}}});let n=0;for(const o of s){const c=o.position;t.requiredOnly&&!o.required||(n!==c&&i.push(new rr(n,c)),n=o.position)}return n<h.length&&i.push(new rr(n,h.length)),i};te.register("getLineBreakRanges",mu);const B_=new Pe(0,0),F_=Ze.IDENTITY.copy(),un=class un extends Ur{};un.TRANSLATION=new un,un.TRANSLATION_AND_SCALE=new un,un.TRANSLATION_AND_ROTATION=new un,un.AFFINE=new un,un.enumeration=new Yr(un,{phetioDocumentation:"Defines the available transform type for a SpriteInstance"});let la=un;const jo=class jo{constructor(){this.sprite=null,this.matrix=new Ze().setToAffine(1,0,0,0,1,0),this.transformType=la.TRANSLATION,this.alpha=1}initialize(){return this}getShape(){return this.sprite?this.sprite.getShape().transformed(this.matrix):new kt}containsPoint(e){if(!this.sprite)return!1;const t=B_.set(e);return this.transformType===la.AFFINE?F_.set(this.matrix).invert().multiplyVector2(t):(t.x-=this.matrix.m02(),t.y-=this.matrix.m12(),this.transformType===la.TRANSLATION_AND_SCALE?(t.x/=this.matrix.m00(),t.y/=this.matrix.m11()):this.transformType===la.TRANSLATION_AND_ROTATION&&t.rotate(-this.matrix.rotation)),this.sprite.containsPoint(t)}freeToPool(){jo.pool.freeToPool(this)}};jo.pool=new qi(jo,{maxSize:1e3});let yu=jo;te.register("SpriteInstance",yu);const Ac=new In(1024,1024),ea=1,ql=1,lg=class lg{constructor(e){this.useMipmaps=e,this.gl=null,this.texture=null,this.bounds=new $e(0,0,Ac.width,Ac.height),assert&&assert(this.bounds.minX===0&&this.bounds.minY===0,"Assumed constraint later on for transforms"),this.width=this.bounds.width,this.height=this.bounds.height,this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.context=this.canvas.getContext("2d"),this.binPacker=new _b(this.bounds),this.dirty=!0,this.usedSprites=[],this.unusedSprites=[]}initializeContext(e){this.gl=e,this.createTexture()}createTexture(){const e=this.gl;assert&&assert(e),this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,this.useMipmaps?e.LINEAR_MIPMAP_LINEAR:e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.canvas),this.useMipmaps&&(e.hint(e.GENERATE_MIPMAP_HINT,e.NICEST),e.generateMipmap(e.TEXTURE_2D)),e.bindTexture(e.TEXTURE_2D,null),this.dirty=!1}updateTexture(){if(assert&&assert(this.gl,"SpriteSheet needs context to updateTexture()"),this.dirty){this.dirty=!1;const e=this.gl;assert&&assert(e),e.bindTexture(e.TEXTURE_2D,this.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.canvas),this.useMipmaps&&(e.hint(e.GENERATE_MIPMAP_HINT,e.NICEST),e.generateMipmap(e.TEXTURE_2D)),e.bindTexture(e.TEXTURE_2D,null)}}addImage(e,t,i){let s;for(s=0;s<this.usedSprites.length;s++){const o=this.usedSprites[s];if(o.image===e)return o.count++,o}for(s=0;s<this.unusedSprites.length;s++){const o=this.unusedSprites[s];if(o.image===e)return o.count++,assert&&assert(o.count===1,"Count should be exactly 1 after coming back from being unused"),this.unusedSprites.splice(s,1),this.usedSprites.push(o),o}let n;for(;!(n=this.binPacker.allocate(t+2*ea+ql,i+2*ea+ql))&&this.unusedSprites.length;){const o=this.unusedSprites.shift();this.dirty=!0;const c=o.bin.bounds;this.context.clearRect(c.x,c.y,c.width,c.height),this.binPacker.deallocate(o.bin)}if(n){const o=new $e((n.bounds.minX+ea)/this.width,(n.bounds.minY+ea)/this.height,(n.bounds.maxX-ea-ql)/this.width,(n.bounds.maxY-ea-ql)/this.height),c=new Jf(this,n,o,e,1);return this.copyImageWithGutter(e,t,i,n.bounds.x,n.bounds.y),this.dirty=!0,this.usedSprites.push(c),c}else return null}removeImage(e){let t,i;for(i=0;i<this.usedSprites.length;i++)if(this.usedSprites[i].image===e){t=this.usedSprites[i];break}assert&&assert(t,"Sprite not found for removeImage"),--t.count<=0&&(this.usedSprites.splice(i,1),this.unusedSprites.push(t))}containsImage(e){let t;for(t=0;t<this.usedSprites.length;t++)if(this.usedSprites[t].image===e)return!0;for(t=0;t<this.unusedSprites.length;t++)if(this.unusedSprites[t].image===e)return!0;return!1}copyImageWithGutter(e,t,i,s,n){assert&&assert(ea===1),this.copyImageRegion(e,1,1,0,0,s,n),this.copyImageRegion(e,1,1,t-1,0,s+1+t,n),this.copyImageRegion(e,1,1,t-1,i-1,s+1+t,n+1+i),this.copyImageRegion(e,1,1,0,i-1,s,n+1+i),this.copyImageRegion(e,t,1,0,0,s+1,n),this.copyImageRegion(e,t,1,0,i-1,s+1,n+1+i),this.copyImageRegion(e,1,i,0,0,s,n+1),this.copyImageRegion(e,1,i,t-1,0,s+1+t,n+1),this.context.drawImage(e,s+1,n+1)}copyImageRegion(e,t,i,s,n,o,c){this.context.drawImage(e,s,n,t,i,o,c,t,i)}};lg.MAX_DIMENSION=Ac;let Fr=lg;te.register("SpriteSheet",Fr);let Jf=class{constructor(e,t,i,s,n){this.spriteSheet=e,this.bin=t,this.uvBounds=i,this.image=s,this.count=n}};Fr.Sprite=Jf;class Vh{constructor(e,t,i,s){const n=st()({attributes:[],uniforms:[]},s);this.vertexSource=t,this.fragmentSource=i,this.attributeNames=n.attributes,this.uniformNames=n.uniforms,this.initialize(e)}initialize(e){this.gl=e,this.used=!1,this.program=this.gl.createProgram(),this.vertexShader=Yt.createShader(this.gl,this.vertexSource,this.gl.VERTEX_SHADER),this.fragmentShader=Yt.createShader(this.gl,this.fragmentSource,this.gl.FRAGMENT_SHADER),this.gl.attachShader(this.program,this.vertexShader),this.gl.attachShader(this.program,this.fragmentShader),this.gl.linkProgram(this.program),this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS)||(console.log("GLSL link error:"),console.log(this.gl.getProgramInfoLog(this.program)),console.log("for vertex shader"),console.log(this.vertexSource),console.log("for fragment shader"),console.log(this.fragmentSource)),this.gl.deleteShader(this.vertexShader),this.gl.deleteShader(this.fragmentShader),this.uniformLocations={},this.attributeLocations={},this.activeAttributes={},_.each(this.attributeNames,t=>{this.attributeLocations[t]=this.gl.getAttribLocation(this.program,t),this.activeAttributes[t]=!0}),_.each(this.uniformNames,t=>{this.uniformLocations[t]=this.gl.getUniformLocation(this.program,t)}),this.isInitialized=!0}use(){this.used||(this.used=!0,this.gl.useProgram(this.program),_.each(this.attributeNames,e=>{this.activeAttributes[e]&&this.enableVertexAttribArray(e)}))}activateAttribute(e){this.activeAttributes[e]||(this.activeAttributes[e]=!0,this.used&&this.enableVertexAttribArray(e))}enableVertexAttribArray(e){this.gl.enableVertexAttribArray(this.attributeLocations[e])}unuse(){this.used&&(this.used=!1,_.each(this.attributeNames,e=>{this.activeAttributes[e]&&this.disableVertexAttribArray(e)}))}disableVertexAttribArray(e){this.gl.disableVertexAttribArray(this.attributeLocations[e])}deactivateAttribute(e){this.activeAttributes[e]&&(this.activeAttributes[e]=!1,this.used&&this.disableVertexAttribArray(e))}dispose(){this.gl.deleteProgram(this.program)}}te.register("ShaderProgram",Vh);class em extends wi{constructor(e,t){t&&(assert&&assert(!t.hasOwnProperty("valueType"),"ColorProperty sets valueType"),assert&&assert(!t.hasOwnProperty("phetioType"),"ColorProperty sets phetioType"));const i=st()({valueType:qe,phetioValueType:qe.ColorIO},t);super(e,i)}}te.register("ColorProperty",em);const Qg="sceneryTextSizeContainer",Zg="sceneryTextSizeElement";let Nn,Sn;const Jg={};let ep=!1;const nn={approximateSVGBounds(h,e){if(assert&&assert(h instanceof ss,"Font required"),assert&&assert(typeof e=="string","renderedText required"),!Nn.parentNode)if(document.body)document.body.appendChild(Nn);else throw new Error("No document.body and trying to get approximate SVG bounds of a Text node");nn.setSVGTextAttributes(Sn,h,e);const t=Sn.getBBox();return t.width===0&&t.height===0&&e.length>0?(ep||(ep=!0,console.log("WARNING: Guessing text bounds, is the simulation hidden? See https://github.com/phetsims/chipper/issues/768")),nn.guessSVGBounds(h,e)):new $e(t.x,t.y,t.x+t.width,t.y+t.height)},guessSVGBounds(h,e){const t=h.getNumericSize(),i=h.weight==="bold";return new $e(0,-.9*t,(i?.435:.4)*t*e.length,.22*t)},accurateCanvasBounds(h){const e=te.scratchContext;e.font=h._font.toCSS(),e.direction="ltr";const t=e.measureText(h.renderedText);return new $e(-t.actualBoundingBoxLeft,-t.actualBoundingBoxAscent,t.actualBoundingBoxRight,t.actualBoundingBoxDescent)},accurateCanvasBoundsFallback(h){const e=nn.approximateSVGBounds(h._font,h.renderedText);if(!h.renderedText.length||e.width===0)return e;const t=Yt.canvasAccurateBounds(i=>{if(i.font=h._font.toCSS(),i.direction="ltr",i.fillText(h.renderedText,0,0),h.hasPaintableStroke()){const s=new Rr(null,i);h.beforeCanvasStroke(s),i.strokeText(h.renderedText,0,0),h.afterCanvasStroke(s)}},{precision:.5,resolution:128,initialScale:32/Math.max(Math.abs(e.minX),Math.abs(e.minY),Math.abs(e.maxX),Math.abs(e.maxY))});return t.isFinite()?t:e},getVerticalBounds(h){assert&&assert(h instanceof ss,"Font required");const e=h.toCSS();let t=Jg[e];return t||(t=Jg[e]=nn.approximateSVGBounds(h,"m")),t},approximateCanvasWidth(h,e){assert&&assert(h instanceof ss,"Font required"),assert&&assert(typeof e=="string","renderedText required");const t=te.scratchContext;return t.font=h.toCSS(),t.direction="ltr",t.measureText(e).width},approximateHybridBounds(h,e){assert&&assert(h instanceof ss,"Font required"),assert&&assert(typeof e=="string","renderedText required");const t=nn.getVerticalBounds(h),i=nn.approximateCanvasWidth(h,e);return new $e(0,t.minY,i,t.maxY)},approximateDOMBounds(h,e){assert&&assert(h instanceof ss,"Font required");const t=1024,i=document.createElement("div");$(i).css({position:"absolute",left:0,top:0,padding:"0 !important",margin:"0 !important",display:"hidden"});const s=document.createElement("span");$(s).css("font",h.toCSS()),s.appendChild(e),s.setAttribute("direction","ltr");const n=document.createElement("div");$(n).css({"vertical-align":"baseline",display:"inline-block",width:0,height:`${t}px`,margin:"0 !important",padding:"0 !important"}),i.appendChild(s),i.appendChild(n),document.body.appendChild(i);const o=s.getBoundingClientRect(),c=i.getBoundingClientRect(),p=new $e(o.left,o.top-t,o.right+1,o.bottom-t).shiftedXY(-c.left,-c.top);return document.body.removeChild(i),p},approximateImprovedDOMBounds(h,e){assert&&assert(h instanceof ss,"Font required");const t=document.createElement("div");t.style.display="inline-block",t.style.font=h.toCSS(),t.style.color="transparent",t.style.padding="0 !important",t.style.margin="0 !important",t.style.position="absolute",t.style.left="0",t.style.top="0",t.setAttribute("direction","ltr"),t.appendChild(e),document.body.appendChild(t);const i=new $e(t.offsetLeft,t.offsetTop,t.offsetLeft+t.offsetWidth+1,t.offsetTop+t.offsetHeight+1);document.body.removeChild(t);const s=nn.getVerticalBounds(h);return i.shiftedY(s.minY)},setSVGTextAttributes(h,e,t){assert&&assert(e instanceof ss,"Font required"),assert&&assert(typeof t=="string","renderedText required"),h.setAttribute("direction","ltr"),h.setAttribute("font-family",e.getFamily()),h.setAttribute("font-size",e.getSize()),h.setAttribute("font-style",e.getStyle()),h.setAttribute("font-weight",e.getWeight()),h.setAttribute("font-stretch",e.getStretch()),h.lastChild.nodeValue=t},initializeTextBounds(){Nn=document.getElementById(Qg),Nn||(Nn=document.createElementNS(li,"svg"),Nn.setAttribute("width","2"),Nn.setAttribute("height","2"),Nn.setAttribute("id",Qg),Nn.setAttribute("style","visibility: hidden; pointer-events: none; position: absolute; left: -65535px; right: -65535px;")),Sn=document.getElementById(Zg),Sn||(Sn=document.createElementNS(li,"text"),Sn.appendChild(document.createTextNode("")),Sn.setAttribute("dominant-baseline","alphabetic"),Sn.setAttribute("text-rendering","geometricPrecision"),Sn.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),Sn.setAttribute("id",Zg),Nn.appendChild(Sn))}};te.register("TextBounds",nn);class bu{constructor(e,t,i){this.pdomInstance=e,this.trail=t,this.isRoot=i,this.isRoot=i,this.fullTrail=this.pdomInstance.trail.copy();for(let s=this.isRoot?0:1;s<this.trail.length;s++)this.fullTrail.addDescendant(this.trail.nodes[s])}}te.register("PartialPDOMTrail",bu);const tm="a11y-pdom-element",im="a11y-pdom-root",sm="a11y-pdom-list-item";Hh.addRule(`.${tm}{position: fixed;top: 0px;left: 0px;transform-origin: left top 0px;border-width: 0px;border: 0px;padding: 1px 1px;margin: 0px;white-space: nowrap;outline: none;box-shadow:none;border-color:transparent;font-size: 1px;clip: rect(1px, 1px, 1px, 1px);}`);Hh.addRule(`.${im}{position: absolute;pointer-events: none;z-index: 1;opacity: 0.0001;}`);Hh.addRule(`.${sm}{list-style: none;`);const nm={SIBLING_CLASS_NAME:tm,ROOT_CLASS_NAME:im,LIST_ITEM_CLASS_NAME:sm};te.register("PDOMSiblingStyle",nm);const dd=nm,rm="NEXT",H_="PREVIOUS",oh="INPUT",V_="LABEL",_u="BUTTON",vu="TEXTAREA",Lu="SELECT",tp="OPTGROUP",ip="DATALIST",sp="OUTPUT",np="DIV",Pu="A",z_="AREA",Ec="P",$_="IFRAME",am="B",om="STRONG",lm="I",hm="EM",cm="MARK",um="SMALL",dm="DEL",gm="INS",pm="SUB",fm="SUP",G_="BR",W_=[Pu,z_,oh,Lu,vu,_u,$_],rp=[am,om,lm,hm,cm,um,dm,gm,pm,fm,G_],U_=[oh],Y_=["focusin","focusout","input","change","click","keydown","keyup"],K_=["input","change","click","keydown","keyup"],q_=["touchstart","touchend","touchmove","touchcancel","mousedown","mouseup","mousemove","mouseover","mouseout","pointerdown","pointerup","pointermove","pointerover","pointerout","pointercancel","gotpointercapture","lostpointercapture"],X_="aria-labelledby",j_="aria-describedby",Q_="aria-activedescendant",ap="data-focusable",Z_="data-unique-id",J_=[X_,j_,Q_];function Su(h){const e=h.getElementsByTagName("*"),t=[];for(let i=0;i<e.length;i++)e[i].nodeType===Node.ELEMENT_NODE&&(t[i]=e[i]);return t}function mm(h){return h.hidden?!0:h===document.body?!1:mm(h.parentElement)}function op(h,e){const t=e||document.body,i=Su(t),s=document.activeElement,n=i.indexOf(s),o=h===rm?1:-1;let c=n+o;for(;c<i.length&&c>=0;){const p=i[c];if(c+=o,Ir.isElementFocusable(p))return p}return s}function ev(h){return h.replace(/^\s+/,"")}function lp(h){return!_.includes(U_,h.toUpperCase())}const Ir={unwrapStringProperty(h){const e=h===null?null:typeof h=="string"?h:h.value;return assert&&assert(e===null||typeof e=="string"),e},getNextFocusable(h){return op(rm,h)},getPreviousFocusable(h){return op(H_,h)},getFirstFocusable(h){const e=h||document.body,t=Su(e);let i=document.body,s=0;for(;s<t.length;){const n=t[s];if(s++,Ir.isElementFocusable(n)){i=n;break}}return i},getRandomFocusable(h){assert&&assert(h,"Random expected");const e=Su(document.body),t=[];for(let i=0;i<e.length;i++)Ir.isElementFocusable(e[i])&&t.push(e[i]);return t[h.nextInt(t.length)]},unwrapProperty(h){return ft(h)?h.value:h},containsFormattingTags(h){if(h===null)return!1;assert&&assert(typeof h=="string","unsupported type for textContent.");let e=0;const t=[],i=[];for(;e<h.length;){const o=h.indexOf("<",e),c=h.indexOf(">",e);o>-1&&(t.push(o),e=o+1),c>-1?(i.push(c),e=c+1):e++}if(t.length!==i.length||t.length===0)return!1;let s=!0;const n=h.toUpperCase();for(let o=0;o<t.length;o++){let c=n.substring(t[o]+1,i[o]);c=c.replace("/","");const p=ev(c);c.length-p.length>0||_.includes(rp,c)||(s=!1)}return s},setTextContent(h,e){if(assert&&assert(h instanceof Element),assert&&assert(e===null||typeof e=="string"),e===null)h.innerHTML="";else{const t=e.replaceAll("<br>","<br/>"),i=qu(t);Or(i,yn.STRING_WITHOUT_TEMPLATE_VARS_VALIDATOR),lp(h.tagName)&&(Ir.containsFormattingTags(i)?h.innerHTML=i:h.textContent=i)}},tagIsDefaultFocusable(h){return _.includes(W_,h.toUpperCase())},isElementFocusable(h){return!document.body.contains(h)||mm(h)||_.includes(rp,h.tagName)?!1:h.getAttribute(ap)==="true"},tagNameSupportsContent(h){return lp(h)},removeElements(h,e){for(let t=0;t<e.length;t++){const i=e[t];assert&&assert(h.contains(i),"element does not contain child to be removed: ",i),h.removeChild(i)}},insertElements(h,e,t){assert&&assert(h instanceof self.Element),assert&&assert(Array.isArray(e));for(let i=0;i<e.length;i++){const s=e[i];h.insertBefore(s,t||null)}},createElement(h,e,t){t=ds({namespace:null,id:null},t);const i=t.namespace?document.createElementNS(t.namespace,h):document.createElement(h);return t.id&&(i.id=t.id),Ir.overrideFocusWithTabIndex(i,e),i.classList.add(dd.SIBLING_CLASS_NAME),i},overrideFocusWithTabIndex(h,e){Ir.tagIsDefaultFocusable(h.tagName)!==e?h.tabIndex=e?0:-1:h.removeAttribute("tabindex"),h.setAttribute(ap,e)},TAGS:{INPUT:oh,LABEL:V_,BUTTON:_u,TEXTAREA:vu,SELECT:Lu,OPTGROUP:tp,DATALIST:ip,OUTPUT:sp,DIV:np,A:Pu,P:Ec,B:am,STRONG:om,I:lm,EM:hm,MARK:cm,SMALL:um,DEL:dm,INS:gm,SUB:pm,SUP:fm},FORM_ELEMENTS:[oh,_u,vu,Lu,tp,ip,sp,Pu],DEFAULT_CONTAINER_TAG_NAME:np,DEFAULT_DESCRIPTION_TAG_NAME:Ec,DEFAULT_LABEL_TAG_NAME:Ec,ASSOCIATION_ATTRIBUTES:J_,INPUT_TYPES_THAT_SUPPORT_CHECKED:["RADIO","CHECKBOX"],DOM_EVENTS:Y_,USER_GESTURE_EVENTS:K_,BLOCKED_DOM_EVENTS:q_,DATA_PDOM_UNIQUE_ID:Z_,PDOM_UNIQUE_ID_SEPARATOR:"-",DATA_EXCLUDE_FROM_INPUT:"data-exclude-from-input"};te.register("PDOMUtils",Ir);const Dt=Ir,tv=_.hasIn(self,"phet.chipper.queryParameters.colorProfile")?phet.chipper.queryParameters.colorProfile:Er.DEFAULT_COLOR_PROFILE,iv=_.hasIn(self,"phet.chipper.colorProfiles")?phet.chipper.colorProfiles:[Er.DEFAULT_COLOR_PROFILE],bl=new Nh(tv,{tandem:ai.GENERAL_VIEW.createTandem("colorProfileProperty"),phetioFeatured:!0,validValues:iv});te.register("colorProfileProperty",bl);const sv=".",Go=[];class nv extends em{constructor(e,t,i,s){const n=st()({valueComparisonStrategy:"equalsFunction",tandemNameSuffix:["ColorProperty","FillProperty","StrokeProperty"]},s);if(i=_.mapValues(i,o=>qe.toColor(o).setImmutable()),assert&&assert(i.hasOwnProperty(Er.DEFAULT_COLOR_PROFILE),"default color profile must be provided"),assert&&assert(!!i[Er.DEFAULT_COLOR_PROFILE],"default color profile must be truthy"),super(qe.toColor(i[bl.value]||i[Er.DEFAULT_COLOR_PROFILE]),n),this.colorProfileMap=i,bl.link(o=>{this.value=qe.toColor(this.colorProfileMap[o]||this.colorProfileMap[Er.DEFAULT_COLOR_PROFILE])}),this.name=`${e.name}${sv}${t}`,this.link(o=>{self.parent!==window&&self.parent.postMessage(JSON.stringify({type:"reportColor",name:this.name,value:o.toHexString(),alpha:o.getAlpha()}),"*")}),assert){const o=Go.filter(c=>c.name===this.name);assert&&assert(o.length===0,"cannot use the same name for two different ProfileColorProperty instances: "+name)}Go.push(this)}dispose(){is(Go,this),super.dispose()}}self.addEventListener("message",h=>{let e;try{e=JSON.parse(h.data)}catch{}if(e&&e.type==="setColor")for(let t=0;t<Go.length;t++){const i=Go[t];i.name===e.name&&(i.colorProfileMap[bl.value]=new qe(e.value).withAlpha(e.alpha),i.value=qe.toColor(i.colorProfileMap[bl.value]))}});te.register("ProfileColorProperty",nv);let rv=1;class mn{constructor(){this.id=`paint${rv++}`,this.transformMatrix=null}setTransformMatrix(e){return this.transformMatrix!==e&&(this.transformMatrix=e),this}toString(){return this.id}}mn.prototype.isPaint=!0;te.register("Paint",mn);class Vs extends mn{constructor(){super(),assert&&assert(this.constructor.name!=="Gradient","Please create a LinearGradient or RadialGradient. Do not directly use the supertype Gradient."),this.stops=[],this.lastStopRatio=0,this.canvasGradient=null,this.colorStopsDirty=!1,this.lastColorStopValues=[]}addColorStop(e,t){if(assert&&assert(e>=0&&e<=1,"Ratio needs to be between 0,1 inclusively"),assert&&assert(t===null||typeof t=="string"||t instanceof qe||ft(t)&&(t.value===null||typeof t.value=="string"||t.value instanceof qe),"Color should match the addColorStop type specification"),this.lastStopRatio>e)throw new Error("Color stops not specified in the order of increasing ratios");return this.lastStopRatio=e,this.stops.push({ratio:e,color:t}),this.lastColorStopValues.push(""),this}getSVGStops(){return this.stops}invalidateCanvasGradient(){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`Invalidated Canvas Gradient for #${this.id}`),this.colorStopsDirty=!0}haveCanvasColorStopsChanged(){if(this.lastColorStopValues===null)return!0;for(let e=0;e<this.stops.length;e++)if(Vs.colorToString(this.stops[e].color)!==this.lastColorStopValues[e])return!0;return!1}getCanvasStyle(){if(!this.canvasGradient||this.colorStopsDirty&&this.haveCanvasColorStopsChanged()){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`Regenerating Canvas Gradient for #${this.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.colorStopsDirty=!1,vt(this.lastColorStopValues),this.canvasGradient=this.createCanvasGradient();for(let e=0;e<this.stops.length;e++){const t=this.stops[e],i=Vs.colorToString(t.color);this.canvasGradient.addColorStop(t.ratio,i),this.lastColorStopValues.push(i)}sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}return this.canvasGradient}static colorToString(e){return ft(e)&&(e=e.value),e===null&&(e="transparent"),e instanceof qe&&(e=e.toCSS()),e}}Vs.prototype.isGradient=!0;te.register("Gradient",Vs);class $a extends Vs{constructor(e,t,i,s){assert&&assert(isFinite(e)&&isFinite(t)&&isFinite(i)&&isFinite(s)),super(),this.start=new Pe(e,t),this.end=new Pe(i,s)}createCanvasGradient(){return te.scratchContext.createLinearGradient(this.start.x,this.start.y,this.end.x,this.end.y)}createSVGPaint(e){return hh.pool.create(e,this)}toString(){let e=`new phet.scenery.LinearGradient( ${this.start.x}, ${this.start.y}, ${this.end.x}, ${this.end.y} )`;return _.each(this.stops,t=>{e+=`.addColorStop( ${t.ratio}, ${gd.scenerySerialize(t.color)} )`}),e}}$a.prototype.isLinearGradient=!0;te.register("LinearGradient",$a);class Ga extends Vs{constructor(e,t,i,s,n,o){if(super(),this.start=new Pe(e,t),this.end=new Pe(s,n),Ui.safari){const c=(e+s)/2,p=(t+n)/2;this.start.x=c,this.start.y=p,this.end.x=c,this.end.y=p}this.startRadius=i,this.endRadius=o,this.focalPoint=this.start.plus(this.end.minus(this.start).times(this.startRadius/(this.startRadius-this.endRadius))),this.startIsLarger=this.startRadius>this.endRadius,this.largePoint=this.startIsLarger?this.start:this.end,this.maxRadius=Math.max(this.startRadius,this.endRadius),this.minRadius=Math.min(this.startRadius,this.endRadius),this.startRadius>=this.endRadius?assert&&assert(this.focalPoint.minus(this.start).magnitude<=this.startRadius):assert&&assert(this.focalPoint.minus(this.end).magnitude<=this.endRadius)}createCanvasGradient(){return te.scratchContext.createRadialGradient(this.start.x,this.start.y,this.startRadius,this.end.x,this.end.y,this.endRadius)}createSVGPaint(e){return ch.pool.create(e,this)}getSVGStops(){const e=this.startIsLarger,t=this.maxRadius,i=this.minRadius;function s(c,p,f,w,O){return f+(O-c)*(w-f)/(p-c)}function n(c){let p=e?1-c.ratio:c.ratio;return i>0&&(p=s(0,1,i/t,1,p)),{ratio:p,color:c.color}}const o=this.stops.map(n);return e&&o.reverse(),o}toString(){let e=`new phet.scenery.RadialGradient( ${this.start.x}, ${this.start.y}, ${this.startRadius}, ${this.end.x}, ${this.end.y}, ${this.endRadius} )`;return _.each(this.stops,t=>{e+=`.addColorStop( ${t.ratio}, ${gd.scenerySerialize(t.color)} )`}),e}}Ga.prototype.isRadialGradient=!0;te.register("RadialGradient",Ga);class Hr extends mn{constructor(e){super(),this.image=e,this.canvasPattern=te.scratchContext.createPattern(e,"repeat")}getCanvasStyle(){return this.canvasPattern}createSVGPaint(e){return uh.pool.create(this)}toString(){return`new phet.scenery.Pattern( $( '<img src="${this.image.src}"/>' )[0] )`}}Hr.prototype.isPattern=!0;te.register("Pattern",Hr);class ym extends Hr{constructor(e,t,i,s,n,o,c=Ze.IDENTITY){assert&&assert(t>0&&Number.isInteger(t),"Resolution should be a positive integer"),assert&&assert(Number.isInteger(n)),assert&&assert(Number.isInteger(o));const p=document.createElement("img");function f(O,T,z,U,m){p.src=O.toDataURL()}new tt({scale:t,children:[e]}).toCanvas(f,-i*t,-s*t,n*t,o*t),super(p),this.setTransformMatrix(c.timesMatrix(Ze.scaling(1/t)))}}te.register("NodePattern",ym);let av=1;class Vr{constructor(){this.id=`filter${av++}`,this.filterRegionPercentageIncrease=0}isDOMCompatible(){return!1}isSVGCompatible(){return!1}isCanvasCompatible(){return ht.canvasFilter?this.isDOMCompatible():!1}isWebGLCompatible(){return!1}toString(){return this.id}static applyColorMatrix(e,t,i,s){const n=document.createElementNS(li,"feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("values",e),n.setAttribute("in",i),n.setAttribute("color-interpolation-filters","sRGB"),s&&n.setAttribute("result",s),t.appendChild(n)}}te.register("Filter",Vr);const kc=new ao,eo=h=>{assert&&assert(Array.isArray(h),"OrIO needs to be an array"),assert&&assert(h.length>1,"OrIO needs parameterTypes");const e=h.map(i=>i.typeName),t=e.join(",");if(!kc.has(t)){const i=s=>{for(let n=0;n<h.length;n++){const o=h[n];if(yn.isValueValid(s,o.validator))return!0}return!1};kc.set(t,new Ai(`OrIO<${e.join(", ")}>`,{documentation:"A PhET-iO Type adding support for a composite type that can be any of its parameters.",parameterTypes:h,isValidValue:i,toStateObject:s=>{for(let n=0;n<h.length;n++){const o=h[n];if(yn.isValueValid(s,o.validator))return{index:n,state:o.toStateObject(s)}}throw new Error("somehow the instance was not valid, we should not get here. Why was isValidValue not used before this step?")},fromStateObject:s=>(assert&&assert(s.hasOwnProperty("index"),"index required for deserialization"),assert&&assert(s.hasOwnProperty("state"),"state required for deserialization"),h[s.index].fromStateObject(s.state)),stateSchema:Uu.asValue(`${e.join("|")}`,{isValidValue:s=>typeof s.index=="number"?h[s.index].isStateObjectValid(s.state):!1})}))}return kc.get(t)};Wr.register("OrIO",eo);class bm extends Error{constructor(){super("CouldNotYetDeserializeError")}}Wr.register("CouldNotYetDeserializeError",bm);const Oc=new ao,_m=h=>{assert&&assert(h,"ReferenceIO needs parameterType");const e=h;return Oc.has(e)||(assert&&assert(typeof h.typeName=="string","type name should be a string"),Oc.set(e,new Ai(`ReferenceIO<${h.typeName}>`,{isValidValue:t=>yn.isValueValid(t,h.validator),documentation:"Uses reference identity for serializing and deserializing, and validates based on its parameter PhET-iO Type.",parameterTypes:[h],toStateObject(t){return{phetioID:t.tandem.phetioID}},stateSchema:{phetioID:Ti},fromStateObject(t){if(assert&&assert(t&&typeof t.phetioID=="string","phetioID should be a string"),phet.phetio.phetioEngine.hasPhetioObject(t.phetioID))return phet.phetio.phetioEngine.getPhetioElement(t.phetioID);throw new bm},applyState(t){assert&&assert(!1,`ReferenceIO is meant to be used as DataType serialization (see fromStateObject) for phetioID: ${t.tandem.phetioID}`)}}))),Oc.get(e)};Wr.register("ReferenceIO",_m);const _l={isColorDef(h){return h===null||typeof h=="string"||h instanceof qe||ft(h)&&(h.value===null||typeof h.value=="string"||h.value instanceof qe)},scenerySerialize(h){return h===null?"null":h instanceof qe?`'${h.toCSS()}'`:typeof h=="string"?`'${h}'`:_l.scenerySerialize(h.value)},ColorDefIO:null};_l.ColorDefIO=new Ai("ColorDefIO",{isValidValue:_l.isColorDef,supertype:Ft(eo([Ti,qe.ColorIO,_m(wi.PropertyIO(Ft(eo([Ti,qe.ColorIO]))))]))});te.register("ColorDef",_l);const gd=_l,ar={isPaintDef(h){return h===null||typeof h=="string"||h instanceof qe||h instanceof mn||ft(h)&&(h.value===null||typeof h.value=="string"||h.value instanceof qe)},toColor(h){if(typeof h=="string")return new qe(h);if(h instanceof qe)return h.copy();if(ft(h))return ar.toColor(h.value);if(h instanceof Vs){let e=qe.TRANSPARENT;const t=0;return h.stops.forEach(i=>{e=e.blend(ar.toColor(i.color),1/(t+1))}),e}return qe.TRANSPARENT}};te.register("PaintDef",ar);const ov=(h,e,t)=>{const i=new ci(!0,_i({tandem:e.createTandem("selfVisibleProperty"),phetioFeatured:!0,phetioDocumentation:"Provides an additional way to toggle the visibility for the PhET-iO Element."},t)),s=Si.and([h,i],{tandem:e.createTandem("visibleProperty"),phetioValueType:Dr,phetioDocumentation:`Whether the PhET-iO Element is visible, see ${i.tandem.name} for customization.`});return s.disposeEmitter.addListener(()=>i.dispose()),s};te.register("createGatedVisibleProperty",ov);const lv=Yt.supportsImageDataCanvasFilter(),hv=Ui.chromium;class ba extends Vr{constructor(e,t,i,s,n,o,c,p,f,w,O,T,z,U,m,Y,j,le,xe,ce){assert&&assert(isFinite(e),"m00 should be a finite number"),assert&&assert(isFinite(t),"m01 should be a finite number"),assert&&assert(isFinite(i),"m02 should be a finite number"),assert&&assert(isFinite(s),"m03 should be a finite number"),assert&&assert(isFinite(n),"m04 should be a finite number"),assert&&assert(isFinite(o),"m10 should be a finite number"),assert&&assert(isFinite(c),"m11 should be a finite number"),assert&&assert(isFinite(p),"m12 should be a finite number"),assert&&assert(isFinite(f),"m13 should be a finite number"),assert&&assert(isFinite(w),"m14 should be a finite number"),assert&&assert(isFinite(O),"m20 should be a finite number"),assert&&assert(isFinite(T),"m21 should be a finite number"),assert&&assert(isFinite(z),"m22 should be a finite number"),assert&&assert(isFinite(U),"m23 should be a finite number"),assert&&assert(isFinite(m),"m24 should be a finite number"),assert&&assert(isFinite(Y),"m30 should be a finite number"),assert&&assert(isFinite(j),"m31 should be a finite number"),assert&&assert(isFinite(le),"m32 should be a finite number"),assert&&assert(isFinite(xe),"m33 should be a finite number"),assert&&assert(isFinite(ce),"m34 should be a finite number"),super(),this.m00=e,this.m01=t,this.m02=i,this.m03=s,this.m04=n,this.m10=o,this.m11=c,this.m12=p,this.m13=f,this.m14=w,this.m20=O,this.m21=T,this.m22=z,this.m23=U,this.m24=m,this.m30=Y,this.m31=j,this.m32=le,this.m33=xe,this.m34=ce}applySVGFilter(e,t,i){Vr.applyColorMatrix(`${ni(this.m00)} ${ni(this.m01)} ${ni(this.m02)} ${ni(this.m03)} ${ni(this.m04)} ${ni(this.m10)} ${ni(this.m11)} ${ni(this.m12)} ${ni(this.m13)} ${ni(this.m14)} ${ni(this.m20)} ${ni(this.m21)} ${ni(this.m22)} ${ni(this.m23)} ${ni(this.m24)} ${ni(this.m30)} ${ni(this.m31)} ${ni(this.m32)} ${ni(this.m33)} ${ni(this.m34)}`,e,t,i)}applyCanvasFilter(e){const t=e.canvas.width,i=e.canvas.height,s=e.context.getImageData(0,0,t,i),n=t*i;for(let o=0;o<n;o++){const c=o*4;if(hv){const f=Math.pow(s.data[c+0]/255,1.45),w=Math.pow(s.data[c+1]/255,1.45),O=Math.pow(s.data[c+2]/255,1.45),T=Math.pow(s.data[c+3]/255,1.45);s.data[c+0]=255*Math.pow(f*this.m00+w*this.m01+O*this.m02+T*this.m03+this.m04,1/1.45),s.data[c+1]=255*Math.pow(f*this.m10+w*this.m11+O*this.m12+T*this.m13+this.m14,1/1.45),s.data[c+2]=255*Math.pow(f*this.m20+w*this.m21+O*this.m22+T*this.m23+this.m24,1/1.45),s.data[c+3]=255*Math.pow(f*this.m30+w*this.m31+O*this.m32+T*this.m33+this.m34,1/1.45)}else{const p=s.data[c+0],f=s.data[c+1],w=s.data[c+2],O=s.data[c+3];s.data[c+0]=p*this.m00+f*this.m01+w*this.m02+O*this.m03+this.m04,s.data[c+1]=p*this.m10+f*this.m11+w*this.m12+O*this.m13+this.m14,s.data[c+2]=p*this.m20+f*this.m21+w*this.m22+O*this.m23+this.m24,s.data[c+3]=p*this.m30+f*this.m31+w*this.m32+O*this.m33+this.m34}}e.context.putImageData(s,0,0)}isSVGCompatible(){return!0}isCanvasCompatible(){return super.isCanvasCompatible()||lv}getCSSFilterString(){throw new Error("unimplemented")}}te.register("ColorMatrixFilter",ba);const Th=class Th extends ba{constructor(e){assert&&assert(isFinite(e),"Brightness amount should be finite"),assert&&assert(e>=0,"Brightness amount should be non-negative"),super(e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0),this.amount=e}getCSSFilterString(){return`brightness(${ni(this.amount)})`}isDOMCompatible(){return!0}};Th.BLACKEN=new Th(0);let wu=Th;te.register("Brightness",wu);const xh=class xh extends ba{constructor(e){assert&&assert(isFinite(e),"Contrast amount should be finite"),assert&&assert(e>=0,"Contrast amount should be non-negative"),super(e,0,0,0,-(.5*e)+.5,0,e,0,0,-(.5*e)+.5,0,0,e,0,-(.5*e)+.5,0,0,0,1,0),this.amount=e}getCSSFilterString(){return`contrast(${ni(this.amount)})`}isDOMCompatible(){return!0}};xh.GRAY=new xh(0);let Cu=xh;te.register("Contrast",Cu);class cv extends Vr{constructor(e,t,i,s=15){assert&&assert(e.isFinite(),"DropShadow offset should be finite"),assert&&assert(isFinite(t),"DropShadow blurRadius should be finite"),assert&&assert(t>=0,"DropShadow blurRadius should be non-negative"),assert&&assert(gd.isColorDef(i),"DropShadow color should be a ColorDef"),super(),this.offset=e,this.blurRadius=t,this.color=i,this.colorCSS=ar.toColor(i).toCSS(),this.filterRegionPercentageIncrease=s}getCSSFilterString(){return`drop-shadow(${ni(this.offset.x)}px ${ni(this.offset.y)}px ${ni(this.blurRadius)}px ${this.colorCSS})`}isDOMCompatible(){return!0}applyCanvasFilter(){throw new Error("unimplemented")}applySVGFilter(e,t,i){throw new Error("unimplemented")}}te.register("DropShadow",cv);class uv extends Vr{constructor(e,t=15){assert&&assert(isFinite(e),"GaussianBlur standardDeviation should be finite"),assert&&assert(e>=0,"GaussianBlur standardDeviation should be non-negative"),super(),this.standardDeviation=e,this.filterRegionPercentageIncrease=t}getCSSFilterString(){return`blur(${ni(this.standardDeviation)}px)`}applySVGFilter(e,t,i){const s=document.createElementNS(li,"feGaussianBlur");s.setAttribute("stdDeviation",ni(this.standardDeviation)),s.setAttribute("edgeMode","none"),e.appendChild(s),s.setAttribute("in",t),i&&s.setAttribute("result",i),e.appendChild(s)}isDOMCompatible(){return!0}isSVGCompatible(){return!0}applyCanvasFilter(e){throw new Error("unimplemented")}}te.register("GaussianBlur",uv);const Ih=class Ih extends ba{constructor(e=1){assert&&assert(isFinite(e),"Grayscale amount should be finite"),assert&&assert(e>=0,"Grayscale amount should be non-negative"),assert&&assert(e<=1,"Grayscale amount should be no greater than 1");const t=1-e;super(.2126+.7874*t,.7152-.7152*t,.0722-.0722*t,0,0,.2126-.2126*t,.7152+.2848*t,.0722-.0722*t,0,0,.2126-.2126*t,.7152-.7152*t,.0722+.9278*t,0,0,0,0,0,1,0),this.amount=e}getCSSFilterString(){return`grayscale(${ni(this.amount)})`}isDOMCompatible(){return!0}};Ih.FULL=new Ih(1);let Tu=Ih;te.register("Grayscale",Tu);class dv extends ba{constructor(e){assert&&assert(isFinite(e),"HueRotate amount should be finite"),assert&&assert(e>=0,"HueRotate amount should be non-negative");const t=Math.cos(e),i=Math.sin(e);super(.213+.787*t-.213*i,.715-.715*t-.715*i,.072-.072*t+.928*i,0,0,.213-.213*t+.143*i,.715+.285*t+.14*i,.072-.072*t-.283*i,0,0,.213-.213*t-.787*i,.715-.715*t+.715*i,.072+.928*t+.072*i,0,0,0,0,0,1,0),this.amount=e}getCSSFilterString(){return`hue-rotate(${ni(ct.toDegrees(this.amount))}deg)`}isDOMCompatible(){return!0}}te.register("HueRotate",dv);const Dh=class Dh extends Vr{constructor(e=1){assert&&assert(isFinite(e),"Invert amount should be finite"),assert&&assert(e>=0,"Invert amount should be non-negative"),assert&&assert(e<=1,"Invert amount should be no greater than 1"),super(),this.amount=e}getCSSFilterString(){return`invert(${ni(this.amount)})`}isDOMCompatible(){return!0}applyCanvasFilter(e){throw new Error("unimplemented")}applySVGFilter(e,t,i){throw new Error("unimplemented")}};Dh.FULL=new Dh(1);let xu=Dh;te.register("Invert",xu);class gv extends Vr{constructor(e){assert&&assert(isFinite(e),"Opacity amount should be finite"),assert&&assert(e>=0,"Opacity amount should be non-negative"),assert&&assert(e<=1,"Opacity amount should be no greater than 1"),super(),this.amount=e}getCSSFilterString(){return`opacity(${ni(this.amount)})`}isDOMCompatible(){return!0}applyCanvasFilter(e){throw new Error("unimplemented")}applySVGFilter(e,t,i){throw new Error("unimplemented")}}te.register("Opacity",gv);class pv extends ba{constructor(e){assert&&assert(isFinite(e),"Saturate amount should be finite"),assert&&assert(e>=0,"Saturate amount should be non-negative"),super(.213+.787*e,.715-.715*e,.072-.072*e,0,0,.213-.213*e,.715-.285*e,.072-.072*e,0,0,.213-.213*e,.715-.715*e,.072-.928*e,0,0,0,0,0,1,0),this.amount=e}getCSSFilterString(){return`saturate(${ni(this.amount)})`}isDOMCompatible(){return!0}}te.register("Saturate",pv);const Ah=class Ah extends ba{constructor(e=1){assert&&assert(isFinite(e),"Sepia amount should be finite"),assert&&assert(e>=0,"Sepia amount should be non-negative"),assert&&assert(e<=1,"Sepia amount should be at most 1"),super(.393+.607*(1-e),.769-.769*(1-e),.189-.189*(1-e),0,0,.349-.349*(1-e),.686+.314*(1-e),.168-.168*(1-e),0,0,.272-.272*(1-e),.534-.534*(1-e),.131+.869*(1-e),0,0,0,0,0,1,0),this.amount=e}getCSSFilterString(){return`sepia(${ni(this.amount)})`}isDOMCompatible(){return!0}};Ah.FULL=new Ah(1);let Iu=Ah;te.register("Sepia",Iu);const xa=Dt.TAGS.INPUT,vm=Dt.TAGS.P,fv=vm,mv=vm,yv=(h,e,t)=>(e.labelTagName=`h${h.headingLevel}`,e.labelContent=t,e),Lo=h=>{const e=h===null?null:typeof h=="string"?h:h.value;return assert&&assert(e===null||typeof e=="string"),e},bv=Dt.FORM_ELEMENTS,hp=Dt.INPUT_TYPES_THAT_SUPPORT_CHECKED,_v=Dt.ASSOCIATION_ATTRIBUTES,Du=["focusable","tagName","accessibleName","accessibleNameBehavior","helpText","helpTextBehavior","pdomHeading","pdomHeadingBehavior","containerTagName","containerAriaRole","innerContent","inputType","inputValue","pdomChecked","pdomNamespace","ariaLabel","ariaRole","ariaValueText","labelTagName","labelContent","appendLabel","descriptionTagName","descriptionContent","appendDescription","focusHighlight","focusHighlightLayerable","groupFocusHighlight","pdomVisibleProperty","pdomVisible","pdomOrder","ariaLabelledbyAssociations","ariaDescribedbyAssociations","activeDescendantAssociations","focusPanTargetBoundsProperty","limitPanDirection","positionInPDOM","pdomTransformSourceNode"];class vl extends Hi{constructor(e){super(e),this._inputValue=null,this._labelContent=null,this._innerContent=null,this._descriptionContent=null,this._ariaLabel=null,this._hasAppliedAriaLabel=!1,this._ariaValueText=null,this._hasAppliedAriaValueText=!1,this._accessibleName=null,this._helpText=null,this._pdomHeading=null,this.focusHighlightChangedEmitter=new ri,this.pdomParentChangedEmitter=new ri,this.pdomDisplaysEmitter=new ri,this._onPDOMContentChangeListener=this.onPDOMContentChange.bind(this),this._onInputValueChangeListener=this.invalidatePeerInputValue.bind(this),this._onAriaLabelChangeListener=this.onAriaLabelChange.bind(this),this._onAriaValueTextChangeListener=this.onAriaValueTextChange.bind(this),this._onLabelContentChangeListener=this.invalidatePeerLabelSiblingContent.bind(this),this._onDescriptionContentChangeListener=this.invalidatePeerDescriptionSiblingContent.bind(this),this._onInnerContentChangeListener=this.onInnerContentPropertyChange.bind(this),this._tagName=null,this._containerTagName=null,this._labelTagName=null,this._descriptionTagName=null,this._inputType=null,this._pdomChecked=!1,this._appendLabel=!1,this._appendDescription=!1,this._pdomAttributes=[],this._pdomClasses=[],this._pdomNamespace=null,this._ariaRole=null,this._containerAriaRole=null,this._ariaLabelledbyAssociations=[],this._nodesThatAreAriaLabelledbyThisNode=[],this._ariaDescribedbyAssociations=[],this._nodesThatAreAriaDescribedbyThisNode=[],this._activeDescendantAssociations=[],this._nodesThatAreActiveDescendantToThisNode=[],this._focusableOverride=null,this._focusHighlight=null,this._focusHighlightLayerable=!1,this._groupFocusHighlight=!1,this._pdomOrder=null,this._pdomParent=null,this._pdomTransformSourceNode=null,this._focusPanTargetBoundsProperty=null,this._limitPanDirection=null,this._pdomDisplaysInfo=new wm(this),this._pdomInstances=[],this._positionInPDOM=!1,this.excludeLabelSiblingFromInput=!1,this._pdomVisibleProperty=new $n(!0,!1,this.onPdomVisiblePropertyChange.bind(this)),this._accessibleNameBehavior=vl.BASIC_ACCESSIBLE_NAME_BEHAVIOR,this._helpTextBehavior=vl.HELP_TEXT_AFTER_CONTENT,this._headingLevel=null,this._pdomHeadingBehavior=yv,this.pdomBoundInputEnabledListener=this.pdomInputEnabledListener.bind(this)}disposeParallelDOM(){if(ft(this._accessibleName)&&!this._accessibleName.isDisposed&&(this._accessibleName.unlink(this._onPDOMContentChangeListener),this._accessibleName=null),ft(this._helpText)&&!this._helpText.isDisposed&&(this._helpText.unlink(this._onPDOMContentChangeListener),this._helpText=null),ft(this._pdomHeading)&&!this._pdomHeading.isDisposed&&(this._pdomHeading.unlink(this._onPDOMContentChangeListener),this._pdomHeading=null),ft(this._inputValue)&&!this._inputValue.isDisposed&&(this._inputValue.unlink(this._onPDOMContentChangeListener),this._inputValue=null),ft(this._ariaLabel)&&!this._ariaLabel.isDisposed&&this._ariaLabel.unlink(this._onAriaLabelChangeListener),ft(this._ariaValueText)&&!this._ariaValueText.isDisposed&&this._ariaValueText.unlink(this._onAriaValueTextChangeListener),ft(this._innerContent)&&!this._innerContent.isDisposed&&this._innerContent.unlink(this._onInnerContentChangeListener),ft(this._labelContent)&&!this._labelContent.isDisposed&&this._labelContent.unlink(this._onLabelContentChangeListener),ft(this._descriptionContent)&&!this._descriptionContent.isDisposed&&this._descriptionContent.unlink(this._onDescriptionContentChangeListener),this.inputEnabledProperty.unlink(this.pdomBoundInputEnabledListener),this.pdomOrder=null,this._pdomParent){assert&&assert(this._pdomParent._pdomOrder,"pdomParent should have a pdomOrder");const e=this._pdomParent._pdomOrder.slice();is(e,this),this._pdomParent.pdomOrder=e}this.setPDOMTransformSourceNode(null),this.setAriaLabelledbyAssociations([]),this.setAriaDescribedbyAssociations([]),this.setActiveDescendantAssociations([]),this.removePDOMAttributes(),this._pdomVisibleProperty.dispose()}pdomInputEnabledListener(e){this.setPDOMAttribute("aria-disabled",!e),this.setPDOMAttribute("onclick",e?"":"return false")}isFocused(){for(let e=0;e<this._pdomInstances.length;e++)if(this._pdomInstances[e].peer.isFocused())return!0;return!1}get focused(){return this.isFocused()}focus(){if(this._pdomInstances.length>0){assert&&assert(this.focusable,"trying to set focus on a node that is not focusable"),assert&&assert(this.pdomVisible,"trying to set focus on a node with invisible pdom content"),assert&&assert(this._pdomInstances.length===1,"focus() unsupported for Nodes using DAG, pdom content is not unique");const e=this._pdomInstances[0].peer;assert&&assert(e,"must have a peer to focus"),e.focus()}}blur(){if(this._pdomInstances.length>0){assert&&assert(this._pdomInstances.length===1,"blur() unsupported for Nodes using DAG, pdom content is not unique");const e=this._pdomInstances[0].peer;assert&&assert(e,"must have a peer to blur"),e.blur()}}pdomAudit(){this.hasPDOMContent&&assert&&(this._inputType&&assert(this._tagName.toUpperCase()===xa,"tagName must be INPUT to support inputType"),this._pdomChecked&&assert(this._tagName.toUpperCase()===xa,"tagName must be INPUT to support pdomChecked."),this._inputValue&&assert(this._tagName.toUpperCase()===xa,"tagName must be INPUT to support inputValue"),this._pdomChecked&&assert(hp.includes(this._inputType.toUpperCase()),`inputType does not support checked attribute: ${this._inputType}`),this._focusHighlightLayerable&&assert(this.focusHighlight instanceof tt,"focusHighlight must be Node if highlight is layerable"),this._tagName.toUpperCase()===xa&&assert(typeof this._inputType=="string"," inputType expected for input"),this.ariaRole==="application"&&assert(this.innerContent||this.accessibleName,"must have some innerContent or element will never be focusable in VoiceOver"));for(let e=0;e<this.children.length;e++)this.children[e].pdomAudit()}setAccessibleName(e){e!==this._accessibleName&&(ft(this._accessibleName)&&!this._accessibleName.isDisposed&&this._accessibleName.unlink(this._onPDOMContentChangeListener),this._accessibleName=e,ft(e)&&e.lazyLink(this._onPDOMContentChangeListener),this.onPDOMContentChange())}set accessibleName(e){this.setAccessibleName(e)}get accessibleName(){return this.getAccessibleName()}getAccessibleName(){return ft(this._accessibleName)?this._accessibleName.value:this._accessibleName}removeFromPDOM(){assert&&assert(this._tagName!==null,"There is no pdom content to clear from the PDOM"),this.tagName=null}setAccessibleNameBehavior(e){this._accessibleNameBehavior!==e&&(this._accessibleNameBehavior=e,this.onPDOMContentChange())}set accessibleNameBehavior(e){this.setAccessibleNameBehavior(e)}get accessibleNameBehavior(){return this.getAccessibleNameBehavior()}getAccessibleNameBehavior(){return this._accessibleNameBehavior}setPDOMHeading(e){e!==this._pdomHeading&&(ft(this._pdomHeading)&&!this._pdomHeading.isDisposed&&this._pdomHeading.unlink(this._onPDOMContentChangeListener),this._pdomHeading=e,ft(e)&&e.lazyLink(this._onPDOMContentChangeListener),this.onPDOMContentChange())}set pdomHeading(e){this.setPDOMHeading(e)}get pdomHeading(){return this.getPDOMHeading()}getPDOMHeading(){return ft(this._pdomHeading)?this._pdomHeading.value:this._pdomHeading}setPDOMHeadingBehavior(e){this._pdomHeadingBehavior!==e&&(this._pdomHeadingBehavior=e,this.onPDOMContentChange())}set pdomHeadingBehavior(e){this.setPDOMHeadingBehavior(e)}get pdomHeadingBehavior(){return this.getPDOMHeadingBehavior()}getPDOMHeadingBehavior(){return this._pdomHeadingBehavior}getHeadingLevel(){return this._headingLevel}get headingLevel(){return this.getHeadingLevel()}computeHeadingLevel(){if(!this._pdomParent)return this.pdomHeading?(this._headingLevel=1,1):0;if(this.pdomHeading){const e=this._pdomParent.computeHeadingLevel()+1;return this._headingLevel=e,e}else return this._pdomParent.computeHeadingLevel()}setHelpText(e){e!==this._helpText&&(ft(this._helpText)&&!this._helpText.isDisposed&&this._helpText.unlink(this._onPDOMContentChangeListener),this._helpText=e,ft(e)&&e.lazyLink(this._onPDOMContentChangeListener),this.onPDOMContentChange())}set helpText(e){this.setHelpText(e)}get helpText(){return this.getHelpText()}getHelpText(){return ft(this._helpText)?this._helpText.value:this._helpText}setHelpTextBehavior(e){this._helpTextBehavior!==e&&(this._helpTextBehavior=e,this.onPDOMContentChange())}set helpTextBehavior(e){this.setHelpTextBehavior(e)}get helpTextBehavior(){return this.getHelpTextBehavior()}getHelpTextBehavior(){return this._helpTextBehavior}setTagName(e){assert&&assert(e===null||typeof e=="string"),e!==this._tagName&&(this._tagName=e,this.onPDOMContentChange())}set tagName(e){this.setTagName(e)}get tagName(){return this.getTagName()}getTagName(){return this._tagName}setLabelTagName(e){assert&&assert(e===null||typeof e=="string"),e!==this._labelTagName&&(this._labelTagName=e,this.onPDOMContentChange())}set labelTagName(e){this.setLabelTagName(e)}get labelTagName(){return this.getLabelTagName()}getLabelTagName(){return this._labelTagName}setDescriptionTagName(e){assert&&assert(e===null||typeof e=="string"),e!==this._descriptionTagName&&(this._descriptionTagName=e,this.onPDOMContentChange())}set descriptionTagName(e){this.setDescriptionTagName(e)}get descriptionTagName(){return this.getDescriptionTagName()}getDescriptionTagName(){return this._descriptionTagName}setInputType(e){if(assert&&assert(e===null||typeof e=="string"),assert&&this.tagName&&assert(this._tagName.toUpperCase()===xa,"tag name must be INPUT to support inputType"),e!==this._inputType){this._inputType=e;for(let t=0;t<this._pdomInstances.length;t++){const i=this._pdomInstances[t].peer;e===null?i.removeAttributeFromElement("type"):i.setAttributeToElement("type",e)}}}set inputType(e){this.setInputType(e)}get inputType(){return this.getInputType()}getInputType(){return this._inputType}setAppendLabel(e){this._appendLabel!==e&&(this._appendLabel=e,this.onPDOMContentChange())}set appendLabel(e){this.setAppendLabel(e)}get appendLabel(){return this.getAppendLabel()}getAppendLabel(){return this._appendLabel}setAppendDescription(e){this._appendDescription!==e&&(this._appendDescription=e,this.onPDOMContentChange())}set appendDescription(e){this.setAppendDescription(e)}get appendDescription(){return this.getAppendDescription()}getAppendDescription(){return this._appendDescription}setContainerTagName(e){assert&&assert(e===null||typeof e=="string",`invalid tagName argument: ${e}`),this._containerTagName!==e&&(this._containerTagName=e,this.onPDOMContentChange())}set containerTagName(e){this.setContainerTagName(e)}get containerTagName(){return this.getContainerTagName()}getContainerTagName(){return this._containerTagName}invalidatePeerLabelSiblingContent(){const e=this.labelContent;this._labelTagName||this.setLabelTagName(mv);for(let t=0;t<this._pdomInstances.length;t++)this._pdomInstances[t].peer.setLabelSiblingContent(e)}setLabelContent(e){e!==this._labelContent&&(ft(this._labelContent)&&!this._labelContent.isDisposed&&this._labelContent.unlink(this._onLabelContentChangeListener),this._labelContent=e,ft(e)&&e.lazyLink(this._onLabelContentChangeListener),this.invalidatePeerLabelSiblingContent())}set labelContent(e){this.setLabelContent(e)}get labelContent(){return this.getLabelContent()}getLabelContent(){return Lo(this._labelContent)}onInnerContentPropertyChange(){const e=this.innerContent;for(let t=0;t<this._pdomInstances.length;t++)this._pdomInstances[t].peer.setPrimarySiblingContent(e)}setInnerContent(e){e!==this._innerContent&&(ft(this._innerContent)&&!this._innerContent.isDisposed&&this._innerContent.unlink(this._onInnerContentChangeListener),this._innerContent=e,ft(e)&&e.lazyLink(this._onInnerContentChangeListener),this.onInnerContentPropertyChange())}set innerContent(e){this.setInnerContent(e)}get innerContent(){return this.getInnerContent()}getInnerContent(){return Lo(this._innerContent)}invalidatePeerDescriptionSiblingContent(){const e=this.descriptionContent;this._descriptionTagName||this.setDescriptionTagName(fv);for(let t=0;t<this._pdomInstances.length;t++)this._pdomInstances[t].peer.setDescriptionSiblingContent(e)}setDescriptionContent(e){e!==this._descriptionContent&&(ft(this._descriptionContent)&&!this._descriptionContent.isDisposed&&this._descriptionContent.unlink(this._onDescriptionContentChangeListener),this._descriptionContent=e,ft(e)&&e.lazyLink(this._onDescriptionContentChangeListener),this.invalidatePeerDescriptionSiblingContent())}set descriptionContent(e){this.setDescriptionContent(e)}get descriptionContent(){return this.getDescriptionContent()}getDescriptionContent(){return Lo(this._descriptionContent)}setAriaRole(e){assert&&assert(e===null||typeof e=="string"),this._ariaRole!==e&&(this._ariaRole=e,e!==null?this.setPDOMAttribute("role",e):this.removePDOMAttribute("role"))}set ariaRole(e){this.setAriaRole(e)}get ariaRole(){return this.getAriaRole()}getAriaRole(){return this._ariaRole}setContainerAriaRole(e){assert&&assert(e===null||typeof e=="string"),this._containerAriaRole!==e&&(this._containerAriaRole=e,e===null?this.removePDOMAttribute("role",{elementName:tr.CONTAINER_PARENT}):this.setPDOMAttribute("role",e,{elementName:tr.CONTAINER_PARENT}))}set containerAriaRole(e){this.setContainerAriaRole(e)}get containerAriaRole(){return this.getContainerAriaRole()}getContainerAriaRole(){return this._containerAriaRole}onAriaValueTextChange(){const e=this.ariaValueText;e===null?this._hasAppliedAriaLabel&&(this.removePDOMAttribute("aria-valuetext"),this._hasAppliedAriaLabel=!1):(this.setPDOMAttribute("aria-valuetext",e),this._hasAppliedAriaLabel=!0)}setAriaValueText(e){this._ariaValueText!==e&&(ft(this._ariaValueText)&&!this._ariaValueText.isDisposed&&this._ariaValueText.unlink(this._onAriaValueTextChangeListener),this._ariaValueText=e,ft(e)&&e.lazyLink(this._onAriaValueTextChangeListener),this.onAriaValueTextChange())}set ariaValueText(e){this.setAriaValueText(e)}get ariaValueText(){return this.getAriaValueText()}getAriaValueText(){return Lo(this._ariaValueText)}setPDOMNamespace(e){return assert&&assert(e===null||typeof e=="string"),this._pdomNamespace!==e&&(this._pdomNamespace=e,this.onPDOMContentChange()),this}set pdomNamespace(e){this.setPDOMNamespace(e)}get pdomNamespace(){return this.getPDOMNamespace()}getPDOMNamespace(){return this._pdomNamespace}onAriaLabelChange(){const e=this.ariaLabel;e===null?this._hasAppliedAriaLabel&&(this.removePDOMAttribute("aria-label"),this._hasAppliedAriaLabel=!1):(this.setPDOMAttribute("aria-label",e),this._hasAppliedAriaLabel=!0)}setAriaLabel(e){this._ariaLabel!==e&&(ft(this._ariaLabel)&&!this._ariaLabel.isDisposed&&this._ariaLabel.unlink(this._onAriaLabelChangeListener),this._ariaLabel=e,ft(e)&&e.lazyLink(this._onAriaLabelChangeListener),this.onAriaLabelChange())}set ariaLabel(e){this.setAriaLabel(e)}get ariaLabel(){return this.getAriaLabel()}getAriaLabel(){return Lo(this._ariaLabel)}setFocusHighlight(e){this._focusHighlight!==e&&(this._focusHighlight=e,this._focusHighlightLayerable&&(assert&&assert(e instanceof tt),e.visible=!1),this.focusHighlightChangedEmitter.emit())}set focusHighlight(e){this.setFocusHighlight(e)}get focusHighlight(){return this.getFocusHighlight()}getFocusHighlight(){return this._focusHighlight}setFocusHighlightLayerable(e){this._focusHighlightLayerable!==e&&(this._focusHighlightLayerable=e,this._focusHighlight&&(assert&&assert(this._focusHighlight instanceof tt),this._focusHighlight.visible=!1,this.focusHighlightChangedEmitter.emit()))}set focusHighlightLayerable(e){this.setFocusHighlightLayerable(e)}get focusHighlightLayerable(){return this.getFocusHighlightLayerable()}getFocusHighlightLayerable(){return this._focusHighlightLayerable}setGroupFocusHighlight(e){this._groupFocusHighlight=e}set groupFocusHighlight(e){this.setGroupFocusHighlight(e)}get groupFocusHighlight(){return this.getGroupFocusHighlight()}getGroupFocusHighlight(){return this._groupFocusHighlight}setAriaLabelledbyAssociations(e){let t,i;if(assert)for(assert(Array.isArray(e)),i=0;i<e.length;i++)t=e[i];if(e.length===0&&this._ariaLabelledbyAssociations.length===0)return;const s=[],n=[],o=[];for(da(e,this._ariaLabelledbyAssociations,n,s,o),i=0;i<s.length;i++)t=s[i],this.removeAriaLabelledbyAssociation(t);for(assert&&assert(this._ariaLabelledbyAssociations.length===o.length,"Removing associations should not have triggered other association changes"),i=0;i<n.length;i++){const c=e[i];this.addAriaLabelledbyAssociation(c)}}set ariaLabelledbyAssociations(e){this.setAriaLabelledbyAssociations(e)}get ariaLabelledbyAssociations(){return this.getAriaLabelledbyAssociations()}getAriaLabelledbyAssociations(){return this._ariaLabelledbyAssociations}addAriaLabelledbyAssociation(e){this._ariaLabelledbyAssociations.push(e),e.otherNode._nodesThatAreAriaLabelledbyThisNode.push(this),this.updateAriaLabelledbyAssociationsInPeers()}removeAriaLabelledbyAssociation(e){assert&&assert(_.includes(this._ariaLabelledbyAssociations,e)),this._ariaLabelledbyAssociations.splice(_.indexOf(this._ariaLabelledbyAssociations,e),1)[0].otherNode.removeNodeThatIsAriaLabelledByThisNode(this),this.updateAriaLabelledbyAssociationsInPeers()}removeNodeThatIsAriaLabelledByThisNode(e){const t=_.indexOf(this._nodesThatAreAriaLabelledbyThisNode,e);assert&&assert(t>=0),this._nodesThatAreAriaLabelledbyThisNode.splice(t,1)}updateAriaLabelledbyAssociationsInPeers(){for(let e=0;e<this.pdomInstances.length;e++)this.pdomInstances[e].peer.onAriaLabelledbyAssociationChange()}updateOtherNodesAriaLabelledby(){for(let e=0;e<this._nodesThatAreAriaLabelledbyThisNode.length;e++)this._nodesThatAreAriaLabelledbyThisNode[e].updateAriaLabelledbyAssociationsInPeers()}getNodesThatAreAriaLabelledbyThisNode(){return this._nodesThatAreAriaLabelledbyThisNode}get nodesThatAreAriaLabelledbyThisNode(){return this.getNodesThatAreAriaLabelledbyThisNode()}setAriaDescribedbyAssociations(e){let t;if(assert){assert(Array.isArray(e));for(let c=0;c<e.length;c++)t=e[c]}if(e.length===0&&this._ariaDescribedbyAssociations.length===0)return;const i=[],s=[],n=[];let o;for(da(e,this._ariaDescribedbyAssociations,s,i,n),o=0;o<i.length;o++)t=i[o],this.removeAriaDescribedbyAssociation(t);for(assert&&assert(this._ariaDescribedbyAssociations.length===n.length,"Removing associations should not have triggered other association changes"),o=0;o<s.length;o++){const c=e[o];this.addAriaDescribedbyAssociation(c)}}set ariaDescribedbyAssociations(e){this.setAriaDescribedbyAssociations(e)}get ariaDescribedbyAssociations(){return this.getAriaDescribedbyAssociations()}getAriaDescribedbyAssociations(){return this._ariaDescribedbyAssociations}addAriaDescribedbyAssociation(e){assert&&assert(!_.includes(this._ariaDescribedbyAssociations,e),"describedby association already registed"),this._ariaDescribedbyAssociations.push(e),e.otherNode._nodesThatAreAriaDescribedbyThisNode.push(this),this.updateAriaDescribedbyAssociationsInPeers()}hasAriaDescribedbyAssociation(e){return _.includes(this._ariaDescribedbyAssociations,e)}removeAriaDescribedbyAssociation(e){assert&&assert(_.includes(this._ariaDescribedbyAssociations,e)),this._ariaDescribedbyAssociations.splice(_.indexOf(this._ariaDescribedbyAssociations,e),1)[0].otherNode.removeNodeThatIsAriaDescribedByThisNode(this),this.updateAriaDescribedbyAssociationsInPeers()}removeNodeThatIsAriaDescribedByThisNode(e){const t=_.indexOf(this._nodesThatAreAriaDescribedbyThisNode,e);assert&&assert(t>=0),this._nodesThatAreAriaDescribedbyThisNode.splice(t,1)}updateAriaDescribedbyAssociationsInPeers(){for(let e=0;e<this.pdomInstances.length;e++)this.pdomInstances[e].peer.onAriaDescribedbyAssociationChange()}updateOtherNodesAriaDescribedby(){for(let e=0;e<this._nodesThatAreAriaDescribedbyThisNode.length;e++)this._nodesThatAreAriaDescribedbyThisNode[e].updateAriaDescribedbyAssociationsInPeers()}getNodesThatAreAriaDescribedbyThisNode(){return this._nodesThatAreAriaDescribedbyThisNode}get nodesThatAreAriaDescribedbyThisNode(){return this.getNodesThatAreAriaDescribedbyThisNode()}setActiveDescendantAssociations(e){let t;if(assert){assert(Array.isArray(e));for(let c=0;c<e.length;c++)t=e[c]}if(e.length===0&&this._activeDescendantAssociations.length===0)return;const i=[],s=[],n=[];let o;for(da(e,this._activeDescendantAssociations,s,i,n),o=0;o<i.length;o++)t=i[o],this.removeActiveDescendantAssociation(t);for(assert&&assert(this._activeDescendantAssociations.length===n.length,"Removing associations should not have triggered other association changes"),o=0;o<s.length;o++){const c=e[o];this.addActiveDescendantAssociation(c)}}set activeDescendantAssociations(e){this.setActiveDescendantAssociations(e)}get activeDescendantAssociations(){return this.getActiveDescendantAssociations()}getActiveDescendantAssociations(){return this._activeDescendantAssociations}addActiveDescendantAssociation(e){this._activeDescendantAssociations.push(e),e.otherNode._nodesThatAreActiveDescendantToThisNode.push(this),this.updateActiveDescendantAssociationsInPeers()}removeActiveDescendantAssociation(e){assert&&assert(_.includes(this._activeDescendantAssociations,e)),this._activeDescendantAssociations.splice(_.indexOf(this._activeDescendantAssociations,e),1)[0].otherNode.removeNodeThatIsActiveDescendantThisNode(this),this.updateActiveDescendantAssociationsInPeers()}removeNodeThatIsActiveDescendantThisNode(e){const t=_.indexOf(this._nodesThatAreActiveDescendantToThisNode,e);assert&&assert(t>=0),this._nodesThatAreActiveDescendantToThisNode.splice(t,1)}updateActiveDescendantAssociationsInPeers(){for(let e=0;e<this.pdomInstances.length;e++)this.pdomInstances[e].peer.onActiveDescendantAssociationChange()}updateOtherNodesActiveDescendant(){for(let e=0;e<this._nodesThatAreActiveDescendantToThisNode.length;e++)this._nodesThatAreActiveDescendantToThisNode[e].updateActiveDescendantAssociationsInPeers()}getNodesThatAreActiveDescendantToThisNode(){return this._nodesThatAreActiveDescendantToThisNode}get nodesThatAreActiveDescendantToThisNode(){return this.getNodesThatAreActiveDescendantToThisNode()}setPDOMOrder(e){assert&&assert(Array.isArray(e)||e===null,`Array or null expected, received: ${e}`),assert&&e&&(e.forEach((i,s)=>{assert&&assert(i===null||i instanceof tt,`Elements of pdomOrder should be either a Node or null. Element at index ${s} is: ${i}`)}),assert&&assert(this.getTrails(i=>_.includes(e,i)).length===0,"pdomOrder should not include any ancestors or the node itself"),assert&&assert(e.length===_.uniq(e).length,"pdomOrder does not allow duplicate Nodes"));let t=this._pdomOrder===null&&e!==null||this._pdomOrder!==null&&e===null;if(!t&&e&&this._pdomOrder&&(t=e.length!==this._pdomOrder.length,!t)){for(let i=0;i<e.length;i++)if(e[i]!==this._pdomOrder[i]){t=!0;break}}if(t){const i=this._pdomOrder;this._pdomOrder=e===null?null:e.slice(),fn.pdomOrderChange(this,i,e),this.rendererSummaryRefreshEmitter.emit()}}set pdomOrder(e){this.setPDOMOrder(e)}get pdomOrder(){return this.getPDOMOrder()}getPDOMOrder(){return this._pdomOrder?this._pdomOrder.slice(0):this._pdomOrder}hasPDOMOrder(){return this._pdomOrder!==null&&this._pdomOrder.length!==0&&(this._pdomOrder.length>1||this._pdomOrder[0]!==null)}getPDOMParent(){return this._pdomParent}get pdomParent(){return this.getPDOMParent()}getEffectiveChildren(){const e=[];for(let t=0;t<this._children.length;t++){const i=this._children[t];i._pdomParent||e.push(i)}if(this.hasPDOMOrder()){const t=this.pdomOrder.slice(),i=t.indexOf(null);return i>=0?(e.unshift(i,1),Array.prototype.splice.apply(t,e)):Array.prototype.push.apply(t,e),t}else return e}onPdomVisiblePropertyChange(e){this._pdomDisplaysInfo.onPDOMVisibilityChange(e)}setPdomVisibleProperty(e){return this._pdomVisibleProperty.setTargetProperty(e),this}set pdomVisibleProperty(e){this.setPdomVisibleProperty(e)}get pdomVisibleProperty(){return this.getPdomVisibleProperty()}getPdomVisibleProperty(){return this._pdomVisibleProperty}setPDOMVisible(e){this.pdomVisibleProperty.value=e}set pdomVisible(e){this.setPDOMVisible(e)}get pdomVisible(){return this.isPDOMVisible()}isPDOMVisible(){return this.pdomVisibleProperty.value}isPDOMDisplayed(){for(let e=0;e<this._pdomInstances.length;e++)if(this._pdomInstances[e].isGloballyVisible())return!0;return!1}get pdomDisplayed(){return this.isPDOMDisplayed()}invalidatePeerInputValue(){for(let e=0;e<this.pdomInstances.length;e++)this.pdomInstances[e].peer.onInputValueChange()}setInputValue(e){assert&&this._tagName&&assert(_.includes(bv,this._tagName.toUpperCase()),"dom element must be a form element to support value"),e!==this._inputValue&&(ft(this._inputValue)&&!this._inputValue.isDisposed&&this._inputValue.unlink(this._onPDOMContentChangeListener),this._inputValue=e,ft(e)&&e.lazyLink(this._onPDOMContentChangeListener),this.invalidatePeerInputValue())}set inputValue(e){this.setInputValue(e)}get inputValue(){return this.getInputValue()}getInputValue(){let e;return ft(this._inputValue)?e=this._inputValue.value:e=this._inputValue,e===null?null:""+e}setPDOMChecked(e){this._tagName&&assert&&assert(this._tagName.toUpperCase()===xa,"Cannot set checked on a non input tag."),this._inputType&&assert&&assert(hp.includes(this._inputType.toUpperCase()),`inputType does not support checked: ${this._inputType}`),this._pdomChecked!==e&&(this._pdomChecked=e,this.setPDOMAttribute("checked",e,{asProperty:!0}))}set pdomChecked(e){this.setPDOMChecked(e)}get pdomChecked(){return this.getPDOMChecked()}getPDOMChecked(){return this._pdomChecked}getPDOMAttributes(){return this._pdomAttributes.slice(0)}get pdomAttributes(){return this.getPDOMAttributes()}setPDOMAttribute(e,t,i){assert&&i&&assert(Object.getPrototypeOf(i)===Object.prototype,"Extra prototype on pdomAttribute options object is a code smell");const s=st()({namespace:null,asProperty:!1,elementName:tr.PRIMARY_SIBLING},i);assert&&assert(!_v.includes(e),"setPDOMAttribute does not support association attributes");for(let o=0;o<this._pdomAttributes.length;o++){const c=this._pdomAttributes[o];c.attribute===e&&c.options.namespace===s.namespace&&c.options.elementName===s.elementName&&(c.options.asProperty===s.asProperty?this._pdomAttributes.splice(o,1):this.removePDOMAttribute(c.attribute,c.options))}let n=o=>{assert&&typeof o=="string"&&Or(o,yn.STRING_WITHOUT_TEMPLATE_VARS_VALIDATOR);for(let c=0;c<this._pdomInstances.length;c++)this._pdomInstances[c].peer.setAttributeToElement(e,o,s)};ft(t)?t.link(n):(n(t),n=null),this._pdomAttributes.push({attribute:e,value:t,listener:n,options:s})}removePDOMAttribute(e,t){assert&&t&&assert(Object.getPrototypeOf(t)===Object.prototype,"Extra prototype on pdomAttribute options object is a code smell");const i=st()({namespace:null,elementName:tr.PRIMARY_SIBLING},t);let s=!1;for(let n=0;n<this._pdomAttributes.length;n++)if(this._pdomAttributes[n].attribute===e&&this._pdomAttributes[n].options.namespace===i.namespace&&this._pdomAttributes[n].options.elementName===i.elementName){const o=this._pdomAttributes[n];o.listener&&ft(o.value)&&!o.value.isDisposed&&o.value.unlink(o.listener),this._pdomAttributes.splice(n,1),s=!0}assert&&assert(s,`Node does not have pdom attribute ${e}`);for(let n=0;n<this._pdomInstances.length;n++)this._pdomInstances[n].peer.removeAttributeFromElement(e,i)}removePDOMAttributes(){const e=this.getPDOMAttributes();for(let t=0;t<e.length;t++){const i=e[t].attribute;this.removePDOMAttribute(i)}}hasPDOMAttribute(e,t){assert&&t&&assert(Object.getPrototypeOf(t)===Object.prototype,"Extra prototype on pdomAttribute options object is a code smell");const i=st()({namespace:null,elementName:tr.PRIMARY_SIBLING},t);let s=!1;for(let n=0;n<this._pdomAttributes.length;n++)this._pdomAttributes[n].attribute===e&&this._pdomAttributes[n].options.namespace===i.namespace&&this._pdomAttributes[n].options.elementName===i.elementName&&(s=!0);return s}setPDOMClass(e,t){const i=st()({elementName:tr.PRIMARY_SIBLING},t);for(let s=0;s<this._pdomClasses.length;s++){const n=this._pdomClasses[s];if(n.className===e&&n.options.elementName===i.elementName)return}this._pdomClasses.push({className:e,options:i});for(let s=0;s<this._pdomInstances.length;s++)this._pdomInstances[s].peer.setClassToElement(e,i)}removePDOMClass(e,t){const i=st()({elementName:tr.PRIMARY_SIBLING},t);let s=!1;for(let n=0;n<this._pdomClasses.length;n++)this._pdomClasses[n].className===e&&this._pdomClasses[n].options.elementName===i.elementName&&(this._pdomClasses.splice(n,1),s=!0);assert&&assert(s,`Node does not have pdom attribute ${e}`);for(let n=0;n<this._pdomClasses.length;n++)this.pdomInstances[n].peer.removeClassFromElement(e,i)}getPDOMClasses(){return this._pdomClasses.slice(0)}get pdomClasses(){return this.getPDOMClasses()}setFocusable(e){if(assert&&assert(e===null||typeof e=="boolean"),this._focusableOverride!==e){this._focusableOverride=e;for(let t=0;t<this._pdomInstances.length;t++)assert&&assert(this._pdomInstances[t].peer,"Peer required to set focusable."),this._pdomInstances[t].peer.setFocusable(this.focusable)}}set focusable(e){this.setFocusable(e)}get focusable(){return this.isFocusable()}isFocusable(){return this._focusableOverride!==null?this._focusableOverride:this._tagName===null?!1:Dt.tagIsDefaultFocusable(this._tagName)}setPDOMTransformSourceNode(e){this._pdomTransformSourceNode=e;for(let t=0;t<this._pdomInstances.length;t++)this._pdomInstances[t].peer.setPDOMTransformSourceNode(this._pdomTransformSourceNode)}set pdomTransformSourceNode(e){this.setPDOMTransformSourceNode(e)}get pdomTransformSourceNode(){return this.getPDOMTransformSourceNode()}getPDOMTransformSourceNode(){return this._pdomTransformSourceNode}setFocusPanTargetBoundsProperty(e){e!==this._focusPanTargetBoundsProperty&&(assert&&assert(!this._focusPanTargetBoundsProperty,"Cannot change focusPanTargetBoundsProperty after it is set."),this._focusPanTargetBoundsProperty=e)}getFocusPanTargetBoundsProperty(){return this._focusPanTargetBoundsProperty}set focusPanTargetBoundsProperty(e){this.setFocusPanTargetBoundsProperty(e)}get focusPanTargetBoundsProperty(){return this.getFocusPanTargetBoundsProperty()}setLimitPanDirection(e){this._limitPanDirection=e}getLimitPanDirection(){return this._limitPanDirection}set limitPanDirection(e){this.setLimitPanDirection(e)}get limitPanDirection(){return this.getLimitPanDirection()}setPositionInPDOM(e){this._positionInPDOM=e;for(let t=0;t<this._pdomInstances.length;t++)this._pdomInstances[t].peer.setPositionInPDOM(e)}set positionInPDOM(e){this.setPositionInPDOM(e)}get positionInPDOM(){return this.getPositionInPDOM()}getPositionInPDOM(){return this._positionInPDOM}setExcludeLabelSiblingFromInput(){this.excludeLabelSiblingFromInput=!0,this.onPDOMContentChange()}isInsidePhetioArchetype(e=this){if(e.isPhetioInstrumented())return e.phetioIsArchetype;for(let t=0;t<e.parents.length;t++)if(this.isInsidePhetioArchetype(e.parents[t]))return!0;return!1}alertDescriptionUtterance(e){if(ja.value||ai.PHET_IO_ENABLED&&this.isInsidePhetioArchetype())return;const t=this.getConnectedDisplays();for(let i=0;i<t.length;i++){const s=t[i];s.isAccessible()&&s.descriptionUtteranceQueue.addToBack(e)}}forEachUtteranceQueue(e){const t=this.getConnectedDisplays();assert&&assert(t.length>0,"must be connected to a display to use UtteranceQueue features");for(let i=0;i<t.length;i++){const s=t[i];s.isAccessible()&&e(s.descriptionUtteranceQueue)}}getBaseOptions(){const e={};for(let t=0;t<Du.length;t++){const i=Du[t];e[i]=this[i]}return e}getNestedPDOMOrder(){const e=new wt(this);let t=[];const i=[],s=[i];function n(o,c){let p=0;if(_.each(t,O=>{o===O&&p++}),p>1||p===1&&!c)return;if(o.hasPDOMContent){const O={trail:e.copy(),children:[]};s[s.length-1].push(O),s.push(O.children)}const f=o._pdomOrder===null?[]:o._pdomOrder;t=t.concat(f),_.each(f,O=>{_.each(o.getLeafTrailsTo(O),T=>{T.removeAncestor(),e.addDescendantTrail(T),n(O,!0),e.removeDescendantTrail(T)})});const w=o._children.length;for(let O=0;O<w;O++){const T=o._children[O];e.addDescendant(T,O),n(T,!1),e.removeDescendant()}_.each(f,()=>{t.pop()}),o.hasPDOMContent&&s.pop()}return n(this,!1),i}onPDOMContentChange(){fn.pdomContentChange(this),this.pdomHeading&&this.computeHeadingLevel(),this.rendererSummaryRefreshEmitter.emit()}get hasPDOMContent(){return!!this._tagName}onPDOMAddChild(e){sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.ParallelDOM(`onPDOMAddChild n#${e.id} (parent:n#${this.id})`),sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.push(),assert&&function(i){i._rendererSummary.hasNoPDOM()||i.pdomOrder&&assert(i.getTrails(s=>_.includes(i.pdomOrder,s)).length===0,"pdomOrder should not include any ancestors or the node itself")}(e),assert&&fn.auditNodeForPDOMCycles(this),this._pdomDisplaysInfo.onAddChild(e),fn.addChild(this,e),sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.pop()}onPDOMRemoveChild(e){sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.ParallelDOM(`onPDOMRemoveChild n#${e.id} (parent:n#${this.id})`),sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.push(),this._pdomDisplaysInfo.onRemoveChild(e),fn.removeChild(this,e),e.updateOtherNodesAriaLabelledby(),e.updateOtherNodesAriaDescribedby(),e.updateOtherNodesActiveDescendant(),sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.pop()}onPDOMReorderedChildren(){sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.ParallelDOM(`onPDOMReorderedChildren (parent:n#${this.id})`),sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.push(),fn.childrenOrderChange(this),sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.pop()}updateLinkedElementForProperty(e,t,i){if(assert&&assert(t!==i,"should not be called on same values"),this.isPhetioInstrumented()){t&&t instanceof an&&t.isPhetioInstrumented()&&t instanceof Hi&&this.removeLinkedElements(t);const s=this.tandem.createTandem(e);i&&i instanceof an&&i.isPhetioInstrumented()&&i instanceof Hi&&s!==i.tandem&&this.addLinkedElement(i,{tandemName:e})}}getPDOMInstances(){return this._pdomInstances}get pdomInstances(){return this.getPDOMInstances()}addPDOMInstance(e){this._pdomInstances.push(e)}removePDOMInstance(e){const t=_.indexOf(this._pdomInstances,e);assert&&assert(t!==-1,"Cannot remove a PDOMInstance from a Node if it was not there"),this._pdomInstances.splice(t,1)}static BASIC_ACCESSIBLE_NAME_BEHAVIOR(e,t,i){return e.tagName==="input"?(t.labelTagName="label",t.labelContent=i):Dt.tagNameSupportsContent(e.tagName)?t.innerContent=i:t.ariaLabel=i,t}static HELP_TEXT_BEFORE_CONTENT(e,t,i){return t.descriptionTagName=Dt.DEFAULT_DESCRIPTION_TAG_NAME,t.descriptionContent=i,t.appendDescription=!1,t}static HELP_TEXT_AFTER_CONTENT(e,t,i){return t.descriptionTagName=Dt.DEFAULT_DESCRIPTION_TAG_NAME,t.descriptionContent=i,t.appendDescription=!0,t}}te.register("ParallelDOM",vl);let vv=1;const Po=$e.NOTHING.copy(),Lv=$e.NOTHING.copy(),Mc=new Ze,Rc=pl.TANDEM_NAME,Nc="visibleProperty",Bc="inputEnabledProperty",Lm=!1;let So=0,wo=0;const lr=["leftTop","centerTop","rightTop","leftCenter","center","rightCenter","leftBottom","centerBottom","rightBottom","left","right","top","bottom","centerX","centerY"],Pv=["children","cursor","phetioVisiblePropertyInstrumented","visibleProperty","visible","pickableProperty","pickable","phetioEnabledPropertyInstrumented","enabledProperty","enabled","phetioInputEnabledPropertyInstrumented","inputEnabledProperty","inputEnabled","inputListeners","opacity","disabledOpacity","filters","matrix","translation","x","y","rotation","scale","excludeInvisibleChildrenFromBounds","layoutOptions","localBounds","maxWidth","maxHeight","renderer","layerSplit","usesOpacity","cssTransform","excludeInvisible","webglScale","preventFit","mouseArea","touchArea","clipArea","transformBounds",...lr],Ni={phetioVisiblePropertyInstrumented:!0,visible:!0,opacity:1,disabledOpacity:1,pickable:null,enabled:!0,phetioEnabledPropertyInstrumented:!1,inputEnabled:!0,phetioInputEnabledPropertyInstrumented:!1,clipArea:null,mouseArea:null,touchArea:null,cursor:null,transformBounds:!1,maxWidth:null,maxHeight:null,renderer:null,usesOpacity:!1,layerSplit:!1,cssTransform:!1,excludeInvisible:!1,webglScale:null,preventFit:!1},Sv=Ni.renderer===null?0:de.fromName(Ni.renderer);var bs;let ma=(bs=class extends vl{constructor(e){super(),this.childrenChangedEmitter=new ri,this.childInsertedEmitter=new ri,this.childRemovedEmitter=new ri,this.childrenReorderedEmitter=new ri,this.parentAddedEmitter=new ri,this.parentRemovedEmitter=new ri,this.transformEmitter=new ri,this.instanceRefreshEmitter=new ri,this.rendererSummaryRefreshEmitter=new ri,this.filterChangeEmitter=new ri,this.changedInstanceEmitter=new ri,this.rootedDisplayChangedEmitter=new ri,this.layoutOptionsChangedEmitter=new ri,this._activeParentLayoutConstraint=null,this._id=vv++,this._instances=[],this._rootedDisplays=[],this._drawables=[],this._visibleProperty=new $n(Ni.visible,Ni.phetioVisiblePropertyInstrumented,this.onVisiblePropertyChange.bind(this)),this.opacityProperty=new Nt(Ni.opacity,this.onOpacityPropertyChange.bind(this)),this.disabledOpacityProperty=new Nt(Ni.disabledOpacity,this.onDisabledOpacityPropertyChange.bind(this)),this._pickableProperty=new $n(Ni.pickable,!1,this.onPickablePropertyChange.bind(this)),this._enabledProperty=new $n(Ni.enabled,Ni.phetioEnabledPropertyInstrumented,this.onEnabledPropertyChange.bind(this)),this._inputEnabledProperty=new $n(Ni.inputEnabled,Ni.phetioInputEnabledPropertyInstrumented),this.clipAreaProperty=new Nt(Ni.clipArea),this.voicingVisibleProperty=new Nt(!0),this._mouseArea=Ni.mouseArea,this._touchArea=Ni.touchArea,this._cursor=Ni.cursor,this._children=[],this._parents=[],this._transformBounds=Ni.transformBounds,this._transform=new Ks,this._transformListener=this.onTransformChange.bind(this),this._transform.changeEmitter.addListener(this._transformListener),this._maxWidth=Ni.maxWidth,this._maxHeight=Ni.maxHeight,this._appliedScaleFactor=1,this._inputListeners=[],this._renderer=Sv,this._usesOpacity=Ni.usesOpacity,this._layerSplit=Ni.layerSplit,this._cssTransform=Ni.cssTransform,this._excludeInvisible=Ni.excludeInvisible,this._webglScale=Ni.webglScale,this._preventFit=Ni.preventFit,this.inputEnabledProperty.lazyLink(this.pdomBoundInputEnabledListener);const t=this.onBoundsListenersAddedOrRemoved.bind(this),i=this.validateBounds.bind(this),s=this.validateSelfBounds.bind(this);this.boundsProperty=new Ho($e.NOTHING.copy(),i),this.boundsProperty.changeCount=t,this.localBoundsProperty=new Ho($e.NOTHING.copy(),i),this.localBoundsProperty.changeCount=t,this.childBoundsProperty=new Ho($e.NOTHING.copy(),i),this.childBoundsProperty.changeCount=t,this.selfBoundsProperty=new Ho($e.NOTHING.copy(),s),this._localBoundsOverridden=!1,this._excludeInvisibleChildrenFromBounds=!1,this._layoutOptions=null,this._boundsDirty=!0,this._localBoundsDirty=!0,this._selfBoundsDirty=!0,this._childBoundsDirty=!0,assert&&(this._originalBounds=this.boundsProperty._value,this._originalLocalBounds=this.localBoundsProperty._value,this._originalSelfBounds=this.selfBoundsProperty._value,this._originalChildBounds=this.childBoundsProperty._value),this._filters=[],this._rendererBitmask=de.bitmaskNodeDefault,this._rendererSummary=new Fc(this),this._boundsEventCount=0,this._boundsEventSelfCount=0,this._picker=new Pm(this),this._isGettingRemovedFromParent=!1,e&&this.mutate(e)}insertChild(e,t,i){var s,n,o,c;if(assert&&assert(t!=null,"insertChild cannot insert a null/undefined child"),assert&&assert(!_.includes(this._children,t),"Parent already contains child"),assert&&assert(t!==this,"Cannot add self as a child"),assert&&assert(t._parents!==null,"Tried to insert a disposed child node?"),assert&&assert(!t.isDisposed,"Tried to insert a disposed Node"),this._picker.onInsertChild(t),this.changeBoundsEventCount(t._boundsEventCount>0?1:0),this._rendererSummary.summaryChange(Fc.bitmaskAll,t._rendererSummary.bitmask),t._parents.push(this),assert&&((n=(s=self.phet)==null?void 0:s.chipper)!=null&&n.queryParameters)&&isFinite(phet.chipper.queryParameters.parentLimit)){const p=t._parents.length;So<p&&(So=p,console.log(`Max Node parents: ${So}`),assert(So<=phet.chipper.queryParameters.parentLimit,`parent count of ${So} above ?parentLimit=${phet.chipper.queryParameters.parentLimit}`))}if(this._children.splice(e,0,t),assert&&((c=(o=self.phet)==null?void 0:o.chipper)!=null&&c.queryParameters)&&isFinite(phet.chipper.queryParameters.childLimit)){const p=this._children.length;wo<p&&(wo=p,console.log(`Max Node children: ${wo}`),assert(wo<=phet.chipper.queryParameters.childLimit,`child count of ${wo} above ?childLimit=${phet.chipper.queryParameters.childLimit}`))}return t._rendererSummary.hasNoPDOM()||this.onPDOMAddChild(t),t.invalidateBounds(),this._boundsDirty=!0,this.childInsertedEmitter.emit(t,e),t.parentAddedEmitter.emit(this),!i&&this.childrenChangedEmitter.emit(),assertSlow&&this._picker.audit(),this}addChild(e,t){return this.insertChild(this._children.length,e,t),this}removeChild(e,t){assert&&assert(e&&e instanceof bs,"Need to call node.removeChild() with a Node."),assert&&assert(this.hasChild(e),"Attempted to removeChild with a node that was not a child.");const i=_.indexOf(this._children,e);return this.removeChildWithIndex(e,i,t),this}removeChildAt(e,t){assert&&assert(e>=0),assert&&assert(e<this._children.length);const i=this._children[e];return this.removeChildWithIndex(i,e,t),this}removeChildWithIndex(e,t,i){assert&&assert(e&&e instanceof bs,"Need to call node.removeChildWithIndex() with a Node."),assert&&assert(this.hasChild(e),"Attempted to removeChild with a node that was not a child."),assert&&assert(this._children[t]===e,"Incorrect index for removeChildWithIndex"),assert&&assert(e._parents!==null,"Tried to remove a disposed child node?");const s=_.indexOf(e._parents,this);e._isGettingRemovedFromParent=!0,e._rendererSummary.hasNoPDOM()||this.onPDOMRemoveChild(e),this._picker.onRemoveChild(e),this.changeBoundsEventCount(e._boundsEventCount>0?-1:0),this._rendererSummary.summaryChange(e._rendererSummary.bitmask,Fc.bitmaskAll),e._parents.splice(s,1),this._children.splice(t,1),e._isGettingRemovedFromParent=!1,this.invalidateBounds(),this._childBoundsDirty=!0,this.childRemovedEmitter.emit(e,t),e.parentRemovedEmitter.emit(this),!i&&this.childrenChangedEmitter.emit(),assertSlow&&this._picker.audit()}moveChildToIndex(e,t){assert&&assert(this.hasChild(e),"Attempted to moveChildToIndex with a node that was not a child."),assert&&assert(t%1===0&&t>=0&&t<this._children.length,`Invalid index: ${t}`);const i=this.indexOfChild(e);return this._children[t]!==e&&(this._children.splice(i,1),this._children.splice(t,0,e),this._rendererSummary.hasNoPDOM()||this.onPDOMReorderedChildren(),this.childrenReorderedEmitter.emit(Math.min(i,t),Math.max(i,t)),this.childrenChangedEmitter.emit()),this}removeAllChildren(){return this.setChildren([]),this}setChildren(e){const t=[],i=[],s=[];let n;for(da(e,this._children,i,t,s),n=t.length-1;n>=0;n--)this.removeChild(t[n],!0);assert&&assert(this._children.length===s.length,"Removing children should not have triggered other children changes");let o=-1,c=-1;for(n=0;n<s.length;n++){const f=s[n];this._children[n]!==f&&(this._children[n]=f,o===-1&&(o=n),c=n)}const p=o!==-1;if(p&&(this._rendererSummary.hasNoPDOM()||this.onPDOMReorderedChildren(),this.childrenReorderedEmitter.emit(o,c)),i.length){let f=0,w=i[f];for(n=0;n<e.length;n++)e[n]===w&&(this.insertChild(n,w,!0),w=i[++f])}if((t.length!==0||i.length!==0||p)&&this.childrenChangedEmitter.emit(),assert)for(let f=0;f<this._children.length;f++)assert(e[f]===this._children[f],"Incorrect child after setChildren, possibly a reentrancy issue");return this}set children(e){this.setChildren(e)}get children(){return this.getChildren()}getChildren(){return this._children.slice(0)}getChildrenCount(){return this._children.length}getParents(){return this._parents.slice(0)}get parents(){return this.getParents()}getParent(){return assert&&assert(this._parents.length<=1,"Cannot call getParent on a node with multiple parents"),this._parents.length?this._parents[0]:null}get parent(){return this.getParent()}getChildAt(e){return this._children[e]}indexOfParent(e){return _.indexOf(this._parents,e)}indexOfChild(e){return _.indexOf(this._children,e)}moveToFront(){return _.each(this.parents,e=>e.moveChildToFront(this)),this}moveChildToFront(e){return this.moveChildToIndex(e,this._children.length-1)}moveForward(){return this.parents.forEach(e=>e.moveChildForward(this)),this}moveChildForward(e){const t=this.indexOfChild(e);return t<this.getChildrenCount()-1&&this.moveChildToIndex(e,t+1),this}moveBackward(){return this.parents.forEach(e=>e.moveChildBackward(this)),this}moveChildBackward(e){const t=this.indexOfChild(e);return t>0&&this.moveChildToIndex(e,t-1),this}moveToBack(){return _.each(this.parents,e=>e.moveChildToBack(this)),this}moveChildToBack(e){return this.moveChildToIndex(e,0)}replaceChild(e,t){assert&&assert(this.hasChild(e),"Attempted to replace a node that was not a child.");const i=this.indexOfChild(e),s=e.focused;return this.removeChild(e,!0),this.insertChild(i,t,!0),this.childrenChangedEmitter.emit(),s&&t.focusable&&t.focus(),this}detach(){return _.each(this._parents.slice(0),e=>e.removeChild(this)),this}changeBoundsEventCount(e){if(e!==0){const t=this._boundsEventCount===0;this._boundsEventCount+=e,assert&&assert(this._boundsEventCount>=0,"subtree bounds event count should be guaranteed to be >= 0");const i=this._boundsEventCount===0;if(t!==i){const s=t?1:-1,n=this._parents.length;for(let o=0;o<n;o++)this._parents[o].changeBoundsEventCount(s)}}}validateSelfBounds(){if(this._selfBoundsDirty){const e=Po.set(this.selfBoundsProperty._value),t=this.updateSelfBounds();return this._selfBoundsDirty=!1,t&&this.selfBoundsProperty.notifyListeners(e),!0}return!1}validateBounds(){sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds(`validateBounds #${this._id}`),sceneryLog&&sceneryLog.bounds&&sceneryLog.push();let e;const t=1e-13;let i=this.validateSelfBounds();const s=this.childBoundsProperty._value,n=this.localBoundsProperty._value,o=this.selfBoundsProperty._value,c=this.boundsProperty._value;if(this._childBoundsDirty){for(i=!0,sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds("childBounds dirty"),e=this._children.length;e--;){const f=this._children[e];f&&f.validateBounds()}const p=Po.set(s);for(s.set($e.NOTHING),e=this._children.length;e--;){const f=this._children[e];(f&&!this._excludeInvisibleChildrenFromBounds||f.isVisible())&&s.includeBounds(f.bounds)}this._childBoundsDirty=!1,sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds(`childBounds: ${s}`),s.equals(p)||s.equalsEpsilon(p,t)||this.childBoundsProperty.notifyListeners(p)}if(this._localBoundsDirty){i=!0,sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds("localBounds dirty"),this._localBoundsDirty=!1;const p=Po.set(n);if(!this._localBoundsOverridden){n.set(o).includeBounds(s);const f=this.clipArea;f&&n.constrainBounds(f.bounds)}sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds(`localBounds: ${n}`),(this._maxWidth!==null||this._maxHeight!==null)&&this.updateMaxDimension(n),n.equals(p)||(this._boundsDirty=!0,n.equalsEpsilon(p,t)||this.localBoundsProperty.notifyListeners(p))}if(this._boundsDirty){i=!0,sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds("bounds dirty"),this._boundsDirty=!1;const p=Po.set(c);if(this._transformBounds&&!this._transform.getMatrix().isAxisAligned()){const f=Mc.set(this.getMatrix());c.set($e.NOTHING),this._includeTransformedSubtreeBounds(f,c);const w=this.clipArea;w&&c.constrainBounds(w.getBoundsWithTransform(f))}else c.set(n),this.transformBoundsFromLocalToParent(c);if(sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds(`bounds: ${c}`),!c.equals(p)){for(e=this._parents.length;e--;)this._parents[e].invalidateBounds();c.equalsEpsilon(p,t)||this.boundsProperty.notifyListeners(p)}}return(this._childBoundsDirty||this._boundsDirty)&&(sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds("revalidation"),this.validateBounds()),assert&&(assert(!this._originalBounds||this._originalBounds===this.boundsProperty._value,"Reference for bounds changed!"),assert(!this._originalLocalBounds||this._originalLocalBounds===this.localBoundsProperty._value,"Reference for localBounds changed!"),assert(!this._originalSelfBounds||this._originalSelfBounds===this.selfBoundsProperty._value,"Reference for selfBounds changed!"),assert(!this._originalChildBounds||this._originalChildBounds===this.childBoundsProperty._value,"Reference for childBounds changed!")),assertSlow&&(()=>{const f=$e.NOTHING.copy();_.each(this._children,z=>{(!this._excludeInvisibleChildrenFromBounds||z.isVisible())&&f.includeBounds(z.boundsProperty._value)});let w=this.selfBoundsProperty._value.union(f);const O=this.clipArea;O&&(w=w.intersection(O.bounds));const T=this.localToParentBounds(w);assertSlow&&assertSlow(this.childBoundsProperty._value.equalsEpsilon(f,1e-6),`Child bounds mismatch after validateBounds: ${this.childBoundsProperty._value.toString()}, expected: ${f.toString()}`),assertSlow&&assertSlow(this._localBoundsOverridden||this._transformBounds||this.boundsProperty._value.equalsEpsilon(T,1e-6),`Bounds mismatch after validateBounds: ${this.boundsProperty._value.toString()}, expected: ${T.toString()}. This could have happened if a bounds instance owned by a Node was directly mutated (e.g. bounds.erode())`)})(),sceneryLog&&sceneryLog.bounds&&sceneryLog.pop(),i}_includeTransformedSubtreeBounds(e,t){this.selfBounds.isEmpty()||t.includeBounds(this.getTransformedSelfBounds(e));const i=this._children.length;for(let s=0;s<i;s++){const n=this._children[s];e.multiplyMatrix(n._transform.getMatrix()),n._includeTransformedSubtreeBounds(e,t),e.multiplyMatrix(n._transform.getInverse())}return t}validateWatchedBounds(){for(;this.watchedBoundsScan(););}watchedBoundsScan(){if(this._boundsEventSelfCount!==0)return this.validateBounds();if(this._boundsEventCount>0&&this._childBoundsDirty){let e=!1;const t=this._children.length;for(let i=0;i<t;i++)e=this._children[i].watchedBoundsScan()||e;return e}else return!1}invalidateBounds(){this._boundsDirty=!0,this._localBoundsDirty=!0;let e=this._parents.length;for(;e--;)this._parents[e].invalidateChildBounds()}invalidateChildBounds(){if(!this._childBoundsDirty){this._childBoundsDirty=!0,this._localBoundsDirty=!0;let e=this._parents.length;for(;e--;)this._parents[e].invalidateChildBounds()}}invalidateSelf(e){assert&&assert(e===void 0||e instanceof $e,"invalidateSelf's newSelfBounds, if provided, needs to be Bounds2");const t=this.selfBoundsProperty._value;if(!e)this._selfBoundsDirty=!0,this.invalidateBounds(),this._picker.onSelfBoundsDirty();else if(assert&&assert(e.isEmpty()||e.isFinite(),"Bounds must be empty or finite in invalidateSelf"),this._selfBoundsDirty=!1,!t.equals(e)){const i=Po.set(t);this.invalidateBounds(),this._picker.onSelfBoundsDirty(),t.set(e),this.selfBoundsProperty.notifyListeners(i)}assertSlow&&this._picker.audit()}updateSelfBounds(){return assert&&assert(this.selfBoundsProperty._value.equals($e.NOTHING)),!1}hasChild(e){assert&&assert(e&&e instanceof bs,"hasChild needs to be called with a Node");const t=_.includes(this._children,e);return assert&&assert(t===_.includes(e._parents,this),"child-parent reference should match parent-child reference"),t}getSelfShape(){return this.selfBounds.isEmpty()?new kt:kt.bounds(this.selfBounds)}getSelfBounds(){return this.selfBoundsProperty.value}get selfBounds(){return this.getSelfBounds()}getSafeSelfBounds(){return this.selfBoundsProperty.value}get safeSelfBounds(){return this.getSafeSelfBounds()}getChildBounds(){return this.childBoundsProperty.value}get childBounds(){return this.getChildBounds()}getLocalBounds(){return this.localBoundsProperty.value}get localBounds(){return this.getLocalBounds()}set localBounds(e){this.setLocalBounds(e)}get localBoundsOverridden(){return this._localBoundsOverridden}setLocalBounds(e){assert&&assert(e===null||e instanceof $e,"localBounds override should be set to either null or a Bounds2"),assert&&assert(e===null||!isNaN(e.minX),"minX for localBounds should not be NaN"),assert&&assert(e===null||!isNaN(e.minY),"minY for localBounds should not be NaN"),assert&&assert(e===null||!isNaN(e.maxX),"maxX for localBounds should not be NaN"),assert&&assert(e===null||!isNaN(e.maxY),"maxY for localBounds should not be NaN");const t=this.localBoundsProperty._value,i=t.copy();if(e===null)this._localBoundsOverridden&&(this._localBoundsOverridden=!1,this.localBoundsProperty.notifyListeners(i),this.invalidateBounds());else{const s=!e.equals(t)||!this._localBoundsOverridden;s&&t.set(e),this._localBoundsOverridden||(this._localBoundsOverridden=!0),s&&(this.localBoundsProperty.notifyListeners(i),this.invalidateBounds())}return this}getTransformedSelfBounds(e){return this.selfBounds.transformed(e)}getTransformedSafeSelfBounds(e){return this.safeSelfBounds.transformed(e)}getSafeTransformedVisibleBounds(e){const t=(e||Ze.IDENTITY).timesMatrix(this.matrix),i=$e.NOTHING.copy();if(this.visibleProperty.value&&(this.selfBounds.isEmpty()||i.includeBounds(this.getTransformedSafeSelfBounds(t)),this._children.length))for(let s=0;s<this._children.length;s++)i.includeBounds(this._children[s].getSafeTransformedVisibleBounds(t));return i}get safeTransformedVisibleBounds(){return this.getSafeTransformedVisibleBounds()}setTransformBounds(e){return this._transformBounds!==e&&(this._transformBounds=e,this.invalidateBounds()),this}set transformBounds(e){this.setTransformBounds(e)}get transformBounds(){return this.getTransformBounds()}getTransformBounds(){return this._transformBounds}getBounds(){return this.boundsProperty.value}get bounds(){return this.getBounds()}getVisibleLocalBounds(){const e=this.selfBounds.copy();let t=this._children.length;for(;t--;)e.includeBounds(this._children[t].getVisibleBounds());const i=this.clipArea;return i&&e.constrainBounds(i.bounds),assert&&assert(e.isFinite()||e.isEmpty(),"Visible bounds should not be infinite"),e}get visibleLocalBounds(){return this.getVisibleLocalBounds()}getVisibleBounds(){return this.isVisible()?this.getVisibleLocalBounds().transform(this.getMatrix()):$e.NOTHING}get visibleBounds(){return this.getVisibleBounds()}hitTest(e,t,i){return assert&&assert(e.isFinite(),"The point should be a finite Vector2"),assert&&assert(t===void 0||typeof t=="boolean","If isMouse is provided, it should be a boolean"),assert&&assert(i===void 0||typeof i=="boolean","If isTouch is provided, it should be a boolean"),this._picker.hitTest(e,!!t,!!i)}trailUnderPointer(e){return e.point===null?null:this.hitTest(e.point,e instanceof qs,e.isTouchLike())}containsPoint(e){return this.hitTest(e)!==null}containsPointSelf(e){return this.selfBounds.containsPoint(e)}intersectsBoundsSelf(e){return this.selfBounds.intersectsBounds(e)}isPhetioMouseHittable(e){return this.pickable===!1&&!this.isAnyDescendantAPhetioMouseHitTarget()?!1:this.visible&&(this.clipArea===null||this.clipArea.containsPoint(this._transform.getInverse().timesVector2(e)))}isAnyDescendantAPhetioMouseHitTarget(){return this.getPhetioMouseHitTarget()!=="phetioNotSelectable"||_.some(this.children,e=>e.isAnyDescendantAPhetioMouseHitTarget())}getPhetioMouseHit(e){if(!this.isPhetioMouseHittable(e))return null;const t=this._transform.getInverse().timesVector2(e);let i=null;for(let s=this._children.length-1;s>=0;s--){const n=this._children[s].getPhetioMouseHit(t);if(n instanceof Hi)return n;n==="phetioNotSelectable"&&(i=!0)}return i?this.getPhetioMouseHitTarget():this._mouseArea?this._mouseArea.containsPoint(t)?this.getPhetioMouseHitTarget():null:this.selfBounds.containsPoint(t)&&this.containsPointSelf(t)?this.getPhetioMouseHitTarget():null}isPainted(){return!1}areSelfBoundsValid(){return!0}hasParent(){return this._parents.length!==0}hasChildren(){return this._children.length>0}isChildIncludedInLayout(e){return e.bounds.isValid()&&(!this._excludeInvisibleChildrenFromBounds||e.visible)}walkDepthFirst(e){e(this);const t=this._children.length;for(let i=0;i<t;i++)this._children[i].walkDepthFirst(e)}addInputListener(e){return assert&&assert(!_.includes(this._inputListeners,e),"Input listener already registered on this Node"),assert&&assert(e!==null,"Input listener cannot be null"),assert&&assert(e!==void 0,"Input listener cannot be undefined"),_.includes(this._inputListeners,e)||(this._inputListeners.push(e),this._picker.onAddInputListener(),assertSlow&&this._picker.audit(),e.hotkeys&&Nu.updateHotkeysFromInputListenerChange(this)),this}removeInputListener(e){const t=_.indexOf(this._inputListeners,e);return assert&&assert(this.isDisposed||t>=0,"Could not find input listener to remove"),t>=0&&(this._inputListeners.splice(t,1),this._picker.onRemoveInputListener(),assertSlow&&this._picker.audit(),e.hotkeys&&Nu.updateHotkeysFromInputListenerChange(this)),this}hasInputListener(e){for(let t=0;t<this._inputListeners.length;t++)if(this._inputListeners[t]===e)return!0;return!1}interruptInput(){const e=this.inputListeners;for(let t=0;t<e.length;t++){const i=e[t];i.interrupt&&i.interrupt()}return this}interruptSubtreeInput(){this.interruptInput();const e=this._children.slice();for(let t=0;t<e.length;t++)e[t].interruptSubtreeInput();return this}translate(e,t,i){if(typeof e=="number"){if(assert&&assert(isFinite(e),"x should be a finite number"),assert&&assert(typeof t=="number"&&isFinite(t),"y should be a finite number"),Math.abs(e)<1e-12&&Math.abs(t)<1e-12)return;i?this.prependTranslation(e,t):this.appendMatrix(Mc.setToTranslation(e,t))}else{const s=e;if(assert&&assert(s.isFinite(),"translation should be a finite Vector2 if not finite numbers"),!s.x&&!s.y)return;this.translate(s.x,s.y,t)}}scale(e,t,i){if(typeof e=="number")if(assert&&assert(isFinite(e),"scales should be finite"),t===void 0||typeof t=="boolean")this.scale(e,e,t);else{if(assert&&assert(isFinite(t),"scales should be finite numbers"),assert&&assert(i===void 0||typeof i=="boolean","If provided, prependInstead should be boolean"),e===1&&t===1)return;i?this.prependMatrix(Ze.scaling(e,t)):this.appendMatrix(Ze.scaling(e,t))}else{const s=e;assert&&assert(s.isFinite(),"scale should be a finite Vector2 if not a finite number"),this.scale(s.x,s.y,t)}}rotate(e,t){assert&&assert(isFinite(e),"angle should be a finite number"),assert&&assert(t===void 0||typeof t=="boolean"),e%(2*Math.PI)!==0&&(t?this.prependMatrix(Ze.rotation2(e)):this.appendMatrix(Ze.rotation2(e)))}rotateAround(e,t){assert&&assert(e.isFinite(),"point should be a finite Vector2"),assert&&assert(isFinite(t),"angle should be a finite number");let i=Ze.translation(-e.x,-e.y);return i=Ze.rotation2(t).timesMatrix(i),i=Ze.translation(e.x,e.y).timesMatrix(i),this.prependMatrix(i),this}setX(e){return assert&&assert(isFinite(e),"x should be a finite number"),this.translate(e-this.getX(),0,!0),this}set x(e){this.setX(e)}get x(){return this.getX()}getX(){return this._transform.getMatrix().m02()}setY(e){return assert&&assert(isFinite(e),"y should be a finite number"),this.translate(0,e-this.getY(),!0),this}set y(e){this.setY(e)}get y(){return this.getY()}getY(){return this._transform.getMatrix().m12()}setScaleMagnitude(e,t){const i=this.getScaleVector();return typeof e=="number"?(t===void 0&&(t=e),assert&&assert(isFinite(e),"setScaleMagnitude parameters should be finite numbers"),assert&&assert(isFinite(t),"setScaleMagnitude parameters should be finite numbers"),this.appendMatrix(Ze.scaling(e/i.x,t/i.y))):(assert&&assert(e.isFinite(),"first parameter should be a finite Vector2"),this.appendMatrix(Ze.scaling(e.x/i.x,e.y/i.y))),this}getScaleVector(){return this._transform.getMatrix().getScaleVector()}setRotation(e){return assert&&assert(isFinite(e),"rotation should be a finite number"),this.appendMatrix(Mc.setToRotationZ(e-this.getRotation())),this}set rotation(e){this.setRotation(e)}get rotation(){return this.getRotation()}getRotation(){return this._transform.getMatrix().getRotation()}setTranslation(e,t){const i=this._transform.getMatrix(),s=i.m02(),n=i.m12();let o,c;return typeof e=="number"?(assert&&assert(isFinite(e),"Parameters to setTranslation should be finite numbers"),assert&&assert(t!==void 0&&isFinite(t),"Parameters to setTranslation should be finite numbers"),o=e-s,c=t-n):(assert&&assert(e.isFinite(),"Should be a finite Vector2"),o=e.x-s,c=e.y-n),this.translate(o,c,!0),this}set translation(e){this.setTranslation(e)}get translation(){return this.getTranslation()}getTranslation(){const e=this._transform.getMatrix();return new Pe(e.m02(),e.m12())}appendMatrix(e){assert&&assert(e.isFinite(),"matrix should be a finite Matrix3"),assert&&assert(e.getDeterminant()!==0,"matrix should not map plane to a line or point"),this._transform.append(e)}prependMatrix(e){assert&&assert(e.isFinite(),"matrix should be a finite Matrix3"),assert&&assert(e.getDeterminant()!==0,"matrix should not map plane to a line or point"),this._transform.prepend(e)}prependTranslation(e,t){assert&&assert(isFinite(e),"x should be a finite number"),assert&&assert(isFinite(t),"y should be a finite number"),!(!e&&!t)&&this._transform.prependTranslation(e,t)}setMatrix(e){assert&&assert(e.isFinite(),"matrix should be a finite Matrix3"),assert&&assert(e.getDeterminant()!==0,"matrix should not map plane to a line or point"),this._transform.setMatrix(e)}set matrix(e){this.setMatrix(e)}get matrix(){return this.getMatrix()}getMatrix(){return this._transform.getMatrix()}getTransform(){return this._transform}get transform(){return this.getTransform()}resetTransform(){this.setMatrix(Ze.IDENTITY)}onTransformChange(){this.invalidateBounds(),this._picker.onTransformChange(),assertSlow&&this._picker.audit(),this.transformEmitter.emit()}onSummaryChange(e,t){this._pdomDisplaysInfo.onSummaryChange(e,t)}updateMaxDimension(e){assert&&this.auditMaxDimensions();const t=this._appliedScaleFactor;let i=1;if(this._maxWidth!==null){const n=e.width;n>this._maxWidth&&(i=Math.min(i,this._maxWidth/n))}if(this._maxHeight!==null){const n=e.height;n>this._maxHeight&&(i=Math.min(i,this._maxHeight/n))}const s=i/t;s!==1&&(this._appliedScaleFactor=i,this.scale(s))}auditMaxDimensions(){assert&&assert(this._maxWidth===null||!Wa(this)||this.preferredWidth===null||this._maxWidth>=this.preferredWidth-1e-7,"If maxWidth and preferredWidth are both non-null, maxWidth should NOT be smaller than the preferredWidth. If that happens, it would trigger an infinite loop"),assert&&assert(this._maxHeight===null||!Ua(this)||this.preferredHeight===null||this._maxHeight>=this.preferredHeight-1e-7,"If maxHeight and preferredHeight are both non-null, maxHeight should NOT be smaller than the preferredHeight. If that happens, it would trigger an infinite loop")}onMaxDimensionChange(e,t){e===null&&t!==null?(this.changeBoundsEventCount(1),this._boundsEventSelfCount++):e!==null&&t===null&&(this.changeBoundsEventCount(-1),this._boundsEventSelfCount--)}setMaxWidth(e){assert&&assert(e===null||typeof e=="number"&&e>0,"maxWidth should be null (no constraint) or a positive number"),this._maxWidth!==e&&(this.onMaxDimensionChange(this._maxWidth,e),this._maxWidth=e,this.updateMaxDimension(this.localBoundsProperty.value))}set maxWidth(e){this.setMaxWidth(e)}get maxWidth(){return this.getMaxWidth()}getMaxWidth(){return this._maxWidth}setMaxHeight(e){assert&&assert(e===null||typeof e=="number"&&e>0,"maxHeight should be null (no constraint) or a positive number"),this._maxHeight!==e&&(this.onMaxDimensionChange(this._maxHeight,e),this._maxHeight=e,this.updateMaxDimension(this.localBoundsProperty.value))}set maxHeight(e){this.setMaxHeight(e)}get maxHeight(){return this.getMaxHeight()}getMaxHeight(){return this._maxHeight}setLeft(e){const t=this.getLeft();return isFinite(t)&&this.translate(e-t,0,!0),this}set left(e){this.setLeft(e)}get left(){return this.getLeft()}getLeft(){return this.getBounds().minX}setRight(e){const t=this.getRight();return isFinite(t)&&this.translate(e-t,0,!0),this}set right(e){this.setRight(e)}get right(){return this.getRight()}getRight(){return this.getBounds().maxX}setCenterX(e){const t=this.getCenterX();return isFinite(t)&&this.translate(e-t,0,!0),this}set centerX(e){this.setCenterX(e)}get centerX(){return this.getCenterX()}getCenterX(){return this.getBounds().getCenterX()}setCenterY(e){const t=this.getCenterY();return isFinite(t)&&this.translate(0,e-t,!0),this}set centerY(e){this.setCenterY(e)}get centerY(){return this.getCenterY()}getCenterY(){return this.getBounds().getCenterY()}setTop(e){const t=this.getTop();return isFinite(t)&&this.translate(0,e-t,!0),this}set top(e){this.setTop(e)}get top(){return this.getTop()}getTop(){return this.getBounds().minY}setBottom(e){const t=this.getBottom();return isFinite(t)&&this.translate(0,e-t,!0),this}set bottom(e){this.setBottom(e)}get bottom(){return this.getBottom()}getBottom(){return this.getBounds().maxY}setLeftTop(e){assert&&assert(e.isFinite(),"leftTop should be a finite Vector2");const t=this.getLeftTop();return t.isFinite()&&this.translate(e.minus(t),!0),this}set leftTop(e){this.setLeftTop(e)}get leftTop(){return this.getLeftTop()}getLeftTop(){return this.getBounds().getLeftTop()}setCenterTop(e){assert&&assert(e.isFinite(),"centerTop should be a finite Vector2");const t=this.getCenterTop();return t.isFinite()&&this.translate(e.minus(t),!0),this}set centerTop(e){this.setCenterTop(e)}get centerTop(){return this.getCenterTop()}getCenterTop(){return this.getBounds().getCenterTop()}setRightTop(e){assert&&assert(e.isFinite(),"rightTop should be a finite Vector2");const t=this.getRightTop();return t.isFinite()&&this.translate(e.minus(t),!0),this}set rightTop(e){this.setRightTop(e)}get rightTop(){return this.getRightTop()}getRightTop(){return this.getBounds().getRightTop()}setLeftCenter(e){assert&&assert(e.isFinite(),"leftCenter should be a finite Vector2");const t=this.getLeftCenter();return t.isFinite()&&this.translate(e.minus(t),!0),this}set leftCenter(e){this.setLeftCenter(e)}get leftCenter(){return this.getLeftCenter()}getLeftCenter(){return this.getBounds().getLeftCenter()}setCenter(e){assert&&assert(e.isFinite(),"center should be a finite Vector2");const t=this.getCenter();return t.isFinite()&&this.translate(e.minus(t),!0),this}set center(e){this.setCenter(e)}get center(){return this.getCenter()}getCenter(){return this.getBounds().getCenter()}setRightCenter(e){assert&&assert(e.isFinite(),"rightCenter should be a finite Vector2");const t=this.getRightCenter();return t.isFinite()&&this.translate(e.minus(t),!0),this}set rightCenter(e){this.setRightCenter(e)}get rightCenter(){return this.getRightCenter()}getRightCenter(){return this.getBounds().getRightCenter()}setLeftBottom(e){assert&&assert(e.isFinite(),"leftBottom should be a finite Vector2");const t=this.getLeftBottom();return t.isFinite()&&this.translate(e.minus(t),!0),this}set leftBottom(e){this.setLeftBottom(e)}get leftBottom(){return this.getLeftBottom()}getLeftBottom(){return this.getBounds().getLeftBottom()}setCenterBottom(e){assert&&assert(e.isFinite(),"centerBottom should be a finite Vector2");const t=this.getCenterBottom();return t.isFinite()&&this.translate(e.minus(t),!0),this}set centerBottom(e){this.setCenterBottom(e)}get centerBottom(){return this.getCenterBottom()}getCenterBottom(){return this.getBounds().getCenterBottom()}setRightBottom(e){assert&&assert(e.isFinite(),"rightBottom should be a finite Vector2");const t=this.getRightBottom();return t.isFinite()&&this.translate(e.minus(t),!0),this}set rightBottom(e){this.setRightBottom(e)}get rightBottom(){return this.getRightBottom()}getRightBottom(){return this.getBounds().getRightBottom()}getWidth(){return this.getBounds().getWidth()}get width(){return this.getWidth()}getHeight(){return this.getBounds().getHeight()}get height(){return this.getHeight()}getLocalWidth(){return this.getLocalBounds().getWidth()}get localWidth(){return this.getLocalWidth()}getLocalHeight(){return this.getLocalBounds().getHeight()}get localHeight(){return this.getLocalHeight()}getLocalLeft(){return this.getLocalBounds().minX}get localLeft(){return this.getLocalLeft()}getLocalRight(){return this.getLocalBounds().maxX}get localRight(){return this.getLocalRight()}getLocalCenterX(){return this.getLocalBounds().getCenterX()}get localCenterX(){return this.getLocalCenterX()}getLocalCenterY(){return this.getLocalBounds().getCenterY()}get localCenterY(){return this.getLocalCenterY()}getLocalTop(){return this.getLocalBounds().minY}get localTop(){return this.getLocalTop()}getLocalBottom(){return this.getLocalBounds().maxY}get localBottom(){return this.getLocalBottom()}getLocalLeftTop(){return this.getLocalBounds().getLeftTop()}get localLeftTop(){return this.getLocalLeftTop()}getLocalCenterTop(){return this.getLocalBounds().getCenterTop()}get localCenterTop(){return this.getLocalCenterTop()}getLocalRightTop(){return this.getLocalBounds().getRightTop()}get localRightTop(){return this.getLocalRightTop()}getLocalLeftCenter(){return this.getLocalBounds().getLeftCenter()}get localLeftCenter(){return this.getLocalLeftCenter()}getLocalCenter(){return this.getLocalBounds().getCenter()}get localCenter(){return this.getLocalCenter()}getLocalRightCenter(){return this.getLocalBounds().getRightCenter()}get localRightCenter(){return this.getLocalRightCenter()}getLocalLeftBottom(){return this.getLocalBounds().getLeftBottom()}get localLeftBottom(){return this.getLocalLeftBottom()}getLocalCenterBottom(){return this.getLocalBounds().getCenterBottom()}get localCenterBottom(){return this.getLocalCenterBottom()}getLocalRightBottom(){return this.getLocalBounds().getRightBottom()}get localRightBottom(){return this.getLocalRightBottom()}getId(){return this._id}get id(){return this.getId()}onVisiblePropertyChange(e){this._picker.onVisibilityChange(),assertSlow&&this._picker.audit(),this._pdomDisplaysInfo.onVisibilityChange(e);for(let t=0;t<this._parents.length;t++){const i=this._parents[t];i._excludeInvisibleChildrenFromBounds&&i.invalidateChildBounds()}}setVisibleProperty(e){return this._visibleProperty.setTargetProperty(e,this,Nc)}set visibleProperty(e){this.setVisibleProperty(e)}get visibleProperty(){return this.getVisibleProperty()}getVisibleProperty(){return this._visibleProperty}setVisible(e){return this.visibleProperty.set(e),this}set visible(e){this.setVisible(e)}get visible(){return this.isVisible()}isVisible(){return this.visibleProperty.value}setPhetioVisiblePropertyInstrumented(e){return this._visibleProperty.setTargetPropertyInstrumented(e,this)}set phetioVisiblePropertyInstrumented(e){this.setPhetioVisiblePropertyInstrumented(e)}get phetioVisiblePropertyInstrumented(){return this.getPhetioVisiblePropertyInstrumented()}getPhetioVisiblePropertyInstrumented(){return this._visibleProperty.getTargetPropertyInstrumented()}swapVisibility(e){assert&&assert(this.visible!==e.visible);const t=this.visible?this:e,i=this.visible?e:this,s=t.focused;return t.visible=!1,i.visible=!0,s&&i.focusable&&i.focus(),this}setOpacity(e){if(assert&&assert(isFinite(e),"opacity should be a finite number"),e<0||e>1)throw new Error(`opacity out of range: ${e}`);this.opacityProperty.value=e}set opacity(e){this.setOpacity(e)}get opacity(){return this.getOpacity()}getOpacity(){return this.opacityProperty.value}setDisabledOpacity(e){if(assert&&assert(isFinite(e),"disabledOpacity should be a finite number"),e<0||e>1)throw new Error(`disabledOpacity out of range: ${e}`);return this.disabledOpacityProperty.value=e,this}set disabledOpacity(e){this.setDisabledOpacity(e)}get disabledOpacity(){return this.getDisabledOpacity()}getDisabledOpacity(){return this.disabledOpacityProperty.value}getEffectiveOpacity(){return this.opacityProperty.value*(this.enabledProperty.value?1:this.disabledOpacityProperty.value)}get effectiveOpacity(){return this.getEffectiveOpacity()}onOpacityPropertyChange(){this.filterChangeEmitter.emit()}onDisabledOpacityPropertyChange(){this._enabledProperty.value||this.filterChangeEmitter.emit()}setFilters(e){assert&&assert(Array.isArray(e),"filters should be an array"),assert&&assert(_.every(e,t=>t instanceof Vr),"filters should consist of Filter objects only"),this._filters.length=0,this._filters.push(...e),this.invalidateHint(),this.filterChangeEmitter.emit()}set filters(e){this.setFilters(e)}get filters(){return this.getFilters()}getFilters(){return this._filters.slice()}setPickableProperty(e){return this._pickableProperty.setTargetProperty(e,this,null)}set pickableProperty(e){this.setPickableProperty(e)}get pickableProperty(){return this.getPickableProperty()}getPickableProperty(){return this._pickableProperty}setPickable(e){return assert&&assert(e===null||typeof e=="boolean"),this._pickableProperty.set(e),this}set pickable(e){this.setPickable(e)}get pickable(){return this.isPickable()}isPickable(){return this._pickableProperty.value}onPickablePropertyChange(e,t){this._picker.onPickableChange(t,e),assertSlow&&this._picker.audit()}setEnabledProperty(e){return this._enabledProperty.setTargetProperty(e,this,Rc)}set enabledProperty(e){this.setEnabledProperty(e)}get enabledProperty(){return this.getEnabledProperty()}getEnabledProperty(){return this._enabledProperty}setPhetioEnabledPropertyInstrumented(e){return this._enabledProperty.setTargetPropertyInstrumented(e,this)}set phetioEnabledPropertyInstrumented(e){this.setPhetioEnabledPropertyInstrumented(e)}get phetioEnabledPropertyInstrumented(){return this.getPhetioEnabledPropertyInstrumented()}getPhetioEnabledPropertyInstrumented(){return this._enabledProperty.getTargetPropertyInstrumented()}setEnabled(e){return assert&&assert(e===null||typeof e=="boolean"),this._enabledProperty.set(e),this}set enabled(e){this.setEnabled(e)}get enabled(){return this.isEnabled()}isEnabled(){return this._enabledProperty.value}onEnabledPropertyChange(e){!e&&this.interruptSubtreeInput(),this.inputEnabled=e,this.disabledOpacityProperty.value!==1&&this.filterChangeEmitter.emit()}setInputEnabledProperty(e){return this._inputEnabledProperty.setTargetProperty(e,this,Bc)}set inputEnabledProperty(e){this.setInputEnabledProperty(e)}get inputEnabledProperty(){return this.getInputEnabledProperty()}getInputEnabledProperty(){return this._inputEnabledProperty}setPhetioInputEnabledPropertyInstrumented(e){return this._inputEnabledProperty.setTargetPropertyInstrumented(e,this)}set phetioInputEnabledPropertyInstrumented(e){this.setPhetioInputEnabledPropertyInstrumented(e)}get phetioInputEnabledPropertyInstrumented(){return this.getPhetioInputEnabledPropertyInstrumented()}getPhetioInputEnabledPropertyInstrumented(){return this._inputEnabledProperty.getTargetPropertyInstrumented()}setInputEnabled(e){this.inputEnabledProperty.value=e}set inputEnabled(e){this.setInputEnabled(e)}get inputEnabled(){return this.isInputEnabled()}isInputEnabled(){return this.inputEnabledProperty.value}setInputListeners(e){for(assert&&assert(Array.isArray(e));this._inputListeners.length;)this.removeInputListener(this._inputListeners[0]);for(let t=0;t<e.length;t++)this.addInputListener(e[t]);return this}set inputListeners(e){this.setInputListeners(e)}get inputListeners(){return this.getInputListeners()}getInputListeners(){return this._inputListeners.slice(0)}setCursor(e){this._cursor=e==="auto"?null:e}set cursor(e){this.setCursor(e)}get cursor(){return this.getCursor()}getCursor(){return this._cursor}getEffectiveCursor(){if(this._cursor)return this._cursor;for(let e=0;e<this._inputListeners.length;e++){const t=this._inputListeners[e];if(t.cursor)return t.cursor}return null}setMouseArea(e){return assert&&assert(e===null||e instanceof kt||e instanceof $e,"mouseArea needs to be a phet.kite.Shape, phet.dot.Bounds2, or null"),this._mouseArea!==e&&(this._mouseArea=e,this._picker.onMouseAreaChange(),assertSlow&&this._picker.audit()),this}set mouseArea(e){this.setMouseArea(e)}get mouseArea(){return this.getMouseArea()}getMouseArea(){return this._mouseArea}setTouchArea(e){return assert&&assert(e===null||e instanceof kt||e instanceof $e,"touchArea needs to be a phet.kite.Shape, phet.dot.Bounds2, or null"),this._touchArea!==e&&(this._touchArea=e,this._picker.onTouchAreaChange(),assertSlow&&this._picker.audit()),this}set touchArea(e){this.setTouchArea(e)}get touchArea(){return this.getTouchArea()}getTouchArea(){return this._touchArea}setClipArea(e){assert&&assert(e===null||e instanceof kt,"clipArea needs to be a phet.kite.Shape, or null"),this.clipArea!==e&&(this.clipAreaProperty.value=e,this.invalidateBounds(),this._picker.onClipAreaChange(),assertSlow&&this._picker.audit())}set clipArea(e){this.setClipArea(e)}get clipArea(){return this.getClipArea()}getClipArea(){return this.clipAreaProperty.value}hasClipArea(){return this.clipArea!==null}setRendererBitmask(e){assert&&assert(isFinite(e)),e!==this._rendererBitmask&&(this._rendererBitmask=e,this._rendererSummary.selfChange(),this.instanceRefreshEmitter.emit())}invalidateSupportedRenderers(){}invalidateHint(){this.rendererSummaryRefreshEmitter.emit(),this.instanceRefreshEmitter.emit()}setRenderer(e){assert&&assert(e===null||e==="canvas"||e==="svg"||e==="dom"||e==="webgl",'Renderer input should be null, or one of: "canvas", "svg", "dom" or "webgl".');let t=0;e==="canvas"?t=de.bitmaskCanvas:e==="svg"?t=de.bitmaskSVG:e==="dom"?t=de.bitmaskDOM:e==="webgl"&&(t=de.bitmaskWebGL),assert&&assert(e===null==(t===0),"We should only end up with no actual renderer if renderer is null"),this._renderer!==t&&(this._renderer=t,this.invalidateHint())}set renderer(e){this.setRenderer(e)}get renderer(){return this.getRenderer()}getRenderer(){return this._renderer===0?null:this._renderer===de.bitmaskCanvas?"canvas":this._renderer===de.bitmaskSVG?"svg":this._renderer===de.bitmaskDOM?"dom":this._renderer===de.bitmaskWebGL?"webgl":(assert&&assert(!1,"Seems to be an invalid renderer?"),null)}setLayerSplit(e){e!==this._layerSplit&&(this._layerSplit=e,this.invalidateHint())}set layerSplit(e){this.setLayerSplit(e)}get layerSplit(){return this.isLayerSplit()}isLayerSplit(){return this._layerSplit}setUsesOpacity(e){e!==this._usesOpacity&&(this._usesOpacity=e,this.invalidateHint())}set usesOpacity(e){this.setUsesOpacity(e)}get usesOpacity(){return this.getUsesOpacity()}getUsesOpacity(){return this._usesOpacity}setCSSTransform(e){e!==this._cssTransform&&(this._cssTransform=e,this.invalidateHint())}set cssTransform(e){this.setCSSTransform(e)}get cssTransform(){return this.isCSSTransformed()}isCSSTransformed(){return this._cssTransform}setExcludeInvisible(e){e!==this._excludeInvisible&&(this._excludeInvisible=e,this.invalidateHint())}set excludeInvisible(e){this.setExcludeInvisible(e)}get excludeInvisible(){return this.isExcludeInvisible()}isExcludeInvisible(){return this._excludeInvisible}setExcludeInvisibleChildrenFromBounds(e){e!==this._excludeInvisibleChildrenFromBounds&&(this._excludeInvisibleChildrenFromBounds=e,this.invalidateBounds())}set excludeInvisibleChildrenFromBounds(e){this.setExcludeInvisibleChildrenFromBounds(e)}get excludeInvisibleChildrenFromBounds(){return this.isExcludeInvisibleChildrenFromBounds()}isExcludeInvisibleChildrenFromBounds(){return this._excludeInvisibleChildrenFromBounds}setLayoutOptions(e){assert&&assert(e===null||typeof e=="object"&&Object.getPrototypeOf(e)===Object.prototype,"layoutOptions should be null or an plain options-style object"),e!==this._layoutOptions&&(this._layoutOptions=e,this.layoutOptionsChangedEmitter.emit())}set layoutOptions(e){this.setLayoutOptions(e)}get layoutOptions(){return this.getLayoutOptions()}getLayoutOptions(){return this._layoutOptions}mutateLayoutOptions(e){this.layoutOptions=or()({},this.layoutOptions||{},e)}get widthSizable(){return!1}get heightSizable(){return!1}get extendsWidthSizable(){return!1}get extendsHeightSizable(){return!1}get extendsSizable(){return!1}setPreventFit(e){e!==this._preventFit&&(this._preventFit=e,this.invalidateHint())}set preventFit(e){this.setPreventFit(e)}get preventFit(){return this.isPreventFit()}isPreventFit(){return this._preventFit}setWebGLScale(e){assert&&assert(e===null||typeof e=="number"&&isFinite(e)),e!==this._webglScale&&(this._webglScale=e,this.invalidateHint())}set webglScale(e){this.setWebGLScale(e)}get webglScale(){return this.getWebGLScale()}getWebGLScale(){return this._webglScale}getUniqueTrail(e){if(e){const t=this.getTrails(e);return assert&&assert(t.length===1,`getUniqueTrail found ${t.length} matching trails for the predicate`),t[0]}else{const t=new wt;let i=this;for(;i;)assert&&assert(i._parents.length<=1,`getUniqueTrail found a Node with ${i._parents.length} parents.`),t.addAncestor(i),i=i._parents[0];return t}}getUniqueTrailTo(e){return this.getUniqueTrail(t=>e===t)}getTrails(e){e=e||bs.defaultTrailPredicate;const t=[],i=new wt(this);return wt.appendAncestorTrailsWithPredicate(t,i,e),t}getTrailsTo(e){return this.getTrails(t=>t===e)}getLeafTrails(e){e=e||bs.defaultLeafTrailPredicate;const t=[],i=new wt(this);return wt.appendDescendantTrailsWithPredicate(t,i,e),t}getLeafTrailsTo(e){return this.getLeafTrails(t=>t===e)}getUniqueLeafTrail(e){const t=this.getLeafTrails(e);return assert&&assert(t.length===1,`getUniqueLeafTrail found ${t.length} matching trails for the predicate`),t[0]}getUniqueLeafTrailTo(e){return this.getUniqueLeafTrail(t=>t===e)}getConnectedNodes(){const e=[];let t=this._children.concat(this._parents).concat(this);for(;t.length;){const i=t.pop();_.includes(e,i)||(e.push(i),t=t.concat(i._children,i._parents))}return e}getSubtreeNodes(){const e=[];let t=this._children.concat(this);for(;t.length;){const i=t.pop();_.includes(e,i)||(e.push(i),t=t.concat(i._children))}return e}getTopologicallySortedNodes(){const e={},t=[],i=[];let s;_.each(this.getConnectedNodes(),o=>{e[o.id]={},_.each(o._children,c=>{e[o.id][c.id]=!0}),o.parents.length||t.push(o)});function n(o){delete e[s.id][o.id],_.every(e,c=>!c[o.id])&&t.push(o)}for(;t.length;)s=t.pop(),i.push(s),_.each(s._children,n);return assert&&assert(_.every(e,o=>_.every(o,c=>!1)),"circular reference check"),i}canAddChild(e){if(this===e||_.includes(this._children,e))return!1;const t={},i=[];let s;_.each(this.getConnectedNodes().concat(e.getConnectedNodes()),o=>{t[o.id]={},_.each(o._children,c=>{t[o.id][c.id]=!0}),!o.parents.length&&o!==e&&i.push(o)}),t[this.id][e.id]=!0;function n(o){delete t[s.id][o.id],_.every(t,c=>!c[o.id])&&i.push(o)}for(;i.length;)s=i.pop(),_.each(s._children,n),s===this&&n(e);return _.every(t,o=>_.every(o,c=>!1))}canvasPaintSelf(e,t){}renderToCanvasSelf(e,t){this.isPainted()&&this._rendererBitmask&de.bitmaskCanvas&&this.canvasPaintSelf(e,t)}renderToCanvasSubtree(e,t){t=t||Ze.identity(),e.resetStyles(),this.renderToCanvasSelf(e,t);for(let i=0;i<this._children.length;i++){const s=this._children[i];if(s.isVisible()&&s.bounds.isValid()){const n=s.effectiveOpacity!==1||s.clipArea||s._filters.length;if(e.context.save(),t.multiplyMatrix(s._transform.getMatrix()),t.canvasSetTransform(e.context),n){const o=s.localBounds.transformed(t).dilate(4).roundOut().constrainBounds(Lv.setMinMax(0,0,e.canvas.width,e.canvas.height));if(o.width>0&&o.height>0){const c=document.createElement("canvas");c.width=o.width,c.height=o.height;const p=c.getContext("2d"),f=new Rr(c,p),w=t.copy().prependTranslation(-o.minX,-o.minY);w.canvasSetTransform(p),s.renderToCanvasSubtree(f,w),e.context.save(),s.clipArea&&(e.context.beginPath(),s.clipArea.writeToContext(e.context),e.context.clip()),e.context.setTransform(1,0,0,1,0,0),e.context.globalAlpha=s.effectiveOpacity;let O=!1;s._filters.length&&(ht.canvasFilter&&_.every(s._filters,T=>T.isDOMCompatible())?(e.context.filter=s._filters.map(T=>T.getCSSFilterString()).join(" "),O=!0):s._filters.forEach(T=>T.applyCanvasFilter(f))),e.context.drawImage(c,o.minX,o.minY),e.context.restore(),O&&(e.context.filter="none")}}else s.renderToCanvasSubtree(e,t);t.multiplyMatrix(s._transform.getInverse()),e.context.restore()}}}renderToCanvas(e,t,i,s){assert&&xn("Node.renderToCanvas() is deprecated, please use Node.rasterized() instead"),e.width=e.width,s&&(t.fillStyle=s,t.fillRect(0,0,e.width,e.height));const n=new Rr(e,t);this.renderToCanvasSubtree(n,Ze.identity()),i&&i()}toCanvas(e,t,i,s,n){assert&&assert(t===void 0||typeof t=="number","If provided, x should be a number"),assert&&assert(i===void 0||typeof i=="number","If provided, y should be a number"),assert&&assert(s===void 0||typeof s=="number"&&s>=0&&s%1===0,"If provided, width should be a non-negative integer"),assert&&assert(n===void 0||typeof n=="number"&&n>=0&&n%1===0,"If provided, height should be a non-negative integer");const o=2,c=this.getBounds().union(this.localToParentBounds(this.getSafeSelfBounds()));assert&&assert(!c.isEmpty()||t!==void 0&&i!==void 0&&s!==void 0&&n!==void 0,"Should not call toCanvas on a Node with empty bounds, unless all dimensions are provided"),t=t!==void 0?t:Math.ceil(o-c.minX),i=i!==void 0?i:Math.ceil(o-c.minY),s=s!==void 0?s:Math.ceil(c.getWidth()+2*o),n=n!==void 0?n:Math.ceil(c.getHeight()+2*o);const p=document.createElement("canvas");p.width=s,p.height=n;const f=p.getContext("2d");f.translate(t,i),this._transform.getMatrix().canvasAppendTransform(f);const w=new Rr(p,f);this.renderToCanvasSubtree(w,Ze.translation(t,i).timesMatrix(this._transform.getMatrix())),e(p,t,i,s,n)}toDataURL(e,t,i,s,n){assert&&assert(t===void 0||typeof t=="number","If provided, x should be a number"),assert&&assert(i===void 0||typeof i=="number","If provided, y should be a number"),assert&&assert(s===void 0||typeof s=="number"&&s>=0&&s%1===0,"If provided, width should be a non-negative integer"),assert&&assert(n===void 0||typeof n=="number"&&n>=0&&n%1===0,"If provided, height should be a non-negative integer"),this.toCanvas((o,c,p,f,w)=>{e(o.toDataURL(),c,p,f,w)},t,i,s,n)}toImage(e,t,i,s,n){assert&&xn("Node.toImage() is deprecated, please use Node.rasterized() instead"),assert&&assert(t===void 0||typeof t=="number","If provided, x should be a number"),assert&&assert(i===void 0||typeof i=="number","If provided, y should be a number"),assert&&assert(s===void 0||typeof s=="number"&&s>=0&&s%1===0,"If provided, width should be a non-negative integer"),assert&&assert(n===void 0||typeof n=="number"&&n>=0&&n%1===0,"If provided, height should be a non-negative integer"),this.toDataURL((o,c,p)=>{const f=document.createElement("img");f.onload=()=>{e(f,c,p);try{delete f.onload}catch{}},f.src=o},t,i,s,n)}toImageNodeAsynchronous(e,t,i,s,n){assert&&xn("Node.toImageNodeAsyncrhonous() is deprecated, please use Node.rasterized() instead"),assert&&assert(t===void 0||typeof t=="number","If provided, x should be a number"),assert&&assert(i===void 0||typeof i=="number","If provided, y should be a number"),assert&&assert(s===void 0||typeof s=="number"&&s>=0&&s%1===0,"If provided, width should be a non-negative integer"),assert&&assert(n===void 0||typeof n=="number"&&n>=0&&n%1===0,"If provided, height should be a non-negative integer"),this.toImage((o,c,p)=>{e(new bs({children:[new Ls(o,{x:-c,y:-p})]}))},t,i,s,n)}toCanvasNodeSynchronous(e,t,i,s){assert&&xn("Node.toCanvasNodeSynchronous() is deprecated, please use Node.rasterized() instead"),assert&&assert(e===void 0||typeof e=="number","If provided, x should be a number"),assert&&assert(t===void 0||typeof t=="number","If provided, y should be a number"),assert&&assert(i===void 0||typeof i=="number"&&i>=0&&i%1===0,"If provided, width should be a non-negative integer"),assert&&assert(s===void 0||typeof s=="number"&&s>=0&&s%1===0,"If provided, height should be a non-negative integer");let n=null;return this.toCanvas((o,c,p)=>{n=new bs({children:[new Ls(o,{x:-c,y:-p})]})},e,t,i,s),assert&&assert(n,"toCanvasNodeSynchronous requires that the node can be rendered only using Canvas"),n}toDataURLImageSynchronous(e,t,i,s){assert&&xn("Node.toDataURLImageSychronous() is deprecated, please use Node.rasterized() instead"),assert&&assert(e===void 0||typeof e=="number","If provided, x should be a number"),assert&&assert(t===void 0||typeof t=="number","If provided, y should be a number"),assert&&assert(i===void 0||typeof i=="number"&&i>=0&&i%1===0,"If provided, width should be a non-negative integer"),assert&&assert(s===void 0||typeof s=="number"&&s>=0&&s%1===0,"If provided, height should be a non-negative integer");let n=null;return this.toDataURL((o,c,p,f,w)=>{n=new Ls(o,{x:-c,y:-p,initialWidth:f,initialHeight:w})},e,t,i,s),assert&&assert(n,"toDataURL failed to return a result synchronously"),n}toDataURLNodeSynchronous(e,t,i,s){return assert&&xn("Node.toDataURLNodeSynchronous() is deprecated, please use Node.rasterized() instead"),assert&&assert(e===void 0||typeof e=="number","If provided, x should be a number"),assert&&assert(t===void 0||typeof t=="number","If provided, y should be a number"),assert&&assert(i===void 0||typeof i=="number"&&i>=0&&i%1===0,"If provided, width should be a non-negative integer"),assert&&assert(s===void 0||typeof s=="number"&&s>=0&&s%1===0,"If provided, height should be a non-negative integer"),new bs({children:[this.toDataURLImageSynchronous(e,t,i,s)]})}rasterized(e){const t=st()({resolution:1,sourceBounds:null,useTargetBounds:!0,wrap:!0,useCanvas:!1,imageOptions:{}},e),i=t.resolution,s=t.sourceBounds;assert&&(assert(typeof i=="number"&&i>0,"resolution should be a positive number"),assert(s===null||s instanceof $e,"sourceBounds should be null or a Bounds2"),s&&(assert(s.isValid(),"sourceBounds should be valid (finite non-negative)"),assert(Number.isInteger(s.width),"sourceBounds.width should be an integer"),assert(Number.isInteger(s.height),"sourceBounds.height should be an integer")));const n=new bs({scale:i,children:[this]});let o=s||this.getSafeTransformedVisibleBounds().dilated(2).roundedOut();i!==1&&(o=new $e(i*o.minX,i*o.minY,i*o.maxX,i*o.maxY),o.width%1!==0&&(o.maxX+=1-o.width%1),o.height%1!==0&&(o.maxY+=1-o.height%1));let c=null;function p(w,O,T,z,U){const m=t.useCanvas?w:w.toDataURL();c=new Ls(m,_i({},t.imageOptions,{x:-O,y:-T,initialWidth:z,initialHeight:U})),c.scale(1/i,1/i,!0)}n.toCanvas(p,-o.minX,-o.minY,ct.roundSymmetric(o.width),ct.roundSymmetric(o.height)),assert&&assert(c,"The toCanvas should have executed synchronously"),n.dispose();let f=this.getVisibleBounds();if(s&&(f=s.intersection(f)),t.useTargetBounds&&(c.imageBounds=c.parentToLocalBounds(f)),t.wrap){const w=new bs({children:[c]});return t.useTargetBounds&&(w.localBounds=f),w}else return t.useTargetBounds&&(c.localBounds=c.parentToLocalBounds(f)),c}createDOMDrawable(e,t){throw new Error("createDOMDrawable is abstract. The subtype should either override this method, or not support the DOM renderer")}createSVGDrawable(e,t){throw new Error("createSVGDrawable is abstract. The subtype should either override this method, or not support the DOM renderer")}createCanvasDrawable(e,t){throw new Error("createCanvasDrawable is abstract. The subtype should either override this method, or not support the DOM renderer")}createWebGLDrawable(e,t){throw new Error("createWebGLDrawable is abstract. The subtype should either override this method, or not support the DOM renderer")}getInstances(){return this._instances}get instances(){return this.getInstances()}addInstance(e){this._instances.push(e),this.changedInstanceEmitter.emit(e,!0)}removeInstance(e){const t=_.indexOf(this._instances,e);assert&&assert(t!==-1,"Cannot remove a Instance from a Node if it was not there"),this._instances.splice(t,1),this.changedInstanceEmitter.emit(e,!1)}wasVisuallyDisplayed(e){for(let t=0;t<this._instances.length;t++){const i=this._instances[t];if(i.visible&&(!e||i.display===e))return!0}return!1}getRootedDisplays(){return this._rootedDisplays}get rootedDisplays(){return this.getRootedDisplays()}addRootedDisplay(e){this._rootedDisplays.push(e),this._pdomDisplaysInfo.onAddedRootedDisplay(e),this.rootedDisplayChangedEmitter.emit(e)}removeRootedDisplay(e){const t=_.indexOf(this._rootedDisplays,e);assert&&assert(t!==-1,"Cannot remove a Display from a Node if it was not there"),this._rootedDisplays.splice(t,1),this._pdomDisplaysInfo.onRemovedRootedDisplay(e),this.rootedDisplayChangedEmitter.emit(e)}getRecursiveConnectedDisplays(e){this.rootedDisplays.length&&e.push(...this.rootedDisplays);for(let t=0;t<this._parents.length;t++)e.push(...this._parents[t].getRecursiveConnectedDisplays(e));return _.uniq(e)}getConnectedDisplays(){return _.uniq(this.getRecursiveConnectedDisplays([]))}localToParentPoint(e){return this._transform.transformPosition2(e)}localToParentBounds(e){return this._transform.transformBounds2(e)}parentToLocalPoint(e){return this._transform.inversePosition2(e)}parentToLocalBounds(e){return this._transform.inverseBounds2(e)}transformBoundsFromLocalToParent(e){return e.transform(this._transform.getMatrix())}transformBoundsFromParentToLocal(e){return e.transform(this._transform.getInverse())}getLocalToGlobalMatrix(){let e=this;const t=[];for(;e;)t.push(e._transform.getMatrix()),assert&&assert(e._parents[1]===void 0,"getLocalToGlobalMatrix unable to work for DAG"),e=e._parents[0];const i=Ze.identity();for(let s=t.length-1;s>=0;s--)i.multiplyMatrix(t[s]);return i}getUniqueTransform(){return new Ks(this.getLocalToGlobalMatrix())}getGlobalToLocalMatrix(){return this.getLocalToGlobalMatrix().invert()}localToGlobalPoint(e){let t=this;const i=e.copy();for(;t;)t._transform.getMatrix().multiplyVector2(i),assert&&assert(t._parents[1]===void 0,"localToGlobalPoint unable to work for DAG"),t=t._parents[0];return i}globalToLocalPoint(e){let t=this;const i=[];for(;t;)i.push(t._transform),assert&&assert(t._parents[1]===void 0,"globalToLocalPoint unable to work for DAG"),t=t._parents[0];const s=e.copy();for(let n=i.length-1;n>=0;n--)i[n].getInverse().multiplyVector2(s);return s}localToGlobalBounds(e){return e.transformed(this.getLocalToGlobalMatrix())}globalToLocalBounds(e){return e.transformed(this.getGlobalToLocalMatrix())}parentToGlobalPoint(e){return assert&&assert(this.parents.length<=1,"parentToGlobalPoint unable to work for DAG"),this.parents.length?this.parents[0].localToGlobalPoint(e):e}parentToGlobalBounds(e){return assert&&assert(this.parents.length<=1,"parentToGlobalBounds unable to work for DAG"),this.parents.length?this.parents[0].localToGlobalBounds(e):e}globalToParentPoint(e){return assert&&assert(this.parents.length<=1,"globalToParentPoint unable to work for DAG"),this.parents.length?this.parents[0].globalToLocalPoint(e):e}globalToParentBounds(e){return assert&&assert(this.parents.length<=1,"globalToParentBounds unable to work for DAG"),this.parents.length?this.parents[0].globalToLocalBounds(e):e}getGlobalBounds(){return assert&&assert(this.parents.length<=1,"globalBounds unable to work for DAG"),this.parentToGlobalBounds(this.getBounds())}get globalBounds(){return this.getGlobalBounds()}boundsOf(e){return this.globalToLocalBounds(e.getGlobalBounds())}boundsTo(e){return e.globalToLocalBounds(this.getGlobalBounds())}attachDrawable(e){return this._drawables.push(e),this}detachDrawable(e){const t=_.indexOf(this._drawables,e);return assert&&assert(t>=0,"Invalid operation: trying to detach a non-referenced drawable"),this._drawables.splice(t,1),this}mutate(e){if(!e)return this;assert&&assert(Object.getPrototypeOf(e)===Object.prototype,"Extra prototype on Node options object is a code smell"),assert&&assert(_.filter(["translation","x","left","right","centerX","centerTop","rightTop","leftCenter","center","rightCenter","leftBottom","centerBottom","rightBottom"],i=>e[i]!==void 0).length<=1,`More than one mutation on this Node set the x component, check ${Object.keys(e).join(",")}`),assert&&assert(_.filter(["translation","y","top","bottom","centerY","centerTop","rightTop","leftCenter","center","rightCenter","leftBottom","centerBottom","rightBottom"],i=>e[i]!==void 0).length<=1,`More than one mutation on this Node set the y component, check ${Object.keys(e).join(",")}`),assert&&e.hasOwnProperty("enabled")&&e.hasOwnProperty("enabledProperty")&&assert&&assert(e.enabledProperty.value===e.enabled,"If both enabled and enabledProperty are provided, then values should match"),assert&&e.hasOwnProperty("inputEnabled")&&e.hasOwnProperty("inputEnabledProperty")&&assert&&assert(e.inputEnabledProperty.value===e.inputEnabled,"If both inputEnabled and inputEnabledProperty are provided, then values should match"),assert&&e.hasOwnProperty("visible")&&e.hasOwnProperty("visibleProperty")&&assert&&assert(e.visibleProperty.value===e.visible,"If both visible and visibleProperty are provided, then values should match"),assert&&e.hasOwnProperty("pdomVisible")&&e.hasOwnProperty("pdomVisibleProperty")&&assert&&assert(e.pdomVisibleProperty.value===e.pdomVisible,"If both pdomVisible and pdomVisibleProperty are provided, then values should match"),assert&&e.hasOwnProperty("pickable")&&e.hasOwnProperty("pickableProperty")&&assert&&assert(e.pickableProperty.value===e.pickable,"If both pickable and pickableProperty are provided, then values should match");const t=this._mutatorKeys;for(let i=0;i<t.length;i++){const s=t[i];if(assert&&assert(!e.hasOwnProperty(s)||e[s]!==void 0,`Undefined not allowed for Node key: ${s}`),e[s]!==void 0){const n=Object.getOwnPropertyDescriptor(bs.prototype,s);n&&typeof n.value=="function"?this[s](e[s]):this[s]=e[s]}}return this.initializePhetioObject(wv,e),this}initializePhetioObject(e,t){const i=this.isPhetioInstrumented();super.initializePhetioObject(e,t),ai.PHET_IO_ENABLED&&!i&&this.isPhetioInstrumented()&&(this._visibleProperty.initializePhetio(this,Nc,()=>new ci(this.visible,_i({phetioReadOnly:this.phetioReadOnly,tandem:this.tandem.createTandem(Nc),phetioDocumentation:"Controls whether the Node will be visible (and interactive)."},t.visiblePropertyOptions))),this._enabledProperty.initializePhetio(this,Rc,()=>new pl(this.enabled,_i({phetioReadOnly:this.phetioReadOnly,phetioDocumentation:'Sets whether the node is enabled. This will set whether input is enabled for this Node and most often children as well. It will also control and toggle the "disabled look" of the node.',tandem:this.tandem.createTandem(Rc)},t.enabledPropertyOptions))),this._inputEnabledProperty.initializePhetio(this,Bc,()=>new wi(this.inputEnabled,_i({phetioReadOnly:this.phetioReadOnly,tandem:this.tandem.createTandem(Bc),phetioValueType:Dr,phetioFeatured:!0,phetioDocumentation:"Sets whether the element will have input enabled, and hence be interactive."},t.inputEnabledPropertyOptions))))}setVoicingVisible(e){this.voicingVisibleProperty.value!==e&&(this.voicingVisibleProperty.value=e)}set voicingVisible(e){this.setVoicingVisible(e)}get voicingVisible(){return this.isVoicingVisible()}isVoicingVisible(){return this.voicingVisibleProperty.value}getDebugHTMLExtras(){return""}inspect(){localStorage.scenerySnapshot=JSON.stringify({type:"Subtree",rootNodeId:this.id,nodes:Ly(this)})}toString(){return`${this.constructor.name}#${this.id}`}auditInstanceSubtreeForDisplay(e){if(assertSlow){const t=this._instances.length;for(let i=0;i<t;i++){const s=this._instances[i];s.display===e&&assertSlow(s.trail.isValid(),`Invalid trail on Instance: ${s.toString()} with trail ${s.trail.toString()}`)}this.children.forEach(i=>{i.auditInstanceSubtreeForDisplay(e)})}}onBoundsListenersAddedOrRemoved(e){this.changeBoundsEventCount(e),this._boundsEventSelfCount+=e}dispose(){this.disposeParallelDOM(),this.removeAllChildren(),this.detach(),this._inputEnabledProperty.dispose(),this._enabledProperty.dispose(),this._pickableProperty.dispose(),this._visibleProperty.dispose(),super.dispose()}disposeSubtree(){if(!this.isDisposed){const e=this.children;this.dispose();for(let t=0;t<e.length;t++)e[t].disposeSubtree()}}static defaultTrailPredicate(e){return e._parents.length===0}static defaultLeafTrailPredicate(e){return e._children.length===0}},bs.REQUIRES_BOUNDS_OPTION_KEYS=lr,bs.DEFAULT_NODE_OPTIONS=Ni,bs);ma.prototype._mutatorKeys=Du.concat(Pv);ma.prototype.drawableMarkFlags=[];te.register("Node",ma);ma.NodeIO=new Ai("NodeIO",{valueType:ma,documentation:"The base type for graphical and potentially interactive objects.",metadataDefaults:{phetioState:Lm}});const wv={phetioType:ma.NodeIO,phetioState:Lm},tt=ma;class Pm{constructor(e){this.node=e,this.selfPruned=!1,this.selfInclusive=!1,this.subtreePrunable=!0,this.subtreePickableCount=0,this.mouseInclusiveBounds=$e.NOTHING.copy(),this.mouseExclusiveBounds=$e.NOTHING.copy(),this.touchInclusiveBounds=$e.NOTHING.copy(),this.touchExclusiveBounds=$e.NOTHING.copy(),this.mouseInclusiveDirty=!0,this.mouseExclusiveDirty=!0,this.touchInclusiveDirty=!0,this.touchExclusiveDirty=!0,this.scratchVector=new Pe(0,0)}hitTest(e,t,i){assert&&assert(e,"trailUnderPointer requires a point"),sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`-------------- ${this.node.constructor.name}#${this.node.id}`);const s=this.selfInclusive;return t?s?this.validateMouseInclusive():this.validateMouseExclusive():i?s?this.validateTouchInclusive():this.validateTouchExclusive():this.node.validateBounds(),this.recursiveHitTest(e,t,i,!1)}recursiveHitTest(e,t,i,s){if(s=s||this.selfInclusive,this.selfPruned||!s&&this.subtreePrunable)return sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`${this.node.constructor.name}#${this.node.id} pruned ${this.selfPruned?"(self)":"(subtree)"}`),null;let n;if(t?(n=s?this.mouseInclusiveBounds:this.mouseExclusiveBounds,assert&&assert(s?!this.mouseInclusiveDirty:!this.mouseExclusiveDirty)):i?(n=s?this.touchInclusiveBounds:this.touchExclusiveBounds,assert&&assert(s?!this.touchInclusiveDirty:!this.touchExclusiveDirty)):(n=this.node.bounds,assert&&assert(!this.node._boundsDirty)),!n.containsPoint(e))return sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`${this.node.constructor.name}#${this.node.id} pruned: ${t?"mouse":i?"touch":"regular"}`),null;const o=this.node._transform.getInverse().multiplyVector2(this.scratchVector.set(e)),c=this.node.clipArea;if(c!==null&&!c.containsPoint(o))return sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`${this.node.constructor.name}#${this.node.id} out of clip area`),null;sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`${this.node.constructor.name}#${this.node.id}`);for(let p=this.node._children.length-1;p>=0;p--){const f=this.node._children[p];sceneryLog&&sceneryLog.hitTest&&sceneryLog.push();const w=f._picker.recursiveHitTest(o,t,i,s);if(sceneryLog&&sceneryLog.hitTest&&sceneryLog.pop(),w)return w.addAncestor(this.node,p)}return t&&this.node._mouseArea?(sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`${this.node.constructor.name}#${this.node.id} mouse area hit`),this.node._mouseArea.containsPoint(o)?new wt(this.node):null):i&&this.node._touchArea?(sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`${this.node.constructor.name}#${this.node.id} touch area hit`),this.node._touchArea.containsPoint(o)?new wt(this.node):null):this.node.selfBounds.containsPoint(o)&&this.node.containsPointSelf(o)?(sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`${this.node.constructor.name}#${this.node.id} self hit`),new wt(this.node)):null}invalidate(e,t){let i=!!t||!this.mouseInclusiveDirty||!this.touchInclusiveDirty;if(this.mouseInclusiveDirty=!0,this.touchInclusiveDirty=!0,e&&(i=i||!this.mouseExclusiveDirty||!this.touchExclusiveDirty,this.mouseExclusiveDirty=!0,this.touchExclusiveDirty=!0),!this.selfPruned&&i){const s=this.node._parents;for(let n=0;n<s.length;n++)s[n]._picker.invalidate(e||this.selfInclusive,!1)}}validateMouseInclusive(){if(!this.mouseInclusiveDirty)return;this.mouseInclusiveBounds.set(this.node.selfBounds);const e=this.node._children;for(let t=0;t<e.length;t++){const i=e[t]._picker;i.selfPruned||(i.validateMouseInclusive(),this.mouseInclusiveBounds.includeBounds(i.mouseInclusiveBounds))}this.applyAreasAndTransform(this.mouseInclusiveBounds,this.node._mouseArea),this.mouseInclusiveDirty=!1}validateMouseExclusive(){if(!this.mouseExclusiveDirty)return;this.mouseExclusiveBounds.set(this.node.selfBounds);const e=this.node._children;for(let t=0;t<e.length;t++){const i=e[t]._picker;i.subtreePrunable||(i.selfInclusive?(i.validateMouseInclusive(),this.mouseExclusiveBounds.includeBounds(i.mouseInclusiveBounds)):(i.validateMouseExclusive(),this.mouseExclusiveBounds.includeBounds(i.mouseExclusiveBounds)))}this.applyAreasAndTransform(this.mouseExclusiveBounds,this.node._mouseArea),this.mouseExclusiveDirty=!1}validateTouchInclusive(){if(!this.touchInclusiveDirty)return;this.touchInclusiveBounds.set(this.node.selfBounds);const e=this.node._children;for(let t=0;t<e.length;t++){const i=e[t]._picker;i.selfPruned||(i.validateTouchInclusive(),this.touchInclusiveBounds.includeBounds(i.touchInclusiveBounds))}this.applyAreasAndTransform(this.touchInclusiveBounds,this.node._touchArea),this.touchInclusiveDirty=!1}validateTouchExclusive(){if(!this.touchExclusiveDirty)return;this.touchExclusiveBounds.set(this.node.selfBounds);const e=this.node._children;for(let t=0;t<e.length;t++){const i=e[t]._picker;i.subtreePrunable||(i.selfInclusive?(i.validateTouchInclusive(),this.touchExclusiveBounds.includeBounds(i.touchInclusiveBounds)):(i.validateTouchExclusive(),this.touchExclusiveBounds.includeBounds(i.touchExclusiveBounds)))}this.applyAreasAndTransform(this.touchExclusiveBounds,this.node._touchArea),this.touchExclusiveDirty=!1}applyAreasAndTransform(e,t){t&&e.includeBounds(t instanceof $e?t:t.bounds);const i=this.node.clipArea;if(i){const s=i.bounds;e.minX=Math.max(e.minX,s.minX),e.minY=Math.max(e.minY,s.minY),e.maxX=Math.min(e.maxX,s.maxX),e.maxY=Math.min(e.maxY,s.maxY)}this.node.transformBoundsFromLocalToParent(e)}onInsertChild(e){if(!e._picker.selfPruned){const t=e._picker.subtreePickableCount>0;t&&this.changePickableCount(1),this.invalidate(t,!0)}}onRemoveChild(e){if(!e._picker.selfPruned){const t=e._picker.subtreePickableCount>0;t&&this.changePickableCount(-1),this.invalidate(t,!0)}}onAddInputListener(){this.checkSelfInclusive(),this.checkSubtreePrunable(),this.changePickableCount(1),assertSlow&&this.audit()}onRemoveInputListener(){this.checkSelfInclusive(),this.checkSubtreePrunable(),this.changePickableCount(-1),assertSlow&&this.audit()}onPickableChange(e,t){this.checkSelfPruned(),this.checkSelfInclusive(),this.checkSubtreePrunable();const i=(e===!0?-1:0)+(t===!0?1:0);i&&this.changePickableCount(i),assertSlow&&this.audit()}onVisibilityChange(){this.checkSelfPruned(),this.checkSubtreePrunable()}onMouseAreaChange(){this.invalidate(!0)}onTouchAreaChange(){this.invalidate(!0)}onTransformChange(){this.invalidate(!0)}onSelfBoundsDirty(){this.invalidate(!0)}onClipAreaChange(){this.invalidate(!0)}checkSelfPruned(){const e=this.node.pickableProperty.value===!1||!this.node.isVisible();if(this.selfPruned!==e){this.selfPruned=e;const t=this.node._parents;for(let i=0;i<t.length;i++){const s=t[i]._picker;this.subtreePickableCount>0?(s.invalidate(!0,!0),s.changePickableCount(this.selfPruned?-1:1)):s.invalidate(!1,!0)}}}checkSelfInclusive(){const e=this.node.pickableProperty.value===!0||this.node._inputListeners.length>0;this.selfInclusive!==e&&(this.selfInclusive=e,this.invalidate(!0,!0))}checkSubtreePrunable(){const e=this.node.pickableProperty.value===!1||!this.node.isVisible()||this.node.pickableProperty.value!==!0&&this.subtreePickableCount===0;this.subtreePrunable!==e&&(this.subtreePrunable=e,this.invalidate(!0,!0))}changePickableCount(e){if(e===0)return;const t=this.subtreePickableCount===0;this.subtreePickableCount+=e;const i=this.subtreePickableCount===0;if(this.checkSubtreePrunable(),assert&&assert(this.subtreePickableCount>=0,"subtree pickable count should be guaranteed to be >= 0"),!this.selfPruned&&t!==i){const s=this.node._parents.length;for(let n=0;n<s;n++)this.node._parents[n]._picker.changePickableCount(t?1:-1)}}audit(){if(assertSlow){this.node._children.forEach(o=>{o._picker.audit()});const e=assertSlow,t=this.node.pickable===!1||!this.node.isVisible(),i=this.node.pickable===!0||this.node._inputListeners.length>0,s=this.node.pickable===!1||!this.node.isVisible()||this.node.pickable!==!0&&this.subtreePickableCount===0,n=this.node._inputListeners.length+(this.node.pickableProperty.value===!0?1:0)+_.filter(this.node._children,o=>!o._picker.selfPruned&&o._picker.subtreePickableCount>0).length;assertSlow(this.selfPruned===t,"selfPruned mismatch"),assertSlow(this.selfInclusive===i,"selfInclusive mismatch"),assertSlow(this.subtreePrunable===s,"subtreePrunable mismatch"),assertSlow(this.subtreePickableCount===n,"subtreePickableCount mismatch"),this.node._parents.forEach(o=>{const c=o._picker,p=this;c.mouseInclusiveDirty||e(p.selfPruned||!p.mouseInclusiveDirty),c.mouseExclusiveDirty||(p.selfInclusive?e(p.selfPruned||!p.mouseInclusiveDirty):e(p.selfPruned||p.subtreePrunable||!p.mouseExclusiveDirty)),c.touchInclusiveDirty||e(p.selfPruned||!p.touchInclusiveDirty),c.touchExclusiveDirty||(p.selfInclusive?e(p.selfPruned||!p.touchInclusiveDirty):e(p.selfPruned||p.subtreePrunable||!p.touchExclusiveDirty))})}}}te.register("Picker",Pm);const sr=[de.bitmaskCanvas,de.bitmaskSVG,de.bitmaskDOM,de.bitmaskWebGL,de.bitmaskSingleCanvas,de.bitmaskSingleSVG,de.bitmaskNotPainted,de.bitmaskBoundsValid,de.bitmaskNoPDOM,de.bitmaskLacksCanvas,de.bitmaskLacksSVG,de.bitmaskLacksDOM,de.bitmaskLacksWebGL],Sm={};sr.forEach((h,e)=>{Sm[h]=e});const Lr=sr.length;let pd=0;for(let h=0;h<Lr;h++)pd|=sr[h];class nr{constructor(e){assert&&assert(e instanceof tt),assert&&assert(e._rendererBitmask===de.bitmaskNodeDefault,"Node must have a default bitmask when creating a RendererSummary"),assert&&assert(e._children.length===0,"Node cannot have children when creating a RendererSummary"),this.node=e,this._counts=new Int16Array(Lr),this.bitmask=pd,this.selfBitmask=nr.summaryBitmaskForNodeSelf(e),this.summaryChange(this.bitmask,this.selfBitmask);const t=this.selfChange.bind(this);this.node.filterChangeEmitter.addListener(t),this.node.clipAreaProperty.lazyLink(t),this.node.rendererSummaryRefreshEmitter.addListener(t)}summaryChange(e,t){assert&&this.audit();const i=e^t;let s=0,n=0;for(let o=0;o<Lr;o++){const c=sr[o],p=Sm[c];c&i&&(c&t?(this._counts[p]--,this._counts[p]===0&&(n|=c)):(this._counts[p]++,this._counts[p]===1&&(s|=c)))}if(s||n){const o=this.bitmask;assert&&assert(o!==void 0);for(let p=0;p<Lr;p++){const f=sr[p];n&f&&(this.bitmask|=f),s&f&&(this.bitmask^=f,assert&&assert(!(this.bitmask&f),"Should be cleared, doing cheaper XOR assuming it already was set"))}this.node.instanceRefreshEmitter.emit(),this.node.onSummaryChange(o,this.bitmask);const c=this.node._parents.length;for(let p=0;p<c;p++)this.node._parents[p]._rendererSummary.summaryChange(s,n);assert&&assert(this.bitmask===this.computeBitmask(),"Sanity check")}assert&&this.audit()}selfChange(){const e=this.selfBitmask,t=nr.summaryBitmaskForNodeSelf(this.node);e!==t&&(this.summaryChange(e,t),this.selfBitmask=t)}computeBitmask(){let e=0;for(let t=0;t<Lr;t++)this._counts[t]===0&&(e|=sr[t]);return e}isSubtreeFullyCompatible(e){return!!(e&this.bitmask)}isSubtreeContainingCompatible(e){return!(e<<de.bitmaskLacksShift&this.bitmask)}isSingleCanvasSupported(){return!!(de.bitmaskSingleCanvas&this.bitmask)}isSingleSVGSupported(){return!!(de.bitmaskSingleSVG&this.bitmask)}isNotPainted(){return!!(de.bitmaskNotPainted&this.bitmask)}hasNoPDOM(){return!!(de.bitmaskNoPDOM&this.bitmask)}areBoundsValid(){return!!(de.bitmaskBoundsValid&this.bitmask)}isSubtreeRenderedExclusivelySVG(e){if(!this.isSingleSVGSupported())return!1;for(let t=0;t<de.numActiveRenderers;t++){const i=de.bitmaskOrder(e,t);if(de.bitmaskSVG&i)return!0;if(this.isSubtreeContainingCompatible(i))return!1}return!1}isSubtreeRenderedExclusivelyCanvas(e){if(!this.isSingleCanvasSupported())return!1;for(let t=0;t<de.numActiveRenderers;t++){const i=de.bitmaskOrder(e,t);if(de.bitmaskCanvas&i)return!0;if(this.isSubtreeContainingCompatible(i))return!1}return!1}audit(){if(assert)for(let e=0;e<Lr;e++){const t=sr[e],i=this._counts[e]===0,s=!!(this.bitmask&t);assert(i===s,"Bits should be set if count is zero")}}toString(){let e=nr.bitmaskToString(this.bitmask);for(let t=0;t<Lr;t++){const i=sr[t],s=this._counts[t];s!==0&&(e+=` ${nr.bitToString(i)}:${s}`)}return e}static summaryBitmaskForNodeSelf(e){let t=e._rendererBitmask;e.isPainted()?t|=(e._rendererBitmask&de.bitmaskCurrentRendererArea^de.bitmaskCurrentRendererArea)<<de.bitmaskLacksShift:t|=de.bitmaskCurrentRendererArea<<de.bitmaskLacksShift;const i=e._cssTransform||e._layerSplit,s=e._renderer;return!i&&de.isSVG(e._rendererBitmask)&&(!s||de.isSVG(s))&&(t|=de.bitmaskSingleSVG),!i&&de.isCanvas(e._rendererBitmask)&&(!s||de.isCanvas(s))&&(t|=de.bitmaskSingleCanvas),e.isPainted()||(t|=de.bitmaskNotPainted),e.areSelfBoundsValid()&&(t|=de.bitmaskBoundsValid),!e.hasPDOMContent&&!e.hasPDOMOrder()&&(t|=de.bitmaskNoPDOM),t}static bitToString(e){return e===de.bitmaskCanvas?"Canvas":e===de.bitmaskSVG?"SVG":e===de.bitmaskDOM?"DOM":e===de.bitmaskWebGL?"WebGL":e===de.bitmaskLacksCanvas?"(-Canvas)":e===de.bitmaskLacksSVG?"(-SVG)":e===de.bitmaskLacksDOM?"(-DOM)":e===de.bitmaskLacksWebGL?"(-WebGL)":e===de.bitmaskSingleCanvas?"SingleCanvas":e===de.bitmaskSingleSVG?"SingleSVG":e===de.bitmaskNotPainted?"NotPainted":e===de.bitmaskBoundsValid?"BoundsValid":e===de.bitmaskNoPDOM?"NotAccessible":"?"}static bitmaskToString(e){let t="";for(let i=0;i<Lr;i++){const s=sr[i];e&s&&(t+=`${nr.bitToString(s)} `)}return t}}nr.bitmaskAll=pd;te.register("RendererSummary",nr);const Fc=nr;class wm{constructor(e){this.node=e,this.pdomDisplays=[]}onAddChild(e){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`onAddChild n#${e.id} (parent:n#${this.node.id})`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),e._pdomDisplaysInfo.canHavePDOMDisplays()&&e._pdomDisplaysInfo.addPDOMDisplays(this.pdomDisplays),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}onRemoveChild(e){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`onRemoveChild n#${e.id} (parent:n#${this.node.id})`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),e._pdomDisplaysInfo.canHavePDOMDisplays()&&e._pdomDisplaysInfo.removePDOMDisplays(this.pdomDisplays),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}onSummaryChange(e,t){if(sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`onSummaryChange n#${this.node.id} wasPDOM:${!(de.bitmaskNoPDOM&e)}, isPDOM:${!(de.bitmaskNoPDOM&t)}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),this.node.visible&&this.node.pdomVisible){const i=!(de.bitmaskNoPDOM&e),s=!(de.bitmaskNoPDOM&t);s&&!i&&this.addAllPDOMDisplays(),!s&&i&&this.removeAllPDOMDisplays()}sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}onVisibilityChange(e){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`onVisibilityChange n#${this.node.id} visible:${e}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),this.node.pdomVisible&&!this.node._rendererSummary.hasNoPDOM()&&(e?this.addAllPDOMDisplays():this.removeAllPDOMDisplays()),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}onPDOMVisibilityChange(e){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`onPDOMVisibilityChange n#${this.node.id} pdomVisible:${e}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),this.node.visible&&!this.node._rendererSummary.hasNoPDOM()&&(e?this.addAllPDOMDisplays():this.removeAllPDOMDisplays()),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}onAddedRootedDisplay(e){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`onAddedRootedDisplay n#${this.node.id}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),e._accessible&&this.canHavePDOMDisplays()&&this.addPDOMDisplays([e]),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}onRemovedRootedDisplay(e){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`onRemovedRootedDisplay n#${this.node.id}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),e._accessible&&this.canHavePDOMDisplays()&&this.removePDOMDisplays([e]),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}canHavePDOMDisplays(){return this.node.visible&&this.node.pdomVisible&&!this.node._rendererSummary.hasNoPDOM()}addAllPDOMDisplays(){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`addAllPDOMDisplays n#${this.node.id}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),assert&&assert(this.pdomDisplays.length===0,"Should be empty before adding everything"),assert&&assert(this.canHavePDOMDisplays(),"Should happen when we can store pdomDisplays");let e;const t=[];for(e=0;e<this.node._parents.length;e++)Array.prototype.push.apply(t,this.node._parents[e]._pdomDisplaysInfo.pdomDisplays);for(e=0;e<this.node._rootedDisplays.length;e++){const i=this.node._rootedDisplays[e];i._accessible&&t.push(i)}this.addPDOMDisplays(t),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}removeAllPDOMDisplays(){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`removeAllPDOMDisplays n#${this.node.id}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),assert&&assert(!this.canHavePDOMDisplays(),"Should happen when we cannot store pdomDisplays"),this.removePDOMDisplays(this.pdomDisplays.slice()),assert&&assert(this.pdomDisplays.length===0,"Should be empty after removing everything"),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}addPDOMDisplays(e){if(sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`addPDOMDisplays n#${this.node.id} numDisplays:${e.length}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),assert&&assert(Array.isArray(e)),e.length!==0){Array.prototype.push.apply(this.pdomDisplays,e);for(let t=0;t<this.node._children.length;t++)this.node._children[t]._pdomDisplaysInfo.canHavePDOMDisplays()&&this.node._children[t]._pdomDisplaysInfo.addPDOMDisplays(e);this.node.pdomDisplaysEmitter.emit()}sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}removePDOMDisplays(e){if(sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`removePDOMDisplays n#${this.node.id} numDisplays:${e.length}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),assert&&assert(Array.isArray(e)),assert&&assert(this.pdomDisplays.length>=e.length,"there should be at least as many PDOMDisplays as Displays"),e.length!==0){let t;for(t=e.length-1;t>=0;t--){const i=this.pdomDisplays.lastIndexOf(e[t]);assert&&assert(i>=0),this.pdomDisplays.splice(t,1)}for(t=0;t<this.node._children.length;t++){const i=this.node._children[t];i._pdomDisplaysInfo.canHavePDOMDisplays()&&!i._isGettingRemovedFromParent&&i._pdomDisplaysInfo.removePDOMDisplays(e)}this.node.pdomDisplaysEmitter.emit()}sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}}te.register("PDOMDisplaysInfo",wm);const Xl=1e-9,Au=["preferredWidth","minimumWidth","localPreferredWidth","localMinimumWidth","widthSizable"],zh=ns(h=>{const e=oo("WidthSizable",Au,class extends h{constructor(...i){super(...i),this.preferredWidthProperty=new Nt(null),this.minimumWidthProperty=new Nt(null),this.localPreferredWidthProperty=new Nt(null),this.localMinimumWidthProperty=new Nt(null),this.isWidthResizableProperty=new Nt(!0),this._preferredSizeChanging=!1,this._minimumSizeChanging=!1,this._preferredSizeChangeAttemptDuringLock=!1,this._minimumSizeChangeAttemptDuringLock=!1,this._updatePreferredWidthListener=this._updatePreferredWidth.bind(this),this._updateLocalPreferredWidthListener=this._updateLocalPreferredWidth.bind(this),this._updateMinimumWidthListener=this._updateMinimumWidth.bind(this),this._updateLocalMinimumWidthListener=this._updateLocalMinimumWidth.bind(this),this.preferredWidthProperty.lazyLink(this._updateLocalPreferredWidthListener),this.localPreferredWidthProperty.lazyLink(this._updatePreferredWidthListener),this.minimumWidthProperty.lazyLink(this._updateLocalMinimumWidthListener),this.localMinimumWidthProperty.lazyLink(this._updateMinimumWidthListener),this.transformEmitter.addListener(this._updateLocalPreferredWidthListener),this.transformEmitter.addListener(this._updateMinimumWidthListener)}get preferredWidth(){return assert&&assert(this.preferredWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),this.preferredWidthProperty.value}set preferredWidth(i){assert&&assert(this.preferredWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(i===null||typeof i=="number"&&isFinite(i)&&i>=0,"preferredWidth should be null or a non-negative finite number"),this.preferredWidthProperty.value=i}get localPreferredWidth(){return assert&&assert(this.localPreferredWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),this.localPreferredWidthProperty.value}set localPreferredWidth(i){assert&&assert(this.localPreferredWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(i===null||typeof i=="number"&&isFinite(i)&&i>=0,"localPreferredWidth should be null or a non-negative finite number"),this.localPreferredWidthProperty.value=i}get minimumWidth(){return assert&&assert(this.minimumWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),this.minimumWidthProperty.value}set minimumWidth(i){assert&&assert(this.minimumWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(i===null||typeof i=="number"&&isFinite(i)),this.minimumWidthProperty.value=i}get localMinimumWidth(){return assert&&assert(this.localMinimumWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),this.localMinimumWidthProperty.value}set localMinimumWidth(i){assert&&assert(this.localMinimumWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(i===null||typeof i=="number"&&isFinite(i)),this.localMinimumWidthProperty.value=i}get widthSizable(){return assert&&assert(this.isWidthResizableProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),this.isWidthResizableProperty.value}set widthSizable(i){assert&&assert(this.isWidthResizableProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),this.isWidthResizableProperty.value=i}get extendsWidthSizable(){return!0}validateLocalPreferredWidth(){if(assert){const i=this.localWidth,s=this.localMinimumWidth===null?i:this.localMinimumWidth,n=this.localPreferredWidth===null?s:this.localPreferredWidth;assert(n===i||Math.abs(n-i)<1e-7)}}_calculateLocalPreferredWidth(){return this.matrix.isAligned()&&this.preferredWidth!==null?Math.abs(this.transform.inverseDeltaX(this.preferredWidth)):null}_onReentrantPreferredWidth(){this._updateLocalPreferredWidthListener()}_updateLocalPreferredWidth(){if(assert&&this.auditMaxDimensions(),this._preferredSizeChanging)this._preferredSizeChangeAttemptDuringLock=!0;else{this._preferredSizeChanging=!0;do{this._preferredSizeChangeAttemptDuringLock=!1;const i=this._calculateLocalPreferredWidth();(this.localPreferredWidthProperty.value===null||i===null||Math.abs(this.localPreferredWidthProperty.value-i)>Xl)&&(this.localPreferredWidthProperty.value=i)}while(this._preferredSizeChangeAttemptDuringLock);this._preferredSizeChanging=!1}}_calculatePreferredWidth(){return this.matrix.isAligned()&&this.localPreferredWidth!==null?Math.abs(this.transform.transformDeltaX(this.localPreferredWidth)):null}_updatePreferredWidth(){if(this._preferredSizeChanging)this._preferredSizeChangeAttemptDuringLock=!0;else{this._preferredSizeChanging=!0,this._preferredSizeChangeAttemptDuringLock=!1;const i=this._calculatePreferredWidth();(this.preferredWidthProperty.value===null||i===null||Math.abs(this.preferredWidthProperty.value-i)>Xl)&&(this.preferredWidthProperty.value=i),this._preferredSizeChanging=!1,this._preferredSizeChangeAttemptDuringLock&&this._onReentrantPreferredWidth()}}_calculateLocalMinimumWidth(){return this.matrix.isAligned()&&this.minimumWidth!==null?Math.abs(this.transform.inverseDeltaX(this.minimumWidth)):null}_onReentrantLocalMinimumWidth(){this._updateMinimumWidthListener()}_updateLocalMinimumWidth(){if(this._minimumSizeChanging)this._minimumSizeChangeAttemptDuringLock=!0;else{this._minimumSizeChanging=!0;const i=this._calculateLocalMinimumWidth();this._minimumSizeChangeAttemptDuringLock=!1,(this.localMinimumWidthProperty.value===null||i===null||Math.abs(this.localMinimumWidthProperty.value-i)>Xl)&&(this.localMinimumWidthProperty.value=i),this._minimumSizeChanging=!1,this._minimumSizeChangeAttemptDuringLock&&this._onReentrantLocalMinimumWidth()}}_calculateMinimumWidth(){return this.matrix.isAligned()&&this.localMinimumWidth!==null?Math.abs(this.transform.transformDeltaX(this.localMinimumWidth)):null}_updateMinimumWidth(){if(this._minimumSizeChanging)this._minimumSizeChangeAttemptDuringLock=!0;else{this._minimumSizeChanging=!0;do{this._minimumSizeChangeAttemptDuringLock=!1;const i=this._calculateMinimumWidth();(this.minimumWidthProperty.value===null||i===null||Math.abs(this.minimumWidthProperty.value-i)>Xl)&&(this.minimumWidthProperty.value=i)}while(this._minimumSizeChangeAttemptDuringLock);this._minimumSizeChanging=!1}}mutate(i){return super.mutate(i)}});if(e.prototype._mutatorKeys){const t=e.prototype._mutatorKeys,i=Au,s=t.indexOf(lr[0]);e.prototype._mutatorKeys=[...t.slice(0,s),...i,...t.slice(s)]}return e}),Wa=h=>h.widthSizable,cp=h=>h.extendsWidthSizable;te.register("WidthSizable",zh);const jl=1e-9,Eu=["preferredHeight","minimumHeight","localPreferredHeight","localMinimumHeight","heightSizable"],fd=ns(h=>{const e=oo("HeightSizable",Eu,class extends h{constructor(...i){super(...i),this.preferredHeightProperty=new Nt(null),this.minimumHeightProperty=new Nt(null),this.localPreferredHeightProperty=new Nt(null),this.localMinimumHeightProperty=new Nt(null),this.isHeightResizableProperty=new Nt(!0),this._preferredSizeChanging=!1,this._minimumSizeChanging=!1,this._preferredSizeChangeAttemptDuringLock=!1,this._minimumSizeChangeAttemptDuringLock=!1,this._updatePreferredHeightListener=this._updatePreferredHeight.bind(this),this._updateLocalPreferredHeightListener=this._updateLocalPreferredHeight.bind(this),this._updateMinimumHeightListener=this._updateMinimumHeight.bind(this),this._updateLocalMinimumHeightListener=this._updateLocalMinimumHeight.bind(this),this.preferredHeightProperty.lazyLink(this._updateLocalPreferredHeightListener),this.localPreferredHeightProperty.lazyLink(this._updatePreferredHeightListener),this.minimumHeightProperty.lazyLink(this._updateLocalMinimumHeightListener),this.localMinimumHeightProperty.lazyLink(this._updateMinimumHeightListener),this.transformEmitter.addListener(this._updateLocalPreferredHeightListener),this.transformEmitter.addListener(this._updateMinimumHeightListener)}get preferredHeight(){return assert&&assert(this.preferredHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),this.preferredHeightProperty.value}set preferredHeight(i){assert&&assert(this.preferredHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(i===null||typeof i=="number"&&isFinite(i)&&i>=0,"preferredHeight should be null or a non-negative finite number"),this.preferredHeightProperty.value=i}get localPreferredHeight(){return assert&&assert(this.localPreferredHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),this.localPreferredHeightProperty.value}set localPreferredHeight(i){assert&&assert(this.localPreferredHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(i===null||typeof i=="number"&&isFinite(i)&&i>=0,"localPreferredHeight should be null or a non-negative finite number"),this.localPreferredHeightProperty.value=i}get minimumHeight(){return assert&&assert(this.minimumHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),this.minimumHeightProperty.value}set minimumHeight(i){assert&&assert(this.minimumHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(i===null||typeof i=="number"&&isFinite(i)),this.minimumHeightProperty.value=i}get localMinimumHeight(){return assert&&assert(this.localMinimumHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),this.localMinimumHeightProperty.value}set localMinimumHeight(i){assert&&assert(this.localMinimumHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(i===null||typeof i=="number"&&isFinite(i)),this.localMinimumHeightProperty.value=i}get heightSizable(){return assert&&assert(this.isHeightResizableProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),this.isHeightResizableProperty.value}set heightSizable(i){assert&&assert(this.isHeightResizableProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),this.isHeightResizableProperty.value=i}get extendsHeightSizable(){return!0}validateLocalPreferredHeight(){if(assert){const i=this.localHeight,s=this.localMinimumHeight===null?i:this.localMinimumHeight,n=this.localPreferredHeight===null?s:this.localPreferredHeight;assert(n===i||Math.abs(n-i)<1e-7)}}_calculateLocalPreferredHeight(){return this.matrix.isAligned()&&this.preferredHeight!==null?Math.abs(this.transform.inverseDeltaY(this.preferredHeight)):null}_onReentrantPreferredHeight(){this._updateLocalPreferredHeightListener()}_updateLocalPreferredHeight(){if(assert&&this.auditMaxDimensions(),this._preferredSizeChanging)this._preferredSizeChangeAttemptDuringLock=!0;else{this._preferredSizeChanging=!0;do{this._preferredSizeChangeAttemptDuringLock=!1;const i=this._calculateLocalPreferredHeight();(this.localPreferredHeightProperty.value===null||i===null||Math.abs(this.localPreferredHeightProperty.value-i)>jl)&&(this.localPreferredHeightProperty.value=i)}while(this._preferredSizeChangeAttemptDuringLock);this._preferredSizeChanging=!1}}_calculatePreferredHeight(){return this.matrix.isAligned()&&this.localPreferredHeight!==null?Math.abs(this.transform.transformDeltaY(this.localPreferredHeight)):null}_updatePreferredHeight(){if(this._preferredSizeChanging)this._preferredSizeChangeAttemptDuringLock=!0;else{this._preferredSizeChanging=!0,this._preferredSizeChangeAttemptDuringLock=!1;const i=this._calculatePreferredHeight();(this.preferredHeightProperty.value===null||i===null||Math.abs(this.preferredHeightProperty.value-i)>jl)&&(this.preferredHeightProperty.value=i),this._preferredSizeChanging=!1,this._preferredSizeChangeAttemptDuringLock&&this._onReentrantPreferredHeight()}}_calculateLocalMinimumHeight(){return this.matrix.isAligned()&&this.minimumHeight!==null?Math.abs(this.transform.inverseDeltaY(this.minimumHeight)):null}_onReentrantLocalMinimumHeight(){this._updateMinimumHeight()}_updateLocalMinimumHeight(){if(this._minimumSizeChanging)this._minimumSizeChangeAttemptDuringLock=!0;else{this._minimumSizeChanging=!0,this._minimumSizeChangeAttemptDuringLock=!1;const i=this._calculateLocalMinimumHeight();(this.localMinimumHeightProperty.value===null||i===null||Math.abs(this.localMinimumHeightProperty.value-i)>jl)&&(this.localMinimumHeightProperty.value=i),this._minimumSizeChanging=!1,this._minimumSizeChangeAttemptDuringLock&&this._onReentrantLocalMinimumHeight()}}_calculateMinimumHeight(){return this.matrix.isAligned()&&this.localMinimumHeight!==null?Math.abs(this.transform.transformDeltaY(this.localMinimumHeight)):null}_updateMinimumHeight(){if(!this._minimumSizeChanging){this._minimumSizeChanging=!0;do{this._minimumSizeChangeAttemptDuringLock=!1;const i=this._calculateMinimumHeight();(this.minimumHeightProperty.value===null||i===null||Math.abs(this.minimumHeightProperty.value-i)>jl)&&(this.minimumHeightProperty.value=i)}while(this._minimumSizeChangeAttemptDuringLock);this._minimumSizeChanging=!1}}mutate(i){return super.mutate(i)}});if(e.prototype._mutatorKeys){const t=e.prototype._mutatorKeys,i=Eu,s=t.indexOf(lr[0]);e.prototype._mutatorKeys=[...t.slice(0,s),...i,...t.slice(s)]}return e}),Ua=h=>h.heightSizable,up=h=>h.extendsHeightSizable;te.register("HeightSizable",fd);const dp=["preferredSize","minimumSize","localPreferredSize","localMinimumSize","sizable"],Cm=["preferredSize","minimumSize","localPreferredSize","localMinimumSize","sizable",...Au,...Eu],$h=ns(h=>{const e=oo("Sizable",dp,class extends zh(fd(h)){constructor(...i){super(...i),this.preferredWidthProperty.lazyLink(this._updateLocalPreferredHeightListener),this.preferredHeightProperty.lazyLink(this._updateLocalPreferredWidthListener),this.localPreferredWidthProperty.lazyLink(this._updatePreferredHeightListener),this.localPreferredHeightProperty.lazyLink(this._updatePreferredWidthListener),this.minimumWidthProperty.lazyLink(this._updateLocalMinimumHeightListener),this.minimumHeightProperty.lazyLink(this._updateLocalMinimumWidthListener),this.localMinimumWidthProperty.lazyLink(this._updateMinimumHeightListener),this.localMinimumHeightProperty.lazyLink(this._updateMinimumWidthListener)}get preferredSize(){return assert&&assert(this.preferredWidth===null==(this.preferredHeight===null),"Cannot get a preferredSize when one of preferredWidth/preferredHeight is null"),this.preferredWidth===null||this.preferredHeight===null?null:new In(this.preferredWidth,this.preferredHeight)}set preferredSize(i){this.preferredWidth=i===null?null:i.width,this.preferredHeight=i===null?null:i.height}get localPreferredSize(){return assert&&assert(this.localPreferredWidth===null==(this.localPreferredHeight===null),"Cannot get a preferredSize when one of preferredWidth/preferredHeight is null"),this.localPreferredWidth===null||this.localPreferredHeight===null?null:new In(this.localPreferredWidth,this.localPreferredHeight)}set localPreferredSize(i){this.localPreferredWidth=i===null?null:i.width,this.localPreferredHeight=i===null?null:i.height}get minimumSize(){return assert&&assert(this.minimumWidth===null==(this.minimumHeight===null),"Cannot get a minimumSize when one of minimumWidth/minimumHeight is null"),this.minimumWidth===null||this.minimumHeight===null?null:new In(this.minimumWidth,this.minimumHeight)}set minimumSize(i){this.minimumWidth=i===null?null:i.width,this.minimumHeight=i===null?null:i.height}get localMinimumSize(){return assert&&assert(this.localMinimumWidth===null==(this.localMinimumHeight===null),"Cannot get a minimumSize when one of minimumWidth/minimumHeight is null"),this.localMinimumWidth===null||this.localMinimumHeight===null?null:new In(this.localMinimumWidth,this.localMinimumHeight)}set localMinimumSize(i){this.localMinimumWidth=i===null?null:i.width,this.localMinimumHeight=i===null?null:i.height}get sizable(){return assert&&assert(this.widthSizable===this.heightSizable,"widthSizable and heightSizable not the same, which is required for the sizable getter"),this.widthSizable}set sizable(i){this.widthSizable=i,this.heightSizable=i}get extendsSizable(){return!0}validateLocalPreferredSize(){assert&&(this.validateLocalPreferredWidth(),this.validateLocalPreferredHeight())}mutate(i){return us(i,["preferredSize"],["preferredWidth","preferredHeight"]),us(i,["localPreferredSize"],["localPreferredWidth","localPreferredHeight"]),us(i,["minimumSize"],["minimumWidth","minimumHeight"]),us(i,["localMinimumSize"],["localMinimumWidth","localMinimumHeight"]),us(i,["sizable"],["widthSizable","heightSizable"]),super.mutate(i)}_calculateLocalPreferredWidth(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.preferredWidth!==null)return Math.abs(this.transform.inverseDeltaX(this.preferredWidth))}else if(this.preferredHeight!==null)return Math.abs(this.transform.getInverse().m01()*this.preferredHeight)}return null}_calculateLocalPreferredHeight(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.preferredHeight!==null)return Math.abs(this.transform.inverseDeltaY(this.preferredHeight))}else if(this.preferredWidth!==null)return Math.abs(this.transform.getInverse().m10()*this.preferredWidth)}return null}_calculatePreferredWidth(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.localPreferredWidth!==null)return Math.abs(this.transform.transformDeltaX(this.localPreferredWidth))}else if(this.localPreferredHeight!==null)return Math.abs(this.transform.matrix.m01()*this.localPreferredHeight)}return null}_calculatePreferredHeight(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.localPreferredHeight!==null)return Math.abs(this.transform.transformDeltaY(this.localPreferredHeight))}else if(this.localPreferredWidth!==null)return Math.abs(this.transform.matrix.m10()*this.localPreferredWidth)}return null}_onReentrantLocalMinimumWidth(){this._updateMinimumWidthListener(),this._updateMinimumHeightListener()}_onReentrantLocalMinimumHeight(){this._updateMinimumWidthListener(),this._updateMinimumHeightListener()}_onReentrantPreferredWidth(){this._updateLocalPreferredWidthListener(),this._updateLocalPreferredHeightListener()}_onReentrantPreferredHeight(){this._updateLocalPreferredWidthListener(),this._updateLocalPreferredHeightListener()}_calculateLocalMinimumWidth(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.minimumWidth!==null)return Math.abs(this.transform.inverseDeltaX(this.minimumWidth))}else if(this.minimumHeight!==null)return Math.abs(this.transform.getInverse().m01()*this.minimumHeight)}return null}_calculateLocalMinimumHeight(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.minimumHeight!==null)return Math.abs(this.transform.inverseDeltaY(this.minimumHeight))}else if(this.minimumWidth!==null)return Math.abs(this.transform.getInverse().m10()*this.minimumWidth)}return null}_calculateMinimumWidth(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.localMinimumWidth!==null)return Math.abs(this.transform.transformDeltaX(this.localMinimumWidth))}else if(this.localMinimumHeight!==null)return Math.abs(this.transform.matrix.m01()*this.localMinimumHeight)}return null}_calculateMinimumHeight(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.localMinimumHeight!==null)return Math.abs(this.transform.transformDeltaY(this.localMinimumHeight))}else if(this.localMinimumWidth!==null)return Math.abs(this.transform.matrix.m10()*this.localMinimumWidth)}return null}});if(e.prototype._mutatorKeys){const t=e.prototype._mutatorKeys,i=dp,s=t.indexOf(lr[0]);e.prototype._mutatorKeys=[...t.slice(0,s),...i,...t.slice(s)]}return e});te.register("Sizable",$h);const Ql=Dt.PDOM_UNIQUE_ID_SEPARATOR;class wt{constructor(e){if(assert&&(this.immutable=void 0),e instanceof wt){const t=e;this.nodes=t.nodes.slice(0),this.length=t.length,this.uniqueId=t.uniqueId,this.indices=t.indices.slice(0);return}if(this.nodes=[],this.length=0,this.uniqueId="",this.indices=[],e)if(e instanceof tt){const t=e;this.addDescendant(t)}else{const t=e.length;for(let i=0;i<t;i++)this.addDescendant(e[i])}}copy(){return new wt(this)}isPainted(){return this.lastNode().isPainted()}isValid(){this.reindex();const e=this.indices.length;for(let t=0;t<e;t++)if(this.indices[t]<0)return!1;return!0}isVisible(){let e=this.nodes.length;for(;e--;)if(!this.nodes[e].isVisible())return!1;return!0}isPDOMVisible(){let e=this.nodes.length;for(;e--;)if(!this.nodes[e].isVisible()||!this.nodes[e].isPDOMVisible())return!1;return!0}getOpacity(){let e=1,t=this.nodes.length;for(;t--;)e*=this.nodes[t].getOpacity();return e}isPickable(){return _.some(this.nodes,e=>e.pickable===!1||!e.visible)?!1:!!_.some(this.nodes,e=>e._inputListeners.length>0||e.pickableProperty.value===!0)}get(e){return e>=0?this.nodes[e]:this.nodes[this.nodes.length+e]}slice(e,t){return new wt(this.nodes.slice(e,t))}subtrailTo(e,t=!1){return this.slice(0,_.indexOf(this.nodes,e)+(t?0:1))}isEmpty(){return this.nodes.length===0}getMatrixConcatenation(e,t){const i=Ze.identity(),s=this.nodes;for(let n=e;n<t;n++)i.multiplyMatrix(s[n].getMatrix());return i}getMatrix(){return this.getMatrixConcatenation(0,this.nodes.length)}getAncestorMatrix(){return this.getMatrixConcatenation(1,this.nodes.length)}getParentMatrix(){return this.getMatrixConcatenation(0,this.nodes.length-1)}getAncestorParentMatrix(){return this.getMatrixConcatenation(1,this.nodes.length-1)}getTransform(){return new Ks(this.getMatrix())}getParentTransform(){return new Ks(this.getParentMatrix())}addAncestor(e,t){if(assert&&assert(!this.immutable,"cannot modify an immutable Trail with addAncestor"),assert&&assert(e,"cannot add falsy value to a Trail"),this.nodes.length){const i=this.nodes[0];this.indices.unshift(t===void 0?_.indexOf(e._children,i):t)}return this.nodes.unshift(e),this.length++,this.uniqueId=this.uniqueId?e.id+Ql+this.uniqueId:`${e.id}`,this}removeAncestor(){return assert&&assert(!this.immutable,"cannot modify an immutable Trail with removeAncestor"),assert&&assert(this.length>0,"cannot remove a Node from an empty trail"),this.nodes.shift(),this.indices.length&&this.indices.shift(),this.length--,this.updateUniqueId(),this}addDescendant(e,t){if(assert&&assert(!this.immutable,"cannot modify an immutable Trail with addDescendant"),assert&&assert(e,"cannot add falsy value to a Trail"),this.nodes.length){const i=this.lastNode();this.indices.push(t===void 0?_.indexOf(i._children,e):t)}return this.nodes.push(e),this.length++,this.uniqueId=this.uniqueId?this.uniqueId+Ql+e.id:`${e.id}`,this}removeDescendant(){return assert&&assert(!this.immutable,"cannot modify an immutable Trail with removeDescendant"),assert&&assert(this.length>0,"cannot remove a Node from an empty trail"),this.nodes.pop(),this.indices.length&&this.indices.pop(),this.length--,this.updateUniqueId(),this}addDescendantTrail(e){const t=e.length;t&&this.addDescendant(e.nodes[0]);for(let i=1;i<t;i++)this.addDescendant(e.nodes[i],this.indices[i-1])}removeDescendantTrail(e){const t=e.length;for(let i=t-1;i>=0;i--)assert&&assert(this.lastNode()===e.nodes[i]),this.removeDescendant()}reindex(){const e=this.length;for(let t=1;t<e;t++){const i=this.indices[t-1],s=this.nodes[t-1];s._children[i]!==this.nodes[t]&&(this.indices[t-1]=_.indexOf(s._children,this.nodes[t]))}}setImmutable(){return assert&&(assert(this.immutable!==!1,"A trail cannot be made immutable after being flagged as mutable"),this.immutable=!0),this}setMutable(){return assert&&(assert(this.immutable!==!0,"A trail cannot be made mutable after being flagged as immutable"),this.immutable=!1),this}areIndicesValid(){for(let e=1;e<this.length;e++){const t=this.indices[e-1];if(this.nodes[e-1]._children[t]!==this.nodes[e])return!1}return!0}equals(e){if(this.length!==e.length)return!1;for(let t=0;t<this.nodes.length;t++)if(this.nodes[t]!==e.nodes[t])return!1;return!0}upToNode(e){const t=_.indexOf(this.nodes,e);return assert&&assert(t>=0,"Trail does not contain the node"),this.slice(0,_.indexOf(this.nodes,e)+1)}isExtensionOf(e,t){if(this.length<=e.length-(t?1:0))return!1;for(let i=0;i<e.nodes.length;i++)if(this.nodes[i]!==e.nodes[i])return!1;return!0}containsNode(e){return _.includes(this.nodes,e)}getTransformTo(e){return new Ks(this.getMatrixTo(e))}getMatrixTo(e){this.reindex(),e.reindex();const t=this.getBranchIndexTo(e);let i,s=Ze.IDENTITY;for(i=this.length-1;i>=t;i--)s=this.nodes[i].getMatrix().timesMatrix(s);for(i=t;i<e.length;i++)s=e.nodes[i].getTransform().getInverse().timesMatrix(s);return s}getBranchIndexTo(e){assert&&assert(this.nodes[0]===e.nodes[0],"To get a branch index, the trails must have the same root");let t;const i=Math.min(this.length,e.length);for(t=0;t<i&&this.nodes[t]===e.nodes[t];t++);return t}getLastInputEnabledIndex(){let e=-1;for(let t=0;t<this.length&&this.nodes[t].inputEnabled;t++)e=t;return e}getCursorCheckIndex(){return this.getLastInputEnabledIndex()}nodeFromTop(e){return this.nodes[this.length-1-e]}lastNode(){return this.nodeFromTop(0)}rootNode(){return this.nodes[0]}previous(){if(this.nodes.length<=1)return null;const e=this.nodeFromTop(0),t=this.nodeFromTop(1),i=_.indexOf(t._children,e);assert&&assert(i!==-1);const s=this.nodes.slice(0,this.nodes.length-1);if(i===0)return new wt(s);for(s.push(t._children[i-1]);s[s.length-1]._children.length!==0;){const n=s[s.length-1];s.push(n._children[n._children.length-1])}return new wt(s)}previousPainted(){let e=this.previous();for(;e&&!e.isPainted();)e=e.previous();return e}next(){const e=this.nodes.slice(0),t=this.nodeFromTop(0);if(t._children.length>0)return e.push(t._children[0]),new wt(e);{let i=this.nodes.length-1;for(;i>0;){const s=this.nodes[i],n=this.nodes[i-1];e.pop();const o=_.indexOf(n._children,s);if(o!==n._children.length-1)return e.push(n._children[o+1]),new wt(e);i--}return null}}nextPainted(){let e=this.next();for(;e&&!e.isPainted();)e=e.next();return e}eachTrailUnder(e){new Hn(this,!0).eachTrailBetween(new Hn(this,!1),e)}compare(e){assert&&assert(!this.isEmpty(),"cannot compare with an empty trail"),assert&&assert(!e.isEmpty(),"cannot compare with an empty trail"),assert&&assert(this.nodes[0]===e.nodes[0],"for Trail comparison, trails must have the same root node"),assertSlow&&assertSlow(this.areIndicesValid(),`Trail.compare this.areIndicesValid() failed on ${this.toString()}`),assertSlow&&assertSlow(e.areIndicesValid(),`Trail.compare other.areIndicesValid() failed on ${e.toString()}`);const t=Math.min(this.nodes.length,e.nodes.length);for(let i=0;i<t;i++)if(this.nodes[i]!==e.nodes[i])return this.nodes[i-1].children.indexOf(this.nodes[i])<e.nodes[i-1].children.indexOf(e.nodes[i])?-1:1;return this.nodes.length<e.nodes.length?-1:this.nodes.length>e.nodes.length?1:0}isBefore(e){return this.compare(e)===-1}isAfter(e){return this.compare(e)===1}localToGlobalPoint(e){return this.getMatrix().timesVector2(e)}localToGlobalBounds(e){return e.transformed(this.getMatrix())}globalToLocalPoint(e){return this.getTransform().inversePosition2(e)}globalToLocalBounds(e){return this.getTransform().inverseBounds2(e)}parentToGlobalPoint(e){return this.getParentMatrix().timesVector2(e)}parentToGlobalBounds(e){return e.transformed(this.getParentMatrix())}globalToParentPoint(e){return this.getParentTransform().inversePosition2(e)}globalToParentBounds(e){return this.getParentTransform().inverseBounds2(e)}updateUniqueId(){let e="";const t=this.nodes.length;t>0&&(e+=this.nodes[0]._id);for(let i=1;i<t;i++)e+=Ql+this.nodes[i]._id;this.uniqueId=e}getUniqueId(){if(assert){const e=this.uniqueId;this.updateUniqueId(),assert(e===this.uniqueId)}return this.uniqueId}toString(){return this.reindex(),this.length?`[Trail ${this.indices.join(".")} ${this.getUniqueId()}]`:"Empty Trail"}toPathString(){return _.map(this.nodes,e=>{let t=e.constructor.name;return t==="Node"&&(t="."),t}).join("/")}toDebugString(){return`${this.toString()} ${this.toPathString()}`}static eachPaintedTrailBetween(e,t,i,s,n){wt.eachTrailBetween(e,t,o=>o.isPainted()?i(o):!1,s,n)}static eachTrailBetween(e,t,i,s,n){const o=e?new Hn(e.copy(),!0):new Hn(new wt(n),!0),c=t?new Hn(t.copy(),!0):new Hn(new wt(n),!1);s&&(o.nestedForwards(),c.nestedBackwards(),o.compareNested(c)===1)||o.depthFirstUntil(c,p=>p.isBefore?i(p.trail):!1,!1)}static branchIndex(e,t){assert&&assert(e.nodes[0]===t.nodes[0],"Branch changes require roots to be the same");let i;const s=Math.min(e.length,t.length);for(i=0;i<s&&e.nodes[i]===t.nodes[i];i++);return i}static sharedTrail(e,t){return e.slice(0,wt.branchIndex(e,t))}static appendAncestorTrailsWithPredicate(e,t,i){const s=t.rootNode();i(s)&&e.push(t.copy());const n=s._parents.length;for(let o=0;o<n;o++){const c=s._parents[o];t.addAncestor(c),wt.appendAncestorTrailsWithPredicate(e,t,i),t.removeAncestor()}}static appendDescendantTrailsWithPredicate(e,t,i){const s=t.lastNode();i(s)&&e.push(t.copy());const n=s._children.length;for(let o=0;o<n;o++){const c=s._children[o];t.addDescendant(c,o),wt.appendDescendantTrailsWithPredicate(e,t,i),t.removeDescendant()}}static spannedSubtrees(e,t){}static fromUniqueId(e,t){const s=t.split(Ql).map(p=>Number(p));let n=e;const o=s.shift(),c=[n];for(assert&&assert(o===e.id);s.length>0;){const p=s.shift(),w=(n.pdomOrder||[]).concat(n.children);for(let O=0;O<w.length;O++){if(w[O]!==null&&w[O].id===p){const T=w[O];c.push(T),n=T;break}assert&&assert(O!==w.length-1,"unable to find node from unique Trail id")}}return new wt(c)}}te.register("Trail",wt);class Hn{constructor(e,t){this.trail=e,this.setBefore(t)}isActive(){return!!this.trail}copy(){return assert&&assert(this.isActive()),new Hn(this.trail.copy(),this.isBefore)}setBefore(e){this.isBefore=e,this.isAfter=!e}getRenderSwappedPointer(){assert&&assert(this.isActive());const e=this,t=this.isBefore?e.trail.previous():e.trail.next();return t===null?null:new Hn(t,!this.isBefore)}getRenderBeforePointer(){return this.isBefore?this:this.getRenderSwappedPointer()}getRenderAfterPointer(){return this.isAfter?this:this.getRenderSwappedPointer()}compareRender(e){assert&&assert(e!==null);const t=this.getRenderBeforePointer(),i=e.getRenderBeforePointer();return t!==null&&i!==null?(assert&&assert(t.isActive()&&i.isActive()),t.trail.compare(i.trail)):t===i?0:t===null?1:-1}compareNested(e){assert&&assert(e),assert&&assert(this.isActive()&&e.isActive());const t=this,i=e,s=t.trail.compare(i.trail);return s===0?this.isBefore===e.isBefore?0:this.isBefore?-1:1:t.trail.isExtensionOf(i.trail)?e.isBefore?1:-1:i.trail.isExtensionOf(t.trail)?this.isBefore?-1:1:s}equalsRender(e){return this.compareRender(e)===0}equalsNested(e){return this.compareNested(e)===0}hasTrail(){return!!this.trail}nestedForwards(){assert&&assert(this.isActive());const e=this;if(this.isBefore){const t=e.trail.lastNode()._children;t.length>0?e.trail.addDescendant(t[0],0):this.setBefore(!1)}else{if(e.trail.indices.length===0)return this.trail=null,null;{const t=e.trail.indices[e.trail.indices.length-1];e.trail.removeDescendant();const i=e.trail.lastNode()._children;i.length>t+1&&(e.trail.addDescendant(i[t+1],t+1),this.setBefore(!0))}}return this}nestedBackwards(){assert&&assert(this.isActive());const e=this;if(this.isBefore){if(e.trail.indices.length===0)return this.trail=null,null;{const t=e.trail.indices[e.trail.indices.length-1];e.trail.removeDescendant(),t-1>=0&&(e.trail.addDescendant(e.trail.lastNode()._children[t-1],t-1),this.setBefore(!1))}}else if(e.trail.lastNode()._children.length>0){const t=e.trail.lastNode()._children;e.trail.addDescendant(t[t.length-1],t.length-1)}else this.setBefore(!0);return this}eachNodeBetween(e,t){this.eachTrailBetween(e,i=>t(i.lastNode()))}eachTrailBetween(e,t){this.isBefore&&(assert&&assert(this.isActive()),t(this.trail)),this.depthFirstUntil(e,i=>i.isBefore?t(i.trail):!1,!0)}depthFirstUntil(e,t,i){assert&&assert(this.isActive()&&e.isActive());const s=this,n=e;assert&&assert(this.compareNested(e)<=(i?-1:0),"TrailPointer.depthFirstUntil pointers out of order, possibly in both meanings of the phrase!"),assert&&assert(s.trail.rootNode()===n.trail.rootNode(),"TrailPointer.depthFirstUntil takes pointers with the same root"),s.trail.reindex(),n.trail.reindex();const o=this.copy();o.trail.setMutable();let c=!0;for(;!o.equalsNested(e);){assert&&assert(o.compareNested(e)!==1,"skipped in depthFirstUntil");let p=!1;if(c?(i||(p=t(o)),c=!1):p=t(o),p&&o.isBefore){if(o.setBefore(!1),o.compareNested(e)===1)break}else o.nestedForwards()}i||t(o)}toString(){return assert&&assert(this.isActive()),`[${this.isBefore?"before":"after"} ${this.trail.toString().slice(1)}`}static compareNested(e,t,i,s){const n=e.compare(i);return n===0?t===s?0:t?-1:1:e.isExtensionOf(i)?s?1:-1:i.isExtensionOf(e)?t?-1:1:n}}te.register("TrailPointer",Hn);const Cv=(h,e)=>h.size===e.size&&_.every([...h],t=>e.has(t));class ku extends Nt{constructor(e){super(new Set),this.node=e,this.listenedNodeSet=new Set,this.updateEmitter=new ri,this.valueComparisonStrategy=Cv,this._nodeUpdateListener=this.update.bind(this),this.addNodeListener(e),this.update()}update(){const e=new Set;(function t(i){i.parents.forEach(n=>{e.add(n),t(n)})})(this.node),e.forEach(t=>{this.listenedNodeSet.has(t)||this.addNodeListener(t)}),this.listenedNodeSet.forEach(t=>{!e.has(t)&&t!==this.node&&this.removeNodeListener(t)}),this.value=e,this.updateEmitter.emit()}addNodeListener(e){this.listenedNodeSet.add(e),e.parentAddedEmitter.addListener(this._nodeUpdateListener),e.parentRemovedEmitter.addListener(this._nodeUpdateListener)}removeNodeListener(e){this.listenedNodeSet.delete(e),e.parentAddedEmitter.removeListener(this._nodeUpdateListener),e.parentRemovedEmitter.removeListener(this._nodeUpdateListener)}dispose(){this.listenedNodeSet.forEach(e=>this.removeNodeListener(e)),super.dispose()}}te.register("AncestorNodesProperty",ku);class Tm extends Nt{constructor(e,t){super([]),this.listenedNodeSet=new Set,this.rootNode=e,this.leafNode=t,this._trailUpdateListener=this.update.bind(this),this.update()}update(){const e=[],t=new Set,i=new wt(this.leafNode),s=this.rootNode;(function c(){const p=i.rootNode();t.add(p),p===s&&e.push(i.copy()),p.parents.forEach(f=>{i.addAncestor(f),c(),i.removeAncestor()})})(),t.forEach(c=>{this.listenedNodeSet.has(c)||this.addNodeListener(c)}),this.listenedNodeSet.forEach(c=>{t.has(c)||this.removeNodeListener(c)});const n=this.value;let o=n.length===e.length;if(o){for(let c=0;c<e.length;c++)if(!n[c].equals(e[c])){o=!1;break}}o||(this.value=e)}addNodeListener(e){this.listenedNodeSet.add(e),e.parentAddedEmitter.addListener(this._trailUpdateListener),e.parentRemovedEmitter.addListener(this._trailUpdateListener)}removeNodeListener(e){this.listenedNodeSet.delete(e),e.parentAddedEmitter.removeListener(this._trailUpdateListener),e.parentRemovedEmitter.removeListener(this._trailUpdateListener)}dispose(){this.listenedNodeSet.forEach(e=>this.removeNodeListener(e)),super.dispose()}}te.register("TrailsBetweenProperty",Tm);class Tv extends Nt{constructor(e,t,i){const s=st()({fromCoordinateFrame:"local",toCoordinateFrame:"local"},i);super(Ze.IDENTITY),this.from=e,this.to=t,this.rootNode=null,this.fromTrail=null,this.toTrail=null,this.listenedNodeSet=new Set,this.fromCoordinateFrame=s.fromCoordinateFrame,this.toCoordinateFrame=s.toCoordinateFrame,this.valueComparisonStrategy="equalsFunction",this.fromAncestorsProperty=new ku(e),this.toAncestorsProperty=new ku(t);const n=this.update.bind(this);this._nodeTransformListener=this.updateMatrix.bind(this),this.fromAncestorsProperty.updateEmitter.addListener(n),this.toAncestorsProperty.updateEmitter.addListener(n),this.update()}update(){const e=[...this.fromAncestorsProperty.value,this.from],t=[...this.toAncestorsProperty.value,this.to],i=e.filter(c=>t.includes(c));let s=!1;const n=i.filter(c=>{const p=e.filter(j=>c.hasChild(j)),f=t.filter(j=>c.hasChild(j)),w=[],O=[];da(p,f,w,O,[]);const z=p.length>1||f.length>1,U=w.length||O.length;z&&U&&(s=!0);const m=w.length>0||this.from===c,Y=O.length>0||this.to===c;return m&&Y});!s&&n.length===1?(this.rootNode=n[0],this.fromTrail=this.from.getUniqueTrailTo(this.rootNode),this.toTrail=this.to.getUniqueTrailTo(this.rootNode)):(this.rootNode=null,this.fromTrail=null,this.toTrail=null);const o=new Set;this.fromTrail&&this.fromTrail.nodes.forEach(c=>o.add(c)),this.toTrail&&this.toTrail.nodes.forEach(c=>o.add(c)),o.forEach(c=>{this.listenedNodeSet.has(c)||this.addNodeListener(c)}),this.listenedNodeSet.forEach(c=>{!o.has(c)&&c!==this.from&&c!==this.to&&this.removeNodeListener(c)}),this.updateMatrix()}updateMatrix(){if(this.rootNode&&this.fromTrail&&this.toTrail){const e=this.fromTrail.nodes.length===1,t=this.toTrail.nodes.length===1,i=e&&this.fromCoordinateFrame==="parent"||t&&this.toCoordinateFrame==="parent",s=this.fromTrail.getMatrixConcatenation(i?0:1,this.fromTrail.nodes.length-(this.fromCoordinateFrame==="parent"?1:0)),n=this.toTrail.getMatrixConcatenation(i?0:1,this.toTrail.nodes.length-(this.toCoordinateFrame==="parent"?1:0));this.value=n.inverted().timesMatrix(s)}else this.value=null}addNodeListener(e){this.listenedNodeSet.add(e),e.transformEmitter.addListener(this._nodeTransformListener)}removeNodeListener(e){this.listenedNodeSet.delete(e),e.transformEmitter.removeListener(this._nodeTransformListener)}dispose(){this.fromAncestorsProperty.dispose(),this.toAncestorsProperty.dispose(),super.dispose()}}te.register("MatrixBetweenProperty",Tv);const xv=Ui.safari5,xm=["fill","fillPickable","stroke","strokePickable","lineWidth","lineCap","lineJoin","miterLimit","lineDash","lineDashOffset","cachedPaints"],kr={fill:null,fillPickable:!0,stroke:null,strokePickable:!1,lineWidth:Ma.lineWidth,lineCap:Ma.lineCap,lineJoin:Ma.lineJoin,lineDashOffset:Ma.lineDashOffset,miterLimit:Ma.miterLimit},Im=["fill","stroke","lineWidth","lineOptions","cachedPaints"],Gh=ns(h=>(assert&&assert(_.includes(Xs(h),tt),"Only Node subtypes should mix Paintable"),class extends h{constructor(...t){super(...t),Cb(this,["_drawables"]),this._fill=kr.fill,this._fillPickable=kr.fillPickable,this._stroke=kr.stroke,this._strokePickable=kr.strokePickable,this._cachedPaints=[],this._lineDrawingStyles=new Qa}setFill(t){return assert&&assert(ar.isPaintDef(t),"Invalid fill type"),assert&&typeof t=="string"&&qe.checkPaintString(t),this._fill!==t&&(this._fill=t,this.invalidateFill()),this}set fill(t){this.setFill(t)}get fill(){return this.getFill()}getFill(){return this._fill}hasFill(){return this.getFillValue()!==null}getFillValue(){const t=this.getFill();return ft(t)?t.get():t}get fillValue(){return this.getFillValue()}setStroke(t){if(assert&&assert(ar.isPaintDef(t),"Invalid stroke type"),assert&&typeof t=="string"&&qe.checkPaintString(t),this._stroke!==t){if(this._stroke=t,assert&&t instanceof mn&&t.transformMatrix){const i=t.transformMatrix.getScaleVector();assert(Math.abs(i.x-i.y)<1e-7,"You cannot specify a pattern or gradient to a stroke that does not have a symmetric scale.")}this.invalidateStroke()}return this}set stroke(t){this.setStroke(t)}get stroke(){return this.getStroke()}getStroke(){return this._stroke}hasStroke(){return this.getStrokeValue()!==null}hasPaintableStroke(){return this.hasStroke()&&this.getLineWidth()>0}getStrokeValue(){const t=this.getStroke();return ft(t)?t.get():t}get strokeValue(){return this.getStrokeValue()}setFillPickable(t){return this._fillPickable!==t&&(this._fillPickable=t,this.invalidateFill()),this}set fillPickable(t){this.setFillPickable(t)}get fillPickable(){return this.isFillPickable()}isFillPickable(){return this._fillPickable}setStrokePickable(t){return this._strokePickable!==t&&(this._strokePickable=t,this.invalidateStroke()),this}set strokePickable(t){this.setStrokePickable(t)}get strokePickable(){return this.isStrokePickable()}isStrokePickable(){return this._strokePickable}setLineWidth(t){if(assert&&assert(t>=0,`lineWidth should be non-negative instead of ${t}`),this.getLineWidth()!==t){this._lineDrawingStyles.lineWidth=t,this.invalidateStroke();const i=this._drawables.length;for(let s=0;s<i;s++)this._drawables[s].markDirtyLineWidth()}return this}set lineWidth(t){this.setLineWidth(t)}get lineWidth(){return this.getLineWidth()}getLineWidth(){return this._lineDrawingStyles.lineWidth}setLineCap(t){if(assert&&assert(t==="butt"||t==="round"||t==="square",`lineCap should be one of "butt", "round" or "square", not ${t}`),this._lineDrawingStyles.lineCap!==t){this._lineDrawingStyles.lineCap=t,this.invalidateStroke();const i=this._drawables.length;for(let s=0;s<i;s++)this._drawables[s].markDirtyLineOptions()}return this}set lineCap(t){this.setLineCap(t)}get lineCap(){return this.getLineCap()}getLineCap(){return this._lineDrawingStyles.lineCap}setLineJoin(t){if(assert&&assert(t==="miter"||t==="round"||t==="bevel",`lineJoin should be one of "miter", "round" or "bevel", not ${t}`),this._lineDrawingStyles.lineJoin!==t){this._lineDrawingStyles.lineJoin=t,this.invalidateStroke();const i=this._drawables.length;for(let s=0;s<i;s++)this._drawables[s].markDirtyLineOptions()}return this}set lineJoin(t){this.setLineJoin(t)}get lineJoin(){return this.getLineJoin()}getLineJoin(){return this._lineDrawingStyles.lineJoin}setMiterLimit(t){if(assert&&assert(isFinite(t),"miterLimit should be a finite number"),this._lineDrawingStyles.miterLimit!==t){this._lineDrawingStyles.miterLimit=t,this.invalidateStroke();const i=this._drawables.length;for(let s=0;s<i;s++)this._drawables[s].markDirtyLineOptions()}return this}set miterLimit(t){this.setMiterLimit(t)}get miterLimit(){return this.getMiterLimit()}getMiterLimit(){return this._lineDrawingStyles.miterLimit}setLineDash(t){if(assert&&assert(Array.isArray(t)&&t.every(i=>typeof i=="number"&&isFinite(i)&&i>=0),"lineDash should be an array of finite non-negative numbers"),this._lineDrawingStyles.lineDash!==t){this._lineDrawingStyles.lineDash=t||[],this.invalidateStroke();const i=this._drawables.length;for(let s=0;s<i;s++)this._drawables[s].markDirtyLineOptions()}return this}set lineDash(t){this.setLineDash(t)}get lineDash(){return this.getLineDash()}getLineDash(){return this._lineDrawingStyles.lineDash}hasLineDash(){return!!this._lineDrawingStyles.lineDash.length}setLineDashOffset(t){if(assert&&assert(isFinite(t),`lineDashOffset should be a number, not ${t}`),this._lineDrawingStyles.lineDashOffset!==t){this._lineDrawingStyles.lineDashOffset=t,this.invalidateStroke();const i=this._drawables.length;for(let s=0;s<i;s++)this._drawables[s].markDirtyLineOptions()}return this}set lineDashOffset(t){this.setLineDashOffset(t)}get lineDashOffset(){return this.getLineDashOffset()}getLineDashOffset(){return this._lineDrawingStyles.lineDashOffset}setLineStyles(t){return this._lineDrawingStyles=t,this.invalidateStroke(),this}set lineStyles(t){this.setLineStyles(t)}get lineStyles(){return this.getLineStyles()}getLineStyles(){return this._lineDrawingStyles}setCachedPaints(t){this._cachedPaints=t.filter(s=>s instanceof mn);const i=this._drawables.length;for(let s=0;s<i;s++)this._drawables[s].markDirtyCachedPaints();return this}set cachedPaints(t){this.setCachedPaints(t)}get cachedPaints(){return this.getCachedPaints()}getCachedPaints(){return this._cachedPaints}addCachedPaint(t){if(t instanceof mn){this._cachedPaints.push(t);const i=this._drawables.length;for(let s=0;s<i;s++)this._drawables[s].markDirtyCachedPaints()}}removeCachedPaint(t){if(t instanceof mn){assert&&assert(_.includes(this._cachedPaints,t)),is(this._cachedPaints,t);const i=this._drawables.length;for(let s=0;s<i;s++)this._drawables[s].markDirtyCachedPaints()}}beforeCanvasFill(t){assert&&assert(this.getFillValue()!==null);const i=this.getFillValue();t.setFillStyle(i),i.transformMatrix&&(t.context.save(),i.transformMatrix.canvasAppendTransform(t.context))}afterCanvasFill(t){this.getFillValue().transformMatrix&&t.context.restore()}beforeCanvasStroke(t){const i=this.getStrokeValue();if(t.setStrokeStyle(this._stroke),t.setLineCap(this.getLineCap()),t.setLineJoin(this.getLineJoin()),i.transformMatrix){const s=i.transformMatrix.getScaleVector();assert&&assert(Math.abs(s.x-s.y)<1e-7,"You cannot specify a pattern or gradient to a stroke that does not have a symmetric scale.");const n=1/s.x;t.context.save(),i.transformMatrix.canvasAppendTransform(t.context),t.setLineWidth(this.getLineWidth()*n),t.setMiterLimit(this.getMiterLimit()*n),t.setLineDash(this.getLineDash().map(o=>o*n)),t.setLineDashOffset(this.getLineDashOffset()*n)}else t.setLineWidth(this.getLineWidth()),t.setMiterLimit(this.getMiterLimit()),t.setLineDash(this.getLineDash()),t.setLineDashOffset(this.getLineDashOffset())}afterCanvasStroke(t){this.getStrokeValue().transformMatrix&&t.context.restore()}getCSSFill(){const t=this.getFillValue();return t?t.toCSS?t.toCSS():t:"transparent"}getSimpleCSSStroke(){const t=this.getStrokeValue();return t?t.toCSS?t.toCSS():t:"transparent"}appendFillablePropString(t,i){return this._fill&&(i&&(i+=`,
`),typeof this.getFillValue()=="string"?i+=`${t}fill: '${this.getFillValue()}'`:i+=`${t}fill: ${this.getFillValue()}`),i}appendStrokablePropString(t,i){function s(n,o,c){i&&(i+=`,
`),!c&&typeof o=="string"?i+=`${t+n}: '${o}'`:i+=`${t+n}: ${o}`}if(this._stroke){const n=new Qa,o=this.getStrokeValue();typeof o=="string"?s("stroke",o):s("stroke",o?o.toString():"null",!0),_.each(["lineWidth","lineCap","miterLimit","lineJoin","lineDashOffset"],c=>{this[c]!==n[c]&&s(c,this[c])}),this.lineDash.length&&s("lineDash",JSON.stringify(this.lineDash),!0)}return i}getFillRendererBitmask(){let t=0;return xv&&this._fill instanceof Vs||(t|=de.bitmaskSVG),t|=de.bitmaskCanvas,this.hasFill()&&(this._fill instanceof Hr||this._fill instanceof Vs)||(t|=de.bitmaskDOM,t|=de.bitmaskWebGL),t}getStrokeRendererBitmask(){let t=0;return t|=de.bitmaskCanvas,t|=de.bitmaskSVG,this.hasStroke()||(t|=de.bitmaskDOM,t|=de.bitmaskWebGL),t}invalidateFill(){this.invalidateSupportedRenderers();const t=this._drawables.length;for(let i=0;i<t;i++)this._drawables[i].markDirtyFill()}invalidateStroke(){this.invalidateSupportedRenderers();const t=this._drawables.length;for(let i=0;i<t;i++)this._drawables[i].markDirtyStroke()}}));te.register("Paintable",Gh);Gh.DEFAULT_OPTIONS=kr;const Iv=Math.log2||function(h){return Math.log(h)/Math.LN2},Jn={imageOpacity:1,initialWidth:0,initialHeight:0,mipmap:!1,mipmapBias:0,mipmapInitialLevel:4,mipmapMaxLevel:5,hitTestPixels:!1};let Hc=null,Vc=null;const Dm=()=>(Hc||(Hc=document.createElement("canvas")),Hc),Dv=()=>(Vc||(Vc=Dm().getContext("2d",{willReadFrequently:!0})),Vc),bn=h=>class extends h{constructor(...t){super(...t),this._imageProperty=new $n(null,!1,this.onImagePropertyChange.bind(this)),this._image=null,this._initialWidth=Jn.initialWidth,this._initialHeight=Jn.initialHeight,this._imageOpacity=Jn.imageOpacity,this._mipmap=Jn.mipmap,this._mipmapBias=Jn.mipmapBias,this._mipmapInitialLevel=Jn.mipmapInitialLevel,this._mipmapMaxLevel=Jn.mipmapMaxLevel,this._hitTestPixels=Jn.hitTestPixels,this._mipmapCanvases=[],this._mipmapURLs=[],this._mipmapData=null,this._imageLoadListener=this._onImageLoad.bind(this),this._imageLoadListenerAttached=!1,this._hitTestImageData=null,this.mipmapEmitter=new ri}setImage(t){return assert&&assert(t,"image should be available"),this._imageProperty.value=t,this}set image(t){this.setImage(t)}get image(){return this.getImage()}getImage(){return assert&&assert(this._image!==null),this._image}onImagePropertyChange(t){assert&&assert(t,"image should be available");let i=this._image!==t;if(i&&typeof t=="string"&&this._image&&this._image instanceof HTMLImageElement&&t===this._image.src&&(i=!1),i&&t===this._mipmapData&&(i=!1),i){if(this._initialWidth=0,this._initialHeight=0,this._image&&this._imageLoadListenerAttached&&this._detachImageLoadListener(),this._mipmapData=null,typeof t=="string"){const s=t;t=document.createElement("img"),t.src=s}else Array.isArray(t)&&(this._mipmapData=t,t=t[0].img,this._mipmapInitialLevel=this._mipmapMaxLevel=this._mipmapData.length,this._mipmap=!0);this._image=t,this._image instanceof HTMLImageElement&&(!this._image.width||!this._image.height)&&this._attachImageLoadListener(),this.invalidateImage()}}setImageProperty(t){return this._imageProperty.setTargetProperty(t)}set imageProperty(t){this.setImageProperty(t)}get imageProperty(){return this.getImageProperty()}getImageProperty(){return this._imageProperty}invalidateImage(){this.invalidateMipmaps(),this._invalidateHitTestData()}setImageWithSize(t,i,s){return this.setImage(t),this.setInitialWidth(i),this.setInitialHeight(s),this}setImageOpacity(t){assert&&assert(isFinite(t)&&t>=0&&t<=1,`imageOpacity out of range: ${t}`),this._imageOpacity!==t&&(this._imageOpacity=t)}set imageOpacity(t){this.setImageOpacity(t)}get imageOpacity(){return this.getImageOpacity()}getImageOpacity(){return this._imageOpacity}setInitialWidth(t){return assert&&assert(t>=0&&t%1===0,"initialWidth should be a non-negative integer"),t!==this._initialWidth&&(this._initialWidth=t,this.invalidateImage()),this}set initialWidth(t){this.setInitialWidth(t)}get initialWidth(){return this.getInitialWidth()}getInitialWidth(){return this._initialWidth}setInitialHeight(t){return assert&&assert(t>=0&&t%1===0,"initialHeight should be a non-negative integer"),t!==this._initialHeight&&(this._initialHeight=t,this.invalidateImage()),this}set initialHeight(t){this.setInitialHeight(t)}get initialHeight(){return this.getInitialHeight()}getInitialHeight(){return this._initialHeight}setMipmap(t){return this._mipmap!==t&&(this._mipmap=t,this.invalidateMipmaps()),this}set mipmap(t){this.setMipmap(t)}get mipmap(){return this.isMipmap()}isMipmap(){return this._mipmap}setMipmapBias(t){return this._mipmapBias!==t&&(this._mipmapBias=t,this.invalidateMipmaps()),this}set mipmapBias(t){this.setMipmapBias(t)}get mipmapBias(){return this.getMipmapBias()}getMipmapBias(){return this._mipmapBias}setMipmapInitialLevel(t){return assert&&assert(t%1===0&&t>=0,"mipmapInitialLevel should be a non-negative integer"),this._mipmapInitialLevel!==t&&(this._mipmapInitialLevel=t,this.invalidateMipmaps()),this}set mipmapInitialLevel(t){this.setMipmapInitialLevel(t)}get mipmapInitialLevel(){return this.getMipmapInitialLevel()}getMipmapInitialLevel(){return this._mipmapInitialLevel}setMipmapMaxLevel(t){return assert&&assert(t%1===0&&t>=0,"mipmapMaxLevel should be a non-negative integer"),this._mipmapMaxLevel!==t&&(this._mipmapMaxLevel=t,this.invalidateMipmaps()),this}set mipmapMaxLevel(t){this.setMipmapMaxLevel(t)}get mipmapMaxLevel(){return this.getMipmapMaxLevel()}getMipmapMaxLevel(){return this._mipmapMaxLevel}setHitTestPixels(t){return this._hitTestPixels!==t&&(this._hitTestPixels=t,this._invalidateHitTestData()),this}set hitTestPixels(t){this.setHitTestPixels(t)}get hitTestPixels(){return this.getHitTestPixels()}getHitTestPixels(){return this._hitTestPixels}_constructNextMipmap(){const t=this._mipmapCanvases.length,i=this._mipmapCanvases[t-1];if(i.width*i.height>2){const s=document.createElement("canvas");if(s.width=Math.ceil(i.width/2),s.height=Math.ceil(i.height/2),s.width>0&&s.height>0){const n=s.getContext("2d");n.scale(.5,.5),n.drawImage(i,0,0),this._mipmapCanvases.push(s),this._mipmapURLs.push(s.toDataURL())}}}invalidateMipmaps(){if(vt(this._mipmapCanvases),vt(this._mipmapURLs),this._image&&this._mipmap)if(this._mipmapData)for(let t=0;t<this._mipmapData.length;t++){const i=this._mipmapData[t].url;this._mipmapURLs.push(i);const s=this._mipmapData[t].updateCanvas;s&&s(),this._mipmapCanvases.push(this._mipmapData[t].canvas)}else{const t=document.createElement("canvas");if(t.width=this.getImageWidth(),t.height=this.getImageHeight(),t.width&&t.height){t.getContext("2d").drawImage(this._image,0,0),this._mipmapCanvases.push(t),this._mipmapURLs.push(t.toDataURL());let s=0;for(;++s<this._mipmapInitialLevel;)this._constructNextMipmap()}}this.mipmapEmitter.emit()}getMipmapLevel(t,i=0){assert&&assert(this._mipmap,"Assumes mipmaps can be used");const s=bn.getApproximateMatrixScale(t)*(self.devicePixelRatio||1);return this.getMipmapLevelFromScale(s,i)}getMipmapLevelFromScale(t,i=0){if(assert&&assert(t>0,"scale should be a positive number"),t>=1)return 0;let s=Iv(1/t);if(s=ct.roundSymmetric(s+this._mipmapBias+i-.7),s<0&&(s=0),s>this._mipmapMaxLevel&&(s=this._mipmapMaxLevel),this.mipmap&&!this._mipmapCanvases[s]){let n=this._mipmapCanvases.length-1;for(;++n<=s;)this._constructNextMipmap();return Math.min(s,this._mipmapCanvases.length-1)}else return s}getMipmapCanvas(t){if(assert&&assert(t>=0&&t<this._mipmapCanvases.length&&t%1===0),this._mipmapData){const i=this._mipmapData[t]&&this._mipmapData[t].updateCanvas;i&&i()}return this._mipmapCanvases[t]}getMipmapURL(t){return assert&&assert(t>=0&&t<this._mipmapCanvases.length&&t%1===0),this._mipmapURLs[t]}hasMipmaps(){return this._mipmapCanvases.length>0}_invalidateHitTestData(){this._hitTestPixels&&this._image!==null&&(this._hitTestImageData=bn.getHitTestData(this._image,this.imageWidth,this.imageHeight))}getImageWidth(){if(this._image===null)return 0;const t=this._mipmapData?this._mipmapData[0].width:("naturalWidth"in this._image?this._image.naturalWidth:0)||this._image.width;return t===0?this._initialWidth:(assert&&assert(this._initialWidth===0||this._initialWidth===t,"Bad Image.initialWidth"),t)}get imageWidth(){return this.getImageWidth()}getImageHeight(){if(this._image===null)return 0;const t=this._mipmapData?this._mipmapData[0].height:("naturalHeight"in this._image?this._image.naturalHeight:0)||this._image.height;return t===0?this._initialHeight:(assert&&assert(this._initialHeight===0||this._initialHeight===t,"Bad Image.initialHeight"),t)}get imageHeight(){return this.getImageHeight()}getImageURL(){return assert&&assert(this._image instanceof HTMLImageElement,"Only supported for HTML image elements"),this._image.src}_attachImageLoadListener(){assert&&assert(!this._imageLoadListenerAttached,"Should only be attached to one thing at a time"),this.isDisposed||(this._image.addEventListener("load",this._imageLoadListener),this._imageLoadListenerAttached=!0)}_detachImageLoadListener(){assert&&assert(this._imageLoadListenerAttached,"Needs to be attached first to be detached."),this._image.removeEventListener("load",this._imageLoadListener),this._imageLoadListenerAttached=!1}_onImageLoad(){assert&&assert(this._imageLoadListenerAttached,"If _onImageLoad is firing, it should be attached"),this.invalidateImage(),this._detachImageLoadListener()}dispose(){this._image&&this._imageLoadListenerAttached&&this._detachImageLoadListener(),this._imageProperty.dispose(),super.dispose&&super.dispose()}};bn.getHitTestData=(h,e,t)=>{if(!("naturalWidth"in h&&h.naturalWidth||h.width)||!("naturalHeight"in h&&h.naturalHeight||h.height))return null;const i=Dm(),s=Dv();return i.width=e,i.height=t,s.drawImage(h,0,0),s.getImageData(0,0,e,t)};bn.testHitTestData=(h,e,t,i)=>{const s=ct.clamp(Math.floor(i.x/e*h.width),0,h.width-1),n=ct.clamp(Math.floor(i.y/t*h.height),0,h.height-1),o=4*(s+n*h.width)+3;return h.data[o]!==0};bn.hitTestDataToShape=(h,e,t)=>{const i=e/h.width,s=t/h.height,n=new kt;let o=!1,c=0;for(let p=0;p<h.height;p++){for(let f=0;f<h.width;f++){const w=4*(f+p*h.width)+3;h.data[w]!==0?o||(o=!0,c=f):o&&(o=!1,n.rect(c*i,p*i,i*(f-c),s))}o&&(o=!1,n.rect(c*i,p*i,i*(h.width-c),s))}return n.getSimplifiedAreaShape()};bn.createSVGImage=(h,e,t)=>{assert&&assert(isFinite(e)&&e>=0&&e%1===0,"width should be a non-negative finite integer"),assert&&assert(isFinite(t)&&t>=0&&t%1===0,"height should be a non-negative finite integer");const i=document.createElementNS(li,"image");return i.setAttribute("x","0"),i.setAttribute("y","0"),i.setAttribute("width",`${e}px`),i.setAttribute("height",`${t}px`),i.setAttributeNS(Va,"xlink:href",h),i};bn.createFastMipmapFromCanvas=h=>{const e=[],t=h.toDataURL(),i=new self.Image;i.src=t,e.push({img:i,url:t,width:h.width,height:h.height,canvas:h});let s=h;for(;s.width>=2&&s.height>=2;){const n=document.createElement("canvas");n.width=Math.ceil(s.width/2),n.height=Math.ceil(s.height/2);const o=n.getContext("2d");o.setTransform(.5,0,0,.5,0,0),o.drawImage(s,0,0);const c={width:n.width,height:n.height,canvas:n,url:n.toDataURL(),img:new self.Image};c.img.src=c.url,s=n,e.push(c)}return e};bn.getApproximateMatrixScale=h=>(Math.sqrt(h.m00()*h.m00()+h.m10()*h.m10())+Math.sqrt(h.m01()*h.m01()+h.m11()*h.m11()))/2;bn.CANVAS_MIPMAP_BIAS_ADJUSTMENT=.5;bn.DEFAULT_OPTIONS=Jn;te.register("Imageable",bn);const Ys=bn,Am=(h,e,t)=>{var i;const s=`_${h}PendingOptions`,n=`_${h}IsConstructed`;return class extends(i=t,i){constructor(...c){super(...c),this[n]=!0,this.mutate(this[s]),this[s]=void 0}mutate(c){return c&&!this[n]&&(this[s]=_i(this[s]||{},_.pick(c,e)),c=_.omit(c,e)),super.mutate(c)}}};te.register("DelayedMutate",Am);const oo=Am,Av=["image","imageProperty","imageOpacity","imageBounds","initialWidth","initialHeight","mipmap","mipmapBias","mipmapInitialLevel","mipmapMaxLevel","hitTestPixels"],hg=class hg extends Ys(tt){constructor(e,t){const i={};ft(e)?i.imageProperty=e:i.image=e;const s=st()(i,t);super(),this._imageBounds=null,this.mutate(s),this.invalidateSupportedRenderers()}invalidateImage(){this._image?this.invalidateSelf(this._imageBounds||new $e(0,0,this.getImageWidth(),this.getImageHeight())):this.invalidateSelf($e.NOTHING);const e=this._drawables.length;for(let t=0;t<e;t++)this._drawables[t].markDirtyImage();super.invalidateImage(),this.invalidateSupportedRenderers()}invalidateSupportedRenderers(){let e=de.bitmaskCanvas;this.getImageWidth()<=Fr.MAX_DIMENSION.width&&this.getImageHeight()<=Fr.MAX_DIMENSION.height&&(e|=de.bitmaskWebGL),this._image instanceof HTMLCanvasElement||(e|=de.bitmaskSVG|de.bitmaskDOM),this.setRendererBitmask(e)}setImageOpacity(e){const t=this._imageOpacity!==e;if(super.setImageOpacity(e),t){const i=this._drawables.length;for(let s=0;s<i;s++)this._drawables[s].markDirtyImageOpacity()}}setImageBounds(e){this._imageBounds!==e&&(this._imageBounds=e,this.invalidateImage())}set imageBounds(e){this.setImageBounds(e)}get imageBounds(){return this._imageBounds}getImageBounds(){return this._imageBounds}isPainted(){return!0}canvasPaintSelf(e,t){rf.prototype.paintCanvas(e,this,t)}createDOMDrawable(e,t){return J0.createFromPool(e,t)}createSVGDrawable(e,t){return tP.createFromPool(e,t)}createCanvasDrawable(e,t){return rf.createFromPool(e,t)}createWebGLDrawable(e,t){return iP.createFromPool(e,t)}containsPointSelf(e){const t=tt.prototype.containsPointSelf.call(this,e);return!t||!this._hitTestPixels||!this._hitTestImageData?t:Ys.testHitTestData(this._hitTestImageData,this.imageWidth,this.imageHeight,e)}getSelfShape(){return this._hitTestPixels&&this._hitTestImageData?Ys.hitTestDataToShape(this._hitTestImageData,this.imageWidth,this.imageHeight):tt.prototype.getSelfShape.call(this)}invalidateMipmaps(){const e=this._image&&this._mipmap&&!this._mipmapData;if(super.invalidateMipmaps(),e){const t=this._drawables.length;for(let i=0;i<t;i++)this._drawables[i].markDirtyMipmap()}}mutate(e){return super.mutate(e)}};hg.DEFAULT_IMAGE_OPTIONS=_i({},tt.DEFAULT_NODE_OPTIONS,Ys.DEFAULT_OPTIONS);let Ls=hg;Ls.prototype._mutatorKeys=[...Av,...tt.prototype._mutatorKeys];Ls.prototype.drawableMarkFlags=[...tt.prototype.drawableMarkFlags,"image","imageOpacity","mipmap"];Ls.ImageIO=new Ai("ImageIO",{valueType:Ls,supertype:tt.NodeIO,events:["changed"],methods:{setImage:{returnType:rn,parameterTypes:[Ti],implementation:function(h){const e=new self.Image;e.src=h,this.image=e},documentation:"Set the image from a base64 string",invocableForReadOnlyElements:!1}}});te.register("Image",Ls);const Ev=["boundsMethod","shape","shapeProperty"],Zl={shape:null,boundsMethod:"accurate"},cg=class cg extends Gh(tt){constructor(e,t){assert&&assert(t===void 0||Object.getPrototypeOf(t)===Object.prototype,"Extra prototype on Node options object is a code smell"),(e||t!=null&&t.shape)&&assert&&assert(!e||!(t!=null&&t.shape),"Do not define shape twice. Check constructor and providedOptions.");const i={boundsMethod:Zl.boundsMethod};ft(e)?i.shapeProperty=e:i.shape=e;const s=st()(i,t);super(),this._shapeProperty=new $n(null,!1,this.onShapePropertyChange.bind(this)),this._shape=Zl.shape,this._strokedShape=null,this._boundsMethod=Zl.boundsMethod,this._invalidShapeListener=this.invalidateShape.bind(this),this._invalidShapeListenerAttached=!1,this.invalidateSupportedRenderers(),this.mutate(s)}setShape(e){return assert&&assert(e===null||typeof e=="string"||e instanceof kt,"A path's shape should either be null, a string, or a Shape"),this._shapeProperty.value=e,this}set shape(e){this.setShape(e)}get shape(){return this.getShape()}getShape(){return this._shape}onShapePropertyChange(e){assert&&assert(e===null||typeof e=="string"||e instanceof kt,"A path's shape should either be null, a string, or a Shape"),this._shape!==e&&(this._invalidShapeListenerAttached&&this.detachShapeListener(),typeof e=="string"&&(e=new kt(e)),this._shape=e,this.invalidateShape(),this._shape&&!this._shape.isImmutable()&&this.attachShapeListener())}setShapeProperty(e){return this._shapeProperty.setTargetProperty(e)}set shapeProperty(e){this.setShapeProperty(e)}get shapeProperty(){return this.getShapeProperty()}getShapeProperty(){return this._shapeProperty}getStrokedShape(){return assert&&assert(this.hasShape(),"We cannot stroke a non-existing shape"),this._strokedShape||(this._strokedShape=this.getShape().getStrokedShape(this._lineDrawingStyles)),this._strokedShape}getPathRendererBitmask(){return de.bitmaskCanvas|de.bitmaskSVG}invalidateSupportedRenderers(){this.setRendererBitmask(this.getFillRendererBitmask()&this.getStrokeRendererBitmask()&this.getPathRendererBitmask())}invalidateShape(){this.invalidatePath();const e=this._drawables.length;for(let t=0;t<e;t++)this._drawables[t].markDirtyShape();this._invalidShapeListenerAttached&&this._shape&&this._shape.isImmutable()&&this.detachShapeListener()}invalidatePath(){this._strokedShape=null,this.invalidateSelf()}attachShapeListener(){assert&&assert(!this._invalidShapeListenerAttached,"We do not want to have two listeners attached!"),this.isDisposed||(this._shape.invalidatedEmitter.addListener(this._invalidShapeListener),this._invalidShapeListenerAttached=!0)}detachShapeListener(){assert&&assert(this._invalidShapeListenerAttached,"We cannot detach an unattached listener"),this._shape.invalidatedEmitter.removeListener(this._invalidShapeListener),this._invalidShapeListenerAttached=!1}updateSelfBounds(){const e=this.hasShape()?this.computeShapeBounds():$e.NOTHING,t=!e.equals(this.selfBoundsProperty._value);return t&&this.selfBoundsProperty._value.set(e),t}setBoundsMethod(e){return assert&&assert(e==="accurate"||e==="unstroked"||e==="tightPadding"||e==="safePadding"||e==="none"),this._boundsMethod!==e&&(this._boundsMethod=e,this.invalidatePath(),this.rendererSummaryRefreshEmitter.emit()),this}set boundsMethod(e){this.setBoundsMethod(e)}get boundsMethod(){return this.getBoundsMethod()}getBoundsMethod(){return this._boundsMethod}computeShapeBounds(){const e=this.getShape();if(this._boundsMethod==="none"||!e)return $e.NOTHING;if(!this.hasPaintableStroke()||this._boundsMethod==="unstroked")return e.bounds;if(this._boundsMethod==="accurate")return e.getStrokedBounds(this.getLineStyles());{let t;return this._boundsMethod==="safePadding"&&this.getLineJoin()==="miter"?t=this.getMiterLimit():this.getLineCap()==="square"?t=Math.SQRT2:t=1,e.bounds.dilated(t*this.getLineWidth()/2)}}areSelfBoundsValid(){return this._boundsMethod==="accurate"||this._boundsMethod==="safePadding"?!0:this._boundsMethod==="none"?!1:!this.hasStroke()}getTransformedSelfBounds(e){return assert&&assert(this.hasShape()),(this._stroke?this.getStrokedShape():this.getShape()).getBoundsWithTransform(e)}getTransformedSafeSelfBounds(e){return this.getTransformedSelfBounds(e)}invalidateStroke(){this.invalidatePath(),this.rendererSummaryRefreshEmitter.emit(),super.invalidateStroke()}hasShape(){return!!this._shape}canvasPaintSelf(e,t){of.prototype.paintCanvas(e,this,t)}createSVGDrawable(e,t){return aP.createFromPool(e,t)}createCanvasDrawable(e,t){return of.createFromPool(e,t)}isPainted(){return!0}containsPointSelf(e){let t=!1;return this.hasShape()&&(this._fillPickable&&(t=this.getShape().containsPoint(e)),!t&&this._strokePickable&&(t=this.getStrokedShape().containsPoint(e))),t}getSelfShape(){return kt.union([...this.hasShape()&&this._fillPickable?[this.getShape()]:[],...this.hasShape()&&this._strokePickable?[this.getStrokedShape()]:[]])}intersectsBoundsSelf(e){return this._shape?this._shape.intersectsBounds(e):!1}requiresSVGBoundsWorkaround(){if(!this._stroke||!(this._stroke instanceof mn)||!this.hasShape())return!1;const e=this.computeShapeBounds();return e.width*e.height===0}getDebugHTMLExtras(){return this._shape?` (<span style="color: #88f" onclick="self.open( 'data:text/plain;charset=utf-8,' + encodeURIComponent( '${this._shape.getSVGPath()}' ) );">path</span>)`:""}dispose(){this._invalidShapeListenerAttached&&this.detachShapeListener(),this._shapeProperty.dispose(),super.dispose()}mutate(e){return super.mutate(e)}};cg.DEFAULT_PATH_OPTIONS=_i({},tt.DEFAULT_NODE_OPTIONS,Zl);let Fi=cg;Fi.prototype._mutatorKeys=[...xm,...Ev,...tt.prototype._mutatorKeys];Fi.prototype.drawableMarkFlags=[...tt.prototype.drawableMarkFlags,...Im,"shape"];te.register("Path",Fi);const kv=["view","linked","string","none"],md=new wi("none",{tandem:ai.GENERAL_VIEW.createTandem("phetioElementSelectionProperty"),phetioValueType:Ti,validValues:kv,phetioState:!1,phetioDocumentation:'Specifies how PhET-iO Elements are being selected. "view": the target view element, "linked": the corresponding linked element of the view element (if there is one), "string": select only string elements in the sim, "none": no active selection.'});Wr.register("phetioElementSelectionProperty",md);const nh="stringProperty",Ov=["boundsMethod",nh,"string","font","fontWeight","fontFamily","fontStretch","fontStyle","fontSize"],Mv=self.navigator.userAgent.includes("like Gecko) Version/5")&&self.navigator.userAgent.includes("Safari/"),dn=class dn extends Gh(tt){constructor(e,t){assert&&assert(t===void 0||Object.getPrototypeOf(t)===Object.prototype,"Extra prototype on Node options object is a code smell"),super(),this._stringProperty=new $n("",!0,this.onStringPropertyChange.bind(this)),this._font=ss.DEFAULT,this._boundsMethod="hybrid",this._isHTML=!1,this._cachedRenderedText=null;const i=Fa({fill:"#000000",tandemNameSuffix:"Text",phetioType:dn.TextIO,phetioVisiblePropertyInstrumented:!1},t);assert&&assert(!i.hasOwnProperty("string")&&!i.hasOwnProperty(dn.STRING_PROPERTY_TANDEM_NAME),"provide string and stringProperty through constructor arg please"),typeof e=="string"||typeof e=="number"?i.string=e:i.stringProperty=e,this.mutate(i),this.invalidateSupportedRenderers()}mutate(e){return assert&&e&&e.hasOwnProperty("string")&&e.hasOwnProperty(nh)&&assert&&assert(e.stringProperty.value===e.string,"If both string and stringProperty are provided, then values should match"),super.mutate(e)}setString(e){return assert&&assert(e!=null,"String should be defined and non-null. Use the empty string if needed."),e=`${e}`,this._stringProperty.set(e),this}set string(e){this.setString(e)}get string(){return this.getString()}getString(){return this._stringProperty.value}getRenderedText(){return this._cachedRenderedText===null&&(this._cachedRenderedText=this.string.replace(" ",""),Ui.edge&&(this._cachedRenderedText=dn.simplifyEmbeddingMarks(this._cachedRenderedText))),this._cachedRenderedText}get renderedText(){return this.getRenderedText()}onStringPropertyChange(){this._cachedRenderedText=null;const e=this._drawables.length;for(let t=0;t<e;t++)this._drawables[t].markDirtyText();this.invalidateText()}setStringProperty(e){return this._stringProperty.setTargetProperty(e,this,dn.STRING_PROPERTY_TANDEM_NAME)}set stringProperty(e){this.setStringProperty(e)}get stringProperty(){return this.getStringProperty()}getStringProperty(){return this._stringProperty}initializePhetioObject(e,t){const i=this.isPhetioInstrumented();super.initializePhetioObject(e,t),ai.PHET_IO_ENABLED&&!i&&this.isPhetioInstrumented()&&this._stringProperty.initializePhetio(this,dn.STRING_PROPERTY_TANDEM_NAME,()=>new Nh(this.string,_i({phetioReadOnly:!0,tandem:this.tandem.createTandem(dn.STRING_PROPERTY_TANDEM_NAME),phetioDocumentation:"Property for the displayed text"},t.stringPropertyOptions)))}getPhetioMouseHitTarget(e=!1){return md.value==="string"?this.getStringPropertyPhetioMouseHitTarget(e):super.getPhetioMouseHitTarget(e)}getStringPropertyPhetioMouseHitTarget(e=!1){const t=this._stringProperty.getTargetProperty();return t instanceof Hi?t.getPhetioMouseHitTarget(e):"phetioNotSelectable"}setBoundsMethod(e){if(assert&&assert(e==="fast"||e==="fastCanvas"||e==="accurate"||e==="hybrid","Unknown Text boundsMethod"),e!==this._boundsMethod){this._boundsMethod=e,this.invalidateSupportedRenderers();const t=this._drawables.length;for(let i=0;i<t;i++)this._drawables[i].markDirtyBounds();this.invalidateText(),this.rendererSummaryRefreshEmitter.emit()}return this}set boundsMethod(e){this.setBoundsMethod(e)}get boundsMethod(){return this.getBoundsMethod()}getBoundsMethod(){return this._boundsMethod}getTextRendererBitmask(){let e=0;return this._boundsMethod!=="fast"&&!this._isHTML&&(e|=de.bitmaskCanvas),this._isHTML||(e|=de.bitmaskSVG),e|=de.bitmaskDOM,e}invalidateSupportedRenderers(){this.setRendererBitmask(this.getFillRendererBitmask()&this.getStrokeRendererBitmask()&this.getTextRendererBitmask())}invalidateText(){this.invalidateSelf();const e=this._drawables.length;for(let t=0;t<e;t++)this._drawables[t].markDirtyBounds();this.invalidateSupportedRenderers()}updateSelfBounds(){let e;this._isHTML||Mv&&this._boundsMethod!=="accurate"?e=nn.approximateDOMBounds(this._font,this.getDOMTextNode()):this._boundsMethod==="hybrid"?e=nn.approximateHybridBounds(this._font,this.renderedText):this._boundsMethod==="accurate"?e=nn.accurateCanvasBounds(this):(assert&&assert(this._boundsMethod==="fast"||this._boundsMethod==="fastCanvas"),e=nn.approximateSVGBounds(this._font,this.renderedText)),this.hasStroke()&&e.dilate(this.getLineWidth()/2);const t=!e.equals(this.selfBoundsProperty._value);return t&&this.selfBoundsProperty._value.set(e),t}invalidateStroke(){this.invalidateText(),super.invalidateStroke()}invalidateFill(){this.invalidateText(),super.invalidateFill()}canvasPaintSelf(e,t){cf.prototype.paintCanvas(e,this,t)}createDOMDrawable(e,t){return gP.createFromPool(e,t)}createSVGDrawable(e,t){return mP.createFromPool(e,t)}createCanvasDrawable(e,t){return cf.createFromPool(e,t)}getDOMTextNode(){if(this._isHTML){const e=document.createElement("span");return e.innerHTML=this.string,e}else return document.createTextNode(this.renderedText)}getSafeSelfBounds(){const t=this.getSelfBounds();return t.dilatedXY(1*t.width,1*t.height)}setFont(e){if(e!==(typeof e=="string"?this._font.toCSS():this._font)){this._font=typeof e=="string"?ss.fromCSS(e):e;const i=this._drawables.length;for(let s=0;s<i;s++)this._drawables[s].markDirtyFont();this.invalidateText()}return this}set font(e){this.setFont(e)}get font(){return this.getFont()}getFont(){return this._font.getFont()}setFontWeight(e){return this.setFont(this._font.copy({weight:e}))}set fontWeight(e){this.setFontWeight(e)}get fontWeight(){return this.getFontWeight()}getFontWeight(){return this._font.getWeight()}setFontFamily(e){return this.setFont(this._font.copy({family:e}))}set fontFamily(e){this.setFontFamily(e)}get fontFamily(){return this.getFontFamily()}getFontFamily(){return this._font.getFamily()}setFontStretch(e){return this.setFont(this._font.copy({stretch:e}))}set fontStretch(e){this.setFontStretch(e)}get fontStretch(){return this.getFontStretch()}getFontStretch(){return this._font.getStretch()}setFontStyle(e){return this.setFont(this._font.copy({style:e}))}set fontStyle(e){this.setFontStyle(e)}get fontStyle(){return this.getFontStyle()}getFontStyle(){return this._font.getStyle()}setFontSize(e){return this.setFont(this._font.copy({size:e}))}set fontSize(e){this.setFontSize(e)}get fontSize(){return this.getFontSize()}getFontSize(){return this._font.getSize()}isPainted(){return!0}areSelfBoundsValid(){return this._boundsMethod==="accurate"}getDebugHTMLExtras(){return` "${au(this.renderedText)}"${this._isHTML?" (html)":""}`}dispose(){super.dispose(),this._stringProperty.dispose()}static embeddedDebugString(e){return e.replace(/\u202a/g,"[LTR]").replace(/\u202b/g,"[RTL]").replace(/\u202c/g,"[POP]")}static simplifyEmbeddingMarks(e){const t={dir:null,children:[],parent:null};let i=t;for(let f=0;f<e.length;f++){const w=e.charAt(f);if(w===Rv||w===Nv){const O={dir:w,children:[],parent:i};i.children.push(O),i=O}else w===Bv?(assert&&assert(i.parent,`Bad nesting of embedding marks: ${dn.embeddedDebugString(e)}`),i=i.parent):i.children.push(w)}assert&&assert(i===t,`Bad nesting of embedding marks: ${dn.embeddedDebugString(e)}`);function s(f){for(let w=f.children.length-1;w>=0;w--){const O=f.children[w];typeof O!="string"&&f.dir===O.dir&&f.children.splice(w,1,...O.children)}}function n(f){f.children.length===1&&typeof f.children[0]!="string"&&f.children[0].dir&&(f.dir=f.children[0].dir,f.children=f.children[0].children)}function o(f){for(let w=f.children.length-1;w>=1;w--){const O=f.children[w-1],T=f.children[w];typeof T!="string"&&typeof O!="string"&&T.dir&&O.dir===T.dir&&(O.children=O.children.concat(T.children),f.children.splice(w,1),o(O))}}function c(f){if(typeof f!="string"){for(let w=0;w<f.children.length;w++)c(f.children[w]);n(f),s(f),o(f)}return f}function p(f){if(typeof f=="string")return f;const w=f.children.map(p).join("");return f.dir?`${f.dir+w}`:w}return p(c(t))}};dn.STRING_PROPERTY_NAME=nh,dn.STRING_PROPERTY_TANDEM_NAME=nh;let gs=dn;gs.prototype._mutatorKeys=[...xm,...Ov,...tt.prototype._mutatorKeys];gs.prototype.drawableMarkFlags=[...tt.prototype.drawableMarkFlags,...Im,"text","font","bounds"];te.register("Text",gs);const Rv="",Nv="",Bv="";nn.initializeTextBounds();gs.TextIO=new Ai("TextIO",{valueType:gs,supertype:tt.NodeIO,documentation:"Text that is displayed in the simulation. TextIO has a nested PropertyIO.&lt;String&gt; for the current string value."});const Fv=["canvasBounds"];class ha extends tt{constructor(e){super(e),this.setRendererBitmask(de.bitmaskCanvas)}setCanvasBounds(e){this.invalidateSelf(e)}set canvasBounds(e){this.setCanvasBounds(e)}get canvasBounds(){return this.getCanvasBounds()}getCanvasBounds(){return this.getSelfBounds()}isPainted(){return!0}invalidatePaint(){const e=this._drawables.length;for(let t=0;t<e;t++)this._drawables[t].markDirty()}canvasPaintSelf(e,t){this.paintCanvas(e.context)}containsPointSelf(e){return!1}getSelfShape(){return new kt}createCanvasDrawable(e,t){return X0.createFromPool(e,t)}mutate(e){return super.mutate(e)}}ha.prototype._mutatorKeys=Fv.concat(tt.prototype._mutatorKeys);te.register("CanvasNode",ha);const Hv=["radius"];class to extends Fi{constructor(e,t){super(null),this._radius=0,typeof e=="object"?(t=e,assert&&assert(t===void 0||Object.getPrototypeOf(t)===Object.prototype,"Extra prototype on Node options object is a code smell")):(assert&&assert(t===void 0||Object.getPrototypeOf(t)===Object.prototype,"Extra prototype on Node options object is a code smell"),t=Fa({radius:e},t)),this.mutate(t)}getStrokeRendererBitmask(){let e=super.getStrokeRendererBitmask();return this.hasStroke()&&!this.getStroke().isGradient&&!this.getStroke().isPattern&&this.getLineWidth()<=this.getRadius()&&(e|=de.bitmaskDOM),e}getPathRendererBitmask(){return de.bitmaskCanvas|de.bitmaskSVG|(ht.borderRadius?de.bitmaskDOM:0)}invalidateCircle(){assert&&assert(this._radius>=0,"A circle needs a non-negative radius"),this._shape=null,this.invalidatePath()}createCircleShape(){return kt.circle(0,0,this._radius).makeImmutable()}intersectsBoundsSelf(e){let t=Math.abs(e.centerX),i=Math.abs(e.centerY);const s=e.maxX-t,n=e.maxY-i;return t>s+this._radius||i>n+this._radius?!1:t<=s||i<=n?!0:(t-=s,i-=n,t*t+i*i<=this._radius*this._radius)}canvasPaintSelf(e,t){nf.prototype.paintCanvas(e,this,t)}createDOMDrawable(e,t){return j0.createFromPool(e,t)}createSVGDrawable(e,t){return Z0.createFromPool(e,t)}createCanvasDrawable(e,t){return nf.createFromPool(e,t)}setRadius(e){if(assert&&assert(e>=0,"A circle needs a non-negative radius"),assert&&assert(isFinite(e),"A circle needs a finite radius"),this._radius!==e){this._radius=e,this.invalidateCircle();const t=this._drawables.length;for(let i=0;i<t;i++)this._drawables[i].markDirtyRadius()}return this}set radius(e){this.setRadius(e)}get radius(){return this.getRadius()}getRadius(){return this._radius}computeShapeBounds(){let e=new $e(-this._radius,-this._radius,this._radius,this._radius);return this._stroke&&(e=e.dilated(this.getLineWidth()/2)),e}containsPointSelf(e){const t=e.x*e.x+e.y*e.y;let i=!0,s;if(this._strokePickable){s=this.getLineWidth()/2;const n=this._radius+s;i=i&&t<=n*n}if(this._fillPickable)return this._strokePickable?i:t<=this._radius*this._radius;if(this._strokePickable){const n=this._radius-s;return i&&t>=n*n}else return!1}setShape(e){if(e!==null)throw new Error("Cannot set the shape of a Circle to something non-null");return this.invalidatePath(),this}getShape(){return this._shape||(this._shape=this.createCircleShape()),this._shape}hasShape(){return!0}setShapeProperty(e){if(e!==null)throw new Error("Cannot set the shapeProperty of a Circle to something non-null, it handles this itself");return this}mutate(e){return super.mutate(e)}}to.prototype._mutatorKeys=Hv.concat(Fi.prototype._mutatorKeys);to.prototype.drawableMarkFlags=Fi.prototype.drawableMarkFlags.concat(["radius"]).filter(h=>h!=="shape");te.register("Circle",to);const Vv=["element","preventTransform","allowInput"],zv=h=>!!(h&&h.jquery);class Ll extends tt{constructor(e,t){assert&&assert(t===void 0||Object.getPrototypeOf(t)===Object.prototype,"Extra prototype on Node options object is a code smell"),assert&&assert(e instanceof self.Element||e.jquery,"DOM nodes need to be passed an HTML/DOM element or a jQuery selection like $( ... )"),zv(e)&&(e=e[0],assert&&assert(e instanceof self.Element)),super(),this._container=document.createElement("div"),this._container.style.position="absolute",this._container.style.left="0",this._container.style.top="0",this._allowInput=!1,this._$container=$(this._container),this.invalidateDOMLock=!1,this._preventTransform=!1,this.invalidateAllowInput(this._allowInput),t=Fa({element:e},t),this.mutate(t),this.setRendererBitmask(de.bitmaskDOM)}calculateDOMBounds(){const e=$(this._element);return new $e(0,0,e.width(),e.height())}invalidateDOM(){if(this.invalidateDOMLock)return;this.invalidateDOMLock=!0;const e=document.createElement("div");$(e).css({display:"hidden",padding:"0 !important",margin:"0 !important",position:"absolute",left:0,top:0,width:65535,height:65535}),this._container.removeChild(this._element),e.appendChild(this._element),document.body.appendChild(e);const t=this.calculateDOMBounds();this.invalidateSelf(t),this._$container.width(t.getWidth()),this._$container.height(t.getHeight()),document.body.removeChild(e),e.removeChild(this._element),this._container.appendChild(this._element),this.invalidateDOMLock=!1}createDOMDrawable(e,t){return $u.createFromPool(e,t)}isPainted(){return!0}setElement(e){return assert&&assert(!this._element,"We should only ever attach one DOMElement to a DOM node"),this._element!==e&&(this._element&&this._container.removeChild(this._element),this._element=e,this._container.appendChild(this._element),this.invalidateDOM()),this}set element(e){this.setElement(e)}get element(){return this.getElement()}getElement(){return this._element}setPreventTransform(e){this._preventTransform!==e&&(this._preventTransform=e)}set preventTransform(e){this.setPreventTransform(e)}get preventTransform(){return this.isTransformPrevented()}isTransformPrevented(){return this._preventTransform}setAllowInput(e){this._allowInput!==e&&(this._allowInput=e,this.invalidateAllowInput(e))}isInputAllowed(){return this._allowInput}invalidateAllowInput(e){this._container.dataset.sceneryAllowInput=e?"true":"false",this._container.style.pointerEvents=e?"auto":"none"}set allowInput(e){this.setAllowInput(e)}get allowInput(){return this.isInputAllowed()}mutate(e){return super.mutate(e)}}Ll.prototype._mutatorKeys=Vv.concat(tt.prototype._mutatorKeys);te.register("DOM",Ll);const $v=["p1","p2","x1","y1","x2","y2"];class hr extends Fi{constructor(e,t,i,s,n){super(null),this._x1=0,this._y1=0,this._x2=0,this._y2=0,typeof e=="object"?e instanceof Pe?(assert&&assert(i===void 0||typeof i=="object"),assert&&assert(i===void 0||Object.getPrototypeOf(i)===Object.prototype,"Extra prototype on Node options object is a code smell"),n=Fa({x1:e.x,y1:e.y,x2:t.x,y2:t.y,strokePickable:!0},i)):(assert&&assert(t===void 0),assert&&assert(e===void 0||Object.getPrototypeOf(e)===Object.prototype,"Extra prototype on Node options object is a code smell"),n=Fa({strokePickable:!0},e)):(assert&&assert(e!==void 0&&typeof t=="number"&&typeof i=="number"&&typeof s=="number"),assert&&assert(n===void 0||Object.getPrototypeOf(n)===Object.prototype,"Extra prototype on Node options object is a code smell"),n=Fa({x1:e,y1:t,x2:i,y2:s,strokePickable:!0},n)),this.mutate(n)}setLine(e,t,i,s){assert&&assert(e!==void 0&&t!==void 0&&i!==void 0&&s!==void 0,"parameters need to be defined"),this._x1=e,this._y1=t,this._x2=i,this._y2=s;const n=this._drawables.length;for(let o=0;o<n;o++)this._drawables[o].markDirtyLine();return this.invalidateLine(),this}setPoint1(e,t){typeof e=="number"?(assert&&assert(e!==void 0&&t!==void 0,"parameters need to be defined"),this._x1=e,this._y1=t):(assert&&assert(e.x!==void 0&&e.y!==void 0,"parameters need to be defined"),this._x1=e.x,this._y1=e.y);const i=this._drawables.length;for(let s=0;s<i;s++)this._drawables[s].markDirtyP1();return this.invalidateLine(),this}set p1(e){this.setPoint1(e)}get p1(){return new Pe(this._x1,this._y1)}setPoint2(e,t){typeof e=="number"?(assert&&assert(e!==void 0&&t!==void 0,"parameters need to be defined"),this._x2=e,this._y2=t):(assert&&assert(e.x!==void 0&&e.y!==void 0,"parameters need to be defined"),this._x2=e.x,this._y2=e.y);const i=this._drawables.length;for(let s=0;s<i;s++)this._drawables[s].markDirtyP2();return this.invalidateLine(),this}set p2(e){this.setPoint2(e)}get p2(){return new Pe(this._x2,this._y2)}setX1(e){if(this._x1!==e){this._x1=e;const t=this._drawables.length;for(let i=0;i<t;i++)this._drawables[i].markDirtyX1();this.invalidateLine()}return this}set x1(e){this.setX1(e)}get x1(){return this.getX1()}getX1(){return this._x1}setY1(e){if(this._y1!==e){this._y1=e;const t=this._drawables.length;for(let i=0;i<t;i++)this._drawables[i].markDirtyY1();this.invalidateLine()}return this}set y1(e){this.setY1(e)}get y1(){return this.getY1()}getY1(){return this._y1}setX2(e){if(this._x2!==e){this._x2=e;const t=this._drawables.length;for(let i=0;i<t;i++)this._drawables[i].markDirtyX2();this.invalidateLine()}return this}set x2(e){this.setX2(e)}get x2(){return this.getX2()}getX2(){return this._x2}setY2(e){if(this._y2!==e){this._y2=e;const t=this._drawables.length;for(let i=0;i<t;i++)this._drawables[i].markDirtyY2();this.invalidateLine()}return this}set y2(e){this.setY2(e)}get y2(){return this.getY2()}getY2(){return this._y2}createLineShape(){return kt.lineSegment(this._x1,this._y1,this._x2,this._y2).makeImmutable()}invalidateLine(){assert&&assert(isFinite(this._x1),`A line needs to have a finite x1 (${this._x1})`),assert&&assert(isFinite(this._y1),`A line needs to have a finite y1 (${this._y1})`),assert&&assert(isFinite(this._x2),`A line needs to have a finite x2 (${this._x2})`),assert&&assert(isFinite(this._y2),`A line needs to have a finite y2 (${this._y2})`),this._shape=null,this.invalidatePath()}containsPointSelf(e){return this._strokePickable?super.containsPointSelf(e):!1}canvasPaintSelf(e,t){af.prototype.paintCanvas(e,this,t)}computeShapeBounds(){if(this._stroke){const e=this.getLineCap(),t=this.getLineWidth()/2;if(e==="round")return new $e(Math.min(this._x1,this._x2)-t,Math.min(this._y1,this._y2)-t,Math.max(this._x1,this._x2)+t,Math.max(this._y1,this._y2)+t);{const i=this._x2-this._x1,s=this._y2-this._y1,n=Math.sqrt(i*i+s*s);if(n===0)return new $e(this._x1-t,this._y1-t,this._x2+t,this._y2+t);const o=t*i/n,c=t*s/n,p=$e.NOTHING.copy();return e==="butt"?(p.addCoordinates(this._x1-c,this._y1+o),p.addCoordinates(this._x1+c,this._y1-o),p.addCoordinates(this._x2-c,this._y2+o),p.addCoordinates(this._x2+c,this._y2-o)):(assert&&assert(e==="square"),p.addCoordinates(this._x1-o-c,this._y1-c+o),p.addCoordinates(this._x1-o+c,this._y1-c-o),p.addCoordinates(this._x2+o-c,this._y2+c+o),p.addCoordinates(this._x2+o+c,this._y2+c-o)),p}}else{const e=$e.NOTHING.copy();return e.addCoordinates(this._x1,this._y1),e.addCoordinates(this._x2,this._y2),e}}createSVGDrawable(e,t){return nP.createFromPool(e,t)}createCanvasDrawable(e,t){return af.createFromPool(e,t)}setShape(e){if(e!==null)throw new Error("Cannot set the shape of a Line to something non-null");return this.invalidatePath(),this}getShape(){return this._shape||(this._shape=this.createLineShape()),this._shape}hasShape(){return!0}setShapeProperty(e){if(e!==null)throw new Error("Cannot set the shapeProperty of a Line to something non-null, it handles this itself");return this}mutate(e){return super.mutate(e)}getFillRendererBitmask(){return de.bitmaskCanvas|de.bitmaskSVG|de.bitmaskDOM|de.bitmaskWebGL}}hr.prototype._mutatorKeys=$v.concat(Fi.prototype._mutatorKeys);hr.prototype.drawableMarkFlags=Fi.prototype.drawableMarkFlags.concat(["line","p1","p2","x1","x2","y1","y2"]).filter(h=>h!=="shape");te.register("Line",hr);const Gv=["rectBounds","rectSize","rectX","rectY","rectWidth","rectHeight","cornerRadius","cornerXRadius","cornerYRadius"],Em=$h(Fi);class $i extends Em{constructor(e,t,i,s,n,o,c){const p={sizable:!1};super(null,p);let f={};this._rectX=0,this._rectY=0,this._rectWidth=0,this._rectHeight=0,this._cornerXRadius=0,this._cornerYRadius=0,typeof e=="object"?e instanceof $e?typeof t!="number"?(assert&&assert(arguments.length===1||arguments.length===2,"new Rectangle( bounds, { ... } ) should only take one or two arguments"),assert&&assert(t===void 0||typeof t=="object","new Rectangle( bounds, { ... } ) second parameter should only ever be an options object"),assert&&assert(t===void 0||Object.getPrototypeOf(t)===Object.prototype,"Extra prototype on Node options object is a code smell"),assert&&t&&(assert(t.rectWidth===void 0,"Should not specify rectWidth in multiple ways"),assert(t.rectHeight===void 0,"Should not specify rectHeight in multiple ways"),assert(t.rectBounds===void 0,"Should not specify rectBounds in multiple ways")),f=_i(f,{rectBounds:e},t)):(assert&&assert(arguments.length===3||arguments.length===4,"new Rectangle( bounds, cornerXRadius, cornerYRadius, { ... } ) should only take three or four arguments"),assert&&assert(s===void 0||typeof s=="object","new Rectangle( bounds, cornerXRadius, cornerYRadius, { ... } ) fourth parameter should only ever be an options object"),assert&&assert(s===void 0||Object.getPrototypeOf(s)===Object.prototype,"Extra prototype on Node options object is a code smell"),assert&&s&&(assert(s.rectWidth===void 0,"Should not specify rectWidth in multiple ways"),assert(s.rectHeight===void 0,"Should not specify rectHeight in multiple ways"),assert(s.rectBounds===void 0,"Should not specify rectBounds in multiple ways"),assert(s.cornerXRadius===void 0,"Should not specify cornerXRadius in multiple ways"),assert(s.cornerYRadius===void 0,"Should not specify cornerYRadius in multiple ways"),assert(s.cornerRadius===void 0,"Should not specify cornerRadius in multiple ways")),f=_i(f,{rectBounds:e,cornerXRadius:t,cornerYRadius:i},s)):f=_i(f,e):o===void 0?(assert&&assert(arguments.length===4||arguments.length===5,"new Rectangle( x, y, width, height, { ... } ) should only take four or five arguments"),assert&&assert(n===void 0||typeof n=="object","new Rectangle( x, y, width, height, { ... } ) fifth parameter should only ever be an options object"),assert&&assert(n===void 0||Object.getPrototypeOf(n)===Object.prototype,"Extra prototype on Node options object is a code smell"),assert&&n&&(assert(n.rectX===void 0,"Should not specify rectX in multiple ways"),assert(n.rectY===void 0,"Should not specify rectY in multiple ways"),assert(n.rectWidth===void 0,"Should not specify rectWidth in multiple ways"),assert(n.rectHeight===void 0,"Should not specify rectHeight in multiple ways"),assert(n.rectBounds===void 0,"Should not specify rectBounds in multiple ways")),f=_i(f,{rectX:e,rectY:t,rectWidth:i,rectHeight:s},n)):(assert&&assert(arguments.length===6||arguments.length===7,"new Rectangle( x, y, width, height, cornerXRadius, cornerYRadius{ ... } ) should only take six or seven arguments"),assert&&assert(f===void 0||typeof f=="object","new Rectangle( x, y, width, height, cornerXRadius, cornerYRadius{ ... } ) seventh parameter should only ever be an options object"),assert&&assert(f===void 0||Object.getPrototypeOf(f)===Object.prototype,"Extra prototype on Node options object is a code smell"),assert&&c&&(assert(c.rectX===void 0,"Should not specify rectX in multiple ways"),assert(c.rectY===void 0,"Should not specify rectY in multiple ways"),assert(c.rectWidth===void 0,"Should not specify rectWidth in multiple ways"),assert(c.rectHeight===void 0,"Should not specify rectHeight in multiple ways"),assert(c.rectBounds===void 0,"Should not specify rectBounds in multiple ways"),assert(c.cornerXRadius===void 0,"Should not specify cornerXRadius in multiple ways"),assert(c.cornerYRadius===void 0,"Should not specify cornerYRadius in multiple ways"),assert(c.cornerRadius===void 0,"Should not specify cornerRadius in multiple ways")),f=_i(f,{rectX:e,rectY:t,rectWidth:i,rectHeight:s,cornerXRadius:n,cornerYRadius:o},c)),this.localPreferredWidthProperty.lazyLink(this.updatePreferredSizes.bind(this)),this.localPreferredHeightProperty.lazyLink(this.updatePreferredSizes.bind(this)),this.localMinimumWidthProperty.lazyLink(this.updatePreferredSizes.bind(this)),this.localMinimumHeightProperty.lazyLink(this.updatePreferredSizes.bind(this)),this.mutate(f)}getMaximumArcSize(){return Math.min(this._rectWidth/2,this._rectHeight/2)}getStrokeRendererBitmask(){let e=super.getStrokeRendererBitmask();const t=this.getStroke();return t&&!(t instanceof Vs)&&!(t instanceof Hr)&&!this.hasLineDash()&&(this.getLineJoin()==="miter"||this.getLineJoin()==="round"&&ht.borderRadius)&&(e|=de.bitmaskDOM),this.hasStroke()||(e|=de.bitmaskWebGL),e}getPathRendererBitmask(){let e=de.bitmaskCanvas|de.bitmaskSVG;const t=this.getMaximumArcSize();return(!this.hasStroke()||this.getLineWidth()<=this._rectHeight&&this.getLineWidth()<=this._rectWidth)&&(!this.isRounded()||ht.borderRadius&&this._cornerXRadius===this._cornerYRadius)&&this._cornerYRadius<=t&&this._cornerXRadius<=t&&(e|=de.bitmaskDOM),!this.hasStroke()&&!this.isRounded()&&(e|=de.bitmaskWebGL),e}setRect(e,t,i,s,n,o){const c=n!==void 0,p=o!==void 0;if(assert&&assert(isFinite(e)&&isFinite(t)&&isFinite(i)&&isFinite(s),"x/y/width/height should be finite numbers"),assert&&assert(!c||isFinite(n)&&(!p||isFinite(o)),"Corner radii (if provided) should be finite numbers"),this._rectX===e&&this._rectY===t&&this._rectWidth===i&&this._rectHeight===s&&(!c||this._cornerXRadius===n)&&(!p||this._cornerYRadius===o))return this;this._rectX=e,this._rectY=t,this._rectWidth=i,this._rectHeight=s,this._cornerXRadius=c?n:this._cornerXRadius,this._cornerYRadius=p?o:this._cornerYRadius;const f=this._drawables.length;for(let w=0;w<f;w++)this._drawables[w].markDirtyRectangle();return this.invalidateRectangle(),this}setRectX(e){if(assert&&assert(isFinite(e),"rectX should be a finite number"),this._rectX!==e){this._rectX=e;const t=this._drawables.length;for(let i=0;i<t;i++)this._drawables[i].markDirtyX();this.invalidateRectangle()}return this}set rectX(e){this.setRectX(e)}get rectX(){return this.getRectX()}getRectX(){return this._rectX}setRectY(e){if(assert&&assert(isFinite(e),"rectY should be a finite number"),this._rectY!==e){this._rectY=e;const t=this._drawables.length;for(let i=0;i<t;i++)this._drawables[i].markDirtyY();this.invalidateRectangle()}return this}set rectY(e){this.setRectY(e)}get rectY(){return this.getRectY()}getRectY(){return this._rectY}setRectWidth(e){if(assert&&assert(isFinite(e),"rectWidth should be a finite number"),this._rectWidth!==e){this._rectWidth=e;const t=this._drawables.length;for(let i=0;i<t;i++)this._drawables[i].markDirtyWidth();this.invalidateRectangle()}return this}set rectWidth(e){this.setRectWidth(e)}get rectWidth(){return this.getRectWidth()}getRectWidth(){return this._rectWidth}setRectHeight(e){if(assert&&assert(isFinite(e),"rectHeight should be a finite number"),this._rectHeight!==e){this._rectHeight=e;const t=this._drawables.length;for(let i=0;i<t;i++)this._drawables[i].markDirtyHeight();this.invalidateRectangle()}return this}set rectHeight(e){this.setRectHeight(e)}get rectHeight(){return this.getRectHeight()}getRectHeight(){return this._rectHeight}setCornerXRadius(e){if(assert&&assert(isFinite(e),"cornerXRadius should be a finite number"),this._cornerXRadius!==e){this._cornerXRadius=e;const t=this._drawables.length;for(let i=0;i<t;i++)this._drawables[i].markDirtyCornerXRadius();this.invalidateRectangle()}return this}set cornerXRadius(e){this.setCornerXRadius(e)}get cornerXRadius(){return this.getCornerXRadius()}getCornerXRadius(){return this._cornerXRadius}setCornerYRadius(e){if(assert&&assert(isFinite(e),"cornerYRadius should be a finite number"),this._cornerYRadius!==e){this._cornerYRadius=e;const t=this._drawables.length;for(let i=0;i<t;i++)this._drawables[i].markDirtyCornerYRadius();this.invalidateRectangle()}return this}set cornerYRadius(e){this.setCornerYRadius(e)}get cornerYRadius(){return this.getCornerYRadius()}getCornerYRadius(){return this._cornerYRadius}setRectBounds(e){return this.setRect(e.x,e.y,e.width,e.height),this}set rectBounds(e){this.setRectBounds(e)}get rectBounds(){return this.getRectBounds()}getRectBounds(){return $e.rect(this._rectX,this._rectY,this._rectWidth,this._rectHeight)}setRectSize(e){return this.setRectWidth(e.width),this.setRectHeight(e.height),this}set rectSize(e){this.setRectSize(e)}get rectSize(){return this.getRectSize()}getRectSize(){return new In(this._rectWidth,this._rectHeight)}setRectWidthFromRight(e){if(this._rectWidth!==e){const t=this._rectX+this._rectWidth;this.setRectWidth(e),this.setRectX(t-e)}return this}set rectWidthFromRight(e){this.setRectWidthFromRight(e)}get rectWidthFromRight(){return this.getRectWidth()}setRectHeightFromBottom(e){if(this._rectHeight!==e){const t=this._rectY+this._rectHeight;this.setRectHeight(e),this.setRectY(t-e)}return this}set rectHeightFromBottom(e){this.setRectHeightFromBottom(e)}get rectHeightFromBottom(){return this.getRectHeight()}isRounded(){return this._cornerXRadius!==0&&this._cornerYRadius!==0}computeShapeBounds(){let e=new $e(this._rectX,this._rectY,this._rectX+this._rectWidth,this._rectY+this._rectHeight);return this._stroke&&(e=e.dilated(this.getLineWidth()/2)),e}createRectangleShape(){if(this.isRounded()){const e=Math.min(this._rectWidth/2,this._rectHeight/2);return kt.roundRectangle(this._rectX,this._rectY,this._rectWidth,this._rectHeight,Math.min(e,this._cornerXRadius),Math.min(e,this._cornerYRadius)).makeImmutable()}else return kt.rectangle(this._rectX,this._rectY,this._rectWidth,this._rectHeight).makeImmutable()}invalidateRectangle(){assert&&assert(isFinite(this._rectX),`A rectangle needs to have a finite x (${this._rectX})`),assert&&assert(isFinite(this._rectY),`A rectangle needs to have a finite y (${this._rectY})`),assert&&assert(this._rectWidth>=0&&isFinite(this._rectWidth),`A rectangle needs to have a non-negative finite width (${this._rectWidth})`),assert&&assert(this._rectHeight>=0&&isFinite(this._rectHeight),`A rectangle needs to have a non-negative finite height (${this._rectHeight})`),assert&&assert(this._cornerXRadius>=0&&isFinite(this._cornerXRadius),`A rectangle needs to have a non-negative finite arcWidth (${this._cornerXRadius})`),assert&&assert(this._cornerYRadius>=0&&isFinite(this._cornerYRadius),`A rectangle needs to have a non-negative finite arcHeight (${this._cornerYRadius})`),this._shape=null,this.invalidatePath(),this.invalidateSupportedRenderers()}updatePreferredSizes(){let e=this.localPreferredWidth,t=this.localPreferredHeight;e!==null&&(e=Math.max(e,this.localMinimumWidth||0)),t!==null&&(t=Math.max(t,this.localMinimumHeight||0)),e!==null&&(this.rectWidth=this.hasStroke()?e-this.lineWidth:e),t!==null&&(this.rectHeight=this.hasStroke()?t-this.lineWidth:t)}invalidateStroke(){super.invalidateStroke(),this.updatePreferredSizes()}containsPointSelf(e){const t=this._rectX,i=this._rectY,s=this._rectWidth,n=this._rectHeight,o=this._cornerXRadius,c=this._cornerYRadius,p=this.getLineWidth()/2;let f=!0;if(this._strokePickable){const w=this.isRounded();if(!w&&this.getLineJoin()==="bevel")return super.containsPointSelf(e);const O=this.getLineJoin()==="miter"&&!w;f=f&&$i.intersects(t-p,i-p,s+2*p,n+2*p,O?0:o+p,O?0:c+p,e)}return this._fillPickable?this._strokePickable?f:$i.intersects(t,i,s,n,o,c,e):this._strokePickable?f&&!$i.intersects(t+p,i+p,s-2*p,n-2*p,o-p,c-p,e):!1}intersectsBoundsSelf(e){return!this.computeShapeBounds().intersection(e).isEmpty()}canvasPaintSelf(e,t){lf.prototype.paintCanvas(e,this,t)}createDOMDrawable(e,t){return oP.createFromPool(e,t)}createSVGDrawable(e,t){return hP.createFromPool(e,t)}createCanvasDrawable(e,t){return lf.createFromPool(e,t)}createWebGLDrawable(e,t){return uP.createFromPool(e,t)}setShape(e){if(e!==null)throw new Error("Cannot set the shape of a Rectangle to something non-null");return this.invalidatePath(),this}getShape(){return this._shape||(this._shape=this.createRectangleShape()),this._shape}hasShape(){return!0}setShapeProperty(e){if(e!==null)throw new Error("Cannot set the shapeProperty of a Rectangle to something non-null, it handles this itself");return this}setCornerRadius(e){return this.setCornerXRadius(e),this.setCornerYRadius(e),this}set cornerRadius(e){this.setCornerRadius(e)}get cornerRadius(){return this.getCornerRadius()}getCornerRadius(){return assert&&assert(this._cornerXRadius===this._cornerYRadius,"getCornerRadius() invalid if x/y radii are different"),this._cornerXRadius}mutate(e){return super.mutate(e)}static intersects(e,t,i,s,n,o,c){const p=c.x>=e&&c.x<=e+i&&c.y>=t&&c.y<=t+s;if(!p||n<=0||o<=0)return p;const f=Math.min(i/2,s/2);n=Math.min(f,n),o=Math.min(f,o);let w,O,T=!1;if(c.x<e+i/2?(w=e+n,T=T||c.x>=w):(w=e+i-n,T=T||c.x<=w),T||(c.y<t+s/2?(O=t+o,T=T||c.y>=O):(O=t+s-o,T=T||c.y<=O),T))return!0;let z=c.x-w,U=c.y-O;return z/=n,U/=o,z*=z,U*=U,z+U<=1}static rect(e,t,i,s,n){return new $i(e,t,i,s,0,0,n)}static roundedRect(e,t,i,s,n,o,c){return new $i(e,t,i,s,n,o,c)}static bounds(e,t){return new $i(e.minX,e.minY,e.width,e.height,t)}static roundedBounds(e,t,i,s){return new $i(e.minX,e.minY,e.width,e.height,t,i,s)}static dimension(e,t){return new $i(0,0,e.width,e.height,0,0,t)}}$i.prototype._mutatorKeys=[...Gv,...Em.prototype._mutatorKeys];$i.prototype.drawableMarkFlags=Fi.prototype.drawableMarkFlags.concat(["x","y","width","height","cornerXRadius","cornerYRadius"]).filter(h=>h!=="shape");te.register("Rectangle",$i);class yd extends tt{constructor(e){const t=st()({sprites:[],spriteInstances:[],hitTestSprites:!1,renderer:"webgl"},e);super(),this._sprites=t.sprites,this._spriteInstances=t.spriteInstances,this._hitTestSprites=t.hitTestSprites,this.setRendererBitmask(de.bitmaskCanvas|de.bitmaskWebGL),this.mutate(t)}setCanvasBounds(e){this.invalidateSelf(e)}set canvasBounds(e){this.setCanvasBounds(e)}get canvasBounds(){return this.getCanvasBounds()}getCanvasBounds(){return this.getSelfBounds()}canvasPaintSelf(e,t){hf.prototype.paintCanvas(e,this,t)}createCanvasDrawable(e,t){return hf.createFromPool(e,t)}createWebGLDrawable(e,t){return dP.createFromPool(e,t)}containsPointSelf(e){return super.containsPointSelf(e)?this._hitTestSprites?!!this.getSpriteInstanceFromPoint(e):!0:!1}getSpriteInstanceFromPoint(e){for(let t=this._spriteInstances.length-1;t>=0;t--)if(this._spriteInstances[t].containsPoint(e))return this._spriteInstances[t];return null}getSelfShape(){return this._hitTestSprites?kt.union(this._spriteInstances.map(e=>e.getShape())):kt.bounds(this.selfBounds)}isPainted(){return!0}invalidatePaint(){const e=this._drawables.length;for(let t=0;t<e;t++)this._drawables[t].markDirty()}mutate(e){return super.mutate(e)}}yd.prototype._mutatorKeys=["canvasBounds"].concat(tt.prototype._mutatorKeys);te.register("Sprites",yd);const Wv=["canvasBounds"],Eh=class Eh extends tt{constructor(e,t){super(t),this.setRendererBitmask(de.bitmaskWebGL),this.painterType=e}setCanvasBounds(e){return this.invalidateSelf(e),this}set canvasBounds(e){this.setCanvasBounds(e)}get canvasBounds(){return this.getCanvasBounds()}getCanvasBounds(){return this.getSelfBounds()}isPainted(){return!0}invalidatePaint(){const e=this._drawables.length;for(let t=0;t<e;t++)this._drawables[t].markDirty()}containsPointSelf(e){return!1}getSelfShape(){return new kt}canvasPaintSelf(e,t){assert&&assert(!1,"unimplemented: canvasPaintSelf in WebGLNode")}renderToCanvasSelf(e,t){const i=e.canvas.width,s=e.canvas.height,n=document.createElement("canvas");n.width=i,n.height=s;const o={antialias:!0,preserveDrawingBuffer:!0},c=n.getContext("webgl",o)||n.getContext("experimental-webgl",o);Yt.applyWebGLContextDefaults(c);const p=new Ze().rowMajor(2/i,0,-1,0,-2/s,1,0,0,1);c.viewport(0,0,i,s);const f=this.painterType,w=new f(c,this);w.paint(t,p),w.dispose(),p.freeToPool(),c.flush(),e.context.setTransform(1,0,0,1,0,0),e.context.drawImage(n,0,0),e.context.restore()}createWebGLDrawable(e,t){return yP.createFromPool(e,t)}mutate(e){return super.mutate(e)}};Eh.PAINTED_NOTHING=0,Eh.PAINTED_SOMETHING=1;let Gn=Eh;Gn.prototype._mutatorKeys=Wv.concat(tt.prototype._mutatorKeys);te.register("WebGLNode",Gn);class Uv extends $i{constructor(e){super(-2e3,-2e3,6e3,6e3,e)}}te.register("Plane",Uv);const km=ns(h=>class extends h{constructor(...t){super(...t)}insertChild(t,i){throw new Error("Attempt to insert child into Leaf")}removeChildWithIndex(t,i){throw new Error("Attempt to remove child from Leaf")}});te.register("Leaf",km);class bd extends km(tt){constructor(e,t,i){assert&&assert(isFinite(e),"width should be a finite number"),assert&&assert(isFinite(t),"height should be a finite number"),super(),this.localBounds=new $e(0,0,e,t),this.mutate(i)}}te.register("Spacer",bd);class Yv extends bd{constructor(e,t){super(e,0,t)}}te.register("HStrut",Yv);class Kv extends bd{constructor(e,t){super(0,e,t)}}te.register("VStrut",Kv);let qv=1;const Xv=new Pe(0,0);class jv extends Ys(Object){constructor(e,t,i){assert&&assert(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement);const s={hitTestPixels:!1,pickable:!0};ft(e)?s.imageProperty=e:s.image=e;const n=st()(s,i);super(),this.id=qv++,this.offset=t,this.pickable=n.pickable,this.shape=null,this.imageData=null,ft(e)?this.imageProperty=e:this.image=e,xl(this,Object.keys(Ys.DEFAULT_OPTIONS),n)}get width(){return this.imageWidth}get height(){return this.imageHeight}getShape(){if(!this.pickable)return new kt;if(!this.shape){if(this.hitTestPixels)if(this.ensureImageData(),this.imageData)this.shape=Ys.hitTestDataToShape(this.imageData,this.width,this.height);else return new kt;else if(this.width&&this.height)this.shape=kt.rect(0,0,this.width,this.height);else return new kt;this.shape=this.shape.transformed(Ze.translation(-this.offset.x,-this.offset.y))}return this.shape}ensureImageData(){!this.imageData&&this.width&&this.height&&(this.imageData=Ys.getHitTestData(this.image,this.width,this.height))}containsPoint(e){if(!this.pickable)return!1;const t=this.width,i=this.height;if(!t&&!i)return!1;const s=Xv.set(e).add(this.offset);return s.x<0||s.y<0||s.x>t||s.y>i?!1:this.hitTestPixels?(this.ensureImageData(),this.imageData?Ys.testHitTestData(this.imageData,t,i,s):!1):!0}}te.register("SpriteImage",jv);class Qv{constructor(e){this.imageProperty=new wi(e)}getShape(){return this.imageProperty.value.getShape()}containsPoint(e){return this.imageProperty.value.containsPoint(e)}}te.register("Sprite",Qv);class io{constructor(e){this.primary=null,this.changeCallback=e,this.notifyChangeCallback=this.notifyChanged.bind(this),this.updateSecondaryListener=this.updateSecondary.bind(this),this.secondaryPropertyCountsMap={}}setPrimary(e){e!==this.primary&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] primary update"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.detachPrimary(this.primary),this.primary=e,this.attachPrimary(e),this.notifyChangeCallback(),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop())}clean(){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] clean"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.detachPrimary(this.primary),this.primary=null,sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}updateSecondary(e,t,i){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] secondary update"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();const s=this.secondaryPropertyCountsMap[i.id];assert&&assert(s>0,"We should always be removing at least one reference");for(let n=0;n<s;n++)this.attachSecondary(e);this.notifyChangeCallback(),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}attachPrimary(e){if(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] attachPrimary"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),ft(e))sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] add Property listener"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.secondaryLazyLinkProperty(e),this.attachSecondary(e.get()),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop();else if(e instanceof qe)sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] Color changed to immutable"),e.setImmutable();else if(e instanceof Vs){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] add Gradient listeners"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();for(let t=0;t<e.stops.length;t++)this.attachPrimary(e.stops[t].color);sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}detachPrimary(e){if(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] detachPrimary"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),ft(e))sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] remove Property listener"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.secondaryUnlinkProperty(e),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop();else if(e instanceof Vs){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] remove Gradient listeners"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();for(let t=0;t<e.stops.length;t++)this.detachPrimary(e.stops[t].color);sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}attachSecondary(e){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] attachSecondary"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),e instanceof qe&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] Color set to immutable"),e.setImmutable()),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}notifyChanged(){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] changed"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.primary instanceof Vs&&this.primary.invalidateCanvasGradient(),this.changeCallback(),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}secondaryLazyLinkProperty(e){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[PaintObserver] secondaryLazyLinkProperty ${e._id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();const t=e.id;this.secondaryPropertyCountsMap[t]?this.secondaryPropertyCountsMap[t]++:(this.secondaryPropertyCountsMap[t]=1,e.lazyLink(this.updateSecondaryListener)),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}secondaryUnlinkProperty(e){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[PaintObserver] secondaryUnlinkProperty ${e._id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();const t=e.id,i=--this.secondaryPropertyCountsMap[t];assert&&assert(i>=0,"We should have had a reference before"),i===0&&(delete this.secondaryPropertyCountsMap[t],e.isDisposed||e.unlink(this.updateSecondaryListener)),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}}te.register("PaintObserver",io);class Zv extends wi{constructor(e,t){const i=ar.toColor(e),s=st()({luminanceFactor:0,valueComparisonStrategy:"equalsFunction"},t);super(i,s),this._paint=null,this._luminanceFactor=s.luminanceFactor,this._changeListener=this.invalidatePaint.bind(this),this._paintObserver=new io(this._changeListener),this.setPaint(e)}setPaint(e){assert&&assert(ar.isPaintDef(e)),this._paint=e,this._paintObserver.setPrimary(e)}set paint(e){this.setPaint(e)}get paint(){return this.getPaint()}getPaint(){return this._paint}setLuminanceFactor(e){assert&&assert(e>=-1&&e<=1),this.luminanceFactor!==e&&(this._luminanceFactor=e,this.invalidatePaint())}set luminanceFactor(e){this.setLuminanceFactor(e)}get luminanceFactor(){return this.getLuminanceFactor()}getLuminanceFactor(){return this._luminanceFactor}invalidatePaint(){this.value=ar.toColor(this._paint).colorUtilsBrightness(this._luminanceFactor)}dispose(){this.paint=null,super.dispose()}}te.register("PaintColorProperty",Zv);class Om{constructor(){this.initialize()}initialize(){this.svgBlock=null,this.fillStyle="none",this.strokeStyle="none",this.fillPaint=null,this.strokePaint=null,this.updateBaseStyle(),this.strokeDetailStyle=""}dispose(){this.releaseFillPaint(),this.releaseStrokePaint()}releaseFillPaint(){this.fillPaint&&(this.svgBlock.decrementPaint(this.fillPaint),this.fillPaint=null)}releaseStrokePaint(){this.strokePaint&&(this.svgBlock.decrementPaint(this.strokePaint),this.strokePaint=null)}updateFill(e,t){assert&&assert(this.svgBlock===e);const i=gp(t,e);t!==this.fillPaint&&(this.releaseFillPaint(),t&&t.isPaint&&(this.fillPaint=t,e.incrementPaint(t))),i!==this.fillStyle&&(this.fillStyle=i,this.updateBaseStyle())}updateStroke(e,t){assert&&assert(this.svgBlock===e);const i=gp(t,e);t!==this.strokePaint&&(this.releaseStrokePaint(),t&&t.isPaint&&(this.strokePaint=t,e.incrementPaint(t))),i!==this.strokeStyle&&(this.strokeStyle=i,this.updateBaseStyle())}updateBaseStyle(){this.baseStyle=`fill: ${this.fillStyle}; stroke: ${this.strokeStyle};`}updateStrokeDetailStyle(e){let t="";const i=e.getLineWidth();i!==1&&(t+=`stroke-width: ${i};`);const s=e.getLineCap();s!=="butt"&&(t+=`stroke-linecap: ${s};`);const n=e.getLineJoin();n!=="miter"&&(t+=`stroke-linejoin: ${n};`);const o=e.getMiterLimit();t+=`stroke-miterlimit: ${o};`,e.hasLineDash()&&(t+=`stroke-dasharray: ${e.getLineDash().join(",")};`,t+=`stroke-dashoffset: ${e.getLineDashOffset()};`),this.strokeDetailStyle=t}updateSVGBlock(e){const t=this.svgBlock;t&&(this.fillPaint&&t.decrementPaint(this.fillPaint),this.strokePaint&&t.decrementPaint(this.strokePaint)),this.svgBlock=e,this.fillPaint&&e.incrementPaint(this.fillPaint),this.strokePaint&&e.incrementPaint(this.strokePaint)}}function gp(h,e){return h?h.toCSS?h.toCSS():h.isPaint?`url(#${h.id}-${e?e.id:"noblock"})`:h:"none"}te.register("PaintSVGState",Om);const Co=new qe("transparent"),Qo=class Qo{constructor(e,t,i){this.lastColor=null,this.initialize(e,t,i)}isActiveSVGGradientStop(){return!!this.svgGradient}initialize(e,t,i){return sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] initialize: ${e.gradient.id} : ${t}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.svgGradient=e,this.color=i,this.ratio=t,this.svgElement=this.svgElement||document.createElementNS(li,"stop"),this.svgElement.setAttribute("offset",""+t),this.dirty=!0,this.update(),this.propertyListener=this.propertyListener||this.onPropertyChange.bind(this),this.colorListener=this.colorListener||this.markDirty.bind(this),ft(i)?(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] adding Property listener: ${this.svgGradient.gradient.id} : ${this.ratio}`),i.lazyLink(this.propertyListener),i.value instanceof qe&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] adding Color listener: ${this.svgGradient.gradient.id} : ${this.ratio}`),i.value.changeEmitter.addListener(this.colorListener),this.lastColor=i.value)):i instanceof qe&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] adding Color listener: ${this.svgGradient.gradient.id} : ${this.ratio}`),i.changeEmitter.addListener(this.colorListener)),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop(),this}onPropertyChange(e,t){assert&&assert(this.isActiveSVGGradientStop());const i=this;this.lastColor!==null&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] removing Color listener: ${i.svgGradient.gradient.id} : ${this.ratio}`),this.lastColor.changeEmitter.removeListener(this.colorListener),this.lastColor=null),e instanceof qe&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] adding Color listener: ${i.svgGradient.gradient.id} : ${this.ratio}`),e.changeEmitter.addListener(this.colorListener),this.lastColor=e),this.markDirty()}markDirty(){assert&&assert(this.isActiveSVGGradientStop()),this.dirty=!0,this.svgGradient.markDirty()}update(){if(!this.dirty)return;this.dirty=!1,assert&&assert(this.isActiveSVGGradientStop());const e=this;sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] update: ${e.svgGradient.gradient.id} : ${this.ratio}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();let t=this.color;ft(t)&&(t=t.value),t===null&&(t="transparent"),typeof t=="string"?Co.setCSS(t):Co.set(t);const i=`stop-opacity: ${Co.a.toFixed(20)};`;Co.alpha=1;const s=`stop-color: ${Co.toCSS()};`;this.svgElement.setAttribute("style",`${s} ${i}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}dispose(){assert&&assert(this.isActiveSVGGradientStop());const e=this;sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] dispose: ${e.svgGradient.gradient.id} : ${this.ratio}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();const t=this.color;this.lastColor&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] removing Color listener: ${e.svgGradient.gradient.id} : ${this.ratio}`),this.lastColor.changeEmitter.removeListener(this.colorListener),this.lastColor=null),ft(t)?(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] removing Property listener: ${e.svgGradient.gradient.id} : ${this.ratio}`),t.hasListener(this.propertyListener)&&t.unlink(this.propertyListener)):t instanceof qe&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] removing Color listener: ${e.svgGradient.gradient.id} : ${this.ratio}`),t.changeEmitter.removeListener(this.colorListener)),this.color=null,this.svgGradient=null,this.freeToPool(),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}freeToPool(){Qo.pool.freeToPool(this)}};Qo.pool=new qi(Qo);let lh=Qo;te.register("SVGGradientStop",lh);class _d{constructor(e,t){this.initialize(e,t)}isActiveSVGGradient(){return!!this.svgBlock}initialize(e,t){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradient] initialize ${t.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.svgBlock=e,this.gradient=t;const i=this.definition!==void 0;this.definition=this.definition||this.createDefinition(),i||this.definition.setAttribute("gradientUnits","userSpaceOnUse"),t.transformMatrix?this.definition.setAttribute("gradientTransform",t.transformMatrix.getSVGTransform()):this.definition.removeAttribute("gradientTransform");const s=t.getSVGStops();this.stops=vt(this.stops);for(let n=0;n<s.length;n++){const o=new lh(this,s[n].ratio,s[n].color);this.stops.push(o),this.definition.appendChild(o.svgElement)}this.dirty=!1,sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}markDirty(){if(!this.dirty){assert&&assert(this.isActiveSVGGradient());const e=this;sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradient] switched to dirty: ${this.gradient.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.dirty=!0,e.svgBlock.markDirtyGradient(this),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}}update(){if(this.dirty){this.dirty=!1,sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradient] update: ${this.gradient.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();for(let e=0;e<this.stops.length;e++)this.stops[e].update();sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}}dispose(){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradient] dispose ${this.gradient.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();for(let e=0;e<this.stops.length;e++){const t=this.stops[e];this.definition.removeChild(t.svgElement),t.dispose()}vt(this.stops),this.svgBlock=null,this.gradient=null,this.freeToPool(),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}}te.register("SVGGradient",_d);const Zo=class Zo extends _d{constructor(e,t){super(e,t)}initialize(e,t){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGLinearGradient] initialize ${t.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),super.initialize(e,t);const i=t;return this.definition.setAttribute("x1",""+i.start.x),this.definition.setAttribute("y1",""+i.start.y),this.definition.setAttribute("x2",""+i.end.x),this.definition.setAttribute("y2",""+i.end.y),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop(),this}createDefinition(){return document.createElementNS(li,"linearGradient")}freeToPool(){Zo.pool.freeToPool(this)}};Zo.pool=new qi(Zo);let hh=Zo;te.register("SVGLinearGradient",hh);const Jo=class Jo extends _d{constructor(e,t){super(e,t)}initialize(e,t){return sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGRadialGradient] initialize ${t.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),super.initialize(e,t),this.definition.setAttribute("cx",""+t.largePoint.x),this.definition.setAttribute("cy",""+t.largePoint.y),this.definition.setAttribute("r",""+t.maxRadius),this.definition.setAttribute("fx",""+t.focalPoint.x),this.definition.setAttribute("fy",""+t.focalPoint.y),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop(),this}createDefinition(){return document.createElementNS(li,"radialGradient")}freeToPool(){Jo.pool.freeToPool(this)}};Jo.pool=new qi(Jo);let ch=Jo;te.register("SVGRadialGradient",ch);const el=class el{constructor(e){this.initialize(e)}initialize(e){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGPattern] initialize: ${e.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();const t=this.definition!==void 0;return this.definition=this.definition||document.createElementNS(li,"pattern"),t||(this.definition.setAttribute("patternUnits","userSpaceOnUse"),this.definition.setAttribute("patternContentUnits","userSpaceOnUse")),e.transformMatrix?this.definition.setAttribute("patternTransform",e.transformMatrix.getSVGTransform()):this.definition.removeAttribute("patternTransform"),this.definition.setAttribute("x","0"),this.definition.setAttribute("y","0"),this.definition.setAttribute("width",""+e.image.width),this.definition.setAttribute("height",""+e.image.height),this.imageElement=this.imageElement||document.createElementNS(li,"image"),this.imageElement.setAttribute("x","0"),this.imageElement.setAttribute("y","0"),this.imageElement.setAttribute("width",`${e.image.width}px`),this.imageElement.setAttribute("height",`${e.image.height}px`),this.imageElement.setAttributeNS(Va,"xlink:href",e.image.src),t||this.definition.appendChild(this.imageElement),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop(),this}update(){}dispose(){this.freeToPool()}freeToPool(){el.pool.freeToPool(this)}};el.pool=new qi(el);let uh=el;te.register("SVGPattern",uh);class Mm{constructor(e,t){this._matrices=null,this._dirtyIndex=0,this._listeners=[],this._nodeTransformListeners=[];const i=st()({isStatic:!1},t);this._isStatic=i.isStatic,this.trail=e,this._nodeTransformListeners=[];for(let s=1;s<this.trail.length;s++){const n=(o=>()=>{this.onTransformChange(o)})(s-1);this._nodeTransformListeners.push(n),e.nodes[s].transformEmitter.addListener(n)}}dispose(){for(let e=1;e<this.trail.length;e++){const t=this._nodeTransformListeners[e-1];this.trail.nodes[e].transformEmitter.hasListener(t)&&this.trail.nodes[e].transformEmitter.removeListener(t)}}addListener(e){this._listeners.push(e)}removeListener(e){const t=_.indexOf(this._listeners,e);assert&&assert(t>=0,"TransformTracker listener not found"),this._listeners.splice(t,1)}notifyListeners(){let e=this._listeners;this._isStatic||(e=e.slice());const t=e.length;for(let i=0;i<t;i++)e[i]()}onTransformChange(e){this._dirtyIndex=Math.min(this._dirtyIndex,e),this.notifyListeners()}getMatrix(){if(this._matrices===null){this._matrices=[];for(let t=1;t<this.trail.length;t++)this._matrices.push(new Ze)}if(this._matrices.length<=0)return Ze.IDENTITY;const e=this._matrices.length;for(let t=this._dirtyIndex;t<e;t++){const i=this.trail.nodes[t+1].matrix;t===0?this._matrices[t].set(i):(this._matrices[t].set(this._matrices[t-1]),this._matrices[t].multiplyMatrix(i))}return this._dirtyIndex=e,this._matrices[e-1]}get matrix(){return this.getMatrix()}}te.register("TransformTracker",Mm);const pa=Mm;class Rm{constructor(e,t){t=ds({isStatic:!1},t),this.isStatic=t.isStatic,this.trail=e,this._listeners=[],this.trailVisibleProperty=new Nt(this.trail.isVisible()),this._nodeVisibilityListeners=[];for(let i=0;i<this.trail.length;i++){const s=()=>{this.trailVisibleProperty.set(e.isVisible())};this._nodeVisibilityListeners.push(s),e.nodes[i].visibleProperty.link(s)}this.boundTrailVisibilityChangedListener=this.onVisibilityChange.bind(this),this.trailVisibleProperty.link(this.boundTrailVisibilityChangedListener)}addListener(e){assert&&assert(typeof e=="function"),this._listeners.push(e)}removeListener(e){assert&&assert(typeof e=="function");const t=_.indexOf(this._listeners,e);assert&&assert(t>=0,"TrailVisibilityTracker listener not found"),this._listeners.splice(t,1)}dispose(){for(let e=0;e<this.trail.length;e++){const t=this._nodeVisibilityListeners[e];this.trail.nodes[e].visibleProperty.hasListener(t)&&this.trail.nodes[e].visibleProperty.removeListener(t)}this.trailVisibleProperty.unlink(this.boundTrailVisibilityChangedListener)}onVisibilityChange(){this.notifyListeners()}notifyListeners(){let e=this._listeners;this._isStatic||(e=e.slice());const t=e.length;for(let i=0;i<t;i++)e[i]()}}te.register("TrailVisibilityTracker",Rm);const Jv={mutateNode(h,e){e?h.setPDOMAttribute("aria-haspopup",e):(assert&&assert(h.hasPDOMAttribute("aria-haspopup"),"Set aria-haspopup once before removing it."),h.removePDOMAttribute("aria-haspopup")),h.positionInPDOM=!!e}};te.register("AriaHasPopUpMutator",Jv);class eL extends tt{constructor(e){const t=st()({headingLevel:1},e);super(t),this.tagName=`h${t.headingLevel}`,this.focusHighlight="invisible";const i={blur:()=>{this.focusable=!1}};this.addInputListener(i),this.disposeFocusableHeadingNode=()=>{this.removeInputListener(i)}}focus(){this.focusable=!0,super.focus()}dispose(){this.disposeFocusableHeadingNode(),super.dispose()}}te.register("FocusableHeadingNode",eL);const Cs=" ",Jl="End of Document",Bn=",",To=15,Ts="NEXT",ta="PREVIOUS";class tL{constructor(e){const t=this;this.outputUtteranceProperty=new wi(new xo(document.title,"off")),this.linearDOM=this.getLinearDOMElements(e),this.activeElement=null,this.activeLine=null,this.letterPosition=0,this.positionInLine=0,this.wordPosition=0,this.observers=[],this.keyState={},document.addEventListener("keydown",i=>{this.keyState[i.keyCode]=!0;let s;const o=i.shiftKey?ta:Ts;if(this.linearDOM=this.getLinearDOMElements(e),this.updateLiveElementList(),!(this.activeElement&&this.activeElement.getAttribute("role")==="application")){if(this.keyState[40]&&!this.keyState[45])s=this.readNextPreviousLine(Ts);else if(this.keyState[38]&&!this.keyState[45])s=this.readNextPreviousLine(ta);else if(this.keyState[72]){const c=["H1","H2","H3","H4","H5","H6"];s=this.readNextPreviousHeading(c,o)}else this.keyState[9]||(this.keyState[39]&&!this.keyState[17]?s=this.readNextPreviousCharacter(Ts):this.keyState[37]&&!this.keyState[17]?s=this.readNextPreviousCharacter(ta):this.keyState[37]&&this.keyState[17]?s=this.readNextPreviousWord(ta):this.keyState[39]&&this.keyState[17]?s=this.readNextPreviousWord(Ts):this.keyState[45]&&this.keyState[38]?s=this.readActiveLine():this.keyState[49]?s=this.readNextPreviousHeading(["H1"],o):this.keyState[50]?s=this.readNextPreviousHeading(["H2"],o):this.keyState[51]?s=this.readNextPreviousHeading(["H3"],o):this.keyState[52]?s=this.readNextPreviousHeading(["H4"],o):this.keyState[53]?s=this.readNextPreviousHeading(["H5"],o):this.keyState[54]?s=this.readNextPreviousHeading(["H6"],o):this.keyState[70]?s=this.readNextPreviousFormElement(o):this.keyState[66]?s=this.readNextPreviousButton(o):this.keyState[76]?s=this.readNextPreviousList(o):this.keyState[73]?s=this.readNextPreviousListItem(o):this.keyState[45]&&this.keyState[40]&&this.readEntireDocument());this.activeElement&&this.isFocusable(this.activeElement)&&this.activeElement.focus(),s===Cs&&(s="space"),s&&this.outputUtteranceProperty.set(new xo(s,"off"))}}),document.addEventListener("keyup",i=>{this.keyState[i.keyCode]=!1}),document.addEventListener("focusin",function(i){if(i.target!==t.activeElement){t.activeElement=i.target;const n=t.getAccessibleText(this.activeElement,!0);if(n){const o=t.activeElement.getAttribute("aria-live");t.outputUtteranceProperty.set(new xo(n,o))}}})}getLinearDOMElements(e){const t=e.getElementsByTagName("*"),i=[];for(let s=0;s<t.length;s++)t[s].nodeType===Node.ELEMENT_NODE&&(i[s]=t[s]);return i}getLiveRole(e){let t=null;return["log","status","alert","progressbar","marquee","timer","assertive","polite"].forEach(s=>{(e.getAttribute("aria-live")===s||e.getAttribute("role")===s)&&(t=s)}),t}getNextPreviousElement(e){this.activeElement||(this.activeElement=this.linearDOM[0]);const t=e==="NEXT"?1:-1,s=this.linearDOM.indexOf(this.activeElement)+t;return this.linearDOM[s]}getLabel(e){const t=document.getElementsByTagName("label");let i;return Array.prototype.forEach.call(t,s=>{s.getAttribute("for")&&(i=s)}),assert&&assert(i,"No label found for id"),i}getAccessibleText(e,t){let i="";if(!e)return Jl;if(e.getAttribute("class")==="ScreenView"||e.tagName==="HEADER"||e.tagName==="SECTION"||e.tagName==="LABEL")return null;let s=e;for(;s.parentElement;){if(s.getAttribute("aria-hidden")||s.hidden)return null;s=s.parentElement}if(e.tagName==="P"&&(i+=e.textContent),e.tagName==="H1"&&(i+=`Heading Level 1, ${e.textContent}`),e.tagName==="H2"&&(i+=`Heading Level 2, ${e.textContent}`),e.tagName==="H3"&&(i+=`Heading Level 3, ${e.textContent}`),e.tagName==="UL"){const n=e.children.length;i+=`List with ${n} items`}if(e.tagName==="LI"&&(i+=`List Item: ${e.textContent}`),e.tagName==="BUTTON"){const n=" Button";if(e.getAttribute("aria-pressed")){let o=" toggle";const c=" pressed",p=" not";o+=n+Bn,e.getAttribute("aria-pressed")==="true"?o+=c:o+=p+c,i+=e.textContent+Bn+o}else i+=e.textContent+n}if(e.tagName==="INPUT"&&(e.type==="reset"&&(i+=`${e.getAttribute("value")} Button`),e.type==="checkbox")){const o=this.getLabel(e.id).textContent;if(e.getAttribute("role")==="switch"){const c=e.getAttribute("aria-checked");if(c){const p=c==="true"?"On":"Off";i+=`${o+Bn+Cs}switch${Bn}${Cs}${p}`}else assert&&assert(!1,"checkbox switch must have aria-checked attribute")}else{const c=e.checked?" Checked":" Not Checked";i+=`${e.textContent} Checkbox${c}`}}if(t){i.length>0&&(i+=Bn);const n=e.getAttribute("aria-label");n&&(i+=Cs+n+Bn);const o=e.getAttribute("aria-labelledBy");if(o){const w=document.getElementById(o).textContent;i+=Cs+w+Bn}s=e;let c;for(;s.parentElement;)if(c=s.getAttribute("role"),c==="document"||c==="application"){i+=Cs+c+Bn;break}else s=s.parentElement;e.getAttribute("role")&&(c=e.getAttribute("role"),c==="button"&&(i+=`${Cs}Button`)),e.draggable&&(i+=`${Cs}draggable${Bn}`),e.getAttribute("aria-grabbed")==="true"&&(i+=`${Cs}grabbed${Bn}`);const p=e.getAttribute("aria-describedby");if(p){const f=p.split(Cs);let w,O;f.forEach(T=>{w=document.getElementById(T),O=w.textContent,i+=Cs+O})}}return i[i.length-1]===","&&(i=i.slice(0,-1)),i}getNextPreviousElementWithPDOMContent(e){let t;for(;!t;)this.activeElement=this.getNextPreviousElement(e),t=this.getAccessibleText(this.activeElement,!1);return this.activeElement}getNextPreviousElementWithRole(e,t){let i=null;const s=t===Ts?1:-1;this.activeElement||(this.activeElement=this.linearDOM[0]);let n=this.linearDOM.indexOf(this.activeElement)+s;for(;this.linearDOM[n];){for(let o=0;o<e.length;o++){const c=this.linearDOM[n].tagName,p=this.linearDOM[n].type,f=this.linearDOM[n].getAttribute("role"),w=e[o];if(c===w||f===w||p===w){i=this.linearDOM[n];break}}if(i)break;n+=s}return i}readNextPreviousLine(e){let t="";this.letterPosition=0,this.wordPosition=0,this.activeElement||(this.activeElement=this.getNextPreviousElementWithPDOMContent(e));let i=this.getAccessibleText(this.activeElement,!1).split(Cs);if(e===ta&&(this.positionInLine=this.positionInLine-2*To),!i[this.positionInLine]){this.positionInLine=0;const n=this.activeElement;this.activeElement=this.getNextPreviousElementWithPDOMContent(e),i=this.getAccessibleText(this.activeElement,!1).split(" "),this.activeElement||(this.activeElement=n)}const s=this.positionInLine+To;for(let n=this.positionInLine;n<s;n++)if(i[n])if(t+=i[n],this.positionInLine+=1,i[n+1])t+=Cs;else{this.positionInLine+=To-this.positionInLine%To;break}return this.activeLine=t,t}readActiveLine(){let e="";this.activeLine||(this.activeLine=this.readNextPreviousLine(Ts));const t=this.activeLine.split(Cs);for(let i=0;i<To;i++)if(t[i])if(e+=t[i],t[i+1])e+=Cs;else break;return e}readNextPreviousWord(e){this.activeLine||(this.activeLine=this.readNextPreviousLine(e));const t=this.activeLine.split(Cs);let i,s;e===Ts?(s=t.length,i=1):e===ta&&(s=0,i=-2),this.wordPosition===s&&(this.activeLine=this.readNextPreviousLine(e));const n=t[this.wordPosition];return this.wordPosition+=i,n}readNextPreviousHeading(e,t){let i,s,n;for(;!i;)n=this.activeElement,s=this.getNextPreviousElementWithRole(e,t),this.activeElement=s,i=this.getAccessibleText(s);if(!s){this.activeElement=n;const o=t===Ts?"more":"previous";if(e.length===1){const c=`No ${o} headings at `,p=e[0];return c+(p==="H1"?"Level 1":p==="H2"?"Level 2":p==="H3"?"Level 3":p==="H4"?"Level 4":p==="H5"?"Level 5":"Level 6")}return`No ${o} headings`}return this.activeElement=s,i}readNextPreviousButton(e){const t=["button","BUTTON","submit","reset"];let i,s,n;for(;!s;)n=this.activeElement,i=this.getNextPreviousElementWithRole(t,e),this.activeElement=i,s=this.getAccessibleText(i,!0);return i?(this.activeElement=i,s):(this.activeElement=n,`No ${e===Ts?"more":"previous"} buttons`)}readNextPreviousFormElement(e){const t=["INPUT","BUTTON"],i=["button"],s=t.concat(i);let n,o,c;for(;!o;)c=this.activeElement,n=this.getNextPreviousElementWithRole(s,e),this.activeElement=n,o=this.getAccessibleText(n,!0);return o===Jl?(this.activeElement=c,`No ${e===Ts?"next":"previous"} form field`):(this.activeElement=n,o)}readNextPreviousListItem(e){this.activeElement||(this.activeElement=this.getNextPreviousElementWithPDOMContent(e));let t;const i=this.activeElement.parentElement;if(i.tagName==="UL"||i.tagName==="OL"){const s=e===Ts?1:-1;let n=Array.prototype.indexOf.call(i.children,this.activeElement)+s;for(;i.children[n];){if(t=this.getAccessibleText(i.children[n]),t){this.activeElement=i.children[n];break}n+=s}t||(t=this.readNextPreviousList(e))}else t=this.readNextPreviousList(e);return t||`No ${e===Ts?"more":"previous"} list items`}readNextPreviousList(e){this.activeElement||(this.activeElement=this.getNextPreviousElementWithPDOMContent(e));const t=this.activeElement.parentElement;let i;(t.tagName==="UL"||t.tagName==="OL")&&(i=this.activeElement,this.activeElement=t);const s=this.getNextPreviousElementWithRole(["UL","OL"],e);if(!s)return i&&(this.activeElement=i),`No ${e===Ts?"more":"previous"} lists`;const n=this.getAccessibleText(s);let o="";const c=s.children[0];return c&&(o=this.getAccessibleText(c),this.activeElement=c),`${n}, ${o}`}readNextPreviousCharacter(e){this.activeLine||(this.activeLine=this.readNextPreviousLine(Ts));let t,i,s;e===Ts?(t=this.activeLine.length,i=1,s=0):e===ta&&(t=2,i=-1,s=-2),this.letterPosition===t&&(this.activeLine=this.readNextPreviousLine(e),this.letterPosition=this.activeLine.length);const n=this.activeLine[this.letterPosition+s];return this.letterPosition+=i,n}updateLiveElementList(){for(let e=0;e<this.observers.length;e++)this.observers[e]&&this.observers[e].disconnect();this.observers=[];for(let e=0;e<this.linearDOM.length;e++){const t=this.linearDOM[e];if(this.getLiveRole(t)){const s=c=>{c.forEach(p=>{let f,w=p.target;for(;!f;)f=this.getLiveRole(w),w=w.parentElement;if(p.addedNodes[0]){const O=p.addedNodes[0].data;this.outputUtteranceProperty.set(new xo(O,f))}})},n=new MutationObserver(c=>{s(c)}),o={childList:!0,subtree:!0};n.observe(t,o),this.observers.push(n)}}}readEntireDocument(){const e="polite";let t=this.getAccessibleText(this.activeElement),i=this.activeElement;for(;t!==Jl;)i=this.activeElement,t=this.readNextPreviousLine(Ts),t===Jl&&(this.activeElement=i),this.outputUtteranceProperty.set(new xo(t,e))}isFocusable(e){const t=["tabindex","BUTTON","INPUT"];let i=!1;return t.forEach(s=>{(e.getAttribute(s)||e.tagName===s)&&(i=!0)}),i}}te.register("Cursor",tL);let xo=class{constructor(e,t){this.text=e,this.liveRole=t}};class iL{constructor(e){this.speakingStartedEmitter=new _s({parameters:[{valueType:Object}]}),this.speakingEndedEmitter=new _s({parameters:[{valueType:Object}]}),this.speaking=!1,this.politeUtterances=[];const t=navigator.userAgent,i=t.match(/Windows/),s=!!(t.match(/Version\/[5-9]\./)&&t.match(/Safari\//)&&t.match(/AppleWebKit/));self.speechSynthesis&&SpeechSynthesisUtterance&&self.speechSynthesis.speak?(this.synth=self.speechSynthesis,e.outputUtteranceProperty.link(n=>{const o=new SpeechSynthesisUtterance(n.text);o.addEventListener("start",p=>{this.speakingStartedEmitter.emit(n)}),o.addEventListener("end",p=>{this.speakingEndedEmitter.emit(n)});let c;if(this.synth.getVoices().forEach(p=>{p.default&&(c=p)}),o.voice=c,o.rate=1.2,n.liveRole==="assertive"||n.liveRole==="off"||!n.liveRole)this.politeUtterances=[],this.speaking=!0,i?(this.synth.pause(),this.synth.cancel(),this.synth.speak(o),this.synth.resume()):(this.synth.cancel(),this.synth.speak(o));else if(n.liveRole==="polite")if(s){this.politeUtterances.push(o);const p=()=>{this.speaking=!0;const f=this.politeUtterances.shift();f?this.synth.speak(f):this.speaking=!1};if(this.speaking)setTimeout(()=>{p()},2e3);else{this.synth.speak(o);const f=this.politeUtterances.indexOf(o);f>0&&this.politeUtterances.splice(f,1)}}else this.synth.speak(o)})):e.outputUtteranceProperty.link(()=>{this.speakingStartedEmitter.emit({text:"Sorry! Web Speech API not supported on this platform."})})}}te.register("Reader",iL);const sL=[],pp=!1,tl=class tl extends Xa{constructor(e,t){var s;const i=st()({parameters:sL,phetioOuterType:tl.PhetioActionIO,phetioState:pp,phetioReadOnly:Hi.DEFAULT_OPTIONS.phetioReadOnly,phetioHighFrequency:Hi.DEFAULT_OPTIONS.phetioHighFrequency,phetioEventType:Hi.DEFAULT_OPTIONS.phetioEventType,phetioDocumentation:"A class that wraps a function, adding API to execute that function and data stream capture."},t);super(i),this.action=e,this.isExecutingCount=0,this.disposeOnExecuteCompletion=!1,this.executedEmitter=new _s({parameters:i.parameters,tandem:(s=i.tandem)==null?void 0:s.createTandem("executedEmitter"),hasListenerOrderDependencies:i.hasListenerOrderDependencies,phetioState:i.phetioState,phetioReadOnly:i.phetioReadOnly,phetioHighFrequency:i.phetioHighFrequency,phetioEventType:i.phetioEventType,phetioDocumentation:"Emitter that emits when this actions work is complete"}),this.disposePhetioAction=()=>{this.executedEmitter.dispose()}}execute(...e){assert&&assert(!this.isDisposed,"should not be called if disposed"),assert&&assert(!this.executedEmitter.isDisposed,"self should not be disposed"),this.isExecutingCount++,assert&&super.validateArguments(...e),ai.PHET_IO_ENABLED&&this.isPhetioInstrumented()&&this.phetioStartEvent("executed",{data:this.getPhetioData(...e)}),this.action.apply(null,e),this.executedEmitter.emit(...e),ai.PHET_IO_ENABLED&&this.isPhetioInstrumented()&&this.phetioEndEvent(),this.isExecutingCount--,this.disposeOnExecuteCompletion&&this.isExecutingCount===0&&(this.disposePhetioAction(),this.disposeOnExecuteCompletion=!1)}dispose(){this.isExecutingCount>0?this.disposeOnExecuteCompletion=!0:this.disposePhetioAction(),super.dispose()}};tl.PhetioActionIO=e=>{const t=e.map(fp).join(",");return zc.has(t)||zc.set(t,new Ai(`PhetioActionIO<${e.map(fp).join(", ")}>`,{valueType:tl,documentation:"Executes when an event occurs",events:["executed"],parameterTypes:e,metadataDefaults:{phetioState:pp},methods:{execute:{returnType:rn,parameterTypes:e,implementation:function(...i){this.execute(...i)},documentation:"Executes the function the PhetioAction is wrapping.",invocableForReadOnlyElements:!1},getValidationErrors:{returnType:Tl(Ft(Ti)),parameterTypes:e,implementation:function(...i){return this.getValidationErrors(...i)},documentation:"Checks to see if the proposed values are valid. Returns an array of length N where each element is an error (string) or null if the value is valid."}}})),zc.get(t)};let dh=tl;const fp=h=>h.typeName,zc=new ao;Wr.register("PhetioAction",dh);const qt=dh;class Nm{constructor(e){var i,s;this.keyState={},this._lastKeyDown=null,this.attachedToDocument=!1,this.documentKeyupListener=null,this.documentKeydownListener=null,this.documentBlurListener=null,this._enabled=!0,this.keydownEmitter=new _s({parameters:[{valueType:KeyboardEvent}]}),this.keyupEmitter=new _s({parameters:[{valueType:KeyboardEvent}]}),this.keyDownStateChangedEmitter=new _s({parameters:[{valueType:[KeyboardEvent,null]}]}),this.keydownUpdateAction=new qt(n=>{const o=Se.getEventCode(n);if(o){if(this.correctModifierKeys(n),assert&&!Se.isShiftKey(n)&&assert(n.shiftKey===this.shiftKeyDown,"shift key inconsistency between event and keyState."),assert&&!Se.isAltKey(n)&&assert(n.altKey===this.altKeyDown,"alt key inconsistency between event and keyState."),assert&&!Se.isControlKey(n)&&assert(n.ctrlKey===this.ctrlKeyDown,"ctrl key inconsistency between event and keyState."),assert&&!Se.isMetaKey(n)&&assert(n.metaKey===this.metaKeyDown,"meta key inconsistency between event and keyState."),!this.isKeyDown(o)){const c=Se.getEventCode(n);assert&&assert(c,"Could not find key from domEvent"),this.keyState[c]={key:c,timeDown:0}}this._lastKeyDown=o,this.keydownEmitter.emit(n),this.keyDownStateChangedEmitter.emit(n)}},{phetioPlayback:!0,tandem:(i=e==null?void 0:e.tandem)==null?void 0:i.createTandem("keydownUpdateAction"),parameters:[{name:"event",phetioType:Br}],phetioEventType:si.USER,phetioDocumentation:"Action that executes whenever a keydown occurs from the input listeners this keyStateTracker adds (most likely to the document)."}),this.keyupUpdateAction=new qt(n=>{const o=Se.getEventCode(n);o&&(this.correctModifierKeys(n),this.isKeyDown(o)&&delete this.keyState[o],Ui.mac&&Se.isMetaKey(n)&&this.clearState(!0),this.keyupEmitter.emit(n),this.keyDownStateChangedEmitter.emit(n))},{phetioPlayback:!0,tandem:(s=e==null?void 0:e.tandem)==null?void 0:s.createTandem("keyupUpdateAction"),parameters:[{name:"event",phetioType:Br}],phetioEventType:si.USER,phetioDocumentation:"Action that executes whenever a keyup occurs from the input listeners this keyStateTracker adds (most likely to the document)."});const t=this.step.bind(this);Wi.addListener(t),this.disposeKeyStateTracker=()=>{Wi.removeListener(t),this.attachedToDocument&&this.detachFromDocument()}}keydownUpdate(e){this.enabled&&this.keydownUpdateAction.execute(e)}correctModifierKeys(e){const t=Se.getEventCode(e);assert&&assert(t,"key not found from domEvent");let i=!1;e.shiftKey&&!Se.isShiftKey(e)&&!this.shiftKeyDown&&(i=i||!this.keyState[Se.KEY_SHIFT_LEFT],this.keyState[Se.KEY_SHIFT_LEFT]={key:t,timeDown:0}),e.altKey&&!Se.isAltKey(e)&&!this.altKeyDown&&(i=i||!this.keyState[Se.KEY_ALT_LEFT],this.keyState[Se.KEY_ALT_LEFT]={key:t,timeDown:0}),e.ctrlKey&&!Se.isControlKey(e)&&!this.ctrlKeyDown&&(i=i||!this.keyState[Se.KEY_CONTROL_LEFT],this.keyState[Se.KEY_CONTROL_LEFT]={key:t,timeDown:0}),e.metaKey&&!Se.isMetaKey(e)&&!this.metaKeyDown&&(i=i||!this.keyState[Se.KEY_META_LEFT],this.keyState[Se.KEY_META_LEFT]={key:t,timeDown:0}),!e.shiftKey&&this.shiftKeyDown&&(i=i||!!this.keyState[Se.KEY_SHIFT_LEFT]||!!this.keyState[Se.KEY_SHIFT_RIGHT],delete this.keyState[Se.KEY_SHIFT_LEFT],delete this.keyState[Se.KEY_SHIFT_RIGHT]),!e.altKey&&this.altKeyDown&&(i=i||!!this.keyState[Se.KEY_ALT_LEFT]||!!this.keyState[Se.KEY_ALT_RIGHT],delete this.keyState[Se.KEY_ALT_LEFT],delete this.keyState[Se.KEY_ALT_RIGHT]),!e.ctrlKey&&this.ctrlKeyDown&&(i=i||!!this.keyState[Se.KEY_CONTROL_LEFT]||!!this.keyState[Se.KEY_CONTROL_RIGHT],delete this.keyState[Se.KEY_CONTROL_LEFT],delete this.keyState[Se.KEY_CONTROL_RIGHT]),!e.metaKey&&this.metaKeyDown&&(i=i||Se.META_KEYS.some(s=>!!this.keyState[s]),Se.META_KEYS.forEach(s=>{delete this.keyState[s]})),i&&this.keyDownStateChangedEmitter.emit(e)}keyupUpdate(e){this.enabled&&this.keyupUpdateAction.execute(e)}get movementKeysDown(){return this.isAnyKeyInListDown(Se.MOVEMENT_KEYS)}getLastKeyDown(){return this._lastKeyDown}isKeyDown(e){return!!this.keyState[e]}isEnglishKeyDown(e){return this.isAnyKeyInListDown(za[e])}getKeysDown(){return Object.keys(this.keyState)}getEnglishKeysDown(){const e=new Set;for(const t of this.getKeysDown()){const i=Xf(t);i&&e.add(i)}return e}isAnyKeyInListDown(e){for(let t=0;t<e.length;t++)if(this.isKeyDown(e[t]))return!0;return!1}areKeysDown(e){for(let i=0;i<e.length;i++)if(!this.isKeyDown(e[i]))return!1;return!0}areKeysExclusivelyDown(e){const t=Object.keys(this.keyState);if(t.length!==e.length)return!1;let i=!0;for(let s=0;s<e.length;s++){const n=e[s];let o=[n];Se.isModifierKey(n)&&(o=Se.MODIFIER_KEY_TO_CODE_MAP.get(n)),_.intersection(t,o).length===0&&(i=!1)}return i}areKeysDownWithoutExtraModifiers(e){for(let t=0;t<Se.MODIFIER_KEY_CODES.length;t++){const i=Se.MODIFIER_KEY_CODES[t];if(this.isKeyDown(i)&&!e.includes(i))return!1}return this.areKeysDown(e)}keysAreDown(){return Object.keys(this.keyState).length>0}get enterKeyDown(){return this.isKeyDown(Se.KEY_ENTER)}get shiftKeyDown(){return this.isAnyKeyInListDown(Se.SHIFT_KEYS)}get altKeyDown(){return this.isAnyKeyInListDown(Se.ALT_KEYS)}get ctrlKeyDown(){return this.isAnyKeyInListDown(Se.CONTROL_KEYS)}get metaKeyDown(){return this.isAnyKeyInListDown(Se.META_KEYS)}timeDownForKey(e){return assert&&assert(this.isKeyDown(e),"cannot get timeDown on a key that is not pressed down"),this.keyState[e].timeDown}clearState(e){this.keyState={},e||this.keyDownStateChangedEmitter.emit(null)}step(e){if(this.keysAreDown()){const t=e*1e3;for(const i in this.keyState)this.keyState[i]&&(this.keyState[i].timeDown+=t)}}attachToWindow(){assert&&assert(!this.attachedToDocument,"KeyStateTracker is already attached to document."),this.documentKeydownListener=t=>{this.keydownUpdate(t)},this.documentKeyupListener=t=>{this.keyupUpdate(t)},this.documentBlurListener=t=>{this.clearState()};const e=()=>{self.addEventListener("keyup",this.documentKeyupListener,{capture:!0}),self.addEventListener("keydown",this.documentKeydownListener,{capture:!0}),self.addEventListener("blur",this.documentBlurListener,{capture:!0}),this.attachedToDocument=!0};if(document)e();else{const t=()=>{e(),self.removeEventListener("load",t)};self.addEventListener("load",t)}}setEnabled(e){this._enabled!==e&&(this._enabled=e,!e&&this.clearState())}set enabled(e){this.setEnabled(e)}get enabled(){return this.isEnabled()}isEnabled(){return this._enabled}detachFromDocument(){assert&&assert(this.attachedToDocument,"KeyStateTracker is not attached to self."),assert&&assert(this.documentKeyupListener,"keyup listener was not created or attached to window"),assert&&assert(this.documentKeydownListener,"keydown listener was not created or attached to self."),assert&&assert(this.documentBlurListener,"blur listener was not created or attached to self."),self.removeEventListener("keyup",this.documentKeyupListener),self.removeEventListener("keydown",this.documentKeydownListener),self.removeEventListener("blur",this.documentBlurListener),this.documentKeyupListener=null,this.documentKeydownListener=null,this.documentBlurListener=null,this.attachedToDocument=!1}dispose(){this.disposeKeyStateTracker()}}te.register("KeyStateTracker",Nm);class nL extends Nm{constructor(e){super(e)}}const Bm=new nL({tandem:ai.GENERAL_CONTROLLER.createTandem("keyStateTracker")});te.register("globalKeyStateTracker",Bm);const Hs=Bm,mp=["interactiveHighlight","interactiveHighlightLayerable","interactiveHighlightEnabled"],vd=ns(h=>{assert&&assert(!h._mixesInteractiveHighlighting,"InteractiveHighlighting is already added to this Type");const e=oo("InteractiveHighlightingClass",mp,class extends h{constructor(...i){super(...i),this._pointer=null,this.displays={},this._interactiveHighlight=null,this._interactiveHighlightLayerable=!1,this._interactiveHighlightEnabled=!0,this.interactiveHighlightChangedEmitter=new ri,this._isInteractiveHighlightActiveProperty=new Nt(!1),this._activationListener={enter:this._onPointerEntered.bind(this),over:this._onPointerOver.bind(this),move:this._onPointerMove.bind(this),exit:this._onPointerExited.bind(this),down:this._onPointerDown.bind(this)},this._changedInstanceListener=this.onChangedInstance.bind(this),this.changedInstanceEmitter.addListener(this._changedInstanceListener),this._interactiveHighlightingEnabledListener=this._onInteractiveHighlightingEnabledChange.bind(this),this._boundPointerFocusClearedListener=this.handleLockedPointerFocusCleared.bind(this);const s=this._onPointerRelease.bind(this),n=this._onPointerCancel.bind(this);this._pointerListener={up:s,cancel:n,interrupt:n},this.isInteractiveHighlightActiveProperty=this._isInteractiveHighlightActiveProperty}get isInteractiveHighlighting(){return!0}static get _mixesInteractiveHighlighting(){return!0}setInteractiveHighlight(i){this._interactiveHighlight!==i&&(this._interactiveHighlight=i,this._interactiveHighlightLayerable&&(assert&&assert(i instanceof tt),i.visible=!1),this.interactiveHighlightChangedEmitter.emit())}set interactiveHighlight(i){this.setInteractiveHighlight(i)}get interactiveHighlight(){return this.getInteractiveHighlight()}getInteractiveHighlight(){return this._interactiveHighlight}setInteractiveHighlightLayerable(i){this._interactiveHighlightLayerable!==i&&(this._interactiveHighlightLayerable=i,this._interactiveHighlight&&(assert&&assert(this._interactiveHighlight instanceof tt),this._interactiveHighlight.visible=!1,this.interactiveHighlightChangedEmitter.emit()))}set interactiveHighlightLayerable(i){this.setInteractiveHighlightLayerable(i)}get interactiveHighlightLayerable(){return this.getInteractiveHighlightLayerable()}getInteractiveHighlightLayerable(){return this._interactiveHighlightLayerable}setInteractiveHighlightEnabled(i){this._interactiveHighlightEnabled=i;const s=Object.keys(this.displays);for(let n=0;n<s.length;n++){const o=this.displays[s[n]];this._interactiveHighlightingEnabledListener(o.focusManager.pointerHighlightsVisibleProperty.value)}}getInteractiveHighlightEnabled(){return this._interactiveHighlightEnabled}set interactiveHighlightEnabled(i){this.setInteractiveHighlightEnabled(i)}get interactiveHighlightEnabled(){return this.getInteractiveHighlightEnabled()}isInteractiveHighlightActivated(){let i=!1;const s=Object.keys(this.displays);for(let n=0;n<s.length;n++){const o=this.displays[s[n]];if(o.focusManager.pointerHighlightsVisibleProperty.value){const c=o.focusManager.pointerFocusProperty.value,p=o.focusManager.lockedPointerFocusProperty.value;if(p){if((p==null?void 0:p.trail.lastNode())===this){i=!0;break}}else if((c==null?void 0:c.trail.lastNode())===this){i=!0;break}}}return i}handleHighlightActiveChange(){this._isInteractiveHighlightActiveProperty.value=this.isInteractiveHighlightActivated()}dispose(){this.changedInstanceEmitter.removeListener(this._changedInstanceListener),this.hasInputListener(this._activationListener)&&this.removeInputListener(this._activationListener),this._pointer&&(this._pointer.removeInputListener(this._pointerListener),this._pointer=null);const i=Object.keys(this.displays);for(let s=0;s<i.length;s++){const n=this.displays[i[s]];this.onDisplayRemoved(n),delete this.displays[i[s]]}super.dispose&&super.dispose()}_onPointerOver(i){const s=i.trail.nodes.find(n=>n.groupFocusHighlight&&n.isInteractiveHighlighting);if(s){const n=i.trail.subtrailTo(s),o=Object.values(this.displays);for(let c=0;c<o.length;c++){const p=o[c];p.focusManager.pointerFocusProperty.value===null&&p.focusManager.pointerFocusProperty.set(new An(p,n))}}}_onPointerEntered(i){let s=!1;const n=Object.values(this.displays);for(let o=0;o<n.length;o++){const c=n[o];if(c.focusManager.pointerFocusProperty.value===null||!i.trail.equals(c.focusManager.pointerFocusProperty.value.trail)){const p=new An(c,i.trail);c.focusManager.pointerFocusProperty.set(p),c.focusManager.lockedPointerFocusProperty.value===null&&i.pointer.attachedListener&&(this.lockHighlight(p,c.focusManager),s=!0)}}s&&this.savePointer(i.pointer)}_onPointerMove(i){let s=!1;const n=Object.values(this.displays);for(let o=0;o<n.length;o++){const c=n[o],p=i.trail.subtrailTo(this);if((c.focusManager.pointerFocusProperty.value===null||!p.equals(c.focusManager.pointerFocusProperty.value.trail))&&!this.getDescendantsUseHighlighting(i.trail)){const f=new An(c,p);c.focusManager.pointerFocusProperty.set(f),c.focusManager.lockedPointerFocusProperty.value===null&&i.pointer.attachedListener&&(this.lockHighlight(f,c.focusManager),s=!0)}}s&&this.savePointer(i.pointer)}_onPointerExited(i){const s=Object.values(this.displays);for(let n=0;n<s.length;n++){const o=s[n];o.focusManager.pointerFocusProperty.set(null);const c=o.focusManager.lockedPointerFocusProperty.value;!i.trail.isPickable()&&(c===null||i.trail.containsNode(c.trail.lastNode()))&&this._onPointerRelease(i)}}_onPointerDown(i){if(this._pointer===null){let s=!1;const n=Object.values(this.displays);for(let o=0;o<n.length;o++){const c=n[o],p=c.focusManager.pointerFocusProperty.value,f=!!c.focusManager.lockedPointerFocusProperty.value;p&&!f&&(assert&&assert(!p.trail.lastNode().isDisposed,"Focus should not be set to a disposed Node"),this.lockHighlight(p,c.focusManager),s=!0)}s&&this.savePointer(i.pointer)}}onDisplayAdded(i){i.focusManager.pointerHighlightsVisibleProperty.hasListener(this._interactiveHighlightingEnabledListener)||i.focusManager.pointerHighlightsVisibleProperty.link(this._interactiveHighlightingEnabledListener)}onDisplayRemoved(i){i.focusManager.lockedPointerFocusProperty.hasListener(this._boundPointerFocusClearedListener)&&i.focusManager.lockedPointerFocusProperty.unlink(this._boundPointerFocusClearedListener),i.focusManager.pointerHighlightsVisibleProperty.unlink(this._interactiveHighlightingEnabledListener)}_onPointerRelease(i){const s=Object.values(this.displays);for(let n=0;n<s.length;n++){const o=s[n];o.focusManager.lockedPointerFocusProperty.value=null,o.focusManager.lockedPointerFocusProperty.hasListener(this._boundPointerFocusClearedListener)&&o.focusManager.lockedPointerFocusProperty.unlink(this._boundPointerFocusClearedListener)}this._pointer&&this._pointer.listeners.includes(this._pointerListener)&&(this._pointer.removeInputListener(this._pointerListener),this._pointer=null)}_onPointerCancel(i){const s=Object.values(this.displays);for(let n=0;n<s.length;n++)s[n].focusManager.pointerFocusProperty.set(null);this._onPointerRelease(i)}savePointer(i){assert&&assert(this._pointer===null,"It should be impossible to already have a Pointer before locking from touchSnag"),this._pointer=i,this._pointer.addInputListener(this._pointerListener)}lockHighlight(i,s){assert&&assert(this._pointer===null,"It should be impossible to already have a Pointer before locking from touchSnag"),s.lockedPointerFocusProperty.set(new An(i.display,i.trail.copy())),assert&&assert(!s.lockedPointerFocusProperty.hasListener(this._boundPointerFocusClearedListener),"this listener still on the lockedPointerFocusProperty indicates a memory leak"),s.lockedPointerFocusProperty.link(this._boundPointerFocusClearedListener)}handleLockedPointerFocusCleared(i){i===null&&this._onPointerRelease()}_onInteractiveHighlightingEnabledChange(i){const s=i&&this._interactiveHighlightEnabled,n=this.hasInputListener(this._activationListener);s&&!n?this.addInputListener(this._activationListener):!s&&n&&this.removeInputListener(this._activationListener),this.handleHighlightActiveChange()}onChangedInstance(i,s){assert&&assert(i.trail,"should have a trail"),assert&&assert(i.display,"should have a display");const n=i.trail.uniqueId;if(s){const o=i.display;this.displays[n]=o,this.onDisplayAdded(o)}else{assert&&assert(i.node,"should have a node");const o=this.displays[n];assert&&assert(o,`interactive highlighting does not have a Display for removed instance: ${n}`),i.node.instances.length===0&&this.onDisplayRemoved(o),delete this.displays[n]}}getDescendantsUseHighlighting(i){const s=i.nodes.indexOf(this),n=i.nodes.slice(s+1,i.nodes.length);let o=!1;for(let c=0;c<n.length;c++)if(n[c].isInteractiveHighlighting){o=!0;break}return o}mutate(i){return super.mutate(i)}});return e.prototype._mutatorKeys=mp.concat(e.prototype._mutatorKeys),assert&&assert(e.prototype._mutatorKeys.length===_.uniq(e.prototype._mutatorKeys).length,"duplicate mutator keys in InteractiveHighlighting"),e});te.register("InteractiveHighlighting",vd);class rL extends vd(tt){constructor(e){super(e)}}te.register("InteractiveHighlightingNode",rL);const Fm=new Mh("phetcommon"),eh="",th="",Ia="",er={format:function(h){const e=arguments;return h.replace(/{(\d)}/g,(t,i)=>e[+i+1])},fillIn:function(h,e){h=h&&h.get?h.get():h,assert&&assert(typeof h=="string",`invalid template: ${h}`),assert&&assert(e&&typeof e=="object",`invalid values: ${e}`);let t=h;const i=h.match(/\{\{[^{}]+\}\}/g)||[];for(let s=0;s<i.length;s++){const n=i[s],o=n.replace("{{","").replace("}}","");if(e[o]!==void 0){const c=e[o]&&e[o].get?e[o].get():e[o];t=t.replace(n,c)}}return t},isEmbeddingMark:function(h){return h===eh||h===th||h===Ia},embeddedSlice:function(h,e,t){const i=[];let s;for(t===void 0&&(t=h.length),t<0&&(t+=h.length);e<h.length&&er.isEmbeddingMark(h.charAt(e));)e++;for(;t>=1&&er.isEmbeddingMark(h.charAt(t-1));)t--;if(e>=t||e>=h.length)return"";for(let T=0;T<e;T++)s=h.charAt(T),s===eh||s===th?i.push(s):s===Ia&&i.pop();let n=i.length,o=i.slice();const c=h.slice(e,t);for(let T=0;T<c.length;T++)s=c.charAt(T),s===eh||s===th?i.push(s):s===Ia&&(i.pop(),n=Math.min(i.length,n));let p=i;const f=Math.max(0,n-1);o=o.slice(f),p=p.slice(f);const w=o.join(""),O=p.join("").replace(/./g,Ia);return w+c+O},embeddedSplit:function(h,e,t){if(e===void 0)return[h];let i=[],s,n=h;function o(){let p,f;if(e instanceof self.RegExp){const w=n.match(e);w?(p=w.index,f=w[0].length):p=-1}else assert&&assert(typeof e=="string"),p=n.indexOf(e),f=e.length;return{index:p,length:f}}let c=0;for(;(s=o()).index>=0;){i.push(er.embeddedSlice(h,c,c+s.index));const p=s.index+s.length;n=n.slice(p),c+=p}return i.push(er.embeddedSlice(h,c)),t!==void 0&&(assert&&assert(typeof t=="number"),i=_.first(i,t)),i},embeddedDebugString:function(h){return h.replace(/\u202a/g,"[LTR]").replace(/\u202b/g,"[RTL]").replace(/\u202c/g,"[POP]")},wrapLTR:function(h){return eh+h+Ia},wrapRTL:function(h){return th+h+Ia},wrapDirection:function(h,e){return assert&&assert(e==="ltr"||e==="rtl"),e==="ltr"?er.wrapLTR(h):er.wrapRTL(h)},localeToLocalizedName:function(h){return assert&&assert(phet.chipper.localeData[h],"locale needs to be a valid locale code defined in localeData"),er.wrapDirection(phet.chipper.localeData[h].localizedName,phet.chipper.localeData[h].direction)},capitalize(h){const e=h.search(/[A-Za-z0-9]/);if(e===-1)return h.slice(0);const t=e>0?h.slice(0,e):"",i=h.charAt(e).toUpperCase(),s=e+1<h.length?h.slice(e+1):"";return t+i+s}};Fm.register("StringUtils",er);const qn=new Mh("utteranceQueue"),aL="NAME",oL="OBJECT",lL="CONTEXT",hL="HINT",cL={nameObjectContextHint:"{{NAME}}, {{OBJECT}}, {{CONTEXT}} {{HINT}}",nameObjectContext:"{{NAME}}, {{OBJECT}}, {{CONTEXT}}",nameObjectHint:"{{NAME}}, {{OBJECT}}, {{HINT}}",nameContextHint:"{{NAME}}, {{CONTEXT}} {{HINT}}",nameObject:"{{NAME}}, {{OBJECT}}",nameContext:"{{NAME}}, {{CONTEXT}}",nameHint:"{{NAME}}, {{HINT}}",name:"{{NAME}}",objectContextHint:"{{OBJECT}}, {{CONTEXT}} {{HINT}}",objectContext:"{{OBJECT}}, {{CONTEXT}}",objectHint:"{{OBJECT}}, {{HINT}}",contextHint:"{{CONTEXT}} {{HINT}}",object:"{{OBJECT}}",context:"{{CONTEXT}}",hint:"{{HINT}}"},kh=class kh{constructor(e){const t=or()({},cL,e);this.nameObjectContextHint=t.nameObjectContextHint,this.nameObjectContext=t.nameObjectContext,this.nameObjectHint=t.nameObjectHint,this.nameContextHint=t.nameContextHint,this.nameObject=t.nameObject,this.nameContext=t.nameContext,this.nameHint=t.nameHint,this.name=t.name,this.objectContextHint=t.objectContextHint,this.objectContext=t.objectContext,this.objectHint=t.objectHint,this.contextHint=t.contextHint,this.object=t.object,this.context=t.context,this.hint=t.hint}getResponsePattern(e){const t=this[e];return assert&&assert(t,`no pattern string found for key ${e}`),t}static createPatternKey(e,t,i,s){let n="";return e&&(n=n.concat(aL.concat("_"))),t&&(n=n.concat(oL.concat("_"))),i&&(n=n.concat(lL.concat("_"))),s&&(n=n.concat(hL.concat("_"))),_.camelCase(n)}};kh.DEFAULT_RESPONSE_PATTERNS=new kh;let zr=kh;qn.register("ResponsePatternCollection",zr);const yp={nameResponse:null,objectResponse:null,contextResponse:null,hintResponse:null,ignoreProperties:!1,responsePatternCollection:zr.DEFAULT_RESPONSE_PATTERNS},Sr=class Sr{constructor(e){const t=or()({},yp,e);assert&&assert(t.responsePatternCollection instanceof zr),this._nameResponse=t.nameResponse,this._objectResponse=t.objectResponse,this._contextResponse=t.contextResponse,this._hintResponse=t.hintResponse,this.ignoreProperties=t.ignoreProperties,this.responsePatternCollection=t.responsePatternCollection}getNameResponse(){return Sr.getResponseText(this._nameResponse)}get nameResponse(){return this.getNameResponse()}set nameResponse(e){this.setNameResponse(e)}setNameResponse(e){this._nameResponse=e}getObjectResponse(){return Sr.getResponseText(this._objectResponse)}get objectResponse(){return this.getObjectResponse()}set objectResponse(e){this.setObjectResponse(e)}setObjectResponse(e){this._objectResponse=e}getContextResponse(){return Sr.getResponseText(this._contextResponse)}get contextResponse(){return this.getContextResponse()}set contextResponse(e){this.setContextResponse(e)}setContextResponse(e){this._contextResponse=e}getHintResponse(){return Sr.getResponseText(this._hintResponse)}get hintResponse(){return this.getHintResponse()}set hintResponse(e){this.setHintResponse(e)}setHintResponse(e){this._hintResponse=e}static getResponseText(e){return ft(e)?e.value:typeof e=="function"?e():e}copy(){return new Sr(this.serialize())}serialize(){return{nameResponse:this.nameResponse,objectResponse:this.objectResponse,contextResponse:this.contextResponse,hintResponse:this.hintResponse,ignoreProperties:this.ignoreProperties,responsePatternCollection:this.responsePatternCollection}}};Sr.DEFAULT_OPTIONS=yp;let so=Sr;qn.register("ResponsePacket",so);class uL extends Hi{constructor(e){super(),this.nameResponsesEnabledProperty=new ci(!0),this.objectResponsesEnabledProperty=new ci(!1),this.contextResponsesEnabledProperty=new ci(!1),this.hintResponsesEnabledProperty=new ci(!1)}reset(){this.nameResponsesEnabledProperty.reset(),this.objectResponsesEnabledProperty.reset(),this.contextResponsesEnabledProperty.reset(),this.hintResponsesEnabledProperty.reset()}collectResponses(e){const t=or()({},so.DEFAULT_OPTIONS,e);assert&&assert(t.responsePatternCollection instanceof zr);const i=!!(t.nameResponse&&(this.nameResponsesEnabledProperty.get()||t.ignoreProperties)),s=!!(t.objectResponse&&(this.objectResponsesEnabledProperty.get()||t.ignoreProperties)),n=!!(t.contextResponse&&(this.contextResponsesEnabledProperty.get()||t.ignoreProperties)),o=!!(t.hintResponse&&(this.hintResponsesEnabledProperty.get()||t.ignoreProperties)),c=zr.createPatternKey(i,s,n,o);let p="";if(c){const f=t.responsePatternCollection.getResponsePattern(c);p=er.fillIn(f,{NAME:t.nameResponse,OBJECT:t.objectResponse,CONTEXT:t.contextResponse,HINT:t.hintResponse})}return p}}const Hm=new uL;qn.register("responseCollector",Hm);const Vm=Hm,bp=1;let dL=1;const gn=class gn extends Yu{constructor(e){const t=st()({alert:null,predicate:function(){return!0},canAnnounceProperties:[],descriptionCanAnnounceProperties:[],voicingCanAnnounceProperties:[],alertStableDelay:200,alertMaximumDelay:Number.MAX_VALUE,announcerOptions:{},priority:bp},e);super(t),this.id=dL++,this._alert=t.alert,this.predicate=t.predicate,this.canAnnounceProperty=new $c({dependentProperties:t.canAnnounceProperties}),this.descriptionCanAnnounceProperty=new $c({dependentProperties:t.descriptionCanAnnounceProperties}),this.voicingCanAnnounceProperty=new $c({dependentProperties:t.voicingCanAnnounceProperties}),this.alertStableDelay=t.alertStableDelay,this.alertMaximumDelay=t.alertMaximumDelay,this.announcerOptions=t.announcerOptions,this.priorityProperty=new Wn(t.priority),this.previousAlertText=null}static getAlertStringFromResponsePacket(e,t){const i=e.serialize();return t||(i.ignoreProperties=!0),Vm.collectResponses(i)}getAlertText(e=!1){const t=gn.alertableToText(this._alert,e);return this.previousAlertText=t,t}getAlert(){return this._alert}get alert(){return this.getAlert()}set alert(e){this.setAlert(e)}setAlert(e){this._alert=e}setAlertStableDelay(e){this.alertStableDelay=e}toString(){return`Utterance_${this.id}#${this.getAlertText()}`}toStateObject(){return{alert:Ft(eo([Ti,Ut])).toStateObject(this.getAlertText())}}reset(){this.previousAlertText=null}setCanAnnounceProperties(e){this.canAnnounceProperty.setDependentProperties(e)}set canAnnounceProperties(e){this.setCanAnnounceProperties(e)}get canAnnounceProperties(){return this.getCanAnnounceProperties()}getCanAnnounceProperties(){return this.canAnnounceProperty.getDependentProperties()}setDescriptionCanAnnounceProperties(e){this.descriptionCanAnnounceProperty.setDependentProperties(e)}set descriptionCanAnnounceProperties(e){this.setDescriptionCanAnnounceProperties(e)}get descriptionCanAnnounceProperties(){return this.getDescriptionCanAnnounceProperties()}getDescriptionCanAnnounceProperties(){return this.descriptionCanAnnounceProperty.getDependentProperties()}setVoicingCanAnnounceProperties(e){this.voicingCanAnnounceProperty.setDependentProperties(e)}set voicingCanAnnounceProperties(e){this.setVoicingCanAnnounceProperties(e)}get voicingCanAnnounceProperties(){return this.getVoicingCanAnnounceProperties()}getVoicingCanAnnounceProperties(){return this.voicingCanAnnounceProperty.getDependentProperties()}dispose(){this.canAnnounceProperty.dispose(),this.descriptionCanAnnounceProperty.dispose(),this.voicingCanAnnounceProperty.dispose(),this.priorityProperty.dispose(),super.dispose()}static alertableToText(e,t=!1){let i;if(typeof e=="function")i=e();else if(e instanceof so)i=gn.getAlertStringFromResponsePacket(e,t);else{if(e instanceof gn)return e.getAlertText(t);ft(e)?i=e.value:i=e}return i}};gn.TOP_PRIORITY=10,gn.HIGH_PRIORITY=5,gn.MEDIUM_PRIORITY=2,gn.DEFAULT_PRIORITY=bp,gn.LOW_PRIORITY=0,gn.UtteranceIO=new Ai("UtteranceIO",{valueType:gn,documentation:"Announces text to a specific browser technology (like aria-live or web speech)",toStateObject:e=>e.toStateObject(),stateSchema:{alert:Ft(eo([Ti,Ut]))}});let on=gn;class $c extends Af{constructor(e){const t=st()({dependentProperties:[]},e),i=new wi(new Nt(!1));super(i),this._dependentProperties=[],this.implementationProperty=i,this.setDependentProperties(t.dependentProperties)}setDependentProperties(e){this.implementationProperty.value&&this.implementationProperty.value.dispose();const t=e.length===0?[new Nt(!0)]:e;this.implementationProperty.value=Si.and(t),this._dependentProperties=e}set dependentProperties(e){this.setDependentProperties(e)}get dependentProperties(){return this.getDependentProperties()}getDependentProperties(){return this._dependentProperties.slice(0)}dispose(){this.implementationProperty.dispose(),this._dependentProperties=[],super.dispose()}}qn.register("Utterance",on);const il=class il extends Hi{constructor(e){var i;const t=st()({respectResponseCollectorProperties:!0,phetioType:il.AnnouncerIO,phetioState:!1},e);super(t),this.readyToAnnounce=!0,this.hasSpoken=!1,this.respectResponseCollectorProperties=t.respectResponseCollectorProperties,this.announcementCompleteEmitter=new _s({parameters:[{name:"utterance",phetioType:on.UtteranceIO},{name:"text",phetioType:Ft(eo([Ti,Ut]))}],tandem:(i=t.tandem)==null?void 0:i.createTandem("announcementCompleteEmitter"),phetioReadOnly:!0,phetioDocumentation:"The announcement that has just completed. The Utterance text could potentially differ from the exact text that was announced, so both are emitted. Use `text` for an exact match of what was announced."})}shouldUtteranceCancelOther(e,t){return t.priorityProperty.value<e.priorityProperty.value}onUtterancePriorityChange(e){}};il.AnnouncerIO=new Ai("AnnouncerIO",{valueType:il,documentation:"Announces text to a specific browser technology (like aria-live or web speech)"});let Pl=il;qn.register("Announcer",Pl);const zm={initialize(){if(self.speechSynthesis||self.SpeechSynthesis||self.SpeechSynthesisUtterance)throw new Error("SpeechSynthesis is supported here, the polyfill should not overwrite it");assert&&assert(self.parent,"This polyfill requires a parent frame implementation of SpeechSynthesis."),self.SpeechSynthesis=self.parent.SpeechSynthesis,self.speechSynthesis=new self.parent.SpeechSynthesis,self.SpeechSynthesisUtterance=self.parent.SpeechSynthesisUtterance}};qn.register("SpeechSynthesisParentPolyfill",zm);self.phet&&phet.chipper&&phet.chipper.queryParameters&&phet.chipper.queryParameters.speechSynthesisFromParent&&zm.initialize();const _p=5e3,gL=5e3,pL=1e4,vp=125,fL=["Albert","Bad News","Bahh","Bells","Boing","Bubbles","Cellos","Good News","Jester","Organ","Superstar","Trinoids","Whisper","Wobble","Zarvox","Flo","Grandma","Grandpa","Junior"];let Lp=0;const Pp={cmn:"zh_CN",yue:"zh_HK","yue-HK":"zh_HK",yue_HK:"zh_HK","fil-PH":"tl",fil_PH:"tl"},Sp={cancelSelf:!0,cancelOther:!0,voice:null};class Ya extends Pl{constructor(e){var i,s,n,o;const t=st()({respectResponseCollectorProperties:!1,debug:!1},e);super(t),this.debug=t.debug,this.voiceProperty=new wi(null,{tandem:(i=t.tandem)==null?void 0:i.createTandem("voiceProperty"),phetioValueType:Ft(bL),phetioState:!1,phetioReadOnly:!0,phetioDocumentation:"the voice that is currently voicing responses"}),this.voiceRateProperty=new Wn(1,{range:new rr(.75,2),tandem:(s=t.tandem)==null?void 0:s.createTandem("voiceRateProperty"),phetioState:!1,phetioDocumentation:"changes the rate of the voicing-feature voice"}),this.voicePitchProperty=new Wn(1,{range:new rr(.5,2),tandem:(n=t.tandem)==null?void 0:n.createTandem("voicePitchProperty"),phetioState:!1,phetioDocumentation:"changes the pitch of the voicing-feature voice"}),this.voiceVolumeProperty=new Wn(1,{range:new rr(0,1)}),this.hasSpoken=!1,this.timeSinceWakingEngine=0,this.timeSincePauseResume=0,this.timeSincePendingUtterance=0,this.timeSinceUtteranceEnd=vp,this.startSpeakingEmitter=new _s({parameters:[{valueType:"string"},{valueType:on}]}),this.endSpeakingEmitter=new _s({parameters:[{valueType:"string"},{valueType:on}]}),this.enabledComponentImplementation=new Il({enabled:!1,tandem:t.tandem,enabledPropertyOptions:{phetioDocumentation:"toggles this controller of SpeechSynthesis on and off",phetioState:!1,phetioFeatured:!1}}),assert&&assert(this.enabledComponentImplementation.enabledProperty.isSettable(),"enabledProperty must be settable"),this.enabledProperty=this.enabledComponentImplementation.enabledProperty,this.mainWindowVoicingEnabledProperty=new ci(!0,{tandem:(o=t.tandem)==null?void 0:o.createTandem("mainWindowVoicingEnabledProperty"),phetioState:!1,phetioDocumentation:"toggles the voicing feature on and off for the simulation screen (not the voicing preferences and toolbar controls)"}),this.voicingFullyEnabledProperty=Si.and([this.enabledProperty,this.mainWindowVoicingEnabledProperty]),this._speechAllowedAndFullyEnabledProperty=new ci(!1),this.speechAllowedAndFullyEnabledProperty=this._speechAllowedAndFullyEnabledProperty,this.synth=null,this.voicesProperty=new wi([]),this.speakingSpeechSynthesisUtteranceWrapper=null,this.isInitializedProperty=new ci(!1),this.canSpeakProperty=null,this.boundHandleCanSpeakChange=this.handleCanSpeakChange.bind(this),this.boundHandleCanAnnounceChange=this.handleCanAnnounceChange.bind(this),this.debug&&(this.announcementCompleteEmitter.addListener((c,p)=>{console.log("announcement complete",p)}),this.startSpeakingEmitter.addListener(c=>{this.debug&&console.log("startSpeakingListener",c)}),this.endSpeakingEmitter.addListener(c=>{this.debug&&console.log("endSpeakingListener",c)}))}get initialized(){return this.isInitializedProperty.value}initialize(e,t){assert&&assert(!this.initialized,"can only be initialized once"),assert&&assert(Ya.isSpeechSynthesisSupported(),"trying to initialize speech, but speech is not supported on this platform."),assert&&assert(Lp===0,"Only one instance of SpeechSynthesisAnnouncer can be initialized at a time."),Lp++;const i=st()({speechAllowedProperty:new ci(!0)},t);this.synth=self.speechSynthesis,this.canSpeakProperty=Si.and([i.speechAllowedProperty,this.enabledProperty]),this.canSpeakProperty.link(this.boundHandleCanSpeakChange),Ar.multilink([i.speechAllowedProperty,this.voicingFullyEnabledProperty],(o,c)=>{this._speechAllowedAndFullyEnabledProperty.value=o&&c});const s=this.getSynth();s.addEventListener&&s.addEventListener("voiceschanged",()=>{this.populateVoices()}),this.populateVoices();const n=()=>{this.timeSinceWakingEngine=_p,e.removeListener(n)};e.addListener(n),Wi.addListener(this.step.bind(this)),this.isInitializedProperty.value=!0}step(e){e*=1e3;const t=this.getSynth();this.initialized&&t&&(this.hasSpoken||(this.hasSpoken=t.speaking),this.timeSinceUtteranceEnd=t.speaking?0:this.timeSinceUtteranceEnd+e,this.timeSincePendingUtterance=this.speakingSpeechSynthesisUtteranceWrapper&&!this.speakingSpeechSynthesisUtteranceWrapper.started?this.timeSincePendingUtterance+e:0,this.timeSincePendingUtterance>gL&&(assert&&assert(this.speakingSpeechSynthesisUtteranceWrapper,"should have this.speakingSpeechSynthesisUtteranceWrapper"),this.handleSpeechSynthesisEnd(this.speakingSpeechSynthesisUtteranceWrapper.announceText,this.speakingSpeechSynthesisUtteranceWrapper),this.speakingSpeechSynthesisUtteranceWrapper=null,this.cancelSynth()),this.timeSinceUtteranceEnd>vp&&!this.speakingSpeechSynthesisUtteranceWrapper&&(this.readyToAnnounce=!0),Ui.chromium&&!Ui.android&&this.voiceProperty.value&&!this.voiceProperty.value.localService&&(this.timeSincePauseResume=t.speaking?this.timeSincePauseResume+e:0,this.timeSincePauseResume>pL&&(this.timeSincePauseResume=0,t.pause(),t.resume())),Ui.chromeOS&&(this.timeSinceWakingEngine+=e,!t.speaking&&this.timeSinceWakingEngine>_p&&(this.timeSinceWakingEngine=0,t.speak(new SpeechSynthesisUtterance(" ")))))}handleCanSpeakChange(e){e||this.cancel()}populateVoices(){const e=this.getSynth();e&&(this.voicesProperty.value=_.uniqBy(e.getVoices(),t=>t.name))}getPrioritizedVoices(){assert&&assert(this.initialized,"No voices available until the SpeechSynthesisAnnouncer is initialized"),assert&&assert(this.voicesProperty.value.length>0,"No voices available to provided a prioritized list.");const e=this.voicesProperty.value.slice(),t=_.filter(e,s=>!_.some(fL,n=>s.name.includes(n))),i=s=>s.name.includes("Google")?-1:s.name.includes("Fred")?t.length:t.indexOf(s);return t.sort((s,n)=>i(s)-i(n))}getEnglishPrioritizedVoices(){return _.filter(this.getPrioritizedVoices(),e=>e.lang==="en-US"||e.lang==="en_US")}getPrioritizedVoicesForLocale(e){const t=e,i=e.replace("_","-");return _.filter(this.getPrioritizedVoices(),s=>{const n=Pp.hasOwnProperty(s.lang)?Pp[s.lang]:s.lang;let o=!1;return(n.includes("_")||n.includes("-"))&&(o=t===n.slice(0,2)),o||t===n||i===n})}announce(e,t){this.initialized&&this.canSpeakProperty&&this.canSpeakProperty.value?this.requestSpeech(e,t):this.handleAnnouncementFailure(t,e)}handleAnnouncementFailure(e,t){this.debug&&console.log("announcement failure",t),this.announcementCompleteEmitter.emit(e,t)}speakIgnoringEnabled(e){this.initialized&&(this.cancel(),this.requestSpeech(e.getAlertText(this.respectResponseCollectorProperties),e))}requestSpeech(e,t){if(assert&&assert(Ya.isSpeechSynthesisSupported(),"trying to speak with speechSynthesis, but it is not supported on this platform"),this.debug&&console.log("requestSpeech",e),!e){this.handleAnnouncementFailure(t,e);return}const i=or()({},Sp,t.announcerOptions),s=yL(qu(e+""));Or(s,yn.STRING_WITHOUT_TEMPLATE_VARS_VALIDATOR);const n=new SpeechSynthesisUtterance(s);n.voice=i.voice||this.voiceProperty.value,n.pitch=this.voicePitchProperty.value,n.rate=this.voiceRateProperty.value,n.volume=this.voiceVolumeProperty.value;const o=()=>{this.startSpeakingEmitter.emit(s,t),assert&&assert(this.speakingSpeechSynthesisUtteranceWrapper,"should have been set in requestSpeech"),this.speakingSpeechSynthesisUtteranceWrapper.started=!0,n.removeEventListener("start",o)},c=()=>{this.handleSpeechSynthesisEnd(s,p)},p=new mL(t,e,n,!1,c,o);assert&&assert(this.speakingSpeechSynthesisUtteranceWrapper===null,"Wrapper should be null, we should have received an end event to clear it before the next one."),this.speakingSpeechSynthesisUtteranceWrapper=p,n.addEventListener("start",o),n.addEventListener("end",c),n.addEventListener("error",c),this.readyToAnnounce=!1,this.timeSinceUtteranceEnd=0,t.canAnnounceProperty.link(this.boundHandleCanAnnounceChange),t.voicingCanAnnounceProperty.link(this.boundHandleCanAnnounceChange),this.getSynth().speak(n)}handleCanAnnounceChange(){this.speakingSpeechSynthesisUtteranceWrapper&&this.cancelUtteranceIfCanAnnounceFalse(this.speakingSpeechSynthesisUtteranceWrapper.utterance)}cancelUtteranceIfCanAnnounceFalse(e){(!e.canAnnounceProperty.value||!e.voicingCanAnnounceProperty.value)&&this.cancelUtterance(e)}handleSpeechSynthesisEnd(e,t){this.endSpeakingEmitter.emit(e,t.utterance),this.announcementCompleteEmitter.emit(t.utterance,t.speechSynthesisUtterance.text),t.speechSynthesisUtterance.removeEventListener("error",t.endListener),t.speechSynthesisUtterance.removeEventListener("end",t.endListener),t.speechSynthesisUtterance.removeEventListener("start",t.startListener);const i=t.utterance.canAnnounceProperty;i.hasListener(this.boundHandleCanAnnounceChange)&&i.unlink(this.boundHandleCanAnnounceChange);const s=t.utterance.voicingCanAnnounceProperty;s.hasListener(this.boundHandleCanAnnounceChange)&&s.unlink(this.boundHandleCanAnnounceChange),this.speakingSpeechSynthesisUtteranceWrapper=null}getSynth(){return assert&&assert(Ya.isSpeechSynthesisSupported(),"Trying to use SpeechSynthesis, but it is not supported on this platform."),this.synth}cancel(){this.initialized&&this.speakingSpeechSynthesisUtteranceWrapper&&this.cancelUtterance(this.speakingSpeechSynthesisUtteranceWrapper.utterance)}cancelUtterance(e){const t=this.speakingSpeechSynthesisUtteranceWrapper;t&&e===t.utterance&&(this.handleSpeechSynthesisEnd(t.announceText,t),this.cancelSynth())}shouldUtteranceCancelOther(e,t){const i=or()({},Sp,e.announcerOptions);let s;return t.priorityProperty.value!==e.priorityProperty.value?s=t.priorityProperty.value<e.priorityProperty.value:(s=i.cancelOther,t&&t===e&&(s=i.cancelSelf)),s}onUtterancePriorityChange(e){const t=this.speakingSpeechSynthesisUtteranceWrapper;t&&this.shouldUtteranceCancelOther(e,t.utterance)&&this.cancelUtterance(t.utterance)}cancelSynth(){assert&&assert(this.initialized,"must be initialized to use synth");const e=this.getSynth();e&&e.cancel()}static isSpeechSynthesisSupported(){return!!self.speechSynthesis&&!!self.SpeechSynthesisUtterance}}class mL{constructor(e,t,i,s,n,o){this.utterance=e,this.announceText=t,this.speechSynthesisUtterance=i,this.started=s,this.endListener=n,this.startListener=o}}function yL(h){return h.split("<br/>").join(" ").split("<br>").join(" ")}const bL=new Ai("SpeechSynthesisVoiceIO",{isValidValue:h=>!0,toStateObject:h=>h.name});qn.register("SpeechSynthesisAnnouncer",Ya);class _L extends Ya{constructor(e){const t=st()({respectResponseCollectorProperties:!0,phetioDocumentation:"Announcer that manages the voicing feature, providing audio responses via WebAudio."},e);super(t)}initialize(e,t){super.initialize(e,t),Hs.keyupEmitter.addListener(i=>{Se.isControlKey(i)&&this.cancel()})}voicingSupportedForLocale(e){return e.startsWith("en")}}const $m=new _L;te.register("voicingManager",$m);const Vn=$m,vL=4;let Ou=1;const wr=class wr extends Ur{constructor(e){super(),this.attributeString=e}};wr.POLITE=new wr("polite"),wr.ASSERTIVE=new wr("assertive"),wr.enumeration=new Yr(wr);let Pr=wr;function wp(h){const e=h.attributeString,t=document.createElement("div");for(let i=1;i<=vL;i++){const s=document.createElement("p");s.setAttribute("id",`elements-${Ou}-${e}-${i}`),s.setAttribute("aria-live",e),t.appendChild(s)}return t}const sl=class sl extends Pl{constructor(e){const t=st()({respectResponseCollectorProperties:!1,lang:"en"},e);super(t),this.politeElementIndex=0,this.assertiveElementIndex=0,this.ariaLiveContainer=document.createElement("div"),this.ariaLiveContainer.setAttribute("lang",t.lang),this.ariaLiveContainer.setAttribute("id",`aria-live-elements-${Ou}`),this.ariaLiveContainer.setAttribute("style","position: absolute; left: 0px; top: 0px; width: 0px; height: 0px; clip: rect(0px 0px 0px 0px); pointer-events: none;");const i=wp(Pr.POLITE),s=wp(Pr.ASSERTIVE);this.ariaLiveContainer.appendChild(i),this.ariaLiveContainer.appendChild(s),this.politeElements=Array.from(i.children),this.assertiveElements=Array.from(s.children),Ou++}announce(e,t,i){const s=st()({ariaLivePriority:Pr.POLITE},i);if(this.hasSpoken=!0,e)if(ft(e)&&(e=e.value),s.ariaLivePriority===Pr.POLITE){const n=this.politeElements[this.politeElementIndex];this.updateLiveElement(n,e,t),this.politeElementIndex=(this.politeElementIndex+1)%this.politeElements.length}else if(s.ariaLivePriority===Pr.ASSERTIVE){const n=this.assertiveElements[this.assertiveElementIndex];this.updateLiveElement(n,e,t),this.assertiveElementIndex=(this.assertiveElementIndex+1)%this.assertiveElements.length}else assert&&assert(!1,"unsupported aria live prioirity");this.announcementCompleteEmitter.emit(t,e)}cancel(){}cancelUtterance(e){}updateLiveElement(e,t,i){e.textContent="",e.hidden=!1,this.readyToAnnounce=!1,Wi.setTimeout(()=>{i.predicate()?(Dt.setTextContent(e,t),Wi.setTimeout(()=>{Ui.safari&&!Ui.mobileSafari?e.hidden=!0:e.textContent="",this.readyToAnnounce=!0},sl.ARIA_LIVE_DELAY)):this.readyToAnnounce=!0},0)}};sl.ARIA_LIVE_DELAY=200,sl.AriaLive=Pr;let gh=sl;qn.register("AriaLiveAnnouncer",gh);const Gm=gh;class Wm{constructor(e){this.utterance=e,this.timeInQueue=0,this.stableTime=0,this.announcingUtterancePriorityListener=null}resetTimingVariables(){this.timeInQueue=0,this.stableTime=0}}qn.register("UtteranceWrapper",Wm);class Wh extends Hi{constructor(e,t){const i=st()({debug:!1,initialize:!0,featureSpecificAnnouncingControlPropertyName:null},t);super(i),this.announcer=e,this._initialized=i.initialize,this.featureSpecificAnnouncingControlPropertyName=i.featureSpecificAnnouncingControlPropertyName,this.queue=[],this._muted=!1,this._enabled=!0,this.utteranceToPriorityListenerMap=new Map,this.announcingUtteranceWrapper=null,this.debug=i.debug,this.announcer.announcementCompleteEmitter.addListener(s=>{if(this.announcingUtteranceWrapper&&s===this.announcingUtteranceWrapper.utterance){assert&&assert(this.announcingUtteranceWrapper.announcingUtterancePriorityListener,"announcingUtterancePriorityListener should be set on this.announcingUtteranceWrapper");const n=this.announcingUtteranceWrapper.announcingUtterancePriorityListener;this.announcingUtteranceWrapper.utterance.priorityProperty.hasListener(n)&&(this.announcingUtteranceWrapper.utterance.priorityProperty.unlink(n),this.announcingUtteranceWrapper.announcingUtterancePriorityListener=null,this.announcingUtteranceWrapper=null)}}),this.stepQueueListener=null,this._initialized&&(this.stepQueueListener=this.stepQueue.bind(this),Wi.addListener(this.stepQueueListener))}get length(){return this.queue.length}addToBack(e){if(this.initializedAndEnabled)if(!this.announcer.hasSpoken)this.announceImmediately(e);else{const t=this.prepareUtterance(e);this.queue.push(t),this.debug&&console.log("addToBack"),this.addPriorityListenerAndPrioritizeQueue(t)}}addToFront(e){if(xn("`addToFront()` has been deprecated because it is confusing, and most of the time doesn't do what is expected, because Utterances are announced based on time-in-queue first, and then position in the queue. It is recommended to use addToBack, and then timing variables on Utterances, or instead call queue.clear() before adding a more important alert to the queue."),!this.initializedAndEnabled)return;const t=this.prepareUtterance(e);this.queue.unshift(t)}addPriorityListenerAndPrioritizeQueue(e){assert&&assert(!this.utteranceToPriorityListenerMap.has(e.utterance),"About to add the priority listener twice and only one should exist on the Utterance. The listener should have been removed by removeOthersAndUpdateUtteranceWrapper.");const t=()=>{this.prioritizeUtterances(e)};e.utterance.priorityProperty.lazyLink(t),this.utteranceToPriorityListenerMap.set(e.utterance,t),this.prioritizeUtterances(e)}prepareUtterance(e){e instanceof on||(e=new on({alert:e}));const t=new Wm(e);return this.removeOthersAndUpdateUtteranceWrapper(t),t.stableTime=0,t}removeUtterance(e){const t=s=>s.utterance===e;assert&&assert(_.find(this.queue,t),"utterance to be removed not found in queue");const i=_.remove(this.queue,t);this.removePriorityListeners(i)}prioritizeUtterances(e){let t=this.queue.indexOf(e);const i=t>=0;let s;i?s=t-1:s=-1;for(let n=s;n>=0;n--){const o=this.queue[n];this.shouldUtteranceCancelOther(e.utterance,o.utterance)&&this.removeUtterance(o.utterance)}if(i){t=this.queue.indexOf(e),assert&&assert(t>-1,"utteranceWrapper is not in queue?");const n=this.queue[t+1];n&&this.shouldUtteranceCancelOther(n.utterance,e.utterance)&&this.removeUtterance(e.utterance)}this.queue.length>0&&this.announcer.onUtterancePriorityChange(this.queue[0].utterance)}shouldUtteranceCancelOther(e,t){return this.announcer.shouldUtteranceCancelOther(e,t)}removeOthersAndUpdateUtteranceWrapper(e){const t=[];for(let s=0;s<this.queue.length;s++){const n=this.queue[s];n.utterance===e.utterance&&t.push(n.timeInQueue)}t.length>=1&&(e.timeInQueue=Math.max(...t));const i=_.remove(this.queue,s=>s.utterance===e.utterance);this.removePriorityListeners(i)}get initializedAndEnabled(){return this._enabled&&this._initialized}getNextUtterance(){let e=null;for(let t=0;t<this.queue.length;t++){const i=this.queue[t];if(i.stableTime>i.utterance.alertStableDelay||i.timeInQueue>i.utterance.alertMaximumDelay){e=i;break}}return e}hasUtterance(e){for(let t=0;t<this.queue.length;t++){const i=this.queue[t];if(e===i.utterance)return!0}return!1}clear(){this.debug&&console.log("UttearnceQueue.clear()"),this.removePriorityListeners(this.queue),this.queue.length=0}cancelUtterance(e){this.announcer.cancelUtterance(e),this.hasUtterance(e)&&this.removeUtterance(e)}cancel(){this.debug&&console.log("UtteranceQueue.cancel()"),this.clear(),this.announcer.cancel()}removePriorityListeners(e){e.forEach(t=>this.removePriorityListener(t.utterance))}removePriorityListener(e){const t=this.utteranceToPriorityListenerMap.get(e);t&&(e.priorityProperty.unlink(t),this.utteranceToPriorityListenerMap.delete(e))}setMuted(e){this._muted=e}set muted(e){this.setMuted(e)}get muted(){return this.getMuted()}getMuted(){return this._muted}setEnabled(e){this._enabled=e}set enabled(e){this.setEnabled(e)}get enabled(){return this.isEnabled()}isEnabled(){return this._enabled}stepQueue(e){if(this._enabled&&(e*=1e3,this.queue.length>0)){for(let i=0;i<this.queue.length;i++){const s=this.queue[i];s.timeInQueue+=e,s.stableTime+=e}const t=this.getNextUtterance();t&&this.attemptToAnnounce(t)}}announceImmediately(e){if(this.initializedAndEnabled&&(this.debug&&console.log("announceImmediately"),e instanceof on||(e=new on({alert:e})),this.announcingUtteranceWrapper===null||this.announcer.shouldUtteranceCancelOther(e,this.announcingUtteranceWrapper.utterance))){const t=this.prepareUtterance(e);t.stableTime=Number.POSITIVE_INFINITY,t.timeInQueue=Number.POSITIVE_INFINITY,this.queue.unshift(t),this.addPriorityListenerAndPrioritizeQueue(t),this.queue.includes(t)&&this.attemptToAnnounce(t)}}attemptToAnnounce(e){const t=e.utterance;if(this.announcer.readyToAnnounce){const i=t.getAlertText(this.announcer.respectResponseCollectorProperties);this.debug&&console.log("ready to announce in attemptToAnnounce(): ",i);const s=!this.featureSpecificAnnouncingControlPropertyName||t[this.featureSpecificAnnouncingControlPropertyName].value,n=t.canAnnounceProperty.value&&t.predicate()&&s;!this._muted&&n&&i!==""?(assert&&assert(this.announcingUtteranceWrapper===null,"announcingUtteranceWrapper and its priorityProperty listener should have been disposed"),this.announcingUtteranceWrapper=e,this.announcingUtteranceWrapper.announcingUtterancePriorityListener=()=>{this.prioritizeUtterances(e)},e.utterance.priorityProperty.link(this.announcingUtteranceWrapper.announcingUtterancePriorityListener),this.debug&&console.log("announcing: ",i),this.announcer.announce(i,t,t.announcerOptions)):this.debug&&console.log("announcer readyToAnnounce but utterance cannot announce, will not be spoken: ",i),this.queue.includes(e)&&this.removeUtterance(e.utterance)}else this.debug&&console.log("announcer not readyToAnnounce")}dispose(){this._initialized&&(assert&&assert(this.stepQueueListener),Wi.removeListener(this.stepQueueListener)),super.dispose()}static fromFactory(){const e=new Gm,t=new Wh(e),i=e.ariaLiveContainer;document.body?document.body.appendChild(i):document.children[0].appendChild(i);let s=0;const n=o=>{const c=o-s;s=o,phet.axon.stepTimer.emit(c/1e3),self.requestAnimationFrame(n)};return self.requestAnimationFrame(n),t}}qn.register("UtteranceQueue",Wh);const Um=Wh,Uh=new Um(Vn,{featureSpecificAnnouncingControlPropertyName:"voicingCanAnnounceProperty"});Uh.enabled=!1;te.register("voicingUtteranceQueue",Uh);function LL(h){if(!(h instanceof on))throw new Error("utterance is not an Utterance")}class Cp extends on{constructor(e){super(e)}}const Mu=["voicingNameResponse","voicingObjectResponse","voicingContextResponse","voicingHintResponse","voicingUtterance","voicingResponsePatternCollection","voicingIgnoreVoicingManagerProperties","voicingFocusListener"],kn=h=>{assert&&assert(_.includes(Xs(h),tt),"Only Node subtypes should compose Voicing");const e=oo("Voicing",Mu,class Ym extends vd(h){constructor(...i){super(...i),this._boundInstanceCanVoiceChangeListener=this.onInstanceCanVoiceChange.bind(this),this._voicingUtterance=null,Ym.prototype.initialize.call(this)}initialize(...i){return super.initialize&&super.initialize(i),this._voicingCanSpeakProperty=new Nt(!0),this._voicingResponsePacket=new so,this._voicingFocusListener=this.defaultFocusListener,this.setVoicingUtterance(new Cp),this._voicingCanSpeakCount=0,this._boundInstancesChangedListener=this.addOrRemoveInstanceListeners.bind(this),this.changedInstanceEmitter.addListener(this._boundInstancesChangedListener),this._speakContentOnFocusListener={focus:s=>{this._voicingFocusListener&&this._voicingFocusListener(s)}},this.addInputListener(this._speakContentOnFocusListener),this}voicingSpeakFullResponse(i){const s=_i({},i);s.hasOwnProperty("nameResponse")||(s.nameResponse=this._voicingResponsePacket.nameResponse),s.hasOwnProperty("objectResponse")||(s.objectResponse=this._voicingResponsePacket.objectResponse),s.hasOwnProperty("contextResponse")||(s.contextResponse=this._voicingResponsePacket.contextResponse),s.hasOwnProperty("hintResponse")||(s.hintResponse=this._voicingResponsePacket.hintResponse),this.collectAndSpeakResponse(s)}voicingSpeakResponse(i){const s=_i({nameResponse:null,objectResponse:null,contextResponse:null,hintResponse:null},i);this.collectAndSpeakResponse(s)}voicingSpeakNameResponse(i){const s=_i({},i);s.hasOwnProperty("nameResponse")||(s.nameResponse=this._voicingResponsePacket.nameResponse),this.collectAndSpeakResponse(s)}voicingSpeakObjectResponse(i){const s=_i({},i);s.hasOwnProperty("objectResponse")||(s.objectResponse=this._voicingResponsePacket.objectResponse),this.collectAndSpeakResponse(s)}voicingSpeakContextResponse(i){const s=_i({},i);s.hasOwnProperty("contextResponse")||(s.contextResponse=this._voicingResponsePacket.contextResponse),this.collectAndSpeakResponse(s)}voicingSpeakHintResponse(i){const s=_i({},i);s.hasOwnProperty("hintResponse")||(s.hintResponse=this._voicingResponsePacket.hintResponse),this.collectAndSpeakResponse(s)}collectAndSpeakResponse(i){this.speakContent(this.collectResponse(i))}collectResponse(i){const s=_i({ignoreProperties:this._voicingResponsePacket.ignoreProperties,responsePatternCollection:this._voicingResponsePacket.responsePatternCollection,utterance:this.voicingUtterance},i);let n=Vm.collectResponses(s);return s.utterance&&(s.utterance.alert=n,n=s.utterance),n}speakContent(i){const s=!ai.PHET_IO_ENABLED||!this.isInsidePhetioArchetype();i&&s&&Uh.addToBack(i)}setVoicingNameResponse(i){this._voicingResponsePacket.nameResponse=i}set voicingNameResponse(i){this.setVoicingNameResponse(i)}get voicingNameResponse(){return this.getVoicingNameResponse()}getVoicingNameResponse(){return this._voicingResponsePacket.nameResponse}setVoicingObjectResponse(i){this._voicingResponsePacket.objectResponse=i}set voicingObjectResponse(i){this.setVoicingObjectResponse(i)}get voicingObjectResponse(){return this.getVoicingObjectResponse()}getVoicingObjectResponse(){return this._voicingResponsePacket.objectResponse}setVoicingContextResponse(i){this._voicingResponsePacket.contextResponse=i}set voicingContextResponse(i){this.setVoicingContextResponse(i)}get voicingContextResponse(){return this.getVoicingContextResponse()}getVoicingContextResponse(){return this._voicingResponsePacket.contextResponse}setVoicingHintResponse(i){this._voicingResponsePacket.hintResponse=i}set voicingHintResponse(i){this.setVoicingHintResponse(i)}get voicingHintResponse(){return this.getVoicingHintResponse()}getVoicingHintResponse(){return this._voicingResponsePacket.hintResponse}setVoicingIgnoreVoicingManagerProperties(i){this._voicingResponsePacket.ignoreProperties=i}set voicingIgnoreVoicingManagerProperties(i){this.setVoicingIgnoreVoicingManagerProperties(i)}get voicingIgnoreVoicingManagerProperties(){return this.getVoicingIgnoreVoicingManagerProperties()}getVoicingIgnoreVoicingManagerProperties(){return this._voicingResponsePacket.ignoreProperties}setVoicingResponsePatternCollection(i){this._voicingResponsePacket.responsePatternCollection=i}set voicingResponsePatternCollection(i){this.setVoicingResponsePatternCollection(i)}get voicingResponsePatternCollection(){return this.getVoicingResponsePatternCollection()}getVoicingResponsePatternCollection(){return this._voicingResponsePacket.responsePatternCollection}setVoicingUtterance(i){this._voicingUtterance!==i&&(this._voicingUtterance&&this.cleanVoicingUtterance(),kn.registerUtteranceToVoicingNode(i,this),this._voicingUtterance=i)}set voicingUtterance(i){this.setVoicingUtterance(i)}get voicingUtterance(){return this.getVoicingUtterance()}getVoicingUtterance(){return LL(this._voicingUtterance),this._voicingUtterance}setVoicingFocusListener(i){this._voicingFocusListener=i}set voicingFocusListener(i){this.setVoicingFocusListener(i)}get voicingFocusListener(){return this.getVoicingFocusListener()}getVoicingFocusListener(){return this._voicingFocusListener}defaultFocusListener(){this.voicingSpeakFullResponse({contextResponse:null})}get isVoicing(){return!0}dispose(){this.removeInputListener(this._speakContentOnFocusListener),this.changedInstanceEmitter.removeListener(this._boundInstancesChangedListener),this._voicingUtterance&&(this.cleanVoicingUtterance(),this._voicingUtterance=null),super.dispose()}clean(){this.removeInputListener(this._speakContentOnFocusListener),this.changedInstanceEmitter.removeListener(this._boundInstancesChangedListener),this._voicingUtterance&&(this.cleanVoicingUtterance(),this._voicingUtterance=null),super.clean&&super.clean()}onInstanceCanVoiceChange(i){i?this._voicingCanSpeakCount++:this._voicingCanSpeakCount--,assert&&assert(this._voicingCanSpeakCount>=0,"the voicingCanSpeakCount should not go below zero"),assert&&assert(this._voicingCanSpeakCount<=this.instances.length,"The voicingCanSpeakCount cannot be greater than the number of Instances."),this._voicingCanSpeakProperty.value=this._voicingCanSpeakCount>0}handleInstancesChanged(i,s){i.visible&&i.voicingVisible&&(this._voicingCanSpeakCount=s?this._voicingCanSpeakCount+1:this._voicingCanSpeakCount-1),this._voicingCanSpeakProperty.value=this._voicingCanSpeakCount>0}addOrRemoveInstanceListeners(i,s){assert&&assert(i.canVoiceEmitter,"Instance must be initialized."),s?i.canVoiceEmitter.addListener(this._boundInstanceCanVoiceChangeListener):i.canVoiceEmitter.removeListener(this._boundInstanceCanVoiceChangeListener),this.handleInstancesChanged(i,s)}cleanVoicingUtterance(){assert&&assert(this._voicingUtterance,"A voicingUtterance must be available to clean."),this._voicingUtterance instanceof Cp?this._voicingUtterance.dispose():this._voicingUtterance&&!this._voicingUtterance.isDisposed&&kn.unregisterUtteranceToVoicingNode(this._voicingUtterance,this)}mutate(i){return super.mutate(i)}});return e.prototype._mutatorKeys=Mu.concat(e.prototype._mutatorKeys),assert&&assert(e.prototype._mutatorKeys.length===_.uniq(e.prototype._mutatorKeys).length,"duplicate mutator keys in Voicing"),e};kn.VOICING_OPTION_KEYS=Mu;kn.alertUtterance=h=>{assert&&assert(h.voicingCanAnnounceProperties.length>0,"voicingCanAnnounceProperties required, this Utterance might not be connected to Node in the scene graph."),Uh.addToBack(h)};kn.registerUtteranceToVoicingNode=(h,e)=>{const t=h.voicingCanAnnounceProperties,i=e._voicingCanSpeakProperty;t.includes(i)||(h.voicingCanAnnounceProperties=t.concat([i]))};kn.unregisterUtteranceToVoicingNode=(h,e)=>{const t=h.voicingCanAnnounceProperties,i=e._voicingCanSpeakProperty,s=t.indexOf(i);assert&&assert(s>-1,"voicingNode.voicingCanSpeakProperty is not on the Utterance, was it not registered?"),h.voicingCanAnnounceProperties=t.splice(s,1)};kn.registerUtteranceToNode=(h,e)=>{const t=h.voicingCanAnnounceProperties;t.includes(e.visibleProperty)||(h.voicingCanAnnounceProperties=h.voicingCanAnnounceProperties.concat([e.visibleProperty])),t.includes(e.voicingVisibleProperty)||(h.voicingCanAnnounceProperties=h.voicingCanAnnounceProperties.concat([e.voicingVisibleProperty]))};kn.unregisterUtteranceToNode=(h,e)=>{const t=h.voicingCanAnnounceProperties;assert&&assert(t.includes(e.visibleProperty)&&t.includes(e.voicingVisibleProperty),"visibleProperty and voicingVisibleProperty were not on the Utterance, was it not registered to the node?");const i=t.indexOf(e.visibleProperty),n=t.splice(i,1).indexOf(e.voicingVisibleProperty),o=t.splice(n,1);h.voicingCanAnnounceProperties=o};te.register("Voicing",kn);class Km extends on{constructor(e,t){super(t),this.readingBlockFocus=e}}te.register("ReadingBlockUtterance",Km);const ph=Km;class qm{constructor(e){this.node=null,this.visibilityTracker=null,this.focusProperty=e,this.boundVisibilityListener=this.handleTrailVisibilityChange.bind(this),this.boundInstancesChangedListener=this.handleInstancesChange.bind(this),this.boundNodeDisposedListener=this.handleNodeDisposed.bind(this),this.boundFocusListener=this.handleFocusChange.bind(this),this.focusProperty.link(this.boundFocusListener)}handleFocusChange(e){this.removeDisplayedListeners(),e&&this.addDisplayedListeners(e)}handleTrailVisibilityChange(){this.visibilityTracker&&!this.visibilityTracker.trailVisibleProperty.value&&(this.focusProperty.value=null)}handleInstancesChange(e){e.node&&e.node.instances.length===0&&(this.focusProperty.value=null)}handleNodeDisposed(){this.focusProperty.value=null}addDisplayedListeners(e){assert&&assert(this.visibilityTracker===null,"creating a new TrailVisibilityTracker but the last one was not disposed"),assert&&assert(this.node===null,"Still a reference to the previously focused Node, possible memory leak"),this.visibilityTracker=new Rm(e.trail),this.visibilityTracker.addListener(this.boundVisibilityListener),this.node=e.trail.lastNode(),this.node.changedInstanceEmitter.addListener(this.boundInstancesChangedListener),this.node.disposeEmitter.addListener(this.boundNodeDisposedListener)}removeDisplayedListeners(){this.visibilityTracker&&(this.visibilityTracker.removeListener(this.boundVisibilityListener),this.visibilityTracker.dispose(),this.visibilityTracker=null),this.node&&(this.node.changedInstanceEmitter.removeListener(this.boundInstancesChangedListener),this.node.disposeEmitter.removeListener(this.boundNodeDisposedListener),this.node=null)}dispose(){this.removeDisplayedListeners(),this.focusProperty.unlink(this.boundFocusListener),this.node=null,this.visibilityTracker=null}}te.register("FocusDisplayedController",qm);const Gc=qm,yi=class yi{constructor(){this.pointerFocusProperty=new wi(null),this.readingBlockFocusProperty=new wi(null),this.lockedPointerFocusProperty=new wi(null),this.pdomFocusHighlightsVisibleProperty=new ci(!0),this.interactiveHighlightsVisibleProperty=new ci(!1),this.readingBlockHighlightsVisibleProperty=new ci(!1),this.voicingFullyEnabledListener=e=>{this.readingBlockHighlightsVisibleProperty.value=e},Vn.voicingFullyEnabledProperty.link(this.voicingFullyEnabledListener),this.pointerHighlightsVisibleProperty=new Si([this.interactiveHighlightsVisibleProperty,this.readingBlockHighlightsVisibleProperty],(e,t)=>e||t),this.readingBlockFocusController=new Gc(this.readingBlockFocusProperty),this.startSpeakingListener=(e,t)=>{this.readingBlockFocusProperty.value=t instanceof ph?t.readingBlockFocus:null},Vn.startSpeakingEmitter.addListener(this.startSpeakingListener),this.endSpeakingListener=(e,t)=>{t instanceof ph&&this.readingBlockFocusProperty.value&&(assert&&assert(t.readingBlockFocus,"should be non null focus"),t.readingBlockFocus.trail.equals(this.readingBlockFocusProperty.value.trail)&&(this.readingBlockFocusProperty.value=null))},Vn.endSpeakingEmitter.addListener(this.endSpeakingListener),this.pointerFocusDisplayedController=new Gc(this.pointerFocusProperty),this.lockedPointerFocusDisplayedController=new Gc(this.lockedPointerFocusProperty),[this.pointerFocusProperty,this.lockedPointerFocusProperty].forEach(e=>{e.link(this.onPointerFocusChange.bind(this))})}dispose(){this.pointerFocusProperty.dispose(),this.readingBlockFocusProperty.dispose(),this.lockedPointerFocusProperty.dispose(),this.pdomFocusHighlightsVisibleProperty.dispose(),this.interactiveHighlightsVisibleProperty.dispose(),this.readingBlockHighlightsVisibleProperty.dispose(),this.readingBlockFocusController.dispose(),this.pointerFocusDisplayedController.dispose(),this.pointerHighlightsVisibleProperty.dispose(),this.lockedPointerFocusDisplayedController.dispose(),Vn.startSpeakingEmitter.removeListener(this.startSpeakingListener),Vn.endSpeakingEmitter.removeListener(this.endSpeakingListener),Vn.voicingFullyEnabledProperty.unlink(this.voicingFullyEnabledListener)}static updatePDOMFocusFromEvent(e,t,i){if(assert&&assert(document.activeElement,"Must be called from focusin, therefore active elemetn expected"),i)for(let s=0;s<e.length;s++){const n=e[s],o=document.activeElement;if(n.isElementUnderPDOM(o,!1)){const c=o.getAttribute(Dt.DATA_PDOM_UNIQUE_ID);assert&&assert(c,"Event target must have a unique ID on its data if it is in the PDOM.");const p=En.uniqueIdToTrail(n,c);assert&&assert(p,"We must have a trail since the target was under the PDOM.");const f=En.guessVisualTrail(p,n.rootNode);f.lastNode().focusable?yi.pdomFocus=new An(n,f):(t.target.blur(),t.stopImmediatePropagation());break}}else for(let s=0;s<e.length;s++){const n=e[s],o=n._input.getRelatedTargetTrail(t);o&&o.lastNode().focusable?yi.pdomFocus=new An(n,En.guessVisualTrail(o,n.rootNode)):yi.pdomFocus=null}}onPointerFocusChange(e,t){const i=e==null?void 0:e.trail.lastNode();i&&i.isInteractiveHighlighting&&i.handleHighlightActiveChange();const s=t==null?void 0:t.trail.lastNode();s&&s.isInteractiveHighlighting&&s.handleHighlightActiveChange()}static set pdomFocus(e){if(yi.pdomFocusProperty.value!==e){let t;yi.pdomFocusProperty.value&&(t=yi.pdomFocusedNode),yi.pdomFocusProperty.value=e,t&&!e&&t.blur()}}static get pdomFocus(){return yi.pdomFocusProperty.value}static getPDOMFocusedNode(){let e=null;const t=yi.pdomFocusProperty.get();return t&&(e=t.trail.lastNode()),e}static get pdomFocusedNode(){return this.getPDOMFocusedNode()}static attachToWindow(){assert&&assert(!yi.globallyAttached,"Can only be attached statically once."),yi.attachedWindowFocusListener=()=>{yi._windowHasFocusProperty.value=!0},yi.attachedWindowBlurListener=()=>{yi._windowHasFocusProperty.value=!1},self.addEventListener("focus",yi.attachedWindowFocusListener),self.addEventListener("blur",yi.attachedWindowBlurListener),yi._windowHasFocusProperty.value=document.hasFocus(),yi.globallyAttached=!0}static detachFromWindow(){self.removeEventListener("focus",yi.attachedWindowFocusListener),self.removeEventListener("blur",yi.attachedWindowBlurListener),yi._windowHasFocusProperty.value=!1,yi.globallyAttached=!1}};yi.attachedWindowFocusListener=null,yi.attachedWindowBlurListener=null,yi.globallyAttached=!1,yi.pdomFocusProperty=new wi(null,{tandem:ai.GENERAL_MODEL.createTandem("pdomFocusProperty"),phetioDocumentation:"Stores the current focus in the Parallel DOM, null if nothing has focus. This is not updated based on mouse or touch input, only keyboard and other alternative inputs. Note that this only applies to simulations that support alternative input.",phetioValueType:Ft(An.FocusIO),phetioState:!1,phetioFeatured:!0,phetioReadOnly:!0}),yi._windowHasFocusProperty=new ci(!1),yi.windowHasFocusProperty=yi._windowHasFocusProperty;let mi=yi;te.register("FocusManager",mi);const Tp=new qe("rgba(212,19,106,0.5)"),xp=new qe("rgba(250,40,135,0.9)"),PL=new qe("rgba(233,113,166,1.0)"),SL=new qe("rgba(233,113,166,1.0)"),wL=new qe("rgba(159,15,80,1.0)"),CL=new qe("rgba(159,15,80,1.0)"),TL=2.5,Ip=4,xL=2,IL=2,Ki=class Ki extends Fi{constructor(e,t){const i=st()({outerStroke:Tp,innerStroke:xp,outerLineWidth:null,innerLineWidth:null,dashed:!1,transformSourceNode:null},t);super(e),this.highlightChangedEmitter=new _s,this._innerHighlightColor=i.innerStroke,this._outerHighlightColor=i.outerStroke;const s=_.pick(i,Object.keys(Fi.DEFAULT_PATH_OPTIONS));this.innerLineWidth=i.innerLineWidth,this.outerLineWidth=i.outerLineWidth,this.transformSourceNode=i.transformSourceNode,i.stroke=i.outerStroke,this.mutate(i);const n=_i({},s,{stroke:i.innerStroke});this.innerHighlightPath=new Fi(e,n),this.addChild(this.innerHighlightPath),i.dashed&&this.makeDashed(!0)}mutateWithInnerHighlight(e){super.mutate(e),this.innerHighlightPath&&this.innerHighlightPath.mutate(e),this.highlightChangedEmitter.emit()}makeDashed(e){const t=e?[7,7]:[];this.mutateWithInnerHighlight({lineDash:t})}setShape(e){return super.setShape(e),this.innerHighlightPath&&this.innerHighlightPath.setShape(e),this.highlightChangedEmitter&&this.highlightChangedEmitter.emit(),this}updateLineWidth(e){this.lineWidth=this.getOuterLineWidth(e),this.innerHighlightPath.lineWidth=this.getInnerLineWidth(e),this.highlightChangedEmitter.emit()}getOuterLineWidth(e){return this.outerLineWidth?this.outerLineWidth:Ki.getOuterLineWidthFromMatrix(e)}getInnerLineWidth(e){return this.innerLineWidth?this.innerLineWidth:Ki.getInnerLineWidthFromMatrix(e)}setInnerHighlightColor(e){this._innerHighlightColor=e,this.innerHighlightPath.setStroke(e),this.highlightChangedEmitter.emit()}set innerHighlightColor(e){this.setInnerHighlightColor(e)}get innerHighlightColor(){return this.getInnerHighlightColor()}getInnerHighlightColor(){return this._innerHighlightColor}setOuterHighlightColor(e){this._outerHighlightColor=e,this.setStroke(e),this.highlightChangedEmitter.emit()}set outerHighlightColor(e){this.setOuterHighlightColor(e)}get outerHighlightColor(){return this.getOuterHighlightColor()}getOuterHighlightColor(){return this._outerHighlightColor}getUniqueHighlightTrail(e){assert&&assert(this.transformSourceNode,"getUniqueHighlightTrail requires a transformSourceNode");const t=this.transformSourceNode;let i=null;if(t.instances.length<=1)i=t.getUniqueTrail();else{const s=t.getTrails().filter(n=>n.isExtensionOf(e,!0));assert&&assert(s.length===1,"No unique trail to highlight, either avoid DAG for transformSourceNode or don't use transformSourceNode with HighlightPath"),i=s[0]}return assert&&assert(i,"no unique Trail found for getUniqueHighlightTrail"),i}static getInnerLineWidthFromMatrix(e){return TL/Ki.localToGlobalScaleFromMatrix(e)}static getOuterLineWidthFromMatrix(e){return Ip/Ki.localToGlobalScaleFromMatrix(e)}static localToGlobalScaleFromMatrix(e){return Math.sqrt(e.m00()*e.m00()+e.m10()*e.m10())}static getDilationCoefficient(e){return Ki.getOuterLineWidthFromMatrix(e)*(.5+.25)}static getDefaultDilationCoefficient(){return Ki.getDilationCoefficient(Ze.IDENTITY)}static getDefaultGroupDilationCoefficient(){return Ki.getGroupDilationCoefficient(Ze.IDENTITY)}static getDefaultHighlightLineWidth(){return Ip}static getGroupDilationCoefficient(e){return Ki.getOuterLineWidthFromMatrix(e)*(.5+1.4)}static getPanZoomCorrectingMatrix(){return Yp.initialized?Yp.listener.matrixProperty.value.inverted():Ze.IDENTITY}static getLayoutCorrectingMatrix(){return Ze.scaling(1/Ki.layoutScale,1/Ki.layoutScale)}static getCorrectiveScalingMatrix(){return Ki.getPanZoomCorrectingMatrix().timesMatrix(Ki.getLayoutCorrectingMatrix())}};Ki.OUTER_FOCUS_COLOR=Tp,Ki.INNER_FOCUS_COLOR=xp,Ki.INNER_LIGHT_GROUP_FOCUS_COLOR=PL,Ki.OUTER_LIGHT_GROUP_FOCUS_COLOR=SL,Ki.INNER_DARK_GROUP_FOCUS_COLOR=wL,Ki.OUTER_DARK_GROUP_FOCUS_COLOR=CL,Ki.GROUP_OUTER_LINE_WIDTH=xL,Ki.GROUP_INNER_LINE_WIDTH=IL,Ki.layoutScale=1;let fh=Ki;te.register("HighlightPath",fh);const Bi=fh;class DL extends Bi{constructor(e,t){const i=st()({outerStroke:Bi.OUTER_LIGHT_GROUP_FOCUS_COLOR,innerStroke:Bi.INNER_LIGHT_GROUP_FOCUS_COLOR,outerLineWidth:Bi.GROUP_OUTER_LINE_WIDTH,innerLineWidth:Bi.GROUP_INNER_LINE_WIDTH},t);super(e,i)}}te.register("GroupHighlightPath",DL);class Xm extends Bi{constructor(e,t){const i=st()({useLocalBounds:!0,dilationCoefficient:null,useGroupDilation:!1},t);i.transformSourceNode=e,super(null,i),this.observedBoundsProperty=null,this.boundsListener=null,this.useLocalBounds=i.useLocalBounds,this.useGroupDilation=i.useGroupDilation,this.dilationCoefficient=i.dilationCoefficient,e&&this.setShapeFromNode(e)}setShapeFromNode(e,t){this.observedBoundsProperty&&(assert&&assert(this.boundsListener,"should be a listener if there is a previous focusHighlightNode"),this.observedBoundsProperty.unlink(this.boundsListener)),this.observedBoundsProperty=e.localBoundsProperty,this.boundsListener=i=>{if(!i.isFinite())return;let s=this.dilationCoefficient;assert&&assert(t||e.getTrails().length<2,"HighlightFromNode requires a unique Trail if using DAG.");const o=(t||e.getUniqueTrail()).getMatrix().timesMatrix(Bi.getCorrectiveScalingMatrix());this.dilationCoefficient===null&&(s=this.useGroupDilation?Bi.getGroupDilationCoefficient(o):Bi.getDilationCoefficient(o));const p=(this.useLocalBounds?e.getVisibleLocalBounds():e.getVisibleBounds()).dilated(s);this.setShape(kt.bounds(p))},this.observedBoundsProperty.link(this.boundsListener)}dispose(){this.observedBoundsProperty&&(assert&&assert(this.boundsListener,"should be a listener if there is a previous focusHighlightNode"),this.observedBoundsProperty.unlink(this.boundsListener)),super.dispose()}}te.register("HighlightFromNode",Xm);const Sl=Xm;class Yh extends Sl{constructor(e,t){const i=st()({outerStroke:"grey",innerStroke:"black"},t);super(e,i)}}te.register("ReadingBlockHighlight",Yh);const Dp=["readingBlockTagName","readingBlockNameResponse","readingBlockHintResponse","readingBlockResponsePatternCollection","readingBlockActiveHighlight"];function AL(h){h instanceof ph||assert&&assert(!1,"utterance is not a ReadinBlockUtterance")}class Ap extends ph{constructor(e,t){super(e,t)}}const EL=new zr({nameHint:"{{NAME}}. {{HINT}}"}),Ld=ns(h=>{const e=oo("ReadingBlock",Dp,class extends kn(h){constructor(...i){super(...i),this._readingBlockTagName="button",this._readingBlockDisabledTagName="p",this._readingBlockActiveHighlight=null,this.readingBlockActiveHighlightChangedEmitter=new ri,this.readingBlockResponsePatternCollection=EL,this._localBoundsChangedListener=this._onLocalBoundsChanged.bind(this),this.localBoundsProperty.link(this._localBoundsChangedListener),this._readingBlockInputListener={focus:s=>this._speakReadingBlockContentListener(s),up:s=>this._speakReadingBlockContentListener(s),click:s=>this._speakReadingBlockContentListener(s)},this._readingBlockFocusableChangeListener=this._onReadingBlockFocusableChanged.bind(this),Vn.speechAllowedAndFullyEnabledProperty.link(this._readingBlockFocusableChangeListener),this.focusHighlight=new Yh(this),this.voicingUtterance=new Ap(null)}get isReadingBlock(){return!0}setReadingBlockTagName(i){this._readingBlockTagName=i,this._onReadingBlockFocusableChanged(Vn.speechAllowedAndFullyEnabledProperty.value)}set readingBlockTagName(i){this.setReadingBlockTagName(i)}get readingBlockTagName(){return this.getReadingBlockTagName()}getReadingBlockTagName(){return this._readingBlockTagName}setReadingBlockNameResponse(i){this._voicingResponsePacket.nameResponse=i}set readingBlockNameResponse(i){this.setReadingBlockNameResponse(i)}get readingBlockNameResponse(){return this.getReadingBlockNameResponse()}getReadingBlockNameResponse(){return this._voicingResponsePacket.nameResponse}setReadingBlockHintResponse(i){this._voicingResponsePacket.hintResponse=i}set readingBlockHintResponse(i){this.setReadingBlockHintResponse(i)}get readingBlockHintResponse(){return this.getReadingBlockHintResponse()}getReadingBlockHintResponse(){return this._voicingResponsePacket.hintResponse}setReadingBlockResponsePatternCollection(i){this._voicingResponsePacket.responsePatternCollection=i}set readingBlockResponsePatternCollection(i){this.setReadingBlockResponsePatternCollection(i)}get readingBlockResponsePatternCollection(){return this.getReadingBlockResponsePatternCollection()}getReadingBlockResponsePatternCollection(){return this._voicingResponsePacket.responsePatternCollection}setVoicingUtterance(i){super.setVoicingUtterance(i)}set voicingUtterance(i){super.voicingUtterance=i}get voicingUtterance(){return this.getVoicingUtterance()}getVoicingUtterance(){const i=super.getVoicingUtterance();return AL(i),i}setVoicingNameResponse(){assert&&assert(!1,"ReadingBlocks only support setting the name response via readingBlockNameResponse")}getVoicingNameResponse(){assert&&assert(!1,"ReadingBlocks only support getting the name response via readingBlockNameResponse")}setVoicingObjectResponse(){assert&&assert(!1,"ReadingBlocks do not support setting object response")}getVoicingObjectResponse(){assert&&assert(!1,"ReadingBlocks do not support setting object response")}setVoicingContextResponse(){assert&&assert(!1,"ReadingBlocks do not support setting context response")}getVoicingContextResponse(){assert&&assert(!1,"ReadingBlocks do not support setting context response")}setVoicingHintResponse(){assert&&assert(!1,"ReadingBlocks only support setting the hint response via readingBlockHintResponse.")}getVoicingHintResponse(){assert&&assert(!1,"ReadingBlocks only support getting the hint response via readingBlockHintResponse.")}setVoicingResponsePatternCollection(){assert&&assert(!1,"ReadingBlocks only support setting the response patterns via readingBlockResponsePatternCollection.")}getVoicingResponsePatternCollection(){assert&&assert(!1,"ReadingBlocks only support getting the response patterns via readingBlockResponsePatternCollection.")}setReadingBlockActiveHighlight(i){this._readingBlockActiveHighlight!==i&&(this._readingBlockActiveHighlight=i,this.readingBlockActiveHighlightChangedEmitter.emit())}set readingBlockActiveHighlight(i){this.setReadingBlockActiveHighlight(i)}get readingBlockActiveHighlight(){return this._readingBlockActiveHighlight}getReadingBlockActiveHighlight(){return this._readingBlockActiveHighlight}isReadingBlockActivated(){let i=!1;const s=Object.keys(this.displays);for(let n=0;n<s.length;n++){const o=this.displays[s[n]].focusManager.readingBlockFocusProperty.value;if(o&&o.trail.lastNode()===this){i=!0;break}}return i}get readingBlockActivated(){return this.isReadingBlockActivated()}_onReadingBlockFocusableChanged(i){this.focusable=i,i?(this.tagName=this._readingBlockTagName,this.hasInputListener(this._readingBlockInputListener)||this.addInputListener(this._readingBlockInputListener)):(this.tagName=this._readingBlockDisabledTagName,this.hasInputListener(this._readingBlockInputListener)&&this.removeInputListener(this._readingBlockInputListener))}_onLocalBoundsChanged(i){this.mouseArea=i,this.touchArea=i}_speakReadingBlockContentListener(i){const s=this.getConnectedDisplays(),n=this.voicingUtterance,o=this.collectResponse({nameResponse:this.getReadingBlockNameResponse(),hintResponse:this.getReadingBlockHintResponse(),ignoreProperties:this.voicingIgnoreVoicingManagerProperties,responsePatternCollection:this._voicingResponsePacket.responsePatternCollection,utterance:n});if(o){for(let c=0;c<s.length;c++)if(!this.getDescendantsUseHighlighting(i.trail)){const p=i.trail.subtrailTo(this),f=En.guessVisualTrail(p,s[c].rootNode),w=new An(s[c],f);n.readingBlockFocus=w,this.speakContent(o)}}}cleanVoicingUtterance(){this._voicingUtterance instanceof Ap&&this._voicingUtterance.dispose(),super.cleanVoicingUtterance()}dispose(){Vn.speechAllowedAndFullyEnabledProperty.unlink(this._readingBlockFocusableChangeListener),this.localBoundsProperty.unlink(this._localBoundsChangedListener),this.hasInputListener(this._readingBlockInputListener)&&this.removeInputListener(this._readingBlockInputListener),super.dispose()}mutate(i){return super.mutate(i)}});return e.prototype._mutatorKeys=Dp.concat(e.prototype._mutatorKeys),assert&&assert(e.prototype._mutatorKeys.length===_.uniq(e.prototype._mutatorKeys).length,"x mutator keys in ReadingBlock"),e});te.register("ReadingBlock",Ld);const fa={isPlatformMac:()=>_.includes(self.navigator.platform,"Mac"),getPlatformZoomMetaKey:()=>fa.isPlatformMac()?"metaKey":"ctrlKey",isZoomCommand:(h,e)=>{const t=e?Se.KEY_EQUALS:Se.KEY_MINUS,i=fa.getPlatformZoomMetaKey();return h[i]&&Se.isKeyEvent(h,t)},isZoomResetCommand:h=>{const e=fa.getPlatformZoomMetaKey();return h[e]&&Se.isKeyEvent(h,Se.KEY_0)}};te.register("KeyboardZoomUtils",fa);const Ep={INPUT:[...Se.ARROW_KEYS,Se.KEY_PAGE_UP,Se.KEY_PAGE_DOWN,Se.KEY_HOME,Se.KEY_END,Se.KEY_ENTER,Se.KEY_SPACE],DIV:[...Se.ARROW_KEYS,...Se.WASD_KEYS],P:[Se.KEY_ESCAPE],BUTTON:[Se.KEY_ENTER,Se.KEY_SPACE]},kp=Se.ALL_KEYS,Op=100,kL=.1,jm=.6,OL=jm+.1,ML="keydown",RL="keyup";class NL{constructor(e,t){this.display=e,this.random=new Ku({seed:t}),this.numberOfComponentsTested=10,this.keyupListeners=[],this.currentElement=null}chooseNextElement(){if(this.currentElement===null)this.currentElement=document.activeElement;else if(this.random.nextDouble()<kL){sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.KeyboardFuzzer("choosing new element"),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.push(),this.clearListeners();const e=Dt.getRandomFocusable(this.random);e.focus(),this.currentElement=e,sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.pop()}}clearListeners(){this.keyupListeners.forEach(e=>{assert&&assert(typeof e.timeout=="function","should have an attached timeout"),Wi.clearTimeout(e.timeout),e(),assert&&assert(!this.keyupListeners.includes(e),"calling listener should remove itself from the keyupListeners.")})}triggerClickEvent(){sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.KeyboardFuzzer("triggering click"),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.push();const e=document.activeElement;e instanceof HTMLElement&&e.click(),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.pop()}triggerKeyDownUpEvents(e){sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.KeyboardFuzzer(`trigger keydown/up: ${e}`),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.push(),this.triggerDOMEvent(ML,e);const t=this.random.nextInt(Op),i=()=>{this.triggerDOMEvent(RL,e),this.keyupListeners.includes(i)&&this.keyupListeners.splice(this.keyupListeners.indexOf(i),1)};i.timeout=Wi.setTimeout(i,t===Op?2e3:t),this.keyupListeners.push(i),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.pop()}triggerRandomKeyDownUpEvents(e){const t=kp[Math.floor(this.random.nextDouble()*(kp.length-1))];sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.KeyboardFuzzer(`trigger random keydown/up: ${t}`),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.push(),this.triggerKeyDownUpEvents(t),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.pop()}fuzzBoardEvents(e){if(this.display&&this.display._input&&this.display._input.pdomPointer){const t=this.display._input.pdomPointer;t&&!t.blockTrustedEvents&&(t.blockTrustedEvents=!0)}for(let t=0;t<this.numberOfComponentsTested;t++){this.chooseNextElement();for(let i=0;i<e/this.numberOfComponentsTested;i++){sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.KeyboardFuzzer(`main loop, i=${i}`),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.push();const s=document.activeElement;if(s&&Ep[s.tagName.toUpperCase()]){const n=this.random.nextDouble();if(n<jm){const o=Ep[s.tagName],c=this.random.sample(o);this.triggerKeyDownUpEvents(c)}else n<OL?this.triggerClickEvent():this.triggerRandomKeyDownUpEvents(s)}else s&&this.triggerRandomKeyDownUpEvents(s);sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.pop()}}}triggerDOMEvent(e,t){if(document.activeElement){const i=new KeyboardEvent(e,{bubbles:!0,code:t,shiftKey:Hs.shiftKeyDown,altKey:Hs.altKeyDown,ctrlKey:Hs.ctrlKeyDown});document.activeElement.dispatchEvent(i)}}}te.register("KeyboardFuzzer",NL);class BL extends Sl{constructor(e,t){const i=st()({outerStroke:Bi.OUTER_LIGHT_GROUP_FOCUS_COLOR,innerStroke:Bi.INNER_LIGHT_GROUP_FOCUS_COLOR,outerLineWidth:Bi.GROUP_OUTER_LINE_WIDTH,innerLineWidth:Bi.GROUP_INNER_LINE_WIDTH,useGroupDilation:!0},t);super(e,i)}}te.register("GroupHighlightFromNode",BL);const Mp="rgba(255,255,0,0.5)",ug=class ug extends Sl{constructor(e,t){const i=st()({innerStroke:null,outerStroke:null,fill:Mp},t);super(e,i)}};ug.ACTIVATED_HIGHLIGHT_COLOR=Mp;let mh=ug;te.register("ActivatedReadingBlockHighlight",mh);const FL=mh,Vo="PRIMARY_SIBLING",HL="LABEL_SIBLING",VL="DESCRIPTION_SIBLING",zL="CONTAINER_PARENT",$L=Dt.TAGS.LABEL,GL=Dt.TAGS.INPUT,Wc="disabled",WL={attributes:!1,childList:!0,characterData:!0};let UL=1;const ia=new $e(0,0,0,0),Qn=new $e(0,0,0,0),Rp=new Ze,Np=new Ze,YL=new Ze;class Os{constructor(e,t){this.initializePDOMPeer(e,t)}initializePDOMPeer(e,t){return t=ds({primarySibling:null},t),assert&&assert(!this.id||this.isDisposed,"If we previously existed, we need to have been disposed"),this.id=this.id||UL++,this.pdomInstance=e,this.node=this.pdomInstance.node,this.display=e.display,this.trail=e.trail,this.visible=null,this.focusable=null,this._labelSibling=null,this._descriptionSibling=null,this._containerParent=null,this.topLevelElements=[],this.positionDirty=!1,this.forceReflowWorkaround=!1,this.childPositionDirty=!1,this.positionInPDOM=!1,this.mutationObserver=this.mutationObserver||new MutationObserver(this.invalidateCSSPositioning.bind(this,!1)),this.transformListener=this.transformListener||this.invalidateCSSPositioning.bind(this,!1),this.pdomInstance.transformTracker.addListener(this.transformListener),this._preservedDisabledValue=null,this.isDisposed=!1,this.pdomInstance.isRootInstance&&(this._primarySibling=t.primarySibling,this._primarySibling.classList.add(dd.ROOT_CLASS_NAME),Dt.BLOCKED_DOM_EVENTS.forEach(i=>{this._primarySibling.addEventListener(i,s=>{s.stopPropagation()})})),this}update(e){let t=this.node.getBaseOptions();const i=[];this.node.accessibleName!==null&&(t=this.node.accessibleNameBehavior(this.node,t,this.node.accessibleName,i),assert&&assert(typeof t=="object","should return an object")),this.node.pdomHeading!==null&&(t=this.node.pdomHeadingBehavior(this.node,t,this.node.pdomHeading,i),assert&&assert(typeof t=="object","should return an object")),this.node.helpText!==null&&(t=this.node.helpTextBehavior(this.node,t,this.node.helpText,i),assert&&assert(typeof t=="object","should return an object")),this._primarySibling=ih(t.tagName,this.node.focusable,{namespace:t.pdomNamespace}),t.containerTagName&&(this._containerParent=ih(t.containerTagName,!1)),t.labelTagName&&(this._labelSibling=ih(t.labelTagName,!1,{excludeFromInput:this.node.excludeLabelSiblingFromInput})),t.descriptionTagName&&(this._descriptionSibling=ih(t.descriptionTagName,!1)),e&&this.updateIndicesStringAndElementIds(),this.orderElements(t),this.mutationObserver.disconnect(),this.mutationObserver.observe(this._primarySibling,WL),t.labelContent&&t.labelTagName!==null&&this.setLabelSiblingContent(t.labelContent),t.innerContent&&t.tagName!==null&&this.setPrimarySiblingContent(t.innerContent),t.descriptionContent&&t.descriptionTagName!==null&&this.setDescriptionSiblingContent(t.descriptionContent),t.tagName.toUpperCase()===GL&&t.inputType&&this.setAttributeToElement("type",t.inputType),t.labelTagName&&t.labelTagName.toUpperCase()===$L&&this.setAttributeToElement("for",this._primarySibling.id,{elementName:Os.LABEL_SIBLING}),this.setFocusable(this.node.focusable),this.setPositionInPDOM(this.node.positionInPDOM),this.onAriaLabelledbyAssociationChange(),this.onAriaDescribedbyAssociationChange(),this.onActiveDescendantAssociationChange(),this.onAttributeChange(t),this.onClassChange(),this.onInputValueChange(),this.node.updateOtherNodesAriaLabelledby(),this.node.updateOtherNodesAriaDescribedby(),this.node.updateOtherNodesActiveDescendant(),i.forEach(s=>{assert&&assert(typeof s=="function"),s()})}orderElements(e){this._containerParent?(this._containerParent.insertBefore(this._primarySibling,this._containerParent.children[0]||null),this.topLevelElements=[this._containerParent]):this.topLevelElements=[this._labelSibling,this._descriptionSibling,this._primarySibling].filter(_.identity),this._labelSibling&&this.arrangeContentElement(this._labelSibling,e.appendLabel),this._descriptionSibling&&this.arrangeContentElement(this._descriptionSibling,e.appendDescription)}getPrimarySibling(){return this._primarySibling}get primarySibling(){return this.getPrimarySibling()}getLabelSibling(){return this._labelSibling}get labelSibling(){return this.getLabelSibling()}getDescriptionSibling(){return this._descriptionSibling}get descriptionSibling(){return this.getDescriptionSibling()}getContainerParent(){return this._containerParent}get containerParent(){return this.getContainerParent()}getTopLevelElementContainingPrimarySibling(){return this._containerParent||this._primarySibling}onAriaLabelledbyAssociationChange(){this.removeAttributeFromAllElements("aria-labelledby");for(let e=0;e<this.node.ariaLabelledbyAssociations.length;e++){const t=this.node.ariaLabelledbyAssociations[e];assert&&assert(t.otherNode.nodesThatAreAriaLabelledbyThisNode.indexOf(this.node)>=0,"unexpected otherNode"),this.setAssociationAttribute("aria-labelledby",t)}}onAriaDescribedbyAssociationChange(){this.removeAttributeFromAllElements("aria-describedby");for(let e=0;e<this.node.ariaDescribedbyAssociations.length;e++){const t=this.node.ariaDescribedbyAssociations[e];assert&&assert(t.otherNode.nodesThatAreAriaDescribedbyThisNode.indexOf(this.node)>=0,"unexpected otherNode"),this.setAssociationAttribute("aria-describedby",t)}}onActiveDescendantAssociationChange(){this.removeAttributeFromAllElements("aria-activedescendant");for(let e=0;e<this.node.activeDescendantAssociations.length;e++){const t=this.node.activeDescendantAssociations[e];assert&&assert(t.otherNode.nodesThatAreActiveDescendantToThisNode.indexOf(this.node)>=0,"unexpected otherNode"),this.setAssociationAttribute("aria-activedescendant",t)}}handleAttributeWithPDOMOption(e,t){typeof t=="string"?this.setAttributeToElement(e,t):this.removeAttributeFromElement(e)}onAttributeChange(e){for(let t=0;t<this.node.pdomAttributes.length;t++){const i=this.node.pdomAttributes[t];this.setAttributeToElement(i.attribute,i.value,i.options)}this.handleAttributeWithPDOMOption("aria-label",e.ariaLabel),this.handleAttributeWithPDOMOption("role",e.ariaRole)}onClassChange(){for(let e=0;e<this.node.pdomClasses.length;e++){const t=this.node.pdomClasses[e];this.setClassToElement(t.className,t.options)}}onInputValueChange(){if(assert&&assert(this.node.inputValue!==void 0,"use null to remove input value attribute"),this.node.inputValue===null)this.removeAttributeFromElement("value");else{const e=`${this.node.inputValue}`;this.setAttributeToElement("value",e,{asProperty:!0})}}getElementByName(e){if(e===Os.PRIMARY_SIBLING)return this._primarySibling;if(e===Os.LABEL_SIBLING)return this._labelSibling;if(e===Os.DESCRIPTION_SIBLING)return this._descriptionSibling;if(e===Os.CONTAINER_PARENT)return this._containerParent;throw new Error(`invalid elementName name: ${e}`)}setAttributeToElement(e,t,i){i=ds({namespace:null,asProperty:!1,elementName:Vo,element:null},i);const s=i.element||this.getElementByName(i.elementName),n=Dt.unwrapProperty(t);let o=n;typeof n=="string"&&(o=qu(n)),e===Wc&&!this.display.interactive&&(this._preservedDisabledValue=i.asProperty?o:!0),i.namespace?s.setAttributeNS(i.namespace,e,o):i.asProperty?s[e]=o:s.setAttribute(e,o)}removeAttributeFromElement(e,t){t=ds({namespace:null,elementName:Vo,element:null},t);const i=t.element||this.getElementByName(t.elementName);t.namespace?i.removeAttributeNS(t.namespace,e):e===Wc&&!this.display.interactive?this._preservedDisabledValue=!1:i.removeAttribute(e)}removeAttributeFromAllElements(e){assert&&assert(e!==Wc,"this method does not currently support disabled, to make Display.interactive toggling easier to implement"),assert&&assert(typeof e=="string"),this._primarySibling&&this._primarySibling.removeAttribute(e),this._labelSibling&&this._labelSibling.removeAttribute(e),this._descriptionSibling&&this._descriptionSibling.removeAttribute(e),this._containerParent&&this._containerParent.removeAttribute(e)}setClassToElement(e,t){assert&&assert(typeof e=="string"),t=ds({elementName:Vo},t),this.getElementByName(t.elementName).classList.add(e)}removeClassFromElement(e,t){assert&&assert(typeof e=="string"),t=ds({elementName:Vo},t),this.getElementByName(t.elementName).classList.remove(e)}setAssociationAttribute(e,t){assert&&assert(Dt.ASSOCIATION_ATTRIBUTES.indexOf(e)>=0,`unsupported attribute for setting with association object: ${e}`);const i=t.otherNode.getPDOMInstances();if(i.length>0){const s=i[0];s===this.pdomInstance&&(s.peer=this),assert&&assert(s.peer,"peer should exist");const n=s.peer.getElementByName(t.otherElementName),o=this.getElementByName(t.thisElementName);if(o&&n){const c=o.getAttribute(e)||"";assert&&assert(typeof c=="string");const p=[c.trim(),n.id].join(" ").trim();this.setAttributeToElement(e,p,{elementName:t.thisElementName})}}}arrangeContentElement(e,t){if(this.topLevelElements[0]===this._containerParent)assert&&assert(this.topLevelElements.length===1),t?this._containerParent.appendChild(e):this._containerParent.insertBefore(e,this._primarySibling);else{is(this.topLevelElements,e);const i=this.topLevelElements.indexOf(this._primarySibling),s=t?this.topLevelElements.length:i;this.topLevelElements.splice(s,0,e)}}isVisible(){if(assert){let e=0;this.topLevelElements.forEach(t=>{!t.hidden&&!t.hasAttribute("hidden")&&(e+=1)}),assert(this.visible?e===this.topLevelElements.length:e===0,"some of the peer's elements are visible and some are not")}return this.visible===null?!0:this.visible}setVisible(e){if(assert&&assert(typeof e=="boolean"),this.visible!==e){this.visible=e;for(let t=0;t<this.topLevelElements.length;t++){const i=this.topLevelElements[t];e?this.removeAttributeFromElement("hidden",{element:i}):this.setAttributeToElement("hidden","",{element:i})}this.invalidateCSSPositioning(Ui.safari)}}isFocused(){const e=En.guessVisualTrail(this.trail,this.display.rootNode);return mi.pdomFocusProperty.value&&mi.pdomFocusProperty.value.trail.equals(e)}focus(){assert&&assert(this._primarySibling,"must have a primary sibling to focus"),mi.windowHasFocusProperty.value&&this._primarySibling.focus()}blur(){assert&&assert(this._primarySibling,"must have a primary sibling to blur"),this._primarySibling.blur()}setFocusable(e){assert&&assert(typeof e=="boolean");const t=this.isFocused();this.focusable!==e&&(this.focusable=e,Dt.overrideFocusWithTabIndex(this.primarySibling,e),t&&!e&&this.blur(),this.invalidateCSSPositioning())}setLabelSiblingContent(e){assert&&assert(e===null||typeof e=="string","incorrect label content type"),this._labelSibling&&Dt.setTextContent(this._labelSibling,e)}setDescriptionSiblingContent(e){assert&&assert(e===null||typeof e=="string","incorrect description content type"),this._descriptionSibling&&Dt.setTextContent(this._descriptionSibling,e)}setPrimarySiblingContent(e){assert&&assert(e===null||typeof e=="string","incorrect inner content type"),assert&&assert(this.pdomInstance.children.length===0,"descendants exist with accessible content, innerContent cannot be used"),assert&&assert(Dt.tagNameSupportsContent(this._primarySibling.tagName),`tagName: ${this.node.tagName} does not support inner content`),this._primarySibling&&Dt.setTextContent(this._primarySibling,e)}setPDOMTransformSourceNode(e){this.pdomInstance.transformTracker.removeListener(this.transformListener),this.pdomInstance.updateTransformTracker(e),this.pdomInstance.transformTracker.addListener(this.transformListener),this.invalidateCSSPositioning()}setPositionInPDOM(e){this.positionInPDOM=e,this.invalidateCSSPositioning()}getElementId(e,t){return`display${this.display.id}-${e}-${t}`}updateIndicesStringAndElementIds(){const e=this.pdomInstance.getPDOMInstanceUniqueId();this._primarySibling&&(this._primarySibling.setAttribute(Dt.DATA_PDOM_UNIQUE_ID,e),this._primarySibling.id=this.getElementId("primary",e)),this._labelSibling&&(this._labelSibling.setAttribute(Dt.DATA_PDOM_UNIQUE_ID,e),this._labelSibling.id=this.getElementId("label",e)),this._descriptionSibling&&(this._descriptionSibling.setAttribute(Dt.DATA_PDOM_UNIQUE_ID,e),this._descriptionSibling.id=this.getElementId("description",e)),this._containerParent&&(this._containerParent.setAttribute(Dt.DATA_PDOM_UNIQUE_ID,e),this._containerParent.id=this.getElementId("container",e))}invalidateCSSPositioning(e=!1){if(!this.positionDirty){if(this.positionDirty=!0,e){this.forceReflowWorkaround=!0;for(let i=0;i<this.topLevelElements.length;i++)this.topLevelElements[i].style.transform="scale(1)"}let t=this.pdomInstance.parent;for(;t;)t.peer.childPositionDirty=!0,t=t.parent}}positionElements(e){if(assert&&assert(this._primarySibling,"a primary sibling required to receive CSS positioning"),assert&&assert(this.positionDirty,"elements should only be repositioned if dirty"),e){const t=this.node.pdomTransformSourceNode||this.node;if(ia.set(t.localBounds),ia.isFinite()){ia.transform(this.pdomInstance.transformTracker.getMatrix());const i=this.display.bounds;if(i.intersectsBounds(ia)){ia.constrainBounds(i);let s=Fp(this._primarySibling),n=s.width,o=s.height;n>0&&o>0&&(Qn.setMinMax(0,0,n,o),Qn.transform(Bp(n,o,ia)),sh(this._primarySibling,Qn)),this.labelSibling&&(s=Fp(this._labelSibling),n=s.width,o=s.height,o>0&&n>0&&(Qn.setMinMax(0,0,n,o),Qn.transform(Bp(n,o,ia)),sh(this._labelSibling,Qn)))}}}else Qn.set(Os.OFFSCREEN_SIBLING_BOUNDS),sh(this._primarySibling,Qn),this._labelSibling&&sh(this._labelSibling,Qn);this.forceReflowWorkaround&&this.topLevelElements.forEach(t=>{t.style.transform="",t.style.offsetHeight}),this.positionDirty=!1,this.forceReflowWorkaround=!1}updateSubtreePositioning(e=!1){this.childPositionDirty=!1;const t=this.positionInPDOM||e;this.positionDirty&&this.positionElements(t);for(let i=0;i<this.pdomInstance.children.length;i++){const s=this.pdomInstance.children[i].peer;(s.positionDirty||s.childPositionDirty)&&this.pdomInstance.children[i].peer.updateSubtreePositioning(t)}}recursiveDisable(e){e?(this._preservedDisabledValue=this._primarySibling.disabled,this._primarySibling.disabled=!0):this._primarySibling.disabled=this._preservedDisabledValue;for(let t=0;t<this.pdomInstance.children.length;t++)this.pdomInstance.children[t].peer.recursiveDisable(e)}dispose(){this.isDisposed=!0,this.blur(),this._primarySibling.removeEventListener("blur",this.blurEventListener),this._primarySibling.removeEventListener("focus",this.focusEventListener),this.pdomInstance.transformTracker.removeListener(this.transformListener),this.mutationObserver.disconnect(),this.pdomInstance=null,this.node=null,this.display=null,this.trail=null,this._primarySibling=null,this._labelSibling=null,this._descriptionSibling=null,this._containerParent=null,this.focusable=null,this.freeToPool()}}Os.PRIMARY_SIBLING=Vo;Os.LABEL_SIBLING=HL;Os.DESCRIPTION_SIBLING=VL;Os.CONTAINER_PARENT=zL;Os.OFFSCREEN_SIBLING_BOUNDS=new $e(0,0,1,1);te.register("PDOMPeer",Os);di.mixInto(Os,{initialize:Os.prototype.initializePDOMPeer});function ih(h,e,t){t=ds({siblingName:null,excludeFromInput:!1},t);const i=Dt.createElement(h,e,t);return t.excludeFromInput&&i.setAttribute(Dt.DATA_EXCLUDE_FROM_INPUT,!0),i}function Bp(h,e,t){return Rp.setToTranslation(t.minX,t.minY),Np.setToScale(t.width/h,t.height/e),Rp.multiplyMatrix(Np).multiplyMatrix(YL)}function Fp(h){let e=h.clientWidth,t=h.clientHeight;if(e===0&&t===0){const i=h.getBoundingClientRect();e=i.width,t=i.height}return{width:e,height:t}}function sh(h,e){h.style.top=`${e.top}px`,h.style.left=`${e.left}px`,h.style.width=`${e.width}px`,h.style.height=`${e.height}px`}const tr=Os,Cr=class Cr extends Ur{};Cr.INDICES=new Cr,Cr.TRAIL_ID=new Cr,Cr.enumeration=new Yr(Cr);let Cn=Cr;const vr=Cn.TRAIL_ID;let KL=1;const Tr=class Tr{constructor(e,t,i){this.relativeNodes=[],this.relativeVisibilities=[],this.relativeListeners=[],this.transformTracker=null,this.initializePDOMInstance(e,t,i)}initializePDOMInstance(e,t,i){if(assert&&assert(!this.id||this.isDisposed,"If we previously existed, we need to have been disposed"),this.id=this.id||KL++,this.parent=e,this.display=t,this.trail=i,this.isRootInstance=e===null,this.node=this.isRootInstance?null:i.lastNode(),this.children=vt(this.children),this.node&&this.node.addPDOMInstance(this),this.invisibleCount=0,this.relativeNodes=[],this.relativeVisibilities=[],this.relativeListeners=[],this.transformTracker=null,this.updateTransformTracker(this.node?this.node.pdomTransformSourceNode:null),this.isDisposed=!1,this.isRootInstance){const s=document.createElement("div");this.peer=tr.createFromPool(this,{primarySibling:s})}else{this.peer=tr.createFromPool(this),this.peer.update(vr===Cn.TRAIL_ID),assert&&assert(this.peer.primarySibling,"accessible peer must have a primarySibling upon completion of construction");const s=this.parent.trail;for(let n=s.length;n<i.length;n++){const o=i.nodes[n];this.relativeNodes.push(o);const c=o._pdomDisplaysInfo.pdomDisplays,p=_.includes(c,t);this.relativeVisibilities.push(p),p||this.invisibleCount++;const f=this.checkAccessibleDisplayVisibility.bind(this,n-s.length);o.pdomDisplaysEmitter.addListener(f),this.relativeListeners.push(f)}this.updateVisibility()}return sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`Initialized ${this.toString()}`),this}addConsecutiveInstances(e){sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`addConsecutiveInstances on ${this.toString()} with: ${e.map(i=>i.toString()).join(",")}`),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.push();const t=this.children.length>0;Array.prototype.push.apply(this.children,e);for(let i=0;i<e.length;i++)assert&&assert(!!this.peer.primarySibling,"Primary sibling must be defined to insert elements."),Dt.insertElements(this.peer.primarySibling,e[i].peer.topLevelElements);t&&this.sortChildren(),assert&&this.node&&(assert&&assert(this.node instanceof tt),this.children.length>0&&assert(!this.node.innerContent,`${this.children.length} child PDOMInstances present but this node has innerContent: ${this.node.innerContent}`)),vr===Cn.INDICES&&this.updateDescendantPeerIds(e),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.pop()}removeInstancesForTrail(e){sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`removeInstancesForTrail on ${this.toString()} with trail ${e.toString()}`),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.push();for(let t=0;t<this.children.length;t++){const i=this.children[t],s=i.trail;let n=s.length<e.length;if(!n){for(let o=this.trail.length;o<e.length;o++)if(e.nodes[o]!==s.nodes[o]){n=!0;break}}n||(this.children.splice(t,1),i.dispose(),t-=1)}sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.pop()}removeAllChildren(){for(sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`removeAllChildren on ${this.toString()}`),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.push();this.children.length;)this.children.pop().dispose();sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.pop()}findChildWithTrail(e){for(let t=0;t<this.children.length;t++){const i=this.children[t];if(i.trail.equals(e))return i}return null}removeSubtree(e){sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`removeSubtree on ${this.toString()} with trail ${e.toString()}`),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.push();for(let t=this.children.length-1;t>=0;t--){const i=this.children[t];i.trail.isExtensionOf(e,!0)&&(sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`Remove parent: ${this.toString()}, child: ${i.toString()}`),this.children.splice(t,1),i.dispose())}sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.pop()}checkAccessibleDisplayVisibility(e){const t=_.includes(this.relativeNodes[e]._pdomDisplaysInfo.pdomDisplays,this.display),i=this.relativeVisibilities[e];if(t!==i){this.relativeVisibilities[e]=t;const s=this.invisibleCount===0;this.invisibleCount+=t?-1:1,assert&&assert(this.invisibleCount>=0&&this.invisibleCount<=this.relativeNodes.length),this.invisibleCount===0!==s&&this.updateVisibility()}}updateVisibility(){assert&&assert(!!this.peer,"Peer needs to be available on update visibility."),this.peer.setVisible(this.invisibleCount<=0),!this.peer.isVisible()&&mi.pdomFocusedNode&&(assert&&assert(mi.pdomFocusedNode.pdomInstances.length===1,"focusable Nodes do not support DAG, and should be connected with an instance if focused."),mi.pdomFocusedNode.pdomInstances[0].trail.containsNode(this.node)&&(mi.pdomFocus=null))}isGloballyVisible(){return assert&&assert(!!this.peer,"PDOMPeer needs to be available, has this PDOMInstance been disposed?"),this.peer.isVisible()?this.parent?this.parent.isGloballyVisible():!0:!1}getChildOrdering(e){const t=e.lastNode(),i=t.getEffectiveChildren();let s;const n=[];if(t.hasPDOMContent&&t!==this.node){const o=t.pdomInstances;e:for(s=0;s<o.length;s++){const c=o[s];if(c.parent===this){for(let p=0;p<e.length;p++)if(e.nodes[p]!==c.trail.nodes[p+c.trail.length-e.length])continue e;n.push(c)}}assert&&assert(n.length<=1,"If we select more than one this way, we have problems")}else for(s=0;s<i.length;s++)e.addDescendant(i[s],s),Array.prototype.push.apply(n,this.getChildOrdering(e)),e.removeDescendant();return n}sortChildren(){var c,p;assert&&assert(this.peer!==null,"peer required for sort");let e;this.isRootInstance?(assert&&assert(this.display!==null,"Display should be available for the root"),e=this.display.rootNode):(assert&&assert(this.node!==null,"Node should be defined, were we disposed?"),e=this.node);const t=this.getChildOrdering(new wt(e));assert&&assert(t.length===this.children.length,"sorting should not change number of children"),this.children=t;const i=this.peer.primarySibling,s=((p=(c=mi.pdomFocusedNode)==null?void 0:c.pdomInstances[0])==null?void 0:p.trail)||null;let n=i.childNodes.length-1;const o=s&&_.find(this.children,f=>s.containsNode(f.peer.node));if(o){const f=_.flatten(this.children.map(O=>O.peer.topLevelElements));if(!_.every(f,(O,T)=>i.children[T]===O)){const O=o.peer.getTopLevelElementContainingPrimarySibling(),T=f.indexOf(O);assert&&assert(T>=0);for(let z=0;z<T;z++)i.insertBefore(f[z],O);for(let z=T+1;z<f.length;z++)i.appendChild(f[z])}}else for(let f=this.children.length-1;f>=0;f--){const w=this.children[f].peer;for(let O=w.topLevelElements.length-1;O>=0;O--){const T=w.topLevelElements[O];i.childNodes[n]!==T&&i.insertBefore(T,i.childNodes[n+1]),n--}}if(assert){const f=_.flatten(this.children.map(w=>w.peer.topLevelElements));assert(_.every(f,(w,O)=>i.children[O]===w))}vr===Cn.INDICES&&this.updateDescendantPeerIds(this.children)}updateTransformTracker(e){this.transformTracker&&this.transformTracker.dispose();let t=null;e?t=e.getUniqueTrail():t=Tr.guessVisualTrail(this.trail,this.display.rootNode),this.transformTracker=new pa(t)}getPDOMInstanceUniqueId(){if(vr===Cn.INDICES){const e=[];let t=this;for(;t.parent;){const i=t.parent.children.indexOf(t);if(i===-1)return"STILL_BEING_CREATED"+Ba.nextDouble();e.unshift(i),t=t.parent}return e.join(Dt.PDOM_UNIQUE_ID_SEPARATOR)}else return assert&&assert(vr===Cn.TRAIL_ID),this.trail.getUniqueId()}updateDescendantPeerIds(e){assert&&assert(vr===Cn.INDICES,"method should not be used with uniqueId comes from TRAIL_ID");const t=Array.from(e);for(;t.length>0;){const i=t.shift();i.peer.updateIndicesStringAndElementIds(),t.push(...i.children)}}static uniqueIdToTrail(e,t){return vr===Cn.INDICES?e.getTrailFromPDOMIndicesString(t):(assert&&assert(vr===Cn.TRAIL_ID),wt.fromUniqueId(e.rootNode,t))}dispose(){sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`Disposing ${this.toString()}`),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.push(),assert&&assert(!!this.peer,"PDOMPeer required, were we already disposed?");const e=this.peer;if(!this.isRootInstance){Dt.removeElements(this.parent.peer.primarySibling,e.topLevelElements);for(let t=0;t<this.relativeNodes.length;t++)this.relativeNodes[t].pdomDisplaysEmitter.removeListener(this.relativeListeners[t])}for(;this.children.length;)this.children.pop().dispose();e.dispose(),this.transformTracker.dispose(),this.transformTracker=null,this.node&&this.node.removePDOMInstance(this),this.relativeNodes=null,this.display=null,this.trail=null,this.node=null,this.peer=null,this.isDisposed=!0,this.freeToPool(),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.pop()}toString(){return`${this.id}#{${this.trail.toString()}}`}auditRoot(){if(!assert)return;const e=this.display.rootNode;assert(this.trail.length===0,"Should only call auditRoot() on the root PDOMInstance for a display");function t(i,s){assert&&assert(i.children.length===s.children.length,"Different number of children in accessible instance"),assert&&assert(i.node===s.node,"Node mismatch for PDOMInstance");for(let c=0;c<s.children.length;c++)t(i.children[c],s.children[c]);const n=s.isGloballyVisible();let o=!0;for(let c=0;c<s.trail.length;c++)if(s.trail.nodes[c].getTrailsTo(e).filter(w=>w.isPDOMVisible()).length===0){o=!1;break}assert&&assert(n===o,"Instance visibility mismatch")}t(Tr.createFakePDOMTree(e),this)}static guessVisualTrail(e,t){e.reindex();const i=e.indices.lastIndexOf(-1);if(i<0)return e;const s=i+1,o=e.nodes[s].getTrailsTo(t);if(o.length===0)return e;const c=o[0];for(let p=s+1;p<e.length;p++)c.addDescendant(e.nodes[p]);return assert&&assert(c.isValid(),`trail not valid: ${e.uniqueId}`),c}static createFakePDOMTree(e){function t(i){let s=_.flatten(i.getEffectiveChildren().map(t));return i.hasPDOMContent&&(s=[{node:i,children:s}]),s}return{node:null,children:t(e)}}freeToPool(){Tr.pool.freeToPool(this)}};Tr.pool=new qi(Tr,{initialize:Tr.prototype.initializePDOMInstance});let yh=Tr;te.register("PDOMInstance",yh);const En=yh,Kt={addChild(h,e){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`addChild parent:n#${h._id}, child:n#${e._id}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),assert&&assert(h instanceof tt),assert&&assert(e instanceof tt),assert&&assert(!e._rendererSummary.hasNoPDOM());const t=Kt.beforeOp();e._pdomParent||Kt.addTree(h,e),Kt.afterOp(t),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},removeChild(h,e){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`removeChild parent:n#${h._id}, child:n#${e._id}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),assert&&assert(h instanceof tt),assert&&assert(e instanceof tt),assert&&assert(!e._rendererSummary.hasNoPDOM());const t=Kt.beforeOp();e._pdomParent||Kt.removeTree(h,e),Kt.afterOp(t),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},childrenOrderChange(h){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`childrenOrderChange node:n#${h._id}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),assert&&assert(h instanceof tt),assert&&assert(!h._rendererSummary.hasNoPDOM());const e=Kt.beforeOp();Kt.reorder(h),Kt.afterOp(e),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},pdomOrderChange(h,e,t){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`pdomOrderChange n#${h._id}: ${Kt.debugOrder(e)},${Kt.debugOrder(t)}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),assert&&assert(h instanceof tt);const i=Kt.beforeOp(),s=[],n=[];da(e||[],t||[],s,n),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`removed: ${Kt.debugOrder(s)}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`added: ${Kt.debugOrder(n)}`);let o,c;if(assert){for(o=0;o<s;o++)assert(s[o]===null||s[o]._pdomParent===h,"Node should have had a pdomOrder");for(o=0;o<n;o++)assert(n[o]===null||n[o]._pdomParent===null,"Node is already specified in a pdomOrder")}const p=Kt.findPDOMTrails(h);for(o=0;o<s.length;o++){const f=s[o];f&&(Kt.removeTree(h,f,p),f._pdomParent=null,f.pdomParentChangedEmitter.emit())}for(o=0;o<n.length;o++){const f=n[o];if(f){const w=f._parents;for(c=0;c<w.length;c++)Kt.removeTree(w[c],f);f._pdomParent=h,f.pdomParentChangedEmitter.emit()}}for(o=0;o<s.length;o++){const f=s[o];if(f){const w=f._parents;for(c=0;c<w.length;c++)Kt.addTree(w[c],f)}}for(o=0;o<n.length;o++){const f=n[o];f&&Kt.addTree(h,f,p)}Kt.reorder(h,p),Kt.afterOp(i),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},pdomContentChange(h){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`pdomContentChange n#${h._id}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),assert&&assert(h instanceof tt);const e=Kt.beforeOp();let t;const i=h._pdomParent?[h._pdomParent]:h._parents,s=[];for(t=0;t<i.length;t++){const n=i[t],o=Kt.findPDOMTrails(n);s.push(o),Kt.removeTree(n,h,o)}for(t=0;t<i.length;t++)Kt.addTree(i[t],h,s[t]);for(t=0;t<h._rootedDisplays.length;t++){const n=h._rootedDisplays[t];n._accessible&&Kt.rebuildInstanceTree(n._rootPDOMInstance)}Kt.afterOp(e),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},rebuildInstanceTree(h){const e=h.display.rootNode;assert&&assert(e),h.removeAllChildren(),h.addConsecutiveInstances(Kt.createTree(new wt(e),h.display,h))},addTree(h,e,t){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`addTree parent:n#${h._id}, child:n#${e._id}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),assert&&Kt.auditNodeForPDOMCycles(h),t=t||Kt.findPDOMTrails(h);for(let i=0;i<t.length;i++){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`trail: ${t[i].trail.toString()} full:${t[i].fullTrail.toString()} for ${t[i].pdomInstance.toString()} root:${t[i].isRoot}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push();const s=t[i],n=s.pdomInstance;s.fullTrail.addDescendant(e);const o=Kt.createTree(s.fullTrail,n.display,n);s.fullTrail.removeDescendant(e),n.addConsecutiveInstances(o),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()}sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},removeTree(h,e,t){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`removeTree parent:n#${h._id}, child:n#${e._id}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),t=t||Kt.findPDOMTrails(h);for(let i=0;i<t.length;i++){const s=t[i];s.fullTrail.addDescendant(e),s.pdomInstance.removeInstancesForTrail(s.fullTrail),s.fullTrail.removeDescendant(e)}sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},reorder(h,e){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`reorder n#${h._id}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),e=e||Kt.findPDOMTrails(h);for(let t=0;t<e.length;t++)e[t].pdomInstance.sortChildren();sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},createTree(h,e,t){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`createTree ${h.toString()} parent:${t?t.toString():"null"}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push();const i=h.lastNode(),s=i.getEffectiveChildren();sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`effectiveChildren: ${Kt.debugOrder(s)}`);let n,o=!1;i.hasPDOMContent&&(n=t.findChildWithTrail(h),n?o=!0:n=En.pool.create(t,e,h.copy()),t=n);const c=[];for(let p=0;p<s.length;p++)h.addDescendant(s[p],p),Array.prototype.push.apply(c,Kt.createTree(h,e,t)),h.removeDescendant();return n?(n.addConsecutiveInstances(c),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop(),o?[]:[n]):(sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop(),c)},beforeOp(){return _h.blockFocusCallbacks=!0,mi.pdomFocusedNode},afterOp(h){h&&h.focusable&&h.focus(),_h.blockFocusCallbacks=!1},findPDOMTrails(h){const e=[];return Kt.recursivePDOMTrailSearch(e,new wt(h)),e},recursivePDOMTrailSearch(h,e){const t=e.rootNode();let i;if(t.hasPDOMContent){const o=t.pdomInstances;for(i=0;i<o.length;i++)h.push(new bu(o[i],e.copy(),!1));return}else{const o=t.rootedDisplays;for(i=0;i<o.length;i++){const c=o[i];c._accessible&&h.push(new bu(c._rootPDOMInstance,e.copy(),!0))}}const s=t._pdomParent?[t._pdomParent]:t._parents,n=s.length;for(i=0;i<n;i++){const o=s[i];e.addAncestor(o),Kt.recursivePDOMTrailSearch(h,e),e.removeAncestor()}},auditPDOMDisplays(h){if(assertSlow)if(h._pdomDisplaysInfo.canHavePDOMDisplays()){let e;const t=[];for(e=0;e<h._parents.length;e++)Array.prototype.push.apply(t,h._parents[e]._pdomDisplaysInfo.pdomDisplays);for(e=0;e<h._rootedDisplays.length;e++){const n=h._rootedDisplays[e];n._accessible&&t.push(n)}const i=h._pdomDisplaysInfo.pdomDisplays.slice(),s=t.slice();for(assertSlow(i.length===s.length),e=0;e<s.length;e++)for(let n=0;n<i.length;n++)if(s[e]===i[n]){s.splice(e,1),i.splice(n,1),e--;break}assertSlow(i.length===0&&s.length===0,"Mismatch with accessible pdom displays")}else assertSlow(h._pdomDisplaysInfo.pdomDisplays.length===0,"Invisible/nonaccessible things should have no displays")},auditNodeForPDOMCycles(h){if(assert){const e=new wt(h);(function t(){const i=e.rootNode();assert(e.length<=1||i!==h,`Accessible PDOM graph cycle detected. The combined scene-graph DAG with pdomOrder defining additional parent-child relationships should still be a DAG. Cycle detected with the trail: ${e.toString()} path: ${e.toPathString()}`);const s=i._parents.length;for(let n=0;n<s;n++){const o=i._parents[n];e.addAncestor(o),t(),e.removeAncestor()}i._pdomParent&&!i._pdomParent.hasChild(i)&&(e.addAncestor(i._pdomParent),t(),e.removeAncestor())})()}},debugOrder(h){return h===null?"null":`[${h.map(e=>e===null?"null":e._id).join(",")}]`}};te.register("PDOMTree",Kt);const fn=Kt;class qL{constructor(e,t,i){assert&&assert(e>=2),i=i||null,this.nodeCount=e,this.logToConsole=t,this.nodes=_.range(0,e).map(()=>new tt),this.display=new cs(this.nodes[0]),this.random=new Ku({seed:i}),this.actionsTaken=[]}step(){const e=this.random.sample(this.enumerateActions());if(this.logToConsole&&console.log(e.text),this.actionsTaken.push(e),e.execute(),this.display._rootPDOMInstance.auditRoot(),fn.auditPDOMDisplays(this.display.rootNode),this.logToConsole)for(let t=0;t<this.nodes.length;t++){const i=this.nodes[t];console.log(`${t}#${i.id} ${i.tagName} ch:${fn.debugOrder(i.children)} or:${fn.debugOrder(i.pdomOrder)} vis:${i.visible} avis:${i.pdomVisible}`)}}enumerateActions(){const e=[];return this.nodes.forEach(t=>{e.push({text:`#${t.id}.visible = ${!t.visible}`,execute:()=>{t.visible=!t.visible}}),e.push({text:`#${t.id}.pdomVisible = ${!t.pdomVisible}`,execute:()=>{t.pdomVisible=!t.pdomVisible}}),["span","div",null].forEach(i=>{t.tagName!==i&&e.push({text:`#${t.id}.tagName = ${i}`,execute:()=>{t.tagName=i}})}),this.powerSet(da(this.nodes,[t]).concat([null])).forEach(i=>{vb.forEachPermutation(i,s=>{this.isPDOMOrderChangeLegal(t,s)&&e.push({text:`#${t.id}.pdomOrder = ${fn.debugOrder(s)}`,execute:()=>{t.pdomOrder=s}})})}),this.nodes.forEach(i=>{this.isAddChildLegal(t,i)&&_.range(0,t.children.length+1).forEach(s=>{e.push({text:`#${t.id}.insertChild(${s},#${i.id})`,execute:()=>{t.insertChild(s,i)}})}),t.hasChild(i)&&e.push({text:`#${t.id}.removeChild(#${i.id})`,execute:()=>{t.removeChild(i)}})})}),e}isAddChildLegal(e,t){return!e.hasChild(t)&&this.isAcyclic(e,t)}powerSet(e){if(e.length===0)return[[]];{const t=this.powerSet(e.slice(1));return t.concat(t.map(i=>[e[0]].concat(i)))}}isPDOMOrderChangeLegal(e,t){if(t===null&&(t=[]),t=t.filter(n=>n!==null),_.includes(t,e)||_.uniq(t).length<t.length)return!1;for(let n=0;n<t.length;n++)if(t[n]._pdomParent&&t[n]._pdomParent!==e)return!1;const i=(n,o)=>n===e?n.hasChild(o)||_.includes(t,o):n.hasChild(o)||!!n.pdomOrder&&_.includes(n.pdomOrder,o),s=e.children.concat(t);return _.every(s,n=>this.isAcyclic(e,n,i))}isAcyclic(e,t,i){if(e===t)return!1;const s=t.children.concat(t.pdomOrder).filter(n=>n!==null);for(;s.length;){const n=s.pop();if(n===e)return!1;i?this.nodes.forEach(o=>{i(n,o)&&s.push(o)}):(Array.prototype.push.apply(s,n.children),n.pdomOrder&&Array.prototype.push.apply(s,n.pdomOrder.filter(o=>o!==null)))}return!0}dispose(){this.display.dispose()}}te.register("PDOMFuzzer",qL);const xr=class xr extends Ur{};xr.DRAG=new xr,xr.KEYBOARD_DRAG=new xr,xr.enumeration=new Yr(xr,{phetioDocumentation:"entries when signifying Intent of the pointer"});let hs=xr;const nl=class nl{constructor(e,t){assert&&assert(e===null||e instanceof Pe),assert&&assert(Object.getPrototypeOf(this)!==nl.prototype,"Pointer is an abstract class"),this.point=e,this.type=t,this.trail=null,this.inputEnabledTrail=null,this.isDownProperty=new ci(!1),this.attachedProperty=new ci(!1),this._listeners=[],this._attachedListener=null,this._cursor=null,this.lastEventContext=null,this._intents=[],this._pointerCaptured=!1,this._listenerForDragReserve=null,this._listenerForKeyboardDragReserve=null}setCursor(e){return this._cursor=e,this}set cursor(e){this.setCursor(e)}get cursor(){return this.getCursor()}getCursor(){return this._cursor}getListeners(){return this._listeners.slice()}get listeners(){return this.getListeners()}addInputListener(e,t){sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`addInputListener to ${this.toString()} attach:${t}`),sceneryLog&&sceneryLog.Pointer&&sceneryLog.push(),assert&&assert(e,"A listener must be provided"),assert&&assert(t===void 0||typeof t=="boolean","If provided, the attach parameter should be a boolean value"),assert&&assert(!_.includes(this._listeners,e),"Attempted to add an input listener that was already added"),this._listeners.push(e),t&&(assert&&assert(e.interrupt,"Interrupt should exist on attached listeners"),this.attach(e)),sceneryLog&&sceneryLog.Pointer&&sceneryLog.pop()}removeInputListener(e){sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`removeInputListener to ${this.toString()}`),sceneryLog&&sceneryLog.Pointer&&sceneryLog.push(),assert&&assert(e,"A listener must be provided");const t=_.indexOf(this._listeners,e);assert&&assert(t!==-1,"Could not find the input listener to remove"),this.isAttached()&&e===this._attachedListener&&this.detach(e),this._listeners.splice(t,1),sceneryLog&&sceneryLog.Pointer&&sceneryLog.pop()}getAttachedListener(){return this._attachedListener}get attachedListener(){return this.getAttachedListener()}isAttached(){return this.attachedProperty.value}isTouchLike(){return!1}set isDown(e){this.isDownProperty.value=e}get isDown(){return this.isDownProperty.value}interruptAttached(){this.isAttached()&&this._attachedListener.interrupt()}interruptAll(){const e=this._listeners.slice();for(let t=0;t<e.length;t++){const i=e[t];i.interrupt&&i.interrupt()}}attach(e){sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`Attaching to ${this.toString()}`),assert&&assert(!this.isAttached(),"Attempted to attach to an already attached pointer"),this.attachedProperty.value=!0,this._attachedListener=e}updatePoint(e,t="event"){const i=this.hasPointChanged(e);return e&&sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`pointer ${t} at ${e.toString()}`),this.point=e,i}down(e){this.isDown=!0}up(e,t){return this.isDown=!1,this.updatePoint(e,"up")}cancel(e){return this.isDown=!1,this.updatePoint(e,"cancel")}detach(e){sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`Detaching from ${this.toString()}`),assert&&assert(this.isAttached(),"Cannot detach a listener if one is not attached"),assert&&assert(this._attachedListener===e,"Cannot detach a different listener"),this.attachedProperty.value=!1,this._attachedListener=null}hasPointChanged(e){return this.point!==e&&(!e||!this.point||!this.point.equals(e))}addIntent(e){assert&&assert(hs.enumeration.includes(e),"trying to set unsupported intent for Pointer"),this._intents.includes(e)||this._intents.push(e),assert&&assert(this._intents.length<=hs.enumeration.values.length,"to many Intents saved, memory leak likely")}removeIntent(e){if(assert&&assert(hs.enumeration.includes(e),"trying to set unsupported intent for Pointer"),this._intents.includes(e)){const t=this._intents.indexOf(e);this._intents.splice(t,1)}}hasIntent(e){return this._intents.includes(e)}reserveForDrag(){if(!this._intents.includes(hs.DRAG)){this.addIntent(hs.DRAG);const e={up:t=>{this.removeIntent(hs.DRAG),this.removeInputListener(this._listenerForDragReserve),this._listenerForDragReserve=null}};assert&&assert(this._listenerForDragReserve===null,"still a listener to reserve pointer, memory leak likely"),this._listenerForDragReserve=e,this.addInputListener(this._listenerForDragReserve)}}reserveForKeyboardDrag(){if(!this._intents.includes(hs.KEYBOARD_DRAG)){this.addIntent(hs.KEYBOARD_DRAG);const e={keyup:i=>t(),blur:i=>t()},t=()=>{this.removeIntent(hs.KEYBOARD_DRAG),this.removeInputListener(this._listenerForKeyboardDragReserve),this._listenerForKeyboardDragReserve=null};assert&&assert(this._listenerForDragReserve===null,"still a listener on Pointer for reserve, memory leak likely"),this._listenerForKeyboardDragReserve=e,this.addInputListener(this._listenerForKeyboardDragReserve)}}onGotPointerCapture(){this._pointerCaptured=!0}onLostPointerCapture(){this._pointerCaptured&&this.interruptAll(),this._pointerCaptured=!1}dispose(){sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`Disposing ${this.toString()}`),this._listenerForDragReserve&&this._listeners.includes(this._listenerForDragReserve)&&this.removeInputListener(this._listenerForDragReserve),this._listenerForKeyboardDragReserve&&this._listeners.includes(this._listenerForKeyboardDragReserve)&&this.removeInputListener(this._listenerForKeyboardDragReserve),assert&&assert(this._attachedListener===null,"Attached listeners should be cleared before pointer disposal"),assert&&assert(this._listeners.length===0,"Should not have listeners when a pointer is disposed")}toString(){return`Pointer#${this.type}_at_${this.point}`}};nl.PointerIO=new Ai("PointerIO",{valueType:nl,toStateObject:e=>({point:e.point.toStateObject(),type:e.type}),stateSchema:{point:Pe.Vector2IO,type:Ti}});let $r=nl;te.register("Pointer",$r);class qs extends $r{constructor(e){super(e,"mouse"),this.id=null,this.leftDown=!1,this.middleDown=!1,this.rightDown=!1,this.wheelDelta=new Lb(0,0,0),this.wheelDeltaMode=0,sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`Created ${this.toString()}`)}down(e){switch(assert&&assert(e instanceof MouseEvent),e.button){case 0:this.leftDown=!0;break;case 1:this.middleDown=!0;break;case 2:this.rightDown=!0;break}return super.down(e)}up(e,t){switch(assert&&assert(t instanceof MouseEvent),t.button){case 0:this.leftDown=!1;break;case 1:this.middleDown=!1;break;case 2:this.rightDown=!1;break}return super.up(e,t)}move(e){const t=this.hasPointChanged(e);return e&&sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`mouse move at ${e.toString()}`),this.point=e,t}over(e){const t=this.hasPointChanged(e);return e&&sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`mouse over at ${e.toString()}`),this.point=e,t}out(e){const t=this.hasPointChanged(e);return e&&sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`mouse out at ${e.toString()}`),t}wheel(e){assert&&assert(e instanceof WheelEvent);const t=e;this.wheelDelta.setXYZ(t.deltaX,t.deltaY,t.deltaZ),this.wheelDeltaMode=t.deltaMode}toString(){return"Mouse"}}te.register("Mouse",qs);class zo extends $r{constructor(e,t,i){super(t,"touch"),this.id=e,sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`Created ${this.toString()}`)}move(e){const t=this.hasPointChanged(e);return this.point=e,t}toString(){return`Touch#${this.id}`}isTouchLike(){return!0}}te.register("Touch",zo);class Qm extends $r{constructor(e,t,i){super(t,"pen"),this.id=e,sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`Created ${this.toString()}`)}move(e){const t=this.hasPointChanged(e);return this.point=e,t}toString(){return`Pen#${this.id}`}isTouchLike(){return!0}}te.register("Pen",Qm);class no extends $r{constructor(e){super(Pe.ZERO,"pdom"),this.display=e,this.initializeListeners(),this.blockTrustedEvents=!1,this.keydownTargetNode=null,sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`Created ${this.toString()}`)}initializeListeners(){this.addInputListener({focus:e=>{assert&&assert(this.trail,"trail should have been calculated for the focused node");const t=this.trail.lastNode();if(t.focusable){const i=En.guessVisualTrail(this.trail,this.display.rootNode);this.point=i.parentToGlobalPoint(t.center),isNaN(this.point.x)&&this.point.setXY(0,0)}},blur:e=>{this.trail=null,this.keydownTargetNode=null},keydown:e=>{this.blockTrustedEvents&&e.domEvent.isTrusted||(this.keydownTargetNode=e.target)},keyup:e=>{this.blockTrustedEvents&&e.domEvent.isTrusted||this.keydownTargetNode!==e.target&&e.abort()}})}updateTrail(e){return this.trail&&this.trail.equals(e)||(this.trail=e),this.trail}}te.register("PDOMPointer",no);class It{constructor(e){this.domEvent=e,this.activeElement=document.activeElement}static createSynthetic(){return new It(new self.Event("synthetic"))}allowsDOMInput(){var t,i;const e=(t=this.domEvent)==null?void 0:t.target;if(e instanceof Element){let s=e;for(;s;){if(s instanceof HTMLElement&&((i=s.dataset)==null?void 0:i.sceneryAllowInput)==="true")return!0;s=s.parentNode}}return!1}}const Yi=new Ai("EventContextIO",{valueType:It,documentation:"A DOM event and its context",toStateObject:h=>({domEvent:cr.serializeDomEvent(h.domEvent)}),fromStateObject:h=>new It(cr.deserializeDomEvent(h.domEvent)),stateSchema:()=>({domEvent:Br})});te.register("EventContext",It);const Oh=class Oh{constructor(e,t,i,s){this.handled=!1,this.aborted=!1,this.trail=e,this.type=t,this.pointer=i,this.context=s,this.domEvent=s.domEvent,this.activeElement=s.activeElement,this.currentTarget=null,this.target=e.lastNode(),this.isPrimary=!(i instanceof qs)||!this.domEvent||this.domEvent.button===0,i.lastEventContext=s}handle(){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent("handled event"),this.handled=!0}abort(){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent("aborted event"),this.aborted=!0}isFromPDOM(){return this.pointer instanceof no}canStartPress(){return!this.pointer.isAttached()&&(!(this.pointer instanceof qs)||this.domEvent.button===0)}};Oh.SceneryEventIO=new Ai("SceneryEventIO",{valueType:Oh,documentation:'An event, with a "point" field',toStateObject:e=>({type:e.type,domEventType:Ft(Br).toStateObject(e.domEvent),point:e.pointer&&e.pointer.point?Pe.Vector2IO.toStateObject(e.pointer.point):null}),stateSchema:{type:Ti,domEventType:Ft(Br),point:Ft(Pe.Vector2IO)}});let Ms=Oh;te.register("SceneryEvent",Ms);const Hp=Tl($r.PointerIO),XL=["altKey","button","charCode","clientX","clientY","code","ctrlKey","deltaMode","deltaX","deltaY","deltaZ","key","keyCode","metaKey","pageX","pageY","pointerId","pointerType","scale","shiftKey","target","type","relatedTarget","which"],Vp=["deltaMode","deltaX","deltaY","deltaZ","altKey","button","charCode","clientX","clientY","code","ctrlKey","key","keyCode","metaKey","pageX","pageY","pointerId","pointerType","shiftKey","type","relatedTarget","which"],jL=["target","relatedTarget"],QL=["focus","blur","focusin","focusout"],Io="targetSubstitute",ZL=80,oi=class oi extends Hi{constructor(e,t,i,s,n,o){var p,f,w,O,T,z,U,m,Y,j,le,xe,ce,ne,me,Fe,we,He,Me,ze,Je,Ee,rt,Ie;const c=st()({phetioType:oi.InputIO,phetioDocumentation:"Central point for user input events, such as mouse, touch"},o);super(c),this.currentSceneryEvent=null,this.display=e,this.rootNode=e.rootNode,this.attachToWindow=t,this.batchDOMEvents=i,this.assumeFullWindow=s,this.passiveEvents=n,this.batchedEvents=[],this.pdomPointer=null,this.mouse=null,this.pointers=[],this.pointerAddedEmitter=new ri,this.currentlyFiringEvents=!1,this.upTimeStamp=0,this.validatePointersAction=new qt(()=>{let Re=this.pointers.length;for(;Re--;){const We=this.pointers[Re];We.point&&We!==this.pdomPointer&&this.branchChangeEvents(We,We.lastEventContext||It.createSynthetic(),!1)}},{phetioPlayback:!0,tandem:(p=c.tandem)==null?void 0:p.createTandem("validatePointersAction"),phetioHighFrequency:!0}),this.mouseUpAction=new qt((Re,We)=>{const Ve=this.ensureMouse(Re);Ve.id=null,this.upEvent(Ve,We,Re)},{phetioPlayback:!0,tandem:(f=c.tandem)==null?void 0:f.createTandem("mouseUpAction"),parameters:[{name:"point",phetioType:Pe.Vector2IO},{name:"context",phetioType:Yi}],phetioEventType:si.USER,phetioDocumentation:"Emits when a mouse button is released."}),this.mouseDownAction=new qt((Re,We,Ve)=>{const Qe=this.ensureMouse(We);Qe.id=Re,this.downEvent(Qe,Ve,We)},{phetioPlayback:!0,tandem:(w=c.tandem)==null?void 0:w.createTandem("mouseDownAction"),parameters:[{name:"id",phetioType:Ft(Ut)},{name:"point",phetioType:Pe.Vector2IO},{name:"context",phetioType:Yi}],phetioEventType:si.USER,phetioDocumentation:"Emits when a mouse button is pressed."}),this.mouseMoveAction=new qt((Re,We)=>{const Ve=this.ensureMouse(Re);Ve.move(Re),this.moveEvent(Ve,We)},{phetioPlayback:!0,tandem:(O=c.tandem)==null?void 0:O.createTandem("mouseMoveAction"),parameters:[{name:"point",phetioType:Pe.Vector2IO},{name:"context",phetioType:Yi}],phetioEventType:si.USER,phetioDocumentation:"Emits when the mouse is moved.",phetioHighFrequency:!0}),this.mouseOverAction=new qt((Re,We)=>{this.ensureMouse(Re).over(Re)},{phetioPlayback:!0,tandem:(T=c.tandem)==null?void 0:T.createTandem("mouseOverAction"),parameters:[{name:"point",phetioType:Pe.Vector2IO},{name:"context",phetioType:Yi}],phetioEventType:si.USER,phetioDocumentation:"Emits when the mouse is moved while on the sim."}),this.mouseOutAction=new qt((Re,We)=>{this.ensureMouse(Re).out(Re)},{phetioPlayback:!0,tandem:(z=c.tandem)==null?void 0:z.createTandem("mouseOutAction"),parameters:[{name:"point",phetioType:Pe.Vector2IO},{name:"context",phetioType:Yi}],phetioEventType:si.USER,phetioDocumentation:"Emits when the mouse moves out of the display."}),this.wheelScrollAction=new qt(Re=>{const We=Re.domEvent,Ve=this.ensureMouse(this.pointFromEvent(We));if(Ve.wheel(We),Ve.point){const Qe=this.rootNode.trailUnderPointer(Ve)||new wt(this.rootNode);this.dispatchEvent(Qe,"wheel",Ve,Re,!0)}},{phetioPlayback:!0,tandem:(U=c.tandem)==null?void 0:U.createTandem("wheelScrollAction"),parameters:[{name:"context",phetioType:Yi}],phetioEventType:si.USER,phetioDocumentation:"Emits when the mouse wheel scrolls.",phetioHighFrequency:!0}),this.touchStartAction=new qt((Re,We,Ve)=>{const Qe=new zo(Re,We,Ve.domEvent);this.addPointer(Qe),this.downEvent(Qe,Ve,We)},{phetioPlayback:!0,tandem:(m=c.tandem)==null?void 0:m.createTandem("touchStartAction"),parameters:[{name:"id",phetioType:Ut},{name:"point",phetioType:Pe.Vector2IO},{name:"context",phetioType:Yi}],phetioEventType:si.USER,phetioDocumentation:"Emits when a touch begins."}),this.touchEndAction=new qt((Re,We,Ve)=>{const Qe=this.findPointerById(Re);Qe&&(assert&&assert(Qe instanceof zo),this.upEvent(Qe,Ve,We),this.removePointer(Qe))},{phetioPlayback:!0,tandem:(Y=c.tandem)==null?void 0:Y.createTandem("touchEndAction"),parameters:[{name:"id",phetioType:Ut},{name:"point",phetioType:Pe.Vector2IO},{name:"context",phetioType:Yi}],phetioEventType:si.USER,phetioDocumentation:"Emits when a touch ends."}),this.touchMoveAction=new qt((Re,We,Ve)=>{const Qe=this.findPointerById(Re);Qe&&(assert&&assert(Qe instanceof zo),Qe.move(We),this.moveEvent(Qe,Ve))},{phetioPlayback:!0,tandem:(j=c.tandem)==null?void 0:j.createTandem("touchMoveAction"),parameters:[{name:"id",phetioType:Ut},{name:"point",phetioType:Pe.Vector2IO},{name:"context",phetioType:Yi}],phetioEventType:si.USER,phetioDocumentation:"Emits when a touch moves.",phetioHighFrequency:!0}),this.touchCancelAction=new qt((Re,We,Ve)=>{const Qe=this.findPointerById(Re);Qe&&(assert&&assert(Qe instanceof zo),this.cancelEvent(Qe,Ve,We),this.removePointer(Qe))},{phetioPlayback:!0,tandem:(le=c.tandem)==null?void 0:le.createTandem("touchCancelAction"),parameters:[{name:"id",phetioType:Ut},{name:"point",phetioType:Pe.Vector2IO},{name:"context",phetioType:Yi}],phetioEventType:si.USER,phetioDocumentation:"Emits when a touch is canceled."}),this.penStartAction=new qt((Re,We,Ve)=>{const Qe=new Qm(Re,We,Ve.domEvent);this.addPointer(Qe),this.downEvent(Qe,Ve,We)},{phetioPlayback:!0,tandem:(xe=c.tandem)==null?void 0:xe.createTandem("penStartAction"),parameters:[{name:"id",phetioType:Ut},{name:"point",phetioType:Pe.Vector2IO},{name:"context",phetioType:Yi}],phetioEventType:si.USER,phetioDocumentation:"Emits when a pen touches the screen."}),this.penEndAction=new qt((Re,We,Ve)=>{const Qe=this.findPointerById(Re);Qe&&(this.upEvent(Qe,Ve,We),this.removePointer(Qe))},{phetioPlayback:!0,tandem:(ce=c.tandem)==null?void 0:ce.createTandem("penEndAction"),parameters:[{name:"id",phetioType:Ut},{name:"point",phetioType:Pe.Vector2IO},{name:"context",phetioType:Yi}],phetioEventType:si.USER,phetioDocumentation:"Emits when a pen is lifted."}),this.penMoveAction=new qt((Re,We,Ve)=>{const Qe=this.findPointerById(Re);Qe&&(Qe.move(We),this.moveEvent(Qe,Ve))},{phetioPlayback:!0,tandem:(ne=c.tandem)==null?void 0:ne.createTandem("penMoveAction"),parameters:[{name:"id",phetioType:Ut},{name:"point",phetioType:Pe.Vector2IO},{name:"context",phetioType:Yi}],phetioEventType:si.USER,phetioDocumentation:"Emits when a pen is moved.",phetioHighFrequency:!0}),this.penCancelAction=new qt((Re,We,Ve)=>{const Qe=this.findPointerById(Re);Qe&&(this.cancelEvent(Qe,Ve,We),this.removePointer(Qe))},{phetioPlayback:!0,tandem:(me=c.tandem)==null?void 0:me.createTandem("penCancelAction"),parameters:[{name:"id",phetioType:Ut},{name:"point",phetioType:Pe.Vector2IO},{name:"context",phetioType:Yi}],phetioEventType:si.USER,phetioDocumentation:"Emits when a pen is canceled."}),this.gotPointerCaptureAction=new qt((Re,We)=>{const Ve=this.findPointerById(Re);Ve&&Ve.onGotPointerCapture()},{phetioPlayback:!0,tandem:(Fe=c.tandem)==null?void 0:Fe.createTandem("gotPointerCaptureAction"),parameters:[{name:"id",phetioType:Ut},{name:"context",phetioType:Yi}],phetioEventType:si.USER,phetioDocumentation:"Emits when a pointer is captured (normally at the start of an interaction)",phetioHighFrequency:!0}),this.lostPointerCaptureAction=new qt((Re,We)=>{const Ve=this.findPointerById(Re);Ve&&Ve.onLostPointerCapture()},{phetioPlayback:!0,tandem:(we=c.tandem)==null?void 0:we.createTandem("lostPointerCaptureAction"),parameters:[{name:"id",phetioType:Ut},{name:"context",phetioType:Yi}],phetioEventType:si.USER,phetioDocumentation:"Emits when a pointer loses its capture (normally at the end of an interaction)",phetioHighFrequency:!0}),this.focusinAction=new qt(Re=>{const We=this.getPDOMEventTrail(Re.domEvent,"focusin");We&&(sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`focusin(${oi.debugText(null,Re.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.dispatchPDOMEvent(We,"focus",Re,!1),this.dispatchPDOMEvent(We,"focusin",Re,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop())},{phetioPlayback:!0,tandem:(He=c.tandem)==null?void 0:He.createTandem("focusinAction"),parameters:[{name:"context",phetioType:Yi}],phetioEventType:si.USER,phetioDocumentation:"Emits when the PDOM root gets the focusin DOM event."}),this.focusoutAction=new qt(Re=>{const We=this.getPDOMEventTrail(Re.domEvent,"focusout");We&&(sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`focusOut(${oi.debugText(null,Re.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.dispatchPDOMEvent(We,"blur",Re,!1),this.dispatchPDOMEvent(We,"focusout",Re,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop())},{phetioPlayback:!0,tandem:(Me=c.tandem)==null?void 0:Me.createTandem("focusoutAction"),parameters:[{name:"context",phetioType:Yi}],phetioEventType:si.USER,phetioDocumentation:"Emits when the PDOM root gets the focusout DOM event."}),this.clickAction=new qt(Re=>{const We=this.getPDOMEventTrail(Re.domEvent,"click");We&&(sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`click(${oi.debugText(null,Re.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.dispatchPDOMEvent(We,"click",Re,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop())},{phetioPlayback:!0,tandem:(ze=c.tandem)==null?void 0:ze.createTandem("clickAction"),parameters:[{name:"context",phetioType:Yi}],phetioEventType:si.USER,phetioDocumentation:"Emits when the PDOM root gets the click DOM event."}),this.inputAction=new qt(Re=>{const We=this.getPDOMEventTrail(Re.domEvent,"input");We&&(sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`input(${oi.debugText(null,Re.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.dispatchPDOMEvent(We,"input",Re,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop())},{phetioPlayback:!0,tandem:(Je=c.tandem)==null?void 0:Je.createTandem("inputAction"),parameters:[{name:"context",phetioType:Yi}],phetioEventType:si.USER,phetioDocumentation:"Emits when the PDOM root gets the input DOM event."}),this.changeAction=new qt(Re=>{const We=this.getPDOMEventTrail(Re.domEvent,"change");We&&(sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`change(${oi.debugText(null,Re.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.dispatchPDOMEvent(We,"change",Re,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop())},{phetioPlayback:!0,tandem:(Ee=c.tandem)==null?void 0:Ee.createTandem("changeAction"),parameters:[{name:"context",phetioType:Yi}],phetioEventType:si.USER,phetioDocumentation:"Emits when the PDOM root gets the change DOM event."}),this.keydownAction=new qt(Re=>{sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`keydown(${oi.debugText(null,Re.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push();const We=this.getPDOMEventTrail(Re.domEvent,"keydown");We&&this.dispatchPDOMEvent(We,"keydown",Re,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()},{phetioPlayback:!0,tandem:(rt=c.tandem)==null?void 0:rt.createTandem("keydownAction"),parameters:[{name:"context",phetioType:Yi}],phetioEventType:si.USER,phetioDocumentation:"Emits when the PDOM root gets the keydown DOM event."}),this.keyupAction=new qt(Re=>{sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`keyup(${oi.debugText(null,Re.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push();const We=this.getPDOMEventTrail(Re.domEvent,"keydown");We&&this.dispatchPDOMEvent(We,"keyup",Re,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()},{phetioPlayback:!0,tandem:(Ie=c.tandem)==null?void 0:Ie.createTandem("keyupAction"),parameters:[{name:"context",phetioType:Yi}],phetioEventType:si.USER,phetioDocumentation:"Emits when the PDOM root gets the keyup DOM event."})}interruptPointers(e=null){_.each(this.pointers,t=>{t!==e&&t.interruptAll()})}batchEvent(e,t,i,s){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent("Input.batchEvent"),sceneryLog&&sceneryLog.InputEvent&&sceneryLog.push(),this.display.interactive&&(this.batchedEvents.push(bh.pool.create(e,t,i)),(s||!this.batchDOMEvents)&&this.fireBatchedEvents()),this.passiveEvents!==!0&&(i!==this.mouseDown||Ui.edge)&&t!==Wt.ALT_TYPE&&!e.allowsDOMInput()&&e.domEvent.preventDefault(),sceneryLog&&sceneryLog.InputEvent&&sceneryLog.pop()}fireBatchedEvents(){if(sceneryLog&&sceneryLog.InputEvent&&this.currentlyFiringEvents&&sceneryLog.InputEvent("REENTRANCE DETECTED"),!this.currentlyFiringEvents&&this.batchedEvents.length){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`Input.fireBatchedEvents length:${this.batchedEvents.length}`),sceneryLog&&sceneryLog.InputEvent&&sceneryLog.push(),this.currentlyFiringEvents=!0;const e=this.batchedEvents;for(let t=0;t<e.length;t++){const i=e[t];i.run(this),i.dispose()}vt(e),this.currentlyFiringEvents=!1,sceneryLog&&sceneryLog.InputEvent&&sceneryLog.pop()}}clearBatchedEvents(){this.batchedEvents.length=0}validatePointers(){this.validatePointersAction.execute()}removeTemporaryPointers(){for(let e=this.pointers.length-1;e>=0;e--){const t=this.pointers[e];if(!(t instanceof qs)){this.pointers.splice(e,1);const i=t.trail||new wt(this.rootNode);this.exitEvents(t,It.createSynthetic(),i,0,!0)}}}connectListeners(){_h.addDisplay(this.display,this.attachToWindow,this.passiveEvents)}disconnectListeners(){_h.removeDisplay(this.display,this.attachToWindow,this.passiveEvents)}pointFromEvent(e){const t=Pe.pool.create(e.clientX,e.clientY);if(!this.assumeFullWindow){const i=this.display.domElement.getBoundingClientRect();i.width>0&&i.height>0&&(t.subtractXY(i.left,i.top),(i.width!==this.display.width||i.height!==this.display.height)&&(t.x*=this.display.width/i.width,t.y*=this.display.height/i.height))}return t}addPointer(e){this.pointers.push(e),this.pointerAddedEmitter.emit(e)}removePointer(e){for(let t=this.pointers.length-1;t>=0;t--)this.pointers[t]===e&&this.pointers.splice(t,1);e.dispose()}findPointerById(e){let t=this.pointers.length;for(;t--;){const i=this.pointers[t];if(i.id===e)return i}return null}getPDOMEventTrail(e,t){if(!this.display.interactive)return null;const i=this.getTrailFromPDOMEvent(e);return i&&!(t==="click"&&_.some(i.nodes,n=>n.positionInPDOM)&&e.timeStamp-this.upTimeStamp<=ZL)?i:null}initMouse(e){const t=new qs(e);return this.mouse=t,this.addPointer(t),t}ensureMouse(e){const t=this.mouse;return t||this.initMouse(e)}initPDOMPointer(){const e=new no(this.display);return this.pdomPointer=e,this.addPointer(e),e}ensurePDOMPointer(){const e=this.pdomPointer;return e||this.initPDOMPointer()}dispatchPDOMEvent(e,t,i,s){this.ensurePDOMPointer().updateTrail(e),Dt.USER_GESTURE_EVENTS.includes(t)&&cs.userGestureEmitter.emit();const n=i.domEvent;n.target&&n.target.hasAttribute(Dt.DATA_EXCLUDE_FROM_INPUT)||(e.isPickable()||QL.includes(t)||(e=new wt([])),assert&&assert(this.pdomPointer),this.dispatchEvent(e,t,this.pdomPointer,i,s))}getRelatedTargetTrail(e){const t=e.relatedTarget;if(t&&this.display.isElementUnderPDOM(t,!1)){const i=e.relatedTarget;assert&&assert(i instanceof self.Element);const s=i.getAttribute(Dt.DATA_PDOM_UNIQUE_ID);return assert&&assert(s,"should not be null"),En.uniqueIdToTrail(this.display,s)}return null}getTrailFromPDOMEvent(e){if(assert&&assert(e.target||e[Io],"need a way to get the target"),!this.display._accessible)return null;if(e[Io]){const t=e[Io].getAttribute(Dt.DATA_PDOM_UNIQUE_ID);return En.uniqueIdToTrail(this.display,t)}else{const t=e.target;if(t&&t instanceof self.Element&&this.display.isElementUnderPDOM(t,!1)){const i=t.getAttribute(Dt.DATA_PDOM_UNIQUE_ID);return assert&&assert(i,"should not be null"),En.uniqueIdToTrail(this.display,i)}}return null}mouseDown(e,t,i){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`mouseDown('${e}', ${oi.debugText(t,i.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.mouseDownAction.execute(e,t,i),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}mouseUp(e,t){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`mouseUp(${oi.debugText(e,t.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.mouseUpAction.execute(e,t),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}mouseMove(e,t){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`mouseMove(${oi.debugText(e,t.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.mouseMoveAction.execute(e,t),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}mouseOver(e,t){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`mouseOver(${oi.debugText(e,t.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.mouseOverAction.execute(e,t),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}mouseOut(e,t){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`mouseOut(${oi.debugText(e,t.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.mouseOutAction.execute(e,t),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}wheel(e){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`wheel(${oi.debugText(null,e.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.wheelScrollAction.execute(e),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}touchStart(e,t,i){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`touchStart('${e}',${oi.debugText(t,i.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.touchStartAction.execute(e,t,i),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}touchEnd(e,t,i){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`touchEnd('${e}',${oi.debugText(t,i.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.touchEndAction.execute(e,t,i),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}touchMove(e,t,i){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`touchMove('${e}',${oi.debugText(t,i.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.touchMoveAction.execute(e,t,i),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}touchCancel(e,t,i){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`touchCancel('${e}',${oi.debugText(t,i.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.touchCancelAction.execute(e,t,i),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}penStart(e,t,i){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`penStart('${e}',${oi.debugText(t,i.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.penStartAction.execute(e,t,i),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}penEnd(e,t,i){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`penEnd('${e}',${oi.debugText(t,i.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.penEndAction.execute(e,t,i),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}penMove(e,t,i){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`penMove('${e}',${oi.debugText(t,i.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.penMoveAction.execute(e,t,i),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}penCancel(e,t,i){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`penCancel('${e}',${oi.debugText(t,i.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.penCancelAction.execute(e,t,i),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}pointerDown(e,t,i,s){const n=this.attachToWindow?document.body:this.display.domElement;switch(n.setPointerCapture&&s.domEvent.pointerId&&!s.allowsDOMInput()&&n.setPointerCapture(s.domEvent.pointerId),t=this.handleUnknownPointerType(t,e),t){case"mouse":this.mouseDown(e,i,s);break;case"touch":this.touchStart(e,i,s);break;case"pen":this.penStart(e,i,s);break;default:if(assert)throw new Error(`Unknown pointer type: ${t}`)}}pointerUp(e,t,i,s){switch(this.upTimeStamp=s.domEvent.timeStamp,t=this.handleUnknownPointerType(t,e),t){case"mouse":this.mouseUp(i,s);break;case"touch":this.touchEnd(e,i,s);break;case"pen":this.penEnd(e,i,s);break;default:if(assert)throw new Error(`Unknown pointer type: ${t}`)}}pointerCancel(e,t,i,s){switch(t=this.handleUnknownPointerType(t,e),t){case"mouse":console&&console.log&&console.log("WARNING: Pointer mouse cancel was received");break;case"touch":this.touchCancel(e,i,s);break;case"pen":this.penCancel(e,i,s);break;default:console.log&&console.log(`Unknown pointer type: ${t}`)}}gotPointerCapture(e,t,i,s){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`gotPointerCapture('${e}',${oi.debugText(null,s.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.gotPointerCaptureAction.execute(e,s),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}lostPointerCapture(e,t,i,s){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`lostPointerCapture('${e}',${oi.debugText(null,s.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.lostPointerCaptureAction.execute(e,s),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}pointerMove(e,t,i,s){switch(t=this.handleUnknownPointerType(t,e),t){case"mouse":this.mouseMove(i,s);break;case"touch":this.touchMove(e,i,s);break;case"pen":this.penMove(e,i,s);break;default:console.log&&console.log(`Unknown pointer type: ${t}`)}}pointerOver(e,t,i,s){}pointerOut(e,t,i,s){}pointerEnter(e,t,i,s){}pointerLeave(e,t,i,s){}focusIn(e){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`focusIn('${oi.debugText(null,e.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.focusinAction.execute(e),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}focusOut(e){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`focusOut('${oi.debugText(null,e.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.focusoutAction.execute(e),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}input(e){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`input('${oi.debugText(null,e.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.inputAction.execute(e),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}change(e){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`change('${oi.debugText(null,e.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.changeAction.execute(e),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}click(e){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`click('${oi.debugText(null,e.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.clickAction.execute(e),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}keyDown(e){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`keyDown('${oi.debugText(null,e.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.keydownAction.execute(e),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}keyUp(e){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`keyUp('${oi.debugText(null,e.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.keyupAction.execute(e),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}handleUnknownPointerType(e,t){return e!==""?e:this.mouse&&this.mouse.id===t?"mouse":"touch"}getPointerTrail(e){return this.rootNode.trailUnderPointer(e)||new wt(this.rootNode)}upEvent(e,t,i){if(this.display.isElementUnderPDOM(t.domEvent.target,!0))return;const s=e.up(i,t.domEvent);sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`upEvent ${e.toString()} changed:${s}`),sceneryLog&&sceneryLog.Input&&sceneryLog.push();const n=this.branchChangeEvents(e,t,s);this.dispatchEvent(n,"up",e,t,!0),e.isTouchLike()&&this.exitEvents(e,t,n,0,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}downEvent(e,t,i){if(this.display.isElementUnderPDOM(t.domEvent.target,!0))return;const s=e.updatePoint(i);sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`downEvent ${e.toString()} changed:${s}`),sceneryLog&&sceneryLog.Input&&sceneryLog.push();const n=this.branchChangeEvents(e,t,s);e.down(t.domEvent),this.dispatchEvent(n,"down",e,t,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}moveEvent(e,t){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`moveEvent ${e.toString()}`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.branchChangeEvents(e,t,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}cancelEvent(e,t,i){const s=e.cancel(i);sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`cancelEvent ${e.toString()} changed:${s}`),sceneryLog&&sceneryLog.Input&&sceneryLog.push();const n=this.branchChangeEvents(e,t,s);this.dispatchEvent(n,"cancel",e,t,!0),e.isTouchLike()&&this.exitEvents(e,t,n,0,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}branchChangeEvents(e,t,i){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`branchChangeEvents: ${e.toString()} sendMove:${i}`),sceneryLog&&sceneryLog.InputEvent&&sceneryLog.push();const s=this.getPointerTrail(e),n=s.slice(0,Math.min(s.nodes.length,s.getLastInputEnabledIndex()+1)),o=e.inputEnabledTrail||new wt(this.rootNode),c=wt.branchIndex(n,o),p=o.lastNode()!==n.lastNode();if(sceneryLog&&sceneryLog.InputEvent){const f=e.trail||new wt(this.rootNode),w=wt.branchIndex(s,f);(w!==s.length||w!==f.length)&&sceneryLog.InputEvent(`changed from ${f.toString()} to ${s.toString()}`)}return i&&this.dispatchEvent(s,"move",e,t,!0),this.exitEvents(e,t,o,c,p),this.enterEvents(e,t,n,c,p),e.trail=s,e.inputEnabledTrail=n,sceneryLog&&sceneryLog.InputEvent&&sceneryLog.pop(),s}enterEvents(e,t,i,s,n){n&&this.dispatchEvent(i,"over",e,t,!0,!0);for(let o=s;o<i.length;o++)this.dispatchEvent(i.slice(0,o+1),"enter",e,t,!1)}exitEvents(e,t,i,s,n){for(let o=i.length-1;o>=s;o--)this.dispatchEvent(i.slice(0,o+1),"exit",e,t,!1,!0);n&&this.dispatchEvent(i,"out",e,t,!0)}dispatchEvent(e,t,i,s,n,o=!1){sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.EventDispatch(`${t} trail:${e.toString()} pointer:${i.toString()} at ${i.point?i.point.toString():"null"}`),sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.push(),assert&&assert(e,"Falsy trail for dispatchEvent"),sceneryLog&&sceneryLog.EventPath&&sceneryLog.EventPath(`${t} ${e.toPathString()}`);const c=new Ms(e,t,i,s);this.currentSceneryEvent=c,this.dispatchToListeners(i,i.getListeners(),t,c),this.dispatchToTargets(e,t,i,c,n,o),this.dispatchToListeners(i,this.display.getInputListeners(),t,c),cs.inputListeners.length&&this.dispatchToListeners(i,cs.inputListeners.slice(),t,c),this.currentSceneryEvent=null,sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.pop()}dispatchToListeners(e,t,i,s){if(s.handled)return;const n=e.type+i;for(let o=0;o<t.length;o++){const c=t[o];!s.aborted&&c[n]&&(sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.EventDispatch(n),sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.push(),c[n](s),sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.pop()),!s.aborted&&c[i]&&(sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.EventDispatch(i),sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.push(),c[i](s),sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.pop())}}dispatchToTargets(e,t,i,s,n,o=!1){if(s.aborted||s.handled)return;const c=e.getLastInputEnabledIndex();for(let p=e.nodes.length-1;p>=0;n?p--:p=-1){const f=e.nodes[p],w=c<p;if(!(f.isDisposed||!o&&w)&&(s.currentTarget=f,this.dispatchToListeners(i,f.getInputListeners(),t,s),s.aborted||s.handled))return}}static serializeDomEvent(e){const t={constructorName:e.constructor.name};return XL.forEach(i=>{const s=e[i];s==null?t[i]=null:s instanceof Element&&jL.includes(i)&&typeof s.getAttribute=="function"&&s.hasAttribute(Dt.DATA_PDOM_UNIQUE_ID)?t[i]={[Dt.DATA_PDOM_UNIQUE_ID]:s.getAttribute(Dt.DATA_PDOM_UNIQUE_ID),id:s.getAttribute("id")}:t[i]=typeof s=="object"?{}:JSON.parse(JSON.stringify(s))}),t}static deserializeDomEvent(e){const t=e.constructorName||"Event",i=_.pick(e,Vp);if(i.relatedTarget){const n=document.getElementById(i.relatedTarget.id);assert&&assert(n,"cannot deserialize event when related target is not in the DOM."),i.relatedTarget=n}const s=new self[t](t,i);for(const n in e)if(e.hasOwnProperty(n)&&!Vp.includes(n))if(n==="target"){if(assert){const o=e.target;o&&o.id&&assert(document.getElementById(o.id),"target should exist in the PDOM to support playback.")}s[Io]=_.clone(e[n])||{},s[Io].getAttribute=function(o){return this[o]}}else s[n]=e[n];return s}static debugText(e,t){let i=`${t.timeStamp} ${t.type}`;return e!==null&&(i=`${e.x},${e.y} ${i}`),i}static msPointerType(e){return e.pointerType===self.MSPointerEvent.MSPOINTER_TYPE_TOUCH?"touch":e.pointerType===self.MSPointerEvent.MSPOINTER_TYPE_PEN?"pen":e.pointerType===self.MSPointerEvent.MSPOINTER_TYPE_MOUSE?"mouse":e.pointerType}};oi.InputIO=new Ai("InputIO",{valueType:oi,applyState:_.noop,toStateObject:e=>({pointers:Hp.toStateObject(e.pointers)}),stateSchema:{pointers:Hp}});let cr=oi;te.register("Input",cr);const xs=class xs extends Ur{};xs.POINTER_TYPE=new xs,xs.MS_POINTER_TYPE=new xs,xs.TOUCH_TYPE=new xs,xs.MOUSE_TYPE=new xs,xs.WHEEL_TYPE=new xs,xs.ALT_TYPE=new xs,xs.enumeration=new Yr(xs,{phetioDocumentation:"The type of batched event"});let Wt=xs;const rl=class rl{constructor(e,t,i){this.initialize(e,t,i)}initialize(e,t,i){return assert&&assert(e.domEvent,"for some reason, there is no DOM event?"),this.eventContext=e,this.type=t,this.callback=i,this}run(e){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent("Running batched event"),sceneryLog&&sceneryLog.InputEvent&&sceneryLog.push();const t=this.callback;if(e.validatePointers(),this.type===Wt.POINTER_TYPE){const i=this.eventContext,s=i.domEvent;t.call(e,s.pointerId,s.pointerType,e.pointFromEvent(s),i)}else if(this.type===Wt.MS_POINTER_TYPE){const i=this.eventContext,s=i.domEvent;t.call(e,s.pointerId,cr.msPointerType(s),e.pointFromEvent(s),i)}else if(this.type===Wt.TOUCH_TYPE){const i=this.eventContext,s=i.domEvent;for(let n=0;n<s.changedTouches.length;n++){const o=s.changedTouches.item(n);t.call(e,o.identifier,e.pointFromEvent(o),i)}}else if(this.type===Wt.MOUSE_TYPE){const i=this.eventContext,s=e.pointFromEvent(i.domEvent);t===e.mouseDown?t.call(e,null,s,i):t.call(e,s,i)}else if(this.type===Wt.WHEEL_TYPE||this.type===Wt.ALT_TYPE)t.call(e,this.eventContext);else throw new Error(`bad type value: ${this.type}`);sceneryLog&&sceneryLog.InputEvent&&sceneryLog.pop()}dispose(){this.eventContext=null,this.callback=null,this.freeToPool()}freeToPool(){rl.pool.freeToPool(this)}};rl.pool=new qi(rl);let bh=rl;te.register("BatchedDOMEvent",bh);const JL=()=>{};let zp=!1;const $t={blockFocusCallbacks:!1,addDisplay(h,e,t){assert&&assert(h instanceof cs),assert&&assert(typeof e=="boolean"),assert&&assert(!_.includes(this.attachedDisplays,h),"A display cannot be concurrently attached to events more than one time"),zp||(zp=!0,Hs.attachToWindow(),mi.attachToWindow()),this.attachedDisplays.push(h),e?this.attachedDisplays.length===1&&this.connectWindowListeners(t):this.addOrRemoveListeners(h.domElement,!0,t),h.domElement.addEventListener("wheel",this.onwheel,$t.getEventOptions(t,!0))},removeDisplay(h,e,t){assert&&assert(h instanceof cs),assert&&assert(typeof e=="boolean"),assert&&assert(_.includes(this.attachedDisplays,h),"This display was not already attached to listen for self events"),is(this.attachedDisplays,h),e?this.attachedDisplays.length===0&&this.disconnectWindowListeners(t):this.addOrRemoveListeners(h.domElement,!1,t),h.domElement.removeEventListener("wheel",this.onwheel,$t.getEventOptions(t,!0))},getEventOptions(h,e){if(ht.passive&&h!==null){const i={passive:h};return e&&(i.capture=!1),assert&&assert(!i.capture,"Do not use capture without consulting globalKeyStateTracker, which expects have listeners called FIRST in keyboard-related cases."),i}else return!1},listenersAttachedToWindow:0,listenersAttachedToElement:0,attachedDisplays:[],canUsePointerEvents:!!(self.navigator&&self.navigator.pointerEnabled||self.PointerEvent)&&!Ui.firefox,canUseMSPointerEvents:self.navigator&&self.navigator.msPointerEnabled,pointerListenerTypes:["pointerdown","pointerup","pointermove","pointerover","pointerout","pointercancel","gotpointercapture","lostpointercapture"],msPointerListenerTypes:["MSPointerDown","MSPointerUp","MSPointerMove","MSPointerOver","MSPointerOut","MSPointerCancel"],touchListenerTypes:["touchstart","touchend","touchmove","touchcancel"],mouseListenerTypes:["mousedown","mouseup","mousemove","mouseover","mouseout"],wheelListenerTypes:["wheel"],altListenerTypes:Dt.DOM_EVENTS,getNonWheelUsedTypes(){let h;return this.canUsePointerEvents?(sceneryLog&&sceneryLog.Input&&sceneryLog.Input("Detected pointer events support, using that instead of mouse/touch events"),h=this.pointerListenerTypes):this.canUseMSPointerEvents?(sceneryLog&&sceneryLog.Input&&sceneryLog.Input("Detected MS pointer events support, using that instead of mouse/touch events"),h=this.msPointerListenerTypes):(sceneryLog&&sceneryLog.Input&&sceneryLog.Input("No pointer events support detected, using mouse/touch events"),h=this.touchListenerTypes.concat(this.mouseListenerTypes)),h=h.concat(this.altListenerTypes),h},connectWindowListeners(h){this.addOrRemoveListeners(self,!0,h)},disconnectWindowListeners(h){this.addOrRemoveListeners(self,!1,h)},addOrRemoveListeners(h,e,t){assert&&assert(typeof e=="boolean"),assert&&assert(typeof t=="boolean"||t===null);const i=h===window;assert&&assert(!i||this.listenersAttachedToWindow>0==!e,"Do not add listeners to the self when already attached, or remove listeners when none are attached");const s=e?1:-1;i?this.listenersAttachedToWindow+=s:this.listenersAttachedToElement+=s,assert&&assert(this.listenersAttachedToWindow===0||this.listenersAttachedToElement===0,"Listeners should not be added both with addDisplayToWindow and addDisplayToElement. Use only one.");const n=e?"addEventListener":"removeEventListener",o=this.getNonWheelUsedTypes();for(let c=0;c<o.length;c++){const p=o[c];i&&document[n](p,JL,$t.getEventOptions(t,!1));const f=this[`on${p}`];assert&&assert(!!f),h[n](p,f,$t.getEventOptions(t,!0))}},batchWindowEvent(h,e,t,i){for(let s=0;s<this.attachedDisplays.length;s++){const o=this.attachedDisplays[s]._input;(!$t.blockFocusCallbacks||t!=="focusIn"&&t!=="focusOut")&&o.batchEvent(h,e,o[t],i)}},onpointerdown:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("pointerdown"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push();const t=new It(e);e.pointerType==="mouse"&&cs.userGestureEmitter.emit(),$t.batchWindowEvent(t,Wt.POINTER_TYPE,"pointerDown",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onpointerup:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("pointerup"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push();const t=new It(e);cs.userGestureEmitter.emit(),$t.batchWindowEvent(t,Wt.POINTER_TYPE,"pointerUp",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onpointermove:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("pointermove"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),$t.batchWindowEvent(new It(e),Wt.POINTER_TYPE,"pointerMove",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onpointerover:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("pointerover"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),$t.batchWindowEvent(new It(e),Wt.POINTER_TYPE,"pointerOver",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onpointerout:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("pointerout"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),$t.batchWindowEvent(new It(e),Wt.POINTER_TYPE,"pointerOut",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onpointercancel:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("pointercancel"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),$t.batchWindowEvent(new It(e),Wt.POINTER_TYPE,"pointerCancel",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},ongotpointercapture:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("gotpointercapture"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),$t.batchWindowEvent(new It(e),Wt.POINTER_TYPE,"gotPointerCapture",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onlostpointercapture:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("lostpointercapture"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),$t.batchWindowEvent(new It(e),Wt.POINTER_TYPE,"lostPointerCapture",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onMSPointerDown:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("MSPointerDown"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),$t.batchWindowEvent(new It(e),Wt.MS_POINTER_TYPE,"pointerDown",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onMSPointerUp:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("MSPointerUp"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),$t.batchWindowEvent(new It(e),Wt.MS_POINTER_TYPE,"pointerUp",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onMSPointerMove:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("MSPointerMove"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),$t.batchWindowEvent(new It(e),Wt.MS_POINTER_TYPE,"pointerMove",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onMSPointerOver:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("MSPointerOver"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),$t.batchWindowEvent(new It(e),Wt.MS_POINTER_TYPE,"pointerOver",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onMSPointerOut:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("MSPointerOut"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),$t.batchWindowEvent(new It(e),Wt.MS_POINTER_TYPE,"pointerOut",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onMSPointerCancel:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("MSPointerCancel"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),$t.batchWindowEvent(new It(e),Wt.MS_POINTER_TYPE,"pointerCancel",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},ontouchstart:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("touchstart"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),$t.batchWindowEvent(new It(e),Wt.TOUCH_TYPE,"touchStart",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},ontouchend:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("touchend"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push();const t=new It(e);cs.userGestureEmitter.emit(),$t.batchWindowEvent(t,Wt.TOUCH_TYPE,"touchEnd",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},ontouchmove:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("touchmove"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),$t.batchWindowEvent(new It(e),Wt.TOUCH_TYPE,"touchMove",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},ontouchcancel:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("touchcancel"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),$t.batchWindowEvent(new It(e),Wt.TOUCH_TYPE,"touchCancel",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onmousedown:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("mousedown"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push();const t=new It(e);cs.userGestureEmitter.emit(),$t.batchWindowEvent(t,Wt.MOUSE_TYPE,"mouseDown",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onmouseup:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("mouseup"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push();const t=new It(e);cs.userGestureEmitter.emit(),$t.batchWindowEvent(t,Wt.MOUSE_TYPE,"mouseUp",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onmousemove:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("mousemove"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),$t.batchWindowEvent(new It(e),Wt.MOUSE_TYPE,"mouseMove",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onmouseover:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("mouseover"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),$t.batchWindowEvent(new It(e),Wt.MOUSE_TYPE,"mouseOver",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onmouseout:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("mouseout"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),$t.batchWindowEvent(new It(e),Wt.MOUSE_TYPE,"mouseOut",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onwheel:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("wheel"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),$t.batchWindowEvent(new It(e),Wt.WHEEL_TYPE,"wheel",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onfocusin:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("focusin"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),mi.updatePDOMFocusFromEvent($t.attachedDisplays,e,!0),$t.batchWindowEvent(new It(e),Wt.ALT_TYPE,"focusIn",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onfocusout:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("focusout"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),mi.updatePDOMFocusFromEvent($t.attachedDisplays,e,!1),$t.batchWindowEvent(new It(e),Wt.ALT_TYPE,"focusOut",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},oninput:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("input"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),$t.batchWindowEvent(new It(e),Wt.ALT_TYPE,"input",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onchange:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("change"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),$t.batchWindowEvent(new It(e),Wt.ALT_TYPE,"change",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onclick:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("click"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),$t.batchWindowEvent(new It(e),Wt.ALT_TYPE,"click",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onkeydown:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("keydown"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),$t.batchWindowEvent(new It(e),Wt.ALT_TYPE,"keyDown",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onkeyup:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("keyup"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),$t.batchWindowEvent(new It(e),Wt.ALT_TYPE,"keyUp",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()}};te.register("BrowserEvents",$t);const _h=$t;class Zm extends Il{constructor(e){assert&&assert(e.fireOnHoldTiming==="custom"||e.fireOnHoldCustomDelay===void 0&&e.fireOnHoldCustomInterval===void 0,"Cannot specify fireOnHoldCustomDelay / fireOnHoldCustomInterval if fireOnHoldTiming is not custom");const t=st()({modifierKeys:[],ignoredModifierKeys:[],fire:_.noop,press:_.noop,release:_.noop,fireOnDown:!0,fireOnHold:!1,fireOnHoldTiming:"browser",fireOnHoldCustomDelay:400,fireOnHoldCustomInterval:100,allowOverlap:!1,override:!1},e);super(t),this.isPressedProperty=new ci(!1),this.interrupted=!1,this.key=t.key,this.modifierKeys=t.modifierKeys,this.ignoredModifierKeys=t.ignoredModifierKeys,this.fire=t.fire,this.press=t.press,this.release=t.release,this.fireOnDown=t.fireOnDown,this.fireOnHold=t.fireOnHold,this.fireOnHoldTiming=t.fireOnHoldTiming,this.allowOverlap=t.allowOverlap,this.override=t.override,this.keys=_.uniq([this.key,...this.modifierKeys]);for(const i of this.keys)assert&&assert(za[i],`No codes for this key exists, do you need to add it to EnglishStringToCodeMap?: ${i}`);this.fireOnHold&&this.fireOnHoldTiming==="custom"&&(this.fireOnHoldTimer=new Rh({callback:this.fire.bind(this,null),delay:t.fireOnHoldCustomDelay,interval:t.fireOnHoldCustomInterval}),this.disposeEmitter.addListener(()=>this.fireOnHoldTimer.dispose()),this.isPressedProperty.link(i=>{this.fireOnHoldTimer.stop(!1),i&&this.fireOnHoldTimer.start()}))}onPress(e,t){this.interrupted=!1,this.isPressedProperty.value=!0,this.press(e),t&&this.fire(e)}onRelease(e,t,i){this.interrupted=t,this.isPressedProperty.value=!1,this.release(e),i&&this.fire(e)}interrupt(){this.isPressedProperty.value&&Nu.interruptHotkey(this)}getHotkeyString(){return[...this.modifierKeys,this.key].join("+")}dispose(){this.isPressedProperty.dispose(),super.dispose()}}te.register("Hotkey",Zm);class Jm{constructor(){this.hotkeysProperty=new Nt(new Set)}add(e){assert&&assert(!this.hotkeysProperty.value.has(e),"Hotkey already added"),this.hotkeysProperty.value=new Set([...this.hotkeysProperty.value,e])}remove(e){assert&&assert(this.hotkeysProperty.value.has(e),"Hotkey not found"),this.hotkeysProperty.value=new Set([...this.hotkeysProperty.value].filter(t=>t!==e))}}te.register("GlobalHotkeyRegistry",Jm);const Ru=new Jm,e0=(h,e)=>h.length===e.length&&h.every((t,i)=>t===e[i]),t0=(h,e)=>h.size===e.size&&[...h].every(t=>e.has(t));class ey{constructor(){this.enabledHotkeysProperty=new Nt([]),this.englishKeysDown=new Set,this.modifierKeys=[],this.activeHotkeys=new Set,this.availableHotkeysProperty=new Si([Ru.hotkeysProperty,mi.pdomFocusProperty],(s,n)=>{const o=[];if(n)for(const c of n.trail.nodes.slice().reverse()){if(!c.isInputEnabled())break;c.inputListeners.forEach(p=>{var f;(f=p.hotkeys)==null||f.forEach(w=>{o.push(w)})})}return o.push(...s),_.uniq(o)},{valueComparisonStrategy:e0});const e=()=>{this.availableHotkeysProperty.recomputeDerivation()};mi.pdomFocusProperty.link((s,n)=>{n&&n.trail.nodes.forEach(o=>{o.inputEnabledProperty.unlink(e)}),s&&s.trail.nodes.forEach(o=>{o.inputEnabledProperty.lazyLink(e)})});const t=()=>{const s=new Set,n=[];for(const o of this.availableHotkeysProperty.value)if(o.enabledProperty.value){const c=[...o.modifierKeys.slice().sort(),o.key].join("+");s.has(c)||(n.push(o),o.override&&s.add(c))}this.enabledHotkeysProperty.value=n},i=new Map;this.availableHotkeysProperty.link((s,n)=>{let o=!1;if(n){for(const c of n)if(!s.includes(c)){const p=i.get(c);i.delete(c),assert&&assert(p),c.enabledProperty.unlink(p),o=!0}}for(const c of s)if(!n||!n.includes(c)){const p=()=>t();i.set(c,p),c.enabledProperty.lazyLink(p),o=!0}o&&t()}),this.enabledHotkeysProperty.link((s,n)=>{if(this.modifierKeys=_.uniq([...E_,...[...s].flatMap(o=>o.modifierKeys)]),n)for(const o of n)!s.includes(o)&&this.activeHotkeys.has(o)&&this.removeActiveHotkey(o,null,!1);this.updateHotkeyStatus(null)}),Hs.keyDownStateChangedEmitter.addListener(s=>{const n=Hs.getEnglishKeysDown();if(!t0(this.englishKeysDown,n))this.englishKeysDown=n,this.updateHotkeyStatus(s);else for(const c of[...this.activeHotkeys])c.fireOnHold&&c.fireOnHoldTiming==="browser"&&c.fire(s)})}updateHotkeysFromInputListenerChange(e){mi.pdomFocusProperty.value&&mi.pdomFocusProperty.value.trail.nodes.includes(e)&&this.availableHotkeysProperty.recomputeDerivation()}getHotkeysForMainKey(e){if(!this.englishKeysDown.has(e))return[];const t=[...this.enabledHotkeysProperty.value].filter(i=>i.key!==e?!1:this.modifierKeys.every(s=>this.englishKeysDown.has(s)===i.keys.includes(s)||i.ignoredModifierKeys.includes(s)));if(assert){const i=t.filter(s=>!s.allowOverlap);assert&&assert(i.length<2,`Key conflict detected: ${i.map(s=>s.getHotkeyString())}`)}return t}updateHotkeyStatus(e){const t=Se.getEventCode(e),i=t?Xf(t):null;for(const s of this.enabledHotkeysProperty.value){const n=this.getHotkeysForMainKey(s.key).includes(s),o=!s.interrupted||e&&e.type==="keydown",c=n&&o,p=this.activeHotkeys.has(s);c&&!p?this.addActiveHotkey(s,e,s.key===i):!c&&p&&this.removeActiveHotkey(s,e,s.key===i)}}addActiveHotkey(e,t,i){this.activeHotkeys.add(e);const s=i&&e.fireOnDown;e.onPress(t,s)}removeActiveHotkey(e,t,i){this.activeHotkeys.delete(e);const s=i&&!e.fireOnDown,n=!i;e.onRelease(t,n,s)}interruptHotkey(e){assert&&assert(e.isPressedProperty.value,"hotkey must be pressed to be interrupted"),this.removeActiveHotkey(e,null,!1)}}te.register("HotkeyManager",ey);const i0=new ey,Nu=i0;class s0{constructor(e,t){this.display=e,this.touches=[],this.nextTouchID=1,this.isMouseDown=!1,this.mousePosition=new Pe(0,0),this.random=new Ku({seed:t}),this.mouseToggleAction=()=>{this.mouseToggle()},this.mouseMoveAction=()=>{this.mouseMove()},this.touchStartAction=()=>{const i=this.createTouch(this.getRandomPosition());this.touchStart(i)},this.touchMoveAction=()=>{const i=this.random.sample(this.touches);this.touchMove(i)},this.touchEndAction=()=>{const i=this.random.sample(this.touches);this.touchEnd(i),this.removeTouch(i)},this.touchCancelAction=()=>{const i=this.random.sample(this.touches);this.touchCancel(i),this.removeTouch(i)}}fuzzEvents(e,t,i,s){for(assert&&assert(e>0,`averageEventCount must be positive: ${e}`),this.display._input.currentlyFiringEvents=!0;this.random.nextDouble()<1-1/(e+1);){const o=this.touches.length+(this.isMouseDown?1:0)<s,c=[];t&&(this.isMouseDown||o)&&(c.push(this.mouseToggleAction),c.push(this.mouseMoveAction)),i&&(o&&c.push(this.touchStartAction),this.touches.length&&(c.push(this.random.nextDouble()<.8?this.touchEndAction:this.touchCancelAction),c.push(this.touchMoveAction))),this.random.sample(c)()}this.display._input.currentlyFiringEvents=!1,this.display._input.fireBatchedEvents()}createTouchEvent(e,t){const i=this.display.domElement,s=t.map(n=>({identifier:n.id,target:i,clientX:n.position.x,clientY:n.position.y}));if(self.Touch!==void 0&&self.TouchEvent!==void 0&&self.Touch.length===1&&self.TouchEvent.length===1){const n=s.map(o=>new self.Touch(o));return new self.TouchEvent(e,{cancelable:!0,bubbles:!0,touches:n,targetTouches:[],changedTouches:n,shiftKey:!1})}else{const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!0,!0,{touches:s,targetTouches:[],changedTouches:s}),n}}getRandomPosition(){return new Pe(Math.floor(this.random.nextDouble()*this.display.width),Math.floor(this.random.nextDouble()*this.display.height))}createTouch(e){const t={id:this.nextTouchID++,position:e};return this.touches.push(t),t}removeTouch(e){this.touches.splice(this.touches.indexOf(e),1)}touchStart(e){const t=this.createTouchEvent("touchstart",[e]);this.display._input.validatePointers(),this.display._input.touchStart(e.id,e.position,new It(t))}touchMove(e){e.position=this.getRandomPosition();const t=this.createTouchEvent("touchmove",[e]);this.display._input.validatePointers(),this.display._input.touchMove(e.id,e.position,new It(t))}touchEnd(e){const t=this.createTouchEvent("touchend",[e]);this.display._input.validatePointers(),this.display._input.touchEnd(e.id,e.position,new It(t))}touchCancel(e){const t=this.createTouchEvent("touchcancel",[e]);this.display._input.validatePointers(),this.display._input.touchCancel(e.id,e.position,new It(t))}mouseToggle(){const e=document.createEvent("MouseEvent");e.initMouseEvent(this.isMouseDown?"mouseup":"mousedown",!0,!0,window,1,this.mousePosition.x,this.mousePosition.y,this.mousePosition.x,this.mousePosition.y,!1,!1,!1,!1,0,null),this.display._input.validatePointers(),this.isMouseDown?(this.display._input.mouseUp(this.mousePosition,new It(e)),this.isMouseDown=!1):(this.display._input.mouseDown(null,this.mousePosition,new It(e)),this.isMouseDown=!0)}mouseMove(){this.mousePosition=this.getRandomPosition();const e=document.createEvent("MouseEvent");e.initMouseEvent("mousemove",!0,!0,window,0,this.mousePosition.x,this.mousePosition.y,this.mousePosition.x,this.mousePosition.y,!1,!1,!1,!1,0,null),this.display._input.validatePointers(),this.display._input.mouseMove(this.mousePosition,new It(e))}}te.register("InputFuzzer",s0);class ty extends Hi{constructor(e){assert&&xn("DownUpListener is deprecated, please use PressListener instead"),e=ds({mouseButton:0},e),super(e),this.options=e,this.isDown=!1,this.downCurrentTarget=null,this.downTrail=null,this.pointer=null,this.interrupted=!1,this.downListener={up:t=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`DownUpListener (pointer) up for ${this.downTrail.toString()}`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),assert&&assert(t.pointer===this.pointer),(!(t.pointer instanceof qs)||t.domEvent.button===this.options.mouseButton)&&this.buttonUp(t),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},interrupt:()=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`DownUpListener (pointer) interrupt for ${this.downTrail.toString()}`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.interrupt(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},cancel:t=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`DownUpListener (pointer) cancel for ${this.downTrail.toString()}`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),assert&&assert(t.pointer===this.pointer),this.buttonUp(t),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}}}buttonDown(e){this.isDown||e.pointer instanceof qs&&e.domEvent.button!==this.options.mouseButton||(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DownUpListener buttonDown"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),e.pointer.addInputListener(this.downListener),this.isDown=!0,this.downCurrentTarget=e.currentTarget,this.downTrail=e.trail.subtrailTo(e.currentTarget,!1),this.pointer=e.pointer,this.options.down&&this.options.down(e,this.downTrail),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop())}buttonUp(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DownUpListener buttonUp"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.isDown=!1,this.pointer.removeInputListener(this.downListener);const t=e.currentTarget;if(e.currentTarget=this.downCurrentTarget,this.options.upInside||this.options.upOutside){const s=e.trail.isExtensionOf(this.downTrail,!0)&&!this.interrupted;s&&this.options.upInside?this.options.upInside(e,this.downTrail):!s&&this.options.upOutside&&this.options.upOutside(e,this.downTrail)}this.options.up&&this.options.up(e,this.downTrail),e.currentTarget=t,sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}down(e){this.buttonDown(e)}interrupt(){if(this.isDown){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DownUpListener interrupt"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.interrupted=!0;const e=It.createSynthetic(),t=new Ms(new wt,"synthetic",this.pointer,e);t.currentTarget=this.downCurrentTarget,this.buttonUp(t),this.interrupted=!1,sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}}}te.register("DownUpListener",ty);class wl extends ty{constructor(e){assert&&xn("ButtonListener is deprecated, please use FireListener instead"),e=ds({phetioType:wl.ButtonListenerIO,phetioState:!1,phetioEventType:si.USER},e),super({tandem:e.tandem,phetioType:e.phetioType,phetioState:e.phetioState,mouseButton:e.mouseButton||0,down:(t,i)=>{this.setButtonState(t,"down")},up:(t,i)=>{this.setButtonState(t,this._overCount>0?"over":"up")}}),this.buttonState="up",this._overCount=0,this._buttonOptions=e}setButtonState(e,t){if(t!==this.buttonState){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`ButtonListener state change to ${t} from ${this.buttonState} for ${this.downTrail?this.downTrail.toString():this.downTrail}`);const i=this.buttonState;this.buttonState=t,this._buttonOptions[t]&&(this.phetioStartEvent(t),this._buttonOptions[t](e,i),this.phetioEndEvent()),this._buttonOptions.fire&&this._overCount>0&&!this.interrupted&&(this._buttonOptions.fireOnDown?t==="down":i==="down")&&(this.phetioStartEvent("fire"),this._buttonOptions.fire(e),this.phetioEndEvent())}}enter(e){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`ButtonListener enter for ${this.downTrail?this.downTrail.toString():this.downTrail}`),this._overCount++,this._overCount===1&&this.setButtonState(e,this.isDown?"down":"over")}exit(e){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`ButtonListener exit for ${this.downTrail?this.downTrail.toString():this.downTrail}`),assert&&assert(this._overCount>0,"Exit events not matched by an enter"),this._overCount--,this._overCount===0&&this.setButtonState(e,this.isDown?"out":"up")}focus(e){this.enter(e)}blur(e){this.exit(e)}click(e){this.setButtonState(e,"down"),this.setButtonState(e,"up")}}te.register("ButtonListener",wl);wl.ButtonListenerIO=new Ai("ButtonListenerIO",{valueType:wl,documentation:"Button listener",events:["up","over","down","out","fire"]});class n0 extends Hi{constructor(e){assert&&xn("SimpleDragHandler is deprecated, please use DragListener instead"),e=ds({start:null,drag:null,end:null,translate:null,allowTouchSnag:!1,mouseButton:0,dragCursor:"pointer",attach:!0,tandem:ai.REQUIRED,phetioState:!1,phetioEventType:si.USER,phetioReadOnly:!0},e),super(),this.options=e,this.isDraggingProperty=new ci(!1,{phetioReadOnly:e.phetioReadOnly,phetioState:!1,tandem:e.tandem.createTandem("isDraggingProperty"),phetioDocumentation:"Indicates whether the object is dragging"}),this.pointer=null,this.trail=null,this.transform=null,this.node=null,this.lastDragPoint=null,this.startTransformMatrix=null,this.mouseButton=void 0,this.interrupted=!1,this.lastInterruptedTouchLikePointer=null,this._attach=e.attach,this.dragStartAction=new qt((t,i)=>{this.dragging||(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("SimpleDragHandler startDrag"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this._attach&&(i.pointer.dragging=!0),i.pointer.cursor=this.options.dragCursor,i.pointer.addInputListener(this.dragListener,this.options.attach),i.pointer.reserveForDrag(),this.isDraggingProperty.set(!0),this.pointer=i.pointer,this.trail=i.trail.subtrailTo(i.currentTarget,!0),this.transform=this.trail.getTransform(),this.node=i.currentTarget,this.lastDragPoint=i.pointer.point,this.startTransformMatrix=i.currentTarget.getMatrix().copy(),this.mouseButton=i.pointer instanceof qs?i.domEvent.button:void 0,this.options.start&&this.options.start.call(null,i,this.trail),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop())},{tandem:e.tandem.createTandem("dragStartAction"),phetioReadOnly:e.phetioReadOnly,parameters:[{name:"point",phetioType:Pe.Vector2IO,phetioDocumentation:"the position of the drag start in view coordinates"},{phetioPrivate:!0,valueType:[Ms,null]}]}),this.dragAction=new qt((t,i)=>{if(!this.dragging||this.isDisposed)return;const s=this.pointer.point.minus(this.lastDragPoint);if(s.magnitudeSquared===0)return;const n=this.transform.inverseDelta2(s);if(assert&&assert(i.pointer===this.pointer,"Wrong pointer in move"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`SimpleDragHandler (pointer) move for ${this.trail.toString()}`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.options.translate){const o=this.node.getMatrix().getTranslation();this.options.translate.call(null,{delta:n,oldPosition:o,position:o.plus(n)})}if(this.lastDragPoint=this.pointer.point,this.options.drag){const o=i.currentTarget;i.currentTarget=this.node,this.options.drag.call(null,i,this.trail),i.currentTarget=o}sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},{phetioHighFrequency:!0,phetioReadOnly:e.phetioReadOnly,tandem:e.tandem.createTandem("dragAction"),parameters:[{name:"point",phetioType:Pe.Vector2IO,phetioDocumentation:"the position of the drag in view coordinates"},{phetioPrivate:!0,valueType:[Ms,null]}]}),this.dragEndAction=new qt((t,i)=>{this.dragging&&(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("SimpleDragHandler endDrag"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this._attach&&(this.pointer.dragging=!1),this.pointer.cursor=null,this.pointer.removeInputListener(this.dragListener),this.isDraggingProperty.set(!1),this.options.end&&this.options.end.call(null,i,this.trail),this.pointer=null,sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop())},{tandem:e.tandem.createTandem("dragEndAction"),phetioReadOnly:e.phetioReadOnly,parameters:[{name:"point",phetioType:Pe.Vector2IO,phetioDocumentation:"the position of the drag end in view coordinates"},{phetioPrivate:!0,isValidValue:t=>t===null||t instanceof Ms||t.pointer&&t.currentTarget}]}),this.transformListener={transform:t=>{if(!this.trail.isExtensionOf(t.trail,!0))return;const i=t.trail.getMatrix(),s=this.transform.getMatrix();this.node.prependMatrix(i.inverted().timesMatrix(s)),this.transform.setMatrix(i)}},this.dragListener={up:t=>{if(!(!this.dragging||this.isDisposed)){if(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`SimpleDragHandler (pointer) up for ${this.trail.toString()}`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),assert&&assert(t.pointer===this.pointer,"Wrong pointer in up"),!(t.pointer instanceof qs)||t.domEvent.button===this.mouseButton){const i=t.currentTarget;t.currentTarget=this.node,this.endDrag(t),t.currentTarget=i}sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}},cancel:t=>{if(!this.dragging||this.isDisposed)return;sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`SimpleDragHandler (pointer) cancel for ${this.trail.toString()}`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),assert&&assert(t.pointer===this.pointer,"Wrong pointer in cancel");const i=t.currentTarget;t.currentTarget=this.node,this.endDrag(t),t.currentTarget=i,this.transform||this.node.setMatrix(this.startTransformMatrix),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},move:t=>{this.dragAction.execute(t.pointer.point,t)},interrupt:()=>{this.interrupt()}},this.initializePhetioObject({},e)}get dragging(){return this.isDraggingProperty.get()}set dragging(e){assert&&assert(!1,"illegal call to set dragging on SimpleDragHandler")}startDrag(e){this.dragStartAction.execute(e.pointer.point,e)}endDrag(e){this.dragEndAction.execute(e?e.pointer.point:Pe.ZERO,e)}interrupt(){this.dragging&&(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("SimpleDragHandler interrupt"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.interrupted=!0,this.pointer&&this.pointer.isTouchLike()&&(this.lastInterruptedTouchLikePointer=this.pointer),this.endDrag({pointer:this.pointer,currentTarget:this.node}),this.interrupted=!1,sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop())}tryToSnag(e){e.pointer instanceof qs&&e.domEvent&&this.options.mouseButton!==e.domEvent.button&&this.options.mouseButton!==-1||this.isDisposed||!this.dragging&&(!e.pointer.dragging||!this._attach)&&e.pointer!==this.lastInterruptedTouchLikePointer&&e.canStartPress()&&this.startDrag(e)}tryTouchToSnag(e){this.options.allowTouchSnag&&(this.options.allowTouchSnag===!0||this.options.allowTouchSnag(e))&&this.tryToSnag(e)}down(e){this.tryToSnag(e)}touchenter(e){this.tryTouchToSnag(e)}touchmove(e){this.tryTouchToSnag(e)}dispose(){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("SimpleDragHandler dispose"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.dragging&&(this._attach&&(this.pointer.dragging=!1),this.pointer.cursor=null,this.pointer.removeInputListener(this.dragListener)),this.isDraggingProperty.dispose(),this.dragEndAction.dispose(),this.dragAction.dispose(),this.dragStartAction.dispose(),super.dispose(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}static createForwardingListener(e,t){return t=ds({allowTouchSnag:!1},t),{down:i=>{!i.pointer.dragging&&i.canStartPress()&&e(i)},touchenter:function(i){t.allowTouchSnag&&this.down(i)},touchmove:function(i){t.allowTouchSnag&&this.down(i)}}}}te.register("SimpleDragHandler",n0);let r0=0;const a0=_.constant(!0),o0=h=>h.isPressed,dg=class dg extends Il{constructor(e){const t=st()({press:_.noop,release:_.noop,targetNode:null,drag:_.noop,attach:!0,mouseButton:0,pressCursor:"pointer",useInputListenerCursor:!1,canStartPress:a0,a11yLooksPressedInterval:100,collapseDragEvents:!1,phetioEnabledPropertyInstrumented:!1,tandem:ai.REQUIRED,phetioReadOnly:!0,phetioFeatured:Hi.DEFAULT_OPTIONS.phetioFeatured},e);assert&&assert(typeof t.mouseButton=="number"&&t.mouseButton>=0&&t.mouseButton%1===0,"mouseButton should be a non-negative integer"),assert&&assert(t.pressCursor===null||typeof t.pressCursor=="string","pressCursor should either be a string or null"),assert&&assert(typeof t.press=="function","The press callback should be a function"),assert&&assert(typeof t.release=="function","The release callback should be a function"),assert&&assert(typeof t.drag=="function","The drag callback should be a function"),assert&&assert(t.targetNode===null||t.targetNode instanceof tt,"If provided, targetNode should be a Node"),assert&&assert(typeof t.attach=="boolean","attach should be a boolean"),assert&&assert(typeof t.a11yLooksPressedInterval=="number","a11yLooksPressedInterval should be a number"),super(t),this._id=r0++,sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} construction`),this._mouseButton=t.mouseButton,this._a11yLooksPressedInterval=t.a11yLooksPressedInterval,this._pressCursor=t.pressCursor,this._pressListener=t.press,this._releaseListener=t.release,this._dragListener=t.drag,this._canStartPress=t.canStartPress,this._targetNode=t.targetNode,this._attach=t.attach,this._collapseDragEvents=t.collapseDragEvents,this.overPointers=Xu(),this.isPressedProperty=new ci(!1,{reentrant:!0}),this.isOverProperty=new ci(!1),this.looksOverProperty=new ci(!1),this.isHoveringProperty=new ci(!1),this.isHighlightedProperty=new ci(!1),this.isFocusedProperty=new ci(!1),this.cursorProperty=new Si([this.enabledProperty],i=>t.useInputListenerCursor&&i&&this._attach?this._pressCursor:null),this.pointer=null,this.pressedTrail=null,this.interrupted=!1,this._pendingCollapsedDragEvent=null,this._listeningToPointer=!1,this._isHoveringListener=this.invalidateHovering.bind(this),this._isHighlightedListener=this.invalidateHighlighted.bind(this),this.pdomClickingProperty=new ci(!1),this.looksPressedProperty=Si.or([this.pdomClickingProperty,this.isPressedProperty]),this._pdomClickingTimeoutListener=null,this._pointerListener={up:this.pointerUp.bind(this),cancel:this.pointerCancel.bind(this),move:this.pointerMove.bind(this),interrupt:this.pointerInterrupt.bind(this),listener:this},this._pressAction=new qt(this.onPress.bind(this),{tandem:t.tandem.createTandem("pressAction"),phetioDocumentation:"Executes whenever a press occurs. The first argument when executing can be used to convey info about the SceneryEvent.",phetioReadOnly:!0,phetioFeatured:t.phetioFeatured,phetioEventType:si.USER,parameters:[{name:"event",phetioType:Ms.SceneryEventIO},{phetioPrivate:!0,valueType:[tt,null]},{phetioPrivate:!0,valueType:["function",null]}]}),this._releaseAction=new qt(this.onRelease.bind(this),{parameters:[{name:"event",phetioType:Ft(Ms.SceneryEventIO)},{phetioPrivate:!0,valueType:["function",null]}],tandem:t.tandem.createTandem("releaseAction"),phetioDocumentation:"Executes whenever a release occurs.",phetioReadOnly:!0,phetioFeatured:t.phetioFeatured,phetioEventType:si.USER}),this.display=null,this.boundInvalidateOverListener=this.invalidateOver.bind(this),this.overPointers.lengthProperty.link(this.invalidateOver.bind(this)),this.isFocusedProperty.link(this.invalidateOver.bind(this)),this.overPointers.lengthProperty.link(this._isHoveringListener),this.isPressedProperty.link(this._isHoveringListener),this.overPointers.addItemAddedListener(i=>i.isDownProperty.link(this._isHoveringListener)),this.overPointers.addItemRemovedListener(i=>i.isDownProperty.unlink(this._isHoveringListener)),this.isHoveringProperty.link(this._isHighlightedListener),this.isPressedProperty.link(this._isHighlightedListener),this.enabledProperty.lazyLink(this.onEnabledPropertyChange.bind(this))}get isPressed(){return this.isPressedProperty.value}get cursor(){return this.cursorProperty.value}get attach(){return this._attach}get targetNode(){return this._targetNode}getCurrentTarget(){return assert&&assert(this.isPressed,"We have no currentTarget if we are not pressed"),this.pressedTrail.lastNode()}get currentTarget(){return this.getCurrentTarget()}canPress(e){return!!this.enabledProperty.value&&!this.isPressed&&this._canStartPress(e,this)&&(!(e.pointer instanceof qs)||e.domEvent.button===this._mouseButton)&&(!this._attach||!e.pointer.isAttached())}canClick(){return this.enabledProperty.value&&!this.isPressed&&this._canStartPress(null,this)}press(e,t,i){return assert&&assert(e,"An event is required"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} press`),this.canPress(e)?(this.flushCollapsedDrag(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} successful press`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this._pressAction.execute(e,t||null,i||null),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop(),!0):(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} could not press`),!1)}release(e,t){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} release`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.flushCollapsedDrag(),this._releaseAction.execute(e||null,t||null),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}drag(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} drag`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),assert&&assert(this.isPressed,"Can only drag while pressed"),this._dragListener(e,this),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}interrupt(){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} interrupt`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.pdomClickingProperty.value?(this.interrupted=!0,this._listeningToPointer?this.release():(this.isPressedProperty.value=!1,this._releaseListener(null,this)),Wi.hasListener(this._pdomClickingTimeoutListener)&&(Wi.clearTimeout(this._pdomClickingTimeoutListener),this.pdomClickingProperty.isDisposed||(this.pdomClickingProperty.value=!1))):this.isPressed&&(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} interrupting`),this.interrupted=!0,this.release()),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}clearOverPointers(){this.overPointers.clear()}step(){this.flushCollapsedDrag()}setCreatePanTargetBounds(e){this._pointerListener.createPanTargetBounds=e}set createPanTargetBounds(e){this.setCreatePanTargetBounds(e)}setCreatePanTargetBoundsFromTrail(e){assert&&assert(e.length>0,"trail has no Nodes to provide localBounds"),this.setCreatePanTargetBounds(()=>e.localToGlobalBounds(e.lastNode().localBounds))}set createPanTargetBoundsFromTrail(e){this.setCreatePanTargetBoundsFromTrail(e)}flushCollapsedDrag(){this._pendingCollapsedDragEvent&&this.drag(this._pendingCollapsedDragEvent),this._pendingCollapsedDragEvent=null}invalidateOver(){let e=!1;if(this._listeningToPointer)e=!1;else for(let t=0;t<this.overPointers.length;t++)if(this.overPointers.get(t).isAttached()){e=!0;break}this.isOverProperty.value=this.overPointers.length>0&&!e,this.looksOverProperty.value=this.isOverProperty.value||this.isFocusedProperty.value&&!!this.display&&this.display.focusManager.pdomFocusHighlightsVisibleProperty.value}invalidateHovering(){for(let e=0;e<this.overPointers.length;e++){const t=this.overPointers[e];if(!t.isDown||t===this.pointer){this.isHoveringProperty.value=!0;return}}this.isHoveringProperty.value=!1}invalidateHighlighted(){this.isHighlightedProperty.value=this.isHoveringProperty.value||this.isPressedProperty.value}onEnabledPropertyChange(e){!e&&this.interrupt()}onPress(e,t,i){assert&&assert(!this.isDisposed,"Should not press on a disposed listener");const s=t||this._targetNode;this.pointer=e.pointer,this.pressedTrail=s?s.getUniqueTrail():e.trail.subtrailTo(e.currentTarget,!1),this.interrupted=!1,this.pointer.addInputListener(this._pointerListener,this._attach),this._listeningToPointer=!0,this.pointer.cursor=this.pressedTrail.lastNode().getEffectiveCursor()||this._pressCursor,this.isPressedProperty.value=!0,this._pressListener(e,this),i&&i()}onRelease(e,t){assert&&assert(this.isPressed,"This listener is not pressed");const i=this;i.pointer.removeInputListener(this._pointerListener),this._listeningToPointer=!1,this.isPressedProperty.value=!1,this._releaseListener(e,this),t&&t(),i.pointer.cursor=null,this.pointer=null,this.pressedTrail=null}down(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} down`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.press(e),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}up(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} up`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.invalidateOver(),this.invalidateHovering(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}enter(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} enter`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.overPointers.push(e.pointer),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}move(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} move`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.invalidateOver(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}exit(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} exit`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.overPointers.includes(e.pointer)&&this.overPointers.remove(e.pointer),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}pointerUp(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} pointer up`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.isPressed&&(assert&&assert(e.pointer===this.pointer),this.release(e)),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}pointerCancel(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} pointer cancel`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.isPressed&&(assert&&assert(e.pointer===this.pointer),this.interrupt()),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}pointerMove(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} pointer move`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.isPressed&&(assert&&assert(e.pointer===this.pointer),this._collapseDragEvents?this._pendingCollapsedDragEvent=e:this.drag(e)),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}pointerInterrupt(){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} pointer interrupt`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.interrupt(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}click(e,t){return this.canClick()&&(this.interrupted=!1,this.pdomClickingProperty.value=!0,this.isFocusedProperty.value=!0,this.isPressedProperty.value=!0,this._pressListener(e,this),t&&t(),this.isPressedProperty.value=!1,this._releaseListener(e,this),Wi.clearTimeout(this._pdomClickingTimeoutListener),this._pdomClickingTimeoutListener=Wi.setTimeout(()=>{this.pdomClickingProperty.isDisposed||(this.pdomClickingProperty.value=!1)},this._a11yLooksPressedInterval)),!0}focus(e){const t=e.trail.rootNode().getRootedDisplays().filter(i=>i.isAccessible());assert&&assert(t.length===1,"cannot focus node with zero or multiple accessible displays attached"),this.display=t[0],this.display.focusManager.pdomFocusHighlightsVisibleProperty.hasListener(this.boundInvalidateOverListener)||this.display.focusManager.pdomFocusHighlightsVisibleProperty.link(this.boundInvalidateOverListener),this.isFocusedProperty.value=!0}blur(){this.display&&(this.display.focusManager.pdomFocusHighlightsVisibleProperty.hasListener(this.boundInvalidateOverListener)&&this.display.focusManager.pdomFocusHighlightsVisibleProperty.unlink(this.boundInvalidateOverListener),this.display=null),this.isFocusedProperty.value=!1}dispose(){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} dispose`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.overPointers.clear(),this._listeningToPointer&&o0(this)&&this.pointer.removeInputListener(this._pointerListener),this.isPressedProperty.isDisposed||(this.isPressedProperty.unlink(this._isHighlightedListener),this.isPressedProperty.unlink(this._isHoveringListener)),!this.isHoveringProperty.isDisposed&&this.isHoveringProperty.unlink(this._isHighlightedListener),this._pressAction.dispose(),this._releaseAction.dispose(),this.looksPressedProperty.dispose(),this.pdomClickingProperty.dispose(),this.cursorProperty.dispose(),this.isFocusedProperty.dispose(),this.isHighlightedProperty.dispose(),this.isHoveringProperty.dispose(),this.looksOverProperty.dispose(),this.isOverProperty.dispose(),this.isPressedProperty.dispose(),this.overPointers.dispose(),this.display&&(this.display.focusManager.pdomFocusHighlightsVisibleProperty.unlink(this.boundInvalidateOverListener),this.display=null),super.dispose(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}};dg.phetioAPI={pressAction:{phetioType:qt.PhetioActionIO([Ms.SceneryEventIO])},releaseAction:{phetioType:qt.PhetioActionIO([Ft(Ms.SceneryEventIO)])}};let Yn=dg;te.register("PressListener",Yn);class Bu extends Yn{constructor(e){const t=st()({fire:_.noop,fireOnDown:!1,fireOnHold:!1,fireOnHoldDelay:400,fireOnHoldInterval:100,tandem:ai.REQUIRED,phetioReadOnly:Hi.DEFAULT_OPTIONS.phetioReadOnly},e);assert&&assert(typeof t.fire=="function","The fire callback should be a function"),assert&&assert(typeof t.fireOnDown=="boolean","fireOnDown should be a boolean"),super(t),this._fireOnDown=t.fireOnDown,this.firedEmitter=new _s({tandem:t.tandem.createTandem("firedEmitter"),phetioEventType:si.USER,phetioReadOnly:t.phetioReadOnly,phetioDocumentation:"Emits at the time that the listener fires",parameters:[{name:"event",phetioType:Ft(Ms.SceneryEventIO)}]}),this.firedEmitter.addListener(t.fire),t.fireOnHold&&(this._timer=new Rh({callback:this.fire.bind(this,null),delay:t.fireOnHoldDelay,interval:t.fireOnHoldInterval}))}fire(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("FireListener fire"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.firedEmitter.emit(e),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}press(e,t,i){return super.press(e,t,()=>{this._fireOnDown&&this.fire(e),this._timer&&this._timer.start(),i&&i()})}release(e,t){super.release(e,()=>{const i=!this._fireOnDown&&this.isHoveringProperty.value&&!this.interrupted;this._timer?this._timer.stop(i):i&&this.fire(e||null),t&&t()})}click(e,t){return super.click(e,()=>{this.interrupted||this.fire(e),t&&t()})}interrupt(){super.interrupt(),this._timer&&this._timer.stop(!1)}dispose(){this.firedEmitter.dispose(),this._timer&&this._timer.dispose(),super.dispose()}}te.register("FireListener",Bu);const Uc=new Pe(0,0),Zn=h=>h.isPressed;class l0 extends Yn{constructor(e){const t=st()({positionProperty:null,start:null,end:null,transform:null,dragBoundsProperty:null,allowTouchSnag:!0,applyOffset:!0,useParentOffset:!1,trackAncestors:!1,translateNode:!1,mapPosition:null,offsetPosition:null,canClick:!1,tandem:ai.REQUIRED,phetioReadOnly:!0,phetioFeatured:Hi.DEFAULT_OPTIONS.phetioFeatured},e);assert&&assert(!t.dragBounds,"options.dragBounds was removed in favor of options.dragBoundsProperty"),assert&&assert(!t.useParentOffset||t.positionProperty,"If useParentOffset is set, a positionProperty is required"),assert&&assert(!(t.mapPosition&&t.dragBoundsProperty),"Only one of mapPosition and dragBoundsProperty can be provided, as they handle mapping of the drag point"),super(t),this._allowTouchSnag=t.allowTouchSnag,this._applyOffset=t.applyOffset,this._useParentOffset=t.useParentOffset,this._trackAncestors=t.trackAncestors,this._translateNode=t.translateNode,this._transform=t.transform,this._positionProperty=t.positionProperty,this._mapPosition=t.mapPosition,this._offsetPosition=t.offsetPosition,this._dragBoundsProperty=t.dragBoundsProperty||new wi(null),this._start=t.start,this._end=t.end,this._canClick=t.canClick,this.isUserControlledProperty=this.isPressedProperty,this._globalPoint=new Pe(0,0),this._localPoint=new Pe(0,0),this._parentPoint=new Pe(0,0),this._modelPoint=new Pe(0,0),this._modelDelta=new Pe(0,0),this._parentOffset=new Pe(0,0),this._transformTracker=null,this._transformTrackerListener=this.ancestorTransformed.bind(this),this._lastInterruptedTouchLikePointer=null,this._dragAction=new qt(i=>{assert&&assert(Zn(this));const n=this.pointer.point;n&&(this._globalPoint.equals(n)||this.reposition(n)),Yn.prototype.drag.call(this,i)},{parameters:[{name:"event",phetioType:Ms.SceneryEventIO}],phetioFeatured:t.phetioFeatured,tandem:t.tandem.createTandem("dragAction"),phetioHighFrequency:!0,phetioDocumentation:"Emits whenever a drag occurs with an SceneryEventIO argument.",phetioReadOnly:t.phetioReadOnly,phetioEventType:si.USER})}press(e,t,i){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener press"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const s=super.press(e,t,()=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener successful press"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),assert&&assert(Zn(this));const n=this;n.pointer.reserveForDrag(),this.attachTransformTracker(),assert&&assert(n.pointer.point!==null);const o=n.pointer.point,c=this.globalToParentPoint(this._localPoint.set(o));this._useParentOffset&&this.modelToParentPoint(this._parentOffset.set(this._positionProperty.value)).subtract(c),this.parentToLocalPoint(c),this.reposition(o),this._start&&this._start(e,n),i&&i(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()});return sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop(),s}release(e,t){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener release"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),super.release(e,()=>{this.detachTransformTracker(),this._end&&this._end(e||null,this),t&&t()}),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}canClick(){return super.canClick()&&this._canClick}click(e,t){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener click"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const i=super.click(e,()=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener successful press"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this._start&&this._start(e,this),t&&t(),this._end&&this._end(e,this),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()});return sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop(),i}drag(e){assert&&assert(Zn(this));const i=this.pointer.point;!i||this._globalPoint.equals(i)||(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener drag"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this._dragAction.execute(e),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop())}tryTouchSnag(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener tryTouchSnag"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this._allowTouchSnag&&(!this.attach||!e.pointer.isAttached())&&this.press(e),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}getGlobalPoint(){return this._globalPoint.copy()}get globalPoint(){return this.getGlobalPoint()}getLocalPoint(){return this._localPoint.copy()}get localPoint(){return this.getLocalPoint()}getParentPoint(){return this._parentPoint.copy()}get parentPoint(){return this.getParentPoint()}getModelPoint(){return this._modelPoint.copy()}get modelPoint(){return this.getModelPoint()}getModelDelta(){return this._modelDelta.copy()}get modelDelta(){return this.getModelDelta()}globalToParentPoint(e){assert&&assert(Zn(this));const t=this;let i;return assert&&(i=t.pressedTrail.globalToParentPoint(e)),t.pressedTrail.getParentTransform().getInverse().multiplyVector2(e),assert&&assert(e.equals(i)),e}parentToLocalPoint(e){assert&&assert(Zn(this));const t=this;let i;return assert&&(i=t.pressedTrail.lastNode().parentToLocalPoint(e)),t.pressedTrail.lastNode().getTransform().getInverse().multiplyVector2(e),assert&&assert(e.equals(i)),e}localToParentPoint(e){assert&&assert(Zn(this));const t=this;let i;return assert&&(i=t.pressedTrail.lastNode().localToParentPoint(e)),t.pressedTrail.lastNode().getMatrix().multiplyVector2(e),assert&&assert(e.equals(i)),e}parentToModelPoint(e){return this._transform&&(this._transform instanceof Ks?this._transform:this._transform.value).getInverse().multiplyVector2(e),e}modelToParentPoint(e){return this._transform&&(this._transform instanceof Ks?this._transform:this._transform.value).getMatrix().multiplyVector2(e),e}mapModelPoint(e){return this._mapPosition?this._mapPosition(e):this._dragBoundsProperty.value?this._dragBoundsProperty.value.closestPointTo(e):e}applyParentOffset(e){this._offsetPosition&&e.add(this._offsetPosition(e,this)),this._applyOffset&&(this._useParentOffset?e.add(this._parentOffset):(e.subtract(this.localToParentPoint(Uc.set(this._localPoint))),e.add(this.localToParentPoint(Uc.setXY(0,0)))))}reposition(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener reposition"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),assert&&assert(Zn(this));const t=this;this._globalPoint.set(e),this.applyParentOffset(this.globalToParentPoint(this._parentPoint.set(e))),this._modelDelta.set(this._modelPoint).negate(),this._modelPoint.set(this.mapModelPoint(this.parentToModelPoint(Uc.set(this._parentPoint)))),this._modelDelta.add(this._modelPoint),this.modelToParentPoint(this._parentPoint.set(this._modelPoint)),this._translateNode&&(t.pressedTrail.lastNode().translation=this._parentPoint),this._positionProperty&&(this._positionProperty.value=this._modelPoint.copy()),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}touchenter(e){e.pointer.isDownProperty.value&&this.tryTouchSnag(e)}touchmove(e){this.tryTouchSnag(e)}ancestorTransformed(){assert&&assert(Zn(this));const t=this.pointer.point;t&&this.reposition(t)}attachTransformTracker(){assert&&assert(Zn(this));const e=this;this._trackAncestors&&(this._transformTracker=new pa(e.pressedTrail.copy().removeDescendant()),this._transformTracker.addListener(this._transformTrackerListener))}detachTransformTracker(){this._transformTracker&&(this._transformTracker.removeListener(this._transformTrackerListener),this._transformTracker.dispose(),this._transformTracker=null)}getDragBounds(){return this._dragBoundsProperty.value}get dragBounds(){return this.getDragBounds()}setTransform(e){this._transform=e}set transform(e){this.setTransform(e)}get transform(){return this.getTransform()}getTransform(){return this._transform}interrupt(){this.pointer&&this.pointer.isTouchLike()&&(this._lastInterruptedTouchLikePointer=this.pointer),super.interrupt()}canPress(e){return e.pointer===this._lastInterruptedTouchLikePointer?!1:super.canPress(e)}dispose(){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener dispose"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this._dragAction.dispose(),this.detachTransformTracker(),super.dispose(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}static createForwardingListener(e,t){const i=st()({allowTouchSnag:!0},t);return{down(s){s.canStartPress()&&e(s)},touchenter(s){i.allowTouchSnag&&this.down(s)},touchmove(s){i.allowTouchSnag&&this.down(s)}}}}te.register("DragListener",l0);class iy{constructor(e,t){this.pointer=e,this.trail=t,this.interrupted=!1,this.initialPoint=e.point,this.localPoint=null,this.recomputeLocalPoint()}recomputeLocalPoint(){this.localPoint=this.trail.globalToLocalPoint(this.pointer.point)}get targetPoint(){return this.trail.globalToParentPoint(this.pointer.point)}}te.register("MultiListenerPress",iy);const h0=25;class sy{constructor(e,t){const i=st()({mouseButton:0,pressCursor:"pointer",allowScale:!0,allowRotation:!0,allowMultitouchInterruption:!1,allowMoveInterruption:!0,minScale:1,maxScale:4,tandem:ai.REQUIRED},t);this._targetNode=e,this._minScale=i.minScale,this._maxScale=i.maxScale,this._mouseButton=i.mouseButton,this._pressCursor=i.pressCursor,this._allowScale=i.allowScale,this._allowRotation=i.allowRotation,this._allowMultitouchInterruption=i.allowMultitouchInterruption,this._allowMoveInterruption=i.allowMoveInterruption,this._presses=[],this._backgroundPresses=[],this.matrixProperty=new wi(e.matrix.copy(),{phetioValueType:Ze.Matrix3IO,tandem:i.tandem.createTandem("matrixProperty"),phetioReadOnly:!0}),this.matrixProperty.link(s=>{this._targetNode.matrix=s}),this._interrupted=!1,this._pressListener={move:s=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener pointer move"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const n=this.findPress(s.pointer);assert&&assert(n,"Press should be found for move event"),this.movePress(n),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},up:s=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener pointer up"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const n=this.findPress(s.pointer);assert&&assert(n,"Press should be found for up event"),this.removePress(n),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},cancel:s=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener pointer cancel"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const n=this.findPress(s.pointer);assert&&assert(n,"Press should be found for cancel event"),n.interrupted=!0,this.removePress(n),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},interrupt:()=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener pointer interrupt"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.interrupt(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}},this._backgroundListener={up:s=>{if(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener background up"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),!this._interrupted){const n=this.findBackgroundPress(s.pointer);assert&&assert(n,"Background press should be found for up event"),this.removeBackgroundPress(n)}sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},move:s=>{const n=this._backgroundPresses.filter(o=>!o.pointer.hasIntent(hs.DRAG)&&o.initialPoint.distance(o.pointer.point)>h0);(this.getCurrentScale()!==1||n.length>=2)&&(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener attached, interrupting for press"),n.forEach(o=>{this.removeBackgroundPress(o),this.interruptOtherListeners(o.pointer),this.addPress(o)}))},cancel:s=>{if(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener background cancel"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),!this._interrupted){const n=this.findBackgroundPress(s.pointer);assert&&assert(n,"Background press should be found for cancel event"),this.removeBackgroundPress(n)}sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},interrupt:()=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener background interrupt"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.interrupt(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}}}findPress(e){for(let t=0;t<this._presses.length;t++)if(this._presses[t].pointer===e)return this._presses[t];return null}findBackgroundPress(e){for(let t=0;t<this._backgroundPresses.length;t++)if(this._backgroundPresses[t].pointer===e)return this._backgroundPresses[t];return null}hasPress(e){return _.some(this._presses.concat(this._backgroundPresses),t=>t.pointer===e.pointer)}interruptOtherListeners(e){const t=e.getListeners();for(let i=0;i<t.length;i++){const s=t[i];s!==this._backgroundListener&&s.interrupt&&s.interrupt()}}down(e){if(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener down"),e.pointer instanceof qs&&e.domEvent instanceof MouseEvent&&e.domEvent.button!==this._mouseButton){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener abort: wrong mouse button");return}this._interrupted=!1;let t;_.includes(e.trail.nodes,this._targetNode)?t=e.trail.subtrailTo(this._targetNode,!1):t=this._targetNode.getUniqueTrailTo(e.target),assert&&assert(_.includes(t.nodes,this._targetNode),"targetNode must be in the Trail for Press"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const i=new iy(e.pointer,t);!this._allowMoveInterruption&&!this._allowMultitouchInterruption?e.pointer.isAttached()||(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener unattached, using press"),this.addPress(i)):(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener attached, adding background press"),this.addBackgroundPress(i)),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}addPress(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener addPress"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.hasPress(e)||(this._presses.push(e),e.pointer.cursor=this._pressCursor,e.pointer.addInputListener(this._pressListener,!0),this.recomputeLocals(),this.reposition()),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}movePress(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener movePress"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.reposition(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}removePress(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener removePress"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),e.pointer.removeInputListener(this._pressListener),e.pointer.cursor=null,is(this._presses,e),this.recomputeLocals(),this.reposition(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}addBackgroundPress(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener addBackgroundPress"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.hasPress(e)||(this._backgroundPresses.push(e),e.pointer.addInputListener(this._backgroundListener,!1)),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}removeBackgroundPress(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener removeBackgroundPress"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),e.pointer.removeInputListener(this._backgroundListener),is(this._backgroundPresses,e),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}reposition(){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener reposition"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.matrixProperty.set(this.computeMatrix()),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}recomputeLocals(){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener recomputeLocals"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();for(let e=0;e<this._presses.length;e++)this._presses[e].recomputeLocalPoint();sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}interrupt(){for(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener interrupt"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();this._presses.length;)this.removePress(this._presses[this._presses.length-1]);for(;this._backgroundPresses.length;)this.removeBackgroundPress(this._backgroundPresses[this._backgroundPresses.length-1]);this._interrupted=!0,sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}computeMatrix(){return this._presses.length===0?this._targetNode.getMatrix():this._presses.length===1?this.computeSinglePressMatrix():this._allowScale&&this._allowRotation?this.computeTranslationRotationScaleMatrix():this._allowScale?this.computeTranslationScaleMatrix():this._allowRotation?this.computeTranslationRotationMatrix():this.computeTranslationMatrix()}computeSinglePressMatrix(){const e=this._presses[0].targetPoint,t=this._presses[0].localPoint;assert&&assert(t,"localPoint is not defined on the Press?");const i=this._targetNode.localToParentPoint(t),s=e.minus(i);return Ze.translationFromVector(s).timesMatrix(this._targetNode.getMatrix())}computeTranslationMatrix(){const e=new Pe(0,0);for(let t=0;t<this._presses.length;t++){e.add(this._presses[t].targetPoint);const i=this._presses[t].localPoint;assert&&assert(i,"localPoint is not defined on the Press?"),e.subtract(i)}return Ze.translationFromVector(e.dividedScalar(this._presses.length))}computeTranslationScaleMatrix(){const e=this._presses.map(w=>(assert&&assert(w.localPoint,"localPoint is not defined on the Press?"),w.localPoint)),t=this._presses.map(w=>w.targetPoint),i=new Pe(0,0),s=new Pe(0,0);e.forEach(w=>{i.add(w)}),t.forEach(w=>{s.add(w)}),i.divideScalar(this._presses.length),s.divideScalar(this._presses.length);let n=0,o=0;e.forEach(w=>{n+=w.distanceSquared(i)}),t.forEach(w=>{o+=w.distanceSquared(s)});let c=this.getCurrentScale();o!==0&&(c=this.limitScale(Math.sqrt(o/n)));const p=Ze.translation(s.x,s.y),f=Ze.translation(-i.x,-i.y);return p.timesMatrix(Ze.scaling(c)).timesMatrix(f)}limitScale(e){let t=Math.max(e,this._minScale);return t=Math.min(t,this._maxScale),t}computeTranslationRotationMatrix(){let e;const t=new sa(2,this._presses.length),i=new sa(2,this._presses.length),s=new Pe(0,0),n=new Pe(0,0);for(e=0;e<this._presses.length;e++){const O=this._presses[e].localPoint,T=this._presses[e].targetPoint;s.add(O),n.add(T),t.set(0,e,O.x),t.set(1,e,O.y),i.set(0,e,T.x),i.set(1,e,T.y)}for(s.divideScalar(this._presses.length),n.divideScalar(this._presses.length),e=0;e<this._presses.length;e++)t.set(0,e,t.get(0,e)-s.x),t.set(1,e,t.get(1,e)-s.y),i.set(0,e,i.get(0,e)-n.x),i.set(1,e,i.get(1,e)-n.y);const o=t.times(i.transpose()),c=new ru(o);let p=c.getV().times(c.getU().transpose());p.det()<0&&(p=c.getV().times(sa.diagonalMatrix([1,-1])).times(c.getU().transpose()));const f=new Ze().rowMajor(p.get(0,0),p.get(0,1),0,p.get(1,0),p.get(1,1),0,0,0,1),w=n.minus(f.timesVector2(s));return f.set02(w.x),f.set12(w.y),f}computeTranslationRotationScaleMatrix(){let e;const t=new sa(this._presses.length*2,4);for(e=0;e<this._presses.length;e++){const f=this._presses[e].localPoint;t.set(2*e+0,0,f.x),t.set(2*e+0,1,f.y),t.set(2*e+0,2,1),t.set(2*e+1,0,f.y),t.set(2*e+1,1,-f.x),t.set(2*e+1,3,1)}const i=new sa(this._presses.length*2,1);for(e=0;e<this._presses.length;e++){const f=this._presses[e].targetPoint;i.set(2*e+0,0,f.x),i.set(2*e+1,0,f.y)}const s=ru.pseudoinverse(t).times(i),n=s.get(0,0),o=s.get(1,0),c=s.get(2,0),p=s.get(3,0);return new Ze().rowMajor(n,o,c,-o,n,p,0,0,1)}getCurrentScale(){return this._targetNode.getScaleVector().x}resetTransform(){this._targetNode.resetTransform(),this.matrixProperty.set(this._targetNode.matrix.copy())}}te.register("MultiListener",sy);class Tn extends Ks{modelToViewPosition(e){return this.transformPosition2(e)}modelToViewXY(e,t){return new Pe(this.modelToViewX(e),this.modelToViewY(t))}modelToViewX(e){return this.matrix.m00()*e+this.matrix.m02()}modelToViewY(e){return this.matrix.m11()*e+this.matrix.m12()}modelToViewDelta(e){return this.transformDelta2(e)}modelToViewNormal(e){return this.transformNormal2(e)}modelToViewDeltaX(e){return this.transformDeltaX(e)}modelToViewDeltaY(e){return this.transformDeltaY(e)}modelToViewBounds(e){return this.transformBounds2(e)}modelToViewShape(e){return this.transformShape(e)}modelToViewRay(e){return this.transformRay2(e)}viewToModelPosition(e){return this.inversePosition2(e)}viewToModelXY(e,t){return new Pe(this.viewToModelX(e),this.viewToModelY(t))}viewToModelX(e){const t=this.getInverse();return t.m00()*e+t.m02()}viewToModelY(e){const t=this.getInverse();return t.m11()*e+t.m12()}viewToModelDelta(e){return this.inverseDelta2(e)}viewToModelDeltaXY(e,t){return new Pe(this.viewToModelDeltaX(e),this.viewToModelDeltaY(t))}viewToModelNormal(e){return this.inverseNormal2(e)}viewToModelDeltaX(e){return this.inverseDeltaX(e)}viewToModelDeltaY(e){return this.inverseDeltaY(e)}viewToModelBounds(e){return this.inverseBounds2(e)}viewToModelShape(e){return this.inverseShape(e)}viewToModelRay(e){return this.inverseRay2(e)}validateMatrix(e){super.validateMatrix(e),assert&&assert(e.isAligned(),"matrix must be aligned, ModelViewTransform2 does not support arbitrary rotations")}setToRectangleMapping(e,t){const i=t.width/e.width,s=t.x-i*e.x,n=t.height/e.height,o=t.y-n*e.y;return this.setMatrix(Ze.affine(i,0,s,0,n,o)),this}setToRectangleInvertedYMapping(e,t){const i=t.width/e.width,s=t.x-i*e.x,n=-t.height/e.height,o=t.y-n*e.getMaxY();return this.setMatrix(Ze.affine(i,0,s,0,n,o)),this}static createIdentity(){return new Tn(Ze.IDENTITY)}static createOffsetScaleMapping(e,t){return new Tn(Ze.affine(t,0,e.x,0,t,e.y))}static createOffsetXYScaleMapping(e,t,i){return new Tn(Ze.affine(t,0,e.x,0,i,e.y))}static createSinglePointXYScaleMapping(e,t,i,s){const n=t.x-e.x*i,o=t.y-e.y*s;return Tn.createOffsetXYScaleMapping(new Pe(n,o),i,s)}static createSinglePointScaleMapping(e,t,i){return Tn.createSinglePointXYScaleMapping(e,t,i,i)}static createSinglePointScaleInvertedYMapping(e,t,i){return Tn.createSinglePointXYScaleMapping(e,t,i,-i)}static createRectangleMapping(e,t){return new Tn().setToRectangleMapping(e,t)}static createRectangleInvertedYMapping(e,t){return new Tn().setToRectangleInvertedYMapping(e,t)}}Fm.register("ModelViewTransform2",Tn);const $p=new Ze;class ny extends sy{constructor(e,t){var s;const i=st()({panBounds:$e.NOTHING,targetBounds:null,targetScale:1,allowRotation:!1},t);super(e,i),this._panBounds=i.panBounds,this._targetBounds=i.targetBounds||e.globalBounds.copy(),this._targetScale=i.targetScale,this.sourceFramePanBoundsProperty=new wi(ai.API_GENERATION?new $e(0,0,0,0):this._panBounds,{tandem:(s=i.tandem)==null?void 0:s.createTandem("sourceFramePanBoundsProperty"),phetioReadOnly:!0,phetioValueType:$e.Bounds2IO}),this.sourceFramePanBoundsProperty.lazyLink(()=>{if(ja.value){const n=Tn.createRectangleMapping(this.sourceFramePanBoundsProperty.get(),this._panBounds),o=this._targetNode.matrix.translation.componentMultiply(n.matrix.getScaleVector()),c=this.matrixProperty.get().getScaleVector();this.matrixProperty.set(Ze.translationFromVector(o).timesMatrix(Ze.scaling(c.x,c.y)))}},{phetioDependencies:[this.matrixProperty]})}correctReposition(){$p.set(this._targetNode.matrix);const e=this._targetBounds.transformed(this._targetNode.getMatrix());e.left>this._panBounds.left&&(this._targetNode.left=this._panBounds.left-(e.left-this._targetNode.left)),e.top>this._panBounds.top&&(this._targetNode.top=this._panBounds.top-(e.top-this._targetNode.top)),e.right<this._panBounds.right&&(this._targetNode.right=this._panBounds.right+(this._targetNode.right-e.right)),e.bottom<this._panBounds.bottom&&(this._targetNode.bottom=this._panBounds.bottom+(this._targetNode.bottom-e.bottom)),$p.equals(this._targetNode.matrix)||this.matrixProperty.set(this._targetNode.matrix.copy())}addPress(e){super.addPress(e);const i=this._targetBounds.transformed(this._targetNode.getMatrix()).equalsEpsilon(this._panBounds,1e-8);e.pointer.cursor=i?null:this._pressCursor}reposition(){super.reposition(),this.correctReposition()}resetTransform(){super.resetTransform(),this.correctReposition()}setPanBounds(e){this._panBounds=e,ai.API_GENERATION||this.sourceFramePanBoundsProperty.set(this._panBounds),this.correctReposition()}setTargetBounds(e){this._targetBounds=e,this.correctReposition()}setTargetScale(e){this._targetScale=e}getTargetBounds(){return this._targetBounds}}te.register("PanZoomListener",ny);const Gp="all-scroll",c0=150,u0=1e3,$o=new Pe(0,0),Do=new Pe(0,0),Wp=new Pe(0,0),Up=new $e(0,0,0,0);class ry extends ny{constructor(e,t){const i=st()({tandem:ai.REQUIRED},t);super(e,i),this.trackpadGestureStartScale=1,this.animatingProperty=new ci(!1),this._transformTracker=null,this._focusBoundsListener=null,this.sourcePosition=null,this.destinationPosition=null,this.sourceScale=this.getCurrentScale(),this.destinationScale=this.getCurrentScale(),this.scaleGestureTargetPosition=null,this.discreteScales=p0(this._minScale,this._maxScale),this.middlePress=null,this._dragBounds=null,this._transformedPanBounds=this._panBounds.transformed(this._targetNode.matrix.inverted()),this._draggingInDragBounds=!1,this._attachedPointers=[],this.boundsFinite=!1;let s=null,n=null;this.gestureStartAction=new qt(c=>{assert&&assert(c.pageX,"pageX required on DOMEvent"),assert&&assert(c.pageY,"pageY required on DOMEvent"),assert&&assert(c.scale,"scale required on DOMEvent"),c.preventDefault(),this.trackpadGestureStartScale=c.scale,this.scaleGestureTargetPosition=new Pe(c.pageX,c.pageY)},{phetioPlayback:!0,tandem:i.tandem.createTandem("gestureStartAction"),parameters:[{name:"event",phetioType:Br}],phetioEventType:si.USER,phetioDocumentation:"Action that executes whenever a gesture starts on a trackpad in macOS Safari."}),this.gestureChangeAction=new qt(c=>{assert&&assert(c.scale,"scale required on DOMEvent"),c.preventDefault();const p=this.sourceScale+c.scale-this.trackpadGestureStartScale;this.setDestinationScale(p)},{phetioPlayback:!0,tandem:i.tandem.createTandem("gestureChangeAction"),parameters:[{name:"event",phetioType:Br}],phetioEventType:si.USER,phetioDocumentation:"Action that executes whenever a gesture changes on a trackpad in macOS Safari."}),Ui.safari&&!Ui.mobileSafari&&(s=this.handleGestureStartEvent.bind(this),n=this.handleGestureChangeEvent.bind(this),this.trackpadGestureStartScale=this.getCurrentScale(),self.addEventListener("gesturestart",s),self.addEventListener("gesturechange",n)),Hs.keydownEmitter.addListener(this.windowKeydown.bind(this));const o=this.handleFocusChange.bind(this);mi.pdomFocusProperty.link(o),this.sourceFramePanBoundsProperty.lazyLink(()=>{ja.value&&(this.initializePositions(),this.sourceScale=this.getCurrentScale(),this.setDestinationScale(this.sourceScale))},{phetioDependencies:[this.matrixProperty]}),this.disposeAnimatedPanZoomListener=()=>{s&&self.removeEventListener("gesturestart",s),n&&self.removeEventListener("gestureChange",n),this.animatingProperty.dispose(),this._transformTracker&&this._transformTracker.dispose(),mi.pdomFocusProperty.unlink(o)}}step(e){this.middlePress&&this.handleMiddlePress(e),this._attachedPointers.length>0&&this.getCurrentScale()>1&&(this._attachedPointers.length>0&&(this._attachedPointers=this._attachedPointers.filter(t=>t.attachedListener),assert&&assert(this._attachedPointers.length<=10,"Not clearing attachedPointers, there is probably a memory leak")),(this._draggingInDragBounds||this._attachedPointers.some(t=>t instanceof no))&&this.repositionDuringDrag()),this.animateToTargets(e)}down(e){super.down(e),this._dragBounds!==null&&e.pointer.hasIntent(hs.DRAG)&&(this._attachedPointers.length===0&&(this._draggingInDragBounds=this._dragBounds.containsPoint(e.pointer.point)),e.pointer.attachedListener&&(this._attachedPointers.includes(e.pointer)||this._attachedPointers.push(e.pointer))),e.pointer.type==="mouse"&&e.pointer instanceof qs&&e.pointer.middleDown&&!this.middlePress?(this.middlePress=new g0(e.pointer,e.trail),e.pointer.cursor=Gp):this.cancelMiddlePress()}cancelMiddlePress(){this.middlePress&&(this.middlePress.pointer.cursor=null,this.middlePress=null,this.stopInProgressAnimation())}movePress(e){this.middlePress||super.movePress(e)}move(e){if(this._attachedPointers.length>0&&this.getCurrentScale()>1)if(this._draggingInDragBounds){if(!this._attachedPointers.includes(e.pointer)){const t=this.hasDragIntent(e.pointer);e.currentTarget!==null&&t&&e.pointer.attachedListener&&this._attachedPointers.push(e.pointer)}}else this._dragBounds&&(this._draggingInDragBounds=this._dragBounds.containsPoint(e.pointer.point))}getTargetNodeDuringDrag(){if(this._attachedPointers.length>0){const e=this._attachedPointers[0].attachedListener;if(assert&&assert(e,"The attached Pointer is expected to have an attached listener."),e.listener instanceof Yn||e.listener instanceof Kp){const t=e.listener;if(t.isPressed)return t.getCurrentTarget()}}return null}getGlobalBoundsToViewDuringDrag(){let e=null;if(this._attachedPointers.length>0){const t=this._attachedPointers[0].attachedListener;if(assert&&assert(t,"The attached Pointer is expected to have an attached listener."),t.createPanTargetBounds)e=t.createPanTargetBounds();else if(t.listener instanceof Yn||t.listener instanceof Kp){const i=t.listener;if(i.isPressed){const s=i.getCurrentTarget();if(s.instances.length===1){const n=s.instances[0].trail;assert&&assert(n,"The target should be in one scene graph and have an instance with a trail."),e=n.parentToGlobalBounds(s.visibleBounds)}}}}return e}repositionDuringDrag(){const e=this.getGlobalBoundsToViewDuringDrag(),t=this.getTargetNodeDuringDrag();e&&this.keepBoundsInView(e,this._attachedPointers.some(i=>i instanceof no),t==null?void 0:t.limitPanDirection)}cancelPanningDuringDrag(e){if(e){const t=this._attachedPointers.indexOf(e.pointer);t>-1&&this._attachedPointers.splice(t,1)}else this._attachedPointers=[];this._draggingInDragBounds=!1}up(e){this.cancelPanningDuringDrag(e)}wheel(e){if(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener wheel"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),!this.middlePress){const t=new d0(e,this._targetScale);this.repositionFromWheel(t,e)}sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}windowKeydown(e){this.cancelMiddlePress();const t=_.get(self,"phet.joist.sim",null);if((!t||!t.display._accessible||!t.display.pdomRootElement.contains(e.target))&&(this.handleZoomCommands(e),Se.isArrowKey(e))){const i=new Yc(Hs,this.getCurrentScale(),this._targetScale);this.repositionFromKeys(i)}}keydown(e){const t=e.domEvent;assert&&assert(t instanceof KeyboardEvent,"keydown event must be a KeyboardEvent"),this.cancelMiddlePress(),this.handleZoomCommands(t);const i=e.pointer.hasIntent(hs.KEYBOARD_DRAG);if(Se.isArrowKey(t)&&!i){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener handle arrow key down"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const s=new Yc(Hs,this.getCurrentScale(),this._targetScale);this.repositionFromKeys(s),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}}handleFocusChange(e,t){if(this._transformTracker&&(this._transformTracker.dispose(),this._transformTracker=null),t&&t.trail.lastNode()&&t.trail.lastNode().focusPanTargetBoundsProperty){const i=t.trail.lastNode().focusPanTargetBoundsProperty;assert&&assert(this._focusBoundsListener&&i.hasListener(this._focusBoundsListener),"Focus bounds listener should be linked to the previous Node"),i.unlink(this._focusBoundsListener),this._focusBoundsListener=null}if(e){const i=e.trail.lastNode();let s=e.trail;if(e.trail.containsNode(this._targetNode)){const o=e.trail.nodes.indexOf(this._targetNode),c=e.trail.nodes.length;s=e.trail.slice(o,c)}this._transformTracker=new pa(s);const n=()=>{if(this.getCurrentScale()>1){let o;if(i.focusPanTargetBoundsProperty){const c=i.focusPanTargetBoundsProperty.value;o=e.trail.localToGlobalBounds(c)}else o=e.trail.localToGlobalBounds(e.trail.lastNode().localBounds);this.keepBoundsInView(o,!0,i.limitPanDirection)}};this._transformTracker.addListener(n),i.focusPanTargetBoundsProperty&&(this._focusBoundsListener=n,i.focusPanTargetBoundsProperty.link(this._focusBoundsListener)),this.keepTrailInView(e.trail,i.limitPanDirection)}}handleZoomCommands(e){const t=fa.isZoomCommand(e,!0),i=fa.isZoomCommand(e,!1);if(t||i){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiPanZoomListener keyboard zoom in"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),e.preventDefault();const s=this.getNextDiscreteScale(t),n=new Yc(Hs,s,this._targetScale);this.repositionFromKeys(n)}else fa.isZoomResetCommand(e)&&(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener keyboard reset"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),e.preventDefault(),this.resetTransform(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop())}handleGestureStartEvent(e){this.gestureStartAction.execute(e)}handleGestureChangeEvent(e){this.gestureChangeAction.execute(e)}handleMiddlePress(e){const t=this.middlePress;assert&&assert(t,"MiddlePress must be defined to handle");const i=this.sourcePosition;if(assert&&assert(i,"sourcePosition must be defined to handle middle press, be sure to call initializePositions"),e>0){const n=t.pointer.point.minus(t.initialPoint),o=n.magnitude/100;o>0&&(n.setMagnitude(Math.min(o/e,c0*this._targetScale)),this.setDestinationPosition(i.plus(n)))}}translateScaleToTarget(e,t){const i=this._targetNode.globalToLocalPoint(e),s=this._targetNode.globalToParentPoint(e),n=Ze.translation(-i.x,-i.y),o=Ze.translation(s.x,s.y),c=this.limitScale(this.getCurrentScale()+t),p=o.timesMatrix(Ze.scaling(c)).timesMatrix(n);this.matrixProperty.set(p),this.correctReposition()}setTranslationScaleToTarget(e,t){const i=this._targetNode.globalToLocalPoint(e),s=this._targetNode.globalToParentPoint(e),n=Ze.translation(-i.x,-i.y),o=Ze.translation(s.x,s.y),c=this.limitScale(t),p=o.timesMatrix(Ze.scaling(c)).timesMatrix(n);this.matrixProperty.set(p),this.correctReposition()}translateDelta(e){const t=this._targetNode.globalToParentPoint(this._panBounds.center),i=t.plus(e);this.translateToTarget(i,t)}translateToTarget(e,t){const i=this._targetNode.globalToParentPoint(e),n=this._targetNode.globalToParentPoint(t).minus(i);this.matrixProperty.set(Ze.translationFromVector(n).timesMatrix(this._targetNode.getMatrix())),this.correctReposition()}repositionFromKeys(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener reposition from key press"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const t=this.sourcePosition;assert&&assert(t,"sourcePosition must be defined to handle key press, be sure to call initializePositions");const i=e.scale,s=this.getCurrentScale();i!==s?(this.setDestinationScale(i),this.scaleGestureTargetPosition=e.computeScaleTargetFromKeyPress()):e.translationVector.equals(Pe.ZERO)||this.setDestinationPosition(t.plus(e.translationVector)),this.correctReposition(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}repositionFromWheel(e,t){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener reposition from wheel"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const i=t.domEvent;assert&&assert(i instanceof WheelEvent,"wheel event must be a WheelEvent");const s=this.sourcePosition;if(assert&&assert(s,"sourcePosition must be defined to handle wheel, be sure to call initializePositions"),i.preventDefault(),e.isCtrlKeyDown){const n=this.limitScale(this.getCurrentScale()+e.scaleDelta);this.scaleGestureTargetPosition=e.targetPoint,this.setDestinationScale(n)}else this.setDestinationPosition(s.plus(e.translationVector));this.correctReposition(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}correctReposition(){super.correctReposition(),this._panBounds.isFinite()&&(this._transformedPanBounds=this._panBounds.transformed(this._targetNode.matrix.inverted()),this.sourcePosition=this._transformedPanBounds.center,this.sourceScale=this.getCurrentScale())}addPress(e){super.addPress(e),this.stopInProgressAnimation()}removePress(e){super.removePress(e),this.middlePress&&(e.pointer.cursor=Gp),this._presses.length===0&&this.stopInProgressAnimation()}interrupt(){this.cancelPanningDuringDrag(),this.cancelMiddlePress(),super.interrupt()}cancel(){this.interrupt()}hasDragIntent(e){return e.hasIntent(hs.KEYBOARD_DRAG)||e.hasIntent(hs.DRAG)}panToNode(e,t,i){assert&&assert(this._panBounds.isFinite(),"panBounds should be defined when panning."),this.keepBoundsInView(e.globalBounds,t,i)}keepBoundsInView(e,t,i){assert&&assert(this._panBounds.isFinite(),"panBounds should be defined when panning.");const s=this.sourcePosition;assert&&assert(s,"sourcePosition must be defined to handle keepBoundsInView, be sure to call initializePositions");const n=this._targetNode.globalToLocalBounds(e),o=new Pe(0,0);let c=0,p=0,f=0,w=0;if(t)c=this._transformedPanBounds.centerX-n.centerX,p=this._transformedPanBounds.centerX-n.centerX,f=this._transformedPanBounds.centerY-n.centerY,w=this._transformedPanBounds.centerY-n.centerY;else if((i==="vertical"||n.width<this._transformedPanBounds.width)&&(i==="horizontal"||n.height<this._transformedPanBounds.height)){const z=150/this.getCurrentScale();c=this._transformedPanBounds.left-n.left+z,p=this._transformedPanBounds.right-n.right-z,f=this._transformedPanBounds.top-n.top+z,w=this._transformedPanBounds.bottom-n.bottom-z}i!=="vertical"&&(p<0&&(o.x=-p),c>0&&(o.x=-c)),i!=="horizontal"&&(w<0&&(o.y=-w),f>0&&(o.y=-f)),this.setDestinationPosition(s.plus(o))}keepTrailInView(e,t){if(this._panBounds.isFinite()&&e.lastNode().bounds.isFinite()){const i=e.localToGlobalBounds(e.lastNode().localBounds);this._panBounds.containsBounds(i)||this.keepBoundsInView(i,!0,t)}}animateToTargets(e){assert&&assert(this.boundsFinite,"initializePositions must be called at least once before animating");const t=this.sourcePosition;assert&&assert(t,"sourcePosition must be defined to animate, be sure to all initializePositions"),assert&&assert(t.isFinite(),"How can the source position not be a finite Vector2?");const i=this.destinationPosition;assert&&assert(i,"destinationPosition must be defined to animate, be sure to all initializePositions"),assert&&assert(i.isFinite(),"How can the destination position not be a finite Vector2?");const s=!i.equalsEpsilon(t,.1),n=!ct.equalsEpsilon(this.sourceScale,this.destinationScale,.001);if(this.animatingProperty.value=s||n,this._presses.length===0||this.middlePress!==null){if(s){const o=i.minus(t);let c=o;o.magnitude!==0&&(c=o.normalized());const p=this.getTranslationSpeed(o.magnitude);Wp.setXY(p,p);const f=Wp.multiplyScalar(e),w=c.componentTimes(f);w.magnitude>o.magnitude&&w.set(o),assert&&assert(w.isFinite(),"Trying to translate with a non-finite Vector2"),this.translateDelta(w)}if(n){assert&&assert(this.scaleGestureTargetPosition,"there must be a scale target point");const o=this.destinationScale-this.sourceScale;let c=o*e*6;Math.abs(c)>Math.abs(o)&&(c=o),this.translateScaleToTarget(this.scaleGestureTargetPosition,c),this.setDestinationPosition(t)}else this.destinationScale!==this.sourceScale&&(assert&&assert(this.scaleGestureTargetPosition,"there must be a scale target point"),this.setTranslationScaleToTarget(this.scaleGestureTargetPosition,this.destinationScale),this.setDestinationPosition(t))}}stopInProgressAnimation(){this.boundsFinite&&this.sourcePosition&&(this.setDestinationScale(this.sourceScale),this.setDestinationPosition(this.sourcePosition))}initializePositions(){this.boundsFinite=this._transformedPanBounds.isFinite(),this.boundsFinite?(this.sourcePosition=this._transformedPanBounds.center,this.setDestinationPosition(this.sourcePosition)):(this.sourcePosition=null,this.destinationPosition=null)}setPanBounds(e){super.setPanBounds(e),this.initializePositions(),this._dragBounds=e.erodedXY(e.width*.1,e.height*.1),assert&&assert(this._dragBounds.hasNonzeroArea(),"drag bounds must have some width and height")}setTargetBounds(e){super.setTargetBounds(e),this.initializePositions()}setDestinationPosition(e){assert&&assert(this.boundsFinite,"bounds must be finite before setting destination positions"),assert&&assert(e.isFinite(),"provided destination position is not defined");const t=this.sourcePosition;assert&&assert(t,"sourcePosition must be defined to set destination position, be sure to call initializePositions"),Up.setMinMax(t.x-this._transformedPanBounds.left-this._panBounds.left,t.y-this._transformedPanBounds.top-this._panBounds.top,t.x+this._panBounds.right-this._transformedPanBounds.right,t.y+this._panBounds.bottom-this._transformedPanBounds.bottom),this.destinationPosition=Up.closestPointTo(e)}setDestinationScale(e){this.destinationScale=this.limitScale(e)}getTranslationSpeed(e){assert&&assert(e>=0,"distance for getTranslationSpeed should be a non-negative number");const t=e*this.getCurrentScale(),i=5,s=t*(1/(Math.pow(t,2)-Math.pow(i,2))+i);return Math.min(Math.abs(s),u0*this.getCurrentScale())}resetTransform(){super.resetTransform(),this.stopInProgressAnimation()}getNextDiscreteScale(e){const t=this.getCurrentScale();let i=null,s=Number.POSITIVE_INFINITY;for(let o=0;o<this.discreteScales.length;o++){const c=Math.abs(this.discreteScales[o]-t);c<s&&(s=c,i=o)}i=i,assert&&assert(i!==null,"nearestIndex should have been found");let n=e?i+1:i-1;return n=ct.clamp(n,0,this.discreteScales.length-1),this.discreteScales[n]}dispose(){this.disposeAnimatedPanZoomListener()}}class Yc{constructor(e,t,i,s){const n=st()({translationMagnitude:80},s);let o=0;o+=e.isKeyDown(Se.KEY_RIGHT_ARROW)?1:0,o-=e.isKeyDown(Se.KEY_LEFT_ARROW)?1:0;let c=0;if(c+=e.isKeyDown(Se.KEY_DOWN_ARROW)?1:0,c-=e.isKeyDown(Se.KEY_UP_ARROW)?1:0,$o.setXY(o,c),!$o.equals(Pe.ZERO)){const p=n.translationMagnitude*i;$o.setMagnitude(p)}this.translationVector=$o,this.scale=t}computeScaleTargetFromKeyPress(){Do.setXY(0,0);const e=mi.pdomFocusProperty.value;if(e){const t=e.trail,i=t.lastNode();i.bounds.isFinite()&&Do.set(t.parentToGlobalPoint(i.center))}else{const t=Dt.getNextFocusable();if(t!==document.body){assert&&assert(document.body.contains(t),"focusable should be attached to the body");const i=t.offsetLeft+t.offsetWidth/2,s=t.offsetTop+t.offsetHeight/2;Do.setXY(i,s)}}return assert&&assert(Do.isFinite(),"target position not defined"),Do}}class d0{constructor(e,t){const i=e.domEvent;assert&&assert(i instanceof WheelEvent,"SceneryEvent should have a DOMEvent from the wheel input"),this.isCtrlKeyDown=i.ctrlKey,this.scaleDelta=i.deltaY>0?-.5:.5,this.targetPoint=e.pointer.point;let s=i.deltaX*.5,n=i.deltaY*.5;i.deltaMode===self.WheelEvent.DOM_DELTA_LINE&&(s=s*25,n=n*25),i.shiftKey&&([s,n]=[n,-s]),this.translationVector=$o.setXY(s*t,n*t)}}class g0{constructor(e,t){assert&&assert(e.type==="mouse","incorrect pointer type"),this.pointer=e,this.trail=t,this.initialPoint=e.point.copy()}}const p0=(h,e)=>{assert&&assert(h>=1,"min scales less than one are currently not supported");const t=8,i=[];for(let n=0;n<t;n++)i[n]=(e-h)/t*(n*n);const s=i[t-1];for(let n=0;n<i.length;n++)i[n]=h+i[n]*(e-h)/s;return i};te.register("AnimatedPanZoomListener",ry);class f0{constructor(){this._listener=null}initialize(e,t){this._listener=new ry(e,t)}dispose(){assert&&assert(this._listener,"No listener, call initialize first."),this._listener.dispose(),this._listener=null}get listener(){return assert&&assert(this._listener,"No listener, call initialize first."),this._listener}get initialized(){return!!this._listener}}const ay=new f0;te.register("animatedPanZoomSingleton",ay);const Yp=ay;class m0{down(e){e.handle()}}te.register("HandleDownlistener",m0);class Pd extends Il{constructor(e){const t=st()({fire:_.noop,press:_.noop,release:_.noop,focus:_.noop,blur:_.noop,fireOnDown:!0,fireOnHold:!1,fireOnHoldTiming:"browser",fireOnHoldCustomDelay:400,fireOnHoldCustomInterval:100,allowOverlap:!1,override:!0,ignoredModifierKeys:[],phetioEnabledPropertyInstrumented:!1},e);super(t),this._fire=t.fire,this._press=t.press,this._release=t.release,this._focus=t.focus,this._blur=t.blur,this.fireOnDown=t.fireOnDown,this.fireOnHold=t.fireOnHold,this.fireOnHoldTiming=t.fireOnHoldTiming,this.fireOnHoldCustomDelay=t.fireOnHoldCustomDelay,this.fireOnHoldCustomInterval=t.fireOnHoldCustomInterval,this.allowOverlap=t.allowOverlap,this.ignoredModifierKeys=t.ignoredModifierKeys,this.override=t.override,this.hotkeys=this.createHotkeys(t.keys),this.isPressedProperty=Si.or(this.hotkeys.map(i=>i.isPressedProperty)),this.pressedKeysProperty=new wi([]),this.interrupted=!1,this.enabledPropertyListener=this.onEnabledPropertyChange.bind(this),this.enabledProperty.lazyLink(this.enabledPropertyListener)}get isPressed(){return this.isPressedProperty.value}onEnabledPropertyChange(e){!e&&this.interrupt()}dispose(){this.hotkeys.forEach(e=>e.dispose()),this.isPressedProperty.dispose(),this.pressedKeysProperty.dispose(),this.enabledProperty.unlink(this.enabledPropertyListener),super.dispose()}keydown(e){e.pointer.reserveForKeyboardDrag()}focusout(e){this.interrupt(),this._blur(this)}focusin(e){this._focus(this)}cancel(){this.handleInterrupt()}interrupt(){this.handleInterrupt()}handleInterrupt(){this.hotkeys.forEach(e=>e.interrupt())}createSyntheticEvent(e){const t=It.createSynthetic();return new Ms(new wt,"synthetic",e,t)}createHotkeys(e){return e.map(t=>{const i=t.split("+"),s=i.slice(0,i.length-1),n=i[i.length-1],o=new Zm({key:n,modifierKeys:s,ignoredModifierKeys:this.ignoredModifierKeys,fire:c=>{this._fire(c,t,this)},press:c=>{this.interrupted=!1,this._press(c,t,this),assert&&assert(!this.pressedKeysProperty.value.includes(t),"Key already pressed"),this.pressedKeysProperty.value=[...this.pressedKeysProperty.value,t]},release:c=>{this.interrupted=o.interrupted,this._release(c,t,this),assert&&assert(this.pressedKeysProperty.value.includes(t),"Key not pressed"),this.pressedKeysProperty.value=this.pressedKeysProperty.value.filter(p=>p!==t)},fireOnDown:this.fireOnDown,fireOnHold:this.fireOnHold,fireOnHoldTiming:this.fireOnHoldTiming,fireOnHoldCustomDelay:this.fireOnHoldTiming==="custom"?this.fireOnHoldCustomDelay:void 0,fireOnHoldCustomInterval:this.fireOnHoldTiming==="custom"?this.fireOnHoldCustomInterval:void 0,allowOverlap:this.allowOverlap,enabledProperty:this.enabledProperty,override:this.override});return o})}static createGlobal(e,t){return new y0(e,t)}}class y0 extends Pd{constructor(e,t){const i=new ud(e,{followPDOMOrder:!0,requirePDOMVisible:!0,requireEnabled:!0,requireInputEnabled:!0}),s=new Si([i],o=>o.length>0),n=st()({enabledProperty:s},t);super(n),this.displayedTrailsProperty=i,this.globallyEnabledProperty=s,this.hotkeys.forEach(o=>{Ru.add(o)})}dispose(){this.hotkeys.forEach(e=>{Ru.remove(e)}),this.globallyEnabledProperty.dispose(),this.displayedTrailsProperty.dispose(),super.dispose()}}te.register("KeyboardListener",Pd);const b0=["arrowLeft","arrowRight","arrowUp","arrowDown","w","a","s","d"],_0=["arrowLeft","arrowRight","a","d"],v0=["arrowUp","arrowDown","w","s"],L0=new Map([["both",b0],["leftRight",_0],["upDown",v0]]);class oy extends Pd{constructor(e){assert&&us(e,["dragSpeed","shiftDragSpeed"],["dragDelta","shiftDragDelta"]),assert&&us(e,["dragSpeed"],["moveOnHoldDelay","moveOnHoldInterval"]),assert&&us(e,["mapPosition"],["dragBoundsProperty"]),assert&&assert(!e||!e.dragBoundsProperty||e.positionProperty||e.translateNode,"If you provide a dragBoundsProperty, you must provide either a positionProperty or use translateNode.");const t=st()({dragDelta:10,shiftDragDelta:5,dragSpeed:0,shiftDragSpeed:0,keyboardDragDirection:"both",positionProperty:null,transform:null,dragBoundsProperty:null,mapPosition:null,translateNode:!1,start:null,drag:null,end:null,moveOnHoldDelay:500,moveOnHoldInterval:400,tandem:ai.REQUIRED,phetioReadOnly:!0},e);assert&&assert(t.shiftDragSpeed<=t.dragSpeed,"shiftDragSpeed should be less than or equal to shiftDragSpeed, it is intended to provide more fine-grained control"),assert&&assert(t.shiftDragDelta<=t.dragDelta,"shiftDragDelta should be less than or equal to dragDelta, it is intended to provide more fine-grained control");const i=L0.get(t.keyboardDragDirection);assert&&assert(i,"Invalid keyboardDragDirection");const s=st()({keys:i,ignoredModifierKeys:["shift"]},t);if(super(s),this.leftKeyDownProperty=new Nt(!1),this.rightKeyDownProperty=new Nt(!1),this.upKeyDownProperty=new Nt(!1),this.downKeyDownProperty=new Nt(!1),this.startNextKeyboardEvent=!1,this.restartTimerNextKeyboardEvent=!1,this.modelDelta=new Pe(0,0),this.modelPoint=new Pe(0,0),this.vectorDelta=new Pe(0,0),this.pressedKeysProperty.link(n=>{this.leftKeyDownProperty.value=n.includes("arrowLeft")||n.includes("a"),this.rightKeyDownProperty.value=n.includes("arrowRight")||n.includes("d"),this.upKeyDownProperty.value=n.includes("arrowUp")||n.includes("w"),this.downKeyDownProperty.value=n.includes("arrowDown")||n.includes("s")}),this._start=t.start,this._drag=t.drag,this._end=t.end,this._dragBoundsProperty=t.dragBoundsProperty||new wi(null),this._mapPosition=t.mapPosition,this._translateNode=t.translateNode,this._transform=t.transform,this._positionProperty=t.positionProperty,this._dragSpeed=t.dragSpeed,this._shiftDragSpeed=t.shiftDragSpeed,this._dragDelta=t.dragDelta,this._shiftDragDelta=t.shiftDragDelta,this._moveOnHoldDelay=t.moveOnHoldDelay,this.useDragSpeed=t.dragSpeed>0||t.shiftDragSpeed>0,this.dragStartAction=new qt(n=>{this._start&&this._start(n,this),this.useDragSpeed&&Wi.addListener(this.boundStepListener)},{parameters:[{name:"event",phetioType:Ms.SceneryEventIO}],tandem:t.tandem.createTandem("dragStartAction"),phetioDocumentation:"Emits whenever a keyboard drag starts.",phetioReadOnly:t.phetioReadOnly,phetioEventType:si.USER}),this.dragAction=new qt(()=>{if(assert&&assert(this.isPressedProperty.value,"The listener should not be dragging if not pressed"),t.transform){const n=t.transform instanceof Ks?t.transform:t.transform.value;this.modelDelta=n.inverseDelta2(this.vectorDelta)}else this.modelDelta=this.vectorDelta;if(this._translateNode){let n=this.getCurrentTarget().translation.plus(this.vectorDelta);n=this.mapModelPoint(n),this.getCurrentTarget().translation=n,this.modelPoint=this.parentToModelPoint(n)}if(this._positionProperty){let n=this._positionProperty.value.plus(this.modelDelta);n=this.mapModelPoint(n),this.modelPoint=n,n.equals(this._positionProperty.value)||(this._positionProperty.value=n)}if(this._drag){assert&&assert(this._pointer,"the pointer must be assigned at the start of a drag action");const n=this.createSyntheticEvent(this._pointer);this._drag(n,this)}},{parameters:[],tandem:t.tandem.createTandem("dragAction"),phetioDocumentation:"Emits every time there is some input from a keyboard drag.",phetioHighFrequency:!0,phetioReadOnly:t.phetioReadOnly,phetioEventType:si.USER}),this.dragEndAction=new qt(()=>{this.useDragSpeed?Wi.removeListener(this.boundStepListener):this.callbackTimer.stop(!1);const n=this._pointer?this.createSyntheticEvent(this._pointer):null;this._end&&this._end(n,this),this.clearPointer()},{parameters:[],tandem:t.tandem.createTandem("dragEndAction"),phetioDocumentation:"Emits whenever a keyboard drag ends.",phetioReadOnly:t.phetioReadOnly,phetioEventType:si.USER}),this._pointerListener={listener:this,interrupt:this.interrupt.bind(this)},this._pointer=null,this.callbackTimer=new Rh({callback:()=>{const o=Hs.shiftKeyDown?t.shiftDragDelta:t.dragDelta;this.moveFromDelta(o)},delay:t.moveOnHoldDelay,interval:t.moveOnHoldInterval}),this.boundStepListener=this.stepForSpeed.bind(this),this.isPressedProperty.lazyLink(n=>{n?this.startNextKeyboardEvent=!0:(this.startNextKeyboardEvent=!1,this.restartTimerNextKeyboardEvent=!1,this.isDragging()&&this.dragEndAction.execute())}),!this.useDragSpeed){const n=o=>{o.link(c=>{c&&(this.restartTimerNextKeyboardEvent=!0)})};n(this.leftKeyDownProperty),n(this.rightKeyDownProperty),n(this.upKeyDownProperty),n(this.downKeyDownProperty)}this._disposeKeyboardDragListener=()=>{this.leftKeyDownProperty.dispose(),this.rightKeyDownProperty.dispose(),this.upKeyDownProperty.dispose(),this.downKeyDownProperty.dispose(),this.callbackTimer.dispose(),Wi.hasListener(this.boundStepListener)&&Wi.removeListener(this.boundStepListener)}}stepForSpeed(e){assert&&assert(this.useDragSpeed,"This method should only be called when using dragSpeed");const t=Hs.shiftKeyDown,i=e*(t?this.shiftDragSpeed:this.dragSpeed);this.moveFromDelta(i)}moveFromDelta(e){let t=0,i=0;this.leftKeyDownProperty.value&&(t-=e),this.rightKeyDownProperty.value&&(t+=e),this.upKeyDownProperty.value&&(i-=e),this.downKeyDownProperty.value&&(i+=e);const s=new Pe(t,i);s.equals(Pe.ZERO)||(this.vectorDelta=s,this.dragAction.execute())}parentToModelPoint(e){return this.transform?(this.transform instanceof Ks?this.transform:this.transform.value).inverseDelta2(e):e}localToParentPoint(e){return this.getCurrentTarget().localToParentPoint(e)}getDragBounds(){return this._dragBoundsProperty.value}get dragBounds(){return this.getDragBounds()}setTransform(e){this._transform=e}set transform(e){this.setTransform(e)}get transform(){return this.getTransform()}getTransform(){return this._transform}get dragSpeed(){return this._dragSpeed}set dragSpeed(e){this._dragSpeed=e}get shiftDragSpeed(){return this._shiftDragSpeed}set shiftDragSpeed(e){this._shiftDragSpeed=e}get dragDelta(){return this._dragDelta}set dragDelta(e){this._dragDelta=e}get shiftDragDelta(){return this._shiftDragDelta}set shiftDragDelta(e){this._shiftDragDelta=e}movingLeft(){return this.leftKeyDownProperty.value&&!this.rightKeyDownProperty.value}movingRight(){return this.rightKeyDownProperty.value&&!this.leftKeyDownProperty.value}movingUp(){return this.upKeyDownProperty.value&&!this.downKeyDownProperty.value}movingDown(){return this.downKeyDownProperty.value&&!this.upKeyDownProperty.value}getCurrentTarget(){return assert&&assert(this.isPressedProperty.value,"We have no currentTarget if we are not pressed"),assert&&assert(this._pointer&&this._pointer.trail,"Must have a Pointer with an active trail if we are pressed"),this._pointer.trail.lastNode()}isDragging(){return!!this._pointer&&this._pointer.attachedListener===this._pointerListener}keydown(e){super.keydown(e);const t=e.domEvent;if(!t.metaKey&&Se.isMovementKey(t)){if(Ui.safari&&this.pressedKeysProperty.value.length>1){this.interrupt();return}t.preventDefault(),this.startNextKeyboardEvent&&!e.pointer.isAttached()&&(assert&&assert(this._pointer===null,"Pointer should be null at the start of a drag action"),this._pointer=e.pointer,e.pointer.addInputListener(this._pointerListener,!0),this.dragStartAction.execute(e),this.startNextKeyboardEvent=!1),this.restartTimerNextKeyboardEvent&&this.isDragging()&&(this.callbackTimer.stop(!1),this.callbackTimer.start(),this._moveOnHoldDelay>0&&this.callbackTimer.fire(),this.restartTimerNextKeyboardEvent=!1)}}mapModelPoint(e){return this._mapPosition?this._mapPosition(e):this._dragBoundsProperty.value?this._dragBoundsProperty.value.closestPointTo(e):e}clearPointer(){this._pointer&&(assert&&assert(this._pointer.listeners.includes(this._pointerListener),"A reference to the Pointer means it should have the pointerListener"),this._pointer.removeInputListener(this._pointerListener),this._pointer=null)}dispose(){this.interrupt(),this._disposeKeyboardDragListener(),super.dispose()}}te.register("KeyboardDragListener",oy);const Kp=oy,P0=ns(h=>(assert&&assert(_.includes(Xs(h),Yn),"Only PressListener subtypes should mix SpriteListenable"),class extends h{constructor(...e){super(...e),this.spriteInstance=null}press(e,t,i){if(this.isPressed)return!1;if(this.spriteInstance=null,e.currentTarget instanceof yd){const s=e.currentTarget;this.spriteInstance=s.getSpriteInstanceFromPoint(s.globalToLocalPoint(e.pointer.point))}return this.spriteInstance?super.press(e,t,i):!1}}));te.register("SpriteListenable",P0);const S0=.75,qp=.6;class w0{constructor(e){this._pointer=null,this.downPoint=null,this.downEvent=null,this.enabled=!1,this.lastPoint=null,this.currentPoint=null,this.velocity=null,this.swipeDistance=null,this.firstUp=!1,this.timeSinceLastDown=0,this.downPointers=[],this.holdingTime=0,this.focusedNode=null,this.handleEventListener={down:t=>{t.handle(),t.abort(),this.handleDown(t)}},e.pointerAddedEmitter.addListener(t=>{this.enabled&&t.addInputListener(this.handleEventListener,!0)}),this._attachedPointerListener={up:t=>{this.focusedNode&&this.focusedNode.swipeEnd&&this.focusedNode.swipeEnd.bind(this.focusedNode)(t,this),this.focusedNode=null,this._pointer.removeInputListener(this._attachedPointerListener),this._pointer=null},move:t=>{this.focusedNode&&this.focusedNode.swipeMove&&this.focusedNode.swipeMove.bind(this.focusedNode)(t,this)},interrupt:t=>{this.focusedNode=null,this._pointer.removeInputListener(this._attachedPointerListener),this._pointer=null},cancel:t=>{this.focusedNode=null,this._pointer.removeInputListener(this._attachedPointerListener),this._pointer=null}},this._pointerListener={up:t=>{this.endSwipe(),this._pointer=null,this.swipeDistance=t.pointer.point.minus(this.downPoint);const i=this.swipeDistance.y,s=this.swipeDistance.x;if(Math.abs(s)>100&&Math.abs(i)<100)if(s>0){if(mi.pdomFocusedNode&&mi.pdomFocusedNode.innerContent==="Reset All")return;Dt.getNextFocusable(document.body).focus()}else Dt.getPreviousFocusable(document.body).focus();else if(this.firstUp){if(this.timeSinceLastDown<qp){this.firstUp=!1,this.timeSinceLastDown=0;const n=document.getElementsByClassName("a11y-pdom-root")[0];n&&n.contains(t.activeElement)&&t.activeElement.click()}}else this.firstUp=!0},move:t=>{this.lastPoint=this.currentPoint,this.currentPoint=t.pointer.point},interrupt:()=>{this.interrupt()},cancel:()=>{this.interrupt()}},Wi.addListener(this.step.bind(this))}handleDown(e){e.pointer.addIntent(hs.DRAG),this.downPointers.push(e.pointer),this.downPointers.length>1&&(this.downPointers.forEach(t=>t.removeIntent(hs.DRAG)),e.pointer.removeIntent(hs.DRAG)),assert&&assert(e.pointer.attachedProperty.get(),"should be attached to the handle listener"),e.pointer.removeInputListener(this.handleEventListener),this._pointer===null&&e.pointer.type==="touch"&&(this._pointer=e.pointer,e.pointer.addInputListener(this._pointerListener,!0),e.abort(),this.downEvent=e,this.downPoint=e.pointer.point,this.currentPoint=this.downPoint.copy(),this.previousPoint=this.currentPoint.copy())}up(e){const t=this.downPointers.indexOf(e.pointer);t>-1&&this.downPointers.splice(t,1)}step(e){if(this.firstUp&&(this.timeSinceLastDown+=e,this.timeSinceLastDown>qp&&(this.firstUp=!1,this.timeSinceLastDown=0)),this._pointer&&!this._pointer.listeners.includes(this._attachedPointerListener))if(this.holdingTime>S0){const t=mi.pdomFocusedNode;t&&(this._pointer.removeInputListener(this._pointerListener),this.holdingTime=0,this.focusedNode=t,this._pointer.addInputListener(this._attachedPointerListener,!0),this.focusedNode.swipeStart&&this.focusedNode.swipeStart(this.downEvent,this),this.downEvent=null)}else this.holdingTime+=e;this.lastPoint!==null&&this.currentPoint!==null&&(this.velocity=this.lastPoint.minus(this.currentPoint).dividedScalar(e))}endSwipe(){this.holdingTime=0,this._pointer&&this._pointer.listeners.includes(this._pointerListener)&&this._pointer.removeInputListener(this._pointerListener)}detachPointerListener(){this._pointer.detach(this._attachedPointerListener)}interrupt(){this.endSwipe(),this._pointer=null,this.downEvent=null}}te.register("SwipeListener",w0);const Fu=["left","right","center","origin"],Hu=["top","bottom","center","origin"],Ws=class Ws extends Ur{constructor(e,t,i=Number.POSITIVE_INFINITY){super(),this.horizontal=e,this.vertical=t,this.padRatio=i}static getAllowedAligns(e){return[...e===_t.HORIZONTAL?Fu:Hu,null]}static alignToInternal(e,t){return e===_t.HORIZONTAL?Ws.horizontalAlignToInternal(t):Ws.verticalAlignToInternal(t)}static horizontalAlignToInternal(e){return e===null?null:(assert&&assert(Xp[e]),Xp[e])}static verticalAlignToInternal(e){return e===null?null:(assert&&assert(jp[e]),jp[e])}static internalToAlign(e,t){return t===null?null:e===_t.HORIZONTAL?t.horizontal:t.vertical}};Ws.START=new Ws("left","top",0),Ws.END=new Ws("right","bottom",1),Ws.CENTER=new Ws("center","center",.5),Ws.ORIGIN=new Ws("origin","origin"),Ws.enumeration=new Yr(Ws,{phetioDocumentation:"Alignment for layout containers"});let vi=Ws;const Xp={left:vi.START,right:vi.END,center:vi.CENTER,origin:vi.ORIGIN},jp={top:vi.START,bottom:vi.END,center:vi.CENTER,origin:vi.ORIGIN};te.register("LayoutAlign",vi);const C0=["left","right","center","spaceBetween","spaceAround","spaceEvenly"],T0=["top","bottom","center","spaceBetween","spaceAround","spaceEvenly"],Is=class Is extends Ur{constructor(e,t,i){super(),this.spacingFunctionFactory=e,this.horizontal=t,this.vertical=i}static getAllowedJustificationValues(e){return e===_t.HORIZONTAL?C0:T0}static justifyToInternal(e,t){return e===_t.HORIZONTAL?(assert&&assert(Qp[t]),Qp[t]):(assert&&assert(Zp[t]),Zp[t])}static internalToJustify(e,t){return e===_t.HORIZONTAL?t.horizontal:t.vertical}};Is.START=new Is(()=>()=>0,"left","top"),Is.END=new Is(e=>t=>t===0?e:0,"right","bottom"),Is.CENTER=new Is(e=>t=>t===0?e/2:0,"center","center"),Is.SPACE_BETWEEN=new Is((e,t)=>i=>i!==0?e/(t-1):0,"spaceBetween","spaceBetween"),Is.SPACE_AROUND=new Is((e,t)=>i=>(i!==0?2:1)*e/(2*t),"spaceAround","spaceAround"),Is.SPACE_EVENLY=new Is((e,t)=>i=>e/(t+1),"spaceEvenly","spaceEvenly"),Is.enumeration=new Yr(Is,{phetioDocumentation:"Justify for layout containers"});let Di=Is;const Qp={left:Di.START,right:Di.END,center:Di.CENTER,spaceBetween:Di.SPACE_BETWEEN,spaceAround:Di.SPACE_AROUND,spaceEvenly:Di.SPACE_EVENLY},Zp={top:Di.START,bottom:Di.END,center:Di.CENTER,spaceBetween:Di.SPACE_BETWEEN,spaceAround:Di.SPACE_AROUND,spaceEvenly:Di.SPACE_EVENLY};te.register("LayoutJustification",Di);const x0={stretch:!0,isSeparator:!0};class Sd extends hr{constructor(e){super(or()({},{layoutOptions:x0,stroke:"rgb(100,100,100)"},e))}}te.register("Separator",Sd);class ly extends fd(Sd){constructor(e){super(),this.localPreferredHeightProperty.link(t=>{t!==null&&(this.y2=t)}),this.mutate(e)}}te.register("VSeparator",ly);class hy extends zh(Sd){constructor(e){super(),this.localPreferredWidthProperty.link(t=>{t!==null&&(this.x2=t)}),this.mutate(e)}}te.register("HSeparator",hy);const al=class al{constructor(e){this.initialize(e)}initialize(e){return this.trail=e,this}checkPreconditions(){assert&&assert(this.trail,"Should not be disposed"),assert&&assert(this.trail.getParentMatrix().isAxisAligned(),"Transforms with LayoutProxy need to be axis-aligned")}get node(){return assert&&this.checkPreconditions(),this.trail.lastNode()}get bounds(){return assert&&this.checkPreconditions(),this.trail.parentToGlobalBounds(this.node.bounds)}get visibleBounds(){return assert&&this.checkPreconditions(),this.trail.parentToGlobalBounds(this.node.visibleBounds)}get width(){return this.bounds.width}get height(){return this.bounds.height}get x(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformX(this.node.x)}set x(e){assert&&this.checkPreconditions(),this.node.x=this.trail.getParentTransform().inverseX(e)}get y(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformY(this.node.y)}set y(e){assert&&this.checkPreconditions(),this.node.y=this.trail.getParentTransform().inverseY(e)}get translation(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.translation)}set translation(e){assert&&this.checkPreconditions(),this.node.translation=this.trail.getParentTransform().inversePosition2(e)}get left(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformX(this.node.left)}set left(e){this.node.left=this.trail.getParentTransform().inverseX(e)}get right(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformX(this.node.right)}set right(e){assert&&this.checkPreconditions(),this.node.right=this.trail.getParentTransform().inverseX(e)}get centerX(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformX(this.node.centerX)}set centerX(e){assert&&this.checkPreconditions(),this.node.centerX=this.trail.getParentTransform().inverseX(e)}get top(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformY(this.node.top)}set top(e){assert&&this.checkPreconditions(),this.node.top=this.trail.getParentTransform().inverseY(e)}get bottom(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformY(this.node.bottom)}set bottom(e){assert&&this.checkPreconditions(),this.node.bottom=this.trail.getParentTransform().inverseY(e)}get centerY(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformY(this.node.centerY)}set centerY(e){assert&&this.checkPreconditions(),this.node.centerY=this.trail.getParentTransform().inverseY(e)}get leftTop(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.leftTop)}set leftTop(e){assert&&this.checkPreconditions(),this.node.leftTop=this.trail.getParentTransform().inversePosition2(e)}get centerTop(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.centerTop)}set centerTop(e){assert&&this.checkPreconditions(),this.node.centerTop=this.trail.getParentTransform().inversePosition2(e)}get rightTop(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.rightTop)}set rightTop(e){assert&&this.checkPreconditions(),this.node.rightTop=this.trail.getParentTransform().inversePosition2(e)}get leftCenter(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.leftCenter)}set leftCenter(e){assert&&this.checkPreconditions(),this.node.leftCenter=this.trail.getParentTransform().inversePosition2(e)}get center(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.center)}set center(e){assert&&this.checkPreconditions(),this.node.center=this.trail.getParentTransform().inversePosition2(e)}get rightCenter(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.rightCenter)}set rightCenter(e){assert&&this.checkPreconditions(),this.node.rightCenter=this.trail.getParentTransform().inversePosition2(e)}get leftBottom(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.leftBottom)}set leftBottom(e){assert&&this.checkPreconditions(),this.node.leftBottom=this.trail.getParentTransform().inversePosition2(e)}get centerBottom(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.centerBottom)}set centerBottom(e){assert&&this.checkPreconditions(),this.node.centerBottom=this.trail.getParentTransform().inversePosition2(e)}get rightBottom(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.rightBottom)}set rightBottom(e){assert&&this.checkPreconditions(),this.node.rightBottom=this.trail.getParentTransform().inversePosition2(e)}get widthSizable(){return this.node.widthSizable}get heightSizable(){return this.node.heightSizable}get preferredWidth(){assert&&this.checkPreconditions(),assert&&assert(Wa(this.node));const e=this.node.preferredWidth;return e===null?null:Math.abs(this.trail.getParentTransform().transformDeltaX(e))}set preferredWidth(e){assert&&this.checkPreconditions(),assert&&assert(Wa(this.node)),this.node.preferredWidth=e===null?null:Math.abs(this.trail.getParentTransform().inverseDeltaX(e))}get preferredHeight(){assert&&this.checkPreconditions(),assert&&assert(Ua(this.node));const e=this.node.preferredHeight;return e===null?null:Math.abs(this.trail.getParentTransform().transformDeltaY(e))}set preferredHeight(e){assert&&this.checkPreconditions(),assert&&assert(Ua(this.node)),this.node.preferredHeight=e===null?null:Math.abs(this.trail.getParentTransform().inverseDeltaY(e))}get minimumWidth(){assert&&this.checkPreconditions();const e=Wa(this.node)?this.node.minimumWidth||0:this.node.width;return Math.abs(this.trail.getParentTransform().transformDeltaX(e))}get minimumHeight(){assert&&this.checkPreconditions();const e=Ua(this.node)?this.node.minimumHeight||0:this.node.height;return Math.abs(this.trail.getParentTransform().transformDeltaY(e))}getMinimum(e){return e===_t.HORIZONTAL?this.minimumWidth:this.minimumHeight}get maxWidth(){return assert&&this.checkPreconditions(),this.node.maxWidth===null?null:Math.abs(this.trail.getParentTransform().transformDeltaX(this.node.maxWidth))}set maxWidth(e){assert&&this.checkPreconditions(),this.node.maxWidth=e===null?null:Math.abs(this.trail.getParentTransform().inverseDeltaX(e))}get maxHeight(){return assert&&this.checkPreconditions(),this.node.maxHeight===null?null:Math.abs(this.trail.getParentTransform().transformDeltaY(this.node.maxHeight))}set maxHeight(e){assert&&this.checkPreconditions(),this.node.maxHeight=e===null?null:Math.abs(this.trail.getParentTransform().inverseDeltaY(e))}getMax(e){return e===_t.HORIZONTAL?this.maxWidth:this.maxHeight}get visible(){return this.node.visible}set visible(e){this.node.visible=e}dispose(){this.trail=null,this.freeToPool()}freeToPool(){al.pool.freeToPool(this)}};al.pool=new qi(al,{maxSize:1e3});let Cl=al;te.register("LayoutProxy",Cl);class cy extends Df{constructor(e,t,i){const s=new Tm(e,t);super([s],o=>o.length===1?Cl.pool.create(o[0].copy().removeAncestor()):null),this.transformTracker=null,this.trailsBetweenProperty=s,this.lazyLink((o,c)=>{c&&c.dispose()});const n=i==null?void 0:i.onTransformChange;n&&this.link(o=>{this.transformTracker&&(this.transformTracker.dispose(),this.transformTracker=null),o&&(this.transformTracker=new pa(o.trail.copy().addAncestor(e)),this.transformTracker.addListener(n))})}dispose(){this.trailsBetweenProperty.dispose(),this.transformTracker&&this.transformTracker.dispose(),super.dispose()}}te.register("LayoutProxyProperty",cy);class Al{constructor(e){this._layoutLockCount=0,this._layoutAttemptDuringLock=!1,this._enabled=!0,this._listenedNodes=new Set,this.finishedLayoutEmitter=new ri,this.ancestorNode=e,this._updateLayoutListener=this.updateLayoutAutomatically.bind(this)}addNode(e,t=!0){assert&&assert(!this._listenedNodes.has(e)),assert&&assert(!t||!e._activeParentLayoutConstraint,"This node is already managed by a layout container - make sure to wrap it in a Node if DAG, removing it from an old layout container, etc."),t&&(e._activeParentLayoutConstraint=this),e.boundsProperty.lazyLink(this._updateLayoutListener),e.visibleProperty.lazyLink(this._updateLayoutListener),cp(e)&&(e.minimumWidthProperty.lazyLink(this._updateLayoutListener),e.isWidthResizableProperty.lazyLink(this._updateLayoutListener)),up(e)&&(e.minimumHeightProperty.lazyLink(this._updateLayoutListener),e.isHeightResizableProperty.lazyLink(this._updateLayoutListener)),this._listenedNodes.add(e)}removeNode(e){assert&&assert(this._listenedNodes.has(e)),e._activeParentLayoutConstraint===this&&(e._activeParentLayoutConstraint=null),e.boundsProperty.unlink(this._updateLayoutListener),e.visibleProperty.unlink(this._updateLayoutListener),cp(e)&&(e.minimumWidthProperty.unlink(this._updateLayoutListener),e.isWidthResizableProperty.unlink(this._updateLayoutListener)),up(e)&&(e.minimumHeightProperty.unlink(this._updateLayoutListener),e.isHeightResizableProperty.unlink(this._updateLayoutListener)),this._listenedNodes.delete(e)}layout(){}get isLocked(){return this._layoutLockCount>0}lock(){this._layoutLockCount++}unlock(){this._layoutLockCount--}validateLocalPreferredWidth(e){assert&&e.localBounds.isFinite()&&!this._layoutAttemptDuringLock&&e.validateLocalPreferredWidth()}validateLocalPreferredHeight(e){assert&&e.localBounds.isFinite()&&!this._layoutAttemptDuringLock&&e.validateLocalPreferredHeight()}validateLocalPreferredSize(e){assert&&e.localBounds.isFinite()&&!this._layoutAttemptDuringLock&&e.validateLocalPreferredSize()}updateLayout(){let e=0;if(this.isLocked)assert&&e++,assert&&assert(++e<500,"Likely infinite loop detected, are we triggering layout within the layout?"),this._layoutAttemptDuringLock=!0;else{this.lock();do this._layoutAttemptDuringLock=!1,this.layout();while(this._layoutAttemptDuringLock);this.unlock()}}updateLayoutAutomatically(){this._enabled&&this.updateLayout()}createLayoutProxy(e){const t=e.getTrails(i=>i===this.ancestorNode);return t.length===1?Cl.pool.create(t[0].removeAncestor()):null}get enabled(){return this._enabled}set enabled(e){this._enabled!==e&&(this._enabled=e,this.updateLayoutAutomatically())}dispose(){const e=[...this._listenedNodes.keys()];for(let t=0;t<e.length;t++)this.removeNode(e[t]);this.finishedLayoutEmitter.dispose()}}te.register("LayoutConstraint",Al);class Kh{constructor(e,t,i){i?(this.layoutProxyProperty=null,this._proxy=i):(this._proxy=null,this.layoutProxyProperty=new cy(e.ancestorNode,t,{onTransformChange:()=>e.updateLayoutAutomatically()}),this.layoutProxyProperty.link(s=>{this._proxy=s,e.updateLayoutAutomatically()})),this._constraint=e,this._node=t,this.layoutOptionsListener=this.onLayoutOptionsChange.bind(this),this.node.layoutOptionsChangedEmitter.addListener(this.layoutOptionsListener)}onLayoutOptionsChange(){}get node(){return this._node}isConnected(){return this._proxy!==null}get proxy(){return assert&&assert(this._proxy),this._proxy}isSizable(e){return e===_t.HORIZONTAL?this.proxy.widthSizable:this.proxy.heightSizable}dispose(){this.layoutProxyProperty&&this.layoutProxyProperty.dispose(),this.node.layoutOptionsChangedEmitter.removeListener(this.layoutOptionsListener)}}te.register("LayoutCell",Kh);class El extends Kh{constructor(e,t,i){super(e,t,i),this.preferredSizeSet=new oa(!1,!1),this.lastAvailableBounds=$e.NOTHING.copy(),this.lastUsedBounds=$e.NOTHING.copy(),this._marginConstraint=e}reposition(e,t,i,s,n,o){const c=s&&this.isSizable(e)?t:this.getMinimumSize(e);if(assert){const f=e===_t.HORIZONTAL?this.node.maxWidth:this.node.maxHeight;assert(!this.isSizable(e)||f===null||Math.abs(f-c)>-1e-9,`Tried to set a preferred size ${c} larger than the specified max${e===_t.HORIZONTAL?"Width":"Height"} of ${f}. Ideally, try to avoid putting a maxWidth/maxHeight on a width/height-sizable Node (one that will resize to fit its preferred size) inside a layout container, particularly one that will try to expand the Node past its maximum size.`)}this.attemptPreferredSize(e,c),o===vi.ORIGIN?this.positionOrigin(e,i+n):this.positionStart(e,i+(t-this.getCellBounds()[e.size])*o.padRatio);const p=this.getCellBounds();return assert&&assert(p.isFinite()),this.lastAvailableBounds[e.minCoordinate]=i,this.lastAvailableBounds[e.maxCoordinate]=i+t,this.lastUsedBounds.set(p),p}get effectiveLeftMargin(){return this._leftMargin!==null?this._leftMargin:this._marginConstraint._leftMargin}get effectiveRightMargin(){return this._rightMargin!==null?this._rightMargin:this._marginConstraint._rightMargin}get effectiveTopMargin(){return this._topMargin!==null?this._topMargin:this._marginConstraint._topMargin}get effectiveBottomMargin(){return this._bottomMargin!==null?this._bottomMargin:this._marginConstraint._bottomMargin}getEffectiveMinMargin(e){return e===_t.HORIZONTAL?this.effectiveLeftMargin:this.effectiveTopMargin}getEffectiveMaxMargin(e){return e===_t.HORIZONTAL?this.effectiveRightMargin:this.effectiveBottomMargin}get effectiveMinContentWidth(){return this._minContentWidth!==null?this._minContentWidth:this._marginConstraint._minContentWidth}get effectiveMinContentHeight(){return this._minContentHeight!==null?this._minContentHeight:this._marginConstraint._minContentHeight}getEffectiveMinContent(e){return e===_t.HORIZONTAL?this.effectiveMinContentWidth:this.effectiveMinContentHeight}get effectiveMaxContentWidth(){return this._maxContentWidth!==null?this._maxContentWidth:this._marginConstraint._maxContentWidth}get effectiveMaxContentHeight(){return this._maxContentHeight!==null?this._maxContentHeight:this._marginConstraint._maxContentHeight}getEffectiveMaxContent(e){return e===_t.HORIZONTAL?this.effectiveMaxContentWidth:this.effectiveMaxContentHeight}getMinimumSize(e){return this.getEffectiveMinMargin(e)+Math.max(this.proxy.getMinimum(e),this.getEffectiveMinContent(e)||0)+this.getEffectiveMaxMargin(e)}getMaximumSize(e){return this.getEffectiveMinMargin(e)+(this.getEffectiveMaxContent(e)||Number.POSITIVE_INFINITY)+this.getEffectiveMaxMargin(e)}attemptPreferredSize(e,t){if(this.proxy[e.sizable]){const i=this.getMinimumSize(e),s=this.getMaximumSize(e);assert&&assert(isFinite(i)),assert&&assert(s>=i),t=ct.clamp(t,i,s);let n=t-this.getEffectiveMinMargin(e)-this.getEffectiveMaxMargin(e);const o=this.proxy.getMax(e);o!==null&&(n=Math.min(o,n)),this._marginConstraint.setProxyPreferredSize(e,this.proxy,n),this.preferredSizeSet.set(e,!0)}}unsetPreferredSize(e){this.proxy[e.sizable]&&this._marginConstraint.setProxyPreferredSize(e,this.proxy,null)}positionStart(e,t){const i=this.getEffectiveMinMargin(e)+t;this._marginConstraint.setProxyMinSide(e,this.proxy,i)}positionOrigin(e,t){this._marginConstraint.setProxyOrigin(e,this.proxy,t)}getOriginBounds(){return this.getCellBounds().shiftedXY(-this.proxy.x,-this.proxy.y)}getCellBounds(){return this.proxy.bounds.withOffsets(this.effectiveLeftMargin,this.effectiveTopMargin,this.effectiveRightMargin,this.effectiveBottomMargin)}dispose(){_t.enumeration.values.forEach(e=>{this.preferredSizeSet.get(e)&&this.unsetPreferredSize(e)}),super.dispose()}static createHelperNode(e,t,i){const s=new tt,n=.4,o=kt.union(e.map(z=>kt.bounds(z.lastAvailableBounds))),c=kt.union(e.map(z=>kt.bounds(z.lastUsedBounds))),p=kt.union(e.map(z=>kt.bounds(z.proxy.bounds))),f=kt.bounds(t).shapeDifference(o),w=o.shapeDifference(c),O=c.shapeDifference(p),T=(z,U,m)=>{const Y=new gs(z,{font:new ss({size:6,family:"monospace"}),fill:U}),j=$i.bounds(Y.bounds,{fill:m,children:[Y]});return new ym(j,4,Math.floor(j.left),Math.ceil(j.top+1),Math.floor(j.width),Math.floor(j.height-2),Ze.rotation2(-Math.PI/4))};return s.addChild(new Fi(f,{fill:T("spacing","#000","#fff"),opacity:.6})),s.addChild(new Fi(w,{fill:T("empty","#aaa","#000"),opacity:.6})),s.addChild(new Fi(O,{fill:T("margin","#600","#f00"),opacity:.6})),s.addChild($i.bounds(t,{stroke:"white",lineDash:[2,2],lineDashOffset:2,lineWidth:n})),s.addChild($i.bounds(t,{stroke:"black",lineDash:[2,2],lineWidth:n})),e.forEach(z=>{s.addChild($i.bounds(z.getCellBounds(),{stroke:"rgba(0,255,0,1)",lineWidth:n}))}),e.forEach(z=>{s.addChild($i.bounds(z.proxy.bounds,{stroke:"rgba(255,0,0,1)",lineWidth:n}))}),e.forEach(z=>{const U=z.getCellBounds(),m=new Yn({tandem:ai.OPT_OUT});s.addChild($i.bounds(U,{inputListeners:[m]}));let Y=i(z);z.effectiveLeftMargin&&(Y+=`leftMargin: ${z.effectiveLeftMargin}
`),z.effectiveRightMargin&&(Y+=`rightMargin: ${z.effectiveRightMargin}
`),z.effectiveTopMargin&&(Y+=`topMargin: ${z.effectiveTopMargin}
`),z.effectiveBottomMargin&&(Y+=`bottomMargin: ${z.effectiveBottomMargin}
`),z.effectiveMinContentWidth&&(Y+=`minContentWidth: ${z.effectiveMinContentWidth}
`),z.effectiveMinContentHeight&&(Y+=`minContentHeight: ${z.effectiveMinContentHeight}
`),z.effectiveMaxContentWidth&&(Y+=`maxContentWidth: ${z.effectiveMaxContentWidth}
`),z.effectiveMaxContentHeight&&(Y+=`maxContentHeight: ${z.effectiveMaxContentHeight}
`),Y+=`layoutOptions: ${JSON.stringify(z.node.layoutOptions,null,2).replace(/ /g,"&nbsp;")}
`;const j=new ur(Y.trim().replace(/\n/g,"<br>"),{font:new ss({size:12})}),le=$i.bounds(j.bounds.dilated(3),{fill:"rgba(255,255,255,0.8)",children:[j],leftTop:U.leftTop});s.addChild(le),m.isOverProperty.link(xe=>{le.visible=xe})}),s}}te.register("MarginLayoutCell",El);const uy=["resize","layoutOrigin"];class wd extends $h(tt){constructor(e){super(e),this.layoutOriginProperty=new Pb(Pe.ZERO)}linkLayoutBounds(){this._constraint.layoutBoundsProperty.link(e=>{this.localBounds=e})}setExcludeInvisibleChildrenFromBounds(e){super.setExcludeInvisibleChildrenFromBounds(e),this._constraint.excludeInvisible=e}setChildren(e){if(this.constraint.isLocked)return super.setChildren(e);const t=this.getChildren();return this.constraint.lock(),super.setChildren(e),this.constraint.unlock(),_.isEqual(t,e)||this.constraint.updateLayoutAutomatically(),this}updateLayout(){this._constraint.updateLayout()}get resize(){return this._constraint.enabled}set resize(e){this._constraint.enabled=e}get layoutOrigin(){return this.layoutOriginProperty.value}set layoutOrigin(e){this.layoutOriginProperty.value=e}get constraint(){return this._constraint}dispose(){this._constraint.dispose(),super.dispose()}}te.register("LayoutNode",wd);class Cd{initializeLayoutLine(){this.min=0,this.max=Number.POSITIVE_INFINITY,this.minOrigin=Number.POSITIVE_INFINITY,this.maxOrigin=Number.NEGATIVE_INFINITY,this.size=0,this.position=0}hasOrigin(){return isFinite(this.minOrigin)&&isFinite(this.maxOrigin)}}te.register("LayoutLine",Cd);const Jp=1e-9;class Td extends Al{constructor(e,t){const i=st()({preferredWidthProperty:new Nt(null),preferredHeightProperty:new Nt(null),minimumWidthProperty:new Nt(null),minimumHeightProperty:new Nt(null),layoutOriginProperty:new Nt(Pe.ZERO)},t);super(e),this._excludeInvisible=!0,this.layoutBoundsProperty=new wi($e.NOTHING,{valueComparisonStrategy:"equalsFunction"}),this.preferredWidthProperty=i.preferredWidthProperty,this.preferredHeightProperty=i.preferredHeightProperty,this.minimumWidthProperty=i.minimumWidthProperty,this.minimumHeightProperty=i.minimumHeightProperty,this.layoutOriginProperty=i.layoutOriginProperty,this.preferredWidthProperty.lazyLink(this._updateLayoutListener),this.preferredHeightProperty.lazyLink(this._updateLayoutListener),this.layoutOriginProperty.lazyLink(this._updateLayoutListener)}filterLayoutCells(e){return assert&&assert(_.every(e,t=>!t.node.isDisposed),"A cell's node should not be disposed when layout happens"),e.filter(t=>t.isConnected()&&t.proxy.bounds.isValid()&&(!this.excludeInvisible||t.node.visible))}get excludeInvisible(){return this._excludeInvisible}set excludeInvisible(e){this._excludeInvisible!==e&&(this._excludeInvisible=e,this.updateLayoutAutomatically())}setProxyPreferredSize(e,t,i){t[e.preferredSize]=i}setProxyMinSide(e,t,i){Math.abs(t[e.minSide]-i)>Jp&&(t[e.minSide]=i)}setProxyOrigin(e,t,i){Math.abs(t[e.coordinate]-i)>Jp&&(t[e.coordinate]=i)}dispose(){this.preferredWidthProperty.unlink(this._updateLayoutListener),this.preferredHeightProperty.unlink(this._updateLayoutListener),this.layoutOriginProperty.unlink(this._updateLayoutListener),super.dispose()}}te.register("NodeLayoutConstraint",Td);const dy=["margin","xMargin","yMargin","leftMargin","rightMargin","topMargin","bottomMargin","minContentWidth","minContentHeight","maxContentWidth","maxContentHeight"],xd=ns(h=>class extends h{constructor(...t){super(...t),this._leftMargin=null,this._rightMargin=null,this._topMargin=null,this._bottomMargin=null,this._minContentWidth=null,this._minContentHeight=null,this._maxContentWidth=null,this._maxContentHeight=null,this.changedEmitter=new ri}mutateConfigurable(t){us(t,["margin"],["xMargin","yMargin"]),us(t,["xMargin"],["leftMargin","rightMargin"]),us(t,["yMargin"],["topMargin","bottomMargin"])}setConfigToBaseDefault(){this._leftMargin=0,this._rightMargin=0,this._topMargin=0,this._bottomMargin=0,this._minContentWidth=null,this._minContentHeight=null,this._maxContentWidth=null,this._maxContentHeight=null,this.changedEmitter.emit()}setConfigToInherit(t){(!t||t.leftMargin===void 0)&&(this._leftMargin=null),(!t||t.rightMargin===void 0)&&(this._rightMargin=null),(!t||t.topMargin===void 0)&&(this._topMargin=null),(!t||t.bottomMargin===void 0)&&(this._bottomMargin=null),(!t||t.minContentWidth===void 0)&&(this._minContentWidth=null),(!t||t.minContentHeight===void 0)&&(this._minContentHeight=null),(!t||t.maxContentWidth===void 0)&&(this._maxContentWidth=null),(!t||t.maxContentHeight===void 0)&&(this._maxContentHeight=null),this.changedEmitter.emit()}get leftMargin(){return this._leftMargin}set leftMargin(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)),this._leftMargin!==t&&(this._leftMargin=t,this.changedEmitter.emit())}get rightMargin(){return this._rightMargin}set rightMargin(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)),this._rightMargin!==t&&(this._rightMargin=t,this.changedEmitter.emit())}get topMargin(){return this._topMargin}set topMargin(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)),this._topMargin!==t&&(this._topMargin=t,this.changedEmitter.emit())}get bottomMargin(){return this._bottomMargin}set bottomMargin(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)),this._bottomMargin!==t&&(this._bottomMargin=t,this.changedEmitter.emit())}get xMargin(){return assert&&assert(this._leftMargin===this._rightMargin),this._leftMargin}set xMargin(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)),(this._leftMargin!==t||this._rightMargin!==t)&&(this._leftMargin=t,this._rightMargin=t,this.changedEmitter.emit())}get yMargin(){return assert&&assert(this._topMargin===this._bottomMargin),this._topMargin}set yMargin(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)),(this._topMargin!==t||this._bottomMargin!==t)&&(this._topMargin=t,this._bottomMargin=t,this.changedEmitter.emit())}get margin(){return assert&&assert(this._leftMargin===this._rightMargin&&this._leftMargin===this._topMargin&&this._leftMargin===this._bottomMargin),this._topMargin}set margin(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)),(this._leftMargin!==t||this._rightMargin!==t||this._topMargin!==t||this._bottomMargin!==t)&&(this._leftMargin=t,this._rightMargin=t,this._topMargin=t,this._bottomMargin=t,this.changedEmitter.emit())}get minContentWidth(){return this._minContentWidth}set minContentWidth(t){this._minContentWidth!==t&&(this._minContentWidth=t,this.changedEmitter.emit())}get minContentHeight(){return this._minContentHeight}set minContentHeight(t){this._minContentHeight!==t&&(this._minContentHeight=t,this.changedEmitter.emit())}get maxContentWidth(){return this._maxContentWidth}set maxContentWidth(t){this._maxContentWidth!==t&&(this._maxContentWidth=t,this.changedEmitter.emit())}get maxContentHeight(){return this._maxContentHeight}set maxContentHeight(t){this._maxContentHeight!==t&&(this._maxContentHeight=t,this.changedEmitter.emit())}});te.register("MarginLayoutConfigurable",xd);const Id=["orientation","align","stretch","grow"].concat(dy),Dd=ns(h=>class extends xd(h){constructor(...t){super(...t),this._orientation=_t.HORIZONTAL,this._align=null,this._stretch=null,this._grow=null,this.orientationChangedEmitter=new ri}mutateConfigurable(t){super.mutateConfigurable(t),xl(this,Id,t)}setConfigToBaseDefault(){this._align=vi.CENTER,this._stretch=!1,this._grow=0,super.setConfigToBaseDefault()}setConfigToInherit(t){(!t||t.align===void 0)&&(this._align=null),(!t||t.stretch===void 0)&&(this._stretch=null),(!t||t.grow===void 0)&&(this._grow=null),super.setConfigToInherit(t)}get orientation(){return this._orientation===_t.HORIZONTAL?"horizontal":"vertical"}set orientation(t){assert&&assert(t==="horizontal"||t==="vertical");const i=t==="horizontal"?_t.HORIZONTAL:_t.VERTICAL;this._orientation!==i&&(this._orientation=i,this.orientationChangedEmitter.emit(),this.changedEmitter.emit())}get align(){const t=vi.internalToAlign(this._orientation,this._align);return assert&&assert(t===null||typeof t=="string"),t}set align(t){assert&&assert(vi.getAllowedAligns(this._orientation.opposite).includes(t),`align ${t} not supported, with the orientation ${this._orientation}, the valid values are ${vi.getAllowedAligns(this._orientation.opposite)}`);const i=vi.alignToInternal(this._orientation.opposite,t);assert&&assert(i===null||i instanceof vi),this._align!==i&&(this._align=i,this.changedEmitter.emit())}get stretch(){return this._stretch}set stretch(t){this._stretch!==t&&(this._stretch=t,this.changedEmitter.emit())}get grow(){return this._grow}set grow(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)&&t>=0),this._grow!==t&&(this._grow=t,this.changedEmitter.emit())}});te.register("FlowConfigurable",Dd);const I0=[...Id,"isSeparator"];class gy extends Dd(El){constructor(e,t,i){super(e,t,i),this.size=0,this._isSeparator=!1,this.flowConstraint=e,this.orientation=e.orientation,this.onLayoutOptionsChange()}get effectiveAlign(){return this._align!==null?this._align:this.flowConstraint._align}get effectiveStretch(){return this._stretch!==null?this._stretch:this.flowConstraint._stretch}get effectiveGrow(){return this._grow!==null?this._grow:this.flowConstraint._grow}onLayoutOptionsChange(){this.node.layoutOptions&&this.setOptions(this.node.layoutOptions),super.onLayoutOptionsChange()}setOptions(e){const t=st()({isSeparator:!1},e);assert&&Object.keys(t).forEach(i=>{assert&&assert(I0.includes(i),`Cannot provide key ${i} to a FlowCell's layoutOptions. Perhaps this is a Grid-style layout option?`)}),this._isSeparator=t.isSeparator,this.setConfigToInherit(t),this.mutateConfigurable(t)}}te.register("FlowCell",gy);const ol=class ol extends Cd{constructor(e,t){super(),this.initialize(e,t)}initialize(e,t){return this.orientation=e,this.cells=t,this.initializeLayoutLine(),this}getMinimumSize(e){return(this.cells.length-1)*e+_.sum(this.cells.map(t=>t.getMinimumSize(this.orientation)))}freeToPool(){ol.pool.freeToPool(this)}clean(){this.cells.length=0,this.freeToPool()}};ol.pool=new qi(ol,{defaultArguments:[_t.HORIZONTAL,[]]});let Ka=ol;te.register("FlowLine",Ka);const py=[...Id,"spacing","lineSpacing","justify","justifyLines","wrap","excludeInvisible"];class qh extends Dd(Td){constructor(e,t){super(e,t),this.cells=[],this._justify=Di.SPACE_BETWEEN,this._justifyLines=null,this._wrap=!1,this._spacing=0,this._lineSpacing=0,this.displayedCells=[],this.setConfigToBaseDefault(),this.mutateConfigurable(t),xl(this,py,t),this.changedEmitter.addListener(this._updateLayoutListener),this.orientationChangedEmitter.addListener(()=>this.cells.forEach(i=>{i.orientation=this.orientation}))}updateSeparatorVisibility(){let e=0;for(;e<this.cells.length;e++){const i=this.cells[e];if(i._isSeparator)i.node.visible=!1;else if(i.node.visible&&i.node.boundsProperty.value.isValid())break}let t=!1;for(let i=this.cells.length-1;i>e;i--){const s=this.cells[i];s._isSeparator?(s.node.visible=t,t=!1):s.node.visible&&s.node.boundsProperty.value.isValid()&&(t=!0)}}layout(){super.layout();const e=this._orientation,t=this._orientation.opposite;this.updateSeparatorVisibility();const i=this.filterLayoutCells(this.cells);if(this.displayedCells=i,!i.length){this.layoutBoundsProperty.value=$e.NOTHING,this.minimumWidthProperty.value=null,this.minimumHeightProperty.value=null;return}let s=this.getPreferredProperty(e).value;const n=this.getPreferredProperty(t).value,o=Math.max(...i.map(me=>me.getMinimumSize(e)||0));o>(s||Number.POSITIVE_INFINITY)&&(s=o);const c=[];if(this.wrap){let me=[],Fe=s||Number.POSITIVE_INFINITY;for(;i.length;){const we=i.shift(),He=we.getMinimumSize(e);me.length===0?(me.push(we),Fe-=He):this.spacing+He<=Fe+1e-7?(me.push(we),Fe-=this.spacing+He):(c.push(Ka.pool.create(e,me)),Fe=s||Number.POSITIVE_INFINITY,me=[we],Fe-=He)}me.length&&c.push(Ka.pool.create(e,me))}else c.push(Ka.pool.create(e,i));c.forEach(me=>{me.cells.forEach(Fe=>{if(me.min=Math.max(me.min,Fe.getMinimumSize(t)),me.max=Math.min(me.max,Fe.getMaximumSize(t)),Fe.effectiveAlign===vi.ORIGIN){const we=Fe.getOriginBounds();me.minOrigin=Math.min(we[t.minCoordinate],me.minOrigin),me.maxOrigin=Math.max(we[t.maxCoordinate],me.maxOrigin)}}),isFinite(me.minOrigin)&&isFinite(me.maxOrigin)?me.size=Math.max(me.min,me.maxOrigin-me.minOrigin):me.size=me.min});const p=Math.max(...c.map(me=>me.getMinimumSize(this.spacing))),f=_.sum(c.map(me=>me.size))+(c.length-1)*this.lineSpacing,w=this.wrap?o:p,O=Math.max(p,s||0),T=Math.max(f,n||0),z=this.layoutOriginProperty.value[e.coordinate],U=this.layoutOriginProperty.value[e.opposite.coordinate];c.forEach(me=>{const Fe=_.sum(me.cells.map(Ee=>Ee.getMinimumSize(e))),we=this.spacing*(me.cells.length-1);let He=O-Fe-we;me.cells.forEach(Ee=>{Ee.size=Ee.getMinimumSize(e)});let Me;for(;He>1e-7&&(Me=me.cells.filter(Ee=>Ee.effectiveGrow!==0&&Ee.size<Ee.getMaximumSize(e)-1e-7)).length;){const Ee=_.sum(Me.map(Ie=>Ie.effectiveGrow)),rt=Math.min(Math.min(...Me.map(Ie=>(Ie.getMaximumSize(e)-Ie.size)/Ie.effectiveGrow)),He/Ee);assert&&assert(rt>1e-11),Me.forEach(Ie=>{Ie.size+=rt*Ie.effectiveGrow}),He-=rt*Ee}me.cells.forEach(Ee=>Ee.attemptPreferredSize(e,Ee.size));const ze=this._justify.spacingFunctionFactory(He,me.cells.length);let Je=z;me.cells.forEach((Ee,rt)=>{Je+=ze(rt),rt>0&&(Je+=this.spacing),Ee.positionStart(e,Je),Ee.lastAvailableBounds[e.minCoordinate]=Je,Ee.lastAvailableBounds[e.maxCoordinate]=Je+Ee.size,Je+=Ee.size,assert&&assert(this.spacing>=0||Ee.size>=-this.spacing-1e-7,"Negative spacing more than a cell's size causes issues with layout")})});const m=T-f,Y=(c[0].hasOrigin()?c[0].minOrigin:0)+U;let j=Y;if(this._justifyLines===null)c.forEach(me=>{me.size+=m/c.length}),c.forEach(me=>{me.position=j,j+=me.size+this.lineSpacing});else{const me=this._justifyLines.spacingFunctionFactory(m,c.length);c.forEach((Fe,we)=>{j+=me(we),Fe.position=j,j+=Fe.size+this.lineSpacing})}c.forEach(me=>me.cells.forEach(Fe=>{Fe.reposition(t,me.size,me.position,Fe.effectiveStretch,-me.minOrigin,Fe.effectiveAlign)}));const le=z,xe=z+O,ce=Y,ne=Y+T;this.layoutBoundsProperty.value=$e.oriented(e,le,ce,xe,ne),this.minimumWidthProperty.value=e===_t.HORIZONTAL?w:f,this.minimumHeightProperty.value=e===_t.HORIZONTAL?f:w,this.finishedLayoutEmitter.emit(),c.forEach(me=>me.clean())}get justify(){const e=Di.internalToJustify(this._orientation,this._justify);return assert&&assert(Di.getAllowedJustificationValues(this._orientation).includes(e)),e}set justify(e){assert&&assert(Di.getAllowedJustificationValues(this._orientation).includes(e),`justify ${e} not supported, with the orientation ${this._orientation}, the valid values are ${Di.getAllowedJustificationValues(this._orientation)}`);const t=Di.justifyToInternal(this._orientation,e);this._justify!==t&&(this._justify=t,this.updateLayoutAutomatically())}get justifyLines(){if(this._justifyLines===null)return null;{const e=Di.internalToJustify(this._orientation,this._justifyLines);return assert&&assert(Di.getAllowedJustificationValues(this._orientation).includes(e)),e}}set justifyLines(e){assert&&assert(e===null||Di.getAllowedJustificationValues(this._orientation.opposite).includes(e),`justify ${e} not supported, with the orientation ${this._orientation.opposite}, the valid values are ${Di.getAllowedJustificationValues(this._orientation.opposite)} or null`);const t=e===null?null:Di.justifyToInternal(this._orientation.opposite,e);assert&&assert(t===null||t instanceof Di),this._justifyLines!==t&&(this._justifyLines=t,this.updateLayoutAutomatically())}get wrap(){return this._wrap}set wrap(e){this._wrap!==e&&(this._wrap=e,this.updateLayoutAutomatically())}get spacing(){return this._spacing}set spacing(e){assert&&assert(isFinite(e)),this._spacing!==e&&(this._spacing=e,this.updateLayoutAutomatically())}get lineSpacing(){return this._lineSpacing}set lineSpacing(e){assert&&assert(isFinite(e)),this._lineSpacing!==e&&(this._lineSpacing=e,this.updateLayoutAutomatically())}insertCell(e,t){assert&&assert(e>=0),assert&&assert(e<=this.cells.length),assert&&assert(!_.includes(this.cells,t)),t.orientation=this.orientation,this.cells.splice(e,0,t),this.addNode(t.node),t.changedEmitter.addListener(this._updateLayoutListener),this.updateLayoutAutomatically()}removeCell(e){assert&&assert(_.includes(this.cells,e)),is(this.cells,e),this.removeNode(e.node),e.changedEmitter.removeListener(this._updateLayoutListener),this.updateLayoutAutomatically()}reorderCells(e,t,i){this.cells.splice(t,i-t+1,...e),this.updateLayoutAutomatically()}getPreferredProperty(e){return e===_t.HORIZONTAL?this.preferredWidthProperty:this.preferredHeightProperty}dispose(){this.lock(),this.cells.forEach(e=>this.removeCell(e)),this.displayedCells=[],super.dispose(),this.unlock()}static create(e,t){return new qh(e,t)}}te.register("FlowConstraint",qh);const D0=[...uy,...py.filter(h=>h!=="excludeInvisible")],Ao={orientation:"horizontal",spacing:0,align:"center",stretch:!1},gg=class gg extends wd{constructor(e){const t=st()({excludeInvisibleChildrenFromBounds:!0,resize:!0,disabledOpacity:Er.DISABLED_OPACITY},e);super(),this._cellMap=new Map,this._constraint=new qh(this,{preferredWidthProperty:this.localPreferredWidthProperty,preferredHeightProperty:this.localPreferredHeightProperty,minimumWidthProperty:this.localMinimumWidthProperty,minimumHeightProperty:this.localMinimumHeightProperty,layoutOriginProperty:this.layoutOriginProperty,orientation:Ao.orientation,spacing:Ao.spacing,align:Ao.align,stretch:Ao.stretch,excludeInvisible:!1}),this.onChildInserted=this.onFlowBoxChildInserted.bind(this),this.onChildRemoved=this.onFlowBoxChildRemoved.bind(this),this.onChildrenReordered=this.onFlowBoxChildrenReordered.bind(this),this.onChildrenChanged=this.onFlowBoxChildrenChanged.bind(this),this.childInsertedEmitter.addListener(this.onChildInserted),this.childRemovedEmitter.addListener(this.onChildRemoved),this.childrenReorderedEmitter.addListener(this.onChildrenReordered),this.childrenChangedEmitter.addListener(this.onChildrenChanged);const i=_.omit(t,lr),s=_.pick(t,lr);this._constraint.lock(),this.mutate(i),this._constraint.unlock(),this._constraint.updateLayout(),this.mutate(s),this.linkLayoutBounds()}onFlowBoxChildInserted(e,t){const i=new gy(this._constraint,e,this._constraint.createLayoutProxy(e));this._cellMap.set(e,i),this._constraint.insertCell(t,i)}onFlowBoxChildRemoved(e){const t=this._cellMap.get(e);assert&&assert(t),this._cellMap.delete(e),this._constraint.removeCell(t),t.dispose()}onFlowBoxChildrenReordered(e,t){this._constraint.reorderCells(this._children.slice(e,t+1).map(i=>this._cellMap.get(i)),e,t)}onFlowBoxChildrenChanged(){this._constraint.updateLayoutAutomatically()}getCell(e){const t=this._cellMap.get(e);return assert&&assert(t),t}get orientation(){return this._constraint.orientation}set orientation(e){this._constraint.orientation=e}get spacing(){return this._constraint.spacing}set spacing(e){this._constraint.spacing=e}get lineSpacing(){return this._constraint.lineSpacing}set lineSpacing(e){this._constraint.lineSpacing=e}get justify(){return this._constraint.justify}set justify(e){this._constraint.justify=e}get justifyLines(){return this._constraint.justifyLines}set justifyLines(e){this._constraint.justifyLines=e}get wrap(){return this._constraint.wrap}set wrap(e){this._constraint.wrap=e}get align(){return assert&&assert(typeof this._constraint.align=="string"),this._constraint.align}set align(e){this._constraint.align=e}get stretch(){return assert&&assert(typeof this._constraint.stretch=="boolean"),this._constraint.stretch}set stretch(e){this._constraint.stretch=e}get grow(){return this._constraint.grow}set grow(e){this._constraint.grow=e}get margin(){return this._constraint.margin}set margin(e){this._constraint.margin=e}get xMargin(){return this._constraint.xMargin}set xMargin(e){this._constraint.xMargin=e}get yMargin(){return this._constraint.yMargin}set yMargin(e){this._constraint.yMargin=e}get leftMargin(){return this._constraint.leftMargin}set leftMargin(e){this._constraint.leftMargin=e}get rightMargin(){return this._constraint.rightMargin}set rightMargin(e){this._constraint.rightMargin=e}get topMargin(){return this._constraint.topMargin}set topMargin(e){this._constraint.topMargin=e}get bottomMargin(){return this._constraint.bottomMargin}set bottomMargin(e){this._constraint.bottomMargin=e}get minContentWidth(){return this._constraint.minContentWidth}set minContentWidth(e){this._constraint.minContentWidth=e}get minContentHeight(){return this._constraint.minContentHeight}set minContentHeight(e){this._constraint.minContentHeight=e}get maxContentWidth(){return this._constraint.maxContentWidth}set maxContentWidth(e){this._constraint.maxContentWidth=e}get maxContentHeight(){return this._constraint.maxContentHeight}set maxContentHeight(e){this._constraint.maxContentHeight=e}dispose(){this._constraint.lock(),this.childInsertedEmitter.removeListener(this.onChildInserted),this.childRemovedEmitter.removeListener(this.onChildRemoved),this.childrenReorderedEmitter.removeListener(this.onChildrenReordered),this.childrenChangedEmitter.removeListener(this.onChildrenChanged);for(const e of this._cellMap.values())e.dispose();super.dispose()}setOrientation(e){return this.orientation=e,this}getOrientation(){return this.orientation}setSpacing(e){return this.spacing=e,this}getSpacing(){return this.spacing}setAlign(e){return this.align=e,this}getAlign(){return this.align}setResize(e){return this.resize=e,this}isResize(){return this.resize}getHelperNode(){return El.createHelperNode(this.constraint.displayedCells,this.constraint.layoutBoundsProperty.value,t=>{let i="";const s=_t.fromLayoutOrientation(t.orientation);return i+=`align: ${vi.internalToAlign(s,t.effectiveAlign)}
`,i+=`stretch: ${t.effectiveStretch}
`,i+=`grow: ${t.effectiveGrow}
`,i})}mutate(e){return super.mutate(e)}};gg.DEFAULT_FLOW_BOX_OPTIONS=Ao;let ro=gg;ro.prototype._mutatorKeys=[...Cm,...D0,...tt.prototype._mutatorKeys];te.register("FlowBox",ro);const Ad=["xAlign","yAlign","stretch","xStretch","yStretch","grow","xGrow","yGrow"].concat(dy),Ed=ns(h=>class extends xd(h){constructor(...t){super(...t),this._xAlign=null,this._yAlign=null,this._xStretch=null,this._yStretch=null,this._xGrow=null,this._yGrow=null}mutateConfigurable(t){super.mutateConfigurable(t),us(t,["stretch"],["xStretch","yStretch"]),us(t,["grow"],["xGrow","yGrow"]),xl(this,Ad,t)}setConfigToBaseDefault(){this._xAlign=vi.CENTER,this._yAlign=vi.CENTER,this._xStretch=!1,this._yStretch=!1,this._xGrow=0,this._yGrow=0,super.setConfigToBaseDefault()}setConfigToInherit(t){(!t||t.xAlign===void 0)&&(this._xAlign=null),(!t||t.yAlign===void 0)&&(this._yAlign=null),(!t||t.stretch===void 0&&t.xStretch===void 0)&&(this._xStretch=null),(!t||t.stretch===void 0&&t.yStretch===void 0)&&(this._yStretch=null),(!t||t.grow===void 0&&t.xGrow===void 0)&&(this._xGrow=null),(!t||t.grow===void 0&&t.yGrow===void 0)&&(this._yGrow=null),super.setConfigToInherit(t)}get xAlign(){const t=this._xAlign===null?null:this._xAlign.horizontal;return assert&&assert(t===null||typeof t=="string"),t}set xAlign(t){assert&&assert(t===null||Fu.includes(t),`align ${t} not supported, the valid values are ${Fu} or null`);const i=vi.horizontalAlignToInternal(t);assert&&assert(i===null||i instanceof vi),this._xAlign!==i&&(this._xAlign=i,this.changedEmitter.emit())}get yAlign(){const t=this._yAlign===null?null:this._yAlign.vertical;return assert&&assert(t===null||typeof t=="string"),t}set yAlign(t){assert&&assert(t===null||Hu.includes(t),`align ${t} not supported, the valid values are ${Hu} or null`);const i=vi.verticalAlignToInternal(t);assert&&assert(i===null||i instanceof vi),this._yAlign!==i&&(this._yAlign=i,this.changedEmitter.emit())}get grow(){return assert&&assert(this._xGrow===this._yGrow),this._xGrow}set grow(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)&&t>=0),(this._xGrow!==t||this._yGrow!==t)&&(this._xGrow=t,this._yGrow=t,this.changedEmitter.emit())}get xGrow(){return this._xGrow}set xGrow(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)&&t>=0),this._xGrow!==t&&(this._xGrow=t,this.changedEmitter.emit())}get yGrow(){return this._yGrow}set yGrow(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)&&t>=0),this._yGrow!==t&&(this._yGrow=t,this.changedEmitter.emit())}get stretch(){return assert&&assert(this._xStretch===this._yStretch),this._xStretch}set stretch(t){assert&&assert(t===null||typeof t=="boolean"),(this._xStretch!==t||this._yStretch!==t)&&(this._xStretch=t,this._yStretch=t,this.changedEmitter.emit())}get xStretch(){return this._xStretch}set xStretch(t){assert&&assert(t===null||typeof t=="boolean"),this._xStretch!==t&&(this._xStretch=t,this.changedEmitter.emit())}get yStretch(){return this._yStretch}set yStretch(t){assert&&assert(t===null||typeof t=="boolean"),this._yStretch!==t&&(this._yStretch=t,this.changedEmitter.emit())}});te.register("GridConfigurable",Ed);const A0=[...Ad,"row","column","horizontalSpan","verticalSpan"];class fy extends Ed(El){constructor(e,t,i){super(e,t,i),this.gridConstraint=e,this.setOptions(t.layoutOptions),this.onLayoutOptionsChange()}get effectiveXAlign(){return this._xAlign!==null?this._xAlign:this.gridConstraint._xAlign}get effectiveYAlign(){return this._yAlign!==null?this._yAlign:this.gridConstraint._yAlign}getEffectiveAlign(e){return e===_t.HORIZONTAL?this.effectiveXAlign:this.effectiveYAlign}get effectiveXGrow(){return this._xGrow!==null?this._xGrow:this.gridConstraint._xGrow}get effectiveYGrow(){return this._yGrow!==null?this._yGrow:this.gridConstraint._yGrow}getEffectiveGrow(e){return e===_t.HORIZONTAL?this.effectiveXGrow:this.effectiveYGrow}get effectiveXStretch(){return this._xStretch!==null?this._xStretch:this.gridConstraint._xStretch}get effectiveYStretch(){return this._yStretch!==null?this._yStretch:this.gridConstraint._yStretch}getEffectiveStretch(e){return e===_t.HORIZONTAL?this.effectiveXStretch:this.effectiveYStretch}onLayoutOptionsChange(){this.setOptions(this.node.layoutOptions),super.onLayoutOptionsChange()}setOptions(e){const t=st()({column:0,row:0,horizontalSpan:1,verticalSpan:1},e);assert&&Object.keys(t).forEach(i=>{assert&&assert(A0.includes(i),`Cannot provide key ${i} to a GridCell's layoutOptions. Perhaps this is a Flow-style layout option?`)}),assert&&assert(typeof t.column=="number"&&Number.isInteger(t.column)&&isFinite(t.column)&&t.column>=0),assert&&assert(typeof t.row=="number"&&Number.isInteger(t.row)&&isFinite(t.row)&&t.row>=0),assert&&assert(typeof t.horizontalSpan=="number"&&Number.isInteger(t.horizontalSpan)&&isFinite(t.horizontalSpan)&&t.horizontalSpan>=1),assert&&assert(typeof t.verticalSpan=="number"&&Number.isInteger(t.verticalSpan)&&isFinite(t.verticalSpan)&&t.verticalSpan>=1),this.setConfigToInherit(t),this.position=new oa(t.column,t.row),this.size=new oa(t.horizontalSpan,t.verticalSpan),this.mutateConfigurable(t)}containsIndex(e,t){const i=this.position.get(e),s=this.size.get(e);return t>=i&&t<i+s}containsRow(e){return this.containsIndex(_t.VERTICAL,e)}containsColumn(e){return this.containsIndex(_t.HORIZONTAL,e)}getIndices(e){const t=this.position.get(e),i=this.size.get(e);return _.range(t,t+i)}}te.register("GridCell",fy);const ll=class ll extends Cd{constructor(e,t,i){super(),this.initialize(e,t,i)}initialize(e,t,i){return this.index=e,this.cells=t,this.grow=i,this.initializeLayoutLine(),this}freeToPool(){ll.pool.freeToPool(this)}clean(){this.cells.length=0,this.freeToPool()}};ll.pool=new qi(ll,{defaultArguments:[0,[],0]});let vh=ll;te.register("GridLine",vh);const my=[...Ad,"excludeInvisible","spacing","xSpacing","ySpacing"];class Xh extends Ed(Td){constructor(e,t){super(e,t),this.cells=new Set,this.displayedCells=[],this.displayedLines=new oa(new Map,new Map),this._spacing=new oa(0,0),this.setConfigToBaseDefault(),this.mutateConfigurable(t),xl(this,my,t),this.changedEmitter.addListener(this._updateLayoutListener)}layout(){super.layout();const e=this.filterLayoutCells([...this.cells]);if(this.displayedCells=e,!e.length){this.layoutBoundsProperty.value=$e.NOTHING,this.minimumWidthProperty.value=null,this.minimumHeightProperty.value=null,this.displayedLines.forEach(n=>n.clear());return}const t=new oa(0,0),i=new oa(this.preferredWidthProperty.value,this.preferredHeightProperty.value),s=new $e(0,0,0,0);[_t.HORIZONTAL,_t.VERTICAL].forEach(n=>{const o=this._spacing.get(n),c=this.displayedLines.get(n);c.forEach(Y=>Y.clean()),c.clear();const f=_.sortedUniq(_.sortBy(_.flatten(e.map(Y=>Y.getIndices(n))))).map(Y=>{const j=_.filter(e,ce=>ce.containsIndex(n,Y)),le=Math.max(...j.map(ce=>ce.getEffectiveGrow(n))),xe=vh.pool.create(Y,j,le);return c.set(Y,xe),xe}),w=f.slice(0,-1).map(Y=>typeof o=="number"?o:o[Y.index]);e.forEach(Y=>{if(Y.size.get(n)===1){const j=c.get(Y.position.get(n));if(j.min=Math.max(j.min,Y.getMinimumSize(n)),j.max=Math.min(j.max,Y.getMaximumSize(n)),Y.getEffectiveAlign(n)===vi.ORIGIN){const le=Y.getOriginBounds();j.minOrigin=Math.min(le[n.minCoordinate],j.minOrigin),j.maxOrigin=Math.max(le[n.maxCoordinate],j.maxOrigin)}}}),e.forEach(Y=>{if(Y.size.get(n)>1){assert&&assert(Y.getEffectiveAlign(n)!==vi.ORIGIN,"origin alignment cannot be specified for cells that span >1 width or height");const j=Y.getIndices(n).map(ce=>c.get(ce)),le=_.sum(j.map(ce=>ce.min)),xe=Y.getMinimumSize(n);if(xe>le){const ce=(xe-le)/j.length;j.forEach(ne=>{ne.min+=ce})}}}),f.forEach(Y=>{Y.hasOrigin()?Y.size=Math.max(Y.min,Y.maxOrigin-Y.minOrigin):Y.size=Y.min});const O=_.sum(f.map(Y=>Y.size))+_.sum(w);t.set(n,O);const T=Math.max(O,i.get(n)||0);let z=T-O,U;for(;z>1e-7&&(U=f.filter(Y=>Y.grow>0&&Y.size<Y.max-1e-7)).length;){const Y=_.sum(U.map(le=>le.grow)),j=Math.min(Math.min(...U.map(le=>(le.max-le.size)/le.grow)),z/Y);assert&&assert(j>1e-11),U.forEach(le=>{le.size+=j*le.grow}),z-=j*Y}const m=(f[0].hasOrigin()?f[0].minOrigin:0)+this.layoutOriginProperty.value[n.coordinate];s[n.minCoordinate]=m,s[n.maxCoordinate]=m+T,f.forEach((Y,j)=>{const le=_.sum(f.slice(0,j).map(ce=>ce.size)),xe=_.sum(w.slice(0,j));Y.position=m+le+xe}),e.forEach(Y=>{const j=Y.position.get(n),le=Y.size.get(n),xe=j+le-1,ce=Y.getIndices(n).map(Me=>c.get(Me)),ne=c.get(j);let me=0;j!==xe&&f.slice(0,-1).forEach((Me,ze)=>{Me.index>=j&&Me.index<xe&&(me+=w[ze])});const Fe=_.sum(ce.map(Me=>Me.size))+me,we=ne.position,He=Y.reposition(n,Fe,we,Y.getEffectiveStretch(n),-ne.minOrigin,Y.getEffectiveAlign(n));s[n.minCoordinate]=Math.min(s[n.minCoordinate],He[n.minCoordinate]),s[n.maxCoordinate]=Math.max(s[n.maxCoordinate],He[n.maxCoordinate])})}),this.layoutBoundsProperty.value=s,this.minimumWidthProperty.value=t.horizontal,this.minimumHeightProperty.value=t.vertical,this.finishedLayoutEmitter.emit()}get spacing(){return assert&&assert(this.xSpacing===this.ySpacing),this.xSpacing}set spacing(e){assert&&assert(typeof e=="number"&&isFinite(e)&&e>=0||Array.isArray(e)&&_.every(e,t=>typeof t=="number"&&isFinite(t)&&t>=0)),(this._spacing.get(_t.HORIZONTAL)!==e||this._spacing.get(_t.VERTICAL)!==e)&&(this._spacing.set(_t.HORIZONTAL,e),this._spacing.set(_t.VERTICAL,e),this.updateLayoutAutomatically())}get xSpacing(){return this._spacing.get(_t.HORIZONTAL)}set xSpacing(e){assert&&assert(typeof e=="number"&&isFinite(e)&&e>=0||Array.isArray(e)&&_.every(e,t=>typeof t=="number"&&isFinite(t)&&t>=0)),this._spacing.get(_t.HORIZONTAL)!==e&&(this._spacing.set(_t.HORIZONTAL,e),this.updateLayoutAutomatically())}get ySpacing(){return this._spacing.get(_t.VERTICAL)}set ySpacing(e){assert&&assert(typeof e=="number"&&isFinite(e)&&e>=0||Array.isArray(e)&&_.every(e,t=>typeof t=="number"&&isFinite(t)&&t>=0)),this._spacing.get(_t.VERTICAL)!==e&&(this._spacing.set(_t.VERTICAL,e),this.updateLayoutAutomatically())}addCell(e){assert&&assert(!this.cells.has(e)),this.cells.add(e),this.addNode(e.node),e.changedEmitter.addListener(this._updateLayoutListener),this.updateLayoutAutomatically()}removeCell(e){assert&&assert(this.cells.has(e)),this.cells.delete(e),this.removeNode(e.node),e.changedEmitter.removeListener(this._updateLayoutListener),this.updateLayoutAutomatically()}dispose(){this.lock(),[...this.cells].forEach(e=>this.removeCell(e)),this.displayedLines.forEach(e=>e.clear()),this.displayedCells=[],super.dispose(),this.unlock()}getIndices(e){const t=[];return this.cells.forEach(i=>{t.push(...i.getIndices(e))}),_.sortedUniq(_.sortBy(t))}getCell(e,t){return _.find([...this.cells],i=>i.containsRow(e)&&i.containsColumn(t))||null}getCellFromNode(e){return _.find([...this.cells],t=>t.node===e)||null}getCells(e,t){return _.filter([...this.cells],i=>i.containsIndex(e,t))}static create(e,t){return new Xh(e,t)}}te.register("GridConstraint",Xh);const E0=[...uy,...my.filter(h=>h!=="excludeInvisible"),"rows","columns","autoRows","autoColumns"];class yy extends wd{constructor(e){const t=st()({excludeInvisibleChildrenFromBounds:!0,resize:!0},e);super(),this._cellMap=new Map,this._autoRows=null,this._autoColumns=null,this._autoLockCount=0,this._constraint=new Xh(this,{preferredWidthProperty:this.localPreferredWidthProperty,preferredHeightProperty:this.localPreferredHeightProperty,minimumWidthProperty:this.localMinimumWidthProperty,minimumHeightProperty:this.localMinimumHeightProperty,layoutOriginProperty:this.layoutOriginProperty,excludeInvisible:!1}),this.onChildInserted=this.onGridBoxChildInserted.bind(this),this.onChildRemoved=this.onGridBoxChildRemoved.bind(this),this.onChildVisibilityToggled=this.updateAllAutoLines.bind(this),this.childInsertedEmitter.addListener(this.onChildInserted),this.childRemovedEmitter.addListener(this.onChildRemoved);const i=_.omit(t,lr),s=_.pick(t,lr);this._constraint.lock(),this.mutate(i),this._constraint.unlock(),this._constraint.updateLayout(),this.mutate(s),this.linkLayoutBounds()}setLines(e,t){const i=[];for(let s=0;s<t.length;s++){const n=t[s];for(let o=0;o<n.length;o++){const c=n[o];c!==null&&(i.push(c),c.mutateLayoutOptions({[e.line]:s,[e.opposite.line]:o}))}}this.children=i}getLines(e){const t=[];for(const i of this._cellMap.values()){const s=i.position.get(e),n=i.position.get(e.opposite);for(;t.length<s+1;)t.push([]);for(;t[s].length<n+1;)t[s].push(null);t[s][n]=i.node}return t}set rows(e){this.setLines(_t.VERTICAL,e)}get rows(){return this.getLines(_t.VERTICAL)}set columns(e){this.setLines(_t.HORIZONTAL,e)}get columns(){return this.getLines(_t.HORIZONTAL)}getNodeAt(e,t){const i=this.constraint.getCell(e,t);return i?i.node:null}getRowOfNode(e){return assert&&assert(this.children.includes(e)),this.constraint.getCellFromNode(e).position.vertical}getColumnOfNode(e){return assert&&assert(this.children.includes(e)),this.constraint.getCellFromNode(e).position.horizontal}getNodesInRow(e){return this.constraint.getCells(_t.VERTICAL,e).map(t=>t.node)}getNodesInColumn(e){return this.constraint.getCells(_t.HORIZONTAL,e).map(t=>t.node)}addRow(e){return this.rows=[...this.rows,e],this}addColumn(e){return this.columns=[...this.columns,e],this}insertRow(e,t){return this.rows=[...this.rows.slice(0,e),t,...this.rows.slice(e)],this}insertColumn(e,t){return this.columns=[...this.columns.slice(0,e),t,...this.columns.slice(e)],this}removeRow(e){return this.rows=[...this.rows.slice(0,e),...this.rows.slice(e+1)],this}removeColumn(e){return this.columns=[...this.columns.slice(0,e),...this.columns.slice(e+1)],this}set autoRows(e){assert&&assert(e===null||typeof e=="number"&&isFinite(e)&&e>=1),this._autoRows!==e&&(this._autoRows=e,this.updateAutoRows())}get autoRows(){return this._autoRows}set autoColumns(e){assert&&assert(e===null||typeof e=="number"&&isFinite(e)&&e>=1),this._autoColumns!==e&&(this._autoColumns=e,this.updateAutoColumns())}get autoColumns(){return this._autoColumns}updateAutoLines(e,t){if(t!==null&&this._autoLockCount===0){let i=0;this.constraint.lock(),this.children.filter(s=>s.bounds.isValid()&&(!this._constraint.excludeInvisible||s.visible)).forEach((s,n)=>{const o=n%t,c=Math.floor(n/t);(!s.layoutOptions||s.layoutOptions[e.line]!==o||s.layoutOptions[e.opposite.line]!==c||s.layoutOptions.horizontalSpan!==1||s.layoutOptions.verticalSpan!==1)&&(i++,s.mutateLayoutOptions({[e.line]:n%t,[e.opposite.line]:Math.floor(n/t),horizontalSpan:1,verticalSpan:1}))}),this.constraint.unlock(),i>0&&this.constraint.updateLayoutAutomatically()}}updateAutoRows(){this.updateAutoLines(_t.VERTICAL,this.autoRows)}updateAutoColumns(){this.updateAutoLines(_t.HORIZONTAL,this.autoColumns)}updateAllAutoLines(){assert&&assert(this._autoRows===null||this._autoColumns===null,"autoRows and autoColumns should not both be set when updating children"),this.updateAutoRows(),this.updateAutoColumns()}setChildren(e){const t=this.getChildren();return this._autoLockCount++,super.setChildren(e),this._autoLockCount--,_.isEqual(t,e)||this.updateAllAutoLines(),this}onGridBoxChildInserted(e,t){e.visibleProperty.lazyLink(this.onChildVisibilityToggled);const i=new fy(this._constraint,e,this._constraint.createLayoutProxy(e));this._cellMap.set(e,i),this._constraint.addCell(i),this.updateAllAutoLines()}onGridBoxChildRemoved(e){const t=this._cellMap.get(e);assert&&assert(t),this._cellMap.delete(e),this._constraint.removeCell(t),t.dispose(),this.updateAllAutoLines(),e.visibleProperty.unlink(this.onChildVisibilityToggled)}mutate(e){return us(e,["rows"],["columns"],["children","autoRows","autoColumns"]),e&&assert&&assert(typeof e.autoRows!="number"||typeof e.autoColumns!="number","autoRows and autoColumns should not be specified both as non-null at the same time"),super.mutate(e)}get spacing(){return this._constraint.spacing}set spacing(e){this._constraint.spacing=e}get xSpacing(){return this._constraint.xSpacing}set xSpacing(e){this._constraint.xSpacing=e}get ySpacing(){return this._constraint.ySpacing}set ySpacing(e){this._constraint.ySpacing=e}get xAlign(){return this._constraint.xAlign}set xAlign(e){this._constraint.xAlign=e}get yAlign(){return this._constraint.yAlign}set yAlign(e){this._constraint.yAlign=e}get grow(){return this._constraint.grow}set grow(e){this._constraint.grow=e}get xGrow(){return this._constraint.xGrow}set xGrow(e){this._constraint.xGrow=e}get yGrow(){return this._constraint.yGrow}set yGrow(e){this._constraint.yGrow=e}get stretch(){return this._constraint.stretch}set stretch(e){this._constraint.stretch=e}get xStretch(){return this._constraint.xStretch}set xStretch(e){this._constraint.xStretch=e}get yStretch(){return this._constraint.yStretch}set yStretch(e){this._constraint.yStretch=e}get margin(){return this._constraint.margin}set margin(e){this._constraint.margin=e}get xMargin(){return this._constraint.xMargin}set xMargin(e){this._constraint.xMargin=e}get yMargin(){return this._constraint.yMargin}set yMargin(e){this._constraint.yMargin=e}get leftMargin(){return this._constraint.leftMargin}set leftMargin(e){this._constraint.leftMargin=e}get rightMargin(){return this._constraint.rightMargin}set rightMargin(e){this._constraint.rightMargin=e}get topMargin(){return this._constraint.topMargin}set topMargin(e){this._constraint.topMargin=e}get bottomMargin(){return this._constraint.bottomMargin}set bottomMargin(e){this._constraint.bottomMargin=e}get minContentWidth(){return this._constraint.minContentWidth}set minContentWidth(e){this._constraint.minContentWidth=e}get minContentHeight(){return this._constraint.minContentHeight}set minContentHeight(e){this._constraint.minContentHeight=e}get maxContentWidth(){return this._constraint.maxContentWidth}set maxContentWidth(e){this._constraint.maxContentWidth=e}get maxContentHeight(){return this._constraint.maxContentHeight}set maxContentHeight(e){this._constraint.maxContentHeight=e}setExcludeInvisibleChildrenFromBounds(e){super.setExcludeInvisibleChildrenFromBounds(e),this.updateAllAutoLines()}dispose(){this._constraint.lock(),this.childInsertedEmitter.removeListener(this.onChildInserted),this.childRemovedEmitter.removeListener(this.onChildRemoved);for(const e of this._cellMap.values())e.dispose(),e.node.visibleProperty.unlink(this.onChildVisibilityToggled);super.dispose()}getHelperNode(){return El.createHelperNode(this.constraint.displayedCells,this.constraint.layoutBoundsProperty.value,t=>{let i="";return i+=`row: ${t.position.vertical}
`,i+=`column: ${t.position.horizontal}
`,t.size.horizontal>1&&(i+=`horizontalSpan: ${t.size.horizontal}
`),t.size.vertical>1&&(i+=`verticalSpan: ${t.size.vertical}
`),i+=`xAlign: ${vi.internalToAlign(_t.HORIZONTAL,t.effectiveXAlign)}
`,i+=`yAlign: ${vi.internalToAlign(_t.VERTICAL,t.effectiveYAlign)}
`,i+=`xStretch: ${t.effectiveXStretch}
`,i+=`yStretch: ${t.effectiveYStretch}
`,i+=`xGrow: ${t.effectiveXGrow}
`,i+=`yGrow: ${t.effectiveYGrow}
`,i})}}yy.prototype._mutatorKeys=[...Cm,...E0,...tt.prototype._mutatorKeys];te.register("GridBox",yy);class k0 extends tt{constructor(e,t){us(t,["createCellBackground"],["fill","stroke"]);const i=n=>$i.bounds(n.lastAvailableBounds,{fill:s.fill,stroke:s.stroke}),s=st()({fill:"white",stroke:"black",createCellBackground:i},t);super(),this.constraint=e,this.createCellBackground=s.createCellBackground,this.layoutListener=this.update.bind(this),this.constraint.finishedLayoutEmitter.addListener(this.layoutListener),this.update(),this.mutate(s)}update(){this.children=this.constraint.displayedCells.map(this.createCellBackground).filter(_.identity)}dispose(){this.constraint.finishedLayoutEmitter.removeListener(this.layoutListener),super.dispose()}}te.register("GridBackgroundNode",k0);class kd extends Al{constructor(e,t,i){assert&&assert(Array.isArray(t)&&_.every(t,s=>s instanceof tt)),super(e),this.lock(),this.nodes=t,this.cells=t.map(s=>new Kh(this,s,null)),this.layoutCallback=i,this.nodes.forEach(s=>this.addNode(s,!1)),this.unlock(),this.updateLayout()}layout(){if(super.layout(),assert&&assert(_.every(this.nodes,t=>!t.isDisposed)),!_.some(this.cells,t=>!t.isConnected())){const t=this.cells.map(i=>i.proxy);this.layoutCallback.apply(null,t),this.finishedLayoutEmitter.emit()}}dispose(){this.cells.forEach(e=>e.dispose()),super.dispose()}static create(e,t,i){return new kd(e,t,i)}}te.register("ManualConstraint",kd);class Od extends Al{constructor(e,t,i){assert&&assert(Array.isArray(t)&&_.every(t,s=>s instanceof tt)),super(e),this.lock(),this.nodes=t,this.cells=t.map(s=>new Kh(this,s,null)),this.layoutCallback=i,this.nodes.forEach(s=>this.addNode(s,!1)),this.unlock(),this.updateLayout()}layout(){super.layout(),assert&&assert(_.every(this.nodes,t=>!t.isDisposed));const e=this.cells.map(t=>t.isConnected()?t.proxy:null);this.layoutCallback.apply(null,e),this.finishedLayoutEmitter.emit()}dispose(){this.cells.forEach(e=>e.dispose()),super.dispose()}static create(e,t,i){return new Od(e,t,i)}}te.register("RelaxedManualConstraint",Od);const O0=["alignBounds","xAlign","yAlign","margin","xMargin","yMargin","leftMargin","rightMargin","topMargin","bottomMargin","group"],ef=["left","center","right","stretch"],tf=["top","center","bottom","stretch"],by=$h(tt);class Md extends by{constructor(e,t){const i=st()({children:[e]},t),s={sizable:!1};super(s),this._xSet=!1,this._ySet=!1,this._contentBoundsListener=_.noop,assert&&assert(i===void 0||Object.getPrototypeOf(i)===Object.prototype,"Extra prototype on Node options object is a code smell"),this._content=e,this._alignBounds=null,this._xAlign="center",this._yAlign="center",this._leftMargin=0,this._rightMargin=0,this._topMargin=0,this._bottomMargin=0,this._group=null,this._contentBoundsListener=this.invalidateAlignment.bind(this),this._alignBoundsProperty=null,this._alignBoundsPropertyListener=_.noop,us(i,["alignBounds"],["alignBoundsProperty"]),t!=null&&t.alignBoundsProperty&&(this._alignBoundsProperty=t.alignBoundsProperty,i.alignBounds=this._alignBoundsProperty.value,this._alignBoundsPropertyListener=n=>{this.alignBounds=n},this._alignBoundsProperty.lazyLink(this._alignBoundsPropertyListener)),this.localBounds=new $e(0,0,0,0),this.constraint=new M0(this,e),this._content.boundsProperty.link(this._contentBoundsListener),this.mutate(i),Ar.multilink([this.localPreferredWidthProperty,this.localPreferredHeightProperty],(n,o)=>{if(n!==null||o!==null){const c=this._alignBounds||new $e(0,0,0,0);n&&(c.minX=0,c.maxX=n,this._xSet=!0),o&&(c.minY=0,c.maxY=o,this._ySet=!0),this._alignBounds=c,this.constraint.updateLayout()}})}invalidateAlignment(){sceneryLog&&sceneryLog.AlignBox&&sceneryLog.AlignBox(`AlignBox#${this.id} invalidateAlignment`),sceneryLog&&sceneryLog.AlignBox&&sceneryLog.push(),this._group&&this._group.onAlignBoxResized(this),this.constraint.updateLayout(),sceneryLog&&sceneryLog.AlignBox&&sceneryLog.pop()}setAlignBounds(e){return assert&&assert(e===null||e instanceof $e&&!e.isEmpty()&&e.isFinite(),"alignBounds should be a non-empty finite Bounds2"),this._xSet=!0,this._ySet=!0,this._alignBounds!==e&&(!e||!this._alignBounds||!e.equals(this._alignBounds))&&(this._alignBounds=e,this.constraint.updateLayout()),this}set alignBounds(e){this.setAlignBounds(e)}get alignBounds(){return this.getAlignBounds()}getAlignBounds(){return this._alignBounds}setGroup(e){return assert&&assert(e===null||e instanceof _y,"group should be an AlignGroup"),this._group!==e&&(this._group&&this._group.removeAlignBox(this),this._group=e,this._group&&this._group.addAlignBox(this)),this}set group(e){this.setGroup(e)}get group(){return this.getGroup()}getGroup(){return this._group}setXAlign(e){return assert&&assert(ef.includes(e),`xAlign should be one of: ${ef}`),this._xAlign!==e&&(this._xAlign=e,this.invalidateAlignment()),this}set xAlign(e){this.setXAlign(e)}get xAlign(){return this.getXAlign()}getXAlign(){return this._xAlign}setYAlign(e){return assert&&assert(tf.includes(e),`xAlign should be one of: ${tf}`),this._yAlign!==e&&(this._yAlign=e,this.invalidateAlignment()),this}set yAlign(e){this.setYAlign(e)}get yAlign(){return this.getYAlign()}getYAlign(){return this._yAlign}setMargin(e){return assert&&assert(isFinite(e)&&e>=0,"margin should be a finite non-negative number"),(this._leftMargin!==e||this._rightMargin!==e||this._topMargin!==e||this._bottomMargin!==e)&&(this._leftMargin=this._rightMargin=this._topMargin=this._bottomMargin=e,this.invalidateAlignment()),this}set margin(e){this.setMargin(e)}get margin(){return this.getMargin()}getMargin(){return assert&&assert(this._leftMargin===this._rightMargin&&this._leftMargin===this._topMargin&&this._leftMargin===this._bottomMargin,"Getting margin does not have a unique result if the left and right margins are different"),this._leftMargin}setXMargin(e){return assert&&assert(isFinite(e)&&e>=0,"xMargin should be a finite non-negative number"),(this._leftMargin!==e||this._rightMargin!==e)&&(this._leftMargin=this._rightMargin=e,this.invalidateAlignment()),this}set xMargin(e){this.setXMargin(e)}get xMargin(){return this.getXMargin()}getXMargin(){return assert&&assert(this._leftMargin===this._rightMargin,"Getting xMargin does not have a unique result if the left and right margins are different"),this._leftMargin}setYMargin(e){return assert&&assert(isFinite(e)&&e>=0,"yMargin should be a finite non-negative number"),(this._topMargin!==e||this._bottomMargin!==e)&&(this._topMargin=this._bottomMargin=e,this.invalidateAlignment()),this}set yMargin(e){this.setYMargin(e)}get yMargin(){return this.getYMargin()}getYMargin(){return assert&&assert(this._topMargin===this._bottomMargin,"Getting yMargin does not have a unique result if the top and bottom margins are different"),this._topMargin}setLeftMargin(e){return assert&&assert(isFinite(e)&&e>=0,"leftMargin should be a finite non-negative number"),this._leftMargin!==e&&(this._leftMargin=e,this.invalidateAlignment()),this}set leftMargin(e){this.setLeftMargin(e)}get leftMargin(){return this.getLeftMargin()}getLeftMargin(){return this._leftMargin}setRightMargin(e){return assert&&assert(isFinite(e)&&e>=0,"rightMargin should be a finite non-negative number"),this._rightMargin!==e&&(this._rightMargin=e,this.invalidateAlignment()),this}set rightMargin(e){this.setRightMargin(e)}get rightMargin(){return this.getRightMargin()}getRightMargin(){return this._rightMargin}setTopMargin(e){return assert&&assert(isFinite(e)&&e>=0,"topMargin should be a finite non-negative number"),this._topMargin!==e&&(this._topMargin=e,this.invalidateAlignment()),this}set topMargin(e){this.setTopMargin(e)}get topMargin(){return this.getTopMargin()}getTopMargin(){return this._topMargin}setBottomMargin(e){return assert&&assert(isFinite(e)&&e>=0,"bottomMargin should be a finite non-negative number"),this._bottomMargin!==e&&(this._bottomMargin=e,this.invalidateAlignment()),this}set bottomMargin(e){this.setBottomMargin(e)}get bottomMargin(){return this.getBottomMargin()}getBottomMargin(){return this._bottomMargin}getContent(){return this._content}get content(){return this.getContent()}getContentBounds(){sceneryLog&&sceneryLog.AlignBox&&sceneryLog.AlignBox(`AlignBox#${this.id} getContentBounds`),sceneryLog&&sceneryLog.AlignBox&&sceneryLog.push();const e=this._content.bounds;return sceneryLog&&sceneryLog.AlignBox&&sceneryLog.pop(),new $e(e.left-this._leftMargin,e.top-this._topMargin,e.right+this._rightMargin,e.bottom+this._bottomMargin)}setAdjustedLocalBounds(e){if(this._xSet&&this._ySet)this.localBounds=e;else if(this._xSet){const t=this.getContentBounds();this.localBounds=new $e(e.minX,t.minY,e.maxX,t.maxY)}else if(this._ySet){const t=this.getContentBounds();this.localBounds=new $e(t.minX,e.minY,t.maxX,e.maxY)}else this.localBounds=this.getContentBounds()}dispose(){this._alignBoundsProperty&&this._alignBoundsProperty.unlink(this._alignBoundsPropertyListener),this._content.boundsProperty.unlink(this._contentBoundsListener),this._content=new tt,this.group=null,this.constraint.dispose(),super.dispose()}mutate(e){return super.mutate(e)}}class M0 extends Al{constructor(e,t){super(e),this.alignBox=e,this.content=t,this.addNode(t),e.isWidthResizableProperty.lazyLink(this._updateLayoutListener),e.isHeightResizableProperty.lazyLink(this._updateLayoutListener)}updateProperty(e,t){const i=this.content[e],s=this.alignBox.localBounds[e]+t;Math.abs(i-s)>1e-5&&(this.content[e]=s)}layout(){super.layout();const e=this.alignBox,t=this.content;if(sceneryLog&&sceneryLog.AlignBox&&sceneryLog.AlignBox(`AlignBoxConstraint#${this.alignBox.id} layout`),sceneryLog&&sceneryLog.AlignBox&&sceneryLog.push(),!t.bounds.isValid())return;const i=e.leftMargin+e.rightMargin,s=e.topMargin+e.bottomMargin;if(e.alignBounds!==null)e.setAdjustedLocalBounds(e.alignBounds);else{const c=t.width+i,p=t.height+s;e.setAdjustedLocalBounds(new $e(0,0,c,p))}const n=isFinite(t.width)?(Wa(t)?t.minimumWidth||0:t.width)+i:null,o=isFinite(t.height)?(Ua(t)?t.minimumHeight||0:t.height)+s:null;t.localBounds.isEmpty()||(e.xAlign==="center"?this.updateProperty("centerX",(e.leftMargin-e.rightMargin)/2):e.xAlign==="left"?this.updateProperty("left",e.leftMargin):e.xAlign==="right"?this.updateProperty("right",-e.rightMargin):e.xAlign==="stretch"?(assert&&assert(Wa(t),"xAlign:stretch can only be used if WidthSizable is mixed into the content"),t.preferredWidth=e.localWidth-e.leftMargin-e.rightMargin,this.updateProperty("left",e.leftMargin)):assert&&assert(`Bad xAlign: ${e.xAlign}`),e.yAlign==="center"?this.updateProperty("centerY",(e.topMargin-e.bottomMargin)/2):e.yAlign==="top"?this.updateProperty("top",e.topMargin):e.yAlign==="bottom"?this.updateProperty("bottom",-e.bottomMargin):e.yAlign==="stretch"?(assert&&assert(Ua(t),"yAlign:stretch can only be used if HeightSizable is mixed into the content"),t.preferredHeight=e.localHeight-e.topMargin-e.bottomMargin,this.updateProperty("top",e.topMargin)):assert&&assert(`Bad yAlign: ${e.yAlign}`)),sceneryLog&&sceneryLog.AlignBox&&sceneryLog.pop(),e.localMinimumWidth=e.widthSizable?n:e.localWidth,e.localMinimumHeight=e.heightSizable?o:e.localHeight}}Md.prototype._mutatorKeys=O0.concat(by.prototype._mutatorKeys);te.register("AlignBox",Md);let R0=1;const N0={matchHorizontal:!0,matchVertical:!0};class _y extends Yu{constructor(e){assert&&assert(e===void 0||Object.getPrototypeOf(e)===Object.prototype,"Extra prototype on options object is a code smell");const t=or()({},N0,e);assert&&assert(typeof t.matchHorizontal=="boolean"),assert&&assert(typeof t.matchVertical=="boolean"),super(t),this._alignBoxes=[],this._matchHorizontal=t.matchHorizontal,this._matchVertical=t.matchVertical,this._resizeLock=!1,this._maxWidthProperty=new Wn(0),this._maxHeightProperty=new Wn(0),this.id=R0++}getMaxWidth(){return this._maxWidthProperty.value}get maxWidth(){return this.getMaxWidth()}getMaxWidthProperty(){return this._maxWidthProperty}get maxWidthProperty(){return this.getMaxWidthProperty()}getMaxHeight(){return this._maxHeightProperty.value}get maxHeight(){return this.getMaxHeight()}getMaxHeightProperty(){return this._maxHeightProperty}get maxHeightProperty(){return this.getMaxHeightProperty()}getMaxSizeProperty(e){return e===_t.HORIZONTAL?this._maxWidthProperty:this._maxHeightProperty}createBox(e,t){return new Md(e,_i({group:this},t))}setMatchHorizontal(e){return this._matchHorizontal!==e&&(this._matchHorizontal=e,this.updateLayout()),this}set matchHorizontal(e){this.setMatchHorizontal(e)}get matchHorizontal(){return this.getMatchHorizontal()}getMatchHorizontal(){return this._matchHorizontal}setMatchVertical(e){return this._matchVertical!==e&&(this._matchVertical=e,this.updateLayout()),this}set matchVertical(e){this.setMatchVertical(e)}get matchVertical(){return this.getMatchVertical()}getMatchVertical(){return this._matchVertical}updateLayout(){if(this._resizeLock)return;this._resizeLock=!0,sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.AlignGroup(`AlignGroup#${this.id} updateLayout`),sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.push(),sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.AlignGroup("AlignGroup computing maximum dimension"),sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.push();let e=0,t=0;for(let i=0;i<this._alignBoxes.length;i++){const n=this._alignBoxes[i].getContentBounds();n.isEmpty()||!n.isFinite()||(e=Math.max(e,n.width),t=Math.max(t,n.height))}if(sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.pop(),sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.AlignGroup("AlignGroup applying to boxes"),sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.push(),this._maxWidthProperty.value=e,this._maxHeightProperty.value=t,e>0&&t>0)for(let i=0;i<this._alignBoxes.length;i++)this.setBoxBounds(this._alignBoxes[i],e,t);sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.pop(),sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.pop(),this._resizeLock=!1}setBoxBounds(e,t,i){let s;if(this._matchVertical&&this._matchHorizontal)s=new $e(0,0,t,i);else{const n=e.getContentBounds();this._matchVertical?s=new $e(0,0,isFinite(n.width)?n.width:t,i):this._matchHorizontal?s=new $e(0,0,t,isFinite(n.height)?n.height:i):s=n}e.alignBounds=s}onAlignBoxResized(e){this.updateLayout()}addAlignBox(e){this._alignBoxes.push(e),this.updateLayout()}removeAlignBox(e){is(this._alignBoxes,e),this.updateLayout()}dispose(){for(let e=this._alignBoxes.length-1;e>=0;e--)this._alignBoxes[e].dispose();super.dispose()}}te.register("AlignGroup",_y);class B0 extends ro{constructor(e){assert&&assert(!e||!e.orientation,"HBox sets orientation"),super(st()({orientation:"horizontal"},e))}onFlowBoxChildInserted(e,t){assert&&assert(!(e instanceof hy),"HSeparator should not be used in an HBox. Use VSeparator instead"),super.onFlowBoxChildInserted(e,t)}mutate(e){return super.mutate(e)}}te.register("HBox",B0);class F0 extends ro{constructor(e){assert&&assert(!e||!e.orientation,"VBox sets orientation"),super(st()({orientation:"vertical"},e))}onFlowBoxChildInserted(e,t){assert&&assert(!(e instanceof ly),"VSeparator should not be used in an VBox. Use HSeparator instead"),super.onFlowBoxChildInserted(e,t)}mutate(e){return super.mutate(e)}}te.register("VBox",F0);const Kc=h=>h.type.toLowerCase()==="element",qc=h=>h.type.toLowerCase()==="text",Us={scratchText:new gs(""),himalayaGetAttribute(h,e){if(!e)return null;const t=_.find(e.attributes,i=>i.key===h);return t&&t.value||null},himalayaStyleStringToMap(h){const e=h.split(";"),t={};return e.forEach(i=>{if(i.length>0){const s=i.split(":");assert&&assert(s.length===2,"too many colons"),t[s[0].trim()]=s[1].trim()}}),t}};te.register("RichTextUtils",Us);const lo=ns(h=>(assert&&assert(_.includes(Xs(h),tt),"Only Node subtypes should mix Paintable"),class extends h{get isCleanable(){return!0}clean(){const t=this;for(let i=t._children.length-1;i>=0;i--){const s=t._children[i];s.isCleanable&&(t.removeChild(s),s.clean())}t.matrix=Ze.IDENTITY,t.freeToPool()}}));te.register("RichTextCleanable",lo);const hl=class hl extends lo(tt){constructor(e){super(),this.initialize(e)}initialize(e){return this.localBounds=new $e(0,0,0,e),this}freeToPool(){hl.pool.freeToPool(this)}};hl.pool=new qi(hl);let Lh=hl;te.register("RichTextVerticalSpacer",Lh);const cl=class cl extends lo(tt){constructor(e){super(),this.initialize(e)}initialize(e){return this.isLTR=e,this.leftSpacing=0,this.rightSpacing=0,this}addElement(e){const t=this.children.length>0,i=e.width>0,s=e.getScaleVector().x,n=e.leftSpacing*s,o=e.rightSpacing*s;if(!t&&!i)return sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText("No child or element, ignoring"),!1;if(t)if(!i)sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`No element, adding spacing, ltr:${this.isLTR}, spacing: ${n+o}`),this.isLTR?this.rightSpacing+=n+o:this.leftSpacing+=n+o;else return this.isLTR?(sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`LTR add ${this.rightSpacing} + ${n}`),e.left=this.localRight+this.rightSpacing+n,this.rightSpacing=o):(sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`RTL add ${this.leftSpacing} + ${o}`),e.right=this.localLeft-this.leftSpacing-o,this.leftSpacing=n),this.addChild(e),!0;else return sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`First child, ltr:${this.isLTR}, spacing: ${this.isLTR?o:n}`),this.isLTR?(e.left=0,this.leftSpacing=n,this.rightSpacing=o):(e.right=0,this.leftSpacing=n,this.rightSpacing=o),this.addChild(e),!0;return!1}addExtraBeforeSpacing(e){this.isLTR?this.leftSpacing+=e:this.rightSpacing+=e}freeToPool(){cl.pool.freeToPool(this)}};cl.pool=new qi(cl);let qa=cl;te.register("RichTextElement",qa);const ul=class ul extends lo(gs){constructor(e,t,i,s,n,o,c){super(""),this.initialize(e,t,i,s,n,o,c)}initialize(e,t,i,s,n,o,c){let p="";for(;e.startsWith(" ");)p+=" ",e=e.slice(1);let f="";for(;e.endsWith(" ");)f=" ",e=e.slice(0,e.length-1);this.string=ur.contentToString(e,t),this.boundsMethod=s,this.font=i,this.fill=n,this.stroke=o,this.lineWidth=c;const w=p.length?Us.scratchText.setString(p).setFont(i).width:0,O=f.length?Us.scratchText.setString(f).setFont(i).width:0;return this.leftSpacing=t?w:O,this.rightSpacing=t?O:w,this}clean(){super.clean(),this.fill=null,this.stroke=null}fitsIn(e,t,i){return this.width+(t?i?this.leftSpacing:this.rightSpacing:0)<=e}freeToPool(){ul.pool.freeToPool(this)}};ul.pool=new qi(ul);let ca=ul;te.register("RichTextLeaf",ca);const dl=class dl extends lo(tt){constructor(e){super(),this.leftSpacing=0,this.rightSpacing=0,this.initialize(e)}initialize(e){return this.addChild(e),this}clean(){super.clean(),this.removeAllChildren()}fitsIn(e){return this.width<=e}freeToPool(){dl.pool.freeToPool(this)}};dl.pool=new qi(dl);let Ph=dl;te.register("RichTextNode",Ph);const gl=class gl extends kn(lo(tt)){constructor(e,t){super(),this.fireListener=null,this.accessibleInputListener=null,this.allowLinksListener=null,this.initialize(e,t,!1),this.mutate({cursor:"pointer",tagName:"a"})}initialize(e,t,i=!0){return i&&super.initialize(),this.innerContent=e,this.voicingNameResponse=e,typeof t=="function"?(this.fireListener=new Bu({fire:t,tandem:ai.OPT_OUT}),this.addInputListener(this.fireListener),this.setPDOMAttribute("href","#"),this.setPDOMAttribute("target","_self"),this.accessibleInputListener={click:s=>{s.domEvent&&s.domEvent.preventDefault(),t()}},this.addInputListener(this.accessibleInputListener)):(this.fireListener=new Bu({fire:s=>{s.isFromPDOM()&&s.domEvent.preventDefault(),self._linkEventsHandled&&s.handle(),Zf(t)},tandem:ai.OPT_OUT}),this.addInputListener(this.fireListener),this.setPDOMAttribute("href",t),this.setPDOMAttribute("target","_blank"),this.allowLinksListener=s=>{this.visible=s},Ja.link(this.allowLinksListener)),this}clean(){super.clean(),this.fireListener&&(this.removeInputListener(this.fireListener),this.fireListener.dispose()),this.fireListener=null,this.accessibleInputListener&&(this.removeInputListener(this.accessibleInputListener),this.accessibleInputListener=null),this.allowLinksListener&&(Ja.unlink(this.allowLinksListener),this.allowLinksListener=null)}freeToPool(){gl.pool.freeToPool(this)}};gl.pool=new qi(gl);let Sh=gl;te.register("RichTextLink",Sh);const Vu=himalaya;assert&&assert(Vu,"himalaya dependency needed for RichText.");const H0=["boundsMethod","font","fill","stroke","lineWidth","subScale","subXSpacing","subYOffset","supScale","supXSpacing","supYOffset","capHeightScale","underlineLineWidth","underlineHeightScale","strikethroughLineWidth","strikethroughHeightScale","linkFill","linkEventsHandled","links","nodes","replaceNewlines","align","leading","lineWrap",gs.STRING_PROPERTY_NAME,"string"],sf=self.QueryStringMachine&&QueryStringMachine.containsKey("stringTest"),V0=new ss({size:20}),z0=["b","strong","i","em","sub","sup","u","s"],wn={COMPLETE:"COMPLETE",INCOMPLETE:"INCOMPLETE",NONE:"NONE"},Xc=[],jc=[],vy={"font-family":"family","font-size":"size","font-stretch":"stretch","font-style":"style","font-variant":"variant","font-weight":"weight","line-height":"lineHeight"},zu=Object.keys(vy),$0=["color"].concat(zu),pn=class pn extends zh(tt){constructor(e,t){const i=st()({fill:"#000000",tandemNameSuffix:"Text",phetioType:pn.RichTextIO,phetioVisiblePropertyInstrumented:!1},t);typeof e=="string"||typeof e=="number"?i.string=e:i.stringProperty=e,super(),this._font=V0,this._boundsMethod="hybrid",this._fill="#000000",this._stroke=null,this._lineWidth=1,this._subScale=.75,this._subXSpacing=0,this._subYOffset=0,this._supScale=.75,this._supXSpacing=0,this._supYOffset=0,this._capHeightScale=.75,this._underlineLineWidth=1,this._underlineHeightScale=.15,this._strikethroughLineWidth=1,this._strikethroughHeightScale=.3,this._linkFill="rgb(27,0,241)",this._linkEventsHandled=!1,this._links={},this._nodes={},this._replaceNewlines=!1,this._align="left",this._leading=0,this._lineWrap=null,this._linkItems=[],this._hasAddedLeafToLine=!1,this.needPendingMinimumWidth=!1,this.pendingMinimumWidth=0,this._stringProperty=new $n("",!0,this.onStringPropertyChange.bind(this)),this.lineContainer=new tt({}),this.addChild(this.lineContainer),this.rebuildRichText(),this.localPreferredWidthProperty.lazyLink(()=>this.rebuildRichText()),this.mutate(i)}onStringPropertyChange(){this.rebuildRichText()}setStringProperty(e){return this._stringProperty.setTargetProperty(e,this,pn.STRING_PROPERTY_TANDEM_NAME)}set stringProperty(e){this.setStringProperty(e)}get stringProperty(){return this.getStringProperty()}getStringProperty(){return this._stringProperty}getPhetioMouseHitTarget(e=!1){return md.value==="string"?this.getStringPropertyPhetioMouseHitTarget(e):super.getPhetioMouseHitTarget(e)}getStringPropertyPhetioMouseHitTarget(e=!1){const t=this._stringProperty.getTargetProperty();return t instanceof Hi?t.getPhetioMouseHitTarget(e):"phetioNotSelectable"}initializePhetioObject(e,t){const i=st()({},t),s=this.isPhetioInstrumented();super.initializePhetioObject(e,i),ai.PHET_IO_ENABLED&&!s&&this.isPhetioInstrumented()&&this._stringProperty.initializePhetio(this,pn.STRING_PROPERTY_TANDEM_NAME,()=>new Nh(this.string,_i({phetioReadOnly:!0,tandem:this.tandem.createTandem(pn.STRING_PROPERTY_TANDEM_NAME),phetioDocumentation:"Property for the displayed text"},i.stringPropertyOptions)))}rebuildRichText(){assert&&vt(Xc),assert&&vt(jc);const e=this._lineWrap==="stretch";this.widthSizable=e,this.pendingMinimumWidth=0,this.needPendingMinimumWidth=e;const t=this._lineWrap==="stretch"?this.localPreferredWidth:this._lineWrap;if(this.freeChildrenToPool(),this.string===""){this.appendEmptyLeaf();return}sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`RichText#${this.id} rebuild`),sceneryLog&&sceneryLog.RichText&&sceneryLog.push();let i=this.string.replace(/\u202a/g,'<span dir="ltr">').replace(/\u202b/g,'<span dir="rtl">').replace(/\u202c/g,"</span>");this._replaceNewlines&&(i=i.replace(/\n/g,"<br>"));let s;try{s=Vu.parse(i)}catch{s=Vu.parse("INVALID TRANSLATION")}this._linkItems.length=0;const n=t===null?Number.POSITIVE_INFINITY:t,o=!0;let c=qa.pool.create(o);for(this._hasAddedLeafToLine=!1;s.length;){const p=s[0],f=c.bounds.isValid()?c.width:0,w=this.appendElement(c,p,this._font,this._fill,o,n-f,1);sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`lineBreakState: ${w}`),w!==wn.NONE&&(c.bounds.isValid()?(sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText("Adding line due to lineBreak"),this.appendLine(c)):this.appendLine(Lh.pool.create(Us.scratchText.setString("X").setFont(this._font).height)),c=qa.pool.create(o),this._hasAddedLeafToLine=!1),w!==wn.INCOMPLETE&&(sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText("Finished root element"),s.splice(0,1))}for(c.bounds.isValid()&&(sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText("Adding final line"),this.appendLine(c)),this.lineContainer.getChildrenCount()===0&&this.appendEmptyLeaf(),this.alignLines();this._linkItems.length;)(()=>{const p=this._linkItems[0].element,f=this._linkItems[0].href;let w;const O=[];for(w=this._linkItems.length-1;w>=0;w--){const z=this._linkItems[w];z.element===p&&(O.push(z.node),this._linkItems.splice(w,1))}const T=Sh.pool.create(p.innerContent,f);for(this.lineContainer.addChild(T),w=0;w<O.length;w++){const z=O[w],U=z.getUniqueTrailTo(this.lineContainer).getMatrix();z.detach(),z.matrix=U,T.addChild(z)}})();this._linkItems.length=0,assert&&(this._links&&this._links!==!0&&Object.keys(this._links).forEach(p=>{assert&&Ja.value&&!sf&&assert(Xc.includes(p),`Unused RichText link: ${p}`)}),this._nodes&&Object.keys(this._nodes).forEach(p=>{assert&&Ja.value&&!sf&&assert(jc.includes(p),`Unused RichText node: ${p}`)})),this.localMinimumWidth=e?this.pendingMinimumWidth:this.localBounds.width,sceneryLog&&sceneryLog.RichText&&sceneryLog.pop()}freeChildrenToPool(){for(;this.lineContainer._children.length;){const e=this.lineContainer._children[this.lineContainer._children.length-1];this.lineContainer.removeChild(e),e.clean()}}dispose(){this.freeChildrenToPool(),super.dispose(),this._stringProperty.dispose()}appendLine(e){this.lineContainer.bounds.isValid()&&(e.top=this.lineContainer.bottom+this._leading,e.left=0),this.lineContainer.addChild(e)}appendEmptyLeaf(){assert&&assert(this.lineContainer.getChildrenCount()===0),this.appendLine(ca.pool.create("",!0,this._font,this._boundsMethod,this._fill,this._stroke,this._lineWidth))}alignLines(){const e=this._align==="center"?"centerX":this._align,t=this.lineContainer[e];for(let i=0;i<this.lineContainer.getChildrenCount();i++)this.lineContainer.getChildAt(i)[e]=t}appendElement(e,t,i,s,n,o,c){let p=wn.NONE,f;const w=n?e.rightSpacing:e.leftSpacing,O=o-w;if(qc(t)){if(sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`appending leaf: ${t.content}`),sceneryLog&&sceneryLog.RichText&&sceneryLog.push(),f=ca.pool.create(t.content,n,i,this._boundsMethod,s,this._stroke,this._lineWidth),this.needPendingMinimumWidth&&(this.pendingMinimumWidth=Math.max(this.pendingMinimumWidth,Math.max(...mu(t.content).map(T=>{const z=t.content.slice(T.min,T.max),U=ca.pool.create(z,n,i,this._boundsMethod,s,this._stroke,this._lineWidth),m=U.width*c;return U.dispose(),m})))),!f.fitsIn(O,this._hasAddedLeafToLine,n)){const T=mu(t.content),z=U=>U.length===0?"":t.content.slice(U[0].min,U[U.length-1].max);if(sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`Overflow leafAdded:${this._hasAddedLeafToLine}, words: ${T.length}`),this._hasAddedLeafToLine||T.length>1){sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText("Skipping words");const U=[];let m=!1;for(U.unshift(T.pop());T.length;)if(f.clean(),f=ca.pool.create(z(T),n,i,this._boundsMethod,s,this._stroke,this._lineWidth),!f.fitsIn(O,this._hasAddedLeafToLine,n)&&(this._hasAddedLeafToLine||T.length>1))sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`Skipping word ${z([T[T.length-1]])}`),U.unshift(T.pop());else{sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`Success with ${z(T)}`),m=!0;break}if(m)p=wn.INCOMPLETE,t.content=z(U),sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`Remaining content: ${t.content}`);else return f.clean(),wn.INCOMPLETE}}this._hasAddedLeafToLine=!0,sceneryLog&&sceneryLog.RichText&&sceneryLog.pop()}else if(Kc(t)){if(t.tagName==="br")return sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText("manual line break"),wn.COMPLETE;if(t.tagName==="span"){const U=Us.himalayaGetAttribute("dir",t);U&&(assert&&assert(U==="ltr"||U==="rtl","Span dir attributes should be ltr or rtl."),n=U==="ltr")}if(t.tagName==="node"){const U=Us.himalayaGetAttribute("id",t),m=U&&this._nodes[U]||null;if(assert&&assert(m,U?`Could not find a matching item in RichText's nodes for ${U}. It should be provided in the nodes option`:"No id attribute provided for a given <node> element"),m){if(assert&&jc.push(U),f=Ph.pool.create(m),this._hasAddedLeafToLine&&!f.fitsIn(O))return f.clean(),wn.INCOMPLETE;const Y=Us.himalayaGetAttribute("align",t);if(Y==="center"||Y==="top"||Y==="bottom"){const j=Us.scratchText.setString("Test").setFont(i).bounds;Y==="center"?f.centerY=j.centerY:Y==="top"?f.top=j.top:Y==="bottom"&&(f.bottom=j.bottom)}}else return p;this._hasAddedLeafToLine=!0}else f=qa.pool.create(n);sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText("appending element"),sceneryLog&&sceneryLog.RichText&&sceneryLog.push();const T=Us.himalayaGetAttribute("style",t);if(T){const U=Us.himalayaStyleStringToMap(T);assert&&Object.keys(U).forEach(Y=>{assert(_.includes($0,Y),"See supported style CSS keys")}),U.color&&(s=new qe(U.color));const m={};for(let Y=0;Y<zu.length;Y++){const j=zu[Y];U[j]&&(m[vy[j]]=U[j])}i=(typeof i=="string"?ss.fromCSS(i):i).copy(m)}if(t.tagName==="a"){let U=Us.himalayaGetAttribute("href",t);const m=U;if(U!==null&&this._links!==!0)if(U.startsWith("{{")&&U.indexOf("}}")===U.length-2){const Y=U.slice(2,-2);U=this._links[Y],assert&&Xc.push(Y)}else U=null;assert&&assert(U,`Could not find a matching item in RichText's links for ${m}. It should be provided in the links option, or links should be turned to true (to allow the string to create its own urls`),U&&(this._linkFill!==null&&(s=this._linkFill),t.innerContent||(t.innerContent=pn.himalayaElementToAccessibleString(t,n)),this._linkItems.push({element:t,node:f,href:U}))}else t.tagName==="b"||t.tagName==="strong"?i=(typeof i=="string"?ss.fromCSS(i):i).copy({weight:"bold"}):t.tagName==="i"||t.tagName==="em"?i=(typeof i=="string"?ss.fromCSS(i):i).copy({style:"italic"}):t.tagName==="sub"?(f.scale(this._subScale),f.addExtraBeforeSpacing(this._subXSpacing),f.y+=this._subYOffset):t.tagName==="sup"&&(f.scale(this._supScale),f.addExtraBeforeSpacing(this._supXSpacing),f.y+=this._supYOffset);const z=f.getScaleVector().x;if(t.tagName!=="node"){for(;p===wn.NONE&&t.children.length;){const U=f.bounds.isValid()?f.width:0,m=t.children[0];p=this.appendElement(f,m,i,s,n,o/z,c*z),p!==wn.INCOMPLETE&&t.children.splice(0,1);const Y=f.bounds.isValid()?f.width:0;o+=U-Y}p===wn.COMPLETE&&t.children.length&&(p=wn.INCOMPLETE)}if(t.tagName==="sub")isFinite(f.height)&&(f.centerY=0);else if(t.tagName==="sup")isFinite(f.height)&&(f.centerY=Us.scratchText.setString("X").setFont(i).top*this._capHeightScale);else if(t.tagName==="u"){const U=-f.top*this._underlineHeightScale;isFinite(f.top)&&f.addChild(new hr(f.localLeft,U,f.localRight,U,{stroke:s,lineWidth:this._underlineLineWidth}))}else if(t.tagName==="s"){const U=f.top*this._strikethroughHeightScale;isFinite(f.top)&&f.addChild(new hr(f.localLeft,U,f.localRight,U,{stroke:s,lineWidth:this._strikethroughLineWidth}))}sceneryLog&&sceneryLog.RichText&&sceneryLog.pop()}return f&&(e.addElement(f)||(this._linkItems=this._linkItems.filter(z=>z.node!==f),f.clean())),p}setString(e){return assert&&assert(e!=null,"String should be defined and non-null. Use the empty string if needed."),e=`${e}`,this._stringProperty.set(e),this}set string(e){this.setString(e)}get string(){return this.getString()}getString(){return this._stringProperty.value}setBoundsMethod(e){return assert&&assert(e==="fast"||e==="fastCanvas"||e==="accurate"||e==="hybrid","Unknown Text boundsMethod"),e!==this._boundsMethod&&(this._boundsMethod=e,this.rebuildRichText()),this}set boundsMethod(e){this.setBoundsMethod(e)}get boundsMethod(){return this.getBoundsMethod()}getBoundsMethod(){return this._boundsMethod}setFont(e){return this._font!==e&&(this._font=e,this.rebuildRichText()),this}set font(e){this.setFont(e)}get font(){return this.getFont()}getFont(){return this._font}setFill(e){return this._fill!==e&&(this._fill=e,this.rebuildRichText()),this}set fill(e){this.setFill(e)}get fill(){return this.getFill()}getFill(){return this._fill}setStroke(e){return this._stroke!==e&&(this._stroke=e,this.rebuildRichText()),this}set stroke(e){this.setStroke(e)}get stroke(){return this.getStroke()}getStroke(){return this._stroke}setLineWidth(e){return this._lineWidth!==e&&(this._lineWidth=e,this.rebuildRichText()),this}set lineWidth(e){this.setLineWidth(e)}get lineWidth(){return this.getLineWidth()}getLineWidth(){return this._lineWidth}setSubScale(e){return assert&&assert(isFinite(e)&&e>0),this._subScale!==e&&(this._subScale=e,this.rebuildRichText()),this}set subScale(e){this.setSubScale(e)}get subScale(){return this.getSubScale()}getSubScale(){return this._subScale}setSubXSpacing(e){return assert&&assert(isFinite(e)),this._subXSpacing!==e&&(this._subXSpacing=e,this.rebuildRichText()),this}set subXSpacing(e){this.setSubXSpacing(e)}get subXSpacing(){return this.getSubXSpacing()}getSubXSpacing(){return this._subXSpacing}setSubYOffset(e){return assert&&assert(isFinite(e)),this._subYOffset!==e&&(this._subYOffset=e,this.rebuildRichText()),this}set subYOffset(e){this.setSubYOffset(e)}get subYOffset(){return this.getSubYOffset()}getSubYOffset(){return this._subYOffset}setSupScale(e){return assert&&assert(isFinite(e)&&e>0),this._supScale!==e&&(this._supScale=e,this.rebuildRichText()),this}set supScale(e){this.setSupScale(e)}get supScale(){return this.getSupScale()}getSupScale(){return this._supScale}setSupXSpacing(e){return assert&&assert(isFinite(e)),this._supXSpacing!==e&&(this._supXSpacing=e,this.rebuildRichText()),this}set supXSpacing(e){this.setSupXSpacing(e)}get supXSpacing(){return this.getSupXSpacing()}getSupXSpacing(){return this._supXSpacing}setSupYOffset(e){return assert&&assert(isFinite(e)),this._supYOffset!==e&&(this._supYOffset=e,this.rebuildRichText()),this}set supYOffset(e){this.setSupYOffset(e)}get supYOffset(){return this.getSupYOffset()}getSupYOffset(){return this._supYOffset}setCapHeightScale(e){return assert&&assert(isFinite(e)&&e>0),this._capHeightScale!==e&&(this._capHeightScale=e,this.rebuildRichText()),this}set capHeightScale(e){this.setCapHeightScale(e)}get capHeightScale(){return this.getCapHeightScale()}getCapHeightScale(){return this._capHeightScale}setUnderlineLineWidth(e){return assert&&assert(isFinite(e)&&e>0),this._underlineLineWidth!==e&&(this._underlineLineWidth=e,this.rebuildRichText()),this}set underlineLineWidth(e){this.setUnderlineLineWidth(e)}get underlineLineWidth(){return this.getUnderlineLineWidth()}getUnderlineLineWidth(){return this._underlineLineWidth}setUnderlineHeightScale(e){return assert&&assert(isFinite(e)&&e>0),this._underlineHeightScale!==e&&(this._underlineHeightScale=e,this.rebuildRichText()),this}set underlineHeightScale(e){this.setUnderlineHeightScale(e)}get underlineHeightScale(){return this.getUnderlineHeightScale()}getUnderlineHeightScale(){return this._underlineHeightScale}setStrikethroughLineWidth(e){return assert&&assert(isFinite(e)&&e>0),this._strikethroughLineWidth!==e&&(this._strikethroughLineWidth=e,this.rebuildRichText()),this}set strikethroughLineWidth(e){this.setStrikethroughLineWidth(e)}get strikethroughLineWidth(){return this.getStrikethroughLineWidth()}getStrikethroughLineWidth(){return this._strikethroughLineWidth}setStrikethroughHeightScale(e){return assert&&assert(isFinite(e)&&e>0),this._strikethroughHeightScale!==e&&(this._strikethroughHeightScale=e,this.rebuildRichText()),this}set strikethroughHeightScale(e){this.setStrikethroughHeightScale(e)}get strikethroughHeightScale(){return this.getStrikethroughHeightScale()}getStrikethroughHeightScale(){return this._strikethroughHeightScale}setLinkFill(e){return this._linkFill!==e&&(this._linkFill=e,this.rebuildRichText()),this}set linkFill(e){this.setLinkFill(e)}get linkFill(){return this.getLinkFill()}getLinkFill(){return this._linkFill}setLinkEventsHandled(e){return this._linkEventsHandled!==e&&(this._linkEventsHandled=e,this.rebuildRichText()),this}set linkEventsHandled(e){this.setLinkEventsHandled(e)}get linkEventsHandled(){return this.getLinkEventsHandled()}getLinkEventsHandled(){return this._linkEventsHandled}setLinks(e){return assert&&assert(e===!0||Object.getPrototypeOf(e)===Object.prototype),this._links!==e&&(this._links=e,this.rebuildRichText()),this}getLinks(){return this._links}set links(e){this.setLinks(e)}get links(){return this.getLinks()}setNodes(e){return assert&&assert(Object.getPrototypeOf(e)===Object.prototype),this._nodes!==e&&(this._nodes=e,this.rebuildRichText()),this}getNodes(){return this._nodes}set nodes(e){this.setNodes(e)}get nodes(){return this.getNodes()}setReplaceNewlines(e){return this._replaceNewlines!==e&&(this._replaceNewlines=e,this.rebuildRichText()),this}set replaceNewlines(e){this.setReplaceNewlines(e)}get replaceNewlines(){return this.getReplaceNewlines()}getReplaceNewlines(){return this._replaceNewlines}setAlign(e){return assert&&assert(e==="left"||e==="center"||e==="right"),this._align!==e&&(this._align=e,this.rebuildRichText()),this}set align(e){this.setAlign(e)}get align(){return this.getAlign()}getAlign(){return this._align}setLeading(e){return assert&&assert(isFinite(e)),this._leading!==e&&(this._leading=e,this.rebuildRichText()),this}set leading(e){this.setLeading(e)}get leading(){return this.getLeading()}getLeading(){return this._leading}setLineWrap(e){return assert&&assert(e===null||e==="stretch"||isFinite(e)&&e>0),this._lineWrap!==e&&(this._lineWrap=e,this.rebuildRichText()),this}set lineWrap(e){this.setLineWrap(e)}get lineWrap(){return this.getLineWrap()}getLineWrap(){return this._lineWrap}mutate(e){return assert&&e&&e.hasOwnProperty("string")&&e.hasOwnProperty(gs.STRING_PROPERTY_NAME)&&e.stringProperty&&assert&&assert(e.stringProperty.value===e.string,"If both string and stringProperty are provided, then values should match"),super.mutate(e)}static stringWithFont(e,t){return`<span style='font-style: ${t.style};font-variant: ${t.variant};font-weight: ${t.weight};font-stretch: ${t.stretch};font-size: ${t.size};font-family: ${t.family};line-height: ${t.lineHeight};'>${e}</span>`}static himalayaElementToString(e,t){if(qc(e))return pn.contentToString(e.content,t);if(Kc(e)){const i=Us.himalayaGetAttribute("dir",e);return e.tagName==="span"&&i&&(t=i==="ltr"),e.children.map(s=>pn.himalayaElementToString(s,t)).join("")}else return""}static himalayaElementToAccessibleString(e,t){if(qc(e))return pn.contentToString(e.content,t);if(Kc(e)){const i=Us.himalayaGetAttribute("dir",e);e.tagName==="span"&&i&&(t=i==="ltr");const s=e.children.map(n=>pn.himalayaElementToAccessibleString(n,t)).join("");return _.includes(z0,e.tagName)?`<${e.tagName}>${s}</${e.tagName}>`:s}else return""}static contentToString(e,t){const i=he.decode(e);return t?`${i}`:`${i}`}};pn.STRING_PROPERTY_TANDEM_NAME=gs.STRING_PROPERTY_TANDEM_NAME;let ur=pn;ur.prototype._mutatorKeys=H0.concat(tt.prototype._mutatorKeys);te.register("RichText",ur);ur.RichTextIO=new Ai("RichTextIO",{valueType:ur,supertype:tt.NodeIO,documentation:"The PhET-iO Type for the scenery RichText node"});class G0 extends Ld(gs){constructor(e,t){const i=st()({readingBlockNameResponse:e,tagName:"p",innerContent:e},t);super(e),this.focusHighlight=new Yh(this),this.mutate(i)}}te.register("VoicingText",G0);class W0 extends Ld(ur){constructor(e,t){const i=st()({readingBlockNameResponse:e,innerContent:e,readingBlockTagName:"button"},t);super(e,i),this.focusHighlight=new Yh(this)}}te.register("VoicingRichText",W0);const Ji=h=>{if(h instanceof Pe)return{type:"Vector2",x:h.x,y:h.y};if(h instanceof Ze)return{type:"Matrix3",m00:h.m00(),m01:h.m01(),m02:h.m02(),m10:h.m10(),m11:h.m11(),m12:h.m12(),m20:h.m20(),m21:h.m21(),m22:h.m22()};if(h instanceof $e){const e=h;return{type:"Bounds2",maxX:e.maxX,maxY:e.maxY,minX:e.minX,minY:e.minY}}else{if(h instanceof kt)return{type:"Shape",path:h.getSVGPath()};if(Array.isArray(h))return{type:"Array",value:h.map(Ji)};if(h instanceof qe)return{type:"Color",red:h.red,green:h.green,blue:h.blue,alpha:h.alpha};if(h instanceof an)return{type:"Property",value:Ji(h.value)};if(h instanceof Nt)return{type:"TinyProperty",value:Ji(h.value)};if(mn&&h instanceof mn){const e={};return h.transformMatrix&&(e.transformMatrix=Ji(h.transformMatrix)),Vs&&(h instanceof Ga||h instanceof $a)&&(e.stops=h.stops.map(t=>({ratio:t.ratio,stop:Ji(t.color)})),e.start=Ji(h.start),e.end=Ji(h.end),$a&&h instanceof $a?e.type="LinearGradient":Ga&&h instanceof Ga&&(e.type="RadialGradient",e.startRadius=h.startRadius,e.endRadius=h.endRadius)),Hr&&h instanceof Hr&&(e.type="Pattern",e.url=h.image.src),e}else if(h instanceof tt){const e=h,t={},i={};["visible","opacity","disabledOpacity","pickable","inputEnabled","cursor","transformBounds","renderer","usesOpacity","layerSplit","cssTransform","excludeInvisible","webglScale","preventFit"].forEach(n=>{e[n]!==tt.DEFAULT_NODE_OPTIONS[n]&&(t[n]=e[n])}),["tagName","innerContent","accessibleName","helpText"].forEach(n=>{e[n]!==null&&(t[n]=e[n])}),["maxWidth","maxHeight","clipArea","mouseArea","touchArea"].forEach(n=>{e[n]!==tt.DEFAULT_NODE_OPTIONS[n]&&(i[n]=Ji(e[n]))}),e.matrix.isIdentity()||(i.matrix=Ji(e.matrix)),e._localBoundsOverridden&&(i.localBounds=Ji(e.localBounds)),i.children=e.children.map(n=>n.id),i.hasInputListeners=e.inputListeners.length>0;const s={id:e.id,type:"Node",types:Xs(e.constructor).map(n=>n.name).filter(n=>n&&n!=="Object"&&n!=="Node"),name:e.constructor.name,options:t,setup:i};if(Fi&&e instanceof Fi&&(s.type="Path",i.path=Ji(e.shape),e.boundsMethod!==Fi.DEFAULT_PATH_OPTIONS.boundsMethod&&(t.boundsMethod=e.boundsMethod)),to&&e instanceof to&&(s.type="Circle",t.radius=e.radius),hr&&e instanceof hr&&(s.type="Line",t.x1=e.x1,t.y1=e.y1,t.x2=e.x2,t.y2=e.y2),$i&&e instanceof $i&&(s.type="Rectangle",t.rectX=e.rectX,t.rectY=e.rectY,t.rectWidth=e.rectWidth,t.rectHeight=e.rectHeight,t.cornerXRadius=e.cornerXRadius,t.cornerYRadius=e.cornerYRadius),gs&&e instanceof gs&&(s.type="Text",e.boundsMethod!=="hybrid"&&(t.boundsMethod=e.boundsMethod),t.string=e.string,t.font=e.font),Ls&&e instanceof Ls&&(s.type="Image",["imageOpacity","initialWidth","initialHeight","mipmapBias","mipmapInitialLevel","mipmapMaxLevel"].forEach(n=>{e[n]!==Ls.DEFAULT_IMAGE_OPTIONS[n]&&(t[n]=e[n])}),i.width=e.imageWidth,i.height=e.imageHeight,e._mipmapData?(i.imageType="mipmapData",i.mipmapData=e._mipmapData.map(n=>({url:n.url,width:n.width,height:n.height}))):(e._mipmap&&(i.generateMipmaps=!0),e._image instanceof HTMLImageElement?(i.imageType="image",i.src=e._image.src):e._image instanceof HTMLCanvasElement&&(i.imageType="canvas",i.src=e._image.toDataURL()))),ha&&e instanceof ha||Gn&&e instanceof Gn){s.type=ha&&e instanceof ha?"CanvasNode":"WebGLNode",i.canvasBounds=Ji(e.canvasBounds);const n=1,o=document.createElement("canvas");o.width=Math.ceil(e.canvasBounds.width*n),o.height=Math.ceil(e.canvasBounds.height*n);const c=o.getContext("2d"),p=new Rr(o,c),f=Ze.scale(1/n);p.context.setTransform(n,0,0,n,-e.canvasBounds.left,-e.canvasBounds.top),e.renderToCanvasSelf(p,f),i.url=o.toDataURL(),i.scale=n,i.offset=Ji(e.canvasBounds.leftTop)}return Ll&&e instanceof Ll&&(s.type="DOM",s.element=new self.XMLSerializer().serializeToString(e.element),e.element instanceof self.HTMLCanvasElement&&(s.dataURL=e.element.toDataURL()),t.preventTransform=e.preventTransform),(Fi&&e instanceof Fi||gs&&e instanceof gs)&&(["fillPickable","strokePickable","lineWidth","lineCap","lineJoin","lineDashOffset","miterLimit"].forEach(n=>{e[n]!==kr[n]&&(t[n]=e[n])}),e.fill!==kr.fill&&(i.fill=Ji(e.fill)),e.stroke!==kr.stroke&&(i.stroke=Ji(e.stroke)),e.lineDash.length&&(i.lineDash=Ji(e.lineDash))),s}else return h instanceof cs?{type:"Display",width:h.width,height:h.height,backgroundColor:Ji(h.backgroundColor),tree:{type:"Subtree",rootNodeId:h.rootNode.id,nodes:Ly(h.rootNode)}}:{type:"value",value:h}}},Ly=h=>h.getSubtreeNodes().map(Ji);te.register("scenerySerialize",Ji);const os=h=>{const e=["Node","Path","Circle","Line","Rectangle","Text","Image","CanvasNode","WebGLNode","DOM"];if(h.type==="Vector2")return new Pe(h.x,h.y);if(h.type==="Matrix3")return new Ze().rowMajor(h.m00,h.m01,h.m02,h.m10,h.m11,h.m12,h.m20,h.m21,h.m22);if(h.type==="Bounds2")return new $e(h.minX,h.minY,h.maxX,h.maxY);if(h.type==="Shape")return new kt(h.path);if(h.type==="Array")return h.value.map(os);if(h.type==="Color")return new qe(h.red,h.green,h.blue,h.alpha);if(h.type==="Property")return new wi(os(h.value));if(h.type==="TinyProperty")return new Nt(os(h.value));if(h.type==="Pattern"||h.type==="LinearGradient"||h.type==="RadialGradient"){let t;if(h.type==="Pattern"){const i=new self.Image;i.src=h.url,t=new Hr(i)}else{const i=os(h.start),s=os(h.end);h.type==="LinearGradient"?t=new $a(i.x,i.y,s.x,s.y):h.type==="RadialGradient"&&(t=new Ga(i.x,i.y,h.startRadius,s.x,s.y,h.endRadius)),h.stops.forEach(n=>{t.addColorStop(n.ratio,os(n.stop))})}return h.transformMatrix&&t.setTransformMatrix(os(h.transformMatrix)),t}else if(_.includes(e,h.type)){let t;const i=h.setup;if(h.type==="Node")t=new tt;else if(h.type==="Path")t=new Fi(os(i.path));else if(h.type==="Circle")t=new to({});else if(h.type==="Line")t=new hr({});else if(h.type==="Rectangle")t=new $i({});else if(h.type==="Text")t=new gs("");else if(h.type==="Image"){if(i.imageType==="image"||i.imageType==="canvas")t=new Ls(i.src),i.generateMipmaps&&(t.mipmap=!0);else if(i.imageType==="mipmapData"){const s=i.mipmapData.map(n=>{const o={width:n.width,height:n.height,url:n.url};o.img=new self.Image,o.img.src=n.url,o.canvas=document.createElement("canvas"),o.canvas.width=n.width,o.canvas.height=n.height;const c=o.canvas.getContext("2d");return o.updateCanvas=function(){o.img.complete&&(typeof o.img.naturalWidth>"u"||o.img.naturalWidth>0)&&(c.drawImage(o.img,0,0),delete o.updateCanvas)},o});t=new Ls(s)}t.initialWidth=i.width,t.initialHeight=i.height}else if(h.type==="CanvasNode"||h.type==="WebGLNode")t=new tt({children:[new Ls(i.url,{translation:os(i.offset),scale:1/i.scale})]});else if(h.type==="DOM"){const s=document.createElement("div");s.innerHTML=h.element;const n=s.childNodes[0];if(s.removeChild(n),h.dataURL){const o=new self.Image;o.onload=()=>{n.getContext("2d").drawImage(o,0,0)},o.src=h.dataURL}t=new Ll(n)}return i.clipArea&&(t.clipArea=os(i.clipArea)),i.mouseArea&&(t.mouseArea=os(i.mouseArea)),i.touchArea&&(t.touchArea=os(i.touchArea)),i.matrix&&(t.matrix=os(i.matrix)),i.localBounds&&(t.localBounds=os(i.localBounds)),i.fill&&(t.fill=os(i.fill)),i.stroke&&(t.stroke=os(i.stroke)),i.lineDash&&(t.lineDash=os(i.lineDash)),t.mutate(h.options),t._serialization=h,t}else if(h.type==="Subtree"){const t={},i=h.nodes.map(os);return i.forEach(s=>{t[s._serialization.id]=s}),i.forEach(s=>{s._serialization.setup.children.forEach(n=>{s.addChild(t[n])})}),t[h.rootNodeId]}else return h.type==="value"?h.value:null};te.register("sceneryDeserialize",os);const U0=h=>os(Ji(h));te.register("sceneryCopy",U0);let Y0=1;class Zi{initialize(e){return assert&&assert(!this.id||this.isDisposed,"If we previously existed, we need to have been disposed"),this.id=this.id||Y0++,sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`[${this.constructor.name}*] initialize ${this.toString()}`),this.clean(),this.renderer=e,this.dirty=!0,this.isDisposed=!1,this.linksDirty=!1,this.visibleProperty=new Nt(!0),this.fittableProperty=new Nt(!0),this}clean(){this.parentDrawable=null,this.backbone=null,this.pendingParentDrawable=null,this.pendingBackbone=null,this.pendingAddition=!1,this.pendingRemoval=!1,assert&&assert(!this.previousDrawable&&!this.nextDrawable,"By cleaning (disposal or fresh creation), we should have disconnected from the linked list"),this.previousDrawable=null,this.nextDrawable=null,this.oldPreviousDrawable=null,this.oldNextDrawable=null,this.visibleProperty&&this.visibleProperty.removeAllListeners(),this.fittableProperty&&this.fittableProperty.removeAllListeners()}update(){let e=!1;return this.dirty&&!this.isDisposed&&(this.dirty=!1,e=!0),e}setVisible(e){this.visibleProperty.value=e}set visible(e){this.setVisible(e)}isVisible(){return this.visibleProperty.value}get visible(){return this.isVisible()}setFittable(e){this.fittableProperty.value=e}set fittable(e){this.setFittable(e)}isFittable(){return this.fittableProperty.value}get fittable(){return this.isFittable()}setBlockBackbone(e){sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`[${this.constructor.name}*] setBlockBackbone ${this.toString()} with ${e.toString()}`),assert&&assert(this instanceof Nr),this.parentDrawable=e,this.backbone=e,this.pendingParentDrawable=e,this.pendingBackbone=e,this.pendingAddition=!1,this.pendingRemoval=!1}notePendingAddition(e,t,i){sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`[${this.constructor.name}*] notePendingAddition ${this.toString()} with ${t.toString()}, ${i?i.toString():"-"}`),assert&&assert(i!==void 0,"backbone can be either null or a backbone"),assert&&assert(t instanceof Nr),this.pendingParentDrawable=t,this.pendingBackbone=i,this.pendingAddition=!0,this.pendingRemoval||e.markDrawableChangedBlock(this)}notePendingRemoval(e){sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`[${this.constructor.name}*] notePendingRemoval ${this.toString()}`),this.pendingRemoval=!0,this.pendingAddition||e.markDrawableChangedBlock(this)}notePendingMove(e,t){sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`[${this.constructor.name}*] notePendingMove ${this.toString()} with ${t.toString()}`),assert&&assert(t instanceof Nr),this.pendingParentDrawable=t,(!this.pendingRemoval||!this.pendingAddition)&&e.markDrawableChangedBlock(this),this.pendingAddition=!0,this.pendingRemoval=!0}updateBlock(){sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`[${this.constructor.name}*] updateBlock ${this.toString()} with add:${this.pendingAddition} remove:${this.pendingRemoval} old:${this.parentDrawable?this.parentDrawable.toString():"-"} new:${this.pendingParentDrawable?this.pendingParentDrawable.toString():"-"}`),sceneryLog&&sceneryLog.Drawable&&sceneryLog.push();let e=!1;return(this.pendingRemoval||this.pendingAddition)&&(e=!this.pendingRemoval||!this.pendingAddition||this.parentDrawable!==this.pendingParentDrawable||this.backbone!==this.pendingBackbone,e?(this.pendingRemoval&&(sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`removing from ${this.parentDrawable.toString()}`),this.parentDrawable.removeDrawable(this),this.pendingAddition||(this.pendingParentDrawable=null,this.pendingBackbone=null)),this.parentDrawable=this.pendingParentDrawable,this.backbone=this.pendingBackbone,this.pendingAddition&&(sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`adding to ${this.parentDrawable.toString()}`),this.parentDrawable.addDrawable(this))):(sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable("unchanged"),this.pendingAddition&&de.isCanvas(this.renderer)&&this.parentDrawable.onPotentiallyMovedDrawable(this)),this.pendingAddition=!1,this.pendingRemoval=!1),sceneryLog&&sceneryLog.Drawable&&sceneryLog.pop(),e}updateLinks(){this.oldNextDrawable=this.nextDrawable,this.oldPreviousDrawable=this.previousDrawable,this.linksDirty=!1}markDirty(){this.dirty||(this.dirty=!0,this.parentDrawable&&this.parentDrawable.markDirtyDrawable(this))}markLinksDirty(e){this.linksDirty||(this.linksDirty=!0,e.markDrawableForLinksUpdate(this))}markForDisposal(e){Zi.disconnectBefore(this,e),Zi.disconnectAfter(this,e),e.markDrawableForDisposal(this)}disposeImmediately(e){Zi.disconnectBefore(this,e),Zi.disconnectAfter(this,e),this.dispose()}dispose(){assert&&assert(!this.isDisposed,"We should not re-dispose drawables"),sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`[${this.constructor.name}*] dispose ${this.toString()}`),sceneryLog&&sceneryLog.Drawable&&sceneryLog.push(),this.clean(),this.isDisposed=!0,this.freeToPool(),sceneryLog&&sceneryLog.Drawable&&sceneryLog.pop()}audit(e,t,i){assertSlow&&(assertSlow&&assertSlow(!this.isDisposed,"If we are being audited, we assume we are in the drawable display tree, and we should not be marked as disposed"),assertSlow&&assertSlow(this.renderer,"Should not have a 0 (no) renderer"),assertSlow&&assertSlow(!this.backbone||this.parentDrawable,"If we have a backbone reference, we must have a parentDrawable (our block)"),e||(assertSlow&&assertSlow(!this.pendingAddition),assertSlow&&assertSlow(!this.pendingRemoval),assertSlow&&assertSlow(this.parentDrawable===this.pendingParentDrawable,"Assure our parent and pending parent match, if we have updated blocks"),assertSlow&&assertSlow(this.backbone===this.pendingBackbone,"Assure our backbone and pending backbone match, if we have updated blocks")),t||(assertSlow&&assertSlow(this.oldPreviousDrawable===this.previousDrawable,"Pending linked-list references should be cleared by now"),assertSlow&&assertSlow(this.oldNextDrawable===this.nextDrawable,"Pending linked-list references should be cleared by now"),assertSlow&&assertSlow(!this.linksDirty,"Links dirty flag should be clean")),i||assertSlow&&assertSlow(!this.dirty,"Should not be dirty at this phase, if we are in the drawable display tree"))}toString(){return`${this.constructor.name}#${this.id}`}toDetailedString(){return this.toString()}static connectDrawables(e,t,i){e.nextDrawable!==t&&(e.nextDrawable&&(e.nextDrawable.markLinksDirty(i),e.nextDrawable.previousDrawable=null),t.previousDrawable&&(t.previousDrawable.markLinksDirty(i),t.previousDrawable.nextDrawable=null),e.nextDrawable=t,t.previousDrawable=e,e.markLinksDirty(i),t.markLinksDirty(i))}static disconnectBefore(e,t){e.previousDrawable&&(e.markLinksDirty(t),e.previousDrawable.markLinksDirty(t),e.previousDrawable.nextDrawable=null,e.previousDrawable=null)}static disconnectAfter(e,t){e.nextDrawable&&(e.markLinksDirty(t),e.nextDrawable.markLinksDirty(t),e.nextDrawable.previousDrawable=null,e.nextDrawable=null)}static listToArray(e,t){const i=[];for(let s=e;i.push(s),s!==t;s=s.nextDrawable);return i}static oldListToArray(e,t){const i=[];for(let s=e;i.push(s),s!==t;s=s.oldNextDrawable);return i}}te.register("Drawable",Zi);class js extends Zi{constructor(e,t){assert&&assert(typeof e=="number"),assert&&assert(t),super(),this.initialize(e,t)}initialize(e,t){return super.initialize(e),this.drawableVisibilityListener=this.drawableVisibilityListener||this.updateSelfVisibility.bind(this),this.instance=t,this.node=t.trail.lastNode(),this.node.attachDrawable(this),this.instance.selfVisibleEmitter.addListener(this.drawableVisibilityListener),this.updateSelfVisibility(),this}dispose(){this.instance.selfVisibleEmitter.removeListener(this.drawableVisibilityListener),this.node.detachDrawable(this),this.instance=null,this.node=null,super.dispose()}updateSelfVisibility(){this.visible=this.instance.selfVisible}toDetailedString(){return`${this.toString()} (${this.instance.trail.toPathString()})`}}te.register("SelfDrawable",js);const Py=ns(h=>(assert&&assert(_.includes(Xs(h),js)),class extends h{initialize(e,t,...i){super.initialize(e,t,...i),this.fillCallback=this.fillCallback||this.markDirtyFill.bind(this),this.strokeCallback=this.strokeCallback||this.markDirtyStroke.bind(this),this.fillObserver=this.fillObserver||new io(this.fillCallback),this.strokeObserver=this.strokeObserver||new io(this.strokeCallback),this.fillObserver.setPrimary(t.node._fill),this.strokeObserver.setPrimary(t.node._stroke)}dispose(){this.fillObserver.clean(),this.strokeObserver.clean(),super.dispose()}markDirtyFill(){assert&&qe.checkPaint(this.instance.node._fill),this.markPaintDirty(),this.fillObserver.setPrimary(this.instance.node._fill)}markDirtyStroke(){assert&&qe.checkPaint(this.instance.node._stroke),this.markPaintDirty(),this.strokeObserver.setPrimary(this.instance.node._stroke)}markDirtyLineWidth(){this.markPaintDirty()}markDirtyLineOptions(){this.markPaintDirty()}markDirtyCachedPaints(){this.markPaintDirty()}}));te.register("PaintableStatelessDrawable",Py);const kl=Py,ho=ns(h=>(assert&&assert(_.includes(Xs(h),js)),class extends h{initialize(e,t,...i){super.initialize(e,t,...i),this.dirtyFill=!0,this.hadStroke=!1,this.dirtyStroke=!0,this.dirtyLineWidth=!0,this.dirtyLineOptions=!0,this.dirtyCachedPaints=!0,this.lastCachedPaints=[],this.fillCallback=this.fillCallback||this.markDirtyFill.bind(this),this.strokeCallback=this.strokeCallback||this.markDirtyStroke.bind(this),this.fillObserver=this.fillObserver||new io(this.fillCallback),this.strokeObserver=this.strokeObserver||new io(this.strokeCallback),this.fillObserver.setPrimary(t.node._fill),this.strokeObserver.setPrimary(t.node._stroke)}cleanPaintableState(){this.dirtyFill=!1,this.dirtyStroke=!1,this.dirtyLineWidth=!1,this.dirtyLineOptions=!1,this.dirtyCachedPaints=!1,this.hadStroke=this.node.getStroke()!==null}dispose(){super.dispose(),this.fillObserver.clean(),this.strokeObserver.clean()}markDirtyFill(){assert&&qe.checkPaint(this.instance.node._fill),this.dirtyFill=!0,this.markPaintDirty(),this.fillObserver.setPrimary(this.instance.node._fill)}markDirtyStroke(){assert&&qe.checkPaint(this.instance.node._stroke),this.dirtyStroke=!0,this.markPaintDirty(),this.strokeObserver.setPrimary(this.instance.node._stroke)}markDirtyLineWidth(){this.dirtyLineWidth=!0,this.markPaintDirty()}markDirtyLineOptions(){this.dirtyLineOptions=!0,this.markPaintDirty()}markDirtyCachedPaints(){this.dirtyCachedPaints=!0,this.markPaintDirty()}}));te.register("PaintableStatefulDrawable",ho);class dr extends js{initialize(e,t){super.initialize(e,t),this.transformListener=this.transformListener||this.markTransformDirty.bind(this),t.relativeTransform.addListener(this.transformListener),t.relativeTransform.addPrecompute()}markTransformDirty(){this.markDirty()}markPaintDirty(){this.markDirty()}updateSelfVisibility(){super.updateSelfVisibility(),this.markDirty()}dispose(){this.instance.relativeTransform.removeListener(this.transformListener),this.instance.relativeTransform.removePrecompute(),super.dispose()}}te.register("CanvasSelfDrawable",dr);class co extends js{initialize(e,t){return super.initialize(e,t),this.transformListener=this.transformListener||this.markTransformDirty.bind(this),this.markTransformDirty(),this.visibilityDirty=!0,t.relativeTransform.addListener(this.transformListener),t.relativeTransform.addPrecompute(),this}markTransformDirty(){this.transformDirty=!0,this.markDirty()}getTransformMatrix(){return this.instance.relativeTransform.validate(),this.instance.relativeTransform.matrix}update(){return super.update()?(this.updateDOM(),this.visibilityDirty&&(this.visibilityDirty=!1,this.domElement.style.visibility=this.visible?"":"hidden"),this.cleanPaintableState&&this.cleanPaintableState(),!0):!1}updateDOM(){}updateSelfVisibility(){super.updateSelfVisibility(),this.visibilityDirty||(this.visibilityDirty=!0,this.markDirty())}dispose(){this.instance.relativeTransform.removeListener(this.transformListener),this.instance.relativeTransform.removePrecompute(),super.dispose()}}te.register("DOMSelfDrawable",co);class _a extends js{initialize(e,t,i,s){return assert&&assert(typeof i=="boolean"),assert&&assert(typeof s=="boolean"),super.initialize(e,t),this.usesPaint=i,this.keepElements=s,this.svgElement=null,this.svgBlock=null,this.usesPaint&&(this.paintState?this.paintState.initialize():this.paintState=new Om),this}update(){return super.update()?(this.updateSVG(),!0):!1}updateSVG(){if(this.paintDirty&&this.updateSVGSelf(this.node,this.svgElement),this.usesPaint&&this.dirtyCachedPaints){const e=this.node._cachedPaints.slice();let t,i;for(t=0;t<e.length;t++){const s=e[t];let n=!0;for(i=0;i<this.lastCachedPaints.length;i++)if(s===this.lastCachedPaints[i]){n=!1;break}n&&this.svgBlock.incrementPaint(s)}for(t=0;t<this.lastCachedPaints.length;t++){const s=this.lastCachedPaints[t];let n=!0;for(i=0;i<e.length;i++)if(s===e[i]){n=!1;break}n&&this.svgBlock.decrementPaint(s)}this.lastCachedPaints=e}this.setToCleanState()}updateFillStrokeStyle(e){if(!this.usesPaint)return;this.dirtyFill&&this.paintState.updateFill(this.svgBlock,this.node.getFillValue()),this.dirtyStroke&&this.paintState.updateStroke(this.svgBlock,this.node.getStrokeValue());const t=this.dirtyLineWidth||this.dirtyLineOptions;t&&this.paintState.updateStrokeDetailStyle(this.node),(this.dirtyFill||this.dirtyStroke||t)&&e.setAttribute("style",this.paintState.baseStyle+this.paintState.strokeDetailStyle),this.cleanPaintableState()}updateSVGBlock(e){const t=this.svgBlock;if(this.usesPaint&&t)for(let i=0;i<this.lastCachedPaints.length;i++)t.decrementPaint(this.lastCachedPaints[i]);if(this.svgBlock=e,this.usesPaint)for(let i=0;i<this.lastCachedPaints.length;i++)e.incrementPaint(this.lastCachedPaints[i]);this.updateDefsSelf&&this.updateDefsSelf(e),this.usesPaint&&this.paintState.updateSVGBlock(e),this.usesPaint&&this.markDirtyFill(),this.usesPaint&&this.markDirtyStroke()}dispose(){this.keepElements||(this.svgElement=null),this.updateDefsSelf&&this.updateDefsSelf(null),this.usesPaint&&this.paintState.dispose(),this.defs=null,this.svgBlock=null,super.dispose()}}te.register("SVGSelfDrawable",_a);class Ol extends js{initialize(e,t){return super.initialize(e,t),this.transformListener=this.transformListener||this.markTransformDirty.bind(this),t.relativeTransform.addListener(this.transformListener),t.relativeTransform.addPrecompute(),this}markTransformDirty(){this.markDirty()}updateSelfVisibility(){super.updateSelfVisibility(),this.markDirty()}dispose(){this.instance.relativeTransform.removeListener(this.transformListener),this.instance.relativeTransform.removePrecompute(),super.dispose()}}te.register("WebGLSelfDrawable",Ol);const Rd=ns(h=>(assert&&assert(_.includes(Xs(h),js)),class extends ho(h){initialize(e,t,...i){super.initialize(e,t,...i),this.paintDirty=!0,this.dirtyRadius=!0}markPaintDirty(){this.paintDirty=!0,this.markDirty()}markDirtyRadius(){this.dirtyRadius=!0,this.markPaintDirty()}setToCleanState(){this.paintDirty=!1,this.dirtyRadius=!1}}));te.register("CircleStatefulDrawable",Rd);const Sy=ns(h=>(assert&&assert(_.includes(Xs(h),js)),class extends h{initialize(e,t,...i){super.initialize(e,t,...i),this.paintDirty=!0,this.dirtyImage=!0,this.dirtyImageOpacity=!0,this.dirtyMipmap=!0}markPaintDirty(){this.paintDirty=!0,this.markDirty()}markDirtyImage(){this.dirtyImage=!0,this.markPaintDirty()}markDirtyImageOpacity(){this.dirtyImageOpacity=!0,this.markPaintDirty()}markDirtyMipmap(){this.dirtyMipmap=!0,this.markPaintDirty()}setToCleanState(){this.paintDirty=!1,this.dirtyImage=!1,this.dirtyImageOpacity=!1,this.dirtyMipmap=!1}}));te.register("ImageStatefulDrawable",Sy);const Nd=Sy,wy=ns(h=>(assert&&assert(_.includes(Xs(h),js)),class extends kl(h){initialize(e,t,...i){super.initialize(e,t,...i),this.paintDirty=!0}markPaintDirty(){this.paintDirty=!0,this.markDirty()}markDirtyLine(){this.markPaintDirty()}markDirtyP1(){this.markPaintDirty()}markDirtyP2(){this.markPaintDirty()}markDirtyX1(){this.markPaintDirty()}markDirtyY1(){this.markPaintDirty()}markDirtyX2(){this.markPaintDirty()}markDirtyY2(){this.markPaintDirty()}}));te.register("LineStatelessDrawable",wy);const Cy=ns(h=>(assert&&assert(_.includes(Xs(h),js)),class extends ho(h){initialize(e,t,...i){super.initialize(e,t,...i),this.paintDirty=!0,this.dirtyX1=!0,this.dirtyY1=!0,this.dirtyX2=!0,this.dirtyY2=!0}markPaintDirty(){this.paintDirty=!0,this.markDirty()}markDirtyLine(){this.dirtyX1=!0,this.dirtyY1=!0,this.dirtyX2=!0,this.dirtyY2=!0,this.markPaintDirty()}markDirtyP1(){this.dirtyX1=!0,this.dirtyY1=!0,this.markPaintDirty()}markDirtyP2(){this.dirtyX2=!0,this.dirtyY2=!0,this.markPaintDirty()}markDirtyX1(){this.dirtyX1=!0,this.markPaintDirty()}markDirtyY1(){this.dirtyY1=!0,this.markPaintDirty()}markDirtyX2(){this.dirtyX2=!0,this.markPaintDirty()}markDirtyY2(){this.dirtyY2=!0,this.markPaintDirty()}setToCleanState(){this.paintDirty=!1,this.dirtyX1=!1,this.dirtyY1=!1,this.dirtyX2=!1,this.dirtyY2=!1}}));te.register("LineStatefulDrawable",Cy);const Ty=ns(h=>(assert&&assert(_.includes(Xs(h),js)),class extends ho(h){initialize(e,t,...i){super.initialize(e,t,...i),this.paintDirty=!0,this.dirtyShape=!0}markPaintDirty(){this.paintDirty=!0,this.markDirty()}markDirtyShape(){this.dirtyShape=!0,this.markPaintDirty()}setToCleanState(){this.paintDirty=!1,this.dirtyShape=!1}}));te.register("PathStatefulDrawable",Ty);const K0=Ty,jh=ns(h=>(assert&&assert(_.includes(Xs(h),js)),class extends ho(h){initialize(e,t,...i){super.initialize(e,t,...i),this.paintDirty=!0,this.dirtyX=!0,this.dirtyY=!0,this.dirtyWidth=!0,this.dirtyHeight=!0,this.dirtyCornerXRadius=!0,this.dirtyCornerYRadius=!0}markPaintDirty(){this.paintDirty=!0,this.markDirty()}markDirtyRectangle(){this.dirtyX=!0,this.dirtyY=!0,this.dirtyWidth=!0,this.dirtyHeight=!0,this.dirtyCornerXRadius=!0,this.dirtyCornerYRadius=!0,this.markPaintDirty()}markDirtyX(){this.dirtyX=!0,this.markPaintDirty()}markDirtyY(){this.dirtyY=!0,this.markPaintDirty()}markDirtyWidth(){this.dirtyWidth=!0,this.markPaintDirty()}markDirtyHeight(){this.dirtyHeight=!0,this.markPaintDirty()}markDirtyCornerXRadius(){this.dirtyCornerXRadius=!0,this.markPaintDirty()}markDirtyCornerYRadius(){this.dirtyCornerYRadius=!0,this.markPaintDirty()}setToCleanState(){this.paintDirty=!1,this.dirtyX=!1,this.dirtyY=!1,this.dirtyWidth=!1,this.dirtyHeight=!1,this.dirtyCornerXRadius=!1,this.dirtyCornerYRadius=!1}}));te.register("RectangleStatefulDrawable",jh);const xy=ns(h=>(assert&&assert(_.includes(Xs(h),js)),class extends ho(h){initialize(e,t,...i){super.initialize(e,t,...i),this.paintDirty=!0,this.dirtyText=!0,this.dirtyFont=!0,this.dirtyBounds=!0}markPaintDirty(){this.paintDirty=!0,this.markDirty()}markDirtyText(){this.dirtyText=!0,this.markPaintDirty()}markDirtyFont(){this.dirtyFont=!0,this.markPaintDirty()}markDirtyBounds(){this.dirtyBounds=!0,this.markPaintDirty()}setToCleanState(){this.paintDirty=!1,this.dirtyText=!1,this.dirtyFont=!1,this.dirtyBounds=!1}}));te.register("TextStatefulDrawable",xy);const Iy=xy,q0=[];class Bd extends dr{paintCanvas(e,t,i){if(assert&&assert(!t.selfBounds.isEmpty(),`CanvasNode should not be used with an empty canvasBounds. Please set canvasBounds (or use setCanvasBounds()) on ${t.constructor.name}`),!t.selfBounds.isEmpty()){const s=e.context;s.save(),s.fillStyle="black",s.strokeStyle="black",s.lineWidth=1,s.lineCap="butt",s.lineJoin="miter",s.lineDash=q0,s.lineDashOffset=0,s.miterLimit=10,t.paintCanvas(s),s.restore()}}}te.register("CanvasNodeDrawable",Bd);di.mixInto(Bd);const X0=Bd;class Fd extends kl(dr){paintCanvas(e,t,i){assert&&assert(t instanceof tt);const s=e.context;s.beginPath(),s.arc(0,0,t._radius,0,Math.PI*2,!1),s.closePath(),t.hasFill()&&(t.beforeCanvasFill(e),s.fill(),t.afterCanvasFill(e)),t.hasPaintableStroke()&&(t.beforeCanvasStroke(e),s.stroke(),t.afterCanvasStroke(e))}markDirtyRadius(){this.markPaintDirty()}dispose(){super.dispose()}}te.register("CircleCanvasDrawable",Fd);di.mixInto(Fd);const nf=Fd;class Hd extends Rd(co){constructor(e,t){super(e,t),Yt.prepareForTransform(this.domElement)}initialize(e,t){if(super.initialize(e,t),this.matrix=this.matrix||Ze.pool.fetch(),!this.fillElement||!this.strokeElement){const i=document.createElement("div");this.fillElement=i;const s=document.createElement("div");this.strokeElement=s,i.style.display="block",i.style.position="absolute",i.style.left="0",i.style.top="0",i.style.pointerEvents="none",s.style.display="block",s.style.position="absolute",s.style.left="0",s.style.top="0",s.style.pointerEvents="none",i.appendChild(s)}this.domElement=this.fillElement}updateDOM(){const e=this.node,t=this.fillElement,i=this.strokeElement;if(this.paintDirty&&(this.dirtyRadius&&(t.style.width=`${2*e._radius}px`,t.style.height=`${2*e._radius}px`,t.style[ht.borderRadius]=`${e._radius}px`),this.dirtyFill&&(t.style.backgroundColor=e.getCSSFill()),this.dirtyStroke&&(e.hasStroke()?i.style.borderStyle="solid":i.style.borderStyle="none"),e.hasStroke())){const s=!this.hadStroke;(s||this.dirtyLineWidth||this.dirtyRadius)&&(i.style.width=`${2*e._radius-e.getLineWidth()}px`,i.style.height=`${2*e._radius-e.getLineWidth()}px`,i.style[ht.borderRadius]=`${e._radius+e.getLineWidth()/2}px`),(s||this.dirtyLineWidth)&&(i.style.left=`${-e.getLineWidth()/2}px`,i.style.top=`${-e.getLineWidth()/2}px`,i.style.borderWidth=`${e.getLineWidth()}px`),(s||this.dirtyStroke)&&(i.style.borderColor=e.getSimpleCSSStroke())}if(this.transformDirty||this.dirtyRadius){this.matrix.set(this.getTransformMatrix());const s=Ze.translation(-e._radius,-e._radius);this.matrix.multiplyMatrix(s),s.freeToPool(),Yt.applyPreparedTransform(this.matrix,this.fillElement)}this.setToCleanState(),this.cleanPaintableState(),this.transformDirty=!1}dispose(){super.dispose()}}te.register("CircleDOMDrawable",Hd);di.mixInto(Hd);const j0=Hd,Q0=!0;class Vd extends Rd(_a){initialize(e,t){super.initialize(e,t,!0,Q0),this.svgElement=this.svgElement||document.createElementNS(li,"circle")}updateSVGSelf(){const e=this.svgElement;this.dirtyRadius&&e.setAttribute("r",this.node._radius),this.updateFillStrokeStyle(e)}}te.register("CircleSVGDrawable",Vd);di.mixInto(Vd);const Z0=Vd;class zd extends co{constructor(e,t){super(e,t),Yt.prepareForTransform(this.domElement)}initialize(e,t){super.initialize(e,t),this.domElement=this.node._container}updateDOM(){this.transformDirty&&!this.node._preventTransform&&Yt.applyPreparedTransform(this.getTransformMatrix(),this.domElement),this.transformDirty=!1}dispose(){super.dispose(),this.domElement=null}}te.register("DOMDrawable",zd);di.mixInto(zd);const $u=zd;class $d extends dr{paintCanvas(e,t,i){const s=t._imageOpacity!==1;if(t._image&&t._image.width!==0&&t._image.height!==0){if(s&&(e.context.save(),e.context.globalAlpha*=t._imageOpacity),t._mipmap&&t.hasMipmaps()){const n=t.getMipmapLevel(i,Ys.CANVAS_MIPMAP_BIAS_ADJUSTMENT),o=t.getMipmapCanvas(n),c=Math.pow(2,n);e.context.drawImage(o,0,0,o.width*c,o.height*c)}else e.context.drawImage(t._image,0,0);s&&e.context.restore()}}markDirtyImage(){this.markPaintDirty()}markDirtyMipmap(){this.markPaintDirty()}markDirtyImageOpacity(){this.markPaintDirty()}}te.register("ImageCanvasDrawable",$d);di.mixInto($d);const rf=$d;class Gd extends Nd(co){constructor(e,t){super(e,t),Yt.prepareForTransform(this.domElement)}initialize(e,t){super.initialize(e,t),this.domElement||(this.domElement=document.createElement("img"),this.domElement.style.display="block",this.domElement.style.position="absolute",this.domElement.style.pointerEvents="none",this.domElement.style.left="0",this.domElement.style.top="0"),this.hasOpacity=!1}updateDOM(){const e=this.node,t=this.domElement;this.paintDirty&&this.dirtyImage&&(t.src=e._image?e._image.src:"//:0"),this.dirtyImageOpacity&&(e._imageOpacity===1?this.hasOpacity&&(this.hasOpacity=!1,t.style.opacity=""):(this.hasOpacity=!0,t.style.opacity=e._imageOpacity)),this.transformDirty&&Yt.applyPreparedTransform(this.getTransformMatrix(),this.domElement),this.setToCleanState(),this.transformDirty=!1}dispose(){super.dispose()}}te.register("ImageDOMDrawable",Gd);di.mixInto(Gd);const J0=Gd,eP=!0;class Wd extends Nd(_a){initialize(e,t){super.initialize(e,t,!1,eP),sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} initialized for ${t.toString()}`),this.svgElement=this.svgElement||document.createElementNS(li,"image"),this.svgElement.setAttribute("x","0"),this.svgElement.setAttribute("y","0"),this.hasOpacity=!1,this.usingMipmap=!1,this.mipmapLevel=-1,this._mipmapTransformListener=this._mipmapTransformListener||this.onMipmapTransform.bind(this),this._mipmapListener=this._mipmapListener||this.onMipmap.bind(this),this.node.mipmapEmitter.addListener(this._mipmapListener),this.updateMipmapStatus(t.node._mipmap)}updateSVGSelf(){const e=this.svgElement;this.dirtyImage?(sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Updating dirty image`),this.node._image?this.updateURL(e,!0):(e.setAttribute("width","0"),e.setAttribute("height","0"),e.setAttributeNS(Va,"xlink:href","//:0"))):this.dirtyMipmap&&this.node._image&&(sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Updating dirty mipmap`),this.updateURL(e,!1)),this.dirtyImageOpacity&&(this.node._imageOpacity===1?this.hasOpacity&&(this.hasOpacity=!1,e.removeAttribute("opacity")):(this.hasOpacity=!0,e.setAttribute("opacity",this.node._imageOpacity)))}updateURL(e,t){let i=-1;if(this.node._mipmap&&(i=this.node.getMipmapLevel(this.instance.relativeTransform.matrix),sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Mipmap level: ${i}`)),!(!t&&i===this.mipmapLevel))if(this.mipmapLevel>=0&&i===-1&&e.removeAttribute("transform"),this.mipmapLevel=i,this.node._mipmap&&this.node.hasMipmaps()){sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Setting image URL to mipmap level ${i}`);const s=this.node.getMipmapURL(i),n=this.node.getMipmapCanvas(i);e.setAttribute("width",`${n.width}px`),e.setAttribute("height",`${n.height}px`),e.setAttribute("transform",`scale(${Math.pow(2,i).toFixed(20)})`),e.setAttributeNS(Va,"xlink:href",s)}else sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Setting image URL`),e.setAttribute("width",`${this.node.getImageWidth()}px`),e.setAttribute("height",`${this.node.getImageHeight()}px`),e.setAttributeNS(Va,"xlink:href",this.node.getImageURL())}updateMipmapStatus(e){this.usingMipmap!==e&&(this.usingMipmap=e,e?(sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Adding mipmap compute/listener needs`),this.instance.relativeTransform.addListener(this._mipmapTransformListener),this.instance.relativeTransform.addPrecompute()):(sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Removing mipmap compute/listener needs`),this.instance.relativeTransform.removeListener(this._mipmapTransformListener),this.instance.relativeTransform.removePrecompute()),this.markDirtyMipmap())}onMipmap(){this.markDirtyMipmap(),this.updateMipmapStatus(this.node._mipmap)}onMipmapTransform(){sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Transform dirties mipmap`),this.markDirtyMipmap()}dispose(){sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} disposing`),this.updateMipmapStatus(!1),this.node.mipmapEmitter.removeListener(this._mipmapListener),super.dispose()}}te.register("ImageSVGDrawable",Wd);di.mixInto(Wd);const tP=Wd,va=5,Eo=va*0,ko=va*1,Oo=va*2,Mo=va*3,Ro=va*4,No=va*5,Da=0,Aa=1,Ea=2,ka=3,Oa=4;class Qh extends Nd(Ol){initialize(e,t){super.initialize(e,t),this.vertexArray=this.vertexArray||new Float32Array(va*6),this.upperLeft=new Pe(0,0),this.lowerLeft=new Pe(0,0),this.upperRight=new Pe(0,0),this.lowerRight=new Pe(0,0),this.xyDirty=!0,this.uvDirty=!0,this.updatedOnce=!1,this.sprite=null}onAddToBlock(e){this.webglBlock=e,this.markDirty(),this.reserveSprite()}onRemoveFromBlock(e){this.unreserveSprite()}reserveSprite(){if(this.sprite){if(this.sprite.image===this.node._image)return;this.unreserveSprite()}const e=this.node.getImageWidth(),t=this.node.getImageHeight();this.sprite=e>0&&t>0?this.webglBlock.addSpriteSheetImage(this.node._image,e,t):null,this.xyDirty=!0,this.uvDirty=!0}unreserveSprite(){this.sprite&&this.webglBlock.removeSpriteSheetImage(this.sprite),this.sprite=null}markTransformDirty(){this.xyDirty=!0,super.markTransformDirty()}markPaintDirty(){this.xyDirty=!0,this.uvDirty=!0,this.markDirty()}update(){if(!super.update()||(this.reserveSprite(),(this.dirtyImageOpacity||!this.updatedOnce)&&(this.vertexArray[Eo+Oa]=this.node._imageOpacity,this.vertexArray[ko+Oa]=this.node._imageOpacity,this.vertexArray[Oo+Oa]=this.node._imageOpacity,this.vertexArray[Mo+Oa]=this.node._imageOpacity,this.vertexArray[Ro+Oa]=this.node._imageOpacity,this.vertexArray[No+Oa]=this.node._imageOpacity),this.updatedOnce=!0,!this.sprite))return!1;if(this.uvDirty){this.uvDirty=!1;const e=this.sprite.uvBounds;this.vertexArray[Eo+Ea]=e.minX,this.vertexArray[Eo+ka]=e.minY,this.vertexArray[ko+Ea]=e.minX,this.vertexArray[ko+ka]=e.maxY,this.vertexArray[Oo+Ea]=e.maxX,this.vertexArray[Oo+ka]=e.minY,this.vertexArray[Mo+Ea]=e.maxX,this.vertexArray[Mo+ka]=e.minY,this.vertexArray[Ro+Ea]=e.minX,this.vertexArray[Ro+ka]=e.maxY,this.vertexArray[No+Ea]=e.maxX,this.vertexArray[No+ka]=e.maxY}if(this.xyDirty){this.xyDirty=!1;const e=this.node.getImageWidth(),t=this.node.getImageHeight(),i=this.instance.relativeTransform.matrix;i.multiplyVector2(this.upperLeft.setXY(0,0)),i.multiplyVector2(this.lowerLeft.setXY(0,t)),i.multiplyVector2(this.upperRight.setXY(e,0)),i.multiplyVector2(this.lowerRight.setXY(e,t)),this.vertexArray[Eo+Da]=this.upperLeft.x,this.vertexArray[Eo+Aa]=this.upperLeft.y,this.vertexArray[ko+Da]=this.lowerLeft.x,this.vertexArray[ko+Aa]=this.lowerLeft.y,this.vertexArray[Oo+Da]=this.upperRight.x,this.vertexArray[Oo+Aa]=this.upperRight.y,this.vertexArray[Mo+Da]=this.upperRight.x,this.vertexArray[Mo+Aa]=this.upperRight.y,this.vertexArray[Ro+Da]=this.lowerLeft.x,this.vertexArray[Ro+Aa]=this.lowerLeft.y,this.vertexArray[No+Da]=this.lowerRight.x,this.vertexArray[No+Aa]=this.lowerRight.y}return!0}}Qh.prototype.webglRenderer=de.webglTexturedTriangles;te.register("ImageWebGLDrawable",Qh);di.mixInto(Qh);const iP=Qh;class Ud extends wy(dr){paintCanvas(e,t,i){assert&&assert(t instanceof tt);const s=e.context;s.beginPath(),s.moveTo(t.x1,t.y1),s.lineTo(t.x2,t.y2),t.hasPaintableStroke()&&(t.beforeCanvasStroke(e),s.stroke(),t.afterCanvasStroke(e))}}te.register("LineCanvasDrawable",Ud);di.mixInto(Ud);const af=Ud,sP=!0;class Yd extends Cy(_a){initialize(e,t){super.initialize(e,t,!0,sP),this.svgElement=this.svgElement||document.createElementNS(li,"line")}updateSVGSelf(){const e=this.svgElement;this.dirtyX1&&e.setAttribute("x1",this.node.x1),this.dirtyY1&&e.setAttribute("y1",this.node.y1),this.dirtyX2&&e.setAttribute("x2",this.node.x2),this.dirtyY2&&e.setAttribute("y2",this.node.y2),this.updateFillStrokeStyle(e)}}te.register("LineSVGDrawable",Yd);di.mixInto(Yd);const nP=Yd;class Kd extends kl(dr){paintCanvas(e,t,i){const s=e.context;t.hasShape()&&(s.beginPath(),t._shape.writeToContext(s),t.hasFill()&&(t.beforeCanvasFill(e),s.fill(),t.afterCanvasFill(e)),t.hasPaintableStroke()&&(t.beforeCanvasStroke(e),s.stroke(),t.afterCanvasStroke(e)))}markDirtyShape(){this.markPaintDirty()}}te.register("PathCanvasDrawable",Kd);di.mixInto(Kd);const of=Kd,rP=!0;class qd extends K0(_a){initialize(e,t){super.initialize(e,t,!0,rP),this.svgElement=this.svgElement||document.createElementNS(li,"path")}updateSVGSelf(){assert&&assert(!this.node.requiresSVGBoundsWorkaround(),"No workaround for https://github.com/phetsims/scenery/issues/196 is provided at this time, please add an epsilon");const e=this.svgElement;if(this.dirtyShape){let t=this.node.hasShape()?this.node._shape.getSVGPath():"";t||(t="M0 0"),e.setAttribute("d",`${t}${Ui.safari?" M0 0":""}`)}this.updateFillStrokeStyle(e)}}te.register("PathSVGDrawable",qd);di.mixInto(qd);const aP=qd;class Xd extends kl(dr){writeRectangularPath(e,t){e.beginPath(),e.moveTo(t._rectX,t._rectY),e.lineTo(t._rectX+t._rectWidth,t._rectY),e.lineTo(t._rectX+t._rectWidth,t._rectY+t._rectHeight),e.lineTo(t._rectX,t._rectY+t._rectHeight),e.closePath()}paintCanvas(e,t,i){const s=e.context;if(t.isRounded()){s.beginPath();const n=t.getMaximumArcSize(),o=Math.min(t._cornerXRadius,n),c=Math.min(t._cornerYRadius,n),p=t._rectX+o,f=t._rectX+t._rectWidth-o,w=t._rectY+c,O=t._rectY+t._rectHeight-c;o===c?(s.arc(f,w,o,-Math.PI/2,0,!1),s.arc(f,O,o,0,Math.PI/2,!1),s.arc(p,O,o,Math.PI/2,Math.PI,!1),s.arc(p,w,o,Math.PI,Math.PI*3/2,!1)):(s.ellipse(f,w,o,c,0,-Math.PI/2,0,!1),s.ellipse(f,O,o,c,0,0,Math.PI/2,!1),s.ellipse(p,O,o,c,0,Math.PI/2,Math.PI,!1),s.ellipse(p,w,o,c,0,Math.PI,Math.PI*3/2,!1)),s.closePath(),t.hasFill()&&(t.beforeCanvasFill(e),s.fill(),t.afterCanvasFill(e)),t.hasPaintableStroke()&&(t.beforeCanvasStroke(e),s.stroke(),t.afterCanvasStroke(e))}else t.hasFill()&&(t.getFillValue().transformMatrix?(this.writeRectangularPath(s,t),t.beforeCanvasFill(e),s.fill(),t.afterCanvasFill(e)):(t.beforeCanvasFill(e),s.fillRect(t._rectX,t._rectY,t._rectWidth,t._rectHeight),t.afterCanvasFill(e))),t.hasPaintableStroke()&&(t.getStrokeValue().transformMatrix?(this.writeRectangularPath(s,t),t.beforeCanvasStroke(e),s.stroke(),t.afterCanvasStroke(e)):(t.beforeCanvasStroke(e),s.strokeRect(t._rectX,t._rectY,t._rectWidth,t._rectHeight),t.afterCanvasStroke(e)))}markDirtyRectangle(){this.markPaintDirty()}markDirtyX(){this.markDirtyRectangle()}markDirtyY(){this.markDirtyRectangle()}markDirtyWidth(){this.markDirtyRectangle()}markDirtyHeight(){this.markDirtyRectangle()}markDirtyCornerXRadius(){this.markDirtyRectangle()}markDirtyCornerYRadius(){this.markDirtyRectangle()}}te.register("RectangleCanvasDrawable",Xd);di.mixInto(Xd);const lf=Xd,Qc=Ze.pool.fetch();class jd extends jh(co){constructor(e,t){super(e,t),Yt.prepareForTransform(this.domElement)}initialize(e,t){if(super.initialize(e,t),!this.fillElement||!this.strokeElement){const i=document.createElement("div");this.fillElement=i,i.style.display="block",i.style.position="absolute",i.style.left="0",i.style.top="0",i.style.pointerEvents="none";const s=document.createElement("div");this.strokeElement=s,s.style.display="block",s.style.position="absolute",s.style.left="0",s.style.top="0",s.style.pointerEvents="none",i.appendChild(s)}this.domElement=this.fillElement}updateDOM(){const e=this.node,t=this.fillElement,i=this.strokeElement;if(this.paintDirty){const s=Math.min(e._cornerXRadius,e._cornerYRadius),n=this.dirtyCornerXRadius||this.dirtyCornerYRadius;if(this.dirtyWidth&&(t.style.width=`${e._rectWidth}px`),this.dirtyHeight&&(t.style.height=`${e._rectHeight}px`),n&&(t.style[ht.borderRadius]=`${s}px`),this.dirtyFill&&(t.style.backgroundColor=e.getCSSFill()),this.dirtyStroke&&(e.hasStroke()?i.style.borderStyle="solid":i.style.borderStyle="none"),e.hasStroke()){const o=!this.hadStroke;(o||this.dirtyWidth||this.dirtyLineWidth)&&(i.style.width=`${e._rectWidth-e.getLineWidth()}px`),(o||this.dirtyHeight||this.dirtyLineWidth)&&(i.style.height=`${e._rectHeight-e.getLineWidth()}px`),(o||this.dirtyLineWidth)&&(i.style.left=`${-e.getLineWidth()/2}px`,i.style.top=`${-e.getLineWidth()/2}px`,i.style.borderWidth=`${e.getLineWidth()}px`),(o||this.dirtyStroke)&&(i.style.borderColor=e.getSimpleCSSStroke()),(o||n||this.dirtyLineWidth||this.dirtyLineOptions)&&(i.style[ht.borderRadius]=e.isRounded()||e.getLineJoin()==="round"?`${s+e.getLineWidth()/2}px`:"0")}}if(this.transformDirty||this.dirtyX||this.dirtyY){Qc.set(this.getTransformMatrix());const s=Ze.translation(e._rectX,e._rectY);Qc.multiplyMatrix(s),s.freeToPool(),Yt.applyPreparedTransform(Qc,this.fillElement)}this.setToCleanState(),this.cleanPaintableState(),this.transformDirty=!1}dispose(){super.dispose()}}te.register("RectangleDOMDrawable",jd);di.mixInto(jd);const oP=jd,lP=!0;class Qd extends jh(_a){initialize(e,t){super.initialize(e,t,!0,lP),this.lastArcW=-1,this.lastArcH=-1,this.svgElement=this.svgElement||document.createElementNS(li,"rect")}updateSVGSelf(){const e=this.svgElement;if(this.dirtyX&&e.setAttribute("x",this.node._rectX),this.dirtyY&&e.setAttribute("y",this.node._rectY),this.dirtyWidth&&e.setAttribute("width",this.node._rectWidth),this.dirtyHeight&&e.setAttribute("height",this.node._rectHeight),this.dirtyCornerXRadius||this.dirtyCornerYRadius||this.dirtyWidth||this.dirtyHeight){let t=0,i=0;if(this.node.isRounded()){const s=this.node.getMaximumArcSize();t=Math.min(this.node._cornerXRadius,s),i=Math.min(this.node._cornerYRadius,s)}t!==this.lastArcW&&(this.lastArcW=t,e.setAttribute("rx",t)),i!==this.lastArcH&&(this.lastArcH=i,e.setAttribute("ry",i))}this.updateFillStrokeStyle(e)}}te.register("RectangleSVGDrawable",Qd);di.mixInto(Qd);const hP=Qd,cP=new qe("transparent");class Zh extends jh(Ol){initialize(e,t){super.initialize(e,t),this.vertexArray||(this.vertexArray=new Float32Array(6*6)),this.upperLeft=new Pe(0,0),this.lowerLeft=new Pe(0,0),this.upperRight=new Pe(0,0),this.lowerRight=new Pe(0,0),this.transformDirty=!0,this.includeVertices=!0}onAddToBlock(e){this.webglBlock=e,this.markDirty()}onRemoveFromBlock(e){}markTransformDirty(){this.transformDirty=!0,super.markTransformDirty()}update(){if(!super.update())return!1;if(this.dirtyFill&&(this.includeVertices=this.node.hasFill(),this.includeVertices)){const e=ft(this.node.fill)?this.node.fill.value:this.node.fill,t=cP.set(e),i=t.red/255,s=t.green/255,n=t.blue/255,o=t.alpha;for(let c=0;c<6;c++){const p=c*6;this.vertexArray[2+p]=i,this.vertexArray[3+p]=s,this.vertexArray[4+p]=n,this.vertexArray[5+p]=o}}if(this.transformDirty||this.dirtyX||this.dirtyY||this.dirtyWidth||this.dirtyHeight){this.transformDirty=!1;const e=this.node._rectX,t=this.node._rectY,i=this.node._rectWidth,s=this.node._rectHeight,n=this.instance.relativeTransform.matrix;n.multiplyVector2(this.upperLeft.setXY(e,t)),n.multiplyVector2(this.lowerLeft.setXY(e,t+s)),n.multiplyVector2(this.upperRight.setXY(e+i,t)),n.multiplyVector2(this.lowerRight.setXY(e+i,t+s)),this.vertexArray[0]=this.upperLeft.x,this.vertexArray[1]=this.upperLeft.y,this.vertexArray[6]=this.lowerLeft.x,this.vertexArray[7]=this.lowerLeft.y,this.vertexArray[12]=this.upperRight.x,this.vertexArray[13]=this.upperRight.y,this.vertexArray[18]=this.upperRight.x,this.vertexArray[19]=this.upperRight.y,this.vertexArray[24]=this.lowerLeft.x,this.vertexArray[25]=this.lowerLeft.y,this.vertexArray[30]=this.lowerRight.x,this.vertexArray[31]=this.lowerRight.y}return this.setToCleanState(),this.cleanPaintableState(),!0}}Zh.prototype.webglRenderer=de.webglVertexColorPolygons;te.register("RectangleWebGLDrawable",Zh);di.mixInto(Zh);const uP=Zh;class Zd extends dr{paintCanvas(e,t,i){assert&&assert(t instanceof tt);const s=Ys.getApproximateMatrixScale(i)*(self.devicePixelRatio||1),n=t._spriteInstances.length;assert&&n>0&&assert(t.canvasBounds.isValid(),"Sprites canvasBounds should be set and have non-negative area if it renders sprites");for(let o=0;o<n;o++){const c=t._spriteInstances[o],p=c.sprite.imageProperty.value,f=c.alpha!==1||p.imageOpacity!==1,w=p._mipmap&&p.hasMipmaps();if(f&&(e.context.save(),e.context.globalAlpha*=c.alpha*p.imageOpacity),c.transformType===la.TRANSLATION&&i.isTranslation())if(w){const O=p.getMipmapLevelFromScale(s,Ys.CANVAS_MIPMAP_BIAS_ADJUSTMENT),T=p.getMipmapCanvas(O),z=Math.pow(2,O);e.context.drawImage(T,c.matrix.m02()-p.offset.x,c.matrix.m12()-p.offset.y,T.width*z,T.height*z)}else e.context.drawImage(p.image,c.matrix.m02()-p.offset.x,c.matrix.m12()-p.offset.y);else{if(e.context.save(),c.matrix.canvasAppendTransform(e.context),w){const O=p.getMipmapLevelFromScale(s*Ys.getApproximateMatrixScale(c.matrix),Ys.CANVAS_MIPMAP_BIAS_ADJUSTMENT),T=p.getMipmapCanvas(O),z=Math.pow(2,O);e.context.drawImage(T,-p.offset.x,-p.offset.y,T.width*z,T.height*z)}else e.context.drawImage(p.image,-p.offset.x,-p.offset.y);e.context.restore()}f&&e.context.restore()}}}te.register("SpritesCanvasDrawable",Zd);di.mixInto(Zd);const hf=Zd,Gu=5,Zc=Gu*6,Jc=new Pe(0,0),Bo=new Pe(0,0),Fo=new Pe(0,0),eu=new Pe(0,0);class Jh extends Ol{initialize(e,t){super.initialize(e,t),this.contextChangeListener=this.onWebGLContextChange.bind(this),this.spriteSheet=new Fr(!0),this.spriteImageUVMap={},this.vertexArray=new Float32Array(128*Zc),this.transformMatrixArray=new Float32Array(9),this.spriteChangeListener=this.onSpriteChange.bind(this),this.node._sprites.forEach(i=>{i.imageProperty.lazyLink(this.spriteChangeListener),this.addSpriteImage(i.imageProperty.value)}),this.hasDrawn=!1}addSpriteImage(e){this.spriteImageUVMap[e.id]=this.spriteSheet.addImage(e.image,e.image.width,e.image.height).uvBounds}removeSpriteImage(e){this.spriteSheet.removeImage(e.image),delete this.spriteImageUVMap[e.id]}onSpriteChange(e,t){this.removeSpriteImage(t),this.addSpriteImage(e)}setup(){const e=this.webGLBlock.gl;this.spriteSheet.initializeContext(e),this.shaderProgram=new Vh(e,["attribute vec2 aVertex;","attribute vec2 aTextureCoord;","attribute float aAlpha;","varying vec2 vTextureCoord;","varying float vAlpha;","uniform mat3 uProjectionMatrix;","uniform mat3 uTransformMatrix;","void main() {","  vTextureCoord = aTextureCoord;","  vAlpha = aAlpha;","  vec3 ndc = uProjectionMatrix * ( uTransformMatrix * vec3( aVertex, 1.0 ) );","  gl_Position = vec4( ndc.xy, 0.0, 1.0 );","}"].join(`
`),["precision mediump float;","varying vec2 vTextureCoord;","varying float vAlpha;","uniform sampler2D uTexture;","void main() {","  vec4 color = texture2D( uTexture, vTextureCoord, -0.7 );","  color *= vAlpha;","  gl_FragColor = color;","}"].join(`
`),{attributes:["aVertex","aTextureCoord","aAlpha"],uniforms:["uTexture","uProjectionMatrix","uTransformMatrix"]}),this.vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertexArray,e.DYNAMIC_DRAW)}onWebGLContextChange(){this.setup()}onAddToBlock(e){this.webGLBlock=e,this.setup(),e.glChangedEmitter.addListener(this.contextChangeListener)}onRemoveFromBlock(e){e.glChangedEmitter.removeListener(this.contextChangeListener)}draw(){const e=this.node._spriteInstances.length;if(e===0)return 0;assert&&assert(this.node.canvasBounds.isValid(),"Sprites canvasBounds should be set and have non-negative area if it renders sprites"),this.spriteSheet.updateTexture(),this.shaderProgram.use();let t=0,i=!1;for(;Zc*e>this.vertexArray.length;)this.vertexArray=new Float32Array(this.vertexArray.length*2),i=!0;for(let c=0;c<e;c++){const p=this.node._spriteInstances[c],f=p.sprite.imageProperty.value,w=p.alpha*f.imageOpacity,O=this.spriteImageUVMap[f.id],T=p.matrix,z=f.offset,U=f.image.width,m=f.image.height;T.multiplyVector2(Jc.setXY(-z.x,-z.y)),T.multiplyVector2(Bo.setXY(-z.x,m-z.y)),T.multiplyVector2(Fo.setXY(U-z.x,-z.y)),T.multiplyVector2(eu.setXY(U-z.x,m-z.y)),this.vertexArray[t+0]=Jc.x,this.vertexArray[t+1]=Jc.y,this.vertexArray[t+2]=O.minX,this.vertexArray[t+3]=O.minY,this.vertexArray[t+4]=w,this.vertexArray[t+5]=Bo.x,this.vertexArray[t+6]=Bo.y,this.vertexArray[t+7]=O.minX,this.vertexArray[t+8]=O.maxY,this.vertexArray[t+9]=w,this.vertexArray[t+10]=Fo.x,this.vertexArray[t+11]=Fo.y,this.vertexArray[t+12]=O.maxX,this.vertexArray[t+13]=O.minY,this.vertexArray[t+14]=w,this.vertexArray[t+15]=Fo.x,this.vertexArray[t+16]=Fo.y,this.vertexArray[t+17]=O.maxX,this.vertexArray[t+18]=O.minY,this.vertexArray[t+19]=w,this.vertexArray[t+20]=Bo.x,this.vertexArray[t+21]=Bo.y,this.vertexArray[t+22]=O.minX,this.vertexArray[t+23]=O.maxY,this.vertexArray[t+24]=w,this.vertexArray[t+25]=eu.x,this.vertexArray[t+26]=eu.y,this.vertexArray[t+27]=O.maxX,this.vertexArray[t+28]=O.maxY,this.vertexArray[t+29]=w,t+=Zc}const s=this.webGLBlock.gl;s.uniformMatrix3fv(this.shaderProgram.uniformLocations.uProjectionMatrix,!1,this.webGLBlock.projectionMatrixArray),this.instance.relativeTransform.matrix.copyToArray(this.transformMatrixArray),s.uniformMatrix3fv(this.shaderProgram.uniformLocations.uTransformMatrix,!1,this.transformMatrixArray),s.bindBuffer(s.ARRAY_BUFFER,this.vertexBuffer),i?s.bufferData(s.ARRAY_BUFFER,this.vertexArray,s.DYNAMIC_DRAW):s.bufferSubData(s.ARRAY_BUFFER,0,this.vertexArray.subarray(0,t));const n=Float32Array.BYTES_PER_ELEMENT,o=Gu*n;return s.vertexAttribPointer(this.shaderProgram.attributeLocations.aVertex,2,s.FLOAT,!1,o,0*n),s.vertexAttribPointer(this.shaderProgram.attributeLocations.aTextureCoord,2,s.FLOAT,!1,o,2*n),s.vertexAttribPointer(this.shaderProgram.attributeLocations.aAlpha,1,s.FLOAT,!1,o,4*n),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.spriteSheet.texture),s.uniform1i(this.shaderProgram.uniformLocations.uTexture,0),s.drawArrays(s.TRIANGLES,0,t/Gu),s.bindTexture(s.TEXTURE_2D,null),this.shaderProgram.unuse(),!this.hasDrawn&&Ui.safari&&Sb.setTimeout(()=>this.markDirty(),0),this.hasDrawn=!0,1}dispose(){this.node._sprites.forEach(e=>{e.imageProperty.unlink(this.spriteChangeListener)}),this.webGLBlock&&(this.webGLBlock=null),super.dispose()}markPaintDirty(){this.markDirty()}}Jh.prototype.webglRenderer=de.webglCustom;te.register("SpritesWebGLDrawable",Jh);di.mixInto(Jh);const dP=Jh;class Jd extends kl(dr){paintCanvas(e,t,i){const s=e.context;(t.hasFill()||t.hasPaintableStroke())&&(e.setFont(t._font.getFont()),e.setDirection("ltr")),t.hasFill()&&(t.beforeCanvasFill(e),s.fillText(t.renderedText,0,0),t.afterCanvasFill(e)),t.hasPaintableStroke()&&(t.beforeCanvasStroke(e),s.strokeText(t.renderedText,0,0),t.afterCanvasStroke(e))}markDirtyText(){this.markPaintDirty()}markDirtyFont(){this.markPaintDirty()}markDirtyBounds(){this.markPaintDirty()}}te.register("TextCanvasDrawable",Jd);di.mixInto(Jd);const cf=Jd,tu=Ze.pool.fetch();class eg extends Iy(co){constructor(e,t){super(e,t),Yt.prepareForTransform(this.domElement)}initialize(e,t){super.initialize(e,t),this.domElement||(this.domElement=document.createElement("div"),this.domElement.style.display="block",this.domElement.style.position="absolute",this.domElement.style.pointerEvents="none",this.domElement.style.left="0",this.domElement.style.top="0",this.domElement.setAttribute("dir","ltr"))}updateDOM(){const e=this.node,t=this.domElement;if(this.paintDirty&&(this.dirtyFont&&(t.style.font=e.getFont()),this.dirtyStroke&&(t.style.color=e.getCSSFill()),this.dirtyBounds&&(t.style.width=`${e.getSelfBounds().width}px`,t.style.height=`${e.getSelfBounds().height}px`),this.dirtyText&&(t.textContent=e.renderedText)),this.transformDirty||this.dirtyText||this.dirtyFont||this.dirtyBounds){const i=e.getSelfBounds().minY;tu.set(this.getTransformMatrix());const s=Ze.translation(0,i);tu.multiplyMatrix(s),s.freeToPool(),Yt.applyPreparedTransform(tu,t)}this.setToCleanState(),this.cleanPaintableState(),this.transformDirty=!1}dispose(){super.dispose()}}te.register("TextDOMDrawable",eg);di.mixInto(eg);const gP=eg,pP=!0,fP=!Ui.edge,uf=Ui.safari;class tg extends Iy(_a){initialize(e,t){if(super.initialize(e,t,!0,pP),this.hasLength=!1,!this.svgElement){const i=document.createElementNS(li,"text");if(this.text=i,uf){const s=document.createElementNS(li,"g");s.appendChild(i),this.svgElement=s,this.workaroundRect=document.createElementNS(li,"rect"),this.workaroundRect.setAttribute("fill","transparent"),s.appendChild(this.workaroundRect)}else this.svgElement=i;i.appendChild(document.createTextNode("")),i.setAttribute("dominant-baseline","alphabetic"),i.setAttribute("text-rendering","geometricPrecision"),i.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),i.setAttribute("direction","ltr")}}updateSVGSelf(){const e=this.text;if(this.dirtyFont&&(e.setAttribute("font-family",this.node._font.getFamily()),e.setAttribute("font-size",this.node._font.getSize()),e.setAttribute("font-style",this.node._font.getStyle()),e.setAttribute("font-weight",this.node._font.getWeight()),e.setAttribute("font-stretch",this.node._font.getStretch())),this.dirtyText&&(e.lastChild.nodeValue=Yt.safariEmbeddingMarkWorkaround(this.node.renderedText)),this.dirtyBounds&&fP&&(this.node._boundsMethod!=="accurate"&&isFinite(this.node.selfBounds.width)?(this.hasLength||(this.hasLength=!0,e.setAttribute("lengthAdjust","spacingAndGlyphs")),e.setAttribute("textLength",this.node.selfBounds.width)):this.hasLength&&(this.hasLength=!1,e.removeAttribute("lengthAdjust"),e.removeAttribute("textLength")),uf)){const s=this.node.selfBounds.width*.2,n=this.node.selfBounds.height*.2;this.workaroundRect.setAttribute("x",this.node.selfBounds.minX-s),this.workaroundRect.setAttribute("y",this.node.selfBounds.minY-n),this.workaroundRect.setAttribute("width",this.node.selfBounds.width+2*s),this.workaroundRect.setAttribute("height",this.node.selfBounds.height+2*n)}this.updateFillStrokeStyle(e)}}te.register("TextSVGDrawable",tg);di.mixInto(tg);const mP=tg;class ec extends Ol{initialize(e,t){super.initialize(e,t),this.contextChangeListener=this.contextChangeListener||this.onWebGLContextChange.bind(this),this.painter=null}createPainter(){const e=this.node.painterType;return new e(this.webGLBlock.gl,this.node)}onWebGLContextChange(){this.painter=this.createPainter()}onAddToBlock(e){this.webGLBlock=e,this.painter=this.createPainter(),e.glChangedEmitter.addListener(this.contextChangeListener)}onRemoveFromBlock(e){e.glChangedEmitter.removeListener(this.contextChangeListener)}draw(){const e=this.instance.relativeTransform.matrix,t=this.painter.paint(e,this.webGLBlock.projectionMatrix);return assert&&assert(t===Gn.PAINTED_SOMETHING||t===Gn.PAINTED_NOTHING),assert&&assert(Gn.PAINTED_NOTHING===0&&Gn.PAINTED_SOMETHING===1,"Ensure we can pass the value through directly to indicate whether draw calls were made"),t}dispose(){this.painter.dispose(),this.painter=null,this.webGLBlock&&(this.webGLBlock=null),super.dispose()}markPaintDirty(){this.markDirty()}get shaderAttributes(){return this.node.shaderAttributes}}ec.prototype.webglRenderer=de.webglCustom;te.register("WebGLNodeDrawable",ec);di.mixInto(ec);const yP=ec;class Dy extends Zi{constructor(e,t){super(),this.initialize(e,t)}initialize(e,t){super.initialize(e),this.instance=t}stitch(e,t,i,s){}}te.register("InlineCanvasCacheDrawable",Dy);class Ay extends Zi{constructor(e,t,i,s){super(),this.initialize(e,t,i,s)}initialize(e,t,i,s){super.initialize(t),this.instance=i,this.sharedInstance=s}}te.register("SharedCanvasCacheDrawable",Ay);class Ey{constructor(e){this.instance=e}initialize(e,t){return this.display=e,this.trail=t,this.node=t&&t.lastNode(),this.transformDirty=!0,this.nodeTransformListener=this.nodeTransformListener||this.onNodeTransformDirty.bind(this),this.matrix=this.matrix||Ze.identity(),this.relativeSelfDirty=!0,this.relativeChildrenListenersCount=0,this.relativePrecomputeCount=0,this.relativeChildrenPrecomputeCount=0,this.relativeFrameId=-1,this.relativeChildDirtyFrame=e?e._frameId:0,this.relativeTransformListeners=vt(this.relativeTransformListeners),this}get parent(){return this.instance.parent?this.instance.parent.relativeTransform:null}addInstance(e){e.stateless?(assert&&assert(!e.relativeTransform.hasAncestorListenerNeed(),"We only track changes properly if stateless instances do not have needs"),assert&&assert(!e.relativeTransform.hasAncestorComputeNeed(),"We only track changes properly if stateless instances do not have needs")):(e.relativeTransform.hasAncestorListenerNeed()&&this.incrementTransformListenerChildren(),e.relativeTransform.hasAncestorComputeNeed()&&this.incrementTransformPrecomputeChildren()),e.relativeTransform.forceMarkTransformDirty()}removeInstance(e){e.relativeTransform.hasAncestorListenerNeed()&&this.decrementTransformListenerChildren(),e.relativeTransform.hasAncestorComputeNeed()&&this.decrementTransformPrecomputeChildren()}attachNodeListeners(){this.node.transformEmitter.addListener(this.nodeTransformListener)}detachNodeListeners(){this.node.transformEmitter.removeListener(this.nodeTransformListener)}hasDescendantListenerNeed(){return this.instance.isTransformed?this.relativeChildrenListenersCount>0:this.relativeChildrenListenersCount>0||this.relativeTransformListeners.length>0}hasAncestorListenerNeed(){return this.instance.isTransformed?this.relativeTransformListeners.length>0:this.relativeChildrenListenersCount>0||this.relativeTransformListeners.length>0}hasSelfListenerNeed(){return this.relativeTransformListeners.length>0}incrementTransformListenerChildren(){const e=this.hasAncestorListenerNeed();this.relativeChildrenListenersCount++,e!==this.hasAncestorListenerNeed()&&(assert&&assert(!this.instance.isTransformed,"Should not be a change in need if we have the isTransformed flag"),this.parent&&this.parent.incrementTransformListenerChildren())}decrementTransformListenerChildren(){const e=this.hasAncestorListenerNeed();this.relativeChildrenListenersCount--,e!==this.hasAncestorListenerNeed()&&(assert&&assert(!this.instance.isTransformed,"Should not be a change in need if we have the isTransformed flag"),this.parent&&this.parent.decrementTransformListenerChildren())}addListener(e){const t=this.hasAncestorListenerNeed();this.relativeTransformListeners.push(e),t!==this.hasAncestorListenerNeed()&&(this.parent&&this.parent.incrementTransformListenerChildren(),this.hasAncestorComputeNeed()||this.forceMarkTransformDirty())}removeListener(e){const t=this.hasAncestorListenerNeed();this.relativeTransformListeners.splice(_.indexOf(this.relativeTransformListeners,e),1),t!==this.hasAncestorListenerNeed()&&this.parent&&this.parent.decrementTransformListenerChildren()}hasDescendantComputeNeed(){return this.instance.isTransformed?this.relativeChildrenPrecomputeCount>0:this.relativeChildrenPrecomputeCount>0||this.relativePrecomputeCount>0}hasAncestorComputeNeed(){return this.instance.isTransformed?this.relativePrecomputeCount>0:this.relativeChildrenPrecomputeCount>0||this.relativePrecomputeCount>0}hasSelfComputeNeed(){return this.relativePrecomputeCount>0}incrementTransformPrecomputeChildren(){const e=this.hasAncestorComputeNeed();this.relativeChildrenPrecomputeCount++,e!==this.hasAncestorComputeNeed()&&(assert&&assert(!this.instance.isTransformed,"Should not be a change in need if we have the isTransformed flag"),this.parent&&this.parent.incrementTransformPrecomputeChildren())}decrementTransformPrecomputeChildren(){const e=this.hasAncestorComputeNeed();this.relativeChildrenPrecomputeCount--,e!==this.hasAncestorComputeNeed()&&(assert&&assert(!this.instance.isTransformed,"Should not be a change in need if we have the isTransformed flag"),this.parent&&this.parent.decrementTransformPrecomputeChildren())}addPrecompute(){const e=this.hasAncestorComputeNeed();this.relativePrecomputeCount++,e!==this.hasAncestorComputeNeed()&&(this.parent&&this.parent.incrementTransformPrecomputeChildren(),this.hasAncestorListenerNeed()||this.forceMarkTransformDirty())}removePrecompute(){const e=this.hasAncestorComputeNeed();this.relativePrecomputeCount--,e!==this.hasAncestorComputeNeed()&&this.parent&&this.parent.decrementTransformPrecomputeChildren()}onNodeTransformDirty(){this.transformDirty||this.forceMarkTransformDirty()}forceMarkTransformDirty(){this.transformDirty=!0,this.relativeSelfDirty=!0;const e=this.display._frameId;let t=this.instance.parent;for(;t&&t.relativeTransform.relativeChildDirtyFrame!==e;){const i=t.parent,s=t.isTransformed;if(t.relativeTransform.relativeChildDirtyFrame=e,i===null){this.display.markTransformRootDirty(t,s);break}else if(s){this.display.markTransformRootDirty(t,!0);break}t=i}}computeRelativeTransform(){const e=this.node.getMatrix();this.instance.parent&&!this.instance.parent.isTransformed?(this.matrix.set(this.parent.matrix),this.matrix.multiplyMatrix(e)):this.matrix.set(e),this.relativeFrameId=this.display._frameId,this.relativeSelfDirty=!1}isValidationNotNeeded(){return this.hasAncestorComputeNeed()||this.relativeFrameId===this.display._frameId}validate(){if(!this.isValidationNotNeeded()&&(this.instance.parent&&!this.instance.parent.isTransformed&&this.parent.validate(),this.relativeSelfDirty)){this.computeRelativeTransform();const e=this.instance.children.length;for(let t=0;t<e;t++)this.instance.children[t].relativeTransform.relativeSelfDirty=!0}}updateTransformListenersAndCompute(e,t,i,s){sceneryLog&&sceneryLog.RelativeTransform&&sceneryLog.RelativeTransform(`update/compute: ${this.toString()} ${e} => ${t}${s?" passTransform":""}`),sceneryLog&&sceneryLog.RelativeTransform&&sceneryLog.push();let n,o;if(s)for(n=this.instance.children.length,o=0;o<n;o++)this.instance.children[o].relativeTransform.updateTransformListenersAndCompute(!1,!1,i,!1);else{const c=e||this.relativeSelfDirty,p=c||this.relativeChildDirtyFrame===i,f=this.hasDescendantComputeNeed(),w=this.hasDescendantListenerNeed(),O=this.hasSelfComputeNeed(),T=this.hasSelfListenerNeed();if(!f&&c&&!t&&(this.relativeSelfDirty=!0),!p||!f&&!w&&!O&&!T){sceneryLog&&sceneryLog.RelativeTransform&&sceneryLog.pop();return}if(c&&(f||O)&&this.computeRelativeTransform(),this.transformDirty&&(this.transformDirty=!1),this.notifyRelativeTransformListeners(),!this.instance.isTransformed||s){const z=c&&!(f||O);for(n=this.instance.children.length,o=0;o<n;o++)this.instance.children[o].relativeTransform.updateTransformListenersAndCompute(c,z,i,!1)}}sceneryLog&&sceneryLog.RelativeTransform&&sceneryLog.pop()}notifyRelativeTransformListeners(){const e=this.relativeTransformListeners.length;for(let t=0;t<e;t++)this.relativeTransformListeners[t]()}audit(e,t){function i(n){const o=Ze.pool.fetch(),c=n.node.getMatrix();return n.parent?n.parent.isTransformed?o.set(c):(o.set(i(n.parent)),o.multiplyMatrix(c)):o.set(Ze.IDENTITY),o}function s(n){return t&&n.isValidationNotNeeded()?!1:n.relativeSelfDirty||n.parent&&s(n.parent)}if(assertSlow){let n=0,o=0;for(let c=0;c<this.instance.children.length;c++){const p=this.instance.children[c];p.relativeTransform.hasAncestorListenerNeed()&&n++,p.relativeTransform.hasAncestorComputeNeed()&&o++}if(assertSlow(n===this.relativeChildrenListenersCount,"Relative listener count invariant"),assertSlow(o===this.relativeChildrenPrecomputeCount,"Relative precompute count invariant"),assertSlow(!this.parent||this.instance.isTransformed||this.relativeChildDirtyFrame!==e||this.parent.relativeChildDirtyFrame===e,"If we have a parent, we need to hold the invariant this.relativeChildDirtyFrame => parent.relativeChildDirtyFrame"),!t&&!s(this)){const c=i(this);assertSlow(c.equals(this.matrix),"If there is no relativeSelfDirty flag set here or in our ancestors, our matrix should be up-to-date")}}}}te.register("RelativeTransform",Ey);class sn{constructor(e,t){this.initialize(e,t)}initialize(e,t){assert&&assert(e===null||e instanceof Zi,"drawableBefore can either be null to indicate that there is no un-changed drawable before our changes, or it can reference an un-changed drawable"),assert&&assert(t===null||t instanceof Zi,"drawableAfter can either be null to indicate that there is no un-changed drawable after our changes, or it can reference an un-changed drawable"),this.nextChangeInterval=null,this.drawableBefore=e,this.drawableAfter=t,this.collapsedEmpty=!1}dispose(){this.nextChangeInterval=null,this.drawableBefore=null,this.drawableAfter=null,this.freeToPool()}constrict(){let e=!1;if(this.isEmpty())return!0;for(;this.drawableBefore&&this.drawableBefore.nextDrawable===this.drawableBefore.oldNextDrawable;)if(this.drawableBefore=this.drawableBefore.nextDrawable,e=!0,this.drawableBefore||(assert&&assert(!this.drawableAfter),this.collapsedEmpty=!0),this.isEmpty())return!0;for(;this.drawableAfter&&this.drawableAfter.previousDrawable===this.drawableAfter.oldPreviousDrawable;)if(this.drawableAfter=this.drawableAfter.previousDrawable,e=!0,this.drawableAfter||(assert&&assert(!this.drawableBefore),this.collapsedEmpty=!0),this.isEmpty())return!0;return e}isEmpty(){return this.collapsedEmpty||this.drawableBefore!==null&&this.drawableBefore===this.drawableAfter}getOldInternalDrawableCount(e,t){const i=this.drawableBefore?this.drawableBefore.oldNextDrawable:e,s=this.drawableAfter;let n=0;for(let o=i;o!==s;o=o.oldNextDrawable)n++;return n}getNewInternalDrawableCount(e,t){const i=this.drawableBefore?this.drawableBefore.nextDrawable:e,s=this.drawableAfter;let n=0;for(let o=i;o!==s;o=o.nextDrawable)n++;return n}static newForDisplay(e,t,i){const s=sn.createFromPool(e,t);return i.markChangeIntervalToDispose(s),s}}te.register("ChangeInterval",sn);di.mixInto(sn);class ky{constructor(e){this.instance=e}initialize(e,t){return this.display=e,this.trail=t,this.node=t&&t.lastNode(),this.selfFittable=!!t&&this.isSelfFitSupported(),this.ancestorsFittable=this.selfFittable,this.subtreeUnfittableCount=this.selfFittable?0:1,this.subtreeFittabilityChangeEmitter=this.subtreeFittabilityChangeEmitter||new ri,this}get parent(){return this.instance.parent?this.instance.parent.fittability:null}checkSelfFittability(){const e=this.isSelfFitSupported();this.selfFittable!==e&&this.updateSelfFittable()}isSelfFitSupported(){return this.display._allowLayerFitting&&!this.node.isPreventFit()}markSubtreeFittable(){if(!this.selfFittable)return;this.ancestorsFittable=!0;const e=this.instance.children;for(let t=0;t<e.length;t++)e[t].fittability.markSubtreeFittable();this.instance.updateDrawableFittability(!0)}markSubtreeUnfittable(){if(!this.ancestorsFittable)return;this.ancestorsFittable=!1;const e=this.instance.children;for(let t=0;t<e.length;t++)e[t].fittability.markSubtreeUnfittable();this.instance.updateDrawableFittability(!1)}updateSelfFittable(){const e=this.isSelfFitSupported();assert&&assert(this.selfFittable!==e),this.selfFittable=e,this.selfFittable&&(!this.parent||this.parent.ancestorsFittable)?this.markSubtreeFittable():this.selfFittable||this.markSubtreeUnfittable(),this.selfFittable?this.decrementSubtreeUnfittableCount():this.incrementSubtreeUnfittableCount()}incrementSubtreeUnfittableCount(){this.subtreeUnfittableCount++,this.subtreeUnfittableCount===1&&(this.parent&&this.parent.incrementSubtreeUnfittableCount(),this.subtreeFittabilityChangeEmitter.emit())}decrementSubtreeUnfittableCount(){this.subtreeUnfittableCount--,this.subtreeUnfittableCount===0&&(this.parent&&this.parent.decrementSubtreeUnfittableCount(),this.subtreeFittabilityChangeEmitter.emit())}onInsert(e){this.ancestorsFittable||e.markSubtreeUnfittable(),e.subtreeUnfittableCount>0&&this.incrementSubtreeUnfittableCount()}onRemove(e){this.ancestorsFittable||e.markSubtreeFittable(),e.subtreeUnfittableCount>0&&this.decrementSubtreeUnfittableCount()}audit(){if(assertSlow){assertSlow(this.selfFittable===this.isSelfFitSupported(),"selfFittable diverged from isSelfFitSupported()"),assertSlow(this.ancestorsFittable===((this.parent?this.parent.ancestorsFittable:!0)&&this.selfFittable),"Our ancestorsFittable should be false if our parent or our self is not fittable.");let e=0;this.selfFittable||e++,_.each(this.instance.children,t=>{t.fittability.subtreeUnfittableCount>0&&e++}),assertSlow(this.subtreeUnfittableCount===e,"Incorrect subtreeUnfittableCount")}}}te.register("Fittability",ky);let bP=1,_P=1;class Dn{constructor(e,t,i){this.id=`group${bP++}`,this.initialize(e,t,i)}initialize(e,t,i){sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`initializing ${this.toString()}`),this.block=e,this.instance=t,this.node=t.trail.lastNode(),this.parent=i,this.children=vt(this.children),this.hasSelfDrawable=!1,this.selfDrawable=null,this.dirty=!0,this.willApplyTransforms=this.block.transformRootInstance.trail.nodes.length<this.instance.trail.nodes.length,this.willApplyFilters=this.block.filterRootInstance.trail.nodes.length<this.instance.trail.nodes.length,this.transformDirty=!0,this.hasTransform=this.hasTransform!==void 0?this.hasTransform:!1,this.transformDirtyListener=this.transformDirtyListener||this.markTransformDirty.bind(this),this.willApplyTransforms&&this.node.transformEmitter.addListener(this.transformDirtyListener),this.filterDirty=!0,this.visibilityDirty=!0,this.clipDirty=!0,this.filterElement=this.filterElement||null,this.hasOpacity=this.hasOpacity!==void 0?this.hasOpacity:!1,this.hasFilter=!1,this.clipDefinition=this.clipDefinition!==void 0?this.clipDefinition:null,this.clipPath=this.clipPath!==void 0?this.clipPath:null,this.filterChangeListener=this.filterChangeListener||this.onFilterChange.bind(this),this.visibilityDirtyListener=this.visibilityDirtyListener||this.onVisibleChange.bind(this),this.clipDirtyListener=this.clipDirtyListener||this.onClipChange.bind(this),this.node.visibleProperty.lazyLink(this.visibilityDirtyListener),this.willApplyFilters&&this.node.filterChangeEmitter.addListener(this.filterChangeListener),this.node.clipAreaProperty.lazyLink(this.clipDirtyListener),this.orderDirty=!0,this.orderDirtyListener=this.orderDirtyListener||this.markOrderDirty.bind(this),this.node.childrenChangedEmitter.addListener(this.orderDirtyListener),this.svgGroup||(this.svgGroup=document.createElementNS(li,"g")),this.instance.addSVGGroup(this),this.block.markDirtyGroup(this)}addSelfDrawable(e){this.selfDrawable=e,this.svgGroup.insertBefore(e.svgElement,this.children.length?this.children[0].svgGroup:null),this.hasSelfDrawable=!0}removeSelfDrawable(e){this.hasSelfDrawable=!1,this.svgGroup.removeChild(e.svgElement),this.selfDrawable=null}addChildGroup(e){this.markOrderDirty(),e.parent=this,this.children.push(e),this.svgGroup.appendChild(e.svgGroup)}removeChildGroup(e){this.markOrderDirty(),e.parent=null,this.children.splice(_.indexOf(this.children,e),1),this.svgGroup.removeChild(e.svgGroup)}markDirty(){this.dirty||(this.dirty=!0,this.block.markDirtyGroup(this))}markOrderDirty(){this.orderDirty||(this.orderDirty=!0,this.markDirty())}markTransformDirty(){this.transformDirty||(this.transformDirty=!0,this.markDirty())}onFilterChange(){this.filterDirty||(this.filterDirty=!0,this.markDirty())}onVisibleChange(){this.visibilityDirty||(this.visibilityDirty=!0,this.markDirty())}onClipChange(){this.clipDirty||(this.clipDirty=!0,this.markDirty())}update(){if(sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`update: ${this.toString()}`),!this.block)return;sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.push();const e=this.svgGroup;if(this.dirty=!1,this.transformDirty&&(this.transformDirty=!1,sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`transform update: ${this.toString()}`),this.willApplyTransforms?this.node.transform.isIdentity()?this.hasTransform&&(this.hasTransform=!1,e.removeAttribute("transform")):(this.hasTransform=!0,e.setAttribute("transform",this.node.transform.getMatrix().getSVGTransform())):this.hasTransform&&(this.hasTransform=!1,e.removeAttribute("transform"))),this.visibilityDirty&&(this.visibilityDirty=!1,sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`visibility update: ${this.toString()}`),e.style.display=this.node.isVisible()?"":"none"),this.filterDirty){this.filterDirty=!1,sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`filter update: ${this.toString()}`);const t=this.node.effectiveOpacity;this.willApplyFilters&&t!==1?(this.hasOpacity=!0,e.setAttribute("opacity",t)):this.hasOpacity&&(this.hasOpacity=!1,e.removeAttribute("opacity"));const i=this.willApplyFilters&&this.node._filters.length,s=`filter-${this.id}`;if(i){for(this.filterElement||(this.filterElement=document.createElementNS(li,"filter"),this.filterElement.setAttribute("id",s));this.filterElement.firstChild;)this.filterElement.removeChild(this.filterElement.lastChild);let n=50,o="SourceGraphic";const c=this.node._filters.length;for(let w=0;w<c;w++){const O=this.node._filters[w],T=w===c-1?void 0:`e${w}`;O.applySVGFilter(this.filterElement,o,T),n+=O.filterRegionPercentageIncrease,o=T}const p=`-${ni(n)}%`,f=`${ni(2*n+100)}%`;this.filterElement.setAttribute("x",p),this.filterElement.setAttribute("y",p),this.filterElement.setAttribute("width",f),this.filterElement.setAttribute("height",f)}i&&(this.hasFilter||this.block.defs.appendChild(this.filterElement),e.setAttribute("filter",`url(#${s})`),this.hasFilter=!0),this.hasFilter&&!i&&(e.removeAttribute("filter"),this.hasFilter=!1,this.block.defs.removeChild(this.filterElement))}if(this.clipDirty)if(this.clipDirty=!1,sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`clip update: ${this.toString()}`),this.node.clipArea){if(!this.clipDefinition){const t=`clip${_P++}`;this.clipDefinition=document.createElementNS(li,"clipPath"),this.clipDefinition.setAttribute("id",t),this.clipDefinition.setAttribute("clipPathUnits","userSpaceOnUse"),this.block.defs.appendChild(this.clipDefinition),this.clipPath=document.createElementNS(li,"path"),this.clipDefinition.appendChild(this.clipPath),e.setAttribute("clip-path",`url(#${t})`)}this.clipPath.setAttribute("d",this.node.clipArea.getSVGPath())}else this.clipDefinition&&(e.removeAttribute("clip-path"),this.block.defs.removeChild(this.clipDefinition),this.clipDefinition=null,this.clipPath=null);if(this.orderDirty){this.orderDirty=!1,sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`order update: ${this.toString()}`),sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.push();let t=this.children.length-1;const i=this.instance.children;for(let s=i.length-1;s>=0;s--){const n=i[s].lookupSVGGroup(this.block);if(n){if(this.children[t]!==n){sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`group out of order: ${t} for ${n.toString()}`),e.insertBefore(n.svgGroup,t+1>=this.children.length?null:this.children[t+1].svgGroup);const o=_.indexOf(this.children,n);assert&&assert(o<t,"The item we are moving backwards to location [idx] should not have an index greater than that"),this.children.splice(o,1),this.children.splice(t,0,n)}else sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`group in place: ${t} for ${n.toString()}`);t--}}sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.pop()}sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.pop()}isReleasable(){return!this.hasSelfDrawable&&!this.children.length&&this.parent}dispose(){sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`dispose ${this.toString()}`),sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.push(),assert&&assert(this.children.length===0,"Should be empty by now"),this.hasFilter&&(this.svgGroup.removeAttribute("filter"),this.hasFilter=!1,this.block.defs.removeChild(this.filterElement)),this.willApplyTransforms&&this.node.transformEmitter.removeListener(this.transformDirtyListener),this.node.visibleProperty.unlink(this.visibilityDirtyListener),this.willApplyFilters&&this.node.filterChangeEmitter.removeListener(this.filterChangeListener),this.node.clipAreaProperty.unlink(this.clipDirtyListener),this.node.childrenChangedEmitter.removeListener(this.orderDirtyListener),this.instance.active&&this.instance.removeSVGGroup(this),this.clipDefinition&&(this.svgGroup.removeAttribute("clip-path"),this.block.defs.removeChild(this.clipDefinition),this.clipDefinition=null,this.clipPath=null),this.parent=null,this.block=null,this.instance=null,this.node=null,vt(this.children),this.selfDrawable=null,this.freeToPool(),sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.pop()}toString(){return`SVGGroup:${this.block.toString()}_${this.instance.toString()}`}static addDrawable(e,t){assert&&assert(t.instance,"Instance is required for a drawable to be grouped correctly in SVG"),Dn.ensureGroupsToInstance(e,t.instance).addSelfDrawable(t)}static removeDrawable(e,t){t.instance.lookupSVGGroup(e).removeSelfDrawable(t),Dn.releaseGroupsToInstance(e,t.instance)}static ensureGroupsToInstance(e,t){let i=t.lookupSVGGroup(e);if(!i){assert&&assert(t!==e.rootGroup.instance,"Making sure we do not walk past our rootGroup");const s=Dn.ensureGroupsToInstance(e,t.parent);i=Dn.createFromPool(e,t,s),s.addChildGroup(i)}return i}static releaseGroupsToInstance(e,t){const i=t.lookupSVGGroup(e);if(i.isReleasable()){const s=i.parent;s.removeChildGroup(i),Dn.releaseGroupsToInstance(e,s.instance),i.dispose()}}}te.register("SVGGroup",Dn);di.mixInto(Dn);class Oy extends Zi{initialize(e,t){assert&&assert(!e._isDisposing,"Should not create a block for a Display that is being disposed of"),assert&&assert(!e._isDisposed,"Should not create a block for a disposed Display"),super.initialize(t),this.display=e,this.drawableCount=0,this.used=!0,this.firstDrawable=null,this.lastDrawable=null,this.pendingFirstDrawable=null,this.pendingLastDrawable=null,this.previousBlock=null,this.nextBlock=null,this.zIndex=0,assertSlow&&(this.drawableList=vt(this.drawableList))}dispose(){assert&&assert(this.drawableCount===0,"There should be no drawables on a block when it is disposed"),this.display=null,this.firstDrawable=null,this.lastDrawable=null,this.pendingFirstDrawable=null,this.pendingLastDrawable=null,this.previousBlock=null,this.nextBlock=null,assertSlow&&vt(this.drawableList),super.dispose()}addDrawable(e){if(this.drawableCount++,this.markDirtyDrawable(e),assertSlow){const t=_.indexOf(this.drawableList,e);assertSlow&&assertSlow(t===-1,"Drawable should not be added when it has not been removed"),this.drawableList.push(e),assertSlow&&assertSlow(this.drawableCount===this.drawableList.length,"Count sanity check, to make sure our assertions are not buggy")}}removeDrawable(e){if(this.drawableCount--,this.markDirty(),assertSlow){const t=_.indexOf(this.drawableList,e);assertSlow&&assertSlow(t!==-1,"Drawable should be already added when it is removed"),this.drawableList.splice(t,1),assertSlow&&assertSlow(this.drawableCount===this.drawableList.length,"Count sanity check, to make sure our assertions are not buggy")}}onIntervalChange(e,t){}updateInterval(){(this.pendingFirstDrawable!==this.firstDrawable||this.pendingLastDrawable!==this.lastDrawable)&&(this.onIntervalChange(this.pendingFirstDrawable,this.pendingLastDrawable),this.firstDrawable=this.pendingFirstDrawable,this.lastDrawable=this.pendingLastDrawable)}notifyInterval(e,t){this.pendingFirstDrawable=e,this.pendingLastDrawable=t,this.updateInterval()}audit(e,t,i){if(assertSlow){super.audit(e,t,i);let s=0;if(!t){for(let n=this.firstDrawable;n!==null&&(n.audit(e,t,i),s++,n!==this.lastDrawable);n=n.nextDrawable);if(!e){assertSlow&&assertSlow(s===this.drawableCount,"drawableCount should match"),assertSlow&&assertSlow(this.firstDrawable===this.pendingFirstDrawable,"No pending first drawable"),assertSlow&&assertSlow(this.lastDrawable===this.pendingLastDrawable,"No pending last drawable");for(let n=this.firstDrawable;n!==null&&(assertSlow&&assertSlow(n.renderer===this.renderer,"Renderers should match"),assertSlow&&assertSlow(n.parentDrawable===this,"This block should be this drawable's parent"),assertSlow&&assertSlow(_.indexOf(this.drawableList,n)>=0),n!==this.lastDrawable);n=n.nextDrawable);}}}}}te.register("Block",Oy);const Nr=Oy,df=$e.NOTHING.copy();class es extends Nr{initialize(e,t,i,s){return super.initialize(e,t),this.transformRootInstance=i,assert&&assert(typeof i.isDisplayRoot=="boolean"),this.canBeFullDisplay=i.isDisplayRoot,assert&&assert(s===es.FULL_DISPLAY||s===es.COMMON_ANCESTOR),this.preferredFit=s,this.fit=s,this.dirtyFit=!0,this.commonFitInstance=null,this.fitBounds=$e.NOTHING.copy(),this.oldFitBounds=$e.NOTHING.copy(),this.unfittableDrawableCount=0,this.dirtyFitListener=this.dirtyFitListener||this.markDirtyFit.bind(this),this.fittableListener=this.fittableListener||this.onFittabilityChange.bind(this),this.display.sizeProperty.lazyLink(this.dirtyFitListener),this}setFit(e){!this.canBeFullDisplay&&e===es.FULL_DISPLAY&&(e=es.COMMON_ANCESTOR),this.fit!==e&&(this.fit=e,this.markDirtyFit(),this.oldFitBounds.set($e.NOTHING),e===es.COMMON_ANCESTOR&&this.removeCommonFitInstance())}markDirtyFit(){sceneryLog&&sceneryLog.dirty&&sceneryLog.dirty(`markDirtyFit on FittedBlock#${this.id}`),this.dirtyFit=!0,this.markDirty()}updateFit(){if(assert&&assert(this.fit===es.FULL_DISPLAY||this.fit===es.COMMON_ANCESTOR,"Unsupported fit"),!(!this.dirtyFit&&this.fit===es.FULL_DISPLAY))if(sceneryLog&&sceneryLog.FittedBlock&&sceneryLog.FittedBlock(`updateFit #${this.id}`),this.dirtyFit=!1,this.fit===es.COMMON_ANCESTOR&&this.commonFitInstance===null&&this.addCommonFitInstance(this.computeCommonAncestorInstance()),this.fit===es.COMMON_ANCESTOR&&this.commonFitInstance.fittability.subtreeUnfittableCount>0&&this.canBeFullDisplay&&(this.oldFitBounds.set($e.NOTHING),this.fit=es.FULL_DISPLAY),this.fit===es.FULL_DISPLAY)this.fitBounds.set($e.NOTHING),this.setSizeFullDisplay();else if(this.fit===es.COMMON_ANCESTOR){assert&&assert(this.commonFitInstance.trail.length>=this.transformRootInstance.trail.length),this.fitBounds.set(this.commonFitInstance.node.getLocalBounds());let e=this.commonFitInstance;for(;e!==this.transformRootInstance;)this.fitBounds.transform(e.node.getMatrix()),e=e.parent;this.fitBounds.roundOut(),this.fitBounds.dilate(4),this.transformRootInstance.isDisplayRoot&&(df.setMinMax(0,0,this.display.width,this.display.height),this.fitBounds.constrainBounds(df)),this.fitBounds.isValid()||this.fitBounds.setMinMax(0,0,0,0),this.fitBounds.equals(this.oldFitBounds)||(this.oldFitBounds.set(this.fitBounds),this.setSizeFitBounds())}else throw new Error("unknown fit")}setSizeFullDisplay(){}setSizeFitBounds(){}addCommonFitInstance(e){assert&&assert(this.commonFitInstance===null),e&&(this.commonFitInstance=e,this.commonFitInstance.fittability.subtreeFittabilityChangeEmitter.addListener(this.dirtyFitListener))}removeCommonFitInstance(){this.commonFitInstance&&(this.commonFitInstance.fittability.subtreeFittabilityChangeEmitter.removeListener(this.dirtyFitListener),this.commonFitInstance=null)}dispose(){sceneryLog&&sceneryLog.FittedBlock&&sceneryLog.FittedBlock(`dispose #${this.id}`),this.display.sizeProperty.unlink(this.dirtyFitListener),this.removeCommonFitInstance(),this.transformRootInstance=null,super.dispose()}addDrawable(e){super.addDrawable(e),e.fittableProperty.lazyLink(this.fittableListener),e.fittable||this.incrementUnfittable()}removeDrawable(e){super.removeDrawable(e),e.fittableProperty.unlink(this.fittableListener),e.fittable||this.decrementUnfittable()}onFittabilityChange(e){e?this.decrementUnfittable():this.incrementUnfittable()}incrementUnfittable(){this.unfittableDrawableCount++,this.unfittableDrawableCount===1&&this.checkFitConstraints()}decrementUnfittable(){this.unfittableDrawableCount--,this.unfittableDrawableCount===0&&this.checkFitConstraints()}checkFitConstraints(){this.unfittableDrawableCount>0&&this.canBeFullDisplay?this.setFit(es.FULL_DISPLAY):this.setFit(this.preferredFit)}computeCommonAncestorInstance(){assert&&assert(this.firstDrawable.instance&&this.lastDrawable.instance,"For common-ancestor fits, we need the first and last drawables to have direct instance references");let e=this.firstDrawable.instance,t=this.lastDrawable.instance;const i=Math.min(e.trail.length,t.trail.length);for(;e.trail.length>i;)e=e.parent;for(;t.trail.length>i;)t=t.parent;for(;e!==t;)e=e.parent,t=t.parent;const s=e;return assert&&assert(s.trail.length>=this.transformRootInstance.trail.length),s}onIntervalChange(e,t){sceneryLog&&sceneryLog.FittedBlock&&sceneryLog.FittedBlock(`#${this.id}.onIntervalChange ${e.toString()} to ${t.toString()}`),super.onIntervalChange(e,t),this.fit===es.COMMON_ANCESTOR&&(this.removeCommonFitInstance(),this.markDirtyFit())}}te.register("FittedBlock",es);es.FULL_DISPLAY=1;es.COMMON_ANCESTOR=2;es.fitString={1:"fullDisplay",2:"commonAncestor"};const Un=es,gf=new Ze,pf=new Ze;class ig extends Un{constructor(e,t,i,s){super(),this.initialize(e,t,i,s)}initialize(e,t,i,s){super.initialize(e,t,i,Un.COMMON_ANCESTOR),this.filterRootInstance=s,this.dirtyDrawables=vt(this.dirtyDrawables),this.domElement||(this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.left="0",this.canvas.style.top="0",this.canvas.style.pointerEvents="none",this.canvasId=this.canvas.id=`scenery-canvas${this.id}`,this.context=this.canvas.getContext("2d"),this.context.save(),this.context.miterLimit=20,this.context.miterLimit=10,this.wrapper=new Rr(this.canvas,this.context),this.domElement=this.canvas,this.wrapperStack=[this.wrapper]),this.wrapperStackIndex=0,this.filterListenerCountMap=this.filterListenerCountMap||{},Yt.prepareForTransform(this.canvas),Yt.unsetTransform(this.canvas),this.canvasDrawOffset=new Pe(0,0),this.currentDrawable=null,this.clipDirty=!0,this.clipCount=0,this.backingScale=t&de.bitmaskCanvasLowResolution?1:Yt.backingScale(this.context),this.clipDirtyListener=this.markDirty.bind(this),this.opacityDirtyListener=this.markDirty.bind(this),sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`initialized #${this.id}`)}setSizeFullDisplay(){const e=this.display.getSize();this.canvas.width=e.width*this.backingScale,this.canvas.height=e.height*this.backingScale,this.canvas.style.width=`${e.width}px`,this.canvas.style.height=`${e.height}px`,this.wrapper.resetStyles(),this.canvasDrawOffset.setXY(0,0),Yt.unsetTransform(this.canvas)}setSizeFitBounds(){const e=this.fitBounds.minX,t=this.fitBounds.minY;this.canvasDrawOffset.setXY(-e,-t),Yt.setTransform(`matrix(1,0,0,1,${e},${t})`,this.canvas),this.canvas.width=this.fitBounds.width*this.backingScale,this.canvas.height=this.fitBounds.height*this.backingScale,this.canvas.style.width=`${this.fitBounds.width}px`,this.canvas.style.height=`${this.fitBounds.height}px`,this.wrapper.resetStyles()}update(){if(!super.update())return!1;for(sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`update #${this.id}`),sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.push();this.dirtyDrawables.length;)this.dirtyDrawables.pop().update();this.updateFit(),this.context.restore(),this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.save(),this.wrapper.resetStyles(),this.currentDrawable=null;for(let e=this.firstDrawable;e!==null&&(this.renderDrawable(e),e!==this.lastDrawable);e=e.nextDrawable);return this.currentDrawable&&this.walkDown(this.currentDrawable.instance.trail,0),assert&&assert(this.clipCount===0,"clipCount should be zero after walking back down"),sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.pop(),!0}applyClip(e){this.clipDirty=!1,sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`Apply clip ${e.instance.trail.toDebugString()}`),sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.push();const t=this.wrapperStack[this.wrapperStackIndex],i=t.context;if(i.restore(),i.save(),t.resetStyles(),this.clipCount){const n=e.instance.trail;gf.rowMajor(this.backingScale,0,this.canvasDrawOffset.x*this.backingScale,0,this.backingScale,this.canvasDrawOffset.y*this.backingScale,0,0,1),pf.set(this.transformRootInstance.trail.getMatrix()).invert(),pf.multiplyMatrix(gf).canvasSetTransform(i);for(let o=0;o<n.length;o++){const c=n.nodes[o];c.getMatrix().canvasAppendTransform(i),c.hasClipArea()&&(i.beginPath(),c.clipArea.writeToContext(i),i.clip())}}sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.pop()}pushWrapper(){if(this.wrapperStackIndex++,this.clipDirty=!0,this.wrapperStackIndex===this.wrapperStack.length){const i=document.createElement("canvas"),s=i.getContext("2d");s.save(),this.wrapperStack.push(new Rr(i,s))}const e=this.wrapperStack[this.wrapperStackIndex],t=e.context;e.setDimensions(this.canvas.width,this.canvas.height),t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,this.canvas.width,this.canvas.height)}popWrapper(){this.wrapperStackIndex--,this.clipDirty=!0}walkDown(e,t){const i=this.filterRootInstance.trail.length-1;for(let s=e.length-1;s>=t;s--){const n=e.nodes[s];if(n.hasClipArea()&&(sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`Pop clip ${e.subtrailTo(n).toDebugString()}`),this.clipCount--,this.clipDirty=!0),s>i){if(n._filters.length){sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`Pop filters ${e.subtrailTo(n).toDebugString()}`);const o=this.wrapperStack[this.wrapperStackIndex],c=this.wrapperStack[this.wrapperStackIndex-1];this.popWrapper(),c.context.setTransform(1,0,0,1,0,0);const p=n._filters;let f=ht.canvasFilter;for(let w=0;w<p.length;w++)f=f&&p[w].isDOMCompatible();if(f){let w="";for(let O=0;O<p.length;O++)w+=`${w?" ":""}${p[O].getCSSFilterString()}`;c.context.filter=w,c.context.drawImage(o.canvas,0,0),c.context.filter="none"}else{for(let w=0;w<p.length;w++)p[w].applyCanvasFilter(o);c.context.drawImage(o.canvas,0,0)}}if(n.getEffectiveOpacity()!==1){sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`Pop opacity ${e.subtrailTo(n).toDebugString()}`);const o=this.wrapperStack[this.wrapperStackIndex],c=this.wrapperStack[this.wrapperStackIndex-1];this.popWrapper(),c.context.setTransform(1,0,0,1,0,0),c.context.globalAlpha=n.getEffectiveOpacity(),c.context.drawImage(o.canvas,0,0),c.context.globalAlpha=1}}}}walkUp(e,t){const i=this.filterRootInstance.trail.length-1;for(let s=t;s<e.length;s++){const n=e.nodes[s];s>i&&(n.getEffectiveOpacity()!==1&&(sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`Push opacity ${e.subtrailTo(n).toDebugString()}`),this.pushWrapper()),n._filters.length&&(sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`Push filters ${e.subtrailTo(n).toDebugString()}`),this.pushWrapper())),n.hasClipArea()&&(sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`Push clip ${e.subtrailTo(n).toDebugString()}`),this.clipCount++,this.clipDirty=!0)}}renderDrawable(e){if(!e.visible||this.canvas.width===0||this.canvas.height===0)return;sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`renderDrawable #${e.id} ${e.instance.trail.toDebugString()}`),sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.push();const t=this.currentDrawable?e.instance.getBranchIndexTo(this.currentDrawable.instance):0;this.currentDrawable&&this.walkDown(this.currentDrawable.instance.trail,t),this.walkUp(e.instance.trail,t);const i=this.wrapperStack[this.wrapperStackIndex],s=i.context;this.clipDirty&&this.applyClip(e),assert&&assert(e.instance.relativeTransform.isValidationNotNeeded());const n=e.instance.relativeTransform.matrix;s.setTransform(this.backingScale,0,0,this.backingScale,this.canvasDrawOffset.x*this.backingScale,this.canvasDrawOffset.y*this.backingScale),e.instance!==this.transformRootInstance&&n.canvasAppendTransform(s),e.paintCanvas(i,e.instance.node,e.instance.relativeTransform.matrix),this.currentDrawable=e,sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.pop()}dispose(){sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`dispose #${this.id}`),this.transformRootInstance=null,vt(this.dirtyDrawables),this.canvas.width=0,this.canvas.height=0,super.dispose()}markDirtyDrawable(e){sceneryLog&&sceneryLog.dirty&&sceneryLog.dirty(`markDirtyDrawable on CanvasBlock#${this.id} with ${e.toString()}`),assert&&assert(e),assert&&this.display.ensureNotPainting(),this.dirtyDrawables.push(e),this.markDirty()}addDrawable(e){sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`#${this.id}.addDrawable ${e.toString()}`),super.addDrawable(e);for(let t=e.instance;t&&t!==this.filterRootInstance;t=t.parent){const i=t.node;this.filterListenerCountMap[i.id]?this.filterListenerCountMap[i.id]++:(this.filterListenerCountMap[i.id]=1,i.filterChangeEmitter.addListener(this.opacityDirtyListener),i.clipAreaProperty.lazyLink(this.clipDirtyListener))}}removeDrawable(e){sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`#${this.id}.removeDrawable ${e.toString()}`);for(let t=e.instance;t&&t!==this.filterRootInstance;t=t.parent){const i=t.node;assert&&assert(this.filterListenerCountMap[i.id]>0),this.filterListenerCountMap[i.id]--,this.filterListenerCountMap[i.id]===0&&(delete this.filterListenerCountMap[i.id],i.clipAreaProperty.unlink(this.clipDirtyListener),i.filterChangeEmitter.removeListener(this.opacityDirtyListener))}super.removeDrawable(e)}onIntervalChange(e,t){sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`#${this.id}.onIntervalChange ${e.toString()} to ${t.toString()}`),super.onIntervalChange(e,t),this.markDirty()}onPotentiallyMovedDrawable(e){sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`#${this.id}.onPotentiallyMovedDrawable ${e.toString()}`),sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.push(),assert&&assert(e.parentDrawable===this),e.markDirty(),sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.pop()}toString(){return`CanvasBlock#${this.id}-${Un.fitString[this.fit]}`}}te.register("CanvasBlock",ig);di.mixInto(ig);const sg=ig;class ng extends Nr{constructor(e,t){super(),this.initialize(e,t)}initialize(e,t){return super.initialize(e,t.renderer),this.domDrawable=t,this.domElement=t.domElement,this}update(){return super.update()?(this.domDrawable.update(),!0):!1}dispose(){this.domDrawable=null,this.domElement=null,super.dispose()}markDirtyDrawable(e){this.markDirty()}addDrawable(e){sceneryLog&&sceneryLog.DOMBlock&&sceneryLog.DOMBlock(`#${this.id}.addDrawable ${e.toString()}`),assert&&assert(this.domDrawable===e,"DOMBlock should only be used with one drawable for now (the one it was initialized with)"),super.addDrawable(e)}removeDrawable(e){sceneryLog&&sceneryLog.DOMBlock&&sceneryLog.DOMBlock(`#${this.id}.removeDrawable ${e.toString()}`),assert&&assert(this.domDrawable===e,"DOMBlock should only be used with one drawable for now (the one it was initialized with)"),super.removeDrawable(e)}}te.register("DOMBlock",ng);di.mixInto(ng);const My=ng;class rg extends Un{constructor(e,t,i,s){super(),this.initialize(e,t,i,s)}initialize(e,t,i,s){super.initialize(e,t,i,Un.COMMON_ANCESTOR),this.filterRootInstance=s,this.dirtyGradients=vt(this.dirtyGradients),this.dirtyGroups=vt(this.dirtyGroups),this.dirtyDrawables=vt(this.dirtyDrawables),this.paintCountMap=this.paintCountMap||new Qf(this.onAddPaint.bind(this),this.onRemovePaint.bind(this)),this.areReferencesReduced=!0,this.domElement||(this.svg=document.createElementNS(li,"svg"),this.svg.style.pointerEvents="none",this.svg.style.position="absolute",this.svg.style.left="0",this.svg.style.top="0",this.svg.setAttribute("focusable",!1),this.defs=document.createElementNS(li,"defs"),this.svg.appendChild(this.defs),this.baseTransformGroup=document.createElementNS(li,"g"),this.svg.appendChild(this.baseTransformGroup),this.domElement=this.svg),this.forceRefreshListener=()=>{if(!this.workaroundRect){const f=document.createElementNS(li,"g");this.svg.appendChild(f),this.workaroundRect=document.createElementNS(li,"rect"),this.workaroundRect.setAttribute("width","0"),this.workaroundRect.setAttribute("height","0"),this.workaroundRect.setAttribute("fill","none"),f.appendChild(this.workaroundRect)}const o=Ba.nextIntBetween(0,255),c=Ba.nextIntBetween(0,255),p=Ba.nextIntBetween(0,255);this.workaroundRect.setAttribute("fill",`rgba(${o},${c},${p},0.02)`)},this.display._refreshSVGEmitter.addListener(this.forceRefreshListener),Yt.prepareForTransform(this.svg),Yt.unsetTransform(this.svg),this.baseTransformGroup.setAttribute("transform","");const n=i.trail.nodes.length>s.trail.nodes.length?s:i;return this.rootGroup=Dn.createFromPool(this,n,null),this.baseTransformGroup.appendChild(this.rootGroup.svgGroup),sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`initialized #${this.id}`),this}onAddPaint(e){const t=e.createSVGPaint(this);return t.definition.setAttribute("id",`${e.id}-${this.id}`),this.defs.appendChild(t.definition),t}onRemovePaint(e,t){this.defs.removeChild(t.definition),t.dispose()}incrementPaint(e){assert&&assert(e.isPaint),sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`incrementPaint ${this} ${e}`),this.paintCountMap.increment(e)}decrementPaint(e){assert&&assert(e.isPaint),sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`decrementPaint ${this} ${e}`),this.paintCountMap.decrement(e)}markDirtyGradient(e){this.dirtyGradients.push(e),this.markDirty()}markDirtyGroup(e){this.dirtyGroups.push(e),this.markDirty(),this.areReferencesReduced&&this.display.markForReducedReferences(this),this.areReferencesReduced=!1}markDirtyDrawable(e){sceneryLog&&sceneryLog.dirty&&sceneryLog.dirty(`markDirtyDrawable on SVGBlock#${this.id} with ${e.toString()}`),this.dirtyDrawables.push(e),this.markDirty(),this.areReferencesReduced&&this.display.markForReducedReferences(this),this.areReferencesReduced=!1}setSizeFullDisplay(){sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`setSizeFullDisplay #${this.id}`),this.baseTransformGroup.removeAttribute("transform"),Yt.unsetTransform(this.svg);const e=this.display.getSize();this.svg.setAttribute("width",e.width),this.svg.setAttribute("height",e.height)}setSizeFitBounds(){sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`setSizeFitBounds #${this.id} with ${this.fitBounds.toString()}`);const e=this.fitBounds.minX,t=this.fitBounds.minY;assert&&assert(isFinite(e)&&isFinite(t),"Invalid SVG transform for SVGBlock"),assert&&assert(this.fitBounds.isValid(),"Invalid fitBounds"),this.baseTransformGroup.setAttribute("transform",`translate(${-e},${-t})`),Yt.setTransform(`matrix(1,0,0,1,${e},${t})`,this.svg),this.svg.setAttribute("width",this.fitBounds.width),this.svg.setAttribute("height",this.fitBounds.height)}update(){if(!super.update())return!1;for(sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`update #${this.id}`);this.dirtyGroups.length;){const e=this.dirtyGroups.pop();e.block===this&&e.update()}for(;this.dirtyGradients.length;)this.dirtyGradients.pop().update();for(;this.dirtyDrawables.length;){const e=this.dirtyDrawables.pop();e.parentDrawable===this&&e.update()}return this.areReferencesReduced=!0,this.updateFit(),!0}reduceReferences(){if(this.areReferencesReduced)return;let e=0,t=0;for(;e<this.dirtyGroups.length;){const i=this.dirtyGroups[e];i.block===this&&(t!==e&&(this.dirtyGroups[t]=i),t++),e++}for(;this.dirtyGroups.length>t;)this.dirtyGroups.pop();for(e=0,t=0;e<this.dirtyDrawables.length;){const i=this.dirtyDrawables[e];i.parentDrawable===this&&(t!==e&&(this.dirtyDrawables[t]=i),t++),e++}for(;this.dirtyDrawables.length>t;)this.dirtyDrawables.pop();this.areReferencesReduced=!0}dispose(){for(sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`dispose #${this.id}`),this.svg.setAttribute("width","0"),this.svg.setAttribute("height","0"),this.filterRootInstance=null,vt(this.dirtyGradients),vt(this.dirtyGroups),vt(this.dirtyDrawables),this.paintCountMap.clear(),this.display._refreshSVGEmitter.removeListener(this.forceRefreshListener),this.baseTransformGroup.removeChild(this.rootGroup.svgGroup),this.rootGroup.dispose(),this.rootGroup=null;this.defs.childNodes.length;)this.defs.removeChild(this.defs.childNodes[0]);super.dispose()}addDrawable(e){sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`#${this.id}.addDrawable ${e.toString()}`),super.addDrawable(e),Dn.addDrawable(this,e),e.updateSVGBlock(this)}removeDrawable(e){sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`#${this.id}.removeDrawable ${e.toString()}`),Dn.removeDrawable(this,e),super.removeDrawable(e)}onIntervalChange(e,t){sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`#${this.id}.onIntervalChange ${e.toString()} to ${t.toString()}`),super.onIntervalChange(e,t)}toString(){return`SVGBlock#${this.id}-${Un.fitString[this.fit]}`}}te.register("SVGBlock",rg);di.mixInto(rg);class ag extends Un{constructor(e,t,i,s){super(),this.initialize(e,t,i,s)}initialize(e,t,i,s){return sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`initialize #${this.id}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push(),super.initialize(e,t,i,Un.FULL_DISPLAY),this.filterRootInstance=s,this.preserveDrawingBuffer=e._preserveDrawingBuffer,this.dirtyDrawables=vt(this.dirtyDrawables),this.spriteSheets=this.spriteSheets||[],this.projectionMatrix=this.projectionMatrix||new Ze,this.projectionMatrixArray=new Float32Array(9),this.customProcessor=this.customProcessor||new vP,this.vertexColorPolygonsProcessor=this.vertexColorPolygonsProcessor||new LP(this.projectionMatrixArray),this.texturedTrianglesProcessor=this.texturedTrianglesProcessor||new PP(this.projectionMatrixArray),this.glChangedEmitter=new ri,this.isContextLost=!1,this.contextLostListener=this.onContextLoss.bind(this),this.contextRestoreListener=this.onContextRestoration.bind(this),this.domElement||(this.domElement=document.createElement("div"),this.domElement.className="webgl-container",this.domElement.style.position="absolute",this.domElement.style.left="0",this.domElement.style.top="0",this.rebuildCanvas()),this.gl.clear(this.gl.COLOR_BUFFER_BIT),Yt.prepareForTransform(this.canvas),Yt.unsetTransform(this.canvas),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop(),this}rebuildCanvas(){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`rebuildCanvas #${this.id}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push();const e=document.createElement("canvas"),t=this.getContextFromCanvas(e);assert&&assert(t||this.canvas,"We should have a WebGL context by now"),t&&(this.canvas&&(this.domElement.removeChild(this.canvas),this.canvas.removeEventListener("webglcontextlost",this.contextLostListener,!1),this.canvas.removeEventListener("webglcontextrestored",this.contextRestoreListener,!1)),this.canvas=e,this.canvas.style.pointerEvents="none",this.canvasId=this.canvas.id=`scenery-webgl${this.id}`,this.canvas.addEventListener("webglcontextlost",this.contextLostListener,!1),this.canvas.addEventListener("webglcontextrestored",this.contextRestoreListener,!1),this.domElement.appendChild(this.canvas),this.setupContext(t)),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop()}setupContext(e){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`setupContext #${this.id}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push(),assert&&assert(e,"Should have an actual context if this is called"),this.isContextLost=!1,this.gl=e,this.backingScale=Yt.backingScale(this.gl),this.display._allowBackingScaleAntialiasing&&e.getParameter(e.SAMPLES)===0&&(this.backingScale*=2),this.originalBackingScale=this.backingScale,Yt.applyWebGLContextDefaults(this.gl),this.markDirty(),this.dirtyFit=!0,this.customProcessor.initializeContext(this.gl),this.vertexColorPolygonsProcessor.initializeContext(this.gl),this.texturedTrianglesProcessor.initializeContext(this.gl);for(let t=0;t<this.spriteSheets.length;t++)this.spriteSheets[t].initializeContext(this.gl);this.glChangedEmitter.emit(),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop()}delayedRebuildCanvas(){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`Delaying rebuilding of Canvas #${this.id}`);const e=this;e.setTimeout(function(){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`Executing delayed rebuilding #${this.id}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push(),e.rebuildCanvas(),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop()})}onContextLoss(e){this.isContextLost||(sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`Context lost #${this.id}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push(),this.isContextLost=!0,e.preventDefault(),this.canvas.style.display="none",this.markDirty(),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop())}onContextRestoration(e){if(this.isContextLost){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`Context restored #${this.id}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push();const t=this.getContextFromCanvas(this.canvas);assert&&assert(t,"We were told the context was restored, so this should work"),this.setupContext(t),this.canvas.style.display="",sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop()}}getContextFromCanvas(e){const t={antialias:!0,preserveDrawingBuffer:this.preserveDrawingBuffer};return e.getContext("webgl",t)||e.getContext("experimental-webgl",t)}setSizeFullDisplay(){const e=this.display.getSize();this.canvas.width=Math.ceil(e.width*this.backingScale),this.canvas.height=Math.ceil(e.height*this.backingScale),this.canvas.style.width=`${e.width}px`,this.canvas.style.height=`${e.height}px`}setSizeFitBounds(){throw new Error("setSizeFitBounds unimplemented for WebGLBlock")}update(){if(!super.update())return!1;sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`update #${this.id}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push();const e=this.gl;for(this.isContextLost&&this.display._aggressiveContextRecreation&&this.delayedRebuildCanvas();this.dirtyDrawables.length;)this.dirtyDrawables.pop().update();const t=this.spriteSheets.length;for(let n=0;n<t;n++)this.spriteSheets[n].updateTexture();this.firstDrawable&&this.firstDrawable===this.lastDrawable&&this.firstDrawable.node&&this.firstDrawable.node._webglScale!==null&&this.backingScale!==this.originalBackingScale*this.firstDrawable.node._webglScale&&(this.backingScale=this.originalBackingScale*this.firstDrawable.node._webglScale,this.dirtyFit=!0),this.updateFit(),this.projectionMatrix.rowMajor(2/this.display.width,0,-1,0,-2/this.display.height,1,0,0,1),this.projectionMatrix.copyToArray(this.projectionMatrixArray),this.preserveDrawingBuffer&&e.clear(e.COLOR_BUFFER_BIT),e.viewport(0,0,this.canvas.width,this.canvas.height);let i=null,s=0;for(let n=this.firstDrawable;n!==null;n=n.nextDrawable){if(n.visible){let o=null;n.webglRenderer===de.webglTexturedTriangles?o=this.texturedTrianglesProcessor:n.webglRenderer===de.webglCustom?o=this.customProcessor:n.webglRenderer===de.webglVertexColorPolygons&&(o=this.vertexColorPolygonsProcessor),assert&&assert(o),o!==i&&(i&&(s+=i.deactivate()),i=o,i.activate()),i.processDrawable(n)}if(n===this.lastDrawable)break}return i&&(s+=i.deactivate()),s===0&&!this.preserveDrawingBuffer&&e.clear(e.COLOR_BUFFER_BIT),e.flush(),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop(),!0}dispose(){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`dispose #${this.id}`),vt(this.dirtyDrawables),super.dispose()}markDirtyDrawable(e){sceneryLog&&sceneryLog.dirty&&sceneryLog.dirty(`markDirtyDrawable on WebGLBlock#${this.id} with ${e.toString()}`),assert&&assert(e),assert&&assert(!e.isDisposed),this.dirtyDrawables.push(e),this.markDirty()}addDrawable(e){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`#${this.id}.addDrawable ${e.toString()}`),super.addDrawable(e),e.onAddToBlock(this)}removeDrawable(e){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`#${this.id}.removeDrawable ${e.toString()}`);let t=0;for(;(t=this.dirtyDrawables.indexOf(e,t))>=0;)this.dirtyDrawables.splice(t,1);e.onRemoveFromBlock(this),super.removeDrawable(e)}addSpriteSheetImage(e,t,i){let s=null;const n=this.spriteSheets.length;for(let o=0;o<n&&(s=this.spriteSheets[o].addImage(e,t,i),!s);o++);if(!s){const o=new Fr(!0);if(s=o.addImage(e,t,i),o.initializeContext(this.gl),this.spriteSheets.push(o),!s)throw new Error("Attempt to load image that is too large for sprite sheets")}return s}removeSpriteSheetImage(e){e.spriteSheet.removeImage(e.image)}onIntervalChange(e,t){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`#${this.id}.onIntervalChange ${e.toString()} to ${t.toString()}`),super.onIntervalChange(e,t),this.markDirty()}onPotentiallyMovedDrawable(e){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`#${this.id}.onPotentiallyMovedDrawable ${e.toString()}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push(),assert&&assert(e.parentDrawable===this),this.markDirty(),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop()}toString(){return`WebGLBlock#${this.id}-${Un.fitString[this.fit]}`}}te.register("WebGLBlock",ag);class og{activate(){}initializeContext(e){}processDrawable(e){}deactivate(){}}class vP extends og{constructor(){super(),this.drawable=null}activate(){this.drawCount=0}processDrawable(e){assert&&assert(e.webglRenderer===de.webglCustom),this.drawable=e,this.draw()}deactivate(){return this.drawCount}draw(){if(this.drawable){const e=this.drawable.draw();assert&&assert(typeof e=="number"),this.drawCount+=e,this.drawable=null}}}class LP extends og{constructor(e){assert&&assert(e instanceof Float32Array),super(),this.projectionMatrixArray=e,this.lastArrayLength=128,this.vertexArray=new Float32Array(this.lastArrayLength)}initializeContext(e){assert&&assert(e,"Should be an actual context"),this.gl=e,this.shaderProgram=new Vh(e,["attribute vec2 aVertex;","attribute vec4 aColor;","varying vec4 vColor;","uniform mat3 uProjectionMatrix;","void main() {","  vColor = aColor;","  vec3 ndc = uProjectionMatrix * vec3( aVertex, 1.0 );","  gl_Position = vec4( ndc.xy, 0.0, 1.0 );","}"].join(`
`),["precision mediump float;","varying vec4 vColor;","void main() {","  gl_FragColor = vec4( vColor.rgb * vColor.a, vColor.a );","}"].join(`
`),{attributes:["aVertex","aColor"],uniforms:["uProjectionMatrix"]}),this.vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertexArray,e.DYNAMIC_DRAW)}activate(){this.shaderProgram.use(),this.vertexArrayIndex=0,this.drawCount=0}processDrawable(e){if(e.includeVertices){const t=e.vertexArray;for(;t.length+this.vertexArrayIndex>this.vertexArray.length;){const i=new Float32Array(this.vertexArray.length*2);i.set(this.vertexArray),this.vertexArray=i}this.vertexArray.set(t,this.vertexArrayIndex),this.vertexArrayIndex+=t.length,this.drawCount++}}deactivate(){return this.drawCount&&this.draw(),this.shaderProgram.unuse(),this.drawCount}draw(){const e=this.gl;e.uniformMatrix3fv(this.shaderProgram.uniformLocations.uProjectionMatrix,!1,this.projectionMatrixArray),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray.length>this.lastArrayLength?e.bufferData(e.ARRAY_BUFFER,this.vertexArray,e.DYNAMIC_DRAW):e.bufferSubData(e.ARRAY_BUFFER,0,this.vertexArray.subarray(0,this.vertexArrayIndex));const t=Float32Array.BYTES_PER_ELEMENT,i=6*t;e.vertexAttribPointer(this.shaderProgram.attributeLocations.aVertex,2,e.FLOAT,!1,i,0*t),e.vertexAttribPointer(this.shaderProgram.attributeLocations.aColor,4,e.FLOAT,!1,i,2*t),e.drawArrays(e.TRIANGLES,0,this.vertexArrayIndex/6),this.vertexArrayIndex=0}}class PP extends og{constructor(e){assert&&assert(e instanceof Float32Array),super(),this.projectionMatrixArray=e,this.lastArrayLength=128,this.vertexArray=new Float32Array(this.lastArrayLength)}initializeContext(e){assert&&assert(e,"Should be an actual context"),this.gl=e,this.shaderProgram=new Vh(e,["attribute vec2 aVertex;","attribute vec2 aTextureCoord;","attribute float aAlpha;","varying vec2 vTextureCoord;","varying float vAlpha;","uniform mat3 uProjectionMatrix;","void main() {","  vTextureCoord = aTextureCoord;","  vAlpha = aAlpha;","  vec3 ndc = uProjectionMatrix * vec3( aVertex, 1.0 );","  gl_Position = vec4( ndc.xy, 0.0, 1.0 );","}"].join(`
`),["precision mediump float;","varying vec2 vTextureCoord;","varying float vAlpha;","uniform sampler2D uTexture;","void main() {","  vec4 color = texture2D( uTexture, vTextureCoord, -0.7 );","  color.a *= vAlpha;","  gl_FragColor = color;","}"].join(`
`),{attributes:["aVertex","aTextureCoord","aAlpha"],uniforms:["uTexture","uProjectionMatrix"]}),this.vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertexArray,e.DYNAMIC_DRAW)}activate(){this.shaderProgram.use(),this.currentSpriteSheet=null,this.vertexArrayIndex=0,this.drawCount=0}processDrawable(e){if(!e.sprite)return;assert&&assert(e.webglRenderer===de.webglTexturedTriangles),this.currentSpriteSheet&&e.sprite.spriteSheet!==this.currentSpriteSheet&&this.draw(),this.currentSpriteSheet=e.sprite.spriteSheet;const t=e.vertexArray;for(;t.length+this.vertexArrayIndex>this.vertexArray.length;){const i=new Float32Array(this.vertexArray.length*2);i.set(this.vertexArray),this.vertexArray=i}this.vertexArray.set(t,this.vertexArrayIndex),this.vertexArrayIndex+=t.length}deactivate(){return this.currentSpriteSheet&&this.draw(),this.shaderProgram.unuse(),this.drawCount}draw(){assert&&assert(this.currentSpriteSheet);const e=this.gl;e.uniformMatrix3fv(this.shaderProgram.uniformLocations.uProjectionMatrix,!1,this.projectionMatrixArray),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray.length>this.lastArrayLength?e.bufferData(e.ARRAY_BUFFER,this.vertexArray,e.DYNAMIC_DRAW):e.bufferSubData(e.ARRAY_BUFFER,0,this.vertexArray.subarray(0,this.vertexArrayIndex));const t=5,i=Float32Array.BYTES_PER_ELEMENT,s=t*i;e.vertexAttribPointer(this.shaderProgram.attributeLocations.aVertex,2,e.FLOAT,!1,s,0*i),e.vertexAttribPointer(this.shaderProgram.attributeLocations.aTextureCoord,2,e.FLOAT,!1,s,2*i),e.vertexAttribPointer(this.shaderProgram.attributeLocations.aAlpha,1,e.FLOAT,!1,s,4*i),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.currentSpriteSheet.texture),e.uniform1i(this.shaderProgram.uniformLocations.uTexture,0),e.drawArrays(e.TRIANGLES,0,this.vertexArrayIndex/t),e.bindTexture(e.TEXTURE_2D,null),this.drawCount++,this.currentSpriteSheet=null,this.vertexArrayIndex=0}}di.mixInto(ag);const Ry=ag;class Gr{initialize(e,t,i,s,n,o,c){assert&&assert(o&&c,"We are guaranteed at least one change interval"),assert&&assert(!t||t.previousDrawable===null,"End boundary of drawable linked list should link to null"),assert&&assert(!i||i.nextDrawable===null,"End boundary of drawable linked list should link to null"),sceneryLog&&sceneryLog.Stitch&&(sceneryLog.Stitch(`stitch ${e.toString()} first:${t?t.toString():"null"} last:${i?i.toString():"null"} oldFirst:${s?s.toString():"null"} oldLast:${n?n.toString():"null"}`),sceneryLog.push()),sceneryLog&&sceneryLog.StitchDrawables&&(sceneryLog.StitchDrawables("Before:"),sceneryLog.push(),Gr.debugDrawables(s,n,o,c,!1),sceneryLog.pop(),sceneryLog.StitchDrawables("After:"),sceneryLog.push(),Gr.debugDrawables(t,i,o,c,!0),sceneryLog.pop()),this.backbone=e,this.firstDrawable=t,this.lastDrawable=i,this.touchedBlocks=vt(this.touchedBlocks),assertSlow&&(assertSlow(!this.initialized,"We should not be already initialized (clean should be called)"),this.initialized=!0,this.reindexed=!1,this.pendingAdditions=[],this.pendingRemovals=[],this.pendingMoves=[],this.createdBlocks=[],this.disposedBlocks=[],this.intervalsNotified=[],this.boundariesRecorded=!1,this.previousBlocks=e.blocks.slice(0))}clean(){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch("clean"),sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch("-----------------------------------"),assertSlow&&(this.auditStitch(),this.initialized=!1),this.backbone=null,this.firstDrawable=null,this.lastDrawable=null,sceneryLog&&sceneryLog.Stitch&&sceneryLog.pop()}recordBackboneBoundaries(){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`recording backbone boundaries: ${this.firstDrawable?this.firstDrawable.toString():"null"} to ${this.lastDrawable?this.lastDrawable.toString():"null"}`),this.backbone.previousFirstDrawable=this.firstDrawable,this.backbone.previousLastDrawable=this.lastDrawable,assertSlow&&(this.boundariesRecorded=!0)}notePendingAddition(e,t){assert&&assert(e.renderer===t.renderer),sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`pending add: ${e.toString()} to ${t.toString()}`),sceneryLog&&sceneryLog.Stitch&&sceneryLog.push(),e.notePendingAddition(this.backbone.display,t,this.backbone),assertSlow&&this.pendingAdditions.push({drawable:e,block:t}),sceneryLog&&sceneryLog.Stitch&&sceneryLog.pop()}notePendingMove(e,t){assert&&assert(e.renderer===t.renderer),sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`pending move: ${e.toString()} to ${t.toString()}`),sceneryLog&&sceneryLog.Stitch&&sceneryLog.push(),e.notePendingMove(this.backbone.display,t),assertSlow&&this.pendingMoves.push({drawable:e,block:t}),sceneryLog&&sceneryLog.Stitch&&sceneryLog.pop()}notePendingRemoval(e){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`pending remove: ${e.toString()}`),sceneryLog&&sceneryLog.Stitch&&sceneryLog.push(),e.notePendingRemoval(this.backbone.display),assertSlow&&this.pendingRemovals.push({drawable:e}),sceneryLog&&sceneryLog.Stitch&&sceneryLog.pop()}markBlockForDisposal(e){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`block for disposal: ${e.toString()}`),sceneryLog&&sceneryLog.Stitch&&sceneryLog.push(),e.domElement.parentNode===this.backbone.domElement&&this.backbone.domElement.removeChild(e.domElement),e.markForDisposal(this.backbone.display),assertSlow&&this.disposedBlocks.push({block:e}),sceneryLog&&sceneryLog.Stitch&&sceneryLog.pop()}removeAllBlocks(){for(sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`marking all blocks for disposal (count ${this.backbone.blocks.length})`),sceneryLog&&sceneryLog.Stitch&&sceneryLog.push();this.backbone.blocks.length;){const e=this.backbone.blocks[0];this.removeBlock(e),this.markBlockForDisposal(e)}sceneryLog&&sceneryLog.Stitch&&sceneryLog.pop()}notifyInterval(e,t,i){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`notify interval: ${e.toString()} ${t.toString()} to ${i.toString()}`),sceneryLog&&sceneryLog.Stitch&&sceneryLog.push(),e.notifyInterval(t,i),this.backbone.markDirtyDrawable(e),assertSlow&&this.intervalsNotified.push({block:e,firstDrawable:t,lastDrawable:i}),sceneryLog&&sceneryLog.Stitch&&sceneryLog.pop()}markBeforeBlock(e,t){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`marking block first drawable ${e.toString()} with ${t.toString()}`),e.pendingFirstDrawable=t,this.touchedBlocks.push(e)}markAfterBlock(e,t){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`marking block last drawable ${e.toString()} with ${t.toString()}`),e.pendingLastDrawable=t,this.touchedBlocks.push(e)}updateBlockIntervals(){for(;this.touchedBlocks.length;){const e=this.touchedBlocks.pop();e.used?(sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`update interval: ${e.toString()} ${e.pendingFirstDrawable.toString()} to ${e.pendingLastDrawable.toString()}`),e.updateInterval(),this.backbone.markDirtyDrawable(e),assertSlow&&this.intervalsNotified.push({block:e,firstDrawable:e.pendingFirstDrawable,lastDrawable:e.pendingLastDrawable})):sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`skipping update interval: ${e.toString()}, unused`)}}createBlock(e,t){const i=this.backbone;let s;if(de.isCanvas(e))s=sg.createFromPool(i.display,e,i.transformRootInstance,i.backboneInstance);else if(de.isSVG(e))s=rg.createFromPool(i.display,e,i.transformRootInstance,i.backboneInstance);else if(de.isDOM(e))s=My.createFromPool(i.display,t);else if(de.isWebGL(e))s=Ry.createFromPool(i.display,e,i.transformRootInstance,i.backboneInstance);else throw new Error(`unsupported renderer for createBlock: ${e}`);return sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`created block: ${s.toString()} with renderer: ${e} for drawable: ${t.toString()}`),s.setBlockBackbone(i),i.domElement.appendChild(s.domElement),i.isDisplayRoot&&s.domElement.setAttribute("aria-hidden",!0),i.markDirtyDrawable(s),assertSlow&&this.createdBlocks.push({block:s,renderer:e,drawable:t}),s}appendBlock(e){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`appending block: ${e.toString()}`),this.backbone.blocks.push(e),assertSlow&&(this.reindexed=!1)}removeBlock(e){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`removing block: ${e.toString()}`);const t=_.indexOf(this.backbone.blocks,e);assert&&assert(t>=0,`Cannot remove block, not attached: ${e.toString()}`),this.backbone.blocks.splice(t,1),assertSlow&&(this.reindexed=!1)}useNoBlocks(){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch("using no blocks"),vt(this.backbone.blocks)}reindex(){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch("reindexing blocks"),this.backbone.reindexBlocks(),assertSlow&&(this.reindexed=!0)}auditStitch(){if(assertSlow){const e=this.backbone.blocks,t=this.previousBlocks;if(assertSlow(this.initialized,"We seem to have finished a stitch without proper initialization"),assertSlow(this.boundariesRecorded,"Our stitch API requires recordBackboneBoundaries() to be called before it is finished."),assertSlow(this.reindexed||e.length===0||t.length===e.length&&_.every(_.zip(t,e),i=>i[0]===i[1]),"Did not reindex on a block change where we are left with blocks"),_.each(this.createdBlocks,i=>{assertSlow(_.some(this.intervalsNotified,s=>i.block===s.block),`Created block does not seem to have an interval notified: ${i.block.toString()}`)}),_.each(this.disposedBlocks,i=>{assertSlow(!_.some(this.intervalsNotified,s=>i.block===s.block),`Removed block seems to have an interval notified: ${i.block.toString()}`)}),_.each(this.disposedBlocks,i=>{const s=i.block;_.each(Zi.oldListToArray(s.firstDrawable,s.lastDrawable),n=>{assertSlow(_.some(this.pendingRemovals,o=>o.drawable===n)||_.some(this.pendingMoves,o=>o.drawable===n),`Drawable ${n.toString()} originally listed for disposed block ${s.toString()} does not seem to be marked for pending removal or move!`)})}),_.each(this.createdBlocks,i=>{const s=i.block;_.each(Zi.listToArray(s.pendingFirstDrawable,s.pendingLastDrawable),n=>{assertSlow(_.some(this.pendingAdditions,o=>o.drawable===n&&o.block===s)||_.some(this.pendingMoves,o=>o.drawable===n&&o.block===s),`Drawable ${n.toString()} now listed for created block ${s.toString()} does not seem to be marked for pending addition or move!`)})}),_.each(this.disposedBlocks,i=>{const s=_.indexOf(e,i.block);assertSlow(s<0,`Disposed block ${i.block.toString()} still present at index ${s}`)}),_.each(this.createdBlocks,i=>{const s=_.indexOf(e,i.block);assertSlow(s>=0,`Created block ${i.block.toString()} is not in the blocks array`)}),_.each(e,i=>{assertSlow(i.used,"All current blocks should be marked as used")}),assertSlow(e.length-t.length===this.createdBlocks.length-this.disposedBlocks.length,`The count of unmodified blocks should be constant (equal differences):
created: ${_.map(this.createdBlocks,i=>i.block.id).join(",")}
disposed: ${_.map(this.disposedBlocks,i=>i.block.id).join(",")}
before: ${_.map(t,i=>i.id).join(",")}
after: ${_.map(e,i=>i.id).join(",")}`),assertSlow(this.touchedBlocks.length===0,"If we marked any blocks for changes, we should have called updateBlockIntervals"),e.length){assertSlow(this.backbone.previousFirstDrawable!==null&&this.backbone.previousLastDrawable!==null,"If we are left with at least one block, we must be tracking at least one drawable"),assertSlow(e[0].pendingFirstDrawable===this.backbone.previousFirstDrawable,"Our first drawable should match the first drawable of our first block"),assertSlow(e[e.length-1].pendingLastDrawable===this.backbone.previousLastDrawable,"Our last drawable should match the last drawable of our last block");for(let i=0;i<e.length-1;i++)assertSlow(e[i].pendingLastDrawable.nextDrawable===e[i+1].pendingFirstDrawable&&e[i].pendingLastDrawable===e[i+1].pendingFirstDrawable.previousDrawable,"Consecutive blocks should have boundary drawables that are also consecutive in the linked list")}else assertSlow(this.backbone.previousFirstDrawable===null&&this.backbone.previousLastDrawable===null,"If we are left with no blocks, it must mean we are tracking precisely zero drawables")}}static debugIntervals(e){if(sceneryLog&&sceneryLog.Stitch)for(let t=e;t!==null;t=t.nextChangeInterval)sceneryLog.Stitch(`  interval: ${t.isEmpty()?"(empty) ":""}${t.drawableBefore?t.drawableBefore.toString():"-"} to ${t.drawableAfter?t.drawableAfter.toString():"-"}`)}static debugDrawables(e,t,i,s,n){if(sceneryLog&&sceneryLog.StitchDrawables){if(e===null){sceneryLog.StitchDrawables("nothing","color: #666;");return}let o=i.drawableBefore===null,c=i;for(let p=e;;p=n?p.nextDrawable:p.oldNextDrawable){o&&p===c.drawableAfter&&(o=!1,c=c.nextChangeInterval);const f=`${p.renderer} ${!n&&p.parentDrawable?p.parentDrawable.toString():""} ${p.toDetailedString()}`;if(sceneryLog.StitchDrawables(f,o?n?"color: #0a0;":"color: #a00;":"color: #666"),!o&&c&&c.drawableBefore===p&&(o=!0),p===t)break}}}}te.register("Stitcher",Gr);function wh(h,e){return h.renderer!==e.renderer||de.isDOM(h.renderer)||de.isDOM(e.renderer)}function iu(h){return h.previousDrawable!==null&&!wh(h.previousDrawable,h)}function su(h){return h.nextDrawable!==null&&!wh(h,h.nextDrawable)}function SP(h,e,t){return h.drawableBefore?h.drawableBefore.nextDrawable!==h.drawableAfter:h.drawableAfter?h.drawableAfter.previousDrawable!==h.drawableBefore:e!==null}function wP(h,e,t){return h.drawableBefore?h.drawableBefore.oldNextDrawable!==h.drawableAfter:h.drawableAfter?h.drawableAfter.oldPreviousDrawable!==h.drawableBefore:e!==null}function CP(h,e,t){const i=h.drawableBefore?h.drawableBefore.parentDrawable:null,s=h.drawableAfter?h.drawableAfter.parentDrawable:null;return i&&s&&i===s?!1:i?i.nextBlock!==s:s?s.previousBlock!==i:e!==null}function TP(h){const e=h.drawableAfter;if(e){const t=e.renderer,i=h.nextChangeInterval?h.nextChangeInterval.drawableBefore.nextDrawable:null;let s=e;for(;;){const n=s.nextDrawable;if(n!==i&&n.renderer===t)s=n;else break}return s}else return null}class Ny extends Gr{stitch(e,t,i,s,n,o,c){this.initialize(e,t,i,s,n,o,c),this.blockOrderChanged=!1,this.reusableBlocks=vt(this.reusableBlocks),this.blockWasAdded=!1;let p;if(this.recordBackboneBoundaries(),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.GreedyStitcher("phase 1: old linked list"),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.push(),e.blocks.length){const f=e.blocks[0];for(e.blocks[e.blocks.length-1],p=o;p!==null;p=p.nextChangeInterval){if(assert&&assert(!p.isEmpty(),"We now guarantee that the intervals are non-empty"),wP(p,s)){const w=p.drawableBefore?p.drawableBefore.oldNextDrawable:s,O=p.drawableAfter?p.drawableAfter.oldPreviousDrawable:n;for(let T=w;this.notePendingRemoval(T),T!==O;T=T.oldNextDrawable);}if(CP(p,f)){const w=p.drawableBefore===null?e.blocks[0]:p.drawableBefore.parentDrawable.nextBlock,O=p.drawableAfter===null?e.blocks[e.blocks.length-1]:p.drawableAfter.parentDrawable.previousBlock;for(let T=w;this.unuseBlock(T),T!==O;T=T.nextBlock);}}}if(sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.pop(),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.GreedyStitcher("phase 2: new linked list"),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.push(),t)for(p=o;p!==null;p=p.nextChangeInterval)this.processInterval(e,p,t,i);sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.pop(),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.GreedyStitcher("phase 3: cleanup"),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.push(),this.removeUnusedBlocks(),this.updateBlockIntervals(),t===null?this.useNoBlocks():this.blockOrderChanged&&(this.processBlockLinkedList(e,t.pendingParentDrawable,i.pendingParentDrawable),this.reindex()),this.clean(),vt(this.reusableBlocks),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.pop()}processInterval(e,t,i,s){if(assert&&assert(t instanceof sn),assert&&assert(i instanceof Zi,"We assume we have a non-null remaining section"),assert&&assert(s instanceof Zi,"We assume we have a non-null remaining section"),assert&&assert(!t.isEmpty(),"We now guarantee that the intervals are non-empty"),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`interval: ${t.drawableBefore?t.drawableBefore.toString():"null"} to ${t.drawableAfter?t.drawableAfter.toString():"null"}`),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push(),SP(t,i)){let n=t.drawableBefore?t.drawableBefore.nextDrawable:i,o=null,c=null,p=!0;for(;;){const f=n.nextDrawable,w=f===t.drawableAfter;if(assert&&assert(f!==null||w,"If our nextDrawable is null, isLast must be true"),o||(o=n),c===null&&n.parentDrawable&&!n.parentDrawable.used&&n.backbone===e&&n.parentDrawable.parentDrawable===e&&(c=n.parentDrawable,sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`matching at ${n.toString()} with ${c}`)),(w||wh(n,f))&&(p&&this.processEdgeCases(t,iu(o),su(n)),this.processSubBlock(t,o,n,c,p,w),o=null,c=null,p=!1),w)break;n=f}}else{if(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("no current internal drawables in interval"),t.drawableBefore&&t.drawableAfter){assert&&assert(t.drawableBefore.nextDrawable===t.drawableAfter);const n=!wh(t.drawableBefore,t.drawableAfter);this.processEdgeCases(t,n,n)}t.drawableBefore&&!su(t.drawableBefore)?(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("closed-after collapsed link:"),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push(),this.linkAfterDrawable(t.drawableBefore),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop()):t.drawableAfter&&!iu(t.drawableAfter)&&(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("closed-before collapsed link:"),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push(),this.linkBeforeDrawable(t.drawableAfter),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop())}sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop()}processSubBlock(e,t,i,s,n,o){sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`sub-block: ${t.toString()} to ${i.toString()} ${s?`with matched: ${s.toString()}`:"with no match"}`),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push();const c=iu(t),p=su(i);assert&&assert(!c||n,"openBefore implies isFirst"),assert&&assert(!p||o,"openAfter implies isLast"),assert&&assert(!c||!p||t.previousDrawable.pendingParentDrawable===i.nextDrawable.pendingParentDrawable,"If we would use both the before and after blocks, make sure any gluing "),c&&(s=t.previousDrawable.pendingParentDrawable,sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`combining into before block: ${s.toString()}`)),p&&(s=i.nextDrawable.pendingParentDrawable,sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`combining into after block: ${s.toString()}`)),s=this.ensureUsedBlock(s,t);for(let f=t;this.notePendingAddition(f,s),f!==i;f=f.nextDrawable);c||(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("closed-before link:"),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push(),this.linkBeforeDrawable(t),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop()),o&&!p&&(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("last closed-after link:"),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push(),this.linkAfterDrawable(i),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop()),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop()}processEdgeCases(e,t,i){if(e.drawableBefore!==null&&e.drawableAfter!==null){const s=e.drawableBefore.pendingParentDrawable,n=e.drawableAfter.pendingParentDrawable,o=e.nextChangeInterval&&e.nextChangeInterval.drawableAfter?e.nextChangeInterval.drawableAfter.pendingParentDrawable:null;s===n&&(this.blockWasAdded=!0),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`edge case: ${t?"open-before ":""}${i?"open-after ":""}${s.toString()} to ${n.toString()}`),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push();let c;t&&i?(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`glue using ${s.toString()}`),c=s):this.blockWasAdded||s===n?(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("split with fresh block"),c=this.createBlock(e.drawableAfter.renderer,e.drawableAfter),this.blockOrderChanged=!0):(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`split with same afterBlock ${n.toString()}`),c=n),n===c?(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("no externals change here (blockWasAdded => true)"),this.blockWasAdded=!0):(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("moving externals"),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push(),this.changeExternals(e,c),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop()),o!==n&&(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("end of afterBlock stretch"),this.blockWasAdded||(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`unusing ${n.toString()}`),this.unuseBlock(n)),this.blockWasAdded=!1),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop()}}changeExternals(e,t){const i=TP(e);this.notePendingMoves(t,e.drawableAfter,i),(!e.nextChangeInterval||e.nextChangeInterval.drawableBefore!==i)&&this.linkAfterDrawable(i)}notePendingMoves(e,t,i){for(let s=t;assert&&assert(!s.pendingAddition&&!s.pendingRemoval,"Moved drawables should be thought of as unchanged, and thus have nothing pending yet"),this.notePendingMove(s,e),s!==i;s=s.nextDrawable);}ensureUsedBlock(e,t){return e?(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`using existing block: ${e.toString()}`),e.used||this.useBlock(e)):(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("searching for block"),e=this.getBlockForRenderer(t.renderer,t)),e}getBlockForRenderer(e,t){let i;if(!de.isDOM(e))for(let s=this.reusableBlocks.length-1;s>=0;s--){const n=this.reusableBlocks[s];if(assert&&assert(!n.used),n.renderer===e){this.useBlockAtIndex(n,s),i=n;break}}return i||(i=this.createBlock(e,t)),this.blockOrderChanged=!0,i}unuseBlock(e){e.used?(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`unusing block: ${e.toString()}`),e.used=!1,this.reusableBlocks.push(e)):sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`not using already-unused block: ${e.toString()}`)}useBlock(e){this.useBlockAtIndex(e,_.indexOf(this.reusableBlocks,e))}useBlockAtIndex(e,t){sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`using reusable block: ${e.toString()} with renderer: ${e.renderer}`),assert&&assert(t>=0&&this.reusableBlocks[t]===e,`bad index for useBlockAtIndex: ${t}`),assert&&assert(!e.used,"Should be called on an unused (reusable) block"),this.reusableBlocks.splice(t,1),e.used=!0}removeUnusedBlocks(){for(sceneryLog&&sceneryLog.GreedyStitcher&&this.reusableBlocks.length&&sceneryLog.GreedyStitcher("removeUnusedBlocks"),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.push();this.reusableBlocks.length;){const e=this.reusableBlocks.pop();this.markBlockForDisposal(e),this.blockOrderChanged=!0}sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.pop()}linkBeforeDrawable(e){sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`link before ${e.toString()}`);const t=e.previousDrawable;this.linkBlocks(t?t.pendingParentDrawable:null,e.pendingParentDrawable,t,e)}linkAfterDrawable(e){sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`link after ${e.toString()}`);const t=e.nextDrawable;this.linkBlocks(e.pendingParentDrawable,t?t.pendingParentDrawable:null,e,t)}linkBlocks(e,t,i,s){sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.GreedyStitcher(`linking blocks: ${e?`${e.toString()} (${i.toString()})`:"null"} to ${t?`${t.toString()} (${s.toString()})`:"null"}`),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.push(),assert&&assert(e===null&&i===null||e instanceof Nr&&i instanceof Zi),assert&&assert(t===null&&s===null||t instanceof Nr&&s instanceof Zi),e&&(e.nextBlock!==t&&(this.blockOrderChanged=!0,e.nextBlock&&(e.nextBlock.previousBlock=null),e.nextBlock=t),this.markAfterBlock(e,i)),t&&(t.previousBlock!==e&&(this.blockOrderChanged=!0,t.previousBlock&&(t.previousBlock.nextBlock=null),t.previousBlock=e),this.markBeforeBlock(t,s)),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.pop()}processBlockLinkedList(e,t,i){for(;e.blocks.length;)e.blocks.pop();if(sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.GreedyStitcher(`processBlockLinkedList: ${t.toString()} to ${i.toString()}`),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.push(),t)for(let s=t;sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.GreedyStitcher(s.toString()),e.blocks.push(s),s!==i;s=s.nextBlock);sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.pop()}}te.register("GreedyStitcher",Ny);class xP extends Gr{stitch(e,t,i,s,n,o,c){this.initialize(e,t,i,s,n,o,c);for(let O=e.previousFirstDrawable;O!==null&&(this.notePendingRemoval(O),O!==e.previousLastDrawable);O=O.oldNextDrawable);this.recordBackboneBoundaries(),this.removeAllBlocks();let p=null,f=0,w=null;for(let O=t;O!==null&&((!p||O.renderer!==f)&&(p&&this.notifyInterval(p,w,O.previousDrawable),f=O.renderer,p=this.createBlock(f,O),de.isDOM(f)&&(f=0),this.appendBlock(p),w=O),this.notePendingAddition(O,p),O!==i);O=O.nextDrawable);p&&this.notifyInterval(p,w,i),this.reindex(),this.clean()}}te.register("RebuildStitcher",xP);class Ml extends Zi{constructor(e,t,i,s,n){super(),this.initialize(e,t,i,s,n)}initialize(e,t,i,s,n){if(super.initialize(s),this.display=e,this.backboneInstance=t,this.transformRootInstance=i,this.filterRootAncestorInstance=t.parent?t.parent.getFilterRootInstance():t,this.transformRootAncestorInstance=t.parent?t.parent.getTransformRootInstance():t,this.willApplyTransform=this.transformRootAncestorInstance!==this.transformRootInstance,this.willApplyFilters=this.filterRootAncestorInstance!==this.backboneInstance,this.transformListener=this.transformListener||this.markTransformDirty.bind(this),this.willApplyTransform&&(this.backboneInstance.relativeTransform.addListener(this.transformListener),this.backboneInstance.relativeTransform.addPrecompute()),this.backboneVisibilityListener=this.backboneVisibilityListener||this.updateBackboneVisibility.bind(this),this.backboneInstance.relativeVisibleEmitter.addListener(this.backboneVisibilityListener),this.updateBackboneVisibility(),this.visibilityDirty=!0,this.renderer=s,this.domElement=n?e.domElement:Ml.createDivBackbone(),this.isDisplayRoot=n,this.dirtyDrawables=vt(this.dirtyDrawables),Yt.prepareForTransform(this.domElement),this.watchedFilterNodes=vt(this.watchedFilterNodes),this.filterDirty=!0,this.clipDirty=!0,this.filterDirtyListener=this.filterDirtyListener||this.onFilterDirty.bind(this),this.clipDirtyListener=this.clipDirtyListener||this.onClipDirty.bind(this),this.willApplyFilters){assert&&assert(this.filterRootAncestorInstance.trail.nodes.length<this.backboneInstance.trail.nodes.length,"Our backboneInstance should be deeper if we are applying filters");for(let o=this.backboneInstance;o!==this.filterRootAncestorInstance;o=o.parent){const c=o.node;this.watchedFilterNodes.push(c),c.filterChangeEmitter.addListener(this.filterDirtyListener),c.clipAreaProperty.lazyLink(this.clipDirtyListener)}}this.lastZIndex=0,this.blocks=this.blocks||[],this.previousFirstDrawable=null,this.previousLastDrawable=null,this.removedDrawables=!1,this.stitcher=this.stitcher||new Ny,sceneryLog&&sceneryLog.BackboneDrawable&&sceneryLog.BackboneDrawable(`initialized ${this.toString()}`)}dispose(){for(sceneryLog&&sceneryLog.BackboneDrawable&&sceneryLog.BackboneDrawable(`dispose ${this.toString()}`),sceneryLog&&sceneryLog.BackboneDrawable&&sceneryLog.push();this.watchedFilterNodes.length;){const e=this.watchedFilterNodes.pop();e.filterChangeEmitter.removeListener(this.filterDirtyListener),e.clipAreaProperty.unlink(this.clipDirtyListener)}if(this.backboneInstance.relativeVisibleEmitter.removeListener(this.backboneVisibilityListener),!this.removedDrawables)for(let e=this.previousFirstDrawable;e!==null&&(e.parentDrawable.removeDrawable(e),e!==this.previousLastDrawable);e=e.nextDrawable);this.markBlocksForDisposal(),this.willApplyTransform&&(this.backboneInstance.relativeTransform.removeListener(this.transformListener),this.backboneInstance.relativeTransform.removePrecompute()),this.backboneInstance=null,this.transformRootInstance=null,this.filterRootAncestorInstance=null,this.transformRootAncestorInstance=null,vt(this.dirtyDrawables),vt(this.watchedFilterNodes),this.previousFirstDrawable=null,this.previousLastDrawable=null,super.dispose(),sceneryLog&&sceneryLog.BackboneDrawable&&sceneryLog.pop()}markBlocksForDisposal(){for(;this.blocks.length;){const e=this.blocks.pop();sceneryLog&&sceneryLog.BackboneDrawable&&sceneryLog.BackboneDrawable(`${this.toString()} removing block: ${e.toString()}`),e.domElement.parentNode===this.domElement&&this.domElement.removeChild(e.domElement),e.markForDisposal(this.display)}}updateBackboneVisibility(){this.visible=this.backboneInstance.relativeVisible,this.visibilityDirty||(this.visibilityDirty=!0,this.markDirty())}markForDisposal(e){for(let t=this.previousFirstDrawable;t!==null&&(t.notePendingRemoval(this.display),t!==this.previousLastDrawable);t=t.oldNextDrawable);this.removedDrawables=!0,super.markForDisposal(e)}markDirtyDrawable(e){assert&&this.display.ensureNotPainting(),this.dirtyDrawables.push(e),this.markDirty()}markTransformDirty(){assert&&assert(this.willApplyTransform,"Sanity check for willApplyTransform"),Yt.applyPreparedTransform(this.backboneInstance.relativeTransform.matrix,this.domElement)}onFilterDirty(){this.filterDirty||(this.filterDirty=!0,this.markDirty())}onClipDirty(){this.clipDirty||(this.clipDirty=!0,this.markDirty())}update(){if(!super.update())return!1;for(;this.dirtyDrawables.length;)this.dirtyDrawables.pop().update();if(this.filterDirty){this.filterDirty=!1;let e="";const t=this.watchedFilterNodes.length;for(let i=0;i<t;i++){const s=this.watchedFilterNodes[i],n=s.getEffectiveOpacity();for(let o=0;o<s._filters.length;o++)e+=`${e?" ":""}${s._filters[o].getCSSFilterString()}`;n!==1&&(e+=`${e?" ":""}opacity(${ni(n)})`)}this.domElement.style.filter=e}return this.visibilityDirty&&(this.visibilityDirty=!1,this.domElement.style.display=this.visible?"":"none"),this.clipDirty&&(this.clipDirty=!1),!0}getFilterVisibility(){const e=this.watchedFilterNodes.length;for(let t=0;t<e;t++)if(!this.watchedFilterNodes[t].isVisible())return!1;return!0}getFilterClip(){return""}reindexBlocks(){let e=0;for(let t=0;t<this.blocks.length;t++){const i=this.blocks[t];if(i.zIndex<=e){const s=t+1<this.blocks.length&&this.blocks[t+1].zIndex-1>e?Math.ceil((e+this.blocks[t+1].zIndex)/2):e+20;i.domElement.style.zIndex=i.zIndex=s}e=i.zIndex,assert&&(assert(this.blocks[t].zIndex%1===0,"z-indices should be integers"),assert(this.blocks[t].zIndex>0,"z-indices should be greater than zero for our needs (see spec)"),t>0&&assert(this.blocks[t-1].zIndex<this.blocks[t].zIndex,"z-indices should be strictly increasing"))}this.lastZIndex=e+1}stitch(e,t,i,s){if(i===null||s===null){assert&&assert(i===null),assert&&assert(s===null);return}assert&&assert(s.nextChangeInterval===null,"This allows us to have less checks in the loop"),sceneryLog&&sceneryLog.Stitch&&(sceneryLog.Stitch(`Stitch intervals before constricting: ${this.toString()}`),sceneryLog.push(),Gr.debugIntervals(i),sceneryLog.pop());let n=null,o=i,c=!1;for(;o;)c=o.constrict()||c,o.isEmpty()?(assert&&assert(c),n&&(n.nextChangeInterval=o.nextChangeInterval)):(n||(i=o),n=o),o=o.nextChangeInterval;if(n){if(s=n,s.nextChangeInterval=null,sceneryLog&&sceneryLog.Stitch&&c&&(sceneryLog.Stitch(`Stitch intervals after constricting: ${this.toString()}`),sceneryLog.push(),Gr.debugIntervals(i),sceneryLog.pop()),sceneryLog&&te.isLoggingPerformance()){this.display.perfStitchCount++;let p=i;for(;p;)this.display.perfIntervalCount++,this.display.perfDrawableOldIntervalCount+=p.getOldInternalDrawableCount(this.previousFirstDrawable,this.previousLastDrawable),this.display.perfDrawableNewIntervalCount+=p.getNewInternalDrawableCount(e,t),p=p.nextChangeInterval}this.stitcher.stitch(this,e,t,this.previousFirstDrawable,this.previousLastDrawable,i,s)}}audit(e,t,i){if(assertSlow){super.audit(e,t,i),assertSlow&&assertSlow(this.backboneInstance.isBackbone,"We should reference an instance that requires a backbone"),assertSlow&&assertSlow(this.transformRootInstance.isTransformed,"Transform root should be transformed");for(let s=0;s<this.blocks.length;s++)this.blocks[s].audit(e,t,i)}}static createDivBackbone(){const e=document.createElement("div");return e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.width="0",e.style.height="0",e}static repurposeBackboneContainer(e){return(e.style.position!=="relative"||e.style.position!=="absolute")&&(e.style.position="relative"),e.style.left="0",e.style.top="0",e}}te.register("BackboneDrawable",Ml);di.mixInto(Ml);const Ra=Ml;class Rl{constructor(e,t,i){this.display=e,this.rootNode=t;const s=document.createElementNS(li,"svg");s.style.position="absolute",s.setAttribute("class",i),s.style.top="0",s.style.left="0",s.style["pointer-events"]="none",this.svg=s;function n(o,c){s.setAttribute("width",""+o),s.setAttribute("height",""+c),s.style.clip=`rect(0px,${o}px,${c}px,0px)`}e.sizeProperty.link(o=>{n(o.width,o.height)}),this.domElement=s}addShape(e,t,i){const s=document.createElementNS(li,"path");let n=e.getSVGPath();n||(n="M0 0"),n?s.setAttribute("d",n):s.hasAttribute("d")&&s.removeAttribute("d"),s.setAttribute("style",`fill: none; stroke: ${t}; stroke-dasharray: 5, 3; stroke-dashoffset: ${i?5:0}; stroke-width: 3;`),this.svg.appendChild(s)}update(){for(;this.svg.childNodes.length;)this.svg.removeChild(this.svg.childNodes[this.svg.childNodes.length-1]);this.addShapes()}dispose(){}}te.register("ShapeBasedOverlay",Rl);class By extends Rl{constructor(e,t){super(e,t,"canvasNodeBoundsOverlay")}addShapes(){new wt(this.rootNode).eachTrailUnder(e=>{const t=e.lastNode();if(!t.isVisible())return!0;if(t instanceof ha&&e.isVisible()){const i=e.getTransform();this.addShape(i.transformShape(kt.bounds(t.selfBounds)),"rgba(0,255,0,0.8)",!0)}return!1})}}te.register("CanvasNodeBoundsOverlay",By);class Fy extends Rl{constructor(e,t){super(e,t,"canvasNodeBoundsOverlay")}addShapes(){const e=this;function t(n,o){n.willApplyTransform&&(o=o.timesMatrix(n.backboneInstance.relativeTransform.matrix)),n.blocks.forEach(c=>{i(c,o)})}function i(n,o){if(n instanceof Un&&!n.fitBounds.isEmpty()&&e.addShape(kt.bounds(n.fitBounds).transformed(o),"rgba(255,0,0,0.8)",!0),n.firstDrawable&&n.lastDrawable){for(let c=n.firstDrawable;c!==n.lastDrawable;c=c.nextDrawable)s(c,o);s(n.lastDrawable,o)}}function s(n,o){n instanceof Ra&&t(n,o)}t(this.display.rootBackbone,Ze.IDENTITY)}}te.register("FittedBlockBoundsOverlay",Fy);let ff=Bi.OUTER_FOCUS_COLOR,mf=Bi.INNER_FOCUS_COLOR,yf=Bi.INNER_LIGHT_GROUP_FOCUS_COLOR,bf=Bi.OUTER_LIGHT_GROUP_FOCUS_COLOR;class Fs{constructor(e,t,i){this.trail=null,this.node=null,this.activeHighlight=null,this.mode=null,this.groupMode=null,this.groupHighlightNode=null,this.transformTracker=null,this.groupTransformTracker=null,this.nodeModeHighlight=null,this.nodeModeHighlightLayered=!1,this.transformDirty=!0,this.highlightNode=new tt,this.readingBlockHighlightNode=new tt,this.addedReadingBlockHighlight=null,this.activeReadingBlockNode=null,this.readingBlockTrail=null,this.readingBlockTransformDirty=!0,this.readingBlockTransformTracker=null;const s=st()({pdomFocusHighlightsVisibleProperty:new ci(!0),interactiveHighlightsVisibleProperty:new ci(!1),readingBlockHighlightsVisibleProperty:new ci(!1)},i);this.display=e,this.focusRootNode=t,this.focusRootNode.addChild(this.highlightNode),this.focusRootNode.addChild(this.readingBlockHighlightNode),this.pdomFocusHighlightsVisibleProperty=s.pdomFocusHighlightsVisibleProperty,this.interactiveHighlightsVisibleProperty=s.interactiveHighlightsVisibleProperty,this.readingBlockHighlightsVisibleProperty=s.readingBlockHighlightsVisibleProperty,this.focusDisplay=new cs(this.focusRootNode,{allowWebGL:e.isWebGLAllowed(),allowCSSHacks:!1,accessibility:!1,interactive:!1,allowLayerFitting:!0}),this.domElement=this.focusDisplay.domElement,this.domElement.style.pointerEvents="none",this.shapeFocusHighlightPath=new Bi(null),this.boundsFocusHighlightPath=new Sl(null,{useLocalBounds:!0}),this.highlightNode.addChild(this.shapeFocusHighlightPath),this.highlightNode.addChild(this.boundsFocusHighlightPath),this.groupFocusHighlightPath=new Sl(null,{useLocalBounds:!0,useGroupDilation:!0,outerLineWidth:Bi.GROUP_OUTER_LINE_WIDTH,innerLineWidth:Bi.GROUP_INNER_LINE_WIDTH,innerStroke:Bi.OUTER_FOCUS_COLOR}),this.groupFocusHighlightParent=new tt({children:[this.groupFocusHighlightPath]}),this.focusRootNode.addChild(this.groupFocusHighlightParent),this.readingBlockHighlightPath=new FL(null),this.readingBlockHighlightNode.addChild(this.readingBlockHighlightPath),this.boundsListener=this.onBoundsChange.bind(this),this.transformListener=this.onTransformChange.bind(this),this.domFocusListener=this.onFocusChange.bind(this),this.readingBlockTransformListener=this.onReadingBlockTransformChange.bind(this),this.focusHighlightListener=this.onFocusHighlightChange.bind(this),this.interactiveHighlightListener=this.onInteractiveHighlightChange.bind(this),this.focusHighlightsVisibleListener=this.onFocusHighlightsVisibleChange.bind(this),this.voicingHighlightsVisibleListener=this.onVoicingHighlightsVisibleChange.bind(this),this.pointerFocusListener=this.onPointerFocusChange.bind(this),this.lockedPointerFocusListener=this.onLockedPointerFocusChange.bind(this),this.readingBlockFocusListener=this.onReadingBlockFocusChange.bind(this),this.readingBlockHighlightChangeListener=this.onReadingBlockHighlightChange.bind(this),mi.pdomFocusProperty.link(this.domFocusListener),e.focusManager.pointerFocusProperty.link(this.pointerFocusListener),e.focusManager.readingBlockFocusProperty.link(this.readingBlockFocusListener),e.focusManager.lockedPointerFocusProperty.link(this.lockedPointerFocusListener),this.pdomFocusHighlightsVisibleProperty.link(this.focusHighlightsVisibleListener),this.interactiveHighlightsVisibleProperty.link(this.voicingHighlightsVisibleListener)}dispose(){this.hasHighlight()&&this.deactivateHighlight(),mi.pdomFocusProperty.unlink(this.domFocusListener),this.pdomFocusHighlightsVisibleProperty.unlink(this.focusHighlightsVisibleListener),this.interactiveHighlightsVisibleProperty.unlink(this.voicingHighlightsVisibleListener),this.display.focusManager.pointerFocusProperty.unlink(this.pointerFocusListener),this.display.focusManager.readingBlockFocusProperty.unlink(this.readingBlockFocusListener),this.focusDisplay.dispose()}hasHighlight(){return!!this.trail}hasReadingBlockHighlight(){return!!this.readingBlockTrail}activateHighlight(e,t,i,s,n){this.trail=e,this.node=t;const o=i;this.activeHighlight=o;let c=e;if(o==="invisible")this.mode="invisible";else if(o instanceof kt)this.mode="shape",this.shapeFocusHighlightPath.visible=!0,this.shapeFocusHighlightPath.setShape(o);else if(o instanceof tt){if(this.mode="node",o instanceof Bi){const p=o;assert&&assert(o.shape!==null,"The shape of the Node highlight should be set by now. Does it have bounds?"),p.transformSourceNode&&(c=o.getUniqueHighlightTrail(this.trail))}this.nodeModeHighlight=o,s?(this.nodeModeHighlightLayered=!0,this.nodeModeHighlight.visible=n.get()):(this.nodeModeHighlight.visible=!0,this.highlightNode.addChild(this.nodeModeHighlight))}else this.mode="bounds",this.boundsFocusHighlightPath.setShapeFromNode(this.node,this.trail),this.boundsFocusHighlightPath.visible=!0,this.node.localBoundsProperty.lazyLink(this.boundsListener),this.onBoundsChange();this.transformTracker=new pa(c,{isStatic:!0}),this.transformTracker.addListener(this.transformListener),this.activateGroupHighlights(),this.updateHighlightColors(),this.transformDirty=!0}activateFocusHighlight(e,t){this.activateHighlight(e,t,t.focusHighlight,t.focusHighlightLayerable,this.pdomFocusHighlightsVisibleProperty),t.focusHighlightChangedEmitter.addListener(this.focusHighlightListener)}activateInteractiveHighlight(e,t){this.activateHighlight(e,t,t.interactiveHighlight||t.focusHighlight,t.interactiveHighlightLayerable,this.interactiveHighlightsVisibleProperty),assert&&assert(t.isInteractiveHighlighting,"Node does not support any kind of interactive highlighting."),t.interactiveHighlightChangedEmitter.addListener(this.interactiveHighlightListener),t.focusHighlightChangedEmitter.addListener(this.interactiveHighlightListener)}activateReadingBlockHighlight(e){this.readingBlockTrail=e;const t=e.lastNode();assert&&assert(t.isReadingBlock,"should not activate a reading block highlight for a Node that is not a ReadingBlock"),this.activeReadingBlockNode=t;const i=this.activeReadingBlockNode.readingBlockActiveHighlight;this.addedReadingBlockHighlight=i,i==="invisible"||(i instanceof kt?(this.readingBlockHighlightPath.setShape(i),this.readingBlockHighlightPath.visible=!0):i instanceof tt?this.readingBlockHighlightNode.addChild(i):(this.readingBlockHighlightPath.setShapeFromNode(this.activeReadingBlockNode,this.readingBlockTrail),this.readingBlockHighlightPath.visible=!0)),this.readingBlockTransformTracker=new pa(this.readingBlockTrail,{isStatic:!0}),this.readingBlockTransformTracker.addListener(this.readingBlockTransformListener),this.activeReadingBlockNode.readingBlockActiveHighlightChangedEmitter.addListener(this.readingBlockHighlightChangeListener),this.readingBlockTransformDirty=!0}deactivateReadingBlockHighlight(){this.readingBlockHighlightPath.visible=!1,this.addedReadingBlockHighlight instanceof tt&&this.readingBlockHighlightNode.removeChild(this.addedReadingBlockHighlight),assert&&assert(this.readingBlockTransformTracker,"How can we deactivate the TransformTracker if it wasnt assigned.");const e=this.readingBlockTransformTracker;e.removeListener(this.readingBlockTransformListener),e.dispose(),this.readingBlockTransformTracker=null,assert&&assert(this.activeReadingBlockNode,"How can we deactivate the activeReadingBlockNode if it wasnt assigned."),this.activeReadingBlockNode.readingBlockActiveHighlightChangedEmitter.removeListener(this.readingBlockHighlightChangeListener),this.activeReadingBlockNode=null,this.readingBlockTrail=null,this.addedReadingBlockHighlight=null}deactivateHighlight(){assert&&assert(this.node,"Need an active Node to deactivate highlights");const e=this.node;if(this.mode==="shape")this.shapeFocusHighlightPath.visible=!1;else if(this.mode==="node"){assert&&assert(this.nodeModeHighlight,"How can we deactivate if nodeModeHighlight is not assigned");const i=this.nodeModeHighlight;this.nodeModeHighlightLayered?this.nodeModeHighlightLayered=!1:this.highlightNode.removeChild(i),i.visible=!1,this.nodeModeHighlight=null}else this.mode==="bounds"&&(this.boundsFocusHighlightPath.visible=!1,e.localBoundsProperty.unlink(this.boundsListener));e.focusHighlightChangedEmitter.hasListener(this.focusHighlightListener)&&e.focusHighlightChangedEmitter.removeListener(this.focusHighlightListener);const t=e;t.isInteractiveHighlighting&&(t.interactiveHighlightChangedEmitter.hasListener(this.interactiveHighlightListener)&&t.interactiveHighlightChangedEmitter.removeListener(this.interactiveHighlightListener),t.focusHighlightChangedEmitter.hasListener(this.interactiveHighlightListener)&&t.focusHighlightChangedEmitter.removeListener(this.interactiveHighlightListener)),this.deactivateGroupHighlights(),this.trail=null,this.node=null,this.mode=null,this.activeHighlight=null,this.transformTracker.removeListener(this.transformListener),this.transformTracker.dispose(),this.transformTracker=null}activateGroupHighlights(){assert&&assert(this.trail,"must have an active trail to activate group highlights");const e=this.trail;for(let t=0;t<e.length;t++){const i=e.nodes[t],s=i.groupFocusHighlight;if(s){const n=e.upToNode(i);this.groupTransformTracker=new pa(n),this.groupTransformTracker.addListener(this.transformListener),typeof s=="boolean"?(this.groupFocusHighlightPath.setShapeFromNode(i,n),this.groupFocusHighlightPath.visible=!0,this.groupHighlightNode=this.groupFocusHighlightPath,this.groupMode="bounds"):s instanceof tt&&(this.groupHighlightNode=s,this.groupFocusHighlightParent.addChild(s),this.groupMode="node");break}}}updateHighlightColors(){this.mode==="shape"?(this.shapeFocusHighlightPath.innerHighlightColor!==Fs.getInnerHighlightColor()&&this.shapeFocusHighlightPath.setInnerHighlightColor(Fs.getInnerHighlightColor()),this.shapeFocusHighlightPath.outerHighlightColor!==Fs.getOuterHighlightColor()&&this.shapeFocusHighlightPath.setOuterHighlightColor(Fs.getOuterHighlightColor())):this.mode==="bounds"&&(this.boundsFocusHighlightPath.innerHighlightColor!==Fs.getInnerHighlightColor()&&this.boundsFocusHighlightPath.setInnerHighlightColor(Fs.getInnerHighlightColor()),this.boundsFocusHighlightPath.outerHighlightColor!==Fs.getOuterHighlightColor()&&this.boundsFocusHighlightPath.setOuterHighlightColor(Fs.getOuterHighlightColor())),this.groupMode&&(this.groupFocusHighlightPath.innerHighlightColor!==Fs.getInnerGroupHighlightColor()&&this.groupFocusHighlightPath.setInnerHighlightColor(Fs.getInnerGroupHighlightColor()),this.groupFocusHighlightPath.outerHighlightColor!==Fs.getOuterGroupHighlightColor()&&this.groupFocusHighlightPath.setOuterHighlightColor(Fs.getOuterGroupHighlightColor()))}deactivateGroupHighlights(){this.groupMode&&(this.groupMode==="bounds"?this.groupFocusHighlightPath.visible=!1:this.groupMode==="node"&&(assert&&assert(this.groupHighlightNode,"Need a groupHighlightNode to deactivate this mode"),this.groupFocusHighlightParent.removeChild(this.groupHighlightNode)),this.groupMode=null,this.groupHighlightNode=null,assert&&assert(this.groupTransformTracker,"Need a groupTransformTracker to dispose"),this.groupTransformTracker.removeListener(this.transformListener),this.groupTransformTracker.dispose(),this.groupTransformTracker=null)}afterTransform(){assert&&assert(this.transformTracker,"Must have an active transformTracker to adjust from transformation.");const e=this.transformTracker.getMatrix().timesMatrix(Bi.getCorrectiveScalingMatrix());this.mode==="shape"?this.shapeFocusHighlightPath.updateLineWidth(e):this.mode==="bounds"?this.boundsFocusHighlightPath.updateLineWidth(e):this.mode==="node"&&this.activeHighlight instanceof Bi&&this.activeHighlight.updateLineWidth&&this.activeHighlight.updateLineWidth(e),this.groupHighlightNode&&(this.groupMode==="bounds"?this.groupFocusHighlightPath.updateLineWidth(e):this.groupMode==="node"&&this.groupHighlightNode instanceof Bi&&this.groupHighlightNode.updateLineWidth&&this.groupHighlightNode.updateLineWidth(e)),this.readingBlockTrail&&this.readingBlockHighlightPath.updateLineWidth(e)}onTransformChange(){this.transformDirty=!0}onReadingBlockTransformChange(){this.readingBlockTransformDirty=!0}onBoundsChange(){assert&&assert(this.node,"Must have an active node when bounds are changing"),assert&&assert(this.trail,"Must have an active trail when updating default bounds highlight"),this.boundsFocusHighlightPath.setShapeFromNode(this.node,this.trail)}onFocusChange(e){const t=e&&e.display===this.display?e.trail:null;if(this.hasHighlight()&&this.deactivateHighlight(),t&&this.pdomFocusHighlightsVisibleProperty.value){const i=t.lastNode();this.activateFocusHighlight(t,i)}else this.display.focusManager.pointerFocusProperty.value&&this.interactiveHighlightsVisibleProperty.value&&this.updateInteractiveHighlight(this.display.focusManager.pointerFocusProperty.value)}onPointerFocusChange(e){!this.display.focusManager.lockedPointerFocusProperty.value&&!this.display.focusManager.pdomFocusHighlightsVisibleProperty.value&&this.updateInteractiveHighlight(e)}updateInteractiveHighlight(e){const t=e&&e.display===this.display?e.trail:null;this.hasHighlight()&&this.deactivateHighlight();let i=!1;if(t&&!this.display.focusManager.pdomFocusHighlightsVisibleProperty.value){const s=t.lastNode();(s.isReadingBlock&&this.readingBlockHighlightsVisibleProperty.value||!s.isReadingBlock&&this.interactiveHighlightsVisibleProperty.value)&&(this.activateInteractiveHighlight(t,s),i=!0)}!i&&mi.pdomFocus&&this.pdomFocusHighlightsVisibleProperty.value&&this.onFocusChange(mi.pdomFocus)}onLockedPointerFocusChange(e){this.updateInteractiveHighlight(e||this.display.focusManager.pointerFocusProperty.value)}onReadingBlockFocusChange(e){this.hasReadingBlockHighlight()&&this.deactivateReadingBlockHighlight();const t=e&&e.display===this.display?e.trail:null;t&&this.activateReadingBlockHighlight(t)}onFocusHighlightChange(){assert&&assert(this.node&&this.node.focused,"update should only be necessary if node already has focus"),this.onFocusChange(mi.pdomFocus)}onInteractiveHighlightChange(){if(assert){const e=this.node,t=this.display.focusManager.lockedPointerFocusProperty.value;assert(e||t&&t.trail.lastNode()===this.node,"Update should only be necessary if Node is activated with a Pointer or pointer focus is locked during interaction")}this.updateInteractiveHighlight(this.display.focusManager.lockedPointerFocusProperty.value||this.display.focusManager.pointerFocusProperty.value)}onReadingBlockHighlightChange(){assert&&assert(this.activeReadingBlockNode,"Update should only be necessary when there is an active ReadingBlock Node"),assert&&assert(this.activeReadingBlockNode.readingBlockActivated,"Update should only be necessary while the ReadingBlock is activated"),this.onReadingBlockFocusChange(this.display.focusManager.readingBlockFocusProperty.value)}onFocusHighlightsVisibleChange(){this.onFocusChange(mi.pdomFocus)}onVoicingHighlightsVisibleChange(){this.onPointerFocusChange(this.display.focusManager.pointerFocusProperty.value)}update(){this.hasHighlight()&&this.transformDirty&&(this.transformDirty=!1,assert&&assert(this.transformTracker,"The transformTracker must be available on update if transform is dirty"),this.highlightNode.setMatrix(this.transformTracker.matrix),this.groupHighlightNode&&(assert&&assert(this.groupTransformTracker,"The groupTransformTracker must be available on update if transform is dirty"),this.groupHighlightNode.setMatrix(this.groupTransformTracker.matrix)),this.afterTransform()),this.hasReadingBlockHighlight()&&this.readingBlockTransformDirty&&(this.readingBlockTransformDirty=!1,assert&&assert(this.readingBlockTransformTracker,"The groupTransformTracker must be available on update if transform is dirty"),this.readingBlockHighlightNode.setMatrix(this.readingBlockTransformTracker.matrix)),this.display.size.equals(this.focusDisplay.size)||this.focusDisplay.setWidthHeight(this.display.width,this.display.height),this.focusDisplay.updateDisplay()}static setInnerHighlightColor(e){mf=e}static getInnerHighlightColor(){return mf}static setOuterHilightColor(e){ff=e}static getOuterHighlightColor(){return ff}static setInnerGroupHighlightColor(e){yf=e}static getInnerGroupHighlightColor(){return yf}static setOuterGroupHighlightColor(e){bf=e}static getOuterGroupHighlightColor(){return bf}}te.register("HighlightOverlay",Fs);class ua extends Rl{constructor(e,t){super(e,t,"hitAreaOverlay")}addShapes(){new wt(this.rootNode).eachTrailUnder(e=>{const t=e.lastNode();if(!t.isVisible()||t.pickable===!1)return!0;if(t.inputListeners.length&&e.isVisible()){const i=ua.getLocalMouseShape(t),s=ua.getLocalTouchShape(t),n=e.getMatrix();i.bounds.isEmpty()||this.addShape(i.transformed(n),"rgba(0,0,255,0.8)",!0),s.bounds.isEmpty()||this.addShape(s.transformed(n),"rgba(255,0,0,0.8)",!1)}return!1})}static getLocalMouseShape(e){let t=kt.union([e.mouseArea?e.mouseArea instanceof kt?e.mouseArea:kt.bounds(e.mouseArea):e.getSelfShape(),...e.children.filter(i=>e.visible&&e.pickable!==!1).map(i=>ua.getLocalMouseShape(i).transformed(i.matrix))]);return e.hasClipArea()&&(t=t.shapeIntersection(e.clipArea)),t}static getLocalTouchShape(e){let t=kt.union([e.touchArea?e.touchArea instanceof kt?e.touchArea:kt.bounds(e.touchArea):e.getSelfShape(),...e.children.filter(i=>e.visible&&e.pickable!==!1).map(i=>ua.getLocalTouchShape(i).transformed(i.matrix))]);return e.hasClipArea()&&(t=t.shapeIntersection(e.clipArea)),t}}te.register("HitAreaOverlay",ua);class Hy extends Rl{constructor(e,t){super(e,t,"mouseTouchAreaOverlay")}addShapes(){new wt(this.rootNode).eachTrailUnder(e=>{const t=e.lastNode();if(!t.isVisible())return!0;if((t.mouseArea||t.touchArea)&&e.isVisible()){const i=e.getTransform();t.mouseArea&&this.addShape(i.transformShape(t.mouseArea instanceof $e?kt.bounds(t.mouseArea):t.mouseArea),"rgba(0,0,255,0.8)",!0),t.touchArea&&this.addShape(i.transformShape(t.touchArea instanceof $e?kt.bounds(t.touchArea):t.touchArea),"rgba(255,0,0,0.8)",!1)}return!1})}}te.register("PointerAreaOverlay",Hy);class Vy{constructor(e,t){this.display=e,this.rootNode=t,this.pointerSVGContainer=document.createElement("div"),this.pointerSVGContainer.style.position="absolute",this.pointerSVGContainer.style.top="0",this.pointerSVGContainer.style.left="0",this.pointerSVGContainer.style["pointer-events"]="none";const i=10,s=1,n=(i+s/2)*2,o=n/2;e.sizeProperty.lazyLink(p=>{this.pointerSVGContainer.setAttribute("width",""+p.width),this.pointerSVGContainer.setAttribute("height",""+p.height),this.pointerSVGContainer.style.clip=`rect(0px,${p.width}px,${p.height}px,0px)`});const c=Ze.IDENTITY.copy();this.pointerAdded=p=>{const f=document.createElementNS(li,"svg");f.style.position="absolute",f.style.top="0",f.style.left="0",f.style["pointer-events"]="none",Yt.prepareForTransform(f),f.setAttribute("width",""+n),f.setAttribute("height",""+n);const w=document.createElementNS(li,"circle");w.setAttribute("cx",""+(i+s/2)),w.setAttribute("cy",""+(i+s/2)),w.setAttribute("r",""+i),w.setAttribute("style","fill:black;"),w.setAttribute("style","stroke:white;"),w.setAttribute("opacity","0.4");const O=U=>Yt.applyPreparedTransform(c.setToTranslation(U.x-o,U.y-o),f),T=()=>{p.isTouchLike()&&(this.pointerSVGContainer.removeChild(f),p.removeInputListener(z))},z={move:()=>{p.point&&O(p.point)},up:T,cancel:T,focus:()=>{p instanceof no&&p.point&&(O(p.point),this.pointerSVGContainer.appendChild(f))},blur:()=>{this.pointerSVGContainer.contains(f)&&this.pointerSVGContainer.removeChild(f)}};p.addInputListener(z),z.move(),f.appendChild(w),this.pointerSVGContainer.appendChild(f)},e._input.pointerAddedEmitter.addListener(this.pointerAdded),e._input&&e._input.mouse&&this.pointerAdded(e._input.mouse),this.domElement=this.pointerSVGContainer}dispose(){this.display._input.pointerAddedEmitter.removeListener(this.pointerAdded)}update(){}}te.register("PointerOverlay",Vy);let IP=1;const DP=de.createOrderBitmask(de.bitmaskSVG,de.bitmaskCanvas,de.bitmaskDOM,de.bitmaskWebGL);class zn{constructor(e,t,i,s){br(this,"display",null);this.active=!1,this.initialize(e,t,i,s)}initialize(e,t,i,s){return assert&&assert(!this.active,"We should never try to initialize an already active object"),t.setImmutable(),this.id=this.id||IP++,this.isWebGLSupported=e.isWebGLAllowed()&&Yt.isWebGLSupported,this.relativeTransform=this.relativeTransform||new Ey(this),this.fittability=this.fittability||new ky(this),this.visible=!0,this.relativeVisible=!0,this.selfVisible=!0,this.visibilityDirty=!0,this.childVisibilityDirty=!0,this.voicingVisible=!0,this.branchIndexMap=this.branchIndexMap||{},this.branchIndexReferences=vt(this.branchIndexReferences),this.addRemoveCounter=0,this.stitchChangeFrame=e._frameId,this.stitchChangeBefore=0,this.stitchChangeAfter=0,this.stitchChangeOnChildren=0,this.stitchChangeIncluded=!1,this.childInsertedListener=this.childInsertedListener||this.onChildInserted.bind(this),this.childRemovedListener=this.childRemovedListener||this.onChildRemoved.bind(this),this.childrenReorderedListener=this.childrenReorderedListener||this.onChildrenReordered.bind(this),this.visibilityListener=this.visibilityListener||this.onVisibilityChange.bind(this),this.markRenderStateDirtyListener=this.markRenderStateDirtyListener||this.markRenderStateDirty.bind(this),this.visibleEmitter=new ri,this.relativeVisibleEmitter=new ri,this.selfVisibleEmitter=new ri,this.canVoiceEmitter=new ri,this.cleanInstance(e,t),this.node.addInstance(this),this.externalReferenceCount=0,this.stateless=!0,this.isDisplayRoot=i,this.isSharedCanvasCacheRoot=s,this.preferredRenderers=0,this.isUnderCanvasCache=s,this.isBackbone=!1,this.isTransformed=!1,this.isVisibilityApplied=!1,this.isInstanceCanvasCache=!1,this.isSharedCanvasCachePlaceholder=!1,this.isSharedCanvasCacheSelf=s,this.selfRenderer=0,this.groupRenderer=0,this.sharedCacheRenderer=0,this.renderStateDirtyFrame=e._frameId,this.skipPruningFrame=e._frameId,sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`initialized ${this.toString()}`),this.active=!0,this}cleanInstance(e,t){this.display=e,this.trail=t,this.node=t?t.lastNode():null,this.parent=null,this.oldParent=null,this.children=vt(this.children),this.sharedCacheInstance=null,this.relativeTransform.initialize(e,t),this.fittability.initialize(e,t),this.instanceRemovalCheckList=vt(this.instanceRemovalCheckList),this.selfDrawable=null,this.groupDrawable=null,this.sharedCacheDrawable=null,this.firstDrawable=null,this.lastDrawable=null,this.firstInnerDrawable=null,this.lastInnerDrawable=null,this.svgGroups=vt(this.svgGroups),this.cleanSyncTreeResults()}cleanSyncTreeResults(){this.beforeStableIndex=this.children.length,this.afterStableIndex=-1,this.firstChangeInterval=null,this.lastChangeInterval=null,this.incompatibleStateChange=!1,this.groupChanged=!1,this.cascadingStateChange=!1,this.anyStateChange=!1}updateRenderingState(){sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`updateRenderingState ${this.toString()}${this.stateless?" (stateless)":""}`),sceneryLog&&sceneryLog.Instance&&sceneryLog.push(),sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`old: ${this.getStateString()}`);const e=this.isBackbone,t=this.isTransformed,i=this.isVisibilityApplied,s=this.isInstanceCanvasCache,n=this.isSharedCanvasCacheSelf,o=this.isSharedCanvasCachePlaceholder,c=this.isUnderCanvasCache,p=this.selfRenderer,f=this.groupRenderer,w=this.sharedCacheRenderer,O=this.preferredRenderers;this.isBackbone=!1,this.isTransformed=!1,this.isVisibilityApplied=!1,this.isInstanceCanvasCache=!1,this.isSharedCanvasCacheSelf=!1,this.isSharedCanvasCachePlaceholder=!1,this.selfRenderer=0,this.groupRenderer=0,this.sharedCacheRenderer=0;const T=this.node;this.isUnderCanvasCache=this.isSharedCanvasCacheRoot||(this.parent?this.parent.isUnderCanvasCache||this.parent.isInstanceCanvasCache||this.parent.isSharedCanvasCacheSelf:!1),this.preferredRenderers=this.parent?this.parent.preferredRenderers:DP,T._renderer&&(this.preferredRenderers=de.pushOrderBitmask(this.preferredRenderers,T._renderer));const z=this.node.hasClipArea(),U=this.node.effectiveOpacity!==1||T._usesOpacity||this.node._filters.length>0;let m=!1,Y=!1;if(U)for(let ne=0;ne<this.node._filters.length;ne++){const me=this.node._filters[ne];me.isSVGCompatible()||(m=!0),me.isCanvasCompatible()||(Y=!0)}const j=T._cssTransform||T._layerSplit,le=this.isDisplayRoot||!this.isUnderCanvasCache&&j,xe=!le&&(U||z)&&(!m&&this.node._rendererSummary.isSubtreeRenderedExclusivelySVG(this.preferredRenderers)||!Y&&this.node._rendererSummary.isSubtreeRenderedExclusivelyCanvas(this.preferredRenderers));if((xe?!1:le||U||z)?(this.isBackbone=!0,this.isVisibilityApplied=!0,this.isTransformed=this.isDisplayRoot||!!T._cssTransform,this.groupRenderer=de.bitmaskDOM):!xe&&(U||z||T._canvasCache)&&(assert&&assert(this.node._rendererSummary.isSingleCanvasSupported(),`Node canvasCache provided, but not all node contents can be rendered with Canvas under ${this.node.constructor.name}`),T._singleCache?this.isSharedCanvasCacheRoot?(this.isSharedCanvasCacheSelf=!0,this.sharedCacheRenderer=this.isWebGLSupported?de.bitmaskWebGL:de.bitmaskCanvas):(assert&&assert(this.node._rendererSummary.areBoundsValid(),`Node singleCache provided, but not all node contents have valid bounds under ${this.node.constructor.name}`),this.isSharedCanvasCachePlaceholder=!0):(this.isInstanceCanvasCache=!0,this.isUnderCanvasCache=!0,this.groupRenderer=this.isWebGLSupported?de.bitmaskWebGL:de.bitmaskCanvas)),this.node.isPainted())if(this.isUnderCanvasCache)this.selfRenderer=de.bitmaskCanvas;else{let ne=this.node._rendererBitmask;if(!this.isWebGLSupported){const me=de.bitmaskWebGL;ne=ne^ne&me}this.selfRenderer=ne&de.bitmaskOrder(this.preferredRenderers,0)||ne&de.bitmaskOrder(this.preferredRenderers,1)||ne&de.bitmaskOrder(this.preferredRenderers,2)||ne&de.bitmaskOrder(this.preferredRenderers,3)||ne&de.bitmaskSVG||ne&de.bitmaskCanvas||ne&de.bitmaskDOM||ne&de.bitmaskWebGL||0,assert&&assert(this.selfRenderer,"setSelfRenderer failure?")}this.groupChanged=e!==this.isBackbone||s!==this.isInstanceCanvasCache||n!==this.isSharedCanvasCacheSelf,this.cascadingStateChange=c!==this.isUnderCanvasCache||O!==this.preferredRenderers,this.incompatibleStateChange=this.isTransformed!==t||this.isSharedCanvasCachePlaceholder!==o,this.anyStateChange=this.groupChanged||this.cascadingStateChange||this.incompatibleStateChange||p!==this.selfRenderer||f!==this.groupRenderer||w!==this.sharedCacheRenderer,i!==this.isVisibilityApplied&&(this.visibilityDirty=!0,this.parent&&this.parent.markChildVisibilityDirty()),this.fittability.checkSelfFittability(),sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`new: ${this.getStateString()}`),sceneryLog&&sceneryLog.Instance&&sceneryLog.pop()}getStateString(){return`${`S[ ${this.isDisplayRoot?"displayRoot ":""}${this.isBackbone?"backbone ":""}${this.isInstanceCanvasCache?"instanceCache ":""}${this.isSharedCanvasCachePlaceholder?"sharedCachePlaceholder ":""}${this.isSharedCanvasCacheSelf?"sharedCacheSelf ":""}${this.isTransformed?"TR ":""}${this.isVisibilityApplied?"VIS ":""}${this.selfRenderer?this.selfRenderer.toString(16):"-"},${this.groupRenderer?this.groupRenderer.toString(16):"-"},${this.sharedCacheRenderer?this.sharedCacheRenderer.toString(16):"-"} `}]`}baseSyncTree(){assert&&assert(this.isDisplayRoot,"baseSyncTree() should only be called on the root instance"),sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`-------- START baseSyncTree ${this.toString()} --------`),this.syncTree(),sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`-------- END baseSyncTree ${this.toString()} --------`),this.cleanSyncTreeResults()}syncTree(){sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`syncTree ${this.toString()} ${this.getStateString()}${this.stateless?" (stateless)":""}`),sceneryLog&&sceneryLog.Instance&&sceneryLog.push(),sceneryLog&&te.isLoggingPerformance()&&this.display.perfSyncTreeCount++,assert&&assert(!this.parent||!this.parent.stateless,"We should not have a stateless parent instance");const e=this.stateless;if(e||this.parent&&this.parent.cascadingStateChange||this.renderStateDirtyFrame===this.display._frameId?this.updateRenderingState():assertSlow&&(this.updateRenderingState(),assertSlow(!this.anyStateChange)),!e&&this.incompatibleStateChange)return sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`incompatible instance ${this.toString()} ${this.getStateString()}, aborting`),sceneryLog&&sceneryLog.Instance&&sceneryLog.pop(),!1;if(this.stateless=!1,assert&&assert(!e||this.children.length===0,"We should not have child instances on an instance without state"),e&&(this.isTransformed&&this.display.markTransformRootDirty(this,!0),this.attachNodeListeners()),this.isSharedCanvasCachePlaceholder)this.sharedSyncTree();else if(e||this.skipPruningFrame===this.display._frameId||this.anyStateChange){this.prepareChildInstances(e);const t=this.firstDrawable,i=this.lastDrawable,s=this.firstInnerDrawable,n=this.lastInnerDrawable,o=this.updateSelfDrawable();this.localSyncTree(o),assertSlow&&this.auditChangeIntervals(s,n,this.firstInnerDrawable,this.lastInnerDrawable),this.groupSyncTree(e),assertSlow&&this.auditChangeIntervals(t,i,this.firstDrawable,this.lastDrawable)}else sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance("pruned");return sceneryLog&&sceneryLog.Instance&&sceneryLog.pop(),!0}localSyncTree(e){const t=this.display._frameId;let i=this.selfDrawable,s=i;assert&&assert(this.firstChangeInterval===null&&this.lastChangeInterval===null,"sanity checks that cleanSyncTreeResults were called");let n=null;e&&(sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.ChangeInterval("self"),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.push(),n=sn.newForDisplay(null,null,this.display),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.pop());let o=n,c=e?null:this.selfDrawable;for(let p=0;p<this.children.length;p++){let f=this.children[p];f.syncTree()||(f=this.updateIncompatibleChildInstance(f,p),f.syncTree());const O=f.shouldIncludeInParentDrawables();O&&f.firstDrawable&&(s?Zi.connectDrawables(s,f.firstDrawable,this.display):i=f.firstDrawable,s=f.lastDrawable),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.ChangeInterval(`changes for ${f.toString()} in ${this.toString()}`),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.push();const T=f.stitchChangeIncluded,z=O;f.stitchChangeIncluded=z,sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.ChangeInterval(`included: ${T} => ${z}`),f.stitchChangeFrame===t?(sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.ChangeInterval("stitchChangeFrame full change interval"),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.push(),f.firstChangeInterval=f.lastChangeInterval=sn.newForDisplay(null,null,this.display),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.pop()):assert&&assert(T===z,"If we do not have stitchChangeFrame activated, our inclusion should not have changed");const U=f.firstChangeInterval;let m=o&&o.drawableAfter===null;const Y=U&&U.drawableBefore===null;if(f.stitchChangeBefore===t&&!m&&!Y){sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.ChangeInterval("bridge"),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.push();const le=sn.newForDisplay(c,null,this.display);o&&(o.nextChangeInterval=le),o=le,n=n||o,m=!0,sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.pop()}if((T||z)&&(m?U?U.drawableBefore===null?(o.drawableAfter=U.drawableAfter,o.nextChangeInterval=U.nextChangeInterval,o=f.lastChangeInterval===U?o:f.lastChangeInterval):(o.drawableAfter=f.firstDrawable,o.nextChangeInterval=U,o=f.lastChangeInterval):o.drawableAfter=f.firstDrawable:U&&(n=n||U,U.drawableBefore===null&&(assert&&assert(!o||c,"If we have a current change interval, we should be guaranteed a non-null lastUnchangedDrawable"),U.drawableBefore=c),o&&(o.nextChangeInterval=U),o=f.lastChangeInterval),c=o&&o.drawableAfter===null?null:f.lastDrawable?f.lastDrawable:c),p===this.children.length-1&&f.stitchChangeAfter===t&&!(o&&o.drawableAfter===null)){const le=sn.newForDisplay(c,null,this.display);o&&(o.nextChangeInterval=le),o=le,n=n||o}f.cleanSyncTreeResults(),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.pop()}if(assert&&assert(!!n==!!o,"Presence of first and current change intervals should be equal"),!n&&this.stitchChangeOnChildren===this.display._frameId&&this.children.length===0&&(n=o=sn.newForDisplay(null,null,this.display)),this.firstChangeInterval=n,this.lastChangeInterval=o,this.firstDrawable=this.firstInnerDrawable=i,this.lastDrawable=this.lastInnerDrawable=s,assertSlow){let p=null;for(let w=0;w<this.children.length;w++)if(this.children[w].shouldIncludeInParentDrawables()&&this.children[w].firstDrawable){p=this.children[w].firstDrawable;break}this.selfDrawable&&(p=this.selfDrawable);let f=this.selfDrawable;for(let w=this.children.length-1;w>=0;w--)if(this.children[w].shouldIncludeInParentDrawables()&&this.children[w].lastDrawable){f=this.children[w].lastDrawable;break}assertSlow(p===this.firstDrawable),assertSlow(f===this.lastDrawable)}}updateSelfDrawable(){if(this.node.isPainted()){const e=this.selfRenderer;if(!this.selfDrawable||!(this.selfDrawable.renderer&e&de.bitmaskRendererArea))return this.selfDrawable&&(sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`replacing old drawable ${this.selfDrawable.toString()} with new renderer`),this.selfDrawable.markForDisposal(this.display)),this.selfDrawable=de.createSelfDrawable(this,this.node,e,this.fittability.ancestorsFittable),assert&&assert(this.selfDrawable),!0}else assert&&assert(this.selfDrawable===null,"Non-painted nodes should not have a selfDrawable");return!1}updateIncompatibleChildInstance(e,t){if(sceneryLog&&te.isLoggingPerformance()){const s=e.getDescendantCount()+1;s>100?sceneryLog.PerfCritical&&sceneryLog.PerfCritical(`incompatible instance rebuild at ${this.trail.toPathString()}: ${s}`):s>40?sceneryLog.PerfMajor&&sceneryLog.PerfMajor(`incompatible instance rebuild at ${this.trail.toPathString()}: ${s}`):s>0&&sceneryLog.PerfMinor&&sceneryLog.PerfMinor(`incompatible instance rebuild at ${this.trail.toPathString()}: ${s}`)}this.display.markInstanceRootForDisposal(e);const i=zn.createFromPool(this.display,this.trail.copy().addDescendant(e.node,t),!1,!1);return this.replaceInstanceWithIndex(e,i,t),i}groupSyncTree(e){const t=this.groupRenderer;assert&&assert((this.isBackbone?1:0)+(this.isInstanceCanvasCache?1:0)+(this.isSharedCanvasCacheSelf?1:0)==(t?1:0),"We should have precisely one of these flags set for us to have a groupRenderer");const i=!!t!=!!this.groupDrawable||!e&&this.groupChanged||this.groupDrawable&&this.groupDrawable.renderer!==t;i&&(this.groupDrawable&&(sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`replacing group drawable ${this.groupDrawable.toString()}`),this.groupDrawable.markForDisposal(this.display),this.groupDrawable=null),this.firstChangeInterval=this.lastChangeInterval=sn.newForDisplay(null,null,this.display)),t&&(this.firstDrawable&&Zi.disconnectBefore(this.firstDrawable,this.display),this.lastDrawable&&Zi.disconnectAfter(this.lastDrawable,this.display),this.isBackbone?(i&&(this.groupDrawable=Ra.createFromPool(this.display,this,this.getTransformRootInstance(),t,this.isDisplayRoot),this.isTransformed&&this.display.markTransformRootDirty(this,!0)),this.firstChangeInterval&&this.groupDrawable.stitch(this.firstDrawable,this.lastDrawable,this.firstChangeInterval,this.lastChangeInterval)):this.isInstanceCanvasCache?(i&&(this.groupDrawable=Dy.createFromPool(t,this)),this.firstChangeInterval&&this.groupDrawable.stitch(this.firstDrawable,this.lastDrawable,this.firstChangeInterval,this.lastChangeInterval)):this.isSharedCanvasCacheSelf&&i&&(this.groupDrawable=sg.createFromPool(t,this)),this.groupDrawable.setFittable(this.fittability.ancestorsFittable),this.firstDrawable=this.lastDrawable=this.groupDrawable),i?this.firstChangeInterval=this.lastChangeInterval=sn.newForDisplay(null,null,this.display):t&&(this.firstChangeInterval=this.lastChangeInterval=null)}sharedSyncTree(){this.ensureSharedCacheInitialized();const e=this.sharedCacheRenderer;(!this.sharedCacheDrawable||this.sharedCacheDrawable.renderer!==e)&&(this.sharedCacheDrawable&&(sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`replacing shared cache drawable ${this.sharedCacheDrawable.toString()}`),this.sharedCacheDrawable.markForDisposal(this.display)),this.sharedCacheDrawable=new Ay(this.trail,e,this,this.sharedCacheInstance),this.firstDrawable=this.sharedCacheDrawable,this.lastDrawable=this.sharedCacheDrawable,this.firstChangeInterval=this.lastChangeInterval=sn.newForDisplay(null,null,this.display))}prepareChildInstances(e){for(;this.instanceRemovalCheckList.length;){const t=this.instanceRemovalCheckList.pop();t.addRemoveCounter===-1&&(t.addRemoveCounter=0,this.display.markInstanceRootForDisposal(t))}if(e)for(let t=0;t<this.node.children.length;t++){const i=this.node.children[t];this.appendInstance(zn.createFromPool(this.display,this.trail.copy().addDescendant(i,t),!1,!1))}}ensureSharedCacheInitialized(){if(!this.sharedCacheInstance){const e=this.node.getId();this.sharedCacheInstance=this.display._sharedCanvasInstances[e],this.sharedCacheInstance||(this.sharedCacheInstance=zn.createFromPool(this.display,new wt(this.node),!1,!0),this.sharedCacheInstance.syncTree(),this.display._sharedCanvasInstances[e]=this.sharedCacheInstance,this.display.markTransformRootDirty(this.sharedCacheInstance,!0)),this.sharedCacheInstance.externalReferenceCount++,this.isTransformed&&this.display.markTransformRootDirty(this,!0)}}shouldIncludeInParentDrawables(){return this.node.isVisible()||!this.node.isExcludeInvisible()}findPreviousDrawable(e){for(let t=e-1;t>=0;t--){const i=this.children[t].lastDrawable;if(i!==null)return i}return null}findNextDrawable(e){const t=this.children.length;for(let i=e+1;i<t;i++){const s=this.children[i].firstDrawable;if(s!==null)return s}return null}appendInstance(e){this.insertInstance(e,this.children.length)}insertInstance(e,t){assert&&assert(e instanceof zn),assert&&assert(t>=0&&t<=this.children.length,`Instance insertion bounds check for index ${t} with previous children length ${this.children.length}`),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.InstanceTree(`inserting ${e.toString()} into ${this.toString()}`),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.push(),e.stitchChangeFrame=this.display._frameId,this.stitchChangeOnChildren=this.display._frameId,this.children.splice(t,0,e),e.parent=this,e.oldParent=this,t<=this.beforeStableIndex&&(this.beforeStableIndex=t-1),t>this.afterStableIndex?this.afterStableIndex=t+1:this.afterStableIndex++,this.fittability.onInsert(e.fittability),this.relativeTransform.addInstance(e),this.markChildVisibilityDirty(),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.pop()}removeInstance(e){this.removeInstanceWithIndex(e,_.indexOf(this.children,e))}removeInstanceWithIndex(e,t){assert&&assert(e instanceof zn),assert&&assert(t>=0&&t<this.children.length,`Instance removal bounds check for index ${t} with previous children length ${this.children.length}`),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.InstanceTree(`removing ${e.toString()} from ${this.toString()}`),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.push();const i=this.display._frameId;e.stitchChangeFrame=i,this.stitchChangeOnChildren=i,t-1>=0&&(this.children[t-1].stitchChangeAfter=i),t+1<this.children.length&&(this.children[t+1].stitchChangeBefore=i),this.children.splice(t,1),e.parent=null,e.oldParent=this,t<=this.beforeStableIndex&&(this.beforeStableIndex=t-1),t>=this.afterStableIndex?this.afterStableIndex=t:this.afterStableIndex--,this.fittability.onRemove(e.fittability),this.relativeTransform.removeInstance(e),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.pop()}replaceInstanceWithIndex(e,t,i){this.removeInstanceWithIndex(e,i),this.insertInstance(t,i)}reorderInstances(e,t){assert&&assert(typeof e=="number"),assert&&assert(typeof t=="number"),assert&&assert(e<=t),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.InstanceTree(`Reordering ${this.toString()}`),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.push();const i=this.display._frameId;this.children.splice(e,t-e+1);for(let s=e;s<=t;s++){const n=this.findChildInstanceOnNode(this.node._children[s]);this.children.splice(s,0,n),n.stitchChangeFrame=i,s>e&&(n.stitchChangeAfter=i),s<t&&(n.stitchChangeBefore=i)}this.stitchChangeOnChildren=i,this.beforeStableIndex=Math.min(this.beforeStableIndex,e-1),this.afterStableIndex=Math.max(this.afterStableIndex,t+1),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.pop()}findChildInstanceOnNode(e){const t=e.getInstances();for(let i=0;i<t.length;i++)if(t[i].oldParent===this)return t[i];return null}onChildInserted(e,t){sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`inserting child node ${e.constructor.name}#${e.id} into ${this.toString()}`),sceneryLog&&sceneryLog.Instance&&sceneryLog.push(),assert&&assert(!this.stateless,"If we are stateless, we should not receive these notifications");let i=this.findChildInstanceOnNode(e);i?(sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance("instance already exists"),i.addRemoveCounter+=1,assert&&assert(i.addRemoveCounter===0)):(sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance("creating stub instance"),sceneryLog&&sceneryLog.Instance&&sceneryLog.push(),i=zn.createFromPool(this.display,this.trail.copy().addDescendant(e,t),!1,!1),sceneryLog&&sceneryLog.Instance&&sceneryLog.pop()),this.insertInstance(i,t),this.markSkipPruning(),sceneryLog&&sceneryLog.Instance&&sceneryLog.pop()}onChildRemoved(e,t){sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`removing child node ${e.constructor.name}#${e.id} from ${this.toString()}`),sceneryLog&&sceneryLog.Instance&&sceneryLog.push(),assert&&assert(!this.stateless,"If we are stateless, we should not receive these notifications"),assert&&assert(this.children[t].node===e,"Ensure that our instance matches up");const i=this.findChildInstanceOnNode(e);assert&&assert(i!==null,"We should always have a reference to a removed instance"),i.addRemoveCounter-=1,assert&&assert(i.addRemoveCounter===-1),this.instanceRemovalCheckList.push(i),this.removeInstanceWithIndex(i,t),this.markSkipPruning(),sceneryLog&&sceneryLog.Instance&&sceneryLog.pop()}onChildrenReordered(e,t){sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`reordering children for ${this.toString()}`),sceneryLog&&sceneryLog.Instance&&sceneryLog.push(),this.reorderInstances(e,t),this.markSkipPruning(),sceneryLog&&sceneryLog.Instance&&sceneryLog.pop()}onVisibilityChange(){assert&&assert(!this.stateless,"If we are stateless, we should not receive these notifications"),this.stitchChangeFrame=this.display._frameId,this.parent&&this.parent.markSkipPruning(),this.visibilityDirty=!0,this.parent&&this.parent.markChildVisibilityDirty()}onOpacityChange(){assert&&assert(!this.stateless,"If we are stateless, we should not receive these notifications"),this.markRenderStateDirty()}markChildVisibilityDirty(){this.childVisibilityDirty||(this.childVisibilityDirty=!0,this.parent&&this.parent.markChildVisibilityDirty())}updateDrawableFittability(e){this.selfDrawable&&this.selfDrawable.setFittable(e),this.groupDrawable&&this.groupDrawable.setFittable(e)}updateVisibility(e,t,i,s){this.visibilityDirty&&(s=!0);const n=this.node.isVisible(),o=this.visible,c=this.relativeVisible,p=this.selfVisible,f=this.node.voicingVisibleProperty.value,w=this.voicingVisible,O=o&&w;this.visible=e&&n,this.voicingVisible=t&&f,this.relativeVisible=i&&n,this.selfVisible=this.isVisibilityApplied?!0:this.relativeVisible;const T=this.children.length;for(let U=0;U<T;U++){const m=this.children[U];(s||m.visibilityDirty||m.childVisibilityDirty)&&m.updateVisibility(this.visible,this.voicingVisible,this.isVisibilityApplied?!0:this.relativeVisible,s)}this.visibilityDirty=!1,this.childVisibilityDirty=!1,this.visible!==o&&this.visibleEmitter.emit(),this.relativeVisible!==c&&this.relativeVisibleEmitter.emit(),this.selfVisible!==p&&this.selfVisibleEmitter.emit();const z=this.voicingVisible&&this.visible;z!==O&&this.canVoiceEmitter.emit(z)}getDescendantCount(){let e=this.children.length;for(let t=0;t<this.children.length;t++)e+=this.children[t].getDescendantCount();return e}addSVGGroup(e){this.svgGroups.push(e)}removeSVGGroup(e){is(this.svgGroups,e)}lookupSVGGroup(e){const t=this.svgGroups.length;for(let i=0;i<t;i++){const s=this.svgGroups[i];if(s.block===e)return s}return null}getFilterRootInstance(){return this.isBackbone||this.isInstanceCanvasCache||!this.parent?this:this.parent.getFilterRootInstance()}getTransformRootInstance(){return this.isTransformed||!this.parent?this:this.parent.getTransformRootInstance()}getVisibilityRootInstance(){return this.isVisibilityApplied||!this.parent?this:this.parent.getVisibilityRootInstance()}attachNodeListeners(){this.relativeTransform.attachNodeListeners(),this.isSharedCanvasCachePlaceholder||(this.node.childInsertedEmitter.addListener(this.childInsertedListener),this.node.childRemovedEmitter.addListener(this.childRemovedListener),this.node.childrenReorderedEmitter.addListener(this.childrenReorderedListener),this.node.visibleProperty.lazyLink(this.visibilityListener),this.node.voicingVisibleProperty.lazyLink(this.visibilityListener),this.node.filterChangeEmitter.addListener(this.markRenderStateDirtyListener),this.node.clipAreaProperty.lazyLink(this.markRenderStateDirtyListener),this.node.instanceRefreshEmitter.addListener(this.markRenderStateDirtyListener))}detachNodeListeners(){this.relativeTransform.detachNodeListeners(),this.isSharedCanvasCachePlaceholder||(this.node.childInsertedEmitter.removeListener(this.childInsertedListener),this.node.childRemovedEmitter.removeListener(this.childRemovedListener),this.node.childrenReorderedEmitter.removeListener(this.childrenReorderedListener),this.node.visibleProperty.unlink(this.visibilityListener),this.node.voicingVisibleProperty.unlink(this.visibilityListener),this.node.filterChangeEmitter.removeListener(this.markRenderStateDirtyListener),this.node.clipAreaProperty.unlink(this.markRenderStateDirtyListener),this.node.instanceRefreshEmitter.removeListener(this.markRenderStateDirtyListener))}markRenderStateDirty(){this.renderStateDirtyFrame=this.display._frameId,this.parent&&this.parent.markSkipPruning()}markSkipPruning(){this.skipPruningFrame=this.display._frameId,this.parent&&this.parent.markSkipPruning()}getBranchIndexTo(e){const t=this.branchIndexMap[e.id];if(t!==void 0)return t;const i=this.trail.getBranchIndexTo(e.trail);return this.branchIndexMap[e.id]=i,e.branchIndexMap[this.id]=i,this.branchIndexReferences.push(e),e.branchIndexReferences.push(this),i}dispose(){for(sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`dispose ${this.toString()}`),sceneryLog&&sceneryLog.Instance&&sceneryLog.push(),assert&&assert(this.active,"Seems like we tried to dispose this Instance twice, it is not active"),this.active=!1;this.branchIndexReferences.length;){const t=this.branchIndexReferences.pop();delete this.branchIndexMap[t.id],delete t.branchIndexMap[this.id],is(t.branchIndexReferences,this)}this.groupDrawable&&this.groupDrawable.disposeImmediately(this.display),this.sharedCacheDrawable&&this.sharedCacheDrawable.disposeImmediately(this.display),this.selfDrawable&&this.selfDrawable.disposeImmediately(this.display);const e=this.children.length;for(let t=0;t<e;t++)this.children[t].dispose();for(;this.instanceRemovalCheckList.length;){const t=this.instanceRemovalCheckList.pop();t.active&&t.dispose()}this.stateless||this.detachNodeListeners(),this.node.removeInstance(this),this.sharedCacheInstance&&(this.sharedCacheInstance.externalReferenceCount--,this.sharedCacheInstance.externalReferenceCount===0&&(delete this.display._sharedCanvasInstances[this.node.getId()],this.sharedCacheInstance.dispose())),this.cleanInstance(null,null),this.visibleEmitter.removeAllListeners(),this.relativeVisibleEmitter.removeAllListeners(),this.selfVisibleEmitter.removeAllListeners(),this.canVoiceEmitter.removeAllListeners(),this.freeToPool(),sceneryLog&&sceneryLog.Instance&&sceneryLog.pop()}audit(e,t){if(assertSlow){e===void 0&&(e=this.display._frameId),assertSlow(!this.stateless,"State is required for all display instances"),assertSlow(this.firstDrawable===null==(this.lastDrawable===null),"First/last drawables need to both be null or non-null"),assertSlow(!this.isBackbone&&!this.isSharedCanvasCachePlaceholder||this.groupDrawable,"If we are a backbone or shared cache, we need to have a groupDrawable reference"),assertSlow(!this.isSharedCanvasCachePlaceholder||!this.node.isPainted()||this.selfDrawable,"We need to have a selfDrawable if we are painted and not a shared cache"),assertSlow(!this.isTransformed&&!this.isCanvasCache||this.groupDrawable,"We need to have a groupDrawable if we are a backbone or any type of canvas cache"),assertSlow(!this.isSharedCanvasCachePlaceholder||this.sharedCacheDrawable,"We need to have a sharedCacheDrawable if we are a shared cache"),assertSlow(this.addRemoveCounter===0,"Our addRemoveCounter should always be 0 at the end of syncTree");for(let i=0;i<this.children.length;i++)this.children[i].audit(e,t);this.relativeTransform.audit(e,t),this.fittability.audit()}}auditVisibility(e){if(assertSlow){const t=e&&this.node.isVisible(),i=this.trail.isVisible();assertSlow(t===i,"Trail visibility failure"),assertSlow(t===this.visible,"Visible flag failure"),assertSlow(this.voicingVisible===_.reduce(this.trail.nodes,(s,n)=>s&&n.voicingVisibleProperty.value,!0),"When this Instance is voicingVisible: true, all Trail Nodes must also be voicingVisible: true");for(let s=0;s<this.children.length;s++)this.children[s].auditVisibility(t)}}auditChangeIntervals(e,t,i,s){if(e){let o=e;for(;o!==t;)o=o.oldNextDrawable}if(i){let o=i;for(;o!==s;)o=o.nextDrawable}function n(o,c){if(assertSlow)for(assertSlow(o!==null),assertSlow(c!==null);o!==c;)assertSlow(o.nextDrawable===o.oldNextDrawable,"Change interval mismatch"),o=o.nextDrawable}if(assertSlow){const o=this.firstChangeInterval,c=this.lastChangeInterval;if((!o||o.drawableBefore!==null)&&assertSlow(e===i,"If we have no changes, or our first change interval is not open, our firsts should be the same"),(!c||c.drawableAfter!==null)&&assertSlow(t===s,"If we have no changes, or our last change interval is not open, our lasts should be the same"),!o)assertSlow(!c,"We should not be missing only one change interval"),e&&n(e,t);else{assertSlow(c,"We should not be missing only one change interval"),o.drawableBefore!==null&&n(e,o.drawableBefore),c.drawableAfter!==null&&n(c.drawableAfter,t);let p=o;for(;p&&p.nextChangeInterval;){const f=p.nextChangeInterval;assertSlow(p.drawableAfter!==null),assertSlow(f.drawableBefore!==null),n(p.drawableAfter,f.drawableBefore),p=f}}}}toString(){return`${this.id}#${this.node?`${this.node.constructor.name?this.node.constructor.name:"?"}#${this.node.id}`:"-"}`}}te.register("Instance",zn);di.mixInto(zn);const AP=zn;class zy{constructor(e){this.display=e;const t=document.createElementNS(li,"svg");this.domElement=t,t.style.position="absolute",t.setAttribute("class","safari-workaround"),t.style.top="0",t.style.left="0",t.style["pointer-events"]="none",e.sizeProperty.link(i=>{t.setAttribute("width",""+i.width),t.setAttribute("height",""+i.height),t.style.clip=`rect(0px,${i.width}px,${i.height}px,0px)`}),this.rect=document.createElementNS(li,"rect"),t.appendChild(this.rect),this.update()}update(){const e=Ba.nextDouble();this.rect.setAttribute("x",""+e),this.rect.setAttribute("y",""+e),this.rect.setAttribute("style","fill: rgba(255,200,100,0); stroke: none;"),this.display.width&&this.rect.setAttribute("width",""+(this.display.width-e*2)),this.display.height&&this.rect.setAttribute("height",""+(this.display.height-e*2))}}te.register("SafariWorkaroundOverlay",zy);const EP={"scenery-grab-pointer":["grab","-moz-grab","-webkit-grab","pointer"],"scenery-grabbing-pointer":["grabbing","-moz-grabbing","-webkit-grabbing","pointer"]};let kP=1;const tn=class tn{constructor(e,t){this._refreshSVGEmitter=new _s,this._refreshSVGPending=!1,assert&&assert(e,"rootNode is a required parameter");const i=st()({width:t&&t.container&&t.container.clientWidth||640,height:t&&t.container&&t.container.clientHeight||480,allowCSSHacks:!0,allowSafariRedrawWorkaround:!1,allowSceneOverflow:!1,allowLayerFitting:!1,forceSVGRefresh:!1,defaultCursor:"default",backgroundColor:null,preserveDrawingBuffer:!1,allowWebGL:!0,accessibility:!0,supportsInteractiveHighlights:!1,interactive:!0,listenToOnlyElement:!1,batchDOMEvents:!1,assumeFullWindow:!1,aggressiveContextRecreation:!0,passiveEvents:Ui.safari?!1:null,allowBackingScaleAntialiasing:!0},t);this.id=kP++,this._accessible=i.accessibility,this._preserveDrawingBuffer=i.preserveDrawingBuffer,this._allowWebGL=i.allowWebGL,this._allowCSSHacks=i.allowCSSHacks,this._allowSceneOverflow=i.allowSceneOverflow,this._defaultCursor=i.defaultCursor,this.sizeProperty=new Nt(new In(i.width,i.height)),this._currentSize=new In(-1,-1),this._rootNode=e,this._rootNode.addRootedDisplay(this),this._rootBackbone=null,this._domElement=i.container?Ra.repurposeBackboneContainer(i.container):Ra.createDivBackbone(),this._sharedCanvasInstances={},this._baseInstance=null,this._frameId=0,this._dirtyTransformRoots=[],this._dirtyTransformRootsWithoutPass=[],this._instanceRootsToDispose=[],this._reduceReferencesNeeded=[],this._drawablesToDispose=[],this._drawablesToChangeBlock=[],this._drawablesToUpdateLinks=[],this._changeIntervalsToDispose=[],this._lastCursor=null,this._currentBackgroundCSS=null,this._backgroundColor=null,this._requestAnimationFrameID=0,this._input=null,this._inputListeners=[],this._interactive=i.interactive,this._listenToOnlyElement=i.listenToOnlyElement,this._batchDOMEvents=i.batchDOMEvents,this._assumeFullWindow=i.assumeFullWindow,this._passiveEvents=i.passiveEvents,this._aggressiveContextRecreation=i.aggressiveContextRecreation,this._allowBackingScaleAntialiasing=i.allowBackingScaleAntialiasing,this._allowLayerFitting=i.allowLayerFitting,this._forceSVGRefresh=i.forceSVGRefresh,this._overlays=[],this._pointerOverlay=null,this._pointerAreaOverlay=null,this._hitAreaOverlay=null,this._canvasAreaBoundsOverlay=null,this._fittedBlockBoundsOverlay=null,assert&&(this._isPainting=!1,this._isDisposing=!1,this._isDisposed=!1),this.applyCSSHacks(),this.setBackgroundColor(i.backgroundColor);const s=new Gm;if(this.descriptionUtteranceQueue=new Um(s,{initialize:this._accessible,featureSpecificAnnouncingControlPropertyName:"descriptionCanAnnounceProperty"}),Ui.safari&&i.allowSafariRedrawWorkaround&&this.addOverlay(new zy(this)),this.focusManager=new mi,(this._accessible||i.supportsInteractiveHighlights)&&(this._focusRootNode=new tt,this._focusOverlay=new Fs(this,this._focusRootNode,{pdomFocusHighlightsVisibleProperty:this.focusManager.pdomFocusHighlightsVisibleProperty,interactiveHighlightsVisibleProperty:this.focusManager.interactiveHighlightsVisibleProperty,readingBlockHighlightsVisibleProperty:this.focusManager.readingBlockHighlightsVisibleProperty}),this.addOverlay(this._focusOverlay)),this._accessible){this._rootPDOMInstance=En.pool.create(null,this,new wt),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`Display root instance: ${this._rootPDOMInstance.toString()}`),fn.rebuildInstanceTree(this._rootPDOMInstance),assert&&assert(this._rootPDOMInstance.peer,"Peer should be created from createFromPool"),this._domElement.appendChild(this._rootPDOMInstance.peer.primarySibling);const n=s.ariaLiveContainer;this._domElement.appendChild(n),n.style[ht.userSelect]="none",this._boundHandleFullScreenNavigation=this.handleFullScreenNavigation.bind(this),Hs.keydownEmitter.addListener(this._boundHandleFullScreenNavigation)}}getDOMElement(){return this._domElement}get domElement(){return this.getDOMElement()}updateDisplay(){sceneryLog&&te.isLoggingPerformance()&&(this.perfSyncTreeCount=0,this.perfStitchCount=0,this.perfIntervalCount=0,this.perfDrawableBlockChangeCount=0,this.perfDrawableOldIntervalCount=0,this.perfDrawableNewIntervalCount=0),assert&&tn.assertSubtreeDisposed(this._rootNode),sceneryLog&&sceneryLog.Display&&sceneryLog.Display(`updateDisplay frame ${this._frameId}`),sceneryLog&&sceneryLog.Display&&sceneryLog.push();const e=!!this._baseInstance;for(this._input&&this._input.validatePointers(),this._accessible&&this._rootPDOMInstance.peer.updateSubtreePositioning(),this._rootNode.validateWatchedBounds(),assertSlow&&this._accessible&&this._rootPDOMInstance.auditRoot(),assertSlow&&this._rootNode._picker.audit(),this._baseInstance=this._baseInstance||AP.createFromPool(this,new wt(this._rootNode),!0,!1),this._baseInstance.baseSyncTree(),e&&this.markTransformRootDirty(this._baseInstance,this._baseInstance.isTransformed);this._drawablesToUpdateLinks.length;)this._drawablesToUpdateLinks.pop().updateLinks();for(;this._changeIntervalsToDispose.length;)this._changeIntervalsToDispose.pop().dispose();for(this._rootBackbone=this._rootBackbone||this._baseInstance.groupDrawable,assert&&assert(this._rootBackbone,"We are guaranteed a root backbone as the groupDrawable on the base instance"),assert&&assert(this._rootBackbone===this._baseInstance.groupDrawable,"We don't want the base instance's groupDrawable to change"),assertSlow&&this._rootBackbone.audit(!0,!1,!0),sceneryLog&&sceneryLog.Display&&sceneryLog.Display("drawable block change phase"),sceneryLog&&sceneryLog.Display&&sceneryLog.push();this._drawablesToChangeBlock.length;){const t=this._drawablesToChangeBlock.pop().updateBlock();sceneryLog&&te.isLoggingPerformance()&&t&&this.perfDrawableBlockChangeCount++}for(sceneryLog&&sceneryLog.Display&&sceneryLog.pop(),assertSlow&&this._rootBackbone.audit(!1,!1,!0),assertSlow&&this._baseInstance.audit(this._frameId,!1),this.updateDirtyTransformRoots(),this._baseInstance.updateVisibility(!0,!0,!0,!1),assertSlow&&this._baseInstance.auditVisibility(!0),assertSlow&&this._baseInstance.audit(this._frameId,!0),sceneryLog&&sceneryLog.Display&&sceneryLog.Display("instance root disposal phase"),sceneryLog&&sceneryLog.Display&&sceneryLog.push();this._instanceRootsToDispose.length;)this._instanceRootsToDispose.pop().dispose();for(sceneryLog&&sceneryLog.Display&&sceneryLog.pop(),assertSlow&&this._rootNode.auditInstanceSubtreeForDisplay(this),sceneryLog&&sceneryLog.Display&&sceneryLog.Display("drawable disposal phase"),sceneryLog&&sceneryLog.Display&&sceneryLog.push();this._drawablesToDispose.length;)this._drawablesToDispose.pop().dispose();if(sceneryLog&&sceneryLog.Display&&sceneryLog.pop(),assertSlow&&this._baseInstance.audit(this._frameId,!1),assert&&(assert(!this._isPainting,"Display was already updating paint, may have thrown an error on the last update"),this._isPainting=!0),sceneryLog&&sceneryLog.Display&&sceneryLog.Display("repaint phase"),sceneryLog&&sceneryLog.Display&&sceneryLog.push(),this._rootBackbone.update(),sceneryLog&&sceneryLog.Display&&sceneryLog.pop(),assert&&(this._isPainting=!1),assertSlow&&this._rootBackbone.audit(!1,!1,!1),assertSlow&&this._baseInstance.audit(this._frameId,!1),this.updateCursor(),this.updateBackgroundColor(),this.updateSize(),this._overlays.length){let t=this._rootBackbone.lastZIndex;for(let i=0;i<this._overlays.length;i++){const s=this._overlays[i];s.domElement.style.zIndex=""+t++,s.update()}}for(;this._reduceReferencesNeeded.length;)this._reduceReferencesNeeded.pop().reduceReferences();if(this._frameId++,sceneryLog&&te.isLoggingPerformance()){const t=`syncTree count: ${this.perfSyncTreeCount}`;this.perfSyncTreeCount>500?sceneryLog.PerfCritical&&sceneryLog.PerfCritical(t):this.perfSyncTreeCount>100?sceneryLog.PerfMajor&&sceneryLog.PerfMajor(t):this.perfSyncTreeCount>20?sceneryLog.PerfMinor&&sceneryLog.PerfMinor(t):this.perfSyncTreeCount>0&&sceneryLog.PerfVerbose&&sceneryLog.PerfVerbose(t);const i=`drawable block changes: ${this.perfDrawableBlockChangeCount} for -${this.perfDrawableOldIntervalCount} +${this.perfDrawableNewIntervalCount}`;this.perfDrawableBlockChangeCount>200?sceneryLog.PerfCritical&&sceneryLog.PerfCritical(i):this.perfDrawableBlockChangeCount>60?sceneryLog.PerfMajor&&sceneryLog.PerfMajor(i):this.perfDrawableBlockChangeCount>10?sceneryLog.PerfMinor&&sceneryLog.PerfMinor(i):this.perfDrawableBlockChangeCount>0&&sceneryLog.PerfVerbose&&sceneryLog.PerfVerbose(i)}fn.auditPDOMDisplays(this.rootNode),(this._forceSVGRefresh||this._refreshSVGPending)&&(this._refreshSVGPending=!1,this.refreshSVG()),sceneryLog&&sceneryLog.Display&&sceneryLog.pop()}getPhetioElementAt(e){const t=this._rootNode.getPhetioMouseHit(e);return t==="phetioNotSelectable"?null:(t&&assert&&assert(t.isPhetioInstrumented(),"a PhetioMouseHit should be instrumented"),t)}updateSize(){let e=!1;this.size.width!==this._currentSize.width&&(e=!0,this._currentSize.width=this.size.width,this._domElement.style.width=`${this.size.width}px`),this.size.height!==this._currentSize.height&&(e=!0,this._currentSize.height=this.size.height,this._domElement.style.height=`${this.size.height}px`),e&&!this._allowSceneOverflow&&(this._domElement.style.clip=`rect(0px,${this.size.width}px,${this.size.height}px,0px)`)}isWebGLAllowed(){return this._allowWebGL}get webglAllowed(){return this.isWebGLAllowed()}getRootNode(){return this._rootNode}get rootNode(){return this.getRootNode()}getRootBackbone(){return assert&&assert(this._rootBackbone),this._rootBackbone}get rootBackbone(){return this.getRootBackbone()}getSize(){return this.sizeProperty.value}get size(){return this.getSize()}getBounds(){return this.size.toBounds()}get bounds(){return this.getBounds()}setSize(e){assert&&assert(e.width%1===0,"Display.width should be an integer"),assert&&assert(e.width>0,"Display.width should be greater than zero"),assert&&assert(e.height%1===0,"Display.height should be an integer"),assert&&assert(e.height>0,"Display.height should be greater than zero"),this.sizeProperty.value=e}setWidthHeight(e,t){this.setSize(new In(e,t))}getWidth(){return this.size.width}get width(){return this.getWidth()}set width(e){this.setWidth(e)}setWidth(e){return this.getWidth()!==e&&this.setSize(new In(e,this.getHeight())),this}getHeight(){return this.size.height}get height(){return this.getHeight()}set height(e){this.setHeight(e)}setHeight(e){return this.getHeight()!==e&&this.setSize(new In(this.getWidth(),e)),this}setBackgroundColor(e){return assert&&assert(e===null||typeof e=="string"||e instanceof qe),this._backgroundColor=e,this}set backgroundColor(e){this.setBackgroundColor(e)}get backgroundColor(){return this.getBackgroundColor()}getBackgroundColor(){return this._backgroundColor}get interactive(){return this._interactive}set interactive(e){this._accessible&&e!==this._interactive&&this._rootPDOMInstance.peer.recursiveDisable(!e),this._interactive=e,!this._interactive&&this._input&&(this._input.interruptPointers(),this._input.clearBatchedEvents(),this._input.removeTemporaryPointers(),this._rootNode.interruptSubtreeInput(),this.interruptInput())}addOverlay(e){this._overlays.push(e),this._domElement.appendChild(e.domElement),e.domElement.setAttribute("aria-hidden","true")}removeOverlay(e){this._domElement.removeChild(e.domElement),this._overlays.splice(_.indexOf(this._overlays,e),1)}getPDOMRootElement(){return this._accessible?this._rootPDOMInstance.peer.primarySibling:null}get pdomRootElement(){return this.getPDOMRootElement()}isAccessible(){return this._accessible}isElementUnderPDOM(e,t){if(!this._accessible)return!1;const i=this.pdomRootElement.contains(e),s=e!==this.pdomRootElement;return t?i:i&&s}handleFullScreenNavigation(e){if(assert&&assert(this.pdomRootElement,"There must be a PDOM to support keyboard navigation"),M_.isFullScreen()&&Se.isKeyEvent(e,Se.KEY_TAB)){const t=this.pdomRootElement;(e.shiftKey?Dt.getPreviousFocusable(t||void 0):Dt.getNextFocusable(t||void 0))===e.target&&e.preventDefault()}}getUsedRenderersBitmask(){function e(t){let i=0;return _.each(t.blocks,s=>{s instanceof My&&s.domDrawable instanceof Ra?i=i|e(s.domDrawable):i=i|s.renderer}),i}return e(this._rootBackbone)&de.bitmaskRendererArea}markTransformRootDirty(e,t){t?this._dirtyTransformRoots.push(e):this._dirtyTransformRootsWithoutPass.push(e)}updateDirtyTransformRoots(){for(sceneryLog&&sceneryLog.transformSystem&&sceneryLog.transformSystem("updateDirtyTransformRoots"),sceneryLog&&sceneryLog.transformSystem&&sceneryLog.push();this._dirtyTransformRoots.length;)this._dirtyTransformRoots.pop().relativeTransform.updateTransformListenersAndCompute(!1,!1,this._frameId,!0);for(;this._dirtyTransformRootsWithoutPass.length;)this._dirtyTransformRootsWithoutPass.pop().relativeTransform.updateTransformListenersAndCompute(!1,!1,this._frameId,!1);sceneryLog&&sceneryLog.transformSystem&&sceneryLog.pop()}markDrawableChangedBlock(e){sceneryLog&&sceneryLog.Display&&sceneryLog.Display(`markDrawableChangedBlock: ${e.toString()}`),this._drawablesToChangeBlock.push(e)}markForReducedReferences(e){assert&&assert(!!e.reduceReferences),this._reduceReferencesNeeded.push(e)}markInstanceRootForDisposal(e){sceneryLog&&sceneryLog.Display&&sceneryLog.Display(`markInstanceRootForDisposal: ${e.toString()}`),this._instanceRootsToDispose.push(e)}markDrawableForDisposal(e){sceneryLog&&sceneryLog.Display&&sceneryLog.Display(`markDrawableForDisposal: ${e.toString()}`),this._drawablesToDispose.push(e)}markDrawableForLinksUpdate(e){this._drawablesToUpdateLinks.push(e)}markChangeIntervalToDispose(e){this._changeIntervalsToDispose.push(e)}updateBackgroundColor(){assert&&assert(this._backgroundColor===null||typeof this._backgroundColor=="string"||this._backgroundColor instanceof qe);const e=this._backgroundColor===null?"":this._backgroundColor.toCSS?this._backgroundColor.toCSS():this._backgroundColor;e!==this._currentBackgroundCSS&&(this._currentBackgroundCSS=e,this._domElement.style.backgroundColor=e)}updateCursor(){if(this._input&&this._input.mouse&&this._input.mouse.point){if(this._input.mouse.cursor){sceneryLog&&sceneryLog.Cursor&&sceneryLog.Cursor(`set on pointer: ${this._input.mouse.cursor}`),this.setSceneCursor(this._input.mouse.cursor);return}const e=this._rootNode.trailUnderPointer(this._input.mouse);if(e)for(let t=e.getCursorCheckIndex();t>=0;t--){const i=e.nodes[t],s=i.getEffectiveCursor();if(s){sceneryLog&&sceneryLog.Cursor&&sceneryLog.Cursor(`${s} on ${i.constructor.name}#${i.id}`),this.setSceneCursor(s);return}}sceneryLog&&sceneryLog.Cursor&&sceneryLog.Cursor(`--- for ${e?e.toString():"(no hit)"}`)}this.setSceneCursor(this._defaultCursor)}setElementCursor(e){this._domElement.style.cursor=e,this._assumeFullWindow&&(document.body.style.cursor=e)}setSceneCursor(e){if(e!==this._lastCursor){this._lastCursor=e;const t=EP[e];if(t)for(let i=t.length-1;i>=0;i--)this.setElementCursor(t[i]);else this.setElementCursor(e)}}applyCSSHacks(){this._allowSceneOverflow||(this._domElement.style.overflow="hidden"),this._domElement.style.msTouchAction="none",ht.setStyle(this._domElement,ht.fontSmoothing,"antialiased"),this._allowCSSHacks&&(document.onselectstart=()=>!1,document.body.style.msContentZooming="none",ht.setStyle(this._domElement,ht.userDrag,"none"),ht.setStyle(this._domElement,ht.userSelect,"none"),ht.setStyle(this._domElement,ht.touchAction,"none"),ht.setStyle(this._domElement,ht.touchCallout,"none"),ht.setStyle(this._domElement,ht.tapHighlightColor,"rgba(0,0,0,0)"))}canvasDataURL(e){this.canvasSnapshot(t=>{e(t.toDataURL())})}canvasSnapshot(e){const t=document.createElement("canvas");t.width=this.size.width,t.height=this.size.height;const i=t.getContext("2d");this._rootNode.renderToCanvas(t,i,()=>{e(t,i.getImageData(0,0,t.width,t.height))},this.domElement.style.backgroundColor)}setPointerDisplayVisible(e){const t=!!this._pointerOverlay;e!==t&&(e?(this._pointerOverlay=new Vy(this,this._rootNode),this.addOverlay(this._pointerOverlay)):(this.removeOverlay(this._pointerOverlay),this._pointerOverlay.dispose(),this._pointerOverlay=null))}setPointerAreaDisplayVisible(e){const t=!!this._pointerAreaOverlay;e!==t&&(e?(this._pointerAreaOverlay=new Hy(this,this._rootNode),this.addOverlay(this._pointerAreaOverlay)):(this.removeOverlay(this._pointerAreaOverlay),this._pointerAreaOverlay.dispose(),this._pointerAreaOverlay=null))}setHitAreaDisplayVisible(e){const t=!!this._hitAreaOverlay;e!==t&&(e?(this._hitAreaOverlay=new ua(this,this._rootNode),this.addOverlay(this._hitAreaOverlay)):(this.removeOverlay(this._hitAreaOverlay),this._hitAreaOverlay.dispose(),this._hitAreaOverlay=null))}setCanvasNodeBoundsVisible(e){const t=!!this._canvasAreaBoundsOverlay;e!==t&&(e?(this._canvasAreaBoundsOverlay=new By(this,this._rootNode),this.addOverlay(this._canvasAreaBoundsOverlay)):(this.removeOverlay(this._canvasAreaBoundsOverlay),this._canvasAreaBoundsOverlay.dispose(),this._canvasAreaBoundsOverlay=null))}setFittedBlockBoundsVisible(e){const t=!!this._fittedBlockBoundsOverlay;e!==t&&(e?(this._fittedBlockBoundsOverlay=new Fy(this,this._rootNode),this.addOverlay(this._fittedBlockBoundsOverlay)):(this.removeOverlay(this._fittedBlockBoundsOverlay),this._fittedBlockBoundsOverlay.dispose(),this._fittedBlockBoundsOverlay=null))}resizeOnWindowResize(){const e=()=>{this.setWidthHeight(self.innerWidth,self.innerHeight)};self.addEventListener("resize",e),e()}updateOnRequestAnimationFrame(e){let t=0,i=0;const s=this;(function n(){self._requestAnimationFrameID=self.requestAnimationFrame(n,self._domElement);const o=Date.now();t!==0&&(i=(o-t)/1e3),t=o,Wi.emit(i),e&&e(i),s.updateDisplay()})()}cancelUpdateOnRequestAnimationFrame(){self.cancelAnimationFrame(this._requestAnimationFrameID)}initializeEvents(e){assert&&assert(!this._input,"Events cannot be attached twice to a display (for now)");const t=new cr(this,!this._listenToOnlyElement,this._batchDOMEvents,this._assumeFullWindow,this._passiveEvents,e);this._input=t,t.connectListeners()}detachEvents(){assert&&assert(this._input,"detachEvents() should be called only when events are attached"),this._input.disconnectListeners(),this._input=null}addInputListener(e){return assert&&assert(!_.includes(this._inputListeners,e),"Input listener already registered on this Display"),_.includes(this._inputListeners,e)||this._inputListeners.push(e),this}removeInputListener(e){return assert&&assert(_.includes(this._inputListeners,e)),this._inputListeners.splice(_.indexOf(this._inputListeners,e),1),this}hasInputListener(e){for(let t=0;t<this._inputListeners.length;t++)if(this._inputListeners[t]===e)return!0;return!1}getInputListeners(){return this._inputListeners.slice(0)}get inputListeners(){return this.getInputListeners()}interruptInput(){const e=this.inputListeners;for(let t=0;t<e.length;t++){const i=e[t];i.interrupt&&i.interrupt()}return this}interruptPointers(){return this._input&&this._input.interruptPointers(),this}interruptOtherPointers(e=null){var t;return this._input&&this._input.interruptPointers(e||((t=this._input.currentSceneryEvent)==null?void 0:t.pointer)||null),this}ensureNotPainting(){assert&&assert(!this._isPainting,"This should not be run in the call tree of updateDisplay(). If you see this, it is likely that either the last updateDisplay() had a thrown error and it is trying to be run again (in which case, investigate that error), OR code was run/triggered from inside an updateDisplay() that has the potential to cause an infinite loop, e.g. CanvasNode paintCanvas() call manipulating another Node, or a bounds listener that Scenery missed.")}loseWebGLContexts(){(function e(t){t.blocks&&t.blocks.forEach(i=>{const s=i.gl;s&&Yt.loseContext(s);for(let n=i.firstDrawable;n!==null&&(e(n),n!==i.lastDrawable);n=n.nextDrawable);})})(this._rootBackbone)}inspect(){localStorage.scenerySnapshot=JSON.stringify(Ji(this))}getDebugHTML(){const e="font-weight: bold; font-size: 120%; margin-top: 5px;";let t=0,i="";i+=`<div style="${e}">Display (${this.id}) Summary</div>`,i+=`${this.size.toString()} frame:${this._frameId} input:${!!this._input} cursor:${this._lastCursor}<br/>`;function s(m){let Y=1;for(let j=0;j<m.children.length;j++)Y+=s(m.children[j]);return Y}i+=`Nodes: ${s(this._rootNode)}<br/>`;function n(m){let Y=1;for(let j=0;j<m.children.length;j++)Y+=n(m.children[j]);return Y}i+=this._baseInstance?`Instances: ${n(this._baseInstance)}<br/>`:"";function o(m){let Y=1;if(m.blocks)_.each(m.blocks,j=>{Y+=o(j)});else if(m.firstDrawable&&m.lastDrawable){for(let j=m.firstDrawable;j!==m.lastDrawable;j=j.nextDrawable)Y+=o(j);Y+=o(m.lastDrawable)}return Y}i+=this._rootBackbone?`Drawables: ${o(this._rootBackbone)}<br/>`:"";const c={};function p(m){const Y=m.constructor.name;c[Y]?c[Y]++:c[Y]=1}function f(m){let Y=0;m.selfDrawable&&(p(m.selfDrawable),Y++),m.groupDrawable&&(p(m.groupDrawable),Y++),m.sharedCacheDrawable&&(p(m.sharedCacheDrawable),Y++);for(let j=0;j<m.children.length;j++)Y+=f(m.children[j]);return Y}i+=this._baseInstance?`Retained Drawables: ${f(this._baseInstance)}<br/>`:"";for(const m in c)i+=`&nbsp;&nbsp;&nbsp;&nbsp;${m}: ${c[m]}<br/>`;function w(m){if(!m.firstDrawable||!m.lastDrawable)return"";const Y=m.domDrawable&&m.domDrawable.blocks;let j=`<div style="margin-left: ${t*20}px">`;if(j+=m.toString(),Y||(j+=` (${m.drawableCount} drawables)`),j+="</div>",t+=1,Y)for(let le=0;le<m.domDrawable.blocks.length;le++)j+=w(m.domDrawable.blocks[le]);return t-=1,j}if(this._rootBackbone){i+=`<div style="${e}">Block Summary</div>`;for(let m=0;m<this._rootBackbone.blocks.length;m++)i+=w(this._rootBackbone.blocks[m])}function O(m){let Y="";function j(ce){Y+=` <span style="color: #008">${ce}</span>`}const le=m.node;Y+=m.id,Y+=` ${le.constructor.name?le.constructor.name:"?"}`,Y+=` <span style="font-weight: ${le.isPainted()?"bold":"normal"}">${le.id}</span>`,Y+=le.getDebugHTMLExtras(),le.visible||j("invis"),m.visible||j("I-invis"),m.relativeVisible||j("I-rel-invis"),m.selfVisible||j("I-self-invis"),m.fittability.ancestorsFittable||j("nofit-ancestor"),m.fittability.selfFittable||j("nofit-self"),le.pickable===!0&&j("pickable"),le.pickable===!1&&j("unpickable"),m.trail.isPickable()&&j('<span style="color: #808">hits</span>'),le.getEffectiveCursor()&&j(`effectiveCursor:${le.getEffectiveCursor()}`),le.clipArea&&j("clipArea"),le.mouseArea&&j("mouseArea"),le.touchArea&&j("touchArea"),le.getInputListeners().length&&j("inputListeners"),le.getRenderer()&&j(`renderer:${le.getRenderer()}`),le.isLayerSplit()&&j("layerSplit"),le.opacity<1&&j(`opacity:${le.opacity}`),le.disabledOpacity<1&&j(`disabledOpacity:${le.disabledOpacity}`),le._boundsEventCount>0&&j(`<span style="color: #800">boundsListen:${le._boundsEventCount}:${le._boundsEventSelfCount}</span>`);let xe="";switch(le.transform.getMatrix().type){case bo.IDENTITY:xe="";break;case bo.TRANSLATION_2D:xe="translated";break;case bo.SCALING:xe="scale";break;case bo.AFFINE:xe="affine";break;case bo.OTHER:xe="other";break;default:throw new Error(`invalid matrix type: ${le.transform.getMatrix().type}`)}return xe&&(Y+=` <span style="color: #88f" title="${le.transform.getMatrix().toString().replace(`
`,"&#10;")}">${xe}</span>`),Y+=` <span style="color: #888">[Trail ${m.trail.indices.join(".")}]</span>`,Y+=` <span style="color: #8c8">${le._rendererSummary.bitmask.toString(16)}${le._rendererBitmask!==de.bitmaskNodeDefault?` (${le._rendererBitmask.toString(16)})`:""}</span>`,Y}function T(m){let Y=m.toString();return m.visible&&(Y=`<strong>${Y}</strong>`),m.dirty&&(Y+=m.dirty?' <span style="color: #c00;">[x]</span>':""),m.fittable||(Y+=m.dirty?' <span style="color: #0c0;">[no-fit]</span>':""),Y}function z(m){let Y=`<div style="margin-left: ${t*20}px">`;function j(le,xe){Y+=` <span style="color: #888">${le}:${T(xe)}</span>`}Y+=O(m),m.selfDrawable&&j("self",m.selfDrawable),m.groupDrawable&&j("group",m.groupDrawable),m.sharedCacheDrawable&&j("sharedCache",m.sharedCacheDrawable),Y+="</div>",i+=Y,t+=1,_.each(m.children,le=>{z(le)}),t-=1}this._baseInstance&&(i+=`<div style="${e}">Root Instance Tree</div>`,z(this._baseInstance)),_.each(this._sharedCanvasInstances,m=>{i+=`<div style="${e}">Shared Canvas Instance Tree</div>`,z(m)});function U(m){let Y=`<div style="margin-left: ${t*20}px">`;if(Y+=T(m),m.instance?(Y+=` <span style="color: #0a0;">(${m.instance.trail.toPathString()})</span>`,Y+=`&nbsp;&nbsp;&nbsp;${O(m.instance)}`):m.backboneInstance&&(Y+=` <span style="color: #a00;">(${m.backboneInstance.trail.toPathString()})</span>`,Y+=`&nbsp;&nbsp;&nbsp;${O(m.backboneInstance)}`),Y+="</div>",i+=Y,m.blocks)t+=1,_.each(m.blocks,j=>{U(j)}),t-=1;else if(m.firstDrawable&&m.lastDrawable){t+=1;for(let j=m.firstDrawable;j!==m.lastDrawable;j=j.nextDrawable)U(j);U(m.lastDrawable),t-=1}}return this._rootBackbone&&(i+='<div style="font-weight: bold;">Root Drawable Tree</div>',U(this._rootBackbone)),i}getDebugURI(){return`data:text/html;charset=utf-8,${encodeURIComponent(`<!DOCTYPE html><html lang="en"><head><title>Scenery Debug Snapshot</title></head><body style="font-size: 12px;">${this.getDebugHTML()}</body></html>`)}`}popupDebug(){self.open(this.getDebugURI())}iframeDebug(){const e=document.createElement("iframe");e.width=""+self.innerWidth,e.height=""+self.innerHeight,e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.zIndex="10000",document.body.appendChild(e),e.contentWindow.document.open(),e.contentWindow.document.write(this.getDebugHTML()),e.contentWindow.document.close(),e.contentWindow.document.body.style.background="white";const t=document.createElement("button");t.style.position="absolute",t.style.top="0",t.style.right="0",t.style.zIndex="10001",document.body.appendChild(t),t.textContent="close",["pointerdown","click","touchdown"].forEach(i=>{t.addEventListener(i,()=>{document.body.removeChild(e),document.body.removeChild(t)},!0)})}getPDOMDebugHTML(){let e="";const t="font-weight: bold; font-size: 120%; margin-top: 5px;",i="&nbsp;&nbsp;&nbsp;&nbsp;";e+=`<div style="${t}">Accessible Instances</div><br>`,s(this._rootPDOMInstance,"");function s(p,f){e+=`${f+au(`${p.isRootInstance?"":p.node.tagName} ${p.toString()}`)}<br>`,p.children.forEach(w=>{s(w,f+i)})}e+=`<br><div style="${t}">Parallel DOM</div><br>`;let n=this._rootPDOMInstance.peer.primarySibling.outerHTML;n=n.replace(/></g,`>
<`);const o=n.split(`
`);let c="";for(let p=0;p<o.length;p++){const f=o[p],w=f.startsWith("</");w&&(c=c.slice(i.length)),e+=`${c+au(f)}<br>`,w||(c+=i)}return e}foreignObjectRasterization(e){const t={};let i=0;function s(U){U.id||(U.id=`unknown-canvas-${i++}`),t[U.id]=U.toDataURL()}function n(U){if(U instanceof Ra)_.each(U.blocks,m=>{n(m)});else if(U instanceof Nr&&U.firstDrawable&&U.lastDrawable){for(let m=U.firstDrawable;m!==U.lastDrawable;m=m.nextDrawable)n(m);n(U.lastDrawable),(U instanceof sg||U instanceof Ry)&&U.canvas&&U.canvas instanceof self.HTMLCanvasElement&&s(U.canvas)}$u&&U instanceof $u&&(U.domElement instanceof self.HTMLCanvasElement&&s(U.domElement),Array.prototype.forEach.call(U.domElement.getElementsByTagName("canvas"),m=>{s(m)}))}n(this._rootBackbone);const o=document.implementation.createHTMLDocument("");o.documentElement.innerHTML=this.domElement.outerHTML,o.documentElement.setAttribute("xmlns",o.documentElement.namespaceURI),o.documentElement.appendChild(document.createElement("style")).innerHTML=`.${dd.ROOT_CLASS_NAME} { display:none; } `;let c=o.documentElement.getElementsByTagName("canvas");c=Array.prototype.slice.call(c);for(let U=0;U<c.length;U++){const m=c[U],Y=m.style.cssText,j=o.createElement("img"),le=t[m.id];assert&&assert(le,"Must have missed a toDataURL() on a Canvas"),j.src=le,j.setAttribute("style",Y),m.parentNode.replaceChild(j,m)}const p=this.width,f=this.height,w=()=>{tn.elementToSVGDataURL(o.documentElement,p,f,e)};let O=0,T=!1;const z=Array.prototype.slice.call(o.documentElement.getElementsByTagName("image"));for(let U=0;U<z.length;U++){const m=z[U],Y=m.getAttribute("xlink:href");Y.slice(0,5)!=="data:"&&(O++,T=!0,(()=>{const j=new self.Image,le=m;j.onload=()=>{const xe=document.createElement("canvas");xe.width=j.width,xe.height=j.height,xe.getContext("2d").drawImage(j,0,0),le.setAttribute("xlink:href",xe.toDataURL()),--O===0&&w(),assert&&assert(O>=0)},j.onerror=()=>{--O===0&&w(),assert&&assert(O>=0)},j.src=Y})())}T||w()}popupRasterization(){this.foreignObjectRasterization(e=>{e&&self.open(e)})}getTrailFromPDOMIndicesString(e){if(!this._rootPDOMInstance)return null;let t=this._rootPDOMInstance;const i=e.split(Dt.PDOM_UNIQUE_ID_SEPARATOR);for(let s=0;s<i.length;s++){const n=Number(i[s]);if(t=t.children[n],!t)return null}return t&&t.trail?t.trail:null}refreshSVG(){this._refreshSVGEmitter.emit()}refreshSVGOnNextFrame(){this._refreshSVGPending=!0}dispose(){assert&&(assert(!this._isDisposing),assert(!this._isDisposed),this._isDisposing=!0),this._input&&this.detachEvents(),this._rootNode.removeRootedDisplay(this),this._accessible&&(assert&&assert(this._boundHandleFullScreenNavigation,"_boundHandleFullScreenNavigation was not added to the keyStateTracker"),Hs.keydownEmitter.removeListener(this._boundHandleFullScreenNavigation),this._rootPDOMInstance.dispose()),this._focusOverlay&&this._focusOverlay.dispose(),this.sizeProperty.dispose(),this._baseInstance&&this._baseInstance.dispose(),this.descriptionUtteranceQueue.dispose(),this.focusManager&&this.focusManager.dispose(),assert&&(this._isDisposing=!1,this._isDisposed=!0)}static elementToSVGDataURL(e,t,i,s){const n=document.createElement("canvas"),o=n.getContext("2d");n.width=t,n.height=i;const c=new self.XMLSerializer().serializeToString(e),p=`<svg xmlns="http://www.w3.org/2000/svg" width="${t}" height="${i}"><foreignObject width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml">${c}</div></foreignObject></svg>`,f=new self.Image;f.onload=()=>{o.drawImage(f,0,0),s(n.toDataURL())},f.onerror=()=>{s(null)};const w=new self.TextEncoderLite("utf-8").encode(p),O=self.fromByteArray(w);f.src=`data:image/svg+xml;base64,${O}`}static assertSubtreeDisposed(e){if(assert&&assert(!e.isDisposed,"Disposed nodes should not be included in a scene graph to display."),assert)for(let t=0;t<e.children.length;t++)tn.assertSubtreeDisposed(e.children[t])}static addInputListener(e){assert&&assert(!_.includes(tn.inputListeners,e),"Input listener already registered"),_.includes(tn.inputListeners,e)||tn.inputListeners.push(e)}static removeInputListener(e){assert&&assert(_.includes(tn.inputListeners,e)),tn.inputListeners.splice(_.indexOf(tn.inputListeners,e),1)}static interruptInput(){const e=tn.inputListeners.slice(0);for(let t=0;t<e.length;t++){const i=e[t];i.interrupt&&i.interrupt()}}};tn.INTERRUPT_OTHER_POINTERS=e=>{var t,i;(i=(t=phet==null?void 0:phet.joist)==null?void 0:t.display)==null||i.interruptOtherPointers(e==null?void 0:e.pointer)};let cs=tn;te.register("Display",cs);cs.userGestureEmitter=new _s;cs.inputListeners=[];const Wu={};let _f=0;function OP(h){h._parents.forEach(e=>$y(e,h,1))}function MP(h){h._parents.forEach(e=>$y(e,h,-1))}function vf(h){const e=Wu[h];assert&&assert(this.parents.length===1,"IndexedNodeIO only supports nodes with a single parent"),this.parents[0].childrenChangedEmitter.removeListener(e),delete Wu[h]}function $y(h,e,t){let s=h.indexOfChild(e)+t;for(;s>0&&s<h.children.length&&!h.children[s].visible;)s+=t;s>=0&&s<h.children.length&&h.moveChildToIndex(e,s),h.onIndexedNodeIOChildMoved&&h.onIndexedNodeIOChildMoved(e)}const RP=new Ai("IndexedNodeIO",{valueType:tt,documentation:"Node that can be moved forward/back by index, which specifies z-order and/or layout order",supertype:tt.NodeIO,toStateObject:h=>{const e={index:null};return h.parents[0]&&(assert&&assert(h.parents.length===1,"IndexedNodeIO only supports nodes with a single parent"),e.index=h.parents[0].indexOfChild(h)),e},applyState:(h,e)=>{const t=h.parents[0];if(t&&e.index){assert&&assert(h.parents.length===1,"IndexedNodeIO only supports nodes with a single parent");const i=t.children,s=t.indexOfChild(h);i[s]=i[e.index],i[e.index]=h,t.setChildren(i)}},stateSchema:{index:Ft(Ut)},methods:{linkIndex:{returnType:Ut,parameterTypes:[nu(rn,[Ut])],documentation:"Following the PropertyIO.link pattern, subscribe for notifications when the index in the parent changes, and receive a callback with the current value.  The return value is a numeric ID for use with clearLinkIndex.",implementation:function(h){const e=()=>{assert&&assert(this.parents.length===1,"IndexedNodeIO only supports nodes with a single parent");const i=this.parents[0].indexOfChild(this);h(i)};assert&&assert(this.parents.length===1,"IndexedNodeIO only supports nodes with a single parent"),this.parents[0].childrenChangedEmitter.addListener(e),e();const t=_f;return Wu[t]=e,_f++,t}},unlinkIndex:{returnType:rn,parameterTypes:[Ut],documentation:"Unlink a listener that has been added using linkIndex, by its numerical ID (like setTimeout/clearTimeout)",implementation:vf},clearLinkIndex:{returnType:rn,parameterTypes:[Ut],documentation:'Deprecated, see "unlinkIndex".',implementation:function(h){assert&&xn("clearLinkIndex is deprecated, use unlinkIndex instead.",!0),vf.call(this,h)}},moveForward:{returnType:rn,parameterTypes:[],implementation:function(){return OP(this)},documentation:"Move this Node one index forward in each of its parents, skipping invisible Nodes. If the Node is already at the front, this is a no-op."},moveBackward:{returnType:rn,parameterTypes:[],implementation:function(){return MP(this)},documentation:"Move this Node one index backward in each of its parents, skipping invisible Nodes. If the Node is already at the back, this is a no-op."}}});te.register("IndexedNodeIO",RP);class NP extends Si{constructor(e,t,i){i=ds({nodeTandem:ai.REQUIRED},i);const s=new ci(!0,{tandem:i.nodeTandem.createTandem("visibleProperty"),phetioFeatured:!0});super([s,...e],(n,...o)=>n&&t(...o))}}te.register("PhetioControlledVisibilityProperty",NP);export{_s as $,Md as A,ci as B,to as C,cs as D,cp as E,Bu as F,yy as G,B0 as H,Ls as I,Kp as J,Pd as K,hr as L,Ar as M,tt as N,ft as O,Fi as P,Ag as Q,$i as R,kt as S,gs as T,Xu as U,F0 as V,zh as W,R_ as X,ja as Y,kn as Z,Er as _,Si as a,qt as a0,on as a1,Cu as a2,wu as a3,Tu as a4,Al as a5,Ua as a6,VP as a7,Il as a8,Sl as a9,tr as aa,vd as ab,ro as ac,Se as ad,zP as ae,Rh as af,RP as ag,Sd as ah,Ms as ai,Tv as aj,mi as ak,Jv as al,qs as am,oo as an,Dt as ao,Yp as ap,gu as aq,bm as ar,Vn as as,M_ as at,Bi as au,$P as av,_y as b,Wn as c,hy as d,Zv as e,ly as f,ur as g,Af as h,uv as i,Qa as j,$h as k,ry as l,$a as m,Ga as n,kd as o,Hs as p,Nh as q,ss as r,Wi as s,l0 as t,qe as u,en as v,Yn as w,gd as x,er as y,Wa as z};
