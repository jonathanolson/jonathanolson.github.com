var lo=Object.defineProperty;var co=(u,n,e)=>n in u?lo(u,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[n]=e;var x=(u,n,e)=>co(u,typeof n!="symbol"?n+"":n,e);import{c as X,o as j,D as nt,T as pe,M as qe,E as uo,a as po,b as Ie,P as pt,V as te,d as fe,e as je,S as ho,f as M,B as Ue}from"./Vector2Property-mpypjo8N.js";import{s as go}from"./scanURL-BbaI4Qwa.js";import{P as U,N as k,R,A as De,T as q,s as vt,H as A,a as ge,b as Tt,V as T,G as St,B as ht,c as bt,M as Ge,d as rt,I as Et,e as kt,f as fo,L as st,g as wo,h as we,i as yo,S as mo,j as Co,k as Po,l as vo,D as So,m as bo,n as We}from"./PhetioControlledVisibilityProperty-C-W8fgEx.js";import{L as Mt,P as Fe,C as Eo,T as Ve,O as ko,R as Io,V as No,M as Fo,a as Lo,b as xo,c as re,B as ve,d as Bo}from"./localStorage-B8VWGy9j.js";import{B as zo,a as Ao,b as Oo,c as To,d as I,e as F,S as O,P as Mo,g as Se,L as Ro,f as Ho,h as at,_ as ye,i as Do,j as Qe,k as Vo}from"./patternBoards-59tNjMFd.js";import{S as Xe}from"./SlitherQueryParameters-D2_k1AAl.js";import{f as Rt,U as H,p as Ht,h as Dt,i as Vt,j as qt,k as Ut,l as Wt,s as ce,m as Gt,v as it,n as lt,o as Xt,V as qo,F as Uo,q as Wo,r as Go,t as ct,u as Xo,w as Yo,S as $e,x as Yt,y as Jt,z as dt,A as Jo,B as Ko,C as Ne,P as me,D as Zo,G as Y,H as gt,I as Ce,J as ie,K as jo,L as de,M as Qo,N as $o,O as _o,Q as ft,R as en}from"./DisplayEmbedding-DZ7C0buz.js";import{g as ut,a as tn,b as on,c as nn,d as rn,e as sn,f as an,h as ln,i as cn,j as dn,k as un,l as pn,m as hn,n as gn,o as fn,p as wn,q as yn,r as mn,s as Cn,t as Pn,u as vn,v as Sn,w as bn,x as En,y as kn,z as In,A as _e,B as Nn,C as Fn,D as Ln,E as xn}from"./SATSolver-I2LwIpNX.js";import{B as he,s as Bn,E as le,C as Kt}from"./BasicPuzzle-D1EmEwC1.js";import{p as Zt}from"./puzzleFromCompressedString-oWwNtxBE.js";import{p as Me,g as zn,a as An,i as On,A as Tn,w as Mn}from"./AnnotationNode-q9QGrtIi.js";import{c as h,t as Rn,u as K,r as ue,a as be,b as oe,d as It,e as Hn,p as Dn,f as Nt,g as Vn,h as qn,s as et,i as Un,j as Wn,v as Ft,k as Gn,m as Xn,w as Yn,n as Lt,o as Jn,q as Kn,x as Zn,y as jn,z as Qn,A as $n,B as _n,C as er,D as tr,E as or,F as nr,G as rr,H as sr,I as ar,J as ir,K as tt,L as lr,M as cr,N as dr,O as ot,P as ur}from"./Theme-33Og6UOJ.js";import{U as pr}from"./UIAquaRadioButtonGroup-BmbB_swF.js";import{N as Re,S as hr,A as gr}from"./SpinningIndicatorNode-BFgzh9_P.js";import"./PatternRule-DfusC3Hu.js";import"./PatternBoardSolver-By-2anvW.js";const wt=new Mt("showLayoutTestProperty",!1);class He extends zo{constructor(n,e,t){super(n,e,t)}}class xt extends Ao{constructor(e,t){super(e,t);x(this,"originalEdges",new Set)}}class Bt extends Oo{constructor(e,t){super(e.copy(),t.copy());x(this,"originalFace",null)}}class fr extends To{constructor(n,e){super(n.copy(),e.copy())}}class zt{constructor(n,e){this.faces=n,this.boundaryHalfEdges=e}}class wr{constructor(n,e,t){this.faces=n,this.boundaryHalfEdges=e,this.boundarySegments=t}}const yr=()=>{const u=Xe.p||localStorage.getItem("puzzleString"),n=he.loadDefaultPuzzle();let e=null,t=0;try{let o=n;if(u){const r=Zt(u);if(r){o=r;const a=localStorage.getItem("timeElapsedProperty");t=a?JSON.parse(a):0}}e=ut(o.board,o.stateProperty.value)}catch(o){console.error(o)}return e||(e=ut(n.board,n.stateProperty.value)),I()&&F(e),new Rt(e,{initialTimeElapsed:t})},mr=new O("M1024 640q0 106 -75 181t-181 75t-181 -75t-75 -181t75 -181t181 -75t181 75t75 181zM1536 749v-222q0 -12 -8 -23t-20 -13l-185 -28q-19 -54 -39 -91q35 -50 107 -138q10 -12 10 -25t-9 -23q-27 -37 -99 -108t-94 -71q-12 0 -26 9l-138 108q-44 -23 -91 -38q-16 -136 -29 -186q-7 -28 -36 -28h-222q-14 0 -24.5 8.5t-11.5 21.5l-28 184q-49 16 -90 37l-141 -107q-10 -9 -25 -9q-14 0 -25 11q-126 114 -165 168q-7 10 -7 23q0 12 8 23q15 21 51 66.5t54 70.5q-27 50 -41 99l-183 27q-13 2 -21 12.5t-8 23.5v222q0 12 8 23t19 13l186 28q14 46 39 92q-40 57 -107 138q-10 12 -10 24q0 10 9 23q26 36 98.5 107.5t94.5 71.5q13 0 26 -10l138 -107q44 23 91 38q16 136 29 186q7 28 36 28h222q14 0 24.5 -8.5t11.5 -21.5l28 -184q49 -16 90 -37l142 107q9 9 24 9q13 0 25 -10q129 -119 165 -170q7 -8 7 -22q0 -12 -8 -23q-15 -21 -51 -66.5t-54 -70.5q26 -50 41 -98l183 -28q13 -2 21 -12.5t8 -23.5z").makeImmutable(),Cr=new O("M979 1395q19 19 32 13t13 -32v-1472q0 -26 -13 -32t-32 13l-710 710q-9 9 -13 19v-678q0 -26 -19 -45t-45 -19h-128q-26 0 -45 19t-19 45v1408q0 26 19 45t45 19h128q26 0 45 -19t19 -45v-678q4 10 13 19z").makeImmutable(),Pr=new O("M45 -115q-19 -19 -32 -13t-13 32v1472q0 26 13 32t32 -13l710 -710q9 -9 13 -19v678q0 26 19 45t45 19h128q26 0 45 -19t19 -45v-1408q0 -26 -19 -45t-45 -19h-128q-26 0 -45 19t-19 45v678q-4 -10 -13 -19z").makeImmutable(),vr=new O("M1619 1395q19 19 32 13t13 -32v-1472q0 -26 -13 -32t-32 13l-710 710q-9 9 -13 19v-710q0 -26 -13 -32t-32 13l-710 710q-19 19 -19 45t19 45l710 710q19 19 32 13t13 -32v-710q4 10 13 19z").makeImmutable(),Sr=new O("M45 -115q-19 -19 -32 -13t-13 32v1472q0 26 13 32t32 -13l710 -710q9 -9 13 -19v710q0 26 13 32t32 -13l710 -710q19 -19 19 -45t-19 -45l-710 -710q-19 -19 -32 -13t-13 32v710q-4 -10 -13 -19z").makeImmutable(),br=new O("M503.691 189.836L327.687 37.851C312.281 24.546 288 35.347 288 56.015v80.053C127.371 137.907 0 170.1 0 322.326c0 61.441 39.581 122.309 83.333 154.132 13.653 9.931 33.111-2.533 28.077-18.631C66.066 312.814 132.917 274.316 288 272.085V360c0 20.7 24.3 31.453 39.687 18.164l176.004-152c11.071-9.562 11.086-26.753 0-36.328z").makeImmutable(),jt=new O("M363 0l91 91l-235 235l-91 -91v-107h128v-128h107zM886 928q0 22 -22 22q-10 0 -17 -7l-542 -542q-7 -7 -7 -17q0 -22 22 -22q10 0 17 7l542 542q7 7 7 17zM832 1120l416 -416l-832 -832h-416v416zM1515 1024q0 -53 -37 -90l-166 -166l-416 416l166 165q36 38 90 38q53 0 91 -38l235 -234q37 -39 37 -91z").makeImmutable(),Er=new O("M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 448c-110.532 0-200-89.431-200-200 0-110.495 89.472-200 200-200 110.491 0 200 89.471 200 200 0 110.53-89.431 200-200 200zm107.244-255.2c0 67.052-72.421 68.084-72.421 92.863V300c0 6.627-5.373 12-12 12h-45.647c-6.627 0-12-5.373-12-12v-8.659c0-35.745 27.1-50.034 47.579-61.516 17.561-9.845 28.324-16.541 28.324-29.579 0-17.246-21.999-28.693-39.784-28.693-23.189 0-33.894 10.977-48.942 29.969-4.057 5.12-11.46 6.071-16.666 2.124l-27.824-21.098c-5.107-3.872-6.251-11.066-2.644-16.363C184.846 131.491 214.94 112 261.794 112c49.071 0 101.45 38.304 101.45 88.8zM298 368c0 23.159-18.841 42-42 42s-42-18.841-42-42 18.841-42 42-42 42 18.841 42 42z").makeImmutable(),kr=new O("M352.201 425.775l-79.196 79.196c-9.373 9.373-24.568 9.373-33.941 0l-79.196-79.196c-15.119-15.119-4.411-40.971 16.971-40.97h51.162L228 284H127.196v51.162c0 21.382-25.851 32.09-40.971 16.971L7.029 272.937c-9.373-9.373-9.373-24.569 0-33.941L86.225 159.8c15.119-15.119 40.971-4.411 40.971 16.971V228H228V127.196h-51.23c-21.382 0-32.09-25.851-16.971-40.971l79.196-79.196c9.373-9.373 24.568-9.373 33.941 0l79.196 79.196c15.119 15.119 4.411 40.971-16.971 40.971h-51.162V228h100.804v-51.162c0-21.382 25.851-32.09 40.97-16.971l79.196 79.196c9.373 9.373 9.373 24.569 0 33.941L425.773 352.2c-15.119 15.119-40.971 4.411-40.97-16.971V284H284v100.804h51.23c21.382 0 32.09 25.851 16.971 40.971z").makeImmutable(),se=(u,n)=>new U(u,X({maxWidth:20,maxHeight:20,fill:"black"},n));class Le extends k{constructor(n,e,t){const o=j()({allowBarrierClickToHide:!0,panelOptions:{xMargin:15,yMargin:15,fill:h.uiBackgroundColorProperty,stroke:h.uiForegroundColorProperty}},t);super(),this.content=n,this.viewContext=e;const r=new R({fill:h.barrierColorProperty});this.addChild(r),e.layoutBoundsProperty.link(s=>{r.rectBounds=s}),o.allowBarrierClickToHide&&r.addInputListener({down:()=>{this.hide()}});const a=new Fe(n,o.panelOptions);e.layoutBoundsProperty.link(s=>{a.maxWidth=s.width*.9,a.maxHeight=s.height*.9}),this.addChild(new De(a,{alignBoundsProperty:e.layoutBoundsProperty,yAlign:"top",topMargin:50}))}show(){this.viewContext.glassPane.hasChild(this)||(this.reset(),this.viewContext.glassPane.addChild(this))}hide(){this.viewContext.glassPane.hasChild(this)&&this.viewContext.glassPane.removeChild(this)}reset(){}}class xe{constructor(n,e){x(this,"timerListener",null);x(this,"tooltipNode",null);this.viewContext=n,this.tooltipTextOverride=e}showTooltip(n,e,t){if(!this.tooltipNode){this.tooltipNode=new Fe(new q(n,{font:Rn}),{cornerRadius:1,xMargin:2,yMargin:2});const o=this.viewContext.glassPane.globalToLocalPoint(t.point);this.tooltipNode.leftTop=o.plusXY(0,this.viewContext.glassPane.getUniqueTransform().transformDeltaY(20)),this.tooltipNode.bottom>this.viewContext.layoutBoundsProperty.value.bottom&&(this.tooltipNode.bottom=o.y-2),this.tooltipNode.left<this.viewContext.layoutBoundsProperty.value.left&&(this.tooltipNode.left=this.viewContext.layoutBoundsProperty.value.left+2),this.tooltipNode.right>this.viewContext.layoutBoundsProperty.value.right&&(this.tooltipNode.right=this.viewContext.layoutBoundsProperty.value.right-2),this.viewContext.glassPane.addChild(this.tooltipNode)}}hideTooltip(){this.tooltipNode&&(this.tooltipNode.dispose(),this.tooltipNode=null)}clearListener(){this.timerListener&&(vt.clearTimeout(this.timerListener),this.timerListener=null)}enter(n){const e=n.currentTarget,t=n.pointer;if(e&&this.timerListener===null){const o=()=>{const r=this.tooltipTextOverride??(e==null?void 0:e.labelContent)??(e==null?void 0:e.accessibleName);if(r){this.showTooltip(r,e,t);let a=this.tooltipNode;const s=()=>{this.tooltipNode===a&&(this.hideTooltip(),o())};e.rendererSummaryRefreshEmitter.addListener(s),a.disposeEmitter.addListener(()=>{e.rendererSummaryRefreshEmitter.removeListener(s)})}};this.timerListener=vt.setTimeout(()=>{o()},200)}}exit(n){this.clearListener(),this.hideTooltip()}dispose(){this.clearListener(),this.hideTooltip()}}class N extends Eo{constructor(n,e,t){const o=j()({advanced:!1,accessibleName:n,checkboxColor:h.uiForegroundColorProperty,checkboxColorBackground:h.uiBackgroundColorProperty},t),r=new q(n,{font:K,fill:h.uiForegroundColorProperty});o.advanced&&(o.visibleProperty=J),o.boxWidth=r.height,super(e,r,o)}}class ne extends Ve{constructor(n,e){const t=j()({advanced:!1,textFill:h.uiButtonForegroundProperty,baseColor:h.uiButtonBaseColorProperty,xMargin:5,yMargin:5,font:K,buttonAppearanceStrategy:ue},e);t.advanced&&(t.visibleProperty=J),super(n,t)}}class Ir extends A{constructor(n,e,t,o){const r=j()({advanced:!1,onOffSwitchOptions:{size:new nt(40,20),trackFillLeft:h.uiButtonDisabledColorProperty,trackFillRight:h.uiButtonBaseColorProperty,accessibleName:e},spacing:10},o),a=new ko(n,r.onOffSwitchOptions);r.children=[t,a],r.advanced&&(r.visibleProperty=J),super(r)}}class W extends Ir{constructor(n,e,t){const o=j()({textOptions:{}},t),r=new H(e,o.textOptions);super(n,e,r,o)}}class Qt extends Io{constructor(n,e,t){super(n,e,X({orientation:"horizontal",touchAreaYDilation:5,radioButtonOptions:{baseColor:h.uiButtonBaseColorProperty,disabledColor:h.uiButtonDisabledColorProperty,xMargin:8*1.3,yMargin:5*1.3,buttonAppearanceStrategyOptions:{selectedStroke:h.uiButtonSelectedStrokeColorProperty,deselectedStroke:h.uiButtonDeselectedStrokeColorProperty}}},t))}}class Be extends Qt{constructor(n){const{basicLinesIcon:e,basicFaceColoringIcon:t,pureFaceColoringIcon:o,classicIcon:r,basicSectorsIcon:a,sectorsWithColorsIcon:s,vertexStateIcon:i,faceStateIcon:g,customIcon:l}=Be.getIcons(),d=new xe(n);super(Ht,[{value:Dt,createNode:()=>r,labelContent:"Classic",options:{}},{value:Vt,createNode:()=>e,labelContent:"Lines",options:{}},{value:qt,createNode:()=>t,labelContent:"Lines and Colors",options:{}},{value:Ut,createNode:()=>o,labelContent:"Colors",options:{}},{value:Wt,createNode:()=>a,labelContent:"Sectors",options:{visibleProperty:ce}},{value:Gt,createNode:()=>s,labelContent:"Sectors and Colors",options:{visibleProperty:ce}},{value:it,createNode:()=>i,labelContent:"Vertex State",options:{visibleProperty:J}},{value:lt,createNode:()=>g,labelContent:"Face State",options:{visibleProperty:J}},{value:Xt,createNode:()=>l,labelContent:"Custom",options:{visibleProperty:J}}]),this.children.forEach(C=>C.addInputListener(d)),n.layoutBoundsProperty.link(C=>{this.maxWidth=Math.max(1,C.width-2*be)})}static getIcons(){const n=new R(0,0,15,15,{stroke:h.whiteLineColorProperty,fill:h.faceColorDefaultColorProperty}),e=new R(0,0,15,15,{stroke:h.whiteLineColorProperty,fill:new ge([h.faceColorBasicTargetColorProperty],v=>v.withAlpha(1))}),t=new U(new O().moveTo(0,15).lineTo(0,0).lineTo(15,0).makeImmutable(),{stroke:new ge([h.simpleRegionTargetColorProperty],v=>v.withAlpha(1)),lineWidth:4,lineCap:"round",lineJoin:"round"}),o=new U(new O().moveTo(0,15).lineTo(0,0).lineTo(15,0).makeImmutable(),{stroke:h.blackLineColorProperty,lineWidth:4,lineCap:"round",lineJoin:"round"}),r=new U(new O().arc(0,0,9,0,Math.PI/2,!1),{stroke:h.sectorOnlyOneColorProperty}),a=new k({children:[n,t]}),s=new k({children:[e,o]}),i=new k({children:[new R(0,0,15,15,{fill:h.uiForegroundColorProperty})]}),g=3,l=new O().moveTo(-g,-g).lineTo(g,g).moveTo(-g,g).lineTo(g,-g),d=new k({children:[new R(0,0,15,15,{fill:h.puzzleBackgroundColorProperty}),new U(new O().moveTo(0,15).lineTo(0,0).lineTo(15,0).makeImmutable(),{stroke:h.blackLineColorProperty,lineWidth:3,lineCap:"square",lineJoin:"miter"}),new U(l,{stroke:h.xColorProperty,lineWidth:2,x:15,y:7.5})]}),C=new k({children:[n,r,t]}),b=new k({children:[e,r,o]}),S=Zt("eJytV11v2jAU/S9+9oOvv4PUh7VQqS+dNtZK08RDVlwUjQIiKWuF8t9nJw2JjWGJygtKfE7OuR/Oxdmjndnm2XqFRoDR73W6naPRHhXvG4NG6DrNzXW1hh2vyJ5Mjka/9ugNjQhG79Xvrr7ZubsSdzCoMYhh1MPAw5in6WO8xmhMU3iY/5ysMRZ7TnmY/5z24qQelnhx+hgQL5gABM8xAP3SMB/0axOAfnECUHierJxh9JxG+9k2mmDAFLPZhxJEKIA5Fpg2FBqhcCyxwqKhsAiFWRuNk4bCIxRqbWxVdcMREY6wPra4QBqSjJAS62SLDIe0VISknZctKBwy07HkSWVnA+Oz0hJRXqSF6bxAN+uXzdIUZpwWKaoL/pguX+v7lnbrrXcb464csW1Q61Lt1A5BhAQWEFRIoAFBHyu4rMx8YaZuIQh7Ytc/InYUF3FVhMwl/d0s7FgJnpiGkM+uFDD6a7LtfNJRdCHerJfrbaRu7TpGT+66Llxm5xiTIhESGNdaccnZB2Fa54a+PvyY3o0nnXpb7/Vms86zwhyk76yQ1QBOOFeESZ0w5cqWRdYDg7v7nvphoI0+EEEJIcIaJIoyCPQf7seTG+swRvF3uTzlt3pdLhsPRmXCtdAEEkpUfw8Y4KEp1ZpwpaWQjBHR14MOyQMEkTQhYK2EpL092AAPxaRilJKEckbFUb9PevAhHoqDtG2XTNreJ737IYb0I1ECqOBCJMDtzu3rIQd4cHBdUEwntlCgeuehhtTKblhCpSB2byXWp6+H7uNhwWy1S5fZ/ICh0XO6zI2bceap+DAKR1yANNzavL52dDtht8XRaDerubcGZTuMpUv7nABEBOgQARoRYEMEWESADBEQEQHVEeD/rUGsimKIgoq1AQbFEGsEkE+nMTAK/vkoookMqibEOmpD60q4v3h3qjJvsRfqMUCCT5H6wVNnJPTty9UVckFGeNDh5Wd4tMNji9M81lNPdPXO8FSHx8/l0U2YniNCX0Xel9jNZVERmwNbrJe33nrfg+6+PThX546XtNhmloh+OkM7pvMvq/dmNgdHWjgr5gZ9R6/VKravR1L0clLsclL8clJHHxCeFOutIy8X0tEniydFe+scfdmcTO1PbE/NyrL8B0eOKVk=");I()&&F(S);const w=new qo(S.board.vertices[5],S.stateProperty,{...it,allVertexStateVisibleProperty:new pe(!0)}),E=new k({children:[w],scale:60}),c=new Uo(S.board.faces[5],S.stateProperty,lt),p=new k({children:[c],scale:30}),y=se(jt,{fill:h.uiForegroundColorProperty,matrix:new qe().rowMajor(.75,0,0,0,-.75,0,0,0,1)}),P=new Tt;return{basicLinesIcon:P.createBox(a),basicFaceColoringIcon:P.createBox(s),pureFaceColoringIcon:P.createBox(i),classicIcon:P.createBox(d),basicSectorsIcon:P.createBox(C),sectorsWithColorsIcon:P.createBox(b),vertexStateIcon:P.createBox(E),faceStateIcon:P.createBox(p),customIcon:P.createBox(y)}}}const Q=(u,n,e,t)=>{const o=new No(n,e,{spacing:8,radioButtonOptions:{selectedColor:h.uiButtonBaseColorProperty,deselectedColor:h.uiBackgroundColorProperty,stroke:h.uiForegroundColorProperty}}),r=j()({stretch:!0,align:"left",spacing:10,children:[new q(u,{font:oe,fill:h.uiForegroundColorProperty}),o]},t);return new T(r)},J=new Mt("advancedSettingsVisibleProperty",!1);class Nr extends Le{constructor(n){const e=new xe(n),t=new T({stretch:!0,align:"left",spacing:8,children:[new q("Solve After Every Move",{font:oe,fill:h.uiForegroundColorProperty}),new St({xAlign:"left",yAlign:"top",xSpacing:20,ySpacing:8,columns:[[new N("Vertex Joint X",tn),new N("Vertex Forced Line",on),new N("Vertex Forced X",nn),new N("Completed Face X",rn),new N("Completed Face Lines",sn),new N("Simple Loop X",an),new N("Simple Loop Lines",ln),new N("Double Minus One Faces",cn),new N("1/N-1 Sectors",dn),new N("Simple Sectors",un),new N("Vertex X",pn),new N("Vertex Lines",hn),new N("Vertex Sectors",gn),new N("Vertex Faces",fn)],[new N("Color X",wn),new N("Color Lines",yn),new N("Color Parity X",mn),new N("Color Parity Lines",Cn),new N("Color Parity Colors",Pn),new N("Color Parity Partial",vn),new N("Vertex/Color To Face",Sn),new N("Face X",bn),new N("Face Lines",En),new N("Face Sectors",kn),new N("Face Color",In)]]})]}),o=Q("Theme",Hn,It.map(c=>({value:c,createNode:()=>new q(c.name,{font:K,fill:h.uiForegroundColorProperty}),a11yName:c.name}))),r=new T({spacing:15,stretch:!0,visible:Xe.debugColors,children:It.filter(c=>c.isEditable).map(c=>new ne(`Edit ${c.name} Theme`,{listener:()=>{Dn(c)}}))}),a=new T({stretch:!0,align:"left",spacing:8,children:[new q("Puzzle Display",{font:oe,fill:h.uiForegroundColorProperty}),new St({xAlign:"left",yAlign:"top",xSpacing:20,ySpacing:8,columns:[[new N("Lines Visible",Nt),new N("Color Lines",Vn,{enabledProperty:Nt,layoutOptions:{leftMargin:20}}),new N("Face Colors Visible",qn),new N("Sectors Visible",et),new N("Sectors Next to Edges",Un,{advanced:!0,enabledProperty:et,layoutOptions:{leftMargin:20}}),new N("Trivial Sectors",Wn,{advanced:!0,enabledProperty:et,layoutOptions:{leftMargin:20}}),new N("Vertex State",Ft),new N("All Vertex State",Gn,{advanced:!0,enabledProperty:Ft,layoutOptions:{leftMargin:20}}),new N("Face State",Xn,{advanced:!0})],[new N("Possible Line Visible",Yn),new N("Impossible Line Visible",Lt),new N("Vertices Visible",Jn),new N("Vertices Small",Kn),new N("Red X Visible",Zn),new N("Red X Aligned",jn)]]}),new A({spacing:20,visibleProperty:J,children:[Q("Line Join",$n,Qn.map(c=>({value:c,createNode:()=>new q(c,{font:K,fill:h.uiForegroundColorProperty}),labelContent:c}))),Q("Line Cap",er,_n.map(c=>({value:c,createNode:()=>new q(c,{font:K,fill:h.uiForegroundColorProperty}),labelContent:c}))),Q("Vertex Style",or,tr.map(c=>({value:c,createNode:()=>new q(c,{font:K,fill:h.uiForegroundColorProperty}),labelContent:c}))),Q("Impossible Line Style",rr,nr.map(c=>({value:c,createNode:()=>new q(c,{font:K,fill:h.uiForegroundColorProperty}),labelContent:c}))),Q("Face Value Style",ar,sr.map(c=>({value:c,createNode:()=>new q(c,{font:K,fill:h.uiForegroundColorProperty}),labelContent:c})))]})]}),s=Q("Face Color Threshold",ir,[{value:1,createNode:()=>new H("Show All"),labelContent:"Show All"},{value:2,createNode:()=>new H("2+"),labelContent:"2+"},{value:3,createNode:()=>new H("3+"),labelContent:"3+"},{value:5,createNode:()=>new H("5+"),labelContent:"5+"},{value:10,createNode:()=>new H("10+"),labelContent:"10+"},{value:Number.POSITIVE_INFINITY,createNode:()=>new H("Only Outside"),labelContent:"Only Outside"}]),i=new T({spacing:8,align:"left",stretch:!0,children:[new W(_e,"Auto-Solve"),new W(Nn,"Add Lines",{layoutOptions:{leftMargin:20},enabledProperty:_e}),new W(Fn,"Simple Loops",{layoutOptions:{leftMargin:20},enabledProperty:_e}),new H("Highlights"),new W(Wo,"Dim Completed Numbers",{layoutOptions:{leftMargin:20}}),new W(Go,"Highlight Incorrect Numbers",{layoutOptions:{leftMargin:20}}),new W(ct,"Highlight Incorrect Moves",{layoutOptions:{leftMargin:20}}),new W(Xo,"Highlight Intersecting Lines",{layoutOptions:{leftMargin:20}}),new W(new Fo(Yo,{bidirectional:!0,map:c=>c===$e.CYCLIC,inverseMap:c=>c?$e.CYCLIC:$e.TOGGLE}),"Cycle Between States"),new W(Yt,"Show View Style Controls"),new W(Lt,"Show Impossible Lines"),new W(Jt,"Show Elapsed Time"),new W(ce,"Enable Sector View Styles"),new W(dt,"Show Undo-All / Redo-All",{advanced:!0}),new W(wt,"Show Layout Test",{advanced:!0}),new W(Jo,"Solve Uses Built-In",{advanced:!0})]}),g=new ht(!1),l=ge.and([J,g]),d=Be.getIcons(),C=(c,p)=>new A({spacing:5,children:[new H(p),c]}),b=Q("View Style",Ht,[{value:Dt,createNode:()=>C(d.classicIcon,"Classic"),labelContent:"Classic"},{value:Vt,createNode:()=>C(d.basicLinesIcon,"Lines"),labelContent:"Lines"},{value:qt,createNode:()=>C(d.basicFaceColoringIcon,"Lines and Colors"),labelContent:"Lines and Colors"},{value:Ut,createNode:()=>C(d.pureFaceColoringIcon,"Colors"),labelContent:"Colors"},{value:Wt,createNode:()=>C(d.basicSectorsIcon,"Sectors"),labelContent:"Sectors",options:{visibleProperty:ce}},{value:Gt,createNode:()=>C(d.sectorsWithColorsIcon,"Sectors and Colors"),labelContent:"Sectors and Colors",options:{visibleProperty:ce}},{value:it,createNode:()=>C(d.vertexStateIcon,"Vertex State"),labelContent:"Vertex State",options:{visibleProperty:J}},{value:lt,createNode:()=>C(d.faceStateIcon,"Face State"),labelContent:"Face State",options:{visibleProperty:J}},{value:Xt,createNode:()=>C(d.customIcon,"Custom"),labelContent:"Custom",options:{visibleProperty:J}}]),S=new W(g,"Show Custom Options",{advanced:!0}),w=new T({spacing:20,align:"left",children:[new A({spacing:20,children:[t,s]}),a],visibleProperty:l}),E=new ne("Reload to Defaults",{accessibleName:"Clear all settings/data, and reload the page",listener:()=>{localStorage.clear(),self.location.reload()},advanced:!0});E.addInputListener(e),super(new T({spacing:20,align:"left",stretch:!0,children:[i,new A({align:"top",spacing:30,children:[b,o,r]}),S,w,E,new W(J,"Show Advanced Settings")]}),n)}}const ae=class ae extends uo{constructor(n){super(),this.canSolve=n}};x(ae,"STANDARD",new ae((n,e)=>(e=e.clone(),Ln(Ko,n,e,!0),Bn(e)))),x(ae,"NO_LIMIT",new ae(()=>!0)),x(ae,"enumeration",new po(ae));let Ee=ae;const At=new Lo("canSolveDifficulty",Ee.STANDARD),Fr=u=>{const n=u.cleanState.clone();for(const e of u.board.faces)n.getFaceValue(e)===null&&n.setFaceValue(e,e.edges.filter(t=>u.blackEdges.has(t)).length);return xn(u.board,n,u.blackEdges)};class Lr extends A{constructor(n,e){const t=new xo("polygonGeneratorProperty",{serialize:c=>c.name,deserialize:c=>Me.find(p=>p.name===c)??Me[0]}),o=localStorage.getItem("polygonGeneratorParameters")?JSON.parse(localStorage.getItem("polygonGeneratorParameters")):null;let r=!1;const a=Q("Patterns",t,Me.map(c=>({value:c,createNode:()=>new q(c.name,{font:K,fill:h.uiForegroundColorProperty}),labelContent:c.name})),{layoutOptions:{align:"top",grow:0},justify:"top"}),s=new A({spacing:10,align:"center",layoutOptions:{grow:0},grow:1}),i=new A({spacing:10,align:"center",layoutOptions:{grow:0},children:[new H("Solver Difficulty"),new pr(At,[{value:Ee.STANDARD,createNode:()=>new H("Standard"),labelContent:"Standard"},{value:Ee.NO_LIMIT,createNode:()=>new H("No Limit"),labelContent:"No Limit"}],{orientation:"horizontal",align:"center",spacing:30})]}),g=new A({spacing:10,align:"center",justify:"spaceEvenly",layoutOptions:{grow:0}}),l=new k,d=new k,C=new Ie;C.addListener(()=>{d.children=[]});const b=new k({children:[l,d]}),S=(c,p)=>{const y=c.generate(p),P=new O;y.forEach(v=>P.polygon(v)),l.children=[new U(P,{fill:h.puzzleBackgroundColorProperty,stroke:h.blackLineColorProperty,lineWidth:.05})],C.emit()};S(Me[0],{width:5,height:5}),t.link(c=>{g.children.forEach(v=>v.dispose()),s.children.forEach(v=>v.dispose());const p={},y=v=>o&&!r&&v in o?o[v]:c.defaultParameterValues[v],P=()=>{localStorage.setItem("polygonGeneratorParameters",JSON.stringify(p)),S(c,p)};for(const[v,L]of Object.entries(c.parameters))if(L.type==="integer"){const B=new bt(y(v));B.link(f=>{p[v]=f,P()}),g.addChild(new Re(L.label,B,L.range,{layoutFunction:Re.createLayoutFunction4(),titleNodeOptions:{font:K,fill:h.uiForegroundColorProperty},sliderOptions:{trackSize:new nt(100,5),labelTagName:"label",keyboardStep:1,labelContent:L.label},arrowButtonOptions:{touchAreaXDilation:5,touchAreaYDilation:25},numberDisplayOptions:{decimalPlaces:0},delta:1,visibleProperty:L.advanced?J:null}))}else if(L.type==="float"){const B=new bt(y(v));B.link(f=>{p[v]=f,P()}),g.addChild(new Re(L.label,B,L.range,{layoutFunction:Re.createLayoutFunction4(),titleNodeOptions:{font:K,fill:h.uiForegroundColorProperty},sliderOptions:{trackSize:new nt(100,5),labelTagName:"label",keyboardStep:.1,labelContent:L.label},numberDisplayOptions:{decimalPlaces:2},delta:.01,visibleProperty:L.advanced?J:null}))}else if(L.type==="boolean"){const B=new ht(y(v));B.link(f=>{p[v]=f,P()}),g.addChild(new N(L.label,B,{advanced:L.advanced}))}else if(L.type==="choice"){const B=new pt(y(v));B.link(f=>{p[v]=f,P()}),g.addChild(Q(L.label,B,L.choices.map(f=>({value:f.value,createNode:()=>new q(f.label,{font:K,fill:h.uiForegroundColorProperty}),labelContent:f.label}))))}r=!0,s.addChild(new ne("Generate",{font:tt,layoutOptions:{align:"center"},listener:async()=>{C.emit();const v=c.generate(p),L=new Mo(v,c.scale??1),B=new pe(!1),f=()=>{B.value=!0};C.addListener(f);const m=new Ie,_=new Ie,ee=new Ie;ee.addListener(()=>{d.children=[]}),m.addListener((D,V)=>{d.addChild(new U(O.polygon(v[D]),{fill:h.generateAddedFaceColorProperty,stroke:h.blackLineColorProperty,lineWidth:.05})),V!==null&&d.addChild(new q(`${V}`,{font:tt,fill:h.faceValueColorProperty,maxWidth:.9,maxHeight:.9,center:Se(v[D])}))}),_.addListener((D,V)=>{d.addChild(new U(O.polygon(v[D]),{fill:h.generateMinimizedFaceColorProperty,stroke:h.blackLineColorProperty,lineWidth:.05})),V!==null&&d.addChild(new q(`${V}`,{font:tt,fill:h.faceValueColorProperty,maxWidth:.9,maxHeight:.9,center:Se(v[D])}))});try{const D=At.value,V=D.canSolve,Ae=async()=>await zn(L,B,m),Ct=async()=>{let Ze=await Ae();if(D===Ee.NO_LIMIT)return Ze;{const io=L.faces.filter(Te=>Ze.cleanState.getFaceValue(Te)===null),Pt=Fr(Ze);return io.forEach(Te=>{m.emit(L.faces.indexOf(Te),Pt.cleanState.getFaceValue(Te))}),Pt}};let Oe=await Ct();for(;!V(Oe.board,Oe.cleanState.clone());)ee.emit(),Oe=await Ct();const ao=await An(Oe,V,B,_);On(17,B),B.value||(d.children=[],E.loadPuzzle(he.fromSolvedPuzzle(ao)))}catch{}C.hasListener(f)&&C.removeListener(f)}}))});const w=new R({fill:h.playAreaBackgroundColorProperty,sizable:!0,layoutOptions:{grow:1},children:[b]});Ge.multilink([w.localPreferredWidthProperty,w.localPreferredHeightProperty,b.localBoundsProperty],(c,p,y)=>{if(c!==null&&p!==null&&y.isFinite()){const v=c-30,L=p-2*15,B=Math.min(v/y.width,L/y.height);b.setScaleMagnitude(B),b.centerX=c/2,b.centerY=p/2}});const E=j()({spacing:10,stretch:!0,children:[a,new T({spacing:10,stretch:!0,layoutOptions:{grow:1},children:[w,s,new rt,i,new rt,g]})]},e);super(E)}}const xr="#444",Br="#fa0",zr="#888",Ar="#fff",Or="#f00",Tr="#ff0",Mr="#ff0",Rr="#0f0",Hr="#0ff",Dr="#0af",Vr="#f0f";class qr extends Le{constructor(e){const t=new A({children:[new q("Loading image...",{font:K,fill:h.uiForegroundColorProperty})]}),o=new k({children:[t]});super(o,e);x(this,"scanContentNode");x(this,"imageContainer");x(this,"solutionContainer");x(this,"blackImageLayer");x(this,"originalImageLayer");x(this,"thresholdImageLayer");x(this,"contourLayer");x(this,"puzzle",null);x(this,"rootContour",null);x(this,"contours",[]);x(this,"contourNodeMap",new Map);this.scanContentNode=o,this.blackImageLayer=new k,this.originalImageLayer=new k({visible:!1}),this.thresholdImageLayer=new k({visible:!1}),this.contourLayer=new k,this.imageContainer=new k({children:[this.blackImageLayer,this.originalImageLayer,this.thresholdImageLayer,this.contourLayer]}),this.solutionContainer=new k}getScanOptions(){return{originalImageCallback:e=>this.onOriginalImage(e),thresholdedImageCallback:e=>this.onThresholdedImage(e),rootContourCallback:e=>this.onRootContour(e),widestSubtreeCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeWidestContour()},dotContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeDotContour()},lineContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeLineContour()},zeroOuterContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeZeroOuterContour()},zeroInnerContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeZeroInnerContour()},oneContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeOneContour()},twoContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeTwoContour()},threeContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeThreeContour()},xContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeXContour()},unknownContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeUnknownContour()},debugImageCallback:e=>{},puzzleCallback:e=>this.onPuzzle(e),solutionsCallback:e=>this.onSolutions(e)}}onOriginalImage(e){this.originalImageLayer.addChild(new Et(e)),this.blackImageLayer.addChild(R.bounds(this.originalImageLayer.bounds,{fill:"black"})),this.scanContentNode.children=[new T({spacing:10,children:[this.imageContainer,this.solutionContainer]})]}onThresholdedImage(e){this.thresholdImageLayer.addChild(new Et(e))}onRootContour(e){this.rootContour=e,this.contours=e.getDescendantContours();for(const t of this.contours){const o=new Ur(t);this.contourNodeMap.set(t,o),this.contourLayer.addChild(o)}}onPuzzle(e){this.puzzle=e}onSolutions(e){if(e.length===1)this.hide();else{const t=this.puzzle;I()&&F(t);const o=t.board;if(e.length===0){Ne(o,t.stateProperty.value);const r=new me(t,{scale:20});this.solutionContainer.children=[new T({spacing:10,children:[new H("No Solutions Found"),r]})]}else{const r=new he(o,t.stateProperty.value.clone()),a=new he(o,t.stateProperty.value.clone()),s=new he(o,t.stateProperty.value.clone());e[0].forEach(d=>r.stateProperty.value.setEdgeState(d,le.BLACK)),e[1].forEach(d=>a.stateProperty.value.setEdgeState(d,le.BLACK)),o.edges.forEach(d=>{r.stateProperty.value.getEdgeState(d)!==a.stateProperty.value.getEdgeState(d)&&s.stateProperty.value.setEdgeState(d,le.BLACK)}),Ne(o,r.stateProperty.value),Ne(o,a.stateProperty.value),Ne(o,s.stateProperty.value);const i=new me(r,{scale:10}),g=new me(a,{scale:10}),l=new me(s,{scale:10});this.solutionContainer.children=[new T({spacing:10,children:[new H("Multiple Solutions Found"),new A({spacing:10,children:[new T({spacing:10,children:[i,new H("Solution A")]}),new T({spacing:10,children:[g,new H("Solution B")]}),new T({spacing:10,children:[l,new H("Difference")]})]})]})]}}}}class Ur extends k{constructor(e){const t=new U(e.shape,{stroke:xr});super({children:[t]});x(this,"path");this.contour=e,this.path=t}makeWidestContour(){this.path.stroke=Br}makeDotContour(){this.path.stroke=zr}makeLineContour(){this.path.stroke=Ar}makeXContour(){this.path.stroke=Or}makeZeroOuterContour(){this.path.stroke=Tr}makeZeroInnerContour(){this.path.stroke=Mr}makeOneContour(){this.path.stroke=Rr}makeTwoContour(){this.path.stroke=Hr}makeThreeContour(){this.path.stroke=Dr}makeUnknownContour(){this.path.stroke=Vr}}class Wr extends Le{constructor(n,e){super(new T({spacing:20,align:"left",stretch:!0,children:[new k({children:[new Lr(n,{loadPuzzle:t=>{this.hide(),e.loadPuzzle(t)},preferredWidth:700,preferredHeight:300})]}),new rt,new A({spacing:15,grow:1,children:[new ne("Load String",{listener:()=>{this.hide();const t=prompt("Enter puzzle string");t&&e.loadPuzzle(he.loadDeprecatedScalaString(t))}}),new ne("Load Image (Rectangular Only)",{listener:()=>{this.hide();const t=document.createElement("input");t.type="file",t.onchange=o=>{const r=o.target.files[0];var a=new FileReader;a.readAsDataURL(r),a.onloadend=async()=>{const s=a.result,i=new qr(n);i.show();const g=await go(s,i.getScanOptions());e.loadPuzzle(g)}},t.click()}})]})]}),n)}}class Gr extends re{constructor(n){const e=j()({advanced:!1,baseColor:h.uiButtonBaseColorProperty,xMargin:5,yMargin:5,buttonAppearanceStrategy:ue},n);e.advanced&&(e.visibleProperty=J),super(e)}}class Xr{constructor(n,e,t,o){x(this,"maxLineWidth");x(this,"disposeFlatAppearanceStrategy");const r=new kt(t,{luminanceFactor:-.3}),a=new kt(t,{luminanceFactor:-.6}),s=r,i=a,g=X({stroke:a},o),l=1.5;n.stroke=g.stroke||a,n.lineWidth=l,this.maxLineWidth=1.5,n.cachedPaints=[t,s,i];function d(C){let b=1,S=1;switch(C){case ve.IDLE:n.fill=t,n.stroke=r,b=.3;break;case ve.OVER:n.fill=t,n.stroke=r,b=.5;break;case ve.PRESSED:n.fill=t,n.stroke=h.uiButtonSelectedStrokeColorProperty,S=1.5;break;default:throw new Error(`unsupported interactionState: ${C}`)}n.opacity=b,n.lineWidth=S}e.link(d),this.disposeFlatAppearanceStrategy=()=>{e.hasListener(d)&&e.unlink(d),r.dispose(),a.dispose()}}dispose(){this.disposeFlatAppearanceStrategy()}}class Yr{constructor(n,e,t){x(this,"dispose");function o(r){let a=1;switch(r){case ve.IDLE:a=.6;break;case ve.OVER:break;case ve.PRESSED:break;default:throw new Error(`unsupported interactionState: ${r}`)}n.opacity=a}e.link(o),this.dispose=()=>{e.hasListener(o)&&e.unlink(o)}}}class Ye extends A{constructor(n){const e=new xe(n),t=v=>new k({scale:1.3,children:[v]}),{edgeIcon:o,edgeReversedIcon:r,faceColorInsideIcon:a,faceColorOutsideIcon:s,faceColorMatchIcon:i,faceColorOppositeIcon:g,sectorIcon:l,eraserIcon:d,panIcon:C,dragIcon:b}=Ye.getIcons(),S=new Qt(Zo,[{value:Y.EDGE_STATE,labelContent:"Edge Edit Mode",createNode:()=>t(o),options:{visibleProperty:Y.EDGE_STATE.isEnabledProperty}},{value:Y.EDGE_STATE_REVERSED,labelContent:"Edge Reversed Edit Mode",createNode:()=>t(r),options:{visibleProperty:Y.EDGE_STATE_REVERSED.isEnabledProperty}},{value:Y.FACE_COLOR_INSIDE,labelContent:"Face Color Inside Edit Mode",createNode:()=>t(a),options:{visibleProperty:Y.FACE_COLOR_INSIDE.isEnabledProperty}},{value:Y.FACE_COLOR_OUTSIDE,labelContent:"Face Color Outside Edit Mode",createNode:()=>t(s),options:{visibleProperty:Y.FACE_COLOR_OUTSIDE.isEnabledProperty}},{value:Y.FACE_COLOR_MATCH,labelContent:"Face Color Match Edit Mode",createNode:()=>t(i),options:{visibleProperty:Y.FACE_COLOR_MATCH.isEnabledProperty}},{value:Y.FACE_COLOR_OPPOSITE,labelContent:"Face Color Opposite Edit Mode",createNode:()=>t(g),options:{visibleProperty:Y.FACE_COLOR_OPPOSITE.isEnabledProperty}},{value:Y.SECTOR_STATE,labelContent:"Sector Edit Mode",createNode:()=>t(l),options:{visibleProperty:Y.SECTOR_STATE.isEnabledProperty}}],{spacing:15,layoutOptions:{grow:1}});S.children.forEach(v=>v.addInputListener(e));const w={buttonAppearanceStrategy:ue,baseColor:h.uiButtonBaseColorProperty,disabledColor:h.uiButtonDisabledColorProperty,mouseAreaXDilation:5,mouseAreaYDilation:5,touchAreaXDilation:5,touchAreaYDilation:5},E=new Bo(gt,X({},w,{accessibleName:"Eraser Mode (Toggle)",content:t(d),buttonAppearanceStrategy:Xr,contentAppearanceStrategy:Yr}));E.addInputListener(e);const c=t(C),p=t(b),y=new k;Ce.link(v=>{y.children=[v===ie.PAN_ONLY?c:p]});const P=new Gr({content:y,listener:()=>{Ce.value=Ce.value===ie.PAN_ONLY?ie.DRAG_ONLY:ie.PAN_ONLY}});Ce.link(v=>{P.accessibleName=v===ie.PAN_ONLY?"Pan Mode (toggle)":"Drag Input Mode (toggle)"}),P.addInputListener(e),super({spacing:13,stretch:!0,children:[S,new fo,E,P]}),n.layoutBoundsProperty.link(v=>{this.maxWidth=Math.max(1,v.width-2*be)})}static getIcons(){const n=new st(0,0,15,0,{stroke:h.uiButtonForegroundProperty,lineWidth:4,lineCap:"round"}),e=6,t=new O().moveTo(-e,-e).lineTo(e,e).moveTo(-e,e).lineTo(e,-e),o=new U(t,{stroke:h.uiButtonForegroundProperty,lineWidth:2}),r=new k({children:[new R(0,0,14,14,{stroke:h.uiButtonForegroundProperty,fill:h.uiButtonFaceOutsideColorProperty})]}),a=new k({children:[new R(0,0,14,14,{stroke:h.uiButtonForegroundProperty,fill:h.uiButtonFaceInsideColorProperty})]}),s=new k({children:[new R(0,0,7,7,{stroke:h.uiButtonForegroundProperty,fill:h.uiForegroundColorProperty}),new R(7,7,7,7,{stroke:h.uiButtonForegroundProperty,fill:h.uiForegroundColorProperty})]}),i=new k({children:[new R(0,0,7,7,{stroke:h.uiButtonForegroundProperty,fill:h.uiForegroundColorProperty}),new R(7,7,7,7,{stroke:h.uiButtonForegroundProperty,fill:h.uiBackgroundColorProperty})]}),g=new k({children:[new U(new O().moveTo(0,14).lineTo(0,0).lineTo(14,0),{stroke:h.uiButtonForegroundProperty}),new U(new O().arc(0,0,7,0,Math.PI/2,!1),{stroke:h.uiButtonForegroundProperty})]}),l=17,d=6,C=7,b=2,S=C/Math.sqrt(2),w=new k({children:[new k({rotation:-Math.PI/4,children:[new R(0,0,l,C,{stroke:h.uiButtonForegroundProperty,fill:h.uiButtonInvertedForegroundProperty,cornerRadius:b}),new R(d,0,l-d,C,{fill:h.uiButtonForegroundProperty,cornerRadius:b})]}),new st(S,S-.5,S+12,S-.5,{stroke:h.uiButtonForegroundProperty,lineDash:[5,1,3,1,2]})]}),E=new U(kr.transformed(qe.rotationZ(Math.PI/4)),{fill:h.uiButtonForegroundProperty,maxWidth:14,maxHeight:14}),c=new k({children:[new U(jt,{fill:h.uiButtonForegroundProperty,matrix:qe.Y_REFLECTION,maxWidth:14,maxHeight:14}),new U(new O().moveTo(0,1.5).lineTo(12,1.5),{stroke:h.uiButtonForegroundProperty,lineDash:[9,1,2]})]}),p=new Tt;return{edgeIcon:p.createBox(n),edgeReversedIcon:p.createBox(o),faceColorInsideIcon:p.createBox(a),faceColorOutsideIcon:p.createBox(r),faceColorMatchIcon:p.createBox(s),faceColorOppositeIcon:p.createBox(i),sectorIcon:p.createBox(g),eraserIcon:p.createBox(w),panIcon:p.createBox(E),dragIcon:p.createBox(c)}}}class z extends wo{constructor(n,e){const t=j()({font:K,fill:h.uiForegroundColorProperty,linkFill:h.uiLinkColorProperty},e);super(n,t)}}class Jr extends Le{constructor(n){self.phet.chipper.isFuzzEnabled=()=>!1;const e=Ye.getIcons(),t=Be.getIcons(),o=a=>new k({children:[R.bounds(a.bounds.dilated(3),{fill:h.uiButtonBaseColorProperty,stroke:h.uiButtonSelectedStrokeColorProperty,cornerRadius:3}),a]}),r=650;super(new T({spacing:10,align:"left",children:[new z("Slitherlink",{font:oe}),new z("Slitherlink is a logic puzzle where you draw a <strong>single continuous loop</strong> on a grid. The goal is to connect dots without crossing or overlapping, creating a loop that adheres to specific rules based on the numbers in some cells.",{lineWrap:r}),new T({spacing:2,align:"left",children:[new z("The loop must satisfy the following rules:"),new z("The loop cannot cross or touch itself.",{layoutOptions:{leftMargin:20}}),new z("Each numbered cell must have exactly that number of sides in the loop.",{layoutOptions:{leftMargin:20}})]}),new z("Solving",{font:oe}),new z('<a href="{{solvingGuide}}">See the Solving Guide</a>',{font:lr,links:{solvingGuide:"./"},layoutOptions:{align:"center"}}),new z("Edit Modes",{font:oe}),new T({spacing:5,align:"left",children:[new z('<node id="edge" align="center"/> + click/tap adds a line, <node id="x" align="center"/> marks where lines are impossible',{lineWrap:r,nodes:{edge:o(e.edgeIcon),x:o(e.edgeReversedIcon)}}),new z('<node id="inside" align="center"/> + click/tap marks with the inside color, <node id="outside" align="center"/> marks with the outside color',{lineWrap:r,nodes:{inside:o(e.faceColorInsideIcon),outside:o(e.faceColorOutsideIcon)}}),new z('<node id="same" align="center"/> + click/tap on 1st cell + click/tap on 2nd to match colors, <node id="opposite" align="center"/> marks opposite colors',{lineWrap:r,nodes:{same:o(e.faceColorMatchIcon),opposite:o(e.faceColorOppositeIcon)}}),new A({spacing:10,children:[o(e.sectorIcon),new z(" + click/tap to pop up a selector, then select the sector color (see solving guide)")],visibleProperty:ce})]}),new z("The number keys (1-9) can switch between edit modes. E will activate the eraser when pressed."),new z("The line/X and inside/outside color controls will cycle through the states (e.g. blank => line => X => blank) by default, but can be changed to toggle (e.g. blank => line, line => blank, X => line) in settings.",{lineWrap:r}),new z("Modifiers",{font:oe}),new z(`With erase (<node id="erase" align="center"/>) toggled on, edit modes will instead erase lines/X's/colors.`,{lineWrap:r,nodes:{erase:o(e.eraserIcon)}}),new z('Pan mode (<node id="pan" align="center"/>) will treat dragging as panning the view, while drag-edit mode (<node id="drag" align="center"/>) will allow setting the state of many lines/cells with one dragged press.',{lineWrap:r,nodes:{pan:o(e.panIcon),drag:o(e.dragIcon)}}),new z('Right-click or shift-click will activate the "opposite" mode (e.g. in line mode, shift-click will set an X). This will work for <node id="edge" align="center"/> / <node id="x" align="center"/>, <node id="inside" align="center"/> / <node id="outside" align="center"/>, and the final click for <node id="same" align="center"/> / <node id="opposite" align="center"/>.',{lineWrap:r,nodes:{edge:o(e.edgeIcon),x:o(e.edgeReversedIcon),inside:o(e.faceColorInsideIcon),outside:o(e.faceColorOutsideIcon),same:o(e.faceColorMatchIcon),opposite:o(e.faceColorOppositeIcon)}}),new z("View Styles",{font:oe}),new T({spacing:5,align:"left",children:[new A({spacing:10,children:[o(t.classicIcon),new z("Classic Slitherlink style, just lines/X's.")]}),new A({spacing:10,children:[o(t.basicLinesIcon),new z(`Cleaner lines (missing lines are X's, thin lines are "blank"), inside/outside colors`)]}),new A({spacing:10,children:[o(t.basicFaceColoringIcon),new z("Cleaner with face coloring (lighter/darker color pairs are inside/outside or outside/inside)")]}),new A({spacing:10,children:[o(t.pureFaceColoringIcon),new z("Similar to above, but without showing lines at all")]}),new A({spacing:10,children:[o(t.basicSectorsIcon),new z("Cleaner lines, with sectors (see the solving guide)")],visibleProperty:ce}),new A({spacing:10,children:[o(t.sectorsWithColorsIcon),new z("Cleaner lines with colors and sectors (see the solving guide)")],visibleProperty:ce})]}),new z("About / Contact",{font:oe}),new z('My name is Jonathan Olson, and I created this Slitherlink interface to explore the limits of solving techniques and to provide a seamless experience on both desktop and mobile. I value your feedback and would love to hear any questions, comments, or suggestions. Please reach out to me at <a href="{{email}}">jonathan.olson@colorado.edu</a>.',{lineWrap:r,links:{email:"mailto:jonathan.olson@colorado.edu"}})]}),n)}}class Kr extends Le{constructor(e){const t=new ht(!1),o=new ne("Copy URL",{accessibleName:"Copy Shareable URL to Clipboard",listener:()=>{if(this.puzzle){const r=location.protocol+"//"+location.host+location.pathname;let a=this.puzzle;this.includeStateProperty.value||(a=new he(a.board,Kt.fromFaceValueData(a.board,a.stateProperty.value)));const s=jo(a);cr(r+"?p="+encodeURIComponent(s))}}});o.addInputListener(new xe(e));super(new T({spacing:20,align:"left",stretch:!0,children:[o,new N("Include Solve Progress",t)]}),e);x(this,"includeStateProperty");x(this,"puzzle",null);this.includeStateProperty=t}setPuzzle(e){this.puzzle=e}reset(){super.reset(),this.includeStateProperty.reset()}}class Zr extends q{constructor(n,e){const t=j()({font:dr,fill:h.timerColorProperty},e),o=60,r=60*o,a=24*r,s=new ge([n],i=>{i=Math.ceil(i);const g=Math.floor(i/a);i-=g*a;const l=Math.floor(i/r);i-=l*r;const d=Math.floor(i/o);i-=d*o;const C=i,b=l<10?`0${l}`:`${l}`,S=d<10?`0${d}`:`${d}`,w=C<10?`0${C}`:`${C}`;return g?`${g}d ${b}:${S}:${w}`:l?`${b}:${S}:${w}`:`${S}:${w}`});super(s,t),this.timerProperty=n,this.disposeEmitter.addListener(()=>{s.dispose()})}}class jr extends A{constructor(n,e,t){const o=new xe(e),r=new pe(!1),a=new pe(0),s=new pe(de.NOT_FOUND),i=new we(n,{derive:y=>y?y.undoPossibleProperty:r}),g=new we(n,{derive:y=>y?y.redoPossibleProperty:r}),l=new we(n,{derive:y=>y?y.isSolvedProperty:r}),d=new we(n,{derive:y=>y?y.timeElapsedProperty:a}),C=new we(n,{derive:y=>y?y.hintStateProperty:s}),b=new ge([l],y=>!y);let S=null,w=null,E=null,c=null;const p={buttonAppearanceStrategy:ue,baseColor:h.uiButtonBaseColorProperty,disabledColor:h.uiButtonDisabledColorProperty,xMargin:8*1.3,yMargin:5*1.3,mouseAreaXDilation:5,mouseAreaYDilation:5,touchAreaXDilation:5,touchAreaYDilation:5};super({spacing:10,stretch:!0,children:[new Ve("New",X({},p,{accessibleName:"New",listener:()=>{S=S||new Wr(e,{loadPuzzle:t.loadPuzzle}),S.show()},textFill:h.uiButtonForegroundProperty,baseColor:h.uiButtonBaseColorProperty,xMargin:5,yMargin:5,font:ot,buttonAppearanceStrategy:ue})),new re(X({},p,{accessibleName:"Undo All",content:se(vr),listener:()=>{n.value&&n.value.onUserUndoAll()},enabledProperty:i,visibleProperty:dt})),new re(X({},p,{accessibleName:"Undo",content:se(Cr),listener:()=>{n.value&&n.value.onUserUndo()},enabledProperty:i,fireOnHold:!0})),new Zr(d,{visibleProperty:Jt}),new re(X({},p,{accessibleName:"Redo",content:se(Pr),listener:()=>{n.value&&n.value.onUserRedo()},enabledProperty:g,fireOnHold:!0})),new re(X({},p,{accessibleName:"Redo All",content:se(Sr),listener:()=>{n.value&&n.value.onUserRedoAll()},enabledProperty:g,visibleProperty:dt})),new re(X({},p,{accessibleName:"Settings",content:se(mr),listener:()=>{E=E||new Nr(e),E.show()}})),new re(X({},p,{accessibleName:"Share",content:se(br),listener:()=>{const y=n.value;y&&(w=w||new Kr(e),w.setPuzzle(y.puzzle),w.show())}})),new Ve("Solve",X({},p,{accessibleName:"Solve",listener:()=>{n.value&&n.value.onUserRequestSolve()},enabledProperty:b,textFill:h.uiButtonForegroundProperty,baseColor:h.uiButtonBaseColorProperty,xMargin:5,yMargin:5,font:ot,buttonAppearanceStrategy:ue})),new Ve("Hint",X({},p,{accessibleName:"Hint",listener:()=>{n.value&&n.value.onUserRequestHint()},enabledProperty:new ge([b,C],(y,P)=>y&&P===de.DEFAULT),textFill:h.uiButtonForegroundProperty,baseColor:h.uiButtonBaseColorProperty,xMargin:5,yMargin:5,font:ot,buttonAppearanceStrategy:ue})),new re(X({},p,{accessibleName:"Help",content:se(Er),listener:()=>{c=c||new Jr(e),c.show()}}))]}),this.puzzleModelProperty=n,this.children.forEach(y=>y.addInputListener(o)),e.layoutBoundsProperty.link(y=>{this.maxWidth=Math.max(1,y.width-2*be)})}}const Qr=h.uiForegroundColorProperty,$r=new ge([h.uiForegroundColorProperty],u=>u.withAlpha(.15));class _r extends k{constructor(n,e,t,o){super({});const r=new hr({diameter:20,activeColor:Qr,inactiveColor:$r});this.disposeEmitter.addListener(()=>r.dispose());const a={xMargin:5,yMargin:5,fill:h.uiBackgroundColorProperty,stroke:h.uiForegroundColorProperty},s=new Fe(new A({spacing:10,children:[new k({children:[r]}),new H("Loading Hint Solver...")]}),a),i=new A({spacing:10,children:[new Fe(new A({spacing:10,children:[new k({children:[r]}),new H("Searching for Hint...")]}),a),new ne("Cancel",{listener:o})]}),g=new A({spacing:10,children:[new ne("Apply Hint",{listener:t}),new ne("Hide Hint",{listener:o})]}),l=new Fe(new H("No Hint Found"),a);l.pickable=!1;const d=b=>{this.children=[...b===de.LOADING?[s]:[],...b===de.SEARCHING?[i]:[],...b===de.FOUND?[g]:[],...b===de.NOT_FOUND?[l]:[]]};e.link(d),this.disposeEmitter.addListener(()=>e.unlink(d));const C=b=>{r.step(b)};n.stepEmitter.addListener(C),this.disposeEmitter.addListener(()=>n.stepEmitter.removeListener(C))}}class es extends k{constructor(n,e){const t=[],o=[],r=g=>{const l=g.getStrokedShape(new Ro({lineWidth:.3,lineCap:"round",lineJoin:"round"}));t.push(...l.subpaths)},a=g=>{const l=g.getOffsetShape(-.1);o.push(...l.subpaths)},s=g=>{r(new O().moveToPoint(g.start.viewCoordinates).lineToPoint(g.end.viewCoordinates))},i=g=>{g.edges.every(l=>!e.incorrectEdges.has(l))&&a(O.polygon(g.vertices.map(l=>l.viewCoordinates)))};e.incorrectEdges.forEach(s),e.incorrectFaces.forEach(i),super({children:[new U(new O(t),{fill:h.incorrectEdgeColorProperty}),new U(new O(o),{fill:h.incorrectFaceColorProperty})],pickable:!1,filters:[new yo(.1)]})}}class ts extends k{constructor(e,t){const o=j()({focusNodeCallback:()=>{}},t),r=new me(e.puzzle,{edgePressListener:(l,d)=>e.onUserEdgePress(l,d),onEdgeDragStart:(l,d)=>e.onUserEdgeDragStart(l,d),onEdgeDrag:(l,d)=>e.onUserEdgeDrag(l,d),onEdgeDragEnd:()=>e.onUserEdgeDragEnd(),facePressListener:(l,d)=>e.onUserFacePress(l,d),onFaceDragStart:(l,d)=>e.onUserFaceDragStart(l,d),onFaceDrag:(l,d)=>e.onUserFaceDrag(l,d),onFaceDragEnd:()=>e.onUserFaceDragEnd(),sectorPressListener:(l,d)=>e.onUserSectorPress(l,d),sectorSetListener:(l,d)=>e.onUserSectorSet(l,d),selectedFaceColorHighlightProperty:e.selectedFaceColorHighlightProperty,selectedSectorEditProperty:e.selectedSectorEditProperty,style:e.style,delayEdgeInteractionEmitter:e.edgeAutoSolvedEmitter}),a=new k;super(X({children:[r,a]},o));x(this,"puzzleNode");this.puzzleModel=e,this.puzzleNode=r,this.disposeEmitter.addListener(()=>r.dispose());let s=null;const i=l=>{if(r.clearAnnotationNodes(),s&&(s.dispose(),s=null),l){const d=new Tn(e.puzzle.board,l,e.style,r.getBackgroundBounds());r.addAnnotationNode(d),s=d,o.focusNodeCallback(d)}};this.disposeEmitter.addListener(()=>{s&&(s.dispose(),s=null)}),e.displayedAnnotationProperty.link(i),this.disposeEmitter.addListener(()=>e.displayedAnnotationProperty.unlink(i));const g=Ge.multilink([ct,e.correctnessStateProperty],(l,d)=>{const C=()=>{a.children.forEach(b=>b.dispose())};l&&!d.isCorrect()?setTimeout(()=>{if(ct.value&&d===e.correctnessStateProperty.value){const b=new es(e.puzzle.board,d);C(),a.children=[b],console.log("showing error")}},Math.ceil(Qo.value*1e3)):C()});this.disposeEmitter.addListener(()=>g.dispose())}}class G{constructor(n,e){this.layoutPuzzle=n,this.derivatives=e}plus(n){const e=new Map;return this.derivatives.forEach((t,o)=>{e.set(o,t.plus(n.derivatives.get(o)))}),new G(this.layoutPuzzle,e)}minus(n){const e=new Map;return this.derivatives.forEach((t,o)=>{e.set(o,t.minus(n.derivatives.get(o)))}),new G(this.layoutPuzzle,e)}timesScalar(n){const e=new Map;return this.derivatives.forEach((t,o)=>{e.set(o,t.timesScalar(n))}),new G(this.layoutPuzzle,e)}getMaxMagnitude(){let n=0;return this.derivatives.forEach(e=>{n=Math.max(n,e.getMagnitude())}),n}getAreaCorrectedDerivative(){let n=this;for(let e=0;e<5;e++)n=n.getAreaCorrectedDerivativeOnce();return n}getAreaCorrectedDerivativeOnce(){return this.plus(G.getAreaScaledDeltas(this.layoutPuzzle,-this.getAreaDerivative()/this.layoutPuzzle.getSignedArea()))}getAreaDerivative(){let n=0;return this.layoutPuzzle.faces.forEach(e=>{n+=Ho(e.vertices.map(t=>t.viewCoordinates),e.vertices.map(t=>this.derivatives.get(t)))}),n}getDebugNode(){const n=new k;return this.layoutPuzzle.vertices.forEach(e=>{const t=this.derivatives.get(e),o=e.viewCoordinates,r=new gr(o.x,o.y,o.x+t.x,o.y+t.y,{lineWidth:.01,headHeight:.05,headWidth:.05,tailWidth:.005,fill:"green",stroke:"green"});n.addChild(r)}),n}static getAreaScaledDeltas(n,e){const t=n.getCentroid(),o=new Map;return n.vertices.forEach(r=>{const a=r.viewCoordinates.minus(t).timesScalar(e);I()&&F(a.isFinite()),o.set(r,a)}),new G(n,o)}static getHookesAttraction(n,e,t){const o=new Map;return n.vertices.forEach(r=>{o.set(r,te.ZERO.copy())}),n.edges.forEach(r=>{const a=r.start.viewCoordinates,i=r.end.viewCoordinates.minus(a),g=i.getMagnitude(),l=i.timesScalar((g-e)*t/g);I()&&F(l.isFinite()),o.get(r.start).add(l),o.get(r.end).subtract(l)}),new G(n,o)}static getRegularPolygonDeltas(n,e,t,o){const r=new Map;n.vertices.forEach(s=>{r.set(s,te.ZERO.copy())});const a=s=>e/(2*Math.sin(Math.PI/s));return n.faces.forEach(s=>{if(s.vertices.length<3)return;const i=.2,g=.3,l=s.vertices.map(P=>P.viewCoordinates);let d=0;const C=at(l);C<0?d=1:C<i&&(d=Math.max(d,(i-C)/i));for(let P=0;P<l.length&&!(d>=1);P++){const v=P,L=(P+1)%l.length,B=l[v],f=l[L];for(let m=P+2;m<l.length-(P===0?1:0)&&!(d>=1);m++){const _=m%l.length,ee=(m+1)%l.length,D=l[_],V=l[ee];if(fe.lineSegmentIntersection(B.x,B.y,f.x,f.y,D.x,D.y,V.x,V.y))I()&&F(l.length>=4),d=1;else{const Ae=Math.min(fe.distToSegment(B,D,V),fe.distToSegment(f,D,V),fe.distToSegment(D,B,f),fe.distToSegment(V,B,f));Ae<g&&(d=Math.max(d,(g-Ae)/g))}}}if(d===0&&t&&n.getFaceValue(s)===null)return;const b=Se(l);I()&&F(b.isFinite());const S=a(l.length),w=l.map(P=>P.minus(b)),E=l.map((P,v)=>te.createPolar(S,2*Math.PI*v/l.length)),c=G.getLeastSquares(w,E),p=o+(2-o)*d,y=l.map((P,v)=>c[v].minus(w[v]).timesScalar(p));s.vertices.forEach((P,v)=>{const L=y[v];I()&&F(L.isFinite()),r.get(P).add(L)})}),new G(n,r)}static getBarycentricDeltas(n){const e=new Map;return n.vertices.forEach(t=>{const o=t.edges.map(s=>s.getOtherVertex(t)),r=new te(0,0);o.forEach(s=>r.add(s.viewCoordinates)),r.multiplyScalar(1/o.length);const a=r.subtract(t.viewCoordinates);I()&&F(a.isFinite()),e.set(t,a)}),new G(n,e)}static getAngularDeltas(n,e){const t=new Map;return n.vertices.forEach(o=>{t.set(o,te.ZERO.copy())}),n.vertices.forEach(o=>{const r=o.edges.map(w=>w.getOtherVertex(o));let a=ye.sortBy(r,w=>w.viewCoordinates.minus(o.viewCoordinates).getAngle());if(a[0]!==r[0]){const w=a.indexOf(r[0]);a=[...a.slice(w),...a.slice(0,w)]}const s=ye.range(0,r.length).every(w=>a[w]===r[w]),i=r.map(w=>w.viewCoordinates.minus(o.viewCoordinates).normalized()),g=G.getUnitLeastSquares(i),l=Math.max(...ye.range(0,r.length).map(w=>g[w].dot(g[(w+1)%r.length]))),d=Math.max(...ye.range(0,r.length).map(w=>i[w].dot(i[(w+1)%r.length]))),C=(w,E)=>E<=.5?.5*Math.pow(2*E,w):1-C(w,1-E),b=s?fe.linear(l,1,0,1,d):1,S=.75;if(b>S){const w=(b-S)/(1-S),E=C(2,w),c=new te(0,0);for(let p=0;p<r.length;p++){const y=r[p],P=i[p],v=g[p],L=v.minus(P.timesScalar(v.dot(P))).timesScalar(E*e);c.add(L),I()&&F(L.isFinite()),t.get(y).add(L)}c.multiplyScalar(1/r.length);for(const p of r)I()&&F(c),t.get(p).subtract(c)}}),new G(n,t)}static getUnitLeastSquares(n){const e=n.length,t=ye.range(0,e).map(o=>te.createPolar(1,2*Math.PI*o/e));return G.getLeastSquares(n,t)}static getLeastSquares(n,e){const t=n.length,o=new je(2,t,[...e.map(l=>l.x),...e.map(l=>l.y)]),r=new je(2,t,[...n.map(l=>l.x),...n.map(l=>l.y)]),a=o.times(r.transpose()),s=new ho(a);let i=s.getV().times(s.getU().transpose());i.det()<0&&(i=s.getV().times(je.diagonalMatrix([1,-1])).times(s.getU().transpose()));const g=new qe().rowMajor(i.get(0,0),i.get(0,1),0,i.get(1,0),i.get(1,1),0,0,0,1);return e.map(l=>{const d=g.timesVector2(l);return I()&&F(d.isFinite()),d})}}class os extends Do{constructor(e,t){const o=new Map,r=new Map,a=new Map,s=new Map,i=new Map,g=new Map,l=new Map,d=new Map,C=f=>{const m=o.get(f);return I()&&F(m),m},b=f=>{const m=r.get(f);return I()&&F(m),m},S=f=>{const m=a.get(f);return I()&&F(m),m},w=f=>{const m=s.get(f);return I()&&F(m),m},E=f=>{const m=i.get(f);return I()&&F(m),m},c=f=>{const m=g.get(f);return I()&&F(m),m},p=f=>{const m=l.get(f);return I()&&F(m),m},y=f=>{const m=d.get(f);return I()&&F(m),m},P=e.vertices.map(f=>{const m=new fr(f.logicalCoordinates,f.viewCoordinates);return o.set(f,m),i.set(m,f),m}),v=e.faces.map(f=>{const m=new Bt(f.logicalCoordinates,f.viewCoordinates);return r.set(f,m),g.set(m,f),m.originalFace=f,m}),L=[],B=e.edges.map(f=>{const m=o.get(f.start),_=o.get(f.end);I()&&F(m),I()&&F(_);const ee=new xt(m,_);ee.originalEdges.add(f),a.set(f,ee),l.set(ee,f);const D=new He(m,_,!1);s.set(f.forwardHalf,D),d.set(D,f.forwardHalf),L.push(D);const V=new He(_,m,!0);return s.set(f.reversedHalf,V),d.set(V,f.reversedHalf),L.push(V),ee});P.forEach(f=>{const m=E(f);f.incomingHalfEdges=m.incomingHalfEdges.map(w),f.outgoingHalfEdges=m.outgoingHalfEdges.map(w),f.edges=m.edges.map(S),f.faces=m.faces.map(b)}),v.forEach(f=>{const m=c(f);f.halfEdges=m.halfEdges.map(w),f.edges=m.edges.map(S),f.vertices=m.vertices.map(C)}),B.forEach(f=>{const m=p(f);f.forwardHalf=w(m.forwardHalf),f.reversedHalf=w(m.reversedHalf),f.forwardFace=m.forwardFace?b(m.forwardFace):null,f.reversedFace=m.reversedFace?b(m.reversedFace):null,f.vertices=m.vertices.map(C),f.faces=m.faces.map(b)}),L.forEach(f=>{const m=y(f);f.edge=S(m.edge),f.reversed=w(m.reversed),f.next=w(m.next),f.previous=w(m.previous),f.face=m.face?b(m.face):null});super({edges:B,vertices:P,faces:v,halfEdges:L,outerBoundary:e.outerBoundary.map(w),innerBoundaries:e.innerBoundaries.map(f=>f.map(w))});x(this,"edgeStateMap",new Map);x(this,"faceValueMap",new Map);this.originalBoard=e,this.originalState=t,B.forEach(f=>{this.edgeStateMap.set(f,t.getEdgeState(p(f)))}),v.forEach(f=>{this.faceValueMap.set(f,t.getFaceValue(c(f)))}),I()&&Qe(this)}getFaceValue(e){const t=this.faceValueMap.get(e);return I()&&F(t!==void 0),t}getEdgeState(e){const t=this.edgeStateMap.get(e);return I()&&F(t!==void 0),t}clearSatisfiedFaces(){this.faces.forEach(e=>{const t=this.getFaceValue(e);if(t===null)return;let o=0,r=0;e.edges.forEach(a=>{const s=this.getEdgeState(a);s===le.WHITE?o++:s===le.BLACK&&r++}),o===0&&r===t&&this.faceValueMap.set(e,null)})}removeDeadRedEdges(){const e=new Set(this.edges.filter(s=>this.getEdgeState(s)===le.RED&&s.faces.every(i=>i===null||this.getFaceValue(i)===null))),t=new Set(this.vertices.filter(s=>s.edges.every(i=>e.has(i)))),o=new Set(this.faces.filter(s=>s.edges.some(i=>e.has(i)))),r=[],a=new Set(o);for(;a.size;){const s=a.values().next().value;a.delete(s);const i=[s];let g=!1;for(let c=0;c<i.length;c++){const p=i[c];p.edges.forEach(y=>{e.has(y)&&[y.forwardFace,y.reversedFace].forEach(P=>{if(P!==p){if(P===null){g=!0;return}a.has(P)&&(a.delete(P),i.push(P))}})})}const l=new Set(i.flatMap(c=>c.halfEdges)),d=new Set(i.flatMap(c=>c.halfEdges.map(p=>p.reversed))),C=new Set([...l].filter(c=>!d.has(c))),b=c=>{let p=c.next;for(;p!==c&&!C.has(p);)p=p.reversed.next;return I()&&F(p!==c),p},S=C.values().next().value,w=[S];let E=b(S);for(;E!==S;)w.push(E),E=b(E);if(I()&&F(w.length===C.size),g){const c=[];for(let p=0;p<w.length;p++){const y=w[p],P=w[(p+w.length-1)%w.length];if(I()&&F(P.end===y.start),!e.has(y.edge)&&e.has(P.edge)){const v=[y];for(let L=p+1;;L++){const B=w[L%w.length];if(e.has(B.edge))break;v.push(B)}c.push(v)}}r.push(new wr(i,w,c))}else r.push(new zt(i,w))}r.forEach(s=>{if(s instanceof zt){const i=s.boundaryHalfEdges.map(d=>d.start),g=s.boundaryHalfEdges.map(d=>d.edge),l=new Bt(Se(i.map(d=>d.viewCoordinates)),Se(i.map(d=>d.logicalCoordinates)));this.faces.push(l),this.faceValueMap.set(l,null),l.halfEdges=s.boundaryHalfEdges,l.edges=g,l.vertices=i;for(let d=0;d<s.boundaryHalfEdges.length;d++){const C=s.boundaryHalfEdges[d],b=C.face;C.face=l;const S=C.edge;C.isReversed?S.reversedFace=l:S.forwardFace=l,I()&&F(b),b&&M(S.faces,b),S.faces.push(l)}}else s.boundarySegments.forEach(i=>{i.forEach(g=>{const l=g.edge,d=g.face;d&&(g.face=null,M(l.faces,d)),g.isReversed?l.reversedFace=null:l.forwardFace=null})})}),e.forEach(s=>{M(this.edges,s),M(this.halfEdges,s.forwardHalf),M(this.halfEdges,s.reversedHalf)}),t.forEach(s=>{M(this.vertices,s)}),o.forEach(s=>{M(this.faces,s)}),this.vertices.forEach(s=>{s.edges=s.edges.filter(i=>!e.has(i)),s.incomingHalfEdges=s.incomingHalfEdges.filter(i=>!e.has(i.edge)),s.outgoingHalfEdges=s.outgoingHalfEdges.filter(i=>!e.has(i.edge)),s.faces=s.incomingHalfEdges.map(i=>i.face).filter(i=>i!==null);for(let i=0;i<s.incomingHalfEdges.length;i++){const g=s.outgoingHalfEdges[i],l=s.incomingHalfEdges[(i+1)%s.incomingHalfEdges.length];l.next=g,g.previous=l}}),I()&&Qe(this)}removeSimpleForced(){this.vertices.slice().forEach(e=>{if(e.edges.length!==2||ye.uniq(e.edges.flatMap(y=>y.faces)).some(y=>this.getFaceValue(y)!==null))return;const o=e.edges[0],r=e.edges[1],a=this.getEdgeState(o),s=this.getEdgeState(r);if(a!==s)return;const i=o.getOtherVertex(e),g=r.getOtherVertex(e);if(i===g)return;const l=o.forwardHalf.end===e?o.forwardHalf:o.reversedHalf,d=o.forwardHalf.end===e?o.reversedHalf:o.forwardHalf,C=r.forwardHalf.start===e?r.forwardHalf:r.reversedHalf,b=r.forwardHalf.start===e?r.reversedHalf:r.forwardHalf,S=l.face,w=d.face,E=new xt(i,g);o.originalEdges.forEach(y=>E.originalEdges.add(y)),r.originalEdges.forEach(y=>E.originalEdges.add(y)),this.edgeStateMap.set(E,a),this.edges.push(E);const c=new He(i,g,!1);this.halfEdges.push(c);const p=new He(g,i,!0);if(this.halfEdges.push(p),E.forwardHalf=c,E.reversedHalf=p,E.forwardFace=S,E.reversedFace=w,E.vertices=[i,g],E.faces=[S,w].filter(y=>y!==null),c.edge=E,c.reversed=p,c.next=C.next,c.previous=l.previous,c.face=S,p.edge=E,p.reversed=c,p.next=d.next,p.previous=b.previous,p.face=w,S){const y=S.halfEdges.indexOf(l),P=S.edges.indexOf(o);I()&&F(y!==-1),I()&&F(P!==-1),S.halfEdges[y]=c,M(S.halfEdges,C),S.edges[P]=E,M(S.edges,r),M(S.vertices,e)}if(w){const y=w.halfEdges.indexOf(b),P=w.edges.indexOf(r);I()&&F(y!==-1),I()&&F(P!==-1),w.halfEdges[y]=p,M(w.halfEdges,d),w.edges[P]=E,M(w.edges,o),M(w.vertices,e)}{const y=i.incomingHalfEdges.indexOf(d),P=i.outgoingHalfEdges.indexOf(l),v=i.edges.indexOf(o);I()&&F(y!==-1),I()&&F(P!==-1),I()&&F(v!==-1),i.incomingHalfEdges[y]=p,i.outgoingHalfEdges[P]=c,i.edges[v]=E}{const y=g.incomingHalfEdges.indexOf(C),P=g.outgoingHalfEdges.indexOf(b),v=g.edges.indexOf(r);I()&&F(y!==-1),I()&&F(P!==-1),I()&&F(v!==-1),g.incomingHalfEdges[y]=c,g.outgoingHalfEdges[P]=p,g.edges[v]=E}c.previous.next=c,c.next.previous=c,p.previous.next=p,p.next.previous=p,M(this.edges,o),M(this.edges,r),M(this.halfEdges,o.forwardHalf),M(this.halfEdges,o.reversedHalf),M(this.halfEdges,r.forwardHalf),M(this.halfEdges,r.reversedHalf),M(this.vertices,e)}),I()&&Qe(this)}simplify(){this.clearSatisfiedFaces(),this.removeDeadRedEdges(),this.removeSimpleForced()}fixOuterBoundary(){const e=new Set(this.halfEdges.filter(r=>r.face===null)),t=[],o=[];for(;e.size;){const r=e.values().next().value;e.delete(r);const a=[r];let s=r.next;for(;s!==r;)a.push(s),e.delete(s),s=s.next;at(a.map(i=>i.start.viewCoordinates))<0?t.push(a):o.push(a)}I()&&F(t.length===1),this.outerBoundary.length=0,this.outerBoundary.push(...t[0]),this.innerBoundaries.length=0,this.innerBoundaries.push(...o)}getCompleteState(){this.fixOuterBoundary();const e=Kt.fromFacesEdges(this,t=>this.getFaceValue(t),t=>this.getEdgeState(t));return Ne(this,e),e}getCompletePuzzle(){return{board:this,state:this.getCompleteState()}}getSignedArea(){let e=0;return this.faces.forEach(t=>{e+=at(t.vertices.map(o=>o.viewCoordinates))}),e}getCentroid(){let e=0,t=0,o=0;return this.halfEdges.forEach(r=>{if(r.face===null){const a=r.end.viewCoordinates,s=r.start.viewCoordinates;e+=(s.x+a.x)*(s.y-a.y);const i=a.x*(2*a.y+s.y)+s.x*(a.y+2*s.y);t+=(a.x-s.x)*i,o+=(s.y-a.y)*i}}),e*=.5,new te(t,o).timesScalar(1/(6*e))}applyDerivative(e){this.vertices.forEach(t=>{const o=e.derivatives.get(t);I()&&F(o),I()&&F(o.isFinite()),t.viewCoordinates.add(o)}),this.fixFaceCoordinates()}fixFaceCoordinates(){this.faces.forEach(e=>{e.viewCoordinates.set(Se(e.halfEdges.map(t=>t.start.viewCoordinates)))})}getDebugNode(){const e=new k;return this.edges.forEach(t=>{const o=t.start.viewCoordinates,r=t.end.viewCoordinates;let a,s;const i=this.edgeStateMap.get(t);i===le.WHITE?(a=h.blackLineColorProperty,s=.02):i===le.BLACK?(a=ur(Math.random()*360,.7,.55),s=.1):(a=null,s=.02),e.addChild(new st(o,r,{stroke:a,lineWidth:s,lineCap:"round"}))}),this.faces.forEach(t=>{const o=this.faceValueMap.get(t)??null;o!==null&&e.addChild(new q(o,{maxWidth:.9,maxHeight:.9,center:t.viewCoordinates,fill:h.faceValueColorProperty}))}),e}}const ns=u=>({board:u.board,stateProperty:new pt(u.state)});class rs extends k{constructor(e,t){const o=new k;let r=null;const a=()=>{const i=e.puzzle.board,g=e.puzzle.stateProperty.value;if(g.getSimpleRegions().some(c=>c.isSolved))return;const l=new os(i,g);l.simplify();const d=()=>G.getAngularDeltas(l,.2).plus(G.getHookesAttraction(l,1,.1)).plus(G.getRegularPolygonDeltas(l,1,!0,.2));let C=.3;for(let c=0;c<40;c++){c%10===0&&(C*=.95);let p=d();{let y=p.getMaxMagnitude(),P=C;C*y>1.5&&(P=1.5/y),p=p.timesScalar(P)}if(l.applyDerivative(p),p.getMaxMagnitude()<.015)break}const b=l.getCompletePuzzle();r&&r.dispose();const S=new me(ns(b),{edgePressListener:(c,p)=>{const y=c.originalEdges;y&&e.onUserEdgePress(y.values().next().value,p)},facePressListener:(c,p)=>{if(c===null)e.onUserFacePress(null,p);else{const y=c.originalFace;y&&e.onUserFacePress(y,p)}}});this.puzzleNode=S,r=S;const w=new k({children:[S]}),E=600;w.scale(Math.min(E/w.width,E/w.height)),w.left=20,w.top=130,o.children=[w]},s=()=>{o.children=[],a()};e.puzzle.stateProperty.link(s);super(X({children:[o]},t));x(this,"puzzleNode");this.puzzleModel=e,this.disposeEmitter.addListener(()=>e.puzzle.stateProperty.unlink(s)),this.disposeEmitter.addListener(()=>o.dispose()),this.disposeEmitter.addListener(()=>r&&r.dispose())}}class $t extends mo(k){constructor(e,t=ft,o){const r=j()({topological:!1},o);super(r);x(this,"backgroundRect");x(this,"facePressRect");x(this,"rectangularGradientRect");x(this,"circularGradientRect");x(this,"puzzleWrapper");x(this,"puzzleNode",null);x(this,"zoomListener");this.puzzleModelProperty=e,this.style=t,this.backgroundRect=new R({fill:t.theme.playAreaBackgroundColorProperty,pickable:!0}),this.facePressRect=new R({fill:null,pickableProperty:$o}),_o(this.facePressRect,s=>{var i;(i=e.value)==null||i.onUserFacePress(null,s)},s=>{var i;(i=this.puzzleNode)==null||i.puzzleNode.onFaceBackgroundDragStart(s)}),this.rectangularGradientRect=new R({pickable:!1}),this.circularGradientRect=new R({pickable:!1}),this.puzzleWrapper=new k({children:[this.backgroundRect,this.facePressRect,this.rectangularGradientRect,this.circularGradientRect]}),this.zoomListener=new Co(this.puzzleWrapper,{maxScale:10}),this.addInputListener(this.zoomListener),this.addChild(this.puzzleWrapper);const a=this.updateLayout.bind(this);this.localPreferredWidthProperty.lazyLink(a),this.localPreferredHeightProperty.lazyLink(a),r.topological&&this.puzzleWrapper.localBoundsProperty.lazyLink(a),Ge.multilink([e,wt],(s,i)=>{this.puzzleNode&&(this.puzzleNode.dispose(),this.puzzleNode=null),s&&(r.topological?i&&(this.puzzleNode=new rs(s)):this.puzzleNode=new ts(s,{focusNodeCallback:g=>{this.zoomListener.panToNode(g,!0)}}),this.puzzleNode&&(this.updatePuzzleNodeLayout(this.puzzleNode),this.puzzleWrapper.children=[this.backgroundRect,this.facePressRect,this.rectangularGradientRect,this.circularGradientRect,this.puzzleNode])),this.zoomListener.resetTransform(),this.updateLayout()})}step(e){this.zoomListener.step(2*e)}updateLayout(){const e=this.localPreferredWidth,t=this.localPreferredHeight;if(e!==null&&(this.backgroundRect.rectWidth=e,this.facePressRect.rectWidth=e,this.rectangularGradientRect.rectWidth=e,this.circularGradientRect.rectWidth=e),t!==null&&(this.backgroundRect.rectHeight=t,this.facePressRect.rectHeight=t,this.rectangularGradientRect.rectHeight=t,this.circularGradientRect.rectHeight=t),this.puzzleNode&&this.updatePuzzleNodeLayout(this.puzzleNode),e!==null&&t!==null&&e>0&&t>0){const o=new Ue(0,0,e,t),r=o.center,a=r.getMagnitude();this.rectangularGradientRect.fill=new Po(0,0,0,t).addColorStop(0,this.style.theme.playAreaLinearTopColorProperty).addColorStop(.5,this.style.theme.playAreaLinearMiddleColorProperty).addColorStop(1,this.style.theme.playAreaLinearBottomColorProperty),this.circularGradientRect.fill=new vo(r.x,r.y,a,r.x,r.y,0).addColorStop(0,this.style.theme.playAreaRadialOutsideColorProperty).addColorStop(1,this.style.theme.playAreaRadialInsideColorProperty),this.clipArea=O.bounds(o),this.zoomListener.setTargetBounds(o),this.zoomListener.setPanBounds(o)}else{const o=new Ue(0,0,5,5);this.zoomListener.setTargetBounds(o),this.zoomListener.setPanBounds(o)}}updatePuzzleNodeLayout(e){const t=this.localPreferredWidth,o=this.localPreferredHeight;if(t!==null&&o!==null&&t>0&&o>0){const a=t-40,s=o-20*2;if(e.localBounds.isValid()){const i=e.localBounds.width,g=e.localBounds.height,l=Math.min(a/i,s/g);e.setScaleMagnitude(l),e.center=new te(t/2,o/2)}}}}class ss{constructor(n,e,t){this.layoutBoundsProperty=n,this.glassPane=e,this.stepEmitter=t}}const _t=new k,ze=new k;self.assertions;const as=new k({renderer:"svg",children:[ze]}),ke=new So(as,{allowWebGL:!0,allowBackingScaleAntialiasing:!0,allowSceneOverflow:!1,accessibility:!0,backgroundColor:"#eee",assumeFullWindow:!0,listenToOnlyElement:Xe.debugColors});document.body.appendChild(ke.domElement);ke.setPointerAreaDisplayVisible(Xe.showPointerAreas);self.oncontextmenu=u=>u.preventDefault();const yt=new pt(new Ue(0,0,self.innerWidth,self.innerHeight)),Z=new pe(yr()),eo=new $t(Z,ft,{layoutOptions:{stretch:!0,grow:1}}),to=new $t(Z,ft,{layoutOptions:{stretch:!0,grow:1},topological:!0,visibleProperty:wt}),is=new we(Z,{derive:u=>u?u.hintStateProperty:new pe(de.DEFAULT)});Ge.multilink([h.navbarBackgroundColorProperty],u=>{ke.backgroundColor=u});const oo=new Ie,Je=new ss(yt,_t,oo),no=new jr(Z,Je,{loadPuzzle:u=>{const n=ut(u.board,u.stateProperty.value);n&&(Z.value=new Rt(n))}}),ls=new Ye(Je),cs=new Be(Je),ro=new _r(Je,is,()=>{var u;(u=Z.value)==null||u.onUserApplyHint()},()=>{var u;(u=Z.value)==null||u.onUserClearHint()}),Pe=new T({stretch:!0,children:[new De(no,{margin:be}),new A({grow:1,stretch:!0,layoutOptions:{grow:1},children:[eo,to]}),new De(cs,{margin:be,visibleProperty:Yt}),new De(ls,{margin:be})]});yt.lazyLink(u=>{Pe.preferredWidth=u.width,Pe.preferredHeight=u.height,Pe.x=u.left,Pe.y=u.top});ze.addChild(Pe);ze.addChild(ro);ze.addChild(_t);bo.create(ze,[no,ro],(u,n)=>{n.centerTop=u.centerBottom.plusXY(0,5)});ke.initializeEvents();let mt=!0;const so=()=>{mt=!1;const u=new Ue(0,0,self.innerWidth,self.innerHeight);ke.setWidthHeight(u.width,u.height),yt.value=u,Vo.mobileSafari&&self.scrollTo(0,0)},Ke=()=>{mt=!0};$(self).resize(Ke);self.addEventListener("resize",Ke);self.addEventListener("orientationchange",Ke);self.visualViewport&&self.visualViewport.addEventListener("resize",Ke);so();ke.updateOnRequestAnimationFrame(u=>{var n;Mn(),mt&&so(),Pe.validateBounds(),eo.step(u),to.step(u),(n=Z.value)==null||n.step(u),oo.emit(u)});document.addEventListener("keydown",u=>{var n,e,t,o;if(u.ctrlKey||u.metaKey)u.key==="z"&&(u.shiftKey?(n=Z.value)==null||n.onUserRedo():(e=Z.value)==null||e.onUserUndo()),u.key==="y"&&((t=Z.value)==null||t.onUserRedo());else if(["1","2","3","4","5","6","7","8","9"].includes(u.key)){const r=Number.parseInt(u.key,10)-1,a=Y.enumeration.values.filter(s=>s.isEnabledProperty.value);r<a.length&&en(a[r])}else u.key==="Escape"&&((o=Z.value)==null||o.onUserEscape())});We.keydownEmitter.addListener(u=>{u.key==="e"&&(gt.value=!0)});We.keyupEmitter.addListener(u=>{u.key==="e"&&(gt.value=!1)});let Ot=!1;We.keyDownStateChangedEmitter.addListener(()=>{const u=We.isEnglishKeyDown("space");u!==Ot&&(Ot=u,Ce.value=Ce.value===ie.PAN_ONLY?ie.DRAG_ONLY:ie.PAN_ONLY)});Z.lazyLink((u,n)=>{n&&n.dispose()});
