import{B as c}from"./BinaryRuleCollection-BStHuDJq.js";import{a as u,b as f}from"./compression-CFlaLHJe.js";import{_ as h}from"./getCoordinateClusteredMap-Bd_wM-c0.js";class o{constructor(e,t){this.collection=e,this.mixedData=t}get size(){return this.collection.size}getRule(e){return this.collection.getRule(e,this.isRuleIndexHighlander(e))}isRuleIndexHighlander(e){return(this.mixedData[Math.floor(e/8)]&1<<e%8)!==0}withOnlyHighlander(){return this.filterIndex(e=>this.isRuleIndexHighlander(e))}withoutHighlander(){return this.filterIndex(e=>!this.isRuleIndexHighlander(e))}withPatternBoardFilter(e){return this.filterIndex(t=>e(this.getRule(t).patternBoard))}withRuleIndices(e){const t=c.empty(),l=new Uint8Array(this.mixedData.length);let n=0;const a=(r,s,i)=>{t.addRuleSuffixBytes(r,s,i),i&&(l[Math.floor(n/8)]|=1<<n%8),n++};for(let r=0;r<e.length;r++){const s=e[r],i=this.collection.getRulePatternBoard(s),d=this.collection.getRuleBytes(s,!1);a(i,d,this.isRuleIndexHighlander(s))}return new o(t,l)}filterIndex(e){return this.withRuleIndices(h.range(0,this.size).filter(e))}sortedIndex(e){return this.withRuleIndices(h.sortBy(h.range(0,this.size),t=>e(t)))}sortedDefault(){return this.sortedIndex(e=>this.getRule(e).getInputDifficultyScoreB())}serialize(){return{collection:this.collection.serialize(),mixedData:u(this.mixedData)}}static deserialize(e){const t=f(e.mixedData);if(t)return new o(c.deserialize(e.collection),t);throw new Error("could not read mixedData")}static fromCollections(e,t){const l=(e?e.size:0)+(t?t.size:0),n=c.empty(),a=new Uint8Array(Math.ceil(l/8));let r=0;const s=(i,d)=>{n.addRule(i),d&&(a[Math.floor(r/8)]|=1<<r%8),r++};return e&&e.forEachRule(i=>s(i,!1)),t&&t.forEachRule(i=>s(i,!0)),new o(n,a)}}export{o as B};
