import{o as Q,f as O}from"./Vector2Property-mpypjo8N.js";import{N as F,V as x,A as f,H as m,T as v,D as G}from"./PhetioControlledVisibilityProperty-C-W8fgEx.js";import{I as K,F as z,a as N,B as U,R as X,P as _}from"./PatternRule-DfusC3Hu.js";import{l as $,Q as J}from"./Theme-33Og6UOJ.js";import{g as Y,e as Z,E as ee}from"./DisplayEmbedding-DZ7C0buz.js";import{D as M,g as D}from"./getBestDisplayEmbeddingForRule-DoeVyJAj.js";import{P as R}from"./PatternNode-DQk07OF_.js";import{P as te}from"./PatternRuleNode-C-ABfIxn.js";import{p as ae,d as P,e as W,_ as ne}from"./patternBoards-59tNjMFd.js";import{P as ie}from"./localStorage-B8VWGy9j.js";import{B as se,R as re}from"./RichSolution-B4E0SsJh.js";import{H as T}from"./GenericRichSolution-DIWo2GuT.js";import{P as A}from"./PatternBoardSolver-By-2anvW.js";import"./BasicPuzzle-D1EmEwC1.js";import"./SATSolver-I2LwIpNX.js";import"./SpinningIndicatorNode-BFgzh9_P.js";const B=.5,oe=Y($),le=Z(J);class de extends F{constructor(t,I){const h=Q()({layoutWidth:1e3},I),c=new x({x:10,y:10,align:"left"}),V=d=>{c.addChild(new f(d,{margin:5}))},i=t.patternBoard,p=ae.get(i);P()&&W(p);const g=(d,u=20)=>{c.addChild(new f(new v(d,{font:"bold 20px Arial",fill:"#ccc",tagName:"h1"}),{topMargin:u}))};g(`Generic Rule${t.highlander?" (Highlander)":""}`,0),V(new te(t,p,{scale:1.5}));{const d=A.getSolutions(i,t.inputFeatureSet.getFeaturesArray()),u=n=>{const s=z.empty(i);return t.inputFeatureSet.getFeaturesArray().forEach(a=>{a instanceof N&&s.addFeature(a)}),i.edges.forEach(a=>{a.isExit||(n.includes(a)?s.addBlackEdge(a):s.addRedEdge(a))}),s};if(t.highlander){const n=new se(i,{solveEdges:!0,solveSectors:!1,solveFaceColors:!1}),a=A.getSolutions(i,t.inputFeatureSet.getHighlanderFeaturesArray()).map(e=>new re(i,n,e,!0)),l=T.filterWithFeatureSet(a,t.inputFeatureSet).filter(e=>e.isCompatibleWithFeatureSet(t.inputFeatureSet)),C=d.slice();l.forEach(e=>{const r=C.find(o=>o.length===e.solution.length&&o.every(L=>e.solutionSet.has(L)));P()&&W(r),O(C,r)});const w=new Map;a.forEach(e=>{const r=T.getHighlanderKeyWithFeatureSet(e,t.inputFeatureSet);w.has(r)?w.get(r).push(e):w.set(r,[e])});const H=ne.sortBy([...w.values()],e=>-e.length),j=H.filter(e=>e.length>1),q=H.filter(e=>e.length===1).map(e=>e[0]),k=[];q.forEach(e=>{const r=t.inputFeatureSet.clone();try{e.solution.forEach(o=>{r.addBlackEdge(o)}),i.edges.forEach(o=>{e.solutionSet.has(o)||r.addRedEdge(o)}),k.push(e)}catch(o){if(!(o instanceof K))throw o}}),g("Valid Solutions"),c.addChild(new f(new m({spacing:5,wrap:!0,justify:"left",lineSpacing:30,preferredWidth:h.layoutWidth,children:[...k.map(e=>new R(i,u(e.solution),p,{scale:B}))]}),{margin:5})),g("Highlander Duplicates (Invalid)"),c.addChild(new f(new m({spacing:40,wrap:!0,justify:"left",lineSpacing:30,preferredWidth:h.layoutWidth,children:j.map(e=>new m({spacing:5,children:[...e.map(r=>new R(i,u(r.solution),p,{scale:B}))]}))}),{margin:5}))}else{const s=A.getSolutions(i,t.inputFeatureSet.getFeaturesArray()).map(l=>z.fromSolution(i,l)),a=[],b=[];for(const l of s)t.outputFeatureSet.isCompatibleWith(l)?a.push(l):b.push(l);P()&&W(b.length===0),g("Valid Solutions"),c.addChild(new f(new m({spacing:5,wrap:!0,justify:"left",lineSpacing:30,preferredWidth:h.layoutWidth,children:[...a.map(l=>new R(i,l,p,{scale:B}))]}),{margin:5}))}}{const d=(n,s,a)=>new x({spacing:10,children:[new v(n,{font:"16px Arial",fill:"#ccc"}),new ee(t,s,{cursor:"pointer",scale:30,style:a})]}),u=M.enumeration.values.map(n=>{const s=D(t,n);return s?d(n.displayName,s,le):null}).filter(n=>!!n);{const n=D(t,M.SQUARE);n&&t.inputFeatureSet.getFeaturesArray().every(a=>a instanceof N||a instanceof U||a instanceof X)&&u.unshift(d("Classic Square",n,oe))}g("Example Embeddings"),c.addChild(new F({layoutOptions:{topMargin:20},children:[new m({spacing:30,align:"top",wrap:!0,justify:"left",lineSpacing:30,preferredWidth:h.layoutWidth,children:u})]}))}h.children=[new ie(c,{fill:"#333",stroke:null})],super(h),this.rule=t}}self.assertions.enableAssert();const ce=QueryStringMachine.getAll({r:{type:"string",defaultValue:"square-1-0/AQcODxARIib/ExkbIRwe/w=="}}),S=new F,ue=new F({renderer:"svg",children:[S]}),y=new G(ue,{allowWebGL:!0,allowBackingScaleAntialiasing:!0,allowSceneOverflow:!1});document.body.appendChild(y.domElement);y.setWidthHeight(self.innerWidth,self.innerHeight);console.log("test");(async()=>{const E=_.fromBinaryIdentifier(ce.r);if(console.log(E.serialize()),S.addChild(new de(E,{left:10,top:10})),S.bounds.isValid()){y.setWidthHeight(Math.ceil(S.right+10),Math.ceil(S.bottom+10)),y.updateDisplay();const t=new self.XMLSerializer().serializeToString(y.getRootBackbone().blocks[0].domElement);console.log(t)}})();
