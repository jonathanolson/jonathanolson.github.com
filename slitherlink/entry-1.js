var Ho=Object.defineProperty;var Vo=(i,n,e)=>n in i?Ho(i,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[n]=e;var L=(i,n,e)=>Vo(i,typeof n!="symbol"?n+"":n,e);import{c as J,o as re,D as Nt,T as we,M as ot,E as Do,a as qo,b as Me,P as Mt,V as le,d as ke,e as dt,S as Uo,f as V,B as nt}from"./chunk-16.js";import{S as st,s as Wo}from"./chunk-32.js";import{S as T,P as U,N as I,R as D,A as et,T as Y,s as Zt,H as R,a as Le,b as uo,V as H,G as Jt,B as Ht,c as Kt,M as at,d as xt,I as jt,e as Qt,f as Go,L as $t,g as Xo,h as Ne,i as Yo,j as Zo,k as Jo,l as Ko,m as jo,n as Qo,D as $o,o as _o,p as rt}from"./chunk-17.js";import{P as Ve,C as en,T as tt,O as tn,R as on,V as nn,M as rn,a as he,B as Ae,b as sn}from"./chunk-18.js";import{B as an,a as ln,b as cn,c as dn,d as k,e as N,_ as ve,P as un,g as ze,f as pn,h as Bt,i as hn,j as ut,k as gn}from"./chunk-20.js";import{L as po,c as h,t as fn,u as _,r as Pe,a as Te,b as ce,d as _t,e as wn,p as mn,f as eo,g as yn,h as Cn,s as pt,i as Sn,j as vn,v as to,k as Pn,m as bn,w as En,n as oo,o as Fn,q as Ln,x as kn,y as In,z as Nn,A as xn,B as Bn,C as On,D as An,E as zn,F as Tn,G as Rn,H as Mn,I as Hn,J as Vn,K as Dn,M as qn,N as ht,O as Un,P as Wn,Q as Gn,R as gt}from"./chunk-22.js";import{f as ho,U as M,p as go,h as fo,i as wo,j as mo,k as yo,l as Co,s as me,m as So,v as Ot,n as At,o as vo,V as Xn,F as Yn,q as Zn,r as Jn,t as Kn,u as jn,w as Qn,x as $n,y as _n,z as er,A as tr,B as or,C as nr,D as rr,G as sr,H as ar,I as ir,J as lr,K as cr,L as dr,M as ur,N as pr,O as hr,Q as gr,R as fr,S as wr,T as mr,W as ft,X as yr,Y as Cr,Z as Sr,_ as vr,$ as zt,a0 as Pr,a1 as br,a2 as wt,a3 as Po,a4 as bo,a5 as Tt,a6 as Er,a7 as mt,a8 as Fr,a9 as Lr,aa as He,P as xe,ab as kr,ac as K,ad as Vt,ae as Be,af as fe,ag as Ir,ah as be,ai as Nr,aj as xr,ak as Br,al as Dt,am as Or}from"./chunk-24.js";import{g as Rt,I as pe,a as Ge,i as yt,C as Ct,S as St,b as vt,c as Pt}from"./chunk-29.js";import{B as Fe,E as ne,a as Ar,S as Xe,F as zr,b as Tr,A as Rr,C as Mr,h as Hr,s as bt,c as Et,d as Eo}from"./chunk-28.js";import{p as Fo,d as Vr,a as no}from"./chunk-21.js";import{A as Dr,w as qr}from"./chunk-33.js";import{g as Ft,a as ro,b as Ur,U as Wr}from"./chunk-34.js";import{N as Ye,S as Gr}from"./chunk-30.js";import{p as Ze}from"./chunk-27.js";import{B as Je,R as Lt,b as Ke,c as je,d as Qe,S as $e,e as kt,a as It}from"./chunk-19.js";import"./chunk-26.js";import"./chunk-35.js";import"./chunk-36.js";import"./chunk-37.js";const qt=new po("showLayoutTestProperty",!1);class _e extends an{constructor(n,e,t){super(n,e,t)}}class so extends ln{constructor(e,t){super(e,t);L(this,"originalEdges",new Set)}}class ao extends cn{constructor(e,t){super(e.copy(),t.copy());L(this,"originalFace",null)}}class Xr extends dn{constructor(n,e){super(n.copy(),e.copy())}}class io{constructor(n,e){this.faces=n,this.boundaryHalfEdges=e}}class Yr{constructor(n,e,t){this.faces=n,this.boundaryHalfEdges=e,this.boundarySegments=t}}const Zr=()=>{const i=st.p||localStorage.getItem("puzzleString"),n=Fe.loadDefaultPuzzle();let e=null,t=0;try{let o=n;if(i){const r=Fo(i);if(r){o=r;const a=localStorage.getItem("timeElapsedProperty");t=a?JSON.parse(a):0}}e=Rt(o.board,o.stateProperty.value)}catch(o){console.error(o)}return e||(e=Rt(n.board,n.stateProperty.value)),k()&&N(e),new ho(e,{initialTimeElapsed:t})},Jr=new T("M1024 640q0 106 -75 181t-181 75t-181 -75t-75 -181t75 -181t181 -75t181 75t75 181zM1536 749v-222q0 -12 -8 -23t-20 -13l-185 -28q-19 -54 -39 -91q35 -50 107 -138q10 -12 10 -25t-9 -23q-27 -37 -99 -108t-94 -71q-12 0 -26 9l-138 108q-44 -23 -91 -38q-16 -136 -29 -186q-7 -28 -36 -28h-222q-14 0 -24.5 8.5t-11.5 21.5l-28 184q-49 16 -90 37l-141 -107q-10 -9 -25 -9q-14 0 -25 11q-126 114 -165 168q-7 10 -7 23q0 12 8 23q15 21 51 66.5t54 70.5q-27 50 -41 99l-183 27q-13 2 -21 12.5t-8 23.5v222q0 12 8 23t19 13l186 28q14 46 39 92q-40 57 -107 138q-10 12 -10 24q0 10 9 23q26 36 98.5 107.5t94.5 71.5q13 0 26 -10l138 -107q44 23 91 38q16 136 29 186q7 28 36 28h222q14 0 24.5 -8.5t11.5 -21.5l28 -184q49 -16 90 -37l142 107q9 9 24 9q13 0 25 -10q129 -119 165 -170q7 -8 7 -22q0 -12 -8 -23q-15 -21 -51 -66.5t-54 -70.5q26 -50 41 -98l183 -28q13 -2 21 -12.5t8 -23.5z").makeImmutable(),Kr=new T("M979 1395q19 19 32 13t13 -32v-1472q0 -26 -13 -32t-32 13l-710 710q-9 9 -13 19v-678q0 -26 -19 -45t-45 -19h-128q-26 0 -45 19t-19 45v1408q0 26 19 45t45 19h128q26 0 45 -19t19 -45v-678q4 10 13 19z").makeImmutable(),jr=new T("M45 -115q-19 -19 -32 -13t-13 32v1472q0 26 13 32t32 -13l710 -710q9 -9 13 -19v678q0 26 19 45t45 19h128q26 0 45 -19t19 -45v-1408q0 -26 -19 -45t-45 -19h-128q-26 0 -45 19t-19 45v678q-4 -10 -13 -19z").makeImmutable(),Qr=new T("M1619 1395q19 19 32 13t13 -32v-1472q0 -26 -13 -32t-32 13l-710 710q-9 9 -13 19v-710q0 -26 -13 -32t-32 13l-710 710q-19 19 -19 45t19 45l710 710q19 19 32 13t13 -32v-710q4 10 13 19z").makeImmutable(),$r=new T("M45 -115q-19 -19 -32 -13t-13 32v1472q0 26 13 32t32 -13l710 -710q9 -9 13 -19v710q0 26 13 32t32 -13l710 -710q19 -19 19 -45t-19 -45l-710 -710q-19 -19 -32 -13t-13 32v710q-4 -10 -13 -19z").makeImmutable();new T("M503.691 189.836L327.687 37.851C312.281 24.546 288 35.347 288 56.015v80.053C127.371 137.907 0 170.1 0 322.326c0 61.441 39.581 122.309 83.333 154.132 13.653 9.931 33.111-2.533 28.077-18.631C66.066 312.814 132.917 274.316 288 272.085V360c0 20.7 24.3 31.453 39.687 18.164l176.004-152c11.071-9.562 11.086-26.753 0-36.328z").makeImmutable();const Lo=new T("M363 0l91 91l-235 235l-91 -91v-107h128v-128h107zM886 928q0 22 -22 22q-10 0 -17 -7l-542 -542q-7 -7 -7 -17q0 -22 22 -22q10 0 17 7l542 542q7 7 7 17zM832 1120l416 -416l-832 -832h-416v416zM1515 1024q0 -53 -37 -90l-166 -166l-416 416l166 165q36 38 90 38q53 0 91 -38l235 -234q37 -39 37 -91z").makeImmutable(),_r=new T("M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 448c-110.532 0-200-89.431-200-200 0-110.495 89.472-200 200-200 110.491 0 200 89.471 200 200 0 110.53-89.431 200-200 200zm107.244-255.2c0 67.052-72.421 68.084-72.421 92.863V300c0 6.627-5.373 12-12 12h-45.647c-6.627 0-12-5.373-12-12v-8.659c0-35.745 27.1-50.034 47.579-61.516 17.561-9.845 28.324-16.541 28.324-29.579 0-17.246-21.999-28.693-39.784-28.693-23.189 0-33.894 10.977-48.942 29.969-4.057 5.12-11.46 6.071-16.666 2.124l-27.824-21.098c-5.107-3.872-6.251-11.066-2.644-16.363C184.846 131.491 214.94 112 261.794 112c49.071 0 101.45 38.304 101.45 88.8zM298 368c0 23.159-18.841 42-42 42s-42-18.841-42-42 18.841-42 42-42 42 18.841 42 42z").makeImmutable(),es=new T("M352.201 425.775l-79.196 79.196c-9.373 9.373-24.568 9.373-33.941 0l-79.196-79.196c-15.119-15.119-4.411-40.971 16.971-40.97h51.162L228 284H127.196v51.162c0 21.382-25.851 32.09-40.971 16.971L7.029 272.937c-9.373-9.373-9.373-24.569 0-33.941L86.225 159.8c15.119-15.119 40.971-4.411 40.971 16.971V228H228V127.196h-51.23c-21.382 0-32.09-25.851-16.971-40.971l79.196-79.196c9.373-9.373 24.568-9.373 33.941 0l79.196 79.196c15.119 15.119 4.411 40.971-16.971 40.971h-51.162V228h100.804v-51.162c0-21.382 25.851-32.09 40.97-16.971l79.196 79.196c9.373 9.373 9.373 24.569 0 33.941L425.773 352.2c-15.119 15.119-40.971 4.411-40.97-16.971V284H284v100.804h51.23c21.382 0 32.09 25.851 16.971 40.971z").makeImmutable(),ge=(i,n)=>new U(i,J({maxWidth:20,maxHeight:20,fill:"black"},n));class De extends I{constructor(n,e,t){const o=re()({allowBarrierClickToHide:!0,panelOptions:{xMargin:15,yMargin:15,fill:h.uiBackgroundColorProperty,stroke:h.uiForegroundColorProperty}},t);super(),this.content=n,this.viewContext=e;const r=new D({fill:h.barrierColorProperty});this.addChild(r),e.layoutBoundsProperty.link(s=>{r.rectBounds=s}),o.allowBarrierClickToHide&&r.addInputListener({down:()=>{this.hide()}});const a=new Ve(n,o.panelOptions);e.layoutBoundsProperty.link(s=>{a.maxWidth=s.width*.9,a.maxHeight=s.height*.9}),this.addChild(new et(a,{alignBoundsProperty:e.layoutBoundsProperty,yAlign:"top",topMargin:50}))}show(){this.viewContext.glassPane.hasChild(this)||(this.reset(),this.viewContext.glassPane.addChild(this))}hide(){this.viewContext.glassPane.hasChild(this)&&this.viewContext.glassPane.removeChild(this)}reset(){}}class qe{constructor(n,e){L(this,"timerListener",null);L(this,"tooltipNode",null);this.viewContext=n,this.tooltipTextOverride=e}showTooltip(n,e,t){if(!this.tooltipNode){this.tooltipNode=new Ve(new Y(n,{font:fn}),{cornerRadius:1,xMargin:2,yMargin:2});const o=this.viewContext.glassPane.globalToLocalPoint(t.point);this.tooltipNode.leftTop=o.plusXY(0,this.viewContext.glassPane.getUniqueTransform().transformDeltaY(20)),this.tooltipNode.bottom>this.viewContext.layoutBoundsProperty.value.bottom&&(this.tooltipNode.bottom=o.y-2),this.tooltipNode.left<this.viewContext.layoutBoundsProperty.value.left&&(this.tooltipNode.left=this.viewContext.layoutBoundsProperty.value.left+2),this.tooltipNode.right>this.viewContext.layoutBoundsProperty.value.right&&(this.tooltipNode.right=this.viewContext.layoutBoundsProperty.value.right-2),this.viewContext.glassPane.addChild(this.tooltipNode)}}hideTooltip(){this.tooltipNode&&(this.tooltipNode.dispose(),this.tooltipNode=null)}clearListener(){this.timerListener&&(Zt.clearTimeout(this.timerListener),this.timerListener=null)}enter(n){const e=n.currentTarget,t=n.pointer;if(e&&this.timerListener===null){const o=()=>{const r=this.tooltipTextOverride??(e==null?void 0:e.labelContent)??(e==null?void 0:e.accessibleName);if(r){this.showTooltip(r,e,t);let a=this.tooltipNode;const s=()=>{this.tooltipNode===a&&(this.hideTooltip(),o())};e.rendererSummaryRefreshEmitter.addListener(s),a.disposeEmitter.addListener(()=>{e.rendererSummaryRefreshEmitter.removeListener(s)})}};this.timerListener=Zt.setTimeout(()=>{o()},200)}}exit(n){this.clearListener(),this.hideTooltip()}dispose(){this.clearListener(),this.hideTooltip()}}class x extends en{constructor(n,e,t){const o=re()({advanced:!1,accessibleName:n,checkboxColor:h.uiForegroundColorProperty,checkboxColorBackground:h.uiBackgroundColorProperty},t),r=new Y(n,{font:_,fill:h.uiForegroundColorProperty});o.advanced&&(o.visibleProperty=j),o.boxWidth=r.height,super(e,r,o)}}class ue extends tt{constructor(n,e){const t=re()({advanced:!1,textFill:h.uiButtonForegroundProperty,baseColor:h.uiButtonBaseColorProperty,xMargin:5,yMargin:5,font:_,buttonAppearanceStrategy:Pe},e);t.advanced&&(t.visibleProperty=j),super(n,t)}}class ts extends R{constructor(n,e,t,o){const r=re()({advanced:!1,onOffSwitchOptions:{size:new Nt(40,20),trackFillLeft:h.uiButtonDisabledColorProperty,trackFillRight:h.uiButtonBaseColorProperty,accessibleName:e},spacing:10},o),a=new tn(n,r.onOffSwitchOptions);r.children=[t,a],r.advanced&&(r.visibleProperty=j),super(r)}}class X extends ts{constructor(n,e,t){const o=re()({textOptions:{}},t),r=new M(e,o.textOptions);super(n,e,r,o)}}class ko extends on{constructor(n,e,t){super(n,e,J({orientation:"horizontal",touchAreaYDilation:5,radioButtonOptions:{baseColor:h.uiButtonBaseColorProperty,disabledColor:h.uiButtonDisabledColorProperty,xMargin:8*1.3,yMargin:5*1.3,buttonAppearanceStrategyOptions:{selectedStroke:h.uiButtonSelectedStrokeColorProperty,deselectedStroke:h.uiButtonDeselectedStrokeColorProperty}}},t))}}class Ue extends ko{constructor(n){const{basicLinesIcon:e,basicFaceColoringIcon:t,pureFaceColoringIcon:o,classicIcon:r,basicSectorsIcon:a,sectorsWithColorsIcon:s,vertexStateIcon:l,faceStateIcon:p,customIcon:c}=Ue.getIcons(),u=new qe(n);super(go,[{value:fo,createNode:()=>r,labelContent:"Classic",options:{}},{value:wo,createNode:()=>e,labelContent:"Lines",options:{}},{value:mo,createNode:()=>t,labelContent:"Lines and Colors",options:{}},{value:yo,createNode:()=>o,labelContent:"Colors",options:{}},{value:Co,createNode:()=>a,labelContent:"Sectors",options:{visibleProperty:me}},{value:So,createNode:()=>s,labelContent:"Sectors and Colors",options:{visibleProperty:me}},{value:Ot,createNode:()=>l,labelContent:"Vertex State",options:{visibleProperty:j}},{value:At,createNode:()=>p,labelContent:"Face State",options:{visibleProperty:j}},{value:vo,createNode:()=>c,labelContent:"Custom",options:{visibleProperty:j}}]),this.children.forEach(C=>C.addInputListener(u)),n.layoutBoundsProperty.link(C=>{this.maxWidth=Math.max(1,C.width-2*Te)})}static getIcons(){const n=new D(0,0,15,15,{stroke:h.whiteLineColorProperty,fill:h.faceColorDefaultColorProperty}),e=new D(0,0,15,15,{stroke:h.whiteLineColorProperty,fill:new Le([h.faceColorBasicTargetColorProperty],b=>b.withAlpha(1))}),t=new U(new T().moveTo(0,15).lineTo(0,0).lineTo(15,0).makeImmutable(),{stroke:new Le([h.simpleRegionTargetColorProperty],b=>b.withAlpha(1)),lineWidth:4,lineCap:"round",lineJoin:"round"}),o=new U(new T().moveTo(0,15).lineTo(0,0).lineTo(15,0).makeImmutable(),{stroke:h.blackLineColorProperty,lineWidth:4,lineCap:"round",lineJoin:"round"}),r=new U(new T().arc(0,0,9,0,Math.PI/2,!1),{stroke:h.sectorOnlyOneColorProperty}),a=new I({children:[n,t]}),s=new I({children:[e,o]}),l=new I({children:[new D(0,0,15,15,{fill:h.uiForegroundColorProperty})]}),p=3,c=new T().moveTo(-p,-p).lineTo(p,p).moveTo(-p,p).lineTo(p,-p),u=new I({children:[new D(0,0,15,15,{fill:h.puzzleBackgroundColorProperty}),new U(new T().moveTo(0,15).lineTo(0,0).lineTo(15,0).makeImmutable(),{stroke:h.blackLineColorProperty,lineWidth:3,lineCap:"square",lineJoin:"miter"}),new U(c,{stroke:h.xColorProperty,lineWidth:2,x:15,y:7.5})]}),C=new I({children:[n,r,t]}),S=new I({children:[e,r,o]}),E=Fo("eJytV11v2jAU/S9+9oOvv4PUh7VQqS+dNtZK08RDVlwUjQIiKWuF8t9nJw2JjWGJygtKfE7OuR/Oxdmjndnm2XqFRoDR73W6naPRHhXvG4NG6DrNzXW1hh2vyJ5Mjka/9ugNjQhG79Xvrr7ZubsSdzCoMYhh1MPAw5in6WO8xmhMU3iY/5ysMRZ7TnmY/5z24qQelnhx+hgQL5gABM8xAP3SMB/0axOAfnECUHierJxh9JxG+9k2mmDAFLPZhxJEKIA5Fpg2FBqhcCyxwqKhsAiFWRuNk4bCIxRqbWxVdcMREY6wPra4QBqSjJAS62SLDIe0VISknZctKBwy07HkSWVnA+Oz0hJRXqSF6bxAN+uXzdIUZpwWKaoL/pguX+v7lnbrrXcb464csW1Q61Lt1A5BhAQWEFRIoAFBHyu4rMx8YaZuIQh7Ytc/InYUF3FVhMwl/d0s7FgJnpiGkM+uFDD6a7LtfNJRdCHerJfrbaRu7TpGT+66Llxm5xiTIhESGNdaccnZB2Fa54a+PvyY3o0nnXpb7/Vms86zwhyk76yQ1QBOOFeESZ0w5cqWRdYDg7v7nvphoI0+EEEJIcIaJIoyCPQf7seTG+swRvF3uTzlt3pdLhsPRmXCtdAEEkpUfw8Y4KEp1ZpwpaWQjBHR14MOyQMEkTQhYK2EpL092AAPxaRilJKEckbFUb9PevAhHoqDtG2XTNreJ737IYb0I1ECqOBCJMDtzu3rIQd4cHBdUEwntlCgeuehhtTKblhCpSB2byXWp6+H7uNhwWy1S5fZ/ICh0XO6zI2bceap+DAKR1yANNzavL52dDtht8XRaDerubcGZTuMpUv7nABEBOgQARoRYEMEWESADBEQEQHVEeD/rUGsimKIgoq1AQbFEGsEkE+nMTAK/vkoookMqibEOmpD60q4v3h3qjJvsRfqMUCCT5H6wVNnJPTty9UVckFGeNDh5Wd4tMNji9M81lNPdPXO8FSHx8/l0U2YniNCX0Xel9jNZVERmwNbrJe33nrfg+6+PThX546XtNhmloh+OkM7pvMvq/dmNgdHWjgr5gZ9R6/VKravR1L0clLsclL8clJHHxCeFOutIy8X0tEniydFe+scfdmcTO1PbE/NyrL8B0eOKVk=");k()&&N(E);const m=new Xn(E.board.vertices[5],E.stateProperty,{...Ot,allVertexStateVisibleProperty:new we(!0)}),F=new I({children:[m],scale:60}),y=new Yn(E.board.faces[5],E.stateProperty,At),d=new I({children:[y],scale:30}),v=ge(Lo,{fill:h.uiForegroundColorProperty,matrix:new ot().rowMajor(.75,0,0,0,-.75,0,0,0,1)}),g=new uo;return{basicLinesIcon:g.createBox(a),basicFaceColoringIcon:g.createBox(s),pureFaceColoringIcon:g.createBox(l),classicIcon:g.createBox(u),basicSectorsIcon:g.createBox(C),sectorsWithColorsIcon:g.createBox(S),vertexStateIcon:g.createBox(F),faceStateIcon:g.createBox(d),customIcon:g.createBox(v)}}}const ie=(i,n,e,t)=>{const o=new nn(n,e,{spacing:8,radioButtonOptions:{selectedColor:h.uiButtonBaseColorProperty,deselectedColor:h.uiBackgroundColorProperty,stroke:h.uiForegroundColorProperty}}),r=re()({stretch:!0,align:"left",spacing:10,children:[new Y(i,{font:ce,fill:h.uiForegroundColorProperty}),o]},t);return new H(r)},j=new po("advancedSettingsVisibleProperty",!1);class os extends De{constructor(n){const e=new qe(n),t=new H({stretch:!0,align:"left",spacing:8,children:[new Y("Solve After Every Move",{font:ce,fill:h.uiForegroundColorProperty}),new Jt({xAlign:"left",yAlign:"top",xSpacing:20,ySpacing:8,columns:[[new x("Vertex Joint X",Zn),new x("Vertex Forced Line",Jn),new x("Vertex Forced X",Kn),new x("Completed Face X",jn),new x("Completed Face Lines",Qn),new x("Simple Loop X",$n),new x("Simple Loop Lines",_n),new x("Double Minus One Faces",er),new x("1/N-1 Sectors",tr),new x("Simple Sectors",or),new x("Vertex X",nr),new x("Vertex Lines",rr),new x("Vertex Sectors",sr),new x("Vertex Faces",ar)],[new x("Color X",ir),new x("Color Lines",lr),new x("Color Parity X",cr),new x("Color Parity Lines",dr),new x("Color Parity Colors",ur),new x("Color Parity Partial",pr),new x("Vertex/Color To Face",hr),new x("Face X",gr),new x("Face Lines",fr),new x("Face Sectors",wr),new x("Face Color",mr)]]})]}),o=ie("Theme",wn,_t.map(d=>({value:d,createNode:()=>new Y(d.name,{font:_,fill:h.uiForegroundColorProperty}),a11yName:d.name}))),r=new H({spacing:15,stretch:!0,visible:st.debugColors,children:_t.filter(d=>d.isEditable).map(d=>new ue(`Edit ${d.name} Theme`,{listener:()=>{mn(d)}}))}),a=new H({stretch:!0,align:"left",spacing:8,children:[new Y("Puzzle Display",{font:ce,fill:h.uiForegroundColorProperty}),new Jt({xAlign:"left",yAlign:"top",xSpacing:20,ySpacing:8,columns:[[new x("Lines Visible",eo),new x("Color Lines",yn,{enabledProperty:eo,layoutOptions:{leftMargin:20}}),new x("Face Colors Visible",Cn),new x("Sectors Visible",pt),new x("Sectors Next to Edges",Sn,{advanced:!0,enabledProperty:pt,layoutOptions:{leftMargin:20}}),new x("Trivial Sectors",vn,{advanced:!0,enabledProperty:pt,layoutOptions:{leftMargin:20}}),new x("Vertex State",to),new x("All Vertex State",Pn,{advanced:!0,enabledProperty:to,layoutOptions:{leftMargin:20}}),new x("Face State",bn,{advanced:!0})],[new x("Possible Line Visible",En),new x("Impossible Line Visible",oo),new x("Vertices Visible",Fn),new x("Vertices Small",Ln),new x("Red X Visible",kn),new x("Red X Aligned",In)]]}),new R({spacing:20,visibleProperty:j,children:[ie("Line Join",xn,Nn.map(d=>({value:d,createNode:()=>new Y(d,{font:_,fill:h.uiForegroundColorProperty}),labelContent:d}))),ie("Line Cap",On,Bn.map(d=>({value:d,createNode:()=>new Y(d,{font:_,fill:h.uiForegroundColorProperty}),labelContent:d}))),ie("Vertex Style",zn,An.map(d=>({value:d,createNode:()=>new Y(d,{font:_,fill:h.uiForegroundColorProperty}),labelContent:d}))),ie("Impossible Line Style",Rn,Tn.map(d=>({value:d,createNode:()=>new Y(d,{font:_,fill:h.uiForegroundColorProperty}),labelContent:d}))),ie("Face Value Style",Hn,Mn.map(d=>({value:d,createNode:()=>new Y(d,{font:_,fill:h.uiForegroundColorProperty}),labelContent:d})))]})]}),s=ie("Face Color Threshold",Vn,[{value:1,createNode:()=>new M("Show All"),labelContent:"Show All"},{value:2,createNode:()=>new M("2+"),labelContent:"2+"},{value:3,createNode:()=>new M("3+"),labelContent:"3+"},{value:5,createNode:()=>new M("5+"),labelContent:"5+"},{value:10,createNode:()=>new M("10+"),labelContent:"10+"},{value:Number.POSITIVE_INFINITY,createNode:()=>new M("Only Outside"),labelContent:"Only Outside"}]),l=new H({spacing:8,align:"left",stretch:!0,children:[new X(ft,"Auto-Solve"),new X(yr,"Add Lines",{layoutOptions:{leftMargin:20},enabledProperty:ft}),new X(Cr,"Simple Loops",{layoutOptions:{leftMargin:20},enabledProperty:ft}),new M("Highlights"),new X(Sr,"Dim Completed Numbers",{layoutOptions:{leftMargin:20}}),new X(vr,"Highlight Incorrect Numbers",{layoutOptions:{leftMargin:20}}),new X(zt,"Highlight Incorrect Moves",{layoutOptions:{leftMargin:20}}),new X(Pr,"Highlight Intersecting Lines",{layoutOptions:{leftMargin:20}}),new X(new rn(br,{bidirectional:!0,map:d=>d===wt.CYCLIC,inverseMap:d=>d?wt.CYCLIC:wt.TOGGLE}),"Cycle Between States"),new X(Po,"Show View Style Controls"),new X(oo,"Show Impossible Lines"),new X(bo,"Show Elapsed Time"),new X(me,"Enable Sector View Styles"),new X(Tt,"Show Undo-All / Redo-All",{advanced:!0}),new X(qt,"Show Layout Test",{advanced:!0}),new X(Er,"Solve Uses Built-In",{advanced:!0})]}),p=new Ht(!1),c=Le.and([j,p]),u=Ue.getIcons(),C=(d,v)=>new R({spacing:5,children:[new M(v),d]}),S=ie("View Style",go,[{value:fo,createNode:()=>C(u.classicIcon,"Classic"),labelContent:"Classic"},{value:wo,createNode:()=>C(u.basicLinesIcon,"Lines"),labelContent:"Lines"},{value:mo,createNode:()=>C(u.basicFaceColoringIcon,"Lines and Colors"),labelContent:"Lines and Colors"},{value:yo,createNode:()=>C(u.pureFaceColoringIcon,"Colors"),labelContent:"Colors"},{value:Co,createNode:()=>C(u.basicSectorsIcon,"Sectors"),labelContent:"Sectors",options:{visibleProperty:me}},{value:So,createNode:()=>C(u.sectorsWithColorsIcon,"Sectors and Colors"),labelContent:"Sectors and Colors",options:{visibleProperty:me}},{value:Ot,createNode:()=>C(u.vertexStateIcon,"Vertex State"),labelContent:"Vertex State",options:{visibleProperty:j}},{value:At,createNode:()=>C(u.faceStateIcon,"Face State"),labelContent:"Face State",options:{visibleProperty:j}},{value:vo,createNode:()=>C(u.customIcon,"Custom"),labelContent:"Custom",options:{visibleProperty:j}}]),E=new X(p,"Show Custom Options",{advanced:!0}),m=new H({spacing:20,align:"left",children:[new R({spacing:20,children:[t,s]}),a],visibleProperty:c}),F=new ue("Reload to Defaults",{accessibleName:"Clear all settings/data, and reload the page",listener:()=>{localStorage.clear(),self.location.reload()},advanced:!0});F.addInputListener(e);const y=new I;super(new H({spacing:20,align:"left",stretch:!0,children:[l,y,new R({align:"top",spacing:30,children:[S,o,r]}),E,m,F,new X(j,"Show Advanced Settings")]}),n)}}const ns=(i,n)=>{const e=new Set(i.faces.filter(a=>{const s=n.getFaceValue(a);return s!==null&&s!==0}));if(e.size===0)return 0;const t=new Set,o=new Set([[...e][0]]);let r=0;for(;o.size;){r+=1;const a=[...o];o.clear();for(const s of a)t.add(s);for(const s of a)for(const l of s.vertices)for(const p of l.faces)t.has(p)||o.add(p)}return r};class rs{constructor(n,e){L(this,"faceValues",[]);L(this,"faceColors",[]);L(this,"oppositeFaceColors",[]);L(this,"redEdgeValues",[]);L(this,"blackEdgeValues",[]);L(this,"sectorNotZeroValues",[]);L(this,"sectorNotOneValues",[]);L(this,"sectorNotTwoValues",[]);L(this,"sectorOnlyOneValues",[]);this.boardPatternBoard=n,this.inputData=e;for(const t of n.faces){const o=n.getFace(t);o?this.faceValues.push(e.getFaceValue(o)):this.faceValues.push(null);const r=o?e.getFaceColor(o):e.getOutsideColor(),a=e.getOppositeFaceColor(r);this.faceColors.push(r),this.oppositeFaceColors.push(a)}for(const t of n.edges){const o=n.getEdge(t);k()&&N(o);const r=e.getEdgeState(o);this.redEdgeValues.push(r===ne.RED),this.blackEdgeValues.push(r===ne.BLACK)}for(const t of n.sectors){const o=n.getSector(t);k()&&N(o);const r=e.getSectorState(o);this.sectorNotZeroValues.push(!r.zero),this.sectorNotOneValues.push(!r.one),this.sectorNotTwoValues.push(!r.two),this.sectorOnlyOneValues.push(!r.zero&&r.one&&!r.two)}}}const ss=(i,n,e,t,o)=>{const r=e.inputFeatureSet.getFeaturesArray(),a=e.outputFeatureSet.getFeaturesArray(),s=[],l=new Set,p=new Set,c=new Set;for(const w of a)if(w instanceof Je||w instanceof Lt){const q=w instanceof Je,A=i.getEdge(w.edge),ae=n.getEdgeState(A);if(ae===ne.WHITE)s.push(new Ar(A,q?ne.BLACK:ne.RED)),l.add(A);else if(ae===ne.BLACK!==q)throw new pe("Edge is not in the correct state")}else if(w instanceof Ke||w instanceof je||w instanceof Qe||w instanceof $e){const q=i.getSector(w.sector),A=n.getSectorState(q);if(w instanceof Ke){if(A.zero){if(!A.one&&!A.two)throw new pe("Sector cannot be made impossible");s.push(new Xe(q,A.withDisallowZero())),p.add(q)}}else if(w instanceof je){if(A.one){if(!A.zero&&!A.two)throw new pe("Sector cannot be made impossible");s.push(new Xe(q,A.withDisallowOne())),p.add(q)}}else if(w instanceof Qe){if(A.two){if(!A.zero&&!A.one)throw new pe("Sector cannot be made impossible");s.push(new Xe(q,A.withDisallowTwo())),p.add(q)}}else if(w instanceof $e&&(A.zero||A.two)){if(!A.one)throw new pe("Sector cannot be made impossible");s.push(new Xe(q,A.withDisallowZero().withDisallowTwo())),p.add(q)}}else if(w instanceof kt){const q=G=>ve.uniq(G.map(ye=>{const Ce=i.getFace(ye);return Ce?n.getFaceColor(Ce):n.getOutsideColor()})),A=q(w.primaryFaces),ae=q(w.secondaryFaces),Mo=A.map(G=>n.getOppositeFaceColor(G)),Gt=ae.map(G=>n.getOppositeFaceColor(G));for(const G of A){if(ae.includes(G))throw new pe("Cannot make primary and secondary colors the same");if(Mo.includes(G))throw new pe("Cannot make primary and opposite colors the same")}for(const G of ae)if(Gt.includes(G))throw new pe("Cannot make secondary and opposite colors the same");const Xt=(G,ye)=>{[...w.allFaces].forEach(Ce=>{const Se=i.getFace(Ce),Yt=Se?n.getFaceColor(Se):n.getOutsideColor();Se&&(Yt===G||Yt===ye)&&c.add(Se)})};for(const G of[A,ae])if(G.length>1)for(let ye=1;ye<G.length;ye++){const Ce=G[0],Se=G[ye];s.push(new zr(Ge(n,Ce),Ge(n,Se))),Xt(Ce,Se)}ae.length&&A[0]!==Gt[0]&&(s.push(new Tr(Ge(n,A[0]),Ge(n,ae[0]))),Xt(A[0],ae[0]))}else k()&&N(w instanceof It);const u=r.filter(w=>w instanceof It).map(w=>({face:i.getFace(w.face),value:w.value})),C=a.filter(w=>w instanceof It).map(w=>({face:i.getFace(w.face),value:w.value})),S=r.filter(w=>w instanceof Je).map(w=>i.getEdge(w.edge)),E=a.filter(w=>w instanceof Je).map(w=>i.getEdge(w.edge)),m=r.filter(w=>w instanceof Lt).map(w=>i.getEdge(w.edge)),F=a.filter(w=>w instanceof Lt).map(w=>i.getEdge(w.edge)),y=r.filter(w=>w instanceof Ke).map(w=>i.getSector(w.sector)),d=a.filter(w=>w instanceof Ke).map(w=>i.getSector(w.sector)),v=r.filter(w=>w instanceof je).map(w=>i.getSector(w.sector)),g=a.filter(w=>w instanceof je).map(w=>i.getSector(w.sector)),b=r.filter(w=>w instanceof Qe).map(w=>i.getSector(w.sector)),B=a.filter(w=>w instanceof Qe).map(w=>i.getSector(w.sector)),O=r.filter(w=>w instanceof $e).map(w=>i.getSector(w.sector)),f=a.filter(w=>w instanceof $e).map(w=>i.getSector(w.sector)),P=r.filter(w=>w instanceof kt),se=a.filter(w=>w instanceof kt),te=w=>({primaryFaces:w.primaryFaces.map(q=>i.getFace(q)),secondaryFaces:w.secondaryFaces.map(q=>i.getFace(q))}),Q=P.map(te),W=se.map(te);return new Rr(new Mr(s),{type:"Pattern",rule:t,embedding:o,boardPatternBoard:i,input:{faceValues:u,blackEdges:S,redEdges:m,sectorsNotZero:y,sectorsNotOne:v,sectorsNotTwo:b,sectorsOnlyOne:O,faceColorDuals:Q},output:{faceValues:C,blackEdges:E,redEdges:F,sectorsNotZero:d,sectorsNotOne:g,sectorsNotTwo:B,sectorsOnlyOne:f,faceColorDuals:W},affectedEdges:l,affectedSectors:p,affectedFaces:c},i.board)};class de{constructor(n,e,t,o,r=0,a=0){L(this,"nextRuleIndex");L(this,"nextEmbeddingIndex");L(this,"dirtyListener");L(this,"quickSpanningCount");this.board=n,this.boardPatternBoard=e,this.state=t,this.binaryData=o,this.quickSpanningCount=ns(n,t),this.nextRuleIndex=r,this.nextEmbeddingIndex=a,this.dirtyListener=()=>{this.nextRuleIndex=0,this.nextEmbeddingIndex=0},this.state.faceValueChangedEmitter.addListener(this.dirtyListener),this.state.edgeStateChangedEmitter.addListener(this.dirtyListener),this.state.sectorStateChangedEmitter.addListener(this.dirtyListener),this.state.faceColorsChangedEmitter.addListener(this.dirtyListener)}get dirty(){return this.nextRuleIndex<this.binaryData.size}nextAction(){if(!this.dirty)return null;const n=new rs(this.boardPatternBoard,this.state);for(;;){const e=this.binaryData.getNext(n.boardPatternBoard,n,this.nextRuleIndex,this.nextEmbeddingIndex);if(e){if(this.nextRuleIndex=e.ruleIndex,this.nextEmbeddingIndex=e.embeddingIndex+1,e.rule.patternBoard.faces.length>=this.quickSpanningCount){const t=e.rule.patternBoard.faces.map(r=>e.embedding.mapFace(r)),o=new Set(t.map(r=>this.boardPatternBoard.getFace(r)).filter(r=>r!==null));if(!Hr(this.board,this.state,o))continue}return ss(this.boardPatternBoard,this.state,e.embeddedRule,e.rule,e.embedding)}else return this.nextRuleIndex=this.binaryData.size,this.nextEmbeddingIndex=0,null}}clone(n){return new de(this.board,this.boardPatternBoard,n,this.binaryData,this.nextRuleIndex)}dispose(){this.state.faceValueChangedEmitter.removeListener(this.dirtyListener),this.state.edgeStateChangedEmitter.removeListener(this.dirtyListener),this.state.sectorStateChangedEmitter.removeListener(this.dirtyListener),this.state.faceColorsChangedEmitter.removeListener(this.dirtyListener)}static fromGroup(n,e,t,o,r=o.size){return k()&&N(r<=o.size),new de(n,e,t,{size:r,getNext:(a,s,l=0,p=0)=>o.collection.findNextActionableEmbeddedRuleFromData(a,s,l,p,c=>o.isRuleIndexHighlander(c),r)})}}const oe=class oe extends Do{constructor(n){super(),this.canSolve=n}};L(oe,"EASY",new oe((n,e)=>(e=e.clone(),yt((t,o,r)=>{const a=Et.get(t);return new Ct([new St(t,o),new vt(t,o),new Pt(t,o),new mt(t,o,{solveToRed:!0,solveToBlack:!0,resolveAllRegions:!1}),de.fromGroup(t,a,o,Ft,120)])},n,e,!0),bt(e)))),L(oe,"MEDIUM",new oe((n,e)=>(e=e.clone(),yt((t,o,r)=>{const a=Et.get(t);return new Ct([new St(t,o),new vt(t,o),new Pt(t,o),new mt(t,o,{solveToRed:!0,solveToBlack:!0,resolveAllRegions:!1}),de.fromGroup(t,a,o,ro,50),de.fromGroup(t,a,o,Ft,360)])},n,e,!0),bt(e)))),L(oe,"HARD",new oe((n,e)=>(e=e.clone(),yt((t,o,r)=>{const a=Et.get(t);return new Ct([new St(t,o),new vt(t,o),new Pt(t,o),new mt(t,o,{solveToRed:!0,solveToBlack:!0,resolveAllRegions:!1}),Fr(t,o),de.fromGroup(t,a,o,Ur,600),de.fromGroup(t,a,o,ro,100),de.fromGroup(t,a,o,Ft,1e3)])},n,e,!0),bt(e)))),L(oe,"NO_LIMIT",new oe(()=>!0)),L(oe,"enumeration",new qo(oe));let Ee=oe;const lo=new Dn("canSolveDifficulty",Ee.EASY);function as(i){return new Worker(""+new URL("assets/generationAdditiveConstrainedWorker-CXogskEC.js",import.meta.url).href,{name:i==null?void 0:i.name})}const is=i=>{const n=Vr(i.board),e=no(n,i.cleanState),t=no(n,i.solvedState),o=new Set(i.blackEdges.map(r=>n.edges[r]));return{board:n,cleanState:e,solvedState:t,blackEdges:o}};let Ie=null;const ls=new we(!1),Io=()=>(Ie||(Ie=new as,Ie==null||Ie.addEventListener("message",i=>{i.data.type==="generation-additive-constrained-worker-loaded"&&(ls.value=!0)})),Ie);Io();const cs=async(i,n,e,t,o,r)=>new Promise((a,s)=>{const l=Io(),p=Math.random();l.postMessage({type:"generation-additive-constrained-request",id:p,board:Lr(i),canSolveDifficulty:n.name});const c=()=>{e.unlink(u),l.removeEventListener("message",C)},u=S=>{S&&(l.postMessage({type:"generation-additive-constrained-interrupt",id:p}),c(),a(null))},C=S=>{if(S.data.id===p)if(S.data.type==="generation-additive-constrained-response"){const E=S.data.solvedPuzzle?is(S.data.solvedPuzzle):null;c(),a(E)}else S.data.type==="generation-additive-constrained-face-define"?t.emit(S.data.index,S.data.faceValue):S.data.type==="generation-additive-constrained-face-minimize"?o.emit(S.data.index,S.data.faceValue):S.data.type==="generation-additive-constrained-face-reset"&&r.emit()};e.lazyLink(u),l.addEventListener("message",C)});class ds extends R{constructor(n,e){const t=new qn("polygonGeneratorProperty",{serialize:y=>y.name,deserialize:y=>Ze.find(d=>d.name===y)??Ze[0]}),o=localStorage.getItem("polygonGeneratorParameters")?JSON.parse(localStorage.getItem("polygonGeneratorParameters")):null;let r=!1;const a=ie("Patterns",t,Ze.map(y=>({value:y,createNode:()=>new Y(y.name,{font:_,fill:h.uiForegroundColorProperty}),labelContent:y.name})),{layoutOptions:{align:"top",grow:0},justify:"top"}),s=new R({spacing:10,align:"center",layoutOptions:{grow:0},grow:1}),l=new R({spacing:10,align:"center",layoutOptions:{grow:0},children:[new M("Difficulty"),new Wr(lo,[{value:Ee.EASY,createNode:()=>new M("Easy"),labelContent:"Easy"},{value:Ee.MEDIUM,createNode:()=>new M("Medium"),labelContent:"Medium"},{value:Ee.HARD,createNode:()=>new M("Hard"),labelContent:"Hard"},{value:Ee.NO_LIMIT,createNode:()=>new M("No Limit"),labelContent:"No Limit"}],{orientation:"horizontal",align:"center",spacing:30})]}),p=new R({spacing:10,align:"center",justify:"spaceEvenly",layoutOptions:{grow:0}}),c=new I,u=new I,C=new Me;C.addListener(()=>{u.children=[]});const S=new I({children:[c,u]}),E=(y,d)=>{const v=y.generate(d),g=new T;v.forEach(b=>g.polygon(b)),c.children=[new U(g,{fill:h.puzzleBackgroundColorProperty,stroke:h.blackLineColorProperty,lineWidth:.05})],C.emit()};E(Ze[0],{width:5,height:5}),t.link(y=>{p.children.forEach(b=>b.dispose()),s.children.forEach(b=>b.dispose());const d={},v=b=>o&&!r&&b in o?o[b]:y.defaultParameterValues[b],g=()=>{localStorage.setItem("polygonGeneratorParameters",JSON.stringify(d)),E(y,d)};for(const[b,B]of Object.entries(y.parameters))if(B.type==="integer"){const O=new Kt(v(b));O.link(f=>{d[b]=f,g()}),p.addChild(new Ye(B.label,O,B.range,{layoutFunction:Ye.createLayoutFunction4(),titleNodeOptions:{font:_,fill:h.uiForegroundColorProperty},sliderOptions:{trackSize:new Nt(100,5),labelTagName:"label",keyboardStep:1,labelContent:B.label},arrowButtonOptions:{touchAreaXDilation:5,touchAreaYDilation:25},numberDisplayOptions:{decimalPlaces:0},delta:1,visibleProperty:B.advanced?j:null}))}else if(B.type==="float"){const O=new Kt(v(b));O.link(f=>{d[b]=f,g()}),p.addChild(new Ye(B.label,O,B.range,{layoutFunction:Ye.createLayoutFunction4(),titleNodeOptions:{font:_,fill:h.uiForegroundColorProperty},sliderOptions:{trackSize:new Nt(100,5),labelTagName:"label",keyboardStep:.1,labelContent:B.label},numberDisplayOptions:{decimalPlaces:2},delta:.01,visibleProperty:B.advanced?j:null}))}else if(B.type==="boolean"){const O=new Ht(v(b));O.link(f=>{d[b]=f,g()}),p.addChild(new x(B.label,O,{advanced:B.advanced}))}else if(B.type==="choice"){const O=new Mt(v(b));O.link(f=>{d[b]=f,g()}),p.addChild(ie(B.label,O,B.choices.map(f=>({value:f.value,createNode:()=>new Y(f.label,{font:_,fill:h.uiForegroundColorProperty}),labelContent:f.label}))))}r=!0,s.addChild(new ue("Generate",{font:ht,layoutOptions:{align:"center"},listener:async()=>{C.emit();const b=y.generate(d),B=un.get(y,d),O=new we(!1),f=()=>{O.value=!0};C.addListener(f);const P=new Me,se=new Me,te=new Me;te.addListener(()=>{u.children=[]}),P.addListener((W,w)=>{u.addChild(new U(T.polygon(b[W]),{fill:h.generateAddedFaceColorProperty,stroke:h.blackLineColorProperty,lineWidth:.05})),w!==null&&u.addChild(new Y(`${w}`,{font:ht,fill:h.faceValueColorProperty,maxWidth:.9,maxHeight:.9,center:ze(b[W])}))}),se.addListener((W,w)=>{u.addChild(new U(T.polygon(b[W]),{fill:h.generateMinimizedFaceColorProperty,stroke:h.blackLineColorProperty,lineWidth:.05})),w!==null&&u.addChild(new Y(`${w}`,{font:ht,fill:h.faceValueColorProperty,maxWidth:.9,maxHeight:.9,center:ze(b[W])}))});const Q=await cs(B,lo.value,O,P,se,te);Q&&(u.children=[],F.loadPuzzle(Fe.fromSolvedPuzzle(Q))),C.hasListener(f)&&C.removeListener(f)}}))});const m=new D({fill:h.playAreaBackgroundColorProperty,sizable:!0,layoutOptions:{grow:1},children:[S]});at.multilink([m.localPreferredWidthProperty,m.localPreferredHeightProperty,S.localBoundsProperty],(y,d,v)=>{if(y!==null&&d!==null&&v.isFinite()){const b=y-30,B=d-2*15,O=Math.min(b/v.width,B/v.height);O>0&&(S.setScaleMagnitude(O),S.centerX=y/2,S.centerY=d/2)}});const F=re()({spacing:10,stretch:!0,children:[a,new H({spacing:10,stretch:!0,layoutOptions:{grow:1},children:[m,s,new xt,l,new xt,p]})]},e);super(F)}}const us="#444",ps="#fa0",hs="#888",gs="#fff",fs="#f00",ws="#ff0",ms="#ff0",ys="#0f0",Cs="#0ff",Ss="#0af",vs="#f0f";class Ps extends De{constructor(e){const t=new R({children:[new Y("Loading image...",{font:_,fill:h.uiForegroundColorProperty})]}),o=new I({children:[t]});super(o,e);L(this,"scanContentNode");L(this,"imageContainer");L(this,"solutionContainer");L(this,"blackImageLayer");L(this,"originalImageLayer");L(this,"thresholdImageLayer");L(this,"contourLayer");L(this,"puzzle",null);L(this,"rootContour",null);L(this,"contours",[]);L(this,"contourNodeMap",new Map);this.scanContentNode=o,this.blackImageLayer=new I,this.originalImageLayer=new I({visible:!1}),this.thresholdImageLayer=new I({visible:!1}),this.contourLayer=new I,this.imageContainer=new I({children:[this.blackImageLayer,this.originalImageLayer,this.thresholdImageLayer,this.contourLayer]}),this.solutionContainer=new I}getScanOptions(){return{originalImageCallback:e=>this.onOriginalImage(e),thresholdedImageCallback:e=>this.onThresholdedImage(e),rootContourCallback:e=>this.onRootContour(e),widestSubtreeCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeWidestContour()},dotContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeDotContour()},lineContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeLineContour()},zeroOuterContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeZeroOuterContour()},zeroInnerContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeZeroInnerContour()},oneContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeOneContour()},twoContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeTwoContour()},threeContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeThreeContour()},xContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeXContour()},unknownContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeUnknownContour()},debugImageCallback:e=>{},puzzleCallback:e=>this.onPuzzle(e),solutionsCallback:e=>this.onSolutions(e)}}onOriginalImage(e){this.originalImageLayer.addChild(new jt(e)),this.blackImageLayer.addChild(D.bounds(this.originalImageLayer.bounds,{fill:"black"})),this.scanContentNode.children=[new H({spacing:10,children:[this.imageContainer,this.solutionContainer]})]}onThresholdedImage(e){this.thresholdImageLayer.addChild(new jt(e))}onRootContour(e){this.rootContour=e,this.contours=e.getDescendantContours();for(const t of this.contours){const o=new bs(t);this.contourNodeMap.set(t,o),this.contourLayer.addChild(o)}}onPuzzle(e){this.puzzle=e}onSolutions(e){if(e.length===1)this.hide();else{const t=this.puzzle;k()&&N(t);const o=t.board;if(e.length===0){He(o,t.stateProperty.value);const r=new xe(t,{scale:20});this.solutionContainer.children=[new H({spacing:10,children:[new M("No Solutions Found"),r]})]}else{const r=new Fe(o,t.stateProperty.value.clone()),a=new Fe(o,t.stateProperty.value.clone()),s=new Fe(o,t.stateProperty.value.clone());e[0].forEach(u=>r.stateProperty.value.setEdgeState(u,ne.BLACK)),e[1].forEach(u=>a.stateProperty.value.setEdgeState(u,ne.BLACK)),o.edges.forEach(u=>{r.stateProperty.value.getEdgeState(u)!==a.stateProperty.value.getEdgeState(u)&&s.stateProperty.value.setEdgeState(u,ne.BLACK)}),He(o,r.stateProperty.value),He(o,a.stateProperty.value),He(o,s.stateProperty.value);const l=new xe(r,{scale:10}),p=new xe(a,{scale:10}),c=new xe(s,{scale:10});this.solutionContainer.children=[new H({spacing:10,children:[new M("Multiple Solutions Found"),new R({spacing:10,children:[new H({spacing:10,children:[l,new M("Solution A")]}),new H({spacing:10,children:[p,new M("Solution B")]}),new H({spacing:10,children:[c,new M("Difference")]})]})]})]}}}}class bs extends I{constructor(e){const t=new U(e.shape,{stroke:us});super({children:[t]});L(this,"path");this.contour=e,this.path=t}makeWidestContour(){this.path.stroke=ps}makeDotContour(){this.path.stroke=hs}makeLineContour(){this.path.stroke=gs}makeXContour(){this.path.stroke=fs}makeZeroOuterContour(){this.path.stroke=ws}makeZeroInnerContour(){this.path.stroke=ms}makeOneContour(){this.path.stroke=ys}makeTwoContour(){this.path.stroke=Cs}makeThreeContour(){this.path.stroke=Ss}makeUnknownContour(){this.path.stroke=vs}}class Es extends De{constructor(n,e){super(new H({spacing:20,align:"left",stretch:!0,children:[new I({children:[new ds(n,{loadPuzzle:t=>{this.hide(),e.loadPuzzle(t)},preferredWidth:700,preferredHeight:300})]}),new xt,new R({spacing:15,grow:1,children:[new ue("Load String",{listener:()=>{this.hide();const t=prompt("Enter puzzle string");t&&e.loadPuzzle(Fe.loadDeprecatedScalaString(t))}}),new ue("Load Image (Rectangular Only)",{listener:()=>{this.hide();const t=document.createElement("input");t.type="file",t.onchange=o=>{const r=o.target.files[0];var a=new FileReader;a.readAsDataURL(r),a.onloadend=async()=>{const s=a.result,l=new Ps(n);l.show();const p=await Wo(s,l.getScanOptions());e.loadPuzzle(p)}},t.click()}})]})]}),n)}}class Fs extends he{constructor(n){const e=re()({advanced:!1,baseColor:h.uiButtonBaseColorProperty,xMargin:5,yMargin:5,buttonAppearanceStrategy:Pe},n);e.advanced&&(e.visibleProperty=j),super(e)}}class Ls{constructor(n,e,t,o){L(this,"maxLineWidth");L(this,"disposeFlatAppearanceStrategy");const r=new Qt(t,{luminanceFactor:-.3}),a=new Qt(t,{luminanceFactor:-.6}),s=r,l=a,p=J({stroke:a},o),c=1.5;n.stroke=p.stroke||a,n.lineWidth=c,this.maxLineWidth=1.5,n.cachedPaints=[t,s,l];function u(C){let S=1,E=1;switch(C){case Ae.IDLE:n.fill=t,n.stroke=r,S=.3;break;case Ae.OVER:n.fill=t,n.stroke=r,S=.5;break;case Ae.PRESSED:n.fill=t,n.stroke=h.uiButtonSelectedStrokeColorProperty,E=1.5;break;default:throw new Error(`unsupported interactionState: ${C}`)}n.opacity=S,n.lineWidth=E}e.link(u),this.disposeFlatAppearanceStrategy=()=>{e.hasListener(u)&&e.unlink(u),r.dispose(),a.dispose()}}dispose(){this.disposeFlatAppearanceStrategy()}}class ks{constructor(n,e,t){L(this,"dispose");function o(r){let a=1;switch(r){case Ae.IDLE:a=.6;break;case Ae.OVER:break;case Ae.PRESSED:break;default:throw new Error(`unsupported interactionState: ${r}`)}n.opacity=a}e.link(o),this.dispose=()=>{e.hasListener(o)&&e.unlink(o)}}}class it extends R{constructor(n){const e=new qe(n),t=b=>new I({scale:1.3,children:[b]}),{edgeIcon:o,edgeReversedIcon:r,faceColorInsideIcon:a,faceColorOutsideIcon:s,faceColorMatchIcon:l,faceColorOppositeIcon:p,sectorIcon:c,eraserIcon:u,panIcon:C,dragIcon:S}=it.getIcons(),E=new ko(kr,[{value:K.EDGE_STATE,labelContent:"Edge Edit Mode",createNode:()=>t(o),options:{visibleProperty:K.EDGE_STATE.isEnabledProperty}},{value:K.EDGE_STATE_REVERSED,labelContent:"Edge Reversed Edit Mode",createNode:()=>t(r),options:{visibleProperty:K.EDGE_STATE_REVERSED.isEnabledProperty}},{value:K.FACE_COLOR_INSIDE,labelContent:"Face Color Inside Edit Mode",createNode:()=>t(a),options:{visibleProperty:K.FACE_COLOR_INSIDE.isEnabledProperty}},{value:K.FACE_COLOR_OUTSIDE,labelContent:"Face Color Outside Edit Mode",createNode:()=>t(s),options:{visibleProperty:K.FACE_COLOR_OUTSIDE.isEnabledProperty}},{value:K.FACE_COLOR_MATCH,labelContent:"Face Color Match Edit Mode",createNode:()=>t(l),options:{visibleProperty:K.FACE_COLOR_MATCH.isEnabledProperty}},{value:K.FACE_COLOR_OPPOSITE,labelContent:"Face Color Opposite Edit Mode",createNode:()=>t(p),options:{visibleProperty:K.FACE_COLOR_OPPOSITE.isEnabledProperty}},{value:K.SECTOR_STATE,labelContent:"Sector Edit Mode",createNode:()=>t(c),options:{visibleProperty:K.SECTOR_STATE.isEnabledProperty}}],{spacing:15,layoutOptions:{grow:1}});E.children.forEach(b=>b.addInputListener(e));const m={buttonAppearanceStrategy:Pe,baseColor:h.uiButtonBaseColorProperty,disabledColor:h.uiButtonDisabledColorProperty,mouseAreaXDilation:5,mouseAreaYDilation:5,touchAreaXDilation:5,touchAreaYDilation:5},F=new sn(Vt,J({},m,{accessibleName:"Eraser Mode (Toggle)",content:t(u),buttonAppearanceStrategy:Ls,contentAppearanceStrategy:ks}));F.addInputListener(e);const y=t(C),d=t(S),v=new I;Be.link(b=>{v.children=[b===fe.PAN_ONLY?y:d]});const g=new Fs({content:v,listener:()=>{Be.value=Be.value===fe.PAN_ONLY?fe.DRAG_ONLY:fe.PAN_ONLY}});Be.link(b=>{g.accessibleName=b===fe.PAN_ONLY?"Pan Mode (toggle)":"Drag Input Mode (toggle)"}),g.addInputListener(e),super({spacing:13,stretch:!0,children:[E,new Go,F,g]}),n.layoutBoundsProperty.link(b=>{this.maxWidth=Math.max(1,b.width-2*Te)})}static getIcons(){const n=new $t(0,0,15,0,{stroke:h.uiButtonForegroundProperty,lineWidth:4,lineCap:"round"}),e=6,t=new T().moveTo(-e,-e).lineTo(e,e).moveTo(-e,e).lineTo(e,-e),o=new U(t,{stroke:h.uiButtonForegroundProperty,lineWidth:2}),r=new I({children:[new D(0,0,14,14,{stroke:h.uiButtonForegroundProperty,fill:h.uiButtonFaceOutsideColorProperty})]}),a=new I({children:[new D(0,0,14,14,{stroke:h.uiButtonForegroundProperty,fill:h.uiButtonFaceInsideColorProperty})]}),s=new I({children:[new D(0,0,7,7,{stroke:h.uiButtonForegroundProperty,fill:h.uiForegroundColorProperty}),new D(7,7,7,7,{stroke:h.uiButtonForegroundProperty,fill:h.uiForegroundColorProperty})]}),l=new I({children:[new D(0,0,7,7,{stroke:h.uiButtonForegroundProperty,fill:h.uiForegroundColorProperty}),new D(7,7,7,7,{stroke:h.uiButtonForegroundProperty,fill:h.uiBackgroundColorProperty})]}),p=new I({children:[new U(new T().moveTo(0,14).lineTo(0,0).lineTo(14,0),{stroke:h.uiButtonForegroundProperty}),new U(new T().arc(0,0,7,0,Math.PI/2,!1),{stroke:h.uiButtonForegroundProperty})]}),c=17,u=6,C=7,S=2,E=C/Math.sqrt(2),m=new I({children:[new I({rotation:-Math.PI/4,children:[new D(0,0,c,C,{stroke:h.uiButtonForegroundProperty,fill:h.uiButtonInvertedForegroundProperty,cornerRadius:S}),new D(u,0,c-u,C,{fill:h.uiButtonForegroundProperty,cornerRadius:S})]}),new $t(E,E-.5,E+12,E-.5,{stroke:h.uiButtonForegroundProperty,lineDash:[5,1,3,1,2]})]}),F=new U(es.transformed(ot.rotationZ(Math.PI/4)),{fill:h.uiButtonForegroundProperty,maxWidth:14,maxHeight:14}),y=new I({children:[new U(Lo,{fill:h.uiButtonForegroundProperty,matrix:ot.Y_REFLECTION,maxWidth:14,maxHeight:14}),new U(new T().moveTo(0,1.5).lineTo(12,1.5),{stroke:h.uiButtonForegroundProperty,lineDash:[9,1,2]})]}),d=new uo;return{edgeIcon:d.createBox(n),edgeReversedIcon:d.createBox(o),faceColorInsideIcon:d.createBox(a),faceColorOutsideIcon:d.createBox(r),faceColorMatchIcon:d.createBox(s),faceColorOppositeIcon:d.createBox(l),sectorIcon:d.createBox(p),eraserIcon:d.createBox(m),panIcon:d.createBox(F),dragIcon:d.createBox(y)}}}class z extends Xo{constructor(n,e){const t=re()({font:_,fill:h.uiForegroundColorProperty,linkFill:h.uiLinkColorProperty},e);super(n,t)}}class Is extends De{constructor(n){self.phet.chipper.isFuzzEnabled=()=>!1;const e=it.getIcons(),t=Ue.getIcons(),o=a=>new I({children:[D.bounds(a.bounds.dilated(3),{fill:h.uiButtonBaseColorProperty,stroke:h.uiButtonSelectedStrokeColorProperty,cornerRadius:3}),a]}),r=650;super(new H({spacing:10,align:"left",children:[new z("Slitherlink",{font:ce}),new z("Slitherlink is a logic puzzle where you draw a <strong>single continuous loop</strong> on a grid. The goal is to connect dots without crossing or overlapping, creating a loop that adheres to specific rules based on the numbers in some cells.",{lineWrap:r}),new H({spacing:2,align:"left",children:[new z("The loop must satisfy the following rules:"),new z("The loop cannot cross or touch itself.",{layoutOptions:{leftMargin:20}}),new z("Each numbered cell must have exactly that number of sides in the loop.",{layoutOptions:{leftMargin:20}})]}),new z("Solving",{font:ce}),new z('<a href="{{solvingGuide}}">See the Solving Guide</a>',{font:Un,links:{solvingGuide:"./"},layoutOptions:{align:"center"}}),new z("Edit Modes",{font:ce}),new H({spacing:5,align:"left",children:[new z('<node id="edge" align="center"/> + click/tap adds a line, <node id="x" align="center"/> marks where lines are impossible',{lineWrap:r,nodes:{edge:o(e.edgeIcon),x:o(e.edgeReversedIcon)}}),new z('<node id="inside" align="center"/> + click/tap marks with the inside color, <node id="outside" align="center"/> marks with the outside color',{lineWrap:r,nodes:{inside:o(e.faceColorInsideIcon),outside:o(e.faceColorOutsideIcon)}}),new z('<node id="same" align="center"/> + click/tap on 1st cell + click/tap on 2nd to match colors, <node id="opposite" align="center"/> marks opposite colors',{lineWrap:r,nodes:{same:o(e.faceColorMatchIcon),opposite:o(e.faceColorOppositeIcon)}}),new R({spacing:10,children:[o(e.sectorIcon),new z(" + click/tap to pop up a selector, then select the sector color (see solving guide)")],visibleProperty:me})]}),new z("The number keys (1-9) can switch between edit modes. E will activate the eraser when pressed."),new z("The line/X and inside/outside color controls will cycle through the states (e.g. blank => line => X => blank) by default, but can be changed to toggle (e.g. blank => line, line => blank, X => line) in settings.",{lineWrap:r}),new z("Modifiers",{font:ce}),new z(`With erase (<node id="erase" align="center"/>) toggled on, edit modes will instead erase lines/X's/colors.`,{lineWrap:r,nodes:{erase:o(e.eraserIcon)}}),new z('Pan mode (<node id="pan" align="center"/>) will treat dragging as panning the view, while drag-edit mode (<node id="drag" align="center"/>) will allow setting the state of many lines/cells with one dragged press.',{lineWrap:r,nodes:{pan:o(e.panIcon),drag:o(e.dragIcon)}}),new z('Right-click or shift-click will activate the "opposite" mode (e.g. in line mode, shift-click will set an X). This will work for <node id="edge" align="center"/> / <node id="x" align="center"/>, <node id="inside" align="center"/> / <node id="outside" align="center"/>, and the final click for <node id="same" align="center"/> / <node id="opposite" align="center"/>.',{lineWrap:r,nodes:{edge:o(e.edgeIcon),x:o(e.edgeReversedIcon),inside:o(e.faceColorInsideIcon),outside:o(e.faceColorOutsideIcon),same:o(e.faceColorMatchIcon),opposite:o(e.faceColorOppositeIcon)}}),new z("View Styles",{font:ce}),new H({spacing:5,align:"left",children:[new R({spacing:10,children:[o(t.classicIcon),new z("Classic Slitherlink style, just lines/X's.")]}),new R({spacing:10,children:[o(t.basicLinesIcon),new z(`Cleaner lines (missing lines are X's, thin lines are "blank"), inside/outside colors`)]}),new R({spacing:10,children:[o(t.basicFaceColoringIcon),new z("Cleaner with face coloring (lighter/darker color pairs are inside/outside or outside/inside)")]}),new R({spacing:10,children:[o(t.pureFaceColoringIcon),new z("Similar to above, but without showing lines at all")]}),new R({spacing:10,children:[o(t.basicSectorsIcon),new z("Cleaner lines, with sectors (see the solving guide)")],visibleProperty:me}),new R({spacing:10,children:[o(t.sectorsWithColorsIcon),new z("Cleaner lines with colors and sectors (see the solving guide)")],visibleProperty:me})]}),new z("About / Contact",{font:ce}),new z('My name is Jonathan Olson, and I created this Slitherlink interface to explore the limits of solving techniques and to provide a seamless experience on both desktop and mobile. I value your feedback and would love to hear any questions, comments, or suggestions. Please reach out to me at <a href="{{email}}">jonathan.olson@colorado.edu</a>.',{lineWrap:r,links:{email:"mailto:jonathan.olson@colorado.edu"}})]}),n)}}class Ns extends De{constructor(e){const t=new Ht(!1),o=new ue("Copy URL",{accessibleName:"Copy Shareable URL to Clipboard",listener:()=>{if(this.puzzle){const r=location.protocol+"//"+location.host+location.pathname;let a=this.puzzle;this.includeStateProperty.value||(a=new Fe(a.board,Eo.fromFaceValueData(a.board,a.stateProperty.value)));const s=Ir(a);Wn(r+"?p="+encodeURIComponent(s))}}});o.addInputListener(new qe(e));super(new H({spacing:20,align:"left",stretch:!0,children:[o,new x("Include Solve Progress",t)]}),e);L(this,"includeStateProperty");L(this,"puzzle",null);this.includeStateProperty=t}setPuzzle(e){this.puzzle=e}reset(){super.reset(),this.includeStateProperty.reset()}}class xs extends Y{constructor(n,e){const t=re()({font:Gn,fill:h.timerColorProperty},e),o=60,r=60*o,a=24*r,s=new Le([n],l=>{l=Math.ceil(l);const p=Math.floor(l/a);l-=p*a;const c=Math.floor(l/r);l-=c*r;const u=Math.floor(l/o);l-=u*o;const C=l,S=c<10?`0${c}`:`${c}`,E=u<10?`0${u}`:`${u}`,m=C<10?`0${C}`:`${C}`;return p?`${p}d ${S}:${E}:${m}`:c?`${S}:${E}:${m}`:`${E}:${m}`});super(s,t),this.timerProperty=n,this.disposeEmitter.addListener(()=>{s.dispose()})}}class Bs extends R{constructor(n,e,t){const o=new qe(e),r=new T("M37.75,20.25 C38.6681734,20.25 39.4211923,20.9571103 39.4941988,21.8564728 L39.5,22 L39.5,36.25 C39.5,39.3517853 37.0439828,41.879937 33.9705557,41.9958479 L33.75,42 L14.25,42 C11.1482147,42 8.62006299,39.5439828 8.50415208,36.4705557 L8.5,36.25 L8.5,22 C8.5,21.0335017 9.28350169,20.25 10.25,20.25 C11.1681734,20.25 11.9211923,20.9571103 11.9941988,21.8564728 L12,22 L12,36.25 C12,37.440864 12.9251616,38.4156449 14.0959512,38.4948092 L14.25,38.5 L33.75,38.5 C34.940864,38.5 35.9156449,37.5748384 35.9948092,36.4040488 L36,36.25 L36,22 C36,21.0335017 36.7835017,20.25 37.75,20.25 Z M23.4989075,6.26787884 L23.6477793,6.25297693 L23.6477793,6.25297693 L23.8225053,6.25140103 L23.8225053,6.25140103 L23.9770074,6.26441014 L23.9770074,6.26441014 L24.1549097,6.29667263 L24.1549097,6.29667263 L24.223898,6.31492315 L24.223898,6.31492315 C24.4192207,6.36884271 24.6069182,6.4577966 24.7773762,6.58126437 L24.8968901,6.67628678 L24.8968901,6.67628678 L24.989825,6.76256313 L32.7679996,14.5407377 C33.4514171,15.2241552 33.4514171,16.3321939 32.7679996,17.0156115 C32.1247831,17.6588279 31.1054316,17.6966642 30.4179639,17.1291203 L30.2931259,17.0156115 L25.5,12.222 L25.5,31.5 C25.5,32.4181734 24.7928897,33.1711923 23.8935272,33.2441988 L23.75,33.25 C22.8318266,33.25 22.0788077,32.5428897 22.0058012,31.6435272 L22,31.5 L22,12.226 L17.2116504,17.0156115 C16.5684339,17.6588279 15.5490824,17.6966642 14.8616148,17.1291203 L14.7367767,17.0156115 C14.0935602,16.372395 14.055724,15.3530435 14.6232679,14.6655758 L14.7367767,14.5407377 L22.488804,6.78678454 C22.5446792,6.72871358 22.6045271,6.67449255 22.6679103,6.62455868 L22.7812362,6.54379243 L22.7812362,6.54379243 C22.8189499,6.51724 22.858413,6.49312256 22.8988638,6.47056335 L22.9176605,6.46138558 C23.0947495,6.36422067 23.2909216,6.29776289 23.4989075,6.26787884 Z"),a=new we(!1),s=new we(0),l=new we(be.NOT_FOUND),p=new Ne(n,{derive:g=>g?g.undoPossibleProperty:a}),c=new Ne(n,{derive:g=>g?g.redoPossibleProperty:a}),u=new Ne(n,{derive:g=>g?g.isSolvedProperty:a}),C=new Ne(n,{derive:g=>g?g.timeElapsedProperty:s}),S=new Ne(n,{derive:g=>g?g.hintStateProperty:l}),E=new Le([u],g=>!g);let m=null,F=null,y=null,d=null;const v={buttonAppearanceStrategy:Pe,baseColor:h.uiButtonBaseColorProperty,disabledColor:h.uiButtonDisabledColorProperty,xMargin:8*1.3,yMargin:5*1.3,mouseAreaXDilation:5,mouseAreaYDilation:5,touchAreaXDilation:5,touchAreaYDilation:5};super({spacing:10,stretch:!0,children:[new tt("New",J({},v,{accessibleName:"New",listener:()=>{m=m||new Es(e,{loadPuzzle:t.loadPuzzle}),m.show()},textFill:h.uiButtonForegroundProperty,baseColor:h.uiButtonBaseColorProperty,xMargin:5,yMargin:5,font:gt,buttonAppearanceStrategy:Pe})),new he(J({},v,{accessibleName:"Undo All",content:ge(Qr),listener:()=>{n.value&&n.value.onUserUndoAll()},enabledProperty:p,visibleProperty:Tt})),new he(J({},v,{accessibleName:"Undo",content:ge(Kr),listener:()=>{n.value&&n.value.onUserUndo()},enabledProperty:p,fireOnHold:!0})),new xs(C,{visibleProperty:bo}),new he(J({},v,{accessibleName:"Redo",content:ge(jr),listener:()=>{n.value&&n.value.onUserRedo()},enabledProperty:c,fireOnHold:!0})),new he(J({},v,{accessibleName:"Redo All",content:ge($r),listener:()=>{n.value&&n.value.onUserRedoAll()},enabledProperty:c,visibleProperty:Tt})),new he(J({},v,{accessibleName:"Settings",content:ge(Jr),listener:()=>{y=y||new os(e),y.show()}})),new he(J({},v,{accessibleName:"Share",content:ge(r),listener:()=>{const g=n.value;g&&(F=F||new Ns(e),F.setPuzzle(g.puzzle),F.show())}})),new tt("Solve",J({},v,{accessibleName:"Solve",listener:()=>{n.value&&n.value.onUserRequestSolve()},enabledProperty:E,textFill:h.uiButtonForegroundProperty,baseColor:h.uiButtonBaseColorProperty,xMargin:5,yMargin:5,font:gt,buttonAppearanceStrategy:Pe})),new tt("Hint",J({},v,{accessibleName:"Hint",listener:()=>{n.value&&n.value.onUserRequestHint()},enabledProperty:new Le([E,S],(g,b)=>g&&b===be.DEFAULT),textFill:h.uiButtonForegroundProperty,baseColor:h.uiButtonBaseColorProperty,xMargin:5,yMargin:5,font:gt,buttonAppearanceStrategy:Pe})),new he(J({},v,{accessibleName:"Help",content:ge(_r),listener:()=>{d=d||new Is(e),d.show()}}))]}),this.puzzleModelProperty=n,this.children.forEach(g=>g.addInputListener(o)),e.layoutBoundsProperty.link(g=>{this.maxWidth=Math.max(1,g.width-2*Te)})}}const Os=h.uiForegroundColorProperty,As=new Le([h.uiForegroundColorProperty],i=>i.withAlpha(.15));class zs extends I{constructor(n,e,t,o){super({});const r=new Gr({diameter:20,activeColor:Os,inactiveColor:As});this.disposeEmitter.addListener(()=>r.dispose());const a={xMargin:5,yMargin:5,fill:h.uiBackgroundColorProperty,stroke:h.uiForegroundColorProperty},s=new Ve(new R({spacing:10,children:[new I({children:[r]}),new M("Loading Hint Solver...")]}),a),l=new R({spacing:10,children:[new Ve(new R({spacing:10,children:[new I({children:[r]}),new M("Searching for Hint...")]}),a),new ue("Cancel",{listener:o})]}),p=new R({spacing:10,children:[new ue("Apply Hint",{listener:t}),new ue("Hide Hint",{listener:o})]}),c=new Ve(new M("No Hint Found"),a);c.pickable=!1;const u=S=>{this.children=[...S===be.LOADING?[s]:[],...S===be.SEARCHING?[l]:[],...S===be.FOUND?[p]:[],...S===be.NOT_FOUND?[c]:[]]};e.link(u),this.disposeEmitter.addListener(()=>e.unlink(u));const C=S=>{r.step(S)};n.stepEmitter.addListener(C),this.disposeEmitter.addListener(()=>n.stepEmitter.removeListener(C))}}class Ts extends I{constructor(n,e){const t=[],o=[],r=p=>{const c=p.getStrokedShape(new Zo({lineWidth:.3,lineCap:"round",lineJoin:"round"}));t.push(...c.subpaths)},a=p=>{const c=p.getOffsetShape(-.1);o.push(...c.subpaths)},s=p=>{r(new T().moveToPoint(p.start.viewCoordinates).lineToPoint(p.end.viewCoordinates))},l=p=>{p.edges.every(c=>!e.incorrectEdges.has(c))&&a(T.polygon(p.vertices.map(c=>c.viewCoordinates)))};e.incorrectEdges.forEach(s),e.incorrectFaces.forEach(l),super({children:[new U(new T(t),{fill:h.incorrectEdgeColorProperty}),new U(new T(o),{fill:h.incorrectFaceColorProperty})],pickable:!1,filters:[new Yo(.1)]})}}class Rs extends I{constructor(e,t){const o=re()({focusNodeCallback:()=>{}},t),r=new xe(e.puzzle,{edgePressListener:(c,u)=>e.onUserEdgePress(c,u),onEdgeDragStart:(c,u)=>e.onUserEdgeDragStart(c,u),onEdgeDrag:(c,u)=>e.onUserEdgeDrag(c,u),onEdgeDragEnd:()=>e.onUserEdgeDragEnd(),facePressListener:(c,u)=>e.onUserFacePress(c,u),onFaceDragStart:(c,u)=>e.onUserFaceDragStart(c,u),onFaceDrag:(c,u)=>e.onUserFaceDrag(c,u),onFaceDragEnd:()=>e.onUserFaceDragEnd(),sectorPressListener:(c,u)=>e.onUserSectorPress(c,u),sectorSetListener:(c,u)=>e.onUserSectorSet(c,u),selectedFaceColorHighlightProperty:e.selectedFaceColorHighlightProperty,selectedSectorEditProperty:e.selectedSectorEditProperty,style:e.style,delayEdgeInteractionEmitter:e.edgeAutoSolvedEmitter}),a=new I;super(J({children:[r,a]},o));L(this,"puzzleNode");this.puzzleModel=e,this.puzzleNode=r,this.disposeEmitter.addListener(()=>r.dispose());let s=null;const l=c=>{if(r.clearAnnotationNodes(),s&&(s.dispose(),s=null),c){const u=new Dr(e.puzzle.board,c,e.style,r.getBackgroundBounds());r.addAnnotationNode(u),s=u,o.focusNodeCallback(u)}};this.disposeEmitter.addListener(()=>{s&&(s.dispose(),s=null)}),e.displayedAnnotationProperty.link(l),this.disposeEmitter.addListener(()=>e.displayedAnnotationProperty.unlink(l));const p=at.multilink([zt,e.correctnessStateProperty],(c,u)=>{const C=()=>{a.children.forEach(S=>S.dispose())};c&&!u.isCorrect()?setTimeout(()=>{if(zt.value&&u===e.correctnessStateProperty.value){const S=new Ts(e.puzzle.board,u);C(),a.children=[S],console.log("showing error")}},Math.ceil(Nr.value*1e3)):C()});this.disposeEmitter.addListener(()=>p.dispose())}}class Z{constructor(n,e){this.layoutPuzzle=n,this.derivatives=e}plus(n){const e=new Map;return this.derivatives.forEach((t,o)=>{e.set(o,t.plus(n.derivatives.get(o)))}),new Z(this.layoutPuzzle,e)}minus(n){const e=new Map;return this.derivatives.forEach((t,o)=>{e.set(o,t.minus(n.derivatives.get(o)))}),new Z(this.layoutPuzzle,e)}timesScalar(n){const e=new Map;return this.derivatives.forEach((t,o)=>{e.set(o,t.timesScalar(n))}),new Z(this.layoutPuzzle,e)}getMaxMagnitude(){let n=0;return this.derivatives.forEach(e=>{n=Math.max(n,e.getMagnitude())}),n}getAreaCorrectedDerivative(){let n=this;for(let e=0;e<5;e++)n=n.getAreaCorrectedDerivativeOnce();return n}getAreaCorrectedDerivativeOnce(){return this.plus(Z.getAreaScaledDeltas(this.layoutPuzzle,-this.getAreaDerivative()/this.layoutPuzzle.getSignedArea()))}getAreaDerivative(){let n=0;return this.layoutPuzzle.faces.forEach(e=>{n+=pn(e.vertices.map(t=>t.viewCoordinates),e.vertices.map(t=>this.derivatives.get(t)))}),n}static getAreaScaledDeltas(n,e){const t=n.getCentroid(),o=new Map;return n.vertices.forEach(r=>{const a=r.viewCoordinates.minus(t).timesScalar(e);k()&&N(a.isFinite()),o.set(r,a)}),new Z(n,o)}static getHookesAttraction(n,e,t){const o=new Map;return n.vertices.forEach(r=>{o.set(r,le.ZERO.copy())}),n.edges.forEach(r=>{const a=r.start.viewCoordinates,l=r.end.viewCoordinates.minus(a),p=l.getMagnitude(),c=l.timesScalar((p-e)*t/p);k()&&N(c.isFinite()),o.get(r.start).add(c),o.get(r.end).subtract(c)}),new Z(n,o)}static getRegularPolygonDeltas(n,e,t,o){const r=new Map;n.vertices.forEach(s=>{r.set(s,le.ZERO.copy())});const a=s=>e/(2*Math.sin(Math.PI/s));return n.faces.forEach(s=>{if(s.vertices.length<3)return;const l=.2,p=.3,c=s.vertices.map(g=>g.viewCoordinates);let u=0;const C=Bt(c);C<0?u=1:C<l&&(u=Math.max(u,(l-C)/l));for(let g=0;g<c.length&&!(u>=1);g++){const b=g,B=(g+1)%c.length,O=c[b],f=c[B];for(let P=g+2;P<c.length-(g===0?1:0)&&!(u>=1);P++){const se=P%c.length,te=(P+1)%c.length,Q=c[se],W=c[te];if(ke.lineSegmentIntersection(O.x,O.y,f.x,f.y,Q.x,Q.y,W.x,W.y))k()&&N(c.length>=4),u=1;else{const w=Math.min(ke.distToSegment(O,Q,W),ke.distToSegment(f,Q,W),ke.distToSegment(Q,O,f),ke.distToSegment(W,O,f));w<p&&(u=Math.max(u,(p-w)/p))}}}if(u===0&&t&&n.getFaceValue(s)===null)return;const S=ze(c);k()&&N(S.isFinite());const E=a(c.length),m=c.map(g=>g.minus(S)),F=c.map((g,b)=>le.createPolar(E,2*Math.PI*b/c.length)),y=Z.getLeastSquares(m,F),d=o+(2-o)*u,v=c.map((g,b)=>y[b].minus(m[b]).timesScalar(d));s.vertices.forEach((g,b)=>{const B=v[b];k()&&N(B.isFinite()),r.get(g).add(B)})}),new Z(n,r)}static getBarycentricDeltas(n){const e=new Map;return n.vertices.forEach(t=>{const o=t.edges.map(s=>s.getOtherVertex(t)),r=new le(0,0);o.forEach(s=>r.add(s.viewCoordinates)),r.multiplyScalar(1/o.length);const a=r.subtract(t.viewCoordinates);k()&&N(a.isFinite()),e.set(t,a)}),new Z(n,e)}static getAngularDeltas(n,e){const t=new Map;return n.vertices.forEach(o=>{t.set(o,le.ZERO.copy())}),n.vertices.forEach(o=>{const r=o.edges.map(m=>m.getOtherVertex(o));let a=ve.sortBy(r,m=>m.viewCoordinates.minus(o.viewCoordinates).getAngle());if(a[0]!==r[0]){const m=a.indexOf(r[0]);a=[...a.slice(m),...a.slice(0,m)]}const s=ve.range(0,r.length).every(m=>a[m]===r[m]),l=r.map(m=>m.viewCoordinates.minus(o.viewCoordinates).normalized()),p=Z.getUnitLeastSquares(l),c=Math.max(...ve.range(0,r.length).map(m=>p[m].dot(p[(m+1)%r.length]))),u=Math.max(...ve.range(0,r.length).map(m=>l[m].dot(l[(m+1)%r.length]))),C=(m,F)=>F<=.5?.5*Math.pow(2*F,m):1-C(m,1-F),S=s?ke.linear(c,1,0,1,u):1,E=.75;if(S>E){const m=(S-E)/(1-E),F=C(2,m),y=new le(0,0);for(let d=0;d<r.length;d++){const v=r[d],g=l[d],b=p[d],B=b.minus(g.timesScalar(b.dot(g))).timesScalar(F*e);y.add(B),k()&&N(B.isFinite()),t.get(v).add(B)}y.multiplyScalar(1/r.length);for(const d of r)k()&&N(y),t.get(d).subtract(y)}}),new Z(n,t)}static getUnitLeastSquares(n){const e=n.length,t=ve.range(0,e).map(o=>le.createPolar(1,2*Math.PI*o/e));return Z.getLeastSquares(n,t)}static getLeastSquares(n,e){const t=n.length,o=new dt(2,t,[...e.map(c=>c.x),...e.map(c=>c.y)]),r=new dt(2,t,[...n.map(c=>c.x),...n.map(c=>c.y)]),a=o.times(r.transpose()),s=new Uo(a);let l=s.getV().times(s.getU().transpose());l.det()<0&&(l=s.getV().times(dt.diagonalMatrix([1,-1])).times(s.getU().transpose()));const p=new ot().rowMajor(l.get(0,0),l.get(0,1),0,l.get(1,0),l.get(1,1),0,0,0,1);return e.map(c=>{const u=p.timesVector2(c);return k()&&N(u.isFinite()),u})}}class Ms extends hn{constructor(e,t){const o=new Map,r=new Map,a=new Map,s=new Map,l=new Map,p=new Map,c=new Map,u=new Map,C=f=>{const P=o.get(f);return k()&&N(P),P},S=f=>{const P=r.get(f);return k()&&N(P),P},E=f=>{const P=a.get(f);return k()&&N(P),P},m=f=>{const P=s.get(f);return k()&&N(P),P},F=f=>{const P=l.get(f);return k()&&N(P),P},y=f=>{const P=p.get(f);return k()&&N(P),P},d=f=>{const P=c.get(f);return k()&&N(P),P},v=f=>{const P=u.get(f);return k()&&N(P),P},g=e.vertices.map(f=>{const P=new Xr(f.logicalCoordinates,f.viewCoordinates);return o.set(f,P),l.set(P,f),P}),b=e.faces.map(f=>{const P=new ao(f.logicalCoordinates,f.viewCoordinates);return r.set(f,P),p.set(P,f),P.originalFace=f,P}),B=[],O=e.edges.map(f=>{const P=o.get(f.start),se=o.get(f.end);k()&&N(P),k()&&N(se);const te=new so(P,se);te.originalEdges.add(f),a.set(f,te),c.set(te,f);const Q=new _e(P,se,!1);s.set(f.forwardHalf,Q),u.set(Q,f.forwardHalf),B.push(Q);const W=new _e(se,P,!0);return s.set(f.reversedHalf,W),u.set(W,f.reversedHalf),B.push(W),te});g.forEach(f=>{const P=F(f);f.incomingHalfEdges=P.incomingHalfEdges.map(m),f.outgoingHalfEdges=P.outgoingHalfEdges.map(m),f.edges=P.edges.map(E),f.faces=P.faces.map(S)}),b.forEach(f=>{const P=y(f);f.halfEdges=P.halfEdges.map(m),f.edges=P.edges.map(E),f.vertices=P.vertices.map(C)}),O.forEach(f=>{const P=d(f);f.forwardHalf=m(P.forwardHalf),f.reversedHalf=m(P.reversedHalf),f.forwardFace=P.forwardFace?S(P.forwardFace):null,f.reversedFace=P.reversedFace?S(P.reversedFace):null,f.vertices=P.vertices.map(C),f.faces=P.faces.map(S)}),B.forEach(f=>{const P=v(f);f.edge=E(P.edge),f.reversed=m(P.reversed),f.next=m(P.next),f.previous=m(P.previous),f.face=P.face?S(P.face):null});super({edges:O,vertices:g,faces:b,halfEdges:B,outerBoundary:e.outerBoundary.map(m),innerBoundaries:e.innerBoundaries.map(f=>f.map(m))});L(this,"edgeStateMap",new Map);L(this,"faceValueMap",new Map);this.originalBoard=e,this.originalState=t,O.forEach(f=>{this.edgeStateMap.set(f,t.getEdgeState(d(f)))}),b.forEach(f=>{this.faceValueMap.set(f,t.getFaceValue(y(f)))}),k()&&ut(this)}getFaceValue(e){const t=this.faceValueMap.get(e);return k()&&N(t!==void 0),t}getEdgeState(e){const t=this.edgeStateMap.get(e);return k()&&N(t!==void 0),t}clearSatisfiedFaces(){this.faces.forEach(e=>{const t=this.getFaceValue(e);if(t===null)return;let o=0,r=0;e.edges.forEach(a=>{const s=this.getEdgeState(a);s===ne.WHITE?o++:s===ne.BLACK&&r++}),o===0&&r===t&&this.faceValueMap.set(e,null)})}removeDeadRedEdges(){const e=new Set(this.edges.filter(s=>this.getEdgeState(s)===ne.RED&&s.faces.every(l=>l===null||this.getFaceValue(l)===null))),t=new Set(this.vertices.filter(s=>s.edges.every(l=>e.has(l)))),o=new Set(this.faces.filter(s=>s.edges.some(l=>e.has(l)))),r=[],a=new Set(o);for(;a.size;){const s=a.values().next().value;a.delete(s);const l=[s];let p=!1;for(let y=0;y<l.length;y++){const d=l[y];d.edges.forEach(v=>{e.has(v)&&[v.forwardFace,v.reversedFace].forEach(g=>{if(g!==d){if(g===null){p=!0;return}a.has(g)&&(a.delete(g),l.push(g))}})})}const c=new Set(l.flatMap(y=>y.halfEdges)),u=new Set(l.flatMap(y=>y.halfEdges.map(d=>d.reversed))),C=new Set([...c].filter(y=>!u.has(y))),S=y=>{let d=y.next;for(;d!==y&&!C.has(d);)d=d.reversed.next;return k()&&N(d!==y),d},E=C.values().next().value,m=[E];let F=S(E);for(;F!==E;)m.push(F),F=S(F);if(k()&&N(m.length===C.size),p){const y=[];for(let d=0;d<m.length;d++){const v=m[d],g=m[(d+m.length-1)%m.length];if(k()&&N(g.end===v.start),!e.has(v.edge)&&e.has(g.edge)){const b=[v];for(let B=d+1;;B++){const O=m[B%m.length];if(e.has(O.edge))break;b.push(O)}y.push(b)}}r.push(new Yr(l,m,y))}else r.push(new io(l,m))}r.forEach(s=>{if(s instanceof io){const l=s.boundaryHalfEdges.map(u=>u.start),p=s.boundaryHalfEdges.map(u=>u.edge),c=new ao(ze(l.map(u=>u.viewCoordinates)),ze(l.map(u=>u.logicalCoordinates)));this.faces.push(c),this.faceValueMap.set(c,null),c.halfEdges=s.boundaryHalfEdges,c.edges=p,c.vertices=l;for(let u=0;u<s.boundaryHalfEdges.length;u++){const C=s.boundaryHalfEdges[u],S=C.face;C.face=c;const E=C.edge;C.isReversed?E.reversedFace=c:E.forwardFace=c,k()&&N(S),S&&V(E.faces,S),E.faces.push(c)}}else s.boundarySegments.forEach(l=>{l.forEach(p=>{const c=p.edge,u=p.face;u&&(p.face=null,V(c.faces,u)),p.isReversed?c.reversedFace=null:c.forwardFace=null})})}),e.forEach(s=>{V(this.edges,s),V(this.halfEdges,s.forwardHalf),V(this.halfEdges,s.reversedHalf)}),t.forEach(s=>{V(this.vertices,s)}),o.forEach(s=>{V(this.faces,s)}),this.vertices.forEach(s=>{s.edges=s.edges.filter(l=>!e.has(l)),s.incomingHalfEdges=s.incomingHalfEdges.filter(l=>!e.has(l.edge)),s.outgoingHalfEdges=s.outgoingHalfEdges.filter(l=>!e.has(l.edge)),s.faces=s.incomingHalfEdges.map(l=>l.face).filter(l=>l!==null);for(let l=0;l<s.incomingHalfEdges.length;l++){const p=s.outgoingHalfEdges[l],c=s.incomingHalfEdges[(l+1)%s.incomingHalfEdges.length];c.next=p,p.previous=c}}),k()&&ut(this)}removeSimpleForced(){this.vertices.slice().forEach(e=>{if(e.edges.length!==2||ve.uniq(e.edges.flatMap(v=>v.faces)).some(v=>this.getFaceValue(v)!==null))return;const o=e.edges[0],r=e.edges[1],a=this.getEdgeState(o),s=this.getEdgeState(r);if(a!==s)return;const l=o.getOtherVertex(e),p=r.getOtherVertex(e);if(l===p)return;const c=o.forwardHalf.end===e?o.forwardHalf:o.reversedHalf,u=o.forwardHalf.end===e?o.reversedHalf:o.forwardHalf,C=r.forwardHalf.start===e?r.forwardHalf:r.reversedHalf,S=r.forwardHalf.start===e?r.reversedHalf:r.forwardHalf,E=c.face,m=u.face,F=new so(l,p);o.originalEdges.forEach(v=>F.originalEdges.add(v)),r.originalEdges.forEach(v=>F.originalEdges.add(v)),this.edgeStateMap.set(F,a),this.edges.push(F);const y=new _e(l,p,!1);this.halfEdges.push(y);const d=new _e(p,l,!0);if(this.halfEdges.push(d),F.forwardHalf=y,F.reversedHalf=d,F.forwardFace=E,F.reversedFace=m,F.vertices=[l,p],F.faces=[E,m].filter(v=>v!==null),y.edge=F,y.reversed=d,y.next=C.next,y.previous=c.previous,y.face=E,d.edge=F,d.reversed=y,d.next=u.next,d.previous=S.previous,d.face=m,E){const v=E.halfEdges.indexOf(c),g=E.edges.indexOf(o);k()&&N(v!==-1),k()&&N(g!==-1),E.halfEdges[v]=y,V(E.halfEdges,C),E.edges[g]=F,V(E.edges,r),V(E.vertices,e)}if(m){const v=m.halfEdges.indexOf(S),g=m.edges.indexOf(r);k()&&N(v!==-1),k()&&N(g!==-1),m.halfEdges[v]=d,V(m.halfEdges,u),m.edges[g]=F,V(m.edges,o),V(m.vertices,e)}{const v=l.incomingHalfEdges.indexOf(u),g=l.outgoingHalfEdges.indexOf(c),b=l.edges.indexOf(o);k()&&N(v!==-1),k()&&N(g!==-1),k()&&N(b!==-1),l.incomingHalfEdges[v]=d,l.outgoingHalfEdges[g]=y,l.edges[b]=F}{const v=p.incomingHalfEdges.indexOf(C),g=p.outgoingHalfEdges.indexOf(S),b=p.edges.indexOf(r);k()&&N(v!==-1),k()&&N(g!==-1),k()&&N(b!==-1),p.incomingHalfEdges[v]=y,p.outgoingHalfEdges[g]=d,p.edges[b]=F}y.previous.next=y,y.next.previous=y,d.previous.next=d,d.next.previous=d,V(this.edges,o),V(this.edges,r),V(this.halfEdges,o.forwardHalf),V(this.halfEdges,o.reversedHalf),V(this.halfEdges,r.forwardHalf),V(this.halfEdges,r.reversedHalf),V(this.vertices,e)}),k()&&ut(this)}simplify(){this.clearSatisfiedFaces(),this.removeDeadRedEdges(),this.removeSimpleForced()}fixOuterBoundary(){const e=new Set(this.halfEdges.filter(r=>r.face===null)),t=[],o=[];for(;e.size;){const r=e.values().next().value;e.delete(r);const a=[r];let s=r.next;for(;s!==r;)a.push(s),e.delete(s),s=s.next;Bt(a.map(l=>l.start.viewCoordinates))<0?t.push(a):o.push(a)}k()&&N(t.length===1),this.outerBoundary.length=0,this.outerBoundary.push(...t[0]),this.innerBoundaries.length=0,this.innerBoundaries.push(...o)}getCompleteState(){this.fixOuterBoundary();const e=Eo.fromFacesEdges(this,t=>this.getFaceValue(t),t=>this.getEdgeState(t));return He(this,e),e}getCompletePuzzle(){return{board:this,state:this.getCompleteState()}}getSignedArea(){let e=0;return this.faces.forEach(t=>{e+=Bt(t.vertices.map(o=>o.viewCoordinates))}),e}getCentroid(){let e=0,t=0,o=0;return this.halfEdges.forEach(r=>{if(r.face===null){const a=r.end.viewCoordinates,s=r.start.viewCoordinates;e+=(s.x+a.x)*(s.y-a.y);const l=a.x*(2*a.y+s.y)+s.x*(a.y+2*s.y);t+=(a.x-s.x)*l,o+=(s.y-a.y)*l}}),e*=.5,new le(t,o).timesScalar(1/(6*e))}applyDerivative(e){this.vertices.forEach(t=>{const o=e.derivatives.get(t);k()&&N(o),k()&&N(o.isFinite()),t.viewCoordinates.add(o)}),this.fixFaceCoordinates()}fixFaceCoordinates(){this.faces.forEach(e=>{e.viewCoordinates.set(ze(e.halfEdges.map(t=>t.start.viewCoordinates)))})}}const Hs=i=>({board:i.board,stateProperty:new Mt(i.state)});class Vs extends I{constructor(e,t){const o=new I;let r=null;const a=()=>{const l=e.puzzle.board,p=e.puzzle.stateProperty.value;if(p.getSimpleRegions().some(y=>y.isSolved))return;const c=new Ms(l,p);c.simplify();const u=()=>Z.getAngularDeltas(c,.2).plus(Z.getHookesAttraction(c,1,.1)).plus(Z.getRegularPolygonDeltas(c,1,!0,.2));let C=.3;for(let y=0;y<40;y++){y%10===0&&(C*=.95);let d=u();{let v=d.getMaxMagnitude(),g=C;C*v>1.5&&(g=1.5/v),d=d.timesScalar(g)}if(c.applyDerivative(d),d.getMaxMagnitude()<.015)break}const S=c.getCompletePuzzle();r&&r.dispose();const E=new xe(Hs(S),{edgePressListener:(y,d)=>{const v=y.originalEdges;v&&e.onUserEdgePress(v.values().next().value,d)},facePressListener:(y,d)=>{if(y===null)e.onUserFacePress(null,d);else{const v=y.originalFace;v&&e.onUserFacePress(v,d)}}});this.puzzleNode=E,r=E;const m=new I({children:[E]}),F=600;m.scale(Math.min(F/m.width,F/m.height)),m.left=20,m.top=130,o.children=[m]},s=()=>{o.children=[],a()};e.puzzle.stateProperty.link(s);super(J({children:[o]},t));L(this,"puzzleNode");this.puzzleModel=e,this.disposeEmitter.addListener(()=>e.puzzle.stateProperty.unlink(s)),this.disposeEmitter.addListener(()=>o.dispose()),this.disposeEmitter.addListener(()=>r&&r.dispose())}}class No extends Jo(I){constructor(e,t=Dt,o){const r=re()({topological:!1},o);super(r);L(this,"backgroundRect");L(this,"facePressRect");L(this,"rectangularGradientRect");L(this,"circularGradientRect");L(this,"puzzleWrapper");L(this,"puzzleNode",null);L(this,"zoomListener");this.puzzleModelProperty=e,this.style=t,this.backgroundRect=new D({fill:t.theme.playAreaBackgroundColorProperty,pickable:!0}),this.facePressRect=new D({fill:null,pickableProperty:xr}),Br(this.facePressRect,s=>{var l;(l=e.value)==null||l.onUserFacePress(null,s)},s=>{var l;(l=this.puzzleNode)==null||l.puzzleNode.onFaceBackgroundDragStart(s)}),this.rectangularGradientRect=new D({pickable:!1}),this.circularGradientRect=new D({pickable:!1}),this.puzzleWrapper=new I({children:[this.backgroundRect,this.facePressRect,this.rectangularGradientRect,this.circularGradientRect]}),this.zoomListener=new Ko(this.puzzleWrapper,{maxScale:10}),this.addInputListener(this.zoomListener),this.addChild(this.puzzleWrapper);const a=this.updateLayout.bind(this);this.localPreferredWidthProperty.lazyLink(a),this.localPreferredHeightProperty.lazyLink(a),r.topological&&this.puzzleWrapper.localBoundsProperty.lazyLink(a),at.multilink([e,qt],(s,l)=>{this.puzzleNode&&(this.puzzleNode.dispose(),this.puzzleNode=null),s&&(r.topological?l&&(this.puzzleNode=new Vs(s)):this.puzzleNode=new Rs(s,{focusNodeCallback:p=>{this.zoomListener.panToNode(p,!0)}}),this.puzzleNode&&(this.updatePuzzleNodeLayout(this.puzzleNode),this.puzzleWrapper.children=[this.backgroundRect,this.facePressRect,this.rectangularGradientRect,this.circularGradientRect,this.puzzleNode])),this.zoomListener.resetTransform(),this.updateLayout()})}step(e){this.zoomListener.step(2*e)}updateLayout(){const e=this.localPreferredWidth,t=this.localPreferredHeight;if(e!==null&&(this.backgroundRect.rectWidth=e,this.facePressRect.rectWidth=e,this.rectangularGradientRect.rectWidth=e,this.circularGradientRect.rectWidth=e),t!==null&&(this.backgroundRect.rectHeight=t,this.facePressRect.rectHeight=t,this.rectangularGradientRect.rectHeight=t,this.circularGradientRect.rectHeight=t),this.puzzleNode&&this.updatePuzzleNodeLayout(this.puzzleNode),e!==null&&t!==null&&e>0&&t>0){const o=new nt(0,0,e,t),r=o.center,a=r.getMagnitude();this.rectangularGradientRect.fill=new jo(0,0,0,t).addColorStop(0,this.style.theme.playAreaLinearTopColorProperty).addColorStop(.5,this.style.theme.playAreaLinearMiddleColorProperty).addColorStop(1,this.style.theme.playAreaLinearBottomColorProperty),this.circularGradientRect.fill=new Qo(r.x,r.y,a,r.x,r.y,0).addColorStop(0,this.style.theme.playAreaRadialOutsideColorProperty).addColorStop(1,this.style.theme.playAreaRadialInsideColorProperty),this.clipArea=T.bounds(o),this.zoomListener.setTargetBounds(o),this.zoomListener.setPanBounds(o)}else{const o=new nt(0,0,5,5);this.zoomListener.setTargetBounds(o),this.zoomListener.setPanBounds(o)}}updatePuzzleNodeLayout(e){const t=this.localPreferredWidth,o=this.localPreferredHeight;if(t!==null&&o!==null&&t>0&&o>0){const a=t-40,s=o-20*2;if(e.localBounds.isValid()){const l=e.localBounds.width,p=e.localBounds.height,c=Math.min(a/l,s/p);e.setScaleMagnitude(c),e.center=new le(t/2,o/2)}}}}class Ds{constructor(n,e,t){this.layoutBoundsProperty=n,this.glassPane=e,this.stepEmitter=t}}const xo=new I,We=new I;self.assertions;const qs=new I({renderer:"svg",children:[We]}),Re=new $o(qs,{allowWebGL:!0,allowBackingScaleAntialiasing:!0,allowSceneOverflow:!1,accessibility:!0,backgroundColor:"#eee",assumeFullWindow:!0,listenToOnlyElement:st.debugColors});document.body.appendChild(Re.domElement);Re.setPointerAreaDisplayVisible(st.showPointerAreas);self.oncontextmenu=i=>i.preventDefault();const Ut=new Mt(new nt(0,0,self.innerWidth,self.innerHeight)),ee=new we(Zr()),Bo=new No(ee,Dt,{layoutOptions:{stretch:!0,grow:1}}),Oo=new No(ee,Dt,{layoutOptions:{stretch:!0,grow:1},topological:!0,visibleProperty:qt}),Us=new Ne(ee,{derive:i=>i?i.hintStateProperty:new we(be.DEFAULT)});at.multilink([h.navbarBackgroundColorProperty],i=>{Re.backgroundColor=i});const Ao=new Me,lt=new Ds(Ut,xo,Ao),zo=new Bs(ee,lt,{loadPuzzle:i=>{const n=Rt(i.board,i.stateProperty.value);n&&(ee.value=new ho(n))}}),Ws=new it(lt),Gs=new Ue(lt),To=new zs(lt,Us,()=>{var i;(i=ee.value)==null||i.onUserApplyHint()},()=>{var i;(i=ee.value)==null||i.onUserClearHint()}),Oe=new H({stretch:!0,children:[new et(zo,{margin:Te}),new R({grow:1,stretch:!0,layoutOptions:{grow:1},children:[Bo,Oo]}),new et(Gs,{margin:Te,visibleProperty:Po}),new et(Ws,{margin:Te})]});Ut.lazyLink(i=>{Oe.preferredWidth=i.width,Oe.preferredHeight=i.height,Oe.x=i.left,Oe.y=i.top});We.addChild(Oe);We.addChild(To);We.addChild(xo);_o.create(We,[zo,To],(i,n)=>{n.centerTop=i.centerBottom.plusXY(0,5)});Re.initializeEvents();let Wt=!0;const Ro=()=>{Wt=!1;const i=new nt(0,0,self.innerWidth,self.innerHeight);Re.setWidthHeight(i.width,i.height),Ut.value=i,gn.mobileSafari&&self.scrollTo(0,0)},ct=()=>{Wt=!0};$(self).resize(ct);self.addEventListener("resize",ct);self.addEventListener("orientationchange",ct);self.visualViewport&&self.visualViewport.addEventListener("resize",ct);Ro();Re.updateOnRequestAnimationFrame(i=>{var n;qr(),Wt&&Ro(),Oe.validateBounds(),Bo.step(i),Oo.step(i),(n=ee.value)==null||n.step(i),Ao.emit(i)});document.addEventListener("keydown",i=>{var n,e,t,o;if(i.ctrlKey||i.metaKey)i.key==="z"&&(i.shiftKey?(n=ee.value)==null||n.onUserRedo():(e=ee.value)==null||e.onUserUndo()),i.key==="y"&&((t=ee.value)==null||t.onUserRedo());else if(["1","2","3","4","5","6","7","8","9"].includes(i.key)){const r=Number.parseInt(i.key,10)-1,a=K.enumeration.values.filter(s=>s.isEnabledProperty.value);r<a.length&&Or(a[r])}else i.key==="Escape"&&((o=ee.value)==null||o.onUserEscape())});rt.keydownEmitter.addListener(i=>{i.key==="e"&&(Vt.value=!0)});rt.keyupEmitter.addListener(i=>{i.key==="e"&&(Vt.value=!1)});let co=!1;rt.keyDownStateChangedEmitter.addListener(()=>{const i=rt.isEnglishKeyDown("space");i!==co&&(co=i,Be.value=Be.value===fe.PAN_ONLY?fe.DRAG_ONLY:fe.PAN_ONLY)});ee.lazyLink((i,n)=>{n&&n.dispose()});
