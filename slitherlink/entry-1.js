var no=Object.defineProperty;var ro=(u,n,e)=>n in u?no(u,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[n]=e;var x=(u,n,e)=>ro(u,typeof n!="symbol"?n+"":n,e);import{c as W,o as j,D as et,T as le,M as De,a as ke,P as lt,V as te,b as ge,d as Je,S as so,e as R,B as Ve}from"./chunk-16.js";import{S as Ue,s as ao}from"./chunk-34.js";import{P as D,N as L,R as H,A as Re,T as q,s as ft,H as O,a as he,b as Bt,V as T,G as wt,M as io,B as ct,c as yt,d as We,e as tt,I as mt,f as Ct,g as lo,L as Pt,h as we,i as co,S as uo,j as po,k as ho,l as go,D as fo,m as wo,n as qe}from"./chunk-17.js";import{B as yo,a as mo,b as Co,c as Po,d as k,e as N,S as A,f as Oe,P as vo,g as ve,L as So,h as bo,i as ot,_ as ye,j as Eo,k as Ze,l as Lo}from"./chunk-18.js";import{L as zt,c as h,t as ko,u as Z,r as de,a as Se,b as oe,d as vt,e as Io,p as No,f as St,g as Fo,h as xo,s as Ke,i as Bo,j as zo,v as bt,k as Ao,m as Oo,w as Mo,n as Et,o as To,q as Ro,x as Ho,y as Do,z as Vo,A as qo,B as Uo,C as Wo,D as Go,E as Xo,F as Yo,G as Jo,H as Zo,I as Ko,J as jo,K as _o,M as Qo,N as je,O as $o,P as en,Q as tn,R as _e}from"./chunk-23.js";import{f as At,U as M,p as Ot,h as Mt,i as Tt,j as Rt,k as Ht,l as Dt,s as ce,m as Vt,v as nt,n as rt,o as qt,V as on,F as nn,q as rn,r as sn,t as an,u as ln,w as cn,x as dn,y as un,z as pn,A as hn,B as gn,C as fn,D as wn,G as yn,H as mn,I as Cn,J as Pn,K as vn,L as Sn,M as bn,N as En,O as Ln,Q as kn,R as In,S as Nn,T as Fn,W as Qe,X as xn,Y as Bn,Z as zn,_ as An,$ as st,a0 as On,a1 as Mn,a2 as $e,a3 as Ut,a4 as Wt,a5 as at,a6 as Tn,a7 as Ie,P as me,a8 as Rn,a9 as X,aa as dt,ab as Ce,ac as ie,ad as Hn,ae as ue,af as Dn,ag as Vn,ah as qn,ai as ut,aj as Un}from"./chunk-25.js";import{g as it}from"./chunk-30.js";import{B as pe}from"./chunk-29.js";import{p as Gt,d as Wn,a as Lt}from"./chunk-21.js";import{w as Gn}from"./chunk-22.js";import{P as Fe,C as Xn,T as He,O as Yn,R as Jn,V as Zn,a as se,B as be,b as Kn}from"./chunk-19.js";import{U as jn}from"./chunk-35.js";import{N as Me,S as _n}from"./chunk-32.js";import{C as Ne}from"./chunk-36.js";import{s as Qn}from"./chunk-31.js";import{E as Ee,C as Xt}from"./chunk-28.js";import{U as z,A as $n}from"./chunk-37.js";import"./chunk-20.js";import"./chunk-27.js";import"./chunk-38.js";import"./chunk-39.js";import"./chunk-40.js";const pt=new zt("showLayoutTestProperty",!1);class Te extends yo{constructor(n,e,t){super(n,e,t)}}class kt extends mo{constructor(e,t){super(e,t);x(this,"originalEdges",new Set)}}class It extends Co{constructor(e,t){super(e.copy(),t.copy());x(this,"originalFace",null)}}class er extends Po{constructor(n,e){super(n.copy(),e.copy())}}class Nt{constructor(n,e){this.faces=n,this.boundaryHalfEdges=e}}class tr{constructor(n,e,t){this.faces=n,this.boundaryHalfEdges=e,this.boundarySegments=t}}const or=()=>{const u=Ue.p||localStorage.getItem("puzzleString"),n=pe.loadDefaultPuzzle();let e=null,t=0;try{let o=n;if(u){const r=Gt(u);if(r){o=r;const l=localStorage.getItem("timeElapsedProperty");t=l?JSON.parse(l):0}}e=it(o.board,o.stateProperty.value)}catch(o){console.error(o)}return e||(e=it(n.board,n.stateProperty.value)),k()&&N(e),new At(e,{initialTimeElapsed:t})},nr=new A("M1024 640q0 106 -75 181t-181 75t-181 -75t-75 -181t75 -181t181 -75t181 75t75 181zM1536 749v-222q0 -12 -8 -23t-20 -13l-185 -28q-19 -54 -39 -91q35 -50 107 -138q10 -12 10 -25t-9 -23q-27 -37 -99 -108t-94 -71q-12 0 -26 9l-138 108q-44 -23 -91 -38q-16 -136 -29 -186q-7 -28 -36 -28h-222q-14 0 -24.5 8.5t-11.5 21.5l-28 184q-49 16 -90 37l-141 -107q-10 -9 -25 -9q-14 0 -25 11q-126 114 -165 168q-7 10 -7 23q0 12 8 23q15 21 51 66.5t54 70.5q-27 50 -41 99l-183 27q-13 2 -21 12.5t-8 23.5v222q0 12 8 23t19 13l186 28q14 46 39 92q-40 57 -107 138q-10 12 -10 24q0 10 9 23q26 36 98.5 107.5t94.5 71.5q13 0 26 -10l138 -107q44 23 91 38q16 136 29 186q7 28 36 28h222q14 0 24.5 -8.5t11.5 -21.5l28 -184q49 -16 90 -37l142 107q9 9 24 9q13 0 25 -10q129 -119 165 -170q7 -8 7 -22q0 -12 -8 -23q-15 -21 -51 -66.5t-54 -70.5q26 -50 41 -98l183 -28q13 -2 21 -12.5t8 -23.5z").makeImmutable(),rr=new A("M979 1395q19 19 32 13t13 -32v-1472q0 -26 -13 -32t-32 13l-710 710q-9 9 -13 19v-678q0 -26 -19 -45t-45 -19h-128q-26 0 -45 19t-19 45v1408q0 26 19 45t45 19h128q26 0 45 -19t19 -45v-678q4 10 13 19z").makeImmutable(),sr=new A("M45 -115q-19 -19 -32 -13t-13 32v1472q0 26 13 32t32 -13l710 -710q9 -9 13 -19v678q0 26 19 45t45 19h128q26 0 45 -19t19 -45v-1408q0 -26 -19 -45t-45 -19h-128q-26 0 -45 19t-19 45v678q-4 -10 -13 -19z").makeImmutable(),ar=new A("M1619 1395q19 19 32 13t13 -32v-1472q0 -26 -13 -32t-32 13l-710 710q-9 9 -13 19v-710q0 -26 -13 -32t-32 13l-710 710q-19 19 -19 45t19 45l710 710q19 19 32 13t13 -32v-710q4 10 13 19z").makeImmutable(),ir=new A("M45 -115q-19 -19 -32 -13t-13 32v1472q0 26 13 32t32 -13l710 -710q9 -9 13 -19v710q0 26 13 32t32 -13l710 -710q19 -19 19 -45t-19 -45l-710 -710q-19 -19 -32 -13t-13 32v710q-4 -10 -13 -19z").makeImmutable();new A("M503.691 189.836L327.687 37.851C312.281 24.546 288 35.347 288 56.015v80.053C127.371 137.907 0 170.1 0 322.326c0 61.441 39.581 122.309 83.333 154.132 13.653 9.931 33.111-2.533 28.077-18.631C66.066 312.814 132.917 274.316 288 272.085V360c0 20.7 24.3 31.453 39.687 18.164l176.004-152c11.071-9.562 11.086-26.753 0-36.328z").makeImmutable();const Yt=new A("M363 0l91 91l-235 235l-91 -91v-107h128v-128h107zM886 928q0 22 -22 22q-10 0 -17 -7l-542 -542q-7 -7 -7 -17q0 -22 22 -22q10 0 17 7l542 542q7 7 7 17zM832 1120l416 -416l-832 -832h-416v416zM1515 1024q0 -53 -37 -90l-166 -166l-416 416l166 165q36 38 90 38q53 0 91 -38l235 -234q37 -39 37 -91z").makeImmutable(),lr=new A("M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 448c-110.532 0-200-89.431-200-200 0-110.495 89.472-200 200-200 110.491 0 200 89.471 200 200 0 110.53-89.431 200-200 200zm107.244-255.2c0 67.052-72.421 68.084-72.421 92.863V300c0 6.627-5.373 12-12 12h-45.647c-6.627 0-12-5.373-12-12v-8.659c0-35.745 27.1-50.034 47.579-61.516 17.561-9.845 28.324-16.541 28.324-29.579 0-17.246-21.999-28.693-39.784-28.693-23.189 0-33.894 10.977-48.942 29.969-4.057 5.12-11.46 6.071-16.666 2.124l-27.824-21.098c-5.107-3.872-6.251-11.066-2.644-16.363C184.846 131.491 214.94 112 261.794 112c49.071 0 101.45 38.304 101.45 88.8zM298 368c0 23.159-18.841 42-42 42s-42-18.841-42-42 18.841-42 42-42 42 18.841 42 42z").makeImmutable(),cr=new A("M352.201 425.775l-79.196 79.196c-9.373 9.373-24.568 9.373-33.941 0l-79.196-79.196c-15.119-15.119-4.411-40.971 16.971-40.97h51.162L228 284H127.196v51.162c0 21.382-25.851 32.09-40.971 16.971L7.029 272.937c-9.373-9.373-9.373-24.569 0-33.941L86.225 159.8c15.119-15.119 40.971-4.411 40.971 16.971V228H228V127.196h-51.23c-21.382 0-32.09-25.851-16.971-40.971l79.196-79.196c9.373-9.373 24.568-9.373 33.941 0l79.196 79.196c15.119 15.119 4.411 40.971-16.971 40.971h-51.162V228h100.804v-51.162c0-21.382 25.851-32.09 40.97-16.971l79.196 79.196c9.373 9.373 9.373 24.569 0 33.941L425.773 352.2c-15.119 15.119-40.971 4.411-40.97-16.971V284H284v100.804h51.23c21.382 0 32.09 25.851 16.971 40.971z").makeImmutable(),ae=(u,n)=>new D(u,W({maxWidth:20,maxHeight:20,fill:"black"},n));class xe extends L{constructor(n,e,t){const o=j()({allowBarrierClickToHide:!0,panelOptions:{xMargin:15,yMargin:15,fill:h.uiBackgroundColorProperty,stroke:h.uiForegroundColorProperty}},t);super(),this.content=n,this.viewContext=e;const r=new H({fill:h.barrierColorProperty});this.addChild(r),e.layoutBoundsProperty.link(s=>{r.rectBounds=s}),o.allowBarrierClickToHide&&r.addInputListener({down:()=>{this.hide()}});const l=new Fe(n,o.panelOptions);e.layoutBoundsProperty.link(s=>{l.maxWidth=s.width*.9,l.maxHeight=s.height*.9}),this.addChild(new Re(l,{alignBoundsProperty:e.layoutBoundsProperty,yAlign:"top",topMargin:50}))}show(){this.viewContext.glassPane.hasChild(this)||(this.reset(),this.viewContext.glassPane.addChild(this))}hide(){this.viewContext.glassPane.hasChild(this)&&this.viewContext.glassPane.removeChild(this)}reset(){}}class Be{constructor(n,e){x(this,"timerListener",null);x(this,"tooltipNode",null);this.viewContext=n,this.tooltipTextOverride=e}showTooltip(n,e,t){if(!this.tooltipNode){this.tooltipNode=new Fe(new q(n,{font:ko}),{cornerRadius:1,xMargin:2,yMargin:2});const o=this.viewContext.glassPane.globalToLocalPoint(t.point);this.tooltipNode.leftTop=o.plusXY(0,this.viewContext.glassPane.getUniqueTransform().transformDeltaY(20)),this.tooltipNode.bottom>this.viewContext.layoutBoundsProperty.value.bottom&&(this.tooltipNode.bottom=o.y-2),this.tooltipNode.left<this.viewContext.layoutBoundsProperty.value.left&&(this.tooltipNode.left=this.viewContext.layoutBoundsProperty.value.left+2),this.tooltipNode.right>this.viewContext.layoutBoundsProperty.value.right&&(this.tooltipNode.right=this.viewContext.layoutBoundsProperty.value.right-2),this.viewContext.glassPane.addChild(this.tooltipNode)}}hideTooltip(){this.tooltipNode&&(this.tooltipNode.dispose(),this.tooltipNode=null)}clearListener(){this.timerListener&&(ft.clearTimeout(this.timerListener),this.timerListener=null)}enter(n){const e=n.currentTarget,t=n.pointer;if(e&&this.timerListener===null){const o=()=>{const r=this.tooltipTextOverride??(e==null?void 0:e.labelContent)??(e==null?void 0:e.accessibleName);if(r){this.showTooltip(r,e,t);let l=this.tooltipNode;const s=()=>{this.tooltipNode===l&&(this.hideTooltip(),o())};e.rendererSummaryRefreshEmitter.addListener(s),l.disposeEmitter.addListener(()=>{e.rendererSummaryRefreshEmitter.removeListener(s)})}};this.timerListener=ft.setTimeout(()=>{o()},200)}}exit(n){this.clearListener(),this.hideTooltip()}dispose(){this.clearListener(),this.hideTooltip()}}class I extends Xn{constructor(n,e,t){const o=j()({advanced:!1,accessibleName:n,checkboxColor:h.uiForegroundColorProperty,checkboxColorBackground:h.uiBackgroundColorProperty},t),r=new q(n,{font:Z,fill:h.uiForegroundColorProperty});o.advanced&&(o.visibleProperty=Y),o.boxWidth=r.height,super(e,r,o)}}class ne extends He{constructor(n,e){const t=j()({advanced:!1,textFill:h.uiButtonForegroundProperty,baseColor:h.uiButtonBaseColorProperty,xMargin:5,yMargin:5,font:Z,buttonAppearanceStrategy:de},e);t.advanced&&(t.visibleProperty=Y),super(n,t)}}class dr extends O{constructor(n,e,t,o){const r=j()({advanced:!1,onOffSwitchOptions:{size:new et(40,20),trackFillLeft:h.uiButtonDisabledColorProperty,trackFillRight:h.uiButtonBaseColorProperty,accessibleName:e},spacing:10},o),l=new Yn(n,r.onOffSwitchOptions);r.children=[t,l],r.advanced&&(r.visibleProperty=Y),super(r)}}class V extends dr{constructor(n,e,t){const o=j()({textOptions:{}},t),r=new M(e,o.textOptions);super(n,e,r,o)}}class Jt extends Jn{constructor(n,e,t){super(n,e,W({orientation:"horizontal",touchAreaYDilation:5,radioButtonOptions:{baseColor:h.uiButtonBaseColorProperty,disabledColor:h.uiButtonDisabledColorProperty,xMargin:8*1.3,yMargin:5*1.3,buttonAppearanceStrategyOptions:{selectedStroke:h.uiButtonSelectedStrokeColorProperty,deselectedStroke:h.uiButtonDeselectedStrokeColorProperty}}},t))}}class ze extends Jt{constructor(n){const{basicLinesIcon:e,basicFaceColoringIcon:t,pureFaceColoringIcon:o,classicIcon:r,basicSectorsIcon:l,sectorsWithColorsIcon:s,vertexStateIcon:a,faceStateIcon:p,customIcon:i}=ze.getIcons(),d=new Be(n);super(Ot,[{value:Mt,createNode:()=>r,labelContent:"Classic",options:{}},{value:Tt,createNode:()=>e,labelContent:"Lines",options:{}},{value:Rt,createNode:()=>t,labelContent:"Lines and Colors",options:{}},{value:Ht,createNode:()=>o,labelContent:"Colors",options:{}},{value:Dt,createNode:()=>l,labelContent:"Sectors",options:{visibleProperty:ce}},{value:Vt,createNode:()=>s,labelContent:"Sectors and Colors",options:{visibleProperty:ce}},{value:nt,createNode:()=>a,labelContent:"Vertex State",options:{visibleProperty:Y}},{value:rt,createNode:()=>p,labelContent:"Face State",options:{visibleProperty:Y}},{value:qt,createNode:()=>i,labelContent:"Custom",options:{visibleProperty:Y}}]),this.children.forEach(m=>m.addInputListener(d)),n.layoutBoundsProperty.link(m=>{this.maxWidth=Math.max(1,m.width-2*Se)})}static getIcons(){const n=new H(0,0,15,15,{stroke:h.whiteLineColorProperty,fill:h.faceColorDefaultColorProperty}),e=new H(0,0,15,15,{stroke:h.whiteLineColorProperty,fill:new he([h.faceColorBasicTargetColorProperty],S=>S.withAlpha(1))}),t=new D(new A().moveTo(0,15).lineTo(0,0).lineTo(15,0).makeImmutable(),{stroke:new he([h.simpleRegionTargetColorProperty],S=>S.withAlpha(1)),lineWidth:4,lineCap:"round",lineJoin:"round"}),o=new D(new A().moveTo(0,15).lineTo(0,0).lineTo(15,0).makeImmutable(),{stroke:h.blackLineColorProperty,lineWidth:4,lineCap:"round",lineJoin:"round"}),r=new D(new A().arc(0,0,9,0,Math.PI/2,!1),{stroke:h.sectorOnlyOneColorProperty}),l=new L({children:[n,t]}),s=new L({children:[e,o]}),a=new L({children:[new H(0,0,15,15,{fill:h.uiForegroundColorProperty})]}),p=3,i=new A().moveTo(-p,-p).lineTo(p,p).moveTo(-p,p).lineTo(p,-p),d=new L({children:[new H(0,0,15,15,{fill:h.puzzleBackgroundColorProperty}),new D(new A().moveTo(0,15).lineTo(0,0).lineTo(15,0).makeImmutable(),{stroke:h.blackLineColorProperty,lineWidth:3,lineCap:"square",lineJoin:"miter"}),new D(i,{stroke:h.xColorProperty,lineWidth:2,x:15,y:7.5})]}),m=new L({children:[n,r,t]}),C=new L({children:[e,r,o]}),b=Gt("eJytV11v2jAU/S9+9oOvv4PUh7VQqS+dNtZK08RDVlwUjQIiKWuF8t9nJw2JjWGJygtKfE7OuR/Oxdmjndnm2XqFRoDR73W6naPRHhXvG4NG6DrNzXW1hh2vyJ5Mjka/9ugNjQhG79Xvrr7ZubsSdzCoMYhh1MPAw5in6WO8xmhMU3iY/5ysMRZ7TnmY/5z24qQelnhx+hgQL5gABM8xAP3SMB/0axOAfnECUHierJxh9JxG+9k2mmDAFLPZhxJEKIA5Fpg2FBqhcCyxwqKhsAiFWRuNk4bCIxRqbWxVdcMREY6wPra4QBqSjJAS62SLDIe0VISknZctKBwy07HkSWVnA+Oz0hJRXqSF6bxAN+uXzdIUZpwWKaoL/pguX+v7lnbrrXcb464csW1Q61Lt1A5BhAQWEFRIoAFBHyu4rMx8YaZuIQh7Ytc/InYUF3FVhMwl/d0s7FgJnpiGkM+uFDD6a7LtfNJRdCHerJfrbaRu7TpGT+66Llxm5xiTIhESGNdaccnZB2Fa54a+PvyY3o0nnXpb7/Vms86zwhyk76yQ1QBOOFeESZ0w5cqWRdYDg7v7nvphoI0+EEEJIcIaJIoyCPQf7seTG+swRvF3uTzlt3pdLhsPRmXCtdAEEkpUfw8Y4KEp1ZpwpaWQjBHR14MOyQMEkTQhYK2EpL092AAPxaRilJKEckbFUb9PevAhHoqDtG2XTNreJ737IYb0I1ECqOBCJMDtzu3rIQd4cHBdUEwntlCgeuehhtTKblhCpSB2byXWp6+H7uNhwWy1S5fZ/ICh0XO6zI2bceap+DAKR1yANNzavL52dDtht8XRaDerubcGZTuMpUv7nABEBOgQARoRYEMEWESADBEQEQHVEeD/rUGsimKIgoq1AQbFEGsEkE+nMTAK/vkoookMqibEOmpD60q4v3h3qjJvsRfqMUCCT5H6wVNnJPTty9UVckFGeNDh5Wd4tMNji9M81lNPdPXO8FSHx8/l0U2YniNCX0Xel9jNZVERmwNbrJe33nrfg+6+PThX546XtNhmloh+OkM7pvMvq/dmNgdHWjgr5gZ9R6/VKravR1L0clLsclL8clJHHxCeFOutIy8X0tEniydFe+scfdmcTO1PbE/NyrL8B0eOKVk=");k()&&N(b);const w=new on(b.board.vertices[5],b.stateProperty,{...nt,allVertexStateVisibleProperty:new le(!0)}),E=new L({children:[w],scale:60}),y=new nn(b.board.faces[5],b.stateProperty,rt),c=new L({children:[y],scale:30}),P=ae(Yt,{fill:h.uiForegroundColorProperty,matrix:new De().rowMajor(.75,0,0,0,-.75,0,0,0,1)}),g=new Bt;return{basicLinesIcon:g.createBox(l),basicFaceColoringIcon:g.createBox(s),pureFaceColoringIcon:g.createBox(a),classicIcon:g.createBox(d),basicSectorsIcon:g.createBox(m),sectorsWithColorsIcon:g.createBox(C),vertexStateIcon:g.createBox(E),faceStateIcon:g.createBox(c),customIcon:g.createBox(P)}}}const _=(u,n,e,t)=>{const o=new Zn(n,e,{spacing:8,radioButtonOptions:{selectedColor:h.uiButtonBaseColorProperty,deselectedColor:h.uiBackgroundColorProperty,stroke:h.uiForegroundColorProperty}}),r=j()({stretch:!0,align:"left",spacing:10,children:[new q(u,{font:oe,fill:h.uiForegroundColorProperty}),o]},t);return new T(r)},Y=new zt("advancedSettingsVisibleProperty",!1);class ur extends xe{constructor(n){const e=new Be(n),t=new T({stretch:!0,align:"left",spacing:8,children:[new q("Solve After Every Move",{font:oe,fill:h.uiForegroundColorProperty}),new wt({xAlign:"left",yAlign:"top",xSpacing:20,ySpacing:8,columns:[[new I("Vertex Joint X",rn),new I("Vertex Forced Line",sn),new I("Vertex Forced X",an),new I("Completed Face X",ln),new I("Completed Face Lines",cn),new I("Simple Loop X",dn),new I("Simple Loop Lines",un),new I("Double Minus One Faces",pn),new I("1/N-1 Sectors",hn),new I("Simple Sectors",gn),new I("Vertex X",fn),new I("Vertex Lines",wn),new I("Vertex Sectors",yn),new I("Vertex Faces",mn)],[new I("Color X",Cn),new I("Color Lines",Pn),new I("Color Parity X",vn),new I("Color Parity Lines",Sn),new I("Color Parity Colors",bn),new I("Color Parity Partial",En),new I("Vertex/Color To Face",Ln),new I("Face X",kn),new I("Face Lines",In),new I("Face Sectors",Nn),new I("Face Color",Fn)]]})]}),o=_("Theme",Io,vt.map(c=>({value:c,createNode:()=>new q(c.name,{font:Z,fill:h.uiForegroundColorProperty}),a11yName:c.name}))),r=new T({spacing:15,stretch:!0,visible:Ue.debugColors,children:vt.filter(c=>c.isEditable).map(c=>new ne(`Edit ${c.name} Theme`,{listener:()=>{No(c)}}))}),l=new T({stretch:!0,align:"left",spacing:8,children:[new q("Puzzle Display",{font:oe,fill:h.uiForegroundColorProperty}),new wt({xAlign:"left",yAlign:"top",xSpacing:20,ySpacing:8,columns:[[new I("Lines Visible",St),new I("Color Lines",Fo,{enabledProperty:St,layoutOptions:{leftMargin:20}}),new I("Face Colors Visible",xo),new I("Sectors Visible",Ke),new I("Sectors Next to Edges",Bo,{advanced:!0,enabledProperty:Ke,layoutOptions:{leftMargin:20}}),new I("Trivial Sectors",zo,{advanced:!0,enabledProperty:Ke,layoutOptions:{leftMargin:20}}),new I("Vertex State",bt),new I("All Vertex State",Ao,{advanced:!0,enabledProperty:bt,layoutOptions:{leftMargin:20}}),new I("Face State",Oo,{advanced:!0})],[new I("Possible Line Visible",Mo),new I("Impossible Line Visible",Et),new I("Vertices Visible",To),new I("Vertices Small",Ro),new I("Red X Visible",Ho),new I("Red X Aligned",Do)]]}),new O({spacing:20,visibleProperty:Y,children:[_("Line Join",qo,Vo.map(c=>({value:c,createNode:()=>new q(c,{font:Z,fill:h.uiForegroundColorProperty}),labelContent:c}))),_("Line Cap",Wo,Uo.map(c=>({value:c,createNode:()=>new q(c,{font:Z,fill:h.uiForegroundColorProperty}),labelContent:c}))),_("Vertex Style",Xo,Go.map(c=>({value:c,createNode:()=>new q(c,{font:Z,fill:h.uiForegroundColorProperty}),labelContent:c}))),_("Impossible Line Style",Jo,Yo.map(c=>({value:c,createNode:()=>new q(c,{font:Z,fill:h.uiForegroundColorProperty}),labelContent:c}))),_("Face Value Style",Ko,Zo.map(c=>({value:c,createNode:()=>new q(c,{font:Z,fill:h.uiForegroundColorProperty}),labelContent:c})))]})]}),s=_("Face Color Threshold",jo,[{value:1,createNode:()=>new M("Show All"),labelContent:"Show All"},{value:2,createNode:()=>new M("2+"),labelContent:"2+"},{value:3,createNode:()=>new M("3+"),labelContent:"3+"},{value:5,createNode:()=>new M("5+"),labelContent:"5+"},{value:10,createNode:()=>new M("10+"),labelContent:"10+"},{value:Number.POSITIVE_INFINITY,createNode:()=>new M("Only Outside"),labelContent:"Only Outside"}]),a=new T({spacing:8,align:"left",stretch:!0,children:[new V(Qe,"Auto-Solve"),new V(xn,"Add Lines",{layoutOptions:{leftMargin:20},enabledProperty:Qe}),new V(Bn,"Simple Loops",{layoutOptions:{leftMargin:20},enabledProperty:Qe}),new M("Highlights"),new V(zn,"Dim Completed Numbers",{layoutOptions:{leftMargin:20}}),new V(An,"Highlight Incorrect Numbers",{layoutOptions:{leftMargin:20}}),new V(st,"Highlight Incorrect Moves",{layoutOptions:{leftMargin:20}}),new V(On,"Highlight Intersecting Lines",{layoutOptions:{leftMargin:20}}),new V(new io(Mn,{bidirectional:!0,map:c=>c===$e.CYCLIC,inverseMap:c=>c?$e.CYCLIC:$e.TOGGLE}),"Cycle Between States"),new V(Ut,"Show View Style Controls"),new V(Et,"Show Impossible Lines"),new V(Wt,"Show Elapsed Time"),new V(ce,"Enable Sector View Styles"),new V(at,"Show Undo-All / Redo-All",{advanced:!0}),new V(pt,"Show Layout Test",{advanced:!0}),new V(Tn,"Solve Uses Built-In",{advanced:!0})]}),p=new ct(!1),i=he.and([Y,p]),d=ze.getIcons(),m=(c,P)=>new O({spacing:5,children:[new M(P),c]}),C=_("View Style",Ot,[{value:Mt,createNode:()=>m(d.classicIcon,"Classic"),labelContent:"Classic"},{value:Tt,createNode:()=>m(d.basicLinesIcon,"Lines"),labelContent:"Lines"},{value:Rt,createNode:()=>m(d.basicFaceColoringIcon,"Lines and Colors"),labelContent:"Lines and Colors"},{value:Ht,createNode:()=>m(d.pureFaceColoringIcon,"Colors"),labelContent:"Colors"},{value:Dt,createNode:()=>m(d.basicSectorsIcon,"Sectors"),labelContent:"Sectors",options:{visibleProperty:ce}},{value:Vt,createNode:()=>m(d.sectorsWithColorsIcon,"Sectors and Colors"),labelContent:"Sectors and Colors",options:{visibleProperty:ce}},{value:nt,createNode:()=>m(d.vertexStateIcon,"Vertex State"),labelContent:"Vertex State",options:{visibleProperty:Y}},{value:rt,createNode:()=>m(d.faceStateIcon,"Face State"),labelContent:"Face State",options:{visibleProperty:Y}},{value:qt,createNode:()=>m(d.customIcon,"Custom"),labelContent:"Custom",options:{visibleProperty:Y}}]),b=new V(p,"Show Custom Options",{advanced:!0}),w=new T({spacing:20,align:"left",children:[new O({spacing:20,children:[t,s]}),l],visibleProperty:i}),E=new ne("Reload to Defaults",{accessibleName:"Clear all settings/data, and reload the page",listener:()=>{localStorage.clear(),self.location.reload()},advanced:!0});E.addInputListener(e);const y=new L;super(new T({spacing:20,align:"left",stretch:!0,children:[a,y,new O({align:"top",spacing:30,children:[C,o,r]}),b,w,E,new V(Y,"Show Advanced Settings")]}),n)}}const Ft=new _o("canSolveDifficulty",Ne.EASY);function pr(u){return new Worker(""+new URL("assets/generationAdditiveConstrainedWorker-DdAY2rbA.js",import.meta.url).href,{name:u==null?void 0:u.name})}const hr=u=>{const n=Wn(u.board),e=Lt(n,u.cleanState),t=Lt(n,u.solvedState),o=new Set(u.blackEdges.map(r=>n.edges[r]));return{board:n,cleanState:e,solvedState:t,blackEdges:o}};let fe=null;const gr=new le(!1),Zt=()=>(fe||(fe=new pr,fe==null||fe.addEventListener("message",u=>{u.data.type==="generation-additive-constrained-worker-loaded"&&(gr.value=!0)})),fe);Zt();const fr=async(u,n,e,t,o,r)=>new Promise((l,s)=>{const a=Zt(),p=Math.random();a.postMessage({type:"generation-additive-constrained-request",id:p,board:Qn(u),canSolveDifficulty:n.name});const i=()=>{e.unlink(d),a.removeEventListener("message",m)},d=C=>{C&&(a.postMessage({type:"generation-additive-constrained-interrupt",id:p}),i(),l(null))},m=C=>{if(C.data.id===p)if(C.data.type==="generation-additive-constrained-response"){const b=C.data.solvedPuzzle?hr(C.data.solvedPuzzle):null;i(),l(b)}else C.data.type==="generation-additive-constrained-face-define"?t.emit(C.data.index,C.data.faceValue):C.data.type==="generation-additive-constrained-face-minimize"?o.emit(C.data.index,C.data.faceValue):C.data.type==="generation-additive-constrained-face-reset"&&r.emit()};e.lazyLink(d),a.addEventListener("message",m)});class wr extends O{constructor(n,e){const t=new Qo("polygonGeneratorProperty",{serialize:y=>y.name,deserialize:y=>Oe.find(c=>c.name===y)??Oe[0]}),o=localStorage.getItem("polygonGeneratorParameters")?JSON.parse(localStorage.getItem("polygonGeneratorParameters")):null;let r=!1;const l=_("Patterns",t,Oe.map(y=>({value:y,createNode:()=>new q(y.name,{font:Z,fill:h.uiForegroundColorProperty}),labelContent:y.name})),{layoutOptions:{align:"top",grow:0},justify:"top"}),s=new O({spacing:10,align:"center",layoutOptions:{grow:0},grow:1}),a=new O({spacing:10,align:"center",layoutOptions:{grow:0},children:[new M("Difficulty"),new jn(Ft,[{value:Ne.EASY,createNode:()=>new M("Easy"),labelContent:"Easy"},{value:Ne.MEDIUM,createNode:()=>new M("Medium"),labelContent:"Medium"},{value:Ne.HARD,createNode:()=>new M("Hard"),labelContent:"Hard"},{value:Ne.NO_LIMIT,createNode:()=>new M("No Limit"),labelContent:"No Limit"}],{orientation:"horizontal",align:"center",spacing:30})]}),p=new O({spacing:10,align:"center",justify:"spaceEvenly",layoutOptions:{grow:0}}),i=new L,d=new L,m=new ke;m.addListener(()=>{d.children=[]});const C=new L({children:[i,d]}),b=(y,c)=>{const P=y.generate(c),g=new A;P.forEach(S=>g.polygon(S)),i.children=[new D(g,{fill:h.puzzleBackgroundColorProperty,stroke:h.blackLineColorProperty,lineWidth:.05})],m.emit()};b(Oe[0],{width:5,height:5}),t.link(y=>{p.children.forEach(S=>S.dispose()),s.children.forEach(S=>S.dispose());const c={},P=S=>o&&!r&&S in o?o[S]:y.defaultParameterValues[S],g=()=>{localStorage.setItem("polygonGeneratorParameters",JSON.stringify(c)),b(y,c)};for(const[S,F]of Object.entries(y.parameters))if(F.type==="integer"){const B=new yt(P(S));B.link(f=>{c[S]=f,g()}),p.addChild(new Me(F.label,B,F.range,{layoutFunction:Me.createLayoutFunction4(),titleNodeOptions:{font:Z,fill:h.uiForegroundColorProperty},sliderOptions:{trackSize:new et(100,5),labelTagName:"label",keyboardStep:1,labelContent:F.label},arrowButtonOptions:{touchAreaXDilation:5,touchAreaYDilation:25},numberDisplayOptions:{decimalPlaces:0},delta:1,visibleProperty:F.advanced?Y:null}))}else if(F.type==="float"){const B=new yt(P(S));B.link(f=>{c[S]=f,g()}),p.addChild(new Me(F.label,B,F.range,{layoutFunction:Me.createLayoutFunction4(),titleNodeOptions:{font:Z,fill:h.uiForegroundColorProperty},sliderOptions:{trackSize:new et(100,5),labelTagName:"label",keyboardStep:.1,labelContent:F.label},numberDisplayOptions:{decimalPlaces:2},delta:.01,visibleProperty:F.advanced?Y:null}))}else if(F.type==="boolean"){const B=new ct(P(S));B.link(f=>{c[S]=f,g()}),p.addChild(new I(F.label,B,{advanced:F.advanced}))}else if(F.type==="choice"){const B=new lt(P(S));B.link(f=>{c[S]=f,g()}),p.addChild(_(F.label,B,F.choices.map(f=>({value:f.value,createNode:()=>new q(f.label,{font:Z,fill:h.uiForegroundColorProperty}),labelContent:f.label}))))}r=!0,s.addChild(new ne("Generate",{font:je,layoutOptions:{align:"center"},listener:async()=>{m.emit();const S=y.generate(c),F=vo.get(y,c),B=new le(!1),f=()=>{B.value=!0};m.addListener(f);const v=new ke,Q=new ke,ee=new ke;ee.addListener(()=>{d.children=[]}),v.addListener((G,re)=>{d.addChild(new D(A.polygon(S[G]),{fill:h.generateAddedFaceColorProperty,stroke:h.blackLineColorProperty,lineWidth:.05})),re!==null&&d.addChild(new q(`${re}`,{font:je,fill:h.faceValueColorProperty,maxWidth:.9,maxHeight:.9,center:ve(S[G])}))}),Q.addListener((G,re)=>{d.addChild(new D(A.polygon(S[G]),{fill:h.generateMinimizedFaceColorProperty,stroke:h.blackLineColorProperty,lineWidth:.05})),re!==null&&d.addChild(new q(`${re}`,{font:je,fill:h.faceValueColorProperty,maxWidth:.9,maxHeight:.9,center:ve(S[G])}))});const K=await fr(F,Ft.value,B,v,Q,ee);K&&(d.children=[],E.loadPuzzle(pe.fromSolvedPuzzle(K))),m.hasListener(f)&&m.removeListener(f)}}))});const w=new H({fill:h.playAreaBackgroundColorProperty,sizable:!0,layoutOptions:{grow:1},children:[C]});We.multilink([w.localPreferredWidthProperty,w.localPreferredHeightProperty,C.localBoundsProperty],(y,c,P)=>{if(y!==null&&c!==null&&P.isFinite()){const S=y-30,F=c-2*15,B=Math.min(S/P.width,F/P.height);B>0&&(C.setScaleMagnitude(B),C.centerX=y/2,C.centerY=c/2)}});const E=j()({spacing:10,stretch:!0,children:[l,new T({spacing:10,stretch:!0,layoutOptions:{grow:1},children:[w,s,new tt,a,new tt,p]})]},e);super(E)}}const yr="#444",mr="#fa0",Cr="#888",Pr="#fff",vr="#f00",Sr="#ff0",br="#ff0",Er="#0f0",Lr="#0ff",kr="#0af",Ir="#f0f";class Nr extends xe{constructor(e){const t=new O({children:[new q("Loading image...",{font:Z,fill:h.uiForegroundColorProperty})]}),o=new L({children:[t]});super(o,e);x(this,"scanContentNode");x(this,"imageContainer");x(this,"solutionContainer");x(this,"blackImageLayer");x(this,"originalImageLayer");x(this,"thresholdImageLayer");x(this,"contourLayer");x(this,"puzzle",null);x(this,"rootContour",null);x(this,"contours",[]);x(this,"contourNodeMap",new Map);this.scanContentNode=o,this.blackImageLayer=new L,this.originalImageLayer=new L({visible:!1}),this.thresholdImageLayer=new L({visible:!1}),this.contourLayer=new L,this.imageContainer=new L({children:[this.blackImageLayer,this.originalImageLayer,this.thresholdImageLayer,this.contourLayer]}),this.solutionContainer=new L}getScanOptions(){return{originalImageCallback:e=>this.onOriginalImage(e),thresholdedImageCallback:e=>this.onThresholdedImage(e),rootContourCallback:e=>this.onRootContour(e),widestSubtreeCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeWidestContour()},dotContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeDotContour()},lineContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeLineContour()},zeroOuterContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeZeroOuterContour()},zeroInnerContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeZeroInnerContour()},oneContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeOneContour()},twoContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeTwoContour()},threeContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeThreeContour()},xContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeXContour()},unknownContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeUnknownContour()},debugImageCallback:e=>{},puzzleCallback:e=>this.onPuzzle(e),solutionsCallback:e=>this.onSolutions(e)}}onOriginalImage(e){this.originalImageLayer.addChild(new mt(e)),this.blackImageLayer.addChild(H.bounds(this.originalImageLayer.bounds,{fill:"black"})),this.scanContentNode.children=[new T({spacing:10,children:[this.imageContainer,this.solutionContainer]})]}onThresholdedImage(e){this.thresholdImageLayer.addChild(new mt(e))}onRootContour(e){this.rootContour=e,this.contours=e.getDescendantContours();for(const t of this.contours){const o=new Fr(t);this.contourNodeMap.set(t,o),this.contourLayer.addChild(o)}}onPuzzle(e){this.puzzle=e}onSolutions(e){if(e.length===1)this.hide();else{const t=this.puzzle;k()&&N(t);const o=t.board;if(e.length===0){Ie(o,t.stateProperty.value);const r=new me(t,{scale:20});this.solutionContainer.children=[new T({spacing:10,children:[new M("No Solutions Found"),r]})]}else{const r=new pe(o,t.stateProperty.value.clone()),l=new pe(o,t.stateProperty.value.clone()),s=new pe(o,t.stateProperty.value.clone());e[0].forEach(d=>r.stateProperty.value.setEdgeState(d,Ee.BLACK)),e[1].forEach(d=>l.stateProperty.value.setEdgeState(d,Ee.BLACK)),o.edges.forEach(d=>{r.stateProperty.value.getEdgeState(d)!==l.stateProperty.value.getEdgeState(d)&&s.stateProperty.value.setEdgeState(d,Ee.BLACK)}),Ie(o,r.stateProperty.value),Ie(o,l.stateProperty.value),Ie(o,s.stateProperty.value);const a=new me(r,{scale:10}),p=new me(l,{scale:10}),i=new me(s,{scale:10});this.solutionContainer.children=[new T({spacing:10,children:[new M("Multiple Solutions Found"),new O({spacing:10,children:[new T({spacing:10,children:[a,new M("Solution A")]}),new T({spacing:10,children:[p,new M("Solution B")]}),new T({spacing:10,children:[i,new M("Difference")]})]})]})]}}}}class Fr extends L{constructor(e){const t=new D(e.shape,{stroke:yr});super({children:[t]});x(this,"path");this.contour=e,this.path=t}makeWidestContour(){this.path.stroke=mr}makeDotContour(){this.path.stroke=Cr}makeLineContour(){this.path.stroke=Pr}makeXContour(){this.path.stroke=vr}makeZeroOuterContour(){this.path.stroke=Sr}makeZeroInnerContour(){this.path.stroke=br}makeOneContour(){this.path.stroke=Er}makeTwoContour(){this.path.stroke=Lr}makeThreeContour(){this.path.stroke=kr}makeUnknownContour(){this.path.stroke=Ir}}class xr extends xe{constructor(n,e){super(new T({spacing:20,align:"left",stretch:!0,children:[new L({children:[new wr(n,{loadPuzzle:t=>{this.hide(),e.loadPuzzle(t)},preferredWidth:700,preferredHeight:300})]}),new tt,new O({spacing:15,grow:1,children:[new ne("Load String",{listener:()=>{this.hide();const t=prompt("Enter puzzle string");t&&e.loadPuzzle(pe.loadDeprecatedScalaString(t))}}),new ne("Load Image (Rectangular Only)",{listener:()=>{this.hide();const t=document.createElement("input");t.type="file",t.onchange=o=>{const r=o.target.files[0];var l=new FileReader;l.readAsDataURL(r),l.onloadend=async()=>{const s=l.result,a=new Nr(n);a.show();const p=await ao(s,a.getScanOptions());e.loadPuzzle(p)}},t.click()}})]})]}),n)}}class Br extends se{constructor(n){const e=j()({advanced:!1,baseColor:h.uiButtonBaseColorProperty,xMargin:5,yMargin:5,buttonAppearanceStrategy:de},n);e.advanced&&(e.visibleProperty=Y),super(e)}}class zr{constructor(n,e,t,o){x(this,"maxLineWidth");x(this,"disposeFlatAppearanceStrategy");const r=new Ct(t,{luminanceFactor:-.3}),l=new Ct(t,{luminanceFactor:-.6}),s=r,a=l,p=W({stroke:l},o),i=1.5;n.stroke=p.stroke||l,n.lineWidth=i,this.maxLineWidth=1.5,n.cachedPaints=[t,s,a];function d(m){let C=1,b=1;switch(m){case be.IDLE:n.fill=t,n.stroke=r,C=.3;break;case be.OVER:n.fill=t,n.stroke=r,C=.5;break;case be.PRESSED:n.fill=t,n.stroke=h.uiButtonSelectedStrokeColorProperty,b=1.5;break;default:throw new Error(`unsupported interactionState: ${m}`)}n.opacity=C,n.lineWidth=b}e.link(d),this.disposeFlatAppearanceStrategy=()=>{e.hasListener(d)&&e.unlink(d),r.dispose(),l.dispose()}}dispose(){this.disposeFlatAppearanceStrategy()}}class Ar{constructor(n,e,t){x(this,"dispose");function o(r){let l=1;switch(r){case be.IDLE:l=.6;break;case be.OVER:break;case be.PRESSED:break;default:throw new Error(`unsupported interactionState: ${r}`)}n.opacity=l}e.link(o),this.dispose=()=>{e.hasListener(o)&&e.unlink(o)}}}class Ge extends O{constructor(n){const e=new Be(n),t=S=>new L({scale:1.3,children:[S]}),{edgeIcon:o,edgeReversedIcon:r,faceColorInsideIcon:l,faceColorOutsideIcon:s,faceColorMatchIcon:a,faceColorOppositeIcon:p,sectorIcon:i,eraserIcon:d,panIcon:m,dragIcon:C}=Ge.getIcons(),b=new Jt(Rn,[{value:X.EDGE_STATE,labelContent:"Edge Edit Mode",createNode:()=>t(o),options:{visibleProperty:X.EDGE_STATE.isEnabledProperty}},{value:X.EDGE_STATE_REVERSED,labelContent:"Edge Reversed Edit Mode",createNode:()=>t(r),options:{visibleProperty:X.EDGE_STATE_REVERSED.isEnabledProperty}},{value:X.FACE_COLOR_INSIDE,labelContent:"Face Color Inside Edit Mode",createNode:()=>t(l),options:{visibleProperty:X.FACE_COLOR_INSIDE.isEnabledProperty}},{value:X.FACE_COLOR_OUTSIDE,labelContent:"Face Color Outside Edit Mode",createNode:()=>t(s),options:{visibleProperty:X.FACE_COLOR_OUTSIDE.isEnabledProperty}},{value:X.FACE_COLOR_MATCH,labelContent:"Face Color Match Edit Mode",createNode:()=>t(a),options:{visibleProperty:X.FACE_COLOR_MATCH.isEnabledProperty}},{value:X.FACE_COLOR_OPPOSITE,labelContent:"Face Color Opposite Edit Mode",createNode:()=>t(p),options:{visibleProperty:X.FACE_COLOR_OPPOSITE.isEnabledProperty}},{value:X.SECTOR_STATE,labelContent:"Sector Edit Mode",createNode:()=>t(i),options:{visibleProperty:X.SECTOR_STATE.isEnabledProperty}}],{spacing:15,layoutOptions:{grow:1}});b.children.forEach(S=>S.addInputListener(e));const w={buttonAppearanceStrategy:de,baseColor:h.uiButtonBaseColorProperty,disabledColor:h.uiButtonDisabledColorProperty,mouseAreaXDilation:5,mouseAreaYDilation:5,touchAreaXDilation:5,touchAreaYDilation:5},E=new Kn(dt,W({},w,{accessibleName:"Eraser Mode (Toggle)",content:t(d),buttonAppearanceStrategy:zr,contentAppearanceStrategy:Ar}));E.addInputListener(e);const y=t(m),c=t(C),P=new L;Ce.link(S=>{P.children=[S===ie.PAN_ONLY?y:c]});const g=new Br({content:P,listener:()=>{Ce.value=Ce.value===ie.PAN_ONLY?ie.DRAG_ONLY:ie.PAN_ONLY}});Ce.link(S=>{g.accessibleName=S===ie.PAN_ONLY?"Pan Mode (toggle)":"Drag Input Mode (toggle)"}),g.addInputListener(e),super({spacing:13,stretch:!0,children:[b,new lo,E,g]}),n.layoutBoundsProperty.link(S=>{this.maxWidth=Math.max(1,S.width-2*Se)})}static getIcons(){const n=new Pt(0,0,15,0,{stroke:h.uiButtonForegroundProperty,lineWidth:4,lineCap:"round"}),e=6,t=new A().moveTo(-e,-e).lineTo(e,e).moveTo(-e,e).lineTo(e,-e),o=new D(t,{stroke:h.uiButtonForegroundProperty,lineWidth:2}),r=new L({children:[new H(0,0,14,14,{stroke:h.uiButtonForegroundProperty,fill:h.uiButtonFaceOutsideColorProperty})]}),l=new L({children:[new H(0,0,14,14,{stroke:h.uiButtonForegroundProperty,fill:h.uiButtonFaceInsideColorProperty})]}),s=new L({children:[new H(0,0,7,7,{stroke:h.uiButtonForegroundProperty,fill:h.uiForegroundColorProperty}),new H(7,7,7,7,{stroke:h.uiButtonForegroundProperty,fill:h.uiForegroundColorProperty})]}),a=new L({children:[new H(0,0,7,7,{stroke:h.uiButtonForegroundProperty,fill:h.uiForegroundColorProperty}),new H(7,7,7,7,{stroke:h.uiButtonForegroundProperty,fill:h.uiBackgroundColorProperty})]}),p=new L({children:[new D(new A().moveTo(0,14).lineTo(0,0).lineTo(14,0),{stroke:h.uiButtonForegroundProperty}),new D(new A().arc(0,0,7,0,Math.PI/2,!1),{stroke:h.uiButtonForegroundProperty})]}),i=17,d=6,m=7,C=2,b=m/Math.sqrt(2),w=new L({children:[new L({rotation:-Math.PI/4,children:[new H(0,0,i,m,{stroke:h.uiButtonForegroundProperty,fill:h.uiButtonInvertedForegroundProperty,cornerRadius:C}),new H(d,0,i-d,m,{fill:h.uiButtonForegroundProperty,cornerRadius:C})]}),new Pt(b,b-.5,b+12,b-.5,{stroke:h.uiButtonForegroundProperty,lineDash:[5,1,3,1,2]})]}),E=new D(cr.transformed(De.rotationZ(Math.PI/4)),{fill:h.uiButtonForegroundProperty,maxWidth:14,maxHeight:14}),y=new L({children:[new D(Yt,{fill:h.uiButtonForegroundProperty,matrix:De.Y_REFLECTION,maxWidth:14,maxHeight:14}),new D(new A().moveTo(0,1.5).lineTo(12,1.5),{stroke:h.uiButtonForegroundProperty,lineDash:[9,1,2]})]}),c=new Bt;return{edgeIcon:c.createBox(n),edgeReversedIcon:c.createBox(o),faceColorInsideIcon:c.createBox(l),faceColorOutsideIcon:c.createBox(r),faceColorMatchIcon:c.createBox(s),faceColorOppositeIcon:c.createBox(a),sectorIcon:c.createBox(p),eraserIcon:c.createBox(w),panIcon:c.createBox(E),dragIcon:c.createBox(y)}}}class Or extends xe{constructor(n){self.phet.chipper.isFuzzEnabled=()=>!1;const e=Ge.getIcons(),t=ze.getIcons(),o=l=>new L({children:[H.bounds(l.bounds.dilated(3),{fill:h.uiButtonBaseColorProperty,stroke:h.uiButtonSelectedStrokeColorProperty,cornerRadius:3}),l]}),r=650;super(new T({spacing:10,align:"left",children:[new z("Slitherlink",{font:oe}),new z("Slitherlink is a logic puzzle where you draw a <strong>single continuous loop</strong> on a grid. The goal is to connect dots without crossing or overlapping, creating a loop that adheres to specific rules based on the numbers in some cells.",{lineWrap:r}),new T({spacing:2,align:"left",children:[new z("The loop must satisfy the following rules:"),new z("The loop cannot cross or touch itself.",{layoutOptions:{leftMargin:20}}),new z("Each numbered cell must have exactly that number of sides in the loop.",{layoutOptions:{leftMargin:20}})]}),new z("Solving",{font:oe}),new z('<a href="{{solvingGuide}}">See the Solving Guide</a>',{font:$o,links:{solvingGuide:"./"},layoutOptions:{align:"center"}}),new z("Edit Modes",{font:oe}),new T({spacing:5,align:"left",children:[new z('<node id="edge" align="center"/> + click/tap adds a line, <node id="x" align="center"/> marks where lines are impossible',{lineWrap:r,nodes:{edge:o(e.edgeIcon),x:o(e.edgeReversedIcon)}}),new z('<node id="inside" align="center"/> + click/tap marks with the inside color, <node id="outside" align="center"/> marks with the outside color',{lineWrap:r,nodes:{inside:o(e.faceColorInsideIcon),outside:o(e.faceColorOutsideIcon)}}),new z('<node id="same" align="center"/> + click/tap on 1st cell + click/tap on 2nd to match colors, <node id="opposite" align="center"/> marks opposite colors',{lineWrap:r,nodes:{same:o(e.faceColorMatchIcon),opposite:o(e.faceColorOppositeIcon)}}),new O({spacing:10,children:[o(e.sectorIcon),new z(" + click/tap to pop up a selector, then select the sector color (see solving guide)")],visibleProperty:ce})]}),new z("The number keys (1-9) can switch between edit modes. E will activate the eraser when pressed."),new z("The line/X and inside/outside color controls will cycle through the states (e.g. blank => line => X => blank) by default, but can be changed to toggle (e.g. blank => line, line => blank, X => line) in settings.",{lineWrap:r}),new z("Modifiers",{font:oe}),new z(`With erase (<node id="erase" align="center"/>) toggled on, edit modes will instead erase lines/X's/colors.`,{lineWrap:r,nodes:{erase:o(e.eraserIcon)}}),new z('Pan mode (<node id="pan" align="center"/>) will treat dragging as panning the view, while drag-edit mode (<node id="drag" align="center"/>) will allow setting the state of many lines/cells with one dragged press.',{lineWrap:r,nodes:{pan:o(e.panIcon),drag:o(e.dragIcon)}}),new z('Right-click or shift-click will activate the "opposite" mode (e.g. in line mode, shift-click will set an X). This will work for <node id="edge" align="center"/> / <node id="x" align="center"/>, <node id="inside" align="center"/> / <node id="outside" align="center"/>, and the final click for <node id="same" align="center"/> / <node id="opposite" align="center"/>.',{lineWrap:r,nodes:{edge:o(e.edgeIcon),x:o(e.edgeReversedIcon),inside:o(e.faceColorInsideIcon),outside:o(e.faceColorOutsideIcon),same:o(e.faceColorMatchIcon),opposite:o(e.faceColorOppositeIcon)}}),new z("View Styles",{font:oe}),new T({spacing:5,align:"left",children:[new O({spacing:10,children:[o(t.classicIcon),new z("Classic Slitherlink style, just lines/X's.")]}),new O({spacing:10,children:[o(t.basicLinesIcon),new z(`Cleaner lines (missing lines are X's, thin lines are "blank"), inside/outside colors`)]}),new O({spacing:10,children:[o(t.basicFaceColoringIcon),new z("Cleaner with face coloring (lighter/darker color pairs are inside/outside or outside/inside)")]}),new O({spacing:10,children:[o(t.pureFaceColoringIcon),new z("Similar to above, but without showing lines at all")]}),new O({spacing:10,children:[o(t.basicSectorsIcon),new z("Cleaner lines, with sectors (see the solving guide)")],visibleProperty:ce}),new O({spacing:10,children:[o(t.sectorsWithColorsIcon),new z("Cleaner lines with colors and sectors (see the solving guide)")],visibleProperty:ce})]}),new z("About / Contact",{font:oe}),new z('My name is Jonathan Olson, and I created this Slitherlink interface to explore the limits of solving techniques and to provide a seamless experience on both desktop and mobile. I value your feedback and would love to hear any questions, comments, or suggestions. Please reach out to me at <a href="{{email}}">jonathan.olson@colorado.edu</a>.',{lineWrap:r,links:{email:"mailto:jonathan.olson@colorado.edu"}})]}),n)}}class Mr extends xe{constructor(e){const t=new ct(!1),o=new ne("Copy URL",{accessibleName:"Copy Shareable URL to Clipboard",listener:()=>{if(this.puzzle){const r=location.protocol+"//"+location.host+location.pathname;let l=this.puzzle;this.includeStateProperty.value||(l=new pe(l.board,Xt.fromFaceValueData(l.board,l.stateProperty.value)));const s=Hn(l);en(r+"?p="+encodeURIComponent(s))}}});o.addInputListener(new Be(e));super(new T({spacing:20,align:"left",stretch:!0,children:[o,new I("Include Solve Progress",t)]}),e);x(this,"includeStateProperty");x(this,"puzzle",null);this.includeStateProperty=t}setPuzzle(e){this.puzzle=e}reset(){super.reset(),this.includeStateProperty.reset()}}class Tr extends q{constructor(n,e){const t=j()({font:tn,fill:h.timerColorProperty},e),o=60,r=60*o,l=24*r,s=new he([n],a=>{a=Math.ceil(a);const p=Math.floor(a/l);a-=p*l;const i=Math.floor(a/r);a-=i*r;const d=Math.floor(a/o);a-=d*o;const m=a,C=i<10?`0${i}`:`${i}`,b=d<10?`0${d}`:`${d}`,w=m<10?`0${m}`:`${m}`;return p?`${p}d ${C}:${b}:${w}`:i?`${C}:${b}:${w}`:`${b}:${w}`});super(s,t),this.timerProperty=n,this.disposeEmitter.addListener(()=>{s.dispose()})}}class Rr extends O{constructor(n,e,t){const o=new Be(e),r=new A("M37.75,20.25 C38.6681734,20.25 39.4211923,20.9571103 39.4941988,21.8564728 L39.5,22 L39.5,36.25 C39.5,39.3517853 37.0439828,41.879937 33.9705557,41.9958479 L33.75,42 L14.25,42 C11.1482147,42 8.62006299,39.5439828 8.50415208,36.4705557 L8.5,36.25 L8.5,22 C8.5,21.0335017 9.28350169,20.25 10.25,20.25 C11.1681734,20.25 11.9211923,20.9571103 11.9941988,21.8564728 L12,22 L12,36.25 C12,37.440864 12.9251616,38.4156449 14.0959512,38.4948092 L14.25,38.5 L33.75,38.5 C34.940864,38.5 35.9156449,37.5748384 35.9948092,36.4040488 L36,36.25 L36,22 C36,21.0335017 36.7835017,20.25 37.75,20.25 Z M23.4989075,6.26787884 L23.6477793,6.25297693 L23.6477793,6.25297693 L23.8225053,6.25140103 L23.8225053,6.25140103 L23.9770074,6.26441014 L23.9770074,6.26441014 L24.1549097,6.29667263 L24.1549097,6.29667263 L24.223898,6.31492315 L24.223898,6.31492315 C24.4192207,6.36884271 24.6069182,6.4577966 24.7773762,6.58126437 L24.8968901,6.67628678 L24.8968901,6.67628678 L24.989825,6.76256313 L32.7679996,14.5407377 C33.4514171,15.2241552 33.4514171,16.3321939 32.7679996,17.0156115 C32.1247831,17.6588279 31.1054316,17.6966642 30.4179639,17.1291203 L30.2931259,17.0156115 L25.5,12.222 L25.5,31.5 C25.5,32.4181734 24.7928897,33.1711923 23.8935272,33.2441988 L23.75,33.25 C22.8318266,33.25 22.0788077,32.5428897 22.0058012,31.6435272 L22,31.5 L22,12.226 L17.2116504,17.0156115 C16.5684339,17.6588279 15.5490824,17.6966642 14.8616148,17.1291203 L14.7367767,17.0156115 C14.0935602,16.372395 14.055724,15.3530435 14.6232679,14.6655758 L14.7367767,14.5407377 L22.488804,6.78678454 C22.5446792,6.72871358 22.6045271,6.67449255 22.6679103,6.62455868 L22.7812362,6.54379243 L22.7812362,6.54379243 C22.8189499,6.51724 22.858413,6.49312256 22.8988638,6.47056335 L22.9176605,6.46138558 C23.0947495,6.36422067 23.2909216,6.29776289 23.4989075,6.26787884 Z"),l=new le(!1),s=new le(0),a=new le(ue.NOT_FOUND),p=new we(n,{derive:g=>g?g.undoPossibleProperty:l}),i=new we(n,{derive:g=>g?g.redoPossibleProperty:l}),d=new we(n,{derive:g=>g?g.isSolvedProperty:l}),m=new we(n,{derive:g=>g?g.timeElapsedProperty:s}),C=new we(n,{derive:g=>g?g.hintStateProperty:a}),b=new he([d],g=>!g);let w=null,E=null,y=null,c=null;const P={buttonAppearanceStrategy:de,baseColor:h.uiButtonBaseColorProperty,disabledColor:h.uiButtonDisabledColorProperty,xMargin:8*1.3,yMargin:5*1.3,mouseAreaXDilation:5,mouseAreaYDilation:5,touchAreaXDilation:5,touchAreaYDilation:5};super({spacing:10,stretch:!0,children:[new He("New",W({},P,{accessibleName:"New",listener:()=>{w=w||new xr(e,{loadPuzzle:t.loadPuzzle}),w.show()},textFill:h.uiButtonForegroundProperty,baseColor:h.uiButtonBaseColorProperty,xMargin:5,yMargin:5,font:_e,buttonAppearanceStrategy:de})),new se(W({},P,{accessibleName:"Undo All",content:ae(ar),listener:()=>{n.value&&n.value.onUserUndoAll()},enabledProperty:p,visibleProperty:at})),new se(W({},P,{accessibleName:"Undo",content:ae(rr),listener:()=>{n.value&&n.value.onUserUndo()},enabledProperty:p,fireOnHold:!0})),new Tr(m,{visibleProperty:Wt}),new se(W({},P,{accessibleName:"Redo",content:ae(sr),listener:()=>{n.value&&n.value.onUserRedo()},enabledProperty:i,fireOnHold:!0})),new se(W({},P,{accessibleName:"Redo All",content:ae(ir),listener:()=>{n.value&&n.value.onUserRedoAll()},enabledProperty:i,visibleProperty:at})),new se(W({},P,{accessibleName:"Settings",content:ae(nr),listener:()=>{y=y||new ur(e),y.show()}})),new se(W({},P,{accessibleName:"Share",content:ae(r),listener:()=>{const g=n.value;g&&(E=E||new Mr(e),E.setPuzzle(g.puzzle),E.show())}})),new He("Solve",W({},P,{accessibleName:"Solve",listener:()=>{n.value&&n.value.onUserRequestSolve()},enabledProperty:b,textFill:h.uiButtonForegroundProperty,baseColor:h.uiButtonBaseColorProperty,xMargin:5,yMargin:5,font:_e,buttonAppearanceStrategy:de})),new He("Hint",W({},P,{accessibleName:"Hint",listener:()=>{n.value&&n.value.onUserRequestHint()},enabledProperty:new he([b,C],(g,S)=>g&&S===ue.DEFAULT),textFill:h.uiButtonForegroundProperty,baseColor:h.uiButtonBaseColorProperty,xMargin:5,yMargin:5,font:_e,buttonAppearanceStrategy:de})),new se(W({},P,{accessibleName:"Help",content:ae(lr),listener:()=>{c=c||new Or(e),c.show()}}))]}),this.puzzleModelProperty=n,this.children.forEach(g=>g.addInputListener(o)),e.layoutBoundsProperty.link(g=>{this.maxWidth=Math.max(1,g.width-2*Se)})}}const Hr=h.uiForegroundColorProperty,Dr=new he([h.uiForegroundColorProperty],u=>u.withAlpha(.15));class Vr extends L{constructor(n,e,t,o){super({});const r=new _n({diameter:20,activeColor:Hr,inactiveColor:Dr});this.disposeEmitter.addListener(()=>r.dispose());const l={xMargin:5,yMargin:5,fill:h.uiBackgroundColorProperty,stroke:h.uiForegroundColorProperty},s=new Fe(new O({spacing:10,children:[new L({children:[r]}),new M("Loading Hint Solver...")]}),l),a=new O({spacing:10,children:[new Fe(new O({spacing:10,children:[new L({children:[r]}),new M("Searching for Hint...")]}),l),new ne("Cancel",{listener:o})]}),p=new O({spacing:10,children:[new ne("Apply Hint",{listener:t}),new ne("Hide Hint",{listener:o})]}),i=new Fe(new M("No Hint Found"),l);i.pickable=!1;const d=C=>{this.children=[...C===ue.LOADING?[s]:[],...C===ue.SEARCHING?[a]:[],...C===ue.FOUND?[p]:[],...C===ue.NOT_FOUND?[i]:[]]};e.link(d),this.disposeEmitter.addListener(()=>e.unlink(d));const m=C=>{r.step(C)};n.stepEmitter.addListener(m),this.disposeEmitter.addListener(()=>n.stepEmitter.removeListener(m))}}class qr extends L{constructor(n,e){const t=[],o=[],r=p=>{const i=p.getStrokedShape(new So({lineWidth:.3,lineCap:"round",lineJoin:"round"}));t.push(...i.subpaths)},l=p=>{const i=p.getOffsetShape(-.1);o.push(...i.subpaths)},s=p=>{r(new A().moveToPoint(p.start.viewCoordinates).lineToPoint(p.end.viewCoordinates))},a=p=>{p.edges.every(i=>!e.incorrectEdges.has(i))&&l(A.polygon(p.vertices.map(i=>i.viewCoordinates)))};e.incorrectEdges.forEach(s),e.incorrectFaces.forEach(a),super({children:[new D(new A(t),{fill:h.incorrectEdgeColorProperty}),new D(new A(o),{fill:h.incorrectFaceColorProperty})],pickable:!1,filters:[new co(.1)]})}}class Ur extends L{constructor(e,t){const o=j()({focusNodeCallback:()=>{}},t),r=new me(e.puzzle,{edgePressListener:(i,d)=>e.onUserEdgePress(i,d),onEdgeDragStart:(i,d)=>e.onUserEdgeDragStart(i,d),onEdgeDrag:(i,d)=>e.onUserEdgeDrag(i,d),onEdgeDragEnd:()=>e.onUserEdgeDragEnd(),facePressListener:(i,d)=>e.onUserFacePress(i,d),onFaceDragStart:(i,d)=>e.onUserFaceDragStart(i,d),onFaceDrag:(i,d)=>e.onUserFaceDrag(i,d),onFaceDragEnd:()=>e.onUserFaceDragEnd(),sectorPressListener:(i,d)=>e.onUserSectorPress(i,d),sectorSetListener:(i,d)=>e.onUserSectorSet(i,d),selectedFaceColorHighlightProperty:e.selectedFaceColorHighlightProperty,selectedSectorEditProperty:e.selectedSectorEditProperty,style:e.style,delayEdgeInteractionEmitter:e.edgeAutoSolvedEmitter}),l=new L;super(W({children:[r,l]},o));x(this,"puzzleNode");this.puzzleModel=e,this.puzzleNode=r,this.disposeEmitter.addListener(()=>r.dispose());let s=null;const a=i=>{if(r.clearAnnotationNodes(),s&&(s.dispose(),s=null),i){const d=new $n(e.puzzle.board,i,e.style,r.getBackgroundBounds());r.addAnnotationNode(d),s=d,o.focusNodeCallback(d)}};this.disposeEmitter.addListener(()=>{s&&(s.dispose(),s=null)}),e.displayedAnnotationProperty.link(a),this.disposeEmitter.addListener(()=>e.displayedAnnotationProperty.unlink(a));const p=We.multilink([st,e.correctnessStateProperty],(i,d)=>{const m=()=>{l.children.forEach(C=>C.dispose())};i&&!d.isCorrect()?setTimeout(()=>{if(st.value&&d===e.correctnessStateProperty.value){const C=new qr(e.puzzle.board,d);m(),l.children=[C],console.log("showing error")}},Math.ceil(Dn.value*1e3)):m()});this.disposeEmitter.addListener(()=>p.dispose())}}class U{constructor(n,e){this.layoutPuzzle=n,this.derivatives=e}plus(n){const e=new Map;return this.derivatives.forEach((t,o)=>{e.set(o,t.plus(n.derivatives.get(o)))}),new U(this.layoutPuzzle,e)}minus(n){const e=new Map;return this.derivatives.forEach((t,o)=>{e.set(o,t.minus(n.derivatives.get(o)))}),new U(this.layoutPuzzle,e)}timesScalar(n){const e=new Map;return this.derivatives.forEach((t,o)=>{e.set(o,t.timesScalar(n))}),new U(this.layoutPuzzle,e)}getMaxMagnitude(){let n=0;return this.derivatives.forEach(e=>{n=Math.max(n,e.getMagnitude())}),n}getAreaCorrectedDerivative(){let n=this;for(let e=0;e<5;e++)n=n.getAreaCorrectedDerivativeOnce();return n}getAreaCorrectedDerivativeOnce(){return this.plus(U.getAreaScaledDeltas(this.layoutPuzzle,-this.getAreaDerivative()/this.layoutPuzzle.getSignedArea()))}getAreaDerivative(){let n=0;return this.layoutPuzzle.faces.forEach(e=>{n+=bo(e.vertices.map(t=>t.viewCoordinates),e.vertices.map(t=>this.derivatives.get(t)))}),n}static getAreaScaledDeltas(n,e){const t=n.getCentroid(),o=new Map;return n.vertices.forEach(r=>{const l=r.viewCoordinates.minus(t).timesScalar(e);k()&&N(l.isFinite()),o.set(r,l)}),new U(n,o)}static getHookesAttraction(n,e,t){const o=new Map;return n.vertices.forEach(r=>{o.set(r,te.ZERO.copy())}),n.edges.forEach(r=>{const l=r.start.viewCoordinates,a=r.end.viewCoordinates.minus(l),p=a.getMagnitude(),i=a.timesScalar((p-e)*t/p);k()&&N(i.isFinite()),o.get(r.start).add(i),o.get(r.end).subtract(i)}),new U(n,o)}static getRegularPolygonDeltas(n,e,t,o){const r=new Map;n.vertices.forEach(s=>{r.set(s,te.ZERO.copy())});const l=s=>e/(2*Math.sin(Math.PI/s));return n.faces.forEach(s=>{if(s.vertices.length<3)return;const a=.2,p=.3,i=s.vertices.map(g=>g.viewCoordinates);let d=0;const m=ot(i);m<0?d=1:m<a&&(d=Math.max(d,(a-m)/a));for(let g=0;g<i.length&&!(d>=1);g++){const S=g,F=(g+1)%i.length,B=i[S],f=i[F];for(let v=g+2;v<i.length-(g===0?1:0)&&!(d>=1);v++){const Q=v%i.length,ee=(v+1)%i.length,K=i[Q],G=i[ee];if(ge.lineSegmentIntersection(B.x,B.y,f.x,f.y,K.x,K.y,G.x,G.y))k()&&N(i.length>=4),d=1;else{const re=Math.min(ge.distToSegment(B,K,G),ge.distToSegment(f,K,G),ge.distToSegment(K,B,f),ge.distToSegment(G,B,f));re<p&&(d=Math.max(d,(p-re)/p))}}}if(d===0&&t&&n.getFaceValue(s)===null)return;const C=ve(i);k()&&N(C.isFinite());const b=l(i.length),w=i.map(g=>g.minus(C)),E=i.map((g,S)=>te.createPolar(b,2*Math.PI*S/i.length)),y=U.getLeastSquares(w,E),c=o+(2-o)*d,P=i.map((g,S)=>y[S].minus(w[S]).timesScalar(c));s.vertices.forEach((g,S)=>{const F=P[S];k()&&N(F.isFinite()),r.get(g).add(F)})}),new U(n,r)}static getBarycentricDeltas(n){const e=new Map;return n.vertices.forEach(t=>{const o=t.edges.map(s=>s.getOtherVertex(t)),r=new te(0,0);o.forEach(s=>r.add(s.viewCoordinates)),r.multiplyScalar(1/o.length);const l=r.subtract(t.viewCoordinates);k()&&N(l.isFinite()),e.set(t,l)}),new U(n,e)}static getAngularDeltas(n,e){const t=new Map;return n.vertices.forEach(o=>{t.set(o,te.ZERO.copy())}),n.vertices.forEach(o=>{const r=o.edges.map(w=>w.getOtherVertex(o));let l=ye.sortBy(r,w=>w.viewCoordinates.minus(o.viewCoordinates).getAngle());if(l[0]!==r[0]){const w=l.indexOf(r[0]);l=[...l.slice(w),...l.slice(0,w)]}const s=ye.range(0,r.length).every(w=>l[w]===r[w]),a=r.map(w=>w.viewCoordinates.minus(o.viewCoordinates).normalized()),p=U.getUnitLeastSquares(a),i=Math.max(...ye.range(0,r.length).map(w=>p[w].dot(p[(w+1)%r.length]))),d=Math.max(...ye.range(0,r.length).map(w=>a[w].dot(a[(w+1)%r.length]))),m=(w,E)=>E<=.5?.5*Math.pow(2*E,w):1-m(w,1-E),C=s?ge.linear(i,1,0,1,d):1,b=.75;if(C>b){const w=(C-b)/(1-b),E=m(2,w),y=new te(0,0);for(let c=0;c<r.length;c++){const P=r[c],g=a[c],S=p[c],F=S.minus(g.timesScalar(S.dot(g))).timesScalar(E*e);y.add(F),k()&&N(F.isFinite()),t.get(P).add(F)}y.multiplyScalar(1/r.length);for(const c of r)k()&&N(y),t.get(c).subtract(y)}}),new U(n,t)}static getUnitLeastSquares(n){const e=n.length,t=ye.range(0,e).map(o=>te.createPolar(1,2*Math.PI*o/e));return U.getLeastSquares(n,t)}static getLeastSquares(n,e){const t=n.length,o=new Je(2,t,[...e.map(i=>i.x),...e.map(i=>i.y)]),r=new Je(2,t,[...n.map(i=>i.x),...n.map(i=>i.y)]),l=o.times(r.transpose()),s=new so(l);let a=s.getV().times(s.getU().transpose());a.det()<0&&(a=s.getV().times(Je.diagonalMatrix([1,-1])).times(s.getU().transpose()));const p=new De().rowMajor(a.get(0,0),a.get(0,1),0,a.get(1,0),a.get(1,1),0,0,0,1);return e.map(i=>{const d=p.timesVector2(i);return k()&&N(d.isFinite()),d})}}class Wr extends Eo{constructor(e,t){const o=new Map,r=new Map,l=new Map,s=new Map,a=new Map,p=new Map,i=new Map,d=new Map,m=f=>{const v=o.get(f);return k()&&N(v),v},C=f=>{const v=r.get(f);return k()&&N(v),v},b=f=>{const v=l.get(f);return k()&&N(v),v},w=f=>{const v=s.get(f);return k()&&N(v),v},E=f=>{const v=a.get(f);return k()&&N(v),v},y=f=>{const v=p.get(f);return k()&&N(v),v},c=f=>{const v=i.get(f);return k()&&N(v),v},P=f=>{const v=d.get(f);return k()&&N(v),v},g=e.vertices.map(f=>{const v=new er(f.logicalCoordinates,f.viewCoordinates);return o.set(f,v),a.set(v,f),v}),S=e.faces.map(f=>{const v=new It(f.logicalCoordinates,f.viewCoordinates);return r.set(f,v),p.set(v,f),v.originalFace=f,v}),F=[],B=e.edges.map(f=>{const v=o.get(f.start),Q=o.get(f.end);k()&&N(v),k()&&N(Q);const ee=new kt(v,Q);ee.originalEdges.add(f),l.set(f,ee),i.set(ee,f);const K=new Te(v,Q,!1);s.set(f.forwardHalf,K),d.set(K,f.forwardHalf),F.push(K);const G=new Te(Q,v,!0);return s.set(f.reversedHalf,G),d.set(G,f.reversedHalf),F.push(G),ee});g.forEach(f=>{const v=E(f);f.incomingHalfEdges=v.incomingHalfEdges.map(w),f.outgoingHalfEdges=v.outgoingHalfEdges.map(w),f.edges=v.edges.map(b),f.faces=v.faces.map(C)}),S.forEach(f=>{const v=y(f);f.halfEdges=v.halfEdges.map(w),f.edges=v.edges.map(b),f.vertices=v.vertices.map(m)}),B.forEach(f=>{const v=c(f);f.forwardHalf=w(v.forwardHalf),f.reversedHalf=w(v.reversedHalf),f.forwardFace=v.forwardFace?C(v.forwardFace):null,f.reversedFace=v.reversedFace?C(v.reversedFace):null,f.vertices=v.vertices.map(m),f.faces=v.faces.map(C)}),F.forEach(f=>{const v=P(f);f.edge=b(v.edge),f.reversed=w(v.reversed),f.next=w(v.next),f.previous=w(v.previous),f.face=v.face?C(v.face):null});super({edges:B,vertices:g,faces:S,halfEdges:F,outerBoundary:e.outerBoundary.map(w),innerBoundaries:e.innerBoundaries.map(f=>f.map(w))});x(this,"edgeStateMap",new Map);x(this,"faceValueMap",new Map);this.originalBoard=e,this.originalState=t,B.forEach(f=>{this.edgeStateMap.set(f,t.getEdgeState(c(f)))}),S.forEach(f=>{this.faceValueMap.set(f,t.getFaceValue(y(f)))}),k()&&Ze(this)}getFaceValue(e){const t=this.faceValueMap.get(e);return k()&&N(t!==void 0),t}getEdgeState(e){const t=this.edgeStateMap.get(e);return k()&&N(t!==void 0),t}clearSatisfiedFaces(){this.faces.forEach(e=>{const t=this.getFaceValue(e);if(t===null)return;let o=0,r=0;e.edges.forEach(l=>{const s=this.getEdgeState(l);s===Ee.WHITE?o++:s===Ee.BLACK&&r++}),o===0&&r===t&&this.faceValueMap.set(e,null)})}removeDeadRedEdges(){const e=new Set(this.edges.filter(s=>this.getEdgeState(s)===Ee.RED&&s.faces.every(a=>a===null||this.getFaceValue(a)===null))),t=new Set(this.vertices.filter(s=>s.edges.every(a=>e.has(a)))),o=new Set(this.faces.filter(s=>s.edges.some(a=>e.has(a)))),r=[],l=new Set(o);for(;l.size;){const s=l.values().next().value;l.delete(s);const a=[s];let p=!1;for(let y=0;y<a.length;y++){const c=a[y];c.edges.forEach(P=>{e.has(P)&&[P.forwardFace,P.reversedFace].forEach(g=>{if(g!==c){if(g===null){p=!0;return}l.has(g)&&(l.delete(g),a.push(g))}})})}const i=new Set(a.flatMap(y=>y.halfEdges)),d=new Set(a.flatMap(y=>y.halfEdges.map(c=>c.reversed))),m=new Set([...i].filter(y=>!d.has(y))),C=y=>{let c=y.next;for(;c!==y&&!m.has(c);)c=c.reversed.next;return k()&&N(c!==y),c},b=m.values().next().value,w=[b];let E=C(b);for(;E!==b;)w.push(E),E=C(E);if(k()&&N(w.length===m.size),p){const y=[];for(let c=0;c<w.length;c++){const P=w[c],g=w[(c+w.length-1)%w.length];if(k()&&N(g.end===P.start),!e.has(P.edge)&&e.has(g.edge)){const S=[P];for(let F=c+1;;F++){const B=w[F%w.length];if(e.has(B.edge))break;S.push(B)}y.push(S)}}r.push(new tr(a,w,y))}else r.push(new Nt(a,w))}r.forEach(s=>{if(s instanceof Nt){const a=s.boundaryHalfEdges.map(d=>d.start),p=s.boundaryHalfEdges.map(d=>d.edge),i=new It(ve(a.map(d=>d.viewCoordinates)),ve(a.map(d=>d.logicalCoordinates)));this.faces.push(i),this.faceValueMap.set(i,null),i.halfEdges=s.boundaryHalfEdges,i.edges=p,i.vertices=a;for(let d=0;d<s.boundaryHalfEdges.length;d++){const m=s.boundaryHalfEdges[d],C=m.face;m.face=i;const b=m.edge;m.isReversed?b.reversedFace=i:b.forwardFace=i,k()&&N(C),C&&R(b.faces,C),b.faces.push(i)}}else s.boundarySegments.forEach(a=>{a.forEach(p=>{const i=p.edge,d=p.face;d&&(p.face=null,R(i.faces,d)),p.isReversed?i.reversedFace=null:i.forwardFace=null})})}),e.forEach(s=>{R(this.edges,s),R(this.halfEdges,s.forwardHalf),R(this.halfEdges,s.reversedHalf)}),t.forEach(s=>{R(this.vertices,s)}),o.forEach(s=>{R(this.faces,s)}),this.vertices.forEach(s=>{s.edges=s.edges.filter(a=>!e.has(a)),s.incomingHalfEdges=s.incomingHalfEdges.filter(a=>!e.has(a.edge)),s.outgoingHalfEdges=s.outgoingHalfEdges.filter(a=>!e.has(a.edge)),s.faces=s.incomingHalfEdges.map(a=>a.face).filter(a=>a!==null);for(let a=0;a<s.incomingHalfEdges.length;a++){const p=s.outgoingHalfEdges[a],i=s.incomingHalfEdges[(a+1)%s.incomingHalfEdges.length];i.next=p,p.previous=i}}),k()&&Ze(this)}removeSimpleForced(){this.vertices.slice().forEach(e=>{if(e.edges.length!==2||ye.uniq(e.edges.flatMap(P=>P.faces)).some(P=>this.getFaceValue(P)!==null))return;const o=e.edges[0],r=e.edges[1],l=this.getEdgeState(o),s=this.getEdgeState(r);if(l!==s)return;const a=o.getOtherVertex(e),p=r.getOtherVertex(e);if(a===p)return;const i=o.forwardHalf.end===e?o.forwardHalf:o.reversedHalf,d=o.forwardHalf.end===e?o.reversedHalf:o.forwardHalf,m=r.forwardHalf.start===e?r.forwardHalf:r.reversedHalf,C=r.forwardHalf.start===e?r.reversedHalf:r.forwardHalf,b=i.face,w=d.face,E=new kt(a,p);o.originalEdges.forEach(P=>E.originalEdges.add(P)),r.originalEdges.forEach(P=>E.originalEdges.add(P)),this.edgeStateMap.set(E,l),this.edges.push(E);const y=new Te(a,p,!1);this.halfEdges.push(y);const c=new Te(p,a,!0);if(this.halfEdges.push(c),E.forwardHalf=y,E.reversedHalf=c,E.forwardFace=b,E.reversedFace=w,E.vertices=[a,p],E.faces=[b,w].filter(P=>P!==null),y.edge=E,y.reversed=c,y.next=m.next,y.previous=i.previous,y.face=b,c.edge=E,c.reversed=y,c.next=d.next,c.previous=C.previous,c.face=w,b){const P=b.halfEdges.indexOf(i),g=b.edges.indexOf(o);k()&&N(P!==-1),k()&&N(g!==-1),b.halfEdges[P]=y,R(b.halfEdges,m),b.edges[g]=E,R(b.edges,r),R(b.vertices,e)}if(w){const P=w.halfEdges.indexOf(C),g=w.edges.indexOf(r);k()&&N(P!==-1),k()&&N(g!==-1),w.halfEdges[P]=c,R(w.halfEdges,d),w.edges[g]=E,R(w.edges,o),R(w.vertices,e)}{const P=a.incomingHalfEdges.indexOf(d),g=a.outgoingHalfEdges.indexOf(i),S=a.edges.indexOf(o);k()&&N(P!==-1),k()&&N(g!==-1),k()&&N(S!==-1),a.incomingHalfEdges[P]=c,a.outgoingHalfEdges[g]=y,a.edges[S]=E}{const P=p.incomingHalfEdges.indexOf(m),g=p.outgoingHalfEdges.indexOf(C),S=p.edges.indexOf(r);k()&&N(P!==-1),k()&&N(g!==-1),k()&&N(S!==-1),p.incomingHalfEdges[P]=y,p.outgoingHalfEdges[g]=c,p.edges[S]=E}y.previous.next=y,y.next.previous=y,c.previous.next=c,c.next.previous=c,R(this.edges,o),R(this.edges,r),R(this.halfEdges,o.forwardHalf),R(this.halfEdges,o.reversedHalf),R(this.halfEdges,r.forwardHalf),R(this.halfEdges,r.reversedHalf),R(this.vertices,e)}),k()&&Ze(this)}simplify(){this.clearSatisfiedFaces(),this.removeDeadRedEdges(),this.removeSimpleForced()}fixOuterBoundary(){const e=new Set(this.halfEdges.filter(r=>r.face===null)),t=[],o=[];for(;e.size;){const r=e.values().next().value;e.delete(r);const l=[r];let s=r.next;for(;s!==r;)l.push(s),e.delete(s),s=s.next;ot(l.map(a=>a.start.viewCoordinates))<0?t.push(l):o.push(l)}k()&&N(t.length===1),this.outerBoundary.length=0,this.outerBoundary.push(...t[0]),this.innerBoundaries.length=0,this.innerBoundaries.push(...o)}getCompleteState(){this.fixOuterBoundary();const e=Xt.fromFacesEdges(this,t=>this.getFaceValue(t),t=>this.getEdgeState(t));return Ie(this,e),e}getCompletePuzzle(){return{board:this,state:this.getCompleteState()}}getSignedArea(){let e=0;return this.faces.forEach(t=>{e+=ot(t.vertices.map(o=>o.viewCoordinates))}),e}getCentroid(){let e=0,t=0,o=0;return this.halfEdges.forEach(r=>{if(r.face===null){const l=r.end.viewCoordinates,s=r.start.viewCoordinates;e+=(s.x+l.x)*(s.y-l.y);const a=l.x*(2*l.y+s.y)+s.x*(l.y+2*s.y);t+=(l.x-s.x)*a,o+=(s.y-l.y)*a}}),e*=.5,new te(t,o).timesScalar(1/(6*e))}applyDerivative(e){this.vertices.forEach(t=>{const o=e.derivatives.get(t);k()&&N(o),k()&&N(o.isFinite()),t.viewCoordinates.add(o)}),this.fixFaceCoordinates()}fixFaceCoordinates(){this.faces.forEach(e=>{e.viewCoordinates.set(ve(e.halfEdges.map(t=>t.start.viewCoordinates)))})}}const Gr=u=>({board:u.board,stateProperty:new lt(u.state)});class Xr extends L{constructor(e,t){const o=new L;let r=null;const l=()=>{const a=e.puzzle.board,p=e.puzzle.stateProperty.value;if(p.getSimpleRegions().some(y=>y.isSolved))return;const i=new Wr(a,p);i.simplify();const d=()=>U.getAngularDeltas(i,.2).plus(U.getHookesAttraction(i,1,.1)).plus(U.getRegularPolygonDeltas(i,1,!0,.2));let m=.3;for(let y=0;y<40;y++){y%10===0&&(m*=.95);let c=d();{let P=c.getMaxMagnitude(),g=m;m*P>1.5&&(g=1.5/P),c=c.timesScalar(g)}if(i.applyDerivative(c),c.getMaxMagnitude()<.015)break}const C=i.getCompletePuzzle();r&&r.dispose();const b=new me(Gr(C),{edgePressListener:(y,c)=>{const P=y.originalEdges;P&&e.onUserEdgePress(P.values().next().value,c)},facePressListener:(y,c)=>{if(y===null)e.onUserFacePress(null,c);else{const P=y.originalFace;P&&e.onUserFacePress(P,c)}}});this.puzzleNode=b,r=b;const w=new L({children:[b]}),E=600;w.scale(Math.min(E/w.width,E/w.height)),w.left=20,w.top=130,o.children=[w]},s=()=>{o.children=[],l()};e.puzzle.stateProperty.link(s);super(W({children:[o]},t));x(this,"puzzleNode");this.puzzleModel=e,this.disposeEmitter.addListener(()=>e.puzzle.stateProperty.unlink(s)),this.disposeEmitter.addListener(()=>o.dispose()),this.disposeEmitter.addListener(()=>r&&r.dispose())}}class Kt extends uo(L){constructor(e,t=ut,o){const r=j()({topological:!1},o);super(r);x(this,"backgroundRect");x(this,"facePressRect");x(this,"rectangularGradientRect");x(this,"circularGradientRect");x(this,"puzzleWrapper");x(this,"puzzleNode",null);x(this,"zoomListener");this.puzzleModelProperty=e,this.style=t,this.backgroundRect=new H({fill:t.theme.playAreaBackgroundColorProperty,pickable:!0}),this.facePressRect=new H({fill:null,pickableProperty:Vn}),qn(this.facePressRect,s=>{var a;(a=e.value)==null||a.onUserFacePress(null,s)},s=>{var a;(a=this.puzzleNode)==null||a.puzzleNode.onFaceBackgroundDragStart(s)}),this.rectangularGradientRect=new H({pickable:!1}),this.circularGradientRect=new H({pickable:!1}),this.puzzleWrapper=new L({children:[this.backgroundRect,this.facePressRect,this.rectangularGradientRect,this.circularGradientRect]}),this.zoomListener=new po(this.puzzleWrapper,{maxScale:10}),this.addInputListener(this.zoomListener),this.addChild(this.puzzleWrapper);const l=this.updateLayout.bind(this);this.localPreferredWidthProperty.lazyLink(l),this.localPreferredHeightProperty.lazyLink(l),r.topological&&this.puzzleWrapper.localBoundsProperty.lazyLink(l),We.multilink([e,pt],(s,a)=>{this.puzzleNode&&(this.puzzleNode.dispose(),this.puzzleNode=null),s&&(r.topological?a&&(this.puzzleNode=new Xr(s)):this.puzzleNode=new Ur(s,{focusNodeCallback:p=>{this.zoomListener.panToNode(p,!0)}}),this.puzzleNode&&(this.updatePuzzleNodeLayout(this.puzzleNode),this.puzzleWrapper.children=[this.backgroundRect,this.facePressRect,this.rectangularGradientRect,this.circularGradientRect,this.puzzleNode])),this.zoomListener.resetTransform(),this.updateLayout()})}step(e){this.zoomListener.step(2*e)}updateLayout(){const e=this.localPreferredWidth,t=this.localPreferredHeight;if(e!==null&&(this.backgroundRect.rectWidth=e,this.facePressRect.rectWidth=e,this.rectangularGradientRect.rectWidth=e,this.circularGradientRect.rectWidth=e),t!==null&&(this.backgroundRect.rectHeight=t,this.facePressRect.rectHeight=t,this.rectangularGradientRect.rectHeight=t,this.circularGradientRect.rectHeight=t),this.puzzleNode&&this.updatePuzzleNodeLayout(this.puzzleNode),e!==null&&t!==null&&e>0&&t>0){const o=new Ve(0,0,e,t),r=o.center,l=r.getMagnitude();this.rectangularGradientRect.fill=new ho(0,0,0,t).addColorStop(0,this.style.theme.playAreaLinearTopColorProperty).addColorStop(.5,this.style.theme.playAreaLinearMiddleColorProperty).addColorStop(1,this.style.theme.playAreaLinearBottomColorProperty),this.circularGradientRect.fill=new go(r.x,r.y,l,r.x,r.y,0).addColorStop(0,this.style.theme.playAreaRadialOutsideColorProperty).addColorStop(1,this.style.theme.playAreaRadialInsideColorProperty),this.clipArea=A.bounds(o),this.zoomListener.setTargetBounds(o),this.zoomListener.setPanBounds(o)}else{const o=new Ve(0,0,5,5);this.zoomListener.setTargetBounds(o),this.zoomListener.setPanBounds(o)}}updatePuzzleNodeLayout(e){const t=this.localPreferredWidth,o=this.localPreferredHeight;if(t!==null&&o!==null&&t>0&&o>0){const l=t-40,s=o-20*2;if(e.localBounds.isValid()){const a=e.localBounds.width,p=e.localBounds.height,i=Math.min(l/a,s/p);e.setScaleMagnitude(i),e.center=new te(t/2,o/2)}}}}class Yr{constructor(n,e,t){this.layoutBoundsProperty=n,this.glassPane=e,this.stepEmitter=t}}const jt=new L,Ae=new L;self.assertions;const Jr=new L({renderer:"svg",children:[Ae]}),Le=new fo(Jr,{allowWebGL:!0,allowBackingScaleAntialiasing:!0,allowSceneOverflow:!1,accessibility:!0,backgroundColor:"#eee",assumeFullWindow:!0,listenToOnlyElement:Ue.debugColors});document.body.appendChild(Le.domElement);Le.setPointerAreaDisplayVisible(Ue.showPointerAreas);self.oncontextmenu=u=>u.preventDefault();const ht=new lt(new Ve(0,0,self.innerWidth,self.innerHeight)),J=new le(or()),_t=new Kt(J,ut,{layoutOptions:{stretch:!0,grow:1}}),Qt=new Kt(J,ut,{layoutOptions:{stretch:!0,grow:1},topological:!0,visibleProperty:pt}),Zr=new we(J,{derive:u=>u?u.hintStateProperty:new le(ue.DEFAULT)});We.multilink([h.navbarBackgroundColorProperty],u=>{Le.backgroundColor=u});const $t=new ke,Xe=new Yr(ht,jt,$t),eo=new Rr(J,Xe,{loadPuzzle:u=>{const n=it(u.board,u.stateProperty.value);n&&(J.value=new At(n))}}),Kr=new Ge(Xe),jr=new ze(Xe),to=new Vr(Xe,Zr,()=>{var u;(u=J.value)==null||u.onUserApplyHint()},()=>{var u;(u=J.value)==null||u.onUserClearHint()}),Pe=new T({stretch:!0,children:[new Re(eo,{margin:Se}),new O({grow:1,stretch:!0,layoutOptions:{grow:1},children:[_t,Qt]}),new Re(jr,{margin:Se,visibleProperty:Ut}),new Re(Kr,{margin:Se})]});ht.lazyLink(u=>{Pe.preferredWidth=u.width,Pe.preferredHeight=u.height,Pe.x=u.left,Pe.y=u.top});Ae.addChild(Pe);Ae.addChild(to);Ae.addChild(jt);wo.create(Ae,[eo,to],(u,n)=>{n.centerTop=u.centerBottom.plusXY(0,5)});Le.initializeEvents();let gt=!0;const oo=()=>{gt=!1;const u=new Ve(0,0,self.innerWidth,self.innerHeight);Le.setWidthHeight(u.width,u.height),ht.value=u,Lo.mobileSafari&&self.scrollTo(0,0)},Ye=()=>{gt=!0};$(self).resize(Ye);self.addEventListener("resize",Ye);self.addEventListener("orientationchange",Ye);self.visualViewport&&self.visualViewport.addEventListener("resize",Ye);oo();Le.updateOnRequestAnimationFrame(u=>{var n;Gn(),gt&&oo(),Pe.validateBounds(),_t.step(u),Qt.step(u),(n=J.value)==null||n.step(u),$t.emit(u)});document.addEventListener("keydown",u=>{var n,e,t,o,r;if(u.ctrlKey||u.metaKey)u.key==="z"&&(u.shiftKey?(n=J.value)==null||n.onUserRedo():(e=J.value)==null||e.onUserUndo()),u.key==="y"&&((t=J.value)==null||t.onUserRedo());else if(["1","2","3","4","5","6","7","8","9"].includes(u.key)){const l=Number.parseInt(u.key,10)-1,s=X.enumeration.values.filter(a=>a.isEnabledProperty.value);l<s.length&&Un(s[l])}else u.key==="Escape"?(o=J.value)==null||o.onUserEscape():u.key==="h"&&((r=J.value)==null||r.onUserHintKey())});qe.keydownEmitter.addListener(u=>{u.key==="e"&&(dt.value=!0)});qe.keyupEmitter.addListener(u=>{u.key==="e"&&(dt.value=!1)});let xt=!1;qe.keyDownStateChangedEmitter.addListener(()=>{const u=qe.isEnglishKeyDown("space");u!==xt&&(xt=u,Ce.value=Ce.value===ie.PAN_ONLY?ie.DRAG_ONLY:ie.PAN_ONLY)});J.lazyLink((u,n)=>{n&&n.dispose()});
