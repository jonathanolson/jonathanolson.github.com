var So=Object.defineProperty;var Co=(i,o,e)=>o in i?So(i,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[o]=e;var P=(i,o,e)=>(Co(i,typeof o!="symbol"?o+"":o,e),e);import{c as j,a as I,V as ie,D as ye,M as tt,S as Eo,b as Wt,P as wt,o as re,B as Ge,E as Pt,d as mt,T as Y,e as bo,f as lt,g as Fe}from"./UnivariatePolynomial-B1fo8xe7.js";import{s as ko}from"./scanURL-gJyLFeMH.js";import{B as Lo,a as Fo,b as zo,c as Ao,d as No,e as L,f as z,g as ot,h as Ce,_ as Pe,i as ct,j as To,S as O,k as xo,H as Bo,P as Io,l as Ro}from"./patternBoards-D316jvfQ.js";import{N as A,L as dt,T as q,S as Ho,R as K,A as Oo,M as vt,a as Mo,b as Do,c as J,d as Ve,V as G,H as M,P as ee,s as Ft,e as Vo,G as zt,B as Ke,f as At,g as ut,I as Nt,h as he,i as qo,D as Uo,j as Wo,k as Gt}from"./PhetioControlledVisibilityProperty-C4xreNPS.js";import{L as Je,a as Ye,P as Ae,C as Go,V as Xo,T as qe,O as Ko,R as Jo,b as Yo,c as fe,B as Zo}from"./TextPushButton-gLDghw4s.js";import{s as jo,S as Ze,g as Qo,a as pt}from"./SATSolver-DB4c3ov9.js";import{P as me,s as ze,i as $o,h as _o,f as le,j as ue,k as B,U as H,p as Xt,l as Kt,m as Jt,n as Yt,o as Zt,q as jt,r as Qt,v as ht,t as gt,u as $t,V as er,F as tr,w as _t,x as eo,y as St,z as ae}from"./DisplayEmbedding-ChokjhCK.js";import{A as or,C as rr,s as to,p as He,g as nr,a as sr,i as ar,w as ir}from"./polygonGenerators-CcAhf7v3.js";import{E as x,C as oo,U as rt,a as Tt,F as lr,b as cr,S as dr,s as ro,c as xt,d as ur,B as ge}from"./BasicPuzzle-qCypyw3t.js";import{c as y,o as pr,u as _,a as yt,r as ve,t as hr,b as Ee,d as Bt,e as gr,p as yr,f as It,g as fr,h as wr,s as nt,i as Pr,j as mr,v as Rt,k as vr,m as Sr,w as Cr,n as Ht,q as Er,x as br,y as kr,z as Lr,A as Fr,B as zr,C as Ar,D as Nr,E as Tr,F as xr,G as Br,H as Ir,I as Rr,J as Hr,K as Or,L as Mr,M as st,N as Dr,O as at}from"./Theme-D414G__S.js";import{A as Vr,N as Oe,S as qr}from"./SpinningIndicatorNode-DOFXt6Ex.js";import{i as Xe,a as Ue,w as Ot,I as it,g as Me,b as Ur,c as Wr,d as Gr,e as Xr,f as Kr,h as Jr,j as Yr,k as Zr,l as jr,m as Qr,n as $r,o as _r,p as en,q as tn,r as on,s as rn,t as nn,u as sn,v as an,x as ln,y as cn,z as dn,A as un,B as pn,C as hn,D as gn,E as yn}from"./autoSolver-CHqufOu6.js";import{c as fn}from"./compression-L63-wCoo.js";import{p as no}from"./puzzleFromCompressedString-W1kaR0-a.js";import{U as wn}from"./UIAquaRadioButtonGroup-BuKn_H70.js";import"./PatternBoardSolver-JIwhRtt1.js";import"./PatternRule-CbsljjHG.js";class Pn extends A{constructor(o,e){const t=new me(o.puzzle,{edgePressListener:(l,s)=>{o.onUserEdgePress(l,s)},facePressListener:(l,s)=>{o.onUserFacePress(l,s)},sectorPressListener:(l,s)=>{o.onUserSectorPress(l,s)},sectorSetListener:(l,s)=>{o.onUserSectorSet(l,s)},selectedFaceColorHighlightProperty:o.selectedFaceColorHighlightProperty,selectedSectorEditProperty:o.selectedSectorEditProperty,style:o.style});super(j({children:[t]},e)),this.puzzleModel=o,this.disposeEmitter.addListener(()=>t.dispose());let r=null;const n=l=>{if(t.clearAnnotationNodes(),r&&(r.dispose(),r=null),l){const s=new or(o.puzzle.board,l,o.style,t.getBackgroundBounds());t.addAnnotationNode(s),r=s}};this.disposeEmitter.addListener(()=>{r&&(r.dispose(),r=null)}),o.displayedAnnotationProperty.link(n),this.disposeEmitter.addListener(()=>o.displayedAnnotationProperty.unlink(n))}}const Ct=new Je("showLayoutTestProperty",!1);class De extends Lo{constructor(o,e,t){super(o,e,t)}}class Mt extends Fo{constructor(e,t){super(e,t);P(this,"originalEdges",new Set)}}class Dt extends zo{constructor(e,t){super(e.copy(),t.copy());P(this,"originalFace",null)}}class mn extends Ao{constructor(o,e){super(o.copy(),e.copy())}}class Vt{constructor(o,e){this.faces=o,this.boundaryHalfEdges=e}}class vn{constructor(o,e,t){this.faces=o,this.boundaryHalfEdges=e,this.boundarySegments=t}}class Sn extends No{constructor(e,t){const r=new Map,n=new Map,l=new Map,s=new Map,a=new Map,d=new Map,u=new Map,h=new Map,v=g=>{const w=r.get(g);return L()&&z(w),w},k=g=>{const w=n.get(g);return L()&&z(w),w},S=g=>{const w=l.get(g);return L()&&z(w),w},f=g=>{const w=s.get(g);return L()&&z(w),w},C=g=>{const w=a.get(g);return L()&&z(w),w},c=g=>{const w=d.get(g);return L()&&z(w),w},p=g=>{const w=u.get(g);return L()&&z(w),w},E=g=>{const w=h.get(g);return L()&&z(w),w},m=e.vertices.map(g=>{const w=new mn(g.logicalCoordinates,g.viewCoordinates);return r.set(g,w),a.set(w,g),w}),b=e.faces.map(g=>{const w=new Dt(g.logicalCoordinates,g.viewCoordinates);return n.set(g,w),d.set(w,g),w.originalFace=g,w}),N=[],T=e.edges.map(g=>{const w=r.get(g.start),ne=r.get(g.end);L()&&z(w),L()&&z(ne);const se=new Mt(w,ne);se.originalEdges.add(g),l.set(g,se),u.set(se,g);const R=new De(w,ne,!1);s.set(g.forwardHalf,R),h.set(R,g.forwardHalf),N.push(R);const D=new De(ne,w,!0);return s.set(g.reversedHalf,D),h.set(D,g.reversedHalf),N.push(D),se});m.forEach(g=>{const w=C(g);g.incomingHalfEdges=w.incomingHalfEdges.map(f),g.outgoingHalfEdges=w.outgoingHalfEdges.map(f),g.edges=w.edges.map(S),g.faces=w.faces.map(k)}),b.forEach(g=>{const w=c(g);g.halfEdges=w.halfEdges.map(f),g.edges=w.edges.map(S),g.vertices=w.vertices.map(v)}),T.forEach(g=>{const w=p(g);g.forwardHalf=f(w.forwardHalf),g.reversedHalf=f(w.reversedHalf),g.forwardFace=w.forwardFace?k(w.forwardFace):null,g.reversedFace=w.reversedFace?k(w.reversedFace):null,g.vertices=w.vertices.map(v),g.faces=w.faces.map(k)}),N.forEach(g=>{const w=E(g);g.edge=S(w.edge),g.reversed=f(w.reversed),g.next=f(w.next),g.previous=f(w.previous),g.face=w.face?k(w.face):null});super({edges:T,vertices:m,faces:b,halfEdges:N,outerBoundary:e.outerBoundary.map(f),innerBoundaries:e.innerBoundaries.map(g=>g.map(f))});P(this,"edgeStateMap",new Map);P(this,"faceValueMap",new Map);this.originalBoard=e,this.originalState=t,T.forEach(g=>{this.edgeStateMap.set(g,t.getEdgeState(p(g)))}),b.forEach(g=>{this.faceValueMap.set(g,t.getFaceValue(c(g)))}),L()&&ot(this)}getFaceValue(e){const t=this.faceValueMap.get(e);return L()&&z(t!==void 0),t}getEdgeState(e){const t=this.edgeStateMap.get(e);return L()&&z(t!==void 0),t}clearSatisfiedFaces(){this.faces.forEach(e=>{const t=this.getFaceValue(e);if(t===null)return;let r=0,n=0;e.edges.forEach(l=>{const s=this.getEdgeState(l);s===x.WHITE?r++:s===x.BLACK&&n++}),r===0&&n===t&&this.faceValueMap.set(e,null)})}removeDeadRedEdges(){const e=new Set(this.edges.filter(s=>this.getEdgeState(s)===x.RED&&s.faces.every(a=>a===null||this.getFaceValue(a)===null))),t=new Set(this.vertices.filter(s=>s.edges.every(a=>e.has(a)))),r=new Set(this.faces.filter(s=>s.edges.some(a=>e.has(a)))),n=[],l=new Set(r);for(;l.size;){const s=l.values().next().value;l.delete(s);const a=[s];let d=!1;for(let c=0;c<a.length;c++){const p=a[c];p.edges.forEach(E=>{e.has(E)&&[E.forwardFace,E.reversedFace].forEach(m=>{if(m!==p){if(m===null){d=!0;return}l.has(m)&&(l.delete(m),a.push(m))}})})}const u=new Set(a.flatMap(c=>c.halfEdges)),h=new Set(a.flatMap(c=>c.halfEdges.map(p=>p.reversed))),v=new Set([...u].filter(c=>!h.has(c))),k=c=>{let p=c.next;for(;p!==c&&!v.has(p);)p=p.reversed.next;return L()&&z(p!==c),p},S=v.values().next().value,f=[S];let C=k(S);for(;C!==S;)f.push(C),C=k(C);if(L()&&z(f.length===v.size),d){const c=[];for(let p=0;p<f.length;p++){const E=f[p],m=f[(p+f.length-1)%f.length];if(L()&&z(m.end===E.start),!e.has(E.edge)&&e.has(m.edge)){const b=[E];for(let N=p+1;;N++){const T=f[N%f.length];if(e.has(T.edge))break;b.push(T)}c.push(b)}}n.push(new vn(a,f,c))}else n.push(new Vt(a,f))}n.forEach(s=>{if(s instanceof Vt){const a=s.boundaryHalfEdges.map(h=>h.start),d=s.boundaryHalfEdges.map(h=>h.edge),u=new Dt(Ce(a.map(h=>h.viewCoordinates)),Ce(a.map(h=>h.logicalCoordinates)));this.faces.push(u),this.faceValueMap.set(u,null),u.halfEdges=s.boundaryHalfEdges,u.edges=d,u.vertices=a;for(let h=0;h<s.boundaryHalfEdges.length;h++){const v=s.boundaryHalfEdges[h],k=v.face;v.face=u;const S=v.edge;v.isReversed?S.reversedFace=u:S.forwardFace=u,L()&&z(k),k&&I(S.faces,k),S.faces.push(u)}}else s.boundarySegments.forEach(a=>{a.forEach(d=>{const u=d.edge,h=d.face;h&&(d.face=null,I(u.faces,h)),d.isReversed?u.reversedFace=null:u.forwardFace=null})})}),e.forEach(s=>{I(this.edges,s),I(this.halfEdges,s.forwardHalf),I(this.halfEdges,s.reversedHalf)}),t.forEach(s=>{I(this.vertices,s)}),r.forEach(s=>{I(this.faces,s)}),this.vertices.forEach(s=>{s.edges=s.edges.filter(a=>!e.has(a)),s.incomingHalfEdges=s.incomingHalfEdges.filter(a=>!e.has(a.edge)),s.outgoingHalfEdges=s.outgoingHalfEdges.filter(a=>!e.has(a.edge)),s.faces=s.incomingHalfEdges.map(a=>a.face).filter(a=>a!==null);for(let a=0;a<s.incomingHalfEdges.length;a++){const d=s.outgoingHalfEdges[a],u=s.incomingHalfEdges[(a+1)%s.incomingHalfEdges.length];u.next=d,d.previous=u}}),L()&&ot(this)}removeSimpleForced(){this.vertices.slice().forEach(e=>{if(e.edges.length!==2||Pe.uniq(e.edges.flatMap(E=>E.faces)).some(E=>this.getFaceValue(E)!==null))return;const r=e.edges[0],n=e.edges[1],l=this.getEdgeState(r),s=this.getEdgeState(n);if(l!==s)return;const a=r.getOtherVertex(e),d=n.getOtherVertex(e);if(a===d)return;const u=r.forwardHalf.end===e?r.forwardHalf:r.reversedHalf,h=r.forwardHalf.end===e?r.reversedHalf:r.forwardHalf,v=n.forwardHalf.start===e?n.forwardHalf:n.reversedHalf,k=n.forwardHalf.start===e?n.reversedHalf:n.forwardHalf,S=u.face,f=h.face,C=new Mt(a,d);r.originalEdges.forEach(E=>C.originalEdges.add(E)),n.originalEdges.forEach(E=>C.originalEdges.add(E)),this.edgeStateMap.set(C,l),this.edges.push(C);const c=new De(a,d,!1);this.halfEdges.push(c);const p=new De(d,a,!0);if(this.halfEdges.push(p),C.forwardHalf=c,C.reversedHalf=p,C.forwardFace=S,C.reversedFace=f,C.vertices=[a,d],C.faces=[S,f].filter(E=>E!==null),c.edge=C,c.reversed=p,c.next=v.next,c.previous=u.previous,c.face=S,p.edge=C,p.reversed=c,p.next=h.next,p.previous=k.previous,p.face=f,S){const E=S.halfEdges.indexOf(u),m=S.edges.indexOf(r);L()&&z(E!==-1),L()&&z(m!==-1),S.halfEdges[E]=c,I(S.halfEdges,v),S.edges[m]=C,I(S.edges,n),I(S.vertices,e)}if(f){const E=f.halfEdges.indexOf(k),m=f.edges.indexOf(n);L()&&z(E!==-1),L()&&z(m!==-1),f.halfEdges[E]=p,I(f.halfEdges,h),f.edges[m]=C,I(f.edges,r),I(f.vertices,e)}{const E=a.incomingHalfEdges.indexOf(h),m=a.outgoingHalfEdges.indexOf(u),b=a.edges.indexOf(r);L()&&z(E!==-1),L()&&z(m!==-1),L()&&z(b!==-1),a.incomingHalfEdges[E]=p,a.outgoingHalfEdges[m]=c,a.edges[b]=C}{const E=d.incomingHalfEdges.indexOf(v),m=d.outgoingHalfEdges.indexOf(k),b=d.edges.indexOf(n);L()&&z(E!==-1),L()&&z(m!==-1),L()&&z(b!==-1),d.incomingHalfEdges[E]=c,d.outgoingHalfEdges[m]=p,d.edges[b]=C}c.previous.next=c,c.next.previous=c,p.previous.next=p,p.next.previous=p,I(this.edges,r),I(this.edges,n),I(this.halfEdges,r.forwardHalf),I(this.halfEdges,r.reversedHalf),I(this.halfEdges,n.forwardHalf),I(this.halfEdges,n.reversedHalf),I(this.vertices,e)}),L()&&ot(this)}simplify(){this.clearSatisfiedFaces(),this.removeDeadRedEdges(),this.removeSimpleForced()}fixOuterBoundary(){const e=new Set(this.halfEdges.filter(n=>n.face===null)),t=[],r=[];for(;e.size;){const n=e.values().next().value;e.delete(n);const l=[n];let s=n.next;for(;s!==n;)l.push(s),e.delete(s),s=s.next;ct(l.map(a=>a.start.viewCoordinates))<0?t.push(l):r.push(l)}L()&&z(t.length===1),this.outerBoundary.length=0,this.outerBoundary.push(...t[0]),this.innerBoundaries.length=0,this.innerBoundaries.push(...r)}getCompleteState(){this.fixOuterBoundary();const e=oo.fromFacesEdges(this,t=>this.getFaceValue(t),t=>this.getEdgeState(t));return ze(this,e),e}getCompletePuzzle(){return{board:this,state:this.getCompleteState()}}getSignedArea(){let e=0;return this.faces.forEach(t=>{e+=ct(t.vertices.map(r=>r.viewCoordinates))}),e}getCentroid(){let e=0,t=0,r=0;return this.halfEdges.forEach(n=>{if(n.face===null){const l=n.end.viewCoordinates,s=n.start.viewCoordinates;e+=(s.x+l.x)*(s.y-l.y);const a=l.x*(2*l.y+s.y)+s.x*(l.y+2*s.y);t+=(l.x-s.x)*a,r+=(s.y-l.y)*a}}),e*=.5,new ie(t,r).timesScalar(1/(6*e))}applyDerivative(e){this.vertices.forEach(t=>{const r=e.derivatives.get(t);L()&&z(r),L()&&z(r.isFinite()),t.viewCoordinates.add(r)}),this.fixFaceCoordinates()}fixFaceCoordinates(){this.faces.forEach(e=>{e.viewCoordinates.set(Ce(e.halfEdges.map(t=>t.start.viewCoordinates)))})}getDebugNode(){const e=new A;return this.edges.forEach(t=>{const r=t.start.viewCoordinates,n=t.end.viewCoordinates;let l,s;const a=this.edgeStateMap.get(t);a===x.WHITE?(l=y.blackLineColorProperty,s=.02):a===x.BLACK?(l=pr(Math.random()*360,.7,.55),s=.1):(l=null,s=.02),e.addChild(new dt(r,n,{stroke:l,lineWidth:s,lineCap:"round"}))}),this.faces.forEach(t=>{const r=this.faceValueMap.get(t)??null;r!==null&&e.addChild(new q(r,{maxWidth:.9,maxHeight:.9,center:t.viewCoordinates,fill:y.faceValueColorProperty}))}),e}}class X{constructor(o,e){this.layoutPuzzle=o,this.derivatives=e}plus(o){const e=new Map;return this.derivatives.forEach((t,r)=>{e.set(r,t.plus(o.derivatives.get(r)))}),new X(this.layoutPuzzle,e)}minus(o){const e=new Map;return this.derivatives.forEach((t,r)=>{e.set(r,t.minus(o.derivatives.get(r)))}),new X(this.layoutPuzzle,e)}timesScalar(o){const e=new Map;return this.derivatives.forEach((t,r)=>{e.set(r,t.timesScalar(o))}),new X(this.layoutPuzzle,e)}getMaxMagnitude(){let o=0;return this.derivatives.forEach(e=>{o=Math.max(o,e.getMagnitude())}),o}getAreaCorrectedDerivative(){let o=this;for(let e=0;e<5;e++)o=o.getAreaCorrectedDerivativeOnce();return o}getAreaCorrectedDerivativeOnce(){return this.plus(X.getAreaScaledDeltas(this.layoutPuzzle,-this.getAreaDerivative()/this.layoutPuzzle.getSignedArea()))}getAreaDerivative(){let o=0;return this.layoutPuzzle.faces.forEach(e=>{o+=To(e.vertices.map(t=>t.viewCoordinates),e.vertices.map(t=>this.derivatives.get(t)))}),o}getDebugNode(){const o=new A;return this.layoutPuzzle.vertices.forEach(e=>{const t=this.derivatives.get(e),r=e.viewCoordinates,n=new Vr(r.x,r.y,r.x+t.x,r.y+t.y,{lineWidth:.01,headHeight:.05,headWidth:.05,tailWidth:.005,fill:"green",stroke:"green"});o.addChild(n)}),o}static getAreaScaledDeltas(o,e){const t=o.getCentroid(),r=new Map;return o.vertices.forEach(n=>{const l=n.viewCoordinates.minus(t).timesScalar(e);L()&&z(l.isFinite()),r.set(n,l)}),new X(o,r)}static getHookesAttraction(o,e,t){const r=new Map;return o.vertices.forEach(n=>{r.set(n,ie.ZERO.copy())}),o.edges.forEach(n=>{const l=n.start.viewCoordinates,a=n.end.viewCoordinates.minus(l),d=a.getMagnitude(),u=a.timesScalar((d-e)*t/d);L()&&z(u.isFinite()),r.get(n.start).add(u),r.get(n.end).subtract(u)}),new X(o,r)}static getRegularPolygonDeltas(o,e,t,r){const n=new Map;o.vertices.forEach(s=>{n.set(s,ie.ZERO.copy())});const l=s=>e/(2*Math.sin(Math.PI/s));return o.faces.forEach(s=>{if(s.vertices.length<3)return;const a=.2,d=.3,u=s.vertices.map(m=>m.viewCoordinates);let h=0;const v=ct(u);v<0?h=1:v<a&&(h=Math.max(h,(a-v)/a));for(let m=0;m<u.length&&!(h>=1);m++){const b=m,N=(m+1)%u.length,T=u[b],g=u[N];for(let w=m+2;w<u.length-(m===0?1:0)&&!(h>=1);w++){const ne=w%u.length,se=(w+1)%u.length,R=u[ne],D=u[se];if(ye.lineSegmentIntersection(T.x,T.y,g.x,g.y,R.x,R.y,D.x,D.y))L()&&z(u.length>=4),h=1;else{const Be=Math.min(ye.distToSegment(T,R,D),ye.distToSegment(g,R,D),ye.distToSegment(R,T,g),ye.distToSegment(D,T,g));Be<d&&(h=Math.max(h,(d-Be)/d))}}}if(h===0&&t&&o.getFaceValue(s)===null)return;const k=Ce(u);L()&&z(k.isFinite());const S=l(u.length),f=u.map(m=>m.minus(k)),C=u.map((m,b)=>ie.createPolar(S,2*Math.PI*b/u.length)),c=X.getLeastSquares(f,C),p=r+(2-r)*h,E=u.map((m,b)=>c[b].minus(f[b]).timesScalar(p));s.vertices.forEach((m,b)=>{const N=E[b];L()&&z(N.isFinite()),n.get(m).add(N)})}),new X(o,n)}static getBarycentricDeltas(o){const e=new Map;return o.vertices.forEach(t=>{const r=t.edges.map(s=>s.getOtherVertex(t)),n=new ie(0,0);r.forEach(s=>n.add(s.viewCoordinates)),n.multiplyScalar(1/r.length);const l=n.subtract(t.viewCoordinates);L()&&z(l.isFinite()),e.set(t,l)}),new X(o,e)}static getAngularDeltas(o,e){const t=new Map;return o.vertices.forEach(r=>{t.set(r,ie.ZERO.copy())}),o.vertices.forEach(r=>{const n=r.edges.map(f=>f.getOtherVertex(r));let l=Pe.sortBy(n,f=>f.viewCoordinates.minus(r.viewCoordinates).getAngle());if(l[0]!==n[0]){const f=l.indexOf(n[0]);l=[...l.slice(f),...l.slice(0,f)]}const s=Pe.range(0,n.length).every(f=>l[f]===n[f]),a=n.map(f=>f.viewCoordinates.minus(r.viewCoordinates).normalized()),d=X.getUnitLeastSquares(a),u=Math.max(...Pe.range(0,n.length).map(f=>d[f].dot(d[(f+1)%n.length]))),h=Math.max(...Pe.range(0,n.length).map(f=>a[f].dot(a[(f+1)%n.length]))),v=(f,C)=>C<=.5?.5*Math.pow(2*C,f):1-v(f,1-C),k=s?ye.linear(u,1,0,1,h):1,S=.75;if(k>S){const f=(k-S)/(1-S),C=v(2,f),c=new ie(0,0);for(let p=0;p<n.length;p++){const E=n[p],m=a[p],b=d[p],N=b.minus(m.timesScalar(b.dot(m))).timesScalar(C*e);c.add(N),L()&&z(N.isFinite()),t.get(E).add(N)}c.multiplyScalar(1/n.length);for(const p of n)L()&&z(c),t.get(p).subtract(c)}}),new X(o,t)}static getUnitLeastSquares(o){const e=o.length,t=Pe.range(0,e).map(r=>ie.createPolar(1,2*Math.PI*r/e));return X.getLeastSquares(o,t)}static getLeastSquares(o,e){const t=o.length,r=new tt(2,t,[...e.map(u=>u.x),...e.map(u=>u.y)]),n=new tt(2,t,[...o.map(u=>u.x),...o.map(u=>u.y)]),l=r.times(n.transpose()),s=new Eo(l);let a=s.getV().times(s.getU().transpose());a.det()<0&&(a=s.getV().times(tt.diagonalMatrix([1,-1])).times(s.getU().transpose()));const d=new Wt().rowMajor(a.get(0,0),a.get(0,1),0,a.get(1,0),a.get(1,1),0,0,0,1);return e.map(u=>{const h=d.timesVector2(u);return L()&&z(h.isFinite()),h})}}const Cn=i=>({board:i.board,stateProperty:new wt(i.state)});class En extends A{constructor(o,e){const t=new A;let r=null;const n=()=>{const s=o.puzzle.board,a=o.puzzle.stateProperty.value;if(a.getSimpleRegions().some(C=>C.isSolved))return;const d=new Sn(s,a);d.simplify();const u=()=>X.getAngularDeltas(d,.2).plus(X.getHookesAttraction(d,1,.1)).plus(X.getRegularPolygonDeltas(d,1,!0,.2));let h=.3;for(let C=0;C<40;C++){C%10===0&&(h*=.95);let c=u();{let p=c.getMaxMagnitude(),E=h;h*p>1.5&&(E=1.5/p),c=c.timesScalar(E)}if(d.applyDerivative(c),c.getMaxMagnitude()<.015)break}const v=d.getCompletePuzzle();r&&r.dispose();const k=new me(Cn(v),{edgePressListener:(C,c)=>{const p=C.originalEdges;p&&o.onUserEdgePress(p.values().next().value,c)},facePressListener:(C,c)=>{if(C===null)o.onUserFacePress(null,c);else{const p=C.originalFace;p&&o.onUserFacePress(p,c)}}});r=k;const S=new A({children:[k]}),f=600;S.scale(Math.min(f/S.width,f/S.height)),S.left=20,S.top=130,t.children=[S]},l=()=>{t.children=[],n()};o.puzzle.stateProperty.link(l),super(j({children:[t]},e)),this.puzzleModel=o,this.disposeEmitter.addListener(()=>o.puzzle.stateProperty.unlink(l)),this.disposeEmitter.addListener(()=>t.dispose()),this.disposeEmitter.addListener(()=>r&&r.dispose())}}class so extends Ho(A){constructor(e,t=le,r){const n=re()({topological:!1},r);super(n);P(this,"backgroundRect");P(this,"rectangularGradientRect");P(this,"circularGradientRect");P(this,"puzzleWrapper");P(this,"puzzleNode",null);P(this,"zoomListener");this.puzzleModelProperty=e,this.style=t,this.backgroundRect=new K({fill:t.theme.playAreaBackgroundColorProperty,pickableProperty:$o}),_o(null,this.backgroundRect,(s,a)=>{var d;(d=e.value)==null||d.onUserFacePress(s,a)}),this.rectangularGradientRect=new K({pickable:!1}),this.circularGradientRect=new K({pickable:!1}),this.puzzleWrapper=new A({children:[this.backgroundRect,this.rectangularGradientRect,this.circularGradientRect]}),this.zoomListener=new Oo(this.puzzleWrapper,{maxScale:10}),this.addInputListener(this.zoomListener),this.addChild(this.puzzleWrapper);const l=this.updateLayout.bind(this);this.localPreferredWidthProperty.lazyLink(l),this.localPreferredHeightProperty.lazyLink(l),n.topological&&this.puzzleWrapper.localBoundsProperty.lazyLink(l),vt.multilink([e,Ct],(s,a)=>{this.puzzleNode&&(this.puzzleNode.dispose(),this.puzzleNode=null),s&&(n.topological?a&&(this.puzzleNode=new En(s)):this.puzzleNode=new Pn(s),this.puzzleNode&&(this.updatePuzzleNodeLayout(this.puzzleNode),this.puzzleWrapper.children=[this.backgroundRect,this.rectangularGradientRect,this.circularGradientRect,this.puzzleNode])),this.zoomListener.resetTransform(),this.updateLayout()})}step(e){this.zoomListener.step(e)}updateLayout(){const e=this.localPreferredWidth,t=this.localPreferredHeight;if(e!==null&&(this.backgroundRect.rectWidth=e,this.rectangularGradientRect.rectWidth=e,this.circularGradientRect.rectWidth=e),t!==null&&(this.backgroundRect.rectHeight=t,this.rectangularGradientRect.rectHeight=t,this.circularGradientRect.rectHeight=t),this.puzzleNode&&this.updatePuzzleNodeLayout(this.puzzleNode),e!==null&&t!==null&&e>0&&t>0){const r=new Ge(0,0,e,t),n=r.center,l=n.getMagnitude();this.rectangularGradientRect.fill=new Mo(0,0,0,t).addColorStop(0,this.style.theme.playAreaLinearTopColorProperty).addColorStop(.5,this.style.theme.playAreaLinearMiddleColorProperty).addColorStop(1,this.style.theme.playAreaLinearBottomColorProperty),this.circularGradientRect.fill=new Do(n.x,n.y,l,n.x,n.y,0).addColorStop(0,this.style.theme.playAreaRadialOutsideColorProperty).addColorStop(1,this.style.theme.playAreaRadialInsideColorProperty),this.clipArea=O.bounds(r),this.zoomListener.setTargetBounds(r),this.zoomListener.setPanBounds(r)}else{const r=new Ge(0,0,5,5);this.zoomListener.setTargetBounds(r),this.zoomListener.setPanBounds(r)}}updatePuzzleNodeLayout(e){const t=this.localPreferredWidth,r=this.localPreferredHeight;if(t!==null&&r!==null&&t>0&&r>0){const l=t-40,s=r-20*2;if(e.localBounds.isValid()){const a=e.localBounds.width,d=e.localBounds.height,u=Math.min(l/a,s/d);e.setScaleMagnitude(u),e.center=new ie(t/2,r/2)}}}}const V=class V extends Pt{constructor(o,e,t){super(),this.fromWhite=o,this.fromBlack=e,this.fromRed=t}apply(o){return o===x.WHITE?this.fromWhite:o===x.BLACK?this.fromBlack:this.fromRed}};P(V,"CYCLE",new V(x.BLACK,x.RED,x.WHITE)),P(V,"REVERSE_CYCLE",new V(x.RED,x.WHITE,x.BLACK)),P(V,"WHITE_SET",new V(x.WHITE,x.WHITE,x.WHITE)),P(V,"BLACK_SET",new V(x.BLACK,x.BLACK,x.BLACK)),P(V,"RED_SET",new V(x.RED,x.RED,x.RED)),P(V,"BLACK_TOGGLE",new V(x.BLACK,x.WHITE,x.BLACK)),P(V,"RED_TOGGLE",new V(x.RED,x.RED,x.WHITE)),P(V,"enumeration",new mt(V));let Ne=V;const bn=new Ye("pressStyle0",Ne.CYCLE),kn=new Ye("pressStyle1",Ne.WHITE_SET),Ln=new Ye("pressStyle2",Ne.REVERSE_CYCLE),Fn=i=>{switch(i){case 0:return bn.value;case 1:return kn.value;case 2:return Ln.value}},qt=(i,o,e)=>{Xe(e,i,o,!0)};class zn{constructor(o){this.hintAction=o}get annotation(){return this.hintAction.annotation}apply(o){this.hintAction.apply(o)}getUndo(o){throw new Error("unimplemented")}isEmpty(){return this.hintAction.isEmpty()}serializeAction(){throw new Error("unimplemented")}static deserializeAction(o,e){throw new Error("unimplemented")}}const An=i=>i instanceof xo?{type:"SquareBoard",width:i.width,height:i.height}:i instanceof Bo?{type:"HexagonalBoard",radius:i.radius,scale:i.scale,isPointyTop:i.isPointyTop,holeRadius:i.holeRadius}:{type:"BaseBoard",vertices:i.vertices.map(o=>({x:o.logicalCoordinates.x,y:o.logicalCoordinates.y,vx:o.viewCoordinates.x,vy:o.viewCoordinates.y})),faces:i.faces.map(o=>({x:o.logicalCoordinates.x,y:o.logicalCoordinates.y,vertices:o.vertices.map(e=>i.vertices.indexOf(e))}))},ao=i=>({version:1,board:An(i.board),state:i.stateProperty.value.serializeState(i.board)}),io=i=>{const o=ao(i);return fn(JSON.stringify(o))};function Nn(i){return new Worker(""+new URL("hintWorker-CVZ9o6xx.js",import.meta.url).href,{name:i==null?void 0:i.name})}let we=null;const We=new Y(!1),Tn=()=>(we||(we=new Nn,we==null||we.addEventListener("message",i=>{i.data.type==="hint-worker-loaded"&&(We.value=!0)})),we),xn=i=>{const o=ao(i),e=i.solution.cleanState.serializeState(i.board),t=i.solution.solvedState.serializeState(i.board),r=[...i.solution.blackEdges].map(n=>i.board.edges.indexOf(n));return{puzzle:o,cleanState:e,solvedState:t,blackEdges:r}},Z=class Z extends Pt{};P(Z,"DEFAULT",new Z),P(Z,"LOADING",new Z),P(Z,"SEARCHING",new Z),P(Z,"FOUND",new Z),P(Z,"NOT_FOUND",new Z),P(Z,"enumeration",new mt(Z));let W=Z;const lo=new Je("uiHintUsesBuiltInSolve",!1),ft=new Je("showUndoRedoAllProperty",!1);class co extends bo{constructor(e,t){const r=re()({style:le,initialTimeElapsed:0},t),n=r.style;super();P(this,"timeElapsedProperty",new Y(0));P(this,"hintStateProperty",new Y(W.DEFAULT));P(this,"stack");P(this,"stackLengthProperty",new Y(0));P(this,"stackPositionProperty",new Y(0));P(this,"undoPossibleProperty");P(this,"redoPossibleProperty");P(this,"currentSnapshotProperty");P(this,"hasErrorProperty");P(this,"isSolvedProperty");P(this,"hintWorkerMessageID",0);P(this,"addedHintListener",!1);P(this,"pendingHintActionProperty",new Y(null));P(this,"displayedAnnotationProperty");P(this,"pendingActionFaceColorProperty",new Y(null));P(this,"pendingActionSectorProperty",new Y(null));P(this,"selectedFaceColorHighlightProperty");P(this,"selectedSectorEditProperty");P(this,"autoSolverFactoryProperty");P(this,"style");this.puzzle=e,this.style=n,this.timeElapsedProperty.value=r.initialTimeElapsed,this.autoSolverFactoryProperty=new J([Ue,n.safeSolverFactoryProperty,n.autoSolverFactoryProperty],(a,d,u)=>a?u:d),this.displayedAnnotationProperty=new J([this.pendingHintActionProperty],a=>a?a.annotation:null);const l=this.clearPendingAction.bind(this);this.stackPositionProperty.lazyLink(l),ue.lazyLink(l),this.disposeEmitter.addListener(()=>ue.unlink(l)),this.selectedFaceColorHighlightProperty=new J([e.stateProperty,ue,this.pendingActionFaceColorProperty],(a,d,u)=>{if((d===B.FACE_COLOR_MATCH||d===B.FACE_COLOR_OPPOSITE)&&u){const h=a.getFacesWithColor(u.color);return{faceColor:u.color,face:u.face,faces:h}}return null}),this.disposeEmitter.addListener(()=>this.selectedFaceColorHighlightProperty.dispose()),this.selectedSectorEditProperty=new J([e.stateProperty,ue,this.pendingActionSectorProperty],(a,d,u)=>d===B.SECTOR_STATE&&u?{sector:u,currentState:a.getSectorState(u)}:null),this.disposeEmitter.addListener(()=>this.selectedSectorEditProperty.dispose());{const a=e.stateProperty.value.clone();qt(e.board,a,this.style.safeSolverFactoryProperty.value),e.stateProperty.value=a}this.stack=[new Le(this.puzzle.board,null,e.stateProperty.value)],this.stackLengthProperty.value=1,this.currentSnapshotProperty=new J([this.stackLengthProperty,this.stackPositionProperty],()=>this.stack[this.stackPositionProperty.value]),this.hasErrorProperty=new J([this.currentSnapshotProperty],a=>a.errorDetected),this.isSolvedProperty=new J([this.currentSnapshotProperty],a=>{if(a.state.getWeirdEdges().length||a.state.hasInvalidFaceColors())return!1;const d=a.state.getSimpleRegions();return d.length===1&&d[0].isSolved}),this.addAutoSolveDelta(),this.updateState(),this.undoPossibleProperty=new J([this.stackPositionProperty],a=>a>0),this.redoPossibleProperty=new J([this.stackPositionProperty,this.stackLengthProperty],(a,d)=>a<d-1);const s=()=>this.onAutoSolveChange();this.autoSolverFactoryProperty.lazyLink(s),this.style.safeSolverFactoryProperty.lazyLink(s),this.disposeEmitter.addListener(()=>{this.autoSolverFactoryProperty.unlink(s),this.style.safeSolverFactoryProperty.unlink(s)})}clearPendingAction(){this.pendingActionFaceColorProperty.value=null,this.pendingActionSectorProperty.value=null}step(e){this.timeElapsedProperty.value+=e,localStorage.setItem("timeElapsedProperty",JSON.stringify(this.timeElapsedProperty.value))}updateState(){this.clearPendingHint(),this.puzzle.stateProperty.value=this.stack[this.stackPositionProperty.value].state,setTimeout(()=>{localStorage.setItem("puzzleString",io(this.puzzle))},0)}wipeStackTop(){for(;this.stack.length>this.stackPositionProperty.value+1;)this.stack.pop();this.stackLengthProperty.value=this.stack.length}pushTransitionAtCurrentPosition(e){this.wipeStackTop(),this.stack.push(e),this.stackLengthProperty.value=this.stack.length,this.stackPositionProperty.value++}applyUserActionToStack(e,t){const r=(t==null?void 0:t.forceDirty)||e instanceof rt,l=this.stack[this.stackPositionProperty.value].state;let s=!1;const a=new rr(this.puzzle.board,l,this.puzzle.solution.solvedState);try{e.apply(a)}catch{s=!0}let d=l.createDelta();try{if(Ot(this.autoSolverFactoryProperty.value,this.puzzle.board,d,()=>{e.apply(d)},r),t!=null&&t.checkAutoSolve&&!(t!=null&&t.checkAutoSolve(d)))throw new it("Auto-solver did not respect user action")}catch(h){if(s=!0,h instanceof it)console.log("error"),d=l.createDelta(),Ot(this.style.safeSolverFactoryProperty.value,this.puzzle.board,d,()=>{e.apply(d)},r);else throw h}const u=l.clone();d.apply(u),this.pushTransitionAtCurrentPosition(new Le(this.puzzle.board,e,u,s))}addAutoSolveDelta(){const e=this.puzzle.stateProperty.value.createDelta();try{if(Xe(this.autoSolverFactoryProperty.value,this.puzzle.board,e,!0),!e.isEmpty()){const t=this.puzzle.stateProperty.value.clone();e.apply(t),this.pushTransitionAtCurrentPosition(new Le(this.puzzle.board,new rt,t))}}catch(t){if(!(t instanceof it))throw t}}onAutoSolveChange(){const e=this.stack[this.stackPositionProperty.value];e.action&&this.stackPositionProperty.value--,this.applyUserActionToStack(e.action||new rt,{forceDirty:!0}),this.updateState()}onUserUndo(){this.stackPositionProperty.value>0&&(this.stackPositionProperty.value--,this.updateState())}onUserRedo(){this.stackPositionProperty.value<this.stackLengthProperty.value-1&&(this.stackPositionProperty.value++,this.updateState())}onUserUndoAll(){this.stackPositionProperty.value>0&&(this.stackPositionProperty.value=0,this.updateState())}onUserRedoAll(){this.stackPositionProperty.value<this.stackLengthProperty.value-1&&(this.stackPositionProperty.value=this.stackLengthProperty.value-1,this.updateState())}onUserEscape(){this.clearPendingAction(),this.clearPendingHint()}getNewEdgeState(e,t){const r=ue.value===B.EDGE_STATE_REVERSED;return Fn(r?2-t:t).apply(e)}onUserEdgePress(e,t){const r=this.puzzle.stateProperty.value.getEdgeState(e),n=this.getNewEdgeState(r,t);if(r!==n){const l=this.stack[this.stackPositionProperty.value];l.action&&l.action instanceof Tt&&l.action.edge===e&&this.stackPositionProperty.value--;const s=new Tt(e,n);this.applyUserActionToStack(s,{checkAutoSolve:a=>a.getEdgeState(e)===n}),this.updateState()}}onUserFacePress(e,t){let r=ue.value===B.FACE_COLOR_MATCH;t===2&&(r=!r);const n=e?this.puzzle.stateProperty.value.getFaceColor(e):this.puzzle.stateProperty.value.getOutsideColor(),l=this.pendingActionFaceColorProperty.value;if(l){if(e!==l.face){const s=l.color;s!==n&&(r?this.applyUserActionToStack(new lr(Me(this.puzzle.stateProperty.value,n),Me(this.puzzle.stateProperty.value,s))):this.applyUserActionToStack(new cr(Me(this.puzzle.stateProperty.value,n),Me(this.puzzle.stateProperty.value,s))))}this.pendingActionFaceColorProperty.value=null,this.updateState()}else this.pendingActionFaceColorProperty.value={face:e,color:n}}onUserSectorPress(e,t){this.pendingActionSectorProperty.value=e}onUserSectorSet(e,t){this.applyUserActionToStack(new dr(e,t)),this.pendingActionSectorProperty.value=null,this.updateState()}onUserRequestSolve(){const e=this.puzzle.stateProperty.value;if(!ro(e))if(lo.value){const t=e.clone();Xe(to,this.puzzle.board,t,!0),this.pushTransitionAtCurrentPosition(new Le(this.puzzle.board,new xt,t,!1)),this.updateState()}else{const t=jo(this.puzzle.board,this.puzzle.stateProperty.value,{maxIterations:1e4,failOnMultipleSolutions:!0});if(t.length===1){const r=this.puzzle.stateProperty.value.clone();t[0].forEach(n=>{r.setEdgeState(n,x.BLACK)}),qt(this.puzzle.board,r,this.style.safeSolverFactoryProperty.value),this.pushTransitionAtCurrentPosition(new Le(this.puzzle.board,new xt,r,!1)),this.updateState()}else t.length===0?console.log("No solution found"):console.log("Multiple solution found?!?")}}clearPendingHint(){this.hintStateProperty.value=W.DEFAULT,this.pendingHintActionProperty.value=null,this.hintWorkerMessageID=0}onUserClearHint(){this.clearPendingHint()}onHintReceived(e){this.hintStateProperty.value=e?W.FOUND:W.NOT_FOUND,e&&(this.pendingHintActionProperty.value=e)}onUserRequestHint(){if(this.clearPendingAction(),this.isSolvedProperty.value||this.pendingHintActionProperty.value)return;const e=le.allowEdgeEditProperty.value,t=le.allowFaceColorEditProperty.value,r=le.allowSectorEditProperty.value,n=le.vertexStateVisibleProperty.value,l=le.faceStateVisibleProperty.value;this.hintWorkerMessageID=Math.random();const s=Tn();if(!this.addedHintListener){this.addedHintListener=!0;const a=d=>{if(d.data.type==="hint-response"&&d.data.id===this.hintWorkerMessageID){const u=d.data.action?ur(this.puzzle.board,d.data.action):null;this.onHintReceived(u)}};s.addEventListener("message",a),this.disposeEmitter.addListener(()=>self.removeEventListener("message",a))}if(s.postMessage({type:"hint-request",id:this.hintWorkerMessageID,solveEdges:e,solveColors:t,solveSectors:r,solveVertexState:n,solveFaceState:l,serializedSolvablePuzzle:xn(this.puzzle)}),We.value)this.hintStateProperty.value=W.SEARCHING;else{this.hintStateProperty.value=W.LOADING;const a=d=>{d&&(this.hintStateProperty.value===W.LOADING&&(this.hintStateProperty.value=W.SEARCHING),We.unlink(a))};We.link(a)}}onUserApplyHint(){const e=this.pendingHintActionProperty.value;e&&(this.clearPendingHint(),this.applyUserActionToStack(new zn(e)),this.updateState())}}class Le{constructor(o,e,t,r=!1){this.board=o,this.action=e,this.state=t,this.errorDetected=r}}class je extends A{constructor(o,e,t){const r=re()({allowBarrierClickToHide:!0,panelOptions:{xMargin:15,yMargin:15,fill:y.uiBackgroundColorProperty,stroke:y.uiForegroundColorProperty}},t);super(),this.content=o,this.viewContext=e;const n=new K({fill:y.barrierColorProperty});this.addChild(n),e.layoutBoundsProperty.link(s=>{n.rectBounds=s}),r.allowBarrierClickToHide&&n.addInputListener({down:()=>{this.hide()}});const l=new Ae(o,r.panelOptions);e.layoutBoundsProperty.link(s=>{l.maxWidth=s.width*.9,l.maxHeight=s.height*.9}),this.addChild(new Ve(l,{alignBoundsProperty:e.layoutBoundsProperty,yAlign:"top",topMargin:50}))}show(){this.viewContext.glassPane.hasChild(this)||(this.reset(),this.viewContext.glassPane.addChild(this))}hide(){this.viewContext.glassPane.hasChild(this)&&this.viewContext.glassPane.removeChild(this)}reset(){}}class F extends Go{constructor(o,e,t){const r=re()({advanced:!1,accessibleName:o,checkboxColor:y.uiForegroundColorProperty,checkboxColorBackground:y.uiBackgroundColorProperty},t),n=new q(o,{font:_,fill:y.uiForegroundColorProperty});r.advanced&&(r.visibleProperty=U),r.boxWidth=n.height,super(e,n,r)}}const oe=(i,o,e,t)=>{const r=new Xo(o,e,{spacing:8,radioButtonOptions:{selectedColor:y.uiButtonBaseColorProperty,deselectedColor:y.uiBackgroundColorProperty,stroke:y.uiForegroundColorProperty}}),n=re()({stretch:!0,align:"left",spacing:10,children:[new q(i,{font:yt,fill:y.uiForegroundColorProperty}),r]},t);return new G(n)};class ce extends qe{constructor(o,e){const t=re()({advanced:!1,textFill:y.uiButtonForegroundProperty,baseColor:y.uiButtonBaseColorProperty,xMargin:5,yMargin:5,font:_,buttonAppearanceStrategy:ve},e);t.advanced&&(t.visibleProperty=U),super(o,t)}}class Bn extends M{constructor(o,e,t,r){const n=re()({advanced:!1,onOffSwitchOptions:{size:new lt(40,20),trackFillLeft:y.uiButtonDisabledColorProperty,trackFillRight:y.uiButtonBaseColorProperty,accessibleName:e},spacing:10},r),l=new Ko(o,n.onOffSwitchOptions);n.children=[t,l],n.advanced&&(n.visibleProperty=U),super(n)}}class te extends Bn{constructor(o,e,t){const r=re()({textOptions:{}},t),n=new H(e,r.textOptions);super(o,e,n,r)}}class uo extends Jo{constructor(o,e,t){super(o,e,j({orientation:"horizontal",touchAreaYDilation:5,radioButtonOptions:{baseColor:y.uiButtonBaseColorProperty,disabledColor:y.uiButtonDisabledColorProperty,xMargin:8*1.3,yMargin:5*1.3,buttonAppearanceStrategyOptions:{selectedStroke:y.uiButtonSelectedStrokeColorProperty,deselectedStroke:y.uiButtonDeselectedStrokeColorProperty}}},t))}}const In=new O("M1024 640q0 106 -75 181t-181 75t-181 -75t-75 -181t75 -181t181 -75t181 75t75 181zM1536 749v-222q0 -12 -8 -23t-20 -13l-185 -28q-19 -54 -39 -91q35 -50 107 -138q10 -12 10 -25t-9 -23q-27 -37 -99 -108t-94 -71q-12 0 -26 9l-138 108q-44 -23 -91 -38q-16 -136 -29 -186q-7 -28 -36 -28h-222q-14 0 -24.5 8.5t-11.5 21.5l-28 184q-49 16 -90 37l-141 -107q-10 -9 -25 -9q-14 0 -25 11q-126 114 -165 168q-7 10 -7 23q0 12 8 23q15 21 51 66.5t54 70.5q-27 50 -41 99l-183 27q-13 2 -21 12.5t-8 23.5v222q0 12 8 23t19 13l186 28q14 46 39 92q-40 57 -107 138q-10 12 -10 24q0 10 9 23q26 36 98.5 107.5t94.5 71.5q13 0 26 -10l138 -107q44 23 91 38q16 136 29 186q7 28 36 28h222q14 0 24.5 -8.5t11.5 -21.5l28 -184q49 -16 90 -37l142 107q9 9 24 9q13 0 25 -10q129 -119 165 -170q7 -8 7 -22q0 -12 -8 -23q-15 -21 -51 -66.5t-54 -70.5q26 -50 41 -98l183 -28q13 -2 21 -12.5t8 -23.5z").makeImmutable(),Rn=new O("M979 1395q19 19 32 13t13 -32v-1472q0 -26 -13 -32t-32 13l-710 710q-9 9 -13 19v-678q0 -26 -19 -45t-45 -19h-128q-26 0 -45 19t-19 45v1408q0 26 19 45t45 19h128q26 0 45 -19t19 -45v-678q4 10 13 19z").makeImmutable(),Hn=new O("M45 -115q-19 -19 -32 -13t-13 32v1472q0 26 13 32t32 -13l710 -710q9 -9 13 -19v678q0 26 19 45t45 19h128q26 0 45 -19t19 -45v-1408q0 -26 -19 -45t-45 -19h-128q-26 0 -45 19t-19 45v678q-4 -10 -13 -19z").makeImmutable(),On=new O("M1619 1395q19 19 32 13t13 -32v-1472q0 -26 -13 -32t-32 13l-710 710q-9 9 -13 19v-710q0 -26 -13 -32t-32 13l-710 710q-19 19 -19 45t19 45l710 710q19 19 32 13t13 -32v-710q4 10 13 19z").makeImmutable(),Mn=new O("M45 -115q-19 -19 -32 -13t-13 32v1472q0 26 13 32t32 -13l710 -710q9 -9 13 -19v710q0 26 13 32t32 -13l710 -710q19 -19 19 -45t-19 -45l-710 -710q-19 -19 -32 -13t-13 32v710q-4 -10 -13 -19z").makeImmutable(),Dn=new O("M503.691 189.836L327.687 37.851C312.281 24.546 288 35.347 288 56.015v80.053C127.371 137.907 0 170.1 0 322.326c0 61.441 39.581 122.309 83.333 154.132 13.653 9.931 33.111-2.533 28.077-18.631C66.066 312.814 132.917 274.316 288 272.085V360c0 20.7 24.3 31.453 39.687 18.164l176.004-152c11.071-9.562 11.086-26.753 0-36.328z").makeImmutable(),Vn=new O("M363 0l91 91l-235 235l-91 -91v-107h128v-128h107zM886 928q0 22 -22 22q-10 0 -17 -7l-542 -542q-7 -7 -7 -17q0 -22 22 -22q10 0 17 7l542 542q7 7 7 17zM832 1120l416 -416l-832 -832h-416v416zM1515 1024q0 -53 -37 -90l-166 -166l-416 416l166 165q36 38 90 38q53 0 91 -38l235 -234q37 -39 37 -91z").makeImmutable(),pe=(i,o)=>new ee(i,j({maxWidth:20,maxHeight:20,fill:"black"},o));class Te{constructor(o,e){P(this,"timerListener",null);P(this,"tooltipNode",null);this.viewContext=o,this.tooltipTextOverride=e}showTooltip(o,e,t){if(!this.tooltipNode){this.tooltipNode=new Ae(new q(o,{font:hr}),{cornerRadius:1,xMargin:2,yMargin:2});const r=this.viewContext.glassPane.globalToLocalPoint(t.point);this.tooltipNode.leftTop=r.plusXY(0,this.viewContext.glassPane.getUniqueTransform().transformDeltaY(20)),this.tooltipNode.bottom>this.viewContext.layoutBoundsProperty.value.bottom&&(this.tooltipNode.bottom=r.y-2),this.tooltipNode.left<this.viewContext.layoutBoundsProperty.value.left&&(this.tooltipNode.left=this.viewContext.layoutBoundsProperty.value.left+2),this.tooltipNode.right>this.viewContext.layoutBoundsProperty.value.right&&(this.tooltipNode.right=this.viewContext.layoutBoundsProperty.value.right-2),this.viewContext.glassPane.addChild(this.tooltipNode)}}hideTooltip(){this.tooltipNode&&(this.tooltipNode.dispose(),this.tooltipNode=null)}clearListener(){this.timerListener&&(Ft.clearTimeout(this.timerListener),this.timerListener=null)}enter(o){const e=o.currentTarget,t=this.tooltipTextOverride??(e==null?void 0:e.labelContent)??(e==null?void 0:e.accessibleName),r=o.pointer;e&&t&&this.timerListener===null&&(this.timerListener=Ft.setTimeout(()=>{this.showTooltip(t,e,r)},200))}exit(o){this.clearListener(),this.hideTooltip()}dispose(){this.clearListener(),this.hideTooltip()}}class Qe extends uo{constructor(o){const{basicLinesIcon:e,basicFaceColoringIcon:t,pureFaceColoringIcon:r,classicIcon:n,basicSectorsIcon:l,sectorsWithColorsIcon:s,vertexStateIcon:a,faceStateIcon:d,customIcon:u}=Qe.getIcons(),h=new Te(o);super(Xt,[{value:Kt,createNode:()=>n,labelContent:"Classic",options:{}},{value:Jt,createNode:()=>e,labelContent:"Lines",options:{}},{value:Yt,createNode:()=>t,labelContent:"Lines and Colors",options:{}},{value:Zt,createNode:()=>r,labelContent:"Colors",options:{}},{value:jt,createNode:()=>l,labelContent:"Sectors",options:{visibleProperty:U}},{value:Qt,createNode:()=>s,labelContent:"Sectors and Colors",options:{visibleProperty:U}},{value:ht,createNode:()=>a,labelContent:"Vertex State",options:{visibleProperty:U}},{value:gt,createNode:()=>d,labelContent:"Face State",options:{visibleProperty:U}},{value:$t,createNode:()=>u,labelContent:"Custom",options:{visibleProperty:U}}]),this.children.forEach(v=>v.addInputListener(h)),o.layoutBoundsProperty.link(v=>{this.maxWidth=Math.max(1,v.width-2*Ee)})}static getIcons(){const o=new K(0,0,15,15,{stroke:y.whiteLineColorProperty,fill:y.faceColorDefaultColorProperty}),e=new K(0,0,15,15,{stroke:y.whiteLineColorProperty,fill:new J([y.faceColorBasicTargetColorProperty],b=>b.withAlpha(1))}),t=new ee(new O().moveTo(0,15).lineTo(0,0).lineTo(15,0).makeImmutable(),{stroke:new J([y.simpleRegionTargetColorProperty],b=>b.withAlpha(1)),lineWidth:4,lineCap:"round",lineJoin:"round"}),r=new ee(new O().moveTo(0,15).lineTo(0,0).lineTo(15,0).makeImmutable(),{stroke:y.blackLineColorProperty,lineWidth:4,lineCap:"round",lineJoin:"round"}),n=new ee(new O().arc(0,0,9,0,Math.PI/2,!1),{stroke:y.sectorOnlyOneColorProperty}),l=new A({children:[o,t]}),s=new A({children:[e,r]}),a=new A({children:[new K(0,0,15,15,{fill:y.uiForegroundColorProperty})]}),d=3,u=new O().moveTo(-d,-d).lineTo(d,d).moveTo(-d,d).lineTo(d,-d),h=new A({children:[new K(0,0,15,15,{fill:y.puzzleBackgroundColorProperty}),new ee(new O().moveTo(0,15).lineTo(0,0).lineTo(15,0).makeImmutable(),{stroke:y.blackLineColorProperty,lineWidth:3,lineCap:"square",lineJoin:"miter"}),new ee(u,{stroke:y.xColorProperty,lineWidth:2,x:15,y:7.5})]}),v=new A({children:[o,n,t]}),k=new A({children:[e,n,r]}),S=no("eJytV11v2jAU/S9+9oOvv4PUh7VQqS+dNtZK08RDVlwUjQIiKWuF8t9nJw2JjWGJygtKfE7OuR/Oxdmjndnm2XqFRoDR73W6naPRHhXvG4NG6DrNzXW1hh2vyJ5Mjka/9ugNjQhG79Xvrr7ZubsSdzCoMYhh1MPAw5in6WO8xmhMU3iY/5ysMRZ7TnmY/5z24qQelnhx+hgQL5gABM8xAP3SMB/0axOAfnECUHierJxh9JxG+9k2mmDAFLPZhxJEKIA5Fpg2FBqhcCyxwqKhsAiFWRuNk4bCIxRqbWxVdcMREY6wPra4QBqSjJAS62SLDIe0VISknZctKBwy07HkSWVnA+Oz0hJRXqSF6bxAN+uXzdIUZpwWKaoL/pguX+v7lnbrrXcb464csW1Q61Lt1A5BhAQWEFRIoAFBHyu4rMx8YaZuIQh7Ytc/InYUF3FVhMwl/d0s7FgJnpiGkM+uFDD6a7LtfNJRdCHerJfrbaRu7TpGT+66Llxm5xiTIhESGNdaccnZB2Fa54a+PvyY3o0nnXpb7/Vms86zwhyk76yQ1QBOOFeESZ0w5cqWRdYDg7v7nvphoI0+EEEJIcIaJIoyCPQf7seTG+swRvF3uTzlt3pdLhsPRmXCtdAEEkpUfw8Y4KEp1ZpwpaWQjBHR14MOyQMEkTQhYK2EpL092AAPxaRilJKEckbFUb9PevAhHoqDtG2XTNreJ737IYb0I1ECqOBCJMDtzu3rIQd4cHBdUEwntlCgeuehhtTKblhCpSB2byXWp6+H7uNhwWy1S5fZ/ICh0XO6zI2bceap+DAKR1yANNzavL52dDtht8XRaDerubcGZTuMpUv7nABEBOgQARoRYEMEWESADBEQEQHVEeD/rUGsimKIgoq1AQbFEGsEkE+nMTAK/vkoookMqibEOmpD60q4v3h3qjJvsRfqMUCCT5H6wVNnJPTty9UVckFGeNDh5Wd4tMNji9M81lNPdPXO8FSHx8/l0U2YniNCX0Xel9jNZVERmwNbrJe33nrfg+6+PThX546XtNhmloh+OkM7pvMvq/dmNgdHWjgr5gZ9R6/VKravR1L0clLsclL8clJHHxCeFOutIy8X0tEniydFe+scfdmcTO1PbE/NyrL8B0eOKVk=");L()&&z(S);const f=new er(S.board.vertices[5],S.stateProperty,{...ht,allVertexStateVisibleProperty:new Y(!0)}),C=new A({children:[f],scale:60}),c=new tr(S.board.faces[5],S.stateProperty,gt),p=new A({children:[c],scale:30}),E=pe(Vn,{fill:y.uiForegroundColorProperty,matrix:new Wt().rowMajor(.75,0,0,0,-.75,0,0,0,1)}),m=new Vo;return{basicLinesIcon:m.createBox(l),basicFaceColoringIcon:m.createBox(s),pureFaceColoringIcon:m.createBox(a),classicIcon:m.createBox(h),basicSectorsIcon:m.createBox(v),sectorsWithColorsIcon:m.createBox(k),vertexStateIcon:m.createBox(C),faceStateIcon:m.createBox(p),customIcon:m.createBox(E)}}}const U=new Je("advancedSettingsVisibleProperty",!1);class qn extends je{constructor(o){const e=new Te(o),t=new G({stretch:!0,align:"left",spacing:8,children:[new q("Solve After Every Move",{font:yt,fill:y.uiForegroundColorProperty}),new zt({xAlign:"left",yAlign:"top",xSpacing:20,ySpacing:8,columns:[[new F("Vertex Joint X",Ur),new F("Vertex Forced Line",Wr),new F("Vertex Forced X",Gr),new F("Completed Face X",Xr),new F("Completed Face Lines",Kr),new F("Simple Loop X",Jr),new F("Simple Loop Lines",Yr),new F("Double Minus One Faces",Zr),new F("1/N-1 Sectors",jr),new F("Simple Sectors",Qr),new F("Vertex X",$r),new F("Vertex Lines",_r),new F("Vertex Sectors",en),new F("Vertex Faces",tn)],[new F("Color X",on),new F("Color Lines",rn),new F("Color Parity X",nn),new F("Color Parity Lines",sn),new F("Color Parity Colors",an),new F("Color Parity Partial",ln),new F("Vertex/Color To Face",cn),new F("Face X",dn),new F("Face Lines",un),new F("Face Sectors",pn),new F("Face Color",hn)]]})]}),r=oe("Theme",gr,Bt.map(c=>({value:c,createNode:()=>new q(c.name,{font:_,fill:y.uiForegroundColorProperty}),a11yName:c.name}))),n=new G({spacing:15,stretch:!0,visible:Ze.debugColors,children:Bt.filter(c=>c.isEditable).map(c=>new ce(`Edit ${c.name} Theme`,{listener:()=>{yr(c)}}))}),l=new G({stretch:!0,align:"left",spacing:8,children:[new q("Puzzle Display",{font:yt,fill:y.uiForegroundColorProperty}),new zt({xAlign:"left",yAlign:"top",xSpacing:20,ySpacing:8,columns:[[new F("Lines Visible",It),new F("Color Lines",fr,{enabledProperty:It,layoutOptions:{leftMargin:20}}),new F("Face Colors Visible",wr),new F("Sectors Visible",nt),new F("Sectors Next to Edges",Pr,{advanced:!0,enabledProperty:nt,layoutOptions:{leftMargin:20}}),new F("Trivial Sectors",mr,{advanced:!0,enabledProperty:nt,layoutOptions:{leftMargin:20}}),new F("Vertex State",Rt),new F("All Vertex State",vr,{advanced:!0,enabledProperty:Rt,layoutOptions:{leftMargin:20}}),new F("Face State",Sr,{advanced:!0})],[new F("Possible Line Visible",Cr),new F("Impossible Line Visible",Ht),new F("Vertices Visible",Er),new F("Vertices Small",br),new F("Red X Visible",kr),new F("Red X Aligned",Lr)]]}),new M({spacing:20,visibleProperty:U,children:[oe("Line Join",zr,Fr.map(c=>({value:c,createNode:()=>new q(c,{font:_,fill:y.uiForegroundColorProperty}),labelContent:c}))),oe("Line Cap",Nr,Ar.map(c=>({value:c,createNode:()=>new q(c,{font:_,fill:y.uiForegroundColorProperty}),labelContent:c}))),oe("Vertex Style",xr,Tr.map(c=>({value:c,createNode:()=>new q(c,{font:_,fill:y.uiForegroundColorProperty}),labelContent:c}))),oe("Impossible Line Style",Ir,Br.map(c=>({value:c,createNode:()=>new q(c,{font:_,fill:y.uiForegroundColorProperty}),labelContent:c}))),oe("Face Value Style",Hr,Rr.map(c=>({value:c,createNode:()=>new q(c,{font:_,fill:y.uiForegroundColorProperty}),labelContent:c})))]})]}),s=oe("Face Color Threshold",Or,[{value:1,createNode:()=>new H("Show All"),labelContent:"Show All"},{value:2,createNode:()=>new H("2+"),labelContent:"2+"},{value:3,createNode:()=>new H("3+"),labelContent:"3+"},{value:5,createNode:()=>new H("5+"),labelContent:"5+"},{value:10,createNode:()=>new H("10+"),labelContent:"10+"},{value:Number.POSITIVE_INFINITY,createNode:()=>new H("Only Outside"),labelContent:"Only Outside"}]),a=new G({spacing:8,align:"left",stretch:!0,children:[new te(Ue,"Auto-Solve"),new te(gn,"Add Lines",{layoutOptions:{leftMargin:20},enabledProperty:Ue}),new te(yn,"Simple Loops",{layoutOptions:{leftMargin:20},enabledProperty:Ue}),new te(_t,"Show View Style Controls"),new te(Ht,"Show Impossible Lines"),new te(eo,"Show Elapsed Time"),new te(ft,"Show Undo-All / Redo-All",{advanced:!0}),new te(Ct,"Show Layout Test",{advanced:!0}),new te(lo,"Solve Uses Built-In",{advanced:!0})]}),d=new Ke(!1),u=J.and([U,d]),h=Qe.getIcons(),v=(c,p)=>new M({spacing:5,children:[new H(p),c]}),k=oe("View Style",Xt,[{value:Kt,createNode:()=>v(h.classicIcon,"Classic"),labelContent:"Classic"},{value:Jt,createNode:()=>v(h.basicLinesIcon,"Lines"),labelContent:"Lines"},{value:Yt,createNode:()=>v(h.basicFaceColoringIcon,"Lines and Colors"),labelContent:"Lines and Colors"},{value:Zt,createNode:()=>v(h.pureFaceColoringIcon,"Colors"),labelContent:"Colors"},{value:jt,createNode:()=>v(h.basicSectorsIcon,"Sectors"),labelContent:"Sectors",options:{visibleProperty:U}},{value:Qt,createNode:()=>v(h.sectorsWithColorsIcon,"Sectors and Colors"),labelContent:"Sectors and Colors",options:{visibleProperty:U}},{value:ht,createNode:()=>v(h.vertexStateIcon,"Vertex State"),labelContent:"Vertex State",options:{visibleProperty:U}},{value:gt,createNode:()=>v(h.faceStateIcon,"Face State"),labelContent:"Face State",options:{visibleProperty:U}},{value:$t,createNode:()=>v(h.customIcon,"Custom"),labelContent:"Custom",options:{visibleProperty:U}}]),S=new te(d,"Show Custom Options",{advanced:!0}),f=new G({spacing:20,align:"left",children:[new M({spacing:20,children:[t,s]}),l],visibleProperty:u}),C=new ce("Reload to Defaults",{accessibleName:"Clear all settings/data, and reload the page",listener:()=>{localStorage.clear(),self.location.reload()},advanced:!0});C.addInputListener(e),super(new G({spacing:20,align:"left",stretch:!0,children:[a,new M({align:"top",spacing:30,children:[k,r,n]}),S,f,C,new te(U,"Show Advanced Settings")]}),o)}}class Un extends je{constructor(e){const t=new Ke(!1),r=new ce("Copy URL",{accessibleName:"Copy Shareable URL to Clipboard",listener:()=>{if(this.puzzle){const n=location.protocol+"//"+location.host+location.pathname;let l=this.puzzle;this.includeStateProperty.value||(l=new ge(l.board,oo.fromFaceValueData(l.board,l.stateProperty.value)));const s=io(l);Mr(n+"?p="+encodeURIComponent(s))}}});r.addInputListener(new Te(e));super(new G({spacing:20,align:"left",stretch:!0,children:[r,new F("Include Solve Progress",t)]}),e);P(this,"includeStateProperty");P(this,"puzzle",null);this.includeStateProperty=t}setPuzzle(e){this.puzzle=e}reset(){super.reset(),this.includeStateProperty.reset()}}const de=class de extends Pt{constructor(o){super(),this.canSolve=o}};P(de,"STANDARD",new de((o,e)=>(e=e.clone(),Xe(to,o,e,!0),ro(e)))),P(de,"NO_LIMIT",new de(()=>!0)),P(de,"enumeration",new mt(de));let be=de;const Ut=new Ye("canSolveDifficulty",be.STANDARD),Wn=i=>{const o=i.cleanState.clone();for(const e of i.board.faces)o.getFaceValue(e)===null&&o.setFaceValue(e,e.edges.filter(t=>i.blackEdges.has(t)).length);return Qo(i.board,o,i.blackEdges)};class Gn extends M{constructor(o,e){const t=new Yo("polygonGeneratorProperty",{serialize:c=>c.name,deserialize:c=>He.find(p=>p.name===c)??He[0]}),r=localStorage.getItem("polygonGeneratorParameters")?JSON.parse(localStorage.getItem("polygonGeneratorParameters")):null;let n=!1;const l=oe("Patterns",t,He.map(c=>({value:c,createNode:()=>new q(c.name,{font:_,fill:y.uiForegroundColorProperty}),labelContent:c.name})),{layoutOptions:{align:"top",grow:0},justify:"top"}),s=new M({spacing:10,align:"center",layoutOptions:{grow:0},grow:1}),a=new M({spacing:10,align:"center",layoutOptions:{grow:0},children:[new H("Solver Difficulty"),new wn(Ut,[{value:be.STANDARD,createNode:()=>new H("Standard"),labelContent:"Standard"},{value:be.NO_LIMIT,createNode:()=>new H("No Limit"),labelContent:"No Limit"}],{orientation:"horizontal",align:"center",spacing:30})]}),d=new M({spacing:10,align:"center",justify:"spaceEvenly",layoutOptions:{grow:0}}),u=new A,h=new A,v=new Fe;v.addListener(()=>{h.children=[]});const k=new A({children:[u,h]}),S=(c,p)=>{const E=c.generate(p),m=new O;E.forEach(b=>m.polygon(b)),u.children=[new ee(m,{fill:y.puzzleBackgroundColorProperty,stroke:y.blackLineColorProperty,lineWidth:.05})],v.emit()};S(He[0],{width:5,height:5}),t.link(c=>{d.children.forEach(b=>b.dispose()),s.children.forEach(b=>b.dispose());const p={},E=b=>r&&!n&&b in r?r[b]:c.defaultParameterValues[b],m=()=>{localStorage.setItem("polygonGeneratorParameters",JSON.stringify(p)),S(c,p)};for(const[b,N]of Object.entries(c.parameters))if(N.type==="integer"){const T=new At(E(b));T.link(g=>{p[b]=g,m()}),d.addChild(new Oe(N.label,T,N.range,{layoutFunction:Oe.createLayoutFunction4(),titleNodeOptions:{font:_,fill:y.uiForegroundColorProperty},sliderOptions:{trackSize:new lt(100,5),labelTagName:"label",keyboardStep:1,labelContent:N.label},arrowButtonOptions:{touchAreaXDilation:5,touchAreaYDilation:25},numberDisplayOptions:{decimalPlaces:0},delta:1,visibleProperty:N.advanced?U:null}))}else if(N.type==="float"){const T=new At(E(b));T.link(g=>{p[b]=g,m()}),d.addChild(new Oe(N.label,T,N.range,{layoutFunction:Oe.createLayoutFunction4(),titleNodeOptions:{font:_,fill:y.uiForegroundColorProperty},sliderOptions:{trackSize:new lt(100,5),labelTagName:"label",keyboardStep:.1,labelContent:N.label},numberDisplayOptions:{decimalPlaces:2},delta:.01,visibleProperty:N.advanced?U:null}))}else if(N.type==="boolean"){const T=new Ke(E(b));T.link(g=>{p[b]=g,m()}),d.addChild(new F(N.label,T,{advanced:N.advanced}))}else if(N.type==="choice"){const T=new wt(E(b));T.link(g=>{p[b]=g,m()}),d.addChild(oe(N.label,T,N.choices.map(g=>({value:g.value,createNode:()=>new q(g.label,{font:_,fill:y.uiForegroundColorProperty}),labelContent:g.label}))))}n=!0,s.addChild(new ce("Generate",{font:st,layoutOptions:{align:"center"},listener:async()=>{v.emit();const b=c.generate(p),N=new Io(b,c.scale??1),T=new Y(!1),g=()=>{T.value=!0};v.addListener(g);const w=new Fe,ne=new Fe,se=new Fe;se.addListener(()=>{h.children=[]}),w.addListener((R,D)=>{h.addChild(new ee(O.polygon(b[R]),{fill:y.generateAddedFaceColorProperty,stroke:y.blackLineColorProperty,lineWidth:.05})),D!==null&&h.addChild(new q(`${D}`,{font:st,fill:y.faceValueColorProperty,maxWidth:.9,maxHeight:.9,center:Ce(b[R])}))}),ne.addListener((R,D)=>{h.addChild(new ee(O.polygon(b[R]),{fill:y.generateMinimizedFaceColorProperty,stroke:y.blackLineColorProperty,lineWidth:.05})),D!==null&&h.addChild(new q(`${D}`,{font:st,fill:y.faceValueColorProperty,maxWidth:.9,maxHeight:.9,center:Ce(b[R])}))});try{const R=Ut.value,D=R.canSolve,Be=async()=>await nr(N,T,w),kt=async()=>{let et=await Be();if(R===be.NO_LIMIT)return et;{const vo=N.faces.filter(Re=>et.cleanState.getFaceValue(Re)===null),Lt=Wn(et);return vo.forEach(Re=>{w.emit(N.faces.indexOf(Re),Lt.cleanState.getFaceValue(Re))}),Lt}};let Ie=await kt();for(;!D(Ie.board,Ie.cleanState.clone());)se.emit(),Ie=await kt();const mo=await sr(Ie,D,T,ne);ar(17,T),T.value||(h.children=[],C.loadPuzzle(ge.fromSolvedPuzzle(mo)))}catch{}v.hasListener(g)&&v.removeListener(g)}}))});const f=new K({fill:y.playAreaBackgroundColorProperty,sizable:!0,layoutOptions:{grow:1},children:[k]});vt.multilink([f.localPreferredWidthProperty,f.localPreferredHeightProperty,k.localBoundsProperty],(c,p,E)=>{if(c!==null&&p!==null&&E.isFinite()){const b=c-30,N=p-2*15,T=Math.min(b/E.width,N/E.height);k.setScaleMagnitude(T),k.centerX=c/2,k.centerY=p/2}});const C=re()({spacing:10,stretch:!0,children:[l,new G({spacing:10,stretch:!0,layoutOptions:{grow:1},children:[f,s,new ut,a,new ut,d]})]},e);super(C)}}const Xn="#444",Kn="#fa0",Jn="#888",Yn="#fff",Zn="#f00",jn="#ff0",Qn="#ff0",$n="#0f0",_n="#0ff",es="#0af",ts="#f0f";class os extends je{constructor(e){const t=new M({children:[new q("Loading image...",{font:_,fill:y.uiForegroundColorProperty})]}),r=new A({children:[t]});super(r,e);P(this,"scanContentNode");P(this,"imageContainer");P(this,"solutionContainer");P(this,"blackImageLayer");P(this,"originalImageLayer");P(this,"thresholdImageLayer");P(this,"contourLayer");P(this,"puzzle",null);P(this,"rootContour",null);P(this,"contours",[]);P(this,"contourNodeMap",new Map);this.scanContentNode=r,this.blackImageLayer=new A,this.originalImageLayer=new A({visible:!1}),this.thresholdImageLayer=new A({visible:!1}),this.contourLayer=new A,this.imageContainer=new A({children:[this.blackImageLayer,this.originalImageLayer,this.thresholdImageLayer,this.contourLayer]}),this.solutionContainer=new A}getScanOptions(){return{originalImageCallback:e=>this.onOriginalImage(e),thresholdedImageCallback:e=>this.onThresholdedImage(e),rootContourCallback:e=>this.onRootContour(e),widestSubtreeCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeWidestContour()},dotContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeDotContour()},lineContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeLineContour()},zeroOuterContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeZeroOuterContour()},zeroInnerContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeZeroInnerContour()},oneContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeOneContour()},twoContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeTwoContour()},threeContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeThreeContour()},xContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeXContour()},unknownContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeUnknownContour()},debugImageCallback:e=>{},puzzleCallback:e=>this.onPuzzle(e),solutionsCallback:e=>this.onSolutions(e)}}onOriginalImage(e){this.originalImageLayer.addChild(new Nt(e)),this.blackImageLayer.addChild(K.bounds(this.originalImageLayer.bounds,{fill:"black"})),this.scanContentNode.children=[new G({spacing:10,children:[this.imageContainer,this.solutionContainer]})]}onThresholdedImage(e){this.thresholdImageLayer.addChild(new Nt(e))}onRootContour(e){this.rootContour=e,this.contours=e.getDescendantContours();for(const t of this.contours){const r=new rs(t);this.contourNodeMap.set(t,r),this.contourLayer.addChild(r)}}onPuzzle(e){this.puzzle=e}onSolutions(e){if(e.length===1)this.hide();else{const t=this.puzzle;L()&&z(t);const r=t.board;if(e.length===0){ze(r,t.stateProperty.value);const n=new me(t,{scale:20});this.solutionContainer.children=[new G({spacing:10,children:[new H("No Solutions Found"),n]})]}else{const n=new ge(r,t.stateProperty.value.clone()),l=new ge(r,t.stateProperty.value.clone()),s=new ge(r,t.stateProperty.value.clone());e[0].forEach(h=>n.stateProperty.value.setEdgeState(h,x.BLACK)),e[1].forEach(h=>l.stateProperty.value.setEdgeState(h,x.BLACK)),r.edges.forEach(h=>{n.stateProperty.value.getEdgeState(h)!==l.stateProperty.value.getEdgeState(h)&&s.stateProperty.value.setEdgeState(h,x.BLACK)}),ze(r,n.stateProperty.value),ze(r,l.stateProperty.value),ze(r,s.stateProperty.value);const a=new me(n,{scale:10}),d=new me(l,{scale:10}),u=new me(s,{scale:10});this.solutionContainer.children=[new G({spacing:10,children:[new H("Multiple Solutions Found"),new M({spacing:10,children:[new G({spacing:10,children:[a,new H("Solution A")]}),new G({spacing:10,children:[d,new H("Solution B")]}),new G({spacing:10,children:[u,new H("Difference")]})]})]})]}}}}class rs extends A{constructor(e){const t=new ee(e.shape,{stroke:Xn});super({children:[t]});P(this,"path");this.contour=e,this.path=t}makeWidestContour(){this.path.stroke=Kn}makeDotContour(){this.path.stroke=Jn}makeLineContour(){this.path.stroke=Yn}makeXContour(){this.path.stroke=Zn}makeZeroOuterContour(){this.path.stroke=jn}makeZeroInnerContour(){this.path.stroke=Qn}makeOneContour(){this.path.stroke=$n}makeTwoContour(){this.path.stroke=_n}makeThreeContour(){this.path.stroke=es}makeUnknownContour(){this.path.stroke=ts}}class ns extends je{constructor(o,e){super(new G({spacing:20,align:"left",stretch:!0,children:[new A({children:[new Gn(o,{loadPuzzle:t=>{this.hide(),e.loadPuzzle(t)},preferredWidth:700,preferredHeight:300})]}),new ut,new M({spacing:15,grow:1,children:[new ce("Load String",{listener:()=>{this.hide();const t=prompt("Enter puzzle string");t&&e.loadPuzzle(ge.loadDeprecatedScalaString(t))}}),new ce("Load Image (Rectangular Only)",{listener:()=>{this.hide();const t=document.createElement("input");t.type="file",t.onchange=r=>{const n=r.target.files[0];var l=new FileReader;l.readAsDataURL(n),l.onloadend=async()=>{const s=l.result,a=new os(o);a.show();const d=await ko(s,a.getScanOptions());e.loadPuzzle(d)}},t.click()}})]})]}),o)}}class ss extends q{constructor(o,e){const t=re()({font:Dr,fill:y.uiForegroundColorProperty},e),r=60,n=60*r,l=24*n,s=new J([o],a=>{a=Math.ceil(a);const d=Math.floor(a/l);a-=d*l;const u=Math.floor(a/n);a-=u*n;const h=Math.floor(a/r);a-=h*r;const v=a,k=u<10?`0${u}`:`${u}`,S=h<10?`0${h}`:`${h}`,f=v<10?`0${v}`:`${v}`;return d?`${d}d ${k}:${S}:${f}`:u?`${k}:${S}:${f}`:`${S}:${f}`});super(s,t),this.timerProperty=o,this.disposeEmitter.addListener(()=>{s.dispose()})}}class as extends M{constructor(o,e,t){const r=new Te(e),n=new Y(!1),l=new Y(0),s=new Y(W.NOT_FOUND),a=new he(o,{derive:p=>p?p.undoPossibleProperty:n}),d=new he(o,{derive:p=>p?p.redoPossibleProperty:n}),u=new he(o,{derive:p=>p?p.isSolvedProperty:n}),h=new he(o,{derive:p=>p?p.timeElapsedProperty:l}),v=new he(o,{derive:p=>p?p.hintStateProperty:s}),k=new J([u],p=>!p);let S=null,f=null,C=null;const c={buttonAppearanceStrategy:ve,baseColor:y.uiButtonBaseColorProperty,disabledColor:y.uiButtonDisabledColorProperty,xMargin:8*1.3,yMargin:5*1.3,mouseAreaXDilation:5,mouseAreaYDilation:5,touchAreaXDilation:5,touchAreaYDilation:5};super({spacing:10,stretch:!0,children:[new qe("New",j({},c,{accessibleName:"New",listener:()=>{S=S||new ns(e,{loadPuzzle:t.loadPuzzle}),S.show()},textFill:y.uiButtonForegroundProperty,baseColor:y.uiButtonBaseColorProperty,xMargin:5,yMargin:5,font:at,buttonAppearanceStrategy:ve})),new fe(j({},c,{accessibleName:"Undo All",content:pe(On),listener:()=>{o.value&&o.value.onUserUndoAll()},enabledProperty:a,visibleProperty:ft})),new fe(j({},c,{accessibleName:"Undo",content:pe(Rn),listener:()=>{o.value&&o.value.onUserUndo()},enabledProperty:a,fireOnHold:!0})),new ss(h,{visibleProperty:eo}),new fe(j({},c,{accessibleName:"Redo",content:pe(Hn),listener:()=>{o.value&&o.value.onUserRedo()},enabledProperty:d,fireOnHold:!0})),new fe(j({},c,{accessibleName:"Redo All",content:pe(Mn),listener:()=>{o.value&&o.value.onUserRedoAll()},enabledProperty:d,visibleProperty:ft})),new fe(j({},c,{accessibleName:"Settings",content:pe(In),listener:()=>{C=C||new qn(e),C.show()}})),new fe(j({},c,{accessibleName:"Share",content:pe(Dn),listener:()=>{const p=o.value;p&&(f=f||new Un(e),f.setPuzzle(p.puzzle),f.show())}})),new qe("Solve",j({},c,{accessibleName:"Solve",listener:()=>{o.value&&o.value.onUserRequestSolve()},enabledProperty:k,textFill:y.uiButtonForegroundProperty,baseColor:y.uiButtonBaseColorProperty,xMargin:5,yMargin:5,font:at,buttonAppearanceStrategy:ve})),new qe("Hint",j({},c,{accessibleName:"Hint",listener:()=>{o.value&&o.value.onUserRequestHint()},enabledProperty:new J([k,v],(p,E)=>p&&E===W.DEFAULT),textFill:y.uiButtonForegroundProperty,baseColor:y.uiButtonBaseColorProperty,xMargin:5,yMargin:5,font:at,buttonAppearanceStrategy:ve}))]}),this.puzzleModelProperty=o,this.children.forEach(p=>p.addInputListener(r)),e.layoutBoundsProperty.link(p=>{this.maxWidth=Math.max(1,p.width-2*Ee)})}}const xe=new A,po=new A,is=()=>{const i=Ze.p||localStorage.getItem("puzzleString"),o=ge.loadDefaultPuzzle();let e=null,t=0;try{let r=o;if(i){const n=no(i);if(n){r=n;const l=localStorage.getItem("timeElapsedProperty");t=l?JSON.parse(l):0}}e=pt(r.board,r.stateProperty.value)}catch(r){console.error(r)}return e||(e=pt(o.board,o.stateProperty.value)),L()&&z(e),new co(e,{initialTimeElapsed:t})};class ls extends A{constructor(o,e,t,r){super({});const n=new qr({diameter:20}),l={xMargin:5,yMargin:5,fill:y.uiBackgroundColorProperty,stroke:y.uiForegroundColorProperty},s=new Ae(new M({spacing:10,children:[new A({children:[n]}),new H("Loading Hint Solver...")]}),l),a=new M({spacing:10,children:[new Ae(new M({spacing:10,children:[new A({children:[n]}),new H("Searching for Hint...")]}),l),new ce("Cancel",{listener:r})]}),d=new M({spacing:10,children:[new ce("Apply Hint",{listener:t}),new ce("Hide Hint",{listener:r})]}),u=new Ae(new H("No Hint Found"),l);a.pickable=!1,u.pickable=!1;const h=k=>{this.children=[...k===W.LOADING?[s]:[],...k===W.SEARCHING?[a]:[],...k===W.FOUND?[d]:[],...k===W.NOT_FOUND?[u]:[]]};e.link(h),this.disposeEmitter.addListener(()=>e.unlink(h));const v=k=>{n.step(k)};o.stepEmitter.addListener(v),this.disposeEmitter.addListener(()=>o.stepEmitter.removeListener(v))}}class cs extends M{constructor(o){const e=new dt(0,0,15,0,{stroke:y.uiButtonForegroundProperty,lineWidth:4,lineCap:"round"}),t=6,r=new O().moveTo(-t,-t).lineTo(t,t).moveTo(-t,t).lineTo(t,-t),n=new ee(r,{stroke:y.uiButtonForegroundProperty,lineWidth:2}),l=new A({children:[new K(0,0,7,7,{stroke:y.uiButtonForegroundProperty,fill:y.uiForegroundColorProperty}),new K(7,7,7,7,{stroke:y.uiButtonForegroundProperty,fill:y.uiForegroundColorProperty})]}),s=new A({children:[new K(0,0,7,7,{stroke:y.uiButtonForegroundProperty,fill:y.uiForegroundColorProperty}),new K(7,7,7,7,{stroke:y.uiButtonForegroundProperty,fill:y.uiBackgroundColorProperty})]}),a=new A({children:[new ee(new O().moveTo(0,14).lineTo(0,0).lineTo(14,0),{stroke:y.uiButtonForegroundProperty}),new ee(new O().arc(0,0,7,0,Math.PI/2,!1),{stroke:y.uiButtonForegroundProperty})]}),d=17,u=6,h=7,v=2,k=h/Math.sqrt(2),S=new A({children:[new A({rotation:-Math.PI/4,children:[new K(0,0,d,h,{stroke:y.uiButtonForegroundProperty,fill:y.uiButtonInvertedForegroundProperty,cornerRadius:v}),new K(u,0,d-u,h,{fill:y.uiButtonForegroundProperty,cornerRadius:v})]}),new dt(k,k-.5,k+12,k-.5,{stroke:y.uiButtonForegroundProperty,lineDash:[5,1,3,1,2]})]}),f=new Te(o),C=new uo(ue,[{value:B.EDGE_STATE,labelContent:"Edge Edit Mode",createNode:()=>e,options:{visibleProperty:B.EDGE_STATE.isEnabledProperty}},{value:B.EDGE_STATE_REVERSED,labelContent:"Edge Reversed Edit Mode",createNode:()=>n,options:{visibleProperty:B.EDGE_STATE_REVERSED.isEnabledProperty}},{value:B.FACE_COLOR_MATCH,labelContent:"Face Color Match Edit Mode",createNode:()=>l,options:{visibleProperty:B.FACE_COLOR_MATCH.isEnabledProperty}},{value:B.FACE_COLOR_OPPOSITE,labelContent:"Face Color Opposite Edit Mode",createNode:()=>s,options:{visibleProperty:B.FACE_COLOR_OPPOSITE.isEnabledProperty}},{value:B.SECTOR_STATE,labelContent:"Sector Edit Mode",createNode:()=>a,options:{visibleProperty:B.SECTOR_STATE.isEnabledProperty}}],{layoutOptions:{grow:1}});C.children.forEach(E=>E.addInputListener(f));const c={buttonAppearanceStrategy:ve,baseColor:y.uiButtonBaseColorProperty,disabledColor:y.uiButtonDisabledColorProperty,mouseAreaXDilation:5,mouseAreaYDilation:5,touchAreaXDilation:5,touchAreaYDilation:5},p=new Zo(St,j({},c,{accessibleName:"Eraser Mode (Toggle)",content:S}));p.addInputListener(f),super({spacing:10,stretch:!0,children:[C,new qo,p]}),o.layoutBoundsProperty.link(E=>{this.maxWidth=Math.max(1,E.width-2*Ee)})}}class ds{constructor(o,e,t){this.layoutBoundsProperty=o,this.glassPane=e,this.stepEmitter=t}}self.assertions;const us=new A({renderer:"svg",children:[xe]}),ke=new Uo(us,{allowWebGL:!0,allowBackingScaleAntialiasing:!0,allowSceneOverflow:!1,accessibility:!0,backgroundColor:"#eee",assumeFullWindow:!0,listenToOnlyElement:Ze.debugColors});document.body.appendChild(ke.domElement);ke.setPointerAreaDisplayVisible(Ze.showPointerAreas);self.oncontextmenu=i=>i.preventDefault();const Et=new wt(new Ge(0,0,self.innerWidth,self.innerHeight)),Q=new Y(is()),ho=new so(Q,le,{layoutOptions:{stretch:!0,grow:1}}),go=new so(Q,le,{layoutOptions:{stretch:!0,grow:1},topological:!0,visibleProperty:Ct}),ps=new Ke(!1),hs=new he(Q,{derive:i=>i?i.hasErrorProperty:ps}),gs=new he(Q,{derive:i=>i?i.hintStateProperty:new Y(W.DEFAULT)});vt.multilink([hs,y.navbarBackgroundColorProperty,y.navbarErrorBackgroundColorProperty],(i,o,e)=>{ke.backgroundColor=i?e:o});const yo=new Fe,$e=new ds(Et,po,yo),fo=new as(Q,$e,{loadPuzzle:i=>{const o=pt(i.board,i.stateProperty.value);o&&(Q.value=new co(o))}}),ys=new cs($e),fs=new Qe($e),wo=new ls($e,gs,()=>{var i;(i=Q.value)==null||i.onUserApplyHint()},()=>{var i;(i=Q.value)==null||i.onUserClearHint()}),Se=new G({stretch:!0,children:[new Ve(fo,{margin:Ee}),new M({grow:1,stretch:!0,layoutOptions:{grow:1},children:[ho,go]}),new Ve(fs,{margin:Ee,visibleProperty:_t}),new Ve(ys,{margin:Ee})]});Et.lazyLink(i=>{Se.preferredWidth=i.width,Se.preferredHeight=i.height,Se.x=i.left,Se.y=i.top});xe.addChild(Se);xe.addChild(wo);xe.addChild(po);Wo.create(xe,[fo,wo],(i,o)=>{o.centerTop=i.centerBottom.plusXY(0,5)});ke.initializeEvents();let bt=!0;const Po=()=>{bt=!1;const i=new Ge(0,0,self.innerWidth,self.innerHeight);ke.setWidthHeight(i.width,i.height),Et.value=i,Ro.mobileSafari&&self.scrollTo(0,0)},_e=()=>{bt=!0};$(self).resize(_e);self.addEventListener("resize",_e);self.addEventListener("orientationchange",_e);self.visualViewport&&self.visualViewport.addEventListener("resize",_e);Po();ke.updateOnRequestAnimationFrame(i=>{var o;ir(),bt&&Po(),Se.validateBounds(),ho.step(i),go.step(i),(o=Q.value)==null||o.step(i),yo.emit(i)});document.addEventListener("keydown",i=>{var o,e,t,r;i.ctrlKey||i.metaKey?(i.key==="z"&&(i.shiftKey?(o=Q.value)==null||o.onUserRedo():(e=Q.value)==null||e.onUserUndo()),i.key==="y"&&((t=Q.value)==null||t.onUserRedo())):i.key==="1"?ae(B.EDGE_STATE):i.key==="2"?ae(B.EDGE_STATE_REVERSED):i.key==="3"?ae(B.FACE_COLOR_MATCH):i.key==="4"?ae(B.FACE_COLOR_OPPOSITE):i.key==="5"?ae(B.SECTOR_STATE):i.key==="6"?ae(B.VERTEX_STATE):i.key==="7"?ae(B.FACE_STATE):i.key==="8"?ae(B.FACE_VALUE):i.key==="9"?ae(B.DELETE_FACE):i.key==="Escape"&&((r=Q.value)==null||r.onUserEscape())});Gt.keydownEmitter.addListener(i=>{i.key==="e"&&(St.value=!0)});Gt.keyupEmitter.addListener(i=>{i.key==="e"&&(St.value=!1)});Q.lazyLink((i,o)=>{o&&o.dispose()});
